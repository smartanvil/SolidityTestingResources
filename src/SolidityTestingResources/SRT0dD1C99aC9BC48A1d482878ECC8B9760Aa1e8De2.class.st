Class {
	#name : #SRT0dD1C99aC9BC48A1d482878ECC8B9760Aa1e8De2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0dD1C99aC9BC48A1d482878ECC8B9760Aa1e8De2 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBNYXRoCiAqIEBkZXYgQXNzb3J0ZWQgbWF0aCBvcGVyYXRpb25zCiAqLwpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCgoKCi8qKgogKiBAdGl0bGUgU2FmZUVSQzIwCiAqIEBkZXYgV3JhcHBlcnMgYXJvdW5kIEVSQzIwIG9wZXJhdGlvbnMgdGhhdCB0aHJvdyBvbiBmYWlsdXJlLgogKiBUbyB1c2UgdGhpcyBsaWJyYXJ5IHlvdSBjYW4gYWRkIGEgYHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjA7YCBzdGF0ZW1lbnQgdG8geW91ciBjb250cmFjdCwKICogd2hpY2ggYWxsb3dzIHlvdSB0byBjYWxsIHRoZSBzYWZlIG9wZXJhdGlvbnMgYXMgYHRva2VuLnNhZmVUcmFuc2ZlciguLi4pYCwgZXRjLgogKi8KbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKEVSQzIwIHRva2VuLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlQXBwcm92ZShFUkMyMCB0b2tlbiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSkpOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgpjb250cmFjdCBEZXRhaWxlZEVSQzIwIGlzIEVSQzIwIHsKICBzdHJpbmcgcHVibGljIG5hbWU7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICBmdW5jdGlvbiBEZXRhaWxlZEVSQzIwKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQ4IF9kZWNpbWFscykgcHVibGljIHsKICAgIG5hbWUgPSBfbmFtZTsKICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsKICB9Cn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIGJlIGFibGUgdG8gcmVjb3ZlciB0b2tlbnMKICogQGF1dGhvciBTeWxUaQogKiBAZGV2IFRoaXMgYWxsb3cgYSBjb250cmFjdCB0byByZWNvdmVyIGFueSBFUkMyMCB0b2tlbiByZWNlaXZlZCBpbiBhIGNvbnRyYWN0IGJ5IHRyYW5zZmVycmluZyB0aGUgYmFsYW5jZSB0byB0aGUgY29udHJhY3Qgb3duZXIuCiAqIFRoaXMgd2lsbCBwcmV2ZW50IGFueSBhY2NpZGVudGFsIGxvc3Mgb2YgdG9rZW5zLgogKi8KY29udHJhY3QgQ2FuUmVjbGFpbVRva2VuIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLyoqCiAgICogQGRldiBSZWNsYWltIGFsbCBFUkMyMEJhc2ljIGNvbXBhdGlibGUgdG9rZW5zCiAgICogQHBhcmFtIHRva2VuIEVSQzIwQmFzaWMgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbVRva2VuKEVSQzIwQmFzaWMgdG9rZW4pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgRGVzdHJ1Y3RpYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB0aGF0IGNhbiBiZSBkZXN0cm95ZWQgYnkgb3duZXIuIEFsbCBmdW5kcyBpbiBjb250cmFjdCB3aWxsIGJlIHNlbnQgdG8gdGhlIG93bmVyLgogKi8KY29udHJhY3QgRGVzdHJ1Y3RpYmxlIGlzIE93bmFibGUgewoKICBmdW5jdGlvbiBEZXN0cnVjdGlibGUoKSBwdWJsaWMgcGF5YWJsZSB7IH0KCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlcnMgdGhlIGN1cnJlbnQgYmFsYW5jZSB0byB0aGUgb3duZXIgYW5kIHRlcm1pbmF0ZXMgdGhlIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIGRlc3Ryb3koKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgfQoKICBmdW5jdGlvbiBkZXN0cm95QW5kU2VuZChhZGRyZXNzIF9yZWNpcGllbnQpIG9ubHlPd25lciBwdWJsaWMgewogICAgc2VsZmRlc3RydWN0KF9yZWNpcGllbnQpOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgovKioKICogQHRpdGxlIENsYWltYWJsZQogKiBAZGV2IEV4dGVuc2lvbiBmb3IgdGhlIE93bmFibGUgY29udHJhY3QsIHdoZXJlIHRoZSBvd25lcnNoaXAgbmVlZHMgdG8gYmUgY2xhaW1lZC4KICogVGhpcyBhbGxvd3MgdGhlIG5ldyBvd25lciB0byBhY2NlcHQgdGhlIHRyYW5zZmVyLgogKi8KY29udHJhY3QgQ2xhaW1hYmxlIGlzIE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIHBlbmRpbmdPd25lcjsKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0aHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIHBlbmRpbmdPd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5UGVuZGluZ093bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHBlbmRpbmdPd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gc2V0IHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcy4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcGVuZGluZ093bmVyID0gbmV3T3duZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIHRyYW5zZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsYWltT3duZXJzaGlwKCkgb25seVBlbmRpbmdPd25lciBwdWJsaWMgewogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIHBlbmRpbmdPd25lcik7CiAgICBvd25lciA9IHBlbmRpbmdPd25lcjsKICAgIHBlbmRpbmdPd25lciA9IGFkZHJlc3MoMCk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBCdXJuYWJsZSBUb2tlbgogKiBAZGV2IFRva2VuIHRoYXQgY2FuIGJlIGlycmV2ZXJzaWJseSBidXJuZWQgKGRlc3Ryb3llZCkuCiAqLwpjb250cmFjdCBCdXJuYWJsZVRva2VuIGlzIEJhc2ljVG9rZW4gewoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7CgogICAgLyoqCiAgICAgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgYW1vdW50IG9mIHRva2Vucy4KICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSBidXJuZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwogICAgICAgIC8vIG5vIG5lZWQgdG8gcmVxdWlyZSB2YWx1ZSA8PSB0b3RhbFN1cHBseSwgc2luY2UgdGhhdCB3b3VsZCBpbXBseSB0aGUKICAgICAgICAvLyBzZW5kZXIncyBiYWxhbmNlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgdG90YWxTdXBwbHksIHdoaWNoICpzaG91bGQqIGJlIGFuIGFzc2VydGlvbiBmYWlsdXJlCgogICAgICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBiYWxhbmNlc1tidXJuZXJdID0gYmFsYW5jZXNbYnVybmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIEJ1cm4oYnVybmVyLCBfdmFsdWUpOwogICAgfQp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQGRldiBJbmNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gZGVjcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zdWJ0cmFjdGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gZGVjcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgbm90IG93biBFdGhlcgogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJiOGNhZGRkNWRiZDdmODhhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPs+ALmNvbT4KICogQGRldiBUaGlzIHRyaWVzIHRvIGJsb2NrIGluY29taW5nIGV0aGVyIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBsb3NzIG9mIEV0aGVyLiBTaG91bGQgRXRoZXIgZW5kIHVwCiAqIGluIHRoZSBjb250cmFjdCwgaXQgd2lsbCBhbGxvdyB0aGUgb3duZXIgdG8gcmVjbGFpbSB0aGlzIGV0aGVyLgogKiBAbm90aWNlIEV0aGVyIGNhbiBzdGlsbCBiZSBzZW5kIHRvIHRoaXMgY29udHJhY3QgYnk6CiAqIGNhbGxpbmcgZnVuY3Rpb25zIGxhYmVsZWQgYHBheWFibGVgCiAqIGBzZWxmZGVzdHJ1Y3QoY29udHJhY3RfYWRkcmVzcylgCiAqIG1pbmluZyBkaXJlY3RseSB0byB0aGUgY29udHJhY3QgYWRkcmVzcwoqLwpjb250cmFjdCBIYXNOb0V0aGVyIGlzIE93bmFibGUgewoKICAvKioKICAqIEBkZXYgQ29uc3RydWN0b3IgdGhhdCByZWplY3RzIGluY29taW5nIEV0aGVyCiAgKiBAZGV2IFRoZSBgcGF5YWJsZWAgZmxhZyBpcyBhZGRlZCBzbyB3ZSBjYW4gYWNjZXNzIGBtc2cudmFsdWVgIHdpdGhvdXQgY29tcGlsZXIgd2FybmluZy4gSWYgd2UKICAqIGxlYXZlIG91dCBwYXlhYmxlLCB0aGVuIFNvbGlkaXR5IHdpbGwgYWxsb3cgaW5oZXJpdGluZyBjb250cmFjdHMgdG8gaW1wbGVtZW50IGEgcGF5YWJsZQogICogY29uc3RydWN0b3IuIEJ5IGRvaW5nIGl0IHRoaXMgd2F5IHdlIHByZXZlbnQgYSBwYXlhYmxlIGNvbnN0cnVjdG9yIGZyb20gd29ya2luZy4gQWx0ZXJuYXRpdmVseQogICogd2UgY291bGQgdXNlIGFzc2VtYmx5IHRvIGFjY2VzcyBtc2cudmFsdWUuCiAgKi8KICBmdW5jdGlvbiBIYXNOb0V0aGVyKCkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgfQoKICAvKioKICAgKiBAZGV2IERpc2FsbG93cyBkaXJlY3Qgc2VuZCBieSBzZXR0aW5ncyBhIGRlZmF1bHQgZnVuY3Rpb24gd2l0aG91dCB0aGUgYHBheWFibGVgIGZsYWcuCiAgICovCiAgZnVuY3Rpb24oKSBleHRlcm5hbCB7CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIGFsbCBFdGhlciBoZWxkIGJ5IHRoZSBjb250cmFjdCB0byB0aGUgb3duZXIuCiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbUV0aGVyKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGFzc2VydChvd25lci5zZW5kKHRoaXMuYmFsYW5jZSkpOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBEZWxheWVkQ2xhaW1hYmxlCiAqIEBkZXYgRXh0ZW5zaW9uIGZvciB0aGUgQ2xhaW1hYmxlIGNvbnRyYWN0LCB3aGVyZSB0aGUgb3duZXJzaGlwIG5lZWRzIHRvIGJlIGNsYWltZWQgYmVmb3JlL2FmdGVyCiAqIGEgY2VydGFpbiBibG9jayBudW1iZXIuCiAqLwpjb250cmFjdCBEZWxheWVkQ2xhaW1hYmxlIGlzIENsYWltYWJsZSB7CgogIHVpbnQyNTYgcHVibGljIGVuZDsKICB1aW50MjU2IHB1YmxpYyBzdGFydDsKCiAgLyoqCiAgICogQGRldiBVc2VkIHRvIHNwZWNpZnkgdGhlIHRpbWUgcGVyaW9kIGR1cmluZyB3aGljaCBhIHBlbmRpbmcKICAgKiBvd25lciBjYW4gY2xhaW0gb3duZXJzaGlwLgogICAqIEBwYXJhbSBfc3RhcnQgVGhlIGVhcmxpZXN0IHRpbWUgb3duZXJzaGlwIGNhbiBiZSBjbGFpbWVkLgogICAqIEBwYXJhbSBfZW5kIFRoZSBsYXRlc3QgdGltZSBvd25lcnNoaXAgY2FuIGJlIGNsYWltZWQuCiAgICovCiAgZnVuY3Rpb24gc2V0TGltaXRzKHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9lbmQpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShfc3RhcnQgPD0gX2VuZCk7CiAgICBlbmQgPSBfZW5kOwogICAgc3RhcnQgPSBfc3RhcnQ7CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSB0cmFuc2ZlciwgYXMgbG9uZyBhcyBpdCBpcyBjYWxsZWQgd2l0aGluCiAgICogdGhlIHNwZWNpZmllZCBzdGFydCBhbmQgZW5kIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAoKSBvbmx5UGVuZGluZ093bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKChibG9jay5udW1iZXIgPD0gZW5kKSAmJiAoYmxvY2subnVtYmVyID49IHN0YXJ0KSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgcGVuZGluZ093bmVyID0gYWRkcmVzcygwKTsKICAgIGVuZCA9IDA7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgbm90IG93biBDb250cmFjdHMKICogQGF1dGhvciBSZW1jbyBCbG9lbWVuIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYWFkOGNmYzdjOWM1ZWE5OCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT7PgC5jb20+CiAqIEBkZXYgU2hvdWxkIGNvbnRyYWN0cyAoYW55dGhpbmcgT3duYWJsZSkgZW5kIHVwIGJlaW5nIG93bmVkIGJ5IHRoaXMgY29udHJhY3QsIGl0IGFsbG93cyB0aGUgb3duZXIKICogb2YgdGhpcyBjb250cmFjdCB0byByZWNsYWltIG93bmVyc2hpcCBvZiB0aGUgY29udHJhY3RzLgogKi8KY29udHJhY3QgSGFzTm9Db250cmFjdHMgaXMgT3duYWJsZSB7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBvd25lcnNoaXAgb2YgT3duYWJsZSBjb250cmFjdHMKICAgKiBAcGFyYW0gY29udHJhY3RBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBPd25hYmxlIHRvIGJlIHJlY2xhaW1lZC4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBPd25hYmxlIGNvbnRyYWN0SW5zdCA9IE93bmFibGUoY29udHJhY3RBZGRyKTsKICAgIGNvbnRyYWN0SW5zdC50cmFuc2Zlck93bmVyc2hpcChvd25lcik7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBSb2xlcwogKiBAYXV0aG9yIEZyYW5jaXNjbyBHaW9yZGFubyAoQGZyYW5naW8pCiAqIEBkZXYgTGlicmFyeSBmb3IgbWFuYWdpbmcgYWRkcmVzc2VzIGFzc2lnbmVkIHRvIGEgUm9sZS4KICogICAgICBTZWUgUkJBQy5zb2wgZm9yIGV4YW1wbGUgdXNhZ2UuCiAqLwpsaWJyYXJ5IFJvbGVzIHsKICAgIHN0cnVjdCBSb2xlIHsKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGJlYXJlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgZ2l2ZSBhbiBhZGRyZXNzIGFjY2VzcyB0byB0aGlzIHJvbGUKICAgICAqLwogICAgZnVuY3Rpb24gYWRkKFJvbGUgc3RvcmFnZSByb2xlLCBhZGRyZXNzIGFkZHIpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICByb2xlLmJlYXJlclthZGRyXSA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlbW92ZSBhbiBhZGRyZXNzJyBhY2Nlc3MgdG8gdGhpcyByb2xlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZShSb2xlIHN0b3JhZ2Ugcm9sZSwgYWRkcmVzcyBhZGRyKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgcm9sZS5iZWFyZXJbYWRkcl0gPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2hlY2sgaWYgYW4gYWRkcmVzcyBoYXMgdGhpcyByb2xlCiAgICAgKiAvLyByZXZlcnRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrKFJvbGUgc3RvcmFnZSByb2xlLCBhZGRyZXNzIGFkZHIpCiAgICAgICAgdmlldwogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZShoYXMocm9sZSwgYWRkcikpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjaGVjayBpZiBhbiBhZGRyZXNzIGhhcyB0aGlzIHJvbGUKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBmdW5jdGlvbiBoYXMoUm9sZSBzdG9yYWdlIHJvbGUsIGFkZHJlc3MgYWRkcikKICAgICAgICB2aWV3CiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiByb2xlLmJlYXJlclthZGRyXTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgUkJBQyAoUm9sZS1CYXNlZCBBY2Nlc3MgQ29udHJvbCkKICogQGF1dGhvciBNYXR0IENvbmRvbiAoQFNocnVncykKICogQGRldiBTdG9yZXMgYW5kIHByb3ZpZGVzIHNldHRlcnMgYW5kIGdldHRlcnMgZm9yIHJvbGVzIGFuZCBhZGRyZXNzZXMuCiAqICAgICAgU3VwcG9ydHMgdW5saW1pdGVkIG51bWJlcnMgb2Ygcm9sZXMgYW5kIGFkZHJlc3Nlcy4KICogICAgICBTZWUgLy9jb250cmFjdHMvZXhhbXBsZXMvUkJBQ0V4YW1wbGUuc29sIGZvciBhbiBleGFtcGxlIG9mIHVzYWdlLgogKiBUaGlzIFJCQUMgbWV0aG9kIHVzZXMgc3RyaW5ncyB0byBrZXkgcm9sZXMuIEl0IG1heSBiZSBiZW5lZmljaWFsCiAqICBmb3IgeW91IHRvIHdyaXRlIHlvdXIgb3duIGltcGxlbWVudGF0aW9uIG9mIHRoaXMgaW50ZXJmYWNlIHVzaW5nIEVudW1zIG9yIHNpbWlsYXIuCiAqIEl0J3MgYWxzbyByZWNvbW1lbmRlZCB0aGF0IHlvdSBkZWZpbmUgY29uc3RhbnRzIGluIHRoZSBjb250cmFjdCwgbGlrZSBST0xFX0FETUlOIGJlbG93LAogKiAgdG8gYXZvaWQgdHlwb3MuCiAqLwpjb250cmFjdCBSQkFDIHsKICAgIHVzaW5nIFJvbGVzIGZvciBSb2xlcy5Sb2xlOwoKICAgIG1hcHBpbmcgKHN0cmluZyA9PiBSb2xlcy5Sb2xlKSBwcml2YXRlIHJvbGVzOwoKICAgIGV2ZW50IFJvbGVBZGRlZChhZGRyZXNzIGFkZHIsIHN0cmluZyByb2xlTmFtZSk7CiAgICBldmVudCBSb2xlUmVtb3ZlZChhZGRyZXNzIGFkZHIsIHN0cmluZyByb2xlTmFtZSk7CgogICAgLyoqCiAgICAgKiBBIGNvbnN0YW50IHJvbGUgbmFtZSBmb3IgaW5kaWNhdGluZyBhZG1pbnMuCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgUk9MRV9BRE1JTiA9ICJhZG1pbiI7CgogICAgLyoqCiAgICAgKiBAZGV2IGNvbnN0cnVjdG9yLiBTZXRzIG1zZy5zZW5kZXIgYXMgYWRtaW4gYnkgZGVmYXVsdAogICAgICovCiAgICBmdW5jdGlvbiBSQkFDKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBhZGRSb2xlKG1zZy5zZW5kZXIsIFJPTEVfQURNSU4pOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBhZGQgYSByb2xlIHRvIGFuIGFkZHJlc3MKICAgICAqIEBwYXJhbSBhZGRyIGFkZHJlc3MKICAgICAqIEBwYXJhbSByb2xlTmFtZSB0aGUgbmFtZSBvZiB0aGUgcm9sZQogICAgICovCiAgICBmdW5jdGlvbiBhZGRSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgcm9sZXNbcm9sZU5hbWVdLmFkZChhZGRyKTsKICAgICAgICBSb2xlQWRkZWQoYWRkciwgcm9sZU5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZW1vdmUgYSByb2xlIGZyb20gYW4gYWRkcmVzcwogICAgICogQHBhcmFtIGFkZHIgYWRkcmVzcwogICAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZVJvbGUoYWRkcmVzcyBhZGRyLCBzdHJpbmcgcm9sZU5hbWUpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICByb2xlc1tyb2xlTmFtZV0ucmVtb3ZlKGFkZHIpOwogICAgICAgIFJvbGVSZW1vdmVkKGFkZHIsIHJvbGVOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgcmV2ZXJ0cyBpZiBhZGRyIGRvZXMgbm90IGhhdmUgcm9sZQogICAgICogQHBhcmFtIGFkZHIgYWRkcmVzcwogICAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICAgKiAvLyByZXZlcnRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrUm9sZShhZGRyZXNzIGFkZHIsIHN0cmluZyByb2xlTmFtZSkKICAgICAgICAvLyB2aWV3CiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcm9sZXNbcm9sZU5hbWVdLmNoZWNrKGFkZHIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBkZXRlcm1pbmUgaWYgYWRkciBoYXMgcm9sZQogICAgICogQHBhcmFtIGFkZHIgYWRkcmVzcwogICAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgZnVuY3Rpb24gaGFzUm9sZShhZGRyZXNzIGFkZHIsIHN0cmluZyByb2xlTmFtZSkKICAgICAgICB2aWV3CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gcm9sZXNbcm9sZU5hbWVdLmhhcyhhZGRyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYWRkIGEgcm9sZSB0byBhbiBhZGRyZXNzCiAgICAgKiBAcGFyYW0gYWRkciBhZGRyZXNzCiAgICAgKiBAcGFyYW0gcm9sZU5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvbGUKICAgICAqLwogICAgZnVuY3Rpb24gYWRtaW5BZGRSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgICAgIG9ubHlBZG1pbgogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGFkZFJvbGUoYWRkciwgcm9sZU5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZW1vdmUgYSByb2xlIGZyb20gYW4gYWRkcmVzcwogICAgICogQHBhcmFtIGFkZHIgYWRkcmVzcwogICAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkbWluUmVtb3ZlUm9sZShhZGRyZXNzIGFkZHIsIHN0cmluZyByb2xlTmFtZSkKICAgICAgICBvbmx5QWRtaW4KICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZW1vdmVSb2xlKGFkZHIsIHJvbGVOYW1lKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IG1vZGlmaWVyIHRvIHNjb3BlIGFjY2VzcyB0byBhIHNpbmdsZSByb2xlICh1c2VzIG1zZy5zZW5kZXIgYXMgYWRkcikKICAgICAqIEBwYXJhbSByb2xlTmFtZSB0aGUgbmFtZSBvZiB0aGUgcm9sZQogICAgICogLy8gcmV2ZXJ0cwogICAgICovCiAgICBtb2RpZmllciBvbmx5Um9sZShzdHJpbmcgcm9sZU5hbWUpCiAgICB7CiAgICAgICAgY2hlY2tSb2xlKG1zZy5zZW5kZXIsIHJvbGVOYW1lKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBzY29wZSBhY2Nlc3MgdG8gYWRtaW5zCiAgICAgKiAvLyByZXZlcnRzCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpCiAgICB7CiAgICAgICAgY2hlY2tSb2xlKG1zZy5zZW5kZXIsIFJPTEVfQURNSU4pOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IG1vZGlmaWVyIHRvIHNjb3BlIGFjY2VzcyB0byBhIHNldCBvZiByb2xlcyAodXNlcyBtc2cuc2VuZGVyIGFzIGFkZHIpCiAgICAgKiBAcGFyYW0gcm9sZU5hbWVzIHRoZSBuYW1lcyBvZiB0aGUgcm9sZXMgdG8gc2NvcGUgYWNjZXNzIHRvCiAgICAgKiAvLyByZXZlcnRzCiAgICAgKgogICAgICogQFRPRE8gLSB3aGVuIHNvbGlkaXR5IHN1cHBvcnRzIGR5bmFtaWMgYXJyYXlzIGFzIGFyZ3VtZW50cyB0byBtb2RpZmllcnMsIHByb3ZpZGUgdGhpcwogICAgICogIHNlZTogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL3NvbGlkaXR5L2lzc3Vlcy8yNDY3CiAgICAgKi8KICAgIC8vIG1vZGlmaWVyIG9ubHlSb2xlcyhzdHJpbmdbXSByb2xlTmFtZXMpIHsKICAgIC8vICAgICBib29sIGhhc0FueVJvbGUgPSBmYWxzZTsKICAgIC8vICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgcm9sZU5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAvLyAgICAgICAgIGlmIChoYXNSb2xlKG1zZy5zZW5kZXIsIHJvbGVOYW1lc1tpXSkpIHsKICAgIC8vICAgICAgICAgICAgIGhhc0FueVJvbGUgPSB0cnVlOwogICAgLy8gICAgICAgICAgICAgYnJlYWs7CiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICB9CgogICAgLy8gICAgIHJlcXVpcmUoaGFzQW55Um9sZSk7CgogICAgLy8gICAgIF87CiAgICAvLyB9Cn0KCi8qKgogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gVG9rZW5zCiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjBkN2Y2ODYwNmU2MjRkM2YiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+z4AuY29tPgogKiBAZGV2IFRoaXMgYmxvY2tzIGluY29taW5nIEVSQzIzIHRva2VucyB0byBwcmV2ZW50IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuCiAqIFNob3VsZCB0b2tlbnMgKGFueSBFUkMyMEJhc2ljIGNvbXBhdGlibGUpIGVuZCB1cCBpbiB0aGUgY29udHJhY3QsIGl0IGFsbG93cyB0aGUKICogb3duZXIgdG8gcmVjbGFpbSB0aGUgdG9rZW5zLgogKi8KY29udHJhY3QgSGFzTm9Ub2tlbnMgaXMgQ2FuUmVjbGFpbVRva2VuIHsKCiAvKioKICAqIEBkZXYgUmVqZWN0IGFsbCBFUkMyMyBjb21wYXRpYmxlIHRva2VucwogICogQHBhcmFtIGZyb21fIGFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCBpcyB0cmFuc2ZlcnJpbmcgdGhlIHRva2VucwogICogQHBhcmFtIHZhbHVlXyB1aW50MjU2IHRoZSBhbW91bnQgb2YgdGhlIHNwZWNpZmllZCB0b2tlbgogICogQHBhcmFtIGRhdGFfIEJ5dGVzIFRoZSBkYXRhIHBhc3NlZCBmcm9tIHRoZSBjYWxsZXIuCiAgKi8KICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgZnJvbV8sIHVpbnQyNTYgdmFsdWVfLCBieXRlcyBkYXRhXykgZXh0ZXJuYWwgewogICAgZnJvbV87CiAgICB2YWx1ZV87CiAgICBkYXRhXzsKICAgIHJldmVydCgpOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgQ29udGFjdGFibGUgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIGEgY29udGFjdGFibGUgY29udHJhY3QsIGFsbG93aW5nIHRoZSBvd25lciB0byBwcm92aWRlIGEgc3RyaW5nIHdpdGggdGhlaXIKICogY29udGFjdCBpbmZvcm1hdGlvbi4KICovCmNvbnRyYWN0IENvbnRhY3RhYmxlIGlzIE93bmFibGV7CgogICAgc3RyaW5nIHB1YmxpYyBjb250YWN0SW5mb3JtYXRpb247CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgb3duZXIgdG8gc2V0IGEgc3RyaW5nIHdpdGggdGhlaXIgY29udGFjdCBpbmZvcm1hdGlvbi4KICAgICAqIEBwYXJhbSBpbmZvIFRoZSBjb250YWN0IGluZm9ybWF0aW9uIHRvIGF0dGFjaCB0byB0aGUgY29udHJhY3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnRhY3RJbmZvcm1hdGlvbihzdHJpbmcgaW5mbykgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgIGNvbnRhY3RJbmZvcm1hdGlvbiA9IGluZm87CiAgICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBjb250cmFjdHMgdGhhdCBzaG91bGQgbm90IG93biB0aGluZ3MuCiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjEzNjE3NjdlNzA3YzUzMjEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+z4AuY29tPgogKiBAZGV2IFNvbHZlcyBhIGNsYXNzIG9mIGVycm9ycyB3aGVyZSBhIGNvbnRyYWN0IGFjY2lkZW50YWxseSBiZWNvbWVzIG93bmVyIG9mIEV0aGVyLCBUb2tlbnMgb3IKICogT3duZWQgY29udHJhY3RzLiBTZWUgcmVzcGVjdGl2ZSBiYXNlIGNvbnRyYWN0cyBmb3IgZGV0YWlscy4KICovCmNvbnRyYWN0IE5vT3duZXIgaXMgSGFzTm9FdGhlciwgSGFzTm9Ub2tlbnMsIEhhc05vQ29udHJhY3RzIHsKfQoKCgoKLyoqCiAqIEB0aXRsZSBTaW1wbGVUb2tlbgogKiBAZGV2IFZlcnkgc2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdoZXJlIGFsbCB0b2tlbnMgYXJlIHByZS1hc3NpZ25lZCB0byB0aGUgY3JlYXRvci4KICogTm90ZSB0aGV5IGNhbiBsYXRlciBkaXN0cmlidXRlIHRoZXNlIHRva2VucyBhcyB0aGV5IHdpc2ggdXNpbmcgYHRyYW5zZmVyYCBhbmQgb3RoZXIKICogYFN0YW5kYXJkVG9rZW5gIGZ1bmN0aW9ucy4KICovCmNvbnRyYWN0IFNpbXBsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiU2ltcGxlVG9rZW4iOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlNJTSI7CiAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElOSVRJQUxfU1VQUExZID0gMTAwMDAgKiAoMTAgKiogdWludDI1NihkZWNpbWFscykpOwoKICAvKioKICAgKiBAZGV2IENvbnN0cnVjdG9yIHRoYXQgZ2l2ZXMgbXNnLnNlbmRlciBhbGwgb2YgZXhpc3RpbmcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIFNpbXBsZVRva2VuKCkgcHVibGljIHsKICAgIHRvdGFsU3VwcGx5ID0gSU5JVElBTF9TVVBQTFk7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IElOSVRJQUxfU1VQUExZOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgUGF1c2FibGUgdG9rZW4KICoKICogQGRldiBTdGFuZGFyZFRva2VuIG1vZGlmaWVkIHdpdGggcGF1c2FibGUgdHJhbnNmZXJzLgogKiovCgpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgTWlncmF0aW9ucwogKiBAZGV2IFRoaXMgaXMgYSB0cnVmZmxlIGNvbnRyYWN0LCBuZWVkZWQgZm9yIHRydWZmbGUgaW50ZWdyYXRpb24sIG5vdCBtZWFudCBmb3IgdXNlIGJ5IFplcHBlbGluIHVzZXJzLgogKi8KY29udHJhY3QgTWlncmF0aW9ucyBpcyBPd25hYmxlIHsKICB1aW50MjU2IHB1YmxpYyBsYXN0Q29tcGxldGVkTWlncmF0aW9uOwoKICBmdW5jdGlvbiBzZXRDb21wbGV0ZWQodWludDI1NiBjb21wbGV0ZWQpIG9ubHlPd25lciBwdWJsaWMgewogICAgbGFzdENvbXBsZXRlZE1pZ3JhdGlvbiA9IGNvbXBsZXRlZDsKICB9CgogIGZ1bmN0aW9uIHVwZ3JhZGUoYWRkcmVzcyBuZXdBZGRyZXNzKSBvbmx5T3duZXIgcHVibGljIHsKICAgIE1pZ3JhdGlvbnMgdXBncmFkZWQgPSBNaWdyYXRpb25zKG5ld0FkZHJlc3MpOwogICAgdXBncmFkZWQuc2V0Q29tcGxldGVkKGxhc3RDb21wbGV0ZWRNaWdyYXRpb24pOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgVG9rZW5EZXN0cnVjdGlibGU6CiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjJmNWQ0YTQyNGM0MDZmMWQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+z4AuY29tPgogKiBAZGV2IEJhc2UgY29udHJhY3QgdGhhdCBjYW4gYmUgZGVzdHJveWVkIGJ5IG93bmVyLiBBbGwgZnVuZHMgaW4gY29udHJhY3QgaW5jbHVkaW5nCiAqIGxpc3RlZCB0b2tlbnMgd2lsbCBiZSBzZW50IHRvIHRoZSBvd25lci4KICovCmNvbnRyYWN0IFRva2VuRGVzdHJ1Y3RpYmxlIGlzIE93bmFibGUgewoKICBmdW5jdGlvbiBUb2tlbkRlc3RydWN0aWJsZSgpIHB1YmxpYyBwYXlhYmxlIHsgfQoKICAvKioKICAgKiBAbm90aWNlIFRlcm1pbmF0ZSBjb250cmFjdCBhbmQgcmVmdW5kIHRvIG93bmVyCiAgICogQHBhcmFtIHRva2VucyBMaXN0IG9mIGFkZHJlc3NlcyBvZiBFUkMyMCBvciBFUkMyMEJhc2ljIHRva2VuIGNvbnRyYWN0cyB0bwogICByZWZ1bmQuCiAgICogQG5vdGljZSBUaGUgY2FsbGVkIHRva2VuIGNvbnRyYWN0cyBjb3VsZCB0cnkgdG8gcmUtZW50ZXIgdGhpcyBjb250cmFjdC4gT25seQogICBzdXBwbHkgdG9rZW4gY29udHJhY3RzIHlvdSB0cnVzdC4KICAgKi8KICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3NbXSB0b2tlbnMpIG9ubHlPd25lciBwdWJsaWMgewoKICAgIC8vIFRyYW5zZmVyIHRva2VucyB0byBvd25lcgogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKICAgICAgRVJDMjBCYXNpYyB0b2tlbiA9IEVSQzIwQmFzaWModG9rZW5zW2ldKTsKICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgICB9CgogICAgLy8gVHJhbnNmZXIgRXRoIHRvIG93bmVyIGFuZCB0ZXJtaW5hdGUgY29udHJhY3QKICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwoKY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBDYXBwZWQgdG9rZW4KICogQGRldiBNaW50YWJsZSB0b2tlbiB3aXRoIGEgdG9rZW4gY2FwLgogKi8KCmNvbnRyYWN0IENhcHBlZFRva2VuIGlzIE1pbnRhYmxlVG9rZW4gewoKICB1aW50MjU2IHB1YmxpYyBjYXA7CgogIGZ1bmN0aW9uIENhcHBlZFRva2VuKHVpbnQyNTYgX2NhcCkgcHVibGljIHsKICAgIHJlcXVpcmUoX2NhcCA+IDApOwogICAgY2FwID0gX2NhcDsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KSA8PSBjYXApOwoKICAgIHJldHVybiBzdXBlci5taW50KF90bywgX2Ftb3VudCk7CiAgfQoKfQoKCi8vIEB0aXRsZSBGb3JjZSBFdGhlciBpbnRvIGEgY29udHJhY3QuCi8vIEBub3RpY2UgIGV2ZW4KLy8gaWYgdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXlhYmxlLgovLyBAbm90aWNlIFRvIHVzZSwgY29uc3RydWN0IHRoZSBjb250cmFjdCB3aXRoIHRoZSB0YXJnZXQgYXMgYXJndW1lbnQuCi8vIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjA5N2I2YzY0NmE2NjQ5Njc2YzdjNmY3YzY3NmQyNzY2N2I2ZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CmNvbnRyYWN0IEZvcmNlRXRoZXIgIHsKCiAgZnVuY3Rpb24gRm9yY2VFdGhlcigpIHB1YmxpYyBwYXlhYmxlIHsgfQoKICBmdW5jdGlvbiBkZXN0cm95QW5kU2VuZChhZGRyZXNzIF9yZWNpcGllbnQpIHB1YmxpYyB7CiAgICBzZWxmZGVzdHJ1Y3QoX3JlY2lwaWVudCk7CiAgfQp9CgppbnRlcmZhY2UgR2F0ZXdheSB7CglmdW5jdGlvbiBvcGVuKHVpbnQgX2ludHJvSWQsIHVpbnQgX2JpZCwgdWludCBfY3JlYXRpb25UaW1lLCBzdHJpbmcgX2hhc2hlZEluZm8pIHB1YmxpYzsKCWZ1bmN0aW9uIGFjY2VwdCh1aW50IF9pbnRyb0lkLCBhZGRyZXNzIF9hbWJhc3NhZG9yLCB1aW50IF91cGRhdGVUaW1lKSBwdWJsaWM7CglmdW5jdGlvbiBlbmRvcnNlKHVpbnQgX2ludHJvSWQsIHVpbnQgX3VwZGF0ZVRpbWUpIHB1YmxpYzsKCWZ1bmN0aW9uIGRpc3B1dGUodWludCBfaW50cm9JZCwgdWludCBfdXBkYXRlVGltZSkgcHVibGljOwoJZnVuY3Rpb24gd2l0aGRyYXcodWludCBfaW50cm9JZCwgdWludCBfdXBkYXRlVGltZSkgcHVibGljOwoJZnVuY3Rpb24gcmVzb2x2ZSh1aW50IF9pbnRyb0lkLCB1aW50IF91cGRhdGVUaW1lLCBzdHJpbmcgX3Jlc29sdXRpb24sIGJvb2wgX2lzU3BhbSkgcHVibGljOwp9CgppbnRlcmZhY2UgU2NvcmUgewoJZnVuY3Rpb24gc2V0U2NvcmUoYWRkcmVzcyB1c2VyLCB1aW50IHNjb3JlKSBwdWJsaWM7CglmdW5jdGlvbiBnZXRTY29yZShhZGRyZXNzIHVzZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgc2NvcmUpOwoJZnVuY3Rpb24gc2NvcmVEb3duKGFkZHJlc3MgdXNlcikgcHVibGljIHJldHVybnMgKGJvb2wgcmVzKTsKCWZ1bmN0aW9uIHNjb3JlVXAoYWRkcmVzcyB1c2VyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCByZXMpOwp9CgppbnRlcmZhY2UgU2hhcmUgewoJZnVuY3Rpb24gcm9sbG91dERpdmlkZW5kcyhhZGRyZXNzIHJlY2VpdmVyKSBwdWJsaWM7CglmdW5jdGlvbiBkaXN0cmlidXRlRGl2aWRlbmRzKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5zUGVyU2hhcmUpIHB1YmxpYzsKfQoKY29udHJhY3QgSW5ib3RQcm94eSBpcyBSQkFDLCBQYXVzYWJsZSB7CglNaW50YWJsZVRva2VuCXRva2VuOwoJTWludGFibGVUb2tlbglzaGFyZTsKCVNjb3JlIAkJCXNjb3JlOwoJR2F0ZXdheSAJCWdhdGV3YXk7CgoJZnVuY3Rpb24gSW5ib3RQcm94eSgKCQlhZGRyZXNzIF90b2tlbiwgCgkJYWRkcmVzcyBfc2hhcmUsIAoJCWFkZHJlc3MgX3Njb3JlLCAKCQlhZGRyZXNzIF9nYXRld2F5CgkpIHB1YmxpYyAKCXsKCQl0b2tlbiA9IE1pbnRhYmxlVG9rZW4oX3Rva2VuKTsKCQlzaGFyZSA9IE1pbnRhYmxlVG9rZW4oX3NoYXJlKTsKCQlzY29yZSA9IFNjb3JlKF9zY29yZSk7CgkJZ2F0ZXdheSA9IEdhdGV3YXkoX2dhdGV3YXkpOwoJfQoKCWZ1bmN0aW9uIHNldFRva2VuKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUFkbWluIHsKCQl0b2tlbiA9IE1pbnRhYmxlVG9rZW4oX3Rva2VuKTsKCX0KCglmdW5jdGlvbiBnZXRUb2tlbigpIHdoZW5Ob3RQYXVzZWQgcHVibGljIHZpZXcgcmV0dXJucyAoTWludGFibGVUb2tlbikgewoJCXJldHVybiB0b2tlbjsKCX0KCglmdW5jdGlvbiBzZXRTaGFyZShhZGRyZXNzIF9zaGFyZSkgcHVibGljIG9ubHlBZG1pbiB7CgkJc2hhcmUgPSBNaW50YWJsZVRva2VuKF9zaGFyZSk7Cgl9CgoJZnVuY3Rpb24gZ2V0U2hhcmUoKSB3aGVuTm90UGF1c2VkIHB1YmxpYyB2aWV3IHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKCQlyZXR1cm4gc2hhcmU7Cgl9CgoJZnVuY3Rpb24gc2V0U2NvcmUoYWRkcmVzcyBfc2NvcmUpIHB1YmxpYyBvbmx5QWRtaW4gewoJCXNjb3JlID0gU2NvcmUoX3Njb3JlKTsKCX0KCglmdW5jdGlvbiBnZXRTY29yZSgpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHZpZXcgcmV0dXJucyAoU2NvcmUpIHsKCQlyZXR1cm4gc2NvcmU7Cgl9CgoJZnVuY3Rpb24gc2V0R2F0ZXdheShhZGRyZXNzIF9nYXRld2F5KSBwdWJsaWMgb25seUFkbWluIHsKCQlnYXRld2F5ID0gR2F0ZXdheShfZ2F0ZXdheSk7Cgl9CgoJZnVuY3Rpb24gZ2V0Z2F0ZXdheSgpIHdoZW5Ob3RQYXVzZWQgcHVibGljIHZpZXcgcmV0dXJucyAoR2F0ZXdheSkgewoJCXJldHVybiBnYXRld2F5OwoJfQp9Cgpjb250cmFjdCBJbmJvdENvbnRyb2xsZWQgaXMgUkJBQyB7CiAgICAvKioKICAgICAqIEEgY29uc3RhbnQgcm9sZSBuYW1lIGZvciBpbmRpY2F0aW5nIHZlbmRvci4KICAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBST0xFX1ZFTkRPUiA9ICJ2ZW5kb3IiOwp9Cgpjb250cmFjdCBJbmJvdENvbnRyYWN0IGlzIEluYm90Q29udHJvbGxlZCwgVG9rZW5EZXN0cnVjdGlibGUsIENhblJlY2xhaW1Ub2tlbiwgUGF1c2FibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgV0FEID0gMTAqKjE4OwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgUkFZID0gMTAqKjI3OwogICAgSW5ib3RQcm94eSBwdWJsaWMgcHJveHk7CgogICAgbW9kaWZpZXIgcHJveHlFeGlzdHMoKSB7CiAgICAgICAgcmVxdWlyZShwcm94eSAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UHJveHkoYWRkcmVzcyBfcHJveHkpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHByb3h5ID0gSW5ib3RQcm94eShfcHJveHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbigpIHB1YmxpYyBwcm94eUV4aXN0cyBvbmx5T3duZXIgewogICAgICAgIHRoaXMucmVjbGFpbVRva2VuKHByb3h5LmdldFRva2VuKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljIG9ubHlBZG1pbiB3aGVuTm90UGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIFBhdXNlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5QWRtaW4gd2hlblBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUodWludCBfdGltZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHQpIHsKICAgICAgICByZXR1cm4gX3RpbWUgPT0gMCA/IG5vdyA6IF90aW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CgogICAgZnVuY3Rpb24gbWF4KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KCiAgICBmdW5jdGlvbiB3bXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSB4Lm11bCh5KS5hZGQoV0FELmRpdigyKSkuZGl2KFdBRCk7CiAgICB9CgogICAgZnVuY3Rpb24gcm11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0geC5tdWwoeSkuYWRkKFJBWS5kaXYoMikpLmRpdihSQVkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IHgubXVsKFdBRCkuYWRkKHkuZGl2KDIpKS5kaXYoeSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmRpdih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0geC5tdWwoUkFZKS5hZGQoeS5kaXYoMikpLmRpdih5KTsKICAgIH0KfQovKioKICogQHRpdGxlIENvbnRyYWN0IHRoYXQgd2lsbCB3b3JrIHdpdGggRVJDMjIzIHRva2Vucy4KICovCmNvbnRyYWN0IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHsKCWV2ZW50IFRva2VuUmVjZWl2ZWQoYWRkcmVzcyBpbmRleGVkIGZyb20sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpOwoJLyoqCgkgKiBAZGV2IFN0YW5kYXJkIEVSQzIyMyBmdW5jdGlvbiB0aGF0IHdpbGwgaGFuZGxlIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KCSAqCgkgKiBAcGFyYW0gX2Zyb20gIFRva2VuIHNlbmRlciBhZGRyZXNzLgoJICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zLgoJICogQHBhcmFtIF9kYXRhICBUcmFuc2FjdGlvbiBtZXRhZGF0YS4KCSAqLwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQoKIC8qKgogKiBAdGl0bGUgQmFzZSBDb250cmFjdCB0aGF0IHdpbGwgSW5Ub2tlbiBhbmQgSW5TaGFyZSBpbmhlcml0LgogKi8KY29udHJhY3QgSW5ib3RUb2tlbiBpcyBJbmJvdENvbnRyYWN0LCBNaW50YWJsZVRva2VuLCBCdXJuYWJsZVRva2VuLCBQYXVzYWJsZVRva2VuLCBEZXRhaWxlZEVSQzIwIHsKCWV2ZW50IEluYm90VG9rZW5UcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKTsKCglmdW5jdGlvbiBJbmJvdFRva2VuIChzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpIERldGFpbGVkRVJDMjAoX25hbWUsIF9zeW1ib2wsIF9kZWNpbWFscykgcHVibGljIHsKCX0KCglmdW5jdGlvbiBjYWxsVG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CgkJdWludCBjb2RlTGVuZ3RoOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5IC4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICBpZihjb2RlTGVuZ3RoID4gMCkgewogICAgICAgICAgICBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0KF90byk7CiAgICAgICAgICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2soX2Zyb20sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KCiAgICAgICAgSW5ib3RUb2tlblRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSogQGRldiBGdW5jdGlvbiB3aGljaCBhbGxvd3MgdG8gbWludCB0b2tlbnMgZnJvbSBhbm90aGVyICJhZG1pbiIgYWRkcmVzcy4gCgkqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCgkqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCgkqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCgkqLwoJZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seUFkbWluIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewoJCS8vIFRPRE86IGEgaG9vayB0byBhbGxvdyBvdGhlciBjb250cmFjdHMgY2FsbCAibWludCIgd2l0aG91dCBhcHBseWluZyBwYXJlbnQgbW9kaWZpZXJzCgkJdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CgkJYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwoJCU1pbnQoX3RvLCBfYW1vdW50KTsKCQlUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJKiBAZGV2IFRyYW5zZmVyIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIEVSQzIyMyBjb21wbGlhbnQgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KCSogQHBhcmFtIF9mcm9tIAlUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBmcm9tLgoJKiBAcGFyYW0gX3RvIAlUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KCSogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgoJKiBAcGFyYW0gX2RhdGEgIFRyYW5zYWN0aW9uIG1ldGFkYXRhLgoJKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgoJKi8KCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CgkJYXNzZXJ0KHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpKTsKCQlyZXR1cm4gY2FsbFRva2VuRmFsbGJhY2soX2Zyb20sIF90bywgX3ZhbHVlLCBfZGF0YSk7Cgl9CgoJLyoqCgkqIEBkZXYgVHJhbnNmZXIgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgRVJDMjIzIGNvbXBsaWFudCB0b2tlbnMgdG8gdGhlIHNwZWNpZmllZCBhZGRyZXNzLgoJKiBAcGFyYW0gX2Zyb20gCVRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIGZyb20uCgkqIEBwYXJhbSBfdG8gCVRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgoJKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCgkqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCgkqLwoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewoJCWJ5dGVzIG1lbW9yeSBlbXB0eTsKCQlyZXR1cm4gdHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSwgZW1wdHkpOwoJfQoKCS8qKgoJKiBAZGV2IFRyYW5zZmVyIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIEVSQzIyMyBjb21wbGlhbnQgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KCSogQHBhcmFtIF90byAJVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCgkqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KCSogQHBhcmFtIF9kYXRhICBUcmFuc2FjdGlvbiBtZXRhZGF0YS4KCSogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KCSovCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CgkJYXNzZXJ0KHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKSk7CgkJcmV0dXJuIGNhbGxUb2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7Cgl9CgoJLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIEVSQzIyMyBjb21wbGlhbnQgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAqICAgICAgCiAgICAgKiBAcGFyYW0gX3RvICAgIFJlY2VpdmVyIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkLgogICAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGVtcHR5OwoJCXJldHVybiB0cmFuc2ZlcihfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgfQp9IAovKiogCiAqIEB0aXRsZSBJblRva2VuIChJbmJvdCBUb2tlbikgY29udHJhY3QuIAoqLwpjb250cmFjdCBJblRva2VuIGlzIEluYm90VG9rZW4oIkluVG9rZW4iLCAiSU4iLCAxOCkgewoJdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX1NVUFBMWSA9IDEzKlJBWTsKCglmdW5jdGlvbiBJblRva2VuKCkgcHVibGljIHsKCX0KCgkvKioKCSogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucyB1cHBlciBsaW1pdGVkIGJ5IE1BWF9TVVBQTFkuCgkqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCgkqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCgkqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCgkqLwoJZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5QWRtaW4gY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUodG90YWxTdXBwbHkuYWRkKF9hbW91bnQpIDw9IE1BWF9TVVBQTFkpOwoKCQlyZXR1cm4gc3VwZXIubWludChfdG8sIF9hbW91bnQpOwoJfQoJCn0='.
	

]
