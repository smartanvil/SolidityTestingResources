Class {
	#name : #SRT8f00458479ea850f584ed82881421f9d9eac6cb1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT8f00458479ea850f584ed82881421f9d9eac6cb1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE1hdGgKICogQGRldiBBc3NvcnRlZCBtYXRoIG9wZXJhdGlvbnMKICovCgpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuIAogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIAogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCgovKioKICogQHRpdGxlIExpbWl0ZWRUcmFuc2ZlclRva2VuCiAqIEBkZXYgTGltaXRlZFRyYW5zZmVyVG9rZW4gZGVmaW5lcyB0aGUgZ2VuZXJpYyBpbnRlcmZhY2UgYW5kIHRoZSBpbXBsZW1lbnRhdGlvbiB0byBsaW1pdCB0b2tlbgogKiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGRpZmZlcmVudCBldmVudHMuIEl0IGlzIGludGVuZGVkIHRvIGJlIHVzZWQgYXMgYSBiYXNlIGNsYXNzIGZvciBvdGhlciB0b2tlbgogKiBjb250cmFjdHMuCiAqIExpbWl0ZWRUcmFuc2ZlclRva2VuIGhhcyBiZWVuIGRlc2lnbmVkIHRvIGFsbG93IGZvciBkaWZmZXJlbnQgbGltaXRpbmcgZmFjdG9ycywKICogdGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgcmVjdXJzaXZlbHkgY2FsbGluZyBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoKSB1bnRpbCB0aGUgYmFzZSBjbGFzcyBpcwogKiBoaXQuIEZvciBleGFtcGxlOgogKiAgICAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICogICAgICAgcmV0dXJuIG1pbjI1Nih1bmxvY2tlZFRva2Vucywgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogKiAgICAgfQogKiBBIHdvcmtpbmcgZXhhbXBsZSBpcyBWZXN0ZWRUb2tlbi5zb2w6CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL3Rva2VuL1Zlc3RlZFRva2VuLnNvbAogKi8KCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsKCiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cy4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7CiAgIHJlcXVpcmUoX3ZhbHVlIDw9IHRyYW5zZmVyYWJsZVRva2Vucyhfc2VuZGVyLCB1aW50NjQobm93KSkpOwogICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLgogICAqIEBkZXYgT3ZlcndyaXRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZQogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgVmVzdGVkIHRva2VuCiAqIEBkZXYgVG9rZW5zIHRoYXQgY2FuIGJlIHZlc3RlZCBmb3IgYSBncm91cCBvZiBhZGRyZXNzZXMuCiAqLwpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CgogIHVpbnQyNTYgTUFYX0dSQU5UU19QRVJfQUREUkVTUyA9IDIwOwoKICBzdHJ1Y3QgVG9rZW5HcmFudCB7CiAgICBhZGRyZXNzIGdyYW50ZXI7ICAgICAvLyAyMCBieXRlcwogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMKICAgIHVpbnQ2NCBjbGlmZjsKICAgIHVpbnQ2NCB2ZXN0aW5nOwogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcwogICAgYm9vbCByZXZva2FibGU7CiAgICBib29sIGJ1cm5zT25SZXZva2U7ICAvLyAyICogMSA9IDIgYml0cz8gb3IgMiBieXRlcz8KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7CgogIGV2ZW50IE5ld1Rva2VuR3JhbnQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgdWludDI1NiBncmFudElkKTsKCiAgLyoqCiAgICogQGRldiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgZ3JhbnRlZCB0by4KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgKiBAcGFyYW0gX3N0YXJ0IHVpbnQ2NCBUaW1lIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50LgogICAqIEBwYXJhbSBfY2xpZmYgdWludDY0IFRpbWUgb2YgdGhlIGNsaWZmIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBncmFudFZlc3RlZFRva2VucygKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdmFsdWUsCiAgICB1aW50NjQgX3N0YXJ0LAogICAgdWludDY0IF9jbGlmZiwKICAgIHVpbnQ2NCBfdmVzdGluZywKICAgIGJvb2wgX3Jldm9rYWJsZSwKICAgIGJvb2wgX2J1cm5zT25SZXZva2UKICApIHB1YmxpYyB7CgogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3IKICAgIHJlcXVpcmUoX2NsaWZmID49IF9zdGFydCAmJiBfdmVzdGluZyA+PSBfY2xpZmYpOwoKICAgIHJlcXVpcmUodG9rZW5HcmFudHNDb3VudChfdG8pIDwgTUFYX0dSQU5UU19QRVJfQUREUkVTUyk7ICAgLy8gVG8gcHJldmVudCBhIHVzZXIgYmVpbmcgc3BhbW1lZCBhbmQgaGF2ZSBoaXMgYmFsYW5jZSBsb2NrZWQgKG91dCBvZiBnYXMgYXR0YWNrIHdoZW4gY2FsY3VsYXRpbmcgdmVzdGluZykuCgogICAgdWludDI1NiBjb3VudCA9IGdyYW50c1tfdG9dLnB1c2goCiAgICAgICAgICAgICAgICBUb2tlbkdyYW50KAogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlID8gbXNnLnNlbmRlciA6IDAsIC8vIGF2b2lkIHN0b3JpbmcgYW4gZXh0cmEgMjAgYnl0ZXMgd2hlbiBpdCBpcyBub24tcmV2b2thYmxlCiAgICAgICAgICAgICAgICAgIF92YWx1ZSwKICAgICAgICAgICAgICAgICAgX2NsaWZmLAogICAgICAgICAgICAgICAgICBfdmVzdGluZywKICAgICAgICAgICAgICAgICAgX3N0YXJ0LAogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlLAogICAgICAgICAgICAgICAgICBfYnVybnNPblJldm9rZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICk7CgogICAgdHJhbnNmZXIoX3RvLCBfdmFsdWUpOwoKICAgIE5ld1Rva2VuR3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGNvdW50IC0gMSk7CiAgfQoKICAvKioKICAgKiBAZGV2IFJldm9rZSB0aGUgZ3JhbnQgb2YgdG9rZW5zIG9mIGEgc3BlY2lmZWQgYWRkcmVzcy4KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLgogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50LgogICAqLwogIGZ1bmN0aW9uIHJldm9rZVRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9ncmFudElkKSBwdWJsaWMgewogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CgogICAgcmVxdWlyZShncmFudC5yZXZva2FibGUpOwogICAgcmVxdWlyZShncmFudC5ncmFudGVyID09IG1zZy5zZW5kZXIpOyAvLyBPbmx5IGdyYW50ZXIgY2FuIHJldm9rZSBpdAoKICAgIGFkZHJlc3MgcmVjZWl2ZXIgPSBncmFudC5idXJuc09uUmV2b2tlID8gMHhkZWFkIDogbXNnLnNlbmRlcjsKCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IG5vblZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwoKICAgIC8vIHJlbW92ZSBncmFudCBmcm9tIGFycmF5CiAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKICAgIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF0gPSBncmFudHNbX2hvbGRlcl1bZ3JhbnRzW19ob2xkZXJdLmxlbmd0aC5zdWIoMSldOwogICAgZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCAtPSAxOwoKICAgIGJhbGFuY2VzW3JlY2VpdmVyXSA9IGJhbGFuY2VzW3JlY2VpdmVyXS5hZGQobm9uVmVzdGVkKTsKICAgIGJhbGFuY2VzW19ob2xkZXJdID0gYmFsYW5jZXNbX2hvbGRlcl0uc3ViKG5vblZlc3RlZCk7CgogICAgVHJhbnNmZXIoX2hvbGRlciwgcmVjZWl2ZXIsIG5vblZlc3RlZCk7CiAgfQoKCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZQogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSBzcGVjaWZpYyB0aW1lLgogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOwoKICAgIGlmIChncmFudEluZGV4ID09IDApIHJldHVybiBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKTsgLy8gc2hvcnRjdXQgZm9yIGhvbGRlciB3aXRob3V0IGdyYW50cwoKICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIGdyYW50cyB0aGUgaG9sZGVyIGhhcywgYW5kIGFkZCBhbGwgbm9uLXZlc3RlZCB0b2tlbnMKICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gMDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBub25WZXN0ZWQgPSBTYWZlTWF0aC5hZGQobm9uVmVzdGVkLCBub25WZXN0ZWRUb2tlbnMoZ3JhbnRzW2hvbGRlcl1baV0sIHRpbWUpKTsKICAgIH0KCiAgICAvLyBCYWxhbmNlIC0gdG90YWxOb25WZXN0ZWQgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYSBob2xkZXIgY2FuIHRyYW5zZmVyIGF0IGFueSBnaXZlbiB0aW1lCiAgICB1aW50MjU2IHZlc3RlZFRyYW5zZmVyYWJsZSA9IFNhZmVNYXRoLnN1YihiYWxhbmNlT2YoaG9sZGVyKSwgbm9uVmVzdGVkKTsKCiAgICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gb2YgaG93IG1hbnkgdmVzdGVkIGNhbiB0cmFuc2ZlciBhbmQgb3RoZXIgdmFsdWUKICAgIC8vIGluIGNhc2UgdGhlcmUgYXJlIG90aGVyIGxpbWl0aW5nIHRyYW5zZmVyYWJpbGl0eSBmYWN0b3JzIChkZWZhdWx0IGlzIGJhbGFuY2VPZikKICAgIHJldHVybiBNYXRoLm1pbjI1Nih2ZXN0ZWRUcmFuc2ZlcmFibGUsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2hlY2sgdGhlIGFtb3VudCBvZiBncmFudHMgdGhhdCBhbiBhZGRyZXNzIGhhcy4KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgaG9sZGVyIG9mIHRoZSBncmFudHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgZ3JhbnRzLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLgogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudHRlZC4KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEBwYXJhbSBzdGFydCB1aW50NjQgQSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5pbmcgb2YgdGhlIGdyYW50CiAgICogQHBhcmFtIGNsaWZmIHVpbnQ2NCBUaGUgY2xpZmYgcGVyaW9kLgogICAqIEBwYXJhbSB2ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnNvZiBhIHNwZWNpZiBncmFudC4KICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgLwogICAqICAgfCAgICAgICAgICAgICAgLnwKICAgKiAgIHwgICAgICAgICAgICAuICB8CiAgICogICB8ICAgICAgICAgIC4gICAgfAogICAqICAgfCAgICAgICAgLiAgICAgIHwKICAgKiAgIHwgICAgICAuICAgICAgICB8CiAgICogICB8ICAgIC4gICAgICAgICAgfAogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZnQgICAgVmVzdGluZwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgIHVpbnQyNTYgdG9rZW5zLAogICAgdWludDI1NiB0aW1lLAogICAgdWludDI1NiBzdGFydCwKICAgIHVpbnQyNTYgY2xpZmYsCiAgICB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgIC8vIFNob3J0Y3V0cyBmb3IgYmVmb3JlIGNsaWZmIGFuZCBhZnRlciB2ZXN0aW5nIGNhc2VzLgogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsKICAgICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsKCiAgICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLgogICAgICAvLyBBcyBiZWZvcmUgY2xpZmYgdGhlIHNob3J0Y3V0IHJldHVybnMgMCwgd2UgY2FuIHVzZSBqdXN0IGNhbGN1bGF0ZSBhIHZhbHVlCiAgICAgIC8vIGluIHRoZSB2ZXN0aW5nIHJlY3QgKGFzIHNob3duIGluIGFib3ZlJ3MgZmlndXJlKQoKICAgICAgLy8gdmVzdGVkVG9rZW5zID0gdG9rZW5zICogKHRpbWUgLSBzdGFydCkgLyAodmVzdGluZyAtIHN0YXJ0KQogICAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IFNhZmVNYXRoLmRpdigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIodGltZSwgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGguc3ViKHZlc3RpbmcsIHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgcmV0dXJuIHZlc3RlZFRva2VuczsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmMgZ3JhbnQuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4KICAgKiBAcmV0dXJuIFJldHVybnMgYWxsIHRoZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgYSBUb2tlbkdyYW50KGFkZHJlc3MsIHZhbHVlLCBzdGFydCwgY2xpZmYsCiAgICogcmV2b2thYmlsaXR5LCBidXJuc09uUmV2b2tlLCBhbmQgdmVzdGluZykgcGx1cyB0aGUgdmVzdGVkIHZhbHVlIGF0IHRoZSBjdXJyZW50IHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2dyYW50SWQpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZ3JhbnRlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiB2ZXN0ZWQsIHVpbnQ2NCBzdGFydCwgdWludDY0IGNsaWZmLCB1aW50NjQgdmVzdGluZywgYm9vbCByZXZva2FibGUsIGJvb2wgYnVybnNPblJldm9rZSkgewogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CgogICAgZ3JhbnRlciA9IGdyYW50LmdyYW50ZXI7CiAgICB2YWx1ZSA9IGdyYW50LnZhbHVlOwogICAgc3RhcnQgPSBncmFudC5zdGFydDsKICAgIGNsaWZmID0gZ3JhbnQuY2xpZmY7CiAgICB2ZXN0aW5nID0gZ3JhbnQudmVzdGluZzsKICAgIHJldm9rYWJsZSA9IGdyYW50LnJldm9rYWJsZTsKICAgIGJ1cm5zT25SZXZva2UgPSBncmFudC5idXJuc09uUmV2b2tlOwoKICAgIHZlc3RlZCA9IHZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwogIH0KCiAgLyoqCiAgICogQGRldiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICAgIGdyYW50LnZhbHVlLAogICAgICB1aW50MjU2KHRpbWUpLAogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwKICAgICAgdWludDI1NihncmFudC5jbGlmZiksCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykKICAgICk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmMgZ3JhbnQgb24gdGhlCiAgICogcGFzc2VkIHRpbWUgZnJhbWUuCiAgICovCiAgZnVuY3Rpb24gbm9uVmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBncmFudC52YWx1ZS5zdWIodmVzdGVkVG9rZW5zKGdyYW50LCB0aW1lKSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgZGF0ZSB3aGVuIHRoZSBob2xkZXIgY2FuIHRyYXNmZXIgYWxsIGl0cyB0b2tlbnMKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50NjQgZGF0ZSkgewogICAgZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIGRhdGUgPSBNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogIH0KfQoKCmNvbnRyYWN0IEVHTFRva2VuIGlzIFZlc3RlZFRva2VuIHsKICAvL0ZJRUxEUwogIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJlR29sZCI7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiRUdMIjsKICB1aW50IHB1YmxpYyBkZWNpbWFscyA9IDQ7CiAgCiAgLy9DT05TVEFOVFMKICAvLyBUaW1lIGxpbWl0cwogIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUdFX09ORV9USU1FX0VORCA9IDI0IGhvdXJzOyAvLyBmaXJzdCBkYXkgYm9udXMKICB1aW50IHB1YmxpYyBjb25zdGFudCBTVEFHRV9UV09fVElNRV9FTkQgPSAxIHdlZWtzOyAvLyBmaXJzdCB3ZWVrIGJvbnVzCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfVEhSRUVfVElNRV9FTkQgPSAyOCBkYXlzOyAvLyBhcm91bmQgb25lIG1vbnRoCiAgCiAgLy8gTXVsdGlwbGllciBmb3IgdGhlIGRlY2ltYWxzCiAgdWludCBwcml2YXRlIGNvbnN0YW50IE1VTFRJUExJRVIgPSAxMDAwMDsKCiAgLy9QcmljZXMgb2YgRUdMCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBTkRBUkQgICAgPSAgODg4ICpNVUxUSVBMSUVSOyAvLyBFR0wgcmVjZWl2ZWQgcGVyIG9uZSBFVEg7IE1BWF9TVVBQTFkgLyAodmFsdWF0aW9uIC8gZXRoUHJpY2UpCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfUFJFQlVZICAgICAgPSAxMDY2ICpNVUxUSVBMSUVSOyAvLyAxRVRIID0gMjAlIG1vcmUgRUdMIAogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX09ORSAgID0gMTAyMSAqTVVMVElQTElFUjsgLy8gMUVUSCA9IDE1JSBtb3JlIEVHTAogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX1RXTyAgID0gIDk3NiAqTVVMVElQTElFUjsgLy8gMUVUSCA9IDEwJSBtb3JlIEVHTAogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX1RIUkVFID0gIDg4OCAqTVVMVElQTElFUjsKCiAgLy8gRUdMIFRva2VuIExpbWl0cwogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX1RFQU0gPSAgICAgICAgICA0NDQ0NDQ0ICpNVUxUSVBMSUVSOyAvLyB0ZWFtICsgYWR2aXNvcnMgKyBldmVyeXRoaW5nIGVsc2UKICB1aW50IHB1YmxpYyBjb25zdGFudCBBTExPQ19DUk9XRFNBTEUgPSAgICAoNDQ0NDQ0NC0yNjY2NjYpICpNVUxUSVBMSUVSOwogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX1NDID0gCSAgICAgICAgICAyNjY2NjYgKk1VTFRJUExJRVI7CiAgCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfTUFYX1BSRSA9ICAgICAgICA4ODg4ODggKk1VTFRJUExJRVI7CiAgCiAgLy8gTW9yZSBFUkMyMAogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gICAgICAgICAgICAgICAgICA4ODg4ODg4ICpNVUxUSVBMSUVSOyAKICAKICAvLyBBU1NJR05FRCBJTiBJTklUSUFMSVpBVElPTgogIC8vIFN0YXJ0IGFuZCBlbmQgdGltZXMKICB1aW50IHB1YmxpYyBwdWJsaWNTdGFydFRpbWU7IC8vIFRpbWUgaW4gc2Vjb25kcyBwdWJsaWMgY3Jvd2QgZnVuZCBzdGFydHMuCiAgdWludCBwdWJsaWMgcHVibGljRW5kVGltZTsgLy8gVGltZSBpbiBzZWNvbmRzIGNyb3dkc2FsZSBlbmRzCiAgdWludCBwdWJsaWMgaGFyZGNhcEluV2VpOwoKICAvL1NwZWNpYWwgQWRkcmVzc2VzCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdBZGRyZXNzOyAvLyBBZGRyZXNzIHRvIHdoaWNoIGFsbCBldGhlciBmbG93cy4KICBhZGRyZXNzIHB1YmxpYyBvd25lckFkZHJlc3M7IC8vIEFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IG93bmVyLiBDYW4gaGFsdCB0aGUgY3Jvd2RzYWxlLgoKICAvLyBSdW5uaW5nIHRvdGFscwogIHVpbnQgcHVibGljIHdlaVJhaXNlZDsgLy8gVG90YWwgRXRoZXIgcmFpc2VkLgogIHVpbnQgcHVibGljIEVHTFNvbGQ7IC8vIFRvdGFsIEVHTCBzb2xkLiBOb3QgdG8gZXhjZWVkIEFMTE9DX0NST1dEU0FMRQogIHVpbnQgcHVibGljIHByZWJ1eVBvcnRpb25Ub3RhbDsgLy8gVG90YWwgb2YgVG9rZW5zIHB1cmNoYXNlZCBieSBwcmUtYnV5LiBOb3QgdG8gZXhjZWVkIEFMTE9DX01BWF9QUkUuCiAgCiAgLy8gYm9vbGVhbnMKICBib29sIHB1YmxpYyBoYWx0ZWQ7IC8vIGhhbHRzIHRoZSBjcm93ZCBzYWxlIGlmIHRydWUuCgogIC8vIElzIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkKICAgIGludGVybmFsCiAgICByZXR1cm5zIChib29sKSAKICB7CiAgICBpZiAoCiAgICAgIG5vdyA+IHB1YmxpY0VuZFRpbWUKICAgICAgfHwgRUdMU29sZCA+PSBBTExPQ19DUk9XRFNBTEUKICAgICAgfHwgd2VpUmFpc2VkID49IGhhcmRjYXBJbldlaQogICAgKSByZXR1cm4gdHJ1ZTsKCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyBNT0RJRklFUlMKCiAgLy9NYXkgb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGFkZHJlc3MKICBtb2RpZmllciBvbmx5X293bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyQWRkcmVzcyk7CiAgICBfOwogIH0KCiAgLy9NYXkgb25seSBiZSBjYWxsZWQgaWYgdGhlIGNyb3dkZnVuZCBoYXMgbm90IGJlZW4gaGFsdGVkCiAgbW9kaWZpZXIgaXNfbm90X2hhbHRlZCgpIHsKICAgIHJlcXVpcmUoIWhhbHRlZCk7CiAgICBfOwogIH0KCiAgLy8gRVZFTlRTCiAgZXZlbnQgQnV5KGFkZHJlc3MgaW5kZXhlZCBfcmVjaXBpZW50LCB1aW50IF9hbW91bnQpOwoKICAvLyBJbml0aWFsaXphdGlvbiBjb250cmFjdCBhc3NpZ25zIGFkZHJlc3Mgb2YgY3Jvd2RmdW5kIGNvbnRyYWN0IGFuZCBlbmQgdGltZS4KICBmdW5jdGlvbiBFR0xUb2tlbigKICAgIGFkZHJlc3MgX211bHRpc2lnLAogICAgdWludCBfcHVibGljU3RhcnRUaW1lLAogICAgdWludCBfaGFyZGNhcEluV2VpCiAgKSB7CiAgICBvd25lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgcHVibGljU3RhcnRUaW1lID0gX3B1YmxpY1N0YXJ0VGltZTsKICAgIHB1YmxpY0VuZFRpbWUgPSBfcHVibGljU3RhcnRUaW1lICsgMjggZGF5czsKICAgIG11bHRpc2lnQWRkcmVzcyA9IF9tdWx0aXNpZzsKCiAgICBoYXJkY2FwSW5XZWkgPSBfaGFyZGNhcEluV2VpOwogICAgCiAgICBiYWxhbmNlc1sweDhjNmE1OEI1NTFGMzhkNEQ1MUMwZGI3YmI4YjdhZDI5Zjc0ODg3MDJdICs9IEFMTE9DX1NDOwoKICAgIC8vIHdpbGwgYmUgdHJhbnNmZXJyZWQgdG8gdGhlIHRlYW0gYWRkcmVzcyB3aGVuIGl0J3MgdmVzdGVkCiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdICs9IEFMTE9DX1RFQU07CgogICAgYmFsYW5jZXNbb3duZXJBZGRyZXNzXSArPSBBTExPQ19DUk9XRFNBTEU7CiAgfQoKICAvLyBUcmFuc2ZlciBhbW91bnQgb2YgdG9rZW5zIGZyb20gc2VuZGVyIGFjY291bnQgdG8gcmVjaXBpZW50LgogIC8vIE9ubHkgY2FsbGFibGUgYWZ0ZXIgdGhlIGNyb3dkIGZ1bmQgaXMgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICBpZiAoX3RvID09IG1zZy5zZW5kZXIpIHJldHVybjsgLy8gbm8tb3AsIGFsbG93IGV2ZW4gZHVyaW5nIGNyb3dkc2FsZSwgaW4gb3JkZXIgdG8gd29yayBhcm91bmQgdXNpbmcgZ3JhbnRWZXN0ZWRUb2tlbnMoKSB3aGlsZSBpbiBjcm93ZHNhbGUKICAgIHJlcXVpcmUoaXNDcm93ZGZ1bmRDb21wbGV0ZWQoKSk7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYSByZWNpcGllbnQuCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKTsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgogIC8vIGZ1bmN0aW9uIHJldHVybnMgdGhlIGN1cnJlbnQgRUdMIHByaWNlLgogIGZ1bmN0aW9uIGdldFByaWNlUmF0ZSgpCiAgICAgIGNvbnN0YW50CiAgICAgIHJldHVybnMgKHVpbnQgb19yYXRlKQogIHsKICAgICAgdWludCBkZWx0YSA9IFNhZmVNYXRoLnN1Yihub3csIHB1YmxpY1N0YXJ0VGltZSk7CgogICAgICBpZiAoZGVsdGEgPiBTVEFHRV9UV09fVElNRV9FTkQpIHJldHVybiBQUklDRV9TVEFHRV9USFJFRTsKICAgICAgaWYgKGRlbHRhID4gU1RBR0VfT05FX1RJTUVfRU5EKSByZXR1cm4gUFJJQ0VfU1RBR0VfVFdPOwoKICAgICAgcmV0dXJuIChQUklDRV9TVEFHRV9PTkUpOwogIH0KCiAgLy8gY2FsY3VsYXRlcyB3bW91bnQgb2YgRUdMIHdlIGdldCwgZ2l2ZW4gdGhlIHdlaSBhbmQgdGhlIHJhdGVzIHdlJ3ZlIGRlZmluZWQgcGVyIDEgZXRoCiAgZnVuY3Rpb24gY2FsY0Ftb3VudCh1aW50IF93ZWksIHVpbnQgX3JhdGUpIAogICAgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnQpIAogIHsKICAgIHJldHVybiBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKF93ZWksIF9yYXRlKSwgMSBldGhlcik7CiAgfSAKICAKICAvLyBHaXZlbiB0aGUgcmF0ZSBvZiBhIHB1cmNoYXNlIGFuZCB0aGUgcmVtYWluaW5nIHRva2VucyBpbiB0aGlzIHRyYW5jaGUsIGl0CiAgLy8gd2lsbCB0aHJvdyBpZiB0aGUgc2FsZSB3b3VsZCB0YWtlIGl0IHBhc3QgdGhlIGxpbWl0IG9mIHRoZSB0cmFuY2hlLgogIC8vIFJldHVybnMgYGFtb3VudGAgaW4gc2NvcGUgYXMgdGhlIG51bWJlciBvZiBFR0wgdG9rZW5zIHRoYXQgaXQgd2lsbCBwdXJjaGFzZS4KICBmdW5jdGlvbiBwcm9jZXNzUHVyY2hhc2UodWludCBfcmF0ZSwgdWludCBfcmVtYWluaW5nKQogICAgaW50ZXJuYWwKICAgIHJldHVybnMgKHVpbnQgb19hbW91bnQpCiAgewogICAgb19hbW91bnQgPSBjYWxjQW1vdW50KG1zZy52YWx1ZSwgX3JhdGUpOwoKICAgIHJlcXVpcmUob19hbW91bnQgPD0gX3JlbWFpbmluZyk7CiAgICByZXF1aXJlKG11bHRpc2lnQWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpOwoKICAgIGJhbGFuY2VzW293bmVyQWRkcmVzc10gPSBiYWxhbmNlc1tvd25lckFkZHJlc3NdLnN1YihvX2Ftb3VudCk7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChvX2Ftb3VudCk7CgogICAgRUdMU29sZCArPSBvX2Ftb3VudDsKICAgIHdlaVJhaXNlZCArPSBtc2cudmFsdWU7CiAgfQoKICAvLyBEZWZhdWx0IGZ1bmN0aW9uIGNhbGxlZCBieSBzZW5kaW5nIEV0aGVyIHRvIHRoaXMgYWRkcmVzcyB3aXRoIG5vIGFyZ3VtZW50cy4KICAvLyBSZXN1bHRzIGluIGNyZWF0aW9uIG9mIG5ldyBFR0wgVG9rZW5zIGlmIHRyYW5zYWN0aW9uIHdvdWxkIG5vdCBleGNlZWQgaGFyZCBsaW1pdCBvZiBFR0wgVG9rZW4uCiAgZnVuY3Rpb24oKQogICAgcGF5YWJsZQogICAgaXNfbm90X2hhbHRlZAogIHsKICAgIHJlcXVpcmUoIWlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkpOwoKICAgIHVpbnQgYW1vdW50OwoKICAgIGlmIChub3cgPCBwdWJsaWNTdGFydFRpbWUpIHsKICAgICAgLy8gcHJlLXNhbGUKICAgICAgYW1vdW50ID0gcHJvY2Vzc1B1cmNoYXNlKFBSSUNFX1BSRUJVWSwgU2FmZU1hdGguc3ViKEFMTE9DX01BWF9QUkUsIHByZWJ1eVBvcnRpb25Ub3RhbCkpOwogICAgICBwcmVidXlQb3J0aW9uVG90YWwgKz0gYW1vdW50OwogICAgfSBlbHNlIHsKICAgICAgYW1vdW50ID0gcHJvY2Vzc1B1cmNoYXNlKGdldFByaWNlUmF0ZSgpLCBTYWZlTWF0aC5zdWIoQUxMT0NfQ1JPV0RTQUxFLCBFR0xTb2xkKSk7CiAgICB9CiAgICAKICAgIEJ1eShtc2cuc2VuZGVyLCBhbW91bnQpOwogIH0KCiAgLy8gTWF5IGJlIHVzZWQgYnkgb3duZXIgb2YgY29udHJhY3QgdG8gaGFsdCBjcm93ZHNhbGUgYW5kIG5vIGxvbmdlciBleGNlcHQgZXRoZXIuCiAgZnVuY3Rpb24gdG9nZ2xlSGFsdChib29sIF9oYWx0ZWQpCiAgICBvbmx5X293bmVyCiAgewogICAgaGFsdGVkID0gX2hhbHRlZDsKICB9CgogIC8vIGZhaWxzYWZlIGRyYWluCiAgZnVuY3Rpb24gZHJhaW4oKQogICAgb25seV9vd25lcgogIHsKICAgIHJlcXVpcmUob3duZXJBZGRyZXNzLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgfQoKICAvLyBwdWJsaWMgY29uc3RhbnQgCiAgZnVuY3Rpb24gZ2V0U3RhdHVzKCkgCiAgICBjb25zdGFudAogICAgcHVibGljCiAgICByZXR1cm5zIChzdHJpbmcpCiAgewogICAgaWYgKEVHTFNvbGQgPj0gQUxMT0NfQ1JPV0RTQUxFKSByZXR1cm4gInRva2Vuc1NvbGRPdXQiOwogICAgaWYgKHdlaVJhaXNlZCA+PSBoYXJkY2FwSW5XZWkpIHJldHVybiAiaGFyZGNhcFJlYWNoZWQiOwogICAgCiAgICBpZiAobm93IDwgcHVibGljU3RhcnRUaW1lKSB7CiAgICAgIC8vIHByZXNhbGUKICAgICAgaWYgKHByZWJ1eVBvcnRpb25Ub3RhbCA+PSBBTExPQ19NQVhfUFJFKSByZXR1cm4gInByZXNhbGVTb2xkT3V0IjsKICAgICAgcmV0dXJuICJwcmVzYWxlIjsKICAgIH0gZWxzZSBpZiAobm93IDwgcHVibGljRW5kVGltZSkgewogICAgICAvLyBwdWJsaWMgc2FsZQogICAgICByZXR1cm4gInB1YmxpYyI7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gInNhbGVPdmVyIjsKICAgIH0KICB9Cn0='.
	

]
