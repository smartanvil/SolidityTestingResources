Class {
	#name : #SRT3d2B62aD28A7A11824Db8d64D170843e3b89F6Ec,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3d2B62aD28A7A11824Db8d64D170843e3b89F6Ec >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IDAuNC4yMTsKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBBTUJUb2tlbiB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBzdHJpbmcgIHB1YmxpYyBjb25zdGFudCBuYW1lICAgICA9ICJBbWJpdCB0b2tlbiI7CiAgICBzdHJpbmcgIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgICA9ICJBTUJUIjsKICAgIHVpbnQ4ICAgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBib29sIGludGVybmFsIGNvbnRyYWN0SXNXb3JraW5nID0gdHJ1ZTsKCiAgICBzdHJ1Y3QgSW52ZXN0b3IgewogICAgICAgIHVpbnQyNTYgdG9rZW5CYWxhbmNlOwogICAgICAgIHVpbnQyNTYgaWNvSW52ZXN0OwogICAgICAgIGJvb2wgICAgYWN0aXZhdGVkOwogICAgfQogICAgbWFwcGluZyhhZGRyZXNzID0+IEludmVzdG9yKSBpbnRlcm5hbCBpbnZlc3RvcnM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCiAgICAvKgogICAgICAgICAgICBEaXZpZGVuZCdzIFN0cnVjdHVyZXMKICAgICovCiAgICB1aW50MjU2ICAgaW50ZXJuYWwgZGl2aWRlbmRDYW5kaWRhdGUgPSAwOwogICAgdWludDI1NltdIGludGVybmFsIGRpdmlkZW5kczsKCiAgICBlbnVtIFByb2ZpdFN0YXR1cyB7SW5pdGlhbCwgU3RhcnRGaXhlZCwgRW5kRml4ZWQsIENsYWltZWR9CiAgICBzdHJ1Y3QgSW52ZXN0b3JQcm9maXREYXRhIHsKICAgICAgICB1aW50MjU2ICAgICAgc3RhcnRfYmFsYW5jZTsKICAgICAgICB1aW50MjU2ICAgICAgZW5kX2JhbGFuY2U7CiAgICAgICAgUHJvZml0U3RhdHVzIHN0YXR1czsKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyh1aW50MzIgPT4gSW52ZXN0b3JQcm9maXREYXRhKSkgaW50ZXJuYWwgcHJvZml0czsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGludmVzdG9yc1tfb3duZXJdLnRva2VuQmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBfYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGludmVzdG9yc1ttc2cuc2VuZGVyXS5hY3RpdmF0ZWQgJiYgY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJldHVybiBfYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gaW52ZXN0b3JzW19mcm9tXS50b2tlbkJhbGFuY2UpOwoKICAgICAgICBmaXhEaXZpZGVuZEJhbGFuY2VzKF90bywgZmFsc2UpOwoKICAgICAgICBpbnZlc3RvcnNbX2Zyb21dLnRva2VuQmFsYW5jZSA9IGludmVzdG9yc1tfZnJvbV0udG9rZW5CYWxhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIGludmVzdG9yc1tfdG9dLnRva2VuQmFsYW5jZSA9IGludmVzdG9yc1tfdG9dLnRva2VuQmFsYW5jZS5hZGQoX3ZhbHVlKTsKICAgICAgICBlbWl0IFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW21zZy5zZW5kZXJdLmFjdGl2YXRlZCAmJiBjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgZml4RGl2aWRlbmRCYWxhbmNlcyhtc2cuc2VuZGVyLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIF90cmFuc2ZlciggbXNnLnNlbmRlciwgX3RvLCAgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW21zZy5zZW5kZXJdLmFjdGl2YXRlZCAmJiBpbnZlc3RvcnNbX2Zyb21dLmFjdGl2YXRlZCAmJiBjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gaW52ZXN0b3JzW19mcm9tXS50b2tlbkJhbGFuY2UpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICAgICAgZml4RGl2aWRlbmRCYWxhbmNlcyhfZnJvbSwgZmFsc2UpOwogICAgICAgIGZpeERpdmlkZW5kQmFsYW5jZXMoX3RvLCBmYWxzZSk7CgogICAgICAgIGludmVzdG9yc1tfZnJvbV0udG9rZW5CYWxhbmNlID0gaW52ZXN0b3JzW19mcm9tXS50b2tlbkJhbGFuY2Uuc3ViKF92YWx1ZSk7CiAgICAgICAgaW52ZXN0b3JzW190b10udG9rZW5CYWxhbmNlICAgPSBpbnZlc3RvcnNbX3RvXS50b2tlbkJhbGFuY2UuYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gICAgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKCiAgICAgICAgZW1pdCBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qCiAgICAgICAgRWxpZ2libGUgdG9rZW4gYW5kIGJhbGFuY2UgaGVscGVyIGZ1bmN0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpeERpdmlkZW5kQmFsYW5jZXMoYWRkcmVzcyBpbnZlc3RvciwgYm9vbCByZXZlcnRJZkNsYWltZWQpIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoSW52ZXN0b3JQcm9maXREYXRhIHN0b3JhZ2UgY3VycmVudF9wcm9maXQsIHVpbnQyNTYgcHJvZml0X3Blcl90b2tlbil7CgogICAgICAgIHVpbnQzMiBuZXh0X2lkICAgICAgPSB1aW50MzIoZGl2aWRlbmRzLmxlbmd0aCk7CiAgICAgICAgdWludDMyIGN1cnJlbnRfaWQgICA9IG5leHRfaWQgLSAxOwogICAgICAgIGN1cnJlbnRfcHJvZml0ICAgICAgPSBwcm9maXRzW2ludmVzdG9yXVtjdXJyZW50X2lkXTsKCiAgICAgICAgaWYgKHJldmVydElmQ2xhaW1lZCkgcmVxdWlyZShjdXJyZW50X3Byb2ZpdC5zdGF0dXMgIT0gUHJvZml0U3RhdHVzLkNsYWltZWQpOwogICAgICAgIEludmVzdG9yUHJvZml0RGF0YSBzdG9yYWdlIG5leHRfcHJvZml0ICAgICAgPSBwcm9maXRzW2ludmVzdG9yXVtuZXh0X2lkXTsKCiAgICAgICAgaWYgKGN1cnJlbnRfcHJvZml0LnN0YXR1cyA9PSBQcm9maXRTdGF0dXMuSW5pdGlhbCkgewoKICAgICAgICAgICAgY3VycmVudF9wcm9maXQuc3RhcnRfYmFsYW5jZSA9IGludmVzdG9yc1tpbnZlc3Rvcl0udG9rZW5CYWxhbmNlOwogICAgICAgICAgICBjdXJyZW50X3Byb2ZpdC5lbmRfYmFsYW5jZSAgID0gaW52ZXN0b3JzW2ludmVzdG9yXS50b2tlbkJhbGFuY2U7CiAgICAgICAgICAgIGN1cnJlbnRfcHJvZml0LnN0YXR1cyAgICAgICAgPSBQcm9maXRTdGF0dXMuRW5kRml4ZWQ7CiAgICAgICAgICAgIG5leHRfcHJvZml0LnN0YXJ0X2JhbGFuY2UgPSBpbnZlc3RvcnNbaW52ZXN0b3JdLnRva2VuQmFsYW5jZTsKICAgICAgICAgICAgbmV4dF9wcm9maXQuc3RhdHVzICAgICAgICA9IFByb2ZpdFN0YXR1cy5TdGFydEZpeGVkOwoKICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRfcHJvZml0LnN0YXR1cyA9PSBQcm9maXRTdGF0dXMuU3RhcnRGaXhlZCkgewoKICAgICAgICAgICAgY3VycmVudF9wcm9maXQuZW5kX2JhbGFuY2UgPSBpbnZlc3RvcnNbaW52ZXN0b3JdLnRva2VuQmFsYW5jZTsKICAgICAgICAgICAgY3VycmVudF9wcm9maXQuc3RhdHVzICAgICAgPSBQcm9maXRTdGF0dXMuRW5kRml4ZWQ7CiAgICAgICAgICAgIG5leHRfcHJvZml0LnN0YXJ0X2JhbGFuY2UgPSBpbnZlc3RvcnNbaW52ZXN0b3JdLnRva2VuQmFsYW5jZTsKICAgICAgICAgICAgbmV4dF9wcm9maXQuc3RhdHVzICAgICAgICA9IFByb2ZpdFN0YXR1cy5TdGFydEZpeGVkOwogICAgICAgIH0KICAgICAgICBwcm9maXRfcGVyX3Rva2VuID0gZGl2aWRlbmRzW2N1cnJlbnRfaWRdOwogICAgfQp9Cgpjb250cmFjdCBBTUJUSUNPIGlzIEFNQlRva2VuIHsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgT05FX1RPS0VOICAgICAgICAgICA9IDEwICoqIHVpbnQyNTYoZGVjaW1hbHMpOy8vanVzdCBmb3IgY29udmVuaWVuY2UKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTUlMTElPTiAgICAgICAgICAgICA9IDEwMDAwMDA7ICAgICAgICAgICAgICAgIC8vanVzdCBmb3IgY29udmVuaWVuY2UKCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEJPVU5UWV9RVUFOVElUWSAgICAgPSAzMTIwMDAwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBSRVNFUlZfUVVBTlRJVFkgICAgID0gMTI0ODAwMDA7CgogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBUT0tFTl9NQVhfU1VQUExZICAgID0gMTA0ICogTUlMTElPTiAgICogT05FX1RPS0VOOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCT1VOVFlfVE9LRU5TICAgICAgID0gQk9VTlRZX1FVQU5USVRZICogT05FX1RPS0VOOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBSRVNFUlZfVE9LRU5TICAgICAgID0gUkVTRVJWX1FVQU5USVRZICogT05FX1RPS0VOOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBNSU5fU09MRF9UT0tFTlMgICAgID0gMjAwICAgICAgICAgICAgICogT05FX1RPS0VOOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBTT0ZUQ0FQICAgICAgICAgICAgID0gQk9VTlRZX1RPS0VOUyArIFJFU0VSVl9UT0tFTlMgKyA2ICogTUlMTElPTiAqIE9ORV9UT0tFTjsKCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJFRlVORF9QRVJJT0QgICAgICAgPSA2MCBkYXlzOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBLWUNfUkVWSUVXX1BFUklPRCAgID0gNjAgZGF5czsKCiAgICBhZGRyZXNzIGludGVybmFsIG93bmVyOwogICAgYWRkcmVzcyBpbnRlcm5hbCBib3VudHlNYW5hZ2VyOwogICAgYWRkcmVzcyBpbnRlcm5hbCBkaXZpZGVuZE1hbmFnZXI7CiAgICBhZGRyZXNzIGludGVybmFsIGRBcHA7CgogICAgZW51bSBDb250cmFjdE1vZGUge0luaXRpYWwsIFRva2VuU2FsZSwgVW5kZXJTb2Z0Q2FwLCBEaXZpZGVuZERpc3RyaWJ1dGlvbiwgRGVzdHJveWVkfQogICAgQ29udHJhY3RNb2RlIHB1YmxpYyBtb2RlID0gQ29udHJhY3RNb2RlLkluaXRpYWw7CgogICAgdWludDI1NiBwdWJsaWMgaWNvRmluaXNoVGltZSA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyB0b2tlblNvbGQgPSAwOwogICAgdWludDI1NiBwdWJsaWMgZXRoZXJDb2xsZWN0ZWQgPSAwOwoKICAgIHVpbnQ4ICAgcHVibGljIGN1cnJlbnRTZWN0aW9uID0gMDsKICAgIHVpbnRbNF0gcHVibGljIHNhbGVTZWN0aW9uRGlzY291bnRzID0gWyB1aW50OCgyMCksIDEwLCA1XTsKICAgIHVpbnRbNF0gcHVibGljIHNhbGVTZWN0aW9uUHJpY2UgICAgID0gWyB1aW50MjU2KDEwMDAwMDAwMDAwMDAwMDApLCAxMTI1MDAwMDAwMDAwMDAwLCAxMTg3NTAwMDAwMDAwMDAwLCAxMjUwMDAwMDAwMDAwMDAwXTsvL3ByaWNlOiAwLjQwIDAuNDUgMC40NzUgMC41MCBjZW50IHwgRVRIL1VTRCBpbml0aWFsIHJhdGU6IDQwMAogICAgdWludFs0XSBwdWJsaWMgc2FsZVNlY3Rpb25Db3VudCAgICAgPSBbIHVpbnQyNTYoMTcgKiBNSUxMSU9OKSwgMjAgKiBNSUxMSU9OLCAyMCAqIE1JTExJT04sIDQ3ICogTUlMTElPTiAtIChCT1VOVFlfUVVBTlRJVFkrUkVTRVJWX1FVQU5USVRZKV07CiAgICB1aW50WzRdIHB1YmxpYyBzYWxlU2VjdGlvbkludmVzdCAgICA9IFsgdWludDI1NihzYWxlU2VjdGlvbkNvdW50WzBdICogc2FsZVNlY3Rpb25QcmljZVswXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWxlU2VjdGlvbkNvdW50WzFdICogc2FsZVNlY3Rpb25QcmljZVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbGVTZWN0aW9uQ291bnRbMl0gKiBzYWxlU2VjdGlvblByaWNlWzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FsZVNlY3Rpb25Db3VudFszXSAqIHNhbGVTZWN0aW9uUHJpY2VbM11dOwogICAgdWludDI1NiBwdWJsaWMgYnV5QmFja1ByaWNlV2VpID0gMCBldGhlcjsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZCAgICAgICAgICAoYWRkcmVzcyBwcmV2aW91c093bmVyLCBhZGRyZXNzIG5ld093bmVyKTsKICAgIGV2ZW50IEJvdW50eU1hbmFnZXJBc3NpZ25lZCAgICAgICAgIChhZGRyZXNzIHByZXZpb3VzQm91bnR5TWFuYWdlciwgYWRkcmVzcyBuZXdCb3VudHlNYW5hZ2VyKTsKICAgIGV2ZW50IERpdmlkZW5kTWFuYWdlckFzc2lnbmVkICAgICAgIChhZGRyZXNzIHByZXZpb3VzRGl2aWRlbmRNYW5hZ2VyLCBhZGRyZXNzIG5ld0RpdmlkZW5kTWFuYWdlcik7CiAgICBldmVudCBEQXBwQXNzaWduZWQgICAgICAgICAgICAgICAgICAoYWRkcmVzcyBwcmV2aW91c0RBcHAsIGFkZHJlc3MgbmV3REFwcCk7CiAgICBldmVudCBNb2RlQ2hhbmdlZCAgICAgICAgICAgICAgICAgICAoQ29udHJhY3RNb2RlICBuZXdNb2RlLCB1aW50MjU2IHRva2VuQmFsYW5jZSk7CiAgICBldmVudCBEaXZpZGVuZERlY2xhcmVkICAgICAgICAgICAgICAodWludDMyIGluZGV4ZWQgZGl2aWRlbmRJRCwgdWludDI1NiBwcm9maXRQZXJUb2tlbik7CiAgICBldmVudCBEaXZpZGVuZENsYWltZWQgICAgICAgICAgICAgICAoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBCdXlCYWNrICAgICAgICAgICAgICAgICAgICAgICAoYWRkcmVzcyBpbmRleGVkIHJlcXVlc3Rvcik7CiAgICBldmVudCBSZWZ1bmQgICAgICAgICAgICAgICAgICAgICAgICAoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBIYW5kYnJha2UgICAgICAgICAgICAgICAgICAgICAoQ29udHJhY3RNb2RlIGN1cnJlbnRfbW9kZSwgYm9vbCBmdW5jdGlvbmluZyk7CiAgICBldmVudCBGdW5kc0FkZGVkICAgICAgICAgICAgICAgICAgICAoYWRkcmVzcyBvd25lciwgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgRnVuZHNXaXRoZHJhd2FsICAgICAgICAgICAgICAgKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IEJvdW50eVRyYW5zZmVyZWQgICAgICAgICAgICAgIChhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgUHJpY2VDaGFuZ2VkICAgICAgICAgICAgICAgICAgKHVpbnQyNTYgbmV3UHJpY2UpOwogICAgZXZlbnQgQnVyblRva2VuICAgICAgICAgICAgICAgICAgICAgKHVpbnQyNTYgYW1vdW50KTsKCiAgICBtb2RpZmllciBncmFudE93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBncmFudEJvdW50eU1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJvdW50eU1hbmFnZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgZ3JhbnREaXZpZGVuZE1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGRpdmlkZW5kTWFuYWdlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBncmFudERBcHAoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGRBcHApOwogICAgICAgIF87CiAgICB9CiAgICBmdW5jdGlvbiBBTUJUSUNPKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgZGl2aWRlbmRzLnB1c2goMCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5QcmljZSh1aW50MjU2IG5ld193ZWlfcHJpY2UpIHB1YmxpYyBncmFudERBcHAgewogICAgICAgIHJlcXVpcmUobmV3X3dlaV9wcmljZSA+IDApOwogICAgICAgIHVpbnQ4IGxlbiA9IHVpbnQ4KHNhbGVTZWN0aW9uUHJpY2UubGVuZ3RoKS0xOwogICAgICAgIGZvciAodWludDggaT0wOyBpPD1sZW47IGkrKykgewogICAgICAgICAgICB1aW50MjU2IHByZHNjID0gMTAwIC0gc2FsZVNlY3Rpb25EaXNjb3VudHNbaV07CiAgICAgICAgICAgIHNhbGVTZWN0aW9uUHJpY2VbaV0gID0gcHJkc2MubXVsKG5ld193ZWlfcHJpY2UgKS5kaXYoMTAwKTsKICAgICAgICAgICAgc2FsZVNlY3Rpb25JbnZlc3RbaV0gPSBzYWxlU2VjdGlvblByaWNlW2ldICogc2FsZVNlY3Rpb25Db3VudFtpXTsKICAgICAgICB9CiAgICAgICAgZW1pdCBQcmljZUNoYW5nZWQobmV3X3dlaV9wcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhcnRJQ08oKSBwdWJsaWMgZ3JhbnRPd25lciB7CiAgICAgICAgcmVxdWlyZShjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5Jbml0aWFsKTsKICAgICAgICByZXF1aXJlKGJvdW50eU1hbmFnZXIgIT0gMHgwKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSBUT0tFTl9NQVhfU1VQUExZOwoKICAgICAgICBpbnZlc3RvcnNbdGhpc10udG9rZW5CYWxhbmNlICAgICAgICAgICAgPSBUT0tFTl9NQVhfU1VQUExZLShCT1VOVFlfVE9LRU5TK1JFU0VSVl9UT0tFTlMpOwogICAgICAgIGludmVzdG9yc1tib3VudHlNYW5hZ2VyXS50b2tlbkJhbGFuY2UgICA9IEJPVU5UWV9UT0tFTlM7CiAgICAgICAgaW52ZXN0b3JzW293bmVyXS50b2tlbkJhbGFuY2UgICAgICAgICAgID0gUkVTRVJWX1RPS0VOUzsKCiAgICAgICAgdG9rZW5Tb2xkID0gaW52ZXN0b3JzW2JvdW50eU1hbmFnZXJdLnRva2VuQmFsYW5jZSArIGludmVzdG9yc1tvd25lcl0udG9rZW5CYWxhbmNlOwoKICAgICAgICBtb2RlID0gQ29udHJhY3RNb2RlLlRva2VuU2FsZTsKICAgICAgICBlbWl0IE1vZGVDaGFuZ2VkKG1vZGUsIGludmVzdG9yc1t0aGlzXS50b2tlbkJhbGFuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRUb2tlblByaWNlKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShjdXJyZW50U2VjdGlvbiA8IHNhbGVTZWN0aW9uQ291bnQubGVuZ3RoKTsKICAgICAgICByZXR1cm4gc2FsZVNlY3Rpb25QcmljZVtjdXJyZW50U2VjdGlvbl07CiAgICB9CgogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGludmVzdCgpOwogICAgfQogICAgZnVuY3Rpb24gaW52ZXN0KCkgcHVibGljIHBheWFibGUgewogICAgICAgX2ludmVzdChtc2cuc2VuZGVyLG1zZy52YWx1ZSk7CiAgICB9CiAgICAvKiBVc2VkIGJ5IMSQQXBwIHRvIGFjY2VwdCBCaXRjb2luIHRyYW5zZmVycy4qLwogICAgZnVuY3Rpb24gaW52ZXN0V2l0aEJpdGNvaW4oYWRkcmVzcyBldGhBZGRyZXNzLCB1aW50MjU2IGV0aFdFSSkgcHVibGljIGdyYW50REFwcCB7CiAgICAgICAgX2ludmVzdChldGhBZGRyZXNzLGV0aFdFSSk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9pbnZlc3QoYWRkcmVzcyBtc2dfc2VuZGVyLCB1aW50MjU2IG1zZ192YWx1ZSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJlcXVpcmUoY3VycmVudFNlY3Rpb24gPCBzYWxlU2VjdGlvbkNvdW50Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5Ub2tlblNhbGUpOwogICAgICAgIHJlcXVpcmUobXNnX3NlbmRlciAhPSBib3VudHlNYW5hZ2VyKTsKCiAgICAgICAgdWludCB3ZWlfdmFsdWUgPSBtc2dfdmFsdWU7CiAgICAgICAgdWludCBfdG9rZW5zID0gMDsKCiAgICAgICAgd2hpbGUgKHdlaV92YWx1ZSA+IDAgJiYgKGN1cnJlbnRTZWN0aW9uIDwgc2FsZVNlY3Rpb25Db3VudC5sZW5ndGgpKSB7CiAgICAgICAgICAgIGlmIChzYWxlU2VjdGlvbkludmVzdFtjdXJyZW50U2VjdGlvbl0gPj0gd2VpX3ZhbHVlKSB7CiAgICAgICAgICAgICAgICBfdG9rZW5zICs9IE9ORV9UT0tFTi5tdWwod2VpX3ZhbHVlKS5kaXYoc2FsZVNlY3Rpb25QcmljZVtjdXJyZW50U2VjdGlvbl0pOwogICAgICAgICAgICAgICAgc2FsZVNlY3Rpb25JbnZlc3RbY3VycmVudFNlY3Rpb25dIC09IHdlaV92YWx1ZTsKICAgICAgICAgICAgICAgIHdlaV92YWx1ZSA9MDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90b2tlbnMgKz0gT05FX1RPS0VOLm11bChzYWxlU2VjdGlvbkludmVzdFtjdXJyZW50U2VjdGlvbl0pLmRpdihzYWxlU2VjdGlvblByaWNlW2N1cnJlbnRTZWN0aW9uXSk7CiAgICAgICAgICAgICAgICB3ZWlfdmFsdWUgLT0gc2FsZVNlY3Rpb25JbnZlc3RbY3VycmVudFNlY3Rpb25dOwogICAgICAgICAgICAgICAgc2FsZVNlY3Rpb25JbnZlc3RbY3VycmVudFNlY3Rpb25dID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2FsZVNlY3Rpb25JbnZlc3RbY3VycmVudFNlY3Rpb25dIDw9IDApIGN1cnJlbnRTZWN0aW9uKys7CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKF90b2tlbnMgPj0gTUlOX1NPTERfVE9LRU5TKTsKCiAgICAgICAgcmVxdWlyZShfdHJhbnNmZXIodGhpcywgbXNnX3NlbmRlciwgX3Rva2VucykpOwoKICAgICAgICBwcm9maXRzW21zZ19zZW5kZXJdWzFdID0gSW52ZXN0b3JQcm9maXREYXRhKHsKICAgICAgICAgICAgc3RhcnRfYmFsYW5jZTogIGludmVzdG9yc1ttc2dfc2VuZGVyXS50b2tlbkJhbGFuY2UsCiAgICAgICAgICAgIGVuZF9iYWxhbmNlOiAgICBpbnZlc3RvcnNbbXNnX3NlbmRlcl0udG9rZW5CYWxhbmNlLAogICAgICAgICAgICBzdGF0dXM6ICAgICAgICAgUHJvZml0U3RhdHVzLlN0YXJ0Rml4ZWQKICAgICAgICAgICAgfSk7CgogICAgICAgIGludmVzdG9yc1ttc2dfc2VuZGVyXS5pY29JbnZlc3QgKz0gKG1zZ192YWx1ZSAtIHdlaV92YWx1ZSk7CgogICAgICAgIHRva2VuU29sZCAgICAgICs9IF90b2tlbnM7CiAgICAgICAgZXRoZXJDb2xsZWN0ZWQgKz0gKG1zZ192YWx1ZSAtIHdlaV92YWx1ZSk7CgogICAgICAgIGlmIChzYWxlU2VjdGlvbkludmVzdFtzYWxlU2VjdGlvbkludmVzdC5sZW5ndGgtMV0gPT0gMCApIHsKICAgICAgICAgICAgX2ZpbmlzaElDTygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdlaV92YWx1ZSA+IDApIHsKICAgICAgICAgICAgbXNnX3NlbmRlci50cmFuc2Zlcih3ZWlfdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfZmluaXNoSUNPKCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJlcXVpcmUobW9kZSA9PSBDb250cmFjdE1vZGUuVG9rZW5TYWxlKTsKCiAgICAgICAgaWYgKHRva2VuU29sZCA+PSBTT0ZUQ0FQKSB7CiAgICAgICAgICAgIG1vZGUgPSBDb250cmFjdE1vZGUuRGl2aWRlbmREaXN0cmlidXRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbW9kZSA9IENvbnRyYWN0TW9kZS5VbmRlclNvZnRDYXA7CiAgICAgICAgfQoKICAgICAgICBpbnZlc3RvcnNbdGhpc10udG9rZW5CYWxhbmNlID0gMDsKICAgICAgICBpY29GaW5pc2hUaW1lICAgICAgICAgICAgICAgID0gbm93OwogICAgICAgIHRvdGFsU3VwcGx5ICAgICAgICAgICAgICAgICAgPSB0b2tlblNvbGQ7CgogICAgICAgIGVtaXQgTW9kZUNoYW5nZWQobW9kZSwgaW52ZXN0b3JzW3RoaXNdLnRva2VuQmFsYW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluaXNoSUNPKCkgcHVibGljIGdyYW50T3duZXIgIHsKICAgICAgICBfZmluaXNoSUNPKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW52ZXN0ZWRBbW91bnQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGludmVzdG9yc1tpbnZlc3Rvcl0uaWNvSW52ZXN0OwogICAgfQoKICAgIGZ1bmN0aW9uIGFjdGl2YXRlQWRkcmVzcyhhZGRyZXNzIGludmVzdG9yLCBib29sIHN0YXR1cykgcHVibGljIGdyYW50REFwcCB7CiAgICAgICAgcmVxdWlyZShjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5EaXZpZGVuZERpc3RyaWJ1dGlvbik7CiAgICAgICAgcmVxdWlyZSgobm93IC0gaWNvRmluaXNoVGltZSkgPCBLWUNfUkVWSUVXX1BFUklPRCk7CiAgICAgICAgaW52ZXN0b3JzW2ludmVzdG9yXS5hY3RpdmF0ZWQgPSBzdGF0dXM7CiAgICB9CgogICAgZnVuY3Rpb24gaXNBZGRyZXNzQWN0aXZhdGVkKGFkZHJlc3MgaW52ZXN0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaW52ZXN0b3JzW2ludmVzdG9yXS5hY3RpdmF0ZWQ7CiAgICB9CgogICAgLyoqKioqKioKICAgICAgICAgICAgRGl2aWRlbmQgRGVjbGFyYXRpb24gU2VjdGlvbgogICAgKioqKioqKioqLwogICAgZnVuY3Rpb24gZGVjbGFyZURpdmlkZW5kKHVpbnQyNTYgcHJvZml0X3Blcl90b2tlbikgcHVibGljIGdyYW50RGl2aWRlbmRNYW5hZ2VyIHsKICAgICAgICBkaXZpZGVuZENhbmRpZGF0ZSA9IHByb2ZpdF9wZXJfdG9rZW47CiAgICB9CgogICAgZnVuY3Rpb24gY29uZmlybURpdmlkZW5kKHVpbnQyNTYgcHJvZml0X3Blcl90b2tlbikgcHVibGljIGdyYW50T3duZXIgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJlcXVpcmUoZGl2aWRlbmRDYW5kaWRhdGUgPT0gcHJvZml0X3Blcl90b2tlbik7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5EaXZpZGVuZERpc3RyaWJ1dGlvbik7CgogICAgICAgIGRpdmlkZW5kcy5wdXNoKGRpdmlkZW5kQ2FuZGlkYXRlKTsKICAgICAgICBlbWl0IERpdmlkZW5kRGVjbGFyZWQodWludDMyKGRpdmlkZW5kcy5sZW5ndGgpLCBkaXZpZGVuZENhbmRpZGF0ZSk7CiAgICAgICAgZGl2aWRlbmRDYW5kaWRhdGUgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltRGl2aWRlbmQoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJlcXVpcmUobW9kZSA9PSBDb250cmFjdE1vZGUuRGl2aWRlbmREaXN0cmlidXRpb24pOwogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW21zZy5zZW5kZXJdLmFjdGl2YXRlZCk7CgogICAgICAgIEludmVzdG9yUHJvZml0RGF0YSBzdG9yYWdlIGN1cnJlbnRfcHJvZml0OwogICAgICAgIHVpbnQyNTYgcHJpY2VfcGVyX3Rva2VuOwogICAgICAgIChjdXJyZW50X3Byb2ZpdCwgcHJpY2VfcGVyX3Rva2VuKSA9IGZpeERpdmlkZW5kQmFsYW5jZXMobXNnLnNlbmRlciwgdHJ1ZSk7CgogICAgICAgIHVpbnQyNTYgaW52ZXN0b3JQcm9maXRXZWkgPQogICAgICAgICAgICAgICAgICAgIChjdXJyZW50X3Byb2ZpdC5zdGFydF9iYWxhbmNlIDwgY3VycmVudF9wcm9maXQuZW5kX2JhbGFuY2UgPwogICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Byb2ZpdC5zdGFydF9iYWxhbmNlIDogY3VycmVudF9wcm9maXQuZW5kX2JhbGFuY2UgKS5kaXYoT05FX1RPS0VOKS5tdWwocHJpY2VfcGVyX3Rva2VuKTsKCiAgICAgICAgY3VycmVudF9wcm9maXQuc3RhdHVzID0gUHJvZml0U3RhdHVzLkNsYWltZWQ7CiAgICAgICAgZW1pdCBEaXZpZGVuZENsYWltZWQobXNnLnNlbmRlciwgaW52ZXN0b3JQcm9maXRXZWkpOwoKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGludmVzdG9yUHJvZml0V2VpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXREaXZpZGVuZEluZm8oKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZGl2aWRlbmRzW2RpdmlkZW5kcy5sZW5ndGggLSAxXTsKICAgIH0KCiAgICAvKioqKioqKgogICAgICAgICAgICAgICAgZW1pdCBCdXlCYWNrCiAgICAqKioqKioqKi8KICAgIGZ1bmN0aW9uIHNldEJ1eUJhY2tQcmljZSh1aW50MjU2IHRva2VuX2J1eWJhY2tfcHJpY2UpIHB1YmxpYyBncmFudE93bmVyIHsKICAgICAgICByZXF1aXJlKG1vZGUgPT0gQ29udHJhY3RNb2RlLkRpdmlkZW5kRGlzdHJpYnV0aW9uKTsKICAgICAgICBidXlCYWNrUHJpY2VXZWkgPSB0b2tlbl9idXliYWNrX3ByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eWJhY2soKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJlcXVpcmUobW9kZSA9PSBDb250cmFjdE1vZGUuRGl2aWRlbmREaXN0cmlidXRpb24pOwogICAgICAgIHJlcXVpcmUoYnV5QmFja1ByaWNlV2VpID4gMCk7CgogICAgICAgIHVpbnQyNTYgdG9rZW5fYW1vdW50ID0gaW52ZXN0b3JzW21zZy5zZW5kZXJdLnRva2VuQmFsYW5jZTsKICAgICAgICB1aW50MjU2IGV0aGVyX2Ftb3VudCA9IGNhbGNUb2tlblRvV2VpKHRva2VuX2Ftb3VudCk7CgogICAgICAgIHJlcXVpcmUoYWRkcmVzcyh0aGlzKS5iYWxhbmNlID4gZXRoZXJfYW1vdW50KTsKCiAgICAgICAgaWYgKHRyYW5zZmVyKHRoaXMsIHRva2VuX2Ftb3VudCkpewogICAgICAgICAgICBlbWl0IEJ1eUJhY2sobXNnLnNlbmRlcik7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoZXJfYW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqKioqKioqCiAgICAgICAgICAgICAgICBVbmRlciBTb2Z0Q2FwIFNlY3Rpb24KICAgICoqKioqKioqKi8KICAgIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5VbmRlclNvZnRDYXApOwogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW21zZy5zZW5kZXJdLnRva2VuQmFsYW5jZSA+MCk7CiAgICAgICAgcmVxdWlyZShpbnZlc3RvcnNbbXNnLnNlbmRlcl0uaWNvSW52ZXN0PjApOwoKICAgICAgICByZXF1aXJlIChhZGRyZXNzKHRoaXMpLmJhbGFuY2UgPiBpbnZlc3RvcnNbbXNnLnNlbmRlcl0uaWNvSW52ZXN0KTsKCiAgICAgICAgaWYgKF90cmFuc2Zlcihtc2cuc2VuZGVyLCB0aGlzLCBpbnZlc3RvcnNbbXNnLnNlbmRlcl0udG9rZW5CYWxhbmNlKSl7CiAgICAgICAgICAgIGVtaXQgUmVmdW5kKG1zZy5zZW5kZXIsIGludmVzdG9yc1ttc2cuc2VuZGVyXS5pY29JbnZlc3QpOwogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGludmVzdG9yc1ttc2cuc2VuZGVyXS5pY29JbnZlc3QpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkZXN0cm95Q29udHJhY3QoKSBwdWJsaWMgZ3JhbnRPd25lciB7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5VbmRlclNvZnRDYXApOwogICAgICAgIHJlcXVpcmUoKG5vdyAtIGljb0ZpbmlzaFRpbWUpID4gUkVGVU5EX1BFUklPRCk7CiAgICAgICAgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgIH0KICAgIC8qKioqKioqKgogICAgICAgICAgICAgICAgUGVybWlzc2lvbiByZWxhdGVkCiAgICAqKioqKioqKi8KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld19vd25lcikgcHVibGljIGdyYW50T3duZXIgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIHJlcXVpcmUobmV3X293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGVtaXQgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld19vd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdfb3duZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Qm91bnR5TWFuYWdlcihhZGRyZXNzIG5ld19ib3VudHlfbWFuYWdlcikgcHVibGljIGdyYW50T3duZXIgewogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW25ld19ib3VudHlfbWFuYWdlcl0udG9rZW5CYWxhbmNlID09MCk7CiAgICAgICAgaWYgKG1vZGUgPT0gQ29udHJhY3RNb2RlLkluaXRpYWwpIHsKICAgICAgICAgICAgZW1pdCBCb3VudHlNYW5hZ2VyQXNzaWduZWQoYm91bnR5TWFuYWdlciwgbmV3X2JvdW50eV9tYW5hZ2VyKTsKICAgICAgICAgICAgYm91bnR5TWFuYWdlciA9IG5ld19ib3VudHlfbWFuYWdlcjsKICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT0gQ29udHJhY3RNb2RlLlRva2VuU2FsZSkgewogICAgICAgICAgICBlbWl0IEJvdW50eU1hbmFnZXJBc3NpZ25lZChib3VudHlNYW5hZ2VyLCBuZXdfYm91bnR5X21hbmFnZXIpOwogICAgICAgICAgICBhZGRyZXNzIG9sZF9ib3VudHlfbWFuYWdlciA9IGJvdW50eU1hbmFnZXI7CiAgICAgICAgICAgIGJvdW50eU1hbmFnZXIgICAgICAgICAgICAgID0gbmV3X2JvdW50eV9tYW5hZ2VyOwogICAgICAgICAgICByZXF1aXJlKF90cmFuc2ZlcihvbGRfYm91bnR5X21hbmFnZXIsIG5ld19ib3VudHlfbWFuYWdlciwgaW52ZXN0b3JzW29sZF9ib3VudHlfbWFuYWdlcl0udG9rZW5CYWxhbmNlKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldERpdmlkZW5kTWFuYWdlcihhZGRyZXNzIG5ld19kaXZpZGVuZF9tYW5hZ2VyKSBwdWJsaWMgZ3JhbnRPd25lciB7CiAgICAgICAgZW1pdCBEaXZpZGVuZE1hbmFnZXJBc3NpZ25lZChkaXZpZGVuZE1hbmFnZXIsIG5ld19kaXZpZGVuZF9tYW5hZ2VyKTsKICAgICAgICBkaXZpZGVuZE1hbmFnZXIgPSBuZXdfZGl2aWRlbmRfbWFuYWdlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXREQXBwKGFkZHJlc3MgbmV3X2RhcHApIHB1YmxpYyBncmFudE93bmVyIHsKICAgICAgICBlbWl0IERBcHBBc3NpZ25lZChkQXBwLCBuZXdfZGFwcCk7CiAgICAgICAgZEFwcCA9IG5ld19kYXBwOwogICAgfQoKCgogICAgLyoqKioqKioqCiAgICAgICAgICAgICAgICBTZWN1cml0eSBhbmQgZnVuZHMgc2VjdGlvbgogICAgKioqKioqKiovCgogICAgZnVuY3Rpb24gdHJhbnNmZXJCb3VudHkoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGdyYW50Qm91bnR5TWFuYWdlciB7CiAgICAgICAgcmVxdWlyZShjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgcmVxdWlyZShtb2RlID09IENvbnRyYWN0TW9kZS5EaXZpZGVuZERpc3RyaWJ1dGlvbik7CiAgICAgICAgaWYgKF90cmFuc2Zlcihib3VudHlNYW5hZ2VyLCBfdG8sIF9hbW91bnQpKSB7CiAgICAgICAgICAgIGVtaXQgQm91bnR5VHJhbnNmZXJlZChfdG8sIF9hbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBidXJuVG9rZW5zKHVpbnQyNTYgdG9rZW5BbW91bnQpIHB1YmxpYyBncmFudE93bmVyIHsKICAgICAgICByZXF1aXJlKGNvbnRyYWN0SXNXb3JraW5nKTsKICAgICAgICByZXF1aXJlKG1vZGUgPT0gQ29udHJhY3RNb2RlLkRpdmlkZW5kRGlzdHJpYnV0aW9uKTsKICAgICAgICByZXF1aXJlKGludmVzdG9yc1ttc2cuc2VuZGVyXS50b2tlbkJhbGFuY2UgPiB0b2tlbkFtb3VudCk7CgogICAgICAgIGludmVzdG9yc1ttc2cuc2VuZGVyXS50b2tlbkJhbGFuY2UgLT0gdG9rZW5BbW91bnQ7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIodG9rZW5BbW91bnQpOwogICAgICAgIGVtaXQgQnVyblRva2VuKHRva2VuQW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd0Z1bmRzKHVpbnQgd2VpX3ZhbHVlKSBncmFudE93bmVyIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1vZGUgIT0gQ29udHJhY3RNb2RlLlVuZGVyU29mdENhcCk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHRoaXMpLmJhbGFuY2UgPj0gd2VpX3ZhbHVlKTsKCiAgICAgICAgZW1pdCBGdW5kc1dpdGhkcmF3YWwobXNnLnNlbmRlciwgd2VpX3ZhbHVlKTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHdlaV92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkRnVuZHMoKSBwdWJsaWMgcGF5YWJsZSBncmFudE93bmVyIHsKICAgICAgICByZXF1aXJlKGNvbnRyYWN0SXNXb3JraW5nKTsKICAgICAgICBlbWl0IEZ1bmRzQWRkZWQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXVzZUNvbnRyYWN0KCkgcHVibGljIGdyYW50T3duZXIgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RJc1dvcmtpbmcpOwogICAgICAgIGNvbnRyYWN0SXNXb3JraW5nID0gZmFsc2U7CiAgICAgICAgZW1pdCBIYW5kYnJha2UobW9kZSwgY29udHJhY3RJc1dvcmtpbmcpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlc3RvcmVDb250cmFjdCgpIHB1YmxpYyBncmFudE93bmVyIHsKICAgICAgICByZXF1aXJlKCFjb250cmFjdElzV29ya2luZyk7CiAgICAgICAgY29udHJhY3RJc1dvcmtpbmcgPSB0cnVlOwogICAgICAgIGVtaXQgSGFuZGJyYWtlKG1vZGUsIGNvbnRyYWN0SXNXb3JraW5nKTsKICAgIH0KCiAgICAvKioqKioqKioKICAgICAgICAgICAgICAgIEhlbHBlciBmdW5jdGlvbnMKICAgICoqKioqKioqLwogICAgZnVuY3Rpb24gY2FsY1Rva2VuVG9XZWkodWludDI1NiB0b2tlbl9hbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBidXlCYWNrUHJpY2VXZWkubXVsKHRva2VuX2Ftb3VudCkuZGl2KE9ORV9UT0tFTik7CiAgICB9Cn0='.
	

]
