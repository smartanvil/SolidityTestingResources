Class {
	#name : #SRTb9907e0151e8c5937f17d0721953cf1ea114528e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb9907e0151e8c5937f17d0721953cf1ea114528e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgovKioKICogQHRpdGxlIExpbmtlZExpc3RMaWIKICogQGF1dGhvciBEYXJyeWwgTW9ycmlzIChvMHJhZ21hbjBvKSBhbmQgTW9kdWxhci5uZXR3b3JrCiAqIAogKiBUaGlzIHV0aWxpdHkgbGlicmFyeSB3YXMgZm9ya2VkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL28wcmFnbWFuMG8vTGliQ0xMCiAqIGludG8gdGhlIE1vZHVsYXItTmV0d29yayBldGhlcmV1bS1saWJyYXJpZXMgcmVwbyBhdCBodHRwczovL2dpdGh1Yi5jb20vTW9kdWxhci1OZXR3b3JrL2V0aGVyZXVtLWxpYnJhcmllcwogKiBJdCBoYXMgYmVlbiB1cGRhdGVkIHRvIGFkZCBhZGRpdGlvbmFsIGZ1bmN0aW9uYWxpdHkgYW5kIGJlIG1vcmUgY29tcGF0aWJsZSB3aXRoIHNvbGlkaXR5IDAuNC4xOAogKiBjb2RpbmcgcGF0dGVybnMuCiAqCiAqIHZlcnNpb24gMS4wLjAKICogQ29weXJpZ2h0IChjKSAyMDE3IE1vZHVsYXIgSW5jLgogKiBUaGUgTUlUIExpY2Vuc2UgKE1JVCkKICogaHR0cHM6Ly9naXRodWIuY29tL01vZHVsYXItTmV0d29yay9ldGhlcmV1bS1saWJyYXJpZXMvYmxvYi9tYXN0ZXIvTElDRU5TRQogKiAKICogVGhlIExpbmtlZExpc3RMaWIgcHJvdmlkZXMgZnVuY3Rpb25hbGl0eSBmb3IgaW1wbGVtZW50aW5nIGRhdGEgaW5kZXhpbmcgdXNpbmcKICogYSBjaXJjbHVsYXIgbGlua2VkIGxpc3QKICoKICogTW9kdWxhciBwcm92aWRlcyBzbWFydCBjb250cmFjdCBzZXJ2aWNlcyBhbmQgc2VjdXJpdHkgcmV2aWV3cyBmb3IgY29udHJhY3QKICogZGVwbG95bWVudHMgaW4gYWRkaXRpb24gdG8gd29ya2luZyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbiB0aGUgRXRoZXJldW0KICogY29tbXVuaXR5LiBPdXIgcHVycG9zZSBpcyB0byB0ZXN0LCBkb2N1bWVudCwgYW5kIGRlcGxveSByZXVzYWJsZSBjb2RlIG9udG8gdGhlCiAqIGJsb2NrY2hhaW4gYW5kIGltcHJvdmUgYm90aCBzZWN1cml0eSBhbmQgdXNhYmlsaXR5LiBXZSBhbHNvIGVkdWNhdGUgbm9uLXByb2ZpdHMsCiAqIHNjaG9vbHMsIGFuZCBvdGhlciBjb21tdW5pdHkgbWVtYmVycyBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbgogKiB0ZWNobm9sb2d5LiBGb3IgZnVydGhlciBpbmZvcm1hdGlvbjogbW9kdWxhci5uZXR3b3JrCiAqCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCgpsaWJyYXJ5IExpbmtlZExpc3RMaWIgewoKICAgIHVpbnQyNTYgY29uc3RhbnQgTlVMTCA9IDA7CiAgICB1aW50MjU2IGNvbnN0YW50IEhFQUQgPSAwOwogICAgYm9vbCBjb25zdGFudCBQUkVWID0gZmFsc2U7CiAgICBib29sIGNvbnN0YW50IE5FWFQgPSB0cnVlOwogICAgCiAgICBzdHJ1Y3QgTGlua2VkTGlzdHsKICAgICAgICBtYXBwaW5nICh1aW50MjU2ID0+IG1hcHBpbmcgKGJvb2wgPT4gdWludDI1NikpIGxpc3Q7CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJucyB0cnVlIGlmIHRoZSBsaXN0IGV4aXN0cwogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBsaXN0RXhpc3RzKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldyByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIGlmIHRoZSBoZWFkIG5vZGVzIHByZXZpb3VzIG9yIG5leHQgcG9pbnRlcnMgYm90aCBwb2ludCB0byBpdHNlbGYsIHRoZW4gdGhlcmUgYXJlIG5vIGl0ZW1zIGluIHRoZSBsaXN0CiAgICAgICAgaWYgKHNlbGYubGlzdFtIRUFEXVtQUkVWXSAhPSBIRUFEIHx8IHNlbGYubGlzdFtIRUFEXVtORVhUXSAhPSBIRUFEKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJucyB0cnVlIGlmIHRoZSBub2RlIGV4aXN0cwogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9ub2RlIGEgbm9kZSB0byBzZWFyY2ggZm9yCiAgICBmdW5jdGlvbiBub2RlRXhpc3RzKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9ub2RlKSAKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoc2VsZi5saXN0W19ub2RlXVtQUkVWXSA9PSBIRUFEICYmIHNlbGYubGlzdFtfbm9kZV1bTkVYVF0gPT0gSEVBRCkgewogICAgICAgICAgICBpZiAoc2VsZi5saXN0W0hFQURdW05FWFRdID09IF9ub2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBsaXN0CiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIGZ1bmN0aW9uIHNpemVPZihMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IG51bUVsZW1lbnRzKSB7CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgdWludDI1NiBpOwogICAgICAgIChleGlzdHMsaSkgPSBnZXRBZGphY2VudChzZWxmLCBIRUFELCBORVhUKTsKICAgICAgICB3aGlsZSAoaSAhPSBIRUFEKSB7CiAgICAgICAgICAgIChleGlzdHMsaSkgPSBnZXRBZGphY2VudChzZWxmLCBpLCBORVhUKTsKICAgICAgICAgICAgbnVtRWxlbWVudHMrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGxpbmtzIG9mIGEgbm9kZSBhcyBhIHR1cGxlCiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25vZGUgaWQgb2YgdGhlIG5vZGUgdG8gZ2V0CiAgICBmdW5jdGlvbiBnZXROb2RlKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9ub2RlKQogICAgICAgIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCx1aW50MjU2LHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKCFub2RlRXhpc3RzKHNlbGYsX25vZGUpKSB7CiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsMCwwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKHRydWUsc2VsZi5saXN0W19ub2RlXVtQUkVWXSwgc2VsZi5saXN0W19ub2RlXVtORVhUXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGxpbmsgb2YgYSBub2RlIGBfbm9kZWAgaW4gZGlyZWN0aW9uIGBfZGlyZWN0aW9uYC4KICAgIC8vLyBAcGFyYW0gc2VsZiBzdG9yZWQgbGlua2VkIGxpc3QgZnJvbSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbm9kZSBpZCBvZiB0aGUgbm9kZSB0byBzdGVwIGZyb20KICAgIC8vLyBAcGFyYW0gX2RpcmVjdGlvbiBkaXJlY3Rpb24gdG8gc3RlcCBpbgogICAgZnVuY3Rpb24gZ2V0QWRqYWNlbnQoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX25vZGUsIGJvb2wgX2RpcmVjdGlvbikKICAgICAgICBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wsdWludDI1NikKICAgIHsKICAgICAgICBpZiAoIW5vZGVFeGlzdHMoc2VsZixfbm9kZSkpIHsKICAgICAgICAgICAgcmV0dXJuIChmYWxzZSwwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKHRydWUsc2VsZi5saXN0W19ub2RlXVtfZGlyZWN0aW9uXSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBDYW4gYmUgdXNlZCBiZWZvcmUgYGluc2VydGAgdG8gYnVpbGQgYW4gb3JkZXJlZCBsaXN0CiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25vZGUgYW4gZXhpc3Rpbmcgbm9kZSB0byBzZWFyY2ggZnJvbSwgZS5nLiBIRUFELgogICAgLy8vIEBwYXJhbSBfdmFsdWUgdmFsdWUgdG8gc2VlawogICAgLy8vIEBwYXJhbSBfZGlyZWN0aW9uIGRpcmVjdGlvbiB0byBzZWVrIGluCiAgICAvLyAgQHJldHVybiBuZXh0IGZpcnN0IG5vZGUgYmV5b25kICdfbm9kZScgaW4gZGlyZWN0aW9uIGBfZGlyZWN0aW9uYAogICAgZnVuY3Rpb24gZ2V0U29ydGVkU3BvdChMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfbm9kZSwgdWludDI1NiBfdmFsdWUsIGJvb2wgX2RpcmVjdGlvbikKICAgICAgICBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKHNpemVPZihzZWxmKSA9PSAwKSB7IHJldHVybiAwOyB9CiAgICAgICAgcmVxdWlyZSgoX25vZGUgPT0gMCkgfHwgbm9kZUV4aXN0cyhzZWxmLF9ub2RlKSk7CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgdWludDI1NiBuZXh0OwogICAgICAgIChleGlzdHMsbmV4dCkgPSBnZXRBZGphY2VudChzZWxmLCBfbm9kZSwgX2RpcmVjdGlvbik7CiAgICAgICAgd2hpbGUgICgobmV4dCAhPSAwKSAmJiAoX3ZhbHVlICE9IG5leHQpICYmICgoX3ZhbHVlIDwgbmV4dCkgIT0gX2RpcmVjdGlvbikpIG5leHQgPSBzZWxmLmxpc3RbbmV4dF1bX2RpcmVjdGlvbl07CiAgICAgICAgcmV0dXJuIG5leHQ7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbiBiZSB1c2VkIGJlZm9yZSBgaW5zZXJ0YCB0byBidWlsZCBhbiBvcmRlcmVkIGxpc3QKICAgIC8vLyBAcGFyYW0gc2VsZiBzdG9yZWQgbGlua2VkIGxpc3QgZnJvbSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbm9kZSBhbiBleGlzdGluZyBub2RlIHRvIHNlYXJjaCBmcm9tLCBlLmcuIEhFQUQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB2YWx1ZSB0byBzZWVrCiAgICAvLy8gQHBhcmFtIF9kaXJlY3Rpb24gZGlyZWN0aW9uIHRvIHNlZWsgaW4KICAgIC8vICBAcmV0dXJuIG5leHQgZmlyc3Qgbm9kZSBiZXlvbmQgJ19ub2RlJyBpbiBkaXJlY3Rpb24gYF9kaXJlY3Rpb25gCiAgICBmdW5jdGlvbiBnZXRTb3J0ZWRTcG90QnlGdW5jdGlvbihMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfbm9kZSwgdWludDI1NiBfdmFsdWUsIGJvb2wgX2RpcmVjdGlvbiwgZnVuY3Rpb24gKHVpbnQsIHVpbnQpIHZpZXcgcmV0dXJucyAoYm9vbCkgc21hbGxlckNvbXBhcmF0b3IsIGludDI1NiBzZWFyY2hMaW1pdCkKICAgICAgICBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgbmV4dE5vZGVJbmRleCwgYm9vbCBmb3VuZCwgdWludDI1NiBzaXplRW5kKQogICAgewogICAgICAgIGlmICgoc2l6ZUVuZD1zaXplT2Yoc2VsZikpID09IDApIHsgcmV0dXJuICgwLCB0cnVlLCBzaXplRW5kKTsgfQogICAgICAgIHJlcXVpcmUoKF9ub2RlID09IDApIHx8IG5vZGVFeGlzdHMoc2VsZixfbm9kZSkpOwogICAgICAgIGJvb2wgZXhpc3RzOwogICAgICAgIHVpbnQyNTYgbmV4dDsKICAgICAgICAoZXhpc3RzLG5leHQpID0gZ2V0QWRqYWNlbnQoc2VsZiwgX25vZGUsIF9kaXJlY3Rpb24pOwogICAgICAgIHdoaWxlICAoKC0tc2VhcmNoTGltaXQgPj0gMCkgJiYgKG5leHQgIT0gMCkgJiYgKF92YWx1ZSAhPSBuZXh0KSAmJiAoc21hbGxlckNvbXBhcmF0b3IoX3ZhbHVlLCBuZXh0KSAhPSBfZGlyZWN0aW9uKSkgbmV4dCA9IHNlbGYubGlzdFtuZXh0XVtfZGlyZWN0aW9uXTsKICAgICAgICBpZihzZWFyY2hMaW1pdCA+PSAwKQogICAgICAgICAgICByZXR1cm4gKG5leHQsIHRydWUsIHNpemVFbmQgKyAxKTsKICAgICAgICBlbHNlIHJldHVybiAoMCwgZmFsc2UsIHNpemVFbmQpOyAvL1dlIGV4aGF1c3RlZCB0aGUgc2VhcmNoIGxpbWl0IHdpdGhvdXQgZmluZGluZyBhIHBvc2l0aW9uIQogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYSBiaWRpcmVjdGlvbmFsIGxpbmsgYmV0d2VlbiB0d28gbm9kZXMgb24gZGlyZWN0aW9uIGBfZGlyZWN0aW9uYAogICAgLy8vIEBwYXJhbSBzZWxmIHN0b3JlZCBsaW5rZWQgbGlzdCBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9ub2RlIGZpcnN0IG5vZGUgZm9yIGxpbmtpbmcKICAgIC8vLyBAcGFyYW0gX2xpbmsgIG5vZGUgdG8gbGluayB0byBpbiB0aGUgX2RpcmVjdGlvbgogICAgZnVuY3Rpb24gY3JlYXRlTGluayhMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfbm9kZSwgdWludDI1NiBfbGluaywgYm9vbCBfZGlyZWN0aW9uKSBpbnRlcm5hbCAgewogICAgICAgIHNlbGYubGlzdFtfbGlua11bIV9kaXJlY3Rpb25dID0gX25vZGU7CiAgICAgICAgc2VsZi5saXN0W19ub2RlXVtfZGlyZWN0aW9uXSA9IF9saW5rOwogICAgfQoKICAgIC8vLyBAZGV2IEluc2VydCBub2RlIGBfbmV3YCBiZXNpZGUgZXhpc3Rpbmcgbm9kZSBgX25vZGVgIGluIGRpcmVjdGlvbiBgX2RpcmVjdGlvbmAuCiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25vZGUgZXhpc3Rpbmcgbm9kZQogICAgLy8vIEBwYXJhbSBfbmV3ICBuZXcgbm9kZSB0byBpbnNlcnQKICAgIC8vLyBAcGFyYW0gX2RpcmVjdGlvbiBkaXJlY3Rpb24gdG8gaW5zZXJ0IG5vZGUgaW4KICAgIGZ1bmN0aW9uIGluc2VydChMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfbm9kZSwgdWludDI1NiBfbmV3LCBib29sIF9kaXJlY3Rpb24pIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZighbm9kZUV4aXN0cyhzZWxmLF9uZXcpICYmIG5vZGVFeGlzdHMoc2VsZixfbm9kZSkpIHsKICAgICAgICAgICAgdWludDI1NiBjID0gc2VsZi5saXN0W19ub2RlXVtfZGlyZWN0aW9uXTsKICAgICAgICAgICAgY3JlYXRlTGluayhzZWxmLCBfbm9kZSwgX25ldywgX2RpcmVjdGlvbik7CiAgICAgICAgICAgIGNyZWF0ZUxpbmsoc2VsZiwgX25ldywgYywgX2RpcmVjdGlvbik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IHJlbW92ZXMgYW4gZW50cnkgZnJvbSB0aGUgbGlua2VkIGxpc3QKICAgIC8vLyBAcGFyYW0gc2VsZiBzdG9yZWQgbGlua2VkIGxpc3QgZnJvbSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbm9kZSBub2RlIHRvIHJlbW92ZSBmcm9tIHRoZSBsaXN0CiAgICBmdW5jdGlvbiByZW1vdmUoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX25vZGUpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoKF9ub2RlID09IE5VTEwpIHx8ICghbm9kZUV4aXN0cyhzZWxmLF9ub2RlKSkpIHsgcmV0dXJuIDA7IH0KICAgICAgICBjcmVhdGVMaW5rKHNlbGYsIHNlbGYubGlzdFtfbm9kZV1bUFJFVl0sIHNlbGYubGlzdFtfbm9kZV1bTkVYVF0sIE5FWFQpOwogICAgICAgIGRlbGV0ZSBzZWxmLmxpc3RbX25vZGVdW1BSRVZdOwogICAgICAgIGRlbGV0ZSBzZWxmLmxpc3RbX25vZGVdW05FWFRdOwogICAgICAgIHJldHVybiBfbm9kZTsKICAgIH0KCiAgICAvLy8gQGRldiBwdXNoZXMgYW4gZW5ydHkgdG8gdGhlIGhlYWQgb2YgdGhlIGxpbmtlZCBsaXN0CiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25vZGUgbmV3IGVudHJ5IHRvIHB1c2ggdG8gdGhlIGhlYWQKICAgIC8vLyBAcGFyYW0gX2RpcmVjdGlvbiBwdXNoIHRvIHRoZSBoZWFkIChORVhUKSBvciB0YWlsIChQUkVWKQogICAgZnVuY3Rpb24gcHVzaChMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfbm9kZSwgYm9vbCBfZGlyZWN0aW9uKSBpbnRlcm5hbCAgewogICAgICAgIGluc2VydChzZWxmLCBIRUFELCBfbm9kZSwgX2RpcmVjdGlvbik7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IHBvcHMgdGhlIGZpcnN0IGVudHJ5IGZyb20gdGhlIGxpbmtlZCBsaXN0CiAgICAvLy8gQHBhcmFtIHNlbGYgc3RvcmVkIGxpbmtlZCBsaXN0IGZyb20gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2RpcmVjdGlvbiBwb3AgZnJvbSB0aGUgaGVhZCAoTkVYVCkgb3IgdGhlIHRhaWwgKFBSRVYpCiAgICBmdW5jdGlvbiBwb3AoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIGJvb2wgX2RpcmVjdGlvbikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGJvb2wgZXhpc3RzOwogICAgICAgIHVpbnQyNTYgYWRqOwoKICAgICAgICAoZXhpc3RzLGFkaikgPSBnZXRBZGphY2VudChzZWxmLCBIRUFELCBfZGlyZWN0aW9uKTsKCiAgICAgICAgcmV0dXJuIHJlbW92ZShzZWxmLCBhZGopOwogICAgfQp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICdDb2tlJyB0b2tlbiBjb250cmFjdAovLwovLyBEZXBsb3llZCB0byA6IDB4Yjk5MDdlMDE1MWU4YzU5MzdmMTdkMDcyMTk1M2NmMWVhMTE0NTI4ZQovLyBTeW1ib2wgICAgICA6IENPS0UKLy8gTmFtZSAgICAgICAgOiBDb2tlIFRva2VuCi8vIFRvdGFsIHN1cHBseTogODc1IDAwMCAwMDAgMDAwIDAwMCBtaWNyb2dyYW1zICg4NzUgdG9ucykKLy8gRGVjaW1hbHMgICAgOiA2IChtaWNyb2dyYW1zKQovLwovLyBAMjAxOCBGQwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBTYWZlIG1hdGhzCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgcHVibGljIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgYyA9IGEgKyBiOwogICAgICAgIHJlcXVpcmUoYyA+PSBhICYmIGMgPj0gYik7CiAgICB9CiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50IGMpIHsKICAgICAgICByZXF1aXJlKGIgPD0gYSk7CiAgICAgICAgYyA9IGEgLSBiOwogICAgfQogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgcHVibGljIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgYyA9IGEgKiBiOwogICAgICAgIHJlcXVpcmUoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgfQogICAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgcHVibGljIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgcmVxdWlyZShiID4gMCk7CiAgICAgICAgYyA9IGEgLyBiOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBtaW4odWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gbWF4KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KfQoKY29udHJhY3QgTXV0ZXggewogICAgYm9vbCBsb2NrZWQ7CiAgICBtb2RpZmllciBub1JlZW50cmFuY3koKSB7CiAgICAgICAgcmVxdWlyZSghbG9ja2VkKTsKICAgICAgICBsb2NrZWQgPSB0cnVlOwogICAgICAgIF87CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICB9Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRVJDIFRva2VuIFN0YW5kYXJkICMyMCBJbnRlcmZhY2UKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBFUkMyMEludGVyZmFjZSB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHRva2Vucyk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgdG9rZW5Pd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdG9rZW5zKTsKfQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQ29udHJhY3QgZnVuY3Rpb24gdG8gcmVjZWl2ZSBhcHByb3ZhbCBhbmQgZXhlY3V0ZSBmdW5jdGlvbiBpbiBvbmUgY2FsbAovLwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiB0b2tlbnMsIGFkZHJlc3MgdG9rZW4sIGJ5dGVzIGRhdGEpIHB1YmxpYzsKfQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBPd25lZCBjb250cmFjdAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IE93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7CgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCiAgICBmdW5jdGlvbiBPd25lZCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld093bmVyKTsKICAgICAgICBlbWl0IE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICBuZXdPd25lciA9IGFkZHJlc3MoMCk7CiAgICB9Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQ29udHJhY3QgIlJlY292ZXJhYmxlIiwgdG8gYWxsb3cgYSBmYWlsc2FmZSBpbiBjYXNlIG9mIHVzZXIgZXJyb3IsIHNvIHVzZXJzIGNhbiByZWNvdmVyIHRoZWlyIG1pc3Rha2VubHkgc2VudCBUb2tlbnMgb3IgRXRoCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9kYXBwLWJpbi9ibG9iL21hc3Rlci9saWJyYXJ5L3JlY292ZXJhYmxlLnNvbAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IFJlY292ZXJhYmxlIGlzIE93bmVkIHsKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gT3duZXIgY2FuIHRyYW5zZmVyIG91dCBhbnkgYWNjaWRlbnRhbGx5IHNlbnQgRVJDMjAgdG9rZW5zCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyQW55RVJDMjBUb2tlbihhZGRyZXNzIHRva2VuQWRkcmVzcywgdWludCB0b2tlbnMpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIEVSQzIwSW50ZXJmYWNlKHRva2VuQWRkcmVzcykudHJhbnNmZXIob3duZXIsIHRva2Vucyk7CiAgICB9CiAgICAKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gT3duZXIgY2FuIHRyYW5zZmVyIG91dCBhbnkgYWNjaWRlbnRhbGx5IHNlbnQgRVRICiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHJlY292ZXJMb3N0RXRoKGFkZHJlc3MgdG9BZGRyZXNzLCB1aW50IHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHRvQWRkcmVzcy50cmFuc2Zlcih2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgRW1lcmdlbmN5UHJvdGVjdGVkTW9kZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20gZGlmZmVyZW50IHRoYW4gcGF1c2FibGUuIFVzZWZ1bCBmb3Igd2hlbiB3ZSB3YW50IHRvIAogKiBzdG9wIHRoZSBub3JtYWwgYnVzaW5lc3Mgb2YgdGhlIGNvbnRyYWN0ICh1c2luZyB0aGUgUGF1c2FibGUgY29udHJhY3QpLCBidXQgc3RpbGwgYWxsb3cgc29tZSBvcGVyYXRpb25zIGxpa2Ugd2l0aGRyYXdscyBmb3IgdXNlcnMuCiAqLwpjb250cmFjdCBFbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlIGlzIE93bmVkIHsKICBldmVudCBFbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlQWN0aXZhdGVkKCk7CiAgZXZlbnQgRW1lcmdlbmN5UHJvdGVjdGVkTW9kZURlYWN0aXZhdGVkKCk7CgogIGJvb2wgcHVibGljIGVtZXJnZW5jeVByb3RlY3RlZE1vZGUgPSBmYWxzZTsKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RJbkVtZXJnZW5jeVByb3RlY3RlZE1vZGUoKSB7CiAgICByZXF1aXJlKCFlbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuSW5FbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlKCkgewogICAgcmVxdWlyZShlbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gYWN0aXZhdGUgZW1lcmdlbmN5IHByb3RlY3RlZCBtb2RlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlLCB0byB1c2UgaW4gY2FzZSBvZiBsYXN0IHJlc29ydCwgYW5kIHN0b3AgZXZlbiBsYXN0IGNhc2Ugb3BlcmF0aW9ucyAoaW4gY2FzZSBvZiBhIHNlY3VyaXR5IGNvbXByb21pc2UpCiAgICovCiAgZnVuY3Rpb24gYWN0aXZhdGVFbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlKCkgb25seU93bmVyIHdoZW5Ob3RJbkVtZXJnZW5jeVByb3RlY3RlZE1vZGUgcHVibGljIHsKICAgIGVtZXJnZW5jeVByb3RlY3RlZE1vZGUgPSB0cnVlOwogICAgZW1pdCBFbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlQWN0aXZhdGVkKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gZGVhY3RpdmF0ZSBlbWVyZ2VuY3kgcHJvdGVjdGVkIG1vZGUsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gZGVhY3RpdmF0ZUVtZXJnZW5jeVByb3RlY3RlZE1vZGUoKSBvbmx5T3duZXIgd2hlbkluRW1lcmdlbmN5UHJvdGVjdGVkTW9kZSBwdWJsaWMgewogICAgZW1lcmdlbmN5UHJvdGVjdGVkTW9kZSA9IGZhbHNlOwogICAgZW1pdCBFbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlRGVhY3RpdmF0ZWQoKTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duZWQgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBlbWl0IFBhdXNlKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgZW1pdCBVbnBhdXNlKCk7CiAgfQp9CgovKioKICogQHRpdGxlIE1pZ3JhdGFibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBiZSBtaWdyYXRhYmxlLCB0aGF0IGlzIGl0IGFsbG93cyBjb250cmFjdHMgdG8gbWlncmF0ZSB0byBhbm90aGVyIGNvbnRyYWN0IChzdWNlc3NvcikgdGhhdCAKICogaXMgYSBtb3JlIGFkdmFuY2VkIHZlcnNpb24gb2YgdGhlIHByZXZpb3VzIGNvbnRyYWN0IChtb3JlIGZ1bmN0aW9uYWxpdHksIGltcHJvdmVkIHNlY3VyaXR5LCBldGMuKS4KICovCmNvbnRyYWN0IE1pZ3JhdGFibGUgaXMgT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgc3VjZXNzb3I7IC8vQnkgZGVmYXVsdCwgc3VjZXNzb3Igd2lsbCBiZSBhZGRyZXNzIDAsIG1lYW5pbmcgdGhlIGN1cnJlbnQgY29udHJhY3QgaXMgc3RpbGwgYWN0aXZlIGFuZCBoYXMgbm8gc3VjZXNzb3IgeWV0IQogICAgZnVuY3Rpb24gc2V0U3VjZXNzb3IoYWRkcmVzcyBfc3VjZXNzb3IpIG9ubHlPd25lciBwdWJsaWMgewogICAgICBzdWNlc3Nvcj1fc3VjZXNzb3I7CiAgICB9Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBEaXJlY3RseSBFeGNoYW5nZWFibGUgdG9rZW4KLy8gVGhpcyB3aWxsIGFsbG93IHVzZXJzIHRvIGRpcmVjdGx5IGV4Y2hhbmdlIGJldHdlZW4gdGhlbXNlbHZlcyB0b2tlbnMgZm9yIEV0aCBhbmQgdmljZSB2ZXJzYSwgCi8vIHdoaWxlIGhhdmluZyB0aGUgYXNzdXJhbmNlIHRoZSBvdGhlciBwYXJ0eSB3aWxsIGJlIGtlcHQgdG8gdGhlaXIgcGFydCBvZiB0aGUgYWdyZWVtZW50LgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgRGlyZWN0bHlFeGNoYW5nZWFibGUgewogICAgYm9vbCBwdWJsaWMgaXNSYXRpbzsgLy9TaG91bGQgYmUgdHJ1ZSBpZiB0aGUgcHJpY2VzIHVzZWQgd2lsbCBiZSBhIFJhdGlvLCBhbmQgbm90IGp1c3QgYSBzaW1wbGUgcHJpY2UsIG90aGVyd2lzZSBmYWxzZS4KCiAgICBmdW5jdGlvbiBzZWxsVG9Db25zdW1lcihhZGRyZXNzIGNvbnN1bWVyLCB1aW50IHF1YW50aXR5LCB1aW50IHByaWNlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGJ1eUZyb21UcnVzdGVyRGVhbGVyKGFkZHJlc3MgZGVhbGVyLCB1aW50IHF1YW50aXR5LCB1aW50IHByaWNlKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gY2FuY2VsU2VsbFRvQ29uc3VtZXIoYWRkcmVzcyBjb25zdW1lcikgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBjaGVja015U2VsbGVyT2ZmZXIoYWRkcmVzcyBjb25zdW1lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBxdWFudGl0eSwgdWludCBwcmljZSwgdWludCB0b3RhbFdlaUNvc3QpOwogICAgZnVuY3Rpb24gY2hlY2tTZWxsZXJPZmZlcihhZGRyZXNzIHNlbGxlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBxdWFudGl0eSwgdWludCBwcmljZSwgdWludCB0b3RhbFdlaUNvc3QpOwoKICAgIC8vRXZlbnRzOgogICAgZXZlbnQgRGlyZWN0T2ZmZXJBdmFpbGFibGUoYWRkcmVzcyBpbmRleGVkIHNlbGxlciwgYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50IHF1YW50aXR5LCB1aW50IHByaWNlKTsKICAgIGV2ZW50IERpcmVjdE9mZmVyQ2FuY2VsbGVkKGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIGFkZHJlc3MgaW5kZXhlZCBjb25zdW1lciwgdWludCBxdWFudGl0eSwgdWludCBwcmljZSk7CiAgICBldmVudCBPcmRlclF1YW50aXR5TWlzbWF0Y2goYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQgZXhwZWN0ZWRJblJlZ2lzdHJ5LCB1aW50IGJ1eWVyVmFsdWUpOwogICAgZXZlbnQgT3JkZXJQcmljZU1pc21hdGNoKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50IGV4cGVjdGVkSW5SZWdpc3RyeSwgdWludCBidXllclZhbHVlKTsKfQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEJsYWNrIE1hcmtldCBTZWxsYWJsZSB0b2tlbgovLyBUaGlzIHdpbGwgYWxsb3cgdXNlcnMgdG8gc2VsbCBhbmQgYnV5IGZyb20gYSBibGFjayBtYXJrZXQsIHdpdGhvdXQga25vd2luZyBvbmUgYW5vdGhlciwgCi8vIHdoaWxlIGhhdmluZyB0aGUgYXNzdXJhbmNlIHRoZSBvdGhlciBwYXJ0eSB3aWxsIGtlZXAgdGhlaXIgcGFydCBvZiB0aGUgYWdyZWVtZW50LgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgQmxhY2tNYXJrZXRTZWxsYWJsZSB7CiAgICBib29sIHB1YmxpYyBpc1JhdGlvOyAvL1Nob3VsZCBiZSB0cnVlIGlmIHRoZSBwcmljZXMgdXNlZCB3aWxsIGJlIGEgUmF0aW8sIGFuZCBub3QganVzdCBhIHNpbXBsZSBwcmljZSwgb3RoZXJ3aXNlIGZhbHNlLgoKICAgIGZ1bmN0aW9uIHNlbGxUb0JsYWNrTWFya2V0KHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2UpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MsIHVpbnQgbnVtT3JkZXJDcmVhdGVkKTsKICAgIGZ1bmN0aW9uIGNhbmNlbFNlbGxUb0JsYWNrTWFya2V0KHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2UsIGJvb2wgY29udGludWVBZnRlckZpcnN0TWF0Y2gpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MsIHVpbnQgbnVtT3JkZXJzQ2FuY2VsZWQpOwogICAgZnVuY3Rpb24gYnV5RnJvbUJsYWNrTWFya2V0KHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2VMaW1pdCkgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzLCBib29sIHBhcnRpYWwsIHVpbnQgbnVtT3JkZXJzQ2xlYXJlZCk7CiAgICBmdW5jdGlvbiBnZXRTZWxsT3JkZXJzQmxhY2tNYXJrZXQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50W10gbWVtb3J5IHIpOwogICAgZnVuY3Rpb24gZ2V0U2VsbE9yZGVyc0JsYWNrTWFya2V0Q29tcGxldGUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50W10gbWVtb3J5IHF1YW50aXRpZXMsIHVpbnRbXSBtZW1vcnkgcHJpY2VzKTsKICAgIGZ1bmN0aW9uIGdldE15U2VsbE9yZGVyc0JsYWNrTWFya2V0Q29tcGxldGUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50W10gbWVtb3J5IHF1YW50aXRpZXMsIHVpbnRbXSBtZW1vcnkgcHJpY2VzKTsKCiAgICAvL0V2ZW50czoKICAgIGV2ZW50IEJsYWNrTWFya2V0T2ZmZXJBdmFpbGFibGUodWludCBxdWFudGl0eSwgdWludCBwcmljZSk7CiAgICBldmVudCBCbGFja01hcmtldE9mZmVyQm91Z2h0KHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2UsIHVpbnQgbGVmdE92ZXIpOwogICAgZXZlbnQgQmxhY2tNYXJrZXROb09mZmVyRm9yUHJpY2UodWludCBwcmljZSk7CiAgICBldmVudCBCbGFja01hcmtldE9mZmVyQ2FuY2VsbGVkKHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2UpOwogICAgZXZlbnQgT3JkZXJJbnN1ZmZpY2llbnRQYXltZW50KGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50IGV4cGVjdGVkVmFsdWUsIHVpbnQgdmFsdWVSZWNlaXZlZCk7CiAgICBldmVudCBPcmRlckluc3VmZmljaWVudEJhbGFuY2UoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQgZXhwZWN0ZWRCYWxhbmNlLCB1aW50IGFjdHVhbEJhbGFuY2UpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVSQzIwIFRva2VuLCB3aXRoIHRoZSBhZGRpdGlvbiBvZiBzeW1ib2wsIG5hbWUgYW5kIGRlY2ltYWxzIGFuZCBhc3Npc3RlZAovLyB0b2tlbiB0cmFuc2ZlcnMKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBDb2tlIGlzIEVSQzIwSW50ZXJmYWNlLCBPd25lZCwgUGF1c2FibGUsIEVtZXJnZW5jeVByb3RlY3RlZE1vZGUsIFJlY292ZXJhYmxlLCBNdXRleCwgTWlncmF0YWJsZSwgRGlyZWN0bHlFeGNoYW5nZWFibGUsIEJsYWNrTWFya2V0U2VsbGFibGUsIFNhZmVNYXRoIHsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgc3RyaW5nIHB1YmxpYyAgbmFtZTsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICAgIHVpbnQgcHVibGljIF90b3RhbFN1cHBseTsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICAgIC8vTmVlZGVkIHNldHVwIGZvciBMaW5rZWRMaXN0IG5lZWRlZCBmb3IgdGhlIG1hcmtldDoKICAgIHVzaW5nIExpbmtlZExpc3RMaWIgZm9yIExpbmtlZExpc3RMaWIuTGlua2VkTGlzdDsKICAgIHVpbnQyNTYgY29uc3RhbnQgTlVMTCA9IDA7CiAgICB1aW50MjU2IGNvbnN0YW50IEhFQUQgPSAwOwogICAgYm9vbCBjb25zdGFudCBQUkVWID0gZmFsc2U7CiAgICBib29sIGNvbnN0YW50IE5FWFQgPSB0cnVlOwoKICAgIC8vVG9rZW4gc3BlY2lmaWMgcHJvcGVydGllczoKCiAgICB1aW50MTYgcHVibGljIGNvbnN0YW50IHllYXJPZlByb2R1Y3Rpb24gPSAxOTk3OwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBwcm90ZWN0ZWREZW5vbWluYXRpb25PZk9yaWdpbiA9ICJDb2xvbWJpYSI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHRhcmdldERlbW9ncmFwaGljcyA9ICJUaGUgamV0IHNldCAvIFRvcCBvZiB0aGUgdG9wcyI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHNlY3VyaXR5QXVkaXQgPSAiRXh0cmVtZUFzc2V0cyBUZWFtIFJlZjogWE44NzIgQXBwcm92ZWQiOwogICAgdWludCBidXlSYXRpbzsgLy9SYXRpbyB0byBidXkgZnJvbSB0aGUgY29udHJhY3QgZGlyZWN0bHkKICAgIHVpbnQgc2VsbFJhdGlvOyAvL1JhdGlvIHRvIHNlbGwgZnJvbSB0aGUgY29udHJhY3QgZGlyZWN0bHkKICAgIHVpbnQgcHJpdmF0ZSBfZmFjdG9yRGVjaW1hbHNFdGhUb1Rva2VuOwogICAgdWludCBjb25zdGFudCB1bmRlcmdyb3VuZEJ1bmtlclJlc2VydmVzID0gMjUwMDAwMDAwMDAwMDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBjaGFuZ2VUb1JldHVybjsgLy9UaGUgY2hhbmdlIHRvIHJldHVybiB0byBzZW5kZXJzIChpbiBFVEggdmFsdWUgKFdlaSkpCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgZ2FpbnNUb1JlY2VpdmU7IC8vVGhlIGdhaW5zIHRvIHJlY2VpdmUgKGZvciBzZWxsZXJzKSAoaW4gRVRIIHZhbHVlIChXZWkpKQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHRhc3RlcnNSZWNlaXZlZDsgLy9OdW1iZXIgb2YgdG9rZW5zIHJlY2VpdmVkIGFzIGEgdGFzdGVyIGZvciBlYWNoIGFkZHJlc3MKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSB0b0ZsdXNoOyAvL0tlZXBzIGFkZHJlc3MgdG8gYmUgZmx1c2hlZCAodGhlIHZhbHVlIHN0b3JlZCBpcyB0aGUgbnVtYmVyIG9mIHRoZSBibG9jayBvZiB3aGVuIGNva2UgY2FuIGJlIHJlYWxseSBmbHVzaGVkIGZyb20gdGhlIHN5c3RlbSkKCiAgICBldmVudCBGbHVzaGVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyKTsKICAgIGV2ZW50IENoYW5nZVRvUmVjZWl2ZUdvdHRlbihhZGRyZXNzIGluZGV4ZWQgYWRkciwgdWludCB3ZWlUb1JlY2VpdmUsIHVpbnQgdG90YWxXZWlUb1JlY2VpdmUpOwogICAgZXZlbnQgR2FpbnNHb3R0ZW4oYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQgd2VpVG9SZWNlaXZlLCB1aW50IHRvdGFsV2VpVG9SZWNlaXZlKTsKICAgIAogICAgc3RydWN0IFNlbGxPZmZlciB7CiAgICAgICAgdWludCBwcmljZTsKICAgICAgICB1aW50IHF1YW50aXR5OwogICAgfQogICAgc3RydWN0IFNlbGxPZmZlckNvbXBsZXRlIHsKICAgICAgICB1aW50IHByaWNlOwogICAgICAgIHVpbnQgcXVhbnRpdHk7CiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICB9CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IFNlbGxPZmZlcikpIGRpcmVjdE9mZmVyczsgLy9EaXJlY3Qgb2ZmZXJzCiAgICBMaW5rZWRMaXN0TGliLkxpbmtlZExpc3QgYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQ7CiAgICBtYXBwaW5nKHVpbnQgPT4gU2VsbE9mZmVyQ29tcGxldGUpIHB1YmxpYyBibGFja01hcmtldE9mZmVyc01hcDsKICAgIHVpbnQgbWFya2V0T2ZmZXJDb3VudGVyID0gMDsgLy9Db3VudGVyIHRoYXQgd2lsbCBpbmNyZW1lbnQgZm9yIGVhY2ggb2ZmZXIKCiAgICB1aW50IGRpcmVjdE9mZmVyc0NvbWlzc2lvblJhdGlvID0gMTAwOyAvL1JhdGlvIG9mIHRoZSBjb21pc3Npb24gdG8gYnV5IGZyb20gdGhlIGNvbnRyYWN0IGRpcmVjdGx5ICgxJSkKICAgIHVpbnQgbWFya2V0Q29taXNzaW9uUmF0aW8gPSA1MDsgLy9SYXRpbyBvZiB0aGUgY29taXNzaW9uIHRvIGJ1eSBmcm9tIHRoZSBtYXJrZXQgKDIlKQogICAgaW50MzIgbWF4TWFya2V0T2ZmZXJzID0gMTAwOyAvL01heGltdW0gb2YgbWFya2V0IG9mZmVycyBhdCB0aGUgc2FtZSB0aW1lICh3aWxsIG9ubHkga2VlcCB0aGUgTiBsZXNzIGNvc3RseSBvZmZlcnMpCgogICAgLy9NZXNzYWdlIGJvYXJkIHZhcmlhYmxlczoKICAgIHN0cnVjdCBNZXNzYWdlIHsKICAgICAgICB1aW50IHZhbHVlUGF5ZWQ7CiAgICAgICAgc3RyaW5nIG1zZzsKICAgICAgICBhZGRyZXNzIGZyb207CiAgICB9CiAgICBMaW5rZWRMaXN0TGliLkxpbmtlZExpc3QgdG9wTWVzc2FnZXNTb3J0ZWQ7CiAgICBtYXBwaW5nKHVpbnQgPT4gTWVzc2FnZSkgcHVibGljIHRvcE1lc3NhZ2VzTWFwOwogICAgdWludCB0b3BNZXNzYWdlc0NvdW50ZXIgPSAwOyAvL0NvdW50ZXIgdGhhdCB3aWxsIGluY3JlbWVudCBmb3IgZWFjaCBtZXNzYWdlCiAgICBpbnQzMiBtYXhNZXNzYWdlc1RvcCA9IDIwOyAvL01heGltdW0gb2YgdG9wIG1lc3NhZ2VzIGF0IHRoZSBzYW1lIHRpbWUgKHdpbGwga2VlcCB0aGUgTiBtb3N0IHBheWVkIG1lc3NhZ2VzKQogICAgTWVzc2FnZVtdIG1lc3NhZ2VzOwogICAgaW50MzIgbWF4TWVzc2FnZXNHbG9iYWwgPSAxMDA7IC8vTWF4aW11bSBudW1iZXIgb2YgbWVzc2FnZXMgYXQgdGhlIHNhbWUgdGltZSAod2lsbCBrZWVwIHRoZSBOIG1vc3QgcmVjZW50bHkgcmVjZWl2ZWQgbWVzc2FnZXMpCiAgICBpbnQzMiBmaXJzdE1zZ0dsb2JhbCA9IDA7IC8vSW5kZXhlcyB0aGF0IHdpbGwgbWFyayB0aGUgZmlyc3QgYW5kIHRoZSBsYXN0IG1lc3NhZ2UgcmVjZWl2ZWQgaW4gdGhlIGFycmF5IG9mIGdsb2JhbCBtZXNzYWdlcyAocmV2b2x2aW5nIGFycmF5KQogICAgaW50MzIgbGFzdE1zZ0dsb2JhbCA9IC0xOwogICAgdWludCBtYXhDaGFyYWN0ZXJzTWVzc2FnZSA9IDc1MDsgLy9UaGUgbWF4aW11bSBvZiBjaGFyYWN0ZXJzIGEgbWVzc2FnZSBjYW4gaGF2ZQoKICAgIGV2ZW50IE5ld01lc3NhZ2VBdmFpbGFibGUoYWRkcmVzcyBpbmRleGVkIGZyb20sIHN0cmluZyBtZXNzYWdlKTsKICAgIGV2ZW50IEV4Y2VlZGVkTWF4aW11bU1lc3NhZ2VTaXplKHVpbnQgbWVzc2FnZVNpemUsIHVpbnQgbWF4aW11bU1lc3NhZ2VTaXplKTsgLy9NZXNzYWdlIGlzIGJpZ2dlciB0aGFuIG1heGltdW0gYWxsb3dlZCBjaGFyYWN0ZXJzIGZvciBlYWNoIG1lc3NhZ2UKCiAgICAvL0FkZHJlc3NlcyB0byBiZSB1c2VkIGZvciByYW5kb20gbGV0SXRSYWluIQogICAgYWRkcmVzc1tdIGxhc3RBZGRyZXNzZXM7CiAgICBpbnQzMiBtYXhBZGRyZXNzZXMgPSAxMDA7IC8vTWF4aW11bSBudW1iZXIgb2YgYWRkcmVzc2VzIGF0IHRoZSBzYW1lIHRpbWUgKHdpbGwga2VlcCB0aGUgTiBtb3N0IHJlY2VudGx5IG1lbnRpb25lZCBhZGRyZXNzZXMpCiAgICBpbnQzMiBmaXJzdEFkZHJlc3MgPSAwOyAvL0luZGV4ZXMgdGhhdCB3aWxsIG1hcmsgdGhlIGZpcnN0IGFuZCB0aGUgbGFzdCBhZGRyZXNzIHJlY2VpdmVkIGluIHRoZSBhcnJheSBvZiBsYXN0IGFkZHJlc3NlcyAocmV2b2x2aW5nIGFycmF5KQogICAgaW50MzIgbGFzdEFkZHJlc3MgPSAtMTsKICAgIAogICAgZXZlbnQgTm9BZGRyZXNzZXNBdmFpbGFibGUoKTsKICAgIAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBDb25maXJtcyB0aGUgdXNlciBpcyBub3QgaW4gdGhlIG1pZGRsZSBvZiBhIGZsdXNoaW5nIHByb2Nlc3MKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgbW9kaWZpZXIgd2hlbk5vdEZsdXNoaW5nKCkgewogICAgICAgIHJlcXVpcmUodG9GbHVzaFttc2cuc2VuZGVyXSA9PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gQ29rZSgpIHB1YmxpYyB7CiAgICAgICAgc3ltYm9sID0gIkNva2UiOwogICAgICAgIG5hbWUgPSAiMTAwICUgUHVyZSBDb2NhaW5lIjsKICAgICAgICBkZWNpbWFscyA9IDY7IC8vTWljcm9ncmFtcwogICAgICAgIF90b3RhbFN1cHBseSA9IDg3NTAwMDAwMCAqICh1aW50KDEwKSoqZGVjaW1hbHMpOwogICAgICAgIF9mYWN0b3JEZWNpbWFsc0V0aFRvVG9rZW4gPSB1aW50KDEwKSoqKDE4KTsKICAgICAgICBidXlSYXRpbyA9IDEwICogKHVpbnQoMTApKipkZWNpbWFscyk7IC8vMTBnIDwtIDEgRVRICiAgICAgICAgc2VsbFJhdGlvID0gMjAgKiAodWludCgxMCkqKmRlY2ltYWxzKTsgLy8yMGcgLT4gMSBFVEgKICAgICAgICBpc1JhdGlvID0gdHJ1ZTsgLy9CdXkgYW5kIHNlbGwgcHJpY2VzIGFyZSByYXRpb3MgKGFuZCBub3Qgc2ltcGxlIHByaWNlcykgb2YgaG93IG1hbnkgdG9rZW5zIHBlciAxIEVUSAogICAgICAgIGJhbGFuY2VzWzBdID0gX3RvdGFsU3VwcGx5IC0gdW5kZXJncm91bmRCdW5rZXJSZXNlcnZlczsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHVuZGVyZ3JvdW5kQnVua2VyUmVzZXJ2ZXM7CiAgICAgICAgLy9ibGFja01hcmtldE9mZmVycy5sZW5ndGggPSBtYXhNYXJrZXRPZmZlcnM7CiAgICAgICAgLy9EbyBhIHJlc2VydmF0aW9uIGZvciBtc2cuc2VuZGVyISBBbGxvdyByZXN0IHRvIGJlIHNvbGQgYnkgY29udHJhY3QhCiAgICAgICAgZW1pdCBUcmFuc2ZlcihhZGRyZXNzKDApLCBtc2cuc2VuZGVyLCB1bmRlcmdyb3VuZEJ1bmtlclJlc2VydmVzKTsKICAgIH0KCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUb3RhbCBzdXBwbHkKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfdG90YWxTdXBwbHkgLyogLSBiYWxhbmNlc1thZGRyZXNzKDApXSAqLzsKICAgIH0KCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBHZXQgdGhlIHRva2VuIGJhbGFuY2UgZm9yIGFjY291bnQgdG9rZW5Pd25lcgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB0b2tlbk93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW3Rva2VuT3duZXJdOwogICAgfQoKCiAgICBmdW5jdGlvbiB0cmFuc2ZlckludChhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zLCBib29sIHVwZGF0ZVRhc3RlcnMpIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmKHVwZGF0ZVRhc3RlcnMpIHsKICAgICAgICAgICAgLy9DaGVjayBpZiBzZW5kZXIgaGFzIHJlY2VpdmVkIHRhc3RlcnM6CiAgICAgICAgICAgIGlmKHRhc3RlcnNSZWNlaXZlZFtmcm9tXSA+IDApIHsKICAgICAgICAgICAgICAgIHVpbnQgdGFzdGVyVG9rZW5zID0gbWluKHRva2VucywgdGFzdGVyc1JlY2VpdmVkW2Zyb21dKTsKICAgICAgICAgICAgICAgIHRhc3RlcnNSZWNlaXZlZFtmcm9tXSA9IHNhZmVTdWIodGFzdGVyc1JlY2VpdmVkW2Zyb21dLCB0YXN0ZXJUb2tlbnMpOwogICAgICAgICAgICAgICAgaWYodG8gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgICAgIHRhc3RlcnNSZWNlaXZlZFt0b10gPSBzYWZlQWRkKHRhc3RlcnNSZWNlaXZlZFt0b10sIHRhc3RlclRva2Vucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW2Zyb21dLCB0b2tlbnMpOwogICAgICAgIGJhbGFuY2VzW3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbdG9dLCB0b2tlbnMpOwogICAgICAgIGVtaXQgVHJhbnNmZXIoZnJvbSwgdG8sIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUcmFuc2ZlciB0aGUgYmFsYW5jZSBmcm9tIHRva2VuIG93bmVyJ3MgYWNjb3VudCB0byB0byBhY2NvdW50CiAgICAvLyAtIE93bmVyJ3MgYWNjb3VudCBtdXN0IGhhdmUgc3VmZmljaWVudCBiYWxhbmNlIHRvIHRyYW5zZmVyCiAgICAvLyAtIDAgdmFsdWUgdHJhbnNmZXJzIGFyZSBhbGxvd2VkCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJJbnQobXNnLnNlbmRlciwgdG8sIHRva2VucywgdHJ1ZSk7CiAgICB9CiAgICAKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVG9rZW4gb3duZXIgY2FuIGFwcHJvdmUgZm9yIHNwZW5kZXIgdG8gdHJhbnNmZXJGcm9tKC4uLikgdG9rZW5zCiAgICAvLyBmcm9tIHRoZSB0b2tlbiBvd25lcidzIGFjY291bnQKICAgIC8vCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogICAgLy8gcmVjb21tZW5kcyB0aGF0IHRoZXJlIGFyZSBubyBjaGVja3MgZm9yIHRoZSBhcHByb3ZhbCBkb3VibGUtc3BlbmQgYXR0YWNrCiAgICAvLyBhcyB0aGlzIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiB1c2VyIGludGVyZmFjZXMgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucykgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IHRva2VuczsKICAgICAgICBlbWl0IEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVHJhbnNmZXIgdG9rZW5zIGZyb20gdGhlIGZyb20gYWNjb3VudCB0byB0aGUgdG8gYWNjb3VudAogICAgLy8gCiAgICAvLyBUaGUgY2FsbGluZyBhY2NvdW50IG11c3QgYWxyZWFkeSBoYXZlIHN1ZmZpY2llbnQgdG9rZW5zIGFwcHJvdmUoLi4uKS1kCiAgICAvLyBmb3Igc3BlbmRpbmcgZnJvbSB0aGUgZnJvbSBhY2NvdW50IGFuZAogICAgLy8gLSBGcm9tIGFjY291bnQgbXVzdCBoYXZlIHN1ZmZpY2llbnQgYmFsYW5jZSB0byB0cmFuc2ZlcgogICAgLy8gLSBTcGVuZGVyIG11c3QgaGF2ZSBzdWZmaWNpZW50IGFsbG93YW5jZSB0byB0cmFuc2ZlcgogICAgLy8gLSAwIHZhbHVlIHRyYW5zZmVycyBhcmUgYWxsb3dlZAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucykgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9VcGRhdGUgdGhlIGFsbG93YW5jZSwgdGhlIHJlc3QgaXQgYnVzaW5lc3MgYXMgdXN1YWwgZm9yIHRoZSB0cmFuc2ZlckludCBtZXRob2Q6CiAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSwgdG9rZW5zKTsKICAgICAgICByZXR1cm4gdHJhbnNmZXJJbnQoZnJvbSwgdG8sIHRva2VucywgdHJ1ZSk7CiAgICB9CgoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUmV0dXJucyB0aGUgYW1vdW50IG9mIHRva2VucyBhcHByb3ZlZCBieSB0aGUgb3duZXIgdGhhdCBjYW4gYmUKICAgIC8vIHRyYW5zZmVycmVkIHRvIHRoZSBzcGVuZGVyJ3MgYWNjb3VudAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCB3aGVuTm90UGF1c2VkIHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbdG9rZW5Pd25lcl1bc3BlbmRlcl07CiAgICB9CgoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVG9rZW4gb3duZXIgY2FuIGFwcHJvdmUgZm9yIHNwZW5kZXIgdG8gdHJhbnNmZXJGcm9tKC4uLikgdG9rZW5zCiAgICAvLyBmcm9tIHRoZSB0b2tlbiBvd25lcidzIGFjY291bnQuIFRoZSBzcGVuZGVyIGNvbnRyYWN0IGZ1bmN0aW9uCiAgICAvLyByZWNlaXZlQXBwcm92YWwoLi4uKSBpcyB0aGVuIGV4ZWN1dGVkCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIGRhdGEpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB0b2tlbnM7CiAgICAgICAgZW1pdCBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB0b2tlbnMpOwogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIHRva2VucywgdGhpcywgZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBDYWxjdWxhdGVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIChpbiB1bnNpZ25lZCBpbnRlZ2VyIGZvcm0gW2RlY2ltYWxzIGluY2x1ZGVkXSkgY29ycmVzcG9uZGluZyB0byB0aGUgd2VpVmFsdWUgcGFzc2VkLCB1c2luZyB0aGUgcmF0aW8gc3BlY2lmaWVkCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2Vuc0Zyb21XZWkodWludCB3ZWlWYWx1ZSwgdWludCByYXRpbykgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBudW1Ub2tlbnMpIHsKICAgICAgICB1aW50IGNhbGMxID0gc2FmZU11bCh3ZWlWYWx1ZSwgcmF0aW8pOwogICAgICAgIHVpbnQgZXRoVmFsdWUgPSBjYWxjMSAvIF9mYWN0b3JEZWNpbWFsc0V0aFRvVG9rZW47CiAgICAgICAgcmV0dXJuIGV0aFZhbHVlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ2FsY3VsYXRlcyB0aGUgRXRoIHZhbHVlIChpbiB3ZWkpIGNvcnJlc3BvbmRpbmcgdG8gdGhlIG51bWJlciBvZiB0b2tlbnMgcGFzc2VkIChpbiB1bnNpZ25lZCBpbnRlZ2VyIGZvcm0gW2RlY2ltYWxzIGluY2x1ZGVkXSksIHVzaW5nIHRoZSByYXRpbyBzcGVjaWZpZWQKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gY2FsY3VsYXRlRXRoVmFsdWVGcm9tVG9rZW5zKHVpbnQgbnVtVG9rZW5zLCB1aW50IHJhdGlvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHdlaVZhbHVlKSB7CiAgICAgICAgdWludCBjYWxjMSA9IHNhZmVNdWwobnVtVG9rZW5zLCBfZmFjdG9yRGVjaW1hbHNFdGhUb1Rva2VuKTsKICAgICAgICB1aW50IHJldFZhbHVlID0gY2FsYzEgLyByYXRpbzsKICAgICAgICByZXR1cm4gcmV0VmFsdWU7CiAgICB9CiAgICAKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCBidXkgdG9rZW5zIGNvcnJlc3BvbmRpbmcgdG8gdGhlIEV0aGVyIHNlbnQgKE93biBUb2tlbiBTcGVjaWZpYyBNZXRob2QpCiAgICAvLyAtIENvbnRyYWN0IHN1cHBseSBvZiB0b2tlbnMgbXVzdCBoYXZlIGVub3VnaCBiYWxhbmNlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGJ1eUNva2UoKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL0NhbGN1bGF0ZSB0b2tlbnMgY29ycmVzcG9uZGluZyB0byB0aGUgRXRoZXIgc2VudDoKICAgICAgICB1aW50IG51bVRva2Vuc1RvQnV5ID0gY2FsY3VsYXRlVG9rZW5zRnJvbVdlaShtc2cudmFsdWUsIGJ1eVJhdGlvKTsKICAgICAgICB1aW50IGZpbmFsTnVtVG9rZW5zVG9CdXkgPSBudW1Ub2tlbnNUb0J1eTsKICAgICAgICBpZihudW1Ub2tlbnNUb0J1eSA+IGJhbGFuY2VzWzBdKSB7CiAgICAgICAgICAgIC8vQWRqdXN0IG51bWJlciBvZiB0b2tlbnMgdG8gYnV5LCB0byB0aG9zZSBhdmFpbGFibGUgaW4gc3RvY2s6CiAgICAgICAgICAgIGZpbmFsTnVtVG9rZW5zVG9CdXkgPSBiYWxhbmNlc1swXTsKICAgICAgICAgICAgLy9VcGRhdGUgY2hhbmdlIHRvIHJldHVybiBmb3IgdGhpcyBzZW5kZXIgKGluIFdlaSk6CiAgICAgICAgICAgIC8vU0FGRVRZIENIRUNLOiBObyBuZWVkIHRvIHVzZSBzYWZlU3ViIGZvciAobnVtVG9rZW5zVG9CdXkgLSBmaW5hbE51bVRva2Vuc1RvQnV5KSwgYXMgd2UgYWxyZWFkeSBrbm93IHRoYXQgbnVtVG9rZW5zVG9CdXkgPiBmaW5hbE51bVRva2Vuc1RvQnV5IQogICAgICAgICAgICB1aW50IGV0aFZhbHVlRnJvbVRva2VucyA9IGNhbGN1bGF0ZUV0aFZhbHVlRnJvbVRva2VucyhudW1Ub2tlbnNUb0J1eSAtIGZpbmFsTnVtVG9rZW5zVG9CdXksIGJ1eVJhdGlvKTsgLy9JbiBXZWkKICAgICAgICAgICAgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdLCBldGhWYWx1ZUZyb21Ub2tlbnMgKTsKICAgICAgICAgICAgZW1pdCBDaGFuZ2VUb1JlY2VpdmVHb3R0ZW4obXNnLnNlbmRlciwgZXRoVmFsdWVGcm9tVG9rZW5zLCBjaGFuZ2VUb1JldHVyblttc2cuc2VuZGVyXSk7CiAgICAgICAgfQogICAgICAgIGlmKGZpbmFsTnVtVG9rZW5zVG9CdXkgPD0gYmFsYW5jZXNbMF0pIHsKICAgICAgICAgICAgLyoKICAgICAgICAgICAgYmFsYW5jZXNbMF0gPSBzYWZlU3ViKGJhbGFuY2VzWzBdLCBmaW5hbE51bVRva2Vuc1RvQnV5KTsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBmaW5hbE51bVRva2Vuc1RvQnV5KTsKICAgICAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgbXNnLnNlbmRlciwgZmluYWxOdW1Ub2tlbnNUb0J1eSk7CiAgICAgICAgICAgICovCiAgICAgICAgICAgIHRyYW5zZmVySW50KGFkZHJlc3MoMCksIG1zZy5zZW5kZXIsIGZpbmFsTnVtVG9rZW5zVG9CdXksIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2hvdyB0byB0aGUgdXNlciB0aGF0IGlzIGFza2luZyB0aGUgY2hhbmdlIGhlIGhhcyB0byByZWNlaXZlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGNoZWNrQ2hhbmdlVG9SZWNlaXZlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBjaGFuZ2VJbldlaSkgewogICAgICAgIHJldHVybiBjaGFuZ2VUb1JldHVyblttc2cuc2VuZGVyXTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2hvdyB0byB0aGUgdXNlciB0aGF0IGlzIGFza2luZyB0aGUgZ2FpbnMgaGUgaGFzIHRvIHJlY2VpdmUKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gY2hlY2tHYWluc1RvUmVjZWl2ZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgZ2FpbnNJbldlaSkgewogICAgICAgIHJldHVybiBnYWluc1RvUmVjZWl2ZVttc2cuc2VuZGVyXTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgZ2V0IGNoYW5nZSBpbiBFVEggZnJvbSB0aGUgdG9rZW5zIHRoYXQgd2VyZSBub3QgcG9zc2libGUgdG8gYnV5IGluIGEgcHJldmlvdXMgb3JkZXIKICAgIC8vIC0gQ29udHJhY3Qgc3VwcGx5IG9mIEVUSCBtdXN0IGhhdmUgZW5vdWdoIGJhbGFuY2UgKHdoaWNoIHNob3VsZCBiZSBpbiBldmVyeSBjYXNlKQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiByZXRyaWV2ZUNoYW5nZSgpIHB1YmxpYyBub1JlZW50cmFuY3kgd2hlbk5vdEluRW1lcmdlbmN5UHJvdGVjdGVkTW9kZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IGNoYW5nZSA9IGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdOwogICAgICAgIGlmKGNoYW5nZSA+IDApIHsKICAgICAgICAgICAgLy9TZXQgY29ycmVjdCB2YWx1ZSBvZiBjaGFuZ2UgYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIgbWV0aG9kIHRvIGF2b2lkIHJlZW50cmFuY2UgYWZ0ZXIgc2VuZGluZyB0byBhbm90aGVyIGNvbnRyYWN0czoKICAgICAgICAgICAgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0gPSAwOwogICAgICAgICAgICAvL1NlbmQgY29ycmVzcG9uZGluZyBFVEggdG8gc2VuZGVyOgogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGNoYW5nZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgZ2V0IGdhaW5zIGluIEVUSCBmcm9tIHRoZSB0b2tlbnMgdGhhdCB0aGUgc2VsbGVyIGhhcyBwcmV2aW91c2x5IHNvbGQKICAgIC8vIC0gQ29udHJhY3Qgc3VwcGx5IG9mIEVUSCBtdXN0IGhhdmUgZW5vdWdoIGJhbGFuY2UgKHdoaWNoIHNob3VsZCBiZSBpbiBldmVyeSBjYXNlKQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiByZXRyaWV2ZUdhaW5zKCkgcHVibGljIG5vUmVlbnRyYW5jeSB3aGVuTm90SW5FbWVyZ2VuY3lQcm90ZWN0ZWRNb2RlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQgZ2FpbnMgPSBnYWluc1RvUmVjZWl2ZVttc2cuc2VuZGVyXTsKICAgICAgICBpZihnYWlucyA+IDApIHsKICAgICAgICAgICAgLy9TZXQgY29ycmVjdCB2YWx1ZSBvZiAiZ2FpbnMgdG8gcmVjZWl2ZSIgYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIgbWV0aG9kIHRvIGF2b2lkIHJlZW50cmFuY2UgYXR0YWNrIGFmdGVyIHBvc3NpYmx5IHNlbmRpbmcgdG8gYW5vdGhlciBjb250cmFjdDoKICAgICAgICAgICAgZ2FpbnNUb1JlY2VpdmVbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgICAgICAvL1NlbmQgY29ycmVzcG9uZGluZyBFVEggdG8gc2VuZGVyOgogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGdhaW5zKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCByZXR1cm4gTiBib3VnaHQgdG9rZW5zIHRvIHRoZSBjb250cmFjdAogICAgLy8gLSBVc2VyIHN1cHBseSBvZiB0b2tlbnMgbXVzdCBoYXZlIGVub3VnaCBiYWxhbmNlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHJldHVybkNva2UodWludCB1Z1RvUmV0dXJuKSBwdWJsaWMgbm9SZWVudHJhbmN5IHdoZW5Ob3RQYXVzZWQgd2hlbk5vdEZsdXNoaW5nIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vcmVxdWlyZSh1Z1RvUmV0dXJuIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsgLy9DaGVjayBiYWxhbmNlIG9mIHVzZXIKICAgICAgICAvL0ZvbGxvd2luZyByZXF1aXJlIG5vdCBuZWVkZWQgYW55bW9yZSwgd2lsbCBqdXN0IHBheSB0aGUgZGlmZmVyZW5jZSEKICAgICAgICAvL3JlcXVpcmUodWdUb1JldHVybiA+IHRhc3RlcnNSZWNlaXZlZFttc2cuc2VuZGVyXSk7IC8vQ2hlY2sgaWYgdGhlIG1nIHRvIHJldHVybiBhcmUgZ3JlYXRlciB0aGFuIHRoZSBvbmVzIHJlY2VpdmVkIGFzIGEgdGFzdGVyCiAgICAgICAgLy9NYXhpbXVtIHBvc3NpYmxlIG51bWJlciBvZiBtZyB0byByZXR1cm4sIGhhdmUgdG8gYmUgbG93ZXIgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUgdXNlciBtaW51cyB0aGUgdGFzdGVycyByZWNlaXZlZDoKICAgICAgICB1aW50IGZpbmFsVWdUb1JldHVybkZvckV0aCA9IG1pbih1Z1RvUmV0dXJuLCBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCB0YXN0ZXJzUmVjZWl2ZWRbbXNnLnNlbmRlcl0pKTsgLy9TdWJ0cmFjdCB0YXN0ZXJzIHJlY2VpdmVkIGZyb20gdGhlIHRvdGFsIGFtb3VudCB0byByZXR1cm4KICAgICAgICAvL3JlcXVpcmUoZmluYWxVZ1RvUmV0dXJuRm9yRXRoIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsgLy9DaGVjayBiYWxhbmNlIG9mIHVzZXIgKE5vIG5lZWQgZm9yIHRoaXMgZXh0cmEgY2hlY2ssIGFzIHRoZSBtaW5pbXVtIGdhcmFudGVlcyBhdCBtb3N0IHRoZSB2YWx1ZSBvZiB0aGUgYmFsYW5jZVtdIHRvIGJlIHJldHVybmVkKQogICAgICAgIC8vQ2FsY3VsYXRlIHRva2VucyBjb3JyZXNwb25kaW5nIHRvIHRoZSBFdGhlciBzZW50OgogICAgICAgIHVpbnQgZXRoVG9SZXR1cm4gPSBjYWxjdWxhdGVFdGhWYWx1ZUZyb21Ub2tlbnMoZmluYWxVZ1RvUmV0dXJuRm9yRXRoLCBzZWxsUmF0aW8pOyAvL0V0aGVyZXVtIHRvIHJldHVybiAoaW4gV2VpKQogICAgICAgIAogICAgICAgIGlmKGV0aFRvUmV0dXJuID4gMCkgewogICAgICAgICAgICAvL1dpbGwgcmV0dXJuIGV0aCBpbiBleGNoYW5nZSBmb3IgdGhlIGNva2UhCiAgICAgICAgICAgIC8vUmVjZWl2ZSB0aGUgY29rZToKICAgICAgICAgICAgdHJhbnNmZXIoYWRkcmVzcygwKSwgZmluYWxVZ1RvUmV0dXJuRm9yRXRoKTsKICAgICAgICAgICAgLyoKICAgICAgICAgICAgYmFsYW5jZXNbMF0gPSBzYWZlQWRkKGJhbGFuY2VzWzBdLCBmaW5hbFVnVG9SZXR1cm5Gb3JFdGgpOwogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIGZpbmFsVWdUb1JldHVybkZvckV0aCk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIGFkZHJlc3MoMCksIGZpbmFsVWdUb1JldHVybkZvckV0aCk7CiAgICAgICAgICAgICovCiAgICAgICAgICAgIAogICAgICAgICAgICAvL1JldHVybiB0aGUgRXRoOgogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV0aFRvUmV0dXJuKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCByZXR1cm4gYWxsIGJvdWdodCB0b2tlbnMgdG8gdGhlIGNvbnRyYWN0CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHJldHVybkFsbENva2UoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHJldHVybkNva2Uoc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdGFzdGVyc1JlY2VpdmVkW21zZy5zZW5kZXJdKSk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBTZW5kcyBhIHNwZWNpYWwgdGFzdGVyIHBhY2thZ2UgdG8gcmVjaXBpZW50CiAgICAvLyAtIENvbnRyYWN0IHN1cHBseSBvZiB0b2tlbnMgbXVzdCBoYXZlIGVub3VnaCBiYWxhbmNlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHNlbmRTcGVjaWFsVGFzdGVyUGFja2FnZShhZGRyZXNzIGFkZHIsIHVpbnQgdWdUb1Rhc3RlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgdGFzdGVyc1JlY2VpdmVkW2FkZHJdID0gc2FmZUFkZCh0YXN0ZXJzUmVjZWl2ZWRbYWRkcl0sIHVnVG9UYXN0ZSk7CiAgICAgICAgdHJhbnNmZXIoYWRkciwgdWdUb1Rhc3RlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgdHJhbnNmZXIgdG8gc2VsZWN0ZWQgYWRkcmVzcyBhIGxvYWQgb2YgdG9rZW5zCiAgICAvLyAtIFVzZXIgc3VwcGx5IG9mIHRva2VucyBtdXN0IGhhdmUgZW5vdWdoIGJhbGFuY2UKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2VuZFNoaXBtZW50VG8oYWRkcmVzcyB0bywgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXIodG8sIHRva2Vucyk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIHRyYW5zZmVyIGEgc21hbGwgc2FtcGxlIHRvIHNlbGVjdGVkIGFkZHJlc3MKICAgIC8vIC0gVXNlciBzdXBwbHkgb2YgdG9rZW5zIG11c3QgaGF2ZSBlbm91Z2ggYmFsYW5jZQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzZW5kVGFzdGVyKGFkZHJlc3MgdG8pIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL1NlbmRpbmcgaW4gMC4wMDAwMDIgZyAodGhhdCBpcyAyIG1pY3JvZ3JhbXMpOgogICAgICAgIHJldHVybiB0cmFuc2Zlcih0bywgMik7CiAgICB9CgogICAgZnVuY3Rpb24gbGVuZ3RoQWRkcmVzc2VzKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIChmaXJzdEFkZHJlc3MgPiAwKSA/IGxhc3RBZGRyZXNzZXMubGVuZ3RoIDogdWludChsYXN0QWRkcmVzcyArIDEpOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCBtYWtlIGl0IHJhaW4hIFdpbGwgdGhyb3cgc29tZSB0b2tlbnMgZnJvbSB0aGUgdXNlciB0byBzb21lIHJhbmRvbSBhZGRyZXNzZXMsIHNwcmVhZGluZyB0aGUgaGFwcGluZXNzIGV2ZXJ5d2hlcmUhCiAgICAvLyBUaGUgZ3JlYXRlciB0aGUgcmFuZ2UsIGl0IHdpbGwgc3VwcGx5IHRvIGFkZHJlc3NlcyBmdXJ0aGVyIGF3YXkuCiAgICAvLyAtIFVzZXIgc3VwcGx5IG9mIHRva2VucyBtdXN0IGhhdmUgZW5vdWdoIGJhbGFuY2UKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gbGV0SXRSYWluKHVpbnQ4IHJhbmdlLCB1aW50IHF1YW50aXR5KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShxdWFudGl0eSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgaWYobGVuZ3RoQWRkcmVzc2VzKCkgPT0gMCkgewogICAgICAgICAgICBlbWl0IE5vQWRkcmVzc2VzQXZhaWxhYmxlKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYnl0ZXMzMiBoYXNoQmxvY2sxMDAgPSBibG9jay5ibG9ja2hhc2goMTAwKTsgLy9HZXQgaGFzaCBvZiBwcmV2aW91cyAxMDB0aCBibG9jawogICAgICAgIGJ5dGVzMzIgcmFuZG9tSGFzaCA9IGtlY2NhazI1NihrZWNjYWsyNTYoaGFzaEJsb2NrMTAwKSk7IC8vU0FGRVRZIENIRUNLOiBJbmNyZWFzZSBkaWZmaWN1bHR5IHRvIHJldmVyc2UgbmVlZGVkIGhhc2hCbG9jazEwMCAoaW4gY2FzZSBvZiBhdHRhY2sgYnkgdGhlIG1pbmVycykKICAgICAgICBieXRlIHBvc0FkZHIgPSByYW5kb21IYXNoWzFdOyAvL0NoZWNrIHBvc2l0aW9uIG9uZSAodG8gMTAsIG1heGltdW0pIG9mIHJhbmRvbUhhc2ggdG8gdXNlIGZvciB0aGUgcG9zaXRpb24ocykgaW4gdGhlIGFkZHJlc3NlcyBhcnJheQogICAgICAgIGJ5dGUgaG93TWFueSA9IHJhbmRvbUhhc2hbMzBdOyAvL0NoZWNrIHBvc2l0aW9uIDMwIG9mIHJhbmRvbUhhc2ggdG8gdXNlIGZvciBob3cgbWFueSBhZGRyZXNzZXMgYmFzZQogICAgICAgIAogICAgICAgIHVpbnQ4IHBvc0ludCA9ICh1aW50OChwb3NBZGRyKSArIHJhbmdlICogMikgJSB1aW50OChsZW5ndGhBZGRyZXNzZXMoKSk7IC8vU0FGRVRZIENIRUNLOiBsZW5ndGhBZGRyZXNzZXMoKSBjYW4ndCBiZSBncmVhdGVyIHRoYW4gMjU2ISEKICAgICAgICB1aW50OCBob3dNYW55SW50ID0gdWludDgoaG93TWFueSkgJSB1aW50OChsZW5ndGhBZGRyZXNzZXMoKSk7IC8vU0FGRVRZIENIRUNLOiBsZW5ndGhBZGRyZXNzZXMoKSBjYW4ndCBiZSBncmVhdGVyIHRoYW4gMjU2ISEKICAgICAgICBob3dNYW55SW50ID0gaG93TWFueUludCA+IDEwID8gMTAgOiBob3dNYW55SW50OyAvL0F0IG1heGltdW0gZGlzdHJpYnV0ZSB0byAxMCBhZGRyZXNzZXMKICAgICAgICBob3dNYW55SW50ID0gaG93TWFueUludCA8IDIgPyAyIDogaG93TWFueUludDsgLy9BdCBtaW5pbXVtIGRpc3RyaWJ1dGUgdG8gMiBhZGRyZXNzZXMKICAgICAgICAKICAgICAgICBhZGRyZXNzIGFkZHI7CiAgICAgICAgCiAgICAgICAgdWludDggY291bnRlciA9IDA7CiAgICAgICAgdWludCBxdWFudCA9IHF1YW50aXR5IC8gaG93TWFueUludDsKICAgICAgICAKICAgICAgICBkbyB7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL0Rpc3RyaWJ1dGUgdG8gb25lIHJhbmRvbSBhZGRyZXNzOgogICAgICAgICAgICBhZGRyID0gbGFzdEFkZHJlc3Nlc1twb3NJbnRdOwogICAgICAgICAgICB0cmFuc2ZlcihhZGRyLCBxdWFudCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwb3NJbnQgPSAodWludDgocmFuZG9tSGFzaFsxICsgY291bnRlcl0pICsgcmFuZ2UgKiAyKSAlIHVpbnQ4KGxlbmd0aEFkZHJlc3NlcygpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vU0FGRVRZIENIRUNLOiBBcyB0aGUgaW50ZWdlciBkaXZpc2lvbnMgYXJlIHRydW5jYXRlZCAoLS0+IChxdWFudCAqIGhvd01hbnlJbnQpIDw9IHF1YW50aXR5IChhbHdheXMpICksIHRoZSBmb2xsb3dpbmcgY29kZSBpcyBub3QgbmVlZGVkOgogICAgICAgICAgICAvKgogICAgICAgICAgICAvL3dlIGhhdmUgdG8gZW5zdXJlLCBpbiBjYXNlIG9mIHVuZXZlbiBkaXZpc2lvbiwgdG8ganVzdCB1c2UgYXQgbWF4aW11bSB0aGUgcXVhbnRpdHkgc3BlY2lmaWVkIGJ5IHRoZSB1c2VyOgogICAgICAgICAgICBpZihxdWFudGl0eSA+IHF1YW50KSB7CiAgICAgICAgICAgICAgICBxdWFudGl0eSA9IHF1YW50aXR5IC0gcXVhbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBxdWFudCA9IHF1YW50aXR5OwogICAgICAgICAgICB9CiAgICAgICAgICAgICovCiAgICAgICAgfQogICAgICAgIHdoaWxlKHF1YW50aXR5ID4gMCAmJiBjb3VudGVyIDwgaG93TWFueUludCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBNZXRob2Qgd2lsbCBiZSB1c2VkIHRvIHNldCBhIGNlcnRhaW4gbnVtYmVyIG9mIGFkZHJlc3NlcyBwZXJpb2RpY2FsbHkuIFRoZXNlIGFkZHJlc3NlcyB3aWxsIGJlIHRoZSBvbmVzIHRvIHJlY2VpdmUgcmFuZG9tbHkgdGhlIHRva2VucyB3aGVuIHNvbWVib2R5IG1ha2VzIGl0IHJhaW4hCiAgICAvLyBUaGUgbGlzdCBvZiBhZGRyZXNzZXMgc2hvdWxkIGJlIGdvdHRlbiBmcm9tIHRoZSBtYWluIGV0aGVyZXVtLCBieSBjaGVja2luZyBmb3IgYWRkcmVzc2VzIHVzZWQgaW4gdGhlIGxhdGVzdCB0cmFuc2FjdGlvbnMuCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHNldEFkZHJlc3Nlc0ZvclJhaW4oYWRkcmVzc1tdIG1lbW9yeSBhZGRyZXNzZXMpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzZXMubGVuZ3RoIDw9IHVpbnQobWF4QWRkcmVzc2VzKSAmJiBhZGRyZXNzZXMubGVuZ3RoID4gMCk7CiAgICAgICAgbGFzdEFkZHJlc3NlcyA9IGFkZHJlc3NlczsKICAgICAgICBmaXJzdEFkZHJlc3MgPSAwOwogICAgICAgIGxhc3RBZGRyZXNzID0gaW50MzIoYWRkcmVzc2VzLmxlbmd0aCkgLSAxOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCBnZXQgdGhlIE1heGltdW0gb2YgYWRkcmVzc2VzIHRvIGJlIHVzZWQgZm9yIG1ha2luZyBpdCByYWluCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGdldE1heEFkZHJlc3NlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGludDMyKSB7CiAgICAgICAgcmV0dXJuIG1heEFkZHJlc3NlczsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2V0IHRoZSBNYXhpbXVtIG9mIGFkZHJlc3NlcyB0byBiZSB1c2VkIGZvciBtYWtpbmcgaXQgcmFpbiAoTWF4aW11bSBvZiAyNTUgQWRkcmVzc2VzKQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzZXRNYXhBZGRyZXNzZXMoaW50MzIgX21heEFkZHJlc3NlcykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF9tYXhBZGRyZXNzZXMgPiAwICYmIF9tYXhBZGRyZXNzZXMgPCAyNTYpOwogICAgICAgIG1heEFkZHJlc3NlcyA9IF9tYXhBZGRyZXNzZXM7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIGdldCB0aGUgQnV5IFJhdGlvCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGdldEJ1eVJhdGlvKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBidXlSYXRpbzsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2V0IHRoZSBCdXkgUmF0aW8KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2V0QnV5UmF0aW8odWludCByYXRpbykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHJhdGlvICE9IDApOwogICAgICAgIGJ1eVJhdGlvID0gcmF0aW87CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIGdldCB0aGUgU2VsbCBSYXRpbwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBnZXRTZWxsUmF0aW8oKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHNlbGxSYXRpbzsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2V0IHRoZSBTZWxsIFJhdGlvCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHNldFNlbGxSYXRpbyh1aW50IHJhdGlvKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUocmF0aW8gIT0gMCk7CiAgICAgICAgc2VsbFJhdGlvID0gcmF0aW87CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIHNldCB0aGUgRGlyZWN0IE9mZmVycyBDb21pc3Npb24gUmF0aW8KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2V0RGlyZWN0T2ZmZXJzQ29taXNzaW9uUmF0aW8odWludCByYXRpbykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHJhdGlvICE9IDApOwogICAgICAgIGRpcmVjdE9mZmVyc0NvbWlzc2lvblJhdGlvID0gcmF0aW87CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIGdldCB0aGUgRGlyZWN0IE9mZmVycyBDb21pc3Npb24gUmF0aW8KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gZ2V0RGlyZWN0T2ZmZXJzQ29taXNzaW9uUmF0aW8oKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGRpcmVjdE9mZmVyc0NvbWlzc2lvblJhdGlvOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCBzZXQgdGhlIE1hcmtldCBDb21pc3Npb24gUmF0aW8KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2V0TWFya2V0Q29taXNzaW9uUmF0aW8odWludCByYXRpbykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHJhdGlvICE9IDApOwogICAgICAgIG1hcmtldENvbWlzc2lvblJhdGlvID0gcmF0aW87CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIGdldCB0aGUgTWFya2V0IENvbWlzc2lvbiBSYXRpbwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBnZXRNYXJrZXRDb21pc3Npb25SYXRpbygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbWFya2V0Q29taXNzaW9uUmF0aW87CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBXaWxsIHNldCB0aGUgTWF4aW11bSBvZiBNYXJrZXQgT2ZmZXJzCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHNldE1heE1hcmtldE9mZmVycyhpbnQzMiBfbWF4TWFya2V0T2ZmZXJzKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQgYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWRTaXplID0gYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQuc2l6ZU9mKCk7CiAgICAgICAgaWYoYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWRTaXplID4gdWludChfbWF4TWFya2V0T2ZmZXJzKSkgewogICAgICAgICAgICBpbnQzMiBkaWZmID0gaW50MzIoYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWRTaXplIC0gdWludChfbWF4TWFya2V0T2ZmZXJzKSk7CiAgICAgICAgICAgIC8vcmVxdWlyZShkaWZmIDwgX21heE1hcmtldE9mZmVycyk7CiAgICAgICAgICAgIHJlcXVpcmUoZGlmZiA8PSBpbnQzMihibGFja01hcmtldE9mZmVyc1NvcnRlZFNpemUpKTsgLy9TQUZFVFkgQ0hFQ0sgKHJlY29tbWVuZGVkIGJlY2F1c2Ugb2YgdHlwZSBjb252ZXJzaW9ucykhCiAgICAgICAgICAgIC8vRG8gdGhlIG5lZWRlZCBudW1iZXIgb2YgUG9wcyB0byBjbGVhciB0aGUgbWFya2V0IG9mZmVycyBsaXN0IGlmIF9tYXhNYXJrZXRPZmZlcnMgKG5ldykgPCBtYXhNYXJrZXRPZmZlcnMgKG9sZCkKICAgICAgICAgICAgd2hpbGUgIChkaWZmID4gMCkgewogICAgICAgICAgICAgICAgdWludCBsYXN0T3JkZXIgPSBibGFja01hcmtldE9mZmVyc1NvcnRlZC5wb3AoUFJFVik7IC8vUG9wcyBlbGVtZW50IGZyb20gdGhlIFRhaWwhCiAgICAgICAgICAgICAgICBkZWxldGUgYmxhY2tNYXJrZXRPZmZlcnNNYXBbbGFzdE9yZGVyXTsKICAgICAgICAgICAgICAgIGRpZmYtLTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBtYXhNYXJrZXRPZmZlcnMgPSBfbWF4TWFya2V0T2ZmZXJzOwogICAgICAgIC8vYmxhY2tNYXJrZXRPZmZlcnMubGVuZ3RoID0gbWF4TWFya2V0T2ZmZXJzOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgZXh0cmEgYmxvY2tzIG5lZWRlZCB0byBmbHVzaCwgZGVwZW5kaW5nIG9uIHRoZSBzdGFzaCB0byBmbHVzaCAodGhlIGdyZWF0ZXIgdGhlIGxvYWQsIG1vcmUgZGlmZmljdWx0IGl0IHdpbGwgYmUpCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUZhY3RvckZsdXNoRGlmZmljdWx0eSh1aW50IHN0YXNoKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgZXh0cmFCbG9ja3MpIHsKICAgICAgICB1aW50IG51bUJsb2Nrc1RvRmx1c2ggPSAxMDsKICAgICAgICB1aW50MTYgZmFjdG9yOwogICAgICAgIGlmKHN0YXNoIDwgMTAwMCkgewogICAgICAgICAgICBmYWN0b3IgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHN0YXNoIDwgNTAwMCkgewogICAgICAgICAgICBmYWN0b3IgPSAyOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHN0YXNoIDwgMTAwMDApIHsKICAgICAgICAgICAgZmFjdG9yID0gMzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihzdGFzaCA8IDEwMDAwMCkgewogICAgICAgICAgICBmYWN0b3IgPSA0OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHN0YXNoIDwgMTAwMDAwMCkgewogICAgICAgICAgICBmYWN0b3IgPSA1OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHN0YXNoIDwgMTAwMDAwMDApIHsKICAgICAgICAgICAgZmFjdG9yID0gMTA7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoc3Rhc2ggPCAxMDAwMDAwMDApIHsKICAgICAgICAgICAgZmFjdG9yID0gNTA7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoc3Rhc2ggPCAxMDAwMDAwMDAwKSB7CiAgICAgICAgICAgIGZhY3RvciA9IDUwMDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZhY3RvciA9IDUwMDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudW1CbG9ja3NUb0ZsdXNoICogZmFjdG9yOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVGhyb3dzIGF3YXkgeW91ciBzdGFzaCAoZG93biB0aGUgZHJhaW4gOykgKSBpbW1lZGlhdGVseS4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gZG93blRoZURyYWluSW1tZWRpYXRlKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgICAgIC8vQ2xlYW4gYW55IGZsdXNoaW5nIHRoYXQgaXQgc3RpbGwgaGFkIGlmIHBvc3NpYmxlOgogICAgICAgICAgICB0b0ZsdXNoW21zZy5zZW5kZXJdID0gMDsKICAgICAgICAgICAgLy9UcmFuc2ZlciB0byBjb250cmFjdCBhbGwgdGhlIGJhbGFuY2U6CiAgICAgICAgICAgIHRyYW5zZmVyKGFkZHJlc3MoMCksIGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKICAgICAgICAgICAgdGFzdGVyc1JlY2VpdmVkW21zZy5zZW5kZXJdID0gMDsKICAgICAgICAgICAgZW1pdCBGbHVzaGVkKG1zZy5zZW5kZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUaHJvd3MgYXdheSB5b3VyIHN0YXNoIChkb3duIHRoZSBkcmFpbiA7KSApLiBJdCBjYW4gdGFrZSBhd2hpbGUgdG8gYmUgY29tcGxldGVseSBmbHVzaGVkLiBZb3UgY2FuIHNlbmQgaW4gMC4wMSBldGhlciB0byBzcGVlZCB1cCB0aGlzIHByb2Nlc3MuCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGRvd25UaGVEcmFpbigpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHBheWFibGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYobXNnLnZhbHVlIDwgMC4wMSBldGhlcikgewogICAgICAgICAgICAvL05vIGh1cnJ5LCB3aWxsIHVzZSBkZWZhdWx0IG1ldGhvZCB0byBmbHVzaCB0aGUgY29rZSAod2lsbCB0YWtlIHNvbWUgdGltZSkKICAgICAgICAgICAgdG9GbHVzaFttc2cuc2VuZGVyXSA9IGJsb2NrLm51bWJlciArIGNhbGN1bGF0ZUZhY3RvckZsdXNoRGlmZmljdWx0eShiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHJldHVybiBkb3duVGhlRHJhaW5JbW1lZGlhdGUoKTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIENoZWNrcyBpZiB0aGUgZHVtcCBpcyBjb21wbGV0ZSBhbmQgd2UgY2FuIGZsdXNoIHRoZSB3aG9sZSBzdGFzaCEKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gZmx1c2goKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL0N1cnJlbnQgYmxvY2sgbnVtYmVyIGlzIGFscmVhZHkgZ3JlYXRlciB0aGFuIHRoZSBsaW1pdCB0byBiZSBmbHVzaGFibGU/CiAgICAgICAgaWYoYmxvY2subnVtYmVyID49IHRvRmx1c2hbbXNnLnNlbmRlcl0pIHsKICAgICAgICAgICAgcmV0dXJuIGRvd25UaGVEcmFpbkltbWVkaWF0ZSgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIENvbXBhcmF0b3IgdXNlZCB0byBjb21wYXJlIHByaWNlUmF0aW9zIGluc2lkZSB0aGUgTGlua2VkTGlzdAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzbWFsbGVyUHJpY2VDb21wYXJhdG9yKHVpbnQgcHJpY2VOZXcsIHVpbnQgbm9kZU5leHQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9XaGVuIGNvbXBhcmluZyByYXRpb3MgdGhlIHNtYWxsZXIgb25lIHdpbGwgYmUgdGhlIG9uZSB3aXRoIHRoZSBncmVhdGVyIHJhdGlvIChjaGVhcGVyIHByaWNlKToKICAgICAgICAvL3JldHVybiBwcmljZU5ldyA8IGJsYWNrTWFya2V0T2ZmZXJzTWFwW25vZGVOZXh0XS5wcmljZTsKICAgICAgICByZXR1cm4gcHJpY2VOZXcgPiBibGFja01hcmtldE9mZmVyc01hcFtub2RlTmV4dF0ucHJpY2U7IC8vSWYgcHJpY2VOZXcgcmF0aW8gaXMgZ3JlYXRlciwgaXQgbWVhbnMgaXQgaXMgYSBjaGVhcGVyIG9mZmVyIQogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFB1dCBvcmRlciBvbiB0aGUgYmxhY2ttYXJrZXQgdG8gc2VsbCBhIGNlcnRhaW4gcXVhbnRpdHkgb2YgY29rZSBhdCBhIGNlcnRhaW4gcHJpY2UuCiAgICAvLyBUaGUgcHJpY2UgcmF0aW8gaXMgaG93IG11Y2ggbWljcm9ncmFtcyAodWcpIG9mIG1hdGVyaWFsICh0b2tlbnMpIHRoZSBidXllciB3aWxsIGdldCBwZXIgRVRIICh1Zy9FVEgpIChmb3IgZXhhbXBsZSwgdG8gZ2V0IDEwZyBmb3IgMSBFVEgsIHRoZSByYXRpbyBzaG91bGQgYmUgMTAwMDAwMDApCiAgICAvLyBGb3Igc2VsbGVycyB0aGUgbG93ZXIgdGhlIHJhdGlvIHRoZSBiZXR0ZXIsIHRoZSBtb3JlIEVUSCB0aGUgYnV5ZXIgd2lsbCBuZWVkIHRvIHNwZW5kIHRvIGdldCBlYWNoIHRva2VuIQogICAgLy8gLSBTZWxsZXIgbXVzdCBoYXZlIGVub3VnaCBiYWxhbmNlIG9mIHRva2VucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzZWxsVG9CbGFja01hcmtldCh1aW50IHF1YW50aXR5LCB1aW50IHByaWNlUmF0aW8pIHB1YmxpYyB3aGVuTm90UGF1c2VkIHdoZW5Ob3RGbHVzaGluZyByZXR1cm5zIChib29sIHN1Y2Nlc3MsIHVpbnQgbnVtT3JkZXJDcmVhdGVkKSB7CiAgICAgICAgLy9yZXF1aXJlKHF1YW50aXR5IDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdYmxvY2subnVtYmVyID49IHRvRmx1c2hbbXNnLnNlbmRlcl0pOwogICAgICAgIC8vQ0hlY2sgaWYgdXNlciBoYXMgc3VmZmljaWVudCBiYWxhbmNlIHRvIGRvIGEgc2VsbCBvZmZlcjoKICAgICAgICBpZihxdWFudGl0eSA+IGJhbGFuY2VzW21zZy5zZW5kZXJdKSB7CiAgICAgICAgICAgIC8vU2VsbGVyIGlzIG1pc3NpbmcgZnVuZHM6IEFib3J0IG9yZGVyOgogICAgICAgICAgICBlbWl0IE9yZGVySW5zdWZmaWNpZW50QmFsYW5jZShtc2cuc2VuZGVyLCBxdWFudGl0eSwgYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vSW5zZXJ0IG9yZGVyIGluIHRoZSBzb3J0ZWQgbGlzdCAoZnJvbSBjaGVhcGVyIHRvIG1vc3QgZXhwZW5zaXZlKQoKICAgICAgICAvL0ZpbmQgYW4gb2ZmZXIgdGhhdCBpcyBtb3JlIGV4cGVuc2l2ZToKICAgICAgICAvL25vZGVNb3JlRXhwZW5zaXZlID0gCiAgICAgICAgdWludCBuZXh0U3BvdDsKICAgICAgICBib29sIGZvdW5kUG9zaXRpb247CiAgICAgICAgdWludCBzaXplTm93OwogICAgICAgIChuZXh0U3BvdCwgZm91bmRQb3NpdGlvbiwgc2l6ZU5vdykgPSBibGFja01hcmtldE9mZmVyc1NvcnRlZC5nZXRTb3J0ZWRTcG90QnlGdW5jdGlvbihIRUFELCBwcmljZVJhdGlvLCBORVhULCBzbWFsbGVyUHJpY2VDb21wYXJhdG9yLCBtYXhNYXJrZXRPZmZlcnMpOwogICAgICAgIGlmKGZvdW5kUG9zaXRpb24pIHsKICAgICAgICAgICAgLy9DcmVhdGUgbmV3IFNlbGwgT2ZmZXI6CiAgICAgICAgICAgIHVpbnQgbmV3Tm9kZU51bSA9ICsrbWFya2V0T2ZmZXJDb3VudGVyOyAvL1NBRkVUWSBDSEVDSzogRG9lc24ndCBtYXR0ZXIgaWYgd2UgY3ljbGUgYWdhaW4gZnJvbSBNQVhfSU5UIHRvIDAsIGFzIHdlIGhhdmUgb25seSAxMDAgbWF4aW11bSBvZmZlcnMgYXQgYSB0aW1lLCBzbyB0aGVyZSB3aWxsIG5ldmVyIGJlIHNvbWUgb3ZlcndyaXRpbmcgb2YgdmFsaWQgb2ZmZXJzIQogICAgICAgICAgICBibGFja01hcmtldE9mZmVyc01hcFtuZXdOb2RlTnVtXS5xdWFudGl0eSA9IHF1YW50aXR5OwogICAgICAgICAgICBibGFja01hcmtldE9mZmVyc01hcFtuZXdOb2RlTnVtXS5wcmljZSA9IHByaWNlUmF0aW87CiAgICAgICAgICAgIGJsYWNrTWFya2V0T2ZmZXJzTWFwW25ld05vZGVOdW1dLnNlbGxlciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL0luc2VydCBjaGVhcGVyIG9mZmVyIGJlZm9yZSBuZXh0U3BvdDoKICAgICAgICAgICAgYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQuaW5zZXJ0KG5leHRTcG90LCBuZXdOb2RlTnVtLCBQUkVWKTsKICAgIAogICAgICAgICAgICBpZihpbnQzMihzaXplTm93KSA+IG1heE1hcmtldE9mZmVycykgewogICAgICAgICAgICAgICAgLy9EZWxldGUgdGhlIHRhaWwgZWxlbWVudCBzbyB3ZSBjYW4ga2VlcCB0aGUgc2FtZSBudW1iZXIgb2YgbWF4IG1hcmtldCBvZmZlcnM6CiAgICAgICAgICAgICAgICB1aW50IGxhc3RJbmRleCA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLnBvcChQUkVWKTsgLy9Qb3BzIGFuZCByZW1vdmVzIGxhc3QgZWxlbWVudCBvZiB0aGUgbGlzdCEKICAgICAgICAgICAgICAgIGRlbGV0ZSBibGFja01hcmtldE9mZmVyc01hcFtsYXN0SW5kZXhdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBlbWl0IEJsYWNrTWFya2V0T2ZmZXJBdmFpbGFibGUocXVhbnRpdHksIHByaWNlUmF0aW8pOwogICAgICAgICAgICByZXR1cm4gKHRydWUsIG5ld05vZGVOdW0pOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIENhbmNlbCBvcmRlciBvbiB0aGUgYmxhY2ttYXJrZXQgdG8gc2VsbCBhIGNlcnRhaW4gcXVhbnRpdHkgb2YgY29rZSBhdCBhIGNlcnRhaW4gcHJpY2UuCiAgICAvLyBJZiB0aGUgc2VsbGVyIGhhcyB2YXJpb3VzIG9yZGVyIHdpdGggdGhlIHNhbWUgcXVhbnRpdHkgYW5kIHByaWNlUmF0aW8sIGFuZCBjYW4gcHV0IHBhcmFtZXRlciAiY29udGludWVBZnRlckZpcnN0TWF0Y2giIHRvIHRydWUsIAogICAgLy8gc28gaXQgd2lsbCBjb250aW51ZSBhbmQgY2FuY2VsIGFsbCB0aG9zZSBibGFjayBtYXJrZXQgb3JkZXJzLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBjYW5jZWxTZWxsVG9CbGFja01hcmtldCh1aW50IHF1YW50aXR5LCB1aW50IHByaWNlUmF0aW8sIGJvb2wgY29udGludWVBZnRlckZpcnN0TWF0Y2gpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcywgdWludCBudW1PcmRlcnNDYW5jZWxlZCkgewogICAgICAgIC8vR2V0IGZpcnN0IG5vZGU6CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgYm9vbCBtYXRjaEZvdW5kID0gZmFsc2U7CiAgICAgICAgdWludCBvZmZlck5vZGVJbmRleDsKICAgICAgICB1aW50IG9mZmVyTm9kZUluZGV4VG9Qcm9jZXNzOwogICAgICAgIChleGlzdHMsIG9mZmVyTm9kZUluZGV4KSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLmdldEFkamFjZW50KEhFQUQsIE5FWFQpOwogICAgICAgIGlmKCFleGlzdHMpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOyAvL0JsYWNrIE1hcmtldCBpcyBlbXB0eSBvZiBvZmZlcnMhCgogICAgICAgIGRvIHsKCiAgICAgICAgICAgIG9mZmVyTm9kZUluZGV4VG9Qcm9jZXNzID0gb2ZmZXJOb2RlSW5kZXg7IC8vU3RvcmUgdGhlIGN1cnJlbnQgaW5kZXggdGhhdCBpcyBiZWluZyBwcm9jZXNzZWQhCiAgICAgICAgICAgIChleGlzdHMsIG9mZmVyTm9kZUluZGV4KSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLmdldEFkamFjZW50KG9mZmVyTm9kZUluZGV4LCBORVhUKTsgLy9HZXQgbmV4dCBub2RlCiAgICAgICAgICAgIC8vQW5hbHlzZSBjdXJyZW50IG5vZGUsIHRvIHNlZSBpZiBpdCBpcyB0aGUgb25lIHRvIGNhbmNlbDoKICAgICAgICAgICAgaWYoICAgYmxhY2tNYXJrZXRPZmZlcnNNYXBbb2ZmZXJOb2RlSW5kZXhUb1Byb2Nlc3NdLnNlbGxlciA9PSBtc2cuc2VuZGVyIAogICAgICAgICAgICAgICAmJiBibGFja01hcmtldE9mZmVyc01hcFtvZmZlck5vZGVJbmRleFRvUHJvY2Vzc10ucXVhbnRpdHkgPT0gcXVhbnRpdHkKICAgICAgICAgICAgICAgJiYgYmxhY2tNYXJrZXRPZmZlcnNNYXBbb2ZmZXJOb2RlSW5kZXhUb1Byb2Nlc3NdLnByaWNlID09IHByaWNlUmF0aW8pIHsKICAgICAgICAgICAgICAgICAgIC8vQ2FuY2VsIGN1cnJlbnQgb2ZmZXI6CiAgICAgICAgICAgICAgICAgICBibGFja01hcmtldE9mZmVyc1NvcnRlZC5yZW1vdmUob2ZmZXJOb2RlSW5kZXhUb1Byb2Nlc3MpOwogICAgICAgICAgICAgICAgICAgZGVsZXRlIGJsYWNrTWFya2V0T2ZmZXJzTWFwW29mZmVyTm9kZUluZGV4VG9Qcm9jZXNzXTsKICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgbnVtT3JkZXJzQ2FuY2VsZWQrKzsKICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGVtaXQgQmxhY2tNYXJrZXRPZmZlckNhbmNlbGxlZChxdWFudGl0eSwgcHJpY2VSYXRpbyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtYXRjaEZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIHdoaWxlKG9mZmVyTm9kZUluZGV4ICE9IE5VTEwgJiYgZXhpc3RzICYmICghbWF0Y2hGb3VuZCB8fCBjb250aW51ZUFmdGVyRmlyc3RNYXRjaCkpOwogICAgICAgIAogICAgICAgIHJldHVybiAoc3VjY2VzcywgbnVtT3JkZXJzQ2FuY2VsZWQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVBbmRVcGRhdGVHYWlucyhTZWxsT2ZmZXJDb21wbGV0ZSBvZmZlclRoaXNSb3VuZCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vQ2FsY3VsYXRlIHZhbHVlcyB0byBiZSBwYXllZCBmb3IgdGhpcyBzZWxsZXI6CiAgICAgICAgdWludCB3ZWlUb0JlUGF5ZWQgPSBjYWxjdWxhdGVFdGhWYWx1ZUZyb21Ub2tlbnMob2ZmZXJUaGlzUm91bmQucXVhbnRpdHksIG9mZmVyVGhpc1JvdW5kLnByaWNlKTsKCiAgICAgICAgLy9DYWxjdWxhdGUgZmVlcyBhbmQgdmFsdWVzIHRvIGRpc3RyaWJ1dGU6CiAgICAgICAgdWludCBmZWUgPSBzYWZlRGl2KHdlaVRvQmVQYXllZCwgbWFya2V0Q29taXNzaW9uUmF0aW8pOwogICAgICAgIHVpbnQgdmFsdWVGb3JTZWxsZXIgPSBzYWZlU3ViKHdlaVRvQmVQYXllZCwgZmVlKTsKCiAgICAgICAgLy9VcGRhdGUgY2hhbmdlIHZhbHVlcyAoc2VsbGVyIHdpbGwgaGF2ZSB0byByZXRyaWV2ZSBoaXMvaGVyIGdhaW5zIGJ5IGNhbGxpbmcgbWV0aG9kICJyZXRyaWV2ZUdhaW5zIiB0byByZWNlaXZlIHRoZSBFdGgpCiAgICAgICAgZ2FpbnNUb1JlY2VpdmVbb2ZmZXJUaGlzUm91bmQuc2VsbGVyXSA9IHNhZmVBZGQoZ2FpbnNUb1JlY2VpdmVbb2ZmZXJUaGlzUm91bmQuc2VsbGVyXSwgdmFsdWVGb3JTZWxsZXIpOwogICAgICAgIGVtaXQgR2FpbnNHb3R0ZW4ob2ZmZXJUaGlzUm91bmQuc2VsbGVyLCB2YWx1ZUZvclNlbGxlciwgZ2FpbnNUb1JlY2VpdmVbb2ZmZXJUaGlzUm91bmQuc2VsbGVyXSk7CgogICAgICAgIHJldHVybiB3ZWlUb0JlUGF5ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hPZmZlcih1aW50IHF1YW50aXR5LCB1aW50IG5vZGVJbmRleCwgU2VsbE9mZmVyQ29tcGxldGUgc3RvcmFnZSBvZmZlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBleGlzdHMsIHVpbnQgb2ZmZXJOb2RlSW5kZXgsIHVpbnQgcXVhbnRpdHlSb3VuZCwgdWludCB3ZWlUb0JlUGF5ZWQsIGJvb2wgY2xlYXJlZCkgewogICAgICAgIHVpbnQgcXVhbnRpdHlUb0NoZWNrID0gbWluKHF1YW50aXR5LCBvZmZlci5xdWFudGl0eSk7IC8vUXVhbnRpdHkgdG8gY2hlY2sgZm9yIHRoaXMgc2VsbGVyIG9mZmVyKQogICAgICAgIFNlbGxPZmZlckNvbXBsZXRlIG1lbW9yeSBvZmZlclRoaXNSb3VuZCA9IG9mZmVyOwogICAgICAgIGJvb2wgZm9yY2VSZW1vdmFsT2ZmZXIgPSBmYWxzZTsKCiAgICAgICAgLy9DaGVjayB0b2tlbiBiYWxhbmNlIG9mIHNlbGxlcjoKICAgICAgICBpZihiYWxhbmNlc1tvZmZlclRoaXNSb3VuZC5zZWxsZXJdIDwgcXVhbnRpdHlUb0NoZWNrKSB7CiAgICAgICAgICAgIC8vSW52YWxpZCBvZmZlciBub3csIHVzZXIgbm8gbG9uZ2VyIGhhcyBzdWZmaWNpZW50IGJhbGFuY2UKICAgICAgICAgICAgcXVhbnRpdHlUb0NoZWNrID0gYmFsYW5jZXNbb2ZmZXJUaGlzUm91bmQuc2VsbGVyXTsKCiAgICAgICAgICAgIC8vU2VsbGVyIHdpbGwgbm8gbG9uZ2VyIGhhdmUgYmFsYW5jZTogQ2xlYXIgb2ZmZXIgZnJvbSBtYXJrZXQhCiAgICAgICAgICAgIGZvcmNlUmVtb3ZhbE9mZmVyID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIG9mZmVyVGhpc1JvdW5kLnF1YW50aXR5ID0gcXVhbnRpdHlUb0NoZWNrOwoKICAgICAgICBpZihvZmZlclRoaXNSb3VuZC5xdWFudGl0eSA+IDApIHsKICAgICAgICAgICAgLy9TZWxsZXIgb2YgdGhpcyBvZmZlciB3aWxsIHJlY2VpdmUgaGlzIEV0aGVyOgoKICAgICAgICAgICAgLy9DYWxjdWxhdGUgYW5kIHVwZGF0ZSBnYWluczoKICAgICAgICAgICAgd2VpVG9CZVBheWVkID0gY2FsY3VsYXRlQW5kVXBkYXRlR2FpbnMob2ZmZXJUaGlzUm91bmQpOwoKICAgICAgICAgICAgLy9VcGRhdGUgY3VycmVudCBvZmZlcjoKICAgICAgICAgICAgb2ZmZXIucXVhbnRpdHkgPSBzYWZlU3ViKG9mZmVyLnF1YW50aXR5LCBvZmZlclRoaXNSb3VuZC5xdWFudGl0eSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL0VtaXQgZXZlbnQgdG8gc2lnbmFsIGFuIG9yZGVyIHdhcyBib3VnaHQ6CiAgICAgICAgICAgIGVtaXQgQmxhY2tNYXJrZXRPZmZlckJvdWdodChvZmZlclRoaXNSb3VuZC5xdWFudGl0eSwgb2ZmZXJUaGlzUm91bmQucHJpY2UsIG9mZmVyLnF1YW50aXR5KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vVHJhbnNmZXIgdG9rZW5zIGJldHdlZW4gc2VsbGVyIGFuZCBidXllcjoKICAgICAgICAgICAgLy9TQUZFVFkgQ0hFQ0s6IE5vIG1vcmUgdHJhbnNhY3Rpb25zIGFyZSBtYWRlIHRvIG90aGVyIGNvbnRyYWN0cyEKICAgICAgICAgICAgdHJhbnNmZXJJbnQob2ZmZXIuc2VsbGVyLCBtc2cuc2VuZGVyIC8qIGJ1eWVyICovLCBvZmZlclRoaXNSb3VuZC5xdWFudGl0eSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vS2VlcCBhIGNvcHkgb2YgbmV4dCBub2RlOgogICAgICAgIChleGlzdHMsIG9mZmVyTm9kZUluZGV4KSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLmdldEFkamFjZW50KG5vZGVJbmRleCwgTkVYVCk7CiAgICAgICAgCiAgICAgICAgLy9DaGVjayBpZiBjdXJyZW50IG9mZmVyIHdhcyBjb21wbGV0ZWx5IGZ1bGxmdWxsZWQgYW5kIHJlbW92ZSBpdCBmcm9tIG1hcmtldDoKICAgICAgICBpZihmb3JjZVJlbW92YWxPZmZlciB8fCBvZmZlci5xdWFudGl0eSA9PSAwKSB7CiAgICAgICAgICAgIC8vU2VsbGVyIG5vIGxvbmdlciBoYXMgYmFsYW5jZTogQ2xlYXIgb2ZmZXIgZnJvbSBtYXJrZXQhCiAgICAgICAgICAgIC8vT3IgU2VsbGVyIE9mZmVyIHdhcyBjb21wbGV0ZWx5IGZ1bGZpbGxlZAogICAgICAgICAgICAKICAgICAgICAgICAgLy9EZWxldGUgdGhlIGZpcnN0IGVsZW1lbnQgc28gd2UgY2FuIHJlbW92ZSBjdXJyZW50IG9yZGVyIGZyb20gdGhlIG1hcmtldDoKICAgICAgICAgICAgdWludCBmaXJzdEluZGV4ID0gYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQucG9wKE5FWFQpOyAvL1BvcHMgYW5kIHJlbW92ZXMgZmlyc3QgZWxlbWVudCBvZiB0aGUgbGlzdCEKICAgICAgICAgICAgZGVsZXRlIGJsYWNrTWFya2V0T2ZmZXJzTWFwW2ZpcnN0SW5kZXhdOwogICAgICAgICAgICAKICAgICAgICAgICAgY2xlYXJlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHF1YW50aXR5Um91bmQgPSBvZmZlclRoaXNSb3VuZC5xdWFudGl0eTsKCiAgICAgICAgcmV0dXJuIChleGlzdHMsIG9mZmVyTm9kZUluZGV4LCBxdWFudGl0eVJvdW5kLCB3ZWlUb0JlUGF5ZWQsIGNsZWFyZWQpOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUHV0IG9yZGVyIG9uIHRoZSBibGFja21hcmtldCB0byBzZWxsIGEgY2VydGFpbiBxdWFudGl0eSBvZiBjb2tlIGF0IGEgY2VydGFpbiBwcmljZS4KICAgIC8vIFRoZSBwcmljZSByYXRpbyBpcyBob3cgbXVjaCBtaWNyb2dyYW1zICh1Zykgb2YgbWF0ZXJpYWwgKHRva2VucykgdGhlIGJ1eWVyIHdpbGwgZ2V0IHBlciBFVEggKHVnL0VUSCkgKGZvciBleGFtcGxlLCB0byBnZXQgMTBnIGZvciAxIEVUSCwgdGhlIHJhdGlvIHNob3VsZCBiZSAxMDAwMDAwMCkKICAgIC8vIEZvciBidXllcnMgdGhlIGhpZ2hlciB0aGUgcmF0aW8gdGhlIGJldHRlciwgdGhlIG1vcmUgdGhleSBnZXQhCiAgICAvLyAtIEJ1eWVyIG11c3QgaGF2ZSBzZW50IGVub3VnaCBwYXltZW50IGZvciB0aGUgYnV5IGhlIHdhbnRzCiAgICAvLyAtIElmIGJ1eWVyIHNlbmRzIG1vcmUgdGhhbiBuZWVkZWQsIGl0IHdpbGwgYmUgYXZhaWxhYmxlIGZvciBoaW0gdG8gZ2V0IGl0IGJhY2sgYXMgY2hhbmdlICh0aHJvdWdoIHRoZSByZXRyaWV2ZUNoYW5nZSBtZXRob2QpCiAgICAvLyAtIEdhaW5zIG9mIHNlbGxlcnMgd2lsbCBiZSBhdmFpbGFibGUgdGhyb3VnaCB0aGUgcmV0cmlldmVHYWlucyBtZXRob2QKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gYnV5RnJvbUJsYWNrTWFya2V0KHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2VSYXRpb0xpbWl0KSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHdoZW5Ob3RGbHVzaGluZyBub1JlZW50cmFuY3kgcmV0dXJucyAoYm9vbCBzdWNjZXNzLCBib29sIHBhcnRpYWwsIHVpbnQgbnVtT3JkZXJzQ2xlYXJlZCkgewogICAgICAgIG51bU9yZGVyc0NsZWFyZWQgPSAwOwogICAgICAgIHBhcnRpYWwgPSBmYWxzZTsKCiAgICAgICAgLy9HZXQgY2hlYXBlc3Qgb2ZmZXIgb24gdGhlIG1hcmtldCByaWdodCBub3c6CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgYm9vbCBjbGVhcmVkID0gZmFsc2U7CiAgICAgICAgdWludCBvZmZlck5vZGVJbmRleDsKICAgICAgICAoZXhpc3RzLCBvZmZlck5vZGVJbmRleCkgPSBibGFja01hcmtldE9mZmVyc1NvcnRlZC5nZXRBZGphY2VudChIRUFELCBORVhUKTsKICAgICAgICBpZighZXhpc3RzKSB7CiAgICAgICAgICAgIC8vQWJvcnQgYnV5IGZyb20gbWFya2V0IQogICAgICAgICAgICByZXZlcnQoKTsgLy9SZXR1cm4gRXRoIHRvIGJ1eWVyIQogICAgICAgICAgICAvL01heWJlIGluIHRoZSBmdXR1cmUsIHB1dCB0aGUgYnV5ZXIgb2ZmZXIgaW4gYSBidXllcidzIG9mZmVycyBsaXN0IQogICAgICAgICAgICAvL1RPRE86IElNUFJPVkVNRU5UUyEKICAgICAgICB9CiAgICAgICAgU2VsbE9mZmVyQ29tcGxldGUgc3RvcmFnZSBvZmZlciA9IGJsYWNrTWFya2V0T2ZmZXJzTWFwW29mZmVyTm9kZUluZGV4XTsKICAgICAgICAKICAgICAgICB1aW50IHRvdGFsVG9CZVBheWVkV2VpID0gMDsKICAgICAgICB1aW50IHdlaVRvQmVQYXllZFJvdW5kID0gMDsKICAgICAgICB1aW50IHF1YW50aXR5Um91bmQgPSAwOwoKICAgICAgICAvL1doZW4gY29tcGFyaW5nIHJhdGlvcyB0aGUgc21hbGxlciBvbmUgd2lsbCBiZSB0aGUgb25lIHdpdGggdGhlIGdyZWF0ZXIgcmF0aW8gKGNoZWFwZXIgcHJpY2UpOgogICAgICAgIC8vaWYob2ZmZXIucHJpY2UgPiBwcmljZVJhdGlvTGltaXQpIHsKICAgICAgICBpZihvZmZlci5wcmljZSA8IHByaWNlUmF0aW9MaW1pdCkgewogICAgICAgICAgICAvL0Fib3J0IGJ1eSBmcm9tIG1hcmtldCEgTm90IG9uZSBzZWxsIG9mZmVyIGlzIGNoZWFwZXIgdGhhbiB0aGUgcHJpY2VSYXRpb0xpbWl0CiAgICAgICAgICAgIC8vQmxhY2tNYXJrZXROb09mZmVyRm9yUHJpY2UocHJpY2VSYXRpb0xpbWl0KTsKICAgICAgICAgICAgLy9yZXR1cm4gKGZhbHNlLCAwKTsKICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vUmV0dXJuIEV0aCB0byBidXllciEKICAgICAgICAgICAgLy9NYXliZSBpbiB0aGUgZnV0dXJlLCBwdXQgdGhlIGJ1eWVyIG9mZmVyIGluIGEgYnV5ZXIncyBvZmZlcnMgbGlzdCEKICAgICAgICAgICAgLy9UT0RPOiBJTVBST1ZFTUVOVFMhCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGJvb2wgYWJvcnQgPSBmYWxzZTsKICAgICAgICAvL0N5Y2xlIHRocm91Z2ggbWFya2V0IHNlbGxlciBvZmZlcnM6CiAgICAgICAgZG8gewogICAgICAgIAogICAgICAgICAgICAoZXhpc3RzIC8qIEV4aXN0cyBuZXh0IG9mZmVyIHRvIG1hdGNoICovLCAKICAgICAgICAgICAgIG9mZmVyTm9kZUluZGV4LCAvKiBOb2RlIGluZGV4IGZvciBOZXh0IE9mZmVyICovCiAgICAgICAgICAgICBxdWFudGl0eVJvdW5kLCAvKiBRdWFudGl0eSB0aGF0IHdhcyBtYXRjaGVkIGluIHRoaXMgcm91bmQgKi8KICAgICAgICAgICAgIHdlaVRvQmVQYXllZFJvdW5kLCAvKiBXZWkgdGhhdCB3YXMgdXNlZCB0byBwYXkgZm9yIHRoaXMgcm91bmQgKi8KICAgICAgICAgICAgIGNsZWFyZWQgLyogT2ZmZXIgd2FzIGNvbXBsZXRlbHkgZnVsZmlsbGVkIGFuZCB3YXMgY2xlYXJlZCEgKi8KICAgICAgICAgICAgICkgPSBtYXRjaE9mZmVyKHF1YW50aXR5LCBvZmZlck5vZGVJbmRleCwgb2ZmZXIpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoY2xlYXJlZCkgewogICAgICAgICAgICAgICAgbnVtT3JkZXJzQ2xlYXJlZCsrOwogICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgLy9VcGRhdGUgdG90YWwgdG8gYmUgcGF5ZWQgKGluIFdlaSk6CiAgICAgICAgICAgIHRvdGFsVG9CZVBheWVkV2VpID0gc2FmZUFkZCh0b3RhbFRvQmVQYXllZFdlaSwgd2VpVG9CZVBheWVkUm91bmQpOwogICAgCiAgICAgICAgICAgIC8vVXBkYXRlIHF1YW50aXR5IChzdGlsbCBtaXNzaW5nIHRvIGJlIHNhdGlzZmllZCk6CiAgICAgICAgICAgIHF1YW50aXR5ID0gc2FmZVN1YihxdWFudGl0eSwgcXVhbnRpdHlSb3VuZCk7CiAgICAKICAgICAgICAgICAgLy9DaGVjayBpZiBidXllciBzZW5kIGVub3VnaCBiYWxhbmNlIHRvIGJ1eSB0aGUgb3JkZXJzOiAgICAgICAgCiAgICAgICAgICAgIGlmKHRvdGFsVG9CZVBheWVkV2VpID4gbXNnLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBlbWl0IE9yZGVySW5zdWZmaWNpZW50UGF5bWVudChtc2cuc2VuZGVyLCB0b3RhbFRvQmVQYXllZFdlaSwgbXNnLnZhbHVlKTsKICAgICAgICAgICAgICAgIC8vQWJvcnQgdHJhbnNhY3Rpb24hOgogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vUmV2ZXJ0IHRyYW5zYWN0aW9uLCBzbyBFdGggc2VuZCBhcmUgbm90IHRyYW5zZmVycmVkLCBhbmQgZ28gYmFjayB0byB1c2VyIQogICAgICAgICAgICAgICAgLy9UT0RPOiBJTVBST1ZFTUVOVFMhCiAgICAgICAgICAgICAgICAvL1RPRE86IEltcHJvdmVtZW50cyB0byBhbGxvdyBhIHBhcnRpYWwgYnV5LCBpZiBub3QgcG9zc2libGUgdG8gYnV5IGFsbCEKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9Db25maXJtIGlmIG5leHQgbm9kZSBleGlzdHM6CiAgICAgICAgICAgIGlmKG9mZmVyTm9kZUluZGV4ICE9IE5VTEwpIHsKICAgIAogICAgICAgICAgICAgICAgLy9HZXQgTmV4dCBOb2RlIChNb3JlIEluZm8pOgogICAgICAgICAgICAgICAgb2ZmZXIgPSBibGFja01hcmtldE9mZmVyc01hcFtvZmZlck5vZGVJbmRleF07CiAgICAKICAgICAgICAgICAgICAgIC8vQ2hlY2sgaWYgbmV4dCBvcmRlciBpcyBhYm92ZSB0aGUgcHJpY2VSYXRpb0xpbWl0IHNldCBieSB0aGUgYnV5ZXI6ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL1doZW4gY29tcGFyaW5nIHJhdGlvcyB0aGUgc21hbGxlciBvbmUgd2lsbCBiZSB0aGUgb25lIHdpdGggdGhlIGdyZWF0ZXIgcmF0aW8gKGNoZWFwZXIgcHJpY2UpOgogICAgICAgICAgICAgICAgLy9pZihvZmZlci5wcmljZSA+IHByaWNlUmF0aW9MaW1pdCkgewogICAgICAgICAgICAgICAgaWYob2ZmZXIucHJpY2UgPCBwcmljZVJhdGlvTGltaXQpIHsKICAgICAgICAgICAgICAgICAgICAvL0Fib3J0IGJ1eWluZyBtb3JlIGZyb20gdGhlIHNlbGxlcidzIG1hcmtldDoKICAgICAgICAgICAgICAgICAgICBhYm9ydCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcGFydGlhbCA9IHRydWU7IC8vUGFydGlhbCBidXkgb3JkZXIgZG9uZSEgKG5vIHN1ZmZpY2llbnQgc2VsbGVyIG9mZmVyJ3MgYmVsb3cgdGhlIHByaWNlUmF0aW9MaW1pdCkKICAgICAgICAgICAgICAgICAgICAvL01heWJlIGluIHRoZSBmdXR1cmUsIHB1dCB0aGUgYnV5ZXIgb2ZmZXIgaW4gYSBidXllcidzIG9mZmVycyBsaXN0IQogICAgICAgICAgICAgICAgICAgIC8vVE9ETzogSU1QUk9WRU1FTlRTIQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy9BYm9ydCBidXlpbmcgbW9yZSBmcm9tIHRoZSBzZWxsZXIncyBtYXJrZXQgKHRoZSBlbmQgd2FzIHJlYWNoZWQhKToKICAgICAgICAgICAgICAgIGFib3J0ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB3aGlsZSAoZXhpc3RzICYmIHF1YW50aXR5ID4gMCAmJiAhYWJvcnQpOwogICAgICAgIC8vRW5kIEN5Y2xlIHRocm91Z2ggb3JkZXJzIQoKICAgICAgICAvL0ZpbmFsIG9wZXJhdGlvbnMgYWZ0ZXIgY2hlY2tpbmcgYWxsIG9yZGVyczoKICAgICAgICBpZih0b3RhbFRvQmVQYXllZFdlaSA8IG1zZy52YWx1ZSkgewogICAgICAgICAgICAvL0dpdmUgY2hhbmdlIGJhY2sgdG8gdGhlIGJ1eWVyOgogICAgICAgICAgICAvL1JldHVybiBjaGFuZ2UgdG8gdGhlIGJ1eWVyIChzZW5kZXIgb2YgdGhlIG1lc3NhZ2UgaW4gdGhpcyBjYXNlKQogICAgICAgICAgICBjaGFuZ2VUb1JldHVyblttc2cuc2VuZGVyXSA9IHNhZmVBZGQoY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSAtIHRvdGFsVG9CZVBheWVkV2VpKTsgLy9TQUZFVFkgQ0hFQ0s6IE5vIG5lZWQgdG8gdXNlIHNhZmVTdWIsIGFzIHdlIGFscmVhZHkga25vdyB0aGF0ICJtc2cudmFsdWUiID4gInRvdGFsVG9CZVBheWVkV2VpIiEKICAgICAgICAgICAgZW1pdCBDaGFuZ2VUb1JlY2VpdmVHb3R0ZW4obXNnLnNlbmRlciwgbXNnLnZhbHVlIC0gdG90YWxUb0JlUGF5ZWRXZWksIGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAodHJ1ZSwgcGFydGlhbCwgbnVtT3JkZXJzQ2xlYXJlZCk7CiAgICB9CiAgICAKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gR2V0cyB0aGUgbGlzdCBvZiBvcmRlcnMgb24gdGhlIGJsYWNrIG1hcmtldCAob3JkZXJlZCBieSBjaGVhcGVzdCB0byBleHBlbnNpdmUpLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBnZXRTZWxsT3JkZXJzQmxhY2tNYXJrZXQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50W10gbWVtb3J5IHIpIHsKICAgICAgICByID0gbmV3IHVpbnRbXShibGFja01hcmtldE9mZmVyc1NvcnRlZC5zaXplT2YoKSk7CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgdWludCBwcmV2OwogICAgICAgIHVpbnQgZWxlbTsKICAgICAgICAoZXhpc3RzLCBwcmV2LCBlbGVtKSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLmdldE5vZGUoSEVBRCk7CiAgICAgICAgaWYoZXhpc3RzKSB7CiAgICAgICAgICAgIHVpbnQgc2l6ZSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLnNpemVPZigpOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICByW2ldID0gZWxlbTsKICAgICAgICAgICAgICAoZXhpc3RzLCBlbGVtKSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLmdldEFkamFjZW50KGVsZW0sIE5FWFQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEdldHMgdGhlIGxpc3Qgb2Ygb3JkZXJzIG9uIHRoZSBibGFjayBtYXJrZXQgKG9yZGVyZWQgYnkgY2hlYXBlc3QgdG8gZXhwZW5zaXZlKS4KICAgIC8vIFdBUk5JTkc6IE5vdCBTdXBwb3J0ZWQgYnkgUmVtaXggb3IgV2ViMyEhIChTdHJ1Y3R1cmUgQXJyYXkgcmV0dXJucykKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLyoKICAgIGZ1bmN0aW9uIGdldFNlbGxPcmRlcnNCbGFja01hcmtldENvbXBsZXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoU2VsbE9mZmVyW10gbWVtb3J5IHIpIHsKICAgICAgICByID0gbmV3IFNlbGxPZmZlcltdKGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLnNpemVPZigpKTsKICAgICAgICBib29sIGV4aXN0czsKICAgICAgICB1aW50IHByZXY7CiAgICAgICAgdWludCBlbGVtOwogICAgICAgIChleGlzdHMsIHByZXYsIGVsZW0pID0gYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQuZ2V0Tm9kZShIRUFEKTsKICAgICAgICBpZihleGlzdHMpIHsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQuc2l6ZU9mKCk7IGkrKykgewogICAgICAgICAgICAgICAgU2VsbE9mZmVyQ29tcGxldGUgc3RvcmFnZSBvZmZlciA9IGJsYWNrTWFya2V0T2ZmZXJzTWFwW2VsZW1dOwogICAgICAgICAgICAgICAgcltpXS5xdWFudGl0eSA9IG9mZmVyLnF1YW50aXR5OwogICAgICAgICAgICAgICAgcltpXS5wcmljZSA9IG9mZmVyLnByaWNlOwogICAgICAgICAgICAgICAgKGV4aXN0cywgZWxlbSkgPSBibGFja01hcmtldE9mZmVyc1NvcnRlZC5nZXRBZGphY2VudChlbGVtLCBORVhUKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICovCiAgICBmdW5jdGlvbiBnZXRTZWxsT3JkZXJzQmxhY2tNYXJrZXRDb21wbGV0ZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnRbXSBtZW1vcnkgcXVhbnRpdGllcywgdWludFtdIG1lbW9yeSBwcmljZXMpIHsKICAgICAgICBxdWFudGl0aWVzID0gbmV3IHVpbnRbXShibGFja01hcmtldE9mZmVyc1NvcnRlZC5zaXplT2YoKSk7CiAgICAgICAgcHJpY2VzID0gbmV3IHVpbnRbXShibGFja01hcmtldE9mZmVyc1NvcnRlZC5zaXplT2YoKSk7CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgdWludCBwcmV2OwogICAgICAgIHVpbnQgZWxlbTsKICAgICAgICAoZXhpc3RzLCBwcmV2LCBlbGVtKSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLmdldE5vZGUoSEVBRCk7CiAgICAgICAgaWYoZXhpc3RzKSB7CiAgICAgICAgICAgIHVpbnQgc2l6ZSA9IGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLnNpemVPZigpOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIFNlbGxPZmZlckNvbXBsZXRlIHN0b3JhZ2Ugb2ZmZXIgPSBibGFja01hcmtldE9mZmVyc01hcFtlbGVtXTsKICAgICAgICAgICAgICAgIHF1YW50aXRpZXNbaV0gPSBvZmZlci5xdWFudGl0eTsKICAgICAgICAgICAgICAgIHByaWNlc1tpXSA9IG9mZmVyLnByaWNlOwogICAgICAgICAgICAgICAgLy9HZXQgbmV4dCBlbGVtZW50OgogICAgICAgICAgICAgICAgKGV4aXN0cywgZWxlbSkgPSBibGFja01hcmtldE9mZmVyc1NvcnRlZC5nZXRBZGphY2VudChlbGVtLCBORVhUKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNeVNlbGxPcmRlcnNCbGFja01hcmtldENvbXBsZXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludFtdIG1lbW9yeSBxdWFudGl0aWVzLCB1aW50W10gbWVtb3J5IHByaWNlcykgewogICAgICAgIHF1YW50aXRpZXMgPSBuZXcgdWludFtdKGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLnNpemVPZigpKTsKICAgICAgICBwcmljZXMgPSBuZXcgdWludFtdKGJsYWNrTWFya2V0T2ZmZXJzU29ydGVkLnNpemVPZigpKTsKICAgICAgICBib29sIGV4aXN0czsKICAgICAgICB1aW50IHByZXY7CiAgICAgICAgdWludCBlbGVtOwogICAgICAgIChleGlzdHMsIHByZXYsIGVsZW0pID0gYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQuZ2V0Tm9kZShIRUFEKTsKICAgICAgICBpZihleGlzdHMpIHsKICAgICAgICAgICAgdWludCBzaXplID0gYmxhY2tNYXJrZXRPZmZlcnNTb3J0ZWQuc2l6ZU9mKCk7CiAgICAgICAgICAgIHVpbnQgaiA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgU2VsbE9mZmVyQ29tcGxldGUgc3RvcmFnZSBvZmZlciA9IGJsYWNrTWFya2V0T2ZmZXJzTWFwW2VsZW1dOwogICAgICAgICAgICAgICAgaWYob2ZmZXIuc2VsbGVyID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgICAgICBxdWFudGl0aWVzW2pdID0gb2ZmZXIucXVhbnRpdHk7CiAgICAgICAgICAgICAgICAgICAgcHJpY2VzW2pdID0gb2ZmZXIucHJpY2U7CiAgICAgICAgICAgICAgICAgICAgaisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9HZXQgbmV4dCBlbGVtZW50OgogICAgICAgICAgICAgICAgKGV4aXN0cywgZWxlbSkgPSBibGFja01hcmtldE9mZmVyc1NvcnRlZC5nZXRBZGphY2VudChlbGVtLCBORVhUKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL3F1YW50aXRpZXMubGVuZ3RoID0gajsgLy9NZW1vcnkgQXJyYXlzIGNhbid0IGJlIHJldHVybmVkIHdpdGggZHluYW1pYyBzaXplLCB3ZSBoYXZlIHRvIGNyZWF0ZSBhcnJheXMgd2l0aCBhIGZpeGVkIHNpemUgdG8gYmUgcmV0dXJuZWQhCiAgICAgICAgLy9wcmljZXMubGVuZ3RoID0gajsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFB1dHMgYW4gb2ZmZXIgb24gdGhlIG1hcmtldCB0byBhIHNwZWNpZmljIHVzZXIgKGlmIGFuIG9mZmVyIGZyb20gdGhlIHNhbWUgc2VsbGVyIHRvIHRoZSBzYW1lIGNvbnN1bWVyIGFscmVhZHkgZXhpc3RzLCB0aGUgbGF0ZXN0IG9mZmVyIHdpbGwgcmVwbGFjZSBpdCkKICAgIC8vIFRoZSBwcmljZSByYXRpbyBpcyBob3cgbXVjaCBtaWNyb2dyYW1zICh1Zykgb2YgbWF0ZXJpYWwgKHRva2VucykgdGhlIGJ1eWVyIHdpbGwgZ2V0IHBlciBFVEggKHVnL0VUSCkKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2VsbFRvQ29uc3VtZXIoYWRkcmVzcyBjb25zdW1lciwgdWludCBxdWFudGl0eSwgdWludCBwcmljZVJhdGlvKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB3aGVuTm90Rmx1c2hpbmcgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShjb25zdW1lciAhPSBhZGRyZXNzKDApICYmIHF1YW50aXR5ID4gMCAmJiBwcmljZVJhdGlvID4gMCk7CiAgICAgICAgLy9NYXJrIG9mZmVyIHRvIHNlbGwgdG8gY29uc3VtZXIgb24gcmVnaXN0cnk6CiAgICAgICAgU2VsbE9mZmVyIHN0b3JhZ2Ugb2ZmZXIgPSBkaXJlY3RPZmZlcnNbbXNnLnNlbmRlcl1bY29uc3VtZXJdOwogICAgICAgIG9mZmVyLnF1YW50aXR5ID0gcXVhbnRpdHk7CiAgICAgICAgb2ZmZXIucHJpY2UgPSBwcmljZVJhdGlvOwogICAgICAgIGVtaXQgRGlyZWN0T2ZmZXJBdmFpbGFibGUobXNnLnNlbmRlciwgY29uc3VtZXIsIG9mZmVyLnF1YW50aXR5LCBvZmZlci5wcmljZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUHV0cyBhbiBvZmZlciBvbiB0aGUgbWFya2V0IHRvIGEgc3BlY2lmaWMgdXNlcgogICAgLy8gVGhlIHByaWNlIHJhdGlvIGlzIGhvdyBtdWNoIG1pY3JvZ3JhbXMgKHVnKSBvZiBtYXRlcmlhbCAodG9rZW5zKSB0aGUgYnV5ZXIgd2lsbCBnZXQgcGVyIEVUSCAodWcvRVRIKQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBjYW5jZWxTZWxsVG9Db25zdW1lcihhZGRyZXNzIGNvbnN1bWVyKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL0NoZWNrIGlmIG9yZGVyIGV4aXN0cyB3aXRoIHRoZSBjb3JyZWN0IHZhbHVlczoKICAgICAgICBTZWxsT2ZmZXIgbWVtb3J5IHNlbGxPZmZlciA9IGRpcmVjdE9mZmVyc1ttc2cuc2VuZGVyXVtjb25zdW1lcl07CiAgICAgICAgaWYoc2VsbE9mZmVyLnF1YW50aXR5ID4gMCB8fCBzZWxsT2ZmZXIucHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vV2UgZm91bmQgbWF0Y2hpbmcgc2VsbCB0byBjb25zdW1lciwgZGVsZXRlIGl0IHRvIGNhbmNlbCBpdCEKICAgICAgICAgICAgZGVsZXRlIGRpcmVjdE9mZmVyc1ttc2cuc2VuZGVyXVtjb25zdW1lcl07CiAgICAgICAgICAgIGVtaXQgRGlyZWN0T2ZmZXJDYW5jZWxsZWQobXNnLnNlbmRlciwgY29uc3VtZXIsIHNlbGxPZmZlci5xdWFudGl0eSwgc2VsbE9mZmVyLnByaWNlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIENoZWNrcyBhIHNlbGxlciBvZmZlciBmcm9tIHRoZSBzZWxsZXIgc2lkZQogICAgLy8gVGhlIHByaWNlIHJhdGlvIGlzIGhvdyBtdWNoIG1pY3JvZ3JhbXMgKHVnKSBvZiBtYXRlcmlhbCAodG9rZW5zKSB0aGUgYnV5ZXIgd2lsbCBnZXQgcGVyIEVUSCAodWcvRVRIKQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBjaGVja015U2VsbGVyT2ZmZXIoYWRkcmVzcyBjb25zdW1lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBxdWFudGl0eSwgdWludCBwcmljZVJhdGlvLCB1aW50IHRvdGFsV2VpQ29zdCkgewogICAgICAgIHF1YW50aXR5ID0gZGlyZWN0T2ZmZXJzW21zZy5zZW5kZXJdW2NvbnN1bWVyXS5xdWFudGl0eTsKICAgICAgICBwcmljZVJhdGlvID0gZGlyZWN0T2ZmZXJzW21zZy5zZW5kZXJdW2NvbnN1bWVyXS5wcmljZTsKICAgICAgICB0b3RhbFdlaUNvc3QgPSBjYWxjdWxhdGVFdGhWYWx1ZUZyb21Ub2tlbnMocXVhbnRpdHksIHByaWNlUmF0aW8pOyAvL1ZhbHVlIHRvIGJlIHBheWVkIGJ5IHRoZSBidXllciAoaW4gV2VpKQogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ2hlY2tzIGEgc2VsbGVyIG9mZmVyIHRvIHRoZSB1c2VyLiBNZXRob2QgdXNlZCBieSB0aGUgYnV5ZXIgdG8gY2hlY2sgYW4gb2ZmZXIgKGRpcmVjdCBvZmZlcikgZnJvbSBhIHNlbGxlciB0byBoaW0vaGVyIGFuZCB0byBzZWUgCiAgICAvLyBob3cgbXVjaCBoZS9zaGUgd2lsbCBoYXZlIHRvIHBheSBmb3IgaXQgKGluIFdlaSkuCiAgICAvLyBUaGUgcHJpY2UgcmF0aW8gaXMgaG93IG11Y2ggbWljcm9ncmFtcyAodWcpIG9mIG1hdGVyaWFsICh0b2tlbnMpIHRoZSBidXllciB3aWxsIGdldCBwZXIgRVRIICh1Zy9FVEgpCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGNoZWNrU2VsbGVyT2ZmZXIoYWRkcmVzcyBzZWxsZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2VSYXRpbywgdWludCB0b3RhbFdlaUNvc3QpIHsKICAgICAgICBxdWFudGl0eSA9IGRpcmVjdE9mZmVyc1tzZWxsZXJdW21zZy5zZW5kZXJdLnF1YW50aXR5OwogICAgICAgIHByaWNlUmF0aW8gPSBkaXJlY3RPZmZlcnNbc2VsbGVyXVttc2cuc2VuZGVyXS5wcmljZTsKICAgICAgICB0b3RhbFdlaUNvc3QgPSBjYWxjdWxhdGVFdGhWYWx1ZUZyb21Ub2tlbnMocXVhbnRpdHksIHByaWNlUmF0aW8pOyAvL1ZhbHVlIHRvIGJlIHBheWVkIGJ5IHRoZSBidXllciAoaW4gV2VpKQogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEJ1eXMgZnJvbSBhIHRydXN0ZWQgZGVhbGVyLgogICAgLy8gVGhlIGJ1eWVyIGhhcyB0byBzZW5kIHRoZSBuZWVkZWQgRXRoZXIgdG8gcGF5IGZvciB0aGUgcXVhbnRpdHkgb2YgbWF0ZXJpYWwgc3BlY2lmaWVkIGF0IHRoYXQgcHJpY2VSYXRpbyAodGhlIGJ1eWVyIGNhbiB1c2UgCiAgICAvLyBjaGVja1NlbGxlck9mZmVyKCksIGFuZCBpbnB1dCB0aGUgc2VsbGVyIGFkZHJlc3MgdG8ga25vdyB0aGUgcXVhbnRpdHkgYW5kIHByaWNlUmF0aW8gc3BlY2lmaWVkIGFuZCBhbHNvLCBvZiBjb3Vyc2UsIGhvdyBtdWNoIEV0aGVyIGluIFdlaQogICAgLy8gaGUvc2hlIHdpbGwgaGF2ZSB0byBwYXkgZm9yIGl0KS4KICAgIC8vIFRoZSBwcmljZSByYXRpbyBpcyBob3cgbXVjaCBtaWNyb2dyYW1zICh1Zykgb2YgbWF0ZXJpYWwgKHRva2VucykgdGhlIGJ1eWVyIHdpbGwgZ2V0IHBlciBFVEggKHVnL0VUSCkKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gYnV5RnJvbVRydXN0ZXJEZWFsZXIoYWRkcmVzcyBkZWFsZXIsIHVpbnQgcXVhbnRpdHksIHVpbnQgcHJpY2VSYXRpbykgcHVibGljIHBheWFibGUgbm9SZWVudHJhbmN5IHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9DaGVjayB1cCBvbiBvZmZlcjoKICAgICAgICByZXF1aXJlKGRpcmVjdE9mZmVyc1tkZWFsZXJdW21zZy5zZW5kZXJdLnF1YW50aXR5ID4gMCAmJiBkaXJlY3RPZmZlcnNbZGVhbGVyXVttc2cuc2VuZGVyXS5wcmljZSA+IDApOyAvL09mZmVyIGV4aXN0cz8KICAgICAgICBpZihxdWFudGl0eSA+IGRpcmVjdE9mZmVyc1tkZWFsZXJdW21zZy5zZW5kZXJdLnF1YW50aXR5KSB7CiAgICAgICAgICAgIGVtaXQgT3JkZXJRdWFudGl0eU1pc21hdGNoKGRlYWxlciwgZGlyZWN0T2ZmZXJzW2RlYWxlcl1bbXNnLnNlbmRlcl0ucXVhbnRpdHksIHF1YW50aXR5KTsKICAgICAgICAgICAgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdLCBtc2cudmFsdWUpOyAvL09wZXJhdGlvbiBhYm9ydGVkOiBUaGUgYnV5ZXIgY2FuIGdldCBpdHMgZXRoZXIgYmFjayBieSB1c2luZyByZXRyaWV2ZUNoYW5nZSgpLgogICAgICAgICAgICBlbWl0IENoYW5nZVRvUmVjZWl2ZUdvdHRlbihtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZihkaXJlY3RPZmZlcnNbZGVhbGVyXVttc2cuc2VuZGVyXS5wcmljZSAhPSBwcmljZVJhdGlvKSB7CiAgICAgICAgICAgIGVtaXQgT3JkZXJQcmljZU1pc21hdGNoKGRlYWxlciwgZGlyZWN0T2ZmZXJzW2RlYWxlcl1bbXNnLnNlbmRlcl0ucHJpY2UsIHByaWNlUmF0aW8pOwogICAgICAgICAgICBjaGFuZ2VUb1JldHVyblttc2cuc2VuZGVyXSA9IHNhZmVBZGQoY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7IC8vT3BlcmF0aW9uIGFib3J0ZWQ6IFRoZSBidXllciBjYW4gZ2V0IGl0cyBldGhlciBiYWNrIGJ5IHVzaW5nIHJldHJpZXZlQ2hhbmdlKCkuCiAgICAgICAgICAgIGVtaXQgQ2hhbmdlVG9SZWNlaXZlR290dGVuKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0pOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vT2ZmZXIgdmFsaWQsIHN0YXJ0IGJ1eWluZyBwcm9jY2VzczoKICAgICAgICAKICAgICAgICAvL0dldCB2YWx1ZXMgdG8gYmUgcGF5ZWQ6CiAgICAgICAgdWludCB3ZWlUb0JlUGF5ZWQgPSBjYWxjdWxhdGVFdGhWYWx1ZUZyb21Ub2tlbnMocXVhbnRpdHksIHByaWNlUmF0aW8pOwogICAgICAgIAogICAgICAgIC8vQ2hlY2sgZXRoIHBheW1lbnQgZnJvbSBidXllcjoKICAgICAgICBpZihtc2cudmFsdWUgPCB3ZWlUb0JlUGF5ZWQpIHsKICAgICAgICAgICAgZW1pdCBPcmRlckluc3VmZmljaWVudFBheW1lbnQobXNnLnNlbmRlciwgd2VpVG9CZVBheWVkLCBtc2cudmFsdWUpOwogICAgICAgICAgICBjaGFuZ2VUb1JldHVyblttc2cuc2VuZGVyXSA9IHNhZmVBZGQoY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7IC8vT3BlcmF0aW9uIGFib3J0ZWQ6IFRoZSBidXllciBjYW4gZ2V0IGl0cyBldGhlciBiYWNrIGJ5IHVzaW5nIHJldHJpZXZlQ2hhbmdlKCkuCiAgICAgICAgICAgIGVtaXQgQ2hhbmdlVG9SZWNlaXZlR290dGVuKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0pOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vQ2hlY2sgYmFsYW5jZSBmcm9tIHNlbGxlcjoKICAgICAgICBpZihxdWFudGl0eSA+IGJhbGFuY2VzW2RlYWxlcl0pIHsKICAgICAgICAgICAgLy9TZWxsZXIgaXMgbWlzc2luZyBmdW5kczogQWJvcnQgb3JkZXI6CiAgICAgICAgICAgIGVtaXQgT3JkZXJJbnN1ZmZpY2llbnRCYWxhbmNlKGRlYWxlciwgcXVhbnRpdHksIGJhbGFuY2VzW2RlYWxlcl0pOwogICAgICAgICAgICBjaGFuZ2VUb1JldHVyblttc2cuc2VuZGVyXSA9IHNhZmVBZGQoY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7IC8vT3BlcmF0aW9uIGFib3J0ZWQ6IFRoZSBidXllciBjYW4gZ2V0IGl0cyBldGhlciBiYWNrIGJ5IHVzaW5nIHJldHJpZXZlQ2hhbmdlKCkuCiAgICAgICAgICAgIGVtaXQgQ2hhbmdlVG9SZWNlaXZlR290dGVuKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0pOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vVXBkYXRlIGJhbGFuY2VzIG9mIHNlbGxlci9idXllcjoKICAgICAgICBiYWxhbmNlc1tkZWFsZXJdID0gYmFsYW5jZXNbZGVhbGVyXSAtIHF1YW50aXR5OyAvL1NBRkVUWSBDSEVDSzogTm8gbmVlZCB0byB1c2Ugc2FmZVN1YiwgYXMgd2UgYWxyZWFkeSBrbm93IHRoYXQgImJhbGFuY2VzW2RlYWxlcl0iID49ICJxdWFudGl0eSIhCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBxdWFudGl0eSk7CiAgICAgICAgZW1pdCBUcmFuc2ZlcihkZWFsZXIsIG1zZy5zZW5kZXIsIHF1YW50aXR5KTsKCiAgICAgICAgLy9VcGRhdGUgZGlyZWN0IG9mZmVycyByZWdpc3RyeToKICAgICAgICBpZihxdWFudGl0eSA8IGRpcmVjdE9mZmVyc1tkZWFsZXJdW21zZy5zZW5kZXJdLnF1YW50aXR5KSB7CiAgICAgICAgICAgIC8vU0FGRVRZIENIRUNLOiBObyBuZWVkIHRvIHVzZSBzYWZlU3ViLCBhcyB3ZSBhbHJlYWR5IGtub3cgdGhhdCAiZGlyZWN0T2ZmZXJzW2RlYWxlcl1bbXNnLnNlbmRlcl0ucXVhbnRpdHkiID4gInF1YW50aXR5IiEKICAgICAgICAgICAgZGlyZWN0T2ZmZXJzW2RlYWxlcl1bbXNnLnNlbmRlcl0ucXVhbnRpdHkgPSBkaXJlY3RPZmZlcnNbZGVhbGVyXVttc2cuc2VuZGVyXS5xdWFudGl0eSAtIHF1YW50aXR5OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy9SZW1vdmUgb2ZmZXIgZnJvbSByZWdpc3RyeSAob3JkZXIgY29tcGxldGVseSBmaWxsZWQpCiAgICAgICAgICAgIGRlbGV0ZSBkaXJlY3RPZmZlcnNbZGVhbGVyXVttc2cuc2VuZGVyXTsKICAgICAgICB9CgogICAgICAgIC8vUmVjZWl2ZSBwYXltZW50IGZyb20gb25lIHVzZXIgYW5kIHNlbmQgaXQgdG8gYW5vdGhlciwgbWludXMgdGhlIGNvbWlzc2lvbjoKICAgICAgICAvL0NhbGN1bGF0ZSBmZWVzIGFuZCB2YWx1ZXMgdG8gZGlzdHJpYnV0ZToKICAgICAgICB1aW50IGZlZSA9IHNhZmVEaXYod2VpVG9CZVBheWVkLCBkaXJlY3RPZmZlcnNDb21pc3Npb25SYXRpbyk7CiAgICAgICAgdWludCB2YWx1ZUZvclNlbGxlciA9IHNhZmVTdWIod2VpVG9CZVBheWVkLCBmZWUpOwogICAgICAgIAogICAgICAgIC8vU0FGRVRZIENIRUNLOiBQb3NzaWJsZSBEZW5pYWwgb2YgU2VydmljZSwgYnkgcHV0dGluZyBhIGZhbGxiYWNrIGZ1bmN0aW9uIGltcG9zc2libGUgdG8gcnVuOiBObyBwcm9ibGVtISBBcyB0aGlzIGlzIGEgZGlyZWN0IG9mZmVyIGJldHdlZW4gdHdvIHVzZXJzLCBpZiBpdCBkb2Vzbid0IHdvcmsgdGhlIGZpcnN0IHRpbWUsIHRoZSB1c2VyIGNhbiBqdXN0IGlnbm9yZSB0aGUgb2ZmZXIhCiAgICAgICAgLy9TQUZFVFkgQ0hFQ0s6IE5vIFJlZW50cmFuY3kgcG9zc2libGU6IE1vZGlmaWVyIGFjdGl2ZSEKICAgICAgICAvL1NBRkVUWSBDSEVDSzogQmFsYW5jZXMgYXJlIGFsbCB1cGRhdGVkIGJlZm9yZSB0cmFuc2ZlciwgYW5kIG9mZmVyIGlzIHJlbW92ZWQvdXBkYXRlZCB0b28hIE9ubHkgY2hhbmdlIGlzIHVwZGF0ZWQgbGF0ZXIsIHdoaWNoIGlzIGdvb2QgYXMgdXNlciBjYW4gb25seSByZXRyaWV2ZSB0aGUgZnVuZHMgYWZ0ZXIgdGhpcyBvcGVyYXRpb25zIGZpbmlzaGVzIHdpdGggc3VjY2VzcyEKICAgICAgICBkZWFsZXIudHJhbnNmZXIodmFsdWVGb3JTZWxsZXIpOwoKICAgICAgICAvL1NldCBjaGFuZ2UgdG8gdGhlIGJ1eWVyIGlmIGhlIHNlbnQgZXh0cmEgZXRoOgogICAgICAgIHVpbnQgY2hhbmdlVG9HaXZlID0gc2FmZVN1Yihtc2cudmFsdWUsIHdlaVRvQmVQYXllZCk7CgogICAgICAgIGlmKGNoYW5nZVRvR2l2ZSA+IDApIHsKICAgICAgICAgICAgLy9VcGRhdGUgY2hhbmdlIHZhbHVlcyAodXNlciB3aWxsIGhhdmUgdG8gcmV0cmlldmUgdGhlIGNoYW5nZSBjYWxsaW5nIG1ldGhvZCAicmV0cmlldmVDaGFuZ2UiIHRvIHJlY2VpdmUgdGhlIEV0aCkKICAgICAgICAgICAgY2hhbmdlVG9SZXR1cm5bbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdLCBjaGFuZ2VUb0dpdmUpOwogICAgICAgICAgICBlbWl0IENoYW5nZVRvUmVjZWl2ZUdvdHRlbihtc2cuc2VuZGVyLCBjaGFuZ2VUb0dpdmUsIGNoYW5nZVRvUmV0dXJuW21zZy5zZW5kZXJdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gTWVzc2FnZSBib2FyZCBtYW5hZ2VtZW50IGZ1bmN0aW9ucwogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBDb21wYXJhdG9yIHVzZWQgdG8gY29tcGFyZSBFdGggcGF5ZWQgZm9yIGEgbWVzc2FnZSBpbnNpZGUgdGhlIHRvcCBtZXNzYWdlcyBMaW5rZWRMaXN0CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGdyZWF0ZXJQcmljZU1zZ0NvbXBhcmF0b3IodWludCB2YWx1ZVBheWVkTmV3LCB1aW50IG5vZGVOZXh0KSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiB2YWx1ZVBheWVkTmV3ID4gKHRvcE1lc3NhZ2VzTWFwW25vZGVOZXh0XS52YWx1ZVBheWVkKTsKICAgIH0KICAgIAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBQbGFjZSBhIG1lc3NhZ2UgaW4gdGhlIE1lc3NhZ2UgQm9hcmQKICAgIC8vIFRoZSBsYXRlc3QgbWVzc2FnZXMgd2lsbCBiZSBzaG93biBvbiB0aGUgbWVzc2FnZSBib2FyZCAodXN1YWxseSBpdCBzaG91bGQgZGlzcGxheSB0aGUgMTAwIGxhdGVzdCBtZXNzYWdlcykKICAgIC8vIFVzZXIgY2FuIGFsc28gc3BlbmQgc29tZSB3ZWkgdG8gcHV0IHRoZSBtZXNzYWdlIGluIHRoZSB0b3AgMTAvMjAgb2YgbWVzc2FnZXMsIG9yZGVyZWQgYnkgdGhlIG1vc3QgcGF5ZWQgdG8gdGhlIGxlYXN0IHBheWVkLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBwbGFjZU1lc3NhZ2Uoc3RyaW5nIG1lc3NhZ2UsIGJvb2wgYW5vbikgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MsIHVpbnQgbnVtTXNnVG9wKSB7CiAgICAgICAgdWludCBtc2dTaXplID0gYnl0ZXMobWVzc2FnZSkubGVuZ3RoOwogICAgICAgIGlmKG1zZ1NpemUgPiBtYXhDaGFyYWN0ZXJzTWVzc2FnZSkgeyAvL0NoZWNrIG51bWJlciBvZiBieXRlcyBvZiBtZXNzYWdlCiAgICAgICAgICAgIC8vTWVzc2FnZSBpcyBiaWdnZXIgdGhhbiBtYXhpbXVtIGFsbG93ZWQ6IFJlamVjdCBtZXNzYWdlIQogICAgICAgICAgICBlbWl0IEV4Y2VlZGVkTWF4aW11bU1lc3NhZ2VTaXplKG1zZ1NpemUsIG1heENoYXJhY3RlcnNNZXNzYWdlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKG1zZy52YWx1ZSA+IDApIHsgLy9XZSBoYXZlIEV0aCB0byByZXR1cm4sIHNvIHdlIHdpbGwgcmV0dXJuIGl0IQogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vQ2FuY2VsIHRyYW5zYWN0aW9uIGFuZCBSZXR1cm4gRXRoIQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwogICAgICAgIH0KCiAgICAgICAgLy9JbnNlcnQgbWVzc2FnZSBpbiB0aGUgc29ydGVkIGxpc3QgKGZyb20gbW9zdCB0byBsZWFzdCBleHBlbnNpdmUpIG9mIHRvcCBtZXNzYWdlcwogICAgICAgIC8vSWYgdGhlIHZhbHVlIHBheWVkIGlzIGVub3VnaCBmb3IgaXQgdG8gcmVhY2ggdGhlIHRvcAoKICAgICAgICAvL0ZpbmQgYW4gb2ZmZXIgdGhhdCBpcyBjaGVhcGVyOgogICAgICAgIC8vbm9kZUxlc3NFeHBlbnNpdmUgPSAKICAgICAgICB1aW50IG5leHRTcG90OwogICAgICAgIGJvb2wgZm91bmRQb3NpdGlvbjsKICAgICAgICB1aW50IHNpemVOb3c7CiAgICAgICAgKG5leHRTcG90LCBmb3VuZFBvc2l0aW9uLCBzaXplTm93KSA9IHRvcE1lc3NhZ2VzU29ydGVkLmdldFNvcnRlZFNwb3RCeUZ1bmN0aW9uKEhFQUQsIG1zZy52YWx1ZSwgTkVYVCwgZ3JlYXRlclByaWNlTXNnQ29tcGFyYXRvciwgbWF4TWVzc2FnZXNUb3ApOwogICAgICAgIGlmKGZvdW5kUG9zaXRpb24pIHsKCiAgICAgICAgICAgIC8vQ3JlYXRlIG5ldyBNZXNzYWdlOgogICAgICAgICAgICB1aW50IG5ld05vZGVOdW0gPSArK3RvcE1lc3NhZ2VzQ291bnRlcjsgLy9TQUZFVFkgQ0hFQ0s6IERvZXNuJ3QgbWF0dGVyIGlmIHdlIGN5Y2xlIGFnYWluIGZyb20gTUFYX0lOVCB0byAwLCBhcyB3ZSBoYXZlIG9ubHkgMTAvMjAvMTAwIG1heGltdW0gbWVzc2FnZXMgYXQgYSB0aW1lLCBzbyB0aGVyZSB3aWxsIG5ldmVyIGJlIHNvbWUgb3ZlcndyaXRpbmcgb2YgdmFsaWQgb2ZmZXJzIQogICAgICAgICAgICB0b3BNZXNzYWdlc01hcFtuZXdOb2RlTnVtXS52YWx1ZVBheWVkID0gbXNnLnZhbHVlOwogICAgICAgICAgICB0b3BNZXNzYWdlc01hcFtuZXdOb2RlTnVtXS5tc2cgPSBtZXNzYWdlOwogICAgICAgICAgICB0b3BNZXNzYWdlc01hcFtuZXdOb2RlTnVtXS5mcm9tID0gYW5vbiA/IGFkZHJlc3MoMCkgOiBtc2cuc2VuZGVyOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9JbnNlcnQgbW9yZSBleHBlbnNpdmUgbWVzc2FnZSBiZWZvcmUgbmV4dFNwb3Q6CiAgICAgICAgICAgIHRvcE1lc3NhZ2VzU29ydGVkLmluc2VydChuZXh0U3BvdCwgbmV3Tm9kZU51bSwgUFJFVik7CiAgICAKICAgICAgICAgICAgaWYoaW50MzIoc2l6ZU5vdykgPiBtYXhNZXNzYWdlc1RvcCkgewogICAgICAgICAgICAgICAgLy9EZWxldGUgdGhlIHRhaWwgZWxlbWVudCBzbyB3ZSBjYW4ga2VlcCB0aGUgc2FtZSBudW1iZXIgb2YgbWF4IHRvcCBtZXNzYWdlczoKICAgICAgICAgICAgICAgIHVpbnQgbGFzdEluZGV4ID0gdG9wTWVzc2FnZXNTb3J0ZWQucG9wKFBSRVYpOyAvL1BvcHMgYW5kIHJlbW92ZXMgbGFzdCBlbGVtZW50IG9mIHRoZSBsaXN0IQogICAgICAgICAgICAgICAgZGVsZXRlIHRvcE1lc3NhZ2VzTWFwW2xhc3RJbmRleF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vUGxhY2UgbWVzc2FnZSBpbiB0aGUgbW9zdCByZWNlbnQgbWVzc2FnZXMgKFdpbGwgYWx3YXlzIGJlIHB1dCBoZXJlLCBldmVuIGlmIHRoZSB2YWx1ZSBwYXllZCBpcyB6ZXJvISBXaWxsIG9ubHkgYmUgb3JkZXJlZCBieSB0aW1lLCBmcm9tIG9sZGVyIHRvIG1vc3QgcmVjZW50KToKICAgICAgICBpbnNlcnRNZXNzYWdlKG1lc3NhZ2UsIGFub24pOwoKICAgICAgICBlbWl0IE5ld01lc3NhZ2VBdmFpbGFibGUoYW5vbiA/IGFkZHJlc3MoMCkgOiBtc2cuc2VuZGVyLCBtZXNzYWdlKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKHRydWUsIG5ld05vZGVOdW0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGxlbmd0aE1lc3NhZ2VzKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIChmaXJzdE1zZ0dsb2JhbCA+IDApID8gbWVzc2FnZXMubGVuZ3RoIDogdWludChsYXN0TXNnR2xvYmFsICsgMSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5zZXJ0TWVzc2FnZShzdHJpbmcgbWVzc2FnZSwgYm9vbCBhbm9uKSBpbnRlcm5hbCB7CiAgICAgICAgTWVzc2FnZSBtZW1vcnkgbmV3TXNnOwogICAgICAgIGJvb2wgaW5zZXJ0SW5MYXN0UG9zID0gZmFsc2U7CiAgICAgICAgbmV3TXNnLnZhbHVlUGF5ZWQgPSBtc2cudmFsdWU7CiAgICAgICAgbmV3TXNnLm1zZyA9IG1lc3NhZ2U7CiAgICAgICAgbmV3TXNnLmZyb20gPSBhbm9uID8gYWRkcmVzcygwKSA6IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgaWYoKChsYXN0TXNnR2xvYmFsICsgMSkgPj0gaW50MzIobWVzc2FnZXMubGVuZ3RoKSAmJiBpbnQzMihtZXNzYWdlcy5sZW5ndGgpIDwgbWF4TWVzc2FnZXNHbG9iYWwpKSB7CiAgICAgICAgICAgIC8vU3RpbGwgaGF2ZSBzcGFjZSBpbiB0aGUgbWVzc2FnZXMgYXJyYXksIGFkZCBuZXcgbWVzc2FnZSBhdCB0aGUgZW5kOgogICAgICAgICAgICBtZXNzYWdlcy5wdXNoKG5ld01zZyk7CiAgICAgICAgICAgIC8vbGFzdE1zZ0dsb2JhbCsrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vTWVzc2FnZXMgYXJyYXkgaXMgZnVsbCwgc3RhcnQgcm90YXRpbmcgdGhyb3VnaCBpdDoKICAgICAgICAgICAgaW5zZXJ0SW5MYXN0UG9zID0gdHJ1ZTsgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vUm90YXRpbmcgaW5kZXhlcyBpbiBjYXNlIHdlIHJlYWNoIHRoZSBlbmQgb2YgdGhlIGFycmF5IQogICAgICAgIHVpbnQgc2l6ZU1lc3NhZ2VzID0gbGVuZ3RoTWVzc2FnZXMoKTsgLy9sZW5ndGhNZXNzYWdlcygpIGRlcGVuZHMgb24gbGFzdE1zZ0dsb2JhbCwgc2Ugd2UgaGF2ZSB0byBrZWVwIGEgdGVtcG9yYXJ5IGNvcHkgZmlyc3QhCiAgICAgICAgbGFzdE1zZ0dsb2JhbCA9IChsYXN0TXNnR2xvYmFsICsgMSkgJSBtYXhNZXNzYWdlc0dsb2JhbDsgCiAgICAgICAgaWYobGFzdE1zZ0dsb2JhbCA8PSBmaXJzdE1zZ0dsb2JhbCAmJiBzaXplTWVzc2FnZXMgPiAwKSB7CiAgICAgICAgICAgIGZpcnN0TXNnR2xvYmFsID0gKGZpcnN0TXNnR2xvYmFsICsgMSkgJSBtYXhNZXNzYWdlc0dsb2JhbDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYoaW5zZXJ0SW5MYXN0UG9zKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzW3VpbnQobGFzdE1zZ0dsb2JhbCldID0gbmV3TXNnOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYSA9IGJ5dGVzKGFiKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFbaysrXSA9IF9iYVtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhW2srK10gPSBfYmNbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYSk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBQbGFjZSBhIG1lc3NhZ2UgaW4gdGhlIE1lc3NhZ2UgQm9hcmQKICAgIC8vIFRoZSBsYXRlc3QgbWVzc2FnZXMgd2lsbCBiZSBzaG93biBvbiB0aGUgbWVzc2FnZSBib2FyZCAodXN1YWxseSBpdCBzaG91bGQgZGlzcGxheSB0aGUgMTAwIGxhdGVzdCBtZXNzYWdlcykKICAgIC8vIFVzZXIgY2FuIGFsc28gc3BlbmQgc29tZSB3ZWkgdG8gcHV0IHRoZSBtZXNzYWdlIGluIHRoZSB0b3AgMTAvMjAgb2YgbWVzc2FnZXMsIG9yZGVyZWQgYnkgdGhlIG1vc3QgcGF5ZWQgdG8gdGhlIGxlYXN0IHBheWVkLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBnZXRNZXNzYWdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBtZW1vcnkgcikgewogICAgICAgIHVpbnQgY291bnRNc2cgPSBsZW5ndGhNZXNzYWdlcygpOyAvL1Rha2UgaW50byBhY2NvdW50IGlmIG1lc3NhZ2VzIHdhcyByZXNldCwgYW5kIG5vIG5ldyBtZXNzYWdlcyBoYXZlIGJlZW4gaW5zZXJ0ZWQgdW50aWwgbm93IQogICAgICAgIHVpbnQgaW5kZXhNc2cgPSB1aW50KGZpcnN0TXNnR2xvYmFsKTsKICAgICAgICBib29sIGZpcnN0ID0gdHJ1ZTsKICAgICAgICB3aGlsZShjb3VudE1zZyA+IDApIHsKICAgICAgICAgICAgaWYoZmlyc3QpIHsKICAgICAgICAgICAgICAgIHIgPSBtZXNzYWdlc1tpbmRleE1zZ10ubXNnOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHIgPSBzdHJDb25jYXQociwgIiA8fHw+ICIsIG1lc3NhZ2VzW2luZGV4TXNnXS5tc2cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpbmRleE1zZyA9IChpbmRleE1zZyArIDEpICUgdWludChtYXhNZXNzYWdlc0dsb2JhbCk7CiAgICAgICAgICAgIGNvdW50TXNnLS07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcjsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2V0IHRoZSBNYXhpbXVtIG9mIEdsb2JhbCBNZXNzYWdlcwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzZXRNYXhNZXNzYWdlc0dsb2JhbChpbnQzMiBfbWF4TWVzc2FnZXNHbG9iYWwpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYoX21heE1lc3NhZ2VzR2xvYmFsIDwgbWF4TWVzc2FnZXNHbG9iYWwpIHsKICAgICAgICAgICAgLy9OZXcgdmFsdWUgd2lsbCBiZSBzaG9ydGVyIHRoYW4gb2xkIHZhbHVlOiByZXNldCB2YWx1ZXM6CiAgICAgICAgICAgIC8vbWVzc2FnZXMuY2xlYXIoKTsgLy9ObyBuZWVkIHRvIGNsZWFyIHRoZSBhcnJheSBjb21wbGV0ZWx5IChjb3N0cyBnYXMhKTogSnVzdCByZWluaXRpYWxpemUgdGhlIHBvaW50ZXJzIQogICAgICAgICAgICAvL2xhc3RNc2dHbG9iYWwgPSBmaXJzdE1zZ0dsb2JhbCA+IDAgPyBpbnQzMihtZXNzYWdlcy5sZW5ndGgpIC0gMSA6IGxhc3RNc2dHbG9iYWw7IC8vVGhlIGxhc3QgcG9zaXRpb24gd2lsbCBzcGVjaWZ5IHRoZSByZWFsIHNpemUgb2YgdGhlIGFycmF5LCB0aGF0IGlzLCB1bnRpbCB0aGUgZmlyc3RNc2dHbG9iYWwgaXMgZ3JlYXRlciB0aGFuIHplcm8sIGF0IHRoYXQgdGltZSB3ZSBrbm93IHRoZSBhcnJheSBpcyBmdWxsLCBzbyB0aGUgcmVhbCBzaXplIGlzIHRoZSBzaXplIG9mIHRoZSBjb21wbGV0ZSBhcnJheSEKICAgICAgICAgICAgbGFzdE1zZ0dsb2JhbCA9IGludDMyKGxlbmd0aE1lc3NhZ2VzKCkpIC0gMTsgLy9UaGUgbGFzdCBwb3NpdGlvbiB3aWxsIHNwZWNpZnkgdGhlIHJlYWwgc2l6ZSBvZiB0aGUgYXJyYXksIHRoYXQgaXMsIHVudGlsIHRoZSBmaXJzdE1zZ0dsb2JhbCBpcyBncmVhdGVyIHRoYW4gemVybywgYXQgdGhhdCB0aW1lIHdlIGtub3cgdGhlIGFycmF5IGlzIGZ1bGwsIHNvIHRoZSByZWFsIHNpemUgaXMgdGhlIHNpemUgb2YgdGhlIGNvbXBsZXRlIGFycmF5IQogICAgICAgICAgICBpZihsYXN0TXNnR2xvYmFsICE9IC0xICYmIGxhc3RNc2dHbG9iYWwgPiAoaW50MzIoX21heE1lc3NhZ2VzR2xvYmFsKSAtIDEpKSB7CiAgICAgICAgICAgICAgICBsYXN0TXNnR2xvYmFsID0gaW50MzIoX21heE1lc3NhZ2VzR2xvYmFsKSAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmlyc3RNc2dHbG9iYWwgPSAwOwogICAgICAgICAgICBtZXNzYWdlcy5sZW5ndGggPSB1aW50KF9tYXhNZXNzYWdlc0dsb2JhbCk7CiAgICAgICAgfQogICAgICAgIG1heE1lc3NhZ2VzR2xvYmFsID0gX21heE1lc3NhZ2VzR2xvYmFsOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gV2lsbCBzZXQgdGhlIE1heGltdW0gb2YgVG9wIE1lc3NhZ2VzICh1c3VhbGx5IFRvcCAxMCAvIDIwKQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzZXRNYXhNZXNzYWdlc1RvcChpbnQzMiBfbWF4TWVzc2FnZXNUb3ApIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgdWludCB0b3BNZXNzYWdlc1NvcnRlZFNpemUgPSB0b3BNZXNzYWdlc1NvcnRlZC5zaXplT2YoKTsKICAgICAgICBpZih0b3BNZXNzYWdlc1NvcnRlZFNpemUgPiB1aW50KF9tYXhNZXNzYWdlc1RvcCkpIHsKICAgICAgICAgICAgaW50MzIgZGlmZiA9IGludDMyKHRvcE1lc3NhZ2VzU29ydGVkU2l6ZSAtIHVpbnQoX21heE1lc3NhZ2VzVG9wKSk7CiAgICAgICAgICAgIHJlcXVpcmUoZGlmZiA8PSBpbnQzMih0b3BNZXNzYWdlc1NvcnRlZFNpemUpKTsgLy9TQUZFVFkgQ0hFQ0sgKHJlY29tbWVuZGVkIGJlY2F1c2Ugb2YgdHlwZSBjb252ZXJzaW9ucykhCiAgICAgICAgICAgIC8vRG8gdGhlIG5lZWRlZCBudW1iZXIgb2YgUG9wcyB0byBjbGVhciB0aGUgdG9wIG1lc3NhZ2UgbGlzdCBpZiBfbWF4TWVzc2FnZXNUb3AgKG5ldykgPCBtYXhNZXNzYWdlc1RvcCAob2xkKQogICAgICAgICAgICB3aGlsZSAgKGRpZmYgPiAwKSB7CiAgICAgICAgICAgICAgICB1aW50IGxhc3RNc2cgPSB0b3BNZXNzYWdlc1NvcnRlZC5wb3AoUFJFVik7IC8vUG9wcyBlbGVtZW50IGZyb20gdGhlIFRhaWwhCiAgICAgICAgICAgICAgICBkZWxldGUgdG9wTWVzc2FnZXNNYXBbbGFzdE1zZ107CiAgICAgICAgICAgICAgICBkaWZmLS07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbWF4TWVzc2FnZXNUb3AgPSBfbWF4TWVzc2FnZXNUb3A7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBHZXRzIHRoZSBsaXN0IG9mIHRvcCAxMCBtZXNzYWdlcyAob3JkZXJlZCBieSBtb3N0IHBheWVkIHRvIGxlYXN0IHBheWVkKS4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gZ2V0VG9wMTBNZXNzYWdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBtZW1vcnkgcikgewogICAgICAgIGJvb2wgZXhpc3RzOwogICAgICAgIHVpbnQgcHJldjsKICAgICAgICB1aW50IGVsZW07CiAgICAgICAgYm9vbCBmaXJzdCA9IHRydWU7CiAgICAgICAgKGV4aXN0cywgcHJldiwgZWxlbSkgPSB0b3BNZXNzYWdlc1NvcnRlZC5nZXROb2RlKEhFQUQpOwogICAgICAgIGlmKGV4aXN0cykgewogICAgICAgICAgICB1aW50IHNpemUgPSBtaW4odG9wTWVzc2FnZXNTb3J0ZWQuc2l6ZU9mKCksIDEwKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZihmaXJzdCkgewogICAgICAgICAgICAgICAgICAgIHIgPSB0b3BNZXNzYWdlc01hcFtlbGVtXS5tc2c7CiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHIgPSBzdHJDb25jYXQociwgIiA8fHw+ICIsIHRvcE1lc3NhZ2VzTWFwW2VsZW1dLm1zZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAoZXhpc3RzLCBlbGVtKSA9IHRvcE1lc3NhZ2VzU29ydGVkLmdldEFkamFjZW50KGVsZW0sIE5FWFQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByOwogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEdldHMgdGhlIGxpc3Qgb2YgdG9wIDExIHRvIDIwIG1lc3NhZ2VzIChvcmRlcmVkIGJ5IG1vc3QgcGF5ZWQgdG8gbGVhc3QgcGF5ZWQpLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBnZXRUb3AxMV8yME1lc3NhZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG1lbW9yeSByKSB7CiAgICAgICAgYm9vbCBleGlzdHM7CiAgICAgICAgdWludCBwcmV2OwogICAgICAgIHVpbnQgZWxlbTsKICAgICAgICBib29sIGZpcnN0ID0gdHJ1ZTsKICAgICAgICAoZXhpc3RzLCBwcmV2LCBlbGVtKSA9IHRvcE1lc3NhZ2VzU29ydGVkLmdldE5vZGUoSEVBRCk7CiAgICAgICAgaWYoZXhpc3RzKSB7CiAgICAgICAgICAgIHVpbnQgc2l6ZSA9IG1pbih0b3BNZXNzYWdlc1NvcnRlZC5zaXplT2YoKSwgdWludChtYXhNZXNzYWdlc1RvcCkpOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmKGkgPj0gMTApIHsKICAgICAgICAgICAgICAgICAgICBpZihmaXJzdCkgewogICAgICAgICAgICAgICAgICAgICAgICByID0gdG9wTWVzc2FnZXNNYXBbZWxlbV0ubXNnOwogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgciA9IHN0ckNvbmNhdChyLCAiIDx8fD4gIiwgdG9wTWVzc2FnZXNNYXBbZWxlbV0ubXNnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAoZXhpc3RzLCBlbGVtKSA9IHRvcE1lc3NhZ2VzU29ydGVkLmdldEFkamFjZW50KGVsZW0sIE5FWFQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByOwogICAgfQogICAgCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFdpbGwgc2V0IHRoZSBNYXhpbXVtIENoYXJhY3RlcnMgZWFjaCBtZXNzYWdlIGNhbiBoYXZlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHNldE1lc3NhZ2VNYXhDaGFyYWN0ZXJzKHVpbnQgX21heENoYXJhY3RlcnNNZXNzYWdlKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIG1heENoYXJhY3RlcnNNZXNzYWdlID0gX21heENoYXJhY3RlcnNNZXNzYWdlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gR2V0IHRoZSBNYXhpbXVtIENoYXJhY3RlcnMgZWFjaCBtZXNzYWdlIGNhbiBoYXZlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGdldE1lc3NhZ2VNYXhDaGFyYWN0ZXJzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBtYXhDaGFycykgewogICAgICAgIHJldHVybiBtYXhDaGFyYWN0ZXJzTWVzc2FnZTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIERlZmF1bHQgZnVuY3Rpb24KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGJ1eUNva2UoKTsKICAgIH0KCn0='.
	

]
