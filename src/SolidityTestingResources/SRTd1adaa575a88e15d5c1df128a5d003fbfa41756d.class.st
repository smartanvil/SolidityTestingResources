Class {
	#name : #SRTd1adaa575a88e15d5c1df128a5d003fbfa41756d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd1adaa575a88e15d5c1df128a5d003fbfa41756d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgogLyoKICogQ29udHJhY3QgdGhhdCBpcyB3b3JraW5nIHdpdGggRVJDMjIzIHRva2VucwogKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjIzCiAqLwoKLy8vIEB0aXRsZSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCAtIFN0YW5kYXJkIGNvbnRyYWN0IGltcGxlbWVudGF0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggRVJDMjIzIHRva2Vucy4KY29udHJhY3QgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewoKICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRyYW5zYWN0aW9uIGluaXRpYXRvciwgYW5hbG9ndWUgb2YgbXNnLnNlbmRlcgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX2RhdGEgRGF0YSBjb250YWluaWcgYSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kL29yIHBhcmFtZXRlcnMKICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWM7Cn0KCi8vLyBAdGl0bGUgQmFzZSBUb2tlbiBjb250cmFjdCAtIEZ1bmN0aW9ucyB0byBiZSBpbXBsZW1lbnRlZCBieSB0b2tlbiBjb250cmFjdHMuCmNvbnRyYWN0IFRva2VuIHsKICAgIC8qCiAgICAgKiBJbXBsZW1lbnRzIEVSQyAyMCBzdGFuZGFyZC4KICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvZjkwODY0YTNkMmIyYjQ1YzRkZWNmOTVlZmQyNmIzZjBjMjc2MDUxYS9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAgICAgKgogICAgICogIEFkZGVkIHN1cHBvcnQgZm9yIHRoZSBFUkMgMjIzICJ0b2tlbkZhbGxiYWNrIiBtZXRob2QgaW4gYSAidHJhbnNmZXIiIGZ1bmN0aW9uIHdpdGggYSBwYXlsb2FkLgogICAgICogIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMjMKICAgICAqLwoKICAgIC8qCiAgICAgKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgICAqIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgICogaXMgcmVwbGFjZWQgd2l0aDoKICAgICAqIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgICogVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgICAqIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgICogY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICAgKiBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAgKi8KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8qCiAgICAgKiBFUkMgMjAKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIC8qCiAgICAgKiBFUkMgMjIzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qCiAgICAgKiBFdmVudHMKICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICAvLyBUaGVyZSBpcyBubyBFUkMyMjMgY29tcGF0aWJsZSBUcmFuc2ZlciBldmVudCwgd2l0aCBgX2RhdGFgIGluY2x1ZGVkLgp9CgovLy8gQHRpdGxlIFN0YW5kYXJkIHRva2VuIGNvbnRyYWN0IC0gU3RhbmRhcmQgdG9rZW4gaW1wbGVtZW50YXRpb24uCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIC8qCiAgICAgKiBEYXRhIHN0cnVjdHVyZXMKICAgICAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYC4KICAgIC8vLyBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgIGFuZCB0cmlnZ2VyCiAgICAvLy8gdG9rZW5GYWxsYmFjayBpZiBzZW5kZXIgaXMgYSBjb250cmFjdC4KICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX2RhdGEgRGF0YSB0byBiZSBzZW50IHRvIHRva2VuRmFsbGJhY2sKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdmFsdWUsCiAgICAgICAgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyKF90bywgX3ZhbHVlKSk7CgogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF92YWx1ZWAgdG9rZW5zIGZyb20gYF9mcm9tYCB0byBgX3RvYCBpZiBgbXNnLnNlbmRlcmAgaXMgYWxsb3dlZC4KICAgIC8vLyBAZGV2IEFsbG93cyBmb3IgYW4gYXBwcm92ZWQgdGhpcmQgcGFydHkgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20gb25lCiAgICAvLy8gYWRkcmVzcyB0byBhbm90aGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBzZW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX2Zyb20gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90byAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBgX3NwZW5kZXJgIHRvIHRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBtc2cuc2VuZGVyYCB0byBhbnkgYWRkcmVzcy4KICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSAweDApOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoKICAgICAqIFJlYWQgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIHRoYXQgYSBzcGVuZGVyIGNhbiB0cmFuc2ZlciBvbgogICAgLy8vIGJlaGFsZiBvZiBhIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyByZW1haW5pbmcgYWxsb3dhbmNlIGZvciBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgdGhlIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBiYWxhbmNlIG9mIG93bmVyLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQp9CgovLy8gQHRpdGxlIHhDaGFpbmdlIFRva2VuCmNvbnRyYWN0IHhDaGFpbmdlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLyoKICAgICAqICBUZXJtaW5vbG9neToKICAgICAqICAxIHRva2VuIHVuaXQgPSBYZWkKICAgICAqICAxIHRva2VuID0gWENIID0gWGVpICogbXVsdGlwbGllcgogICAgICogIG11bHRpcGxpZXIgc2V0IGZyb20gdG9rZW4ncyBudW1iZXIgb2YgZGVjaW1hbHMgKGkuZS4gMTAgKiogZGVjaW1hbHMpCiAgICAgKi8KCiAgICAvKgogICAgICogIFRva2VuIG1ldGFkYXRhCiAgICAgKi8KICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgbmFtZSA9ICJ4Q2hhaW5nZSBUb2tlbiI7CiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIHN5bWJvbCA9ICJYQ0giOwogICAgdWludDggY29uc3RhbnQgcHVibGljIGRlY2ltYWxzID0gMTg7CiAgICB1aW50IGNvbnN0YW50IG11bHRpcGxpZXIgPSAxMCAqKiB1aW50KGRlY2ltYWxzKTsKCiAgICBldmVudCBEZXBsb3llZCh1aW50IGluZGV4ZWQgX3RvdGFsU3VwcGx5KTsKICAgIGV2ZW50IEJ1cm50KGFkZHJlc3MgaW5kZXhlZCBfcmVjZWl2ZXIsIHVpbnQgaW5kZXhlZCBfbnVtLCB1aW50IGluZGV4ZWQgX3RvdGFsU3VwcGx5KTsKCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBkdXRjaCBhdWN0aW9uIGNvbnRyYWN0IGFkZHJlc3MKICAgIC8vLyBhbmQgYXNzaWducyBhbGwgdG9rZW5zIHRvIGR1dGNoIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIGF1Y3Rpb25BZGRyZXNzIEFkZHJlc3Mgb2YgZHV0Y2ggYXVjdGlvbiBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gd2FsbGV0QWRkcmVzcyBBZGRyZXNzIG9mIHdhbGxldC4KICAgIGZ1bmN0aW9uIHhDaGFpbmdlVG9rZW4oYWRkcmVzcyBhdWN0aW9uQWRkcmVzcywgYWRkcmVzcyB3YWxsZXRBZGRyZXNzKSBwdWJsaWMKICAgIHsKICAgICAgICAvLyBBdWN0aW9uIGFkZHJlc3Mgc2hvdWxkIG5vdCBiZSBudWxsLgogICAgICAgIHJlcXVpcmUoYXVjdGlvbkFkZHJlc3MgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKHdhbGxldEFkZHJlc3MgIT0gMHgwKTsKCiAgICAgICAgLy8gVG90YWwgc3VwcGx5IG9mIFhlaSBhdCBkZXBsb3ltZW50CiAgICAgICAgdG90YWxTdXBwbHkgPSAyMzUyOTQxMjAwMDAwMDAwMDAwMDAwMDAwMDsKCiAgICAgICAgYmFsYW5jZXNbYXVjdGlvbkFkZHJlc3NdID0gMjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICAgICAgYmFsYW5jZXNbd2FsbGV0QWRkcmVzc10gPSAzNTI5NDEyMDAwMDAwMDAwMDAwMDAwMDAwOwoKICAgICAgICBUcmFuc2ZlcigweDAsIGF1Y3Rpb25BZGRyZXNzLCBiYWxhbmNlc1thdWN0aW9uQWRkcmVzc10pOwogICAgICAgIFRyYW5zZmVyKDB4MCwgd2FsbGV0QWRkcmVzcywgYmFsYW5jZXNbd2FsbGV0QWRkcmVzc10pOwoKICAgICAgICBEZXBsb3llZCh0b3RhbFN1cHBseSk7CgogICAgICAgIGFzc2VydCh0b3RhbFN1cHBseSA9PSBiYWxhbmNlc1thdWN0aW9uQWRkcmVzc10gKyBiYWxhbmNlc1t3YWxsZXRBZGRyZXNzXSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQWxsb3dzIGBtc2cuc2VuZGVyYCB0byBzaW1wbHkgZGVzdHJveSBgbnVtYCB0b2tlbiB1bml0cyAoWGVpKS4gVGhpcyBtZWFucyB0aGUgdG90YWwKICAgIC8vLyB0b2tlbiBzdXBwbHkgd2lsbCBkZWNyZWFzZS4KICAgIC8vLyBAZGV2IEFsbG93cyB0byBkZXN0cm95IHRva2VuIHVuaXRzIChYZWkpLgogICAgLy8vIEBwYXJhbSBudW0gTnVtYmVyIG9mIHRva2VuIHVuaXRzIChYZWkpIHRvIGJ1cm4uCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgbnVtKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobnVtID4gMCk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBudW0pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPj0gbnVtKTsKCiAgICAgICAgdWludCBwcmVCYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IG51bTsKICAgICAgICB0b3RhbFN1cHBseSAtPSBudW07CiAgICAgICAgQnVybnQobXNnLnNlbmRlciwgbnVtLCB0b3RhbFN1cHBseSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBudW0pOwoKICAgICAgICBhc3NlcnQoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPT0gcHJlQmFsYW5jZSAtIG51bSk7CiAgICB9Cn0KCi8vLyBAdGl0bGUgRHV0Y2ggYXVjdGlvbiBjb250cmFjdCAtIGRpc3RyaWJ1dGlvbiBvZiBhIGZpeGVkIG51bWJlciBvZiB0b2tlbnMgdXNpbmcgYW4gYXVjdGlvbi4KLy8vIFRoZSBjb250cmFjdCBjb2RlIGlzIGluc3BpcmVkIGJ5IHRoZSBHbm9zaXMgYW5kIFJhaWRlbiBhdWN0aW9uIGNvbnRyYWN0LiAKLy8vIEF1Y3Rpb24gZW5kcyBpZiBhIGZpeGVkIG51bWJlciBvZiB0b2tlbnMgd2FzIHNvbGQuCmNvbnRyYWN0IER1dGNoQXVjdGlvbiB7CiAgICAvKgogICAgICogQXVjdGlvbiBmb3IgdGhlIFhDSCBUb2tlbi4KICAgICAqCiAgICAgKiBUZXJtaW5vbG9neToKICAgICAqIDEgdG9rZW4gdW5pdCA9IFhlaQogICAgICogMSB0b2tlbiA9IFhDSCA9IFhlaSAqIG11bHRpcGxpZXIKICAgICAqIG11bHRpcGxpZXIgc2V0IGZyb20gdG9rZW4ncyBudW1iZXIgb2YgZGVjaW1hbHMgKGkuZS4gMTAgKiogZGVjaW1hbHMpCiAgICAgKi8KCiAgICAvLyBXYWl0IDEwIGRheXMgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgYXVjdGlvbiwgYmVmb3JlIGFueW9uZSBjYW4gY2xhaW0gdG9rZW5zCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyB0b2tlbkNsYWltV2FpdGluZ1BlcmlvZCA9IDEwIGRheXM7CgogICAgLyoKICAgICAqIFN0b3JhZ2UKICAgICAqLwoKICAgIHhDaGFpbmdlVG9rZW4gcHVibGljIHRva2VuOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXJBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0QWRkcmVzczsKCiAgICAvLyBQcmljZSBkZWNheSBmdW5jdGlvbiBwYXJhbWV0ZXJzIHRvIGJlIGNoYW5nZWQgZGVwZW5kaW5nIG9uIHRoZSBkZXNpcmVkIG91dGNvbWUKCiAgICAvLyBTdGFydGluZyBwcmljZSBpbiBXRUk7CiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBwcmljZVN0YXJ0ID0gNTAwMDAwMDAwMDAwMDAwMDA7ICAgIAogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWluUHJpY2UgPSA1MDAwMDAwMDAwMDAwMDAwOwogICAgdWludCBjb25zdGFudCBwdWJsaWMgc29mdENhcCA9IDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwoKICAgIC8vIEZvciBjYWxjdWxhdGluZyBlbGFwc2VkIHRpbWUgZm9yIHByaWNlCiAgICB1aW50IHB1YmxpYyBzdGFydFRpbWU7CiAgICB1aW50IHB1YmxpYyBlbmRUaW1lOwogICAgdWludCBwdWJsaWMgc3RhcnRCbG9jazsKCiAgICAvLyBLZWVwIHRyYWNrIG9mIGFsbCBFVEggcmVjZWl2ZWQgaW4gdGhlIGJpZHMKICAgIHVpbnQgcHVibGljIHJlY2VpdmVkV2VpOwoKICAgIC8vIEtlZXAgdHJhY2sgb2YgY3VtdWxhdGl2ZSBFVEggZnVuZHMgZm9yIHdoaWNoIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIGNsYWltZWQKICAgIHVpbnQgcHVibGljIGZ1bmRzQ2xhaW1lZDsKCiAgICB1aW50IHB1YmxpYyB0b2tlbk11bHRpcGxpZXI7CgogICAgLy8gVG90YWwgbnVtYmVyIG9mIFhlaSAoWENIICogbXVsdGlwbGllcikgdGhhdCB3aWxsIGJlIGF1Y3Rpb25lZAogICAgdWludCBwdWJsaWMgbnVtVG9rZW5zQXVjdGlvbmVkOwoKICAgIC8vIFdlaSBwZXIgWENIIChYZWkgKiBtdWx0aXBsaWVyKQogICAgdWludCBwdWJsaWMgZmluYWxQcmljZTsKCiAgICAvLyBCaWRkZXIgYWRkcmVzcyA9PiBiaWQgdmFsdWUKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJpZHM7CgogICAgU3RhZ2VzIHB1YmxpYyBzdGFnZTsKCiAgICAvKgogICAgICogRW51bXMKICAgICAqLwogICAgZW51bSBTdGFnZXMgewogICAgICAgIEF1Y3Rpb25EZXBsb3llZCwKICAgICAgICBBdWN0aW9uU2V0VXAsCiAgICAgICAgQXVjdGlvblN0YXJ0ZWQsCiAgICAgICAgQXVjdGlvbkVuZGVkLAogICAgICAgIEF1Y3Rpb25DYW5jZWxlZCwKICAgICAgICBUb2tlbnNEaXN0cmlidXRlZAogICAgfQoKICAgIC8qCiAgICAgKiBNb2RpZmllcnMKICAgICAqLwogICAgbW9kaWZpZXIgYXRTdGFnZShTdGFnZXMgX3N0YWdlKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBfc3RhZ2UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiBFdmVudHMKICAgICAqLwoKICAgIGV2ZW50IERlcGxveWVkKCk7CiAgICBldmVudCBTZXR1cCgpOwogICAgZXZlbnQgQXVjdGlvblN0YXJ0ZWQodWludCBpbmRleGVkIF9zdGFydFRpbWUsIHVpbnQgaW5kZXhlZCBfYmxvY2tOdW1iZXIpOwogICAgZXZlbnQgQmlkU3VibWlzc2lvbihhZGRyZXNzIGluZGV4ZWQgX3NlbmRlciwgdWludCBfYW1vdW50LCB1aW50IF9taXNzaW5nRnVuZHMpOwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3JlY2lwaWVudCwgdWludCBfc2VudEFtb3VudCk7CiAgICBldmVudCBBdWN0aW9uRW5kZWQodWludCBfZmluYWxQcmljZSk7CiAgICBldmVudCBUb2tlbnNEaXN0cmlidXRlZCgpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGVkKCk7CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgdGhlIHN0YXJ0aW5nIHByaWNlLCBkaXZpc29yIGNvbnN0YW50IGFuZAogICAgLy8vIGRpdmlzb3IgZXhwb25lbnQgZm9yIGNhbGN1bGF0aW5nIHRoZSBEdXRjaCBBdWN0aW9uIHByaWNlLgogICAgLy8vIEBwYXJhbSBfd2FsbGV0QWRkcmVzcyBXYWxsZXQgYWRkcmVzcwogICAgZnVuY3Rpb24gRHV0Y2hBdWN0aW9uKGFkZHJlc3MgX3dhbGxldEFkZHJlc3MpIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoX3dhbGxldEFkZHJlc3MgIT0gMHgwKTsKICAgICAgICB3YWxsZXRBZGRyZXNzID0gX3dhbGxldEFkZHJlc3M7CgogICAgICAgIG93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuQXVjdGlvbkRlcGxveWVkOwogICAgICAgIERlcGxveWVkKCk7CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBjb250cmFjdCwgd2hpY2ggY2FsbHMgYmlkKCkgaWYgdGhlIGF1Y3Rpb24gaGFzIHN0YXJ0ZWQuCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkgewogICAgICAgIGJpZCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBgX3Rva2VuQWRkcmVzc2AgYXMgdGhlIHRva2VuIGFkZHJlc3MgdG8gYmUgdXNlZCBpbiB0aGUgYXVjdGlvbi4KICAgIC8vLyBAZGV2IFNldHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3RzIGFkZHJlc3Nlcy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuQWRkcmVzcyBUb2tlbiBhZGRyZXNzLgogICAgZnVuY3Rpb24gc2V0dXAoYWRkcmVzcyBfdG9rZW5BZGRyZXNzKSBwdWJsaWMgaXNPd25lciBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQpIHsKICAgICAgICByZXF1aXJlKF90b2tlbkFkZHJlc3MgIT0gMHgwKTsKICAgICAgICB0b2tlbiA9IHhDaGFpbmdlVG9rZW4oX3Rva2VuQWRkcmVzcyk7CgogICAgICAgIC8vIEdldCBudW1iZXIgb2YgWGVpIChYQ0ggKiBtdWx0aXBsaWVyKSB0byBiZSBhdWN0aW9uZWQgZnJvbSB0b2tlbiBhdWN0aW9uIGJhbGFuY2UKICAgICAgICBudW1Ub2tlbnNBdWN0aW9uZWQgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CgogICAgICAgIC8vIFNldCB0aGUgbnVtYmVyIG9mIHRoZSB0b2tlbiBtdWx0aXBsaWVyIGZvciBpdHMgZGVjaW1hbHMKICAgICAgICB0b2tlbk11bHRpcGxpZXIgPSAxMCAqKiB1aW50KHRva2VuLmRlY2ltYWxzKCkpOwoKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uU2V0VXA7CiAgICAgICAgU2V0dXAoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTdGFydCB0aGUgYXVjdGlvbi4KICAgIC8vLyBAZGV2IFN0YXJ0cyBhdWN0aW9uIGFuZCBzZXRzIHN0YXJ0VGltZS4KICAgIGZ1bmN0aW9uIHN0YXJ0QXVjdGlvbigpIHB1YmxpYyBpc093bmVyIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25TZXRVcCkgewogICAgICAgIHN0YWdlID0gU3RhZ2VzLkF1Y3Rpb25TdGFydGVkOwogICAgICAgIHN0YXJ0VGltZSA9IG5vdzsKICAgICAgICBzdGFydEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIEF1Y3Rpb25TdGFydGVkKHN0YXJ0VGltZSwgc3RhcnRCbG9jayk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRmluYWxpemUgdGhlIGF1Y3Rpb24gLSBzZXRzIHRoZSBmaW5hbCBYQ0ggdG9rZW4gcHJpY2UgYW5kIGNoYW5nZXMgdGhlIGF1Y3Rpb24KICAgIC8vLyBzdGFnZSBhZnRlciBubyBiaWRzIGFyZSBhbGxvd2VkIGFueW1vcmUuCiAgICAvLy8gQGRldiBGaW5hbGl6ZSBhdWN0aW9uIGFuZCBzZXQgdGhlIGZpbmFsIFhDSCB0b2tlbiBwcmljZS4KICAgIGZ1bmN0aW9uIGZpbmFsaXplQXVjdGlvbigpIHB1YmxpYyBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkKICAgIHsKICAgICAgICByZXF1aXJlKHByaWNlKCkgPT0gbWluUHJpY2UpOwoKICAgICAgICBlbmRUaW1lID0gbm93OwoKICAgICAgICBpZiAocmVjZWl2ZWRXZWkgPCBzb2Z0Q2FwKQogICAgICAgIHsKICAgICAgICAgICAgdG9rZW4udHJhbnNmZXIod2FsbGV0QWRkcmVzcywgbnVtVG9rZW5zQXVjdGlvbmVkKTsKICAgICAgICAgICAgc3RhZ2UgPSBTdGFnZXMuQXVjdGlvbkNhbmNlbGVkOwogICAgICAgICAgICBBdWN0aW9uQ2FuY2VsZWQoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gU2VuZCBFVEggdG8gd2FsbGV0CiAgICAgICAgd2FsbGV0QWRkcmVzcy50cmFuc2ZlcihyZWNlaXZlZFdlaSk7CgogICAgICAgIHVpbnQgbWlzc2luZ0Z1bmRzID0gbWlzc2luZ0Z1bmRzVG9FbmRBdWN0aW9uKCk7CiAgICAgICAgaWYgKG1pc3NpbmdGdW5kcyA+IDApewogICAgICAgICAgICB1aW50IHNvbGRUb2tlbnMgPSB0b2tlbk11bHRpcGxpZXIgKiByZWNlaXZlZFdlaSAvIHByaWNlKCk7CiAgICAgICAgICAgIHVpbnQgYnVyblRva2VucyA9IG51bVRva2Vuc0F1Y3Rpb25lZCAtIHNvbGRUb2tlbnM7CiAgICAgICAgICAgIHRva2VuLmJ1cm4oYnVyblRva2Vucyk7CiAgICAgICAgICAgIG51bVRva2Vuc0F1Y3Rpb25lZCAtPSBidXJuVG9rZW5zOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBmaW5hbCBwcmljZSA9IFdFSSAvIFhDSCA9IFdFSSAvIChYZWkgLyBtdWx0aXBsaWVyKQogICAgICAgIC8vIFJlbWluZGVyOiBudW1Ub2tlbnNBdWN0aW9uZWQgaXMgdGhlIG51bWJlciBvZiBYZWkgKFhDSCAqIG11bHRpcGxpZXIpIHRoYXQgYXJlIGF1Y3Rpb25lZAogICAgICAgIGZpbmFsUHJpY2UgPSB0b2tlbk11bHRpcGxpZXIgKiByZWNlaXZlZFdlaSAvIG51bVRva2Vuc0F1Y3Rpb25lZDsKCiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuQXVjdGlvbkVuZGVkOwogICAgICAgIEF1Y3Rpb25FbmRlZChmaW5hbFByaWNlKTsKCiAgICAgICAgYXNzZXJ0KGZpbmFsUHJpY2UgPiAwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYW5jZWxlZCB0aGUgYXVjdGlvbgogICAgZnVuY3Rpb24gQ2FuY2VsQXVjdGlvbigpIHB1YmxpYyBpc093bmVyIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25TdGFydGVkKQogICAgewogICAgICAgIHRva2VuLnRyYW5zZmVyKHdhbGxldEFkZHJlc3MsIG51bVRva2Vuc0F1Y3Rpb25lZCk7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuQXVjdGlvbkNhbmNlbGVkOwogICAgICAgIEF1Y3Rpb25DYW5jZWxlZCgpOwogICAgfQoKICAgIC8vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQXVjdGlvbiBGdW5jdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tCgoKICAgIC8vLyBAbm90aWNlIFNlbmQgYG1zZy52YWx1ZWAgV0VJIHRvIHRoZSBhdWN0aW9uIGZyb20gdGhlIGBtc2cuc2VuZGVyYCBhY2NvdW50LgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHNlbmQgYSBiaWQgdG8gdGhlIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBiaWQoKSBwdWJsaWMgcGF5YWJsZSBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIGFzc2VydChiaWRzW21zZy5zZW5kZXJdICsgbXNnLnZhbHVlID49IG1zZy52YWx1ZSk7CgogICAgICAgIC8vIE1pc3NpbmcgZnVuZHMgd2l0aG91dCB0aGUgY3VycmVudCBiaWQgdmFsdWUKICAgICAgICB1aW50IG1pc3NpbmdGdW5kcyA9IG1pc3NpbmdGdW5kc1RvRW5kQXVjdGlvbigpOwoKICAgICAgICAvLyBXZSByZXF1aXJlIGJpZCB2YWx1ZXMgdG8gYmUgbGVzcyB0aGFuIHRoZSBmdW5kcyBtaXNzaW5nIHRvIGVuZCB0aGUgYXVjdGlvbgogICAgICAgIC8vIGF0IHRoZSBjdXJyZW50IHByaWNlLgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlIDw9IG1pc3NpbmdGdW5kcyk7CgogICAgICAgIGJpZHNbbXNnLnNlbmRlcl0gKz0gbXNnLnZhbHVlOwogICAgICAgIHJlY2VpdmVkV2VpICs9IG1zZy52YWx1ZTsKCiAgICAgICAgQmlkU3VibWlzc2lvbihtc2cuc2VuZGVyLCBtc2cudmFsdWUsIG1pc3NpbmdGdW5kcyk7CgogICAgICAgIGFzc2VydChyZWNlaXZlZFdlaSA+PSBtc2cudmFsdWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENsYWltIGF1Y3Rpb24gdG9rZW5zIGZvciBgbXNnLnNlbmRlcmAgYWZ0ZXIgdGhlIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBkZXYgQ2xhaW1zIHRva2VucyBmb3IgYG1zZy5zZW5kZXJgIGFmdGVyIGF1Y3Rpb24uIFRvIGJlIHVzZWQgaWYgdG9rZW5zIGNhbgogICAgLy8vIGJlIGNsYWltZWQgYnkgYmVuZWZpY2lhcmllcywgaW5kaXZpZHVhbGx5LgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoKSBwdWJsaWMgYXRTdGFnZShTdGFnZXMuQXVjdGlvbkVuZGVkKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHByb3h5Q2xhaW1Ub2tlbnMobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2xhaW0gYXVjdGlvbiB0b2tlbnMgZm9yIGByZWNlaXZlckFkZHJlc3NgIGFmdGVyIHRoZSBhdWN0aW9uIGhhcyBlbmRlZC4KICAgIC8vLyBAZGV2IENsYWltcyB0b2tlbnMgZm9yIGByZWNlaXZlckFkZHJlc3NgIGFmdGVyIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBwYXJhbSByZWNlaXZlckFkZHJlc3MgVG9rZW5zIHdpbGwgYmUgYXNzaWduZWQgdG8gdGhpcyBhZGRyZXNzIGlmIGVsaWdpYmxlLgogICAgZnVuY3Rpb24gcHJveHlDbGFpbVRva2VucyhhZGRyZXNzIHJlY2VpdmVyQWRkcmVzcykgcHVibGljIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25FbmRlZCkgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBXYWl0aW5nIHBlcmlvZCBhZnRlciB0aGUgZW5kIG9mIHRoZSBhdWN0aW9uLCBiZWZvcmUgYW55b25lIGNhbiBjbGFpbSB0b2tlbnMKICAgICAgICAvLyBFbnN1cmVzIGVub3VnaCB0aW1lIHRvIGNoZWNrIGlmIGF1Y3Rpb24gd2FzIGZpbmFsaXplZCBjb3JyZWN0bHkKICAgICAgICAvLyBiZWZvcmUgdXNlcnMgc3RhcnQgdHJhbnNhY3RpbmcgdG9rZW5zCiAgICAgICAgcmVxdWlyZShub3cgPiBlbmRUaW1lICsgdG9rZW5DbGFpbVdhaXRpbmdQZXJpb2QpOwogICAgICAgIHJlcXVpcmUocmVjZWl2ZXJBZGRyZXNzICE9IDB4MCk7CgogICAgICAgIGlmIChiaWRzW3JlY2VpdmVyQWRkcmVzc10gPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBOdW1iZXIgb2YgWGVpID0gYmlkIHdlaSAvIFhlaSA9IGJpZCB3ZWkgLyAod2VpIHBlciBYQ0ggKiBtdWx0aXBsaWVyKQogICAgICAgIHVpbnQgbnVtID0gKHRva2VuTXVsdGlwbGllciAqIGJpZHNbcmVjZWl2ZXJBZGRyZXNzXSkgLyBmaW5hbFByaWNlOwoKICAgICAgICAvLyBEdWUgdG8gZmluYWxQcmljZSBmbG9vciByb3VuZGluZywgdGhlIG51bWJlciBvZiBhc3NpZ25lZCB0b2tlbnMgbWF5IGJlIGhpZ2hlcgogICAgICAgIC8vIHRoYW4gZXhwZWN0ZWQuIFRoZXJlZm9yZSwgdGhlIG51bWJlciBvZiByZW1haW5pbmcgdW5hc3NpZ25lZCBhdWN0aW9uIHRva2VucwogICAgICAgIC8vIG1heSBiZSBzbWFsbGVyIHRoYW4gdGhlIG51bWJlciBvZiB0b2tlbnMgbmVlZGVkIGZvciB0aGUgbGFzdCBjbGFpbVRva2VucyBjYWxsCiAgICAgICAgdWludCBhdWN0aW9uVG9rZW5zQmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgICAgICBpZiAobnVtID4gYXVjdGlvblRva2Vuc0JhbGFuY2UpIHsKICAgICAgICAgICAgbnVtID0gYXVjdGlvblRva2Vuc0JhbGFuY2U7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiBmdW5kcyBmb3Igd2hpY2ggdG9rZW5zIGhhdmUgYmVlbiBjbGFpbWVkCiAgICAgICAgZnVuZHNDbGFpbWVkICs9IGJpZHNbcmVjZWl2ZXJBZGRyZXNzXTsKCiAgICAgICAgLy8gU2V0IHJlY2VpdmVyIGJpZCB0byAwIGJlZm9yZSBhc3NpZ25pbmcgdG9rZW5zCiAgICAgICAgYmlkc1tyZWNlaXZlckFkZHJlc3NdID0gMDsKCiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihyZWNlaXZlckFkZHJlc3MsIG51bSkpOwoKICAgICAgICBDbGFpbWVkVG9rZW5zKHJlY2VpdmVyQWRkcmVzcywgbnVtKTsKCiAgICAgICAgLy8gQWZ0ZXIgdGhlIGxhc3QgdG9rZW5zIGFyZSBjbGFpbWVkLCB3ZSBjaGFuZ2UgdGhlIGF1Y3Rpb24gc3RhZ2UKICAgICAgICAvLyBEdWUgdG8gdGhlIGFib3ZlIGxvZ2ljLCByb3VuZGluZyBlcnJvcnMgd2lsbCBub3QgYmUgYW4gaXNzdWUKICAgICAgICBpZiAoZnVuZHNDbGFpbWVkID09IHJlY2VpdmVkV2VpKSB7CiAgICAgICAgICAgIHN0YWdlID0gU3RhZ2VzLlRva2Vuc0Rpc3RyaWJ1dGVkOwogICAgICAgICAgICBUb2tlbnNEaXN0cmlidXRlZCgpOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0KHRva2VuLmJhbGFuY2VPZihyZWNlaXZlckFkZHJlc3MpID49IG51bSk7CiAgICAgICAgYXNzZXJ0KGJpZHNbcmVjZWl2ZXJBZGRyZXNzXSA9PSAwKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBXaXRoZHJhdyBFVEggZm9yIGBtc2cuc2VuZGVyYCBhZnRlciB0aGUgYXVjdGlvbiBoYXMgY2FuY2VsZWQuCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uQ2FuY2VsZWQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcHJveHlXaXRoZHJhdyhtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBXaXRoZHJhdyBFVEggZm9yIGByZWNlaXZlckFkZHJlc3NgIGFmdGVyIHRoZSBhdWN0aW9uIGhhcyBjYW5jZWxlZC4KICAgIC8vLyBAcGFyYW0gcmVjZWl2ZXJBZGRyZXNzIEVUSCB3aWxsIGJlIGFzc2lnbmVkIHRvIHRoaXMgYWRkcmVzcyBpZiBlbGlnaWJsZS4KICAgIGZ1bmN0aW9uIHByb3h5V2l0aGRyYXcoYWRkcmVzcyByZWNlaXZlckFkZHJlc3MpIHB1YmxpYyBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uQ2FuY2VsZWQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKHJlY2VpdmVyQWRkcmVzcyAhPSAweDApOwogICAgICAgIAogICAgICAgIGlmIChiaWRzW3JlY2VpdmVyQWRkcmVzc10gPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB1aW50IGFtb3VudCA9IGJpZHNbcmVjZWl2ZXJBZGRyZXNzXTsKICAgICAgICBiaWRzW3JlY2VpdmVyQWRkcmVzc10gPSAwOwogICAgICAgIAogICAgICAgIHJlY2VpdmVyQWRkcmVzcy50cmFuc2ZlcihhbW91bnQpOwoKICAgICAgICBhc3NlcnQoYmlkc1tyZWNlaXZlckFkZHJlc3NdID09IDApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgWENIIHByaWNlIGluIFdFSSBkdXJpbmcgdGhlIGF1Y3Rpb24sIGF0IHRoZSB0aW1lIG9mCiAgICAvLy8gY2FsbGluZyB0aGlzIGZ1bmN0aW9uLiBSZXR1cm5zIGAwYCBpZiBhdWN0aW9uIGhhcyBlbmRlZC4KICAgIC8vLyBSZXR1cm5zIGBwcmljZVN0YXJ0YCBiZWZvcmUgYXVjdGlvbiBoYXMgc3RhcnRlZC4KICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIGN1cnJlbnQgWENIIHRva2VuIHByaWNlIGluIFdFSS4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgV0VJIHBlciBYQ0ggKFhlaSAqIG11bHRpcGxpZXIpLgogICAgZnVuY3Rpb24gcHJpY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChzdGFnZSA9PSBTdGFnZXMuQXVjdGlvbkVuZGVkIHx8CiAgICAgICAgICAgIHN0YWdlID09IFN0YWdlcy5BdWN0aW9uQ2FuY2VsZWQgfHwKICAgICAgICAgICAgc3RhZ2UgPT0gU3RhZ2VzLlRva2Vuc0Rpc3RyaWJ1dGVkKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsY1Rva2VuUHJpY2UoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIG1pc3NpbmcgZnVuZHMgbmVlZGVkIHRvIGVuZCB0aGUgYXVjdGlvbiwKICAgIC8vLyBjYWxjdWxhdGVkIGF0IHRoZSBjdXJyZW50IFhDSCBwcmljZSBpbiBXRUkuCiAgICAvLy8gQGRldiBUaGUgbWlzc2luZyBmdW5kcyBhbW91bnQgbmVjZXNzYXJ5IHRvIGVuZCB0aGUgYXVjdGlvbiBhdCB0aGUgY3VycmVudCBYQ0ggcHJpY2UgaW4gV0VJLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgbWlzc2luZyBmdW5kcyBhbW91bnQgaW4gV0VJLgogICAgZnVuY3Rpb24gbWlzc2luZ0Z1bmRzVG9FbmRBdWN0aW9uKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gbnVtVG9rZW5zQXVjdGlvbmVkID0gdG90YWwgbnVtYmVyIG9mIFhlaSAoWENIICogbXVsdGlwbGllcikgdGhhdCBpcyBhdWN0aW9uZWQKICAgICAgICB1aW50IHJlcXVpcmVkV2VpQXRQcmljZSA9IG51bVRva2Vuc0F1Y3Rpb25lZCAqIHByaWNlKCkgLyB0b2tlbk11bHRpcGxpZXI7CiAgICAgICAgaWYgKHJlcXVpcmVkV2VpQXRQcmljZSA8PSByZWNlaXZlZFdlaSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIGFzc2VydChyZXF1aXJlZFdlaUF0UHJpY2UgLSByZWNlaXZlZFdlaSA+IDApOwogICAgICAgIHJldHVybiByZXF1aXJlZFdlaUF0UHJpY2UgLSByZWNlaXZlZFdlaTsKICAgIH0KCiAgICAvKgogICAgICogIFByaXZhdGUgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvLy8gQGRldiBDYWxjdWxhdGVzIHRoZSB0b2tlbiBwcmljZSAoV0VJIC8gWENIKSBhdCB0aGUgY3VycmVudCB0aW1lc3RhbXAKICAgIC8vLyBkdXJpbmcgdGhlIGF1Y3Rpb247IGVsYXBzZWQgdGltZSA9IDAgYmVmb3JlIGF1Y3Rpb24gc3RhcnRzLgogICAgLy8vIEJhc2VkIG9uIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLCB0aGUgcHJpY2UgZG9lcyBub3QgY2hhbmdlIGluIHRoZSBmaXJzdAogICAgLy8vIGBwcmljZUNvbnN0YW50XigxL3ByaWNlRXhwb25lbnQpYCBzZWNvbmRzIGR1ZSB0byByb3VuZGluZy4KICAgIC8vLyBSb3VuZGluZyBpbiBgZGVjYXlSYXRlYCBhbHNvIHByb2R1Y2VzIHZhbHVlcyB0aGF0IGluY3JlYXNlIGluc3RlYWQgb2YgZGVjcmVhc2UKICAgIC8vLyBpbiB0aGUgYmVnaW5uaW5nOyB0aGVzZSBzcGlrZXMgZGVjcmVhc2Ugb3ZlciB0aW1lIGFuZCBhcmUgbm90aWNlYWJsZQogICAgLy8vIG9ubHkgaW4gZmlyc3QgaG91cnMuIFRoaXMgc2hvdWxkIGJlIGNhbGN1bGF0ZWQgYmVmb3JlIHVzYWdlLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgdG9rZW4gcHJpY2UgLSBXZWkgcGVyIFhDSC4KICAgIGZ1bmN0aW9uIGNhbGNUb2tlblByaWNlKCkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBlbGFwc2VkOwogICAgICAgIGlmIChzdGFnZSA9PSBTdGFnZXMuQXVjdGlvblN0YXJ0ZWQpIHsKICAgICAgICAgICAgZWxhcHNlZCA9IG5vdyAtIHN0YXJ0VGltZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgZGVjYXlSYXRlID0gZWxhcHNlZCAqKiAzIC8gNTQxMDAwMDAwMDAwOwogICAgICAgIHVpbnQgY3VycmVudFByaWNlID0gcHJpY2VTdGFydCAqICgxICsgZWxhcHNlZCkgLyAoMSArIGVsYXBzZWQgKyBkZWNheVJhdGUpOwogICAgICAgIHJldHVybiBtaW5QcmljZSA+IGN1cnJlbnRQcmljZSA/IG1pblByaWNlIDogY3VycmVudFByaWNlOwogICAgfQp9'.
	

]
