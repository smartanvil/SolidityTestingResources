Class {
	#name : #SRT93fcd82fe7370fb367b7cc48477e93048b14a1ca,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT93fcd82fe7370fb367b7cc48477e93048b14a1ca >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOyAgICAgIAogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIC8qIGludGVybmFsPyAqLyByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSAvKiBpbnRlcm5hbCAqLyByZXR1cm5zIChib29sKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9Cgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwogIAogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUgICk7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsKICAgIC8vIE9ubHkgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhcmUgYWxsb3dlZCB0byBtaW50IG5ldyB0b2tlbnMKICAgIGlmKCFtaW50QWdlbnRzW21zZy5zZW5kZXJdKSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBfOwogIH0KICAKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQogIAogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIGNyb3dkc2FsZSBjb250cmFjdCB0byBtaW50IG5ldyB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TWludEFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHsKICAgIG1pbnRBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICAgIE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkciwgc3RhdGUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5TWludEFnZW50IHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIEVSQzIwLCBPd25hYmxlIHsKCiAgLyogVGhlIGZpbmFsaXplciBjb250cmFjdCB0aGF0IGFsbG93cyB1bmxpZnQgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwogIAogIC8vZHRjbyA6IHRpbWUgbG9jayB3aXRoIHNwZWNpZmljIGFkZHJlc3MKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGxvY2tfYWRkcmVzc2VzOwogIAogIGV2ZW50IEFkZExvY2tBZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludCBsb2NrX3RpbWUpOyAgCgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlcikgewoKICAgIGlmKCFyZWxlYXNlZCkgewogICAgICAgIGlmKCF0cmFuc2ZlckFnZW50c1tfc2VuZGVyXSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgllbHNlIHsKCQkvL2NoZWNrIHRpbWUgbG9jayB3aXRoIHRlYW0KCQlpZihub3cgPCBsb2NrX2FkZHJlc3Nlc1tfc2VuZGVyXSkgewoJCQlyZXZlcnQoKTsKCQl9Cgl9CiAgICBfOwogIH0KICAKICBmdW5jdGlvbiBSZWxlYXNhYmxlVG9rZW4oKSB7CglyZWxlYXNlQWdlbnQgPSBtc2cuc2VuZGVyOwogIH0KICAKICAvL2xvY2sgbmV3IHRlYW0gcmVsZWFzZSB0aW1lCiAgZnVuY3Rpb24gYWRkTG9ja0FkZHJlc3NJbnRlcm5hbChhZGRyZXNzIGFkZHIsIHVpbnQgbG9ja190aW1lKSBpblJlbGVhc2VTdGF0ZShmYWxzZSkgaW50ZXJuYWwgewoJaWYoYWRkciA9PSAweDApIHJldmVydCgpOwoJbG9ja19hZGRyZXNzZXNbYWRkcl09IGxvY2tfdGltZTsKCUFkZExvY2tBZGRyZXNzKGFkZHIsIGxvY2tfdGltZSk7CiAgfQogIAogIAogIC8qKgogICAqIFNldCB0aGUgY29udHJhY3QgdGhhdCBjYW4gY2FsbCByZWxlYXNlIGFuZCBtYWtlIHRoZSB0b2tlbiB0cmFuc2ZlcmFibGUuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlLiBBbGxvdyByZXNldCB0aGUgcmVsZWFzZSBhZ2VudCB0byBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CgogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBhIG5vcm1hbCB3YWxsZXQgYWRkcmVzcyB0byBhY3QgYXMgYSByZWxlYXNlIGFnZW50CiAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLgogICAqLwogIGZ1bmN0aW9uIHNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICB0cmFuc2ZlckFnZW50c1thZGRyXSA9IHN0YXRlOwogIH0KICAKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gcmVsZWFzZUFnZW50KSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqCiAgICogT25lIHdheSBmdW5jdGlvbiB0byByZWxlYXNlIHRoZSB0b2tlbnMgdG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IGlzIHRoZSBmaW5hbCBJQ08gY29udHJhY3QuIEl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gc3VjY2VzcyAoZmlyc3QgbWlsZXN0b25lIHJlYWNoZWQpLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgcmVsZWFzZWQgPSB0cnVlOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VzZCAqLwogIG1vZGlmaWVyIGluUmVsZWFzZVN0YXRlKGJvb2wgcmVsZWFzZVN0YXRlKSB7CiAgICBpZihyZWxlYXNlU3RhdGUgIT0gcmVsZWFzZWQpIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIF87CiAgfSAgCgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20pIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKfQoKY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCkgcmV2ZXJ0KCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGlmICghaGFsdGVkKSByZXZlcnQoKTsKICAgIF87CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgaGFsdGVkID0gdHJ1ZTsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGhhbHRlZCA9IGZhbHNlOwogIH0KCn0KCmNvbnRyYWN0IENyb3dkc2FsZUxpbWl0IHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLy8gdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZQogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwogIC8vIHRoZSBVTklYIHRpbWVzdGFtcCBlbmQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlCiAgdWludCBwdWJsaWMgZW5kc0F0OwogIC8vIHNldHRpbmcgdGhlIG1heCB0b2tlbiAKICB1aW50IHB1YmxpYyBUT0tFTl9NQVg7CiAgLy8gc2V0aW5nIHRoZSB3ZWkgdmFsdWUgZm9yIG9uZSB0b2tlbiBpbiBwcmVzYWxlIHN0YWdlCiAgdWludCBwdWJsaWMgUFJFU0FMRV9UT0tFTl9JTl9XRUkgPSA5IGZpbm5leTsKICAvLyB0b3RhbCBldGggZnVuZCBpbiBwcmVzYWxlIHN0YWdlCiAgdWludCBwdWJsaWMgcHJlc2FsZV9ldGhfZnVuZD0gMDsKICAKICAvLyBzZXRpbmcgdGhlIHdlaSB2YWx1ZSBmb3Igb25lIHRva2VuIGluIGNyb3dkc2FsZSBzdGFnZQogIHVpbnQgcHVibGljIENST1dEU0FMRV9UT0tFTl9JTl9XRUkgPSAxMCBmaW5uZXk7ICAKICAKICAvLyBzZXRpbmcgdGhlIG1heCBmdW5kIG9mIHByZXNhbGUgd2l0aCBldGgKICB1aW50IHB1YmxpYyBQUkVTQUxFX0VUSF9JTl9XRUlfRlVORF9NQVggPSAwIGV0aGVyOyAKICAvLyBzZXRpbmcgdGhlIG1pbiBmdW5kIG9mIGNyb3dkc2FsZSB3aXRoIGV0aAogIHVpbnQgcHVibGljIENST1dEU0FMRV9FVEhfSU5fV0VJX0ZVTkRfTUlOID0gMTAwIGV0aGVyOwogIC8vIHNldGluZyB0aGUgbWF4IGZ1bmQgb2YgY3Jvd2RzYWxlIHdpdGggZXRoCiAgdWludCBwdWJsaWMgQ1JPV0RTQUxFX0VUSF9JTl9XRUlfRlVORF9NQVggPSAxMDAwIGV0aGVyOwogIC8vIHNldGluZyB0aGUgbWluIGFjY2VwdGFibGUgaW52ZXN0IHdpdGggZXRoCiAgdWludCBwdWJsaWMgQ1JPV0RTQUxFX0VUSF9JTl9XRUlfQUNDRVBURURfTUlOID0gMTAwIGZpbm5leTsgICAvLzAuMSBldGhlcgogIC8vIHNldGluZyB0aGUgZ2FzcHJpY2UgdG8gbGltaXQgYmlnIGJ1eWVyLCBkZWZhdWx0IHRvIGRpc2FibGUKICB1aW50IHB1YmxpYyBDUk9XRFNBTEVfR0FTUFJJQ0VfSU5fV0VJX01BWCA9IDA7CiAKICAvLyB0b3RhbCBldGggZnVuZAogIHVpbnQgcHVibGljIGNyb3dkc2FsZV9ldGhfZnVuZD0gMDsKICAvLyB0b3RhbCBldGggcmVmdW5kCiAgdWludCBwdWJsaWMgY3Jvd2RzYWxlX2V0aF9yZWZ1bmQgPSAwOwogICAKICAvLyBzZXR0aW5nIHRlYW0gbGlzdCBhbmQgc2V0IHBlcmNlbnRhZ2Ugb2YgdG9rZW5zCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB0ZWFtX2FkZHJlc3Nlc190b2tlbl9wZXJjZW50YWdlOwogIG1hcHBpbmcodWludCA9PiBhZGRyZXNzKSBwdWJsaWMgdGVhbV9hZGRyZXNzZXNfaWR4OwogIHVpbnQgcHVibGljIHRlYW1fYWRkcmVzc19jb3VudD0gMDsKICB1aW50IHB1YmxpYyB0ZWFtX3Rva2VuX3BlcmNlbnRhZ2VfdG90YWw9IDA7CiAgdWludCBwdWJsaWMgdGVhbV90b2tlbl9wZXJjZW50YWdlX21heD0gMDsKICAgIAogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBuZXdFbmRzQXQpOwogIGV2ZW50IEFkZFRlYW1BZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludCByZWxlYXNlX3RpbWUsIHVpbnQgdG9rZW5fcGVyY2VudGFnZSk7CiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsKICAgIAogIC8vIGxpbWl0YXRpb24gb2YgYnV5aW5nIHRva2VucwogIG1vZGlmaWVyIGFsbG93Q3Jvd2RzYWxlQW1vdW50TGltaXQoKXsJCglpZiAobXNnLnZhbHVlID09IDApIHJldmVydCgpOwoJaWYgKG1zZy52YWx1ZSA8IENST1dEU0FMRV9FVEhfSU5fV0VJX0FDQ0VQVEVEX01JTikgcmV2ZXJ0KCk7CglpZigoY3Jvd2RzYWxlX2V0aF9mdW5kLmFkZChtc2cudmFsdWUpKSA+IENST1dEU0FMRV9FVEhfSU5fV0VJX0ZVTkRfTUFYKSByZXZlcnQoKTsKCWlmKChDUk9XRFNBTEVfR0FTUFJJQ0VfSU5fV0VJX01BWCA+IDApICYmICh0eC5nYXNwcmljZSA+IENST1dEU0FMRV9HQVNQUklDRV9JTl9XRUlfTUFYKSkgcmV2ZXJ0KCk7CglfOwogIH0gIAogICAKICBmdW5jdGlvbiBDcm93ZHNhbGVMaW1pdCh1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF90b2tlbl9tYXgsIHVpbnQgX3ByZXNhbGVfdG9rZW5faW5fd2VpLCB1aW50IF9jcm93ZHNhbGVfdG9rZW5faW5fd2VpLCB1aW50IF9wcmVzYWxlX2V0aF9pbndlaV9mdW5kX21heCwgdWludCBfY3Jvd2RzYWxlX2V0aF9pbndlaV9mdW5kX21pbiwgdWludCBfY3Jvd2RzYWxlX2V0aF9pbndlaV9mdW5kX21heCwgdWludCBfY3Jvd2RzYWxlX2V0aF9pbndlaV9hY2NlcHRlZF9taW4sIHVpbnQgX2Nyb3dkc2FsZV9nYXNwcmljZV9pbndlaV9tYXgsIHVpbnQgX3RlYW1fdG9rZW5fcGVyY2VudGFnZV9tYXgpIHsKCXJlcXVpcmUoX3N0YXJ0ICE9IDApOwoJcmVxdWlyZShfZW5kICE9IDApOwoJcmVxdWlyZShfc3RhcnQgPCBfZW5kKTsKCQoJaWYoIChfcHJlc2FsZV90b2tlbl9pbl93ZWkgPT0gMCkgfHwKCSAgICAoX2Nyb3dkc2FsZV90b2tlbl9pbl93ZWkgPT0gMCkgfHwKCQkoX2Nyb3dkc2FsZV9ldGhfaW53ZWlfZnVuZF9taW4gPT0gMCkgfHwKCQkoX2Nyb3dkc2FsZV9ldGhfaW53ZWlfZnVuZF9tYXggPT0gMCkgfHwKCQkoX2Nyb3dkc2FsZV9ldGhfaW53ZWlfYWNjZXB0ZWRfbWluID09IDApIHx8CgkJKF90ZWFtX3Rva2VuX3BlcmNlbnRhZ2VfbWF4ID49IDEwMCkpICAvL2V4YW1wbGUgMjAlPTIwCgkJcmV2ZXJ0KCk7CgkJCglzdGFydHNBdCA9IF9zdGFydDsKICAgIGVuZHNBdCA9IF9lbmQ7CgkKCVRPS0VOX01BWCA9IF90b2tlbl9tYXg7CgkJCglQUkVTQUxFX1RPS0VOX0lOX1dFSSA9IF9wcmVzYWxlX3Rva2VuX2luX3dlaTsKCQoJQ1JPV0RTQUxFX1RPS0VOX0lOX1dFSSA9IF9jcm93ZHNhbGVfdG9rZW5faW5fd2VpOwkKCVBSRVNBTEVfRVRIX0lOX1dFSV9GVU5EX01BWCA9IF9wcmVzYWxlX2V0aF9pbndlaV9mdW5kX21heDsKCUNST1dEU0FMRV9FVEhfSU5fV0VJX0ZVTkRfTUlOID0gX2Nyb3dkc2FsZV9ldGhfaW53ZWlfZnVuZF9taW47CglDUk9XRFNBTEVfRVRIX0lOX1dFSV9GVU5EX01BWCA9IF9jcm93ZHNhbGVfZXRoX2lud2VpX2Z1bmRfbWF4OwoJQ1JPV0RTQUxFX0VUSF9JTl9XRUlfQUNDRVBURURfTUlOID0gX2Nyb3dkc2FsZV9ldGhfaW53ZWlfYWNjZXB0ZWRfbWluOwoJQ1JPV0RTQUxFX0dBU1BSSUNFX0lOX1dFSV9NQVggPSBfY3Jvd2RzYWxlX2dhc3ByaWNlX2lud2VpX21heDsKCQoJdGVhbV90b2tlbl9wZXJjZW50YWdlX21heD0gX3RlYW1fdG9rZW5fcGVyY2VudGFnZV9tYXg7CiAgfQogICAgCiAgLy8gY2FjdWxhdGUgYW1vdW50IG9mIHRva2VuIGluIHByZXNhbGUgc3RhZ2UKICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlblByZXNhbGUodWludCB2YWx1ZSwgdWludCBkZWNpbWFscykgLyppbnRlcm5hbCovIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IG11bHRpcGxpZXIgPSAxMCAqKiBkZWNpbWFsczsKICAgIHJldHVybiB2YWx1ZS5tdWwobXVsdGlwbGllcikuZGl2KFBSRVNBTEVfVE9LRU5fSU5fV0VJKTsKICB9CiAgCiAgLy8gY2FjdWxhdGUgYW1vdW50IG9mIHRva2VuIGluIGNyb3dkc2FsZSBzdGFnZQogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQ3Jvd3NhbGUodWludCB2YWx1ZSwgdWludCBkZWNpbWFscykgLyppbnRlcm5hbCovIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IG11bHRpcGxpZXIgPSAxMCAqKiBkZWNpbWFsczsKICAgIHJldHVybiB2YWx1ZS5tdWwobXVsdGlwbGllcikuZGl2KENST1dEU0FMRV9UT0tFTl9JTl9XRUkpOwogIH0KICAKICAvLyBjaGVjayBpZiB0aGUgZ29hbCBpcyByZWFjaGVkCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGNyb3dkc2FsZV9ldGhfZnVuZCA+PSBDUk9XRFNBTEVfRVRIX0lOX1dFSV9GVU5EX01JTjsKICB9CiAgCiAgLy8gYWRkIG5ldyB0ZWFtIHBlcmNlbnRhZ2Ugb2YgdG9rZW5zCiAgZnVuY3Rpb24gYWRkVGVhbUFkZHJlc3NJbnRlcm5hbChhZGRyZXNzIGFkZHIsIHVpbnQgcmVsZWFzZV90aW1lLCB1aW50IHRva2VuX3BlcmNlbnRhZ2UpIGludGVybmFsIHsKCWlmKCh0ZWFtX3Rva2VuX3BlcmNlbnRhZ2VfdG90YWwuYWRkKHRva2VuX3BlcmNlbnRhZ2UpKSA+IHRlYW1fdG9rZW5fcGVyY2VudGFnZV9tYXgpIHJldmVydCgpOwoJaWYoKHRlYW1fdG9rZW5fcGVyY2VudGFnZV90b3RhbC5hZGQodG9rZW5fcGVyY2VudGFnZSkpID4gMTAwKSByZXZlcnQoKTsKCWlmKHRlYW1fYWRkcmVzc2VzX3Rva2VuX3BlcmNlbnRhZ2VbYWRkcl0gIT0gMCkgcmV2ZXJ0KCk7CgkKCXRlYW1fYWRkcmVzc2VzX3Rva2VuX3BlcmNlbnRhZ2VbYWRkcl09IHRva2VuX3BlcmNlbnRhZ2U7Cgl0ZWFtX2FkZHJlc3Nlc19pZHhbdGVhbV9hZGRyZXNzX2NvdW50XT0gYWRkcjsKCXRlYW1fYWRkcmVzc19jb3VudCsrOwoJCgl0ZWFtX3Rva2VuX3BlcmNlbnRhZ2VfdG90YWwgPSB0ZWFtX3Rva2VuX3BlcmNlbnRhZ2VfdG90YWwuYWRkKHRva2VuX3BlcmNlbnRhZ2UpOwoKCUFkZFRlYW1BZGRyZXNzKGFkZHIsIHJlbGVhc2VfdGltZSwgdG9rZW5fcGVyY2VudGFnZSk7CiAgfQogICAKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmRzQXQ7CiAgfQp9Cgpjb250cmFjdCBDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlTGltaXQsIEhhbHRhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOwogIAogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKICAgIAogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CgogIC8qKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwogIAogIC8qKiBBZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBpbnZlc3QgZXZlbiBiZWZvcmUgSUNPIG9mZmljYWwgb3BlbnMuIEZvciB0ZXN0aW5nLCBmb3IgSUNPIHBhcnRuZXJzLCBldGMuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgcHJlc2FsZVdoaXRlbGlzdDsKICAKICBib29sIHB1YmxpYyB3aGl0ZWxpc3RfZW5hYmxlPSB0cnVlOwogIAogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwogIAogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CiAgCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CiAgCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwogIAogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9CiAgICAKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQpOwogIAogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKICAKICBldmVudCBjcmVhdGVUZWFtVG9rZW5FdmVudChhZGRyZXNzIGFkZHIsIHVpbnQgdG9rZW5zKTsKICAKICBldmVudCBGaW5hbGl6ZWQoKTsKICAKICAvKiogTW9kaWZpZWQgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgcmV2ZXJ0KCk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfdG9rZW5fbWF4LCB1aW50IF9wcmVzYWxlX3Rva2VuX2luX3dlaSwgdWludCBfY3Jvd2RzYWxlX3Rva2VuX2luX3dlaSwgdWludCBfcHJlc2FsZV9ldGhfaW53ZWlfZnVuZF9tYXgsIHVpbnQgX2Nyb3dkc2FsZV9ldGhfaW53ZWlfZnVuZF9taW4sIHVpbnQgX2Nyb3dkc2FsZV9ldGhfaW53ZWlfZnVuZF9tYXgsIHVpbnQgX2Nyb3dkc2FsZV9ldGhfaW53ZWlfYWNjZXB0ZWRfbWluLCB1aW50IF9jcm93ZHNhbGVfZ2FzcHJpY2VfaW53ZWlfbWF4LCB1aW50IF90ZWFtX3Rva2VuX3BlcmNlbnRhZ2VfbWF4LCBib29sIF93aGl0ZWxpc3RfZW5hYmxlKSAKICAgICAgICAgICBDcm93ZHNhbGVMaW1pdChfc3RhcnQsIF9lbmQsIF90b2tlbl9tYXgsIF9wcmVzYWxlX3Rva2VuX2luX3dlaSwgX2Nyb3dkc2FsZV90b2tlbl9pbl93ZWksIF9wcmVzYWxlX2V0aF9pbndlaV9mdW5kX21heCwgX2Nyb3dkc2FsZV9ldGhfaW53ZWlfZnVuZF9taW4sIF9jcm93ZHNhbGVfZXRoX2lud2VpX2Z1bmRfbWF4LCBfY3Jvd2RzYWxlX2V0aF9pbndlaV9hY2NlcHRlZF9taW4sIF9jcm93ZHNhbGVfZ2FzcHJpY2VfaW53ZWlfbWF4LCBfdGVhbV90b2tlbl9wZXJjZW50YWdlX21heCkKICB7CiAgICByZXF1aXJlKF90b2tlbiAhPSAweDApOwogICAgcmVxdWlyZShfbXVsdGlzaWdXYWxsZXQgIT0gMHgwKTsKCQoJdG9rZW4gPSBDcm93ZHNhbGVUb2tlbihfdG9rZW4pOwkKCW11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0OwoJCgl3aGl0ZWxpc3RfZW5hYmxlPSBfd2hpdGVsaXN0X2VuYWJsZTsKICB9CiAgCiAgLyogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4gKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAobm93IDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOwogICAgZWxzZSBpZiAobm93IDw9IGVuZHNBdCAmJiAhaXNNaW5pbXVtR29hbFJlYWNoZWQoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsKICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIGNyb3dkc2FsZV9ldGhfZnVuZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IGNyb3dkc2FsZV9ldGhfZnVuZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7CiAgfQogICAKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKgogICAqIFRPRE86IEZpeCBzcGVsbGluZyBlcnJvciBpbiB0aGUgbmFtZQogICAqLwogIGZ1bmN0aW9uIHNldFByZXNhbGVXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgb25seU93bmVyIGluU3RhdGUoU3RhdGUuUHJlRnVuZGluZykgewoJcmVxdWlyZSh3aGl0ZWxpc3RfZW5hYmxlPT10cnVlKTsKCiAgICBwcmVzYWxlV2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOwogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsKICB9CiAgCiAgLy9hZGQgbmV3IHRlYW0gcGVyY2VudGFnZSBvZiB0b2tlbnMgYW5kIGxvY2sgdGhlaXIgcmVsZWFzZSB0aW1lCiAgZnVuY3Rpb24gYWRkVGVhbUFkZHJlc3MoYWRkcmVzcyBhZGRyLCB1aW50IHJlbGVhc2VfdGltZSwgdWludCB0b2tlbl9wZXJjZW50YWdlKSBvbmx5T3duZXIgaW5TdGF0ZShTdGF0ZS5QcmVGdW5kaW5nKSBleHRlcm5hbCB7CglzdXBlci5hZGRUZWFtQWRkcmVzc0ludGVybmFsKGFkZHIsIHJlbGVhc2VfdGltZSwgdG9rZW5fcGVyY2VudGFnZSk7Cgl0b2tlbi5hZGRMb2NrQWRkcmVzcyhhZGRyLCByZWxlYXNlX3RpbWUpOyAgLy9ub3QgdXNlIGRlbGVnYXRlY2FsbAogIH0KICAKICAvL2dlbmVyYXRlIHRlYW0gdG9rZW5zIGluIGFjY29yZGFuY2Ugd2l0aCBwZXJjZW50YWdlIG9mIHRvdGFsIGlzc3VlIHRva2Vucywgbm90IHByZWFsbG9jYXRlCiAgZnVuY3Rpb24gY3JlYXRlVGVhbVRva2VuQnlQZXJjZW50YWdlKCkgb25seU93bmVyIGludGVybmFsIHsKCXVpbnQgdG90YWw9IHRva2VuLnRvdGFsU3VwcGx5KCk7CgkvL3VpbnQgdG9rZW5zPSB0b3RhbC5tdWwoMTAwKS5kaXYoMTAwLXRlYW1fdG9rZW5fcGVyY2VudGFnZV90b3RhbCkuc3ViKHRvdGFsKTsKCXVpbnQgdG9rZW5zPSB0b3RhbC5tdWwodGVhbV90b2tlbl9wZXJjZW50YWdlX3RvdGFsKS5kaXYoMTAwLXRlYW1fdG9rZW5fcGVyY2VudGFnZV90b3RhbCk7CgkKCWZvcih1aW50IGk9MDsgaTx0ZWFtX2FkZHJlc3NfY291bnQ7IGkrKykgewoJCWFkZHJlc3MgYWRkcj0gdGVhbV9hZGRyZXNzZXNfaWR4W2ldOwoJCWlmKGFkZHI9PTB4MCkgY29udGludWU7CgkJCgkJdWludCBudG9rZW49IHRva2Vucy5tdWwodGVhbV9hZGRyZXNzZXNfdG9rZW5fcGVyY2VudGFnZVthZGRyXSkuZGl2KHRlYW1fdG9rZW5fcGVyY2VudGFnZV90b3RhbCk7CgkJdG9rZW4ubWludChhZGRyLCBudG9rZW4pOwkJCgkJY3JlYXRlVGVhbVRva2VuRXZlbnQoYWRkciwgbnRva2VuKTsKCX0KICB9CiAgCiAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogIGZ1bmN0aW9uICgpIHN0b3BJbkVtZXJnZW5jeSBhbGxvd0Nyb3dkc2FsZUFtb3VudExpbWl0IHBheWFibGUgewoJcmVxdWlyZShtc2cuc2VuZGVyICE9IDB4MCk7CiAgICBidXlUb2tlbnNDcm93ZHNhbGUobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnNDcm93ZHNhbGUoYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgLypzdG9wSW5FbWVyZ2VuY3kgYWxsb3dDcm93ZHNhbGVBbW91bnRMaW1pdCBwYXlhYmxlKi8gewoJdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7Cgl1aW50MjU2IHRva2VuQW1vdW50PSAwOwoJCglpZihnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsKCQlpZih3aGl0ZWxpc3RfZW5hYmxlPT10cnVlKSB7CgkJCWlmKCFwcmVzYWxlV2hpdGVsaXN0W3JlY2VpdmVyXSkgewoJCQkJcmV2ZXJ0KCk7CgkJCX0KCQl9CgkJCgkJaWYoKFBSRVNBTEVfRVRIX0lOX1dFSV9GVU5EX01BWCA+IDApICYmICgocHJlc2FsZV9ldGhfZnVuZC5hZGQod2VpQW1vdW50KSkgPiBQUkVTQUxFX0VUSF9JTl9XRUlfRlVORF9NQVgpKSByZXZlcnQoKTsJCQoJCQoJCXRva2VuQW1vdW50ID0gY2FsY3VsYXRlVG9rZW5QcmVzYWxlKHdlaUFtb3VudCwgdG9rZW4uZGVjaW1hbHMoKSk7CgkJcHJlc2FsZV9ldGhfZnVuZCA9IHByZXNhbGVfZXRoX2Z1bmQuYWRkKHdlaUFtb3VudCk7Cgl9CgllbHNlIGlmKChnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpIHx8IChnZXRTdGF0ZSgpID09IFN0YXRlLlN1Y2Nlc3MpKSB7CgkJdG9rZW5BbW91bnQgPSBjYWxjdWxhdGVUb2tlbkNyb3dzYWxlKHdlaUFtb3VudCwgdG9rZW4uZGVjaW1hbHMoKSk7CgkJCiAgICB9IGVsc2UgewogICAgICAvLyBVbndhbnRlZCBzdGF0ZQogICAgICByZXZlcnQoKTsKICAgIH0KCQoJaWYodG9rZW5BbW91bnQgPT0gMCkgewoJCXJldmVydCgpOwoJfQkKCQoJaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgaW52ZXN0b3JDb3VudCsrOwogICAgfQogICAgCgkvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0uYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLmFkZCh0b2tlbkFtb3VudCk7CgkKICAgIC8vIFVwZGF0ZSB0b3RhbHMKCWNyb3dkc2FsZV9ldGhfZnVuZCA9IGNyb3dkc2FsZV9ldGhfZnVuZC5hZGQod2VpQW1vdW50KTsKCXRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLmFkZCh0b2tlbkFtb3VudCk7CgkKCWlmKChUT0tFTl9NQVggPiAwKSAmJiAodG9rZW5zU29sZCA+IFRPS0VOX01BWCkpIHJldmVydCgpOwoKICAgIHRva2VuLm1pbnQocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSByZXZlcnQoKTsKCQoJLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50KTsKICB9CiAKICAvKioKICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuCiAgICoKICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4KICAgKi8KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7CiAgICBpZihtc2cudmFsdWUgPT0gMCkgcmV2ZXJ0KCk7CiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQuYWRkKG1zZy52YWx1ZSk7CiAgfQogIAogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqCiAgICogTm90ZSB0aGF0IGFueSByZWZ1bmRzIGZyb20gcHJveHkgYnV5ZXJzIHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHksCiAgICogYW5kIG5vdCB0aHJvdWdoIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsKICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSByZXZlcnQoKTsKICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOwogICAgY3Jvd2RzYWxlX2V0aF9yZWZ1bmQgPSBjcm93ZHNhbGVfZXRoX3JlZnVuZC5hZGQod2VpVmFsdWUpOwogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsKICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHdlaVZhbHVlKSkgcmV2ZXJ0KCk7CiAgfQogIAogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7CiAgICBpZihub3cgPiB0aW1lKSB7CiAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGVuZHNBdCA9IHRpbWU7CiAgICBFbmRzQXRDaGFuZ2VkKGVuZHNBdCk7CiAgfQogIAogIC8vIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvCiAgLy8gc29tZSBleHRyYSBmaW5hbGl6YXRpb24gd29yawogIGZ1bmN0aW9uIGRvRmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIAoJaWYoZmluYWxpemVkKSB7CiAgICAgIHJldmVydCgpOwogICAgfQoKCWNyZWF0ZVRlYW1Ub2tlbkJ5UGVyY2VudGFnZSgpOwogICAgdG9rZW4uZmluaXNoTWludGluZygpOwkKICAgICAgICAKICAgIGZpbmFsaXplZCA9IHRydWU7CglGaW5hbGl6ZWQoKTsKICB9CiAgCn0KCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIGlzIFJlbGVhc2FibGVUb2tlbiwgTWludGFibGVUb2tlbiB7CgogIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogIHVpbnQgcHVibGljIGRlY2ltYWxzOwogICAgCiAgLyoqCiAgICogQ29uc3RydWN0IHRoZSB0b2tlbi4KICAgKgogICAqIEBwYXJhbSBfbmFtZSBUb2tlbiBuYW1lCiAgICogQHBhcmFtIF9zeW1ib2wgVG9rZW4gc3ltYm9sIC0gc2hvdWxkIGJlIGFsbCBjYXBzCiAgICogQHBhcmFtIF9pbml0aWFsU3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoCiAgICogQHBhcmFtIF9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgKiBAcGFyYW0gX21pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscywgYm9vbCBfbWludGFibGUpIHsKCiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKCiAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5OwoKICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwoKICAgIGJhbGFuY2VzW293bmVyXSA9IHRvdGFsU3VwcGx5OwoKICAgIGlmKHRvdGFsU3VwcGx5ID4gMCkgewogICAgICBNaW50KG93bmVyLCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgLy8gTm8gbW9yZSBuZXcgc3VwcGx5IGFsbG93ZWQgYWZ0ZXIgdGhlIHRva2VuIGNyZWF0aW9uCiAgICBpZighX21pbnRhYmxlKSB7CiAgICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICAgIGlmKHRvdGFsU3VwcGx5ID09IDApIHsKICAgICAgICByZXZlcnQoKTsgLy8gQ2Fubm90IGNyZWF0ZSBhIHRva2VuIHdpdGhvdXQgc3VwcGx5IGFuZCBubyBtaW50aW5nCiAgICAgIH0KICAgIH0KICB9CgogIC8qKgogICAqIFdoZW4gdG9rZW4gaXMgcmVsZWFzZWQgdG8gYmUgdHJhbnNmZXJhYmxlLCBlbmZvcmNlIG5vIG5ldyB0b2tlbnMgY2FuIGJlIGNyZWF0ZWQuCiAgICovCiAgIAogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQogIAogIC8vbG9jayB0ZWFtIGFkZHJlc3MgYnkgY3Jvd2RzYWxlCiAgZnVuY3Rpb24gYWRkTG9ja0FkZHJlc3MoYWRkcmVzcyBhZGRyLCB1aW50IGxvY2tfdGltZSkgb25seU1pbnRBZ2VudCBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKCXN1cGVyLmFkZExvY2tBZGRyZXNzSW50ZXJuYWwoYWRkciwgbG9ja190aW1lKTsKICB9Cgp9'.
	

]
