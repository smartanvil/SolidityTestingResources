Class {
	#name : #SRT99b0d4cb34648486690db55288667472eeba6a1d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT99b0d4cb34648486690db55288667472eeba6a1d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBBY2Nlc3NDb250cm9sIHsKICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3JBZGRyZXNzOwogICAgdWludDE2IHB1YmxpYyB0b3RhbFNlcmFwaGltcyA9IDA7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBzZXJhcGhpbXM7CgogICAgYm9vbCBwdWJsaWMgaXNNYWludGVuYW5jZU1vZGUgPSB0cnVlOwogCiAgICBtb2RpZmllciBvbmx5Q1JFQVRPUigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3JlYXRvckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNFUkFQSElNKCkgewogICAgICAgIHJlcXVpcmUoc2VyYXBoaW1zW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlzQ29udHJhY3RBY3RpdmUgewogICAgICAgIHJlcXVpcmUoIWlzTWFpbnRlbmFuY2VNb2RlKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgY3JlYXRvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCgogICAgZnVuY3Rpb24gYWRkU0VSQVBISU0oYWRkcmVzcyBfbmV3U2VyYXBoaW0pIG9ubHlDUkVBVE9SIHB1YmxpYyB7CiAgICAgICAgaWYgKHNlcmFwaGltc1tfbmV3U2VyYXBoaW1dID09IGZhbHNlKSB7CiAgICAgICAgICAgIHNlcmFwaGltc1tfbmV3U2VyYXBoaW1dID0gdHJ1ZTsKICAgICAgICAgICAgdG90YWxTZXJhcGhpbXMgKz0gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZVNFUkFQSElNKGFkZHJlc3MgX29sZFNlcmFwaGltKSBvbmx5Q1JFQVRPUiBwdWJsaWMgewogICAgICAgIGlmIChzZXJhcGhpbXNbX29sZFNlcmFwaGltXSA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlcmFwaGltc1tfb2xkU2VyYXBoaW1dID0gZmFsc2U7CiAgICAgICAgICAgIHRvdGFsU2VyYXBoaW1zIC09IDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZU1haW50ZW5hbmNlTW9kZShib29sIF9pc01haW50YWluaW5nKSBvbmx5Q1JFQVRPUiBwdWJsaWMgewogICAgICAgIGlzTWFpbnRlbmFuY2VNb2RlID0gX2lzTWFpbnRhaW5pbmc7CiAgICB9CgogIAp9IAoKY29udHJhY3QgU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IHgsIHVpbnQgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgdWludCB6ID0geCArIHk7CiAgICAgIGFzc2VydCgoeiA+PSB4KSAmJiAoeiA+PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWJ0cmFjdCh1aW50IHgsIHVpbnQgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgYXNzZXJ0KHggPj0geSk7CiAgICAgIHVpbnQgeiA9IHggLSB5OwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsdCh1aW50IHgsIHVpbnQgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgdWludCB6ID0geCAqIHk7CiAgICAgIGFzc2VydCgoeCA9PSAwKXx8KHoveCA9PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQogICAgCiAgICAgZnVuY3Rpb24gc2FmZURpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgICBmdW5jdGlvbiBnZXRSYW5kb21OdW1iZXIodWludDE2IG1heFJhbmRvbSwgdWludDggbWluLCBhZGRyZXNzIHByaXZhdGVBZGRyZXNzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCkgewogICAgICAgIHVpbnQyNTYgZ2VuTnVtID0gdWludDI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSArIHVpbnQyNTYocHJpdmF0ZUFkZHJlc3MpOwogICAgICAgIHJldHVybiB1aW50OChnZW5OdW0gJSAobWF4UmFuZG9tIC0gbWluICsgMSkrbWluKTsKICAgIH0KfQoKY29udHJhY3QgRW51bXMgewogICAgZW51bSBSZXN1bHRDb2RlIHsKICAgICAgICBTVUNDRVNTLAogICAgICAgIEVSUk9SX0NMQVNTX05PVF9GT1VORCwKICAgICAgICBFUlJPUl9MT1dfQkFMQU5DRSwKICAgICAgICBFUlJPUl9TRU5EX0ZBSUwsCiAgICAgICAgRVJST1JfTk9UX09XTkVSLAogICAgICAgIEVSUk9SX05PVF9FTk9VR0hfTU9ORVksCiAgICAgICAgRVJST1JfSU5WQUxJRF9BTU9VTlQKICAgIH0KCiAgICBlbnVtIEFuZ2VsQXVyYSB7IAogICAgICAgIEJsdWUsIAogICAgICAgIFllbGxvdywgCiAgICAgICAgUHVycGxlLCAKICAgICAgICBPcmFuZ2UsIAogICAgICAgIFJlZCwgCiAgICAgICAgR3JlZW4gCiAgICB9Cn0KCmNvbnRyYWN0IElBbmdlbENhcmREYXRhIGlzIEFjY2Vzc0NvbnRyb2wsIEVudW1zIHsKICAgIHVpbnQ4IHB1YmxpYyB0b3RhbEFuZ2VsQ2FyZFNlcmllczsKICAgIHVpbnQ2NCBwdWJsaWMgdG90YWxBbmdlbHM7CgogICAgCiAgICAvLyB3cml0ZQogICAgLy8gYW5nZWxzCiAgICBmdW5jdGlvbiBjcmVhdGVBbmdlbENhcmRTZXJpZXModWludDggX2FuZ2VsQ2FyZFNlcmllc0lkLCB1aW50IF9iYXNlUHJpY2UsICB1aW50NjQgX21heFRvdGFsLCB1aW50OCBfYmFzZUF1cmEsIHVpbnQxNiBfYmFzZUJhdHRsZVBvd2VyLCB1aW50NjQgX2xpdmVUaW1lKSBvbmx5Q1JFQVRPUiBleHRlcm5hbCByZXR1cm5zKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIHVwZGF0ZUFuZ2VsQ2FyZFNlcmllcyh1aW50OCBfYW5nZWxDYXJkU2VyaWVzSWQsIHVpbnQ2NCBfbmV3UHJpY2UsIHVpbnQ2NCBfbmV3TWF4VG90YWwpIG9ubHlDUkVBVE9SIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0QW5nZWwodWludDggX2FuZ2VsQ2FyZFNlcmllc0lkLCBhZGRyZXNzIF9vd25lciwgdWludCBfcHJpY2UsIHVpbnQxNiBfYmF0dGxlUG93ZXIpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBhZGRUb0FuZ2VsRXhwZXJpZW5jZUxldmVsKHVpbnQ2NCBfYW5nZWxJZCwgdWludCBfdmFsdWUpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldEFuZ2VsTGFzdEJhdHRsZVRpbWUodWludDY0IF9hbmdlbElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRBbmdlbExhc3RWc0JhdHRsZVRpbWUodWludDY0IF9hbmdlbElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRMYXN0QmF0dGxlUmVzdWx0KHVpbnQ2NCBfYW5nZWxJZCwgdWludDE2IF92YWx1ZSkgb25seVNFUkFQSElNIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQW5nZWxJZE1hcHBpbmcoYWRkcmVzcyBfb3duZXIsIHVpbnQ2NCBfYW5nZWxJZCkgcHJpdmF0ZTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyQW5nZWwoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQ2NCBfYW5nZWxJZCkgb25seVNFUkFQSElNIHB1YmxpYyByZXR1cm5zKFJlc3VsdENvZGUpOwogICAgZnVuY3Rpb24gb3duZXJBbmdlbFRyYW5zZmVyIChhZGRyZXNzIF90bywgdWludDY0IF9hbmdlbElkKSAgcHVibGljOwogICAgZnVuY3Rpb24gdXBkYXRlQW5nZWxMb2NrICh1aW50NjQgX2FuZ2VsSWQsIGJvb2wgbmV3VmFsdWUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHJlbW92ZUNyZWF0b3IoKSBvbmx5Q1JFQVRPUiBleHRlcm5hbDsKCiAgICAvLyByZWFkCiAgICBmdW5jdGlvbiBnZXRBbmdlbENhcmRTZXJpZXModWludDggX2FuZ2VsQ2FyZFNlcmllc0lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCBhbmdlbENhcmRTZXJpZXNJZCwgdWludDY0IGN1cnJlbnRBbmdlbFRvdGFsLCB1aW50IGJhc2VQcmljZSwgdWludDY0IG1heEFuZ2VsVG90YWwsIHVpbnQ4IGJhc2VBdXJhLCB1aW50IGJhc2VCYXR0bGVQb3dlciwgdWludDY0IGxhc3RTZWxsVGltZSwgdWludDY0IGxpdmVUaW1lKTsKICAgIGZ1bmN0aW9uIGdldEFuZ2VsKHVpbnQ2NCBfYW5nZWxJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDY0IGFuZ2VsSWQsIHVpbnQ4IGFuZ2VsQ2FyZFNlcmllc0lkLCB1aW50MTYgYmF0dGxlUG93ZXIsIHVpbnQ4IGF1cmEsIHVpbnQxNiBleHBlcmllbmNlLCB1aW50IHByaWNlLCB1aW50NjQgY3JlYXRlZFRpbWUsIHVpbnQ2NCBsYXN0QmF0dGxlVGltZSwgdWludDY0IGxhc3RWc0JhdHRsZVRpbWUsIHVpbnQxNiBsYXN0QmF0dGxlUmVzdWx0LCBhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGdldE93bmVyQW5nZWxDb3VudChhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBnZXRBbmdlbEJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2luZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gZ2V0VG90YWxBbmdlbENhcmRTZXJpZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0VG90YWxBbmdlbHMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0KTsKICAgIGZ1bmN0aW9uIGdldEFuZ2VsTG9ja1N0YXR1cyh1aW50NjQgX2FuZ2VsSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKTsKfQoKCmNvbnRyYWN0IElQZXRDYXJkRGF0YSBpcyBBY2Nlc3NDb250cm9sLCBFbnVtcyB7CiAgICB1aW50OCBwdWJsaWMgdG90YWxQZXRDYXJkU2VyaWVzOyAgICAKICAgIHVpbnQ2NCBwdWJsaWMgdG90YWxQZXRzOwogICAgCiAgICAvLyB3cml0ZQogICAgZnVuY3Rpb24gY3JlYXRlUGV0Q2FyZFNlcmllcyh1aW50OCBfcGV0Q2FyZFNlcmllc0lkLCB1aW50MzIgX21heFRvdGFsKSBvbmx5Q1JFQVRPUiBwdWJsaWMgcmV0dXJucyh1aW50OCk7CiAgICBmdW5jdGlvbiBzZXRQZXQodWludDggX3BldENhcmRTZXJpZXNJZCwgYWRkcmVzcyBfb3duZXIsIHN0cmluZyBfbmFtZSwgdWludDggX2x1Y2ssIHVpbnQxNiBfYXVyYVJlZCwgdWludDE2IF9hdXJhWWVsbG93LCB1aW50MTYgX2F1cmFCbHVlKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gc2V0UGV0QXVyYXModWludDY0IF9wZXRJZCwgdWludDggX2F1cmFSZWQsIHVpbnQ4IF9hdXJhQmx1ZSwgdWludDggX2F1cmFZZWxsb3cpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldFBldExhc3RUcmFpbmluZ1RpbWUodWludDY0IF9wZXRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0UGV0TGFzdEJyZWVkaW5nVGltZSh1aW50NjQgX3BldElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRQZXRJZE1hcHBpbmcoYWRkcmVzcyBfb3duZXIsIHVpbnQ2NCBfcGV0SWQpIHByaXZhdGU7CiAgICBmdW5jdGlvbiB0cmFuc2ZlclBldChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDY0IF9wZXRJZCkgb25seVNFUkFQSElNIHB1YmxpYyByZXR1cm5zKFJlc3VsdENvZGUpOwogICAgZnVuY3Rpb24gb3duZXJQZXRUcmFuc2ZlciAoYWRkcmVzcyBfdG8sIHVpbnQ2NCBfcGV0SWQpICBwdWJsaWM7CiAgICBmdW5jdGlvbiBzZXRQZXROYW1lKHN0cmluZyBfbmFtZSwgdWludDY0IF9wZXRJZCkgcHVibGljOwoKICAgIC8vIHJlYWQKICAgIGZ1bmN0aW9uIGdldFBldENhcmRTZXJpZXModWludDggX3BldENhcmRTZXJpZXNJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDggcGV0Q2FyZFNlcmllc0lkLCB1aW50MzIgY3VycmVudFBldFRvdGFsLCB1aW50MzIgbWF4UGV0VG90YWwpOwogICAgZnVuY3Rpb24gZ2V0UGV0KHVpbnQgX3BldElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50IHBldElkLCB1aW50OCBwZXRDYXJkU2VyaWVzSWQsIHN0cmluZyBuYW1lLCB1aW50OCBsdWNrLCB1aW50MTYgYXVyYVJlZCwgdWludDE2IGF1cmFCbHVlLCB1aW50MTYgYXVyYVllbGxvdywgdWludDY0IGxhc3RUcmFpbmluZ1RpbWUsIHVpbnQ2NCBsYXN0QnJlZWRpbmdUaW1lLCBhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGdldE93bmVyUGV0Q291bnQoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0UGV0QnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludCBfaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0VG90YWxQZXRDYXJkU2VyaWVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGdldFRvdGFsUGV0cygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KTsKfQoKCgoKY29udHJhY3QgSUJhdHRsZWJvYXJkRGF0YSBpcyBBY2Nlc3NDb250cm9sICB7CgogIAoKICAgICAgLy8gd3JpdGUgZnVuY3Rpb25zCiAgCmZ1bmN0aW9uIGNyZWF0ZUJhdHRsZWJvYXJkKHVpbnQgcHJpemUsIHVpbnQ4IHJlc3RyaWN0aW9ucykgb25seVNFUkFQSElNIGV4dGVybmFsIHJldHVybnMgKHVpbnQxNik7CmZ1bmN0aW9uIGtpbGxNb25zdGVyKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCBtb25zdGVySWQpICBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CmZ1bmN0aW9uIGNyZWF0ZU51bGxUaWxlKHVpbnQxNiBfYmF0dGxlYm9hcmRJZCkgcHJpdmF0ZSA7CmZ1bmN0aW9uIGNyZWF0ZVRpbGUodWludDE2IF9iYXR0bGVib2FyZElkLCB1aW50OCBfdGlsZVR5cGUsIHVpbnQ4IF92YWx1ZSwgdWludDggX3Bvc2l0aW9uLCB1aW50MzIgX2hwLCB1aW50MTYgX3BldFBvd2VyLCB1aW50NjQgX2FuZ2VsSWQsIHVpbnQ2NCBfcGV0SWQsIGFkZHJlc3MgX293bmVyLCB1aW50OCBfdGVhbSkgb25seVNFUkFQSElNIGV4dGVybmFsICByZXR1cm5zICh1aW50OCk7CmZ1bmN0aW9uIGtpbGxUaWxlKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGFkZFRlYW10b0JvYXJkKHVpbnQxNiBiYXR0bGVib2FyZElkLCBhZGRyZXNzIG93bmVyLCB1aW50OCB0ZWFtKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CmZ1bmN0aW9uIHNldFRpbGVQb3NpdGlvbiAodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCwgdWludDggX3Bvc2l0aW9uVG8pIG9ubHlTRVJBUEhJTSBwdWJsaWMgOwpmdW5jdGlvbiBzZXRUaWxlSHAodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCwgdWludDMyIF9ocCkgb25seVNFUkFQSElNIGV4dGVybmFsIDsKZnVuY3Rpb24gYWRkTWVkYWxCdXJuZWQodWludDE2IGJhdHRsZWJvYXJkSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIHNldExhc3RNb3ZlVGltZSh1aW50MTYgYmF0dGxlYm9hcmRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsIDsKZnVuY3Rpb24gaXRlcmF0ZVR1cm4odWludDE2IGJhdHRsZWJvYXJkSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGtpbGxCb2FyZCh1aW50MTYgYmF0dGxlYm9hcmRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsIDsKZnVuY3Rpb24gY2xlYXJBbmdlbHNGcm9tQm9hcmQodWludDE2IGJhdHRsZWJvYXJkSWQpIHByaXZhdGU7Ci8vUmVhZCBmdW5jdGlvbnMKICAgICAKZnVuY3Rpb24gZ2V0VGlsZUhwKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQzMikgOwpmdW5jdGlvbiBnZXRNZWRhbHNCdXJuZWQodWludDE2IGJhdHRsZWJvYXJkSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldFRlYW0odWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgZXh0ZXJuYWwgcmV0dXJucyAodWludDgpIDsKZnVuY3Rpb24gZ2V0TWF4RnJlZVRlYW1zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KTsKZnVuY3Rpb24gZ2V0QmFycmllck51bSh1aW50MTYgYmF0dGxlYm9hcmRJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldFRpbGVGcm9tQmF0dGxlYm9hcmQodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IHRpbGVUeXBlLCB1aW50OCB2YWx1ZSwgdWludDggaWQsIHVpbnQ4IHBvc2l0aW9uLCB1aW50MzIgaHAsIHVpbnQxNiBwZXRQb3dlciwgdWludDY0IGFuZ2VsSWQsIHVpbnQ2NCBwZXRJZCwgYm9vbCBpc0xpdmUsIGFkZHJlc3Mgb3duZXIpICAgOwpmdW5jdGlvbiBnZXRUaWxlSURCeU93bmVyKHVpbnQxNiBiYXR0bGVib2FyZElkLCBhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldFBldGJ5VGlsZUlkKCB1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGlsZUlkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0KSA7CmZ1bmN0aW9uIGdldE93bmVyICh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGVhbSwgIHVpbnQ4IG93bmVyTnVtYmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChhZGRyZXNzKTsKZnVuY3Rpb24gZ2V0VGlsZUlEYnlQb3NpdGlvbih1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggcG9zaXRpb24pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCkgOwpmdW5jdGlvbiBnZXRQb3NpdGlvbkZyb21CYXR0bGVib2FyZCh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggX3Bvc2l0aW9uKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggdGlsZVR5cGUsIHVpbnQ4IHZhbHVlLCB1aW50OCBpZCwgdWludDggcG9zaXRpb24sIHVpbnQzMiBocCwgdWludDMyIHBldFBvd2VyLCB1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCBib29sIGlzTGl2ZSkgIDsKZnVuY3Rpb24gZ2V0QmF0dGxlYm9hcmQodWludDE2IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggdHVybiwgYm9vbCBpc0xpdmUsIHVpbnQgcHJpemUsIHVpbnQ4IG51bVRlYW1zLCB1aW50OCBudW1UaWxlcywgdWludDggY3JlYXRlZEJhcnJpZXJzLCB1aW50OCByZXN0cmljdGlvbnMsIHVpbnQgbGFzdE1vdmVUaW1lLCB1aW50OCBudW1UZWFtczEsIHVpbnQ4IG51bVRlYW1zMiwgdWludDggbW9uc3RlcjEsIHVpbnQ4IG1vbnN0ZXIyKSA7CmZ1bmN0aW9uIGlzQmF0dGxlYm9hcmRMaXZlKHVpbnQxNiBiYXR0bGVib2FyZElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CmZ1bmN0aW9uIGlzVGlsZUxpdmUodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgY29uc3RhbnQgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpIDsKZnVuY3Rpb24gZ2V0TGFzdE1vdmVUaW1lKHVpbnQxNiBiYXR0bGVib2FyZElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCkgOwpmdW5jdGlvbiBnZXROdW1UaWxlc0Zyb21Cb2FyZCAodWludDE2IF9iYXR0bGVib2FyZElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpIDsgCmZ1bmN0aW9uIGFuZ2VsT25CYXR0bGVib2FyZHModWludDY0IGFuZ2VsSUQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIDsKZnVuY3Rpb24gZ2V0VHVybih1aW50MTYgYmF0dGxlYm9hcmRJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIDsKZnVuY3Rpb24gZ2V0TnVtVGVhbXModWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRlYW0pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCk7CmZ1bmN0aW9uIGdldE1vbnN0ZXJzKHVpbnQxNiBCYXR0bGVib2FyZElkKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50OCBtb25zdGVyMSwgdWludDggbW9uc3RlcjIpIDsKZnVuY3Rpb24gZ2V0VG90YWxCYXR0bGVib2FyZHMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2KSA7CiAgCiAgICAgICAgCiAKICAgCn0KCmNvbnRyYWN0IElBY2Nlc3NvcnlEYXRhIGlzIEFjY2Vzc0NvbnRyb2wsIEVudW1zIHsKICAgIHVpbnQ4IHB1YmxpYyB0b3RhbEFjY2Vzc29yeVNlcmllczsgICAgCiAgICB1aW50MzIgcHVibGljIHRvdGFsQWNjZXNzb3JpZXM7CiAgICAKIAogICAgLyoqKiBGVU5DVElPTlMgKioqLwogICAgLy8qKiogV3JpdGUgQWNjZXNzICoqKi8vCiAgICBmdW5jdGlvbiBjcmVhdGVBY2Nlc3NvcnlTZXJpZXModWludDggX0FjY2Vzc29yeVNlcmllc0lkLCB1aW50MzIgX21heFRvdGFsLCB1aW50IF9wcmljZSkgb25seUNSRUFUT1IgcHVibGljIHJldHVybnModWludDgpIDsKCWZ1bmN0aW9uIHNldEFjY2Vzc29yeSh1aW50OCBfQWNjZXNzb3J5U2VyaWVzSWQsIGFkZHJlc3MgX293bmVyKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQpOwogICBmdW5jdGlvbiBhZGRBY2Nlc3NvcnlJZE1hcHBpbmcoYWRkcmVzcyBfb3duZXIsIHVpbnQ2NCBfYWNjZXNzb3J5SWQpIHByaXZhdGU7CglmdW5jdGlvbiB0cmFuc2ZlckFjY2Vzc29yeShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDY0IF9fYWNjZXNzb3J5SWQpIG9ubHlTRVJBUEhJTSBwdWJsaWMgcmV0dXJucyhSZXN1bHRDb2RlKTsKICAgIGZ1bmN0aW9uIG93bmVyQWNjZXNzb3J5VHJhbnNmZXIgKGFkZHJlc3MgX3RvLCB1aW50NjQgX19hY2Nlc3NvcnlJZCkgIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHVwZGF0ZUFjY2Vzc29yeUxvY2sgKHVpbnQ2NCBfYWNjZXNzb3J5SWQsIGJvb2wgbmV3VmFsdWUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHJlbW92ZUNyZWF0b3IoKSBvbmx5Q1JFQVRPUiBleHRlcm5hbDsKICAgIAogICAgLy8qKiogUmVhZCBBY2Nlc3MgKioqLy8KICAgIGZ1bmN0aW9uIGdldEFjY2Vzc29yeVNlcmllcyh1aW50OCBfYWNjZXNzb3J5U2VyaWVzSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4IGFjY2Vzc29yeVNlcmllc0lkLCB1aW50MzIgY3VycmVudFRvdGFsLCB1aW50MzIgbWF4VG90YWwsIHVpbnQgcHJpY2UpIDsKCWZ1bmN0aW9uIGdldEFjY2Vzc29yeSh1aW50IF9hY2Nlc3NvcnlJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCBhY2Nlc3NvcnlJRCwgdWludDggQWNjZXNzb3J5U2VyaWVzSUQsIGFkZHJlc3Mgb3duZXIpOwoJZnVuY3Rpb24gZ2V0T3duZXJBY2Nlc3NvcnlDb3VudChhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CglmdW5jdGlvbiBnZXRBY2Nlc3NvcnlCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50IF9pbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCkgOwogICAgZnVuY3Rpb24gZ2V0VG90YWxBY2Nlc3NvcnlTZXJpZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpIDsKICAgIGZ1bmN0aW9uIGdldFRvdGFsQWNjZXNzb3JpZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRBY2Nlc3NvcnlMb2NrU3RhdHVzKHVpbnQ2NCBfYWNlc3NvcnlJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpOwoKfQoKLy9UaGlzIGNvbnRyYWN0IGlzIHRvIE1hbmFnZSAob3BlbiwgY2xvc2UsIGFkZCB0ZWFtcywgZXRjKSBiYXR0bGVib2FyZHMuIENhbGwgdGhlIEJhdHRsZWJvYXJkcyBjb250cmFjdCB0byBtYWtlIG1vdmVzLiBCb3RoIG9mIHRoZXNlIGNvbnRyYWN0cyAKLy9pbnRlcmZhY2Ugd2l0aCB0aGUgYmF0dGxlYm9hcmRzIGRhdGEgY29udHJhY3QuIAoKY29udHJhY3QgTWFuYWdlQmF0dGxlYm9hcmRzIGlzIEFjY2Vzc0NvbnRyb2wsIFNhZmVNYXRoICB7CgogICAgLyoqKiBEQVRBIFRZUEVTICoqKi8KICAgIGFkZHJlc3MgcHVibGljIGFuZ2VsQ2FyZERhdGFDb250cmFjdCA9IDB4NkQyRTc2MjEzNjE1OTI1YzVmYzQzNjU2NUI1ZWU3ODhFZTBFODZEQzsKICAgIGFkZHJlc3MgcHVibGljIHBldENhcmREYXRhQ29udHJhY3QgPSAweEIzNDA2ODZkYTk5NmI4QjNkNDg2YjREMjdFMzhFMzg1MDBBOUU5MjY7CiAgICBhZGRyZXNzIHB1YmxpYyBhY2Nlc3NvcnlEYXRhQ29udHJhY3QgPSAweDQ2NmM0NDgxMjgzNWY1N2I3MzZlZjlGNjM1ODJiOGE2NjkzQTE0RDA7CiAgICBhZGRyZXNzIHB1YmxpYyBiYXR0bGVib2FyZERhdGFDb250cmFjdCA9IDB4MzMyMDE4MzE0OTYyMTdBNzc5YkY2MTY5MDM4REQ5MjMyNzcxZjE3OTsKCiAgIAogICAgCiAgICAvL1RoZSByZXNlcnZlZCBiYWxhbmNlIGlzIHRoZSB0b3RhbCBiYWxhbmNlIG91dHN0YW5kaW5nIG9uIGFsbCBvcGVuIGJhdHRsZWJvYXJkcy4gCiAgICAvL1dlIGtlZXAgdHJhY2sgb2YgdGhpcyBmaWd1cmUgdG8gcHJldmVudCB0aGUgZGV2ZWxvcGVycyBmcm9tIHB1bGxpbmcgb3V0IG1vbmV5IGN1cnJlbnRseSBwbGVkZ2VkCiAgICAvL1RoaXMgb25seSBmZWF0dXJlcyBpbiB0aGUgcGFpZCBib2FyZHMuIAogICAgdWludCBwdWJsaWMgY29udHJhY3RSZXNlcnZlZEJhbGFuY2U7CiAgICAKICAgIAogICAgLy9UaWxlIFRZUEVTCiAgICAvLyAwIC0gRW1wdHkgU3BhY2UKICAgIC8vIDEgLSBUZWFtIChBbmdlbCArIFBldCkKIAogICAgLy8gMyAtIFJlZCBCYXJyaWVyIChyZWQgaXMgaHVydCkKICAgIC8vIDQgLSBZZWxsb3cgYmFycmllciAoeWVsbG93IGlzIGh1cnQpCiAgICAvLyA1IC0gQmx1ZSBiYXJyaWVyIChibHVlIGlzIGh1cnQpCiAgICAvLyA2IC0gRXhwIEJvb3N0IChwZXJtYW5lbnQpCiAgICAvLyA3IC0gSFAgYm9vc3QgKHRlbXApCiAgICAvLyA4IC0gRXRoIGJvb3N0CiAgICAvLyA5IC0gV2FycAogICAgLy8gMTAgLSBNZWRhbAogICAgCiAgICAvL0F1cmEgQm9vc3RzCiAgICAvLyBSZWQgLSBTbG93IEJ1cm4gLSBFbmVtaWVzIGxvc2UgZXh0cmEgMTAgaHAvcm91bmQgaW4gYmF0dGxlLiAKICAgIC8vIEdyZWVuIC0gSGVhbGluZyBMaWdodCAtIDIwJSBjaGFuY2UgdG8gaGVhbCA1MCBocCBlYWNoIGJhdHRsZSByb3VuZAogICAgLy9ZZWxsb3cgLSBHdWlkaW5nIFBhdGggLSA1IGhwIHJlY292ZXJlZCBlYWNoIHR1cm4gbm90IGluIGEgYmF0dGxlCiAgICAvL1B1cnBsZSAtIFVuY29udHJvbGVkIEZ1cnkgLSAxMCUgY2hhbmNlIGZvciBzdWRkZW4ga2lsbCBhdCBzdGFydCBvZiBiYXR0bGUuIAogICAgLy9PcmFuZ2UgLSBSYWRpYW50IFBvd2VyIC0gKzEwMCBtYXggaHAgb24gam9pbmluZyBib2FyZC4gCiAgICAvL0JsdWUgLSBVbmR5aW5nIExvdmUgLSAzMCUgY2hhbmNlIHRvIHJldml2ZSBwZXQgd2hlbiBkZWFkLiAKICAgIAogICAgICAKICAgICAgICAgIC8vIFV0aWxpdHkgRnVuY3Rpb25zCiAgICBmdW5jdGlvbiBEYXRhQ29udGFjdHMoYWRkcmVzcyBfYW5nZWxDYXJkRGF0YUNvbnRyYWN0LCBhZGRyZXNzIF9wZXRDYXJkRGF0YUNvbnRyYWN0LCBhZGRyZXNzIF9hY2Nlc3NvcnlEYXRhQ29udHJhY3QsIGFkZHJlc3MgX2JhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KSBvbmx5Q1JFQVRPUiBleHRlcm5hbCB7CiAgICAgICAgYW5nZWxDYXJkRGF0YUNvbnRyYWN0ID0gX2FuZ2VsQ2FyZERhdGFDb250cmFjdDsKICAgICAgICBwZXRDYXJkRGF0YUNvbnRyYWN0ID0gX3BldENhcmREYXRhQ29udHJhY3Q7CiAgICAgICAgYWNjZXNzb3J5RGF0YUNvbnRyYWN0ID0gX2FjY2Vzc29yeURhdGFDb250cmFjdDsKICAgICAgICBiYXR0bGVib2FyZERhdGFDb250cmFjdCA9IF9iYXR0bGVib2FyZERhdGFDb250cmFjdDsKCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNoZWNrRXhpc3RzT3duZWRBbmdlbCAodWludDY0IGFuZ2VsSWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgCiAgICAgICAgaWYgKChhbmdlbElkIDw9IDApIHx8IChhbmdlbElkID4gYW5nZWxDYXJkRGF0YS5nZXRUb3RhbEFuZ2VscygpKSkge3JldHVybiBmYWxzZTt9CiAgICAgICAgYWRkcmVzcyBhbmdlbG93bmVyOwogICAgICAgICgsLCwsLCwsLCwsYW5nZWxvd25lcikgPSBhbmdlbENhcmREYXRhLmdldEFuZ2VsKGFuZ2VsSWQpOwogICAgICAgIGlmIChhbmdlbG93bmVyID09IG1zZy5zZW5kZXIpIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAgCiAgICAgICBlbHNlICByZXR1cm4gZmFsc2U7Cn0KICAKICAgIGZ1bmN0aW9uIGNoZWNrRXhpc3RzT3duZWRQZXQgKHVpbnQ2NCBwZXRJZCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICBJUGV0Q2FyZERhdGEgcGV0Q2FyZERhdGEgPSBJUGV0Q2FyZERhdGEocGV0Q2FyZERhdGFDb250cmFjdCk7CiAgICAgICAKICAgICAgICBpZiAoKHBldElkIDw9IDApIHx8IChwZXRJZCA+IHBldENhcmREYXRhLmdldFRvdGFsUGV0cygpKSkge3JldHVybiBmYWxzZTt9CiAgICAgICAgYWRkcmVzcyBwZXRvd25lcjsKICAgICAgICAgKCwsLCwsLCxwZXRvd25lcikgPSBwZXRDYXJkRGF0YS5nZXRQZXQocGV0SWQpOwogICAgICAgIGlmIChwZXRvd25lciA9PSBtc2cuc2VuZGVyKSB7cmV0dXJuIHRydWU7fQogICAgICAgIAogICAgICAgZWxzZSAgcmV0dXJuIGZhbHNlOwp9CgogICAgZnVuY3Rpb24gY2hlY2tFeGlzdHNPd25lZEFjY2Vzc29yeSAodWludDY0IGFjY2Vzc29yeUlkKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgIElBY2Nlc3NvcnlEYXRhIGFjY2Vzc29yeURhdGEgPSBJQWNjZXNzb3J5RGF0YShhY2Nlc3NvcnlEYXRhQ29udHJhY3QpOwogICAgICAgaWYgKGFjY2Vzc29yeUlkID09IDApIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAvL05vdCBzZW5kaW5nIGFuIGFjY2Vzc29yeSBpcyB2YWxpZC4gCiAgICAgICAgaWYgKChhY2Nlc3NvcnlJZCA8IDApIHx8IChhY2Nlc3NvcnlJZCA+IGFjY2Vzc29yeURhdGEuZ2V0VG90YWxBY2Nlc3NvcmllcygpKSkge3JldHVybiBmYWxzZTt9CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICAgKCwsb3duZXIpID0gYWNjZXNzb3J5RGF0YS5nZXRBY2Nlc3NvcnkoYWNjZXNzb3J5SWQpOwogICAgICAgIGlmIChvd25lciA9PSBtc2cuc2VuZGVyKSB7cmV0dXJuIHRydWU7fQogICAgICAgIAogICAgICAgZWxzZSAgcmV0dXJuIGZhbHNlOwp9CgoKIGZ1bmN0aW9uIHRha2VQZXQodWludDY0IHBldElkKSBwcml2YXRlIHsKICAgICAgICAgICAvL1RoaXMgY29udHJhY3QgdGFrZXMgb3duZXJzaGlwIG9mIHBldHMgd2hvIGFyZSBlbnRlcmVkIGludG8gYmF0dGxlYm9hcmRzIGFuZCBsYXRlciBkaXN0cmlidXRlcyB0aGUgbG9zZXJzJyBwZXRzIHRvIHRoZSB3aW5uZXJzLiAKICAgICAgICAgICAgICAgSVBldENhcmREYXRhIFBldENhcmREYXRhID0gSVBldENhcmREYXRhKHBldENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgICAgICAgUGV0Q2FyZERhdGEudHJhbnNmZXJQZXQobXNnLnNlbmRlciwgYWRkcmVzcyh0aGlzKSwgcGV0SWQpOwogICAgICAgIH0KICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgIGZ1bmN0aW9uIHJlc3RyaWN0aW9uc0FsbG93KHVpbnQ2NCBhbmdlbElkLCB1aW50OCByZXN0cmljdGlvbnMpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgLy9UaGlzIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZSBpZiB0aGUgcmVzdHJpY3Rpb25zIG9mIHRoZSBib2FyZCBhbGxvdyB0aGUgYW5nZWwgYW5kIGZhbHNlIGlmIG5vdC4gQmFzaWNhbGx5CiAgICAgICAvL0FuZ2VsIGNhcmQgc2VyaWVzIElEcyBnZXQgc3Ryb25nZXIgQlAgb3ZlciB0aW1lLCB3aXRoIHRoZSBleGNlcHRpb24gb2YgTWljaGFlbCBhbmQgTHVjaWZlci4gCiAgICAgICAvL05vdGU6IFphZGtpZWwgaXMgYWxsb3dlZCBvbiBib2FyZHMgd2hlcmUgc2hlIG1pZ2h0IGJlIHN0cm9uZ2VyIC0gdGhpcyBpcyBhIHJhcmUgY2FzZSB0aGF0IHdpbGwgYmFsYW5jZSBhZ2FpbnN0CiAgICAgICAvL0VWRVJZIHBsYXllciBuZWVkaW5nIHRvIHBheSB0aGlzIGdhcyB0byBjaGVjayBldmVyeSB0aW1lIEFOWSBhbmdlbCBpcyBhZGRlZCB0byB0aGUgYm9hcmQuIAogICAgICAgCiAgICAgICAgSUFuZ2VsQ2FyZERhdGEgYW5nZWxDYXJkRGF0YSA9IElBbmdlbENhcmREYXRhKGFuZ2VsQ2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgdWludDggYW5nZWxDYXJkU2VyaWVzOwogICAgICAgICgsYW5nZWxDYXJkU2VyaWVzLCwsLCwsLCwsKSA9IGFuZ2VsQ2FyZERhdGEuZ2V0QW5nZWwoYW5nZWxJZCk7CiAgICAgICAgCiAgICAgICAgaWYgKGFuZ2VsQ2FyZFNlcmllcyA+IHJlc3RyaWN0aW9ucykge3JldHVybiBmYWxzZTt9CiAgICAgICAgaWYgKChhbmdlbENhcmRTZXJpZXMgPT0gMikgJiYgKHJlc3RyaWN0aW9ucyA8IDE5KSkge3JldHVybiBmYWxzZTt9IC8vTHVjaWZlciBDYXJkIAogICAgICAgIGlmICgoYW5nZWxDYXJkU2VyaWVzID09IDMpICYmIChyZXN0cmljdGlvbnMgPCAyMSkpIHtyZXR1cm4gZmFsc2U7fSAvL01pY2hhZWwgQ2FyZAogICAgICAgIHJldHVybiB0cnVlOwogICAgICAgfQogICAgICAgCiAgICAgICAKICAgICAgIC8vT3BlbmluZyBhbmQgQ2xvc2luZyBGdW5jdGlvbnMKICAgICAgCiAgCiAgICAgICBmdW5jdGlvbiBjcmVhdGVCYXR0bGVib2FyZCh1aW50OCByZXN0cmljdGlvbnMpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgICAgaWYgKHJlc3RyaWN0aW9ucyA8MCkge3JldmVydCgpO30KICAgICAgICAgICBJQmF0dGxlYm9hcmREYXRhIGJhdHRsZWJvYXJkRGF0YSA9IElCYXR0bGVib2FyZERhdGEoYmF0dGxlYm9hcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgIHJldHVybiBiYXR0bGVib2FyZERhdGEuY3JlYXRlQmF0dGxlYm9hcmQobXNnLnZhbHVlLCByZXN0cmljdGlvbnMpOwogICAgICAgICAgIAogICAgICAgfQogICAgICAgCiAgICAgICAgZnVuY3Rpb24gY2xvc2VCYXR0bGVib2FyZCh1aW50MTYgYmF0dGxlYm9hcmRJZCkgZXh0ZXJuYWwgewogICAgICAgLy9UaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgYnkgQU5ZT05FIG9uY2UgZWl0aGVyIHRlYW0gMSBvciB0ZWFtIDIgaGFzIG5vIG1vcmUgdGVhbSBtZW1iZXJzIGxlZnQuIAogICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgYWRkcmVzc1tdIHN0b3JhZ2Ugd2lubmVyczsKICAgICAgIGlmIChiYXR0bGVib2FyZERhdGEuaXNCYXR0bGVib2FyZExpdmUoYmF0dGxlYm9hcmRJZCkgPT0gZmFsc2UpIHtyZXZlcnQoKTt9CiAgICAgICBiYXR0bGVib2FyZERhdGEua2lsbEJvYXJkKGJhdHRsZWJvYXJkSWQpOyAKICAgICAgICBpZiAoKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDEpICE9IDApICYmIChiYXR0bGVib2FyZERhdGEuZ2V0TnVtVGVhbXMoYmF0dGxlYm9hcmRJZCwyKSAhPSAwKSkge3JldmVydCgpO30KICAgICAgICAvL05vIHRlYW1zIGFyZSBvdXQsIGZ1bmN0aW9uIHNob3VsZG4ndCBiZSBjYWxsZWQuIAogICAgICAgIHVpbnQ4IGlkOwogICAgICAgIHVpbnQ2NCBwZXRJZDsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIGlmICgoYmF0dGxlYm9hcmREYXRhLmdldE51bVRlYW1zKGJhdHRsZWJvYXJkSWQsMSkgPT0gMCkgJiYgKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDIpID09IDApKSB7CiAgICAgICAgICAgICAgLy9Tb21ldGhpbmcgb2RkIGhhcHBlbmVkIGFuZCBCT1RIIHRlYW1zIGhhdmUgbG9zdCAtIHRoaXMgaXMgYSB0aWUuIAogICAgICAgICAgICAgIElQZXRDYXJkRGF0YSBQZXRDYXJkRGF0YSA9IElQZXRDYXJkRGF0YShwZXRDYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgICBmb3IgKHVpbnQ4IGkgPTA7IGk8YmF0dGxlYm9hcmREYXRhLmdldE1heEZyZWVUZWFtcygpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgb3duZXIgPSBiYXR0bGVib2FyZERhdGEuZ2V0T3duZXIoYmF0dGxlYm9hcmRJZCwgMCwgaSk7CiAgICAgICAgICAgICAgICAgIGlkID0gYmF0dGxlYm9hcmREYXRhLmdldFRpbGVJREJ5T3duZXIoYmF0dGxlYm9hcmRJZCxvd25lcik7CiAgICAgICAgICAgICAgICAgcGV0SWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0UGV0YnlUaWxlSWQoYmF0dGxlYm9hcmRJZCwgaWQpOwogICAgICAgICAgICAgICAgIFBldENhcmREYXRhLnRyYW5zZmVyUGV0KGFkZHJlc3ModGhpcyksIG93bmVyLCBwZXRJZCk7CiAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgIGlmICgoYmF0dGxlYm9hcmREYXRhLmdldE51bVRlYW1zKGJhdHRsZWJvYXJkSWQsMSkgIT0gMCkgJiYgKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDIpID09IDApKSB7CiAgICAgICAvL1RlYW0gMSB3b24gCiAgICAgICAKICAgICAgIC8vR2l2ZSB0ZWFtIDEgYmFjayB0aGVpciBwZXRzLiAKICAgICAgICBmb3IgKGkgPTA7IGk8KHNhZmVEaXYoYmF0dGxlYm9hcmREYXRhLmdldE1heEZyZWVUZWFtcygpLDIpKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIG93bmVyID0gYmF0dGxlYm9hcmREYXRhLmdldE93bmVyKGJhdHRsZWJvYXJkSWQsIDEsIGkpOwogICAgICAgICAgICAgICAgICBpZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURCeU93bmVyKGJhdHRsZWJvYXJkSWQsb3duZXIpOwogICAgICAgICAgICAgICAgIHBldElkID0gYmF0dGxlYm9hcmREYXRhLmdldFBldGJ5VGlsZUlkKGJhdHRsZWJvYXJkSWQsIGlkKTsKICAgICAgICAgICAgICAgICBQZXRDYXJkRGF0YS50cmFuc2ZlclBldChhZGRyZXNzKHRoaXMpLCBvd25lciwgcGV0SWQpOwogICAgICAgICAgICAgICAgd2lubmVycy5wdXNoKG93bmVyKTsgCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAvL2dpdmUgdGVhbSAyJ3MgcGV0cyB0byB0ZWFtIDEuICAgCiAgICAgICAgZm9yIChpID0wOyBpPChzYWZlRGl2KGJhdHRsZWJvYXJkRGF0YS5nZXRNYXhGcmVlVGVhbXMoKSwyKSk7IGkrKykgewogICAgICAgICAgICAgICAgICBvd25lciA9IGJhdHRsZWJvYXJkRGF0YS5nZXRPd25lcihiYXR0bGVib2FyZElkLCAyLCBpKTsKICAgICAgICAgICAgICAgICAgaWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEQnlPd25lcihiYXR0bGVib2FyZElkLG93bmVyKTsKICAgICAgICAgICAgICAgICBwZXRJZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRQZXRieVRpbGVJZChiYXR0bGVib2FyZElkLCBpZCk7CiAgICAgICAgICAgICAgICAgUGV0Q2FyZERhdGEudHJhbnNmZXJQZXQoYWRkcmVzcyh0aGlzKSwgd2lubmVyc1tpXSwgcGV0SWQpOwogICAgICAgICAgICAgIH0gICAgCiAgICAgICB9CiAgICAgICAgICBpZiAoKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDEpID09IDApICYmIChiYXR0bGVib2FyZERhdGEuZ2V0TnVtVGVhbXMoYmF0dGxlYm9hcmRJZCwyKSAhPSAwKSkgewogICAgICAgLy9UZWFtIDIgd29uIAogICAgICAgCiAgICAgICAvL0dpdmUgdGVhbSAyIGJhY2sgdGhlaXIgcGV0cy4gCiAgICAgICAgZm9yIChpID0wOyBpPChzYWZlRGl2KGJhdHRsZWJvYXJkRGF0YS5nZXRNYXhGcmVlVGVhbXMoKSwyKSk7IGkrKykgewogICAgICAgICAgICAgICAgICBvd25lciA9IGJhdHRsZWJvYXJkRGF0YS5nZXRPd25lcihiYXR0bGVib2FyZElkLCAyLCBpKTsKICAgICAgICAgICAgICAgICAgaWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEQnlPd25lcihiYXR0bGVib2FyZElkLG93bmVyKTsKICAgICAgICAgICAgICAgICBwZXRJZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRQZXRieVRpbGVJZChiYXR0bGVib2FyZElkLCBpZCk7CiAgICAgICAgICAgICAgICAgUGV0Q2FyZERhdGEudHJhbnNmZXJQZXQoYWRkcmVzcyh0aGlzKSwgb3duZXIsIHBldElkKTsKICAgICAgICAgICAgICAgIHdpbm5lcnMucHVzaChvd25lcik7IAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9naXZlIHRlYW0gMSdzIHBldHMgdG8gdGVhbSAyICAKICAgICAgICBmb3IgKGkgPTA7IGk8KHNhZmVEaXYoYmF0dGxlYm9hcmREYXRhLmdldE1heEZyZWVUZWFtcygpLDIpKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIG93bmVyID0gYmF0dGxlYm9hcmREYXRhLmdldE93bmVyKGJhdHRsZWJvYXJkSWQsIDEsIGkpOwogICAgICAgICAgICAgICAgICBpZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURCeU93bmVyKGJhdHRsZWJvYXJkSWQsb3duZXIpOwogICAgICAgICAgICAgICAgIHBldElkID0gYmF0dGxlYm9hcmREYXRhLmdldFBldGJ5VGlsZUlkKGJhdHRsZWJvYXJkSWQsIGlkKTsKICAgICAgICAgICAgICAgICBQZXRDYXJkRGF0YS50cmFuc2ZlclBldChhZGRyZXNzKHRoaXMpLCB3aW5uZXJzW2ldLCBwZXRJZCk7CiAgICAgICAgICAgICAgfSAgICAKICAgICAgIH0KICAgfQogICAgICAgCiAgIAogICAgICAgIGZ1bmN0aW9uIGdldEluaXRpYWxIUCAodWludDY0IGFuZ2VsSWQsIHVpbnQ2NCBwZXRJZCwgdWludDY0IGFjY2Vzc29yeUlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDMyIGhwLCB1aW50MTYgcGV0QXVyYUNvbXBvc2l0ZSkgewogICAgICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgIAogICAgICAgICAgIC8vbmVlZCB0byByZXVzZSBsb2NhbCB2YXJpYWJsZXMgdG8gYXZvaWQgc3RhY2sgdG9vIGRlZXA7CiAgICAgICAgICAgdWludDE2IHRlbXA7CiAgICAgICAgICAgdWludDE2IHRlbXBDb21wb3NpdGU7CiAgICAgICAgICAgdWludDggYXVyYTsKICAgICAgICAgICAoLCx0ZW1wLGF1cmEsLCwsLCwsKSA9IGFuZ2VsQ2FyZERhdGEuZ2V0QW5nZWwoYW5nZWxJZCk7CiAgICAgICAgICAgaWYgKGF1cmEgPT0gMykge3RlbXAgKz0gMTAwO30gLy9wbHVzIDEwMCBpbml0aWFsIEhQIHRvIG9yYW5nZSBhdXJhIGFuZ2Vscy4gCiAgICAgICAgICAgdGVtcENvbXBvc2l0ZSA9IHRlbXA7CiAgICAgICAgICAgLy9maXJzdCBhZGQgYmF0dGxlUG93ZXI7CiAgICAgICAgICAgKCwsLCx0ZW1wLCwsLCwsKSA9IGFuZ2VsQ2FyZERhdGEuZ2V0QW5nZWwoYW5nZWxJZCk7CiAgICAgICAgICAgdGVtcENvbXBvc2l0ZSArPSB0ZW1wOwogICAgICAgICAgIC8vbm93IHRlbXAgaXMgZXhwZXJpZW5jZQogICAgICAgICAgICB1aW50OCBwZXRBdXJhQ29sb3I7CiAgICAgICAgICAgICAocGV0QXVyYUNvbXBvc2l0ZSwgcGV0QXVyYUNvbG9yKSA9IGZpbmRBdXJhQ29tcG9zaXRlIChwZXRJZCwgYWNjZXNzb3J5SWQpOwogICAgICAgICAgICBocCA9IChhdXJhc0NvbXBhdGlibGUoYW5nZWxJZCxwZXRBdXJhQ29sb3IpKyBwZXRBdXJhQ29tcG9zaXRlICsgdGVtcENvbXBvc2l0ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgCiAgICAgICBmdW5jdGlvbiBhZGRUZWFtMSh1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCB1aW50NjQgYWNjZXNzb3J5SWQsIHVpbnQxNiBiYXR0bGVib2FyZElkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAgICAvL2NhbGwgdGhpcyBmdW5jdGlvbiB0byBhZGQgeW91ciBhbmdlbC9wZXQvYWNjZXNzb3J5IHRvIHRlYW0gMS4gCiAgICAgICAgICAgY2hlY2tUZWFtVG9BZGQoYW5nZWxJZCxwZXRJZCxhY2Nlc3NvcnlJZCk7CiAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGJhdHRsZWJvYXJkIGlzIGZ1bGwvb3BlbiBmaXJzdCBhbmQgc2VlIHdoZXJlIHRoZSBuZXcgdGVzbSBzaG91bGQgYmUgcGxhY2VkLiAKICAgICAgICAgICB1aW50MzIgaHA7CiAgICAgICAgICAgdWludDE2IHBldFBvd2VyOwogICAgICAgICAgIHVpbnQxNiBzcGVlZCA9IGdldFNwZWVkKHBldElkLGFjY2Vzc29yeUlkKTsKICAgICAgICAgICAoaHAsIHBldFBvd2VyKSA9IGdldEluaXRpYWxIUChhbmdlbElkLHBldElkLCBhY2Nlc3NvcnlJZCk7CiAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLmNyZWF0ZVRpbGUoYmF0dGxlYm9hcmRJZCwgMSwgdWludDgoc3BlZWQpLCBnZXROZXdUZWFtUG9zaXRpb25BbmRDaGVjayhiYXR0bGVib2FyZElkLCAxLCBhbmdlbElkKSwgaHAsIHBldFBvd2VyICsgc3BlZWQsYW5nZWxJZCwgcGV0SWQsIG1zZy5zZW5kZXIsIDEpOwogICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5hZGRUZWFtdG9Cb2FyZChiYXR0bGVib2FyZElkLCBtc2cuc2VuZGVyLDEpOwogICAgICAgICAgIC8vbm93IGFkZCBvbmUgcmFuZG9tIHRpbGUgdG8gdGhlIGJvYXJkLiAKICAgICAgICAgICBhZGRSYW5kb21UaWxlKGJhdHRsZWJvYXJkSWQsIDEpOwogICAgICAgICAgIHRha2VQZXQocGV0SWQpOwogICAgICAgfQogICAgICAgCiAgICAgICAgICBmdW5jdGlvbiBhZGRUZWFtMih1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCB1aW50NjQgYWNjZXNzb3J5SWQsIHVpbnQxNiBiYXR0bGVib2FyZElkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAgICAKICAgICAgICAgICBjaGVja1RlYW1Ub0FkZChhbmdlbElkLHBldElkLGFjY2Vzc29yeUlkKTsKICAgICAgICAgICAgSUJhdHRsZWJvYXJkRGF0YSBiYXR0bGVib2FyZERhdGEgPSBJQmF0dGxlYm9hcmREYXRhKGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgLy8gY2hlY2sgaWYgYmF0dGxlYm9hcmQgaXMgZnVsbC9vcGVuIGZpcnN0IGFuZCBzZWUgd2hlcmUgdGhlIG5ldyB0ZXNtIHNob3VsZCBiZSBwbGFjZWQuIAogICAgICAgICAgIHVpbnQzMiBocDsKICAgICAgICAgICB1aW50MTYgcGV0UG93ZXI7CiAgICAgICAgICAgdWludDE2IHNwZWVkID0gZ2V0U3BlZWQocGV0SWQsYWNjZXNzb3J5SWQpOwogICAgICAgICAgIChocCwgcGV0UG93ZXIpID0gZ2V0SW5pdGlhbEhQKGFuZ2VsSWQscGV0SWQsIGFjY2Vzc29yeUlkKTsKICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuY3JlYXRlVGlsZShiYXR0bGVib2FyZElkLCAxLCB1aW50OChzcGVlZCksIGdldE5ld1RlYW1Qb3NpdGlvbkFuZENoZWNrKGJhdHRsZWJvYXJkSWQsIDIsIGFuZ2VsSWQpLCBocCwgcGV0UG93ZXIgKyBzcGVlZCxhbmdlbElkLCBwZXRJZCwgbXNnLnNlbmRlciwgMik7CiAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLmFkZFRlYW10b0JvYXJkKGJhdHRsZWJvYXJkSWQsIG1zZy5zZW5kZXIsMik7CiAgICAgICAgICAgLy9ub3cgYWRkIG9uZSByYW5kb20gdGlsZSB0byB0aGUgYm9hcmQuIAogICAgICAgICAgIGFkZFJhbmRvbVRpbGUoYmF0dGxlYm9hcmRJZCwgMSk7CiAgICAgICAgICAgdGFrZVBldChwZXRJZCk7CiAgICAgICB9CiAgICAgICAKICAgICAgIGZ1bmN0aW9uIGdldFNwZWVkKHVpbnQ2NCBwZXRJZCwgdWludDY0IGFjY2Vzc29yeUlkKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNikgewogICAgICAgICAgIC8vdGhpcyBzcGVlZCBmdW5jdGlvbiByZXR1cm5zIHBldCdzIGJhc2UgTHVjayArIGFueSBhY2Nlc3NvcnkgYm9vc3QgZnJvbSB0aGUgY2xvdmVyczsKICAgICAgICAgICBJQWNjZXNzb3J5RGF0YSBhY2Nlc3NvcnlEYXRhID0gSUFjY2Vzc29yeURhdGEoYWNjZXNzb3J5RGF0YUNvbnRyYWN0KTsKICAgICAgICAgICBJUGV0Q2FyZERhdGEgcGV0Q2FyZERhdGEgPSBJUGV0Q2FyZERhdGEocGV0Q2FyZERhdGFDb250cmFjdCk7CgogICAgICAgdWludDE2IHRlbXA7CiAgICAgICB1aW50OCBhY2Nlc3NvcnlTZXJpZXNJZDsKICAgICAgICAgKCwsLHRlbXAsLCwsLCwpID0gcGV0Q2FyZERhdGEuZ2V0UGV0KHBldElkKTsKICAgICAgICAgLy9maXJzdCBnZXQgdGhlIHBldCdzIGJhc2UgbHVjay4gCiAgICAgICAgICAgKCxhY2Nlc3NvcnlTZXJpZXNJZCwpID0gYWNjZXNzb3J5RGF0YS5nZXRBY2Nlc3NvcnkoYWNjZXNzb3J5SWQpOwogICAgICAgICAgIGlmIChhY2Nlc3NvcnlTZXJpZXNJZCA9PSA1KSB7dGVtcCArPSA1O30KICAgICAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lkID09IDYpIHt0ZW1wICs9IDEwO30KICAgICAgICAgICAgcmV0dXJuIHRlbXA7CiAgCiAgICAgICB9CiAgICAgICAgICAKICAgICAgICBmdW5jdGlvbiBnZXROZXdUZWFtUG9zaXRpb25BbmRDaGVjayAodWludDE2IGJhdHRsZWJvYXJkSWQsdWludDggdGVhbSwgdWludDY0IGFuZ2VsSWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgSUJhdHRsZWJvYXJkRGF0YSBiYXR0bGVib2FyZERhdGEgPSBJQmF0dGxlYm9hcmREYXRhKGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgdWludDggbnVtVGVhbXMxOwogICAgICAgICAgICB1aW50OCBudW1UZWFtczI7CiAgICAgICAgICAgICB1aW50OCBwb3NpdGlvbjsKICAgICAgICAgICAgIHVpbnQ4IHJlc3RyaWN0aW9uczsKICAgICAgICAgICAgYm9vbCBpc0xpdmU7CiAgICAgICAgCiAgICAgICAgICAgLy9Ob3cgc2VlIHdoaWNoIHRpbGUgdG8gYWRkIHRoZSBuZXcgdGVhbS4gVGVhbXMgYXJlIGFkZGVkIGluIGEgc3BlY2lmaWVkIHBsYWNlIGJlc2VkIG9uIHdoZW4gdGhleSBqb2luLiAKICAgICAgICAgICAgICgsaXNMaXZlLCwsLCxyZXN0cmljdGlvbnMsLCBudW1UZWFtczEsbnVtVGVhbXMyLCwpID0gYmF0dGxlYm9hcmREYXRhLmdldEJhdHRsZWJvYXJkKGJhdHRsZWJvYXJkSWQpOwogICAgICAgICAgICAgICAKICAgICAgICAgICAgIGlmIChyZXN0cmljdGlvbnNBbGxvdyhhbmdlbElkLCByZXN0cmljdGlvbnMpID09IGZhbHNlKSB7cmV2ZXJ0KCk7fSAKICAgICAgICAgICAgaWYgKGlzTGl2ZT09IHRydWUpIHtyZXZlcnQoKTt9IC8vQ2FuJ3QgYWRkIGEgdGVhbSB0byBhIGJvYXJkIHRoYXQncyBhbHJlYWR5IGxpdmUuCiAgICAgICAgICAgICBpZiAodGVhbSA9PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAobnVtVGVhbXMxID09IDApIHtwb3NpdGlvbiA9IDEwO30KICAgICAgICAgICAgICAgaWYgKG51bVRlYW1zMSA9PTEpIHtwb3NpdGlvbiA9IDEyO30KICAgICAgICAgICAgICAgaWYgKG51bVRlYW1zMSA9PSAyKSB7cG9zaXRpb24gPSAxNDt9CiAgICAgICAgICAgICAgIGlmIChudW1UZWFtczEgPj0zKSB7cmV2ZXJ0KCk7fQogICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHRlYW0gPT0gMikgewogICAgICAgICAgICAgICBpZiAobnVtVGVhbXMyID09IDApIHtwb3NpdGlvbiA9IDUwO30KICAgICAgICAgICAgICAgaWYgKG51bVRlYW1zMiA9PSAxKSB7cG9zaXRpb24gPSA1Mjt9CiAgICAgICAgICAgICAgIGlmIChudW1UZWFtczIgPT0gMikge3Bvc2l0aW9uID0gNTQ7fQogICAgICAgICAgICAgICBpZiAobnVtVGVhbXMyID49Mykge3JldmVydCgpO30KICAgICAgICAgICB9CiAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uOwogICAgICAgIH0gIAogICAgICAgICAgCiAgICAgICAgICBmdW5jdGlvbiBjaGVja1RlYW1Ub0FkZCh1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCB1aW50NjQgYWNjZXNzb3J5SWQpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgICAgICAgICBpZiAoKGNoZWNrRXhpc3RzT3duZWRBbmdlbChhbmdlbElkKSA9PSBmYWxzZSkgfHwgKGNoZWNrRXhpc3RzT3duZWRQZXQocGV0SWQpPT0gZmFsc2UpIHx8IChjaGVja0V4aXN0c093bmVkQWNjZXNzb3J5KGFjY2Vzc29yeUlkKSA9PSBmYWxzZSkpIHtyZXZlcnQoKTt9CiAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICAgICAgIAogICAgICAgICAgICAgZnVuY3Rpb24gYWRkUmFuZG9tVGlsZSh1aW50MTYgX2JhdHRsZWJvYXJkSWQsIHVpbnQ4IHNlZWQpIHByaXZhdGUgIHsKICAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAKICAgICAgICAgICB1aW50OCBuZXdUaWxlVHlwZTsKICAgICAgICAgICB1aW50OCBuZXdUaWxlUG93ZXI7CiAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAgLy9UaWxlIFRZUEVTCiAgICAvLyAwIC0gRW1wdHkgU3BhY2UKICAgIC8vIDEgLSBUZWFtIChBbmdlbCArIFBldCkKICAgIC8vIDMgLSBSZWQgQmFycmllciAocmVkIGlzIGh1cnQpCiAgICAvLyA0IC0gWWVsbG93IGJhcnJpZXIgKHllbGxvdyBpcyBodXJ0KQogICAgLy8gNSAtIEJsdWUgYmFycmllciAoYmx1ZSBpcyBodXJ0KQogICAgLy8gNiAtIEV4cCBCb29zdCAocGVybWFuZW50KQogICAgLy8gNyAtIEhQIGJvb3N0ICh0ZW1wKQogICAgLy8gOCAtIEV0aCBib29zdAogICAgLy8gOSAtIFdhcnAKICAgIC8vIDEwIC0gTWVkYWwKICAgIC8vIDExIC0gUGV0IHBlcm1hbmVudCBBdXJhIGJvb3N0IHJhbmRvbSBjb2xvcgogICAgCiAgICAgICAgICAgCiAgICAgICAgICAgdWludDggY2hhbmNlID0gZ2V0UmFuZG9tTnVtYmVyKDEwMCwwLHNlZWQpOwogICAgICAgICAgICAgCiAgICAgICAgICAgICAgaWYgKGNoYW5jZSA8PTMwKSAgewogICAgICAgICAgICAgICAgLy9CYXJyaWVyIHRpbGUKICAgICAgICAgICAgICAgIG5ld1RpbGVUeXBlID0gZ2V0UmFuZG9tTnVtYmVyKDUsMyxzZWVkKTsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcigzMCwxMCxzZWVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKChjaGFuY2UgPj0zMCkgJiYgKGNoYW5jZSA8NTApKSB7CiAgICAgICAgICAgICAgICAvL0hQIGJvb3N0CiAgICAgICAgICAgICAgICBuZXdUaWxlVHlwZSA9IDc7CiAgICAgICAgICAgICAgICBuZXdUaWxlUG93ZXIgPSBnZXRSYW5kb21OdW1iZXIoNDUsMTUsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIGlmICgoY2hhbmNlID49NTApICYmIChjaGFuY2UgPDYwKSkgewogICAgICAgICAgICAgICAgLy9FWFAgYm9vc3QKICAgICAgICAgICAgICAgIG5ld1RpbGVUeXBlID0gNjsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcig1LDEsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChjaGFuY2UgPj02MCkgJiYgKGNoYW5jZSA8ODApKSB7CiAgICAgICAgICAgICAgICAvL1dhcnAKICAgICAgICAgICAgICAgIG5ld1RpbGVUeXBlID0gOTsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcig2NCwxLHNlZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoY2hhbmNlID49ODApICYmIChjaGFuY2UgPDkwKSkgewogICAgICAgICAgICAgICAgLy9NZWRhbAogICAgICAgICAgICAgICAgbmV3VGlsZVR5cGUgPSAxMDsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcigyLDAsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNoYW5jZSA+PTkwKSB7CiAgICAgICAgICAgICAgICAvL1BldCBBdXJhIGJvb3N0IAogICAgICAgICAgICAgICAgbmV3VGlsZVR5cGUgPSAxMTsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcig0LDEsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgdWludDggcG9zaXRpb24gPSBnZXRSYW5kb21OdW1iZXIoNDksMTUsc2VlZCk7CiAgICAgICAgICAvL2lmIGRlc2lkZWQgcG9zaXRpb24gaXMgYWxyZWFkeSBmdWxsLCB0cnkgdGhyZWUgdGltZXMgdG8gcGxhY2UgdGhlbSBpbiBhbiBvcGVuIHNwb3QuIE9kZHMgYXJlIG1heCAwLjYlIHRoYXQgdGhlIHR4IHJldmVydHMuIAogICAgICAgICAgLy9SYW5kb20gdGlsZXMgYXJlIGluIHRoZSBtaWRkbGUgb2YgdGhlIGJvYXJkIGFuZCB3b24ndCBjb25mbGljdCB3aXRoIGFuYW5nZWxzLiAKICAgICAgICAgIC8vUmFuZG9tIHRpZWxzIENBTiBiZSBvbiB0aGUgc2FtZSBwb3NpdGlvbiBhcyBhIG1vbnN0ZXIsIHRob3VnaC4gCiAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKF9iYXR0bGVib2FyZElkLCBwb3NpdGlvbikhPSAwKSB7CiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgcG9zaXRpb24gPSBnZXRSYW5kb21OdW1iZXIoNDksMTUsbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKF9iYXR0bGVib2FyZElkLCBwb3NpdGlvbikhPSAwKSB7CiAgICAgICAgICAgICAgIHBvc2l0aW9uID0gZ2V0UmFuZG9tTnVtYmVyKDQ5LDE1LG1zZy5zZW5kZXIpOwogICAgICAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKF9iYXR0bGVib2FyZElkLCBwb3NpdGlvbikhPSAwKSB7IAogICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSBnZXRSYW5kb21OdW1iZXIoNDksMTUsbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICBpZiAoYmF0dGxlYm9hcmREYXRhLmdldFRpbGVJRGJ5UG9zaXRpb24oX2JhdHRsZWJvYXJkSWQsIHBvc2l0aW9uKSE9IDApIHtyZXZlcnQoKTt9CiAgICAgICAgICAgICAgfQogICAgICAgICAgIH0KICAgICAgICAgICB9CiAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5jcmVhdGVUaWxlKF9iYXR0bGVib2FyZElkLG5ld1RpbGVUeXBlLCBuZXdUaWxlUG93ZXIsIHBvc2l0aW9uLCAwLCAwLCAwLCAwLCBhZGRyZXNzKHRoaXMpLDApOwogICAgICAgfQogICAgICAgCiAgICAgICBmdW5jdGlvbiBhdXJhc0NvbXBhdGlibGUodWludDY0IGFuZ2VsMUlELCB1aW50OCAgX3BldEF1cmFDb2xvciApIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgdWludDggY29tcGF0aWJpbGl0eSA9IDA7CiAgICAgICAgICAgIAogICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgdWludDggX2FuZ2VsMUF1cmE7CiAgICAgICAgICgsLCxfYW5nZWwxQXVyYSwsLCwsLCwpID0gYW5nZWxDYXJkRGF0YS5nZXRBbmdlbChhbmdlbDFJRCk7CiAgICAgICAgICAgIGlmIChfcGV0QXVyYUNvbG9yID09IDEpIHsKICAgICAgICAgICAgICAgIGlmICgoX2FuZ2VsMUF1cmEgPT0gMikgfHwgKF9hbmdlbDFBdXJhID09IDMpIHx8IChfYW5nZWwxQXVyYSA9PSA0KSkge2NvbXBhdGliaWxpdHkrKzt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9wZXRBdXJhQ29sb3IgPT0gMikgewogICAgICAgICAgICAgICAgaWYgKChfYW5nZWwxQXVyYSA9PSAwKSB8fCAoX2FuZ2VsMUF1cmEgPT0gMikgfHwgKF9hbmdlbDFBdXJhID09IDUpKSB7Y29tcGF0aWJpbGl0eSsrO30KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3BldEF1cmFDb2xvciA9PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAoKF9hbmdlbDFBdXJhID09IDEpIHx8IChfYW5nZWwxQXVyYSA9PSAzKSB8fCAoX2FuZ2VsMUF1cmEgPT0gNSkpIHtjb21wYXRpYmlsaXR5Kys7fQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbXBhdGliaWxpdHkqMTI7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBmaW5kQXVyYUNvbXBvc2l0ZSh1aW50NjQgcGV0MUlELCB1aW50NjQgYWNjZXNzb3J5SWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDE2IGNvbXBvc2l0ZSwgdWludDggY29sb3IpIHsKICAgICAgICBJUGV0Q2FyZERhdGEgcGV0Q2FyZERhdGEgPSBJUGV0Q2FyZERhdGEocGV0Q2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgCiAgICAgICB1aW50MTYgcGV0MWF1cmFSZWQ7CiAgICAgICB1aW50MTYgcGV0MWF1cmFCbHVlOwogICAgICAgdWludDE2IHBldDFhdXJhWWVsbG93OwogICAgICAgICgsLCwscGV0MWF1cmFSZWQscGV0MWF1cmFCbHVlLHBldDFhdXJhWWVsbG93LCwsKSA9IHBldENhcmREYXRhLmdldFBldChwZXQxSUQpOwogICAgICAgIAogICAgICAgICAgSUFjY2Vzc29yeURhdGEgYWNjZXNzb3J5RGF0YSA9IElBY2Nlc3NvcnlEYXRhKGFjY2Vzc29yeURhdGFDb250cmFjdCk7CiAgICAgICAgICAgCiAgICAgICAgICAgdWludDggYWNjZXNzb3J5U2VyaWVzSUQ7CiAgICAgICAgICAgCiAgICAgICAgICAgKCxhY2Nlc3NvcnlTZXJpZXNJRCwpID0gYWNjZXNzb3J5RGF0YS5nZXRBY2Nlc3NvcnkoYWNjZXNzb3J5SWQpOwogICAgICAgIAogICAgICAgIGlmIChhY2Nlc3NvcnlTZXJpZXNJRCA9PSA3KSB7cGV0MWF1cmFSZWQgKz0gNjt9CiAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lEID09IDgpIHtwZXQxYXVyYVJlZCArPSAxMjt9CiAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lEID09IDkpIHtwZXQxYXVyYVllbGxvdyArPSA2O30KICAgICAgICBpZiAoYWNjZXNzb3J5U2VyaWVzSUQgPT0gMTApIHtwZXQxYXVyYVllbGxvdyArPSAxMjt9CiAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lEID09IDExKSB7cGV0MWF1cmFCbHVlICs9IDY7fQogICAgICAgIGlmIChhY2Nlc3NvcnlTZXJpZXNJRCA9PSAxMikge3BldDFhdXJhQmx1ZSArPSAxMjt9CiAgICAgICAgCiAgICAgICAKICAgICAgICAgICAgY29sb3IgPSAxOyAvL2Fzc3VtZSByZWQgdG8gc3RhcnQgCiAgICAgICAgICAgIGlmICgoKHBldDFhdXJhQmx1ZSkgPiAocGV0MWF1cmFSZWQpKSAmJiAoKHBldDFhdXJhQmx1ZSkgPiAocGV0MWF1cmFZZWxsb3cpKSkge2NvbG9yID0gMjt9CiAgICAgICAgICAgIGlmICgoKHBldDFhdXJhWWVsbG93KT4gKHBldDFhdXJhUmVkKSkgJiYgKChwZXQxYXVyYVllbGxvdyk+IChwZXQxYXVyYUJsdWUpKSkge2NvbG9yID0gMzt9CiAgICAgICAgICAgIGNvbXBvc2l0ZSA9IChwZXQxYXVyYVJlZCkgKyAocGV0MWF1cmFZZWxsb3cpICsgKHBldDFhdXJhQmx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgZnVuY3Rpb24ga2lsbCgpIG9ubHlDUkVBVE9SIGV4dGVybmFsIHsKICAgICAgICBzZWxmZGVzdHJ1Y3QoY3JlYXRvckFkZHJlc3MpOwogICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcigpICBvbmx5Q1JFQVRPUiBleHRlcm5hbCB7CiAgIC8vc2hvdWxkbid0IGhhdmUgYW55IGV0aCBoZXJlIGJ1dCBqdXN0IGluIGNhc2UuIAogICAgY3JlYXRvckFkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKfQogICAgICAgICAgCn0='.
	

]
