Class {
	#name : #SRT4251139bf01d46884c95b27666c9e317df68b876,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4251139bf01d46884c95b27666c9e317df68b876 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5XjAuNC4xNTsKLyoKICogQHRpdGxlIFN0cmluZyAmIHNsaWNlIHV0aWxpdHkgbGlicmFyeSBmb3IgU29saWRpdHkgY29udHJhY3RzLgogKiBAYXV0aG9yIE5pY2sgSm9obnNvbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIyYTRiNTg0YjQ5NDI0NDQzNGU2YTQ0NDU1ZTRlNDU1ZTA0NDQ0ZjVlIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KICoKICogQGRldiBGdW5jdGlvbmFsaXR5IGluIHRoaXMgbGlicmFyeSBpcyBsYXJnZWx5IGltcGxlbWVudGVkIHVzaW5nIGFuCiAqICAgICAgYWJzdHJhY3Rpb24gY2FsbGVkIGEgJ3NsaWNlJy4gQSBzbGljZSByZXByZXNlbnRzIGEgcGFydCBvZiBhIHN0cmluZyAtCiAqICAgICAgYW55dGhpbmcgZnJvbSB0aGUgZW50aXJlIHN0cmluZyB0byBhIHNpbmdsZSBjaGFyYWN0ZXIsIG9yIGV2ZW4gbm8KICogICAgICBjaGFyYWN0ZXJzIGF0IGFsbCAoYSAwLWxlbmd0aCBzbGljZSkuIFNpbmNlIGEgc2xpY2Ugb25seSBoYXMgdG8gc3BlY2lmeQogKiAgICAgIGFuIG9mZnNldCBhbmQgYSBsZW5ndGgsIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyBzbGljZXMgaXMgYSBsb3QgbGVzcwogKiAgICAgIGV4cGVuc2l2ZSB0aGFuIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyB0aGUgc3RyaW5ncyB0aGV5IHJlZmVyZW5jZS4KICoKICogICAgICBUbyBmdXJ0aGVyIHJlZHVjZSBnYXMgY29zdHMsIG1vc3QgZnVuY3Rpb25zIG9uIHNsaWNlIHRoYXQgbmVlZCB0byByZXR1cm4KICogICAgICBhIHNsaWNlIG1vZGlmeSB0aGUgb3JpZ2luYWwgb25lIGluc3RlYWQgb2YgYWxsb2NhdGluZyBhIG5ldyBvbmU7IGZvcgogKiAgICAgIGluc3RhbmNlLCBgcy5zcGxpdCgiLiIpYCB3aWxsIHJldHVybiB0aGUgdGV4dCB1cCB0byB0aGUgZmlyc3QgJy4nLAogKiAgICAgIG1vZGlmeWluZyBzIHRvIG9ubHkgY29udGFpbiB0aGUgcmVtYWluZGVyIG9mIHRoZSBzdHJpbmcgYWZ0ZXIgdGhlICcuJy4KICogICAgICBJbiBzaXR1YXRpb25zIHdoZXJlIHlvdSBkbyBub3Qgd2FudCB0byBtb2RpZnkgdGhlIG9yaWdpbmFsIHNsaWNlLCB5b3UKICogICAgICBjYW4gbWFrZSBhIGNvcHkgZmlyc3Qgd2l0aCBgLmNvcHkoKWAsIGZvciBleGFtcGxlOgogKiAgICAgIGBzLmNvcHkoKS5zcGxpdCgiLiIpYC4gVHJ5IGFuZCBhdm9pZCB1c2luZyB0aGlzIGlkaW9tIGluIGxvb3BzOyBzaW5jZQogKiAgICAgIFNvbGlkaXR5IGhhcyBubyBtZW1vcnkgbWFuYWdlbWVudCwgaXQgd2lsbCByZXN1bHQgaW4gYWxsb2NhdGluZyBtYW55CiAqICAgICAgc2hvcnQtbGl2ZWQgc2xpY2VzIHRoYXQgYXJlIGxhdGVyIGRpc2NhcmRlZC4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCByZXR1cm4gdHdvIHNsaWNlcyBjb21lIGluIHR3byB2ZXJzaW9uczogYSBub24tYWxsb2NhdGluZwogKiAgICAgIHZlcnNpb24gdGhhdCB0YWtlcyB0aGUgc2Vjb25kIHNsaWNlIGFzIGFuIGFyZ3VtZW50LCBtb2RpZnlpbmcgaXQgaW4KICogICAgICBwbGFjZSwgYW5kIGFuIGFsbG9jYXRpbmcgdmVyc2lvbiB0aGF0IGFsbG9jYXRlcyBhbmQgcmV0dXJucyB0aGUgc2Vjb25kCiAqICAgICAgc2xpY2U7IHNlZSBgbmV4dFJ1bmVgIGZvciBleGFtcGxlLgogKgogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IGhhdmUgdG8gY29weSBzdHJpbmcgZGF0YSB3aWxsIHJldHVybiBzdHJpbmdzIHJhdGhlciB0aGFuCiAqICAgICAgc2xpY2VzOyB0aGVzZSBjYW4gYmUgY2FzdCBiYWNrIHRvIHNsaWNlcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nIGlmCiAqICAgICAgcmVxdWlyZWQuCiAqCiAqICAgICAgRm9yIGNvbnZlbmllbmNlLCBzb21lIGZ1bmN0aW9ucyBhcmUgcHJvdmlkZWQgd2l0aCBub24tbW9kaWZ5aW5nCiAqICAgICAgdmFyaWFudHMgdGhhdCBjcmVhdGUgYSBuZXcgc2xpY2UgYW5kIHJldHVybiBib3RoOyBmb3IgaW5zdGFuY2UsCiAqICAgICAgYHMuc3BsaXROZXcoJy4nKWAgbGVhdmVzIHMgdW5tb2RpZmllZCwgYW5kIHJldHVybnMgdHdvIHZhbHVlcwogKiAgICAgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxlZnQgYW5kIHJpZ2h0IHBhcnRzIG9mIHRoZSBzdHJpbmcuCiAqLwogCi8vcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTQ7CgpsaWJyYXJ5IHN0cmluZ3MgewogICAgc3RydWN0IHNsaWNlIHsKICAgICAgICB1aW50IF9sZW47CiAgICAgICAgdWludCBfcHRyOwogICAgfQoKICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBsZW4gPj0gMzI7IGxlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0ICs9IDMyOwogICAgICAgICAgICBzcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQgbWFzayA9IDI1NiAqKiAoMzIgLSBsZW4pIC0gMTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpCiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcmV0OwogICAgICAgIGlmIChzZWxmID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxNjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gODsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gNDsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDMyIC0gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgYnl0ZXMzMiwgaW50ZXJwcmV0ZWQgYXMgYQogICAgICogICAgICBudWxsLXRlcm1pbnRhZWQgdXRmLTggc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLgogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYXJndW1lbnQgdXAgdG8gdGhlCiAgICAgKiAgICAgICAgIGZpcnN0IG51bGwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2VCMzIoYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICAvLyBBbGxvY2F0ZSBzcGFjZSBmb3IgYHNlbGZgIGluIG1lbW9yeSwgY29weSBpdCB0aGVyZSwgYW5kIHBvaW50IHJldCBhdCBpdAogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHB0ciA6PSBtbG9hZCgweDQwKQogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKHB0ciwgMHgyMCkpCiAgICAgICAgICAgIG1zdG9yZShwdHIsIHNlbGYpCiAgICAgICAgICAgIG1zdG9yZShhZGQocmV0LCAweDIwKSwgcHRyKQogICAgICAgIH0KICAgICAgICByZXQuX2xlbiA9IGxlbihzZWxmKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24KICAgICAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0CiAgICAgKiAgICAgIGluIGxvb3BzLCBhbmQgY2FsbCBgc2xpY2UuZW1wdHkoKWAgaWYgeW91IG9ubHkgbmVlZCB0byBrbm93IHdoZXRoZXIKICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzbGljZSBpbiBydW5lcy4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQgbCkgewogICAgICAgIC8vIFN0YXJ0aW5nIGF0IHB0ci0zMSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dAogICAgICAgIHZhciBwdHIgPSBzZWxmLl9wdHIgLSAzMTsKICAgICAgICB2YXIgZW5kID0gcHRyICsgc2VsZi5fbGVuOwogICAgICAgIGZvciAobCA9IDA7IHB0ciA8IGVuZDsgbCsrKSB7CiAgICAgICAgICAgIHVpbnQ4IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQocHRyKSwgMHhGRikgfQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAxOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAyOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAzOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsKICAgICAgICAgICAgICAgIHB0ciArPSA0OwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RkMpIHsKICAgICAgICAgICAgICAgIHB0ciArPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHRyICs9IDY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSAoaGFzIGEgbGVuZ3RoIG9mIDApLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5LCBGYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVtcHR5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc2VsZi5fbGVuID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogICAgICovCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICB1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOwogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7CiAgICAgICAgZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsKICAgICAgICAgICAgdWludCBhOwogICAgICAgICAgICB1aW50IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikKICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEgIT0gYikgewogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICAgICAgICAgIHVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsKICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7CiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoZGlmZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsKICAgICAgICAgICAgb3RoZXJwdHIgKz0gMzI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHR3byBzbGljZXMgY29udGFpbiB0aGUgc2FtZSB0ZXh0LgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZXF1YWxzKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhcmUoc2VsZiwgb3RoZXIpID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgRXh0cmFjdHMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlIGludG8gYHJ1bmVgLCBhZHZhbmNpbmcgdGhlCiAgICAgKiAgICAgIHNsaWNlIHRvIHBvaW50IHRvIHRoZSBuZXh0IHJ1bmUgYW5kIHJldHVybmluZyBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBydW5lIFRoZSBzbGljZSB0aGF0IHdpbGwgY29udGFpbiB0aGUgZmlyc3QgcnVuZS4KICAgICAqIEByZXR1cm4gYHJ1bmVgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmLCBzbGljZSBydW5lKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsKCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgdWludCBsZW47CiAgICAgICAgdWludCBiOwogICAgICAgIC8vIExvYWQgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIHJ1bmUgaW50byB0aGUgTFNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChzdWIobWxvYWQoYWRkKHNlbGYsIDMyKSksIDMxKSksIDB4RkYpIH0KICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgbGVuID0gMTsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgbGVuID0gMjsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgbGVuID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZW4gPSA0OwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgewogICAgICAgICAgICBydW5lLl9sZW4gPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5fcHRyICs9IGxlbjsKICAgICAgICBzZWxmLl9sZW4gLT0gbGVuOwogICAgICAgIHJ1bmUuX2xlbiA9IGxlbjsKICAgICAgICByZXR1cm4gcnVuZTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludAogICAgICogICAgICB0byB0aGUgbmV4dCBydW5lLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogICAgICovCiAgICBmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IHdvcmQ7CiAgICAgICAgdWludCBsZW5ndGg7CiAgICAgICAgdWludCBkaXZpc29yID0gMiAqKiAyNDg7CgogICAgICAgIC8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0KICAgICAgICB2YXIgYiA9IHdvcmQgLyBkaXZpc29yOwogICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICByZXQgPSBiOwogICAgICAgICAgICBsZW5ndGggPSAxOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICByZXQgPSBiICYgMHgxRjsKICAgICAgICAgICAgbGVuZ3RoID0gMjsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgcmV0ID0gYiAmIDB4MEY7CiAgICAgICAgICAgIGxlbmd0aCA9IDM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0ID0gYiAmIDB4MDc7CiAgICAgICAgICAgIGxlbmd0aCA9IDQ7CiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKICAgICAgICBpZiAobGVuZ3RoID4gc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZGl2aXNvciA9IGRpdmlzb3IgLyAyNTY7CiAgICAgICAgICAgIGIgPSAod29yZCAvIGRpdmlzb3IpICYgMHhGRjsKICAgICAgICAgICAgaWYgKGIgJiAweEMwICE9IDB4ODApIHsKICAgICAgICAgICAgICAgIC8vIEludmFsaWQgVVRGLTggc2VxdWVuY2UKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldCA9IChyZXQgKiA2NCkgfCAoYiAmIDB4M0YpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guCiAgICAgKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBzbGljZS4KICAgICAqLwogICAgZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByZXQgOj0ga2VjY2FrMjU2KG1sb2FkKGFkZChzZWxmLCAzMikpLCBtbG9hZChzZWxmKSkKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuZ3RoIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICBlcXVhbCA6PSBlcShrZWNjYWsyNTYoc2VsZnB0ciwgbGVuZ3RoKSwga2VjY2FrMjU2KG5lZWRsZXB0ciwgbGVuZ3RoKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQogICAgICogICAgICBiZWdpbm5pbmcgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAKICAgICAqLwogICAgZnVuY3Rpb24gYmV5b25kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsKICAgICAgICBpZiAoc2VsZi5fcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuZ3RoKSwgc2hhMyhuZWVkbGVwdHIsIGxlbmd0aCkpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgZW5kcyB3aXRoIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlbmRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsKCiAgICAgICAgaWYgKHNlbGZwdHIgPT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IGxlbmd0aCA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKGtlY2NhazI1NihzZWxmcHRyLCBsZW5ndGgpLCBrZWNjYWsyNTYobmVlZGxlcHRyLCBsZW5ndGgpKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKGtlY2NhazI1NihzZWxmcHRyLCBsZW5ndGgpLCBrZWNjYWsyNTYobmVlZGxlcHRyLCBsZW5ndGgpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgdWludCBpZHg7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBsdChzdWIocHRyLCAxKSwgZW5kKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7CiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcHRyOwoKICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsKICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgewogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncwogICAgICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBsb29wOgogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc3ViKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBndChhZGQocHRyLCAxKSwgc2VsZnB0cikpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHIKICAgICAgICAgICAgICAgICAgICBqdW1wKGV4aXQpCiAgICAgICAgICAgICAgICAgICAgcmV0OgogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7CiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsKICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOwogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyICsgbmVlZGxlbGVuOwogICAgICAgICAgICAgICAgICAgIHB0ciAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UKICAgICAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICBzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiB0aGUgcGFydCBvZiB0aGUgc3RyaW5nIGZyb20gdGhlIHN0YXJ0IG9mCiAgICAgKiAgICAgIGBzZWxmYCB0byB0aGUgZW5kIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLiBJZiBgbmVlZGxlYAogICAgICogICAgICBpcyBub3QgZm91bmQsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHRva2VuLl9wdHIgPSBzZWxmLl9wdHI7CiAgICAgICAgdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKTsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0cikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CiAgICAgICAgcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNudCkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwogICAgICAgIHdoaWxlIChwdHIgPD0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIGNudCsrOwogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBUcnVlIGlmIGBzZWxmYCBjb250YWlucyBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUcnVlIGlmIGBuZWVkbGVgIGlzIGZvdW5kIGluIGBzZWxmYCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBjb250YWlucyhzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YKICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4KICAgICAqLwogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQogICAgICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLAogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gIiI7CgogICAgICAgIHVpbnQgbGVuZ3RoID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGxlbmd0aCArPSBwYXJ0c1tpXS5fbGVuOwoKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhsZW5ndGgpOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIGZvcihpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOwogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsKICAgICAgICAgICAgaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQp9Ci8vIDxPUkFDTElaRV9BUEk+Ci8qCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTApDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFRECgoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKCgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCi8vcHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsvL3BsZWFzZSBpbXBvcnQgb3JhY2xpemVBUElfcHJlMC40LnNvbCB3aGVuIHNvbGlkaXR5IDwgMC40LjAKCmNvbnRyYWN0IE9yYWNsaXplSSB7CiAgICBhZGRyZXNzIHB1YmxpYyBjYkFkZHJlc3M7CiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOwogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7CiAgICBmdW5jdGlvbiBzZXRDb25maWcoYnl0ZXMzMiBfY29uZmlnKTsKICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsKICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgcmV0dXJucyhieXRlczMyKTsKfQpjb250cmFjdCBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgewogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsKICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7CiAgICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAqNjAqMjQqMzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OYXRpdmUgPSAweEYwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7CiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7CiAgICAgICAgaWYoKGFkZHJlc3MoT0FSKT09MCl8fChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpPT0wKSkKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CgogICAgICAgIGlmKGFkZHJlc3Mob3JhY2xpemUpICE9IE9BUi5nZXRBZGRyZXNzKCkpCiAgICAgICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwoKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfdXNlQ291cG9uKHN0cmluZyBjb2RlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkodWludCBfZGVsYXksIHVpbnQgX25ieXRlcywgdWludCBfY3VzdG9tR2FzTGltaXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIGlmICgoX25ieXRlcyA9PSAwKXx8KF9uYnl0ZXMgPiAzMikpIHRocm93OwoJLy8gQ29udmVydCBmcm9tIHNlY29uZHMgdG8gbGVkZ2VyIHRpbWVyIHRpY2tzCiAgICAgICAgX2RlbGF5ICo9IDEwOyAKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGRlbGF5ID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBhc3NlbWJseSB7IAogICAgICAgICAgICBtc3RvcmUoYWRkKGRlbGF5LCAweDIwKSwgX2RlbGF5KSAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IGRlbGF5X2J5dGVzOCA9IG5ldyBieXRlcyg4KTsKICAgICAgICBjb3B5Qnl0ZXMoZGVsYXksIDI0LCA4LCBkZWxheV9ieXRlczgsIDApOwoKICAgICAgICBieXRlc1s0XSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2gsIGRlbGF5XTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeSgicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgZGVsYXlfYnl0ZXM4X2xlZnQgPSBuZXcgYnl0ZXMoOCk7CiAgICAgICAgCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgeCA6PSBtbG9hZChhZGQoZGVsYXlfYnl0ZXM4LCAweDIwKSkKICAgICAgICAgICAgbXN0b3JlOChhZGQoZGVsYXlfYnl0ZXM4X2xlZnQsIDB4MjcpLCBkaXYoeCwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyNiksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyNSksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgbXN0b3JlOChhZGQoZGVsYXlfYnl0ZXM4X2xlZnQsIDB4MjQpLCBkaXYoeCwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyMyksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyMiksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgbXN0b3JlOChhZGQoZGVsYXlfYnl0ZXM4X2xlZnQsIDB4MjEpLCBkaXYoeCwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyMCksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQoKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBzaGEzKGRlbGF5X2J5dGVzOF9sZWZ0LCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50OwogICAgfQoKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ynl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CgogICAgICAgIGJ5dGVzMzIgc2lncjsKICAgICAgICBieXRlczMyIHNpZ3M7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBvZmZzZXQgPSA0Kyh1aW50KGRlcnNpZ1szXSkgLSAweDIwKTsKICAgICAgICBzaWdyXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCwgMzIsIHNpZ3JfLCAwKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2lnc18gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIG9mZnNldCArPSAzMiArIDI7CiAgICAgICAgc2lnc18gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQrKHVpbnQoZGVyc2lnW29mZnNldC0xXSkgLSAweDIwKSwgMzIsIHNpZ3NfLCAwKTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaWdyIDo9IG1sb2FkKGFkZChzaWdyXywgMzIpKQogICAgICAgICAgICBzaWdzIDo9IG1sb2FkKGFkZChzaWdzXywgMzIpKQogICAgICAgIH0KCgogICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyNywgc2lnciwgc2lncyk7CiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwoKICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcyID0gbmV3IGJ5dGVzKHVpbnQocHJvb2Zbc2lnMm9mZnNldCsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LCBzaWcyLmxlbmd0aCwgc2lnMiwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDErNjUrMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSAxOyAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZmQ5NGZhNzFiYzBiYTEwZDM5ZDQ2NGQwZDhmNDY1ZWZlZWYwYTI3NjRlMzg4N2ZjYzlkZjQxZGVkMjBmNTA1YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CgogICAgICAgIGlmIChzaWdvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMyA9IG5ldyBieXRlcygxKzY1KTsKICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwoKICAgICAgICByZXR1cm4gc2lnb2s7CiAgICB9CgogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSB0aHJvdzsKCiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fcmV0dXJuQ29kZShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCl7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHJldHVybiAxOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHJldHVybiAyOwoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgsIHVpbnQgbl9yYW5kb21fYnl0ZXMpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgbWF0Y2hfID0gdHJ1ZTsKCQoJaWYgKHByZWZpeC5sZW5ndGggIT0gbl9yYW5kb21fYnl0ZXMpIHRocm93OwoJICAgICAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaT0wOyBpPCBuX3JhbmRvbV9ieXRlczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKGJ5dGVzIHByb29mLCBieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzIHJlc3VsdCwgc3RyaW5nIGNvbnRleHRfbmFtZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CgogICAgICAgIC8vIFN0ZXAgMjogdGhlIHVuaXF1ZSBrZXloYXNoIGhhcyB0byBtYXRjaCB3aXRoIHRoZSBzaGEyNTYgb2YgKGNvbnRleHQgbmFtZSArIHF1ZXJ5SWQpCiAgICAgICAgdWludCBsZWRnZXJQcm9vZkxlbmd0aCA9IDMrNjUrKHVpbnQocHJvb2ZbMys2NSsxXSkrMikrMzI7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGtleWhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyLCBrZXloYXNoLCAwKTsKICAgICAgICBpZiAoIShzaGEzKGtleWhhc2gpID09IHNoYTMoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGlmICghbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0LCB1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKzMyKzhdKSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwgc2hhMyhkZWxheSwgbmJ5dGVzLCB1bm9uY2UsIHNlc3Npb25LZXlIYXNoKSA9PSBjb21taXRtZW50IGluIHN0b3JhZ2UuCiAgICAgICAgLy8gVGhpcyBpcyB0byB2ZXJpZnkgdGhhdCB0aGUgY29tcHV0ZWQgYXJncyBtYXRjaCB3aXRoIHRoZSBvbmVzIHNwZWNpZmllZCBpbiB0aGUgcXVlcnkuCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKzMyLCA4KzErMzIsIGNvbW1pdG1lbnRTbGljZTEsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvblB1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgdWludCBzaWcyb2Zmc2V0ID0gbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrKDgrMSszMikrc2lnMS5sZW5ndGgrNjU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LTY0LCA2NCwgc2Vzc2lvblB1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzMzIgc2Vzc2lvblB1YmtleUhhc2ggPSBzaGEyNTYoc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjEgPSBuZXcgYnl0ZXMoMzIrOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMis4KzErMzIsIHRvc2lnbjEsIDApOwogICAgICAgIGlmICghdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKXsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOwogICAgfQoKCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gbGVuZ3RoICsgdG9PZmZzZXQ7CgogICAgICAgIGlmICh0by5sZW5ndGggPCBtaW5MZW5ndGgpIHsKICAgICAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgICAgICB0aHJvdzsgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KICAgICAgICB9CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCn0KLy8gPC9PUkFDTElaRV9BUEk+Cgpjb250cmFjdCBGcmVlTE9USW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHt9CiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQgX2FtdCkgZXh0ZXJuYWwge30KfQoKY29udHJhY3QgRXRoZXJhZmZsZVVwZ3JhZGUgewogICAgZnVuY3Rpb24gYWRkVG9Qcml6ZVBvb2woKSBwYXlhYmxlIGV4dGVybmFsIHt9Cn0KCmNvbnRyYWN0IFJlY2VpdmVySW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVFdGhlcigpIGV4dGVybmFsIHBheWFibGUge30KfQoKY29udHJhY3QgRXRoZXJhZmZsZSBpcyBFdGhlcmFmZmxlVXBncmFkZSwgRnJlZUxPVEludGVyZmFjZSwgUmVjZWl2ZXJJbnRlcmZhY2UsIHVzaW5nT3JhY2xpemUgewogICAgdXNpbmcgc3RyaW5ncyBmb3IgKjsKCiAgICB1aW50ICAgIHB1YmxpYyB3ZWVrOwogICAgYm9vbCAgICBwdWJsaWMgcGF1c2VkOwogICAgdWludCAgICBwdWJsaWMgdXBncmFkZWQ7CiAgICB1aW50ICAgIHB1YmxpYyBwcml6ZVBvb2w7CiAgICBhZGRyZXNzIHB1YmxpYyBldGhSZWxpZWY7CiAgICBhZGRyZXNzIHB1YmxpYyBldGhlcmFmZmxlOwogICAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZUFkZHI7CiAgICBhZGRyZXNzIHB1YmxpYyBkaXNidXJzZUFkZHI7CiAgICB1aW50ICAgIHB1YmxpYyB0YWtlICAgICAgICAgPSAxNTA7Ly9wcHQKICAgIHVpbnQgICAgcHVibGljIGdhc0FtdCAgICAgICA9IDUwMDAwMDsKICAgIHVpbnQgICAgcHVibGljIGdhc1ByYyAgICAgICA9IDIwMDAwMDAwMDAwOy8vMjAgZ3dlaQogICAgdWludCAgICBwdWJsaWMgcmFmRW5kICAgICAgID0gNTAwNDAwOy8vNzowMHBtIFNhdHVyZGF5cwogICAgdWludCAgICBwdWJsaWMgdGt0UHJpY2UgICAgID0gMjAwMDAwMDAwMDAwMDAwMDsKICAgIHVpbnQgICAgcHVibGljIG9yYWNDb3N0ICAgICA9IDE1MDAwMDAwMDAwMDAwMDA7Ly8kMSBAICQ3MDAKICAgIHVpbnQgICAgcHVibGljIHdkcmF3QmZyICAgICA9IDYwNDgwMDA7CiAgICB1aW50W10gIHB1YmxpYyBwY3RPZlBvb2wgICAgPSBbNTIwLCAxMTQsIDQ3LCAzMTldOy8vcHB0Li4uCiAgICB1aW50ICAgIHB1YmxpYyByZXN1bHRzRGVsYXkgPSAzNjAwOwogICAgdWludCAgICBwdWJsaWMgbWF0Y2hlc0RlbGF5ID0gMzYwMDsKICAgIHVpbnQgIGNvbnN0YW50IHdlZWtEdXIgICAgICA9IDYwNDgwMDsKICAgIHVpbnQgIGNvbnN0YW50IGJpcnRoZGF5ICAgICA9IDE1MDAyNDk2MDA7Ly9FdGhlcmFmZmxlJ3MgYmlydGhkYXkgPDMKCiAgICBGcmVlTE9USW50ZXJmYWNlIGZyZWVMT1Q7CgogICAgc3RyaW5nIHJhbmRvbVN0cjEgPSAiW1VSTF0gWydqc29uKGh0dHBzOi8vYXBpLnJhbmRvbS5vcmcvanNvbi1ycGMvMS9pbnZva2UpLnJlc3VsdC5yYW5kb21bXCJkYXRhXCIsIFwic2VyaWFsTnVtYmVyXCJdJywnXFxue1wianNvbnJwY1wiOiBcIjIuMFwiLFwibWV0aG9kXCI6XCJnZW5lcmF0ZVNpZ25lZEludGVnZXJzXCIsXCJpZFwiOlwiIjsKICAgIHN0cmluZyByYW5kb21TdHIyID0gIlwiLFwicGFyYW1zXCI6e1wiblwiOlwiNlwiLFwibWluXCI6MSxcIm1heFwiOjQ5LFwicmVwbGFjZW1lbnRcIjpmYWxzZSxcImJhc2VcIjoxMCxcImFwaUtleVwiOiR7W2RlY3J5cHRdIEJPeFU5alAybGFabUdQZTI5V3ZDaDVIWTU3b2JqRDE0VFR1WXYxWTFwN000M21IUzhyRHVwUGlJaklxOEROUEdtNEE4T3RiQm1CeFVaYW50L1dxRzBlR2dmemI1U1RTc2I0NFZ6T0lSclNrMkE4cjEwU3hURTVZc2wySGFoWUhaTzE4TFptV1lDbnFqVko3VVRtQ0J4d1JwYjVPVklWY3A5QT09fX0nXSI7CiAgICBzdHJpbmcgYXBpU3RyMSA9ICJbVVJMXSBbJ2pzb24oaHR0cHM6Ly9ldGhlcmFmZmxlLmNvbS9hcGkvYSkubScsJ3tcInJcIjpcIiI7CiAgICBzdHJpbmcgYXBpU3RyMiA9ICJcIixcImtcIjoke1tkZWNyeXB0XSBCTFFOVTlaUXhTNmFyZHBCOWdtVWZWS3dLaHhTRjJNbXlCN3NoMmdtUUZINDlWZXdGczUyRWdhWUlkNUtWRWtZdU5DUDBTMnBwekRtaU4vNUpVekhHVFBwa1B1VEFaZHgveWRCQ2NSTWN1dXF4ZzRsU3B2dEczb0I2enZYZlRjQ1ZqR01QYmVwfX0nXSI7CgogICAgbWFwcGluZyAodWludCA9PiByYWZTdHJ1Y3QpIHB1YmxpYyByYWZmbGU7CiAgICBzdHJ1Y3QgcmFmU3RydWN0IHsKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnRbXVtdKSBlbnRyaWVzOwogICAgICAgIHVpbnQgdW5jbGFpbWVkOwogICAgICAgIHVpbnRbXSB3aW5OdW1zOwogICAgICAgIHVpbnRbXSB3aW5BbXRzOwogICAgICAgIHVpbnQgdGltZVN0YW1wOwogICAgICAgIGJvb2wgd2RyYXdPcGVuOwogICAgICAgIHVpbnQgbnVtRW50cmllczsKICAgICAgICB1aW50IGZyZWVFbnRyaWVzOwogICAgfQoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gcUlEU3RydWN0KSBwdWJsaWMgcUlEOwogICAgc3RydWN0IHFJRFN0cnVjdCB7CiAgICAgICAgdWludCB3ZWVrTm87CiAgICAgICAgYm9vbCBpc1JhbmRvbTsKICAgICAgICBib29sIGlzTWFudWFsOwogICAgfQogICAgLyoqCiAgICAqIEBkZXYgIE1vZGlmaWVyIHRvIHByZXBlbmQgdG8gZnVuY3Rpb25zIGFkZGluZyB0aGUgYWRkaXRpb25hbAogICAgKiAgICAgICBjb25kaXRpb25hbCByZXF1aXJpbmcgY2FsbGVyIG9mIHRoZSBtZXRob2QgdG8gYmUgdGhlCiAgICAqICAgICAgIGV0aGVyYWZmbGUgYWRkcmVzcy4KICAgICovCiAgICBtb2RpZmllciBvbmx5RXRoZXJhZmZsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZXRoZXJhZmZsZSk7CiAgICAgICAgXzsKICAgIH0KICAgIC8qKgogICAgKiBAZGV2ICBNb2RpZmllciB0byBwcmVwZW5kIHRvIGZ1bmN0aW9ucyBhZGRpbmcgdGhlIGFkZGl0aW9uYWwKICAgICogICAgICAgY29uZGl0aW9uYWwgcmVxdWlyaW5nIHRoZSBwYXVzZWQgYm9vbCB0byBiZSBmYWxzZS4KICAgICovCiAgICBtb2RpZmllciBvbmx5SWZOb3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQogICAgZXZlbnQgTG9nRnVuY3Rpb25zUGF1c2VkKHVpbnQgaWRlbnRpZmllciwgdWludCBhdFRpbWUpOwogICAgZXZlbnQgTG9nUXVlcnlTZW50KGJ5dGVzMzIgcXVlcnlJRCwgdWludCBkdWVBdCwgdWludCBzZW5kVGltZSk7CiAgICBldmVudCBMb2dSZWNsYWltKHVpbnQgaW5kZXhlZCBmcm9tUmFmZmxlLCB1aW50IGFtb3VudCwgdWludCBhdFRpbWUpOwogICAgZXZlbnQgTG9nVXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0LCB1aW50IGV0aFRyYW5zZmVycmVkLCB1aW50IGF0VGltZSk7CiAgICBldmVudCBMb2dQcml6ZVBvb2xBZGRpdGlvbihhZGRyZXNzIGZyb21XaG9tLCB1aW50IGhvd011Y2gsIHVpbnQgYXRUaW1lKTsKICAgIGV2ZW50IExvZ09yYWNsaXplQ2FsbGJhY2soYnl0ZXMzMiBxdWVyeUlELCBzdHJpbmcgcmVzdWx0LCB1aW50IGluZGV4ZWQgZm9yUmFmZmxlLCB1aW50IGF0VGltZSk7CiAgICBldmVudCBMb2dGdW5kc0Rpc2J1cnNlZCh1aW50IGluZGV4ZWQgZm9yUmFmZmxlLCB1aW50IG9yYWNsaXplVG90YWwsIHVpbnQgYW1vdW50LCBhZGRyZXNzIGluZGV4ZWQgdG9BZGRyZXNzLCB1aW50IGF0VGltZSk7CiAgICBldmVudCBMb2dXaXRoZHJhdyh1aW50IGluZGV4ZWQgZm9yUmFmZmxlLCBhZGRyZXNzIGluZGV4ZWQgdG9XaG9tLCB1aW50IGZvckVudHJ5TnVtYmVyLCB1aW50IG1hdGNoZXMsIHVpbnQgYW1vdW50V29uLCB1aW50IGF0VGltZSk7CiAgICBldmVudCBMb2dXaW5uaW5nTnVtYmVycyh1aW50IGluZGV4ZWQgZm9yUmFmZmxlLCB1aW50IG51bWJlck9mRW50cmllcywgdWludFtdIHdOdW1iZXJzLCB1aW50IGN1cnJlbnRQcml6ZVBvb2wsIHVpbnQgcmFuZG9tU2VyaWFsTm8sIHVpbnQgYXRUaW1lKTsKICAgIGV2ZW50IExvZ1RpY2tldEJvdWdodCh1aW50IGluZGV4ZWQgZm9yUmFmZmxlLCB1aW50IGluZGV4ZWQgZW50cnlOdW1iZXIsIGFkZHJlc3MgaW5kZXhlZCB0aGVFbnRyYW50LCB1aW50W10gY2hvc2VuTnVtYmVycywgdWludCBwZXJzb25hbEVudHJ5TnVtYmVyLCB1aW50IHRrdENvc3QsIHVpbnQgYXRUaW1lLCB1aW50IGFmZmlsaWF0ZUlEKTsKICAgIGV2ZW50IExvZ1ByaXplUG9vbHNVcGRhdGVkKHVpbnQgbmV3TWFpblByaXplUG9vbCwgdWludCBpbmRleGVkIGZvclJhZmZsZSwgdWludCB1bmNsYWltZWRQcml6ZVBvb2wsIHVpbnQgdGhyZWVNYXRjaFdpbkFtdCwgdWludCBmb3VyTWF0Y2hXaW5BbXQsIHVpbnQgZml2ZU1hdGNoV2luQW10LCB1aW50IHNpeE1hdGNod2luQW10LCB1aW50IGF0VGltZSk7CiAgICAvKioKICAgICAqIEBkZXYgICBDb25zdHJ1Y3RvciAtIHNldHMgdGhlIEV0aGVyYWZmbGUgY29udHJhY3QgYWRkcmVzcyAmCiAgICAgKiAgICAgICAgdGhlIGRpc2J1cnNhbCBjb250cmFjdCBhZGRyZXNzIGZvciBpbnZlc3RvcnMsIGNhbGxzCiAgICAgKiAgICAgICAgdGhlIG5ld1JhZmZsZSgpIGZ1bmN0aW9uIHdpdGggc2V0cyB0aGUgY3VycmVudAogICAgICogICAgICAgIHJhZmZsZSBJRCBnbG9iYWwgdmFyIHBsdXMgc2V0cyB1cCB0aGUgZmlyc3QgcmFmZmxlJ3MKICAgICAqICAgICAgICBzdHJ1Y3Qgd2l0aCBjb3JyZWN0IHRpbWUgc3RhbXAuIFNldHMgdGhlIHdpdGhkcmF3CiAgICAgKiAgICAgICAgYmVmb3JlIHRpbWUgdG8gYSB0ZW4gd2VlayBwZXJpb2QsIGFuZCBwcmVwYXJlcyB0aGUKICAgICAqICAgICAgICBpbml0aWFsIG9yYWNsaXplIGNhbGwgd2hpY2ggd2lsbCBiZWdpbiB0aGUgcmVjdXJzaXZlCiAgICAgKiAgICAgICAgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIF9mcmVlTE9UICAgIFRoZSBhZGRyZXNzIG9mIHRoZSBFdGhlcmFmZmxlIEZyZWVMT1Qgc3BlY2lhbCB0b2tlbi4KICAgICAqIEBwYXJhbSBfZHNicnMgICAgICBUaGUgYWRkcmVzcyBvZiB0aGUgRXRoZXJhZmZsZSBkaXNidXJzYWwgY29udHJhY3QuCiAgICAgKiBAcGFyYW0gX21zaWcgICAgICAgVGhlIGFkZHJlc3Mgb2YgdGhlIEV0aGVyYWZmbGUgbWFuYWdlcmlhbCBtdWx0aXNpZyB3YWxsZXQuCiAgICAgKiBAcGFyYW0gX2V0aFJlbGllZiAgVGhlIGFkZHJlc3Mgb2YgdGhlIEV0aFJlbGllZiBjaGFyaXR5IGNvbnRyYWN0LgogICAgICovCiAgICBmdW5jdGlvbiBFdGhlcmFmZmxlKGFkZHJlc3MgX2ZyZWVMT1QsIGFkZHJlc3MgX2RzYnJzLCBhZGRyZXNzIF9tc2lnLCBhZGRyZXNzIF9ldGhSZWxpZWYpIHBheWFibGUgewogICAgICAgIHdlZWsgICAgICAgICA9IGdldFdlZWsoKTsKICAgICAgICBldGhlcmFmZmxlICAgPSBfbXNpZzsKICAgICAgICBkaXNidXJzZUFkZHIgPSBfZHNicnM7CiAgICAgICAgZXRoUmVsaWVmICAgID0gX2V0aFJlbGllZjsKICAgICAgICBmcmVlTE9UICAgICAgPSBGcmVlTE9USW50ZXJmYWNlKF9mcmVlTE9UKTsKICAgICAgICB1aW50IGRlbGF5ICAgPSAod2VlayAqIHdlZWtEdXIpICsgYmlydGhkYXkgKyByYWZFbmQgKyByZXN1bHRzRGVsYXk7CiAgICAgICAgcmFmZmxlW3dlZWtdLnRpbWVTdGFtcCA9ICh3ZWVrICogd2Vla0R1cikgKyBiaXJ0aGRheTsKICAgICAgICBieXRlczMyIHF1ZXJ5ID0gb3JhY2xpemVfcXVlcnkoZGVsYXksICJuZXN0ZWQiLCBzdHJDb25jYXQocmFuZG9tU3RyMSwgdWludDJzdHIoZ2V0V2VlaygpKSwgcmFuZG9tU3RyMiksIGdhc0FtdCk7CiAgICAgICAgcUlEW3F1ZXJ5XS53ZWVrTm8gPSB3ZWVrOwogICAgICAgIHFJRFtxdWVyeV0uaXNSYW5kb20gPSB0cnVlOwogICAgICAgIExvZ1F1ZXJ5U2VudChxdWVyeSwgZGVsYXksIG5vdyk7CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICBGdW5jdGlvbiB1c2luZyBFdGhlcmFmZmxlJ3MgYmlydGhkYXkgdG8gY2FsY3VsYXRlIHRoZQogICAgICogICAgICAgIHdlZWsgbnVtYmVyIHNpbmNlIHRoZW4uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFdlZWsoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgY3VyV2VlayA9IChub3cgLSBiaXJ0aGRheSkgLyB3ZWVrRHVyOwogICAgICAgIGlmIChub3cgLSAoKGN1cldlZWsgKiB3ZWVrRHVyKSArIGJpcnRoZGF5KSA+IHJhZkVuZCkgewogICAgICAgICAgICBjdXJXZWVrKys7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdXJXZWVrOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICAgRnVuY3Rpb24gd2hpY2ggZ2V0cyBjdXJyZW50IHdlZWsgbnVtYmVyIGFuZCBpZiBkaWZmZXJlbnQKICAgICAqICAgICAgICBmcm9tIHRoZSBnbG9iYWwgdmFyIHdlZWsgbnVtYmVyLCBpdCB1cGRhdGVzIHRoYXQgYW5kIHNldHMKICAgICAqICAgICAgICB1cCB0aGUgbmV3IHJhZmZsZSBzdHJ1Y3QuIFNob3VsZCBvbmx5IGJlIGNhbGxlZCBvbmNlIGEKICAgICAqICAgICAgICB3ZWVrIGFmdGVyIHRoZSByYWZmbGUgaXMgY2xvc2VkLiBTaG91bGQgaXQgZ2V0IGNhbGxlZAogICAgICogICAgICAgIHNvb25lciwgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZCBmb3IgaW5zcGVjdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gbmV3UmFmZmxlKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbmV3V2VlayA9IGdldFdlZWsoKTsKICAgICAgICBpZihuZXdXZWVrID09IHdlZWspIHsKICAgICAgICAgICAgcGF1c2VDb250cmFjdCg0KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7Ly/iiLQgbmV3IHJhZmZsZS4uLgogICAgICAgICAgICB3ZWVrID0gbmV3V2VlazsKICAgICAgICAgICAgcmFmZmxlW25ld1dlZWtdLnRpbWVTdGFtcCA9IGJpcnRoZGF5ICsgKG5ld1dlZWsgKiB3ZWVrRHVyKTsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgIFRvIHBhdXNlIHRoZSBjb250cmFjdCdzIGZ1bmN0aW9ucyBzaG91bGQgdGhlIG5lZWQgYXJpc2UuIEludGVybmFsLgogICAgICogICAgICAgTG9ncyBhbiBldmVudCBvZiB0aGUgcGF1c2luZy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2lkICAgIEEgdWludCB0byBpZGVudGlmeSB0aGUgY2FsbGVyIG9mIHRoaXMgZnVuY3Rpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlQ29udHJhY3QodWludCBfaWQpIGludGVybmFsIHsKICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgTG9nRnVuY3Rpb25zUGF1c2VkKF9pZCwgbm93KTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgRnVuY3Rpb24gdG8gZW50ZXIgdGhlIHJhZmZsZS4gUmVxdWlyZXMgdGhlIGNhbGxlciB0byBzZW5kIGV0aGVyCiAgICAgKiAgICAgICBvZiBhbW91bnQgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSB0aWNrZXQgcHJpY2UuCiAgICAgKgogICAgICogQHBhcmFtIF9jTnVtcyAgICBPcmRlcmVkIGFycmF5IG9mIGVudHJhbnQncyBzaXggc2VsZWN0ZWQgbnVtYmVycy4KICAgICAqIEBwYXJhbSBfYWZmSUQgICAgQWZmaWxpYXRlIElEIG9mIHRoZSBzb3VyY2Ugb2YgdGhpcyBlbnRyeS4KICAgICAqLwogICAgZnVuY3Rpb24gZW50ZXJSYWZmbGUodWludFtdIF9jTnVtcywgdWludCBfYWZmSUQpIHBheWFibGUgZXh0ZXJuYWwgb25seUlmTm90UGF1c2VkIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSB0a3RQcmljZSk7CiAgICAgICAgYnV5VGlja2V0KF9jTnVtcywgbXNnLnNlbmRlciwgbXNnLnZhbHVlLCBfYWZmSUQpOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICBGdW5jdGlvbiB0byBlbnRlciB0aGUgcmFmZmxlIGZvciBmcmVlLiBSZXF1aXJlcyB0aGUgY2FsbGVyJ3MKICAgICAqICAgICAgIGJhbGFuY2Ugb2YgdGhlIEV0aGVyYWZmbGUgZnJlZUxPVCB0b2tlbiB0byBiZSBncmVhdGVyIHRoYW4KICAgICAqICAgICAgIHplcm8uIEZ1bmN0aW9uIGRlc3Ryb3lzIG9uZSBmcmVlTE9UIHRva2VuLCBpbmNyZW1lbnRzIHRoZQogICAgICogICAgICAgZnJlZUVudHJpZXMgdmFyaWFibGUgaW4gdGhlIHJhZmZsZSBzdHJ1Y3QgdGhlbiBwdXJjaGFzZXMgdGhlCiAgICAgKiAgICAgICB0aWNrZXQuCiAgICAgKgogICAgICogQHBhcmFtIF9jTnVtcyAgICBPcmRlcmVkIGFycmF5IG9mIGVudHJhbnQncyBzaXggc2VsZWN0ZWQgbnVtYmVycy4KICAgICAqIEBwYXJhbSBfYWZmSUQgICAgQWZmaWxpYXRlIElEIG9mIHRoZSBzb3VyY2Ugb2YgdGhpcyBlbnRyeS4KICAgICAqLwogICAgZnVuY3Rpb24gZW50ZXJGcmVlUmFmZmxlKHVpbnRbXSBfY051bXMsIHVpbnQgX2FmZklEKSBwYXlhYmxlIGV4dGVybmFsIG9ubHlJZk5vdFBhdXNlZCB7CiAgICAgICAgZnJlZUxPVC5kZXN0cm95KG1zZy5zZW5kZXIsIDEpOwogICAgICAgIHJhZmZsZVt3ZWVrXS5mcmVlRW50cmllcysrOwogICAgICAgIGJ1eVRpY2tldChfY051bXMsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgX2FmZklEKTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgIEZ1bmN0aW9uIHRvIGJ1eSB0aWNrZXRzLiBJbnRlcm5hbC4gUmVxdWlyZXMgdGhlIGVudHJ5IG51bWJlcgogICAgICogICAgICAgIGFycmF5IHRvIGJlIG9mIGxlbmd0aCA2LCByZXF1aXJlcyB0aGUgdGltZXN0YW1wIG9mIHRoZSBjdXJyZW50CiAgICAgKiAgICAgICAgcmFmZmxlIHN0cnVjdCB0byBoYXZlIGJlZW4gc2V0LCBhbmQgZm9yIHRoaXMgdGltZSB0aGlzIGZ1bmN0aW9uCiAgICAgKiAgICAgICAgaXMgY2FsbCB0byBiZSBiZWZvcmUgdGhlIGVuZCBvZiB0aGUgcmFmZmxlLiBUaGVuIHJlcXVpcmVzIHRoYXQKICAgICAqICAgICAgICB0aGUgY2hvc2VuIG51bWJlcnMgYXJlIG9yZGVyZWQgbG93ZXN0IHRvIGhpZ2hlc3QgJiBib3VuZCBiZXR3ZWVuCiAgICAgKiAgICAgICAgMSBhbmQgNDkuIEZ1bmN0aW9uIGluY3JlbWVudHMgdGhlIHRvdGFsIG51bWJlciBvZiBlbnRyaWVzIGluIHRoZQogICAgICogICAgICAgIGN1cnJlbnQgcmFmZmxlJ3Mgc3RydWN0LCBpbmNyZW1lbnRzIHRoZSBwcml6ZSBwb29sIGFjY29yZGluZ2x5CiAgICAgKiAgICAgICAgYW5kIHB1c2hlcyB0aGUgY2hvc2VuIG51bWJlciBhcnJheSBpbnRvIHRoZSBlbnRyaWVzIG1hcCBhbmQgdGhlbgogICAgICogICAgICAgIGxvZ3MgdGhlIHRpY2tldCBwdXJjaGFzZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2NOdW1zICAgICAgIEFycmF5IG9mIHVzZXJzIHNlbGVjdGVkIG51bWJlcnMuCiAgICAgKiBAcGFyYW0gX2VudHJhbnQgICAgIEVudHJhbnQncyBldGhlcmV1bSBhZGRyZXNzLgogICAgICogQHBhcmFtIF92YWx1ZSAgICAgICBUaGUgdGlja2V0IHB1cmNoYXNlIHByaWNlLgogICAgICogQHBhcmFtIF9hZmZJRCAgICAgICBUaGUgYWZmaWxpYXRlIElEIG9mIHRoZSBzb3VyY2Ugb2YgdGhpcyBlbnRyeS4KICAgICAqLwogICAgZnVuY3Rpb24gYnV5VGlja2V0CiAgICAoCiAgICAgICAgdWludFtdICBfY051bXMsCiAgICAgICAgYWRkcmVzcyBfZW50cmFudCwKICAgICAgICB1aW50ICAgIF92YWx1ZSwKICAgICAgICB1aW50ICAgIF9hZmZJRAogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZQogICAgICAgICgKICAgICAgICAgICAgX2NOdW1zLmxlbmd0aCA9PSA2ICYmCiAgICAgICAgICAgIHJhZmZsZVt3ZWVrXS50aW1lU3RhbXAgPiAwICYmCiAgICAgICAgICAgIG5vdyA8IHJhZmZsZVt3ZWVrXS50aW1lU3RhbXAgKyByYWZFbmQgJiYKICAgICAgICAgICAgMCAgICAgICAgIDwgX2NOdW1zWzBdICYmCiAgICAgICAgICAgIF9jTnVtc1swXSA8IF9jTnVtc1sxXSAmJgogICAgICAgICAgICBfY051bXNbMV0gPCBfY051bXNbMl0gJiYKICAgICAgICAgICAgX2NOdW1zWzJdIDwgX2NOdW1zWzNdICYmCiAgICAgICAgICAgIF9jTnVtc1szXSA8IF9jTnVtc1s0XSAmJgogICAgICAgICAgICBfY051bXNbNF0gPCBfY051bXNbNV0gJiYKICAgICAgICAgICAgX2NOdW1zWzVdIDw9IDQ5CiAgICAgICAgKTsKICAgICAgICByYWZmbGVbd2Vla10ubnVtRW50cmllcysrOwogICAgICAgIHByaXplUG9vbCArPSBfdmFsdWU7CiAgICAgICAgcmFmZmxlW3dlZWtdLmVudHJpZXNbX2VudHJhbnRdLnB1c2goX2NOdW1zKTsKICAgICAgICBMb2dUaWNrZXRCb3VnaHQod2VlaywgcmFmZmxlW3dlZWtdLm51bUVudHJpZXMsIF9lbnRyYW50LCBfY051bXMsIHJhZmZsZVt3ZWVrXS5lbnRyaWVzW19lbnRyYW50XS5sZW5ndGgsIF92YWx1ZSwgbm93LCBfYWZmSUQpOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IFdpbm5pbmdzIGZ1bmN0aW9uLiBVc2VyIGNhbGxzIHRoaXMgZnVuY3Rpb24gaW4gb3JkZXIgdG8gd2l0aGRyYXcKICAgICAqICAgICAgd2hhdGV2ZXIgd2lubmluZ3MgdGhleSBhcmUgb3dlZC4gRnVuY3Rpb24gY2FuIGJlIHBhdXNlZCB2aWEgdGhlIG1vZGlmaWVyCiAgICAgKiAgICAgIGZ1bmN0aW9uICJvbmx5SWZOb3RQYXVzZWQiCiAgICAgKgogICAgICogQHBhcmFtIF93ZWVrICAgICAgICBXZWVrIG51bWJlciBvZiB0aGUgcmFmZmxlIHRoZSB3aW5uaW5nIGVudHJ5IGlzIGZyb20KICAgICAqIEBwYXJhbSBfZW50cnlOdW0gICAgVGhlIGVudHJhbnRzIGVudHJ5IG51bWJlciBpbnRvIHRoaXMgcmFmZmxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3V2lubmluZ3ModWludCBfd2VlaywgdWludCBfZW50cnlOdW0pIG9ubHlJZk5vdFBhdXNlZCBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZQogICAgICAgICgKICAgICAgICAgICAgcmFmZmxlW193ZWVrXS50aW1lU3RhbXAgPiAwICYmCiAgICAgICAgICAgIG5vdyAtIHJhZmZsZVtfd2Vla10udGltZVN0YW1wID4gd2Vla0R1ciAtICh3ZWVrRHVyIC8gNykgJiYKICAgICAgICAgICAgbm93IC0gcmFmZmxlW193ZWVrXS50aW1lU3RhbXAgPCB3ZHJhd0JmciAmJgogICAgICAgICAgICByYWZmbGVbX3dlZWtdLndkcmF3T3BlbiA9PSB0cnVlICYmCiAgICAgICAgICAgIHJhZmZsZVtfd2Vla10uZW50cmllc1ttc2cuc2VuZGVyXVtfZW50cnlOdW0gLSAxXS5sZW5ndGggPT0gNgogICAgICAgICk7CiAgICAgICAgdWludCBtYXRjaGVzID0gZ2V0TWF0Y2hlcyhfd2VlaywgbXNnLnNlbmRlciwgX2VudHJ5TnVtKTsKICAgICAgICByZXF1aXJlCiAgICAgICAgKAogICAgICAgICAgICBtYXRjaGVzID49IDMgJiYKICAgICAgICAgICAgcmFmZmxlW193ZWVrXS53aW5BbXRzW21hdGNoZXMgLSAzXSA+IDAgJiYKICAgICAgICAgICAgcmFmZmxlW193ZWVrXS53aW5BbXRzW21hdGNoZXMgLSAzXSA8PSB0aGlzLmJhbGFuY2UKICAgICAgICApOwogICAgICAgIHJhZmZsZVtfd2Vla10uZW50cmllc1ttc2cuc2VuZGVyXVtfZW50cnlOdW0gLSAxXS5wdXNoKDApOwogICAgICAgIGlmKHJhZmZsZVtfd2Vla10ud2luQW10c1ttYXRjaGVzIC0gM10gPD0gcmFmZmxlW193ZWVrXS51bmNsYWltZWQpIHsKICAgICAgICAgICAgcmFmZmxlW193ZWVrXS51bmNsYWltZWQgLT0gcmFmZmxlW193ZWVrXS53aW5BbXRzW21hdGNoZXMgLSAzXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByYWZmbGVbX3dlZWtdLnVuY2xhaW1lZCA9IDA7CiAgICAgICAgICAgIHBhdXNlQ29udHJhY3QoNSk7CiAgICAgICAgfQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmFmZmxlW193ZWVrXS53aW5BbXRzW21hdGNoZXMgLSAzXSk7CiAgICAgICAgTG9nV2l0aGRyYXcoX3dlZWssIG1zZy5zZW5kZXIsIF9lbnRyeU51bSwgbWF0Y2hlcywgcmFmZmxlW193ZWVrXS53aW5BbXRzW21hdGNoZXMgLSAzXSwgbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgICAgQ2FsbGVkIGJ5IHRoZSB3ZWVrbHkgb3JhY2xpemUgY2FsbGJhY2suIENoZWNrcyByYWZmbGUgMTAKICAgICAqICAgICAgICAgd2Vla3Mgb2xkZXIgdGhhbiBjdXJyZW50IHJhZmZsZSBmb3IgYW55IHVuY2xhaW1lZCBwcml6ZQogICAgICogICAgICAgICBwb29sLiBJZiBhbnkgZm91bmQsIHJldHVybnMgaXQgdG8gdGhlIG1haW4gcHJpemVQb29sIGFuZAogICAgICogICAgICAgICB6ZXJvcyB0aGUgYW1vdW50LgogICAgICovCiAgICBmdW5jdGlvbiByZWNsYWltVW5jbGFpbWVkKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgb2xkID0gZ2V0V2VlaygpIC0gMTE7CiAgICAgICAgcHJpemVQb29sICs9IHJhZmZsZVtvbGRdLnVuY2xhaW1lZDsKICAgICAgICBMb2dSZWNsYWltKG9sZCwgcmFmZmxlW29sZF0udW5jbGFpbWVkLCBub3cpOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICBGdW5jdGlvbiB0b3RhbHMgdXAgb3JhY2xpemUgY29zdCBmb3IgdGhlIHJhZmZsZSwgc3VidHJhY3RzCiAgICAgKiAgICAgICBpdCBmcm9tIHRoZSBwcml6ZXBvb2wgKGlmIGxlc3MgdGhhbiwgaWYgZ3JlYXRlciB0aGFuIGlmCiAgICAgKiAgICAgICBwYXVzZXMgdGhlIGNvbnRyYWN0IGFuZCBmaXJlcyBhbiBldmVudCkuIENhbGN1bGF0ZXMgcHJvZml0CiAgICAgKiAgICAgICBiYXNlZCBvbiByYWZmbGUncyB0aWNrZXRzIHNhbGVzIGFuZCB0aGUgdGFrZSBwZXJjZW50YWdlLAogICAgICogICAgICAgdGhlbiBmb3J3YXJkcyB0aGF0IGFtb3VudCBvZiBldGhlciB0byB0aGUgZGlzYnVyc2FsIGNvbnRyYWN0LgogICAgICoKICAgICAqIEBwYXJhbSBfd2VlayAgIFRoZSB3ZWVrIG51bWJlciBvZiB0aGUgcmFmZmxlIGluIHF1ZXN0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBkaXNidXJzZUZ1bmRzKHVpbnQgX3dlZWspIGludGVybmFsIHsKICAgICAgICB1aW50IG9yYWNUb3QgPSAyICogKChnYXNBbXQgKiBnYXNQcmMpICsgb3JhY0Nvc3QpOy8vMiBxdWVyaWVzIHBlciBkcmF3Li4uCiAgICAgICAgaWYob3JhY1RvdCA+IHByaXplUG9vbCkgewogICAgICAgICAgcGF1c2VDb250cmFjdCgxKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcHJpemVQb29sIC09IG9yYWNUb3Q7CiAgICAgICAgdWludCBwcm9maXQ7CiAgICAgICAgaWYocmFmZmxlW193ZWVrXS5udW1FbnRyaWVzID4gMCkgewogICAgICAgICAgICBwcm9maXQgPSAoKHJhZmZsZVtfd2Vla10ubnVtRW50cmllcyAtIHJhZmZsZVtfd2Vla10uZnJlZUVudHJpZXMpICogdGt0UHJpY2UgKiB0YWtlKSAvIDEwMDA7CiAgICAgICAgICAgIHByaXplUG9vbCAtPSBwcm9maXQ7CiAgICAgICAgICAgIHVpbnQgaGFsZiA9IHByb2ZpdCAvIDI7CiAgICAgICAgICAgIFJlY2VpdmVySW50ZXJmYWNlKGRpc2J1cnNlQWRkcikucmVjZWl2ZUV0aGVyLnZhbHVlKGhhbGYpKCk7CiAgICAgICAgICAgIFJlY2VpdmVySW50ZXJmYWNlKGV0aFJlbGllZikucmVjZWl2ZUV0aGVyLnZhbHVlKHByb2ZpdCAtIGhhbGYpKCk7CiAgICAgICAgICAgIExvZ0Z1bmRzRGlzYnVyc2VkKF93ZWVrLCBvcmFjVG90LCBwcm9maXQgLSBoYWxmLCBldGhSZWxpZWYsIG5vdyk7CiAgICAgICAgICAgIExvZ0Z1bmRzRGlzYnVyc2VkKF93ZWVrLCBvcmFjVG90LCBoYWxmLCBkaXNidXJzZUFkZHIsIG5vdyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgTG9nRnVuZHNEaXNidXJzZWQoX3dlZWssIG9yYWNUb3QsIHByb2ZpdCwgMCwgbm93KTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICBUaGUgT3JhbGl6ZSBjYWxsIGJhY2sgZnVuY3Rpb24uIFRoZSBvcmFjYWxpemUgYXBpIGNhbGxzIGFyZQogICAgICogICAgICAgIHJlY3Vyc2l2ZS4gT25lIHRvIHJhbmRvbS5vcmcgZm9yIHRoZSBkcmF3IGFuZCB0aGUgb3RoZXIgdG8KICAgICAqICAgICAgICB0aGUgRXRoZXJhZmZsZSBhcGkgZm9yIHRoZSBudW1iZXJzIG9mIG1hdGNoZXMgZWFjaCBlbnRyeSBtYWRlCiAgICAgKiAgICAgICAgYWdhaW5zdCB0aGUgd2lubmluZyBudW1iZXJzLiBFYWNoIGNhbGxzIHRoZSBvdGhlciByZWN1cnNpdmVseS4KICAgICAqICAgICAgICBUaGUgZm9ybWVyIHdoZW4gY2FsbGVkYmFjayBjbG9zZXMgYW5kIHJlY2xhaW1zIGFueSB1bmNsYWltZWQKICAgICAqICAgICAgICBwcml6ZXBvb2wgZnJvbSB0aGUgcmFmZmxlIHRlbiB3ZWVrcyBwcmV2aW91cyB0byBub3cuIFRoZW4gaXQKICAgICAqICAgICAgICBkaXNidXJzZXMgcHJvZml0IHRvIHRoZSBkaXNidXJzYWwgY29udHJhY3QsIHRoZW4gaXQgc2V0cyB0aGUKICAgICAqICAgICAgICB3aW5uaW5nIG51bWJlcnMgcmVjZWl2ZWQgZnJvbSByYW5kb20ub3JnIGludG8gdGhlIHJhZmZsZQogICAgICogICAgICAgIHN0cnVjdC4gRmluYWxseSBpdCBwcmVwYXJlcyB0aGUgbmV4dCBvcmFjbGl6ZSBjYWxsLiBXaGljaAogICAgICogICAgICAgIGxhdHRlciBjYWxsYmFjayBmaXJzdCBzZXRzIHVwIHRoZSBuZXcgcmFmZmxlIHN0cnVjdCwgdGhlbgogICAgICogICAgICAgIHNldHMgdGhlIHBheW91dHMgYmFzZWQgb24gdGhlIG51bWJlciBvZiB3aW5uZXJzIGluIGVhY2ggdGllcgogICAgICogICAgICAgIHJldHVybmVkIGZyb20gdGhlIGFwaSBjYWxsLCB0aGVuIHByZXBhcmVzIHRoZSBuZXh0IG9yYWNsaXplCiAgICAgKiAgICAgICAgcXVlcnkgZm9yIGEgd2VlayBsYXRlciB0byBkcmF3IHRoZSBuZXh0IHJhZmZsZSdzIHdpbm5pbmcKICAgICAqICAgICAgICBudW1iZXJzLgogICAgICoKICAgICAqIEBwYXJhbSBfbXlJRCAgICAgYnl0ZXMzMiAtIFVuaXF1ZSBpZCBvcmFjbGl6ZSBwcm92aWRlcyB3aXRoIHRoZWlyCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MuCiAgICAgKiBAcGFyYW0gX3Jlc3VsdCAgIHN0cmluZyAtIFRoZSByZXN1bHQgb2YgdGhlIGFwaSBjYWxsLgogICAgICovCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgX215SUQsIHN0cmluZyBfcmVzdWx0KSBvbmx5SWZOb3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7CiAgICAgICAgTG9nT3JhY2xpemVDYWxsYmFjayhfbXlJRCwgX3Jlc3VsdCwgcUlEW19teUlEXS53ZWVrTm8sIG5vdyk7CiAgICAgICAgaWYocUlEW19teUlEXS5pc1JhbmRvbSA9PSB0cnVlKXsvL2lzIHJhbmRvbSBjYWxsYmFjay4uLgogICAgICAgICAgICByZWNsYWltVW5jbGFpbWVkKCk7CiAgICAgICAgICAgIGRpc2J1cnNlRnVuZHMocUlEW19teUlEXS53ZWVrTm8pOwogICAgICAgICAgICBzZXRXaW5uaW5nTnVtYmVycyhxSURbX215SURdLndlZWtObywgX3Jlc3VsdCk7CiAgICAgICAgICAgIGlmKHFJRFtfbXlJRF0uaXNNYW51YWwgPT0gdHJ1ZSkgeyByZXR1cm47IH0KICAgICAgICAgICAgYnl0ZXMzMiBxdWVyeSA9IG9yYWNsaXplX3F1ZXJ5KG1hdGNoZXNEZWxheSwgIm5lc3RlZCIsIHN0ckNvbmNhdChhcGlTdHIxLCB1aW50MnN0cihxSURbX215SURdLndlZWtObyksIGFwaVN0cjIpLCBnYXNBbXQpOwogICAgICAgICAgICBxSURbcXVlcnldLndlZWtObyA9IHFJRFtfbXlJRF0ud2Vla05vOwogICAgICAgICAgICBMb2dRdWVyeVNlbnQocXVlcnksIG1hdGNoZXNEZWxheSArIG5vdywgbm93KTsKICAgICAgICB9IGVsc2Ugey8vaXMgYXBpIGNhbGxiYWNrCiAgICAgICAgICAgIG5ld1JhZmZsZSgpOwogICAgICAgICAgICBzZXRQYXlPdXRzKHFJRFtfbXlJRF0ud2Vla05vLCBfcmVzdWx0KTsKICAgICAgICAgICAgaWYocUlEW19teUlEXS5pc01hbnVhbCA9PSB0cnVlKSB7IHJldHVybjsgfQogICAgICAgICAgICB1aW50IGRlbGF5ID0gKGdldFdlZWsoKSAqIHdlZWtEdXIpICsgYmlydGhkYXkgKyByYWZFbmQgKyByZXN1bHRzRGVsYXk7CiAgICAgICAgICAgIHF1ZXJ5ID0gb3JhY2xpemVfcXVlcnkoZGVsYXksICJuZXN0ZWQiLCBzdHJDb25jYXQocmFuZG9tU3RyMSwgdWludDJzdHIoZ2V0V2VlaygpKSwgcmFuZG9tU3RyMiksIGdhc0FtdCk7CiAgICAgICAgICAgIHFJRFtxdWVyeV0ud2Vla05vID0gZ2V0V2VlaygpOwogICAgICAgICAgICBxSURbcXVlcnldLmlzUmFuZG9tID0gdHJ1ZTsKICAgICAgICAgICAgTG9nUXVlcnlTZW50KHF1ZXJ5LCBkZWxheSwgbm93KTsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICBTbGljZXMgYSBzdHJpbmcgYWNjb3JkaW5nIHRvIHNwZWNpZmllZCBkZWxpbWl0ZXIsIHJldHVybmluZwogICAgICogICAgICAgIHRoZSBzbGljZWQgcGFydHMgaW4gYW4gYXJyYXkuCiAgICAgKgogICAgICogQHBhcmFtIF9zdHJpbmcgICBUaGUgc3RyaW5nIHRvIGJlIHNsaWNlZC4KICAgICAqLwogICAgZnVuY3Rpb24gc3RyaW5nVG9BcnJheShzdHJpbmcgX3N0cmluZykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nW10pIHsKICAgICAgICB2YXIgc3RyICAgID0gX3N0cmluZy50b1NsaWNlKCk7CiAgICAgICAgdmFyIGRlbGltICA9ICIsIi50b1NsaWNlKCk7CiAgICAgICAgdmFyIHBhcnRzICA9IG5ldyBzdHJpbmdbXShzdHIuY291bnQoZGVsaW0pICsgMSk7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwYXJ0c1tpXSA9IHN0ci5zcGxpdChkZWxpbSkudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcnRzOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICAgVGFrZXMgb3JhY2xpemUgcmFuZG9tLm9yZyBhcGkgY2FsbCByZXN1bHQgc3RyaW5nIGFuZCBzcGxpdHMKICAgICAqICAgICAgICBpdCBhdCB0aGUgY29tbWFzIGludG8gYW4gYXJyYXksIHBhcnNlcyB0aG9zZSBzdHJpbmdzIGluIHRoYXQKICAgICAqICAgICAgICBhcnJheSBhcyBpbnRlZ2VycyBhbmQgcHVzaGVzIHRoZW0gaW50byB0aGUgd2lubmluZyBudW1iZXJzCiAgICAgKiAgICAgICAgYXJyYXkgaW4gdGhlIHJhZmZsZSdzIHN0cnVjdC4gRmlyZXMgZXZlbnQgbG9nZ2luZyB0aGUgZGF0YSwKICAgICAqICAgICAgICBpbmNsdWRpbmcgdGhlIHNlcmlhbCBudW1iZXIgb2YgdGhlIHJhbmRvbS5vcmcgY2FsbGJhY2sgc28KICAgICAqICAgICAgICBpdHMgdmVyYWNpdHkgY2FuIGJlIHByb3Zlbi4KICAgICAqCiAgICAgKiBAcGFyYW0gX3dlZWsgICAgVGhlIHdlZWsgbnVtYmVyIG9mIHRoZSByYWZmbGUgaW4gcXVlc3Rpb24uCiAgICAgKiBAcGFyYW0gX3Jlc3VsdCAgIFRoZSByZXN1bHRzIHN0cmluZyBmcm9tIG9yYWNsaXplIGNhbGxiYWNrLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRXaW5uaW5nTnVtYmVycyh1aW50IF93ZWVrLCBzdHJpbmcgX3Jlc3VsdCkgaW50ZXJuYWwgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBhcnIgPSBzdHJpbmdUb0FycmF5KF9yZXN1bHQpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgcmFmZmxlW193ZWVrXS53aW5OdW1zLnB1c2gocGFyc2VJbnQoYXJyW2ldKSk7CiAgICAgICAgfQogICAgICAgIHVpbnQgc2VyaWFsTm8gPSBwYXJzZUludChhcnJbNl0pOwogICAgICAgIExvZ1dpbm5pbmdOdW1iZXJzKF93ZWVrLCByYWZmbGVbX3dlZWtdLm51bUVudHJpZXMsIHJhZmZsZVtfd2Vla10ud2luTnVtcywgcHJpemVQb29sLCBzZXJpYWxObywgbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgICBUYWtlcyB0aGUgcmVzdWx0cyBvZiB0aGUgb3JhY2xpemUgRXRoZXJhZmZsZSBhcGkgY2FsbCBiYWNrCiAgICAgKiAgICAgICAgYW5kIHVzZXMgdGhlbSB0byBjYWxjdWxhdGUgdGhlIHByaXplcyBkdWUgdG8gZWFjaCB0aWVyCiAgICAgKiAgICAgICAgKDMgbWF0Y2hlcywgNCBtYXRjaGVzIGV0YykgdGhlbiBwdXNoZXMgdGhlbSBpbnRvIHRoZSB3aW5uaW5nCiAgICAgKiAgICAgICAgYW1vdW50cyBhcnJheSBpbiB0aGUgcmFmZmxlIGluIHF1ZXN0aW9uJ3Mgc3RydWN0LiBDYWxjdWxhdGVzCiAgICAgKiAgICAgICAgdGhlIHRvdGFsIHdpbm5pbmdzIG9mIHRoZSByYWZmbGUsIHN1YnRyYWN0cyBpdCBmcm9tIHRoZQogICAgICogICAgICAgIGdsb2JhbCBwcml6ZSBwb29sIHNlcXVlc3RlcnMgdGhhdCBhbW91bnQgaW50byB0aGUgcmFmZmxlJ3MKICAgICAqICAgICAgICBzdHJ1Y3QgInVuY2xhaW1lZCIgdmFyaWFibGUsIOKItCAicm9sbGluZyBvdmVyIiB0aGUgdW53b24KICAgICAqICAgICAgICBldGhlci4gRW5hYmxlcyB3aW5uZXIgd2l0aGRyYXdhbHMgYnkgc2V0dGluZyB0aGUgd2l0aGRyYXcKICAgICAqICAgICAgICBvcGVuIGJvb2wgdG8gdHJ1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3dlZWsgICAgVGhlIHdlZWsgbnVtYmVyIG9mIHRoZSByYWZmbGUgaW4gcXVlc3Rpb24uCiAgICAgKiBAcGFyYW0gX3Jlc3VsdCAgVGhlIHJlc3VsdHMgc3RyaW5nIGZyb20gb3JhY2xpemUgY2FsbGJhY2suCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFBheU91dHModWludCBfd2Vlaywgc3RyaW5nIF9yZXN1bHQpIGludGVybmFsIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgbnVtV2lubmVyc1N0ciA9IHN0cmluZ1RvQXJyYXkoX3Jlc3VsdCk7CiAgICAgICAgaWYobnVtV2lubmVyc1N0ci5sZW5ndGggPCA0KSB7CiAgICAgICAgICBwYXVzZUNvbnRyYWN0KDIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB1aW50W10gbWVtb3J5IG51bVdpbm5lcnNJbnQgPSBuZXcgdWludFtdKDQpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICBudW1XaW5uZXJzSW50W2ldID0gcGFyc2VJbnQobnVtV2lubmVyc1N0cltpXSk7CiAgICAgICAgfQogICAgICAgIHVpbnRbXSBtZW1vcnkgcGF5T3V0cyA9IG5ldyB1aW50W10oNCk7CiAgICAgICAgdWludCB0b3RhbDsKICAgICAgICBmb3IoaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgICAgaWYobnVtV2lubmVyc0ludFtpXSAhPSAwKSB7CiAgICAgICAgICAgICAgICBwYXlPdXRzW2ldID0gKHByaXplUG9vbCAqIHBjdE9mUG9vbFtpXSkgLyAobnVtV2lubmVyc0ludFtpXSAqIDEwMDApOwogICAgICAgICAgICAgICAgdG90YWwgKz0gcGF5T3V0c1tpXSAqIG51bVdpbm5lcnNJbnRbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmFmZmxlW193ZWVrXS51bmNsYWltZWQgPSB0b3RhbDsKICAgICAgICBpZihyYWZmbGVbX3dlZWtdLnVuY2xhaW1lZCA+IHByaXplUG9vbCkgewogICAgICAgICAgcGF1c2VDb250cmFjdCgzKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcHJpemVQb29sIC09IHJhZmZsZVtfd2Vla10udW5jbGFpbWVkOwogICAgICAgIGZvcihpID0gMDsgaSA8IHBheU91dHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcmFmZmxlW193ZWVrXS53aW5BbXRzLnB1c2gocGF5T3V0c1tpXSk7CiAgICAgICAgfQogICAgICAgIHJhZmZsZVtfd2Vla10ud2RyYXdPcGVuID0gdHJ1ZTsKICAgICAgICBMb2dQcml6ZVBvb2xzVXBkYXRlZChwcml6ZVBvb2wsIF93ZWVrLCByYWZmbGVbX3dlZWtdLnVuY2xhaW1lZCwgcGF5T3V0c1swXSwgcGF5T3V0c1sxXSwgcGF5T3V0c1syXSwgcGF5T3V0c1szXSwgbm93KTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgIEZ1bmN0aW9uIGNvbXBhcmVzIGFycmF5IG9mIGVudHJhbnQncyA2IGNob3NlbiBudW1iZXJzIHRvCiAgICAgICogICAgICAgdGhlIHJhZmZsZSBpbiBxdWVzdGlvbidzIHdpbm5pbmcgbnVtYmVycywgY291bnRpbmcgaG93CiAgICAgICogICAgICAgbWFueSBtYXRjaGVzIHRoZXJlIGFyZS4KICAgICAgKgogICAgICAqIEBwYXJhbSBfd2VlayAgICAgICAgIFRoZSB3ZWVrIG51bWJlciBvZiB0aGUgUmFmZmxlIGluIHF1ZXN0aW9uCiAgICAgICogQHBhcmFtIF9lbnRyYW50ICAgICAgRW50cmFudCdzIGV0aGVyZXVtIGFkZHJlc3MKICAgICAgKiBAcGFyYW0gX2VudHJ5TnVtICAgICBudW1iZXIgb2YgZW50cmFudCdzIGVudHJ5IGluIHF1ZXN0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRNYXRjaGVzKHVpbnQgX3dlZWssIGFkZHJlc3MgX2VudHJhbnQsIHVpbnQgX2VudHJ5TnVtKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBtYXRjaGVzOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgICAgIGZvcih1aW50IGogPSAwOyBqIDwgNjsgaisrKSB7CiAgICAgICAgICAgICAgICBpZihyYWZmbGVbX3dlZWtdLmVudHJpZXNbX2VudHJhbnRdW19lbnRyeU51bSAtIDFdW2ldID09IHJhZmZsZVtfd2Vla10ud2luTnVtc1tqXSkgewogICAgICAgICAgICAgICAgICAgIG1hdGNoZXMrKzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbWF0Y2hlczsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgICAgTWFudWFsbHkgbWFrZSBhbiBPcmFjbGl6ZSBBUEkgY2FsbCwgaW5jYXNlIG9mIGF1dG9tYXRpb24KICAgICAqICAgICAgICAgIGZhaWx1cmUuIE9ubHkgY2FsbGFibGUgYnkgdGhlIEV0aGVyYWZmbGUgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2RlbGF5ICAgICAgRWl0aGVyIGEgdGltZSBpbiBzZWNvbmRzIGJlZm9yZSBkZXNpcmVkIGNhbGxiYWNrCiAgICAgKiAgICAgICAgICAgICAgICAgICAgdGltZSBmb3IgdGhlIEFQSSBjYWxsLCBvciBhIGZ1dHVyZSBVVEMgZm9ybWF0IHRpbWUgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgdGhlIGRlc2lyZWQgdGltZSBmb3IgdGhlIEFQSSBjYWxsYmFjay4KICAgICAqIEBwYXJhbSBfd2VlayAgICAgICBUaGUgd2VlayBudW1iZXIgdGhpcyBxdWVyeSBpcyBmb3IuCiAgICAgKiBAcGFyYW0gX2lzUmFuZG9tICAgV2hldGhlciBvciBub3QgdGhlIGFwaSBjYWxsIGJlaW5nIG1hZGUgaXMgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgdGhlIHJhbmRvbS5vcmcgcmVzdWx0cyBkcmF3LCBvciBmb3IgdGhlIEV0aGVyYWZmbGUKICAgICAqICAgICAgICAgICAgICAgICAgICBBUEkgcmVzdWx0cyBjYWxsLgogICAgICogQHBhcmFtIF9pc01hbnVhbCAgIFRoZSBPcmFjbGl6ZSBjYWxsIGJhY2sgaXMgYSByZWN1cnNpdmUgZnVuY3Rpb24gaW4KICAgICAqICAgICAgICAgICAgICAgICAgICB3aGljaCBlYWNoIGNhbGwgZmlyZXMgb2ZmIGFub3RoZXIgY2FsbCBpbiBwZXJwZXR1aXR5LgogICAgICogICAgICAgICAgICAgICAgICAgIFRoaXMgYm9vbCBhbGxvd3MgdGhhdCByZWN1cnNpdmVuZXNzIGZvciB0aGlzIGNhbGwgdG8gYmUKICAgICAqICAgICAgICAgICAgICAgICAgICB0dXJuZWQgb24gb3Igb2ZmIGRlcGVuZGluZyBvbiBjYWxsZXIncyByZXF1aXJlbWVudHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG1hbnVhbGx5TWFrZU9yYWNsaXplQ2FsbAogICAgKAogICAgICAgIHVpbnQgX3dlZWssCiAgICAgICAgdWludCBfZGVsYXksCiAgICAgICAgYm9vbCBfaXNSYW5kb20sCiAgICAgICAgYm9vbCBfaXNNYW51YWwKICAgICkKICAgICAgICBvbmx5RXRoZXJhZmZsZSBleHRlcm5hbAogICAgewogICAgICAgIHN0cmluZyBtZW1vcnkgd2Vla051bVN0ciA9IHVpbnQyc3RyKF93ZWVrKTsKICAgICAgICBpZihfaXNSYW5kb20gPT0gdHJ1ZSl7CiAgICAgICAgICAgIGJ5dGVzMzIgcXVlcnkgPSBvcmFjbGl6ZV9xdWVyeShfZGVsYXksICJuZXN0ZWQiLCBzdHJDb25jYXQocmFuZG9tU3RyMSwgd2Vla051bVN0ciwgcmFuZG9tU3RyMiksIGdhc0FtdCk7CiAgICAgICAgICAgIHFJRFtxdWVyeV0ud2Vla05vICAgPSBfd2VlazsKICAgICAgICAgICAgcUlEW3F1ZXJ5XS5pc1JhbmRvbSA9IHRydWU7CiAgICAgICAgICAgIHFJRFtxdWVyeV0uaXNNYW51YWwgPSBfaXNNYW51YWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcXVlcnkgPSBvcmFjbGl6ZV9xdWVyeShfZGVsYXksICJuZXN0ZWQiLCBzdHJDb25jYXQoYXBpU3RyMSwgd2Vla051bVN0ciwgYXBpU3RyMiksIGdhc0FtdCk7CiAgICAgICAgICAgIHFJRFtxdWVyeV0ud2Vla05vICAgPSBfd2VlazsKICAgICAgICAgICAgcUlEW3F1ZXJ5XS5pc01hbnVhbCA9IF9pc01hbnVhbDsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgU2V0IHRoZSBnYXMgcmVsZXZhbnQgcHJpY2UgcGFyYW1ldGVycyBmb3IgdGhlIE9yYWNsaXplIGNhbGxzLCBpbiBjYXNlCiAgICAgKiAgICAgIG9mIGZ1dHVyZSBuZWVkcyBmb3IgaGlnaGVyIGdhcyBwcmljZXMgZm9yIGFkZXF1YXRlIHRyYW5zYWN0aW9uIHRpbWVzLAogICAgICogICAgICBvciBpbmNhc2Ugb2YgT3JhY2xpemUgcHJpY2UgaGlrZXMuIE9ubHkgY2FsbGFibGUgYmUgdGhlIEV0aGVyYWZmbGUKICAgICAqICAgICAgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX25ld0FtdCAgICB1aW50IC0gbmV3IGFsbG93ZWQgZ2FzIGFtb3VudCBmb3IgT3JhY2xpemUuCiAgICAgKiBAcGFyYW0gX25ld1ByaWNlICB1aW50IC0gbmV3IGdhcyBwcmljZSBmb3IgT3JhY2xpemUuCiAgICAgKiBAcGFyYW0gX25ld0Nvc3QgICB1aW50IC0gbmV3IGNvc2Ugb2YgT3JhY2xpemUgc2VydmljZS4KICAgICAqCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEdhc0Zvck9yYWNsaXplCiAgICAoCiAgICAgICAgdWludCBfbmV3QW10LAogICAgICAgIHVpbnQgX25ld0Nvc3QsCiAgICAgICAgdWludCBfbmV3UHJpY2UKICAgICkKICAgICAgICBvbmx5RXRoZXJhZmZsZSBleHRlcm5hbAogICAgewogICAgICAgIGdhc0FtdCAgID0gX25ld0FtdDsKICAgICAgICBvcmFjQ29zdCA9IF9uZXdDb3N0OwogICAgICAgIGlmKF9uZXdQcmljZSA+IDApIHsKICAgICAgICAgICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoX25ld1ByaWNlKTsKICAgICAgICAgICAgZ2FzUHJjID0gX25ld1ByaWNlOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQGRldiAgICBTZXQgdGhlIE9yYWNsaXplIHN0cmluZ3MsIGluIGNhc2Ugb2YgdXJsIGNoYW5nZXMuIE9ubHkgY2FsbGFibGUgYnkKICAgICAqICAgICAgICAgdGhlIEV0aGVyYWZmbGUgYWRkcmVzcyAgLgogICAgICoKICAgICAqIEBwYXJhbSBfbmV3UmFuZG9tSGFsZk9uZSAgICAgICBzdHJpbmcgLSB3aXRoIHByb3Blcmx5IGVzY2FwZWQgY2hhcmFjdGVycyBmb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgZmlyc3QgaGFsZiBvZiB0aGUgcmFuZG9tLm9yZyBjYWxsIHN0cmluZy4KICAgICAqIEBwYXJhbSBfbmV3UmFuZG9tSGFsZlR3byAgICAgICBzdHJpbmcgLSB3aXRoIHByb3Blcmx5IGVzY2FwZWQgY2hhcmFjdGVycyBmb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc2Vjb25kIGhhbGYgb2YgdGhlIHJhbmRvbS5vcmcgY2FsbCBzdHJpbmcuCiAgICAgKiBAcGFyYW0gX25ld0V0aGVyYWZmbGVIYWxmT25lICAgc3RyaW5nIC0gd2l0aCBwcm9wZXJseSBlc2NhcGVkIGNoYXJhY3RlcnMgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IGhhbGYgb2YgdGhlIEV0aGVyYWZmbGVBUEkgY2FsbCBzdHJpbmcuCiAgICAgKiBAcGFyYW0gX25ld0V0aGVyYWZmbGVIYWxmVHdvICAgc3RyaW5nIC0gd2l0aCBwcm9wZXJseSBlc2NhcGVkIGNoYXJhY3RlcnMgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHNlY29uZCBoYWxmIG9mIHRoZSBFdGhlcmFmZmxlQVBJIGNhbGwgc3RyaW5nLgogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gc2V0T3JhY2xpemVTdHJpbmcKICAgICgKICAgICAgICBzdHJpbmcgX25ld1JhbmRvbUhhbGZPbmUsCiAgICAgICAgc3RyaW5nIF9uZXdSYW5kb21IYWxmVHdvLAogICAgICAgIHN0cmluZyBfbmV3RXRoZXJhZmZsZUhhbGZPbmUsCiAgICAgICAgc3RyaW5nIF9uZXdFdGhlcmFmZmxlSGFsZlR3bwogICAgKQogICAgICAgIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsCiAgICB7CiAgICAgICAgcmFuZG9tU3RyMSA9IF9uZXdSYW5kb21IYWxmT25lOwogICAgICAgIHJhbmRvbVN0cjIgPSBfbmV3UmFuZG9tSGFsZlR3bzsKICAgICAgICBhcGlTdHIxICAgID0gX25ld0V0aGVyYWZmbGVIYWxmT25lOwogICAgICAgIGFwaVN0cjIgICAgPSBfbmV3RXRoZXJhZmZsZUhhbGZUd287CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICBTZXQgdGhlIHRpY2tldCBwcmljZSBvZiB0aGUgcmFmZmxlLiBPbmx5IGNhbGxhYmxlIGJ5IHRoZQogICAgICogICAgICAgIEV0aGVyYWZmbGUgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX25ld1ByaWNlICAgdWludCAtIFRoZSBkZXNpcmVkIG5ldyB0aWNrZXQgcHJpY2UuCiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBzZXRUa3RQcmljZSh1aW50IF9uZXdQcmljZSkgb25seUV0aGVyYWZmbGUgZXh0ZXJuYWwgewogICAgICAgIHRrdFByaWNlID0gX25ld1ByaWNlOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICAgIFNldCBuZXcgdGFrZSBwZXJjZW50YWdlLiBPbmx5IGNhbGxhYmxlIGJ5IHRoZSBFdGhlcmFmZmxlCiAgICAgKiAgICAgICAgIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIF9uZXdUYWtlICAgdWludCAtIFRoZSBkZXNpcmVkIG5ldyB0YWtlLCBwYXJ0cyBwZXIgdGhvdXNhbmQuCiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBzZXRUYWtlKHVpbnQgX25ld1Rha2UpIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICB0YWtlID0gX25ld1Rha2U7CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICAgIFNldCB0aGUgcGF5b3V0cyBtYW51YWxseSwgaW4gY2FzZSBvZiBhIGZhaWxlZCBPcmFjbGl6ZSBjYWxsLgogICAgICogICAgICAgICAgT25seSBjYWxsYWJsZSBieSB0aGUgRXRoZXJhZmZsZSBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfd2VlayAgICAgICAgIFRoZSB3ZWVrIG51bWJlciBvZiB0aGUgcmFmZmxlIHRvIHNldCB0aGUgcGF5b3V0cyBmb3IuCiAgICAgKiBAcGFyYW0gX251bU1hdGNoZXMgICBOdW1iZXIgb2YgbWF0Y2hlcy4gQ29tbWEtc2VwYXJhdGVkIFNUUklORyBvZiA0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICBpbnRlZ2VycyBsb25nLCBjb25zaXN0aW5nIG9mIHRoZSBudW1iZXIgb2YgMyBtYXRjaAogICAgICogICAgICAgICAgICAgICAgICAgICAgd2lubmVycywgNCBtYXRjaCB3aW5uZXJzLCA1ICYgNiBtYXRjaCB3aW5uZXJzIGluCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICB0aGF0IG9yZGVyLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRQYXlvdXRzKHVpbnQgX3dlZWssIHN0cmluZyBfbnVtTWF0Y2hlcykgb25seUV0aGVyYWZmbGUgZXh0ZXJuYWwgewogICAgICAgIHNldFBheU91dHMoX3dlZWssIF9udW1NYXRjaGVzKTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgIFNldCB0aGUgRnJlZUxPVCB0b2tlbiBjb250cmFjdCBhZGRyZXNzLCBpbiBjYXNlIG9mIGZ1dHVyZSB1cGRyYWRlcy4KICAgICAqICAgICAgICBPbmx5IGFsbGFibGUgYnkgdGhlIEV0aGVyYWZmbGUgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX25ld0FkZHIgICBOZXcgYWRkcmVzcyBvZiBGcmVlTE9UIGNvbnRyYWN0LgogICAgICovCiAgICBmdW5jdGlvbiBzZXRGcmVlTE9UKGFkZHJlc3MgX25ld0FkZHIpIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICBmcmVlTE9UID0gRnJlZUxPVEludGVyZmFjZShfbmV3QWRkcik7CiAgICAgIH0KICAgIC8qKgogICAgICogQGRldiAgIFNldCB0aGUgRXRoUmVsaWVmIGNvbnRyYWN0IGFkZHJlc3MsIGFuZCBnYXMgcmVxdWlyZWQgdG8gcnVuCiAgICAgKiAgICAgICAgdGhlIHJlY2VpdmluZyBmdW5jdGlvbi4gT25seSBhbGxhYmxlIGJ5IHRoZSBFdGhlcmFmZmxlIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIF9uZXdBZGRyICAgTmV3IGFkZHJlc3Mgb2YgdGhlIEV0aFJlbGllZiBjb250cmFjdC4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0RXRoUmVsaWVmKGFkZHJlc3MgX25ld0FkZHIpIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICBldGhSZWxpZWYgPSBfbmV3QWRkcjsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgIFNldCB0aGUgZGl2aWRlbmQgY29udHJhY3QgYWRkcmVzcywgYW5kIGdhcyByZXF1aXJlZCB0byBydW4KICAgICAqICAgICAgICB0aGUgcmVjZWl2ZSBldGhlciBmdW5jdGlvbi4gT25seSBjYWxsYWJsZSBieSB0aGUgRXRoZXJhZmZsZQogICAgICogICAgICAgIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIF9uZXdBZGRyICAgTmV3IGFkZHJlc3Mgb2YgZGl2aWRlbmQgY29udHJhY3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldERpc2J1cnNpbmdBZGRyKGFkZHJlc3MgX25ld0FkZHIpIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICBkaXNidXJzZUFkZHIgPSBfbmV3QWRkcjsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgIFNldCB0aGUgRXRoZXJhZmZsZSBtdWx0aXNpZyBjb250cmFjdCBhZGRyZXNzLCBpbiBjYXNlIG9mIGZ1dHVyZQogICAgICogICAgICAgIHVwZ3JhZGVzLiBPbmx5IGNhbGxhYmxlIGJ5IHRoZSBjdXJyZW50IEV0aGVyYWZmbGUgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX25ld0FkZHIgICBOZXcgYWRkcmVzcyBvZiBFdGhlcmFmZmxlIG11bHRpc2lnIGNvbnRyYWN0LgogICAgICovCiAgICBmdW5jdGlvbiBzZXRFdGhlcmFmZmxlKGFkZHJlc3MgX25ld0FkZHIpIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICBldGhlcmFmZmxlID0gX25ld0FkZHI7CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICAgIFNldCB0aGUgcmFmZmxlIGVuZCB0aW1lLCBpbiBudW1iZXIgb2Ygc2Vjb25kcyBwYXNzZWQKICAgICAqICAgICAgICAgIHRoZSBzdGFydCB0aW1lIG9mIDAwOjAwYW0gTW9uZGF5LiBPbmx5IGNhbGxhYmxlIGJ5CiAgICAgKiAgICAgICAgICB0aGUgRXRoZXJhZmZsZSBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfbmV3VGltZSAgICBUaGUgdGltZSBkZXNpcmVkIGluIHNlY29uZHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFJhZkVuZCh1aW50IF9uZXdUaW1lKSBvbmx5RXRoZXJhZmZsZSBleHRlcm5hbCB7CiAgICAgICAgcmFmRW5kID0gX25ld1RpbWU7CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICAgIFNldCB0aGUgd2RyYXdCZnIgdGltZSAtIHRoZSB0aW1lIGEgd2lubmVyIGhhcyB0byB3aXRoZHJhdwogICAgICogICAgICAgICAgdGhlaXIgd2lubmluZ3MgYmVmb3JlIHRoZSB1bmNsYWltZWQgcHJpemVwb29sIGlzIHJvbGxlZAogICAgICogICAgICAgICAgYmFjayBpbnRvIHRoZSBnbG9iYWwgcHJpemVwb29sLiBPbmx5IGNhbGxhYmxlIGJ5IHRoZQogICAgICogICAgICAgICAgRXRoZXJhZmZsZSBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfbmV3VGltZSAgICBUaGUgdGltZSBkZXNpcmVkIGluIHNlY29uZHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFdpdGhkcmF3QmVmb3JlVGltZSh1aW50IF9uZXdUaW1lKSBvbmx5RXRoZXJhZmZsZSBleHRlcm5hbCB7CiAgICAgICAgd2RyYXdCZnIgPSBfbmV3VGltZTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgICAgU2V0IHRoZSBwYXVzZWQgc3RhdHVzIG9mIHRoZSByYWZmbGVzLiBPbmx5IGNhbGxhYmxlIGJ5CiAgICAgKiAgICAgICAgICB0aGUgRXRoZXJhZmZsZSBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfc3RhdHVzICAgIFRoZSBkZXNpcmVkIHN0YXR1cyBvZiB0aGUgcmFmZmxlcy4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0UGF1c2VkKGJvb2wgX3N0YXR1cykgb25seUV0aGVyYWZmbGUgZXh0ZXJuYWwgewogICAgICAgIHBhdXNlZCA9IF9zdGF0dXM7CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICAgIFNldCB0aGUgcGVyY2VudGFnZS1vZi1wcml6ZXBvb2wgYXJyYXkuIE9ubHkgY2FsbGFibGUgYnkgdGhlCiAgICAgKiAgICAgICAgICBFdGhlcmFmZmxlIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIF9uZXdQb1AgICAgIEFuIGFycmF5IG9mIGZvdXIgaW50ZWdlcnMgdG90YWxsaW5nIDEwMDAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFBlcmNlbnRPZlBvb2wodWludFtdIF9uZXdQb1ApIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICBwY3RPZlBvb2wgPSBfbmV3UG9QOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICAgICBHZXQgYSBlbnRyYW50J3MgbnVtYmVyIG9mIGVudHJpZXMgaW50byBhIHNwZWNpZmljIHJhZmZsZQogICAgICoKICAgICAqIEBwYXJhbSBfd2VlayAgICAgICBUaGUgd2VlayBudW1iZXIgb2YgdGhlIHF1ZXJpZWQgcmFmZmxlLgogICAgICogQHBhcmFtIF9lbnRyYW50ICAgIFRoZSBlbnRyYW50IGluIHF1ZXN0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRVc2VyTnVtRW50cmllcyhhZGRyZXNzIF9lbnRyYW50LCB1aW50IF93ZWVrKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJhZmZsZVtfd2Vla10uZW50cmllc1tfZW50cmFudF0ubGVuZ3RoOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICAgICBHZXQgY2hvc2VuIG51bWJlcnMgb2YgYW4gZW50cmFudCwgZm9yIGEgc3BlY2lmaWMgcmFmZmxlLgogICAgICogICAgICAgICAgUmV0dXJucyBhbiBhcnJheS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2VudHJhbnQgICAgVGhlIGVudHJhbnQgaW4gcXVlc3Rpb24ncyBhZGRyZXNzLgogICAgICogQHBhcmFtIF93ZWVrICAgICAgIFRoZSB3ZWVrIG51bWJlciBvZiB0aGUgcXVlcmllZCByYWZmbGUuCiAgICAgKiBAcGFyYW0gX2VudHJ5TnVtICAgVGhlIGVudHJhbnQncyBlbnRyeSBudW1iZXIgaW4gdGhpcyByYWZmbGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldENob3Nlbk51bWJlcnMoYWRkcmVzcyBfZW50cmFudCwgdWludCBfd2VlaywgdWludCBfZW50cnlOdW0pIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnRbXSkgewogICAgICAgIHJldHVybiByYWZmbGVbX3dlZWtdLmVudHJpZXNbX2VudHJhbnRdW19lbnRyeU51bS0xXTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgICAgR2V0IHdpbm5pbmcgZGV0YWlscyBvZiBhIHJhZmZsZSwgaWUsIGl0J3Mgd2lubmluZyBudW1iZXJzCiAgICAgKiAgICAgICAgICBhbmQgdGhlIHByaXplIGFtb3VudHMuIFJldHVybnMgdHdvIGFycmF5cy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3dlZWsgICBUaGUgd2VlayBudW1iZXIgb2YgdGhlIHJhZmZsZSBpbiBxdWVzdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0V2lubmluZ0RldGFpbHModWludCBfd2VlaykgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludFtdLCB1aW50W10pIHsKICAgICAgICByZXR1cm4gKHJhZmZsZVtfd2Vla10ud2luTnVtcywgcmFmZmxlW193ZWVrXS53aW5BbXRzKTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgICAgVXBncmFkZXMgdGhlIEV0aGVyYWZmbGUgY29udHJhY3QuIE9ubHkgY2FsbGFibGUgYnkgdGhlCiAgICAgKiAgICAgICAgICBFdGhlcmFmZmxlIGFkZHJlc3MuIENhbGxzIGFuIGFkZFRvUHJpemVQb29sIG1ldGhvZCBhcwogICAgICogICAgICAgICAgcGVyIHRoZSBhYnN0cmFjdCBjb250cmFjdCBhYm92ZS4gRnVuY3Rpb24gcmVuZGVycyB0aGUKICAgICAqICAgICAgICAgIGVudHJ5IG1ldGhvZCB1bmNhbGxhYmxlLCBjYW5jZWxzIHRoZSBPcmFjbGl6ZSByZWN1cnNpb24sCiAgICAgKiAgICAgICAgICB0aGVuIHplcm9lcyB0aGUgcHJpemVwb29sIGFuZCBzZW5kcyB0aGUgZnVuZHMgdG8gdGhlIG5ldwogICAgICogICAgICAgICAgY29udHJhY3QuIFNldHMgYSB2YXIgdHJhY2tpbmcgd2hlbiB1cGdyYWRlIG9jY3VycmVkIGFuZCBsb2dzCiAgICAgKiAgICAgICAgICB0aGUgZXZlbnQuCiAgICAgKgogICAgICogQHBhcmFtIF9uZXdBZGRyICAgVGhlIG5ldyBjb250cmFjdCBhZGRyZXNzLgogICAgICovCiAgICBmdW5jdGlvbiB1cGdyYWRlQ29udHJhY3QoYWRkcmVzcyBfbmV3QWRkcikgb25seUV0aGVyYWZmbGUgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUodXBncmFkZWQgPT0gMCAmJiB1cGdyYWRlQWRkciA9PSBhZGRyZXNzKDApKTsKICAgICAgICB1aW50IGFtdCAgICA9IHByaXplUG9vbDsKICAgICAgICB1cGdyYWRlQWRkciA9IF9uZXdBZGRyOwogICAgICAgIHVwZ3JhZGVkICAgID0gbm93OwogICAgICAgIHdlZWsgICAgICAgID0gMDsvL25vIHN0cnVjdCBmb3IgdGhpcyByYWZmbGUg4oi0IG5vIHRpbWVzdGFtcCDiiLQgbm8gZW50cnkgcG9zc2libGUKICAgICAgICBwcml6ZVBvb2wgICA9IDA7CiAgICAgICAgZ2FzQW10ICAgICAgPSAwOy8vd2lsbCBhcnJlc3QgdGhlIG9yYWNsaXplIHJlY3Vyc2l2ZSBjYWxsYmFja3MKICAgICAgICBhcGlTdHIxICAgICA9ICIiOwogICAgICAgIHJhbmRvbVN0cjEgID0gIiI7CiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gYW10KTsKICAgICAgICBFdGhlcmFmZmxlVXBncmFkZShfbmV3QWRkcikuYWRkVG9Qcml6ZVBvb2wudmFsdWUoYW10KSgpOwogICAgICAgIExvZ1VwZ3JhZGUoX25ld0FkZHIsIGFtdCwgdXBncmFkZWQpOwogICAgfQogICAgLyoqCiAgICAgKiBAZGV2ICAgICBTZWxmIGRlc3RydWN0IGNvbnRyYWN0LiBPbmx5IGNhbGxhYmxlIGJ5IEV0aGVyYWZmbGUgYWRkcmVzcy4KICAgICAqICAgICAgICAgIGZ1bmN0aW9uLiBJdCBkZWxldGVzIGFsbCBjb250cmFjdCBjb2RlIGFuZCBkYXRhIGFuZCBmb3J3YXJkcwogICAgICogICAgICAgICAgYW55IHJlbWFpbmluZyBldGhlciBmcm9tIG5vbi1jbGFpbWVkIHdpbm5pbmcgcmFmZmxlIHRpY2tldHMKICAgICAqICAgICAgICAgIHRvIHRoZSBFdGhSZWxpZWYgY2hhcml0eSBjb250cmFjdC4gUmVxdWlyZXMgdGhlIHVwZ3JhZGUgY29udHJhY3QKICAgICAqICAgICAgICAgIG1ldGhvZCB0byBoYXZlIGJlZW4gY2FsbGVkIDEwIG9yIG1vcmUgd2Vla3MgcHJpb3IsIHRvIGFsbG93CiAgICAgKiAgICAgICAgICB3aW5uaW5nIHRpY2tldHMgdG8gYmUgY2xhaW1lZCB3aXRoaW4gdGhlIHVzdWFsIHdpdGhkcmF3YWwgdGltZQogICAgICogICAgICAgICAgZnJhbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbGZEZXN0cnVjdCgpIG9ubHlFdGhlcmFmZmxlIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG5vdyAtIHVwZ3JhZGVkID4gd2Vla0R1ciAqIDEwKTsKICAgICAgICBzZWxmZGVzdHJ1Y3QoZXRoUmVsaWVmKTsKICAgIH0KICAgIC8qKgogICAgICogQGRldiAgICAgRnVuY3Rpb24gYWxsb3dpbmcgbWFudWFsIGFkZGl0aW9uIHRvIHRoZSBnbG9iYWwgcHJpemVwb29sLgogICAgICogICAgICAgICAgUmVxdWlyZXMgdGhlIGNhbGxlciB0byBzZW5kIGV0aGVyLgogICAgICovCiAgICBmdW5jdGlvbiBhZGRUb1ByaXplUG9vbCgpIHBheWFibGUgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgcHJpemVQb29sICs9IG1zZy52YWx1ZTsKICAgICAgICBMb2dQcml6ZVBvb2xBZGRpdGlvbihtc2cuc2VuZGVyLCBtc2cudmFsdWUsIG5vdyk7CiAgICB9CiAgICAvKioKICAgICAqIEBkZXYgICBGYWxsYmFjayBmdW5jdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSBleHRlcm5hbCB7fQp9'.
	

]
