Class {
	#name : #SRT5f9b61e7d7a7da4f8cd5f5c91eb935993e2d01ef,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5f9b61e7d7a7da4f8cd5f5c91eb935993e2d01ef >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBXb2xmIENyeXB0byBwb29saW5nIGNvbnRyYWN0IGZvciBOZXhvCi8vIHdyaXR0ZW4gYnkgQGlhbWRlZmluaXRlbHlhaHVtYW4KCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgoKY29udHJhY3QgRVJDMjAgewogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7fQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQp9CgoKY29udHJhY3QgV2hpdGVMaXN0IHsKICAgZnVuY3Rpb24gY2hlY2tNZW1iZXJMZXZlbCAoYWRkcmVzcyBhZGRyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50KSB7fQp9CgoKY29udHJhY3QgUHJlc2FsZVBvb2wgewoKICAvLyBTYWZlTWF0aCBpcyBhIGxpYnJhcnkgdG8gZW5zdXJlIHRoYXQgbWF0aCBvcGVyYXRpb25zIGRvIG5vdCBoYXZlIG92ZXJmbG93IGVycm9ycwogIC8vIGh0dHBzOi8vemVwcGVsaW4tc29saWRpdHkucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L3NhZmVtYXRoLmh0bWwKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKICAKICAvLyBUaGUgY29udHJhY3QgaGFzIDMgc3RhZ2VzOgogIC8vIDEgLSBUaGUgaW5pdGlhbCBzdGF0ZS4gVGhlIG93bmVyIGlzIGFibGUgdG8gYWRkIGFkZHJlc3NlcyB0byB0aGUgd2hpdGVsaXN0LCBhbmQgYW55IHdoaXRlbGlzdGVkIGFkZHJlc3NlcyBjYW4gZGVwb3NpdCBvciB3aXRoZHJhdyBldGggdG8gdGhlIGNvbnRyYWN0LgogIC8vIDIgLSBUaGUgb3duZXIgaGFzIGNsb3NlZCB0aGUgY29udHJhY3QgZm9yIGZ1cnRoZXIgZGVwb3NpdHMuIFdoaXRlbGlzdGVkIGFkZHJlc3NlcyBjYW4gc3RpbGwgd2l0aGRyYXcgZXRoIGZyb20gdGhlIGNvbnRyYWN0LgogIC8vIDMgLSBUaGUgZXRoIGlzIHNlbnQgZnJvbSB0aGUgY29udHJhY3QgdG8gdGhlIHJlY2VpdmVyLiBVbnVzZWQgZXRoIGNhbiBiZSBjbGFpbWVkIGJ5IGNvbnRyaWJ1dG9ycyBpbW1lZGlhdGVseS4gT25jZSB0b2tlbnMgYXJlIHNlbnQgdG8gdGhlIGNvbnRyYWN0LAogIC8vICAgICB0aGUgb3duZXIgZW5hYmxlcyB3aXRoZHJhd2FscyBhbmQgY29udHJpYnV0b3JzIGNhbiB3aXRoZHJhdyB0aGVpciB0b2tlbnMuCiAgdWludDggcHVibGljIGNvbnRyYWN0U3RhZ2UgPSAxOwogIAogIC8vIFRoZXNlIHZhcmlhYmxlcyBhcmUgc2V0IGF0IHRoZSB0aW1lIG9mIGNvbnRyYWN0IGNyZWF0aW9uCiAgLy8gYWRkcmVzcyB0aGF0IGNyZWF0ZXMgdGhlIGNvbnRyYWN0CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgLy8gbWF4aW11bSBldGggYW1vdW50IChpbiB3ZWkpIHRoYXQgY2FuIGJlIHNlbnQgYnkgYSB3aGl0ZWxpc3RlZCBhZGRyZXNzCiAgdWludFtdIHB1YmxpYyBjb250cmlidXRpb25DYXBzOwogIC8vIHRoZSAlIG9mIHRva2VucyBrZXB0IGJ5IHRoZSBjb250cmFjdCBvd25lcgogIHVpbnQgcHVibGljIGZlZVBjdDsKICAvLyB0aGUgYWRkcmVzcyB0aGF0IHRoZSBwb29sIHdpbGwgYmUgcGFpZCBvdXQgdG8KICBhZGRyZXNzIHB1YmxpYyByZWNlaXZlckFkZHJlc3M7CiAgCiAgLy8gVGhlc2UgY29uc3RhbnQgdmFyaWFibGVzIGRvIG5vdCBjaGFuZ2Ugd2l0aCBlYWNoIGNvbnRyYWN0IGRlcGxveW1lbnQKICAvLyBtaW5pbXVtIGV0aCBhbW91bnQgKGluIHdlaSkgdGhhdCBjYW4gYmUgc2VudCBieSBhIHdoaXRlbGlzdGVkIGFkZHJlc3MKICB1aW50IGNvbnN0YW50IHB1YmxpYyBjb250cmlidXRpb25NaW4gPSAxMDAwMDAwMDAwMDAwMDAwMDA7CiAgLy8gbWF4aW11bSBnYXMgcHJpY2UgYWxsb3dlZCBmb3IgZGVwb3NpdHMgaW4gc3RhZ2UgMQogIHVpbnQgY29uc3RhbnQgcHVibGljIG1heEdhc1ByaWNlID0gNTAwMDAwMDAwMDA7CiAgLy8gd2hpdGVsaXN0aW5nIGNvbnRyYWN0CiAgV2hpdGVMaXN0IGNvbnN0YW50IHB1YmxpYyB3aGl0ZWxpc3RDb250cmFjdCA9IFdoaXRlTGlzdCgweDhEOTVCMDM4Y0E4MEE5ODY0MjVGQTI0MEMzQzE3RmIyQjZlOWJjNjMpOwogIAogIAogIC8vIFRoZXNlIHZhcmlhYmxlcyBhcmUgYWxsIGluaXRpYWxseSBzZXQgdG8gMCBhbmQgd2lsbCBiZSBzZXQgYXQgc29tZSBwb2ludCBkdXJpbmcgdGhlIGNvbnRyYWN0CiAgLy8gZXBvY2ggdGltZSB0aGF0IHRoZSBuZXh0IGNvbnRyaWJ1dGlvbiBjYXBzIGJlY29tZSBhY3RpdmUKICB1aW50IHB1YmxpYyBuZXh0Q2FwVGltZTsKICAvLyBwZW5kaW5nIGNvbnRyaWJ1dGlvbiBjYXBzCiAgdWludCBbXSBwdWJsaWMgbmV4dENvbnRyaWJ1dGlvbkNhcHM7CiAgLy8gYmxvY2sgbnVtYmVyIG9mIHRoZSBsYXN0IGNoYW5nZSB0byB0aGUgcmVjZWl2aW5nIGFkZHJlc3MgKHNldCBpZiByZWNlaXZpbmcgYWRkcmVzcyBpcyBjaGFuZ2VkLCBzdGFnZSAxIG9yIDIpCiAgdWludCBwdWJsaWMgYWRkcmVzc0NoYW5nZUJsb2NrOwogIC8vIGFtb3VudCBvZiBldGggKGluIHdlaSkgcHJlc2VudCBpbiB0aGUgY29udHJhY3Qgd2hlbiBpdCB3YXMgc3VibWl0dGVkCiAgdWludCBwdWJsaWMgZmluYWxCYWxhbmNlOwogIC8vIGFycmF5IGNvbnRhaW5pbmcgZXRoIGFtb3VudHMgdG8gYmUgcmVmdW5kZWQgaW4gc3RhZ2UgMwogIHVpbnRbXSBwdWJsaWMgZXRoUmVmdW5kQW1vdW50OwogIC8vIGRlZmF1bHQgdG9rZW4gY29udHJhY3QgdG8gYmUgdXNlZCBmb3Igd2l0aGRyYXdpbmcgdG9rZW5zIGluIHN0YWdlIDMKICBhZGRyZXNzIHB1YmxpYyBhY3RpdmVUb2tlbjsKICAKICAvLyBkYXRhIHN0cnVjdHVyZSBmb3IgaG9sZGluZyB0aGUgY29udHJpYnV0aW9uIGFtb3VudCwgY2FwLCBldGggcmVmdW5kIHN0YXR1cywgYW5kIHRva2VuIHdpdGhkcmF3YWwgc3RhdHVzIGZvciBlYWNoIHdoaXRlbGlzdGVkIGFkZHJlc3MKICBzdHJ1Y3QgQ29udHJpYnV0b3IgewogICAgYm9vbCBhdXRob3JpemVkOwogICAgdWludCBldGhSZWZ1bmQ7CiAgICB1aW50IGJhbGFuY2U7CiAgICB1aW50IGNhcDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgdG9rZW5zQ2xhaW1lZDsKICB9CiAgLy8gbWFwcGluZyB0aGF0IGhvbGRzIHRoZSBjb250cmlidXRvciBzdHJ1Y3QgZm9yIGVhY2ggd2hpdGVsaXN0ZWQgYWRkcmVzcwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ29udHJpYnV0b3IpIHdoaXRlbGlzdDsKICAKICAvLyBkYXRhIHN0cnVjdHVyZSBmb3IgaG9sZGluZyBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHRva2VuIHdpdGhkcmF3YWxzLgogIHN0cnVjdCBUb2tlbkFsbG9jYXRpb24gewogICAgRVJDMjAgdG9rZW47CiAgICB1aW50W10gcGN0OwogICAgdWludCBiYWxhbmNlUmVtYWluaW5nOwogIH0KICAvLyBtYXBwaW5nIHRoYXQgaG9sZHMgdGhlIHRva2VuIGFsbG9jYXRpb24gc3RydWN0IGZvciBlYWNoIHRva2VuIGFkZHJlc3MKICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuQWxsb2NhdGlvbikgZGlzdHJpYnV0aW9uTWFwOwogIAogIAogIC8vIG1vZGlmaWVyIGZvciBmdW5jdGlvbnMgdGhhdCBjYW4gb25seSBiZSBhY2Nlc3NlZCBieSB0aGUgY29udHJhY3QgY3JlYXRvcgogIG1vZGlmaWVyIG9ubHlPd25lciAoKSB7CiAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQogIAogIC8vIG1vZGlmaWVyIHRvIHByZXZlbnQgcmUtZW50cmFuY3kgZXhwbG9pdHMgZHVyaW5nIGNvbnRyYWN0ID4gY29udHJhY3QgaW50ZXJhY3Rpb24KICBib29sIGxvY2tlZDsKICBtb2RpZmllciBub1JlZW50cmFuY3koKSB7CiAgICByZXF1aXJlKCFsb2NrZWQpOwogICAgbG9ja2VkID0gdHJ1ZTsKICAgIF87CiAgICBsb2NrZWQgPSBmYWxzZTsKICB9CiAgCiAgLy8gRXZlbnRzIHRyaWdnZXJlZCB0aHJvdWdob3V0IGNvbnRyYWN0IGV4ZWN1dGlvbgogIC8vIFRoZXNlIGNhbiBiZSB3YXRjaGVkIHZpYSBnZXRoIGZpbHRlcnMgdG8ga2VlcCB1cC10by1kYXRlIHdpdGggdGhlIGNvbnRyYWN0CiAgZXZlbnQgQ29udHJpYnV0b3JCYWxhbmNlQ2hhbmdlZCAoYWRkcmVzcyBjb250cmlidXRvciwgdWludCB0b3RhbEJhbGFuY2UpOwogIGV2ZW50IFJlY2VpdmVyQWRkcmVzc1NldCAoIGFkZHJlc3MgX2FkZHIpOwogIGV2ZW50IFBvb2xTdWJtaXR0ZWQgKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBXaXRoZHJhd2Fsc09wZW4gKGFkZHJlc3MgdG9rZW5BZGRyKTsKICBldmVudCBUb2tlbnNXaXRoZHJhd24gKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBFdGhSZWZ1bmRSZWNlaXZlZCAoYWRkcmVzcyBzZW5kZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBFdGhSZWZ1bmRlZCAoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwogIGV2ZW50IEVSQzIyM1JlY2VpdmVkIChhZGRyZXNzIHRva2VuLCB1aW50IHZhbHVlKTsKICAgCiAgLy8gVGhlc2UgYXJlIGludGVybmFsIGZ1bmN0aW9ucyB1c2VkIGZvciBjYWxjdWxhdGluZyBmZWVzLCBldGggYW5kIHRva2VuIGFsbG9jYXRpb25zIGFzICUKICAvLyByZXR1cm5zIGEgdmFsdWUgYXMgYSAlIGFjY3VyYXRlIHRvIDIwIGRlY2ltYWwgcG9pbnRzCiAgZnVuY3Rpb24gX3RvUGN0ICh1aW50IG51bWVyYXRvciwgdWludCBkZW5vbWluYXRvciApIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIG51bWVyYXRvci5tdWwoMTAgKiogMjApIC8gZGVub21pbmF0b3I7CiAgfQogIAogIC8vIHJldHVybnMgJSBvZiBhbnkgbnVtYmVyLCB3aGVyZSAlIGdpdmVuIHdhcyBnZW5lcmF0ZWQgd2l0aCB0b1BjdAogIGZ1bmN0aW9uIF9hcHBseVBjdCAodWludCBudW1lcmF0b3IsIHVpbnQgcGN0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBudW1lcmF0b3IubXVsKHBjdCkgLyAoMTAgKiogMjApOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhdCB0aGUgdGltZSBvZiBjb250cmFjdCBjcmVhdGlvbiwKICAvLyBpdCBzZXRzIHRoZSBpbml0aWFsIHZhcmlhYmxlcyBhbmQgd2hpdGVsaXN0cyB0aGUgY29udHJhY3Qgb3duZXIuCiAgZnVuY3Rpb24gUHJlc2FsZVBvb2woYWRkcmVzcyByZWNlaXZlckFkZHIsIHVpbnRbXSBjYXBBbW91bnRzLCB1aW50IGZlZSkgcHVibGljIHsKICAgIHJlcXVpcmUgKGZlZSA8IDEwMCk7CiAgICByZXF1aXJlIChjYXBBbW91bnRzLmxlbmd0aD4xICYmIGNhcEFtb3VudHMubGVuZ3RoPDI1Nik7CiAgICBmb3IgKHVpbnQ4IGk9MTsgaTxjYXBBbW91bnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlcXVpcmUgKGNhcEFtb3VudHNbaV0gPD0gY2FwQW1vdW50c1swXSk7CiAgICB9CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICByZWNlaXZlckFkZHJlc3MgPSByZWNlaXZlckFkZHI7CiAgICBjb250cmlidXRpb25DYXBzID0gY2FwQW1vdW50czsKICAgIGZlZVBjdCA9IF90b1BjdChmZWUsMTAwKTsKICAgIHdoaXRlbGlzdFttc2cuc2VuZGVyXS5hdXRob3JpemVkID0gdHJ1ZTsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgZXRoIGlzIHNlbnQgaW50byB0aGUgY29udHJhY3QuCiAgLy8gVGhlIHNlbmQgd2lsbCBmYWlsIHVubGVzcyB0aGUgY29udHJhY3QgaXMgaW4gc3RhZ2Ugb25lIGFuZCB0aGUgc2VuZGVyIGhhcyBiZWVuIHdoaXRlbGlzdGVkLgogIC8vIFRoZSBhbW91bnQgc2VudCBpcyBhZGRlZCB0byB0aGUgYmFsYW5jZSBpbiB0aGUgQ29udHJpYnV0b3Igc3RydWN0IGFzc29jaWF0ZWQgd2l0aCB0aGUgc2VuZGluZyBhZGRyZXNzLgogIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHsKICAgIGlmIChjb250cmFjdFN0YWdlID09IDEpIHsKICAgICAgX2V0aERlcG9zaXQoKTsKICAgIH0gZWxzZSBpZiAoY29udHJhY3RTdGFnZSA9PSAzKSB7CiAgICAgIF9ldGhSZWZ1bmQoKTsKICAgIH0gZWxzZSByZXZlcnQoKTsKICB9CiAgCiAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gZm9yIGhhbmRsaW5nIGV0aCBkZXBvc2l0cyBkdXJpbmcgY29udHJhY3Qgc3RhZ2Ugb25lLgogIGZ1bmN0aW9uIF9ldGhEZXBvc2l0ICgpIGludGVybmFsIHsKICAgIGFzc2VydCAoY29udHJhY3RTdGFnZSA9PSAxKTsKICAgIHJlcXVpcmUgKHR4Lmdhc3ByaWNlIDw9IG1heEdhc1ByaWNlKTsKICAgIHJlcXVpcmUgKHRoaXMuYmFsYW5jZSA8PSBjb250cmlidXRpb25DYXBzWzBdKTsKICAgIHZhciBjID0gd2hpdGVsaXN0W21zZy5zZW5kZXJdOwogICAgdWludCBuZXdCYWxhbmNlID0gYy5iYWxhbmNlLmFkZChtc2cudmFsdWUpOwogICAgcmVxdWlyZSAobmV3QmFsYW5jZSA+PSBjb250cmlidXRpb25NaW4pOwogICAgcmVxdWlyZSAobmV3QmFsYW5jZSA8PSBfY2hlY2tDYXAobXNnLnNlbmRlcikpOwogICAgYy5iYWxhbmNlID0gbmV3QmFsYW5jZTsKICAgIENvbnRyaWJ1dG9yQmFsYW5jZUNoYW5nZWQobXNnLnNlbmRlciwgbmV3QmFsYW5jZSk7CiAgfQogIAogIC8vIEludGVybmFsIGZ1bmN0aW9uIGZvciBoYW5kbGluZyBldGggcmVmdW5kcyBkdXJpbmcgc3RhZ2UgdGhyZWUuCiAgZnVuY3Rpb24gX2V0aFJlZnVuZCAoKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQgKGNvbnRyYWN0U3RhZ2UgPT0gMyk7CiAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG93bmVyIHx8IG1zZy5zZW5kZXIgPT0gcmVjZWl2ZXJBZGRyZXNzKTsKICAgIHJlcXVpcmUgKG1zZy52YWx1ZSA+PSBjb250cmlidXRpb25NaW4pOwogICAgZXRoUmVmdW5kQW1vdW50LnB1c2gobXNnLnZhbHVlKTsKICAgIEV0aFJlZnVuZFJlY2VpdmVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRvIHdpdGhkcmF3IGV0aCBvciB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QuCiAgLy8gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFkZHJlc3NlcyB0aGF0IGFyZSB3aGl0ZWxpc3RlZCBhbmQgc2hvdyBhIGJhbGFuY2UgZ3JlYXRlciB0aGFuIDAuCiAgLy8gSWYgY2FsbGVkIGR1cmluZyBzdGFnZXMgb25lIG9yIHR3bywgdGhlIGZ1bGwgZXRoIGJhbGFuY2UgZGVwb3NpdGVkIGludG8gdGhlIGNvbnRyYWN0IGlzIHJldHVybmVkIGFuZCB0aGUgY29udHJpYnV0b3IncyBiYWxhbmNlIHJlc2V0IHRvIDAuCiAgLy8gSWYgY2FsbGVkIGR1cmluZyBzdGFnZSB0aHJlZSwgdGhlIGNvbnRyaWJ1dG9yJ3MgdW51c2VkIGV0aCB3aWxsIGJlIHJldHVybmVkLCBhcyB3ZWxsIGFzIGFueSBhdmFpbGFibGUgdG9rZW5zLgogIC8vIFRoZSB0b2tlbiBhZGRyZXNzIG1heSBiZSBwcm92aWRlZCBvcHRpb25hbGx5IHRvIHdpdGhkcmF3IHRva2VucyB0aGF0IGFyZSBub3QgY3VycmVudGx5IHRoZSBkZWZhdWx0IHRva2VuIChhaXJkcm9wcykuCiAgZnVuY3Rpb24gd2l0aGRyYXcgKGFkZHJlc3MgdG9rZW5BZGRyKSBwdWJsaWMgewogICAgdmFyIGMgPSB3aGl0ZWxpc3RbbXNnLnNlbmRlcl07CiAgICByZXF1aXJlIChjLmJhbGFuY2UgPiAwKTsKICAgIGlmIChjb250cmFjdFN0YWdlIDwgMykgewogICAgICB1aW50IGFtb3VudFRvVHJhbnNmZXIgPSBjLmJhbGFuY2U7CiAgICAgIGMuYmFsYW5jZSA9IDA7CiAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYW1vdW50VG9UcmFuc2Zlcik7CiAgICAgIENvbnRyaWJ1dG9yQmFsYW5jZUNoYW5nZWQobXNnLnNlbmRlciwgMCk7CiAgICB9IGVsc2UgewogICAgICBfd2l0aGRyYXcobXNnLnNlbmRlcix0b2tlbkFkZHIpOwogICAgfSAgCiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHRoZSBjb250cmFjdCBvd25lciB0byBmb3JjZSBhIHdpdGhkcmF3YWwgdG8gYW55IGNvbnRyaWJ1dG9yLgogIGZ1bmN0aW9uIHdpdGhkcmF3Rm9yIChhZGRyZXNzIGNvbnRyaWJ1dG9yLCBhZGRyZXNzIHRva2VuQWRkcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDMpOwogICAgcmVxdWlyZSAod2hpdGVsaXN0W2NvbnRyaWJ1dG9yXS5iYWxhbmNlID4gMCk7CiAgICBfd2l0aGRyYXcoY29udHJpYnV0b3IsdG9rZW5BZGRyKTsKICB9CiAgCiAgLy8gVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiBoYW5kbGVzIHdpdGhkcmF3YWxzIGR1cmluZyBzdGFnZSB0aHJlZS4KICAvLyBUaGUgYXNzb2NpYXRlZCBldmVudHMgd2lsbCBmaXJlIHRvIG5vdGlmeSB3aGVuIGEgcmVmdW5kIG9yIHRva2VuIGFsbG9jYXRpb24gaXMgY2xhaW1lZC4KICBmdW5jdGlvbiBfd2l0aGRyYXcgKGFkZHJlc3MgcmVjZWl2ZXIsIGFkZHJlc3MgdG9rZW5BZGRyKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQgKGNvbnRyYWN0U3RhZ2UgPT0gMyk7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFtyZWNlaXZlcl07CiAgICBpZiAodG9rZW5BZGRyID09IDB4MDApIHsKICAgICAgdG9rZW5BZGRyID0gYWN0aXZlVG9rZW47CiAgICB9CiAgICB2YXIgZCA9IGRpc3RyaWJ1dGlvbk1hcFt0b2tlbkFkZHJdOwogICAgcmVxdWlyZSAoIChldGhSZWZ1bmRBbW91bnQubGVuZ3RoID4gYy5ldGhSZWZ1bmQpIHx8IGQucGN0Lmxlbmd0aCA+IGMudG9rZW5zQ2xhaW1lZFt0b2tlbkFkZHJdICk7CiAgICBpZiAoZXRoUmVmdW5kQW1vdW50Lmxlbmd0aCA+IGMuZXRoUmVmdW5kKSB7CiAgICAgIHVpbnQgcGN0ID0gX3RvUGN0KGMuYmFsYW5jZSxmaW5hbEJhbGFuY2UpOwogICAgICB1aW50IGV0aEFtb3VudCA9IDA7CiAgICAgIGZvciAodWludCBpPWMuZXRoUmVmdW5kOyBpPGV0aFJlZnVuZEFtb3VudC5sZW5ndGg7IGkrKykgewogICAgICAgIGV0aEFtb3VudCA9IGV0aEFtb3VudC5hZGQoX2FwcGx5UGN0KGV0aFJlZnVuZEFtb3VudFtpXSxwY3QpKTsKICAgICAgfQogICAgICBjLmV0aFJlZnVuZCA9IGV0aFJlZnVuZEFtb3VudC5sZW5ndGg7CiAgICAgIGlmIChldGhBbW91bnQgPiAwKSB7CiAgICAgICAgcmVjZWl2ZXIudHJhbnNmZXIoZXRoQW1vdW50KTsKICAgICAgICBFdGhSZWZ1bmRlZChyZWNlaXZlcixldGhBbW91bnQpOwogICAgICB9CiAgICB9CiAgICBpZiAoZC5wY3QubGVuZ3RoID4gYy50b2tlbnNDbGFpbWVkW3Rva2VuQWRkcl0pIHsKICAgICAgdWludCB0b2tlbkFtb3VudCA9IDA7CiAgICAgIGZvciAoaT1jLnRva2Vuc0NsYWltZWRbdG9rZW5BZGRyXTsgaTxkLnBjdC5sZW5ndGg7IGkrKykgewogICAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQuYWRkKF9hcHBseVBjdChjLmJhbGFuY2UsZC5wY3RbaV0pKTsKICAgICAgfQogICAgICBjLnRva2Vuc0NsYWltZWRbdG9rZW5BZGRyXSA9IGQucGN0Lmxlbmd0aDsKICAgICAgaWYgKHRva2VuQW1vdW50ID4gMCkgewogICAgICAgIHJlcXVpcmUoZC50b2tlbi50cmFuc2ZlcihyZWNlaXZlcix0b2tlbkFtb3VudCkpOwogICAgICAgIGQuYmFsYW5jZVJlbWFpbmluZyA9IGQuYmFsYW5jZVJlbWFpbmluZy5zdWIodG9rZW5BbW91bnQpOwogICAgICAgIFRva2Vuc1dpdGhkcmF3bihyZWNlaXZlcix0b2tlbkFtb3VudCk7CiAgICAgIH0gIAogICAgfQogICAgCiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgZXhlY3V0ZWQgYnkgdGhlIG93bmVyLCBpdCBhZGRzIGFuIGFkZHJlc3MgdG8gdGhlIHdoaXRlbGlzdC4KICAvLyBUbyBleGVjdXRlLCB0aGUgY29udHJhY3QgbXVzdCBiZSBpbiBzdGFnZSAxLCB0aGUgYWRkcmVzcyBjYW5ub3QgYWxyZWFkeSBiZSB3aGl0ZWxpc3RlZCwgYW5kIHRoZSBhZGRyZXNzIGNhbm5vdCBiZSBhIGNvbnRyYWN0IGl0c2VsZi4KICAvLyBCbG9ja2luZyBjb250cmFjdHMgZnJvbSBiZWluZyB3aGl0ZWxpc3RlZCBwcmV2ZW50cyBhdHRhY2tzIGZyb20gdW5leHBlY3RlZCBjb250cmFjdCB0byBjb250cmFjdCBpbnRlcmFjdGlvbiAtIHZlcnkgaW1wb3J0YW50IQogIGZ1bmN0aW9uIGF1dGhvcml6ZSAoYWRkcmVzcyBhZGRyLCB1aW50IGNhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDEpOwogICAgX2NoZWNrV2hpdGVsaXN0Q29udHJhY3QoYWRkcik7CiAgICByZXF1aXJlICghd2hpdGVsaXN0W2FkZHJdLmF1dGhvcml6ZWQpOwogICAgcmVxdWlyZSAoKGNhcCA+IDAgJiYgY2FwIDwgY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpIHx8IChjYXAgPj0gY29udHJpYnV0aW9uTWluICYmIGNhcCA8PSBjb250cmlidXRpb25DYXBzWzBdKSApOwogICAgdWludCBzaXplOwogICAgYXNzZW1ibHkgeyBzaXplIDo9IGV4dGNvZGVzaXplKGFkZHIpIH0KICAgIHJlcXVpcmUgKHNpemUgPT0gMCk7CiAgICB3aGl0ZWxpc3RbYWRkcl0uY2FwID0gY2FwOwogICAgd2hpdGVsaXN0W2FkZHJdLmF1dGhvcml6ZWQgPSB0cnVlOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgYnkgdGhlIG93bmVyIHRvIGF1dGhvcml6ZSBtYW55IGFkZHJlc3NlcyBpbiBhIHNpbmdsZSBjYWxsLgogIC8vIEVhY2ggYWRkcmVzcyB3aWxsIGJlIGdpdmVuIHRoZSBzYW1lIGNhcCwgYW5kIHRoZSBjYXAgbXVzdCBiZSBvbmUgb2YgdGhlIHN0YW5kYXJkIGxldmVscy4KICBmdW5jdGlvbiBhdXRob3JpemVNYW55IChhZGRyZXNzW10gYWRkciwgdWludCBjYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoYWRkci5sZW5ndGggPCAyNTUpOwogICAgcmVxdWlyZSAoY2FwID4gMCAmJiBjYXAgPCBjb250cmlidXRpb25DYXBzLmxlbmd0aCk7CiAgICBmb3IgKHVpbnQ4IGk9MDsgaTxhZGRyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGF1dGhvcml6ZShhZGRyW2ldLCBjYXApOwogICAgfQogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcmVtb3ZlIGFuIGFkZHJlc3MgZnJvbSB0aGUgd2hpdGVsaXN0LgogIC8vIEl0IG1heSBvbmx5IGJlIGV4ZWN1dGVkIGR1cmluZyBzdGFnZXMgMSBhbmQgMi4gIEFueSBldGggc2VudCBieSB0aGUgYWRkcmVzcyBpcyByZWZ1bmRlZCBhbmQgdGhlaXIgcGVyc29uYWwgY2FwIGlzIHNldCB0byAwLgogIC8vIEl0IHdpbGwgdGhyb3cgaWYgdGhlIGFkZHJlc3MgaXMgc3RpbGwgYXV0aG9yaXNlZCBpbiB0aGUgd2hpdGVsaXN0IGNvbnRyYWN0LgogIGZ1bmN0aW9uIHJldm9rZSAoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPCAzKTsKICAgIHJlcXVpcmUgKHdoaXRlbGlzdFthZGRyXS5hdXRob3JpemVkKTsKICAgIHJlcXVpcmUgKHdoaXRlbGlzdENvbnRyYWN0LmNoZWNrTWVtYmVyTGV2ZWwoYWRkcikgPT0gMCk7CiAgICB3aGl0ZWxpc3RbYWRkcl0uYXV0aG9yaXplZCA9IGZhbHNlOwogICAgaWYgKHdoaXRlbGlzdFthZGRyXS5iYWxhbmNlID4gMCkgewogICAgICB1aW50IGFtb3VudFRvVHJhbnNmZXIgPSB3aGl0ZWxpc3RbYWRkcl0uYmFsYW5jZTsKICAgICAgd2hpdGVsaXN0W2FkZHJdLmJhbGFuY2UgPSAwOwogICAgICBhZGRyLnRyYW5zZmVyKGFtb3VudFRvVHJhbnNmZXIpOwogICAgICBDb250cmlidXRvckJhbGFuY2VDaGFuZ2VkKGFkZHIsIDApOwogICAgfQogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gbW9kaWZ5IHRoZSBjb250cmlidXRpb24gY2FwIG9mIGEgd2hpdGVsaXN0ZWQgYWRkcmVzcy4KICAvLyBJZiB0aGUgY3VycmVudCBjb250cmlidXRpb24gYmFsYW5jZSBleGNlZWRzIHRoZSBuZXcgY2FwLCB0aGUgZXhjZXNzIGJhbGFuY2UgaXMgcmVmdW5kZWQuCiAgZnVuY3Rpb24gbW9kaWZ5SW5kaXZpZHVhbENhcCAoYWRkcmVzcyBhZGRyLCB1aW50IGNhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChjYXAgPCBjb250cmlidXRpb25DYXBzLmxlbmd0aCB8fCAoY2FwID49IGNvbnRyaWJ1dGlvbk1pbiAmJiBjYXAgPD0gY29udHJpYnV0aW9uQ2Fwc1swXSkgKTsKICAgIF9jaGVja1doaXRlbGlzdENvbnRyYWN0KGFkZHIpOwogICAgdmFyIGMgPSB3aGl0ZWxpc3RbYWRkcl07CiAgICByZXF1aXJlIChjLmF1dGhvcml6ZWQpOwogICAgdWludCBhbW91bnQgPSBjLmJhbGFuY2U7CiAgICBjLmNhcCA9IGNhcDsKICAgIHVpbnQgY2FwQW1vdW50ID0gX2NoZWNrQ2FwKGFkZHIpOwogICAgaWYgKGFtb3VudCA+IGNhcEFtb3VudCkgewogICAgICBjLmJhbGFuY2UgPSBjYXBBbW91bnQ7CiAgICAgIGFkZHIudHJhbnNmZXIoYW1vdW50LnN1YihjYXBBbW91bnQpKTsKICAgICAgQ29udHJpYnV0b3JCYWxhbmNlQ2hhbmdlZChhZGRyLCBjYXBBbW91bnQpOwogICAgfQogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gbW9kaWZ5IHRoZSBjYXAgZm9yIGEgY29udHJpYnV0aW9uIGxldmVsLgogIC8vIFRoZSBjYXAgY2Fubm90IGJlIGRlY3JlYXNlZCBiZWxvdyB0aGUgY3VycmVudCBiYWxhbmNlIG9yIGluY3JlYXNlZCBwYXN0IHRoZSBjb250cmFjdCBsaW1pdC4KICBmdW5jdGlvbiBtb2RpZnlMZXZlbENhcCAodWludCBsZXZlbCwgdWludCBjYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVxdWlyZSAobGV2ZWwgPiAwICYmIGxldmVsIDwgY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpOwogICAgcmVxdWlyZSAodGhpcy5iYWxhbmNlIDw9IGNhcCAmJiBjb250cmlidXRpb25DYXBzWzBdID49IGNhcCk7CiAgICBjb250cmlidXRpb25DYXBzW2xldmVsXSA9IGNhcDsKICAgIG5leHRDYXBUaW1lID0gMDsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBjaGFuZ2VzIGV2ZXJ5IGxldmVsIGNhcCBhdCBvbmNlLCB3aXRoIGFuIG9wdGlvbmFsIGRlbGF5LgogIC8vIE1vZGlmeWluZyB0aGUgY2FwcyBpbW1lZGlhdGVseSB3aWxsIGNhbmNlbCBhbnkgZGVsYXllZCBjYXAgY2hhbmdlLgogIGZ1bmN0aW9uIG1vZGlmeUFsbExldmVsQ2FwcyAodWludFtdIGNhcCwgdWludCB0aW1lKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPCAzKTsKICAgIHJlcXVpcmUgKGNhcC5sZW5ndGggPT0gY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgtMSk7CiAgICByZXF1aXJlICh0aW1lID09IDAgfHwgdGltZT5ibG9jay50aW1lc3RhbXApOwogICAgaWYgKHRpbWUgPT0gMCkgewogICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgY2FwLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbW9kaWZ5TGV2ZWxDYXAoaSsxLCBjYXBbaV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBuZXh0Q29udHJpYnV0aW9uQ2FwcyA9IGNvbnRyaWJ1dGlvbkNhcHM7CiAgICAgIG5leHRDYXBUaW1lID0gdGltZTsKICAgICAgZm9yIChpID0gMDsgaSA8IGNhcC5sZW5ndGg7IGkrKykgewogICAgICAgIHJlcXVpcmUgKGNvbnRyaWJ1dGlvbkNhcHNbaSsxXSA8PSBjYXBbaV0gJiYgY29udHJpYnV0aW9uQ2Fwc1swXSA+PSBjYXBbaV0pOwogICAgICAgIG5leHRDb250cmlidXRpb25DYXBzW2krMV0gPSBjYXBbaV07CiAgICAgIH0KICAgIH0KICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIGR1cmluZyBzdGFnZXMgb25lIG9yIHR3byB0byBtb2RpZnkgdGhlIG1heGltdW0gYmFsYW5jZSBvZiB0aGUgY29udHJhY3QuCiAgLy8gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lci4gVGhlIGFtb3VudCBjYW5ub3QgYmUgc2V0IHRvIGxvd2VyIHRoYW4gdGhlIGN1cnJlbnQgYmFsYW5jZSBvZiB0aGUgY29udHJhY3QuCiAgZnVuY3Rpb24gbW9kaWZ5TWF4Q29udHJhY3RCYWxhbmNlICh1aW50IGFtb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChhbW91bnQgPj0gY29udHJpYnV0aW9uTWluKTsKICAgIHJlcXVpcmUgKGFtb3VudCA+PSB0aGlzLmJhbGFuY2UpOwogICAgY29udHJpYnV0aW9uQ2Fwc1swXSA9IGFtb3VudDsKICAgIG5leHRDYXBUaW1lID0gMDsKICAgIGZvciAodWludDggaT0xOyBpPGNvbnRyaWJ1dGlvbkNhcHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGNvbnRyaWJ1dGlvbkNhcHNbaV0+YW1vdW50KSBjb250cmlidXRpb25DYXBzW2ldPWFtb3VudDsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiByZXR1cm5zIHRoZSBjYXAgYW1vdW50IG9mIGEgd2hpdGVsaXN0ZWQgYWRkcmVzcy4KICBmdW5jdGlvbiBfY2hlY2tDYXAgKGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgX2NoZWNrV2hpdGVsaXN0Q29udHJhY3QoYWRkcik7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFthZGRyXTsKICAgIGlmICghYy5hdXRob3JpemVkKSByZXR1cm4gMDsKICAgIGlmIChuZXh0Q2FwVGltZT4wICYmIGJsb2NrLnRpbWVzdGFtcD5uZXh0Q2FwVGltZSkgewogICAgICBjb250cmlidXRpb25DYXBzID0gbmV4dENvbnRyaWJ1dGlvbkNhcHM7CiAgICAgIG5leHRDYXBUaW1lID0gMDsKICAgIH0KICAgIGlmIChjLmNhcDxjb250cmlidXRpb25DYXBzLmxlbmd0aCkgcmV0dXJuIGNvbnRyaWJ1dGlvbkNhcHNbYy5jYXBdOwogICAgcmV0dXJuIGMuY2FwOyAKICB9CiAgCiAgLy8gVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiBjaGVja3MgaWYgYW4gYWRkcmVzcyBpcyB3aGl0ZWxpc3RlZCBpbiB0aGUgd2hpdGVsaXN0IGNvbnRyYWN0LgogIGZ1bmN0aW9uIF9jaGVja1doaXRlbGlzdENvbnRyYWN0IChhZGRyZXNzIGFkZHIpIGludGVybmFsIHsKICAgIHZhciBjID0gd2hpdGVsaXN0W2FkZHJdOwogICAgaWYgKCFjLmF1dGhvcml6ZWQpIHsKICAgICAgdmFyIGxldmVsID0gd2hpdGVsaXN0Q29udHJhY3QuY2hlY2tNZW1iZXJMZXZlbChhZGRyKTsKICAgICAgaWYgKGxldmVsID09IDAgfHwgbGV2ZWwgPj0gY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpIHJldHVybjsKICAgICAgYy5jYXAgPSBsZXZlbDsKICAgICAgYy5hdXRob3JpemVkID0gdHJ1ZTsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBjYWxsYWJsZSBmdW5jdGlvbiByZXR1cm5zIHRoZSB0b3RhbCBwb29sIGNhcCwgY3VycmVudCBiYWxhbmNlIGFuZCByZW1haW5pbmcgYmFsYW5jZSB0byBiZSBmaWxsZWQuCiAgZnVuY3Rpb24gY2hlY2tQb29sQmFsYW5jZSAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IHBvb2xDYXAsIHVpbnQgYmFsYW5jZSwgdWludCByZW1haW5pbmcpIHsKICAgIGlmIChjb250cmFjdFN0YWdlID09IDEpIHsKICAgICAgcmVtYWluaW5nID0gY29udHJpYnV0aW9uQ2Fwc1swXS5zdWIodGhpcy5iYWxhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlbWFpbmluZyA9IDA7CiAgICB9CiAgICByZXR1cm4gKGNvbnRyaWJ1dGlvbkNhcHNbMF0sdGhpcy5iYWxhbmNlLHJlbWFpbmluZyk7CiAgfQogIAogIC8vIFRoaXMgY2FsbGFibGUgZnVuY3Rpb24gcmV0dXJucyB0aGUgYmFsYW5jZSwgY29udHJpYnV0aW9uIGNhcCwgYW5kIHJlbWFpbmluZyBhdmFpbGFibGUgYmFsYW5jZSBvZiBhbnkgY29udHJpYnV0b3IuCiAgZnVuY3Rpb24gY2hlY2tDb250cmlidXRvckJhbGFuY2UgKGFkZHJlc3MgYWRkcikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlLCB1aW50IGNhcCwgdWludCByZW1haW5pbmcpIHsKICAgIHZhciBjID0gd2hpdGVsaXN0W2FkZHJdOwogICAgaWYgKCFjLmF1dGhvcml6ZWQpIHsKICAgICAgY2FwID0gd2hpdGVsaXN0Q29udHJhY3QuY2hlY2tNZW1iZXJMZXZlbChhZGRyKTsKICAgICAgaWYgKGNhcCA9PSAwKSByZXR1cm4gKDAsMCwwKTsKICAgIH0gZWxzZSB7CiAgICAgIGNhcCA9IGMuY2FwOwogICAgfQogICAgYmFsYW5jZSA9IGMuYmFsYW5jZTsKICAgIGlmIChjb250cmFjdFN0YWdlID09IDEpIHsKICAgICAgaWYgKGNhcDxjb250cmlidXRpb25DYXBzLmxlbmd0aCkgeyAKICAgICAgICBpZiAobmV4dENhcFRpbWUgPT0gMCB8fCBuZXh0Q2FwVGltZSA+IGJsb2NrLnRpbWVzdGFtcCkgewogICAgICAgICAgY2FwID0gY29udHJpYnV0aW9uQ2Fwc1tjYXBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYXAgPSBuZXh0Q29udHJpYnV0aW9uQ2Fwc1tjYXBdOwogICAgICAgIH0KICAgICAgfQogICAgICByZW1haW5pbmcgPSBjYXAuc3ViKGJhbGFuY2UpOwogICAgICBpZiAoY29udHJpYnV0aW9uQ2Fwc1swXS5zdWIodGhpcy5iYWxhbmNlKSA8IHJlbWFpbmluZykgcmVtYWluaW5nID0gY29udHJpYnV0aW9uQ2Fwc1swXS5zdWIodGhpcy5iYWxhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlbWFpbmluZyA9IDA7CiAgICB9CiAgICByZXR1cm4gKGJhbGFuY2UsIGNhcCwgcmVtYWluaW5nKTsKICB9CiAgCiAgLy8gVGhpcyBjYWxsYWJsZSBmdW5jdGlvbiByZXR1cm5zIHRoZSB0b2tlbiBiYWxhbmNlIHRoYXQgYSBjb250cmlidXRvciBjYW4gY3VycmVudGx5IGNsYWltLgogIGZ1bmN0aW9uIGNoZWNrQXZhaWxhYmxlVG9rZW5zIChhZGRyZXNzIGFkZHIsIGFkZHJlc3MgdG9rZW5BZGRyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KSB7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFthZGRyXTsKICAgIHZhciBkID0gZGlzdHJpYnV0aW9uTWFwW3Rva2VuQWRkcl07CiAgICBmb3IgKHVpbnQgaSA9IGMudG9rZW5zQ2xhaW1lZFt0b2tlbkFkZHJdOyBpIDwgZC5wY3QubGVuZ3RoOyBpKyspIHsKICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbkFtb3VudC5hZGQoX2FwcGx5UGN0KGMuYmFsYW5jZSwgZC5wY3RbaV0pKTsKICAgIH0KICAgIHJldHVybiB0b2tlbkFtb3VudDsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBjbG9zZXMgZnVydGhlciBjb250cmlidXRpb25zIHRvIHRoZSBjb250cmFjdCwgYWR2YW5jaW5nIGl0IHRvIHN0YWdlIHR3by4KICAvLyBJdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyLiAgQWZ0ZXIgdGhpcyBjYWxsIGhhcyBiZWVuIG1hZGUsIHdoaXRlbGlzdGVkIGFkZHJlc3NlcwogIC8vIGNhbiBzdGlsbCByZW1vdmUgdGhlaXIgZXRoIGZyb20gdGhlIGNvbnRyYWN0IGJ1dCBjYW5ub3QgY29udHJpYnV0ZSBhbnkgbW9yZS4KICBmdW5jdGlvbiBjbG9zZUNvbnRyaWJ1dGlvbnMgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDEpOwogICAgY29udHJhY3RTdGFnZSA9IDI7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gcmVvcGVucyB0aGUgY29udHJhY3QgdG8gY29udHJpYnV0aW9ucyBhbmQgZnVydGhlciB3aGl0ZWxpc3RpbmcsIHJldHVybmluZyBpdCB0byBzdGFnZSBvbmUuCiAgLy8gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBkdXJpbmcgc3RhZ2UgdHdvLgogIGZ1bmN0aW9uIHJlb3BlbkNvbnRyaWJ1dGlvbnMgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDIpOwogICAgY29udHJhY3RTdGFnZSA9IDE7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gc2V0cyB0aGUgcmVjZWl2aW5nIGFkZHJlc3MgdGhhdCB0aGUgY29udHJhY3Qgd2lsbCBzZW5kIHRoZSBwb29sZWQgZXRoIHRvLgogIC8vIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIgaWYgdGhlIHJlY2VpdmVyIGFkZHJlc3MgaGFzIG5vdCBhbHJlYWR5IGJlZW4gc2V0LgogIC8vIEFmdGVyIG1ha2luZyB0aGlzIGNhbGwsIHRoZSBjb250cmFjdCB3aWxsIGJlIHVuYWJsZSB0byBzZW5kIHRoZSBwb29sZWQgZXRoIGZvciA2MDAwIGJsb2Nrcy4KICAvLyBUaGlzIGxpbWl0YXRpb24gaXMgc28gdGhhdCBpZiB0aGUgb3duZXIgYWN0cyBtYWxpY2lvdXNseSBpbiBtYWtpbmcgdGhlIGNoYW5nZSwgYWxsIHdoaXRlbGlzdGVkCiAgLy8gYWRkcmVzc2VzIGhhdmUgfjI0IGhvdXJzIHRvIHdpdGhkcmF3IHRoZWlyIGV0aCBmcm9tIHRoZSBjb250cmFjdC4KICBmdW5jdGlvbiBzZXRSZWNlaXZlckFkZHJlc3MgKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChhZGRyICE9IDB4MDAgJiYgcmVjZWl2ZXJBZGRyZXNzID09IDB4MDApOwogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVjZWl2ZXJBZGRyZXNzID0gYWRkcjsKICAgIGFkZHJlc3NDaGFuZ2VCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIFJlY2VpdmVyQWRkcmVzc1NldChhZGRyKTsKICB9CgogIC8vIFRoaXMgZnVuY3Rpb24gc2VuZHMgdGhlIHBvb2xlZCBldGggdG8gdGhlIHJlY2VpdmluZyBhZGRyZXNzLCBjYWxjdWxhdGVzIHRoZSAlIG9mIHVudXNlZCBldGggdG8gYmUgcmV0dXJuZWQsCiAgLy8gYW5kIGFkdmFuY2VzIHRoZSBjb250cmFjdCB0byBzdGFnZSB0aHJlZS4gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lciBkdXJpbmcgc3RhZ2VzIG9uZSBvciB0d28uCiAgLy8gVGhlIGFtb3VudCB0byBzZW5kIChnaXZlbiBpbiB3ZWkpIG11c3QgYmUgc3BlY2lmaWVkIGR1cmluZyB0aGUgY2FsbC4gQXMgdGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBleGVjdXRlZCBvbmNlLAogIC8vIGl0IGlzIFZFUlkgSU1QT1JUQU5UIG5vdCB0byBnZXQgdGhlIGFtb3VudCB3cm9uZy4KICBmdW5jdGlvbiBzdWJtaXRQb29sICh1aW50IGFtb3VudEluV2VpKSBwdWJsaWMgb25seU93bmVyIG5vUmVlbnRyYW5jeSB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChyZWNlaXZlckFkZHJlc3MgIT0gMHgwMCk7CiAgICByZXF1aXJlIChibG9jay5udW1iZXIgPj0gYWRkcmVzc0NoYW5nZUJsb2NrLmFkZCg2MDAwKSk7CiAgICByZXF1aXJlIChjb250cmlidXRpb25NaW4gPD0gYW1vdW50SW5XZWkgJiYgYW1vdW50SW5XZWkgPD0gdGhpcy5iYWxhbmNlKTsKICAgIGZpbmFsQmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgIHJlcXVpcmUgKHJlY2VpdmVyQWRkcmVzcy5jYWxsLnZhbHVlKGFtb3VudEluV2VpKS5nYXMobXNnLmdhcy5zdWIoNTAwMCkpKCkpOwogICAgZXRoUmVmdW5kQW1vdW50LnB1c2godGhpcy5iYWxhbmNlKTsKICAgIGNvbnRyYWN0U3RhZ2UgPSAzOwogICAgUG9vbFN1Ym1pdHRlZChyZWNlaXZlckFkZHJlc3MsIGFtb3VudEluV2VpKTsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBvcGVucyB0aGUgY29udHJhY3QgdXAgZm9yIHRva2VuIHdpdGhkcmF3YWxzLgogIC8vIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIgZHVyaW5nIHN0YWdlIDMuICBUaGUgb3duZXIgc3BlY2lmaWVzIHRoZSBhZGRyZXNzIG9mIGFuIEVSQzIwIHRva2VuCiAgLy8gY29udHJhY3QgdGhhdCB0aGlzIGNvbnRyYWN0IGhhcyBhIGJhbGFuY2UgaW4sIGFuZCBvcHRpb25hbGx5IGEgYm9vbCB0byBwcmV2ZW50IHRoaXMgdG9rZW4gZnJvbSBiZWluZwogIC8vIHRoZSBkZWZhdWx0IHdpdGhkcmF3YWwgKGluIHRoZSBldmVudCBvZiBhbiBhaXJkcm9wLCBmb3IgZXhhbXBsZSkuCiAgZnVuY3Rpb24gZW5hYmxlVG9rZW5XaXRoZHJhd2FscyAoYWRkcmVzcyB0b2tlbkFkZHIsIGJvb2wgbm90RGVmYXVsdCkgcHVibGljIG9ubHlPd25lciBub1JlZW50cmFuY3kgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA9PSAzKTsKICAgIGlmIChub3REZWZhdWx0KSB7CiAgICAgIHJlcXVpcmUgKGFjdGl2ZVRva2VuICE9IDB4MDApOwogICAgfSBlbHNlIHsKICAgICAgYWN0aXZlVG9rZW4gPSB0b2tlbkFkZHI7CiAgICB9CiAgICB2YXIgZCA9IGRpc3RyaWJ1dGlvbk1hcFt0b2tlbkFkZHJdOyAgICAKICAgIGlmIChkLnBjdC5sZW5ndGg9PTApIGQudG9rZW4gPSBFUkMyMCh0b2tlbkFkZHIpOwogICAgdWludCBhbW91bnQgPSBkLnRva2VuLmJhbGFuY2VPZih0aGlzKS5zdWIoZC5iYWxhbmNlUmVtYWluaW5nKTsKICAgIHJlcXVpcmUgKGFtb3VudCA+IDApOwogICAgaWYgKGZlZVBjdCA+IDApIHsKICAgICAgcmVxdWlyZSAoZC50b2tlbi50cmFuc2Zlcihvd25lcixfYXBwbHlQY3QoYW1vdW50LGZlZVBjdCkpKTsKICAgIH0KICAgIGFtb3VudCA9IGQudG9rZW4uYmFsYW5jZU9mKHRoaXMpLnN1YihkLmJhbGFuY2VSZW1haW5pbmcpOwogICAgZC5iYWxhbmNlUmVtYWluaW5nID0gZC50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBkLnBjdC5wdXNoKF90b1BjdChhbW91bnQsZmluYWxCYWxhbmNlKSk7CiAgfQogIAogIC8vIFRoaXMgaXMgYSBzdGFuZGFyZCBmdW5jdGlvbiByZXF1aXJlZCBmb3IgRVJDMjIzIGNvbXBhdGliaWxpdHkuCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayAoYWRkcmVzcyBmcm9tLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKSBwdWJsaWMgewogICAgRVJDMjIzUmVjZWl2ZWQgKGZyb20sIHZhbHVlKTsKICB9CiAgCn0='.
	

]
