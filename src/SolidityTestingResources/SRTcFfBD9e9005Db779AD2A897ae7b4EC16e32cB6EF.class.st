Class {
	#name : #SRTcFfBD9e9005Db779AD2A897ae7b4EC16e32cB6EF,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcFfBD9e9005Db779AD2A897ae7b4EC16e32cB6EF >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cn0KCi8qKgogKiBAdGl0bGUgUmVmdW5kVmF1bHQKICogQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgZm9yIHN0b3JpbmcgZnVuZHMgd2hpbGUgYSBjcm93ZHNhbGUKICogaXMgaW4gcHJvZ3Jlc3MuIFN1cHBvcnRzIHJlZnVuZGluZyB0aGUgbW9uZXkgaWYgY3Jvd2RzYWxlIGZhaWxzLAogKiBhbmQgZm9yd2FyZGluZyBpdCBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bC4KICovCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGRlcG9zaXRlZDsKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CiAgU3RhdGUgcHVibGljIHN0YXRlOwoKICBldmVudCBDbG9zZWQoKTsKICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwoKICBmdW5jdGlvbiBSZWZ1bmRWYXVsdChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgfQoKICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgaW52ZXN0b3IpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkW2ludmVzdG9yXS5hZGQobXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBUb2tlblRpbWVsb2NrCiAqIEBkZXYgVG9rZW5UaW1lbG9jayBpcyBhIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IHdpbGwgYWxsb3cgYQogKiBiZW5lZmljaWFyeSB0byBleHRyYWN0IHRoZSB0b2tlbnMgYWZ0ZXIgYSBnaXZlbiByZWxlYXNlIHRpbWUKICovCmNvbnRyYWN0IFRva2VuVGltZWxvY2sgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLy8gRVJDMjAgYmFzaWMgdG9rZW4gY29udHJhY3QgYmVpbmcgaGVsZAogIEVSQzIwQmFzaWMgcHVibGljIHRva2VuOwoKICAvLyBiZW5lZmljaWFyeSBvZiB0b2tlbnMgYWZ0ZXIgdGhleSBhcmUgcmVsZWFzZWQKICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKCiAgLy8gdGltZXN0YW1wIHdoZW4gdG9rZW4gcmVsZWFzZSBpcyBlbmFibGVkCiAgdWludDI1NiBwdWJsaWMgcmVsZWFzZVRpbWU7CgogIGZ1bmN0aW9uIFRva2VuVGltZWxvY2soRVJDMjBCYXNpYyBfdG9rZW4sIGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9yZWxlYXNlVGltZSkgcHVibGljIHsKICAgIHJlcXVpcmUoX3JlbGVhc2VUaW1lID4gbm93KTsKICAgIHRva2VuID0gX3Rva2VuOwogICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICByZWxlYXNlVGltZSA9IF9yZWxlYXNlVGltZTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHRva2VucyBoZWxkIGJ5IHRpbWVsb2NrIHRvIGJlbmVmaWNpYXJ5LgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoKSBwdWJsaWMgewogICAgcmVxdWlyZShub3cgPj0gcmVsZWFzZVRpbWUpOwoKICAgIHVpbnQyNTYgYW1vdW50ID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgcmVxdWlyZShhbW91bnQgPiAwKTsKCiAgICB0b2tlbi5zYWZlVHJhbnNmZXIoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQml0Y29pbnVzVG9rZW4gaXMgRVJDMjAsIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQml0Y29pbnVzIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkJJVFMiOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKICBtb2RpZmllciBjYW5UcmFuc2ZlcigpIHsKICAgIHJlcXVpcmUobWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2ZlciByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9CgoKICAvKioKICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2ZlciByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAqCiAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICogQGRldiBJbmNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICoKICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICoKICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgKiBAcGFyYW0gX3N1YnRyYWN0ZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBkZWNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IEJpdGNvaW51c0Nyb3dkc2FsZSBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAvLyBXYWxsZXQgd2hlcmUgYWxsIGV0aGVyIHdpbGwgYmUgc3RvcmVkCiAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgV0FMTEVUID0gMHgzZjM5Q0Q4YThBZTA1NDBGMEZEMzhhQjY5NUQzNmNlQ2YwZjI1NEUzOwogIC8vIFdhbGxldCBmb3IgdGVhbSB0b2tlbnMKICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBURUFNX1dBTExFVCA9IDB4MzUzMTc4NzkyMDVFOWZkNTlBZWVDNDI5YjU0OTRCODREODUwN0MyMDsKICAvLyBXYWxsZXQgZm9yIGJvdW50eSB0b2tlbnMKICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBCT1VOVFlfV0FMTEVUID0gMHgwODhDNDhjQTUxQTAyNDkwOWYwNkRGNjA1OTc0OTI0OTJFYjY2QzJhOwogIC8vIFdhbGxldCBmb3IgY29tcGFueSB0b2tlbnMKICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBDT01QQU5ZX1dBTExFVCA9IDB4NTc2QjVjQTc1ZDQ1OThkQzMxNjQwRjM5NUY2MjAxQzVEZDBFYmJCNDsKCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVEVBTV9UT0tFTlMgPSA0MDAwMDAwZTE4OwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRFQU1fVE9LRU5TX0xPQ0tfUEVSSU9EID0gNjAgKiA2MCAqIDI0ICogMzY1OyAvLyAzNjUgZGF5cwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENPTVBBTllfVE9LRU5TID0gMTAwMDAwMDBlMTg7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQ09NUEFOWV9UT0tFTlNfTE9DS19QRVJJT0QgPSA2MCAqIDYwICogMjQgKiAxODA7IC8vIDE4MCBkYXlzCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQk9VTlRZX1RPS0VOUyA9IDEwMDAwMDBlMTg7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgU09GVF9DQVAgPSAzMDAwMDAwZTE4OwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElDT19UT0tFTlMgPSA1MDAwMDAwMGUxODsKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBTVEFSVF9USU1FID0gMTUxNjU3OTIwMDsgLy8gMjAxOC8wMS8yMiAwMDowMCBVVEMgKzAKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBFTkRfVElNRSA9IDE1MjU5OTY4MDA7IC8vIDIwMTgvMDUvMTEgMDA6MDAgVVRDICswCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUkFURSA9IDEwMDA7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTEFSR0VfUFVSQ0hBU0UgPSAxNTAwZTE4OwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IExBUkdFX1BVUkNIQVNFX0JPTlVTID0gNTsKCiAgU3RhZ2VbXSBzdGFnZXM7CgogIHN0cnVjdCBTdGFnZSB7CiAgICB1aW50MjU2IHRpbGw7CiAgICB1aW50MjU2IGNhcDsKICAgIHVpbnQ4IGRpc2NvdW50OwogIH0KCiAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICBCaXRjb2ludXNUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwoKICAvLyByZWZ1bmQgdmF1bHQgdXNlZCB0byBob2xkIGZ1bmRzIHdoaWxlIGNyb3dkc2FsZSBpcyBydW5uaW5nCiAgICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogIHVpbnQyNTYgcHVibGljIGN1cnJlbnRTdGFnZSA9IDA7CiAgICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwoKICBhZGRyZXNzIHRva2VuTWludGVyOwoKICBUb2tlblRpbWVsb2NrIHB1YmxpYyB0ZWFtVGltZWxvY2s7CiAgVG9rZW5UaW1lbG9jayBwdWJsaWMgY29tcGFueVRpbWVsb2NrOwoKICAvKioKICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICovCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCiAgZXZlbnQgRmluYWxpemVkKCk7CiAgLyoqCiAgICogV2hlbiB0aGVyZSBubyB0b2tlbnMgbGVmdCB0byBtaW50IGFuZCB0b2tlbiBtaW50ZXIgdHJpZXMgdG8gbWFudWFsbHkgbWludCB0b2tlbnMKICAgKiB0aGlzIGV2ZW50IGlzIHJhaXNlZCB0byBzaWduYWwgaG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdG8gY2hhcmdlIGJhY2sgdG8gcHVyY2hhc2VyCiAgICovCiAgZXZlbnQgTWFudWFsVG9rZW5NaW50UmVxdWlyZXNSZWZ1bmQoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgdWludDI1NiB2YWx1ZSk7CgogIGZ1bmN0aW9uIEJpdGNvaW51c0Nyb3dkc2FsZShhZGRyZXNzIF90b2tlbikgcHVibGljIHsKICAgIHN0YWdlcy5wdXNoKFN0YWdlKHsgdGlsbDogMTUxOTM0NDAwMCwgZGlzY291bnQ6IDQ3LCBjYXA6IDgwMDAwMDBlMTggfSkpOyAvLyAyMDE4LzAyLzIzIDAwOjAwIFVUQyArMAogICAgc3RhZ2VzLnB1c2goU3RhZ2UoeyB0aWxsOiAxNTIxODQ5NjAwLCBkaXNjb3VudDogNDAsIGNhcDogMTcwMDAwMDBlMTggfSkpOyAvLyAyMDE4LzAzLzI0IDAwOjAwIFVUQyArMAogICAgc3RhZ2VzLnB1c2goU3RhZ2UoeyB0aWxsOiAxNTIzODM2ODAwLCBkaXNjb3VudDogMzAsIGNhcDogMTUwMDAwMDBlMTggfSkpOyAvLyAyMDE4LzA0LzE2IDAwOjAwIFVUQyArMAogICAgc3RhZ2VzLnB1c2goU3RhZ2UoeyB0aWxsOiAxNTI1MjE5MjAwLCBkaXNjb3VudDogMTUsIGNhcDogNzAwMDAwMGUxOCB9KSk7IC8vIDIwMTgvMDUvMDIgMDA6MDAgVVRDICswCiAgICBzdGFnZXMucHVzaChTdGFnZSh7IHRpbGw6IDE1MjU5OTY4MDAsIGRpc2NvdW50OiA1LCAgY2FwOiAzMDAwMDAwZTE4IH0pKTsgLy8gMjAxOC8wNS8xMSAwMDowMCBVVEMgKzAKCiAgICB0b2tlbiA9IEJpdGNvaW51c1Rva2VuKF90b2tlbik7CiAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdChXQUxMRVQpOwogICAgdG9rZW5NaW50ZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgbW9kaWZpZXIgb25seVRva2VuTWludGVyT3JPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB0b2tlbk1pbnRlciB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKICAgIHVpbnQyNTYgbm93VGltZSA9IGdldE5vdygpOwogICAgLy8gdGhpcyBsb29wIG1vdmVzIHN0YWdlcyBhbmQgaW5zdXJlcyBjb3JyZWN0IHN0YWdlIGFjY29yZGluZyB0byBkYXRlCiAgICB3aGlsZSAoY3VycmVudFN0YWdlIDwgc3RhZ2VzLmxlbmd0aCAmJiBzdGFnZXNbY3VycmVudFN0YWdlXS50aWxsIDwgbm93VGltZSkgewogICAgICBzdGFnZXNbc3RhZ2VzLmxlbmd0aCAtIDFdLmNhcCA9IHN0YWdlc1tzdGFnZXMubGVuZ3RoIC0gMV0uY2FwLmFkZChzdGFnZXNbY3VycmVudFN0YWdlXS5jYXApOyAvLyBtb3ZlIGFsbCB1bnNvbGQgdG9rZW5zIHRvIGxhc3Qgc3RhZ2UKICAgICAgc3RhZ2VzW2N1cnJlbnRTdGFnZV0uY2FwID0gMDsKICAgICAgY3VycmVudFN0YWdlID0gY3VycmVudFN0YWdlLmFkZCgxKTsKICAgIH0KCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gY2FsY3VsYXRlVG9rZW5zKHdlaUFtb3VudCk7CgogICAgdWludDI1NiBleGNlc3MgPSBhcHBlbmRDb250cmlidXRpb24oYmVuZWZpY2lhcnksIHRva2Vucyk7CgogICAgaWYgKGV4Y2VzcyA+IDApIHsgLy8gaGFyZCBjYXAgcmVhY2hlZCwgbm8gbW9yZSB0b2tlbnMgdG8gbWludAogICAgICB1aW50MjU2IHJlZnVuZCA9IGV4Y2Vzcy5tdWwod2VpQW1vdW50KS5kaXYodG9rZW5zKTsKICAgICAgd2VpQW1vdW50ID0gd2VpQW1vdW50LnN1YihyZWZ1bmQpOwogICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICB9CgogICAgLy8gdXBkYXRlIHN0YXRlCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucy5zdWIoZXhjZXNzKSk7CgogICAgaWYgKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgV0FMTEVULnRyYW5zZmVyKHdlaUFtb3VudCk7CiAgICB9IGVsc2UgewogICAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKHdlaUFtb3VudCkobXNnLnNlbmRlcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbnModWludDI1NiBfd2VpQW1vdW50KSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgdG9rZW5zID0gX3dlaUFtb3VudC5tdWwoUkFURSkubXVsKDEwMCkuZGl2KHVpbnQyNTYoMTAwKS5zdWIoc3RhZ2VzW2N1cnJlbnRTdGFnZV0uZGlzY291bnQpKTsKCiAgICB1aW50MjU2IGJvbnVzID0gMDsKICAgIGlmIChjdXJyZW50U3RhZ2UgPiAwICYmIHRva2VucyA+PSBMQVJHRV9QVVJDSEFTRSkgewogICAgICBib251cyA9IHRva2Vucy5tdWwoTEFSR0VfUFVSQ0hBU0VfQk9OVVMpLmRpdigxMDApOwogICAgfQoKICAgIHJldHVybiB0b2tlbnMuYWRkKGJvbnVzKTsKICB9CgogIGZ1bmN0aW9uIGFwcGVuZENvbnRyaWJ1dGlvbihhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdG9rZW5zKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGV4Y2VzcyA9IF90b2tlbnM7CiAgICB1aW50MjU2IHRva2Vuc1RvTWludCA9IDA7CgogICAgd2hpbGUgKGV4Y2VzcyA+IDAgJiYgY3VycmVudFN0YWdlIDwgc3RhZ2VzLmxlbmd0aCkgewogICAgICBTdGFnZSBzdG9yYWdlIHN0YWdlID0gc3RhZ2VzW2N1cnJlbnRTdGFnZV07CiAgICAgIGlmIChleGNlc3MgPj0gc3RhZ2UuY2FwKSB7CiAgICAgICAgZXhjZXNzID0gZXhjZXNzLnN1YihzdGFnZS5jYXApOwogICAgICAgIHRva2Vuc1RvTWludCA9IHRva2Vuc1RvTWludC5hZGQoc3RhZ2UuY2FwKTsKICAgICAgICBzdGFnZS5jYXAgPSAwOwogICAgICAgIGN1cnJlbnRTdGFnZSA9IGN1cnJlbnRTdGFnZS5hZGQoMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhZ2UuY2FwID0gc3RhZ2UuY2FwLnN1YihleGNlc3MpOwogICAgICAgIHRva2Vuc1RvTWludCA9IHRva2Vuc1RvTWludC5hZGQoZXhjZXNzKTsKICAgICAgICBleGNlc3MgPSAwOwogICAgICB9CiAgICB9CiAgICB0b2tlbi5taW50KF9iZW5lZmljaWFyeSwgdG9rZW5zVG9NaW50KTsKICAgIHJldHVybiBleGNlc3M7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCB3aXRoaW5QZXJpb2QgPSBnZXROb3coKSA+PSBTVEFSVF9USU1FICYmIGdldE5vdygpIDw9IEVORF9USU1FOwogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgIGJvb2wgY2FuTWludCA9IHRva2VuLnRvdGFsU3VwcGx5KCkgPCBJQ09fVE9LRU5TOwogICAgYm9vbCB2YWxpZFN0YWdlID0gKGN1cnJlbnRTdGFnZSA8IHN0YWdlcy5sZW5ndGgpOwogICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2UgJiYgY2FuTWludCAmJiB2YWxpZFN0YWdlOwogIH0KCiAgLy8gaWYgY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmRzIGhlcmUKICAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgICAgcmVxdWlyZShpc0ZpbmFsaXplZCk7CiAgICAgIHJlcXVpcmUoIWdvYWxSZWFjaGVkKCkpOwoKICAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICAqIEBkZXYgTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvIHNvbWUgZXh0cmEgZmluYWxpemF0aW9uCiAgICAqIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CgogICAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewogICAgICB2YXVsdC5jbG9zZSgpOwoKICAgICAgdGVhbVRpbWVsb2NrID0gbmV3IFRva2VuVGltZWxvY2sodG9rZW4sIFRFQU1fV0FMTEVULCBnZXROb3coKS5hZGQoVEVBTV9UT0tFTlNfTE9DS19QRVJJT0QpKTsKICAgICAgdG9rZW4ubWludCh0ZWFtVGltZWxvY2ssIFRFQU1fVE9LRU5TKTsKCiAgICAgIGNvbXBhbnlUaW1lbG9jayA9IG5ldyBUb2tlblRpbWVsb2NrKHRva2VuLCBDT01QQU5ZX1dBTExFVCwgZ2V0Tm93KCkuYWRkKENPTVBBTllfVE9LRU5TX0xPQ0tfUEVSSU9EKSk7CiAgICAgIHRva2VuLm1pbnQoY29tcGFueVRpbWVsb2NrLCBDT01QQU5ZX1RPS0VOUyk7CgogICAgICB0b2tlbi5taW50KEJPVU5UWV9XQUxMRVQsIEJPVU5UWV9UT0tFTlMpOwoKICAgICAgdG9rZW4uZmluaXNoTWludGluZygpOwogICAgICB0b2tlbi50cmFuc2Zlck93bmVyc2hpcCgweDEpOwogICAgICB9IGVsc2UgewogICAgICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgICB9CgogICAgICBGaW5hbGl6ZWQoKTsKCiAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICAgIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQKICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBnZXROb3coKSA+IEVORF9USU1FIHx8IHRva2VuLnRvdGFsU3VwcGx5KCkgPT0gSUNPX1RPS0VOUzsKICB9CgogICAgZnVuY3Rpb24gZ29hbFJlYWNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiB0b2tlbi50b3RhbFN1cHBseSgpID49IFNPRlRfQ0FQOwogICAgfQoKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMgb3IgY2xhaW0gcmVmdW5kCiAgICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgaWYgKCFpc0ZpbmFsaXplZCkgewogICAgICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIGNsYWltUmVmdW5kKCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3NbXSBfcmVjZWl2ZXJzLCB1aW50MjU2W10gX2Ftb3VudHMpIGV4dGVybmFsIG9ubHlUb2tlbk1pbnRlck9yT3duZXIgewogICAgcmVxdWlyZShfcmVjZWl2ZXJzLmxlbmd0aCA+IDAgJiYgX3JlY2VpdmVycy5sZW5ndGggPD0gMTAwKTsKICAgIHJlcXVpcmUoX3JlY2VpdmVycy5sZW5ndGggPT0gX2Ftb3VudHMubGVuZ3RoKTsKICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9yZWNlaXZlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgYWRkcmVzcyByZWNlaXZlciA9IF9yZWNlaXZlcnNbaV07CiAgICAgIHVpbnQyNTYgYW1vdW50ID0gX2Ftb3VudHNbaV07CgogICAgICAgIHJlcXVpcmUocmVjZWl2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShhbW91bnQgPiAwKTsKCiAgICAgICAgdWludDI1NiBleGNlc3MgPSBhcHBlbmRDb250cmlidXRpb24ocmVjZWl2ZXIsIGFtb3VudCk7CgogICAgICAgIGlmIChleGNlc3MgPiAwKSB7CiAgICAgICAgICBNYW51YWxUb2tlbk1pbnRSZXF1aXJlc1JlZnVuZChyZWNlaXZlciwgZXhjZXNzKTsKICAgICAgICB9CiAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5NaW50ZXIoYWRkcmVzcyBfdG9rZW5NaW50ZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICByZXF1aXJlKF90b2tlbk1pbnRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgdG9rZW5NaW50ZXIgPSBfdG9rZW5NaW50ZXI7CiAgICB9CgogIGZ1bmN0aW9uIGdldE5vdygpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIG5vdzsKICB9Cn0='.
	

]
