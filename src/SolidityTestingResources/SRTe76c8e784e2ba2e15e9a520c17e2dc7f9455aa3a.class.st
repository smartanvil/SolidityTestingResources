Class {
	#name : #SRTe76c8e784e2ba2e15e9a520c17e2dc7f9455aa3a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe76c8e784e2ba2e15e9a520c17e2dc7f9455aa3a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8qKgogKiBAdGl0bGUgTWFzdGVyaXVtIFRva2VuIFtNVEldCiAqIEBhdXRob3IgcHJpbWVSZXYKICogQG5vdGljZSBtYXN0ZXJpdW0gW210aV0gdG9rZW4gY29udHJhY3QgKHRva2Vuc2FsZSwgKGN1bW11bGF0ZWQpIGludGVyZXN0IHBheW91dHMsIG1hc3Rlcm5vZGVzCiAqLwoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHt1aW50MjU2IGMgPSBhICogYjsgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsgcmV0dXJuIGM7fQogICAgLy91bnVzZWQ6OiBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nikge3VpbnQyNTYgYyA9IGEgLyBiOyByZXR1cm4gYzt9CiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nikge2Fzc2VydChiIDw9IGEpOyByZXR1cm4gYSAtIGI7fQogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHt1aW50MjU2IGMgPSBhICsgYjsgYXNzZXJ0KGMgPj0gYSk7IHJldHVybiBjO30KfQoKLyoqCiAqIEB0aXRsZSBSZWVudHJ5UHJvdGVjdGVkCiAqIEBkZXYgTXV0ZXggYmFzZWQgcmVlbnRyeSBwcm90ZWN0aW9uCiAqLwpjb250cmFjdCBSZWVudHJ5UHJvdGVjdGVkIHsKICAgIC8qCiAgICBmaWxlOiAgIFJlZW50cnlQcm90ZWN0aW9uLnNvbCAoaHR0cHM6Ly9naXRodWIuY29tL28wcmFnbWFuMG8vUmVlbnRyeVByb3RlY3RlZCkKICAgIHZlcjogICAgMC4zLjAKICAgIHVwZGF0ZWQ6Ni1BcHJpbC0yMDE2CiAgICBhdXRob3I6IERhcnJ5bCBNb3JyaXMKICAgIGVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20KCiAgICBNdXRleCBiYXNlZCByZWVudHJ5IHByb3RlY3Rpb24gcHJvdGVjdC4KCiAgICBUaGlzIHNvZnR3YXJlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCiAgICA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAgICAqLwogICAgLy8gVGhlIHJlZW50cnkgcHJvdGVjdGlvbiBzdGF0ZSBtdXRleC4KICAgIGJvb2wgX19yZU11dGV4OwoKICAgIC8vIFRoaXMgbW9kaWZpZXIgY2FuIGJlIHVzZWQgb24gZnVuY3Rpb25zIHdpdGggZXh0ZXJuYWwgY2FsbHMgdG8KICAgIC8vIHByZXZlbnQgcmVlbnRyeSBhdHRhY2tzLgogICAgLy8gQ29uc3RyYWludHM6CiAgICAvLyAgIFByb3RlY3RlZCBmdW5jdGlvbnMgbXVzdCBoYXZlIG9ubHkgb25lIHBvaW50IG9mIGV4aXQuCiAgICAvLyAgIFByb3RlY3RlZCBmdW5jdGlvbnMgY2Fubm90IHVzZSB0aGUgYHJldHVybmAga2V5d29yZAogICAgLy8gICBQcm90ZWN0ZWQgZnVuY3Rpb25zIHJldHVybiB2YWx1ZXMgbXVzdCBiZSB0aHJvdWdoIHJldHVybiBwYXJhbWV0ZXJzLgogICAgbW9kaWZpZXIgcHJldmVudFJlZW50cnkoKSB7CiAgICAgICAgcmVxdWlyZSghX19yZU11dGV4KTsKICAgICAgICBfX3JlTXV0ZXggPSB0cnVlOwogICAgICAgIF87CiAgICAgICAgZGVsZXRlIF9fcmVNdXRleDsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAvKiB1bnVzZWQ6OgogICAgLy8gVGhpcyBtb2RpZmllciBjYW4gYmUgYXBwbGllZCB0byBwdWJsaWMgYWNjZXNzIHN0YXRlIG11dGF0aW9uIGZ1bmN0aW9ucwogICAgLy8gdG8gcHJvdGVjdCBhZ2FpbnN0IHJlZW50cnkgaWYgYSBgcHJldmVudFJlZW50cnlgIGZ1bmN0aW9uIGhhcyBhbHJlYWR5CiAgICAvLyBzZXQgdGhlIG11dGV4LiBUaGlzIHByZXZlbnRzIHRoZSBjb250cmFjdCBmcm9tIGJlaW5nIHJlZW50ZXIgdW5kZXIgYQogICAgLy8gZGlmZmVyZW50IG1lbW9yeSBjb250ZXh0IHdoaWNoIGNhbiBicmVhayBzdGF0ZSB2YXJpYWJsZSBpbnRlZ3JpdHkuCiAgICBtb2RpZmllciBub1JlZW50cnkoKSB7CiAgICAgICAgcmVxdWlyZSghX19yZU11dGV4KTsKICAgICAgICBfOwogICAgfQogICAgKi8KfQoKLyoqCiAqIEB0aXRsZSBNYXN0ZXJpdW0gVG9rZW4gW01USV0KICogQGF1dGhvciBwcmltZVJldgogKiBAbm90aWNlIG1hc3Rlcml1bSBbbXRpXSB0b2tlbiBjb250cmFjdCAodG9rZW5zYWxlLCAoY3VtbXVsYXRlZCkgaW50ZXJlc3QgcGF5b3V0cywgbWFzdGVybm9kZXMKICogQGRldiBjb2RlIGlzIGhlYXZpbHkgY29tbWVudGVkLCBmZWVsIGZyZWUgdG8gY2hlY2sgaXQKICovCmNvbnRyYWN0IE1hc3Rlcml1bVRva2VuIGlzIFJlZW50cnlQcm90ZWN0ZWQgIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDggIHB1YmxpYyBkZWNpbWFsczsKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbjsKCiAgICAvLyB1c2VkIHRvIHNjYWxlIHRva2VuIGFtb3VudHMgdG8gMTggZGVjaW1hbHMKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgVE9LRU5fTVVMVElQTElFUiA9IDFlMTg7CgogICAgYWRkcmVzcyBpbnRlcm5hbCBjb250cmFjdE93bmVyOwoKICAgIC8vIERFQlVHCiAgICBib29sICAgIGludGVybmFsIGRlYnVnID0gZmFsc2U7CgogICAgLy8gaW4gZGVidWdnaW5nIG1vZGUKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgREVCVUdfU0FMRUZBQ1RPUiA9IDE7IC8vIDEwMCAtPiBhZGRpdGlvbmFsIGZhY3RvciBmb3IgRVRIIHRvIFRva2VuIGNhbGN1bGF0aW9uCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IERFQlVHX1NUQVJUREVMQVkgPSAxIG1pbnV0ZXM7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IERFQlVHX0lOVEVSVkFMICAgPSAxIGRheXM7CgogICAgLy8gaW4gcHJvZHVjdGlvbiBtb2RlCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFBST0RVQ1RJT05fU0FMRUZBQ1RPUiA9IDE7ICAgICAgICAgICAvLyBhZGRpdGlvbmFsIHRva2Vuc2FsZSBleGNoYW5nZSByYXRlIGZhY3RvciBUb2tlbnMgcGVyIEVUSDogcHJvZHVjdGlvbiA9IDEKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUFJPRFVDVElPTl9TVEFSVCAgICAgID0gMTUxMTYxMTIwMDsgIC8vIHRva2Vuc2FsZSBzdGFydHMgYXQgdW5pdHRpbWVzdGFtcDogMTUxMTYxMTIwMCA9IDExLzI1LzIwMTcgQCAxMjowMHBtIChVVEMpIChhcHByb3guICsvLTkwMCBzZWMuKQogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQUk9EVUNUSU9OX0lOVEVSVkFMICAgPSAzMCBkYXlzOwoKICAgIGV2ZW50IERlYnVnVmFsdWUoc3RyaW5nIHRleHQsIHVpbnQyNTYgdmFsdWUpOwoKCgogICAgc3RydWN0IEFjY291bnQgewogICAgICAgIHVpbnQyNTYgYmFsYW5jZTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBiYWxhbmNlIGluY2x1ZGluZyBhbHJlYWR5IHBheWVkIG91dCBpbnRlcmVzdAogICAgICAgIHVpbnQyNTYgbGFzdFBheW91dEludGVydmFsOyAgICAgICAgICAgICAvLyBpbnRlcnZhbC1pbmRleCBvZiBsYXN0IHBheW91dAogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBBY2NvdW50KSAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbCBhY2NvdW50czsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikpICBwdWJsaWMgYWxsb3dlZDsKCgogICAgdWludDI1NiBpbnRlcm5hbCBfc3VwcGx5VG90YWw7CiAgICB1aW50MjU2IGludGVybmFsIF9zdXBwbHlMYXN0UGF5b3V0SW50ZXJ2YWw7IC8vIGludGVydmFsIG9mIGxhc3QgcHJvY2Vzc2VkIGludGVyZXN0IHBheW91dAoKCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIC8vICsKICAgIC8vICsgaW50ZXJlc3Qgc3R1ZmYKICAgIC8vICsKICAgIC8vICsgaW50ZXJlc3QgaXMgcGF5ZWQgb3V0IGV2ZXJ5IDMwIGRheXMgKGludGVydmFsKQogICAgLy8gKyBpbnRlcmVzdC1yYXRlIGlzIGEgZnVuY3Rpb24gb2YgaW50ZXJ2YWwtaW5kZXggJSBwZXJpb2RpY2l0eQogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICBzdHJ1Y3QgSW50ZXJlc3RDb25maWcgewogICAgICAgIHVpbnQyNTYgaW50ZXJ2YWw7ICAgICAgICAgICAvLyBpbnRlcmVzdCBpcyBwYWlkIGV2ZXJ5IHggc2Vjb25kcyAoZGVmYXVsdDogMzAgZGF5cykKICAgICAgICB1aW50MjU2IHBlcmlvZGljaXR5OyAgICAgICAgLy8gaW50ZXJlc3QtcmF0ZSBjaGFuZ2UgYnkgdGltZSBhbmQgcmVzdGFydCBhZnRlciAicGVyaW9kaWNpdHkiCiAgICAgICAgdWludDI1NiBzdG9wQXRJbnRlcnZhbDsgICAgIC8vIG5vIG1vcmUgaW50ZXJlc3QgYWZ0ZXIgc3RvcC1pbmRleAogICAgICAgIHVpbnQyNTYgc3RhcnRBdFRpbWVzdGFtcDsgICAvLyB0aW1lIHRoZSBpbnRlcnZhbC1pbmRleCBzdGFydHMgaW5jcmVhc2luZwogICAgfQoKICAgIEludGVyZXN0Q29uZmlnIGludGVybmFsIGludGVyZXN0Q29uZmlnOyAvLyBzZXQgaW4gY29uc3RydWN0b3I6OiA9IEludGVyZXN0Q29uZmlnKDMwIGRheXMsMTIsNDgsMCk7CgogICAgdWludDI1NlsxMl0gaW50ZXJuYWwgaW50ZXJlc3RSYXRlczsKICAgIHVpbnQyNTZbNF0gIGludGVybmFsIHN0YWdlRmFjdG9yczsKCgoKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgLy8gKwogICAgLy8gKyBtYXN0ZXJub2RlIHN0dWZmCiAgICAvLyArCiAgICAvLyArIGV2ZXJ5IHRva2VuLXRyYW5zYWN0aW9uIGNvc3RzIGEgZmVlLCBwYXllZCBpbiB0b2tlbnMgKDAuMDEpCiAgICAvLyArIE1hc3Rlcm5vZGVzIGVhcm4gdGhlIGZlZXMKICAgIC8vICsgTWFzdGVybm9kZXMgZ2V0IGRvdWJsZSBpbnRlcmVzdAogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICBzdHJ1Y3QgU3RydWN0TWFzdGVybm9kZSB7CiAgICAgICAgdWludDggICBhY3RpdmVNYXN0ZXJub2RlczsgICAgICAgICAgICAgIC8vIGNvdW50IG9mIHJlZ2lzdGVyZWQgTU4KICAgICAgICB1aW50MjU2IHRvdGFsQmFsYW5jZVdlaTsgICAgICAgICAgICAgICAgLy8gaW4gdGhlIGNvbnRyYWN0IGRlcG9zaXRlZCBldGhlciAoaW4gd2VpKQogICAgICAgIHVpbnQyNTYgcmV3YXJkUG9vbDsgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IHVzZWQgaWYgbm8gbWFzdGVybm9kZSBpcyByZWdpc3RlcmVkIC0+IGFsbCB0cmFuc2FjdGlvbiBmZWVzIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHJld2FyZFBvb2wgYW5kIHBheWVkIG91dCB0byB0aGUgZmlyc3QgbWFzdGVybm9kZSByZWdpc3RlcmluZwogICAgICAgIHVpbnQyNTYgcmV3YXJkc1BheWVkVG90YWw7ICAgICAgICAgICAgICAvLyBsb2cgYWxsIHBheW91dHMgZm9yIE1OLXN0YXRpc3RpY3MKCiAgICAgICAgdWludDI1NiBtaW5pbmdSZXdhcmRJblRva2VuczsgICAgICAgICAgIC8vIG1hc3Rlcm5vZGVzIGNhbiBtaW5lIHggdG9rZW5zIHBlciBpbnRlcnZhbAogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnNNaW5lZFJhdzFlMTg7ICAgICAgICAvLyBsb2dnaW5nOiB0b3RhbCB0b2tlbnMgbWluZWQgdGlsbCBub3cKCiAgICAgICAgdWludDI1NiB0cmFuc2FjdGlvblJld2FyZEluU3VidG9rZW5zUmF3MWUxODsvL2ZlZSwgc3VidHJhY3RlZCBmcm9tIHRva2VuIHNlbmRlciBvbiBldmVyeSB0cmFuc2FjdGlvbgoKICAgICAgICB1aW50MjU2IG1pbkJhbGFuY2VSZXF1aXJlZEluVG9rZW5zOyAgICAgLy8gdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlIC0+IGEgYmFsYW5jZSBvZiAxMDAwMDAgdG9rZW5zIGlzIHJlcXVpcmVkCiAgICAgICAgdWludDI1NiBtaW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTg7Ly8gKCoxZTE4IGZvciBpbnRlcm5hbCBpbnRlZ2VyIGNhbGN1bGF0aW9ucykKCiAgICAgICAgdWludDI1NiBtaW5EZXBvc2l0UmVxdWlyZWRJbkV0aGVyOyAgICAgIC8vIHRvIHJlZ2lzdGVyIGEgbWFzdGVybm9kZSBhIGRlcG9zaXQgaW4gZXRoZXIgaXMgcmVxdWlyZWQgLT4gaXMgYSBmdW5jdGlvbiBvZiBjb3VudDogImFjdGl2ZU1hc3Rlcm5vZGVzIgogICAgICAgIHVpbnQyNTYgbWluRGVwb3NpdFJlcXVpcmVkSW5XZWk7ICAgICAgICAvLyAuLi4gc2FtZSBpbiB3ZWkgKGZvciBpbnRlcm5hbCB1c2UpCiAgICAgICAgdWludDggICBtYXhNYXN0ZXJub2Rlc0FsbG93ZWQ7ICAgICAgICAgIC8vIG5vIG1vcmUgdGhhbiB4IG1hc3Rlcm5vZGVzIGFsbG93ZWQsIGRlZmF1bHQ6IDIyCiAgICB9CgogICAgc3RydWN0IE1hc3Rlcm5vZGUgewogICAgICAgIGFkZHJlc3MgYWRkcjsgICAgICAgICAgIC8vIDE2MCBiaXQgICAgICAvLyB3YWxsZXQtYWRkcmVzc2VzIG9mIG1hc3Rlcm5vZGUgb3duZXIKICAgICAgICB1aW50MjU2IGJhbGFuY2VXZWk7ICAgICAvLyAgOTYgYml0ICAgICAgLy8gYW1vdW50IGV0aGVyIGRlcG9zaXRlZCBpbiB0aGUgY29udHJhY3QKICAgICAgICB1aW50MjU2IHNpbmNlSW50ZXJ2YWw7ICAgICAgICAgICAgICAgICAgLy8gTU4gY3JlYXRlZCBhdCB0aGlzIGludGVydmFsLWluZGV4CiAgICAgICAgdWludDI1NiBsYXN0TWluaW5nSW50ZXJ2YWw7ICAgICAgICAgICAgIC8vIGxhc3QgaW50ZXJ2YWwgYSBNTiBtaW5lZCBuZXcgY29pbnMKICAgIH0KCiAgICBTdHJ1Y3RNYXN0ZXJub2RlIHB1YmxpYyBtYXN0ZXJub2RlOyAvLyA9IFN0cnVjdE1hc3Rlcm5vZGUoMCwwLDAsMCwxMDAwMDAgZXRoZXIsIDAuMDEgZXRoZXIsMSwxIGV0aGVyLDIyKTsKICAgIE1hc3Rlcm5vZGVbMjJdICAgcHVibGljIG1hc3Rlcm5vZGVzOwogICAgdWludDggaW50ZXJuYWwgY29uc3RhbnQgbWF4TWFzdGVybm9kZXMgPSAyMjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgbWluaW5nUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4OyAvLyAoKjFlMTggZm9yIGludGVybmFsIGludGVnZXIgY2FsY3VsYXRpb25zKQoKCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIC8vICsKICAgIC8vICsgdG9rZW5zYWxlIHN0dWZmCiAgICAvLyArCiAgICAvLyArIDIwIE1pby4gVG9rZW5zIGNyZWF0ZWQgYXQgY29udHJhY3Qgc3RhcnQgKGFkbWluIHdhbGxldCkKICAgIC8vICsgY29udHJpYnV0ZXJzIGNhbiBidXkgYnkgIkJ1eSItZnVuY3Rpb24gLT4gRVRIIHNlbmQgdG8gYWRtaW5XYWxsZXQKICAgIC8vICsgY29udHJpYnV0ZXJzIGNhbiBidXkgYnkgZmFpbHNhdmUtZnVuY3Rpb24gLT4gRVRIIHNlbmQgdG8gY29udHJhY3QsIGFkbWluIGNhbiB3aXRoZHJhdwogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCgogICAgc3RydWN0IFN0cnVjdHRva2Vuc2FsZSB7IC8vIGNvbXBpbGVyIGxpbWl0OiBtYXguIDE2IHZhcnMgLT4gc3RhY2sgdG9vIGRlZXAKICAgICAgICAvLyAxIHRva2VuID0gMWUxOCBzdWJUb2tlbnMgKHNtYWxsZXN0IHRva2VuIHVuaXQsIHVzZWQgZm9yIGludGVybmFsIGludGVnZXIgcHJvY2Vzc2luZykKICAgICAgICB1aW50MjU2IGluaXRpYWxUb2tlblN1cHBseVJBVzFlMTg7ICAgICAgLy8gVG9rZW5zIGludGVybmFsIHJlc29sdXRpb246IDFlMTggPSAxIEV0aGVyID0gMWUxOCBXZWkKICAgICAgICB1aW50MjU2IGluaXRpYWxUb2tlblN1cHBseUFtb3VudDsKICAgICAgICB1aW50MjU2IGluaXRpYWxUb2tlblN1cHBseUZyYWN0aW9uOwoKICAgICAgICB1aW50MjU2IG1pblBheW1lbnRSZXF1aXJlZFVuaXRXZWk7ICAgICAgLy8gbWluLiBwYXltZW50IHJlcXVpcmVkIGZvciBidXlpbmcgdG9rZW5zLCBkZWZhdWx0OiAwLjAwMDEgRVRICiAgICAgICAgdWludDI1NiBtYXhQYXltZW50QWxsb3dlZFVuaXRXZWk7ICAgICAgIC8vIGxpbWl0IG1heC4gYWxsb3dlZCBwYXltZW50IHBlciBidXkgdG8gMTAwIEVUSAoKICAgICAgICB1aW50MjU2IHN0YXJ0QXRUaW1lc3RhbXA7ICAgICAgICAgICAgICAgLy8gdW5peHRpbWUgdGhlIHRva2Vuc2FsZSBzdGFydHMKCiAgICAgICAgYm9vbCAgICB0b2tlblNhbGVDbG9zZWQ7ICAgICAgICAgICAgICAgIC8vIHNldCB0byB0cnVlIGJ5IGFkbWluIChtYW51YWxseSkgb3IgY29udHJhY3QgKGF1dG9tYXRpY2FsbHkgaWYgbWF4LiBzdXBwbHkgcmVhY2hlZCkgaWYgc2FsZSBpcyBjbG9zZWQKICAgICAgICBib29sICAgIHRva2VuU2FsZVBhdXNlZDsgICAgICAgICAgICAgICAgLy8gYWRtaW4gY2FuIHRlbXAuIHBhdXNlIHRva2Vuc2FsZQoKICAgICAgICB1aW50MjU2IHRvdGFsV2VpUmFpc2VkOyAgICAgICAgICAgICAgICAgLy8gYnkgdG9rZW5zYWxlCiAgICAgICAgdWludDI1NiB0b3RhbFdlaUluRmFsbGJhY2s7ICAgICAgIC8vIGlmIHNvbWVvbmUgc2VuZCBldGhlciBkaXJlY3RseSB0byBjb250cmFjdCAtPiBhZG1pbiBjYW4gd2l0aGRyYXcgdGhpcyBiYWxhbmNlCgogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTg7CiAgICAgICAgdWludDI1NiB0b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkQW1vdW50OwogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnNEaXN0cmlidXRlZEZyYWN0aW9uOwogICAgfQoKICAgIFN0cnVjdHRva2Vuc2FsZSBwdWJsaWMgdG9rZW5zYWxlOwogICAgYWRkcmVzcyBhZG1pbldhbGxldDsgICAgICAgIC8vIDE2MCBiaXQKICAgIGJvb2wgICAgc2VuZEZ1bmRzVG9XYWxsZXQ7ICAvLyAxIGJpdCAgICAvLyBkZWZhdWx0OnRydWUgLT4gdHJhbnNmZXIgZXRoIG9uIGJ1eTsgZmFsc2UgLT4gYWRtaW4gbXVzdCB3aXRoZHJhdwogICAgdWludDI1NiBpbnRlcm5hbCBjb250cmFjdENyZWF0aW9uVGltZXN0YW1wOyAgICAgIC8vIChhcHByb3guKSBjcmVhdGlvbiB0aW1lIG9mIGNvbnRyYWN0IC0+IGJhc2UgZm9yIGludGVydmFsLWluZGV4IGNhbGN1bGF0aW9uCiAgICB1aW50MjU2WzIwXSB0b2tlbnNhbGVGYWN0b3I7CgogICAgLyogIC8vIGRlYnVnIG9ubHk6IGxvZyBhbGwgY29udGlidXRlcnMgKi8KICAgIHN0cnVjdCBDb250cmlidXRvciB7CiAgICAgICAgYWRkcmVzcyBhZGRyOwogICAgICAgIHVpbnQyNTYgYW1vdW50V2VpOwogICAgICAgIHVpbnQyNTYgYW1vdW50VG9rZW5zVW5pdDFlMTg7CiAgICAgICAgdWludDI1NiBzaW5jZUludGVydmFsOwogICAgfQoKICAgIENvbnRyaWJ1dG9yW10gcHVibGljIHRva2Vuc2FsZUNvbnRyaWJ1dG9yczsgLy8gYXJyYXkgb2YgYWxsIGNvbnRyaWJ1dG9ycwogICAgLyogKi8KCgoKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgLy8gKwogICAgLy8gKyBjb250cmFjdCBjb25zdHJ1Y3RvciAtPiBpbml0IGRlZmF1bHQgdmFsdWVzCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIGZ1bmN0aW9uIE1hc3Rlcml1bVRva2VuKCkgcGF5YWJsZSBwdWJsaWMgeyAvLyBjb25zdHJ1Y3RvcgogICAgICAgIC8vIGNvbnRyYWN0IGNyZWF0aW9uOiAzOTkzMzE3CiAgICAgICAgbmFtZSAgICAgPSAoZGVidWcpID8gIk1hc3Rlcml1bV9UZXN0bmV0IiA6ICJNYXN0ZXJpdW0iOwogICAgICAgIHN5bWJvbCAgID0gKGRlYnVnKSA/ICJNVElUZXN0bmV0IiA6ICJNVEkiOwogICAgICAgIHZlcnNpb24gID0gKGRlYnVnKSA/ICIxLjAwLjAwLlRlc3RuZXQiIDogIjEuMDAuMDAiOwogICAgICAgIGRlY2ltYWxzID0gMTg7IC8vIGludGVybmFsIHJlc29sdXRpb24gPSAxZTE4ID0gMSBXZWkKCiAgICAgICAgY29udHJhY3RPd25lciA9IG1zZy5zZW5kZXI7CgogICAgICAgIGFkbWluV2FsbGV0ID0gMHhBYjk0MjI1NmI0OUYwYzg0MUQzNzFEQzNkRmU3OGJlRmVhNDQ3YTI3OwoKICAgICAgICBzZW5kRnVuZHNUb1dhbGxldCA9IHRydWU7CgogICAgICAgIGNvbnRyYWN0Q3JlYXRpb25UaW1lc3RhbXAgPSBfZ2V0VGltZXN0YW1wKCk7CgogICAgICAgIC8vIHRva2VuU0FMRTogMjAgbWlvIHRva2VucyBjcmVhdGVkOyBhbGwgdG8gc2VsbDsKICAgICAgICB0b2tlbnNhbGUuaW5pdGlhbFRva2VuU3VwcGx5UkFXMWUxOCA9IDIwMDAwMDAwICogVE9LRU5fTVVMVElQTElFUjsgLy8gMjAgbWlvIHRva2VucyA9PSAyMCBtaW8gKiAxMF4xOCBzdWJ0b2tlbnMgKHNtYWxsZXN0IHVuaXQgZm9yIGludGVybmFsIHByb2Nlc3NpbmcpOwogICAgICAgIHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlBbW91bnQgID0gdG9rZW5zYWxlLmluaXRpYWxUb2tlblN1cHBseVJBVzFlMTggLyBUT0tFTl9NVUxUSVBMSUVSOwogICAgICAgIHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlGcmFjdGlvbj0gdG9rZW5zYWxlLmluaXRpYWxUb2tlblN1cHBseVJBVzFlMTggJSBUT0tFTl9NVUxUSVBMSUVSOwoKICAgICAgICAvLyBsaW1pdCBidXkgYW1vdW50IChwZXIgdHJhbnNhY3Rpb24pIGR1cmluZyB0b2tlbnNhbGUgdG8gYSByYW5nZSBmcm9tIDAuMDAwMSB0byAxMDAgZXRoZXIgcGVyICJidXl0b2tlbnMiLWNvbW1hbmQuCiAgICAgICAgdG9rZW5zYWxlLm1pblBheW1lbnRSZXF1aXJlZFVuaXRXZWkgPSAwLjAwMDEgZXRoZXI7IC8vIHRyYW5zbGF0ZXMgdG8gMC4wMDAxICogMWUxOAogICAgICAgIHRva2Vuc2FsZS5tYXhQYXltZW50QWxsb3dlZFVuaXRXZWkgID0gMTAwIGV0aGVyOyAgICAvLyB0cmFuc2xhdGVzIHRvIDEwMC4wMCAqIDFlMTgKCiAgICAgICAgcmVxdWlyZShhZG1pbldhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlSQVcxZTE4ID4gMCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNhbGUubWluUGF5bWVudFJlcXVpcmVkVW5pdFdlaSA+IDApOwogICAgICAgIHJlcXVpcmUodG9rZW5zYWxlLm1heFBheW1lbnRBbGxvd2VkVW5pdFdlaSA+IHRva2Vuc2FsZS5taW5QYXltZW50UmVxdWlyZWRVbml0V2VpKTsKCiAgICAgICAgdG9rZW5zYWxlLnRva2VuU2FsZVBhdXNlZCA9IGZhbHNlOwogICAgICAgIHRva2Vuc2FsZS50b2tlblNhbGVDbG9zZWQgPSBmYWxzZTsKCiAgICAgICAgdG9rZW5zYWxlLnRvdGFsV2VpUmFpc2VkID0gMDsgICAgICAgICAgICAgICAvLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGJ1eWVkIGR1cmluZyB0b2tlbnNhbGUKICAgICAgICB0b2tlbnNhbGUudG90YWxXZWlJbkZhbGxiYWNrID0gMDsgICAgIC8vIHRoZSBmYWN0aW9uIG9mIHRvdGFsIGFtb3VudCB3aGljaCB3YXMgZG9uZSBieSBmYWlsc2FmZSA9IGRpcmVjdCBldGhlciBzZW5kIHRvIGNvbnRyYWN0CgogICAgICAgIHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkUkFXMWUxOCA9IDA7CiAgICAgICAgdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRBbW91bnQgID0gMDsKICAgICAgICB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZEZyYWN0aW9uPSAwOwoKICAgICAgICB0b2tlbnNhbGUuc3RhcnRBdFRpbWVzdGFtcCA9IChkZWJ1ZykgPyBjb250cmFjdENyZWF0aW9uVGltZXN0YW1wICsgX2FkZFRpbWUoREVCVUdfU1RBUlRERUxBWSkgOiBQUk9EVUNUSU9OX1NUQVJUOy8vIHRva2Vuc2FsZSBzdGFydHMgYXQgeAoKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMF0gPSAyMDAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxXSA9IDEwMDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzJdID0gODAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclszXSA9IDUwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbNF0gPSA1MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzVdID0gNTAwOwogICAgICAgIHRva2Vuc2FsZUZhY3Rvcls2XSA9IDUwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbN10gPSA1MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzhdID0gNTAwOwogICAgICAgIHRva2Vuc2FsZUZhY3Rvcls5XSA9IDQwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMTBdID0gNDAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxMV0gPSA0MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzEyXSA9IDIwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMTNdID0gMjAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxNF0gPSAyMDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzE1XSA9IDQwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMTZdID0gNTAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxN10gPSA4MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzE4XSA9IDEwMDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzE5XSA9IDI1MDA7CgogICAgICAgIF9zdXBwbHlUb3RhbCA9IHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlSQVcxZTE4OwogICAgICAgIF9zdXBwbHlMYXN0UGF5b3V0SW50ZXJ2YWwgPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW50ZXJ2YWwgKGluZGV4KSBvZiBsYXN0IHByb2Nlc3NlZCBpbnRlcmVzdC1wYXlvdXQgKGluaXRpYXRlZCBieSBhIGdhcyBvcGVyYXRpb24pCgogICAgICAgIGFjY291bnRzW2NvbnRyYWN0T3duZXJdLmJhbGFuY2UgPSB0b2tlbnNhbGUuaW5pdGlhbFRva2VuU3VwcGx5UkFXMWUxODsKICAgICAgICBhY2NvdW50c1tjb250cmFjdE93bmVyXS5sYXN0UGF5b3V0SW50ZXJ2YWwgPSAwOwogICAgICAgIC8vYWNjb3VudHNbY29udHJhY3RPd25lcl0ubGFzdEFjdGlvbiA9IGNvbnRyYWN0Q3JlYXRpb25UaW1lc3RhbXA7CgogICAgICAgIC8vIE1BU1RFUk5PREU6IG1hc3Rlcm5vZGVzIGVhcm4gYWxsIHRyYW5zYWN0aW9uIGZlZXMgZnJvbSBiYWxhbmNlIHRyYW5zZmVycyBhbmQgY2FuIG1pbmUgbmV3IHRva2VucwogICAgICAgIG1hc3Rlcm5vZGUudHJhbnNhY3Rpb25SZXdhcmRJblN1YnRva2Vuc1JhdzFlMTggPSAwLjAxICogKDEgZXRoZXIpOyAvLyAwLjAxICogMWUxOCBzdWJ0b2tlbnMgPSAwLjAxIHRva2VuCgogICAgICAgIG1hc3Rlcm5vZGUubWluaW5nUmV3YXJkSW5Ub2tlbnMgPSA1MDAwMDsgLy8gNTAnMDAwIHRva2VucyB0byBtaW5lIHBlciBtYXN0ZXJub2RlIHBlciBpbnRlcnZhbAogICAgICAgIG1pbmluZ1Jld2FyZEluU3VidG9rZW5zUmF3MWUxOCA9IG1hc3Rlcm5vZGUubWluaW5nUmV3YXJkSW5Ub2tlbnMgKiBUT0tFTl9NVUxUSVBMSUVSOyAvLyB1c2VkIGZvciBpbnRlcm5hbCBpbnRlZ2VyIGNhbGN1bGF0aW9uCgogICAgICAgIG1hc3Rlcm5vZGUudG90YWxUb2tlbnNNaW5lZFJhdzFlMTggPSAwOyAvLyBsb2dzIHRoZSBhbW91bnQgb2YgdG9rZW5zIG1pbmVkIGJ5IG1hc3Rlcm5vZGVzCgogICAgICAgIG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5Ub2tlbnMgPSAxMDAwMDA7IC8vdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlIC0+IGEgYmFsYW5jZSBvZiAxMDAwMDAgdG9rZW5zIGlzIHJlcXVpcmVkCiAgICAgICAgbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTggPSBtYXN0ZXJub2RlLm1pbkJhbGFuY2VSZXF1aXJlZEluVG9rZW5zICogVE9LRU5fTVVMVElQTElFUjsgLy8gdXNlZCBmb3IgaW50ZXJuYWwgaW50ZWdlciBjYWxjdWxhdGlvbgoKICAgICAgICBtYXN0ZXJub2RlLm1heE1hc3Rlcm5vZGVzQWxsb3dlZCA9IHVpbnQ4KG1heE1hc3Rlcm5vZGVzKTsKICAgICAgICBtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzPSAwOwogICAgICAgIG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpICA9IDA7CiAgICAgICAgbWFzdGVybm9kZS5yZXdhcmRQb29sICAgICAgID0gMDsKICAgICAgICBtYXN0ZXJub2RlLnJld2FyZHNQYXllZFRvdGFsPSAwOwoKICAgICAgICBtYXN0ZXJub2RlLm1pbkRlcG9zaXRSZXF1aXJlZEluRXRoZXI9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbkV0aGVyKCk7Ly8gdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlIC0+IGEgZGVwb3NpdCBvZiBldGhlciBpcyByZXF1aXJlZCAoYSBmdW5jdGlvbiBvZiBudW1NYXN0ZXJub2RlcykKICAgICAgICBtYXN0ZXJub2RlLm1pbkRlcG9zaXRSZXF1aXJlZEluV2VpICA9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpOyAvLyB1c2VkIGZvciBpbnRlcm5hbCBpbnRlZ2VyIGNhbGN1bGF0aW9uCgoKICAgICAgICAvLyBJTlRFUkVTVDogZXZlcnkgdG9rZW5ob2xkZXIgZWFybiBpbnRlcmVzdCAoJSBvZiBiYWxhbmNlKSBhdCBhIGZpeGVkIGludGVydmFsIChvbmNlIHBlciAzMCBkYXlzKQogICAgICAgIGludGVyZXN0Q29uZmlnLmludGVydmFsID0gX2FkZFRpbWUoIChkZWJ1ZykgPyBERUJVR19JTlRFUlZBTCA6IFBST0RVQ1RJT05fSU5URVJWQUwgKTsgLy8gaW50ZXJlc3QgcGF5b3V0IGludGVydmFsIGluIHNlY29uZHMsIGRlZmF1bHQ6IGV2ZXJ5IDMwIGRheXMKICAgICAgICBpbnRlcmVzdENvbmZpZy5wZXJpb2RpY2l0eSAgICAgID0gMTI7ICAgIC8vIGludGVyZXN0SW50ZXJ2YWxDYXBwZWQgPSBpbnRlcnZhbElEWCAlIHBlcmlvZGljaXR5CiAgICAgICAgaW50ZXJlc3RDb25maWcuc3RvcEF0SW50ZXJ2YWwgICA9IDQgKiBpbnRlcmVzdENvbmZpZy5wZXJpb2RpY2l0eTsgIC8vIHN0b3AgcGF5aW5nIGludGVyZXN0IGFmdGVyIHggaW50ZXJ2YWxzIChwZXJmb3JtYW5jZSByZWFzb25zKQogICAgICAgIGludGVyZXN0Q29uZmlnLnN0YXJ0QXRUaW1lc3RhbXAgPSB0b2tlbnNhbGUuc3RhcnRBdFRpbWVzdGFtcDsgLy8gZmlyc3QgcGF5b3V0IGlzIGFmdGVyIG9uZSBpbnRlcnZhbAoKICAgICAgICAvLyBpbnRlcmVzdCBpcyByZWR1Y2VkIGV2ZXJ5IDMwIGRheXMgYW5kIHJlc2V0IHRvIDFzdCBldmVyeSBzdGFnZSAoYWZ0ZXIgMTIgaW50ZXJ2YWxzKQogICAgICAgIGludGVyZXN0UmF0ZXNbIDBdID0gMTAwMDAwMDAwMDAwMDsgLy8gaW50ZXJ2YWwgMSA9IDEwMCUKICAgICAgICBpbnRlcmVzdFJhdGVzWyAxXSA9ICA4MDAwMDAwMDAwMDA7IC8vIDgwJQogICAgICAgIGludGVyZXN0UmF0ZXNbIDJdID0gIDYwMDAwMDAwMDAwMDsKICAgICAgICBpbnRlcmVzdFJhdGVzWyAzXSA9ICA0MDAwMDAwMDAwMDA7CiAgICAgICAgaW50ZXJlc3RSYXRlc1sgNF0gPSAgMjAwMDAwMDAwMDAwOwogICAgICAgIGludGVyZXN0UmF0ZXNbIDVdID0gIDEwMDAwMDAwMDAwMDsKICAgICAgICBpbnRlcmVzdFJhdGVzWyA2XSA9ICAgNTAwMDAwMDAwMDA7CiAgICAgICAgaW50ZXJlc3RSYXRlc1sgN10gPSAgIDUwMDAwMDAwMDAwOwogICAgICAgIGludGVyZXN0UmF0ZXNbIDhdID0gICAzMDAwMDAwMDAwMDsKICAgICAgICBpbnRlcmVzdFJhdGVzWyA5XSA9ICAgNDAwMDAwMDAwMDA7CiAgICAgICAgaW50ZXJlc3RSYXRlc1sxMF0gPSAgIDIwMDAwMDAwMDAwOwogICAgICAgIGludGVyZXN0UmF0ZXNbMTFdID0gICAxMDAwMDAwMDAwMDsgLy8gICAxJQoKICAgICAgICAvLyBpbnRlcmVzdFJhdGVzIGFyZSByZWR1Y2VkIGJ5IGZhY3RvciBldmVyeSAxMiBpbnRlcnZhbHMgPSAxIHN0YWdlCiAgICAgICAgc3RhZ2VGYWN0b3JzWzBdID0gIDEwMDAwMDAwMDAwMDA7IC8vIGludGVydmFsICAxLi4xMiA9IGZhY3RvciAxCiAgICAgICAgc3RhZ2VGYWN0b3JzWzFdID0gIDQwMDAwMDAwMDAwMDA7IC8vIGludGVydmFsIDEzLi4yNCA9IGZhY3RvciA0CiAgICAgICAgc3RhZ2VGYWN0b3JzWzJdID0gIDgwMDAwMDAwMDAwMDA7CiAgICAgICAgc3RhZ2VGYWN0b3JzWzNdID0gMTYwMDAwMDAwMDAwMDA7CiAgICB9CgoKCgogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICAvLyArCiAgICAvLyArIEVSQzIwIHN0dWZmCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgLy9ldmVudCBJbnRlcmVzdFBheWVkKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiBpbnRlcmVzdFBheWVkKTsKCiAgICAvLyBlcmMyMDogdHJhbXNmZXJGcm9tOjogQWxsb3cgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB5b3VyIGFjY291bnQsIG11bHRpcGxlIHRpbWVzLCB1cCB0byB0aGUgX3ZhbHVlIGFtb3VudC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIGVyYzIwOiB0cmFtc2ZlckZyb206OiBSZXR1cm5zIHRoZSBhbW91bnQgd2hpY2ggX3NwZW5kZXIgaXMgc3RpbGwgYWxsb3dlZCB0byB3aXRoZHJhdyBmcm9tIF9vd25lcgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLyBlcmMyMDogdHJhbXNmZXJGcm9tCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIGVyYzIwOiB0cmFtc2ZlckZyb20KICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQyNTYgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gZXJjMjA6IHB1YmxpYyAoY29tbWFuZCk6IHRva2VuIHRyYW5zZmVyIGJ5IG93bmVyIHRvIHNvbWVvbmUKICAgIC8vIGF0dG46IHRvdGFsID0gX3ZhbHVlICsgdHJhbnNhY3Rpb25GZWUgISEhIC0+IGFjY291bnQtYmFsYW5jZSA+PSBfdmFsdWUgKyB0cmFuc2FjdGlvbkZlZQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF9zZXRCYWxhbmNlcyhtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7IC8vIHdpbGwgZmFpbCBpZiBub3QgZW5vdWdoIGJhbGFuY2UKICAgICAgICBfc2VuZEZlZXNUb01hc3Rlcm5vZGVzKG1hc3Rlcm5vZGUudHJhbnNhY3Rpb25SZXdhcmRJblN1YnRva2Vuc1JhdzFlMTgpOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gZXJjMjA6IHB1YmxpYyAoY29tbWFuZCk6IFNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBhZGRyZXNzIF9mcm9tIHRvIGFkZHJlc3MgX3RvCiAgICAvLyBhdHRuOiB0b3RhbCA9IF92YWx1ZSArIHRyYW5zYWN0aW9uRmVlICEhISAtPiBhY2NvdW50LWJhbGFuY2UgPj0gX3ZhbHVlICsgdHJhbnNhY3Rpb25GZWUKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7IC8vIHdpbGwgZmFpbCBpZiBubyAobm90IGVub3VnaCkgYWxsb3dhbmNlCiAgICAgICAgX3NldEJhbGFuY2VzKF9mcm9tLCBfdG8sIF92YWx1ZSk7ICAvLyB3aWxsIGZhaWwgaWYgbm90IGVub3VnaCBiYWxhbmNlCiAgICAgICAgX3NlbmRGZWVzVG9NYXN0ZXJub2RlcyhtYXN0ZXJub2RlLnRyYW5zYWN0aW9uUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4KTsKCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBlcmMyMDogcHVibGljIChyZWFkIG9ubHkpCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IC8qdG90YWxTdXBwbHkqLykgewogICAgICAgIHJldHVybiBfY2FsY0JhbGFuY2UoX3N1cHBseVRvdGFsLCBfc3VwcGx5TGFzdFBheW91dEludGVydmFsLCBpbnRlcnZhbE5vdygpKTsKICAgIH0KCiAgICAvLyBlcmMyMAogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIF9jYWxjQmFsYW5jZShhY2NvdW50c1tfb3duZXJdLmJhbGFuY2UsIGFjY291bnRzW19vd25lcl0ubGFzdFBheW91dEludGVydmFsLCBpbnRlcnZhbE5vdygpKTsKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGp1c3QgdG8gbG9vayBwcmV0dHkgLT4gc3BsaXQgMWUxOCByZW9sdXRpb24gdG8gbWFpbnVuaXRzIGFuZCB0aGUgZnJhY3Rpb24gcGFydCwganVzdCBmb3IgZGlyZWN0IGVuZHVzZXIgbG9va3lsb29reSBhdCBjb250cmFjdCB2YXJpYWJsZXMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5UHJldHR5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG9rZW5zLCB1aW50MjU2IGZyYWN0aW9uKSB7CiAgICAgICAgdWludDI1NiBfcmF3ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICB0b2tlbnMgID0gX3JhdyAvIFRPS0VOX01VTFRJUExJRVI7CiAgICAgICAgZnJhY3Rpb249IF9yYXcgJSBUT0tFTl9NVUxUSVBMSUVSOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KToganVzdCB0byBsb29rIHByZXR0eSAtPiBzcGxpdCAxZTE4IHJlb2x1dGlvbiB0byBtYWludW5pdHMgYW5kIHRoZSBmcmFjdGlvbiBwYXJ0LCBqdXN0IGZvciBkaXJlY3QgZW5kdXNlciBsb29reWxvb2t5IGF0IGNvbnRyYWN0IHZhcmlhYmxlcwogICAgZnVuY3Rpb24gYmFsYW5jZU9mUHJldHR5KGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b2tlbnMsIHVpbnQyNTYgZnJhY3Rpb24pIHsKICAgICAgICB1aW50MjU2IF9yYXcgPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICB0b2tlbnMgID0gX3JhdyAvIFRPS0VOX01VTFRJUExJRVI7CiAgICAgICAgZnJhY3Rpb249IF9yYXcgJSBUT0tFTl9NVUxUSVBMSUVSOwogICAgfQoKCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIC8vICsKICAgIC8vICsgSW50ZXJlc3Qgc3R1ZmYKICAgIC8vICsKICAgIC8vICsgZXZlcnkgdG9rZW4gaG9sZGVyIHJlY2VpdmVzIGludGVyZXN0IChiYXNlZCBvbiB0b2tlbiBiYWxhbmNlKSBhdCBmaXhlZCBpbnRlcnZhbHMgKGJ5IGRlZmF1bHQ6IDMwIGRheXMpCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IHN0YWdlID0gaG93IG1hbnkgaW50ZXJ2YWwgY3ljbGVzIGNvbXBsZXRlZDsgaW5jcmVhc2UgZXZlcnkgMTIgaW50ZXJ2YWxzIGJ5IDE7IDEgc3RhZ2UgPSBhcHByb3guIDEgeWVhcgogICAgLy8gc3RhZ2UgaXMgdW5zZWQgaW4gaW50ZXJlc3QgY2FsY3VsYXRpb24gLT4geWVhcmx5IGZhY3RvcgogICAgLy8gdW5uZWNlc3NhcnkgLT4ganVzdCBmb3IgZW5kdXNlciBsb29reWxvb2t5CiAgICBmdW5jdGlvbiBzdGFnZU5vdygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGludGVydmFsTm93KCkgLyBpbnRlcmVzdENvbmZpZy5wZXJpb2RpY2l0eTsKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGludGVydmFsID0gaW5kZXggb2YgdGhlIGFjdGl2ZSBpbnRlcmVzdCBpbnRlcnZhbC4gZmlyc3QgaW50ZXJ2YWwgPSAwOyBpbmNyZWFzZSBldmVyeSAzMCBkYXlzIGJ5IDE7IDEgaW50ZXJ2YWwgPSBhcHByb3ggMSBtb250aAogICAgLy8gaW50ZXJ2YWwgaXMgdXNlZCBmb3IgaW50ZXJlc3QgcGF5b3V0cyBhbmQgdmFsaWRhdGluZyBtYXN0ZXJub2RlIG1pbmluZyBpbnRlcnZhbAogICAgZnVuY3Rpb24gaW50ZXJ2YWxOb3coKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgdGltZXN0YW1wID0gX2dldFRpbWVzdGFtcCgpOwogICAgICAgIHJldHVybiAodGltZXN0YW1wIDwgaW50ZXJlc3RDb25maWcuc3RhcnRBdFRpbWVzdGFtcCkgPyAwIDogKHRpbWVzdGFtcCAtIGludGVyZXN0Q29uZmlnLnN0YXJ0QXRUaW1lc3RhbXApIC8gaW50ZXJlc3RDb25maWcuaW50ZXJ2YWw7CiAgICB9CgogICAgLy8gcHVibGljIChyZWFkIG9ubHkpOiB1bml4dGltZSB0byBuZXh0IGludGVyZXN0IHBheW91dAogICAgLy8gdW5uZWNlc3NhcnkgLT4ganVzdCBmb3IgZW5kdXNlciBsb29reWxvb2t5CiAgICBmdW5jdGlvbiBzZWNUb05leHRJbnRlcmVzdFBheW91dCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGludGVydmFsTm93KCkgPiBpbnRlcmVzdENvbmZpZy5zdG9wQXRJbnRlcnZhbCkgcmV0dXJuIDA7IC8vIG5vIGludGVyZXN0IGFmdGVyIHggaW50ZXJ2YWxzCiAgICAgICAgLy9zaG9ydGN1dHRlZCB0byByZXR1cm46CiAgICAgICAgLy91aW50MjU2IHRpbWVzdGFtcCA9IF9nZXRUaW1lc3RhbXAoKTsKICAgICAgICAvL3VpbnQyNTYgaW50Tm93ID0gaW50ZXJ2YWxOb3coKTsKICAgICAgICAvL3VpbnQyNTYgbmV4dFBheW91dFRpbWVzdGFtcCA9IGludGVyZXN0Q29uZmlnLnN0YXJ0QXRUaW1lc3RhbXAgKyAoaW50Tm93ICsxKSogaW50ZXJlc3RDb25maWcuaW50ZXJ2YWw7CiAgICAgICAgLy9yZXR1cm4gbmV4dFBheW91dFRpbWVzdGFtcCAtIHRpbWVzdGFtcDsKICAgICAgICByZXR1cm4gKGludGVyZXN0Q29uZmlnLnN0YXJ0QXRUaW1lc3RhbXAgKyAoaW50ZXJ2YWxOb3coKSArIDEpICogaW50ZXJlc3RDb25maWcuaW50ZXJ2YWwpIC0gX2dldFRpbWVzdGFtcCgpOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogbmV4dCBpbnRlcmVzdCBwYXlvdXQgcmF0ZSBpbiBwZXJjZW50CiAgICAvLyB1bm5lY2Vzc2FyeSAtPiBqdXN0IGZvciBlbmR1c2VyIGxvb2t5bG9va3kKICAgIGZ1bmN0aW9uIGludGVyZXN0TmV4dEluUGVyY2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IG1haW5Vbml0LCB1aW50MjU2IGZyYWN0aW9uKSB7CiAgICAgICAgdWludDI1NiBfbm93ID0gaW50ZXJ2YWxOb3coKTsKICAgICAgICB1aW50MjU2IF9yYXcgPSBfY2FsY0JhbGFuY2UoMTAwICogVE9LRU5fTVVMVElQTElFUiwgX25vdywgX25vdysxKTsKICAgICAgICBtYWluVW5pdCA9IChfcmF3IC0gMTAwICogVE9LRU5fTVVMVElQTElFUikgLyBUT0tFTl9NVUxUSVBMSUVSOwogICAgICAgIGZyYWN0aW9uID0gKF9yYXcgLSAxMDAgKiBUT0tFTl9NVUxUSVBMSUVSKSAlIFRPS0VOX01VTFRJUExJRVI7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGludGVybmFsIChnYXMgb3BlcmF0aW9uKTogdHJpZ2dlcmVkIGJlZm9yZSBhbnkgKGdhcyBjb3N0eSBvcGVyYXRpb24pIGJhbGFuY2UgdHJhbnNhY3Rpb24gLT4gYWNjb3VudCBpbnRlcmVzdCB0byBiYWxhbmNlIG9mIGFkZHJlc3MKICAgIC8vIGl0cyBmb3IgcGVyZm9ybWFuY2UgcmVhc29uczogdXNlIGEgZ2FzIG9wZXJhdGlvbiB0byBhZGQgbmV3IChjdW11bGF0ZWQpIGludGVyZXN0IHRvIGFjY291bnQtYmFsYW5jZSB0byByZWR1Y2UgaW50ZXJlc3QtY2FsYy1sb29wIChiYWxhbmNlT2YpCiAgICBmdW5jdGlvbiBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpIGludGVybmFsIHsKICAgICAgICAvLyBwYXlvdXQgaW50ZXJlc3QgdG8gYmFsYW5jZSBhbmQgc2V0IG5ldyBwYXlvdXQgaW5kZXgKICAgICAgICB1aW50MjU2IG9sZGJhbCA9IF9zdXBwbHlUb3RhbDsgICAvLyByZWFkIGxhc3Qga25vd24gYmFsYW5jZSA9PSBiYWxhbmNlIGF0IHRpbWVpbmRleDogIl9zdXBwbHlMYXN0UGF5b3V0SW50ZXJ2YWwiCiAgICAgICAgdWludDI1NiBuZXdiYWwgPSB0b3RhbFN1cHBseSgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIGludGVyZXN0IGNhbGN1bGF0aW9uIGxvb3AgZnJvbSAibGFzdFBheW91dEludGVydmFsIiB0byBub3cKICAgICAgICBpZiAob2xkYmFsIDwgbmV3YmFsKSB7ICAvLyBpZiBiYWxhbmNlIGNoYW5nZWQgYmVjYXVzZSBvZiBuZXcgaW50ZXJlc3QgLi4uCiAgICAgICAgICAgIF9zdXBwbHlUb3RhbCA9IG5ld2JhbDsKICAgICAgICB9CiAgICAgICAgLy8gc2V0IG5ldyBsYXN0UGF5b3V0SW50ZXJ2YWwgZm9yIHVzZSBpbiBjYWxjdWxhdGlvbiBsb29wCiAgICAgICAgX3N1cHBseUxhc3RQYXlvdXRJbnRlcnZhbCA9IGludGVydmFsTm93KCk7IC8vIGludGVyZXN0IGFscmVhZHkgcGF5ZWQgb3V0IHRvIF9zdXBwbHlUb3RhbCB1bnRpbCB0aGlzIGluZGV4IChub3cpCiAgICB9CgogICAgLy8gaW50ZXJuYWwgKGdhcyBvcGVyYXRpb24pOiB0cmlnZ2VyZWQgYmVmb3JlIGFueSAoZ2FzIGNvc3R5IG9wZXJhdGlvbikgYmFsYW5jZSB0cmFuc2FjdGlvbiAtPiBhY2NvdW50IGludGVyZXN0IHRvIGJhbGFuY2Ugb2YgYWRkcmVzcwogICAgLy8gaXRzIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiB1c2UgYSBnYXMgb3BlcmF0aW9uIHRvIGFkZCBuZXcgKGN1bXVsYXRlZCkgaW50ZXJlc3QgdG8gYWNjb3VudC1iYWxhbmNlIHRvIHJlZHVjZSBpbnRlcmVzdC1jYWxjLWxvb3AgKGJhbGFuY2VPZikKICAgIGZ1bmN0aW9uIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKGFkZHJlc3MgX293bmVyKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gcGF5b3V0IGludGVyZXN0IHRvIGJhbGFuY2UgYW5kIHNldCBuZXcgcGF5b3V0IGluZGV4CiAgICAgICAgdWludDI1NiBvbGRiYWwgPSBhY2NvdW50c1tfb3duZXJdLmJhbGFuY2U7ICAvLyByZWFkIGxhc3Qga25vd24gYmFsYW5jZSA9PSBiYWxhbmNlIGF0IHRpbWVpbmRleDogImFjY291bnRzW19vd25lcl0ubGFzdFBheW91dEludGVydmFsIgogICAgICAgIHVpbnQyNTYgbmV3YmFsID0gYmFsYW5jZU9mKF9vd25lcik7ICAgICAgICAgLy8gZG8gaW50ZXJlc3QgY2FsY3VsYXRpb24gbG9vcCBmcm9tICJsYXN0UGF5b3V0SW50ZXJ2YWwiIHRvIG5vdwogICAgICAgIGlmIChvbGRiYWwgPCBuZXdiYWwpIHsgIC8vIGlmIGJhbGFuY2UgY2hhbmdlZCBiZWNhdXNlIG9mIG5ldyBpbnRlcmVzdCAuLi4KICAgICAgICAgICAgYWNjb3VudHNbX293bmVyXS5iYWxhbmNlID0gbmV3YmFsOwoKICAgICAgICAgICAgLy9ubyBuZWVkIGZvciBsb2dnaW5nIHRoaXM6OiBJbnRlcmVzdFBheWVkKF9vd25lciwgbmV3YmFsIC0gb2xkYmFsKTsKICAgICAgICB9CiAgICAgICAgLy8gc2V0IG5ldyBsYXN0UGF5b3V0SW50ZXJ2YWwgZm9yIHVzZSBpbiBjYWxjdWxhdGlvbiBsb29wCiAgICAgICAgYWNjb3VudHNbX293bmVyXS5sYXN0UGF5b3V0SW50ZXJ2YWwgPSBpbnRlcnZhbE5vdygpOyAvLyBpbnRlcmVzdCBhbHJlYWR5IHBheWVkIG91dCB0byBbb3duZXJdLmJhbGFuY2UgdW50aWwgdGhpcyBpbmRleCAobm93KQogICAgfQoKICAgIC8vIGludGVybmFsIChnYXMgb3BlcmF0aW9uKTogdHJpZ2dlcmVkIGJ5IGEgdHJhbnNhdGlvbi1mdW5jdGlvbiAtPiBwYXkgaW50ZXJlc3QgdG8gYm90aCBhZGRyOyBzdWJ0cmFjdCB0cmFuc2FjdGlvbiBmZWU7IGRvIHRva2VuLXRyYW5zZmVyCiAgICAvLyBldmVyeSBjYWxsIHRyaWdnZXJzIHRoZSBpbnRlcmVzdCBwYXlvdXQgbG9vcCBhbmQgYWRkcyB0aGUgbmV3IGJhbGFuY2UgaW50ZXJuYWx5IC0+IG5leHQgbG9vcCBjYW4gc2F2ZSBjcHUtY3ljbGVzCiAgICBmdW5jdGlvbiBfc2V0QmFsYW5jZXMoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfZnJvbSAhPSBfdG8pOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIHNldCBuZXcgYmFsYW5jZSAoYW5kIG5ldyAibGFzdCBwYXlvdXQgaW5kZXgiKSBpbmNsdWRpbmcgaW50ZXJlc3QgZm9yIGJvdGggcGFydGllcyBiZWZvcmUgdHJhbnNmZXIKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShfZnJvbSk7ICAgLy8gc2V0IG5ldyBiYWxhbmNlIGluY2x1ZGluZyBpbnRlcmVzdAogICAgICAgIC8vdW5jb21tZW50ZWQgdG8ga2VlcCB0aGUgdHJhbnNhY3Rpb24gY2hlZXBlci4uLjo6X3JlcXVlc3RJbnRlcmVzdFBheW91dFRvQWNjb3VudEJhbGFuY2UoX3RvKTsgICAgIC8vIHNldCBuZXcgYmFsYW5jZSBpbmNsdWRpbmcgaW50ZXJlc3QKICAgICAgICAvL3VuY29tbWVudGVkIHRvIGtlZXAgdGhlIHRyYW5zYWN0aW9uIGNoZWVwZXIuLi46Ol9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb1RvdGFsU3VwcGx5KCk7CgogICAgICAgIC8vIHRoZXJlIG11c3QgYmUgZW5vdWdoIGJhbGFuY2UgZm9yIHRyYW5zZmVyIEFORCB0cmFuc2FjdGlvbi1mZWUKICAgICAgICByZXF1aXJlKF92YWx1ZS5hZGQobWFzdGVybm9kZS50cmFuc2FjdGlvblJld2FyZEluU3VidG9rZW5zUmF3MWUxOCkgPD0gYWNjb3VudHNbX2Zyb21dLmJhbGFuY2UpOwoKICAgICAgICAvLyBpZiBzZW5kZXIgaXMgYSBtYXN0ZXJub2RlOiBmcmVlemUgMTAwayBvZiB0b2tlbnMgYmFsYW5jZSAtPiB0byByZWxlYXNlIHRoZSBiYWxhbmNlIGl0IGlzIHJlcXVpcmVkIHRvIGRlcmVnaXN0ZXIgdGhlIG1hc3Rlcm5vZGUgZmlyc3QKICAgICAgICBpZiAobWFzdGVybm9kZUlzVmFsaWQoX2Zyb20pKSB7CiAgICAgICAgICAgIHJlcXVpcmUoYWNjb3VudHNbX2Zyb21dLmJhbGFuY2UgPj0gbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTguYWRkKF92YWx1ZSkpOyAvLyBtYXN0ZXJub2RlczogMTAwayBiYWxhbmNlIGlzIGZyZWV6ZWQKICAgICAgICB9CgogICAgICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgICAgICBhY2NvdW50c1tfZnJvbV0uYmFsYW5jZSA9IGFjY291bnRzW19mcm9tXS5iYWxhbmNlLnN1YihfdmFsdWUpLnN1YihtYXN0ZXJub2RlLnRyYW5zYWN0aW9uUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4KTsKICAgICAgICBhY2NvdW50c1tfdG9dLmJhbGFuY2UgICA9IGFjY291bnRzW190b10uYmFsYW5jZS5hZGQoX3ZhbHVlKTsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAobm8gZ2FzKTogY2FsYyBpbnRlcmVzdCBhcyBhIGZ1bmN0aW9uIG9mIGludGVydmFsLWluZGV4IChsb29wIGZyb20taW50ZXJ2YWwgdG8gdG8taW50ZXJ2YWwpCiAgICBmdW5jdGlvbiBfY2FsY0JhbGFuY2UodWludDI1NiBfYmFsYW5jZSwgdWludDI1NiBfZnJvbSwgdWludDI1NiBfdG8pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhdHRuLjogc2lnbmlmaWNhbnQgaW50ZWdlciBjYXBwaW5nIGZvciBiYWxhbmNlcyA8IDFlLTE2IC0+IGFjY2VwdGFibGUgbGltaXRhdGlvbgogICAgICAgIHVpbnQyNTYgX25ld2JhbGFuY2UgPSBfYmFsYW5jZTsKICAgICAgICBpZiAoX3RvID4gaW50ZXJlc3RDb25maWcuc3RvcEF0SW50ZXJ2YWwpIF90byA9IGludGVyZXN0Q29uZmlnLnN0b3BBdEludGVydmFsOyAvLyBubyAobW9yZSkgaW50ZXJlc3QgYWZ0ZXIgeCBpbnRlcnZhbHMgKGRlZmF1bHQ6IDQ4KQogICAgICAgIGlmIChfZnJvbSA8IF90bykgeyAvLyBpbnRlcmVzdCBpbmRleCBzaW5jZSBsYXN0IHBheW91dCAoc3RvcmFnZSBvcGVyYXRpb24gaW4gdHJhbnNmZXJzKSAtPiBjYWxjIG5ldyBiYWxhbmNlCiAgICAgICAgICAgIGZvciAodWludDI1NiBpZHggPSBfZnJvbTsgaWR4IDwgX3RvOyBpZHgrKykgeyAvLyBsb29wIG92ZXIgdW5wYXllZCBpbnRlcnZhbHMgKHNpbmNlIGxhc3QgcGF5b3V0LW9wZXJhdGlvbiB0aWxsIG5vdykKICAgICAgICAgICAgICAgIGlmIChpZHggPiA0OCkgYnJlYWs7IC8vIGhhcmRjYXA6IGp1c3QgZm9yIC4uLiB5b3Uga25vdwoKICAgICAgICAgICAgICAgIF9uZXdiYWxhbmNlICs9IChfbmV3YmFsYW5jZSAqIGludGVyZXN0UmF0ZXNbaWR4ICUgaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHldKSAvIHN0YWdlRmFjdG9yc1soaWR4IC8gaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHkpICUgNF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9uZXdiYWxhbmNlIDwgX2JhbGFuY2UpIHsgX25ld2JhbGFuY2UgPSBfYmFsYW5jZTsgfSAvLyBmYWlsc2F2ZSBpZiBzb21lIG1hdGggZ29lcyB3cm9uZyAob3ZlcmZsb3cpLiB3aG8ga25vd3MuLi4KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9uZXdiYWxhbmNlOwogICAgICAgIC8qICBpbnRlcmVzdCBieSB0aW1lICgxIGludGVydmFsID09IDMwIGRheXMpCiAgICAgICAgICAgIHN0YWdlZmFjdG9yCWludGVydmFsCWludGVyZXN0CSB0b3RhbCBzdXBwbHkJIHN1bSAlCiAgICAgICAgICAgIDEgICAgICAgICAgIDAgICAgICAgICAgICAgMC4wMDAwJSAgICAyMCcwMDAnMDAwLjAwICAgMTAwLjAwJQogICAgICAgICAgICBhZnRlciAzMCBkYXlzCiAgICAgICAgICAgIDEJICAgICAgICAxCSAgICAgICAgMTAwLjAwMDAlICAgIDQwJzAwMCcwMDAuMDAJIDIwMC4wMCUKICAgICAgICAgICAgMQkgICAgICAgIDIJICAgICAgICAgODAuMDAwMCUJIDcyJzAwMCcwMDAuMDAJIDM2MC4wMCUKICAgICAgICAgICAgMQkgICAgICAgIDMJICAgICAgICAgNjAuMDAwMCUJMTE1JzIwMCcwMDAuMDAJIDU3Ni4wMCUKICAgICAgICAgICAgMQkgICAgICAgIDQJICAgICAgICAgNDAuMDAwMCUJMTYxJzI4MCcwMDAuMDAJIDgwNi40MCUKICAgICAgICAgICAgMQkgICAgICAgIDUJICAgICAgICAgMjAuMDAwMCUJMTkzJzUzNicwMDAuMDAJIDk2Ny42OCUKICAgICAgICAgICAgMQkgICAgICAgIDYJICAgICAgICAgMTAuMDAwMCUJMjEyJzg4OSc2MDAuMDAJMTA2NC40NSUKICAgICAgICAgICAgMQkgICAgICAgIDcJICAgICAgICAgIDUuMDAwMCUJMjIzJzUzNCcwODAuMDAJMTExNy42NyUKICAgICAgICAgICAgMQkgICAgICAgIDgJICAgICAgICAgIDUuMDAwMCUJMjM0JzcxMCc3ODQuMDAJMTE3My41NSUKICAgICAgICAgICAgMQkgICAgICAgIDkJICAgICAgICAgIDMuMDAwMCUJMjQxJzc1MicxMDcuNTIJMTIwOC43NiUKICAgICAgICAgICAgMQkgICAgICAgIDEwCSAgICAgICAgICAzLjAwMDAlCTI0OScwMDQnNjcwLjc1CTEyNDUuMDIlCiAgICAgICAgICAgIDEJICAgICAgICAxMQkgICAgICAgICAgMi4wMDAwJQkyNTMnOTg0Jzc2NC4xNgkxMjY5LjkyJQogICAgICAgICAgICAxCSAgICAgICAgMTIJICAgICAgICAgIDEuMDAwMCUJMjU2JzUyNCc2MTEuODAJMTI4Mi42MiUKICAgICAgICAgICAgYWZ0ZXIgMSB5ZWFyOiAxMjgyLjYyJSBwYSBpbiB5ZWFyIDEKICAgICAgICAgICAgNAkgICAgICAgIDEzCSAgICAgICAgIDI1LjAwMDAlCTMyMCc2NTUnNzY0Ljc1CTE2MDMuMjglCiAgICAgICAgICAgIDQJICAgICAgICAxNAkgICAgICAgICAyMC4wMDAwJQkzODQnNzg2JzkxNy43MAkxOTIzLjkzJQogICAgICAgICAgICA0CSAgICAgICAgMTUJICAgICAgICAgMTUuMDAwMCUJNDQyJzUwNCc5NTUuMzYJMjIxMi41MiUKICAgICAgICAgICAgNAkgICAgICAgIDE2CSAgICAgICAgIDEwLjAwMDAlCTQ4Nic3NTUnNDUwLjg5CTI0MzMuNzglCiAgICAgICAgICAgIDQJICAgICAgICAxNwkgICAgICAgICAgNS4wMDAwJQk1MTEnMDkzJzIyMy40NAkyNTU1LjQ3JQogICAgICAgICAgICA0CSAgICAgICAgMTgJICAgICAgICAgIDIuNTAwMCUJNTIzJzg3MCc1NTQuMDMJMjYxOS4zNSUKICAgICAgICAgICAgNAkgICAgICAgIDE5CSAgICAgICAgICAxLjI1MDAlCTUzMCc0MTgnOTM1Ljk1CTI2NTIuMDklCiAgICAgICAgICAgIDQJICAgICAgICAyMAkgICAgICAgICAgMS4yNTAwJQk1MzcnMDQ5JzE3Mi42NQkyNjg1LjI1JQogICAgICAgICAgICA0CSAgICAgICAgMjEJICAgICAgICAgIDAuNzUwMCUJNTQxJzA3NycwNDEuNDQJMjcwNS4zOSUKICAgICAgICAgICAgNAkgICAgICAgIDIyCSAgICAgICAgICAwLjc1MDAlCTU0NScxMzUnMTE5LjI2CTI3MjUuNjglCiAgICAgICAgICAgIDQJICAgICAgICAyMwkgICAgICAgICAgMC41MDAwJQk1NDcnODYwJzc5NC44NQkyNzM5LjMwJQogICAgICAgICAgICA0CSAgICAgICAgMjQJICAgICAgICAgIDAuMjUwMCUJNTQ5JzIzMCc0NDYuODQJMjc0Ni4xNSUKICAgICAgICAgICAgYWZ0ZXIgMiB5ZWFyczogMjE0LjEwJSBwYSBpbiB5ZWFyIDIKICAgICAgICAgICAgOAkgICAgICAgIDI1CSAgICAgICAgIDEyLjUwMDAlCTYxNyc4ODQnMjUyLjY5CTMwODkuNDIlCiAgICAgICAgICAgIDgJICAgICAgICAyNgkgICAgICAgICAxMC4wMDAwJQk2NzknNjcyJzY3Ny45NgkzMzk4LjM2JQogICAgICAgICAgICA4CSAgICAgICAgMjcJICAgICAgICAgIDcuNTAwMCUJNzMwJzY0OCcxMjguODEJMzY1My4yNCUKICAgICAgICAgICAgOAkgICAgICAgIDI4CSAgICAgICAgICA1LjAwMDAlCTc2NycxODAnNTM1LjI1CTM4MzUuOTAlCiAgICAgICAgICAgIDgJICAgICAgICAyOQkgICAgICAgICAgMi41MDAwJQk3ODYnMzYwJzA0OC42MwkzOTMxLjgwJQogICAgICAgICAgICA4CSAgICAgICAgMzAJICAgICAgICAgIDEuMjUwMCUJNzk2JzE4OSc1NDkuMjQJMzk4MC45NSUKICAgICAgICAgICAgOAkgICAgICAgIDMxCSAgICAgICAgICAwLjYyNTAlCTgwMScxNjUnNzMzLjkyCTQwMDUuODMlCiAgICAgICAgICAgIDgJICAgICAgICAzMgkgICAgICAgICAgMC42MjUwJQk4MDYnMTczJzAxOS43Ngk0MDMwLjg3JQogICAgICAgICAgICA4CSAgICAgICAgMzMJICAgICAgICAgIDAuMzc1MCUJODA5JzE5NicxNjguNTgJNDA0NS45OCUKICAgICAgICAgICAgOAkgICAgICAgIDM0CSAgICAgICAgICAwLjM3NTAlCTgxMicyMzAnNjU0LjIyCTQwNjEuMTUlCiAgICAgICAgICAgIDgJICAgICAgICAzNQkgICAgICAgICAgMC4yNTAwJQk4MTQnMjYxJzIzMC44NQk0MDcxLjMxJQogICAgICAgICAgICA4CSAgICAgICAgMzYJICAgICAgICAgIDAuMTI1MCUJODE1JzI3OScwNTcuMzkJNDA3Ni40MCUKICAgICAgICAgICAgYWZ0ZXIgMyB5ZWFyczogMTQ4LjQ0JSBwYSBpbiB5ZWFyIDMKICAgICAgICAgICAgMTYJICAgICAgICAzNwkgICAgICAgICAgNi4yNTAwJQk4NjYnMjMzJzk5OC40OAk0MzMxLjE3JQogICAgICAgICAgICAxNgkgICAgICAgIDM4CSAgICAgICAgICA1LjAwMDAlCTkwOSc1NDUnNjk4LjQwCTQ1NDcuNzMlCiAgICAgICAgICAgIDE2CSAgICAgICAgMzkJICAgICAgICAgIDMuNzUwMCUJOTQzJzY1Myc2NjIuMDkJNDcxOC4yNyUKICAgICAgICAgICAgMTYJICAgICAgICA0MAkgICAgICAgICAgMi41MDAwJQk5NjcnMjQ1JzAwMy42NAk0ODM2LjIzJQogICAgICAgICAgICAxNgkgICAgICAgIDQxCSAgICAgICAgICAxLjI1MDAlCTk3OSczMzUnNTY2LjE5CTQ4OTYuNjglCiAgICAgICAgICAgIDE2CSAgICAgICAgNDIJICAgICAgICAgIDAuNjI1MCUJOTg1JzQ1Nic0MTMuNDgJNDkyNy4yOCUKICAgICAgICAgICAgMTYJICAgICAgICA0MwkgICAgICAgICAgMC4zMTI1JQk5ODgnNTM1Jzk2NC43Nwk0OTQyLjY4JQogICAgICAgICAgICAxNgkgICAgICAgIDQ0CSAgICAgICAgICAwLjMxMjUlCTk5MSc2MjUnMTM5LjY2CTQ5NTguMTMlCiAgICAgICAgICAgIDE2CSAgICAgICAgNDUJICAgICAgICAgIDAuMTg3NSUJOTkzJzQ4NCc0MzYuODAJNDk2Ny40MiUKICAgICAgICAgICAgMTYJICAgICAgICA0NgkgICAgICAgICAgMC4xODc1JQk5OTUnMzQ3JzIyMC4xMgk0OTc2Ljc0JQogICAgICAgICAgICAxNgkgICAgICAgIDQ3CSAgICAgICAgICAwLjEyNTAlCTk5Nic1OTEnNDA0LjE0CTQ5ODIuOTYlCiAgICAgICAgICAgIDE2CSAgICAgICAgNDgJICAgICAgICAgIDAuMDYyNSUJOTk3JzIxNCcyNzMuNzcJNDk4Ni4wNyUKICAgICAgICAgICAgYWZ0ZXIgNCB5ZWFyczogMTIyLjMyJSBwYSBpbiB5ZWFyIDQKICAgICAgICAgICAgMTYJICAgICAgICA0OSAuLiBpbmYgICAgIDAuMDAwMCUJOTk3JzIxNCcyNzMuNzcJNDk4Ni4wNyUKICAgICAgICAqLwogICAgfQoKCgoKCgogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICAvLyArCiAgICAvLyArIE1hc3Rlcm5vZGUgc3R1ZmYKICAgIC8vICsKICAgIC8vICsgZXZlcnkgcmVnaXN0ZXJlZCBtYXN0ZXJub2RlcyByZWNlaXZlcyBhIHBhcnQgb2YgdGhlIHRyYW5zYWN0aW9uIGZlZQogICAgLy8gKyBldmVyeSBtYXN0ZXJub2RlIGNhbiBtaW5lIDUwJiMxODA7MDAwIG9uY2UgZXZlcnkgaW50ZXJ2YWwgKDMwIGRheXMpCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIGV2ZW50IE1hc3Rlcm5vZGVSZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYXN0ZXJub2RlRGVyZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYXN0ZXJub2RlTWluZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IE1hc3Rlcm5vZGVUcmFuc2ZlcnJlZChhZGRyZXNzIGZyb21BZGRyLCBhZGRyZXNzIHRvQWRkcik7CiAgICBldmVudCBNYXN0ZXJub2RlUmV3YXJkU2VuZCh1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYXN0ZXJub2RlUmV3YXJkQWRkZWRUb1Jld2FyZFBvb2wodWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWF4TWFzdGVybm9kZXNBbGxvd2VkQ2hhbmdlZCh1aW50OCBuZXdOdW1NYXhNYXN0ZXJub2Rlc0FsbG93ZWQpOwogICAgZXZlbnQgVHJhbnNhY3Rpb25GZWVDaGFuZ2VkKHVpbnQyNTYgbmV3VHJhbnNhY3Rpb25GZWUpOwogICAgZXZlbnQgTWluZXJSZXdhcmRDaGFuZ2VkKHVpbnQyNTYgbmV3TWluZXJSZXdhcmQpOwoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogdW5peHRpbWUgdG8gbmV4dCBpbnRlcmVzdCBwYXlvdXQKICAgIC8vIHVubmVjZXNzYXJ5IC0+IGp1c3QgZm9yIGVuZHVzZXIgbG9va3lsb29reQogICAgZnVuY3Rpb24gc2VjVG9OZXh0TWluaW5nSW50ZXJ2YWwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzZWNUb05leHRJbnRlcmVzdFBheW91dCgpOwogICAgfQoKICAgIC8vIGludGVybmFsIChyZWFkIG9ubHkpOgogICAgLy8gdW5uZWNlc3NhcnkgLT4ganVzdCBmb3IgZW5kdXNlciBsb29reWxvb2t5CiAgICBmdW5jdGlvbiByZXF1aXJlZEJhbGFuY2VGb3JNYXN0ZXJub2RlSW5FdGhlcigpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyAxc3QgbWFzdGVybm9kZSA9IDEgZXRoZXIgcmVxdWlyZWQgdG8gZGVwb3NpdCBpbiBjb250cmFjdAogICAgICAgIC8vIDJuZCBtYXN0ZXJub2RlID0gNCBldGhlcgogICAgICAgIC8vIDNyZCBtYXN0ZXJub2RlID0gOSBldGhlcgogICAgICAgIC8vIDR0aCBtYXN0ZXJub2RlID0gMTYgZXRoZXIKICAgICAgICAvLyA1dGggbWFzdGVybm9kZSA9IDI1IGV0aGVyCiAgICAgICAgLy8gNnRoIG1hc3Rlcm5vZGUgPSAzNiBldGhlcgogICAgICAgIC8vIDIydGggICAgICAgICAgID0gNDg0IGV0aGVyCiAgICAgICAgcmV0dXJuIChtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzICsgMSkgKiogMjsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAocmVhZCBvbmx5KTogdXNlZCBpbiBtYXN0ZXJub2RlUmVnaXN0ZXIgYW5kIERlcmVnaXN0ZXIKICAgIGZ1bmN0aW9uIHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKDEgZXRoZXIpICogKG1hc3Rlcm5vZGUuYWN0aXZlTWFzdGVybm9kZXMgKyAxKSAqKiAyOwogICAgfQoKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IHNlbmQgRVRIIChyZXF1aXJlZEJhbGFuY2VGb3JNYXN0ZXJub2RlSW5FdGhlcikgdG8gY29udHJhY3QgdG8gYmVjb21lIGEgbWFzdGVybm9kZQogICAgZnVuY3Rpb24gbWFzdGVybm9kZVJlZ2lzdGVyKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIC8vIGdhczogMTA0JzAwMCAvIG1heDogMTQwawogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG1hc3Rlcm5vZGUuYWN0aXZlTWFzdGVybm9kZXMgPCBtYXN0ZXJub2RlLm1heE1hc3Rlcm5vZGVzQWxsb3dlZCk7ICAgICAgIC8vIG1heC4gbWFzdGVybm9kZXMgYWxsb3dlZAogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpICk7ICAgICAgICAgICAgICAgICAgICAgLy8gZXRoIGRlcG9zaXQKICAgICAgICByZXF1aXJlKF9nZXRNYXN0ZXJub2RlU2xvdChtc2cuc2VuZGVyKSA+PSBtYXhNYXN0ZXJub2Rlcyk7ICAgICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgb25lIG1hc3Rlcm5vZGUgcGVyIGFkZHJlc3MKCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKTsKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShtc2cuc2VuZGVyKTsgLy8gZG8gaW50ZXJlc3QgcGF5b3V0IGJlZm9yZSBjaGVja2luZyBiYWxhbmNlCiAgICAgICAgcmVxdWlyZShhY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBvZiAxMDBrIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCiAgICAgICAgLy93YXM6IHJlcXVpcmUoYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBvZiAxMDBrIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCgogICAgICAgIHVpbnQ4IHNsb3QgPSBfZmluZEVtcHR5TWFzdGVybm9kZVNsb3QoKTsKICAgICAgICByZXF1aXJlKHNsb3QgPCBtYXhNYXN0ZXJub2Rlcyk7IC8vIHNob3VsZCBuZXZlciB0cmlnZ2VyCgogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmFkZHIgPSBtc2cuc2VuZGVyOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmJhbGFuY2VXZWkgPSBtc2cudmFsdWU7CiAgICAgICAgbWFzdGVybm9kZXNbc2xvdF0uc2luY2VJbnRlcnZhbCA9IGludGVydmFsTm93KCk7CiAgICAgICAgbWFzdGVybm9kZXNbc2xvdF0ubGFzdE1pbmluZ0ludGVydmFsID0gaW50ZXJ2YWxOb3coKTsKCiAgICAgICAgbWFzdGVybm9kZS5hY3RpdmVNYXN0ZXJub2RlcysrOwoKICAgICAgICBtYXN0ZXJub2RlLm1pbkRlcG9zaXRSZXF1aXJlZEluRXRoZXI9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbkV0aGVyKCk7IC8vIGF0dG46IGZpcnN0IGluYyBhY3RpdmVNTgogICAgICAgIG1hc3Rlcm5vZGUubWluRGVwb3NpdFJlcXVpcmVkSW5XZWkgID0gcmVxdWlyZWRCYWxhbmNlRm9yTWFzdGVybm9kZUluV2VpKCk7IC8vIGF0dG46IGZpcnN0IGluYyBhY3RpdmVNTgoKICAgICAgICBtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSA9IG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpLmFkZChtc2cudmFsdWUpOyAgICAvLyB0aGlzIGJhbGFuY2UgY291bGQgbmV2ZXIgYmUgd2l0aGRyYXduIGJ5IGNvbnRyYWN0IGFkbWluCgogICAgICAgIE1hc3Rlcm5vZGVSZWdpc3RlcmVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8gcHVibGljIChjb21tYW5kKTogY2xvc2UgbWFzdGVybm9kZSBhbmQgc2VuZCBkZXBvc2l0ZWQgRVRIIGJhY2sgdG8gb3duZXIKICAgIGZ1bmN0aW9uIG1hc3Rlcm5vZGVEZXJlZ2lzdGVyKCkgcHVibGljIHByZXZlbnRSZWVudHJ5IHJldHVybnMgKGJvb2wgX3N1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzID4gMCk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSA+IDApOwogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpICsgdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjayk7CgogICAgICAgIHVpbnQ4IHNsb3QgPSBfZ2V0TWFzdGVybm9kZVNsb3QobXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShzbG90IDwgbWF4TWFzdGVybm9kZXMpOyAvLyBtYXN0ZXJub2RlIGZvdW5kIGluIGxpc3Q/CgogICAgICAgIHVpbnQyNTYgYmFsYW5jZVdlaSA9IG1hc3Rlcm5vZGVzW3Nsb3RdLmJhbGFuY2VXZWk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSA+PSBiYWxhbmNlV2VpKTsKCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKTsKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShtc2cuc2VuZGVyKTsgLy8gZG8gaW50ZXJlc3QgcGF5b3V0IGJlZm9yZSBjaGVja2luZyBiYWxhbmNlCgogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmFkZHIgPSBhZGRyZXNzKDApOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmJhbGFuY2VXZWkgPSAwOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLnNpbmNlSW50ZXJ2YWwgPSAwOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmxhc3RNaW5pbmdJbnRlcnZhbCA9IDA7CgogICAgICAgIG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpID0gbWFzdGVybm9kZS50b3RhbEJhbGFuY2VXZWkuc3ViKGJhbGFuY2VXZWkpOwoKICAgICAgICBtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzLS07CgogICAgICAgIG1hc3Rlcm5vZGUubWluRGVwb3NpdFJlcXVpcmVkSW5FdGhlciA9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbkV0aGVyKCk7IC8vIGF0dG46IGZpcnN0IGRlYyBhY3RpdmVNTgogICAgICAgIG1hc3Rlcm5vZGUubWluRGVwb3NpdFJlcXVpcmVkSW5XZWkgICA9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpOyAvLyBhdHRuOiBmaXJzdCBkZWMgYWN0aXZlTU4KCiAgICAgICAgLy9pZiAoIWFkZHIuc2VuZChiYWxhbmNlV2VpKSkgcmV2ZXJ0KCk7IC8vIHNlbmQgYmFjayBldGhlciB0byB3YWxsZXQgb2Ygc2VuZGVyCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiYWxhbmNlV2VpKTsgLy8gc2VuZCBiYWNrIGV0aGVyIHRvIHdhbGxldCBvZiBzZW5kZXIKCiAgICAgICAgTWFzdGVybm9kZURlcmVnaXN0ZXJlZChtc2cuc2VuZGVyLCBiYWxhbmNlV2VpKTsKICAgICAgICBfc3VjY2VzcyA9IHRydWU7CiAgICAgICAgfQoKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IGNsb3NlIG1hc3Rlcm5vZGUgYW5kIHNlbmQgZGVwb3NpdGVkIEVUSCBiYWNrIHRvIG93bmVyCiAgICBmdW5jdGlvbiBtYXN0ZXJub2RlTWluZVRva2VucygpIHB1YmxpYyB7CiAgICAgICAgLy8gZ2FzOiB1cCB0byAxMDUwMDAKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzID4gMCk7CgogICAgICAgIHVpbnQyNTYgX2lub3cgPSBpbnRlcnZhbE5vdygpOwogICAgICAgIHJlcXVpcmUoX2lub3cgPD0gaW50ZXJlc3RDb25maWcuc3RvcEF0SW50ZXJ2YWwpOyAvLyBtaW5pbmcgc3RvcHMgYWZ0ZXIgYXBwcm94LiA0IHllYXJzICg0OCBpbnRlcnZhbHMgYnkgMzAgZGF5cykKCiAgICAgICAgdWludDggc2xvdCA9IF9nZXRNYXN0ZXJub2RlU2xvdChtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHNsb3QgPCBtYXhNYXN0ZXJub2Rlcyk7IC8vIG1hc3Rlcm5vZGUgZm91bmQgaW4gbGlzdD8KICAgICAgICByZXF1aXJlKG1hc3Rlcm5vZGVzW3Nsb3RdLmxhc3RNaW5pbmdJbnRlcnZhbCA8IF9pbm93KTsgLy8gbWFzdGVybm9kZSBkaWQgbm90IGFscmVhZHkgbWluZSB0aGlzIGludGVydmFsPwoKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpOwogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKG1zZy5zZW5kZXIpOyAgIC8vIHNldCBuZXcgYmFsYW5jZSBpbmNsdWRpbmcgaW50ZXJlc3QKICAgICAgICByZXF1aXJlKGFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPj0gbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTgpOyAvLyByZXF1aXJlZCB0b2tlbiBiYWxhbmNlIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCiAgICAgICAgLy93YXM6IHJlcXVpcmUoYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBvZiAxMDBrIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCgogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmxhc3RNaW5pbmdJbnRlcnZhbCA9IF9pbm93OwoKICAgICAgICB1aW50MjU2IF9taW5lZFRva2VucyA9IG1pbmluZ1Jld2FyZEluU3VidG9rZW5zUmF3MWUxODsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPSBhY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlLmFkZChfbWluZWRUb2tlbnMpOwoKICAgICAgICAvLyBhdHRuLjogX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKSBtdXN0IGJlIGNhbGxlZCBmaXJzdCB0byBzZXQgbGFzdFBheW91dEludGVydmFsIGNvcnJlY3RseQogICAgICAgIF9zdXBwbHlUb3RhbCA9IF9zdXBwbHlUb3RhbC5hZGQoX21pbmVkVG9rZW5zKTsKICAgICAgICAvL19zdXBwbHlNaW5lZCA9IF9zdXBwbHlNaW5lZC5hZGQoX21pbmVkVG9rZW5zKTsKCiAgICAgICAgbWFzdGVybm9kZS50b3RhbFRva2Vuc01pbmVkUmF3MWUxOCA9IG1hc3Rlcm5vZGUudG90YWxUb2tlbnNNaW5lZFJhdzFlMTguYWRkKF9taW5lZFRva2Vucyk7CgogICAgICAgIE1hc3Rlcm5vZGVNaW5lZFRva2Vucyhtc2cuc2VuZGVyLCBfbWluZWRUb2tlbnMpOwogICAgfQoKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IG93bmVyIG9mIGEgbWFzdGVybm9kZSBjYW4gdHJhbnNmZXIgdGhlIG1uIChhbmQgdGhlIHZhbHVlIGluIEVUSCkgdG8gYW5vdGhlciB3YWxsZXQgYWRkcmVzcwogICAgZnVuY3Rpb24gbWFzdGVybm9kZVRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3QWRkcikgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1hc3Rlcm5vZGUuYWN0aXZlTWFzdGVybm9kZXMgPiAwKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShuZXdBZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3QWRkciAhPSBtc2cuc2VuZGVyKTsKCiAgICAgICAgdWludDggc2xvdCA9IF9nZXRNYXN0ZXJub2RlU2xvdChtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHNsb3QgPCBtYXhNYXN0ZXJub2Rlcyk7IC8vIG1hc3Rlcm5vZGUgZm91bmQgaW4gbGlzdD8gb25seSB0aGUgb3duZXIgb2YgYSBtYXN0ZXJub2RlIGNhbiB0cmFuc2ZlciBhIG1hc3Rlcm5vZGUgdG8gYSBuZXcgYWRkcmVzcwoKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpOwogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKG1zZy5zZW5kZXIpOyAvLyBkbyBpbnRlcmVzdCBwYXlvdXQgYmVmb3JlIG1vdmluZyBtYXN0ZXJub2RlCiAgICAgICAgcmVxdWlyZShhY2NvdW50c1tuZXdBZGRyXS5iYWxhbmNlID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBhdCBhZGRyIHRvIHJlZ2lzdGVyIGEgbWFzdGVybm9kZQogICAgICAgIC8vd2FzOiByZXF1aXJlKGJhbGFuY2VPZihuZXdBZGRyKSA+PSBtYXN0ZXJub2RlLm1pbkJhbGFuY2VSZXF1aXJlZEluU3VidG9rZW5zUmF3MWUxOCk7IC8vIHJlcXVpcmVkIHRva2VuIGJhbGFuY2UgYXQgYWRkciB0byByZWdpc3RlciBhIG1hc3Rlcm5vZGUKCiAgICAgICAgbWFzdGVybm9kZXNbc2xvdF0uYWRkciA9IG5ld0FkZHI7CgogICAgICAgIE1hc3Rlcm5vZGVUcmFuc2ZlcnJlZChtc2cuc2VuZGVyLCBuZXdBZGRyKTsKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGNoZWNrIGlmIGFkZHIgaXMgYSBtYXN0ZXJub2RlCiAgICBmdW5jdGlvbiBtYXN0ZXJub2RlSXNWYWxpZChhZGRyZXNzIGFkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChfZ2V0TWFzdGVybm9kZVNsb3QoYWRkcikgPCBtYXhNYXN0ZXJub2RlcykgJiYgKGJhbGFuY2VPZihhZGRyKSA+PSBtYXN0ZXJub2RlLm1pbkJhbGFuY2VSZXF1aXJlZEluU3VidG9rZW5zUmF3MWUxOCk7CiAgICB9CgogICAgLy8gaW50ZXJuYWwgKHJlYWQgb25seSk6CiAgICBmdW5jdGlvbiBfZ2V0TWFzdGVybm9kZVNsb3QoYWRkcmVzcyBhZGRyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50OCkgewogICAgICAgIHVpbnQ4IGlkeCA9IG1heE1hc3Rlcm5vZGVzOyAvLyBtYXN0ZXJub2RlLm1heE1hc3Rlcm5vZGVzQWxsb3dlZDsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgbWF4TWFzdGVybm9kZXM7IGkrKykgewogICAgICAgICAgICBpZiAobWFzdGVybm9kZXNbaV0uYWRkciA9PSBhZGRyKSB7IC8vIGlmIHNlbmRlciBpcyBhIHJlZ2lzdGVyZWQgbWFzdGVybm9kZQogICAgICAgICAgICAgICAgaWR4ID0gaTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBpZHg7IC8vIGlmIGlkeCA9PSBtYXhNYXN0ZXJub2RlcyAoMjIpIC0+IG5vIGVudHJ5IGZvdW5kOyB2YWxpZCBtYXN0ZXJub2RlIHNsb3RzOiAwIC4uIDIxCiAgICB9CgogICAgLy8gaW50ZXJuYWwgKHJlYWQgb25seSk6IGZhc3RlciB0aGFuIHB1c2ggLyBwb3Agb3BlcmF0aW9ucyBvbiBhcnJheXMKICAgIGZ1bmN0aW9uIF9maW5kRW1wdHlNYXN0ZXJub2RlU2xvdCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgdWludDggaWR4ID0gbWF4TWFzdGVybm9kZXM7IC8vIG1hc3Rlcm5vZGUubWF4TWFzdGVybm9kZXNBbGxvd2VkOwoKICAgICAgICBpZiAobWFzdGVybm9kZS5hY3RpdmVNYXN0ZXJub2RlcyA8IG1heE1hc3Rlcm5vZGVzKQogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBtYXhNYXN0ZXJub2RlczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChtYXN0ZXJub2Rlc1tpXS5hZGRyID09IGFkZHJlc3MoMCkgJiYgbWFzdGVybm9kZXNbaV0uc2luY2VJbnRlcnZhbCA9PSAwKSB7IC8vIGlmIHNsb3QgZW1wdHkKICAgICAgICAgICAgICAgIGlkeCA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaWR4OyAvLyBpZiBpZHggPT0gbWF4TWFzdGVybm9kZXMgLT4gbm8gZW50cnkgZm91bmQKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAoY29tbWFuZCk6CiAgICBmdW5jdGlvbiBfc2VuZEZlZXNUb01hc3Rlcm5vZGVzKHVpbnQyNTYgX2ZlZSkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgX3Bvb2wgPSBtYXN0ZXJub2RlLnJld2FyZFBvb2w7CiAgICAgICAgaWYgKF9mZWUgKyBfcG9vbCA+IDAgJiYgbWFzdGVybm9kZS5hY3RpdmVNYXN0ZXJub2RlcyA+IDApIHsgLy8gaWYgbWluLiAxIG1hc3Rlcm5vZGUgZXhpc3RzCiAgICAgICAgICAgIG1hc3Rlcm5vZGUucmV3YXJkUG9vbCA9IDA7CiAgICAgICAgICAgIHVpbnQyNTYgcGFydCA9IChfZmVlICsgX3Bvb2wpIC8gbWFzdGVybm9kZS5hY3RpdmVNYXN0ZXJub2RlczsKICAgICAgICAgICAgdWludDI1NiBzdW0gPSAwOwogICAgICAgICAgICBhZGRyZXNzIGFkZHI7CiAgICAgICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBtYXhNYXN0ZXJub2RlczsgaSsrKSB7CiAgICAgICAgICAgICAgICBhZGRyID0gbWFzdGVybm9kZXNbaV0uYWRkcjsKICAgICAgICAgICAgICAgIGlmIChhZGRyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50c1thZGRyXS5iYWxhbmNlID0gKGFjY291bnRzW2FkZHJdLmJhbGFuY2UpLmFkZChwYXJ0KTsgLy8gc2VuZCBmZWUgYXMgcmV3YXJkCiAgICAgICAgICAgICAgICAgICAgc3VtICs9IHBhcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN1bSA8IHBhcnQpIG1hc3Rlcm5vZGUucmV3YXJkUG9vbCA9IHBhcnQgLSBzdW07IC8vIGRvIG5vdCBsb29zZSBpbnRlZ2VyLWRpdi1yb3VuZGluZ3MKICAgICAgICAgICAgbWFzdGVybm9kZS5yZXdhcmRzUGF5ZWRUb3RhbCArPSBzdW07CiAgICAgICAgICAgIE1hc3Rlcm5vZGVSZXdhcmRTZW5kKHN1bSk7CiAgICAgICAgfSBlbHNlIHsgLy8gbm8gbWFzdGVybm9kZXMgLT4gY29sbGVjdCBmZWVzIGZvciB0aGUgZmlyc3QgbWFzdGVybm9kZSByZWdpc3RlcmluZwogICAgICAgICAgICBtYXN0ZXJub2RlLnJld2FyZFBvb2wgPSBtYXN0ZXJub2RlLnJld2FyZFBvb2wuYWRkKF9mZWUpOwogICAgICAgICAgICBNYXN0ZXJub2RlUmV3YXJkQWRkZWRUb1Jld2FyZFBvb2woX2ZlZSk7CiAgICAgICAgfQogICAgfQoKCgogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICAvLyArCiAgICAvLyArIHRva2Vuc2FsZSBzdHVmZgogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICBldmVudCBUb2tlbnNQdXJjaGFzZWQoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBUb2tlblNhbGVGaW5pc2hlZCgpOwogICAgZXZlbnQgVG9rZW5TYWxlQ2xvc2VkKCk7CiAgICBldmVudCBUb2tlblNhbGVPcGVuZWQoKTsKICAgIGV2ZW50IFRva2VuU2FsZVBhdXNlZChib29sIHBhdXNlZCk7CgogICAgLy8gcHVibGljIChjb21tYW5kKTogZmFsbGJhY2sgZnVuY3Rpb24gLSBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zIChhdHRuLjogY2FuIGZhaWwgc2lsZW50bHkgaWYgbm90IGVub3VnaCBnYXMgaXMgcHJvdmlkZWQpCiAgICAvKiBkZWFjdGl2YXRlZCBmb3IgdXNlci1zYWZldHkgKi8KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHsKICAgICAgICAvLyBnYXMgdXNlZDogMTcwMDAwIHRvIDI1MTM3MSBnYXNsaW1pdDogcHJvdmlkZSA1MDAwMDAgb3IgbW9yZSEhIQogICAgICAgIF9idXlUb2tlbnMobXNnLnNlbmRlciwgdHJ1ZSk7IC8vIHRyaWdnZXJzIGZhaWxzYWZlIC0+IG5vIGRpcmVjdCB0cmFuc2ZlciB0byBjb250cmFjdC1vd25lciB3YWxsZXQgdG8gc2FmZSBnYXMKICAgIH0KICAgIC8qICovCiAgICAKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IG9mZmljaWFsIGZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMgZHVyaW5nIHRva2Vuc2FsZQogICAgZnVuY3Rpb24gdG9rZW5zYWxlQnV5VG9rZW5zKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIF9idXlUb2tlbnMobXNnLnNlbmRlciwgZmFsc2UpOyAvLyBkaXJlY3QgdHJhbnNmZXIgdG8gY29udHJhY3Qtb3duZXIKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGNhbGMgdGhlIGFjdGl2ZSBzYWxlIHN0YWdlIGFzIGEgZnVuY3Rpb24gb2YgYWxyZWFkeSBzZWxsZWQgYW1vdW50CiAgICBmdW5jdGlvbiB0b2tlbnNhbGVTdGFnZU5vdygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc2FsZVN0YWdlQXQodG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4KTsKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGNhbGMgdGhlIGFjdGl2ZSBzYWxlIHN0YWdlIGFzIGEgZnVuY3Rpb24gb2YgYW55IGFtb3VudAogICAgZnVuY3Rpb24gdG9rZW5zYWxlU3RhZ2VBdCh1aW50MjU2IF90b2tlbnNkaXN0aWJ1dGVkUkFXMWUxOCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfdG9rZW5zZGlzdGlidXRlZFJBVzFlMTggLyAoMTAwMDAwMCAqIFRPS0VOX01VTFRJUExJRVIpOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogY2FsYyB0aGUgYWN0aXZlIGV4Y2hhbmdlIGZhY3RvciAodG9rZW5zIHBlciBFVEgpIGFzIGEgZnVuY3Rpb24gb2YgYWxyZWFkeSBzZWxsZWQgYW1vdW50CiAgICBmdW5jdGlvbiB0b2tlbnNhbGVUb2tlbnNQZXJFdGhlck5vdygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF90b2tlbnNhbGVUb2tlbnNQZXJFdGhlcih0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTgpOwogICAgfQoKICAgIC8qCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGNhbGMgdGhlIGFjdGl2ZSBleGNoYW5nZSBmYWN0b3IgKHRva2VucyBwZXIgRVRIKSBhcyBhIGZ1bmN0aW9uIG9mIGFueSBhbW91bnQKICAgIGZ1bmN0aW9uIHRva2Vuc2FsZVRva2Vuc1BlckV0aGVyQXRBbW91bnQodWludDI1NiBfdG9rZW5zZGlzdGlidXRlZFJBVzFlMTgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF90b2tlbnNhbGVUb2tlbnNQZXJFdGhlcihfdG9rZW5zZGlzdGlidXRlZFJBVzFlMTgpOwogICAgfQogICAgKi8KICAgIC8qCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGNhbGMgdGhlIGFjdGl2ZSBleGNoYW5nZSBmYWN0b3IgKHRva2VucyBwZXIgRVRIKSBhcyBhIGZ1bmN0aW9uIG9mIGFueSBzdGFnZQogICAgZnVuY3Rpb24gdG9rZW5zYWxlVG9rZW5zUGVyRXRoZXJBdFN0YWdlKHVpbnQyNTYgX3N0YWdlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfdG9rZW5zYWxlVG9rZW5zUGVyRXRoZXIoX3N0YWdlICogMTAwMDAwMCAqIFRPS0VOX01VTFRJUExJRVIpOwogICAgfQogICAgKi8KCiAgICAvLyBpbnRlcm5hbCAocmVhZCBvbmx5KTogY2FsY3VsYXRlIGN1cnJlbnQgZXhjaGFuZ2UgcmF0ZSAtPiBldGhlciBwYXllZCAqIGZhY3RvciA9IHRva2VucyBkaXN0cmlidXRlZAogICAgZnVuY3Rpb24gX3Rva2Vuc2FsZVRva2Vuc1BlckV0aGVyKHVpbnQyNTYgX3Rva2Vuc2Rpc3RpYnV0ZWQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGZhY3RvciA9IHRva2Vuc2FsZUZhY3Rvclt0b2tlbnNhbGVTdGFnZUF0KF90b2tlbnNkaXN0aWJ1dGVkKSAlIDIwXTsgLy8gJSAyMCA9PSBwcmV2ZW50IGFycmF5IG92ZXJmbG93IG9uIHVuZXhwZWN0ZWQgZXJyb3IKICAgICAgICByZXR1cm4gZmFjdG9yICogKCAoZGVidWcpID8gREVCVUdfU0FMRUZBQ1RPUiA6IFBST0RVQ1RJT05fU0FMRUZBQ1RPUiApOyAvLyBkZWJ1ZyBvbmx5IHN0dWZmCgogICAgICAgIC8vIHRvdGFsIHRva2VuczogMjAgTWlvCiAgICAgICAgLy8gdG90YWwgRVRIIHRvIGJ1eSBhbGwgdG9rZW5zOiBhcHByb3guIDQ0NDAwIEVUSCAoNDQ0IGluIGRlYnVnIG1vZGUpCiAgICAgICAgLyoKICAgICAgICBzdGFnZSB0b2tlbnMgICB0b2tlbnMgICAgIGV0aGVyICAgICAxIHRva2VuICAgICAgdXNkIHBlciBzdGFnZSAgICAgICAgICAgICAgICAgIDEgdG9rZW4KICAgICAgICAgICAgcGVyIHN0YWdlIHBlciBldGhlcglwZXIgc3RhZ2UJaW4gZXRoZXIJICgzMDAgdXNkL0VUSCkJc3VtIHVzZAkgICAgICAgIGluIHVzZAogICAgICAgIDEJMScwMDAnMDAwCTInMDAwCSAgNTAwLjAwCTAuMDAwNTAwMDAJICAxNTAnMDAwLjAwCSAgMTUwJzAwMC4wMAkwLjE1MDAKICAgICAgICAyCTEnMDAwJzAwMAkxJzAwMAkxJzAwMC4wMAkwLjAwMTAwMDAwCSAgMzAwJzAwMC4wMAkgIDQ1MCcwMDAuMDAJMC4zMDAwCiAgICAgICAgMwkxJzAwMCcwMDAJICA4MDAJMScyNTAuMDAJMC4wMDEyNTAwMAkgIDM3NScwMDAuMDAJICA4MjUnMDAwLjAwCTAuMzc1MAogICAgICAgIDQJMScwMDAnMDAwCSAgNTAwCTInMDAwLjAwCTAuMDAyMDAwMDAJICA2MDAnMDAwLjAwCTEnNDI1JzAwMC4wMAkwLjYwMDAKICAgICAgICA1CTEnMDAwJzAwMAkgIDUwMAkyJzAwMC4wMAkwLjAwMjAwMDAwCSAgNjAwJzAwMC4wMAkyJzAyNScwMDAuMDAJMC42MDAwCiAgICAgICAgNgkxJzAwMCcwMDAJICA1MDAJMicwMDAuMDAJMC4wMDIwMDAwMAkgIDYwMCcwMDAuMDAJMic2MjUnMDAwLjAwCTAuNjAwMAogICAgICAgIDcJMScwMDAnMDAwCSAgNTAwCTInMDAwLjAwCTAuMDAyMDAwMDAJICA2MDAnMDAwLjAwCTMnMjI1JzAwMC4wMAkwLjYwMDAKICAgICAgICA4CTEnMDAwJzAwMAkgIDUwMAkyJzAwMC4wMAkwLjAwMjAwMDAwCSAgNjAwJzAwMC4wMAkzJzgyNScwMDAuMDAJMC42MDAwCiAgICAgICAgOQkxJzAwMCcwMDAJICA1MDAJMicwMDAuMDAJMC4wMDIwMDAwMAkgIDYwMCcwMDAuMDAJNCc0MjUnMDAwLjAwCTAuNjAwMAogICAgICAgIDEwCTEnMDAwJzAwMAkgIDQwMAkyJzUwMC4wMAkwLjAwMjUwMDAwCSAgNzUwJzAwMC4wMAk1JzE3NScwMDAuMDAJMC43NTAwCiAgICAgICAgMTEJMScwMDAnMDAwCSAgNDAwCTInNTAwLjAwCTAuMDAyNTAwMDAJICA3NTAnMDAwLjAwCTUnOTI1JzAwMC4wMAkwLjc1MDAKICAgICAgICAxMgkxJzAwMCcwMDAJICA0MDAJMic1MDAuMDAJMC4wMDI1MDAwMAkgIDc1MCcwMDAuMDAJNic2NzUnMDAwLjAwCTAuNzUwMAogICAgICAgIDEzCTEnMDAwJzAwMAkgIDIwMAk1JzAwMC4wMAkwLjAwNTAwMDAwCTEnNTAwJzAwMC4wMAk4JzE3NScwMDAuMDAJMS41MDAwCiAgICAgICAgMTQJMScwMDAnMDAwCSAgMjAwCTUnMDAwLjAwCTAuMDA1MDAwMDAJMSc1MDAnMDAwLjAwCTknNjc1JzAwMC4wMAkxLjUwMDAKICAgICAgICAxNQkxJzAwMCcwMDAJICAyMDAJNScwMDAuMDAJMC4wMDUwMDAwMAkxJzUwMCcwMDAuMDAJMTEnMTc1JzAwMC4wMAkxLjUwMDAKICAgICAgICAxNgkxJzAwMCcwMDAJICA0MDAJMic1MDAuMDAJMC4wMDI1MDAwMAkgIDc1MCcwMDAuMDAJMTEnOTI1JzAwMC4wMAkwLjc1MDAKICAgICAgICAxNwkxJzAwMCcwMDAJICA1MDAJMicwMDAuMDAJMC4wMDIwMDAwMAkgIDYwMCcwMDAuMDAJMTInNTI1JzAwMC4wMAkwLjYwMDAKICAgICAgICAxOAkxJzAwMCcwMDAJICA4MDAJMScyNTAuMDAJMC4wMDEyNTAwMAkgIDM3NScwMDAuMDAJMTInOTAwJzAwMC4wMAkwLjM3NTAKICAgICAgICAxOQkxJzAwMCcwMDAJMScwMDAJMScwMDAuMDAJMC4wMDEwMDAwMAkgIDMwMCcwMDAuMDAJMTMnMjAwJzAwMC4wMAkwLjMwMDAKICAgICAgICAyMAkxJzAwMCcwMDAJMic1MDAJICA0MDAuMDAJMC4wMDA0MDAwMAkgIDEyMCcwMDAuMDAJMTMnMzIwJzAwMC4wMAkwLjEyMDAKICAgICAgICAgICAyMCcwMDAnMDAwCSAgICAgICA0NCc0MDAuMDAgRVRICSAgICAgICAxMyczMjAnMDAwLjAwCSAgICAgIGF2ZXJhZ2U6CTAuNjcwMAoJICAgICovCiAgICB9CgogICAgLy8gaW50ZXJuYWw6IHRva2VuIHB1cmNoYXNlIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBfYnV5VG9rZW5zKGFkZHJlc3MgYWRkciwgYm9vbCBmYWlsc2FmZSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHRva2Vuc2FsZS5taW5QYXltZW50UmVxdWlyZWRVbml0V2VpKTsgLy8gbWluLiBwYXltZW50IHJlcXVpcmVkCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPD0gdG9rZW5zYWxlLm1heFBheW1lbnRBbGxvd2VkVW5pdFdlaSk7IC8vIG1heC4gcGF5bWVudCBhbGxvd2VkCiAgICAgICAgcmVxdWlyZSh0b2tlbnNhbGVTdGFydGVkKCkgJiYgIXRva2Vuc2FsZUZpbmlzaGVkKCkgJiYgIXRva2Vuc2FsZVBhdXNlZCgpKTsKCiAgICAgICAgdWludDI1NiBhbW91bnRUb2tlbnM7CiAgICAgICAgdWludDI1NiBhY3RFeGNoYW5nZVJhdGUgPSBfdG9rZW5zYWxlVG9rZW5zUGVyRXRoZXIodG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4KTsKICAgICAgICB1aW50MjU2IGFtb3VudFRva2Vuc1RvQnV5QXRUaGlzUmF0ZSA9IG1zZy52YWx1ZSAqIGFjdEV4Y2hhbmdlUmF0ZTsKICAgICAgICB1aW50MjU2IGF2YWlsYWJsZUF0VGhpc1JhdGUgPSAoMTAwMDAwMCAqIFRPS0VOX01VTFRJUExJRVIpIC0gKCh0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTgpICUgKDEwMDAwMDAgKiBUT0tFTl9NVUxUSVBMSUVSKSk7CgogICAgICAgIGlmIChhbW91bnRUb2tlbnNUb0J1eUF0VGhpc1JhdGUgPD0gYXZhaWxhYmxlQXRUaGlzUmF0ZSkgeyAvLyB3ZWkgZml0cyBpbiB0aGlzIGV4Y2hhbmdlcmF0ZS1zdGFnZQogICAgICAgICAgICBhbW91bnRUb2tlbnMgPSBhbW91bnRUb2tlbnNUb0J1eUF0VGhpc1JhdGU7CiAgICAgICAgfSBlbHNlIHsgLy8gb24gYm9yZGVyIGNyb3NzaW5nIChubyBtb3JlIHRoYW4gMSBib3JkZXIgY3Jvc3NpbmcgcG9zc2libGUsIGJlY2F1c2Ugb2YgbWF4LiBidXkgbGltaXQgb2YgMTAwIEVUSCA9IDEwMCAqIDUwMDAgPSAwLjUgbWlvKQogICAgICAgICAgICBhbW91bnRUb2tlbnMgPSBhdmFpbGFibGVBdFRoaXNSYXRlOwogICAgICAgICAgICAvL3VpbnQyNTYgbmV4dEV4Y2hhbmdlUmF0ZSA9IF90b2tlbnNhbGVUb2tlbnNQZXJFdGhlcih0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggKyBhbW91bnRUb2tlbnMpOwogICAgICAgICAgICAvL3VpbnQyNTYgYW1vdW50VG9rZW5zVG9CdXlBdE5leHRSYXRlID0gKG1zZy52YWx1ZSAtIGF2YWlsYWJsZUF0VGhpc1JhdGUgLyBhY3RFeGNoYW5nZVJhdGUpICogbmV4dEV4Y2hhbmdlUmF0ZTsKCiAgICAgICAgICAgIGFtb3VudFRva2VucyArPSAobXNnLnZhbHVlIC0gYXZhaWxhYmxlQXRUaGlzUmF0ZSAvIGFjdEV4Y2hhbmdlUmF0ZSkgKiBfdG9rZW5zYWxlVG9rZW5zUGVyRXRoZXIodG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4ICsgYW1vdW50VG9rZW5zKTsgLy9hbW91bnRUb2tlbnNUb0J1eUF0TmV4dFJhdGU7CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGFtb3VudFRva2VucyA+IDApOwogICAgICAgIHJlcXVpcmUodG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4LmFkZChhbW91bnRUb2tlbnMpIDw9IHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlSQVcxZTE4KTsgLy8gY2hlY2sgbGltaXQKCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKTsKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShjb250cmFjdE93bmVyKTsgLy8gZG8gaW50ZXJlc3QgcGF5b3V0IGJlZm9yZSBjaGFuZ2luZyBiYWxhbmNlcwogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKGFkZHIpOyAvLyBkbyBpbnRlcmVzdCBwYXlvdXQgYmVmb3JlIGNoYW5naW5nIGJhbGFuY2VzCgogICAgICAgIHRva2Vuc2FsZS50b3RhbFdlaVJhaXNlZCA9IHRva2Vuc2FsZS50b3RhbFdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKTsKICAgICAgICBpZiAoIXNlbmRGdW5kc1RvV2FsbGV0IHx8IGZhaWxzYWZlKSB0b2tlbnNhbGUudG90YWxXZWlJbkZhbGxiYWNrID0gdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjay5hZGQobXNnLnZhbHVlKTsKCiAgICAgICAgdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4ID0gdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4LmFkZChhbW91bnRUb2tlbnMpOwogICAgICAgIHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkQW1vdW50ID0gdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4IC8gVE9LRU5fTVVMVElQTElFUjsKICAgICAgICB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZEZyYWN0aW9uID0gdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4ICUgVE9LRU5fTVVMVElQTElFUjsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGFjY291bnRzW2NvbnRyYWN0T3duZXJdLmJhbGFuY2UgPSBhY2NvdW50c1tjb250cmFjdE93bmVyXS5iYWxhbmNlLnN1YihhbW91bnRUb2tlbnMpOwogICAgICAgIGFjY291bnRzW2FkZHJdLmJhbGFuY2UgPSBhY2NvdW50c1thZGRyXS5iYWxhbmNlLmFkZChhbW91bnRUb2tlbnMpOwoKCiAgICAgICAgLyogZGVidWcgb25seSAqLwogICAgICAgIGlmIChkZWJ1ZykgewogICAgICAgICAgICAvLyB1cGRhdGUgbGlzdCBvZiBhbGwgY29udHJpYnV0b3JzCiAgICAgICAgICAgIENvbnRyaWJ1dG9yIG1lbW9yeSBuZXdjb250OwogICAgICAgICAgICBuZXdjb250LmFkZHIgPSBhZGRyOwogICAgICAgICAgICBuZXdjb250LmFtb3VudFdlaSA9IG1zZy52YWx1ZTsKICAgICAgICAgICAgbmV3Y29udC5hbW91bnRUb2tlbnNVbml0MWUxOCA9IGFtb3VudFRva2VuczsKICAgICAgICAgICAgbmV3Y29udC5zaW5jZUludGVydmFsID0gaW50ZXJ2YWxOb3coKTsKICAgICAgICAgICAgdG9rZW5zYWxlQ29udHJpYnV0b3JzLnB1c2goIG5ld2NvbnQgKTsKICAgICAgICB9CiAgICAgICAgLyogKi8KCiAgICAgICAgLy8gc2VuZCB0b2tlbnMgdG8gd2FsbGV0IG9mIHNlbmRlciBmcm9tIGV0aGVyCiAgICAgICAgaWYgKHNlbmRGdW5kc1RvV2FsbGV0ICYmICFmYWlsc2FmZSkgYWRtaW5XYWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsgLy8gcmVxLiBtb3JlIGdhcwoKICAgICAgICBUb2tlbnNQdXJjaGFzZWQoY29udHJhY3RPd25lciwgYWRkciwgbXNnLnZhbHVlLCBhbW91bnRUb2tlbnMpOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogdW5peHRpbWUgdG8gbmV4dCBpbnRlcmVzdCBwYXlvdXQKICAgIGZ1bmN0aW9uIHRva2Vuc2FsZVNlY29uZHNUb1N0YXJ0KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvL3VpbnQyNTYgdGltZXN0YW1wID0gX2dldFRpbWVzdGFtcCgpOwogICAgICAgIHJldHVybiAodG9rZW5zYWxlLnN0YXJ0QXRUaW1lc3RhbXAgPD0gX2dldFRpbWVzdGFtcCgpKSA/IDAgOiB0b2tlbnNhbGUuc3RhcnRBdFRpbWVzdGFtcCAtIF9nZXRUaW1lc3RhbXAoKTsKICAgIH0KCgogICAgLy8gQHJldHVybiB0cnVlIGlmIHRva2Vuc2FsZSBoYXMgc3RhcnRlZAogICAgZnVuY3Rpb24gdG9rZW5zYWxlU3RhcnRlZCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gX2dldFRpbWVzdGFtcCgpID49IHRva2Vuc2FsZS5zdGFydEF0VGltZXN0YW1wOwogICAgfQoKICAgIC8vIEByZXR1cm4gdHJ1ZSBpZiB0b2tlbnNhbGUgZW5kZWQKICAgIGZ1bmN0aW9uIHRva2Vuc2FsZUZpbmlzaGVkKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAodG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRSQVcxZTE4ID49IHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlSQVcxZTE4IHx8IHRva2Vuc2FsZS50b2tlblNhbGVDbG9zZWQpOwogICAgfQoKICAgIC8vIEByZXR1cm4gdHJ1ZSBpZiB0b2tlbnNhbGUgaXMgcGF1c2VkCiAgICBmdW5jdGlvbiB0b2tlbnNhbGVQYXVzZWQoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc2FsZS50b2tlblNhbGVQYXVzZWQ7CiAgICB9CgoKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgLy8gKwogICAgLy8gKyBhZG1pbiBvbmx5IHN0dWZmCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIGV2ZW50IEFkbWluVHJhbnNmZXJyZWRPd25lcnNoaXAoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CiAgICBldmVudCBBZG1pbkNoYW5nZWRGdW5kaW5nV2FsbGV0KGFkZHJlc3Mgb2xkQWRkciwgYWRkcmVzcyBuZXdBZGRyKTsKCiAgICAvLyBwdWJsaWMgKGFkbWluIG9ubHkpOiBjb250YWN0IGNvbnRyb2wgZnVuY3Rpb25zOyBjb250cmFjdCBjcmVhdG9yIG9ubHk7IGFsbCBpbiBvbmUKICAgIGZ1bmN0aW9uIGFkbWluQ29tbWFuZCh1aW50OCBjb21tYW5kLCBhZGRyZXNzIGFkZHIsIHVpbnQyNTYgZmVlKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGNvbW1hbmQgPj0gMCAmJiBjb21tYW5kIDw9IDI1NSk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMSkgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLlNlbmRBbGxGYWlsc2FmZUV0aGVyVG9BZG1pbldhbGxldAogICAgICAgICAgICAvLyBjb250cmFjdCBzdG9yZXMgRVRIOgogICAgICAgICAgICAvLyAtIG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpID09IG5ldmVyIHdpdGhkcmF3YWJsZSBieSBjb250cmFjdCBvd25lciAob25seSBieSBlYWNoIE1OIG93bmVyKQogICAgICAgICAgICAvLyAtIHRva2Vuc2FsZS50b3RhbFdlaUluRmFsbGJhY2sKICAgICAgICAgICAgLy8gLSBtYXliZTogbG9ja2VkIGV0aGVyIGJ5IHVuZm9yc2VlbiBlcnJvcnMKCiAgICAgICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHRva2Vuc2FsZS50b3RhbFdlaUluRmFsbGJhY2spOwoKICAgICAgICAgICAgdWludDI1NiBfd2l0aGRyYXdCYWxhbmNlID0gdGhpcy5iYWxhbmNlLnN1YihtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSk7CiAgICAgICAgICAgIHJlcXVpcmUoX3dpdGhkcmF3QmFsYW5jZSA+IDApOwoKICAgICAgICAgICAgYWRtaW5XYWxsZXQudHJhbnNmZXIoX3dpdGhkcmF3QmFsYW5jZSk7CiAgICAgICAgICAgIHRva2Vuc2FsZS50b3RhbFdlaUluRmFsbGJhY2sgPSAwOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTUpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5SZWNhbGN1bGF0ZVRvdGFsU3VwcGx5CiAgICAgICAgICAgIC8vIHNwZWVkIHVwIHJlYWx0aW1lIHJlcXVlc3QgdG8gYmFsYW5jZSBmdW5jdGlvbnMgYnkgcGVyaW9kaWMgY2FsbCB0aGlzIGdhcyBjb3N0IG9wZXJhdGlvbgogICAgICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpOwogICAgICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShjb250cmFjdE93bmVyKTsgLy8gZG8gaW50ZXJlc3QgcGF5b3V0IGJlZm9yZSBjaGFuZ2luZyBiYWxhbmNlcwogICAgICAgIH0gZWxzZQoKICAgICAgICBpZiAoY29tbWFuZCA9PSAyMikgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLmNoYW5nZVRyYW5zYWN0aW9uRmVlKSB7CiAgICAgICAgICAgIHJlcXVpcmUoZmVlID49IDAgJiYgZmVlIDw9ICg5OTk5ICogVE9LRU5fTVVMVElQTElFUikgJiYgZmVlICE9IG1hc3Rlcm5vZGUudHJhbnNhY3Rpb25SZXdhcmRJblN1YnRva2Vuc1JhdzFlMTgpOwogICAgICAgICAgICBtYXN0ZXJub2RlLnRyYW5zYWN0aW9uUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4ID0gZmVlOwoKICAgICAgICAgICAgVHJhbnNhY3Rpb25GZWVDaGFuZ2VkKGZlZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChjb21tYW5kID09IDMzKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuQ2hhbmdlTWluZXJSZXdhcmQpIHsKICAgICAgICAgICAgcmVxdWlyZShmZWUgPj0gMCAmJiBmZWUgPD0gKDk5OTk5OSkgJiYgZmVlICE9IG1hc3Rlcm5vZGUubWluaW5nUmV3YXJkSW5Ub2tlbnMpOwoKICAgICAgICAgICAgbWFzdGVybm9kZS5taW5pbmdSZXdhcmRJblRva2VucyA9IGZlZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA1MCcwMDAgdG9rZW5zIHRvIG1pbmUgcGVyIG1hc3Rlcm5vZGUgcGVyIGludGVydmFsCiAgICAgICAgICAgIG1pbmluZ1Jld2FyZEluU3VidG9rZW5zUmF3MWUxOCA9IGZlZSAqIFRPS0VOX01VTFRJUExJRVI7IC8vIHVzZWQgZm9yIGludGVybmFsIGludGVnZXIgY2FsY3VsYXRpb24KCiAgICAgICAgICAgIE1pbmVyUmV3YXJkQ2hhbmdlZChmZWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTExKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuQ2xvc2VUb2tlbnNhbGUpIHsKICAgICAgICAgICAgdG9rZW5zYWxlLnRva2VuU2FsZUNsb3NlZCA9IHRydWU7CgogICAgICAgICAgICBUb2tlblNhbGVDbG9zZWQoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTEyKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuT3BlblRva2Vuc2FsZSkgewogICAgICAgICAgICB0b2tlbnNhbGUudG9rZW5TYWxlQ2xvc2VkID0gZmFsc2U7CgogICAgICAgICAgICBUb2tlblNhbGVPcGVuZWQoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTEzKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuUGF1c2VUb2tlbnNhbGUpIHsKICAgICAgICAgICAgdG9rZW5zYWxlLnRva2VuU2FsZVBhdXNlZCA9IHRydWU7CgogICAgICAgICAgICBUb2tlblNhbGVQYXVzZWQodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChjb21tYW5kID09IDExNCkgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLlVucGF1c2VUb2tlbnNhbGUpIHsKICAgICAgICAgICAgdG9rZW5zYWxlLnRva2VuU2FsZVBhdXNlZCA9IGZhbHNlOwoKICAgICAgICAgICAgVG9rZW5TYWxlUGF1c2VkKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCgogICAgICAgIGlmIChjb21tYW5kID09IDE1MCkgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLlRyYW5zZmVyT3duZXJzaGlwKSB7CiAgICAgICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IGNvbnRyYWN0T3duZXI7CiAgICAgICAgICAgIGNvbnRyYWN0T3duZXIgPSBhZGRyOwoKICAgICAgICAgICAgQWRtaW5UcmFuc2ZlcnJlZE93bmVyc2hpcChvbGRPd25lciwgYWRkcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChjb21tYW5kID09IDE1MikgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLkNoYW5nZUFkbWluV2FsbGV0KSB7CiAgICAgICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkbWluV2FsbGV0KTsKICAgICAgICAgICAgYWRkcmVzcyBvbGRBZGRyID0gYWRtaW5XYWxsZXQ7CiAgICAgICAgICAgIGFkbWluV2FsbGV0ID0gYWRkcjsKCiAgICAgICAgICAgIEFkbWluQ2hhbmdlZEZ1bmRpbmdXYWxsZXQob2xkQWRkciwgYWRkcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQoKICAgICAgICBpZiAoY29tbWFuZCA9PSAyMjUpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5TZWxmRGVzdHVjdCkgeyAvLyBlbmFibGVkIGR1cmluZyBkZWJ1ZyBvbmx5IQogICAgICAgICAgICByZXF1aXJlKGRlYnVnIHx8IFBST0RVQ1RJT05fU1RBUlQ+X2dldFRpbWVzdGFtcCgpKTsgLy8gb25seSBhbGxvd2VkIGluIGRlYnVnZ2luZyBtb2RlID0gZHVyaW5nIGRldmVsb3BtZW50IGFuZCBpbiBwcm9kdWN0aW9uIG1vZGUgYmVmb3JlIHNhbGUgc3RhcnRzCgogICAgICAgICAgICBEZWJ1Z1ZhbHVlKCJkZWJ1Zzogc3VpY2lkZSIsIHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHNlbGZkZXN0cnVjdChjb250cmFjdE93bmVyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIC8qZWxzZQoKICAgICAgICBpZiAoY29tbWFuZCA9PSAyMzYpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5TZW5kQWxsRXRoZXIpIHsgLy8gZW5hYmxlZCBkdXJpbmcgZGVidWcgb25seSEKICAgICAgICAgICAgcmVxdWlyZShkZWJ1Zyk7IC8vIG9ubHkgYWxsb3dlZCBpbiBkZWJ1Z2dpbmcgbW9kZSA9IGR1cmluZyBkZXZlbG9wbWVudAoKICAgICAgICAgICAgRGVidWdWYWx1ZSgiZGVidWc6IHNlbmQgYWxsIGV0aGVyIHRvIGFkbWluIiwgdGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgY29udHJhY3RPd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoY29tbWFuZCA9PSAyNDcpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5EaXNhYmxlRGVidWdNb2RlKSB7IC8vIHJlLWVuYWJsaW5nIGlzIGltcG9zc2libGUKICAgICAgICAgICAgcmVxdWlyZShkZWJ1Zyk7IC8vIG9ubHkgYWxsb3dlZCBpbiBkZWJ1Z2dpbmcgbW9kZSA9IGR1cmluZyBkZXZlbG9wbWVudAoKICAgICAgICAgICAgRGVidWdWYWx1ZSgiZGVidWc6IGRlYnVnIG1vZGUgZGlzYWJsZWQgLSB1bnJldmVyYWJsZSBvcGVyYXRpb24iLCB0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICBkZWJ1ZyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9Ki8KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb250cmFjdE93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRUaW1lc3RhbXAoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsgLy8gYWxpYXMgZm9yIGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICAvLyBldGgtbWluZXIgbWFuaXB1bGF0aW9uIG9mIHRpbWVzdGFtcCAocG9zc2libGUgaW4gYSByYW5nZSB1cCB0byA5MDAgc2Vjb25kcykgaXMgYWNjZXB0YWJsZSBiZWNhdXNlIGludGVydmFsLWZ1bmN0aW9ucyBhcmUgaW4gYSByYW5nZSBmcm9tIDcgdG8gMzAgZGF5cy4KICAgIH0KCiAgICBmdW5jdGlvbiBfYWRkVGltZSh1aW50MjU2IF9zZWMpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfc2VjICogKDEgc2Vjb25kcyk7IC8vIGluIHVuaXR0aW1lCiAgICB9Cn0='.
	

]
