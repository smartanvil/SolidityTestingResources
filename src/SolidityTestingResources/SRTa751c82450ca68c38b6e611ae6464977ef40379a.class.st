Class {
	#name : #SRTa751c82450ca68c38b6e611ae6464977ef40379a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa751c82450ca68c38b6e611ae6464977ef40379a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKCgoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKCgovKioKICogQHRpdGxlIE1hbmFnZWFibGUKICogQGRldiBDb250cmFjdCB0aGF0IGFsbG93cyB0byBncmFudCBwZXJtaXNzaW9ucyB0byBhbnkgYWRkcmVzcwogKiBAZGV2IEluIHJlYWwgbGlmZSB3ZSBhcmUgbm8gYWJsZSB0byBwZXJmb3JtIGFsbCBhY3Rpb25zIHdpdGgganVzdCBvbmUgRXRoZXJldW0gYWRkcmVzcwogKiBAZGV2IGJlY2F1c2Ugcmlza3MgYXJlIHRvbyBoaWdoLgogKiBAZGV2IEluc3RlYWQgb3duZXIgZGVsZWdhdGVzIHJpZ2h0cyB0byBtYW5hZ2UgYW4gY29udHJhY3QgdG8gdGhlIGRpZmZlcmVudCBhZGRyZXNzZXMgYW5kCiAqIEBkZXYgc3RheSBhYmxlIHRvIHJldm9rZSBwZXJtaXNzaW9ucyBhdCBhbnkgdGltZS4KICovCmNvbnRyYWN0IE1hbmFnZWFibGUgaXMgT3duYWJsZSB7CgogIC8qIFN0b3JhZ2UgKi8KCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBtYW5hZ2VyRW5hYmxlZDsgIC8vIGhhcmQgc3dpdGNoIGZvciBhIG1hbmFnZXIgLSBvbi9vZmYKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKHN0cmluZyA9PiBib29sKSkgbWFuYWdlclBlcm1pc3Npb25zOyAgLy8gZGV0YWlsZWQgaW5mbyBhYm91dCBtYW5hZ2VyYHMgcGVybWlzc2lvbnMKCgogIC8qIEV2ZW50cyAqLwoKICBldmVudCBNYW5hZ2VyRW5hYmxlZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBtYW5hZ2VyKTsKICBldmVudCBNYW5hZ2VyRGlzYWJsZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgbWFuYWdlcik7CiAgZXZlbnQgTWFuYWdlclBlcm1pc3Npb25HcmFudGVkRXZlbnQoYWRkcmVzcyBpbmRleGVkIG1hbmFnZXIsIHN0cmluZyBwZXJtaXNzaW9uKTsKICBldmVudCBNYW5hZ2VyUGVybWlzc2lvblJldm9rZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgbWFuYWdlciwgc3RyaW5nIHBlcm1pc3Npb24pOwoKCiAgLyogQ29uZmlndXJlIGNvbnRyYWN0ICovCgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gYWRkIG5ldyBtYW5hZ2VyCiAgICogQHBhcmFtIF9tYW5hZ2VyIGFkZHJlc3MgTmV3IG1hbmFnZXIKICAgKi8KICBmdW5jdGlvbiBlbmFibGVNYW5hZ2VyKGFkZHJlc3MgX21hbmFnZXIpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSB7CiAgICByZXF1aXJlKG1hbmFnZXJFbmFibGVkW19tYW5hZ2VyXSA9PSBmYWxzZSk7CgogICAgbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdID0gdHJ1ZTsKICAgIE1hbmFnZXJFbmFibGVkRXZlbnQoX21hbmFnZXIpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byByZW1vdmUgZXhpc3RpbmcgbWFuYWdlcgogICAqIEBwYXJhbSBfbWFuYWdlciBhZGRyZXNzIEV4aXN0aW5nIG1hbmFnZXIKICAgKi8KICBmdW5jdGlvbiBkaXNhYmxlTWFuYWdlcihhZGRyZXNzIF9tYW5hZ2VyKSBleHRlcm5hbCBvbmx5T3duZXIgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikgewogICAgcmVxdWlyZShtYW5hZ2VyRW5hYmxlZFtfbWFuYWdlcl0gPT0gdHJ1ZSk7CgogICAgbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdID0gZmFsc2U7CiAgICBNYW5hZ2VyRGlzYWJsZWRFdmVudChfbWFuYWdlcik7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGdyYW50IG5ldyBwZXJtaXNzaW9uIHRvIHRoZSBtYW5hZ2VyCiAgICogQHBhcmFtIF9tYW5hZ2VyICAgICAgICBhZGRyZXNzIEV4aXN0aW5nIG1hbmFnZXIKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgR3JhbnRlZCBwZXJtaXNzaW9uIG5hbWUKICAgKi8KICBmdW5jdGlvbiBncmFudE1hbmFnZXJQZXJtaXNzaW9uKAogICAgYWRkcmVzcyBfbWFuYWdlciwgc3RyaW5nIF9wZXJtaXNzaW9uTmFtZQogICkKICAgIGV4dGVybmFsCiAgICBvbmx5T3duZXIKICAgIG9ubHlWYWxpZEFkZHJlc3MoX21hbmFnZXIpCiAgICBvbmx5VmFsaWRQZXJtaXNzaW9uTmFtZShfcGVybWlzc2lvbk5hbWUpCiAgewogICAgcmVxdWlyZShtYW5hZ2VyUGVybWlzc2lvbnNbX21hbmFnZXJdW19wZXJtaXNzaW9uTmFtZV0gPT0gZmFsc2UpOwoKICAgIG1hbmFnZXJQZXJtaXNzaW9uc1tfbWFuYWdlcl1bX3Blcm1pc3Npb25OYW1lXSA9IHRydWU7CiAgICBNYW5hZ2VyUGVybWlzc2lvbkdyYW50ZWRFdmVudChfbWFuYWdlciwgX3Blcm1pc3Npb25OYW1lKTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gcmV2b2tlIHBlcm1pc3Npb24gb2YgdGhlIG1hbmFnZXIKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgRXhpc3RpbmcgbWFuYWdlcgogICAqIEBwYXJhbSBfcGVybWlzc2lvbk5hbWUgc3RyaW5nICBSZXZva2VkIHBlcm1pc3Npb24gbmFtZQogICAqLwogIGZ1bmN0aW9uIHJldm9rZU1hbmFnZXJQZXJtaXNzaW9uKAogICAgYWRkcmVzcyBfbWFuYWdlciwgc3RyaW5nIF9wZXJtaXNzaW9uTmFtZQogICkKICAgIGV4dGVybmFsCiAgICBvbmx5T3duZXIKICAgIG9ubHlWYWxpZEFkZHJlc3MoX21hbmFnZXIpCiAgICBvbmx5VmFsaWRQZXJtaXNzaW9uTmFtZShfcGVybWlzc2lvbk5hbWUpCiAgewogICAgcmVxdWlyZShtYW5hZ2VyUGVybWlzc2lvbnNbX21hbmFnZXJdW19wZXJtaXNzaW9uTmFtZV0gPT0gdHJ1ZSk7CgogICAgbWFuYWdlclBlcm1pc3Npb25zW19tYW5hZ2VyXVtfcGVybWlzc2lvbk5hbWVdID0gZmFsc2U7CiAgICBNYW5hZ2VyUGVybWlzc2lvblJldm9rZWRFdmVudChfbWFuYWdlciwgX3Blcm1pc3Npb25OYW1lKTsKICB9CgoKICAvKiBHZXR0ZXJzICovCgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgbWFuYWdlciBzdGF0dXMKICAgKiBAcGFyYW0gX21hbmFnZXIgYWRkcmVzcyBNYW5hZ2VyYHMgYWRkcmVzcwogICAqIEByZXR1cm4gVHJ1ZSBpZiBtYW5hZ2VyIGlzIGVuYWJsZWQKICAgKi8KICBmdW5jdGlvbiBpc01hbmFnZXJFbmFibGVkKGFkZHJlc3MgX21hbmFnZXIpIHB1YmxpYyBjb25zdGFudCBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayBwZXJtaXNzaW9ucyBvZiBhIG1hbmFnZXIKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgTWFuYWdlcmBzIGFkZHJlc3MKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgUGVybWlzc2lvbiBuYW1lCiAgICogQHJldHVybiBUcnVlIGlmIG1hbmFnZXIgaGFzIGJlZW4gZ3JhbnRlZCBuZWVkZWQgcGVybWlzc2lvbgogICAqLwogIGZ1bmN0aW9uIGlzUGVybWlzc2lvbkdyYW50ZWQoCiAgICBhZGRyZXNzIF9tYW5hZ2VyLCBzdHJpbmcgX3Blcm1pc3Npb25OYW1lCiAgKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikKICAgIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKF9wZXJtaXNzaW9uTmFtZSkKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIG1hbmFnZXJQZXJtaXNzaW9uc1tfbWFuYWdlcl1bX3Blcm1pc3Npb25OYW1lXTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIG1hbmFnZXIgY2FuIHBlcmZvcm0gdGhlIGFjdGlvbiBvciBub3QKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgTWFuYWdlcmBzIGFkZHJlc3MKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgUGVybWlzc2lvbiBuYW1lCiAgICogQHJldHVybiBUcnVlIGlmIG1hbmFnZXIgaXMgZW5hYmxlZCBhbmQgaGFzIGJlZW4gZ3JhbnRlZCBuZWVkZWQgcGVybWlzc2lvbgogICAqLwogIGZ1bmN0aW9uIGlzTWFuYWdlckFsbG93ZWQoCiAgICBhZGRyZXNzIF9tYW5hZ2VyLCBzdHJpbmcgX3Blcm1pc3Npb25OYW1lCiAgKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikKICAgIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKF9wZXJtaXNzaW9uTmFtZSkKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIChtYW5hZ2VyRW5hYmxlZFtfbWFuYWdlcl0gJiYgbWFuYWdlclBlcm1pc3Npb25zW19tYW5hZ2VyXVtfcGVybWlzc2lvbk5hbWVdKTsKICB9CgoKICAvKiBIZWxwZXJzICovCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gY2hlY2sgbWFuYWdlciBhZGRyZXNzCiAgICovCiAgbW9kaWZpZXIgb25seVZhbGlkQWRkcmVzcyhhZGRyZXNzIF9tYW5hZ2VyKSB7CiAgICByZXF1aXJlKF9tYW5hZ2VyICE9IGFkZHJlc3MoMHgwKSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBjaGVjayBuYW1lIG9mIG1hbmFnZXIgcGVybWlzc2lvbgogICAqLwogIG1vZGlmaWVyIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKHN0cmluZyBfcGVybWlzc2lvbk5hbWUpIHsKICAgIHJlcXVpcmUoYnl0ZXMoX3Blcm1pc3Npb25OYW1lKS5sZW5ndGggIT0gMCk7CiAgICBfOwogIH0KCgogIC8qIE91dGNvbWUgKi8KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byB1c2UgaW4gZGVyaXZlZCBjb250cmFjdHMKICAgKi8KICBtb2RpZmllciBvbmx5QWxsb3dlZE1hbmFnZXIoc3RyaW5nIF9wZXJtaXNzaW9uTmFtZSkgewogICAgcmVxdWlyZShpc01hbmFnZXJBbGxvd2VkKG1zZy5zZW5kZXIsIF9wZXJtaXNzaW9uTmFtZSkgPT0gdHJ1ZSk7CiAgICBfOwogIH0KfQoKCgoKCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICogQGRldiBCYXNlZCBvbiB6ZXBwZWxpbidzIFBhdXNhYmxlLCBidXQgaW50ZWdyYXRlZCB3aXRoIE1hbmFnZWFibGUKICogQGRldiBDb250cmFjdCBpcyBpbiBwYXVzZWQgc3RhdGUgYnkgZGVmYXVsdCBhbmQgc2hvdWxkIGJlIGV4cGxpY2l0bHkgdW5sb2NrZWQKICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE1hbmFnZWFibGUgewoKICAvKioKICAgKiBFdmVudHMKICAgKi8KCiAgZXZlbnQgUGF1c2VFdmVudCgpOwogIGV2ZW50IFVucGF1c2VFdmVudCgpOwoKCiAgLyoqCiAgICogU3RvcmFnZQogICAqLwoKICBib29sIHBhdXNlZCA9IHRydWU7CgoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuQ29udHJhY3ROb3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCA9PSBmYWxzZSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Db250cmFjdFBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCA9PSB0cnVlKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgbWFuYWdlciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlQ29udHJhY3QoKSBleHRlcm5hbCBvbmx5QWxsb3dlZE1hbmFnZXIoJ3BhdXNlX2NvbnRyYWN0Jykgd2hlbkNvbnRyYWN0Tm90UGF1c2VkIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZUV2ZW50KCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgbWFuYWdlciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2VDb250cmFjdCgpIGV4dGVybmFsIG9ubHlBbGxvd2VkTWFuYWdlcigndW5wYXVzZV9jb250cmFjdCcpIHdoZW5Db250cmFjdFBhdXNlZCB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2VFdmVudCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBUaGUgZ2V0dGVyIGZvciAicGF1c2VkIiBjb250cmFjdCB2YXJpYWJsZQogICAqLwogIGZ1bmN0aW9uIGdldFBhdXNlZCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBwYXVzZWQ7CiAgfQp9CgoKCgoKCgovKioKICogQHRpdGxlIE5hbWVkVG9rZW4KICovCmNvbnRyYWN0IE5hbWVkVG9rZW4gewogIHN0cmluZyBwdWJsaWMgbmFtZTsKICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgogIGZ1bmN0aW9uIE5hbWVkVG9rZW4oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDggX2RlY2ltYWxzKSBwdWJsaWMgewogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjYWxjdWxhdGUgaGFzaCBvZiB0aGUgdG9rZW5gcyBuYW1lLgogICAqIEBkZXYgRnVuY3Rpb24gbmVlZGVkIGJlY2F1c2Ugd2UgY2FuIG5vdCBqdXN0IHJldHVybiBuYW1lIG9mIHRoZSB0b2tlbiB0byBhbm90aGVyIGNvbnRyYWN0IC0gc3RyaW5ncyBoYXZlIHZhcmlhYmxlIGxlbmd0aAogICAqIEByZXR1cm4gSGFzaCBvZiB0aGUgdG9rZW5gcyBuYW1lCiAgICovCiAgZnVuY3Rpb24gZ2V0TmFtZUhhc2goKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIHJlc3VsdCl7CiAgICByZXR1cm4ga2VjY2FrMjU2KG5hbWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjYWxjdWxhdGUgaGFzaCBvZiB0aGUgdG9rZW5gcyBzeW1ib2wuCiAgICogQGRldiBGdW5jdGlvbiBuZWVkZWQgYmVjYXVzZSB3ZSBjYW4gbm90IGp1c3QgcmV0dXJuIHN5bWJvbCBvZiB0aGUgdG9rZW4gdG8gYW5vdGhlciBjb250cmFjdCAtIHN0cmluZ3MgaGF2ZSB2YXJpYWJsZSBsZW5ndGgKICAgKiBAcmV0dXJuIEhhc2ggb2YgdGhlIHRva2VuYHMgc3ltYm9sCiAgICovCiAgZnVuY3Rpb24gZ2V0U3ltYm9sSGFzaCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0KXsKICAgIHJldHVybiBrZWNjYWsyNTYoc3ltYm9sKTsKICB9Cn0KCgoKCgoKLyoqCiAqIEB0aXRsZSBBbmdlbFRva2VuCiAqLwpjb250cmFjdCBBbmdlbFRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE5hbWVkVG9rZW4sIFBhdXNhYmxlIHsKCiAgLyogRXZlbnRzICovCgogIGV2ZW50IE1pbnRFdmVudChhZGRyZXNzIGluZGV4ZWQgYWNjb3VudCwgdWludCB2YWx1ZSk7CiAgZXZlbnQgQnVybkV2ZW50KGFkZHJlc3MgaW5kZXhlZCBhY2NvdW50LCB1aW50IHZhbHVlKTsKICBldmVudCBTcGVuZGluZ0Jsb2NrZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgYWNjb3VudCk7CiAgZXZlbnQgU3BlbmRpbmdVbmJsb2NrZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgYWNjb3VudCk7CgoKICAvKiBTdG9yYWdlICovCgogIGFkZHJlc3MgcHVibGljIGNlbnRyYWxCYW5rQWRkcmVzcyA9IDB4MDsKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHNwZW5kaW5nQmxvY2tzTnVtYmVyOwoKCiAgLyogQ29uc3RydWN0b3IgKi8KCiAgZnVuY3Rpb24gQW5nZWxUb2tlbigpIHB1YmxpYyBOYW1lZFRva2VuKCdBbmdlbCBUb2tlbicsICdBTkdMJywgMTgpIHsKICAgIGNlbnRyYWxCYW5rQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyogTWV0aG9kcyAqLwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBpZiAoX3RvICE9IGNlbnRyYWxCYW5rQWRkcmVzcykgewogICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgfQogICAgcmVxdWlyZShzcGVuZGluZ0Jsb2Nrc051bWJlclttc2cuc2VuZGVyXSA9PSAwKTsKCiAgICBib29sIHJlc3VsdCA9IHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIGlmIChyZXN1bHQgPT0gdHJ1ZSAmJiBfdG8gPT0gY2VudHJhbEJhbmtBZGRyZXNzKSB7CiAgICAgIEFuZ2VsQ2VudHJhbEJhbmsoY2VudHJhbEJhbmtBZGRyZXNzKS5hbmdlbEJ1cm4obXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgd2hlbkNvbnRyYWN0Tm90UGF1c2VkIHJldHVybnMgKGJvb2wpewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgd2hlbkNvbnRyYWN0Tm90UGF1c2VkIHJldHVybnMgKGJvb2wpewogICAgcmVxdWlyZShzcGVuZGluZ0Jsb2Nrc051bWJlcltfZnJvbV0gPT0gMCk7CgogICAgYm9vbCByZXN1bHQgPSBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIGlmIChyZXN1bHQgPT0gdHJ1ZSAmJiBfdG8gPT0gY2VudHJhbEJhbmtBZGRyZXNzKSB7CiAgICAgIEFuZ2VsQ2VudHJhbEJhbmsoY2VudHJhbEJhbmtBZGRyZXNzKS5hbmdlbEJ1cm4oX2Zyb20sIF92YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCgogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfYWNjb3VudCwgdWludCBfdmFsdWUpIGV4dGVybmFsIG9ubHlBbGxvd2VkTWFuYWdlcignbWludF90b2tlbnMnKSB7CiAgICBiYWxhbmNlc1tfYWNjb3VudF0gPSBiYWxhbmNlc1tfYWNjb3VudF0uYWRkKF92YWx1ZSk7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfdmFsdWUpOwogICAgTWludEV2ZW50KF9hY2NvdW50LCBfdmFsdWUpOwogICAgVHJhbnNmZXIoYWRkcmVzcygweDApLCBfYWNjb3VudCwgX3ZhbHVlKTsgLy8gcmVxdWlyZWQgZm9yIGJsb2NrZXhwbG9yZXJzCiAgfQoKICBmdW5jdGlvbiBidXJuKHVpbnQgX3ZhbHVlKSBleHRlcm5hbCBvbmx5QWxsb3dlZE1hbmFnZXIoJ2J1cm5fdG9rZW5zJykgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CiAgICBCdXJuRXZlbnQobXNnLnNlbmRlciwgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGJsb2NrU3BlbmRpbmcoYWRkcmVzcyBfYWNjb3VudCkgZXh0ZXJuYWwgb25seUFsbG93ZWRNYW5hZ2VyKCdibG9ja19zcGVuZGluZycpIHsKICAgIHNwZW5kaW5nQmxvY2tzTnVtYmVyW19hY2NvdW50XSA9IHNwZW5kaW5nQmxvY2tzTnVtYmVyW19hY2NvdW50XS5hZGQoMSk7CiAgICBTcGVuZGluZ0Jsb2NrZWRFdmVudChfYWNjb3VudCk7CiAgfQoKICBmdW5jdGlvbiB1bmJsb2NrU3BlbmRpbmcoYWRkcmVzcyBfYWNjb3VudCkgZXh0ZXJuYWwgb25seUFsbG93ZWRNYW5hZ2VyKCd1bmJsb2NrX3NwZW5kaW5nJykgewogICAgc3BlbmRpbmdCbG9ja3NOdW1iZXJbX2FjY291bnRdID0gc3BlbmRpbmdCbG9ja3NOdW1iZXJbX2FjY291bnRdLnN1YigxKTsKICAgIFNwZW5kaW5nVW5ibG9ja2VkRXZlbnQoX2FjY291bnQpOwogIH0KfQoKCgoKCgoKLyoqCiAqIEB0aXRsZSBBbmdlbENlbnRyYWxCYW5rCiAqCiAqIEBkZXYgQ3Jvd2RzYWxlIGFuZCBlc2Nyb3cgY29udHJhY3QKICovCmNvbnRyYWN0IEFuZ2VsQ2VudHJhbEJhbmsgewoKICAvKiBEYXRhIHN0cnVjdHVyZXMgKi8KCiAgc3RydWN0IEludmVzdG1lbnRSZWNvcmQgewogICAgdWludCB0b2tlbnNTb2xkQmVmb3JlV2VpOwogICAgdWludCBpbnZlc3RlZEV0aFdlaTsKICAgIHVpbnQgcHVyY2hhc2VkVG9rZW5zV2VpOwogICAgdWludCByZWZ1bmRlZEV0aFdlaTsKICAgIHVpbnQgcmV0dXJuZWRUb2tlbnNXZWk7CiAgfQoKCiAgLyogU3RvcmFnZSAtIGNvbmZpZyAqLwoKICB1aW50IHB1YmxpYyBjb25zdGFudCBpY29DYXAgPSA3MDAwMDAwMCAqICgxMCAqKiAxOCk7CgogIHVpbnQgcHVibGljIGluaXRpYWxUb2tlblByaWNlID0gMSAqICgxMCAqKiAxOCkgLyAoMTAgKiogNCk7IC8vIG1lYW5zIDAuMDAwMSBFVEggZm9yIG9uZSB0b2tlbgoKICB1aW50IHB1YmxpYyBjb25zdGFudCBsYW5kbWFya1NpemUgPSAxMDAwMDAwICogKDEwICoqIDE4KTsKICB1aW50IHB1YmxpYyBjb25zdGFudCBsYW5kbWFya1ByaWNlU3RlcE51bWVyYXRvciA9IDEwOwogIHVpbnQgcHVibGljIGNvbnN0YW50IGxhbmRtYXJrUHJpY2VTdGVwRGVub21pbmF0b3IgPSAxMDA7CgogIHVpbnQgcHVibGljIGNvbnN0YW50IGZpcnN0UmVmdW5kUm91bmRSYXRlTnVtZXJhdG9yID0gODA7CiAgdWludCBwdWJsaWMgY29uc3RhbnQgZmlyc3RSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvciA9IDEwMDsKICB1aW50IHB1YmxpYyBjb25zdGFudCBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVOdW1lcmF0b3IgPSA0MDsKICB1aW50IHB1YmxpYyBjb25zdGFudCBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvciA9IDEwMDsKCiAgdWludCBwdWJsaWMgY29uc3RhbnQgaW5pdGlhbEZ1bmRzUmVsZWFzZU51bWVyYXRvciA9IDIwOyAvLyBwYXJ0IG9mIGludmVzdG1lbnQKICB1aW50IHB1YmxpYyBjb25zdGFudCBpbml0aWFsRnVuZHNSZWxlYXNlRGVub21pbmF0b3IgPSAxMDA7CiAgdWludCBwdWJsaWMgY29uc3RhbnQgYWZ0ZXJGaXJzdFJlZnVuZFJvdW5kRnVuZHNSZWxlYXNlTnVtZXJhdG9yID0gNTA7IC8vIHBhcnQgb2YgcmVtYWluaW5nIGZ1bmRzCiAgdWludCBwdWJsaWMgY29uc3RhbnQgYWZ0ZXJGaXJzdFJlZnVuZFJvdW5kRnVuZHNSZWxlYXNlRGVub21pbmF0b3IgPSAxMDA7CgogIHVpbnQgcHVibGljIGNvbnN0YW50IGFuZ2VsRm91bmRhdGlvblNoYXJlTnVtZXJhdG9yID0gMzA7CiAgdWludCBwdWJsaWMgY29uc3RhbnQgYW5nZWxGb3VuZGF0aW9uU2hhcmVEZW5vbWluYXRvciA9IDEwMDsKCiAgLyogU3RvcmFnZSAtIHN0YXRlICovCgogIGFkZHJlc3MgcHVibGljIGFuZ2VsRm91bmRhdGlvbkFkZHJlc3MgPSBhZGRyZXNzKDB4MmIwNTU2YTYyOThlQTNEMzVFOTBGMWRmMzJjYzEyNmIzMUY1OTc3MCk7CiAgdWludCBwdWJsaWMgaWNvTGF1bmNoVGltZXN0YW1wID0gMTUxMTc4NDAwMDsgIC8vIE5vdmVtYmVyIDI3dGggMTI6MDAgR01UCiAgdWludCBwdWJsaWMgaWNvRmluaXNoVGltZXN0YW1wID0gMTUxNDM3NjAwMDsgIC8vIERlY2VtYmVyIDI3dGggMTI6MDAgR01UCiAgdWludCBwdWJsaWMgZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCA9IDE1MjA0MjQwMDA7ICAvLyBNYXJjaCA3dGggMjAxOCAxMjowMCBHTVQKICB1aW50IHB1YmxpYyBzZWNvbmRSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCA9IDE1MjQ3NDQwMDA7ICAvLyBBcHJpbCAyNnRoIDIwMTggMTI6MDAgR01UCgoKICBBbmdlbFRva2VuIHB1YmxpYyBhbmdlbFRva2VuOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IEludmVzdG1lbnRSZWNvcmRbXSkgcHVibGljIGludmVzdG1lbnRzOyAvLyBpbnZlc3RvckFkZHJlc3MgPT4gbGlzdCBvZiBpbnZlc3RtZW50cwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGludmVzdG9yczsKICB1aW50IHB1YmxpYyB0b3RhbEludmVzdG9ycyA9IDA7CiAgdWludCBwdWJsaWMgdG90YWxUb2tlbnNTb2xkID0gMDsKCiAgYm9vbCBpc0ljb0ZpbmlzaGVkID0gZmFsc2U7CiAgYm9vbCBmaXJzdFJlZnVuZFJvdW5kRnVuZHNXaXRoZHJhd2FsID0gZmFsc2U7CgoKICAvKiBFdmVudHMgKi8KCiAgZXZlbnQgSW52ZXN0bWVudEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBpbnZlc3RvciwgdWludCBldGgsIHVpbnQgYW5nZWwpOwogIGV2ZW50IFJlZnVuZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBpbnZlc3RvciwgdWludCBldGgsIHVpbnQgYW5nZWwpOwoKCiAgLyogQ29uc3RydWN0b3IgYW5kIGNvbmZpZyAqLwoKICBmdW5jdGlvbiBBbmdlbENlbnRyYWxCYW5rKCkgcHVibGljIHsKICAgIGFuZ2VsVG9rZW4gPSBuZXcgQW5nZWxUb2tlbigpOwogICAgYW5nZWxUb2tlbi5lbmFibGVNYW5hZ2VyKGFkZHJlc3ModGhpcykpOwogICAgYW5nZWxUb2tlbi5ncmFudE1hbmFnZXJQZXJtaXNzaW9uKGFkZHJlc3ModGhpcyksICdtaW50X3Rva2VucycpOwogICAgYW5nZWxUb2tlbi5ncmFudE1hbmFnZXJQZXJtaXNzaW9uKGFkZHJlc3ModGhpcyksICdidXJuX3Rva2VucycpOwogICAgYW5nZWxUb2tlbi5ncmFudE1hbmFnZXJQZXJtaXNzaW9uKGFkZHJlc3ModGhpcyksICd1bnBhdXNlX2NvbnRyYWN0Jyk7CiAgICBhbmdlbFRva2VuLnRyYW5zZmVyT3duZXJzaGlwKGFuZ2VsRm91bmRhdGlvbkFkZHJlc3MpOwogIH0KCiAgLyogSW52ZXN0bWVudHMgKi8KCiAgLyoqCiAgICogQGRldiBGYWxsYmFjayBmdW5jdGlvbiByZWNlaXZlcyBFVEggYW5kIHNlbmRzIHRva2VucyBiYWNrCiAgICovCiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgYW5nZWxSYWlzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBQcm9jZXNzIG5ldyBFVEggaW52ZXN0bWVudCBhbmQgc2VuZHMgdG9rZW5zIGJhY2sKICAgKi8KICBmdW5jdGlvbiBhbmdlbFJhaXNlKCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgIHJlcXVpcmUobm93ID49IGljb0xhdW5jaFRpbWVzdGFtcCAmJiBub3cgPCBpY29GaW5pc2hUaW1lc3RhbXApOwoKICAgIC8vIGNhbGN1bGF0ZSBhbW91bnQgb2YgdG9rZW5zIGZvciByZWNlaXZlZCBFVEgKICAgIHVpbnQgX3B1cmNoYXNlZFRva2Vuc1dlaSA9IDA7CiAgICB1aW50IF9ub3RQcm9jZXNzZWRFdGhXZWkgPSAwOwogICAgKF9wdXJjaGFzZWRUb2tlbnNXZWksIF9ub3RQcm9jZXNzZWRFdGhXZWkpID0gY2FsY3VsYXRlUHVyY2hhc2VkVG9rZW5zKHRvdGFsVG9rZW5zU29sZCwgbXNnLnZhbHVlKTsKICAgIHVpbnQgX2FjdHVhbEludmVzdG1lbnQgPSAobXNnLnZhbHVlIC0gX25vdFByb2Nlc3NlZEV0aFdlaSk7CgogICAgLy8gY3JlYXRlIHJlY29yZCBmb3IgdGhlIGludmVzdG1lbnQKICAgIHVpbnQgX25ld1JlY29yZEluZGV4ID0gaW52ZXN0bWVudHNbbXNnLnNlbmRlcl0ubGVuZ3RoOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl0ubGVuZ3RoICs9IDE7CiAgICBpbnZlc3RtZW50c1ttc2cuc2VuZGVyXVtfbmV3UmVjb3JkSW5kZXhdLnRva2Vuc1NvbGRCZWZvcmVXZWkgPSB0b3RhbFRva2Vuc1NvbGQ7CiAgICBpbnZlc3RtZW50c1ttc2cuc2VuZGVyXVtfbmV3UmVjb3JkSW5kZXhdLmludmVzdGVkRXRoV2VpID0gX2FjdHVhbEludmVzdG1lbnQ7CiAgICBpbnZlc3RtZW50c1ttc2cuc2VuZGVyXVtfbmV3UmVjb3JkSW5kZXhdLnB1cmNoYXNlZFRva2Vuc1dlaSA9IF9wdXJjaGFzZWRUb2tlbnNXZWk7CiAgICBpbnZlc3RtZW50c1ttc2cuc2VuZGVyXVtfbmV3UmVjb3JkSW5kZXhdLnJlZnVuZGVkRXRoV2VpID0gMDsKICAgIGludmVzdG1lbnRzW21zZy5zZW5kZXJdW19uZXdSZWNvcmRJbmRleF0ucmV0dXJuZWRUb2tlbnNXZWkgPSAwOwoKICAgIC8vIGNhbGN1bGF0ZSBzdGF0cwogICAgaWYgKGludmVzdG9yc1ttc2cuc2VuZGVyXSA9PSBmYWxzZSkgewogICAgICB0b3RhbEludmVzdG9ycyArPSAxOwogICAgfQogICAgaW52ZXN0b3JzW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgIHRvdGFsVG9rZW5zU29sZCArPSBfcHVyY2hhc2VkVG9rZW5zV2VpOwoKICAgIC8vIHRyYW5zZmVyIHRva2VucyBhbmQgRVRICiAgICBhbmdlbFRva2VuLm1pbnQobXNnLnNlbmRlciwgX3B1cmNoYXNlZFRva2Vuc1dlaSk7CiAgICBhbmdlbFRva2VuLm1pbnQoYW5nZWxGb3VuZGF0aW9uQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICBfcHVyY2hhc2VkVG9rZW5zV2VpICogYW5nZWxGb3VuZGF0aW9uU2hhcmVOdW1lcmF0b3IgLyAoYW5nZWxGb3VuZGF0aW9uU2hhcmVEZW5vbWluYXRvciAtIGFuZ2VsRm91bmRhdGlvblNoYXJlTnVtZXJhdG9yKSk7CiAgICBhbmdlbEZvdW5kYXRpb25BZGRyZXNzLnRyYW5zZmVyKF9hY3R1YWxJbnZlc3RtZW50ICogaW5pdGlhbEZ1bmRzUmVsZWFzZU51bWVyYXRvciAvIGluaXRpYWxGdW5kc1JlbGVhc2VEZW5vbWluYXRvcik7CiAgICBpZiAoX25vdFByb2Nlc3NlZEV0aFdlaSA+IDApIHsKICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihfbm90UHJvY2Vzc2VkRXRoV2VpKTsKICAgIH0KCiAgICAvLyBmaW5pc2ggSUNPIGlmIGNhcCByZWFjaGVkCiAgICBpZiAodG90YWxUb2tlbnNTb2xkID49IGljb0NhcCkgewogICAgICBpY29GaW5pc2hUaW1lc3RhbXAgPSBub3c7CgogICAgICBmaW5pc2hJY28oKTsKICAgIH0KCiAgICAvLyBmaXJlIGV2ZW50CiAgICBJbnZlc3RtZW50RXZlbnQobXNnLnNlbmRlciwgX2FjdHVhbEludmVzdG1lbnQsIF9wdXJjaGFzZWRUb2tlbnNXZWkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHRva2VucyBmb3IgcmVjZWl2ZWQgRVRICiAgICogQHBhcmFtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgdWludCBBbW91bnQgb2YgdG9rZW5zIHNvbGQgYmVmb3JlIHRoaXMgaW52ZXN0bWVudCBbdG9rZW4gd2VpXQogICAqIEBwYXJhbSBfaW52ZXN0ZWRFdGhXZWkgICAgICAgIHVpbnQgSW52ZXN0bWVudCBhbW91bnQgW0VUSCB3ZWldCiAgICogQHJldHVybiBQdXJjaGFzZWQgYW1vdW50IG9mIHRva2VucyBbdG9rZW4gd2VpXQogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVB1cmNoYXNlZFRva2VucygKICAgIHVpbnQgX3RvdGFsVG9rZW5zU29sZEJlZm9yZSwKICAgIHVpbnQgX2ludmVzdGVkRXRoV2VpKQogICAgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgX3B1cmNoYXNlZFRva2Vuc1dlaSwgdWludCBfbm90UHJvY2Vzc2VkRXRoV2VpKQogIHsKICAgIF9wdXJjaGFzZWRUb2tlbnNXZWkgPSAwOwogICAgX25vdFByb2Nlc3NlZEV0aFdlaSA9IF9pbnZlc3RlZEV0aFdlaTsKCiAgICB1aW50IF9sYW5kbWFya1ByaWNlOwogICAgdWludCBfbWF4TGFuZG1hcmtUb2tlbnNXZWk7CiAgICB1aW50IF9tYXhMYW5kbWFya0V0aFdlaTsKICAgIGJvb2wgX2lzQ2FwUmVhY2hlZCA9IGZhbHNlOwogICAgZG8gewogICAgICAvLyBnZXQgbGFuZG1hcmsgdmFsdWVzCiAgICAgIF9sYW5kbWFya1ByaWNlID0gY2FsY3VsYXRlTGFuZG1hcmtQcmljZShfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3B1cmNoYXNlZFRva2Vuc1dlaSk7CiAgICAgIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA9IGxhbmRtYXJrU2l6ZSAtICgoX3RvdGFsVG9rZW5zU29sZEJlZm9yZSArIF9wdXJjaGFzZWRUb2tlbnNXZWkpICUgbGFuZG1hcmtTaXplKTsKICAgICAgaWYgKF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgKyBfcHVyY2hhc2VkVG9rZW5zV2VpICsgX21heExhbmRtYXJrVG9rZW5zV2VpID49IGljb0NhcCkgewogICAgICAgIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA9IGljb0NhcCAtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgLSBfcHVyY2hhc2VkVG9rZW5zV2VpOwogICAgICAgIF9pc0NhcFJlYWNoZWQgPSB0cnVlOwogICAgICB9CiAgICAgIF9tYXhMYW5kbWFya0V0aFdlaSA9IF9tYXhMYW5kbWFya1Rva2Vuc1dlaSAqIF9sYW5kbWFya1ByaWNlIC8gKDEwICoqIDE4KTsKCiAgICAgIC8vIGNoZWNrIGludmVzdG1lbnQgYWdhaW5zdCBsYW5kbWFyayB2YWx1ZXMKICAgICAgaWYgKF9ub3RQcm9jZXNzZWRFdGhXZWkgPj0gX21heExhbmRtYXJrRXRoV2VpKSB7CiAgICAgICAgX3B1cmNoYXNlZFRva2Vuc1dlaSArPSBfbWF4TGFuZG1hcmtUb2tlbnNXZWk7CiAgICAgICAgX25vdFByb2Nlc3NlZEV0aFdlaSAtPSBfbWF4TGFuZG1hcmtFdGhXZWk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgX3B1cmNoYXNlZFRva2Vuc1dlaSArPSBfbm90UHJvY2Vzc2VkRXRoV2VpICogKDEwICoqIDE4KSAvIF9sYW5kbWFya1ByaWNlOwogICAgICAgIF9ub3RQcm9jZXNzZWRFdGhXZWkgPSAwOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAoKF9ub3RQcm9jZXNzZWRFdGhXZWkgPiAwKSAmJiAoX2lzQ2FwUmVhY2hlZCA9PSBmYWxzZSkpOwoKICAgIGFzc2VydChfcHVyY2hhc2VkVG9rZW5zV2VpID4gMCk7CgogICAgcmV0dXJuIChfcHVyY2hhc2VkVG9rZW5zV2VpLCBfbm90UHJvY2Vzc2VkRXRoV2VpKTsKICB9CgoKICAvKiBSZWZ1bmRzICovCgogIGZ1bmN0aW9uIGFuZ2VsQnVybigKICAgIGFkZHJlc3MgX2ludmVzdG9yLAogICAgdWludCBfcmV0dXJuZWRUb2tlbnNXZWkKICApCiAgICBleHRlcm5hbCByZXR1cm5zICh1aW50KQogIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGFuZ2VsVG9rZW4pKTsKICAgIHJlcXVpcmUobm93ID49IGljb0xhdW5jaFRpbWVzdGFtcCAmJiBub3cgPCBzZWNvbmRSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCk7CgogICAgdWludCBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID0gX3JldHVybmVkVG9rZW5zV2VpOwogICAgdWludCBfcmVmdW5kZWRFdGhXZWkgPSAwOwoKICAgIHVpbnQgX2FsbFJlY29yZHNOdW1iZXIgPSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdLmxlbmd0aDsKICAgIHVpbnQgX3JlY29yZE1heFJldHVybmVkVG9rZW5zV2VpID0gMDsKICAgIHVpbnQgX3JlY29yZFRva2Vuc1dlaVRvUHJvY2VzcyA9IDA7CiAgICB1aW50IF90b2tlbnNTb2xkV2VpID0gMDsKICAgIHVpbnQgX3JlY29yZFJlZnVuZGVkRXRoV2VpID0gMDsKICAgIHVpbnQgX3JlY29yZE5vdFByb2Nlc3NlZFRva2Vuc1dlaSA9IDA7CiAgICBmb3IgKHVpbnQgX3JlY29yZElEID0gMDsgX3JlY29yZElEIDwgX2FsbFJlY29yZHNOdW1iZXI7IF9yZWNvcmRJRCArPSAxKSB7CiAgICAgIGlmIChpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucHVyY2hhc2VkVG9rZW5zV2VpIDw9IGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZXR1cm5lZFRva2Vuc1dlaSB8fAogICAgICAgICAgaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLmludmVzdGVkRXRoV2VpIDw9IGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZWZ1bmRlZEV0aFdlaSkgewogICAgICAgIC8vIHRva2VucyBhbHJlYWR5IHJlZnVuZGVkCiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8vIGNhbGN1bGF0ZSBhbW91bnQgb2YgdG9rZW5zIHRvIHJlZnVuZCB3aXRoIHRoaXMgcmVjb3JkCiAgICAgIF9yZWNvcmRNYXhSZXR1cm5lZFRva2Vuc1dlaSA9IGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5wdXJjaGFzZWRUb2tlbnNXZWkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmV0dXJuZWRUb2tlbnNXZWk7CiAgICAgIF9yZWNvcmRUb2tlbnNXZWlUb1Byb2Nlc3MgPSAoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA8IF9yZWNvcmRNYXhSZXR1cm5lZFRva2Vuc1dlaSkgPyBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZWNvcmRNYXhSZXR1cm5lZFRva2Vuc1dlaTsKICAgICAgYXNzZXJ0KF9yZWNvcmRUb2tlbnNXZWlUb1Byb2Nlc3MgPiAwKTsKCiAgICAgIC8vIGNhbGN1bGF0ZSBhbW91bnQgb2YgRVRIIHRvIHNlbmQgYmFjawogICAgICBfdG9rZW5zU29sZFdlaSA9IGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS50b2tlbnNTb2xkQmVmb3JlV2VpICsgaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJldHVybmVkVG9rZW5zV2VpOwogICAgICAoX3JlY29yZFJlZnVuZGVkRXRoV2VpLCBfcmVjb3JkTm90UHJvY2Vzc2VkVG9rZW5zV2VpKSA9IGNhbGN1bGF0ZVJlZnVuZGVkRXRoKF90b2tlbnNTb2xkV2VpLCBfcmVjb3JkVG9rZW5zV2VpVG9Qcm9jZXNzKTsKICAgICAgaWYgKF9yZWNvcmRSZWZ1bmRlZEV0aFdlaSA+IChpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0uaW52ZXN0ZWRFdGhXZWkgLSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmVmdW5kZWRFdGhXZWkpKSB7CiAgICAgICAgLy8gdGhpcyBjYW4gaGFwcGVuIGR1ZSB0byByb3VuZGluZyBlcnJvcgogICAgICAgIF9yZWNvcmRSZWZ1bmRlZEV0aFdlaSA9IChpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0uaW52ZXN0ZWRFdGhXZWkgLSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmVmdW5kZWRFdGhXZWkpOwogICAgICB9CiAgICAgIGFzc2VydChfcmVjb3JkUmVmdW5kZWRFdGhXZWkgPiAwKTsKICAgICAgYXNzZXJ0KF9yZWNvcmROb3RQcm9jZXNzZWRUb2tlbnNXZWkgPT0gMCk7CgogICAgICAvLyBwZXJzaXN0IGNoYW5nZXMgdG8gdGhlIHN0b3JhZ2UKICAgICAgX3JlZnVuZGVkRXRoV2VpICs9IF9yZWNvcmRSZWZ1bmRlZEV0aFdlaTsKICAgICAgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSAtPSBfcmVjb3JkVG9rZW5zV2VpVG9Qcm9jZXNzOwoKICAgICAgaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJlZnVuZGVkRXRoV2VpICs9IF9yZWNvcmRSZWZ1bmRlZEV0aFdlaTsKICAgICAgaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJldHVybmVkVG9rZW5zV2VpICs9IF9yZWNvcmRUb2tlbnNXZWlUb1Byb2Nlc3M7CiAgICAgIGFzc2VydChpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmVmdW5kZWRFdGhXZWkgPD0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLmludmVzdGVkRXRoV2VpKTsKICAgICAgYXNzZXJ0KGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZXR1cm5lZFRva2Vuc1dlaSA8PSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucHVyY2hhc2VkVG9rZW5zV2VpKTsKCiAgICAgIC8vIHN0b3AgaWYgd2UgYWxyZWFkeSByZWZ1bmRlZCBhbGwgdG9rZW5zCiAgICAgIGlmIChfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID09IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIC8vIHRocm93IGlmIHdlIGRvIG5vdCBoYXZlIHRva2VucyB0byByZWZ1bmQKICAgIHJlcXVpcmUoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA8IF9yZXR1cm5lZFRva2Vuc1dlaSk7CiAgICByZXF1aXJlKF9yZWZ1bmRlZEV0aFdlaSA+IDApOwoKICAgIC8vIGNhbGN1bGF0ZSByZWZ1bmQgZGlzY291bnQKICAgIHVpbnQgX3JlZnVuZGVkRXRoV2VpV2l0aERpc2NvdW50ID0gY2FsY3VsYXRlUmVmdW5kZWRFdGhXaXRoRGlzY291bnQoX3JlZnVuZGVkRXRoV2VpKTsKCiAgICAvLyB0cmFuc2ZlciBFVEggYW5kIHJlbWFpbmluZyB0b2tlbnMKICAgIGFuZ2VsVG9rZW4uYnVybihfcmV0dXJuZWRUb2tlbnNXZWkgLSBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpKTsKICAgIGlmIChfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID4gMCkgewogICAgICBhbmdlbFRva2VuLnRyYW5zZmVyKF9pbnZlc3RvciwgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSk7CiAgICB9CiAgICBfaW52ZXN0b3IudHJhbnNmZXIoX3JlZnVuZGVkRXRoV2VpV2l0aERpc2NvdW50KTsKCiAgICAvLyBmaXJlIGV2ZW50CiAgICBSZWZ1bmRFdmVudChfaW52ZXN0b3IsIF9yZWZ1bmRlZEV0aFdlaVdpdGhEaXNjb3VudCwgX3JldHVybmVkVG9rZW5zV2VpIC0gX25vdFByb2Nlc3NlZFRva2Vuc1dlaSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBkaXNjb3VudGVkIGFtb3VudCBvZiBFVEggZm9yIHJlZnVuZGVkIHRva2VucwogICAqIEBwYXJhbSBfcmVmdW5kZWRFdGhXZWkgdWludCBDYWxjdWxhdGVkIGFtb3VudCBvZiBFVEggdG8gcmVmdW5kIFtFVEggd2VpXQogICAqIEByZXR1cm4gRGlzY291bnRlZCBhbW91bnQgb2YgRVRIIGZvciByZWZ1bmRlZCBbRVRIIHdlaV0KICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVSZWZ1bmRlZEV0aFdpdGhEaXNjb3VudCgKICAgIHVpbnQgX3JlZnVuZGVkRXRoV2VpCiAgKQogICAgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpCiAgewogICAgaWYgKG5vdyA8PSBmaXJzdFJlZnVuZFJvdW5kRmluaXNoVGltZXN0YW1wKSB7CiAgICAgIHJldHVybiAoX3JlZnVuZGVkRXRoV2VpICogZmlyc3RSZWZ1bmRSb3VuZFJhdGVOdW1lcmF0b3IgLyBmaXJzdFJlZnVuZFJvdW5kUmF0ZURlbm9taW5hdG9yKTsKICAgIH0KICAgIGVsc2UgewogICAgICByZXR1cm4gKF9yZWZ1bmRlZEV0aFdlaSAqIHNlY29uZFJlZnVuZFJvdW5kUmF0ZU51bWVyYXRvciAvIHNlY29uZFJlZnVuZFJvdW5kUmF0ZURlbm9taW5hdG9yKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiBFVEggZm9yIHJlZnVuZGVkIHRva2Vucy4gSnVzdCBhYnN0cmFjdCBwcmljZSBsYWRkZXIKICAgKiBAcGFyYW0gX3RvdGFsVG9rZW5zU29sZEJlZm9yZSAgICAgdWludCBBbW91bnQgb2YgdG9rZW5zIHRoYXQgaGF2ZSBiZWVuIHNvbGQgKHN0YXJ0aW5nIHBvaW50KSBbdG9rZW4gd2VpXQogICAqIEBwYXJhbSBfcmV0dXJuZWRUb2tlbnNXZWkgdWludCBBbW91bnQgb2YgdG9rZW5zIHRvIHJlZnVuZCBbdG9rZW4gd2VpXQogICAqIEByZXR1cm4gUmVmdW5kZWQgYW1vdW50IG9mIEVUSCBbRVRIIHdlaV0gKHdpdGhvdXQgZGlzY291bnRzKQogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVJlZnVuZGVkRXRoKAogICAgdWludCBfdG90YWxUb2tlbnNTb2xkQmVmb3JlLAogICAgdWludCBfcmV0dXJuZWRUb2tlbnNXZWkKICApCiAgICBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBfcmVmdW5kZWRFdGhXZWksIHVpbnQgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSkKICB7CiAgICBfcmVmdW5kZWRFdGhXZWkgPSAwOwogICAgdWludCBfcmVmdW5kZWRUb2tlbnNXZWkgPSAwOwogICAgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA9IF9yZXR1cm5lZFRva2Vuc1dlaTsKCiAgICB1aW50IF9sYW5kbWFya1ByaWNlID0gMDsKICAgIHVpbnQgX21heExhbmRtYXJrVG9rZW5zV2VpID0gMDsKICAgIHVpbnQgX21heExhbmRtYXJrRXRoV2VpID0gMDsKICAgIGJvb2wgX2lzQ2FwUmVhY2hlZCA9IGZhbHNlOwogICAgZG8gewogICAgICAvLyBnZXQgbGFuZG1hcmsgdmFsdWVzCiAgICAgIF9sYW5kbWFya1ByaWNlID0gY2FsY3VsYXRlTGFuZG1hcmtQcmljZShfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3JlZnVuZGVkVG9rZW5zV2VpKTsKICAgICAgX21heExhbmRtYXJrVG9rZW5zV2VpID0gbGFuZG1hcmtTaXplIC0gKChfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3JlZnVuZGVkVG9rZW5zV2VpKSAlIGxhbmRtYXJrU2l6ZSk7CiAgICAgIGlmIChfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3JlZnVuZGVkVG9rZW5zV2VpICsgX21heExhbmRtYXJrVG9rZW5zV2VpID49IGljb0NhcCkgewogICAgICAgIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA9IGljb0NhcCAtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgLSBfcmVmdW5kZWRUb2tlbnNXZWk7CiAgICAgICAgX2lzQ2FwUmVhY2hlZCA9IHRydWU7CiAgICAgIH0KICAgICAgX21heExhbmRtYXJrRXRoV2VpID0gX21heExhbmRtYXJrVG9rZW5zV2VpICogX2xhbmRtYXJrUHJpY2UgLyAoMTAgKiogMTgpOwoKICAgICAgLy8gY2hlY2sgaW52ZXN0bWVudCBhZ2FpbnN0IGxhbmRtYXJrIHZhbHVlcwogICAgICBpZiAoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA+IF9tYXhMYW5kbWFya1Rva2Vuc1dlaSkgewogICAgICAgIF9yZWZ1bmRlZEV0aFdlaSArPSBfbWF4TGFuZG1hcmtFdGhXZWk7CiAgICAgICAgX3JlZnVuZGVkVG9rZW5zV2VpICs9IF9tYXhMYW5kbWFya1Rva2Vuc1dlaTsKICAgICAgICBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpIC09IF9tYXhMYW5kbWFya1Rva2Vuc1dlaTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBfcmVmdW5kZWRFdGhXZWkgKz0gX25vdFByb2Nlc3NlZFRva2Vuc1dlaSAqIF9sYW5kbWFya1ByaWNlIC8gKDEwICoqIDE4KTsKICAgICAgICBfcmVmdW5kZWRUb2tlbnNXZWkgKz0gX25vdFByb2Nlc3NlZFRva2Vuc1dlaTsKICAgICAgICBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID0gMDsKICAgICAgfQogICAgfQogICAgd2hpbGUgKChfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID4gMCkgJiYgKF9pc0NhcFJlYWNoZWQgPT0gZmFsc2UpKTsKCiAgICBhc3NlcnQoX3JlZnVuZGVkRXRoV2VpID4gMCk7CgogICAgcmV0dXJuIChfcmVmdW5kZWRFdGhXZWksIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkpOwogIH0KCgogIC8qIENhbGN1bGF0aW9uIG9mIHRoZSBwcmljZSAqLwoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBwcmljZSBmb3IgdG9rZW5zCiAgICogQHBhcmFtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgdWludCBBbW91bnQgb2YgdG9rZW5zIHNvbGQgYmVmb3JlIFt0b2tlbiB3ZWldCiAgICogQHJldHVybiBDYWxjdWxhdGVkIHByaWNlCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlTGFuZG1hcmtQcmljZSh1aW50IF90b3RhbFRva2Vuc1NvbGRCZWZvcmUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gaW5pdGlhbFRva2VuUHJpY2UgKyBpbml0aWFsVG9rZW5QcmljZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBsYW5kbWFya1ByaWNlU3RlcE51bWVyYXRvciAvIGxhbmRtYXJrUHJpY2VTdGVwRGVub21pbmF0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogKF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgLyBsYW5kbWFya1NpemUpOwogIH0KCgogIC8qIExpZmVjeWNsZSAqLwoKICBmdW5jdGlvbiBmaW5pc2hJY28oKSBwdWJsaWMgewogICAgcmVxdWlyZShub3cgPj0gaWNvRmluaXNoVGltZXN0YW1wKTsKICAgIHJlcXVpcmUoaXNJY29GaW5pc2hlZCA9PSBmYWxzZSk7CgogICAgaXNJY29GaW5pc2hlZCA9IHRydWU7CgogICAgYW5nZWxUb2tlbi51bnBhdXNlQ29udHJhY3QoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3Rm91bmRhdGlvbkZ1bmRzKCkgZXh0ZXJuYWwgewogICAgcmVxdWlyZShub3cgPiBmaXJzdFJlZnVuZFJvdW5kRmluaXNoVGltZXN0YW1wKTsKCiAgICBpZiAobm93ID4gZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCAmJiBub3cgPD0gc2Vjb25kUmVmdW5kUm91bmRGaW5pc2hUaW1lc3RhbXApIHsKICAgICAgcmVxdWlyZShmaXJzdFJlZnVuZFJvdW5kRnVuZHNXaXRoZHJhd2FsID09IGZhbHNlKTsKCiAgICAgIGZpcnN0UmVmdW5kUm91bmRGdW5kc1dpdGhkcmF3YWwgPSB0cnVlOwogICAgICBhbmdlbEZvdW5kYXRpb25BZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSAqIGFmdGVyRmlyc3RSZWZ1bmRSb3VuZEZ1bmRzUmVsZWFzZU51bWVyYXRvciAvIGFmdGVyRmlyc3RSZWZ1bmRSb3VuZEZ1bmRzUmVsZWFzZURlbm9taW5hdG9yKTsKICAgIH0gZWxzZSB7CiAgICAgIGFuZ2VsRm91bmRhdGlvbkFkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KICB9Cn0='.
	

]
