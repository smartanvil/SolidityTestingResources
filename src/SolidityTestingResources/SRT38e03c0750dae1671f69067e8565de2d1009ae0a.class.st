Class {
	#name : #SRT38e03c0750dae1671f69067e8565de2d1009ae0a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT38e03c0750dae1671f69067e8565de2d1009ae0a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvb3duZXJzaGlwL093bmFibGUuc29sCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvbGlmZWN5Y2xlL1BhdXNhYmxlLnNvbAoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvbWF0aC9TYWZlTWF0aC5zb2wKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9FUkMyMEJhc2ljLnNvbAoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLy8gRmlsZTogemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0Jhc2ljVG9rZW4uc29sCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9FUkMyMC5zb2wKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9TdGFuZGFyZFRva2VuLnNvbAoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfYWRkZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBpbmNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9QYXVzYWJsZVRva2VuLnNvbAoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZSB0b2tlbgogKgogKiBAZGV2IFN0YW5kYXJkVG9rZW4gbW9kaWZpZWQgd2l0aCBwYXVzYWJsZSB0cmFuc2ZlcnMuCiAqKi8KCmNvbnRyYWN0IFBhdXNhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgUGF1c2FibGUgewoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXR1cm4gc3VwZXIuaW5jcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX2FkZGVkVmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL1NlZWxlVG9rZW4uc29sCgovLy8gQHRpdGxlIFNlZWxlVG9rZW4gQ29udHJhY3QKLy8vIEZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgdG9rZW4gc2FsZSwgcGxlYXNlIHZpc2l0IGh0dHBzOi8vc2VlbGUucHJvCi8vLyBAYXV0aG9yIHJlZWRob25nCmNvbnRyYWN0IFNlZWxlVG9rZW4gaXMgUGF1c2FibGVUb2tlbiB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICAvLy8gQ29uc3RhbnQgdG9rZW4gc3BlY2lmaWMgZmllbGRzCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiU2VlbGVUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJTZWVsZSI7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIC8vLyBzZWVsZSB0b3RhbCB0b2tlbnMgc3VwcGx5CiAgICB1aW50IHB1YmxpYyBjdXJyZW50U3VwcGx5OwoKICAgIC8vLyBGaWVsZHMgdGhhdCBhcmUgb25seSBjaGFuZ2VkIGluIGNvbnN0cnVjdG9yCiAgICAvLy8gc2VlbGUgc2FsZSAgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIG1pbnRlcjsgCgogICAgLy8vIEZpZWxkcyB0aGF0IGNhbiBiZSBjaGFuZ2VkIGJ5IGZ1bmN0aW9ucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgbG9ja2VkQmFsYW5jZXM7CgogICAgLy8vIGNsYWltIGZsYWcKICAgIGJvb2wgcHVibGljIGNsYWltZWRGbGFnOyAgCgogICAgLyoKICAgICAqIE1PRElGSUVSUwogICAgICovCiAgICBtb2RpZmllciBvbmx5TWludGVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWludGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbkNsYWltZWQgewogICAgICAgIHJlcXVpcmUoY2xhaW1lZEZsYWcgPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtYXhUb2tlbkFtb3VudE5vdFJlYWNoZWQgKHVpbnQgYW1vdW50KXsKICAgICAgICByZXF1aXJlKGN1cnJlbnRTdXBwbHkuYWRkKGFtb3VudCkgPD0gdG90YWxTdXBwbHkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKCBhZGRyZXNzIGFkZHIgKSB7CiAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3MoMHgwKSk7CiAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBDT05TVFJVQ1RPUiAKICAgICAqIAogICAgICogQGRldiBJbml0aWFsaXplIHRoZSBTZWVsZSBUb2tlbgogICAgICogQHBhcmFtIF9taW50ZXIgVGhlIFNlZWxlQ3Jvd2RTYWxlIENvbnRyYWN0IAogICAgICogQHBhcmFtIF9tYXhUb3RhbFN1cHBseSB0b3RhbCBzdXBwbHkgdG9rZW4gICAgCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNlZWxlVG9rZW4oYWRkcmVzcyBfbWludGVyLCBhZGRyZXNzIF9hZG1pbiwgdWludCBfbWF4VG90YWxTdXBwbHkpIAogICAgICAgIHB1YmxpYyAKICAgICAgICB2YWxpZEFkZHJlc3MoX2FkbWluKQogICAgICAgIHZhbGlkQWRkcmVzcyhfbWludGVyKQogICAgICAgIHsKICAgICAgICBtaW50ZXIgPSBfbWludGVyOwogICAgICAgIHRvdGFsU3VwcGx5ID0gX21heFRvdGFsU3VwcGx5OwogICAgICAgIGNsYWltZWRGbGFnID0gZmFsc2U7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICB0cmFuc2Zlck93bmVyc2hpcChfYWRtaW4pOwogICAgfQoKICAgIC8qKgogICAgICogRVhURVJOQUwgRlVOQ1RJT04gCiAgICAgKiAKICAgICAqIEBkZXYgU2VlbGVDcm93ZFNhbGUgY29udHJhY3QgaW5zdGFuY2UgbWludCB0b2tlbgogICAgICogQHBhcmFtIHJlY2VpcGVudCBUaGUgZGVzdGluYXRpb24gYWNjb3VudCBvd25lZCBtaW50IHRva2VucyAgICAKICAgICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiBtaW50IHRva2VuCiAgICAgKiBAcGFyYW0gaXNMb2NrIExvY2sgdG9rZW4gZmxhZwogICAgICogYmUgc2VudCB0byB0aGlzIGFkZHJlc3MuCiAgICAgKi8KCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgcmVjZWlwZW50LCB1aW50IGFtb3VudCwgYm9vbCBpc0xvY2spCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5TWludGVyCiAgICAgICAgbWF4VG9rZW5BbW91bnROb3RSZWFjaGVkKGFtb3VudCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChpc0xvY2sgKSB7CiAgICAgICAgICAgIGxvY2tlZEJhbGFuY2VzW3JlY2VpcGVudF0gPSBsb2NrZWRCYWxhbmNlc1tyZWNlaXBlbnRdLmFkZChhbW91bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJhbGFuY2VzW3JlY2VpcGVudF0gPSBiYWxhbmNlc1tyZWNlaXBlbnRdLmFkZChhbW91bnQpOwogICAgICAgIH0KICAgICAgICBjdXJyZW50U3VwcGx5ID0gY3VycmVudFN1cHBseS5hZGQoYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgZnVuY3Rpb24gc2V0Q2xhaW1lZEZsYWcoYm9vbCBmbGFnKSAKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIgCiAgICB7CiAgICAgICAgY2xhaW1lZEZsYWcgPSBmbGFnOwogICAgfQoKICAgICAvKgogICAgICogUFVCTElDIEZVTkNUSU9OUwogICAgICovCgogICAgLy8vIEBkZXYgTG9ja2luZyBwZXJpb2QgaGFzIHBhc3NlZCAtIExvY2tlZCB0b2tlbnMgaGF2ZSB0dXJuZWQgaW50byB0cmFkZWFibGUKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3NbXSByZWNlaXBlbnRzKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgY2FuQ2xhaW1lZAogICAgeyAgICAgICAgCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmVjZWlwZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIHJlY2VpcGVudCA9IHJlY2VpcGVudHNbaV07CiAgICAgICAgICAgIGJhbGFuY2VzW3JlY2VpcGVudF0gPSBiYWxhbmNlc1tyZWNlaXBlbnRdLmFkZChsb2NrZWRCYWxhbmNlc1tyZWNlaXBlbnRdKTsKICAgICAgICAgICAgbG9ja2VkQmFsYW5jZXNbcmVjZWlwZW50XSA9IDA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFpcmRyb3AoYWRkcmVzc1tdIHJlY2VpcGVudHMsIHVpbnRbXSB0b2tlbnMpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsgICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJlY2VpcGVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyByZWNlaXBlbnQgPSByZWNlaXBlbnRzW2ldOwogICAgICAgICAgICB1aW50IHRva2VuID0gdG9rZW5zW2ldOwogICAgICAgICAgICBpZihiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSB0b2tlbiApewogICAgICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIodG9rZW4pOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbcmVjZWlwZW50XSA9IGJhbGFuY2VzW3JlY2VpcGVudF0uYWRkKHRva2VuKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL1NlZWxlQ3Jvd2RTYWxlLnNvbAoKLy8vIEB0aXRsZSBTZWVsZUNyb3dkU2FsZSBDb250cmFjdAovLy8gRm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyB0b2tlbiBzYWxlLCBwbGVhc2UgdmlzaXQgaHR0cHM6Ly9zZWVsZS5wcm8KLy8vIEBhdXRob3IgcmVlZGhvbmcKY29udHJhY3QgU2VlbGVDcm93ZFNhbGUgaXMgUGF1c2FibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgLy8vIENvbnN0YW50IGZpZWxkcwogICAgLy8vIHNlZWxlIHRvdGFsIHRva2VucyBzdXBwbHkKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFNFRUxFX1RPVEFMX1NVUFBMWSA9IDEwMDAwMDAwMDAgZXRoZXI7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfU0FMRV9EVVJBVElPTiA9IDQgZGF5czsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUdFXzFfVElNRSA9ICA2IGhvdXJzOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfMl9USU1FID0gMTIgaG91cnM7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNSU5fTElNSVQgPSAwLjEgZXRoZXI7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfU1RBR0VfMV9MSU1JVCA9IDEgZXRoZXI7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfU1RBR0VfMl9MSU1JVCA9IDIgZXRoZXI7CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfMSA9IDE7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBTVEFHRV8yID0gMjsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUdFXzMgPSAzOwoKCiAgICAvLy8gRXhjaGFuZ2UgcmF0ZXMKICAgIHVpbnQgcHVibGljICBleGNoYW5nZVJhdGUgPSAxMjUwMDsKCgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUlORVJfU1RBS0UgPSAzMDAwOyAgICAvLyBmb3IgbWludGVyCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBPUEVOX1NBTEVfU1RBS0UgPSA2MjU7IC8vIGZvciBwdWJsaWMKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE9USEVSX1NUQUtFID0gNjM3NTsgICAgLy8gZm9yIG90aGVycwoKICAgIAogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRElWSVNPUl9TVEFLRSA9IDEwMDAwOwoKICAgIC8vIG1heCBvcGVuIHNhbGUgdG9rZW5zCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfT1BFTl9TT0xEID0gU0VFTEVfVE9UQUxfU1VQUExZICogT1BFTl9TQUxFX1NUQUtFIC8gRElWSVNPUl9TVEFLRTsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUtFX01VTFRJUExJRVIgPSBTRUVMRV9UT1RBTF9TVVBQTFkgLyBESVZJU09SX1NUQUtFOwoKICAgIC8vLyBBbGwgZGVwb3NpdGVkIEVUSCB3aWxsIGJlIGluc3RhbnRseSBmb3J3YXJkZWQgdG8gdGhpcyBhZGRyZXNzLgogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgbWluZXJBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgb3RoZXJBZGRyZXNzOwoKICAgIC8vLyBDb250cmlidXRpb24gc3RhcnQgdGltZQogICAgdWludCBwdWJsaWMgc3RhcnRUaW1lOwogICAgLy8vIENvbnRyaWJ1dGlvbiBlbmQgdGltZQogICAgdWludCBwdWJsaWMgZW5kVGltZTsKCiAgICAvLy8gRmllbGRzIHRoYXQgY2FuIGJlIGNoYW5nZWQgYnkgZnVuY3Rpb25zCiAgICAvLy8gQWNjdW11bGF0b3IgZm9yIG9wZW4gc29sZCB0b2tlbnMKICAgIHVpbnQgcHVibGljIG9wZW5Tb2xkVG9rZW5zOwogICAgLy8vIEVSQzIwIGNvbXBpbGFudCBzZWVsZSB0b2tlbiBjb250YWN0IGluc3RhbmNlCiAgICBTZWVsZVRva2VuIHB1YmxpYyBzZWVsZVRva2VuOyAKCiAgICBTZWVsZVRva2VuIHB1YmxpYyBvbGRTZWVsZVRva2VuOwoKICAgIC8vLyB0YWdzIHNob3cgYWRkcmVzcyBjYW4gam9pbiBpbiBvcGVuIHNhbGUKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGZ1bGxXaGl0ZUxpc3Q7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdmlzdEZsYWdMaXN0OwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGZpcnN0U3RhZ2VGdW5kOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgc2Vjb25kU3RhZ2VGdW5kOwoKICAgIC8qCiAgICAgKiBFVkVOVFMKICAgICAqLwogICAgZXZlbnQgTmV3U2FsZShhZGRyZXNzIGluZGV4ZWQgZGVzdEFkZHJlc3MsIHVpbnQgZXRoQ29zdCwgdWludCBnb3RUb2tlbnMpOwogICAgZXZlbnQgTmV3V2FsbGV0KGFkZHJlc3Mgb253ZXIsIGFkZHJlc3Mgb2xkV2FsbGV0LCBhZGRyZXNzIG5ld1dhbGxldCk7CgogICAgbW9kaWZpZXIgbm90RWFybGllclRoYW4odWludCB4KSB7CiAgICAgICAgcmVxdWlyZShub3cgPj0geCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBlYXJsaWVyVGhhbih1aW50IHgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHgpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2VpbGluZ05vdFJlYWNoZWQoKSB7CiAgICAgICAgcmVxdWlyZShvcGVuU29sZFRva2VucyA8IE1BWF9PUEVOX1NPTEQpOwogICAgICAgIF87CiAgICB9ICAKCiAgICBtb2RpZmllciBpc1NhbGVFbmRlZCgpIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGVuZFRpbWUgfHwgb3BlblNvbGRUb2tlbnMgPj0gTUFYX09QRU5fU09MRCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3MoIGFkZHJlc3MgYWRkciApIHsKICAgICAgICByZXF1aXJlKGFkZHIgIT0gYWRkcmVzcygweDApKTsKICAgICAgICByZXF1aXJlKGFkZHIgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBTZWVsZUNyb3dkU2FsZSAoCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0LCAKICAgICAgICBhZGRyZXNzIF9taW5lckFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfb3RoZXJBZGRyZXNzCiAgICAgICAgKSBwdWJsaWMgCiAgICAgICAgdmFsaWRBZGRyZXNzKF93YWxsZXQpIAogICAgICAgIHZhbGlkQWRkcmVzcyhfbWluZXJBZGRyZXNzKSAKICAgICAgICB2YWxpZEFkZHJlc3MoX290aGVyQWRkcmVzcykgCiAgICAgICAgewogICAgICAgIHBhdXNlZCA9IHRydWU7ICAKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgICAgIG1pbmVyQWRkcmVzcyA9IF9taW5lckFkZHJlc3M7CiAgICAgICAgb3RoZXJBZGRyZXNzID0gX290aGVyQWRkcmVzczsgICAgIAoKICAgICAgICBvcGVuU29sZFRva2VucyA9IDA7CiAgICAgICAgLy8vIENyZWF0ZSBzZWVsZSB0b2tlbiBjb250cmFjdCBpbnN0YW5jZQogICAgICAgIHNlZWxlVG9rZW4gPSBuZXcgU2VlbGVUb2tlbih0aGlzLCBtc2cuc2VuZGVyLCBTRUVMRV9UT1RBTF9TVVBQTFkpOwoKICAgICAgICBzZWVsZVRva2VuLm1pbnQobWluZXJBZGRyZXNzLCBNSU5FUl9TVEFLRSAqIFNUQUtFX01VTFRJUExJRVIsIGZhbHNlKTsKICAgICAgICBzZWVsZVRva2VuLm1pbnQob3RoZXJBZGRyZXNzLCBPVEhFUl9TVEFLRSAqIFNUQUtFX01VTFRJUExJRVIsIGZhbHNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRPbGRTZWVsVG9rZW4oYWRkcmVzcyBhZGRyKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIG9sZFNlZWxlVG9rZW4gPSBTZWVsZVRva2VuKGFkZHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEV4Y2hhbmdlUmF0ZSh1aW50MjU2IHJhdGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZWFybGllclRoYW4oZW5kVGltZSkKICAgIHsKICAgICAgICBleGNoYW5nZVJhdGUgPSByYXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFN0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICAgICAgZW5kVGltZSA9IHN0YXJ0VGltZSArIE1BWF9TQUxFX0RVUkFUSU9OOwogICAgfQoKICAgIC8vLyBAZGV2IGJhdGNoIHNldCBxdW90YSBmb3IgdXNlciBhZG1pbgogICAgLy8vIGlmIG9wZW5UYWcgPD0wLCByZW1vdmVkIAogICAgZnVuY3Rpb24gc2V0V2hpdGVMaXN0KGFkZHJlc3NbXSB1c2VycywgYm9vbCBvcGVuVGFnKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZWFybGllclRoYW4oZW5kVGltZSkKICAgIHsKICAgICAgICByZXF1aXJlKHNhbGVOb3RFbmQoKSk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdXNlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyByZWNlaXBpZW50ID0gdXNlcnNbaV07CiAgICAgICAgICAgIGJvb2wgdmlzaXRGbGFnID0gdmlzdEZsYWdMaXN0W3JlY2VpcGllbnRdOwogICAgICAgICAgICBpZiggb3BlblRhZyA9PSB0cnVlICYmIHZpc2l0RmxhZyA9PSBmYWxzZSl7CiAgICAgICAgICAgICAgICB1aW50IHRva2VuID0gb2xkU2VlbGVUb2tlbi5sb2NrZWRCYWxhbmNlcyhyZWNlaXBpZW50KTsKICAgICAgICAgICAgICAgIGlmKCB0b2tlbiA+IDApewogICAgICAgICAgICAgICAgICAgIHNlZWxlVG9rZW4ubWludChyZWNlaXBpZW50LCB0b2tlbix0cnVlKTsKICAgICAgICAgICAgICAgICAgICBvcGVuU29sZFRva2VucyA9IG9wZW5Tb2xkVG9rZW5zLmFkZCh0b2tlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2aXN0RmxhZ0xpc3RbcmVjZWlwaWVudF0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bGxXaGl0ZUxpc3RbcmVjZWlwaWVudF0gPSBvcGVuVGFnOwogICAgICAgIH0KICAgIH0KCgogICAgLy8vIEBkZXYgYmF0Y2ggc2V0IHF1b3RhIGZvciBlYXJseSB1c2VyIHF1b3RhCiAgICAvLy8gaWYgb3BlblRhZyA8PTAsIHJlbW92ZWQgCiAgICBmdW5jdGlvbiBhZGRXaGl0ZUxpc3QoYWRkcmVzcyB1c2VyLCBib29sIG9wZW5UYWcpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgICAgICBlYXJsaWVyVGhhbihlbmRUaW1lKQogICAgewogICAgICAgIHJlcXVpcmUoc2FsZU5vdEVuZCgpKTsKICAgICAgICBmdWxsV2hpdGVMaXN0W3VzZXJdID0gb3BlblRhZzsKCiAgICB9CgogICAgLy8vIEBkZXYgRW1lcmdlbmN5IHNpdHVhdGlvbgogICAgZnVuY3Rpb24gc2V0V2FsbGV0KGFkZHJlc3MgbmV3QWRkcmVzcykgIGV4dGVybmFsIG9ubHlPd25lciB7IAogICAgICAgIE5ld1dhbGxldChvd25lciwgd2FsbGV0LCBuZXdBZGRyZXNzKTsKICAgICAgICB3YWxsZXQgPSBuZXdBZGRyZXNzOyAKICAgIH0KCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHNhbGUgbm90IGVuZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICBmdW5jdGlvbiBzYWxlTm90RW5kKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBub3cgPCBlbmRUaW1lICYmIG9wZW5Tb2xkVG9rZW5zIDwgTUFYX09QRU5fU09MRDsKICAgIH0KCiAgICAvKioKICAgICAqIEZhbGxiYWNrIGZ1bmN0aW9uIAogICAgICogCiAgICAgKiBAZGV2IElmIGFueWJvZHkgc2VuZHMgRXRoZXIgZGlyZWN0bHkgdG8gdGhpcyAgY29udHJhY3QsIGNvbnNpZGVyIGhlIGlzIGdldHRpbmcgc2VlbGUgdG9rZW4KICAgICAqLwogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGJ1eVNlZWxlKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8qCiAgICAgKiBQVUJMSUMgRlVOQ1RJT05TCiAgICAgKi8KICAgIC8vLyBAZGV2IEV4Y2hhbmdlIG1zZy52YWx1ZSBldGhlciB0byBTZWVsZSBmb3IgYWNjb3VudCByZWNlcGllbnQKICAgIC8vLyBAcGFyYW0gcmVjZWlwaWVudCBTZWVsZSB0b2tlbnMgcmVjZWl2ZXIKICAgIGZ1bmN0aW9uIGJ1eVNlZWxlKGFkZHJlc3MgcmVjZWlwaWVudCkgCiAgICAgICAgaW50ZXJuYWwgCiAgICAgICAgd2hlbk5vdFBhdXNlZCAgCiAgICAgICAgY2VpbGluZ05vdFJlYWNoZWQgCiAgICAgICAgbm90RWFybGllclRoYW4oc3RhcnRUaW1lKQogICAgICAgIGVhcmxpZXJUaGFuKGVuZFRpbWUpCiAgICAgICAgdmFsaWRBZGRyZXNzKHJlY2VpcGllbnQpCiAgICAgICAgcmV0dXJucyAoYm9vbCkgCiAgICB7CiAgICAgICAgLy8gRG8gbm90IGFsbG93IGNvbnRyYWN0cyB0byBnYW1lIHRoZSBzeXN0ZW0KICAgICAgICByZXF1aXJlKCFpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKTsgICAgCiAgICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSAxMDAwMDAwMDAwMDAgd2VpKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBNSU5fTElNSVQpOwoKICAgICAgICBib29sIGluV2hpdGVMaXN0VGFnID0gZnVsbFdoaXRlTGlzdFtyZWNlaXBpZW50XTsgICAgICAgCiAgICAgICAgcmVxdWlyZShpbldoaXRlTGlzdFRhZyA9PSB0cnVlKTsKCiAgICAgICAgdWludCBzdGFnZSA9IFNUQUdFXzM7CiAgICAgICAgaWYgKCBzdGFydFRpbWUgPD0gbm93ICYmIG5vdyA8IHN0YXJ0VGltZSArIFNUQUdFXzFfVElNRSApIHsKICAgICAgICAgICAgc3RhZ2UgPSBTVEFHRV8xOwogICAgICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA8PSBNQVhfU1RBR0VfMV9MSU1JVCk7CiAgICAgICAgICAgIHVpbnQgZnVuZDEgPSBmaXJzdFN0YWdlRnVuZFtyZWNlaXBpZW50XTsKICAgICAgICAgICAgcmVxdWlyZSAoZnVuZDEgPCBNQVhfU1RBR0VfMV9MSU1JVCApOwogICAgICAgIH1lbHNlIGlmICggc3RhcnRUaW1lICsgU1RBR0VfMV9USU1FIDw9IG5vdyAmJiBub3cgPCBzdGFydFRpbWUgKyBTVEFHRV8yX1RJTUUgKSB7CiAgICAgICAgICAgIHN0YWdlID0gU1RBR0VfMjsKICAgICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPD0gTUFYX1NUQUdFXzJfTElNSVQpOwogICAgICAgICAgICB1aW50IGZ1bmQyID0gc2Vjb25kU3RhZ2VGdW5kW3JlY2VpcGllbnRdOwogICAgICAgICAgICByZXF1aXJlIChmdW5kMiA8IE1BWF9TVEFHRV8yX0xJTUlUICk7CiAgICAgICAgfQoKICAgICAgICBkb0J1eShyZWNlaXBpZW50LCBzdGFnZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQGRldiBCdXkgc2VlbGUgdG9rZW4gbm9ybWFsbHkKICAgIGZ1bmN0aW9uIGRvQnV5KGFkZHJlc3MgcmVjZWlwaWVudCwgdWludCBzdGFnZSkgaW50ZXJuYWwgewogICAgICAgIC8vIHByb3RlY3QgcGFydG5lciBxdW90YSBpbiBzdGFnZSBvbmUKICAgICAgICB1aW50IHZhbHVlID0gbXNnLnZhbHVlOwoKICAgICAgICBpZiAoIHN0YWdlID09IFNUQUdFXzEgKSB7CiAgICAgICAgICAgIHVpbnQgZnVuZDEgPSBmaXJzdFN0YWdlRnVuZFtyZWNlaXBpZW50XTsKICAgICAgICAgICAgZnVuZDEgPSBmdW5kMS5hZGQodmFsdWUpOwogICAgICAgICAgICBpZiAoZnVuZDEgPiBNQVhfU1RBR0VfMV9MSU1JVCApIHsKICAgICAgICAgICAgICAgIHVpbnQgcmVmdW5kMSA9IGZ1bmQxLnN1YihNQVhfU1RBR0VfMV9MSU1JVCk7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YihyZWZ1bmQxKTsKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZSBpZiAoIHN0YWdlID09IFNUQUdFXzIgKSB7CiAgICAgICAgICAgIHVpbnQgZnVuZDIgPSBzZWNvbmRTdGFnZUZ1bmRbcmVjZWlwaWVudF07CiAgICAgICAgICAgIGZ1bmQyID0gZnVuZDIuYWRkKHZhbHVlKTsKICAgICAgICAgICAgaWYgKGZ1bmQyID4gTUFYX1NUQUdFXzJfTElNSVQpIHsKICAgICAgICAgICAgICAgIHVpbnQgcmVmdW5kMiA9IGZ1bmQyLnN1YihNQVhfU1RBR0VfMl9MSU1JVCk7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YihyZWZ1bmQyKTsKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kMik7CiAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIHVpbnQgdG9rZW5BdmFpbGFibGUgPSBNQVhfT1BFTl9TT0xELnN1YihvcGVuU29sZFRva2Vucyk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkF2YWlsYWJsZSA+IDApOwogICAgICAgIHVpbnQgdG9GdW5kOwogICAgICAgIHVpbnQgdG9Db2xsZWN0OwogICAgICAgICh0b0Z1bmQsIHRvQ29sbGVjdCkgPSBjb3N0QW5kQnV5VG9rZW5zKHRva2VuQXZhaWxhYmxlLCB2YWx1ZSk7CiAgICAgICAgaWYgKHRvRnVuZCA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShzZWVsZVRva2VuLm1pbnQocmVjZWlwaWVudCwgdG9Db2xsZWN0LHRydWUpKTsgICAgICAgICAKICAgICAgICAgICAgd2FsbGV0LnRyYW5zZmVyKHRvRnVuZCk7CiAgICAgICAgICAgIG9wZW5Tb2xkVG9rZW5zID0gb3BlblNvbGRUb2tlbnMuYWRkKHRvQ29sbGVjdCk7CiAgICAgICAgICAgIE5ld1NhbGUocmVjZWlwaWVudCwgdG9GdW5kLCB0b0NvbGxlY3QpOyAgICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIC8vIG5vdCBlbm91Z2ggdG9rZW4gc2FsZSwganVzdCByZXR1cm4gZXRoCiAgICAgICAgdWludCB0b1JldHVybiA9IHZhbHVlLnN1Yih0b0Z1bmQpOwogICAgICAgIGlmICh0b1JldHVybiA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih0b1JldHVybik7CiAgICAgICAgfQoKICAgICAgICBpZiAoIHN0YWdlID09IFNUQUdFXzEgKSB7CiAgICAgICAgICAgIGZpcnN0U3RhZ2VGdW5kW3JlY2VpcGllbnRdID0gZmlyc3RTdGFnZUZ1bmRbcmVjZWlwaWVudF0uYWRkKHRvRnVuZCk7CiAgICAgICAgfWVsc2UgaWYgKCBzdGFnZSA9PSBTVEFHRV8yICkgewogICAgICAgICAgICBzZWNvbmRTdGFnZUZ1bmRbcmVjZWlwaWVudF0gPSBzZWNvbmRTdGFnZUZ1bmRbcmVjZWlwaWVudF0uYWRkKHRvRnVuZCk7ICAgICAgICAgIAogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBVdGlsaXR5IGZ1bmN0aW9uIGZvciBjYWxjdWxhdGUgYXZhaWxhYmxlIHRva2VucyBhbmQgY29zdCBldGhlcnMKICAgIGZ1bmN0aW9uIGNvc3RBbmRCdXlUb2tlbnModWludCBhdmFpbGFibGVUb2tlbiwgdWludCB2YWx1ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCBjb3N0VmFsdWUsIHVpbnQgZ2V0VG9rZW5zKSB7CiAgICAgICAgLy8gYWxsIGNvbmRpdGlvbnMgaGFzIGNoZWNrZWQgaW4gdGhlIGNhbGxlciBmdW5jdGlvbnMKICAgICAgICBnZXRUb2tlbnMgPSBleGNoYW5nZVJhdGUgKiB2YWx1ZTsKCiAgICAgICAgaWYgKGF2YWlsYWJsZVRva2VuID49IGdldFRva2VucykgewogICAgICAgICAgICBjb3N0VmFsdWUgPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb3N0VmFsdWUgPSBhdmFpbGFibGVUb2tlbiAvIGV4Y2hhbmdlUmF0ZTsKICAgICAgICAgICAgZ2V0VG9rZW5zID0gYXZhaWxhYmxlVG9rZW47CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemUgPiAwOwogICAgfQp9'.
	

]
