Class {
	#name : #SRTe18c9465e6ed5cb3c58a316b990e0d17fb946eca,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe18c9465e6ed5cb3c58a316b990e0d17fb946eca >> base64 [
	^ 'Ly8gVkVSU0lPTiBLCgpwcmFnbWEgc29saWRpdHkgXjAuNC44OwoKCi8vCi8vIEZPUiBSRUZFUkVOQ0UgLSBJTkNMVURFICBpRTRSb3dFc2Nyb3cgIChpbnRlcmZhY2UpIENPTlRSQUNUIGF0IHRoZSB0b3AgLi4uLi4KLy8KCmNvbnRyYWN0IGlFNFJvd0VzY3JvdyB7CglmdW5jdGlvbiBnZXROdW1HYW1lc1N0YXJ0ZWQoKSBjb25zdGFudCByZXR1cm5zIChpbnQgbmdhbWVzKTsKfQoKLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBBQlNUUkFDVCBzdGFuZGFyZCB0b2tlbiBjbGFzcwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgVG9rZW4geyAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIEU0Um93UmV3YXJkcyAtIGFic3RyYWN0IGU0IGRpdmlkZW5kIGNvbnRyYWN0Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEU0Um93UmV3YXJkcwp7CglmdW5jdGlvbiBjaGVja0RpdmlkZW5kcyhhZGRyZXNzIF9hZGRyKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2Ftb3VudCk7CglmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IG5hbW91bnQpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgRmlubmV5IENoaXAgLSB0b2tlbiBjb250cmFjdAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBFNFRva2VuIGlzIFRva2VuLCBFNFJvd1Jld2FyZHMgewogICAgCWV2ZW50IFN0YXRFdmVudChzdHJpbmcgbXNnKTsKICAgIAlldmVudCBTdGF0RXZlbnRJKHN0cmluZyBtc2csIHVpbnQgdmFsKTsKCgllbnVtIFNldHRpbmdTdGF0ZVZhbHVlICB7ZGVidWcsIHJlbGVhc2UsIGxvY2tlZFJlbGVhc2V9CgllbnVtIEljb1N0YXR1c1ZhbHVlIHthbm91bmNlbWVudCwgc2FsZU9wZW4sIHNhbGVDbG9zZWQsIGZhaWxlZCwgc3VjY2VlZGVkfQoKCgoKCXN0cnVjdCB0b2tlbkFjY291bnQgewoJCWJvb2wgYWxsb2NlZDsgLy8gZmxhZyB0byBhc2NlcnQgcHJpb3IgYWxsb2NhdGlvbgoJCXVpbnQgdG9rZW5zOyAvLyBudW0gdG9rZW5zCgkJdWludCBiYWxhbmNlOyAvLyByZXdhcmRzIGJhbGFuY2UKCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIGRhdGEgc3RvcmFnZQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglhZGRyZXNzIGRldmVsb3BlcnM7IC8vIGRldmVsb3BlcnMgdG9rZW4gaG9sZGluZyBhZGRyZXNzCglhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy8gZGVwbG95ZXIgZXhlY3V0b3IKCWFkZHJlc3MgZm91bmRlck9yZzsgLy8gZm91bmRlciBvcmdpbmFpemF0aW9uIGNvbnRyYWN0CglhZGRyZXNzIGF1eFBhcnRuZXI7IC8vIGF1eCBwYXJ0bmVyIChwci9hdWRpdGluZykgLSAxIHBlcmNlbnQgdXBvbiBjbG9zZQoJYWRkcmVzcyBlNF9wYXJ0bmVyOyAvLyBlNHJvdyAgY29udHJhY3QgYWRkcmVzc2VzCgoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdG9rZW5BY2NvdW50KSBob2xkZXJBY2NvdW50cyA7IC8vIHdobyBob2xkcyBob3cgbWFueSB0b2tlbnMgKGhpZ2ggdHdvIGJ5dGVzIGNvbnRhaW4gY3VyUGF5SWQpCgltYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpIGhvbGRlckluZGV4ZXMgOyAvLyBmb3IgaXRlcmF0aW9uIHRocnUgaG9sZGVyCgl1aW50IG51bUFjY291bnRzOwoKCXVpbnQgcGFydG5lckNyZWRpdHM7IC8vIGFtb3VudCBwYXJ0bmVyIChlNHJvdykgIGhhcyBwYWlkCgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7IC8vIGFwcHJvdmFscwoKCgl1aW50IG1heE1pbnRhYmxlVG9rZW5zOyAvLyAuLi4KCXVpbnQgbWluSWNvVG9rZW5Hb2FsOy8vIHRva2VuIGdvYWwgYnkgc2FsZSBlbmQKCXVpbnQgbWluVXNhZ2VHb2FsOyAvLyAgbnVtIGdhbWVzIGdvYWwgYnkgdXNhZ2UgZGVhZGxpbmUKCXVpbnQgcHVibGljICB0b2tlblByaWNlOyAvLyBwcmljZSBwZXIgdG9rZW4KCXVpbnQgcHVibGljIHBheW91dFRocmVzaG9sZDsgLy8gdGhyZXNob2xkIHRpbGwgcGF5b3V0CgoJdWludCB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZDsgCS8vIHJ1bm5pbmcgdG90YWwgb2YgdG9rZW4gZnVuZHMgcmVjZWl2ZWQKCXVpbnQgcHVibGljIHRvdGFsVG9rZW5zTWludGVkOyAJLy8gdG90YWwgbnVtYmVyIG9mIHRva2VucyBtaW50ZWQKCXVpbnQgcHVibGljIGhvbGRvdmVyQmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwdWJsaWMgcGF5b3V0QmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwck9yaWdQYXlvdXRCYWw7CQkJLy8gb3JpZ2luYWwgcGF5b3V0IGJhbGFuY2UgYmVmb3JlIHJ1bgoJdWludCBwck9yaWdUb2tlbnNNaW50OyAJCQkvLyB0b2tlbnMgbWludGVkIGF0IHN0YXJ0IG9mIHBheSBydW4KCXVpbnQgcHVibGljIGN1clBheW91dElkOwkJLy8gY3VycmVudCBwYXlvdXQgaWQKCXVpbnQgcHVibGljIGxhc3RQYXlvdXRJbmRleDsJCS8vIHBheW91dCBpZHggYmV0d2VlbiBydW4gc2VnbWVudHMKCXVpbnQgcHVibGljIG1heFBheXNQZXI7CQkJLy8gbnVtIHBheXMgcGVyIHNlZ21lbnQKCXVpbnQgcHVibGljIG1pblBheUludGVydmFsOwkJLy8gbWluIGludGVydmFsIGJldHdlZW4gc3RhcnQgcGF5IHJ1bgoKCgl1aW50IGZ1bmRpbmdTdGFydDsgCQkvLyBmdW5kaW5nIHN0YXJ0IHRpbWUgaW1tZWRpYXRlbHkgYWZ0ZXIgYW5vdW5jZW1lbnQKCXVpbnQgZnVuZGluZ0RlYWRsaW5lOyAJCS8vIGZ1bmRpbmcgZW5kIHRpbWUKCXVpbnQgdXNhZ2VEZWFkbGluZTsgCQkvLyBkZWFkbGluZSB3aGVyZSBtaW5pbXVtIHVzYWdlIG5lZWRzIHRvIGJlIG1ldCBiZWZvcmUgY29uc2lkZXJlZCBzdWNjZXNzCgl1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgCS8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lCgl1aW50IHZlc3RUaW1lOyAJCS8vIDEgeWVhciBwYXN0IHNhbGUgdmVzdCBkZXZlbG9wZXIgdG9rZW5zCgl1aW50IG51bURldlRva2VuczsgCS8vIDEwIHBlciBjZW50IG9mIHRva2VucyBhZnRlciBjbG9zZSB0byBkZXZlbG9wZXJzCglib29sIGRldmVsb3BlcnNHcmFudGVkOyAJCS8vIGZsYWcKCXVpbnQgcmVtdW5lcmF0aW9uU3RhZ2U7IAkvLyAwIGZvciBub3QgeWV0LCAxIGZvciAxMCBwZXJjZW50LCAyIGZvciByZW1haW5pbmcgIHVwb24gc3VjY2VlZGVkLgoJdWludCBwdWJsaWMgcmVtdW5lcmF0aW9uQmFsYW5jZTsgCS8vIHJlbXVuZXJhdGlvbiBiYWxhbmNlIHRvIHJlbGVhc2UgdG9rZW4gZnVuZHMKCXVpbnQgYXV4UGFydG5lckJhbGFuY2U7IAkvLyBhdXggcGFydG5lciBiYWxhbmNlIC0gMSBwZXJjZW50Cgl1aW50IHJtR2FzOyAvLyByZW11bmVyYXRpb24gZ2FzCgl1aW50IHJ3R2FzOyAvLyByZXdhcmQgZ2FzCgl1aW50IHJmR2FzOyAvLyByZWZ1bmQgZ2FzCgoJSWNvU3RhdHVzVmFsdWUgaWNvU3RhdHVzOyAgLy8gY3VycmVudCBzdGF0dXMgb2YgaWNvCglTZXR0aW5nU3RhdGVWYWx1ZSBwdWJsaWMgc2V0dGluZ3NTdGF0ZTsKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNvbnRyYWN0IGNvbnN0cnVjdG9yCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gRTRUb2tlbigpIAoJewoJCW93bmVyID0gbXNnLnNlbmRlcjsKCQlkZXZlbG9wZXJzID0gbXNnLnNlbmRlcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gdXNlIHRoaXMgdG8gcmVzZXQgZXZlcnl0aGluZywgd2lsbCBuZXZlciBiZSBjYWxsZWQgYWZ0ZXIgbG9ja1JlbGVhc2UKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIHFTdGF0ZSwgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfbWluVXNhZ2UsIHVpbnQgX3Rva0dvYWwsIHVpbnQgIF9tYXhNaW50YWJsZSwgdWludCBfdGhyZXNob2xkLCB1aW50IF9wcmljZSwgdWludCBfbXBwLCB1aW50IF9tcGkgKQoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyKSAKCQkJcmV0dXJuOwoKCQkvLyB0aGVzZSBzZXR0aW5ncyBhcmUgcGVybWFuZW50bHkgdHdlYWthYmxlIGZvciBwZXJmb3JtYW5jZSBhZGp1c3RtZW50cwoJCXBheW91dFRocmVzaG9sZCA9IF90aHJlc2hvbGQ7CgkJbWF4UGF5c1BlciA9IF9tcHA7CgkJbWluUGF5SW50ZXJ2YWwgPSBfbXBpOwoKCQkvLyB0aGlzIGZpcnN0IHRlc3QgY2hlY2tzIGlmIGFscmVhZHkgbG9ja2VkCgkJaWYgKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJcmV0dXJuOwoKIAkgCXNldHRpbmdzU3RhdGUgPSBxU3RhdGU7CgoJCS8vIHRoaXMgc2Vjb25kIHRlc3QgYWxsb3dzIGxvY2tpbmcgd2l0aG91dCBjaGFuZ2luZyBvdGhlciBwZXJtYW5lbnQgc2V0dGluZ3MKCQkvLyBXQVJOSU5HLCBNQUtFIFNVUkUgWU9VUidSRSBIQVBQWSBXSVRIIEFMTCBTRVRUSU5HUyAKCQkvLyBCRUZPUkUgTE9DS0lORwoKCQlpZiAocVN0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpIHsKCQkJU3RhdEV2ZW50KCJMb2NraW5nISIpOwoJCQlyZXR1cm47CgkJfQoKCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudDsKCgkJcm1HYXMgPSAxMDAwMDA7IC8vIHJlbXVuZXJhdGlvbiBnYXMKCQlyd0dhcyA9IDEwMDAwOyAvLyByZXdhcmQgZ2FzCgkJcmZHYXMgPSAxMDAwMDsgLy8gcmVmdW5kIGdhcwoKCgkJLy8gemVybyBvdXQgYWxsIHRva2VuIGhvbGRlcnMuICAKCQkvLyBsZWF2ZSBhbGxvY2VkIG9uLCBsZWF2ZSBudW0gYWNjb3VudHMKCQkvLyBjYW50IGRlbGV0ZSB0aGVtIGFueXdheXMKCQoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCA+IDApIHsKCQkJZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtQWNjb3VudHM7IGkrKyApIHsKCQkJCWFkZHJlc3MgYSA9IGhvbGRlckluZGV4ZXNbaV07CgkJCQlpZiAoYSAhPSBhZGRyZXNzKDApKSB7CgkJCQkJaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zID0gMDsKCQkJCQlob2xkZXJBY2NvdW50c1thXS5iYWxhbmNlID0gMDsKCQkJCX0KCQkJfQoJCX0KCQkvLyBkbyBub3QgcmVzZXQgbnVtQWNjb3VudHMhCgoJCXRvdGFsVG9rZW5zTWludGVkID0gMDsgLy8gdGhpcyB3aWxsIGVyYXNlCgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgPSAwOyAvLyB0aGlzIHdpbGwgZXJhc2UuCgkJcGFydG5lckNyZWRpdHMgPSAwOyAvLyByZXNldCBhbGwgcGFydG5lciBjcmVkaXRzCgoJCWZ1bmRpbmdTdGFydCA9ICBfc2FsZVN0YXJ0OwoJCWZ1bmRpbmdEZWFkbGluZSA9IF9zYWxlRW5kOwoJCXVzYWdlRGVhZGxpbmUgPSBfdXNhZ2VFbmQ7CgkJbWluVXNhZ2VHb2FsID0gX21pblVzYWdlOwoJCW1pbkljb1Rva2VuR29hbCA9IF90b2tHb2FsOwoJCW1heE1pbnRhYmxlVG9rZW5zID0gX21heE1pbnRhYmxlOwoJCXRva2VuUHJpY2UgPSBfcHJpY2U7CgoJCXZlc3RUaW1lID0gZnVuZGluZ1N0YXJ0ICsgKDM2NSBkYXlzKTsKCQludW1EZXZUb2tlbnMgPSAwOwoJCQoJCWhvbGRvdmVyQmFsYW5jZSA9IDA7CgkJcGF5b3V0QmFsYW5jZSA9IDA7CgkJY3VyUGF5b3V0SWQgPSAxOwoJCWxhc3RQYXlvdXRJbmRleCA9IDA7CgkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAwOwoJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAwOwoJCWF1eFBhcnRuZXJCYWxhbmNlID0gMDsKCQlkZXZlbG9wZXJzR3JhbnRlZCA9IGZhbHNlOwoJCWxhc3RQYXlvdXRUaW1lID0gMDsKCgkJaWYgKHRoaXMuYmFsYW5jZSA+IDApIHsKCQkJaWYgKCFvd25lci5jYWxsLmdhcyhyZkdhcykudmFsdWUodGhpcy5iYWxhbmNlKSgpKQoJCQkJU3RhdEV2ZW50KCJFUlJPUiEiKTsKCQl9CgkJU3RhdEV2ZW50KCJvayIpOwoKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyB0b2tlbnMgaGVsZCByZXNlcnZlIHRoZSB0b3AgdHdvIGJ5dGVzIGZvciB0aGUgcGF5aWQgbGFzdCBwYWlkLgoJLy8gdGhpcyBpcyBzbyBob2xkZXJzIGF0IHRoZSB0b3Agb2YgdGhlIGxpc3QgZG9udCB0cmFuc2ZlciB0b2tlbnMgCgkvLyB0byB0aGVtc2VsdmVzIG9uIHRoZSBib3R0b20gb2YgdGhlIGxpc3QgdGh1cyBzY2FtbWluZyB0aGUgCgkvLyBzeXN0ZW0uIHRoaXMgZnVuY3Rpb24gZGVjb25zdHJ1Y3RzIHRoZSB0b2tlbmhlbGQgdmFsdWUuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldFBheUlkQW5kSGVsZCh1aW50IF90b2tIZWxkKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9wYXlJZCwgdWludCBfaGVsZCkKCXsKCQlfcGF5SWQgPSAoX3Rva0hlbGQgLyAoMiAqKiA0OCkpICYgMHhmZmZmOwoJCV9oZWxkID0gX3Rva0hlbGQgJiAweGZmZmZmZmZmZmZmZjsKCX0KCWZ1bmN0aW9uIGdldEhlbGQodWludCBfdG9rSGVsZCkgaW50ZXJuYWwgIHJldHVybnMgKHVpbnQgX2hlbGQpCgl7CgkJX2hlbGQgPSBfdG9rSGVsZCAmIDB4ZmZmZmZmZmZmZmZmOwoJfQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBhbGxvY2F0ZSBhIG5ldyBhY2NvdW50IGJ5IHNldHRpbmcgYWxsb2MgdG8gdHJ1ZQoJLy8gc2V0IHRoZSB0b3AgdG8gYnl0ZXMgb2YgdG9rZW5zIHRvIGN1ciBwYXkgaWQgdG8gbGVhdmUgb3V0IG9mIGN1cnJlbnQgcm91bmQKCS8vIGFkZCBob2xkZXIgaW5kZXgsIGJ1bXAgdGhlIG51bSBhY2NvdW50cwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhZGRBY2NvdW50KGFkZHJlc3MgX2FkZHIpIGludGVybmFsICB7CgkJaG9sZGVyQWNjb3VudHNbX2FkZHJdLmFsbG9jZWQgPSB0cnVlOwoJCWhvbGRlckFjY291bnRzW19hZGRyXS50b2tlbnMgPSAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoJCWhvbGRlckluZGV4ZXNbbnVtQWNjb3VudHMrK10gPSBfYWRkcjsKCX0KCQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQkVHSU4gRVJDLTIwIGZyb20gU3RhbmRhcmRUb2tlbgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkKCXsKCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuCgkJCXx8IGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudCkKCQkJc3VwcGx5ID0gbWF4TWludGFibGVUb2tlbnM7CgkJZWxzZQoJCQlzdXBwbHkgPSB0b3RhbFRva2Vuc01pbnRlZDsKCX0KCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKCQlpZiAoKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVycykgCgkJCSYmICAobm93IDwgdmVzdFRpbWUpKSB7CgkJCS8vc3RhdEV2ZW50KCJUb2tlbnMgbm90IHlldCB2ZXN0ZWQuIik7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoKCSAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuCgkgICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuCgkgICAgICAgIC8vUmVwbGFjZSB0aGUgaWYgd2l0aCB0aGlzIG9uZSBpbnN0ZWFkLgoJICAgICAgICAvL2lmIChob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGhvbGRlckFjY291bnRzW190b10pIHsKCgkJdmFyIChwaWRGcm9tLCBoZWxkRnJvbSkgPSBnZXRQYXlJZEFuZEhlbGQoaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zKTsKCSAgICAgICAgaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CgoJICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zIC09IF92YWx1ZTsKCgkJICAgIGlmICghaG9sZGVyQWNjb3VudHNbX3RvXS5hbGxvY2VkKSB7CgkJCWFkZEFjY291bnQoX3RvKTsKCQkgICAgfQoKCQkgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7CgkJICAgIGhvbGRlckFjY291bnRzW190b10udG9rZW5zID0gbmV3SGVsZCB8IChwaWRGcm9tICogKDIgKiogNDgpKTsKCSAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9IGVsc2UgeyAKCQkJcmV0dXJuIGZhbHNlOyAKCQl9CiAgICAJfQoKICAgIAlmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCgkJaWYgKChfZnJvbSA9PSBkZXZlbG9wZXJzKSAKCQkJJiYgIChub3cgPCB2ZXN0VGltZSkpIHsKCQkJLy9zdGF0RXZlbnQoIlRva2VucyBub3QgeWV0IHZlc3RlZC4iKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4KICAgICAgICAvL2lmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewoKCQl2YXIgKHBpZEZyb20sIGhlbGRGcm9tKSA9IGdldFBheUlkQW5kSGVsZChob2xkZXJBY2NvdW50c1tfZnJvbV0udG9rZW5zKTsKICAgICAgICAJaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewoJICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbX2Zyb21dLnRva2VucyAtPSBfdmFsdWU7CgoJCSAgICBpZiAoIWhvbGRlckFjY291bnRzW190b10uYWxsb2NlZCkKCQkJYWRkQWNjb3VudChfdG8pOwoKCQkgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7CgoJCSAgICBob2xkZXJBY2NvdW50c1tfdG9dLnRva2VucyA9IG5ld0hlbGQgfCAocGlkRnJvbSAqICgyICoqIDQ4KSk7CgkgICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkgICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0gZWxzZSB7IAoJCSAgICByZXR1cm4gZmFsc2U7IAoJCX0KCX0KCgogICAgCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CgkJLy8gdmFycyBkZWZhdWx0IHRvIDAKCQlpZiAoaG9sZGVyQWNjb3VudHNbX293bmVyXS5hbGxvY2VkKSB7CgkgICAgICAgIAliYWxhbmNlID0gZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfb3duZXJdLnRva2Vucyk7CgkJfSAKICAgIAl9CgogICAgCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIAlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICAJQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgCXJldHVybiB0cnVlOwogICAgCX0KCiAgICAJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAJCXJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBFTkQgRVJDMjAKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAKCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGRlZmF1bHQgcGF5YWJsZSBmdW5jdGlvbi4KCS8vIGlmIHNlbmRlciBpcyBlNHJvdyAgcGFydG5lciwgdGhpcyBpcyBhIHJha2UgZmVlIHBheW1lbnQKCS8vIG90aGVyd2lzZSB0aGlzIGlzIGEgdG9rZW4gcHVyY2hhc2UuCgkvLyB0b2tlbnMgb25seSBwdXJjaGFzZWFibGUgYmV0d2VlbiB0b2tlbmZ1bmRpbmdzdGFydCBhbmQgZW5kCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiAoKSBwYXlhYmxlIHsKCQlpZiAobXNnLnNlbmRlciA9PSBlNF9wYXJ0bmVyKSB7CgkJICAgICBmZWVQYXltZW50KCk7IC8vIGZyb20gZTRyb3cgZ2FtZSBlc2Nyb3cgY29udHJhY3QKCQl9IGVsc2UgewoJCSAgICAgcHVyY2hhc2VUb2tlbigpOwoJCX0KCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcHVyY2hhc2UgdG9rZW4gZnVuY3Rpb24gLSB0b2tlbnMgb25seSBzb2xkIGR1cmluZyBzYWxlIHBlcmlvZCB1cCB1bnRpbCB0aGUgbWF4IHRva2VucwoJLy8gcHVyY2hhc2UgcHJpY2UgaXMgdG9rZW5QcmljZS4gIGFsbCB1bml0cyBpbiB3ZWkuCgkvLyBwdXJjaGFzZXIgd2lsbCBub3QgYmUgaW5jbHVkZWQgaW4gY3VycmVudCBwYXkgcnVuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gcHVyY2hhc2VUb2tlbigpIHBheWFibGUgewoKCQl1aW50IG52YWx1ZSA9IG1zZy52YWx1ZTsgLy8gYmVpbmcgY2FyZWZ1bCB0byBwcmVzZXJ2ZSBtc2cudmFsdWUKCQlhZGRyZXNzIG5wdXJjaGFzZXIgPSBtc2cuc2VuZGVyOwoJCWlmIChudmFsdWUgPCB0b2tlblByaWNlKSAKCQkJdGhyb3c7CgoJCXVpbnQgcXR5ID0gbnZhbHVlL3Rva2VuUHJpY2U7CgkJdXBkYXRlSWNvU3RhdHVzKCk7CgkJaWYgKGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbikgLy8gcHVyY2hhc2UgaXMgY2xvc2VkCgkJCXRocm93OwoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCArIHF0eSA+IG1heE1pbnRhYmxlVG9rZW5zKQoJCQl0aHJvdzsKCQlpZiAoIWhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLmFsbG9jZWQpCgkJCWFkZEFjY291bnQobnB1cmNoYXNlcik7CgkJCgkJLy8gcHVyY2hhc2VyIHdhaXRzIGZvciBuZXh0IHBheXJ1bi4gb3RoZXJ3aXNlIGNhbiBkaXNydXB0IGN1ciBwYXkgcnVuCgkJdWludCBuZXdIZWxkID0gcXR5ICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tucHVyY2hhc2VyXS50b2tlbnMpOwoJCWhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLnRva2VucyA9IG5ld0hlbGQgfCAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoKCQl0b3RhbFRva2Vuc01pbnRlZCArPSBxdHk7CgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgKz0gbnZhbHVlOwoKCQlpZiAodG90YWxUb2tlbnNNaW50ZWQgPT0gbWF4TWludGFibGVUb2tlbnMpIHsKCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZDsKCQkJLy90ZXN0IHVubmVjZXNzYXJ5IC0gIGlmIChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCWRvRGV2ZWxvcGVyR3JhbnQoKTsKCQkJU3RhdEV2ZW50SSgiUHVyY2hhc2VkLEdyYW50ZWQiLCBxdHkpOwoJCX0gZWxzZQoJCQlTdGF0RXZlbnRJKCJQdXJjaGFzZWQiLCBxdHkpOwoKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBhY2NlcHQgcGF5bWVudCBmcm9tIGU0cm93IGNvbnRyYWN0CgkvLyBETyBOT1QgQ0FMTCBUSElTIEZVTkNUSU9OIExFU1QgWU9VIExPU0UgWU9VUiBNT05FWQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmZWVQYXltZW50KCkgcGF5YWJsZSAgCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gZTRfcGFydG5lcikgewoJCQlTdGF0RXZlbnQoImZvcmJpZGRlbiIpOwoJCQlyZXR1cm47IC8vIHRoYW5rIHlvdQoJCX0KCQl1aW50IG5mdmFsdWUgPSBtc2cudmFsdWU7IC8vIHByZXNlcnZlIHZhbHVlIGluIGNhc2UgY2hhbmdlZCBpbiBkZXYgZ3JhbnQKCgkJdXBkYXRlSWNvU3RhdHVzKCk7CgoJCWhvbGRvdmVyQmFsYW5jZSArPSBuZnZhbHVlOwoJCXBhcnRuZXJDcmVkaXRzICs9IG5mdmFsdWU7CgkJU3RhdEV2ZW50SSgiUGF5bWVudCIsIG5mdmFsdWUpOwoKCQlpZiAoaG9sZG92ZXJCYWxhbmNlID4gcGF5b3V0VGhyZXNob2xkCgkJCXx8IHBheW91dEJhbGFuY2UgPiAwKQoJCQlkb1BheW91dChtYXhQYXlzUGVyKTsKCQkKCQoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gc2V0IHRoZSBlNHJvdyBwYXJ0bmVyLCB0aGlzIGlzIG9ubHkgZG9uZSBvbmNlCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHNldEU0Um93UGFydG5lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMJCgl7CgkvLyBPTkxZIG93bmVyIGNhbiBzZXQgYW5kIE9OTFkgT05DRSEgKHVubGVzcyAidW5sb2NrZWQiIGRlYnVnKQoJLy8gb25jZSBpdHMgbG9ja2VkLiBPTkxZIE9OQ0UhCgkJaWYgKG1zZy5zZW5kZXIgPT0gb3duZXIpIHsKCQkJaWYgKChlNF9wYXJ0bmVyID09IGFkZHJlc3MoMCkpIHx8IChzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmRlYnVnKSkgewoJCQkJZTRfcGFydG5lciA9IF9hZGRyOwoJCQkJcGFydG5lckNyZWRpdHMgPSAwOwoJCQkJLy9TdGF0RXZlbnRJKCJFNC1TZXQiLCAwKTsKCQkJfSBlbHNlIHsKCQkJCVN0YXRFdmVudCgiQWxyZWFkeSBTZXQiKTsKCQkJfQoJCX0KCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyByZXR1cm4gdGhlIHRvdGFsIHRva2VucyBwdXJjaGFzZWQKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldE51bVRva2Vuc1B1cmNoYXNlZCgpIGNvbnN0YW50IHJldHVybnModWludCBfcHVyY2hhc2VkKQoJewoJCV9wdXJjaGFzZWQgPSB0b3RhbFRva2Vuc01pbnRlZC1udW1EZXZUb2tlbnM7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcmV0dXJuIHRoZSBudW0gZ2FtZXMgYXMgcmVwb3J0ZWQgZnJvbSB0aGUgZTRyb3cgIGNvbnRyYWN0CgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXROdW1HYW1lcygpIGNvbnN0YW50IHJldHVybnModWludCBfZ2FtZXMpCgl7CgkJLy9fZ2FtZXMgPSAwOwoJCWlmIChlNF9wYXJ0bmVyICE9IGFkZHJlc3MoMCkpIHsKCQkJaUU0Um93RXNjcm93IHBlNCA9IGlFNFJvd0VzY3JvdyhlNF9wYXJ0bmVyKTsKCQkJX2dhbWVzID0gdWludChwZTQuZ2V0TnVtR2FtZXNTdGFydGVkKCkpOwoJCX0gCgkJLy9lbHNlCgkJLy9TdGF0RXZlbnQoIkVtcHR5IEU0Iik7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBnZXQgdGhlIGZvdW5kZXJzLCBhdXhQYXJ0bmVyLCBkZXZlbG9wZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXRTcGVjaWFsQWRkcmVzc2VzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBfZm5kciwgYWRkcmVzcyBfYXV4LCBhZGRyZXNzIF9kZXYsIGFkZHJlc3MgX2U0KQoJewoJCS8vaWYgKF9zZW5kZXIgPT0gb3duZXIpIHsgLy8gbm8gbXNnLnNlbmRlciBvbiBjb25zdGFudCBmdW5jdGlvbnMgYXQgbGVhc3QgaW4gbWV3CgkJCV9mbmRyID0gZm91bmRlck9yZzsKCQkJX2F1eCA9IGF1eFBhcnRuZXI7CgkJCV9kZXYgPSBkZXZlbG9wZXJzOwoJCQlfZTQgID0gZTRfcGFydG5lcjsKCQkvL30KCX0KCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHVwZGF0ZSB0aGUgaWNvIHN0YXR1cwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gdXBkYXRlSWNvU3RhdHVzKCkgcHVibGljCgl7CgkJaWYgKGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5zdWNjZWVkZWQgCgkJCXx8IGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQpCgkJCXJldHVybjsKCQllbHNlIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuYW5vdW5jZW1lbnQpIHsKCQkJaWYgKG5vdyA+IGZ1bmRpbmdTdGFydCAmJiBub3cgPD0gZnVuZGluZ0RlYWRsaW5lKSB7CgkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbjsKCQkJCQoJCQl9IGVsc2UgaWYgKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSkgewoJCQkJLy8gc2hvdWxkIG5vdCBiZSBoZXJlIC0gdGhpcyB3aWxsIGV2ZW50dWFsbHkgZmFpbAoJCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZDsKCQkJfQoJCX0gZWxzZSB7CgkJCXVpbnQgbnVtUCA9IGdldE51bVRva2Vuc1B1cmNoYXNlZCgpOwoJCQl1aW50IG51bUcgPSBnZXROdW1HYW1lcygpOwoJCQlpZiAoKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSAmJiBudW1QIDwgbWluSWNvVG9rZW5Hb2FsKQoJCQkJfHwgKG5vdyA+IHVzYWdlRGVhZGxpbmUgJiYgbnVtRyA8IG1pblVzYWdlR29hbCkpIHsKCQkJCWljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLmZhaWxlZDsKCQkJfSBlbHNlIGlmICgobm93ID4gZnVuZGluZ0RlYWRsaW5lKSAvLyBkb250IHdhbnQgdG8gcHJldmVudCBtb3JlIHRva2VuIHNhbGVzCgkJCQkmJiAobnVtUCA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCQkmJiAobnVtRyA+PSBtaW5Vc2FnZUdvYWwpKSB7CgkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zdWNjZWVkZWQ7IC8vIGhvb3JheQoJCQl9CgkJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4KCQkJCSYmICgobnVtUCA+PSBtYXhNaW50YWJsZVRva2VucykKCQkJCXx8IChub3cgPiBmdW5kaW5nRGVhZGxpbmUpKSkgewoJCQkJCWljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLnNhbGVDbG9zZWQ7CgkJCQl9CgkJfQoKCQlpZiAoIWRldmVsb3BlcnNHcmFudGVkCgkJCSYmIGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbiAKCQkJJiYgaWNvU3RhdHVzICE9IEljb1N0YXR1c1ZhbHVlLmFub3VuY2VtZW50CgkJCSYmIGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkgewoJCQkJZG9EZXZlbG9wZXJHcmFudCgpOyAvLyBncmFudCB3aGVuZXZlciBzdGF0dXMgZ29lcyBmcm9tIG9wZW4gdG8gYW55dGhpbmcuLi4KCQl9CgoJCgl9CgoJCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyByZXF1ZXN0IHJlZnVuZC4gQ2FsbGVyIG11c3QgY2FsbCB0byByZXF1ZXN0IGFuZCByZWNlaXZlIHJlZnVuZCAKCS8vIFdBUk5JTkcgLSB3aXRoZHJhdyByZXdhcmRzL2RpdmlkZW5kcyBiZWZvcmUgY2FsbGluZy4KCS8vIFlPVSBIQVZFIEJFRU4gV0FSTkVECgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiByZXF1ZXN0UmVmdW5kKCkKCXsKCQlhZGRyZXNzIG5yZXF1ZXN0ZXIgPSBtc2cuc2VuZGVyOwoJCXVwZGF0ZUljb1N0YXR1cygpOwoKCQl1aW50IG50b2tlbnMgPSBnZXRIZWxkKGhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLnRva2Vucyk7CgkJaWYgKGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQpCgkJCVN0YXRFdmVudCgiTm8gUmVmdW5kIik7CgkJZWxzZSBpZiAobnRva2VucyA9PSAwKQoJCQlTdGF0RXZlbnQoIk5vIFRva2VucyIpOwoJCWVsc2UgewoJCQl1aW50IG5yZWZ1bmQgPSBudG9rZW5zICogdG9rZW5QcmljZTsKCQkJaWYgKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkKCQkJCW5yZWZ1bmQgLT0gKG5yZWZ1bmQgLzEwKTsgLy8gb25seSA5MCBwZXJjZW50IGIvYyAxMCBwZXJjZW50IHBheW91dAoKCQkJaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10udG9rZW5zICs9IG50b2tlbnM7CgkJCWhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLnRva2VucyA9IDA7CgkJCWlmIChob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS5iYWxhbmNlID4gMCkgewoJCQkJLy8gc2VlIGFib3ZlIHdhcm5pbmchIQoJCQkJaWYgKCFob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS5hbGxvY2VkKSAKCQkJCQlhZGRBY2NvdW50KGRldmVsb3BlcnMpOwoJCQkJaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYmFsYW5jZSArPSBob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS5iYWxhbmNlOwoJCQkJaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0uYmFsYW5jZSA9IDA7CgkJCX0KCgkJCWlmICghbnJlcXVlc3Rlci5jYWxsLmdhcyhyZkdhcykudmFsdWUobnJlZnVuZCkoKSkKCQkJCXRocm93OwoJCQkvL1N0YXRFdmVudEkoIlJlZnVuZGVkIiwgbnJlZnVuZCk7CgkJfQoJfQoKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBwYXlvdXQgcmV3YXJkcyB0byBhbGwgdG9rZW4gaG9sZGVycwoJLy8gdXNlIGEgc2Vjb25kIGhvbGRpbmcgdmFyaWFibGUgY2FsbGVkIFBheW91dEJhbGFuY2UgdG8gZG8gCgkvLyB0aGUgYWN0dWFsIHBheW91dCBmcm9tIGIvYyB0b28gbXVjaCBnYXMgdG8gaXRlcmF0ZSB0aHJ1IAoJLy8gZWFjaCBwYXllZS4gT25seSBzdGFydCBhIG5ldyBydW4gYXQgbW9zdCBvbmNlIHBlciAibWlucGF5aW50ZXJ2YWwiLgoJLy8gSXRzIGRvbmUgaW4gcnVucyBvZiAiX251bVBheXMiCgkvLyB3ZSB1c2Ugc3BlY2lhbCBjb2RpbmcgZm9yIHRoZSBob2xkZXJBY2NvdW50cyB0byBhdm9pZCBhIGhhY2sKCS8vIG9mIGdldHRpbmcgcGFpZCBhdCB0aGUgdG9wIG9mIHRoZSBsaXN0IHRoZW4gdHJhbnNmZXJpbmcgdG9rZW5zCgkvLyB0byBhbm90aGVyIGFkZHJlc3MgYXQgdGhlIGJvdHRvbSBvZiB0aGUgbGlzdC4KCS8vIGJlY2F1c2Ugb2YgdGhhdCBlYWNoIGhvbGRlckFjY291bnRzIGVudHJ5IGdldHMgdGhlIHBheW91dGlkIHN0YW1wZWQgdXBvbiBpdCAodG9wIHR3byBieXRlcykKCS8vIGFsc28gYSB0b2tlbiB0cmFuc2ZlciB3aWxsIHRyYW5zZmVyIHRoZSBwYXlvdXQgaWQuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGRvUGF5b3V0KHVpbnQgX251bVBheXMpICBpbnRlcm5hbAoJewoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCA9PSAwKQoJCQlyZXR1cm47CgoJCWlmICgoaG9sZG92ZXJCYWxhbmNlID4gMCkgCgkJCSYmIChwYXlvdXRCYWxhbmNlID09IDApCgkJCSYmIChub3cgPiAobGFzdFBheW91dFRpbWUrbWluUGF5SW50ZXJ2YWwpKSkgewoJCQkvLyBzdGFydCBhIG5ldyBydW4KCQkJY3VyUGF5b3V0SWQrKzsKCQkJaWYgKGN1clBheW91dElkID49IDMyNzY4KQoJCQkJY3VyUGF5b3V0SWQgPSAxOwoJCQlsYXN0UGF5b3V0VGltZSA9IG5vdzsKCQkJcGF5b3V0QmFsYW5jZSA9IGludChob2xkb3ZlckJhbGFuY2UpOwoJCQlwck9yaWdQYXlvdXRCYWwgPSBwYXlvdXRCYWxhbmNlOwoJCQlwck9yaWdUb2tlbnNNaW50ID0gdG90YWxUb2tlbnNNaW50ZWQ7CgkJCWhvbGRvdmVyQmFsYW5jZSA9IDA7CgkJCWxhc3RQYXlvdXRJbmRleCA9IDA7CgkJCVN0YXRFdmVudEkoIlN0YXJ0UnVuIiwgdWludChjdXJQYXlvdXRJZCkpOwoJCX0gZWxzZSBpZiAocGF5b3V0QmFsYW5jZSA+IDApIHsKCQkJLy8gd29yayBkb3duIHRoZSBwLm8uYgoJCQl1aW50IG5BbW91bnQ7CgkJCXVpbnQgblBlclRva0Rpc3RyaWIgPSB1aW50KHByT3JpZ1BheW91dEJhbCkvcHJPcmlnVG9rZW5zTWludDsKCQkJdWludCBwYWlkcyA9IDA7CgkJCXVpbnQgaTsgLy8gaW50ZW50aW9uYWwKCQkJZm9yIChpID0gbGFzdFBheW91dEluZGV4OyAocGFpZHMgPCBfbnVtUGF5cykgJiYgKGkgPCBudW1BY2NvdW50cykgJiYgKHBheW91dEJhbGFuY2UgPiAwKTsgaSsrICkgewoJCQkJYWRkcmVzcyBhID0gaG9sZGVySW5kZXhlc1tpXTsKCQkJCWlmIChhID09IGFkZHJlc3MoMCkpIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJCXZhciAocGlkLCBoZWxkKSA9IGdldFBheUlkQW5kSGVsZChob2xkZXJBY2NvdW50c1thXS50b2tlbnMpOwoJCQkJaWYgKChoZWxkID4gMCkgJiYgKHBpZCAhPSBjdXJQYXlvdXRJZCkpIHsKCQkJCQluQW1vdW50ID0gblBlclRva0Rpc3RyaWIgKiBoZWxkOwoJCQkJCWlmIChpbnQobkFtb3VudCkgPD0gcGF5b3V0QmFsYW5jZSl7CgkJCQkJCWhvbGRlckFjY291bnRzW2FdLmJhbGFuY2UgKz0gbkFtb3VudDsgCgkJCQkJCWhvbGRlckFjY291bnRzW2FdLnRva2VucyA9IChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSkgfCBoZWxkOwoJCQkJCQlwYXlvdXRCYWxhbmNlIC09IGludChuQW1vdW50KTsJCQkJCQoJCQkJCQlwYWlkcysrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQlsYXN0UGF5b3V0SW5kZXggPSBpOwoJCQlpZiAobGFzdFBheW91dEluZGV4ID49IG51bUFjY291bnRzIHx8IHBheW91dEJhbGFuY2UgPD0gMCkgewoJCQkJbGFzdFBheW91dEluZGV4ID0gMDsKCQkJCWlmIChwYXlvdXRCYWxhbmNlID4gMCkKCQkJCQlob2xkb3ZlckJhbGFuY2UgKz0gdWludChwYXlvdXRCYWxhbmNlKTsvLyBwdXQgYmFjayBhbnkgbGVmdG92ZXJzCgkJCQlwYXlvdXRCYWxhbmNlID0gMDsKCQkJCVN0YXRFdmVudEkoIlJ1bkNvbXBsZXRlIiwgdWludChwck9yaWdQYXlvdXRCYWwpICk7CgoJCQl9IGVsc2UgewoJCQkJU3RhdEV2ZW50SSgiUGF5UnVuIiwgcGFpZHMgKTsKCQkJfQoJCX0KCQkKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gc2VuZGVyIHdpdGhkcmF3IGVudGlyZSByZXdhcmRzL2RpdmlkZW5kcwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gd2l0aGRyYXdEaXZpZGVuZHMoKSBwdWJsaWMgcmV0dXJucyAodWludCBfYW1vdW50KQoJewoJCWlmIChob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlID09IDApIHsgCgkJCS8vX2Ftb3VudCA9IDA7CgkJCVN0YXRFdmVudCgiMCBCYWxhbmNlIik7CgkJCXJldHVybjsKCQl9IGVsc2UgewoJCQlpZiAoKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVycykgCgkJCQkmJiAgKG5vdyA8IHZlc3RUaW1lKSkgewoJCQkJLy9zdGF0RXZlbnQoIlRva2VucyBub3QgeWV0IHZlc3RlZC4iKTsKCQkJCS8vX2Ftb3VudCA9IDA7CgkJCQlyZXR1cm47CgkJCX0KCgkJCV9hbW91bnQgPSBob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlOyAKCQkJaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA9IDA7IAoJCQlpZiAoIW1zZy5zZW5kZXIuY2FsbC5nYXMocndHYXMpLnZhbHVlKF9hbW91bnQpKCkpCgkJCQl0aHJvdzsKCQkJLy9TdGF0RXZlbnRJKCJQYWlkIiwgX2Ftb3VudCk7CgkKCQl9CgoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHNldCBnYXMgZm9yIG9wZXJhdGlvbnMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHNldE9wR2FzKHVpbnQgX3JtLCB1aW50IF9yZiwgdWludCBfcncpCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgbXNnLnNlbmRlciAhPSBkZXZlbG9wZXJzKSB7CgkJCS8vU3RhdEV2ZW50KCJvbmx5IG93bmVyIGNhbGxzIik7CgkJCXJldHVybjsKCQl9IGVsc2UgewoJCQlybUdhcyA9IF9ybTsKCQkJcmZHYXMgPSBfcmY7CgkJCXJ3R2FzID0gX3J3OwoJCX0KCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBnZXQgZ2FzIGZvciBvcGVyYXRpb25zCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXRPcEdhcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgX3JtLCB1aW50IF9yZiwgdWludCBfcncpCgl7CgkJX3JtID0gcm1HYXM7CgkJX3JmID0gcmZHYXM7CgkJX3J3ID0gcndHYXM7Cgl9CiAKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBjaGVjayByZXdhcmRzLiAgcGFzcyBpbiBhZGRyZXNzIG9mIHRva2VuIGhvbGRlcgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hlY2tEaXZpZGVuZHMoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgcmV0dXJucyh1aW50IF9hbW91bnQpCgl7CgkJaWYgKGhvbGRlckFjY291bnRzW19hZGRyXS5hbGxvY2VkKQoJCQlfYW1vdW50ID0gaG9sZGVyQWNjb3VudHNbX2FkZHJdLmJhbGFuY2U7Cgl9CQkKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBpY29DaGVja3VwIC0gY2hlY2sgdXAgY2FsbCBmb3IgYWRtaW5pc3RyYXRvcnMKCS8vIGFmdGVyIHNhbGUgaXMgY2xvc2VkIGlmIG1pbiBpY28gdG9rZW5zIHNvbGQsIDEwIHBlcmNlbnQgd2lsbCBiZSBkaXN0cmlidXRlZCB0byAKCS8vIGNvbXBhbnkgdG8gY292ZXIgdmFyaW91cyBvcGVyYXRpbmcgZXhwZW5zZXMKCS8vIGFmdGVyIHNhbGUgYW5kIHVzYWdlIGRlYWxpbmVzIGhhdmUgYmVlbiBtZXQsIHJlbWFpbmluZyA5MCBwZXJjZW50IHdpbGwgYmUgZGlzdHJpYnV0ZWQgdG8KCS8vIGNvbXBhbnkuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGljb0NoZWNrdXAoKSBwdWJsaWMKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IGRldmVsb3BlcnMpCgkJCXRocm93OwoKCQl1aW50IG5tc2dtYXNrOwoJCS8vbm1zZ21hc2sgPSAwOwoJCgkJaWYgKGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkKSB7CgkJCWlmICgoZ2V0TnVtVG9rZW5zUHVyY2hhc2VkKCkgPj0gbWluSWNvVG9rZW5Hb2FsKQoJCQkJJiYgKHJlbXVuZXJhdGlvblN0YWdlID09IDAgKSkgewoJCQkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAxOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9ICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApKjk7IC8vIDkgcGVyY2VudAoJCQkJYXV4UGFydG5lckJhbGFuY2UgPSAgKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwMCk7IC8vIDEgcGVyY2VudAoJCQkJbm1zZ21hc2sgfD0gMTsKCQkJfSAKCQl9CgkJaWYgKGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5zdWNjZWVkZWQpIHsKCQkKCQkJaWYgKHJlbXVuZXJhdGlvblN0YWdlID09IDAgKSB7CgkJCQlyZW11bmVyYXRpb25TdGFnZSA9IDE7CgkJCQlyZW11bmVyYXRpb25CYWxhbmNlID0gKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwMCkqOTsgCgkJCQlhdXhQYXJ0bmVyQmFsYW5jZSA9ICAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKTsKCQkJCW5tc2dtYXNrIHw9IDQ7CgkJCX0KCQkJaWYgKHJlbXVuZXJhdGlvblN0YWdlID09IDEpIHsgLy8gd2UgaGF2ZSBhbHJlYWR5IHN1Y2VlZGVkCgkJCQlyZW11bmVyYXRpb25TdGFnZSA9IDI7CgkJCQlyZW11bmVyYXRpb25CYWxhbmNlICs9IHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkIC0gKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwKTsgLy8gOTAgcGVyY2VudAoJCQkJbm1zZ21hc2sgfD0gODsKCQkJfQoKCQl9CgoJCXVpbnQgbnRtcDsKCgkJaWYgKHJlbXVuZXJhdGlvbkJhbGFuY2UgPiAwKSB7IAoJCS8vIG9ubHkgcGF5IG9uZSBlbnRpdHkgcGVyIGNhbGwsIGRvbnQgd2FudCB0byBydW4gb3V0IG9mIGdhcwoJCQkJbnRtcCA9IHJlbXVuZXJhdGlvbkJhbGFuY2U7CgkJCQlyZW11bmVyYXRpb25CYWxhbmNlID0gMDsKCQkJCWlmICghZm91bmRlck9yZy5jYWxsLmdhcyhybUdhcykudmFsdWUobnRtcCkoKSkgewoJCQkJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSBudG1wOwoJCQkJCW5tc2dtYXNrIHw9IDMyOwoJCQkJfSBlbHNlIHsKCQkJCQlubXNnbWFzayB8PSA2NDsKCQkJCX0JCgkJfSBlbHNlIAlpZiAoYXV4UGFydG5lckJhbGFuY2UgPiAwKSB7CgkJLy8gbm90ZSB0aGUgImVsc2UiIG9ubHkgcGF5IG9uZSBlbnRpdHkgcGVyIGNhbGwsIGRvbnQgd2FudCB0byBydW4gb3V0IG9mIGdhcwoJCQludG1wID0gYXV4UGFydG5lckJhbGFuY2U7CgkJCWF1eFBhcnRuZXJCYWxhbmNlID0gMDsKCQkJaWYgKCFhdXhQYXJ0bmVyLmNhbGwuZ2FzKHJtR2FzKS52YWx1ZShudG1wKSgpKSB7CgkJCQlhdXhQYXJ0bmVyQmFsYW5jZSA9IG50bXA7CgkJCQlubXNnbWFzayB8PSAxMjg7CgkJCX0gIGVsc2UgewoJCQkJbm1zZ21hc2sgfD0gMjU2OwoJCQl9CgoJCX0gCgkJCgkJU3RhdEV2ZW50SSgiaWNvLWNoZWNrdXAiLCBubXNnbWFzayk7Cgl9CgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHN3YXAgZXhlY3V0b3IKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2FkZHIpIAoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyCgkJCXx8IHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJIHRocm93OwoKCQlvd25lciA9IF9hZGRyOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHN3YXAgZGV2ZWxvcGVycyBhY2NvdW50CgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjaGFuZ2VEZXZldm9wZXJBY2NvbnQoYWRkcmVzcyBfYWRkcikgCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIKCQkJfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQoJCQkgdGhyb3c7CgkJZGV2ZWxvcGVycyA9IF9hZGRyOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNoYW5nZSBmb3VuZGVyCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjaGFuZ2VGb3VuZGVyKGFkZHJlc3MgX2FkZHIpIAoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyCgkJCXx8IHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJIHRocm93OwoJCWZvdW5kZXJPcmcgPSBfYWRkcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBjaGFuZ2UgYXV4UGFydG5lcgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hhbmdlQXV4UGFydG5lcihhZGRyZXNzIF9hdXgpIAoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyCgkJCXx8IHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJIHRocm93OwoJCWF1eFBhcnRuZXIgPSBfYXV4OwoJfQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBERUJVRyBPTkxZIC0gZW5kIHRoaXMgY29udHJhY3QsIHN1aWNpZGUgdG8gZGV2ZWxvcGVycwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gaGFyYUtpcmkoKQoJewoJCWlmIChzZXR0aW5nc1N0YXRlICE9IFNldHRpbmdTdGF0ZVZhbHVlLmRlYnVnKQoJCQl0aHJvdzsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcikKCQkJIHRocm93OwoJCXN1aWNpZGUoZGV2ZWxvcGVycyk7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gZ2V0IGFsbCBpY28gc3RhdHVzLCBmdW5kaW5nIGFuZCB1c2FnZSBpbmZvCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXRJY29JbmZvKCkgY29uc3RhbnQgcmV0dXJucyhJY29TdGF0dXNWYWx1ZSBfc3RhdHVzLCB1aW50IF9zYWxlU3RhcnQsIHVpbnQgX3NhbGVFbmQsIHVpbnQgX3VzYWdlRW5kLCB1aW50IF9zYWxlR29hbCwgdWludCBfdXNhZ2VHb2FsLCB1aW50IF9zb2xkLCB1aW50IF91c2VkLCB1aW50IF9mdW5kcywgdWludCBfY3JlZGl0cywgdWludCBfcmVtdVN0YWdlLCB1aW50IF92ZXN0KQoJewoJCV9zdGF0dXMgPSBpY29TdGF0dXM7CgkJX3NhbGVTdGFydCA9IGZ1bmRpbmdTdGFydDsKCQlfc2FsZUVuZCA9IGZ1bmRpbmdEZWFkbGluZTsKCQlfdXNhZ2VFbmQgPSB1c2FnZURlYWRsaW5lOwoJCV92ZXN0ID0gdmVzdFRpbWU7CgkJX3NhbGVHb2FsID0gbWluSWNvVG9rZW5Hb2FsOwoJCV91c2FnZUdvYWwgPSBtaW5Vc2FnZUdvYWw7CgkJX3NvbGQgPSBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKTsKCQlfdXNlZCA9IGdldE51bUdhbWVzKCk7CgkJX2Z1bmRzID0gdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQ7CgkJX2NyZWRpdHMgPSBwYXJ0bmVyQ3JlZGl0czsKCQlfcmVtdVN0YWdlID0gcmVtdW5lcmF0aW9uU3RhZ2U7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTk9URSEgQ0FMTCBBVCBUSEUgUklTSyBPRiBSVU5OSU5HIE9VVCBPRiBHQVMuCgkvLyBBTllPTkUgQ0FOIENBTEwgVEhJUyBGVU5DVElPTiBCVVQgWU9VIEhBVkUgVE8gU1VQUExZIAoJLy8gVEhFIENPUlJFQ1QgQU1PVU5UIE9GIEdBUyBXSElDSCBNQVkgREVQRU5EIE9OIAoJLy8gVEhFIF9OVU1QQVlTIFBBUkFNRVRFUi4gIFdISUNIIE1VU1QgQkUgQkVUV0VFTiAxIEFORCAxMDAwCgkvLyBUSEUgU1RBTkRBUkQgVkFMVUUgSVMgU1RPUkVEIElOICJtYXhQYXlzUGVyIgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZmx1c2hEaXZpZGVuZHModWludCBfbnVtUGF5cykKCXsKCQlpZiAoKF9udW1QYXlzID09IDApIHx8IChfbnVtUGF5cyA+IDEwMDApKSB7CgkJCVN0YXRFdmVudCgiSW52YWxpZC4iKTsKCQl9IGVsc2UgaWYgKGhvbGRvdmVyQmFsYW5jZSA+IDAgfHwgcGF5b3V0QmFsYW5jZSA+IDApIHsKCQkJZG9QYXlvdXQoX251bVBheXMpOwoJCX0gZWxzZSB7CgkJCVN0YXRFdmVudCgiTm90aGluZyB0byBkby4iKTsKCQl9CgkJCQkKCX0KCglmdW5jdGlvbiBkb0RldmVsb3BlckdyYW50KCkgaW50ZXJuYWwKCXsKCQlpZiAoIWRldmVsb3BlcnNHcmFudGVkKSB7CgkJCWRldmVsb3BlcnNHcmFudGVkID0gdHJ1ZTsKCQkJbnVtRGV2VG9rZW5zID0gKHRvdGFsVG9rZW5zTWludGVkICogMTUpLzEwMDsKCQkJdG90YWxUb2tlbnNNaW50ZWQgKz0gbnVtRGV2VG9rZW5zOwoJCQlpZiAoIWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLmFsbG9jZWQpIAoJCQkJYWRkQWNjb3VudChkZXZlbG9wZXJzKTsKCQkJdWludCBuZXdIZWxkID0gZ2V0SGVsZChob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS50b2tlbnMpICsgbnVtRGV2VG9rZW5zOwoJCQlob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS50b2tlbnMgPSBuZXdIZWxkIHwgIChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSk7CgoJCX0KCX0KCgp9'.
	

]
