Class {
	#name : #SRT797d713d8d7a2815ccf3dcf9719e3e9f1712c370,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT797d713d8d7a2815ccf3dcf9719e3e9f1712c370 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgT3duZWQgY29udHJhY3QgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElPd25lZCB7CiAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBvd25lcigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIG93bmVyKSB7IG93bmVyOyB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsKfQoKLyoKICAgIEVSQzIwIFN0YW5kYXJkIFRva2VuIGludGVyZmFjZQoqLwpjb250cmFjdCBJRVJDMjBUb2tlbiB7CiAgICAvLyB0aGVzZSBmdW5jdGlvbnMgYXJlbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBuYW1lKSB7IG5hbWU7IH0KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgc3ltYm9sKSB7IHN5bWJvbDsgfQogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggZGVjaW1hbHMpIHsgZGVjaW1hbHM7IH0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpIHsgdG90YWxTdXBwbHk7IH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgeyBfb3duZXI7IGJhbGFuY2U7IH0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7IF9vd25lcjsgX3NwZW5kZXI7IHJlbWFpbmluZzsgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9CgovKgogICAgVG9rZW4gSG9sZGVyIGludGVyZmFjZQoqLwpjb250cmFjdCBJVG9rZW5Ib2xkZXIgaXMgSU93bmVkIHsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgovKgogICAgU21hcnQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgovKgogICAgT3ZlcmZsb3cgcHJvdGVjdGVkIG1hdGggZnVuY3Rpb25zCiovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIC8qKgogICAgICAgIGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gU2FmZU1hdGgoKSB7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBzdW0gb2YgX3ggYW5kIF95LCBhc3NlcnRzIGlmIHRoZSBjYWxjdWxhdGlvbiBvdmVyZmxvd3MKCiAgICAgICAgQHBhcmFtIF94ICAgdmFsdWUgMQogICAgICAgIEBwYXJhbSBfeSAgIHZhbHVlIDIKCiAgICAgICAgQHJldHVybiBzdW0KICAgICovCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHogPSBfeCArIF95OwogICAgICAgIGFzc2VydCh6ID49IF94KTsKICAgICAgICByZXR1cm4gejsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGRpZmZlcmVuY2Ugb2YgX3ggbWludXMgX3ksIGFzc2VydHMgaWYgdGhlIHN1YnRyYWN0aW9uIHJlc3VsdHMgaW4gYSBuZWdhdGl2ZSBudW1iZXIKCiAgICAgICAgQHBhcmFtIF94ICAgbWludWVuZAogICAgICAgIEBwYXJhbSBfeSAgIHN1YnRyYWhlbmQKCiAgICAgICAgQHJldHVybiBkaWZmZXJlbmNlCiAgICAqLwogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KF94ID49IF95KTsKICAgICAgICByZXR1cm4gX3ggLSBfeTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIHByb2R1Y3Qgb2YgbXVsdGlwbHlpbmcgX3ggYnkgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cwoKICAgICAgICBAcGFyYW0gX3ggICBmYWN0b3IgMQogICAgICAgIEBwYXJhbSBfeSAgIGZhY3RvciAyCgogICAgICAgIEByZXR1cm4gcHJvZHVjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludDI1NiBfeCwgdWludDI1NiBfeSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICogX3k7CiAgICAgICAgYXNzZXJ0KF94ID09IDAgfHwgeiAvIF94ID09IF95KTsKICAgICAgICByZXR1cm4gejsKICAgIH0KfQoKLyoqCiAgICBFUkMyMCBTdGFuZGFyZCBUb2tlbiBpbXBsZW1lbnRhdGlvbgoqLwpjb250cmFjdCBFUkMyMFRva2VuIGlzIElFUkMyMFRva2VuLCBTYWZlTWF0aCB7CiAgICBzdHJpbmcgcHVibGljIHN0YW5kYXJkID0gJ1Rva2VuIDAuMSc7CiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAnJzsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gJyc7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHMgPSAwOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHkgPSAwOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZU9mOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgYWxsb3dhbmNlOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLyoqCiAgICAgICAgQGRldiBjb25zdHJ1Y3RvcgoKICAgICAgICBAcGFyYW0gX25hbWUgICAgICAgIHRva2VuIG5hbWUKICAgICAgICBAcGFyYW0gX3N5bWJvbCAgICAgIHRva2VuIHN5bWJvbAogICAgICAgIEBwYXJhbSBfZGVjaW1hbHMgICAgZGVjaW1hbCBwb2ludHMsIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAqLwogICAgZnVuY3Rpb24gRVJDMjBUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpIHsKICAgICAgICByZXF1aXJlKGJ5dGVzKF9uYW1lKS5sZW5ndGggPiAwICYmIGJ5dGVzKF9zeW1ib2wpLmxlbmd0aCA+IDApOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYW4gYWRkcmVzcyAtIGN1cnJlbnRseSBvbmx5IGNoZWNrcyB0aGF0IGl0IGlzbid0IG51bGwKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBzZW5kIGNvaW5zCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzCgogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0CiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gc2FmZUFkZChiYWxhbmNlT2ZbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbiBhY2NvdW50L2NvbnRyYWN0IGF0dGVtcHRzIHRvIGdldCB0aGUgY29pbnMKICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMKCiAgICAgICAgQHBhcmFtIF9mcm9tICAgIHNvdXJjZSBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudAoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkQWRkcmVzcyhfZnJvbSkKICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VPZltfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VPZltfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZU9mW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZltfdG9dLCBfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvdyBhbm90aGVyIGFjY291bnQvY29udHJhY3QgdG8gc3BlbmQgc29tZSB0b2tlbnMgb24geW91ciBiZWhhbGYKICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMKCiAgICAgICAgYWxzbywgdG8gbWluaW1pemUgdGhlIHJpc2sgb2YgdGhlIGFwcHJvdmUvdHJhbnNmZXJGcm9tIGF0dGFjayB2ZWN0b3IKICAgICAgICAoc2VlIGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMVlMUHRReFp1MVVBdk85Y1oxTzJSUFhCYlQwbW9vaDREWUtqQV9qcC1STE0vKSwgYXBwcm92ZSBoYXMgdG8gYmUgY2FsbGVkIHR3aWNlCiAgICAgICAgaW4gMiBzZXBhcmF0ZSB0cmFuc2FjdGlvbnMgLSBvbmNlIHRvIGNoYW5nZSB0aGUgYWxsb3dhbmNlIHRvIDAgYW5kIHNlY29uZGx5IHRvIGNoYW5nZSBpdCB0byB0aGUgbmV3IGFsbG93YW5jZSB2YWx1ZQoKICAgICAgICBAcGFyYW0gX3NwZW5kZXIgYXBwcm92ZWQgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdmFsdWUgICBhbGxvd2FuY2UgYW1vdW50CgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIGlmIGl0IHdhc24ndAogICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgdmFsaWRBZGRyZXNzKF9zcGVuZGVyKQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICAvLyBpZiB0aGUgYWxsb3dhbmNlIGlzbid0IDAsIGl0IGNhbiBvbmx5IGJlIHVwZGF0ZWQgdG8gMCB0byBwcmV2ZW50IGFuIGFsbG93YW5jZSBjaGFuZ2UgaW1tZWRpYXRlbHkgYWZ0ZXIgd2l0aGRyYXdhbAogICAgICAgIHJlcXVpcmUoX3ZhbHVlID09IDAgfHwgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3Qgb3duZXJzaGlwCiovCmNvbnRyYWN0IE93bmVkIGlzIElPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgX3ByZXZPd25lciwgYWRkcmVzcyBfbmV3T3duZXIpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgb3duZXIgb25seQogICAgbW9kaWZpZXIgb3duZXJPbmx5IHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0cmFuc2ZlcnJpbmcgdGhlIGNvbnRyYWN0IG93bmVyc2hpcAogICAgICAgIHRoZSBuZXcgb3duZXIgc3RpbGwgbmVlZCB0byBhY2NlcHQgdGhlIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX25ld093bmVyICAgIG5ldyBjb250cmFjdCBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSBvd25lcik7CiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG93bmVyIHRvIGFjY2VwdCBhbiBvd25lcnNoaXAgdHJhbnNmZXIKICAgICovCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdPd25lcik7CiAgICAgICAgT3duZXJVcGRhdGUob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIG5ld093bmVyID0gMHgwOwogICAgfQp9CgovKgogICAgV2UgY29uc2lkZXIgZXZlcnkgY29udHJhY3QgdG8gYmUgYSAndG9rZW4gaG9sZGVyJyBzaW5jZSBpdCdzIGN1cnJlbnRseSBub3QgcG9zc2libGUKICAgIGZvciBhIGNvbnRyYWN0IHRvIGRlbnkgcmVjZWl2aW5nIHRva2Vucy4KCiAgICBUaGUgVG9rZW5Ib2xkZXIncyBjb250cmFjdCBzb2xlIHB1cnBvc2UgaXMgdG8gcHJvdmlkZSBhIHNhZmV0eSBtZWNoYW5pc20gdGhhdCBhbGxvd3MKICAgIHRoZSBvd25lciB0byBzZW5kIHRva2VucyB0aGF0IHdlcmUgc2VudCB0byB0aGUgY29udHJhY3QgYnkgbWlzdGFrZSBiYWNrIHRvIHRoZWlyIHNlbmRlci4KKi8KY29udHJhY3QgVG9rZW5Ib2xkZXIgaXMgSVRva2VuSG9sZGVyLCBPd25lZCB7CiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXIoKSB7CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgaXMgZGlmZmVyZW50IHRoYW4gdGhpcyBjb250cmFjdCBhZGRyZXNzCiAgICBtb2RpZmllciBub3RUaGlzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB3aXRoZHJhd3MgdG9rZW5zIGhlbGQgYnkgdGhlIGNvbnRyYWN0IGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQogICAgICAgIG5vdFRoaXMoX3RvKQogICAgewogICAgICAgIGFzc2VydChfdG9rZW4udHJhbnNmZXIoX3RvLCBfYW1vdW50KSk7CiAgICB9Cn0KCi8qCiAgICBTbWFydCBUb2tlbiB2MC4yCgogICAgJ093bmVkJyBpcyBzcGVjaWZpZWQgaGVyZSBmb3IgcmVhZGFiaWxpdHkgcmVhc29ucwoqLwpjb250cmFjdCBTbWFydFRva2VuIGlzIElTbWFydFRva2VuLCBFUkMyMFRva2VuLCBPd25lZCwgVG9rZW5Ib2xkZXIgewogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJzAuMic7CgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZCA9IHRydWU7ICAgIC8vIHRydWUgaWYgdHJhbnNmZXIvdHJhbnNmZXJGcm9tIGFyZSBlbmFibGVkLCBmYWxzZSBpZiBub3QKCiAgICAvLyB0cmlnZ2VyZWQgd2hlbiBhIHNtYXJ0IHRva2VuIGlzIGRlcGxveWVkIC0gdGhlIF90b2tlbiBhZGRyZXNzIGlzIGRlZmluZWQgZm9yIGZvcndhcmQgY29tcGF0aWJpbGl0eSwgaW4gY2FzZSB3ZSB3YW50IHRvIHRyaWdnZXIgdGhlIGV2ZW50IGZyb20gYSBmYWN0b3J5CiAgICBldmVudCBOZXdTbWFydFRva2VuKGFkZHJlc3MgX3Rva2VuKTsKICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSB0b3RhbCBzdXBwbHkgaXMgaW5jcmVhc2VkCiAgICBldmVudCBJc3N1YW5jZSh1aW50MjU2IF9hbW91bnQpOwogICAgLy8gdHJpZ2dlcmVkIHdoZW4gdGhlIHRvdGFsIHN1cHBseSBpcyBkZWNyZWFzZWQKICAgIGV2ZW50IERlc3RydWN0aW9uKHVpbnQyNTYgX2Ftb3VudCk7CgogICAgLyoqCiAgICAgICAgQGRldiBjb25zdHJ1Y3RvcgoKICAgICAgICBAcGFyYW0gX25hbWUgICAgICAgdG9rZW4gbmFtZQogICAgICAgIEBwYXJhbSBfc3ltYm9sICAgICB0b2tlbiBzaG9ydCBzeW1ib2wsIDEtNiBjaGFyYWN0ZXJzCiAgICAgICAgQHBhcmFtIF9kZWNpbWFscyAgIGZvciBkaXNwbGF5IHB1cnBvc2VzIG9ubHkKICAgICovCiAgICBmdW5jdGlvbiBTbWFydFRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQ4IF9kZWNpbWFscykKICAgICAgICBFUkMyMFRva2VuKF9uYW1lLCBfc3ltYm9sLCBfZGVjaW1hbHMpCiAgICB7CiAgICAgICAgcmVxdWlyZShieXRlcyhfc3ltYm9sKS5sZW5ndGggPD0gNik7IC8vIHZhbGlkYXRlIGlucHV0CiAgICAgICAgTmV3U21hcnRUb2tlbihhZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIG9ubHkgd2hlbiB0cmFuc2ZlcnMgYXJlbid0IGRpc2FibGVkCiAgICBtb2RpZmllciB0cmFuc2ZlcnNBbGxvd2VkIHsKICAgICAgICBhc3NlcnQodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRpc2FibGVzL2VuYWJsZXMgdHJhbnNmZXJzCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX2Rpc2FibGUgICAgdHJ1ZSB0byBkaXNhYmxlIHRyYW5zZmVycywgZmFsc2UgdG8gZW5hYmxlIHRoZW0KICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBpbmNyZWFzZXMgdGhlIHRva2VuIHN1cHBseSBhbmQgc2VuZHMgdGhlIG5ldyB0b2tlbnMgdG8gYW4gYWNjb3VudAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF90byAgICAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBieQogICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykKICAgICAgICBub3RUaGlzKF90bykKICAgIHsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gc2FmZUFkZChiYWxhbmNlT2ZbX3RvXSwgX2Ftb3VudCk7CgogICAgICAgIElzc3VhbmNlKF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKHRoaXMsIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZW1vdmVzIHRva2VucyBmcm9tIGFuIGFjY291bnQgYW5kIGRlY3JlYXNlcyB0aGUgdG9rZW4gc3VwcGx5CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX2Zyb20gICAgICAgYWNjb3VudCB0byByZW1vdmUgdGhlIGFtb3VudCBmcm9tCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBkZWNyZWFzZSB0aGUgc3VwcGx5IGJ5CiAgICAqLwogICAgZnVuY3Rpb24gZGVzdHJveShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICB7CiAgICAgICAgYmFsYW5jZU9mW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZU9mW19mcm9tXSwgX2Ftb3VudCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsKCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIHRoaXMsIF9hbW91bnQpOwogICAgICAgIERlc3RydWN0aW9uKF9hbW91bnQpOwogICAgfQoKICAgIC8vIEVSQzIwIHN0YW5kYXJkIG1ldGhvZCBvdmVycmlkZXMgd2l0aCBzb21lIGV4dHJhIGZ1bmN0aW9uYWxpdHkKCiAgICAvKioKICAgICAgICBAZGV2IHNlbmQgY29pbnMKICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMKICAgICAgICBub3RlIHRoYXQgd2hlbiB0cmFuc2ZlcnJpbmcgdG8gdGhlIHNtYXJ0IHRva2VuJ3MgYWRkcmVzcywgdGhlIGNvaW5zIGFyZSBhY3R1YWxseSBkZXN0cm95ZWQKCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudAoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB0cmFuc2ZlcnNBbGxvd2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFzc2VydChzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSkpOwoKICAgICAgICAvLyB0cmFuc2ZlcnJpbmcgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MgZGVzdHJveXMgdG9rZW5zCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIGJhbGFuY2VPZltfdG9dIC09IF92YWx1ZTsKICAgICAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOwogICAgICAgICAgICBEZXN0cnVjdGlvbihfdmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbiBhY2NvdW50L2NvbnRyYWN0IGF0dGVtcHRzIHRvIGdldCB0aGUgY29pbnMKICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMKICAgICAgICBub3RlIHRoYXQgd2hlbiB0cmFuc2ZlcnJpbmcgdG8gdGhlIHNtYXJ0IHRva2VuJ3MgYWRkcmVzcywgdGhlIGNvaW5zIGFyZSBhY3R1YWxseSBkZXN0cm95ZWQKCiAgICAgICAgQHBhcmFtIF9mcm9tICAgIHNvdXJjZSBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudAoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgdHJhbnNmZXJzQWxsb3dlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhc3NlcnQoc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSkpOwoKICAgICAgICAvLyB0cmFuc2ZlcnJpbmcgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MgZGVzdHJveXMgdG9rZW5zCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIGJhbGFuY2VPZltfdG9dIC09IF92YWx1ZTsKICAgICAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOwogICAgICAgICAgICBEZXN0cnVjdGlvbihfdmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8vLyBAdGl0bGUgT3duYWJsZQovLy8gQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbCBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcwovLy8gJiB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXJDYW5kaWRhdGU7CgogICAgZXZlbnQgT3duZXJzaGlwUmVxdWVzdGVkKGFkZHJlc3MgaW5kZXhlZCBfYnksIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCiAgICAvLy8gQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyIGFjY291bnQuCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBQcm9wb3NlcyB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyQ2FuZGlkYXRlLgogICAgLy8vIEBwYXJhbSBfbmV3T3duZXJDYW5kaWRhdGUgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lckNhbmRpZGF0ZSkgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lckNhbmRpZGF0ZSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSBfbmV3T3duZXJDYW5kaWRhdGU7CgogICAgICAgIE93bmVyc2hpcFJlcXVlc3RlZChtc2cuc2VuZGVyLCBuZXdPd25lckNhbmRpZGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXB0IG93bmVyc2hpcCB0cmFuc2Zlci4gVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgY2FsbGVkIGJ5IHRoZSBwZXJ2aW91c2x5IHByb3Bvc2VkIG93bmVyLgogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyQ2FuZGlkYXRlKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXJDYW5kaWRhdGU7CiAgICAgICAgICAgIG5ld093bmVyQ2FuZGlkYXRlID0gYWRkcmVzcygwKTsKCiAgICAgICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lckNhbmRpZGF0ZSk7CiAgICAgICAgfQogICAgfQp9CgovLy8gQHRpdGxlIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKbGlicmFyeSBTYWZlck1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KfQoKCi8vLyBAdGl0bGUgU3RveCBTbWFydCBUb2tlbgpjb250cmFjdCBTdG94U21hcnRUb2tlbiBpcyBTbWFydFRva2VuIHsKICAgIGZ1bmN0aW9uIFN0b3hTbWFydFRva2VuKCkgU21hcnRUb2tlbignU3RveCcsICdTVFgnLCAxOCkgewogICAgICAgIGRpc2FibGVUcmFuc2ZlcnModHJ1ZSk7CiAgICB9Cn0KCgovLy8gQHRpdGxlIFZlc3RpbmcgdHJ1c3RlZQpjb250cmFjdCBUcnVzdGVlIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZXJNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBTVFggRVJDMjAgdG9rZW4uCiAgICBTdG94U21hcnRUb2tlbiBwdWJsaWMgc3RveDsKCiAgICBzdHJ1Y3QgR3JhbnQgewogICAgICAgIHVpbnQyNTYgdmFsdWU7CiAgICAgICAgdWludDI1NiBzdGFydDsKICAgICAgICB1aW50MjU2IGNsaWZmOwogICAgICAgIHVpbnQyNTYgZW5kOwogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJyZWQ7CiAgICAgICAgYm9vbCByZXZva2FibGU7CiAgICB9CgogICAgLy8gR3JhbnRzIGhvbGRlci4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gR3JhbnQpIHB1YmxpYyBncmFudHM7CgogICAgLy8gVG90YWwgdG9rZW5zIGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVmVzdGluZzsKCiAgICBldmVudCBOZXdHcmFudChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IFVubG9ja0dyYW50KGFkZHJlc3MgaW5kZXhlZCBfaG9sZGVyLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBSZXZva2VHcmFudChhZGRyZXNzIGluZGV4ZWQgX2hvbGRlciwgdWludDI1NiBfcmVmdW5kKTsKCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciB0aGF0IGluaXRpYWxpemVzIHRoZSBhZGRyZXNzIG9mIHRoZSBTdG94U21hcnRUb2tlbiBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3N0b3ggU3RveFNtYXJ0VG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHByZXZpb3VzbHkgZGVwbG95ZWQgU3RveFNtYXJ0VG9rZW4gc21hcnQgY29udHJhY3QuCiAgICBmdW5jdGlvbiBUcnVzdGVlKFN0b3hTbWFydFRva2VuIF9zdG94KSB7CiAgICAgICAgcmVxdWlyZShfc3RveCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgc3RveCA9IF9zdG94OwogICAgfQoKICAgIC8vLyBAZGV2IEdyYW50IHRva2VucyB0byBhIHNwZWNpZmllZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBncmFudCB0b2tlbnMgdG8uCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICAvLy8gQHBhcmFtIF9zdGFydCB1aW50MjU2IFRoZSBiZWdpbm5pbmcgb2YgdGhlIHZlc3RpbmcgcGVyaW9kLgogICAgLy8vIEBwYXJhbSBfY2xpZmYgdWludDI1NiBEdXJhdGlvbiBvZiB0aGUgY2xpZmYgcGVyaW9kLgogICAgLy8vIEBwYXJhbSBfZW5kIHVpbnQyNTYgVGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9yZXZva2FibGUgYm9vbCBXaGV0aGVyIHRoZSBncmFudCBpcyByZXZva2FibGUgb3Igbm90LgogICAgZnVuY3Rpb24gZ3JhbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9zdGFydCwgdWludDI1NiBfY2xpZmYsIHVpbnQyNTYgX2VuZCwgYm9vbCBfcmV2b2thYmxlKQogICAgICAgIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGEgc2luZ2xlIGFkZHJlc3MgY2FuIGJlIGdyYW50ZWQgdG9rZW5zIG9ubHkgb25jZS4KICAgICAgICByZXF1aXJlKGdyYW50c1tfdG9dLnZhbHVlID09IDApOwoKICAgICAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvci4KICAgICAgICByZXF1aXJlKF9zdGFydCA8PSBfY2xpZmYgJiYgX2NsaWZmIDw9IF9lbmQpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoaXMgZ3JhbnQgZG9lc24ndCBleGNlZWQgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgY3VycmVudGx5IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICByZXF1aXJlKHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKSA8PSBzdG94LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgIC8vIEFzc2lnbiBhIG5ldyBncmFudC4KICAgICAgICBncmFudHNbX3RvXSA9IEdyYW50KHsKICAgICAgICAgICAgdmFsdWU6IF92YWx1ZSwKICAgICAgICAgICAgc3RhcnQ6IF9zdGFydCwKICAgICAgICAgICAgY2xpZmY6IF9jbGlmZiwKICAgICAgICAgICAgZW5kOiBfZW5kLAogICAgICAgICAgICB0cmFuc2ZlcnJlZDogMCwKICAgICAgICAgICAgcmV2b2thYmxlOiBfcmV2b2thYmxlCiAgICAgICAgfSk7CgogICAgICAgIC8vIFRva2VucyBncmFudGVkLCByZWR1Y2UgdGhlIHRvdGFsIGFtb3VudCBhdmFpbGFibGUgZm9yIHZlc3RpbmcuCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLmFkZChfdmFsdWUpOwoKICAgICAgICBOZXdHcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICBmdW5jdGlvbiByZXZva2UoYWRkcmVzcyBfaG9sZGVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBHcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXTsKCiAgICAgICAgcmVxdWlyZShncmFudC5yZXZva2FibGUpOwoKICAgICAgICAvLyBTZW5kIHRoZSByZW1haW5pbmcgU1RYIGJhY2sgdG8gdGhlIG93bmVyLgogICAgICAgIHVpbnQyNTYgcmVmdW5kID0gZ3JhbnQudmFsdWUuc3ViKGdyYW50LnRyYW5zZmVycmVkKTsKCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBncmFudC4KICAgICAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdOwoKICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3Rpbmcuc3ViKHJlZnVuZCk7CiAgICAgICAgc3RveC50cmFuc2Zlcihtc2cuc2VuZGVyLCByZWZ1bmQpOwoKICAgICAgICBSZXZva2VHcmFudChfaG9sZGVyLCByZWZ1bmQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lLgogICAgLy8vIEBwYXJhbSBfaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlci4KICAgIC8vLyBAcGFyYW0gX3RpbWUgdWludDI1NiBUaGUgc3BlY2lmaWMgdGltZS4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2Vucy4KICAgIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3RpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl07CiAgICAgICAgaWYgKGdyYW50LnZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKGdyYW50LCBfdGltZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLgogICAgLy8vIEBwYXJhbSBfZ3JhbnQgR3JhbnQgVGhlIHZlc3RpbmcgZ3JhbnQuCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAgLy8vIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQuCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgLwogICAgLy8vICAgfCAgICAgICAgICAgICAgLnwKICAgIC8vLyAgIHwgICAgICAgICAgICAuICB8CiAgICAvLy8gICB8ICAgICAgICAgIC4gICAgfAogICAgLy8vICAgfCAgICAgICAgLiAgICAgIHwKICAgIC8vLyAgIHwgICAgICAuICAgICAgICB8CiAgICAvLy8gICB8ICAgIC4gICAgICAgICAgfAogICAgLy8vICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAgLy8vICAgICBTdGFydCAgICAgICBDbGlmZiAgICAgIEVuZAogICAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKEdyYW50IF9ncmFudCwgdWludDI1NiBfdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSWYgd2UncmUgYmVmb3JlIHRoZSBjbGlmZiwgdGhlbiBub3RoaW5nIGlzIHZlc3RlZC4KICAgICAgICBpZiAoX3RpbWUgPCBfZ3JhbnQuY2xpZmYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB3ZSdyZSBhZnRlciB0aGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZCAtIGV2ZXJ5dGhpbmcgaXMgdmVzdGVkOwogICAgICAgIGlmIChfdGltZSA+PSBfZ3JhbnQuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiBfZ3JhbnQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2VuczogdmVzdGVkVG9rZW5zID0gdG9rZW5zLy8vICh0aW1lIC0gc3RhcnQpIC8gKGVuZCAtIHN0YXJ0KQogICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlLm11bChfdGltZS5zdWIoX2dyYW50LnN0YXJ0KSkuZGl2KF9ncmFudC5lbmQuc3ViKF9ncmFudC5zdGFydCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFVubG9jayB2ZXN0ZWQgdG9rZW5zIGFuZCB0cmFuc2ZlciB0aGVtIHRvIHRoZWlyIGhvbGRlci4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoZWlyIGhvbGRlci4KICAgIGZ1bmN0aW9uIHVubG9ja1Zlc3RlZFRva2VucygpIHB1YmxpYyB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShncmFudC52YWx1ZSAhPSAwKTsKCiAgICAgICAgLy8gR2V0IHRoZSB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2VucywgYWNjY29yZGluZyB0byBncmFudC4KICAgICAgICB1aW50MjU2IHZlc3RlZCA9IGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgbm93KTsKICAgICAgICBpZiAodmVzdGVkID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBob2xkZXIgZG9lc24ndCB0cmFuc2ZlciBtb3JlIHRoYW4gd2hhdCBoZSBhbHJlYWR5IGhhcy4KICAgICAgICB1aW50MjU2IHRyYW5zZmVyYWJsZSA9IHZlc3RlZC5zdWIoZ3JhbnQudHJhbnNmZXJyZWQpOwogICAgICAgIGlmICh0cmFuc2ZlcmFibGUgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBncmFudC50cmFuc2ZlcnJlZCA9IGdyYW50LnRyYW5zZmVycmVkLmFkZCh0cmFuc2ZlcmFibGUpOwogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5zdWIodHJhbnNmZXJhYmxlKTsKICAgICAgICBzdG94LnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7CgogICAgICAgIFVubG9ja0dyYW50KG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7CiAgICB9Cn0KCgovLy8gQHRpdGxlIFN0b3ggU21hcnQgVG9rZW4gc2FsZQpjb250cmFjdCBTdG94U21hcnRUb2tlblNhbGUgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlck1hdGggZm9yIHVpbnQyNTY7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRFVSQVRJT04gPSAxNCBkYXlzOwoKICAgIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CiAgICBib29sIHB1YmxpYyBpc0Rpc3RyaWJ1dGVkID0gZmFsc2U7CgogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIFNUWCBFUkMyMCB0b2tlbi4KICAgIFN0b3hTbWFydFRva2VuIHB1YmxpYyBzdG94OwoKICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBhbGxvY2F0aW9uIHRydXN0ZWU7CiAgICBUcnVzdGVlIHB1YmxpYyB0cnVzdGVlOwoKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZSA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lID0gMDsKICAgIGFkZHJlc3MgcHVibGljIGZ1bmRpbmdSZWNpcGllbnQ7CgogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogICAgLy8gVE9ETzogdXBkYXRlIHRvIHRoZSBjb3JyZWN0IHZhbHVlcy4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEVUSF9DQVAgPSAxNDgwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBFWENIQU5HRV9SQVRFID0gMjAwOyAvLyAyMDAgU1RYIGZvciBFVEgKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1NBTEVfQ0FQID0gRVRIX0NBUCAqIEVYQ0hBTkdFX1JBVEUgKiAxMCAqKiAxODsKCiAgICBldmVudCBUb2tlbnNJc3N1ZWQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5zKTsKCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgY2FsbGVkIHdoZW4gbm90IGR1cmluZyBzYWxlLgogICAgbW9kaWZpZXIgb25seUR1cmluZ1NhbGUoKSB7CiAgICAgICAgaWYgKHRva2Vuc1NvbGQgPj0gVE9LRU5fU0FMRV9DQVAgfHwgbm93IDwgc3RhcnRUaW1lIHx8IG5vdyA+PSBlbmRUaW1lKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJlZm9yZSBzYWxlIGVuZHMuCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJTYWxlKCkgewogICAgICAgIGlmICghKHRva2Vuc1NvbGQgPj0gVE9LRU5fU0FMRV9DQVAgfHwgbm93ID49IGVuZFRpbWUpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciB0aGF0IGluaXRpYWxpemVzIHRoZSBzYWxlIGNvbmRpdGlvbnMuCiAgICAvLy8gQHBhcmFtIF9mdW5kaW5nUmVjaXBpZW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGZ1bmRpbmcgcmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBfc3RhcnRUaW1lIHVpbnQyNTYgVGhlIHN0YXJ0IHRpbWUgb2YgdGhlIHRva2VuIHNhbGUuCiAgICBmdW5jdGlvbiBTdG94U21hcnRUb2tlblNhbGUoYWRkcmVzcyBfc3RveCwgYWRkcmVzcyBfZnVuZGluZ1JlY2lwaWVudCwgdWludDI1NiBfc3RhcnRUaW1lKSB7CiAgICAgICAgcmVxdWlyZShfc3RveCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9mdW5kaW5nUmVjaXBpZW50ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+IG5vdyk7CgogICAgICAgIHN0b3ggPSBTdG94U21hcnRUb2tlbihfc3RveCk7CgogICAgICAgIGZ1bmRpbmdSZWNpcGllbnQgPSBfZnVuZGluZ1JlY2lwaWVudDsKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBzdGFydFRpbWUgKyBEVVJBVElPTjsKICAgIH0KCiAgICAvLy8gQGRldiBEaXN0cmlidXRlZCB0b2tlbnMgdG8gdGhlIHBhcnRuZXJzIHdobyBoYXZlIHBhcnRpY2lwYXRlZCBkdXJpbmcgdGhlIHByZS1zYWxlLgogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVBhcnRuZXJUb2tlbnMoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoIWlzRGlzdHJpYnV0ZWQpOwoKICAgICAgICBhc3NlcnQodG9rZW5zU29sZCA9PSAwKTsKICAgICAgICBhc3NlcnQoc3RveC50b3RhbFN1cHBseSgpID09IDApOwoKICAgICAgICAvLyBEaXN0cmlidXRlIHN0cmF0ZWdpYyB0b2tlbnMgdG8gcGFydG5lcnMuIFBsZWFzZSBub3RlLCB0aGF0IHRoaXMgYWRkcmVzcyBkb2Vzbid0IHJlcHJlc2VudCBhIHNpbmdsZSBlbnRpdHkgb3IKICAgICAgICAvLyBwZXJzb24gYW5kIHdpbGwgYmUgb25seSB1c2VkIHRvIGRpc3RyaWJ1dGUgdG9rZW5zIHRvIDMwfiBwYXJ0bmVycy4KICAgICAgICAvLwogICAgICAgIC8vIFBsZWFzZSBleHBlY3QgdG8gc2VlIHRva2VuIHRyYW5zZmVycyBmcm9tIHRoaXMgYWRkcmVzcyBpbiB0aGUgZmlyc3QgMjQgaG91cnMgYWZ0ZXIgdGhlIHRva2VuIHNhbGUgZW5kcy4KICAgICAgICBpc3N1ZVRva2VucygweDkwNjUyNjBlZjY4MzBmNjM3MkYxQmRlNDA4RGVDNTdGZTMxNTA1MzAsIDE0ODAwMDAwICogMTAgKiogMTgpOwoKICAgICAgICBpc0Rpc3RyaWJ1dGVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBGaW5hbGl6ZXMgdGhlIHRva2VuIHNhbGUgZXZlbnQuCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIGV4dGVybmFsIG9ubHlBZnRlclNhbGUgewogICAgICAgIGlmIChpc0ZpbmFsaXplZCkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIC8vIEdyYW50IHZlc3RpbmcgZ3JhbnRzLgogICAgICAgIC8vCiAgICAgICAgLy8gVE9ETzogdXNlIHJlYWwgYWRkcmVzc2VzLgogICAgICAgIHRydXN0ZWUgPSBuZXcgVHJ1c3RlZShzdG94KTsKCiAgICAgICAgLy8gU2luY2Ugb25seSA1MCUgb2YgdGhlIHRva2VucyB3aWxsIGJlIHNvbGQsIHdlIHdpbGwgYXV0b21hdGljYWxseSBpc3N1ZSB0aGUgc2FtZSBhbW91bnQgb2Ygc29sZCBTVFggdG8gdGhlCiAgICAgICAgLy8gdHJ1c3RlZS4KICAgICAgICB1aW50MjU2IHVuc29sZFRva2VucyA9IHRva2Vuc1NvbGQ7CgogICAgICAgIC8vIElzc3VlIDU1JSBvZiB0aGUgcmVtYWluaW5nIHRva2VucyAoPT0gMjcuNSUpIGdvIHRvIHN0cmF0ZWdpYyBwYXJ0ZXJuc2hpcHMuCiAgICAgICAgdWludDI1NiBzdHJhdGVnaWNQYXJ0bmVyc2hpcFRva2VucyA9IHVuc29sZFRva2Vucy5tdWwoNTUpLmRpdigxMDApOwoKICAgICAgICAvLyBOb3RlOiB3ZSB3aWxsIHN1YnN0cmFjdCB0aGUgYm9udXMgdG9rZW5zIGZyb20gdGhpcyBncmFudCwgc2luY2UgdGhleSB3ZXJlIGFscmVhZHkgaXNzdWVkIGZvciB0aGUgcHJlLXNhbGUKICAgICAgICAvLyBzdHJhdGVnaWMgcGFydG5lcnMgYW5kIHNob3VsZCd2ZSBiZWVuIHRha2VuIGZyb20gdGhpcyBhbGxvY2F0aW9uLgogICAgICAgIHN0b3guaXNzdWUoMHhiQzE0MTA1Y2NEZGVBYWRCOTZCYThkQ0UxOGI0MEM0NWI2YkFDZjU4LCBzdHJhdGVnaWNQYXJ0bmVyc2hpcFRva2Vucyk7CgogICAgICAgIC8vIElzc3VlIHRoZSByZW1haW5pbmcgdG9rZW5zIGFzIHZlc3RpbmcgZ3JhbnRzOgogICAgICAgIHN0b3guaXNzdWUodHJ1c3RlZSwgdW5zb2xkVG9rZW5zLnN1YihzdHJhdGVnaWNQYXJ0bmVyc2hpcFRva2VucykpOwoKICAgICAgICAvLyAyNSUgb2YgdGhlIHJlbWFpbmluZyB0b2tlbnMgKD09IDEyLjUlKSBnbyB0byBJbnZlc3QuY29tLCBhdCB1bmlmb3JtIDEyIG1vbnRocyB2ZXN0aW5nIHNjaGVkdWxlLgogICAgICAgIHRydXN0ZWUuZ3JhbnQoMHhiNTRjNmE4NzBkNGFENjVlMjNkNDcxRmI3OTQxYUQyNzFEMzIzZjVFLCB1bnNvbGRUb2tlbnMubXVsKDI1KS5kaXYoMTAwKSwgbm93LCBub3csCiAgICAgICAgICAgIG5vdy5hZGQoMSB5ZWFycyksIHRydWUpOwoKICAgICAgICAvLyAyMCUgb2YgdGhlIHJlbWFpbmluZyB0b2tlbnMgKD09IDEwJSkgZ28gdG8gU3RveCB0ZWFtLCBhdCB1bmlmb3JtIDI0IG1vbnRocyB2ZXN0aW5nIHNjaGVkdWxlLgogICAgICAgIHRydXN0ZWUuZ3JhbnQoMHg0ZUI0Q2QxRDEyNWQ5ZDI4MTcwOUZmMzhkNjViOTlhNjkyN2I0NmMxLCB1bnNvbGRUb2tlbnMubXVsKDIwKS5kaXYoMTAwKSwgbm93LCBub3csCiAgICAgICAgICAgIG5vdy5hZGQoMiB5ZWFycyksIHRydWUpOwoKICAgICAgICAvLyBSZS1lbmFibGUgdHJhbnNmZXJzIGFmdGVyIHRoZSB0b2tlbiBzYWxlLgogICAgICAgIHN0b3guZGlzYWJsZVRyYW5zZmVycyhmYWxzZSk7CgogICAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGUgYW5kIHNlbGwgdG9rZW5zIHRvIHRoZSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LgogICAgZnVuY3Rpb24gY3JlYXRlKGFkZHJlc3MgX3JlY2lwaWVudCkgcHVibGljIHBheWFibGUgb25seUR1cmluZ1NhbGUgewogICAgICAgIHJlcXVpcmUoX3JlY2lwaWVudCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwoKICAgICAgICBhc3NlcnQoaXNEaXN0cmlidXRlZCk7CgogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gU2FmZXJNYXRoLm1pbjI1Nihtc2cudmFsdWUubXVsKEVYQ0hBTkdFX1JBVEUpLCBUT0tFTl9TQUxFX0NBUC5zdWIodG9rZW5zU29sZCkpOwogICAgICAgIHVpbnQyNTYgY29udHJpYnV0aW9uID0gdG9rZW5zLmRpdihFWENIQU5HRV9SQVRFKTsKCiAgICAgICAgaXNzdWVUb2tlbnMoX3JlY2lwaWVudCwgdG9rZW5zKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIGZ1bmRzIHRvIHRoZSBmdW5kaW5nIHJlY2lwaWVudC4KICAgICAgICBmdW5kaW5nUmVjaXBpZW50LnRyYW5zZmVyKGNvbnRyaWJ1dGlvbik7CgogICAgICAgIC8vIFJlZnVuZCB0aGUgbXNnLnNlbmRlciwgaW4gdGhlIGNhc2UgdGhhdCBub3QgYWxsIG9mIGl0cyBFVEggd2FzIHVzZWQuIFRoaXMgY2FuIGhhcHBlbiBvbmx5IHdoZW4gc2VsbGluZyB0aGUKICAgICAgICAvLyBsYXN0IGNodW5rIG9mIFNUWC4KICAgICAgICB1aW50MjU2IHJlZnVuZCA9IG1zZy52YWx1ZS5zdWIoY29udHJpYnV0aW9uKTsKICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIHRoZSByZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaXNzdWUuCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTYgX3Rva2VucykgcHJpdmF0ZSB7CiAgICAgICAgLy8gVXBkYXRlIHRvdGFsIHNvbGQgdG9rZW5zLgogICAgICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLmFkZChfdG9rZW5zKTsKCiAgICAgICAgc3RveC5pc3N1ZShfcmVjaXBpZW50LCBfdG9rZW5zKTsKCiAgICAgICAgVG9rZW5zSXNzdWVkKF9yZWNpcGllbnQsIF90b2tlbnMpOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2lsbCBkZWxlZ2F0ZSB0aGUgcmVxdWVzdCB0byBjcmVhdGUuCiAgICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIG9ubHlEdXJpbmdTYWxlIHsKICAgICAgICBjcmVhdGUobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBkZXYgUHJvcG9zZXMgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgU3RveFNtYXJ0VG9rZW4gY29udHJhY3QgdG8gYSBuZXcgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgIC8vLwogICAgLy8vIE5vdGUgdGhhdDoKICAgIC8vLyAgIDEuIFRoZSBuZXcgb3duZXIgd2lsbCBuZWVkIHRvIGNhbGwgU3RveFNtYXJ0VG9rZW4ncyBhY2NlcHRPd25lcnNoaXAgZGlyZWN0bHkgaW4gb3JkZXIgdG8gYWNjZXB0IHRoZSBvd25lcnNoaXAuCiAgICAvLy8gICAyLiBDYWxsaW5nIHRoaXMgbWV0aG9kIGR1cmluZyB0aGUgdG9rZW4gc2FsZSB3aWxsIHByZXZlbnQgdGhlIHRva2VuIHNhbGUgdG8gY29udGludWUsIHNpbmNlIG9ubHkgdGhlIG93bmVyIG9mCiAgICAvLy8gICAgICB0aGUgU3RveFNtYXJ0VG9rZW4gY29udHJhY3QgY2FuIGlzc3VlIG5ldyB0b2tlbnMuCiAgICBmdW5jdGlvbiB0cmFuc2ZlclNtYXJ0VG9rZW5Pd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXJDYW5kaWRhdGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc3RveC50cmFuc2Zlck93bmVyc2hpcChfbmV3T3duZXJDYW5kaWRhdGUpOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VwdHMgbmV3IG93bmVyc2hpcCBvbiBiZWhhbGYgb2YgdGhlIFN0b3hTbWFydFRva2VuIGNvbnRyYWN0LiBUaGlzIGNhbiBiZSB1c2VkLCBieSB0aGUgdG9rZW4gc2FsZQogICAgLy8vIGNvbnRyYWN0IGl0c2VsZiB0byBjbGFpbSBiYWNrIG93bmVyc2hpcCBvZiB0aGUgU3RveFNtYXJ0VG9rZW4gY29udHJhY3QuCiAgICBmdW5jdGlvbiBhY2NlcHRTbWFydFRva2VuT3duZXJzaGlwKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBzdG94LmFjY2VwdE93bmVyc2hpcCgpOwogICAgfQoKICAgIC8vLyBAZGV2IFByb3Bvc2VzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIFRydXN0ZWUgY29udHJhY3QgdG8gYSBuZXcgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgIC8vLwogICAgLy8vIE5vdGUgdGhhdDoKICAgIC8vLyAgIDEuIFRoZSBuZXcgb3duZXIgd2lsbCBuZWVkIHRvIGNhbGwgVHJ1c3RlZSdzIGFjY2VwdE93bmVyc2hpcCBkaXJlY3RseSBpbiBvcmRlciB0byBhY2NlcHQgdGhlIG93bmVyc2hpcC4KICAgIC8vLyAgIDIuIENhbGxpbmcgdGhpcyBtZXRob2QgZHVyaW5nIHRoZSB0b2tlbiBzYWxlIHdvbid0IGJlIHBvc3NpYmxlLCBhcyB0aGUgVHJ1c3RlZSBpcyBvbmx5IGNyZWF0ZWQgYWZ0ZXIgaXRzCiAgICAvLy8gICAgICBmaW5hbGl6YXRpb24uCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRydXN0ZWVPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXJDYW5kaWRhdGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgdHJ1c3RlZS50cmFuc2Zlck93bmVyc2hpcChfbmV3T3duZXJDYW5kaWRhdGUpOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VwdHMgbmV3IG93bmVyc2hpcCBvbiBiZWhhbGYgb2YgdGhlIFRydXN0ZWUgY29udHJhY3QuIFRoaXMgY2FuIGJlIHVzZWQsIGJ5IHRoZSB0b2tlbiBzYWxlCiAgICAvLy8gY29udHJhY3QgaXRzZWxmIHRvIGNsYWltIGJhY2sgb3duZXJzaGlwIG9mIHRoZSBUcnVzdGVlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gYWNjZXB0VHJ1c3RlZU93bmVyc2hpcCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgdHJ1c3RlZS5hY2NlcHRPd25lcnNoaXAoKTsKICAgIH0KfQ=='.
	

]
