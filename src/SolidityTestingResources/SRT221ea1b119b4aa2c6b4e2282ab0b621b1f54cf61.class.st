Class {
	#name : #SRT221ea1b119b4aa2c6b4e2282ab0b621b1f54cf61,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT221ea1b119b4aa2c6b4e2282ab0b621b1f54cf61 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyA8T1JBQ0xJWkVfQVBJPgovKgpDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNiBPcmFjbGl6ZSBTUkwKQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURAoKCgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgoKClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwgVEhFCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgpUSEUgU09GVFdBUkUuCiovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4wOy8vcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIHdoZW4gc29saWRpdHkgPCAwLjQuMAoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIAogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsgICAgICAgCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRQcm9vZlR5cGUocHJvb2ZQKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICBpZiAoKF9uYnl0ZXMgPT0gMCl8fChfbmJ5dGVzID4gMzIpKSB0aHJvdzsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXNbM10gbWVtb3J5IGFyZ3MgPSBbdW5vbmNlLCBuYnl0ZXMsIHNlc3Npb25LZXlIYXNoXTsgCiAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfcXVlcnkoX2RlbGF5LCAicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIHNoYTMoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CiAgICAKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ynl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CiAgICAgICAgCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgc2lncl8gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCsodWludChkZXJzaWdbM10pIC0gMHgyMCk7CiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3NfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOwogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0Kyh1aW50KGRlcnNpZ1tvZmZzZXQtMV0pIC0gMHgyMCksIDMyLCBzaWdzXywgMCk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcikgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7CiAgICAgICAgICAgIHJldHVybiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgCiAgICAgICAgLy8gU3RlcCA2OiB2ZXJpZnkgdGhlIGF0dGVzdGF0aW9uIHNpZ25hdHVyZSwgQVBQS0VZMSBtdXN0IHNpZ24gdGhlIHNlc3Npb25LZXkgZnJvbSB0aGUgY29ycmVjdCBsZWRnZXIgYXBwIChDT0RFSEFTSCkKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMiA9IG5ldyBieXRlcyh1aW50KHByb29mW3NpZzJvZmZzZXQrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCwgc2lnMi5sZW5ndGgsIHNpZzIsIDApOwogICAgICAgIAogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IDE7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKICAgICAgICAKICAgICAgICBpZiAoc2lnb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjMgPSBuZXcgYnl0ZXMoMSs2NSk7CiAgICAgICAgdG9zaWduM1swXSA9IDB4RkU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzLCA2NSwgdG9zaWduMywgMSk7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKICAgICAgICAKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHNpZ29rOwogICAgfQogICAgCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHRocm93OwogICAgICAgIAogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbWF0Y2hCeXRlczMyUHJlZml4KGJ5dGVzMzIgY29udGVudCwgYnl0ZXMgcHJlZml4KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CiAgICAgICAgCiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHByZWZpeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIGNoZWNrb2s7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGNoZWNrb2sgPSAoc2hhMyhrZXloYXNoKSA9PSBzaGEzKHNoYTI1Nihjb250ZXh0X25hbWUsIHF1ZXJ5SWQpKSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgY2hlY2tvayA9IG1hdGNoQnl0ZXMzMlByZWZpeChzaGEyNTYoc2lnMSksIHJlc3VsdCk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBzaGEzKGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrMzIsIDgrMSszMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwogICAgICAgIAogICAgICAgIGJ5dGVzMzIgc2Vzc2lvblB1YmtleUhhc2ggPSBzaGEyNTYoc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBjaGVja29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAvLyB2ZXJpZnkgaWYgc2Vzc2lvblB1YmtleUhhc2ggd2FzIHZlcmlmaWVkIGFscmVhZHksIGlmIG5vdC4uIGxldCdzIGRvIGl0IQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2UpewogICAgICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KHByb29mLCBzaWcyb2Zmc2V0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCiAgICAKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgICAgIHRocm93OyAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5PwogICAgICAgIH0KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KICAgIAogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KICAKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQogICAgICAgIAp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgovLy8gbWF0aC5zb2wgLS0gbWl4aW4gZm9yIGlubGluZSBudW1lcmljYWwgd2l6YXJkcnkKCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4KLy8gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCAoZXhwcmVzcyBvciBpbXBsaWVkKS4KCnByYWdtYSBzb2xpZGl0eSBeMC40LjEwOwoKY29udHJhY3QgRFNNYXRoIHsKICAgIAogICAgLyoKICAgIHN0YW5kYXJkIHVpbnQyNTYgZnVuY3Rpb25zCiAgICAgKi8KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKiB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHogPSB4IC8geTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIG1heCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIC8qCiAgICB1aW50MTI4IGZ1bmN0aW9ucyAoaCBpcyBmb3IgaGFsZikKICAgICAqLwoKCiAgICBmdW5jdGlvbiBoYWRkKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICBhc3NlcnQoKHogPSB4ICsgeSkgPj0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gaHN1Yih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgYXNzZXJ0KCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKiB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoZGl2KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0geCAvIHk7CiAgICB9CgogICAgZnVuY3Rpb24gaG1pbih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaG1heCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKCiAgICAvKgogICAgaW50MjU2IGZ1bmN0aW9ucwogICAgICovCgogICAgZnVuY3Rpb24gaW1pbihpbnQyNTYgeCwgaW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1heChpbnQyNTYgeCwgaW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIC8qCiAgICBXQUQgbWF0aAogICAgICovCgogICAgdWludDEyOCBjb25zdGFudCBXQUQgPSAxMCAqKiAxODsKCiAgICBmdW5jdGlvbiB3YWRkKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhhZGQoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gd3N1Yih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBoc3ViKHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSBjYXN0KCh1aW50MjU2KHgpICogeSArIFdBRCAvIDIpIC8gV0FEKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3ZGl2KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0gY2FzdCgodWludDI1Nih4KSAqIFdBRCArIHkgLyAyKSAvIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdtaW4odWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaG1pbih4LCB5KTsKICAgIH0KICAgIGZ1bmN0aW9uIHdtYXgodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaG1heCh4LCB5KTsKICAgIH0KCiAgICAvKgogICAgUkFZIG1hdGgKICAgICAqLwoKICAgIHVpbnQxMjggY29uc3RhbnQgUkFZID0gMTAgKiogMjc7CgogICAgZnVuY3Rpb24gcmFkZCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBoYWRkKHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJzdWIodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaHN1Yih4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBybXVsKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0gY2FzdCgodWludDI1Nih4KSAqIHkgKyBSQVkgLyAyKSAvIFJBWSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmRpdih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgeiA9IGNhc3QoKHVpbnQyNTYoeCkgKiBSQVkgKyB5IC8gMikgLyB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBycG93KHVpbnQxMjggeCwgdWludDY0IG4pIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIC8vIFRoaXMgZmFtb3VzIGFsZ29yaXRobSBpcyBjYWxsZWQgImV4cG9uZW50aWF0aW9uIGJ5IHNxdWFyaW5nIgogICAgICAgIC8vIGFuZCBjYWxjdWxhdGVzIHhebiB3aXRoIHggYXMgZml4ZWQtcG9pbnQgYW5kIG4gYXMgcmVndWxhciB1bnNpZ25lZC4KICAgICAgICAvLwogICAgICAgIC8vIEl0J3MgTyhsb2cgbiksIGluc3RlYWQgb2YgTyhuKSBmb3IgbmFpdmUgcmVwZWF0ZWQgbXVsdGlwbGljYXRpb24uCiAgICAgICAgLy8KICAgICAgICAvLyBUaGVzZSBmYWN0cyBhcmUgd2h5IGl0IHdvcmtzOgogICAgICAgIC8vCiAgICAgICAgLy8gIElmIG4gaXMgZXZlbiwgdGhlbiB4Xm4gPSAoeF4yKV4obi8yKS4KICAgICAgICAvLyAgSWYgbiBpcyBvZGQsICB0aGVuIHhebiA9IHggKiB4XihuLTEpLAogICAgICAgIC8vICAgYW5kIGFwcGx5aW5nIHRoZSBlcXVhdGlvbiBmb3IgZXZlbiB4IGdpdmVzCiAgICAgICAgLy8gICAgeF5uID0geCAqICh4XjIpXigobi0xKSAvIDIpLgogICAgICAgIC8vCiAgICAgICAgLy8gIEFsc28sIEVWTSBkaXZpc2lvbiBpcyBmbG9vcmluZyBhbmQKICAgICAgICAvLyAgICBmbG9vclsobi0xKSAvIDJdID0gZmxvb3JbbiAvIDJdLgoKICAgICAgICB6ID0gbiAlIDIgIT0gMCA/IHggOiBSQVk7CgogICAgICAgIGZvciAobiAvPSAyOyBuICE9IDA7IG4gLz0gMikgewogICAgICAgICAgICB4ID0gcm11bCh4LCB4KTsKCiAgICAgICAgICAgIGlmIChuICUgMiAhPSAwKSB7CiAgICAgICAgICAgICAgICB6ID0gcm11bCh6LCB4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBybWluKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhtaW4oeCwgeSk7CiAgICB9CiAgICBmdW5jdGlvbiBybWF4KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhtYXgoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FzdCh1aW50MjU2IHgpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIGFzc2VydCgoeiA9IHVpbnQxMjgoeCkpID09IHgpOwogICAgfQoKfQoKY29udHJhY3QgTGVkZ2VyUHJvb2ZWZXJpZnlJIHsKICAgIGZ1bmN0aW9uIGV4dGVybmFsX29yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGV4dGVybmFsX29yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5KGJ5dGVzIHByb29mLCBieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzIHJlc3VsdCwgc3RyaW5nIGNvbnRleHRfbmFtZSkgIHB1YmxpYyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICAKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KfQoKY29udHJhY3Qgb3JhY2xpemVTZXR0aW5ncyBpcyBPd25lZCB7Cgl1aW50IGNvbnN0YW50IE9SQUNMSVpFX1BFUl9TUElOX0dBU19MSU1JVCA9IDYxMDA7Cgl1aW50IGNvbnN0YW50IE9SQUNMSVpFX0JBU0VfR0FTX0xJTUlUID0gMjAwMDAwOwoJdWludCBzYWZlR2FzID0gOTAwMDsKCQoJZXZlbnQgbmV3R2FzTGltaXQodWludCBfZ2FzTGltaXQpOwoKCWZ1bmN0aW9uIHNldFNhZmVHYXModWludCBfZ2FzKSAKCQlvbmx5T3duZXIgCgl7CgkgICAgYXNzZXJ0KE9SQUNMSVpFX0JBU0VfR0FTX0xJTUlUICsgc2FmZUdhcyA+PSBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCk7CgkgICAgYXNzZXJ0KHNhZmVHYXMgPD0gMjUwMDApOwoJCXNhZmVHYXMgPSBfZ2FzOwoJCW5ld0dhc0xpbWl0KF9nYXMpOwoJfQkKfQoKY29udHJhY3QgSG91c2VNYW5hZ2VkIGlzIE93bmVkIHsKICAgIAogICAgYWRkcmVzcyBwdWJsaWMgaG91c2VBZGRyZXNzOwogICAgYm9vbCBwdWJsaWMgaXNTdG9wcGVkOwoKICAgIGV2ZW50IExPR19Db250cmFjdFN0b3BwZWQoKTsKICAgIGV2ZW50IExPR19Db250cmFjdFJlc3VtZWQoKTsKICAgIGV2ZW50IExPR19Pd25lckFkZHJlc3NDaGFuZ2VkKGFkZHJlc3Mgb2xkQWRkciwgYWRkcmVzcyBuZXdPd25lckFkZHJlc3MpOwogICAgZXZlbnQgTE9HX0hvdXNlQWRkcmVzc0NoYW5nZWQoYWRkcmVzcyBvbGRBZGRyLCBhZGRyZXNzIG5ld0hvdXNlQWRkcmVzcyk7CiAgICAKICAgIG1vZGlmaWVyIG9ubHlJZk5vdFN0b3BwZWQgewogICAgICAgIGFzc2VydCghaXNTdG9wcGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZlN0b3BwZWQgewogICAgICAgIGFzc2VydChpc1N0b3BwZWQpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEhvdXNlTWFuYWdlZCgpIHsKICAgICAgICBob3VzZUFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3Bfb3JfcmVzdW1lX0NvbnRyYWN0KGJvb2wgX2lzU3RvcHBlZCkKICAgICAgICBvbmx5T3duZXIgewoKICAgICAgICBpc1N0b3BwZWQgPSBfaXNTdG9wcGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZUhvdXNlX2FuZF9Pd25lcl9BZGRyZXNzZXMoYWRkcmVzcyBuZXdIb3VzZSwgYWRkcmVzcyBuZXdPd25lcikKICAgICAgICBvbmx5T3duZXIgewoKICAgICAgICBhc3NlcnQobmV3SG91c2UgIT0gYWRkcmVzcygweDApKTsKICAgICAgICBhc3NlcnQobmV3T3duZXIgIT0gYWRkcmVzcygweDApKTsKICAgICAgICAKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIExPR19Pd25lckFkZHJlc3NDaGFuZ2VkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgCiAgICAgICAgaG91c2VBZGRyZXNzID0gbmV3SG91c2U7CiAgICAgICAgTE9HX0hvdXNlQWRkcmVzc0NoYW5nZWQoaG91c2VBZGRyZXNzLCBuZXdIb3VzZSk7CiAgICB9Cgp9Cgpjb250cmFjdCB1c2luZ0ludmVzdG9yc01vZHVsZSBpcyBIb3VzZU1hbmFnZWQsIG9yYWNsaXplU2V0dGluZ3MgewogICAgCiAgICB1aW50IGNvbnN0YW50IE1BWF9JTlZFU1RPUlMgPSA1OyAvL21heGltdW0gbnVtYmVyIG9mIGludmVzdG9ycwogICAgdWludCBjb25zdGFudCBkaXZlc3RGZWUgPSA1MDsgLy9kaXZlc3QgZmVlIHBlcmNlbnRhZ2UgKDEwMDAwID0gMTAwJSkKCiAgICAgc3RydWN0IEludmVzdG9yIHsKICAgICAgICBhZGRyZXNzIGludmVzdG9yQWRkcmVzczsKICAgICAgICB1aW50IGFtb3VudEludmVzdGVkOwogICAgICAgIGJvb2wgdm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsOwogICAgfQogICAgCiAgICAvL1N0YXJ0aW5nIGF0IDEKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgaW52ZXN0b3JJRHM7CiAgICBtYXBwaW5nKHVpbnQgPT4gSW52ZXN0b3IpIHB1YmxpYyBpbnZlc3RvcnM7CiAgICB1aW50IHB1YmxpYyBudW1JbnZlc3RvcnMgPSAwOwoKICAgIHVpbnQgcHVibGljIGludmVzdGVkID0gMDsKICAgIAogICAgdWludCBwdWJsaWMgaW52ZXN0b3JzUHJvZml0ID0gMDsKICAgIHVpbnQgcHVibGljIGludmVzdG9yc0xvc3NlcyA9IDA7CiAgICBib29sIHByb2ZpdERpc3RyaWJ1dGVkOwogICAgCiAgICBldmVudCBMT0dfSW52ZXN0b3JFbnRyYW5jZShhZGRyZXNzIGludmVzdG9yLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfSW52ZXN0b3JDYXBpdGFsVXBkYXRlKGFkZHJlc3MgaW52ZXN0b3IsIGludCBhbW91bnQpOwogICAgZXZlbnQgTE9HX0ludmVzdG9yRXhpdChhZGRyZXNzIGludmVzdG9yLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5QXV0b1N0b3AoKTsKICAgIAogICAgZXZlbnQgTE9HX1plcm9TZW5kKCk7CiAgICBldmVudCBMT0dfVmFsdWVJc1Rvb0JpZygpOwogICAgZXZlbnQgTE9HX0ZhaWxlZFNlbmQoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IExPR19TdWNjZXNzZnVsU2VuZChhZGRyZXNzIGFkZHIsIHVpbnQgdmFsdWUpOwogICAgCgoKICAgIG1vZGlmaWVyIG9ubHlNb3JlVGhhbk1pbkludmVzdG1lbnQgewogICAgICAgIGFzc2VydChtc2cudmFsdWUgPiBnZXRNaW5JbnZlc3RtZW50KCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1vcmVUaGFuWmVybyB7CiAgICAgICAgYXNzZXJ0KG1zZy52YWx1ZSAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIAogICAgbW9kaWZpZXIgb25seUludmVzdG9ycyB7CiAgICAgICAgYXNzZXJ0KGludmVzdG9ySURzW21zZy5zZW5kZXJdICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU5vdEludmVzdG9ycyB7CiAgICAgICAgYXNzZXJ0KGludmVzdG9ySURzW21zZy5zZW5kZXJdID09IDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGludmVzdG9yc0ludmFyaWFudCB7CiAgICAgICAgXzsKICAgICAgICBhc3NlcnQobnVtSW52ZXN0b3JzIDw9IE1BWF9JTlZFU1RPUlMpOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5SWZQcm9maXROb3REaXN0cmlidXRlZCB7CiAgICAgICAgaWYgKCFwcm9maXREaXN0cmlidXRlZCkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0QmFua3JvbGwoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIGlmICgoaW52ZXN0ZWQgPCBpbnZlc3RvcnNQcm9maXQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIGludmVzdG9yc1Byb2ZpdCA8IGludmVzdGVkKSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBpbnZlc3RvcnNQcm9maXQgPCBpbnZlc3RvcnNMb3NzZXMpKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGludmVzdGVkICsgaW52ZXN0b3JzUHJvZml0IC0gaW52ZXN0b3JzTG9zc2VzOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNaW5JbnZlc3RtZW50KCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICBpZiAobnVtSW52ZXN0b3JzID09IE1BWF9JTlZFU1RPUlMpIHsKICAgICAgICAgICAgdWludCBpbnZlc3RvcklEID0gc2VhcmNoU21hbGxlc3RJbnZlc3RvcigpOwogICAgICAgICAgICByZXR1cm4gZ2V0QmFsYW5jZShpbnZlc3RvcnNbaW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMb3NzZXNTaGFyZShhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIGludmVzdG9yc1tpbnZlc3RvcklEc1tjdXJyZW50SW52ZXN0b3JdXS5hbW91bnRJbnZlc3RlZCAqIChpbnZlc3RvcnNMb3NzZXMpIC8gaW52ZXN0ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UHJvZml0U2hhcmUoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHJldHVybiBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXV0uYW1vdW50SW52ZXN0ZWQgKiAoaW52ZXN0b3JzUHJvZml0KSAvIGludmVzdGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHVpbnQgaW52ZXN0ZWQgPSBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXV0uYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgdWludCBwcm9maXQgPSBnZXRQcm9maXRTaGFyZShjdXJyZW50SW52ZXN0b3IpOwogICAgICAgIHVpbnQgbG9zc2VzID0gZ2V0TG9zc2VzU2hhcmUoY3VycmVudEludmVzdG9yKTsKCiAgICAgICAgaWYgKChpbnZlc3RlZCArIHByb2ZpdCA8IHByb2ZpdCkgfHwKICAgICAgICAgICAgKGludmVzdGVkICsgcHJvZml0IDwgaW52ZXN0ZWQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIHByb2ZpdCA8IGxvc3NlcykpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIGludmVzdGVkICsgcHJvZml0IC0gbG9zc2VzOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlYXJjaFNtYWxsZXN0SW52ZXN0b3IoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIHVpbnQgaW52ZXN0b3JJRCA9IDE7CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChnZXRCYWxhbmNlKGludmVzdG9yc1tpXS5pbnZlc3RvckFkZHJlc3MpIDwgZ2V0QmFsYW5jZShpbnZlc3RvcnNbaW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKSkgewogICAgICAgICAgICAgICAgaW52ZXN0b3JJRCA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBpbnZlc3RvcklEOwogICAgfQoKICAgIAogICAgZnVuY3Rpb24gYWRkSW52ZXN0b3JBdElEKHVpbnQgaWQpCiAgICAgICAgcHJpdmF0ZSB7CgogICAgICAgIGludmVzdG9ySURzW21zZy5zZW5kZXJdID0gaWQ7CiAgICAgICAgaW52ZXN0b3JzW2lkXS5pbnZlc3RvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGludmVzdG9yc1tpZF0uYW1vdW50SW52ZXN0ZWQgPSBtc2cudmFsdWU7CiAgICAgICAgaW52ZXN0ZWQgKz0gbXNnLnZhbHVlOwoKICAgICAgICBMT0dfSW52ZXN0b3JFbnRyYW5jZShtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2ZpdERpc3RyaWJ1dGlvbigpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG9ubHlJZlByb2ZpdE5vdERpc3RyaWJ1dGVkIHsKCiAgICAgICAgdWludCBjb3B5SW52ZXN0ZWQ7CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGN1cnJlbnRJbnZlc3RvciA9IGludmVzdG9yc1tpXS5pbnZlc3RvckFkZHJlc3M7CiAgICAgICAgICAgIHVpbnQgcHJvZml0T2ZJbnZlc3RvciA9IGdldFByb2ZpdFNoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgICAgIHVpbnQgbG9zc2VzT2ZJbnZlc3RvciA9IGdldExvc3Nlc1NoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgICAgIC8vQ2hlY2sgZm9yIG92ZXJmbG93IGFuZCB1bmRlcmZsb3cKICAgICAgICAgICAgaWYgKChpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQgKyBwcm9maXRPZkludmVzdG9yID49IGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCkgJiYKICAgICAgICAgICAgICAgIChpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQgKyBwcm9maXRPZkludmVzdG9yID49IGxvc3Nlc09mSW52ZXN0b3IpKSAgewogICAgICAgICAgICAgICAgaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkICs9IHByb2ZpdE9mSW52ZXN0b3IgLSBsb3NzZXNPZkludmVzdG9yOwogICAgICAgICAgICAgICAgTE9HX0ludmVzdG9yQ2FwaXRhbFVwZGF0ZShjdXJyZW50SW52ZXN0b3IsIChpbnQpIChwcm9maXRPZkludmVzdG9yIC0gbG9zc2VzT2ZJbnZlc3RvcikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaXNTdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIExPR19FbWVyZ2VuY3lBdXRvU3RvcCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29weUludmVzdGVkICsgaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkID49IGNvcHlJbnZlc3RlZCkKICAgICAgICAgICAgICAgIGNvcHlJbnZlc3RlZCArPSBpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgfQoKICAgICAgICBkZWxldGUgaW52ZXN0b3JzUHJvZml0OwogICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNMb3NzZXM7CiAgICAgICAgaW52ZXN0ZWQgPSBjb3B5SW52ZXN0ZWQ7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGVkID0gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaW5jcmVhc2VJbnZlc3RtZW50KCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgb25seUlmTm90U3RvcHBlZAogICAgICAgIG9ubHlNb3JlVGhhblplcm8KICAgICAgICBvbmx5SW52ZXN0b3JzICB7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbigpOwogICAgICAgIGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0uYW1vdW50SW52ZXN0ZWQgKz0gbXNnLnZhbHVlOwogICAgICAgIGludmVzdGVkICs9IG1zZy52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBuZXdJbnZlc3RvcigpCiAgICAgICAgcGF5YWJsZQogICAgICAgIG9ubHlJZk5vdFN0b3BwZWQKICAgICAgICBvbmx5TW9yZVRoYW5aZXJvCiAgICAgICAgb25seU5vdEludmVzdG9ycwogICAgICAgIG9ubHlNb3JlVGhhbk1pbkludmVzdG1lbnQKICAgICAgICBpbnZlc3RvcnNJbnZhcmlhbnQgewoKICAgICAgICBwcm9maXREaXN0cmlidXRpb24oKTsKCiAgICAgICAgaWYgKG51bUludmVzdG9ycyA9PSBNQVhfSU5WRVNUT1JTKSB7CiAgICAgICAgICAgIHVpbnQgc21hbGxlc3RJbnZlc3RvcklEID0gc2VhcmNoU21hbGxlc3RJbnZlc3RvcigpOwogICAgICAgICAgICBkaXZlc3QoaW52ZXN0b3JzW3NtYWxsZXN0SW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CgogICAgICAgIG51bUludmVzdG9ycysrOwogICAgICAgIGFkZEludmVzdG9yQXRJRChudW1JbnZlc3RvcnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdmVzdCgpCiAgICAgICAgb25seUludmVzdG9ycyB7CgogICAgICAgIGRpdmVzdChtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgZnVuY3Rpb24gZGl2ZXN0KGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIGludGVybmFsCiAgICAgICAgaW52ZXN0b3JzSW52YXJpYW50IHsKCiAgICAgICAgcHJvZml0RGlzdHJpYnV0aW9uKCk7CiAgICAgICAgdWludCBjdXJyZW50SUQgPSBpbnZlc3RvcklEc1tjdXJyZW50SW52ZXN0b3JdOwogICAgICAgIHVpbnQgYW1vdW50VG9SZXR1cm4gPSBnZXRCYWxhbmNlKGN1cnJlbnRJbnZlc3Rvcik7CgogICAgICAgIGlmICgoaW52ZXN0ZWQgPj0gaW52ZXN0b3JzW2N1cnJlbnRJRF0uYW1vdW50SW52ZXN0ZWQpKSB7CiAgICAgICAgICAgIGludmVzdGVkIC09IGludmVzdG9yc1tjdXJyZW50SURdLmFtb3VudEludmVzdGVkOwogICAgICAgICAgICB1aW50IGRpdmVzdEZlZUFtb3VudCA9ICAoYW1vdW50VG9SZXR1cm4qZGl2ZXN0RmVlKS8xMDAwMDsKICAgICAgICAgICAgYW1vdW50VG9SZXR1cm4gLT0gZGl2ZXN0RmVlQW1vdW50OwoKICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tjdXJyZW50SURdOwogICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXTsKCiAgICAgICAgICAgIC8vUmVvcmRlciBpbnZlc3RvcnMKICAgICAgICAgICAgaWYgKGN1cnJlbnRJRCAhPSBudW1JbnZlc3RvcnMpIHsKICAgICAgICAgICAgICAgIC8vIEdldCBsYXN0IGludmVzdG9yCiAgICAgICAgICAgICAgICBJbnZlc3RvciBsYXN0SW52ZXN0b3IgPSBpbnZlc3RvcnNbbnVtSW52ZXN0b3JzXTsKICAgICAgICAgICAgICAgIC8vU2V0IGxhc3QgaW52ZXN0b3IgSUQgdG8gaW52ZXN0b3JJRCBvZiBkaXZlc3RpbmcgYWNjb3VudAogICAgICAgICAgICAgICAgaW52ZXN0b3JJRHNbbGFzdEludmVzdG9yLmludmVzdG9yQWRkcmVzc10gPSBjdXJyZW50SUQ7CiAgICAgICAgICAgICAgICAvL0NvcHkgaW52ZXN0b3IgYXQgdGhlIG5ldyBwb3NpdGlvbiBpbiB0aGUgbWFwcGluZwogICAgICAgICAgICAgICAgaW52ZXN0b3JzW2N1cnJlbnRJRF0gPSBsYXN0SW52ZXN0b3I7CiAgICAgICAgICAgICAgICAvL0RlbGV0ZSBvbGQgcG9zaXRpb24gaW4gdGhlIG1hcHBwaW5nCiAgICAgICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JzW251bUludmVzdG9yc107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG51bUludmVzdG9ycy0tOwogICAgICAgICAgICBzYWZlU2VuZChjdXJyZW50SW52ZXN0b3IsIGFtb3VudFRvUmV0dXJuKTsKICAgICAgICAgICAgc2FmZVNlbmQoaG91c2VBZGRyZXNzLCBkaXZlc3RGZWVBbW91bnQpOwogICAgICAgICAgICBMT0dfSW52ZXN0b3JFeGl0KGN1cnJlbnRJbnZlc3RvciwgYW1vdW50VG9SZXR1cm4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlzU3RvcHBlZCA9IHRydWU7CiAgICAgICAgICAgIExPR19FbWVyZ2VuY3lBdXRvU3RvcCgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZm9yY2VEaXZlc3RPZkFsbEludmVzdG9ycygpCiAgICAgICAgb25seU93bmVyIHsKICAgICAgICAgICAgCiAgICAgICAgdWludCBjb3B5TnVtSW52ZXN0b3JzID0gbnVtSW52ZXN0b3JzOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBjb3B5TnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgZGl2ZXN0KGludmVzdG9yc1sxXS5pbnZlc3RvckFkZHJlc3MpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2FmZVNlbmQoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlKQogICAgICAgIGludGVybmFsIHsKCiAgICAgICAgaWYgKHZhbHVlID09IDApIHsKICAgICAgICAgICAgTE9HX1plcm9TZW5kKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPCB2YWx1ZSkgewogICAgICAgICAgICBMT0dfVmFsdWVJc1Rvb0JpZygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIShhZGRyLmNhbGwuZ2FzKHNhZmVHYXMpLnZhbHVlKHZhbHVlKSgpKSkgewogICAgICAgICAgICBMT0dfRmFpbGVkU2VuZChhZGRyLCB2YWx1ZSk7CiAgICAgICAgICAgIGlmIChhZGRyICE9IGhvdXNlQWRkcmVzcykgewogICAgICAgICAgICAgICAgLy9Gb3J3YXJkIHRvIGhvdXNlIGFkZHJlc3MgYWxsIGNoYW5nZQogICAgICAgICAgICAgICAgaWYgKCEoaG91c2VBZGRyZXNzLmNhbGwuZ2FzKHNhZmVHYXMpLnZhbHVlKHZhbHVlKSgpKSkgTE9HX0ZhaWxlZFNlbmQoaG91c2VBZGRyZXNzLCB2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIExPR19TdWNjZXNzZnVsU2VuZChhZGRyLHZhbHVlKTsKICAgIH0KfQoKY29udHJhY3QgRW1lcmdlbmN5V2l0aGRyYXdhbE1vZHVsZSBpcyB1c2luZ0ludmVzdG9yc01vZHVsZSB7CiAgICB1aW50IGNvbnN0YW50IEVNRVJHRU5DWV9XSVRIRFJBV0FMX1JBVElPID0gODA7IC8vcmF0aW8gcGVyY2VudGFnZSAoMTAwID0gMTAwJSkKICAgIHVpbnQgY29uc3RhbnQgRU1FUkdFTkNZX1RJTUVPVVQgPSAzIGRheXM7CiAgICAKICAgIHN0cnVjdCBXaXRoZHJhd2FsUHJvcG9zYWwgewogICAgICAgIGFkZHJlc3MgdG9BZGRyZXNzOwogICAgICAgIHVpbnQgYXRUaW1lOwogICAgfQogICAgCiAgICBXaXRoZHJhd2FsUHJvcG9zYWwgcHVibGljIHByb3Bvc2VkV2l0aGRyYXdhbDsKICAgIAogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxQcm9wb3NlZCgpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxGYWlsZWQoYWRkcmVzcyB3aXRoZHJhd2FsQWRkcmVzcyk7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFN1Y2NlZWRlZChhZGRyZXNzIHdpdGhkcmF3YWxBZGRyZXNzLCB1aW50IGFtb3VudFdpdGhkcmF3bik7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFZvdGUoYWRkcmVzcyBpbnZlc3RvciwgYm9vbCB2b3RlKTsKICAgIAogICAgbW9kaWZpZXIgb25seUFmdGVyUHJvcG9zZWQgewogICAgICAgIGFzc2VydChwcm9wb3NlZFdpdGhkcmF3YWwudG9BZGRyZXNzICE9IDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlJZkVtZXJnZW5jeVRpbWVPdXRIYXNQYXNzZWQgewogICAgICAgIGFzc2VydChwcm9wb3NlZFdpdGhkcmF3YWwuYXRUaW1lICsgRU1FUkdFTkNZX1RJTUVPVVQgPD0gbm93KTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB2b3RlRW1lcmdlbmN5V2l0aGRyYXdhbChib29sIHZvdGUpCiAgICAgICAgb25seUludmVzdG9ycwogICAgICAgIG9ubHlBZnRlclByb3Bvc2VkCiAgICAgICAgb25seUlmU3RvcHBlZCB7CgogICAgICAgIGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsID0gdm90ZTsKICAgICAgICBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFZvdGUobXNnLnNlbmRlciwgdm90ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvcG9zZUVtZXJnZW5jeVdpdGhkcmF3YWwoYWRkcmVzcyB3aXRoZHJhd2FsQWRkcmVzcykKICAgICAgICBvbmx5SWZTdG9wcGVkCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgLy9SZXNldHMgcHJldmlvdXMgdm90ZXMKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gbnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tpXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWw7CiAgICAgICAgfQoKICAgICAgICBwcm9wb3NlZFdpdGhkcmF3YWwgPSBXaXRoZHJhd2FsUHJvcG9zYWwod2l0aGRyYXdhbEFkZHJlc3MsIG5vdyk7CiAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxQcm9wb3NlZCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4ZWN1dGVFbWVyZ2VuY3lXaXRoZHJhd2FsKCkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5QWZ0ZXJQcm9wb3NlZAogICAgICAgIG9ubHlJZlN0b3BwZWQKICAgICAgICBvbmx5SWZFbWVyZ2VuY3lUaW1lT3V0SGFzUGFzc2VkIHsKCiAgICAgICAgdWludCBudW1PZlZvdGVzSW5GYXZvdXI7CiAgICAgICAgdWludCBhbW91bnRUb1dpdGhkcmF3ID0gdGhpcy5iYWxhbmNlOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gbnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGludmVzdG9yc1tpXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWwgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgbnVtT2ZWb3Rlc0luRmF2b3VyKys7CiAgICAgICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JzW2ldLnZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG51bU9mVm90ZXNJbkZhdm91ciA+PSBFTUVSR0VOQ1lfV0lUSERSQVdBTF9SQVRJTyAqIG51bUludmVzdG9ycyAvIDEwMCkgewogICAgICAgICAgICBpZiAoIXByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3Muc2VuZChhbW91bnRUb1dpdGhkcmF3KSkgewogICAgICAgICAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxGYWlsZWQocHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFN1Y2NlZWRlZChwcm9wb3NlZFdpdGhkcmF3YWwudG9BZGRyZXNzLCBhbW91bnRUb1dpdGhkcmF3KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAgICAgLyoKICAgIFRoZSBvd25lciBjYW4gdXNlIHRoaXMgZnVuY3Rpb24gdG8gZm9yY2UgdGhlIGV4aXQgb2YgYW4gaW52ZXN0b3IgZnJvbSB0aGUKICAgIGNvbnRyYWN0IGR1cmluZyBhbiBlbWVyZ2VuY3kgd2l0aGRyYXdhbCBpbiB0aGUgZm9sbG93aW5nIHNpdHVhdGlvbnM6CiAgICAgICAgLSBVbnJlc3BvbnNpdmUgaW52ZXN0b3IKICAgICAgICAtIEludmVzdG9yIGRlbWFuZGluZyB0byBiZSBwYWlkIGluIG90aGVyIHRvIHZvdGUsIHRoZSBmYWN0by1ibGFja21haWxpbmcKICAgICAgICBvdGhlciBpbnZlc3RvcnMKICAgICovCiAgICBmdW5jdGlvbiBmb3JjZURpdmVzdE9mT25lSW52ZXN0b3IoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUlmU3RvcHBlZCB7CgogICAgICAgIGRpdmVzdChjdXJyZW50SW52ZXN0b3IpOwogICAgICAgIC8vUmVzZXRzIGVtZXJnZW5jeSB3aXRoZHJhd2FsIHByb3Bvc2FsLiBJbnZlc3RvcnMgbXVzdCB2b3RlIGFnYWluCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkV2l0aGRyYXdhbDsKICAgIH0KfQoKY29udHJhY3QgU2xvdCBpcyB1c2luZ09yYWNsaXplLCBFbWVyZ2VuY3lXaXRoZHJhd2FsTW9kdWxlLCBEU01hdGggewogICAgCiAgICB1aW50IGNvbnN0YW50IElOVkVTVE9SU19FREdFID0gMjAwOyAKICAgIHVpbnQgY29uc3RhbnQgSE9VU0VfRURHRSA9IDUwOwogICAgdWludCBjb25zdGFudCBDQVBJVEFMX1JJU0sgPSAyNTA7CiAgICB1aW50IGNvbnN0YW50IE1BWF9TUElOUyA9IDE2OwogICAgCiAgICB1aW50IG1pbkJldCA9IDEgd2VpOwogCiAgICBzdHJ1Y3QgU3BpbnNDb250YWluZXIgewogICAgICAgIGFkZHJlc3MgcGxheWVyQWRkcmVzczsKICAgICAgICB1aW50IG5TcGluczsKICAgICAgICB1aW50IGFtb3VudFdhZ2VyZWQ7CiAgICB9CiAgICAKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gU3BpbnNDb250YWluZXIpIHNwaW5zOwogICAgCiAgICAvKiBCb3RoIGFycmF5cyBhcmUgb3JkZXJlZDoKICAgICAtIHByb2JhYmlsaXRpZXMgYXJlIG9yZGVyZWQgZnJvbSBzbWFsbGVzdCB0byBoaWdoZXN0CiAgICAgLSBtdWx0aXBsaWVycyBhcmUgb3JkZXJlZCBmcm9tIGhpZ2hlc3QgdG8gbG93ZXN0CiAgICAgVGhlIHByb2JhYmlsaXRpZXMgYXJlIGV4cHJlc3NlZCBhcyBpbnRlZ2VyIG51bWJlcnMgb3ZlciBhIHNjYWxlIG9mIDEwMDAwOiBpLmUKICAgICAxMDAgaXMgZXF1aXZhbGVudCB0byAxJSwgNTAwMCB0byA1MCUgYW5kIHNvIG9uLgogICAgKi8KICAgIHVpbnRbXSBwdWJsaWMgcHJvYmFiaWxpdGllczsKICAgIHVpbnRbXSBwdWJsaWMgbXVsdGlwbGllcnM7CiAgICAKICAgIHVpbnQgcHVibGljIHRvdGFsQW1vdW50V2FnZXJlZDsgCiAgICAKICAgIGV2ZW50IExPR19uZXdTcGluc0NvbnRhaW5lcihieXRlczMyIG15aWQsIGFkZHJlc3MgcGxheWVyQWRkcmVzcywgdWludCBhbW91bnRXYWdlcmVkLCB1aW50IG5TcGlucyk7CiAgICBldmVudCBMT0dfU3BpbkV4ZWN1dGVkKGJ5dGVzMzIgbXlpZCwgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzLCB1aW50IHNwaW5JbmRleCwgdWludCBudW1iZXJEcmF3bik7CiAgICBldmVudCBMT0dfU3BpbnNDb250YWluZXJJbmZvKGJ5dGVzMzIgbXlpZCwgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzLCB1aW50IG5ldFBheW91dCk7CiAgICBMZWRnZXJQcm9vZlZlcmlmeUkgZXh0ZXJuYWxDb250cmFjdDsKICAgIAogICAgZnVuY3Rpb24gU2xvdChhZGRyZXNzIF92ZXJpZmllckFkZHIpIHsKICAgICAgICBleHRlcm5hbENvbnRyYWN0ID0gTGVkZ2VyUHJvb2ZWZXJpZnlJKF92ZXJpZmllckFkZHIpOwogICAgfQogICAgCiAgICAvL1NFQ1RJT04gSTogTU9ESUZJRVJTIEFORCBIRUxQRVIgRlVOQ1RJT05TCiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIGludGVybmFsIHsKICAgICAgICBleHRlcm5hbENvbnRyYWN0LmV4dGVybmFsX29yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQocXVlcnlJZCwgY29tbWl0bWVudCk7CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5KGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIHsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIC8vaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsKICAgICAgICBhc3NlcnQoZXh0ZXJuYWxDb250cmFjdC5leHRlcm5hbF9vcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU9yYWNsaXplIHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZTcGluc0V4aXN0KGJ5dGVzMzIgbXlpZCkgewogICAgICAgIGFzc2VydChzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzICE9IGFkZHJlc3MoMHgwKSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNWYWxpZFNpemUodWludCBfYW1vdW50V2FnZXJlZCkgCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgcmV0dXJucyhib29sKSB7CiAgICAgICAgICAgIAogICAgICAgIHVpbnQgbmV0UG90ZW50aWFsUGF5b3V0ID0gKF9hbW91bnRXYWdlcmVkICogKDEwMDAwIC0gSU5WRVNUT1JTX0VER0UpICogbXVsdGlwbGllcnNbMF0pLyAxMDAwMDsgCiAgICAgICAgdWludCBtYXhBbGxvd2VkUGF5b3V0ID0gKENBUElUQUxfUklTSyAqIGdldEJhbmtyb2xsKCkpLzEwMDAwOwogICAgICAgIAogICAgICAgIHJldHVybiAoKG5ldFBvdGVudGlhbFBheW91dCA8PSBtYXhBbGxvd2VkUGF5b3V0KSAmJiAoX2Ftb3VudFdhZ2VyZWQgPj0gbWluQmV0KSk7CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmRW5vdWdoRnVuZHMoYnl0ZXMzMiBteWlkKSB7CiAgICAgICAgaWYgKGlzVmFsaWRTaXplKHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQpKSB7CiAgICAgICAgICAgICBfOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc2FmZVNlbmQoc3BpbnNbbXlpZF0ucGxheWVyQWRkcmVzcywgc3BpbnNbbXlpZF0uYW1vdW50V2FnZXJlZCk7CiAgICAgICAgICAgIGRlbGV0ZSBzcGluc1tteWlkXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KICAgIAoJbW9kaWZpZXIgb25seUxlc3NUaGFuTWF4U3BpbnMgKHVpbnQgX25TcGlucykgewogICAgICAgIGFzc2VydChfblNwaW5zIDw9IE1BWF9TUElOUyk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLyoKICAgICAgICBGb3IgdGhlIGdhbWUgdG8gYmUgZmFpciwgdGhlIHRvdGFsIGdyb3NzIHBheW91dCBvdmVyIGEgbGFyZ2UgbnVtYmVyIG9mIAogICAgICAgIGluZGl2aWR1YWwgc2xvdCBzcGlucyBzaG91bGQgYmUgdGhlIHRvdGFsIGFtb3VudCB3YWdlcmVkIGJ5IHRoZSBwbGF5ZXIuIAogICAgICAgIAogICAgICAgIFRoZSBnYW1lIG93bmVyLCBjYWxsZWQgaG91c2UsIGFuZCB0aGUgaW52ZXN0b3JzIHdpbGwgZ2FpbiBieSBhcHBseWluZyAKICAgICAgICBhIHNtYWxsIGZlZSwgY2FsbGVkIGVkZ2UsIHRvIHRoZSBhbW91bnQgd29uIGJ5IHRoZSBwbGF5ZXIgaW4gdGhlIGNhc2Ugb2YKICAgICAgICBhIHN1Y2Nlc3NmdWwgc3Bpbi4gCiAgICAgICAgCiAgICAgICAgVGhlIHRvdGFsIGdyb3NzIGV4cGVjdGVkIHBheW91dCBpcyBlcXVhbCB0byB0aGUgc3VtIG9mIGFsbCBwYXlvdXQuIEVhY2ggCiAgICAgICAgaS10aCBwYXlvdXQgaXMgY2FsY3VsYXRlZDoKICAgICAgICAgICAgICAgICAgICBhbW91bnRXYWdlcmVkICogbXVsdGlwbGllcnNbaV0gKiBwcm9iYWJpbGl0aWVzW2ldIAogICAgICAgIFRoZSByZXN1bHRpbmcgZXF1YXRpb24gaXM6CiAgICAgICAgICAgICAgICAgICAgc3VtIG9mIGFXICogbVtpXSAqIHBbaV0gPSBhVwogICAgICAgIEFmdGVyIGhhdmluZyBzaW1wbGlmaWVkIHRoZSBlcXVhdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgc3VtIG9mIG1baV0gKiBwW2ldID0gMQogICAgICAgIFNpbmNlIG91ciBwcm9iYWJpbGl0aWVzIGFyZSBkZWZpbmVkIG92ZXIgMTAwMDAsIHRoZSBzdW0gc2hvdWxkIGJlIDEwMDAwLgogICAgICAgIAogICAgICAgIFRoZSBjb250cmFjdCBvd25lciBjYW4gbW9kaWZ5IHRoZSBtdWx0aXBsaWVycyBhbmQgcHJvYmFiaWxpdGllcyBhcnJheSwgCiAgICAgICAgYnV0IHRoZSAgbW9kaWZpZXIgZW5mb3JjZXMgdGhhdCB0aGUgbnVtYmVyIGNob29zZW4gYWx3YXlzIHJlc3VsdCBpbiBhIAogICAgICAgIGZhcmUgZ2FtZS4KICAgICovCiAgICBtb2RpZmllciBvbmx5SWZGYWlyKHVpbnRbXSBfcHJvYiwgdWludFtdIF9wYXlvdXRzKSB7CiAgICAgICAgaWYgKF9wcm9iLmxlbmd0aCAhPSBfcGF5b3V0cy5sZW5ndGgpIHJldmVydCgpOwogICAgICAgIHVpbnQgc3VtID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPF9wcm9iLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBfcHJvYltpXSAqIF9wYXlvdXRzW2ldOyAgICAgCiAgICAgICAgfQogICAgICAgIGFzc2VydChzdW0gPT0gMTAwMDApOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUgewogICAgICAgIGJ1eVNwaW5zKDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eVNwaW5zKHVpbnQgX25TcGlucykgCiAgICAgICAgcGF5YWJsZSAKICAgICAgICBvbmx5TGVzc1RoYW5NYXhTcGlucyhfblNwaW5zKSAKCQlvbmx5SWZOb3RTdG9wcGVkIHsKICAgICAgICAgICAgCiAgICAgICAgdWludCBnYXMgPSBfblNwaW5zKk9SQUNMSVpFX1BFUl9TUElOX0dBU19MSU1JVCArIE9SQUNMSVpFX0JBU0VfR0FTX0xJTUlUICsgc2FmZUdhczsKICAgICAgICB1aW50IG9yYWNsaXplRmVlID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpLmdldFByaWNlKCJyYW5kb20iLCBnYXMpOwogICAgICAgIAogICAgICAgIC8vIERpc2FsbG93IGJldHMgdGhhdCBldmVuIHdoZW4gbWF4aW1hbGx5IHdpbm5pbmcgYXJlIGEgbG9zcyBmb3IgcGxheWVyIAogICAgICAgIC8vIGR1ZSB0byBvcmFjbGl6ZUZlZQogICAgICAgIGlmIChvcmFjbGl6ZUZlZS9tdWx0aXBsaWVyc1swXSArIG9yYWNsaXplRmVlID49IG1zZy52YWx1ZSkgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgdWludCBhbW91bnRXYWdlcmVkID0gbXNnLnZhbHVlIC0gb3JhY2xpemVGZWU7CiAgICAgICAgdWludCBtYXhOZXRQb3RlbnRpYWxQYXlvdXQgPSAoYW1vdW50V2FnZXJlZCAqICgxMDAwMCAtIElOVkVTVE9SU19FREdFKSAqIG11bHRpcGxpZXJzWzBdKS8xMDAwMDsgCiAgICAgICAgdWludCBtYXhBbGxvd2VkUGF5b3V0ID0gKENBUElUQUxfUklTSyAqIGdldEJhbmtyb2xsKCkpLzEwMDAwOwogICAgICAgIAogICAgICAgIGlmICgobWF4TmV0UG90ZW50aWFsUGF5b3V0IDw9IG1heEFsbG93ZWRQYXlvdXQpICYmIChhbW91bnRXYWdlcmVkID49IG1pbkJldCkpIHsKICAgICAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSgwLCAyKl9uU3BpbnMsIGdhcyk7CiAgICAgICAgICAgICBzcGluc1txdWVyeUlkXSA9IAogICAgICAgICAgICAgICAgU3BpbnNDb250YWluZXIobXNnLnNlbmRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX25TcGlucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50V2FnZXJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIAogICAgICAgICAgICBMT0dfbmV3U3BpbnNDb250YWluZXIocXVlcnlJZCwgbXNnLnNlbmRlciwgYW1vdW50V2FnZXJlZCwgX25TcGlucyk7CiAgICAgICAgICAgIHRvdGFsQW1vdW50V2FnZXJlZCArPSBhbW91bnRXYWdlcmVkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZXhlY3V0ZVNwaW5zKGJ5dGVzMzIgbXlpZCwgYnl0ZXMgcmFuZG9tQnl0ZXMpIAogICAgICAgIHByaXZhdGUgCiAgICAgICAgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHVpbnQgYW1vdW50V29uID0gMDsKICAgICAgICB1aW50IG51bWJlckRyYXduID0gMDsKICAgICAgICB1aW50IHJhbmdlVXBwZXJFbmQgPSAwOwogICAgICAgIHVpbnQgblNwaW5zID0gc3BpbnNbbXlpZF0ublNwaW5zOwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDIqblNwaW5zOyBpICs9IDIpIHsKICAgICAgICAgICAgLy8gQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAyKioxNiwgbm9ybWFsaXplZCBvdmVyIDAgLSAxMDAwMAogICAgICAgICAgICBudW1iZXJEcmF3biA9ICgodWludChyYW5kb21CeXRlc1tpXSkqMjU2ICsgdWludChyYW5kb21CeXRlc1tpKzFdKSkqMTAwMDApLzIqKjE2OwogICAgICAgICAgICByYW5nZVVwcGVyRW5kID0gMDsKICAgICAgICAgICAgTE9HX1NwaW5FeGVjdXRlZChteWlkLCBzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBpLzIsIG51bWJlckRyYXduKTsKICAgICAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgcHJvYmFiaWxpdGllcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgcmFuZ2VVcHBlckVuZCArPSBwcm9iYWJpbGl0aWVzW2pdOwogICAgICAgICAgICAgICAgaWYgKG51bWJlckRyYXduIDwgcmFuZ2VVcHBlckVuZCkgewogICAgICAgICAgICAgICAgICAgIGFtb3VudFdvbiArPSAoc3BpbnNbbXlpZF0uYW1vdW50V2FnZXJlZCAqIG11bHRpcGxpZXJzW2pdKSAvIG5TcGluczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50V29uOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZW5kUGF5b3V0KGJ5dGVzMzIgbXlpZCwgdWludCBwYXlvdXQpIHByaXZhdGUgewoKICAgICAgICBpZiAocGF5b3V0ID49IHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQpIHsKICAgICAgICAgICAgaW52ZXN0b3JzTG9zc2VzICs9IHN1YihwYXlvdXQsIHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQpOwogICAgICAgICAgICBwYXlvdXQgPSAocGF5b3V0KigxMDAwMCAtIElOVkVTVE9SU19FREdFKSkvMTAwMDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB1aW50IHRlbXBQcm9maXQgPSBhZGQoaW52ZXN0b3JzUHJvZml0LCBzdWIoc3BpbnNbbXlpZF0uYW1vdW50V2FnZXJlZCwgcGF5b3V0KSk7CiAgICAgICAgICAgIGludmVzdG9yc1Byb2ZpdCArPSAoc3ViKHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQsIHBheW91dCkqKDEwMDAwIC0gSE9VU0VfRURHRSkpLzEwMDAwOwogICAgICAgICAgICBzYWZlU2VuZChob3VzZUFkZHJlc3MsIHN1Yih0ZW1wUHJvZml0LCBpbnZlc3RvcnNQcm9maXQpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgTE9HX1NwaW5zQ29udGFpbmVySW5mbyhteWlkLCBzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBwYXlvdXQpOwogICAgICAgIHNhZmVTZW5kKHNwaW5zW215aWRdLnBsYXllckFkZHJlc3MsIHBheW91dCk7CiAgICB9CiAgICAKICAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgX3Byb29mKSAKICAgICAgICBvbmx5T3JhY2xpemUKICAgICAgICBvbmx5SWZTcGluc0V4aXN0KG15aWQpCiAgICAgICAgb25seUlmRW5vdWdoRnVuZHMobXlpZCkKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShteWlkLCByZXN1bHQsIF9wcm9vZikKICAgIHsKCQkKICAgICAgICB1aW50IHBheW91dCA9IGV4ZWN1dGVTcGlucyhteWlkLCBieXRlcyhyZXN1bHQpKTsKICAgICAgICAKICAgICAgICBzZW5kUGF5b3V0KG15aWQsIHBheW91dCk7CiAgICAgICAgCiAgICAgICAgZGVsZXRlIHByb2ZpdERpc3RyaWJ1dGVkOwogICAgICAgIGRlbGV0ZSBzcGluc1tteWlkXTsKICAgIH0KICAgIAogICAgLy8gU0VUVEVSUyAtIFNFVFRJTkdTIEFDQ0VTU0lCTEUgQlkgT1dORVIKICAgIAogICAgLy8gQ2hlY2sgb3JkZXJpbmcgYXMgd2VsbCwgc2luY2Ugb3JkZXJpbmcgYXNzdW1wdGlvbnMgYXJlIG1hZGUgaW4gX2NhbGxiYWNrIAogICAgLy8gYW5kIGVsc2V3aGVyZQogICAgZnVuY3Rpb24gc2V0Q29uZmlndXJhdGlvbih1aW50W10gX3Byb2JhYmlsaXRpZXMsIHVpbnRbXSBfbXVsdGlwbGllcnMpIAogICAgICAgIG9ubHlPd25lciAKICAgICAgICBvbmx5SWZGYWlyKF9wcm9iYWJpbGl0aWVzLCBfbXVsdGlwbGllcnMpIHsKICAgICAgICAgICAgICAgIAogICAgICAgIG9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9MZWRnZXIpOyAvL1RoaXMgaXMgaGVyZSB0byByZWR1Y2UgZ2FzIGNvc3QgYXMgdGhpcyBmdW5jdGlvbiBoYXMgdG8gYmUgY2FsbGVkIGFueXdheSBmb3IgaW5pdGlhbGl6YXRpb24KICAgICAgICAKICAgICAgICBkZWxldGUgcHJvYmFiaWxpdGllczsKICAgICAgICBkZWxldGUgbXVsdGlwbGllcnM7CiAgICAgICAgCiAgICAgICAgdWludCBsYXN0UHJvYmFiaWxpdHkgPSAwOwogICAgICAgIHVpbnQgbGFzdE11bHRpcGxpZXIgPSAyKioyNTYgLSAxOwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9wcm9iYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHByb2JhYmlsaXRpZXMucHVzaChfcHJvYmFiaWxpdGllc1tpXSk7CiAgICAgICAgICAgIGlmIChsYXN0UHJvYmFiaWxpdHkgPj0gX3Byb2JhYmlsaXRpZXNbaV0pIHJldmVydCgpOwogICAgICAgICAgICBsYXN0UHJvYmFiaWxpdHkgPSBfcHJvYmFiaWxpdGllc1tpXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9tdWx0aXBsaWVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtdWx0aXBsaWVycy5wdXNoKF9tdWx0aXBsaWVyc1tpXSk7CiAgICAgICAgICAgIGlmIChsYXN0TXVsdGlwbGllciA8PSBfbXVsdGlwbGllcnNbaV0pIHJldmVydCgpOwogICAgICAgICAgICBsYXN0TXVsdGlwbGllciA9IF9tdWx0aXBsaWVyc1tpXTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldE1pbkJldCh1aW50IF9taW5CZXQpIG9ubHlPd25lciB7CiAgICAgICAgbWluQmV0ID0gX21pbkJldDsKICAgIH0KICAgIAogICAgLy8gR0VUVEVSUyAtIENPTlNUQU5UIE1FVEhPRFMKICAgIAogICAgZnVuY3Rpb24gZ2V0U3BpbnNDb250YWluZXIoYnl0ZXMzMiBteWlkKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyhhZGRyZXNzLCB1aW50KSB7CiAgICAgICAgcmV0dXJuIChzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKTsgCiAgICB9CgogICAgLy8gUmV0dXJucyBtaW5pbWFsIGFtb3VudCB0byB3YWdlciB0byByZXR1cm4gYSBwcm9maXQgaW4gY2FzZSBvZiBtYXggd2luCiAgICBmdW5jdGlvbiBnZXRNaW5BbW91bnRUb1dhZ2VyKHVpbnQgX25TcGlucykKICAgICAgICBvbmx5TGVzc1RoYW5NYXhTcGlucyhfblNwaW5zKQogICAgICAgIGNvbnN0YW50CgkJcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBnYXMgPSBfblNwaW5zKk9SQUNMSVpFX1BFUl9TUElOX0dBU19MSU1JVCArIE9SQUNMSVpFX0JBU0VfR0FTX0xJTUlUICsgc2FmZUdhczsKICAgICAgICB1aW50IG9yYWNsaXplRmVlID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpLmdldFByaWNlKCJyYW5kb20iLCBnYXMpOwogICAgICAgIHJldHVybiBtaW5CZXQgKyBvcmFjbGl6ZUZlZS9tdWx0aXBsaWVyc1swXSArIG9yYWNsaXplRmVlOwogICAgfQogICAKICAgIGZ1bmN0aW9uIGdldE1heEFtb3VudFRvV2FnZXIodWludCBfblNwaW5zKQogICAgICAgIG9ubHlMZXNzVGhhbk1heFNwaW5zKF9uU3BpbnMpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgdWludCBvcmFjbGl6ZUZlZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKS5nZXRQcmljZSgicmFuZG9tIiwgX25TcGlucypPUkFDTElaRV9QRVJfU1BJTl9HQVNfTElNSVQgKyBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIHNhZmVHYXMpOwogICAgICAgIHVpbnQgbWF4V2FnZSA9ICAoQ0FQSVRBTF9SSVNLICogZ2V0QmFua3JvbGwoKSkqMTAwMDAvKCgxMDAwMCAtIElOVkVTVE9SU19FREdFKSoxMDAwMCptdWx0aXBsaWVyc1swXSk7CiAgICAgICAgcmV0dXJuIG1heFdhZ2UgKyBvcmFjbGl6ZUZlZTsKICAgIH0KICAgIAp9'.
	

]
