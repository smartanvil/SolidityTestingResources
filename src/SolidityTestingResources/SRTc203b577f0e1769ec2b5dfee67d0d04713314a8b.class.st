Class {
	#name : #SRTc203b577f0e1769ec2b5dfee67d0d04713314a8b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc203b577f0e1769ec2b5dfee67d0d04713314a8b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQovLy8gIGxhdGVyIGNoYW5nZWQKY29udHJhY3QgT3duZWQgewoKICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIG1lc3NhZ2Ugc2VuZGVyIHRvIGJlIGBvd25lcmAKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBpZihtc2cuc2VuZGVyID09IG93bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCi8vLyBAdGl0bGUgVmVzdGluZyB0cnVzdGVlCmNvbnRyYWN0IFRydXN0ZWUgaXMgT3duZWQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIFNIUCBFUkMyMCB0b2tlbi4KICAgIFNIUCBwdWJsaWMgc2hwOwoKICAgIHN0cnVjdCBHcmFudCB7CiAgICAgICAgdWludDI1NiB2YWx1ZTsKICAgICAgICB1aW50MjU2IHN0YXJ0OwogICAgICAgIHVpbnQyNTYgY2xpZmY7CiAgICAgICAgdWludDI1NiBlbmQ7CiAgICAgICAgdWludDI1NiB0cmFuc2ZlcnJlZDsKICAgICAgICBib29sIHJldm9rYWJsZTsKICAgIH0KCiAgICAvLyBHcmFudHMgaG9sZGVyLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBHcmFudCkgcHVibGljIGdyYW50czsKCiAgICAvLyBUb3RhbCB0b2tlbnMgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgdWludDI1NiBwdWJsaWMgdG90YWxWZXN0aW5nOwoKICAgIGV2ZW50IE5ld0dyYW50KGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgVW5sb2NrR3JhbnQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IFJldm9rZUdyYW50KGFkZHJlc3MgaW5kZXhlZCBfaG9sZGVyLCB1aW50MjU2IF9yZWZ1bmQpOwoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIGFkZHJlc3Mgb2YgdGhlIFNIUCBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3NocCBTSFAgVGhlIGFkZHJlc3Mgb2YgdGhlIHByZXZpb3VzbHkgZGVwbG95ZWQgU0hQIHNtYXJ0IGNvbnRyYWN0LgogICAgZnVuY3Rpb24gVHJ1c3RlZShTSFAgX3NocCkgewogICAgICAgIHJlcXVpcmUoX3NocCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBzaHAgPSBfc2hwOwogICAgfQoKICAgIC8vLyBAZGV2IEdyYW50IHRva2VucyB0byBhIHNwZWNpZmllZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBncmFudCB0b2tlbnMgdG8uCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICAvLy8gQHBhcmFtIF9zdGFydCB1aW50MjU2IFRoZSBiZWdpbm5pbmcgb2YgdGhlIHZlc3RpbmcgcGVyaW9kLgogICAgLy8vIEBwYXJhbSBfY2xpZmYgdWludDI1NiBEdXJhdGlvbiBvZiB0aGUgY2xpZmYgcGVyaW9kLgogICAgLy8vIEBwYXJhbSBfZW5kIHVpbnQyNTYgVGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9yZXZva2FibGUgYm9vbCBXaGV0aGVyIHRoZSBncmFudCBpcyByZXZva2FibGUgb3Igbm90LgogICAgZnVuY3Rpb24gZ3JhbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9zdGFydCwgdWludDI1NiBfY2xpZmYsIHVpbnQyNTYgX2VuZCwgYm9vbCBfcmV2b2thYmxlKQogICAgICAgIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGEgc2luZ2xlIGFkZHJlc3MgY2FuIGJlIGdyYW50ZWQgdG9rZW5zIG9ubHkgb25jZS4KICAgICAgICByZXF1aXJlKGdyYW50c1tfdG9dLnZhbHVlID09IDApOwoKICAgICAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvci4KICAgICAgICByZXF1aXJlKF9zdGFydCA8PSBfY2xpZmYgJiYgX2NsaWZmIDw9IF9lbmQpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoaXMgZ3JhbnQgZG9lc24ndCBleGNlZWQgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgY3VycmVudGx5IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICByZXF1aXJlKHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKSA8PSBzaHAuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgLy8gQXNzaWduIGEgbmV3IGdyYW50LgogICAgICAgIGdyYW50c1tfdG9dID0gR3JhbnQoewogICAgICAgICAgICB2YWx1ZTogX3ZhbHVlLAogICAgICAgICAgICBzdGFydDogX3N0YXJ0LAogICAgICAgICAgICBjbGlmZjogX2NsaWZmLAogICAgICAgICAgICBlbmQ6IF9lbmQsCiAgICAgICAgICAgIHRyYW5zZmVycmVkOiAwLAogICAgICAgICAgICByZXZva2FibGU6IF9yZXZva2FibGUKICAgICAgICB9KTsKCiAgICAgICAgLy8gVG9rZW5zIGdyYW50ZWQsIHJlZHVjZSB0aGUgdG90YWwgYW1vdW50IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3RpbmcuYWRkKF92YWx1ZSk7CgogICAgICAgIE5ld0dyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgIGZ1bmN0aW9uIHJldm9rZShhZGRyZXNzIF9ob2xkZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOwoKICAgICAgICByZXF1aXJlKGdyYW50LnJldm9rYWJsZSk7CgogICAgICAgIC8vIFNlbmQgdGhlIHJlbWFpbmluZyBTSFAgYmFjayB0byB0aGUgb3duZXIuCiAgICAgICAgdWludDI1NiByZWZ1bmQgPSBncmFudC52YWx1ZS5zdWIoZ3JhbnQudHJhbnNmZXJyZWQpOwoKICAgICAgICAvLyBSZW1vdmUgdGhlIGdyYW50LgogICAgICAgIGRlbGV0ZSBncmFudHNbX2hvbGRlcl07CgogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5zdWIocmVmdW5kKTsKICAgICAgICBzaHAudHJhbnNmZXIobXNnLnNlbmRlciwgcmVmdW5kKTsKCiAgICAgICAgUmV2b2tlR3JhbnQoX2hvbGRlciwgcmVmdW5kKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZS4KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIuCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHNwZWNpZmljIHRpbWUuCiAgICAvLy8gQHJldHVybiBhIHVpbnQyNTYgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMuCiAgICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF90aW1lKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOwogICAgICAgIGlmIChncmFudC52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgX3RpbWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmMgdGltZS4KICAgIC8vLyBAcGFyYW0gX2dyYW50IEdyYW50IFRoZSB2ZXN0aW5nIGdyYW50LgogICAgLy8vIEBwYXJhbSBfdGltZSB1aW50MjU2IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgIC8vLyBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50LgogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QKICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgIF8vCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgIC8KICAgIC8vLyAgIHwgICAgICAgICAgICAgIC58CiAgICAvLy8gICB8ICAgICAgICAgICAgLiAgfAogICAgLy8vICAgfCAgICAgICAgICAuICAgIHwKICAgIC8vLyAgIHwgICAgICAgIC4gICAgICB8CiAgICAvLy8gICB8ICAgICAgLiAgICAgICAgfAogICAgLy8vICAgfCAgICAuICAgICAgICAgIHwKICAgIC8vLyAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKICAgIC8vLyAgICAgU3RhcnQgICAgICAgQ2xpZmYgICAgICBFbmQKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhHcmFudCBfZ3JhbnQsIHVpbnQyNTYgX3RpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIElmIHdlJ3JlIGJlZm9yZSB0aGUgY2xpZmYsIHRoZW4gbm90aGluZyBpcyB2ZXN0ZWQuCiAgICAgICAgaWYgKF90aW1lIDwgX2dyYW50LmNsaWZmKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgd2UncmUgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QgLSBldmVyeXRoaW5nIGlzIHZlc3RlZDsKICAgICAgICBpZiAoX3RpbWUgPj0gX2dyYW50LmVuZCkgewogICAgICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlOwogICAgICAgIH0KCiAgICAgICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnM6IHZlc3RlZFRva2VucyA9IHRva2Vucy8vLyAodGltZSAtIHN0YXJ0KSAvIChlbmQgLSBzdGFydCkKICAgICAgICAgcmV0dXJuIF9ncmFudC52YWx1ZS5tdWwoX3RpbWUuc3ViKF9ncmFudC5zdGFydCkpLmRpdihfZ3JhbnQuZW5kLnN1YihfZ3JhbnQuc3RhcnQpKTsKICAgIH0KCiAgICAvLy8gQGRldiBVbmxvY2sgdmVzdGVkIHRva2VucyBhbmQgdHJhbnNmZXIgdGhlbSB0byB0aGVpciBob2xkZXIuCiAgICAvLy8gQHJldHVybiBhIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyB0cmFuc2ZlcnJlZCB0byB0aGVpciBob2xkZXIuCiAgICBmdW5jdGlvbiB1bmxvY2tWZXN0ZWRUb2tlbnMoKSBwdWJsaWMgewogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUoZ3JhbnQudmFsdWUgIT0gMCk7CgogICAgICAgIC8vIEdldCB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMsIGFjY2NvcmRpbmcgdG8gZ3JhbnQuCiAgICAgICAgdWludDI1NiB2ZXN0ZWQgPSBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoZ3JhbnQsIG5vdyk7CiAgICAgICAgaWYgKHZlc3RlZCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgaG9sZGVyIGRvZXNuJ3QgdHJhbnNmZXIgbW9yZSB0aGFuIHdoYXQgaGUgYWxyZWFkeSBoYXMuCiAgICAgICAgdWludDI1NiB0cmFuc2ZlcmFibGUgPSB2ZXN0ZWQuc3ViKGdyYW50LnRyYW5zZmVycmVkKTsKICAgICAgICBpZiAodHJhbnNmZXJhYmxlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ3JhbnQudHJhbnNmZXJyZWQgPSBncmFudC50cmFuc2ZlcnJlZC5hZGQodHJhbnNmZXJhYmxlKTsKICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3Rpbmcuc3ViKHRyYW5zZmVyYWJsZSk7CiAgICAgICAgc2hwLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7CgogICAgICAgIFVubG9ja0dyYW50KG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7CiAgICB9Cn0KCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsKCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CgogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKCiAgICAvLyBgcGFyZW50U25hcFNob3RCbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRoZSBQYXJlbnQgVG9rZW4gdGhhdCB3YXMKICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOwoKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICAvLyBgYWxsb3dlZGAgdHJhY2tzIGFueSBleHRyYSB0cmFuc2ZlciByaWdodHMgYXMgaW4gYWxsIEVSQzIwIHRva2VucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CgogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIC8vIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIG5ldyBjbG9uZSB0b2tlbnMKICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIHJlcXVpcmUocGFyZW50U25hcFNob3RCbG9jayA8IGJsb2NrLm51bWJlcik7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIHJlcXVpcmUoKF90byAhPSAwKSAmJiAoX3RvICE9IGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSk7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YKICAgICAgICAvLyAgdGhpcyB0b2tlbgogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudAogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgYmFsYW5jZSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPj0gY3VyVG90YWxTdXBwbHkpOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSA+PSBfYW1vdW50KTsKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZUZyb20gPj0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGlzQ29udHJhY3QoY29udHJvbGxlcikpOwogICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKTsKICAgIH0KCi8vLy8vLy8vLy8KLy8gU2FmZXR5IE1ldGhvZHMKLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSAKICAgIHsKICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3BhcmVudFRva2VuLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX3Rva2VuTmFtZSwKICAgICAgICAgICAgX2RlY2ltYWxVbml0cywKICAgICAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKY29udHJhY3QgU0hQIGlzIE1pbmlNZVRva2VuIHsKICAgIC8vIEBkZXYgU0hQIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTSFAoYWRkcmVzcyBfdG9rZW5GYWN0b3J5KQogICAgICAgICAgICBNaW5pTWVUb2tlbigKICAgICAgICAgICAgICAgIF90b2tlbkZhY3RvcnksCiAgICAgICAgICAgICAgICAweDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgICAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgICAgICAgICAgICAgIlNoYXJwZSBQbGF0Zm9ybSBUb2tlbiIsICAgICAgICAgLy8gVG9rZW4gbmFtZQogICAgICAgICAgICAgICAgMTgsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMKICAgICAgICAgICAgICAgICJTSFAiLCAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbAogICAgICAgICAgICAgICAgdHJ1ZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlIHRyYW5zZmVycwogICAgICAgICAgICApIHt9Cn0KCmNvbnRyYWN0IEFmZmlsaWF0ZVV0aWxpdHkgaXMgT3duZWQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIHRpZXJUd29NaW47CiAgICB1aW50MjU2IHB1YmxpYyB0aWVyVGhyZWVNaW47CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVElFUjFfUEVSQ0VOVCA9IDM7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUSUVSMl9QRVJDRU5UID0gNDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRJRVIzX1BFUkNFTlQgPSA1OwogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEFmZmlsaWF0ZSkgcHJpdmF0ZSBhZmZpbGlhdGVzOwoKICAgIGV2ZW50IEFmZmlsaWF0ZVJlY2VpdmVkKGFkZHJlc3MgYWZmaWxpYXRlQWRkcmVzcywgYWRkcmVzcyBpbnZlc3RvckFkZHJlc3MsIGJvb2wgdmFsaWQpOwoKICAgIHN0cnVjdCBBZmZpbGlhdGUgewogICAgICAgIGFkZHJlc3MgZXRoZXJBZGRyZXNzOwogICAgICAgIGJvb2wgaXNQcmVzZW50OwogICAgfQoKICAgIGZ1bmN0aW9uIEFmZmlsaWF0ZVV0aWxpdHkodWludDI1NiBfdGllclR3b01pbiwgdWludDI1NiBfdGllclRocmVlTWluKSB7CiAgICAgICAgc2V0VGllcnMoX3RpZXJUd29NaW4sIF90aWVyVGhyZWVNaW4pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHNldHMgdGhlIEV0aGVyIHRvIERvbGxhciBleGhjaGFuZ2UgcmF0ZQogICAgLy8vIEBwYXJhbSBfdGllclR3b01pbiB0aGUgdGllciAyIG1pbiAoaW4gV0VJKQogICAgLy8vIEBwYXJhbSBfdGllclRocmVlTWluIHRoZSB0aWVyIDMgbWluIChpbiBXRUkpCiAgICBmdW5jdGlvbiBzZXRUaWVycyh1aW50MjU2IF90aWVyVHdvTWluLCB1aW50MjU2IF90aWVyVGhyZWVNaW4pIG9ubHlPd25lciB7CiAgICAgICAgdGllclR3b01pbiA9IF90aWVyVHdvTWluOwogICAgICAgIHRpZXJUaHJlZU1pbiA9IF90aWVyVGhyZWVNaW47CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhpcyBhZGRzIGFuIGFmZmlsaWF0ZSBFdGhlcmV1bSBhZGRyZXNzIHRvIG91ciB3aGl0ZWxpc3QKICAgIC8vLyBAcGFyYW0gX2ludmVzdG9yIFRoZSBpbnZlc3RvcidzIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX2FmZmlsaWF0ZSBUaGUgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgYWZmaWxpYXRlCiAgICBmdW5jdGlvbiBhZGRBZmZpbGlhdGUoYWRkcmVzcyBfaW52ZXN0b3IsIGFkZHJlc3MgX2FmZmlsaWF0ZSkgb25seU93bmVyIHsKICAgICAgICBhZmZpbGlhdGVzW19pbnZlc3Rvcl0gPSBBZmZpbGlhdGUoX2FmZmlsaWF0ZSwgdHJ1ZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2FsY3VsYXRlcyBhbmQgcmV0dXJucyB0aGUgYW1vdW50IHRvIHRva2VuIG1pbnRlZCBmb3IgYWZmaWxsaWF0ZQogICAgLy8vIEBwYXJhbSBfaW52ZXN0b3IgYWRkcmVzcyBvZiB0aGUgaW52ZXN0b3IKICAgIC8vLyBAcGFyYW0gX2NvbnRyaWJ1dG9yVG9rZW5zIGFtb3VudCBvZiBTSFAgdG9rZW5zIG1pbnRlZCBmb3IgY29udHJpYnV0b3IKICAgIC8vLyBAcGFyYW0gX2NvbnRyaWJ1dGlvblZhbHVlIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQKICAgIC8vLyBAcmV0dXJuIHR1cGxlIG9mIHR3byB2YWx1ZXMgKGFmZmlsaWF0ZUJvbnVzLCBjb250cmlidXRvckJvdW5zKQogICAgZnVuY3Rpb24gYXBwbHlBZmZpbGlhdGUoCiAgICAgICAgYWRkcmVzcyBfaW52ZXN0b3IsIAogICAgICAgIHVpbnQyNTYgX2NvbnRyaWJ1dG9yVG9rZW5zLCAKICAgICAgICB1aW50MjU2IF9jb250cmlidXRpb25WYWx1ZQogICAgKQogICAgICAgIHB1YmxpYyAKICAgICAgICByZXR1cm5zKHVpbnQyNTYsIHVpbnQyNTYpIAogICAgewogICAgICAgIGlmIChnZXRBZmZpbGlhdGUoX2ludmVzdG9yKSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHJldHVybiAoMCwgMCk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGNvbnRyaWJ1dG9yQm9udXMgPSBfY29udHJpYnV0b3JUb2tlbnMuZGl2KDEwMCk7CiAgICAgICAgdWludDI1NiBhZmZpbGlhdGVCb251cyA9IDA7CgogICAgICAgIGlmIChfY29udHJpYnV0aW9uVmFsdWUgPCB0aWVyVHdvTWluKSB7CiAgICAgICAgICAgIGFmZmlsaWF0ZUJvbnVzID0gX2NvbnRyaWJ1dG9yVG9rZW5zLm11bChUSUVSMV9QRVJDRU5UKS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgaWYgKF9jb250cmlidXRpb25WYWx1ZSA+PSB0aWVyVHdvTWluICYmIF9jb250cmlidXRpb25WYWx1ZSA8IHRpZXJUaHJlZU1pbikgewogICAgICAgICAgICBhZmZpbGlhdGVCb251cyA9IF9jb250cmlidXRvclRva2Vucy5tdWwoVElFUjJfUEVSQ0VOVCkuZGl2KDEwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWZmaWxpYXRlQm9udXMgPSBfY29udHJpYnV0b3JUb2tlbnMubXVsKFRJRVIzX1BFUkNFTlQpLmRpdigxMDApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuKGFmZmlsaWF0ZUJvbnVzLCBjb250cmlidXRvckJvbnVzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBGZXRjaGVzIHRoZSBFdGhlcmV1bSBhZGRyZXNzIG9mIGEgdmFsaWQgYWZmaWxpYXRlCiAgICAvLy8gQHBhcmFtIF9pbnZlc3RvciBUaGUgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgaW52ZXN0b3IKICAgIC8vLyBAcmV0dXJuIFRoZSBFdGhlcmV1bSBhZGRyZXNzIGFzIGFuIGFkZHJlc3MgdHlwZQogICAgZnVuY3Rpb24gZ2V0QWZmaWxpYXRlKGFkZHJlc3MgX2ludmVzdG9yKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYWZmaWxpYXRlc1tfaW52ZXN0b3JdLmV0aGVyQWRkcmVzczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgaWYgYW4gYWZmaWxpYXRlIGlzIHZhbGlkCiAgICAvLy8gQHBhcmFtIF9pbnZlc3RvciBUaGUgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgaW52ZXN0b3IKICAgIC8vLyBAcmV0dXJuIFRydWUgb3IgRmFsc2UKICAgIGZ1bmN0aW9uIGlzQWZmaWxpYXRlVmFsaWQoYWRkcmVzcyBfaW52ZXN0b3IpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBBZmZpbGlhdGUgbWVtb3J5IGFmZmlsaWF0ZSA9IGFmZmlsaWF0ZXNbX2ludmVzdG9yXTsKICAgICAgICBBZmZpbGlhdGVSZWNlaXZlZChhZmZpbGlhdGUuZXRoZXJBZGRyZXNzLCBfaW52ZXN0b3IsIGFmZmlsaWF0ZS5pc1ByZXNlbnQpOwogICAgICAgIHJldHVybiBhZmZpbGlhdGUuaXNQcmVzZW50OwogICAgfQp9Cgpjb250cmFjdCBTQ0QgaXMgTWluaU1lVG9rZW4gewogICAgLy8gQGRldiBTQ0QgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNDRChhZGRyZXNzIF90b2tlbkZhY3RvcnkpCiAgICAgICAgICAgIE1pbmlNZVRva2VuKAogICAgICAgICAgICAgICAgX3Rva2VuRmFjdG9yeSwKICAgICAgICAgICAgICAgIDB4MCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHBhcmVudCB0b2tlbgogICAgICAgICAgICAgICAgMCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gc25hcHNob3QgYmxvY2sgbnVtYmVyIGZyb20gcGFyZW50CiAgICAgICAgICAgICAgICAiU2hhcnBlIENyeXB0by1EZXJpdmF0aXZlIiwgICAgICAvLyBUb2tlbiBuYW1lCiAgICAgICAgICAgICAgICAxOCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWNpbWFscwogICAgICAgICAgICAgICAgIlNDRCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sCiAgICAgICAgICAgICAgICB0cnVlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgdHJhbnNmZXJzCiAgICAgICAgICAgICkge30KfQoKCmNvbnRyYWN0IFRva2VuU2FsZSBpcyBPd25lZCwgVG9rZW5Db250cm9sbGVyIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICBTSFAgcHVibGljIHNocDsKICAgIEFmZmlsaWF0ZVV0aWxpdHkgcHVibGljIGFmZmlsaWF0ZVV0aWxpdHk7CiAgICBUcnVzdGVlIHB1YmxpYyB0cnVzdGVlOwoKICAgIGFkZHJlc3MgcHVibGljIGV0aGVyRXNjcm93QWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGJvdW50eUFkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyB0cnVzdGVlQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGFwaUFkZHJlc3M7CgogICAgdWludDI1NiBwdWJsaWMgZm91bmRlclRva2VuQ291bnQgPSAwOwogICAgdWludDI1NiBwdWJsaWMgcmVzZXJ2ZVRva2VuQ291bnQgPSAwOwoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIENBTExFUl9FWENIQU5HRV9SQVRFID0gMjAwMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFJFU0VSVkVfRVhDSEFOR0VfUkFURSA9IDE1MDA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBGT1VOREVSX0VYQ0hBTkdFX1JBVEUgPSAxMDAwOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgQk9VTlRZX0VYQ0hBTkdFX1JBVEUgPSA1MDA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBNQVhfR0FTX1BSSUNFID0gNTAwMDAwMDAwMDA7CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkOwogICAgYm9vbCBwdWJsaWMgY2xvc2VkOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgYXBwcm92ZWRBZGRyZXNzZXM7CgogICAgZXZlbnQgQ29udHJpYnV0aW9uKHVpbnQyNTYgZXRoZXJBbW91bnQsIGFkZHJlc3MgX2NhbGxlcik7CiAgICBldmVudCBOZXdTYWxlKGFkZHJlc3MgaW5kZXhlZCBjYWxsZXIsIHVpbnQyNTYgZXRoZXJBbW91bnQsIHVpbnQyNTYgdG9rZW5zR2VuZXJhdGVkKTsKICAgIGV2ZW50IFNhbGVDbG9zZWQodWludDI1NiB3aGVuKTsKICAgIAogICAgbW9kaWZpZXIgbm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RDbG9zZWQoKSB7CiAgICAgICAgcmVxdWlyZSghY2xvc2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBcGkoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFwaUFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNWYWxpZGF0ZWQoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKCFpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKTsgCiAgICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSBNQVhfR0FTX1BSSUNFKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzQXBwcm92ZWQoKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlZEFkZHJlc3Nlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBZGRzIGFuIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRoZSBzYWxlCiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgZm9yIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gYXBwcm92ZUFkZHJlc3MoYWRkcmVzcyBfYWRkcikgcHVibGljIG9ubHlBcGkgewogICAgICAgIGFwcHJvdmVkQWRkcmVzc2VzW19hZGRyXSA9IHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2Qgc2VuZHMgdGhlIEV0aGVyIHJlY2VpdmVkIHRvIHRoZSBFdGhlciBlc2Nyb3cgYWRkcmVzcwogICAgLy8vIGFuZCBnZW5lcmF0ZXMgdGhlIGNhbGN1bGF0ZWQgbnVtYmVyIG9mIFNIUCB0b2tlbnMsIHNlbmRpbmcgdGhlbSB0byB0aGUgY2FsbGVyJ3MgYWRkcmVzcy4KICAgIC8vLyBJdCBhbHNvIGdlbmVyYXRlcyB0aGUgZm91bmRlcidzIHRva2VucyBhbmQgdGhlIHJlc2VydmUgdG9rZW5zIGF0IHRoZSBzYW1lIHRpbWUuCiAgICBmdW5jdGlvbiBkb0J1eSgKICAgICAgICBhZGRyZXNzIF9jYWxsZXIsCiAgICAgICAgdWludDI1NiBldGhlckFtb3VudAogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CgogICAgICAgIENvbnRyaWJ1dGlvbihldGhlckFtb3VudCwgX2NhbGxlcik7CgogICAgICAgIHVpbnQyNTYgY2FsbGVyVG9rZW5zID0gZXRoZXJBbW91bnQubXVsKENBTExFUl9FWENIQU5HRV9SQVRFKTsKICAgICAgICB1aW50MjU2IGNhbGxlclRva2Vuc1dpdGhEaXNjb3VudCA9IGFwcGx5RGlzY291bnQoZXRoZXJBbW91bnQsIGNhbGxlclRva2Vucyk7CgogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZVRva2VucyA9IGV0aGVyQW1vdW50Lm11bChSRVNFUlZFX0VYQ0hBTkdFX1JBVEUpOwogICAgICAgIHVpbnQyNTYgZm91bmRlclRva2VucyA9IGV0aGVyQW1vdW50Lm11bChGT1VOREVSX0VYQ0hBTkdFX1JBVEUpOwogICAgICAgIHVpbnQyNTYgYm91bnR5VG9rZW5zID0gZXRoZXJBbW91bnQubXVsKEJPVU5UWV9FWENIQU5HRV9SQVRFKTsKICAgICAgICB1aW50MjU2IHZlc3RpbmdUb2tlbnMgPSBmb3VuZGVyVG9rZW5zLmFkZChyZXNlcnZlVG9rZW5zKTsKCiAgICAgICAgZm91bmRlclRva2VuQ291bnQgPSBmb3VuZGVyVG9rZW5Db3VudC5hZGQoZm91bmRlclRva2Vucyk7CiAgICAgICAgcmVzZXJ2ZVRva2VuQ291bnQgPSByZXNlcnZlVG9rZW5Db3VudC5hZGQocmVzZXJ2ZVRva2Vucyk7CgogICAgICAgIHBheUFmZmlsaWF0ZShjYWxsZXJUb2tlbnNXaXRoRGlzY291bnQsIG1zZy52YWx1ZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHNocC5nZW5lcmF0ZVRva2VucyhfY2FsbGVyLCBjYWxsZXJUb2tlbnNXaXRoRGlzY291bnQpOwogICAgICAgIHNocC5nZW5lcmF0ZVRva2Vucyhib3VudHlBZGRyZXNzLCBib3VudHlUb2tlbnMpOwogICAgICAgIHNocC5nZW5lcmF0ZVRva2Vucyh0cnVzdGVlQWRkcmVzcywgdmVzdGluZ1Rva2Vucyk7CgogICAgICAgIE5ld1NhbGUoX2NhbGxlciwgZXRoZXJBbW91bnQsIGNhbGxlclRva2Vuc1dpdGhEaXNjb3VudCk7CiAgICAgICAgTmV3U2FsZSh0cnVzdGVlQWRkcmVzcywgZXRoZXJBbW91bnQsIHZlc3RpbmdUb2tlbnMpOwogICAgICAgIE5ld1NhbGUoYm91bnR5QWRkcmVzcywgZXRoZXJBbW91bnQsIGJvdW50eVRva2Vucyk7CgogICAgICAgIGV0aGVyRXNjcm93QWRkcmVzcy50cmFuc2ZlcihldGhlckFtb3VudCk7CiAgICAgICAgdXBkYXRlQ291bnRlcnMoZXRoZXJBbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFwcGxpZXMgdGhlIGRpc2NvdW50IGJhc2VkIG9uIHRoZSBkaXNjb3VudCB0aWVycwogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgVGhlIGFtb3VudCBvZiBldGhlciB1c2VkIHRvIGV2YWx1YXRlIHRoZSB0aWVyIHRoZSBjb250cmlidXRpb24gbGllcyB3aXRoaW4KICAgIC8vLyBAcGFyYW0gX2NvbnRyaWJ1dG9yVG9rZW5zIFRoZSB0b2tlbnMgYWxsb2NhdGVkIGJhc2VkIG9uIHRoZSBjb250cmlidXRpb24KICAgIGZ1bmN0aW9uIGFwcGx5RGlzY291bnQodWludDI1NiBfZXRoZXJBbW91bnQsIHVpbnQyNTYgX2NvbnRyaWJ1dG9yVG9rZW5zKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKCiAgICAvLy8gQG5vdGljZSBVcGRhdGVzIHRoZSBjb3VudGVycyBmb3IgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCB0aGUgYW1vdW50IG9mIEV0aGVyIHBhaWQKICAgIGZ1bmN0aW9uIHVwZGF0ZUNvdW50ZXJzKHVpbnQyNTYgX2V0aGVyQW1vdW50KSBpbnRlcm5hbDsKICAgIAogICAgLy8vIEBub3RpY2UgUGFyZW50IGNvbnN0cnVjdG9yLiBUaGlzIG5lZWRzIHRvIGJlIGV4dGVuZGVkIGZyb20gdGhlIGNoaWxkIGNvbnRyYWN0cwogICAgLy8vIEBwYXJhbSBfZXRoZXJFc2Nyb3dBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBjcm93ZCBmdW5kZWQgRXRoZXIKICAgIC8vLyBAcGFyYW0gX2JvdW50eUFkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIGJvdW50eSBzY2hlbWUgU0hQCiAgICAvLy8gQHBhcmFtIF90cnVzdGVlQWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgdmVzdGluZyBTSFAKICAgIC8vLyBAcGFyYW0gX2FmZmlsaWF0ZVV0aWxpdHlBZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIGRlcGxveWVkIEFmZmlsaWF0ZVV0aWxpdHkgY29udHJhY3QuCiAgICBmdW5jdGlvbiBUb2tlblNhbGUgKAogICAgICAgIGFkZHJlc3MgX2V0aGVyRXNjcm93QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9ib3VudHlBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3RydXN0ZWVBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX2FmZmlsaWF0ZVV0aWxpdHlBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX2FwaUFkZHJlc3MKICAgICkgewogICAgICAgIGV0aGVyRXNjcm93QWRkcmVzcyA9IF9ldGhlckVzY3Jvd0FkZHJlc3M7CiAgICAgICAgYm91bnR5QWRkcmVzcyA9IF9ib3VudHlBZGRyZXNzOwogICAgICAgIHRydXN0ZWVBZGRyZXNzID0gX3RydXN0ZWVBZGRyZXNzOwogICAgICAgIGFwaUFkZHJlc3MgPSBfYXBpQWRkcmVzczsKICAgICAgICBhZmZpbGlhdGVVdGlsaXR5ID0gQWZmaWxpYXRlVXRpbGl0eShfYWZmaWxpYXRlVXRpbGl0eUFkZHJlc3MpOwogICAgICAgIHRydXN0ZWUgPSBUcnVzdGVlKF90cnVzdGVlQWRkcmVzcyk7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBjbG9zZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBQYXlzIGFuIGFmZmlsaWF0ZSBpZiB0aGV5IGFyZSB2YWxpZCBhbmQgcHJlc2VudCBpbiB0aGUgdHJhbnNhY3Rpb24gZGF0YQogICAgLy8vIEBwYXJhbSBfdG9rZW5zIFRoZSBjb250cmlidXRpb24gdG9rZW5zIHVzZWQgdG8gY2FsY3VsYXRlIGFmZmlsaWF0ZSBwYXltZW50IGFtb3VudAogICAgLy8vIEBwYXJhbSBfZXRoZXJWYWx1ZSBUaGUgRXRoZXIgdmFsdWUgc2VudAogICAgLy8vIEBwYXJhbSBfY2FsbGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjYWxsZXIKICAgIGZ1bmN0aW9uIHBheUFmZmlsaWF0ZSh1aW50MjU2IF90b2tlbnMsIHVpbnQyNTYgX2V0aGVyVmFsdWUsIGFkZHJlc3MgX2NhbGxlcikgaW50ZXJuYWwgewogICAgICAgIGlmIChhZmZpbGlhdGVVdGlsaXR5LmlzQWZmaWxpYXRlVmFsaWQoX2NhbGxlcikpIHsKICAgICAgICAgICAgYWRkcmVzcyBhZmZpbGlhdGUgPSBhZmZpbGlhdGVVdGlsaXR5LmdldEFmZmlsaWF0ZShfY2FsbGVyKTsKICAgICAgICAgICAgdmFyIChhZmZpbGlhdGVCb251cywgY29udHJpYnV0b3JCb251cykgPSBhZmZpbGlhdGVVdGlsaXR5LmFwcGx5QWZmaWxpYXRlKF9jYWxsZXIsIF90b2tlbnMsIF9ldGhlclZhbHVlKTsKICAgICAgICAgICAgc2hwLmdlbmVyYXRlVG9rZW5zKGFmZmlsaWF0ZSwgYWZmaWxpYXRlQm9udXMpOwogICAgICAgICAgICBzaHAuZ2VuZXJhdGVUb2tlbnMoX2NhbGxlciwgY29udHJpYnV0b3JCb251cyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIFNIUCB0b2tlbiBzbWFydCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfc2hwIHRoZSBTSFAgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0U2hwKGFkZHJlc3MgX3NocCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc2hwID0gU0hQKF9zaHApOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBvd25lcnNoaXAgb2YgdGhlIHRva2VuIHNtYXJ0IGNvbnRyYWN0IGFuZCB0cnVzdGVlCiAgICAvLy8gQHBhcmFtIF90b2tlbkNvbnRyb2xsZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cm9sbGVyCiAgICAvLy8gQHBhcmFtIF90cnVzdGVlT3duZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0cnVzdGVlIG93bmVyCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF90b2tlbkNvbnRyb2xsZXIsIGFkZHJlc3MgX3RydXN0ZWVPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShjbG9zZWQpOwogICAgICAgIHJlcXVpcmUoX3Rva2VuQ29udHJvbGxlciAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RydXN0ZWVPd25lciAhPSAweDApOwogICAgICAgIHNocC5jaGFuZ2VDb250cm9sbGVyKF90b2tlbkNvbnRyb2xsZXIpOwogICAgICAgIHRydXN0ZWUuY2hhbmdlT3duZXIoX3RydXN0ZWVPd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY2FsbGVyIFRoZSBhZGRyZXNzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYGNhbGxlcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9jYWxsZXIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgYXNzZW1ibHkgeyBzaXplIDo9IGV4dGNvZGVzaXplKF9jYWxsZXIpIH0KICAgICAgICByZXR1cm4gc2l6ZSA+IDA7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUGF1c2VzIHRoZSBjb250cmlidXRpb24gaWYgdGhlcmUgaXMgYW55IGlzc3VlCiAgICBmdW5jdGlvbiBwYXVzZUNvbnRyaWJ1dGlvbigpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmVzdW1lcyB0aGUgY29udHJpYnV0aW9uCiAgICBmdW5jdGlvbiByZXN1bWVDb250cmlidXRpb24oKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLy8vLy8vLy8vCiAgICAvLyBNaW5pTWUgQ29udHJvbGxlciBJbnRlcmZhY2UgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vCgogICAgLy8gSW4gYmV0d2VlbiB0aGUgb2ZmZXJpbmcgYW5kIHRoZSBuZXR3b3JrLiBEZWZhdWx0IHNldHRpbmdzIGZvciBhbGxvd2luZyB0b2tlbiB0cmFuc2ZlcnMuCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcykgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzLCBhZGRyZXNzLCB1aW50MjU2KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQoKCmNvbnRyYWN0IFNoYXJwZVByZXNhbGUgaXMgVG9rZW5TYWxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHdoaXRlbGlzdDsKICAgIAogICAgdWludDI1NiBwdWJsaWMgcHJlU2FsZUV0aGVyUGFpZCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbENvbnRyaWJ1dGlvbnMgPSAwOwogICAgdWludDI1NiBwdWJsaWMgd2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucyA9IDA7CgogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgRklSU1RfVElFUl9ESVNDT1VOVCA9IDEwOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgU0VDT05EX1RJRVJfRElTQ09VTlQgPSAyMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFRISVJEX1RJRVJfRElTQ09VTlQgPSAzMDsKCiAgICB1aW50MjU2IHB1YmxpYyBtaW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyBtYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXI7CgogICAgdWludDI1NiBwdWJsaWMgZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyB0aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcjsKCiAgICB1aW50MjU2IHB1YmxpYyBwcmVTYWxlQ2FwOwogICAgdWludDI1NiBwdWJsaWMgaG9ub3VyV2hpdGVsaXN0RW5kOwoKICAgIGFkZHJlc3MgcHVibGljIHByZXNhbGVBZGRyZXNzOwogICAgCiAgICBlbnVtIENvbnRyaWJ1dGlvblN0YXRlIHtQYXVzZWQsIFJlc3VtZWR9CiAgICBldmVudCBDb250cmlidXRpb25TdGF0ZUNoYW5nZWQoYWRkcmVzcyBjYWxsZXIsIENvbnRyaWJ1dGlvblN0YXRlIGNvbnRyaWJ1dGlvblN0YXRlKTsKICAgIGVudW0gQWxsb3dlZENvbnRyaWJ1dGlvblN0YXRlIHtXaGl0ZWxpc3RlZCwgTm90V2hpdGVsaXN0ZWQsIEFib3ZlV2hpdGVsaXN0ZWQsIEJlbG93V2hpdGVsaXN0ZWQsIFdoaXRlbGlzdENsb3NlZH0KICAgIGV2ZW50IEFsbG93ZWRDb250cmlidXRpb25DaGVjayh1aW50MjU2IGNvbnRyaWJ1dGlvbiwgQWxsb3dlZENvbnRyaWJ1dGlvblN0YXRlIGFsbG93ZWRDb250cmlidXRpb25TdGF0ZSk7CiAgICBldmVudCBWYWxpZENvbnRyaWJ1dGlvbkNoZWNrKHVpbnQyNTYgY29udHJpYnV0aW9uLCBib29sIGlzQ29udHJpYnV0aW9uVmFsaWQpOwogICAgZXZlbnQgRGlzY291bnRBcHBsaWVkKHVpbnQyNTYgZXRoZXJBbW91bnQsIHVpbnQyNTYgdG9rZW5zLCB1aW50MjU2IGRpc2NvdW50KTsKICAgIGV2ZW50IENvbnRyaWJ1dGlvblJlZnVuZCh1aW50MjU2IGV0aGVyQW1vdW50LCBhZGRyZXNzIF9jYWxsZXIpOwogICAgZXZlbnQgQ291bnRlcnNVcGRhdGVkKHVpbnQyNTYgcHJlU2FsZUV0aGVyUGFpZCwgdWludDI1NiB0b3RhbENvbnRyaWJ1dGlvbnMpOwogICAgZXZlbnQgV2hpdGVsaXN0ZWRVcGRhdGVkKHVpbnQyNTYgcGxhbm5lZENvbnRyaWJ1dGlvbiwgYm9vbCBjb250cmlidXRlZCk7CiAgICBldmVudCBXaGl0ZWxpc3RlZENvdW50ZXJVcGRhdGVkKHVpbnQyNTYgd2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucywgdWludDI1NiB1c2VkQ29udHJpYnV0aW9ucyk7CgogICAgbW9kaWZpZXIgaXNWYWxpZENvbnRyaWJ1dGlvbigpIHsKICAgICAgICByZXF1aXJlKHZhbGlkQ29udHJpYnV0aW9uKCkpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2FsbGVkIG9ubHkgb25jZSB3aGVuIHRoZSBjb250cmFjdCBpcyBpbml0aWFsaXplZAogICAgLy8vIEBwYXJhbSBfZXRoZXJFc2Nyb3dBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBjcm93ZCBmdW5kZWQgRXRoZXIKICAgIC8vLyBAcGFyYW0gX2JvdW50eUFkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIGJvdW50eSBTSFAKICAgIC8vLyBAcGFyYW0gX3RydXN0ZWVBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSB2ZXN0aW5nIFNIUAogICAgLy8vIEBwYXJhbSBfZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgRmlyc3QgZGlzY291bnQgbGltaXRzIChXRUkpCiAgICAvLy8gQHBhcmFtIF9zZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgU2Vjb25kIGRpc2NvdW50IGxpbWl0cyAoV0VJKQogICAgLy8vIEBwYXJhbSBfdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgVGhpcmQgZGlzY291bnQgbGltaXRzIChXRUkpCiAgICAvLy8gQHBhcmFtIF9taW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgTG93ZXIgY29udHJpYnV0aW9uIHJhbmdlIChXRUkpCiAgICAvLy8gQHBhcmFtIF9tYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgVXBwZXIgY29udHJpYnV0aW9uIHJhbmdlIChXRUkpCiAgICAvLy8gQHBhcmFtIF9wcmVTYWxlQ2FwIFByZXNhbGUgY2FwIChXRUkpCiAgICAvLy8gQHBhcmFtIF9ob25vdXJXaGl0ZWxpc3RFbmQgRW5kIHRpbWUgb2Ygd2hpdGVsaXN0IHBlcmlvZAogICAgZnVuY3Rpb24gU2hhcnBlUHJlc2FsZSgKICAgICAgICBhZGRyZXNzIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYm91bnR5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90cnVzdGVlQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9hcGlBZGRyZXNzLAogICAgICAgIHVpbnQyNTYgX2ZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyLAogICAgICAgIHVpbnQyNTYgX3NlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciwKICAgICAgICB1aW50MjU2IF90aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciwKICAgICAgICB1aW50MjU2IF9taW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIsCiAgICAgICAgdWludDI1NiBfbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyLAogICAgICAgIHVpbnQyNTYgX3ByZVNhbGVDYXAsCiAgICAgICAgdWludDI1NiBfaG9ub3VyV2hpdGVsaXN0RW5kKQogICAgICAgIFRva2VuU2FsZSAoCiAgICAgICAgICAgIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgICAgIF9ib3VudHlBZGRyZXNzLAogICAgICAgICAgICBfdHJ1c3RlZUFkZHJlc3MsCiAgICAgICAgICAgIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcywKICAgICAgICAgICAgX2FwaUFkZHJlc3MKICAgICAgICApCiAgICB7CiAgICAgICAgaG9ub3VyV2hpdGVsaXN0RW5kID0gX2hvbm91cldoaXRlbGlzdEVuZDsKICAgICAgICBwcmVzYWxlQWRkcmVzcyA9IGFkZHJlc3ModGhpcyk7CiAgICAgICAgZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgPSBfZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICAgICAgc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyID0gX3NlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcjsKICAgICAgICB0aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciA9IF90aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcjsKICAgICAgICBtaW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgPSBfbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwogICAgICAgIG1heFByZXNhbGVDb250cmlidXRpb25FdGhlciA9IF9tYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXI7CiAgICAgICAgcHJlU2FsZUNhcCA9IF9wcmVTYWxlQ2FwOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFkZHMgdG8gdGhlIHdoaXRlbGlzdAogICAgLy8vIEBwYXJhbSBfc2VuZGVyIFRoZSBhZGRyZXNzIHRvIHdoaXRlbGlzdAogICAgLy8vIEBwYXJhbSBfcGxhbm5lZENvbnRyaWJ1dGlvbiBUaGUgcGxhbm5lZCBjb250cmlidXRpb24gKFdFSSkKICAgIGZ1bmN0aW9uIGFkZFRvV2hpdGVsaXN0KGFkZHJlc3MgX3NlbmRlciwgdWludDI1NiBfcGxhbm5lZENvbnRyaWJ1dGlvbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZSh3aGl0ZWxpc3RbX3NlbmRlcl0gPT0gMCk7CiAgICAgICAgCiAgICAgICAgd2hpdGVsaXN0W19zZW5kZXJdID0gX3BsYW5uZWRDb250cmlidXRpb247CiAgICAgICAgd2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucyA9IHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMuYWRkKF9wbGFubmVkQ29udHJpYnV0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGZpcmVzIHdoZW4gc29tZW9uZSBzZW5kcyBFdGhlciB0byB0aGUgYWRkcmVzcyBvZiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIFRoZSBFVEggd2lsbCBiZSBleGNoYW5nZWQgZm9yIFNIUCBhbmQgaXQgZW5zdXJlcyBjb250cmlidXRpb25zIGNhbm5vdCBiZSBtYWRlIGZyb20ga25vd24gYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgaXNWYWxpZGF0ZWQKICAgICAgICBub3RDbG9zZWQKICAgICAgICBub3RQYXVzZWQKICAgICAgICBpc0FwcHJvdmVkCiAgICB7CiAgICAgICAgYWRkcmVzcyBjYWxsZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHByb2Nlc3NQcmVTYWxlKGNhbGxlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUHJvY2Vzc2VzIHRoZSBwcmVzYWxlIGlmIHRoZSBhbGxvd2VkIGNvbnRyaWJ1dGlvbiBpcyBtb3JlIHRoYW4gemVybwogICAgLy8vIEBwYXJhbSBfY2FsbGVyIHRoZSBhZGRyZXNzIHNlbmRpbmcgdGhlIEV0aGVyCiAgICBmdW5jdGlvbiBwcm9jZXNzUHJlU2FsZShhZGRyZXNzIF9jYWxsZXIpIHByaXZhdGUgewogICAgICAgIHZhciAoYWxsb3dlZENvbnRyaWJ1dGlvbiwgcmVmdW5kQW1vdW50KSA9IHByb2Nlc3NDb250cmlidXRpb24oKTsKICAgICAgICBhc3NlcnQobXNnLnZhbHVlPT1hbGxvd2VkQ29udHJpYnV0aW9uLmFkZChyZWZ1bmRBbW91bnQpKTsKICAgICAgICBpZiAoYWxsb3dlZENvbnRyaWJ1dGlvbiA+IDApIHsKICAgICAgICAgICAgZG9CdXkoX2NhbGxlciwgYWxsb3dlZENvbnRyaWJ1dGlvbik7CiAgICAgICAgICAgIGlmIChyZWZ1bmRBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZEFtb3VudCk7CiAgICAgICAgICAgICAgICBjbG9zZVByZVNhbGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ292ZXJpbmcgdGhlIGVkZ2UgY2FzZSB3aGVyZSB0aGUgbGFzdCBjb250cmlidXRpb24gZXF1YWxzIHRoZSByZW1haW5pbmcgY2FwCiAgICAgICAgICAgIHVpbnQyNTYgdGlsbENhcCA9IHJlbWFpbmluZ0NhcCgpOwogICAgICAgICAgICBpZiAodGlsbENhcCA9PSAwKSB7CiAgICAgICAgICAgICAgICBjbG9zZVByZVNhbGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0cnVlIGlmIHRoZSB3aGl0ZWxpc3QgcGVyaW9kIGlzIHN0aWxsIGFjdGl2ZSwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgLy8vIFdoZW4gd2hpdGVsaXN0IHBlcmlvZCBlbmRzLCBpdCB3aWxsIHRyYW5zZmVyIGFueSB1bmNsYWltZWQgcGxhbm5lZCBjb250cmlidXRpb25zIHRvIHRoZSBwcmUtc2FsZSBjYXAuIAogICAgZnVuY3Rpb24gaG9ub3VyV2hpdGVsaXN0KCkgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCBob25vdXJXaGl0ZWxpc3QgPSB0cnVlOwogICAgICAgIGlmIChob25vdXJXaGl0ZWxpc3RFbmQgPD0gbm93KSB7CiAgICAgICAgICAgIGhvbm91cldoaXRlbGlzdCA9IGZhbHNlOwogICAgICAgICAgICBwcmVTYWxlQ2FwID0gcHJlU2FsZUNhcC5hZGQod2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucyk7CiAgICAgICAgICAgIHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMgPSAwOwogICAgICAgICAgICBXaGl0ZWxpc3RlZENvdW50ZXJVcGRhdGVkKHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMsIDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaG9ub3VyV2hpdGVsaXN0OwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGNvbnRyaWJ1dGlvbiB0byBiZSB1c2VkIGFzIHBhcnQgb2YgdGhlIHRyYW5zYWN0aW9uLCBhbmQgYW55IHJlZnVuZCB2YWx1ZSBpZiBleHBlY3RlZC4gIAogICAgZnVuY3Rpb24gcHJvY2Vzc0NvbnRyaWJ1dGlvbigpIHByaXZhdGUgaXNWYWxpZENvbnRyaWJ1dGlvbiByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdmFyIChhbGxvd2VkQ29udHJpYnV0aW9uLCByZWZ1bmRBbW91bnQpID0gZ2V0QWxsb3dlZENvbnRyaWJ1dGlvbigpOwogICAgICAgIAogICAgICAgIGlmICghaG9ub3VyV2hpdGVsaXN0KCkpIHsKICAgICAgICAgICAgQWxsb3dlZENvbnRyaWJ1dGlvbkNoZWNrKGFsbG93ZWRDb250cmlidXRpb24sIEFsbG93ZWRDb250cmlidXRpb25TdGF0ZS5XaGl0ZWxpc3RDbG9zZWQpOwogICAgICAgICAgICByZXR1cm4gKGFsbG93ZWRDb250cmlidXRpb24sIHJlZnVuZEFtb3VudCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh3aGl0ZWxpc3RbbXNnLnNlbmRlcl0gPiAwKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzV2hpdGVsaXN0ZWRDb250cmlidXRpb24oYWxsb3dlZENvbnRyaWJ1dGlvbiwgcmVmdW5kQW1vdW50KTsKICAgICAgICB9IAoKICAgICAgICBBbGxvd2VkQ29udHJpYnV0aW9uQ2hlY2soYWxsb3dlZENvbnRyaWJ1dGlvbiwgQWxsb3dlZENvbnRyaWJ1dGlvblN0YXRlLk5vdFdoaXRlbGlzdGVkKTsKICAgICAgICByZXR1cm4gKGFsbG93ZWRDb250cmlidXRpb24sIHJlZnVuZEFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgY29udHJpYnV0aW9uIHRvIGJlIHVzZWQgZm9yIGEgc2VuZGVyIHRoYXQgaGFkIHByZXZpb3VzbHkgYmVlbiB3aGl0ZWxpc3RlZCwgYW5kIGFueSByZWZ1bmQgdmFsdWUgaWYgZXhwZWN0ZWQuCiAgICBmdW5jdGlvbiBwcm9jZXNzV2hpdGVsaXN0ZWRDb250cmlidXRpb24odWludDI1NiBhbGxvd2VkQ29udHJpYnV0aW9uLCB1aW50MjU2IHJlZnVuZEFtb3VudCkgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBwbGFubmVkQ29udHJpYnV0aW9uID0gd2hpdGVsaXN0W21zZy5zZW5kZXJdOwogICAgICAgIAogICAgICAgIHdoaXRlbGlzdFttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgV2hpdGVsaXN0ZWRVcGRhdGVkKHBsYW5uZWRDb250cmlidXRpb24sIHRydWUpOwogICAgICAgIAogICAgICAgIGlmIChtc2cudmFsdWUgPiBwbGFubmVkQ29udHJpYnV0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVBYm92ZVBsYW5uZWRXaGl0ZWxpc3RlZENvbnRyaWJ1dGlvbihhbGxvd2VkQ29udHJpYnV0aW9uLCBwbGFubmVkQ29udHJpYnV0aW9uLCByZWZ1bmRBbW91bnQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAobXNnLnZhbHVlIDwgcGxhbm5lZENvbnRyaWJ1dGlvbikgewogICAgICAgICAgICByZXR1cm4gaGFuZGxlQmVsb3dQbGFubmVkV2hpdGVsaXN0ZWRDb250cmlidXRpb24ocGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBoYW5kbGVQbGFubmVkV2hpdGVsaXN0ZWRDb250cmlidXRpb24ocGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgY29udHJpYnV0aW9uIGFuZCByZWZ1bmQgdmFsdWUgdG8gYmUgdXNlZCB3aGVuIHRoZSB0cmFuc2FjdGlvbiB2YWx1ZSBlcXVhbHMgdGhlIHdoaXRlbGlzdGVkIGNvbnRyaWJ1dGlvbiBmb3IgdGhlIHNlbmRlci4KICAgIC8vLyBOb3RlIHRoYXQgcmVmdW5kIHZhbHVlIHdpbGwgYWx3YXlzIGJlIDAgaW4gdGhpcyBjYXNlLCBhcyB0aGUgcGxhbm5lZCBjb250cmlidXRpb24gZm9yIHRoZSBzZW5kZXIgYW5kIHRyYW5zYWN0aW9uIHZhbHVlIG1hdGNoLgogICAgZnVuY3Rpb24gaGFuZGxlUGxhbm5lZFdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHVpbnQyNTYgcGxhbm5lZENvbnRyaWJ1dGlvbikgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdXBkYXRlV2hpdGVsaXN0ZWRDb250cmlidXRpb24ocGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICAgICAgQWxsb3dlZENvbnRyaWJ1dGlvbkNoZWNrKHBsYW5uZWRDb250cmlidXRpb24sIEFsbG93ZWRDb250cmlidXRpb25TdGF0ZS5XaGl0ZWxpc3RlZCk7CiAgICAgICAgcmV0dXJuIChwbGFubmVkQ29udHJpYnV0aW9uLCAwKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgY29udHJpYnV0aW9uIGFuZCByZWZ1bmQgdmFsdWUgdG8gYmUgdXNlZCB3aGVuIHRoZSB0cmFuc2FjdGlvbiB2YWx1ZSBpcyBoaWdoZXIgdGhhbiB0aGUgd2hpdGVsaXN0ZWQgY29udHJpYnV0aW9uIGZvciB0aGUgc2VuZGVyLgogICAgLy8vIE5vdGUgdGhhdCBvbmx5IGluIHRoaXMgY2FzZSwgdGhlIHJlZnVuZCB2YWx1ZSB3aWxsIG5vdCBiZSAwLgogICAgZnVuY3Rpb24gaGFuZGxlQWJvdmVQbGFubmVkV2hpdGVsaXN0ZWRDb250cmlidXRpb24odWludDI1NiBhbGxvd2VkQ29udHJpYnV0aW9uLCB1aW50MjU2IHBsYW5uZWRDb250cmlidXRpb24sIHVpbnQyNTYgcmVmdW5kQW1vdW50KSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICB1cGRhdGVXaGl0ZWxpc3RlZENvbnRyaWJ1dGlvbihwbGFubmVkQ29udHJpYnV0aW9uKTsKICAgICAgICBBbGxvd2VkQ29udHJpYnV0aW9uQ2hlY2soYWxsb3dlZENvbnRyaWJ1dGlvbiwgQWxsb3dlZENvbnRyaWJ1dGlvblN0YXRlLkFib3ZlV2hpdGVsaXN0ZWQpOwogICAgICAgIHJldHVybiAoYWxsb3dlZENvbnRyaWJ1dGlvbiwgcmVmdW5kQW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBjb250cmlidXRpb24gYW5kIHJlZnVuZCB2YWx1ZSB0byBiZSB1c2VkIHdoZW4gdGhlIHRyYW5zYWN0aW9uIHZhbHVlIGlzIGxvd2VyIHRoYW4gdGhlIHdoaXRlbGlzdGVkIGNvbnRyaWJ1dGlvbiBmb3IgdGhlIHNlbmRlci4KICAgIC8vLyBOb3RlIHRoYXQgcmVmdW5kIHZhbHVlIHdpbGwgYWx3YXlzIGJlIDAgaW4gdGhpcyBjYXNlLCBhcyB0cmFuc2FjdGlvbiB2YWx1ZSBpcyBiZWxvdyB0aGUgcGxhbm5lZCBjb250cmlidXRpb24gZm9yIHRoaXMgc2VuZGVyLgogICAgZnVuY3Rpb24gaGFuZGxlQmVsb3dQbGFubmVkV2hpdGVsaXN0ZWRDb250cmlidXRpb24odWludDI1NiBwbGFubmVkQ29udHJpYnV0aW9uKSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGJlbG93UGxhbm5lZCA9IHBsYW5uZWRDb250cmlidXRpb24uc3ViKG1zZy52YWx1ZSk7CiAgICAgICAgcHJlU2FsZUNhcCA9IHByZVNhbGVDYXAuYWRkKGJlbG93UGxhbm5lZCk7CiAgICAgICAgCiAgICAgICAgdXBkYXRlV2hpdGVsaXN0ZWRDb250cmlidXRpb24obXNnLnZhbHVlKTsKICAgICAgICBBbGxvd2VkQ29udHJpYnV0aW9uQ2hlY2sobXNnLnZhbHVlLCBBbGxvd2VkQ29udHJpYnV0aW9uU3RhdGUuQmVsb3dXaGl0ZWxpc3RlZCk7CiAgICAgICAgcmV0dXJuIChtc2cudmFsdWUsIDApOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgdGhlIHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMgY291bnRlciwgc3VidHJhY3RpbmcgdGhlIGNvbnRyaWJ1dGlvbiBhYm91dCB0byBiZSBhcHBsaWVkLgogICAgZnVuY3Rpb24gdXBkYXRlV2hpdGVsaXN0ZWRDb250cmlidXRpb24odWludDI1NiBwbGFubmVkQ29udHJpYnV0aW9uKSBwcml2YXRlIHsKICAgICAgICB3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zID0gd2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucy5zdWIocGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICAgICAgV2hpdGVsaXN0ZWRDb3VudGVyVXBkYXRlZCh3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zLCBwbGFubmVkQ29udHJpYnV0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBhbGxvd2VkIGNvbnRyaWJ1dGlvbiBiYXNlZCBvbiB0aGUgdHJhbnNhY3Rpb24gdmFsdWUgYW5kIGFtb3VudCByZW1haW5pbmcgdGlsbCBjYXAuCiAgICAvLy8gSWYgdGhlIHRyYW5zYWN0aW9uIGNvbnRyaWJ1dGlvbiBpcyBoaWdoZXIgdGhhbiBjYXAsIHdpbGwgcmV0dXJuIHRoZSBleGNlc3MgYW1vdW50IHRvIGJlIHJlZnVuZGVkIHRvIHNlbmRlci4KICAgIC8vLyBAcmV0dXJuIHRoZSBhbGxvd2VkIGNvbnRyaWJ1dGlvbiBhbmQgcmVmdW5kIGFtb3VudCAoaWYgYW55KS4gQWxsIGluIFdFSS4KICAgIGZ1bmN0aW9uIGdldEFsbG93ZWRDb250cmlidXRpb24oKSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGFsbG93ZWRDb250cmlidXRpb24gPSBtc2cudmFsdWU7CiAgICAgICAgdWludDI1NiB0aWxsQ2FwID0gcmVtYWluaW5nQ2FwKCk7CiAgICAgICAgdWludDI1NiByZWZ1bmRBbW91bnQgPSAwOwogICAgICAgIGlmIChtc2cudmFsdWUgPiB0aWxsQ2FwKSB7CiAgICAgICAgICAgIGFsbG93ZWRDb250cmlidXRpb24gPSB0aWxsQ2FwOwogICAgICAgICAgICByZWZ1bmRBbW91bnQgPSBtc2cudmFsdWUuc3ViKGFsbG93ZWRDb250cmlidXRpb24pOwogICAgICAgICAgICBDb250cmlidXRpb25SZWZ1bmQocmVmdW5kQW1vdW50LCBtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChhbGxvd2VkQ29udHJpYnV0aW9uLCByZWZ1bmRBbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIEV0aGVyIGFtb3VudCByZW1haW5pbmcgdW50aWwgdGhlIGhhcmQtY2FwCiAgICAvLy8gQHJldHVybiB0aGUgcmVtYWluaW5nIGNhcCBpbiBXRUkKICAgIGZ1bmN0aW9uIHJlbWFpbmluZ0NhcCgpIHByaXZhdGUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBwcmVTYWxlQ2FwLnN1YihwcmVTYWxlRXRoZXJQYWlkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBQdWJsaWMgZnVuY3Rpb24gZW5hYmxlcyBjbG9zaW5nIG9mIHRoZSBwcmUtc2FsZSBtYW51YWxseSBpZiBuZWNlc3NhcnkKICAgIGZ1bmN0aW9uIGNsb3NlU2FsZSgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGNsb3NlUHJlU2FsZSgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFByaXZhdGUgZnVuY3Rpb24gdXNlZCB0byBjbG9zZSB0aGUgcHJlLXNhbGUgd2hlbiB0aGUgaGFyZC1jYXAgaXMgaGl0CiAgICBmdW5jdGlvbiBjbG9zZVByZVNhbGUoKSBwcml2YXRlIHsKICAgICAgICBjbG9zZWQgPSB0cnVlOwogICAgICAgIFNhbGVDbG9zZWQobm93KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFbnN1cmUgdGhlIGNvbnRyaWJ1dGlvbiBpcyB2YWxpZAogICAgLy8vIEByZXR1cm4gUmV0dXJucyB3aGV0aGVyIHRoZSBjb250cmlidXRpb24gaXMgdmFsaWQgb3Igbm90CiAgICBmdW5jdGlvbiB2YWxpZENvbnRyaWJ1dGlvbigpIHByaXZhdGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgaXNDb250cmlidXRpb25WYWxpZCA9IG1zZy52YWx1ZSA+PSBtaW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgJiYgbXNnLnZhbHVlIDw9IG1heFByZXNhbGVDb250cmlidXRpb25FdGhlcjsKICAgICAgICBWYWxpZENvbnRyaWJ1dGlvbkNoZWNrKG1zZy52YWx1ZSwgaXNDb250cmlidXRpb25WYWxpZCk7CiAgICAgICAgcmV0dXJuIGlzQ29udHJpYnV0aW9uVmFsaWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQXBwbGllcyB0aGUgZGlzY291bnQgYmFzZWQgb24gdGhlIGRpc2NvdW50IHRpZXJzCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCBUaGUgYW1vdW50IG9mIGV0aGVyIHVzZWQgdG8gZXZhbHVhdGUgdGhlIHRpZXIgdGhlIGNvbnRyaWJ1dGlvbiBsaWVzIHdpdGhpbgogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0b3JUb2tlbnMgVGhlIHRva2VucyBhbGxvY2F0ZWQgYmFzZWQgb24gdGhlIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gYXBwbHlEaXNjb3VudCgKICAgICAgICB1aW50MjU2IF9ldGhlckFtb3VudCwgCiAgICAgICAgdWludDI1NiBfY29udHJpYnV0b3JUb2tlbnMKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKCiAgICAgICAgdWludDI1NiBkaXNjb3VudCA9IDA7CgogICAgICAgIGlmIChfZXRoZXJBbW91bnQgPD0gZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIpIHsKICAgICAgICAgICAgZGlzY291bnQgPSBfY29udHJpYnV0b3JUb2tlbnMubXVsKEZJUlNUX1RJRVJfRElTQ09VTlQpLmRpdigxMDApOwogICAgICAgIH0gZWxzZSBpZiAoX2V0aGVyQW1vdW50ID4gZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgJiYgX2V0aGVyQW1vdW50IDw9IHNlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcikgewogICAgICAgICAgICBkaXNjb3VudCA9IF9jb250cmlidXRvclRva2Vucy5tdWwoU0VDT05EX1RJRVJfRElTQ09VTlQpLmRpdigxMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRpc2NvdW50ID0gX2NvbnRyaWJ1dG9yVG9rZW5zLm11bChUSElSRF9USUVSX0RJU0NPVU5UKS5kaXYoMTAwKTsKICAgICAgICB9CgogICAgICAgIERpc2NvdW50QXBwbGllZChfZXRoZXJBbW91bnQsIF9jb250cmlidXRvclRva2VucywgZGlzY291bnQpOwogICAgICAgIHJldHVybiBkaXNjb3VudC5hZGQoX2NvbnRyaWJ1dG9yVG9rZW5zKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBVcGRhdGVzIHRoZSBjb3VudGVycyBmb3IgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCB0aGUgYW1vdW50IG9mIEV0aGVyIHBhaWQKICAgIGZ1bmN0aW9uIHVwZGF0ZUNvdW50ZXJzKHVpbnQyNTYgX2V0aGVyQW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgcHJlU2FsZUV0aGVyUGFpZCA9IHByZVNhbGVFdGhlclBhaWQuYWRkKF9ldGhlckFtb3VudCk7CiAgICAgICAgdG90YWxDb250cmlidXRpb25zID0gdG90YWxDb250cmlidXRpb25zLmFkZCgxKTsKICAgICAgICBDb3VudGVyc1VwZGF0ZWQocHJlU2FsZUV0aGVyUGFpZCwgX2V0aGVyQW1vdW50KTsKICAgIH0KfQ=='.
	

]
