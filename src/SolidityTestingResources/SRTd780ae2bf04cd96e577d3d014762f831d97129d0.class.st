Class {
	#name : #SRTd780ae2bf04cd96e577d3d014762f831d97129d0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd780ae2bf04cd96e577d3d014762f831d97129d0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmUgbWF0aCBvcGVyYXRpb25zIHRoYXQgdGhyb3cgZXJyb3Igb24gb3ZlcmZsb3cuCiAqCiAqIENyZWRpdDogVGFraW5nIGlkZWFzIGZyb20gRmlyc3RCbG9vZCB0b2tlbgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogICAgLyoqIAogICAgICogQGRldiBTYWZlbHkgYWRkIHR3byBudW1iZXJzLgogICAgICoKICAgICAqIEBwYXJhbSB4IEZpcnN0IG9wZXJhbnQuCiAgICAgKiBAcGFyYW0geSBTZWNvbmQgb3BlcmFudC4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB4K3kuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkKICAgIGludGVybmFsIGNvbnN0YW50CiAgICByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHogPSB4ICsgeTsKICAgICAgICBhc3NlcnQoKHogPj0geCkgJiYgKHogPj0geSkpOwogICAgICAgIHJldHVybiB6OwogICAgfQoKICAgIC8qKiAKICAgICAqIEBkZXYgU2FmZWx5IHN1YnN0cmFjdCB0d28gbnVtYmVycy4KICAgICAqCiAgICAgKiBAcGFyYW0geCBGaXJzdCBvcGVyYW50LgogICAgICogQHBhcmFtIHkgU2Vjb25kIG9wZXJhbnQuCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgb2YgeC15LgogICAgICovCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiB4LCB1aW50MjU2IHkpCiAgICBpbnRlcm5hbCBjb25zdGFudAogICAgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KHggPj0geSk7CiAgICAgICAgdWludDI1NiB6ID0geCAtIHk7CiAgICAgICAgcmV0dXJuIHo7CiAgICB9CgogICAgLyoqIAogICAgICogQGRldiBTYWZlbHkgbXVsdGlwbHkgdHdvIG51bWJlcnMuCiAgICAgKgogICAgICogQHBhcmFtIHggRmlyc3Qgb3BlcmFudC4KICAgICAqIEBwYXJhbSB5IFNlY29uZCBvcGVyYW50LgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHgqeS4KICAgICAqLwogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgeCwgdWludDI1NiB5KQogICAgaW50ZXJuYWwgY29uc3RhbnQKICAgIHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IHggKiB5OwogICAgICAgIGFzc2VydCgoeCA9PSAwKSB8fCAoei94ID09IHkpKTsKICAgICAgICByZXR1cm4gejsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBQYXJzZSBhIGZsb2F0aW5nIHBvaW50IG51bWJlciBmcm9tIFN0cmluZyB0byB1aW50LCBlLmcuICIyNTAuNTYiIHRvICIyNTA1NiIKICAgICAqLwogICAgZnVuY3Rpb24gcGFyc2Uoc3RyaW5nIHMpIAogICAgaW50ZXJuYWwgY29uc3RhbnQgCiAgICByZXR1cm5zICh1aW50MjU2KSAKICAgIHsKICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMocyk7CiAgICB1aW50IHJlc3VsdCA9IDA7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGJbaV0gPj0gNDggJiYgYltpXSA8PSA1NykgewogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgKiAxMCArICh1aW50KGJbaV0pIC0gNDgpOyAKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OyAKfQp9CgovKioKICogQHRpdGxlIFRoZSBhYnN0cmFjdCBFUkMtMjAgVG9rZW4gU3RhbmRhcmQgZGVmaW5pdGlvbi4KICoKICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKICovCmNvbnRyYWN0IFRva2VuIHsKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIHRvdGFsIHRva2VuIHN1cHBseS4KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICAvLy8gQGRldiBNVVNUIHRyaWdnZXIgd2hlbiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkLCBpbmNsdWRpbmcgemVybyB2YWx1ZSB0cmFuc2ZlcnMuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICAvLy8gQGRldiBNVVNUIHRyaWdnZXIgb24gYW55IHN1Y2Nlc3NmdWwgY2FsbCB0byBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKS4KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgovKioKICogQHRpdGxlIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIEVSQy0yMCBUb2tlbiBTdGFuZGFyZC4KICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgbnVtd29yZHMpIHsKICAgICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID09IG51bXdvcmRzICogMzIgKyA0KTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlcnMgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gYWRkcmVzcyBfdG8sIGFuZCBNVVNUIGZpcmUgdGhlIFRyYW5zZmVyIGV2ZW50LiAKICAgICAqIEBkZXYgVGhlIGZ1bmN0aW9uIFNIT1VMRCB0aHJvdyBpZiB0aGUgX2Zyb20gYWNjb3VudCBiYWxhbmNlIGRvZXMgbm90IGhhdmUgZW5vdWdoIHRva2VucyB0byBzcGVuZC4KICAgICAqCiAgICAgKiBAZGV2IEEgdG9rZW4gY29udHJhY3Qgd2hpY2ggY3JlYXRlcyBuZXcgdG9rZW5zIFNIT1VMRCB0cmlnZ2VyIGEgVHJhbnNmZXIgZXZlbnQgd2l0aCB0aGUgX2Zyb20gYWRkcmVzcyBzZXQgdG8gMHgwIHdoZW4gdG9rZW5zIGFyZSBjcmVhdGVkLgogICAgICoKICAgICAqIE5vdGUgVHJhbnNmZXJzIG9mIDAgdmFsdWVzIE1VU1QgYmUgdHJlYXRlZCBhcyBub3JtYWwgdHJhbnNmZXJzIGFuZCBmaXJlIHRoZSBUcmFuc2ZlciBldmVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIFRoZSByZWNlaXZlciBvZiB0aGUgdG9rZW5zLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kLgogICAgICogQHJldHVybiBUcnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDAgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlcnMgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBhZGRyZXNzIF9mcm9tIHRvIGFkZHJlc3MgX3RvLCBhbmQgTVVTVCBmaXJlIHRoZSBUcmFuc2ZlciBldmVudC4KICAgICAqCiAgICAgKiBAZGV2IFRoZSB0cmFuc2ZlckZyb20gbWV0aG9kIGlzIHVzZWQgZm9yIGEgd2l0aGRyYXcgd29ya2Zsb3csIGFsbG93aW5nIGNvbnRyYWN0cyB0byB0cmFuc2ZlciB0b2tlbnMgb24geW91ciBiZWhhbGYuIAogICAgICogQGRldiBUaGlzIGNhbiBiZSB1c2VkIGZvciBleGFtcGxlIHRvIGFsbG93IGEgY29udHJhY3QgdG8gdHJhbnNmZXIgdG9rZW5zIG9uIHlvdXIgYmVoYWxmIGFuZC9vciB0byBjaGFyZ2UgZmVlcyBpbiAKICAgICAqIEBkZXYgc3ViLWN1cnJlbmNpZXMuIFRoZSBmdW5jdGlvbiBTSE9VTEQgdGhyb3cgdW5sZXNzIHRoZSBfZnJvbSBhY2NvdW50IGhhcyBkZWxpYmVyYXRlbHkgYXV0aG9yaXplZCB0aGUgc2VuZGVyIG9mIAogICAgICogQGRldiB0aGUgbWVzc2FnZSB2aWEgc29tZSBtZWNoYW5pc20uCiAgICAgKgogICAgICogTm90ZSBUcmFuc2ZlcnMgb2YgMCB2YWx1ZXMgTVVTVCBiZSB0cmVhdGVkIGFzIG5vcm1hbCB0cmFuc2ZlcnMgYW5kIGZpcmUgdGhlIFRyYW5zZmVyIGV2ZW50LgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgc2VuZGVyIG9mIHRoZSB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX3RvIFRoZSByZWNlaXZlciBvZiB0aGUgdG9rZW5zLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kLgogICAgICogQHJldHVybiBUcnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDAgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IFNhZmVNYXRoLmFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLnN1YihhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgYWNjb3VudCBiYWxhbmNlIG9mIGFub3RoZXIgYWNjb3VudCB3aXRoIGFkZHJlc3MgX293bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdG8gY2hlY2suCiAgICAgKiBAcmV0dXJuIFRoZSBhY2NvdW50IGJhbGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikKICAgIHB1YmxpYyBjb25zdGFudAogICAgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyBfc3BlbmRlciB0byB3aXRoZHJhdyBmcm9tIHlvdXIgYWNjb3VudCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQuIAogICAgICogQGRldiBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KICAgICAqCiAgICAgKiBAZGV2IE5PVEU6IFRvIHByZXZlbnQgYXR0YWNrIHZlY3RvcnMgbGlrZSB0aGUgb25lIGRlc2NyaWJlZCBpbiBbMV0gYW5kIGRpc2N1c3NlZCBpbiBbMl0sIGNsaWVudHMgCiAgICAgKiBAZGV2IFNIT1VMRCBtYWtlIHN1cmUgdG8gY3JlYXRlIHVzZXIgaW50ZXJmYWNlcyBpbiBzdWNoIGEgd2F5IHRoYXQgdGhleSBzZXQgdGhlIGFsbG93YW5jZSBmaXJzdCAKICAgICAqIEBkZXYgdG8gMCBiZWZvcmUgc2V0dGluZyBpdCB0byBhbm90aGVyIHZhbHVlIGZvciB0aGUgc2FtZSBzcGVuZGVyLiBUSE9VR0ggVGhlIGNvbnRyYWN0IGl0c2VsZiAKICAgICAqIEBkZXYgc2hvdWxkbid0IGVuZm9yY2UgaXQsIHRvIGFsbG93IGJhY2t3YXJkcyBjb21wYXRpbGliaWx0eSB3aXRoIGNvbnRyYWN0cyBkZXBsb3llZCBiZWZvcmUuCiAgICAgKiBAZGV2IFsxXSBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFZTFB0UXhadTFVQXZPOWNaMU8yUlBYQmJUMG1vb2g0RFlLakFfanAtUkxNLwogICAgICogQGRldiBbMl0gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAgICogQHJldHVybiBUcnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkKICAgIHB1YmxpYwogICAgb25seVBheWxvYWRTaXplKDIpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgYW1vdW50IHdoaWNoIF9zcGVuZGVyIGlzIHN0aWxsIGFsbG93ZWQgdG8gd2l0aGRyYXcgZnJvbSBfb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyLgogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNlaXZlci4KICAgICAqIEByZXR1cm4gVGhlIGFsbG93ZWQgd2l0aGRyYXdhbCBhbW91bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKICAgIHB1YmxpYyBjb25zdGFudAogICAgb25seVBheWxvYWRTaXplKDIpCiAgICByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQp9CgoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIAogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsgICAgICAgCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRQcm9vZlR5cGUocHJvb2ZQKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICBpZiAoKF9uYnl0ZXMgPT0gMCl8fChfbmJ5dGVzID4gMzIpKSB0aHJvdzsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXNbM10gbWVtb3J5IGFyZ3MgPSBbdW5vbmNlLCBuYnl0ZXMsIHNlc3Npb25LZXlIYXNoXTsgCiAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfcXVlcnkoX2RlbGF5LCAicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIHNoYTMoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CiAgICAKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ynl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CiAgICAgICAgCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgc2lncl8gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCsodWludChkZXJzaWdbM10pIC0gMHgyMCk7CiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3NfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOwogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0Kyh1aW50KGRlcnNpZ1tvZmZzZXQtMV0pIC0gMHgyMCksIDMyLCBzaWdzXywgMCk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcikgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7CiAgICAgICAgICAgIHJldHVybiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgCiAgICAgICAgLy8gU3RlcCA2OiB2ZXJpZnkgdGhlIGF0dGVzdGF0aW9uIHNpZ25hdHVyZSwgQVBQS0VZMSBtdXN0IHNpZ24gdGhlIHNlc3Npb25LZXkgZnJvbSB0aGUgY29ycmVjdCBsZWRnZXIgYXBwIChDT0RFSEFTSCkKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMiA9IG5ldyBieXRlcyh1aW50KHByb29mW3NpZzJvZmZzZXQrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCwgc2lnMi5sZW5ndGgsIHNpZzIsIDApOwogICAgICAgIAogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IDE7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKICAgICAgICAKICAgICAgICBpZiAoc2lnb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjMgPSBuZXcgYnl0ZXMoMSs2NSk7CiAgICAgICAgdG9zaWduM1swXSA9IDB4RkU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzLCA2NSwgdG9zaWduMywgMSk7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKICAgICAgICAKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHNpZ29rOwogICAgfQogICAgCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHRocm93OwogICAgICAgIAogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbWF0Y2hCeXRlczMyUHJlZml4KGJ5dGVzMzIgY29udGVudCwgYnl0ZXMgcHJlZml4KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CiAgICAgICAgCiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHByZWZpeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIGNoZWNrb2s7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGNoZWNrb2sgPSAoc2hhMyhrZXloYXNoKSA9PSBzaGEzKHNoYTI1Nihjb250ZXh0X25hbWUsIHF1ZXJ5SWQpKSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgY2hlY2tvayA9IG1hdGNoQnl0ZXMzMlByZWZpeChzaGEyNTYoc2lnMSksIHJlc3VsdCk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBzaGEzKGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrMzIsIDgrMSszMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwogICAgICAgIAogICAgICAgIGJ5dGVzMzIgc2Vzc2lvblB1YmtleUhhc2ggPSBzaGEyNTYoc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBjaGVja29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAvLyB2ZXJpZnkgaWYgc2Vzc2lvblB1YmtleUhhc2ggd2FzIHZlcmlmaWVkIGFscmVhZHksIGlmIG5vdC4uIGxldCdzIGRvIGl0IQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2UpewogICAgICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KHByb29mLCBzaWcyb2Zmc2V0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCiAgICAKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgICAgIHRocm93OyAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5PwogICAgICAgIH0KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KICAgIAogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KICAKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQogICAgICAgIAp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKCi8qKgogKiBAdGl0bGUgVGhlIEVWTlRva2VuIFRva2VuIGNvbnRyYWN0LgogKgogKiBDcmVkaXQ6IFRha2luZyBpZGVhcyBmcm9tIEJBVCB0b2tlbiBhbmQgTkVUIHRva2VuCiAqLwogLyppcyBTdGFuZGFyZFRva2VuICovCmNvbnRyYWN0IEVWTlRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIHVzaW5nT3JhY2xpemUgewoKICAgIC8vIFRva2VuIG1ldGFkYXRhCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiRW52aW9uIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkVWTiI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCB2ZXJzaW9uID0gIjAuOSI7CgogICAgLy8gRnVuZHJhaXNpbmcgZ29hbHM6IG1pbmltdW1zIGFuZCBtYXhpbXVtcwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fQ1JFQVRJT05fQ0FQID0gMTMwICogKDEwKio2KSAqIDEwKipkZWNpbWFsczsgLy8gMTMwIG1pbGxpb24gRVZOcwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fQ1JFQVRFRF9NSU4gPSAxICogKDEwKio2KSAqIDEwKipkZWNpbWFsczsgICAgLy8gMSBtaWxsaW9uIEVWTnMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEVUSF9SRUNFSVZFRF9DQVAgPSA1MzMzICogKDEwKioyKSAqIDEwKipkZWNpbWFsczsgIC8vIDUzMyAzMDAgRVRICiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBFVEhfUkVDRUlWRURfTUlOID0gMSAqICgxMCoqMykgKiAxMCoqZGVjaW1hbHM7ICAgICAvLyAxIDAwMCBFVEgKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX01JTiA9IDEgKiAxMCoqZGVjaW1hbHM7ICAgICAgICAgICAgICAgICAgICAgIC8vIDEgRVZOCgogICAgLy8gRGlzY291bnQgbXVsdGlwbGllcnMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX0ZJUlNUX0RJU0NPVU5UX01VTFRJUExJRVIgID0gMTQyODU3OyAvLyBsYXRlciBkaXZpZGVkIGJ5IDEwXjUgdG8gZ2l2ZSB1c2VycyAxLDQyODU3IHRpbWVzIG1vcmUgdG9rZW5zIHBlciBFVEggPT0gMzAlIGRpc2NvdW50CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TRUNPTkRfRElTQ09VTlRfTVVMVElQTElFUiA9IDEyNTAwMDsgLy8gbGF0ZXIgZGl2aWRlZCBieSAxMF41IHRvIGdpdmUgdXNlcnMgMSwyNSBtb3JlIHRva2VucyBwZXIgRVRIID09IDIwJSBkaXNjb3VudAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fVEhJUkRfRElTQ09VTlRfTVVMVElQTElFUiAgPSAxMTExMTE7IC8vIGxhdGVyIGRpdmlkZWQgYnkgMTBeNSB0byBnaXZlIHVzZXJzIDEsMTExMTEgbW9yZSB0b2tlbnMgcGVyIEVUSCA9PSAxMCUgZGlzY291bnQKCiAgICAvLyBGdW5kcmFpc2luZyBwYXJhbWV0ZXJzIHByb3ZpZGVkIHdoZW4gY3JlYXRpbmcgdGhlIGNvbnRyYWN0CiAgICB1aW50MjU2IHB1YmxpYyBmdW5kaW5nU3RhcnRCbG9jazsgLy8gVGhlc2UgdHdvIGJsb2NrcyBuZWVkIHRvIGJlIGNob3NlbiB0byBjb21wbHkgd2l0aCB0aGUKICAgIHVpbnQyNTYgcHVibGljIGZ1bmRpbmdFbmRCbG9jazsgICAvLyBzdGFydCBkYXRlIGFuZCAzMSBkYXkgZHVyYXRpb24gcmVxdWlyZW1lbnRzCiAgICB1aW50MjU2IHB1YmxpYyByb3VuZFR3b0Jsb2NrOyAgICAgLy8gYmxvY2sgbnVtYmVyIHRoYXQgdHJpZ2dlcnMgdGhlIHNlY29uZCBleGNoYW5nZSByYXRlIGNoYW5nZQogICAgdWludDI1NiBwdWJsaWMgcm91bmRUaHJlZUJsb2NrOyAgIC8vIGJsb2NrIG51bWJlciB0aGF0IHRyaWdnZXJzIHRoZSB0aGlyZCBleGNoYW5nZSByYXRlIGNoYW5nZQogICAgdWludDI1NiBwdWJsaWMgcm91bmRGb3VyQmxvY2s7ICAgIC8vIGJsb2NrIG51bWJlciB0aGF0IHRyaWdnZXJzIHRoZSBmb3VydGggZXhjaGFuZ2UgcmF0ZSBjaGFuZ2UKICAgIHVpbnQyNTYgcHVibGljIGNjUmVsZWFzZUJsb2NrOyAgICAvLyBibG9jayBudW1iZXIgdGhhdCB0cmlnZ2VycyBwdXJjaGFzZXMgbWFkZSBieSBDQyBiZSB0cmFuc2ZlcmFibGUKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjE7ICAgICAgLy8gRmlyc3QgYWRtaW5pc3RyYXRvciBmb3IgbXVsdGktc2lnIG1lY2hhbmlzbQogICAgYWRkcmVzcyBwdWJsaWMgYWRtaW4yOyAgICAgIC8vIFNlY29uZCBhZG1pbmlzdHJhdG9yIGZvciBtdWx0aS1zaWcgbWVjaGFuaXNtCiAgICBhZGRyZXNzIHB1YmxpYyB0b2tlblZlbmRvcjsgLy8gQWNjb3VudCBkZWxpdmVyaW5nIFRva2VucyBwdXJjaGFzZWQgd2l0aCBjcmVkaXQgY2FyZAoKICAgIC8vIENvbnRyYWN0cyBjdXJyZW50IHN0YXRlIChGdW5kcmFpc2luZywgRmluYWxpemVkLCBQYXVzZWQpIGFuZCB0aGUgc2F2ZWQgc3RhdGUgKGlmIGN1cnJlbnRseSBwYXVzZWQpCiAgICBDb250cmFjdFN0YXRlIHB1YmxpYyBzdGF0ZTsgICAgICAgLy8gQ3VycmVudCBzdGF0ZSBvZiB0aGUgY29udHJhY3QKICAgIENvbnRyYWN0U3RhdGUgcHJpdmF0ZSBzYXZlZFN0YXRlOyAvLyBTdGF0ZSBvZiB0aGUgY29udHJhY3QgYmVmb3JlIHBhdXNlCgogICAgLy9AZGV2IFVzZWNhc2UgcmVsYXRlZDogUHVyY2hhc2luZyBUb2tlbnMgd2l0aCBDcmVkaXQgY2FyZCAgCiAgICAvL0BkZXYgVXNlY2FzZSByZWxhdGVkOiBDYW5jZWxpbmcgcHVyY2hhc2VzIGRvbmUgd2l0aCBjcmVkaXQgY2FyZAogICAgbWFwcGluZyAoc3RyaW5nID0+IFB1cmNoYXNlKSBwdXJjaGFzZXM7ICAgICAgICAgICAgICAgICAvLyBpbiBjYXNlIENDIHBheW1lbnRzIGdldCBjaGFyZ2VkIGJhY2ssIGFkbWlucyBzaGFsbCBvbmx5IGJlIGFsbG93ZWQgdG8ga2lsbCB0aGUgZXhhY3QgYW1vdW50IG9mIHRva2VucyBhc3NvY2lhdGVkIHdpdGggdGhpcyBwYXltZW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjY0xvY2tlZFVwQmFsYW5jZXM7IC8vIHRyYWNraW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHVzZXJzIGhhdmUgYm91Z2h0IHZpYSBDQyAtIGxvY2tlZCB1cCB1bnRpbCBjY1JlbGVhc2VCbG9jawogICAgc3RyaW5nW10gcHVibGljIHB1cmNoYXNlQXJyYXk7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBob2xkaW5nIHRoZSBJRHMgb2YgYWxsIENDIHB1cmNoYXNlcwoKICAgIC8vIEtlZXAgdHJhY2sgb2YgaG9sZGVycyBhbmQgaWNvQnV5ZXJzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0hvbGRlcjsgLy8gdHJhY2sgaWYgYSB1c2VyIGlzIGEga25vd24gdG9rZW4gaG9sZGVyIHRvIHRoZSBzbWFydCBjb250cmFjdCAtIGltcG9ydGFudCBmb3IgcGF5b3V0cyBsYXRlcgogICAgYWRkcmVzc1tdIHB1YmxpYyBob2xkZXJzOyAgICAgICAgICAgICAgICAgIC8vIGFycmF5IG9mIGFsbCBrbm93biBob2xkZXJzIC0gaW1wb3J0YW50IGZvciBwYXlvdXRzIGxhdGVyCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGlzSWNvQnV5ZXI7ICAgICAgLy8gZm9yIHRyYWNraW5nIGlmIHVzZXIgaGFzIHRvIGJlIGt5YyB2ZXJpZmllZCBiZWZvcmUgYmVpbmcgYWJsZSB0byB0cmFuc2ZlciB0b2tlbnMKCiAgICAvLyBFVEggYmFsYW5jZSBwZXIgdXNlcgogICAgLy8gU2luY2Ugd2UgaGF2ZSBkaWZmZXJlbnQgZXhjaGFuZ2UgcmF0ZXMgYXQgZGlmZmVyZW50IHN0YWdlcywgd2UgbmVlZCB0byBrZWVwIHRyYWNrCiAgICAvLyBvZiBob3cgbXVjaCBldGhlciBlYWNoIGNvbnRyaWJ1dGVkIGluIGNhc2UgdGhhdCB3ZSBuZWVkIHRvIGlzc3VlIGEgcmVmdW5kCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgZXRoQmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgbm9LeWNFdGhCYWxhbmNlczsKCiAgICAvLyBUb3RhbCByZWNlaXZlZCBFVEggYmFsYW5jZXMKICAgIC8vIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiBob3cgbXVjaCBldGhlciBoYXZlIGJlZW4gY29udHJpYnV0ZWQsIHNpbmNlIHdlIGhhdmUgYSBjYXAgZm9yIEVUSCB0b28KICAgIHVpbnQyNTYgcHVibGljIGFsbFJlY2VpdmVkRXRoOwogICAgdWludDI1NiBwdWJsaWMgYWxsVW5LeWNlZEV0aDsgLy8gdG90YWwgYW1vdW50IG9mIEVUSCB3ZSBoYXZlIG5vIEtZQyBmb3IgeWV0CgogICAgLy8gc3RvcmUgdGhlIGhhc2hlcyBvZiBhZG1pbnMnIG1zZy5kYXRhCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJ5dGVzMzIpIHByaXZhdGUgbXVsdGlTaWdIYXNoZXM7CgogICAgLy8gS1lDCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0t5Y1RlYW07ICAgLy8gdG8gZGV0ZXJtaW5lLCBpZiBhIHVzZXIgYmVsb25ncyB0byB0aGUgS1lDIHRlYW0gb3Igbm90CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBreWNWZXJpZmllZDsgLy8gdG8gY2hlY2sgaWYgdXNlciBoYXMgYWxyZWFkeSB1bmRlcmdvbmUgS1lDIG9yIG5vdCwgdG8gbG9jayB1cCBoaXMgdG9rZW5zIHVudGlsIHRoZW4KCiAgICAvLyB0byB0cmFjayBpZiB0ZWFtIG1lbWJlcnMgYWxyZWFkeSBnb3QgdGhlaXIgdG9rZW5zCiAgICBib29sIHB1YmxpYyB0ZWFtVG9rZW5zRGVsaXZlcmVkOwoKICAgIC8vIEN1cnJlbnQgRVRIL1VTRCBleGNoYW5nZSByYXRlCiAgICB1aW50MjU2IHB1YmxpYyBFVEhfVVNEX0VYQ0hBTkdFX1JBVEVfSU5fQ0VOVFM7IC8vIHNldCBieSBvcmFjbGl6ZQoKICAgIC8vIEV2ZXJ5dGhpbmcgb3JhY2xpemUgcmVsYXRlZAogICAgZXZlbnQgdXBkYXRlZFByaWNlKHN0cmluZyBwcmljZSk7CiAgICBldmVudCBuZXdPcmFjbGl6ZVF1ZXJ5KHN0cmluZyBkZXNjcmlwdGlvbik7CiAgICB1aW50IHB1YmxpYyBvcmFjbGl6ZVF1ZXJ5Q29zdDsKCiAgICAvLyBFdmVudHMgdXNlZCBmb3IgbG9nZ2luZwogICAgZXZlbnQgTG9nUmVmdW5kKGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IExvZ0NyZWF0ZUVWTihhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBMb2dEZWxpdmVyRVZOKGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IExvZ0NhbmNlbERlbGl2ZXJ5KGFkZHJlc3MgaW5kZXhlZCBfdG8sIHN0cmluZyBfaWQpOwogICAgZXZlbnQgTG9nS3ljUmVmdXNlZChhZGRyZXNzIGluZGV4ZWQgX3VzZXIsIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IExvZ1RlYW1Ub2tlbnNEZWxpdmVyZWQoYWRkcmVzcyBpbmRleGVkIGRpc3RyaWJ1dG9yLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8gQWRkaXRpb25hbCBoZWxwZXIgc3RydWN0cwogICAgZW51bSBDb250cmFjdFN0YXRlIHsgRnVuZHJhaXNpbmcsIEZpbmFsaXplZCwgUGF1c2VkIH0KCiAgICAvLyBDcmVkaXQgQ2FyZCBQdXJjaGFzZSBQYXJhbWV0ZXJzCiAgICAvL0BkZXYgVXNlY2FzZSByZWxhdGVkOiBQdXJjaGFzZSBUb2tlbnMgd2l0aCBDcmVkaXQgY2FyZAogICAgLy9AZGV2IFVzZWNhc2UgcmVsYXRlZDogQ2FuY2VsIHB1cmNoYXNlIGRvbmUgd2l0aCBjcmVkaXQgY2FyZAogICAgc3RydWN0IFB1cmNoYXNlIHsKICAgICAgICBhZGRyZXNzIGJ1eWVyOwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQ7CiAgICAgICAgYm9vbCBhY3RpdmU7CiAgICB9CgogICAgLy8gTW9kaWZpZXJzCiAgICBtb2RpZmllciBpc0ZpbmFsaXplZCgpIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IENvbnRyYWN0U3RhdGUuRmluYWxpemVkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzRnVuZHJhaXNpbmcoKSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBDb250cmFjdFN0YXRlLkZ1bmRyYWlzaW5nKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzUGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gQ29udHJhY3RTdGF0ZS5QYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoc3RhdGUgIT0gQ29udHJhY3RTdGF0ZS5QYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNGdW5kcmFpc2luZ0lnbm9yZVBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IENvbnRyYWN0U3RhdGUuRnVuZHJhaXNpbmcgfHwgKHN0YXRlID09IENvbnRyYWN0U3RhdGUuUGF1c2VkICYmIHNhdmVkU3RhdGUgPT0gQ29udHJhY3RTdGF0ZS5GdW5kcmFpc2luZykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUt5Y1RlYW0oKXsKICAgICAgICByZXF1aXJlKGlzS3ljVGVhbVttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICAvLyBjaGVjayBpZiB0cmFuc2FjdGlvbiBzZW5kZXIgaXMgYWRtaW4uCiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBhZG1pbjEgfHwgbXNnLnNlbmRlciA9PSBhZG1pbjIpOwogICAgICAgIC8vIGlmIHllcywgc3RvcmUgaGlzIG1zZy5kYXRhLiAKICAgICAgICBtdWx0aVNpZ0hhc2hlc1ttc2cuc2VuZGVyXSA9IGtlY2NhazI1Nihtc2cuZGF0YSk7CiAgICAgICAgLy8gY2hlY2sgaWYgaGlzIHN0b3JlZCBtc2cuZGF0YSBoYXNoIGVxdWFscyB0byB0aGUgb25lIG9mIHRoZSBvdGhlciBhZG1pbgogICAgICAgIGlmICgobXVsdGlTaWdIYXNoZXNbYWRtaW4xXSkgPT0gKG11bHRpU2lnSGFzaGVzW2FkbWluMl0pKSB7CiAgICAgICAgICAgIC8vIGlmIHllcywgYm90aCBhZG1pbnMgYWdyZWVkIC0gY29udGludWUuCiAgICAgICAgICAgIF87CgogICAgICAgICAgICAvLyBSZXNldCBoYXNoZXMgYWZ0ZXIgc3VjY2Vzc2Z1bCBleGVjdXRpb24KICAgICAgICAgICAgbXVsdGlTaWdIYXNoZXNbYWRtaW4xXSA9IDB4MDsKICAgICAgICAgICAgbXVsdGlTaWdIYXNoZXNbYWRtaW4yXSA9IDB4MDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiBub3QgKHlldCksIHJldHVybi4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBtb2RpZmllciBvbmx5VmVuZG9yKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB0b2tlblZlbmRvcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtaW5pbXVtUmVhY2hlZCgpIHsKICAgICAgICByZXF1aXJlKGFsbFJlY2VpdmVkRXRoID49IEVUSF9SRUNFSVZFRF9NSU4pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPj0gVE9LRU5fQ1JFQVRFRF9NSU4pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNLeWNWZXJpZmllZChhZGRyZXNzIF91c2VyKSB7CiAgICAgICAgLy8gaWYgdG9rZW4gdHJhbnNmZXJyaW5nIHVzZXIgYWNxdWlyZWQgdGhlIHRva2VucyB0aHJvdWdoIHRoZSBJQ08uLi4KICAgICAgICBpZiAoaXNJY29CdXllcltfdXNlcl0gPT0gdHJ1ZSkgewogICAgICAgICAgICAvLyAuLi5jaGVjayBpZiB1c2VyIGlzIGFscmVhZHkgdW5sb2NrZWQKICAgICAgICAgICAgcmVxdWlyZSAoa3ljVmVyaWZpZWRbX3VzZXJdID09IHRydWUpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGhhc0Vub3VnaFVubG9ja2VkVG9rZW5zKGFkZHJlc3MgX3VzZXIsIHVpbnQyNTYgX3ZhbHVlKSB7CiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHVzZXIgd2FzIGEgQ0MgYnV5ZXIgYW5kIGlmIHRoZSBsb2NrdXAgcGVyaW9kIGlzIG5vdCBvdmVyLAogICAgICAgIGlmIChjY0xvY2tlZFVwQmFsYW5jZXNbX3VzZXJdID4gMCAmJiBibG9jay5udW1iZXIgPCBjY1JlbGVhc2VCbG9jaykgewogICAgICAgICAgICAvLyBhbGxvdyB0byBvbmx5IHRyYW5zZmVyIHRoZSBub3QtbG9ja2VkIHVwIHRva2VucwogICAgICAgICAgICByZXF1aXJlICgoU2FmZU1hdGguc3ViKGJhbGFuY2VzW191c2VyXSwgX3ZhbHVlKSkgPj0gY2NMb2NrZWRVcEJhbGFuY2VzW191c2VyXSk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENyZWF0ZSBhIG5ldyBFVk5Ub2tlbiBjb250cmFjdC4KICAgICAqCiAgICAgKiAgX2Z1bmRpbmdTdGFydEJsb2NrIFRoZSBzdGFydGluZyBibG9jayBvZiB0aGUgZnVuZHJhaXNlciAoaGFzIHRvIGJlIGluIHRoZSBmdXR1cmUpLgogICAgICogIF9mdW5kaW5nRW5kQmxvY2sgVGhlIGVuZCBibG9jayBvZiB0aGUgZnVuZHJhaXNlciAoaGFzIHRvIGJlIGFmdGVyIF9mdW5kaW5nU3RhcnRCbG9jaykuCiAgICAgKiAgX3JvdW5kVHdvQmxvY2sgVGhlIGJsb2NrIHRoYXQgY2hhbmdlcyB0aGUgZGlzY291bnQgcmF0ZSB0byAyMCUgKGhhcyB0byBiZSBiZXR3ZWVuIF9mdW5kaW5nU3RhcnRCbG9jayBhbmQgX3JvdW5kVGhyZWVCbG9jaykuCiAgICAgKiAgX3JvdW5kVGhyZWVCbG9jayBUaGUgYmxvY2sgdGhhdCBjaGFuZ2VzIHRoZSBkaXNjb3VudCByYXRlIHRvIDEwJSAoaGFzIHRvIGJlIGJldHdlZW4gX3JvdW5kVHdvQmxvY2sgYW5kIF9yb3VuZEZvdXJCbG9jaykuCiAgICAgKiAgX3JvdW5kRm91ckJsb2NrIFRoZSBibG9jayB0aGF0IGNoYW5nZXMgdGhlIGRpc2NvdW50IHJhdGUgdG8gMCUgKGhhcyB0byBiZSBiZXR3ZWVuIF9yb3VuZFRocmVlQmxvY2sgYW5kIF9mdW5kaW5nRW5kQmxvY2spLgogICAgICogIF9hZG1pbjEgVGhlIGZpcnN0IGFkbWluIGFjY291bnQgdGhhdCBvd25zIHRoaXMgY29udHJhY3QuCiAgICAgKiAgX2FkbWluMiBUaGUgc2Vjb25kIGFkbWluIGFjY291bnQgdGhhdCBvd25zIHRoaXMgY29udHJhY3QuCiAgICAgKiAgX3Rva2VuVmVuZG9yIFRoZSBhY2NvdW50IHRoYXQgY3JlYXRlcyB0b2tlbnMgZm9yIGNyZWRpdCBjYXJkIC8gZmlhdCBjb250cmlidXRlcnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIEVWTlRva2VuKAogICAgICAgIHVpbnQyNTYgX2Z1bmRpbmdTdGFydEJsb2NrLAogICAgICAgIHVpbnQyNTYgX2Z1bmRpbmdFbmRCbG9jaywKICAgICAgICB1aW50MjU2IF9yb3VuZFR3b0Jsb2NrLCAvLyBibG9jayBudW1iZXIgdGhhdCB0cmlnZ2VycyB0aGUgZmlyc3QgZXhjaGFuZ2UgcmF0ZSBjaGFuZ2UKICAgICAgICB1aW50MjU2IF9yb3VuZFRocmVlQmxvY2ssIC8vIGJsb2NrIG51bWJlciB0aGF0IHRyaWdnZXJzIHRoZSBzZWNvbmQgZXhjaGFuZ2UgcmF0ZSBjaGFuZ2UKICAgICAgICB1aW50MjU2IF9yb3VuZEZvdXJCbG9jaywKICAgICAgICBhZGRyZXNzIF9hZG1pbjEsCiAgICAgICAgYWRkcmVzcyBfYWRtaW4yLAogICAgICAgIGFkZHJlc3MgX3Rva2VuVmVuZG9yLAogICAgICAgIHVpbnQyNTYgX2NjUmVsZWFzZUJsb2NrKQogICAgcGF5YWJsZQogICAgewogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHBhcmFtZXRlcnMgbWFrZSBzZW5zZQoKICAgICAgICAvLyBUaGUgc3RhcnQgb2YgdGhlIGZ1bmRyYWlzaW5nIHNob3VsZCBoYXBwZW4gaW4gdGhlIGZ1dHVyZQogICAgICAgIHJlcXVpcmUgKGJsb2NrLm51bWJlciA8PSBfZnVuZGluZ1N0YXJ0QmxvY2spOwoKICAgICAgICAvLyBUaGUgZGlzY291bnQgcmF0ZSBjaGFuZ2VzIGFuZCBlbmRpbmcgc2hvdWxkIGZvbGxvdyBpbiB0aGVpciBzdWJzZXF1ZW50IG9yZGVyCiAgICAgICAgcmVxdWlyZSAoX2Z1bmRpbmdTdGFydEJsb2NrIDwgX3JvdW5kVHdvQmxvY2spOwogICAgICAgIHJlcXVpcmUgKF9yb3VuZFR3b0Jsb2NrIDwgX3JvdW5kVGhyZWVCbG9jayk7CiAgICAgICAgcmVxdWlyZSAoX3JvdW5kVGhyZWVCbG9jayA8IF9yb3VuZEZvdXJCbG9jayk7CiAgICAgICAgcmVxdWlyZSAoX3JvdW5kRm91ckJsb2NrIDwgX2Z1bmRpbmdFbmRCbG9jayk7CgogICAgICAgIC8vIGJsb2NrIHdoZW4gdG9rZW5zIGJvdWdodCB3aXRoIENDIHdpbGwgYmUgcmVsZWFzZWQgbXVzdCBiZSBpbiB0aGUgZnV0dXJlCiAgICAgICAgcmVxdWlyZSAoX2Z1bmRpbmdFbmRCbG9jayA8IF9jY1JlbGVhc2VCbG9jayk7CgogICAgICAgIC8vIGFkbWluMSBhbmQgYWRtaW4yIGFkZHJlc3MgbXVzdCBiZSBzZXQgYW5kIG11c3QgYmUgZGlmZmVyZW50CiAgICAgICAgcmVxdWlyZSAoX2FkbWluMSAhPSAweDApOwogICAgICAgIHJlcXVpcmUgKF9hZG1pbjIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlIChfYWRtaW4xICE9IF9hZG1pbjIpOwoKICAgICAgICAvLyB0b2tlblZlbmRvciBtdXN0IGJlIHNldCBhbmQgYmUgZGlmZmVyZW50IGZyb20gYWRtaW4xIGFuZCBhZG1pbjIKICAgICAgICByZXF1aXJlIChfdG9rZW5WZW5kb3IgIT0gMHgwKTsKICAgICAgICByZXF1aXJlIChfdG9rZW5WZW5kb3IgIT0gX2FkbWluMSk7CiAgICAgICAgcmVxdWlyZSAoX3Rva2VuVmVuZG9yICE9IF9hZG1pbjIpOwoKICAgICAgICAvLyBwcm92aWRlIHNvbWUgRVRIIGZvciBvcmFjbGl6ZSBwcmljZSBmZWVkCiAgICAgICAgcmVxdWlyZSAobXNnLnZhbHVlID4gMCk7CgogICAgICAgIC8vIEluaXQgY29udHJhY3Qgc3RhdGUKICAgICAgICBzdGF0ZSA9IENvbnRyYWN0U3RhdGUuRnVuZHJhaXNpbmc7CiAgICAgICAgc2F2ZWRTdGF0ZSA9IENvbnRyYWN0U3RhdGUuRnVuZHJhaXNpbmc7CiAgICAgICAgZnVuZGluZ1N0YXJ0QmxvY2sgPSBfZnVuZGluZ1N0YXJ0QmxvY2s7CiAgICAgICAgZnVuZGluZ0VuZEJsb2NrID0gX2Z1bmRpbmdFbmRCbG9jazsKICAgICAgICByb3VuZFR3b0Jsb2NrID0gX3JvdW5kVHdvQmxvY2s7CiAgICAgICAgcm91bmRUaHJlZUJsb2NrID0gX3JvdW5kVGhyZWVCbG9jazsKICAgICAgICByb3VuZEZvdXJCbG9jayA9IF9yb3VuZEZvdXJCbG9jazsKICAgICAgICBjY1JlbGVhc2VCbG9jayA9IF9jY1JlbGVhc2VCbG9jazsKCiAgICAgICAgdG90YWxTdXBwbHkgPSAwOwoKICAgICAgICBhZG1pbjEgPSBfYWRtaW4xOwogICAgICAgIGFkbWluMiA9IF9hZG1pbjI7CiAgICAgICAgdG9rZW5WZW5kb3IgPSBfdG9rZW5WZW5kb3I7CgogICAgICAgIC8vb3JhY2xpemUgCiAgICAgICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoMTAwMDAwMDAwMDAwIHdlaSk7IC8vIHNldCB0aGUgZ2FzIHByaWNlIGEgbGl0dGxlIGJpdCBoaWdoZXIsIHNvIHRoZSBwcmljZWZlZWQgZGVmaW5pdGVseSB3b3JrcwogICAgICAgIHVwZGF0ZVByaWNlKCk7CiAgICAgICAgb3JhY2xpemVRdWVyeUNvc3QgPSBvcmFjbGl6ZV9nZXRQcmljZSgiVVJMIik7CiAgICB9CgogICAgLy8vLyBvcmFjbGl6ZSBTVEFSVAoKICAgIC8vIEBkZXYgb3JhY2xpemUgaXMgY2FsbGVkIHJlY3Vyc2l2ZWx5IGhlcmUgLSBvbmNlIGEgY2FsbGJhY2sgZmV0Y2hlcyB0aGUgbmV3ZXN0IEVUSCBwcmljZSwgdGhlIG5leHQgY2FsbGJhY2sgaXMgc2NoZWR1bGVkIGZvciB0aGUgbmV4dCBob3VyIGFnYWluCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7CgogICAgICAgIC8vIHNldHRpbmcgdGhlIHRva2VuIHByaWNlIGhlcmUKICAgICAgICBFVEhfVVNEX0VYQ0hBTkdFX1JBVEVfSU5fQ0VOVFMgPSBTYWZlTWF0aC5wYXJzZShyZXN1bHQpOwogICAgICAgIHVwZGF0ZWRQcmljZShyZXN1bHQpOwoKICAgICAgICAvLyBmZXRjaCB0aGUgbmV4dCBwcmljZQogICAgICAgIHVwZGF0ZVByaWNlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlUHJpY2UoKSBwYXlhYmxlIHsgICAgLy8gY2FuIGJlIGxlZnQgcHVibGljIGFzIGEgd2F5IGZvciByZXBsZW5pc2hpbmcgY29udHJhY3QncyBFVEggYmFsYW5jZSwganVzdCBpbiBjYXNlCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3JhY2xpemVfY2JBZGRyZXNzKCkpIHsKICAgICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gMjAwIGZpbm5leSk7CiAgICAgICAgfQogICAgICAgIGlmIChvcmFjbGl6ZV9nZXRQcmljZSgiVVJMIikgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgbmV3T3JhY2xpemVRdWVyeSgiT3JhY2xpemUgcXVlcnkgd2FzIE5PVCBzZW50LCBwbGVhc2UgYWRkIHNvbWUgRVRIIHRvIGNvdmVyIGZvciB0aGUgcXVlcnkgZmVlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T3JhY2xpemVRdWVyeSgiT3JhY2xpemUgc2VudCwgd2FpdC4uIik7CiAgICAgICAgICAgIC8vIFNjaGVkdWxlIHF1ZXJ5IGluIDEgaG91ci4gU2V0IHRoZSBnYXMgYW1vdW50IHRvIDIyMDAwMCwgYXMgcGFyc2luZyBpbiBfX2NhbGxiYWNrIHRha2VzIGFyb3VuZCA3MDAwMCAtIHdlIHBsYXkgaXQgc2FmZS4KICAgICAgICAgICAgb3JhY2xpemVfcXVlcnkoMzYwMCwgIlVSTCIsICJqc29uKGh0dHBzOi8vbWluLWFwaS5jcnlwdG9jb21wYXJlLmNvbS9kYXRhL3ByaWNlP2ZzeW09RVRIJnRzeW1zPVVTRCkuVVNEIiwgMjIwMDAwKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8vIG9yYWNsaXplIEVORAoKICAgIC8vIE92ZXJyaWRkZW4gbWV0aG9kIHRvIGNoZWNrIGZvciBlbmQgb2YgZnVuZHJhaXNpbmcgYmVmb3JlIGFsbG93aW5nIHRyYW5zZmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgcHVibGljCiAgICBpc0ZpbmFsaXplZCAvLyBPbmx5IGFsbG93IHRva2VuIHRyYW5zZmVyIGFmdGVyIHRoZSBmdW5kcmFpc2luZyBoYXMgZW5kZWQKICAgIGlzS3ljVmVyaWZpZWQobXNnLnNlbmRlcikKICAgIGhhc0Vub3VnaFVubG9ja2VkVG9rZW5zKG1zZy5zZW5kZXIsIF92YWx1ZSkKICAgIG9ubHlQYXlsb2FkU2l6ZSgyKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgdHJhY2tIb2xkZXIoX3RvKTsgLy8gdHJhY2sgdGhlIG93bmVyIGZvciBsYXRlciBwYXlvdXRzCiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gT3ZlcnJpZGRlbiBtZXRob2QgdG8gY2hlY2sgZm9yIGVuZCBvZiBmdW5kcmFpc2luZyBiZWZvcmUgYWxsb3dpbmcgdHJhbnNmZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgcHVibGljCiAgICBpc0ZpbmFsaXplZCAvLyBPbmx5IGFsbG93IHRva2VuIHRyYW5zZmVyIGFmdGVyIHRoZSBmdW5kcmFpc2luZyBoYXMgZW5kZWQKICAgIGlzS3ljVmVyaWZpZWQobXNnLnNlbmRlcikKICAgIGhhc0Vub3VnaFVubG9ja2VkVG9rZW5zKG1zZy5zZW5kZXIsIF92YWx1ZSkKICAgIG9ubHlQYXlsb2FkU2l6ZSgzKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICB0cmFja0hvbGRlcihfdG8pOyAvLyB0cmFjayB0aGUgb3duZXIgZm9yIGxhdGVyIHBheW91dHMKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLyBBbGxvdyBmb3IgZWFzaWVyIGJhbGFuY2UgY2hlY2tpbmcKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50MjU2IF9iYWxhbmNlKQogICAgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgICAvLyBnZXR0aW5nIHB1cmNoYXNlIGRldGFpbHMgYnkgSUQgLSB3b3JrYXJvdW5kLCBtYXBwaW5ncyB3aXRoIGR5bmFtaWNhbGx5IHNpemVkIGtleXMgY2FuJ3QgYmUgbWFkZSBwdWJsaWMgeWV0LgogICAgZnVuY3Rpb24gZ2V0UHVyY2hhc2VCeUlkKHN0cmluZyBfaWQpCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX3Rva2VuQW1vdW50LCBib29sIF9hY3RpdmUpewogICAgICAgIF9idXllciA9IHB1cmNoYXNlc1tfaWRdLmJ1eWVyOwogICAgICAgIF90b2tlbkFtb3VudCA9IHB1cmNoYXNlc1tfaWRdLnRva2VuQW1vdW50OwogICAgICAgIF9hY3RpdmUgPSBwdXJjaGFzZXNbX2lkXS5hY3RpdmU7CiAgICB9CgogICAgLy8gQWxsb3dzIHRvIGZpZ3VyZSBvdXQgdGhlIGFtb3VudCBvZiBrbm93biB0b2tlbiBob2xkZXJzCiAgICBmdW5jdGlvbiBnZXRIb2xkZXJDb3VudCgpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50MjU2IF9ob2xkZXJDb3VudCkKICAgIHsKICAgICAgICByZXR1cm4gaG9sZGVycy5sZW5ndGg7CiAgICB9CgogICAgLy8gQWxsb3dzIHRvIGZpZ3VyZSBvdXQgdGhlIGFtb3VudCBvZiBwdXJjaGFzZXMKICAgIGZ1bmN0aW9uIGdldFB1cmNoYXNlQ291bnQoKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludDI1NiBfcHVyY2hhc2VDb3VudCkKICAgIHsKICAgICAgICByZXR1cm4gcHVyY2hhc2VBcnJheS5sZW5ndGg7CiAgICB9CgogICAgLy8gQWxsb3dzIGZvciBlYXNpZXIgcmV0cmlldmFsIG9mIGhvbGRlciBieSBhcnJheSBpbmRleAogICAgZnVuY3Rpb24gZ2V0SG9sZGVyKHVpbnQyNTYgX2luZGV4KQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoYWRkcmVzcyBfaG9sZGVyKQogICAgewogICAgICAgIHJldHVybiBob2xkZXJzW19pbmRleF07CiAgICB9CgogICAgZnVuY3Rpb24gdHJhY2tIb2xkZXIoYWRkcmVzcyBfdG8pCiAgICBwcml2YXRlCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHJlY2lwaWVudCBpcyBhIGtub3duIHRva2VuIGhvbGRlcgogICAgICAgIGlmIChpc0hvbGRlcltfdG9dID09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIGlmIG5vdCwgYWRkIGhpbSB0byB0aGUgaG9sZGVycyBhcnJheSBhbmQgbWFyayBoaW0gYXMgYSBrbm93biBob2xkZXIKICAgICAgICAgICAgaG9sZGVycy5wdXNoKF90byk7CiAgICAgICAgICAgIGlzSG9sZGVyW190b10gPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBkZXYgQWNjZXB0cyBldGhlciBhbmQgY3JlYXRlcyBuZXcgRVZOIHRva2VucwogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5zKCkKICAgIHBheWFibGUKICAgIGV4dGVybmFsCiAgICBpc0Z1bmRyYWlzaW5nCiAgICB7CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPj0gZnVuZGluZ1N0YXJ0QmxvY2spOwogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyIDw9IGZ1bmRpbmdFbmRCbG9jayk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKCiAgICAgICAgLy8gRmlyc3Qgd2UgY2hlY2sgdGhlIEVUSCBjYXA6IHdvdWxkIGFkZGluZyB0aGlzIGFtb3VudCB0byB0aGUgdG90YWwgdW5LWUNlZCBldGggYW5kIHRoZSBhbHJlYWR5IEtZQ2VkIGV0aCBleGNlZWQgdGhlIGV0aCBjYXA/CiAgICAgICAgLy8gcmV0dXJuIHRoZSBjb250cmlidXRpb24gaWYgdGhlIGNhcCBoYXMgYmVlbiByZWFjaGVkIGFscmVhZHkKICAgICAgICB1aW50MjU2IHRvdGFsS3ljZWRBbmRVbkt5Y0VkRXRoID0gU2FmZU1hdGguYWRkKGFsbFVuS3ljZWRFdGgsIGFsbFJlY2VpdmVkRXRoKTsKICAgICAgICB1aW50MjU2IGNoZWNrZWRSZWNlaXZlZEV0aCA9IFNhZmVNYXRoLmFkZCh0b3RhbEt5Y2VkQW5kVW5LeWNFZEV0aCwgbXNnLnZhbHVlKTsKICAgICAgICByZXF1aXJlKGNoZWNrZWRSZWNlaXZlZEV0aCA8PSBFVEhfUkVDRUlWRURfQ0FQKTsKCiAgICAgICAgLy8gSWYgYWxsIGlzIGZpbmUgd2l0aCB0aGUgRVRIIGNhcCwgd2UgY29udGludWUgdG8gY2hlY2sgdGhlCiAgICAgICAgLy8gbWluaW11bSBhbW91bnQgb2YgdG9rZW5zIGFuZCB0aGUgY2FwIGZvciBob3cgbWFueSB0b2tlbnMKICAgICAgICAvLyBoYXZlIGJlZW4gZ2VuZXJhdGVkIHNvIGZhcgoKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIHRva2VuIGFtb3VudAogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gU2FmZU1hdGgubXVsKG1zZy52YWx1ZSwgRVRIX1VTRF9FWENIQU5HRV9SQVRFX0lOX0NFTlRTKTsKCiAgICAgICAgLy8gZGl2aWRlIGJ5IDEwMCB0byB0dXJuIEVUSF9VU0RfRVhDSEFOR0VfUkFURV9JTl9DRU5UUyBpbnRvIGZ1bGwgVVNECiAgICAgICAgdG9rZW5zID0gdG9rZW5zIC8gMTAwOwoKICAgICAgICAvLyBhcHBseSBkaXNjb3VudCBtdWx0aXBsaWVyCiAgICAgICAgdG9rZW5zID0gc2FmZU11bFBlcmNlbnRhZ2UodG9rZW5zLCBnZXRDdXJyZW50RGlzY291bnRSYXRlKCkpOwoKICAgICAgICByZXF1aXJlKHRva2VucyA+PSBUT0tFTl9NSU4pOwogICAgICAgIHVpbnQyNTYgY2hlY2tlZFN1cHBseSA9IFNhZmVNYXRoLmFkZCh0b3RhbFN1cHBseSwgdG9rZW5zKTsKICAgICAgICByZXF1aXJlKGNoZWNrZWRTdXBwbHkgPD0gVE9LRU5fQ1JFQVRJT05fQ0FQKTsKCiAgICAgICAgLy8gT25seSB3aGVuIGFsbCB0aGUgY2hlY2tzIGhhdmUgcGFzc2VkLCB0aGVuIHdlIGNoZWNrIGlmIHRoZSBhZGRyZXNzIGlzIGFscmVhZHkgS1lDRWQgYW5kIHRoZW4gCiAgICAgICAgLy8gdXBkYXRlIHRoZSBzdGF0ZSAobm9LeWNFdGhCYWxhbmNlcywgYWxsUmVjZWl2ZWRFdGgsIHRvdGFsU3VwcGx5LCBhbmQgYmFsYW5jZXMpIG9mIHRoZSBjb250cmFjdAoKICAgICAgICBpZiAoa3ljVmVyaWZpZWRbbXNnLnNlbmRlcl0gPT0gZmFsc2UpIHsKICAgICAgICAgICAgLy8gQGRldiBUaGUgdW5LWUNlZCBldGggYmFsYW5jZXMgYXJlIG1vdmVkIHRvIGV0aEJhbGFuY2VzIGluIHVubG9ja0t5YygpCgogICAgICAgICAgICBub0t5Y0V0aEJhbGFuY2VzW21zZy5zZW5kZXJdID0gU2FmZU1hdGguYWRkKG5vS3ljRXRoQmFsYW5jZXNbbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7CgogICAgICAgICAgICAvLyBhZGQgdGhlIGNvbnRyaWJ1dGVkIGV0aCB0byB0aGUgdG90YWwgdW5LWUNlZCBldGggYW1vdW50CiAgICAgICAgICAgIGFsbFVuS3ljZWRFdGggPSBTYWZlTWF0aC5hZGQoYWxsVW5LeWNlZEV0aCwgbXNnLnZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiBidXllciBpcyBhbHJlYWR5IEtZQyB1bmxvY2tlZC4uLgogICAgICAgICAgICBldGhCYWxhbmNlc1ttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLmFkZChldGhCYWxhbmNlc1ttc2cuc2VuZGVyXSwgbXNnLnZhbHVlKTsKICAgICAgICAgICAgYWxsUmVjZWl2ZWRFdGggPSBTYWZlTWF0aC5hZGQoYWxsUmVjZWl2ZWRFdGgsIG1zZy52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICB0b3RhbFN1cHBseSA9IGNoZWNrZWRTdXBwbHk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOyAgLy8gc2FmZUFkZCBub3QgbmVlZGVkOyBiYWQgc2VtYW50aWNzIHRvIHVzZSBoZXJlCgogICAgICAgIHRyYWNrSG9sZGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyB0byBmb3JjZSB0aGUgY2hlY2sgZm9yIEtZQyBTdGF0dXMgdXBvbiB0aGUgdXNlciB3aGVuIGhlIHRyaWVzIHRyYW5zZmVycmluZyB0b2tlbnMKICAgICAgICAvLyBhbmQgZXhjbHVkZSBldmVyeSBsYXRlciB0b2tlbiBvd25lcgogICAgICAgIGlzSWNvQnV5ZXJbbXNnLnNlbmRlcl0gPSB0cnVlOwoKICAgICAgICAvLyBMb2cgdGhlIGNyZWF0aW9uIG9mIHRoZXNlIHRva2VucwogICAgICAgIExvZ0NyZWF0ZUVWTihtc2cuc2VuZGVyLCB0b2tlbnMpOwogICAgfQoKICAgIC8vYWRkIGEgdXNlciB0byB0aGUgS1lDIHRlYW0KICAgIGZ1bmN0aW9uIGFkZFRvS3ljVGVhbShhZGRyZXNzIF90ZWFtTWVtYmVyKQogICAgb25seU93bmVyCiAgICBvbmx5UGF5bG9hZFNpemUoMSl7CiAgICAgICAgaXNLeWNUZWFtW190ZWFtTWVtYmVyXSA9IHRydWU7CiAgICB9CgogICAgLy9yZW1vdmUgYSB1c2VyIGZyb20gdGhlIEtZQyB0ZWFtCiAgICBmdW5jdGlvbiByZW1vdmVGcm9tS3ljVGVhbShhZGRyZXNzIF90ZWFtTWVtYmVyKQogICAgb25seU93bmVyCiAgICBvbmx5UGF5bG9hZFNpemUoMSl7CiAgICAgICAgaXNLeWNUZWFtW190ZWFtTWVtYmVyXSA9IGZhbHNlOwogICAgfQoKICAgIC8vY2FsbGVkIGJ5IEtZQyB0ZWFtIAogICAgZnVuY3Rpb24gdW5sb2NrS3ljKGFkZHJlc3MgX293bmVyKQogICAgZXh0ZXJuYWwKICAgIG9ubHlLeWNUZWFtIHsKICAgICAgICByZXF1aXJlKGt5Y1ZlcmlmaWVkW19vd25lcl0gPT0gZmFsc2UpOwoKICAgICAgICAvL3VubG9jayB0aGUgb3duZXIgdG8gYWxsb3cgdHJhbnNmZXIgb2YgdG9rZW5zCiAgICAgICAga3ljVmVyaWZpZWRbX293bmVyXSA9IHRydWU7CgogICAgICAgIC8vIHdlIGxlYXZlIHRoZSBjY0xvY2tlZFVwQmFsYW5jZXNbX293bmVyXSBhcyBpcywgYmVjYXVzZSBhbHNvIEtZQ2VkIHVzZXJzIGNvdWxkIGNhbmNlbCB0aGVpciBDQyBwYXltZW50cwoKICAgICAgICBpZiAobm9LeWNFdGhCYWxhbmNlc1tfb3duZXJdID4gMCkgeyAvLyBjaGVjayBpZiB0aGUgdXNlciB3YXMgYW4gRVRIIGJ1eWVyCgogICAgICAgICAgICAvLyBub3cgbW92ZSB0aGUgdW5LWUNlZCBldGggYmFsYW5jZSB0byB0aGUgcmVndWxhciBldGhCYWxhbmNlLiAKICAgICAgICAgICAgZXRoQmFsYW5jZXNbX293bmVyXSA9IG5vS3ljRXRoQmFsYW5jZXNbX293bmVyXTsKCiAgICAgICAgICAgIC8vIGFkZCB0aGUgbm93IEtZQ2VkIGV0aCB0byB0aGUgdG90YWwgcmVjZWl2ZWQgZXRoCiAgICAgICAgICAgIGFsbFJlY2VpdmVkRXRoID0gU2FmZU1hdGguYWRkKGFsbFJlY2VpdmVkRXRoLCBub0t5Y0V0aEJhbGFuY2VzW19vd25lcl0pOwoKICAgICAgICAgICAgLy8gc3VidHJhY3QgdGhlIG5vdyBLWUNlZCBldGggZnJvbSB0b3RhbCBhbW91bnQgb2YgdW5LWUNlZCBldGgKICAgICAgICAgICAgYWxsVW5LeWNlZEV0aCA9IFNhZmVNYXRoLnN1YihhbGxVbkt5Y2VkRXRoLCBub0t5Y0V0aEJhbGFuY2VzW19vd25lcl0pOwoKICAgICAgICAgICAgLy8gYW5kIHNldCB0aGUgdXNlcidzIHVuS1lDZWQgZXRoIGJhbGFuY2UgdG8gMAogICAgICAgICAgICBub0t5Y0V0aEJhbGFuY2VzW19vd25lcl0gPSAwOyAvLyBwcmV2ZW50aW5nIHJlcGxheSBhdHRhY2tzCiAgICAgICAgfQogICAgfQoKICAgIC8vIFJlZnVzaW5nIEtZQyBvZiBhIHVzZXIsIHdobyBvbmx5IGNvbnRyaWJ1dGVkIGluIEVUSC4KICAgIC8vIFdlIG11c3QgcGF5IGNsb3NlIGF0dGVudGlvbiBoZXJlIGZvciB0aGUgY2FzZSB0aGF0IGEgdXNlciBjb250cmlidXRlcyBpbiBFVEggQU5EKCEpIENDICEKICAgIC8vIGluIHRoaXMgY2FzZSwgaGUgbXVzdCBvbmx5IGtpbGwgdGhlIHRva2VucyBoZSByZWNlaXZlZCB0aHJvdWdoIEVUSCwgdGhlIG9uZXMgYm91Z2h0IGluIGZpYXQgd2lsbCBiZQogICAgLy8ga2lsbGVkIGJ5IGNhbmNlbGluZyBoaXMgcGF5bWVudHMgYW5kIHN1YnNlcXVlbnRseSBjYWxsaW5nIGNhbmNlbERlbGl2ZXJ5KCkgd2l0aCB0aGUgYWNjb3JkaW5nIHBheW1lbnQgaWQuCiAgICBmdW5jdGlvbiByZWZ1c2VLeWMoYWRkcmVzcyBfdXNlcikKICAgIGV4dGVybmFsCiAgICBvbmx5S3ljVGVhbQogICAgewogICAgICAgIC8vIG9uY2UgYSB1c2VyIGlzIHZlcmlmaWVkLCB5b3UgY2FuJ3Qga2ljayBoaW0gb3V0LgogICAgICAgIHJlcXVpcmUgKGt5Y1ZlcmlmaWVkW191c2VyXSA9PSBmYWxzZSk7CgogICAgICAgIC8vIGltbWVkaWF0ZWx5IHN0b3AsIGlmIGEgdXNlciBoYXMgbm9uZSBvciBvbmx5IENDIGNvbnRyaWJ1dGlvbnMuCiAgICAgICAgLy8gd2UncmUgbWFuYWdpbmcga3ljIHJlZnVzaW5nIG9mIENDIGNvbnRyaWJ1dG9ycyBvZmYtY2hhaW4KICAgICAgICByZXF1aXJlKG5vS3ljRXRoQmFsYW5jZXNbX3VzZXJdPjApOwoKICAgICAgICB1aW50MjU2IEVWTlZhbCA9IGJhbGFuY2VzW191c2VyXTsKICAgICAgICByZXF1aXJlKEVWTlZhbCA+IDApOwoKICAgICAgICB1aW50MjU2IGV0aFZhbCA9IG5vS3ljRXRoQmFsYW5jZXNbX3VzZXJdOyAvLyByZWZ1bmQgdW4tS1lDZCBldGgKICAgICAgICByZXF1aXJlKGV0aFZhbCA+IDApOwoKICAgICAgICAvLyBVcGRhdGUgdGhlIHN0YXRlIG9ubHkgYWZ0ZXIgYWxsIHRoZSBjaGVja3MgaGF2ZSBwYXNzZWQKICAgICAgICBhbGxVbkt5Y2VkRXRoID0gU2FmZU1hdGguc3ViKGFsbFVuS3ljZWRFdGgsIG5vS3ljRXRoQmFsYW5jZXNbX3VzZXJdKTsgLy8gb3IgaWYgdGhlcmUgd2FzIGFueSB1bktZQ2VkIEV0aCwgc3VidHJhY3QgaXQgZnJvbSB0aGUgdG90YWwgdW5LWUNlZCBldGggYmFsYW5jZS4KICAgICAgICBiYWxhbmNlc1tfdXNlcl0gPSBjY0xvY2tlZFVwQmFsYW5jZXNbX3VzZXJdOyAvLyBhc3NpZ24gdXNlciBvbmx5IHRoZSB0b2tlbiBhbW91bnQgaGUgaGFzIGJvdWdodCB0aHJvdWdoIENDLCBpZiB0aGVyZSBhcmUgYW55LgogICAgICAgIG5vS3ljRXRoQmFsYW5jZXNbX3VzZXJdID0gMDsKICAgICAgICB0b3RhbFN1cHBseSA9IFNhZmVNYXRoLnN1Yih0b3RhbFN1cHBseSwgRVZOVmFsKTsgLy8gRXh0cmEgc2FmZQoKICAgICAgICAvLyBMb2cgdGhpcyByZWZ1bmQKICAgICAgICBMb2dLeWNSZWZ1c2VkKF91c2VyLCBldGhWYWwpOwoKICAgICAgICAvLyBTZW5kIHRoZSBjb250cmlidXRpb25zIG9ubHkgYWZ0ZXIgd2UgaGF2ZSB1cGRhdGVkIGFsbCB0aGUgYmFsYW5jZXMKICAgICAgICAvLyBJZiB5b3UncmUgdXNpbmcgYSBjb250cmFjdCwgbWFrZSBzdXJlIGl0IHdvcmtzIHdpdGggLnRyYW5zZmVyKCkgZ2FzIGxpbWl0cwogICAgICAgIF91c2VyLnRyYW5zZmVyKGV0aFZhbCk7CiAgICB9CgogICAgLy8gQ2FsbGVkIGluIGNhc2UgYSBidXllciBjYW5jZWxzIGhpcyBDQyBwYXltZW50LgogICAgLy8gQHBhcmFtIFRoZSBwYXltZW50IElEIGZyb20gcGF5bWVudCBwcm92aWRlcgogICAgZnVuY3Rpb24gY2FuY2VsRGVsaXZlcnkoc3RyaW5nIF9wdXJjaGFzZUlEKQogICAgZXh0ZXJuYWwKICAgIG9ubHlLeWNUZWFtewogICAgICAgIAogICAgICAgIC8vIENDIHBheW1lbnRzIGFyZSBvbmx5IGNhbmNlbGFibGUgdW50aWwgY2NSZWxlYXNlQmxvY2sKICAgICAgICByZXF1aXJlIChibG9jay5udW1iZXIgPCBjY1JlbGVhc2VCbG9jayk7CgogICAgICAgIC8vIGNoZWNrIGlmIHRoZSBwdXJjaGFzZSB0byBjYW5jZWwgaXMgc3RpbGwgYWN0aXZlCiAgICAgICAgcmVxdWlyZSAocHVyY2hhc2VzW19wdXJjaGFzZUlEXS5hY3RpdmUgPT0gdHJ1ZSk7CgogICAgICAgIC8vIG5vdyB3aXRoZHJhdyB0aGUgY2FuY2VsZWQgcHVyY2hhc2UncyB0b2tlbiBhbW91bnQgZnJvbSB0aGUgdXNlcidzIGJhbGFuY2UKICAgICAgICBiYWxhbmNlc1twdXJjaGFzZXNbX3B1cmNoYXNlSURdLmJ1eWVyXSA9IFNhZmVNYXRoLnN1YihiYWxhbmNlc1twdXJjaGFzZXNbX3B1cmNoYXNlSURdLmJ1eWVyXSwgcHVyY2hhc2VzW19wdXJjaGFzZUlEXS50b2tlbkFtb3VudCk7CgogICAgICAgIC8vIGFuZCB3aXRoZHJhdyB0aGUgY2FuY2VsZWQgcHVyY2hhc2UncyB0b2tlbiBhbW91bnQgZnJvbSB0aGUgbG9ja2VkVXAgdG9rZW4gYmFsYW5jZQogICAgICAgIGNjTG9ja2VkVXBCYWxhbmNlc1twdXJjaGFzZXNbX3B1cmNoYXNlSURdLmJ1eWVyXSA9IFNhZmVNYXRoLnN1YihjY0xvY2tlZFVwQmFsYW5jZXNbcHVyY2hhc2VzW19wdXJjaGFzZUlEXS5idXllcl0sIHB1cmNoYXNlc1tfcHVyY2hhc2VJRF0udG9rZW5BbW91bnQpOwoKICAgICAgICAvLyBzZXQgdGhlIHB1cmNoYXNlJ3Mgc3RhdHVzIHRvIGluYWN0aXZlCiAgICAgICAgcHVyY2hhc2VzW19wdXJjaGFzZUlEXS5hY3RpdmUgPSBmYWxzZTsKCiAgICAgICAgLy9jb3JyZWN0IHRoIGFtb3VudCBvZiB0b2tlbnMgZ2VuZXJhdGVkCiAgICAgICAgdG90YWxTdXBwbHkgPSBTYWZlTWF0aC5zdWIodG90YWxTdXBwbHksIHB1cmNoYXNlc1tfcHVyY2hhc2VJRF0udG9rZW5BbW91bnQpOwoKICAgICAgICBMb2dDYW5jZWxEZWxpdmVyeShwdXJjaGFzZXNbX3B1cmNoYXNlSURdLmJ1eWVyLCBfcHVyY2hhc2VJRCk7CiAgICB9CgogICAgLy8gQGRldiBEZWxpdmVyIHRva2VucyBzb2xkIGZvciBDQy9maWF0IGFuZCBCVEMKICAgIC8vIEBkZXYgcGFyYW0gX3Rva2VucyBpbiBDZW50cywgZS5nLiAxIFRva2VuID09IDEkLCBwYXNzZWQgYXMgMTAwIGNlbnRzCiAgICAvLyBAZGV2IHBhcmFtIF9idGNCdXllciBCb29sZWFuIHRvIGRldGVybWluZSBpZiB0aGUgZGVsaXZlcmVkIHRva2VucyBuZWVkIHRvIGJlIGxvY2tlZCAobm90IHRoZSBjYXNlIGZvciBCVEMgYnV5ZXJzLCB0aGVpciBwYXltZW50IGlzIGZpbmFsKQogICAgLy8gQGRldiBkaXNjb3VudCBtdWx0aXBsaWVycyBhcmUgYXBwbGllZCBvZmYtY29udHJhY3QgaW4gdGhpcyBjYXNlCiAgICBmdW5jdGlvbiBkZWxpdmVyVG9rZW5zKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbnMsIHN0cmluZyBfcHVyY2hhc2VJZCwgYm9vbCBfYnRjQnV5ZXIpCiAgICBleHRlcm5hbAogICAgaXNGdW5kcmFpc2luZwogICAgb25seVZlbmRvcgogICAgewogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG9rZW5zID4gMCk7CiAgICAgICAgcmVxdWlyZShieXRlcyhfcHVyY2hhc2VJZCkubGVuZ3RoPjApOwogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyID49IGZ1bmRpbmdTdGFydEJsb2NrKTsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA8PSBmdW5kaW5nRW5kQmxvY2sgKyAxNjgwMDApOyAvLyBhbGxvdyBkZWxpdmVyeSBvZiB0b2tlbnMgc29sZCBmb3IgZmlhdCBmb3IgMjggZGF5cyBhZnRlciBlbmQgb2YgSUNPIGZvciBzYWZldHkgcmVhc29ucwoKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYW5kIGN1dCBvdXQgdGhlIGV4dHJhIHR3byBkZWNpbWFsIHVuaXRzLAogICAgICAgIC8vIGJlY2F1c2UgX3Rva2VucyB3YXMgaW4gY2VudHMuCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBTYWZlTWF0aC5tdWwoX3Rva2VucywgKDEwKiooZGVjaW1hbHMpIC8gMTAqKjIpKTsKCiAgICAgICAgLy8gY29udGludWUgdG8gY2hlY2sgZm9yIGhvdyBtYW55IHRva2VucwogICAgICAgIC8vIGhhdmUgYmVlbiBnZW5lcmF0ZWQgc28gZmFyCiAgICAgICAgdWludDI1NiBjaGVja2VkU3VwcGx5ID0gU2FmZU1hdGguYWRkKHRvdGFsU3VwcGx5LCB0b2tlbnMpOwogICAgICAgIHJlcXVpcmUoY2hlY2tlZFN1cHBseSA8PSBUT0tFTl9DUkVBVElPTl9DQVApOwoKICAgICAgICAvLyBPbmx5IHdoZW4gYWxsIHRoZSBjaGVja3MgaGF2ZSBwYXNzZWQsIHRoZW4gd2UgdXBkYXRlIHRoZSBzdGF0ZSAodG90YWxTdXBwbHksIGFuZCBiYWxhbmNlcykgb2YgdGhlIGNvbnRyYWN0CiAgICAgICAgdG90YWxTdXBwbHkgPSBjaGVja2VkU3VwcGx5OwoKICAgICAgICAvLyBwcmV2ZW50IGZyb20gYWRkaW5nIGEgZGVsaXZlcnkgbXVsdGlwbGUgdGltZXMKICAgICAgICByZXF1aXJlKHB1cmNoYXNlc1tfcHVyY2hhc2VJZF0uYnV5ZXI9PTB4MCk7CgogICAgICAgIC8vIExvZyB0aGlzIGluZm9ybWF0aW9uIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gY2FuY2VsIHRva2VuIGRlbGl2ZXJpZXMgKG9uIENDIHJlZnVuZCkgYnkgdGhlIHBheW1lbnQgSUQKICAgICAgICBwdXJjaGFzZXNbX3B1cmNoYXNlSWRdID0gUHVyY2hhc2UoewogICAgICAgICAgICBidXllcjogX3RvLAogICAgICAgICAgICB0b2tlbkFtb3VudDogdG9rZW5zLAogICAgICAgICAgICBhY3RpdmU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBwdXJjaGFzZUFycmF5LnB1c2goX3B1cmNoYXNlSWQpOwoKICAgICAgICAvLyBpZiB0b2tlbnMgd2VyZSBub3QgcGFpZCB3aXRoIEJUQyAoYnV0IGNyZWRpdCBjYXJkKSwgdGhleSBuZWVkIHRvIGJlIGxvY2tlZCB1cCAKICAgICAgICBpZiAoX2J0Y0J1eWVyID09IGZhbHNlKSB7CiAgICAgICAgY2NMb2NrZWRVcEJhbGFuY2VzW190b10gPSBTYWZlTWF0aC5hZGQoY2NMb2NrZWRVcEJhbGFuY2VzW190b10sIHRva2Vucyk7IC8vIHVwZGF0ZSB1c2VyJ3MgbG9ja2VkIHVwIHRva2VuIGJhbGFuY2UKICAgICAgICB9CgogICAgICAgIGJhbGFuY2VzW190b10gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbX3RvXSwgdG9rZW5zKTsgICAgICAgICAgICAgICAgICAgICAvLyBzYWZlQWRkIG5vdCBuZWVkZWQ7IGJhZCBzZW1hbnRpY3MgdG8gdXNlIGhlcmUKICAgICAgICB0cmFja0hvbGRlcihfdG8pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9nIGhvbGRlcidzIGFkZHJlc3MKCiAgICAgICAgLy8gdG8gZm9yY2UgdGhlIGNoZWNrIGZvciBLWUMgU3RhdHVzIHVwb24gdGhlIHVzZXIgd2hlbiBoZSB0cmllcyB0cmFuc2ZlcnJpbmcgdG9rZW5zCiAgICAgICAgLy8gYW5kIGV4Y2x1ZGUgZXZlcnkgbGF0ZXIgdG9rZW4gb3duZXIKICAgICAgICBpc0ljb0J1eWVyW190b10gPSB0cnVlOwoKICAgICAgICAvLyBMb2cgdGhlIGNyZWF0aW9uIG9mIHRoZXNlIHRva2VucwogICAgICAgIExvZ0RlbGl2ZXJFVk4oX3RvLCB0b2tlbnMpOwogICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCB0b2tlbiBwcmljZQogICAgZnVuY3Rpb24gZ2V0Q3VycmVudERpc2NvdW50UmF0ZSgpCiAgICBwcml2YXRlCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludDI1NiBjdXJyZW50RGlzY291bnRSYXRlKQogICAgewogICAgICAgIC8vIGRldGVybWluZSB3aGljaCBkaXNjb3VudCB0byBhcHBseQogICAgICAgIGlmIChibG9jay5udW1iZXIgPCByb3VuZFR3b0Jsb2NrKSB7CiAgICAgICAgICAgIC8vIGZpcnN0IHJvdW5kCiAgICAgICAgICAgIHJldHVybiBUT0tFTl9GSVJTVF9ESVNDT1VOVF9NVUxUSVBMSUVSOwogICAgICAgIH0gZWxzZSBpZiAoYmxvY2subnVtYmVyIDwgcm91bmRUaHJlZUJsb2NrKXsKICAgICAgICAgICAgLy8gc2Vjb25kIHJvdW5kCiAgICAgICAgICAgIHJldHVybiBUT0tFTl9TRUNPTkRfRElTQ09VTlRfTVVMVElQTElFUjsKICAgICAgICB9IGVsc2UgaWYgKGJsb2NrLm51bWJlciA8IHJvdW5kRm91ckJsb2NrKSB7CiAgICAgICAgICAgIC8vIHRoaXJkIHJvdW5kCiAgICAgICAgICAgIHJldHVybiBUT0tFTl9USElSRF9ESVNDT1VOVF9NVUxUSVBMSUVSOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGZvdXJ0aCByb3VuZCwgbm8gZGlzY291bnQKICAgICAgICAgICAgcmV0dXJuIDEwMDAwMDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHRyYW5zZmVyIGV0aGVyIGZyb20gdGhlIGNvbnRyYWN0IGFzIHNvb24gYXMgdGhlIG1pbmltdW0gaXMgcmVhY2hlZAogICAgZnVuY3Rpb24gcmV0cmlldmVFdGgodWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3NhZmUpCiAgICBleHRlcm5hbAogICAgbWluaW11bVJlYWNoZWQKICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoU2FmZU1hdGguc3ViKHRoaXMuYmFsYW5jZSwgX3ZhbHVlKSA+PSBhbGxVbkt5Y2VkRXRoKTsgLy8gbWFrZSBzdXJlIHVuS1lDZWQgZXRoIGNhbm5vdCBiZSB3aXRoZHJhd24KICAgICAgICAvLyBtYWtlIHN1cmUgYSByZWNpcGllbnQgd2FzIGRlZmluZWQgIQogICAgICAgIHJlcXVpcmUgKF9zYWZlICE9IDB4MCk7CgogICAgICAgIC8vIHNlbmQgdGhlIGV0aCB0byB3aGVyZSBhZG1pbnMgYWdyZWUgdXBvbgogICAgICAgIF9zYWZlLnRyYW5zZmVyKF92YWx1ZSk7CiAgICB9CgoKICAgIC8vLyBAZGV2IEVuZHMgdGhlIGZ1bmRyYWlzaW5nIHBlcmlvZCBhbmQgc2VuZHMgdGhlIEVUSCB0byB3aGVyZXZlciB0aGUgYWRtaW5zIGFncmVlIHVwb24KICAgIGZ1bmN0aW9uIGZpbmFsaXplKGFkZHJlc3MgX3NhZmUpCiAgICBleHRlcm5hbAogICAgaXNGdW5kcmFpc2luZwogICAgbWluaW11bVJlYWNoZWQKICAgIG9ubHlPd25lciAgLy8gT25seSB0aGUgYWRtaW5zIGNhbGxpbmcgdGhpcyBtZXRob2QgZXhhY3RseSB0aGUgc2FtZSB3YXkgY2FuIGZpbmFsaXplIHRoZSBzYWxlLgogICAgewogICAgICAgIC8vIE9ubHkgYWxsb3cgdG8gZmluYWxpemUgdGhlIGNvbnRyYWN0IGJlZm9yZSB0aGUgZW5kaW5nIGJsb2NrIGlmIHdlIGFscmVhZHkgcmVhY2hlZCBhbnkgb2YgdGhlIHR3byBjYXBzCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiBmdW5kaW5nRW5kQmxvY2sgfHwgdG90YWxTdXBwbHkgPj0gVE9LRU5fQ1JFQVRFRF9NSU4gfHwgYWxsUmVjZWl2ZWRFdGggPj0gRVRIX1JFQ0VJVkVEX01JTik7CiAgICAgICAgLy8gbWFrZSBzdXJlIGEgcmVjaXBpZW50IHdhcyBkZWZpbmVkICEKICAgICAgICByZXF1aXJlIChfc2FmZSAhPSAweDApOwoKICAgICAgICAvLyBNb3ZlIHRoZSBjb250cmFjdCB0byBGaW5hbGl6ZWQgc3RhdGUKICAgICAgICBzdGF0ZSA9IENvbnRyYWN0U3RhdGUuRmluYWxpemVkOwogICAgICAgIHNhdmVkU3RhdGUgPSBDb250cmFjdFN0YXRlLkZpbmFsaXplZDsKCiAgICAgICAgLy8gU2VuZCB0aGUgS1lDZWQgRVRIIHRvIHdoZXJlIGFkbWlucyBhZ3JlZSB1cG9uLgogICAgICAgIF9zYWZlLnRyYW5zZmVyKGFsbFJlY2VpdmVkRXRoKTsKICAgIH0KCgogICAgLy8vIEBkZXYgUGF1c2VzIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gcGF1c2UoKQogICAgZXh0ZXJuYWwKICAgIG5vdFBhdXNlZCAgIC8vIFByZXZlbnQgdGhlIGNvbnRyYWN0IGdldHRpbmcgc3R1Y2sgaW4gdGhlIFBhdXNlZCBzdGF0ZQogICAgb25seU93bmVyICAgLy8gT25seSBib3RoIGFkbWlucyBjYWxsaW5nIHRoaXMgbWV0aG9kIGNhbiBwYXVzZSB0aGUgY29udHJhY3QKICAgIHsKICAgICAgICAvLyBNb3ZlIHRoZSBjb250cmFjdCB0byBQYXVzZWQgc3RhdGUKICAgICAgICBzYXZlZFN0YXRlID0gc3RhdGU7CiAgICAgICAgc3RhdGUgPSBDb250cmFjdFN0YXRlLlBhdXNlZDsKICAgIH0KCgogICAgLy8vIEBkZXYgUHJvY2VlZHMgd2l0aCB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIHByb2NlZWQoKQogICAgZXh0ZXJuYWwKICAgIGlzUGF1c2VkCiAgICBvbmx5T3duZXIgICAvLyBPbmx5IGJvdGggYWRtaW5zIGNhbGxpbmcgdGhpcyBtZXRob2QgY2FuIHByb2NlZWQgd2l0aCB0aGUgY29udHJhY3QKICAgIHsKICAgICAgICAvLyBNb3ZlIHRoZSBjb250cmFjdCB0byB0aGUgcHJldmlvdXMgc3RhdGUKICAgICAgICBzdGF0ZSA9IHNhdmVkU3RhdGU7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGNvbnRyaWJ1dG9ycyB0byByZWNvdmVyIHRoZWlyIGV0aGVyIGluIGNhc2UgdGhlIG1pbmltdW0gZnVuZGluZyBnb2FsIGlzIG5vdCByZWFjaGVkCiAgICBmdW5jdGlvbiByZWZ1bmQoKQogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICAvLyBBbGxvdyByZWZ1bmRzIG9ubHkgYSB3ZWVrIGFmdGVyIGVuZCBvZiBmdW5kaW5nIHRvIGdpdmUgS1lDLXRlYW0gdGltZSB0byB2ZXJpZnkgY29udHJpYnV0b3JzCiAgICAgICAgLy8gYW5kIHRoZXJlYnkgbW92ZSB1bi1LWUMtZWQgRVRIIG92ZXIgaW50byBhbGxSZWNlaXZlZEV0aCBhcyB3ZWxsIGFzIGRlbGl2ZXIgdGhlIHRva2VucyBwYWlkIHdpdGggQ0MKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+IChmdW5kaW5nRW5kQmxvY2sgKyA0MjAwMCkpOwoKICAgICAgICAvLyBObyByZWZ1bmRzIGlmIHRoZSBtaW5pbXVtIGhhcyBiZWVuIHJlYWNoZWQgb3IgbWluaW11bSBvZiAxIE1pbGxpb24gVG9rZW5zIGhhdmUgYmVlbiBnZW5lcmF0ZWQKICAgICAgICByZXF1aXJlKGFsbFJlY2VpdmVkRXRoIDwgRVRIX1JFQ0VJVkVEX01JTiB8fCB0b3RhbFN1cHBseSA8IFRPS0VOX0NSRUFURURfTUlOKTsKCiAgICAgICAgLy8gdG8gcHJldmVudCBDQyBidXllcnMgZnJvbSBhY2NpZGVudGFsbHkgY2FsbGluZyByZWZ1bmQgYW5kIGJ1cm5pbmcgdGhlaXIgdG9rZW5zCiAgICAgICAgcmVxdWlyZSAoZXRoQmFsYW5jZXNbbXNnLnNlbmRlcl0gPiAwIHx8IG5vS3ljRXRoQmFsYW5jZXNbbXNnLnNlbmRlcl0gPiAwKTsKCiAgICAgICAgLy8gT25seSByZWZ1bmQgaWYgdGhlcmUgYXJlIEVWTiB0b2tlbnMKICAgICAgICB1aW50MjU2IEVWTlZhbCA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUoRVZOVmFsID4gMCk7CgogICAgICAgIC8vIHJlZnVuZHMgZWl0aGVyIEtZQ2VkIGV0aCBvciB1bi1LWUNkIGV0aAogICAgICAgIHVpbnQyNTYgZXRoVmFsID0gU2FmZU1hdGguYWRkKGV0aEJhbGFuY2VzW21zZy5zZW5kZXJdLCBub0t5Y0V0aEJhbGFuY2VzW21zZy5zZW5kZXJdKTsKICAgICAgICByZXF1aXJlKGV0aFZhbCA+IDApOwoKICAgICAgICBhbGxSZWNlaXZlZEV0aCA9IFNhZmVNYXRoLnN1YihhbGxSZWNlaXZlZEV0aCwgZXRoQmFsYW5jZXNbbXNnLnNlbmRlcl0pOyAgICAvLyBzdWJ0cmFjdCBvbmx5IHRoZSBLWUNlZCBFVEggZnJvbSBhbGxSZWNlaXZlZEV0aCwgYmVjYXVzZSB0aGUgbGF0dGVyIGlzIHdoYXQgYWRtaW5zIHdpbGwgb25seSBiZSBhYmxlIHRvIHdpdGhkcmF3CiAgICAgICAgYWxsVW5LeWNlZEV0aCA9IFNhZmVNYXRoLnN1YihhbGxVbkt5Y2VkRXRoLCBub0t5Y0V0aEJhbGFuY2VzW21zZy5zZW5kZXJdKTsgLy8gb3IgaWYgdGhlcmUgd2FzIGFueSB1bktZQ2VkIEV0aCwgc3VidHJhY3QgaXQgZnJvbSB0aGUgdG90YWwgdW5LWUNlZCBldGggYmFsYW5jZS4KCiAgICAgICAgLy8gVXBkYXRlIHRoZSBzdGF0ZSBvbmx5IGFmdGVyIGFsbCB0aGUgY2hlY2tzIGhhdmUgcGFzc2VkLgogICAgICAgIC8vIHJlc2V0IGV2ZXJ5dGhpbmcgdG8gemVybywgbm8gcmVwbGF5IGF0dGFja3MuCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIGV0aEJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBub0t5Y0V0aEJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICB0b3RhbFN1cHBseSA9IFNhZmVNYXRoLnN1Yih0b3RhbFN1cHBseSwgRVZOVmFsKTsgLy8gRXh0cmEgc2FmZQoKICAgICAgICAvLyBMb2cgdGhpcyByZWZ1bmQKICAgICAgICBMb2dSZWZ1bmQobXNnLnNlbmRlciwgZXRoVmFsKTsKCiAgICAgICAgLy8gU2VuZCB0aGUgY29udHJpYnV0aW9ucyBvbmx5IGFmdGVyIHdlIGhhdmUgdXBkYXRlZCBhbGwgdGhlIGJhbGFuY2VzCiAgICAgICAgLy8gSWYgeW91J3JlIHVzaW5nIGEgY29udHJhY3QsIG1ha2Ugc3VyZSBpdCB3b3JrcyB3aXRoIC50cmFuc2ZlcigpIGdhcyBsaW1pdHMKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV0aFZhbCk7CiAgICB9CgogICAgLy8gQGRldiBEZWxpdmVyIHRva2VucyB0byBiZSBkaXN0cmlidXRlZCB0byB0ZWFtIG1lbWJlcnMKICAgIGZ1bmN0aW9uIGRlbGl2ZXJUZWFtVG9rZW5zKGFkZHJlc3MgX3RvKQogICAgZXh0ZXJuYWwKICAgIGlzRmluYWxpemVkCiAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKHRlYW1Ub2tlbnNEZWxpdmVyZWQgPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CgogICAgICAgIC8vIGFsbG93IGRlbGl2ZXJ5IG9mIHRva2VucyBmb3IgdGhlIGNvbXBhbnkgYW5kIHN1cHBvcnRlcnMgd2l0aG91dCB2ZXN0aW5nLCB0ZWFtIHRva2VucyB3aWxsIGJlIHN1cHBsaWVkIGxpa2UgYSBDQyBwdXJjaGFzZS4KICAgICAgICAKICAgICAgICAvLyBjb21wYW55IGFuZCBzdXBwb3J0ZXJzIGdldHMgNyUgb2YgYSB3aG9sZSBmaW5hbCBwaWUsIG1lYW5pbmcgd2UgaGF2ZSB0byBhZGQgfjcsNSUgdG8gdGhlCiAgICAgICAgLy8gY3VycmVudCB0b3RhbFN1cHBseSBub3csIGJhc2ljYWxseSBzdHJldGNoaW5nIGl0IGFuZCB0YWtpbmcgNyUgZnJvbSB0aGUgcmVzdWx0LCBzbyB0aGUgOTMlIHRoYXQgcmVtYWluIGVxdWFscyB0aGUgYW1vdW50IG9mIHRva2VucyBjcmVhdGVkIHJpZ2h0IG5vdy4KICAgICAgICAvLyBlLmcuICg5MyAqIHggPSAxMDAsIHdoZXJlIHggYW1vdW50cyB0byByb3VnaGx5IGFib3V0IDEuMDc1MjYgYW5kIDcgd291bGQgYmUgdGhlIHRlYW0ncyBwYXJ0KQogICAgICAgIHVpbnQyNTYgbmV3VG90YWxTdXBwbHkgPSBzYWZlTXVsUGVyY2VudGFnZSh0b3RhbFN1cHBseSwgMTA3NTI2KTsKCiAgICAgICAgLy8gZ2l2ZSBjb21wYW55IGFuZCBzdXBwb3J0ZXJzIHRoZWlyIDclIAogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gU2FmZU1hdGguc3ViKG5ld1RvdGFsU3VwcGx5LCB0b3RhbFN1cHBseSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHRva2VuczsKCiAgICAgICAgLy91cGRhdGUgc3RhdGUKICAgICAgICB0ZWFtVG9rZW5zRGVsaXZlcmVkID0gdHJ1ZTsKICAgICAgICB0b3RhbFN1cHBseSA9IG5ld1RvdGFsU3VwcGx5OwogICAgICAgIHRyYWNrSG9sZGVyKF90byk7CgogICAgICAgIC8vIExvZyB0aGUgY3JlYXRpb24gb2YgdGhlc2UgdG9rZW5zCiAgICAgICAgTG9nVGVhbVRva2Vuc0RlbGl2ZXJlZChfdG8sIHRva2Vucyk7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZU11bFBlcmNlbnRhZ2UodWludDI1NiB2YWx1ZSwgdWludDI1NiBwZXJjZW50YWdlKQogICAgaW50ZXJuYWwKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50MjU2IHJlc3VsdFZhbHVlKQogICAgewogICAgICAgIHJlcXVpcmUocGVyY2VudGFnZSA+PSAxMDAwMDApOwogICAgICAgIHJlcXVpcmUocGVyY2VudGFnZSA8IDIwMDAwMCk7CgogICAgICAgIC8vIE11bHRpcGx5IHdpdGggcGVyY2VudGFnZQogICAgICAgIHVpbnQyNTYgbmV3VmFsdWUgPSBTYWZlTWF0aC5tdWwodmFsdWUsIHBlcmNlbnRhZ2UpOwogICAgICAgIC8vIFJlbW92ZSB0aGUgNSBleHRyYSBkZWNpbWFscwogICAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUgLyAxMCoqNTsKICAgICAgICByZXR1cm4gbmV3VmFsdWU7CiAgICB9CgogICAgLy8gY3VzdG9taXppbmcgdGhlIGdhcyBwcmljZSBmb3Igb3JhY2xpemUgY2FsbHMgZHVyaW5nICJJQ08gUnVzaCBob3VycyIKICAgIGZ1bmN0aW9uIHNldE9yYWNsaXplR2FzKHVpbnQyNTYgX29wdGlvbikKICAgIGV4dGVybmFsCiAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBpZiAoX29wdGlvbiA8PSAzMCkgewogICAgICAgICAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSgzMDAwMDAwMDAwMCB3ZWkpOwogICAgICAgIH0gZWxzZSBpZiAoX29wdGlvbiA8PSA1MCkgewogICAgICAgICAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSg1MDAwMDAwMDAwMCB3ZWkpOwogICAgICAgIH0gZWxzZSBpZiAoX29wdGlvbiA8PSA3MCkgewogICAgICAgICAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSg3MDAwMDAwMDAwMCB3ZWkpOwogICAgICAgIH0gZWxzZSBpZiAoX29wdGlvbiA8PSAxMDApIHsKICAgICAgICAgICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoMTAwMDAwMDAwMDAwIHdlaSk7CiAgICAgICAgfQogICAgfQp9'.
	

]
