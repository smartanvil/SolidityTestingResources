Class {
	#name : #SRTdbcd2Ae616E5886c36463eCB45a639C0Fa7583a4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdbcd2Ae616E5886c36463eCB45a639C0Fa7583a4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgQ29udmVyc2lvblJhdGVzSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiByZWNvcmRJbWJhbGFuY2UoCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50IGJ1eUFtb3VudCwKICAgICAgICB1aW50IHJhdGVVcGRhdGVCbG9jaywKICAgICAgICB1aW50IGN1cnJlbnRCbG9jawogICAgKQogICAgICAgIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBnZXRSYXRlKEVSQzIwIHRva2VuLCB1aW50IGN1cnJlbnRCbG9ja051bWJlciwgYm9vbCBidXksIHVpbnQgcXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwp9CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9Cgpjb250cmFjdCBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdBZG1pbjsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgaW50ZXJuYWwgb3BlcmF0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBhbGVydGVyczsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBvcGVyYXRvcnNHcm91cDsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBhbGVydGVyc0dyb3VwOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBNQVhfR1JPVVBfU0laRSA9IDUwOwoKICAgIGZ1bmN0aW9uIFBlcm1pc3Npb25Hcm91cHMoKSBwdWJsaWMgewogICAgICAgIGFkbWluID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcGVyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWxlcnRlcigpIHsKICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZXJhdG9ycyAoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yc0dyb3VwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsZXJ0ZXJzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYWxlcnRlcnNHcm91cDsKICAgIH0KCiAgICBldmVudCBUcmFuc2ZlckFkbWluUGVuZGluZyhhZGRyZXNzIHBlbmRpbmdBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pbihhZGRyZXNzIG5ld0FkbWluKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG5ld0FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIFRyYW5zZmVyQWRtaW5QZW5kaW5nKHBlbmRpbmdBZG1pbik7CiAgICAgICAgcGVuZGluZ0FkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIGFkbWluIGluIG9uZSB0eC4gVXNlZnVsIGluaXRpYWwgZGVwbG95bWVudC4KICAgICAqIEBwYXJhbSBuZXdBZG1pbiBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyQWRtaW5RdWlja2x5KGFkZHJlc3MgbmV3QWRtaW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUobmV3QWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgVHJhbnNmZXJBZG1pblBlbmRpbmcobmV3QWRtaW4pOwogICAgICAgIEFkbWluQ2xhaW1lZChuZXdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgZXZlbnQgQWRtaW5DbGFpbWVkKCBhZGRyZXNzIG5ld0FkbWluLCBhZGRyZXNzIHByZXZpb3VzQWRtaW4pOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSBjaGFuZ2UgYWRtaW4gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BZG1pbigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShwZW5kaW5nQWRtaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgQWRtaW5DbGFpbWVkKHBlbmRpbmdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gcGVuZGluZ0FkbWluOwogICAgICAgIHBlbmRpbmdBZG1pbiA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZXZlbnQgQWxlcnRlckFkZGVkIChhZGRyZXNzIG5ld0FsZXJ0ZXIsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZEFsZXJ0ZXIoYWRkcmVzcyBuZXdBbGVydGVyKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFhbGVydGVyc1tuZXdBbGVydGVyXSk7IC8vIHByZXZlbnQgZHVwbGljYXRlcy4KICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzR3JvdXAubGVuZ3RoIDwgTUFYX0dST1VQX1NJWkUpOwoKICAgICAgICBBbGVydGVyQWRkZWQobmV3QWxlcnRlciwgdHJ1ZSk7CiAgICAgICAgYWxlcnRlcnNbbmV3QWxlcnRlcl0gPSB0cnVlOwogICAgICAgIGFsZXJ0ZXJzR3JvdXAucHVzaChuZXdBbGVydGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBbGVydGVyIChhZGRyZXNzIGFsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbYWxlcnRlcl0pOwogICAgICAgIGFsZXJ0ZXJzW2FsZXJ0ZXJdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsZXJ0ZXJzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKGFsZXJ0ZXJzR3JvdXBbaV0gPT0gYWxlcnRlcikgewogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cFtpXSA9IGFsZXJ0ZXJzR3JvdXBbYWxlcnRlcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGFsZXJ0ZXJzR3JvdXAubGVuZ3RoLS07CiAgICAgICAgICAgICAgICBBbGVydGVyQWRkZWQoYWxlcnRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgT3BlcmF0b3JBZGRlZChhZGRyZXNzIG5ld09wZXJhdG9yLCBib29sIGlzQWRkKTsKCiAgICBmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFvcGVyYXRvcnNbbmV3T3BlcmF0b3JdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIHJlcXVpcmUob3BlcmF0b3JzR3JvdXAubGVuZ3RoIDwgTUFYX0dST1VQX1NJWkUpOwoKICAgICAgICBPcGVyYXRvckFkZGVkKG5ld09wZXJhdG9yLCB0cnVlKTsKICAgICAgICBvcGVyYXRvcnNbbmV3T3BlcmF0b3JdID0gdHJ1ZTsKICAgICAgICBvcGVyYXRvcnNHcm91cC5wdXNoKG5ld09wZXJhdG9yKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVPcGVyYXRvciAoYWRkcmVzcyBvcGVyYXRvcikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShvcGVyYXRvcnNbb3BlcmF0b3JdKTsKICAgICAgICBvcGVyYXRvcnNbb3BlcmF0b3JdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG9wZXJhdG9yc0dyb3VwLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChvcGVyYXRvcnNHcm91cFtpXSA9PSBvcGVyYXRvcikgewogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXBbaV0gPSBvcGVyYXRvcnNHcm91cFtvcGVyYXRvcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIG9wZXJhdG9yc0dyb3VwLmxlbmd0aCAtPSAxOwogICAgICAgICAgICAgICAgT3BlcmF0b3JBZGRlZChvcGVyYXRvciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFdpdGhkcmF3YWJsZSBpcyBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBldmVudCBUb2tlbldpdGhkcmF3KEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pOwoKICAgIC8qKgogICAgICogQGRldiBXaXRoZHJhdyBhbGwgRVJDMjAgY29tcGF0aWJsZSB0b2tlbnMKICAgICAqIEBwYXJhbSB0b2tlbiBFUkMyMCBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbihFUkMyMCB0b2tlbiwgdWludCBhbW91bnQsIGFkZHJlc3Mgc2VuZFRvKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoc2VuZFRvLCBhbW91bnQpKTsKICAgICAgICBUb2tlbldpdGhkcmF3KHRva2VuLCBhbW91bnQsIHNlbmRUbyk7CiAgICB9CgogICAgZXZlbnQgRXRoZXJXaXRoZHJhdyh1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pOwoKICAgIC8qKgogICAgICogQGRldiBXaXRoZHJhdyBFdGhlcnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcih1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgc2VuZFRvLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgRXRoZXJXaXRoZHJhdyhhbW91bnQsIHNlbmRUbyk7CiAgICB9Cn0KCmNvbnRyYWN0IFZvbHVtZUltYmFsYW5jZVJlY29yZGVyIGlzIFdpdGhkcmF3YWJsZSB7CgogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBTTElESU5HX1dJTkRPV19TSVpFID0gNTsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgUE9XXzJfNjQgPSAyICoqIDY0OwoKICAgIHN0cnVjdCBUb2tlbkNvbnRyb2xJbmZvIHsKICAgICAgICB1aW50IG1pbmltYWxSZWNvcmRSZXNvbHV0aW9uOyAvLyBjYW4gYmUgcm91Z2hseSAxIGNlbnQKICAgICAgICB1aW50IG1heFBlckJsb2NrSW1iYWxhbmNlOyAvLyBpbiB0d2VpIHJlc29sdXRpb24KICAgICAgICB1aW50IG1heFRvdGFsSW1iYWxhbmNlOyAvLyBtYXggdG90YWwgaW1iYWxhbmNlIChiZXR3ZWVuIHJhdGUgdXBkYXRlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBoYWx0aW5nIHRyYWRlCiAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IFRva2VuQ29udHJvbEluZm8pIGludGVybmFsIHRva2VuQ29udHJvbEluZm87CgogICAgc3RydWN0IFRva2VuSW1iYWxhbmNlRGF0YSB7CiAgICAgICAgaW50ICBsYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICB1aW50IGxhc3RCbG9jazsKCiAgICAgICAgaW50ICB0b3RhbEJ1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgIHVpbnQgbGFzdFJhdGVVcGRhdGVCbG9jazsKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyh1aW50PT51aW50KSkgcHVibGljIHRva2VuSW1iYWxhbmNlRGF0YTsKCiAgICBmdW5jdGlvbiBWb2x1bWVJbWJhbGFuY2VSZWNvcmRlcihhZGRyZXNzIF9hZG1pbikgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9hZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBhZG1pbiA9IF9hZG1pbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUb2tlbkNvbnRyb2xJbmZvKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIHVpbnQgbWluaW1hbFJlY29yZFJlc29sdXRpb24sCiAgICAgICAgdWludCBtYXhQZXJCbG9ja0ltYmFsYW5jZSwKICAgICAgICB1aW50IG1heFRvdGFsSW1iYWxhbmNlCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUFkbWluCiAgICB7CiAgICAgICAgdG9rZW5Db250cm9sSW5mb1t0b2tlbl0gPQogICAgICAgICAgICBUb2tlbkNvbnRyb2xJbmZvKAogICAgICAgICAgICAgICAgbWluaW1hbFJlY29yZFJlc29sdXRpb24sCiAgICAgICAgICAgICAgICBtYXhQZXJCbG9ja0ltYmFsYW5jZSwKICAgICAgICAgICAgICAgIG1heFRvdGFsSW1iYWxhbmNlCiAgICAgICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9rZW5Db250cm9sSW5mbyhFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50LCB1aW50LCB1aW50KSB7CiAgICAgICAgcmV0dXJuICh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgIHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1heFBlckJsb2NrSW1iYWxhbmNlLAogICAgICAgICAgICAgICAgdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4VG90YWxJbWJhbGFuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEltYmFsYW5jZSgKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnQgYnV5QW1vdW50LAogICAgICAgIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLAogICAgICAgIHVpbnQgY3VycmVudEJsb2NrCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICB1aW50IGN1cnJlbnRCbG9ja0luZGV4ID0gY3VycmVudEJsb2NrICUgU0xJRElOR19XSU5ET1dfU0laRTsKICAgICAgICBpbnQgcmVjb3JkZWRCdXlBbW91bnQgPSBpbnQoYnV5QW1vdW50IC8gaW50KHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uKSk7CgogICAgICAgIGludCBwcmV2SW1iYWxhbmNlID0gMDsKCiAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBjdXJyZW50QmxvY2tEYXRhID0KICAgICAgICAgICAgZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bY3VycmVudEJsb2NrSW5kZXhdKTsKCiAgICAgICAgLy8gZmlyc3Qgc2NlbmFyaW8gLSB0aGlzIGlzIG5vdCB0aGUgZmlyc3QgdHggaW4gdGhlIGN1cnJlbnQgYmxvY2sKICAgICAgICBpZiAoY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2sgPT0gY3VycmVudEJsb2NrKSB7CiAgICAgICAgICAgIGlmICh1aW50KGN1cnJlbnRCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jaykgPT0gcmF0ZVVwZGF0ZUJsb2NrKSB7CiAgICAgICAgICAgICAgICAvLyBqdXN0IGluY3JlYXNlIGltYmFsYW5jZQogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSArPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSArPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGltYmFsYW5jZSB3YXMgY2hhbmdlZCBpbiB0aGUgbWlkZGxlIG9mIHRoZSBibG9jawogICAgICAgICAgICAgICAgcHJldkltYmFsYW5jZSA9IGdldEltYmFsYW5jZUluUmFuZ2UodG9rZW4sIHJhdGVVcGRhdGVCbG9jaywgY3VycmVudEJsb2NrKTsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA9IGludChwcmV2SW1iYWxhbmNlKSArIHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSArPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA9IHVpbnQocmF0ZVVwZGF0ZUJsb2NrKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGZpcnN0IHR4IGluIHRoZSBjdXJyZW50IGJsb2NrCiAgICAgICAgICAgIGludCBjdXJyZW50QmxvY2tJbWJhbGFuY2U7CiAgICAgICAgICAgIChwcmV2SW1iYWxhbmNlLCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpID0gZ2V0SW1iYWxhbmNlU2luY2VSYXRlVXBkYXRlKHRva2VuLCByYXRlVXBkYXRlQmxvY2ssIGN1cnJlbnRCbG9jayk7CgogICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlID0gcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrID0gdWludChjdXJyZW50QmxvY2spOwogICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgPSB1aW50KHJhdGVVcGRhdGVCbG9jayk7CiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA9IGludChwcmV2SW1iYWxhbmNlKSArIHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgIH0KCiAgICAgICAgdG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVtjdXJyZW50QmxvY2tJbmRleF0gPSBlbmNvZGVUb2tlbkltYmFsYW5jZURhdGEoY3VycmVudEJsb2NrRGF0YSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0R2FyYmFnZVRvVm9sdW1lUmVjb3JkZXIoRVJDMjAgdG9rZW4pIGludGVybmFsIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBTTElESU5HX1dJTkRPV19TSVpFOyBpKyspIHsKICAgICAgICAgICAgdG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVtpXSA9IDB4MTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW1iYWxhbmNlSW5SYW5nZShFUkMyMCB0b2tlbiwgdWludCBzdGFydEJsb2NrLCB1aW50IGVuZEJsb2NrKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoaW50IGJ1eUltYmFsYW5jZSkgewogICAgICAgIC8vIGNoZWNrIHRoZSBpbWJhbGFuY2UgaW4gdGhlIHNsaWRpbmcgd2luZG93CiAgICAgICAgcmVxdWlyZShzdGFydEJsb2NrIDw9IGVuZEJsb2NrKTsKCiAgICAgICAgYnV5SW1iYWxhbmNlID0gMDsKCiAgICAgICAgZm9yICh1aW50IHdpbmRvd0luZCA9IDA7IHdpbmRvd0luZCA8IFNMSURJTkdfV0lORE9XX1NJWkU7IHdpbmRvd0luZCsrKSB7CiAgICAgICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgcGVyQmxvY2tEYXRhID0gZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bd2luZG93SW5kXSk7CgogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RCbG9jayA8PSBlbmRCbG9jayAmJiBwZXJCbG9ja0RhdGEubGFzdEJsb2NrID49IHN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgICAgIGJ1eUltYmFsYW5jZSArPSBpbnQocGVyQmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbWJhbGFuY2VTaW5jZVJhdGVVcGRhdGUoRVJDMjAgdG9rZW4sIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLCB1aW50IGN1cnJlbnRCbG9jaykKICAgICAgICBpbnRlcm5hbCB2aWV3CiAgICAgICAgcmV0dXJucyhpbnQgYnV5SW1iYWxhbmNlLCBpbnQgY3VycmVudEJsb2NrSW1iYWxhbmNlKQogICAgewogICAgICAgIGJ1eUltYmFsYW5jZSA9IDA7CiAgICAgICAgY3VycmVudEJsb2NrSW1iYWxhbmNlID0gMDsKICAgICAgICB1aW50IGxhdGVzdEJsb2NrID0gMDsKICAgICAgICBpbnQgaW1iYWxhbmNlSW5SYW5nZSA9IDA7CiAgICAgICAgdWludCBzdGFydEJsb2NrID0gcmF0ZVVwZGF0ZUJsb2NrOwogICAgICAgIHVpbnQgZW5kQmxvY2sgPSBjdXJyZW50QmxvY2s7CgogICAgICAgIGZvciAodWludCB3aW5kb3dJbmQgPSAwOyB3aW5kb3dJbmQgPCBTTElESU5HX1dJTkRPV19TSVpFOyB3aW5kb3dJbmQrKykgewogICAgICAgICAgICBUb2tlbkltYmFsYW5jZURhdGEgbWVtb3J5IHBlckJsb2NrRGF0YSA9IGRlY29kZVRva2VuSW1iYWxhbmNlRGF0YSh0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW3dpbmRvd0luZF0pOwoKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPD0gZW5kQmxvY2sgJiYgcGVyQmxvY2tEYXRhLmxhc3RCbG9jayA+PSBzdGFydEJsb2NrKSB7CiAgICAgICAgICAgICAgICBpbWJhbGFuY2VJblJhbmdlICs9IHBlckJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrICE9IHJhdGVVcGRhdGVCbG9jaykgY29udGludWU7CiAgICAgICAgICAgIGlmIChwZXJCbG9ja0RhdGEubGFzdEJsb2NrIDwgbGF0ZXN0QmxvY2spIGNvbnRpbnVlOwoKICAgICAgICAgICAgbGF0ZXN0QmxvY2sgPSBwZXJCbG9ja0RhdGEubGFzdEJsb2NrOwogICAgICAgICAgICBidXlJbWJhbGFuY2UgPSBwZXJCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICAgICAgaWYgKHVpbnQocGVyQmxvY2tEYXRhLmxhc3RCbG9jaykgPT0gY3VycmVudEJsb2NrKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tJbWJhbGFuY2UgPSBwZXJCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChidXlJbWJhbGFuY2UgPT0gMCkgewogICAgICAgICAgICBidXlJbWJhbGFuY2UgPSBpbWJhbGFuY2VJblJhbmdlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbWJhbGFuY2UoRVJDMjAgdG9rZW4sIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLCB1aW50IGN1cnJlbnRCbG9jaykKICAgICAgICBpbnRlcm5hbCB2aWV3CiAgICAgICAgcmV0dXJucyhpbnQgdG90YWxJbWJhbGFuY2UsIGludCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpCiAgICB7CgogICAgICAgIGludCByZXNvbHV0aW9uID0gaW50KHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uKTsKCiAgICAgICAgKHRvdGFsSW1iYWxhbmNlLCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpID0KICAgICAgICAgICAgZ2V0SW1iYWxhbmNlU2luY2VSYXRlVXBkYXRlKAogICAgICAgICAgICAgICAgdG9rZW4sCiAgICAgICAgICAgICAgICByYXRlVXBkYXRlQmxvY2ssCiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2spOwoKICAgICAgICB0b3RhbEltYmFsYW5jZSAqPSByZXNvbHV0aW9uOwogICAgICAgIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSAqPSByZXNvbHV0aW9uOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1heFBlckJsb2NrSW1iYWxhbmNlKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhQZXJCbG9ja0ltYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNYXhUb3RhbEltYmFsYW5jZShFUkMyMCB0b2tlbikgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4VG90YWxJbWJhbGFuY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZW5jb2RlVG9rZW5JbWJhbGFuY2VEYXRhKFRva2VuSW1iYWxhbmNlRGF0YSBkYXRhKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIC8vIGNoZWNrIGZvciBvdmVyZmxvd3MKICAgICAgICByZXF1aXJlKGRhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPCBpbnQoUE9XXzJfNjQgLyAyKSk7CiAgICAgICAgcmVxdWlyZShkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlID4gaW50KC0xICogaW50KFBPV18yXzY0KSAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEubGFzdEJsb2NrIDwgUE9XXzJfNjQpOwogICAgICAgIHJlcXVpcmUoZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlIDwgaW50KFBPV18yXzY0IC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID4gaW50KC0xICogaW50KFBPV18yXzY0KSAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA8IFBPV18yXzY0KTsKCiAgICAgICAgLy8gZG8gZW5jb2RpbmcKICAgICAgICB1aW50IHJlc3VsdCA9IHVpbnQoZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSkgJiAoUE9XXzJfNjQgLSAxKTsKICAgICAgICByZXN1bHQgfD0gZGF0YS5sYXN0QmxvY2sgKiBQT1dfMl82NDsKICAgICAgICByZXN1bHQgfD0gKHVpbnQoZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlKSAmIChQT1dfMl82NCAtIDEpKSAqIFBPV18yXzY0ICogUE9XXzJfNjQ7CiAgICAgICAgcmVzdWx0IHw9IGRhdGEubGFzdFJhdGVVcGRhdGVCbG9jayAqIFBPV18yXzY0ICogUE9XXzJfNjQgKiBQT1dfMl82NDsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodWludCBpbnB1dCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKFRva2VuSW1iYWxhbmNlRGF0YSkgewogICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgZGF0YTsKCiAgICAgICAgZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSA9IGludChpbnQ2NChpbnB1dCAmIChQT1dfMl82NCAtIDEpKSk7CiAgICAgICAgZGF0YS5sYXN0QmxvY2sgPSB1aW50KHVpbnQ2NCgoaW5wdXQgLyBQT1dfMl82NCkgJiAoUE9XXzJfNjQgLSAxKSkpOwogICAgICAgIGRhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA9IGludChpbnQ2NCgoaW5wdXQgLyAoUE9XXzJfNjQgKiBQT1dfMl82NCkpICYgKFBPV18yXzY0IC0gMSkpKTsKICAgICAgICBkYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgPSB1aW50KHVpbnQ2NCgoaW5wdXQgLyAoUE9XXzJfNjQgKiBQT1dfMl82NCAqIFBPV18yXzY0KSkpKTsKCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9Cn0KCmNvbnRyYWN0IFV0aWxzIHsKCiAgICBFUkMyMCBjb25zdGFudCBpbnRlcm5hbCBFVEhfVE9LRU5fQUREUkVTUyA9IEVSQzIwKDB4MDBlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlKTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIFBSRUNJU0lPTiA9ICgxMCoqMTgpOwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX1FUWSAgID0gKDEwKioyOCk7IC8vIDEwQiB0b2tlbnMKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9SQVRFICA9IChQUkVDSVNJT04gKiAxMCoqNik7IC8vIHVwIHRvIDFNIHRva2VucyBwZXIgRVRICiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfREVDSU1BTFMgPSAxODsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIEVUSF9ERUNJTUFMUyA9IDE4OwogICAgbWFwcGluZyhhZGRyZXNzPT51aW50KSBpbnRlcm5hbCBkZWNpbWFsczsKCiAgICBmdW5jdGlvbiBzZXREZWNpbWFscyhFUkMyMCB0b2tlbikgaW50ZXJuYWwgewogICAgICAgIGlmICh0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykgZGVjaW1hbHNbdG9rZW5dID0gRVRIX0RFQ0lNQUxTOwogICAgICAgIGVsc2UgZGVjaW1hbHNbdG9rZW5dID0gdG9rZW4uZGVjaW1hbHMoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXREZWNpbWFscyhFUkMyMCB0b2tlbikgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpIHJldHVybiBFVEhfREVDSU1BTFM7IC8vIHNhdmUgc3RvcmFnZSBhY2Nlc3MKICAgICAgICB1aW50IHRva2VuRGVjaW1hbHMgPSBkZWNpbWFsc1t0b2tlbl07CiAgICAgICAgLy8gdGVjaG5pY2FsbHksIHRoZXJlIG1pZ2h0IGJlIHRva2VuIHdpdGggZGVjaW1hbHMgMAogICAgICAgIC8vIG1vcmVvdmVyLCB2ZXJ5IHBvc3NpYmxlIHRoYXQgb2xkIHRva2VucyBoYXZlIGRlY2ltYWxzIDAKICAgICAgICAvLyB0aGVzZSB0b2tlbnMgd2lsbCBqdXN0IGhhdmUgaGlnaGVyIGdhcyBmZWVzLgogICAgICAgIGlmKHRva2VuRGVjaW1hbHMgPT0gMCkgcmV0dXJuIHRva2VuLmRlY2ltYWxzKCk7CgogICAgICAgIHJldHVybiB0b2tlbkRlY2ltYWxzOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNEc3RRdHkodWludCBzcmNRdHksIHVpbnQgc3JjRGVjaW1hbHMsIHVpbnQgZHN0RGVjaW1hbHMsIHVpbnQgcmF0ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXF1aXJlKHNyY1F0eSA8PSBNQVhfUVRZKTsKICAgICAgICByZXF1aXJlKHJhdGUgPD0gTUFYX1JBVEUpOwoKICAgICAgICBpZiAoZHN0RGVjaW1hbHMgPj0gc3JjRGVjaW1hbHMpIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlICogKDEwKiooZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykpKSAvIFBSRUNJU0lPTjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKChzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICByZXR1cm4gKHNyY1F0eSAqIHJhdGUpIC8gKFBSRUNJU0lPTiAqICgxMCoqKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpKSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNTcmNRdHkodWludCBkc3RRdHksIHVpbnQgc3JjRGVjaW1hbHMsIHVpbnQgZHN0RGVjaW1hbHMsIHVpbnQgcmF0ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXF1aXJlKGRzdFF0eSA8PSBNQVhfUVRZKTsKICAgICAgICByZXF1aXJlKHJhdGUgPD0gTUFYX1JBVEUpOwoKICAgICAgICAvL3NvdXJjZSBxdWFudGl0eSBpcyByb3VuZGVkIHVwLiB0byBhdm9pZCBkZXN0IHF1YW50aXR5IGJlaW5nIHRvbyBsb3cuCiAgICAgICAgdWludCBudW1lcmF0b3I7CiAgICAgICAgdWludCBkZW5vbWluYXRvcjsKICAgICAgICBpZiAoc3JjRGVjaW1hbHMgPj0gZHN0RGVjaW1hbHMpIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSAqICgxMCoqKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpKSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gcmF0ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKChkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICBudW1lcmF0b3IgPSAoUFJFQ0lTSU9OICogZHN0UXR5KTsKICAgICAgICAgICAgZGVub21pbmF0b3IgPSAocmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAobnVtZXJhdG9yICsgZGVub21pbmF0b3IgLSAxKSAvIGRlbm9taW5hdG9yOyAvL2F2b2lkIHJvdW5kaW5nIGRvd24gZXJyb3JzCiAgICB9Cn0KCmNvbnRyYWN0IENvbnZlcnNpb25SYXRlcyBpcyBDb252ZXJzaW9uUmF0ZXNJbnRlcmZhY2UsIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyLCBVdGlscyB7CgogICAgLy8gYnBzIC0gYmFzaWMgcmF0ZSBzdGVwcy4gb25lIHN0ZXAgaXMgMSAvIDEwMDAwIG9mIHRoZSByYXRlLgogICAgc3RydWN0IFN0ZXBGdW5jdGlvbiB7CiAgICAgICAgaW50W10geDsgLy8gcXVhbnRpdHkgZm9yIGVhY2ggc3RlcC4gUXVhbnRpdHkgb2YgZWFjaCBzdGVwIGluY2x1ZGVzIHByZXZpb3VzIHN0ZXBzLgogICAgICAgIGludFtdIHk7IC8vIHJhdGUgY2hhbmdlIHBlciBxdWFudGl0eSBzdGVwICBpbiBicHMuCiAgICB9CgogICAgc3RydWN0IFRva2VuRGF0YSB7CiAgICAgICAgYm9vbCBsaXN0ZWQ7ICAvLyB3YXMgYWRkZWQgdG8gcmVzZXJ2ZQogICAgICAgIGJvb2wgZW5hYmxlZDsgLy8gd2hldGhlciB0cmFkZSBpcyBlbmFibGVkCgogICAgICAgIC8vIHBvc2l0aW9uIGluIHRoZSBjb21wYWN0IGRhdGEKICAgICAgICB1aW50IGNvbXBhY3REYXRhQXJyYXlJbmRleDsKICAgICAgICB1aW50IGNvbXBhY3REYXRhRmllbGRJbmRleDsKCiAgICAgICAgLy8gcmF0ZSBkYXRhLiBiYXNlIGFuZCBjaGFuZ2VzIGFjY29yZGluZyB0byBxdWFudGl0eSBhbmQgcmVzZXJ2ZSBiYWxhbmNlLgogICAgICAgIC8vIGdlbmVyYWxseSBzcGVha2luZy4gU2VsbCByYXRlIGlzIDEgLyBidXkgcmF0ZSBpLmUuIHRoZSBidXkgaW4gdGhlIG90aGVyIGRpcmVjdGlvbi4KICAgICAgICB1aW50IGJhc2VCdXlSYXRlOyAgLy8gaW4gUFJFQ0lTSU9OIHVuaXRzLiBzZWUgS3liZXJDb25zdGFudHMKICAgICAgICB1aW50IGJhc2VTZWxsUmF0ZTsgLy8gUFJFQ0lTSU9OIHVuaXRzLiB3aXRob3V0IChzZWxsIC8gYnV5KSBzcHJlYWQgaXQgaXMgMSAvIGJhc2VCdXlSYXRlCiAgICAgICAgU3RlcEZ1bmN0aW9uIGJ1eVJhdGVRdHlTdGVwRnVuY3Rpb247IC8vIGluIGJwcy4gaGlnaGVyIHF1YW50aXR5IC0gYmlnZ2VyIHRoZSByYXRlLgogICAgICAgIFN0ZXBGdW5jdGlvbiBzZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbjsvLyBpbiBicHMuIGhpZ2hlciB0aGUgcXVhCiAgICAgICAgU3RlcEZ1bmN0aW9uIGJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb247IC8vIGluIEJQUy4gaGlnaGVyIHJlc2VydmUgaW1iYWxhbmNlIC0gYmlnZ2VyIHRoZSByYXRlLgogICAgICAgIFN0ZXBGdW5jdGlvbiBzZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbjsKICAgIH0KCiAgICAvKgogICAgdGhpcyBpcyB0aGUgZGF0YSBmb3IgdG9rZW5SYXRlc0NvbXBhY3REYXRhCiAgICBidXQgc29saWRpdHkgY29tcGlsZXIgb3B0aW1pemVyIGlzIHN1Yi1vcHRpbWFsLCBhbmQgY2Fubm90IHdyaXRlIHRoaXMgc3RydWN0dXJlIGluIGEgc2luZ2xlIHN0b3JhZ2Ugd3JpdGUKICAgIHNvIHdlIHJlcHJlc2VudCBpdCBhcyBieXRlczMyIGFuZCBkbyB0aGUgYnl0ZSB0cmlja3Mgb3Vyc2VsdmVzLgogICAgc3RydWN0IFRva2VuUmF0ZXNDb21wYWN0RGF0YSB7CiAgICAgICAgYnl0ZXMxNCBidXk7ICAvLyBjaGFuZ2UgYnV5IHJhdGUgb2YgdG9rZW4gZnJvbSBiYXNlQnV5UmF0ZSBpbiAxMCBicHMKICAgICAgICBieXRlczE0IHNlbGw7IC8vIGNoYW5nZSBzZWxsIHJhdGUgb2YgdG9rZW4gZnJvbSBiYXNlU2VsbFJhdGUgaW4gMTAgYnBzCgogICAgICAgIHVpbnQzMiBibG9ja051bWJlcjsKICAgIH0gKi8KICAgIHVpbnQgcHVibGljIHZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3MgPSAxMDsgLy8gcmF0ZXMgYXJlIHZhbGlkIGZvciB0aGlzIGFtb3VudCBvZiBibG9ja3MKICAgIEVSQzIwW10gaW50ZXJuYWwgbGlzdGVkVG9rZW5zOwogICAgbWFwcGluZyhhZGRyZXNzPT5Ub2tlbkRhdGEpIGludGVybmFsIHRva2VuRGF0YTsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCB0b2tlblJhdGVzQ29tcGFjdERhdGE7CiAgICB1aW50IHB1YmxpYyBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9IDA7CiAgICBhZGRyZXNzIHB1YmxpYyByZXNlcnZlQ29udHJhY3Q7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBID0gMTQ7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEJZVEVTXzE0X09GRlNFVCA9ICgyICoqICg4ICogTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEEpKTsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTUFYX1NURVBTX0lOX0ZVTkNUSU9OID0gMTA7CiAgICBpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9CUFNfQURKVVNUTUVOVCA9IDEwICoqIDExOyAvLyAxQiAlCiAgICBpbnQgIGNvbnN0YW50IGludGVybmFsIE1JTl9CUFNfQURKVVNUTUVOVCA9IC0xMDAgKiAxMDA7IC8vIGNhbm5vdCBnbyBkb3duIGJ5IG1vcmUgdGhhbiAxMDAlCgogICAgZnVuY3Rpb24gQ29udmVyc2lvblJhdGVzKGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgVm9sdW1lSW1iYWxhbmNlUmVjb3JkZXIoX2FkbWluKQogICAgICAgIHsgfSAvLyBzb2xoaW50LWRpc2FibGUtbGluZSBuby1lbXB0eS1ibG9ja3MKCiAgICBmdW5jdGlvbiBhZGRUb2tlbihFUkMyMCB0b2tlbikgcHVibGljIG9ubHlBZG1pbiB7CgogICAgICAgIHJlcXVpcmUoIXRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCA9IHRydWU7CiAgICAgICAgbGlzdGVkVG9rZW5zLnB1c2godG9rZW4pOwoKICAgICAgICBpZiAobnVtVG9rZW5zSW5DdXJyZW50Q29tcGFjdERhdGEgPT0gMCkgewogICAgICAgICAgICB0b2tlblJhdGVzQ29tcGFjdERhdGEubGVuZ3RoKys7IC8vIGFkZCBuZXcgc3RydWN0dXJlCiAgICAgICAgfQoKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleCA9IHRva2VuUmF0ZXNDb21wYWN0RGF0YS5sZW5ndGggLSAxOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFGaWVsZEluZGV4ID0gbnVtVG9rZW5zSW5DdXJyZW50Q29tcGFjdERhdGE7CgogICAgICAgIG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhID0gKG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhICsgMSkgJSBOVU1fVE9LRU5TX0lOX0NPTVBBQ1RfREFUQTsKCiAgICAgICAgc2V0R2FyYmFnZVRvVm9sdW1lUmVjb3JkZXIodG9rZW4pOwoKICAgICAgICBzZXREZWNpbWFscyh0b2tlbik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29tcGFjdERhdGEoYnl0ZXMxNFtdIGJ1eSwgYnl0ZXMxNFtdIHNlbGwsIHVpbnQgYmxvY2tOdW1iZXIsIHVpbnRbXSBpbmRpY2VzKSBwdWJsaWMgb25seU9wZXJhdG9yIHsKCiAgICAgICAgcmVxdWlyZShidXkubGVuZ3RoID09IHNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGluZGljZXMubGVuZ3RoID09IGJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoYmxvY2tOdW1iZXIgPD0gMHhGRkZGRkZGRik7CgogICAgICAgIHVpbnQgYnl0ZXMxNE9mZnNldCA9IEJZVEVTXzE0X09GRlNFVDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKGluZGljZXNbaV0gPCB0b2tlblJhdGVzQ29tcGFjdERhdGEubGVuZ3RoKTsKICAgICAgICAgICAgdWludCBkYXRhID0gdWludChidXlbaV0pIHwgdWludChzZWxsW2ldKSAqIGJ5dGVzMTRPZmZzZXQgfCAoYmxvY2tOdW1iZXIgKiAoYnl0ZXMxNE9mZnNldCAqIGJ5dGVzMTRPZmZzZXQpKTsKICAgICAgICAgICAgdG9rZW5SYXRlc0NvbXBhY3REYXRhW2luZGljZXNbaV1dID0gYnl0ZXMzMihkYXRhKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QmFzZVJhdGUoCiAgICAgICAgRVJDMjBbXSB0b2tlbnMsCiAgICAgICAgdWludFtdIGJhc2VCdXksCiAgICAgICAgdWludFtdIGJhc2VTZWxsLAogICAgICAgIGJ5dGVzMTRbXSBidXksCiAgICAgICAgYnl0ZXMxNFtdIHNlbGwsCiAgICAgICAgdWludCBibG9ja051bWJlciwKICAgICAgICB1aW50W10gaW5kaWNlcwogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPcGVyYXRvcgogICAgewogICAgICAgIHJlcXVpcmUodG9rZW5zLmxlbmd0aCA9PSBiYXNlQnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMubGVuZ3RoID09IGJhc2VTZWxsLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShzZWxsLmxlbmd0aCA9PSBidXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHNlbGwubGVuZ3RoID09IGluZGljZXMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50IGluZCA9IDA7IGluZCA8IHRva2Vucy5sZW5ndGg7IGluZCsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2Vuc1tpbmRdXS5saXN0ZWQpOwogICAgICAgICAgICB0b2tlbkRhdGFbdG9rZW5zW2luZF1dLmJhc2VCdXlSYXRlID0gYmFzZUJ1eVtpbmRdOwogICAgICAgICAgICB0b2tlbkRhdGFbdG9rZW5zW2luZF1dLmJhc2VTZWxsUmF0ZSA9IGJhc2VTZWxsW2luZF07CiAgICAgICAgfQoKICAgICAgICBzZXRDb21wYWN0RGF0YShidXksIHNlbGwsIGJsb2NrTnVtYmVyLCBpbmRpY2VzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRRdHlTdGVwRnVuY3Rpb24oCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50W10geEJ1eSwKICAgICAgICBpbnRbXSB5QnV5LAogICAgICAgIGludFtdIHhTZWxsLAogICAgICAgIGludFtdIHlTZWxsCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU9wZXJhdG9yCiAgICB7CiAgICAgICAgcmVxdWlyZSh4QnV5Lmxlbmd0aCA9PSB5QnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh4U2VsbC5sZW5ndGggPT0geVNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHhCdXkubGVuZ3RoIDw9IE1BWF9TVEVQU19JTl9GVU5DVElPTik7CiAgICAgICAgcmVxdWlyZSh4U2VsbC5sZW5ndGggPD0gTUFYX1NURVBTX0lOX0ZVTkNUSU9OKTsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKCiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uID0gU3RlcEZ1bmN0aW9uKHhCdXksIHlCdXkpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeFNlbGwsIHlTZWxsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRJbWJhbGFuY2VTdGVwRnVuY3Rpb24oCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50W10geEJ1eSwKICAgICAgICBpbnRbXSB5QnV5LAogICAgICAgIGludFtdIHhTZWxsLAogICAgICAgIGludFtdIHlTZWxsCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU9wZXJhdG9yCiAgICB7CiAgICAgICAgcmVxdWlyZSh4QnV5Lmxlbmd0aCA9PSB5QnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh4U2VsbC5sZW5ndGggPT0geVNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHhCdXkubGVuZ3RoIDw9IE1BWF9TVEVQU19JTl9GVU5DVElPTik7CiAgICAgICAgcmVxdWlyZSh4U2VsbC5sZW5ndGggPD0gTUFYX1NURVBTX0lOX0ZVTkNUSU9OKTsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKCiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uID0gU3RlcEZ1bmN0aW9uKHhCdXksIHlCdXkpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeFNlbGwsIHlTZWxsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWxpZFJhdGVEdXJhdGlvbkluQmxvY2tzKHVpbnQgZHVyYXRpb24pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3MgPSBkdXJhdGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmFibGVUb2tlblRyYWRlKEVSQzIwIHRva2VuKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKICAgICAgICByZXF1aXJlKHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uICE9IDApOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uZW5hYmxlZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuVHJhZGUoRVJDMjAgdG9rZW4pIHB1YmxpYyBvbmx5QWxlcnRlciB7CiAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UmVzZXJ2ZUFkZHJlc3MoYWRkcmVzcyByZXNlcnZlKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXNlcnZlQ29udHJhY3QgPSByZXNlcnZlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlY29yZEltYmFsYW5jZSgKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnQgYnV5QW1vdW50LAogICAgICAgIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLAogICAgICAgIHVpbnQgY3VycmVudEJsb2NrCiAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlc2VydmVDb250cmFjdCk7CgogICAgICAgIGlmIChyYXRlVXBkYXRlQmxvY2sgPT0gMCkgcmF0ZVVwZGF0ZUJsb2NrID0gZ2V0UmF0ZVVwZGF0ZUJsb2NrKHRva2VuKTsKCiAgICAgICAgcmV0dXJuIGFkZEltYmFsYW5jZSh0b2tlbiwgYnV5QW1vdW50LCByYXRlVXBkYXRlQmxvY2ssIGN1cnJlbnRCbG9jayk7CiAgICB9CgogICAgLyogc29saGludC1kaXNhYmxlIGZ1bmN0aW9uLW1heC1saW5lcyAqLwogICAgZnVuY3Rpb24gZ2V0UmF0ZShFUkMyMCB0b2tlbiwgdWludCBjdXJyZW50QmxvY2tOdW1iZXIsIGJvb2wgYnV5LCB1aW50IHF0eSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gY2hlY2sgaWYgdHJhZGUgaXMgZW5hYmxlZAogICAgICAgIGlmICghdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkKSByZXR1cm4gMDsKICAgICAgICBpZiAodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24gPT0gMCkgcmV0dXJuIDA7IC8vIHRva2VuIGNvbnRyb2wgaW5mbyBub3Qgc2V0CgogICAgICAgIC8vIGdldCByYXRlIHVwZGF0ZSBibG9jawogICAgICAgIGJ5dGVzMzIgY29tcGFjdERhdGEgPSB0b2tlblJhdGVzQ29tcGFjdERhdGFbdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXhdOwoKICAgICAgICB1aW50IHVwZGF0ZVJhdGVCbG9jayA9IGdldExhc3Q0Qnl0ZXMoY29tcGFjdERhdGEpOwogICAgICAgIGlmIChjdXJyZW50QmxvY2tOdW1iZXIgPj0gdXBkYXRlUmF0ZUJsb2NrICsgdmFsaWRSYXRlRHVyYXRpb25JbkJsb2NrcykgcmV0dXJuIDA7IC8vIHJhdGUgaXMgZXhwaXJlZAogICAgICAgIC8vIGNoZWNrIGltYmFsYW5jZQogICAgICAgIGludCB0b3RhbEltYmFsYW5jZTsKICAgICAgICBpbnQgYmxvY2tJbWJhbGFuY2U7CiAgICAgICAgKHRvdGFsSW1iYWxhbmNlLCBibG9ja0ltYmFsYW5jZSkgPSBnZXRJbWJhbGFuY2UodG9rZW4sIHVwZGF0ZVJhdGVCbG9jaywgY3VycmVudEJsb2NrTnVtYmVyKTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIGFjdHVhbCByYXRlCiAgICAgICAgaW50IGltYmFsYW5jZVF0eTsKICAgICAgICBpbnQgZXh0cmFCcHM7CiAgICAgICAgaW50OCByYXRlVXBkYXRlOwogICAgICAgIHVpbnQgcmF0ZTsKCiAgICAgICAgaWYgKGJ1eSkgewogICAgICAgICAgICAvLyBzdGFydCB3aXRoIGJhc2UgcmF0ZQogICAgICAgICAgICByYXRlID0gdG9rZW5EYXRhW3Rva2VuXS5iYXNlQnV5UmF0ZTsKCiAgICAgICAgICAgIC8vIGFkZCByYXRlIHVwZGF0ZQogICAgICAgICAgICByYXRlVXBkYXRlID0gZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEoY29tcGFjdERhdGEsIHRva2VuLCB0cnVlKTsKICAgICAgICAgICAgZXh0cmFCcHMgPSBpbnQocmF0ZVVwZGF0ZSkgKiAxMDsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CgogICAgICAgICAgICAvLyBjb21wdXRlIHRva2VuIHF0eQogICAgICAgICAgICBxdHkgPSBnZXRUb2tlblF0eSh0b2tlbiwgcmF0ZSwgcXR5KTsKICAgICAgICAgICAgaW1iYWxhbmNlUXR5ID0gaW50KHF0eSk7CiAgICAgICAgICAgIHRvdGFsSW1iYWxhbmNlICs9IGltYmFsYW5jZVF0eTsKCiAgICAgICAgICAgIC8vIGFkZCBxdHkgb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbiwgaW50KHF0eSkpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGFkZCBpbWJhbGFuY2Ugb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbiwgdG90YWxJbWJhbGFuY2UpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBzdGFydCB3aXRoIGJhc2UgcmF0ZQogICAgICAgICAgICByYXRlID0gdG9rZW5EYXRhW3Rva2VuXS5iYXNlU2VsbFJhdGU7CgogICAgICAgICAgICAvLyBhZGQgcmF0ZSB1cGRhdGUKICAgICAgICAgICAgcmF0ZVVwZGF0ZSA9IGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKGNvbXBhY3REYXRhLCB0b2tlbiwgZmFsc2UpOwogICAgICAgICAgICBleHRyYUJwcyA9IGludChyYXRlVXBkYXRlKSAqIDEwOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGNvbXB1dGUgdG9rZW4gcXR5CiAgICAgICAgICAgIGltYmFsYW5jZVF0eSA9IC0xICogaW50KHF0eSk7CiAgICAgICAgICAgIHRvdGFsSW1iYWxhbmNlICs9IGltYmFsYW5jZVF0eTsKCiAgICAgICAgICAgIC8vIGFkZCBxdHkgb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24sIGludChxdHkpKTsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CgogICAgICAgICAgICAvLyBhZGQgaW1iYWxhbmNlIG92ZXJoZWFkCiAgICAgICAgICAgIGV4dHJhQnBzID0gZXhlY3V0ZVN0ZXBGdW5jdGlvbih0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLCB0b3RhbEltYmFsYW5jZSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFicyh0b3RhbEltYmFsYW5jZSkgPj0gZ2V0TWF4VG90YWxJbWJhbGFuY2UodG9rZW4pKSByZXR1cm4gMDsKICAgICAgICBpZiAoYWJzKGJsb2NrSW1iYWxhbmNlICsgaW1iYWxhbmNlUXR5KSA+PSBnZXRNYXhQZXJCbG9ja0ltYmFsYW5jZSh0b2tlbikpIHJldHVybiAwOwoKICAgICAgICByZXR1cm4gcmF0ZTsKICAgIH0KICAgIC8qIHNvbGhpbnQtZW5hYmxlIGZ1bmN0aW9uLW1heC1saW5lcyAqLwoKICAgIGZ1bmN0aW9uIGdldEJhc2ljUmF0ZShFUkMyMCB0b2tlbiwgYm9vbCBidXkpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGlmIChidXkpCiAgICAgICAgICAgIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJhc2VCdXlSYXRlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYmFzZVNlbGxSYXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvbXBhY3REYXRhKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQsIGJ5dGUsIGJ5dGUpIHsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKCiAgICAgICAgdWludCBhcnJheUluZGV4ID0gdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXg7CiAgICAgICAgdWludCBmaWVsZE9mZnNldCA9IHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFGaWVsZEluZGV4OwoKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhcnJheUluZGV4LAogICAgICAgICAgICBmaWVsZE9mZnNldCwKICAgICAgICAgICAgYnl0ZShnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YSh0b2tlblJhdGVzQ29tcGFjdERhdGFbYXJyYXlJbmRleF0sIHRva2VuLCB0cnVlKSksCiAgICAgICAgICAgIGJ5dGUoZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEodG9rZW5SYXRlc0NvbXBhY3REYXRhW2FycmF5SW5kZXhdLCB0b2tlbiwgZmFsc2UpKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9rZW5CYXNpY0RhdGEoRVJDMjAgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCwgYm9vbCkgewogICAgICAgIHJldHVybiAodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQsIHRva2VuRGF0YVt0b2tlbl0uZW5hYmxlZCk7CiAgICB9CgogICAgLyogc29saGludC1kaXNhYmxlIGNvZGUtY29tcGxleGl0eSAqLwogICAgZnVuY3Rpb24gZ2V0U3RlcEZ1bmN0aW9uRGF0YShFUkMyMCB0b2tlbiwgdWludCBjb21tYW5kLCB1aW50IHBhcmFtKSBwdWJsaWMgdmlldyByZXR1cm5zKGludCkgewogICAgICAgIGlmIChjb21tYW5kID09IDApIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uLngubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxKSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uLnhbcGFyYW1dOwogICAgICAgIGlmIChjb21tYW5kID09IDIpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uLnkubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAzKSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICBpZiAoY29tbWFuZCA9PSA0KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24ueC5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDUpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLnhbcGFyYW1dOwogICAgICAgIGlmIChjb21tYW5kID09IDYpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi55Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNykgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24ueVtwYXJhbV07CgogICAgICAgIGlmIChjb21tYW5kID09IDgpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLngubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA5KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnhbcGFyYW1dOwogICAgICAgIGlmIChjb21tYW5kID09IDEwKSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTEpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueVtwYXJhbV07CgogICAgICAgIGlmIChjb21tYW5kID09IDEyKSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueC5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDEzKSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxNCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnkubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxNSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueVtwYXJhbV07CgogICAgICAgIHJldmVydCgpOwogICAgfQogICAgLyogc29saGludC1lbmFibGUgY29kZS1jb21wbGV4aXR5ICovCgogICAgZnVuY3Rpb24gZ2V0UmF0ZVVwZGF0ZUJsb2NrKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBieXRlczMyIGNvbXBhY3REYXRhID0gdG9rZW5SYXRlc0NvbXBhY3REYXRhW3Rva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFBcnJheUluZGV4XTsKICAgICAgICByZXR1cm4gZ2V0TGFzdDRCeXRlcyhjb21wYWN0RGF0YSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGlzdGVkVG9rZW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyhFUkMyMFtdKSB7CiAgICAgICAgcmV0dXJuIGxpc3RlZFRva2VuczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlblF0eShFUkMyMCB0b2tlbiwgdWludCBldGhRdHksIHVpbnQgcmF0ZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IGRzdERlY2ltYWxzID0gZ2V0RGVjaW1hbHModG9rZW4pOwogICAgICAgIHVpbnQgc3JjRGVjaW1hbHMgPSBFVEhfREVDSU1BTFM7CgogICAgICAgIHJldHVybiBjYWxjRHN0UXR5KGV0aFF0eSwgc3JjRGVjaW1hbHMsIGRzdERlY2ltYWxzLCByYXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMYXN0NEJ5dGVzKGJ5dGVzMzIgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBjYW5ub3QgdHJ1c3QgY29tcGlsZXIgd2l0aCBub3QgdHVybmluZyBiaXQgb3BlcmF0aW9ucyBpbnRvIEVYUCBvcGNvZGUKICAgICAgICByZXR1cm4gdWludChiKSAvIChCWVRFU18xNF9PRkZTRVQgKiBCWVRFU18xNF9PRkZTRVQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKGJ5dGVzMzIgZGF0YSwgRVJDMjAgdG9rZW4sIGJvb2wgYnV5KSBpbnRlcm5hbCB2aWV3IHJldHVybnMoaW50OCkgewogICAgICAgIHVpbnQgZmllbGRPZmZzZXQgPSB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhRmllbGRJbmRleDsKICAgICAgICB1aW50IGJ5dGVPZmZzZXQ7CiAgICAgICAgaWYgKGJ1eSkKICAgICAgICAgICAgYnl0ZU9mZnNldCA9IDMyIC0gTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEEgKyBmaWVsZE9mZnNldDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGJ5dGVPZmZzZXQgPSA0ICsgZmllbGRPZmZzZXQ7CgogICAgICAgIHJldHVybiBpbnQ4KGRhdGFbYnl0ZU9mZnNldF0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdGVwRnVuY3Rpb24oU3RlcEZ1bmN0aW9uIGYsIGludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnMoaW50KSB7CiAgICAgICAgdWludCBsZW4gPSBmLnkubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpbmQgPSAwOyBpbmQgPCBsZW47IGluZCsrKSB7CiAgICAgICAgICAgIGlmICh4IDw9IGYueFtpbmRdKSByZXR1cm4gZi55W2luZF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZi55W2xlbi0xXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRCcHModWludCByYXRlLCBpbnQgYnBzKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJlcXVpcmUocmF0ZSA8PSBNQVhfUkFURSk7CiAgICAgICAgcmVxdWlyZShicHMgPj0gTUlOX0JQU19BREpVU1RNRU5UKTsKICAgICAgICByZXF1aXJlKGJwcyA8PSBNQVhfQlBTX0FESlVTVE1FTlQpOwoKICAgICAgICB1aW50IG1heEJwcyA9IDEwMCAqIDEwMDsKICAgICAgICByZXR1cm4gKHJhdGUgKiB1aW50KGludChtYXhCcHMpICsgYnBzKSkgLyBtYXhCcHM7CiAgICB9CgogICAgZnVuY3Rpb24gYWJzKGludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIGlmICh4IDwgMCkKICAgICAgICAgICAgcmV0dXJuIHVpbnQoLTEgKiB4KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB1aW50KHgpOwogICAgfQp9'.
	

]
