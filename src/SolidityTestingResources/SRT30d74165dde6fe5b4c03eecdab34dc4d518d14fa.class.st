Class {
	#name : #SRT30d74165dde6fe5b4c03eecdab34dc4d518d14fa,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT30d74165dde6fe5b4c03eecdab34dc4d518d14fa >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBBYnN0cmFjdFBheW1lbnRFc2Nyb3cgaXMgT3duYWJsZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgcHVibGljIGRlcG9zaXRzOwoKICAgIGV2ZW50IFBheW1lbnQoYWRkcmVzcyBpbmRleGVkIF9jdXN0b21lciwgdWludCBpbmRleGVkIF9wcm9qZWN0SWQsIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIF93YWxsZXQsIHVpbnQgdmFsdWUpOwoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHMoKSBwdWJsaWM7CgogICAgLyoqCiAgICAgKiBAZGV2IENoYW5nZSB0aGUgd2FsbGV0CiAgICAgKiBAcGFyYW0gX3dhbGxldCBhZGRyZXNzIG9mIHRoZSB3YWxsZXQgd2hlcmUgZmVlcyB3aWxsIGJlIHRyYW5zZmVyZWQgd2hlbiBzcGVudAogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VXYWxsZXQoYWRkcmVzcyBfd2FsbGV0KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcigpCiAgICB7CiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgZGVwb3NpdGVkIGZvciB0aGUgcHJvdmlkZWQgcHJvamVjdCwgcmV0dXJucyAwIGlmIHRoZXJlJ3Mgbm8gZGVwb3NpdCBmb3IgdGhhdCBwcm9qZWN0IG9yIHRoZSBhbW91bnQgaW4gd2VpCiAgICAgKiBAcGFyYW0gX3Byb2plY3RJZCBUaGUgaWQgb2YgdGhlIHByb2plY3QKICAgICAqIEByZXR1cm4gMCBpZiB0aGVyZSdzIGVpdGhlciBubyBkZXBvc2l0IGZvciBfcHJvamVjdElkLCBvdGhlcndpc2UgcmV0dXJucyB0aGUgZGVwb3NpdGVkIGFtb3VudCBpbiB3ZWkKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0RGVwb3NpdCh1aW50IF9wcm9qZWN0SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBkZXBvc2l0c1tfcHJvamVjdElkXTsKICAgIH0KfQoKY29udHJhY3QgVG9raXRSZWdpc3RyeSBpcyBPd25hYmxlIHsKCiAgICBzdHJ1Y3QgUHJvamVjdENvbnRyYWN0cyB7CiAgICAgICAgYWRkcmVzcyB0b2tlbjsKICAgICAgICBhZGRyZXNzIGZ1bmQ7CiAgICAgICAgYWRkcmVzcyBjYW1wYWlnbjsKICAgIH0KCiAgICAvLyByZWdpc3RyYXIgPT4gdHJ1ZS9mYWxzZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgcmVnaXN0cmFyczsKCiAgICAvLyBjdXN0b21lciA9PiBwcm9qZWN0X2lkID0+IHRva2VuL2NhbXBhaWduCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcodWludCA9PiBQcm9qZWN0Q29udHJhY3RzKSkgcHVibGljIHJlZ2lzdHJ5OwogICAgLy8gcHJvamVjdF9pZCA9PiB0b2tlbi9jYW1wYWlnbgogICAgbWFwcGluZyAodWludCA9PiBQcm9qZWN0Q29udHJhY3RzKSBwdWJsaWMgcHJvamVjdF9yZWdpc3RyeTsKCiAgICBldmVudCBSZWdpc3RlcmVkVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9wcm9qZWN0T3duZXIsIHVpbnQgaW5kZXhlZCBfcHJvamVjdElkLCBhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfZnVuZCk7CiAgICBldmVudCBSZWdpc3RlcmVkQ2FtcGFpZ24oYWRkcmVzcyBpbmRleGVkIF9wcm9qZWN0T3duZXIsIHVpbnQgaW5kZXhlZCBfcHJvamVjdElkLCBhZGRyZXNzIF9jYW1wYWlnbik7CgogICAgbW9kaWZpZXIgb25seVJlZ2lzdHJhcnMoKSB7CiAgICAgICAgcmVxdWlyZShyZWdpc3RyYXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIFRva2l0UmVnaXN0cnkoYWRkcmVzcyBfb3duZXIpIHsKICAgICAgICBzZXRSZWdpc3RyYXIoX293bmVyLCB0cnVlKTsKICAgICAgICB0cmFuc2Zlck93bmVyc2hpcChfb3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGFkZHJlc3MgX2N1c3RvbWVyLCB1aW50IF9wcm9qZWN0SWQsIGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9mdW5kKQogICAgICAgIG9ubHlSZWdpc3RyYXJzKCkKICAgIHsKICAgICAgICByZWdpc3RyeVtfY3VzdG9tZXJdW19wcm9qZWN0SWRdLnRva2VuID0gX3Rva2VuOwogICAgICAgIHJlZ2lzdHJ5W19jdXN0b21lcl1bX3Byb2plY3RJZF0uZnVuZCA9IF9mdW5kOwoKICAgICAgICBwcm9qZWN0X3JlZ2lzdHJ5W19wcm9qZWN0SWRdLnRva2VuID0gX3Rva2VuOwogICAgICAgIHByb2plY3RfcmVnaXN0cnlbX3Byb2plY3RJZF0uZnVuZCA9IF9mdW5kOwoKICAgICAgICBSZWdpc3RlcmVkVG9rZW4oX2N1c3RvbWVyLCBfcHJvamVjdElkLCBfdG9rZW4sIF9mdW5kKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzIF9jdXN0b21lciwgdWludCBfcHJvamVjdElkLCBhZGRyZXNzIF9jYW1wYWlnbikKICAgICAgICBvbmx5UmVnaXN0cmFycygpCiAgICB7CiAgICAgICAgcmVnaXN0cnlbX2N1c3RvbWVyXVtfcHJvamVjdElkXS5jYW1wYWlnbiA9IF9jYW1wYWlnbjsKCiAgICAgICAgcHJvamVjdF9yZWdpc3RyeVtfcHJvamVjdElkXS5jYW1wYWlnbiA9IF9jYW1wYWlnbjsKCiAgICAgICAgUmVnaXN0ZXJlZENhbXBhaWduKF9jdXN0b21lciwgX3Byb2plY3RJZCwgX2NhbXBhaWduKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsb29rdXAoYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3Byb2plY3RJZCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3MgdG9rZW4sIGFkZHJlc3MgZnVuZCwgYWRkcmVzcyBjYW1wYWlnbikKICAgIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICByZWdpc3RyeVtfY3VzdG9tZXJdW19wcm9qZWN0SWRdLnRva2VuLAogICAgICAgICAgICByZWdpc3RyeVtfY3VzdG9tZXJdW19wcm9qZWN0SWRdLmZ1bmQsCiAgICAgICAgICAgIHJlZ2lzdHJ5W19jdXN0b21lcl1bX3Byb2plY3RJZF0uY2FtcGFpZ24KICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGxvb2t1cEJ5UHJvamVjdCh1aW50IF9wcm9qZWN0SWQpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzIHRva2VuLCBhZGRyZXNzIGZ1bmQsIGFkZHJlc3MgY2FtcGFpZ24pCiAgICB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgcHJvamVjdF9yZWdpc3RyeVtfcHJvamVjdElkXS50b2tlbiwKICAgICAgICAgICAgcHJvamVjdF9yZWdpc3RyeVtfcHJvamVjdElkXS5mdW5kLAogICAgICAgICAgICBwcm9qZWN0X3JlZ2lzdHJ5W19wcm9qZWN0SWRdLmNhbXBhaWduCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSZWdpc3RyYXIoYWRkcmVzcyBfcmVnaXN0cmFyLCBib29sIGVuYWJsZWQpCiAgICAgICAgb25seU93bmVyKCkKICAgIHsKICAgICAgICByZWdpc3RyYXJzW19yZWdpc3RyYXJdID0gZW5hYmxlZDsKICAgIH0KfQoKLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKCmNvbnRyYWN0IFRva2VuIHsKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBBYnN0cmFjdFNpbmd1bGFyRFRWVG9rZW4gaXMgVG9rZW4gewp9CgovLy8gQHRpdGxlIEZ1bmQgY29udHJhY3QgLSBJbXBsZW1lbnRzIHJld2FyZCBkaXN0cmlidXRpb24uCi8vLyBAYXV0aG9yIFN0ZWZhbiBHZW9yZ2UgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijg4ZmJmY2VkZWVlOWU2YTZlZmVkZTdmYWVmZWRjOGViZTdlNmZiZWRlNmZiZjFmYmE2ZTZlZGZjIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8vIEBhdXRob3IgTWlsYWQgTW9zdGF2aSAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMTQ3OTdkNzg3NTcwM2E3OTdiNjc2MDc1NjI3ZDU0Nzc3YjdhNjc3MTdhNjc2ZDY3M2E3YTcxNjAiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBTaW5ndWxhckRUVkZ1bmQgewogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIjAuMS4wIjsKCiAgICAvKgogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cwogICAgICovCiAgICBBYnN0cmFjdFNpbmd1bGFyRFRWVG9rZW4gcHVibGljIHNpbmd1bGFyRFRWVG9rZW47CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgdWludCBwdWJsaWMgdG90YWxSZXdhcmQ7CgogICAgLy8gVXNlcidzIGFkZHJlc3MgPT4gUmV3YXJkIGF0IHRpbWUgb2Ygd2l0aGRyYXcKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHJld2FyZEF0VGltZU9mV2l0aGRyYXc7CgogICAgLy8gVXNlcidzIGFkZHJlc3MgPT4gUmV3YXJkIHdoaWNoIGNhbiBiZSB3aXRoZHJhd24KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIG93ZWQ7CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIC8vIE9ubHkgZ3VhcmQgaXMgYWxsb3dlZCB0byBkbyB0aGlzIGFjdGlvbi4KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogIENvbnRyYWN0IGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBEZXBvc2l0cyByZXdhcmQuIFJldHVybnMgc3VjY2Vzcy4KICAgIGZ1bmN0aW9uIGRlcG9zaXRSZXdhcmQoKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHRvdGFsUmV3YXJkICs9IG1zZy52YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBXaXRoZHJhd3MgcmV3YXJkIGZvciB1c2VyLiBSZXR1cm5zIHJld2FyZC4KICAgIC8vLyBAcGFyYW0gZm9yQWRkcmVzcyB1c2VyJ3MgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIGNhbGNSZXdhcmQoYWRkcmVzcyBmb3JBZGRyZXNzKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gc2luZ3VsYXJEVFZUb2tlbi5iYWxhbmNlT2YoZm9yQWRkcmVzcykgKiAodG90YWxSZXdhcmQgLSByZXdhcmRBdFRpbWVPZldpdGhkcmF3W2ZvckFkZHJlc3NdKSAvIHNpbmd1bGFyRFRWVG9rZW4udG90YWxTdXBwbHkoKTsKICAgIH0KCiAgICAvLy8gQGRldiBXaXRoZHJhd3MgcmV3YXJkIGZvciB1c2VyLiBSZXR1cm5zIHJld2FyZC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UmV3YXJkKCkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHVpbnQgdmFsdWUgPSBjYWxjUmV3YXJkKG1zZy5zZW5kZXIpICsgb3dlZFttc2cuc2VuZGVyXTsKICAgICAgICByZXdhcmRBdFRpbWVPZldpdGhkcmF3W21zZy5zZW5kZXJdID0gdG90YWxSZXdhcmQ7CiAgICAgICAgb3dlZFttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgaWYgKHZhbHVlID4gMCAmJiAhbXNnLnNlbmRlci5zZW5kKHZhbHVlKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWRpdHMgcmV3YXJkIHRvIG93ZWQgYmFsYW5jZS4KICAgIC8vLyBAcGFyYW0gZm9yQWRkcmVzcyB1c2VyJ3MgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHNvZnRXaXRoZHJhd1Jld2FyZEZvcihhZGRyZXNzIGZvckFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHVpbnQgdmFsdWUgPSBjYWxjUmV3YXJkKGZvckFkZHJlc3MpOwogICAgICAgIHJld2FyZEF0VGltZU9mV2l0aGRyYXdbZm9yQWRkcmVzc10gPSB0b3RhbFJld2FyZDsKICAgICAgICBvd2VkW2ZvckFkZHJlc3NdICs9IHZhbHVlOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIHRva2VuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHNpbmd1bGFyRFRWVG9rZW5BZGRyZXNzIFRva2VuIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHNpbmd1bGFyRFRWVG9rZW5BZGRyZXNzKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoYWRkcmVzcyhzaW5ndWxhckRUVlRva2VuKSA9PSAwKSB7CiAgICAgICAgICAgIHNpbmd1bGFyRFRWVG9rZW4gPSBBYnN0cmFjdFNpbmd1bGFyRFRWVG9rZW4oc2luZ3VsYXJEVFZUb2tlbkFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgZ3VhcmQgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIFNpbmd1bGFyRFRWRnVuZCgpIHsKICAgICAgICAvLyBTZXQgb3duZXIgYWRkcmVzcwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhY3RzIGFzIGRlcG9zaXRSZXdhcmQoKQogICAgZnVuY3Rpb24gKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHdpdGhkcmF3UmV3YXJkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVwb3NpdFJld2FyZCgpOwogICAgICAgIH0KICAgIH0KfQoKLy8vIEB0aXRsZSBUb2tlbiBDcmVhdGlvbiBjb250cmFjdCAtIEltcGxlbWVudHMgdG9rZW4gY3JlYXRpb24gZnVuY3Rpb25hbGl0eS4KLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTUyNjIxMzAzMzM0M2I3YjMyMzAzYTI3MzIzMDE1MzYzYTNiMjYzMDNiMjYyYzI2N2IzYjMwMjEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgovLy8gQGF1dGhvciBSYXp2YW4gUG9wIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzYjQ5NWE0MTRkNWE1NTE1NGI1NDRiN2I1ODU0NTU0ODVlNTU0ODQyNDgxNTU1NWU0ZiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Ci8vLyBAYXV0aG9yIE1pbGFkIE1vc3RhdmkgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjE0Nzk3ZDc4NzU3MDNhNzk3YjY3NjA3NTYyN2Q1NDc3N2I3YTY3NzE3YTY3NmQ2NzNhN2E3MTYwIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgU2luZ3VsYXJEVFZMYXVuY2ggewogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIjAuMS4wIjsKCiAgICBldmVudCBDb250cmlidXRlZChhZGRyZXNzIGluZGV4ZWQgY29udHJpYnV0b3IsIHVpbnQgY29udHJpYnV0aW9uLCB1aW50IHRva2Vucyk7CgogICAgLyoKICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMKICAgICAqLwogICAgQWJzdHJhY3RTaW5ndWxhckRUVlRva2VuIHB1YmxpYyBzaW5ndWxhckRUVlRva2VuOwogICAgYWRkcmVzcyBwdWJsaWMgd29ya3Nob3A7CiAgICBhZGRyZXNzIHB1YmxpYyBTaW5ndWxhckRUVldvcmtzaG9wID0gMHhjNzgzMTAyMzFhQTUzYkQzRDBGRUEyRjhjNzA1QzY3NzMwOTI5RDhmOwogICAgdWludCBwdWJsaWMgU2luZ3VsYXJEVFZXb3Jrc2hvcEZlZTsKCiAgICAvKgogICAgICogIENvbnN0YW50cwogICAgICovCiAgICB1aW50IHB1YmxpYyBDQVA7IC8vIGluIHdlaSBzY2FsZSBvZiB0b2tlbnMKICAgIHVpbnQgcHVibGljIERVUkFUSU9OOyAvLyBpbiBzZWNvbmRzCiAgICB1aW50IHB1YmxpYyBUT0tFTl9UQVJHRVQ7IC8vIEdvYWwgdGhyZXNob2xkIGluIHdlaSBzY2FsZSBvZiB0b2tlbnMKCiAgICAvKgogICAgICogIEVudW1zCiAgICAgKi8KICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBEZXBsb3llZCwKICAgICAgICBHb2luZ0FuZEdvYWxOb3RSZWFjaGVkLAogICAgICAgIEVuZGVkQW5kR29hbE5vdFJlYWNoZWQsCiAgICAgICAgR29pbmdBbmRHb2FsUmVhY2hlZCwKICAgICAgICBFbmRlZEFuZEdvYWxSZWFjaGVkCiAgICB9CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgdWludCBwdWJsaWMgc3RhcnREYXRlOwogICAgdWludCBwdWJsaWMgZnVuZEJhbGFuY2U7CiAgICB1aW50IHB1YmxpYyB2YWx1ZVBlclRva2VuOyAvL2luIHdlaQogICAgdWludCBwdWJsaWMgdG9rZW5zU2VudDsKCiAgICAvLyBwYXJ0aWNpcGFudCBhZGRyZXNzID0+IHZhbHVlIGluIFdlaQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgY29udHJpYnV0aW9uczsKCiAgICAvLyBwYXJ0aWNpcGFudCBhZGRyZXNzID0+IHRva2VuIGFtb3VudCBpbiB3ZWkgc2NhbGUKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHNlbnRUb2tlbnM7CgogICAgLy8gSW5pdGlhbGl6ZSBzdGFnZQogICAgU3RhZ2VzIHB1YmxpYyBzdGFnZSA9IFN0YWdlcy5EZXBsb3llZDsKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgLy8gT25seSBvd25lciBpcyBhbGxvd2VkIHRvIGRvIHRoaXMgYWN0aW9uLgogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGF0U3RhZ2UoU3RhZ2VzIF9zdGFnZSkgewogICAgICAgIGlmIChzdGFnZSAhPSBfc3RhZ2UpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgYXRTdGFnZU9SKFN0YWdlcyBfc3RhZ2UxLCBTdGFnZXMgX3N0YWdlMikgewogICAgICAgIGlmIChzdGFnZSAhPSBfc3RhZ2UxICYmIHN0YWdlICE9IF9zdGFnZTIpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdGltZWRUcmFuc2l0aW9ucygpIHsKICAgICAgICB1aW50IHRpbWVFbGFwc2VkID0gbm93IC0gc3RhcnREYXRlOwoKICAgICAgICBpZiAodGltZUVsYXBzZWQgPj0gRFVSQVRJT04pIHsKICAgICAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5Hb2luZ0FuZEdvYWxOb3RSZWFjaGVkKSB7CiAgICAgICAgICAgICAgICBzdGFnZSA9IFN0YWdlcy5FbmRlZEFuZEdvYWxOb3RSZWFjaGVkOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YWdlID09IFN0YWdlcy5Hb2luZ0FuZEdvYWxSZWFjaGVkKSB7CiAgICAgICAgICAgICAgICBzdGFnZSA9IFN0YWdlcy5FbmRlZEFuZEdvYWxSZWFjaGVkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBDb250cmFjdCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIGRldiBWYWxpZGF0ZXMgaW52YXJpYW50cy4KICAgIGZ1bmN0aW9uIGNoZWNrSW52YXJpYW50cygpIGNvbnN0YW50IGludGVybmFsIHsKICAgICAgICBpZiAoZnVuZEJhbGFuY2UgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENhbiBiZSB0cmlnZ2VyZWQgaWYgYW4gaW52YXJpYW50IGZhaWxzLgogICAgZnVuY3Rpb24gZW1lcmdlbmN5Q2FsbCgpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoZnVuZEJhbGFuY2UgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA+IDAgJiYgIVNpbmd1bGFyRFRWV29ya3Nob3Auc2VuZCh0aGlzLmJhbGFuY2UpKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB1c2VyIHRvIGNyZWF0ZSB0b2tlbnMgaWYgdG9rZW4gY3JlYXRpb24gaXMgc3RpbGwgZ29pbmcgYW5kIGNhcCBub3QgcmVhY2hlZC4gUmV0dXJucyB0b2tlbiBjb3VudC4KICAgIGZ1bmN0aW9uIGZ1bmQoKQogICAgICAgIHB1YmxpYwogICAgICAgIHRpbWVkVHJhbnNpdGlvbnMKICAgICAgICBhdFN0YWdlT1IoU3RhZ2VzLkdvaW5nQW5kR29hbE5vdFJlYWNoZWQsIFN0YWdlcy5Hb2luZ0FuZEdvYWxSZWFjaGVkKQogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHVpbnQgdG9rZW5Db3VudCA9IChtc2cudmFsdWUgKiAoMTAqKjE4KSkgLyB2YWx1ZVBlclRva2VuOyAvLyBUb2tlbiBjb3VudCBpbiB3ZWkgaXMgcm91bmRlZCBkb3duLiBTZW50IEVUSCBzaG91bGQgYmUgbXVsdGlwbGVzIG9mIHZhbHVlUGVyVG9rZW4uCiAgICAgICAgcmVxdWlyZSh0b2tlbkNvdW50ID4gMCk7CiAgICAgICAgaWYgKHRva2Vuc1NlbnQgKyB0b2tlbkNvdW50ID4gQ0FQKSB7CiAgICAgICAgICAgIC8vIFVzZXIgd2FudHMgdG8gY3JlYXRlIG1vcmUgdG9rZW5zIHRoYW4gYXZhaWxhYmxlLiBTZXQgdG9rZW5zIHRvIHBvc3NpYmxlIG1heGltdW0uCiAgICAgICAgICAgIHRva2VuQ291bnQgPSBDQVAgLSB0b2tlbnNTZW50OwogICAgICAgIH0KICAgICAgICB0b2tlbnNTZW50ICs9IHRva2VuQ291bnQ7CgogICAgICAgIHVpbnQgY29udHJpYnV0aW9uID0gKHRva2VuQ291bnQgKiB2YWx1ZVBlclRva2VuKSAvICgxMCoqMTgpOyAvLyBFdGhlciBzcGVudCBieSB1c2VyLgogICAgICAgIC8vIFNlbmQgY2hhbmdlIGJhY2sgdG8gdXNlci4KICAgICAgICBpZiAobXNnLnZhbHVlID4gY29udHJpYnV0aW9uICYmICFtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlIC0gY29udHJpYnV0aW9uKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgLy8gVXBkYXRlIGZ1bmQgYW5kIHVzZXIncyBiYWxhbmNlIGFuZCB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zLgogICAgICAgIGZ1bmRCYWxhbmNlICs9IGNvbnRyaWJ1dGlvbjsKICAgICAgICBjb250cmlidXRpb25zW21zZy5zZW5kZXJdICs9IGNvbnRyaWJ1dGlvbjsKICAgICAgICBzZW50VG9rZW5zW21zZy5zZW5kZXJdICs9IHRva2VuQ291bnQ7CiAgICAgICAgaWYgKCFzaW5ndWxhckRUVlRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRva2VuQ291bnQpKSB7CiAgICAgICAgICAgIC8vIFRva2VucyBjb3VsZCBub3QgYmUgaXNzdWVkLgogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgLy8gVXBkYXRlIHN0YWdlCiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5Hb2luZ0FuZEdvYWxOb3RSZWFjaGVkKSB7CiAgICAgICAgICAgIGlmICh0b2tlbnNTZW50ID49IFRPS0VOX1RBUkdFVCkgewogICAgICAgICAgICAgICAgc3RhZ2UgPSBTdGFnZXMuR29pbmdBbmRHb2FsUmVhY2hlZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBub3QgYW4gZWxzZSBjbGF1c2UgZm9yIHRoZSBlZGdlIGNhc2UgdGhhdCB0aGUgQ0FQIGFuZCBUT0tFTl9UQVJHRVQgYXJlIHJlYWNoZWQgaW4gb25lIGNhbGwKICAgICAgICBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkdvaW5nQW5kR29hbFJlYWNoZWQpIHsKICAgICAgICAgICAgaWYgKHRva2Vuc1NlbnQgPT0gQ0FQKSB7CiAgICAgICAgICAgICAgICBzdGFnZSA9IFN0YWdlcy5FbmRlZEFuZEdvYWxSZWFjaGVkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNoZWNrSW52YXJpYW50cygpOwoKICAgICAgICBDb250cmlidXRlZChtc2cuc2VuZGVyLCBjb250cmlidXRpb24sIHRva2VuQ291bnQpOwoKICAgICAgICByZXR1cm4gdG9rZW5Db3VudDsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdXNlciB0byB3aXRoZHJhdyBFVEggaWYgdG9rZW4gY3JlYXRpb24gcGVyaW9kIGVuZGVkIGFuZCB0YXJnZXQgd2FzIG5vdCByZWFjaGVkLiBSZXR1cm5zIGNvbnRyaWJ1dGlvbi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3Q29udHJpYnV0aW9uKCkKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFRyYW5zaXRpb25zCiAgICAgICAgYXRTdGFnZShTdGFnZXMuRW5kZWRBbmRHb2FsTm90UmVhY2hlZCkKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIC8vIFdlIGdldCBiYWNrIHRoZSB0b2tlbnMgZnJvbSB0aGUgY29udHJpYnV0b3IgYmVmb3JlIGdpdmluZyBiYWNrIGhpcyBjb250cmlidXRpb24KICAgICAgICB1aW50IHRva2Vuc1JlY2VpdmVkID0gc2VudFRva2Vuc1ttc2cuc2VuZGVyXTsKICAgICAgICBzZW50VG9rZW5zW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBpZiAoIXNpbmd1bGFyRFRWVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIG93bmVyLCB0b2tlbnNSZWNlaXZlZCkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgZnVuZCdzIGFuZCB1c2VyJ3MgYmFsYW5jZSBhbmQgdG90YWwgc3VwcGx5IG9mIHRva2Vucy4KICAgICAgICB1aW50IGNvbnRyaWJ1dGlvbiA9IGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl07CiAgICAgICAgY29udHJpYnV0aW9uc1ttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgZnVuZEJhbGFuY2UgLT0gY29udHJpYnV0aW9uOwogICAgICAgIC8vIFNlbmQgRVRIIGJhY2sgdG8gdXNlci4KICAgICAgICBpZiAoY29udHJpYnV0aW9uID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGNvbnRyaWJ1dGlvbik7CiAgICAgICAgfQogICAgICAgIGNoZWNrSW52YXJpYW50cygpOwogICAgICAgIHJldHVybiBjb250cmlidXRpb247CiAgICB9CgogICAgLy8vIEBkZXYgV2l0aGRyYXdzIEVUSCB0byB3b3Jrc2hvcCBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZvcldvcmtzaG9wKCkKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFRyYW5zaXRpb25zCiAgICAgICAgYXRTdGFnZShTdGFnZXMuRW5kZWRBbmRHb2FsUmVhY2hlZCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgdmFsdWUgPSBmdW5kQmFsYW5jZTsKICAgICAgICBmdW5kQmFsYW5jZSA9IDA7CgogICAgICAgIHJlcXVpcmUodmFsdWUgPiAwKTsKCiAgICAgICAgdWludCBuZXR3b3JrRmVlID0gdmFsdWUgKiBTaW5ndWxhckRUVldvcmtzaG9wRmVlIC8gMTAwOwogICAgICAgIHdvcmtzaG9wLnRyYW5zZmVyKHZhbHVlIC0gbmV0d29ya0ZlZSk7CiAgICAgICAgU2luZ3VsYXJEVFZXb3Jrc2hvcC50cmFuc2ZlcihuZXR3b3JrRmVlKTsKCiAgICAgICAgdWludCByZW1haW5pbmdUb2tlbnMgPSBDQVAgLSB0b2tlbnNTZW50OwogICAgICAgIGlmIChyZW1haW5pbmdUb2tlbnMgPiAwICYmICFzaW5ndWxhckRUVlRva2VuLnRyYW5zZmVyKG93bmVyLCByZW1haW5pbmdUb2tlbnMpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgY2hlY2tJbnZhcmlhbnRzKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIG93bmVyIHRvIGdldCBiYWNrIHVuc2VudCB0b2tlbnMgaW4gY2FzZSBvZiBsYXVuY2ggZmFpbHVyZSAoRW5kZWRBbmRHb2FsTm90UmVhY2hlZCkuCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Vuc2VudFRva2Vuc0Zvck93bmVyKCkKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFRyYW5zaXRpb25zCiAgICAgICAgYXRTdGFnZShTdGFnZXMuRW5kZWRBbmRHb2FsTm90UmVhY2hlZCkKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHVpbnQgcmVtYWluaW5nVG9rZW5zID0gQ0FQIC0gdG9rZW5zU2VudDsKICAgICAgICBpZiAocmVtYWluaW5nVG9rZW5zID4gMCAmJiAhc2luZ3VsYXJEVFZUb2tlbi50cmFuc2Zlcihvd25lciwgcmVtYWluaW5nVG9rZW5zKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIGNoZWNrSW52YXJpYW50cygpOwogICAgICAgIHJldHVybiByZW1haW5pbmdUb2tlbnM7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyB0b2tlbiB2YWx1ZSBpbiBXZWkuCiAgICAvLy8gQHBhcmFtIHZhbHVlSW5XZWkgTmV3IHZhbHVlLgogICAgZnVuY3Rpb24gY2hhbmdlVmFsdWVQZXJUb2tlbih1aW50IHZhbHVlSW5XZWkpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgYXRTdGFnZShTdGFnZXMuRGVwbG95ZWQpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB2YWx1ZVBlclRva2VuID0gdmFsdWVJbldlaTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyB1cGRhdGVTdGFnZSBhbGxvd3MgY2FsbHMgdG8gcmVjZWl2ZSBjb3JyZWN0IHN0YWdlLiBJdCBjYW4gYmUgdXNlZCBmb3IgdHJhbnNhY3Rpb25zIGJ1dCBpcyBub3QgcGFydCBvZiB0aGUgcmVndWxhciB0b2tlbiBjcmVhdGlvbiByb3V0aW5lLgogICAgLy8gSXQgaXMgbm90IG1hcmtlZCBhcyBjb25zdGFudCBiZWNhdXNlIHRpbWVkVHJhbnNpdGlvbnMgbW9kaWZpZXIgaXMgYWx0ZXJpbmcgc3RhdGUgYW5kIGNvbnN0YW50IGlzIG5vdCB5ZXQgZW5mb3JjZWQgYnkgc29sYy4KICAgIC8vLyBAZGV2IHJldHVybnMgY29ycmVjdCBzdGFnZSwgZXZlbiBpZiBhIGZ1bmN0aW9uIHdpdGggdGltZWRUcmFuc2l0aW9ucyBtb2RpZmllciBoYXMgbm90IHlldCBiZWVuIGNhbGxlZCBzdWNjZXNzZnVsbHkuCiAgICBmdW5jdGlvbiB1cGRhdGVTdGFnZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgdGltZWRUcmFuc2l0aW9ucwogICAgICAgIHJldHVybnMgKFN0YWdlcykKICAgIHsKICAgICAgICByZXR1cm4gc3RhZ2U7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhcnQoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkRlcGxveWVkKQogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgaWYgKCFzaW5ndWxhckRUVlRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBDQVApKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgc3RhcnREYXRlID0gbm93OwogICAgICAgIHN0YWdlID0gU3RhZ2VzLkdvaW5nQW5kR29hbE5vdFJlYWNoZWQ7CgogICAgICAgIGNoZWNrSW52YXJpYW50cygpOwogICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICB9CgogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBvd25lciBhbmQgc3RhcnQgZGF0ZS4KICAgIGZ1bmN0aW9uIFNpbmd1bGFyRFRWTGF1bmNoKAogICAgICAgIGFkZHJlc3Mgc2luZ3VsYXJEVFZUb2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfd29ya3Nob3AsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludCBfdG90YWwsCiAgICAgICAgdWludCBfdW5pdF9wcmljZSwKICAgICAgICB1aW50IF9kdXJhdGlvbiwKICAgICAgICB1aW50IF90aHJlc2hvbGQsCiAgICAgICAgdWludCBfc2luZ3VsYXJkdHZ3b3NraG9wX2ZlZQogICAgICAgICkgewogICAgICAgIHNpbmd1bGFyRFRWVG9rZW4gPSBBYnN0cmFjdFNpbmd1bGFyRFRWVG9rZW4oc2luZ3VsYXJEVFZUb2tlbkFkZHJlc3MpOwogICAgICAgIHdvcmtzaG9wID0gX3dvcmtzaG9wOwogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIENBUCA9IF90b3RhbDsgLy8gVG90YWwgbnVtYmVyIG9mIHRva2VucyAod2VpIHNjYWxlKQogICAgICAgIHZhbHVlUGVyVG9rZW4gPSBfdW5pdF9wcmljZTsgLy8gd2VpIHBlciB0b2tlbgogICAgICAgIERVUkFUSU9OID0gX2R1cmF0aW9uOyAvLyBpbiBzZWNvbmRzCiAgICAgICAgVE9LRU5fVEFSR0VUID0gX3RocmVzaG9sZDsgLy8gR29hbCB0aHJlc2hvbGQKICAgICAgICBTaW5ndWxhckRUVldvcmtzaG9wRmVlID0gX3Npbmd1bGFyZHR2d29za2hvcF9mZWU7CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gYWN0cyBhcyBmdW5kKCkgd2hlbiBzdGFnZSBHb2luZ0FuZEdvYWxOb3RSZWFjaGVkCiAgICAvLy8gb3IgR29pbmdBbmRHb2FsUmVhY2hlZC4gQW5kIGFjdCBhcyB3aXRoZHJhd0Z1bmRpbmcoKSB3aGVuIEVuZGVkQW5kR29hbE5vdFJlYWNoZWQuCiAgICAvLy8gb3RoZXJ3aXNlIHRocm93LgogICAgZnVuY3Rpb24gKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5Hb2luZ0FuZEdvYWxOb3RSZWFjaGVkIHx8IHN0YWdlID09IFN0YWdlcy5Hb2luZ0FuZEdvYWxSZWFjaGVkKQogICAgICAgICAgICBmdW5kKCk7CiAgICAgICAgZWxzZSBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkVuZGVkQW5kR29hbE5vdFJlYWNoZWQpCiAgICAgICAgICAgIHdpdGhkcmF3Q29udHJpYnV0aW9uKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXZlcnQoKTsKICAgIH0KfQoKY29udHJhY3QgQWJzdHJhY3RTaW5ndWxhckRUVkZ1bmQgewogICAgZnVuY3Rpb24gc29mdFdpdGhkcmF3UmV3YXJkRm9yKGFkZHJlc3MgZm9yQWRkcmVzcykgcmV0dXJucyAodWludCk7Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuCiAgICAgICAgLy9JZiB5b3VyIHRva2VuIGxlYXZlcyBvdXQgdG90YWxTdXBwbHkgYW5kIGNhbiBpc3N1ZSBtb3JlIHRva2VucyBhcyB0aW1lIGdvZXMgb24sIHlvdSBuZWVkIHRvIGNoZWNrIGlmIGl0IGRvZXNuJ3Qgd3JhcC4KICAgICAgICAvL1JlcGxhY2UgdGhlIGlmIHdpdGggdGhpcyBvbmUgaW5zdGVhZC4KICAgICAgICAvL3JlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL3NhbWUgYXMgYWJvdmUuIFJlcGxhY2UgdGhpcyBsaW5lIHdpdGggdGhlIGZvbGxvd2luZyBpZiB5b3Ugd2FudCB0byBwcm90ZWN0IGFnYWluc3Qgd3JhcHBpbmcgdWludHMuCiAgICAgICAgLy9yZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvKiBBcHByb3ZlcyBhbmQgdGhlbiBjYWxscyB0aGUgcmVjZWl2aW5nIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgogICAgICAgIC8vY2FsbCB0aGUgcmVjZWl2ZUFwcHJvdmFsIGZ1bmN0aW9uIG9uIHRoZSBjb250cmFjdCB5b3Ugd2FudCB0byBiZSBub3RpZmllZC4gVGhpcyBjcmFmdHMgdGhlIGZ1bmN0aW9uIHNpZ25hdHVyZSBtYW51YWxseSBzbyBvbmUgZG9lc24ndCBoYXZlIHRvIGluY2x1ZGUgYSBjb250cmFjdCBpbiBoZXJlIGp1c3QgZm9yIHRoaXMuCiAgICAgICAgLy9yZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpCiAgICAgICAgLy9pdCBpcyBhc3N1bWVkIHRoYXQgd2hlbiBkb2VzIHRoaXMgdGhhdCB0aGUgY2FsbCAqc2hvdWxkKiBzdWNjZWVkLCBvdGhlcndpc2Ugb25lIHdvdWxkIHVzZSB2YW5pbGxhIGFwcHJvdmUgaW5zdGVhZC4KICAgICAgICByZXF1aXJlKF9zcGVuZGVyLmNhbGwoYnl0ZXM0KGJ5dGVzMzIoc2hhMygicmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MsdWludDI1NixhZGRyZXNzLGJ5dGVzKSIpKSksIG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7Cn0KCi8vLyBAdGl0bGUgVG9rZW4gY29udHJhY3QgLSBJbXBsZW1lbnRzIHRva2VuIGlzc3VhbmNlLgovLy8gQGF1dGhvciBTdGVmYW4gR2VvcmdlIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJhY2RmZDhjOWNhY2RjMjgyY2JjOWMzZGVjYmM5ZWNjZmMzYzJkZmM5YzJkZmQ1ZGY4MmMyYzlkOCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Ci8vLyBAYXV0aG9yIE1pbGFkIE1vc3RhdmkgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImZkOTA5NDkxOWM5OWQzOTA5MjhlODk5YzhiOTRiZDllOTI5MzhlOTg5MzhlODQ4ZWQzOTM5ODg5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgU2luZ3VsYXJEVFZUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICIwLjEuMCI7CgogICAgLyoKICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMKICAgICAqLwogICAgQWJzdHJhY3RTaW5ndWxhckRUVkZ1bmQgcHVibGljIHNpbmd1bGFyRFRWRnVuZDsKCiAgICAvKgogICAgICogIFRva2VuIG1ldGEgZGF0YQogICAgICovCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIHRvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIuCiAgICAvLy8gQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gQm90aCBwYXJ0aWVzIHdpdGhkcmF3IHRoZWlyIHJld2FyZCBmaXJzdAogICAgICAgIHNpbmd1bGFyRFRWRnVuZC5zb2Z0V2l0aGRyYXdSZXdhcmRGb3IobXNnLnNlbmRlcik7CiAgICAgICAgc2luZ3VsYXJEVFZGdW5kLnNvZnRXaXRoZHJhd1Jld2FyZEZvcih0byk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFsbG93ZWQgdGhpcmQgcGFydHkgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBmcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgIC8vLyBAcGFyYW0gdG8gQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIHNlbnQuCiAgICAvLy8gQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gQm90aCBwYXJ0aWVzIHdpdGhkcmF3IHRoZWlyIHJld2FyZCBmaXJzdAogICAgICAgIHNpbmd1bGFyRFRWRnVuZC5zb2Z0V2l0aGRyYXdSZXdhcmRGb3IoZnJvbSk7CiAgICAgICAgc2luZ3VsYXJEVFZGdW5kLnNvZnRXaXRoZHJhd1Jld2FyZEZvcih0byk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNpbmd1bGFyRFRWVG9rZW4oYWRkcmVzcyBzRFRWRnVuZEFkZHIsIGFkZHJlc3MgX3dhbGxldCwgc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludCBfdG90YWxTdXBwbHkpIHsKICAgICAgICBpZihzRFRWRnVuZEFkZHIgPT0gMCB8fCBfd2FsbGV0ID09IDApIHsKICAgICAgICAgICAgLy8gRnVuZCBhbmQgV2FsbGV0IGFkZHJlc3NlcyBzaG91bGQgbm90IGJlIG51bGwuCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgYmFsYW5jZXNbX3dhbGxldF0gPSBfdG90YWxTdXBwbHk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBfdG90YWxTdXBwbHk7CgogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgICAgICBzaW5ndWxhckRUVkZ1bmQgPSBBYnN0cmFjdFNpbmd1bGFyRFRWRnVuZChzRFRWRnVuZEFkZHIpOwoKICAgICAgICBUcmFuc2Zlcih0aGlzLCBfd2FsbGV0LCBfdG90YWxTdXBwbHkpOwogICAgfQp9Cgpjb250cmFjdCBUb2tpdERlcGxveWVyIGlzIE93bmFibGUgewoKICAgIFRva2l0UmVnaXN0cnkgcHVibGljIHJlZ2lzdHJ5OwoKICAgIC8vIHBheW1lbnRfdHlwZSA9PiBwYXltZW50X2NvbnRyYWN0CiAgICBtYXBwaW5nICh1aW50OCA9PiBBYnN0cmFjdFBheW1lbnRFc2Nyb3cpIHB1YmxpYyBwYXltZW50Q29udHJhY3RzOwoKICAgIGV2ZW50IERlcGxveWVkVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jdXN0b21lciwgdWludCBpbmRleGVkIF9wcm9qZWN0SWQsIGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9mdW5kKTsKICAgIGV2ZW50IERlcGxveWVkQ2FtcGFpZ24oYWRkcmVzcyBpbmRleGVkIF9jdXN0b21lciwgdWludCBpbmRleGVkIF9wcm9qZWN0SWQsIGFkZHJlc3MgX2NhbXBhaWduKTsKCgogICAgZnVuY3Rpb24gVG9raXREZXBsb3llcihhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfcmVnaXN0cnkpIHsKICAgICAgICB0cmFuc2Zlck93bmVyc2hpcChfb3duZXIpOwogICAgICAgIHJlZ2lzdHJ5ID0gVG9raXRSZWdpc3RyeShfcmVnaXN0cnkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlcGxveVRva2VuKAogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyLCB1aW50IF9wcm9qZWN0SWQsIHVpbnQ4IF9wYXllZFdpdGgsIHVpbnQgX2Ftb3VudE5lZWRlZCwKICAgICAgICAvLyBTaW5ndWxhckRUVlRva2VuCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0LCBzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF90b3RhbFN1cHBseQogICAgKQogICAgICAgIG9ubHlPd25lcigpCiAgICB7CiAgICAgICAgLy8gcGF5ZWQgZm9yCiAgICAgICAgcmVxdWlyZShBYnN0cmFjdFBheW1lbnRFc2Nyb3cocGF5bWVudENvbnRyYWN0c1tfcGF5ZWRXaXRoXSkuZ2V0RGVwb3NpdChfcHJvamVjdElkKSA+PSBfYW1vdW50TmVlZGVkKTsKCiAgICAgICAgdmFyICh0LCwpID0gcmVnaXN0cnkubG9va3VwKF9jdXN0b21lciwgX3Byb2plY3RJZCk7CiAgICAgICAgLy8gbm90IGRlcGxveWVkIHlldAogICAgICAgIHJlcXVpcmUodCA9PSBhZGRyZXNzKDApKTsKCgogICAgICAgIFNpbmd1bGFyRFRWRnVuZCBmdW5kID0gbmV3IFNpbmd1bGFyRFRWRnVuZCgpOwogICAgICAgIFNpbmd1bGFyRFRWVG9rZW4gdG9rZW4gPSBuZXcgU2luZ3VsYXJEVFZUb2tlbihmdW5kLCBfd2FsbGV0LCBfbmFtZSwgX3N5bWJvbCwgX3RvdGFsU3VwcGx5KTsKICAgICAgICBmdW5kLnNldHVwKHRva2VuKTsKCiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoX2N1c3RvbWVyLCBfcHJvamVjdElkLCB0b2tlbiwgZnVuZCk7CgogICAgICAgIERlcGxveWVkVG9rZW4oX2N1c3RvbWVyLCBfcHJvamVjdElkLCB0b2tlbiwgZnVuZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVwbG95Q2FtcGFpZ24oCiAgICAgICAgYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3Byb2plY3RJZCwKICAgICAgICAvLyBTaW5ndWxhckRUVkxhdW5jaAogICAgICAgIGFkZHJlc3MgX3dvcmtzaG9wLCB1aW50IF90b3RhbCwgdWludCBfdW5pdFByaWNlLCB1aW50IF9kdXJhdGlvbiwgdWludCBfdGhyZXNob2xkLCB1aW50IF9uZXR3b3JrRmVlCiAgICApCiAgICAgICAgb25seU93bmVyKCkKICAgIHsKICAgICAgICB2YXIgKHQsZixjKSA9IHJlZ2lzdHJ5Lmxvb2t1cChfY3VzdG9tZXIsIF9wcm9qZWN0SWQpOwogICAgICAgIC8vIG5vdCBkZXBsb3llZCB5ZXQKICAgICAgICByZXF1aXJlKGMgPT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIHBheWVkIGZvciwgdG9rZW4gJiBmdW5kIGRlcGxveWVkCiAgICAgICAgcmVxdWlyZSh0ICE9IGFkZHJlc3MoMCkgJiYgZiAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgU2luZ3VsYXJEVFZMYXVuY2ggY2FtcGFpZ24gPSBuZXcgU2luZ3VsYXJEVFZMYXVuY2godCwgX3dvcmtzaG9wLCBfY3VzdG9tZXIsIF90b3RhbCwgX3VuaXRQcmljZSwgX2R1cmF0aW9uLCBfdGhyZXNob2xkLCBfbmV0d29ya0ZlZSk7CgogICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKF9jdXN0b21lciwgX3Byb2plY3RJZCwgY2FtcGFpZ24pOwoKICAgICAgICBEZXBsb3llZENhbXBhaWduKF9jdXN0b21lciwgX3Byb2plY3RJZCwgY2FtcGFpZ24pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFJlZ2lzdHJ5Q29udHJhY3QoYWRkcmVzcyBfcmVnaXN0cnkpCiAgICAgICAgb25seU93bmVyKCkKICAgIHsKICAgICAgICByZWdpc3RyeSA9IFRva2l0UmVnaXN0cnkoX3JlZ2lzdHJ5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQYXltZW50Q29udHJhY3QodWludDggX3BheW1lbnRUeXBlLCBhZGRyZXNzIF9wYXltZW50Q29udHJhY3QpCiAgICAgICAgb25seU93bmVyKCkKICAgIHsKICAgICAgICBwYXltZW50Q29udHJhY3RzW19wYXltZW50VHlwZV0gPSBBYnN0cmFjdFBheW1lbnRFc2Nyb3coX3BheW1lbnRDb250cmFjdCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsZXRlUGF5bWVudENvbnRyYWN0KHVpbnQ4IF9wYXltZW50VHlwZSkKICAgICAgICBvbmx5T3duZXIoKQogICAgewogICAgICAgIGRlbGV0ZSBwYXltZW50Q29udHJhY3RzW19wYXltZW50VHlwZV07CiAgICB9Cn0='.
	

]
