Class {
	#name : #SRT56e30b617c8b4798955b6be6fec706de91352ed0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT56e30b617c8b4798955b6be6fec706de91352ed0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgSVNUUmVnaXN0cmFyIHsKCiAgIC8qKgogICAgKiBAZGV2IENyZWF0ZXMgYSBuZXcgU2VjdXJpdHkgVG9rZW4gYW5kIHNhdmVzIGl0IHRvIHRoZSByZWdpc3RyeQogICAgKiBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICogQHBhcmFtIF90aWNrZXIgVGlja2VyIG5hbWUgb2YgdGhlIHNlY3VyaXR5CiAgICAqIEBwYXJhbSBfdG90YWxTdXBwbHkgVG90YWwgYW1vdW50IG9mIHRva2VucyBiZWluZyBjcmVhdGVkCiAgICAqIEBwYXJhbSBfb3duZXIgRXRoZXJldW0gcHVibGljIGtleSBhZGRyZXNzIG9mIHRoZSBzZWN1cml0eSB0b2tlbiBvd25lcgogICAgKiBAcGFyYW0gX21heFBvbHkgQW1vdW50IG9mIG1heGltdW0gcG9seSBpc3N1ZXIgd2FudCB0byByYWlzZQogICAgKiBAcGFyYW0gX2hvc3QgVGhlIGhvc3Qgb2YgdGhlIHNlY3VyaXR5IHRva2VuIHdpemFyZAogICAgKiBAcGFyYW0gX2ZlZSBGZWUgYmVpbmcgcmVxdWVzdGVkIGJ5IHRoZSB3aXphcmQgaG9zdAogICAgKiBAcGFyYW0gX3R5cGUgVHlwZSBvZiBzZWN1cml0eSBiZWluZyB0b2tlbml6ZWQKICAgICogQHBhcmFtIF9sb2NrdXBQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgcmFpc2VkIFBPTFkgd2lsbCBiZSBsb2NrZWQgdXAgZm9yIGRpc3B1dGUKICAgICogQHBhcmFtIF9xdW9ydW0gUGVyY2VudCBvZiBpbml0aWFsIGludmVzdG9ycyByZXF1aXJlZCB0byBmcmVlemUgUE9MWSByYWlzZQogICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVNlY3VyaXR5VG9rZW4gKAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX3RpY2tlciwKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseSwKICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludDI1NiBfbWF4UG9seSwKICAgICAgICBhZGRyZXNzIF9ob3N0LAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50OCBfdHlwZSwKICAgICAgICB1aW50MjU2IF9sb2NrdXBQZXJpb2QsCiAgICAgICAgdWludDggX3F1b3J1bQogICAgKSBleHRlcm5hbDsKCn0KCi8vLyBFUkMgVG9rZW4gU3RhbmRhcmQgIzIwIEludGVyZmFjZSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQpCmludGVyZmFjZSBJRVJDMjAgewogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCi8qKgogKiAgU2FmZU1hdGggPGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL21hdGgvU2FmZU1hdGguc29sLz4KICogIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoTUlUKQogKi8KCi8vLyBAdGl0bGUgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICAgICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQp9CgppbnRlcmZhY2UgSUN1c3RvbWVycyB7CgogIC8qKgogICAqIEBkZXYgQWxsb3cgbmV3IHByb3ZpZGVyIGFwcGxpY2F0aW9ucwogICAqIEBwYXJhbSBfcHJvdmlkZXJBZGRyZXNzIFRoZSBwcm92aWRlcidzIHB1YmxpYyBrZXkgYWRkcmVzcwogICAqIEBwYXJhbSBfbmFtZSBUaGUgcHJvdmlkZXIncyBuYW1lCiAgICogQHBhcmFtIF9kZXRhaWxzIEEgU0hBMjU2IGhhc2ggb2YgdGhlIG5ldyBwcm92aWRlcnMgZGV0YWlscwogICAqIEBwYXJhbSBfZmVlIFRoZSBmZWUgY2hhcmdlZCBmb3IgY3VzdG9tZXIgdmVyaWZpY2F0aW9uCiAgICovCiAgZnVuY3Rpb24gbmV3UHJvdmlkZXIoYWRkcmVzcyBfcHJvdmlkZXJBZGRyZXNzLCBzdHJpbmcgX25hbWUsIGJ5dGVzMzIgX2RldGFpbHMsIHVpbnQyNTYgX2ZlZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogIC8qKgogICAqIEBkZXYgQ2hhbmdlIGEgcHJvdmlkZXJzIGZlZQogICAqIEBwYXJhbSBfbmV3RmVlIFRoZSBuZXcgZmVlIG9mIHRoZSBwcm92aWRlcgogICAqLwogIGZ1bmN0aW9uIGNoYW5nZUZlZSh1aW50MjU2IF9uZXdGZWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAvKioKICAgKiBAZGV2IFZlcmlmeSBhbiBpbnZlc3RvcgogICAqIEBwYXJhbSBfY3VzdG9tZXIgVGhlIGN1c3RvbWVyJ3MgcHVibGljIGtleSBhZGRyZXNzCiAgICogQHBhcmFtIF9jb3VudHJ5SnVyaXNkaWN0aW9uIFRoZSBjb3VudHJ5IHVyaXNkaWN0aW9uIGNvZGUgb2YgdGhlIGN1c3RvbWVyCiAgICogQHBhcmFtIF9kaXZpc2lvbkp1cmlzZGljdGlvbiBUaGUgc3ViZGl2aXNpb24ganVyaXNkaWN0aW9uIGNvZGUgb2YgdGhlIGN1c3RvbWVyCiAgICogQHBhcmFtIF9yb2xlIFRoZSB0eXBlIG9mIGN1c3RvbWVyIC0gaW52ZXN0b3I6MSwgZGVsZWdhdGU6MiwgaXNzdWVyOjMsIG1hcmtldG1ha2VyOjQsIGV0Yy4KICAgKiBAcGFyYW0gX2FjY3JlZGl0ZWQgV2hldGhlciB0aGUgY3VzdG9tZXIgaXMgYWNjcmVkaXRlZCBvciBub3QgKG9ubHkgYXBwbGllZCB0byBpbnZlc3RvcnMpCiAgICogQHBhcmFtIF9leHBpcmVzIFRoZSB0aW1lIHRoZSB2ZXJpZmljYXRpb24gZXhwaXJlcwogICAqLwogIGZ1bmN0aW9uIHZlcmlmeUN1c3RvbWVyKAogICAgYWRkcmVzcyBfY3VzdG9tZXIsCiAgICBieXRlczMyIF9jb3VudHJ5SnVyaXNkaWN0aW9uLAogICAgYnl0ZXMzMiBfZGl2aXNpb25KdXJpc2RpY3Rpb24sCiAgICB1aW50OCBfcm9sZSwKICAgIGJvb2wgX2FjY3JlZGl0ZWQsCiAgICB1aW50MjU2IF9leHBpcmVzCiAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBHRVQgRnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8KCiAgLyoqCiAgICAqIEBkZXYgR2V0IGN1c3RvbWVyIGF0dGVzdGF0aW9uIGRhdGEgYnkgS1lDIHByb3ZpZGVyIGFuZCBjdXN0b21lciBldGhlcmV1bSBhZGRyZXNzCiAgICAqIEBwYXJhbSBfcHJvdmlkZXIgQWRkcmVzcyBvZiB0aGUgS1lDIHByb3ZpZGVyLgogICAgKiBAcGFyYW0gX2N1c3RvbWVyIEFkZHJlc3Mgb2YgdGhlIGN1c3RvbWVyIGV0aGVyZXVtIGFkZHJlc3MKICAgICovCiAgZnVuY3Rpb24gZ2V0Q3VzdG9tZXIoYWRkcmVzcyBfcHJvdmlkZXIsIGFkZHJlc3MgX2N1c3RvbWVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICBieXRlczMyLAogICAgYnl0ZXMzMiwKICAgIGJvb2wsCiAgICB1aW50OCwKICAgIGJvb2wsCiAgICB1aW50MjU2CiAgKTsKCiAgLyoqCiAgICogR2V0IHByb3ZpZGVyIGRldGFpbHMgYW5kIGZlZSBieSBldGhlcmV1bSBhZGRyZXNzCiAgICogQHBhcmFtIF9wcm92aWRlckFkZHJlc3MgQWRkcmVzcyBvZiB0aGUgS1lDIHByb3ZpZGVyCiAgICovCiAgZnVuY3Rpb24gZ2V0UHJvdmlkZXIoYWRkcmVzcyBfcHJvdmlkZXJBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICBzdHJpbmcgbmFtZSwKICAgIHVpbnQyNTYgam9pbmVkLAogICAgYnl0ZXMzMiBkZXRhaWxzLAogICAgdWludDI1NiBmZWUKICApOwp9CgovKgogIFBvbHltYXRoIGNvbXBsaWFuY2UgcHJvdG9jb2wgaXMgaW50ZW5kZWQgdG8gZW5zdXJlIHJlZ3VsYXRvcnkgY29tcGxpYW5jZQogIGluIHRoZSBqdXJpc2RpY3Rpb25zIHRoYXQgc2VjdXJpdHkgdG9rZW5zIGFyZSBiZWluZyBvZmZlcmVkIGluLiBUaGUgY29tcGxpYW5jZQogIHByb3RvY29sIGFsbG93cyBzZWN1cml0eSB0b2tlbnMgcmVtYWluIGludGVyb3BlcmFibGUgc28gdGhhdCBhbnlvbmUgY2FuCiAgYnVpbGQgb24gdG9wIG9mIHRoZSBQb2x5bWF0aCBwbGF0Zm9ybSBhbmQgZXh0ZW5kIGl0J3MgZnVuY3Rpb25hbGl0eS4KKi8KCmludGVyZmFjZSBJQ29tcGxpYW5jZSB7CgogICAgLyoqCiAgICAgKiBAZGV2IGBzZXRSZWdzaXRyYXJBZGRyZXNzYCBUaGlzIGZ1bmN0aW9uIHNldCB0aGUgU2VjdXJpdHlUb2tlblJlZ2lzdHJhciBjb250cmFjdCBhZGRyZXNzLiAKICAgICAqIEBwYXJhbSBfU1RSZWdpc3RyYXIgSXQgaXMgdGhlIGB0aGlzYCByZWZlcmVuY2Ugb2YgU1RSIGNvbnRyYWN0CiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwoKICAgIGZ1bmN0aW9uIHNldFJlZ3NpdHJhckFkZHJlc3MoYWRkcmVzcyBfU1RSZWdpc3RyYXIpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IGBjcmVhdGVUZW1wbGF0ZWAgaXMgYSBzaW1wbGUgZnVuY3Rpb24gdG8gY3JlYXRlIGEgbmV3IGNvbXBsaWFuY2UgdGVtcGxhdGUKICAgICAqIEBwYXJhbSBfb2ZmZXJpbmdUeXBlIFRoZSBuYW1lIG9mIHRoZSBzZWN1cml0eSBiZWluZyBpc3N1ZWQKICAgICAqIEBwYXJhbSBfaXNzdWVySnVyaXNkaWN0aW9uIFRoZSBqdXJpc2RpY3Rpb24gaWQgb2YgdGhlIGlzc3VlcgogICAgICogQHBhcmFtIF9hY2NyZWRpdGVkIEFjY3JlZGl0YXRpb24gc3RhdHVzIHJlcXVpcmVkIGZvciBpbnZlc3RvcnMKICAgICAqIEBwYXJhbSBfS1lDIEtZQyBwcm92aWRlciB1c2VkIGJ5IHRoZSB0ZW1wbGF0ZQogICAgICogQHBhcmFtIF9kZXRhaWxzIERldGFpbHMgb2YgdGhlIG9mZmVyaW5nIHJlcXVpcmVtZW50cwogICAgICogQHBhcmFtIF9leHBpcmVzIFRpbWVzdGFtcCBvZiB3aGVuIHRoZSB0ZW1wbGF0ZSB3aWxsIGV4cGlyZQogICAgICogQHBhcmFtIF9mZWUgQW1vdW50IG9mIFBPTFkgdG8gdXNlIHRoZSB0ZW1wbGF0ZSAoaGVsZCBpbiBlc2Nyb3cgdW50aWwgaXNzdWFuY2UpCiAgICAgKiBAcGFyYW0gX3F1b3J1bSBNaW5pbXVtIHBlcmNlbnQgb2Ygc2hhcmVob2xkZXJzIHdoaWNoIG5lZWQgdG8gdm90ZSB0byBmcmVlemUKICAgICAqIEBwYXJhbSBfdmVzdGluZ1BlcmlvZCBMZW5ndGggb2YgdGltZSB0byB2ZXN0IGZ1bmRzIAogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUZW1wbGF0ZSgKICAgICAgICBzdHJpbmcgX29mZmVyaW5nVHlwZSwKICAgICAgICBieXRlczMyIF9pc3N1ZXJKdXJpc2RpY3Rpb24sCiAgICAgICAgYm9vbCBfYWNjcmVkaXRlZCwKICAgICAgICBhZGRyZXNzIF9LWUMsCiAgICAgICAgYnl0ZXMzMiBfZGV0YWlscywKICAgICAgICB1aW50MjU2IF9leHBpcmVzLAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50OCBfcXVvcnVtLAogICAgICAgIHVpbnQyNTYgX3Zlc3RpbmdQZXJpb2QKICAgICkgcHVibGljOwoKICAgLyoqCiAgICAgKiBAZGV2IFByb3Bvc2UgYSBiaWQgZm9yIGEgc2VjdXJpdHkgdG9rZW4gaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlIFRoZSB1bmlxdWUgdGVtcGxhdGUgYWRkcmVzcwogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VUZW1wbGF0ZSgKICAgICAgICBhZGRyZXNzIF9zZWN1cml0eVRva2VuLAogICAgICAgIGFkZHJlc3MgX3RlbXBsYXRlCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBQcm9wb3NlIGEgU2VjdXJpdHkgVG9rZW4gT2ZmZXJpbmcgQ29udHJhY3QgZm9yIGFuIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW4gVGhlIHNlY3VyaXR5IHRva2VuIGJlaW5nIGJpZCBvbgogICAgICogQHBhcmFtIF9zdG9Db250cmFjdCBUaGUgc2VjdXJpdHkgdG9rZW4gb2ZmZXJpbmcgY29udHJhY3QgYWRkcmVzcwogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VPZmZlcmluZ0NvbnRyYWN0KAogICAgICAgIGFkZHJlc3MgX3NlY3VyaXR5VG9rZW4sCiAgICAgICAgYWRkcmVzcyBfc3RvQ29udHJhY3QKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IENhbmNlbCBhIFRlbXBsYXRlIHByb3Bvc2FsIGlmIHRoZSBiaWQgaGFzbid0IGJlZW4gYWNjZXB0ZWQKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlUHJvcG9zYWxJbmRleCBUaGUgdGVtcGxhdGUgcHJvcG9zYWwgYXJyYXkgaW5kZXgKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzIAogICAgICovCiAgICBmdW5jdGlvbiBjYW5jZWxUZW1wbGF0ZVByb3Bvc2FsKAogICAgICAgIGFkZHJlc3MgX3NlY3VyaXR5VG9rZW4sCiAgICAgICAgdWludDI1NiBfdGVtcGxhdGVQcm9wb3NhbEluZGV4CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBTZXQgdGhlIFNUTyBjb250cmFjdCBieSB0aGUgaXNzdWVyLgogICAgICogQHBhcmFtIF9TVE9BZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIFNUTyBjb250cmFjdCBkZXBsb3llZCBvdmVyIHRoZSBuZXR3b3JrLgogICAgICogQHBhcmFtIF9mZWUgZmVlIHRvIGJlIHBhaWQgaW4gcG9seSB0byB1c2UgdGhhdCBjb250cmFjdAogICAgICogQHBhcmFtIF92ZXN0aW5nUGVyaW9kIG5vLiBvZiBkYXlzIGludmVzdG9yIGJpbmRlZCB0byBob2xkIHRoZSBTZWN1cml0eSB0b2tlbgogICAgICogQHBhcmFtIF9xdW9ydW0gTWluaW11bSBwZXJjZW50IG9mIHNoYXJlaG9sZGVycyB3aGljaCBuZWVkIHRvIHZvdGUgdG8gZnJlZXplCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFNUTyAoCiAgICAgICAgYWRkcmVzcyBfU1RPQWRkcmVzcywKICAgICAgICB1aW50MjU2IF9mZWUsCiAgICAgICAgdWludDI1NiBfdmVzdGluZ1BlcmlvZCwKICAgICAgICB1aW50OCBfcXVvcnVtCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBDYW5jZWwgYSBTVE8gY29udHJhY3QgcHJvcG9zYWwgaWYgdGhlIGJpZCBoYXNuJ3QgYmVlbiBhY2NlcHRlZAogICAgICogQHBhcmFtIF9zZWN1cml0eVRva2VuIFRoZSBzZWN1cml0eSB0b2tlbiBiZWluZyBiaWQgb24KICAgICAqIEBwYXJhbSBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4IFRoZSBvZmZlcmluZyBwcm9wb3NhbCBhcnJheSBpbmRleAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbmNlbE9mZmVyaW5nUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfc2VjdXJpdHlUb2tlbiwKICAgICAgICB1aW50MjU2IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IGB1cGRhdGVUZW1wbGF0ZVJlcHV0YXRpb25gIGlzIGEgY29uc3RhbnQgZnVuY3Rpb24gdGhhdCB1cGRhdGVzIHRoZQogICAgICAgaGlzdG9yeSBvZiBhIHNlY3VyaXR5IHRva2VuIHRlbXBsYXRlIHVzYWdlIHRvIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdXNlcwogICAgICogQHBhcmFtIF90ZW1wbGF0ZSBUaGUgdW5pcXVlIHRlbXBsYXRlIGlkCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlSW5kZXggVGhlIGFycmF5IGluZGV4IG9mIHRoZSB0ZW1wbGF0ZSBwcm9wb3NhbCAKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlVGVtcGxhdGVSZXB1dGF0aW9uIChhZGRyZXNzIF90ZW1wbGF0ZSwgdWludDggX3RlbXBsYXRlSW5kZXgpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IGB1cGRhdGVPZmZlcmluZ1JlcHV0YXRpb25gIGlzIGEgY29uc3RhbnQgZnVuY3Rpb24gdGhhdCB1cGRhdGVzIHRoZQogICAgICAgaGlzdG9yeSBvZiBhIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIGNvbnRyYWN0IHRvIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdXNlcwogICAgICogQHBhcmFtIF9zdG9Db250cmFjdCBUaGUgc21hcnQgY29udHJhY3QgYWRkcmVzcyBvZiB0aGUgU1RPIGNvbnRyYWN0CiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIHByb3Bvc2FsIAogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVPZmZlcmluZ1JlcHV0YXRpb24gKGFkZHJlc3MgX3N0b0NvbnRyYWN0LCB1aW50OCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBHZXQgdGVtcGxhdGUgZGV0YWlscyBieSB0aGUgcHJvcG9zYWwgaW5kZXgKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbkFkZHJlc3MgVGhlIHNlY3VyaXR5IHRva2VuIGV0aGVyZXVtIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfdGVtcGxhdGVJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIHRlbXBsYXRlIGJlaW5nIGNoZWNrZWQKICAgICAqIEByZXR1cm4gVGVtcGxhdGUgc3RydWN0IAogICAgICovCiAgICBmdW5jdGlvbiBnZXRUZW1wbGF0ZUJ5UHJvcG9zYWwoYWRkcmVzcyBfc2VjdXJpdHlUb2tlbkFkZHJlc3MsIHVpbnQ4IF90ZW1wbGF0ZUluZGV4KSB2aWV3IHB1YmxpYyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIF90ZW1wbGF0ZQogICAgKTsKCiAgICAvKiogCiAgICAgKiBAZGV2IEdldCBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBzbWFydCBjb250cmFjdCBkZXRhaWxzIGJ5IHRoZSBwcm9wb3NhbCBpbmRleAogICAgICogQHBhcmFtIF9zZWN1cml0eVRva2VuQWRkcmVzcyBUaGUgc2VjdXJpdHkgdG9rZW4gZXRoZXJldW0gYWRkcmVzcwogICAgICogQHBhcmFtIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXggVGhlIGFycmF5IGluZGV4IG9mIHRoZSBTVE8gY29udHJhY3QgYmVpbmcgY2hlY2tlZAogICAgICogQHJldHVybiBDb250cmFjdCBzdHJ1Y3QgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE9mZmVyaW5nQnlQcm9wb3NhbChhZGRyZXNzIF9zZWN1cml0eVRva2VuQWRkcmVzcywgdWludDggX29mZmVyaW5nUHJvcG9zYWxJbmRleCkgdmlldyBwdWJsaWMgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBzdG9Db250cmFjdCwKICAgICAgICBhZGRyZXNzIGF1ZGl0b3IsCiAgICAgICAgdWludDI1NiB2ZXN0aW5nUGVyaW9kLAogICAgICAgIHVpbnQ4IHF1b3J1bSwKICAgICAgICB1aW50MjU2IGZlZQogICAgKTsKfQoKaW50ZXJmYWNlIElUZW1wbGF0ZSB7CgogIC8qKgogICAqIEBkZXYgYGFkZEp1cmlzZGljdGlvbmAgYWxsb3dzIHRoZSBhZGRpbmcgb2YgbmV3IGp1cmlzZGljdGlvbnMgdG8gYSB0ZW1wbGF0ZQogICAqIEBwYXJhbSBfYWxsb3dlZEp1cmlzZGljdGlvbnMgQW4gYXJyYXkgb2YganVyaXNkaWN0aW9ucwogICAqIEBwYXJhbSBfYWxsb3dlZCBBbiBhcnJheSBvZiB3aGV0aGVyIHRoZSBqdXJpc2RpY3Rpb24gaXMgYWxsb3dlZCB0byBwdXJjaGFzZSB0aGUgc2VjdXJpdHkgb3Igbm90CiAgICovCiAgZnVuY3Rpb24gYWRkSnVyaXNkaWN0aW9uKGJ5dGVzMzJbXSBfYWxsb3dlZEp1cmlzZGljdGlvbnMsIGJvb2xbXSBfYWxsb3dlZCkgcHVibGljOwoKICAvKioKICAgKiBAZGV2IGBhZGREaXZpc2lvbkp1cmlzZGljdGlvbmAgYWxsb3dzIHRoZSBhZGRpbmcgb2YgbmV3IGp1cmlzZGljdGlvbnMgdG8gYSB0ZW1wbGF0ZQogICAqIEBwYXJhbSBfYmxvY2tlZERpdmlzaW9uSnVyaXNkaWN0aW9ucyBBbiBhcnJheSBvZiBqdXJpc2RpY3Rpb25zCiAgICogQHBhcmFtIF9ibG9ja2VkIEFuIGFycmF5IG9mIHdoZXRoZXIgdGhlIGp1cmlzZGljdGlvbiBpcyBhbGxvd2VkIHRvIHB1cmNoYXNlIHRoZSBzZWN1cml0eSBvciBub3QKICAgKi8KICBmdW5jdGlvbiBhZGREaXZpc2lvbkp1cmlzZGljdGlvbihieXRlczMyW10gX2Jsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnMsIGJvb2xbXSBfYmxvY2tlZCkgcHVibGljOwoKICAvKioKICAgKiBAZGV2IGBhZGRSb2xlYCBhbGxvd3MgdGhlIGFkZGluZyBvZiBuZXcgcm9sZXMgdG8gYmUgYWRkZWQgdG8gd2hpdGVsaXN0CiAgICogQHBhcmFtIF9hbGxvd2VkUm9sZXMgVXNlciByb2xlcyB0aGF0IGNhbiBwdXJjaGFzZSB0aGUgc2VjdXJpdHkKICAgKi8KICBmdW5jdGlvbiBhZGRSb2xlcyh1aW50OFtdIF9hbGxvd2VkUm9sZXMpIHB1YmxpYzsKCiAgLyoqCiAgICogQG5vdGljZSBgdXBkYXRlRGV0YWlsc2AKICAgKiBAcGFyYW0gX2RldGFpbHMgZGV0YWlscyBvZiB0aGUgdGVtcGxhdGUgbmVlZCB0byBjaGFuZ2UKICAgKiBAcmV0dXJuIGFsbG93ZWQgYm9vbGVhbiB2YXJpYWJsZQogICAqLwogIGZ1bmN0aW9uIHVwZGF0ZURldGFpbHMoYnl0ZXMzMiBfZGV0YWlscykgcHVibGljIHJldHVybnMgKGJvb2wgYWxsb3dlZCk7CgogIC8qKgogICAqIEBkZXYgYGZpbmFsaXplVGVtcGxhdGVgIGlzIHVzZWQgdG8gZmluYWxpemUgdGVtcGxhdGUuZnVsbCBjb21wbGlhbmNlIHByb2Nlc3MvcmVxdWlyZW1lbnRzCiAgICogQHJldHVybiBzdWNjZXNzCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemVUZW1wbGF0ZSgpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAvKioKICAgKiBAZGV2IGBjaGVja1RlbXBsYXRlUmVxdWlyZW1lbnRzYCBpcyBhIGNvbnN0YW50IGZ1bmN0aW9uIHRoYXQgY2hlY2tzIGlmIHRlbXBsYXRlcyByZXF1aXJlbWVudHMgYXJlIG1ldAogICAqIEBwYXJhbSBfY291bnRyeUp1cmlzZGljdGlvbiBUaGUgSVNPLTMxNjYgY29kZSBvZiB0aGUgaW52ZXN0b3JzIGNvdW50cnkganVyaXNkaWN0aW9uCiAgICogQHBhcmFtIF9kaXZpc2lvbkp1cmlzZGljdGlvbiBUaGUgSVNPLTMxNjYgY29kZSBvZiB0aGUgaW52ZXN0b3JzIHN1YmRpdmlzaW9uIGp1cmlzZGljdGlvbgogICAqIEBwYXJhbSBfYWNjcmVkaXRlZCBXaGV0aGVyIHRoZSBpbnZlc3RvciBpcyBhY2NyZWRpdGVkIG9yIG5vdAogICAqIEBwYXJhbSBfcm9sZSByb2xlIG9mIHRoZSB1c2VyCiAgICogQHJldHVybiBhbGxvd2VkIGJvb2xlYW4gdmFyaWFibGUKICAgKi8KICBmdW5jdGlvbiBjaGVja1RlbXBsYXRlUmVxdWlyZW1lbnRzKAogICAgICBieXRlczMyIF9jb3VudHJ5SnVyaXNkaWN0aW9uLAogICAgICBieXRlczMyIF9kaXZpc2lvbkp1cmlzZGljdGlvbiwKICAgICAgYm9vbCBfYWNjcmVkaXRlZCwKICAgICAgdWludDggX3JvbGUKICApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGFsbG93ZWQpOwoKICAvKioKICAgKiBAZGV2IGdldFRlbXBsYXRlRGV0YWlscyBpcyBhIGNvbnN0YW50IGZ1bmN0aW9uIHRoYXQgZ2V0cyB0ZW1wbGF0ZSBkZXRhaWxzCiAgICogQHJldHVybiBieXRlczMyIGRldGFpbHMsIGJvb2wgZmluYWxpemVkCiAgICovCiAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVEZXRhaWxzKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMiwgYm9vbCk7CgogIC8qKgogICAqIEBkZXYgYGdldFVzYWdlRmVlc2AgaXMgYSBmdW5jdGlvbiB0byBnZXQgYWxsIHRoZSBkZXRhaWxzIG9uIHRlbXBsYXRlIHVzYWdlIGZlZXMKICAgKiBAcmV0dXJuIHVpbnQyNTYgZmVlLCB1aW50OCBxdW9ydW0sIHVpbnQyNTYgdmVzdGluZ1BlcmlvZCwgYWRkcmVzcyBvd25lciwgYWRkcmVzcyBLWUMKICAgKi8KICBmdW5jdGlvbiBnZXRVc2FnZURldGFpbHMoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2LCB1aW50OCwgdWludDI1NiwgYWRkcmVzcywgYWRkcmVzcyk7Cn0KCmNvbnRyYWN0IFNUTzIwIHsKCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAgIC8qKiAKICAgICAqIEBkZXYgSW5pdGlhbGl6ZXMgdGhlIFNUTyB3aXRoIGNlcnRhaW4gcGFyYW1zCiAgICAgKiBAZGV2IF90b2tlbkFkZHJlc3MgQWRkcmVzcyBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICAqIEBwYXJhbSBfc3RhcnRUaW1lIEdpdmVuIGluIFVOSVggdGltZSB0aGlzIGlzIHRoZSB0aW1lIHRoYXQgdGhlIG9mZmVyaW5nIHdpbGwgYmVnaW4KICAgICAqIEBwYXJhbSBfZW5kVGltZSBHaXZlbiBpbiBVTklYIHRpbWUgdGhpcyBpcyB0aGUgdGltZSB0aGF0IHRoZSBvZmZlcmluZyB3aWxsIGVuZCAKICAgICAqLwogICAgZnVuY3Rpb24gc2VjdXJpdHlUb2tlbk9mZmVyaW5nKAogICAgICAgIGFkZHJlc3MgX3Rva2VuQWRkcmVzcywKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsCiAgICAgICAgdWludDI1NiBfZW5kVGltZQogICAgKSBleHRlcm5hbCA7Cgp9CgovKioKICogQHRpdGxlIFNlY3VyaXR5VG9rZW4KICogQGRldiBDb250cmFjdCAoQSBCbHVlcHJpbnQpIHRoYXQgY29udGFpbnMgdGhlIGZ1bmN0aW9uYWxpdGllcyBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICovCgpjb250cmFjdCBTZWN1cml0eVRva2VuIGlzIElFUkMyMCB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgc3RyaW5nIHB1YmxpYyBWRVJTSU9OID0gIjEiOwoKICAgIElFUkMyMCBwdWJsaWMgUE9MWTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluc3RhbmNlIG9mIHRoZSBQT0xZIHRva2VuIGNvbnRyYWN0CgogICAgSUNvbXBsaWFuY2UgcHVibGljIFBvbHlDb21wbGlhbmNlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFuY2Ugb2YgdGhlIENvbXBsaWFuY2UgY29udHJhY3QKCiAgICBJVGVtcGxhdGUgcHVibGljIFRlbXBsYXRlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0YW5jZSBvZiB0aGUgVGVtcGxhdGUgY29udHJhY3QKCiAgICBJQ3VzdG9tZXJzIHB1YmxpYyBQb2x5Q3VzdG9tZXJzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0YW5jZSBvZiB0aGUgQ3VzdG9tZXJzIGNvbnRyYWN0CgogICAgU1RPMjAgcHVibGljIFNUTzsKCiAgICAvLyBFUkMyMCBGaWVsZHMKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWUgb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWNpbWFscyBmb3IgdGhlIHNlY3VyaXR5IHRva2VuIGl0IHNob3VsZCBiZSAwIGFzIHN0YW5kYXJkCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTeW1ib2wgb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBvd25lciBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvdGFsIG51bWJlciBvZiBzZWN1cml0eSB0b2tlbiBnZW5lcmF0ZWQKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7ICAgICAgICAgIC8vIE1hcHBpbmcgYXMgc2FtZSBhcyBpbiBFUkMyMCB0b2tlbgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXJyYXkgdXNlZCB0byBzdG9yZSB0aGUgYmFsYW5jZXMgb2YgdGhlIHNlY3VyaXR5IHRva2VuIGhvbGRlcnMKCiAgICAvLyBUZW1wbGF0ZQogICAgYWRkcmVzcyBwdWJsaWMgZGVsZWdhdGU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyB3aG8gY3JlYXRlIHRoZSB0ZW1wbGF0ZQogICAgYnl0ZXMzMiBwdWJsaWMgbWVya2xlUm9vdDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8KICAgIGFkZHJlc3MgcHVibGljIEtZQzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIEtZQyBwcm92aWRlciB3aGljaCBhbG9vd2VkIHRoZSByb2xlcyBhbmQganVyaXNkaWN0aW9ucyBpbiB0aGUgdGVtcGxhdGUKCiAgICAvLyBTZWN1cml0eSB0b2tlbiBzaGFyZWhvbGRlcnMKICAgIHN0cnVjdCBTaGFyZWhvbGRlciB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIHRoZSBkYXRhIG9mIHRoZSBzaGFyZWhvbGRlcnMKICAgICAgICBhZGRyZXNzIHZlcmlmaWVyOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZlcmlmaWVyIC0gYWRkcmVzcyBvZiB0aGUgS1lDIG9yYWNsZQogICAgICAgIGJvb2wgYWxsb3dlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxsb3dlZCAtIHdoZXRoZXIgdGhlIHNoYXJlaG9sZGVyIGlzIGFsbG93ZWQgdG8gdHJhbnNmZXIgb3IgcmVjaWV2ZSB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICAgICB1aW50OCByb2xlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJvbGUgLSByb2xlIG9mIHRoZSBzaGFyZWhvbGRlciB7MSwyLDMsNH0KICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gU2hhcmVob2xkZXIpIHB1YmxpYyBzaGFyZWhvbGRlcnM7ICAgICAgICAgICAgICAvLyBNYXBwaW5nIHRoYXQgaG9sZHMgdGhlIGRhdGEgb2YgdGhlIHNoYXJlaG9sZGVyIGNvcnJlc3BvbmRpbmcgdG8gaW52ZXN0b3IgYWRkcmVzcwoKICAgIC8vIFNUTwogICAgYm9vbCBwdWJsaWMgaXNTVE9Qcm9wb3NlZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgaGFzT2ZmZXJpbmdTdGFydGVkID0gZmFsc2U7CiAgICB1aW50MjU2IHB1YmxpYyBtYXhQb2x5OwoKICAgIC8vIFRoZSBzdGFydCBhbmQgZW5kIHRpbWUgb2YgdGhlIFNUTwogICAgdWludDI1NiBwdWJsaWMgc3RhcnRTVE87ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gU2VjdXJpdHkgVG9rZW4gT2ZmZXJpbmcgd2lsbCBiZSBzdGFydAogICAgdWludDI1NiBwdWJsaWMgZW5kU1RPOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gU2VjdXJpdHkgVG9rZW4gT2ZmZXJpbmcgY29udHJhY3Qgd2lsbCBlbmRzCgogICAgLy8gUE9MWSBhbGxvY2F0aW9ucwogICAgc3RydWN0IEFsbG9jYXRpb24geyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RydWN0dXJlIHRoYXQgY29udGFpbnMgdGhlIGFsbG9jYXRpb24gb2YgdGhlIFBPTFkgZm9yIHN0YWtlaG9sZGVycwogICAgICAgIHVpbnQyNTYgYW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3Rha2Vob2xkZXJzIC0gZGVsZWdhdGUsIGlzc3Vlcihvd25lciksIGF1ZGl0b3IKICAgICAgICB1aW50MjU2IHZlc3RpbmdQZXJpb2Q7CiAgICAgICAgdWludDggcXVvcnVtOwogICAgICAgIHVpbnQyNTYgeWF5Vm90ZXM7CiAgICAgICAgdWludDI1NiB5YXlQZXJjZW50OwogICAgICAgIGJvb2wgZnJvemVuOwogICAgfQogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIHZvdGVkOyAgICAgICAgICAgICAgIC8vIFZvdGluZyBtYXBwaW5nCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQWxsb2NhdGlvbikgcHVibGljIGFsbG9jYXRpb25zOyAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFwcGluZyB0aGF0IGNvbnRhaW5zIHRoZSBkYXRhIG9mIGFsbG9jYXRpb24gY29ycmVzcG9uZGluZyB0byBzdGFrZWhvbGRlciBhZGRyZXNzCgoJICAgLy8gU2VjdXJpdHkgVG9rZW4gT2ZmZXJpbmcgc3RhdGlzdGljcwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjb250cmlidXRlZFRvU1RPOyAgICAgICAgICAgICAgICAgICAgIC8vIE1hcHBpbmcgZm9yIHRyYWNraW5nIHRoZSBQT0xZIGNvbnRyaWJ1dGlvbiBieSB0aGUgY29udHJpYnV0b3IKICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc0lzc3VlZEJ5U1RPID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZsYWcgdmFyaWFibGUgdG8gdHJhY2sgdGhlIHNlY3VyaXR5IHRva2VuIGlzc3VlZCBieSB0aGUgb2ZmZXJpbmcgY29udHJhY3QKCiAgICAvLyBOb3RpZmljYXRpb25zCiAgICBldmVudCBMb2dUZW1wbGF0ZVNldChhZGRyZXNzIGluZGV4ZWQgX2RlbGVnYXRlQWRkcmVzcywgYWRkcmVzcyBfdGVtcGxhdGUsIGFkZHJlc3MgaW5kZXhlZCBfS1lDKTsKICAgIGV2ZW50IExvZ1VwZGF0ZWRDb21wbGlhbmNlUHJvb2YoYnl0ZXMzMiBfbWVya2xlUm9vdCwgYnl0ZXMzMiBfY29tcGxpYW5jZVByb29mSGFzaCk7CiAgICBldmVudCBMb2dTZXRTVE9Db250cmFjdChhZGRyZXNzIF9TVE8sIGFkZHJlc3MgaW5kZXhlZCBfU1RPdGVtcGxhdGUsIGFkZHJlc3MgaW5kZXhlZCBfYXVkaXRvciwgdWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lKTsKICAgIGV2ZW50IExvZ05ld1doaXRlbGlzdGVkQWRkcmVzcyhhZGRyZXNzIF9LWUMsIGFkZHJlc3MgX3NoYXJlaG9sZGVyLCB1aW50OCBfcm9sZSk7CiAgICBldmVudCBMb2dOZXdCbGFja2xpc3RlZEFkZHJlc3MoYWRkcmVzcyBfS1lDLCBhZGRyZXNzIF9zaGFyZWhvbGRlcik7CiAgICBldmVudCBMb2dWb3RlVG9GcmVlemUoYWRkcmVzcyBfcmVjaXBpZW50LCB1aW50MjU2IF95YXlQZXJjZW50LCB1aW50OCBfcXVvcnVtLCBib29sIF9mcm96ZW4pOwogICAgZXZlbnQgTG9nVG9rZW5Jc3N1ZWQoYWRkcmVzcyBpbmRleGVkIF9jb250cmlidXRvciwgdWludDI1NiBfc3RBbW91bnQsIHVpbnQyNTYgX3BvbHlDb250cmlidXRlZCwgdWludDI1NiBfdGltZXN0YW1wKTsKCiAgICAvL01vZGlmaWVycwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seURlbGVnYXRlKCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gZGVsZWdhdGUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyT3JEZWxlZ2F0ZSgpIHsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IGRlbGVnYXRlIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNUTygpIHsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IGFkZHJlc3MoU1RPKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5U2hhcmVob2xkZXIoKSB7CiAgICAgICAgcmVxdWlyZSAoc2hhcmVob2xkZXJzW21zZy5zZW5kZXJdLmFsbG93ZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCBkZWZhdWx0IHNlY3VyaXR5IHRva2VuIHBhcmFtZXRlcnMKICAgICAqIEBwYXJhbSBfbmFtZSBOYW1lIG9mIHRoZSBzZWN1cml0eSB0b2tlbgogICAgICogQHBhcmFtIF90aWNrZXIgVGlja2VyIG5hbWUgb2YgdGhlIHNlY3VyaXR5CiAgICAgKiBAcGFyYW0gX3RvdGFsU3VwcGx5IFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYmVpbmcgY3JlYXRlZAogICAgICogQHBhcmFtIF9vd25lciBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBzZWN1cml0eSB0b2tlbiBvd25lcgogICAgICogQHBhcmFtIF9tYXhQb2x5IEFtb3VudCBvZiBtYXhpbXVtIHBvbHkgaXNzdWVyIHdhbnQgdG8gcmFpc2UKICAgICAqIEBwYXJhbSBfbG9ja3VwUGVyaW9kIExlbmd0aCBvZiB0aW1lIHJhaXNlZCBQT0xZIHdpbGwgYmUgbG9ja2VkIHVwIGZvciBkaXNwdXRlCiAgICAgKiBAcGFyYW0gX3F1b3J1bSBQZXJjZW50IG9mIGluaXRpYWwgaW52ZXN0b3JzIHJlcXVpcmVkIHRvIGZyZWV6ZSBQT0xZIHJhaXNlCiAgICAgKiBAcGFyYW0gX3BvbHlUb2tlbkFkZHJlc3MgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgUE9MWSB0b2tlbiBjb250cmFjdAogICAgICogQHBhcmFtIF9wb2x5Q3VzdG9tZXJzQWRkcmVzcyBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBQb2x5Q3VzdG9tZXJzIGNvbnRyYWN0CiAgICAgKiBAcGFyYW0gX3BvbHlDb21wbGlhbmNlQWRkcmVzcyBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBQb2x5Q29tcGxpYW5jZSBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBTZWN1cml0eVRva2VuKAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX3RpY2tlciwKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseSwKICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludDI1NiBfbWF4UG9seSwKICAgICAgICB1aW50MjU2IF9sb2NrdXBQZXJpb2QsCiAgICAgICAgdWludDggX3F1b3J1bSwKICAgICAgICBhZGRyZXNzIF9wb2x5VG9rZW5BZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3BvbHlDdXN0b21lcnNBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3BvbHlDb21wbGlhbmNlQWRkcmVzcwogICAgKSBwdWJsaWMKICAgIHsKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgc3ltYm9sID0gX3RpY2tlcjsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgICAgICBtYXhQb2x5ID0gX21heFBvbHk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBfdG90YWxTdXBwbHk7CiAgICAgICAgYmFsYW5jZXNbX293bmVyXSA9IF90b3RhbFN1cHBseTsKICAgICAgICBQT0xZID0gSUVSQzIwKF9wb2x5VG9rZW5BZGRyZXNzKTsKICAgICAgICBQb2x5Q3VzdG9tZXJzID0gSUN1c3RvbWVycyhfcG9seUN1c3RvbWVyc0FkZHJlc3MpOwogICAgICAgIFBvbHlDb21wbGlhbmNlID0gSUNvbXBsaWFuY2UoX3BvbHlDb21wbGlhbmNlQWRkcmVzcyk7CiAgICAgICAgYWxsb2NhdGlvbnNbb3duZXJdID0gQWxsb2NhdGlvbigwLCBfbG9ja3VwUGVyaW9kLCBfcXVvcnVtLCAwLCAwLCBmYWxzZSk7CiAgICAgICAgVHJhbnNmZXIoMHgwLCBfb3duZXIsIF90b3RhbFN1cHBseSk7CiAgICB9CgogICAgLyogZnVuY3Rpb24gaW5pdGlhbGlzZUJhbGFuY2VzKHVpbnQyNTYpICovCgogICAgLyoqCiAgICAgKiBAZGV2IGBzZWxlY3RUZW1wbGF0ZWAgU2VsZWN0IGEgcHJvcG9zZWQgdGVtcGxhdGUgZm9yIHRoZSBpc3N1YW5jZQogICAgICogQHBhcmFtIF90ZW1wbGF0ZUluZGV4IEFycmF5IGluZGV4IG9mIHRoZSBkZWxlZ2F0ZXMgcHJvcG9zZWQgdGVtcGxhdGUKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbGVjdFRlbXBsYXRlKHVpbnQ4IF90ZW1wbGF0ZUluZGV4KSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIWlzU1RPUHJvcG9zZWQpOwogICAgICAgIGFkZHJlc3MgX3RlbXBsYXRlID0gUG9seUNvbXBsaWFuY2UuZ2V0VGVtcGxhdGVCeVByb3Bvc2FsKHRoaXMsIF90ZW1wbGF0ZUluZGV4KTsKICAgICAgICByZXF1aXJlKF90ZW1wbGF0ZSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBUZW1wbGF0ZSA9IElUZW1wbGF0ZShfdGVtcGxhdGUpOwogICAgICAgIHZhciAoX2ZlZSwgX3F1b3J1bSwgX3Zlc3RpbmdQZXJpb2QsIF9kZWxlZ2F0ZSwgX0tZQykgPSBUZW1wbGF0ZS5nZXRVc2FnZURldGFpbHMoKTsKICAgICAgICByZXF1aXJlKFBPTFkuYmFsYW5jZU9mKHRoaXMpID49IF9mZWUpOwogICAgICAgIGFsbG9jYXRpb25zW19kZWxlZ2F0ZV0gPSBBbGxvY2F0aW9uKF9mZWUsIF92ZXN0aW5nUGVyaW9kLCBfcXVvcnVtLCAwLCAwLCBmYWxzZSk7CiAgICAgICAgZGVsZWdhdGUgPSBfZGVsZWdhdGU7CiAgICAgICAgS1lDID0gX0tZQzsKICAgICAgICBQb2x5Q29tcGxpYW5jZS51cGRhdGVUZW1wbGF0ZVJlcHV0YXRpb24oX3RlbXBsYXRlLCBfdGVtcGxhdGVJbmRleCk7CiAgICAgICAgTG9nVGVtcGxhdGVTZXQoX2RlbGVnYXRlLCBfdGVtcGxhdGUsIF9LWUMpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgY29tcGxpYW5jZSBwcm9vZiBoYXNoIGZvciB0aGUgaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfbmV3TWVya2xlUm9vdCBOZXcgbWVya2xlIHJvb3QgaGFzaCBvZiB0aGUgY29tcGxpYW5jZSBQcm9vZnMKICAgICAqIEBwYXJhbSBfbWVya2xlUm9vdCBDb21wbGlhbmNlIFByb29mIGhhc2gKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbXBsaWFuY2VQcm9vZigKICAgICAgICBieXRlczMyIF9uZXdNZXJrbGVSb290LAogICAgICAgIGJ5dGVzMzIgX21lcmtsZVJvb3QKICAgICkgcHVibGljIG9ubHlPd25lck9yRGVsZWdhdGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIG1lcmtsZVJvb3QgPSBfbmV3TWVya2xlUm9vdDsKICAgICAgICBMb2dVcGRhdGVkQ29tcGxpYW5jZVByb29mKG1lcmtsZVJvb3QsIF9tZXJrbGVSb290KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYHNlbGVjdE9mZmVyaW5nUHJvcG9zYWxgIFNlbGVjdCBhbiBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBwcm9wb3NhbCBmb3IgdGhlIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBBcnJheSBpbmRleCBvZiB0aGUgU1RPIHByb3Bvc2FsCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBzZWxlY3RPZmZlcmluZ1Byb3Bvc2FsICh1aW50OCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KSBwdWJsaWMgb25seURlbGVnYXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIWlzU1RPUHJvcG9zZWQpOwogICAgICAgIHZhciAoX3N0b0NvbnRyYWN0LCBfYXVkaXRvciwgX3Zlc3RpbmdQZXJpb2QsIF9xdW9ydW0sIF9mZWUpID0gUG9seUNvbXBsaWFuY2UuZ2V0T2ZmZXJpbmdCeVByb3Bvc2FsKHRoaXMsIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpOwogICAgICAgIHJlcXVpcmUoX3N0b0NvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobWVya2xlUm9vdCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoZGVsZWdhdGUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShQT0xZLmJhbGFuY2VPZih0aGlzKSA+PSBhbGxvY2F0aW9uc1tkZWxlZ2F0ZV0uYW1vdW50LmFkZChfZmVlKSk7CiAgICAgICAgU1RPID0gU1RPMjAoX3N0b0NvbnRyYWN0KTsKICAgICAgICByZXF1aXJlKFNUTy5zdGFydFRpbWUoKSA+IG5vdyAmJiBTVE8uZW5kVGltZSgpID4gU1RPLnN0YXJ0VGltZSgpKTsKICAgICAgICBhbGxvY2F0aW9uc1tfYXVkaXRvcl0gPSBBbGxvY2F0aW9uKF9mZWUsIF92ZXN0aW5nUGVyaW9kLCBfcXVvcnVtLCAwLCAwLCBmYWxzZSk7CiAgICAgICAgc2hhcmVob2xkZXJzW2FkZHJlc3MoU1RPKV0gPSBTaGFyZWhvbGRlcih0aGlzLCB0cnVlLCA1KTsKICAgICAgICBzdGFydFNUTyA9IFNUTy5zdGFydFRpbWUoKTsKICAgICAgICBlbmRTVE8gPSBTVE8uZW5kVGltZSgpOwogICAgICAgIGlzU1RPUHJvcG9zZWQgPSAhaXNTVE9Qcm9wb3NlZDsKICAgICAgICBQb2x5Q29tcGxpYW5jZS51cGRhdGVPZmZlcmluZ1JlcHV0YXRpb24oX3N0b0NvbnRyYWN0LCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KTsKICAgICAgICBMb2dTZXRTVE9Db250cmFjdChTVE8sIF9zdG9Db250cmFjdCwgX2F1ZGl0b3IsIHN0YXJ0U1RPLCBlbmRTVE8pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTdGFydCB0aGUgb2ZmZXJpbmcgYnkgc2VuZGluZyBhbGwgdGhlIHRva2VucyB0byBTVE8gY29udHJhY3QKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBmdW5jdGlvbiBzdGFydE9mZmVyaW5nKCkgb25seU93bmVyIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoaXNTVE9Qcm9wb3NlZCk7CiAgICAgICAgcmVxdWlyZSghaGFzT2ZmZXJpbmdTdGFydGVkKTsKICAgICAgICB1aW50MjU2IHRva2VuQW1vdW50ID0gdGhpcy5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSh0b2tlbkFtb3VudCA9PSB0b3RhbFN1cHBseSk7CiAgICAgICAgYmFsYW5jZXNbU1RPXSA9IGJhbGFuY2VzW1NUT10uYWRkKHRva2VuQW1vdW50KTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih0b2tlbkFtb3VudCk7CiAgICAgICAgaGFzT2ZmZXJpbmdTdGFydGVkID0gdHJ1ZTsKICAgICAgICBUcmFuc2Zlcihvd25lciwgU1RPLCB0b2tlbkFtb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFkZCBhIHZlcmlmaWVkIGFkZHJlc3MgdG8gdGhlIFNlY3VyaXR5IFRva2VuIHdoaXRlbGlzdAogICAgICogVGhlIElzc3VlciBjYW4gYWRkIGFuIGFkZHJlc3MgdG8gdGhlIHdoaXRlbGlzdCBieSB0aGVtc2VsdmVzIGJ5CiAgICAgKiBjcmVhdGluZyB0aGVpciBvd24gS1lDIHByb3ZpZGVyIGFuZCB1c2luZyBpdCB0byB2ZXJpZnkgdGhlIGFjY291bnRzCiAgICAgKiB0aGV5IHdhbnQgdG8gYWRkIHRvIHRoZSB3aGl0ZWxpc3QuCiAgICAgKiBAcGFyYW0gX3doaXRlbGlzdEFkZHJlc3MgQWRkcmVzcyBhdHRlbXB0aW5nIHRvIGpvaW4gU1Qgd2hpdGVsaXN0CiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBhZGRUb1doaXRlbGlzdChhZGRyZXNzIF93aGl0ZWxpc3RBZGRyZXNzKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHZhciAoY291bnRyeUp1cmlzZGljdGlvbiwgZGl2aXNpb25KdXJpc2RpY3Rpb24sIGFjY3JlZGl0ZWQsIHJvbGUsIHZlcmlmaWVkLCBleHBpcmVzKSA9IFBvbHlDdXN0b21lcnMuZ2V0Q3VzdG9tZXIoS1lDLCBfd2hpdGVsaXN0QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZSh2ZXJpZmllZCAmJiBleHBpcmVzID4gbm93KTsKICAgICAgICByZXF1aXJlKFRlbXBsYXRlLmNoZWNrVGVtcGxhdGVSZXF1aXJlbWVudHMoY291bnRyeUp1cmlzZGljdGlvbiwgZGl2aXNpb25KdXJpc2RpY3Rpb24sIGFjY3JlZGl0ZWQsIHJvbGUpKTsKICAgICAgICBzaGFyZWhvbGRlcnNbX3doaXRlbGlzdEFkZHJlc3NdID0gU2hhcmVob2xkZXIobXNnLnNlbmRlciwgdHJ1ZSwgcm9sZSk7CiAgICAgICAgTG9nTmV3V2hpdGVsaXN0ZWRBZGRyZXNzKG1zZy5zZW5kZXIsIF93aGl0ZWxpc3RBZGRyZXNzLCByb2xlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWRkIGEgdmVyaWZpZWQgYWRkcmVzcyB0byB0aGUgU2VjdXJpdHkgVG9rZW4gYmxhY2tsaXN0CiAgICAgKiBAcGFyYW0gX2JsYWNrbGlzdEFkZHJlc3MgQWRkcmVzcyBiZWluZyBhZGRlZCB0byB0aGUgYmxhY2tsaXN0CiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBhZGRUb0JsYWNrbGlzdChhZGRyZXNzIF9ibGFja2xpc3RBZGRyZXNzKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoc2hhcmVob2xkZXJzW19ibGFja2xpc3RBZGRyZXNzXS5hbGxvd2VkKTsKICAgICAgICBzaGFyZWhvbGRlcnNbX2JsYWNrbGlzdEFkZHJlc3NdLmFsbG93ZWQgPSBmYWxzZTsKICAgICAgICBMb2dOZXdCbGFja2xpc3RlZEFkZHJlc3MobXNnLnNlbmRlciwgX2JsYWNrbGlzdEFkZHJlc3MpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvdyBQT0xZIGFsbG9jYXRpb25zIHRvIGJlIHdpdGhkcmF3biBieSBvd25lciwgZGVsZWdhdGUsIGFuZCB0aGUgU1RPIGF1ZGl0b3IgYXQgYXBwcm9wcmlhdGUgdGltZXMKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UG9seSgpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAJICAgIGlmIChkZWxlZ2F0ZSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICByZXR1cm4gUE9MWS50cmFuc2Zlcihvd25lciwgUE9MWS5iYWxhbmNlT2YodGhpcykpOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKG5vdyA+IGVuZFNUTyArIGFsbG9jYXRpb25zW21zZy5zZW5kZXJdLnZlc3RpbmdQZXJpb2QpOwogICAgICAgIHJlcXVpcmUoIWFsbG9jYXRpb25zW21zZy5zZW5kZXJdLmZyb3plbik7CiAgICAgICAgcmVxdWlyZShhbGxvY2F0aW9uc1ttc2cuc2VuZGVyXS5hbW91bnQgPiAwKTsKICAgICAgICByZXF1aXJlKFBPTFkudHJhbnNmZXIobXNnLnNlbmRlciwgYWxsb2NhdGlvbnNbbXNnLnNlbmRlcl0uYW1vdW50KSk7CiAgICAgICAgYWxsb2NhdGlvbnNbbXNnLnNlbmRlcl0uYW1vdW50ID0gMDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVm90ZSB0byBmcmVlemUgdGhlIGZlZSBvZiBhIGNlcnRhaW4gbmV0d29yayBwYXJ0aWNpcGFudAogICAgICogQHBhcmFtIF9yZWNpcGllbnQgVGhlIGZlZSByZWNpcGllbnQgYmVpbmcgcHJvdGVzdGVkCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB2b3RlVG9GcmVlemUoYWRkcmVzcyBfcmVjaXBpZW50KSBwdWJsaWMgb25seVNoYXJlaG9sZGVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoZGVsZWdhdGUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShub3cgPiBlbmRTVE8pOwogICAgICAgIHJlcXVpcmUobm93IDwgZW5kU1RPLmFkZChhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS52ZXN0aW5nUGVyaW9kKSk7CiAgICAgICAgcmVxdWlyZSghdm90ZWRbbXNnLnNlbmRlcl1bX3JlY2lwaWVudF0pOwogICAgICAgIHZvdGVkW21zZy5zZW5kZXJdW19yZWNpcGllbnRdID0gdHJ1ZTsKICAgICAgICBhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS55YXlWb3RlcyA9IGFsbG9jYXRpb25zW19yZWNpcGllbnRdLnlheVZvdGVzLmFkZChjb250cmlidXRlZFRvU1RPW21zZy5zZW5kZXJdKTsKICAgICAgICBhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS55YXlQZXJjZW50ID0gYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0ueWF5Vm90ZXMubXVsKDEwMCkuZGl2KGFsbG9jYXRpb25zW293bmVyXS5hbW91bnQpOwogICAgICAgIGlmIChhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS55YXlQZXJjZW50ID49IGFsbG9jYXRpb25zW19yZWNpcGllbnRdLnF1b3J1bSkgewogICAgICAgICAgYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0uZnJvemVuID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgTG9nVm90ZVRvRnJlZXplKF9yZWNpcGllbnQsIGFsbG9jYXRpb25zW19yZWNpcGllbnRdLnlheVBlcmNlbnQsIGFsbG9jYXRpb25zW19yZWNpcGllbnRdLnF1b3J1bSwgYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0uZnJvemVuKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgkvKioKICAgICAqIEBkZXYgYGlzc3VlU2VjdXJpdHlUb2tlbnNgIGlzIHVzZWQgYnkgdGhlIFNUTyB0byBrZWVwIHRyYWNrIG9mIFNUTyBpbnZlc3RvcnMKICAgICAqIEBwYXJhbSBfY29udHJpYnV0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIHBlcnNvbiB3aG9zZSBjb250cmlidXRpbmcKICAgICAqIEBwYXJhbSBfYW1vdW50T2ZTZWN1cml0eVRva2VucyBUaGUgYW1vdW50IG9mIFNUIHRvIHBheSBvdXQuCiAgICAgKiBAcGFyYW0gX3BvbHlDb250cmlidXRlZCBUaGUgYW1vdW50IG9mIFBPTFkgcGFpZCBmb3IgdGhlIHNlY3VyaXR5IHRva2Vucy4KICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVTZWN1cml0eVRva2VucyhhZGRyZXNzIF9jb250cmlidXRvciwgdWludDI1NiBfYW1vdW50T2ZTZWN1cml0eVRva2VucywgdWludDI1NiBfcG9seUNvbnRyaWJ1dGVkKSBwdWJsaWMgb25seVNUTyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHRoZSBvZmZlcmluZyBhY3RpdmUgb3Igbm90CiAgICAgICAgcmVxdWlyZShoYXNPZmZlcmluZ1N0YXJ0ZWQpOwogICAgICAgIC8vIFRoZSBfY29udHJpYnV0b3IgYmVpbmcgaXNzdWVkIHRva2VucyBtdXN0IGJlIGluIHRoZSB3aGl0ZWxpc3QKICAgICAgICByZXF1aXJlKHNoYXJlaG9sZGVyc1tfY29udHJpYnV0b3JdLmFsbG93ZWQpOwogICAgICAgIC8vIFRva2VucyBtYXkgb25seSBiZSBpc3N1ZWQgd2hpbGUgdGhlIFNUTyBpcyBydW5uaW5nCiAgICAgICAgcmVxdWlyZShub3cgPj0gc3RhcnRTVE8gJiYgbm93IDw9IGVuZFNUTyk7CiAgICAgICAgLy8gSW4gb3JkZXIgdG8gaXNzdWUgdGhlIFNULCB0aGUgX2NvbnRyaWJ1dG9yIGZpcnN0IHBheXMgaW4gUE9MWQogICAgICAgIHJlcXVpcmUoUE9MWS50cmFuc2ZlckZyb20oX2NvbnRyaWJ1dG9yLCB0aGlzLCBfcG9seUNvbnRyaWJ1dGVkKSk7CiAgICAgICAgLy8gU1QgYmVpbmcgaXNzdWVkIGNhbid0IGJlIGhpZ2hlciB0aGFuIHRoZSB0b3RhbFN1cHBseQogICAgICAgIHJlcXVpcmUodG9rZW5zSXNzdWVkQnlTVE8uYWRkKF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zKSA8PSB0b3RhbFN1cHBseSk7CiAgICAgICAgLy8gUE9MWSBjb250cmlidXRlZCBjYW4ndCBiZSBoaWdoZXIgdGhhbiBtYXhQb2x5IHNldCBieSBTVE8KICAgICAgICByZXF1aXJlKG1heFBvbHkgPj0gYWxsb2NhdGlvbnNbb3duZXJdLmFtb3VudC5hZGQoX3BvbHlDb250cmlidXRlZCkpOwogICAgICAgIC8vIFVwZGF0ZSBTVCBiYWxhbmNlcyAodHJhbnNmZXJzIFNUIGZyb20gU1RPIHRvIF9jb250cmlidXRvcikKICAgICAgICBiYWxhbmNlc1tTVE9dID0gYmFsYW5jZXNbU1RPXS5zdWIoX2Ftb3VudE9mU2VjdXJpdHlUb2tlbnMpOwogICAgICAgIGJhbGFuY2VzW19jb250cmlidXRvcl0gPSBiYWxhbmNlc1tfY29udHJpYnV0b3JdLmFkZChfYW1vdW50T2ZTZWN1cml0eVRva2Vucyk7CiAgICAgICAgLy8gRVJDMjAgVHJhbnNmZXIgZXZlbnQKICAgICAgICBUcmFuc2ZlcihTVE8sIF9jb250cmlidXRvciwgX2Ftb3VudE9mU2VjdXJpdHlUb2tlbnMpOwogICAgICAgIC8vIFVwZGF0ZSB0aGUgYW1vdW50IG9mIHRva2VucyBpc3N1ZWQgYnkgU1RPCiAgICAgICAgdG9rZW5zSXNzdWVkQnlTVE8gPSB0b2tlbnNJc3N1ZWRCeVNUTy5hZGQoX2Ftb3VudE9mU2VjdXJpdHlUb2tlbnMpOwogICAgICAgIC8vIFVwZGF0ZSB0aGUgYW1vdW50IG9mIFBPTFkgYSBjb250cmlidXRvciBoYXMgY29udHJpYnV0ZWQgYW5kIGFsbG9jYXRlZCB0byB0aGUgb3duZXIKICAgICAgICBjb250cmlidXRlZFRvU1RPW19jb250cmlidXRvcl0gPSBjb250cmlidXRlZFRvU1RPW19jb250cmlidXRvcl0uYWRkKF9wb2x5Q29udHJpYnV0ZWQpOwogICAgICAgIGFsbG9jYXRpb25zW293bmVyXS5hbW91bnQgPSBhbGxvY2F0aW9uc1tvd25lcl0uYW1vdW50LmFkZChfcG9seUNvbnRyaWJ1dGVkKTsKICAgICAgICBMb2dUb2tlbklzc3VlZChfY29udHJpYnV0b3IsIF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zLCBfcG9seUNvbnRyaWJ1dGVkLCBub3cpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEdldCB0b2tlbiBkZXRhaWxzCiAgICBmdW5jdGlvbiBnZXRUb2tlbkRldGFpbHMoKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzLCBhZGRyZXNzLCBieXRlczMyLCBhZGRyZXNzLCBhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIChUZW1wbGF0ZSwgZGVsZWdhdGUsIG1lcmtsZVJvb3QsIFNUTywgS1lDKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEN1c3RvbWl6ZWQgRVJDMjAgRnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQGRldiBUcmFzZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgICAqIEBwYXJhbSBfdG8gRXRoZXJldW0gcHVibGljIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW5zIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKHNoYXJlaG9sZGVyc1tfdG9dLmFsbG93ZWQgJiYgc2hhcmVob2xkZXJzW21zZy5zZW5kZXJdLmFsbG93ZWQgJiYgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIGNvbnRyYWN0cyB0byB0cmFuc2ZlciB0b2tlbnMgb24gYmVoYWxmIG9mIHRva2VuIGhvbGRlcnMKICAgICAqIEBwYXJhbSBfZnJvbSBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VucyBmcm9tCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgICAqIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChzaGFyZWhvbGRlcnNbX3RvXS5hbGxvd2VkICYmIHNoYXJlaG9sZGVyc1tfZnJvbV0uYWxsb3dlZCAmJiBiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBiYWxhbmNlT2ZgIHVzZWQgdG8gZ2V0IHRoZSBiYWxhbmNlIG9mIHNoYXJlaG9sZGVycwogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAgKiBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBcHByb3ZlIHRyYW5zZmVyIG9mIHRva2VucyBtYW51YWxseQogICAgICogQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3MgdG8gYXBwcm92ZSB0cmFuc2ZlciB0bwogICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRvIGFwcHJvdmUgZm9yIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgIT0gMCk7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVzZSB0byBnZXQgdGhlIGFsbG93YW5jZSBwcm92aWRlZCB0byB0aGUgc3BlbmRlcgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAgKiBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KfQoKLyoKICBQb2x5bWF0aCBjdXN0b21lciByZWdpc3RyeSBpcyB1c2VkIHRvIGVuc3VyZSByZWd1bGF0b3J5IGNvbXBsaWFuY2UKICBvZiB0aGUgaW52ZXN0b3JzLCBwcm92aWRlciwgYW5kIGlzc3VlcnMuIFRoZSBjdXN0b21lcnMgcmVnaXN0cnkgaXMgYSBjZW50cmFsCiAgcGxhY2Ugd2hlcmUgZXRoZXJldW0gYWRkcmVzc2VzIGNhbiBiZSB3aGl0ZWxpc3RlZCB0byBwdXJjaGFzZSBjZXJ0YWluIHNlY3VyaXR5CiAgdG9rZW5zIGJhc2VkIG9uIHRoZWlyIHZlcmlmaWNhdGlvbnMgYnkgcHJvdmlkZXJzLgoqLwoKCgoKLyoqCiAqIEB0aXRsZSBDdXN0b21lcnMKICogQGRldiBDb250cmFjdCB1c2UgdG8gcmVnaXN0ZXIgdGhlIHVzZXIgb24gdGhlIFBsYXRmb3JtIHBsYXRmb3JtCiAqLwoKY29udHJhY3QgQ3VzdG9tZXJzIGlzIElDdXN0b21lcnMgewoKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTiA9ICIxIjsKCiAgICBJRVJDMjAgUE9MWTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluc3RhbmNlIG9mIHRoZSBQT0xZIHRva2VuCgogICAgc3RydWN0IEN1c3RvbWVyIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdHJ1Y3R1cmUgdXNlIHRvIHN0b3JlIHRoZSBkZXRhaWxzIG9mIHRoZSBjdXN0b21lcnMKICAgICAgICBieXRlczMyIGNvdW50cnlKdXJpc2RpY3Rpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3VzdG9tZXJzIGNvdW50cnkganVyaXNkaWN0aW9uIGFzIGV4IC0gSVNPMzE2NgogICAgICAgIGJ5dGVzMzIgZGl2aXNpb25KdXJpc2RpY3Rpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXN0b21lcnMgc3ViLWRpdmlzaW9uIGp1cmlzZGljdGlvbiBhcyBleCAtIElTTzMxNjYKICAgICAgICB1aW50MjU2IGpvaW5lZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gY3VzdG9tZXIgcmVnaXN0ZXIKICAgICAgICB1aW50OCByb2xlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcm9sZSBvZiB0aGUgY3VzdG9tZXIKICAgICAgICBib29sIHZlcmlmaWVkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9vbGVhbiB2YXJpYWJsZSB0byBjaGVjayB0aGUgc3RhdHVzIG9mIHRoZSBjdXN0b21lciB3aGV0aGVyIGl0IGlzIHZlcmlmaWVkIG9yIG5vdAogICAgICAgIGJvb2wgYWNjcmVkaXRlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBY2NyZWRpYXRpb24gc3RhdHVzIG9mIHRoZSBjdXN0b21lcgogICAgICAgIGJ5dGVzMzIgcHJvb2Y7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9vZiBmb3IgY3VzdG9tZXIKICAgICAgICB1aW50MjU2IGV4cGlyZXM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gY3VzdG9tZXIgdmVyaWZpY2F0aW9uIGV4cGlyZXMKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IEN1c3RvbWVyKSkgcHVibGljIGN1c3RvbWVyczsgIC8vIEN1c3RvbWVycyAoa3ljIHByb3ZpZGVyIGFkZHJlc3MgPT4gY3VzdG9tZXIgYWRkcmVzcykKCiAgICBzdHJ1Y3QgUHJvdmlkZXIgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtZQy9BY2NyZWRpdGF0aW9uIFByb3ZpZGVyCiAgICAgICAgc3RyaW5nIG5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWUgb2YgdGhlIHByb3ZpZGVyCiAgICAgICAgdWludDI1NiBqb2luZWQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpbWVzdGFtcCB3aGVuIHByb3ZpZGVyIHJlZ2lzdGVyCiAgICAgICAgYnl0ZXMzMiBkZXRhaWxzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERldGFpbHMgb2YgcHJvdmlkZXIKICAgICAgICB1aW50MjU2IGZlZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmVlIGNoYXJnZWQgYnkgdGhlIEtZQyBwcm92aWRlcnMKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gUHJvdmlkZXIpIHB1YmxpYyBwcm92aWRlcnM7ICAgICAgICAgICAgICAgICAgICAgIC8vIEtZQy9BY2NyZWRpdGF0aW9uIFByb3ZpZGVycwoKICAgIC8vIE5vdGlmaWNhdGlvbnMKICAgIGV2ZW50IExvZ05ld1Byb3ZpZGVyKGFkZHJlc3MgcHJvdmlkZXJBZGRyZXNzLCBzdHJpbmcgbmFtZSwgYnl0ZXMzMiBkZXRhaWxzKTsKICAgIGV2ZW50IExvZ0N1c3RvbWVyVmVyaWZpZWQoYWRkcmVzcyBjdXN0b21lciwgYWRkcmVzcyBwcm92aWRlciwgdWludDggcm9sZSk7CgogICAgLy8gTW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlQcm92aWRlcigpIHsKICAgICAgICByZXF1aXJlKHByb3ZpZGVyc1ttc2cuc2VuZGVyXS5kZXRhaWxzICE9IDB4MCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ29uc3RydWN0b3IKICAgICAqLwogICAgZnVuY3Rpb24gQ3VzdG9tZXJzKGFkZHJlc3MgX3BvbHlUb2tlbkFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgUE9MWSA9IElFUkMyMChfcG9seVRva2VuQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93IG5ldyBwcm92aWRlciBhcHBsaWNhdGlvbnMKICAgICAqIEBwYXJhbSBfcHJvdmlkZXJBZGRyZXNzIFRoZSBwcm92aWRlcidzIHB1YmxpYyBrZXkgYWRkcmVzcwogICAgICogQHBhcmFtIF9uYW1lIFRoZSBwcm92aWRlcidzIG5hbWUKICAgICAqIEBwYXJhbSBfZGV0YWlscyBBIFNIQTI1NiBoYXNoIG9mIHRoZSBuZXcgcHJvdmlkZXJzIGRldGFpbHMKICAgICAqIEBwYXJhbSBfZmVlIFRoZSBmZWUgY2hhcmdlZCBmb3IgY3VzdG9tZXIgdmVyaWZpY2F0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5ld1Byb3ZpZGVyKGFkZHJlc3MgX3Byb3ZpZGVyQWRkcmVzcywgc3RyaW5nIF9uYW1lLCBieXRlczMyIF9kZXRhaWxzLCB1aW50MjU2IF9mZWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF9wcm92aWRlckFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfZGV0YWlscyAhPSAweDApOwogICAgICAgIHJlcXVpcmUocHJvdmlkZXJzW19wcm92aWRlckFkZHJlc3NdLmRldGFpbHMgPT0gMHgwKTsKICAgICAgICBwcm92aWRlcnNbX3Byb3ZpZGVyQWRkcmVzc10gPSBQcm92aWRlcihfbmFtZSwgbm93LCBfZGV0YWlscywgX2ZlZSk7CiAgICAgICAgTG9nTmV3UHJvdmlkZXIoX3Byb3ZpZGVyQWRkcmVzcywgX25hbWUsIF9kZXRhaWxzKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hhbmdlIGEgcHJvdmlkZXJzIGZlZQogICAgICogQHBhcmFtIF9uZXdGZWUgVGhlIG5ldyBmZWUgb2YgdGhlIHByb3ZpZGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUZlZSh1aW50MjU2IF9uZXdGZWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHByb3ZpZGVyc1ttc2cuc2VuZGVyXS5kZXRhaWxzICE9IDB4MCk7CiAgICAgICAgcHJvdmlkZXJzW21zZy5zZW5kZXJdLmZlZSA9IF9uZXdGZWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFZlcmlmeSBhbiBpbnZlc3RvcgogICAgICogQHBhcmFtIF9jdXN0b21lciBUaGUgY3VzdG9tZXIncyBwdWJsaWMga2V5IGFkZHJlc3MKICAgICAqIEBwYXJhbSBfY291bnRyeUp1cmlzZGljdGlvbiBUaGUganVyaXNkaWN0aW9uIGNvdW50cnkgY29kZSBvZiB0aGUgY3VzdG9tZXIKICAgICAqIEBwYXJhbSBfZGl2aXNpb25KdXJpc2RpY3Rpb24gVGhlIGp1cmlzZGljdGlvbiBzdWJkaXZpc2lvbiBjb2RlIG9mIHRoZSBjdXN0b21lcgogICAgICogQHBhcmFtIF9yb2xlIFRoZSB0eXBlIG9mIGN1c3RvbWVyIC0gaW52ZXN0b3I6MSwgZGVsZWdhdGU6MiwgaXNzdWVyOjMsIG1hcmtldG1ha2VyOjQsIGV0Yy4KICAgICAqIEBwYXJhbSBfYWNjcmVkaXRlZCBXaGV0aGVyIHRoZSBjdXN0b21lciBpcyBhY2NyZWRpdGVkIG9yIG5vdCAob25seSBhcHBsaWVkIHRvIGludmVzdG9ycykKICAgICAqIEBwYXJhbSBfZXhwaXJlcyBUaGUgdGltZSB0aGUgdmVyaWZpY2F0aW9uIGV4cGlyZXMKICAgICAqLwogICAgZnVuY3Rpb24gdmVyaWZ5Q3VzdG9tZXIoCiAgICAgICAgYWRkcmVzcyBfY3VzdG9tZXIsCiAgICAgICAgYnl0ZXMzMiBfY291bnRyeUp1cmlzZGljdGlvbiwKICAgICAgICBieXRlczMyIF9kaXZpc2lvbkp1cmlzZGljdGlvbiwKICAgICAgICB1aW50OCBfcm9sZSwKICAgICAgICBib29sIF9hY2NyZWRpdGVkLAogICAgICAgIHVpbnQyNTYgX2V4cGlyZXMKICAgICkgcHVibGljIG9ubHlQcm92aWRlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShfZXhwaXJlcyA+IG5vdyk7CiAgICAgICAgcmVxdWlyZShQT0xZLnRyYW5zZmVyRnJvbShfY3VzdG9tZXIsIG1zZy5zZW5kZXIsIHByb3ZpZGVyc1ttc2cuc2VuZGVyXS5mZWUpKTsKICAgICAgICBjdXN0b21lcnNbbXNnLnNlbmRlcl1bX2N1c3RvbWVyXS5jb3VudHJ5SnVyaXNkaWN0aW9uID0gX2NvdW50cnlKdXJpc2RpY3Rpb247CiAgICAgICAgY3VzdG9tZXJzW21zZy5zZW5kZXJdW19jdXN0b21lcl0uZGl2aXNpb25KdXJpc2RpY3Rpb24gPSBfZGl2aXNpb25KdXJpc2RpY3Rpb247CiAgICAgICAgY3VzdG9tZXJzW21zZy5zZW5kZXJdW19jdXN0b21lcl0ucm9sZSA9IF9yb2xlOwogICAgICAgIGN1c3RvbWVyc1ttc2cuc2VuZGVyXVtfY3VzdG9tZXJdLmFjY3JlZGl0ZWQgPSBfYWNjcmVkaXRlZDsKICAgICAgICBjdXN0b21lcnNbbXNnLnNlbmRlcl1bX2N1c3RvbWVyXS5leHBpcmVzID0gX2V4cGlyZXM7CiAgICAgICAgY3VzdG9tZXJzW21zZy5zZW5kZXJdW19jdXN0b21lcl0udmVyaWZpZWQgPSB0cnVlOwogICAgICAgIExvZ0N1c3RvbWVyVmVyaWZpZWQoX2N1c3RvbWVyLCBtc2cuc2VuZGVyLCBfcm9sZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEdFVCBGdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQGRldiBHZXQgY3VzdG9tZXIgYXR0ZXN0YXRpb24gZGF0YSBieSBLWUMgcHJvdmlkZXIgYW5kIGN1c3RvbWVyIGV0aGVyZXVtIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfcHJvdmlkZXIgQWRkcmVzcyBvZiB0aGUgS1lDIHByb3ZpZGVyLgogICAgICogQHBhcmFtIF9jdXN0b21lciBBZGRyZXNzIG9mIHRoZSBjdXN0b21lciBldGhlcmV1bSBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEN1c3RvbWVyKGFkZHJlc3MgX3Byb3ZpZGVyLCBhZGRyZXNzIF9jdXN0b21lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKAogICAgICAgIGJ5dGVzMzIsCiAgICAgICAgYnl0ZXMzMiwKICAgICAgICBib29sLAogICAgICAgIHVpbnQ4LAogICAgICAgIGJvb2wsCiAgICAgICAgdWludDI1NgogICAgKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgY3VzdG9tZXJzW19wcm92aWRlcl1bX2N1c3RvbWVyXS5jb3VudHJ5SnVyaXNkaWN0aW9uLAogICAgICAgIGN1c3RvbWVyc1tfcHJvdmlkZXJdW19jdXN0b21lcl0uZGl2aXNpb25KdXJpc2RpY3Rpb24sCiAgICAgICAgY3VzdG9tZXJzW19wcm92aWRlcl1bX2N1c3RvbWVyXS5hY2NyZWRpdGVkLAogICAgICAgIGN1c3RvbWVyc1tfcHJvdmlkZXJdW19jdXN0b21lcl0ucm9sZSwKICAgICAgICBjdXN0b21lcnNbX3Byb3ZpZGVyXVtfY3VzdG9tZXJdLnZlcmlmaWVkLAogICAgICAgIGN1c3RvbWVyc1tfcHJvdmlkZXJdW19jdXN0b21lcl0uZXhwaXJlcwogICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHByb3ZpZGVyIGRldGFpbHMgYW5kIGZlZSBieSBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3Byb3ZpZGVyQWRkcmVzcyBBZGRyZXNzIG9mIHRoZSBLWUMgcHJvdmlkZXIKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHJvdmlkZXIoYWRkcmVzcyBfcHJvdmlkZXJBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgdWludDI1NiBqb2luZWQsCiAgICAgICAgYnl0ZXMzMiBkZXRhaWxzLAogICAgICAgIHVpbnQyNTYgZmVlCiAgICApIHsKICAgICAgcmV0dXJuICgKICAgICAgICBwcm92aWRlcnNbX3Byb3ZpZGVyQWRkcmVzc10ubmFtZSwKICAgICAgICBwcm92aWRlcnNbX3Byb3ZpZGVyQWRkcmVzc10uam9pbmVkLAogICAgICAgIHByb3ZpZGVyc1tfcHJvdmlkZXJBZGRyZXNzXS5kZXRhaWxzLAogICAgICAgIHByb3ZpZGVyc1tfcHJvdmlkZXJBZGRyZXNzXS5mZWUKICAgICAgKTsKICAgIH0KCn0KCi8qCiAgUG9seW1hdGggY29tcGxpYW5jZSB0ZW1wbGF0ZSBpcyBpbnRlbmRlZCB0byBlbnN1cmUgcmVndWxhdG9yeSBjb21wbGlhbmNlCiAgaW4gdGhlIGp1cmlzZGljdGlvbnMgdGhhdCBzZWN1cml0eSB0b2tlbnMgYXJlIGJlaW5nIG9mZmVyZWQgaW4uIFRoZSBjb21wbGlhbmNlCiAgdGVtcGxhdGUgYWxsb3dzIHNlY3VyaXR5IHRva2VucyB0byBlbmZvcmNlIHB1cmNoYXNlIHJlc3RyaWN0aW9ucyBvbiBjaGFpbiBhbmQKICBrZWVwIGEgbG9nIG9mIGRvY3VtZW50cyBmb3IgZnV0dXJlIGF1ZGl0aW5nIHB1cnBvc2VzLgoqLwoKCgovKioKICogQHRpdGxlIFRlbXBsYXRlCiAqIEBkZXYgIFRlbXBsYXRlIGRldGFpbHMgdXNlZCBmb3IgdGhlIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIHRvIGVuc3VyZSB0aGUgcmVndWxhdG9yeSBjb21wbGlhbmNlCiAqLwoKY29udHJhY3QgVGVtcGxhdGUgaXMgSVRlbXBsYXRlIHsKCiAgICBzdHJpbmcgcHVibGljIFZFUlNJT04gPSAiMSI7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIG93bmVyIG9mIHRlbXBsYXRlCiAgICBzdHJpbmcgcHVibGljIG9mZmVyaW5nVHlwZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmFtZSBvZiB0aGUgc2VjdXJpdHkgYmVpbmcgaXNzdWVkCiAgICBieXRlczMyIHB1YmxpYyBpc3N1ZXJKdXJpc2RpY3Rpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFyaWFibGUgY29udGFpbnMgdGhlIGp1cmlzZGljdGlvbiBvZiB0aGUgaXNzdWVyIG9mIHRoZSB0ZW1wbGF0ZQogICAgbWFwcGluZyhieXRlczMyID0+IGJvb2wpIHB1YmxpYyBhbGxvd2VkSnVyaXNkaWN0aW9uczsgICAgICAgICAgIC8vIE1hcHBpbmcgdGhhdCBjb250YWlucyB0aGUgYWxsb3dlZCBzdGF1cyBvZiBKdXJpc2RpY3Rpb25zCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gYm9vbCkgcHVibGljIGJsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnM7ICAgLy8gTWFwcGluZyB0aGF0IGNvbnRhaW5zIHRoZSBhbGxvd2VkIHN0YXVzIG9mIEp1cmlzZGljdGlvbnMKICAgIG1hcHBpbmcodWludDggPT4gYm9vbCkgcHVibGljIGFsbG93ZWRSb2xlczsgICAgICAgICAgICAgICAgICAgICAvLyBNYXBwaW5nIHRoYXQgY29udGFpbnMgdGhlIGFsbG93ZWQgc3RhdHVzIG9mIFJvbGVzCiAgICBib29sIHB1YmxpYyBhY2NyZWRpdGVkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFyaWFibGUgdGhhdCBkZWZpbmUgdGhlIHJlcXVpcmVkIGxldmVsIG9mIGFjY3JlZGlhdGlvbiBmb3IgdGhlIGludmVzdG9yCiAgICBhZGRyZXNzIHB1YmxpYyBLWUM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgS1lDIHByb3ZpZGVyCiAgICBieXRlczMyIGRldGFpbHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGV0YWlscyBvZiB0aGUgb2ZmZXJpbmcgcmVxdWlyZW1lbnRzCiAgICBib29sIGZpbmFsaXplZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFyaWFibGUgdG8ga25vdyB0aGUgc3RhdHVzIG9mIHRoZSB0ZW1wbGF0ZSAoY29tcGxldGUgLSB0cnVlLCBub3QgY29tcGxldGUgLSBmYWxzZSkKICAgIHVpbnQyNTYgcHVibGljIGV4cGlyZXM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaW1lc3RhbXAgd2hlbiB0ZW1wbGF0ZSBleHBpcmVzCiAgICB1aW50MjU2IGZlZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIFBPTFkgdG8gdXNlIHRoZSB0ZW1wbGF0ZSAoaGVsZCBpbiBlc2Nyb3cgdW50aWwgaXNzdWFuY2UpCiAgICB1aW50OCBxdW9ydW07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWluaW11bSBwZXJjZW50IG9mIHNoYXJlaG9sZGVycyB3aGljaCBuZWVkIHRvIHZvdGUgdG8gZnJlZXplCiAgICB1aW50MjU2IHZlc3RpbmdQZXJpb2Q7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGVuZ3RoIG9mIHRpbWUgdG8gdmVzdCBmdW5kcwoKICAgIGV2ZW50IERldGFpbHNVcGRhdGVkKGJ5dGVzMzIgX3ByZXZEZXRhaWxzLCBieXRlczMyIF9uZXdEZXRhaWxzLCB1aW50IF91cGRhdGVEYXRlKTsKCiAgICBmdW5jdGlvbiBUZW1wbGF0ZSAoCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgc3RyaW5nIF9vZmZlcmluZ1R5cGUsCiAgICAgICAgYnl0ZXMzMiBfaXNzdWVySnVyaXNkaWN0aW9uLAogICAgICAgIGJvb2wgX2FjY3JlZGl0ZWQsCiAgICAgICAgYWRkcmVzcyBfS1lDLAogICAgICAgIGJ5dGVzMzIgX2RldGFpbHMsCiAgICAgICAgdWludDI1NiBfZXhwaXJlcywKICAgICAgICB1aW50MjU2IF9mZWUsCiAgICAgICAgdWludDggX3F1b3J1bSwKICAgICAgICB1aW50MjU2IF92ZXN0aW5nUGVyaW9kCiAgICApIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoX0tZQyAhPSBhZGRyZXNzKDApICYmIF9vd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9mZWUgPiAwKTsKICAgICAgICByZXF1aXJlKF9kZXRhaWxzLmxlbmd0aCA+IDAgJiYgX2V4cGlyZXMgPiBub3cgJiYgX2lzc3Vlckp1cmlzZGljdGlvbi5sZW5ndGggPiAwKTsKICAgICAgICByZXF1aXJlKF9xdW9ydW0gPiAwICYmIF9xdW9ydW0gPD0gMTAwKTsKICAgICAgICByZXF1aXJlKF92ZXN0aW5nUGVyaW9kID4gMCk7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgb2ZmZXJpbmdUeXBlID0gX29mZmVyaW5nVHlwZTsKICAgICAgICBpc3N1ZXJKdXJpc2RpY3Rpb24gPSBfaXNzdWVySnVyaXNkaWN0aW9uOwogICAgICAgIGFjY3JlZGl0ZWQgPSBfYWNjcmVkaXRlZDsKICAgICAgICBLWUMgPSBfS1lDOwogICAgICAgIGRldGFpbHMgPSBfZGV0YWlsczsKICAgICAgICBmaW5hbGl6ZWQgPSBmYWxzZTsKICAgICAgICBleHBpcmVzID0gX2V4cGlyZXM7CiAgICAgICAgZmVlID0gX2ZlZTsKICAgICAgICBxdW9ydW0gPSBfcXVvcnVtOwogICAgICAgIHZlc3RpbmdQZXJpb2QgPSBfdmVzdGluZ1BlcmlvZDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYGFkZEp1cmlzZGljdGlvbmAgYWxsb3dzIHRoZSBhZGRpbmcgb2YgbmV3IGp1cmlzZGljdGlvbnMgdG8gYSB0ZW1wbGF0ZQogICAgICogQHBhcmFtIF9hbGxvd2VkSnVyaXNkaWN0aW9ucyBBbiBhcnJheSBvZiBqdXJpc2RpY3Rpb25zCiAgICAgKiBAcGFyYW0gX2FsbG93ZWQgQW4gYXJyYXkgb2Ygd2hldGhlciB0aGUganVyaXNkaWN0aW9uIGlzIGFsbG93ZWQgdG8gcHVyY2hhc2UgdGhlIHNlY3VyaXR5IG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBhZGRKdXJpc2RpY3Rpb24oYnl0ZXMzMltdIF9hbGxvd2VkSnVyaXNkaWN0aW9ucywgYm9vbFtdIF9hbGxvd2VkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUob3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShfYWxsb3dlZEp1cmlzZGljdGlvbnMubGVuZ3RoID09IF9hbGxvd2VkLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSghZmluYWxpemVkKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYWxsb3dlZEp1cmlzZGljdGlvbnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgYWxsb3dlZEp1cmlzZGljdGlvbnNbX2FsbG93ZWRKdXJpc2RpY3Rpb25zW2ldXSA9IF9hbGxvd2VkW2ldOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYGFkZEp1cmlzZGljdGlvbmAgYWxsb3dzIHRoZSBhZGRpbmcgb2YgbmV3IGp1cmlzZGljdGlvbnMgdG8gYSB0ZW1wbGF0ZQogICAgICogQHBhcmFtIF9ibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zIEFuIGFycmF5IG9mIHN1YmRpdmlzaW9uIGp1cmlzZGljdGlvbnMKICAgICAqIEBwYXJhbSBfYmxvY2tlZCBBbiBhcnJheSBvZiB3aGV0aGVyIHRoZSBzdWJkaXZpc2lvbiBqdXJpc2RpY3Rpb24gaXMgYmxvY2tlZCB0byBwdXJjaGFzZSB0aGUgc2VjdXJpdHkgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZERpdmlzaW9uSnVyaXNkaWN0aW9uKGJ5dGVzMzJbXSBfYmxvY2tlZERpdmlzaW9uSnVyaXNkaWN0aW9ucywgYm9vbFtdIF9ibG9ja2VkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUob3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShfYmxvY2tlZERpdmlzaW9uSnVyaXNkaWN0aW9ucy5sZW5ndGggPT0gX2Jsb2NrZWQubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKCFmaW5hbGl6ZWQpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9ibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGJsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnNbX2Jsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnNbaV1dID0gX2Jsb2NrZWRbaV07CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgYWRkUm9sZWAgYWxsb3dzIHRoZSBhZGRpbmcgb2YgbmV3IHJvbGVzIHRvIGJlIGFkZGVkIHRvIHdoaXRlbGlzdAogICAgICogQHBhcmFtIF9hbGxvd2VkUm9sZXMgVXNlciByb2xlcyB0aGF0IGNhbiBwdXJjaGFzZSB0aGUgc2VjdXJpdHkKICAgICAqLwogICAgZnVuY3Rpb24gYWRkUm9sZXModWludDhbXSBfYWxsb3dlZFJvbGVzKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUob3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSghZmluYWxpemVkKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYWxsb3dlZFJvbGVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGFsbG93ZWRSb2xlc1tfYWxsb3dlZFJvbGVzW2ldXSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBgdXBkYXRlRGV0YWlsc2AKICAgICAqIEBwYXJhbSBfZGV0YWlscyBkZXRhaWxzIG9mIHRoZSB0ZW1wbGF0ZSBuZWVkIHRvIGNoYW5nZQogICAgICogQHJldHVybiBhbGxvd2VkIGJvb2xlYW4gdmFyaWFibGUKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlRGV0YWlscyhieXRlczMyIF9kZXRhaWxzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7CiAgICAgICAgcmVxdWlyZShfZGV0YWlscyAhPSAweDApOwogICAgICAgIHJlcXVpcmUob3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgYnl0ZXMzMiBwcmV2RGV0YWlscyA9IGRldGFpbHM7CiAgICAgICAgZGV0YWlscyA9IF9kZXRhaWxzOwogICAgICAgIERldGFpbHNVcGRhdGVkKHByZXZEZXRhaWxzLCBkZXRhaWxzLCBub3cpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgZmluYWxpemVUZW1wbGF0ZWAgaXMgdXNlZCB0byBmaW5hbGl6ZSB0ZW1wbGF0ZS5mdWxsIGNvbXBsaWFuY2UgcHJvY2Vzcy9yZXF1aXJlbWVudHMKICAgICAqIEByZXR1cm4gc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6ZVRlbXBsYXRlKCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUob3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgZmluYWxpemVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYGNoZWNrVGVtcGxhdGVSZXF1aXJlbWVudHNgIGlzIGEgY29uc3RhbnQgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgdGVtcGxhdGVzIHJlcXVpcmVtZW50cyBhcmUgbWV0CiAgICAgKiBAcGFyYW0gX2NvdW50cnlKdXJpc2RpY3Rpb24gVGhlIElTTy0zMTY2IGNvZGUgb2YgdGhlIGludmVzdG9ycyBjb3VudHJ5IGp1cmlzZGljdGlvbgogICAgICogQHBhcmFtIF9kaXZpc2lvbkp1cmlzZGljdGlvbiBUaGUgSVNPLTMxNjYgY29kZSBvZiB0aGUgaW52ZXN0b3JzIHN1YmRpdmlzaW9uIGp1cmlzZGljdGlvbgogICAgICogQHBhcmFtIF9hY2NyZWRpdGVkIFdoZXRoZXIgdGhlIGludmVzdG9yIGlzIGFjY3JlZGl0ZWQgb3Igbm90CiAgICAgKiBAcGFyYW0gX3JvbGUgcm9sZSBvZiB0aGUgdXNlcgogICAgICogQHJldHVybiBhbGxvd2VkIGJvb2xlYW4gdmFyaWFibGUKICAgICAqLwogICAgZnVuY3Rpb24gY2hlY2tUZW1wbGF0ZVJlcXVpcmVtZW50cygKICAgICAgICBieXRlczMyIF9jb3VudHJ5SnVyaXNkaWN0aW9uLAogICAgICAgIGJ5dGVzMzIgX2RpdmlzaW9uSnVyaXNkaWN0aW9uLAogICAgICAgIGJvb2wgX2FjY3JlZGl0ZWQsCiAgICAgICAgdWludDggX3JvbGUKICAgICkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgYWxsb3dlZCkKICAgIHsKICAgICAgICByZXF1aXJlKF9jb3VudHJ5SnVyaXNkaWN0aW9uICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkSnVyaXNkaWN0aW9uc1tfY291bnRyeUp1cmlzZGljdGlvbl0gfHwgIWJsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnNbX2RpdmlzaW9uSnVyaXNkaWN0aW9uXSk7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkUm9sZXNbX3JvbGVdKTsKICAgICAgICBpZiAoYWNjcmVkaXRlZCkgewogICAgICAgICAgICByZXF1aXJlKF9hY2NyZWRpdGVkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGdldFRlbXBsYXRlRGV0YWlscyBpcyBhIGNvbnN0YW50IGZ1bmN0aW9uIHRoYXQgZ2V0cyB0ZW1wbGF0ZSBkZXRhaWxzCiAgICAgKiBAcmV0dXJuIGJ5dGVzMzIgZGV0YWlscywgYm9vbCBmaW5hbGl6ZWQKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVEZXRhaWxzKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMiwgYm9vbCkgewogICAgICAgIHJlcXVpcmUoZXhwaXJlcyA+IG5vdyk7CiAgICAgICAgcmV0dXJuIChkZXRhaWxzLCBmaW5hbGl6ZWQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgZ2V0VXNhZ2VGZWVzYCBpcyBhIGZ1bmN0aW9uIHRvIGdldCBhbGwgdGhlIGRldGFpbHMgb24gdGVtcGxhdGUgdXNhZ2UgZmVlcwogICAgICogQHJldHVybiB1aW50MjU2IGZlZSwgdWludDggcXVvcnVtLCB1aW50MjU2IHZlc3RpbmdQZXJpb2QsIGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgS1lDCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFVzYWdlRGV0YWlscygpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYsIHVpbnQ4LCB1aW50MjU2LCBhZGRyZXNzLCBhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIChmZWUsIHF1b3J1bSwgdmVzdGluZ1BlcmlvZCwgb3duZXIsIEtZQyk7CiAgICB9Cn0KCmludGVyZmFjZSBJU2VjdXJpdHlUb2tlbiB7CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCBkZWZhdWx0IHNlY3VyaXR5IHRva2VuIHBhcmFtZXRlcnMKICAgICAqIEBwYXJhbSBfbmFtZSBOYW1lIG9mIHRoZSBzZWN1cml0eSB0b2tlbgogICAgICogQHBhcmFtIF90aWNrZXIgVGlja2VyIG5hbWUgb2YgdGhlIHNlY3VyaXR5CiAgICAgKiBAcGFyYW0gX3RvdGFsU3VwcGx5IFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYmVpbmcgY3JlYXRlZAogICAgICogQHBhcmFtIF9kZWNpbWFscyBEZWNpbWFscyBmb3IgdG9rZW4KICAgICAqIEBwYXJhbSBfb3duZXIgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgc2VjdXJpdHkgdG9rZW4gb3duZXIKICAgICAqIEBwYXJhbSBfbWF4UG9seSBBbW91bnQgb2YgbWF4aW11bSBwb2x5IGlzc3VlciB3YW50IHRvIHJhaXNlCiAgICAgKiBAcGFyYW0gX2xvY2t1cFBlcmlvZCBMZW5ndGggb2YgdGltZSByYWlzZWQgUE9MWSB3aWxsIGJlIGxvY2tlZCB1cCBmb3IgZGlzcHV0ZQogICAgICogQHBhcmFtIF9xdW9ydW0gUGVyY2VudCBvZiBpbml0aWFsIGludmVzdG9ycyByZXF1aXJlZCB0byBmcmVlemUgUE9MWSByYWlzZQogICAgICogQHBhcmFtIF9wb2x5VG9rZW5BZGRyZXNzIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIFBPTFkgdG9rZW4gY29udHJhY3QKICAgICAqIEBwYXJhbSBfcG9seUN1c3RvbWVyc0FkZHJlc3MgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgUG9seUN1c3RvbWVycyBjb250cmFjdAogICAgICogQHBhcmFtIF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgUG9seUNvbXBsaWFuY2UgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gU2VjdXJpdHlUb2tlbigKICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgc3RyaW5nIF90aWNrZXIsCiAgICAgICAgdWludDI1NiBfdG90YWxTdXBwbHksCiAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX21heFBvbHksCiAgICAgICAgdWludDI1NiBfbG9ja3VwUGVyaW9kLAogICAgICAgIHVpbnQ4IF9xdW9ydW0sCiAgICAgICAgYWRkcmVzcyBfcG9seVRva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9wb2x5Q3VzdG9tZXJzQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MKICAgICkgcHVibGljOwoKICAgLyoqCiAgICAgKiBAZGV2IGBzZWxlY3RUZW1wbGF0ZWAgU2VsZWN0IGEgcHJvcG9zZWQgdGVtcGxhdGUgZm9yIHRoZSBpc3N1YW5jZQogICAgICogQHBhcmFtIF90ZW1wbGF0ZUluZGV4IEFycmF5IGluZGV4IG9mIHRoZSBkZWxlZ2F0ZXMgcHJvcG9zZWQgdGVtcGxhdGUKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbGVjdFRlbXBsYXRlKHVpbnQ4IF90ZW1wbGF0ZUluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIGNvbXBsaWFuY2UgcHJvb2YgaGFzaCBmb3IgdGhlIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX25ld01lcmtsZVJvb3QgTmV3IG1lcmtsZSByb290IGhhc2ggb2YgdGhlIGNvbXBsaWFuY2UgUHJvb2ZzCiAgICAgKiBAcGFyYW0gX2NvbXBsaWFuY2VQcm9vZiBDb21wbGlhbmNlIFByb29mIGhhc2gKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbXBsaWFuY2VQcm9vZigKICAgICAgICBieXRlczMyIF9uZXdNZXJrbGVSb290LAogICAgICAgIGJ5dGVzMzIgX2NvbXBsaWFuY2VQcm9vZgogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgYHNlbGVjdE9mZmVyaW5nUHJvcG9zYWxgIFNlbGVjdCBhbiBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBwcm9wb3NhbCBmb3IgdGhlIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBBcnJheSBpbmRleCBvZiB0aGUgU1RPIHByb3Bvc2FsCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBzZWxlY3RPZmZlcmluZ1Byb3Bvc2FsICgKICAgICAgICB1aW50OCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBTdGFydCB0aGUgb2ZmZXJpbmcgYnkgc2VuZGluZyBhbGwgdGhlIHRva2VucyB0byBTVE8gY29udHJhY3QKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBmdW5jdGlvbiBzdGFydE9mZmVyaW5nKCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgQWRkIGEgdmVyaWZpZWQgYWRkcmVzcyB0byB0aGUgU2VjdXJpdHkgVG9rZW4gd2hpdGVsaXN0CiAgICAgKiBAcGFyYW0gX3doaXRlbGlzdEFkZHJlc3MgQWRkcmVzcyBhdHRlbXB0aW5nIHRvIGpvaW4gU1Qgd2hpdGVsaXN0CiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBhZGRUb1doaXRlbGlzdCh1aW50OCBLWUNQcm92aWRlckluZGV4LCBhZGRyZXNzIF93aGl0ZWxpc3RBZGRyZXNzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAgLyoqCiAgICAgICogQGRldiBBbGxvdyBQT0xZIGFsbG9jYXRpb25zIHRvIGJlIHdpdGhkcmF3biBieSBvd25lciwgZGVsZWdhdGUsIGFuZCB0aGUgU1RPIGF1ZGl0b3IgYXQgYXBwcm9wcmlhdGUgdGltZXMKICAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcyAKICAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UG9seSgpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBWb3RlIHRvIGZyZWV6ZSB0aGUgZmVlIG9mIGEgY2VydGFpbiBuZXR3b3JrIHBhcnRpY2lwYW50CiAgICAgKiBAcGFyYW0gX3JlY2lwaWVudCBUaGUgZmVlIHJlY2lwaWVudCBiZWluZyBwcm90ZXN0ZWQKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHZvdGVUb0ZyZWV6ZShhZGRyZXNzIF9yZWNpcGllbnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBgaXNzdWVTZWN1cml0eVRva2Vuc2AgaXMgdXNlZCBieSB0aGUgU1RPIHRvIGtlZXAgdHJhY2sgb2YgU1RPIGludmVzdG9ycwogICAgICogQHBhcmFtIF9jb250cmlidXRvciBUaGUgYWRkcmVzcyBvZiB0aGUgcGVyc29uIHdob3NlIGNvbnRyaWJ1dGluZwogICAgICogQHBhcmFtIF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zIFRoZSBhbW91bnQgb2YgU1QgdG8gcGF5IG91dC4KICAgICAqIEBwYXJhbSBfcG9seUNvbnRyaWJ1dGVkIFRoZSBhbW91bnQgb2YgUE9MWSBwYWlkIGZvciB0aGUgc2VjdXJpdHkgdG9rZW5zLgogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVNlY3VyaXR5VG9rZW5zKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50MjU2IF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zLCB1aW50MjU2IF9wb2x5Q29udHJpYnV0ZWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBHZXQgdG9rZW4gZGV0YWlscwogICAgZnVuY3Rpb24gZ2V0VG9rZW5EZXRhaWxzKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYnl0ZXMzMiwgYWRkcmVzcywgYWRkcmVzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYXNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgICogQHBhcmFtIF90byBFdGhlcmV1bSBwdWJsaWMgYWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbnMgdG8KICAgICAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucyB0byBzZW5kCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgY29udHJhY3RzIHRvIHRyYW5zZmVyIHRva2VucyBvbiBiZWhhbGYgb2YgdG9rZW4gaG9sZGVycwogICAgICogQHBhcmFtIF9mcm9tIEFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20KICAgICAqIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogICAgICogQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgYGJhbGFuY2VPZmAgdXNlZCB0byBnZXQgdGhlIGJhbGFuY2Ugb2Ygc2hhcmVob2xkZXJzCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvKioKICAgICAqIEBkZXYgQXBwcm92ZSB0cmFuc2ZlciBvZiB0b2tlbnMgbWFudWFsbHkKICAgICAqIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGFwcHJvdmUgdHJhbnNmZXIgdG8KICAgICAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucyB0byBhcHByb3ZlIGZvciB0cmFuc2ZlcgogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFVzZSB0byBnZXQgdGhlIGFsbG93YW5jZSBwcm92aWRlZCB0byB0aGUgc3BlbmRlcgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAgKiBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogIH0KCi8qCiAgUG9seW1hdGggY29tcGxpYW5jZSBwcm90b2NvbCBpcyBpbnRlbmRlZCB0byBlbnN1cmUgcmVndWxhdG9yeSBjb21wbGlhbmNlCiAgaW4gdGhlIGp1cmlzZGljdGlvbnMgdGhhdCBzZWN1cml0eSB0b2tlbnMgYXJlIGJlaW5nIG9mZmVyZWQgaW4uIFRoZSBjb21wbGlhbmNlCiAgcHJvdG9jb2wgYWxsb3dzIHNlY3VyaXR5IHRva2VucyByZW1haW4gaW50ZXJvcGVyYWJsZSBzbyB0aGF0IGFueW9uZSBjYW4KICBidWlsZCBvbiB0b3Agb2YgdGhlIFBvbHltYXRoIHBsYXRmb3JtIGFuZCBleHRlbmQgaXQncyBmdW5jdGlvbmFsaXR5LgoqLwoKCgoKCgoKLyoqCiAqIEB0aXRsZSBDb21waWxhbmNlCiAqIEBkZXYgUmVndWxhdG9yeSBkZXRhaWxzIG9mZmVyZWQgYnkgdGhlIHNlY3VyaXR5IHRva2VuCiAqLwoKY29udHJhY3QgQ29tcGxpYW5jZSBpcyBJQ29tcGxpYW5jZSB7CgogICAgc3RyaW5nIHB1YmxpYyBWRVJTSU9OID0gIjEiOwoKICAgIElUZW1wbGF0ZSB0ZW1wbGF0ZTsKCiAgICBTZWN1cml0eVRva2VuUmVnaXN0cmFyIHB1YmxpYyBTVFJlZ2lzdHJhcjsKCiAgICBzdHJ1Y3QgVGVtcGxhdGVSZXB1dGF0aW9uIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cnVjdHVyZSBjb250YWlucyB0aGUgY29tcGxpYW5jZSB0ZW1wbGF0ZSBkZXRhaWxzCiAgICAgICAgYWRkcmVzcyBvd25lcjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHRlbXBsYXRlIG93bmVyCiAgICAgICAgdWludDI1NiB0b3RhbFJhaXNlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvdGFsIGFtb3VudCByYWlzZWQgYnkgdGhlIGlzc3VlcnMgdGhhdCB1c2VkIHRoZSB0ZW1wbGF0ZQogICAgICAgIHVpbnQyNTYgdGltZXNVc2VkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIb3cgbWFueSB0aW1lcyB0ZW1wbGF0ZSB3aWxsIGJlIHVzZWQgYXMgdGhlIGNvbXBsaWFuY2UgcmVndWxhdG9yIGZvciBkaWZmZXJlbnQgc2VjdXJpdHkgdG9rZW4KICAgICAgICB1aW50MjU2IGV4cGlyZXM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gdGVtcGxhdGUgZ2V0IGV4cGlyZQogICAgICAgIGFkZHJlc3NbXSB1c2VkQnk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcnJheSBvZiBzZWN1cml0eSB0b2tlbiBhZGRyZXNzZXMgdGhhdCB1c2VkIHRoZSBwYXJ0aWN1bGFyIHRlbXBsYXRlCiAgICB9CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gVGVtcGxhdGVSZXB1dGF0aW9uKSBwdWJsaWMgdGVtcGxhdGVzOyAgICAgICAgICAgICAgICAgICAvLyBNYXBwaW5nIHVzZWQgZm9yIHN0b3JpbmcgdGhlIHRlbXBsYXRlIHBhc3QgcmVjb3JkcyBjb3JyZXNwb25kcyB0byB0ZW1wbGF0ZSBhZGRyZXNzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYWRkcmVzc1tdKSBwdWJsaWMgdGVtcGxhdGVQcm9wb3NhbHM7ICAgICAgICAgICAgIC8vIFRlbXBsYXRlIHByb3Bvc2FscyBmb3IgYSBzcGVjaWZpYyBzZWN1cml0eSB0b2tlbgoKICAgIHN0cnVjdCBPZmZlcmluZyB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU21hcnQgY29udHJhY3QgcHJvcG9zYWxzIGZvciBhIHNwZWNpZmljIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nCiAgICAgICAgYWRkcmVzcyBhdWRpdG9yOwogICAgICAgIHVpbnQyNTYgZmVlOwogICAgICAgIHVpbnQyNTYgdmVzdGluZ1BlcmlvZDsKICAgICAgICB1aW50OCBxdW9ydW07CiAgICAgICAgYWRkcmVzc1tdIHVzZWRCeTsKICAgIH0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBPZmZlcmluZykgb2ZmZXJpbmdzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFwcGluZyB1c2VkIGZvciBzdG9yaW5nIHRoZSBPZmZlcmluZyBkZXRpYWxzIGNvcnJlc3BvbmRzIHRvIG9mZmVyaW5nIGNvbnRyYWN0IGFkZHJlc3MKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBhZGRyZXNzW10pIHB1YmxpYyBvZmZlcmluZ1Byb3Bvc2FsczsgICAgICAgICAgICAgLy8gU2VjdXJpdHkgdG9rZW4gY29udHJhY3QgcHJvcG9zYWxzIGZvciBhIHNwZWNpZmljIHNlY3VyaXR5IHRva2VuCgogICAgQ3VzdG9tZXJzIHB1YmxpYyBQb2x5Q3VzdG9tZXJzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFuY2Ugb2YgdGhlIENvbXBsaWFuY2UgY29udHJhY3QKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1JTklNVU1fVkVTVElOR19QRVJJT0QgPSA2MCAqIDYwICogMjQgKiAxMDA7IC8vIDEwMCBEYXkgbWluaW11bSB2ZXN0aW5nIHBlcmlvZCBmb3IgUE9MWSBlYXJuZWQKCiAgICAvLyBOb3RpZmljYXRpb25zCiAgICBldmVudCBMb2dUZW1wbGF0ZUNyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIF9jcmVhdG9yLCBhZGRyZXNzIF90ZW1wbGF0ZSwgc3RyaW5nIF9vZmZlcmluZ1R5cGUpOwogICAgZXZlbnQgTG9nTmV3VGVtcGxhdGVQcm9wb3NhbChhZGRyZXNzIGluZGV4ZWQgX3NlY3VyaXR5VG9rZW4sIGFkZHJlc3MgX3RlbXBsYXRlLCBhZGRyZXNzIF9kZWxlZ2F0ZSwgdWludCBfdGVtcGxhdGVQcm9wb3NhbEluZGV4KTsKICAgIGV2ZW50IExvZ0NhbmNlbFRlbXBsYXRlUHJvcG9zYWwoYWRkcmVzcyBpbmRleGVkIF9zZWN1cml0eVRva2VuLCBhZGRyZXNzIF90ZW1wbGF0ZSwgdWludCBfdGVtcGxhdGVQcm9wb3NhbEluZGV4KTsKICAgIGV2ZW50IExvZ05ld0NvbnRyYWN0UHJvcG9zYWwoYWRkcmVzcyBpbmRleGVkIF9zZWN1cml0eVRva2VuLCBhZGRyZXNzIF9vZmZlcmluZ0NvbnRyYWN0LCBhZGRyZXNzIF9kZWxlZ2F0ZSwgdWludCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KTsKICAgIGV2ZW50IExvZ0NhbmNlbENvbnRyYWN0UHJvcG9zYWwoYWRkcmVzcyBpbmRleGVkIF9zZWN1cml0eVRva2VuLCBhZGRyZXNzIF9vZmZlcmluZ0NvbnRyYWN0LCB1aW50IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpOwoKICAgIC8qIEBwYXJhbSBfcG9seUN1c3RvbWVyc0FkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIFBvbHltYXRoIEN1c3RvbWVycyBjb250cmFjdCAqLwogICAgZnVuY3Rpb24gQ29tcGxpYW5jZShhZGRyZXNzIF9wb2x5Q3VzdG9tZXJzQWRkcmVzcykgcHVibGljIHsKICAgICAgICBQb2x5Q3VzdG9tZXJzID0gQ3VzdG9tZXJzKF9wb2x5Q3VzdG9tZXJzQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBzZXRSZWdzaXRyYXJBZGRyZXNzYCBUaGlzIGZ1bmN0aW9uIHNldCB0aGUgU2VjdXJpdHlUb2tlblJlZ2lzdHJhciBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF9TVFJlZ2lzdHJhciBJdCBpcyB0aGUgYHRoaXNgIHJlZmVyZW5jZSBvZiBTVFIgY29udHJhY3QKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCgogICAgZnVuY3Rpb24gc2V0UmVnc2l0cmFyQWRkcmVzcyhhZGRyZXNzIF9TVFJlZ2lzdHJhcikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKFNUUmVnaXN0cmFyID09IGFkZHJlc3MoMCkpOwogICAgICAgIFNUUmVnaXN0cmFyID0gU2VjdXJpdHlUb2tlblJlZ2lzdHJhcihfU1RSZWdpc3RyYXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgY3JlYXRlVGVtcGxhdGVgIGlzIGEgc2ltcGxlIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBjb21wbGlhbmNlIHRlbXBsYXRlCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nVHlwZSBUaGUgbmFtZSBvZiB0aGUgc2VjdXJpdHkgYmVpbmcgaXNzdWVkCiAgICAgKiBAcGFyYW0gX2lzc3Vlckp1cmlzZGljdGlvbiBUaGUganVyaXNkaWN0aW9uIGlkIG9mIHRoZSBpc3N1ZXIKICAgICAqIEBwYXJhbSBfYWNjcmVkaXRlZCBBY2NyZWRpdGF0aW9uIHN0YXR1cyByZXF1aXJlZCBmb3IgaW52ZXN0b3JzCiAgICAgKiBAcGFyYW0gX0tZQyBLWUMgcHJvdmlkZXIgdXNlZCBieSB0aGUgdGVtcGxhdGUKICAgICAqIEBwYXJhbSBfZGV0YWlscyBEZXRhaWxzIG9mIHRoZSBvZmZlcmluZyByZXF1aXJlbWVudHMKICAgICAqIEBwYXJhbSBfZXhwaXJlcyBUaW1lc3RhbXAgb2Ygd2hlbiB0aGUgdGVtcGxhdGUgd2lsbCBleHBpcmUKICAgICAqIEBwYXJhbSBfZmVlIEFtb3VudCBvZiBQT0xZIHRvIHVzZSB0aGUgdGVtcGxhdGUgKGhlbGQgaW4gZXNjcm93IHVudGlsIGlzc3VhbmNlKQogICAgICogQHBhcmFtIF9xdW9ydW0gTWluaW11bSBwZXJjZW50IG9mIHNoYXJlaG9sZGVycyB3aGljaCBuZWVkIHRvIHZvdGUgdG8gZnJlZXplCiAgICAgKiBAcGFyYW0gX3Zlc3RpbmdQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgdG8gdmVzdCBmdW5kcwogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUZW1wbGF0ZSgKICAgICAgICBzdHJpbmcgX29mZmVyaW5nVHlwZSwKICAgICAgICBieXRlczMyIF9pc3N1ZXJKdXJpc2RpY3Rpb24sCiAgICAgICAgYm9vbCBfYWNjcmVkaXRlZCwKICAgICAgICBhZGRyZXNzIF9LWUMsCiAgICAgICAgYnl0ZXMzMiBfZGV0YWlscywKICAgICAgICB1aW50MjU2IF9leHBpcmVzLAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50OCBfcXVvcnVtLAogICAgICAgIHVpbnQyNTYgX3Zlc3RpbmdQZXJpb2QKICAgICkgcHVibGljCiAgICB7CiAgICAgIHJlcXVpcmUoX0tZQyAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShfdmVzdGluZ1BlcmlvZCA+PSBNSU5JTVVNX1ZFU1RJTkdfUEVSSU9EKTsKICAgICAgYWRkcmVzcyBfdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUoCiAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgX29mZmVyaW5nVHlwZSwKICAgICAgICAgIF9pc3N1ZXJKdXJpc2RpY3Rpb24sCiAgICAgICAgICBfYWNjcmVkaXRlZCwKICAgICAgICAgIF9LWUMsCiAgICAgICAgICBfZGV0YWlscywKICAgICAgICAgIF9leHBpcmVzLAogICAgICAgICAgX2ZlZSwKICAgICAgICAgIF9xdW9ydW0sCiAgICAgICAgICBfdmVzdGluZ1BlcmlvZAogICAgICApOwogICAgICB0ZW1wbGF0ZXNbX3RlbXBsYXRlXSA9IFRlbXBsYXRlUmVwdXRhdGlvbih7CiAgICAgICAgICBvd25lcjogbXNnLnNlbmRlciwKICAgICAgICAgIHRvdGFsUmFpc2VkOiAwLAogICAgICAgICAgdGltZXNVc2VkOiAwLAogICAgICAgICAgZXhwaXJlczogX2V4cGlyZXMsCiAgICAgICAgICB1c2VkQnk6IG5ldyBhZGRyZXNzW10oMCkKICAgICAgfSk7CiAgICAgIExvZ1RlbXBsYXRlQ3JlYXRlZChtc2cuc2VuZGVyLCBfdGVtcGxhdGUsIF9vZmZlcmluZ1R5cGUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQcm9wb3NlIGEgYmlkIGZvciBhIHNlY3VyaXR5IHRva2VuIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW4gVGhlIHNlY3VyaXR5IHRva2VuIGJlaW5nIGJpZCBvbgogICAgICogQHBhcmFtIF90ZW1wbGF0ZSBUaGUgdW5pcXVlIHRlbXBsYXRlIGFkZHJlc3MKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VUZW1wbGF0ZSgKICAgICAgICBhZGRyZXNzIF9zZWN1cml0eVRva2VuLAogICAgICAgIGFkZHJlc3MgX3RlbXBsYXRlCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gVmVyaWZ5aW5nIHRoYXQgcHJvdmlkZWQgX3NlY3VyaXR5VG9rZW4gaXMgZ2VuZXJhdGVkIGJ5IHNlY3VyaXR5VG9rZW5SZWdpc3RyYXIgb25seQogICAgICAgIHZhciAodG90YWxTdXBwbHksIG93bmVyLCwpID0gU1RSZWdpc3RyYXIuZ2V0U2VjdXJpdHlUb2tlbkRhdGEoX3NlY3VyaXR5VG9rZW4pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPiAwICYmIG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIFJlcXVpcmUgdGhhdCB0ZW1wbGF0ZSBoYXMgbm90IGV4cGlyZWQsIHRoYXQgdGhlIGNhbGxlciBpcyB0aGUKICAgICAgICAvLyBvd25lciBvZiB0aGUgdGVtcGxhdGUgYW5kIHRoYXQgdGhlIHRlbXBsYXRlIGhhcyBiZWVuIGZpbmFsaXplZAogICAgICAgIHJlcXVpcmUodGVtcGxhdGVzW190ZW1wbGF0ZV0uZXhwaXJlcyA+IG5vdyk7CiAgICAgICAgcmVxdWlyZSh0ZW1wbGF0ZXNbX3RlbXBsYXRlXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAvLyBDcmVhdGluZyB0aGUgaW5zdGFuY2Ugb2YgdGVtcGxhdGUgdG8gYXZhaWwgdGhlIGZ1bmN0aW9uIGNhbGxpbmcKICAgICAgICB0ZW1wbGF0ZSA9IFRlbXBsYXRlKF90ZW1wbGF0ZSk7CiAgICAgICAgdmFyICgsZmluYWxpemVkKSA9IHRlbXBsYXRlLmdldFRlbXBsYXRlRGV0YWlscygpOwogICAgICAgIHJlcXVpcmUoZmluYWxpemVkKTsKCiAgICAgICAgLy9HZXQgYSByZWZlcmVuY2Ugb2YgdGhlIHRlbXBsYXRlIGNvbnRyYWN0IGFuZCBhZGQgaXQgdG8gdGhlIHRlbXBsYXRlUHJvcG9zYWxzIGFycmF5CiAgICAgICAgdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5dLnB1c2goX3RlbXBsYXRlKTsKICAgICAgICBMb2dOZXdUZW1wbGF0ZVByb3Bvc2FsKF9zZWN1cml0eVRva2VuLCBfdGVtcGxhdGUsIG1zZy5zZW5kZXIsdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5dLmxlbmd0aCAtMSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbmNlbCBhIFRlbXBsYXRlIHByb3Bvc2FsIGlmIHRoZSBiaWQgaGFzbid0IGJlZW4gYWNjZXB0ZWQKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlUHJvcG9zYWxJbmRleCBUaGUgdGVtcGxhdGUgcHJvcG9zYWwgYXJyYXkgaW5kZXgKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbmNlbFRlbXBsYXRlUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfc2VjdXJpdHlUb2tlbiwKICAgICAgICB1aW50MjU2IF90ZW1wbGF0ZVByb3Bvc2FsSW5kZXgKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBhZGRyZXNzIHByb3Bvc2VkVGVtcGxhdGUgPSB0ZW1wbGF0ZVByb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl1bX3RlbXBsYXRlUHJvcG9zYWxJbmRleF07CiAgICAgICAgcmVxdWlyZSh0ZW1wbGF0ZXNbcHJvcG9zZWRUZW1wbGF0ZV0ub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgdmFyIChjaG9zZW5UZW1wbGF0ZSwsLCwpID0gSVNlY3VyaXR5VG9rZW4oX3NlY3VyaXR5VG9rZW4pLmdldFRva2VuRGV0YWlscygpOwogICAgICAgIHJlcXVpcmUoY2hvc2VuVGVtcGxhdGUgIT0gcHJvcG9zZWRUZW1wbGF0ZSk7CiAgICAgICAgdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5dW190ZW1wbGF0ZVByb3Bvc2FsSW5kZXhdID0gYWRkcmVzcygwKTsKICAgICAgICBMb2dDYW5jZWxUZW1wbGF0ZVByb3Bvc2FsKF9zZWN1cml0eVRva2VuLCBwcm9wb3NlZFRlbXBsYXRlLCBfdGVtcGxhdGVQcm9wb3NhbEluZGV4KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCB0aGUgU1RPIGNvbnRyYWN0IGJ5IHRoZSBpc3N1ZXIuCiAgICAgKiBAcGFyYW0gX1NUT0FkZHJlc3MgYWRkcmVzcyBvZiB0aGUgU1RPIGNvbnRyYWN0IGRlcGxveWVkIG92ZXIgdGhlIG5ldHdvcmsuCiAgICAgKiBAcGFyYW0gX2ZlZSBmZWUgdG8gYmUgcGFpZCBpbiBwb2x5IHRvIHVzZSB0aGF0IGNvbnRyYWN0CiAgICAgKiBAcGFyYW0gX3Zlc3RpbmdQZXJpb2Qgbm8uIG9mIGRheXMgaW52ZXN0b3IgYmluZGVkIHRvIGhvbGQgdGhlIFNlY3VyaXR5IHRva2VuCiAgICAgKiBAcGFyYW0gX3F1b3J1bSBNaW5pbXVtIHBlcmNlbnQgb2Ygc2hhcmVob2xkZXJzIHdoaWNoIG5lZWQgdG8gdm90ZSB0byBmcmVlemUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0U1RPICgKICAgICAgICBhZGRyZXNzIF9TVE9BZGRyZXNzLAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50MjU2IF92ZXN0aW5nUGVyaW9kLAogICAgICAgIHVpbnQ4IF9xdW9ydW0KICAgICAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgICAgIHJlcXVpcmUob2ZmZXJpbmdzW19TVE9BZGRyZXNzXS5hdWRpdG9yID09IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKF9TVE9BZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKF9xdW9ydW0gPiAwICYmIF9xdW9ydW0gPD0gMTAwKTsKICAgICAgICAgICAgcmVxdWlyZShfdmVzdGluZ1BlcmlvZCA+PSBNSU5JTVVNX1ZFU1RJTkdfUEVSSU9EKTsKICAgICAgICAgICAgcmVxdWlyZShfZmVlID4gMCk7CiAgICAgICAgICAgIG9mZmVyaW5nc1tfU1RPQWRkcmVzc10uYXVkaXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgIG9mZmVyaW5nc1tfU1RPQWRkcmVzc10uZmVlID0gX2ZlZTsKICAgICAgICAgICAgb2ZmZXJpbmdzW19TVE9BZGRyZXNzXS52ZXN0aW5nUGVyaW9kID0gX3Zlc3RpbmdQZXJpb2Q7CiAgICAgICAgICAgIG9mZmVyaW5nc1tfU1RPQWRkcmVzc10ucXVvcnVtID0gX3F1b3J1bTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFByb3Bvc2UgYSBTZWN1cml0eSBUb2tlbiBPZmZlcmluZyBDb250cmFjdCBmb3IgYW4gaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3N0b0NvbnRyYWN0IFRoZSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBjb250cmFjdCBhZGRyZXNzCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBwcm9wb3NlT2ZmZXJpbmdDb250cmFjdCgKICAgICAgICBhZGRyZXNzIF9zZWN1cml0eVRva2VuLAogICAgICAgIGFkZHJlc3MgX3N0b0NvbnRyYWN0CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gVmVyaWZ5aW5nIHRoYXQgcHJvdmlkZWQgX3NlY3VyaXR5VG9rZW4gaXMgZ2VuZXJhdGVkIGJ5IHNlY3VyaXR5VG9rZW5SZWdpc3RyYXIgb25seQogICAgICAgIHZhciAodG90YWxTdXBwbHksIG93bmVyLCwpID0gU1RSZWdpc3RyYXIuZ2V0U2VjdXJpdHlUb2tlbkRhdGEoX3NlY3VyaXR5VG9rZW4pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPiAwICYmIG93bmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB2YXIgKCwsLCxLWUMpID0gSVNlY3VyaXR5VG9rZW4oX3NlY3VyaXR5VG9rZW4pLmdldFRva2VuRGV0YWlscygpOwogICAgICAgIHZhciAoLCwsIHZlcmlmaWVkLCBleHBpcmVzKSA9IFBvbHlDdXN0b21lcnMuZ2V0Q3VzdG9tZXIoS1lDLCBvZmZlcmluZ3NbX3N0b0NvbnRyYWN0XS5hdWRpdG9yKTsKICAgICAgICByZXF1aXJlKG9mZmVyaW5nc1tfc3RvQ29udHJhY3RdLmF1ZGl0b3IgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSh2ZXJpZmllZCk7CiAgICAgICAgcmVxdWlyZShleHBpcmVzID4gbm93KTsKICAgICAgICBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl0ucHVzaChfc3RvQ29udHJhY3QpOwogICAgICAgIExvZ05ld0NvbnRyYWN0UHJvcG9zYWwoX3NlY3VyaXR5VG9rZW4sIF9zdG9Db250cmFjdCwgbXNnLnNlbmRlcixvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl0ubGVuZ3RoIC0xKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2FuY2VsIGEgU1RPIGNvbnRyYWN0IHByb3Bvc2FsIGlmIHRoZSBiaWQgaGFzbid0IGJlZW4gYWNjZXB0ZWQKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBUaGUgb2ZmZXJpbmcgcHJvcG9zYWwgYXJyYXkgaW5kZXgKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbmNlbE9mZmVyaW5nUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfc2VjdXJpdHlUb2tlbiwKICAgICAgICB1aW50MjU2IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBhZGRyZXNzIHByb3Bvc2VkT2ZmZXJpbmcgPSBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl1bX29mZmVyaW5nUHJvcG9zYWxJbmRleF07CiAgICAgICAgcmVxdWlyZShvZmZlcmluZ3NbcHJvcG9zZWRPZmZlcmluZ10uYXVkaXRvciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICB2YXIgKCwsLCxjaG9zZW5PZmZlcmluZykgPSBJU2VjdXJpdHlUb2tlbihfc2VjdXJpdHlUb2tlbikuZ2V0VG9rZW5EZXRhaWxzKCk7CiAgICAgICAgcmVxdWlyZShjaG9zZW5PZmZlcmluZyAhPSBwcm9wb3NlZE9mZmVyaW5nKTsKICAgICAgICBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl1bX29mZmVyaW5nUHJvcG9zYWxJbmRleF0gPSBhZGRyZXNzKDApOwogICAgICAgIExvZ0NhbmNlbENvbnRyYWN0UHJvcG9zYWwoX3NlY3VyaXR5VG9rZW4sIHByb3Bvc2VkT2ZmZXJpbmcsIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYHVwZGF0ZVRlbXBsYXRlUmVwdXRhdGlvbmAgaXMgYSBjb25zdGFudCBmdW5jdGlvbiB0aGF0IHVwZGF0ZXMgdGhlCiAgICAgICBoaXN0b3J5IG9mIGEgc2VjdXJpdHkgdG9rZW4gdGVtcGxhdGUgdXNhZ2UgdG8ga2VlcCB0cmFjayBvZiBwcmV2aW91cyB1c2VzCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlIFRoZSB1bmlxdWUgdGVtcGxhdGUgaWQKICAgICAqIEBwYXJhbSBfdGVtcGxhdGVJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIHRlbXBsYXRlIHByb3Bvc2FsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZVRlbXBsYXRlUmVwdXRhdGlvbiAoYWRkcmVzcyBfdGVtcGxhdGUsIHVpbnQ4IF90ZW1wbGF0ZUluZGV4KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRlbXBsYXRlUHJvcG9zYWxzW21zZy5zZW5kZXJdW190ZW1wbGF0ZUluZGV4XSA9PSBfdGVtcGxhdGUpOwogICAgICAgIHRlbXBsYXRlc1tfdGVtcGxhdGVdLnVzZWRCeS5wdXNoKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgdXBkYXRlT2ZmZXJpbmdSZXB1dGF0aW9uYCBpcyBhIGNvbnN0YW50IGZ1bmN0aW9uIHRoYXQgdXBkYXRlcyB0aGUKICAgICAgIGhpc3Rvcnkgb2YgYSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBjb250cmFjdCB0byBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHVzZXMKICAgICAqIEBwYXJhbSBfc3RvQ29udHJhY3QgVGhlIHNtYXJ0IGNvbnRyYWN0IGFkZHJlc3Mgb2YgdGhlIFNUTyBjb250cmFjdAogICAgICogQHBhcmFtIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXggVGhlIGFycmF5IGluZGV4IG9mIHRoZSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBwcm9wb3NhbAogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVPZmZlcmluZ1JlcHV0YXRpb24gKGFkZHJlc3MgX3N0b0NvbnRyYWN0LCB1aW50OCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG9mZmVyaW5nUHJvcG9zYWxzW21zZy5zZW5kZXJdW19vZmZlcmluZ1Byb3Bvc2FsSW5kZXhdID09IF9zdG9Db250cmFjdCk7CiAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0udXNlZEJ5LnB1c2gobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEdldCB0ZW1wbGF0ZSBkZXRhaWxzIGJ5IHRoZSBwcm9wb3NhbCBpbmRleAogICAgICogQHBhcmFtIF9zZWN1cml0eVRva2VuQWRkcmVzcyBUaGUgc2VjdXJpdHkgdG9rZW4gZXRoZXJldW0gYWRkcmVzcwogICAgICogQHBhcmFtIF90ZW1wbGF0ZUluZGV4IFRoZSBhcnJheSBpbmRleCBvZiB0aGUgdGVtcGxhdGUgYmVpbmcgY2hlY2tlZAogICAgICogQHJldHVybiBUZW1wbGF0ZSBzdHJ1Y3QKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVCeVByb3Bvc2FsKGFkZHJlc3MgX3NlY3VyaXR5VG9rZW5BZGRyZXNzLCB1aW50OCBfdGVtcGxhdGVJbmRleCkgdmlldyBwdWJsaWMgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBfdGVtcGxhdGUKICAgICl7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlUHJvcG9zYWxzW19zZWN1cml0eVRva2VuQWRkcmVzc11bX3RlbXBsYXRlSW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBHZXQgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgYWRkcmVzcyBvZiBhbGwgdGVtcGxhdGUgcHJvcG9zYWxzIGZvciBhIGdpdmVuIFNUCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW5BZGRyZXNzIFRoZSBzZWN1cml0eSB0b2tlbiBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcmV0dXJuIFRlbXBsYXRlIHByb3Bvc2FscyBhcnJheQogICAgICovCiAgICBmdW5jdGlvbiBnZXRBbGxUZW1wbGF0ZVByb3Bvc2FscyhhZGRyZXNzIF9zZWN1cml0eVRva2VuQWRkcmVzcykgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzc1tdKXsKICAgICAgICByZXR1cm4gdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5BZGRyZXNzXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgR2V0IHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIHNtYXJ0IGNvbnRyYWN0IGRldGFpbHMgYnkgdGhlIHByb3Bvc2FsIGluZGV4CiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW5BZGRyZXNzIFRoZSBzZWN1cml0eSB0b2tlbiBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIFNUTyBjb250cmFjdCBiZWluZyBjaGVja2VkCiAgICAgKiBAcmV0dXJuIENvbnRyYWN0IHN0cnVjdAogICAgICovCiAgICBmdW5jdGlvbiBnZXRPZmZlcmluZ0J5UHJvcG9zYWwoYWRkcmVzcyBfc2VjdXJpdHlUb2tlbkFkZHJlc3MsIHVpbnQ4IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKAogICAgICAgIGFkZHJlc3Mgc3RvQ29udHJhY3QsCiAgICAgICAgYWRkcmVzcyBhdWRpdG9yLAogICAgICAgIHVpbnQyNTYgdmVzdGluZ1BlcmlvZCwKICAgICAgICB1aW50OCBxdW9ydW0sCiAgICAgICAgdWludDI1NiBmZWUKICAgICl7CiAgICAgICAgYWRkcmVzcyBfc3RvQ29udHJhY3QgPSBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbkFkZHJlc3NdW19vZmZlcmluZ1Byb3Bvc2FsSW5kZXhdOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIF9zdG9Db250cmFjdCwKICAgICAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0uYXVkaXRvciwKICAgICAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0udmVzdGluZ1BlcmlvZCwKICAgICAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0ucXVvcnVtLAogICAgICAgICAgICBvZmZlcmluZ3NbX3N0b0NvbnRyYWN0XS5mZWUKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBHZXQgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgYWRkcmVzcyBvZiBhbGwgb2ZmZXJpbmcgcHJvcG9zYWxzIGZvciBhIGdpdmVuIFNUCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW5BZGRyZXNzIFRoZSBzZWN1cml0eSB0b2tlbiBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcmV0dXJuIE9mZmVyaW5nIHByb3Bvc2FscyBhcnJheQogICAgICovCiAgICBmdW5jdGlvbiBnZXRBbGxPZmZlcmluZ1Byb3Bvc2FscyhhZGRyZXNzIF9zZWN1cml0eVRva2VuQWRkcmVzcykgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzc1tdKXsKICAgICAgICByZXR1cm4gb2ZmZXJpbmdQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5BZGRyZXNzXTsKICAgIH0KCn0KCi8qCiAgVGhlIFBvbHltYXRoIFNlY3VyaXR5IFRva2VuIFJlZ2lzdHJhciBwcm92aWRlcyBhIHdheSB0byBsb29rdXAgc2VjdXJpdHkgdG9rZW4gZGV0YWlscwogIGZyb20gYSBzaW5nbGUgcGxhY2UgYW5kIGFsbG93cyB3aXphcmQgY3JlYXRvcnMgdG8gZWFybiBQT0xZIGZlZXMgYnkgdXBsb2FkaW5nIHRvIHRoZQogIHJlZ2lzdHJhci4KKi8KCgoKCgoKLyoqCiAqIEB0aXRsZSBTZWN1cml0eVRva2VuUmVnaXN0cmFyCiAqIEBkZXYgQ29udHJhY3QgdXNlIHRvIHJlZ2lzdGVyIHRoZSBzZWN1cml0eSB0b2tlbiBvbiBQb2x5bWF0aCBwbGF0Zm9ybQogKi8KCmNvbnRyYWN0IFNlY3VyaXR5VG9rZW5SZWdpc3RyYXIgaXMgSVNUUmVnaXN0cmFyIHsKCiAgICBzdHJpbmcgcHVibGljIFZFUlNJT04gPSAiMSI7CiAgICBTZWN1cml0eVRva2VuIHNlY3VyaXR5VG9rZW47CiAgICBhZGRyZXNzIHB1YmxpYyBwb2x5VG9rZW5BZGRyZXNzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiBQT0xZIHRva2VuCiAgICBhZGRyZXNzIHB1YmxpYyBwb2x5Q3VzdG9tZXJzQWRkcmVzczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgcG9seW1hdGgtY29yZSBDdXN0b21lcnMgY29udHJhY3QgYWRkcmVzcwogICAgYWRkcmVzcyBwdWJsaWMgcG9seUNvbXBsaWFuY2VBZGRyZXNzOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHBvbHltYXRoLWNvcmUgQ29tcGxpYW5jZSBjb250cmFjdCBhZGRyZXNzCgogICAgLy8gU2VjdXJpdHkgVG9rZW4KICAgIHN0cnVjdCBTZWN1cml0eVRva2VuRGF0YSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBIHN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIHRoZSBzcGVjaWZpYyBpbmZvIG9mIGVhY2ggU1QKICAgICAgdWludDI1NiB0b3RhbFN1cHBseTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGVkIGV2ZXIgdXNpbmcgdGhlIFBvbHltYXRoIHBsYXRmb3JtCiAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgIHVpbnQ4IGRlY2ltYWxzOwogICAgICBzdHJpbmcgdGlja2VyOwogICAgICB1aW50OCBzZWN1cml0eVR5cGU7CiAgICB9CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gU2VjdXJpdHlUb2tlbkRhdGEpIHNlY3VyaXR5VG9rZW5zOyAgICAgICAgICAgLy8gQXJyYXkgY29udGFpbnMgdGhlIGRldGFpbHMgb2Ygc2VjdXJpdHkgdG9rZW4gY29ycmVzcG9uZHMgdG8gc2VjdXJpdHkgdG9rZW4gYWRkcmVzcwogICAgbWFwcGluZyhzdHJpbmcgPT4gYWRkcmVzcykgdGlja2VyczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1hcHBpbmcgb2YgdGlja2VyIG5hbWUgdG8gU2VjdXJpdHkgVG9rZW4KCiAgICBldmVudCBMb2dOZXdTZWN1cml0eVRva2VuKHN0cmluZyB0aWNrZXIsIGFkZHJlc3Mgc2VjdXJpdHlUb2tlbkFkZHJlc3MsIGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgaG9zdCwgdWludDI1NiBmZWUsIHVpbnQ4IF90eXBlKTsKICAgIC8qKgogICAgICogQGRldiBDb25zdHJ1Y3RvciB1c2UgdG8gc2V0IHRoZSBlc3NlbnRpYWxzIGFkZHJlc3NlcyB0byBmYWNpbGl0YXRlCiAgICAgKiB0aGUgY3JlYXRpb24gb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNlY3VyaXR5VG9rZW5SZWdpc3RyYXIoCiAgICAgIGFkZHJlc3MgX3BvbHlUb2tlbkFkZHJlc3MsCiAgICAgIGFkZHJlc3MgX3BvbHlDdXN0b21lcnNBZGRyZXNzLAogICAgICBhZGRyZXNzIF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MKICAgICkgcHVibGljCiAgICB7CiAgICAgIHBvbHlUb2tlbkFkZHJlc3MgPSBfcG9seVRva2VuQWRkcmVzczsKICAgICAgcG9seUN1c3RvbWVyc0FkZHJlc3MgPSBfcG9seUN1c3RvbWVyc0FkZHJlc3M7CiAgICAgIHBvbHlDb21wbGlhbmNlQWRkcmVzcyA9IF9wb2x5Q29tcGxpYW5jZUFkZHJlc3M7CiAgICAgIC8vIENyZWF0aW5nIHRoZSBpbnN0YW5jZSBvZiB0aGUgY29tcGxpYW5jZSBjb250cmFjdCBhbmQgYXNzaWduIHRoZSBTVFIgY29udHJhY3QgCiAgICAgIC8vIGFkZHJlc3MgKHRoaXMpIGludG8gdGhlIGNvbXBsaWFuY2UgY29udHJhY3QKICAgICAgQ29tcGxpYW5jZSBQb2x5Q29tcGxpYW5jZSA9IENvbXBsaWFuY2UocG9seUNvbXBsaWFuY2VBZGRyZXNzKTsKICAgICAgcmVxdWlyZShQb2x5Q29tcGxpYW5jZS5zZXRSZWdzaXRyYXJBZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlcyBhIG5ldyBTZWN1cml0eSBUb2tlbiBhbmQgc2F2ZXMgaXQgdG8gdGhlIHJlZ2lzdHJ5CiAgICAgKiBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICAqIEBwYXJhbSBfdGlja2VyIFRpY2tlciBuYW1lIG9mIHRoZSBzZWN1cml0eQogICAgICogQHBhcmFtIF90b3RhbFN1cHBseSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGJlaW5nIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBfZGVjaW1hbHMgRGVjaW1hbHMgdmFsdWUgZm9yIHRva2VuCiAgICAgKiBAcGFyYW0gX293bmVyIEV0aGVyZXVtIHB1YmxpYyBrZXkgYWRkcmVzcyBvZiB0aGUgc2VjdXJpdHkgdG9rZW4gb3duZXIKICAgICAqIEBwYXJhbSBfbWF4UG9seSBBbW91bnQgb2YgbWF4aW11bSBwb2x5IGlzc3VlciB3YW50IHRvIHJhaXNlCiAgICAgKiBAcGFyYW0gX2hvc3QgVGhlIGhvc3Qgb2YgdGhlIHNlY3VyaXR5IHRva2VuIHdpemFyZAogICAgICogQHBhcmFtIF9mZWUgRmVlIGJlaW5nIHJlcXVlc3RlZCBieSB0aGUgd2l6YXJkIGhvc3QKICAgICAqIEBwYXJhbSBfdHlwZSBUeXBlIG9mIHNlY3VyaXR5IGJlaW5nIHRva2VuaXplZAogICAgICogQHBhcmFtIF9sb2NrdXBQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgcmFpc2VkIFBPTFkgd2lsbCBiZSBsb2NrZWQgdXAgZm9yIGRpc3B1dGUKICAgICAqIEBwYXJhbSBfcXVvcnVtIFBlcmNlbnQgb2YgaW5pdGlhbCBpbnZlc3RvcnMgcmVxdWlyZWQgdG8gZnJlZXplIFBPTFkgcmFpc2UKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlU2VjdXJpdHlUb2tlbiAoCiAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgc3RyaW5nIF90aWNrZXIsCiAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5LAogICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICB1aW50MjU2IF9tYXhQb2x5LAogICAgICBhZGRyZXNzIF9ob3N0LAogICAgICB1aW50MjU2IF9mZWUsCiAgICAgIHVpbnQ4IF90eXBlLAogICAgICB1aW50MjU2IF9sb2NrdXBQZXJpb2QsCiAgICAgIHVpbnQ4IF9xdW9ydW0KICAgICkgZXh0ZXJuYWwKICAgIHsKICAgICAgcmVxdWlyZShfdG90YWxTdXBwbHkgPiAwICYmIF9tYXhQb2x5ID4gMCAmJiBfZmVlID4gMCk7CiAgICAgIHJlcXVpcmUodGlja2Vyc1tfdGlja2VyXSA9PSAweDApOwogICAgICByZXF1aXJlKF9sb2NrdXBQZXJpb2QgPj0gbm93KTsKICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSAmJiBfaG9zdCAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShieXRlcyhfbmFtZSkubGVuZ3RoID4gMCAmJiBieXRlcyhfdGlja2VyKS5sZW5ndGggPiAwKTsKICAgICAgSUVSQzIwIFBPTFkgPSBJRVJDMjAocG9seVRva2VuQWRkcmVzcyk7CiAgICAgIFBPTFkudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIF9ob3N0LCBfZmVlKTsKICAgICAgYWRkcmVzcyBuZXdTZWN1cml0eVRva2VuQWRkcmVzcyA9IGluaXRpYWxpc2VTZWN1cml0eVRva2VuKF9uYW1lLCBfdGlja2VyLCBfdG90YWxTdXBwbHksIF9kZWNpbWFscywgX293bmVyLCBfbWF4UG9seSwgX3R5cGUsIF9sb2NrdXBQZXJpb2QsIF9xdW9ydW0pOwogICAgICBMb2dOZXdTZWN1cml0eVRva2VuKF90aWNrZXIsIG5ld1NlY3VyaXR5VG9rZW5BZGRyZXNzLCBfb3duZXIsIF9ob3N0LCBfZmVlLCBfdHlwZSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdGlhbGlzZVNlY3VyaXR5VG9rZW4oCiAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgc3RyaW5nIF90aWNrZXIsCiAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5LAogICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICB1aW50MjU2IF9tYXhQb2x5LAogICAgICB1aW50OCBfdHlwZSwKICAgICAgdWludDI1NiBfbG9ja3VwUGVyaW9kLAogICAgICB1aW50OCBfcXVvcnVtCiAgICApIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgIGFkZHJlc3MgbmV3U2VjdXJpdHlUb2tlbkFkZHJlc3MgPSBuZXcgU2VjdXJpdHlUb2tlbigKICAgICAgICBfbmFtZSwKICAgICAgICBfdGlja2VyLAogICAgICAgIF90b3RhbFN1cHBseSwKICAgICAgICBfZGVjaW1hbHMsCiAgICAgICAgX293bmVyLAogICAgICAgIF9tYXhQb2x5LAogICAgICAgIF9sb2NrdXBQZXJpb2QsCiAgICAgICAgX3F1b3J1bSwKICAgICAgICBwb2x5VG9rZW5BZGRyZXNzLAogICAgICAgIHBvbHlDdXN0b21lcnNBZGRyZXNzLAogICAgICAgIHBvbHlDb21wbGlhbmNlQWRkcmVzcwogICAgICApOwogICAgICB0aWNrZXJzW190aWNrZXJdID0gbmV3U2VjdXJpdHlUb2tlbkFkZHJlc3M7CiAgICAgIHNlY3VyaXR5VG9rZW5zW25ld1NlY3VyaXR5VG9rZW5BZGRyZXNzXSA9IFNlY3VyaXR5VG9rZW5EYXRhKAogICAgICAgIF90b3RhbFN1cHBseSwKICAgICAgICBfb3duZXIsCiAgICAgICAgX2RlY2ltYWxzLAogICAgICAgIF90aWNrZXIsCiAgICAgICAgX3R5cGUKICAgICAgKTsKICAgICAgcmV0dXJuIG5ld1NlY3VyaXR5VG9rZW5BZGRyZXNzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vLy8vLy8vIEdldCBGdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBAZGV2IEdldCBzZWN1cml0eSB0b2tlbiBhZGRyZXNzIGJ5IHRpY2tlciBuYW1lCiAgICAgKiBAcGFyYW0gX3RpY2tlciBTeW1ib2wgb2YgdGhlIFNjdXJpdHkgdG9rZW4KICAgICAqIEByZXR1cm4gYWRkcmVzcyBfdGlja2VyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFNlY3VyaXR5VG9rZW5BZGRyZXNzKHN0cmluZyBfdGlja2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICByZXR1cm4gdGlja2Vyc1tfdGlja2VyXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgR2V0IFNlY3VyaXR5IHRva2VuIGRldGFpbHMgYnkgaXRzIGV0aGVyZXVtIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfU1RBZGRyZXNzIFNlY3VyaXR5IHRva2VuIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2VjdXJpdHlUb2tlbkRhdGEoYWRkcmVzcyBfU1RBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgIHVpbnQyNTYgdG90YWxTdXBwbHksCiAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgIHVpbnQ4IGRlY2ltYWxzLAogICAgICBzdHJpbmcgdGlja2VyLAogICAgICB1aW50OCBzZWN1cml0eVR5cGUKICAgICkgewogICAgICByZXR1cm4gKAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLnRvdGFsU3VwcGx5LAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLm93bmVyLAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLmRlY2ltYWxzLAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLnRpY2tlciwKICAgICAgICBzZWN1cml0eVRva2Vuc1tfU1RBZGRyZXNzXS5zZWN1cml0eVR5cGUKICAgICAgKTsKICAgIH0KCn0='.
	

]
