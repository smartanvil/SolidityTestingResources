Class {
	#name : #SRT0aaf8865a6cbf417e7ad51fe71fe60f1a0c192f8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0aaf8865a6cbf417e7ad51fe71fe60f1a0c192f8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCgovL3BsZWFzZSBpbXBvcnQgb3JhY2xpemVBUElfcHJlMC40LnNvbCB3aGVuIHNvbGlkaXR5IDwgMC40LjAKCmNvbnRyYWN0IE9yYWNsaXplSSB7CiAgICBhZGRyZXNzIHB1YmxpYyBjYkFkZHJlc3M7CgogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKCiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CgogICAgZnVuY3Rpb24gcXVlcnkyKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CgogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKCiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKCiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwoKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CgogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKCiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOwoKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOwoKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwoKICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsKCiAgICBmdW5jdGlvbiByYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIHJldHVybnMgKGJ5dGVzMzIpOwp9CgoKY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQoKCmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCAqIDYwICogMjQ7CgogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAgKiA2MCAqIDI0ICogNzsKCiAgICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAgKiA2MCAqIDI0ICogMzA7CgogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CgogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9MZWRnZXIgPSAweDMwOwoKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CgogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CgogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwoKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CgogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CgogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZiAoKGFkZHJlc3MoT0FSKSA9PSAwKSB8fCAoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKSA9PSAwKSkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpID4gMCkgey8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9tYWlubmV0Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKSA+IDApIHsvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSkgPiAwKSB7Ly9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX2tvdmFuIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KSA+IDApIHsvL3JpbmtlYnkgdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yaW5rZWJ5Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KSA+IDApIHsvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpID4gMCkgey8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKSA+IDApIHsvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIHsKICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV91c2VDb3Vwb24oc3RyaW5nIGNvZGUpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldFByb29mKGJ5dGUgcHJvb2ZQKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpID0gMjsgaSA8IDIgKyAyICogMjA7IGkgKz0gMikgewogICAgICAgICAgICBpYWRkciAqPSAyNTY7CiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOwogICAgICAgICAgICBiMiA9IHVpbnQxNjAodG1wW2kgKyAxXSk7CiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpICYmIChiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSAmJiAoYjEgPD0gNzApKSBiMSAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSAmJiAoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykgJiYgKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpICYmIChiMiA8PSA3MCkpIGIyIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpICYmIChiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEgKiAxNiArIGIyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgIHJldHVybiAtIDE7CiAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pCiAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgcmV0dXJuIC0gMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgIHJldHVybiAxOwogICAgICAgIGVsc2UKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZiAoaC5sZW5ndGggPCAxIHx8IG4ubGVuZ3RoIDwgMSB8fCAobi5sZW5ndGggPiBoLmxlbmd0aCkpCiAgICAgICAgcmV0dXJuIC0gMTsKICAgICAgICBlbHNlIGlmIChoLmxlbmd0aCA+ICgyICoqIDEyOCAtIDEpKQogICAgICAgIHJldHVybiAtIDE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdWJpbmRleCA9PSBuLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtIDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JiID0gYnl0ZXMoX2IpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JlID0gYnl0ZXMoX2UpOwogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsKICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOwogICAgICAgIHVpbnQgayA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JjLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iY1tpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsKICAgICAgICByZXR1cm4gc3RyaW5nKGJhYmNkZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsICIiLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGJyZXN1bHQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSAmJiAoYnJlc3VsdFtpXSA8PSA1NykpIHsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscykgewogICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwICoqIF9iOwogICAgICAgIHJldHVybiBtaW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOwogICAgICAgIHVpbnQgaiA9IGk7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgd2hpbGUgKGogIT0gMCkgewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApIHsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpIC8gMjMgKyAzOwogICAgICAgICAgICAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgIH0KICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgIGN0cisrOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICBjdHIrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkgLyAyMyArIDM7CiAgICAgICAgICAgIC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgfQogICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgY3RyKys7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgIGN0cisrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgfQoKCiAgICBzdHJpbmcgb3JhY2xpemVfbmV0d29ya19uYW1lOwoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSh1aW50IF9kZWxheSwgdWludCBfbmJ5dGVzLCB1aW50IF9jdXN0b21HYXNMaW1pdCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgaWYgKChfbmJ5dGVzID09IDApIHx8IChfbmJ5dGVzID4gMzIpKSB0aHJvdzsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICBtc3RvcmUodW5vbmNlLCAweDIwKQogICAgICAgIG1zdG9yZShhZGQodW5vbmNlLCAweDIwKSwgeG9yKGJsb2NraGFzaChzdWIobnVtYmVyLCAxKSksIHhvcihjb2luYmFzZSwgdGltZXN0YW1wKSkpCiAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgIG1zdG9yZShhZGQoc2Vzc2lvbktleUhhc2gsIDB4MjApLCBzZXNzaW9uS2V5SGFzaF9ieXRlczMyKQogICAgICAgIH0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOwogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBzaGEzKGJ5dGVzOChfZGVsYXkpLCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CgogICAgICAgIGJ5dGVzMzIgc2lncjsKICAgICAgICBieXRlczMyIHNpZ3M7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBvZmZzZXQgPSA0ICsgKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCArICh1aW50KGRlcnNpZ1tvZmZzZXQgLSAxXSkgLSAweDIwKSwgMzIsIHNpZ3NfLCAwKTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CgoKICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjcsIHNpZ3IsIHNpZ3MpOwogICAgICAgIGlmIChhZGRyZXNzKHNoYTMocHVia2V5KSkgPT0gc2lnbmVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI4LCBzaWdyLCBzaWdzKTsKICAgICAgICAgICAgcmV0dXJuIChhZGRyZXNzKHNoYTMocHVia2V5KSkgPT0gc2lnbmVyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShieXRlcyBwcm9vZiwgdWludCBzaWcyb2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCBzaWdvazsKCiAgICAgICAgLy8gU3RlcCA2OiB2ZXJpZnkgdGhlIGF0dGVzdGF0aW9uIHNpZ25hdHVyZSwgQVBQS0VZMSBtdXN0IHNpZ24gdGhlIHNlc3Npb25LZXkgZnJvbSB0aGUgY29ycmVjdCBsZWRnZXIgYXBwIChDT0RFSEFTSCkKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMiA9IG5ldyBieXRlcyh1aW50KHByb29mW3NpZzJvZmZzZXQgKyAxXSkgKyAyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFwcGtleTFfcHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMgKyAxLCA2NCwgYXBwa2V5MV9wdWJrZXksIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMiA9IG5ldyBieXRlcygxICsgNjUgKyAzMik7CiAgICAgICAgdG9zaWduMlswXSA9IDE7CiAgICAgICAgLy9yb2xlCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0IC0gNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZmQ5NGZhNzFiYzBiYTEwZDM5ZDQ2NGQwZDhmNDY1ZWZlZWYwYTI3NjRlMzg4N2ZjYzlkZjQxZGVkMjBmNTA1YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSArIDY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDEgKyA2NSk7CiAgICAgICAgdG9zaWduM1swXSA9IDB4RkU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzLCA2NSwgdG9zaWduMywgMSk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWczID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbMyArIDY1ICsgMV0pICsgMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzICsgNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwoKICAgICAgICByZXR1cm4gc2lnb2s7CiAgICB9CgogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKSB8fCAoX3Byb29mWzFdICE9ICJQIikgfHwgKF9wcm9vZlsyXSAhPSAxKSkgdGhyb3c7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgdGhyb3c7CgogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hCeXRlczMyUHJlZml4KGJ5dGVzMzIgY29udGVudCwgYnl0ZXMgcHJlZml4KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJlZml4Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKGJ5dGVzIHByb29mLCBieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzIHJlc3VsdCwgc3RyaW5nIGNvbnRleHRfbmFtZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBjaGVja29rOwoKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMyArIDY1ICsgKHVpbnQocHJvb2ZbMyArIDY1ICsgMV0pICsgMikgKyAzMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGNoZWNrb2sgPSAoc2hhMyhrZXloYXNoKSA9PSBzaGEzKHNoYTI1Nihjb250ZXh0X25hbWUsIHF1ZXJ5SWQpKSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzEgPSBuZXcgYnl0ZXModWludChwcm9vZltsZWRnZXJQcm9vZkxlbmd0aCArICgzMiArIDggKyAxICsgMzIpICsgMV0pICsgMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCArICgzMiArIDggKyAxICsgMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgoKICAgICAgICAvLyBTdGVwIDM6IHdlIGFzc3VtZSBzaWcxIGlzIHZhbGlkIChpdCB3aWxsIGJlIHZlcmlmaWVkIGR1cmluZyBzdGVwIDUpIGFuZCB3ZSB2ZXJpZnkgaWYgJ3Jlc3VsdCcgaXMgdGhlIHByZWZpeCBvZiBzaGEyNTYoc2lnMSkKICAgICAgICBjaGVja29rID0gbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0KTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwgc2hhMyhkZWxheSwgbmJ5dGVzLCB1bm9uY2UsIHNlc3Npb25LZXlIYXNoKSA9PSBjb21taXRtZW50IGluIHN0b3JhZ2UuCiAgICAgICAgLy8gVGhpcyBpcyB0byB2ZXJpZnkgdGhhdCB0aGUgY29tcHV0ZWQgYXJncyBtYXRjaCB3aXRoIHRoZSBvbmVzIHNwZWNpZmllZCBpbiB0aGUgcXVlcnkuCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCArIDEgKyAzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCArIDMyLCA4ICsgMSArIDMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoICsgMzIgKyAoOCArIDEgKyAzMikgKyBzaWcxLmxlbmd0aCArIDY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCAtIDY0LCA2NCwgc2Vzc2lvblB1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzMzIgc2Vzc2lvblB1YmtleUhhc2ggPSBzaGEyNTYoc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpIHsvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9CiAgICAgICAgZWxzZSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDU6IHZhbGlkaXR5IHZlcmlmaWNhdGlvbiBmb3Igc2lnMSAoa2V5aGFzaCBhbmQgYXJncyBzaWduZWQgd2l0aCB0aGUgc2Vzc2lvbktleSkKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMSA9IG5ldyBieXRlcygzMiArIDggKyAxICsgMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyICsgOCArIDEgKyAzMiwgdG9zaWduMSwgMCk7CiAgICAgICAgY2hlY2tvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMSksIHNpZzEsIHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHZlcmlmeSBpZiBzZXNzaW9uUHVia2V5SGFzaCB3YXMgdmVyaWZpZWQgYWxyZWFkeSwgaWYgbm90Li4gbGV0J3MgZG8gaXQhCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9PSBmYWxzZSkgewogICAgICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KHByb29mLCBzaWcyb2Zmc2V0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF07CiAgICB9CgoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgICAgIHRocm93OwogICAgICAgICAgICAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5PwogICAgICAgIH0KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCB0bXAgOj0gbWxvYWQoYWRkKGZyb20sIGkpKQogICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkKICAgICAgICBtc3RvcmUoc2l6ZSwgaGFzaCkKICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikKICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDk2KSwgcykKCiAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgIHJldCA6PSBjYWxsKDMwMDAsIDEsIDAsIHNpemUsIDEyOCwgc2l6ZSwgMzIpCiAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgLy8gVGhlIHNpZ25hdHVyZSBmb3JtYXQgaXMgYSBjb21wYWN0IGZvcm0gb2Y6CiAgICAgICAgLy8gICB7Ynl0ZXMzMiByfXtieXRlczMyIHN9e3VpbnQ4IHZ9CiAgICAgICAgLy8gQ29tcGFjdCBtZWFucywgdWludDggaXMgbm90IHBhZGRlZCB0byAzMiBieXRlcy4KICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgIC8vIEhlcmUgd2UgYXJlIGxvYWRpbmcgdGhlIGxhc3QgMzIgYnl0ZXMuIFdlIGV4cGxvaXQgdGhlIGZhY3QgdGhhdAogICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgdgogICAgICAgIDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgLy8gJ2J5dGUnIGlzIG5vdCB3b3JraW5nIGR1ZSB0byB0aGUgU29saWRpdHkgcGFyc2VyLCBzbyBsZXRzCiAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgfQoKCi8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAovLyB0byBtYXRjaCB0aGUgWVAgcmFuZ2Ugb2YgWzI3LCAyOF0KLy8KLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6Ci8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vZ28tZXRoZXJldW0vaXNzdWVzLzIwNTMKaWYgKHYgPCAyNykKdiArPSAyNzsKCmlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCnJldHVybiAoZmFsc2UsIDApOwoKcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKfQoKfQovLyA8L09SQUNMSVpFX0FQST4KCi8qCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4KICogQGF1dGhvciBOaWNrIEpvaG5zb24gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNmMwZDFlMGQwZjA0MDIwNTA4MmMwMjAzMTgwODAzMTg0MjAyMDkxOCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CiAqCiAqIEBkZXYgRnVuY3Rpb25hbGl0eSBpbiB0aGlzIGxpYnJhcnkgaXMgbGFyZ2VseSBpbXBsZW1lbnRlZCB1c2luZyBhbgogKiAgICAgIGFic3RyYWN0aW9uIGNhbGxlZCBhICdzbGljZScuIEEgc2xpY2UgcmVwcmVzZW50cyBhIHBhcnQgb2YgYSBzdHJpbmcgLQogKiAgICAgIGFueXRoaW5nIGZyb20gdGhlIGVudGlyZSBzdHJpbmcgdG8gYSBzaW5nbGUgY2hhcmFjdGVyLCBvciBldmVuIG5vCiAqICAgICAgY2hhcmFjdGVycyBhdCBhbGwgKGEgMC1sZW5ndGggc2xpY2UpLiBTaW5jZSBhIHNsaWNlIG9ubHkgaGFzIHRvIHNwZWNpZnkKICogICAgICBhbiBvZmZzZXQgYW5kIGEgbGVuZ3RoLCBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgc2xpY2VzIGlzIGEgbG90IGxlc3MKICogICAgICBleHBlbnNpdmUgdGhhbiBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgdGhlIHN0cmluZ3MgdGhleSByZWZlcmVuY2UuCiAqCiAqICAgICAgVG8gZnVydGhlciByZWR1Y2UgZ2FzIGNvc3RzLCBtb3N0IGZ1bmN0aW9ucyBvbiBzbGljZSB0aGF0IG5lZWQgdG8gcmV0dXJuCiAqICAgICAgYSBzbGljZSBtb2RpZnkgdGhlIG9yaWdpbmFsIG9uZSBpbnN0ZWFkIG9mIGFsbG9jYXRpbmcgYSBuZXcgb25lOyBmb3IKICogICAgICBpbnN0YW5jZSwgYHMuc3BsaXQoIi4iKWAgd2lsbCByZXR1cm4gdGhlIHRleHQgdXAgdG8gdGhlIGZpcnN0ICcuJywKICogICAgICBtb2RpZnlpbmcgcyB0byBvbmx5IGNvbnRhaW4gdGhlIHJlbWFpbmRlciBvZiB0aGUgc3RyaW5nIGFmdGVyIHRoZSAnLicuCiAqICAgICAgSW4gc2l0dWF0aW9ucyB3aGVyZSB5b3UgZG8gbm90IHdhbnQgdG8gbW9kaWZ5IHRoZSBvcmlnaW5hbCBzbGljZSwgeW91CiAqICAgICAgY2FuIG1ha2UgYSBjb3B5IGZpcnN0IHdpdGggYC5jb3B5KClgLCBmb3IgZXhhbXBsZToKICogICAgICBgcy5jb3B5KCkuc3BsaXQoIi4iKWAuIFRyeSBhbmQgYXZvaWQgdXNpbmcgdGhpcyBpZGlvbSBpbiBsb29wczsgc2luY2UKICogICAgICBTb2xpZGl0eSBoYXMgbm8gbWVtb3J5IG1hbmFnZW1lbnQsIGl0IHdpbGwgcmVzdWx0IGluIGFsbG9jYXRpbmcgbWFueQogKiAgICAgIHNob3J0LWxpdmVkIHNsaWNlcyB0aGF0IGFyZSBsYXRlciBkaXNjYXJkZWQuCiAqCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgcmV0dXJuIHR3byBzbGljZXMgY29tZSBpbiB0d28gdmVyc2lvbnM6IGEgbm9uLWFsbG9jYXRpbmcKICogICAgICB2ZXJzaW9uIHRoYXQgdGFrZXMgdGhlIHNlY29uZCBzbGljZSBhcyBhbiBhcmd1bWVudCwgbW9kaWZ5aW5nIGl0IGluCiAqICAgICAgcGxhY2UsIGFuZCBhbiBhbGxvY2F0aW5nIHZlcnNpb24gdGhhdCBhbGxvY2F0ZXMgYW5kIHJldHVybnMgdGhlIHNlY29uZAogKiAgICAgIHNsaWNlOyBzZWUgYG5leHRSdW5lYCBmb3IgZXhhbXBsZS4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCBoYXZlIHRvIGNvcHkgc3RyaW5nIGRhdGEgd2lsbCByZXR1cm4gc3RyaW5ncyByYXRoZXIgdGhhbgogKiAgICAgIHNsaWNlczsgdGhlc2UgY2FuIGJlIGNhc3QgYmFjayB0byBzbGljZXMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZyBpZgogKiAgICAgIHJlcXVpcmVkLgogKgogKiAgICAgIEZvciBjb252ZW5pZW5jZSwgc29tZSBmdW5jdGlvbnMgYXJlIHByb3ZpZGVkIHdpdGggbm9uLW1vZGlmeWluZwogKiAgICAgIHZhcmlhbnRzIHRoYXQgY3JlYXRlIGEgbmV3IHNsaWNlIGFuZCByZXR1cm4gYm90aDsgZm9yIGluc3RhbmNlLAogKiAgICAgIGBzLnNwbGl0TmV3KCcuJylgIGxlYXZlcyBzIHVubW9kaWZpZWQsIGFuZCByZXR1cm5zIHR3byB2YWx1ZXMKICogICAgICBjb3JyZXNwb25kaW5nIHRvIHRoZSBsZWZ0IGFuZCByaWdodCBwYXJ0cyBvZiB0aGUgc3RyaW5nLgogKi8KbGlicmFyeSBzdHJpbmdzIHsKc3RydWN0IHNsaWNlIHsKdWludCBfbGVuOwp1aW50IF9wdHI7Cn0KCmZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7Ci8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCmZvciAoOyBsZW4gPj0gMzI7IGxlbiAtPSAzMikgewphc3NlbWJseSB7Cm1zdG9yZShkZXN0LCBtbG9hZChzcmMpKQp9CmRlc3QgKz0gMzI7CnNyYyArPSAzMjsKfQoKLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOwphc3NlbWJseSB7CmxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpCmxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoZGVzdCksIG1hc2spCm1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpCn0KfQoKLyoKICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4KICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogKi8KZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKdWludCBwdHI7CmFzc2VtYmx5IHsKcHRyIDo9IGFkZChzZWxmLCAweDIwKQp9CnJldHVybiBzbGljZShieXRlcyhzZWxmKS5sZW5ndGgsIHB0cik7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgbnVsbC10ZXJtaW5hdGVkIGJ5dGVzMzIgc3RyaW5nLgogKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLgogKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHN0cmluZywgZnJvbSAwIHRvIDMyLgogKi8KZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewp1aW50IHJldDsKaWYgKHNlbGYgPT0gMCkKcmV0dXJuIDA7CmlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CnJldCArPSAxNjsKc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKfQppZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CnJldCArPSA4OwpzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMCk7Cn0KaWYgKHNlbGYgJiAweGZmZmZmZmZmID09IDApIHsKcmV0ICs9IDQ7CnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMCk7Cn0KaWYgKHNlbGYgJiAweGZmZmYgPT0gMCkgewpyZXQgKz0gMjsKc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOwp9CmlmIChzZWxmICYgMHhmZiA9PSAwKSB7CnJldCArPSAxOwp9CnJldHVybiAzMiAtIHJldDsKfQoKLyoKICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGEKICogICAgICBudWxsLXRlcm1pbnRhZWQgdXRmLTggc3RyaW5nLgogKiBAcGFyYW0gc2VsZiBUaGUgYnl0ZXMzMiB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc2xpY2UuCiAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQogKiAgICAgICAgIGZpcnN0IG51bGwuCiAqLwpmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7Ci8vIEFsbG9jYXRlIHNwYWNlIGZvciBgc2VsZmAgaW4gbWVtb3J5LCBjb3B5IGl0IHRoZXJlLCBhbmQgcG9pbnQgcmV0IGF0IGl0CmFzc2VtYmx5IHsKbGV0IHB0ciA6PSBtbG9hZCgweDQwKQptc3RvcmUoMHg0MCwgYWRkKHB0ciwgMHgyMCkpCm1zdG9yZShwdHIsIHNlbGYpCm1zdG9yZShhZGQocmV0LCAweDIwKSwgcHRyKQp9CnJldC5fbGVuID0gbGVuKHNlbGYpOwp9CgovKgogKiBAZGV2IFJldHVybnMgYSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIHRoZSBjdXJyZW50IHNsaWNlLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLgogKi8KZnVuY3Rpb24gY29weShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewpyZXR1cm4gc2xpY2Uoc2VsZi5fbGVuLCBzZWxmLl9wdHIpOwp9CgovKgogKiBAZGV2IENvcGllcyBhIHNsaWNlIHRvIGEgbmV3IHN0cmluZy4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuCiAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICovCmZ1bmN0aW9uIHRvU3RyaW5nKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewp2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOwp1aW50IHJldHB0cjsKYXNzZW1ibHkge3JldHB0ciA6PSBhZGQocmV0LCAzMil9CgptZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CnJldHVybiByZXQ7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIGluIHJ1bmVzIG9mIHRoZSBzbGljZS4gTm90ZSB0aGF0IHRoaXMgb3BlcmF0aW9uCiAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0CiAqICAgICAgaW4gbG9vcHMsIGFuZCBjYWxsIGBzbGljZS5lbXB0eSgpYCBpZiB5b3Ugb25seSBuZWVkIHRvIGtub3cgd2hldGhlcgogKiAgICAgIHRoZSBzbGljZSBpcyBlbXB0eSBvciBub3QuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHNsaWNlIGluIHJ1bmVzLgogKi8KZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0CnZhciBwdHIgPSBzZWxmLl9wdHIgLSAzMTsKdmFyIGVuZCA9IHB0ciArIHNlbGYuX2xlbjsKZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsKdWludDggYjsKYXNzZW1ibHkge2IgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpfQppZiAoYiA8IDB4ODApIHsKcHRyICs9IDE7Cn0gZWxzZSBpZiAoYiA8IDB4RTApIHsKcHRyICs9IDI7Cn0gZWxzZSBpZiAoYiA8IDB4RjApIHsKcHRyICs9IDM7Cn0gZWxzZSBpZiAoYiA8IDB4RjgpIHsKcHRyICs9IDQ7Cn0gZWxzZSBpZiAoYiA8IDB4RkMpIHsKcHRyICs9IDU7Cn0gZWxzZSB7CnB0ciArPSA2Owp9Cn0KcmV0dXJuIGxlbjsKfQoKLyoKICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5IChoYXMgYSBsZW5ndGggb2YgMCkuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5LCBGYWxzZSBvdGhlcndpc2UuCiAqLwpmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CnJldHVybiBzZWxmLl9sZW4gPT0gMDsKfQoKLyoKICogQGRldiBSZXR1cm5zIGEgcG9zaXRpdmUgbnVtYmVyIGlmIGBvdGhlcmAgY29tZXMgbGV4aWNvZ3JhcGhpY2FsbHkgYWZ0ZXIKICogICAgICBgc2VsZmAsIGEgbmVnYXRpdmUgbnVtYmVyIGlmIGl0IGNvbWVzIGJlZm9yZSwgb3IgemVybyBpZiB0aGUKICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICogICAgICBvbiB1bmljb2RlIGNvZGVwb2ludHMuCiAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogKiBAcmV0dXJuIFRoZSByZXN1bHQgb2YgdGhlIGNvbXBhcmlzb24uCiAqLwpmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKdWludCBzaG9ydGVzdCA9IHNlbGYuX2xlbjsKaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pCnNob3J0ZXN0ID0gb3RoZXIuX2xlbjsKCnZhciBzZWxmcHRyID0gc2VsZi5fcHRyOwp2YXIgb3RoZXJwdHIgPSBvdGhlci5fcHRyOwpmb3IgKHVpbnQgaWR4ID0gMDsgaWR4IDwgc2hvcnRlc3Q7IGlkeCArPSAzMikgewp1aW50IGE7CnVpbnQgYjsKYXNzZW1ibHkgewphIDo9IG1sb2FkKHNlbGZwdHIpCmIgOj0gbWxvYWQob3RoZXJwdHIpCn0KaWYgKGEgIT0gYikgewovLyBNYXNrIG91dCBpcnJlbGV2YW50IGJ5dGVzIGFuZCBjaGVjayBhZ2Fpbgp1aW50IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7CnZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7CmlmIChkaWZmICE9IDApCnJldHVybiBpbnQoZGlmZik7Cn0Kc2VsZnB0ciArPSAzMjsKb3RoZXJwdHIgKz0gMzI7Cn0KcmV0dXJuIGludChzZWxmLl9sZW4pIC0gaW50KG90aGVyLl9sZW4pOwp9CgovKgogKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIHNsaWNlcyBjb250YWluIHRoZSBzYW1lIHRleHQuCiAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogKiBAcGFyYW0gc2VsZiBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuCiAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLgogKi8KZnVuY3Rpb24gZXF1YWxzKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CnJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOwp9CgovKgogKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQogKiAgICAgIHNsaWNlIHRvIHBvaW50IHRvIHRoZSBuZXh0IHJ1bmUgYW5kIHJldHVybmluZyBgc2VsZmAuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuCiAqIEByZXR1cm4gYHJ1bmVgLgogKi8KZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKcnVuZS5fcHRyID0gc2VsZi5fcHRyOwoKaWYgKHNlbGYuX2xlbiA9PSAwKSB7CnJ1bmUuX2xlbiA9IDA7CnJldHVybiBydW5lOwp9Cgp1aW50IGxlbjsKdWludCBiOwovLyBMb2FkIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBydW5lIGludG8gdGhlIExTQnMgb2YgYgphc3NlbWJseSB7YiA6PSBhbmQobWxvYWQoc3ViKG1sb2FkKGFkZChzZWxmLCAzMikpLCAzMSkpLCAweEZGKX0KaWYgKGIgPCAweDgwKSB7CmxlbiA9IDE7Cn0gZWxzZSBpZiAoYiA8IDB4RTApIHsKbGVuID0gMjsKfSBlbHNlIGlmIChiIDwgMHhGMCkgewpsZW4gPSAzOwp9IGVsc2UgewpsZW4gPSA0Owp9CgovLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKaWYgKGxlbiA+IHNlbGYuX2xlbikgewpydW5lLl9sZW4gPSBzZWxmLl9sZW47CnNlbGYuX3B0ciArPSBzZWxmLl9sZW47CnNlbGYuX2xlbiA9IDA7CnJldHVybiBydW5lOwp9CgpzZWxmLl9wdHIgKz0gbGVuOwpzZWxmLl9sZW4gLT0gbGVuOwpydW5lLl9sZW4gPSBsZW47CnJldHVybiBydW5lOwp9CgovKgogKiBAZGV2IFJldHVybnMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlLCBhZHZhbmNpbmcgdGhlIHNsaWNlIHRvIHBvaW50CiAqICAgICAgdG8gdGhlIG5leHQgcnVuZS4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAqIEByZXR1cm4gQSBzbGljZSBjb250YWluaW5nIG9ubHkgdGhlIGZpcnN0IHJ1bmUgZnJvbSBgc2VsZmAuCiAqLwpmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKbmV4dFJ1bmUoc2VsZiwgcmV0KTsKfQoKLyoKICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAqLwpmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsKaWYgKHNlbGYuX2xlbiA9PSAwKSB7CnJldHVybiAwOwp9Cgp1aW50IHdvcmQ7CnVpbnQgbGVuOwp1aW50IGRpdmlzb3IgPSAyICoqIDI0ODsKCi8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiCmFzc2VtYmx5IHt3b3JkIDo9IG1sb2FkKG1sb2FkKGFkZChzZWxmLCAzMikpKX0KdmFyIGIgPSB3b3JkIC8gZGl2aXNvcjsKaWYgKGIgPCAweDgwKSB7CnJldCA9IGI7CmxlbiA9IDE7Cn0gZWxzZSBpZiAoYiA8IDB4RTApIHsKcmV0ID0gYiAmIDB4MUY7CmxlbiA9IDI7Cn0gZWxzZSBpZiAoYiA8IDB4RjApIHsKcmV0ID0gYiAmIDB4MEY7CmxlbiA9IDM7Cn0gZWxzZSB7CnJldCA9IGIgJiAweDA3OwpsZW4gPSA0Owp9CgovLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKaWYgKGxlbiA+IHNlbGYuX2xlbikgewpyZXR1cm4gMDsKfQoKZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsKZGl2aXNvciA9IGRpdmlzb3IgLyAyNTY7CmIgPSAod29yZCAvIGRpdmlzb3IpICYgMHhGRjsKaWYgKGIgJiAweEMwICE9IDB4ODApIHsKLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQpyZXR1cm4gMDsKfQpyZXQgPSAocmV0ICogNjQpIHwgKGIgJiAweDNGKTsKfQoKcmV0dXJuIHJldDsKfQoKLyoKICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gaGFzaC4KICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgc2xpY2UuCiAqLwpmdW5jdGlvbiBrZWNjYWsoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXQpIHsKYXNzZW1ibHkgewpyZXQgOj0gc2hhMyhtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpCn0KfQoKLyoKICogQGRldiBSZXR1cm5zIHRydWUgaWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogKi8KZnVuY3Rpb24gc3RhcnRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CnJldHVybiBmYWxzZTsKfQoKaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgewpyZXR1cm4gdHJ1ZTsKfQoKYm9vbCBlcXVhbDsKYXNzZW1ibHkgewpsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQpsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQplcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQp9CnJldHVybiBlcXVhbDsKfQoKLyoKICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICogICAgICBiZWdpbm5pbmcgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICogQHJldHVybiBgc2VsZmAKICovCmZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CmlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewpyZXR1cm4gc2VsZjsKfQoKYm9vbCBlcXVhbCA9IHRydWU7CmlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsKYXNzZW1ibHkgewpsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQpsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQplcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQp9Cn0KCmlmIChlcXVhbCkgewpzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CnNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsKfQoKcmV0dXJuIHNlbGY7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuCiAqLwpmdW5jdGlvbiBlbmRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CnJldHVybiBmYWxzZTsKfQoKdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsKCmlmIChzZWxmcHRyID09IG5lZWRsZS5fcHRyKSB7CnJldHVybiB0cnVlOwp9Cgpib29sIGVxdWFsOwphc3NlbWJseSB7CmxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQpsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQplcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQp9CgpyZXR1cm4gZXF1YWw7Cn0KCi8qCiAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQogKiAgICAgIGVuZCBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogKiBAcmV0dXJuIGBzZWxmYAogKi8KZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewppZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKcmV0dXJuIHNlbGY7Cn0KCnZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47CmJvb2wgZXF1YWwgPSB0cnVlOwppZiAoc2VsZnB0ciAhPSBuZWVkbGUuX3B0cikgewphc3NlbWJseSB7CmxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQpsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQplcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQp9Cn0KCmlmIChlcXVhbCkgewpzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47Cn0KCnJldHVybiBzZWxmOwp9CgovLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgovLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBmaXJzdCBieXRlIGFmdGVyIGBzZWxmYCBpZiBub3QgZm91bmQuCmZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CnVpbnQgcHRyOwp1aW50IGlkeDsKCmlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewppZiAobmVlZGxlbGVuIDw9IDMyKSB7Ci8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKYXNzZW1ibHkgewpsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQpsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKbGV0IGVuZCA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpCnB0ciA6PSBzZWxmcHRyCmxvb3AgOgpqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQpwdHIgOj0gYWRkKHB0ciwgMSkKanVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpCnB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikKZXhpdDoKfQpyZXR1cm4gcHRyOwp9IGVsc2UgewovLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwpieXRlczMyIGhhc2g7CmFzc2VtYmx5IHtoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pfQpwdHIgPSBzZWxmcHRyOwpmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewpieXRlczMyIHRlc3RIYXNoOwphc3NlbWJseSB7dGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbil9CmlmIChoYXNoID09IHRlc3RIYXNoKQpyZXR1cm4gcHRyOwpwdHIgKz0gMTsKfQp9Cn0KcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwp9CgovLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mCi8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4KZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CnVpbnQgcHRyOwoKaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CmlmIChuZWVkbGVsZW4gPD0gMzIpIHsKLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncwphc3NlbWJseSB7CmxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpCmxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQpwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQpsb29wIDoKanVtcGkocmV0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQpwdHIgOj0gc3ViKHB0ciwgMSkKanVtcGkobG9vcCwgZ3QoYWRkKHB0ciwgMSksIHNlbGZwdHIpKQpwdHIgOj0gc2VsZnB0cgpqdW1wKGV4aXQpCnJldCA6CnB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pCmV4aXQgOgp9CnJldHVybiBwdHI7Cn0gZWxzZSB7Ci8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCmJ5dGVzMzIgaGFzaDsKYXNzZW1ibHkge2hhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbil9CnB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7CndoaWxlIChwdHIgPj0gc2VsZnB0cikgewpieXRlczMyIHRlc3RIYXNoOwphc3NlbWJseSB7dGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbil9CmlmIChoYXNoID09IHRlc3RIYXNoKQpyZXR1cm4gcHRyICsgbmVlZGxlbGVuOwpwdHIgLT0gMTsKfQp9Cn0KcmV0dXJuIHNlbGZwdHI7Cn0KCi8qCiAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mCiAqICAgICAgYG5lZWRsZWAgdG8gdGhlIGVuZCBvZiB0aGUgc2xpY2UuIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlCiAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4KICogQHJldHVybiBgc2VsZmAuCiAqLwpmdW5jdGlvbiBmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwpzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOwpzZWxmLl9wdHIgPSBwdHI7CnJldHVybiBzZWxmOwp9CgovKgogKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIHRoZSBwYXJ0IG9mIHRoZSBzdHJpbmcgZnJvbSB0aGUgc3RhcnQgb2YKICogICAgICBgc2VsZmAgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYC4gSWYgYG5lZWRsZWAKICogICAgICBpcyBub3QgZm91bmQsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4KICogQHJldHVybiBgc2VsZmAuCiAqLwpmdW5jdGlvbiByZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CnVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CnNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKcmV0dXJuIHNlbGY7Cn0KCi8qCiAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLgogKiBAcmV0dXJuIGB0b2tlbmAuCiAqLwpmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewp1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CnRva2VuLl9wdHIgPSBzZWxmLl9wdHI7CnRva2VuLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CmlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7Ci8vIE5vdCBmb3VuZApzZWxmLl9sZW4gPSAwOwp9IGVsc2UgewpzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwpzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsKfQpyZXR1cm4gdG9rZW47Cn0KCi8qCiAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICovCmZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7Cn0KCi8qCiAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAqIEByZXR1cm4gYHRva2VuYC4KICovCmZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewp1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwp0b2tlbi5fcHRyID0gcHRyOwp0b2tlbi5fbGVuID0gc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0cik7CmlmIChwdHIgPT0gc2VsZi5fcHRyKSB7Ci8vIE5vdCBmb3VuZApzZWxmLl9sZW4gPSAwOwp9IGVsc2UgewpzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwp9CnJldHVybiB0b2tlbjsKfQoKLyoKICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBhZnRlciBpdC4gSWYKICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICovCmZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CnJzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKfQoKLyoKICogQGRldiBDb3VudHMgdGhlIG51bWJlciBvZiBub25vdmVybGFwcGluZyBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBpbiBgc2VsZmAuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAqIEByZXR1cm4gVGhlIG51bWJlciBvZiBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBmb3VuZCBpbiBgc2VsZmAuCiAqLwpmdW5jdGlvbiBjb3VudChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHVpbnQgY291bnQpIHsKdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CndoaWxlIChwdHIgPD0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CmNvdW50Kys7CnB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0ciksIHB0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwp9Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyBUcnVlIGlmIGBzZWxmYCBjb250YWlucyBgbmVlZGxlYC4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICogQHJldHVybiBUcnVlIGlmIGBuZWVkbGVgIGlzIGZvdW5kIGluIGBzZWxmYCwgZmFsc2Ugb3RoZXJ3aXNlLgogKi8KZnVuY3Rpb24gY29udGFpbnMoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CnJldHVybiByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSAhPSBzZWxmLl9wdHI7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgY29uY2F0ZW5hdGlvbiBvZgogKiAgICAgIGBzZWxmYCBhbmQgYG90aGVyYC4KICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb25jYXRlbmF0ZS4KICogQHJldHVybiBUaGUgY29uY2F0ZW5hdGlvbiBvZiB0aGUgdHdvIHN0cmluZ3MuCiAqLwpmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewp2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKdWludCByZXRwdHI7CmFzc2VtYmx5IHtyZXRwdHIgOj0gYWRkKHJldCwgMzIpfQptZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7Cm1lbWNweShyZXRwdHIgKyBzZWxmLl9sZW4sIG90aGVyLl9wdHIsIG90aGVyLl9sZW4pOwpyZXR1cm4gcmV0Owp9CgovKgogKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQogKiAgICAgIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcuCiAqIEBwYXJhbSBzZWxmIFRoZSBkZWxpbWl0ZXIgdG8gdXNlLgogKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLgogKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc2xpY2VzIGluIGBwYXJ0c2AsCiAqICAgICAgICAgam9pbmVkIHdpdGggYHNlbGZgLgogKi8KZnVuY3Rpb24gam9pbihzbGljZSBzZWxmLCBzbGljZVtdIHBhcnRzKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQpyZXR1cm4gIiI7Cgp1aW50IGxlbiA9IHNlbGYuX2xlbiAqIChwYXJ0cy5sZW5ndGggLSAxKTsKZm9yICh1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspCmxlbiArPSBwYXJ0c1tpXS5fbGVuOwoKdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsKdWludCByZXRwdHI7CmFzc2VtYmx5IHtyZXRwdHIgOj0gYWRkKHJldCwgMzIpfQoKZm9yIChpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7Cm1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOwpyZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsKaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7Cm1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKcmV0cHRyICs9IHNlbGYuX2xlbjsKfQp9CgpyZXR1cm4gcmV0Owp9Cn0KCgpjb250cmFjdCBEU1NhZmVBZGRTdWIgewpmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CnJlcXVpcmUoYSArIGIgPj0gYSk7CnJldHVybiBhICsgYjsKfQoKZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewpyZXF1aXJlKGIgPD0gYSk7CnJldHVybiBhIC0gYjsKfQp9CgoKCmNvbnRyYWN0IFNtYXJ0Q29udHJhY3RDYXNpbm8gaXMgdXNpbmdPcmFjbGl6ZSwgRFNTYWZlQWRkU3ViIHsKCnVzaW5nIHN0cmluZ3MgZm9yICo7CgovKgogKiBjaGVja3MgcGxheWVyIHByb2ZpdCwgYmV0IHNpemUgYW5kIHBsYXllciBudW1iZXIgaXMgd2l0aGluIHJhbmdlCiovCm1vZGlmaWVyIGJldElzVmFsaWQodWludCBfYmV0U2l6ZSwgdWludCBfcGxheWVyTnVtYmVyKSB7CmlmICgoKCgoX2JldFNpemUgKiAoMTAwLSAoc2FmZVN1YihfcGxheWVyTnVtYmVyLCAxKSkpKSAvIChzYWZlU3ViKF9wbGF5ZXJOdW1iZXIsIDEpKSsgX2JldFNpemUpKSAqIGhvdXNlRWRnZSAvIGhvdXNlRWRnZURpdmlzb3IpIC1fYmV0U2l6ZSA+IG1heFByb2ZpdCB8fCBfYmV0U2l6ZSA8IG1pbkJldCB8fCBfcGxheWVyTnVtYmVyIDwgbWluTnVtYmVyIHx8IF9wbGF5ZXJOdW1iZXIgPiBtYXhOdW1iZXIpIHJlcXVpcmUoZmFsc2UpOwpfOwp9CgovKgogKiBjaGVja3MgZ2FtZSBpcyBjdXJyZW50bHkgYWN0aXZlCiovCm1vZGlmaWVyIGdhbWVJc0FjdGl2ZSB7CnJlcXVpcmUoZ2FtZVBhdXNlZCAhPSB0cnVlKTsKXzsKfQoKLyoKICogY2hlY2tzIHBheW91dHMgYXJlIGN1cnJlbnRseSBhY3RpdmUKKi8KbW9kaWZpZXIgcGF5b3V0c0FyZUFjdGl2ZSB7CnJlcXVpcmUocGF5b3V0c1BhdXNlZCAhPSB0cnVlKTsKXzsKfQoKLyoKICogY2hlY2tzIG9ubHkgT3JhY2xpemUgYWRkcmVzcyBpcyBjYWxsaW5nCiovCm1vZGlmaWVyIG9ubHlPcmFjbGl6ZSB7CnJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7Cl87Cn0KCi8qCiAqIGNoZWNrcyBvbmx5IG93bmVyIGFkZHJlc3MgaXMgY2FsbGluZwoqLwptb2RpZmllciBvbmx5T3duZXIgewpyZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwpfOwp9CgovKgogKiBjaGVja3Mgb25seSB0cmVhc3VyeSBhZGRyZXNzIGlzIGNhbGxpbmcKKi8KbW9kaWZpZXIgb25seVRyZWFzdXJ5IHsKcmVxdWlyZShtc2cuc2VuZGVyID09IHRyZWFzdXJ5KTsKXzsKfQoKLyoKICogZ2FtZSB2YXJzCiovCnVpbnQgY29uc3RhbnQgcHVibGljIG1heFByb2ZpdERpdmlzb3IgPSAxMDAwMDAwOwp1aW50IGNvbnN0YW50IHB1YmxpYyBob3VzZUVkZ2VEaXZpc29yID0gMTAwMDsKdWludCBjb25zdGFudCBwdWJsaWMgbWF4TnVtYmVyID0gOTk7CnVpbnQgY29uc3RhbnQgcHVibGljIG1pbk51bWJlciA9IDI7CmJvb2wgcHVibGljIGdhbWVQYXVzZWQ7CnVpbnQzMiBwdWJsaWMgZ2FzRm9yT3JhY2xpemU7CmFkZHJlc3MgcHVibGljIG93bmVyOwpib29sIHB1YmxpYyBwYXlvdXRzUGF1c2VkOwphZGRyZXNzIHB1YmxpYyB0cmVhc3VyeTsKdWludCBwdWJsaWMgY29udHJhY3RCYWxhbmNlOwp1aW50IHB1YmxpYyBob3VzZUVkZ2U7CnVpbnQgcHVibGljIG1heFByb2ZpdDsKdWludCBwdWJsaWMgbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZTsKdWludCBwdWJsaWMgbWluQmV0OwovL2luaXQgZGljb250aW51ZWQgY29udHJhY3QgZGF0YQppbnQgcHVibGljIHRvdGFsQmV0cyA9IDc1MTsKdWludCBwdWJsaWMgbWF4UGVuZGluZ1BheW91dHM7Ci8vaW5pdCBkaWNvbnRpbnVlZCBjb250cmFjdCBkYXRhCnVpbnQgcHVibGljIHRvdGFsV2VpV29uID0gNjczMDg0MjAwNjAwMDAwMDAwMDA7Ci8vaW5pdCBkaWNvbnRpbnVlZCBjb250cmFjdCBkYXRhCnVpbnQgcHVibGljIHRvdGFsV2VpV2FnZXJlZCA9IDExNTg0OTI2MDAwMDAwMDAwMDAwMDsKCi8qCiAqIHBsYXllciB2YXJzCiovCm1hcHBpbmcgKGJ5dGVzMzIgPT4gYWRkcmVzcykgcGxheWVyQWRkcmVzczsKbWFwcGluZyAoYnl0ZXMzMiA9PiBhZGRyZXNzKSBwbGF5ZXJUZW1wQWRkcmVzczsKbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBwbGF5ZXJCZXRJZDsKbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJCZXRWYWx1ZTsKbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wQmV0VmFsdWU7Cm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyRGllUmVzdWx0OwptYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllck51bWJlcjsKbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHM7Cm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyUHJvZml0OwptYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllclRlbXBSZXdhcmQ7CgovKgogKiBldmVudHMKKi8KLyogbG9nIGJldHMgKyBvdXRwdXQgdG8gd2ViMyBmb3IgcHJlY2lzZSAncGF5b3V0IG9uIHdpbicgZmllbGQgaW4gVUkgKi8KZXZlbnQgTG9nQmV0KGJ5dGVzMzIgaW5kZXhlZCBCZXRJRCwgYWRkcmVzcyBpbmRleGVkIFBsYXllckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBSZXdhcmRWYWx1ZSwgdWludCBQcm9maXRWYWx1ZSwgdWludCBCZXRWYWx1ZSwgdWludCBQbGF5ZXJOdW1iZXIpOwovKiBvdXRwdXQgdG8gd2ViMyBVSSBvbiBiZXQgcmVzdWx0Ki8KLyogU3RhdHVzOiAwPWxvc2UsIDE9d2luLCAyPXdpbiArIGZhaWxlZCBzZW5kLCAzPXJlZnVuZCwgND1yZWZ1bmQgKyBmYWlsZWQgc2VuZCovCmV2ZW50IExvZ1Jlc3VsdCh1aW50IGluZGV4ZWQgUmVzdWx0U2VyaWFsTnVtYmVyLCBieXRlczMyIGluZGV4ZWQgQmV0SUQsIGFkZHJlc3MgaW5kZXhlZCBQbGF5ZXJBZGRyZXNzLCB1aW50IEJldFZhbHVlLCB1aW50IFBsYXllck51bWJlciwgdWludCBEaWNlUmVzdWx0LCB1aW50IFZhbHVlLCBpbnQgU3RhdHVzLCBieXRlcyBQcm9vZik7Ci8qIGxvZyBtYW51YWwgcmVmdW5kcyAqLwpldmVudCBMb2dSZWZ1bmQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJlZnVuZFZhbHVlKTsKLyogbG9nIG93bmVyIHRyYW5zZmVycyAqLwpldmVudCBMb2dPd25lclRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBTZW50VG9BZGRyZXNzLCB1aW50IGluZGV4ZWQgQW1vdW50VHJhbnNmZXJyZWQpOwoKCi8qCiAqIGluaXQKKi8KZnVuY3Rpb24gU21hcnRDb250cmFjdENhc2lubygpIHsKCm93bmVyID0gbXNnLnNlbmRlcjsKdHJlYXN1cnkgPSBtc2cuc2VuZGVyOwoKb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7Ci8qIHVzZSBUTFNOb3RhcnkgZm9yIG9yYWNsaXplIGNhbGwgKi8Kb3JhY2xpemVfc2V0UHJvb2YocHJvb2ZUeXBlX1RMU05vdGFyeSB8IHByb29mU3RvcmFnZV9JUEZTKTsKLyogaW5pdCA5OTAgPSA5OSUgKDElIGhvdXNlRWRnZSkqLwpvd25lclNldEhvdXNlRWRnZSg5OTApOwovKiBpbml0IDEwLDAwMCA9IDElICAqLwpvd25lclNldE1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UoMTAwMDAwKTsKLyogaW5pdCBtaW4gYmV0ICgwLjEgZXRoZXIpICovCm93bmVyU2V0TWluQmV0KDEwMDAwMDAwMDAwMDAwMDAwMCk7Ci8qIGluaXQgZ2FzIGZvciBvcmFjbGl6ZSAqLwpnYXNGb3JPcmFjbGl6ZSA9IDI1MDAwMDsKCn0KCi8qCiAqIHB1YmxpYyBmdW5jdGlvbgogKiBwbGF5ZXIgc3VibWl0IGJldAogKiBvbmx5IGlmIGdhbWUgaXMgYWN0aXZlICYgYmV0IGlzIHZhbGlkIGNhbiBxdWVyeSBvcmFjbGl6ZSBhbmQgc2V0IHBsYXllciB2YXJzCiovCmZ1bmN0aW9uIHBsYXllclJvbGxEaWNlKHVpbnQgcm9sbFVuZGVyKSBwdWJsaWMKcGF5YWJsZQpnYW1lSXNBY3RpdmUKYmV0SXNWYWxpZChtc2cudmFsdWUsIHJvbGxVbmRlcikKewoKCi8qIHNhZmVseSB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBhY2NvdW50IGZvciBjb3N0IHRvIGNhbGwgb3JhY2xpemUqLwpjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgb3JhY2xpemVfZ2V0UHJpY2UoIlVSTCIsIGdhc0Zvck9yYWNsaXplKSk7CgovKiB0b3RhbCBudW1iZXIgb2YgYmV0cyAqLwp0b3RhbEJldHMgKz0gMTsKCi8qIHRvdGFsIHdhZ2VyZWQgKi8KdG90YWxXZWlXYWdlcmVkICs9IG1zZy52YWx1ZTsKCi8qCiogYXNzaWduIHBhcnRpYWxseSBlbmNyeXB0ZWQgcXVlcnkgdG8gb3JhY2xpemUKKiBvbmx5IHRoZSBhcGlLZXkgaXMgZW5jcnlwdGVkCiogaW50ZWdlciBxdWVyeSBpcyBpbiBwbGFpbiB0ZXh0CiovCmJ5dGVzMzIgcm5nSWQgPSBvcmFjbGl6ZV9xdWVyeSgibmVzdGVkIiwgIltVUkxdIFsnanNvbihodHRwczovL2FwaS5yYW5kb20ub3JnL2pzb24tcnBjLzEvaW52b2tlKS5yZXN1bHQucmFuZG9tW1wic2VyaWFsTnVtYmVyXCIsXCJkYXRhXCJdJywgJ1xcbntcImpzb25ycGNcIjpcIjIuMFwiLFwibWV0aG9kXCI6XCJnZW5lcmF0ZVNpZ25lZEludGVnZXJzXCIsXCJwYXJhbXNcIjp7XCJuXCI6MSxcIm1pblwiOjEsXCJtYXhcIjoxMDAsXCJyZXBsYWNlbWVudFwiOnRydWUsXCJiYXNlXCI6MTAsXCJhcGlLZXlcIjoke1tkZWNyeXB0XSBCQ0g2aEhXZHNrZDh2YjFJeUp1ZlZhd3N2QlNzWE4zNFJURDNyYjNnL0Z6Mi9jRnBZMXM1ek96RlhUbCtZT3d0OXZoZkpld0h4bHA3OXlWQkNRL3JGT1Z5NHdYUzRHbUdIeTdEQVpKdDVZWm1ucTFQL2ZzbkFCcVpxdmJ2dEtJbkF1SUQrRFd5RitIVk10eCtpdXJwWjNHaGh6STdIKzg9fSR7W2lkZW50aXR5XSBcIn1cIn0sXCJpZFwiOlwiU21hcnRDb250cmFjdENhc2lub1wiJHtbaWRlbnRpdHldIFwifVwifSddIiwgZ2FzRm9yT3JhY2xpemUpOwoKLyogbWFwIGJldCBpZCB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCnBsYXllckJldElkW3JuZ0lkXSA9IHJuZ0lkOwovKiBtYXAgcGxheWVyIGx1Y2t5IG51bWJlciB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCnBsYXllck51bWJlcltybmdJZF0gPSByb2xsVW5kZXI7Ci8qIG1hcCB2YWx1ZSBvZiB3YWdlciB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCnBsYXllckJldFZhbHVlW3JuZ0lkXSA9IG1zZy52YWx1ZTsKLyogbWFwIHBsYXllciBhZGRyZXNzIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8KcGxheWVyQWRkcmVzc1tybmdJZF0gPSBtc2cuc2VuZGVyOwovKiBzYWZlbHkgbWFwIHBsYXllciBwcm9maXQgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLwpwbGF5ZXJQcm9maXRbcm5nSWRdID0gKCgoKG1zZy52YWx1ZSAqICgxMDAgLSAoc2FmZVN1Yihyb2xsVW5kZXIsIDEpKSkpIC8gKHNhZmVTdWIocm9sbFVuZGVyLDEpKSArIG1zZy52YWx1ZSkpICpob3VzZUVkZ2UgLyBob3VzZUVkZ2VEaXZpc29yKSAtIG1zZy52YWx1ZTsKLyogc2FmZWx5IGluY3JlYXNlIG1heFBlbmRpbmdQYXlvdXRzIGxpYWJpbGl0eSAtIGNhbGMgYWxsIHBlbmRpbmcgcGF5b3V0cyB1bmRlciBhc3N1bXB0aW9uIHRoZXkgd2luICovCm1heFBlbmRpbmdQYXlvdXRzID0gc2FmZUFkZChtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyUHJvZml0W3JuZ0lkXSk7Ci8qIGNoZWNrIGNvbnRyYWN0IGNhbiBwYXlvdXQgb24gd2luICovCnJlcXVpcmUobWF4UGVuZGluZ1BheW91dHMgPCBjb250cmFjdEJhbGFuY2UpOwovKiBwcm92aWRlcyBhY2N1cmF0ZSBudW1iZXJzIGZvciB3ZWIzIGFuZCBhbGxvd3MgZm9yIG1hbnVhbCByZWZ1bmRzIGluIGNhc2Ugb2Ygbm8gb3JhY2xpemUgX19jYWxsYmFjayAqLwpMb2dCZXQocGxheWVyQmV0SWRbcm5nSWRdLCBwbGF5ZXJBZGRyZXNzW3JuZ0lkXSwgc2FmZUFkZChwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllclByb2ZpdFtybmdJZF0pLCBwbGF5ZXJQcm9maXRbcm5nSWRdLCBwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllck51bWJlcltybmdJZF0pOwoKfQoKCi8qCiogc2VtaS1wdWJsaWMgZnVuY3Rpb24gLSBvbmx5IG9yYWNsaXplIGNhbiBjYWxsCiovCi8qVExTTm90YXJ5IGZvciBvcmFjbGl6ZSBjYWxsICovCmZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljCm9ubHlPcmFjbGl6ZQpwYXlvdXRzQXJlQWN0aXZlCnsKCi8qIHBsYXllciBhZGRyZXNzIG1hcHBlZCB0byBxdWVyeSBpZCBkb2VzIG5vdCBleGlzdCAqLwpyZXF1aXJlKHBsYXllckFkZHJlc3NbbXlpZF0gIT0gMHgwKTsKCi8qIGtlZXAgb3JhY2xpemUgaG9uZXN0IGJ5IHJldHJpZXZpbmcgdGhlIHNlcmlhbE51bWJlciBmcm9tIHJhbmRvbS5vcmcgcmVzdWx0ICovCnZhciBzbF9yZXN1bHQgPSByZXN1bHQudG9TbGljZSgpOwpzbF9yZXN1bHQuYmV5b25kKCJbIi50b1NsaWNlKCkpLnVudGlsKCJdIi50b1NsaWNlKCkpOwp1aW50IHNlcmlhbE51bWJlck9mUmVzdWx0ID0gcGFyc2VJbnQoc2xfcmVzdWx0LnNwbGl0KCcsICcudG9TbGljZSgpKS50b1N0cmluZygpKTsKCi8qIG1hcCByZXN1bHQgdG8gcGxheWVyICovCnBsYXllckRpZVJlc3VsdFtteWlkXSA9IHBhcnNlSW50KHNsX3Jlc3VsdC5iZXlvbmQoIlsiLnRvU2xpY2UoKSkudW50aWwoIl0iLnRvU2xpY2UoKSkudG9TdHJpbmcoKSk7CgovKiBnZXQgdGhlIHBsYXllckFkZHJlc3MgZm9yIHRoaXMgcXVlcnkgaWQgKi8KcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0gPSBwbGF5ZXJBZGRyZXNzW215aWRdOwovKiBkZWxldGUgcGxheWVyQWRkcmVzcyBmb3IgdGhpcyBxdWVyeSBpZCAqLwpkZWxldGUgcGxheWVyQWRkcmVzc1tteWlkXTsKCi8qIG1hcCB0aGUgcGxheWVyUHJvZml0IGZvciB0aGlzIHF1ZXJ5IGlkICovCnBsYXllclRlbXBSZXdhcmRbbXlpZF0gPSBwbGF5ZXJQcm9maXRbbXlpZF07Ci8qIHNldCAgcGxheWVyUHJvZml0IGZvciB0aGlzIHF1ZXJ5IGlkIHRvIDAgKi8KcGxheWVyUHJvZml0W215aWRdID0gMDsKCi8qIHNhZmVseSByZWR1Y2UgbWF4UGVuZGluZ1BheW91dHMgbGlhYmlsaXR5ICovCm1heFBlbmRpbmdQYXlvdXRzID0gc2FmZVN1YihtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7CgovKiBtYXAgdGhlIHBsYXllckJldFZhbHVlIGZvciB0aGlzIHF1ZXJ5IGlkICovCnBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSA9IHBsYXllckJldFZhbHVlW215aWRdOwovKiBzZXQgIHBsYXllckJldFZhbHVlIGZvciB0aGlzIHF1ZXJ5IGlkIHRvIDAgKi8KcGxheWVyQmV0VmFsdWVbbXlpZF0gPSAwOwoKLyoKKiByZWZ1bmQKKiBpZiByZXN1bHQgaXMgMCByZXN1bHQgaXMgZW1wdHkgb3Igbm8gcHJvb2YgcmVmdW5kIG9yaWdpbmFsIGJldCB2YWx1ZQoqIGlmIHJlZnVuZCBmYWlscyBzYXZlIHJlZnVuZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHMKKi8KaWYgKHBsYXllckRpZVJlc3VsdFtteWlkXT09IDAgfHwgYnl0ZXMocmVzdWx0KS5sZW5ndGggPT0gMCB8fCBieXRlcyhwcm9vZikubGVuZ3RoID09IDApewoKTG9nUmVzdWx0KHNlcmlhbE51bWJlck9mUmVzdWx0LCBwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMywgcHJvb2YpOwoKLyoKKiBzZW5kIHJlZnVuZCAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0CiogaWYgc2VuZCBmYWlscyBtYXAgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQoqIGZvciB3aXRoZHJhd2FsIGxhdGVyIHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMKKi8KaWYgKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSkpewpMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCA0LCBwcm9vZik7Ci8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLwpwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0pOwp9CgpyZXR1cm47Cn0KCi8qCiogcGF5IHdpbm5lcgoqIHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHRvIGNhbGN1bGF0ZSBuZXcgbWF4IGJldAoqIHNlbmQgcmV3YXJkCiogaWYgc2VuZCBvZiByZXdhcmQgZmFpbHMgc2F2ZSB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHMKKi8KaWYgKHBsYXllckRpZVJlc3VsdFtteWlkXSA8IHBsYXllck51bWJlcltteWlkXSl7CgovKiBzYWZlbHkgcmVkdWNlIGNvbnRyYWN0IGJhbGFuY2UgYnkgcGxheWVyIHByb2ZpdCAqLwpjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7CgovKiB1cGRhdGUgdG90YWwgd2VpIHdvbiAqLwp0b3RhbFdlaVdvbiA9IHNhZmVBZGQodG90YWxXZWlXb24sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOwoKLyogc2FmZWx5IGNhbGN1bGF0ZSBwYXlvdXQgdmlhIHByb2ZpdCBwbHVzIG9yaWdpbmFsIHdhZ2VyICovCnBsYXllclRlbXBSZXdhcmRbbXlpZF0gPSBzYWZlQWRkKHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSk7CgpMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSwgMSwgcHJvb2YpOwoKLyogdXBkYXRlIG1heGltdW0gcHJvZml0ICovCnNldE1heFByb2ZpdCgpOwoKLyoKKiBzZW5kIHdpbiAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0CiogaWYgc2VuZCBmYWlscyBtYXAgcmV3YXJkIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQoqIGZvciB3aXRoZHJhd2FsIGxhdGVyIHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMKKi8KaWYgKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBSZXdhcmRbbXlpZF0pKXsKTG9nUmVzdWx0KHNlcmlhbE51bWJlck9mUmVzdWx0LCBwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDIsIHByb29mKTsKLyogaWYgc2VuZCBmYWlsZWQgbGV0IHBsYXllciB3aXRoZHJhdyB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zICovCnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOwp9CgpyZXR1cm47Cgp9CgovKgoqIG5vIHdpbgoqIHNlbmQgMSB3ZWkgdG8gYSBsb3NpbmcgYmV0CiogdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gY2FsY3VsYXRlIG5ldyBtYXggYmV0CiovCmlmIChwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPj0gcGxheWVyTnVtYmVyW215aWRdKXsKCkxvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0sIDAsIHByb29mKTsKCi8qCiogIHNhZmUgYWRqdXN0IGNvbnRyYWN0QmFsYW5jZQoqICBzZXRNYXhQcm9maXQKKiAgc2VuZCAxIHdlaSB0byBsb3NpbmcgYmV0CiovCmNvbnRyYWN0QmFsYW5jZSA9IHNhZmVBZGQoY29udHJhY3RCYWxhbmNlLCAocGxheWVyVGVtcEJldFZhbHVlW215aWRdIC0gMSkpOwoKLyogdXBkYXRlIG1heGltdW0gcHJvZml0ICovCnNldE1heFByb2ZpdCgpOwoKLyoKKiBzZW5kIDEgd2VpIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QKKi8KaWYgKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKDEpKXsKLyogaWYgc2VuZCBmYWlsZWQgbGV0IHBsYXllciB3aXRoZHJhdyB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zICovCnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIDEpOwp9CgpyZXR1cm47Cgp9Cgp9CgovKgoqIHB1YmxpYyBmdW5jdGlvbgoqIGluIGNhc2Ugb2YgYSBmYWlsZWQgcmVmdW5kIG9yIHdpbiBzZW5kCiovCmZ1bmN0aW9uIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucygpIHB1YmxpYwpwYXlvdXRzQXJlQWN0aXZlCnJldHVybnMgKGJvb2wpCnsKdWludCB3aXRoZHJhd0Ftb3VudCA9IHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXTsKcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsKLyogZXh0ZXJuYWwgY2FsbCB0byB1bnRydXN0ZWQgY29udHJhY3QgKi8KaWYgKG1zZy5zZW5kZXIuY2FsbC52YWx1ZSh3aXRoZHJhd0Ftb3VudCkoKSkgewpyZXR1cm4gdHJ1ZTsKfSBlbHNlIHsKLyogaWYgc2VuZCBmYWlsZWQgcmV2ZXJ0IHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IDA7ICovCi8qIHBsYXllciBjYW4gdHJ5IHRvIHdpdGhkcmF3IGFnYWluIGxhdGVyICovCnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IHdpdGhkcmF3QW1vdW50OwpyZXR1cm4gZmFsc2U7Cn0KfQoKLyogY2hlY2sgZm9yIHBlbmRpbmcgd2l0aGRyYXdhbHMgICovCmZ1bmN0aW9uIHBsYXllckdldFBlbmRpbmdUeEJ5QWRkcmVzcyhhZGRyZXNzIGFkZHJlc3NUb0NoZWNrKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewpyZXR1cm4gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW2FkZHJlc3NUb0NoZWNrXTsKfQoKLyoKKiBpbnRlcm5hbCBmdW5jdGlvbgoqIHNldHMgbWF4IHByb2ZpdAoqLwpmdW5jdGlvbiBzZXRNYXhQcm9maXQoKSBpbnRlcm5hbCB7Cm1heFByb2ZpdCA9IChjb250cmFjdEJhbGFuY2UgKiBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKSAvIG1heFByb2ZpdERpdmlzb3I7Cn0KCi8qCiogb3duZXIvdHJlYXN1cnkgYWRkcmVzcyBvbmx5IGZ1bmN0aW9ucwoqLwpmdW5jdGlvbiBzZW5kRnVuZHMoKQpwYXlhYmxlCm9ubHlUcmVhc3VyeQp7Ci8qIHNhZmVseSB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSAqLwpjb250cmFjdEJhbGFuY2UgPSBzYWZlQWRkKGNvbnRyYWN0QmFsYW5jZSwgbXNnLnZhbHVlKTsKLyogdXBkYXRlIHRoZSBtYXhpbXVtIHByb2ZpdCAqLwpzZXRNYXhQcm9maXQoKTsKfQoKLyogc2V0IGdhcyBmb3Igb3JhY2xpemUgcXVlcnkgKi8KZnVuY3Rpb24gb3duZXJTZXRPcmFjbGl6ZVNhZmVHYXModWludDMyIG5ld1NhZmVHYXNUb09yYWNsaXplKSBwdWJsaWMKb25seU93bmVyCnsKZ2FzRm9yT3JhY2xpemUgPSBuZXdTYWZlR2FzVG9PcmFjbGl6ZTsKfQoKLyogb25seSBvd25lciBhZGp1c3QgY29udHJhY3QgYmFsYW5jZSB2YXJpYWJsZSAob25seSB1c2VkIGZvciBtYXggcHJvZml0IGNhbGMpICovCmZ1bmN0aW9uIG93bmVyVXBkYXRlQ29udHJhY3RCYWxhbmNlKHVpbnQgbmV3Q29udHJhY3RCYWxhbmNlSW5XZWkpIHB1YmxpYwpvbmx5T3duZXIKewpjb250cmFjdEJhbGFuY2UgPSBuZXdDb250cmFjdEJhbGFuY2VJbldlaTsKfQoKLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgaG91c2VFZGdlICovCmZ1bmN0aW9uIG93bmVyU2V0SG91c2VFZGdlKHVpbnQgbmV3SG91c2VFZGdlKSBwdWJsaWMKb25seU93bmVyCnsKaG91c2VFZGdlID0gbmV3SG91c2VFZGdlOwp9CgovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlICovCmZ1bmN0aW9uIG93bmVyU2V0TWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSh1aW50IG5ld01heFByb2ZpdEFzUGVyY2VudCkgcHVibGljCm9ubHlPd25lcgp7Ci8qIHJlc3RyaWN0IGVhY2ggYmV0IHRvIGEgbWF4aW11bSBwcm9maXQgb2YgMTAlIGNvbnRyYWN0QmFsYW5jZSAqLwpyZXF1aXJlKG5ld01heFByb2ZpdEFzUGVyY2VudCA8PSAxMDAwMDApOwptYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlID0gbmV3TWF4UHJvZml0QXNQZXJjZW50OwpzZXRNYXhQcm9maXQoKTsKfQoKLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgbWluQmV0ICovCmZ1bmN0aW9uIG93bmVyU2V0TWluQmV0KHVpbnQgbmV3TWluaW11bUJldCkgcHVibGljCm9ubHlPd25lcgp7Cm1pbkJldCA9IG5ld01pbmltdW1CZXQ7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gdHJhbnNmZXIgZXRoZXIgKi8KZnVuY3Rpb24gb3duZXJUcmFuc2ZlckV0aGVyKGFkZHJlc3Mgc2VuZFRvLCB1aW50IGFtb3VudCkgcHVibGljCm9ubHlPd25lcgp7Ci8qIHNhZmVseSB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB3aGVuIHNlbmRpbmcgb3V0IGZ1bmRzKi8KY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIGFtb3VudCk7Ci8qIHVwZGF0ZSBtYXggcHJvZml0ICovCnNldE1heFByb2ZpdCgpOwpyZXF1aXJlKHNlbmRUby5zZW5kKGFtb3VudCkpOwpMb2dPd25lclRyYW5zZmVyKHNlbmRUbywgYW1vdW50KTsKfQoKLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBkbyBtYW51YWwgcmVmdW5kCiogdXNlZCBvbmx5IGlmIGJldCBwbGFjZWQgKyBvcmFjbGl6ZSBmYWlsZWQgdG8gX19jYWxsYmFjawoqIGZpbHRlciBMb2dCZXQgYnkgYWRkcmVzcyBhbmQvb3IgcGxheWVyQmV0SWQ6CiogTG9nQmV0KHBsYXllckJldElkW3JuZ0lkXSwgcGxheWVyQWRkcmVzc1tybmdJZF0sIHNhZmVBZGQocGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJQcm9maXRbcm5nSWRdKSwgcGxheWVyUHJvZml0W3JuZ0lkXSwgcGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJOdW1iZXJbcm5nSWRdKTsKKiBjaGVjayB0aGUgZm9sbG93aW5nIGxvZ3MgZG8gbm90IGV4aXN0IGZvciBwbGF5ZXJCZXRJZCBhbmQvb3IgcGxheWVyQWRkcmVzc1tybmdJZF0gYmVmb3JlIHJlZnVuZGluZzoKKiBMb2dSZXN1bHQgb3IgTG9nUmVmdW5kCiogaWYgTG9nUmVzdWx0IGV4aXN0cyBwbGF5ZXIgc2hvdWxkIHVzZSB0aGUgd2l0aGRyYXcgcGF0dGVybiBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMKKi8KZnVuY3Rpb24gb3duZXJSZWZ1bmRQbGF5ZXIoYnl0ZXMzMiBvcmlnaW5hbFBsYXllckJldElkLCBhZGRyZXNzIHNlbmRUbywgdWludCBvcmlnaW5hbFBsYXllclByb2ZpdCwgdWludCBvcmlnaW5hbFBsYXllckJldFZhbHVlKSBwdWJsaWMKb25seU93bmVyCnsKLyogc2FmZWx5IHJlZHVjZSBwZW5kaW5nUGF5b3V0cyBieSBwbGF5ZXJQcm9maXRbcm5nSWRdICovCm1heFBlbmRpbmdQYXlvdXRzID0gc2FmZVN1YihtYXhQZW5kaW5nUGF5b3V0cywgb3JpZ2luYWxQbGF5ZXJQcm9maXQpOwovKiBzZW5kIHJlZnVuZCAqLwpyZXF1aXJlKHNlbmRUby5zZW5kKG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpKTsKLyogbG9nIHJlZnVuZHMgKi8KTG9nUmVmdW5kKG9yaWdpbmFsUGxheWVyQmV0SWQsIHNlbmRUbywgb3JpZ2luYWxQbGF5ZXJCZXRWYWx1ZSk7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGVtZXJnZW5jeSBwYXVzZSAjMSAqLwpmdW5jdGlvbiBvd25lclBhdXNlR2FtZShib29sIG5ld1N0YXR1cykgcHVibGljCm9ubHlPd25lcgp7CmdhbWVQYXVzZWQgPSBuZXdTdGF0dXM7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGVtZXJnZW5jeSBwYXVzZSAjMiAqLwpmdW5jdGlvbiBvd25lclBhdXNlUGF5b3V0cyhib29sIG5ld1BheW91dFN0YXR1cykgcHVibGljCm9ubHlPd25lcgp7CnBheW91dHNQYXVzZWQgPSBuZXdQYXlvdXRTdGF0dXM7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IHRyZWFzdXJ5IGFkZHJlc3MgKi8KZnVuY3Rpb24gb3duZXJTZXRUcmVhc3VyeShhZGRyZXNzIG5ld1RyZWFzdXJ5KSBwdWJsaWMKb25seU93bmVyCnsKdHJlYXN1cnkgPSBuZXdUcmVhc3VyeTsKfQoKLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgb3duZXIgYWRkcmVzcyAqLwpmdW5jdGlvbiBvd25lckNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYwpvbmx5T3duZXIKewpvd25lciA9IG5ld093bmVyOwp9CgovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHN1aWNpZGUgLSBlbWVyZ2VuY3kgKi8KZnVuY3Rpb24gb3duZXJraWxsKCkgcHVibGljCm9ubHlPd25lcgp7CnN1aWNpZGUob3duZXIpOwp9CgoKfQ=='.
	

]
