Class {
	#name : #SRTb02bfbd57a9c6bf16eeedf346d5464a3f0dd9bc1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb02bfbd57a9c6bf16eeedf346d5464a3f0dd9bc1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIERvbmV0aCAoRG9uZXRoKQogKiBAZGV2IERvbmV0aCBpcyBhIGNvbnRyYWN0IHRoYXQgYWxsb3dzIHNoYXJlZCBhY2Nlc3MgdG8gZnVuZHMKICogaW4gdGhlIGZvcm0gb2YgRXRoZXIgYW5kIEVSQzIwIHRva2Vucy4gSXQgaXMgZXNwZWNpYWxseSByZWxldmFudAogKiB0byBkb25hdGlvbiBiYXNlZCBwcm9qZWN0cy4gVGhlIGFkbWlucyBvZiB0aGUgY29udHJhY3QgZGV0ZXJtaW5lIAogKiB3aG8gaXMgYSBtZW1iZXIsIGFuZCBlYWNoIG1lbWJlciBnZXRzIGEgbnVtYmVyIG9mIHNoYXJlcy4gVGhlIAogKiBudW1iZXIgb2Ygc2hhcmVzIGVhY2ggbWVtYmVyIGhhcyBkZXRlcm1pbmVzIGhvdyBtdWNoIEV0aGVyL0VSQzIwIAogKiB0aGUgbWVtYmVyIGNhbiB3aXRoZHJhdyBmcm9tIHRoZSBjb250cmFjdC4KICovCgovKgogKiBPd25hYmxlCiAqCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4KICogUHJvdmlkZXMgb25seU93bmVyIG1vZGlmaWVyLCB3aGljaCBwcmV2ZW50cyBmdW5jdGlvbiBmcm9tIHJ1bm5pbmcKICogaWYgaXQgaXMgY2FsbGVkIGJ5IGFueW9uZSBvdGhlciB0aGFuIHRoZSBvd25lci4KICovCgpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgRG9uZXRoIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7ICAKCiAgICAvLyBOYW1lIG9mIHRoZSBjb250cmFjdAogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwoKICAgIC8vIFN1bSBvZiBhbGwgc2hhcmVzIGFsbG9jYXRlZCB0byBtZW1iZXJzCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFNoYXJlczsKCiAgICAvLyBTdW0gb2YgYWxsIHdpdGhkcmF3YWxzIGRvbmUgYnkgbWVtYmVycwogICAgdWludDI1NiBwdWJsaWMgdG90YWxXaXRoZHJhd247CgogICAgLy8gQmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNvbnRyYWN0IHdhcyBjcmVhdGVkCiAgICB1aW50MjU2IHB1YmxpYyBnZW5lc2lzQmxvY2tOdW1iZXI7CgogICAgLy8gTnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIGZvciBmbG9hdGluZyBwb2ludCBkaXZpc2lvbgogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgUFJFQ0lTSU9OID0gMTg7CgogICAgLy8gVmFyaWFibGVzIGZvciBzaGFyZWQgZXhwZW5zZSBhbGxvY2F0aW9uCiAgICB1aW50MjU2IHB1YmxpYyBzaGFyZWRFeHBlbnNlOwogICAgdWludDI1NiBwdWJsaWMgc2hhcmVkRXhwZW5zZVdpdGhkcmF3bjsKCiAgICAvLyBVc2VkIHRvIGtlZXAgdHJhY2sgb2YgbWVtYmVycwogICAgbWFwcGluZyhhZGRyZXNzID0+IE1lbWJlcikgcHVibGljIG1lbWJlcnM7CiAgICBhZGRyZXNzW10gcHVibGljIG1lbWJlcktleXM7CiAgICBzdHJ1Y3QgTWVtYmVyIHsKICAgICAgICBib29sIGV4aXN0czsKICAgICAgICBib29sIGFkbWluOwogICAgICAgIHVpbnQyNTYgc2hhcmVzOwogICAgICAgIHVpbnQyNTYgd2l0aGRyYXduOwogICAgICAgIHN0cmluZyBtZW1iZXJOYW1lOwogICAgICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSB0b2tlbnNXaXRoZHJhd247CiAgICB9CgogICAgLy8gVXNlZCB0byBrZWVwIHRyYWNrIG9mIEVSQzIwIHRva2VucyB1c2VkIGFuZCBob3cgbXVjaCB3aXRoZHJhd24KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBUb2tlbikgcHVibGljIHRva2VuczsKICAgIGFkZHJlc3NbXSBwdWJsaWMgdG9rZW5LZXlzOwogICAgc3RydWN0IFRva2VuIHsKICAgICAgICBib29sIGV4aXN0czsKICAgICAgICB1aW50MjU2IHRvdGFsV2l0aGRyYXduOwogICAgfQoKICAgIGZ1bmN0aW9uIERvbmV0aChzdHJpbmcgX2NvbnRyYWN0TmFtZSwgc3RyaW5nIF9mb3VuZGVyTmFtZSkgewogICAgICAgIGlmIChieXRlcyhfY29udHJhY3ROYW1lKS5sZW5ndGggPiAyMSkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGJ5dGVzKF9mb3VuZGVyTmFtZSkubGVuZ3RoID4gMjEpIHJldmVydCgpOwogICAgICAgIG5hbWUgPSBfY29udHJhY3ROYW1lOwogICAgICAgIGdlbmVzaXNCbG9ja051bWJlciA9IGJsb2NrLm51bWJlcjsKICAgICAgICBhZGRNZW1iZXIobXNnLnNlbmRlciwgMSwgdHJ1ZSwgX2ZvdW5kZXJOYW1lKTsKICAgIH0KCiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgZnJvbSwgdWludCB2YWx1ZSk7CiAgICBldmVudCBXaXRoZHJhdyhhZGRyZXNzIGZyb20sIHVpbnQgdmFsdWUsIHVpbnQyNTYgbmV3VG90YWxXaXRoZHJhd24pOwogICAgZXZlbnQgVG9rZW5XaXRoZHJhdyhhZGRyZXNzIGZyb20sIHVpbnQgdmFsdWUsIGFkZHJlc3MgdG9rZW4sIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IEFkZFNoYXJlKGFkZHJlc3Mgd2hvLCB1aW50MjU2IGFkZGVkU2hhcmVzLCB1aW50MjU2IG5ld1RvdGFsU2hhcmVzKTsKICAgIGV2ZW50IFJlbW92ZVNoYXJlKGFkZHJlc3Mgd2hvLCB1aW50MjU2IHJlbW92ZWRTaGFyZXMsIHVpbnQyNTYgbmV3VG90YWxTaGFyZXMpOwogICAgZXZlbnQgQ2hhbmdlUHJpdmlsZWdlKGFkZHJlc3Mgd2hvLCBib29sIG9sZFZhbHVlLCBib29sIG5ld1ZhbHVlKTsKICAgIGV2ZW50IENoYW5nZUNvbnRyYWN0TmFtZShzdHJpbmcgb2xkVmFsdWUsIHN0cmluZyBuZXdWYWx1ZSk7CiAgICBldmVudCBDaGFuZ2VNZW1iZXJOYW1lKGFkZHJlc3Mgd2hvLCBzdHJpbmcgb2xkVmFsdWUsIHN0cmluZyBuZXdWYWx1ZSk7CiAgICBldmVudCBDaGFuZ2VTaGFyZWRFeHBlbnNlKHVpbnQyNTYgY29udHJhY3RCYWxhbmNlLCB1aW50MjU2IG9sZFZhbHVlLCB1aW50MjU2IG5ld1ZhbHVlKTsKICAgIGV2ZW50IFdpdGhkcmF3U2hhcmVkRXhwZW5zZShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIHVpbnQyNTYgbmV3U2hhcmVkRXhwZW5zZVdpdGhkcmF3bik7CgogICAgLy8gRmFsbGJhY2sgZnVuY3Rpb24gYWNjZXB0cyBFdGhlciBmcm9tIGRvbmF0b3JzCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpIHsgCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgIW1lbWJlcnNbbXNnLnNlbmRlcl0uYWRtaW4pIHJldmVydCgpOyAgIAogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUV4aXN0aW5nKGFkZHJlc3Mgd2hvKSB7IAogICAgICAgIGlmICghbWVtYmVyc1t3aG9dLmV4aXN0cykgcmV2ZXJ0KCk7IAogICAgICAgIF87CiAgICB9CgogICAgLy8gU2VyaWVzIG9mIGdldHRlciBmdW5jdGlvbnMgZm9yIGNvbnRyYWN0IGRhdGEKICAgIGZ1bmN0aW9uIGdldE1lbWJlckNvdW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBtZW1iZXJLZXlzLmxlbmd0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0TWVtYmVyQXRLZXkodWludCBrZXkpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gbWVtYmVyS2V5c1trZXldOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0Q29udHJhY3RJbmZvKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nLCBhZGRyZXNzLCB1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIChzdHJpbmcobmFtZSksIG93bmVyLCBnZW5lc2lzQmxvY2tOdW1iZXIsIHRvdGFsU2hhcmVzLCB0b3RhbFdpdGhkcmF3bik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJldHVybk1lbWJlcihhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgb25seUV4aXN0aW5nKF9hZGRyZXNzKSByZXR1cm5zKGJvb2wgYWRtaW4sIHVpbnQyNTYgc2hhcmVzLCB1aW50MjU2IHdpdGhkcmF3biwgc3RyaW5nIG1lbWJlck5hbWUpIHsKICAgICAgTWVtYmVyIG1lbW9yeSBtID0gbWVtYmVyc1tfYWRkcmVzc107CiAgICAgIHJldHVybiAobS5hZG1pbiwgbS5zaGFyZXMsIG0ud2l0aGRyYXduLCBtLm1lbWJlck5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrRVJDMjBCYWxhbmNlKGFkZHJlc3MgdG9rZW4pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBFUkMyMCh0b2tlbikuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIGlmICghdG9rZW5zW3Rva2VuXS5leGlzdHMgJiYgYmFsYW5jZSA+IDApIHsKICAgICAgICAgICAgdG9rZW5zW3Rva2VuXS5leGlzdHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYmFsYW5jZTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiB0byBhZGQgbWVtYmVycyB0byB0aGUgY29udHJhY3QgCiAgICBmdW5jdGlvbiBhZGRNZW1iZXIoYWRkcmVzcyB3aG8sIHVpbnQyNTYgc2hhcmVzLCBib29sIGFkbWluLCBzdHJpbmcgbWVtYmVyTmFtZSkgcHVibGljIG9ubHlBZG1pbigpIHsKICAgICAgICAvLyBEb24ndCBhbGxvdyB0aGUgc2FtZSBtZW1iZXIgdG8gYmUgYWRkZWQgdHdpY2UKICAgICAgICBpZiAobWVtYmVyc1t3aG9dLmV4aXN0cykgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGJ5dGVzKG1lbWJlck5hbWUpLmxlbmd0aCA+IDIxKSByZXZlcnQoKTsKCiAgICAgICAgTWVtYmVyIG1lbW9yeSBuZXdNZW1iZXI7CiAgICAgICAgbmV3TWVtYmVyLmV4aXN0cyA9IHRydWU7CiAgICAgICAgbmV3TWVtYmVyLmFkbWluID0gYWRtaW47CiAgICAgICAgbmV3TWVtYmVyLm1lbWJlck5hbWUgPSBtZW1iZXJOYW1lOwoKICAgICAgICBtZW1iZXJzW3dob10gPSBuZXdNZW1iZXI7CiAgICAgICAgbWVtYmVyS2V5cy5wdXNoKHdobyk7CiAgICAgICAgYWRkU2hhcmUod2hvLCBzaGFyZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZU1lbWJlcihhZGRyZXNzIHdobywgdWludDI1NiBzaGFyZXMsIGJvb2wgaXNBZG1pbiwgc3RyaW5nIG5hbWUpIHB1YmxpYyBvbmx5QWRtaW4oKSB7CiAgICAgICAgaWYgKHNoYTMobWVtYmVyc1t3aG9dLm1lbWJlck5hbWUpICE9IHNoYTMobmFtZSkpIGNoYW5nZU1lbWJlck5hbWUod2hvLCBuYW1lKTsKICAgICAgICBpZiAobWVtYmVyc1t3aG9dLmFkbWluICE9IGlzQWRtaW4pIGNoYW5nZUFkbWluUHJpdmlsZWdlKHdobywgaXNBZG1pbik7CiAgICAgICAgaWYgKG1lbWJlcnNbd2hvXS5zaGFyZXMgIT0gc2hhcmVzKSBhbGxvY2F0ZVNoYXJlcyh3aG8sIHNoYXJlcyk7CiAgICB9CgogICAgLy8gT25seSBvd25lciwgYWRtaW4gb3IgbWVtYmVyIGNhbiBjaGFuZ2UgbWVtYmVyJ3MgbmFtZQogICAgZnVuY3Rpb24gY2hhbmdlTWVtYmVyTmFtZShhZGRyZXNzIHdobywgc3RyaW5nIG5ld05hbWUpIHB1YmxpYyBvbmx5RXhpc3Rpbmcod2hvKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gd2hvICYmIG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgIW1lbWJlcnNbbXNnLnNlbmRlcl0uYWRtaW4pIHJldmVydCgpOwogICAgICAgIGlmIChieXRlcyhuZXdOYW1lKS5sZW5ndGggPiAyMSkgcmV2ZXJ0KCk7CiAgICAgICAgQ2hhbmdlTWVtYmVyTmFtZSh3aG8sIG1lbWJlcnNbd2hvXS5tZW1iZXJOYW1lLCBuZXdOYW1lKTsKICAgICAgICBtZW1iZXJzW3dob10ubWVtYmVyTmFtZSA9IG5ld05hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlQWRtaW5Qcml2aWxlZ2UoYWRkcmVzcyB3aG8sIGJvb2wgbmV3VmFsdWUpIHB1YmxpYyBvbmx5QWRtaW4oKSB7CiAgICAgICAgQ2hhbmdlUHJpdmlsZWdlKHdobywgbWVtYmVyc1t3aG9dLmFkbWluLCBuZXdWYWx1ZSk7CiAgICAgICAgbWVtYmVyc1t3aG9dLmFkbWluID0gbmV3VmFsdWU7IAogICAgfQoKICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBvd25lcnMgY2FuIGNoYW5nZSB0aGUgY29udHJhY3QgbmFtZQogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJhY3ROYW1lKHN0cmluZyBuZXdOYW1lKSBwdWJsaWMgb25seUFkbWluKCkgewogICAgICAgIGlmIChieXRlcyhuZXdOYW1lKS5sZW5ndGggPiAyMSkgcmV2ZXJ0KCk7CiAgICAgICAgQ2hhbmdlQ29udHJhY3ROYW1lKG5hbWUsIG5ld05hbWUpOwogICAgICAgIG5hbWUgPSBuZXdOYW1lOwogICAgfQoKICAgIC8vIFNoYXJlZCBleHBlbnNlIGFsbG9jYXRpb24gYWxsb3dzIGFkbWlucyB0byB3aXRoZHJhdyBhbiBhbW91bnQgdG8gYmUgdXNlZCBmb3Igc2hhcmVkCiAgICAvLyBleHBlbnNlcy4gU2hhcmVkIGV4cGVuc2UgYWxsb2NhdGlvbiBzdWJ0cmFjdHMgZnJvbSB0aGUgdG90YWwgYmFsYW5jZSBvZiB0aGUgY29udHJhY3QuIAogICAgLy8gT25seSBvd25lciBjYW4gY2hhbmdlIHRoaXMgYW1vdW50LgogICAgZnVuY3Rpb24gY2hhbmdlU2hhcmVkRXhwZW5zZUFsbG9jYXRpb24odWludDI1NiBuZXdBbGxvY2F0aW9uKSBwdWJsaWMgb25seU93bmVyKCkgewogICAgICAgIGlmIChuZXdBbGxvY2F0aW9uIDwgc2hhcmVkRXhwZW5zZVdpdGhkcmF3bikgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKG5ld0FsbG9jYXRpb24uc3ViKHNoYXJlZEV4cGVuc2VXaXRoZHJhd24pID4gdGhpcy5iYWxhbmNlKSByZXZlcnQoKTsKCiAgICAgICAgQ2hhbmdlU2hhcmVkRXhwZW5zZSh0aGlzLmJhbGFuY2UsIHNoYXJlZEV4cGVuc2UsIG5ld0FsbG9jYXRpb24pOwogICAgICAgIHNoYXJlZEV4cGVuc2UgPSBuZXdBbGxvY2F0aW9uOwogICAgfQoKICAgIC8vIFNldCBzaGFyZSBhbW91bnQgZXhwbGljaXRseSBieSBjYWxjdWxhdGluZyBkaWZmZXJlbmNlIHRoZW4gYWRkaW5nIG9yIHJlbW92aW5nIGFjY29yZGluZ2x5CiAgICBmdW5jdGlvbiBhbGxvY2F0ZVNoYXJlcyhhZGRyZXNzIHdobywgdWludDI1NiBhbW91bnQpIHB1YmxpYyBvbmx5QWRtaW4oKSBvbmx5RXhpc3Rpbmcod2hvKSB7CiAgICAgICAgdWludDI1NiBjdXJyZW50U2hhcmVzID0gbWVtYmVyc1t3aG9dLnNoYXJlczsKICAgICAgICBpZiAoYW1vdW50ID09IGN1cnJlbnRTaGFyZXMpIHJldmVydCgpOwogICAgICAgIGlmIChhbW91bnQgPiBjdXJyZW50U2hhcmVzKSB7CiAgICAgICAgICAgIGFkZFNoYXJlKHdobywgYW1vdW50LnN1YihjdXJyZW50U2hhcmVzKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVtb3ZlU2hhcmUod2hvLCBjdXJyZW50U2hhcmVzLnN1YihhbW91bnQpKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gSW5jcmVtZW50IHRoZSBudW1iZXIgb2Ygc2hhcmVzIGZvciBhIG1lbWJlcgogICAgZnVuY3Rpb24gYWRkU2hhcmUoYWRkcmVzcyB3aG8sIHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgb25seUFkbWluKCkgb25seUV4aXN0aW5nKHdobykgewogICAgICAgIHRvdGFsU2hhcmVzID0gdG90YWxTaGFyZXMuYWRkKGFtb3VudCk7CiAgICAgICAgbWVtYmVyc1t3aG9dLnNoYXJlcyA9IG1lbWJlcnNbd2hvXS5zaGFyZXMuYWRkKGFtb3VudCk7CiAgICAgICAgQWRkU2hhcmUod2hvLCBhbW91bnQsIG1lbWJlcnNbd2hvXS5zaGFyZXMpOwogICAgfQoKICAgIC8vIERlY3JlbWVudCB0aGUgbnVtYmVyIG9mIHNoYXJlcyBmb3IgYSBtZW1iZXIKICAgIGZ1bmN0aW9uIHJlbW92ZVNoYXJlKGFkZHJlc3Mgd2hvLCB1aW50MjU2IGFtb3VudCkgcHVibGljIG9ubHlBZG1pbigpIG9ubHlFeGlzdGluZyh3aG8pIHsKICAgICAgICB0b3RhbFNoYXJlcyA9IHRvdGFsU2hhcmVzLnN1YihhbW91bnQpOwogICAgICAgIG1lbWJlcnNbd2hvXS5zaGFyZXMgPSBtZW1iZXJzW3dob10uc2hhcmVzLnN1YihhbW91bnQpOwogICAgICAgIFJlbW92ZVNoYXJlKHdobywgYW1vdW50LCBtZW1iZXJzW3dob10uc2hhcmVzKTsKICAgIH0KCiAgICAvLyBGdW5jdGlvbiBmb3IgYSBtZW1iZXIgdG8gd2l0aGRyYXcgRXRoZXIgZnJvbSB0aGUgY29udHJhY3QgcHJvcG9ydGlvbmFsCiAgICAvLyB0byB0aGUgYW1vdW50IG9mIHNoYXJlcyB0aGV5IGhhdmUuIENhbGN1bGF0ZXMgdGhlIHRvdGFsV2l0aGRyYXdhYmxlQW1vdW50CiAgICAvLyBpbiBFdGhlciBiYXNlZCBvbiB0aGUgbWVtYmVyJ3Mgc2hhcmUgYW5kIHRoZSBFdGhlciBiYWxhbmNlIG9mIHRoZSBjb250cmFjdCwKICAgIC8vIHRoZW4gc3VidHJhY3RzIHRoZSBhbW91bnQgb2YgRXRoZXIgdGhhdCB0aGUgbWVtYmVyIGhhcyBhbHJlYWR5IHByZXZpb3VzbHkKICAgIC8vIHdpdGhkcmF3bi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgb25seUV4aXN0aW5nKG1zZy5zZW5kZXIpIHsKICAgICAgICB1aW50MjU2IG5ld1RvdGFsID0gY2FsY3VsYXRlVG90YWxXaXRoZHJhd2FibGVBbW91bnQobXNnLnNlbmRlcik7CiAgICAgICAgaWYgKGFtb3VudCA+IG5ld1RvdGFsLnN1YihtZW1iZXJzW21zZy5zZW5kZXJdLndpdGhkcmF3bikpIHJldmVydCgpOwogICAgICAgIAogICAgICAgIG1lbWJlcnNbbXNnLnNlbmRlcl0ud2l0aGRyYXduID0gbWVtYmVyc1ttc2cuc2VuZGVyXS53aXRoZHJhd24uYWRkKGFtb3VudCk7CiAgICAgICAgdG90YWxXaXRoZHJhd24gPSB0b3RhbFdpdGhkcmF3bi5hZGQoYW1vdW50KTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgV2l0aGRyYXcobXNnLnNlbmRlciwgYW1vdW50LCB0b3RhbFdpdGhkcmF3bik7CiAgICB9CgogICAgLy8gV2l0aGRyYXdhbCBmdW5jdGlvbiBmb3IgRVJDMjAgdG9rZW5zCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKHVpbnQyNTYgYW1vdW50LCBhZGRyZXNzIHRva2VuKSBwdWJsaWMgb25seUV4aXN0aW5nKG1zZy5zZW5kZXIpIHsKICAgICAgICB1aW50MjU2IG5ld1RvdGFsID0gY2FsY3VsYXRlVG90YWxXaXRoZHJhd2FibGVUb2tlbkFtb3VudChtc2cuc2VuZGVyLCB0b2tlbik7CiAgICAgICAgaWYgKGFtb3VudCA+IG5ld1RvdGFsLnN1YihtZW1iZXJzW21zZy5zZW5kZXJdLnRva2Vuc1dpdGhkcmF3blt0b2tlbl0pKSByZXZlcnQoKTsKCiAgICAgICAgbWVtYmVyc1ttc2cuc2VuZGVyXS50b2tlbnNXaXRoZHJhd25bdG9rZW5dID0gbWVtYmVyc1ttc2cuc2VuZGVyXS50b2tlbnNXaXRoZHJhd25bdG9rZW5dLmFkZChhbW91bnQpOwogICAgICAgIHRva2Vuc1t0b2tlbl0udG90YWxXaXRoZHJhd24gPSB0b2tlbnNbdG9rZW5dLnRvdGFsV2l0aGRyYXduLmFkZChhbW91bnQpOwogICAgICAgIEVSQzIwKHRva2VuKS50cmFuc2Zlcihtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgICAgIFRva2VuV2l0aGRyYXcobXNnLnNlbmRlciwgYW1vdW50LCB0b2tlbiwgdG9rZW5zW3Rva2VuXS50b3RhbFdpdGhkcmF3bik7CiAgICB9CgogICAgLy8gV2l0aGRyYXcgZnJvbSBzaGFyZWQgZXhwZW5zZSBhbGxvY2F0aW9uLiBUb3RhbCB3aXRoZHJhd2FibGUgaXMgY2FsY3VsYXRlZCBhcyAKICAgIC8vIHNoYXJlZEV4cGVuc2UgbWludXMgc2hhcmVkRXhwZW5zZVdpdGhkcmF3bi4gT25seSBBZG1pbiBjYW4gd2l0aGRyYXcgZnJvbSBzaGFyZWQgZXhwZW5zZS4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3U2hhcmVkRXhwZW5zZSh1aW50MjU2IGFtb3VudCwgYWRkcmVzcyB0bykgcHVibGljIG9ubHlBZG1pbigpIHsKICAgICAgICBpZiAoYW1vdW50ID4gY2FsY3VsYXRlVG90YWxFeHBlbnNlV2l0aGRyYXdhYmxlQW1vdW50KCkpIHJldmVydCgpOwogICAgICAgIAogICAgICAgIHNoYXJlZEV4cGVuc2VXaXRoZHJhd24gPSBzaGFyZWRFeHBlbnNlV2l0aGRyYXduLmFkZChhbW91bnQpOwogICAgICAgIHRvLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgV2l0aGRyYXdTaGFyZWRFeHBlbnNlKG1zZy5zZW5kZXIsIHRvLCBhbW91bnQsIHNoYXJlZEV4cGVuc2VXaXRoZHJhd24pOwogICAgfQoKICAgIC8vIENvbnZlcnRzIGZyb20gc2hhcmVzIHRvIEV0aC4KICAgIC8vIEV4OiAyIHNoYXJlcywgNCB0b3RhbCBzaGFyZXMsIDQwIEV0aCBiYWxhbmNlCiAgICAvLyA0MCBFdGggLyA0IHRvdGFsIHNoYXJlcyA9IDEwIGV0aCBwZXIgc2hhcmUgKiAyIHNoYXJlcyA9IDIwIEV0aCB0byBjYXNoIG91dAogICAgZnVuY3Rpb24gY2FsY3VsYXRlVG90YWxXaXRoZHJhd2FibGVBbW91bnQoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCBvbmx5RXhpc3Rpbmcod2hvKSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gVG90YWwgYmFsYW5jZSB0byBjYWxjdWxhdGUgc2hhcmUgZnJvbSA9IAogICAgICAgIC8vIGNvbnRyYWN0IGJhbGFuY2UgKyB0b3RhbFdpdGhkcmF3biAtIHNoYXJlZEV4cGVuc2UgKyBzaGFyZWRFeHBlbnNlV2l0aGRyYXduCiAgICAgICAgdWludDI1NiBiYWxhbmNlU3VtID0gdGhpcy5iYWxhbmNlLmFkZCh0b3RhbFdpdGhkcmF3bik7CiAgICAgICAgYmFsYW5jZVN1bSA9IGJhbGFuY2VTdW0uc3ViKHNoYXJlZEV4cGVuc2UpOwogICAgICAgIGJhbGFuY2VTdW0gPSBiYWxhbmNlU3VtLmFkZChzaGFyZWRFeHBlbnNlV2l0aGRyYXduKTsKICAgICAgICAKICAgICAgICAvLyBOZWVkIHRvIHVzZSBwYXJ0cy1wZXIgbm90YXRpb24gdG8gY29tcHV0ZSBwZXJjZW50YWdlcyBmb3IgbGFjayBvZiBmbG9hdGluZyBwb2ludCBkaXZpc2lvbgogICAgICAgIHVpbnQyNTYgZXRoUGVyU2hhcmVQUE4gPSBiYWxhbmNlU3VtLnBlcmNlbnQodG90YWxTaGFyZXMsIFBSRUNJU0lPTik7IAogICAgICAgIHVpbnQyNTYgZXRoUFBOID0gZXRoUGVyU2hhcmVQUE4ubXVsKG1lbWJlcnNbd2hvXS5zaGFyZXMpOwogICAgICAgIHVpbnQyNTYgZXRoVmFsID0gZXRoUFBOLmRpdigxMCoqUFJFQ0lTSU9OKTsgCiAgICAgICAgcmV0dXJuIGV0aFZhbDsKICAgIH0KCgogICAgZnVuY3Rpb24gY2FsY3VsYXRlVG90YWxXaXRoZHJhd2FibGVUb2tlbkFtb3VudChhZGRyZXNzIHdobywgYWRkcmVzcyB0b2tlbikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgYmFsYW5jZVN1bSA9IGNoZWNrRVJDMjBCYWxhbmNlKHRva2VuKS5hZGQodG9rZW5zW3Rva2VuXS50b3RhbFdpdGhkcmF3bik7CgogICAgICAgIC8vIE5lZWQgdG8gdXNlIHBhcnRzLXBlciBub3RhdGlvbiB0byBjb21wdXRlIHBlcmNlbnRhZ2VzIGZvciBsYWNrIG9mIGZsb2F0aW5nIHBvaW50IGRpdmlzaW9uCiAgICAgICAgdWludDI1NiB0b2tQZXJTaGFyZVBQTiA9IGJhbGFuY2VTdW0ucGVyY2VudCh0b3RhbFNoYXJlcywgUFJFQ0lTSU9OKTsgCiAgICAgICAgdWludDI1NiB0b2tQUE4gPSB0b2tQZXJTaGFyZVBQTi5tdWwobWVtYmVyc1t3aG9dLnNoYXJlcyk7CiAgICAgICAgdWludDI1NiB0b2tWYWwgPSB0b2tQUE4uZGl2KDEwKipQUkVDSVNJT04pOyAKICAgICAgICByZXR1cm4gdG9rVmFsOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRvdGFsRXhwZW5zZVdpdGhkcmF3YWJsZUFtb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc2hhcmVkRXhwZW5zZS5zdWIoc2hhcmVkRXhwZW5zZVdpdGhkcmF3bik7CiAgICB9CgogICAgLy8gVXNlZCBmb3IgdGVzdGluZwogICAgZnVuY3Rpb24gZGVsZWdhdGVQZXJjZW50KHVpbnQyNTYgYSwgdWludDI1NiBiLCB1aW50MjU2IGMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGEucGVyY2VudChiLCBjKTsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvLyBVc2luZyBmcm9tIFNPOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80MjczODY0MC9kaXZpc2lvbi1pbi1ldGhlcmV1bS1zb2xpZGl0eS80MjczOTg0MyM0MjczOTg0MwogICAgLy8gQWRhcHRlZCB0byB1c2UgU2FmZU1hdGggYW5kIHVpbnQyNTYuCiAgICBmdW5jdGlvbiBwZXJjZW50KHVpbnQyNTYgbnVtZXJhdG9yLCB1aW50MjU2IGRlbm9taW5hdG9yLCB1aW50MjU2IHByZWNpc2lvbikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IHF1b3RpZW50KSB7CiAgICAgICAgLy8gY2F1dGlvbiwgY2hlY2sgc2FmZS10by1tdWx0aXBseSBoZXJlCiAgICAgICAgdWludDI1NiBfbnVtZXJhdG9yID0gbXVsKG51bWVyYXRvciwgMTAgKiogKHByZWNpc2lvbisxKSk7CiAgICAgICAgLy8gd2l0aCByb3VuZGluZyBvZiBsYXN0IGRpZ2l0CiAgICAgICAgdWludDI1NiBfcXVvdGllbnQgPSAoZGl2KF9udW1lcmF0b3IsIGRlbm9taW5hdG9yKSArIDUpIC8gMTA7CiAgICAgICAgcmV0dXJuIChfcXVvdGllbnQpOwogICAgfQp9'.
	

]
