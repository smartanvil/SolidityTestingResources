Class {
	#name : #SRTbb6641d34755a19352ff63a31d82a84f981d4d69,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbb6641d34755a19352ff63a31d82a84f981d4d69 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBNYW5hZ2VyIHsKICAgIGFkZHJlc3MgcHVibGljIGNlbzsKICAgIGFkZHJlc3MgcHVibGljIGNmbzsKICAgIGFkZHJlc3MgcHVibGljIGNvbzsKICAgIGFkZHJlc3MgcHVibGljIGNhbzsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNDZW8sIGFkZHJlc3MgaW5kZXhlZCBuZXdDZW8pOwogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKCgogICAgLyoqCiAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgKiBhY2NvdW50LgogICAgKi8KICAgIGZ1bmN0aW9uIE1hbmFnZXIoKSBwdWJsaWMgewogICAgICAgIGNvbyA9IG1zZy5zZW5kZXI7CiAgICAgICAgY2ZvID0gMHg0NDc4NzBDMmYzMzRGY2RhNjhlNjQ0YUU1M0RiMzQ3MUE5ZjczMDJEOwogICAgICAgIGNlbyA9IDB4NkVDOUM2ZmNFMTVEQjk4MjUyMWVBMjA4NzQ3NDI5MWZBNUFkNmQzMTsKICAgICAgICBjYW8gPSAweDM5MUVmMmNCMGM4MUEyQzQ3RDY1OWMzZTNlNjY3NUY1NTBlNGIxODM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICovCiAgICBtb2RpZmllciBvbmx5Q0VPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZW8pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNPTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29vKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDQU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNhbyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdDZW8uCiAgICAqIEBwYXJhbSBuZXdDZW8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgKi8KICAgIGZ1bmN0aW9uIGRlbWlzZUNFTyhhZGRyZXNzIG5ld0NlbykgcHVibGljIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUobmV3Q2VvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGNlbywgbmV3Q2VvKTsKICAgICAgICBjZW8gPSBuZXdDZW87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q0ZPKGFkZHJlc3MgbmV3Q2ZvKSBwdWJsaWMgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShuZXdDZm8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY2ZvID0gbmV3Q2ZvOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIG5ld0NvbykgcHVibGljIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUobmV3Q29vICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGNvbyA9IG5ld0NvbzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDQU8oYWRkcmVzcyBuZXdDYW8pIHB1YmxpYyBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKG5ld0NhbyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjYW8gPSBuZXdDYW87CiAgICB9CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAgIC8qKgogICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICAqLwogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgKi8KICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgb25seUNBTyB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgICovCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seUNBTyB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgfQp9CmNvbnRyYWN0IFNraW5CYXNlIGlzIE1hbmFnZXIgewoKICAgIHN0cnVjdCBTa2luIHsKICAgICAgICB1aW50MTI4IGFwcGVhcmFuY2U7CiAgICAgICAgdWludDY0IGNvb2xkb3duRW5kVGltZTsKICAgICAgICB1aW50NjQgbWl4aW5nV2l0aElkOwogICAgfQoKICAgIC8vIEFsbCBza2lucywgbWFwcGluZyBmcm9tIHNraW4gaWQgdG8gc2tpbiBhcHByYW5jZQogICAgbWFwcGluZyAodWludDI1NiA9PiBTa2luKSBza2luczsKCiAgICAvLyBNYXBwaW5nIGZyb20gc2tpbiBpZCB0byBvd25lcgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgc2tpbklkVG9Pd25lcjsKCiAgICAvLyBXaGV0aGVyIGEgc2tpbiBpcyBvbiBzYWxlCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyBpc09uU2FsZTsKCiAgICAvLyBOdW1iZXIgb2YgYWxsIHRvdGFsIHZhbGlkIHNraW5zCiAgICAvLyBza2luSWQgMCBzaG91bGQgbm90IGNvcnJlc3BvbmQgdG8gYW55IHNraW4sIGJlY2F1c2Ugc2tpbi5taXhpbmdXaXRoSWQ9PTAgaW5kaWNhdGVzIG5vdCBtaXhpbmcKICAgIHVpbnQyNTYgcHVibGljIG5leHRTa2luSWQgPSAxOyAgCgogICAgLy8gTnVtYmVyIG9mIHNraW5zIGFuIGFjY291bnQgb3ducwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbnVtU2tpbk9mQWNjb3VudHM7CgogICAgLy8gLy8gR2l2ZSBzb21lIHNraW5zIHRvIGluaXQgYWNjb3VudCBmb3IgdW5pdCB0ZXN0cwogICAgLy8gZnVuY3Rpb24gU2tpbkJhc2UoKSBwdWJsaWMgewogICAgLy8gICAgIGFkZHJlc3MgYWNjb3VudDAgPSAweDYyNzMwNjA5MGFiYUIzQTZlMTQwMGU5MzQ1YkM2MGM3OGE4QkVmNTc7CiAgICAvLyAgICAgYWRkcmVzcyBhY2NvdW50MSA9IDB4ZjE3ZjUyMTUxRWJFRjZDNzMzNEZBRDA4MGM1NzA0RDc3MjE2YjczMjsKCiAgICAvLyAgICAgLy8gQ3JlYXRlIHNpbXBsZSBza2lucwogICAgLy8gICAgIFNraW4gbWVtb3J5IHNraW4gPSBTa2luKHthcHBlYXJhbmNlOiAwLCBjb29sZG93bkVuZFRpbWU6MCwgbWl4aW5nV2l0aElkOiAwfSk7CiAgICAvLyAgICAgZm9yICh1aW50MjU2IGkgPSAxOyBpIDw9IDE1OyBpKyspIHsKICAgIC8vICAgICAgICAgaWYgKGkgPCAxMCkgewogICAgLy8gICAgICAgICAgICAgc2tpbi5hcHBlYXJhbmNlID0gdWludDEyOChpKTsKICAgIC8vICAgICAgICAgICAgIGlmIChpIDwgNykgeyAKICAgIC8vICAgICAgICAgICAgICAgICBza2luSWRUb093bmVyW2ldID0gYWNjb3VudDA7CiAgICAvLyAgICAgICAgICAgICAgICAgbnVtU2tpbk9mQWNjb3VudHNbYWNjb3VudDBdICs9IDE7CiAgICAvLyAgICAgICAgICAgICB9IGVsc2UgeyAgCiAgICAvLyAgICAgICAgICAgICAgICAgc2tpbklkVG9Pd25lcltpXSA9IGFjY291bnQxOwogICAgLy8gICAgICAgICAgICAgICAgIG51bVNraW5PZkFjY291bnRzW2FjY291bnQxXSArPSAxOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICB9IGVsc2UgeyAgCiAgICAvLyAgICAgICAgICAgICBza2luLmFwcGVhcmFuY2UgPSB1aW50MTI4KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXIgLSBpICsgOSkpOwogICAgLy8gICAgICAgICAgICAgc2tpbklkVG9Pd25lcltpXSA9IGFjY291bnQxOwogICAgLy8gICAgICAgICAgICAgbnVtU2tpbk9mQWNjb3VudHNbYWNjb3VudDFdICs9IDE7CiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgICAgc2tpbnNbaV0gPSBza2luOwogICAgLy8gICAgICAgICBpc09uU2FsZVtpXSA9IGZhbHNlOwogICAgLy8gICAgICAgICBuZXh0U2tpbklkICs9IDE7CiAgICAvLyAgICAgfQogICAgLy8gfSAKCiAgICAvLyBHZXQgdGhlIGktdGggc2tpbiBhbiBhY2NvdW50IG93bnMsIGZvciBvZmYtY2hhaW4gdXNhZ2Ugb25seQogICAgZnVuY3Rpb24gc2tpbk9mQWNjb3VudEJ5SWQoYWRkcmVzcyBhY2NvdW50LCB1aW50MjU2IGlkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgIHVpbnQyNTYgY291bnQgPSAwOwogICAgICAgdWludDI1NiBudW1Ta2luT2ZBY2NvdW50ID0gbnVtU2tpbk9mQWNjb3VudHNbYWNjb3VudF07CiAgICAgICByZXF1aXJlKG51bVNraW5PZkFjY291bnQgPiAwKTsKICAgICAgIHJlcXVpcmUoaWQgPCBudW1Ta2luT2ZBY2NvdW50KTsKICAgICAgIGZvciAodWludDI1NiBpID0gMTsgaSA8IG5leHRTa2luSWQ7IGkrKykgewogICAgICAgICAgIGlmIChza2luSWRUb093bmVyW2ldID09IGFjY291bnQpIHsKICAgICAgICAgICAgICAgLy8gVGhpcyBza2luIGJlbG9uZ3MgdG8gY3VycmVudCBhY2NvdW50CiAgICAgICAgICAgICAgIGlmIChjb3VudCA9PSBpZCkgewogICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgaWQtdGggc2tpbiBvZiBjdXJyZW50IGFjY291bnQsIGEuay5hLCB3aGF0IHdlIG5lZWQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldmVydCgpOwogICAgfQoKICAgIC8vIEdldCBza2luIGJ5IGlkCiAgICBmdW5jdGlvbiBnZXRTa2luKHVpbnQyNTYgaWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQxMjgsIHVpbnQ2NCwgdWludDY0KSB7CiAgICAgICAgcmVxdWlyZShpZCA+IDApOwogICAgICAgIHJlcXVpcmUoaWQgPCBuZXh0U2tpbklkKTsKICAgICAgICBTa2luIHN0b3JhZ2Ugc2tpbiA9IHNraW5zW2lkXTsKICAgICAgICByZXR1cm4gKHNraW4uYXBwZWFyYW5jZSwgc2tpbi5jb29sZG93bkVuZFRpbWUsIHNraW4ubWl4aW5nV2l0aElkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd0VUSCgpIGV4dGVybmFsIG9ubHlDQU8gewogICAgICAgIGNmby50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQp9CmNvbnRyYWN0IE1peEZvcm11bGFJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gY2FsY05ld1NraW5BcHBlYXJhbmNlKHVpbnQxMjggeCwgdWludDEyOCB5KSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MTI4KTsKCiAgICAvLyBjcmVhdGUgcmFuZG9tIGFwcGVhcmFuY2UKICAgIGZ1bmN0aW9uIHJhbmRvbVNraW5BcHBlYXJhbmNlKHVpbnQyNTYgZXh0ZXJuYWxOdW0pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQxMjgpOwoKICAgIC8vIGJsZWFjaAogICAgZnVuY3Rpb24gYmxlYWNoQXBwZWFyYW5jZSh1aW50MTI4IGFwcGVhcmFuY2UsIHVpbnQxMjggYXR0cmlidXRlcykgcHVibGljIHB1cmUgcmV0dXJucyAodWludDEyOCk7Cn0KCmNvbnRyYWN0IFNraW5NaXggaXMgU2tpbkJhc2UgewoKICAgIC8vIE1peCBmb3JtdWxhCiAgICBNaXhGb3JtdWxhSW50ZXJmYWNlIHB1YmxpYyBtaXhGb3JtdWxhOwoKCiAgICAvLyBQcmUtcGFpZCBldGhlciBmb3Igc3ludGhlc2l6YXRpb24sIHdpbGwgYmUgcmV0dXJuZWQgdG8gdXNlciBpZiB0aGUgc3ludGhlc2l6YXRpb24gZmFpbGVkIChtaW51cyBnYXMpLgogICAgdWludDI1NiBwdWJsaWMgcHJlUGFpZEZlZSA9IDE1MDAwMCAqIDUwMDAwMDAwMDA7IC8vICgxNXcgZ2FzICogNSBnd2VpKQoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgTWl4U3RhcnQoYWRkcmVzcyBhY2NvdW50LCB1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCk7CiAgICBldmVudCBBdXRvTWl4KGFkZHJlc3MgYWNjb3VudCwgdWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQsIHVpbnQ2NCBjb29sZG93bkVuZFRpbWUpOwogICAgZXZlbnQgTWl4U3VjY2VzcyhhZGRyZXNzIGFjY291bnQsIHVpbnQyNTYgc2tpbklkLCB1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCk7CgogICAgLy8gU2V0IG1peCBmb3JtdWxhIGNvbnRyYWN0IGFkZHJlc3MgCiAgICBmdW5jdGlvbiBzZXRNaXhGb3JtdWxhQWRkcmVzcyhhZGRyZXNzIG1peEZvcm11bGFBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBtaXhGb3JtdWxhID0gTWl4Rm9ybXVsYUludGVyZmFjZShtaXhGb3JtdWxhQWRkcmVzcyk7CiAgICB9CgogICAgLy8gc2V0UHJlUGFpZEZlZTogc2V0IGFkdmFuY2UgYW1vdW50LCBvbmx5IG93bmVyIGNhbiBjYWxsIHRoaXMKICAgIGZ1bmN0aW9uIHNldFByZVBhaWRGZWUodWludDI1NiBuZXdQcmVQYWlkRmVlKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBwcmVQYWlkRmVlID0gbmV3UHJlUGFpZEZlZTsKICAgIH0KCiAgICAvLyBfaXNDb29sZG93blJlYWR5OiBjaGVjayB3aGV0aGVyIGNvb2xkb3duIHBlcmlvZCBoYXMgYmVlbiBwYXNzZWQKICAgIGZ1bmN0aW9uIF9pc0Nvb2xkb3duUmVhZHkodWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChza2luc1tza2luQUlkXS5jb29sZG93bkVuZFRpbWUgPD0gdWludDY0KG5vdykpICYmIChza2luc1tza2luQklkXS5jb29sZG93bkVuZFRpbWUgPD0gdWludDY0KG5vdykpOwogICAgfQoKICAgIC8vIF9pc05vdE1peGluZzogY2hlY2sgd2hldGhlciB0d28gc2tpbnMgYXJlIGluIGFub3RoZXIgbWl4aW5nIHByb2Nlc3MKICAgIGZ1bmN0aW9uIF9pc05vdE1peGluZyh1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKHNraW5zW3NraW5BSWRdLm1peGluZ1dpdGhJZCA9PSAwKSAmJiAoc2tpbnNbc2tpbkJJZF0ubWl4aW5nV2l0aElkID09IDApOwogICAgfQoKICAgIC8vIF9zZXRDb29sZG93blRpbWU6IHNldCBuZXcgY29vbGRvd24gdGltZQogICAgZnVuY3Rpb24gX3NldENvb2xkb3duRW5kVGltZSh1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCkgcHJpdmF0ZSB7CiAgICAgICAgdWludDI1NiBlbmQgPSBub3cgKyA1IG1pbnV0ZXM7CiAgICAgICAgLy8gdWludDI1NiBlbmQgPSBub3c7CiAgICAgICAgc2tpbnNbc2tpbkFJZF0uY29vbGRvd25FbmRUaW1lID0gdWludDY0KGVuZCk7CiAgICAgICAgc2tpbnNbc2tpbkJJZF0uY29vbGRvd25FbmRUaW1lID0gdWludDY0KGVuZCk7CiAgICB9CgogICAgLy8gX2lzVmFsaWRTa2luOiB3aGV0aGVyIGFuIGFjY291bnQgY2FuIG1peCB1c2luZyB0aGVzZSBza2lucwogICAgLy8gTWFrZSBzdXJlIHR3byB0aGluZ3M6CiAgICAvLyAxLiB0aGVzZSB0d28gc2tpbnMgZG8gZXhpc3QKICAgIC8vIDIuIHRoaXMgYWNjb3VudCBvd25zIHRoZXNlIHNraW5zCiAgICBmdW5jdGlvbiBfaXNWYWxpZFNraW4oYWRkcmVzcyBhY2NvdW50LCB1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBNYWtlIHN1cmUgdGhvc2UgdHdvIHNraW5zIGJlbG9uZ3MgdG8gdGhpcyBhY2NvdW50CiAgICAgICAgaWYgKHNraW5BSWQgPT0gc2tpbkJJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgoc2tpbkFJZCA9PSAwKSB8fCAoc2tpbkJJZCA9PSAwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgoc2tpbkFJZCA+PSBuZXh0U2tpbklkKSB8fCAoc2tpbkJJZCA+PSBuZXh0U2tpbklkKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoc2tpbklkVG9Pd25lcltza2luQUlkXSA9PSBhY2NvdW50KSAmJiAoc2tpbklkVG9Pd25lcltza2luQklkXSA9PSBhY2NvdW50KTsKICAgIH0KCiAgICAvLyBfaXNOb3RPblNhbGU6IHdoZXRoZXIgYSBza2luIGlzIG5vdCBvbiBzYWxlCiAgICBmdW5jdGlvbiBfaXNOb3RPblNhbGUodWludDI1NiBza2luSWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChpc09uU2FsZVtza2luSWRdID09IGZhbHNlKTsKICAgIH0KCiAgICAvLyBtaXggIAogICAgZnVuY3Rpb24gbWl4KHVpbnQyNTYgc2tpbkFJZCwgdWludDI1NiBza2luQklkKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CgogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgc2tpbnMgYXJlIHZhbGlkCiAgICAgICAgcmVxdWlyZShfaXNWYWxpZFNraW4obXNnLnNlbmRlciwgc2tpbkFJZCwgc2tpbkJJZCkpOwoKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHNraW5zIGFyZSBuZWl0aGVyIG9uIHNhbGUKICAgICAgICByZXF1aXJlKF9pc05vdE9uU2FsZShza2luQUlkKSAmJiBfaXNOb3RPblNhbGUoc2tpbkJJZCkpOwoKICAgICAgICAvLyBDaGVjayBjb29sZG93bgogICAgICAgIHJlcXVpcmUoX2lzQ29vbGRvd25SZWFkeShza2luQUlkLCBza2luQklkKSk7CgogICAgICAgIC8vIENoZWNrIHRoZXNlIHNraW5zIGFyZSBub3QgaW4gYW5vdGhlciBwcm9jZXNzCiAgICAgICAgcmVxdWlyZShfaXNOb3RNaXhpbmcoc2tpbkFJZCwgc2tpbkJJZCkpOwoKICAgICAgICAvLyBTZXQgbmV3IGNvb2xkb3duIHRpbWUKICAgICAgICBfc2V0Q29vbGRvd25FbmRUaW1lKHNraW5BSWQsIHNraW5CSWQpOwoKICAgICAgICAvLyBNYXJrIHNraW5zIGFzIGluIG1peGluZwogICAgICAgIHNraW5zW3NraW5BSWRdLm1peGluZ1dpdGhJZCA9IHVpbnQ2NChza2luQklkKTsKICAgICAgICBza2luc1tza2luQklkXS5taXhpbmdXaXRoSWQgPSB1aW50NjQoc2tpbkFJZCk7CgogICAgICAgIC8vIEVtaXQgTWl4U3RhcnQgZXZlbnQKICAgICAgICBNaXhTdGFydChtc2cuc2VuZGVyLCBza2luQUlkLCBza2luQklkKTsKICAgIH0KCiAgICAvLyBNaXhpbmcgYXV0bwogICAgZnVuY3Rpb24gbWl4QXV0byh1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcHJlUGFpZEZlZSk7CgogICAgICAgIG1peChza2luQUlkLCBza2luQklkKTsKCiAgICAgICAgU2tpbiBzdG9yYWdlIHNraW4gPSBza2luc1tza2luQUlkXTsKCiAgICAgICAgQXV0b01peChtc2cuc2VuZGVyLCBza2luQUlkLCBza2luQklkLCBza2luLmNvb2xkb3duRW5kVGltZSk7CiAgICB9CgogICAgLy8gR2V0IG1peGluZyByZXN1bHQsIHJldHVybiB0aGUgcmVzdWx0ZWQgc2tpbiBpZAogICAgZnVuY3Rpb24gZ2V0TWl4aW5nUmVzdWx0KHVpbnQyNTYgc2tpbkFJZCwgdWludDI1NiBza2luQklkKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gQ2hlY2sgdGhlc2UgdHdvIHNraW5zIGJlbG9uZ3MgdG8gdGhlIHNhbWUgYWNjb3VudAogICAgICAgIGFkZHJlc3MgYWNjb3VudCA9IHNraW5JZFRvT3duZXJbc2tpbkFJZF07CiAgICAgICAgcmVxdWlyZShhY2NvdW50ID09IHNraW5JZFRvT3duZXJbc2tpbkJJZF0pOwoKICAgICAgICAvLyBDaGVjayB0aGVzZSB0d28gc2tpbnMgYXJlIGluIHRoZSBzYW1lIG1peGluZyBwcm9jZXNzCiAgICAgICAgU2tpbiBzdG9yYWdlIHNraW5BID0gc2tpbnNbc2tpbkFJZF07CiAgICAgICAgU2tpbiBzdG9yYWdlIHNraW5CID0gc2tpbnNbc2tpbkJJZF07CiAgICAgICAgcmVxdWlyZShza2luQS5taXhpbmdXaXRoSWQgPT0gdWludDY0KHNraW5CSWQpKTsKICAgICAgICByZXF1aXJlKHNraW5CLm1peGluZ1dpdGhJZCA9PSB1aW50NjQoc2tpbkFJZCkpOwoKICAgICAgICAvLyBDaGVjayBjb29sZG93bgogICAgICAgIHJlcXVpcmUoX2lzQ29vbGRvd25SZWFkeShza2luQUlkLCBza2luQklkKSk7CgogICAgICAgIC8vIENyZWF0ZSBuZXcgc2tpbgogICAgICAgIHVpbnQxMjggbmV3U2tpbkFwcGVhcmFuY2UgPSBtaXhGb3JtdWxhLmNhbGNOZXdTa2luQXBwZWFyYW5jZShza2luQS5hcHBlYXJhbmNlLCBza2luQi5hcHBlYXJhbmNlKTsKICAgICAgICBTa2luIG1lbW9yeSBuZXdTa2luID0gU2tpbih7YXBwZWFyYW5jZTogbmV3U2tpbkFwcGVhcmFuY2UsIGNvb2xkb3duRW5kVGltZTogdWludDY0KG5vdyksIG1peGluZ1dpdGhJZDogMH0pOwogICAgICAgIHNraW5zW25leHRTa2luSWRdID0gbmV3U2tpbjsKICAgICAgICBza2luSWRUb093bmVyW25leHRTa2luSWRdID0gYWNjb3VudDsKICAgICAgICBpc09uU2FsZVtuZXh0U2tpbklkXSA9IGZhbHNlOwogICAgICAgIG5leHRTa2luSWQrKzsKCiAgICAgICAgLy8gQ2xlYXIgb2xkIHNraW5zCiAgICAgICAgc2tpbkEubWl4aW5nV2l0aElkID0gMDsKICAgICAgICBza2luQi5taXhpbmdXaXRoSWQgPSAwOwoKICAgICAgICAvLyBJbiBvcmRlciB0byBkaXN0aW5ndWlzaCBjcmVhdGVkIHNraW5zIGluIG1pbnRpbmcgd2l0aCBkZXN0cm95ZWQgc2tpbnMKICAgICAgICAvLyBza2luSWRUb093bmVyW3NraW5BSWRdID0gb3duZXI7CiAgICAgICAgLy8gc2tpbklkVG9Pd25lcltza2luQklkXSA9IG93bmVyOwogICAgICAgIGRlbGV0ZSBza2luSWRUb093bmVyW3NraW5BSWRdOwogICAgICAgIGRlbGV0ZSBza2luSWRUb093bmVyW3NraW5CSWRdOwogICAgICAgIC8vIHJlcXVpcmUobnVtU2tpbk9mQWNjb3VudHNbYWNjb3VudF0gPj0gMik7CiAgICAgICAgbnVtU2tpbk9mQWNjb3VudHNbYWNjb3VudF0gLT0gMTsKCiAgICAgICAgTWl4U3VjY2VzcyhhY2NvdW50LCBuZXh0U2tpbklkIC0gMSwgc2tpbkFJZCwgc2tpbkJJZCk7CiAgICB9Cn0KCmNvbnRyYWN0IFNraW5NYXJrZXQgaXMgU2tpbk1peCB7CgogICAgLy8gQ3V0IHJhdGlvIGZvciBhIHRyYW5zYWN0aW9uCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICAgIHVpbnQxMjggcHVibGljIHRyQ3V0ID0gNDAwOwoKICAgIC8vIFNhbGUgb3JkZXJzIGxpc3QgCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBkZXNpcmVkUHJpY2U7CgogICAgLy8gZXZlbnRzCiAgICBldmVudCBQdXRPblNhbGUoYWRkcmVzcyBhY2NvdW50LCB1aW50MjU2IHNraW5JZCk7CiAgICBldmVudCBXaXRoZHJhd1NhbGUoYWRkcmVzcyBhY2NvdW50LCB1aW50MjU2IHNraW5JZCk7CiAgICBldmVudCBCdXlJbk1hcmtldChhZGRyZXNzIGJ1eWVyLCB1aW50MjU2IHNraW5JZCk7CgogICAgLy8gZnVuY3Rpb25zCgogICAgLy8gUHV0IGFzc2V0IG9uIHNhbGUKICAgIGZ1bmN0aW9uIHB1dE9uU2FsZSh1aW50MjU2IHNraW5JZCwgdWludDI1NiBwcmljZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIE9ubHkgb3duZXIgb2Ygc2tpbiBwYXNzCiAgICAgICAgcmVxdWlyZShza2luSWRUb093bmVyW3NraW5JZF0gPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgc2tpbiBpcyBtaXhpbmcgCiAgICAgICAgcmVxdWlyZShza2luc1tza2luSWRdLm1peGluZ1dpdGhJZCA9PSAwKTsKCiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBza2luIGlzIGFscmVhZHkgb24gc2FsZQogICAgICAgIHJlcXVpcmUoaXNPblNhbGVbc2tpbklkXSA9PSBmYWxzZSk7CgogICAgICAgIHJlcXVpcmUocHJpY2UgPiAwKTsgCgogICAgICAgIC8vIFB1dCBvbiBzYWxlCiAgICAgICAgZGVzaXJlZFByaWNlW3NraW5JZF0gPSBwcmljZTsKICAgICAgICBpc09uU2FsZVtza2luSWRdID0gdHJ1ZTsKCiAgICAgICAgLy8gRW1pdCB0aGUgQXBwcm92YWwgZXZlbnQKICAgICAgICBQdXRPblNhbGUobXNnLnNlbmRlciwgc2tpbklkKTsKICAgIH0KICAKICAgIC8vIFdpdGhkcmF3IGFuIHNhbGUgb3JkZXIKICAgIGZ1bmN0aW9uIHdpdGhkcmF3U2FsZSh1aW50MjU2IHNraW5JZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGlzIHNraW4gaXMgb24gc2FsZQogICAgICAgIHJlcXVpcmUoaXNPblNhbGVbc2tpbklkXSA9PSB0cnVlKTsKICAgICAgICAKICAgICAgICAvLyBDYW4gb25seSB3aXRoZHJhdyBzZWxmJ3Mgc2FsZQogICAgICAgIHJlcXVpcmUoc2tpbklkVG9Pd25lcltza2luSWRdID09IG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBXaXRoZHJhdwogICAgICAgIGlzT25TYWxlW3NraW5JZF0gPSBmYWxzZTsKICAgICAgICBkZXNpcmVkUHJpY2Vbc2tpbklkXSA9IDA7CgogICAgICAgIC8vIEVtaXQgdGhlIGNhbmNlbCBldmVudAogICAgICAgIFdpdGhkcmF3U2FsZShtc2cuc2VuZGVyLCBza2luSWQpOwogICAgfQogCiAgICAvLyBCdXkgc2tpbiBpbiBtYXJrZXQKICAgIGZ1bmN0aW9uIGJ1eUluTWFya2V0KHVpbnQyNTYgc2tpbklkKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhpcyBza2luIGlzIG9uIHNhbGUKICAgICAgICByZXF1aXJlKGlzT25TYWxlW3NraW5JZF0gPT0gdHJ1ZSk7CgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gc2tpbklkVG9Pd25lcltza2luSWRdOwoKICAgICAgICAvLyBDaGVjayB0aGUgc2VuZGVyIGlzbid0IHRoZSBzZWxsZXIKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gc2VsbGVyKTsKCiAgICAgICAgdWludDI1NiBfcHJpY2UgPSBkZXNpcmVkUHJpY2Vbc2tpbklkXTsKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHBheSB2YWx1ZSBpcyBlbm91Z2gKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBfcHJpY2UpOwoKICAgICAgICAvLyBDdXQgYW5kIHRoZW4gc2VuZCB0aGUgcHJvY2VlZHMgdG8gc2VsbGVyCiAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IF9wcmljZSAtIF9jb21wdXRlQ3V0KF9wcmljZSk7CgogICAgICAgIHNlbGxlci50cmFuc2ZlcihzZWxsZXJQcm9jZWVkcyk7CgogICAgICAgIC8vIFRyYW5zZmVyIHNraW4gZnJvbSBzZWxsZXIgdG8gYnV5ZXIKICAgICAgICBudW1Ta2luT2ZBY2NvdW50c1tzZWxsZXJdIC09IDE7CiAgICAgICAgc2tpbklkVG9Pd25lcltza2luSWRdID0gbXNnLnNlbmRlcjsKICAgICAgICBudW1Ta2luT2ZBY2NvdW50c1ttc2cuc2VuZGVyXSArPSAxOwogICAgICAgIGlzT25TYWxlW3NraW5JZF0gPSBmYWxzZTsKICAgICAgICBkZXNpcmVkUHJpY2Vbc2tpbklkXSA9IDA7CgogICAgICAgIC8vIEVtaXQgdGhlIGJ1eSBldmVudAogICAgICAgIEJ1eUluTWFya2V0KG1zZy5zZW5kZXIsIHNraW5JZCk7CiAgICB9CgogICAgLy8gQ29tcHV0ZSB0aGUgbWFya2V0Q3V0CiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1dCh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF9wcmljZSAqIHRyQ3V0IC8gMTAwMDA7CiAgICB9Cn0KCmNvbnRyYWN0IFNraW5NaW50aW5nIGlzIFNraW5NYXJrZXQgewoKICAgIC8vIExpbWl0cyB0aGUgbnVtYmVyIG9mIHNraW5zIHRoZSBjb250cmFjdCBvd25lciBjYW4gZXZlciBjcmVhdGUuCiAgICB1aW50MjU2IHB1YmxpYyBza2luQ3JlYXRlZExpbWl0ID0gNTAwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBza2luQ3JlYXRlZE51bTsKCiAgICAvLyBUaGUgc3VtbW9uIG51bWJlcnMgb2YgZWFjaCBhY2NvdXRzOiB3aWxsIGJlIGNsZWFyZWQgZXZlcnkgZGF5CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhY2NvdXRUb1N1bW1vbk51bTsKCiAgICAvLyBQYXkgbGV2ZWwgb2YgZWFjaCBhY2NvdXRzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhY2NvdXRUb1BheUxldmVsOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYWNjb3VudHNMYXN0Q2xlYXJUaW1lOwoKICAgIHVpbnQyNTYgcHVibGljIGxldmVsQ2xlYXJUaW1lID0gbm93OwoKICAgIC8vIHByaWNlCiAgICB1aW50MjU2IHB1YmxpYyBiYXNlU3VtbW9uUHJpY2UgPSAxIGZpbm5leTsKICAgIHVpbnQyNTYgcHVibGljIGJsZWFjaFByaWNlID0gMzAwIGZpbm5leTsgIC8vIGRvIG5vdCBjYWxsIHRoaXMKCiAgICAvLyBQYXkgbGV2ZWwKICAgIHVpbnQyNTZbNV0gcHVibGljIGxldmVsU3BsaXRzID0gWzEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA1MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIwMF07CiAgICAKICAgIHVpbnQyNTZbNl0gcHVibGljIHBheU11bHRpcGxlID0gWzEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMzAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA0MF07CgoKICAgIC8vIGV2ZW50cwogICAgZXZlbnQgQ3JlYXRlTmV3U2tpbih1aW50MjU2IHNraW5JZCwgYWRkcmVzcyBhY2NvdW50KTsKICAgIGV2ZW50IEJsZWFjaCh1aW50MjU2IHNraW5JZCwgdWludDEyOCBuZXdBcHBlYXJhbmNlKTsKCiAgICAvLyBmdW5jdGlvbnMKCiAgICAvLyBTZXQgcHJpY2UgCiAgICBmdW5jdGlvbiBzZXRCYXNlU3VtbW9uUHJpY2UodWludDI1NiBuZXdQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYmFzZVN1bW1vblByaWNlID0gbmV3UHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QmxlYWNoUHJpY2UodWludDI1NiBuZXdQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYmxlYWNoUHJpY2UgPSBuZXdQcmljZTsKICAgIH0KCiAgICAvLyBDcmVhdGUgYmFzZSBza2luIGZvciBzZWxsLiBPbmx5IG93bmVyIGNhbiBjcmVhdGUKICAgIGZ1bmN0aW9uIGNyZWF0ZVNraW4odWludDEyOCBzcGVjaWZpZWRBcHBlYXJhbmNlLCB1aW50MjU2IHNhbGVQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgcmVxdWlyZShza2luQ3JlYXRlZE51bSA8IHNraW5DcmVhdGVkTGltaXQpOwoKICAgICAgICAvLyBDcmVhdGUgc3BlY2lmaWVkIHNraW4KICAgICAgICAvLyB1aW50MTI4IHJhbmRvbUFwcGVhcmFuY2UgPSBtaXhGb3JtdWxhLnJhbmRvbVNraW5BcHBlYXJhbmNlKCk7CiAgICAgICAgU2tpbiBtZW1vcnkgbmV3U2tpbiA9IFNraW4oe2FwcGVhcmFuY2U6IHNwZWNpZmllZEFwcGVhcmFuY2UsIGNvb2xkb3duRW5kVGltZTogdWludDY0KG5vdyksIG1peGluZ1dpdGhJZDogMH0pOwogICAgICAgIHNraW5zW25leHRTa2luSWRdID0gbmV3U2tpbjsKICAgICAgICBza2luSWRUb093bmVyW25leHRTa2luSWRdID0gY29vOwogICAgICAgIGlzT25TYWxlW25leHRTa2luSWRdID0gZmFsc2U7CgogICAgICAgIC8vIEVtaXQgdGhlIGNyZWF0ZSBldmVudAogICAgICAgIENyZWF0ZU5ld1NraW4obmV4dFNraW5JZCwgY29vKTsKCiAgICAgICAgLy8gUHV0IHRoaXMgc2tpbiBvbiBzYWxlCiAgICAgICAgcHV0T25TYWxlKG5leHRTa2luSWQsIHNhbGVQcmljZSk7CgogICAgICAgIG5leHRTa2luSWQrKzsKICAgICAgICBudW1Ta2luT2ZBY2NvdW50c1tjb29dICs9IDE7ICAgCiAgICAgICAgc2tpbkNyZWF0ZWROdW0gKz0gMTsKICAgIH0KCiAgICAvLyBEb25hdGUgYSBza2luIHRvIHBsYXllci4gT25seSBDT08gY2FuIG9wZXJhdGUKICAgIGZ1bmN0aW9uIGRvbmF0ZVNraW4odWludDEyOCBzcGVjaWZpZWRBcHBlYXJhbmNlLCBhZGRyZXNzIGRvbmVlKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBTa2luIG1lbW9yeSBuZXdTa2luID0gU2tpbih7YXBwZWFyYW5jZTogc3BlY2lmaWVkQXBwZWFyYW5jZSwgY29vbGRvd25FbmRUaW1lOiB1aW50NjQobm93KSwgbWl4aW5nV2l0aElkOiAwfSk7CiAgICAgICAgc2tpbnNbbmV4dFNraW5JZF0gPSBuZXdTa2luOwogICAgICAgIHNraW5JZFRvT3duZXJbbmV4dFNraW5JZF0gPSBkb25lZTsKICAgICAgICBpc09uU2FsZVtuZXh0U2tpbklkXSA9IGZhbHNlOwoKICAgICAgICAvLyBFbWl0IHRoZSBjcmVhdGUgZXZlbnQKICAgICAgICBDcmVhdGVOZXdTa2luKG5leHRTa2luSWQsIGRvbmVlKTsKCiAgICAgICAgbmV4dFNraW5JZCsrOwogICAgICAgIG51bVNraW5PZkFjY291bnRzW2RvbmVlXSArPSAxOyAgIAogICAgICAgIHNraW5DcmVhdGVkTnVtICs9IDE7CiAgICB9CgogICAgLy8gU3VtbW9uCiAgICBmdW5jdGlvbiBzdW1tb24oKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIENsZWFyIGRhaWx5IHN1bW1vbiBudW1iZXJzCiAgICAgICAgaWYgKGFjY291bnRzTGFzdENsZWFyVGltZVttc2cuc2VuZGVyXSA9PSB1aW50MjU2KDApKSB7CiAgICAgICAgICAgIC8vIFRoaXMgYWNjb3VudCdzIGZpcnN0IHRpbWUgdG8gc3VtbW9uLCB3ZSBkbyBub3QgbmVlZCB0byBjbGVhciBzdW1tb24gbnVtYmVycwogICAgICAgICAgICBhY2NvdW50c0xhc3RDbGVhclRpbWVbbXNnLnNlbmRlcl0gPSBub3c7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGFjY291bnRzTGFzdENsZWFyVGltZVttc2cuc2VuZGVyXSA8IGxldmVsQ2xlYXJUaW1lICYmIG5vdyA+IGxldmVsQ2xlYXJUaW1lKSB7CiAgICAgICAgICAgICAgICBhY2NvdXRUb1N1bW1vbk51bVttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgICAgICAgICBhY2NvdXRUb1BheUxldmVsW21zZy5zZW5kZXJdID0gMDsKICAgICAgICAgICAgICAgIGFjY291bnRzTGFzdENsZWFyVGltZVttc2cuc2VuZGVyXSA9IG5vdzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBwYXlMZXZlbCA9IGFjY291dFRvUGF5TGV2ZWxbbXNnLnNlbmRlcl07CiAgICAgICAgdWludDI1NiBwcmljZSA9IHBheU11bHRpcGxlW3BheUxldmVsXSAqIGJhc2VTdW1tb25QcmljZTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBwcmljZSk7CgogICAgICAgIC8vIENyZWF0ZSByYW5kb20gc2tpbgogICAgICAgIHVpbnQxMjggcmFuZG9tQXBwZWFyYW5jZSA9IG1peEZvcm11bGEucmFuZG9tU2tpbkFwcGVhcmFuY2UobmV4dFNraW5JZCk7CiAgICAgICAgLy8gdWludDEyOCByYW5kb21BcHBlYXJhbmNlID0gMDsKICAgICAgICBTa2luIG1lbW9yeSBuZXdTa2luID0gU2tpbih7YXBwZWFyYW5jZTogcmFuZG9tQXBwZWFyYW5jZSwgY29vbGRvd25FbmRUaW1lOiB1aW50NjQobm93KSwgbWl4aW5nV2l0aElkOiAwfSk7CiAgICAgICAgc2tpbnNbbmV4dFNraW5JZF0gPSBuZXdTa2luOwogICAgICAgIHNraW5JZFRvT3duZXJbbmV4dFNraW5JZF0gPSBtc2cuc2VuZGVyOwogICAgICAgIGlzT25TYWxlW25leHRTa2luSWRdID0gZmFsc2U7CgogICAgICAgIC8vIEVtaXQgdGhlIGNyZWF0ZSBldmVudAogICAgICAgIENyZWF0ZU5ld1NraW4obmV4dFNraW5JZCwgbXNnLnNlbmRlcik7CgogICAgICAgIG5leHRTa2luSWQrKzsKICAgICAgICBudW1Ta2luT2ZBY2NvdW50c1ttc2cuc2VuZGVyXSArPSAxOwogICAgICAgIAogICAgICAgIGFjY291dFRvU3VtbW9uTnVtW21zZy5zZW5kZXJdICs9IDE7CiAgICAgICAgCiAgICAgICAgLy8gSGFuZGxlIHRoZSBwYXlsZXZlbCAgICAgICAgCiAgICAgICAgaWYgKHBheUxldmVsIDwgNSkgewogICAgICAgICAgICBpZiAoYWNjb3V0VG9TdW1tb25OdW1bbXNnLnNlbmRlcl0gPj0gbGV2ZWxTcGxpdHNbcGF5TGV2ZWxdKSB7CiAgICAgICAgICAgICAgICBhY2NvdXRUb1BheUxldmVsW21zZy5zZW5kZXJdID0gcGF5TGV2ZWwgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIEJsZWFjaCBzb21lIGF0dHJpYnV0ZXMKICAgIGZ1bmN0aW9uIGJsZWFjaCh1aW50MTI4IHNraW5JZCwgdWludDEyOCBhdHRyaWJ1dGVzKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgbXNnLnNlbmRlciBpcyBvd25lciBvZiB0aGUgc2tpbiAKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2tpbklkVG9Pd25lcltza2luSWRdKTsKCiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGlzIHNraW4gaXMgb24gc2FsZSAKICAgICAgICByZXF1aXJlKGlzT25TYWxlW3NraW5JZF0gPT0gZmFsc2UpOwoKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHRoZXJlIGlzIGVub3VnaCBtb25leQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGJsZWFjaFByaWNlKTsKCiAgICAgICAgU2tpbiBzdG9yYWdlIG9yaWdpblNraW4gPSBza2luc1tza2luSWRdOwogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhpcyBza2luIGlzIGluIG1peGluZyAKICAgICAgICByZXF1aXJlKG9yaWdpblNraW4ubWl4aW5nV2l0aElkID09IDApOwoKICAgICAgICB1aW50MTI4IG5ld0FwcGVhcmFuY2UgPSBtaXhGb3JtdWxhLmJsZWFjaEFwcGVhcmFuY2Uob3JpZ2luU2tpbi5hcHBlYXJhbmNlLCBhdHRyaWJ1dGVzKTsKICAgICAgICBvcmlnaW5Ta2luLmFwcGVhcmFuY2UgPSBuZXdBcHBlYXJhbmNlOwoKICAgICAgICAvLyBFbWl0IGJsZWFjaCBldmVudAogICAgICAgIEJsZWFjaChza2luSWQsIG5ld0FwcGVhcmFuY2UpOwogICAgfQoKICAgIC8vIE91ciBkYWVtb24gd2lsbCBjbGVhciBkYWlseSBzdW1tb24gbnVtYmVycwogICAgZnVuY3Rpb24gY2xlYXJTdW1tb25OdW0oKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICB1aW50MjU2IG5leHREYXkgPSBsZXZlbENsZWFyVGltZSArIDEgZGF5czsKICAgICAgICBpZiAobm93ID4gbmV4dERheSkgewogICAgICAgICAgICBsZXZlbENsZWFyVGltZSA9IG5leHREYXk7CiAgICAgICAgfQogICAgfQp9'.
	

]
