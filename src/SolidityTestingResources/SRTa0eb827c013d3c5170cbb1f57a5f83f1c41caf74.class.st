Class {
	#name : #SRTa0eb827c013d3c5170cbb1f57a5f83f1c41caf74,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa0eb827c013d3c5170cbb1f57a5f83f1c41caf74 >> base64 [
	^ 'LyoqCiAqIEZsaWdodERlbGF5IHdpdGggT3JhY2xpemVkIFVuZGVyd3JpdGluZyBhbmQgUGF5b3V0CiAqCiAqIEBkZXNjcmlwdGlvbiBDb250cmFjdCBpbnRlcmZhY2UKICogQGNvcHlyaWdodCAoYykgMjAxNyBldGhlcmlzYyBHbWJICiAqIEBhdXRob3IgQ2hyaXN0b3BoIE11c3NlbmJyb2NrLCBTdGVwaGFuIEthcnBpc2NoZWsKICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCgpjb250cmFjdCBGbGlnaHREZWxheUNvbnRyb2xsZXJJbnRlcmZhY2UgewoKICAgIGZ1bmN0aW9uIGlzT3duZXIoYWRkcmVzcyBfYWRkcikgcmV0dXJucyAoYm9vbCBfaXNPd25lcik7CgogICAgZnVuY3Rpb24gc2VsZlJlZ2lzdGVyKGJ5dGVzMzIgX2lkKSByZXR1cm5zIChib29sIHJlc3VsdCk7CgogICAgZnVuY3Rpb24gZ2V0Q29udHJhY3QoYnl0ZXMzMiBfaWQpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9Cgpjb250cmFjdCBGbGlnaHREZWxheURhdGFiYXNlTW9kZWwgewoKICAgIC8vIExlZGdlciBhY2NvdW50cy4KICAgIGVudW0gQWNjIHsKICAgICAgICBQcmVtaXVtLCAgICAgIC8vIDAKICAgICAgICBSaXNrRnVuZCwgICAgIC8vIDEKICAgICAgICBQYXlvdXQsICAgICAgIC8vIDIKICAgICAgICBCYWxhbmNlLCAgICAgIC8vIDMKICAgICAgICBSZXdhcmQsICAgICAgIC8vIDQKICAgICAgICBPcmFjbGl6ZUNvc3RzIC8vIDUKICAgIH0KCiAgICAvLyBwb2xpY3kgU3RhdHVzIENvZGVzIGFuZCBtZWFuaW5nOgogICAgLy8KICAgIC8vIDAwID0gQXBwbGllZDoJICB0aGUgY3VzdG9tZXIgaGFzIHBheWVkIGEgcHJlbWl1bSwgYnV0IHRoZSBvcmFjbGUgaGFzCiAgICAvLwkJCQkJICAgICAgICBub3QgeWV0IGNoZWNrZWQgYW5kIGNvbmZpcm1lZC4KICAgIC8vCQkJCQkgICAgICAgIFRoZSBjdXN0b21lciBjYW4gc3RpbGwgcmV2b2tlIHRoZSBwb2xpY3kuCiAgICAvLyAwMSA9IEFjY2VwdGVkOgkgIHRoZSBvcmFjbGUgaGFzIGNoZWNrZWQgYW5kIGNvbmZpcm1lZC4KICAgIC8vCQkJCQkgICAgICAgIFRoZSBjdXN0b21lciBjYW4gc3RpbGwgcmV2b2tlIHRoZSBwb2xpY3kuCiAgICAvLyAwMiA9IFJldm9rZWQ6CSAgVGhlIGN1c3RvbWVyIGhhcyByZXZva2VkIHRoZSBwb2xpY3kuCiAgICAvLwkJCQkJICAgICAgICBUaGUgcHJlbWl1bSBtaW51cyBjYW5jZWxsYXRpb24gZmVlIGlzIHBheWVkIGJhY2sgdG8gdGhlCiAgICAvLwkJCQkJICAgICAgICBjdXN0b21lciBieSB0aGUgb3JhY2xlLgogICAgLy8gMDMgPSBQYWlkT3V0OgkgIFRoZSBmbGlnaHQgaGFzIGVuZGVkIHdpdGggZGVsYXkuCiAgICAvLwkJCQkJICAgICAgICBUaGUgb3JhY2xlIGhhcyBjaGVja2VkIGFuZCBwYXllZCBvdXQuCiAgICAvLyAwNCA9IEV4cGlyZWQ6CSAgVGhlIGZsaWdodCBoYXMgZW5kZXQgd2l0aCA8MTVtaW4uIGRlbGF5LgogICAgLy8JCQkJCSAgICAgICAgTm8gcGF5b3V0LgogICAgLy8gMDUgPSBEZWNsaW5lZDoJICBUaGUgYXBwbGljYXRpb24gd2FzIGludmFsaWQuCiAgICAvLwkJCQkJICAgICAgICBUaGUgcHJlbWl1bSBtaW51cyBjYW5jZWxsYXRpb24gZmVlIGlzIHBheWVkIGJhY2sgdG8gdGhlCiAgICAvLwkJCQkJICAgICAgICBjdXN0b21lciBieSB0aGUgb3JhY2xlLgogICAgLy8gMDYgPSBTZW5kRmFpbGVkOglEdXJpbmcgUmV2b2tlLCBEZWNsaW5lIG9yIFBheW91dCwgc2VuZGluZyBldGhlciBmYWlsZWQKICAgIC8vCQkJCQkgICAgICAgIGZvciB1bmtub3duIHJlYXNvbnMuCiAgICAvLwkJCQkJICAgICAgICBUaGUgZnVuZHMgcmVtYWluIGluIHRoZSBjb250cmFjdHMgUmlza0Z1bmQuCgoKICAgIC8vICAgICAgICAgICAgICAgICAgIDAwICAgICAgIDAxICAgICAgICAwMiAgICAgICAwMyAgICAgICAgMDQgICAgICAwNSAgICAgICAgICAgMDYKICAgIGVudW0gcG9saWN5U3RhdGUgeyBBcHBsaWVkLCBBY2NlcHRlZCwgUmV2b2tlZCwgUGFpZE91dCwgRXhwaXJlZCwgRGVjbGluZWQsIFNlbmRGYWlsZWQgfQoKICAgIC8vIG9yYWNsaXplIGNhbGxiYWNrIHR5cGVzOgogICAgZW51bSBvcmFjbGl6ZVN0YXRlIHsgRm9yVW5kZXJ3cml0aW5nLCBGb3JQYXlvdXQgfQoKICAgIC8vICAgICAgICAgICAgICAgMDAgICAwMSAgIDAyICAgMDMKICAgIGVudW0gQ3VycmVuY3kgeyBFVEgsIEVVUiwgVVNELCBHQlAgfQoKICAgIC8vIHRoZSBwb2xpY3kgc3RydWN0dXJlOiB0aGlzIHN0cnVjdHVyZSBrZWVwcyB0cmFjayBvZiB0aGUgaW5kaXZpZHVhbCBwYXJhbWV0ZXJzIG9mIGEgcG9saWN5LgogICAgLy8gdHlwaWNhbGx5IGN1c3RvbWVyIGFkZHJlc3MsIHByZW1pdW0gYW5kIHNvbWUgc3RhdHVzIGluZm9ybWF0aW9uLgogICAgc3RydWN0IFBvbGljeSB7CiAgICAgICAgLy8gMCAtIHRoZSBjdXN0b21lcgogICAgICAgIGFkZHJlc3MgY3VzdG9tZXI7CgogICAgICAgIC8vIDEgLSBwcmVtaXVtCiAgICAgICAgdWludCBwcmVtaXVtOwogICAgICAgIC8vIHJpc2sgc3BlY2lmaWMgcGFyYW1ldGVyczoKICAgICAgICAvLyAyIC0gcG9pbnRlciB0byB0aGUgcmlzayBpbiB0aGUgcmlza3MgbWFwcGluZwogICAgICAgIGJ5dGVzMzIgcmlza0lkOwogICAgICAgIC8vIGN1c3RvbSBwYXlvdXQgcGF0dGVybgogICAgICAgIC8vIGluIGZ1dHVyZSB2ZXJzaW9ucywgY3VzdG9tZXIgd2lsbCBiZSBhYmxlIHRvIHRhbXBlciB3aXRoIHRoaXMgYXJyYXkuCiAgICAgICAgLy8gdG8ga2VlcCB0aGluZ3Mgc2ltcGxlLCB3ZSBoYXZlIGRlY2lkZWQgdG8gaGFyZC1jb2RlIHRoZSBhcnJheSBmb3IgYWxsIHBvbGljaWVzLgogICAgICAgIC8vIHVpbnQ4WzVdIHBhdHRlcm47CiAgICAgICAgLy8gMyAtIHByb2JhYmlsaXR5IHdlaWdodC4gdGhpcyBpcyB0aGUgY2VudHJhbCBwYXJhbWV0ZXIKICAgICAgICB1aW50IHdlaWdodDsKICAgICAgICAvLyA0IC0gY2FsY3VsYXRlZCBQYXlvdXQKICAgICAgICB1aW50IGNhbGN1bGF0ZWRQYXlvdXQ7CiAgICAgICAgLy8gNSAtIGFjdHVhbCBQYXlvdXQKICAgICAgICB1aW50IGFjdHVhbFBheW91dDsKCiAgICAgICAgLy8gc3RhdHVzIGZpZWxkczoKICAgICAgICAvLyA2IC0gdGhlIHN0YXRlIG9mIHRoZSBwb2xpY3kKICAgICAgICBwb2xpY3lTdGF0ZSBzdGF0ZTsKICAgICAgICAvLyA3IC0gdGltZSBvZiBsYXN0IHN0YXRlIGNoYW5nZQogICAgICAgIHVpbnQgc3RhdGVUaW1lOwogICAgICAgIC8vIDggLSBzdGF0ZSBjaGFuZ2UgbWVzc2FnZS9yZWFzb24KICAgICAgICBieXRlczMyIHN0YXRlTWVzc2FnZTsKICAgICAgICAvLyA5IC0gVExTTm90YXJ5IFByb29mCiAgICAgICAgYnl0ZXMgcHJvb2Y7CiAgICAgICAgLy8gMTAgLSBDdXJyZW5jeQogICAgICAgIEN1cnJlbmN5IGN1cnJlbmN5OwogICAgICAgIC8vIDEwIC0gRXh0ZXJuYWwgY3VzdG9tZXIgaWQKICAgICAgICBieXRlczMyIGN1c3RvbWVyRXh0ZXJuYWxJZDsKICAgIH0KCiAgICAvLyB0aGUgcmlzayBzdHJ1Y3R1cmU7IHRoaXMgc3RydWN0dXJlIGtlZXBzIHRyYWNrIG9mIHRoZSByaXNrLQogICAgLy8gc3BlY2lmaWMgcGFyYW1ldGVycy4KICAgIC8vIHNldmVyYWwgcG9saWNpZXMgY2FuIHNoYXJlIHRoZSBzYW1lIHJpc2sgc3RydWN0dXJlICh0eXBpY2FsbHkKICAgIC8vIHNvbWUgcGVvcGxlIGZseWluZyB3aXRoIHRoZSBzYW1lIHBsYW5lKQogICAgc3RydWN0IFJpc2sgewogICAgICAgIC8vIDAgLSBBaXJsaW5lIENvZGUgKyBGbGlnaHROdW1iZXIKICAgICAgICBieXRlczMyIGNhcnJpZXJGbGlnaHROdW1iZXI7CiAgICAgICAgLy8gMSAtIHNjaGVkdWxlZCBkZXBhcnR1cmUgYW5kIGFycml2YWwgdGltZSBpbiB0aGUgZm9ybWF0IC9kZXAvWVlZWS9NTS9ERAogICAgICAgIGJ5dGVzMzIgZGVwYXJ0dXJlWWVhck1vbnRoRGF5OwogICAgICAgIC8vIDIgLSB0aGUgaW5pdGFsIGFycml2YWwgdGltZQogICAgICAgIHVpbnQgYXJyaXZhbFRpbWU7CiAgICAgICAgLy8gMyAtIHRoZSBmaW5hbCBkZWxheSBpbiBtaW51dGVzCiAgICAgICAgdWludCBkZWxheUluTWludXRlczsKICAgICAgICAvLyA0IC0gdGhlIGRldGVybWluZWQgZGVsYXkgY2F0ZWdvcnkgKDAtNSkKICAgICAgICB1aW50OCBkZWxheTsKICAgICAgICAvLyA1IC0gd2UgbGltaXQgdGhlIGN1bXVsYXRlZCB3ZWlnaHRlZCBwcmVtaXVtIHRvIGF2b2lkIGNsdXN0ZXIgcmlza3MKICAgICAgICB1aW50IGN1bXVsYXRlZFdlaWdodGVkUHJlbWl1bTsKICAgICAgICAvLyA2IC0gbWF4IGN1bXVsYXRlZCBQYXlvdXQgZm9yIHRoaXMgcmlzawogICAgICAgIHVpbnQgcHJlbWl1bU11bHRpcGxpZXI7CiAgICB9CgogICAgLy8gdGhlIG9yYWNsaXplIGNhbGxiYWNrIHN0cnVjdHVyZTogd2UgdXNlIHNldmVyYWwgb3JhY2xpemUgY2FsbHMuCiAgICAvLyBhbGwgb3JhY2xpemUgY2FsbHMgd2lsbCByZXN1bHQgaW4gYSBjb21tb24gY2FsbGJhY2sgdG8gX19jYWxsYmFjayguLi4pLgogICAgLy8gdG8ga2VlcCB0cmFjayBvZiB0aGUgZGlmZmVyZW50IHF1ZXJ5cyB3ZSBoYXZlIHRvIGludHJvZHVjZSB0aGlzIHN0cnVjdC4KICAgIHN0cnVjdCBPcmFjbGl6ZUNhbGxiYWNrIHsKICAgICAgICAvLyBmb3Igd2hpY2ggcG9saWN5IGhhdmUgd2UgY2FsbGVkPwogICAgICAgIHVpbnQgcG9saWN5SWQ7CiAgICAgICAgLy8gZm9yIHdoaWNoIHB1cnBvc2UgZGlkIHdlIGNhbGw/IHtGb3JVbmRlcndyaXRlIHwgRm9yUGF5b3V0fQogICAgICAgIG9yYWNsaXplU3RhdGUgb1N0YXRlOwogICAgICAgIC8vIHRpbWUKICAgICAgICB1aW50IG9yYWNsaXplVGltZTsKICAgIH0KCiAgICBzdHJ1Y3QgQ3VzdG9tZXIgewogICAgICAgIGJ5dGVzMzIgY3VzdG9tZXJFeHRlcm5hbElkOwogICAgICAgIGJvb2wgaWRlbnRpdHlDb25maXJtZWQ7CiAgICB9Cn0KCmNvbnRyYWN0IEZsaWdodERlbGF5Q29udHJvbGxlZENvbnRyYWN0IGlzIEZsaWdodERlbGF5RGF0YWJhc2VNb2RlbCB7CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKICAgIEZsaWdodERlbGF5Q29udHJvbGxlckludGVyZmFjZSBGRF9DSTsKCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb250cm9sbGVyKGFkZHJlc3MgX2NvbnRyb2xsZXIpIGludGVybmFsIHJldHVybnMgKGJvb2wgX3Jlc3VsdCkgewogICAgICAgIGNvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgICAgICBGRF9DSSA9IEZsaWdodERlbGF5Q29udHJvbGxlckludGVyZmFjZShfY29udHJvbGxlcik7CiAgICAgICAgX3Jlc3VsdCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVzdHJ1Y3QoKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgc2VsZmRlc3RydWN0KGNvbnRyb2xsZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvbnRyYWN0cygpIG9ubHlDb250cm9sbGVyIHt9CgogICAgZnVuY3Rpb24gZ2V0Q29udHJhY3QoYnl0ZXMzMiBfaWQpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpIHsKICAgICAgICBfYWRkciA9IEZEX0NJLmdldENvbnRyYWN0KF9pZCk7CiAgICB9Cn0KCgpjb250cmFjdCBGbGlnaHREZWxheUNvbnN0YW50cyB7CgogICAgLyoKICAgICogR2VuZXJhbCBldmVudHMKICAgICovCgovLyAtLT4gdGVzdC1tb2RlCi8vICAgICAgICBldmVudCBMb2dVaW50KHN0cmluZyBfbWVzc2FnZSwgdWludCBfdWludCk7Ci8vICAgICAgICBldmVudCBMb2dVaW50RXRoKHN0cmluZyBfbWVzc2FnZSwgdWludCBldGhVaW50KTsKLy8gICAgICAgIGV2ZW50IExvZ1VpbnRUaW1lKHN0cmluZyBfbWVzc2FnZSwgdWludCB0aW1lVWludCk7Ci8vICAgICAgICBldmVudCBMb2dJbnQoc3RyaW5nIF9tZXNzYWdlLCBpbnQgX2ludCk7Ci8vICAgICAgICBldmVudCBMb2dBZGRyZXNzKHN0cmluZyBfbWVzc2FnZSwgYWRkcmVzcyBfYWRkcmVzcyk7Ci8vICAgICAgICBldmVudCBMb2dCeXRlczMyKHN0cmluZyBfbWVzc2FnZSwgYnl0ZXMzMiBoZXhCeXRlczMyKTsKLy8gICAgICAgIGV2ZW50IExvZ0J5dGVzKHN0cmluZyBfbWVzc2FnZSwgYnl0ZXMgaGV4Qnl0ZXMpOwovLyAgICAgICAgZXZlbnQgTG9nQnl0ZXMzMlN0cihzdHJpbmcgX21lc3NhZ2UsIGJ5dGVzMzIgc3RyQnl0ZXMzMik7Ci8vICAgICAgICBldmVudCBMb2dTdHJpbmcoc3RyaW5nIF9tZXNzYWdlLCBzdHJpbmcgX3N0cmluZyk7Ci8vICAgICAgICBldmVudCBMb2dCb29sKHN0cmluZyBfbWVzc2FnZSwgYm9vbCBfYm9vbCk7Ci8vICAgICAgICBldmVudCBMb2coYWRkcmVzcyk7Ci8vIDwtLSB0ZXN0LW1vZGUKCiAgICBldmVudCBMb2dQb2xpY3lBcHBsaWVkKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyLAogICAgICAgIGJ5dGVzMzIgc3RyQ2FycmllckZsaWdodE51bWJlciwKICAgICAgICB1aW50IGV0aFByZW1pdW0KICAgICk7CiAgICBldmVudCBMb2dQb2xpY3lBY2NlcHRlZCgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMCwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMSwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMiwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMywKICAgICAgICB1aW50IF9zdGF0aXN0aWNzNCwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzNQogICAgKTsKICAgIGV2ZW50IExvZ1BvbGljeVBhaWRPdXQoCiAgICAgICAgdWludCBfcG9saWN5SWQsCiAgICAgICAgdWludCBldGhBbW91bnQKICAgICk7CiAgICBldmVudCBMb2dQb2xpY3lFeHBpcmVkKAogICAgICAgIHVpbnQgX3BvbGljeUlkCiAgICApOwogICAgZXZlbnQgTG9nUG9saWN5RGVjbGluZWQoCiAgICAgICAgdWludCBfcG9saWN5SWQsCiAgICAgICAgYnl0ZXMzMiBzdHJSZWFzb24KICAgICk7CiAgICBldmVudCBMb2dQb2xpY3lNYW51YWxQYXlvdXQoCiAgICAgICAgdWludCBfcG9saWN5SWQsCiAgICAgICAgYnl0ZXMzMiBzdHJSZWFzb24KICAgICk7CiAgICBldmVudCBMb2dTZW5kRnVuZHMoCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LAogICAgICAgIHVpbnQ4IF9mcm9tLAogICAgICAgIHVpbnQgZXRoQW1vdW50CiAgICApOwogICAgZXZlbnQgTG9nUmVjZWl2ZUZ1bmRzKAogICAgICAgIGFkZHJlc3MgX3NlbmRlciwKICAgICAgICB1aW50OCBfdG8sCiAgICAgICAgdWludCBldGhBbW91bnQKICAgICk7CiAgICBldmVudCBMb2dTZW5kRmFpbCgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICBieXRlczMyIHN0clJlYXNvbgogICAgKTsKICAgIGV2ZW50IExvZ09yYWNsaXplQ2FsbCgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICBieXRlczMyIGhleFF1ZXJ5SWQsCiAgICAgICAgc3RyaW5nIF9vcmFjbGl6ZVVybCwKICAgICAgICB1aW50MjU2IF9vcmFjbGl6ZVRpbWUKICAgICk7CiAgICBldmVudCBMb2dPcmFjbGl6ZUNhbGxiYWNrKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIGJ5dGVzMzIgaGV4UXVlcnlJZCwKICAgICAgICBzdHJpbmcgX3Jlc3VsdCwKICAgICAgICBieXRlcyBoZXhQcm9vZgogICAgKTsKICAgIGV2ZW50IExvZ1NldFN0YXRlKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIHVpbnQ4IF9wb2xpY3lTdGF0ZSwKICAgICAgICB1aW50IF9zdGF0ZVRpbWUsCiAgICAgICAgYnl0ZXMzMiBfc3RhdGVNZXNzYWdlCiAgICApOwogICAgZXZlbnQgTG9nRXh0ZXJuYWwoCiAgICAgICAgdWludDI1NiBfcG9saWN5SWQsCiAgICAgICAgYWRkcmVzcyBfYWRkcmVzcywKICAgICAgICBieXRlczMyIF9leHRlcm5hbElkCiAgICApOwoKICAgIC8qCiAgICAqIEdlbmVyYWwgY29uc3RhbnRzCiAgICAqLwoKICAgIC8vIG1pbmltdW0gb2JzZXJ2YXRpb25zIGZvciB2YWxpZCBwcmVkaWN0aW9uCiAgICB1aW50IGNvbnN0YW50IE1JTl9PQlNFUlZBVElPTlMgPSAxMDsKICAgIC8vIG1pbmltdW0gcHJlbWl1bSB0byBjb3ZlciBjb3N0cwogICAgdWludCBjb25zdGFudCBNSU5fUFJFTUlVTSA9IDUwIGZpbm5leTsKICAgIC8vIG1heGltdW0gcHJlbWl1bQogICAgdWludCBjb25zdGFudCBNQVhfUFJFTUlVTSA9IDEgZXRoZXI7CiAgICAvLyBtYXhpbXVtIHBheW91dAogICAgdWludCBjb25zdGFudCBNQVhfUEFZT1VUID0gMTEwMCBmaW5uZXk7CgogICAgdWludCBjb25zdGFudCBNSU5fUFJFTUlVTV9FVVIgPSAxNTAwIHdlaTsKICAgIHVpbnQgY29uc3RhbnQgTUFYX1BSRU1JVU1fRVVSID0gMjkwMDAgd2VpOwogICAgdWludCBjb25zdGFudCBNQVhfUEFZT1VUX0VVUiA9IDMwMDAwIHdlaTsKCiAgICB1aW50IGNvbnN0YW50IE1JTl9QUkVNSVVNX1VTRCA9IDE3MDAgd2VpOwogICAgdWludCBjb25zdGFudCBNQVhfUFJFTUlVTV9VU0QgPSAzNDAwMCB3ZWk7CiAgICB1aW50IGNvbnN0YW50IE1BWF9QQVlPVVRfVVNEID0gMzUwMDAgd2VpOwoKICAgIHVpbnQgY29uc3RhbnQgTUlOX1BSRU1JVU1fR0JQID0gMTMwMCB3ZWk7CiAgICB1aW50IGNvbnN0YW50IE1BWF9QUkVNSVVNX0dCUCA9IDI1MDAwIHdlaTsKICAgIHVpbnQgY29uc3RhbnQgTUFYX1BBWU9VVF9HQlAgPSAyNzAgd2VpOwoKICAgIC8vIG1heGltdW0gY3VtdWxhdGVkIHdlaWdodGVkIHByZW1pdW0gcGVyIHJpc2sKICAgIHVpbnQgY29uc3RhbnQgTUFYX0NVTVVMQVRFRF9XRUlHSFRFRF9QUkVNSVVNID0gNjAgZXRoZXI7CiAgICAvLyAxIHBlcmNlbnQgZm9yIERBTywgMSBwZXJjZW50IGZvciBtYWludGFpbmVyCiAgICB1aW50OCBjb25zdGFudCBSRVdBUkRfUEVSQ0VOVCA9IDI7CiAgICAvLyByZXNlcnZlIGZvciB0YWlsIHJpc2tzCiAgICB1aW50OCBjb25zdGFudCBSRVNFUlZFX1BFUkNFTlQgPSAxOwogICAgLy8gdGhlIHdlaWdodCBwYXR0ZXJuOyBpbiBmdXR1cmUgdmVyc2lvbnMgdGhpcyBtYXkgYmVjb21lIHBhcnQgb2YgdGhlIHBvbGljeSBzdHJ1Y3QuCiAgICAvLyBjdXJyZW50bHkgY2FuJ3QgYmUgY29uc3RhbnQgYmVjYXVzZSBvZiBjb21waWxlciByZXN0cmljdGlvbnMKICAgIC8vIFdFSUdIVF9QQVRURVJOWzBdIGlzIG5vdCB1c2VkLCBqdXN0IHRvIGJlIGNvbnNpc3RlbnQKICAgIHVpbnQ4WzZdIFdFSUdIVF9QQVRURVJOID0gWwogICAgICAgIDAsCiAgICAgICAgMTAsCiAgICAgICAgMjAsCiAgICAgICAgMzAsCiAgICAgICAgNTAsCiAgICAgICAgNTAKICAgIF07CgovLyAtLT4gcHJvZC1tb2RlCiAgICAvLyBERUZJTklUSU9OUyBGT1IgUk9QU1RFTiBBTkQgTUFJTk5FVAogICAgLy8gbWluaW11bSB0aW1lIGJlZm9yZSBkZXBhcnR1cmUgZm9yIGFwcGx5aW5nCiAgICB1aW50IGNvbnN0YW50IE1JTl9USU1FX0JFRk9SRV9ERVBBUlRVUkUJPSAyNCBob3VyczsgLy8gZm9yIHByb2R1Y3Rpb24KICAgIC8vIGNoZWNrIGZvciBkZWxheSBhZnRlciAuLiBtaW51dGVzIGFmdGVyIHNjaGVkdWxlZCBhcnJpdmFsCiAgICB1aW50IGNvbnN0YW50IENIRUNLX1BBWU9VVF9PRkZTRVQgPSAxNSBtaW51dGVzOyAvLyBmb3IgcHJvZHVjdGlvbgovLyA8LS0gcHJvZC1tb2RlCgovLyAtLT4gdGVzdC1tb2RlCi8vICAgICAgICAvLyBERUZJTklUSU9OUyBGT1IgTE9DQUwgVEVTVE5FVAovLyAgICAgICAgLy8gbWluaW11bSB0aW1lIGJlZm9yZSBkZXBhcnR1cmUgZm9yIGFwcGx5aW5nCi8vICAgICAgICB1aW50IGNvbnN0YW50IE1JTl9USU1FX0JFRk9SRV9ERVBBUlRVUkUgPSAxIHNlY29uZHM7IC8vIGZvciB0ZXN0aW5nCi8vICAgICAgICAvLyBjaGVjayBmb3IgZGVsYXkgYWZ0ZXIgLi4gbWludXRlcyBhZnRlciBzY2hlZHVsZWQgYXJyaXZhbAovLyAgICAgICAgdWludCBjb25zdGFudCBDSEVDS19QQVlPVVRfT0ZGU0VUID0gMSBzZWNvbmRzOyAvLyBmb3IgdGVzdGluZwovLyA8LS0gdGVzdC1tb2RlCgogICAgLy8gbWF4aW11bSBkdXJhdGlvbiBvZiBmbGlnaHQKICAgIHVpbnQgY29uc3RhbnQgTUFYX0ZMSUdIVF9EVVJBVElPTiA9IDIgZGF5czsKICAgIC8vIERlYWRsaW5lIGZvciBhY2NlcHRhbmNlIG9mIHBvbGljaWVzOiAzMS4xMi4yMDMwIChUZXN0bmV0KQogICAgdWludCBjb25zdGFudCBDT05UUkFDVF9ERUFEX0xJTkUgPSAxOTIyMzk2Mzk5OwoKICAgIHVpbnQgY29uc3RhbnQgTUlOX0RFUEFSVFVSRV9MSU0gPSAxNTA4MTk4NDAwOwoKICAgIHVpbnQgY29uc3RhbnQgTUFYX0RFUEFSVFVSRV9MSU0gPSAxNTA5ODQwMDAwOwoKICAgIC8vIGdhcyBDb25zdGFudHMgZm9yIG9yYWNsaXplCiAgICB1aW50IGNvbnN0YW50IE9SQUNMSVpFX0dBUyA9IDEwMDAwMDA7CgoKICAgIC8qCiAgICAqIFVSTHMgYW5kIHF1ZXJ5IHN0cmluZ3MgZm9yIG9yYWNsaXplCiAgICAqLwoKLy8gLS0+IHByb2QtbW9kZQogICAgLy8gREVGSU5JVElPTlMgRk9SIFJPUFNURU4gQU5EIE1BSU5ORVQKICAgIHN0cmluZyBjb25zdGFudCBPUkFDTElaRV9SQVRJTkdTX0JBU0VfVVJMID0KICAgICAgICAvLyByYXRpbmdzIGFwaSBpcyB2MSwgc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmZsaWdodHN0YXRzLmNvbS9hcGktZG9jcy9yYXRpbmdzL3YxCiAgICAgICAgIltVUkxdIGpzb24oaHR0cHM6Ly9hcGkuZmxpZ2h0c3RhdHMuY29tL2ZsZXgvcmF0aW5ncy9yZXN0L3YxL2pzb24vZmxpZ2h0LyI7CiAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfUkFUSU5HU19RVUVSWSA9CiAgICAgICAgIj8ke1tkZWNyeXB0XSA8IS0tUFVUIEVOQ1JZUFRFRF9RVUVSWSBIRVJFLS0+IH0pLnJhdGluZ3NbMF1bJ29ic2VydmF0aW9ucycsJ2xhdGUxNScsJ2xhdGUzMCcsJ2xhdGU0NScsJ2NhbmNlbGxlZCcsJ2RpdmVydGVkJywnYXJyaXZhbEFpcnBvcnRGc0NvZGUnXSI7CiAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfU1RBVFVTX0JBU0VfVVJMID0KICAgICAgICAvLyBmbGlnaHQgc3RhdHVzIGFwaSBpcyB2Miwgc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmZsaWdodHN0YXRzLmNvbS9hcGktZG9jcy9mbGlnaHRzdGF0dXMvdjIvZmxpZ2h0CiAgICAgICAgIltVUkxdIGpzb24oaHR0cHM6Ly9hcGkuZmxpZ2h0c3RhdHMuY29tL2ZsZXgvZmxpZ2h0c3RhdHVzL3Jlc3QvdjIvanNvbi9mbGlnaHQvc3RhdHVzLyI7CiAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfU1RBVFVTX1FVRVJZID0KICAgICAgICAvLyBwYXR0ZXJuOgogICAgICAgICI/JHtbZGVjcnlwdF0gQk85ZUIrUTVFVmVTRUdVbytMY0RITGRBeko2UlV0Y0xuZGRPTy9JSExoMHlZa3pOaG9aSU5EMjYvY3o4eXpYa3h6SmFpUzRkR0draGFBS01pSThXeGhKYzNaeFZmQitjZkhBY0djZzhLajR4LzlXTGxha3FCM0VQTVlRckRXSE9OdXlEMUc5aTBnMElWUmNPL3M3cHF3SytMS0RjeFFGWWdrTXRwY3JXQnJnQXJlNDBsTi9TfSZ1dGM9dHJ1ZSkuZmxpZ2h0U3RhdHVzZXNbMF1bJ3N0YXR1cycsJ2RlbGF5cycsJ29wZXJhdGlvbmFsVGltZXMnXSI7CgoKLy8gPC0tIHByb2QtbW9kZQoKLy8gLS0+IHRlc3QtbW9kZQovLyAgICAgICAgLy8gREVGSU5JVElPTlMgRk9SIExPQ0FMIFRFU1RORVQKLy8gICAgICAgIHN0cmluZyBjb25zdGFudCBPUkFDTElaRV9SQVRJTkdTX0JBU0VfVVJMID0KLy8gICAgICAgICAgICAvLyByYXRpbmdzIGFwaSBpcyB2MSwgc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmZsaWdodHN0YXRzLmNvbS9hcGktZG9jcy9yYXRpbmdzL3YxCi8vICAgICAgICAgICAgIltVUkxdIGpzb24oaHR0cHM6Ly9hcGktdGVzdC5ldGhlcmlzYy5jb20vZmxleC9yYXRpbmdzL3Jlc3QvdjEvanNvbi9mbGlnaHQvIjsKLy8gICAgICAgIHN0cmluZyBjb25zdGFudCBPUkFDTElaRV9SQVRJTkdTX1FVRVJZID0KLy8gICAgICAgICAgICAvLyBmb3IgdGVzdHJwYzoKLy8gICAgICAgICAgICAiKS5yYXRpbmdzWzBdWydvYnNlcnZhdGlvbnMnLCdsYXRlMTUnLCdsYXRlMzAnLCdsYXRlNDUnLCdjYW5jZWxsZWQnLCdkaXZlcnRlZCcsJ2Fycml2YWxBaXJwb3J0RnNDb2RlJ10iOwovLyAgICAgICAgc3RyaW5nIGNvbnN0YW50IE9SQUNMSVpFX1NUQVRVU19CQVNFX1VSTCA9Ci8vICAgICAgICAgICAgLy8gZmxpZ2h0IHN0YXR1cyBhcGkgaXMgdjIsIHNlZSBodHRwczovL2RldmVsb3Blci5mbGlnaHRzdGF0cy5jb20vYXBpLWRvY3MvZmxpZ2h0c3RhdHVzL3YyL2ZsaWdodAovLyAgICAgICAgICAgICJbVVJMXSBqc29uKGh0dHBzOi8vYXBpLXRlc3QuZXRoZXJpc2MuY29tL2ZsZXgvZmxpZ2h0c3RhdHVzL3Jlc3QvdjIvanNvbi9mbGlnaHQvc3RhdHVzLyI7Ci8vICAgICAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfU1RBVFVTX1FVRVJZID0KLy8gICAgICAgICAgICAvLyBmb3IgdGVzdHJwYzoKLy8gICAgICAgICAgICAiP3V0Yz10cnVlKS5mbGlnaHRTdGF0dXNlc1swXVsnc3RhdHVzJywnZGVsYXlzJywnb3BlcmF0aW9uYWxUaW1lcyddIjsKLy8gPC0tIHRlc3QtbW9kZQp9Cgpjb250cmFjdCBGbGlnaHREZWxheURhdGFiYXNlSW50ZXJmYWNlIGlzIEZsaWdodERlbGF5RGF0YWJhc2VNb2RlbCB7CgogICAgZnVuY3Rpb24gc2V0QWNjZXNzQ29udHJvbChhZGRyZXNzIF9jb250cmFjdCwgYWRkcmVzcyBfY2FsbGVyLCB1aW50OCBfcGVybSk7CgogICAgZnVuY3Rpb24gc2V0QWNjZXNzQ29udHJvbCgKICAgICAgICBhZGRyZXNzIF9jb250cmFjdCwKICAgICAgICBhZGRyZXNzIF9jYWxsZXIsCiAgICAgICAgdWludDggX3Blcm0sCiAgICAgICAgYm9vbCBfYWNjZXNzCiAgICApOwoKICAgIGZ1bmN0aW9uIGdldEFjY2Vzc0NvbnRyb2woYWRkcmVzcyBfY29udHJhY3QsIGFkZHJlc3MgX2NhbGxlciwgdWludDggX3Blcm0pIHJldHVybnMgKGJvb2wgX2FsbG93ZWQpOwoKICAgIGZ1bmN0aW9uIHNldExlZGdlcih1aW50OCBfaW5kZXgsIGludCBfdmFsdWUpOwoKICAgIGZ1bmN0aW9uIGdldExlZGdlcih1aW50OCBfaW5kZXgpIHJldHVybnMgKGludCBfdmFsdWUpOwoKICAgIGZ1bmN0aW9uIGdldEN1c3RvbWVyUHJlbWl1bSh1aW50IF9wb2xpY3lJZCkgcmV0dXJucyAoYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3ByZW1pdW0pOwoKICAgIGZ1bmN0aW9uIGdldFBvbGljeURhdGEodWludCBfcG9saWN5SWQpIHJldHVybnMgKGFkZHJlc3MgX2N1c3RvbWVyLCB1aW50IF9wcmVtaXVtLCB1aW50IF93ZWlnaHQpOwoKICAgIGZ1bmN0aW9uIGdldFBvbGljeVN0YXRlKHVpbnQgX3BvbGljeUlkKSByZXR1cm5zIChwb2xpY3lTdGF0ZSBfc3RhdGUpOwoKICAgIGZ1bmN0aW9uIGdldFJpc2tJZCh1aW50IF9wb2xpY3lJZCkgcmV0dXJucyAoYnl0ZXMzMiBfcmlza0lkKTsKCiAgICBmdW5jdGlvbiBjcmVhdGVQb2xpY3koYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3ByZW1pdW0sIEN1cnJlbmN5IF9jdXJyZW5jeSwgYnl0ZXMzMiBfY3VzdG9tZXJFeHRlcm5hbElkLCBieXRlczMyIF9yaXNrSWQpIHJldHVybnMgKHVpbnQgX3BvbGljeUlkKTsKCiAgICBmdW5jdGlvbiBzZXRTdGF0ZSgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICBwb2xpY3lTdGF0ZSBfc3RhdGUsCiAgICAgICAgdWludCBfc3RhdGVUaW1lLAogICAgICAgIGJ5dGVzMzIgX3N0YXRlTWVzc2FnZQogICAgKTsKCiAgICBmdW5jdGlvbiBzZXRXZWlnaHQodWludCBfcG9saWN5SWQsIHVpbnQgX3dlaWdodCwgYnl0ZXMgX3Byb29mKTsKCiAgICBmdW5jdGlvbiBzZXRQYXlvdXRzKHVpbnQgX3BvbGljeUlkLCB1aW50IF9jYWxjdWxhdGVkUGF5b3V0LCB1aW50IF9hY3R1YWxQYXlvdXQpOwoKICAgIGZ1bmN0aW9uIHNldERlbGF5KHVpbnQgX3BvbGljeUlkLCB1aW50OCBfZGVsYXksIHVpbnQgX2RlbGF5SW5NaW51dGVzKTsKCiAgICBmdW5jdGlvbiBnZXRSaXNrUGFyYW1ldGVycyhieXRlczMyIF9yaXNrSWQpCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiBfY2FycmllckZsaWdodE51bWJlciwgYnl0ZXMzMiBfZGVwYXJ0dXJlWWVhck1vbnRoRGF5LCB1aW50IF9hcnJpdmFsVGltZSk7CgogICAgZnVuY3Rpb24gZ2V0UHJlbWl1bUZhY3RvcnMoYnl0ZXMzMiBfcmlza0lkKQogICAgICAgIHJldHVybnMgKHVpbnQgX2N1bXVsYXRlZFdlaWdodGVkUHJlbWl1bSwgdWludCBfcHJlbWl1bU11bHRpcGxpZXIpOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVVwZGF0ZVJpc2soYnl0ZXMzMiBfY2FycmllckZsaWdodE51bWJlciwgYnl0ZXMzMiBfZGVwYXJ0dXJlWWVhck1vbnRoRGF5LCB1aW50IF9hcnJpdmFsVGltZSkKICAgICAgICByZXR1cm5zIChieXRlczMyIF9yaXNrSWQpOwoKICAgIGZ1bmN0aW9uIHNldFByZW1pdW1GYWN0b3JzKGJ5dGVzMzIgX3Jpc2tJZCwgdWludCBfY3VtdWxhdGVkV2VpZ2h0ZWRQcmVtaXVtLCB1aW50IF9wcmVtaXVtTXVsdGlwbGllcik7CgogICAgZnVuY3Rpb24gZ2V0T3JhY2xpemVDYWxsYmFjayhieXRlczMyIF9xdWVyeUlkKQogICAgICAgIHJldHVybnMgKHVpbnQgX3BvbGljeUlkLCB1aW50IF9hcnJpdmFsVGltZSk7CgogICAgZnVuY3Rpb24gZ2V0T3JhY2xpemVQb2xpY3lJZChieXRlczMyIF9xdWVyeUlkKQogICAgcmV0dXJucyAodWludCBfcG9saWN5SWQpOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZU9yYWNsaXplQ2FsbGJhY2soCiAgICAgICAgYnl0ZXMzMiBfcXVlcnlJZCwKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICBvcmFjbGl6ZVN0YXRlIF9vcmFjbGl6ZVN0YXRlLAogICAgICAgIHVpbnQgX29yYWNsaXplVGltZQogICAgKTsKCiAgICBmdW5jdGlvbiBjaGVja1RpbWUoYnl0ZXMzMiBfcXVlcnlJZCwgYnl0ZXMzMiBfcmlza0lkLCB1aW50IF9vZmZzZXQpCiAgICAgICAgcmV0dXJucyAoYm9vbCBfcmVzdWx0KTsKfQoKY29udHJhY3QgRmxpZ2h0RGVsYXlBY2Nlc3NDb250cm9sbGVySW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uQnlJZCh1aW50OCBfcGVybSwgYnl0ZXMzMiBfaWQpOwoKICAgIGZ1bmN0aW9uIHNldFBlcm1pc3Npb25CeUlkKHVpbnQ4IF9wZXJtLCBieXRlczMyIF9pZCwgYm9vbCBfYWNjZXNzKTsKCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uQnlBZGRyZXNzKHVpbnQ4IF9wZXJtLCBhZGRyZXNzIF9hZGRyKTsKCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uQnlBZGRyZXNzKHVpbnQ4IF9wZXJtLCBhZGRyZXNzIF9hZGRyLCBib29sIF9hY2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGNoZWNrUGVybWlzc2lvbih1aW50OCBfcGVybSwgYWRkcmVzcyBfYWRkcikgcmV0dXJucyAoYm9vbCBfc3VjY2Vzcyk7Cn0KCmNvbnRyYWN0IEZsaWdodERlbGF5TGVkZ2VySW50ZXJmYWNlIGlzIEZsaWdodERlbGF5RGF0YWJhc2VNb2RlbCB7CgogICAgZnVuY3Rpb24gcmVjZWl2ZUZ1bmRzKEFjYyBfdG8pIHBheWFibGU7CgogICAgZnVuY3Rpb24gc2VuZEZ1bmRzKGFkZHJlc3MgX3JlY2lwaWVudCwgQWNjIF9mcm9tLCB1aW50IF9hbW91bnQpIHJldHVybnMgKGJvb2wgX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGJvb2trZWVwaW5nKEFjYyBfZnJvbSwgQWNjIF90bywgdWludCBhbW91bnQpOwp9CgoKY29udHJhY3QgRmxpZ2h0RGVsYXlQYXlvdXRJbnRlcmZhY2UgewoKICAgIGZ1bmN0aW9uIHNjaGVkdWxlUGF5b3V0T3JhY2xpemVDYWxsKHVpbnQgX3BvbGljeUlkLCBieXRlczMyIF9yaXNrSWQsIHVpbnQgX29mZnNldCk7Cn0KY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfdXNlQ291cG9uKHN0cmluZyBjb2RlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkodWludCBfZGVsYXksIHVpbnQgX25ieXRlcywgdWludCBfY3VzdG9tR2FzTGltaXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIGlmICgoX25ieXRlcyA9PSAwKXx8KF9uYnl0ZXMgPiAzMikpIHRocm93OwogICAgICAgIGJ5dGVzIG1lbW9yeSBuYnl0ZXMgPSBuZXcgYnl0ZXMoMSk7CiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsKICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBtc3RvcmUodW5vbmNlLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHVub25jZSwgMHgyMCksIHhvcihibG9ja2hhc2goc3ViKG51bWJlciwgMSkpLCB4b3IoY29pbmJhc2UsIHRpbWVzdGFtcCkpKQogICAgICAgICAgICBtc3RvcmUoc2Vzc2lvbktleUhhc2gsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2Vzc2lvbktleUhhc2gsIDB4MjApLCBzZXNzaW9uS2V5SGFzaF9ieXRlczMyKQogICAgICAgIH0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOwogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBzaGEzKGJ5dGVzOChfZGVsYXkpLCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyPT5ieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsKCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBzaWdvazsKICAgICAgICBhZGRyZXNzIHNpZ25lcjsKCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQrKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgICAgIHNpZ3MgOj0gbWxvYWQoYWRkKHNpZ3NfLCAzMikpCiAgICAgICAgfQoKCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcikgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7CiAgICAgICAgICAgIHJldHVybiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CgogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFwcGtleTFfcHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrMSwgNjQsIGFwcGtleTFfcHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IDE7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMrNjUrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMys2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOwoKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CgogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHRocm93OwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHRocm93OwoKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19yZXR1cm5Db2RlKGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIGludGVybmFsIHJldHVybnMgKHVpbnQ4KXsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIGlmICgoX3Byb29mWzBdICE9ICJMIil8fChfcHJvb2ZbMV0gIT0gIlAiKXx8KF9wcm9vZlsyXSAhPSAxKSkgcmV0dXJuIDE7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgcmV0dXJuIDI7CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBtYXRjaF8gPSB0cnVlOwoKICAgICAgICBmb3IgKHZhciBpPTA7IGk8cHJlZml4Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIGNoZWNrb2s7CgoKICAgICAgICAvLyBTdGVwIDI6IHRoZSB1bmlxdWUga2V5aGFzaCBoYXMgdG8gbWF0Y2ggd2l0aCB0aGUgc2hhMjU2IG9mIChjb250ZXh0IG5hbWUgKyBxdWVyeUlkKQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzKzY1Kyh1aW50KHByb29mWzMrNjUrMV0pKzIpKzMyOwogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiwga2V5aGFzaCwgMCk7CiAgICAgICAgY2hlY2tvayA9IChzaGEzKGtleWhhc2gpID09IHNoYTMoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgoKICAgICAgICAvLyBTdGVwIDM6IHdlIGFzc3VtZSBzaWcxIGlzIHZhbGlkIChpdCB3aWxsIGJlIHZlcmlmaWVkIGR1cmluZyBzdGVwIDUpIGFuZCB3ZSB2ZXJpZnkgaWYgJ3Jlc3VsdCcgaXMgdGhlIHByZWZpeCBvZiBzaGEyNTYoc2lnMSkKICAgICAgICBjaGVja29rID0gbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0KTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwgc2hhMyhkZWxheSwgbmJ5dGVzLCB1bm9uY2UsIHNlc3Npb25LZXlIYXNoKSA9PSBjb21taXRtZW50IGluIHN0b3JhZ2UuCiAgICAgICAgLy8gVGhpcyBpcyB0byB2ZXJpZnkgdGhhdCB0aGUgY29tcHV0ZWQgYXJncyBtYXRjaCB3aXRoIHRoZSBvbmVzIHNwZWNpZmllZCBpbiB0aGUgcXVlcnkuCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKzMyLCA4KzErMzIsIGNvbW1pdG1lbnRTbGljZTEsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvblB1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgdWludCBzaWcyb2Zmc2V0ID0gbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrKDgrMSszMikrc2lnMS5sZW5ndGgrNjU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LTY0LCA2NCwgc2Vzc2lvblB1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzMzIgc2Vzc2lvblB1YmtleUhhc2ggPSBzaGEyNTYoc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjEgPSBuZXcgYnl0ZXMoMzIrOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMis4KzErMzIsIHRvc2lnbjEsIDApOwogICAgICAgIGNoZWNrb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjEpLCBzaWcxLCBzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB2ZXJpZnkgaWYgc2Vzc2lvblB1YmtleUhhc2ggd2FzIHZlcmlmaWVkIGFscmVhZHksIGlmIG5vdC4uIGxldCdzIGRvIGl0IQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2UpewogICAgICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KHByb29mLCBzaWcyb2Zmc2V0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF07CiAgICB9CgoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgICAgIHRocm93OyAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5PwogICAgICAgIH0KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIC8vIFdlIGRvIG91ciBvd24gbWVtb3J5IG1hbmFnZW1lbnQgaGVyZS4gU29saWRpdHkgdXNlcyBtZW1vcnkgb2Zmc2V0CiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcwogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28KICAgICAgICAvLyBTb2xpZGl0eSB3aWxsIHJldXNlIGl0LiBUaGUgbWVtb3J5IHVzZWQgaGVyZSBpcyBvbmx5IG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGlzIGNvbnRleHQuCgogICAgICAgIC8vIEZJWE1FOiBpbmxpbmUgYXNzZW1ibHkgY2FuJ3QgYWNjZXNzIHJldHVybiB2YWx1ZXMKICAgICAgICBib29sIHJldDsKICAgICAgICBhZGRyZXNzIGFkZHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKHNpemUsIGhhc2gpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA5NiksIHMpCgogICAgICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoCiAgICAgICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgICAgICByZXQgOj0gY2FsbCgzMDAwLCAxLCAwLCBzaXplLCAxMjgsIHNpemUsIDMyKQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQoKfQovLyA8L09SQUNMSVpFX0FQST4KCmNvbnRyYWN0IEZsaWdodERlbGF5T3JhY2xpemVJbnRlcmZhY2UgaXMgdXNpbmdPcmFjbGl6ZSB7CgogICAgbW9kaWZpZXIgb25seU9yYWNsaXplT3IgKGFkZHJlc3MgX2VtZXJnZW5jeSkgewovLyAtLT4gcHJvZC1tb2RlCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9yYWNsaXplX2NiQWRkcmVzcygpIHx8IG1zZy5zZW5kZXIgPT0gX2VtZXJnZW5jeSk7Ci8vIDwtLSBwcm9kLW1vZGUKICAgICAgICBfOwogICAgfQp9Cgpjb250cmFjdCBDb252ZXJ0TGliIHsKCiAgICAvLyAuLiBzaW5jZSBiZWdpbm5pbmcgb2YgdGhlIHllYXIKICAgIHVpbnQxNlsxMl0gZGF5c19zaW5jZSA9IFsKICAgICAgICAxMSwKICAgICAgICA0MiwKICAgICAgICA3MCwKICAgICAgICAxMDEsCiAgICAgICAgMTMxLAogICAgICAgIDE2MiwKICAgICAgICAxOTIsCiAgICAgICAgMjIzLAogICAgICAgIDI1NCwKICAgICAgICAyODQsCiAgICAgICAgMzE1LAogICAgICAgIDM0NQogICAgXTsKCiAgICBmdW5jdGlvbiBiMzJ0b1N0cmluZyhieXRlczMyIHgpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIC8vIGdhcyB1c2FnZTogYWJvdXQgMUsgZ2FzIHBlciBjaGFyLgogICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlc1N0cmluZyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBjaGFyQ291bnQgPSAwOwoKICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCAzMjsgaisrKSB7CiAgICAgICAgICAgIGJ5dGUgY2hhciA9IGJ5dGUoYnl0ZXMzMih1aW50KHgpICogMiAqKiAoOCAqIGopKSk7CiAgICAgICAgICAgIGlmIChjaGFyICE9IDApIHsKICAgICAgICAgICAgICAgIGJ5dGVzU3RyaW5nW2NoYXJDb3VudF0gPSBjaGFyOwogICAgICAgICAgICAgICAgY2hhckNvdW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlc1N0cmluZ1RyaW1tZWQgPSBuZXcgYnl0ZXMoY2hhckNvdW50KTsKCiAgICAgICAgZm9yIChqID0gMDsgaiA8IGNoYXJDb3VudDsgaisrKSB7CiAgICAgICAgICAgIGJ5dGVzU3RyaW5nVHJpbW1lZFtqXSA9IGJ5dGVzU3RyaW5nW2pdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN0cmluZyhieXRlc1N0cmluZ1RyaW1tZWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGIzMnRvSGV4U3RyaW5nKGJ5dGVzMzIgeCkgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDMyOyBpKyspIHsKICAgICAgICAgICAgdWludDggYnkgPSB1aW50OCh1aW50KHgpIC8gKDIqKig4KigzMSAtIGkpKSkpOwogICAgICAgICAgICB1aW50OCBoaWdoID0gYnkvMTY7CiAgICAgICAgICAgIHVpbnQ4IGxvdyA9IGJ5IC0gMTYqaGlnaDsKICAgICAgICAgICAgaWYgKGhpZ2ggPiA5KSB7CiAgICAgICAgICAgICAgICBoaWdoICs9IDM5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsb3cgPiA5KSB7CiAgICAgICAgICAgICAgICBsb3cgKz0gMzk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYlsyKmldID0gYnl0ZShoaWdoKzQ4KTsKICAgICAgICAgICAgYlsyKmkrMV0gPSBieXRlKGxvdys0OCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3RyaW5nKGIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpID0gMDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgoYnJlc3VsdFtpXSA+PSA0OCkmJihicmVzdWx0W2ldIDw9IDU3KSkgewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2ItLTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgewogICAgICAgICAgICAgICAgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIHsKICAgICAgICAgICAgbWludCAqPSAxMCoqX2I7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtaW50OwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24geWllbGRzIGNvcnJlY3QgcmVzdWx0cyBpbiB0aGUgdGltZSBiZXR3ZWVuIDEuMy4yMDE2IGFuZCAyOC4wMi4yMDIwLAogICAgLy8gc28gd2l0aGluIHRoZSB2YWxpZGl0eSBvZiB0aGUgY29udHJhY3QgaXRzIGNvcnJlY3QuCiAgICBmdW5jdGlvbiB0b1VuaXh0aW1lKGJ5dGVzMzIgX2RheU1vbnRoWWVhcikgY29uc3RhbnQgcmV0dXJucyAodWludCB1bml4dGltZSkgewogICAgICAgIC8vIF9kYXlfbW9udGhfeWVhciA9IC9kZXAvMjAxNi8wOS8xMAogICAgICAgIGJ5dGVzIG1lbW9yeSBiRG15ID0gYnl0ZXMoYjMydG9TdHJpbmcoX2RheU1vbnRoWWVhcikpOwogICAgICAgIGJ5dGVzIG1lbW9yeSB0ZW1wMiA9IGJ5dGVzKG5ldyBzdHJpbmcoMikpOwogICAgICAgIGJ5dGVzIG1lbW9yeSB0ZW1wNCA9IGJ5dGVzKG5ldyBzdHJpbmcoNCkpOwoKICAgICAgICB0ZW1wNFswXSA9IGJEbXlbNV07CiAgICAgICAgdGVtcDRbMV0gPSBiRG15WzZdOwogICAgICAgIHRlbXA0WzJdID0gYkRteVs3XTsKICAgICAgICB0ZW1wNFszXSA9IGJEbXlbOF07CiAgICAgICAgdWludCB5ZWFyID0gcGFyc2VJbnQoc3RyaW5nKHRlbXA0KSk7CgogICAgICAgIHRlbXAyWzBdID0gYkRteVsxMF07CiAgICAgICAgdGVtcDJbMV0gPSBiRG15WzExXTsKICAgICAgICB1aW50IG1vbnRoID0gcGFyc2VJbnQoc3RyaW5nKHRlbXAyKSk7CgogICAgICAgIHRlbXAyWzBdID0gYkRteVsxM107CiAgICAgICAgdGVtcDJbMV0gPSBiRG15WzE0XTsKICAgICAgICB1aW50IGRheSA9IHBhcnNlSW50KHN0cmluZyh0ZW1wMikpOwoKICAgICAgICB1bml4dGltZSA9ICgoeWVhciAtIDE5NzApICogMzY1ICsgZGF5c19zaW5jZVttb250aC0xXSArIGRheSkgKiA4NjQwMDsKICAgIH0KfQoKbGlicmFyeSBzdHJpbmdzIHsKICAgIHN0cnVjdCBzbGljZSB7CiAgICAgICAgdWludCBfbGVuOwogICAgICAgIHVpbnQgX3B0cjsKICAgIH0KCiAgICBmdW5jdGlvbiBtZW1jcHkodWludCBkZXN0LCB1aW50IHNyYywgdWludCBsZW4pIHByaXZhdGUgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVzdCArPSAzMjsKICAgICAgICAgICAgc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGYsIDB4MjApCiAgICAgICAgfQogICAgICAgIHJldHVybiBzbGljZShieXRlcyhzZWxmKS5sZW5ndGgsIHB0cik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgbnVsbC10ZXJtaW5hdGVkIGJ5dGVzMzIgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHZhbHVlIHRvIGZpbmQgdGhlIGxlbmd0aCBvZi4KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nLCBmcm9tIDAgdG8gMzIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxlbihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHJldDsKICAgICAgICBpZiAoc2VsZiA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTY7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDg7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDQ7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDI7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAzMiAtIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGEKICAgICAqICAgICAgbnVsbC10ZXJtaW50YWVkIHV0Zi04IHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBieXRlczMyIHZhbHVlIHRvIGNvbnZlcnQgdG8gYSBzbGljZS4KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQogICAgICogICAgICAgICBmaXJzdCBudWxsLgogICAgICovCiAgICBmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQogICAgICAgICAgICBtc3RvcmUocHRyLCBzZWxmKQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikKICAgICAgICB9CiAgICAgICAgcmV0Ll9sZW4gPSBsZW4oc2VsZik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgdGhlIGN1cnJlbnQgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY29weShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHJldHVybiBzbGljZShzZWxmLl9sZW4sIHNlbGYuX3B0cik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgQ29waWVzIGEgc2xpY2UgdG8gYSBuZXcgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBzbGljZSdzIHRleHQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU3RyaW5nKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KCiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIGluIHJ1bmVzIG9mIHRoZSBzbGljZS4gTm90ZSB0aGF0IHRoaXMgb3BlcmF0aW9uCiAgICAgKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdAogICAgICogICAgICBpbiBsb29wcywgYW5kIGNhbGwgYHNsaWNlLmVtcHR5KClgIGlmIHlvdSBvbmx5IG5lZWQgdG8ga25vdyB3aGV0aGVyCiAgICAgKiAgICAgIHRoZSBzbGljZSBpcyBlbXB0eSBvciBub3QuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc2xpY2UgaW4gcnVuZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0CiAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3B0ciAtIDMxOwogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47CiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsKICAgICAgICAgICAgdWludDggYjsKICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9CiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDM7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgewogICAgICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgewogICAgICAgICAgICAgICAgcHRyICs9IDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGVuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHkgKGhhcyBhIGxlbmd0aCBvZiAwKS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuX2xlbiA9PSAwOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYG90aGVyYCBjb21lcyBsZXhpY29ncmFwaGljYWxseSBhZnRlcgogICAgICogICAgICBgc2VsZmAsIGEgbmVnYXRpdmUgbnVtYmVyIGlmIGl0IGNvbWVzIGJlZm9yZSwgb3IgemVybyBpZiB0aGUKICAgICAqICAgICAgY29udGVudHMgb2YgdGhlIHR3byBzbGljZXMgYXJlIGVxdWFsLiBDb21wYXJpc29uIGlzIGRvbmUgcGVyLXJ1bmUsCiAgICAgKiAgICAgIG9uIHVuaWNvZGUgY29kZXBvaW50cy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbi4KICAgICAqLwogICAgZnVuY3Rpb24gY29tcGFyZShzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgdWludCBzaG9ydGVzdCA9IHNlbGYuX2xlbjsKICAgICAgICBpZiAob3RoZXIuX2xlbiA8IHNlbGYuX2xlbikKICAgICAgICAgICAgc2hvcnRlc3QgPSBvdGhlci5fbGVuOwoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0cjsKICAgICAgICB2YXIgb3RoZXJwdHIgPSBvdGhlci5fcHRyOwogICAgICAgIGZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7CiAgICAgICAgICAgIHVpbnQgYTsKICAgICAgICAgICAgdWludCBiOwogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBhIDo9IG1sb2FkKHNlbGZwdHIpCiAgICAgICAgICAgICAgICBiIDo9IG1sb2FkKG90aGVycHRyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhICE9IGIpIHsKICAgICAgICAgICAgICAgIC8vIE1hc2sgb3V0IGlycmVsZXZhbnQgYnl0ZXMgYW5kIGNoZWNrIGFnYWluCiAgICAgICAgICAgICAgICB1aW50IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7CiAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IChhICYgbWFzaykgLSAoYiAmIG1hc2spOwogICAgICAgICAgICAgICAgaWYgKGRpZmYgIT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGRpZmYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGZwdHIgKz0gMzI7CiAgICAgICAgICAgIG90aGVycHRyICs9IDMyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW50KHNlbGYuX2xlbikgLSBpbnQob3RoZXIuX2xlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQogICAgICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuCiAgICAgKiBAcmV0dXJuIGBydW5lYC4KICAgICAqLwogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBydW5lLl9wdHIgPSBzZWxmLl9wdHI7CgogICAgICAgIGlmIChzZWxmLl9sZW4gPT0gMCkgewogICAgICAgICAgICBydW5lLl9sZW4gPSAwOwogICAgICAgICAgICByZXR1cm4gcnVuZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHVpbnQgYjsKICAgICAgICAvLyBMb2FkIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBydW5lIGludG8gdGhlIExTQnMgb2YgYgogICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQoc3ViKG1sb2FkKGFkZChzZWxmLCAzMikpLCAzMSkpLCAweEZGKSB9CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIGxlbiA9IDE7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgIGxlbiA9IDI7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgIGxlbiA9IDM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGVuID0gNDsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cwogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgcnVuZS5fbGVuID0gc2VsZi5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgICAgICByZXR1cm4gcnVuZTsKICAgICAgICB9CgogICAgICAgIHNlbGYuX3B0ciArPSBsZW47CiAgICAgICAgc2VsZi5fbGVuIC09IGxlbjsKICAgICAgICBydW5lLl9sZW4gPSBsZW47CiAgICAgICAgcmV0dXJuIHJ1bmU7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UsIGFkdmFuY2luZyB0aGUgc2xpY2UgdG8gcG9pbnQKICAgICAqICAgICAgdG8gdGhlIG5leHQgcnVuZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBBIHNsaWNlIGNvbnRhaW5pbmcgb25seSB0aGUgZmlyc3QgcnVuZSBmcm9tIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgbmV4dFJ1bmUoc2VsZiwgcmV0KTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4KICAgICAqLwogICAgZnVuY3Rpb24gb3JkKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQgcmV0KSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludCB3b3JkOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHVpbnQgZGl2ID0gMiAqKiAyNDg7CgogICAgICAgIC8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0KICAgICAgICB2YXIgYiA9IHdvcmQgLyBkaXY7CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIHJldCA9IGI7CiAgICAgICAgICAgIGxlbiA9IDE7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOwogICAgICAgICAgICBsZW4gPSAyOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsKICAgICAgICAgICAgbGVuID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsKICAgICAgICAgICAgbGVuID0gNDsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cwogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBkaXYgPSBkaXYgLyAyNTY7CiAgICAgICAgICAgIGIgPSAod29yZCAvIGRpdikgJiAweEZGOwogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgewogICAgICAgICAgICAgICAgLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGtlY2Nhay0yNTYgaGFzaCBvZiB0aGUgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gaGFzaC4KICAgICAqIEByZXR1cm4gVGhlIGhhc2ggb2YgdGhlIHNsaWNlLgogICAgICovCiAgICBmdW5jdGlvbiBrZWNjYWsoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXQpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJldCA6PSBzaGEzKG1sb2FkKGFkZChzZWxmLCAzMikpLCBtbG9hZChzZWxmKSkKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXF1YWw7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgSWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlCiAgICAgKiAgICAgIGJlZ2lubmluZyBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYAogICAgICovCiAgICBmdW5jdGlvbiBiZXlvbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxdWFsKSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwoKICAgICAgICBpZiAoc2VsZnB0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICB9CgogICAgICAgIHJldHVybiBlcXVhbDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBJZiBgc2VsZmAgZW5kcyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlCiAgICAgKiAgICAgIGVuZCBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYAogICAgICovCiAgICBmdW5jdGlvbiB1bnRpbChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsKICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsKICAgICAgICBpZiAoc2VsZnB0ciAhPSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgdWludCBpZHg7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBsdChzdWIocHRyLCAxKSwgZW5kKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7CiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcHRyOwoKICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsKICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgewogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncwogICAgICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBsb29wOgogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc3ViKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBndChhZGQocHRyLCAxKSwgc2VsZnB0cikpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHIKICAgICAgICAgICAgICAgICAgICBqdW1wKGV4aXQpCiAgICAgICAgICAgICAgICAgICAgcmV0OgogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7CiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsKICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOwogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyICsgbmVlZGxlbGVuOwogICAgICAgICAgICAgICAgICAgIHB0ciAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UKICAgICAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICBzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiB0aGUgcGFydCBvZiB0aGUgc3RyaW5nIGZyb20gdGhlIHN0YXJ0IG9mCiAgICAgKiAgICAgIGBzZWxmYCB0byB0aGUgZW5kIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLiBJZiBgbmVlZGxlYAogICAgICogICAgICBpcyBub3QgZm91bmQsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHRva2VuLl9wdHIgPSBzZWxmLl9wdHI7CiAgICAgICAgdG9rZW4uX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgPSBwdHIgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKTsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0cikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CiAgICAgICAgcnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNvdW50KSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgcHRyID0gZmluZFB0cihzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKSwgcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgVHJ1ZSBpZiBgc2VsZmAgY29udGFpbnMgYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBgbmVlZGxlYCBpcyBmb3VuZCBpbiBgc2VsZmAsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gY29udGFpbnMoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICE9IHNlbGYuX3B0cjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBjb25jYXRlbmF0aW9uIG9mCiAgICAgKiAgICAgIGBzZWxmYCBhbmQgYG90aGVyYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb25jYXRlbmF0ZS4KICAgICAqIEBwYXJhbSBvdGhlciBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHJldHVybiBUaGUgY29uY2F0ZW5hdGlvbiBvZiB0aGUgdHdvIHN0cmluZ3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbmNhdChzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGEKICAgICAqICAgICAgbmV3bHkgYWxsb2NhdGVkIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBkZWxpbWl0ZXIgdG8gdXNlLgogICAgICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBzbGljZXMgaW4gYHBhcnRzYCwKICAgICAqICAgICAgICAgam9pbmVkIHdpdGggYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBqb2luKHNsaWNlIHNlbGYsIHNsaWNlW10gcGFydHMpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwoKICAgICAgICB1aW50IGxlbiA9IHNlbGYuX2xlbiAqIChwYXJ0cy5sZW5ndGggLSAxKTsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBsZW4gKz0gcGFydHNbaV0uX2xlbjsKCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBmb3IoaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBwYXJ0c1tpXS5fcHRyLCBwYXJ0c1tpXS5fbGVuKTsKICAgICAgICAgICAgcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47CiAgICAgICAgICAgIGlmIChpIDwgcGFydHMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgICAgICAgICAgcmV0cHRyICs9IHNlbGYuX2xlbjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KfQoKY29udHJhY3QgRmxpZ2h0RGVsYXlQYXlvdXQgaXMgRmxpZ2h0RGVsYXlDb250cm9sbGVkQ29udHJhY3QsIEZsaWdodERlbGF5Q29uc3RhbnRzLCBGbGlnaHREZWxheU9yYWNsaXplSW50ZXJmYWNlLCBDb252ZXJ0TGliIHsKCiAgICB1c2luZyBzdHJpbmdzIGZvciAqOwoKICAgIEZsaWdodERlbGF5RGF0YWJhc2VJbnRlcmZhY2UgRkRfREI7CiAgICBGbGlnaHREZWxheUxlZGdlckludGVyZmFjZSBGRF9MRzsKICAgIEZsaWdodERlbGF5QWNjZXNzQ29udHJvbGxlckludGVyZmFjZSBGRF9BQzsKCiAgICAvKgogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBzZXRzIGl0cyBjb250cm9sbGVyCiAgICAgKiBAcGFyYW0gX2NvbnRyb2xsZXIgRkQuQ29udHJvbGxlcgogICAgICovCiAgICBmdW5jdGlvbiBGbGlnaHREZWxheVBheW91dChhZGRyZXNzIF9jb250cm9sbGVyKSB7CiAgICAgICAgc2V0Q29udHJvbGxlcihfY29udHJvbGxlcik7CiAgICB9CgogICAgLyoKICAgICAqIFB1YmxpYyBtZXRob2RzCiAgICAgKi8KCiAgICAvKgogICAgICogQGRldiBTZXQgYWNjZXNzIHBlcm1pc3Npb25zIGZvciBtZXRob2RzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnRyYWN0cygpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgRkRfQUMgPSBGbGlnaHREZWxheUFjY2Vzc0NvbnRyb2xsZXJJbnRlcmZhY2UoZ2V0Q29udHJhY3QoIkZELkFjY2Vzc0NvbnRyb2xsZXIiKSk7CiAgICAgICAgRkRfREIgPSBGbGlnaHREZWxheURhdGFiYXNlSW50ZXJmYWNlKGdldENvbnRyYWN0KCJGRC5EYXRhYmFzZSIpKTsKICAgICAgICBGRF9MRyA9IEZsaWdodERlbGF5TGVkZ2VySW50ZXJmYWNlKGdldENvbnRyYWN0KCJGRC5MZWRnZXIiKSk7CgogICAgICAgIEZEX0FDLnNldFBlcm1pc3Npb25CeUlkKDEwMSwgIkZELlVuZGVyd3JpdGUiKTsKICAgICAgICAvL0ZEX0FDLnNldFBlcm1pc3Npb25CeUFkZHJlc3MoMTAxLCBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7CiAgICAgICAgRkRfQUMuc2V0UGVybWlzc2lvbkJ5SWQoMTAyLCAiRkQuRnVuZGVyIik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgRnVuZCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBmdW5kKCkgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShGRF9BQy5jaGVja1Blcm1pc3Npb24oMTAyLCBtc2cuc2VuZGVyKSk7CgogICAgICAgIC8vIHRvZG86IGJvb2trZWVwaW5nCiAgICAgICAgLy8gdG9kbzogZmlyZSBmdW5kaW5nIGV2ZW50CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU2NoZWR1bGUgb3JhY2xpemUgY2FsbCBmb3IgcGF5b3V0CiAgICAgKiBAcGFyYW0gX3BvbGljeUlkCiAgICAgKiBAcGFyYW0gX3Jpc2tJZAogICAgICogQHBhcmFtIF9vcmFjbGl6ZVRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gc2NoZWR1bGVQYXlvdXRPcmFjbGl6ZUNhbGwodWludCBfcG9saWN5SWQsIGJ5dGVzMzIgX3Jpc2tJZCwgdWludCBfb3JhY2xpemVUaW1lKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoRkRfQUMuY2hlY2tQZXJtaXNzaW9uKDEwMSwgbXNnLnNlbmRlcikpOwoKICAgICAgICB2YXIgKGNhcnJpZXJGbGlnaHROdW1iZXIsIGRlcGFydHVyZVllYXJNb250aERheSwpID0gRkRfREIuZ2V0Umlza1BhcmFtZXRlcnMoX3Jpc2tJZCk7CgogICAgICAgIHN0cmluZyBtZW1vcnkgb3JhY2xpemVVcmwgPSBzdHJDb25jYXQoCiAgICAgICAgICAgIE9SQUNMSVpFX1NUQVRVU19CQVNFX1VSTCwKICAgICAgICAgICAgYjMydG9TdHJpbmcoY2FycmllckZsaWdodE51bWJlciksCiAgICAgICAgICAgIGIzMnRvU3RyaW5nKGRlcGFydHVyZVllYXJNb250aERheSksCiAgICAgICAgICAgIE9SQUNMSVpFX1NUQVRVU19RVUVSWQogICAgICAgICk7CgogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KAogICAgICAgICAgICBfb3JhY2xpemVUaW1lLAogICAgICAgICAgICAibmVzdGVkIiwKICAgICAgICAgICAgb3JhY2xpemVVcmwsCiAgICAgICAgICAgIE9SQUNMSVpFX0dBUwogICAgICAgICk7CgogICAgICAgIEZEX0RCLmNyZWF0ZU9yYWNsaXplQ2FsbGJhY2soCiAgICAgICAgICAgIHF1ZXJ5SWQsCiAgICAgICAgICAgIF9wb2xpY3lJZCwKICAgICAgICAgICAgb3JhY2xpemVTdGF0ZS5Gb3JQYXlvdXQsCiAgICAgICAgICAgIF9vcmFjbGl6ZVRpbWUKICAgICAgICApOwoKICAgICAgICBMb2dPcmFjbGl6ZUNhbGwoX3BvbGljeUlkLCBxdWVyeUlkLCBvcmFjbGl6ZVVybCwgX29yYWNsaXplVGltZSk7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgT3JhY2xpemUgY2FsbGJhY2suIEluIGFuIGVtZXJnZW5jeSBjYXNlLCB3ZSBjYW4gY2FsbCB0aGlzIGRpcmVjdGx5IGZyb20gRkQuRW1lcmdlbmN5IEFjY291bnQuCiAgICAgKiBAcGFyYW0gX3F1ZXJ5SWQKICAgICAqIEBwYXJhbSBfcmVzdWx0CiAgICAgKiBAcGFyYW0gX3Byb29mCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgcHVibGljIG9ubHlPcmFjbGl6ZU9yKGdldENvbnRyYWN0KCdGRC5FbWVyZ2VuY3knKSkgewoKICAgICAgICB2YXIgKHBvbGljeUlkLCBvcmFjbGl6ZVRpbWUpID0gRkRfREIuZ2V0T3JhY2xpemVDYWxsYmFjayhfcXVlcnlJZCk7CiAgICAgICAgTG9nT3JhY2xpemVDYWxsYmFjayhwb2xpY3lJZCwgX3F1ZXJ5SWQsIF9yZXN1bHQsIF9wcm9vZik7CgogICAgICAgIC8vIGNoZWNrIGlmIHBvbGljeSB3YXMgZGVjbGluZWQgYWZ0ZXIgdGhpcyBjYWxsYmFjayB3YXMgc2NoZWR1bGVkCiAgICAgICAgdmFyIHN0YXRlID0gRkRfREIuZ2V0UG9saWN5U3RhdGUocG9saWN5SWQpOwogICAgICAgIHJlcXVpcmUodWludDgoc3RhdGUpICE9IDUpOwoKICAgICAgICBieXRlczMyIHJpc2tJZCA9IEZEX0RCLmdldFJpc2tJZChwb2xpY3lJZCk7CgovLyAtLT4gZGVidWctbW9kZQovLyAgICAgICAgICAgIExvZ0J5dGVzMzIoInJpc2tJZCIsIHJpc2tJZCk7Ci8vIDwtLSBkZWJ1Zy1tb2RlCgogICAgICAgIHZhciBzbFJlc3VsdCA9IF9yZXN1bHQudG9TbGljZSgpOwoKICAgICAgICBpZiAoYnl0ZXMoX3Jlc3VsdCkubGVuZ3RoID09IDApIHsgLy8gZW1wdHkgUmVzdWx0CiAgICAgICAgICAgIGlmIChGRF9EQi5jaGVja1RpbWUoX3F1ZXJ5SWQsIHJpc2tJZCwgMTgwIG1pbnV0ZXMpKSB7CiAgICAgICAgICAgICAgICBMb2dQb2xpY3lNYW51YWxQYXlvdXQocG9saWN5SWQsICJObyBDYWxsYmFjayBhdCArMTIwIG1pbiIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2NoZWR1bGVQYXlvdXRPcmFjbGl6ZUNhbGwocG9saWN5SWQsIHJpc2tJZCwgb3JhY2xpemVUaW1lICsgNDUgbWludXRlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBmaXJzdCBjaGVjayBzdGF0dXMKICAgICAgICAgICAgLy8gZXh0cmFjdCB0aGUgc3RhdHVzIGZpZWxkOgogICAgICAgICAgICBzbFJlc3VsdC5maW5kKCJcIiIudG9TbGljZSgpKS5iZXlvbmQoIlwiIi50b1NsaWNlKCkpOwogICAgICAgICAgICBzbFJlc3VsdC51bnRpbChzbFJlc3VsdC5jb3B5KCkuZmluZCgiXCIiLnRvU2xpY2UoKSkpOwogICAgICAgICAgICBieXRlczEgc3RhdHVzID0gYnl0ZXMoc2xSZXN1bHQudG9TdHJpbmcoKSlbMF07CS8vIHMgPSBMCiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gIkMiKSB7CiAgICAgICAgICAgICAgICAvLyBmbGlnaHQgY2FuY2VsbGVkIC0tPiBwYXlvdXQKICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgNCwgMCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09ICJEIikgewogICAgICAgICAgICAgICAgLy8gZmxpZ2h0IGRpdmVydGVkIC0tPiBwYXlvdXQKICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgNSwgMCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzICE9ICJMIiAmJiBzdGF0dXMgIT0gIkEiICYmIHN0YXR1cyAhPSAiQyIgJiYgc3RhdHVzICE9ICJEIikgewogICAgICAgICAgICAgICAgTG9nUG9saWN5TWFudWFsUGF5b3V0KHBvbGljeUlkLCAiVW5wcm9jZXNzYWJsZSBzdGF0dXMiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcHJvY2VzcyB0aGUgcmVzdCBvZiB0aGUgcmVzcG9uc2U6CiAgICAgICAgICAgIHNsUmVzdWx0ID0gX3Jlc3VsdC50b1NsaWNlKCk7CiAgICAgICAgICAgIGJvb2wgYXJyaXZlZCA9IHNsUmVzdWx0LmNvbnRhaW5zKCJhY3R1YWxHYXRlQXJyaXZhbCIudG9TbGljZSgpKTsKCiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gIkEiIHx8IChzdGF0dXMgPT0gIkwiICYmICFhcnJpdmVkKSkgewogICAgICAgICAgICAgICAgLy8gZmxpZ2h0IHN0aWxsIGFjdGl2ZSBvciBub3QgYXQgZ2F0ZSAtLT4gcmVzY2hlZHVsZQogICAgICAgICAgICAgICAgaWYgKEZEX0RCLmNoZWNrVGltZShfcXVlcnlJZCwgcmlza0lkLCAxODAgbWludXRlcykpIHsKICAgICAgICAgICAgICAgICAgICBMb2dQb2xpY3lNYW51YWxQYXlvdXQocG9saWN5SWQsICJObyBhcnJpdmFsIGF0ICsxODAgbWluIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlUGF5b3V0T3JhY2xpemVDYWxsKHBvbGljeUlkLCByaXNrSWQsIG9yYWNsaXplVGltZSArIDQ1IG1pbnV0ZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSAiTCIgJiYgYXJyaXZlZCkgewogICAgICAgICAgICAgICAgdmFyIGFHID0gIlwiYXJyaXZhbEdhdGVEZWxheU1pbnV0ZXNcIjogIi50b1NsaWNlKCk7CiAgICAgICAgICAgICAgICBpZiAoc2xSZXN1bHQuY29udGFpbnMoYUcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2xSZXN1bHQuZmluZChhRykuYmV5b25kKGFHKTsKICAgICAgICAgICAgICAgICAgICBzbFJlc3VsdC51bnRpbChzbFJlc3VsdC5jb3B5KCkuZmluZCgiXCIiLnRvU2xpY2UoKSkuYmV5b25kKCJcIiIudG9TbGljZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gdHJ1ZmZsZSBidWcsIHJlcGxhY2UgYnkgIn0iIGFzIHNvb24gYXMgaXQgaXMgZml4ZWQuCiAgICAgICAgICAgICAgICAgICAgc2xSZXN1bHQudW50aWwoc2xSZXN1bHQuY29weSgpLmZpbmQoIlx4N0QiLnRvU2xpY2UoKSkpOwogICAgICAgICAgICAgICAgICAgIHNsUmVzdWx0LnVudGlsKHNsUmVzdWx0LmNvcHkoKS5maW5kKCIsIi50b1NsaWNlKCkpKTsKICAgICAgICAgICAgICAgICAgICB1aW50IGRlbGF5SW5NaW51dGVzID0gcGFyc2VJbnQoc2xSZXN1bHQudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRlbGF5SW5NaW51dGVzID0gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZGVsYXlJbk1pbnV0ZXMgPCAxNSkgewogICAgICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgMCwgMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlbGF5SW5NaW51dGVzIDwgMzApIHsKICAgICAgICAgICAgICAgICAgICBwYXlPdXQocG9saWN5SWQsIDEsIGRlbGF5SW5NaW51dGVzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVsYXlJbk1pbnV0ZXMgPCA0NSkgewogICAgICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgMiwgZGVsYXlJbk1pbnV0ZXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwYXlPdXQocG9saWN5SWQsIDMsIGRlbGF5SW5NaW51dGVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsgLy8gbm8gZGVsYXkgaW5mbwogICAgICAgICAgICAgICAgcGF5T3V0KHBvbGljeUlkLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogSW50ZXJuYWwgbWV0aG9kcwogICAgICovCgogICAgLyoKICAgICAqIEBkZXYgUGF5b3V0CiAgICAgKiBAcGFyYW0gX3BvbGljeUlkCiAgICAgKiBAcGFyYW0gX2RlbGF5CiAgICAgKiBAcGFyYW0gX2RlbGF5SW5NaW51dGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBheU91dCh1aW50IF9wb2xpY3lJZCwgdWludDggX2RlbGF5LCB1aW50IF9kZWxheUluTWludXRlcykJaW50ZXJuYWwgewovLyAtLT4gZGVidWctbW9kZQovLyAgICAgICAgICAgIExvZ1N0cmluZygiaW0gcGF5T3V0IiwgIiIpOwovLyAgICAgICAgICAgIExvZ1VpbnQoInBvbGljeUlkIiwgX3BvbGljeUlkKTsKLy8gICAgICAgICAgICBMb2dVaW50KCJkZWxheSIsIF9kZWxheSk7Ci8vICAgICAgICAgICAgTG9nVWludCgiaW4gbWludXRlcyIsIF9kZWxheUluTWludXRlcyk7Ci8vIDwtLSBkZWJ1Zy1tb2RlCgogICAgICAgIEZEX0RCLnNldERlbGF5KF9wb2xpY3lJZCwgX2RlbGF5LCBfZGVsYXlJbk1pbnV0ZXMpOwoKICAgICAgICBpZiAoX2RlbGF5ID09IDApIHsKICAgICAgICAgICAgRkRfREIuc2V0U3RhdGUoCiAgICAgICAgICAgICAgICBfcG9saWN5SWQsCiAgICAgICAgICAgICAgICBwb2xpY3lTdGF0ZS5FeHBpcmVkLAogICAgICAgICAgICAgICAgbm93LAogICAgICAgICAgICAgICAgIkV4cGlyZWQgLSBubyBkZWxheSEiCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIChjdXN0b21lciwgd2VpZ2h0LCBwcmVtaXVtKSA9IEZEX0RCLmdldFBvbGljeURhdGEoX3BvbGljeUlkKTsKCi8vIC0tPiBkZWJ1Zy1tb2RlCi8vICAgICAgICAgICAgICAgIExvZ1VpbnQoIndlaWdodCIsIHdlaWdodCk7Ci8vIDwtLSBkZWJ1Zy1tb2RlCgogICAgICAgICAgICBpZiAod2VpZ2h0ID09IDApIHsKICAgICAgICAgICAgICAgIHdlaWdodCA9IDIwMDAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1aW50IHBheW91dCA9IHByZW1pdW0gKiBXRUlHSFRfUEFUVEVSTltfZGVsYXldICogMTAwMDAgLyB3ZWlnaHQ7CiAgICAgICAgICAgIHVpbnQgY2FsY3VsYXRlZFBheW91dCA9IHBheW91dDsKCiAgICAgICAgICAgIGlmIChwYXlvdXQgPiBNQVhfUEFZT1VUKSB7CiAgICAgICAgICAgICAgICBwYXlvdXQgPSBNQVhfUEFZT1VUOwogICAgICAgICAgICB9CgogICAgICAgICAgICBGRF9EQi5zZXRQYXlvdXRzKF9wb2xpY3lJZCwgY2FsY3VsYXRlZFBheW91dCwgcGF5b3V0KTsKCiAgICAgICAgICAgIGlmICghRkRfTEcuc2VuZEZ1bmRzKGN1c3RvbWVyLCBBY2MuUGF5b3V0LCBwYXlvdXQpKSB7CiAgICAgICAgICAgICAgICBGRF9EQi5zZXRTdGF0ZSgKICAgICAgICAgICAgICAgICAgICBfcG9saWN5SWQsCiAgICAgICAgICAgICAgICAgICAgcG9saWN5U3RhdGUuU2VuZEZhaWxlZCwKICAgICAgICAgICAgICAgICAgICBub3csCiAgICAgICAgICAgICAgICAgICAgIlBheW91dCwgc2VuZCBmYWlsZWQhIgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBGRF9EQi5zZXRQYXlvdXRzKF9wb2xpY3lJZCwgY2FsY3VsYXRlZFBheW91dCwgMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBGRF9EQi5zZXRTdGF0ZSgKICAgICAgICAgICAgICAgICAgICBfcG9saWN5SWQsCiAgICAgICAgICAgICAgICAgICAgcG9saWN5U3RhdGUuUGFpZE91dCwKICAgICAgICAgICAgICAgICAgICBub3csCiAgICAgICAgICAgICAgICAgICAgIlBheW91dCBzdWNjZXNzZnVsISIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0='.
	

]
