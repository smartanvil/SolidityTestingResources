Class {
	#name : #SRTc65994d41adc458de90567d3158338a36d97a8e9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc65994d41adc458de90567d3158338a36d97a8e9 >> base64 [
	^ 'LyoKICogRVJDMjAgaW50ZXJmYWNlCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCgovKioKICogU2FmZSB1bnNpZ25lZCBzYWZlIG1hdGguCiAqCiAqIGh0dHBzOi8vYmxvZy5hcmFnb24ub25lL2xpYnJhcnktZHJpdmVuLWRldmVsb3BtZW50LWluLXNvbGlkaXR5LTJiZWJjYWY4ODczNiMuNzUwZ3d0d2xpCiAqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQXJhZ29uT25lL3plcHBlbGluLXNvbGlkaXR5L21hc3Rlci9jb250cmFjdHMvU2FmZU1hdGhMaWIuc29sCiAqCiAqIE1haW50YWluZWQgaGVyZSB1bnRpbCBtZXJnZWQgdG8gbWFpbmxpbmUgemVwcGVsaW4tc29saWRpdHkuCiAqCiAqLwpsaWJyYXJ5IFNhZmVNYXRoTGliIHsKCiAgZnVuY3Rpb24gdGltZXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWludXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBwcml2YXRlIHsKICAgIGlmICghYXNzZXJ0aW9uKSB0aHJvdzsKICB9Cn0KCgoKCi8qCiAqIE93bmFibGUKICoKICogQmFzZSBjb250cmFjdCB3aXRoIGFuIG93bmVyLgogKiBQcm92aWRlcyBvbmx5T3duZXIgbW9kaWZpZXIsIHdoaWNoIHByZXZlbnRzIGZ1bmN0aW9uIGZyb20gcnVubmluZyBpZiBpdCBpcyBjYWxsZWQgYnkgYW55b25lIG90aGVyIHRoYW4gdGhlIG93bmVyLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgewogICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cgp9CgoKLyoKICogSGFsdGFibGUKICoKICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuCiAqIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4gRGlmZmVycyBmcm9tIFBhdXNhYmxlIGJ5IGNhdXNpbmcgYSB0aHJvdyB3aGVuIGluIGhhbHQgbW9kZS4KICoKICoKICogT3JpZ2luYWxseSBlbnZpc2lvbmVkIGluIEZpcnN0Qmxvb2QgSUNPIGNvbnRyYWN0LgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGlmICghaGFsdGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgaGFsdGVkID0gdHJ1ZTsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGhhbHRlZCA9IGZhbHNlOwogIH0KCn0KCgovKioKICogSW50ZXJmYWNlIGZvciBkZWZpbmluZyBjcm93ZHNhbGUgcHJpY2luZy4KICovCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7CgogIC8qKgogICAqIFdoZW4gc29tZWJvZHkgdHJpZXMgdG8gYnV5IHRva2VucyBmb3IgWCBldGgsIGNhbGN1bGF0ZSBob3cgbWFueSB0b2tlbnMgdGhleSBnZXQuCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB0b2tlbnNTb2xkLCB1aW50IHdlaVJhaXNlZCwgYWRkcmVzcyBtc2dTZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KTsKfQoKCi8qKgogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIHN1Y2Nlc2VmdWwgY3Jvd2RzYWxlLgogKgogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkKICogLSBNYWtlIHRva2VucyB0cmFuc2ZlcmFibGUKICogLSBldGMuCiAqLwpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsKCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7Cgp9CgoKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4KICoKICogSGFuZGxlCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcwogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cwogKiAtIG1pbmltdW0gZnVuZGluZyBnb2FsIGFuZCByZWZ1bmQKICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQKICogLSBkaWZmZXJlbnQgcHJpY2luZyBzdHJhdGVnaWVzCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgewoKICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsKCiAgLyogVGhlIHRva2VuIHdlIGFyZSBzZWxsaW5nICovCiAgRVJDMjAgcHVibGljIHRva2VuOwoKICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLwogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5OwoKICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50OwoKICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7CgogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBlbmRzQXQ7CgogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwoKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOwoKICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLwogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwoKICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7CgogIC8qKiBTdGF0ZSBtYWNoaW5lCiAgICoKICAgKiAtIFByZXBhcmluZzogQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzIGFuZCB2YXJpYWJsZXMgaGF2ZSBub3QgYmVlbiBzZXQgeWV0CiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCBwYXNzZWQgc3RhcnQgdGltZSB5ZXQKICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUKICAgKiAtIFN1Y2Nlc3M6IE1pbmltdW0gZnVuZGluZyBnb2FsIHJlYWNoZWQKICAgKiAtIEZhaWx1cmU6IE1pbmltdW0gZnVuZGluZyBnb2FsIG5vdCByZWFjaGVkIGJlZm9yZSBlbmRpbmcgdGltZQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQKICAgKiAtIFJlZnVuZGluZzogUmVmdW5kcyBhcmUgbG9hZGVkIG9uIHRoZSBjb250cmFjdCBmb3IgcmVjbGFpbS4KICAgKi8KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9CgogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50KTsKICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOwoKICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQsIHVpbnQgX21pbmltdW1GdW5kaW5nR29hbCkgewoKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICB0b2tlbiA9IEVSQzIwKF90b2tlbik7CgogICAgcHJpY2luZ1N0cmF0ZWd5ID0gUHJpY2luZ1N0cmF0ZWd5KF9wcmljaW5nU3RyYXRlZ3kpOwoKICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0OwogICAgaWYobXVsdGlzaWdXYWxsZXQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIGlmKF9zdGFydCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgc3RhcnRzQXQgPSBfc3RhcnQ7CgogICAgaWYoX2VuZCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgZW5kc0F0ID0gX2VuZDsKCiAgICAvLyBEb24ndCBtZXNzIHRoZSBkYXRlcwogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgY2FuIGJlIHplcm8KICAgIG1pbmltdW1GdW5kaW5nR29hbCA9IF9taW5pbXVtRnVuZGluZ0dvYWw7CiAgfQoKICAvKioKICAgKiBEb24ndCBleHBlY3QgdG8ganVzdCBzZW5kIGluIG1vbmV5IGFuZCBnZXQgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICB0aHJvdzsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIENyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuCiAgICoKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIHJlY2VpdmVyKSBpblN0YXRlKFN0YXRlLkZ1bmRpbmcpIHN0b3BJbkVtZXJnZW5jeSBwYXlhYmxlIHB1YmxpYyB7CgogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyKTsKCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7CiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgaWYoaXNCcmVha2luZ0NhcCh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXkKICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93OwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdChtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBBbnlib2R5IGNhbiBjYWxsIHRvIHRyaWdnZXIgdGhlIGVuZCBvZiB0aGUgY3Jvd2RzYWxlLgogICAqCiAgICogQ2FsbCB0aGUgY29udHJhY3QgdGhhdCBwcm92aWRlcyBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgc3RvcEluRW1lcmdlbmN5IHsKCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZAogICAgaWYoZmluYWxpemVkKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsKICAgIH0KCiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLlByZXBhcmluZykgewogICAgZmluYWxpemVBZ2VudCA9IGFkZHI7CgogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQKICAgIGlmKCFmaW5hbGl6ZUFnZW50LmlzRmluYWxpemVBZ2VudCgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLgogICAqCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uCiAgICovCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgewogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93OwogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsKICB9CgogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqLwogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgewogICAgdWludDI1NiB3ZWlWYWx1ZSA9IGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl07CiAgICBpZiAod2VpVmFsdWUgPT0gMCkgdGhyb3c7CiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsKICAgIHdlaVJlZnVuZGVkID0gd2VpUmVmdW5kZWQucGx1cyh3ZWlWYWx1ZSk7CiAgICBSZWZ1bmQobXNnLnNlbmRlciwgd2VpVmFsdWUpOwogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyByYWlzZWQgZW5vdWdoIG1vbmV5IHRvIGJlIGEgc3VjY2VzCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICoKICAgKiBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlLCBzbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLgogICAqLwogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7CiAgICBpZihmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKGZpbmFsaXplQWdlbnQpID09IDApIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghZmluYWxpemVBZ2VudC5pc1NhbmUoKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CgogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsKICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOwogIH0KCiAgLy8KICAvLyBNb2RpZmllcnMKICAvLwoKICAvKiogTW9kaWZpZWQgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgdGhyb3c7CiAgICBfOwogIH0KCgogIC8vCiAgLy8gQWJzdHJhY3QgZnVuY3Rpb25zCiAgLy8KCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgaW52ZXN0ZWQgYnJlYWtzIG91ciBjYXAgcnVsZXMuCiAgICoKICAgKgogICAqIFRoZSBjaGlsZCBjb250cmFjdCBtdXN0IGRlZmluZSB0aGVpciBvd24gY2FwIHNldHRpbmcgcnVsZXMuCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLgogICAqCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB3ZWlSYWlzZWRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCByYWlzZWQgYmFsYW5jZSBhZnRlciB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGFraW5nIHRoaXMgaW52ZXN0bWVudCB3b3VsZCBicmVhayBvdXIgY2FwIHJ1bGVzCiAgICovCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgbGltaXRCcm9rZW4pOwoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgZnVsbCBhbmQgd2UgY2FuIG5vIGxvbmdlciBzZWxsIGFueSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4KICAgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgcHJpdmF0ZTsKfQoKCgoKCgoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiID4gMCk7CiAgICB1aW50IGMgPSBhIC8gYjsKICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KfQoKCgovKioKICogU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDoKICogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93OwoKICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKCgoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLgogKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogIC8qKiBJbnRlcmZhY2UgbWFya2VyICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKfQoKCgovKioKICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uCiAqCiAqIEZpcnN0IGVudmlzaW9uZWQgYnkgR29sZW0gYW5kIEx1bnlyIHByb2plY3RzLgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CgogIC8qKiBUaGUgbmV4dCBjb250cmFjdCB3aGVyZSB0aGUgdG9rZW5zIHdpbGwgYmUgbWlncmF0ZWQuICovCiAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgd2UgaGF2ZSB1cGdyYWRlZCBieSBub3cuICovCiAgdWludDI1NiBwdWJsaWMgdG90YWxVcGdyYWRlZDsKCiAgLyoqCiAgICogVXBncmFkZSBzdGF0ZXMuCiAgICoKICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogVG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldAogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0CiAgICogLSBVcGdyYWRpbmc6IFVwZ3JhZGUgYWdlbnQgaXMgc2V0IGFuZCB0aGUgYmFsYW5jZSBob2xkZXJzIGNhbiB1cGdyYWRlIHRoZWlyIHRva2VucwogICAqCiAgICovCiAgZW51bSBVcGdyYWRlU3RhdGUge1Vua25vd24sIE5vdEFsbG93ZWQsIFdhaXRpbmdGb3JBZ2VudCwgUmVhZHlUb1VwZ3JhZGUsIFVwZ3JhZGluZ30KCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZUFnZW50RW5hYmxlZFRva2VuKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIHsKICAgIHVwZ3JhZGVNYXN0ZXIgPSBfdXBncmFkZU1hc3RlcjsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIHB1YmxpYyB7CgogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgaWYoIShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykpIHsKICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgICAgICB0aHJvdzsKICAgICAgfQoKICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgIGlmICh2YWx1ZSA9PSAwKSB0aHJvdzsKCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0ubWludXModmFsdWUpOwoKICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5taW51cyh2YWx1ZSk7CiAgICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLnBsdXModmFsdWUpOwoKICAgICAgLy8gVXBncmFkZSBhZ2VudCByZWlzc3VlcyB0aGUgdG9rZW5zCiAgICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAgIFVwZ3JhZGUobXNnLnNlbmRlciwgdXBncmFkZUFnZW50LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBTZXQgYW4gdXBncmFkZSBhZ2VudCB0aGF0IGhhbmRsZXMKICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgewoKICAgICAgaWYoIWNhblVwZ3JhZGUoKSkgewogICAgICAgIC8vIFRoZSB0b2tlbiBpcyBub3QgeWV0IGluIGEgc3RhdGUgdGhhdCB3ZSBjb3VsZCB0aGluayB1cGdyYWRpbmcKICAgICAgICB0aHJvdzsKICAgICAgfQoKICAgICAgaWYgKGFnZW50ID09IDB4MCkgdGhyb3c7CiAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBhZ2VudAogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsKICAgICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQKICAgICAgaWYgKGdldFVwZ3JhZGVTdGF0ZSgpID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpIHRocm93OwoKICAgICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKCiAgICAgIC8vIEJhZCBpbnRlcmZhY2UKICAgICAgaWYoIXVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKSB0aHJvdzsKCiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7CgogICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7CiAgICBpZighY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYodG90YWxVcGdyYWRlZCA9PSAwKSByZXR1cm4gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlOwogICAgZWxzZSByZXR1cm4gVXBncmFkZVN0YXRlLlVwZ3JhZGluZzsKICB9CgogIC8qKgogICAqIENoYW5nZSB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICoKICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBleHRlcm5hbCB7CiAgICAgIGlmIChtYXN0ZXIgPT0gMHgwKSB0aHJvdzsKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7CiAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBtYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gZW5hYmxlIHRvIHByb3ZpZGUgdGhlIGNvbmRpdGlvbiB3aGVuIHRoZSB1cGdyYWRlIGNhbiBiZWd1bi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgIHJldHVybiB0cnVlOwogIH0KCn0KCgoKCgoKLyoKClRyYW5zZmVyYWJsZVRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24KdG8gbGltaXQgdG9rZW4gdHJhbnNmZXJhYmlsaXR5IGZvciBkaWZmZXJlbnQgZXZlbnRzLgoKSXQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBhcyBhIGJhc2UgY2xhc3MgZm9yIG90aGVyIHRva2VuIGNvbnRyYWN0cy4KCk92ZXItd3JpdHRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlCnRoZSBzcGVjaWZpYyBsb2dpYyBmb3IgbGltaXR0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLgoKVHJhbnNmZXJhYmxlVG9rZW4gaGFzIGJlZW4gZGVzaWduZWQgdG8gYWxsb3cgZm9yIGRpZmZlcmVudCBsaW1pdHRpbmcgZmFjdG9ycywKdGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgcmVjdXJzaXZlbHkgY2FsbGluZyBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoKSB1bnRpbCB0aGUKYmFzZSBjbGFzcyBpcyBoaXQuIEZvciBleGFtcGxlOgoKZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICByZXR1cm4gbWluMjU2KHVubG9ja2VkVG9rZW5zLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7Cn0KCkEgd29ya2luZyBleGFtcGxlIGlzIFZlc3RlZFRva2VuLnNvbDoKaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9ibG9iL21hc3Rlci9jb250cmFjdHMvdG9rZW4vVmVzdGVkVG9rZW4uc29sCgoqLwoKY29udHJhY3QgVHJhbnNmZXJhYmxlVG9rZW4gaXMgRVJDMjAgewogIC8vIENoZWNrcyB3aGV0aGVyIGl0IGNhbiB0cmFuc2ZlciBvciBvdGhlcndpc2UgdGhyb3dzLgogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsKICAgaWYgKF92YWx1ZSA+IHRyYW5zZmVyYWJsZVRva2Vucyhfc2VuZGVyLCB1aW50NjQobm93KSkpIHRocm93OwogICBfOwogIH0KCiAgLy8gQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIC8vIENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLy8gRGVmYXVsdCB0cmFuc2ZlcmFibGUgdG9rZW5zIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRva2VucyBmb3IgYSBob2xkZXIgKG5vIGxpbWl0KS4KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOwogIH0KfQoKCgoKLyoqCiAqIERlZmluZSBpbnRlcmZhY2UgZm9yIHJlbGVhc2luZyB0aGUgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICovCmNvbnRyYWN0IFJlbGVhc2FibGVUb2tlbiBpcyBFUkMyMCwgT3duYWJsZSB7CgogIC8qIFRoZSBmaW5hbGl6ZXIgY29udHJhY3QgdGhhdCBhbGxvd3MgdW5saWZ0IHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLwogIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKCiAgLyoqIEEgY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiByZWxlYXNlIHVzIHRvIHRoZSB3aWxkIGlmIElDTyBzdWNjZXNzLiBJZiBmYWxzZSB3ZSBhcmUgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLiovCiAgYm9vbCBwdWJsaWMgcmVsZWFzZWQgPSBmYWxzZTsKCiAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB0cmFuc2ZlckFnZW50czsKCiAgLyoqCiAgICogTGltaXQgdG9rZW4gdHJhbnNmZXIgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAqCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyKSB7CgogICAgaWYoIXJlbGVhc2VkKSB7CiAgICAgICAgaWYoIXRyYW5zZmVyQWdlbnRzW19zZW5kZXJdKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgIH0KCiAgICBfOwogIH0KCiAgLyoqCiAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CgogICAgLy8gQWxyZWFkeSBzZXQKICAgIGlmKHJlbGVhc2VBZ2VudCAhPSAwKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIFdlIGRvbid0IGRvIGludGVyZmFjZSBjaGVjayBoZXJlIGFzIHdlIG1pZ2h0IHdhbnQgdG8gYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudAogICAgcmVsZWFzZUFnZW50ID0gYWRkcjsKICB9CgogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIHBhcnRpY3VsYXIgYWRkcmVzcyAoYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIHRvIHRoZSB3aWxkLgogICAqCiAgICogQ2FuIGJlIGNhbGxlZCBvbmx5IGZyb20gdGhlIHJlbGVhc2UgYWdlbnQgdGhhdCBpcyB0aGUgZmluYWwgSUNPIGNvbnRyYWN0LiBJdCBpcyBvbmx5IGNhbGxlZCBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBiZWVuIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJlZm9yZSBvciBhZnRlciB0aGUgdG9rZW5zIGhhdmUgYmVlbiByZWxlYXNlc2QgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgaWYocmVsZWFzZVN0YXRlICE9IHJlbGVhc2VkKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYSB3aGl0ZWxpc3RlZCByZWxlYXNlIGFnZW50LiAqLwogIG1vZGlmaWVyIG9ubHlSZWxlYXNlQWdlbnQoKSB7CiAgICBpZihtc2cuc2VuZGVyICE9IHJlbGVhc2VBZ2VudCkgewogICAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20pIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKfQoKCgoKCgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBjYW4gaW5jcmVhc2UgaXRzIHN1cHBseSBieSBhbm90aGVyIGNvbnRyYWN0LgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIGNvbnRyYWN0cyB3aGl0ZWxpc3RlZCBieSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50OwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50QWdlbnRzOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLi4KICAgKgogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgfQoKICBtb2RpZmllciBvbmx5TWludEFnZW50KCkgewogICAgLy8gT25seSBjcm93ZHNhbGUgY29udHJhY3RzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIGlmKG1pbnRpbmdGaW5pc2hlZCkgdGhyb3c7CiAgICBfOwogIH0KfQoKCgoKLyoqCiAqIEEgY3Jvd2RzYWxlZCB0b2tlbi4KICoKICogQW4gRVJDLTIwIHRva2VuIGRlc2lnbmVkIHNwZWNpZmljYWxseSBmb3IgY3Jvd2RzYWxlcyB3aXRoIGludmVzdG9yIHByb3RlY3Rpb24gYW5kIGZ1cnRoZXIgZGV2ZWxvcG1lbnQgcGF0aC4KICoKICogLSBUaGUgdG9rZW4gdHJhbnNmZXIoKSBpcyBkaXNhYmxlZCB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIKICogLSBUaGUgdG9rZW4gY29udHJhY3QgZ2l2ZXMgYW4gb3B0LWluIHVwZ3JhZGUgcGF0aCB0byBhIG5ldyBjb250cmFjdAogKiAtIFRoZSBzYW1lIHRva2VuIGNhbiBiZSBwYXJ0IG9mIHNldmVyYWwgY3Jvd2RzYWxlcyB0aHJvdWdoIGFwcHJvdmUoKSBtZWNoYW5pc20KICogLSBUaGUgdG9rZW4gY2FuIGJlIGNhcHBlZCAoc3VwcGx5IHNldCBpbiB0aGUgY29uc3RydWN0b3IpIG9yIHVuY2FwcGVkIChjcm93ZHNhbGUgY29udHJhY3QgY2FuIG1pbnQgbmV3IHRva2VucykKICoKICovCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIGlzIFJlbGVhc2FibGVUb2tlbiwgTWludGFibGVUb2tlbiwgVXBncmFkZWFibGVUb2tlbiB7CgogIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogIC8qKiBXZSBkb24ndCB3YW50IHRvIHN1cHBvcnQgZGVjaW1hbCBwbGFjZXMgYXMgaXQncyBub3QgdmVyeSB3ZWxsIGhhbmRsZWQgYnkgZGlmZmVyZW50IHdhbGxldHMgKi8KICB1aW50IHB1YmxpYyBkZWNpbWFscyA9IDA7CgogIC8qKgogICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uCiAgICoKICAgKiBUaGlzIHRva2VuIG11c3QgYmUgY3JlYXRlZCB0aHJvdWdoIGEgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIHNvIHRoYXQgaXQgaXMgb3duZWQgYnkgdGhhdCB3YWxsZXQuCiAgICovCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlVG9rZW4oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludCBfaW5pdGlhbFN1cHBseSkgewoKICAgIC8vIENyZWF0ZSBmcm9tIHRlYW0gbXVsdGlzaWcKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICAvLyBJbml0aWFsbHkgc2V0IHRoZSB1cGdyYWRlIG1hc3RlciBzYW1lIGFzIG93bmVyCiAgICB1cGdyYWRlTWFzdGVyID0gb3duZXI7CgogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKCiAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5OwoKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gdG90YWxTdXBwbHk7CiAgfQoKICAvKioKICAgKiBXaGVuIHRva2VuIGlzIHJlbGVhc2VkIHRvIGJlIHRyYW5zZmVyYWJsZSwgZW5mb3JjZSBubyBuZXcgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiByZWxlYXNlZDsKICB9Cgp9CgoKCi8qKgogKiBBdCB0aGUgZW5kIG9mIHRoZSBzdWNjZXNzZnVsIGNyb3dkc2FsZSBhbGxvY2F0ZSAlIGJvbnVzIG9mIHRva2VucyB0byB0aGUgdGVhbS4KICoKICogVW5sb2NrIHRva2Vucy4KICoKICogQm9udXNBbGxvY2F0aW9uRmluYWwgbXVzdCBiZSBzZXQgYXMgdGhlIG1pbnRpbmcgYWdlbnQgZm9yIHRoZSBNaW50YWJsZVRva2VuLgogKgogKi8KY29udHJhY3QgQm9udXNGaW5hbGl6ZUFnZW50IGlzIEZpbmFsaXplQWdlbnQgewoKICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsKCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOwogIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlOwoKICAvKiogVG90YWwgcGVyY2VudCBvZiB0b2tlbnMgbWludGVkIHRvIHRoZSB0ZWFtIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUgYXMgYmFzZSBwb2ludHMgKDAuMDAwMSkgKi8KICB1aW50IHB1YmxpYyBib251c0Jhc2VQb2ludHM7CgogIC8qKiBXaGVyZSB3ZSBtb3ZlIHRoZSB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB0ZWFtTXVsdGlzaWc7CgogIC8qIEhvdyBtdWNoIGJvbnVzIHRva2VucyB3ZSBhbGxvY2F0ZWQgKi8KICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRCb251czsKCiAgZnVuY3Rpb24gQm9udXNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZVRva2VuIF90b2tlbiwgQ3Jvd2RzYWxlIF9jcm93ZHNhbGUsIHVpbnQgX2JvbnVzQmFzZVBvaW50cywgYWRkcmVzcyBfdGVhbU11bHRpc2lnKSB7CiAgICB0b2tlbiA9IF90b2tlbjsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgICBpZihhZGRyZXNzKGNyb3dkc2FsZSkgPT0gMCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICB0ZWFtTXVsdGlzaWcgPSBfdGVhbU11bHRpc2lnOwogICAgaWYoYWRkcmVzcyh0ZWFtTXVsdGlzaWcpID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgYm9udXNCYXNlUG9pbnRzID0gX2JvbnVzQmFzZVBvaW50czsKICB9CgogIC8qIENhbiB3ZSBydW4gZmluYWxpemUgcHJvcGVybHkgKi8KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuICh0b2tlbi5taW50QWdlbnRzKGFkZHJlc3ModGhpcykpID09IHRydWUpICYmICh0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICB9CgogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhjcm93ZHNhbGUpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEhvdyBtYW55ICUgb2YgdG9rZW5zIHRoZSBmb3VuZGVycyBhbmQgb3RoZXJzIGdldAogICAgdWludCB0b2tlbnNTb2xkID0gY3Jvd2RzYWxlLnRva2Vuc1NvbGQoKTsKICAgIGFsbG9jYXRlZEJvbnVzID0gdG9rZW5zU29sZC50aW1lcyhib251c0Jhc2VQb2ludHMpIC8gMTAwMDA7CgogICAgLy8gbW92ZSB0b2tlbnMgdG8gdGhlIHRlYW0gbXVsdGlzaWcgd2FsbGV0CiAgICB0b2tlbi5taW50KHRlYW1NdWx0aXNpZywgYWxsb2NhdGVkQm9udXMpOwoKICAgIC8vIE1ha2UgdG9rZW4gdHJhbnNmZXJhYmxlCiAgICB0b2tlbi5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCn0='.
	

]
