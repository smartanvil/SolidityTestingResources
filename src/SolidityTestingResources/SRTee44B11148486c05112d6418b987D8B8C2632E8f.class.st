Class {
	#name : #SRTee44B11148486c05112d6418b987D8B8C2632E8f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTee44B11148486c05112d6418b987D8B8C2632E8f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBTcGluZXRoCnsKICAgIC8vLyBUaGUgc3RhdGVzIHRoZSBnYW1lIHdpbGwgdHJhbnNpdGlvbiB0aHJvdWdoCiAgICBlbnVtIFN0YXRlCiAgICB7CiAgICAgICAgV2FpdGluZ0ZvclBsYXllcnMsIC8vIHRoZSBnYW1lIGhhcyBiZWVuIGNyZWF0ZWQgYnkgYSBwbGF5ZXIgYW5kIGlzIHdhaXRpbmcgZm9yIGFuIG9wcG9uZW50CiAgICAgICAgV2FpdGluZ0ZvclJldmVhbCwgLy8gc29tZW9uZSBoYXMgam9pbmVkIGFuZCBhbHNvIHBsYWNlZCBhIGJldCwgd2UgYXJlIG5vdyB3YWl0aW5nIGZvciB0aGUgY3JlYXRvciB0byB0aGVpciByZXZlYWwgYmV0CiAgICAgICAgQ29tcGxldGUgLy8gdGhlIG91dGNvbWUgb2YgdGhlIGdhbWUgaXMgZGV0ZXJtaW5lZCBhbmQgcGxheWVycyBjYW4gd2l0aGRyYXcgdGhlaXIgZWFybmluZ3MKICAgIH0KCiAgICAvLy8gQWxsIHBvc3NpYmxlIGV2ZW50IHR5cGVzCiAgICBlbnVtIEV2ZW50CiAgICB7CiAgICAgICAgQ3JlYXRlLAogICAgICAgIENhbmNlbCwKICAgICAgICBKb2luLAogICAgICAgIFJldmVhbCwKICAgICAgICBFeHBpcmUsCiAgICAgICAgQ29tcGxldGUsCiAgICAgICAgV2l0aGRyYXcsCiAgICAgICAgU3RhcnRSZXZlYWwKICAgIH0KICAgIAogICAgLy8gVGhlIGdhbWUgc3RhdGUgYXNzb2NpYXRlZCB3aXRoIGEgc2luZ2xlIGdhbWUgYmV0d2VlbiB0d28gcGxheWVycwogICAgc3RydWN0IEdhbWVJbnN0YW5jZQogICAgewogICAgICAgIC8vIEFkZHJlc3MgZm9yIHBsYXllcnMgb2YgdGhpcyBnYW1lCiAgICAgICAgLy8gcGxheWVyMSBpcyBhbHdheXMgdGhlIGNyZWF0b3IKICAgICAgICBhZGRyZXNzIHBsYXllcjE7CiAgICAgICAgYWRkcmVzcyBwbGF5ZXIyOwogICAgCiAgICAgICAgLy8gSG93IG11Y2ggaXMgYmVpbmcgYmV0IHRoaXMgZ2FtZQogICAgICAgIHVpbnQgYmV0QW1vdW50SW5XZWk7CiAgICAKICAgICAgICAvLyBUaGUgd2hlZWxCZXQgZm9yIGVhY2ggcGxheWVyCiAgICAgICAgLy8gRm9yIHBsYXllcjEsIHRoZSBiZXQgc3RhcnRzIGFzIGEgaGFzaCBhbmQgaXMgb25seSBjaGFuZ2VkIHRvIHRoZSByZWFsIGJldCBvbmNlIHJldmVhbGVkCiAgICAgICAgdWludCB3aGVlbEJldFBsYXllcjE7CiAgICAgICAgdWludCB3aGVlbEJldFBsYXllcjI7CiAgICAKICAgICAgICAvLyBUaGUgZmluYWwgd2hlZWwgcG9zaXRpb24gYWZ0ZXIgZ2FtZSBpcyBjb21wbGV0ZQogICAgICAgIHVpbnQgd2hlZWxSZXN1bHQ7CiAgICAKICAgICAgICAvLyBUaGUgdGltZSBieSB3aGljaCB0aGUgY3JlYXRvciBvZiB0aGUgZ2FtZSBtdXN0IHJldmVhbCBoaXMgYmV0IGFmdGVyIGFuIG9wcG9uZW50IGpvaW5zCiAgICAgICAgLy8gSWYgdGhlIGNyZWF0b3IgZG9lcyBub3QgcmV2ZWFsIGluIHRpbWUsIHRoZSBvcHBvbmVudCBjYW4gZXhwaXJlIHRoZSBnYW1lLCBjYXVzaW5nIHRoZW0gdG8gd2luIHRoZSBtYXhpbWFsIGFtb3VudCBvZiB0aGVpciBiZXQKICAgICAgICB1aW50IGV4cGlyZVRpbWU7CgogICAgICAgIC8vIEN1cnJlbnQgc3RhdGUgb2YgdGhlIGdhbWUgICAgCiAgICAgICAgU3RhdGUgc3RhdGU7CgogICAgICAgIC8vIFRyYWNrcyB3aGV0aGVyIGVhY2ggcGxheWVyIGhhcyB3aXRoZHJhd24gdGhlaXIgZWFybmluZ3MgeWV0CiAgICAgICAgYm9vbCB3aXRoZHJhd25QbGF5ZXIxOwogICAgICAgIGJvb2wgd2l0aGRyYXduUGxheWVyMjsKICAgIH0KCiAgICAvLy8gSG93IG1hbnkgcGxhY2VzIHRoZXJlIGFyZSBvbiB0aGUgd2hlZWwgdGhhdCBhIGJldCBjYW4gYmUgcGxhY2VkCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBXSEVFTF9TSVpFID0gMTk7CiAgICAKICAgIC8vLyBXaGF0IHBlcmNlbnRhZ2Ugb2YgeW91ciBvcHBvbmVudCdzIGJldCBhIHBsYXllciB3aW5zIGZvciBlYWNoIHBsYWNlIG9uIAogICAgLy8vIHRoZSB3aGVlbCB0aGV5IGFyZSBjbG9zZXIgdG8gdGhlIHJlc3VsdCB0aGFuIHRoZWlyIG9wcG9uZW50CiAgICAvLy8gaS5lLiBJZiBwbGF5ZXIxIGRpc3RhbmNlIGZyb20gcmVzdWx0ID0gNCBhbmQgcGxheWVyMiBkaXN0YW5jZSBmcm9tIHJlc3VsdCA9IDYKICAgIC8vLyB0aGVuIHBsYXllcjEgZWFybnMgKDYtNCkgeCBXSU5fUEVSQ0VOVF9QRVJfRElTVEFOQ0UgPSAyMCUgb2YgcGxheWVyMidzIGJldAogICAgdWludCBwdWJsaWMgY29uc3RhbnQgV0lOX1BFUkNFTlRfUEVSX0RJU1RBTkNFID0gMTA7CgogICAgLy8vIFRoZSBwZXJjZW50YWdlIGNoYXJnZWQgb24gZWFybmluZ3MgdGhhdCBhcmUgd29uCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBGRUVfUEVSQ0VOVCA9IDI7CgogICAgLy8vIFRoZSBtaW5pbXVtIGFtb3VudCB0aGF0IGNhbiBiZSBiZXQKICAgIHVpbnQgcHVibGljIG1pbkJldFdlaSA9IDEgZmlubmV5OwogICAgCiAgICAvLy8gVGhlIG1heGltdW0gYW1vdW50IHRoYXQgY2FuIGJlIGJldAogICAgdWludCBwdWJsaWMgbWF4QmV0V2VpID0gMTAgZXRoZXI7CiAgICAKICAgIC8vLyBUaGUgYW1vdW50IG9mIHRpbWUgY3JlYXRvcnMgaGF2ZSB0byByZWF2ZWwgdGhlaXIgYmV0cyBiZWZvcmUKICAgIC8vLyB0aGUgZ2FtZSBjYW4gYmUgZXhwaXJlZCBieSBhbiBvcHBvbmVudAogICAgdWludCBwdWJsaWMgbWF4UmV2ZWFsU2Vjb25kcyA9IDM2MDAgKiAyNDsKCiAgICAvLy8gVGhlIGFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgZmVlcyBhbmQgY2FuIGNvbmZpZ3VyZSBtaW4vbWF4IGJldCBvcHRpb25zCiAgICBhZGRyZXNzIHB1YmxpYyBhdXRob3JpdHk7CgogICAgLy8vIENvdW50ZXJzIHRoYXQgdHJhY2tzIGhvdyBtYW55IGdhbWVzIGhhdmUgYmVlbiBjcmVhdGVkIGJ5IGVhY2ggcGxheWVyCiAgICAvLy8gVGhpcyBpcyB1c2VkIHRvIGdlbmVyYXRlIGEgdW5pcXVlIGdhbWUgaWQgcGVyIHBsYXllcgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHByaXZhdGUgY291bnRlckNvbnRleHQ7CgogICAgLy8vIENvbnRleHQgZm9yIGFsbCBjcmVhdGVkIGdhbWVzCiAgICBtYXBwaW5nKHVpbnQgPT4gR2FtZUluc3RhbmNlKSBwdWJsaWMgZ2FtZUNvbnRleHQ7CgogICAgLy8vIExpc3Qgb2YgYWxsIGN1cnJlbnRseSBvcGVuIGdhbWVpZHMKICAgIHVpbnRbXSBwdWJsaWMgb3BlbkdhbWVzOwoKICAgIC8vLyBJbmRleGVzIHNwZWNpZmljIHRvIGVhY2ggcGxheWVyCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludFtdKSBwdWJsaWMgcGxheWVyQWN0aXZlR2FtZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludFtdKSBwdWJsaWMgcGxheWVyQ29tcGxldGVHYW1lczsgICAgCgogICAgLy8vIEV2ZW50IGZpcmVkIHdoZW4gYSBnYW1lJ3Mgc3RhdGUgY2hhbmdlcwogICAgZXZlbnQgR2FtZUV2ZW50KHVpbnQgaW5kZXhlZCBnYW1lSWQsIGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIEV2ZW50IGluZGV4ZWQgZXZlbnRUeXBlKTsKCiAgICAvLy8gQ3JlYXRlIHRoZSBjb250cmFjdCBhbmQgdmVyaWZ5IGNvbnN0YW50IGNvbmZpZ3VyYXRpb25zIG1ha2Ugc2Vuc2UKICAgIGZ1bmN0aW9uIFNwaW5ldGgoKSBwdWJsaWMKICAgIHsKICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgbWF4aW11bSBwb3NzaWJsZSB3aW4gZGlzdGFuY2UgKFdIRUVMX1NJWkUgLyAyKQogICAgICAgIC8vIG11bHRpcGxpZWQgYnkgdGhlIFdJTl9QRVJDRU5UX1BFUl9ESVNUQU5DRSBpcyBsZXNzIHRoYW4gMTAwJQogICAgICAgIC8vIElmIGl0J3Mgbm90LCB0aGVuIGEgbWF4aW1hbGx5IHdvbiBiZXQgY2FuJ3QgYmUgcGFpZCBvdXQKICAgICAgICByZXF1aXJlKChXSEVFTF9TSVpFIC8gMikgKiBXSU5fUEVSQ0VOVF9QRVJfRElTVEFOQ0UgPCAxMDApOwoKICAgICAgICBhdXRob3JpdHkgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAvLyBDaGFuZ2UgYXV0aG9yaXR5CiAgICAvLyBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXV0aG9yaXR5CiAgICBmdW5jdGlvbiBjaGFuZ2VBdXRob3JpdHkoYWRkcmVzcyBuZXdBdXRob3JpdHkpIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhdXRob3JpdHkpOwoKICAgICAgICBhdXRob3JpdHkgPSBuZXdBdXRob3JpdHk7CiAgICB9CgogICAgLy8gQ2hhbmdlIG1pbi9tYXggYmV0IGFtb3VudHMKICAgIC8vIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhdXRob3JpdHkKICAgIGZ1bmN0aW9uIGNoYW5nZUJldExpbWl0cyh1aW50IG1pbkJldCwgdWludCBtYXhCZXQpIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhdXRob3JpdHkpOwogICAgICAgIHJlcXVpcmUobWF4QmV0ID49IG1pbkJldCk7CgogICAgICAgIG1pbkJldFdlaSA9IG1pbkJldDsKICAgICAgICBtYXhCZXRXZWkgPSBtYXhCZXQ7CiAgICB9CiAgICAKICAgIC8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbiB0byBhZGQgZWxlbWVudHMgdG8gYW4gYXJyYXkKICAgIGZ1bmN0aW9uIGFycmF5QWRkKHVpbnRbXSBzdG9yYWdlIGFycmF5LCB1aW50IGVsZW1lbnQpIHByaXZhdGUKICAgIHsKICAgICAgICBhcnJheS5wdXNoKGVsZW1lbnQpOwogICAgfQoKICAgIC8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbiB0byByZW1vdmUgZWxlbWVudCBmcm9tIGFuIGFycmF5CiAgICBmdW5jdGlvbiBhcnJheVJlbW92ZSh1aW50W10gc3RvcmFnZSBhcnJheSwgdWludCBlbGVtZW50KSBwcml2YXRlCiAgICB7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7ICsraSkKICAgICAgICB7CiAgICAgICAgICAgIGlmKGFycmF5W2ldID09IGVsZW1lbnQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFycmF5W2ldID0gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBkZWxldGUgYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAtLWFycmF5Lmxlbmd0aDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBHZXQgbmV4dCBnYW1lIGlkIHRvIGJlIGFzc29jaWF0ZWQgd2l0aCBhIHBsYXllciBhZGRyZXNzCiAgICBmdW5jdGlvbiBnZXROZXh0R2FtZUlkKGFkZHJlc3MgcGxheWVyKSBwdWJsaWMgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdWludCBjb3VudGVyID0gY291bnRlckNvbnRleHRbcGxheWVyXTsKCiAgICAgICAgLy8gQWRkcmVzc2VzIGFyZSAxNjAgYml0cyBzbyB3ZSBjYW4gc2FmZWx5IHNoaWZ0IHRoZW0gdXAgYnkgKDI1NiAtIDE2MCA9IDk2IGJpdHMpCiAgICAgICAgLy8gdG8gbWFrZSByb29tIGZvciB0aGUgY291bnRlciBpbiB0aGUgYm90dG9tIDk2IGJpdHMKICAgICAgICAvLyBUaGlzIG1lYW5zIGEgc2luZ2xlIHBsYXllciBjYW5ub3QgdGhlb3JldGljYWxseSBjcmVhdGUgbW9yZSB0aGFuIDJeOTYgZ2FtZXMKICAgICAgICAvLyB3aGljaCBzaG91bGQgbW9yZSB0aGFuIGVub3VnaCBmb3IgdGhlIGxpZmV0aW1lIG9mIGFueSBwbGF5ZXIuCiAgICAgICAgdWludCByZXN1bHQgPSAodWludChwbGF5ZXIpIDw8IDk2KSArIGNvdW50ZXI7CgogICAgICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkbid0IG92ZXJmbG93IHRoZSBjb3VudGVyICh0aGlzIHdpbGwgbmV2ZXIgaGFwcGVuKQogICAgICAgIHJlcXVpcmUoKHJlc3VsdCA+PiA5NikgPT0gdWludChwbGF5ZXIpKTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLy8gVXNlZCB0byBjYWxjdWxhdGUgdGhlIGJldCBoYXNoIGdpdmVuIGEgd2hlZWwgYmV0IGFuZCBhIHBsYXllciBzZWNyZXQuCiAgICAvLy8gVXNlZCBieSBhIGdhbWUgY3JlYXRvciB0byBjYWxjdWxhdGUgdGhlaXIgYmV0IGJhc2ggb2ZmIGNoYWluIGZpcnN0LgogICAgLy8vIFdoZW4gYmV0IGlzIHJldmVhbGVkLCBjb250cmFjdCB3aWxsIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIHZlcmlmeSB0aGUgcmV2ZWFsZWQgYmV0IGlzIHZhbGlkCiAgICBmdW5jdGlvbiBjcmVhdGVXaGVlbEJldEhhc2godWludCBnYW1lSWQsIHVpbnQgd2hlZWxCZXQsIHVpbnQgcGxheWVyU2VjcmV0KSBwdWJsaWMgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZSh3aGVlbEJldCA8IFdIRUVMX1NJWkUpOwogICAgICAgIHJldHVybiB1aW50KGtlY2NhazI1NihnYW1lSWQsIHdoZWVsQmV0LCBwbGF5ZXJTZWNyZXQpKTsKICAgIH0KICAgIAogICAgLy8vIENyZWF0ZSBhbmQgaW5pdGlhbGl6ZSBhIGdhbWUgaW5zdGFuY2Ugd2l0aCB0aGUgc2VudCBiZXQgYW1vdW50LgogICAgLy8vIFRoZSBjcmVhdG9yIHdpbGwgYXV0b21hdGljYWxseSBiZWNvbWUgYSBwYXJ0aWNpcGFudCBvZiB0aGUgZ2FtZS4KICAgIC8vLyBnYW1lSWQgbXVzdCBiZSB0aGUgcmV0dXJuIHZhbHVlIG9mIGdldE5leHRHYW1lSWQoLi4uKSBmb3IgdGhlIHNlbmRlcgogICAgLy8vIHdoZWVsUG9zaXRpb25IYXNoIHNob3VsZCBiZSBjYWxjdWxhdGVkIHVzaW5nIGNyZWF0ZVdoZWVsQmV0SGFzaCguLi4pCiAgICBmdW5jdGlvbiBjcmVhdGVHYW1lKHVpbnQgZ2FtZUlkLCB1aW50IHdoZWVsUG9zaXRpb25IYXNoKSBwdWJsaWMgcGF5YWJsZQogICAgewogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgcGxheWVyIHBhc3NlZCB0aGUgY29ycmVjdCB2YWx1ZSBmb3IgdGhlIGdhbWUgaWQKICAgICAgICByZXF1aXJlKGdldE5leHRHYW1lSWQobXNnLnNlbmRlcikgPT0gZ2FtZUlkKTsKCiAgICAgICAgLy8gR2V0IHRoZSBnYW1lIGluc3RhbmNlIGFuZCBlbnN1cmUgdGhhdCBpdCBkb2Vzbid0IGFscmVhZHkgZXhpc3QKICAgICAgICBHYW1lSW5zdGFuY2Ugc3RvcmFnZSBnYW1lID0gZ2FtZUNvbnRleHRbZ2FtZUlkXTsKICAgICAgICByZXF1aXJlKGdhbWUuYmV0QW1vdW50SW5XZWkgPT0gMCk7IAogICAgICAgIAogICAgICAgIC8vIE11c3QgcHJvdmlkZSBub24temVybyBiZXQKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIAogICAgICAgIC8vIFJlc3RyaWN0IGJldHRpbmcgYW1vdW50CiAgICAgICAgLy8gTk9URTogR2FtZSBjcmVhdGlvbiBjYW4gYmUgZGlzYWJsZWQgYnkgc2V0dGluZyBtaW4vbWF4IGJldCB0byAwCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluQmV0V2VpICYmIG1zZy52YWx1ZSA8PSBtYXhCZXRXZWkpOwoKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGNyZWF0ZSBnYW1lIGNvdW50ZXIgZm9yIHRoaXMgcGxheWVyCiAgICAgICAgY291bnRlckNvbnRleHRbbXNnLnNlbmRlcl0gPSBjb3VudGVyQ29udGV4dFttc2cuc2VuZGVyXSArIDE7CgogICAgICAgIC8vIFVwZGF0ZSBnYW1lIHN0YXRlCiAgICAgICAgLy8gVGhlIGNyZWF0b3IgYmVjb21lcyBwbGF5ZXIxCiAgICAgICAgZ2FtZS5zdGF0ZSA9IFN0YXRlLldhaXRpbmdGb3JQbGF5ZXJzOwogICAgICAgIGdhbWUuYmV0QW1vdW50SW5XZWkgPSBtc2cudmFsdWU7CiAgICAgICAgZ2FtZS5wbGF5ZXIxID0gbXNnLnNlbmRlcjsKICAgICAgICBnYW1lLndoZWVsQmV0UGxheWVyMSA9IHdoZWVsUG9zaXRpb25IYXNoOwogICAgICAgIAogICAgICAgIC8vIFRoaXMgZ2FtZSBpcyBub3cgb3BlbiB0byBvdGhlcnMgYW5kIGFjdGl2ZSBmb3IgdGhlIHBsYXllcgogICAgICAgIGFycmF5QWRkKG9wZW5HYW1lcywgZ2FtZUlkKTsKICAgICAgICBhcnJheUFkZChwbGF5ZXJBY3RpdmVHYW1lc1ttc2cuc2VuZGVyXSwgZ2FtZUlkKTsKCiAgICAgICAgLy8gRmlyZSBldmVudCBmb3IgdGhlIGNyZWF0aW9uIG9mIHRoaXMgZ2FtZQogICAgICAgIEdhbWVFdmVudChnYW1lSWQsIG1zZy5zZW5kZXIsIEV2ZW50LkNyZWF0ZSk7CiAgICB9CiAgICAKICAgIC8vLyBDYW5jZWwgYSBnYW1lIHRoYXQgd2FzIGNyZWF0ZWQgYnV0IG5ldmVyIGhhZCBhbm90aGVyIHBsYXllciBqb2luCiAgICAvLy8gQSBjcmVhdG9yIGNhbiB1c2UgdGhpcyBmdW5jdGlvbiBpZiB0aGV5IGhhdmUgYmVlbiB3YWl0aW5nIHRvbyBsb25nIGZvciBhbm90aGVyCiAgICAvLy8gcGxheWVyIGFuZCB3YW50IHRvIGdldCB0aGVpciBiZXQgZnVuZHMgYmFjay4gTk9URS4gT25jZSBzb21lb25lIGpvaW5zCiAgICAvLy8gdGhlIGdhbWUgY2FuIG5vIGxvbmdlciBiZSBjYW5jZWxsZWQuCiAgICBmdW5jdGlvbiBjYW5jZWxHYW1lKHVpbnQgZ2FtZUlkKSBwdWJsaWMKICAgIHsKICAgICAgICAvLyBHZXQgdGhlIGdhbWUgaW5zdGFuY2UgYW5kIGNoZWNrIHRoYXQgaXQgZXhpc3RzCiAgICAgICAgR2FtZUluc3RhbmNlIHN0b3JhZ2UgZ2FtZSA9IGdhbWVDb250ZXh0W2dhbWVJZF07CiAgICAgICAgcmVxdWlyZShnYW1lLmJldEFtb3VudEluV2VpID4gMCk7IAoKICAgICAgICAvLyBDYW4gb25seSBjYW5jZWwgaWYgd2UgYXJlIHN0aWxsIHdhaXRpbmcgZm9yIG90aGVyIHBhcnRpY2lwYW50cwogICAgICAgIHJlcXVpcmUoZ2FtZS5zdGF0ZSA9PSBTdGF0ZS5XYWl0aW5nRm9yUGxheWVycyk7CiAgICAgICAgCiAgICAgICAgLy8gSXMgdGhlIHNlbmRlciB0aGUgY3JlYXRvcj8KICAgICAgICByZXF1aXJlKGdhbWUucGxheWVyMSA9PSBtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gVXBkYXRlIGdhbWUgc3RhdGUKICAgICAgICAvLyBNYXJrIGVhcm5pbmdzIGFzIGFscmVhZHkgd2l0aGRyYXduIHNpbmNlIHdlIGFyZSByZXR1cm5pbmcgdGhlIGJldCBhbW91bnQKICAgICAgICBnYW1lLnN0YXRlID0gU3RhdGUuQ29tcGxldGU7CiAgICAgICAgZ2FtZS53aXRoZHJhd25QbGF5ZXIxID0gdHJ1ZTsKCiAgICAgICAgLy8gVGhpcyBnYW1lIGlzIG5vIGxvbmdlciBvcGVuIGFuZCBubyBsb25nZXIgYWN0aXZlIGZvciB0aGUgcGxheWVyCiAgICAgICAgYXJyYXlSZW1vdmUob3BlbkdhbWVzLCBnYW1lSWQpOwogICAgICAgIGFycmF5UmVtb3ZlKHBsYXllckFjdGl2ZUdhbWVzW21zZy5zZW5kZXJdLCBnYW1lSWQpOwoKICAgICAgICAvLyBGaXJlIGV2ZW50IGZvciBwbGF5ZXIgY2FuY2VsaW5nIHRoaXMgZ2FtZQogICAgICAgIEdhbWVFdmVudChnYW1lSWQsIG1zZy5zZW5kZXIsIEV2ZW50LkNhbmNlbCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHRoZSBwbGF5ZXIncyBiZXQgYW1vdW50IGJhY2sgdG8gdGhlbQogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZ2FtZS5iZXRBbW91bnRJbldlaSk7CiAgICB9CgogICAgLy8vIEpvaW4gYW4gb3BlbiBnYW1lIGluc3RhbmNlCiAgICAvLy8gU2VuZGVyIG11c3QgcHJvdmlkZSBhbiBhbW91bnQgb2Ygd2VpIGVxdWFsIHRvIGJldEFtb3VudEluV2VpCiAgICAvLy8gQWZ0ZXIgdGhlIHNlY29uZCBwbGF5ZXIgaGFzIGpvaW5lZCwgdGhlIGNyZWF0b3Igd2lsbCBoYXZlIG1heFJldmVhbFNlY29uZHMgdG8gcmV2ZWFsIHRoZWlyIGJldAogICAgZnVuY3Rpb24gam9pbkdhbWUodWludCBnYW1lSWQsIHVpbnQgd2hlZWxCZXQpIHB1YmxpYyBwYXlhYmxlCiAgICB7CiAgICAgICAgLy8gR2V0IHRoZSBnYW1lIGluc3RhbmNlIGFuZCBjaGVjayB0aGF0IGl0IGV4aXN0cwogICAgICAgIEdhbWVJbnN0YW5jZSBzdG9yYWdlIGdhbWUgPSBnYW1lQ29udGV4dFtnYW1lSWRdOwogICAgICAgIHJlcXVpcmUoZ2FtZS5iZXRBbW91bnRJbldlaSA+IDApOyAKICAgICAgICAKICAgICAgICAvLyBPbmx5IGFsbG93ZWQgdG8gcGFydGljaXBhdGUgd2hpbGUgd2UgYXJlIHdhaXRpbmcgZm9yIHBsYXllcnMKICAgICAgICByZXF1aXJlKGdhbWUuc3RhdGUgPT0gU3RhdGUuV2FpdGluZ0ZvclBsYXllcnMpOwogICAgICAgIAogICAgICAgIC8vIENhbid0IGpvaW4gYSBnYW1lIHRoYXQgeW91IGNyZWF0ZWQKICAgICAgICByZXF1aXJlKGdhbWUucGxheWVyMSAhPSBtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICAvLyBJcyB0aGVyZSBzcGFjZSBhdmFpbGFibGU/CiAgICAgICAgcmVxdWlyZShnYW1lLnBsYXllcjIgPT0gMCk7CgogICAgICAgIC8vIE11c3QgcGF5IHRoZSBhbW91bnQgb2YgdGhlIGJldCB0byBwbGF5CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gZ2FtZS5iZXRBbW91bnRJbldlaSk7CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgd2hlZWxCZXQgbWFrZXMgc2Vuc2UKICAgICAgICByZXF1aXJlKHdoZWVsQmV0IDwgV0hFRUxfU0laRSk7CgogICAgICAgIC8vIFVwZGF0ZSBnYW1lIHN0YXRlCiAgICAgICAgLy8gVGhlIHNlbmRlciBiZWNvbWVzIHBsYXllcjIKICAgICAgICBnYW1lLnN0YXRlID0gU3RhdGUuV2FpdGluZ0ZvclJldmVhbDsKICAgICAgICBnYW1lLnBsYXllcjIgPSBtc2cuc2VuZGVyOwogICAgICAgIGdhbWUud2hlZWxCZXRQbGF5ZXIyID0gd2hlZWxCZXQ7CiAgICAgICAgZ2FtZS5leHBpcmVUaW1lID0gbm93ICsgbWF4UmV2ZWFsU2Vjb25kczsgLy8gQWZ0ZXIgZXhwaXJlVGltZSB0aGUgZ2FtZSBjYW4gYmUgZXhwaXJlZAoKICAgICAgICAvLyBUaGlzIGdhbWUgaXMgbm8gbG9uZ2VyIG9wZW4sIGFuZCBpcyBub3cgYWN0aXZlIGZvciB0aGUgam9pbmVyCiAgICAgICAgYXJyYXlSZW1vdmUob3BlbkdhbWVzLCBnYW1lSWQpOwogICAgICAgIGFycmF5QWRkKHBsYXllckFjdGl2ZUdhbWVzW21zZy5zZW5kZXJdLCBnYW1lSWQpOwoKICAgICAgICAvLyBGaXJlIGV2ZW50IGZvciBwbGF5ZXIgam9pbmluZyB0aGlzIGdhbWUKICAgICAgICBHYW1lRXZlbnQoZ2FtZUlkLCBtc2cuc2VuZGVyLCBFdmVudC5Kb2luKTsKCiAgICAgICAgLy8gRmlyZSBldmVudCBmb3IgY3JlYXRvciwgbGV0dGluZyB0aGVtIGtub3cgdGhleSBuZWVkIHRvIHJldmVhbCB0aGVpciBiZXQgbm93CiAgICAgICAgR2FtZUV2ZW50KGdhbWVJZCwgZ2FtZS5wbGF5ZXIxLCBFdmVudC5TdGFydFJldmVhbCk7CiAgICB9CiAgICAKICAgIC8vLyBUaGlzIGNhbiBiZSBjYWxsZWQgYnkgdGhlIGpvaW5pbmcgcGxheWVyIHRvIGZvcmNlIHRoZSBnYW1lIHRvIGVuZCBvbmNlIHRoZSBleHBpcmUKICAgIC8vLyB0aW1lIGhhcyBiZWVuIHJlYWNoZWQuIFRoaXMgaXMgYSBzYWZldHkgbWVhc3VyZSB0byBlbnN1cmUgdGhlIGdhbWUgY2FuIGJlIGNvbXBsZXRlZAogICAgLy8vIGluIGNhc2Ugd2hlcmUgdGhlIGNyZWF0b3IgZGVjaWRlcyB0byBub3QgdG8gcmV2ZWFsIHRoZWlyIGJldC4gSW4gdGhpcyBjYXNlLCB0aGUgY3JlYXRvcgogICAgLy8vIHdpbGwgbG9zZSB0aGUgbWF4aW1hbCBhbW91bnQgb2YgdGhlaXIgYmV0CiAgICBmdW5jdGlvbiBleHBpcmVHYW1lKHVpbnQgZ2FtZUlkKSBwdWJsaWMKICAgIHsKICAgICAgICAvLyBHZXQgdGhlIGdhbWUgaW5zdGFuY2UgYW5kIGNoZWNrIHRoYXQgaXQgZXhpc3RzCiAgICAgICAgR2FtZUluc3RhbmNlIHN0b3JhZ2UgZ2FtZSA9IGdhbWVDb250ZXh0W2dhbWVJZF07CiAgICAgICAgcmVxdWlyZShnYW1lLmJldEFtb3VudEluV2VpID4gMCk7IAoKICAgICAgICAvLyBPbmx5IGV4cGlyZSBmcm9tIHRoZSBXYWl0aW5nRm9yUmV2ZWFsIHN0YXRlCiAgICAgICAgcmVxdWlyZShnYW1lLnN0YXRlID09IFN0YXRlLldhaXRpbmdGb3JSZXZlYWwpOwogICAgICAgIAogICAgICAgIC8vIEhhcyBlbm91Z2ggdGltZSBwYXNzZWQgdG8gcGVyZm9ybSB0aGlzIGFjdGlvbj8KICAgICAgICByZXF1aXJlKG5vdyA+IGdhbWUuZXhwaXJlVGltZSk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FuIG9ubHkgZXhwaXJlIHRoZSBnYW1lIGlmIHlvdSBhcmUgdGhlIHNlY29uZCBwbGF5ZXIKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZ2FtZS5wbGF5ZXIyKTsKCiAgICAgICAgLy8gUGxheWVyMSAoY3JlYXRvcikgZGlkIG5vdCByZXZlYWwgYmV0IGluIHRpbWUKICAgICAgICAvLyBDb21wbGV0ZSB0aGUgZ2FtZSBpbiBmYXZvciBvZiBwbGF5ZXIyCiAgICAgICAgZ2FtZS53aGVlbFJlc3VsdCA9IGdhbWUud2hlZWxCZXRQbGF5ZXIyOwogICAgICAgIGdhbWUud2hlZWxCZXRQbGF5ZXIxID0gKGdhbWUud2hlZWxCZXRQbGF5ZXIyICsgKFdIRUVMX1NJWkUgLyAyKSkgJSBXSEVFTF9TSVpFOwogICAgICAgIAogICAgICAgIC8vIFRoaXMgZ2FtZSBpcyBjb21wbGV0ZSwgdGhlIHdpdGhkcmF3RWFybmluZ3MgZmxvdyBjYW4gbm93IGJlIGludm9rZWQKICAgICAgICBnYW1lLnN0YXRlID0gU3RhdGUuQ29tcGxldGU7CgogICAgICAgIC8vIEZpcmUgYW4gZXZlbnQgZm9yIHRoZSBwbGF5ZXIgZm9yY2luZyB0aGlzIGdhbWUgdG8gZW5kCiAgICAgICAgR2FtZUV2ZW50KGdhbWVJZCwgZ2FtZS5wbGF5ZXIxLCBFdmVudC5FeHBpcmUpOwogICAgICAgIEdhbWVFdmVudChnYW1lSWQsIGdhbWUucGxheWVyMiwgRXZlbnQuRXhwaXJlKTsKICAgIH0KICAgIAogICAgLy8vIE9uY2UgYSBwbGF5ZXIgaGFzIGpvaW5lZCB0aGUgZ2FtZSwgdGhlIGNyZWF0b3IgbXVzdCByZXZlYWwgdGhlaXIgYmV0CiAgICAvLy8gYnkgcHJvdmlkaW5nIHRoZSBzYW1lIHBsYXllclNlY3JldCB0aGF0IHdhcyBwYXNzZWQgdG8gY3JlYXRlR2FtZSguLi4pCiAgICBmdW5jdGlvbiByZXZlYWxCZXQodWludCBnYW1lSWQsIHVpbnQgcGxheWVyU2VjcmV0KSBwdWJsaWMKICAgIHsKICAgICAgICAvLyBHZXQgdGhlIGdhbWUgaW5zdGFuY2UgYW5kIGNoZWNrIHRoYXQgaXQgZXhpc3RzCiAgICAgICAgR2FtZUluc3RhbmNlIHN0b3JhZ2UgZ2FtZSA9IGdhbWVDb250ZXh0W2dhbWVJZF07CiAgICAgICAgcmVxdWlyZShnYW1lLmJldEFtb3VudEluV2VpID4gMCk7IAoKICAgICAgICAvLyBXZSBjYW4gb25seSByZXZlYWwgYmV0cyBkdXJpbmcgdGhlIHJldmVhbGluZyBiZXRzIHN0YXRlCiAgICAgICAgcmVxdWlyZShnYW1lLnN0YXRlID09IFN0YXRlLldhaXRpbmdGb3JSZXZlYWwpOwoKICAgICAgICAvLyBPbmx5IHRoZSBjcmVhdG9yIGRvZXMgdGhpcwogICAgICAgIHJlcXVpcmUoZ2FtZS5wbGF5ZXIxID09IG1zZy5zZW5kZXIpOwoKICAgICAgICB1aW50IGk7IC8vIExvb3AgY291bnRlciB1c2VkIGJlbG93CgogICAgICAgIC8vIEZpbmQgdGhlIHdoZWVsQmV0IHRoZSBwbGF5ZXIgbWFkZSBieSBlbnVtZXJhdGluZyB0aGUgaGFzaAogICAgICAgIC8vIHBvc3NpYmlsaXRpZXMuIEl0IGlzIGRvbmUgdGhpcyB3YXkgc28gdGhlIHBsYXllciBvbmx5IGhhcyB0bwogICAgICAgIC8vIHJlbWVtYmVyIHRoZWlyIHNlY3JldCBpbiBvcmRlciB0byByZXZlbCB0aGUgYmV0CiAgICAgICAgZm9yKGkgPSAwOyBpIDwgV0hFRUxfU0laRTsgKytpKQogICAgICAgIHsKICAgICAgICAgICAgLy8gRmluZCB0aGUgYmV0IHRoYXQgd2FzIHByb3ZpZGVkIGluIGNyZWF0ZUdhbWUoLi4uKQogICAgICAgICAgICBpZihjcmVhdGVXaGVlbEJldEhhc2goZ2FtZUlkLCBpLCBwbGF5ZXJTZWNyZXQpID09IGdhbWUud2hlZWxCZXRQbGF5ZXIxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGJldCB0byB0aGUgcmV2ZWFsZWQgdmFsdWUKICAgICAgICAgICAgICAgIGdhbWUud2hlZWxCZXRQbGF5ZXIxID0gaTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBzdWNjZXNzZnVsbHkgcmV2ZWFsZWQgdGhlIGJldCwgb3RoZXJ3aXNlCiAgICAgICAgLy8gdGhlIHBsYXllclNlY3JldCB3YXMgaW52YWxpZAogICAgICAgIHJlcXVpcmUoaSA8IFdIRUVMX1NJWkUpOwogICAgICAgIAogICAgICAgIC8vIEZpcmUgYW4gZXZlbnQgZm9yIHRoZSByZXZlYWxpbmcgb2YgdGhlIGJldAogICAgICAgIEdhbWVFdmVudChnYW1lSWQsIG1zZy5zZW5kZXIsIEV2ZW50LlJldmVhbCk7CgogICAgICAgIC8vIFVzZSB0aGUgcmV2ZWFsZWQgYmV0cyB0byBjYWxjdWxhdGUgdGhlIHdoZWVsUmVzdWx0CiAgICAgICAgLy8gTk9URTogTmVpdGhlciBwbGF5ZXIga25ldyB0aGUgdW5yZXZlYWxlZCBzdGF0ZSBvZiBib3RoIGJldHMgd2hlbiBtYWtpbmcgdGhlaXIKICAgICAgICAvLyBiZXQsIHNvIHRoZSBjb21iaW5hdGlvbiBjYW4gYmUgdXNlZCB0byBnZW5lcmF0ZSBhIHJhbmRvbSBudW1iZXIgbmVpdGhlciBwbGF5ZXIgY291bGQgYW50aWNpcGF0ZS4KICAgICAgICAvLyBUaGlzIGFsZ29yaXRobSB3YXMgdGVzdGVkIGZvciBnb29kIG91dGNvbWUgZGlzdHJpYnV0aW9uIGZvciBhcmJpdHJhcnkgaGFzaCB2YWx1ZXMKICAgICAgICB1aW50MjU2IGhhc2hSZXN1bHQgPSB1aW50MjU2KGtlY2NhazI1NihnYW1lSWQsIG5vdywgZ2FtZS53aGVlbEJldFBsYXllcjEsIGdhbWUud2hlZWxCZXRQbGF5ZXIyKSk7CiAgICAgICAgdWludDMyIHJhbmRvbVNlZWQgPSB1aW50MzIoaGFzaFJlc3VsdCA+PiAwKQogICAgICAgICAgICAgICAgICAgICAgICAgIF4gdWludDMyKGhhc2hSZXN1bHQgPj4gMzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgXiB1aW50MzIoaGFzaFJlc3VsdCA+PiA2NCkKICAgICAgICAgICAgICAgICAgICAgICAgICBeIHVpbnQzMihoYXNoUmVzdWx0ID4+IDk2KQogICAgICAgICAgICAgICAgICAgICAgICAgIF4gdWludDMyKGhhc2hSZXN1bHQgPj4gMTI4KQogICAgICAgICAgICAgICAgICAgICAgICAgIF4gdWludDMyKGhhc2hSZXN1bHQgPj4gMTYwKQogICAgICAgICAgICAgICAgICAgICAgICAgIF4gdWludDMyKGhhc2hSZXN1bHQgPj4gMTkyKQogICAgICAgICAgICAgICAgICAgICAgICAgIF4gdWludDMyKGhhc2hSZXN1bHQgPj4gMjI0KTsKCiAgICAgICAgdWludDMyIHJhbmRvbU51bWJlciA9IHJhbmRvbVNlZWQ7CiAgICAgICAgdWludDMyIHJhbmRNYXggPSAweEZGRkZGRkZGOyAvLyBXZSB1c2UgdGhlIHdob2xlIDMyIGJpdCByYW5nZQoKICAgICAgICAvLyBHZW5lcmF0ZSByYW5kb20gbnVtYmVycyB1bnRpbCB3ZSBnZXQgYSB2YWx1ZSBpbiB0aGUgdW5iaWFzZWQgcmFuZ2UgKHNlZSBiZWxvdykKICAgICAgICBkbwogICAgICAgIHsKICAgICAgICAgICAgcmFuZG9tTnVtYmVyIF49IChyYW5kb21OdW1iZXIgPj4gMTEpOwogICAgICAgICAgICByYW5kb21OdW1iZXIgXj0gKHJhbmRvbU51bWJlciA8PCA3KSAmIDB4OUQyQzU2ODA7CiAgICAgICAgICAgIHJhbmRvbU51bWJlciBePSAocmFuZG9tTnVtYmVyIDw8IDE1KSAmIDB4RUZDNjAwMDA7CiAgICAgICAgICAgIHJhbmRvbU51bWJlciBePSAocmFuZG9tTnVtYmVyID4+IDE4KTsKICAgICAgICB9CiAgICAgICAgLy8gU2luY2UgV0hFRUxfU0laRSBpcyBub3QgZGl2aXNpYmxlIGJ5IHJhbmRNYXgsIHVzaW5nIG1vZHVsbyBiZWxvdyB3aWxsIGludHJvZHVjZSBiaWFzIGZvcgogICAgICAgIC8vIG51bWJlcnMgYXQgdGhlIGVuZCBvZiB0aGUgcmFuZE1heCByYW5nZS4gVG8gcmVtZWR5IHRoaXMsIHdlIGRpc2NhcmQgdGhlc2Ugb3V0IG9mIHJhbmdlIG51bWJlcnMKICAgICAgICAvLyBhbmQgZ2VuZXJhdGUgYWRkaXRpb25hbCBudW1iZXJzIHVudGlsIHdlIGFyZSBpbiB0aGUgbGFyZ2VzdCByYW5nZSBkaXZpc2JsZSBieSBXSEVFTF9TSVpFLgogICAgICAgIC8vIFRoaXMgcmFuZ2Ugd2lsbCBlbnN1cmUgd2UgZG8gbm90IGludHJvZHVjZSBhbnkgbW9kdWxvIGJpYXMKICAgICAgICB3aGlsZShyYW5kb21OdW1iZXIgPj0gKHJhbmRNYXggLSAocmFuZE1heCAlIFdIRUVMX1NJWkUpKSk7CgogICAgICAgIC8vIFVwZGF0ZSBnYW1lIHN0YXRlICAgICAgICAKICAgICAgICBnYW1lLndoZWVsUmVzdWx0ID0gcmFuZG9tTnVtYmVyICUgV0hFRUxfU0laRTsKICAgICAgICBnYW1lLnN0YXRlID0gU3RhdGUuQ29tcGxldGU7CiAgICAgICAgCiAgICAgICAgLy8gRmlyZSBhbiBldmVudCBmb3IgdGhlIGNvbXBsZXRpb24gb2YgdGhlIGdhbWUKICAgICAgICBHYW1lRXZlbnQoZ2FtZUlkLCBnYW1lLnBsYXllcjEsIEV2ZW50LkNvbXBsZXRlKTsKICAgICAgICBHYW1lRXZlbnQoZ2FtZUlkLCBnYW1lLnBsYXllcjIsIEV2ZW50LkNvbXBsZXRlKTsKICAgIH0KCiAgICAvLy8gQSB1dGlsaXR5IGZ1bmN0aW9uIHRvIGdldCB0aGUgbWluaW11bSBkaXN0YW5jZSBiZXR3ZWVuIHR3byBzZWxlY3Rpb25zCiAgICAvLy8gb24gYSB3aGVlbCBvZiBXSEVFTF9TSVpFIHdyYXBwaW5nIGFyb3VuZCBhdCAwCiAgICBmdW5jdGlvbiBnZXRXaGVlbERpc3RhbmNlKHVpbnQgdmFsdWUxLCB1aW50IHZhbHVlMikgcHJpdmF0ZSBwdXJlCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIHZhbHVlcyBhcmUgd2l0aGluIHJhbmdlCiAgICAgICAgcmVxdWlyZSh2YWx1ZTEgPCBXSEVFTF9TSVpFICYmIHZhbHVlMiA8IFdIRUVMX1NJWkUpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGRpc3RhbmNlIG9mIHZhbHVlMSB3aXRoIHJlc3BlY3QgdG8gdmFsdWUyCiAgICAgICAgdWludCBkaXN0MSA9IChXSEVFTF9TSVpFICsgdmFsdWUxIC0gdmFsdWUyKSAlIFdIRUVMX1NJWkU7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBkaXN0YW5jZSBnb2luZyB0aGUgb3RoZXIgd2F5IGFyb3VuZCB0aGUgd2hlZWwKICAgICAgICB1aW50IGRpc3QyID0gV0hFRUxfU0laRSAtIGRpc3QxOwoKICAgICAgICAvLyBXaGljaGV2ZXIgZGlzdGFuY2UgaXMgc2hvcnRlciBpcyB0aGUgd2hlZWwgZGlzdGFuY2UKICAgICAgICByZXR1cm4gKGRpc3QxIDwgZGlzdDIpID8gZGlzdDEgOiBkaXN0MjsKICAgIH0KCiAgICAvLy8gT25jZSB0aGUgZ2FtZSBpcyBjb21wbGV0ZSwgdXNlIHRoaXMgZnVuY3Rpb24gdG8gZ2V0IHRoZSByZXN1bHRzIG9mCiAgICAvLy8gdGhlIGdhbWUuIFJldHVybnM6CiAgICAvLy8gLSB0aGUgYW1vdW50IG9mIHdlaSBjaGFyZ2VkIGZvciB0aGUgZmVlCiAgICAvLy8gLSB0aGUgYW1vdW50IG9mIHdlaSB0byBiZSBwYWlkIG91dCB0byBwbGF5ZXIxCiAgICAvLy8gLSB0aGUgYW1vdW50IG9mIHdlaSB0byBiZSBwYWlkIG91dCB0byBwbGF5ZXIyCiAgICAvLy8gVGhlIHN1bSBvZiBhbGwgdGhlIHJldHVybiB2YWx1ZXMgaXMgZXhhY3RseSBlcXVhbCB0byB0aGUgY29udHJpYnV0aW9ucwogICAgLy8vIG9mIGJvdGggcGxheWVyIGJldHMuIGkuZS4gCiAgICAvLy8gICAgIGZlZVdlaSArIHdlaVBsYXllcjEgKyB3ZWlQbGF5ZXIyID0gMiAqIGJldEFtb3VudEluV2VpCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVFYXJuaW5ncyh1aW50IGdhbWVJZCkgcHVibGljIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IGZlZVdlaSwgdWludCB3ZWlQbGF5ZXIxLCB1aW50IHdlaVBsYXllcjIpCiAgICB7CiAgICAgICAgLy8gR2V0IHRoZSBnYW1lIGluc3RhbmNlIGFuZCBjaGVjayB0aGF0IGl0IGV4aXN0cwogICAgICAgIEdhbWVJbnN0YW5jZSBzdG9yYWdlIGdhbWUgPSBnYW1lQ29udGV4dFtnYW1lSWRdOwogICAgICAgIHJlcXVpcmUoZ2FtZS5iZXRBbW91bnRJbldlaSA+IDApOyAKCiAgICAgICAgLy8gSXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNhbGwgdGhpcyBmdW5jdGlvbiB3aGVuIHRoZSBnYW1lIGlzbid0IGNvbXBsZXRlCiAgICAgICAgcmVxdWlyZShnYW1lLnN0YXRlID09IFN0YXRlLkNvbXBsZXRlKTsKICAgICAgICAKICAgICAgICB1aW50IGRpc3RhbmNlUGxheWVyMSA9IGdldFdoZWVsRGlzdGFuY2UoZ2FtZS53aGVlbEJldFBsYXllcjEsIGdhbWUud2hlZWxSZXN1bHQpOwogICAgICAgIHVpbnQgZGlzdGFuY2VQbGF5ZXIyID0gZ2V0V2hlZWxEaXN0YW5jZShnYW1lLndoZWVsQmV0UGxheWVyMiwgZ2FtZS53aGVlbFJlc3VsdCk7CgogICAgICAgIC8vIE91dGNvbWUgaWYgdGhlcmUgaXMgYSB0aWUKICAgICAgICBmZWVXZWkgPSAwOwogICAgICAgIHdlaVBsYXllcjEgPSBnYW1lLmJldEFtb3VudEluV2VpOwogICAgICAgIHdlaVBsYXllcjIgPSBnYW1lLmJldEFtb3VudEluV2VpOwoKICAgICAgICB1aW50IHdpbkRpc3QgPSAwOwogICAgICAgIHVpbnQgd2luV2VpID0gMDsKICAgICAgICAKICAgICAgICAvLyBQbGF5ZXIgb25lIHdhcyBjbG9zZXIsIHNvIHRoZXkgd29uCiAgICAgICAgaWYoZGlzdGFuY2VQbGF5ZXIxIDwgZGlzdGFuY2VQbGF5ZXIyKQogICAgICAgIHsKICAgICAgICAgICAgd2luRGlzdCA9IGRpc3RhbmNlUGxheWVyMiAtIGRpc3RhbmNlUGxheWVyMTsKICAgICAgICAgICAgd2luV2VpID0gZ2FtZS5iZXRBbW91bnRJbldlaSAqICh3aW5EaXN0ICogV0lOX1BFUkNFTlRfUEVSX0RJU1RBTkNFKSAvIDEwMDsKCiAgICAgICAgICAgIGZlZVdlaSA9IHdpbldlaSAqIEZFRV9QRVJDRU5UIC8gMTAwOwogICAgICAgICAgICB3ZWlQbGF5ZXIxICs9IHdpbldlaSAtIGZlZVdlaTsKICAgICAgICAgICAgd2VpUGxheWVyMiAtPSB3aW5XZWk7CiAgICAgICAgfQogICAgICAgIC8vIFBsYXllciB0d28gd2FzIGNsb3Nlciwgc28gdGhleSB3b24KICAgICAgICBlbHNlIGlmKGRpc3RhbmNlUGxheWVyMiA8IGRpc3RhbmNlUGxheWVyMSkKICAgICAgICB7CiAgICAgICAgICAgIHdpbkRpc3QgPSBkaXN0YW5jZVBsYXllcjEgLSBkaXN0YW5jZVBsYXllcjI7CiAgICAgICAgICAgIHdpbldlaSA9IGdhbWUuYmV0QW1vdW50SW5XZWkgKiAod2luRGlzdCAqIFdJTl9QRVJDRU5UX1BFUl9ESVNUQU5DRSkgLyAxMDA7CgogICAgICAgICAgICBmZWVXZWkgPSB3aW5XZWkgKiBGRUVfUEVSQ0VOVCAvIDEwMDsKICAgICAgICAgICAgd2VpUGxheWVyMiArPSB3aW5XZWkgLSBmZWVXZWk7CiAgICAgICAgICAgIHdlaVBsYXllcjEgLT0gd2luV2VpOwogICAgICAgIH0KICAgICAgICAvLyBTYW1lIGRpc3RhbmNlLCBzbyBpdCB3YXMgYSB0aWUgKHNlZSBhYm92ZSkKICAgIH0KICAgIAogICAgLy8vIE9uY2UgdGhlIGdhbWUgaXMgY29tcGxldGUsIGVhY2ggcGxheWVyIGNhbiB3aXRoZHJhdyB0aGVpciBlYXJuaW5ncwogICAgLy8vIEEgZmVlIGlzIGNoYXJnZWQgb24gd2lubmluZ3Mgb25seSBhbmQgcHJvdmlkZWQgdG8gdGhlIGNvbnRyYWN0IGF1dGhvcml0eQogICAgZnVuY3Rpb24gd2l0aGRyYXdFYXJuaW5ncyh1aW50IGdhbWVJZCkgcHVibGljCiAgICB7CiAgICAgICAgLy8gR2V0IHRoZSBnYW1lIGluc3RhbmNlIGFuZCBjaGVjayB0aGF0IGl0IGV4aXN0cwogICAgICAgIEdhbWVJbnN0YW5jZSBzdG9yYWdlIGdhbWUgPSBnYW1lQ29udGV4dFtnYW1lSWRdOwogICAgICAgIHJlcXVpcmUoZ2FtZS5iZXRBbW91bnRJbldlaSA+IDApOyAKCiAgICAgICAgcmVxdWlyZShnYW1lLnN0YXRlID09IFN0YXRlLkNvbXBsZXRlKTsKICAgICAgICAKICAgICAgICB2YXIgKGZlZVdlaSwgd2VpUGxheWVyMSwgd2VpUGxheWVyMikgPSBjYWxjdWxhdGVFYXJuaW5ncyhnYW1lSWQpOwoKICAgICAgICBib29sIHBheUZlZSA9IGZhbHNlOwogICAgICAgIHVpbnQgd2l0aGRyYXdBbW91bnQgPSAwOwoKICAgICAgICBpZihnYW1lLnBsYXllcjEgPT0gbXNnLnNlbmRlcikKICAgICAgICB7CiAgICAgICAgICAgIC8vIENhbid0IGhhdmUgYWxyZWFkeSB3aXRocmF3bgogICAgICAgICAgICByZXF1aXJlKGdhbWUud2l0aGRyYXduUGxheWVyMSA9PSBmYWxzZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBnYW1lLndpdGhkcmF3blBsYXllcjEgPSB0cnVlOyAvLyBUaGV5IGNhbid0IHdpdGhkcmF3IGFnYWluCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBwbGF5ZXIxIHdhcyB0aGUgd2lubmVyLCB0aGV5IHdpbGwgcGF5IHRoZSBmZWUKICAgICAgICAgICAgaWYod2VpUGxheWVyMSA+IHdlaVBsYXllcjIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHBheUZlZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGhkcmF3QW1vdW50ID0gd2VpUGxheWVyMTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihnYW1lLnBsYXllcjIgPT0gbXNnLnNlbmRlcikKICAgICAgICB7CiAgICAgICAgICAgIC8vIENhbid0IGhhdmUgYWxyZWFkeSB3aXRocmF3bgogICAgICAgICAgICByZXF1aXJlKGdhbWUud2l0aGRyYXduUGxheWVyMiA9PSBmYWxzZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBnYW1lLndpdGhkcmF3blBsYXllcjIgPSB0cnVlOwoKICAgICAgICAgICAgLy8gSWYgcGxheWVyMiB3YXMgdGhlIHdpbm5lciwgdGhleSB3aWxsIHBheSB0aGUgZmVlCiAgICAgICAgICAgIGlmKHdlaVBsYXllcjIgPiB3ZWlQbGF5ZXIxKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwYXlGZWUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoZHJhd0Ftb3VudCA9IHdlaVBsYXllcjI7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIC8vIFRoZSBzZW5kZXIgaXNuJ3QgYSBwYXJ0aWNpcGFudAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgZ2FtZSBpcyBubyBsb25nZXIgYWN0aXZlIGZvciB0aGlzIHBsYXllciwgYW5kIG5vdyBtb3ZlZCB0byBjb21wbGV0ZSBmb3IgdGhpcyBwbGF5ZXIKICAgICAgICBhcnJheVJlbW92ZShwbGF5ZXJBY3RpdmVHYW1lc1ttc2cuc2VuZGVyXSwgZ2FtZUlkKTsKICAgICAgICBhcnJheUFkZChwbGF5ZXJDb21wbGV0ZUdhbWVzW21zZy5zZW5kZXJdLCBnYW1lSWQpOwoKICAgICAgICAvLyBGaXJlIGFuIGV2ZW50IGZvciB0aGUgd2l0aGRyYXdpbmcgb2YgZnVuZHMKICAgICAgICBHYW1lRXZlbnQoZ2FtZUlkLCBtc2cuc2VuZGVyLCBFdmVudC5XaXRoZHJhdyk7CgogICAgICAgIC8vIFBheSB0aGUgZmVlLCBpZiBuZWNlc3NhcnkKICAgICAgICBpZihwYXlGZWUgPT0gdHJ1ZSkKICAgICAgICB7CiAgICAgICAgICAgIGF1dGhvcml0eS50cmFuc2ZlcihmZWVXZWkpOwogICAgICAgIH0KICAgIAogICAgICAgIC8vIFRyYW5zZmVyIHNlbmRlciB0aGVpciBvdXRjb21lCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih3aXRoZHJhd0Ftb3VudCk7CiAgICB9Cn0='.
	

]
