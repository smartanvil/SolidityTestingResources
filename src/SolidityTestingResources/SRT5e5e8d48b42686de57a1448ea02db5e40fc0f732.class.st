Class {
	#name : #SRT5e5e8d48b42686de57a1448ea02db5e40fc0f732,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5e5e8d48b42686de57a1448ea02db5e40fc0f732 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpjb250cmFjdCBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Ci8qKgogKiBAdGl0bGUgU2FmZUVSQzIwCiAqIEBkZXYgV3JhcHBlcnMgYXJvdW5kIEVSQzIwIG9wZXJhdGlvbnMgdGhhdCB0aHJvdyBvbiBmYWlsdXJlLgogKiBUbyB1c2UgdGhpcyBsaWJyYXJ5IHlvdSBjYW4gYWRkIGEgYHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjA7YCBzdGF0ZW1lbnQgdG8geW91ciBjb250cmFjdCwKICogd2hpY2ggYWxsb3dzIHlvdSB0byBjYWxsIHRoZSBzYWZlIG9wZXJhdGlvbnMgYXMgYHRva2VuLnNhZmVUcmFuc2ZlciguLi4pYCwgZXRjLgogKi8KbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KfQovKioKICogQHRpdGxlIEtZQwogKiBAZGV2IEtZQyBjb250cmFjdCBoYW5kbGVzIHRoZSB3aGl0ZSBsaXN0IGZvciBBU1RDcm93ZHNhbGUgY29udHJhY3QKICogT25seSBhY2NvdW50cyByZWdpc3RlcmVkIGluIEtZQyBjb250cmFjdCBjYW4gYnV5IEFTVCB0b2tlbi4KICogQWRtaW5zIGNhbiByZWdpc3RlciBhY2NvdW50LCBhbmQgdGhlIHJlYXNvbiB3aHkKICovCmNvbnRyYWN0IEtZQyBpcyBPd25hYmxlIHsKICAvLyBjaGVjayB0aGUgYWRkcmVzcyBpcyByZWdpc3RlcmVkIGZvciB0b2tlbiBzYWxlCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgcmVnaXN0ZXJlZEFkZHJlc3M7CiAgLy8gY2hlY2sgdGhlIGFkZHJlc3MgaXMgYWRtaW4gb2Yga3ljIGNvbnRyYWN0CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgYWRtaW47CiAgZXZlbnQgUmVnaXN0ZXJlZChhZGRyZXNzIGluZGV4ZWQgX2FkZHIpOwogIGV2ZW50IFVucmVnaXN0ZXJlZChhZGRyZXNzIGluZGV4ZWQgX2FkZHIpOwogIGV2ZW50IE5ld0FkbWluKGFkZHJlc3MgaW5kZXhlZCBfYWRkcik7CiAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBvd25lciwgdWludDI1NiBiYWxhbmNlKTsKICAvKioKICAgKiBAZGV2IGNoZWNrIHdoZXRoZXIgdGhlIGFkZHJlc3MgaXMgcmVnaXN0ZXJlZCBmb3IgdG9rZW4gc2FsZSBvciBub3QuCiAgICogQHBhcmFtIF9hZGRyIGFkZHJlc3MKICAgKi8KICBtb2RpZmllciBvbmx5UmVnaXN0ZXJlZChhZGRyZXNzIF9hZGRyKSB7CiAgICByZXF1aXJlKHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyXSk7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IGNoZWNrIHdoZXRoZXIgdGhlIG1zZy5zZW5kZXIgaXMgYWRtaW4gb3Igbm90CiAgICovCiAgbW9kaWZpZXIgb25seUFkbWluKCkgewogICAgcmVxdWlyZShhZG1pblttc2cuc2VuZGVyXSk7CiAgICBfOwogIH0KICBmdW5jdGlvbiBLWUMoKSB7CiAgICBhZG1pblttc2cuc2VuZGVyXSA9IHRydWU7CiAgfQogIC8qKgogICAqIEBkZXYgc2V0IG5ldyBhZG1pbiBhcyBhZG1pbiBvZiBLWUMgY29udHJhY3QKICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBzZXQgYXMgYWRtaW4gb2YgS1lDIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gc2V0QWRtaW4oYWRkcmVzcyBfYWRkcikKICAgIHB1YmxpYwogICAgb25seU93bmVyCiAgewogICAgcmVxdWlyZShfYWRkciAhPSBhZGRyZXNzKDApICYmIGFkbWluW19hZGRyXSA9PSBmYWxzZSk7CiAgICBhZG1pbltfYWRkcl0gPSB0cnVlOwogICAgTmV3QWRtaW4oX2FkZHIpOwogIH0KICAvKioKICAgKiBAZGV2IHJlZ2lzdGVyIHRoZSBhZGRyZXNzIGZvciB0b2tlbiBzYWxlCiAgICogQHBhcmFtIF9hZGRyIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gcmVnaXN0ZXIgZm9yIHRva2VuIHNhbGUKICAgKi8KICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzIF9hZGRyKQogICAgcHVibGljCiAgICBvbmx5QWRtaW4KICB7CiAgICByZXF1aXJlKF9hZGRyICE9IGFkZHJlc3MoMCkgJiYgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJdID09IGZhbHNlKTsKICAgIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyXSA9IHRydWU7CiAgICBSZWdpc3RlcmVkKF9hZGRyKTsKICB9CiAgLyoqCiAgICogQGRldiByZWdpc3RlciB0aGUgYWRkcmVzc2VzIGZvciB0b2tlbiBzYWxlCiAgICogQHBhcmFtIF9hZGRycyBhZGRyZXNzW10gVGhlIGFkZHJlc3NlcyB0byByZWdpc3RlciBmb3IgdG9rZW4gc2FsZQogICAqLwogIGZ1bmN0aW9uIHJlZ2lzdGVyQnlMaXN0KGFkZHJlc3NbXSBfYWRkcnMpCiAgICBwdWJsaWMKICAgIG9ubHlBZG1pbgogIHsKICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgX2FkZHJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlcXVpcmUoX2FkZHJzW2ldICE9IGFkZHJlc3MoMCkgJiYgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJzW2ldXSA9PSBmYWxzZSk7CiAgICAgIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyc1tpXV0gPSB0cnVlOwogICAgICBSZWdpc3RlcmVkKF9hZGRyc1tpXSk7CiAgICB9CiAgfQogIC8qKgogICAqIEBkZXYgdW5yZWdpc3RlciB0aGUgcmVnaXN0ZXJlZCBhZGRyZXNzCiAgICogQHBhcmFtIF9hZGRyIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdW5yZWdpc3RlciBmb3IgdG9rZW4gc2FsZQogICAqLwogIGZ1bmN0aW9uIHVucmVnaXN0ZXIoYWRkcmVzcyBfYWRkcikKICAgIHB1YmxpYwogICAgb25seUFkbWluCiAgICBvbmx5UmVnaXN0ZXJlZChfYWRkcikKICB7CiAgICByZWdpc3RlcmVkQWRkcmVzc1tfYWRkcl0gPSBmYWxzZTsKICAgIFVucmVnaXN0ZXJlZChfYWRkcik7CiAgfQogIC8qKgogICAqIEBkZXYgdW5yZWdpc3RlciB0aGUgcmVnaXN0ZXJlZCBhZGRyZXNzZXMKICAgKiBAcGFyYW0gX2FkZHJzIGFkZHJlc3NbXSBUaGUgYWRkcmVzc2VzIHRvIHVucmVnaXN0ZXIgZm9yIHRva2VuIHNhbGUKICAgKi8KICBmdW5jdGlvbiB1bnJlZ2lzdGVyQnlMaXN0KGFkZHJlc3NbXSBfYWRkcnMpCiAgICBwdWJsaWMKICAgIG9ubHlBZG1pbgogIHsKICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgX2FkZHJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlcXVpcmUocmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJzW2ldXSk7CiAgICAgIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyc1tpXV0gPSBmYWxzZTsKICAgICAgVW5yZWdpc3RlcmVkKF9hZGRyc1tpXSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBFUkMyMEJhc2ljIHRva2VuID0gRVJDMjBCYXNpYyhfdG9rZW4pOwogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIG93bmVyLCBiYWxhbmNlKTsKICB9Cn0KLyoKICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCi8vLyBAdGl0bGUgTWluaU1lVG9rZW4gQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIHRva2VuIGNvbnRyYWN0J3MgZ29hbCBpcyB0byBtYWtlIGl0IGVhc3kgZm9yIGFueW9uZSB0byBjbG9uZSB0aGlzCi8vLyAgdG9rZW4gdXNpbmcgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBhdCBhIGdpdmVuIGJsb2NrLCB0aGlzIHdpbGwgYWxsb3cgREFPJ3MKLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQKLy8vICBhZmZlY3RpbmcgdGhlIG9yaWdpbmFsIHRva2VuCi8vLyBAZGV2IEl0IGlzIEVSQzIwIGNvbXBsaWFudCwgYnV0IHN0aWxsIG5lZWRzIHRvIHVuZGVyIGdvIGZ1cnRoZXIgdGVzdGluZy4KY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwKICAgIC8vLyAgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xsZXIpOyBfOyB9CiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwogICAgZnVuY3Rpb24gQ29udHJvbGxlZCgpIHB1YmxpYyB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KLy8vIEBkZXYgVGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QgbXVzdCBpbXBsZW1lbnQgdGhlc2UgZnVuY3Rpb25zCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcHVibGljIHBheWFibGUgcmV0dXJucyhib29sKTsKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMKICAgICAgICByZXR1cm5zKGJvb2wpOwp9CmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4yJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwogICAgICAgIC8vIGB2YWx1ZWAgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBibG9jayBudW1iZXIKICAgICAgICB1aW50MTI4IHZhbHVlOwogICAgfQogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CiAgICAvLyBgY3JlYXRpb25CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBDbG9uZSBUb2tlbiB3YXMgY3JlYXRlZAogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuCiAgICBDaGVja3BvaW50W10gdG90YWxTdXBwbHlIaXN0b3J5OwogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7Ci8vLy8vLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyB7CiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOwogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGVjaW1hbHMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbAogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsKICAgICAgICBwYXJlbnRTbmFwU2hvdEJsb2NrID0gX3BhcmVudFNuYXBTaG90QmxvY2s7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7CiAgICB9Ci8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0CiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudAogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUKICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CiAgICAvLy8gQGRldiBUaGlzIGlzIHRoZSBhY3R1YWwgdHJhbnNmZXIgZnVuY3Rpb24gaW4gdGhlIHRva2VuIGNvbnRyYWN0LCBpdCBjYW4KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQogICAgICAgICAgIHJlcXVpcmUocGFyZW50U25hcFNob3RCbG9jayA8IGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgLy8gRG8gbm90IGFsbG93IHRyYW5zZmVyIHRvIDB4MCBvciB0aGUgdG9rZW4gY29udHJhY3QgaXRzZWxmCiAgICAgICAgICAgcmVxdWlyZSgoX3RvICE9IDApICYmIChfdG8gIT0gYWRkcmVzcyh0aGlzKSkpOwogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKTsKICAgICAgICAgICB9CiAgICAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlKChfYW1vdW50ID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YKICAgICAgICAvLyAgdGhpcyB0b2tlbgogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudAogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLgogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIG5ldyBjbG9uZSB0b2tlbiB3aXRoIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBiZWluZwogICAgLy8vICB0aGlzIHRva2VuIGF0IGBfc25hcHNob3RCbG9ja2AKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9jbG9uZURlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5TeW1ib2wgU3ltYm9sIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcwogICAgLy8vICBjb3BpZWQgdG8gc2V0IHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbmV3IGNsb25lIHRva2VuOwogICAgLy8vICBpZiB0aGUgYmxvY2sgaXMgemVybyB0aGFuIHRoZSBhY3R1YWwgYmxvY2ssIHRoZSBjdXJyZW50IGJsb2NrIGlzIHVzZWQKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApIHB1YmxpYyByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3NuYXBzaG90QmxvY2sgPT0gMCkgX3NuYXBzaG90QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgICAgICBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KLy8vLy8vLy8vLy8vLy8vLwovLyBHZW5lcmF0ZSBhbmQgZGVzdHJveSB0b2tlbnMKLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgR2VuZXJhdGVzIGBfYW1vdW50YCB0b2tlbnMgdGhhdCBhcmUgYXNzaWduZWQgdG8gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSBhc3NpZ25lZCB0aGUgbmV3IHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgZ2VuZXJhdGVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGdlbmVyYXRlZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCA+PSBjdXJUb3RhbFN1cHBseSk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgPj0gX2Ftb3VudCk7CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VGcm9tID49IF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Ci8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgIH0KLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKICAgICAgICAvLyBTaG9ydGN1dCBmb3IgdGhlIGFjdHVhbCB2YWx1ZQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykKICAgICAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS52YWx1ZTsKICAgICAgICBpZiAoX2Jsb2NrIDwgY2hlY2twb2ludHNbMF0uZnJvbUJsb2NrKSByZXR1cm4gMDsKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemU+MDsKICAgIH0KICAgIC8vLyBAZGV2IEhlbHBlciBmdW5jdGlvbiB0byByZXR1cm4gYSBtaW4gYmV0d2VuIHRoZSB0d28gdWludHMKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgcHVyZSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgfQovLy8vLy8vLy8vCi8vIFNhZmV0eSBNZXRob2RzCi8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9Ci8vLy8vLy8vLy8vLy8vLy8KLy8gRXZlbnRzCi8vLy8vLy8vLy8vLy8vLy8KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOwogICAgZXZlbnQgQXBwcm92YWwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9vd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICAgICAgKTsKfQovLy8vLy8vLy8vLy8vLy8vCi8vIE1pbmlNZVRva2VuRmFjdG9yeQovLy8vLy8vLy8vLy8vLy8vCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCB0byBnZW5lcmF0ZSBjbG9uZSBjb250cmFjdHMgZnJvbSBhIGNvbnRyYWN0LgovLy8gIEluIHNvbGlkaXR5IHRoaXMgaXMgdGhlIHdheSB0byBjcmVhdGUgYSBjb250cmFjdCBmcm9tIGEgY29udHJhY3Qgb2YgdGhlCi8vLyAgc2FtZSBjbGFzcwpjb250cmFjdCBNaW5pTWVUb2tlbkZhY3RvcnkgewogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gbmV3VG9rZW47CiAgICB9Cn0KY29udHJhY3QgQVRDIGlzIE1pbmlNZVRva2VuIHsKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBibGFja2xpc3RlZDsKICBib29sIHB1YmxpYyBnZW5lcmF0ZUZpbmlzaGVkOwogIC8vIEBkZXYgQVRDIGNvbnN0cnVjdG9yIGp1c3QgcGFyYW1ldHJpemVzIHRoZSBNaW5pTWVUb2tlbiBjb25zdHJ1Y3RvcgogIGZ1bmN0aW9uIEFUQyhhZGRyZXNzIF90b2tlbkZhY3RvcnkpCiAgICAgICAgICBNaW5pTWVUb2tlbigKICAgICAgICAgICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAgICAgICAgIDB4MCwgICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gc25hcHNob3QgYmxvY2sgbnVtYmVyIGZyb20gcGFyZW50CiAgICAgICAgICAgICAgIkFUQ29uIFRva2VuIiwgIC8vIFRva2VuIG5hbWUKICAgICAgICAgICAgICAxOCwgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMKICAgICAgICAgICAgICAiQVRDIiwgICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sCiAgICAgICAgICAgICAgZmFsc2UgICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgdHJhbnNmZXJzCiAgICAgICAgICApIHt9CiAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgICApIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShnZW5lcmF0ZUZpbmlzaGVkID09IGZhbHNlKTsKICAgICAgICAvL2NoZWNrIG1zZy5zZW5kZXIgKGNvbnRyb2xsZXIgPz8pCiAgICAgICAgcmV0dXJuIHN1cGVyLmdlbmVyYXRlVG9rZW5zKF9vd25lciwgX2Ftb3VudCk7CiAgICAgIH0KICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGJsYWNrbGlzdGVkW19mcm9tXSA9PSBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHN1cGVyLmRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICAgIH0KICBmdW5jdGlvbiBmaW5pc2hHZW5lcmF0aW5nKCkgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgZ2VuZXJhdGVGaW5pc2hlZCA9IHRydWU7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gYmxhY2tsaXN0QWNjb3VudChhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGJsYWNrbGlzdGVkW3Rva2VuT3duZXJdID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiB1bkJsYWNrbGlzdEFjY291bnQoYWRkcmVzcyB0b2tlbk93bmVyKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBibGFja2xpc3RlZFt0b2tlbk93bmVyXSA9IGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Ci8qKgogKiBAdGl0bGUgUmVmdW5kVmF1bHQKICogQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgZm9yIHN0b3JpbmcgZnVuZHMgd2hpbGUgYSBjcm93ZHNhbGUKICogaXMgaW4gcHJvZ3Jlc3MuIFN1cHBvcnRzIHJlZnVuZGluZyB0aGUgbW9uZXkgaWYgY3Jvd2RzYWxlIGZhaWxzLAogKiBhbmQgZm9yd2FyZGluZyBpdCBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bC4KICovCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUsIFNhZmVNYXRoewogIGVudW0gU3RhdGUgeyBBY3RpdmUsIFJlZnVuZGluZywgQ2xvc2VkIH0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcmVmdW5kZWQ7CiAgU3RhdGUgcHVibGljIHN0YXRlOwogIGFkZHJlc3NbXSBwdWJsaWMgcmVzZXJ2ZVdhbGxldDsKICBldmVudCBDbG9zZWQoKTsKICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwogIC8qKgogICAqIEBkZXYgVGhpcyBjb25zdHJ1Y3RvciBzZXRzIHRoZSBhZGRyZXNzZXMgb2YKICAgKiAxMCByZXNlcnZlIHdhbGxldHMuCiAgICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAgICogQHBhcmFtIF9yZXNlcnZlV2FsbGV0IGFkZHJlc3NbNV0gVGhlIGFkZHJlc3NlcyBvZiByZXNlcnZlIHdhbGxldC4KICAgKi8KICBmdW5jdGlvbiBSZWZ1bmRWYXVsdChhZGRyZXNzW10gX3Jlc2VydmVXYWxsZXQpIHsKICAgIHN0YXRlID0gU3RhdGUuQWN0aXZlOwogICAgcmVzZXJ2ZVdhbGxldCA9IF9yZXNlcnZlV2FsbGV0OwogIH0KICAvKioKICAgKiBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gdXNlciBidXkgdG9rZW5zLiBPbmx5IFJlZnVuZFZhdWx0CiAgICogY29udHJhY3Qgc3RvcmVzIHRoZSBFdGhlciB1c2VyIHNlbnQgd2hpY2ggZm9yd2FyZGVkIGZyb20gY3Jvd2RzYWxlCiAgICogY29udHJhY3QuCiAgICogQHBhcmFtIGludmVzdG9yIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hvIGJ1eSB0aGUgdG9rZW4gZnJvbSBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBvbmx5T3duZXIgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gYWRkKGRlcG9zaXRlZFtpbnZlc3Rvcl0sIG1zZy52YWx1ZSk7CiAgfQogIGV2ZW50IFRyYW5zZmVycmVkKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSk7CiAgLyoqCiAgICogQGRldiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGNyb3dkc2FsZSBpcyBzdWNjZXNzZnVsbHkgZmluYWxpemVkLgogICAqLwogIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuQ2xvc2VkOwogICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgdWludDI1NiByZXNlcnZlQW1vdW50Rm9yRWFjaCA9IGRpdihiYWxhbmNlLCByZXNlcnZlV2FsbGV0Lmxlbmd0aCk7CiAgICBmb3IodWludDggaSA9IDA7IGkgPCByZXNlcnZlV2FsbGV0Lmxlbmd0aDsgaSsrKXsKICAgICAgcmVzZXJ2ZVdhbGxldFtpXS50cmFuc2ZlcihyZXNlcnZlQW1vdW50Rm9yRWFjaCk7CiAgICAgIFRyYW5zZmVycmVkKHJlc2VydmVXYWxsZXRbaV0sIHJlc2VydmVBbW91bnRGb3JFYWNoKTsKICAgIH0KICAgIENsb3NlZCgpOwogIH0KICAvKioKICAgKiBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bGx5IGZpbmFsaXplZAogICAqIGFuZCByZWZ1bmQgaXMgcmVxdWlyZWQuCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQogIC8qKgogICAqIEBkZXYgVGhpcyBmdW5jdGlvbiBhbGxvd3MgZm9yIHVzZXIgdG8gcmVmdW5kIEV0aGVyLgogICAqLwogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICBpZiAocmVmdW5kZWRbaW52ZXN0b3JdID4gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgcmVmdW5kZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkVmFsdWU7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Ci8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KY29udHJhY3QgQVRDQ3Jvd2RTYWxlIGlzIE93bmFibGUsIFNhZmVNYXRoLCBQYXVzYWJsZSB7CiAgS1lDIHB1YmxpYyBreWM7CiAgQVRDIHB1YmxpYyB0b2tlbjsKICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CiAgYWRkcmVzcyBwdWJsaWMgcHJlc2FsZTsKICBhZGRyZXNzIHB1YmxpYyBib3VudHlBZGRyZXNzOyAvLzUlIGZvciBib3VudHkKICBhZGRyZXNzIHB1YmxpYyBwYXJ0bmVyc0FkZHJlc3M7IC8vMTUlIGZvciBjb21tdW5pdHkgZ3JvdXBzICYgcGFydG5lcnMKICBhZGRyZXNzIHB1YmxpYyBBVENSZXNlcnZlTG9ja2VyOyAvLzE1JSB3aXRoIDIgeWVhcnMgbG9jawogIGFkZHJlc3MgcHVibGljIHRlYW1Mb2NrZXI7IC8vIDE1JSB3aXRoIDIgeWVhcnMgdmVzdGluZwogIHN0cnVjdCBQZXJpb2QgewogICAgdWludDI1NiBzdGFydFRpbWU7CiAgICB1aW50MjU2IGVuZFRpbWU7CiAgICB1aW50MjU2IGJvbnVzOyAvLyB1c2VkIHRvIGNhbGN1bGF0ZSByYXRlIHdpdGggYm9udXMuIHJhZ25lIDAgfiAxNSAoMCUgfiAxNSUpCiAgfQogIHVpbnQyNTYgcHVibGljIGJhc2VSYXRlOyAvLyAxIEVUSCA9IDE1MDAgQVRDCiAgdWludDI1NltdIHB1YmxpYyBhZGRpdGlvbmFsQm9udXNBbW91bnRzOwogIFBlcmlvZFtdIHB1YmxpYyBwZXJpb2RzOwogIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBNQVhfUEVSSU9EX0NPVU5UID0gODsKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CiAgdWludDI1NiBwdWJsaWMgbWF4RXRoZXJDYXA7CiAgdWludDI1NiBwdWJsaWMgbWluRXRoZXJDYXA7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmVuZWZpY2lhcnlGdW5kZWQ7CiAgYWRkcmVzc1tdIGludmVzdG9yTGlzdDsKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGluSW52ZXN0b3JMaXN0OwogIGFkZHJlc3MgcHVibGljIEFUQ0NvbnRyb2xsZXI7CiAgYm9vbCBwdWJsaWMgaXNGaW5hbGl6ZWQ7CiAgdWludDI1NiBwdWJsaWMgcmVmdW5kQ29tcGxldGVkOwogIGJvb2wgcHVibGljIHByZXNhbGVGYWxsQmFja0NhbGxlZDsKICB1aW50MjU2IHB1YmxpYyBmaW5hbGl6ZWRUaW1lOwogIGJvb2wgcHVibGljIGluaXRpYWxpemVkOwogIGV2ZW50IENyb3dkU2FsZVRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIF9pbnZlc3RvciwgYWRkcmVzcyBpbmRleGVkIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdG9GdW5kLCB1aW50MjU2IF90b2tlbnMpOwogIGV2ZW50IFN0YXJ0UGVyaW9kKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfYm9udXMpOwogIGV2ZW50IEZpbmFsaXplZCgpOwogIGV2ZW50IFByZXNhbGVGYWxsQmFjayh1aW50MjU2IF9wcmVzYWxlV2VpUmFpc2VkKTsKICBldmVudCBQdXNoSW52ZXN0b3JMaXN0KGFkZHJlc3MgX2ludmVzdG9yKTsKICBldmVudCBSZWZ1bmRBbGwodWludDI1NiBfbnVtVG9SZWZ1bmQpOwogIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBfY2xhaW1Ub2tlbiwgYWRkcmVzcyBvd25lciwgdWludDI1NiBiYWxhbmNlKTsKICBldmVudCBJbml0aWFsaXplKCk7CiAgZnVuY3Rpb24gaW5pdGlhbGl6ZSAoCiAgICBhZGRyZXNzIF9reWMsCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIGFkZHJlc3MgX3ZhdWx0LAogICAgYWRkcmVzcyBfcHJlc2FsZSwKICAgIGFkZHJlc3MgX2JvdW50eUFkZHJlc3MsCiAgICBhZGRyZXNzIF9wYXJ0bmVyc0FkZHJlc3MsCiAgICBhZGRyZXNzIF9BVENSZXNlcnZlTG9ja2VyLAogICAgYWRkcmVzcyBfdGVhbUxvY2tlciwKICAgIGFkZHJlc3MgX3Rva2VuQ29udHJvbGxlciwKICAgIHVpbnQyNTYgX21heEV0aGVyQ2FwLAogICAgdWludDI1NiBfbWluRXRoZXJDYXAsCiAgICB1aW50MjU2IF9iYXNlUmF0ZSwKICAgIHVpbnQyNTZbXSBfYWRkaXRpb25hbEJvbnVzQW1vdW50cwogICAgKSBvbmx5T3duZXIgewogICAgICByZXF1aXJlKCFpbml0aWFsaXplZCk7CiAgICAgIHJlcXVpcmUoX2t5YyAhPSAweDAwICYmIF90b2tlbiAhPSAweDAwICYmIF92YXVsdCAhPSAweDAwICYmIF9wcmVzYWxlICE9IDB4MDApOwogICAgICByZXF1aXJlKF9ib3VudHlBZGRyZXNzICE9IDB4MDAgJiYgX3BhcnRuZXJzQWRkcmVzcyAhPSAweDAwKTsKICAgICAgcmVxdWlyZShfQVRDUmVzZXJ2ZUxvY2tlciAhPSAweDAwICYmIF90ZWFtTG9ja2VyICE9IDB4MDApOwogICAgICByZXF1aXJlKF90b2tlbkNvbnRyb2xsZXIgIT0gMHgwMCk7CiAgICAgIHJlcXVpcmUoMCA8IF9taW5FdGhlckNhcCAmJiBfbWluRXRoZXJDYXAgPCBfbWF4RXRoZXJDYXApOwogICAgICByZXF1aXJlKF9iYXNlUmF0ZSA+IDApOwogICAgICByZXF1aXJlKF9hZGRpdGlvbmFsQm9udXNBbW91bnRzWzBdID4gMCk7CiAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9hZGRpdGlvbmFsQm9udXNBbW91bnRzLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgIHJlcXVpcmUoX2FkZGl0aW9uYWxCb251c0Ftb3VudHNbaV0gPCBfYWRkaXRpb25hbEJvbnVzQW1vdW50c1tpICsgMV0pOwogICAgICB9CiAgICAgIGt5YyA9IEtZQyhfa3ljKTsKICAgICAgdG9rZW4gPSBBVEMoX3Rva2VuKTsKICAgICAgdmF1bHQgPSBSZWZ1bmRWYXVsdChfdmF1bHQpOwogICAgICBwcmVzYWxlID0gX3ByZXNhbGU7CiAgICAgIGJvdW50eUFkZHJlc3MgPSBfYm91bnR5QWRkcmVzczsKICAgICAgcGFydG5lcnNBZGRyZXNzID0gX3BhcnRuZXJzQWRkcmVzczsKICAgICAgQVRDUmVzZXJ2ZUxvY2tlciA9IF9BVENSZXNlcnZlTG9ja2VyOwogICAgICB0ZWFtTG9ja2VyID0gX3RlYW1Mb2NrZXI7CiAgICAgIEFUQ0NvbnRyb2xsZXIgPSBfdG9rZW5Db250cm9sbGVyOwogICAgICBtYXhFdGhlckNhcCA9IF9tYXhFdGhlckNhcDsKICAgICAgbWluRXRoZXJDYXAgPSBfbWluRXRoZXJDYXA7CiAgICAgIGJhc2VSYXRlID0gX2Jhc2VSYXRlOwogICAgICBhZGRpdGlvbmFsQm9udXNBbW91bnRzID0gX2FkZGl0aW9uYWxCb251c0Ftb3VudHM7CiAgICAgIGluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgSW5pdGlhbGl6ZSgpOwogICAgfQogIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eShtc2cuc2VuZGVyKTsKICB9CiAgZnVuY3Rpb24gcHJlc2FsZUZhbGxCYWNrKHVpbnQyNTYgX3ByZXNhbGVXZWlSYWlzZWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKCFwcmVzYWxlRmFsbEJhY2tDYWxsZWQpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHByZXNhbGUpOwogICAgd2VpUmFpc2VkID0gX3ByZXNhbGVXZWlSYWlzZWQ7CiAgICBwcmVzYWxlRmFsbEJhY2tDYWxsZWQgPSB0cnVlOwogICAgUHJlc2FsZUZhbGxCYWNrKF9wcmVzYWxlV2VpUmFpc2VkKTsKICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiBidXkoYWRkcmVzcyBiZW5lZmljaWFyeSkKICAgIHB1YmxpYwogICAgcGF5YWJsZQogICAgd2hlbk5vdFBhdXNlZAogIHsKICAgICAgLy8gY2hlY2sgdmFsaWRpdHkKICAgICAgcmVxdWlyZShwcmVzYWxlRmFsbEJhY2tDYWxsZWQpOwogICAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MDApOwogICAgICByZXF1aXJlKGt5Yy5yZWdpc3RlcmVkQWRkcmVzcyhiZW5lZmljaWFyeSkpOwogICAgICByZXF1aXJlKG9uU2FsZSgpKTsKICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwogICAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICAgIC8vIGNhbGN1bGF0ZSBldGggYW1vdW50CiAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwogICAgICB1aW50MjU2IHRvRnVuZDsKICAgICAgdWludDI1NiBwb3N0V2VpUmFpc2VkID0gYWRkKHdlaVJhaXNlZCwgd2VpQW1vdW50KTsKICAgICAgaWYgKHBvc3RXZWlSYWlzZWQgPiBtYXhFdGhlckNhcCkgewogICAgICAgIHRvRnVuZCA9IHN1YihtYXhFdGhlckNhcCwgd2VpUmFpc2VkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b0Z1bmQgPSB3ZWlBbW91bnQ7CiAgICAgIH0KICAgICAgcmVxdWlyZSh0b0Z1bmQgPiAwKTsKICAgICAgcmVxdWlyZSh3ZWlBbW91bnQgPj0gdG9GdW5kKTsKICAgICAgdWludDI1NiByYXRlID0gY2FsY3VsYXRlUmF0ZSh0b0Z1bmQpOwogICAgICB1aW50MjU2IHRva2VucyA9IG11bCh0b0Z1bmQsIHJhdGUpOwogICAgICB1aW50MjU2IHRvUmV0dXJuID0gc3ViKHdlaUFtb3VudCwgdG9GdW5kKTsKICAgICAgcHVzaEludmVzdG9yTGlzdChtc2cuc2VuZGVyKTsKICAgICAgd2VpUmFpc2VkID0gYWRkKHdlaVJhaXNlZCwgdG9GdW5kKTsKICAgICAgYmVuZWZpY2lhcnlGdW5kZWRbYmVuZWZpY2lhcnldID0gYWRkKGJlbmVmaWNpYXJ5RnVuZGVkW2JlbmVmaWNpYXJ5XSwgdG9GdW5kKTsKICAgICAgdG9rZW4uZ2VuZXJhdGVUb2tlbnMoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICAgIGlmICh0b1JldHVybiA+IDApIHsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvUmV0dXJuKTsKICAgICAgfQogICAgICBmb3J3YXJkRnVuZHModG9GdW5kKTsKICAgICAgQ3Jvd2RTYWxlVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgdG9GdW5kLCB0b2tlbnMpOwogIH0KICBmdW5jdGlvbiBwdXNoSW52ZXN0b3JMaXN0KGFkZHJlc3MgaW52ZXN0b3IpIGludGVybmFsIHsKICAgIGlmICghaW5JbnZlc3Rvckxpc3RbaW52ZXN0b3JdKSB7CiAgICAgIGluSW52ZXN0b3JMaXN0W2ludmVzdG9yXSA9IHRydWU7CiAgICAgIGludmVzdG9yTGlzdC5wdXNoKGludmVzdG9yKTsKICAgICAgUHVzaEludmVzdG9yTGlzdChpbnZlc3Rvcik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gbm9uWmVyb1B1cmNoYXNlICYmICFtYXhSZWFjaGVkKCk7CiAgfQogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcyh1aW50MjU2IHRvRnVuZCkgaW50ZXJuYWwgewogICAgdmF1bHQuZGVwb3NpdC52YWx1ZSh0b0Z1bmQpKG1zZy5zZW5kZXIpOwogIH0KICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIG1pbkV0aGVyQ2FwIGlzIHJlYWNoZWQKICAgKiBAcmV0dXJuIHRydWUgaWYgbWluIGV0aGVyIGNhcCBpcyByZWFjZWQKICAgKi8KICBmdW5jdGlvbiBtaW5SZWFjaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5FdGhlckNhcDsKICB9CiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBtYXhFdGhlckNhcCBpcyByZWFjaGVkCiAgICogQHJldHVybiB0cnVlIGlmIG1heCBldGhlciBjYXAgaXMgcmVhY2VkCiAgICovCiAgZnVuY3Rpb24gbWF4UmVhY2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB3ZWlSYWlzZWQgPT0gbWF4RXRoZXJDYXA7CiAgfQogIGZ1bmN0aW9uIGdldFBlcmlvZEJvbnVzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgYm9vbCBub3dPblNhbGU7CiAgICB1aW50MjU2IGN1cnJlbnRQZXJpb2Q7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwZXJpb2RzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChwZXJpb2RzW2ldLnN0YXJ0VGltZSA8PSBub3cgJiYgbm93IDw9IHBlcmlvZHNbaV0uZW5kVGltZSkgewogICAgICAgIG5vd09uU2FsZSA9IHRydWU7CiAgICAgICAgY3VycmVudFBlcmlvZCA9IGk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJlcXVpcmUobm93T25TYWxlKTsKICAgIHJldHVybiBwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLmJvbnVzOwogIH0KICAvKioKICAgKiBAZGV2IHJhdGUgPSBiYXNlUmF0ZSAqICgxMDAgKyBib251cykgLyAxMDAKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVSYXRlKHVpbnQyNTYgdG9GdW5kKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSAgewogICAgdWludCBib251cyA9IGdldFBlcmlvZEJvbnVzKCk7CiAgICAvLyBib251cyBmb3IgZXRoIGFtb3VudAogICAgaWYgKGFkZGl0aW9uYWxCb251c0Ftb3VudHNbMF0gPD0gdG9GdW5kKSB7CiAgICAgIGJvbnVzID0gYWRkKGJvbnVzLCA1KTsgLy8gNSUgYW1vdW50IGJvbnVzIGZvciBtb3JlIHRoYW4gMzAwIEVUSAogICAgfQogICAgaWYgKGFkZGl0aW9uYWxCb251c0Ftb3VudHNbMV0gPD0gdG9GdW5kKSB7CiAgICAgIGJvbnVzID0gYWRkKGJvbnVzLCA1KTsgLy8gMTAlIGFtb3VudCBib251cyBmb3IgbW9yZSB0aGFuIDYwMDAgRVRICiAgICB9CiAgICBpZiAoYWRkaXRpb25hbEJvbnVzQW1vdW50c1syXSA8PSB0b0Z1bmQpIHsKICAgICAgYm9udXMgPSAyNTsgLy8gZmluYWwgMjUlIGFtb3VudCBib251cyBmb3IgbW9yZSB0aGFuIDgwMDAgRVRICiAgICB9CiAgICBpZiAoYWRkaXRpb25hbEJvbnVzQW1vdW50c1szXSA8PSB0b0Z1bmQpIHsKICAgICAgYm9udXMgPSAzMDsgLy8gZmluYWwgMzAlIGFtb3VudCBib251cyBmb3IgbW9yZSB0aGFuIDEwMDAwIEVUSAogICAgfQogICAgcmV0dXJuIGRpdihtdWwoYmFzZVJhdGUsIGFkZChib251cywgMTAwKSksIDEwMCk7CiAgfQogIGZ1bmN0aW9uIHN0YXJ0UGVyaW9kKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHBlcmlvZHMubGVuZ3RoIDwgTUFYX1BFUklPRF9DT1VOVCk7CiAgICByZXF1aXJlKG5vdyA8IF9zdGFydFRpbWUgJiYgX3N0YXJ0VGltZSA8IF9lbmRUaW1lKTsKICAgIGlmIChwZXJpb2RzLmxlbmd0aCAhPSAwKSB7CiAgICAgIHJlcXVpcmUoc3ViKF9lbmRUaW1lLCBfc3RhcnRUaW1lKSA8PSA3IGRheXMpOwogICAgICByZXF1aXJlKHBlcmlvZHNbcGVyaW9kcy5sZW5ndGggLSAxXS5lbmRUaW1lIDwgX3N0YXJ0VGltZSk7CiAgICB9CiAgICAvLyAxNSUgLT4gMTAlIC0+IDUlIC0+IDAlCiAgICBQZXJpb2QgbWVtb3J5IG5ld1BlcmlvZDsKICAgIG5ld1BlcmlvZC5zdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgbmV3UGVyaW9kLmVuZFRpbWUgPSBfZW5kVGltZTsKICAgIGlmKHBlcmlvZHMubGVuZ3RoIDwgMykgewogICAgICBuZXdQZXJpb2QuYm9udXMgPSBzdWIoMTUsIG11bCg1LCBwZXJpb2RzLmxlbmd0aCkpOwogICAgfSBlbHNlIHsKICAgICAgbmV3UGVyaW9kLmJvbnVzID0gMDsKICAgIH0KICAgIHBlcmlvZHMucHVzaChuZXdQZXJpb2QpOwogICAgU3RhcnRQZXJpb2QoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIG5ld1BlcmlvZC5ib251cyk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gb25TYWxlKCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm93T25TYWxlOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcGVyaW9kcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAocGVyaW9kc1tpXS5zdGFydFRpbWUgPD0gbm93ICYmIG5vdyA8PSBwZXJpb2RzW2ldLmVuZFRpbWUpIHsKICAgICAgICBub3dPblNhbGUgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbm93T25TYWxlOwogIH0KICAvKioKICAgKiBAZGV2IHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgewogICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZSghb25TYWxlKCkgfHwgbWF4UmVhY2hlZCgpKTsKICAgIGZpbmFsaXplZFRpbWUgPSBub3c7CiAgICBmaW5hbGl6YXRpb24oKTsKICAgIEZpbmFsaXplZCgpOwogICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogIH0KICAvKioKICAgKiBAZGV2IGVuZCB0b2tlbiBtaW50aW5nIG9uIGZpbmFsaXphdGlvbiwgbWludCB0b2tlbnMgZm9yIGRldiB0ZWFtIGFuZCByZXNlcnZlIHdhbGxldHMKICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICBpZiAobWluUmVhY2hlZCgpKSB7CiAgICAgIHZhdWx0LmNsb3NlKCk7CiAgICAgIHVpbnQyNTYgdG90YWxUb2tlbiA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgIC8vIHRva2VuIGRpc3RyaWJ1dGlvbiA6IDUwJSBmb3Igc2FsZSwgNSUgZm9yIGJvdW50eSwgMTUlIGZvciBwYXJ0bmVycywgMTUlIGZvciByZXNlcnZlLCAxNSUgZm9yIHRlYW0KICAgICAgdWludDI1NiBib3VudHlBbW91bnQgPSBkaXYobXVsKHRvdGFsVG9rZW4sIDUpLCA1MCk7CiAgICAgIHVpbnQyNTYgcGFydG5lcnNBbW91bnQgPSBkaXYobXVsKHRvdGFsVG9rZW4sIDE1KSwgNTApOwogICAgICB1aW50MjU2IHJlc2VydmVBbW91bnQgPSBkaXYobXVsKHRvdGFsVG9rZW4sIDE1KSwgNTApOwogICAgICB1aW50MjU2IHRlYW1BbW91bnQgPSBkaXYobXVsKHRvdGFsVG9rZW4sIDE1KSwgNTApOwogICAgICBkaXN0cmlidXRlVG9rZW4oYm91bnR5QW1vdW50LCBwYXJ0bmVyc0Ftb3VudCwgcmVzZXJ2ZUFtb3VudCwgdGVhbUFtb3VudCk7CiAgICAgIHRva2VuLmVuYWJsZVRyYW5zZmVycyh0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhdWx0LmVuYWJsZVJlZnVuZHMoKTsKICAgIH0KICAgIHRva2VuLmZpbmlzaEdlbmVyYXRpbmcoKTsKICAgIHRva2VuLmNoYW5nZUNvbnRyb2xsZXIoQVRDQ29udHJvbGxlcik7CiAgfQogIGZ1bmN0aW9uIGRpc3RyaWJ1dGVUb2tlbih1aW50MjU2IGJvdW50eUFtb3VudCwgdWludDI1NiBwYXJ0bmVyc0Ftb3VudCwgdWludDI1NiByZXNlcnZlQW1vdW50LCB1aW50MjU2IHRlYW1BbW91bnQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYm91bnR5QWRkcmVzcyAhPSAweDAwICYmIHBhcnRuZXJzQWRkcmVzcyAhPSAweDAwKTsKICAgIHJlcXVpcmUoQVRDUmVzZXJ2ZUxvY2tlciAhPSAweDAwICYmIHRlYW1Mb2NrZXIgIT0gMHgwMCk7CiAgICB0b2tlbi5nZW5lcmF0ZVRva2Vucyhib3VudHlBZGRyZXNzLCBib3VudHlBbW91bnQpOwogICAgdG9rZW4uZ2VuZXJhdGVUb2tlbnMocGFydG5lcnNBZGRyZXNzLCBwYXJ0bmVyc0Ftb3VudCk7CiAgICB0b2tlbi5nZW5lcmF0ZVRva2VucyhBVENSZXNlcnZlTG9ja2VyLCByZXNlcnZlQW1vdW50KTsKICAgIHRva2VuLmdlbmVyYXRlVG9rZW5zKHRlYW1Mb2NrZXIsIHRlYW1BbW91bnQpOwogIH0KICAvKioKICAgKiBAZGV2IHJlZnVuZCBhIGxvdCBvZiBpbnZlc3RvcnMgYXQgYSB0aW1lIGNoZWNraW5nIG9ubHlPd25lcgogICAqIEBwYXJhbSBudW1Ub1JlZnVuZCB1aW50MjU2IFRoZSBudW1iZXIgb2YgaW52ZXN0b3JzIHRvIHJlZnVuZAogICAqLwogIGZ1bmN0aW9uIHJlZnVuZEFsbCh1aW50MjU2IG51bVRvUmVmdW5kKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKCFtaW5SZWFjaGVkKCkpOwogICAgcmVxdWlyZShudW1Ub1JlZnVuZCA+IDApOwogICAgdWludDI1NiBsaW1pdCA9IHJlZnVuZENvbXBsZXRlZCArIG51bVRvUmVmdW5kOwogICAgaWYgKGxpbWl0ID4gaW52ZXN0b3JMaXN0Lmxlbmd0aCkgewogICAgICBsaW1pdCA9IGludmVzdG9yTGlzdC5sZW5ndGg7CiAgICB9CiAgICBmb3IodWludDI1NiBpID0gcmVmdW5kQ29tcGxldGVkOyBpIDwgbGltaXQ7IGkrKykgewogICAgICB2YXVsdC5yZWZ1bmQoaW52ZXN0b3JMaXN0W2ldKTsKICAgIH0KICAgIHJlZnVuZENvbXBsZXRlZCA9IGxpbWl0OwogICAgUmVmdW5kQWxsKG51bVRvUmVmdW5kKTsKICB9CiAgLyoqCiAgICogQGRldiBpZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBpbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZHMgaGVyZQogICAqIEBwYXJhbSBpbnZlc3RvciBhZGRyZXNzIFRoZSBhY2NvdW50IHRvIGJlIHJlZnVuZGVkCiAgICovCiAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKCFtaW5SZWFjaGVkKCkpOwogICAgcmV0dXJuIHZhdWx0LnJlZnVuZChpbnZlc3Rvcik7CiAgfQogIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX2NsYWltVG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKHRva2VuLmNvbnRyb2xsZXIoKSA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgIHRva2VuLmNsYWltVG9rZW5zKF9jbGFpbVRva2VuKTsKICAgIH0KICAgIGlmIChfY2xhaW1Ub2tlbiA9PSAweDApIHsKICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIEVSQzIwQmFzaWMgY2xhaW1Ub2tlbiA9IEVSQzIwQmFzaWMoX2NsYWltVG9rZW4pOwogICAgdWludDI1NiBiYWxhbmNlID0gY2xhaW1Ub2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBjbGFpbVRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICAgIENsYWltZWRUb2tlbnMoX2NsYWltVG9rZW4sIG93bmVyLCBiYWxhbmNlKTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBUb2tlblRpbWVsb2NrCiAqIEBkZXYgVG9rZW5UaW1lbG9jayBpcyBhIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IHdpbGwgYWxsb3cgYQogKiBiZW5lZmljaWFyeSB0byBleHRyYWN0IHRoZSB0b2tlbnMgYWZ0ZXIgYSBnaXZlbiByZWxlYXNlIHRpbWUKICovCmNvbnRyYWN0IFJlc2VydmVMb2NrZXIgaXMgU2FmZU1hdGh7CiAgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMEJhc2ljOwogIEVSQzIwQmFzaWMgcHVibGljIHRva2VuOwogIEFUQ0Nyb3dkU2FsZSBwdWJsaWMgY3Jvd2RzYWxlOwogIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OwogIGZ1bmN0aW9uIFJlc2VydmVMb2NrZXIoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2Nyb3dkc2FsZSwgYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHsKICAgIHJlcXVpcmUoX3Rva2VuICE9IDB4MDApOwogICAgcmVxdWlyZShfY3Jvd2RzYWxlICE9IDB4MDApOwogICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gMHgwMCk7CiAgICB0b2tlbiA9IEVSQzIwQmFzaWMoX3Rva2VuKTsKICAgIGNyb3dkc2FsZSA9IEFUQ0Nyb3dkU2FsZShfY3Jvd2RzYWxlKTsKICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogIH0KICAvKioKICAgKiBAbm90aWNlIFRyYW5zZmVycyB0b2tlbnMgaGVsZCBieSB0aW1lbG9jayB0byBiZW5lZmljaWFyeS4KICAgKi8KICAgZnVuY3Rpb24gcmVsZWFzZSgpIHB1YmxpYyB7CiAgICAgdWludDI1NiBmaW5hbGl6ZWRUaW1lID0gY3Jvd2RzYWxlLmZpbmFsaXplZFRpbWUoKTsKICAgICByZXF1aXJlKGZpbmFsaXplZFRpbWUgPiAwICYmIG5vdyA+IGFkZChmaW5hbGl6ZWRUaW1lLCAyIHllYXJzKSk7CiAgICAgdWludDI1NiBhbW91bnQgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgcmVxdWlyZShhbW91bnQgPiAwKTsKICAgICB0b2tlbi5zYWZlVHJhbnNmZXIoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgIH0KICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIG5ld1Rva2VuKSBwdWJsaWMgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJlbmVmaWNpYXJ5KTsKICAgIHJlcXVpcmUobmV3VG9rZW4gIT0gMHgwMCk7CiAgICB0b2tlbiA9IEVSQzIwQmFzaWMobmV3VG9rZW4pOwogIH0KfQovKioKICogQHRpdGxlIFRva2VuVGltZWxvY2sKICogQGRldiBUb2tlblRpbWVsb2NrIGlzIGEgdG9rZW4gaG9sZGVyIGNvbnRyYWN0IHRoYXQgd2lsbCBhbGxvdyBhCiAqIGJlbmVmaWNpYXJ5IHRvIGV4dHJhY3QgdGhlIHRva2VucyBhZnRlciBhIGdpdmVuIHJlbGVhc2UgdGltZQogKi8KY29udHJhY3QgVGVhbUxvY2tlciBpcyBTYWZlTWF0aHsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CiAgRVJDMjBCYXNpYyBwdWJsaWMgdG9rZW47CiAgQVRDQ3Jvd2RTYWxlIHB1YmxpYyBjcm93ZHNhbGU7CiAgYWRkcmVzc1tdIHB1YmxpYyBiZW5lZmljaWFyaWVzOwogIHVpbnQyNTYgcHVibGljIGNvbGxlY3RlZFRva2VuczsKICBmdW5jdGlvbiBUZWFtTG9ja2VyKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9jcm93ZHNhbGUsIGFkZHJlc3NbXSBfYmVuZWZpY2lhcmllcykgewogICAgcmVxdWlyZShfdG9rZW4gIT0gMHgwMCk7CiAgICByZXF1aXJlKF9jcm93ZHNhbGUgIT0gMHgwMCk7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewogICAgICByZXF1aXJlKF9iZW5lZmljaWFyaWVzW2ldICE9IDB4MDApOwogICAgfQogICAgdG9rZW4gPSBFUkMyMEJhc2ljKF90b2tlbik7CiAgICBjcm93ZHNhbGUgPSBBVENDcm93ZFNhbGUoX2Nyb3dkc2FsZSk7CiAgICBiZW5lZmljaWFyaWVzID0gX2JlbmVmaWNpYXJpZXM7CiAgfQogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHRva2VucyBoZWxkIGJ5IHRpbWVsb2NrIHRvIGJlbmVmaWNpYXJ5LgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoKSBwdWJsaWMgewogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgdWludDI1NiB0b3RhbCA9IGFkZChiYWxhbmNlLCBjb2xsZWN0ZWRUb2tlbnMpOwogICAgdWludDI1NiBmaW5hbGl6ZWRUaW1lID0gY3Jvd2RzYWxlLmZpbmFsaXplZFRpbWUoKTsKICAgIHJlcXVpcmUoZmluYWxpemVkVGltZSA+IDApOwogICAgdWludDI1NiBsb2NrVGltZTEgPSBhZGQoZmluYWxpemVkVGltZSwgMTgzIGRheXMpOyAvLyA2IG1vbnRocwogICAgdWludDI1NiBsb2NrVGltZTIgPSBhZGQoZmluYWxpemVkVGltZSwgMSB5ZWFycyk7IC8vIDEgeWVhcgogICAgdWludDI1NiBjdXJyZW50UmF0aW8gPSAyMDsKICAgIGlmIChub3cgPj0gbG9ja1RpbWUxKSB7CiAgICAgIGN1cnJlbnRSYXRpbyA9IDUwOwogICAgfQogICAgaWYgKG5vdyA+PSBsb2NrVGltZTIpIHsKICAgICAgY3VycmVudFJhdGlvID0gMTAwOwogICAgfQogICAgdWludDI1NiByZWxlYXNlZEFtb3VudCA9IGRpdihtdWwodG90YWwsIGN1cnJlbnRSYXRpbyksIDEwMCk7CiAgICB1aW50MjU2IGdyYW50QW1vdW50ID0gc3ViKHJlbGVhc2VkQW1vdW50LCBjb2xsZWN0ZWRUb2tlbnMpOwogICAgcmVxdWlyZShncmFudEFtb3VudCA+IDApOwogICAgY29sbGVjdGVkVG9rZW5zID0gYWRkKGNvbGxlY3RlZFRva2VucywgZ3JhbnRBbW91bnQpOwogICAgdWludDI1NiBncmFudEFtb3VudEZvckVhY2ggPSBkaXYoZ3JhbnRBbW91bnQsIDMpOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRva2VuLnNhZmVUcmFuc2ZlcihiZW5lZmljaWFyaWVzW2ldLCBncmFudEFtb3VudEZvckVhY2gpOwogICAgfQogIH0KICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIG5ld1Rva2VuKSBwdWJsaWMgewogICAgcmVxdWlyZShuZXdUb2tlbiAhPSAweDAwKTsKICAgIGJvb2wgaXNCZW5lZmljaWFyeTsKICAgIGZvciAodWludCBpID0gMDsgaSA8IGJlbmVmaWNpYXJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYmVuZWZpY2lhcmllc1tpXSkgewogICAgICAgIGlzQmVuZWZpY2lhcnkgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXF1aXJlKGlzQmVuZWZpY2lhcnkpOwogICAgdG9rZW4gPSBFUkMyMEJhc2ljKG5ld1Rva2VuKTsKICB9Cn0='.
	

]
