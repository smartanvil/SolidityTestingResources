Class {
	#name : #SRTa302FaeBa4666Bc9cDB1A4264E974e571e9BE683,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa302FaeBa4666Bc9cDB1A4264E974e571e9BE683 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIAogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKiogCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4gCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLiAKICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIGV2ZW50IEhhbHRlZChib29sIGhhbHRlZCk7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKCFoYWx0ZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKGhhbHRlZCk7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgICBIYWx0ZWQodHJ1ZSk7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIEhhbHRlZChmYWxzZSk7CiAgfQoKfQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgovKioKICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4KICovCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMCBpcyBFUkMyMCB7CgogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4gCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CgogIC8qKgogICAqIE9ic29sZXRlLiBSZW1vdmVkIHRoaXMgY2hlY2sgYmFzZWQgb246CiAgICogaHR0cHM6Ly9ibG9nLmNvaW5mYWJyaWsuY29tL3NtYXJ0LWNvbnRyYWN0LXNob3J0LWFkZHJlc3MtYXR0YWNrLW1pdGlnYXRpb24tZmFpbHVyZS8KICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqCiAgICogbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAqICAgIHJlcXVpcmUobXNnLmRhdGEubGVuZ3RoID49IHNpemUgKyA0KTsKICAgKiAgICBfOwogICAqIH0KICAgKi8KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KICAKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewoKICAvKiBUb2tlbiBzdXBwbHkgZ290IGluY3JlYXNlZCBhbmQgYSBuZXcgb3duZXIgcmVjZWl2ZWQgdGhlc2UgdG9rZW5zICovCiAgZXZlbnQgTWludGVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICAvKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24gKi8KICBmdW5jdGlvbiBpc1Rva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgd2VBcmUpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwogICAgLy8gU2FmZU1hdGggdXNlcyBhc3NlcnQgaW5zdGVhZCBvZiByZXF1aXJlIHRob3VnaCwgYmV3YXJlIHdoZW4gdXNpbmcgYW4gYW5hbHlzaXMgdG9vbAoKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3NlcycKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSAoX3ZhbHVlID09IDAgfHwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCk7CgogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGluY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZwogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICoKICAgKi8KICBmdW5jdGlvbiBhZGRBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMKICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLmFkZChfYWRkZWRWYWx1ZSk7CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGRlY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZy4KICAgKgogICAqIFdvcmtzIGFyb3VuZCBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqLwogIGZ1bmN0aW9uIHN1YkFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljCiAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICB1aW50IG9sZFZhbCA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwoKICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWwpIHsKICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgfQogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCn0KCi8qKgogKiBEZWZpbmUgaW50ZXJmYWNlIGZvciByZWxlYXNpbmcgdGhlIHRva2VuIHRyYW5zZmVyIGFmdGVyIGEgc3VjY2Vzc2Z1bCBjcm93ZHNhbGUuCiAqLwpjb250cmFjdCBSZWxlYXNhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CgogIC8qIFRoZSBmaW5hbGl6ZXIgY29udHJhY3QgdGhhdCBhbGxvd3MgbGlmdGluZyB0aGUgdHJhbnNmZXIgbGltaXRzIG9uIHRoaXMgdG9rZW4gKi8KICBhZGRyZXNzIHB1YmxpYyByZWxlYXNlQWdlbnQ7CgogIC8qKiBBIGNyb3dkc2FsZSBjb250cmFjdCBjYW4gcmVsZWFzZSB1cyB0byB0aGUgd2lsZCBpZiBJQ08gc3VjY2Vzcy4gSWYgZmFsc2Ugd2UgYXJlIGFyZSBpbiB0cmFuc2ZlciBsb2NrIHVwIHBlcmlvZC4qLwogIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7CgogIC8qKiBNYXAgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zIHJlZ2FyZGxlc3Mgb2YgdGhlIGxvY2sgZG93biBwZXJpb2QuIFRoZXNlIGFyZSBjcm93ZHNhbGUgY29udHJhY3RzIGFuZCBwb3NzaWJsZSB0aGUgdGVhbSBtdWx0aXNpZyBpdHNlbGYuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdHJhbnNmZXJBZ2VudHM7CgogIC8qKgogICAqIFNldCB0aGUgY29udHJhY3QgdGhhdCBjYW4gY2FsbCByZWxlYXNlIGFuZCBtYWtlIHRoZSB0b2tlbiB0cmFuc2ZlcmFibGUuCiAgICoKICAgKiBTaW5jZSB0aGUgb3duZXIgb2YgdGhpcyBjb250cmFjdCBpcyAob3Igc2hvdWxkIGJlKSB0aGUgY3Jvd2RzYWxlLAogICAqIGl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSBhIGNvcnJlc3BvbmRpbmcgZXhwb3NlZCBBUEkgaW4gdGhlIGNyb3dkc2FsZSBjb250cmFjdCBpbiBjYXNlIG9mIGlucHV0IGVycm9yLgogICAqLwogIGZ1bmN0aW9uIHNldFJlbGVhc2VBZ2VudChhZGRyZXNzIGFkZHIpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKICAgIC8vIFdlIGRvbid0IGRvIGludGVyZmFjZSBjaGVjayBoZXJlIGFzIHdlIG1pZ2h0IHdhbnQgdG8gaGF2ZSBhIG5vcm1hbCB3YWxsZXQgYWRkcmVzcyB0byBhY3QgYXMgYSByZWxlYXNlIGFnZW50LgogICAgcmVsZWFzZUFnZW50ID0gYWRkcjsKICB9CgogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIHBhcnRpY3VsYXIgYWRkcmVzcyAoZS5nLiBhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLgogICAqLwogIGZ1bmN0aW9uIHNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICB0cmFuc2ZlckFnZW50c1thZGRyXSA9IHN0YXRlOwogIH0KCiAgLyoqCiAgICogT25lIHdheSBmdW5jdGlvbiB0byByZWxlYXNlIHRoZSB0b2tlbnMgaW50byB0aGUgd2lsZC4KICAgKgogICAqIENhbiBiZSBjYWxsZWQgb25seSBmcm9tIHRoZSByZWxlYXNlIGFnZW50IHRoYXQgc2hvdWxkIHR5cGljYWxseSBiZSB0aGUgZmluYWxpemUgYWdlbnQgSUNPIGNvbnRyYWN0LgogICAqIEluIHRoZSBzY29wZSBvZiB0aGUgY3Jvd2RzYWxlLCBpdCBpcyBvbmx5IGNhbGxlZCBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBiZWVuIGEgc3VjY2VzcyAoZmlyc3QgbWlsZXN0b25lIHJlYWNoZWQpLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgcmVsZWFzZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogTGltaXQgdG9rZW4gdHJhbnNmZXIgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlcikgewogICAgcmVxdWlyZShyZWxlYXNlZCB8fCB0cmFuc2ZlckFnZW50c1tfc2VuZGVyXSk7CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VkICovCiAgbW9kaWZpZXIgaW5SZWxlYXNlU3RhdGUoYm9vbCByZWxlYXNlU3RhdGUpIHsKICAgIHJlcXVpcmUocmVsZWFzZVN0YXRlID09IHJlbGVhc2VkKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSByZWxlYXNlQWdlbnQpOwogICAgXzsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlciBieSBvdmVycmlkaW5nIGl0ICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqIFdlIHJlc3RyaWN0IHRyYW5zZmVyRnJvbSBieSBvdmVycmlkaW5nIGl0ICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIGNhblRyYW5zZmVyKF9mcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlckZvcm0oKQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCn0KCi8qKgogKiBBIHRva2VuIHRoYXQgY2FuIGluY3JlYXNlIGl0cyBzdXBwbHkgYnkgYW5vdGhlciBjb250cmFjdC4KICoKICogVGhpcyBhbGxvd3MgdW5jYXBwZWQgY3Jvd2RzYWxlIGJ5IGR5bmFtaWNhbGx5IGluY3JlYXNpbmcgdGhlIHN1cHBseSB3aGVuIG1vbmV5IHBvdXJzIGluLgogKiBPbmx5IG1pbnQgYWdlbnRzLCBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgb3duZXIsIGNhbiBtaW50IG5ldyB0b2tlbnMuCiAqCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpOwoKCiAgZnVuY3Rpb24gTWludGFibGVUb2tlbih1aW50IF9pbml0aWFsU3VwcGx5LCBhZGRyZXNzIF9tdWx0aXNpZywgYm9vbCBfbWludGFibGUpIGludGVybmFsIHsKICAgIHJlcXVpcmUoX211bHRpc2lnICE9IGFkZHJlc3MoMCkpOwogICAgLy8gQ2Fubm90IGNyZWF0ZSBhIHRva2VuIHdpdGhvdXQgc3VwcGx5IGFuZCBubyBtaW50aW5nCiAgICByZXF1aXJlKF9taW50YWJsZSB8fCBfaW5pdGlhbFN1cHBseSAhPSAwKTsKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGlmIChfaW5pdGlhbFN1cHBseSA+IDApCiAgICAgICAgbWludEludGVybmFsKF9tdWx0aXNpZywgX2luaXRpYWxTdXBwbHkpOwogICAgLy8gTm8gbW9yZSBuZXcgc3VwcGx5IGFsbG93ZWQgYWZ0ZXIgdGhlIHRva2VuIGNyZWF0aW9uCiAgICBtaW50aW5nRmluaXNoZWQgPSAhX21pbnRhYmxlOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4KICAgKgogICAqIE9ubHkgY2FsbGFibGUgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgcHVibGljIHsKICAgIG1pbnRJbnRlcm5hbChyZWNlaXZlciwgYW1vdW50KTsKICB9CgogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgY2FuTWludCBwcml2YXRlIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKGFtb3VudCk7CgogICAgLy8gUmVtb3ZlZCBiZWNhdXNlIHRoaXMgbWF5IGJlIGNvbmZ1c2VkIHdpdGggYW5vbnltb3VzIHRyYW5zZmVycyBpbiB0aGUgdXBjb21pbmcgZm9yay4KICAgIC8vIFRoaXMgd2lsbCBtYWtlIHRoZSBtaW50IHRyYW5zYWN0aW9uIGFwcGVhciBpbiBFdGhlclNjYW4uaW8KICAgIC8vIFdlIGNhbiByZW1vdmUgdGhpcyBhZnRlciB0aGVyZSBpcyBhIHN0YW5kYXJkaXplZCBtaW50aW5nIGV2ZW50CiAgICAvLyBUcmFuc2ZlcigwLCByZWNlaXZlciwgYW1vdW50KTsKCiAgICBNaW50ZWQocmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIG1vZGlmaWVyIG9ubHlNaW50QWdlbnQoKSB7CiAgICAvLyBPbmx5IG1pbnQgYWdlbnRzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgcmVxdWlyZShtaW50QWdlbnRzW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KfQoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgdHJhbnNmZXJzIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICogVXBncmFkZSBhZ2VudCBpdHNlbGYgY2FuIGJlIHRoZSB0b2tlbiBjb250cmFjdCwgb3IganVzdCBhIG1pZGRsZSBtYW4gY29udHJhY3QgZG9pbmcgdGhlIGhlYXZ5IGxpZnRpbmcuCiAqCiAqIFRoZSBVcGdyYWRlIGFnZW50IGlzIHRoZSBpbnRlcmZhY2UgdXNlZCB0byBpbXBsZW1lbnQgYSB0b2tlbgogKiBtaWdyYXRpb24gaW4gdGhlIGNhc2Ugb2YgYW4gZW1lcmdlbmN5LgogKiBUaGUgZnVuY3Rpb24gdXBncmFkZUZyb20gaGFzIHRvIGltcGxlbWVudCB0aGUgcGFydCBvZiB0aGUgY3JlYXRpb24KICogb2YgbmV3IHRva2VucyBvbiBiZWhhbGYgb2YgdGhlIHVzZXIgZG9pbmcgdGhlIHVwZ3JhZGUuCiAqCiAqIFRoZSBuZXcgdG9rZW4gY2FuIGltcGxlbWVudCB0aGlzIGludGVyZmFjZSBkaXJlY3RseSwgb3IgdXNlLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgLyoqIFRoaXMgdmFsdWUgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBvcmlnaW5hbCB0b2tlbidzIHRvdGFsIHN1cHBseSAqLwogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5OwoKICAvKiogSW50ZXJmYWNlIHRvIGVuc3VyZSB0aGUgY29udHJhY3QgaXMgY29ycmVjdGx5IGNvbmZpZ3VyZWQgKi8KICBmdW5jdGlvbiBpc1VwZ3JhZGVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogIFVwZ3JhZGUgYW4gYWNjb3VudAoKICBXaGVuIHRoZSB0b2tlbiBjb250cmFjdCBpcyBpbiB0aGUgdXBncmFkZSBzdGF0dXMgdGhlIGVhY2ggdXNlciB3aWxsCiAgaGF2ZSB0byBjYWxsIGB1cGdyYWRlKHZhbHVlKWAgZnVuY3Rpb24gZnJvbSBVcGdyYWRlYWJsZVRva2VuLgoKICBUaGUgdXBncmFkZSBmdW5jdGlvbiBhZGp1c3QgdGhlIGJhbGFuY2Ugb2YgdGhlIHVzZXIgYW5kIHRoZSBzdXBwbHkKICBvZiB0aGUgcHJldmlvdXMgdG9rZW4gYW5kIHRoZW4gY2FsbCBgdXBncmFkZUZyb20odmFsdWUpYC4KCiAgVGhlIFVwZ3JhZGVBZ2VudCBpcyB0aGUgcmVzcG9uc2libGUgdG8gY3JlYXRlIHRoZSB0b2tlbnMgZm9yIHRoZSB1c2VyCiAgaW4gdGhlIG5ldyBjb250cmFjdC4KCiAgKiBAcGFyYW0gX2Zyb20gQWNjb3VudCB0byB1cGdyYWRlLgogICogQHBhcmFtIF92YWx1ZSBUb2tlbnMgdG8gdXBncmFkZS4KCiAgKi8KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSkgcHVibGljOwoKfQoKLyoqCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLgogKgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgLyoqIENvbnRyYWN0IC8gcGVyc29uIHdobyBjYW4gc2V0IHRoZSB1cGdyYWRlIHBhdGguIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGFzIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBhcyB3aGF0IGl0IGlzIHdpdGggaXRzIGRlZmF1bHQgdmFsdWUuICovCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsKCiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8KICB1aW50IHB1YmxpYyB0b3RhbFVwZ3JhZGVkOwoKICAvKioKICAgKiBVcGdyYWRlIHN0YXRlcy4KICAgKgogICAqIC0gTm90QWxsb3dlZDogVGhlIGNoaWxkIGNvbnRyYWN0IGhhcyBub3QgcmVhY2hlZCBhIGNvbmRpdGlvbiB3aGVyZSB0aGUgdXBncmFkZSBjYW4gYmd1bgogICAqIC0gV2FpdGluZ0ZvckFnZW50OiBUb2tlbiBhbGxvd3MgdXBncmFkZSwgYnV0IHdlIGRvbid0IGhhdmUgYSBuZXcgYWdlbnQgeWV0CiAgICogLSBSZWFkeVRvVXBncmFkZTogVGhlIGFnZW50IGlzIHNldCwgYnV0IG5vdCBhIHNpbmdsZSB0b2tlbiBoYXMgYmVlbiB1cGdyYWRlZCB5ZXQKICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CgogIC8qKgogICAqIE5ldyB1cGdyYWRlIGFnZW50IGF2YWlsYWJsZS4KICAgKi8KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIF91cGdyYWRlTWFzdGVyKSB7CiAgICBzZXRVcGdyYWRlTWFzdGVyKF91cGdyYWRlTWFzdGVyKTsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgIC8vIEVuc3VyZSBpdCdzIG5vdCBjYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgIHJlcXVpcmUoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgcmVxdWlyZSh2YWx1ZSAhPSAwKTsKCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih2YWx1ZSk7CgogICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKHZhbHVlKTsKICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLmFkZCh2YWx1ZSk7CgogICAgLy8gVXBncmFkZSBhZ2VudCByZWlzc3VlcyB0aGUgdG9rZW5zCiAgICB1cGdyYWRlQWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwogICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcyB0aGUgdXBncmFkZSBwcm9jZXNzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIGV4dGVybmFsIHsKICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlIHRva2VuIGlzIGluIGEgc3RhdGUgdGhhdCB3ZSBjb3VsZCB0aGluayBvZiB1cGdyYWRpbmcKICAgIHJlcXVpcmUoY2FuVXBncmFkZSgpKTsKCiAgICByZXF1aXJlKGFnZW50ICE9IDB4MCk7CiAgICAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgYWdlbnQKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB1cGdyYWRlTWFzdGVyKTsKICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICByZXF1aXJlKGdldFVwZ3JhZGVTdGF0ZSgpICE9IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgLy8gQmFkIGludGVyZmFjZQogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSk7CiAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldAogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSA9PSB0b3RhbFN1cHBseSk7CgogICAgVXBncmFkZUFnZW50U2V0KHVwZ3JhZGVBZ2VudCk7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIHN0YXRlIG9mIHRoZSB0b2tlbiB1cGdyYWRlLgogICAqLwogIGZ1bmN0aW9uIGdldFVwZ3JhZGVTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKFVwZ3JhZGVTdGF0ZSkgewogICAgaWYgKCFjYW5VcGdyYWRlKCkpIHJldHVybiBVcGdyYWRlU3RhdGUuTm90QWxsb3dlZDsKICAgIGVsc2UgaWYgKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYgKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsKICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgfQoKICAvKioKICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLgogICAqCiAgICogVGhpcyBhbGxvd3MgdXMgdG8gc2V0IGEgbmV3IG93bmVyIGZvciB0aGUgdXBncmFkZSBtZWNoYW5pc20uCiAgICovCiAgZnVuY3Rpb24gY2hhbmdlVXBncmFkZU1hc3RlcihhZGRyZXNzIG5ld19tYXN0ZXIpIHB1YmxpYyB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdXBncmFkZU1hc3Rlcik7CiAgICBzZXRVcGdyYWRlTWFzdGVyKG5ld19tYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgdXBncmFkZSBtYXN0ZXIgc2V0dGVyLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBwcml2YXRlIHsKICAgIHJlcXVpcmUobmV3X21hc3RlciAhPSAweDApOwogICAgdXBncmFkZU1hc3RlciA9IG5ld19tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gZW5hYmxlIHRvIHByb3ZpZGUgdGhlIGNvbmRpdGlvbiB3aGVuIHRoZSB1cGdyYWRlIGNhbiBiZWdpbi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgIHJldHVybiB0cnVlOwogIH0KCn0KCgovKioKICogQSBjcm93ZHNhbGUgdG9rZW4uCiAqCiAqIEFuIEVSQy0yMCB0b2tlbiBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIGNyb3dkc2FsZXMgd2l0aCBpbnZlc3RvciBwcm90ZWN0aW9uIGFuZCBmdXJ0aGVyIGRldmVsb3BtZW50IHBhdGguCiAqCiAqIC0gVGhlIHRva2VuIHRyYW5zZmVyKCkgaXMgZGlzYWJsZWQgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyCiAqIC0gVGhlIHRva2VuIGNvbnRyYWN0IGdpdmVzIGFuIG9wdC1pbiB1cGdyYWRlIHBhdGggdG8gYSBuZXcgY29udHJhY3QKICogLSBUaGUgc2FtZSB0b2tlbiBjYW4gYmUgcGFydCBvZiBzZXZlcmFsIGNyb3dkc2FsZXMgdGhyb3VnaCB0aGUgYXBwcm92ZSgpIG1lY2hhbmlzbQogKiAtIFRoZSB0b2tlbiBjYW4gYmUgY2FwcGVkIChzdXBwbHkgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvcikgb3IgdW5jYXBwZWQgKGNyb3dkc2FsZSBjb250cmFjdCBjYW4gbWludCBuZXcgdG9rZW5zKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gaXMgUmVsZWFzYWJsZVRva2VuLCBNaW50YWJsZVRva2VuLCBVcGdyYWRlYWJsZVRva2VuLCBGcmFjdGlvbmFsRVJDMjAgewoKICBldmVudCBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihzdHJpbmcgbmV3TmFtZSwgc3RyaW5nIG5ld1N5bWJvbCk7CgogIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogIC8qKgogICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uCiAgICoKICAgKiBUaGlzIHRva2VuIG11c3QgYmUgY3JlYXRlZCB0aHJvdWdoIGEgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIHNvIHRoYXQgaXQgaXMgb3duZWQgYnkgdGhhdCB3YWxsZXQuCiAgICoKICAgKiBAcGFyYW0gX25hbWUgVG9rZW4gbmFtZQogICAqIEBwYXJhbSBfc3ltYm9sIFRva2VuIHN5bWJvbCAtIHR5cGljYWxseSBpdCdzIGFsbCBjYXBzCiAgICogQHBhcmFtIF9pbml0aWFsU3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoCiAgICogQHBhcmFtIF9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgKiBAcGFyYW0gX21pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50OCBfZGVjaW1hbHMsIGFkZHJlc3MgX211bHRpc2lnLCBib29sIF9taW50YWJsZSkKICAgIFVwZ3JhZGVhYmxlVG9rZW4oX211bHRpc2lnKSBNaW50YWJsZVRva2VuKF9pbml0aWFsU3VwcGx5LCBfbXVsdGlzaWcsIF9taW50YWJsZSkgewogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIHByb2hpYml0IG5ldyB0b2tlbiBjcmVhdGlvbi4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdXBncmFkZSBhZ2VudCBmdW5jdGlvbmFsaXR5IHRvIGtpY2sgaW4gb25seSBpZiB0aGUgY3Jvd2RzYWxlIHdhcyBhIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiByZWxlYXNlZCAmJiBzdXBlci5jYW5VcGdyYWRlKCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gdXBkYXRlIHRva2VuIGluZm9ybWF0aW9uIGhlcmUKICAgKi8KICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIG9ubHlPd25lciB7CiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgIFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKG5hbWUsIHN5bWJvbCk7CiAgfQoKfQoKLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGVzCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcwogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cwogKiAtIG1pbmltdW0gZnVuZGluZyBnb2FsIGFuZCByZWZ1bmQKICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQKICogLSBkaWZmZXJlbnQgcHJpY2luZyBzdHJhdGVnaWVzCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIENyb3dkc2FsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLyogSG93IHdlIGFyZSBnb2luZyB0byBwcmljZSBvdXIgb2ZmZXJpbmcgKi8KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsKCiAgLyogSG93IHdlIGFyZSBnb2luZyB0byBsaW1pdCBvdXIgb2ZmZXJpbmcgKi8KICBDZWlsaW5nU3RyYXRlZ3kgcHVibGljIGNlaWxpbmdTdHJhdGVneTsKCiAgLyogUG9zdC1zdWNjZXNzIGNhbGxiYWNrICovCiAgRmluYWxpemVBZ2VudCBwdWJsaWMgZmluYWxpemVBZ2VudDsKCiAgLyogZXRoZXIgd2lsbCBiZSB0cmFuc2ZlcnJlZCB0byB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLwogIHVpbnQgcHVibGljIG1pbmltdW1GdW5kaW5nR29hbDsKCiAgLyogdGhlIGZ1bmRpbmcgY2Fubm90IGV4Y2VlZCB0aGlzIGNhcDsgbWF5IGJlIHNldCBsYXRlciBvbiBkdXJpbmcgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHdlaUZ1bmRpbmdDYXAgPSAwOwoKICAvKiB0aGUgc3RhcnRpbmcgYmxvY2sgbnVtYmVyIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKCiAgLyogdGhlIGVuZGluZyBibG9jayBudW1iZXIgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovCiAgdWludCBwdWJsaWMgd2VpUmVmdW5kZWQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSBhIHVuaXF1ZSBjb250cmlidXRvciBpZCBmb3IgZWFjaCBjdXN0b21lciAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVDdXN0b21lcklkOwoKICAvKiogSG93IG1hbnkgRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgaW4gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgdGhlIGludGVyYWN0aW9uIHdpdGggdGhlIG93bmVyJ3Mgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBhIGJsb2NrY2hhaW4gZXhwbG9yZXIgdG8gc2VlIHRoYXQgY3Jvd2RzYWxlIGludGVyYWN0aW9uIHdvcmtzLiAqLwogIHVpbnQ4IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsKCiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcmVhY2hlZCB0aGUgc3RhcnRpbmcgYmxvY2sgeWV0CiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkCiAgICogLSBGYWlsdXJlOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBub3QgcmVhY2hlZCBiZWZvcmUgdGhlIGVuZGluZyBibG9jawogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemUgZnVuY3Rpb24gaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IHRvIGJlIHJlY2xhaW1lZCBieSBpbnZlc3RvcnMuCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KCgogIC8vIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUKICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsKCiAgLy8gUmVmdW5kIHdhcyBwcm9jZXNzZWQgZm9yIGEgY29udHJpYnV0b3IKICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOwoKICAvLyBUaGUgcnVsZXMgYWJvdXQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdCB3ZXJlIGNoYW5nZWQKICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDSWQpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSdzIGZpbmFsaXplIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZAogIGV2ZW50IEZpbmFsaXplZCgpOwoKICAvLyBBIG5ldyBmdW5kaW5nIGNhcCBoYXMgYmVlbiBzZXQKICBldmVudCBGdW5kaW5nQ2FwU2V0KHVpbnQgbmV3RnVuZGluZ0NhcCk7CgogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSBpbnRlcm5hbCB7CiAgICBzZXRNdWx0aXNpZyhfbXVsdGlzaWdXYWxsZXQpOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICByZXF1aXJlKF9zdGFydCAhPSAwICYmIF9lbmQgIT0gMCk7CiAgICByZXF1aXJlKGJsb2NrLm51bWJlciA8IF9zdGFydCAmJiBfc3RhcnQgPCBfZW5kKTsKICAgIHN0YXJ0c0F0ID0gX3N0YXJ0OwogICAgZW5kc0F0ID0gX2VuZDsKCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybwogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHJlcXVpcmUoZmFsc2UpOwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IG5vdEZpbmlzaGVkIHByaXZhdGUgewogICAgLy8gRGV0ZXJtaW5lIGlmIGl0J3MgYSBnb29kIHRpbWUgdG8gYWNjZXB0IGludmVzdG1lbnQgZnJvbSB0aGlzIHBhcnRpY2lwYW50CiAgICBpZiAoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICByZXF1aXJlKGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbcmVjZWl2ZXJdKTsKICAgIH0KCiAgICB1aW50IHdlaUFtb3VudCA9IGNlaWxpbmdTdHJhdGVneS53ZWlBbGxvd2VkVG9SZWNlaXZlKG1zZy52YWx1ZSwgd2VpUmFpc2VkLCBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSwgd2VpRnVuZGluZ0NhcCk7CiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKICAgIAogICAgLy8gRHVzdCB0cmFuc2FjdGlvbiBpZiBubyB0b2tlbnMgY2FuIGJlIGdpdmVuCiAgICByZXF1aXJlKHRva2VuQW1vdW50ICE9IDApOwoKICAgIGlmIChpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7CiAgICAgIC8vIEEgbmV3IGludmVzdG9yCiAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KICAgIHVwZGF0ZUludmVzdG9yRnVuZHModG9rZW5BbW91bnQsIHdlaUFtb3VudCwgcmVjZWl2ZXIsIGN1c3RvbWVySWQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXkKICAgIG11bHRpc2lnV2FsbGV0LnRyYW5zZmVyKHdlaUFtb3VudCk7CgogICAgLy8gUmV0dXJuIGV4Y2VzcyBvZiBtb25leQogICAgdWludCB3ZWlUb1JldHVybiA9IG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KTsKICAgIGlmICh3ZWlUb1JldHVybiA+IDApIHsKICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih3ZWlUb1JldHVybik7CiAgICB9CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIGZ1bGxUb2tlbnMgdG9rZW5zIGFzIGZ1bGwgdG9rZW5zIC0gZGVjaW1hbCBwbGFjZXMgYWRkZWQgaW50ZXJuYWxseQogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBmdWxsIHRva2VuIGluIHdlaQogICAqCiAgICovCiAgZnVuY3Rpb24gcHJlYWxsb2NhdGUoYWRkcmVzcyByZWNlaXZlciwgdWludCBmdWxsVG9rZW5zLCB1aW50IHdlaVByaWNlKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHsKICAgIHJlcXVpcmUocmVjZWl2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICB1aW50IHRva2VuQW1vdW50ID0gZnVsbFRva2Vucy5tdWwoMTAqKnVpbnQodG9rZW4uZGVjaW1hbHMoKSkpOwogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UubXVsKHRva2VuQW1vdW50KTsgLy8gVGhpcyBjYW4gYWxzbyBiZSAwLCBpbiB3aGljaCBjYXNlIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQogICAgdXBkYXRlSW52ZXN0b3JGdW5kcyh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCByZWNlaXZlciAsIDApOwogIH0KCiAgLyoqCiAgICogUHJpdmF0ZSBmdW5jdGlvbiB0byB1cGRhdGUgYWNjb3VudGluZyBpbiB0aGUgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIHVwZGF0ZUludmVzdG9yRnVuZHModWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlBbW91bnQsIGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHJpdmF0ZSB7CiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0uYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLmFkZCh0b2tlbkFtb3VudCk7CgogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQuYWRkKHRva2VuQW1vdW50KTsKCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKICAgIC8vIFRlbGwgdXMgdGhhdCB0aGUgaW52ZXN0bWVudCB3YXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwogIH0KCgogIC8qKgogICAqIEFsbG93IHRoZSBvd25lciB0byBzZXQgYSBmdW5kaW5nIGNhcCBvbiB0aGUgY3Jvd2RzYWxlLgogICAqIFRoZSBuZXcgY2FwIHNob3VsZCBiZSBoaWdoZXIgdGhhbiB0aGUgbWluaW11bSBmdW5kaW5nIGdvYWwuCiAgICogCiAgICogQHBhcmFtIG5ld0NhcCBtaW5pbXVtIHRhcmdldCBjYXAgdGhhdCBtYXkgYmUgcmVsYXhlZCBpZiBpdCB3YXMgYWxyZWFkeSBicm9rZW4uCiAgICovCiAgZnVuY3Rpb24gc2V0RnVuZGluZ0NhcCh1aW50IG5ld0NhcCkgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCB7CiAgICB3ZWlGdW5kaW5nQ2FwID0gY2VpbGluZ1N0cmF0ZWd5LnJlbGF4RnVuZGluZ0NhcChuZXdDYXAsIHdlaVJhaXNlZCk7CiAgICByZXF1aXJlKHdlaUZ1bmRpbmdDYXAgPj0gbWluaW11bUZ1bmRpbmdHb2FsKTsKICAgIEZ1bmRpbmdDYXBTZXQod2VpRnVuZGluZ0NhcCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKGN1c3RvbWVySWQgIT0gMCk7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICBpbnZlc3RJbnRlcm5hbChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZSghcmVxdWlyZUN1c3RvbWVySWQpOyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGljaXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwKICAgIGludmVzdEludGVybmFsKG1zZy5zZW5kZXIsIDApOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewogICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSh0b2tlbik7CiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogICAgRmluYWxpemVkKCk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCBzdG9wSW5FbWVyZ2VuY3kgewogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuCiAgICovCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBhZGRyKSBpbnRlcm5hbCB7CiAgICAvLyBEaXNhbGxvdyBzZXR0aW5nIGEgYmFkIGFnZW50CiAgICByZXF1aXJlKGFkZHIuaXNQcmljaW5nU3RyYXRlZ3koKSk7CiAgICBwcmljaW5nU3RyYXRlZ3kgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gKHJlKXNldCBjZWlsaW5nIHN0cmF0ZWd5LgogICAqLwogIGZ1bmN0aW9uIHNldENlaWxpbmdTdHJhdGVneShDZWlsaW5nU3RyYXRlZ3kgYWRkcikgaW50ZXJuYWwgewogICAgLy8gRGlzYWxsb3cgc2V0dGluZyBhIGJhZCBhZ2VudAogICAgcmVxdWlyZShhZGRyLmlzQ2VpbGluZ1N0cmF0ZWd5KCkpOwogICAgY2VpbGluZ1N0cmF0ZWd5ID0gYWRkcjsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgZmluYWxpemUgYWdlbnQuCiAgICovCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIGludGVybmFsIHsKICAgIC8vIERpc2FsbG93IHNldHRpbmcgYSBiYWQgYWdlbnQKICAgIHJlcXVpcmUoYWRkci5pc0ZpbmFsaXplQWdlbnQoKSk7CiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsKICAgIHJlcXVpcmUoaXNGaW5hbGl6ZXJTYW5lKCkpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgc2V0dGVyIGZvciB0aGUgbXVsdGlzaWcgd2FsbGV0CiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKGFkZHIgIT0gMCk7CiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuCiAgICoKICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoYXQgdGhlIG1pbmltdW0gZ29hbCB3YXMgbm90IHJlYWNoZWQuCiAgICovCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgc3RvcEluRW1lcmdlbmN5IHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHdlaVJhaXNlZCk7CiAgICByZXF1aXJlKHdlaVJlZnVuZGVkID09IDApOwogICAgdWludCBleGNlZGVudCA9IG1zZy52YWx1ZS5zdWIod2VpUmFpc2VkKTsKICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5hZGQobXNnLnZhbHVlLnN1YihleGNlZGVudCkpOwogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXS5hZGQoZXhjZWRlbnQpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSBzdG9wSW5FbWVyZ2VuY3kgewogICAgdWludCB3ZWlWYWx1ZSA9IGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl07CiAgICByZXF1aXJlKHdlaVZhbHVlICE9IDApOwogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7CiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLmFkZCh3ZWlWYWx1ZSk7CiAgICBSZWZ1bmQobXNnLnNlbmRlciwgd2VpVmFsdWUpOwogICAgbXNnLnNlbmRlci50cmFuc2Zlcih3ZWlWYWx1ZSk7CiAgfQoKICAvKioKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3MKICAgKi8KICBmdW5jdGlvbiBpc01pbmltdW1Hb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHJlYWNoZWQpIHsKICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gbWluaW11bUZ1bmRpbmdHb2FsOwogIH0KCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLgogICAqLwogIGZ1bmN0aW9uIGlzRmluYWxpemVyU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBmaW5hbGl6ZUFnZW50LmlzU2FuZSh0b2tlbik7CiAgfQoKICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBoYXMgdGhlIHRpbWVkIHRyYW5zaXRpb24gYnVpbHRpbi4KICAgKiBTbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLgogICAqLwogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7CiAgICBpZiAoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoYmxvY2subnVtYmVyIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOwogICAgZWxzZSBpZiAoYmxvY2subnVtYmVyIDw9IGVuZHNBdCAmJiAhY2VpbGluZ1N0cmF0ZWd5LmlzQ3Jvd2RzYWxlRnVsbCh3ZWlSYWlzZWQsIHdlaUZ1bmRpbmdDYXApKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CgogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50OCB2YWwpIHB1YmxpYyBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOwogIH0KCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGUgewogICAgdG9rZW4ubWludChyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogIH0KCiAgLyoqIEludGVyZmFjZSBtYXJrZXIuICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIC8qKiBNb2RpZmllciBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7CiAgICByZXF1aXJlKGdldFN0YXRlKCkgPT0gc3RhdGUpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG5vdEZpbmlzaGVkKCkgewogICAgU3RhdGUgY3VycmVudF9zdGF0ZSA9IGdldFN0YXRlKCk7CiAgICByZXF1aXJlKGN1cnJlbnRfc3RhdGUgPT0gU3RhdGUuUHJlRnVuZGluZyB8fCBjdXJyZW50X3N0YXRlID09IFN0YXRlLkZ1bmRpbmcpOwogICAgXzsKICB9Cgp9CgovKioKICogSW50ZXJmYWNlIGZvciBkZWZpbmluZyBjcm93ZHNhbGUgcHJpY2luZy4KICovCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7CgogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0LgogICAqCiAgICoKICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VudCBpbiBhcyB3ZWkKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbWFueSB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIGRlY2ltYWxzIC0gaG93IG1hbnkgZGVjaW1hbCB1bml0cyB0aGUgdG9rZW4gaGFzCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgd2VpUmFpc2VkLCB1aW50IHRva2Vuc1NvbGQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCB0b2tlbkFtb3VudCk7Cn0KCi8qKgogKiBGaXhlZCBjcm93ZHNhbGUgcHJpY2luZyAtIGV2ZXJ5Ym9keSBnZXRzIHRoZSBzYW1lIHByaWNlLgogKi8KY29udHJhY3QgRmxhdFByaWNpbmcgaXMgUHJpY2luZ1N0cmF0ZWd5IHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qIEhvdyBtYW55IHdlaXMgb25lIHRva2VuIGNvc3RzICovCiAgdWludCBwdWJsaWMgb25lVG9rZW5JbldlaTsKCiAgZnVuY3Rpb24gRmxhdFByaWNpbmcodWludCBfb25lVG9rZW5JbldlaSkgewogICAgb25lVG9rZW5JbldlaSA9IF9vbmVUb2tlbkluV2VpOwogIH0KCiAgLyoqCiAgICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IHByaWNlIGZvciBidXkgaW4gYW1vdW50LgogICAqCiAgICogQCBwYXJhbSAge3VpbnQgdmFsdWV9IEJ1eS1pbiB2YWx1ZSBpbiB3ZWkuCiAgICogQCBwYXJhbQogICAqIEAgcGFyYW0KICAgKiBAIHBhcmFtCiAgICogQCBwYXJhbSAge3VpbnQgZGVjaW1hbHN9IFRoZSBkZWNpbWFscyB1c2VkIGJ5IHRoZSB0b2tlbiByZXByZXNlbnRhdGlvbiAoZS5nLiBnaXZlbiBieSBGcmFjdGlvbmFsRVJDMjApLgogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQsIHVpbnQsIGFkZHJlc3MsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IG11bHRpcGxpZXIgPSAxMCAqKiBkZWNpbWFsczsKICAgIHJldHVybiB2YWx1ZS5tdWwobXVsdGlwbGllcikuZGl2KG9uZVRva2VuSW5XZWkpOwogIH0KCn0KCi8qKgogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBjZWlsaW5nLgogKi8KY29udHJhY3QgQ2VpbGluZ1N0cmF0ZWd5IHsKCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8KICBmdW5jdGlvbiBpc0NlaWxpbmdTdHJhdGVneSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIFdoZW4gc29tZWJvZHkgdHJpZXMgdG8gYnV5IHRva2VucyBmb3IgWCB3ZWksIGNhbGN1bGF0ZSBob3cgbWFueSB3ZWlzIHRoZXkgYXJlIGFsbG93ZWQgdG8gdXNlLgogICAqCiAgICoKICAgKiBAcGFyYW0gX3ZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbnQgaW4gYXMgd2VpLgogICAqIEBwYXJhbSBfd2VpUmFpc2VkIC0gSG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHNvIGZhci4KICAgKiBAcGFyYW0gX3dlaUludmVzdGVkQnlTZW5kZXIgLSB0aGUgaW52ZXN0bWVudCBtYWRlIGJ5IHRoZSBhZGRyZXNzIHRoYXQgaXMgc2VuZGluZyB0aGUgdHJhbnNhY3Rpb24uCiAgICogQHBhcmFtIF93ZWlGdW5kaW5nQ2FwIC0gdGhlIGNhbGxlcidzIGRlY2xhcmVkIHRvdGFsIGNhcC4gTWF5IGJlIHJlaW50ZXJwcmV0ZWQgYnkgdGhlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBDZWlsaW5nU3RyYXRlZ3kuCiAgICogQHJldHVybiBBbW91bnQgb2Ygd2VpIHRoZSBjcm93ZHNhbGUgY2FuIHJlY2VpdmUuCiAgICovCiAgZnVuY3Rpb24gd2VpQWxsb3dlZFRvUmVjZWl2ZSh1aW50IF92YWx1ZSwgdWludCBfd2VpUmFpc2VkLCB1aW50IF93ZWlJbnZlc3RlZEJ5U2VuZGVyLCB1aW50IF93ZWlGdW5kaW5nQ2FwKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBhbW91bnQpOwoKICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwodWludCBfd2VpUmFpc2VkLCB1aW50IF93ZWlGdW5kaW5nQ2FwKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgogIC8qKgogICAqIENhbGN1bGF0ZSBhIG5ldyBjYXAgaWYgdGhlIHByb3ZpZGVkIG9uZSBpcyBub3QgYWJvdmUgdGhlIGFtb3VudCBhbHJlYWR5IHJhaXNlZC4KICAgKgogICAqCiAgICogQHBhcmFtIF9uZXdDYXAgLSBUaGUgcG90ZW50aWFsIG5ldyBjYXAuCiAgICogQHBhcmFtIF93ZWlSYWlzZWQgLSBIb3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgc28gZmFyLgogICAqIEByZXR1cm4gVGhlIGFkanVzdGVkIGNhcC4KICAgKi8KICBmdW5jdGlvbiByZWxheEZ1bmRpbmdDYXAodWludCBfbmV3Q2FwLCB1aW50IF93ZWlSYWlzZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCn0KCi8qKgogKiBGaXhlZCBjYXAgaW52ZXN0bWVudCBwZXIgYWRkcmVzcyBhbmQgY3Jvd2RzYWxlCiAqLwpjb250cmFjdCBGaXhlZENlaWxpbmcgaXMgQ2VpbGluZ1N0cmF0ZWd5IHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIC8qIFdoZW4gcmVsYXhpbmcgYSBjYXAgaXMgbmVjZXNzYXJ5LCB3ZSB1c2UgdGhpcyBtdWx0aXBsZSB0byBkZXRlcm1pbmUgdGhlIHJlbGF4ZWQgY2FwICovCiAgICB1aW50IHB1YmxpYyBjaHVua2VkV2VpTXVsdGlwbGU7CiAgICAvKiBUaGUgbGltaXQgYW4gaW5kaXZpZHVhbCBhZGRyZXNzIGNhbiBpbnZlc3QgKi8KICAgIHVpbnQgcHVibGljIHdlaUxpbWl0UGVyQWRkcmVzczsKCiAgICBmdW5jdGlvbiBGaXhlZENlaWxpbmcodWludCBtdWx0aXBsZSwgdWludCBsaW1pdCkgewogICAgICAgIGNodW5rZWRXZWlNdWx0aXBsZSA9IG11bHRpcGxlOwogICAgICAgIHdlaUxpbWl0UGVyQWRkcmVzcyA9IGxpbWl0OwogICAgfQoKICAgIGZ1bmN0aW9uIHdlaUFsbG93ZWRUb1JlY2VpdmUodWludCB0ZW50YXRpdmVBbW91bnQsIHVpbnQgd2VpUmFpc2VkLCB1aW50IHdlaUludmVzdGVkQnlTZW5kZXIsIHVpbnQgd2VpRnVuZGluZ0NhcCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBGaXJzdCwgd2UgbGltaXQgcGVyIGFkZHJlc3MgaW52ZXN0bWVudAogICAgICAgIHVpbnQgdG90YWxPZlNlbmRlciA9IHRlbnRhdGl2ZUFtb3VudC5hZGQod2VpSW52ZXN0ZWRCeVNlbmRlcik7CiAgICAgICAgaWYgKHRvdGFsT2ZTZW5kZXIgPiB3ZWlMaW1pdFBlckFkZHJlc3MpIHRlbnRhdGl2ZUFtb3VudCA9IHdlaUxpbWl0UGVyQWRkcmVzcy5zdWIod2VpSW52ZXN0ZWRCeVNlbmRlcik7CiAgICAgICAgLy8gVGhlbiwgd2UgY2hlY2sgdGhlIGZ1bmRpbmcgY2FwCiAgICAgICAgaWYgKHdlaUZ1bmRpbmdDYXAgPT0gMCkgcmV0dXJuIHRlbnRhdGl2ZUFtb3VudDsKICAgICAgICB1aW50IHRvdGFsID0gdGVudGF0aXZlQW1vdW50LmFkZCh3ZWlSYWlzZWQpOwogICAgICAgIGlmICh0b3RhbCA8IHdlaUZ1bmRpbmdDYXApIHJldHVybiB0ZW50YXRpdmVBbW91bnQ7CiAgICAgICAgZWxzZSByZXR1cm4gd2VpRnVuZGluZ0NhcC5zdWIod2VpUmFpc2VkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwodWludCB3ZWlSYWlzZWQsIHVpbnQgd2VpRnVuZGluZ0NhcCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2VpRnVuZGluZ0NhcCA+IDAgJiYgd2VpUmFpc2VkID49IHdlaUZ1bmRpbmdDYXA7CiAgICB9CgogICAgLyogSWYgdGhlIG5ldyB0YXJnZXQgY2FwIGhhcyBub3QgYmVlbiByZWFjaGVkIHlldCwgaXQncyBmaW5lIGFzIGl0IGlzICovCiAgICBmdW5jdGlvbiByZWxheEZ1bmRpbmdDYXAodWludCBuZXdDYXAsIHVpbnQgd2VpUmFpc2VkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChuZXdDYXAgPiB3ZWlSYWlzZWQpIHJldHVybiBuZXdDYXA7CiAgICAgICAgZWxzZSByZXR1cm4gd2VpUmFpc2VkLmRpdihjaHVua2VkV2VpTXVsdGlwbGUpLmFkZCgxKS5tdWwoY2h1bmtlZFdlaU11bHRpcGxlKTsKICAgIH0KCn0KCi8qKgogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIGEgc3VjY2VzZnVsIGNyb3dkc2FsZS4KICoKICogLSBBbGxvY2F0ZSB0b2tlbnMgZm9yIGZvdW5kZXJzLCBib3VudGllcyBhbmQgY29tbXVuaXR5CiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlCiAqIC0gZXRjLgogKi8KY29udHJhY3QgRmluYWxpemVBZ2VudCB7CgogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4KICAgKgogICAqIFRoaXMgaXMgYSBzYWZldHkgY2hlY2sgZnVuY3Rpb24gdGhhdCBkb2Vzbid0IGFsbG93IGNyb3dkc2FsZSB0byBiZWdpbgogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4KICAgKi8KICBmdW5jdGlvbiBpc1NhbmUoQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBhIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pIHB1YmxpYzsKCn0KCi8qKgogKiBBdCB0aGUgZW5kIG9mIHRoZSBzdWNjZXNzZnVsIGNyb3dkc2FsZSBhbGxvY2F0ZSAlIGJvbnVzIG9mIHRva2VucyB0byB0aGUgdGVhbS4KICoKICogVW5sb2NrIHRva2Vucy4KICoKICogQm9udXNBbGxvY2F0aW9uRmluYWwgbXVzdCBiZSBzZXQgYXMgdGhlIG1pbnRpbmcgYWdlbnQgZm9yIHRoZSBNaW50YWJsZVRva2VuLgogKgogKi8KY29udHJhY3QgQm9udXNGaW5hbGl6ZUFnZW50IGlzIEZpbmFsaXplQWdlbnQgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGU7CgogIC8qKiBUb3RhbCBwZXJjZW50IG9mIHRva2VucyBtaW50ZWQgdG8gdGhlIHRlYW0gYXQgdGhlIGVuZCBvZiB0aGUgc2FsZSBhcyBiYXNlIHBvaW50cwogIGJvbnVzIHRva2VucyA9IHRva2Vuc1NvbGQgKiBib251c0Jhc2VQb2ludHMgKiAwLjAwMDEgICAgICAgICAqLwogIHVpbnQgcHVibGljIGJvbnVzQmFzZVBvaW50czsKCiAgLyoqIEltcGxlbWVudGF0aW9uIGRldGFpbC4gVGhpcyBpcyB0aGUgZGl2aXNvciBvZiB0aGUgYmFzZSBwb2ludHMgKiovCiAgdWludCBwcml2YXRlIGNvbnN0YW50IGJhc2VQb2ludHNEaXZpc29yID0gMTAwMDA7CgogIC8qKiBXaGVyZSB3ZSBtb3ZlIHRoZSB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB0ZWFtTXVsdGlzaWc7CgogIC8qIEhvdyBtYW55IGJvbnVzIHRva2VucyB3ZSBhbGxvY2F0ZWQgKi8KICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRCb251czsKCiAgZnVuY3Rpb24gQm9udXNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZSBfY3Jvd2RzYWxlLCB1aW50IF9ib251c0Jhc2VQb2ludHMsIGFkZHJlc3MgX3RlYW1NdWx0aXNpZykgewogICAgcmVxdWlyZShhZGRyZXNzKF9jcm93ZHNhbGUpICE9IDAgJiYgYWRkcmVzcyhfdGVhbU11bHRpc2lnKSAhPSAwKTsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgICB0ZWFtTXVsdGlzaWcgPSBfdGVhbU11bHRpc2lnOwogICAgYm9udXNCYXNlUG9pbnRzID0gX2JvbnVzQmFzZVBvaW50czsKICB9CgogIC8qIENhbiB3ZSBydW4gZmluYWxpemUgcHJvcGVybHkgKi8KICBmdW5jdGlvbiBpc1NhbmUoQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW4ubWludEFnZW50cyhhZGRyZXNzKHRoaXMpKSAmJiB0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpOwogIH0KCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBhIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGNyb3dkc2FsZSkpOwoKICAgIC8vIEhvdyBtYW55ICUgcG9pbnRzIG9mIHRva2VucyB0aGUgZm91bmRlcnMgYW5kIG90aGVycyBnZXQKICAgIHVpbnQgdG9rZW5zU29sZCA9IGNyb3dkc2FsZS50b2tlbnNTb2xkKCk7CiAgICB1aW50IHNhbGVCYXNlUG9pbnRzID0gYmFzZVBvaW50c0Rpdmlzb3Iuc3ViKGJvbnVzQmFzZVBvaW50cyk7CiAgICBhbGxvY2F0ZWRCb251cyA9IHRva2Vuc1NvbGQubXVsKGJvbnVzQmFzZVBvaW50cykuZGl2KHNhbGVCYXNlUG9pbnRzKTsKCiAgICAvLyBNb3ZlIHRva2VucyB0byB0aGUgdGVhbSBtdWx0aXNpZyB3YWxsZXQKICAgIHRva2VuLm1pbnQodGVhbU11bHRpc2lnLCBhbGxvY2F0ZWRCb251cyk7CgogICAgLy8gTWFrZSB0b2tlbiB0cmFuc2ZlcmFibGUKICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKfQ=='.
	

]
