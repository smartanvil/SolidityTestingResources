Class {
	#name : #SRT58b7056deb51ed292614f0da1e94e7e9c589828d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT58b7056deb51ed292614f0da1e94e7e9c589828d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIFRva2VuIFRydXN0ZWUgSW1wbGVtZW50YXRpb24KLy8KLy8gQ29weXJpZ2h0IChjKSAyMDE3IE9wZW5TVCBMdGQuCi8vIGh0dHBzOi8vc2ltcGxldG9rZW4ub3JnLwovLwovLyBUaGUgTUlUIExpY2VuY2UuCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gU2FmZU1hdGggTGlicmFyeSBJbXBsZW1lbnRhdGlvbgovLwovLyBDb3B5cmlnaHQgKGMpIDIwMTcgT3BlblNUIEx0ZC4KLy8gaHR0cHM6Ly9zaW1wbGV0b2tlbi5vcmcvCi8vCi8vIFRoZSBNSVQgTGljZW5jZS4KLy8KLy8gQmFzZWQgb24gdGhlIFNhZmVNYXRoIGxpYnJhcnkgYnkgdGhlIE9wZW5aZXBwZWxpbiB0ZWFtLgovLyBDb3B5cmlnaHQgKGMpIDIwMTYgU21hcnQgQ29udHJhY3QgU29sdXRpb25zLCBJbmMuCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKLy8gVGhlIE1JVCBMaWNlbnNlLgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKbGlicmFyeSBTYWZlTWF0aCB7CgogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICogYjsKCiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CgogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CgogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKCiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CgogICAgICAgIHJldHVybiBjOwogICAgfQp9CgovLwovLyBJbXBsZW1lbnRzIGJhc2ljIG93bmVyc2hpcCB3aXRoIDItc3RlcCB0cmFuc2ZlcnMuCi8vCmNvbnRyYWN0IE93bmVkIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIHByb3Bvc2VkT3duZXI7CgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJJbml0aWF0ZWQoYWRkcmVzcyBpbmRleGVkIF9wcm9wb3NlZE93bmVyKTsKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVyQ29tcGxldGVkKGFkZHJlc3MgaW5kZXhlZCBfbmV3T3duZXIpOwoKCiAgICBmdW5jdGlvbiBPd25lZCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShpc093bmVyKG1zZy5zZW5kZXIpKTsKICAgICAgICBfOwogICAgfQoKCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2FkZHJlc3MgPT0gb3duZXIpOwogICAgfQoKCiAgICBmdW5jdGlvbiBpbml0aWF0ZU93bmVyc2hpcFRyYW5zZmVyKGFkZHJlc3MgX3Byb3Bvc2VkT3duZXIpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHByb3Bvc2VkT3duZXIgPSBfcHJvcG9zZWRPd25lcjsKCiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJJbml0aWF0ZWQoX3Byb3Bvc2VkT3duZXIpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgZnVuY3Rpb24gY29tcGxldGVPd25lcnNoaXBUcmFuc2ZlcigpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHByb3Bvc2VkT3duZXIpOwoKICAgICAgICBvd25lciA9IHByb3Bvc2VkT3duZXI7CiAgICAgICAgcHJvcG9zZWRPd25lciA9IGFkZHJlc3MoMCk7CgogICAgICAgIE93bmVyc2hpcFRyYW5zZmVyQ29tcGxldGVkKG93bmVyKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8vCi8vIEltcGxlbWVudHMgYSBtb3JlIGFkdmFuY2VkIG93bmVyc2hpcCBhbmQgcGVybWlzc2lvbiBtb2RlbCBiYXNlZCBvbiBvd25lciwKLy8gYWRtaW4gYW5kIG9wcyBwZXIgU2ltcGxlIFRva2VuIGtleSBtYW5hZ2VtZW50IHNwZWNpZmljYXRpb24uCi8vCmNvbnRyYWN0IE9wc01hbmFnZWQgaXMgT3duZWQgewoKICAgIGFkZHJlc3MgcHVibGljIG9wc0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbkFkZHJlc3M7CgogICAgZXZlbnQgQWRtaW5BZGRyZXNzQ2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgX25ld0FkZHJlc3MpOwogICAgZXZlbnQgT3BzQWRkcmVzc0NoYW5nZWQoYWRkcmVzcyBpbmRleGVkIF9uZXdBZGRyZXNzKTsKCgogICAgZnVuY3Rpb24gT3BzTWFuYWdlZCgpIHB1YmxpYwogICAgICAgIE93bmVkKCkKICAgIHsKICAgIH0KCgogICAgbW9kaWZpZXIgb25seUFkbWluKCkgewogICAgICAgIHJlcXVpcmUoaXNBZG1pbihtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KCgogICAgbW9kaWZpZXIgb25seUFkbWluT3JPcHMoKSB7CiAgICAgICAgcmVxdWlyZShpc0FkbWluKG1zZy5zZW5kZXIpIHx8IGlzT3BzKG1zZy5zZW5kZXIpKTsKICAgICAgICBfOwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5T3duZXJPckFkbWluKCkgewogICAgICAgIHJlcXVpcmUoaXNPd25lcihtc2cuc2VuZGVyKSB8fCBpc0FkbWluKG1zZy5zZW5kZXIpKTsKICAgICAgICBfOwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5T3BzKCkgewogICAgICAgIHJlcXVpcmUoaXNPcHMobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgoKICAgIGZ1bmN0aW9uIGlzQWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChhZG1pbkFkZHJlc3MgIT0gYWRkcmVzcygwKSAmJiBfYWRkcmVzcyA9PSBhZG1pbkFkZHJlc3MpOwogICAgfQoKCiAgICBmdW5jdGlvbiBpc09wcyhhZGRyZXNzIF9hZGRyZXNzKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKG9wc0FkZHJlc3MgIT0gYWRkcmVzcygwKSAmJiBfYWRkcmVzcyA9PSBvcHNBZGRyZXNzKTsKICAgIH0KCgogICAgZnVuY3Rpb24gaXNPd25lck9yT3BzKGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoaXNPd25lcihfYWRkcmVzcykgfHwgaXNPcHMoX2FkZHJlc3MpKTsKICAgIH0KCgogICAgLy8gT3duZXIgYW5kIEFkbWluIGNhbiBjaGFuZ2UgdGhlIGFkbWluIGFkZHJlc3MuIEFkZHJlc3MgY2FuIGFsc28gYmUgc2V0IHRvIDAgdG8gJ2Rpc2FibGUnIGl0LgogICAgZnVuY3Rpb24gc2V0QWRtaW5BZGRyZXNzKGFkZHJlc3MgX2FkbWluQWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyT3JBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYWRtaW5BZGRyZXNzICE9IG93bmVyKTsKICAgICAgICByZXF1aXJlKF9hZG1pbkFkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZSghaXNPcHMoX2FkbWluQWRkcmVzcykpOwoKICAgICAgICBhZG1pbkFkZHJlc3MgPSBfYWRtaW5BZGRyZXNzOwoKICAgICAgICBBZG1pbkFkZHJlc3NDaGFuZ2VkKF9hZG1pbkFkZHJlc3MpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gT3duZXIgYW5kIEFkbWluIGNhbiBjaGFuZ2UgdGhlIG9wZXJhdGlvbnMgYWRkcmVzcy4gQWRkcmVzcyBjYW4gYWxzbyBiZSBzZXQgdG8gMCB0byAnZGlzYWJsZScgaXQuCiAgICBmdW5jdGlvbiBzZXRPcHNBZGRyZXNzKGFkZHJlc3MgX29wc0FkZHJlc3MpIGV4dGVybmFsIG9ubHlPd25lck9yQWRtaW4gcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX29wc0FkZHJlc3MgIT0gb3duZXIpOwogICAgICAgIHJlcXVpcmUoX29wc0FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZSghaXNBZG1pbihfb3BzQWRkcmVzcykpOwoKICAgICAgICBvcHNBZGRyZXNzID0gX29wc0FkZHJlc3M7CgogICAgICAgIE9wc0FkZHJlc3NDaGFuZ2VkKF9vcHNBZGRyZXNzKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IFNpbXBsZVRva2VuQ29uZmlnIHsKCiAgICBzdHJpbmcgIHB1YmxpYyBjb25zdGFudCBUT0tFTl9TWU1CT0wgICA9ICJTVCI7CiAgICBzdHJpbmcgIHB1YmxpYyBjb25zdGFudCBUT0tFTl9OQU1FICAgICA9ICJTaW1wbGUgVG9rZW4iOwogICAgdWludDggICBwdWJsaWMgY29uc3RhbnQgVE9LRU5fREVDSU1BTFMgPSAxODsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBERUNJTUFMU0ZBQ1RPUiA9IDEwKip1aW50MjU2KFRPS0VOX0RFQ0lNQUxTKTsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOU19NQVggICAgID0gODAwMDAwMDAwICogREVDSU1BTFNGQUNUT1I7Cn0KCmNvbnRyYWN0IEVSQzIwSW50ZXJmYWNlIHsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKLy8KLy8gU3RhbmRhcmQgRVJDMjAgaW1wbGVtZW50YXRpb24sIHdpdGggb3duZXJzaGlwLgovLwpjb250cmFjdCBFUkMyMFRva2VuIGlzIEVSQzIwSW50ZXJmYWNlLCBPd25lZCB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgc3RyaW5nICBwcml2YXRlIHRva2VuTmFtZTsKICAgIHN0cmluZyAgcHJpdmF0ZSB0b2tlblN5bWJvbDsKICAgIHVpbnQ4ICAgcHJpdmF0ZSB0b2tlbkRlY2ltYWxzOwogICAgdWludDI1NiBpbnRlcm5hbCB0b2tlblRvdGFsU3VwcGx5OwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgICBmdW5jdGlvbiBFUkMyMFRva2VuKHN0cmluZyBfc3ltYm9sLCBzdHJpbmcgX25hbWUsIHVpbnQ4IF9kZWNpbWFscywgdWludDI1NiBfdG90YWxTdXBwbHkpIHB1YmxpYwogICAgICAgIE93bmVkKCkKICAgIHsKICAgICAgICB0b2tlblN5bWJvbCAgICAgID0gX3N5bWJvbDsKICAgICAgICB0b2tlbk5hbWUgICAgICAgID0gX25hbWU7CiAgICAgICAgdG9rZW5EZWNpbWFscyAgICA9IF9kZWNpbWFsczsKICAgICAgICB0b2tlblRvdGFsU3VwcGx5ID0gX3RvdGFsU3VwcGx5OwogICAgICAgIGJhbGFuY2VzW293bmVyXSAgPSBfdG90YWxTdXBwbHk7CgogICAgICAgIC8vIEFjY29yZGluZyB0byB0aGUgRVJDMjAgc3RhbmRhcmQsIGEgdG9rZW4gY29udHJhY3Qgd2hpY2ggY3JlYXRlcyBuZXcgdG9rZW5zIHNob3VsZCB0cmlnZ2VyCiAgICAgICAgLy8gYSBUcmFuc2ZlciBldmVudCBhbmQgdHJhbnNmZXJzIG9mIDAgdmFsdWVzIG11c3QgYWxzbyBmaXJlIHRoZSBldmVudC4KICAgICAgICBUcmFuc2ZlcigweDAsIG93bmVyLCBfdG90YWxTdXBwbHkpOwogICAgfQoKCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHRva2VuTmFtZTsKICAgIH0KCgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHRva2VuU3ltYm9sOwogICAgfQoKCiAgICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHRva2VuRGVjaW1hbHM7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b2tlblRvdGFsU3VwcGx5OwogICAgfQoKCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBBY2NvcmRpbmcgdG8gdGhlIEVJUDIwIHNwZWMsICJ0cmFuc2ZlcnMgb2YgMCB2YWx1ZXMgTVVTVCBiZSB0cmVhdGVkIGFzIG5vcm1hbAogICAgICAgIC8vIHRyYW5zZmVycyBhbmQgZmlyZSB0aGUgVHJhbnNmZXIgZXZlbnQiLgogICAgICAgIC8vIEFsc28sIHNob3VsZCB0aHJvdyBpZiBub3QgZW5vdWdoIGJhbGFuY2UuIFRoaXMgaXMgdGFrZW4gY2FyZSBvZiBieSBTYWZlTWF0aC4KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8vCi8vIFNpbXBsZVRva2VuIGlzIGEgc3RhbmRhcmQgRVJDMjAgdG9rZW4gd2l0aCBzb21lIGFkZGl0aW9uYWwgZnVuY3Rpb25hbGl0eToKLy8gLSBJdCBoYXMgYSBjb25jZXB0IG9mIGZpbmFsaXplCi8vIC0gQmVmb3JlIGZpbmFsaXplLCBub2JvZHkgY2FuIHRyYW5zZmVyIHRva2VucyBleGNlcHQ6Ci8vICAgICAtIE93bmVyIGFuZCBvcGVyYXRpb25zIGNhbiB0cmFuc2ZlciB0b2tlbnMKLy8gICAgIC0gQW55Ym9keSBjYW4gc2VuZCBiYWNrIHRva2VucyB0byBvd25lcgovLyAtIEFmdGVyIGZpbmFsaXplLCBubyByZXN0cmljdGlvbnMgb24gdG9rZW4gdHJhbnNmZXJzCi8vCgovLwovLyBQZXJtaXNzaW9ucywgYWNjb3JkaW5nIHRvIHRoZSBTVCBrZXkgbWFuYWdlbWVudCBzcGVjaWZpY2F0aW9uLgovLwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE93bmVyICAgIEFkbWluICAgT3BzCi8vIHRyYW5zZmVyIChiZWZvcmUgZmluYWxpemUpICAgICAgICAgICB4ICAgICAgICAgICAgICAgeAovLyB0cmFuc2ZlckZvcm0gKGJlZm9yZSBmaW5hbGl6ZSkgICAgICAgeCAgICAgICAgICAgICAgIHgKLy8gZmluYWxpemUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8KCmNvbnRyYWN0IFNpbXBsZVRva2VuIGlzIEVSQzIwVG9rZW4sIE9wc01hbmFnZWQsIFNpbXBsZVRva2VuQ29uZmlnIHsKCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgQnVybnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgRmluYWxpemVkKCk7CgoKICAgIGZ1bmN0aW9uIFNpbXBsZVRva2VuKCkgcHVibGljCiAgICAgICAgRVJDMjBUb2tlbihUT0tFTl9TWU1CT0wsIFRPS0VOX05BTUUsIFRPS0VOX0RFQ0lNQUxTLCBUT0tFTlNfTUFYKQogICAgICAgIE9wc01hbmFnZWQoKQogICAgewogICAgICAgIGZpbmFsaXplZCA9IGZhbHNlOwogICAgfQoKCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgc3RhbmRhcmQgdHJhbnNmZXIgbWV0aG9kIHRoYXQgdGFrZXMgaW50byBhY2NvdW50IHRoZSBmaW5hbGl6ZSBmbGFnLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgY2hlY2tUcmFuc2ZlckFsbG93ZWQobXNnLnNlbmRlciwgX3RvKTsKCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCgogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgdGhlIHN0YW5kYXJkIHRyYW5zZmVyRnJvbSBtZXRob2QgdGhhdCB0YWtlcyBpbnRvIGFjY291bnQgdGhlIGZpbmFsaXplIGZsYWcuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgY2hlY2tUcmFuc2ZlckFsbG93ZWQobXNnLnNlbmRlciwgX3RvKTsKCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKCiAgICBmdW5jdGlvbiBjaGVja1RyYW5zZmVyQWxsb3dlZChhZGRyZXNzIF9zZW5kZXIsIGFkZHJlc3MgX3RvKSBwcml2YXRlIHZpZXcgewogICAgICAgIGlmIChmaW5hbGl6ZWQpIHsKICAgICAgICAgICAgLy8gRXZlcnlib2R5IHNob3VsZCBiZSBvayB0byB0cmFuc2ZlciBvbmNlIHRoZSB0b2tlbiBpcyBmaW5hbGl6ZWQuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIE93bmVyIGFuZCBPcHMgYXJlIGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zIGJlZm9yZSB0aGUgc2FsZSBpcyBmaW5hbGl6ZWQuCiAgICAgICAgLy8gVGhpcyBhbGxvd3MgdGhlIHRva2VucyB0byBtb3ZlIGZyb20gdGhlIFRva2VuU2FsZSBjb250cmFjdCB0byBhIGJlbmVmaWNpYXJ5LgogICAgICAgIC8vIFdlIGFsc28gYWxsb3cgc29tZW9uZSB0byBzZW5kIHRva2VucyBiYWNrIHRvIHRoZSBvd25lci4gVGhpcyBpcyB1c2VmdWwgYW1vbmcgb3RoZXIKICAgICAgICAvLyBjYXNlcywgZm9yIHRoZSBUcnVzdGVlIHRvIHRyYW5zZmVyIHVubG9ja2VkIHRva2VucyBiYWNrIHRvIHRoZSBvd25lciAocmVjbGFpbVRva2VucykuCiAgICAgICAgcmVxdWlyZShpc093bmVyT3JPcHMoX3NlbmRlcikgfHwgX3RvID09IG93bmVyKTsKICAgIH0KCiAgICAvLyBJbXBsZW1lbnQgYSBidXJuIGZ1bmN0aW9uIHRvIHBlcm1pdCBtc2cuc2VuZGVyIHRvIHJlZHVjZSBpdHMgYmFsYW5jZQogICAgLy8gd2hpY2ggYWxzbyByZWR1Y2VzIHRva2VuVG90YWxTdXBwbHkKICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgdG9rZW5Ub3RhbFN1cHBseSA9IHRva2VuVG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CgogICAgICAgIEJ1cm50KG1zZy5zZW5kZXIsIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBGaW5hbGl6ZSBtZXRob2QgbWFya3MgdGhlIHBvaW50IHdoZXJlIHRva2VuIHRyYW5zZmVycyBhcmUgZmluYWxseSBhbGxvd2VkIGZvciBldmVyeWJvZHkuCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIGV4dGVybmFsIG9ubHlBZG1pbiByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKCFmaW5hbGl6ZWQpOwoKICAgICAgICBmaW5hbGl6ZWQgPSB0cnVlOwoKICAgICAgICBGaW5hbGl6ZWQoKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8vCi8vIEltcGxlbWVudHMgYSBzaW1wbGUgdHJ1c3RlZSB3aGljaCBjYW4gcmVsZWFzZSB0b2tlbnMgYmFzZWQgb24KLy8gYW4gZXhwbGljaXQgY2FsbCBmcm9tIHRoZSBvd25lci4KLy8KCi8vCi8vIFBlcm1pc3Npb25zLCBhY2NvcmRpbmcgdG8gdGhlIFNUIGtleSBtYW5hZ2VtZW50IHNwZWNpZmljYXRpb24uCi8vCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPd25lciAgICBBZG1pbiAgIE9wcyAgIFJldm9rZQovLyBncmFudEFsbG9jYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICB4ICAgICAgeAovLyByZXZva2VBbGxvY2F0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8gcHJvY2Vzc0FsbG9jYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8gcmVjbGFpbVRva2VucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeAovLyBzZXRSZXZva2VBZGRyZXNzICAgICAgICAgICAgICAgICB4ICAgICAgICAgICAgICAgICAgICAgIHgKLy8KCmNvbnRyYWN0IFRydXN0ZWUgaXMgT3BzTWFuYWdlZCB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoKICAgIFNpbXBsZVRva2VuIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwoKICAgIHN0cnVjdCBBbGxvY2F0aW9uIHsKICAgICAgICB1aW50MjU2IGFtb3VudEdyYW50ZWQ7CiAgICAgICAgdWludDI1NiBhbW91bnRUcmFuc2ZlcnJlZDsKICAgICAgICBib29sICAgIHJldm9rYWJsZTsKICAgIH0KCiAgICAvLyBUaGUgdHJ1c3RlZSBoYXMgYSBzcGVjaWFsICdyZXZva2UnIGtleSB3aGljaCBpcyBhbGxvd2VkIHRvIHJldm9rZSBhbGxvY2F0aW9ucy4KICAgIGFkZHJlc3MgcHVibGljIHJldm9rZUFkZHJlc3M7CgogICAgLy8gVG90YWwgbnVtYmVyIG9mIHRva2VucyB0aGF0IGFyZSBjdXJyZW50bHkgYWxsb2NhdGVkLgogICAgLy8gVGhpcyBkb2VzIG5vdCBpbmNsdWRlIHRva2VucyB0aGF0IGhhdmUgYmVlbiBwcm9jZXNzZWQgKHNlbnQgdG8gYW4gYWRkcmVzcykgYWxyZWFkeSBvcgogICAgLy8gdGhlIG9uZXMgaW4gdGhlIHRydXN0ZWUncyBhY2NvdW50IHRoYXQgaGF2ZSBub3QgYmVlbiBhbGxvY2F0ZWQgeWV0LgogICAgdWludDI1NiBwdWJsaWMgdG90YWxMb2NrZWQ7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBBbGxvY2F0aW9uKSBwdWJsaWMgYWxsb2NhdGlvbnM7CgoKICAgIC8vCiAgICAvLyBFdmVudHMKICAgIC8vCiAgICBldmVudCBBbGxvY2F0aW9uR3JhbnRlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfYWNjb3VudCwgdWludDI1NiBfYW1vdW50LCBib29sIF9yZXZva2FibGUpOwogICAgZXZlbnQgQWxsb2NhdGlvblJldm9rZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX2FjY291bnQsIHVpbnQyNTYgX2Ftb3VudFJldm9rZWQpOwogICAgZXZlbnQgQWxsb2NhdGlvblByb2Nlc3NlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfYWNjb3VudCwgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IFJldm9rZUFkZHJlc3NDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBfbmV3QWRkcmVzcyk7CiAgICBldmVudCBUb2tlbnNSZWNsYWltZWQodWludDI1NiBfYW1vdW50KTsKCgogICAgZnVuY3Rpb24gVHJ1c3RlZShTaW1wbGVUb2tlbiBfdG9rZW5Db250cmFjdCkgcHVibGljCiAgICAgICAgT3BzTWFuYWdlZCgpCiAgICB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKF90b2tlbkNvbnRyYWN0KSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdG9rZW5Db250cmFjdCA9IF90b2tlbkNvbnRyYWN0OwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5T3duZXJPclJldm9rZSgpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikgfHwgaXNSZXZva2UobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgoKICAgIG1vZGlmaWVyIG9ubHlSZXZva2UoKSB7CiAgICAgICAgcmVxdWlyZShpc1Jldm9rZShtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KCgogICAgZnVuY3Rpb24gaXNSZXZva2UoYWRkcmVzcyBfYWRkcmVzcykgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKHJldm9rZUFkZHJlc3MgIT0gYWRkcmVzcygwKSAmJiBfYWRkcmVzcyA9PSByZXZva2VBZGRyZXNzKTsKICAgIH0KCgogICAgLy8gT3duZXIgYW5kIHJldm9rZSBjYW4gY2hhbmdlIHRoZSByZXZva2UgYWRkcmVzcy4gQWRkcmVzcyBjYW4gYWxzbyBiZSBzZXQgdG8gMCB0byAnZGlzYWJsZScgaXQuCiAgICBmdW5jdGlvbiBzZXRSZXZva2VBZGRyZXNzKGFkZHJlc3MgX3Jldm9rZUFkZHJlc3MpIGV4dGVybmFsIG9ubHlPd25lck9yUmV2b2tlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9yZXZva2VBZGRyZXNzICE9IG93bmVyKTsKICAgICAgICByZXF1aXJlKCFpc0FkbWluKF9yZXZva2VBZGRyZXNzKSk7CiAgICAgICAgcmVxdWlyZSghaXNPcHMoX3Jldm9rZUFkZHJlc3MpKTsKCiAgICAgICAgcmV2b2tlQWRkcmVzcyA9IF9yZXZva2VBZGRyZXNzOwoKICAgICAgICBSZXZva2VBZGRyZXNzQ2hhbmdlZChfcmV2b2tlQWRkcmVzcyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBBbGxvd3MgYWRtaW4gb3Igb3BzIHRvIGNyZWF0ZSBuZXcgYWxsb2NhdGlvbnMgZm9yIGEgc3BlY2lmaWMgYWNjb3VudC4KICAgIGZ1bmN0aW9uIGdyYW50QWxsb2NhdGlvbihhZGRyZXNzIF9hY2NvdW50LCB1aW50MjU2IF9hbW91bnQsIGJvb2wgX3Jldm9rYWJsZSkgcHVibGljIG9ubHlBZG1pbk9yT3BzIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9hY2NvdW50ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2FjY291bnQgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CgogICAgICAgIC8vIENhbid0IGNyZWF0ZSBhbiBhbGxvY2F0aW9uIGlmIHRoZXJlIGlzIGFscmVhZHkgb25lIGZvciB0aGlzIGFjY291bnQuCiAgICAgICAgcmVxdWlyZShhbGxvY2F0aW9uc1tfYWNjb3VudF0uYW1vdW50R3JhbnRlZCA9PSAwKTsKCiAgICAgICAgaWYgKGlzT3BzKG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgIC8vIE9uY2UgdGhlIHRva2VuIGNvbnRyYWN0IGlzIGZpbmFsaXplZCwgdGhlIG9wcyBrZXkgc2hvdWxkIG5vdCBiZSBhYmxlIHRvIGdyYW50IGFsbG9jYXRpb25zIGFueSBsb25nZXIuCiAgICAgICAgICAgIC8vIEJlZm9yZSBmaW5hbGl6ZWQsIGl0IGlzIHVzZWQgYnkgdGhlIFRva2VuU2FsZSBjb250cmFjdCB0byBhbGxvY2F0ZSBwcmUtc2FsZXMuCiAgICAgICAgICAgIHJlcXVpcmUoIXRva2VuQ29udHJhY3QuZmluYWxpemVkKCkpOwogICAgICAgIH0KCiAgICAgICAgdG90YWxMb2NrZWQgPSB0b3RhbExvY2tlZC5hZGQoX2Ftb3VudCk7CiAgICAgICAgcmVxdWlyZSh0b3RhbExvY2tlZCA8PSB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgIGFsbG9jYXRpb25zW19hY2NvdW50XSA9IEFsbG9jYXRpb24oewogICAgICAgICAgICBhbW91bnRHcmFudGVkICAgICA6IF9hbW91bnQsCiAgICAgICAgICAgIGFtb3VudFRyYW5zZmVycmVkIDogMCwKICAgICAgICAgICAgcmV2b2thYmxlICAgICAgICAgOiBfcmV2b2thYmxlCiAgICAgICAgfSk7CgogICAgICAgIEFsbG9jYXRpb25HcmFudGVkKG1zZy5zZW5kZXIsIF9hY2NvdW50LCBfYW1vdW50LCBfcmV2b2thYmxlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEFsbG93cyB0aGUgcmV2b2tlIGtleSB0byByZXZva2UgYWxsb2NhdGlvbnMsIGlmIHJldm9rZSBpcyBhbGxvd2VkLgogICAgZnVuY3Rpb24gcmV2b2tlQWxsb2NhdGlvbihhZGRyZXNzIF9hY2NvdW50KSBleHRlcm5hbCBvbmx5UmV2b2tlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9hY2NvdW50ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBBbGxvY2F0aW9uIG1lbW9yeSBhbGxvY2F0aW9uID0gYWxsb2NhdGlvbnNbX2FjY291bnRdOwoKICAgICAgICByZXF1aXJlKGFsbG9jYXRpb24ucmV2b2thYmxlKTsKCiAgICAgICAgdWludDI1NiBvd25lclJlZnVuZCA9IGFsbG9jYXRpb24uYW1vdW50R3JhbnRlZC5zdWIoYWxsb2NhdGlvbi5hbW91bnRUcmFuc2ZlcnJlZCk7CgogICAgICAgIGRlbGV0ZSBhbGxvY2F0aW9uc1tfYWNjb3VudF07CgogICAgICAgIHRvdGFsTG9ja2VkID0gdG90YWxMb2NrZWQuc3ViKG93bmVyUmVmdW5kKTsKCiAgICAgICAgQWxsb2NhdGlvblJldm9rZWQobXNnLnNlbmRlciwgX2FjY291bnQsIG93bmVyUmVmdW5kKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIFB1c2ggbW9kZWwgd2hpY2ggYWxsb3dzIG9wcyB0byB0cmFuc2ZlciB0b2tlbnMgdG8gdGhlIGJlbmVmaWNpYXJ5LgogICAgLy8gVGhlIGV4YWN0IGFtb3VudCB0byB0cmFuc2ZlciBpcyBjYWxjdWxhdGVkIGJhc2VkIG9uIGFncmVlbWVudHMgd2l0aAogICAgLy8gdGhlIGJlbmVmaWNpYXJpZXMuIEhlcmUgd2Ugb25seSByZXN0cmljdCB0aGF0IHRoZSB0b3RhbCBhbW91bnQgdHJhbnNmZXJlZCBjYW5ub3QKICAgIC8vIGV4Y2VlZCB3aGF0IGhhcyBiZWVuIGdyYW50ZWQuCiAgICBmdW5jdGlvbiBwcm9jZXNzQWxsb2NhdGlvbihhZGRyZXNzIF9hY2NvdW50LCB1aW50MjU2IF9hbW91bnQpIGV4dGVybmFsIG9ubHlPcHMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX2FjY291bnQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CgogICAgICAgIEFsbG9jYXRpb24gc3RvcmFnZSBhbGxvY2F0aW9uID0gYWxsb2NhdGlvbnNbX2FjY291bnRdOwoKICAgICAgICByZXF1aXJlKGFsbG9jYXRpb24uYW1vdW50R3JhbnRlZCA+IDApOwoKICAgICAgICB1aW50MjU2IHRyYW5zZmVyYWJsZSA9IGFsbG9jYXRpb24uYW1vdW50R3JhbnRlZC5zdWIoYWxsb2NhdGlvbi5hbW91bnRUcmFuc2ZlcnJlZCk7CgogICAgICAgIGlmICh0cmFuc2ZlcmFibGUgPCBfYW1vdW50KSB7CiAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgYWxsb2NhdGlvbi5hbW91bnRUcmFuc2ZlcnJlZCA9IGFsbG9jYXRpb24uYW1vdW50VHJhbnNmZXJyZWQuYWRkKF9hbW91bnQpOwoKICAgICAgICAvLyBOb3RlIHRoYXQgdHJhbnNmZXIgd2lsbCBmYWlsIGlmIHRoZSB0b2tlbiBjb250cmFjdCBoYXMgbm90IGJlZW4gZmluYWxpemVkIHlldC4KICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3QudHJhbnNmZXIoX2FjY291bnQsIF9hbW91bnQpKTsKCiAgICAgICAgdG90YWxMb2NrZWQgPSB0b3RhbExvY2tlZC5zdWIoX2Ftb3VudCk7CgogICAgICAgIEFsbG9jYXRpb25Qcm9jZXNzZWQobXNnLnNlbmRlciwgX2FjY291bnQsIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gQWxsb3dzIHRoZSBhZG1pbiB0byBjbGFpbSBiYWNrIGFsbCB0b2tlbnMgdGhhdCBhcmUgbm90IGN1cnJlbnRseSBhbGxvY2F0ZWQuCiAgICAvLyBOb3RlIHRoYXQgdGhlIHRydXN0ZWUgc2hvdWxkIGJlIGFibGUgdG8gbW92ZSB0b2tlbnMgZXZlbiBiZWZvcmUgdGhlIHRva2VuIGlzCiAgICAvLyBmaW5hbGl6ZWQgYmVjYXVzZSBTaW1wbGVUb2tlbiBhbGxvd3Mgc2VuZGluZyBiYWNrIHRvIG93bmVyIHNwZWNpZmljYWxseS4KICAgIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbnMoKSBleHRlcm5hbCBvbmx5QWRtaW4gcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQyNTYgb3duQmFsYW5jZSA9IHRva2VuQ29udHJhY3QuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLyBJZiBiYWxhbmNlIDw9IGFtb3VudCBsb2NrZWQsIHRoZXJlIGlzIG5vdGhpbmcgdG8gcmVjbGFpbS4KICAgICAgICByZXF1aXJlKG93bkJhbGFuY2UgPiB0b3RhbExvY2tlZCk7CgogICAgICAgIHVpbnQyNTYgYW1vdW50UmVjbGFpbWVkID0gb3duQmFsYW5jZS5zdWIodG90YWxMb2NrZWQpOwoKICAgICAgICBhZGRyZXNzIHRva2VuT3duZXIgPSB0b2tlbkNvbnRyYWN0Lm93bmVyKCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbk93bmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3QudHJhbnNmZXIodG9rZW5Pd25lciwgYW1vdW50UmVjbGFpbWVkKSk7CgogICAgICAgIFRva2Vuc1JlY2xhaW1lZChhbW91bnRSZWNsYWltZWQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBQYXVzYWJsZSBDb250cmFjdCBJbXBsZW1lbnRhdGlvbgovLwovLyBDb3B5cmlnaHQgKGMpIDIwMTcgT3BlblNUIEx0ZC4KLy8gaHR0cHM6Ly9zaW1wbGV0b2tlbi5vcmcvCi8vCi8vIFRoZSBNSVQgTGljZW5jZS4KLy8KLy8gQmFzZWQgb24gdGhlIFBhdXNhYmxlIGNvbnRyYWN0IGJ5IHRoZSBPcGVuWmVwcGVsaW4gdGVhbS4KLy8gQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgovLyBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5Ci8vIFRoZSBNSVQgTGljZW5zZS4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29udHJhY3QgUGF1c2FibGUgaXMgT3BzTWFuYWdlZCB7CgogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgoKICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgoKICBmdW5jdGlvbiBwYXVzZSgpIHB1YmxpYyBvbmx5QWRtaW4gd2hlbk5vdFBhdXNlZCB7CiAgICBwYXVzZWQgPSB0cnVlOwoKICAgIFBhdXNlKCk7CiAgfQoKCiAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5QWRtaW4gd2hlblBhdXNlZCB7CiAgICBwYXVzZWQgPSBmYWxzZTsKCiAgICBVbnBhdXNlKCk7CiAgfQp9Cgpjb250cmFjdCBUb2tlblNhbGVDb25maWcgaXMgU2ltcGxlVG9rZW5Db25maWcgewoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBIQVNFMV9TVEFSVF9USU1FICAgICAgICAgPSAxNTEwNjY0NDAwOyAvLyAyMDE3LTExLTE0LCAxMzowMDowMCBVVEMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBIQVNFMl9TVEFSVF9USU1FICAgICAgICAgPSAxNTEwNzUwODAwOyAvLyAyMDE3LTExLTE1LCAxMzowMDowMCBVVEMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEVORF9USU1FICAgICAgICAgICAgICAgICAgPSAxNTEyMTMzMTk5OyAvLyAyMDE3LTEyLTAxLCAxMjo1OTo1OSBVVEMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENPTlRSSUJVVElPTl9NSU4gICAgICAgICAgPSAwLjEgZXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBDT05UUklCVVRJT05fTUFYICAgICAgICAgID0gMTAwMDAuMCBldGhlcjsKCiAgICAvLyBUaGlzIGlzIHRoZSBtYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgZWFjaCBpbmRpdmlkdWFsIGFjY291bnQgaXMgYWxsb3dlZCB0bwogICAgLy8gYnV5IGR1cmluZyBQaGFzZSAxIG9mIHRoZSB0b2tlbiBzYWxlICh3aGl0ZWxpc3RlZCBwaGFzZSkKICAgIC8vIENhbGN1bGF0ZWQgYmFzZWQgb24gMzAwIFVTRC9FVEggKiAxMCBFVEggLyAwLjA4MzMgVVNEIC8gdG9rZW4gPSB+MzYsMDAwCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQSEFTRTFfQUNDT1VOVF9UT0tFTlNfTUFYID0gMzYwMDAgICAgICogREVDSU1BTFNGQUNUT1I7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX1NBTEUgICAgICAgICAgICAgICA9IDI0MDAwMDAwMCAqIERFQ0lNQUxTRkFDVE9SOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX0ZPVU5ERVJTICAgICAgICAgICA9IDgwMDAwMDAwICAqIERFQ0lNQUxTRkFDVE9SOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX0FEVklTT1JTICAgICAgICAgICA9IDgwMDAwMDAwICAqIERFQ0lNQUxTRkFDVE9SOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX0VBUkxZX0JBQ0tFUlMgICAgICA9IDQ0ODg0ODMxICAqIERFQ0lNQUxTRkFDVE9SOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX0FDQ0VMRVJBVE9SICAgICAgICA9IDIxNzYwMDAwMCAqIERFQ0lNQUxTRkFDVE9SOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX0ZVVFVSRSAgICAgICAgICAgICA9IDEzNzUxNTE2OSAqIERFQ0lNQUxTRkFDVE9SOwoKICAgIC8vIFdlIHVzZSBhIGRlZmF1bHQgZm9yIHdoZW4gdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkIGJ1dCB0aGlzIGNhbiBiZSBjaGFuZ2VkIGFmdGVyd2FyZHMKICAgIC8vIGJ5IGNhbGxpbmcgdGhlIHNldFRva2Vuc1BlcktFdGhlciBmdW5jdGlvbgogICAgLy8gRm9yIHRoZSBwdWJsaWMgc2FsZSwgdG9rZW5zIGFyZSBwcmljZWQgYXQgMC4wODMzIFVTRC90b2tlbi4KICAgIC8vIFNvIGlmIHdlIGhhdmUgMzAwIFVTRC9FVEggLT4gMzAwLDAwMCBVU0QvS0VUSCAvIDAuMDgzMyBVU0QvdG9rZW4gPSB+Myw2MDAsMDAwCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTlNfUEVSX0tFVEhFUiAgICAgICAgID0gMzYwMDAwMDsKCiAgICAvLyBDb25zdGFudCB1c2VkIGJ5IGJ1eVRva2VucyBhcyBwYXJ0IG9mIHRoZSBjb3N0IDwtPiB0b2tlbnMgY29udmVyc2lvbi4KICAgIC8vIDE4IGZvciBFVEggLT4gV0VJLCBUT0tFTl9ERUNJTUFMUyAoMTggZm9yIFNpbXBsZSBUb2tlbiksIDMgZm9yIHRoZSBLIGluIHRva2Vuc1BlcktFdGhlci4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0RJVklERVIgICAgICAgICAgPSAxMCoqKHVpbnQyNTYoMTgpIC0gVE9LRU5fREVDSU1BTFMgKyAzKTsKCn0KCi8vCi8vIEltcGxlbWVudGF0aW9uIG9mIHRoZSAxc3QgdG9rZW4gc2FsZSBmb3IgU2ltcGxlIFRva2VuCi8vCi8vICogTGlmZWN5Y2xlICoKLy8gSW5pdGlhbGl6YXRpb24gc2VxdWVuY2Ugc2hvdWxkIGJlIGFzIGZvbGxvdzoKLy8gICAgMS4gRGVwbG95IFNpbXBsZVRva2VuIGNvbnRyYWN0Ci8vICAgIDIuIERlcGxveSBUcnVzdGVlIGNvbnRyYWN0Ci8vICAgIDMuIERlcGxveSBUb2tlblNhbGUgY29udHJhY3QKLy8gICAgNC4gU2V0IG9wZXJhdGlvbnNBZGRyZXNzIG9mIFNpbXBsZVRva2VuIGNvbnRyYWN0IHRvIFRva2VuU2FsZSBjb250cmFjdAovLyAgICA1LiBTZXQgb3BlcmF0aW9uc0FkZHJlc3Mgb2YgVHJ1c3RlZSBjb250cmFjdCB0byBUb2tlblNhbGUgY29udHJhY3QKLy8gICAgNi4gU2V0IG9wZXJhdGlvbnNBZGRyZXNzIG9mIFRva2VuU2FsZSBjb250cmFjdCB0byBzb21lIGFkZHJlc3MKLy8gICAgNy4gVHJhbnNmZXIgdG9rZW5zIGZyb20gb3duZXIgdG8gVG9rZW5TYWxlIGNvbnRyYWN0Ci8vICAgIDguIFRyYW5zZmVyIHRva2VucyBmcm9tIG93bmVyIHRvIFRydXN0ZWUgY29udHJhY3QKLy8gICAgOS4gSW5pdGlhbGl6ZSBUb2tlblNhbGUgY29udHJhY3QKLy8KLy8gUHJlLXNhbGUgc2VxdWVuY2U6Ci8vICAgIC0gU2V0IHRva2Vuc1BlcktFdGhlcgovLyAgICAtIFNldCBwaGFzZTFBY2NvdW50VG9rZW5zTWF4Ci8vICAgIC0gQWRkIHByZXNhbGVzCi8vICAgIC0gQWRkIGFsbG9jYXRpb25zIGZvciBmb3VuZGVycywgYWR2aXNvcnMsIGV0Yy4KLy8gICAgLSBVcGRhdGUgd2hpdGVsaXN0Ci8vCi8vIEFmdGVyLXNhbGUgc2VxdWVuY2U6Ci8vICAgIDEuIEZpbmFsaXplIHRoZSBUb2tlblNhbGUgY29udHJhY3QKLy8gICAgMi4gRmluYWxpemUgdGhlIFNpbXBsZVRva2VuIGNvbnRyYWN0Ci8vICAgIDMuIFNldCBvcGVyYXRpb25zQWRkcmVzcyBvZiBUb2tlblNhbGUgY29udHJhY3QgdG8gMAovLyAgICA0LiBTZXQgb3BlcmF0aW9uc0FkZHJlc3Mgb2YgU2ltcGxlVG9rZW4gY29udHJhY3QgdG8gMAovLyAgICA1LiBTZXQgb3BlcmF0aW9uc0FkZHJlc3Mgb2YgVHJ1c3RlZSBjb250cmFjdCB0byBzb21lIGFkZHJlc3MKLy8KLy8gQW55dGltZQovLyAgICAtIEFkZC9SZW1vdmUgYWxsb2NhdGlvbnMKLy8KCi8vCi8vIFBlcm1pc3Npb25zLCBhY2NvcmRpbmcgdG8gdGhlIFNUIGtleSBtYW5hZ2VtZW50IHNwZWNpZmljYXRpb24uCi8vCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPd25lciAgICBBZG1pbiAgIE9wcwovLyBpbml0aWFsaXplICAgICAgICAgICAgICAgICAgICAgICB4Ci8vIGNoYW5nZVdhbGxldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8gdXBkYXRlV2hpdGVsaXN0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8gc2V0VG9rZW5zUGVyS0V0aGVyICAgICAgICAgICAgICAgICAgICAgICAgeAovLyBzZXRQaGFzZTFBY2NvdW50VG9rZW5zTWF4ICAgICAgICAgICAgICAgICB4Ci8vIGFkZFByZXNhbGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8gcGF1c2UgLyB1bnBhdXNlICAgICAgICAgICAgICAgICAgICAgICAgICAgeAovLyByZWNsYWltVG9rZW5zICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4Ci8vIGJ1cm5VbnNvbGRUb2tlbnMgICAgICAgICAgICAgICAgICAgICAgICAgIHgKLy8gZmluYWxpemUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeAovLwoKY29udHJhY3QgVG9rZW5TYWxlIGlzIE9wc01hbmFnZWQsIFBhdXNhYmxlLCBUb2tlblNhbGVDb25maWcgeyAvLyBQYXVzYWJsZSBpcyBhbHNvIE93bmVkCgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoKICAgIC8vIFdlIGtlZXAgdHJhY2sgb2Ygd2hldGhlciB0aGUgc2FsZSBoYXMgYmVlbiBmaW5hbGl6ZWQsIGF0IHdoaWNoIHBvaW50CiAgICAvLyBubyBhZGRpdGlvbmFsIGNvbnRyaWJ1dGlvbnMgd2lsbCBiZSBwZXJtaXR0ZWQuCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgogICAgLy8gVGhlIHNhbGUgZW5kIHRpbWUgaXMgaW5pdGlhbGx5IGRlZmluZWQgYnkgdGhlIEVORF9USU1FIGNvbnN0YW50IGJ1dCBpdAogICAgLy8gbWF5IGdldCBleHRlbmRlZCBpZiB0aGUgc2FsZSBpcyBwYXVzZWQuCiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwogICAgdWludDI1NiBwdWJsaWMgcGF1c2VkVGltZTsKCiAgICAvLyBOdW1iZXIgb2YgdG9rZW5zIHBlciAxMDAwIEVUSC4gU2VlIFRva2VuU2FsZUNvbmZpZyBmb3IgZGV0YWlscy4KICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1BlcktFdGhlcjsKCiAgICAvLyBLZWVwcyB0cmFjayBvZiB0aGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gYWNjb3VudCBpcyBhbGxvd2VkIHRvIHB1cmNoYXNlIGluIHBoYXNlIDEuCiAgICB1aW50MjU2IHB1YmxpYyBwaGFzZTFBY2NvdW50VG9rZW5zTWF4OwoKICAgIC8vIEFkZHJlc3Mgd2hlcmUgdGhlIGZ1bmRzIGNvbGxlY3RlZCBkdXJpbmcgdGhlIHNhbGUgd2lsbCBiZSBmb3J3YXJkZWQuCiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAgLy8gVG9rZW4gY29udHJhY3QgdGhhdCB0aGUgc2FsZSBjb250cmFjdCB3aWxsIGludGVyYWN0IHdpdGguCiAgICBTaW1wbGVUb2tlbiBwdWJsaWMgdG9rZW5Db250cmFjdDsKCiAgICAvLyBUcnVzdGVlIGNvbnRyYWN0IHRvIGhvbGQgb24gdG9rZW4gYmFsYW5jZXMuIFRoZSBmb2xsb3dpbmcgdG9rZW4gcG9vbHMgd2lsbCBiZSBoZWxkIGJ5IHRydXN0ZWU6CiAgICAvLyAgICAtIEZvdW5kZXJzCiAgICAvLyAgICAtIEFkdmlzb3JzCiAgICAvLyAgICAtIEVhcmx5IGludmVzdG9ycwogICAgLy8gICAgLSBQcmVzYWxlcwogICAgVHJ1c3RlZSBwdWJsaWMgdHJ1c3RlZUNvbnRyYWN0OwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCBkdXJpbmcgcHJlc2FsZSArIHB1YmxpYyBzYWxlLiBFeGNsdWRlcyBwcmUtc2FsZSBib251c2VzLgogICAgdWludDI1NiBwdWJsaWMgdG90YWxUb2tlbnNTb2xkOwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgZ2l2ZW4gYXMgYm9udXMgZHVyaW5nIHByZXNhbGUuIFdpbGwgaW5mbHVlbmNlIGFjY2VsZXJhdG9yIHRva2VuIGJhbGFuY2UuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFByZXNhbGVCYXNlOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxQcmVzYWxlQm9udXM7CgogICAgLy8gTWFwIG9mIGFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiB3aGl0ZWxpc3RlZCBpbiBhZHZhbmNlIChhbmQgcGFzc2VkIEtZQykuCiAgICAvLyBUaGUgd2hpdGVsaXN0IHZhbHVlIGluZGljYXRlcyB3aGF0IHBoYXNlICgxIG9yIDIpIHRoZSBhZGRyZXNzIGhhcyBiZWVuIHdoaXRlbGlzdGVkIGZvci4KICAgIC8vIEFkZHJlc3NlcyB3aGl0ZWxpc3RlZCBmb3IgcGhhc2UgMSBjYW4gYWxzbyBjb250cmlidXRlIGR1cmluZyBwaGFzZSAyLgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQ4KSBwdWJsaWMgd2hpdGVsaXN0OwoKCiAgICAvLwogICAgLy8gRVZFTlRTCiAgICAvLwogICAgZXZlbnQgSW5pdGlhbGl6ZWQoKTsKICAgIGV2ZW50IFByZXNhbGVBZGRlZChhZGRyZXNzIGluZGV4ZWQgX2FjY291bnQsIHVpbnQyNTYgX2Jhc2VUb2tlbnMsIHVpbnQyNTYgX2JvbnVzVG9rZW5zKTsKICAgIGV2ZW50IFdoaXRlbGlzdFVwZGF0ZWQoYWRkcmVzcyBpbmRleGVkIF9hY2NvdW50LCB1aW50OCBfcGhhc2UpOwogICAgZXZlbnQgVG9rZW5zUHVyY2hhc2VkKGFkZHJlc3MgaW5kZXhlZCBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX2Nvc3QsIHVpbnQyNTYgX3Rva2VucywgdWludDI1NiBfdG90YWxTb2xkKTsKICAgIGV2ZW50IFRva2Vuc1BlcktFdGhlclVwZGF0ZWQodWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IFBoYXNlMUFjY291bnRUb2tlbnNNYXhVcGRhdGVkKHVpbnQyNTYgX3Rva2Vucyk7CiAgICBldmVudCBXYWxsZXRDaGFuZ2VkKGFkZHJlc3MgX25ld1dhbGxldCk7CiAgICBldmVudCBUb2tlbnNSZWNsYWltZWQodWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IFVuc29sZFRva2Vuc0J1cm50KHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBGaW5hbGl6ZWQoKTsKCgogICAgZnVuY3Rpb24gVG9rZW5TYWxlKFNpbXBsZVRva2VuIF90b2tlbkNvbnRyYWN0LCBUcnVzdGVlIF90cnVzdGVlQ29udHJhY3QsIGFkZHJlc3MgX3dhbGxldCkgcHVibGljCiAgICAgICAgT3BzTWFuYWdlZCgpCiAgICB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKF90b2tlbkNvbnRyYWN0KSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoX3RydXN0ZWVDb250cmFjdCkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICByZXF1aXJlKFBIQVNFMV9TVEFSVF9USU1FID49IGN1cnJlbnRUaW1lKCkpOwogICAgICAgIHJlcXVpcmUoUEhBU0UyX1NUQVJUX1RJTUUgPiBQSEFTRTFfU1RBUlRfVElNRSk7CiAgICAgICAgcmVxdWlyZShFTkRfVElNRSA+IFBIQVNFMl9TVEFSVF9USU1FKTsKICAgICAgICByZXF1aXJlKFRPS0VOU19QRVJfS0VUSEVSID4gMCk7CiAgICAgICAgcmVxdWlyZShQSEFTRTFfQUNDT1VOVF9UT0tFTlNfTUFYID4gMCk7CgogICAgICAgIC8vIEJhc2ljIGNoZWNrIHRoYXQgdGhlIGNvbnN0YW50cyBhZGQgdXAgdG8gVE9LRU5TX01BWAogICAgICAgIHVpbnQyNTYgcGFydGlhbEFsbG9jYXRpb25zID0gVE9LRU5TX0ZPVU5ERVJTLmFkZChUT0tFTlNfQURWSVNPUlMpLmFkZChUT0tFTlNfRUFSTFlfQkFDS0VSUyk7CiAgICAgICAgcmVxdWlyZShwYXJ0aWFsQWxsb2NhdGlvbnMuYWRkKFRPS0VOU19TQUxFKS5hZGQoVE9LRU5TX0FDQ0VMRVJBVE9SKS5hZGQoVE9LRU5TX0ZVVFVSRSkgPT0gVE9LRU5TX01BWCk7CgogICAgICAgIHdhbGxldCAgICAgICAgICAgICAgICAgPSBfd2FsbGV0OwogICAgICAgIHBhdXNlZFRpbWUgICAgICAgICAgICAgPSAwOwogICAgICAgIGVuZFRpbWUgICAgICAgICAgICAgICAgPSBFTkRfVElNRTsKICAgICAgICBmaW5hbGl6ZWQgICAgICAgICAgICAgID0gZmFsc2U7CiAgICAgICAgdG9rZW5zUGVyS0V0aGVyICAgICAgICA9IFRPS0VOU19QRVJfS0VUSEVSOwogICAgICAgIHBoYXNlMUFjY291bnRUb2tlbnNNYXggPSBQSEFTRTFfQUNDT1VOVF9UT0tFTlNfTUFYOwoKICAgICAgICB0b2tlbkNvbnRyYWN0ICAgPSBfdG9rZW5Db250cmFjdDsKICAgICAgICB0cnVzdGVlQ29udHJhY3QgPSBfdHJ1c3RlZUNvbnRyYWN0OwogICAgfQoKCiAgICAvLyBJbml0aWFsaXplIGlzIGNhbGxlZCB0byBjaGVjayBzb21lIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycy4KICAgIC8vIEl0IGV4cGVjdHMgdGhhdCBhIGNlcnRhaW4gYW1vdW50IG9mIHRva2VucyBoYXZlIGFscmVhZHkgYmVlbiBhc3NpZ25lZCB0byB0aGUgc2FsZSBjb250cmFjdCBhZGRyZXNzLgogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NvbGQgPT0gMCk7CiAgICAgICAgcmVxdWlyZSh0b3RhbFByZXNhbGVCYXNlID09IDApOwogICAgICAgIHJlcXVpcmUodG90YWxQcmVzYWxlQm9udXMgPT0gMCk7CgogICAgICAgIHVpbnQyNTYgb3duQmFsYW5jZSA9IHRva2VuQ29udHJhY3QuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUob3duQmFsYW5jZSA9PSBUT0tFTlNfU0FMRSk7CgogICAgICAgIC8vIFNpbXBsZSBjaGVjayB0byBjb25maXJtIHRoYXQgdG9rZW5zIGFyZSBwcmVzZW50CiAgICAgICAgdWludDI1NiB0cnVzdGVlQmFsYW5jZSA9IHRva2VuQ29udHJhY3QuYmFsYW5jZU9mKGFkZHJlc3ModHJ1c3RlZUNvbnRyYWN0KSk7CiAgICAgICAgcmVxdWlyZSh0cnVzdGVlQmFsYW5jZSA+PSBUT0tFTlNfRlVUVVJFKTsKCiAgICAgICAgSW5pdGlhbGl6ZWQoKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEFsbG93cyB0aGUgYWRtaW4gdG8gY2hhbmdlIHRoZSB3YWxsZXQgd2hlcmUgRVRIIGNvbnRyaWJ1dGlvbnMgYXJlIHNlbnQuCiAgICBmdW5jdGlvbiBjaGFuZ2VXYWxsZXQoYWRkcmVzcyBfd2FsbGV0KSBleHRlcm5hbCBvbmx5QWRtaW4gcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF93YWxsZXQgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3ModHJ1c3RlZUNvbnRyYWN0KSk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3ModG9rZW5Db250cmFjdCkpOwoKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwoKICAgICAgICBXYWxsZXRDaGFuZ2VkKHdhbGxldCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCgogICAgLy8KICAgIC8vIFRJTUUKICAgIC8vCgogICAgZnVuY3Rpb24gY3VycmVudFRpbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF9jdXJyZW50VGltZSkgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CgoKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVTYWxlKCkgewogICAgICAgIHJlcXVpcmUoaGFzU2FsZUVuZGVkKCkgPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUoY3VycmVudFRpbWUoKSA8IFBIQVNFMV9TVEFSVF9USU1FKTsKICAgICAgIF87CiAgICB9CgoKICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdTYWxlKCkgewogICAgICAgIHJlcXVpcmUoaGFzU2FsZUVuZGVkKCkgPT0gZmFsc2UgJiYgY3VycmVudFRpbWUoKSA+PSBQSEFTRTFfU1RBUlRfVElNRSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJTYWxlKCkgewogICAgICAgIC8vIHJlcXVpcmUgZmluYWxpemVkIGlzIHN0cm9uZ2VyIHRoYW4gaGFzU2FsZUVuZGVkCiAgICAgICAgcmVxdWlyZShmaW5hbGl6ZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIGZ1bmN0aW9uIGhhc1NhbGVFbmRlZCgpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gaWYgc29sZCBvdXQgb3IgZmluYWxpemVkLCBzYWxlIGhhcyBlbmRlZAogICAgICAgIGlmICh0b3RhbFRva2Vuc1NvbGQgPj0gVE9LRU5TX1NBTEUgfHwgZmluYWxpemVkKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIC8vIGVsc2UgaWYgc2FsZSBpcyBub3QgcGF1c2VkIChwYXVzZWRUaW1lID0gMCkgCiAgICAgICAgLy8gYW5kIGVuZHRpbWUgaGFzIHBhc3QsIHRoZW4gc2FsZSBoYXMgZW5kZWQKICAgICAgICB9IGVsc2UgaWYgKHBhdXNlZFRpbWUgPT0gMCAmJiBjdXJyZW50VGltZSgpID49IGVuZFRpbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgLy8gb3RoZXJ3aXNlIGl0IGlzIG5vdCBwYXN0IGFuZCBub3QgcGF1c2VkOyBvciBwYXVzZWQKICAgICAgICAvLyBhbmQgYXMgc3VjaCBub3QgZW5kZWQKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKCgogICAgLy8KICAgIC8vIFdISVRFTElTVAogICAgLy8KCiAgICAvLyBBbGxvd3Mgb3BzIHRvIGFkZCBhY2NvdW50cyB0byB0aGUgd2hpdGVsaXN0LgogICAgLy8gT25seSB0aG9zZSBhY2NvdW50cyB3aWxsIGJlIGFsbG93ZWQgdG8gY29udHJpYnV0ZSBkdXJpbmcgdGhlIHNhbGUuCiAgICAvLyBfcGhhc2UgPSAxOiBDYW4gY29udHJpYnV0ZSBkdXJpbmcgcGhhc2VzIDEgYW5kIDIgb2YgdGhlIHNhbGUuCiAgICAvLyBfcGhhc2UgPSAyOiBDYW4gY29udHJpYnV0ZSBkdXJpbmcgcGhhc2UgMiBvZiB0aGUgc2FsZSBvbmx5LgogICAgLy8gX3BoYXNlID0gMDogQ2Fubm90IGNvbnRyaWJ1dGUgYXQgYWxsIChub3Qgd2hpdGVsaXN0ZWQpLgogICAgZnVuY3Rpb24gdXBkYXRlV2hpdGVsaXN0KGFkZHJlc3MgX2FjY291bnQsIHVpbnQ4IF9waGFzZSkgZXh0ZXJuYWwgb25seU9wcyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYWNjb3VudCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9waGFzZSA8PSAyKTsKICAgICAgICByZXF1aXJlKCFoYXNTYWxlRW5kZWQoKSk7CgogICAgICAgIHdoaXRlbGlzdFtfYWNjb3VudF0gPSBfcGhhc2U7CgogICAgICAgIFdoaXRlbGlzdFVwZGF0ZWQoX2FjY291bnQsIF9waGFzZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCgogICAgLy8KICAgIC8vIFBVUkNIQVNFUyAvIENPTlRSSUJVVElPTlMKICAgIC8vCgogICAgLy8gQWxsb3dzIHRoZSBhZG1pbiB0byBzZXQgdGhlIHByaWNlIGZvciB0b2tlbnMgc29sZCBkdXJpbmcgcGhhc2VzIDEgYW5kIDIgb2YgdGhlIHNhbGUuCiAgICBmdW5jdGlvbiBzZXRUb2tlbnNQZXJLRXRoZXIodWludDI1NiBfdG9rZW5zUGVyS0V0aGVyKSBleHRlcm5hbCBvbmx5QWRtaW4gb25seUJlZm9yZVNhbGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3Rva2Vuc1BlcktFdGhlciA+IDApOwoKICAgICAgICB0b2tlbnNQZXJLRXRoZXIgPSBfdG9rZW5zUGVyS0V0aGVyOwoKICAgICAgICBUb2tlbnNQZXJLRXRoZXJVcGRhdGVkKF90b2tlbnNQZXJLRXRoZXIpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gQWxsb3dzIHRoZSBhZG1pbiB0byBzZXQgdGhlIG1heGltdW0gYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIGFjY291bnQgY2FuIGJ1eSBkdXJpbmcgcGhhc2UgMSBvZiB0aGUgc2FsZS4KICAgIGZ1bmN0aW9uIHNldFBoYXNlMUFjY291bnRUb2tlbnNNYXgodWludDI1NiBfdG9rZW5zKSBleHRlcm5hbCBvbmx5QWRtaW4gb25seUJlZm9yZVNhbGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3Rva2VucyA+IDApOwoKICAgICAgICBwaGFzZTFBY2NvdW50VG9rZW5zTWF4ID0gX3Rva2VuczsKCiAgICAgICAgUGhhc2UxQWNjb3VudFRva2Vuc01heFVwZGF0ZWQoX3Rva2Vucyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgb25seUR1cmluZ1NhbGUgewogICAgICAgIGJ1eVRva2VucygpOwogICAgfQoKCiAgICAvLyBUaGlzIGlzIHRoZSBtYWluIGZ1bmN0aW9uIHRvIHByb2Nlc3MgaW5jb21pbmcgRVRIIGNvbnRyaWJ1dGlvbnMuCiAgICBmdW5jdGlvbiBidXlUb2tlbnMoKSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIG9ubHlEdXJpbmdTYWxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBDT05UUklCVVRJT05fTUlOKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA8PSBDT05UUklCVVRJT05fTUFYKTsKICAgICAgICByZXF1aXJlKHRvdGFsVG9rZW5zU29sZCA8IFRPS0VOU19TQUxFKTsKCiAgICAgICAgLy8gQWxsIGFjY291bnRzIG5lZWQgdG8gYmUgd2hpdGVsaXN0ZWQgdG8gcHVyY2hhc2UuCiAgICAgICAgdWludDggd2hpdGVsaXN0ZWRQaGFzZSA9IHdoaXRlbGlzdFttc2cuc2VuZGVyXTsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdGVkUGhhc2UgPiAwKTsKCiAgICAgICAgdWludDI1NiB0b2tlbnNNYXggPSBUT0tFTlNfU0FMRS5zdWIodG90YWxUb2tlbnNTb2xkKTsKCiAgICAgICAgaWYgKGN1cnJlbnRUaW1lKCkgPCBQSEFTRTJfU1RBUlRfVElNRSkgewogICAgICAgICAgICAvLyBXZSBhcmUgaW4gcGhhc2UgMSBvZiB0aGUgc2FsZQogICAgICAgICAgICByZXF1aXJlKHdoaXRlbGlzdGVkUGhhc2UgPT0gMSk7CgogICAgICAgICAgICB1aW50MjU2IGFjY291bnRCYWxhbmNlID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YobXNnLnNlbmRlcik7CgogICAgICAgICAgICAvLyBDYW4gb25seSBwdXJjaGFzZSB1cCB0byBhIG1heGltdW0gcGVyIGFjY291bnQuCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBob3cgbXVjaCBvZiB0aGF0IGFtb3VudCBpcyBzdGlsbCBhdmFpbGFibGUuCiAgICAgICAgICAgIHVpbnQyNTYgcGhhc2UxQmFsYW5jZSA9IHBoYXNlMUFjY291bnRUb2tlbnNNYXguc3ViKGFjY291bnRCYWxhbmNlKTsKCiAgICAgICAgICAgIGlmIChwaGFzZTFCYWxhbmNlIDwgdG9rZW5zTWF4KSB7CiAgICAgICAgICAgICAgICB0b2tlbnNNYXggPSBwaGFzZTFCYWxhbmNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKHRva2Vuc01heCA+IDApOwoKICAgICAgICB1aW50MjU2IHRva2Vuc0JvdWdodCA9IG1zZy52YWx1ZS5tdWwodG9rZW5zUGVyS0V0aGVyKS5kaXYoUFVSQ0hBU0VfRElWSURFUik7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNCb3VnaHQgPiAwKTsKCiAgICAgICAgdWludDI1NiBjb3N0ID0gbXNnLnZhbHVlOwogICAgICAgIHVpbnQyNTYgcmVmdW5kID0gMDsKCiAgICAgICAgaWYgKHRva2Vuc0JvdWdodCA+IHRva2Vuc01heCkgewogICAgICAgICAgICAvLyBOb3QgZW5vdWdoIHRva2VucyBhdmFpbGFibGUgZm9yIGZ1bGwgY29udHJpYnV0aW9uLCB3ZSB3aWxsIGRvIHBhcnRpYWwuCiAgICAgICAgICAgIHRva2Vuc0JvdWdodCA9IHRva2Vuc01heDsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBhY3R1YWwgY29zdCBmb3IgcGFydGlhbCBhbW91bnQgb2YgdG9rZW5zLgogICAgICAgICAgICBjb3N0ID0gdG9rZW5zQm91Z2h0Lm11bChQVVJDSEFTRV9ESVZJREVSKS5kaXYodG9rZW5zUGVyS0V0aGVyKTsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSByZWZ1bmQgZm9yIGNvbnRyaWJ1dG9yLgogICAgICAgICAgICByZWZ1bmQgPSBtc2cudmFsdWUuc3ViKGNvc3QpOwogICAgICAgIH0KCiAgICAgICAgdG90YWxUb2tlbnNTb2xkID0gdG90YWxUb2tlbnNTb2xkLmFkZCh0b2tlbnNCb3VnaHQpOwoKICAgICAgICAvLyBUcmFuc2ZlciB0b2tlbnMgdG8gdGhlIGFjY291bnQKICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3QudHJhbnNmZXIobXNnLnNlbmRlciwgdG9rZW5zQm91Z2h0KSk7CgogICAgICAgIC8vIElzc3VlIGEgRVRIIHJlZnVuZCBmb3IgYW55IHVudXNlZCBwb3J0aW9uIG9mIHRoZSBmdW5kcy4KICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBUcmFuc2ZlciB0aGUgY29udHJpYnV0aW9uIHRvIHRoZSB3YWxsZXQKICAgICAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlLnN1YihyZWZ1bmQpKTsKCiAgICAgICAgVG9rZW5zUHVyY2hhc2VkKG1zZy5zZW5kZXIsIGNvc3QsIHRva2Vuc0JvdWdodCwgdG90YWxUb2tlbnNTb2xkKTsKCiAgICAgICAgLy8gSWYgYWxsIHRva2VucyBhdmFpbGFibGUgZm9yIHNhbGUgaGF2ZSBiZWVuIHNvbGQgb3V0LCBmaW5hbGl6ZSB0aGUgc2FsZSBhdXRvbWF0aWNhbGx5LgogICAgICAgIGlmICh0b3RhbFRva2Vuc1NvbGQgPT0gVE9LRU5TX1NBTEUpIHsKICAgICAgICAgICAgZmluYWxpemVJbnRlcm5hbCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vCiAgICAvLyBQUkVTQUxFUwogICAgLy8KCiAgICAvLyBBbGxvd3MgdGhlIGFkbWluIHRvIHJlY29yZCBwcmUtc2FsZXMsIGJlZm9yZSB0aGUgcHVibGljIHNhbGUgc3RhcnRzLiBQcmVzYWxlIGJhc2UgdG9rZW5zIGNvbWUgb3V0IG9mIHRoZQogICAgLy8gbWFpbiBzYWxlIHBvb2wgKHRoZSAzMCUgYWxsb2NhdGlvbikgd2hpbGUgYm9udXMgdG9rZW5zIGNvbWUgZnJvbSB0aGUgcmVtYWluaW5nIHRva2VuIHBvb2wuCiAgICBmdW5jdGlvbiBhZGRQcmVzYWxlKGFkZHJlc3MgX2FjY291bnQsIHVpbnQyNTYgX2Jhc2VUb2tlbnMsIHVpbnQyNTYgX2JvbnVzVG9rZW5zKSBleHRlcm5hbCBvbmx5QWRtaW4gb25seUJlZm9yZVNhbGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX2FjY291bnQgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIFByZXNhbGVzIG1heSBoYXZlIDAgYm9udXMgdG9rZW5zIGJ1dCBuZWVkIHRvIGhhdmUgYSBiYXNlIGFtb3VudCBvZiB0b2tlbnMgc29sZC4KICAgICAgICByZXF1aXJlKF9iYXNlVG9rZW5zID4gMCk7CiAgICAgICAgcmVxdWlyZShfYm9udXNUb2tlbnMgPCBfYmFzZVRva2Vucyk7CgogICAgICAgIC8vIFdlIGRvIG5vdCBjb3VudCBib251cyB0b2tlbnMgYXMgcGFydCBvZiB0aGUgc2FsZSBjYXAuCiAgICAgICAgdG90YWxUb2tlbnNTb2xkID0gdG90YWxUb2tlbnNTb2xkLmFkZChfYmFzZVRva2Vucyk7CiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NvbGQgPD0gVE9LRU5TX1NBTEUpOwoKICAgICAgICB1aW50MjU2IG93bkJhbGFuY2UgPSB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKF9iYXNlVG9rZW5zIDw9IG93bkJhbGFuY2UpOwoKICAgICAgICB0b3RhbFByZXNhbGVCYXNlICA9IHRvdGFsUHJlc2FsZUJhc2UuYWRkKF9iYXNlVG9rZW5zKTsKICAgICAgICB0b3RhbFByZXNhbGVCb251cyA9IHRvdGFsUHJlc2FsZUJvbnVzLmFkZChfYm9udXNUb2tlbnMpOwoKICAgICAgICAvLyBNb3ZlIGJhc2UgdG9rZW5zIHRvIHRoZSB0cnVzdGVlCiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0LnRyYW5zZmVyKGFkZHJlc3ModHJ1c3RlZUNvbnRyYWN0KSwgX2Jhc2VUb2tlbnMpKTsKCiAgICAgICAgLy8gUHJlc2FsZSBhbGxvY2F0aW9ucyBhcmUgbWFya2VkIGFzIGxvY2tlZCwgdGhleSBjYW5ub3QgYmUgcmVtb3ZlZCBieSB0aGUgb3duZXIuCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBfYmFzZVRva2Vucy5hZGQoX2JvbnVzVG9rZW5zKTsKICAgICAgICByZXF1aXJlKHRydXN0ZWVDb250cmFjdC5ncmFudEFsbG9jYXRpb24oX2FjY291bnQsIHRva2VucywgZmFsc2UgLyogcmV2b2thYmxlICovKSk7CgogICAgICAgIFByZXNhbGVBZGRlZChfYWNjb3VudCwgX2Jhc2VUb2tlbnMsIF9ib251c1Rva2Vucyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLwogICAgLy8gUEFVU0UgLyBVTlBBVVNFCiAgICAvLwoKICAgIC8vIEFsbG93cyB0aGUgb3duZXIgb3IgYWRtaW4gdG8gcGF1c2UgdGhlIHNhbGUgZm9yIGFueSByZWFzb24uCiAgICBmdW5jdGlvbiBwYXVzZSgpIHB1YmxpYyBvbmx5QWRtaW4gd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShoYXNTYWxlRW5kZWQoKSA9PSBmYWxzZSk7CgogICAgICAgIHBhdXNlZFRpbWUgPSBjdXJyZW50VGltZSgpOwoKICAgICAgICByZXR1cm4gc3VwZXIucGF1c2UoKTsKICAgIH0KCgogICAgLy8gVW5wYXVzZSBtYXkgZXh0ZW5kIHRoZSBlbmQgdGltZSBvZiB0aGUgcHVibGljIHNhbGUuCiAgICAvLyBOb3RlIHRoYXQgd2UgZG8gbm90IGV4dGVuZCB0aGUgc3RhcnQgdGltZSBvZiBlYWNoIHBoYXNlLgogICAgLy8gQ3VycmVudGx5IGRvZXMgbm90IGV4dGVuZCBwaGFzZSAxIGVuZCB0aW1lLCBvbmx5IGZpbmFsIGVuZCB0aW1lLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5QWRtaW4gd2hlblBhdXNlZCB7CgogICAgICAgIC8vIElmIG93bmVyIHVucGF1c2VzIGJlZm9yZSBzYWxlIHN0YXJ0cywgbm8gaW1wYWN0IG9uIGVuZCB0aW1lLgogICAgICAgIHVpbnQyNTYgY3VycmVudCA9IGN1cnJlbnRUaW1lKCk7CgogICAgICAgIC8vIElmIG93bmVyIHVucGF1c2VzIGFmdGVyIHNhbGUgc3RhcnRzLCBjYWxjdWxhdGUgaG93IHRvIGV4dGVuZCBlbmQuCiAgICAgICAgaWYgKGN1cnJlbnQgPiBQSEFTRTFfU1RBUlRfVElNRSkgewogICAgICAgICAgICB1aW50MjU2IHRpbWVEZWx0YTsKCiAgICAgICAgICAgIGlmIChwYXVzZWRUaW1lIDwgUEhBU0UxX1NUQVJUX1RJTUUpIHsKICAgICAgICAgICAgICAgIC8vIFBhdXNlIHdhcyB0cmlnZ2VyZWQgYmVmb3JlIHRoZSBzdGFydCB0aW1lLCBleHRlbmQgYnkgdGltZSB0aGF0CiAgICAgICAgICAgICAgICAvLyBwYXNzZWQgZnJvbSBwcm9wb3NlZCBzdGFydCB0aW1lIHVudGlsIG5vdy4KICAgICAgICAgICAgICAgIHRpbWVEZWx0YSA9IGN1cnJlbnQuc3ViKFBIQVNFMV9TVEFSVF9USU1FKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFBhdXNlIHdhcyB0cmlnZ2VyZWQgd2hpbGUgdGhlIHNhbGUgd2FzIGFscmVhZHkgc3RhcnRlZC4KICAgICAgICAgICAgICAgIC8vIEV4dGVuZCBlbmQgdGltZSBieSBhbW91bnQgb2YgdGltZSBzaW5jZSBwYXVzZS4KICAgICAgICAgICAgICAgIHRpbWVEZWx0YSA9IGN1cnJlbnQuc3ViKHBhdXNlZFRpbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlbmRUaW1lID0gZW5kVGltZS5hZGQodGltZURlbHRhKTsKICAgICAgICB9CgogICAgICAgIHBhdXNlZFRpbWUgPSAwOwoKICAgICAgICByZXR1cm4gc3VwZXIudW5wYXVzZSgpOwogICAgfQoKCiAgICAvLyBBbGxvd3MgdGhlIGFkbWluIHRvIG1vdmUgYm9udXMgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBpbiB0aGUgc2FsZSBjb250cmFjdAogICAgLy8gb3V0IGJlZm9yZSBidXJuaW5nIGFsbCByZW1haW5pbmcgdW5zb2xkIHRva2VucyBpbiBidXJuVW5zb2xkVG9rZW5zKCkuCiAgICAvLyBVc2VkIHRvIGRpc3RyaWJ1dGUgYm9udXNlcyB0byB0b2tlbiBzYWxlIHBhcnRpY2lwYW50cyB3aGVuIHRoZSBzYWxlIGhhcyBlbmRlZAogICAgLy8gYW5kIGFsbCBib251c2VzIGFyZSBrbm93bi4KICAgIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbnModWludDI1NiBfYW1vdW50KSBleHRlcm5hbCBvbmx5QWZ0ZXJTYWxlIG9ubHlBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBvd25CYWxhbmNlID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50IDw9IG93bkJhbGFuY2UpOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgdG9rZW5Pd25lciA9IHRva2VuQ29udHJhY3Qub3duZXIoKTsKICAgICAgICByZXF1aXJlKHRva2VuT3duZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdC50cmFuc2Zlcih0b2tlbk93bmVyLCBfYW1vdW50KSk7CgogICAgICAgIFRva2Vuc1JlY2xhaW1lZChfYW1vdW50KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEFsbG93cyB0aGUgYWRtaW4gdG8gYnVybiBhbGwgdW5zb2xkIHRva2VucyBpbiB0aGUgc2FsZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGJ1cm5VbnNvbGRUb2tlbnMoKSBleHRlcm5hbCBvbmx5QWZ0ZXJTYWxlIG9ubHlBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBvd25CYWxhbmNlID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CgogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdC5idXJuKG93bkJhbGFuY2UpKTsKCiAgICAgICAgVW5zb2xkVG9rZW5zQnVybnQob3duQmFsYW5jZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBBbGxvd3MgdGhlIGFkbWluIHRvIGZpbmFsaXplIHRoZSBzYWxlIGFuZCBjb21wbGV0ZSBhbGxvY2F0aW9ucy4KICAgIC8vIFRoZSBTaW1wbGVUb2tlbi5hZG1pbiBhbHNvIG5lZWRzIHRvIGZpbmFsaXplIHRoZSB0b2tlbiBjb250cmFjdAogICAgLy8gc28gdGhhdCB0b2tlbiB0cmFuc2ZlcnMgYXJlIGVuYWJsZWQuCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIGV4dGVybmFsIG9ubHlBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZpbmFsaXplSW50ZXJuYWwoKTsKICAgIH0KCgogICAgLy8gVGhlIGludGVybmFsIG9uZSB3aWxsIGJlIGNhbGxlZCBpZiB0b2tlbnMgYXJlIHNvbGQgb3V0IG9yCiAgICAvLyB0aGUgZW5kIHRpbWUgZm9yIHRoZSBzYWxlIGlzIHJlYWNoZWQsIGluIGFkZGl0aW9uIHRvIGJlaW5nIGNhbGxlZAogICAgLy8gZnJvbSB0aGUgcHVibGljIHZlcnNpb24gb2YgZmluYWxpemUoKS4KICAgIGZ1bmN0aW9uIGZpbmFsaXplSW50ZXJuYWwoKSBwcml2YXRlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKCFmaW5hbGl6ZWQpOwoKICAgICAgICBmaW5hbGl6ZWQgPSB0cnVlOwoKICAgICAgICBGaW5hbGl6ZWQoKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0='.
	

]
