Class {
	#name : #SRTb626a5facc4de1c813f5293ec3be31979f1d1c78,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb626a5facc4de1c813f5293ec3be31979f1d1c78 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgVXRpbGl0aWVzICYgQ29tbW9uIE1vZGlmaWVycwoqLwpjb250cmFjdCBVdGlscyB7CiAgICAvKioKICAgICAgICBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFV0aWxzKCkgewogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgYW4gYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiB6ZXJvCiAgICBtb2RpZmllciBncmVhdGVyVGhhblplcm8odWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYW4gYWRkcmVzcyAtIGN1cnJlbnRseSBvbmx5IGNoZWNrcyB0aGF0IGl0IGlzbid0IG51bGwKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGlzIGNvbnRyYWN0IGFkZHJlc3MKICAgIG1vZGlmaWVyIG5vdFRoaXMoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBPdmVyZmxvdyBwcm90ZWN0ZWQgbWF0aCBmdW5jdGlvbnMKCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIHN1bSBvZiBfeCBhbmQgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cwoKICAgICAgICBAcGFyYW0gX3ggICB2YWx1ZSAxCiAgICAgICAgQHBhcmFtIF95ICAgdmFsdWUgMgoKICAgICAgICBAcmV0dXJuIHN1bQogICAgKi8KICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiBfeCwgdWludDI1NiBfeSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7CiAgICAgICAgYXNzZXJ0KHogPj0gX3gpOwogICAgICAgIHJldHVybiB6OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcgoKICAgICAgICBAcGFyYW0gX3ggICBtaW51ZW5kCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZAoKICAgICAgICBAcmV0dXJuIGRpZmZlcmVuY2UKICAgICovCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoX3ggPj0gX3kpOwogICAgICAgIHJldHVybiBfeCAtIF95OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBtdWx0aXBseWluZyBfeCBieSBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzCgogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxCiAgICAgICAgQHBhcmFtIF95ICAgZmFjdG9yIDIKCiAgICAgICAgQHJldHVybiBwcm9kdWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiB6ID0gX3ggKiBfeTsKICAgICAgICBhc3NlcnQoX3ggPT0gMCB8fCB6IC8gX3ggPT0gX3kpOwogICAgICAgIHJldHVybiB6OwogICAgfQp9CgovKgogICAgRVJDMjAgU3RhbmRhcmQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElFUkMyMFRva2VuIHsKICAgIC8vIHRoZXNlIGZ1bmN0aW9ucyBhcmVuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwKICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7fQogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykge30KICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7fQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsgX293bmVyOyB9CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7IF9vd25lcjsgX3NwZW5kZXI7IH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKLyoKICAgIE93bmVkIGNvbnRyYWN0IGludGVyZmFjZQoqLwpjb250cmFjdCBJT3duZWQgewogICAgLy8gdGhpcyBmdW5jdGlvbiBpc24ndCBhYnN0cmFjdCBzaW5jZSB0aGUgY29tcGlsZXIgZW1pdHMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgZ2V0dGVyIGZ1bmN0aW9ucyBhcyBleHRlcm5hbAogICAgZnVuY3Rpb24gb3duZXIoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykge30KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljOwogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljOwp9CgovKgogICAgVG9rZW4gSG9sZGVyIGludGVyZmFjZQoqLwpjb250cmFjdCBJVG9rZW5Ib2xkZXIgaXMgSU93bmVkIHsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgovKgogICAgRUlQMjI4IFRva2VuIENvbnZlcnRlciBpbnRlcmZhY2UKKi8KY29udHJhY3QgSVRva2VuQ29udmVydGVyIHsKICAgIGZ1bmN0aW9uIGNvbnZlcnRpYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYpOwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldFJldHVybihJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpOwogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpOwp9CgovKgogICAgU21hcnQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElPd25lZCwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgovKgogICAgQmFuY29yIENvbnZlcnRlciBFeHRlbnNpb25zIGludGVyZmFjZQoqLwpjb250cmFjdCBJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyB7CiAgICBmdW5jdGlvbiBmb3JtdWxhKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKElCYW5jb3JGb3JtdWxhKSB7fQogICAgZnVuY3Rpb24gZ2FzUHJpY2VMaW1pdCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChJQmFuY29yR2FzUHJpY2VMaW1pdCkge30KICAgIGZ1bmN0aW9uIHF1aWNrQ29udmVydGVyKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKElCYW5jb3JRdWlja0NvbnZlcnRlcikge30KfQoKLyoKICAgIEJhbmNvciBGb3JtdWxhIGludGVyZmFjZQoqLwpjb250cmFjdCBJQmFuY29yRm9ybXVsYSB7CiAgICBmdW5jdGlvbiBjYWxjdWxhdGVQdXJjaGFzZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX3Jlc2VydmVCYWxhbmNlLCB1aW50MzIgX3Jlc2VydmVSYXRpbywgdWludDI1NiBfZGVwb3NpdEFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY2FsY3VsYXRlU2FsZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX3Jlc2VydmVCYWxhbmNlLCB1aW50MzIgX3Jlc2VydmVSYXRpbywgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwp9CgovKgogICAgQmFuY29yIEdhcyBQcmljZSBMaW1pdCBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUJhbmNvckdhc1ByaWNlTGltaXQgewogICAgZnVuY3Rpb24gZ2FzUHJpY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KfQoKLyoKICAgIEJhbmNvciBRdWljayBDb252ZXJ0ZXIgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElCYW5jb3JRdWlja0NvbnZlcnRlciB7CiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGNvbnZlcnRGb3IoSUVSQzIwVG9rZW5bXSBfcGF0aCwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4sIGFkZHJlc3MgX2ZvcikgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludDI1Nik7Cn0KCi8qCiAgICBFdGhlciBUb2tlbiBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUV0aGVyVG9rZW4gaXMgSVRva2VuSG9sZGVyLCBJRVJDMjBUb2tlbiB7CiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcHVibGljIHBheWFibGU7CiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG8oYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7Cn0KCi8qCiAgICBQcm92aWRlcyBzdXBwb3J0IGFuZCB1dGlsaXRpZXMgZm9yIGNvbnRyYWN0IG93bmVyc2hpcAoqLwpjb250cmFjdCBPd25lZCBpcyBJT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICBldmVudCBPd25lclVwZGF0ZShhZGRyZXNzIF9wcmV2T3duZXIsIGFkZHJlc3MgX25ld093bmVyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gT3duZWQoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gYnkgdGhlIG93bmVyIG9ubHkKICAgIG1vZGlmaWVyIG93bmVyT25seSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSBjb250cmFjdCBvd25lcnNoaXAKICAgICAgICB0aGUgbmV3IG93bmVyIHN0aWxsIG5lZWRzIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IGNvbnRyYWN0IG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IG93bmVyKTsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgb3duZXIgdG8gYWNjZXB0IGFuIG93bmVyc2hpcCB0cmFuc2ZlcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld093bmVyKTsKICAgICAgICBPd25lclVwZGF0ZShvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgbmV3T3duZXIgPSAweDA7CiAgICB9Cn0KCi8qCiAgICBQcm92aWRlcyBzdXBwb3J0IGFuZCB1dGlsaXRpZXMgZm9yIGNvbnRyYWN0IG1hbmFnZW1lbnQKKi8KY29udHJhY3QgTWFuYWdlZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBtYW5hZ2VyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3TWFuYWdlcjsKCiAgICBldmVudCBNYW5hZ2VyVXBkYXRlKGFkZHJlc3MgX3ByZXZNYW5hZ2VyLCBhZGRyZXNzIF9uZXdNYW5hZ2VyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gTWFuYWdlZCgpIHsKICAgICAgICBtYW5hZ2VyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIGJ5IHRoZSBtYW5hZ2VyIG9ubHkKICAgIG1vZGlmaWVyIG1hbmFnZXJPbmx5IHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBtYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgY29udHJhY3QgbWFuYWdlbWVudAogICAgICAgIHRoZSBuZXcgbWFuYWdlciBzdGlsbCBuZWVkcyB0byBhY2NlcHQgdGhlIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBtYW5hZ2VyCgogICAgICAgIEBwYXJhbSBfbmV3TWFuYWdlciAgICBuZXcgY29udHJhY3QgbWFuYWdlcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyTWFuYWdlbWVudChhZGRyZXNzIF9uZXdNYW5hZ2VyKSBwdWJsaWMgbWFuYWdlck9ubHkgewogICAgICAgIHJlcXVpcmUoX25ld01hbmFnZXIgIT0gbWFuYWdlcik7CiAgICAgICAgbmV3TWFuYWdlciA9IF9uZXdNYW5hZ2VyOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBtYW5hZ2VyIHRvIGFjY2VwdCBhIG1hbmFnZW1lbnQgdHJhbnNmZXIKICAgICovCiAgICBmdW5jdGlvbiBhY2NlcHRNYW5hZ2VtZW50KCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3TWFuYWdlcik7CiAgICAgICAgTWFuYWdlclVwZGF0ZShtYW5hZ2VyLCBuZXdNYW5hZ2VyKTsKICAgICAgICBtYW5hZ2VyID0gbmV3TWFuYWdlcjsKICAgICAgICBuZXdNYW5hZ2VyID0gMHgwOwogICAgfQp9CgovKgogICAgV2UgY29uc2lkZXIgZXZlcnkgY29udHJhY3QgdG8gYmUgYSAndG9rZW4gaG9sZGVyJyBzaW5jZSBpdCdzIGN1cnJlbnRseSBub3QgcG9zc2libGUKICAgIGZvciBhIGNvbnRyYWN0IHRvIGRlbnkgcmVjZWl2aW5nIHRva2Vucy4KCiAgICBUaGUgVG9rZW5Ib2xkZXIncyBjb250cmFjdCBzb2xlIHB1cnBvc2UgaXMgdG8gcHJvdmlkZSBhIHNhZmV0eSBtZWNoYW5pc20gdGhhdCBhbGxvd3MKICAgIHRoZSBvd25lciB0byBzZW5kIHRva2VucyB0aGF0IHdlcmUgc2VudCB0byB0aGUgY29udHJhY3QgYnkgbWlzdGFrZSBiYWNrIHRvIHRoZWlyIHNlbmRlci4KKi8KY29udHJhY3QgVG9rZW5Ib2xkZXIgaXMgSVRva2VuSG9sZGVyLCBPd25lZCwgVXRpbHMgewogICAgLyoqCiAgICAgICAgQGRldiBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFRva2VuSG9sZGVyKCkgewogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgd2l0aGRyYXdzIHRva2VucyBoZWxkIGJ5IHRoZSBjb250cmFjdCBhbmQgc2VuZHMgdGhlbSB0byBhbiBhY2NvdW50CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcgoKICAgICAgICBAcGFyYW0gX3Rva2VuICAgRVJDMjAgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3CiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykKICAgICAgICBub3RUaGlzKF90bykKICAgIHsKICAgICAgICBhc3NlcnQoX3Rva2VuLnRyYW5zZmVyKF90bywgX2Ftb3VudCkpOwogICAgfQp9CgovKgogICAgVGhlIHNtYXJ0IHRva2VuIGNvbnRyb2xsZXIgaXMgYW4gdXBncmFkYWJsZSBwYXJ0IG9mIHRoZSBzbWFydCB0b2tlbiB0aGF0IGFsbG93cwogICAgbW9yZSBmdW5jdGlvbmFsaXR5IGFzIHdlbGwgYXMgZml4ZXMgZm9yIGJ1Z3MvZXhwbG9pdHMuCiAgICBPbmNlIGl0IGFjY2VwdHMgb3duZXJzaGlwIG9mIHRoZSB0b2tlbiwgaXQgYmVjb21lcyB0aGUgdG9rZW4ncyBzb2xlIGNvbnRyb2xsZXIKICAgIHRoYXQgY2FuIGV4ZWN1dGUgYW55IG9mIGl0cyBmdW5jdGlvbnMuCgogICAgVG8gdXBncmFkZSB0aGUgY29udHJvbGxlciwgb3duZXJzaGlwIG11c3QgYmUgdHJhbnNmZXJyZWQgdG8gYSBuZXcgY29udHJvbGxlciwgYWxvbmcgd2l0aAogICAgYW55IHJlbGV2YW50IGRhdGEuCgogICAgVGhlIHNtYXJ0IHRva2VuIG11c3QgYmUgc2V0IG9uIGNvbnN0cnVjdGlvbiBhbmQgY2Fubm90IGJlIGNoYW5nZWQgYWZ0ZXJ3YXJkcy4KICAgIFdyYXBwZXJzIGFyZSBwcm92aWRlZCAoYXMgb3Bwb3NlZCB0byBhIHNpbmdsZSAnZXhlY3V0ZScgZnVuY3Rpb24pIGZvciBlYWNoIG9mIHRoZSB0b2tlbidzIGZ1bmN0aW9ucywgZm9yIGVhc2llciBhY2Nlc3MuCgogICAgTm90ZSB0aGF0IHRoZSBjb250cm9sbGVyIGNhbiB0cmFuc2ZlciB0b2tlbiBvd25lcnNoaXAgdG8gYSBuZXcgY29udHJvbGxlciB0aGF0CiAgICBkb2Vzbid0IGFsbG93IGV4ZWN1dGluZyBhbnkgZnVuY3Rpb24gb24gdGhlIHRva2VuLCBmb3IgYSB0cnVzdGxlc3Mgc29sdXRpb24uCiAgICBEb2luZyB0aGF0IHdpbGwgYWxzbyByZW1vdmUgdGhlIG93bmVyJ3MgYWJpbGl0eSB0byB1cGdyYWRlIHRoZSBjb250cm9sbGVyLgoqLwpjb250cmFjdCBTbWFydFRva2VuQ29udHJvbGxlciBpcyBUb2tlbkhvbGRlciB7CiAgICBJU21hcnRUb2tlbiBwdWJsaWMgdG9rZW47ICAgLy8gc21hcnQgdG9rZW4KCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gU21hcnRUb2tlbkNvbnRyb2xsZXIoSVNtYXJ0VG9rZW4gX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICB7CiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICB9CgogICAgLy8gZW5zdXJlcyB0aGF0IHRoZSBjb250cm9sbGVyIGlzIHRoZSB0b2tlbidzIG93bmVyCiAgICBtb2RpZmllciBhY3RpdmUoKSB7CiAgICAgICAgYXNzZXJ0KHRva2VuLm93bmVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIGNvbnRyb2xsZXIgaXMgbm90IHRoZSB0b2tlbidzIG93bmVyCiAgICBtb2RpZmllciBpbmFjdGl2ZSgpIHsKICAgICAgICBhc3NlcnQodG9rZW4ub3duZXIoKSAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgdG9rZW4gb3duZXJzaGlwCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IHRva2VuIG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJUb2tlbk93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgb3duZXIgdG8gYWNjZXB0IGEgdG9rZW4gb3duZXJzaGlwIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdFRva2VuT3duZXJzaGlwKCkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4uYWNjZXB0T3duZXJzaGlwKCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcy9lbmFibGVzIHRva2VuIHRyYW5zZmVycwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgIHRydWUgdG8gZGlzYWJsZSB0cmFuc2ZlcnMsIGZhbHNlIHRvIGVuYWJsZSB0aGVtCiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLmRpc2FibGVUcmFuc2ZlcnMoX2Rpc2FibGUpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgd2l0aGRyYXdzIHRva2VucyBoZWxkIGJ5IHRoZSB0b2tlbiBhbmQgc2VuZHMgdGhlbSB0byBhbiBhY2NvdW50CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcgoKICAgICAgICBAcGFyYW0gX3Rva2VuICAgRVJDMjAgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3CiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdGcm9tVG9rZW4oSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICBJVG9rZW5Ib2xkZXIodG9rZW4pLndpdGhkcmF3VG9rZW5zKF90b2tlbiwgX3RvLCBfYW1vdW50KTsKICAgIH0KfQoKLyoKICAgIEJhbmNvciBDb252ZXJ0ZXIgdjAuNAoKICAgIFRoZSBCYW5jb3IgdmVyc2lvbiBvZiB0aGUgdG9rZW4gY29udmVydGVyLCBhbGxvd3MgY29udmVyc2lvbiBiZXR3ZWVuIGEgc21hcnQgdG9rZW4gYW5kIG90aGVyIEVSQzIwIHRva2VucyBhbmQgYmV0d2VlbiBkaWZmZXJlbnQgRVJDMjAgdG9rZW5zIGFuZCB0aGVtc2VsdmVzLgoKICAgIEVSQzIwIHJlc2VydmUgdG9rZW4gYmFsYW5jZSBjYW4gYmUgdmlydHVhbCwgbWVhbmluZyB0aGF0IHRoZSBjYWxjdWxhdGlvbnMgYXJlIGJhc2VkIG9uIHRoZSB2aXJ0dWFsIGJhbGFuY2UgaW5zdGVhZCBvZiByZWx5aW5nIG9uCiAgICB0aGUgYWN0dWFsIHJlc2VydmUgYmFsYW5jZS4gVGhpcyBpcyBhIHNlY3VyaXR5IG1lY2hhbmlzbSB0aGF0IHByZXZlbnRzIHRoZSBuZWVkIHRvIGtlZXAgYSB2ZXJ5IGxhcmdlIChhbmQgdmFsdWFibGUpIGJhbGFuY2UgaW4gYSBzaW5nbGUgY29udHJhY3QuCgogICAgVGhlIGNvbnZlcnRlciBpcyB1cGdyYWRhYmxlIChqdXN0IGxpa2UgYW55IFNtYXJ0VG9rZW5Db250cm9sbGVyKS4KCiAgICBXQVJOSU5HOiBJdCBpcyBOT1QgUkVDT01NRU5ERUQgdG8gdXNlIHRoZSBjb252ZXJ0ZXIgd2l0aCBTbWFydCBUb2tlbnMgdGhhdCBoYXZlIGxlc3MgdGhhbiA4IGRlY2ltYWwgZGlnaXRzCiAgICAgICAgICAgICBvciB3aXRoIHZlcnkgc21hbGwgbnVtYmVycyBiZWNhdXNlIG9mIHByZWNpc2lvbiBsb3NzCgoKICAgIE9wZW4gaXNzdWVzOgogICAgLSBGcm9udC1ydW5uaW5nIGF0dGFja3MgYXJlIGN1cnJlbnRseSBtaXRpZ2F0ZWQgYnkgdGhlIGZvbGxvd2luZyBtZWNoYW5pc21zOgogICAgICAgIC0gbWluaW11bSByZXR1cm4gYXJndW1lbnQgZm9yIGVhY2ggY29udmVyc2lvbiBwcm92aWRlcyBhIHdheSB0byBkZWZpbmUgYSBtaW5pbXVtL21heGltdW0gcHJpY2UgZm9yIHRoZSB0cmFuc2FjdGlvbgogICAgICAgIC0gZ2FzIHByaWNlIGxpbWl0IHByZXZlbnRzIHVzZXJzIGZyb20gaGF2aW5nIGNvbnRyb2wgb3ZlciB0aGUgb3JkZXIgb2YgZXhlY3V0aW9uCiAgICAgIE90aGVyIHBvdGVudGlhbCBzb2x1dGlvbnMgbWlnaHQgaW5jbHVkZSBhIGNvbW1pdC9yZXZlYWwgYmFzZWQgc2NoZW1lcwogICAgLSBQb3NzaWJseSBhZGQgZ2V0dGVycyBmb3IgcmVzZXJ2ZSBmaWVsZHMgc28gdGhhdCB0aGUgY2xpZW50IHdvbid0IG5lZWQgdG8gcmVseSBvbiB0aGUgb3JkZXIgaW4gdGhlIHN0cnVjdAoqLwpjb250cmFjdCBCYW5jb3JDb252ZXJ0ZXIgaXMgSVRva2VuQ29udmVydGVyLCBTbWFydFRva2VuQ29udHJvbGxlciwgTWFuYWdlZCB7CiAgICB1aW50MzIgcHJpdmF0ZSBjb25zdGFudCBNQVhfQ1JSID0gMTAwMDAwMDsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9DT05WRVJTSU9OX0ZFRSA9IDEwMDAwMDA7CgogICAgc3RydWN0IFJlc2VydmUgewogICAgICAgIHVpbnQyNTYgdmlydHVhbEJhbGFuY2U7ICAgICAgICAgLy8gdmlydHVhbCBiYWxhbmNlCiAgICAgICAgdWludDMyIHJhdGlvOyAgICAgICAgICAgICAgICAgICAvLyBjb25zdGFudCByZXNlcnZlIHJhdGlvIChDUlIpLCByZXByZXNlbnRlZCBpbiBwcG0sIDEtMTAwMDAwMAogICAgICAgIGJvb2wgaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQ7ICAgLy8gdHJ1ZSBpZiB2aXJ0dWFsIGJhbGFuY2UgaXMgZW5hYmxlZCwgZmFsc2UgaWYgbm90CiAgICAgICAgYm9vbCBpc1B1cmNoYXNlRW5hYmxlZDsgICAgICAgICAvLyBpcyBwdXJjaGFzZSBvZiB0aGUgc21hcnQgdG9rZW4gZW5hYmxlZCB3aXRoIHRoZSByZXNlcnZlLCBjYW4gYmUgc2V0IGJ5IHRoZSBvd25lcgogICAgICAgIGJvb2wgaXNTZXQ7ICAgICAgICAgICAgICAgICAgICAgLy8gdXNlZCB0byB0ZWxsIGlmIHRoZSBtYXBwaW5nIGVsZW1lbnQgaXMgZGVmaW5lZAogICAgfQoKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICcwLjQnOwogICAgc3RyaW5nIHB1YmxpYyBjb252ZXJ0ZXJUeXBlID0gJ2JhbmNvcic7CgogICAgSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgcHVibGljIGV4dGVuc2lvbnM7ICAgLy8gYmFuY29yIGNvbnZlcnRlciBleHRlbnNpb25zIGNvbnRyYWN0CiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyByZXNlcnZlVG9rZW5zOyAgICAgICAgICAgICAvLyBFUkMyMCBzdGFuZGFyZCB0b2tlbiBhZGRyZXNzZXMKICAgIElFUkMyMFRva2VuW10gcHVibGljIHF1aWNrQnV5UGF0aDsgICAgICAgICAgICAgIC8vIGNvbnZlcnNpb24gcGF0aCB0aGF0J3MgdXNlZCBpbiBvcmRlciB0byBidXkgdGhlIHRva2VuIHdpdGggRVRICiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFJlc2VydmUpIHB1YmxpYyByZXNlcnZlczsgICAvLyByZXNlcnZlIHRva2VuIGFkZHJlc3NlcyAtPiByZXNlcnZlIGRhdGEKICAgIHVpbnQzMiBwcml2YXRlIHRvdGFsUmVzZXJ2ZVJhdGlvID0gMDsgICAgICAgICAgIC8vIHVzZWQgdG8gZWZmaWNpZW50bHkgcHJldmVudCBpbmNyZWFzaW5nIHRoZSB0b3RhbCByZXNlcnZlIHJhdGlvIGFib3ZlIDEwMCUKICAgIHVpbnQzMiBwdWJsaWMgbWF4Q29udmVyc2lvbkZlZSA9IDA7ICAgICAgICAgICAgIC8vIG1heGltdW0gY29udmVyc2lvbiBmZWUgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgY29udHJhY3QsIHJlcHJlc2VudGVkIGluIHBwbSwgMC4uLjEwMDAwMDAgKDAgPSBubyBmZWUsIDEwMCA9IDAuMDElLCAxMDAwMDAwID0gMTAwJSkKICAgIHVpbnQzMiBwdWJsaWMgY29udmVyc2lvbkZlZSA9IDA7ICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgY29udmVyc2lvbiBmZWUsIHJlcHJlc2VudGVkIGluIHBwbSwgMC4uLm1heENvbnZlcnNpb25GZWUKICAgIGJvb2wgcHVibGljIGNvbnZlcnNpb25zRW5hYmxlZCA9IHRydWU7ICAgICAgICAgIC8vIHRydWUgaWYgdG9rZW4gY29udmVyc2lvbnMgaXMgZW5hYmxlZCwgZmFsc2UgaWYgbm90CgogICAgLy8gdHJpZ2dlcmVkIHdoZW4gYSBjb252ZXJzaW9uIGJldHdlZW4gdHdvIHRva2VucyBvY2N1cnMgKFRva2VuQ29udmVydGVyIGV2ZW50KQogICAgZXZlbnQgQ29udmVyc2lvbihhZGRyZXNzIGluZGV4ZWQgX2Zyb21Ub2tlbiwgYWRkcmVzcyBpbmRleGVkIF90b1Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX3RyYWRlciwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9yZXR1cm4sCiAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX2N1cnJlbnRQcmljZU4sIHVpbnQyNTYgX2N1cnJlbnRQcmljZUQpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKCiAgICAgICAgQHBhcmFtICBfdG9rZW4gICAgICAgICAgICAgIHNtYXJ0IHRva2VuIGdvdmVybmVkIGJ5IHRoZSBjb252ZXJ0ZXIKICAgICAgICBAcGFyYW0gIF9leHRlbnNpb25zICAgICAgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBjb252ZXJ0ZXIgZXh0ZW5zaW9ucyBjb250cmFjdAogICAgICAgIEBwYXJhbSAgX21heENvbnZlcnNpb25GZWUgICBtYXhpbXVtIGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICAgICBAcGFyYW0gIF9yZXNlcnZlVG9rZW4gICAgICAgb3B0aW9uYWwsIGluaXRpYWwgcmVzZXJ2ZSwgYWxsb3dzIGRlZmluaW5nIHRoZSBmaXJzdCByZXNlcnZlIGF0IGRlcGxveW1lbnQgdGltZQogICAgICAgIEBwYXJhbSAgX3Jlc2VydmVSYXRpbyAgICAgICBvcHRpb25hbCwgcmF0aW8gZm9yIHRoZSBpbml0aWFsIHJlc2VydmUKICAgICovCiAgICBmdW5jdGlvbiBCYW5jb3JDb252ZXJ0ZXIoSVNtYXJ0VG9rZW4gX3Rva2VuLCBJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyBfZXh0ZW5zaW9ucywgdWludDMyIF9tYXhDb252ZXJzaW9uRmVlLCBJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MzIgX3Jlc2VydmVSYXRpbykKICAgICAgICBTbWFydFRva2VuQ29udHJvbGxlcihfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF9leHRlbnNpb25zKQogICAgICAgIHZhbGlkTWF4Q29udmVyc2lvbkZlZShfbWF4Q29udmVyc2lvbkZlZSkKICAgIHsKICAgICAgICBleHRlbnNpb25zID0gX2V4dGVuc2lvbnM7CiAgICAgICAgbWF4Q29udmVyc2lvbkZlZSA9IF9tYXhDb252ZXJzaW9uRmVlOwoKICAgICAgICBpZiAoYWRkcmVzcyhfcmVzZXJ2ZVRva2VuKSAhPSAweDApCiAgICAgICAgICAgIGFkZFJlc2VydmUoX3Jlc2VydmVUb2tlbiwgX3Jlc2VydmVSYXRpbywgZmFsc2UpOwogICAgfQoKICAgIC8vIHZhbGlkYXRlcyBhIHJlc2VydmUgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIHJlc2VydmUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFJlc2VydmUoSUVSQzIwVG9rZW4gX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKHJlc2VydmVzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgY29udmVydGlibGUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFRva2VuKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSB0b2tlbiB8fCByZXNlcnZlc1tfYWRkcmVzc10uaXNTZXQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmVyaWZpZXMgdGhhdCB0aGUgZ2FzIHByaWNlIGlzIGxvd2VyIHRoYW4gdGhlIHVuaXZlcnNhbCBsaW1pdAogICAgbW9kaWZpZXIgdmFsaWRHYXNQcmljZSgpIHsKICAgICAgICBhc3NlcnQodHguZ2FzcHJpY2UgPD0gZXh0ZW5zaW9ucy5nYXNQcmljZUxpbWl0KCkuZ2FzUHJpY2UoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgbWF4aW11bSBjb252ZXJzaW9uIGZlZQogICAgbW9kaWZpZXIgdmFsaWRNYXhDb252ZXJzaW9uRmVlKHVpbnQzMiBfY29udmVyc2lvbkZlZSkgewogICAgICAgIHJlcXVpcmUoX2NvbnZlcnNpb25GZWUgPj0gMCAmJiBfY29udmVyc2lvbkZlZSA8PSBNQVhfQ09OVkVSU0lPTl9GRUUpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGNvbnZlcnNpb24gZmVlCiAgICBtb2RpZmllciB2YWxpZENvbnZlcnNpb25GZWUodWludDMyIF9jb252ZXJzaW9uRmVlKSB7CiAgICAgICAgcmVxdWlyZShfY29udmVyc2lvbkZlZSA+PSAwICYmIF9jb252ZXJzaW9uRmVlIDw9IG1heENvbnZlcnNpb25GZWUpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIHJlc2VydmUgcmF0aW8gcmFuZ2UKICAgIG1vZGlmaWVyIHZhbGlkUmVzZXJ2ZVJhdGlvKHVpbnQzMiBfcmF0aW8pIHsKICAgICAgICByZXF1aXJlKF9yYXRpbyA+IDAgJiYgX3JhdGlvIDw9IE1BWF9DUlIpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGEgY29udmVyc2lvbiBwYXRoIC0gdmVyaWZpZXMgdGhhdCB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGlzIG9kZCBhbmQgdGhhdCBtYXhpbXVtIG51bWJlciBvZiAnaG9wcycgaXMgMTAKICAgIG1vZGlmaWVyIHZhbGlkQ29udmVyc2lvblBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkgewogICAgICAgIHJlcXVpcmUoX3BhdGgubGVuZ3RoID4gMiAmJiBfcGF0aC5sZW5ndGggPD0gKDEgKyAyICogMTApICYmIF9wYXRoLmxlbmd0aCAlIDIgPT0gMSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIG9ubHkgd2hlbiBjb252ZXJzaW9ucyBhcmVuJ3QgZGlzYWJsZWQKICAgIG1vZGlmaWVyIGNvbnZlcnNpb25zQWxsb3dlZCB7CiAgICAgICAgYXNzZXJ0KGNvbnZlcnNpb25zRW5hYmxlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIG51bWJlciBvZiByZXNlcnZlIHRva2VucyBkZWZpbmVkCgogICAgICAgIEByZXR1cm4gbnVtYmVyIG9mIHJlc2VydmUgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gcmVzZXJ2ZVRva2VuQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgcmV0dXJuIHVpbnQxNihyZXNlcnZlVG9rZW5zLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBudW1iZXIgb2YgY29udmVydGlibGUgdG9rZW5zIHN1cHBvcnRlZCBieSB0aGUgY29udHJhY3QKICAgICAgICBub3RlIHRoYXQgdGhlIG51bWJlciBvZiBjb252ZXJ0aWJsZSB0b2tlbnMgaXMgdGhlIG51bWJlciBvZiByZXNlcnZlIHRva2VuLCBwbHVzIDEgKHRoYXQgcmVwcmVzZW50cyB0aGUgc21hcnQgdG9rZW4pCgogICAgICAgIEByZXR1cm4gbnVtYmVyIG9mIGNvbnZlcnRpYmxlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNvbnZlcnRpYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYpIHsKICAgICAgICByZXR1cm4gcmVzZXJ2ZVRva2VuQ291bnQoKSArIDE7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBnaXZlbiBhIGNvbnZlcnRpYmxlIHRva2VuIGluZGV4LCByZXR1cm5zIGl0cyBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfdG9rZW5JbmRleCAgY29udmVydGlibGUgdG9rZW4gaW5kZXgKCiAgICAgICAgQHJldHVybiBjb252ZXJ0aWJsZSB0b2tlbiBhZGRyZXNzCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgaWYgKF90b2tlbkluZGV4ID09IDApCiAgICAgICAgICAgIHJldHVybiB0b2tlbjsKICAgICAgICByZXR1cm4gcmVzZXJ2ZVRva2Vuc1tfdG9rZW5JbmRleCAtIDFdOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG93bmVyIHRvIHVwZGF0ZSB0aGUgZXh0ZW5zaW9ucyBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfZXh0ZW5zaW9ucyAgICBhZGRyZXNzIG9mIGEgYmFuY29yIGNvbnZlcnRlciBleHRlbnNpb25zIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2V0RXh0ZW5zaW9ucyhJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyBfZXh0ZW5zaW9ucykKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX2V4dGVuc2lvbnMpCiAgICAgICAgbm90VGhpcyhfZXh0ZW5zaW9ucykKICAgIHsKICAgICAgICBleHRlbnNpb25zID0gX2V4dGVuc2lvbnM7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgbWFuYWdlciB0byB1cGRhdGUgdGhlIHF1aWNrIGJ1eSBwYXRoCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICBuZXcgcXVpY2sgYnV5IHBhdGgsIHNlZSBjb252ZXJzaW9uIHBhdGggZm9ybWF0IGluIHRoZSBCYW5jb3JRdWlja0NvbnZlcnRlciBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldFF1aWNrQnV5UGF0aChJRVJDMjBUb2tlbltdIF9wYXRoKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQ29udmVyc2lvblBhdGgoX3BhdGgpCiAgICB7CiAgICAgICAgcXVpY2tCdXlQYXRoID0gX3BhdGg7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgbWFuYWdlciB0byBjbGVhciB0aGUgcXVpY2sgYnV5IHBhdGgKICAgICovCiAgICBmdW5jdGlvbiBjbGVhclF1aWNrQnV5UGF0aCgpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHF1aWNrQnV5UGF0aC5sZW5ndGggPSAwOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBxdWljayBidXkgcGF0aCBhcnJheQoKICAgICAgICBAcmV0dXJuIHF1aWNrIGJ1eSBwYXRoIGxlbmd0aAogICAgKi8KICAgIGZ1bmN0aW9uIGdldFF1aWNrQnV5UGF0aExlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHF1aWNrQnV5UGF0aC5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcyB0aGUgZW50aXJlIGNvbnZlcnNpb24gZnVuY3Rpb25hbGl0eQogICAgICAgIHRoaXMgaXMgYSBzYWZldHkgbWVjaGFuaXNtIGluIGNhc2Ugb2YgYSBlbWVyZ2VuY3kKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlIHRydWUgdG8gZGlzYWJsZSBjb252ZXJzaW9ucywgZmFsc2UgdG8gcmUtZW5hYmxlIHRoZW0KICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQ29udmVyc2lvbnMoYm9vbCBfZGlzYWJsZSkgcHVibGljIG1hbmFnZXJPbmx5IHsKICAgICAgICBjb252ZXJzaW9uc0VuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1cGRhdGVzIHRoZSBjdXJyZW50IGNvbnZlcnNpb24gZmVlCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBtYW5hZ2VyCgogICAgICAgIEBwYXJhbSBfY29udmVyc2lvbkZlZSBuZXcgY29udmVyc2lvbiBmZWUsIHJlcHJlc2VudGVkIGluIHBwbQogICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnZlcnNpb25GZWUodWludDMyIF9jb252ZXJzaW9uRmVlKQogICAgICAgIHB1YmxpYwogICAgICAgIG1hbmFnZXJPbmx5CiAgICAgICAgdmFsaWRDb252ZXJzaW9uRmVlKF9jb252ZXJzaW9uRmVlKQogICAgewogICAgICAgIGNvbnZlcnNpb25GZWUgPSBfY29udmVyc2lvbkZlZTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgY29udmVyc2lvbiBmZWUgYW1vdW50IGZvciBhIGdpdmVuIHJldHVybiBhbW91bnQKCiAgICAgICAgQHJldHVybiBjb252ZXJzaW9uIGZlZSBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRDb252ZXJzaW9uRmVlQW1vdW50KHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc2FmZU11bChfYW1vdW50LCBjb252ZXJzaW9uRmVlKSAvIE1BWF9DT05WRVJTSU9OX0ZFRTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRlZmluZXMgYSBuZXcgcmVzZXJ2ZSBmb3IgdGhlIHRva2VuCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciB3aGlsZSB0aGUgY29udmVydGVyIGlzIGluYWN0aXZlCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICBhZGRyZXNzIG9mIHRoZSByZXNlcnZlIHRva2VuCiAgICAgICAgQHBhcmFtIF9yYXRpbyAgICAgICAgICAgICAgICAgIGNvbnN0YW50IHJlc2VydmUgcmF0aW8sIHJlcHJlc2VudGVkIGluIHBwbSwgMS0xMDAwMDAwCiAgICAgICAgQHBhcmFtIF9lbmFibGVWaXJ0dWFsQmFsYW5jZSAgIHRydWUgdG8gZW5hYmxlIHZpcnR1YWwgYmFsYW5jZSBmb3IgdGhlIHJlc2VydmUsIGZhbHNlIHRvIGRpc2FibGUgaXQKICAgICovCiAgICBmdW5jdGlvbiBhZGRSZXNlcnZlKElFUkMyMFRva2VuIF90b2tlbiwgdWludDMyIF9yYXRpbywgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgaW5hY3RpdmUKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgICAgIG5vdFRoaXMoX3Rva2VuKQogICAgICAgIHZhbGlkUmVzZXJ2ZVJhdGlvKF9yYXRpbykKICAgIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSB0b2tlbiAmJiAhcmVzZXJ2ZXNbX3Rva2VuXS5pc1NldCAmJiB0b3RhbFJlc2VydmVSYXRpbyArIF9yYXRpbyA8PSBNQVhfQ1JSKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS52aXJ0dWFsQmFsYW5jZSA9IDA7CiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS5yYXRpbyA9IF9yYXRpbzsKICAgICAgICByZXNlcnZlc1tfdG9rZW5dLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkID0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlOwogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSB0cnVlOwogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNTZXQgPSB0cnVlOwogICAgICAgIHJlc2VydmVUb2tlbnMucHVzaChfdG9rZW4pOwogICAgICAgIHRvdGFsUmVzZXJ2ZVJhdGlvICs9IF9yYXRpbzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVwZGF0ZXMgb25lIG9mIHRoZSB0b2tlbiByZXNlcnZlcwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgICAgICAgIGFkZHJlc3Mgb2YgdGhlIHJlc2VydmUgdG9rZW4KICAgICAgICBAcGFyYW0gX3JhdGlvICAgICAgICAgICAgICAgICAgY29uc3RhbnQgcmVzZXJ2ZSByYXRpbywgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgcmVzZXJ2ZSwgZmFsc2UgdG8gZGlzYWJsZSBpdAogICAgICAgIEBwYXJhbSBfdmlydHVhbEJhbGFuY2UgICAgICAgICBuZXcgcmVzZXJ2ZSdzIHZpcnR1YWwgYmFsYW5jZQogICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZVJlc2VydmUoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDMyIF9yYXRpbywgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UsIHVpbnQyNTYgX3ZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHZhbGlkUmVzZXJ2ZVJhdGlvKF9yYXRpbykKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHJlcXVpcmUodG90YWxSZXNlcnZlUmF0aW8gLSByZXNlcnZlLnJhdGlvICsgX3JhdGlvIDw9IE1BWF9DUlIpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB0b3RhbFJlc2VydmVSYXRpbyA9IHRvdGFsUmVzZXJ2ZVJhdGlvIC0gcmVzZXJ2ZS5yYXRpbyArIF9yYXRpbzsKICAgICAgICByZXNlcnZlLnJhdGlvID0gX3JhdGlvOwogICAgICAgIHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7CiAgICAgICAgcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA9IF92aXJ0dWFsQmFsYW5jZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRpc2FibGVzIHB1cmNoYXNpbmcgd2l0aCB0aGUgZ2l2ZW4gcmVzZXJ2ZSB0b2tlbiBpbiBjYXNlIHRoZSByZXNlcnZlIHRva2VuIGdvdCBjb21wcm9taXNlZAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgICAgICBub3RlIHRoYXQgc2VsbGluZyBpcyBzdGlsbCBlbmFibGVkIHJlZ2FyZGxlc3Mgb2YgdGhpcyBmbGFnIGFuZCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfZGlzYWJsZSAgICAgICAgIHRydWUgdG8gZGlzYWJsZSB0aGUgdG9rZW4sIGZhbHNlIHRvIHJlLWVuYWJsZSBpdAogICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVSZXNlcnZlUHVyY2hhc2VzKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIGJvb2wgX2Rpc2FibGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pCiAgICB7CiAgICAgICAgcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSByZXNlcnZlJ3MgdmlydHVhbCBiYWxhbmNlIGlmIG9uZSBpcyBkZWZpbmVkLCBvdGhlcndpc2UgcmV0dXJucyB0aGUgYWN0dWFsIGJhbGFuY2UKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgcmVzZXJ2ZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gcmVzZXJ2ZSBiYWxhbmNlCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZUJhbGFuY2UoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgUmVzZXJ2ZSBzdG9yYWdlIHJlc2VydmUgPSByZXNlcnZlc1tfcmVzZXJ2ZVRva2VuXTsKICAgICAgICByZXR1cm4gcmVzZXJ2ZS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCA/IHJlc2VydmUudmlydHVhbEJhbGFuY2UgOiBfcmVzZXJ2ZVRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3IgY29udmVydGluZyBhIHNwZWNpZmljIGFtb3VudCBvZiBfZnJvbVRva2VuIHRvIF90b1Rva2VuCgogICAgICAgIEBwYXJhbSBfZnJvbVRva2VuICBFUkMyMCB0b2tlbiB0byBjb252ZXJ0IGZyb20KICAgICAgICBAcGFyYW0gX3RvVG9rZW4gICAgRVJDMjAgdG9rZW4gdG8gY29udmVydCB0bwogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gY29udmVydCwgaW4gZnJvbVRva2VuCgogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgY29udmVyc2lvbiByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmV0dXJuKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShfZnJvbVRva2VuICE9IF90b1Rva2VuKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIHRoZSB0b2tlbiBhbmQgb25lIG9mIGl0cyByZXNlcnZlcwogICAgICAgIGlmIChfdG9Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGdldFB1cmNoYXNlUmV0dXJuKF9mcm9tVG9rZW4sIF9hbW91bnQpOwogICAgICAgIGVsc2UgaWYgKF9mcm9tVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBfYW1vdW50KTsKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIDIgcmVzZXJ2ZXMKICAgICAgICB1aW50MjU2IHB1cmNoYXNlUmV0dXJuQW1vdW50ID0gZ2V0UHVyY2hhc2VSZXR1cm4oX2Zyb21Ub2tlbiwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3RvVG9rZW4sIHB1cmNoYXNlUmV0dXJuQW1vdW50LCBzYWZlQWRkKHRva2VuLnRvdGFsU3VwcGx5KCksIHB1cmNoYXNlUmV0dXJuQW1vdW50KSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBleHBlY3RlZCByZXR1cm4gZm9yIGJ1eWluZyB0aGUgdG9rZW4gZm9yIGEgcmVzZXJ2ZSB0b2tlbgoKICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfZGVwb3NpdEFtb3VudCAgYW1vdW50IHRvIGRlcG9zaXQgKGluIHRoZSByZXNlcnZlIHRva2VuKQoKICAgICAgICBAcmV0dXJuIGV4cGVjdGVkIHB1cmNoYXNlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRQdXJjaGFzZVJldHVybihJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgYWN0aXZlCiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHJlcXVpcmUocmVzZXJ2ZS5pc1B1cmNoYXNlRW5hYmxlZCk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIHVpbnQyNTYgdG9rZW5TdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUJhbGFuY2UgPSBnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKTsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGV4dGVuc2lvbnMuZm9ybXVsYSgpLmNhbGN1bGF0ZVB1cmNoYXNlUmV0dXJuKHRva2VuU3VwcGx5LCByZXNlcnZlQmFsYW5jZSwgcmVzZXJ2ZS5yYXRpbywgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyBkZWR1Y3QgdGhlIGZlZSBmcm9tIHRoZSByZXR1cm4gYW1vdW50CiAgICAgICAgdWludDI1NiBmZWVBbW91bnQgPSBnZXRDb252ZXJzaW9uRmVlQW1vdW50KGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHNhZmVTdWIoYW1vdW50LCBmZWVBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyByZXNlcnZlIHRva2VucwoKICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBzYWxlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRTYWxlUmV0dXJuKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3Jlc2VydmVUb2tlbiwgX3NlbGxBbW91bnQsIHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgYSBzcGVjaWZpYyBhbW91bnQgb2YgX2Zyb21Ub2tlbiB0byBfdG9Ub2tlbgoKICAgICAgICBAcGFyYW0gX2Zyb21Ub2tlbiAgRVJDMjAgdG9rZW4gdG8gY29udmVydCBmcm9tCiAgICAgICAgQHBhcmFtIF90b1Rva2VuICAgIEVSQzIwIHRva2VuIHRvIGNvbnZlcnQgdG8KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGNvbnZlcnQsIGluIGZyb21Ub2tlbgogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBjb252ZXJzaW9uIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9mcm9tVG9rZW4gIT0gX3RvVG9rZW4pOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICAvLyBjb252ZXJzaW9uIGJldHdlZW4gdGhlIHRva2VuIGFuZCBvbmUgb2YgaXRzIHJlc2VydmVzCiAgICAgICAgaWYgKF90b1Rva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gYnV5KF9mcm9tVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwogICAgICAgIGVsc2UgaWYgKF9mcm9tVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBzZWxsKF90b1Rva2VuLCBfYW1vdW50LCBfbWluUmV0dXJuKTsKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIDIgcmVzZXJ2ZXMKICAgICAgICB1aW50MjU2IHB1cmNoYXNlQW1vdW50ID0gYnV5KF9mcm9tVG9rZW4sIF9hbW91bnQsIDEpOwogICAgICAgIHJldHVybiBzZWxsKF90b1Rva2VuLCBwdXJjaGFzZUFtb3VudCwgX21pblJldHVybik7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBidXlzIHRoZSB0b2tlbiBieSBkZXBvc2l0aW5nIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIGJ1eSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gYnV5KElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICBjb252ZXJzaW9uc0FsbG93ZWQKICAgICAgICB2YWxpZEdhc1ByaWNlCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF9taW5SZXR1cm4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9yZXNlcnZlVG9rZW4sIF9kZXBvc2l0QW1vdW50KTsKICAgICAgICBhc3NlcnQoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIFJlc2VydmUgc3RvcmFnZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07CiAgICAgICAgaWYgKHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQpCiAgICAgICAgICAgIHJlc2VydmUudmlydHVhbEJhbGFuY2UgPSBzYWZlQWRkKHJlc2VydmUudmlydHVhbEJhbGFuY2UsIF9kZXBvc2l0QW1vdW50KTsKCiAgICAgICAgLy8gdHJhbnNmZXIgX2RlcG9zaXRBbW91bnQgZnVuZHMgZnJvbSB0aGUgY2FsbGVyIGluIHRoZSByZXNlcnZlIHRva2VuCiAgICAgICAgYXNzZXJ0KF9yZXNlcnZlVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9kZXBvc2l0QW1vdW50KSk7CiAgICAgICAgLy8gaXNzdWUgbmV3IGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgdG9rZW4uaXNzdWUobXNnLnNlbmRlciwgYW1vdW50KTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgcHJpY2UgdXNpbmcgdGhlIHNpbXBsZSBwcmljZSBmb3JtdWxhCiAgICAgICAgLy8gcHJpY2UgPSByZXNlcnZlIGJhbGFuY2UgLyAoc3VwcGx5ICogQ1JSKQogICAgICAgIC8vIENSUiBpcyByZXByZXNlbnRlZCBpbiBwcG0sIHNvIG11bHRpcGx5aW5nIGJ5IDEwMDAwMDAKICAgICAgICB1aW50MjU2IHJlc2VydmVBbW91bnQgPSBzYWZlTXVsKGdldFJlc2VydmVCYWxhbmNlKF9yZXNlcnZlVG9rZW4pLCBNQVhfQ1JSKTsKICAgICAgICB1aW50MjU2IHRva2VuQW1vdW50ID0gc2FmZU11bCh0b2tlbi50b3RhbFN1cHBseSgpLCByZXNlcnZlLnJhdGlvKTsKICAgICAgICBDb252ZXJzaW9uKF9yZXNlcnZlVG9rZW4sIHRva2VuLCBtc2cuc2VuZGVyLCBfZGVwb3NpdEFtb3VudCwgYW1vdW50LCByZXNlcnZlQW1vdW50LCB0b2tlbkFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHNlbGxzIHRoZSB0b2tlbiBieSB3aXRoZHJhd2luZyBmcm9tIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICAgICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gc2VsbCByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gc2VsbChJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pCiAgICAgICAgcHVibGljCiAgICAgICAgY29udmVyc2lvbnNBbGxvd2VkCiAgICAgICAgdmFsaWRHYXNQcmljZQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfbWluUmV0dXJuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmVxdWlyZShfc2VsbEFtb3VudCA8PSB0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcikpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGdldFNhbGVSZXR1cm4oX3Jlc2VydmVUb2tlbiwgX3NlbGxBbW91bnQpOwogICAgICAgIGFzc2VydChhbW91bnQgIT0gMCAmJiBhbW91bnQgPj0gX21pblJldHVybik7IC8vIGVuc3VyZSB0aGUgdHJhZGUgZ2l2ZXMgc29tZXRoaW5nIGluIHJldHVybiBhbmQgbWVldHMgdGhlIG1pbmltdW0gcmVxdWVzdGVkIGFtb3VudAoKICAgICAgICB1aW50MjU2IHRva2VuU3VwcGx5ID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IHJlc2VydmVCYWxhbmNlID0gZ2V0UmVzZXJ2ZUJhbGFuY2UoX3Jlc2VydmVUb2tlbik7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIHRyYWRlIHdpbGwgb25seSBkZXBsZXRlIHRoZSByZXNlcnZlIGlmIHRoZSB0b3RhbCBzdXBwbHkgaXMgZGVwbGV0ZWQgYXMgd2VsbAogICAgICAgIGFzc2VydChhbW91bnQgPCByZXNlcnZlQmFsYW5jZSB8fCAoYW1vdW50ID09IHJlc2VydmVCYWxhbmNlICYmIF9zZWxsQW1vdW50ID09IHRva2VuU3VwcGx5KSk7CgogICAgICAgIC8vIHVwZGF0ZSB2aXJ0dWFsIGJhbGFuY2UgaWYgcmVsZXZhbnQKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIGlmIChyZXNlcnZlLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICByZXNlcnZlLnZpcnR1YWxCYWxhbmNlID0gc2FmZVN1YihyZXNlcnZlLnZpcnR1YWxCYWxhbmNlLCBhbW91bnQpOwoKICAgICAgICAvLyBkZXN0cm95IF9zZWxsQW1vdW50IGZyb20gdGhlIGNhbGxlcidzIGJhbGFuY2UgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfc2VsbEFtb3VudCk7CiAgICAgICAgLy8gdHJhbnNmZXIgZnVuZHMgdG8gdGhlIGNhbGxlciBpbiB0aGUgcmVzZXJ2ZSB0b2tlbgogICAgICAgIC8vIHRoZSB0cmFuc2ZlciBtaWdodCBmYWlsIGlmIHRoZSBhY3R1YWwgcmVzZXJ2ZSBiYWxhbmNlIGlzIHNtYWxsZXIgdGhhbiB0aGUgdmlydHVhbCBiYWxhbmNlCiAgICAgICAgYXNzZXJ0KF9yZXNlcnZlVG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50KSk7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgbmV3IHByaWNlIHVzaW5nIHRoZSBzaW1wbGUgcHJpY2UgZm9ybXVsYQogICAgICAgIC8vIHByaWNlID0gcmVzZXJ2ZSBiYWxhbmNlIC8gKHN1cHBseSAqIENSUikKICAgICAgICAvLyBDUlIgaXMgcmVwcmVzZW50ZWQgaW4gcHBtLCBzbyBtdWx0aXBseWluZyBieSAxMDAwMDAwCiAgICAgICAgdWludDI1NiByZXNlcnZlQW1vdW50ID0gc2FmZU11bChnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKSwgTUFYX0NSUik7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IHNhZmVNdWwodG9rZW4udG90YWxTdXBwbHkoKSwgcmVzZXJ2ZS5yYXRpbyk7CiAgICAgICAgQ29udmVyc2lvbih0b2tlbiwgX3Jlc2VydmVUb2tlbiwgbXNnLnNlbmRlciwgX3NlbGxBbW91bnQsIGFtb3VudCwgdG9rZW5BbW91bnQsIHJlc2VydmVBbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjb252ZXJ0cyB0aGUgdG9rZW4gdG8gYW55IG90aGVyIHRva2VuIGluIHRoZSBiYW5jb3IgbmV0d29yayBieSBmb2xsb3dpbmcgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aAogICAgICAgIG5vdGUgdGhhdCB3aGVuIGNvbnZlcnRpbmcgZnJvbSBhbiBFUkMyMCB0b2tlbiAoYXMgb3Bwb3NlZCB0byBhIHNtYXJ0IHRva2VuKSwgYWxsb3dhbmNlIG11c3QgYmUgc2V0IGJlZm9yZWhhbmQKCiAgICAgICAgQHBhcmFtIF9wYXRoICAgICAgICBjb252ZXJzaW9uIHBhdGgsIHNlZSBjb252ZXJzaW9uIHBhdGggZm9ybWF0IGluIHRoZSBCYW5jb3JRdWlja0NvbnZlcnRlciBjb250cmFjdAogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICAgYW1vdW50IHRvIGNvbnZlcnQgZnJvbSAoaW4gdGhlIGluaXRpYWwgc291cmNlIHRva2VuKQogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICAgaWYgdGhlIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gdG9rZW5zIGlzc3VlZCBpbiByZXR1cm4KICAgICovCiAgICBmdW5jdGlvbiBxdWlja0NvbnZlcnQoSUVSQzIwVG9rZW5bXSBfcGF0aCwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHZhbGlkQ29udmVyc2lvblBhdGgoX3BhdGgpCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBJRVJDMjBUb2tlbiBmcm9tVG9rZW4gPSBfcGF0aFswXTsKICAgICAgICBJQmFuY29yUXVpY2tDb252ZXJ0ZXIgcXVpY2tDb252ZXJ0ZXIgPSBleHRlbnNpb25zLnF1aWNrQ29udmVydGVyKCk7CgogICAgICAgIC8vIHdlIG5lZWQgdG8gdHJhbnNmZXIgdGhlIHNvdXJjZSB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIHRvIHRoZSBxdWljayBjb252ZXJ0ZXIsCiAgICAgICAgLy8gc28gaXQgY2FuIGV4ZWN1dGUgdGhlIGNvbnZlcnNpb24gb24gYmVoYWxmIG9mIHRoZSBjYWxsZXIKICAgICAgICBpZiAobXNnLnZhbHVlID09IDApIHsKICAgICAgICAgICAgLy8gbm90IEVUSCwgc2VuZCB0aGUgc291cmNlIHRva2VucyB0byB0aGUgcXVpY2sgY29udmVydGVyCiAgICAgICAgICAgIC8vIGlmIHRoZSB0b2tlbiBpcyB0aGUgc21hcnQgdG9rZW4sIG5vIGFsbG93YW5jZSBpcyByZXF1aXJlZCAtIGRlc3Ryb3kgdGhlIHRva2VucyBmcm9tIHRoZSBjYWxsZXIgYW5kIGlzc3VlIHRoZW0gdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICBpZiAoZnJvbVRva2VuID09IHRva2VuKSB7CiAgICAgICAgICAgICAgICB0b2tlbi5kZXN0cm95KG1zZy5zZW5kZXIsIF9hbW91bnQpOyAvLyBkZXN0cm95IF9hbW91bnQgdG9rZW5zIGZyb20gdGhlIGNhbGxlcidzIGJhbGFuY2UgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgICAgICAgICB0b2tlbi5pc3N1ZShxdWlja0NvbnZlcnRlciwgX2Ftb3VudCk7IC8vIGlzc3VlIF9hbW91bnQgbmV3IHRva2VucyB0byB0aGUgcXVpY2sgY29udmVydGVyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIHdlIGFzc3VtZSB3ZSBhbHJlYWR5IGhhdmUgYWxsb3dhbmNlLCB0cmFuc2ZlciB0aGUgdG9rZW5zIGRpcmVjdGx5IHRvIHRoZSBxdWljayBjb252ZXJ0ZXIKICAgICAgICAgICAgICAgIGFzc2VydChmcm9tVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHF1aWNrQ29udmVydGVyLCBfYW1vdW50KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGV4ZWN1dGUgdGhlIGNvbnZlcnNpb24gYW5kIHBhc3Mgb24gdGhlIEVUSCB3aXRoIHRoZSBjYWxsCiAgICAgICAgcmV0dXJuIHF1aWNrQ29udmVydGVyLmNvbnZlcnRGb3IudmFsdWUobXNnLnZhbHVlKShfcGF0aCwgX2Ftb3VudCwgX21pblJldHVybiwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY29udmVydChfZnJvbVRva2VuLCBfdG9Ub2tlbiwgX2Ftb3VudCwgX21pblJldHVybik7CiAgICB9CgogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gcXVpY2tDaGFuZ2UoSUVSQzIwVG9rZW5bXSBfcGF0aCwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHF1aWNrQ29udmVydChfcGF0aCwgX2Ftb3VudCwgX21pblJldHVybik7CiAgICB9CgogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gcXVpY2tCdXkodWludDI1NiBfbWluUmV0dXJuKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHF1aWNrQ29udmVydChxdWlja0J1eVBhdGgsIG1zZy52YWx1ZSwgX21pblJldHVybik7CiAgICB9CgogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gaGFzUXVpY2tCdXlFdGhlclRva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcXVpY2tCdXlQYXRoLmxlbmd0aCA+IDA7CiAgICB9CgogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gZ2V0UXVpY2tCdXlFdGhlclRva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKElFdGhlclRva2VuKSB7CiAgICAgICAgYXNzZXJ0KHF1aWNrQnV5UGF0aC5sZW5ndGggPiAwKTsKICAgICAgICByZXR1cm4gSUV0aGVyVG9rZW4ocXVpY2tCdXlQYXRoWzBdKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHV0aWxpdHksIHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3Igc2VsbGluZyB0aGUgdG9rZW4gZm9yIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMsIGdpdmVuIGEgdG90YWwgc3VwcGx5IG92ZXJyaWRlCgogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgcmVzZXJ2ZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICBhbW91bnQgdG8gc2VsbCAoaW4gdGhlIHNtYXJ0IHRva2VuKQogICAgICAgIEBwYXJhbSBfdG90YWxTdXBwbHkgICAgdG90YWwgdG9rZW4gc3VwcGx5LCBvdmVycmlkZXMgdGhlIGFjdHVhbCB0b2tlbiB0b3RhbCBzdXBwbHkgd2hlbiBjYWxjdWxhdGluZyB0aGUgcmV0dXJuCgogICAgICAgIEByZXR1cm4gc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50LCB1aW50MjU2IF90b3RhbFN1cHBseSkKICAgICAgICBwcml2YXRlCiAgICAgICAgY29uc3RhbnQKICAgICAgICBhY3RpdmUKICAgICAgICB2YWxpZFJlc2VydmUoX3Jlc2VydmVUb2tlbikKICAgICAgICBncmVhdGVyVGhhblplcm8oX3RvdGFsU3VwcGx5KQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgUmVzZXJ2ZSBzdG9yYWdlIHJlc2VydmUgPSByZXNlcnZlc1tfcmVzZXJ2ZVRva2VuXTsKICAgICAgICB1aW50MjU2IHJlc2VydmVCYWxhbmNlID0gZ2V0UmVzZXJ2ZUJhbGFuY2UoX3Jlc2VydmVUb2tlbik7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBleHRlbnNpb25zLmZvcm11bGEoKS5jYWxjdWxhdGVTYWxlUmV0dXJuKF90b3RhbFN1cHBseSwgcmVzZXJ2ZUJhbGFuY2UsIHJlc2VydmUucmF0aW8sIF9zZWxsQW1vdW50KTsKCiAgICAgICAgLy8gZGVkdWN0IHRoZSBmZWUgZnJvbSB0aGUgcmV0dXJuIGFtb3VudAogICAgICAgIHVpbnQyNTYgZmVlQW1vdW50ID0gZ2V0Q29udmVyc2lvbkZlZUFtb3VudChhbW91bnQpOwogICAgICAgIHJldHVybiBzYWZlU3ViKGFtb3VudCwgZmVlQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGZhbGxiYWNrLCBidXlzIHRoZSBzbWFydCB0b2tlbiB3aXRoIEVUSAogICAgICAgIG5vdGUgdGhhdCB0aGUgcHVyY2hhc2Ugd2lsbCB1c2UgdGhlIHByaWNlIGF0IHRoZSB0aW1lIG9mIHRoZSBwdXJjaGFzZQogICAgKi8KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgcXVpY2tDb252ZXJ0KHF1aWNrQnV5UGF0aCwgbXNnLnZhbHVlLCAxKTsKICAgIH0KfQ=='.
	

]
