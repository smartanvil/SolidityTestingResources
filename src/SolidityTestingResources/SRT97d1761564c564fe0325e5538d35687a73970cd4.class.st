Class {
	#name : #SRT97d1761564c564fe0325e5538d35687a73970cd4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT97d1761564c564fe0325e5538d35687a73970cd4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBFdGhlcm5hdXRzCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKCgoKCgoKLy8gRXh0ZW5kIHRoaXMgbGlicmFyeSBmb3IgY2hpbGQgY29udHJhY3RzCmxpYnJhcnkgU2FmZU1hdGggewoKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAgICovCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICAgKi8KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWF4KGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA+IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWluKGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA8IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKCn0KCi8vLyBAdGl0bGUgQXVjdGlvbiBDb3JlCi8vLyBAZGV2IENvbnRhaW5zIG1vZGVscywgdmFyaWFibGVzLCBhbmQgaW50ZXJuYWwgbWV0aG9kcyBmb3IgdGhlIGF1Y3Rpb24uCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8gUmVwcmVzZW50cyBhbiBhdWN0aW9uIG9uIGFuIE5GVAogICAgc3RydWN0IEF1Y3Rpb24gewogICAgICAgIC8vIEN1cnJlbnQgb3duZXIgb2YgTkZUCiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgZW5kIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IGVuZGluZ1ByaWNlOwogICAgICAgIC8vIER1cmF0aW9uIChpbiBzZWNvbmRzKSBvZiBhdWN0aW9uCiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIC8vIFRpbWUgd2hlbiBhdWN0aW9uIHN0YXJ0ZWQKICAgICAgICAvLyBOT1RFOiAwIGlmIHRoaXMgYXVjdGlvbiBoYXMgYmVlbiBjb25jbHVkZWQKICAgICAgICB1aW50NjQgc3RhcnRlZEF0OwogICAgfQoKICAgIC8vIFJlZmVyZW5jZSB0byBjb250cmFjdCB0cmFja2luZyBORlQgb3duZXJzaGlwCiAgICBFUkM3MjEgcHVibGljIG5vbkZ1bmdpYmxlQ29udHJhY3Q7CgogICAgLy8gQ3V0IG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MjU2IHB1YmxpYyBvd25lckN1dDsKCiAgICAvLyBNYXAgZnJvbSB0b2tlbiBJRCB0byB0aGVpciBjb3JyZXNwb25kaW5nIGF1Y3Rpb24uCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IEF1Y3Rpb24pIHRva2VuSWRUb0F1Y3Rpb247CgogICAgZXZlbnQgQXVjdGlvbkNyZWF0ZWQodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24pOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHRvdGFsUHJpY2UsIGFkZHJlc3Mgd2lubmVyKTsKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQodWludDI1NiB0b2tlbklkKTsKCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIGNsYWltYW50IG93bnMgdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgLSBBZGRyZXNzIGNsYWltaW5nIHRvIG93biB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2Ugb3duZXJzaGlwIHRvIHZlcmlmeS4KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKG5vbkZ1bmdpYmxlQ29udHJhY3Qub3duZXJPZihfdG9rZW5JZCkgPT0gX2NsYWltYW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYW4gTkZUIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgc3VjY2VlZHMuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlciAtIEFkZHJlc3MgdG8gdHJhbnNmZXIgTkZUIHRvLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAvLy8gIEF1Y3Rpb25DcmVhdGVkIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHB1dCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgIGludGVybmFsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgYXVjdGlvbiBzdHJ1Y3QKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwoKICAgICAgICAvLyBFeHBsaWNpdGx5IGNoZWNrIHRoYXQgdGhpcyBhdWN0aW9uIGlzIGN1cnJlbnRseSBsaXZlLgogICAgICAgIC8vIChCZWNhdXNlIG9mIGhvdyBFdGhlcmV1bSBtYXBwaW5ncyB3b3JrLCB3ZSBjYW4ndCBqdXN0IGNvdW50CiAgICAgICAgLy8gb24gdGhlIGxvb2t1cCBhYm92ZSBmYWlsaW5nLiBBbiBpbnZhbGlkIF90b2tlbklkIHdpbGwganVzdAogICAgICAgIC8vIHJldHVybiBhbiBhdWN0aW9uIG9iamVjdCB0aGF0IGlzIGFsbCB6ZXJvcy4pCiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBiaWQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBjdXJyZW50IHByaWNlCiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2VsbGVyIGJlZm9yZSB0aGUgYXVjdGlvbiBzdHJ1Y3QKICAgICAgICAvLyBnZXRzIGRlbGV0ZWQuCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKCiAgICAgICAgLy8gVGhlIGJpZCBpcyBnb29kISBSZW1vdmUgdGhlIGF1Y3Rpb24gYmVmb3JlIHNlbmRpbmcgdGhlIGZlZXMKICAgICAgICAvLyB0byB0aGUgc2VuZGVyIHNvIHdlIGNhbid0IGhhdmUgYSByZWVudHJhbmN5IGF0dGFjay4KICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHByb2NlZWRzIHRvIHNlbGxlciAoaWYgdGhlcmUgYXJlIGFueSEpCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGF1Y3Rpb25lZXIncyBjdXQuCiAgICAgICAgICAgIC8vIChOT1RFOiBfY29tcHV0ZUN1dCgpIGlzIGd1YXJhbnRlZWQgdG8gcmV0dXJuIGEKICAgICAgICAgICAgLy8gdmFsdWUgPD0gcHJpY2UsIHNvIHRoaXMgc3VidHJhY3Rpb24gY2FuJ3QgZ28gbmVnYXRpdmUuKQogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25lZXJDdXQgPSBfY29tcHV0ZUN1dChwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgc2VsbGVyUHJvY2VlZHMgPSBwcmljZSAtIGF1Y3Rpb25lZXJDdXQ7CgogICAgICAgICAgICAvLyBOT1RFOiBEb2luZyBhIHRyYW5zZmVyKCkgaW4gdGhlIG1pZGRsZSBvZiBhIGNvbXBsZXgKICAgICAgICAgICAgLy8gbWV0aG9kIGxpa2UgdGhpcyBpcyBnZW5lcmFsbHkgZGlzY291cmFnZWQgYmVjYXVzZSBvZgogICAgICAgICAgICAvLyByZWVudHJhbmN5IGF0dGFja3MgYW5kIERvUyBhdHRhY2tzIGlmIHRoZSBzZWxsZXIgaXMKICAgICAgICAgICAgLy8gYSBjb250cmFjdCB3aXRoIGFuIGludmFsaWQgZmFsbGJhY2sgZnVuY3Rpb24uIFdlIGV4cGxpY2l0bHkKICAgICAgICAgICAgLy8gZ3VhcmQgYWdhaW5zdCByZWVudHJhbmN5IGF0dGFja3MgYnkgcmVtb3ZpbmcgdGhlIGF1Y3Rpb24KICAgICAgICAgICAgLy8gYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIoKSwgYW5kIHRoZSBvbmx5IHRoaW5nIHRoZSBzZWxsZXIKICAgICAgICAgICAgLy8gY2FuIERvUyBpcyB0aGUgc2FsZSBvZiB0aGVpciBvd24gYXNzZXQhIChBbmQgaWYgaXQncyBhbgogICAgICAgICAgICAvLyBhY2NpZGVudCwgdGhleSBjYW4gY2FsbCBjYW5jZWxBdWN0aW9uKCkuICkKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfdG9rZW5JZCwgcHJpY2UsIG1zZy5zZW5kZXIpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhbiBhdWN0aW9uIGZyb20gdGhlIGxpc3Qgb2Ygb3BlbiBhdWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICBkZWxldGUgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBORlQgaXMgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gLSBBdWN0aW9uIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gX2lzT25BdWN0aW9uKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChfYXVjdGlvbi5zdGFydGVkQXQgPiAwKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGN1cnJlbnQgcHJpY2Ugb2YgYW4gTkZUIG9uIGF1Y3Rpb24uIEJyb2tlbiBpbnRvIHR3bwogICAgLy8vICBmdW5jdGlvbnMgKHRoaXMgb25lLCB0aGF0IGNvbXB1dGVzIHRoZSBkdXJhdGlvbiBmcm9tIHRoZSBhdWN0aW9uCiAgICAvLy8gIHN0cnVjdHVyZSwgYW5kIHRoZSBvdGhlciB0aGF0IGRvZXMgdGhlIHByaWNlIGNvbXB1dGF0aW9uKSBzbyB3ZQogICAgLy8vICBjYW4gZWFzaWx5IHRlc3QgdGhhdCB0aGUgcHJpY2UgY29tcHV0YXRpb24gd29ya3MgY29ycmVjdGx5LgogICAgZnVuY3Rpb24gX2N1cnJlbnRQcmljZShBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pCiAgICBpbnRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IHNlY29uZHNQYXNzZWQgPSAwOwoKICAgICAgICAvLyBBIGJpdCBvZiBpbnN1cmFuY2UgYWdhaW5zdCBuZWdhdGl2ZSB2YWx1ZXMgKG9yIHdyYXBhcm91bmQpLgogICAgICAgIC8vIFByb2JhYmx5IG5vdCBuZWNlc3NhcnkgKHNpbmNlIEV0aGVyZXVtIGd1YXJuYXRlZXMgdGhhdCB0aGUKICAgICAgICAvLyBub3cgdmFyaWFibGUgZG9lc24ndCBldmVyIGdvIGJhY2t3YXJkcykuCiAgICAgICAgaWYgKG5vdyA+IF9hdWN0aW9uLnN0YXJ0ZWRBdCkgewogICAgICAgICAgICBzZWNvbmRzUGFzc2VkID0gbm93IC0gX2F1Y3Rpb24uc3RhcnRlZEF0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgICAgICBfYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIGF1Y3Rpb24uIEZhY3RvcmVkIG91dAogICAgLy8vICBmcm9tIF9jdXJyZW50UHJpY2Ugc28gd2UgY2FuIHJ1biBleHRlbnNpdmUgdW5pdCB0ZXN0cy4KICAgIC8vLyAgV2hlbiB0ZXN0aW5nLCBtYWtlIHRoaXMgZnVuY3Rpb24gcHVibGljIGFuZCB0dXJuIG9uCiAgICAvLy8gIGBDdXJyZW50IHByaWNlIGNvbXB1dGF0aW9uYCB0ZXN0IHN1aXRlLgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9zZWNvbmRzUGFzc2VkCiAgICApCiAgICBpbnRlcm5hbAogICAgcHVyZQogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIHB1YmxpYyBmdW5jdGlvbnMgY2FyZWZ1bGx5IGNhcCB0aGUgbWF4aW11bSB2YWx1ZXMgZm9yCiAgICAgICAgLy8gIHRpbWUgKGF0IDY0LWJpdHMpIGFuZCBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLiBfZHVyYXRpb24gaXMKICAgICAgICAvLyAgYWxzbyBrbm93biB0byBiZSBub24temVybyAoc2VlIHRoZSByZXF1aXJlKCkgc3RhdGVtZW50IGluCiAgICAgICAgLy8gIF9hZGRBdWN0aW9uKCkpCiAgICAgICAgaWYgKF9zZWNvbmRzUGFzc2VkID49IF9kdXJhdGlvbikgewogICAgICAgICAgICAvLyBXZSd2ZSByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIGR5bmFtaWMgcHJpY2luZyBwb3J0aW9uCiAgICAgICAgICAgIC8vIG9mIHRoZSBhdWN0aW9uLCBqdXN0IHJldHVybiB0aGUgZW5kIHByaWNlLgogICAgICAgICAgICByZXR1cm4gX2VuZGluZ1ByaWNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0aW5nIHByaWNlIGNhbiBiZSBoaWdoZXIgdGhhbiBlbmRpbmcgcHJpY2UgKGFuZCBvZnRlbiBpcyEpLCBzbwogICAgICAgICAgICAvLyB0aGlzIGRlbHRhIGNhbiBiZSBuZWdhdGl2ZS4KICAgICAgICAgICAgaW50MjU2IHRvdGFsUHJpY2VDaGFuZ2UgPSBpbnQyNTYoX2VuZGluZ1ByaWNlKSAtIGludDI1Nihfc3RhcnRpbmdQcmljZSk7CgogICAgICAgICAgICAvLyBUaGlzIG11bHRpcGxpY2F0aW9uIGNhbid0IG92ZXJmbG93LCBfc2Vjb25kc1Bhc3NlZCB3aWxsIGVhc2lseSBmaXQgd2l0aGluCiAgICAgICAgICAgIC8vIDY0LWJpdHMsIGFuZCB0b3RhbFByaWNlQ2hhbmdlIHdpbGwgZWFzaWx5IGZpdCB3aXRoaW4gMTI4LWJpdHMsIHRoZWlyIHByb2R1Y3QKICAgICAgICAgICAgLy8gd2lsbCBhbHdheXMgZml0IHdpdGhpbiAyNTYtYml0cy4KICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZUNoYW5nZSA9IHRvdGFsUHJpY2VDaGFuZ2UgKiBpbnQyNTYoX3NlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9kdXJhdGlvbik7CgogICAgICAgICAgICAvLyBjdXJyZW50UHJpY2VDaGFuZ2UgY2FuIGJlIG5lZ2F0aXZlLCBidXQgaWYgc28sIHdpbGwgaGF2ZSBhIG1hZ25pdHVkZQogICAgICAgICAgICAvLyBsZXNzIHRoYXQgX3N0YXJ0aW5nUHJpY2UuIFRodXMsIHRoaXMgcmVzdWx0IHdpbGwgYWx3YXlzIGVuZCB1cCBwb3NpdGl2ZS4KICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZSA9IGludDI1Nihfc3RhcnRpbmdQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CgogICAgICAgICAgICByZXR1cm4gdWludDI1NihjdXJyZW50UHJpY2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyBvd25lcidzIGN1dCBvZiBhIHNhbGUuCiAgICAvLy8gQHBhcmFtIF9wcmljZSAtIFNhbGUgcHJpY2Ugb2YgTkZULgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXQodWludDI1NiBfcHJpY2UpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgZW50cnkgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLCBhbmQgb3duZXJDdXQgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gIHN0YXRlbWVudCBpbiB0aGUgRWh0ZXJuYXV0c01hcmtldCBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoX3ByaWNlLCBvd25lckN1dCksIDEwMDAwKTsKICAgIH0KCn0KCgoKCi8vLyBAZGV2IEJhc2UgY29udHJhY3QgZm9yIGFsbCBFdGhlcm5hdXRzIGNvbnRyYWN0cyBob2xkaW5nIGdsb2JhbCBjb25zdGFudHMgYW5kIGZ1bmN0aW9ucy4KY29udHJhY3QgRXRoZXJuYXV0c0Jhc2UgewoKICAgIC8qKiogQ09OU1RBTlRTIFVTRUQgQUNST1NTIENPTlRSQUNUUyAqKiovCgogICAgLy8vIEBkZXYgVXNlZCBieSBhbGwgY29udHJhY3RzIHRoYXQgaW50ZXJmYWNlcyB3aXRoIEV0aGVybmF1dHMKICAgIC8vLyAgICAgIFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NQogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAgIC8vLyBAZGV2IGR1ZSBzb2xpZGl0eSBsaW1pdGF0aW9uIHdlIGNhbm5vdCByZXR1cm4gZHluYW1pYyBhcnJheSBmcm9tIG1ldGhvZHMKICAgIC8vLyBzbyBpdCBjcmVhdGVzIGluY29tcGFiaWxpdHkgYmV0d2VlbiBmdW5jdGlvbnMgYWNyb3NzIGRpZmZlcmVudCBjb250cmFjdHMKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBTVEFUU19TSVpFID0gMTA7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgU0hJUF9TTE9UUyA9IDU7CgogICAgLy8gUG9zc2libGUgc3RhdGUgb2YgYW55IGFzc2V0CiAgICBlbnVtIEFzc2V0U3RhdGUgeyBBdmFpbGFibGUsIFVwRm9yTGVhc2UsIFVzZWQgfQoKICAgIC8vIFBvc3NpYmxlIHN0YXRlIG9mIGFueSBhc3NldAogICAgLy8gTm90VmFsaWQgaXMgdG8gYXZvaWQgMCBpbiBwbGFjZXMgd2hlcmUgY2F0ZWdvcnkgbXVzdCBiZSBiaWdnZXIgdGhhbiB6ZXJvCiAgICBlbnVtIEFzc2V0Q2F0ZWdvcnkgeyBOb3RWYWxpZCwgU2VjdG9yLCBNYW51ZmFjdHVyZXIsIFNoaXAsIE9iamVjdCwgRmFjdG9yeSwgQ3Jld01lbWJlciB9CgogICAgLy8vIEBkZXYgU2VjdG9yIHN0YXRzCiAgICBlbnVtIFNoaXBTdGF0cyB7TGV2ZWwsIEF0dGFjaywgRGVmZW5zZSwgU3BlZWQsIFJhbmdlLCBMdWNrfQogICAgLy8vIEBub3RpY2UgUG9zc2libGUgYXR0cmlidXRlcyBmb3IgZWFjaCBhc3NldAogICAgLy8vIDAwMDAwMDAxIC0gU2VlZGVkIC0gT2ZmZXJlZCB0byB0aGUgZWNvbm9teSBieSB1cywgdGhlIGRldmVsb3BlcnMuIFBvdGVudGlhbGx5IGF0IHJlZ3VsYXIgaW50ZXJ2YWxzLgogICAgLy8vIDAwMDAwMDEwIC0gUHJvZHVjaWJsZSAtIFByb2R1Y3Qgb2YgYSBmYWN0b3J5IGFuZC9vciBmYWN0b3J5IGNvbnRyYWN0LgogICAgLy8vIDAwMDAwMTAwIC0gRXhwbG9yYWJsZS0gUHJvZHVjdCBvZiBleHBsb3JhdGlvbi4KICAgIC8vLyAwMDAwMTAwMCAtIExlYXNhYmxlIC0gQ2FuIGJlIHJlbnRlZCB0byBvdGhlciB1c2VycyBhbmQgd2lsbCByZXR1cm4gdG8gdGhlIG9yaWdpbmFsIG93bmVyIG9uY2UgdGhlIGFjdGlvbiBpcyBjb21wbGV0ZS4KICAgIC8vLyAwMDAxMDAwMCAtIFBlcm1hbmVudCAtIENhbm5vdCBiZSByZW1vdmVkLCBhbHdheXMgb3duZWQgYnkgYSB1c2VyLgogICAgLy8vIDAwMTAwMDAwIC0gQ29uc3VtYWJsZSAtIERlc3Ryb3llZCBhZnRlciBOIGV4cGxvcmF0aW9uIGV4cGVkaXRpb25zLgogICAgLy8vIDAxMDAwMDAwIC0gVHJhZGFibGUgLSBCdXlhYmxlIGFuZCBzZWxsYWJsZSBvbiB0aGUgbWFya2V0LgogICAgLy8vIDEwMDAwMDAwIC0gSG90IFBvdGF0byAtIEF1dG9tYXRpY2FsbHkgZ2V0cyBwdXQgdXAgZm9yIHNhbGUgYWZ0ZXIgYWNxdWlyaW5nLgogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX1NFRURFRCAgICAgPSBieXRlczIoMioqMCk7CiAgICBieXRlczIgcHVibGljIEFUVFJfUFJPRFVDSUJMRSA9IGJ5dGVzMigyKioxKTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9FWFBMT1JBQkxFID0gYnl0ZXMyKDIqKjIpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX0xFQVNBQkxFICAgPSBieXRlczIoMioqMyk7CiAgICBieXRlczIgcHVibGljIEFUVFJfUEVSTUFORU5UICA9IGJ5dGVzMigyKio0KTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9DT05TVU1BQkxFID0gYnl0ZXMyKDIqKjUpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX1RSQURBQkxFICAgPSBieXRlczIoMioqNik7CiAgICBieXRlczIgcHVibGljIEFUVFJfR09MREVOR09PU0UgPSBieXRlczIoMioqNyk7Cn0KCi8vLyBAbm90aWNlIFRoaXMgY29udHJhY3QgbWFuYWdlcyB0aGUgdmFyaW91cyBhZGRyZXNzZXMgYW5kIGNvbnN0cmFpbnRzIGZvciBvcGVyYXRpb25zCi8vICAgICAgICAgIHRoYXQgY2FuIGJlIGV4ZWN1dGVkIG9ubHkgYnkgc3BlY2lmaWMgcm9sZXMuIE5hbWVseSBDRU8gYW5kIENUTy4gaXQgYWxzbyBpbmNsdWRlcyBwYXVzYWJsZSBwYXR0ZXJuLgpjb250cmFjdCBFdGhlcm5hdXRzQWNjZXNzQ29udHJvbCBpcyBFdGhlcm5hdXRzQmFzZSB7CgogICAgLy8gVGhpcyBmYWNldCBjb250cm9scyBhY2Nlc3MgY29udHJvbCBmb3IgRXRoZXJuYXV0cy4KICAgIC8vIEFsbCByb2xlcyBoYXZlIHNhbWUgcmVzcG9uc2liaWxpdGllcyBhbmQgcmlnaHRzLCBidXQgdGhlcmUgaXMgc2xpZ2h0IGRpZmZlcmVuY2VzIGJldHdlZW4gdGhlbToKICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcyBhbmQgb25seSByb2xlIHRoYXQgY2FuIHVucGF1c2UgdGhlIHNtYXJ0IGNvbnRyYWN0LgogICAgLy8gICAgICAgSXQgaXMgaW5pdGlhbGx5IHNldCB0byB0aGUgYWRkcmVzcyB0aGF0IGNyZWF0ZWQgdGhlIHNtYXJ0IGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDVE86IFRoZSBDVE8gY2FuIGNoYW5nZSBjb250cmFjdCBhZGRyZXNzLCBvcmFjbGUgYWRkcmVzcyBhbmQgcGxhbiBmb3IgdXBncmFkZXMuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENPTzogVGhlIENPTyBjYW4gY2hhbmdlIGNvbnRyYWN0IGFkZHJlc3MgYW5kIGFkZCBjcmVhdGUgYXNzZXRzLgogICAgLy8KICAgIC8vLyBAZGV2IEVtaXRlZCB3aGVuIGNvbnRyYWN0IGlzIHVwZ3JhZGVkIC0gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgLy8vIEBwYXJhbSBuZXdDb250cmFjdCBhZGRyZXNzIHBvaW50aW5nIHRvIG5ldyBjb250cmFjdAogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICAgIC8vIFRoZSBhZGRyZXNzZXMgb2YgdGhlIGFjY291bnRzIChvciBjb250cmFjdHMpIHRoYXQgY2FuIGV4ZWN1dGUgYWN0aW9ucyB3aXRoaW4gZWFjaCByb2xlcy4KICAgIGFkZHJlc3MgcHVibGljIGNlb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjdG9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY29vQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIG9yYWNsZUFkZHJlc3M7CgogICAgLy8gQGRldiBLZWVwcyB0cmFjayB3aGV0aGVyIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0VPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENUTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDVE8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGN0b0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDVE8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5T3JhY2xlKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGVBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY3RvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MKICAgICAgICApOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0VPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ1RPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDVE8gb3IgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q1RPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ1RPCiAgICBmdW5jdGlvbiBzZXRDVE8oYWRkcmVzcyBfbmV3Q1RPKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY3RvQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgcmVxdWlyZShfbmV3Q1RPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjdG9BZGRyZXNzID0gX25ld0NUTzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDT08uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENPTyBvciBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDT08gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjb29BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNvb0FkZHJlc3MgPSBfbmV3Q09POwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgb3JhY2xlLgogICAgLy8vIEBwYXJhbSBfbmV3T3JhY2xlIFRoZSBhZGRyZXNzIG9mIG9yYWNsZQogICAgZnVuY3Rpb24gc2V0T3JhY2xlKGFkZHJlc3MgX25ld09yYWNsZSkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjdG9BZGRyZXNzKTsKICAgICAgICByZXF1aXJlKF9uZXdPcmFjbGUgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIG9yYWNsZUFkZHJlc3MgPSBfbmV3T3JhY2xlOwogICAgfQoKICAgIC8qKiogUGF1c2FibGUgZnVuY3Rpb25hbGl0eSBhZGFwdGVkIGZyb20gT3BlblplcHBlbGluICoqKi8KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSAiQy1sZXZlbCIgcm9sZSB0byBwYXVzZSB0aGUgY29udHJhY3QuIFVzZWQgb25seSB3aGVuCiAgICAvLy8gIGEgYnVnIG9yIGV4cGxvaXQgaXMgZGV0ZWN0ZWQgYW5kIHdlIG5lZWQgdG8gbGltaXQgZGFtYWdlLgogICAgZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTywgc2luY2UKICAgIC8vLyAgb25lIHJlYXNvbiB3ZSBtYXkgcGF1c2UgdGhlIGNvbnRyYWN0IGlzIHdoZW4gQ1RPIGFjY291bnQgaXMgY29tcHJvbWlzZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5CiAgICAvLy8gIGRlcml2ZWQgY29udHJhY3RzLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIGNhbid0IHVucGF1c2UgaWYgY29udHJhY3Qgd2FzIHVwZ3JhZGVkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cgp9CgoKCgoKCgoKCi8vLyBAdGl0bGUgU3RvcmFnZSBjb250cmFjdCBmb3IgRXRoZXJuYXV0cyBEYXRhLiBDb21tb24gc3RydWN0cyBhbmQgY29uc3RhbnRzLgovLy8gQG5vdGljZSBUaGlzIGlzIG91ciBtYWluIGRhdGEgc3RvcmFnZSwgY29uc3RhbnRzIGFuZCBkYXRhIHR5cGVzLCBwbHVzCi8vICAgICAgICAgIGludGVybmFsIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgdGhlIGFzc2V0cy4gSXQgaXMgaXNvbGF0ZWQgYW5kIG9ubHkgaW50ZXJmYWNlIHdpdGgKLy8gICAgICAgICAgYSBsaXN0IG9mIGdyYW50ZWQgY29udHJhY3RzIGRlZmluZWQgYnkgQ1RPCi8vLyBAYXV0aG9yIEV0aGVybmF1dHMgLSBGZXJuYW5kbyBQYXVlcgpjb250cmFjdCBFdGhlcm5hdXRzU3RvcmFnZSBpcyBFdGhlcm5hdXRzQWNjZXNzQ29udHJvbCB7CgogICAgZnVuY3Rpb24gRXRoZXJuYXV0c1N0b3JhZ2UoKSBwdWJsaWMgewogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRU8KICAgICAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENUTyBhcyB3ZWxsCiAgICAgICAgY3RvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDVE8gYXMgd2VsbAogICAgICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgT3JhY2xlIGFzIHdlbGwKICAgICAgICBvcmFjbGVBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBObyB0aXBwaW5nIQogICAgLy8vIEBkZXYgUmVqZWN0IGFsbCBFdGhlciBmcm9tIGJlaW5nIHNlbnQgaGVyZS4gSG9wZWZ1bGx5LCB3ZSBjYW4gcHJldmVudCB1c2VyIGFjY2lkZW50cy4KICAgIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpOwogICAgfQoKICAgIC8qKiogTWFwcGluZyBmb3IgQ29udHJhY3RzIHdpdGggZ3JhbnRlZCBwZXJtaXNzaW9uICoqKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGNvbnRyYWN0c0dyYW50ZWRBY2Nlc3M7CgogICAgLy8vIEBkZXYgZ3JhbnQgYWNjZXNzIGZvciBhIGNvbnRyYWN0IHRvIGludGVyYWN0IHdpdGggdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3YyQWRkcmVzcyBUaGUgY29udHJhY3QgYWRkcmVzcyB0byBncmFudCBhY2Nlc3MKICAgIGZ1bmN0aW9uIGdyYW50QWNjZXNzKGFkZHJlc3MgX3YyQWRkcmVzcykgcHVibGljIG9ubHlDVE8gewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBjb250cmFjdHNHcmFudGVkQWNjZXNzW192MkFkZHJlc3NdID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiByZW1vdmUgYWNjZXNzIGZyb20gYSBjb250cmFjdCB0byBpbnRlcmFjdCB3aXRoIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgVGhlIGNvbnRyYWN0IGFkZHJlc3MgdG8gYmUgcmVtb3ZlZAogICAgZnVuY3Rpb24gcmVtb3ZlQWNjZXNzKGFkZHJlc3MgX3YyQWRkcmVzcykgcHVibGljIG9ubHlDVE8gewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBkZWxldGUgY29udHJhY3RzR3JhbnRlZEFjY2Vzc1tfdjJBZGRyZXNzXTsKICAgIH0KCiAgICAvLy8gQGRldiBPbmx5IGFsbG93IHBlcm1pdHRlZCBjb250cmFjdHMgdG8gaW50ZXJhY3Qgd2l0aCB0aGlzIGNvbnRyYWN0CiAgICBtb2RpZmllciBvbmx5R3JhbnRlZENvbnRyYWN0cygpIHsKICAgICAgICByZXF1aXJlKGNvbnRyYWN0c0dyYW50ZWRBY2Nlc3NbbXNnLnNlbmRlcl0gPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZEFzc2V0KHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICByZXF1aXJlKGFzc2V0c1tfdG9rZW5JZF0uSUQgPiAwKTsKICAgICAgICBfOwogICAgfQogICAgLyoqKiBEQVRBIFRZUEVTICoqKi8KCiAgICAvLy8gQGRldiBUaGUgbWFpbiBFdGhlcm5hdXRzIGFzc2V0IHN0cnVjdC4gRXZlcnkgYXNzZXQgaW4gRXRoZXJuYXV0cyBpcyByZXByZXNlbnRlZCBieSBhIGNvcHkKICAgIC8vLyAgb2YgdGhpcyBzdHJ1Y3R1cmUuIE5vdGUgdGhhdCB0aGUgb3JkZXIgb2YgdGhlIG1lbWJlcnMgaW4gdGhpcyBzdHJ1Y3R1cmUKICAgIC8vLyAgaXMgaW1wb3J0YW50IGJlY2F1c2Ugb2YgdGhlIGJ5dGUtcGFja2luZyBydWxlcyB1c2VkIGJ5IEV0aGVyZXVtLgogICAgLy8vICBSZWY6IGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9kZXZlbG9wL21pc2NlbGxhbmVvdXMuaHRtbAogICAgc3RydWN0IEFzc2V0IHsKCiAgICAgICAgLy8gQXNzZXQgSUQgaXMgYSBpZGVudGlmaWVyIGZvciBsb29rIGFuZCBmZWVsIGluIGZyb250ZW5kCiAgICAgICAgdWludDE2IElEOwoKICAgICAgICAvLyBDYXRlZ29yeSA9IFNlY3RvcnMsIE1hbnVmYWN0dXJlcnMsIFNoaXBzLCBPYmplY3RzIChVcGdyYWRlcy9NaXNjKSwgRmFjdG9yaWVzIGFuZCBDcmV3TWVtYmVycwogICAgICAgIHVpbnQ4IGNhdGVnb3J5OwoKICAgICAgICAvLyBUaGUgU3RhdGUgb2YgYW4gYXNzZXQ6IEF2YWlsYWJsZSwgT24gc2FsZSwgVXAgZm9yIGxlYXNlLCBDb29sZG93biwgRXhwbG9yaW5nCiAgICAgICAgdWludDggc3RhdGU7CgogICAgICAgIC8vIEF0dHJpYnV0ZXMKICAgICAgICAvLyBieXRlIHBvcyAtIERlZmluaXRpb24KICAgICAgICAvLyAwMDAwMDAwMSAtIFNlZWRlZCAtIE9mZmVyZWQgdG8gdGhlIGVjb25vbXkgYnkgdXMsIHRoZSBkZXZlbG9wZXJzLiBQb3RlbnRpYWxseSBhdCByZWd1bGFyIGludGVydmFscy4KICAgICAgICAvLyAwMDAwMDAxMCAtIFByb2R1Y2libGUgLSBQcm9kdWN0IG9mIGEgZmFjdG9yeSBhbmQvb3IgZmFjdG9yeSBjb250cmFjdC4KICAgICAgICAvLyAwMDAwMDEwMCAtIEV4cGxvcmFibGUtIFByb2R1Y3Qgb2YgZXhwbG9yYXRpb24uCiAgICAgICAgLy8gMDAwMDEwMDAgLSBMZWFzYWJsZSAtIENhbiBiZSByZW50ZWQgdG8gb3RoZXIgdXNlcnMgYW5kIHdpbGwgcmV0dXJuIHRvIHRoZSBvcmlnaW5hbCBvd25lciBvbmNlIHRoZSBhY3Rpb24gaXMgY29tcGxldGUuCiAgICAgICAgLy8gMDAwMTAwMDAgLSBQZXJtYW5lbnQgLSBDYW5ub3QgYmUgcmVtb3ZlZCwgYWx3YXlzIG93bmVkIGJ5IGEgdXNlci4KICAgICAgICAvLyAwMDEwMDAwMCAtIENvbnN1bWFibGUgLSBEZXN0cm95ZWQgYWZ0ZXIgTiBleHBsb3JhdGlvbiBleHBlZGl0aW9ucy4KICAgICAgICAvLyAwMTAwMDAwMCAtIFRyYWRhYmxlIC0gQnV5YWJsZSBhbmQgc2VsbGFibGUgb24gdGhlIG1hcmtldC4KICAgICAgICAvLyAxMDAwMDAwMCAtIEhvdCBQb3RhdG8gLSBBdXRvbWF0aWNhbGx5IGdldHMgcHV0IHVwIGZvciBzYWxlIGFmdGVyIGFjcXVpcmluZy4KICAgICAgICBieXRlczIgYXR0cmlidXRlczsKCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBmcm9tIHRoZSBibG9jayB3aGVuIHRoaXMgYXNzZXQgd2FzIGNyZWF0ZWQuCiAgICAgICAgdWludDY0IGNyZWF0ZWRBdDsKCiAgICAgICAgLy8gVGhlIG1pbmltdW0gdGltZXN0YW1wIGFmdGVyIHdoaWNoIHRoaXMgYXNzZXQgY2FuIGVuZ2FnZSBpbiBleHBsb3JpbmcgYWN0aXZpdGllcyBhZ2Fpbi4KICAgICAgICB1aW50NjQgY29vbGRvd25FbmRCbG9jazsKCiAgICAgICAgLy8gVGhlIEFzc2V0J3Mgc3RhdHMgY2FuIGJlIHVwZ3JhZGVkIG9yIGNoYW5nZWQgYmFzZWQgb24gZXhwbG9yYXRpb24gY29uZGl0aW9ucy4KICAgICAgICAvLyBJdCB3aWxsIGJlIGRlZmluZWQgcGVyIGNoaWxkIGNvbnRyYWN0LCBidXQgYWxsIHN0YXRzIGhhdmUgYSByYW5nZSBmcm9tIDAgdG8gMjU1CiAgICAgICAgLy8gRXhhbXBsZXMKICAgICAgICAvLyAwID0gU2hpcCBMZXZlbAogICAgICAgIC8vIDEgPSBTaGlwIEF0dGFjawogICAgICAgIHVpbnQ4W1NUQVRTX1NJWkVdIHN0YXRzOwoKICAgICAgICAvLyBTZXQgdG8gdGhlIGNvb2xkb3duIHRpbWUgdGhhdCByZXByZXNlbnRzIGV4cGxvcmF0aW9uIGR1cmF0aW9uIGZvciB0aGlzIGFzc2V0LgogICAgICAgIC8vIERlZmluZWQgYnkgYSBzdWNjZXNzZnVsIGV4cGxvcmF0aW9uIGFjdGlvbiwgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIHRoaXMgYXNzZXQgaXMgYWN0aW5nIGFzIHNoaXAgb3IgYSBwYXJ0LgogICAgICAgIHVpbnQyNTYgY29vbGRvd247CgogICAgICAgIC8vIGEgcmVmZXJlbmNlIHRvIGEgc3VwZXIgYXNzZXQgdGhhdCBtYW51ZmFjdHVyZWQgdGhlIGFzc2V0CiAgICAgICAgdWludDI1NiBidWlsdEJ5OwogICAgfQoKICAgIC8qKiogQ09OU1RBTlRTICoqKi8KCiAgICAvLyBAZGV2IFNhbml0eSBjaGVjayB0aGF0IGFsbG93cyB1cyB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgcG9pbnRpbmcgdG8gdGhlCiAgICAvLyAgcmlnaHQgc3RvcmFnZSBjb250cmFjdCBpbiBvdXIgRXRoZXJuYXV0c0xvZ2ljKGFkZHJlc3MgX0NTdG9yYWdlQWRkcmVzcykgY2FsbC4KICAgIGJvb2wgcHVibGljIGlzRXRoZXJuYXV0c1N0b3JhZ2UgPSB0cnVlOwoKICAgIC8qKiogU1RPUkFHRSAqKiovCgogICAgLy8vIEBkZXYgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgQXNzZXQgc3RydWN0IGZvciBhbGwgYXNzZXRzIGluIGV4aXN0ZW5jZS4gVGhlIEFzc2V0IFVuaXF1ZUlkCiAgICAvLy8gIG9mIGVhY2ggYXNzZXQgaXMgYWN0dWFsbHkgYW4gaW5kZXggaW50byB0aGlzIGFycmF5LgogICAgQXNzZXRbXSBwdWJsaWMgYXNzZXRzOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIEFzc2V0IFVuaXF1ZUlEcyB0byB0aGUgcHJpY2Ugb2YgdGhlIHRva2VuLgogICAgLy8vIHN0b3JlZCBvdXRzaWRlIEFzc2V0IFN0cnVjdCB0byBzYXZlIGdhcywgYmVjYXVzZSBwcmljZSBjYW4gY2hhbmdlIGZyZXF1ZW50bHkKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgaW50ZXJuYWwgYXNzZXRJbmRleFRvUHJpY2U7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gYXNzZXQgVW5pcXVlSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLiBBbGwgYXNzZXRzIGhhdmUgc29tZSB2YWxpZCBvd25lciBhZGRyZXNzLgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBpbnRlcm5hbCBhc3NldEluZGV4VG9Pd25lcjsKCiAgICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG93bmVyIGFkZHJlc3MgdG8gY291bnQgb2YgdG9rZW5zIHRoYXQgYWRkcmVzcyBvd25zLgogICAgLy8gIFVzZWQgaW50ZXJuYWxseSBpbnNpZGUgYmFsYW5jZU9mKCkgdG8gcmVzb2x2ZSBvd25lcnNoaXAgY291bnQuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGludGVybmFsIG93bmVyc2hpcFRva2VuQ291bnQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gQXNzZXRVbmlxdWVJRHMgdG8gYW4gYWRkcmVzcyB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIHRvIGNhbGwKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIEVhY2ggQXNzZXQgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdHJhbnNmZXIKICAgIC8vLyAgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaW50ZXJuYWwgYXNzZXRJbmRleFRvQXBwcm92ZWQ7CgoKICAgIC8qKiogU0VUVEVSUyAqKiovCgogICAgLy8vIEBkZXYgc2V0IG5ldyBhc3NldCBwcmljZQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX3ByaWNlICAgIGFzc2V0IHByaWNlCiAgICBmdW5jdGlvbiBzZXRQcmljZSh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF9wcmljZSkgcHVibGljIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF0gPSBfcHJpY2U7CiAgICB9CgogICAgLy8vIEBkZXYgTWFyayB0cmFuc2ZlciBhcyBhcHByb3ZlZAogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX2FwcHJvdmVkIGFkZHJlc3MgYXBwcm92ZWQKICAgIGZ1bmN0aW9uIGFwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIHB1YmxpYyBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID0gX2FwcHJvdmVkOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgQXNzZXQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gICAgY3VycmVudCBvd25lciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF90byAgICAgIG5ldyBvd25lciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICAvLyBTaW5jZSB0aGUgbnVtYmVyIG9mIGFzc2V0cyBpcyBjYXBwZWQgdG8gMl4zMiB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAgICAgLy8gdHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgYXNzZXRJbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IGFzc2V0cyBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwogICAgICAgICAgICAvLyBjbGVhciBhbnkgcHJldmlvdXNseSBhcHByb3ZlZCBvd25lcnNoaXAgZXhjaGFuZ2UKICAgICAgICAgICAgZGVsZXRlIGFzc2V0SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQSBwdWJsaWMgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIG5ldyBhc3NldCBhbmQgc3RvcmVzIGl0LiBUaGlzCiAgICAvLy8gIG1ldGhvZCBkb2VzIGJhc2ljIGNoZWNraW5nIGFuZCBzaG91bGQgb25seSBiZSBjYWxsZWQgZnJvbSBvdGhlciBjb250cmFjdCB3aGVuIHRoZQogICAgLy8vICBpbnB1dCBkYXRhIGlzIGtub3duIHRvIGJlIHZhbGlkLiBXaWxsIE5PVCBnZW5lcmF0ZSBhbnkgZXZlbnQgaXQgaXMgZGVsZWdhdGUgdG8gYnVzaW5lc3MgbG9naWMgY29udHJhY3RzLgogICAgLy8vIEBwYXJhbSBfY3JlYXRvclRva2VuSUQgVGhlIGFzc2V0IHdobyBpcyBmYXRoZXIgb2YgdGhpcyBhc3NldAogICAgLy8vIEBwYXJhbSBfb3duZXIgRmlyc3Qgb3duZXIgb2YgdGhpcyBhc3NldAogICAgLy8vIEBwYXJhbSBfcHJpY2UgYXNzZXQgcHJpY2UKICAgIC8vLyBAcGFyYW0gX0lEIGFzc2V0IElECiAgICAvLy8gQHBhcmFtIF9jYXRlZ29yeSBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0ZSBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9hdHRyaWJ1dGVzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX3N0YXRzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIGNyZWF0ZUFzc2V0KAogICAgICAgIHVpbnQyNTYgX2NyZWF0b3JUb2tlbklELAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX3ByaWNlLAogICAgICAgIHVpbnQxNiBfSUQsCiAgICAgICAgdWludDggX2NhdGVnb3J5LAogICAgICAgIHVpbnQ4IF9zdGF0ZSwKICAgICAgICB1aW50OCBfYXR0cmlidXRlcywKICAgICAgICB1aW50OFtTVEFUU19TSVpFXSBfc3RhdHMsCiAgICAgICAgdWludDI1NiBfY29vbGRvd24sCiAgICAgICAgdWludDY0IF9jb29sZG93bkVuZEJsb2NrCiAgICApCiAgICBwdWJsaWMgb25seUdyYW50ZWRDb250cmFjdHMKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gRW5zdXJlIG91ciBkYXRhIHN0cnVjdHVyZXMgYXJlIGFsd2F5cyB2YWxpZC4KICAgICAgICByZXF1aXJlKF9JRCA+IDApOwogICAgICAgIHJlcXVpcmUoX2NhdGVnb3J5ID4gMCk7CiAgICAgICAgcmVxdWlyZShfYXR0cmlidXRlcyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3N0YXRzLmxlbmd0aCA+IDApOwoKICAgICAgICBBc3NldCBtZW1vcnkgYXNzZXQgPSBBc3NldCh7CiAgICAgICAgICAgIElEOiBfSUQsCiAgICAgICAgICAgIGNhdGVnb3J5OiBfY2F0ZWdvcnksCiAgICAgICAgICAgIGJ1aWx0Qnk6IF9jcmVhdG9yVG9rZW5JRCwKICAgICAgICAgICAgYXR0cmlidXRlczogYnl0ZXMyKF9hdHRyaWJ1dGVzKSwKICAgICAgICAgICAgc3RhdHM6IF9zdGF0cywKICAgICAgICAgICAgc3RhdGU6IF9zdGF0ZSwKICAgICAgICAgICAgY3JlYXRlZEF0OiB1aW50NjQobm93KSwKICAgICAgICAgICAgY29vbGRvd25FbmRCbG9jazogX2Nvb2xkb3duRW5kQmxvY2ssCiAgICAgICAgICAgIGNvb2xkb3duOiBfY29vbGRvd24KICAgICAgICAgICAgfSk7CgogICAgICAgIHVpbnQyNTYgbmV3QXNzZXRVbmlxdWVJZCA9IGFzc2V0cy5wdXNoKGFzc2V0KSAtIDE7CgogICAgICAgIC8vIENoZWNrIGl0IHJlYWNoZWQgNCBiaWxsaW9uIGFzc2V0cyBidXQgbGV0J3MganVzdCBiZSAxMDAlIHN1cmUuCiAgICAgICAgcmVxdWlyZShuZXdBc3NldFVuaXF1ZUlkID09IHVpbnQyNTYodWludDMyKG5ld0Fzc2V0VW5pcXVlSWQpKSk7CgogICAgICAgIC8vIHN0b3JlIHByaWNlCiAgICAgICAgYXNzZXRJbmRleFRvUHJpY2VbbmV3QXNzZXRVbmlxdWVJZF0gPSBfcHJpY2U7CgogICAgICAgIC8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwCiAgICAgICAgdHJhbnNmZXIoYWRkcmVzcygwKSwgX293bmVyLCBuZXdBc3NldFVuaXF1ZUlkKTsKCiAgICAgICAgcmV0dXJuIG5ld0Fzc2V0VW5pcXVlSWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQSBwdWJsaWMgbWV0aG9kIHRoYXQgZWRpdCBhc3NldCBpbiBjYXNlIG9mIGFueSBtaXN0YWtlIGlzIGRvbmUgZHVyaW5nIHByb2Nlc3Mgb2YgY3JlYXRpb24gYnkgdGhlIGRldmVsb3Blci4gVGhpcwogICAgLy8vIFRoaXMgbWV0aG9kIGRvZXNuJ3QgZG8gYW55IGNoZWNraW5nIGFuZCBzaG91bGQgb25seSBiZSBjYWxsZWQgd2hlbiB0aGUKICAgIC8vLyAgaW5wdXQgZGF0YSBpcyBrbm93biB0byBiZSB2YWxpZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIHRva2VuIElECiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yVG9rZW5JRCBUaGUgYXNzZXQgdGhhdCBjcmVhdGUgdGhhdCB0b2tlbgogICAgLy8vIEBwYXJhbSBfcHJpY2UgYXNzZXQgcHJpY2UKICAgIC8vLyBAcGFyYW0gX0lEIGFzc2V0IElECiAgICAvLy8gQHBhcmFtIF9jYXRlZ29yeSBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0ZSBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9hdHRyaWJ1dGVzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX3N0YXRzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX2Nvb2xkb3duIGFzc2V0IGNvb2xkb3duIGluZGV4CiAgICBmdW5jdGlvbiBlZGl0QXNzZXQoCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9jcmVhdG9yVG9rZW5JRCwKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICB1aW50MTYgX0lELAogICAgICAgIHVpbnQ4IF9jYXRlZ29yeSwKICAgICAgICB1aW50OCBfc3RhdGUsCiAgICAgICAgdWludDggX2F0dHJpYnV0ZXMsCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gX3N0YXRzLAogICAgICAgIHVpbnQxNiBfY29vbGRvd24KICAgICkKICAgIGV4dGVybmFsIHZhbGlkQXNzZXQoX3Rva2VuSWQpIG9ubHlDTGV2ZWwKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gRW5zdXJlIG91ciBkYXRhIHN0cnVjdHVyZXMgYXJlIGFsd2F5cyB2YWxpZC4KICAgICAgICByZXF1aXJlKF9JRCA+IDApOwogICAgICAgIHJlcXVpcmUoX2NhdGVnb3J5ID4gMCk7CiAgICAgICAgcmVxdWlyZShfYXR0cmlidXRlcyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3N0YXRzLmxlbmd0aCA+IDApOwoKICAgICAgICAvLyBzdG9yZSBwcmljZQogICAgICAgIGFzc2V0SW5kZXhUb1ByaWNlW190b2tlbklkXSA9IF9wcmljZTsKCiAgICAgICAgQXNzZXQgc3RvcmFnZSBhc3NldCA9IGFzc2V0c1tfdG9rZW5JZF07CiAgICAgICAgYXNzZXQuSUQgPSBfSUQ7CiAgICAgICAgYXNzZXQuY2F0ZWdvcnkgPSBfY2F0ZWdvcnk7CiAgICAgICAgYXNzZXQuYnVpbHRCeSA9IF9jcmVhdG9yVG9rZW5JRDsKICAgICAgICBhc3NldC5hdHRyaWJ1dGVzID0gYnl0ZXMyKF9hdHRyaWJ1dGVzKTsKICAgICAgICBhc3NldC5zdGF0cyA9IF9zdGF0czsKICAgICAgICBhc3NldC5zdGF0ZSA9IF9zdGF0ZTsKICAgICAgICBhc3NldC5jb29sZG93biA9IF9jb29sZG93bjsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGUgb25seSBzdGF0cwogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfc3RhdHMgYXNzZXQgc3RhdGUsIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRzKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQ4W1NUQVRTX1NJWkVdIF9zdGF0cykgcHVibGljIHZhbGlkQXNzZXQoX3Rva2VuSWQpIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICBhc3NldHNbX3Rva2VuSWRdLnN0YXRzID0gX3N0YXRzOwogICAgfQoKICAgIC8vLyBAZGV2IFVwZGF0ZSBvbmx5IGFzc2V0IHN0YXRlCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkCiAgICAvLy8gQHBhcmFtIF9zdGF0ZSBhc3NldCBzdGF0ZSwgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gdXBkYXRlU3RhdGUodWludDI1NiBfdG9rZW5JZCwgdWludDggX3N0YXRlKSBwdWJsaWMgdmFsaWRBc3NldChfdG9rZW5JZCkgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0c1tfdG9rZW5JZF0uc3RhdGUgPSBfc3RhdGU7CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlIENvb2xkb3duIGZvciBhIHNpbmdsZSBhc3NldAogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfY29vbGRvd24gYXNzZXQgc3RhdGUsIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIHNldEFzc2V0Q29vbGRvd24odWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfY29vbGRvd24sIHVpbnQ2NCBfY29vbGRvd25FbmRCbG9jaykKICAgIHB1YmxpYyB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5jb29sZG93biA9IF9jb29sZG93bjsKICAgICAgICBhc3NldHNbX3Rva2VuSWRdLmNvb2xkb3duRW5kQmxvY2sgPSBfY29vbGRvd25FbmRCbG9jazsKICAgIH0KCiAgICAvKioqIEdFVFRFUlMgKioqLwoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgb25seSBzdGF0cyBkYXRhIGFib3V0IGEgc3BlY2lmaWMgYXNzZXQuCiAgICAvLy8gQGRldiBpdCBpcyBuZWNlc3NhcnkgZHVlIHNvbGlkaXR5IGNvbXBpbGVyIGxpbWl0YXRpb25zCiAgICAvLy8gICAgICB3aGVuIHdlIGhhdmUgbGFyZ2UgcXR5IG9mIHBhcmFtZXRlcnMgaXQgdGhyb3dzIFN0YWNrVG9vRGVlcEV4Y2VwdGlvbgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgZnVuY3Rpb24gZ2V0U3RhdHModWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDhbU1RBVFNfU0laRV0pIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5zdGF0czsKICAgIH0KCiAgICAvLy8gQGRldiByZXR1cm4gY3VycmVudCBwcmljZSBvZiBhbiBhc3NldAogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgZnVuY3Rpb24gcHJpY2VPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHByaWNlKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0SW5kZXhUb1ByaWNlW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVjayBpZiBhc3NldCBoYXMgYWxsIGF0dHJpYnV0ZXMgcGFzc2VkIGJ5IHBhcmFtZXRlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBoYXNBbGxBdHRycyh1aW50MjU2IF90b2tlbklkLCBieXRlczIgX2F0dHJpYnV0ZXMpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5hdHRyaWJ1dGVzICYgX2F0dHJpYnV0ZXMgPT0gX2F0dHJpYnV0ZXM7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaGFzIGFueSBhdHRyaWJ1dGUgcGFzc2VkIGJ5IHBhcmFtZXRlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBoYXNBbnlBdHRycyh1aW50MjU2IF90b2tlbklkLCBieXRlczIgX2F0dHJpYnV0ZXMpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5hdHRyaWJ1dGVzICYgX2F0dHJpYnV0ZXMgIT0gMHgwOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGFzc2V0IGlzIGluIHRoZSBzdGF0ZSBwYXNzZWQgYnkgcGFyYW1ldGVyCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBVbmlxdWVJZCBvZiB0aGUgYXNzZXQgb2YgaW50ZXJlc3QuCiAgICAvLy8gQHBhcmFtIF9jYXRlZ29yeSBzZWUgQXNzZXRDYXRlZ29yeSBpbiBFdGhlcm5hdXRzQmFzZSBmb3IgcG9zc2libGUgc3RhdGVzCiAgICBmdW5jdGlvbiBpc0NhdGVnb3J5KHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQ4IF9jYXRlZ29yeSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3Rva2VuSWRdLmNhdGVnb3J5ID09IF9jYXRlZ29yeTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVjayBpZiBhc3NldCBpcyBpbiB0aGUgc3RhdGUgcGFzc2VkIGJ5IHBhcmFtZXRlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgLy8vIEBwYXJhbSBfc3RhdGUgc2VlIGVudW0gQXNzZXRTdGF0ZSBpbiBFdGhlcm5hdXRzQmFzZSBmb3IgcG9zc2libGUgc3RhdGVzCiAgICBmdW5jdGlvbiBpc1N0YXRlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQ4IF9zdGF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3Rva2VuSWRdLnN0YXRlID09IF9zdGF0ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIG93bmVyIG9mIGEgZ2l2ZW4gQXNzZXQoVG9rZW4pLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgIHsKICAgICAgICByZXR1cm4gYXNzZXRJbmRleFRvT3duZXJbX3Rva2VuSWRdOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBBc3NldHMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgQXNzZXQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkCiAgICBmdW5jdGlvbiBhcHByb3ZlZEZvcih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyBvbmx5R3JhbnRlZENvbnRyYWN0cyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgQXNzZXRzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0cy5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTGlzdCBhbGwgZXhpc3RpbmcgdG9rZW5zLiBJdCBjYW4gYmUgZmlsdGVyZWQgYnkgYXR0cmlidXRlcyBvciBhc3NldHMgd2l0aCBvd25lcgogICAgLy8vIEBwYXJhbSBfb3duZXIgZmlsdGVyIGFsbCBhc3NldHMgYnkgb3duZXIKICAgIGZ1bmN0aW9uIGdldFRva2VuTGlzdChhZGRyZXNzIF9vd25lciwgdWludDggX3dpdGhBdHRyaWJ1dGVzLCB1aW50MjU2IHN0YXJ0LCB1aW50MjU2IGNvdW50KSBleHRlcm5hbCB2aWV3IHJldHVybnMoCiAgICAgICAgdWludDI1Nls2XVtdCiAgICApIHsKICAgICAgICB1aW50MjU2IHRvdGFsQXNzZXRzID0gYXNzZXRzLmxlbmd0aDsKCiAgICAgICAgaWYgKHRvdGFsQXNzZXRzID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1Nls2XVtdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbNl1bXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbNl1bXSh0b3RhbEFzc2V0cyA+IGNvdW50ID8gY291bnQgOiB0b3RhbEFzc2V0cyk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwogICAgICAgICAgICBieXRlczIgaGFzQXR0cmlidXRlcyAgPSBieXRlczIoX3dpdGhBdHRyaWJ1dGVzKTsKICAgICAgICAgICAgQXNzZXQgbWVtb3J5IGFzc2V0OwoKICAgICAgICAgICAgZm9yICh1aW50MjU2IHRva2VuSWQgPSBzdGFydDsgdG9rZW5JZCA8IHRvdGFsQXNzZXRzICYmIHJlc3VsdEluZGV4IDwgY291bnQ7IHRva2VuSWQrKykgewogICAgICAgICAgICAgICAgYXNzZXQgPSBhc3NldHNbdG9rZW5JZF07CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgKGFzc2V0LnN0YXRlICE9IHVpbnQ4KEFzc2V0U3RhdGUuVXNlZCkpICYmCiAgICAgICAgICAgICAgICAgICAgKGFzc2V0SW5kZXhUb093bmVyW3Rva2VuSWRdID09IF9vd25lciB8fCBfb3duZXIgPT0gYWRkcmVzcygwKSkgJiYKICAgICAgICAgICAgICAgICAgICAoYXNzZXQuYXR0cmlidXRlcyAmIGhhc0F0dHJpYnV0ZXMgPT0gaGFzQXR0cmlidXRlcykKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bMF0gPSB0b2tlbklkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bMV0gPSBhc3NldC5JRDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzJdID0gYXNzZXQuY2F0ZWdvcnk7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XVszXSA9IHVpbnQyNTYoYXNzZXQuYXR0cmlidXRlcyk7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XVs0XSA9IGFzc2V0LmNvb2xkb3duOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bNV0gPSBhc3NldEluZGV4VG9QcmljZVt0b2tlbklkXTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KfQoKLy8vIEB0aXRsZSBUaGUgZmFjZXQgb2YgdGhlIEV0aGVybmF1dHMgY29udHJhY3QgdGhhdCBtYW5hZ2VzIG93bmVyc2hpcCwgRVJDLTcyMSBjb21wbGlhbnQuCi8vLyBAbm90aWNlIFRoaXMgcHJvdmlkZXMgdGhlIG1ldGhvZHMgcmVxdWlyZWQgZm9yIGJhc2ljIG5vbi1mdW5naWJsZSB0b2tlbgovLyAgICAgICAgICB0cmFuc2FjdGlvbnMsIGZvbGxvd2luZyB0aGUgZHJhZnQgRVJDLTcyMSBzcGVjIChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxKS4KLy8gICAgICAgICAgSXQgaW50ZXJmYWNlcyB3aXRoIEV0aGVybmF1dHNTdG9yYWdlIHByb3ZpbmRpbmcgYmFzaWMgZnVuY3Rpb25zIGFzIGNyZWF0ZSBhbmQgbGlzdCwgYWxzbyBob2xkcwovLyAgICAgICAgICByZWZlcmVuY2UgdG8gbG9naWMgY29udHJhY3RzIGFzIEF1Y3Rpb24sIEV4cGxvcmUgYW5kIHNvIG9uCi8vLyBAYXV0aG9yIEV0aGVybmF0dXMgLSBGZXJuYW5kbyBQYXVlcgovLy8gQGRldiBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKY29udHJhY3QgRXRoZXJuYXV0c093bmVyc2hpcCBpcyBFdGhlcm5hdXRzQWNjZXNzQ29udHJvbCwgRVJDNzIxIHsKCiAgICAvLy8gQGRldiBDb250cmFjdCBob2xkaW5nIG9ubHkgZGF0YS4KICAgIEV0aGVybmF1dHNTdG9yYWdlIHB1YmxpYyBldGhlcm5hdXRzU3RvcmFnZTsKCiAgICAvKioqIENPTlNUQU5UUyAqKiovCiAgICAvLy8gQG5vdGljZSBOYW1lIGFuZCBzeW1ib2wgb2YgdGhlIG5vbiBmdW5naWJsZSB0b2tlbiwgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiRXRoZXJuYXV0cyI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJFVE5UIjsKCiAgICAvKioqKioqKioqIEVSQyA3MjEgLSBDT01QTElBTkNFIENPTlNUQU5UUyBBTkQgRlVOQ1RJT05TICoqKioqKioqKioqKioqKi8KICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0gYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKCiAgICAvKioqIEVWRU5UUyAqKiovCgogICAgLy8gRXZlbnRzIGFzIHBlciBFUkMtNzIxCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHRva2Vucyk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiB0b2tlbnMpOwoKICAgIC8vLyBAZGV2IFdoZW4gYSBuZXcgYXNzZXQgaXMgY3JlYXRlIGl0IGVtaXRzIGJ1aWxkIGV2ZW50CiAgICAvLy8gQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIG9mIGFzc2V0IG93bmVyCiAgICAvLy8gQHBhcmFtIHRva2VuSWQgQXNzZXQgVW5pcXVlSUQKICAgIC8vLyBAcGFyYW0gYXNzZXRJZCBJRCB0aGF0IGRlZmluZXMgYXNzZXQgbG9vayBhbmQgZmVlbAogICAgLy8vIEBwYXJhbSBwcmljZSBhc3NldCBwcmljZQogICAgZXZlbnQgQnVpbGQoYWRkcmVzcyBvd25lciwgdWludDI1NiB0b2tlbklkLCB1aW50MTYgYXNzZXRJZCwgdWludDI1NiBwcmljZSk7CgogICAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBJbnRyb3NwZWN0aW9uIGludGVyZmFjZSBhcyBwZXIgRVJDLTE2NSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkuCiAgICAvLy8gIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuIEVSQy0xNjUgYW5kIEVSQy03MjEuCiAgICAvLy8gQHBhcmFtIF9pbnRlcmZhY2VJRCBpbnRlcmZhY2Ugc2lnbmF0dXJlIElECiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaXMgdGhlIGN1cnJlbnQgb3duZXIgb2YgYSBwYXJ0aWN1bGFyIEFzc2V0LgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIHZhbGlkYXRpbmcgYWdhaW5zdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZXRoZXJuYXV0c1N0b3JhZ2Uub3duZXJPZihfdG9rZW5JZCkgPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgQXNzZXQuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgY29uZmlybWluZyBhc3NldCBpcyBhcHByb3ZlZCBmb3IuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBldGhlcm5hdXRzU3RvcmFnZS5hcHByb3ZlZEZvcihfdG9rZW5JZCkgPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmtzIGFuIGFkZHJlc3MgYXMgYmVpbmcgYXBwcm92ZWQgZm9yIHRyYW5zZmVyRnJvbSgpLCBvdmVyd3JpdGluZyBhbnkgcHJldmlvdXMKICAgIC8vLyAgYXBwcm92YWwuIFNldHRpbmcgX2FwcHJvdmVkIHRvIGFkZHJlc3MoMCkgY2xlYXJzIGFsbCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgIC8vLyAgTk9URTogX2FwcHJvdmUoKSBkb2VzIE5PVCBzZW5kIHRoZSBBcHByb3ZhbCBldmVudC4gVGhpcyBpcyBpbnRlbnRpb25hbCBiZWNhdXNlCiAgICAvLy8gIF9hcHByb3ZlKCkgYW5kIHRyYW5zZmVyRnJvbSgpIGFyZSB1c2VkIHRvZ2V0aGVyIGZvciBwdXR0aW5nIEFzc2V0cyBvbiBhdWN0aW9uLCBhbmQKICAgIC8vLyAgdGhlcmUgaXMgbm8gdmFsdWUgaW4gc3BhbW1pbmcgdGhlIGxvZyB3aXRoIEFwcHJvdmFsIGV2ZW50cyBpbiB0aGF0IGNhc2UuCiAgICBmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLmFwcHJvdmUoX3Rva2VuSWQsIF9hcHByb3ZlZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgbnVtYmVyIG9mIEFzc2V0cyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBldGhlcm5hdXRzU3RvcmFnZS5iYWxhbmNlT2YoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIGEgQXNzZXQgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vICBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSAob3IKICAgIC8vLyAgRXRoZXJuYXV0cyBzcGVjaWZpY2FsbHkpIG9yIHlvdXIgQXNzZXQgbWF5IGJlIGxvc3QgZm9yZXZlci4gU2VyaW91c2x5LgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBBc3NldCB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IGFzc2V0cwogICAgICAgIC8vIChleGNlcHQgdmVyeSBicmllZmx5IGFmdGVyIGl0IGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGUgc3RvcmFnZSBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwKICAgICAgICAvLyBtaXN1c2UuIEF1Y3Rpb24gb3IgVXBncmFkZSBjb250cmFjdHMgc2hvdWxkIG9ubHkgdGFrZSBvd25lcnNoaXAgb2YgYXNzZXRzCiAgICAgICAgLy8gdGhyb3VnaCB0aGUgYWxsb3cgKyB0cmFuc2ZlckZyb20gZmxvdy4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKGV0aGVybmF1dHNTdG9yYWdlKSk7CgogICAgICAgIC8vIFlvdSBjYW4gb25seSBzZW5kIHlvdXIgb3duIGFzc2V0LgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwLCBjbGVhciBwZW5kaW5nIGFwcHJvdmFscywgZW1pdCBUcmFuc2ZlciBldmVudC4KICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS50cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgLy8vIEBub3RpY2UgR3JhbnQgYW5vdGhlciBhZGRyZXNzIHRoZSByaWdodCB0byB0cmFuc2ZlciBhIHNwZWNpZmljIEFzc2V0IHZpYQogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gVGhpcyBpcyB0aGUgcHJlZmVycmVkIGZsb3cgZm9yIHRyYW5zZmVyaW5nIE5GVHMgdG8gY29udHJhY3RzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAvLy8gIGNsZWFyIGFsbCBhcHByb3ZhbHMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgQXNzZXQgdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgZnVuY3Rpb24gYXBwcm92ZSgKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIE9ubHkgYW4gb3duZXIgY2FuIGdyYW50IHRyYW5zZmVyIGFwcHJvdmFsLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIChyZXBsYWNpbmcgYW55IHByZXZpb3VzIGFwcHJvdmFsKS4KICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBhcHByb3ZhbCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBBc3NldCBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZyBhZGRyZXNzCiAgICAvLy8gIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGUgQXNzZXQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHNob3VsZCB0YWtlIG93bmVyc2hpcCBvZiB0aGUgQXNzZXQuIENhbiBiZSBhbnkgYWRkcmVzcywKICAgIC8vLyAgaW5jbHVkaW5nIHRoZSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgQXNzZXQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgaW50ZXJuYWwKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgYXNzZXRzIChleGNlcHQgZm9yIHVzZWQgYXNzZXRzKS4KICAgICAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfdG9rZW5JZCkpOwogICAgICAgIC8vIENoZWNrIGZvciBhcHByb3ZhbCBhbmQgdmFsaWQgb3duZXJzaGlwCiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IoX3RvLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UudHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIEFzc2V0IG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBBc3NldCB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIEFzc2V0LiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEFzc2V0IHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICBfdHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgLy8vIEBub3RpY2UgQWxsb3cgcHJlLWFwcHJvdmVkIHVzZXIgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIFRva2VuIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHsKICAgICAgICBhZGRyZXNzIF9mcm9tID0gZXRoZXJuYXV0c1N0b3JhZ2Uub3duZXJPZihfdG9rZW5JZCk7CgogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF9mcm9tICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF90cmFuc2ZlckZyb20oX2Zyb20sIG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgQXNzZXRzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGV0aGVybmF1dHNTdG9yYWdlLnRvdGFsU3VwcGx5KCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBvd25lciBvZiBhIGdpdmVuIEFzc2V0KFRva2VuKS4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVG9rZW4gSUQgdG8gZ2V0IG93bmVyLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zIChhZGRyZXNzIG93bmVyKQogICAgewogICAgICAgIG93bmVyID0gZXRoZXJuYXV0c1N0b3JhZ2Uub3duZXJPZihfdG9rZW5JZCk7CgogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhIG5ldyBBc3NldCB3aXRoIHRoZSBnaXZlbiBmaWVsZHMuIE9ObHkgYXZhaWxhYmxlIGZvciBDIExldmVscwogICAgLy8vIEBwYXJhbSBfY3JlYXRvclRva2VuSUQgVGhlIGFzc2V0IHdobyBpcyBmYXRoZXIgb2YgdGhpcyBhc3NldAogICAgLy8vIEBwYXJhbSBfcHJpY2UgYXNzZXQgcHJpY2UKICAgIC8vLyBAcGFyYW0gX2Fzc2V0SUQgYXNzZXQgSUQKICAgIC8vLyBAcGFyYW0gX2NhdGVnb3J5IHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdHMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gY3JlYXRlTmV3QXNzZXQoCiAgICAgICAgdWludDI1NiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDE2IF9hc3NldElELAogICAgICAgIHVpbnQ4IF9jYXRlZ29yeSwKICAgICAgICB1aW50OCBfYXR0cmlidXRlcywKICAgICAgICB1aW50OFtTVEFUU19TSVpFXSBfc3RhdHMKICAgICkKICAgIGV4dGVybmFsIG9ubHlDTGV2ZWwKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gb3duZXIgbXVzdCBiZSBzZW5kZXIKICAgICAgICByZXF1aXJlKF9vd25lciAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiB0b2tlbklEID0gZXRoZXJuYXV0c1N0b3JhZ2UuY3JlYXRlQXNzZXQoCiAgICAgICAgICAgIF9jcmVhdG9yVG9rZW5JRCwKICAgICAgICAgICAgX293bmVyLAogICAgICAgICAgICBfcHJpY2UsCiAgICAgICAgICAgIF9hc3NldElELAogICAgICAgICAgICBfY2F0ZWdvcnksCiAgICAgICAgICAgIHVpbnQ4KEFzc2V0U3RhdGUuQXZhaWxhYmxlKSwKICAgICAgICAgICAgX2F0dHJpYnV0ZXMsCiAgICAgICAgICAgIF9zdGF0cywKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMAogICAgICAgICk7CgogICAgICAgIC8vIGVtaXQgdGhlIGJ1aWxkIGV2ZW50CiAgICAgICAgQnVpbGQoCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgdG9rZW5JRCwKICAgICAgICAgICAgX2Fzc2V0SUQsCiAgICAgICAgICAgIF9wcmljZQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0b2tlbklEOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHZlcmlmeSBpZiB0b2tlbiBpcyBpbiBleHBsb3JhdGlvbiB0aW1lCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBUb2tlbiBJRCB0aGF0IGNhbiBiZSB1cGdyYWRlZAogICAgZnVuY3Rpb24gaXNFeHBsb3JpbmcodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQyNTYgY29vbGRvd247CiAgICAgICAgdWludDY0IGNvb2xkb3duRW5kQmxvY2s7CiAgICAgICAgKCwsLCwsY29vbGRvd25FbmRCbG9jaywgY29vbGRvd24sKSA9IGV0aGVybmF1dHNTdG9yYWdlLmFzc2V0cyhfdG9rZW5JZCk7CiAgICAgICAgcmV0dXJuIChjb29sZG93biA+IG5vdykgfHwgKGNvb2xkb3duRW5kQmxvY2sgPiB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICB9Cn0KCgovLy8gQHRpdGxlIFRoZSBmYWNldCBvZiB0aGUgRXRoZXJuYXV0cyBMb2dpYyBjb250cmFjdCBoYW5kbGUgYWxsIGNvbW1vbiBjb2RlIGZvciBsb2dpYy9idXNpbmVzcyBjb250cmFjdHMKLy8vIEBhdXRob3IgRXRoZXJuYXR1cyAtIEZlcm5hbmRvIFBhdWVyCmNvbnRyYWN0IEV0aGVybmF1dHNMb2dpYyBpcyBFdGhlcm5hdXRzT3duZXJzaGlwIHsKCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgbG9naWMgY29udHJhY3QgaXMgYnJva2VuIGFuZCBhbiB1cGdyYWRlIGlzIHJlcXVpcmVkCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdDb250cmFjdEFkZHJlc3M7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEV0aGVybmF1dHNMb2dpYygpIHB1YmxpYyB7CiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENFTywgQ09PLCBDVE8KICAgICAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBjdG9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBjb29BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBvcmFjbGVBZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gU3RhcnRzIHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFVzZWQgdG8gbWFyayB0aGUgc21hcnQgY29udHJhY3QgYXMgdXBncmFkZWQsIGluIGNhc2UgdGhlcmUgaXMgYSBzZXJpb3VzCiAgICAvLy8gIGJyZWFraW5nIGJ1Zy4gVGhpcyBtZXRob2QgZG9lcyBub3RoaW5nIGJ1dCBrZWVwIHRyYWNrIG9mIHRoZSBuZXcgY29udHJhY3QgYW5kCiAgICAvLy8gIGVtaXQgYSBtZXNzYWdlIGluZGljYXRpbmcgdGhhdCB0aGUgbmV3IGFkZHJlc3MgaXMgc2V0LiBJdCdzIHVwIHRvIGNsaWVudHMgb2YgdGhpcwogICAgLy8vICBjb250cmFjdCB0byB1cGRhdGUgdG8gdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzIGluIHRoYXQgY2FzZS4gKFRoaXMgY29udHJhY3Qgd2lsbAogICAgLy8vICBiZSBwYXVzZWQgaW5kZWZpbml0ZWx5IGlmIHN1Y2ggYW4gdXBncmFkZSB0YWtlcyBwbGFjZS4pCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgbmV3IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE5ld0FkZHJlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q1RPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICAgIH0KCiAgICAvLy8gQGRldiBzZXQgYSBuZXcgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9DU3RvcmFnZUFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nIEV0aGVybmF1dHNTdG9yYWdlLgogICAgZnVuY3Rpb24gc2V0RXRoZXJuYXV0c1N0b3JhZ2VDb250cmFjdChhZGRyZXNzIF9DU3RvcmFnZUFkZHJlc3MpIHB1YmxpYyBvbmx5Q0xldmVsIHdoZW5QYXVzZWQgewogICAgICAgIEV0aGVybmF1dHNTdG9yYWdlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRXRoZXJuYXV0c1N0b3JhZ2UoX0NTdG9yYWdlQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0V0aGVybmF1dHNTdG9yYWdlKCkpOwogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgT3ZlcnJpZGUgdW5wYXVzZSBzbyBpdCByZXF1aXJlcyBhbGwgZXh0ZXJuYWwgY29udHJhY3QgYWRkcmVzc2VzCiAgICAvLy8gIHRvIGJlIHNldCBiZWZvcmUgY29udHJhY3QgY2FuIGJlIHVucGF1c2VkLiBBbHNvLCB3ZSBjYW4ndCBoYXZlCiAgICAvLy8gIG5ld0NvbnRyYWN0QWRkcmVzcyBzZXQgZWl0aGVyLCBiZWNhdXNlIHRoZW4gdGhlIGNvbnRyYWN0IHdhcyB1cGdyYWRlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIHdlIGNhbiBjYWxsIHN1cGVyLnVucGF1c2UKICAgIC8vLyAgd2l0aG91dCB1c2luZyBhbiBleHBlbnNpdmUgQ0FMTC4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKGV0aGVybmF1dHNTdG9yYWdlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIHJlcXVpcmUgdGhpcyBjb250cmFjdCB0byBoYXZlIGFjY2VzcyB0byBzdG9yYWdlIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZS5jb250cmFjdHNHcmFudGVkQWNjZXNzKGFkZHJlc3ModGhpcykpID09IHRydWUpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CgogICAgLy8gQGRldiBBbGxvd3MgdGhlIENPTyB0byBjYXB0dXJlIHRoZSBiYWxhbmNlIGF2YWlsYWJsZSB0byB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2VzKGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seUNMZXZlbCB7CiAgICAgICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIHJldHVybiBjdXJyZW50IGNvbnRyYWN0IGJhbGFuY2UKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoKSBwdWJsaWMgdmlldyBvbmx5Q0xldmVsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgfQp9CgovLy8gQHRpdGxlIENsb2NrIGF1Y3Rpb24gZm9yIG5vbi1mdW5naWJsZSB0b2tlbnMuCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KLy8vICAgICAgICAgVGhpcyBwcm92aWRlcyBwdWJsaWMgbWV0aG9kcyBmb3IgYXVjdGlvbmluZyBvciBiaWRkaW5nIG9uIGFzc2V0cywgcHVyY2hhc2UgKEdvbGRlbkdvb3NlKSBhbmQgVXBncmFkZSBzaGlwLgovLy8KLy8vICAgICAgLSBBdWN0aW9ucy9CaWRkaW5nOiBUaGlzIHByb3ZpZGVzIHB1YmxpYyBtZXRob2RzIGZvciBhdWN0aW9uaW5nIG9yIGJpZGRpbmcgb24gYXNzZXRzLgovLy8gICAgICAgICAgICAgQXVjdGlvbiBjcmVhdGlvbiBpcyBtb3N0bHkgbWVkaWF0ZWQgdGhyb3VnaCB0aGlzIGZhY2V0IG9mIHRoZSBsb2dpYyBjb250cmFjdC4KLy8vCi8vLyAgICAgIC0gUHVyY2hhc2U6IFRoaXMgcHJvdmlkZXMgcHVibGljIG1ldGhvZHMgZm9yIGJ1eWluZyBHb2xkZW5Hb29zZSBhc3NldHMuCi8vLyBAYXV0aG9yIEV0aGVybmF0dXMgLSBGZXJuYW5kbyBQYXVlcgpjb250cmFjdCBFdGhlcm5hdXRzTWFya2V0IGlzIEV0aGVybmF1dHNMb2dpYywgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgY3JlYXRlcyBhIHJlZmVyZW5jZSB0byB0aGUgTkZUIG93bmVyc2hpcCBjb250cmFjdAogICAgLy8vICBhbmQgdmVyaWZpZXMgdGhlIG93bmVyIGN1dCBpcyBpbiB0aGUgdmFsaWQgcmFuZ2UuCiAgICAvLy8gIGFuZCBEZWxlZ2F0ZSBjb25zdHJ1Y3RvciB0byBFdGhlcm5hdXRzVXBncmFkZSBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2N1dCAtIHBlcmNlbnQgY3V0IHRoZSBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG11c3QgYmUKICAgIC8vLyAgYmV0d2VlbiAwLTEwLDAwMC4KICAgIGZ1bmN0aW9uIEV0aGVybmF1dHNNYXJrZXQodWludDI1NiBfY3V0KSBwdWJsaWMKICAgIEV0aGVybmF1dHNMb2dpYygpIHsKICAgICAgICByZXF1aXJlKF9jdXQgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0ID0gdGhpczsKICAgIH0KCiAgICAvKioqIEVWRU5UUyAqKiovCiAgICAvLy8gQGRldiBUaGUgUHVyY2hhc2UgZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSB0b2tlbiBpcyBzb2xkLgogICAgZXZlbnQgUHVyY2hhc2UodWludDI1NiBpbmRleGVkIHRva2VuSWQsIHVpbnQyNTYgb2xkUHJpY2UsIHVpbnQyNTYgbmV3UHJpY2UsIGFkZHJlc3MgaW5kZXhlZCBwcmV2T3duZXIsIGFkZHJlc3MgaW5kZXhlZCB3aW5uZXIpOwoKICAgIC8qKiogQ09OU1RBTlRTICoqKi8KICAgIHVpbnQ4IHByaXZhdGUgcGVyY2VudGFnZUZlZTFTdGVwID0gOTU7CiAgICB1aW50OCBwcml2YXRlIHBlcmNlbnRhZ2VGZWUyU3RlcCA9IDk1OwogICAgdWludDggcHJpdmF0ZSBwZXJjZW50YWdlRmVlU3RlcHMgPSA5ODsKICAgIHVpbnQ4IHByaXZhdGUgcGVyY2VudGFnZUJhc2UgPSAxMDA7CiAgICB1aW50OCBwcml2YXRlIHBlcmNlbnRhZ2UxU3RlcCA9IDIwMDsKICAgIHVpbnQ4IHByaXZhdGUgcGVyY2VudGFnZTJTdGVwID0gMTI1OwogICAgdWludDggcHJpdmF0ZSBwZXJjZW50YWdlU3RlcHMgPSAxMTU7CiAgICB1aW50MjU2IHByaXZhdGUgZmlyc3RTdGVwTGltaXQgPSAgMC4wNSBldGhlcjsKICAgIHVpbnQyNTYgcHJpdmF0ZSBzZWNvbmRTdGVwTGltaXQgPSA1IGV0aGVyOwoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKiogQVVDVElPTiBBTkQgQklERElORyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLy8gQGRldiBCaWRzIG9uIGFuIG9wZW4gYXVjdGlvbiwgY29tcGxldGluZyB0aGUgYXVjdGlvbiBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gX2JpZCB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICB1aW50MjU2IG5ld1ByaWNlID0gX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAvLyBvbmx5IHNldCBuZXcgcHJpY2UgYWZ0ZXIgdHJhbnNmZXIKICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS5zZXRQcmljZShfdG9rZW5JZCwgbmV3UHJpY2UpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB0aGF0IGhhc24ndCBiZWVuIHdvbiB5ZXQuCiAgICAvLy8gIFJldHVybnMgdGhlIE5GVCB0byBvcmlnaW5hbCBvd25lci4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgYSBzdGF0ZS1tb2RpZnlpbmcgZnVuY3Rpb24gdGhhdCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIHdoaWxlIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gb24gYXVjdGlvbgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gIE9ubHkgdGhlIG93bmVyIG1heSBkbyB0aGlzLCBhbmQgTkZUcyBhcmUgcmV0dXJuZWQgdG8KICAgIC8vLyAgdGhlIHNlbGxlci4gVGhpcyBzaG91bGQgb25seSBiZSB1c2VkIGluIGVtZXJnZW5jaWVzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSBORlQgb24gYXVjdGlvbiB0byBjYW5jZWwuCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uV2hlblBhdXNlZCh1aW50MjU2IF90b2tlbklkKQogICAgd2hlblBhdXNlZAogICAgb25seUNMZXZlbAogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbi5zZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZSBhbiBhdWN0aW9uIHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZCB0bwogICAgLy8vICByZWNyZWF0ZSBwZW5kaW5nIGJpZHMgZnJvbSBsYXN0IGNvbnRyYWN0LgogICAgLy8vICBUaGlzIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gZW1lcmdlbmNpZXMuCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdCAtIHByZXZpb3VzIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBvcmlnaW5hbCBzZWxsZXIgb2YgcHJldmlvdXMgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb25XaGVuUGF1c2VkKAogICAgICAgIGFkZHJlc3MgX2NvbnRyYWN0LAogICAgICAgIGFkZHJlc3MgX3NlbGxlciwKICAgICAgICB1aW50MjU2IF90b2tlbklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24KICAgICkKICAgIHdoZW5QYXVzZWQKICAgIG9ubHlDTGV2ZWwKICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIC8vIGVuc3VyZSB0aGlzIGNvbnRyYWN0IG93bnMgdGhlIGF1Y3Rpb24KICAgICAgICByZXF1aXJlKF9vd25zKF9jb250cmFjdCwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9zZWxsZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLmFwcHJvdmUoX3Rva2VuSWQsIGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLy8gRXNjcm93cyB0aGUgTkZULCBhc3NpZ25pbmcgb3duZXJzaGlwIHRvIHRoaXMgY29udHJhY3QuCiAgICAgICAgLy8vIFRocm93cyBpZiB0aGUgZXNjcm93IGZhaWxzLgogICAgICAgIF90cmFuc2ZlckZyb20oX2NvbnRyYWN0LCB0aGlzLCBfdG9rZW5JZCk7CgogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwoKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBhdWN0aW9uIGluZm8gZm9yIGFuIE5GVCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMKICAgICgKICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBlbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgc3RhcnRlZEF0CiAgICApIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gKAogICAgICAgIGF1Y3Rpb24uc2VsbGVyLAogICAgICAgIGF1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICBhdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgIGF1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0aGUgdG9rZW4gcHJpY2Ugd2UgYXJlIGNoZWNraW5nLgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4gRG9lcyBzb21lIG93bmVyc2hpcCB0cmlja2VyeSB0byBjcmVhdGUgYXVjdGlvbnMgaW4gb25lIHR4LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIGF1Y3Rpb24sIHNlbmRlciBtdXN0IGJlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfc3RhcnRpbmdQcmljZSAtIFByaWNlIG9mIGl0ZW0gKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9lbmRpbmdQcmljZSAtIFByaWNlIG9mIGl0ZW0gKGluIHdlaSkgYXQgZW5kIG9mIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9kdXJhdGlvbiAtIExlbmd0aCBvZiB0aW1lIHRvIG1vdmUgYmV0d2VlbiBzdGFydGluZwogICAgLy8vICBwcmljZSBhbmQgZW5kaW5nIHByaWNlIChpbiBzZWNvbmRzKS4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNhbGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbgogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBhc3NldCBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIC8vIEVuc3VyZSB0aGUgYXNzZXQgaXMgVHJhZGVhYmxlIGFuZCBub3QgR29sZGVuR29vc2UgdG8gcHJldmVudCB0aGUgYXVjdGlvbgogICAgICAgIC8vIGNvbnRyYWN0IGFjY2lkZW50YWxseSByZWNlaXZpbmcgb3duZXJzaGlwIG9mIHRoZSBjaGlsZC4KICAgICAgICByZXF1aXJlKGV0aGVybmF1dHNTdG9yYWdlLmhhc0FsbEF0dHJzKF90b2tlbklkLCBBVFRSX1RSQURBQkxFKSk7CiAgICAgICAgcmVxdWlyZSghZXRoZXJuYXV0c1N0b3JhZ2UuaGFzQWxsQXR0cnMoX3Rva2VuSWQsIEFUVFJfR09MREVOR09PU0UpKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoZSBhc3NldCBpcyBpbiBhdmFpbGFibGUgc3RhdGUsIG90aGVyd2lzZSBpdCBjYW5ub3QgYmUgc29sZAogICAgICAgIHJlcXVpcmUoZXRoZXJuYXV0c1N0b3JhZ2UuaXNTdGF0ZShfdG9rZW5JZCwgdWludDgoQXNzZXRTdGF0ZS5BdmFpbGFibGUpKSk7CgogICAgICAgIC8vIGFzc2V0IG9yIG9iamVjdCBjb3VsZCBub3QgYmUgaW4gZXhwbG9yYXRpb24KICAgICAgICByZXF1aXJlKCFpc0V4cGxvcmluZyhfdG9rZW5JZCkpOwoKICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS5hcHByb3ZlKF90b2tlbklkLCBhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgLy8vIEVzY3Jvd3MgdGhlIE5GVCwgYXNzaWduaW5nIG93bmVyc2hpcCB0byB0aGlzIGNvbnRyYWN0LgogICAgICAgIC8vLyBUaHJvd3MgaWYgdGhlIGVzY3JvdyBmYWlscy4KICAgICAgICBfdHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF90b2tlbklkKTsKCiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CgogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbnkgQy1sZXZlbCBjYW4gY2hhbmdlIHNhbGVzIGN1dC4KICAgIGZ1bmN0aW9uIHNldE93bmVyQ3V0KHVpbnQyNTYgX293bmVyQ3V0KSBwdWJsaWMgb25seUNMZXZlbCB7CiAgICAgICAgb3duZXJDdXQgPSBfb3duZXJDdXQ7CiAgICB9CgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKiogUFVSQ0hBU0UgKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBzb21lb25lIGJ1eSBvYnRhaW4gYW4gR29sZGVuR29vc2UgYXNzZXQgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFRva2VuIElEIHRoYXQgY2FuIGJlIHB1cmNoYXNlZCBpZiBUb2tlbiBpcyBhIEdvbGRlbkdvb3NlIGFzc2V0LgogICAgZnVuY3Rpb24gcHVyY2hhc2UodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBDaGVja2luZyBpZiBBc3NldCBpcyBhIEdvbGRlbkdvb3NlLCBpZiBub3QgdGhpcyBwdXJjaGFzZSBpcyBub3QgYWxsb3dlZAogICAgICAgIHJlcXVpcmUoZXRoZXJuYXV0c1N0b3JhZ2UuaGFzQW55QXR0cnMoX3Rva2VuSWQsIEFUVFJfR09MREVOR09PU0UpKTsKCiAgICAgICAgLy8gYXNzZXQgY291bGQgbm90IGJlIGluIGV4cGxvcmF0aW9uCiAgICAgICAgcmVxdWlyZSghaXNFeHBsb3JpbmcoX3Rva2VuSWQpKTsKCiAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpOwogICAgICAgIGFkZHJlc3MgbmV3T3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQyNTYgc2VsbGluZ1ByaWNlID0gZXRoZXJuYXV0c1N0b3JhZ2UucHJpY2VPZihfdG9rZW5JZCk7CgogICAgICAgIC8vIE1ha2luZyBzdXJlIHRva2VuIG93bmVyIGlzIG5vdCBzZW5kaW5nIHRvIHNlbGYKICAgICAgICAvLyBpdCBndWFyYW50ZWVzIGEgZmFpciBtYXJrZXQKICAgICAgICByZXF1aXJlKG9sZE93bmVyICE9IG5ld093bmVyKTsKCiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIE1ha2luZyBzdXJlIHNlbnQgYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgc2VsbGluZ1ByaWNlCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gc2VsbGluZ1ByaWNlKTsKCiAgICAgICAgdWludDI1NiBwYXltZW50ID0gdWludDI1NihTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHNlbGxpbmdQcmljZSwgcGVyY2VudGFnZUZlZTFTdGVwKSwgMTAwKSk7CiAgICAgICAgdWludDI1NiBwdXJjaGFzZUV4Y2VzcyA9IFNhZmVNYXRoLnN1Yihtc2cudmFsdWUsIHNlbGxpbmdQcmljZSk7CiAgICAgICAgdWludDI1NiBuZXdQcmljZSA9IHNlbGxpbmdQcmljZTsKCiAgICAgICAgLy8gVXBkYXRlIHByaWNlcwogICAgICAgIGlmIChzZWxsaW5nUHJpY2UgPCBmaXJzdFN0ZXBMaW1pdCkgewogICAgICAgICAgICAvLyBmaXJzdCBzdGFnZQogICAgICAgICAgICBuZXdQcmljZSA9IFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2VsbGluZ1ByaWNlLCBwZXJjZW50YWdlMVN0ZXApLCBwZXJjZW50YWdlQmFzZSk7CiAgICAgICAgfSBlbHNlIGlmIChzZWxsaW5nUHJpY2UgPCBzZWNvbmRTdGVwTGltaXQpIHsKICAgICAgICAgICAgLy8gcmVkZWZpbmluZyBmZWVzCiAgICAgICAgICAgIHBheW1lbnQgPSB1aW50MjU2KFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2VsbGluZ1ByaWNlLCBwZXJjZW50YWdlRmVlMlN0ZXApLCAxMDApKTsKCiAgICAgICAgICAgIC8vIHNlY29uZCBzdGFnZQogICAgICAgICAgICBuZXdQcmljZSA9IFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2VsbGluZ1ByaWNlLCBwZXJjZW50YWdlMlN0ZXApLCBwZXJjZW50YWdlQmFzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVkZWZpbmluZyBmZWVzCiAgICAgICAgICAgIHBheW1lbnQgPSB1aW50MjU2KFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2VsbGluZ1ByaWNlLCBwZXJjZW50YWdlRmVlU3RlcHMpLCAxMDApKTsKCiAgICAgICAgICAgIC8vIGxhc3Qgc3RhZ2UKICAgICAgICAgICAgbmV3UHJpY2UgPSBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHNlbGxpbmdQcmljZSwgcGVyY2VudGFnZVN0ZXBzKSwgcGVyY2VudGFnZUJhc2UpOwogICAgICAgIH0KCiAgICAgICAgLy8gUGF5IHByZXZpb3VzIHRva2VuT3duZXIgaWYgb3duZXIgaXMgbm90IGNvbnRyYWN0CiAgICAgICAgaWYgKG9sZE93bmVyICE9IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgb2xkT3duZXIudHJhbnNmZXIocGF5bWVudCk7IC8vKDEtMC4wNikKICAgICAgICB9CgogICAgICAgIC8vIG9ubHkgdHJhbnNmZXIgdG9rZW4gYWZ0ZXIgY29uZmlybWVkIHRyYW5zYWN0aW9uCiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UudHJhbnNmZXIob2xkT3duZXIsIG5ld093bmVyLCBfdG9rZW5JZCk7CgogICAgICAgIC8vIG9ubHkgc2V0IG5ldyBwcmljZSBhZnRlciBjb25maXJtZWQgdHJhbnNhY3Rpb24KICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS5zZXRQcmljZShfdG9rZW5JZCwgbmV3UHJpY2UpOwoKICAgICAgICBQdXJjaGFzZShfdG9rZW5JZCwgc2VsbGluZ1ByaWNlLCBuZXdQcmljZSwgb2xkT3duZXIsIG5ld093bmVyKTsKCiAgICAgICAgLy8gc2VuZCBleGNlc3MgYmFjayB0byBidXllcgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocHVyY2hhc2VFeGNlc3MpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFueSBDLWxldmVsIGNhbiBjaGFuZ2UgZmlyc3QgU3RlcCBMaW1pdC4KICAgIGZ1bmN0aW9uIHNldFN0ZXBMaW1pdHMoCiAgICAgICAgdWludDI1NiBfZmlyc3RTdGVwTGltaXQsCiAgICAgICAgdWludDI1NiBfc2Vjb25kU3RlcExpbWl0CiAgICApIHB1YmxpYyBvbmx5Q0xldmVsIHsKICAgICAgICBmaXJzdFN0ZXBMaW1pdCA9IF9maXJzdFN0ZXBMaW1pdDsKICAgICAgICBzZWNvbmRTdGVwTGltaXQgPSBfc2Vjb25kU3RlcExpbWl0OwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFueSBDLWxldmVsIGNhbiBjaGFuZ2UgcGVyY2VudGFnZSB2YWx1ZXMKICAgIGZ1bmN0aW9uIHNldFBlcmNlbnRhZ2VzKAogICAgICAgIHVpbnQ4IF9GZWUxLAogICAgICAgIHVpbnQ4IF9GZWUyLAogICAgICAgIHVpbnQ4IF9GZWVzLAogICAgICAgIHVpbnQ4IF8xU3RlcCwKICAgICAgICB1aW50OCBfMlN0ZXAsCiAgICAgICAgdWludDggX1N0ZXBzCiAgICApIHB1YmxpYyBvbmx5Q0xldmVsIHsKICAgICAgICBwZXJjZW50YWdlRmVlMVN0ZXAgPSBfRmVlMTsKICAgICAgICBwZXJjZW50YWdlRmVlMlN0ZXAgPSBfRmVlMjsKICAgICAgICBwZXJjZW50YWdlRmVlU3RlcHMgPSBfRmVlczsKICAgICAgICBwZXJjZW50YWdlMVN0ZXAgPSBfMVN0ZXA7CiAgICAgICAgcGVyY2VudGFnZTJTdGVwID0gXzJTdGVwOwogICAgICAgIHBlcmNlbnRhZ2VTdGVwcyA9IF9TdGVwczsKICAgIH0KCn0='.
	

]
