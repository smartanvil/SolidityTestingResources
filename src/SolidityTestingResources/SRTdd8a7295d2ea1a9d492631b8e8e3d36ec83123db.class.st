Class {
	#name : #SRTdd8a7295d2ea1a9d492631b8e8e3d36ec83123db,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdd8a7295d2ea1a9d492631b8e8e3d36ec83123db >> base64 [
	^ 'Ly8gVkVSU0lPTiBMCgpwcmFnbWEgc29saWRpdHkgXjAuNC44OwoKCi8vCi8vIEZPUiBSRUZFUkVOQ0UgLSBJTkNMVURFICBpRTRSb3dFc2Nyb3cgIChpbnRlcmZhY2UpIENPTlRSQUNUIGF0IHRoZSB0b3AgLi4uLi4KLy8KCmNvbnRyYWN0IGlFNFJvd0VzY3JvdyB7CglmdW5jdGlvbiBnZXROdW1HYW1lc1N0YXJ0ZWQoKSBjb25zdGFudCByZXR1cm5zIChpbnQgbmdhbWVzKTsKfQoKLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBBQlNUUkFDVCBzdGFuZGFyZCB0b2tlbiBjbGFzcwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgVG9rZW4geyAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIEU0Um93UmV3YXJkcyAtIGFic3RyYWN0IGU0IGRpdmlkZW5kIGNvbnRyYWN0Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEU0Um93UmV3YXJkcwp7CglmdW5jdGlvbiBjaGVja0RpdmlkZW5kcyhhZGRyZXNzIF9hZGRyKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2Ftb3VudCk7CglmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IG5hbW91bnQpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgRmlubmV5IENoaXAgLSB0b2tlbiBjb250cmFjdAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBFNFRva2VuIGlzIFRva2VuLCBFNFJvd1Jld2FyZHMgewogICAgCWV2ZW50IFN0YXRFdmVudChzdHJpbmcgbXNnKTsKICAgIAlldmVudCBTdGF0RXZlbnRJKHN0cmluZyBtc2csIHVpbnQgdmFsKTsKCgllbnVtIFNldHRpbmdTdGF0ZVZhbHVlICB7ZGVidWcsIHJlbGVhc2UsIGxvY2tlZFJlbGVhc2V9CgllbnVtIEljb1N0YXR1c1ZhbHVlIHthbm91bmNlbWVudCwgc2FsZU9wZW4sIHNhbGVDbG9zZWQsIGZhaWxlZCwgc3VjY2VlZGVkfQoKCgoKCXN0cnVjdCB0b2tlbkFjY291bnQgewoJCWJvb2wgYWxsb2NlZDsgLy8gZmxhZyB0byBhc2NlcnQgcHJpb3IgYWxsb2NhdGlvbgoJCXVpbnQgdG9rZW5zOyAvLyBudW0gdG9rZW5zCgkJdWludCBiYWxhbmNlOyAvLyByZXdhcmRzIGJhbGFuY2UKCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIGRhdGEgc3RvcmFnZQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglhZGRyZXNzIGRldmVsb3BlcnM7IC8vIGRldmVsb3BlcnMgdG9rZW4gaG9sZGluZyBhZGRyZXNzCglhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy8gZGVwbG95ZXIgZXhlY3V0b3IKCWFkZHJlc3MgZm91bmRlck9yZzsgLy8gZm91bmRlciBvcmdpbmFpemF0aW9uIGNvbnRyYWN0CglhZGRyZXNzIGF1eFBhcnRuZXI7IC8vIGF1eCBwYXJ0bmVyIChwci9hdWRpdGluZykgLSAxIHBlcmNlbnQgdXBvbiBjbG9zZQoJYWRkcmVzcyBlNF9wYXJ0bmVyOyAvLyBlNHJvdyAgY29udHJhY3QgYWRkcmVzc2VzCgoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdG9rZW5BY2NvdW50KSBob2xkZXJBY2NvdW50cyA7IC8vIHdobyBob2xkcyBob3cgbWFueSB0b2tlbnMgKGhpZ2ggdHdvIGJ5dGVzIGNvbnRhaW4gY3VyUGF5SWQpCgltYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpIGhvbGRlckluZGV4ZXMgOyAvLyBmb3IgaXRlcmF0aW9uIHRocnUgaG9sZGVyCgl1aW50IG51bUFjY291bnRzOwoKCXVpbnQgcGFydG5lckNyZWRpdHM7IC8vIGFtb3VudCBwYXJ0bmVyIChlNHJvdykgIGhhcyBwYWlkCgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7IC8vIGFwcHJvdmFscwoKCgl1aW50IG1heE1pbnRhYmxlVG9rZW5zOyAvLyAuLi4KCXVpbnQgbWluSWNvVG9rZW5Hb2FsOy8vIHRva2VuIGdvYWwgYnkgc2FsZSBlbmQKCXVpbnQgbWluVXNhZ2VHb2FsOyAvLyAgbnVtIGdhbWVzIGdvYWwgYnkgdXNhZ2UgZGVhZGxpbmUKCXVpbnQgcHVibGljICB0b2tlblByaWNlOyAvLyBwcmljZSBwZXIgdG9rZW4KCXVpbnQgcHVibGljIHBheW91dFRocmVzaG9sZDsgLy8gdGhyZXNob2xkIHRpbGwgcGF5b3V0CgoJdWludCB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZDsgCS8vIHJ1bm5pbmcgdG90YWwgb2YgdG9rZW4gZnVuZHMgcmVjZWl2ZWQKCXVpbnQgcHVibGljIHRvdGFsVG9rZW5zTWludGVkOyAJLy8gdG90YWwgbnVtYmVyIG9mIHRva2VucyBtaW50ZWQKCXVpbnQgcHVibGljIGhvbGRvdmVyQmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwdWJsaWMgcGF5b3V0QmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwck9yaWdQYXlvdXRCYWw7CQkJLy8gb3JpZ2luYWwgcGF5b3V0IGJhbGFuY2UgYmVmb3JlIHJ1bgoJdWludCBwck9yaWdUb2tlbnNNaW50OyAJCQkvLyB0b2tlbnMgbWludGVkIGF0IHN0YXJ0IG9mIHBheSBydW4KCXVpbnQgcHVibGljIGN1clBheW91dElkOwkJLy8gY3VycmVudCBwYXlvdXQgaWQKCXVpbnQgcHVibGljIGxhc3RQYXlvdXRJbmRleDsJCS8vIHBheW91dCBpZHggYmV0d2VlbiBydW4gc2VnbWVudHMKCXVpbnQgcHVibGljIG1heFBheXNQZXI7CQkJLy8gbnVtIHBheXMgcGVyIHNlZ21lbnQKCXVpbnQgcHVibGljIG1pblBheUludGVydmFsOwkJLy8gbWluIGludGVydmFsIGJldHdlZW4gc3RhcnQgcGF5IHJ1bgoKCgl1aW50IGZ1bmRpbmdTdGFydDsgCQkvLyBmdW5kaW5nIHN0YXJ0IHRpbWUgaW1tZWRpYXRlbHkgYWZ0ZXIgYW5vdW5jZW1lbnQKCXVpbnQgZnVuZGluZ0RlYWRsaW5lOyAJCS8vIGZ1bmRpbmcgZW5kIHRpbWUKCXVpbnQgdXNhZ2VEZWFkbGluZTsgCQkvLyBkZWFkbGluZSB3aGVyZSBtaW5pbXVtIHVzYWdlIG5lZWRzIHRvIGJlIG1ldCBiZWZvcmUgY29uc2lkZXJlZCBzdWNjZXNzCgl1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgCS8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lCgl1aW50IHZlc3RUaW1lOyAJCS8vIDEgeWVhciBwYXN0IHNhbGUgdmVzdCBkZXZlbG9wZXIgdG9rZW5zCgl1aW50IG51bURldlRva2VuczsgCS8vIDEwIHBlciBjZW50IG9mIHRva2VucyBhZnRlciBjbG9zZSB0byBkZXZlbG9wZXJzCglib29sIGRldmVsb3BlcnNHcmFudGVkOyAJCS8vIGZsYWcKCXVpbnQgcmVtdW5lcmF0aW9uU3RhZ2U7IAkvLyAwIGZvciBub3QgeWV0LCAxIGZvciAxMCBwZXJjZW50LCAyIGZvciByZW1haW5pbmcgIHVwb24gc3VjY2VlZGVkLgoJdWludCBwdWJsaWMgcmVtdW5lcmF0aW9uQmFsYW5jZTsgCS8vIHJlbXVuZXJhdGlvbiBiYWxhbmNlIHRvIHJlbGVhc2UgdG9rZW4gZnVuZHMKCXVpbnQgYXV4UGFydG5lckJhbGFuY2U7IAkvLyBhdXggcGFydG5lciBiYWxhbmNlIC0gMSBwZXJjZW50Cgl1aW50IHJtR2FzOyAvLyByZW11bmVyYXRpb24gZ2FzCgl1aW50IHJ3R2FzOyAvLyByZXdhcmQgZ2FzCgl1aW50IHJmR2FzOyAvLyByZWZ1bmQgZ2FzCgoJSWNvU3RhdHVzVmFsdWUgaWNvU3RhdHVzOyAgLy8gY3VycmVudCBzdGF0dXMgb2YgaWNvCglTZXR0aW5nU3RhdGVWYWx1ZSBwdWJsaWMgc2V0dGluZ3NTdGF0ZTsKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNvbnRyYWN0IGNvbnN0cnVjdG9yCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gRTRUb2tlbigpIAoJewoJCW93bmVyID0gbXNnLnNlbmRlcjsKCQlkZXZlbG9wZXJzID0gbXNnLnNlbmRlcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gdXNlIHRoaXMgdG8gcmVzZXQgZXZlcnl0aGluZywgd2lsbCBuZXZlciBiZSBjYWxsZWQgYWZ0ZXIgbG9ja1JlbGVhc2UKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIHFTdGF0ZSwgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfbWluVXNhZ2UsIHVpbnQgX3Rva0dvYWwsIHVpbnQgIF9tYXhNaW50YWJsZSwgdWludCBfdGhyZXNob2xkLCB1aW50IF9wcmljZSwgdWludCBfbXBwLCB1aW50IF9tcGkgKQoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyKSAKCQkJcmV0dXJuOwoKCQkvLyB0aGVzZSBzZXR0aW5ncyBhcmUgcGVybWFuZW50bHkgdHdlYWthYmxlIGZvciBwZXJmb3JtYW5jZSBhZGp1c3RtZW50cwoJCXBheW91dFRocmVzaG9sZCA9IF90aHJlc2hvbGQ7CgkJbWF4UGF5c1BlciA9IF9tcHA7CgkJbWluUGF5SW50ZXJ2YWwgPSBfbXBpOwoKCQkvLyB0aGlzIGZpcnN0IHRlc3QgY2hlY2tzIGlmIGFscmVhZHkgbG9ja2VkCgkJaWYgKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJcmV0dXJuOwoKIAkgCXNldHRpbmdzU3RhdGUgPSBxU3RhdGU7CgoJCS8vIHRoaXMgc2Vjb25kIHRlc3QgYWxsb3dzIGxvY2tpbmcgd2l0aG91dCBjaGFuZ2luZyBvdGhlciBwZXJtYW5lbnQgc2V0dGluZ3MKCQkvLyBXQVJOSU5HLCBNQUtFIFNVUkUgWU9VUidSRSBIQVBQWSBXSVRIIEFMTCBTRVRUSU5HUyAKCQkvLyBCRUZPUkUgTE9DS0lORwoKCQlpZiAocVN0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpIHsKCQkJU3RhdEV2ZW50KCJMb2NraW5nISIpOwoJCQlyZXR1cm47CgkJfQoKCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudDsKCgkJcm1HYXMgPSAxMDAwMDA7IC8vIHJlbXVuZXJhdGlvbiBnYXMKCQlyd0dhcyA9IDEwMDAwOyAvLyByZXdhcmQgZ2FzCgkJcmZHYXMgPSAxMDAwMDsgLy8gcmVmdW5kIGdhcwoKCgkJLy8gemVybyBvdXQgYWxsIHRva2VuIGhvbGRlcnMuICAKCQkvLyBsZWF2ZSBhbGxvY2VkIG9uLCBsZWF2ZSBudW0gYWNjb3VudHMKCQkvLyBjYW50IGRlbGV0ZSB0aGVtIGFueXdheXMKCQoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCA+IDApIHsKCQkJZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtQWNjb3VudHM7IGkrKyApIHsKCQkJCWFkZHJlc3MgYSA9IGhvbGRlckluZGV4ZXNbaV07CgkJCQlpZiAoYSAhPSBhZGRyZXNzKDApKSB7CgkJCQkJaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zID0gMDsKCQkJCQlob2xkZXJBY2NvdW50c1thXS5iYWxhbmNlID0gMDsKCQkJCX0KCQkJfQoJCX0KCQkvLyBkbyBub3QgcmVzZXQgbnVtQWNjb3VudHMhCgoJCXRvdGFsVG9rZW5zTWludGVkID0gMDsgLy8gdGhpcyB3aWxsIGVyYXNlCgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgPSAwOyAvLyB0aGlzIHdpbGwgZXJhc2UuCgkJcGFydG5lckNyZWRpdHMgPSAwOyAvLyByZXNldCBhbGwgcGFydG5lciBjcmVkaXRzCgoJCWZ1bmRpbmdTdGFydCA9ICBfc2FsZVN0YXJ0OwoJCWZ1bmRpbmdEZWFkbGluZSA9IF9zYWxlRW5kOwoJCXVzYWdlRGVhZGxpbmUgPSBfdXNhZ2VFbmQ7CgkJbWluVXNhZ2VHb2FsID0gX21pblVzYWdlOwoJCW1pbkljb1Rva2VuR29hbCA9IF90b2tHb2FsOwoJCW1heE1pbnRhYmxlVG9rZW5zID0gX21heE1pbnRhYmxlOwoJCXRva2VuUHJpY2UgPSBfcHJpY2U7CgoJCXZlc3RUaW1lID0gZnVuZGluZ1N0YXJ0ICsgKDM2NSBkYXlzKTsKCQludW1EZXZUb2tlbnMgPSAwOwoJCQoJCWhvbGRvdmVyQmFsYW5jZSA9IDA7CgkJcGF5b3V0QmFsYW5jZSA9IDA7CgkJY3VyUGF5b3V0SWQgPSAxOwoJCWxhc3RQYXlvdXRJbmRleCA9IDA7CgkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAwOwoJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAwOwoJCWF1eFBhcnRuZXJCYWxhbmNlID0gMDsKCQlkZXZlbG9wZXJzR3JhbnRlZCA9IGZhbHNlOwoJCWxhc3RQYXlvdXRUaW1lID0gMDsKCgkJaWYgKHRoaXMuYmFsYW5jZSA+IDApIHsKCQkJaWYgKCFvd25lci5jYWxsLmdhcyhyZkdhcykudmFsdWUodGhpcy5iYWxhbmNlKSgpKQoJCQkJU3RhdEV2ZW50KCJFUlJPUiEiKTsKCQl9CgkJU3RhdEV2ZW50KCJvayIpOwoKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyB0b2tlbnMgaGVsZCByZXNlcnZlIHRoZSB0b3AgdHdvIGJ5dGVzIGZvciB0aGUgcGF5aWQgbGFzdCBwYWlkLgoJLy8gdGhpcyBpcyBzbyBob2xkZXJzIGF0IHRoZSB0b3Agb2YgdGhlIGxpc3QgZG9udCB0cmFuc2ZlciB0b2tlbnMgCgkvLyB0byB0aGVtc2VsdmVzIG9uIHRoZSBib3R0b20gb2YgdGhlIGxpc3QgdGh1cyBzY2FtbWluZyB0aGUgCgkvLyBzeXN0ZW0uIHRoaXMgZnVuY3Rpb24gZGVjb25zdHJ1Y3RzIHRoZSB0b2tlbmhlbGQgdmFsdWUuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldFBheUlkQW5kSGVsZCh1aW50IF90b2tIZWxkKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9wYXlJZCwgdWludCBfaGVsZCkKCXsKCQlfcGF5SWQgPSAoX3Rva0hlbGQgLyAoMiAqKiA0OCkpICYgMHhmZmZmOwoJCV9oZWxkID0gX3Rva0hlbGQgJiAweGZmZmZmZmZmZmZmZjsKCX0KCWZ1bmN0aW9uIGdldEhlbGQodWludCBfdG9rSGVsZCkgaW50ZXJuYWwgIHJldHVybnMgKHVpbnQgX2hlbGQpCgl7CgkJX2hlbGQgPSBfdG9rSGVsZCAmIDB4ZmZmZmZmZmZmZmZmOwoJfQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBhbGxvY2F0ZSBhIG5ldyBhY2NvdW50IGJ5IHNldHRpbmcgYWxsb2MgdG8gdHJ1ZQoJLy8gc2V0IHRoZSB0b3AgdG8gYnl0ZXMgb2YgdG9rZW5zIHRvIGN1ciBwYXkgaWQgdG8gbGVhdmUgb3V0IG9mIGN1cnJlbnQgcm91bmQKCS8vIGFkZCBob2xkZXIgaW5kZXgsIGJ1bXAgdGhlIG51bSBhY2NvdW50cwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhZGRBY2NvdW50KGFkZHJlc3MgX2FkZHIpIGludGVybmFsICB7CgkJaG9sZGVyQWNjb3VudHNbX2FkZHJdLmFsbG9jZWQgPSB0cnVlOwoJCWhvbGRlckFjY291bnRzW19hZGRyXS50b2tlbnMgPSAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoJCWhvbGRlckluZGV4ZXNbbnVtQWNjb3VudHMrK10gPSBfYWRkcjsKCX0KCQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQkVHSU4gRVJDLTIwIGZyb20gU3RhbmRhcmRUb2tlbgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkKCXsKCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuCgkJCXx8IGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudCkKCQkJc3VwcGx5ID0gbWF4TWludGFibGVUb2tlbnM7CgkJZWxzZQoJCQlzdXBwbHkgPSB0b3RhbFRva2Vuc01pbnRlZDsKCX0KCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKCQlpZiAoKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVycykgCgkJCSYmICAobm93IDwgdmVzdFRpbWUpKSB7CgkJCS8vc3RhdEV2ZW50KCJUb2tlbnMgbm90IHlldCB2ZXN0ZWQuIik7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoKCSAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuCgkgICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuCgkgICAgICAgIC8vUmVwbGFjZSB0aGUgaWYgd2l0aCB0aGlzIG9uZSBpbnN0ZWFkLgoJICAgICAgICAvL2lmIChob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGhvbGRlckFjY291bnRzW190b10pIHsKCgkJdmFyIChwaWRGcm9tLCBoZWxkRnJvbSkgPSBnZXRQYXlJZEFuZEhlbGQoaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zKTsKCSAgICAgICAgaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CgoJICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zIC09IF92YWx1ZTsKCgkJICAgIGlmICghaG9sZGVyQWNjb3VudHNbX3RvXS5hbGxvY2VkKSB7CgkJCWFkZEFjY291bnQoX3RvKTsKCQkgICAgfQoKCQkgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7CgkJICAgIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4pIC8vIGF2b2lkIG1jZ2VlcyBnYW1iaXQKCQkgICAgCXBpZEZyb20gPSBjdXJQYXlvdXRJZDsKCQkgICAgaG9sZGVyQWNjb3VudHNbX3RvXS50b2tlbnMgPSBuZXdIZWxkIHwgKHBpZEZyb20gKiAoMiAqKiA0OCkpOwoKCSAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9IGVsc2UgeyAKCQkJcmV0dXJuIGZhbHNlOyAKCQl9CiAgICAJfQoKICAgIAlmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCgkJaWYgKChfZnJvbSA9PSBkZXZlbG9wZXJzKSAKCQkJJiYgIChub3cgPCB2ZXN0VGltZSkpIHsKCQkJLy9zdGF0RXZlbnQoIlRva2VucyBub3QgeWV0IHZlc3RlZC4iKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4KICAgICAgICAvL2lmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewoKCQl2YXIgKHBpZEZyb20sIGhlbGRGcm9tKSA9IGdldFBheUlkQW5kSGVsZChob2xkZXJBY2NvdW50c1tfZnJvbV0udG9rZW5zKTsKICAgICAgICAJaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewoJICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbX2Zyb21dLnRva2VucyAtPSBfdmFsdWU7CgoJCSAgICBpZiAoIWhvbGRlckFjY291bnRzW190b10uYWxsb2NlZCkKCQkJYWRkQWNjb3VudChfdG8pOwoKCQkgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7CgoJCSAgICBpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuKSAvLyBhdm9pZCBtY2dlZXMgZ2FtYml0CgkJICAgIAlwaWRGcm9tID0gY3VyUGF5b3V0SWQ7CgkJICAgIGhvbGRlckFjY291bnRzW190b10udG9rZW5zID0gbmV3SGVsZCB8IChwaWRGcm9tICogKDIgKiogNDgpKTsKCgkgICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkgICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0gZWxzZSB7IAoJCSAgICByZXR1cm4gZmFsc2U7IAoJCX0KCX0KCgogICAgCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CgkJLy8gdmFycyBkZWZhdWx0IHRvIDAKCQlpZiAoaG9sZGVyQWNjb3VudHNbX293bmVyXS5hbGxvY2VkKSB7CgkgICAgICAgIAliYWxhbmNlID0gZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfb3duZXJdLnRva2Vucyk7CgkJfSAKICAgIAl9CgogICAgCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIAlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICAJQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgCXJldHVybiB0cnVlOwogICAgCX0KCiAgICAJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAJCXJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBFTkQgRVJDMjAKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAKCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGRlZmF1bHQgcGF5YWJsZSBmdW5jdGlvbi4KCS8vIGlmIHNlbmRlciBpcyBlNHJvdyAgcGFydG5lciwgdGhpcyBpcyBhIHJha2UgZmVlIHBheW1lbnQKCS8vIG90aGVyd2lzZSB0aGlzIGlzIGEgdG9rZW4gcHVyY2hhc2UuCgkvLyB0b2tlbnMgb25seSBwdXJjaGFzZWFibGUgYmV0d2VlbiB0b2tlbmZ1bmRpbmdzdGFydCBhbmQgZW5kCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiAoKSBwYXlhYmxlIHsKCQlpZiAobXNnLnNlbmRlciA9PSBlNF9wYXJ0bmVyKSB7CgkJICAgICBmZWVQYXltZW50KCk7IC8vIGZyb20gZTRyb3cgZ2FtZSBlc2Nyb3cgY29udHJhY3QKCQl9IGVsc2UgewoJCSAgICAgcHVyY2hhc2VUb2tlbigpOwoJCX0KCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcHVyY2hhc2UgdG9rZW4gZnVuY3Rpb24gLSB0b2tlbnMgb25seSBzb2xkIGR1cmluZyBzYWxlIHBlcmlvZCB1cCB1bnRpbCB0aGUgbWF4IHRva2VucwoJLy8gcHVyY2hhc2UgcHJpY2UgaXMgdG9rZW5QcmljZS4gIGFsbCB1bml0cyBpbiB3ZWkuCgkvLyBwdXJjaGFzZXIgd2lsbCBub3QgYmUgaW5jbHVkZWQgaW4gY3VycmVudCBwYXkgcnVuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gcHVyY2hhc2VUb2tlbigpIHBheWFibGUgewoKCQl1aW50IG52YWx1ZSA9IG1zZy52YWx1ZTsgLy8gYmVpbmcgY2FyZWZ1bCB0byBwcmVzZXJ2ZSBtc2cudmFsdWUKCQlhZGRyZXNzIG5wdXJjaGFzZXIgPSBtc2cuc2VuZGVyOwoJCWlmIChudmFsdWUgPCB0b2tlblByaWNlKSAKCQkJdGhyb3c7CgoJCXVpbnQgcXR5ID0gbnZhbHVlL3Rva2VuUHJpY2U7CgkJdXBkYXRlSWNvU3RhdHVzKCk7CgkJaWYgKGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbikgLy8gcHVyY2hhc2UgaXMgY2xvc2VkCgkJCXRocm93OwoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCArIHF0eSA+IG1heE1pbnRhYmxlVG9rZW5zKQoJCQl0aHJvdzsKCQlpZiAoIWhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLmFsbG9jZWQpCgkJCWFkZEFjY291bnQobnB1cmNoYXNlcik7CgkJCgkJLy8gcHVyY2hhc2VyIHdhaXRzIGZvciBuZXh0IHBheXJ1bi4gb3RoZXJ3aXNlIGNhbiBkaXNydXB0IGN1ciBwYXkgcnVuCgkJdWludCBuZXdIZWxkID0gcXR5ICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tucHVyY2hhc2VyXS50b2tlbnMpOwoJCWhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLnRva2VucyA9IG5ld0hlbGQgfCAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoKCQl0b3RhbFRva2Vuc01pbnRlZCArPSBxdHk7CgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgKz0gbnZhbHVlOwoKCQlpZiAodG90YWxUb2tlbnNNaW50ZWQgPT0gbWF4TWludGFibGVUb2tlbnMpIHsKCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZDsKCQkJLy90ZXN0IHVubmVjZXNzYXJ5IC0gIGlmIChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCWRvRGV2ZWxvcGVyR3JhbnQoKTsKCQkJU3RhdEV2ZW50SSgiUHVyY2hhc2VkLEdyYW50ZWQiLCBxdHkpOwoJCX0gZWxzZQoJCQlTdGF0RXZlbnRJKCJQdXJjaGFzZWQiLCBxdHkpOwoKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBhY2NlcHQgcGF5bWVudCBmcm9tIGU0cm93IGNvbnRyYWN0CgkvLyBETyBOT1QgQ0FMTCBUSElTIEZVTkNUSU9OIExFU1QgWU9VIExPU0UgWU9VUiBNT05FWQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmZWVQYXltZW50KCkgcGF5YWJsZSAgCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gZTRfcGFydG5lcikgewoJCQlTdGF0RXZlbnQoImZvcmJpZGRlbiIpOwoJCQlyZXR1cm47IC8vIHRoYW5rIHlvdQoJCX0KCQl1aW50IG5mdmFsdWUgPSBtc2cudmFsdWU7IC8vIHByZXNlcnZlIHZhbHVlIGluIGNhc2UgY2hhbmdlZCBpbiBkZXYgZ3JhbnQKCgkJdXBkYXRlSWNvU3RhdHVzKCk7CgoJCWhvbGRvdmVyQmFsYW5jZSArPSBuZnZhbHVlOwoJCXBhcnRuZXJDcmVkaXRzICs9IG5mdmFsdWU7CgkJU3RhdEV2ZW50SSgiUGF5bWVudCIsIG5mdmFsdWUpOwoKCQlpZiAoaG9sZG92ZXJCYWxhbmNlID4gcGF5b3V0VGhyZXNob2xkCgkJCXx8IHBheW91dEJhbGFuY2UgPiAwKQoJCQlkb1BheW91dChtYXhQYXlzUGVyKTsKCQkKCQoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gc2V0IHRoZSBlNHJvdyBwYXJ0bmVyLCB0aGlzIGlzIG9ubHkgZG9uZSBvbmNlCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHNldEU0Um93UGFydG5lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMJCgl7CgkvLyBPTkxZIG93bmVyIGNhbiBzZXQgYW5kIE9OTFkgT05DRSEgKHVubGVzcyAidW5sb2NrZWQiIGRlYnVnKQoJLy8gb25jZSBpdHMgbG9ja2VkLiBPTkxZIE9OQ0UhCgkJaWYgKG1zZy5zZW5kZXIgPT0gb3duZXIpIHsKCQkJaWYgKChlNF9wYXJ0bmVyID09IGFkZHJlc3MoMCkpIHx8IChzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmRlYnVnKSkgewoJCQkJZTRfcGFydG5lciA9IF9hZGRyOwoJCQkJcGFydG5lckNyZWRpdHMgPSAwOwoJCQkJLy9TdGF0RXZlbnRJKCJFNC1TZXQiLCAwKTsKCQkJfSBlbHNlIHsKCQkJCVN0YXRFdmVudCgiQWxyZWFkeSBTZXQiKTsKCQkJfQoJCX0KCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyByZXR1cm4gdGhlIHRvdGFsIHRva2VucyBwdXJjaGFzZWQKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldE51bVRva2Vuc1B1cmNoYXNlZCgpIGNvbnN0YW50IHJldHVybnModWludCBfcHVyY2hhc2VkKQoJewoJCV9wdXJjaGFzZWQgPSB0b3RhbFRva2Vuc01pbnRlZC1udW1EZXZUb2tlbnM7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcmV0dXJuIHRoZSBudW0gZ2FtZXMgYXMgcmVwb3J0ZWQgZnJvbSB0aGUgZTRyb3cgIGNvbnRyYWN0CgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXROdW1HYW1lcygpIGNvbnN0YW50IHJldHVybnModWludCBfZ2FtZXMpCgl7CgkJLy9fZ2FtZXMgPSAwOwoJCWlmIChlNF9wYXJ0bmVyICE9IGFkZHJlc3MoMCkpIHsKCQkJaUU0Um93RXNjcm93IHBlNCA9IGlFNFJvd0VzY3JvdyhlNF9wYXJ0bmVyKTsKCQkJX2dhbWVzID0gdWludChwZTQuZ2V0TnVtR2FtZXNTdGFydGVkKCkpOwoJCX0gCgkJLy9lbHNlCgkJLy9TdGF0RXZlbnQoIkVtcHR5IEU0Iik7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBnZXQgdGhlIGZvdW5kZXJzLCBhdXhQYXJ0bmVyLCBkZXZlbG9wZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXRTcGVjaWFsQWRkcmVzc2VzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBfZm5kciwgYWRkcmVzcyBfYXV4LCBhZGRyZXNzIF9kZXYsIGFkZHJlc3MgX2U0KQoJewoJCS8vaWYgKF9zZW5kZXIgPT0gb3duZXIpIHsgLy8gbm8gbXNnLnNlbmRlciBvbiBjb25zdGFudCBmdW5jdGlvbnMgYXQgbGVhc3QgaW4gbWV3CgkJCV9mbmRyID0gZm91bmRlck9yZzsKCQkJX2F1eCA9IGF1eFBhcnRuZXI7CgkJCV9kZXYgPSBkZXZlbG9wZXJzOwoJCQlfZTQgID0gZTRfcGFydG5lcjsKCQkvL30KCX0KCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHVwZGF0ZSB0aGUgaWNvIHN0YXR1cwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gdXBkYXRlSWNvU3RhdHVzKCkgcHVibGljCgl7CgkJaWYgKGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5zdWNjZWVkZWQgCgkJCXx8IGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQpCgkJCXJldHVybjsKCQllbHNlIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuYW5vdW5jZW1lbnQpIHsKCQkJaWYgKG5vdyA+IGZ1bmRpbmdTdGFydCAmJiBub3cgPD0gZnVuZGluZ0RlYWRsaW5lKSB7CgkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbjsKCQkJCQoJCQl9IGVsc2UgaWYgKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSkgewoJCQkJLy8gc2hvdWxkIG5vdCBiZSBoZXJlIC0gdGhpcyB3aWxsIGV2ZW50dWFsbHkgZmFpbAoJCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZDsKCQkJfQoJCX0gZWxzZSB7CgkJCXVpbnQgbnVtUCA9IGdldE51bVRva2Vuc1B1cmNoYXNlZCgpOwoJCQl1aW50IG51bUcgPSBnZXROdW1HYW1lcygpOwoJCQlpZiAoKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSAmJiBudW1QIDwgbWluSWNvVG9rZW5Hb2FsKQoJCQkJfHwgKG5vdyA+IHVzYWdlRGVhZGxpbmUgJiYgbnVtRyA8IG1pblVzYWdlR29hbCkpIHsKCQkJCWljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLmZhaWxlZDsKCQkJfSBlbHNlIGlmICgobm93ID4gZnVuZGluZ0RlYWRsaW5lKSAvLyBkb250IHdhbnQgdG8gcHJldmVudCBtb3JlIHRva2VuIHNhbGVzCgkJCQkmJiAobnVtUCA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCQkmJiAobnVtRyA+PSBtaW5Vc2FnZUdvYWwpKSB7CgkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zdWNjZWVkZWQ7IC8vIGhvb3JheQoJCQl9CgkJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4KCQkJCSYmICgobnVtUCA+PSBtYXhNaW50YWJsZVRva2VucykKCQkJCXx8IChub3cgPiBmdW5kaW5nRGVhZGxpbmUpKSkgewoJCQkJCWljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLnNhbGVDbG9zZWQ7CgkJCQl9CgkJfQoKCQlpZiAoIWRldmVsb3BlcnNHcmFudGVkCgkJCSYmIGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbiAKCQkJJiYgaWNvU3RhdHVzICE9IEljb1N0YXR1c1ZhbHVlLmFub3VuY2VtZW50CgkJCSYmIGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkgewoJCQkJZG9EZXZlbG9wZXJHcmFudCgpOyAvLyBncmFudCB3aGVuZXZlciBzdGF0dXMgZ29lcyBmcm9tIG9wZW4gdG8gYW55dGhpbmcuLi4KCQl9CgoJCgl9CgoJCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyByZXF1ZXN0IHJlZnVuZC4gQ2FsbGVyIG11c3QgY2FsbCB0byByZXF1ZXN0IGFuZCByZWNlaXZlIHJlZnVuZCAKCS8vIFdBUk5JTkcgLSB3aXRoZHJhdyByZXdhcmRzL2RpdmlkZW5kcyBiZWZvcmUgY2FsbGluZy4KCS8vIFlPVSBIQVZFIEJFRU4gV0FSTkVECgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiByZXF1ZXN0UmVmdW5kKCkKCXsKCQlhZGRyZXNzIG5yZXF1ZXN0ZXIgPSBtc2cuc2VuZGVyOwoJCXVwZGF0ZUljb1N0YXR1cygpOwoKCQl1aW50IG50b2tlbnMgPSBnZXRIZWxkKGhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLnRva2Vucyk7CgkJaWYgKGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQpCgkJCVN0YXRFdmVudCgiTm8gUmVmdW5kIik7CgkJZWxzZSBpZiAobnRva2VucyA9PSAwKQoJCQlTdGF0RXZlbnQoIk5vIFRva2VucyIpOwoJCWVsc2UgewoJCQl1aW50IG5yZWZ1bmQgPSBudG9rZW5zICogdG9rZW5QcmljZTsKCQkJaWYgKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkKCQkJCW5yZWZ1bmQgLT0gKG5yZWZ1bmQgLzEwKTsgLy8gb25seSA5MCBwZXJjZW50IGIvYyAxMCBwZXJjZW50IHBheW91dAoKCQkJaWYgKCFob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS5hbGxvY2VkKSAKCQkJCWFkZEFjY291bnQoZGV2ZWxvcGVycyk7CgkJCWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucyArPSBudG9rZW5zOwoJCQlob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS50b2tlbnMgPSAwOwoJCQlpZiAoaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0uYmFsYW5jZSA+IDApIHsKCQkJCS8vIHNlZSBhYm92ZSB3YXJuaW5nISEKCQkJCWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLmJhbGFuY2UgKz0gaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0uYmFsYW5jZTsKCQkJCWhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLmJhbGFuY2UgPSAwOwoJCQl9CgoJCQlpZiAoIW5yZXF1ZXN0ZXIuY2FsbC5nYXMocmZHYXMpLnZhbHVlKG5yZWZ1bmQpKCkpCgkJCQl0aHJvdzsKCQkJLy9TdGF0RXZlbnRJKCJSZWZ1bmRlZCIsIG5yZWZ1bmQpOwoJCX0KCX0KCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcGF5b3V0IHJld2FyZHMgdG8gYWxsIHRva2VuIGhvbGRlcnMKCS8vIHVzZSBhIHNlY29uZCBob2xkaW5nIHZhcmlhYmxlIGNhbGxlZCBQYXlvdXRCYWxhbmNlIHRvIGRvIAoJLy8gdGhlIGFjdHVhbCBwYXlvdXQgZnJvbSBiL2MgdG9vIG11Y2ggZ2FzIHRvIGl0ZXJhdGUgdGhydSAKCS8vIGVhY2ggcGF5ZWUuIE9ubHkgc3RhcnQgYSBuZXcgcnVuIGF0IG1vc3Qgb25jZSBwZXIgIm1pbnBheWludGVydmFsIi4KCS8vIEl0cyBkb25lIGluIHJ1bnMgb2YgIl9udW1QYXlzIgoJLy8gd2UgdXNlIHNwZWNpYWwgY29kaW5nIGZvciB0aGUgaG9sZGVyQWNjb3VudHMgdG8gYXZvaWQgYSBoYWNrCgkvLyBvZiBnZXR0aW5nIHBhaWQgYXQgdGhlIHRvcCBvZiB0aGUgbGlzdCB0aGVuIHRyYW5zZmVyaW5nIHRva2VucwoJLy8gdG8gYW5vdGhlciBhZGRyZXNzIGF0IHRoZSBib3R0b20gb2YgdGhlIGxpc3QuCgkvLyBiZWNhdXNlIG9mIHRoYXQgZWFjaCBob2xkZXJBY2NvdW50cyBlbnRyeSBnZXRzIHRoZSBwYXlvdXRpZCBzdGFtcGVkIHVwb24gaXQgKHRvcCB0d28gYnl0ZXMpCgkvLyBhbHNvIGEgdG9rZW4gdHJhbnNmZXIgd2lsbCB0cmFuc2ZlciB0aGUgcGF5b3V0IGlkLgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBkb1BheW91dCh1aW50IF9udW1QYXlzKSAgaW50ZXJuYWwKCXsKCQlpZiAodG90YWxUb2tlbnNNaW50ZWQgPT0gMCkKCQkJcmV0dXJuOwoKCQlpZiAoKGhvbGRvdmVyQmFsYW5jZSA+IDApIAoJCQkmJiAocGF5b3V0QmFsYW5jZSA9PSAwKQoJCQkmJiAobm93ID4gKGxhc3RQYXlvdXRUaW1lK21pblBheUludGVydmFsKSkpIHsKCQkJLy8gc3RhcnQgYSBuZXcgcnVuCgkJCWN1clBheW91dElkKys7CgkJCWlmIChjdXJQYXlvdXRJZCA+PSAzMjc2OCkKCQkJCWN1clBheW91dElkID0gMTsKCQkJbGFzdFBheW91dFRpbWUgPSBub3c7CgkJCXBheW91dEJhbGFuY2UgPSBpbnQoaG9sZG92ZXJCYWxhbmNlKTsKCQkJcHJPcmlnUGF5b3V0QmFsID0gcGF5b3V0QmFsYW5jZTsKCQkJcHJPcmlnVG9rZW5zTWludCA9IHRvdGFsVG9rZW5zTWludGVkOwoJCQlob2xkb3ZlckJhbGFuY2UgPSAwOwoJCQlsYXN0UGF5b3V0SW5kZXggPSAwOwoJCQlTdGF0RXZlbnRJKCJTdGFydFJ1biIsIHVpbnQoY3VyUGF5b3V0SWQpKTsKCQl9IGVsc2UgaWYgKHBheW91dEJhbGFuY2UgPiAwKSB7CgkJCS8vIHdvcmsgZG93biB0aGUgcC5vLmIKCQkJdWludCBuQW1vdW50OwoJCQl1aW50IG5QZXJUb2tEaXN0cmliID0gdWludChwck9yaWdQYXlvdXRCYWwpL3ByT3JpZ1Rva2Vuc01pbnQ7CgkJCXVpbnQgcGFpZHMgPSAwOwoJCQl1aW50IGk7IC8vIGludGVudGlvbmFsCgkJCWZvciAoaSA9IGxhc3RQYXlvdXRJbmRleDsgKHBhaWRzIDwgX251bVBheXMpICYmIChpIDwgbnVtQWNjb3VudHMpICYmIChwYXlvdXRCYWxhbmNlID4gMCk7IGkrKyApIHsKCQkJCWFkZHJlc3MgYSA9IGhvbGRlckluZGV4ZXNbaV07CgkJCQlpZiAoYSA9PSBhZGRyZXNzKDApKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCQl2YXIgKHBpZCwgaGVsZCkgPSBnZXRQYXlJZEFuZEhlbGQoaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zKTsKCQkJCWlmICgoaGVsZCA+IDApICYmIChwaWQgIT0gY3VyUGF5b3V0SWQpKSB7CgkJCQkJbkFtb3VudCA9IG5QZXJUb2tEaXN0cmliICogaGVsZDsKCQkJCQlpZiAoaW50KG5BbW91bnQpIDw9IHBheW91dEJhbGFuY2UpewoJCQkJCQlob2xkZXJBY2NvdW50c1thXS5iYWxhbmNlICs9IG5BbW91bnQ7IAoJCQkJCQlob2xkZXJBY2NvdW50c1thXS50b2tlbnMgPSAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpIHwgaGVsZDsKCQkJCQkJcGF5b3V0QmFsYW5jZSAtPSBpbnQobkFtb3VudCk7CQkJCQkKCQkJCQkJcGFpZHMrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJbGFzdFBheW91dEluZGV4ID0gaTsKCQkJaWYgKGxhc3RQYXlvdXRJbmRleCA+PSBudW1BY2NvdW50cyB8fCBwYXlvdXRCYWxhbmNlIDw9IDApIHsKCQkJCWxhc3RQYXlvdXRJbmRleCA9IDA7CgkJCQlpZiAocGF5b3V0QmFsYW5jZSA+IDApCgkJCQkJaG9sZG92ZXJCYWxhbmNlICs9IHVpbnQocGF5b3V0QmFsYW5jZSk7Ly8gcHV0IGJhY2sgYW55IGxlZnRvdmVycwoJCQkJcGF5b3V0QmFsYW5jZSA9IDA7CgkJCQlTdGF0RXZlbnRJKCJSdW5Db21wbGV0ZSIsIHVpbnQocHJPcmlnUGF5b3V0QmFsKSApOwoKCQkJfSBlbHNlIHsKCQkJCVN0YXRFdmVudEkoIlBheVJ1biIsIHBhaWRzICk7CgkJCX0KCQl9CgkJCgl9CgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHNlbmRlciB3aXRoZHJhdyBlbnRpcmUgcmV3YXJkcy9kaXZpZGVuZHMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHdpdGhkcmF3RGl2aWRlbmRzKCkgcHVibGljIHJldHVybnMgKHVpbnQgX2Ftb3VudCkKCXsKCQlpZiAoaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA9PSAwKSB7IAoJCQkvL19hbW91bnQgPSAwOwoJCQlTdGF0RXZlbnQoIjAgQmFsYW5jZSIpOwoJCQlyZXR1cm47CgkJfSBlbHNlIHsKCQkJaWYgKChtc2cuc2VuZGVyID09IGRldmVsb3BlcnMpIAoJCQkJJiYgIChub3cgPCB2ZXN0VGltZSkpIHsKCQkJCS8vc3RhdEV2ZW50KCJUb2tlbnMgbm90IHlldCB2ZXN0ZWQuIik7CgkJCQkvL19hbW91bnQgPSAwOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlfYW1vdW50ID0gaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZTsgCgkJCWhvbGRlckFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPSAwOyAKCQkJaWYgKCFtc2cuc2VuZGVyLmNhbGwuZ2FzKHJ3R2FzKS52YWx1ZShfYW1vdW50KSgpKQoJCQkJdGhyb3c7CgkJCS8vU3RhdEV2ZW50SSgiUGFpZCIsIF9hbW91bnQpOwoJCgkJfQoKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzZXQgZ2FzIGZvciBvcGVyYXRpb25zCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBzZXRPcEdhcyh1aW50IF9ybSwgdWludCBfcmYsIHVpbnQgX3J3KQoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyICYmIG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVycykgewoJCQkvL1N0YXRFdmVudCgib25seSBvd25lciBjYWxscyIpOwoJCQlyZXR1cm47CgkJfSBlbHNlIHsKCQkJcm1HYXMgPSBfcm07CgkJCXJmR2FzID0gX3JmOwoJCQlyd0dhcyA9IF9ydzsKCQl9Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gZ2V0IGdhcyBmb3Igb3BlcmF0aW9ucwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0T3BHYXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IF9ybSwgdWludCBfcmYsIHVpbnQgX3J3KQoJewoJCV9ybSA9IHJtR2FzOwoJCV9yZiA9IHJmR2FzOwoJCV9ydyA9IHJ3R2FzOwoJfQogCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gY2hlY2sgcmV3YXJkcy4gIHBhc3MgaW4gYWRkcmVzcyBvZiB0b2tlbiBob2xkZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoZWNrRGl2aWRlbmRzKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IHJldHVybnModWludCBfYW1vdW50KQoJewoJCWlmIChob2xkZXJBY2NvdW50c1tfYWRkcl0uYWxsb2NlZCkKCQkJX2Ftb3VudCA9IGhvbGRlckFjY291bnRzW19hZGRyXS5iYWxhbmNlOwoJfQkJCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gaWNvQ2hlY2t1cCAtIGNoZWNrIHVwIGNhbGwgZm9yIGFkbWluaXN0cmF0b3JzCgkvLyBhZnRlciBzYWxlIGlzIGNsb3NlZCBpZiBtaW4gaWNvIHRva2VucyBzb2xkLCAxMCBwZXJjZW50IHdpbGwgYmUgZGlzdHJpYnV0ZWQgdG8gCgkvLyBjb21wYW55IHRvIGNvdmVyIHZhcmlvdXMgb3BlcmF0aW5nIGV4cGVuc2VzCgkvLyBhZnRlciBzYWxlIGFuZCB1c2FnZSBkZWFsaW5lcyBoYXZlIGJlZW4gbWV0LCByZW1haW5pbmcgOTAgcGVyY2VudCB3aWxsIGJlIGRpc3RyaWJ1dGVkIHRvCgkvLyBjb21wYW55LgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBpY29DaGVja3VwKCkgcHVibGljCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgbXNnLnNlbmRlciAhPSBkZXZlbG9wZXJzKQoJCQl0aHJvdzsKCgkJdWludCBubXNnbWFzazsKCQkvL25tc2dtYXNrID0gMDsKCQoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZCkgewoJCQlpZiAoKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkKCQkJCSYmIChyZW11bmVyYXRpb25TdGFnZSA9PSAwICkpIHsKCQkJCXJlbXVuZXJhdGlvblN0YWdlID0gMTsKCQkJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKSo5OyAvLyA5IHBlcmNlbnQKCQkJCWF1eFBhcnRuZXJCYWxhbmNlID0gICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApOyAvLyAxIHBlcmNlbnQKCQkJCW5tc2dtYXNrIHw9IDE7CgkJCX0gCgkJfQoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkKSB7CgkJCgkJCWlmIChyZW11bmVyYXRpb25TdGFnZSA9PSAwICkgewoJCQkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAxOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9ICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApKjk7IAoJCQkJYXV4UGFydG5lckJhbGFuY2UgPSAgKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwMCk7CgkJCQlubXNnbWFzayB8PSA0OwoJCQl9CgkJCWlmIChyZW11bmVyYXRpb25TdGFnZSA9PSAxKSB7IC8vIHdlIGhhdmUgYWxyZWFkeSBzdWNlZWRlZAoJCQkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAyOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSArPSB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZCAtICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMCk7IC8vIDkwIHBlcmNlbnQKCQkJCW5tc2dtYXNrIHw9IDg7CgkJCX0KCgkJfQoKCQl1aW50IG50bXA7CgoJCWlmIChyZW11bmVyYXRpb25CYWxhbmNlID4gMCkgeyAKCQkvLyBvbmx5IHBheSBvbmUgZW50aXR5IHBlciBjYWxsLCBkb250IHdhbnQgdG8gcnVuIG91dCBvZiBnYXMKCQkJCW50bXAgPSByZW11bmVyYXRpb25CYWxhbmNlOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9IDA7CgkJCQlpZiAoIWZvdW5kZXJPcmcuY2FsbC5nYXMocm1HYXMpLnZhbHVlKG50bXApKCkpIHsKCQkJCQlyZW11bmVyYXRpb25CYWxhbmNlID0gbnRtcDsKCQkJCQlubXNnbWFzayB8PSAzMjsKCQkJCX0gZWxzZSB7CgkJCQkJbm1zZ21hc2sgfD0gNjQ7CgkJCQl9CQoJCX0gZWxzZSAJaWYgKGF1eFBhcnRuZXJCYWxhbmNlID4gMCkgewoJCS8vIG5vdGUgdGhlICJlbHNlIiBvbmx5IHBheSBvbmUgZW50aXR5IHBlciBjYWxsLCBkb250IHdhbnQgdG8gcnVuIG91dCBvZiBnYXMKCQkJbnRtcCA9IGF1eFBhcnRuZXJCYWxhbmNlOwoJCQlhdXhQYXJ0bmVyQmFsYW5jZSA9IDA7CgkJCWlmICghYXV4UGFydG5lci5jYWxsLmdhcyhybUdhcykudmFsdWUobnRtcCkoKSkgewoJCQkJYXV4UGFydG5lckJhbGFuY2UgPSBudG1wOwoJCQkJbm1zZ21hc2sgfD0gMTI4OwoJCQl9ICBlbHNlIHsKCQkJCW5tc2dtYXNrIHw9IDI1NjsKCQkJfQoKCQl9IAoJCQoJCVN0YXRFdmVudEkoImljby1jaGVja3VwIiwgbm1zZ21hc2spOwoJfQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzd2FwIGV4ZWN1dG9yCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9hZGRyKSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCgkJb3duZXIgPSBfYWRkcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzd2FwIGRldmVsb3BlcnMgYWNjb3VudAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hhbmdlRGV2ZXZvcGVyQWNjb250KGFkZHJlc3MgX2FkZHIpIAoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyCgkJCXx8IHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJIHRocm93OwoJCWRldmVsb3BlcnMgPSBfYWRkcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBjaGFuZ2UgZm91bmRlcgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hhbmdlRm91bmRlcihhZGRyZXNzIF9hZGRyKSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCQlmb3VuZGVyT3JnID0gX2FkZHI7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gY2hhbmdlIGF1eFBhcnRuZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoYW5nZUF1eFBhcnRuZXIoYWRkcmVzcyBfYXV4KSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCQlhdXhQYXJ0bmVyID0gX2F1eDsKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gREVCVUcgT05MWSAtIGVuZCB0aGlzIGNvbnRyYWN0LCBzdWljaWRlIHRvIGRldmVsb3BlcnMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGhhcmFLaXJpKCkKCXsKCQlpZiAoc2V0dGluZ3NTdGF0ZSAhPSBTZXR0aW5nU3RhdGVWYWx1ZS5kZWJ1ZykKCQkJdGhyb3c7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpCgkJCSB0aHJvdzsKCQlzdWljaWRlKGRldmVsb3BlcnMpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGdldCBhbGwgaWNvIHN0YXR1cywgZnVuZGluZyBhbmQgdXNhZ2UgaW5mbwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0SWNvSW5mbygpIGNvbnN0YW50IHJldHVybnMoSWNvU3RhdHVzVmFsdWUgX3N0YXR1cywgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfc2FsZUdvYWwsIHVpbnQgX3VzYWdlR29hbCwgdWludCBfc29sZCwgdWludCBfdXNlZCwgdWludCBfZnVuZHMsIHVpbnQgX2NyZWRpdHMsIHVpbnQgX3JlbXVTdGFnZSwgdWludCBfdmVzdCkKCXsKCQlfc3RhdHVzID0gaWNvU3RhdHVzOwoJCV9zYWxlU3RhcnQgPSBmdW5kaW5nU3RhcnQ7CgkJX3NhbGVFbmQgPSBmdW5kaW5nRGVhZGxpbmU7CgkJX3VzYWdlRW5kID0gdXNhZ2VEZWFkbGluZTsKCQlfdmVzdCA9IHZlc3RUaW1lOwoJCV9zYWxlR29hbCA9IG1pbkljb1Rva2VuR29hbDsKCQlfdXNhZ2VHb2FsID0gbWluVXNhZ2VHb2FsOwoJCV9zb2xkID0gZ2V0TnVtVG9rZW5zUHVyY2hhc2VkKCk7CgkJX3VzZWQgPSBnZXROdW1HYW1lcygpOwoJCV9mdW5kcyA9IHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkOwoJCV9jcmVkaXRzID0gcGFydG5lckNyZWRpdHM7CgkJX3JlbXVTdGFnZSA9IHJlbXVuZXJhdGlvblN0YWdlOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIE5PVEUhIENBTEwgQVQgVEhFIFJJU0sgT0YgUlVOTklORyBPVVQgT0YgR0FTLgoJLy8gQU5ZT05FIENBTiBDQUxMIFRISVMgRlVOQ1RJT04gQlVUIFlPVSBIQVZFIFRPIFNVUFBMWSAKCS8vIFRIRSBDT1JSRUNUIEFNT1VOVCBPRiBHQVMgV0hJQ0ggTUFZIERFUEVORCBPTiAKCS8vIFRIRSBfTlVNUEFZUyBQQVJBTUVURVIuICBXSElDSCBNVVNUIEJFIEJFVFdFRU4gMSBBTkQgMTAwMAoJLy8gVEhFIFNUQU5EQVJEIFZBTFVFIElTIFNUT1JFRCBJTiAibWF4UGF5c1BlciIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGZsdXNoRGl2aWRlbmRzKHVpbnQgX251bVBheXMpCgl7CgkJaWYgKChfbnVtUGF5cyA9PSAwKSB8fCAoX251bVBheXMgPiAxMDAwKSkgewoJCQlTdGF0RXZlbnQoIkludmFsaWQuIik7CgkJfSBlbHNlIGlmIChob2xkb3ZlckJhbGFuY2UgPiAwIHx8IHBheW91dEJhbGFuY2UgPiAwKSB7CgkJCWRvUGF5b3V0KF9udW1QYXlzKTsKCQl9IGVsc2UgewoJCQlTdGF0RXZlbnQoIk5vdGhpbmcgdG8gZG8uIik7CgkJfQoJCQkJCgl9CgoJZnVuY3Rpb24gZG9EZXZlbG9wZXJHcmFudCgpIGludGVybmFsCgl7CgkJaWYgKCFkZXZlbG9wZXJzR3JhbnRlZCkgewoJCQlkZXZlbG9wZXJzR3JhbnRlZCA9IHRydWU7CgkJCW51bURldlRva2VucyA9ICh0b3RhbFRva2Vuc01pbnRlZCAqIDE1KS8xMDA7CgkJCXRvdGFsVG9rZW5zTWludGVkICs9IG51bURldlRva2VuczsKCQkJaWYgKCFob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS5hbGxvY2VkKSAKCQkJCWFkZEFjY291bnQoZGV2ZWxvcGVycyk7CgkJCXVpbnQgbmV3SGVsZCA9IGdldEhlbGQoaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10udG9rZW5zKSArIG51bURldlRva2VuczsKCQkJaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10udG9rZW5zID0gbmV3SGVsZCB8ICAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoKCQl9Cgl9CgoKfQ=='.
	

]
