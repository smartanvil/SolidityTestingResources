Class {
	#name : #SRT5dbd2e33f4aceeefba9d7d542913ba3e82216b7b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5dbd2e33f4aceeefba9d7d542913ba3e82216b7b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IE5vbi1GdW5naWJsZSBUb2tlbnMKLy8vIEBhdXRob3IgRGlldGVyIFNoaXJsZXkgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMTE3NTc0NjU3NDUxNzA2OTc4N2U3YzZiNzQ3ZjNmNzI3ZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKY29udHJhY3QgRVJDNzIxIHsKICAgIC8vIFJlcXVpcmVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgICAqIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgfQogICAgfQoKfQoKCgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIGV2ZW50IFBhdXNlKCk7CiAgICBldmVudCBVbnBhdXNlKCk7CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgICovCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCgoKCgovLy8gQHRpdGxlIEF1Y3Rpb24gQ29yZQovLy8gQGRldiBDb250YWlucyBtb2RlbHMsIHZhcmlhYmxlcywgYW5kIGludGVybmFsIG1ldGhvZHMgZm9yIHRoZSBhdWN0aW9uLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvbiBhbiBORlQKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgIC8vIEN1cnJlbnQgb3duZXIgb2YgTkZUCiAgICBhZGRyZXNzIHNlbGxlcjsKICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uCiAgICB1aW50MTI4IHN0YXJ0aW5nUHJpY2U7CiAgICAvLyBQcmljZSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbgogICAgdWludDEyOCBlbmRpbmdQcmljZTsKICAgIC8vIER1cmF0aW9uIChpbiBzZWNvbmRzKSBvZiBhdWN0aW9uCiAgICB1aW50NjQgZHVyYXRpb247CiAgICAvLyBUaW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAvLyBOT1RFOiAwIGlmIHRoaXMgYXVjdGlvbiBoYXMgYmVlbiBjb25jbHVkZWQKICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CgogICAgLy8gUmVmZXJlbmNlIHRvIGNvbnRyYWN0IHRyYWNraW5nIE5GVCBvd25lcnNoaXAKICAgIEVSQzcyMSBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCiAgICAvLyBDdXQgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtZWFzdXJlZCBpbiBiYXNpcyBwb2ludHMgKDEvMTAwIG9mIGEgcGVyY2VudCkuCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICAgIHVpbnQyNTYgcHVibGljIG93bmVyQ3V0OwoKICAgIC8vIE1hcCBmcm9tIHRva2VuIElEIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgYXVjdGlvbi4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikgdG9rZW5JZFRvQXVjdGlvbjsKCiAgICBldmVudCBBdWN0aW9uQ3JlYXRlZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwgdWludDI1NiBlbmRpbmdQcmljZSwgdWludDI1NiBkdXJhdGlvbik7CiAgICBldmVudCBBdWN0aW9uU3VjY2Vzc2Z1bCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgdG90YWxQcmljZSwgYWRkcmVzcyB3aW5uZXIpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGxlZCh1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgY2xhaW1hbnQgb3ducyB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCAtIEFkZHJlc3MgY2xhaW1pbmcgdG8gb3duIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB3aG9zZSBvd25lcnNoaXAgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm9uRnVuZ2libGVDb250cmFjdC5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQpOwogICAgfQoKICAgIC8vLyBAZGV2IEVzY3Jvd3MgdGhlIE5GVCwgYXNzaWduaW5nIG93bmVyc2hpcCB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIFRocm93cyBpZiB0aGUgZXNjcm93IGZhaWxzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgLSBDdXJyZW50IG93bmVyIGFkZHJlc3Mgb2YgdG9rZW4gdG8gZXNjcm93LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIGFwcHJvdmFsIHRvIHZlcmlmeS4KICAgIGZ1bmN0aW9uIF9lc2Nyb3coYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBpdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlckZyb20oX293bmVyLCB0aGlzLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIGFuIE5GVCBvd25lZCBieSB0aGlzIGNvbnRyYWN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgIC8vLyBSZXR1cm5zIHRydWUgaWYgdGhlIHRyYW5zZmVyIHN1Y2NlZWRzLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXIgLSBBZGRyZXNzIHRvIHRyYW5zZmVyIE5GVCB0by4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyKF9yZWNlaXZlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFkZHMgYW4gYXVjdGlvbiB0byB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLiBBbHNvIGZpcmVzIHRoZQogICAgLy8vICBBdWN0aW9uQ3JlYXRlZCBldmVudC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSB0b2tlbiB0byBiZSBwdXQgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gQXVjdGlvbiB0byBhZGQuCiAgICBmdW5jdGlvbiBfYWRkQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBBdWN0aW9uIF9hdWN0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gUmVxdWlyZSB0aGF0IGFsbCBhdWN0aW9ucyBoYXZlIGEgZHVyYXRpb24gb2YKICAgICAgICAvLyBhdCBsZWFzdCBvbmUgbWludXRlLiAoS2VlcHMgb3VyIG1hdGggZnJvbSBnZXR0aW5nIGhhaXJ5ISkKICAgICAgICByZXF1aXJlKF9hdWN0aW9uLmR1cmF0aW9uID49IDEgbWludXRlcyk7CgogICAgICAgIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdID0gX2F1Y3Rpb247CgogICAgICAgIEF1Y3Rpb25DcmVhdGVkKAogICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSksCiAgICAgICAgdWludDI1NihfYXVjdGlvbi5lbmRpbmdQcmljZSksCiAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgIGludGVybmFsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgYXVjdGlvbiBzdHJ1Y3QKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwoKICAgICAgICAvLyBFeHBsaWNpdGx5IGNoZWNrIHRoYXQgdGhpcyBhdWN0aW9uIGlzIGN1cnJlbnRseSBsaXZlLgogICAgICAgIC8vIChCZWNhdXNlIG9mIGhvdyBFdGhlcmV1bSBtYXBwaW5ncyB3b3JrLCB3ZSBjYW4ndCBqdXN0IGNvdW50CiAgICAgICAgLy8gb24gdGhlIGxvb2t1cCBhYm92ZSBmYWlsaW5nLiBBbiBpbnZhbGlkIF90b2tlbklkIHdpbGwganVzdAogICAgICAgIC8vIHJldHVybiBhbiBhdWN0aW9uIG9iamVjdCB0aGF0IGlzIGFsbCB6ZXJvcy4pCiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBiaWQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBjdXJyZW50IHByaWNlCiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2VsbGVyIGJlZm9yZSB0aGUgYXVjdGlvbiBzdHJ1Y3QKICAgICAgICAvLyBnZXRzIGRlbGV0ZWQuCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKCiAgICAgICAgLy8gVGhlIGJpZCBpcyBnb29kISBSZW1vdmUgdGhlIGF1Y3Rpb24gYmVmb3JlIHNlbmRpbmcgdGhlIGZlZXMKICAgICAgICAvLyB0byB0aGUgc2VuZGVyIHNvIHdlIGNhbid0IGhhdmUgYSByZWVudHJhbmN5IGF0dGFjay4KICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHByb2NlZWRzIHRvIHNlbGxlciAoaWYgdGhlcmUgYXJlIGFueSEpCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGF1Y3Rpb25lZXIncyBjdXQuCiAgICAgICAgICAgIC8vIChOT1RFOiBfY29tcHV0ZUN1dCgpIGlzIGd1YXJhbnRlZWQgdG8gcmV0dXJuIGEKICAgICAgICAgICAgLy8gdmFsdWUgPD0gcHJpY2UsIHNvIHRoaXMgc3VidHJhY3Rpb24gY2FuJ3QgZ28gbmVnYXRpdmUuKQogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25lZXJDdXQgPSBfY29tcHV0ZUN1dChwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgc2VsbGVyUHJvY2VlZHMgPSBwcmljZSAtIGF1Y3Rpb25lZXJDdXQ7CgogICAgICAgICAgICAvLyBOT1RFOiBEb2luZyBhIHRyYW5zZmVyKCkgaW4gdGhlIG1pZGRsZSBvZiBhIGNvbXBsZXgKICAgICAgICAgICAgLy8gbWV0aG9kIGxpa2UgdGhpcyBpcyBnZW5lcmFsbHkgZGlzY291cmFnZWQgYmVjYXVzZSBvZgogICAgICAgICAgICAvLyByZWVudHJhbmN5IGF0dGFja3MgYW5kIERvUyBhdHRhY2tzIGlmIHRoZSBzZWxsZXIgaXMKICAgICAgICAgICAgLy8gYSBjb250cmFjdCB3aXRoIGFuIGludmFsaWQgZmFsbGJhY2sgZnVuY3Rpb24uIFdlIGV4cGxpY2l0bHkKICAgICAgICAgICAgLy8gZ3VhcmQgYWdhaW5zdCByZWVudHJhbmN5IGF0dGFja3MgYnkgcmVtb3ZpbmcgdGhlIGF1Y3Rpb24KICAgICAgICAgICAgLy8gYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIoKSwgYW5kIHRoZSBvbmx5IHRoaW5nIHRoZSBzZWxsZXIKICAgICAgICAgICAgLy8gY2FuIERvUyBpcyB0aGUgc2FsZSBvZiB0aGVpciBvd24gYXNzZXQhIChBbmQgaWYgaXQncyBhbgogICAgICAgICAgICAvLyBhY2NpZGVudCwgdGhleSBjYW4gY2FsbCBjYW5jZWxBdWN0aW9uKCkuICkKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfdG9rZW5JZCwgcHJpY2UsIG1zZy5zZW5kZXIpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhbiBhdWN0aW9uIGZyb20gdGhlIGxpc3Qgb2Ygb3BlbiBhdWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICBkZWxldGUgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBORlQgaXMgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gLSBBdWN0aW9uIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gX2lzT25BdWN0aW9uKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChfYXVjdGlvbi5zdGFydGVkQXQgPiAwKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGN1cnJlbnQgcHJpY2Ugb2YgYW4gTkZUIG9uIGF1Y3Rpb24uIEJyb2tlbiBpbnRvIHR3bwogICAgLy8vICBmdW5jdGlvbnMgKHRoaXMgb25lLCB0aGF0IGNvbXB1dGVzIHRoZSBkdXJhdGlvbiBmcm9tIHRoZSBhdWN0aW9uCiAgICAvLy8gIHN0cnVjdHVyZSwgYW5kIHRoZSBvdGhlciB0aGF0IGRvZXMgdGhlIHByaWNlIGNvbXB1dGF0aW9uKSBzbyB3ZQogICAgLy8vICBjYW4gZWFzaWx5IHRlc3QgdGhhdCB0aGUgcHJpY2UgY29tcHV0YXRpb24gd29ya3MgY29ycmVjdGx5LgogICAgZnVuY3Rpb24gX2N1cnJlbnRQcmljZShBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pCiAgICBpbnRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IHNlY29uZHNQYXNzZWQgPSAwOwoKICAgICAgICAvLyBBIGJpdCBvZiBpbnN1cmFuY2UgYWdhaW5zdCBuZWdhdGl2ZSB2YWx1ZXMgKG9yIHdyYXBhcm91bmQpLgogICAgICAgIC8vIFByb2JhYmx5IG5vdCBuZWNlc3NhcnkgKHNpbmNlIEV0aGVyZXVtIGd1YXJuYXRlZXMgdGhhdCB0aGUKICAgICAgICAvLyBub3cgdmFyaWFibGUgZG9lc24ndCBldmVyIGdvIGJhY2t3YXJkcykuCiAgICAgICAgaWYgKG5vdyA+IF9hdWN0aW9uLnN0YXJ0ZWRBdCkgewogICAgICAgICAgICBzZWNvbmRzUGFzc2VkID0gbm93IC0gX2F1Y3Rpb24uc3RhcnRlZEF0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgX2F1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgX2F1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgc2Vjb25kc1Bhc3NlZAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4gRmFjdG9yZWQgb3V0CiAgICAvLy8gIGZyb20gX2N1cnJlbnRQcmljZSBzbyB3ZSBjYW4gcnVuIGV4dGVuc2l2ZSB1bml0IHRlc3RzLgogICAgLy8vICBXaGVuIHRlc3RpbmcsIG1ha2UgdGhpcyBmdW5jdGlvbiBwdWJsaWMgYW5kIHR1cm4gb24KICAgIC8vLyAgYEN1cnJlbnQgcHJpY2UgY29tcHV0YXRpb25gIHRlc3Qgc3VpdGUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgdWludDI1NiBfc2Vjb25kc1Bhc3NlZAogICAgKQogICAgaW50ZXJuYWwKICAgIHB1cmUKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBwdWJsaWMgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICB0aW1lIChhdCA2NC1iaXRzKSBhbmQgY3VycmVuY3kgKGF0IDEyOC1iaXRzKS4gX2R1cmF0aW9uIGlzCiAgICAgICAgLy8gIGFsc28ga25vd24gdG8gYmUgbm9uLXplcm8gKHNlZSB0aGUgcmVxdWlyZSgpIHN0YXRlbWVudCBpbgogICAgICAgIC8vICBfYWRkQXVjdGlvbigpKQogICAgICAgIGlmIChfc2Vjb25kc1Bhc3NlZCA+PSBfZHVyYXRpb24pIHsKICAgICAgICAgICAgLy8gV2UndmUgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcG9ydGlvbgogICAgICAgICAgICAvLyBvZiB0aGUgYXVjdGlvbiwganVzdCByZXR1cm4gdGhlIGVuZCBwcmljZS4KICAgICAgICAgICAgcmV0dXJuIF9lbmRpbmdQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTdGFydGluZyBwcmljZSBjYW4gYmUgaGlnaGVyIHRoYW4gZW5kaW5nIHByaWNlIChhbmQgb2Z0ZW4gaXMhKSwgc28KICAgICAgICAgICAgLy8gdGhpcyBkZWx0YSBjYW4gYmUgbmVnYXRpdmUuCiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9lbmRpbmdQcmljZSkgLSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpOwoKICAgICAgICAgICAgLy8gVGhpcyBtdWx0aXBsaWNhdGlvbiBjYW4ndCBvdmVyZmxvdywgX3NlY29uZHNQYXNzZWQgd2lsbCBlYXNpbHkgZml0IHdpdGhpbgogICAgICAgICAgICAvLyA2NC1iaXRzLCBhbmQgdG90YWxQcmljZUNoYW5nZSB3aWxsIGVhc2lseSBmaXQgd2l0aGluIDEyOC1iaXRzLCB0aGVpciBwcm9kdWN0CiAgICAgICAgICAgIC8vIHdpbGwgYWx3YXlzIGZpdCB3aXRoaW4gMjU2LWJpdHMuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KF9zZWNvbmRzUGFzc2VkKSAvIGludDI1NihfZHVyYXRpb24pOwoKICAgICAgICAgICAgLy8gY3VycmVudFByaWNlQ2hhbmdlIGNhbiBiZSBuZWdhdGl2ZSwgYnV0IGlmIHNvLCB3aWxsIGhhdmUgYSBtYWduaXR1ZGUKICAgICAgICAgICAgLy8gbGVzcyB0aGF0IF9zdGFydGluZ1ByaWNlLiBUaHVzLCB0aGlzIHJlc3VsdCB3aWxsIGFsd2F5cyBlbmQgdXAgcG9zaXRpdmUuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwoKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgb3duZXIncyBjdXQgb2YgYSBzYWxlLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgLSBTYWxlIHByaWNlIG9mIE5GVC4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9Cgp9CgoKCgoKLy8vIEB0aXRsZSBDbG9jayBhdWN0aW9uIGZvciBub24tZnVuZ2libGUgdG9rZW5zLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbiBpcyBQYXVzYWJsZSwgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8vIEBkZXYgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPSBieXRlczQoMHg5YTIwNDgzZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgY3JlYXRlcyBhIHJlZmVyZW5jZSB0byB0aGUgTkZUIG93bmVyc2hpcCBjb250cmFjdAogICAgLy8vICBhbmQgdmVyaWZpZXMgdGhlIG93bmVyIGN1dCBpcyBpbiB0aGUgdmFsaWQgcmFuZ2UuCiAgICAvLy8gQHBhcmFtIF9uZnRBZGRyZXNzIC0gYWRkcmVzcyBvZiBhIGRlcGxveWVkIGNvbnRyYWN0IGltcGxlbWVudGluZwogICAgLy8vICB0aGUgTm9uZnVuZ2libGUgSW50ZXJmYWNlLgogICAgLy8vIEBwYXJhbSBfY3V0IC0gcGVyY2VudCBjdXQgdGhlIG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbXVzdCBiZQogICAgLy8vICBiZXR3ZWVuIDAtMTAsMDAwLgogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHJlc3MsIHVpbnQyNTYgX2N1dCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9jdXQgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKCiAgICAgICAgRVJDNzIxIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRVJDNzIxKF9uZnRBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0ID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlIGFsbCBFdGhlciBmcm9tIHRoZSBjb250cmFjdCwgd2hpY2ggaXMgdGhlIG93bmVyJ3MgY3V0cwogICAgLy8vICBhcyB3ZWxsIGFzIGFueSBFdGhlciBzZW50IGRpcmVjdGx5IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzLgogICAgLy8vICBBbHdheXMgdHJhbnNmZXJzIHRvIHRoZSBORlQgY29udHJhY3QsIGJ1dCBjYW4gYmUgY2FsbGVkIGVpdGhlciBieQogICAgLy8vICB0aGUgb3duZXIgb3IgdGhlIE5GVCBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIHsKICAgICAgICBhZGRyZXNzIG5mdEFkZHJlc3MgPSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpOwoKICAgICAgICByZXF1aXJlKAogICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICBtc2cuc2VuZGVyID09IG5mdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGlzIGJvb2xlYW4gbWV0aG9kIHRvIG1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgb25lIGZhaWxzIGl0IHdpbGwgc3RpbGwgd29yawogICAgICAgIG5mdEFkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcKICAgIC8vLyAgcHJpY2UgYW5kIGVuZGluZyBwcmljZSAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICB1aW50MjU2IF90b2tlbklkLAogICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgdWludDI1NiBfZHVyYXRpb24sCiAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICBfZXNjcm93KG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICBfc2VsbGVyLAogICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgfQoKICAgIC8vLyBAZGV2IEJpZHMgb24gYW4gb3BlbiBhdWN0aW9uLCBjb21wbGV0aW5nIHRoZSBhdWN0aW9uIGFuZCB0cmFuc2ZlcnJpbmcKICAgIC8vLyAgb3duZXJzaGlwIG9mIHRoZSBORlQgaWYgZW5vdWdoIEV0aGVyIGlzIHN1cHBsaWVkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIGJpZCBvbi4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBfYmlkIHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBvciBmdW5kcyB0cmFuc2ZlciBmYWlscwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gdGhhdCBoYXNuJ3QgYmVlbiB3b24geWV0LgogICAgLy8vICBSZXR1cm5zIHRoZSBORlQgdG8gb3JpZ2luYWwgb3duZXIuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIGEgc3RhdGUtbW9kaWZ5aW5nIGZ1bmN0aW9uIHRoYXQgY2FuCiAgICAvLy8gIGJlIGNhbGxlZCB3aGlsZSB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIG9uIGF1Y3Rpb24KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsbGVyKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgLy8vICBPbmx5IHRoZSBvd25lciBtYXkgZG8gdGhpcywgYW5kIE5GVHMgYXJlIHJldHVybmVkIHRvCiAgICAvLy8gIHRoZSBzZWxsZXIuIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiBlbWVyZ2VuY2llcy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0aGUgTkZUIG9uIGF1Y3Rpb24gdG8gY2FuY2VsLgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbldoZW5QYXVzZWQodWludDI1NiBfdG9rZW5JZCkKICAgIHdoZW5QYXVzZWQKICAgIG9ubHlPd25lcgogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbi5zZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXVjdGlvbiBpbmZvIGZvciBhbiBORlQgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zCiAgICAoCiAgICBhZGRyZXNzIHNlbGxlciwKICAgIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwKICAgIHVpbnQyNTYgZW5kaW5nUHJpY2UsCiAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgdWludDI1NiBzdGFydGVkQXQKICAgICkgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiAoCiAgICAgICAgYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgIGF1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSB0b2tlbiBwcmljZSB3ZSBhcmUgY2hlY2tpbmcuCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQoKfQoKLy8KY29udHJhY3QgR2VuZVNjaWVuY2UgewoKICAgIHVpbnQ2NCBfc2VlZCA9IDA7CgogICAgLy8vIEBkZXYgc2ltcGx5IGEgYm9vbGVhbiB0byBpbmRpY2F0ZSB0aGlzIGlzIHRoZSBjb250cmFjdCB3ZSBleHBlY3QgdG8gYmUKICAgIC8vLyBwdXJlIG1lYW5zICJ0aGV5IHByb21pc2Ugbm90IHRvIHJlYWQgZnJvbSBvciBtb2RpZnkgdGhlIHN0YXRlLiIKICAgIGZ1bmN0aW9uIGlzR2VuZVNjaWVuY2UoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gcmV0dXJuIGEgcHNldWRvIHJhbmRvbSBudW1iZXIgYmV0d2VlbiBsb3dlciBhbmQgdXBwZXIgYm91bmRzCiAgICAvLyBnaXZlbiB0aGUgbnVtYmVyIG9mIHByZXZpb3VzIGJsb2NrcyBpdCBzaG91bGQgaGFzaC4KICAgIGZ1bmN0aW9uIHJhbmRvbSh1aW50NjQgdXBwZXIpIGludGVybmFsIHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIF9zZWVkID0gdWludDY0KGtlY2NhazI1NihrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIF9zZWVkKSwgbm93KSk7CiAgICAgICAgcmV0dXJuIF9zZWVkICUgdXBwZXI7CiAgICB9CgogICAgZnVuY3Rpb24gcmFuZG9tQmV0d2Vlbih1aW50MzIgYSwgdWludDMyIGIpIGludGVybmFsIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHVpbnQzMiBtaW47CiAgICAgICAgdWludDMyIG1heDsKICAgICAgICBpZihhIDwgYikgewogICAgICAgICAgICBtaW4gPSBhOwogICAgICAgICAgICBtYXggPSBiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1pbiA9IGI7CiAgICAgICAgICAgIG1heCA9IGE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWluICsgdWludDMyKHJhbmRvbShtYXggLSBtaW4gKyAxKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmFuZG9tQ29kZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgLy8KICAgICAgICB1aW50NjQgciA9IHJhbmRvbSgxMDAwMDAwKTsKCiAgICAgICAgaWYgKHIgPD0gMTYzKSByZXR1cm4gMTUxOwogICAgICAgIGlmIChyIDw9IDMyNykgcmV0dXJuIDI1MTsKICAgICAgICBpZiAociA8PSA0OTApIHJldHVybiAxOTY7CiAgICAgICAgaWYgKHIgPD0gNjU0KSByZXR1cm4gMTk3OwogICAgICAgIGlmIChyIDw9IDgxNykgcmV0dXJuIDIzODsKICAgICAgICBpZiAociA8PSA5ODEpIHJldHVybiAyNDA7CiAgICAgICAgaWYgKHIgPD0gMTE0NCkgcmV0dXJuIDIzOTsKICAgICAgICBpZiAociA8PSAxMzA4KSByZXR1cm4gMTczOwogICAgICAgIGlmIChyIDw9IDE0NzEpIHJldHVybiAxNzU7CiAgICAgICAgaWYgKHIgPD0gMTYzNSkgcmV0dXJuIDE3NDsKICAgICAgICBpZiAociA8PSAxNzk4KSByZXR1cm4gMjM2OwogICAgICAgIGlmIChyIDw9IDE5NjIpIHJldHVybiAxNzI7CiAgICAgICAgaWYgKHIgPD0gMjI4OSkgcmV0dXJuIDI1MDsKICAgICAgICBpZiAociA8PSAyNjE2KSByZXR1cm4gMjQ5OwogICAgICAgIGlmIChyIDw9IDI5NDMpIHJldHVybiAyNDQ7CiAgICAgICAgaWYgKHIgPD0gMzI3MCkgcmV0dXJuIDI0MzsKICAgICAgICBpZiAociA8PSAzNTk3KSByZXR1cm4gMjQ1OwogICAgICAgIGlmIChyIDw9IDQwODcpIHJldHVybiAxNDU7CiAgICAgICAgaWYgKHIgPD0gNDU3NykgcmV0dXJuIDE0NjsKICAgICAgICBpZiAociA8PSA1MDY4KSByZXR1cm4gMTQ0OwogICAgICAgIGlmIChyIDw9IDU4ODUpIHJldHVybiAyNDg7CiAgICAgICAgaWYgKHIgPD0gNjcwMykgcmV0dXJuIDE0OTsKICAgICAgICBpZiAociA8PSA3NTIwKSByZXR1cm4gMTQzOwogICAgICAgIGlmIChyIDw9IDgzMzcpIHJldHVybiAxMTI7CiAgICAgICAgaWYgKHIgPD0gOTE1NSkgcmV0dXJuIDI0MjsKICAgICAgICBpZiAociA8PSA5OTcyKSByZXR1cm4gMjEyOwogICAgICAgIGlmIChyIDw9IDEwNzkwKSByZXR1cm4gMTYwOwogICAgICAgIGlmIChyIDw9IDExNjA3KSByZXR1cm4gNjsKICAgICAgICBpZiAociA8PSAxMjQyNCkgcmV0dXJuIDE1NzsKICAgICAgICBpZiAociA8PSAxMzI0MikgcmV0dXJuIDEzMTsKICAgICAgICBpZiAociA8PSAxNDA1OSkgcmV0dXJuIDM7CiAgICAgICAgaWYgKHIgPD0gMTQ4NzcpIHJldHVybiAyMzM7CiAgICAgICAgaWYgKHIgPD0gMTU2OTQpIHJldHVybiA5OwogICAgICAgIGlmIChyIDw9IDE2NTExKSByZXR1cm4gMTU0OwogICAgICAgIGlmIChyIDw9IDE3MzI5KSByZXR1cm4gMTgyOwogICAgICAgIGlmIChyIDw9IDE4MTQ2KSByZXR1cm4gMTc2OwogICAgICAgIGlmIChyIDw9IDE5MTI3KSByZXR1cm4gMTUwOwogICAgICAgIGlmIChyIDw9IDIwNzYyKSByZXR1cm4gMTMwOwogICAgICAgIGlmIChyIDw9IDIyMzk3KSByZXR1cm4gNjg7CiAgICAgICAgaWYgKHIgPD0gMjQwMzEpIHJldHVybiA2NTsKICAgICAgICBpZiAociA8PSAyNTY2NikgcmV0dXJuIDU5OwogICAgICAgIGlmIChyIDw9IDI3MzAxKSByZXR1cm4gOTQ7CiAgICAgICAgaWYgKHIgPD0gMjg5MzYpIHJldHVybiAxOTk7CiAgICAgICAgaWYgKHIgPD0gMzA1NzEpIHJldHVybiAxNjk7CiAgICAgICAgaWYgKHIgPD0gMzIyMDUpIHJldHVybiAyMDg7CiAgICAgICAgaWYgKHIgPD0gMzM4NDApIHJldHVybiAyMzA7CiAgICAgICAgaWYgKHIgPD0gMzU0NzUpIHJldHVybiAxODY7CiAgICAgICAgaWYgKHIgPD0gMzcxMTApIHJldHVybiAzNjsKICAgICAgICBpZiAociA8PSAzODc0NCkgcmV0dXJuIDM4OwogICAgICAgIGlmIChyIDw9IDQwMzc5KSByZXR1cm4gMTkyOwogICAgICAgIGlmIChyIDw9IDQyMDE0KSByZXR1cm4gMjY7CiAgICAgICAgaWYgKHIgPD0gNDM2NDkpIHJldHVybiAyMzc7CiAgICAgICAgaWYgKHIgPD0gNDUyODQpIHJldHVybiAxNDg7CiAgICAgICAgaWYgKHIgPD0gNDY5MTgpIHJldHVybiAyNDc7CiAgICAgICAgaWYgKHIgPD0gNDg1NTMpIHJldHVybiAyOwogICAgICAgIGlmIChyIDw9IDUwMTg4KSByZXR1cm4gNTsKICAgICAgICBpZiAociA8PSA1MTgyMykgcmV0dXJuIDg7CiAgICAgICAgaWYgKHIgPD0gNTM3ODUpIHJldHVybiAxMzQ7CiAgICAgICAgaWYgKHIgPD0gNTU3NDYpIHJldHVybiAyMzI7CiAgICAgICAgaWYgKHIgPD0gNTc3MDgpIHJldHVybiA3NjsKICAgICAgICBpZiAociA8PSA1OTY3MCkgcmV0dXJuIDEzNjsKICAgICAgICBpZiAociA8PSA2MTYzMikgcmV0dXJuIDEzNTsKICAgICAgICBpZiAociA8PSA2MzU5MykgcmV0dXJuIDE4MTsKICAgICAgICBpZiAociA8PSA2NTU1NSkgcmV0dXJuIDYyOwogICAgICAgIGlmIChyIDw9IDY3NTE3KSByZXR1cm4gMzQ7CiAgICAgICAgaWYgKHIgPD0gNjk0NzkpIHJldHVybiAzMTsKICAgICAgICBpZiAociA8PSA3MTQ0MCkgcmV0dXJuIDIyMTsKICAgICAgICBpZiAociA8PSA3MzQwMikgcmV0dXJuIDcxOwogICAgICAgIGlmIChyIDw9IDc1MzY0KSByZXR1cm4gMTg1OwogICAgICAgIGlmIChyIDw9IDc3MzI1KSByZXR1cm4gMTg7CiAgICAgICAgaWYgKHIgPD0gNzkyODcpIHJldHVybiAxNTsKICAgICAgICBpZiAociA8PSA4MTI0OSkgcmV0dXJuIDEyOwogICAgICAgIGlmIChyIDw9IDgzMjExKSByZXR1cm4gMTU5OwogICAgICAgIGlmIChyIDw9IDg1MTcyKSByZXR1cm4gMTg5OwogICAgICAgIGlmIChyIDw9IDg3MTM0KSByZXR1cm4gMjE5OwogICAgICAgIGlmIChyIDw9IDg5MDk2KSByZXR1cm4gMTU2OwogICAgICAgIGlmIChyIDw9IDkxMDU4KSByZXR1cm4gMTUzOwogICAgICAgIGlmIChyIDw9IDkzNTEwKSByZXR1cm4gMjE3OwogICAgICAgIGlmIChyIDw9IDk1OTYyKSByZXR1cm4gMTM5OwogICAgICAgIGlmIChyIDw9IDk4NDE0KSByZXR1cm4gMjI5OwogICAgICAgIGlmIChyIDw9IDEwMDg2NikgcmV0dXJuIDE0MTsKICAgICAgICBpZiAociA8PSAxMDMzMTkpIHJldHVybiAyMTA7CiAgICAgICAgaWYgKHIgPD0gMTA1NzcxKSByZXR1cm4gNDU7CiAgICAgICAgaWYgKHIgPD0gMTA4MjIzKSByZXR1cm4gMjA1OwogICAgICAgIGlmIChyIDw9IDExMDY3NSkgcmV0dXJuIDc4OwogICAgICAgIGlmIChyIDw9IDExMzEyNykgcmV0dXJuIDIyNDsKICAgICAgICBpZiAociA8PSAxMTU1ODApIHJldHVybiAxNzE7CiAgICAgICAgaWYgKHIgPD0gMTE4MDMyKSByZXR1cm4gMTY0OwogICAgICAgIGlmIChyIDw9IDEyMDQ4NCkgcmV0dXJuIDE3ODsKICAgICAgICBpZiAociA8PSAxMjI5MzYpIHJldHVybiAxOTU7CiAgICAgICAgaWYgKHIgPD0gMTI1Mzg4KSByZXR1cm4gMTA1OwogICAgICAgIGlmIChyIDw9IDEyNzg0MCkgcmV0dXJuIDE2MjsKICAgICAgICBpZiAociA8PSAxMzAyOTMpIHJldHVybiAxNjg7CiAgICAgICAgaWYgKHIgPD0gMTMyNzQ1KSByZXR1cm4gMTg0OwogICAgICAgIGlmIChyIDw9IDEzNTE5NykgcmV0dXJuIDE2NjsKICAgICAgICBpZiAociA8PSAxMzg0NjcpIHJldHVybiAxMDM7CiAgICAgICAgaWYgKHIgPD0gMTQxNzM2KSByZXR1cm4gODk7CiAgICAgICAgaWYgKHIgPD0gMTQ1MDA2KSByZXR1cm4gOTk7CiAgICAgICAgaWYgKHIgPD0gMTQ4Mjc1KSByZXR1cm4gMTQyOwogICAgICAgIGlmIChyIDw9IDE1MTU0NSkgcmV0dXJuIDgwOwogICAgICAgIGlmIChyIDw9IDE1NDgxNCkgcmV0dXJuIDkxOwogICAgICAgIGlmIChyIDw9IDE1ODA4NCkgcmV0dXJuIDExNTsKICAgICAgICBpZiAociA8PSAxNjEzNTQpIHJldHVybiAxMDY7CiAgICAgICAgaWYgKHIgPD0gMTY0NjIzKSByZXR1cm4gNzM7CiAgICAgICAgaWYgKHIgPD0gMTY3ODkzKSByZXR1cm4gMjg7CiAgICAgICAgaWYgKHIgPD0gMTcxMTYyKSByZXR1cm4gMjQxOwogICAgICAgIGlmIChyIDw9IDE3NDQzMikgcmV0dXJuIDEyMTsKICAgICAgICBpZiAociA8PSAxNzc3MDEpIHJldHVybiA1NTsKICAgICAgICBpZiAociA8PSAxODA5NzEpIHJldHVybiAxMjY7CiAgICAgICAgaWYgKHIgPD0gMTg0MjQxKSByZXR1cm4gODI7CiAgICAgICAgaWYgKHIgPD0gMTg3NTEwKSByZXR1cm4gMTI1OwogICAgICAgIGlmIChyIDw9IDE5MDc4MCkgcmV0dXJuIDExMDsKICAgICAgICBpZiAociA8PSAxOTQwNDkpIHJldHVybiA4NTsKICAgICAgICBpZiAociA8PSAxOTczMTkpIHJldHVybiA1NzsKICAgICAgICBpZiAociA8PSAyMDA1ODkpIHJldHVybiAxMDc7CiAgICAgICAgaWYgKHIgPD0gMjAzODU4KSByZXR1cm4gOTc7CiAgICAgICAgaWYgKHIgPD0gMjA3MTI4KSByZXR1cm4gMTE5OwogICAgICAgIGlmIChyIDw9IDIxMDM5NykgcmV0dXJuIDIyNzsKICAgICAgICBpZiAociA8PSAyMTM2NjcpIHJldHVybiAxMTc7CiAgICAgICAgaWYgKHIgPD0gMjE2OTM2KSByZXR1cm4gNDk7CiAgICAgICAgaWYgKHIgPD0gMjIwMjA2KSByZXR1cm4gNDA7CiAgICAgICAgaWYgKHIgPD0gMjIzNDc2KSByZXR1cm4gMTAxOwogICAgICAgIGlmIChyIDw9IDIyNjc0NSkgcmV0dXJuIDg3OwogICAgICAgIGlmIChyIDw9IDIzMDAxNSkgcmV0dXJuIDIxNTsKICAgICAgICBpZiAociA8PSAyMzMyODQpIHJldHVybiA0MjsKICAgICAgICBpZiAociA8PSAyMzY1NTQpIHJldHVybiAyMjsKICAgICAgICBpZiAociA8PSAyMzk4MjMpIHJldHVybiAyMDc7CiAgICAgICAgaWYgKHIgPD0gMjQzMDkzKSByZXR1cm4gMjQ7CiAgICAgICAgaWYgKHIgPD0gMjQ2MzYzKSByZXR1cm4gOTM7CiAgICAgICAgaWYgKHIgPD0gMjQ5NjMyKSByZXR1cm4gNDc7CiAgICAgICAgaWYgKHIgPD0gMjUyOTAyKSByZXR1cm4gMjA7CiAgICAgICAgaWYgKHIgPD0gMjU2MTcxKSByZXR1cm4gNTM7CiAgICAgICAgaWYgKHIgPD0gMjU5NDQxKSByZXR1cm4gMTEzOwogICAgICAgIGlmIChyIDw9IDI2MjcxMCkgcmV0dXJuIDE5ODsKICAgICAgICBpZiAociA8PSAyNjU5ODApIHJldHVybiA1MTsKICAgICAgICBpZiAociA8PSAyNjkyNTApIHJldHVybiAxMDg7CiAgICAgICAgaWYgKHIgPD0gMjcyNTE5KSByZXR1cm4gMTkwOwogICAgICAgIGlmIChyIDw9IDI3NTc4OSkgcmV0dXJuIDE1ODsKICAgICAgICBpZiAociA8PSAyNzkwNTgpIHJldHVybiA5NTsKICAgICAgICBpZiAociA8PSAyODIzMjgpIHJldHVybiAxOwogICAgICAgIGlmIChyIDw9IDI4NTU5OCkgcmV0dXJuIDIyNTsKICAgICAgICBpZiAociA8PSAyODg4NjcpIHJldHVybiA0OwogICAgICAgIGlmIChyIDw9IDI5MjEzNykgcmV0dXJuIDE1NTsKICAgICAgICBpZiAociA8PSAyOTU0MDYpIHJldHVybiA3OwogICAgICAgIGlmIChyIDw9IDI5ODY3NikgcmV0dXJuIDE1MjsKICAgICAgICBpZiAociA8PSAzMDE5NDUpIHJldHVybiAyNTsKICAgICAgICBpZiAociA8PSAzMDUyMTUpIHJldHVybiAxMzI7CiAgICAgICAgaWYgKHIgPD0gMzA5MzAyKSByZXR1cm4gNjc7CiAgICAgICAgaWYgKHIgPD0gMzEzMzg5KSByZXR1cm4gNjQ7CiAgICAgICAgaWYgKHIgPD0gMzE3NDc2KSByZXR1cm4gNzU7CiAgICAgICAgaWYgKHIgPD0gMzIxNTYzKSByZXR1cm4gNzA7CiAgICAgICAgaWYgKHIgPD0gMzI1NjUwKSByZXR1cm4gMTgwOwogICAgICAgIGlmIChyIDw9IDMyOTczNykgcmV0dXJuIDYxOwogICAgICAgIGlmIChyIDw9IDMzMzgyNCkgcmV0dXJuIDMzOwogICAgICAgIGlmIChyIDw9IDMzNzkxMSkgcmV0dXJuIDMwOwogICAgICAgIGlmIChyIDw9IDM0MTk5OCkgcmV0dXJuIDE3OwogICAgICAgIGlmIChyIDw9IDM0NjA4NSkgcmV0dXJuIDIwMjsKICAgICAgICBpZiAociA8PSAzNTAxNzIpIHJldHVybiAxODg7CiAgICAgICAgaWYgKHIgPD0gMzU0MjU5KSByZXR1cm4gMTE7CiAgICAgICAgaWYgKHIgPD0gMzU4MzQ2KSByZXR1cm4gMTQ7CiAgICAgICAgaWYgKHIgPD0gMzYyNDMzKSByZXR1cm4gMjM1OwogICAgICAgIGlmIChyIDw9IDM2NzMzNykgcmV0dXJuIDIxNDsKICAgICAgICBpZiAociA8PSAzNzIyNDEpIHJldHVybiAxMjc7CiAgICAgICAgaWYgKHIgPD0gMzc3MTQ2KSByZXR1cm4gMTI0OwogICAgICAgIGlmIChyIDw9IDM4MjA1MCkgcmV0dXJuIDEyODsKICAgICAgICBpZiAociA8PSAzODY5NTQpIHJldHVybiAxMjM7CiAgICAgICAgaWYgKHIgPD0gMzkxODU5KSByZXR1cm4gMjI2OwogICAgICAgIGlmIChyIDw9IDM5Njc2MykgcmV0dXJuIDIzNDsKICAgICAgICBpZiAociA8PSA0MDE2NjcpIHJldHVybiAxMjI7CiAgICAgICAgaWYgKHIgPD0gNDA2NTcyKSByZXR1cm4gMjExOwogICAgICAgIGlmIChyIDw9IDQxMTQ3NikgcmV0dXJuIDIwMzsKICAgICAgICBpZiAociA8PSA0MTYzODEpIHJldHVybiAyMDA7CiAgICAgICAgaWYgKHIgPD0gNDIxMjg1KSByZXR1cm4gMjA2OwogICAgICAgIGlmIChyIDw9IDQyNjE4OSkgcmV0dXJuIDQ0OwogICAgICAgIGlmIChyIDw9IDQzMTA5NCkgcmV0dXJuIDE5MzsKICAgICAgICBpZiAociA8PSA0MzU5OTgpIHJldHVybiAyMjI7CiAgICAgICAgaWYgKHIgPD0gNDQwOTAyKSByZXR1cm4gNTg7CiAgICAgICAgaWYgKHIgPD0gNDQ1ODA3KSByZXR1cm4gODM7CiAgICAgICAgaWYgKHIgPD0gNDUwNzExKSByZXR1cm4gMzU7CiAgICAgICAgaWYgKHIgPD0gNDU1NjE1KSByZXR1cm4gMjAxOwogICAgICAgIGlmIChyIDw9IDQ2MDUyMCkgcmV0dXJuIDM3OwogICAgICAgIGlmIChyIDw9IDQ2NTQyNCkgcmV0dXJuIDIxODsKICAgICAgICBpZiAociA8PSA0NzAzMjkpIHJldHVybiAyMjA7CiAgICAgICAgaWYgKHIgPD0gNDc1MjMzKSByZXR1cm4gMjEzOwogICAgICAgIGlmIChyIDw9IDQ4MTc3MikgcmV0dXJuIDExNDsKICAgICAgICBpZiAociA8PSA0ODgzMTEpIHJldHVybiAxMzc7CiAgICAgICAgaWYgKHIgPD0gNDk0ODUwKSByZXR1cm4gNzc7CiAgICAgICAgaWYgKHIgPD0gNTAxMzkwKSByZXR1cm4gMTM4OwogICAgICAgIGlmIChyIDw9IDUwNzkyOSkgcmV0dXJuIDE0MDsKICAgICAgICBpZiAociA8PSA1MTQ0NjgpIHJldHVybiAyMDk7CiAgICAgICAgaWYgKHIgPD0gNTIxMDA3KSByZXR1cm4gMjI4OwogICAgICAgIGlmIChyIDw9IDUyNzU0NikgcmV0dXJuIDE3MDsKICAgICAgICBpZiAociA8PSA1MzQwODUpIHJldHVybiAyMDQ7CiAgICAgICAgaWYgKHIgPD0gNTQwNjI0KSByZXR1cm4gOTI7CiAgICAgICAgaWYgKHIgPD0gNTQ3MTY0KSByZXR1cm4gMTMzOwogICAgICAgIGlmIChyIDw9IDU1MzcwMykgcmV0dXJuIDEwNDsKICAgICAgICBpZiAociA8PSA1NjAyNDIpIHJldHVybiAxNzc7CiAgICAgICAgaWYgKHIgPD0gNTY2NzgxKSByZXR1cm4gMjQ2OwogICAgICAgIGlmIChyIDw9IDU3MzMyMCkgcmV0dXJuIDE0NzsKICAgICAgICBpZiAociA8PSA1Nzk4NTkpIHJldHVybiA0NjsKICAgICAgICBpZiAociA8PSA1ODYzOTkpIHJldHVybiAxOTQ7CiAgICAgICAgaWYgKHIgPD0gNTk0NTczKSByZXR1cm4gMTExOwogICAgICAgIGlmIChyIDw9IDYwMjc0NikgcmV0dXJuIDk4OwogICAgICAgIGlmIChyIDw9IDYxMDkyMCkgcmV0dXJuIDg4OwogICAgICAgIGlmIChyIDw9IDYxOTA5NCkgcmV0dXJuIDc5OwogICAgICAgIGlmIChyIDw9IDYyNzI2OCkgcmV0dXJuIDY2OwogICAgICAgIGlmIChyIDw9IDYzNTQ0MikgcmV0dXJuIDI3OwogICAgICAgIGlmIChyIDw9IDY0MzYxNikgcmV0dXJuIDc0OwogICAgICAgIGlmIChyIDw9IDY1MTc5MCkgcmV0dXJuIDIxNjsKICAgICAgICBpZiAociA8PSA2NTk5NjQpIHJldHVybiAyMzE7CiAgICAgICAgaWYgKHIgPD0gNjY4MTM4KSByZXR1cm4gNjM7CiAgICAgICAgaWYgKHIgPD0gNjc2MzEyKSByZXR1cm4gMTAyOwogICAgICAgIGlmIChyIDw9IDY4NDQ4NikgcmV0dXJuIDEwOTsKICAgICAgICBpZiAociA8PSA2OTI2NjApIHJldHVybiA4MTsKICAgICAgICBpZiAociA8PSA3MDA4MzQpIHJldHVybiA4NDsKICAgICAgICBpZiAociA8PSA3MDkwMDgpIHJldHVybiAxMTg7CiAgICAgICAgaWYgKHIgPD0gNzE3MTgyKSByZXR1cm4gNTY7CiAgICAgICAgaWYgKHIgPD0gNzI1MzU2KSByZXR1cm4gOTY7CiAgICAgICAgaWYgKHIgPD0gNzMzNTMwKSByZXR1cm4gNTQ7CiAgICAgICAgaWYgKHIgPD0gNzQxNzAzKSByZXR1cm4gOTA7CiAgICAgICAgaWYgKHIgPD0gNzQ5ODc3KSByZXR1cm4gNzI7CiAgICAgICAgaWYgKHIgPD0gNzU4MDUxKSByZXR1cm4gMTIwOwogICAgICAgIGlmIChyIDw9IDc2NjIyNSkgcmV0dXJuIDExNjsKICAgICAgICBpZiAociA8PSA3NzQzOTkpIHJldHVybiA2OTsKICAgICAgICBpZiAociA8PSA3ODI1NzMpIHJldHVybiA0ODsKICAgICAgICBpZiAociA8PSA3OTA3NDcpIHJldHVybiA4NjsKICAgICAgICBpZiAociA8PSA3OTg5MjEpIHJldHVybiAxNzk7CiAgICAgICAgaWYgKHIgPD0gODA3MDk1KSByZXR1cm4gMTAwOwogICAgICAgIGlmIChyIDw9IDgxNTI2OSkgcmV0dXJuIDIzOwogICAgICAgIGlmIChyIDw9IDgyMzQ0MykgcmV0dXJuIDIyMzsKICAgICAgICBpZiAociA8PSA4MzE2MTcpIHJldHVybiAzMjsKICAgICAgICBpZiAociA8PSA4Mzk3OTEpIHJldHVybiAyOTsKICAgICAgICBpZiAociA8PSA4NDc5NjUpIHJldHVybiAzOTsKICAgICAgICBpZiAociA8PSA4NTYxMzkpIHJldHVybiA2MDsKICAgICAgICBpZiAociA8PSA4NjQzMTMpIHJldHVybiAxNjc7CiAgICAgICAgaWYgKHIgPD0gODcyNDg3KSByZXR1cm4gMjE7CiAgICAgICAgaWYgKHIgPD0gODgwNjYwKSByZXR1cm4gMTY1OwogICAgICAgIGlmIChyIDw9IDg4ODgzNCkgcmV0dXJuIDE2MzsKICAgICAgICBpZiAociA8PSA4OTcwMDgpIHJldHVybiA1MjsKICAgICAgICBpZiAociA8PSA5MDUxODIpIHJldHVybiAxOTsKICAgICAgICBpZiAociA8PSA5MTMzNTYpIHJldHVybiAxNjsKICAgICAgICBpZiAociA8PSA5MjE1MzApIHJldHVybiA0MTsKICAgICAgICBpZiAociA8PSA5Mjk3MDQpIHJldHVybiAxNjE7CiAgICAgICAgaWYgKHIgPD0gOTM3ODc4KSByZXR1cm4gMTg3OwogICAgICAgIGlmIChyIDw9IDk0NjA1MikgcmV0dXJuIDUwOwogICAgICAgIGlmIChyIDw9IDk1NDIyNikgcmV0dXJuIDE4MzsKICAgICAgICBpZiAociA8PSA5NjI0MDApIHJldHVybiAxMzsKICAgICAgICBpZiAociA8PSA5NzA1NzQpIHJldHVybiAxMDsKICAgICAgICBpZiAociA8PSA5Nzg3NDgpIHJldHVybiAxOTE7CiAgICAgICAgaWYgKHIgPD0gOTg4NTU2KSByZXR1cm4gNDM7CiAgICAgICAgaWYgKHIgPD0gMTAwMDAwMCkgcmV0dXJuIDEyOTsKCiAgICAgICAgcmV0dXJuIDEyOTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYXNlU3RhdHModWludDggaWQpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQzMiByYSwgdWludDMyIHJkLCB1aW50MzIgcnMpIHsKICAgICAgICBpZiAoaWQgPT0gMTUxKSByZXR1cm4gKDIxMCwgMjEwLCAyMDApOwogICAgICAgIGlmIChpZCA9PSAyNTEpIHJldHVybiAoMjEwLCAyMTAsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE5NikgcmV0dXJuICgyNjEsIDE5NCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTk3KSByZXR1cm4gKDEyNiwgMjUwLCAxOTApOwogICAgICAgIGlmIChpZCA9PSAyMzgpIHJldHVybiAoMTUzLCAxMTYsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMjQwKSByZXR1cm4gKDE1MSwgMTA4LCA5MCk7CiAgICAgICAgaWYgKGlkID09IDIzOSkgcmV0dXJuICgxMzUsIDExMCwgOTApOwogICAgICAgIGlmIChpZCA9PSAxNzMpIHJldHVybiAoNzUsIDkxLCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxNzUpIHJldHVybiAoNjcsIDExNiwgNzApOwogICAgICAgIGlmIChpZCA9PSAxNzQpIHJldHVybiAoNjksIDM0LCAxODApOwogICAgICAgIGlmIChpZCA9PSAyMzYpIHJldHVybiAoNjQsIDY0LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDE3MikgcmV0dXJuICg3NywgNjMsIDQwKTsKICAgICAgICBpZiAoaWQgPT0gMjUwKSByZXR1cm4gKDIzOSwgMjc0LCAxOTMpOwogICAgICAgIGlmIChpZCA9PSAyNDkpIHJldHVybiAoMTkzLCAzMjMsIDIxMik7CiAgICAgICAgaWYgKGlkID09IDI0NCkgcmV0dXJuICgyMzUsIDE3NiwgMjMwKTsKICAgICAgICBpZiAoaWQgPT0gMjQzKSByZXR1cm4gKDI0MSwgMjEwLCAxODApOwogICAgICAgIGlmIChpZCA9PSAyNDUpIHJldHVybiAoMTgwLCAyMzUsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE0NSkgcmV0dXJuICgyNTMsIDE4OCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTQ2KSByZXR1cm4gKDI1MSwgMTg0LCAxODApOwogICAgICAgIGlmIChpZCA9PSAxNDQpIHJldHVybiAoMTkyLCAyNDksIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDI0OCkgcmV0dXJuICgyNTEsIDIxMiwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMTQ5KSByZXR1cm4gKDI2MywgMjAxLCAxODIpOwogICAgICAgIGlmIChpZCA9PSAxNDMpIHJldHVybiAoMTkwLCAxOTAsIDMyMCk7CiAgICAgICAgaWYgKGlkID09IDExMikgcmV0dXJuICgyMjIsIDIwNiwgMjEwKTsKICAgICAgICBpZiAoaWQgPT0gMjQyKSByZXR1cm4gKDEyOSwgMjI5LCA1MTApOwogICAgICAgIGlmIChpZCA9PSAyMTIpIHJldHVybiAoMjM2LCAxOTEsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE2MCkgcmV0dXJuICgyMDUsIDE5NywgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gNikgcmV0dXJuICgyMjMsIDE3NiwgMTU2KTsKICAgICAgICBpZiAoaWQgPT0gMTU3KSByZXR1cm4gKDIyMywgMTc2LCAxNTYpOwogICAgICAgIGlmIChpZCA9PSAxMzEpIHJldHVybiAoMTY1LCAxODAsIDI2MCk7CiAgICAgICAgaWYgKGlkID09IDMpIHJldHVybiAoMTk4LCAxOTgsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDIzMykgcmV0dXJuICgxOTgsIDE4MywgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gOSkgcmV0dXJuICgxNzEsIDIxMCwgMTU4KTsKICAgICAgICBpZiAoaWQgPT0gMTU0KSByZXR1cm4gKDE2OCwgMjAyLCAxNjApOwogICAgICAgIGlmIChpZCA9PSAxODIpIHJldHVybiAoMTY5LCAxODksIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDE3NikgcmV0dXJuICgxMzksIDE5MSwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTUwKSByZXR1cm4gKDMwMCwgMTgyLCAxOTMpOwogICAgICAgIGlmIChpZCA9PSAxMzApIHJldHVybiAoMjM3LCAxOTcsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDY4KSByZXR1cm4gKDIzNCwgMTYyLCAxODApOwogICAgICAgIGlmIChpZCA9PSA2NSkgcmV0dXJuICgyNzEsIDE5NCwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNTkpIHJldHVybiAoMjI3LCAxNjYsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDk0KSByZXR1cm4gKDI2MSwgMTU2LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAxOTkpIHJldHVybiAoMTc3LCAxOTQsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDE2OSkgcmV0dXJuICgxOTQsIDE3OCwgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gMjA4KSByZXR1cm4gKDE0OCwgMzMzLCAxNTApOwogICAgICAgIGlmIChpZCA9PSAyMzApIHJldHVybiAoMTk0LCAxOTQsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDE4NikgcmV0dXJuICgxNzQsIDE5MiwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMzYpIHJldHVybiAoMTc4LCAxNzEsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDM4KSByZXR1cm4gKDE2OSwgMjA0LCAxNDYpOwogICAgICAgIGlmIChpZCA9PSAxOTIpIHJldHVybiAoMTg1LCAxNDgsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDI2KSByZXR1cm4gKDE5MywgMTY1LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAyMzcpIHJldHVybiAoMTczLCAyMTQsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDE0OCkgcmV0dXJuICgxNjMsIDEzOCwgMTIyKTsKICAgICAgICBpZiAoaWQgPT0gMjQ3KSByZXR1cm4gKDE1NSwgMTMzLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyKSByZXR1cm4gKDE1MSwgMTUxLCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1KSByZXR1cm4gKDE1OCwgMTI5LCAxMTYpOwogICAgICAgIGlmIChpZCA9PSA4KSByZXR1cm4gKDEyNiwgMTU1LCAxMTgpOwogICAgICAgIGlmIChpZCA9PSAxMzQpIHJldHVybiAoMjA1LCAxNzcsIDI2MCk7CiAgICAgICAgaWYgKGlkID09IDIzMikgcmV0dXJuICgyMTQsIDIxNCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gNzYpIHJldHVybiAoMjExLCAyMjksIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDEzNikgcmV0dXJuICgyNDYsIDIwNCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTM1KSByZXR1cm4gKDIzMiwgMjAxLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxODEpIHJldHVybiAoMjExLCAxNzIsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDYyKSByZXR1cm4gKDE4MiwgMTg3LCAxODApOwogICAgICAgIGlmIChpZCA9PSAzNCkgcmV0dXJuICgyMDQsIDE1NywgMTYyKTsKICAgICAgICBpZiAoaWQgPT0gMzEpIHJldHVybiAoMTgwLCAxNzQsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDIyMSkgcmV0dXJuICgxODEsIDE0NywgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gNzEpIHJldHVybiAoMjA3LCAxMzgsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDE4NSkgcmV0dXJuICgxNjcsIDE5OCwgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMTgpIHJldHVybiAoMTY2LCAxNTcsIDE2Nik7CiAgICAgICAgaWYgKGlkID09IDE1KSByZXR1cm4gKDE2OSwgMTUwLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMikgcmV0dXJuICgxNjcsIDE1MSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMTU5KSByZXR1cm4gKDE1MCwgMTUxLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxODkpIHJldHVybiAoMTE4LCAxOTcsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDIxOSkgcmV0dXJuICgxMzksIDIwOSwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTU2KSByZXR1cm4gKDE1OCwgMTI5LCAxMTYpOwogICAgICAgIGlmIChpZCA9PSAxNTMpIHJldHVybiAoMTIyLCAxNTUsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIxNykgcmV0dXJuICgyMzYsIDE0NCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTM5KSByZXR1cm4gKDIwNywgMjI3LCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyMjkpIHJldHVybiAoMjI0LCAxNTksIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDE0MSkgcmV0dXJuICgyMjAsIDIwMywgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjEwKSByZXR1cm4gKDIxMiwgMTM3LCAxODApOwogICAgICAgIGlmIChpZCA9PSA0NSkgcmV0dXJuICgyMDIsIDE3MCwgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMjA1KSByZXR1cm4gKDE2MSwgMjQyLCAxNTApOwogICAgICAgIGlmIChpZCA9PSA3OCkgcmV0dXJuICgyMDcsIDE2NywgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMjI0KSByZXR1cm4gKDE5NywgMTQxLCAxNTApOwogICAgICAgIGlmIChpZCA9PSAxNzEpIHJldHVybiAoMTQ2LCAxNDYsIDI1MCk7CiAgICAgICAgaWYgKGlkID09IDE2NCkgcmV0dXJuICgxNDUsIDE3OSwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMTc4KSByZXR1cm4gKDE5MiwgMTQ2LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxOTUpIHJldHVybiAoMTUyLCAxNTIsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDEwNSkgcmV0dXJuICgxNDQsIDIwMCwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMTYyKSByZXR1cm4gKDE0OCwgMTMwLCAxNzApOwogICAgICAgIGlmIChpZCA9PSAxNjgpIHJldHVybiAoMTYxLCAxMjgsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE4NCkgcmV0dXJuICgxMTIsIDE1MiwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMTY2KSByZXR1cm4gKDEwNywgMjA5LCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxMDMpIHJldHVybiAoMjMzLCAxNTgsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDg5KSByZXR1cm4gKDE5MCwgMTg0LCAyMTApOwogICAgICAgIGlmIChpZCA9PSA5OSkgcmV0dXJuICgyNDAsIDIxNCwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTQyKSByZXR1cm4gKDIyMSwgMTY0LCAxNjApOwogICAgICAgIGlmIChpZCA9PSA4MCkgcmV0dXJuICgxNzcsIDE5NCwgMTkwKTsKICAgICAgICBpZiAoaWQgPT0gOTEpIHJldHVybiAoMTg2LCAzMjMsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDExNSkgcmV0dXJuICgxODEsIDE2NSwgMjEwKTsKICAgICAgICBpZiAoaWQgPT0gMTA2KSByZXR1cm4gKDIyNCwgMjExLCAxMDApOwogICAgICAgIGlmIChpZCA9PSA3MykgcmV0dXJuICgxNjYsIDIzNywgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMjgpIHJldHVybiAoMTgyLCAyMDIsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDI0MSkgcmV0dXJuICgxNTcsIDIxMSwgMTkwKTsKICAgICAgICBpZiAoaWQgPT0gMTIxKSByZXR1cm4gKDIxMCwgMTg0LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1NSkgcmV0dXJuICgxOTEsIDE2MywgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMTI2KSByZXR1cm4gKDIwNiwgMTY5LCAxMzApOwogICAgICAgIGlmIChpZCA9PSA4MikgcmV0dXJuICgyMjMsIDE4MiwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTI1KSByZXR1cm4gKDE5OCwgMTczLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMTApIHJldHVybiAoMTc0LCAyMjEsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDg1KSByZXR1cm4gKDIxOCwgMTQ1LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1NykgcmV0dXJuICgyMDcsIDE0NCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTA3KSByZXR1cm4gKDE5MywgMjEyLCAxMDApOwogICAgICAgIGlmIChpZCA9PSA5NykgcmV0dXJuICgxNDQsIDIxNSwgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gMTE5KSByZXR1cm4gKDE3NSwgMTU0LCAxNjApOwogICAgICAgIGlmIChpZCA9PSAyMjcpIHJldHVybiAoMTQ4LCAyNjAsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDExNykgcmV0dXJuICgxODcsIDE4MiwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNDkpIHJldHVybiAoMTc5LCAxNTAsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDQwKSByZXR1cm4gKDE1NiwgOTMsIDI4MCk7CiAgICAgICAgaWYgKGlkID09IDEwMSkgcmV0dXJuICgxNzMsIDE3OSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gODcpIHJldHVybiAoMTM5LCAxODQsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDIxNSkgcmV0dXJuICgxODksIDE1NywgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNDIpIHJldHVybiAoMTYxLCAxNTMsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDIyKSByZXR1cm4gKDE4MiwgMTM1LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAyMDcpIHJldHVybiAoMTQzLCAyMDQsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDI0KSByZXR1cm4gKDE2NywgMTU4LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA5MykgcmV0dXJuICgyMjMsIDExMiwgOTApOwogICAgICAgIGlmIChpZCA9PSA0NykgcmV0dXJuICgxNjUsIDE0NiwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjApIHJldHVybiAoMTYxLCAxNDQsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDUzKSByZXR1cm4gKDE1MCwgMTM5LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMTMpIHJldHVybiAoNjAsIDE3NiwgNTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTk4KSByZXR1cm4gKDE3NSwgODcsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDUxKSByZXR1cm4gKDE2NywgMTQ3LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDEwOCkgcmV0dXJuICgxMDgsIDEzNywgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTkwKSByZXR1cm4gKDEzNiwgMTEyLCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxNTgpIHJldHVybiAoMTE3LCAxMTYsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDk1KSByZXR1cm4gKDg1LCAyODgsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMSkgcmV0dXJuICgxMTgsIDExOCwgOTApOwogICAgICAgIGlmIChpZCA9PSAyMjUpIHJldHVybiAoMTI4LCA5MCwgOTApOwogICAgICAgIGlmIChpZCA9PSA0KSByZXR1cm4gKDExNiwgOTYsIDc4KTsKICAgICAgICBpZiAoaWQgPT0gMTU1KSByZXR1cm4gKDExNiwgOTYsIDc4KTsKICAgICAgICBpZiAoaWQgPT0gNykgcmV0dXJuICg5NCwgMTIyLCA4OCk7CiAgICAgICAgaWYgKGlkID09IDE1MikgcmV0dXJuICg5MiwgMTIyLCA5MCk7CiAgICAgICAgaWYgKGlkID09IDI1KSByZXR1cm4gKDExMiwgMTAxLCA3MCk7CiAgICAgICAgaWYgKGlkID09IDEzMikgcmV0dXJuICg5MSwgOTEsIDk2KTsKICAgICAgICBpZiAoaWQgPT0gNjcpIHJldHVybiAoMTc3LCAxMzAsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDY0KSByZXR1cm4gKDIzMiwgMTM4LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDc1KSByZXR1cm4gKDE2NCwgMTk2LCAxMTApOwogICAgICAgIGlmIChpZCA9PSA3MCkgcmV0dXJuICgxNzIsIDk1LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxODApIHJldHVybiAoMTQ1LCAxMTIsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDYxKSByZXR1cm4gKDEzMCwgMTMwLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAzMykgcmV0dXJuICgxMzcsIDExMiwgMTIyKTsKICAgICAgICBpZiAoaWQgPT0gMzApIHJldHVybiAoMTE3LCAxMjYsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE3KSByZXR1cm4gKDExNywgMTA4LCAxMjYpOwogICAgICAgIGlmIChpZCA9PSAyMDIpIHJldHVybiAoNjAsIDEwNiwgMzgwKTsKICAgICAgICBpZiAoaWQgPT0gMTg4KSByZXR1cm4gKDkxLCAxMjcsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDExKSByZXR1cm4gKDQ1LCA5NCwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTQpIHJldHVybiAoNDYsIDg2LCA5MCk7CiAgICAgICAgaWYgKGlkID09IDIzNSkgcmV0dXJuICg0MCwgODgsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDIxNCkgcmV0dXJuICgyMzQsIDE4OSwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMTI3KSByZXR1cm4gKDIzOCwgMTk3LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMjQpIHJldHVybiAoMjIzLCAxODIsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDEyOCkgcmV0dXJuICgxOTgsIDE5NywgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMTIzKSByZXR1cm4gKDIxOCwgMTcwLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyMjYpIHJldHVybiAoMTQ4LCAyNjAsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDIzNCkgcmV0dXJuICgxOTIsIDEzMiwgMTQ2KTsKICAgICAgICBpZiAoaWQgPT0gMTIyKSByZXR1cm4gKDE5MiwgMjMzLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDIxMSkgcmV0dXJuICgxODQsIDE0OCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMjAzKSByZXR1cm4gKDE4MiwgMTMzLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyMDApIHJldHVybiAoMTY3LCAxNjcsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIwNikgcmV0dXJuICgxMzEsIDEzMSwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gNDQpIHJldHVybiAoMTUzLCAxMzksIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDE5MykgcmV0dXJuICgxNTQsIDk0LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAyMjIpIHJldHVybiAoMTE4LCAxNTYsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDU4KSByZXR1cm4gKDEzNiwgOTYsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDgzKSByZXR1cm4gKDEyNCwgMTE4LCAxMDQpOwogICAgICAgIGlmIChpZCA9PSAzNSkgcmV0dXJuICgxMDcsIDExNiwgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMjAxKSByZXR1cm4gKDEzNiwgOTEsIDk2KTsKICAgICAgICBpZiAoaWQgPT0gMzcpIHJldHVybiAoOTYsIDEyMiwgNzYpOwogICAgICAgIGlmIChpZCA9PSAyMTgpIHJldHVybiAoMTE4LCA3MSwgODApOwogICAgICAgIGlmIChpZCA9PSAyMjApIHJldHVybiAoOTAsIDc0LCAxMDApOwogICAgICAgIGlmIChpZCA9PSAyMTMpIHJldHVybiAoMTcsIDM5NiwgNDApOwogICAgICAgIGlmIChpZCA9PSAxMTQpIHJldHVybiAoMTgzLCAyMDUsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDEzNykgcmV0dXJuICgxNTMsIDEzOSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gNzcpIHJldHVybiAoMTcwLCAxMzIsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDEzOCkgcmV0dXJuICgxNTUsIDE3NCwgNzApOwogICAgICAgIGlmIChpZCA9PSAxNDApIHJldHVybiAoMTQ4LCAxNjIsIDYwKTsKICAgICAgICBpZiAoaWQgPT0gMjA5KSByZXR1cm4gKDEzNywgODksIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIyOCkgcmV0dXJuICgxNTIsIDkzLCA5MCk7CiAgICAgICAgaWYgKGlkID09IDE3MCkgcmV0dXJuICgxMDYsIDEwNiwgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMjA0KSByZXR1cm4gKDEwOCwgMTQ2LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA5MikgcmV0dXJuICgxODYsIDcwLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDEzMykgcmV0dXJuICgxMDQsIDEyMSwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTA0KSByZXR1cm4gKDkwLCAxNjUsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDE3NykgcmV0dXJuICgxMzQsIDg5LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDI0NikgcmV0dXJuICgxMTUsIDkzLCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxNDcpIHJldHVybiAoMTE5LCA5NCwgODIpOwogICAgICAgIGlmIChpZCA9PSA0NikgcmV0dXJuICgxMjEsIDk5LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDE5NCkgcmV0dXJuICg3NSwgNzUsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDExMSkgcmV0dXJuICgxNDAsIDE1NywgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gOTgpIHJldHVybiAoMTgxLCAxNTYsIDYwKTsKICAgICAgICBpZiAoaWQgPT0gODgpIHJldHVybiAoMTM1LCA5MCwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gNzkpIHJldHVybiAoMTA5LCAxMDksIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDY2KSByZXR1cm4gKDEzNywgODgsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDI3KSByZXR1cm4gKDEyNiwgMTQ1LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA3NCkgcmV0dXJuICgxMzIsIDE2MywgODApOwogICAgICAgIGlmIChpZCA9PSAyMTYpIHJldHVybiAoMTQyLCA5MywgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjMxKSByZXR1cm4gKDEwNywgMTA3LCAxODApOwogICAgICAgIGlmIChpZCA9PSA2MykgcmV0dXJuICgxOTUsIDEwMywgNTApOwogICAgICAgIGlmIChpZCA9PSAxMDIpIHJldHVybiAoMTA3LCAxNDAsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDEwOSkgcmV0dXJuICgxMTksIDE2NCwgODApOwogICAgICAgIGlmIChpZCA9PSA4MSkgcmV0dXJuICgxNjUsIDEyOCwgNTApOwogICAgICAgIGlmIChpZCA9PSA4NCkgcmV0dXJuICgxNTgsIDg4LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDExOCkgcmV0dXJuICgxMjMsIDExNSwgOTApOwogICAgICAgIGlmIChpZCA9PSA1NikgcmV0dXJuICgxNDgsIDg3LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDk2KSByZXR1cm4gKDg5LCAxNTgsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDU0KSByZXR1cm4gKDEyMiwgOTYsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDkwKSByZXR1cm4gKDExNiwgMTY4LCA2MCk7CiAgICAgICAgaWYgKGlkID09IDcyKSByZXR1cm4gKDk3LCAxODIsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTIwKSByZXR1cm4gKDEzNywgMTEyLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDExNikgcmV0dXJuICgxMjksIDEyNSwgNjApOwogICAgICAgIGlmIChpZCA9PSA2OSkgcmV0dXJuICgxMzksIDY0LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA0OCkgcmV0dXJuICgxMDAsIDEwMiwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gODYpIHJldHVybiAoODUsIDEyOCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTc5KSByZXR1cm4gKDExNCwgODIsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDEwMCkgcmV0dXJuICgxMDksIDExNCwgODApOwogICAgICAgIGlmIChpZCA9PSAyMykgcmV0dXJuICgxMTAsIDEwMiwgNzApOwogICAgICAgIGlmIChpZCA9PSAyMjMpIHJldHVybiAoMTI3LCA2OSwgNzApOwogICAgICAgIGlmIChpZCA9PSAzMikgcmV0dXJuICgxMDUsIDc2LCA5Mik7CiAgICAgICAgaWYgKGlkID09IDI5KSByZXR1cm4gKDg2LCA5NCwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMzkpIHJldHVybiAoODAsIDQ0LCAyMzApOwogICAgICAgIGlmIChpZCA9PSA2MCkgcmV0dXJuICgxMDEsIDgyLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDE2NykgcmV0dXJuICgxMDUsIDczLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDIxKSByZXR1cm4gKDExMiwgNjEsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTY1KSByZXR1cm4gKDcyLCAxNDIsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTYzKSByZXR1cm4gKDY3LCAxMDEsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDUyKSByZXR1cm4gKDkyLCA4MSwgODApOwogICAgICAgIGlmIChpZCA9PSAxOSkgcmV0dXJuICgxMDMsIDcwLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDE2KSByZXR1cm4gKDg1LCA3NiwgODApOwogICAgICAgIGlmIChpZCA9PSA0MSkgcmV0dXJuICg4MywgNzYsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTYxKSByZXR1cm4gKDc5LCA3NywgNzApOwogICAgICAgIGlmIChpZCA9PSAxODcpIHJldHVybiAoNjcsIDEwMSwgNzApOwogICAgICAgIGlmIChpZCA9PSA1MCkgcmV0dXJuICgxMDksIDg4LCAyMCk7CiAgICAgICAgaWYgKGlkID09IDE4MykgcmV0dXJuICgzNywgOTMsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDEzKSByZXR1cm4gKDYzLCA1NSwgODApOwogICAgICAgIGlmIChpZCA9PSAxMCkgcmV0dXJuICg1NSwgNjIsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMTkxKSByZXR1cm4gKDU1LCA1NSwgNjApOwogICAgICAgIGlmIChpZCA9PSA0MykgcmV0dXJuICgxMzEsIDExNiwgOTApOwogICAgICAgIGlmIChpZCA9PSAxMjkpIHJldHVybiAoMjksIDEwMiwgNDApOwogICAgICAgIHJldHVybiAoMCwgMCwgMCk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNxcnQodWludDI1NiB4KSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2IHkpIHsKICAgICAgICB1aW50MjU2IHogPSAoeCArIDEpIC8gMjsKICAgICAgICB5ID0geDsKICAgICAgICB3aGlsZSAoeiA8IHkpIHsKICAgICAgICAgICAgeSA9IHo7CiAgICAgICAgICAgIHogPSAoeCAvIHogKyB6KSAvIDI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1heENQKHVpbnQyNTYgZ2VuZXMsIHVpbnQxNiBnZW5lcmF0aW9uKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MzIgbWF4X2NwKSB7CiAgICAgICAgdmFyIGNvZGUgPSB1aW50OChnZW5lcyAmIDB4RkYpOwogICAgICAgIHZhciBhID0gdWludDMyKChnZW5lcyA+PiA4KSAmIDB4RkYpOwogICAgICAgIHZhciBkID0gdWludDMyKChnZW5lcyA+PiAxNikgJiAweEZGKTsKICAgICAgICB2YXIgcyA9IHVpbnQzMigoZ2VuZXMgPj4gMjQpICYgMHhGRik7CiAgICAgICAgLy8gICAgICB2YXIgZ2VuZGVyID0gdWludDMyKChnZW5lcyA+PiAzMikgJiAweDEpOwogICAgICAgIHZhciBiZ0NvbG9yID0gdWludDgoKGdlbmVzID4+IDMzKSAmIDB4RkYpOwogICAgICAgIHZhciAocmEsIHJkLCBycykgPSBnZXRCYXNlU3RhdHMoY29kZSk7CgoKICAgICAgICBtYXhfY3AgPSB1aW50MzIoc3FydCh1aW50MjU2KHJhICsgYSkgKiB1aW50MjU2KHJhICsgYSkgKiB1aW50MjU2KHJkICsgZCkgKiB1aW50MjU2KHJzICsgcykgKiAzOTAwOTI3OTM4OTkzMjgxLzEwMDAwMDAwMDAwMDAwMDAwIC8gMTAwKSk7CiAgICAgICAgaWYobWF4X2NwIDwgMTApCiAgICAgICAgbWF4X2NwID0gMTA7CgogICAgICAgIGlmKGdlbmVyYXRpb24gPCAxMCkKICAgICAgICBtYXhfY3AgKz0gKDEwIC0gZ2VuZXJhdGlvbikgKiA1MDsKCiAgICAgICAgLy8gYmdDb2xvcgogICAgICAgIGlmKGJnQ29sb3IgPj0gOCkKICAgICAgICBiZ0NvbG9yID0gMDsKCiAgICAgICAgbWF4X2NwICs9IGJnQ29sb3IgKiAyNTsKICAgICAgICByZXR1cm4gbWF4X2NwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGUodWludDI1NiBnZW5lcykgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoZ2VuZXMgJiAweEZGKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBdHRhY2sodWludDI1NiBnZW5lcykgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoKGdlbmVzID4+IDgpICYgMHhGRik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVmZW5zZSh1aW50MjU2IGdlbmVzKSBwdXJlIHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiB1aW50OCgoZ2VuZXMgPj4gMTYpICYgMHhGRik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0U3RhbWluYSh1aW50MjU2IGdlbmVzKSBwdXJlIHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiB1aW50OCgoZ2VuZXMgPj4gMjQpICYgMHhGRik7CiAgICB9CgogICAgLy8vIEBkZXYgZ2l2ZW4gZ2VuZXMgb2Yga2l0dGVuIDEgJiAyLCByZXR1cm4gYSBnZW5ldGljIGNvbWJpbmF0aW9uIC0gbWF5IGhhdmUgYSByYW5kb20gZmFjdG9yCiAgICAvLy8gQHBhcmFtIGdlbmVzMSBnZW5lcyBvZiBtb20KICAgIC8vLyBAcGFyYW0gZ2VuZXMyIGdlbmVzIG9mIHNpcmUKICAgIC8vLyBAcmV0dXJuIHRoZSBnZW5lcyB0aGF0IGFyZSBzdXBwb3NlZCB0byBiZSBwYXNzZWQgZG93biB0aGUgY2hpbGQKICAgIGZ1bmN0aW9uIG1peEdlbmVzKHVpbnQyNTYgZ2VuZXMxLCB1aW50MjU2IGdlbmVzMiwgdWludDI1NiB0YXJnZXRCbG9jaykgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCiAgICAgICAgdWludDggY29kZTsKICAgICAgICB2YXIgciA9IHJhbmRvbSgzKTsKCiAgICAgICAgLy8gNjAgcGVyY2VudCBvZiBwYXJlbnRzIEROQQogICAgICAgIGlmKHIgPT0gMCkKICAgICAgICBjb2RlID0gZ2V0Q29kZShnZW5lczEpOwogICAgICAgIGVsc2UgaWYociA9PSAxKQogICAgICAgIGNvZGUgPSBnZXRDb2RlKGdlbmVzMik7CiAgICAgICAgZWxzZQogICAgICAgIGNvZGUgPSByYW5kb21Db2RlKCk7CgogICAgICAgIC8vIDcwJSBwZXJjZW50IG9mIHBhcmVudHMgRE5BCiAgICAgICAgdmFyIGF0dGFjayA9IHJhbmRvbSgzKSA9PSAwID8gdWludDgocmFuZG9tKDMyKSkgOiB1aW50OChyYW5kb21CZXR3ZWVuKGdldEF0dGFjayhnZW5lczEpLCBnZXRBdHRhY2soZ2VuZXMyKSkpOwogICAgICAgIHZhciBkZWZlbnNlID0gcmFuZG9tKDMpID09IDAgPyB1aW50OChyYW5kb20oMzIpKSA6IHVpbnQ4KHJhbmRvbUJldHdlZW4oZ2V0RGVmZW5zZShnZW5lczEpLCBnZXREZWZlbnNlKGdlbmVzMikpKTsKICAgICAgICB2YXIgc3RhbWluYSA9IHJhbmRvbSgzKSA9PSAwID8gdWludDgocmFuZG9tKDMyKSkgOiB1aW50OChyYW5kb21CZXR3ZWVuKGdldFN0YW1pbmEoZ2VuZXMxKSwgZ2V0U3RhbWluYShnZW5lczIpKSk7CiAgICAgICAgdmFyIGdlbmRlciA9IHVpbnQ4KHJhbmRvbSgyKSk7CiAgICAgICAgdmFyIGJnQ29sb3IgPSB1aW50OChyYW5kb20oOCkpOwogICAgICAgIHZhciByYW5kID0gcmFuZG9tKH51aW50NjQoMCkpOwoKICAgICAgICByZXR1cm4gdWludDI1Nihjb2RlKSAvLyA4CiAgICAgICAgfCAodWludDI1NihhdHRhY2spIDw8IDgpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KGRlZmVuc2UpIDw8IDE2KSAvLyA4CiAgICAgICAgfCAodWludDI1NihzdGFtaW5hKSA8PCAyNCkgLy8gOAogICAgICAgIHwgKHVpbnQyNTYoZ2VuZGVyKSA8PCAzMikgLy8gMQogICAgICAgIHwgKHVpbnQyNTYoYmdDb2xvcikgPDwgMzMpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KHJhbmQpIDw8IDQxKSAvLyA2NAogICAgICAgIDsKICAgIH0KCiAgICBmdW5jdGlvbiByYW5kb21HZW5lcygpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdmFyIGNvZGUgPSByYW5kb21Db2RlKCk7CiAgICAgICAgdmFyIGF0dGFjayA9IHVpbnQ4KHJhbmRvbSgzMikpOwogICAgICAgIHZhciBkZWZlbnNlID0gdWludDgocmFuZG9tKDMyKSk7CiAgICAgICAgdmFyIHN0YW1pbmEgPSB1aW50OChyYW5kb20oMzIpKTsKICAgICAgICB2YXIgZ2VuZGVyID0gdWludDgocmFuZG9tKDIpKTsKICAgICAgICB2YXIgYmdDb2xvciA9IHVpbnQ4KHJhbmRvbSg4KSk7CiAgICAgICAgdmFyIHJhbmQgPSByYW5kb20ofnVpbnQ2NCgwKSk7CgogICAgICAgIHJldHVybiB1aW50MjU2KGNvZGUpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KGF0dGFjaykgPDwgOCkgLy8gOAogICAgICAgIHwgKHVpbnQyNTYoZGVmZW5zZSkgPDwgMTYpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KHN0YW1pbmEpIDw8IDI0KSAvLyA4CiAgICAgICAgfCAodWludDI1NihnZW5kZXIpIDw8IDMyKSAvLyAxCiAgICAgICAgfCAodWludDI1NihiZ0NvbG9yKSA8PCAzMykgLy8gOAogICAgICAgIHwgKHVpbnQyNTYocmFuZCkgPDwgNDEpIC8vIDY0CiAgICAgICAgOwogICAgfQp9CgoKLy8vIEB0aXRsZSBDbG9jayBhdWN0aW9uIG1vZGlmaWVkIGZvciBzYWxlIG9mIG1vbnN0ZXJzCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgU2FsZUNsb2NrQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTYWxlQXVjdGlvbkFkZHJlc3MoKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNTYWxlQ2xvY2tBdWN0aW9uID0gdHJ1ZTsKCiAgICAvLyBUcmFja3MgbGFzdCA1IHNhbGUgcHJpY2Ugb2YgZ2VuMCBtb25zdGVyIHNhbGVzCiAgICB1aW50MjU2IHB1YmxpYyBnZW4wU2FsZUNvdW50OwogICAgdWludDI1Nls1XSBwdWJsaWMgbGFzdEdlbjBTYWxlUHJpY2VzOwoKICAgIC8vIERlbGVnYXRlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTYWxlQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHIsIHVpbnQyNTYgX2N1dCkgcHVibGljCiAgICBDbG9ja0F1Y3Rpb24oX25mdEFkZHIsIF9jdXQpIHt9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIGF1Y3Rpb24gKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgdWludDI1NiBfdG9rZW5JZCwKICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgYWRkcmVzcyBfc2VsbGVyCiAgICApCiAgICBleHRlcm5hbAogICAgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZAogICAgICAgIC8vIHRvIHN0b3JlIHRoZW0gaW4gdGhlIGF1Y3Rpb24gc3RydWN0LgogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwoKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSk7CiAgICAgICAgX2VzY3Jvdyhfc2VsbGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgX3NlbGxlciwKICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIGxhc3RTYWxlUHJpY2UgaWYgc2VsbGVyIGlzIHRoZSBuZnQgY29udHJhY3QKICAgIC8vLyBPdGhlcndpc2UsIHdvcmtzIHRoZSBzYW1lIGFzIGRlZmF1bHQgYmlkIG1ldGhvZC4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHsKICAgICAgICAvLyBfYmlkIHZlcmlmaWVzIHRva2VuIElEIHNpemUKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICB1aW50MjU2IHByaWNlID0gX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAvLyBJZiBub3QgYSBnZW4wIGF1Y3Rpb24sIGV4aXQKICAgICAgICBpZiAoc2VsbGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpIHsKICAgICAgICAgICAgLy8gVHJhY2sgZ2VuMCBzYWxlIHByaWNlcwogICAgICAgICAgICBsYXN0R2VuMFNhbGVQcmljZXNbZ2VuMFNhbGVDb3VudCAlIDVdID0gcHJpY2U7CiAgICAgICAgICAgIGdlbjBTYWxlQ291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZUdlbjBTYWxlUHJpY2UoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBsYXN0R2VuMFNhbGVQcmljZXNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdW0gLyA1OwogICAgfQoKfQoKCgovLy8gQHRpdGxlIFJldmVyc2UgYXVjdGlvbiBtb2RpZmllZCBmb3Igc2lyaW5nCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgU2lyaW5nQ2xvY2tBdWN0aW9uIGlzIENsb2NrQXVjdGlvbiB7CgogICAgLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IGF1Y3Rpb24gaW4gb3VyIHNldFNpcmluZ0F1Y3Rpb25BZGRyZXNzKCkgY2FsbC4KICAgIGJvb2wgcHVibGljIGlzU2lyaW5nQ2xvY2tBdWN0aW9uID0gdHJ1ZTsKCiAgICAvLyBEZWxlZ2F0ZSBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU2lyaW5nQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHIsIHVpbnQyNTYgX2N1dCkgcHVibGljCiAgICBDbG9ja0F1Y3Rpb24oX25mdEFkZHIsIF9jdXQpIHt9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uIFNpbmNlIHRoaXMgZnVuY3Rpb24gaXMgd3JhcHBlZCwKICAgIC8vLyByZXF1aXJlIHNlbmRlciB0byBiZSBNb25zdGVyQ29yZSBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICB1aW50MjU2IF90b2tlbklkLAogICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgdWludDI1NiBfZHVyYXRpb24sCiAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICBfc2VsbGVyLAogICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgfQoKICAgIC8vLyBAZGV2IFBsYWNlcyBhIGJpZCBmb3Igc2lyaW5nLiBSZXF1aXJlcyB0aGUgc2VuZGVyCiAgICAvLy8gaXMgdGhlIE1vbnN0ZXJDb3JlIGNvbnRyYWN0IGJlY2F1c2UgYWxsIGJpZCBtZXRob2RzCiAgICAvLy8gc2hvdWxkIGJlIHdyYXBwZWQuIEFsc28gcmV0dXJucyB0aGUgbW9uc3RlciB0byB0aGUKICAgIC8vLyBzZWxsZXIgcmF0aGVyIHRoYW4gdGhlIHdpbm5lci4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSk7CiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXS5zZWxsZXI7CiAgICAgICAgLy8gX2JpZCBjaGVja3MgdGhhdCB0b2tlbiBJRCBpcyB2YWxpZCBhbmQgd2lsbCB0aHJvdyBpZiBiaWQgZmFpbHMKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIC8vIFdlIHRyYW5zZmVyIHRoZSBtb25zdGVyIGJhY2sgdG8gdGhlIHNlbGxlciwgdGhlIHdpbm5lciB3aWxsIGdldAogICAgICAgIC8vIHRoZSBvZmZzcHJpbmcKICAgICAgICBfdHJhbnNmZXIoc2VsbGVyLCBfdG9rZW5JZCk7CiAgICB9Cgp9CgoKCgoKCgovLy8gQHRpdGxlIEEgZmFjZXQgb2YgTW9uc3RlckNvcmUgdGhhdCBtYW5hZ2VzIHNwZWNpYWwgYWNjZXNzIHByaXZpbGVnZXMuCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFNlZSB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBNb25zdGVyQWNjZXNzQ29udHJvbCB7CiAgICAvLyBUaGlzIGZhY2V0IGNvbnRyb2xzIGFjY2VzcyBjb250cm9sIGZvciBDcnlwdG9Nb25zdGVycy4gVGhlcmUgYXJlIGZvdXIgcm9sZXMgbWFuYWdlZCBoZXJlOgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDRU86IFRoZSBDRU8gY2FuIHJlYXNzaWduIG90aGVyIHJvbGVzIGFuZCBjaGFuZ2UgdGhlIGFkZHJlc3NlcyBvZiBvdXIgZGVwZW5kZW50IHNtYXJ0CiAgICAvLyAgICAgICAgIGNvbnRyYWN0cy4gSXQgaXMgYWxzbyB0aGUgb25seSByb2xlIHRoYXQgY2FuIHVucGF1c2UgdGhlIHNtYXJ0IGNvbnRyYWN0LiBJdCBpcyBpbml0aWFsbHkKICAgIC8vICAgICAgICAgc2V0IHRvIHRoZSBhZGRyZXNzIHRoYXQgY3JlYXRlZCB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIE1vbnN0ZXJDb3JlIGNvbnN0cnVjdG9yLgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDRk86IFRoZSBDRk8gY2FuIHdpdGhkcmF3IGZ1bmRzIGZyb20gTW9uc3RlckNvcmUgYW5kIGl0cyBhdWN0aW9uIGNvbnRyYWN0cy4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ09POiBUaGUgQ09PIGNhbiByZWxlYXNlIGdlbjAgbW9uc3RlcnMgdG8gYXVjdGlvbiwgYW5kIG1pbnQgcHJvbW8gbW9uc3RlcnMuCiAgICAvLwogICAgLy8gSXQgc2hvdWxkIGJlIG5vdGVkIHRoYXQgdGhlc2Ugcm9sZXMgYXJlIGRpc3RpbmN0IHdpdGhvdXQgb3ZlcmxhcCBpbiB0aGVpciBhY2Nlc3MgYWJpbGl0aWVzLCB0aGUKICAgIC8vIGFiaWxpdGllcyBsaXN0ZWQgZm9yIGVhY2ggcm9sZSBhYm92ZSBhcmUgZXhoYXVzdGl2ZS4gSW4gcGFydGljdWxhciwgd2hpbGUgdGhlIENFTyBjYW4gYXNzaWduIGFueQogICAgLy8gYWRkcmVzcyB0byBhbnkgcm9sZSwgdGhlIENFTyBhZGRyZXNzIGl0c2VsZiBkb2Vzbid0IGhhdmUgdGhlIGFiaWxpdHkgdG8gYWN0IGluIHRob3NlIHJvbGVzLiBUaGlzCiAgICAvLyByZXN0cmljdGlvbiBpcyBpbnRlbnRpb25hbCBzbyB0aGF0IHdlIGFyZW4ndCB0ZW1wdGVkIHRvIHVzZSB0aGUgQ0VPIGFkZHJlc3MgZnJlcXVlbnRseSBvdXQgb2YKICAgIC8vIGNvbnZlbmllbmNlLiBUaGUgbGVzcyB3ZSB1c2UgYW4gYWRkcmVzcywgdGhlIGxlc3MgbGlrZWx5IGl0IGlzIHRoYXQgd2Ugc29tZWhvdyBjb21wcm9taXNlIHRoZQogICAgLy8gYWNjb3VudC4KCiAgICAvLy8gQGRldiBFbWl0ZWQgd2hlbiBjb250cmFjdCBpcyB1cGdyYWRlZCAtIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKCiAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBjZW9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY2ZvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNvb0FkZHJlc3M7CgogICAgLy8gQGRldiBLZWVwcyB0cmFjayB3aGV0aGVyIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0VPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDRk8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDT08tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q09PKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb29BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MgfHwKICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICBtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MKICAgICAgICApOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0VPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0ZPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRk8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRk8KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2ZvQWRkcmVzcyA9IF9uZXdDRk87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ09PLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDT08gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NPTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgICB9CgogICAgLyoqKiBQYXVzYWJsZSBmdW5jdGlvbmFsaXR5IGFkYXB0ZWQgZnJvbSBPcGVuWmVwcGVsaW4gKioqLwoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxsZWQgYnkgYW55ICJDLWxldmVsIiByb2xlIHRvIHBhdXNlIHRoZSBjb250cmFjdC4gVXNlZCBvbmx5IHdoZW4KICAgIC8vLyAgYSBidWcgb3IgZXhwbG9pdCBpcyBkZXRlY3RlZCBhbmQgd2UgbmVlZCB0byBsaW1pdCBkYW1hZ2UuCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBVbnBhdXNlcyB0aGUgc21hcnQgY29udHJhY3QuIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQ0VPLCBzaW5jZQogICAgLy8vICBvbmUgcmVhc29uIHdlIG1heSBwYXVzZSB0aGUgY29udHJhY3QgaXMgd2hlbiBDRk8gb3IgQ09PIGFjY291bnRzIGFyZQogICAgLy8vICBjb21wcm9taXNlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIGl0IGNhbiBiZSBjYWxsZWQgYnkKICAgIC8vLyAgZGVyaXZlZCBjb250cmFjdHMuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgLy8gY2FuJ3QgdW5wYXVzZSBpZiBjb250cmFjdCB3YXMgdXBncmFkZWQKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KfQoKCgoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBDcnlwdG9Nb25zdGVycy4gSG9sZHMgYWxsIGNvbW1vbiBzdHJ1Y3RzLCBldmVudHMgYW5kIGJhc2UgdmFyaWFibGVzLgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKQovLy8gQGRldiBTZWUgdGhlIE1vbnN0ZXJDb3JlIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gdG8gdW5kZXJzdGFuZCBob3cgdGhlIHZhcmlvdXMgY29udHJhY3QgZmFjZXRzIGFyZSBhcnJhbmdlZC4KY29udHJhY3QgTW9uc3RlckJhc2UgaXMgTW9uc3RlckFjY2Vzc0NvbnRyb2wgewogICAgLyoqKiBFVkVOVFMgKioqLwoKICAgIC8vLyBAZGV2IFRoZSBCaXJ0aCBldmVudCBpcyBmaXJlZCB3aGVuZXZlciBhIG5ldyBtb25zdGVyIGNvbWVzIGludG8gZXhpc3RlbmNlLiBUaGlzIG9idmlvdXNseQogICAgLy8vICBpbmNsdWRlcyBhbnkgdGltZSBhIG1vbnN0ZXIgaXMgY3JlYXRlZCB0aHJvdWdoIHRoZSBnaXZlQmlydGggbWV0aG9kLCBidXQgaXQgaXMgYWxzbyBjYWxsZWQKICAgIC8vLyAgd2hlbiBhIG5ldyBnZW4wIG1vbnN0ZXIgaXMgY3JlYXRlZC4KICAgIGV2ZW50IEJpcnRoKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgbW9uc3RlcklkLCB1aW50MjU2IG1hdHJvbklkLCB1aW50MjU2IHNpcmVJZCwgdWludDI1NiBnZW5lcywgdWludDE2IGdlbmVyYXRpb24pOwoKICAgIC8vLyBAZGV2IFRyYW5zZmVyIGV2ZW50IGFzIGRlZmluZWQgaW4gY3VycmVudCBkcmFmdCBvZiBFUkM3MjEuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIG1vbnN0ZXIKICAgIC8vLyAgb3duZXJzaGlwIGlzIGFzc2lnbmVkLCBpbmNsdWRpbmcgYmlydGhzLgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8qKiogREFUQSBUWVBFUyAqKiovCgogICAgLy8vIEBkZXYgVGhlIG1haW4gTW9uc3RlciBzdHJ1Y3QuIEV2ZXJ5IG1vbnN0ZXIgaW4gQ3J5cHRvTW9uc3RlcnMgaXMgcmVwcmVzZW50ZWQgYnkgYSBjb3B5CiAgICAvLy8gIG9mIHRoaXMgc3RydWN0dXJlLCBzbyBncmVhdCBjYXJlIHdhcyB0YWtlbiB0byBlbnN1cmUgdGhhdCBpdCBmaXRzIG5lYXRseSBpbnRvCiAgICAvLy8gIGV4YWN0bHkgdHdvIDI1Ni1iaXQgd29yZHMuIE5vdGUgdGhhdCB0aGUgb3JkZXIgb2YgdGhlIG1lbWJlcnMgaW4gdGhpcyBzdHJ1Y3R1cmUKICAgIC8vLyAgaXMgaW1wb3J0YW50IGJlY2F1c2Ugb2YgdGhlIGJ5dGUtcGFja2luZyBydWxlcyB1c2VkIGJ5IEV0aGVyZXVtLgogICAgLy8vICBSZWY6IGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9kZXZlbG9wL21pc2NlbGxhbmVvdXMuaHRtbAogICAgc3RydWN0IE1vbnN0ZXIgewogICAgLy8gVGhlIE1vbnN0ZXIncyBnZW5ldGljIGNvZGUgaXMgcGFja2VkIGludG8gdGhlc2UgMjU2LWJpdHMsIHRoZSBmb3JtYXQgaXMKICAgIC8vIHNvb3Blci1zZWtyZXQhIEEgbW9uc3RlcidzIGdlbmVzIG5ldmVyIGNoYW5nZS4KICAgIHVpbnQyNTYgZ2VuZXM7CgogICAgLy8gVGhlIHRpbWVzdGFtcCBmcm9tIHRoZSBibG9jayB3aGVuIHRoaXMgbW9uc3RlciBjYW1lIGludG8gZXhpc3RlbmNlLgogICAgdWludDY0IGJpcnRoVGltZTsKCiAgICAvLyBUaGUgbWluaW11bSB0aW1lc3RhbXAgYWZ0ZXIgd2hpY2ggdGhpcyBtb25zdGVyIGNhbiBlbmdhZ2UgaW4gYnJlZWRpbmcKICAgIC8vIGFjdGl2aXRpZXMgYWdhaW4uIFRoaXMgc2FtZSB0aW1lc3RhbXAgaXMgdXNlZCBmb3IgdGhlIHByZWduYW5jeQogICAgLy8gdGltZXIgKGZvciBtYXRyb25zKSBhcyB3ZWxsIGFzIHRoZSBzaXJpbmcgY29vbGRvd24uCiAgICB1aW50NjQgY29vbGRvd25FbmRCbG9jazsKCiAgICAvLyBUaGUgSUQgb2YgdGhlIHBhcmVudHMgb2YgdGhpcyBtb25zdGVyLCBzZXQgdG8gMCBmb3IgZ2VuMCBtb25zdGVycy4KICAgIC8vIE5vdGUgdGhhdCB1c2luZyAzMi1iaXQgdW5zaWduZWQgaW50ZWdlcnMgbGltaXRzIHVzIHRvIGEgIm1lcmUiCiAgICAvLyA0IGJpbGxpb24gbW9uc3RlcnMuIFRoaXMgbnVtYmVyIG1pZ2h0IHNlZW0gc21hbGwgdW50aWwgeW91IHJlYWxpemUKICAgIC8vIHRoYXQgRXRoZXJldW0gY3VycmVudGx5IGhhcyBhIGxpbWl0IG9mIGFib3V0IDUwMCBtaWxsaW9uCiAgICAvLyB0cmFuc2FjdGlvbnMgcGVyIHllYXIhIFNvLCB0aGlzIGRlZmluaXRlbHkgd29uJ3QgYmUgYSBwcm9ibGVtCiAgICAvLyBmb3Igc2V2ZXJhbCB5ZWFycyAoZXZlbiBhcyBFdGhlcmV1bSBsZWFybnMgdG8gc2NhbGUpLgogICAgdWludDMyIG1hdHJvbklkOwogICAgdWludDMyIHNpcmVJZDsKCiAgICAvLyBTZXQgdG8gdGhlIElEIG9mIHRoZSBzaXJlIG1vbnN0ZXIgZm9yIG1hdHJvbnMgdGhhdCBhcmUgcHJlZ25hbnQsCiAgICAvLyB6ZXJvIG90aGVyd2lzZS4gQSBub24temVybyB2YWx1ZSBoZXJlIGlzIGhvdyB3ZSBrbm93IGEgbW9uc3RlcgogICAgLy8gaXMgcHJlZ25hbnQuIFVzZWQgdG8gcmV0cmlldmUgdGhlIGdlbmV0aWMgbWF0ZXJpYWwgZm9yIHRoZSBuZXcKICAgIC8vIG1vbnN0ZXIgd2hlbiB0aGUgYmlydGggdHJhbnNwaXJlcy4KICAgIHVpbnQzMiBzaXJpbmdXaXRoSWQ7CgogICAgLy8gU2V0IHRvIHRoZSBpbmRleCBpbiB0aGUgY29vbGRvd24gYXJyYXkgKHNlZSBiZWxvdykgdGhhdCByZXByZXNlbnRzCiAgICAvLyB0aGUgY3VycmVudCBjb29sZG93biBkdXJhdGlvbiBmb3IgdGhpcyBNb25zdGVyLiBUaGlzIHN0YXJ0cyBhdCB6ZXJvCiAgICAvLyBmb3IgZ2VuMCBtb25zdGVycywgYW5kIGlzIGluaXRpYWxpemVkIHRvIGZsb29yKGdlbmVyYXRpb24vMikgZm9yIG90aGVycy4KICAgIC8vIEluY3JlbWVudGVkIGJ5IG9uZSBmb3IgZWFjaCBzdWNjZXNzZnVsIGJyZWVkaW5nIGFjdGlvbiwgcmVnYXJkbGVzcwogICAgLy8gb2Ygd2hldGhlciB0aGlzIG1vbnN0ZXIgaXMgYWN0aW5nIGFzIG1hdHJvbiBvciBzaXJlLgogICAgdWludDE2IGNvb2xkb3duSW5kZXg7CgogICAgLy8gVGhlICJnZW5lcmF0aW9uIG51bWJlciIgb2YgdGhpcyBtb25zdGVyLiBNb25zdGVycyBtaW50ZWQgYnkgdGhlIENLIGNvbnRyYWN0CiAgICAvLyBmb3Igc2FsZSBhcmUgY2FsbGVkICJnZW4wIiBhbmQgaGF2ZSBhIGdlbmVyYXRpb24gbnVtYmVyIG9mIDAuIFRoZQogICAgLy8gZ2VuZXJhdGlvbiBudW1iZXIgb2YgYWxsIG90aGVyIG1vbnN0ZXJzIGlzIHRoZSBsYXJnZXIgb2YgdGhlIHR3byBnZW5lcmF0aW9uCiAgICAvLyBudW1iZXJzIG9mIHRoZWlyIHBhcmVudHMsIHBsdXMgb25lLgogICAgLy8gKGkuZS4gbWF4KG1hdHJvbi5nZW5lcmF0aW9uLCBzaXJlLmdlbmVyYXRpb24pICsgMSkKICAgIHVpbnQxNiBnZW5lcmF0aW9uOwogICAgfQoKICAgIC8qKiogQ09OU1RBTlRTICoqKi8KCiAgICAvLy8gQGRldiBBIGxvb2t1cCB0YWJsZSBpbmRpbW9uc3RlcmluZyB0aGUgY29vbGRvd24gZHVyYXRpb24gYWZ0ZXIgYW55IHN1Y2Nlc3NmdWwKICAgIC8vLyAgYnJlZWRpbmcgYWN0aW9uLCBjYWxsZWQgInByZWduYW5jeSB0aW1lIiBmb3IgbWF0cm9ucyBhbmQgInNpcmluZyBjb29sZG93biIKICAgIC8vLyAgZm9yIHNpcmVzLiBEZXNpZ25lZCBzdWNoIHRoYXQgdGhlIGNvb2xkb3duIHJvdWdobHkgZG91YmxlcyBlYWNoIHRpbWUgYSBtb25zdGVyCiAgICAvLy8gIGlzIGJyZWQsIGVuY291cmFnaW5nIG93bmVycyBub3QgdG8ganVzdCBrZWVwIGJyZWVkaW5nIHRoZSBzYW1lIG1vbnN0ZXIgb3ZlcgogICAgLy8vICBhbmQgb3ZlciBhZ2Fpbi4gQ2FwcyBvdXQgYXQgb25lIHdlZWsgKGEgbW9uc3RlciBjYW4gYnJlZWQgYW4gdW5ib3VuZGVkIG51bWJlcgogICAgLy8vICBvZiB0aW1lcywgYW5kIHRoZSBtYXhpbXVtIGNvb2xkb3duIGlzIGFsd2F5cyBzZXZlbiBkYXlzKS4KICAgIHVpbnQzMlsxNF0gcHVibGljIGNvb2xkb3ducyA9IFsKICAgIHVpbnQzMigxIG1pbnV0ZXMpLAogICAgdWludDMyKDIgbWludXRlcyksCiAgICB1aW50MzIoNSBtaW51dGVzKSwKICAgIHVpbnQzMigxMCBtaW51dGVzKSwKICAgIHVpbnQzMigzMCBtaW51dGVzKSwKICAgIHVpbnQzMigxIGhvdXJzKSwKICAgIHVpbnQzMigyIGhvdXJzKSwKICAgIHVpbnQzMig0IGhvdXJzKSwKICAgIHVpbnQzMig4IGhvdXJzKSwKICAgIHVpbnQzMigxNiBob3VycyksCiAgICB1aW50MzIoMSBkYXlzKSwKICAgIHVpbnQzMigyIGRheXMpLAogICAgdWludDMyKDQgZGF5cyksCiAgICB1aW50MzIoNyBkYXlzKQogICAgXTsKCiAgICAvLyBBbiBhcHByb3hpbWF0aW9uIG9mIGN1cnJlbnRseSBob3cgbWFueSBzZWNvbmRzIGFyZSBpbiBiZXR3ZWVuIGJsb2Nrcy4KICAgIHVpbnQyNTYgcHVibGljIHNlY29uZHNQZXJCbG9jayA9IDE1OwoKICAgIC8qKiogU1RPUkFHRSAqKiovCgogICAgLy8vIEBkZXYgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgTW9uc3RlciBzdHJ1Y3QgZm9yIGFsbCBNb25zdGVycyBpbiBleGlzdGVuY2UuIFRoZSBJRAogICAgLy8vICBvZiBlYWNoIG1vbnN0ZXIgaXMgYWN0dWFsbHkgYW4gaW5kZXggaW50byB0aGlzIGFycmF5LiBOb3RlIHRoYXQgSUQgMCBpcyBhIG5lZ2Ftb25zdGVyLAogICAgLy8vICB0aGUgdW5Nb25zdGVyLCB0aGUgbXl0aGljYWwgYmVhc3QgdGhhdCBpcyB0aGUgcGFyZW50IG9mIGFsbCBnZW4wIG1vbnN0ZXJzLiBBIGJpemFycmUKICAgIC8vLyAgY3JlYXR1cmUgdGhhdCBpcyBib3RoIG1hdHJvbiBhbmQgc2lyZS4uLiB0byBpdHNlbGYhIEhhcyBhbiBpbnZhbGlkIGdlbmV0aWMgY29kZS4KICAgIC8vLyAgSW4gb3RoZXIgd29yZHMsIG1vbnN0ZXIgSUQgMCBpcyBpbnZhbGlkLi4uIDstKQogICAgTW9uc3RlcltdIG1vbnN0ZXJzOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIG1vbnN0ZXIgSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLiBBbGwgbW9uc3RlcnMgaGF2ZQogICAgLy8vICBzb21lIHZhbGlkIG93bmVyIGFkZHJlc3MsIGV2ZW4gZ2VuMCBtb25zdGVycyBhcmUgY3JlYXRlZCB3aXRoIGEgbm9uLXplcm8gb3duZXIuCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIG1vbnN0ZXJJbmRleFRvT3duZXI7CgogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgIC8vICBVc2VkIGludGVybmFsbHkgaW5zaWRlIGJhbGFuY2VPZigpIHRvIHJlc29sdmUgb3duZXJzaGlwIGNvdW50LgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gTW9uc3RlcklEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gRWFjaCBNb25zdGVyIGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRyYW5zZmVyCiAgICAvLy8gIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gTW9uc3RlcklEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gdXNlCiAgICAvLy8gIHRoaXMgTW9uc3RlciBmb3Igc2lyaW5nIHZpYSBicmVlZFdpdGgoKS4gRWFjaCBNb25zdGVyIGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkCiAgICAvLy8gIGFkZHJlc3MgZm9yIHNpcmluZyBhdCBhbnkgdGltZS4gQSB6ZXJvIHZhbHVlIG1lYW5zIG5vIGFwcHJvdmFsIGlzIG91dHN0YW5kaW5nLgogICAgbWFwcGluZyh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBzaXJlQWxsb3dlZFRvQWRkcmVzczsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgQ2xvY2tBdWN0aW9uIGNvbnRyYWN0IHRoYXQgaGFuZGxlcyBzYWxlcyBvZiBNb25zdGVycy4gVGhpcwogICAgLy8vICBzYW1lIGNvbnRyYWN0IGhhbmRsZXMgYm90aCBwZWVyLXRvLXBlZXIgc2FsZXMgYXMgd2VsbCBhcyB0aGUgZ2VuMCBzYWxlcyB3aGljaCBhcmUKICAgIC8vLyAgaW5pdGlhdGVkIGV2ZXJ5IDE1IG1pbnV0ZXMuCiAgICBTYWxlQ2xvY2tBdWN0aW9uIHB1YmxpYyBzYWxlQXVjdGlvbjsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiBhIGN1c3RvbSBDbG9ja0F1Y3Rpb24gc3ViY2xhc3NlZCBjb250cmFjdCB0aGF0IGhhbmRsZXMgc2lyaW5nCiAgICAvLy8gIGF1Y3Rpb25zLiBOZWVkcyB0byBiZSBzZXBhcmF0ZSBmcm9tIHNhbGVBdWN0aW9uIGJlY2F1c2UgdGhlIGFjdGlvbnMgdGFrZW4gb24gc3VjY2VzcwogICAgLy8vICBhZnRlciBhIHNhbGVzIGFuZCBzaXJpbmcgYXVjdGlvbiBhcmUgcXVpdGUgZGlmZmVyZW50LgogICAgU2lyaW5nQ2xvY2tBdWN0aW9uIHB1YmxpYyBzaXJpbmdBdWN0aW9uOwoKICAgIEdlbmVTY2llbmNlIHB1YmxpYyBnZW5lU2NpZW5jZTsKCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIE1vbnN0ZXIgdG8gYW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFNpbmNlIHRoZSBudW1iZXIgb2YgbW9uc3RlcnMgaXMgY2FwcGVkIHRvIDJeMzIgd2UgY2FuJ3Qgb3ZlcmZsb3cgdGhpcwogICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX3RvXSsrOwogICAgICAgIC8vIHRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgIG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwoKICAgICAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyBtb25zdGVycyBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwogICAgICAgICAgICAvLyBvbmNlIHRoZSBtb25zdGVyIGlzIHRyYW5zZmVycmVkIGFsc28gY2xlYXIgc2lyZSBhbGxvd2FuY2VzCiAgICAgICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfdG9rZW5JZF07CiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUgbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgfQogICAgICAgIC8vIEVtaXQgdGhlIHRyYW5zZmVyIGV2ZW50LgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbiBpbnRlcm5hbCBtZXRob2QgdGhhdCBjcmVhdGVzIGEgbmV3IG1vbnN0ZXIgYW5kIHN0b3JlcyBpdC4gVGhpcwogICAgLy8vICBtZXRob2QgZG9lc24ndCBkbyBhbnkgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIHRoZQogICAgLy8vICBpbnB1dCBkYXRhIGlzIGtub3duIHRvIGJlIHZhbGlkLiBXaWxsIGdlbmVyYXRlIGJvdGggYSBCaXJ0aCBldmVudAogICAgLy8vICBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIFRoZSBtb25zdGVyIElEIG9mIHRoZSBtYXRyb24gb2YgdGhpcyBtb25zdGVyICh6ZXJvIGZvciBnZW4wKQogICAgLy8vIEBwYXJhbSBfc2lyZUlkIFRoZSBtb25zdGVyIElEIG9mIHRoZSBzaXJlIG9mIHRoaXMgbW9uc3RlciAoemVybyBmb3IgZ2VuMCkKICAgIC8vLyBAcGFyYW0gX2dlbmVyYXRpb24gVGhlIGdlbmVyYXRpb24gbnVtYmVyIG9mIHRoaXMgbW9uc3RlciwgbXVzdCBiZSBjb21wdXRlZCBieSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF9nZW5lcyBUaGUgbW9uc3RlcidzIGdlbmV0aWMgY29kZS4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBpbml0YWwgb3duZXIgb2YgdGhpcyBtb25zdGVyLCBtdXN0IGJlIG5vbi16ZXJvIChleGNlcHQgZm9yIHRoZSB1bk1vbnN0ZXIsIElEIDApCiAgICBmdW5jdGlvbiBfY3JlYXRlTW9uc3RlcigKICAgIHVpbnQyNTYgX21hdHJvbklkLAogICAgdWludDI1NiBfc2lyZUlkLAogICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgIHVpbnQyNTYgX2dlbmVzLAogICAgYWRkcmVzcyBfb3duZXIKICAgICkKICAgIGludGVybmFsCiAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIC8vIFRoZXNlIHJlcXVpcmVzIGFyZSBub3Qgc3RyaWN0bHkgbmVjZXNzYXJ5LCBvdXIgY2FsbGluZyBjb2RlIHNob3VsZCBtYWtlCiAgICAgICAgLy8gc3VyZSB0aGF0IHRoZXNlIGNvbmRpdGlvbnMgYXJlIG5ldmVyIGJyb2tlbi4gSG93ZXZlciEgX2NyZWF0ZU1vbnN0ZXIoKSBpcyBhbHJlYWR5CiAgICAgICAgLy8gYW4gZXhwZW5zaXZlIGNhbGwgKGZvciBzdG9yYWdlKSwgYW5kIGl0IGRvZXNuJ3QgaHVydCB0byBiZSBlc3BlY2lhbGx5IGNhcmVmdWwKICAgICAgICAvLyB0byBlbnN1cmUgb3VyIGRhdGEgc3RydWN0dXJlcyBhcmUgYWx3YXlzIHZhbGlkLgogICAgICAgIHJlcXVpcmUoX21hdHJvbklkID09IHVpbnQyNTYodWludDMyKF9tYXRyb25JZCkpKTsKICAgICAgICByZXF1aXJlKF9zaXJlSWQgPT0gdWludDI1Nih1aW50MzIoX3NpcmVJZCkpKTsKICAgICAgICByZXF1aXJlKF9nZW5lcmF0aW9uID09IHVpbnQyNTYodWludDE2KF9nZW5lcmF0aW9uKSkpOwoKICAgICAgICAvLyBOZXcgbW9uc3RlciBzdGFydHMgd2l0aCB0aGUgc2FtZSBjb29sZG93biBhcyBwYXJlbnQgZ2VuLzIKICAgICAgICB1aW50MTYgY29vbGRvd25JbmRleCA9IHVpbnQxNihfZ2VuZXJhdGlvbiAvIDIpOwogICAgICAgIGlmIChjb29sZG93bkluZGV4ID4gMTMpIHsKICAgICAgICAgICAgY29vbGRvd25JbmRleCA9IDEzOwogICAgICAgIH0KCiAgICAgICAgTW9uc3RlciBtZW1vcnkgX21vbnN0ZXIgPSBNb25zdGVyKHsKICAgICAgICBnZW5lcyA6IF9nZW5lcywKICAgICAgICBiaXJ0aFRpbWUgOiB1aW50NjQobm93KSwKICAgICAgICBjb29sZG93bkVuZEJsb2NrIDogMCwKICAgICAgICBtYXRyb25JZCA6IHVpbnQzMihfbWF0cm9uSWQpLAogICAgICAgIHNpcmVJZCA6IHVpbnQzMihfc2lyZUlkKSwKICAgICAgICBzaXJpbmdXaXRoSWQgOiAwLAogICAgICAgIGNvb2xkb3duSW5kZXggOiBjb29sZG93bkluZGV4LAogICAgICAgIGdlbmVyYXRpb24gOiB1aW50MTYoX2dlbmVyYXRpb24pCiAgICAgICAgfSk7CiAgICAgICAgdWludDI1NiBuZXdLaXR0ZW5JZCA9IG1vbnN0ZXJzLnB1c2goX21vbnN0ZXIpIC0gMTsKCiAgICAgICAgLy8gSXQncyBwcm9iYWJseSBuZXZlciBnb2luZyB0byBoYXBwZW4sIDQgYmlsbGlvbiBtb25zdGVycyBpcyBBIExPVCwgYnV0CiAgICAgICAgLy8gbGV0J3MganVzdCBiZSAxMDAlIHN1cmUgd2UgbmV2ZXIgbGV0IHRoaXMgaGFwcGVuLgogICAgICAgIHJlcXVpcmUobmV3S2l0dGVuSWQgPT0gdWludDI1Nih1aW50MzIobmV3S2l0dGVuSWQpKSk7CgogICAgICAgIC8vIGVtaXQgdGhlIGJpcnRoIGV2ZW50CiAgICAgICAgQmlydGgoCiAgICAgICAgX293bmVyLAogICAgICAgIG5ld0tpdHRlbklkLAogICAgICAgIHVpbnQyNTYoX21vbnN0ZXIubWF0cm9uSWQpLAogICAgICAgIHVpbnQyNTYoX21vbnN0ZXIuc2lyZUlkKSwKICAgICAgICBfbW9uc3Rlci5nZW5lcywKICAgICAgICB1aW50MTYoX2dlbmVyYXRpb24pCiAgICAgICAgKTsKCiAgICAgICAgLy8gVGhpcyB3aWxsIGFzc2lnbiBvd25lcnNoaXAsIGFuZCBhbHNvIGVtaXQgdGhlIFRyYW5zZmVyIGV2ZW50IGFzCiAgICAgICAgLy8gcGVyIEVSQzcyMSBkcmFmdAogICAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld0tpdHRlbklkKTsKCiAgICAgICAgcmV0dXJuIG5ld0tpdHRlbklkOwogICAgfQoKICAgIC8vIEFueSBDLWxldmVsIGNhbiBmaXggaG93IG1hbnkgc2Vjb25kcyBwZXIgYmxvY2tzIGFyZSBjdXJyZW50bHkgb2JzZXJ2ZWQuCiAgICBmdW5jdGlvbiBzZXRTZWNvbmRzUGVyQmxvY2sodWludDI1NiBzZWNzKSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKICAgICAgICByZXF1aXJlKHNlY3MgPCBjb29sZG93bnNbMF0pOwogICAgICAgIHNlY29uZHNQZXJCbG9jayA9IHNlY3M7CiAgICB9Cn0KCgoKCgovLy8gQHRpdGxlIFRoZSBleHRlcm5hbCBjb250cmFjdCB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciBnZW5lcmF0aW5nIG1ldGFkYXRhIGZvciB0aGUgbW9uc3RlcnMsCi8vLyAgaXQgaGFzIG9uZSBmdW5jdGlvbiB0aGF0IHdpbGwgcmV0dXJuIHRoZSBkYXRhIGFzIGJ5dGVzLgpjb250cmFjdCBFUkM3MjFNZXRhZGF0YSB7CiAgICAvLy8gQGRldiBHaXZlbiBhIHRva2VuIElkLCByZXR1cm5zIGEgYnl0ZSBhcnJheSB0aGF0IGlzIHN1cHBvc2VkIHRvIGJlIGNvbnZlcnRlZCBpbnRvIHN0cmluZy4KICAgIGZ1bmN0aW9uIGdldE1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZykgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMls0XSBidWZmZXIsIHVpbnQyNTYgY291bnQpIHsKICAgICAgICBpZiAoX3Rva2VuSWQgPT0gMSkgewogICAgICAgICAgICBidWZmZXJbMF0gPSAiSGVsbG8gV29ybGQhIDpEIjsKICAgICAgICAgICAgY291bnQgPSAxNTsKICAgICAgICB9IGVsc2UgaWYgKF90b2tlbklkID09IDIpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkkgd291bGQgZGVmaW5pdGVseSBjaG9vc2UgYSBtZWRpIjsKICAgICAgICAgICAgYnVmZmVyWzFdID0gInVtIGxlbmd0aCBzdHJpbmcuIjsKICAgICAgICAgICAgY291bnQgPSA0OTsKICAgICAgICB9IGVsc2UgaWYgKF90b2tlbklkID09IDMpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkxvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBtaSBlIjsKICAgICAgICAgICAgYnVmZmVyWzFdID0gInN0IGFjY3Vtc2FuIGRhcGlidXMgYXVndWUgbG9yZW0sIjsKICAgICAgICAgICAgYnVmZmVyWzJdID0gIiB0cmlzdGlxdWUgdmVzdGlidWx1bSBpZCwgbGliZXJvIjsKICAgICAgICAgICAgYnVmZmVyWzNdID0gIiBzdXNjaXBpdCB2YXJpdXMgc2FwaWVuIGFsaXF1YW0uIjsKICAgICAgICAgICAgY291bnQgPSAxMjg7CiAgICAgICAgfQogICAgfQp9CgoKLy8vIEB0aXRsZSBUaGUgZmFjZXQgb2YgdGhlIENyeXB0b01vbnN0ZXJzIGNvcmUgY29udHJhY3QgdGhhdCBtYW5hZ2VzIG93bmVyc2hpcCwgRVJDLTcyMSAoZHJhZnQpIGNvbXBsaWFudC4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCi8vLyAgU2VlIHRoZSBNb25zdGVyQ29yZSBjb250cmFjdCBkb2N1bWVudGF0aW9uIHRvIHVuZGVyc3RhbmQgaG93IHRoZSB2YXJpb3VzIGNvbnRyYWN0IGZhY2V0cyBhcmUgYXJyYW5nZWQuCmNvbnRyYWN0IE1vbnN0ZXJPd25lcnNoaXAgaXMgTW9uc3RlckJhc2UsIEVSQzcyMSB7CgogICAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkV0aGVybW9uIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkVNIjsKCiAgICAvLyBUaGUgY29udHJhY3QgdGhhdCB3aWxsIHJldHVybiBtb25zdGVyIG1ldGFkYXRhCiAgICBFUkM3MjFNZXRhZGF0YSBwdWJsaWMgZXJjNzIxTWV0YWRhdGE7CgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPQogICAgYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9CiAgICBieXRlczQoa2VjY2FrMjU2KCduYW1lKCknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndG90YWxTdXBwbHkoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdiYWxhbmNlT2YoYWRkcmVzcyknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1Nignb3duZXJPZih1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2Vuc09mT3duZXIoYWRkcmVzcyknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5NZXRhZGF0YSh1aW50MjU2LHN0cmluZyknKSk7CgogICAgLy8vIEBub3RpY2UgSW50cm9zcGVjdGlvbiBpbnRlcmZhY2UgYXMgcGVyIEVSQy0xNjUgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpLgogICAgLy8vICBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LiBXZSBpbXBsZW1lbnQKICAgIC8vLyAgRVJDLTE2NSAob2J2aW91c2x5ISkgYW5kIEVSQy03MjEuCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gREVCVUcgT05MWQogICAgICAgIC8vcmVxdWlyZSgoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9PSAweDAxZmZjOWE3KSAmJiAoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9PSAweDlhMjA0ODNkKSk7CgogICAgICAgIHJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHNpYmxpbmcgY29udHJhY3QgdGhhdCB0cmFja3MgbWV0YWRhdGEuCiAgICAvLy8gIENFTyBvbmx5LgogICAgZnVuY3Rpb24gc2V0TWV0YWRhdGFBZGRyZXNzKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcykgcHVibGljIG9ubHlDRU8gewogICAgICAgIGVyYzcyMU1ldGFkYXRhID0gRVJDNzIxTWV0YWRhdGEoX2NvbnRyYWN0QWRkcmVzcyk7CiAgICB9CgogICAgLy8gSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbnM6IFRoZXNlIGZ1bmN0aW9ucyBhbGwgYXNzdW1lIHRoYXQgdGhlaXIgaW5wdXQgYXJndW1lbnRzCiAgICAvLyBhcmUgdmFsaWQuIFdlIGxlYXZlIGl0IHRvIHB1YmxpYyBtZXRob2RzIHRvIHNhbml0aXplIHRoZWlyIGlucHV0cyBhbmQgZm9sbG93CiAgICAvLyB0aGUgcmVxdWlyZWQgbG9naWMuCgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBpcyB0aGUgY3VycmVudCBvd25lciBvZiBhIHBhcnRpY3VsYXIgTW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSB2YWxpZGF0aW5nIGFnYWluc3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIG1vbnN0ZXIgaWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbW9uc3RlckluZGV4VG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgTW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSBjb25maXJtaW5nIG1vbnN0ZXIgaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBtb25zdGVyIGlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtb25zdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CgogICAgLy8vIEBkZXYgTWFya3MgYW4gYWRkcmVzcyBhcyBiZWluZyBhcHByb3ZlZCBmb3IgdHJhbnNmZXJGcm9tKCksIG92ZXJ3cml0aW5nIGFueSBwcmV2aW91cwogICAgLy8vICBhcHByb3ZhbC4gU2V0dGluZyBfYXBwcm92ZWQgdG8gYWRkcmVzcygwKSBjbGVhcnMgYWxsIHRyYW5zZmVyIGFwcHJvdmFsLgogICAgLy8vICBOT1RFOiBfYXBwcm92ZSgpIGRvZXMgTk9UIHNlbmQgdGhlIEFwcHJvdmFsIGV2ZW50LiBUaGlzIGlzIGludGVudGlvbmFsIGJlY2F1c2UKICAgIC8vLyAgX2FwcHJvdmUoKSBhbmQgdHJhbnNmZXJGcm9tKCkgYXJlIHVzZWQgdG9nZXRoZXIgZm9yIHB1dHRpbmcgTW9uc3RlcnMgb24gYXVjdGlvbiwgYW5kCiAgICAvLy8gIHRoZXJlIGlzIG5vIHZhbHVlIGluIHNwYW1taW5nIHRoZSBsb2cgd2l0aCBBcHByb3ZhbCBldmVudHMgaW4gdGhhdCBjYXNlLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIGludGVybmFsIHsKICAgICAgICBtb25zdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgTW9uc3RlcnMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBhIE1vbnN0ZXIgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vICBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSAob3IKICAgIC8vLyAgQ3J5cHRvTW9uc3RlcnMgc3BlY2lmaWNhbGx5KSBvciB5b3VyIE1vbnN0ZXIgbWF5IGJlIGxvc3QgZm9yZXZlci4gU2VyaW91c2x5LgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBNb25zdGVyIHRvIHRyYW5zZmVyLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgYWRkcmVzcyBfdG8sCiAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBtb25zdGVycyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgZ2VuMCBtb25zdGVyIGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGUgYXVjdGlvbiBjb250cmFjdHMgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBtb25zdGVycwogICAgICAgIC8vIHRocm91Z2ggdGhlIGFsbG93ICsgdHJhbnNmZXJGcm9tIGZsb3cuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhzYWxlQXVjdGlvbikpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3Moc2lyaW5nQXVjdGlvbikpOwoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biBtb25zdGVyLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwLCBjbGVhciBwZW5kaW5nIGFwcHJvdmFscywgZW1pdCBUcmFuc2ZlciBldmVudC4KICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR3JhbnQgYW5vdGhlciBhZGRyZXNzIHRoZSByaWdodCB0byB0cmFuc2ZlciBhIHNwZWNpZmljIE1vbnN0ZXIgdmlhCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBUaGlzIGlzIHRoZSBwcmVmZXJyZWQgZmxvdyBmb3IgdHJhbnNmZXJpbmcgTkZUcyB0byBjb250cmFjdHMuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBiZSBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsLiBQYXNzIGFkZHJlc3MoMCkgdG8KICAgIC8vLyAgY2xlYXIgYWxsIGFwcHJvdmFscy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBNb25zdGVyIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBhcHByb3ZlKAogICAgYWRkcmVzcyBfdG8sCiAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIE9ubHkgYW4gb3duZXIgY2FuIGdyYW50IHRyYW5zZmVyIGFwcHJvdmFsLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIChyZXBsYWNpbmcgYW55IHByZXZpb3VzIGFwcHJvdmFsKS4KICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBhcHByb3ZhbCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIE1vbnN0ZXIgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcgYWRkcmVzcwogICAgLy8vICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIE1vbnN0ZXIgdG8gYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBNb25zdGVyLiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgYWRkcmVzcyBfZnJvbSwKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgbW9uc3RlcnMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgbW9uc3RlciBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIE1vbnN0ZXJzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJzLmxlbmd0aCAtIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYWRkcmVzcyBjdXJyZW50bHkgYXNzaWduZWQgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gTW9uc3Rlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgIHsKICAgICAgICBvd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdOwoKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBsaXN0IG9mIGFsbCBNb25zdGVyIElEcyBhc3NpZ25lZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIE1vbnN0ZXJzIHdlIGFyZSBpbnRlcmVzdGVkIGluLgogICAgLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gRmlyc3QsIGl0J3MgZmFpcmx5CiAgICAvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBNb25zdGVyIGFycmF5IGxvb2tpbmcgZm9yIG1vbnN0ZXJzIGJlbG9uZ2luZyB0byBvd25lciksCiAgICAvLy8gIGJ1dCBpdCBhbHNvIHJldHVybnMgYSBkeW5hbWljIGFycmF5LCB3aGljaCBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscywgYW5kCiAgICAvLy8gIG5vdCBjb250cmFjdC10by1jb250cmFjdCBjYWxscy4KICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIG93bmVyVG9rZW5zKSB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbE1vbnN0ZXJzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICAvLyBXZSBjb3VudCBvbiB0aGUgZmFjdCB0aGF0IGFsbCBtb25zdGVycyBoYXZlIElEcyBzdGFydGluZyBhdCAxIGFuZCBpbmNyZWFzaW5nCiAgICAgICAgICAgIC8vIHNlcXVlbnRpYWxseSB1cCB0byB0aGUgdG90YWxNb25zdGVyIGNvdW50LgogICAgICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZDsKCiAgICAgICAgICAgIGZvciAobW9uc3RlcklkID0gMTsgbW9uc3RlcklkIDw9IHRvdGFsTW9uc3RlcnM7IG1vbnN0ZXJJZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAobW9uc3RlckluZGV4VG9Pd25lclttb25zdGVySWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBtb25zdGVySWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIG1lbWNweSgpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImFmY2VkZGNlY2NjN2MxYzZjYmVmYzFjMGRiY2JjMGRiODFjMWNhZGIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF9tZW1jcHkodWludCBfZGVzdCwgdWludCBfc3JjLCB1aW50IF9sZW4pIHByaXZhdGUgdmlldyB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IgKDsgX2xlbiA+PSAzMjsgX2xlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgbWxvYWQoX3NyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Rlc3QgKz0gMzI7CiAgICAgICAgICAgIF9zcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQyNTYgbWFzayA9IDI1NiAqKiAoMzIgLSBfbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChfc3JjKSwgbm90KG1hc2spKQogICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoX2Rlc3QpLCBtYXNrKQogICAgICAgIG1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gdG9TdHJpbmcoc2xpY2UpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImNjYWRiZWFkYWZhNGEyYTVhODhjYTJhM2I4YThhM2I4ZTJhMmE5YjgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF90b1N0cmluZyhieXRlczMyWzRdIF9yYXdCeXRlcywgdWludDI1NiBfc3RyaW5nTGVuZ3RoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CiAgICAgICAgdWludDI1NiBvdXRwdXRQdHI7CiAgICAgICAgdWludDI1NiBieXRlc1B0cjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgIG91dHB1dFB0ciA6PSBhZGQob3V0cHV0U3RyaW5nLCAzMikKICAgICAgICBieXRlc1B0ciA6PSBfcmF3Qnl0ZXMKICAgICAgICB9CgogICAgICAgIF9tZW1jcHkob3V0cHV0UHRyLCBieXRlc1B0ciwgX3N0cmluZ0xlbmd0aCk7CgogICAgICAgIHJldHVybiBvdXRwdXRTdHJpbmc7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhIFVSSSBwb2ludGluZyB0byBhIG1ldGFkYXRhIHBhY2thZ2UgZm9yIHRoaXMgdG9rZW4gY29uZm9ybWluZyB0bwogICAgLy8vICBFUkMtNzIxIChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxKQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgbnVtYmVyIG9mIHRoZSBNb25zdGVyIHdob3NlIG1ldGFkYXRhIHNob3VsZCBiZSByZXR1cm5lZC4KICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpIHsKICAgICAgICByZXF1aXJlKGVyYzcyMU1ldGFkYXRhICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGJ5dGVzMzJbNF0gbWVtb3J5IGJ1ZmZlcjsKICAgICAgICB1aW50MjU2IGNvdW50OwogICAgICAgIChidWZmZXIsIGNvdW50KSA9IGVyYzcyMU1ldGFkYXRhLmdldE1ldGFkYXRhKF90b2tlbklkLCBfcHJlZmVycmVkVHJhbnNwb3J0KTsKCiAgICAgICAgcmV0dXJuIF90b1N0cmluZyhidWZmZXIsIGNvdW50KTsKICAgIH0KfQoKCgovLy8gQHRpdGxlIEEgZmFjZXQgb2YgTW9uc3RlckNvcmUgdGhhdCBtYW5hZ2VzIE1vbnN0ZXIgc2lyaW5nLCBnZXN0YXRpb24sIGFuZCBiaXJ0aC4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgU2VlIHRoZSBNb25zdGVyQ29yZSBjb250cmFjdCBkb2N1bWVudGF0aW9uIHRvIHVuZGVyc3RhbmQgaG93IHRoZSB2YXJpb3VzIGNvbnRyYWN0IGZhY2V0cyBhcmUgYXJyYW5nZWQuCmNvbnRyYWN0IE1vbnN0ZXJCcmVlZGluZyBpcyBNb25zdGVyT3duZXJzaGlwIHsKCiAgICAvLy8gQGRldiBUaGUgUHJlZ25hbnQgZXZlbnQgaXMgZmlyZWQgd2hlbiB0d28gbW9uc3RlcnMgc3VjY2Vzc2Z1bGx5IGJyZWVkIGFuZCB0aGUgcHJlZ25hbmN5CiAgICAvLy8gIHRpbWVyIGJlZ2lucyBmb3IgdGhlIG1hdHJvbi4KICAgIGV2ZW50IFByZWduYW50KGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgbWF0cm9uSWQsIHVpbnQyNTYgc2lyZUlkLCB1aW50MjU2IGNvb2xkb3duRW5kQmxvY2spOwoKICAgIC8vLyBAbm90aWNlIFRoZSBtaW5pbXVtIHBheW1lbnQgcmVxdWlyZWQgdG8gdXNlIGJyZWVkV2l0aEF1dG8oKS4gVGhpcyBmZWUgZ29lcyB0b3dhcmRzCiAgICAvLy8gIHRoZSBnYXMgY29zdCBwYWlkIGJ5IHdoYXRldmVyIGNhbGxzIGdpdmVCaXJ0aCgpLCBhbmQgY2FuIGJlIGR5bmFtaWNhbGx5IHVwZGF0ZWQgYnkKICAgIC8vLyAgdGhlIENPTyByb2xlIGFzIHRoZSBnYXMgcHJpY2UgY2hhbmdlcy4KICAgIHVpbnQyNTYgcHVibGljIGF1dG9CaXJ0aEZlZSA9IDggZmlubmV5OwoKICAgIC8vIEtlZXBzIHRyYWNrIG9mIG51bWJlciBvZiBwcmVnbmFudCBtb25zdGVycy4KICAgIHVpbnQyNTYgcHVibGljIHByZWduYW50TW9uc3RlcnM7CgogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgdGhlIHNpYmxpbmcgY29udHJhY3QgdGhhdCBpcyB1c2VkIHRvIGltcGxlbWVudCB0aGUgc29vcGVyLXNla3JldAogICAgLy8vICBnZW5ldGljIGNvbWJpbmF0aW9uIGFsZ29yaXRobS4KCiAgICAvLy8gQGRldiBVcGRhdGUgdGhlIGFkZHJlc3Mgb2YgdGhlIGdlbmV0aWMgY29udHJhY3QsIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQ0VPLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyBBbiBhZGRyZXNzIG9mIGEgR2VuZVNjaWVuY2UgY29udHJhY3QgaW5zdGFuY2UgdG8gYmUgdXNlZCBmcm9tIHRoaXMgcG9pbnQgZm9yd2FyZC4KICAgIGZ1bmN0aW9uIHNldEdlbmVTY2llbmNlQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBHZW5lU2NpZW5jZSBjYW5kaWRhdGVDb250cmFjdCA9IEdlbmVTY2llbmNlKF9hZGRyZXNzKTsKCiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0dlbmVTY2llbmNlKCkpOwoKICAgICAgICAvLyBTZXQgdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgZ2VuZVNjaWVuY2UgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgdGhhdCBhIGdpdmVuIG1vbnN0ZXIgaXMgYWJsZSB0byBicmVlZC4gUmVxdWlyZXMgdGhhdCB0aGUKICAgIC8vLyAgY3VycmVudCBjb29sZG93biBpcyBmaW5pc2hlZCAoZm9yIHNpcmVzKSBhbmQgYWxzbyBjaGVja3MgdGhhdCB0aGVyZSBpcwogICAgLy8vICBubyBwZW5kaW5nIHByZWduYW5jeS4KICAgIGZ1bmN0aW9uIF9pc1JlYWR5VG9CcmVlZChNb25zdGVyIF9tb25zdGVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBJbiBhZGRpdGlvbiB0byBjaGVja2luZyB0aGUgY29vbGRvd25FbmRCbG9jaywgd2UgYWxzbyBuZWVkIHRvIGNoZWNrIHRvIHNlZSBpZgogICAgICAgIC8vIHRoZSBtb25zdGVyIGhhcyBhIHBlbmRpbmcgYmlydGg7IHRoZXJlIGNhbiBiZSBzb21lIHBlcmlvZCBvZiB0aW1lIGJldHdlZW4gdGhlIGVuZAogICAgICAgIC8vIG9mIHRoZSBwcmVnbmFjeSB0aW1lciBhbmQgdGhlIGJpcnRoIGV2ZW50LgogICAgICAgIHJldHVybiAoX21vbnN0ZXIuc2lyaW5nV2l0aElkID09IDApICYmIChfbW9uc3Rlci5jb29sZG93bkVuZEJsb2NrIDw9IHVpbnQ2NChibG9jay5udW1iZXIpKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVjayBpZiBhIHNpcmUgaGFzIGF1dGhvcml6ZWQgYnJlZWRpbmcgd2l0aCB0aGlzIG1hdHJvbi4gVHJ1ZSBpZiBib3RoIHNpcmUKICAgIC8vLyAgYW5kIG1hdHJvbiBoYXZlIHRoZSBzYW1lIG93bmVyLCBvciBpZiB0aGUgc2lyZSBoYXMgZ2l2ZW4gc2lyaW5nIHBlcm1pc3Npb24gdG8KICAgIC8vLyAgdGhlIG1hdHJvbidzIG93bmVyICh2aWEgYXBwcm92ZVNpcmluZygpKS4KICAgIGZ1bmN0aW9uIF9pc1NpcmluZ1Blcm1pdHRlZCh1aW50MjU2IF9zaXJlSWQsIHVpbnQyNTYgX21hdHJvbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhZGRyZXNzIG1hdHJvbk93bmVyID0gbW9uc3RlckluZGV4VG9Pd25lcltfbWF0cm9uSWRdOwogICAgICAgIGFkZHJlc3Mgc2lyZU93bmVyID0gbW9uc3RlckluZGV4VG9Pd25lcltfc2lyZUlkXTsKCiAgICAgICAgLy8gU2lyaW5nIGlzIG9rYXkgaWYgdGhleSBoYXZlIHNhbWUgb3duZXIsIG9yIGlmIHRoZSBtYXRyb24ncyBvd25lciB3YXMgZ2l2ZW4KICAgICAgICAvLyBwZXJtaXNzaW9uIHRvIGJyZWVkIHdpdGggdGhpcyBzaXJlLgogICAgICAgIHJldHVybiAobWF0cm9uT3duZXIgPT0gc2lyZU93bmVyIHx8IHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdID09IG1hdHJvbk93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXQgdGhlIGNvb2xkb3duRW5kVGltZSBmb3IgdGhlIGdpdmVuIE1vbnN0ZXIsIGJhc2VkIG9uIGl0cyBjdXJyZW50IGNvb2xkb3duSW5kZXguCiAgICAvLy8gIEFsc28gaW5jcmVtZW50cyB0aGUgY29vbGRvd25JbmRleCAodW5sZXNzIGl0IGhhcyBoaXQgdGhlIGNhcCkuCiAgICAvLy8gQHBhcmFtIF9tb25zdGVyIEEgcmVmZXJlbmNlIHRvIHRoZSBNb25zdGVyIGluIHN0b3JhZ2Ugd2hpY2ggbmVlZHMgaXRzIHRpbWVyIHN0YXJ0ZWQuCiAgICBmdW5jdGlvbiBfdHJpZ2dlckNvb2xkb3duKE1vbnN0ZXIgc3RvcmFnZSBfbW9uc3RlcikgaW50ZXJuYWwgewogICAgICAgIC8vIENvbXB1dGUgYW4gZXN0aW1hdGlvbiBvZiB0aGUgY29vbGRvd24gdGltZSBpbiBibG9ja3MgKGJhc2VkIG9uIGN1cnJlbnQgY29vbGRvd25JbmRleCkuCiAgICAgICAgX21vbnN0ZXIuY29vbGRvd25FbmRCbG9jayA9IHVpbnQ2NCgoY29vbGRvd25zW19tb25zdGVyLmNvb2xkb3duSW5kZXhdIC8gc2Vjb25kc1BlckJsb2NrKSArIGJsb2NrLm51bWJlcik7CgogICAgICAgIC8vIEluY3JlbWVudCB0aGUgYnJlZWRpbmcgY291bnQsIGNsYW1waW5nIGl0IGF0IDEzLCB3aGljaCBpcyB0aGUgbGVuZ3RoIG9mIHRoZQogICAgICAgIC8vIGNvb2xkb3ducyBhcnJheS4gV2UgY291bGQgY2hlY2sgdGhlIGFycmF5IHNpemUgZHluYW1pY2FsbHksIGJ1dCBoYXJkLWNvZGluZwogICAgICAgIC8vIHRoaXMgYXMgYSBjb25zdGFudCBzYXZlcyBnYXMuIFlheSwgU29saWRpdHkhCiAgICAgICAgaWYgKF9tb25zdGVyLmNvb2xkb3duSW5kZXggPCAxMykgewogICAgICAgICAgICBfbW9uc3Rlci5jb29sZG93bkluZGV4ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIEdyYW50cyBhcHByb3ZhbCB0byBhbm90aGVyIHVzZXIgdG8gc2lyZSB3aXRoIG9uZSBvZiB5b3VyIE1vbnN0ZXJzLgogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYWJsZSB0byBzaXJlIHdpdGggeW91ciBNb25zdGVyLiBTZXQgdG8KICAgIC8vLyAgYWRkcmVzcygwKSB0byBjbGVhciBhbGwgc2lyaW5nIGFwcHJvdmFscyBmb3IgdGhpcyBNb25zdGVyLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIEEgTW9uc3RlciB0aGF0IHlvdSBvd24gdGhhdCBfYWRkciB3aWxsIG5vdyBiZSBhYmxlIHRvIHNpcmUgd2l0aC4KICAgIC8vLyBLRVJOWVMg7Jm467aA7JeQ7IScIOyVhOu5oOqwgCDtmLjstpztlaAg7IiYIOyeiOuLpC4gKG1ldGEgbWFza+uhnCkKICAgIGZ1bmN0aW9uIGFwcHJvdmVTaXJpbmcoYWRkcmVzcyBfYWRkciwgdWludDI1NiBfc2lyZUlkKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9zaXJlSWQpKTsKICAgICAgICBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfc2lyZUlkXSA9IF9hZGRyOwogICAgfQoKICAgIC8vLyBAZGV2IFVwZGF0ZXMgdGhlIG1pbmltdW0gcGF5bWVudCByZXF1aXJlZCBmb3IgY2FsbGluZyBnaXZlQmlydGhBdXRvKCkuIENhbiBvbmx5CiAgICAvLy8gIGJlIGNhbGxlZCBieSB0aGUgQ09PIGFkZHJlc3MuIChUaGlzIGZlZSBpcyB1c2VkIHRvIG9mZnNldCB0aGUgZ2FzIGNvc3QgaW5jdXJyZWQKICAgIC8vLyAgYnkgdGhlIGF1dG9iaXJ0aCBkYWVtb24pLgogICAgZnVuY3Rpb24gc2V0QXV0b0JpcnRoRmVlKHVpbnQyNTYgdmFsKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBhdXRvQmlydGhGZWUgPSB2YWw7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIHRvIHNlZSBpZiBhIGdpdmVuIE1vbnN0ZXIgaXMgcHJlZ25hbnQgYW5kIChpZiBzbykgaWYgdGhlIGdlc3RhdGlvbgogICAgLy8vICBwZXJpb2QgaGFzIHBhc3NlZC4KICAgIGZ1bmN0aW9uIF9pc1JlYWR5VG9HaXZlQmlydGgoTW9uc3RlciBfbWF0cm9uKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX21hdHJvbi5zaXJpbmdXaXRoSWQgIT0gMCkgJiYgKF9tYXRyb24uY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIHRoYXQgYSBnaXZlbiBtb25zdGVyIGlzIGFibGUgdG8gYnJlZWQgKGkuZS4gaXQgaXMgbm90IHByZWduYW50IG9yCiAgICAvLy8gIGluIHRoZSBtaWRkbGUgb2YgYSBzaXJpbmcgY29vbGRvd24pLgogICAgLy8vIEBwYXJhbSBfbW9uc3RlcklkIHJlZmVyZW5jZSB0aGUgaWQgb2YgdGhlIG1vbnN0ZXIsIGFueSB1c2VyIGNhbiBpbnF1aXJlIGFib3V0IGl0CiAgICBmdW5jdGlvbiBpc1JlYWR5VG9CcmVlZCh1aW50MjU2IF9tb25zdGVySWQpCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfbW9uc3RlcklkID4gMCk7CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbnN0ZXIgPSBtb25zdGVyc1tfbW9uc3RlcklkXTsKICAgICAgICByZXR1cm4gX2lzUmVhZHlUb0JyZWVkKG1vbnN0ZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB3aGV0aGVyIGEgbW9uc3RlciBpcyBjdXJyZW50bHkgcHJlZ25hbnQuCiAgICAvLy8gQHBhcmFtIF9tb25zdGVySWQgcmVmZXJlbmNlIHRoZSBpZCBvZiB0aGUgbW9uc3RlciwgYW55IHVzZXIgY2FuIGlucXVpcmUgYWJvdXQgaXQKICAgIGZ1bmN0aW9uIGlzUHJlZ25hbnQodWludDI1NiBfbW9uc3RlcklkKQogICAgcHVibGljCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX21vbnN0ZXJJZCA+IDApOwogICAgICAgIC8vIEEgbW9uc3RlciBpcyBwcmVnbmFudCBpZiBhbmQgb25seSBpZiB0aGlzIGZpZWxkIGlzIHNldAogICAgICAgIHJldHVybiBtb25zdGVyc1tfbW9uc3RlcklkXS5zaXJpbmdXaXRoSWQgIT0gMDsKICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBjaGVjayB0byBzZWUgaWYgYSBnaXZlbiBzaXJlIGFuZCBtYXRyb24gYXJlIGEgdmFsaWQgbWF0aW5nIHBhaXIuIERPRVMgTk9UCiAgICAvLy8gIGNoZWNrIG93bmVyc2hpcCBwZXJtaXNzaW9ucyAodGhhdCBpcyB1cCB0byB0aGUgY2FsbGVyKS4KICAgIC8vLyBAcGFyYW0gX21hdHJvbiBBIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlciBzdHJ1Y3Qgb2YgdGhlIHBvdGVudGlhbCBtYXRyb24uCiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgbWF0cm9uJ3MgSUQuCiAgICAvLy8gQHBhcmFtIF9zaXJlIEEgcmVmZXJlbmNlIHRvIHRoZSBNb25zdGVyIHN0cnVjdCBvZiB0aGUgcG90ZW50aWFsIHNpcmUuCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIHNpcmUncyBJRAogICAgZnVuY3Rpb24gX2lzVmFsaWRNYXRpbmdQYWlyKAogICAgTW9uc3RlciBzdG9yYWdlIF9tYXRyb24sCiAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgIE1vbnN0ZXIgc3RvcmFnZSBfc2lyZSwKICAgIHVpbnQyNTYgX3NpcmVJZAogICAgKQogICAgcHJpdmF0ZQogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBBIE1vbnN0ZXIgY2FuJ3QgYnJlZWQgd2l0aCBpdHNlbGYhCiAgICAgICAgaWYgKF9tYXRyb25JZCA9PSBfc2lyZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIE1vbnN0ZXJzIGNhbid0IGJyZWVkIHdpdGggdGhlaXIgcGFyZW50cy4KICAgICAgICBpZiAoX21hdHJvbi5tYXRyb25JZCA9PSBfc2lyZUlkIHx8IF9tYXRyb24uc2lyZUlkID09IF9zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbklkIHx8IF9zaXJlLnNpcmVJZCA9PSBfbWF0cm9uSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gV2UgY2FuIHNob3J0IGNpcmN1aXQgdGhlIHNpYmxpbmcgY2hlY2sgKGJlbG93KSBpZiBlaXRoZXIgbW9uc3RlciBpcwogICAgICAgIC8vIGdlbiB6ZXJvIChoYXMgYSBtYXRyb24gSUQgb2YgemVybykuCiAgICAgICAgaWYgKF9zaXJlLm1hdHJvbklkID09IDAgfHwgX21hdHJvbi5tYXRyb25JZCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gTW9uc3RlcnMgY2FuJ3QgYnJlZWQgd2l0aCBmdWxsIG9yIGhhbGYgc2libGluZ3MuCiAgICAgICAgaWYgKF9zaXJlLm1hdHJvbklkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbi5zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX3NpcmUuc2lyZUlkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb24uc2lyZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIEV2ZXJ5dGhpbmcgc2VlbXMgY29vbCEgTGV0J3MgZ2V0IERURi4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBjaGVjayB0byBzZWUgaWYgYSBnaXZlbiBzaXJlIGFuZCBtYXRyb24gYXJlIGEgdmFsaWQgbWF0aW5nIHBhaXIgZm9yCiAgICAvLy8gIGJyZWVkaW5nIHZpYSBhdWN0aW9uIChpLmUuIHNraXBzIG93bmVyc2hpcCBhbmQgc2lyaW5nIGFwcHJvdmFsIGNoZWNrcykuCiAgICBmdW5jdGlvbiBfY2FuQnJlZWRXaXRoVmlhQXVjdGlvbih1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKQogICAgaW50ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1hdHJvbiA9IG1vbnN0ZXJzW19tYXRyb25JZF07CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIHNpcmUgPSBtb25zdGVyc1tfc2lyZUlkXTsKICAgICAgICByZXR1cm4gX2lzVmFsaWRNYXRpbmdQYWlyKG1hdHJvbiwgX21hdHJvbklkLCBzaXJlLCBfc2lyZUlkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgdG8gc2VlIGlmIHR3byBtb25zdGVycyBjYW4gYnJlZWQgdG9nZXRoZXIsIGluY2x1ZGluZyBjaGVja3MgZm9yCiAgICAvLy8gIG93bmVyc2hpcCBhbmQgc2lyaW5nIGFwcHJvdmFscy4gRG9lcyBOT1QgY2hlY2sgdGhhdCBib3RoIG1vbnN0ZXJzIGFyZSByZWFkeSBmb3IKICAgIC8vLyAgYnJlZWRpbmcgKGkuZS4gYnJlZWRXaXRoIGNvdWxkIHN0aWxsIGZhaWwgdW50aWwgdGhlIGNvb2xkb3ducyBhcmUgZmluaXNoZWQpLgogICAgLy8vICBUT0RPOiBTaG91bGRuJ3QgdGhpcyBjaGVjayBwcmVnbmFuY3kgYW5kIGNvb2xkb3ducz8hPwogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgVGhlIElEIG9mIHRoZSBwcm9wb3NlZCBtYXRyb24uCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIElEIG9mIHRoZSBwcm9wb3NlZCBzaXJlLgogICAgZnVuY3Rpb24gY2FuQnJlZWRXaXRoKHVpbnQyNTYgX21hdHJvbklkLCB1aW50MjU2IF9zaXJlSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9tYXRyb25JZCA+IDApOwogICAgICAgIHJlcXVpcmUoX3NpcmVJZCA+IDApOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtYXRyb24gPSBtb25zdGVyc1tfbWF0cm9uSWRdOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBzaXJlID0gbW9uc3RlcnNbX3NpcmVJZF07CiAgICAgICAgcmV0dXJuIF9pc1ZhbGlkTWF0aW5nUGFpcihtYXRyb24sIF9tYXRyb25JZCwgc2lyZSwgX3NpcmVJZCkgJiYKICAgICAgICBfaXNTaXJpbmdQZXJtaXR0ZWQoX3NpcmVJZCwgX21hdHJvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCB1dGlsaXR5IGZ1bmN0aW9uIHRvIGluaXRpYXRlIGJyZWVkaW5nLCBhc3N1bWVzIHRoYXQgYWxsIGJyZWVkaW5nCiAgICAvLy8gIHJlcXVpcmVtZW50cyBoYXZlIGJlZW4gY2hlY2tlZC4KICAgIGZ1bmN0aW9uIF9icmVlZFdpdGgodWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIE1vbnN0ZXJzIGZyb20gc3RvcmFnZS4KICAgICAgICBNb25zdGVyIHN0b3JhZ2Ugc2lyZSA9IG1vbnN0ZXJzW19zaXJlSWRdOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtYXRyb24gPSBtb25zdGVyc1tfbWF0cm9uSWRdOwoKICAgICAgICAvLyBNYXJrIHRoZSBtYXRyb24gYXMgcHJlZ25hbnQsIGtlZXBpbmcgdHJhY2sgb2Ygd2hvIHRoZSBzaXJlIGlzLgogICAgICAgIG1hdHJvbi5zaXJpbmdXaXRoSWQgPSB1aW50MzIoX3NpcmVJZCk7CgogICAgICAgIC8vIFRyaWdnZXIgdGhlIGNvb2xkb3duIGZvciBib3RoIHBhcmVudHMuCiAgICAgICAgX3RyaWdnZXJDb29sZG93bihzaXJlKTsKICAgICAgICBfdHJpZ2dlckNvb2xkb3duKG1hdHJvbik7CgogICAgICAgIC8vIENsZWFyIHNpcmluZyBwZXJtaXNzaW9uIGZvciBib3RoIHBhcmVudHMuIFRoaXMgbWF5IG5vdCBiZSBzdHJpY3RseSBuZWNlc3NhcnkKICAgICAgICAvLyBidXQgaXQncyBsaWtlbHkgdG8gYXZvaWQgY29uZnVzaW9uIQogICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfbWF0cm9uSWRdOwogICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfc2lyZUlkXTsKCiAgICAgICAgLy8gRXZlcnkgdGltZSBhIG1vbnN0ZXIgZ2V0cyBwcmVnbmFudCwgY291bnRlciBpcyBpbmNyZW1lbnRlZC4KICAgICAgICBwcmVnbmFudE1vbnN0ZXJzKys7CgogICAgICAgIC8vIEVtaXQgdGhlIHByZWduYW5jeSBldmVudC4KICAgICAgICBQcmVnbmFudChtb25zdGVySW5kZXhUb093bmVyW19tYXRyb25JZF0sIF9tYXRyb25JZCwgX3NpcmVJZCwgbWF0cm9uLmNvb2xkb3duRW5kQmxvY2spOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEJyZWVkIGEgTW9uc3RlciB5b3Ugb3duIChhcyBtYXRyb24pIHdpdGggYSBzaXJlIHRoYXQgeW91IG93biwgb3IgZm9yIHdoaWNoIHlvdQogICAgLy8vICBoYXZlIHByZXZpb3VzbHkgYmVlbiBnaXZlbiBTaXJpbmcgYXBwcm92YWwuIFdpbGwgZWl0aGVyIG1ha2UgeW91ciBtb25zdGVyIHByZWduYW50LCBvciB3aWxsCiAgICAvLy8gIGZhaWwgZW50aXJlbHkuIFJlcXVpcmVzIGEgcHJlLXBheW1lbnQgb2YgdGhlIGZlZSBnaXZlbiBvdXQgdG8gdGhlIGZpcnN0IGNhbGxlciBvZiBnaXZlQmlydGgoKQogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgVGhlIElEIG9mIHRoZSBNb25zdGVyIGFjdGluZyBhcyBtYXRyb24gKHdpbGwgZW5kIHVwIHByZWduYW50IGlmIHN1Y2Nlc3NmdWwpCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIElEIG9mIHRoZSBNb25zdGVyIGFjdGluZyBhcyBzaXJlICh3aWxsIGJlZ2luIGl0cyBzaXJpbmcgY29vbGRvd24gaWYgc3VjY2Vzc2Z1bCkKICAgIGZ1bmN0aW9uIGJyZWVkV2l0aEF1dG8odWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgIGV4dGVybmFsCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQ2hlY2tzIGZvciBwYXltZW50LgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGF1dG9CaXJ0aEZlZSk7CgogICAgICAgIC8vIENhbGxlciBtdXN0IG93biB0aGUgbWF0cm9uLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CgogICAgICAgIC8vIE5laXRoZXIgc2lyZSBub3IgbWF0cm9uIGFyZSBhbGxvd2VkIHRvIGJlIG9uIGF1Y3Rpb24gZHVyaW5nIGEgbm9ybWFsCiAgICAgICAgLy8gYnJlZWRpbmcgb3BlcmF0aW9uLCBidXQgd2UgZG9uJ3QgbmVlZCB0byBjaGVjayB0aGF0IGV4cGxpY2l0bHkuCiAgICAgICAgLy8gRm9yIG1hdHJvbjogVGhlIGNhbGxlciBvZiB0aGlzIGZ1bmN0aW9uIGNhbid0IGJlIHRoZSBvd25lciBvZiB0aGUgbWF0cm9uCiAgICAgICAgLy8gICBiZWNhdXNlIHRoZSBvd25lciBvZiBhIE1vbnN0ZXIgb24gYXVjdGlvbiBpcyB0aGUgYXVjdGlvbiBob3VzZSwgYW5kIHRoZQogICAgICAgIC8vICAgYXVjdGlvbiBob3VzZSB3aWxsIG5ldmVyIGNhbGwgYnJlZWRXaXRoKCkuCiAgICAgICAgLy8gRm9yIHNpcmU6IFNpbWlsYXJseSwgYSBzaXJlIG9uIGF1Y3Rpb24gd2lsbCBiZSBvd25lZCBieSB0aGUgYXVjdGlvbiBob3VzZQogICAgICAgIC8vICAgYW5kIHRoZSBhY3Qgb2YgdHJhbnNmZXJyaW5nIG93bmVyc2hpcCB3aWxsIGhhdmUgY2xlYXJlZCBhbnkgb3VzdGFuZGluZwogICAgICAgIC8vICAgc2lyaW5nIGFwcHJvdmFsLgogICAgICAgIC8vIFRodXMgd2UgZG9uJ3QgbmVlZCB0byBzcGVuZCBnYXMgZXhwbGljaXRseSBjaGVja2luZyB0byBzZWUgaWYgZWl0aGVyIG1vbnN0ZXIKICAgICAgICAvLyBpcyBvbiBhdWN0aW9uLgoKICAgICAgICAvLyBDaGVjayB0aGF0IG1hdHJvbiBhbmQgc2lyZSBhcmUgYm90aCBvd25lZCBieSBjYWxsZXIsIG9yIHRoYXQgdGhlIHNpcmUKICAgICAgICAvLyBoYXMgZ2l2ZW4gc2lyaW5nIHBlcm1pc3Npb24gdG8gY2FsbGVyIChpLmUuIG1hdHJvbidzIG93bmVyKS4KICAgICAgICAvLyBXaWxsIGZhaWwgZm9yIF9zaXJlSWQgPSAwCiAgICAgICAgcmVxdWlyZShfaXNTaXJpbmdQZXJtaXR0ZWQoX3NpcmVJZCwgX21hdHJvbklkKSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHBvdGVudGlhbCBtYXRyb24KICAgICAgICBNb25zdGVyIHN0b3JhZ2UgbWF0cm9uID0gbW9uc3RlcnNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIG1hdHJvbiBpc24ndCBwcmVnbmFudCwgb3IgaW4gdGhlIG1pZGRsZSBvZiBhIHNpcmluZyBjb29sZG93bgogICAgICAgIHJlcXVpcmUoX2lzUmVhZHlUb0JyZWVkKG1hdHJvbikpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBwb3RlbnRpYWwgc2lyZQogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBzaXJlID0gbW9uc3RlcnNbX3NpcmVJZF07CgogICAgICAgIC8vIE1ha2Ugc3VyZSBzaXJlIGlzbid0IHByZWduYW50LCBvciBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvQnJlZWQoc2lyZSkpOwoKICAgICAgICAvLyBUZXN0IHRoYXQgdGhlc2UgbW9uc3RlcnMgYXJlIGEgdmFsaWQgbWF0aW5nIHBhaXIuCiAgICAgICAgcmVxdWlyZShfaXNWYWxpZE1hdGluZ1BhaXIoCiAgICAgICAgbWF0cm9uLAogICAgICAgIF9tYXRyb25JZCwKICAgICAgICBzaXJlLAogICAgICAgIF9zaXJlSWQKICAgICAgICApKTsKCiAgICAgICAgLy8gQWxsIGNoZWNrcyBwYXNzZWQsIG1vbnN0ZXIgZ2V0cyBwcmVnbmFudCEKICAgICAgICBfYnJlZWRXaXRoKF9tYXRyb25JZCwgX3NpcmVJZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSGF2ZSBhIHByZWduYW50IE1vbnN0ZXIgZ2l2ZSBiaXJ0aCEKICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIEEgTW9uc3RlciByZWFkeSB0byBnaXZlIGJpcnRoLgogICAgLy8vIEByZXR1cm4gVGhlIE1vbnN0ZXIgSUQgb2YgdGhlIG5ldyBtb25zdGVyLgogICAgLy8vIEBkZXYgTG9va3MgYXQgYSBnaXZlbiBNb25zdGVyIGFuZCwgaWYgcHJlZ25hbnQgYW5kIGlmIHRoZSBnZXN0YXRpb24gcGVyaW9kIGhhcyBwYXNzZWQsCiAgICAvLy8gIGNvbWJpbmVzIHRoZSBnZW5lcyBvZiB0aGUgdHdvIHBhcmVudHMgdG8gY3JlYXRlIGEgbmV3IG1vbnN0ZXIuIFRoZSBuZXcgTW9uc3RlciBpcyBhc3NpZ25lZAogICAgLy8vICB0byB0aGUgY3VycmVudCBvd25lciBvZiB0aGUgbWF0cm9uLiBVcG9uIHN1Y2Nlc3NmdWwgY29tcGxldGlvbiwgYm90aCB0aGUgbWF0cm9uIGFuZCB0aGUKICAgIC8vLyAgbmV3IG1vbnN0ZXIgd2lsbCBiZSByZWFkeSB0byBicmVlZCBhZ2Fpbi4gTm90ZSB0aGF0IGFueW9uZSBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIChpZiB0aGV5CiAgICAvLy8gIGFyZSB3aWxsaW5nIHRvIHBheSB0aGUgZ2FzISksIGJ1dCB0aGUgbmV3IG1vbnN0ZXIgYWx3YXlzIGdvZXMgdG8gdGhlIG1vdGhlcidzIG93bmVyLgogICAgZnVuY3Rpb24gZ2l2ZUJpcnRoKHVpbnQyNTYgX21hdHJvbklkKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgbWF0cm9uIGluIHN0b3JhZ2UuCiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1hdHJvbiA9IG1vbnN0ZXJzW19tYXRyb25JZF07CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIG1hdHJvbidzIG93bmVyLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIG1hdHJvbiBpcyBhIHZhbGlkIG1vbnN0ZXIuCiAgICAgICAgcmVxdWlyZShtYXRyb24uYmlydGhUaW1lICE9IDApOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBtYXRyb24gaXMgcHJlZ25hbnQsIGFuZCB0aGF0IGl0cyB0aW1lIGhhcyBjb21lIQogICAgICAgIHJlcXVpcmUoX2lzUmVhZHlUb0dpdmVCaXJ0aChtYXRyb24pKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2lyZSBpbiBzdG9yYWdlLgogICAgICAgIHVpbnQyNTYgc2lyZUlkID0gbWF0cm9uLnNpcmluZ1dpdGhJZDsKICAgICAgICBNb25zdGVyIHN0b3JhZ2Ugc2lyZSA9IG1vbnN0ZXJzW3NpcmVJZF07CgogICAgICAgIC8vIERldGVybWluZSB0aGUgaGlnaGVyIGdlbmVyYXRpb24gbnVtYmVyIG9mIHRoZSB0d28gcGFyZW50cwogICAgICAgIHVpbnQxNiBwYXJlbnRHZW4gPSBtYXRyb24uZ2VuZXJhdGlvbjsKICAgICAgICBpZiAoc2lyZS5nZW5lcmF0aW9uID4gbWF0cm9uLmdlbmVyYXRpb24pIHsKICAgICAgICAgICAgcGFyZW50R2VuID0gc2lyZS5nZW5lcmF0aW9uOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsbCB0aGUgc29vcGVyLXNla3JldCBnZW5lIG1peGluZyBvcGVyYXRpb24uCiAgICAgICAgLy8gdGFyZ2V0QmxvY2sKICAgICAgICB1aW50MjU2IGNoaWxkR2VuZXMgPSBnZW5lU2NpZW5jZS5taXhHZW5lcyhtYXRyb24uZ2VuZXMsIHNpcmUuZ2VuZXMsIG1hdHJvbi5jb29sZG93bkVuZEJsb2NrIC0gMSk7CgogICAgICAgIC8vIE1ha2UgdGhlIG5ldyBtb25zdGVyIQogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBtb25zdGVySW5kZXhUb093bmVyW19tYXRyb25JZF07CiAgICAgICAgdWludDI1NiBtb25zdGVySWQgPSBfY3JlYXRlTW9uc3RlcihfbWF0cm9uSWQsIG1hdHJvbi5zaXJpbmdXaXRoSWQsIHBhcmVudEdlbiArIDEsIGNoaWxkR2VuZXMsIG93bmVyKTsKCiAgICAgICAgLy8gQ2xlYXIgdGhlIHJlZmVyZW5jZSB0byBzaXJlIGZyb20gdGhlIG1hdHJvbiAoUkVRVUlSRUQhIEhhdmluZyBzaXJpbmdXaXRoSWQKICAgICAgICAvLyBzZXQgaXMgd2hhdCBtYXJrcyBhIG1hdHJvbiBhcyBiZWluZyBwcmVnbmFudC4pCiAgICAgICAgZGVsZXRlIG1hdHJvbi5zaXJpbmdXaXRoSWQ7CgogICAgICAgIC8vIEV2ZXJ5IHRpbWUgYSBtb25zdGVyIGdpdmVzIGJpcnRoIGNvdW50ZXIgaXMgZGVjcmVtZW50ZWQuCiAgICAgICAgcHJlZ25hbnRNb25zdGVycy0tOwoKICAgICAgICAvLyBTZW5kIHRoZSBiYWxhbmNlIGZlZSB0byB0aGUgcGVyc29uIHdobyBtYWRlIGJpcnRoIGhhcHBlbi4KICAgICAgICBtc2cuc2VuZGVyLnNlbmQoYXV0b0JpcnRoRmVlKTsKCiAgICAgICAgLy8gcmV0dXJuIHRoZSBuZXcgbW9uc3RlcidzIElECiAgICAgICAgcmV0dXJuIG1vbnN0ZXJJZDsKICAgIH0KfQoKCgoKCgoKCgoKCgovLy8gQHRpdGxlIEhhbmRsZXMgY3JlYXRpbmcgYXVjdGlvbnMgZm9yIHNhbGUgYW5kIHNpcmluZyBvZiBtb25zdGVycy4KLy8vICBUaGlzIHdyYXBwZXIgb2YgUmV2ZXJzZUF1Y3Rpb24gZXhpc3RzIG9ubHkgc28gdGhhdCB1c2VycyBjYW4gY3JlYXRlCi8vLyAgYXVjdGlvbnMgd2l0aCBvbmx5IG9uZSB0cmFuc2FjdGlvbi4KY29udHJhY3QgTW9uc3RlckF1Y3Rpb24gaXMgTW9uc3RlckJyZWVkaW5nIHsKCiAgICAvLyBAbm90aWNlIFRoZSBhdWN0aW9uIGNvbnRyYWN0IHZhcmlhYmxlcyBhcmUgZGVmaW5lZCBpbiBNb25zdGVyQmFzZSB0byBhbGxvdwogICAgLy8gIHVzIHRvIHJlZmVyIHRvIHRoZW0gaW4gTW9uc3Rlck93bmVyc2hpcCB0byBwcmV2ZW50IGFjY2lkZW50YWwgdHJhbnNmZXJzLgogICAgLy8gYHNhbGVBdWN0aW9uYCByZWZlcnMgdG8gdGhlIGF1Y3Rpb24gZm9yIGdlbjAgYW5kIHAycCBzYWxlIG9mIG1vbnN0ZXJzLgogICAgLy8gYHNpcmluZ0F1Y3Rpb25gIHJlZmVycyB0byB0aGUgYXVjdGlvbiBmb3Igc2lyaW5nIHJpZ2h0cyBvZiBtb25zdGVycy4KCiAgICAvLy8gQGRldiBTZXRzIHRoZSByZWZlcmVuY2UgdG8gdGhlIHNhbGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgLSBBZGRyZXNzIG9mIHNhbGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRTYWxlQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgU2FsZUNsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNhbGVDbG9ja0F1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc1NhbGVDbG9ja0F1Y3Rpb24oKSk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBzYWxlQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgdGhlIHJlZmVyZW5jZSB0byB0aGUgc2lyaW5nIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hZGRyZXNzIC0gQWRkcmVzcyBvZiBzaXJpbmcgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRTaXJpbmdBdWN0aW9uQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBTaXJpbmdDbG9ja0F1Y3Rpb24gY2FuZGlkYXRlQ29udHJhY3QgPSBTaXJpbmdDbG9ja0F1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc1NpcmluZ0Nsb2NrQXVjdGlvbigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIHNpcmluZ0F1Y3Rpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBQdXQgYSBtb25zdGVyIHVwIGZvciBhdWN0aW9uLgogICAgLy8vICBEb2VzIHNvbWUgb3duZXJzaGlwIHRyaWNrZXJ5IHRvIGNyZWF0ZSBhdWN0aW9ucyBpbiBvbmUgdHguCiAgICBmdW5jdGlvbiBjcmVhdGVTYWxlQXVjdGlvbigKICAgIHVpbnQyNTYgX21vbnN0ZXJJZCwKICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIEF1Y3Rpb24gY29udHJhY3QgY2hlY2tzIGlucHV0IHNpemVzCiAgICAgICAgLy8gSWYgbW9uc3RlciBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbW9uc3RlcklkKSk7CiAgICAgICAgLy8gRW5zdXJlIHRoZSBtb25zdGVyIGlzIG5vdCBwcmVnbmFudCB0byBwcmV2ZW50IHRoZSBhdWN0aW9uCiAgICAgICAgLy8gY29udHJhY3QgYWNjaWRlbnRhbGx5IHJlY2VpdmluZyBvd25lcnNoaXAgb2YgdGhlIGNoaWxkLgogICAgICAgIC8vIE5PVEU6IHRoZSBtb25zdGVyIElTIGFsbG93ZWQgdG8gYmUgaW4gYSBjb29sZG93bi4KICAgICAgICByZXF1aXJlKCFpc1ByZWduYW50KF9tb25zdGVySWQpKTsKICAgICAgICBfYXBwcm92ZShfbW9uc3RlcklkLCBzYWxlQXVjdGlvbik7CiAgICAgICAgLy8gU2FsZSBhdWN0aW9uIHRocm93cyBpZiBpbnB1dHMgYXJlIGludmFsaWQgYW5kIGNsZWFycwogICAgICAgIC8vIHRyYW5zZmVyIGFuZCBzaXJlIGFwcHJvdmFsIGFmdGVyIGVzY3Jvd2luZyB0aGUgbW9uc3Rlci4KICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgIF9tb25zdGVySWQsCiAgICAgICAgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgIF9kdXJhdGlvbiwKICAgICAgICBtc2cuc2VuZGVyCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBQdXQgYSBtb25zdGVyIHVwIGZvciBhdWN0aW9uIHRvIGJlIHNpcmUuCiAgICAvLy8gIFBlcmZvcm1zIGNoZWNrcyB0byBlbnN1cmUgdGhlIG1vbnN0ZXIgY2FuIGJlIHNpcmVkLCB0aGVuCiAgICAvLy8gIGRlbGVnYXRlcyB0byByZXZlcnNlIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBjcmVhdGVTaXJpbmdBdWN0aW9uKAogICAgdWludDI1NiBfbW9uc3RlcklkLAogICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgdWludDI1NiBfZHVyYXRpb24KICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBtb25zdGVyIGlzIGFscmVhZHkgb24gYW55IGF1Y3Rpb24sIHRoaXMgd2lsbCB0aHJvdwogICAgICAgIC8vIGJlY2F1c2UgaXQgd2lsbCBiZSBvd25lZCBieSB0aGUgYXVjdGlvbiBjb250cmFjdC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9tb25zdGVySWQpKTsKICAgICAgICByZXF1aXJlKGlzUmVhZHlUb0JyZWVkKF9tb25zdGVySWQpKTsKICAgICAgICBfYXBwcm92ZShfbW9uc3RlcklkLCBzaXJpbmdBdWN0aW9uKTsKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB0aHJvd3MgaWYgaW5wdXRzIGFyZSBpbnZhbGlkIGFuZCBjbGVhcnMKICAgICAgICAvLyB0cmFuc2ZlciBhbmQgc2lyZSBhcHByb3ZhbCBhZnRlciBlc2Nyb3dpbmcgdGhlIG1vbnN0ZXIuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgIF9tb25zdGVySWQsCiAgICAgICAgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgIF9kdXJhdGlvbiwKICAgICAgICBtc2cuc2VuZGVyCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wbGV0ZXMgYSBzaXJpbmcgYXVjdGlvbiBieSBiaWRkaW5nLgogICAgLy8vICBJbW1lZGlhdGVseSBicmVlZHMgdGhlIHdpbm5pbmcgbWF0cm9uIHdpdGggdGhlIHNpcmUgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCAtIElEIG9mIHRoZSBzaXJlIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCAtIElEIG9mIHRoZSBtYXRyb24gb3duZWQgYnkgdGhlIGJpZGRlci4KICAgIGZ1bmN0aW9uIGJpZE9uU2lyaW5nQXVjdGlvbigKICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgIHVpbnQyNTYgX21hdHJvbklkCiAgICApCiAgICBleHRlcm5hbAogICAgcGF5YWJsZQogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIEF1Y3Rpb24gY29udHJhY3QgY2hlY2tzIGlucHV0IHNpemVzCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbWF0cm9uSWQpKTsKICAgICAgICByZXF1aXJlKGlzUmVhZHlUb0JyZWVkKF9tYXRyb25JZCkpOwogICAgICAgIHJlcXVpcmUoX2NhbkJyZWVkV2l0aFZpYUF1Y3Rpb24oX21hdHJvbklkLCBfc2lyZUlkKSk7CgogICAgICAgIC8vIERlZmluZSB0aGUgY3VycmVudCBwcmljZSBvZiB0aGUgYXVjdGlvbi4KICAgICAgICB1aW50MjU2IGN1cnJlbnRQcmljZSA9IHNpcmluZ0F1Y3Rpb24uZ2V0Q3VycmVudFByaWNlKF9zaXJlSWQpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGN1cnJlbnRQcmljZSArIGF1dG9CaXJ0aEZlZSk7CgogICAgICAgIC8vIFNpcmluZyBhdWN0aW9uIHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBmYWlscy4KICAgICAgICBzaXJpbmdBdWN0aW9uLmJpZC52YWx1ZShtc2cudmFsdWUgLSBhdXRvQmlydGhGZWUpKF9zaXJlSWQpOwogICAgICAgIF9icmVlZFdpdGgodWludDMyKF9tYXRyb25JZCksIHVpbnQzMihfc2lyZUlkKSk7CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHRoZSBiYWxhbmNlIG9mIHRoZSBzYWxlIGF1Y3Rpb24gY29udHJhY3QKICAgIC8vLyB0byB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QuIFdlIHVzZSB0d28tc3RlcCB3aXRoZHJhd2FsIHRvCiAgICAvLy8gcHJldmVudCB0d28gdHJhbnNmZXIgY2FsbHMgaW4gdGhlIGF1Y3Rpb24gYmlkIGZ1bmN0aW9uLgogICAgZnVuY3Rpb24gd2l0aGRyYXdBdWN0aW9uQmFsYW5jZXMoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKICAgICAgICBzYWxlQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKICAgICAgICBzaXJpbmdBdWN0aW9uLndpdGhkcmF3QmFsYW5jZSgpOwogICAgfQp9CgoKLy8vIEB0aXRsZSBhbGwgZnVuY3Rpb25zIHJlbGF0ZWQgdG8gY3JlYXRpbmcgbW9uc3RlcnMKY29udHJhY3QgTW9uc3Rlck1pbnRpbmcgaXMgTW9uc3RlckF1Y3Rpb24gewoKICAgIC8vIExpbWl0cyB0aGUgbnVtYmVyIG9mIG1vbnN0ZXJzIHRoZSBjb250cmFjdCBvd25lciBjYW4gZXZlciBjcmVhdGUuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUk9NT19DUkVBVElPTl9MSU1JVCA9IDUwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX0NSRUFUSU9OX0xJTUlUID0gNDUwMDA7CgogICAgLy8gQ29uc3RhbnRzIGZvciBnZW4wIGF1Y3Rpb25zLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9TVEFSVElOR19QUklDRSA9IDEwIGZpbm5leTsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEdFTjBfQVVDVElPTl9EVVJBVElPTiA9IDEgZGF5czsKCiAgICAvLyBDb3VudHMgdGhlIG51bWJlciBvZiBtb25zdGVycyB0aGUgY29udHJhY3Qgb3duZXIgaGFzIGNyZWF0ZWQuCiAgICB1aW50MjU2IHB1YmxpYyBwcm9tb0NyZWF0ZWRDb3VudDsKICAgIHVpbnQyNTYgcHVibGljIGdlbjBDcmVhdGVkQ291bnQ7CgogICAgLy8vIEBkZXYgd2UgY2FuIGNyZWF0ZSBwcm9tbyBtb25zdGVycywgdXAgdG8gYSBsaW1pdC4gT25seSBjYWxsYWJsZSBieSBDT08KICAgIC8vLyBAcGFyYW0gX2dlbmVzIHRoZSBlbmNvZGVkIGdlbmVzIG9mIHRoZSBtb25zdGVyIHRvIGJlIGNyZWF0ZWQsIGFueSB2YWx1ZSBpcyBhY2NlcHRlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgdGhlIGZ1dHVyZSBvd25lciBvZiB0aGUgY3JlYXRlZCBtb25zdGVycy4gRGVmYXVsdCB0byBjb250cmFjdCBDT08KICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21vTW9uc3Rlcih1aW50MjU2IF9nZW5lcywgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIG9ubHlDT08gewogICAgICAgIGFkZHJlc3MgbW9uc3Rlck93bmVyID0gX293bmVyOwogICAgICAgIGlmIChtb25zdGVyT3duZXIgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBtb25zdGVyT3duZXIgPSBjb29BZGRyZXNzOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKHByb21vQ3JlYXRlZENvdW50IDwgUFJPTU9fQ1JFQVRJT05fTElNSVQpOwoKICAgICAgICBwcm9tb0NyZWF0ZWRDb3VudCsrOwogICAgICAgIF9jcmVhdGVNb25zdGVyKDAsIDAsIDAsIF9nZW5lcywgbW9uc3Rlck93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgbmV3IGdlbjAgbW9uc3RlciB3aXRoIHRoZSBnaXZlbiBnZW5lcyBhbmQKICAgIC8vLyAgY3JlYXRlcyBhbiBhdWN0aW9uIGZvciBpdC4KICAgIGZ1bmN0aW9uIGNyZWF0ZUdlbjBBdWN0aW9uKHVpbnQyNTYgX2dlbmVzKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICByZXF1aXJlKGdlbjBDcmVhdGVkQ291bnQgPCBHRU4wX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgdWludDI1NiBnZW5lcyA9IF9nZW5lczsKICAgICAgICBpZihnZW5lcyA9PSAwKQogICAgICAgIGdlbmVzID0gZ2VuZVNjaWVuY2UucmFuZG9tR2VuZXMoKTsKCiAgICAgICAgdWludDI1NiBtb25zdGVySWQgPSBfY3JlYXRlTW9uc3RlcigwLCAwLCAwLCBnZW5lcywgYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgX2FwcHJvdmUobW9uc3RlcklkLCBzYWxlQXVjdGlvbik7CgogICAgICAgIHNhbGVBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgbW9uc3RlcklkLAogICAgICAgIF9jb21wdXRlTmV4dEdlbjBQcmljZSgpLAogICAgICAgIDAsCiAgICAgICAgR0VOMF9BVUNUSU9OX0RVUkFUSU9OLAogICAgICAgIGFkZHJlc3ModGhpcykKICAgICAgICApOwoKICAgICAgICBnZW4wQ3JlYXRlZENvdW50Kys7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIG5leHQgZ2VuMCBhdWN0aW9uIHN0YXJ0aW5nIHByaWNlLCBnaXZlbgogICAgLy8vICB0aGUgYXZlcmFnZSBvZiB0aGUgcGFzdCA1IHByaWNlcyArIDUwJS4KICAgIGZ1bmN0aW9uIF9jb21wdXRlTmV4dEdlbjBQcmljZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYXZlUHJpY2UgPSBzYWxlQXVjdGlvbi5hdmVyYWdlR2VuMFNhbGVQcmljZSgpOwoKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdG8gZW5zdXJlIHdlIGRvbid0IG92ZXJmbG93IGFyaXRobWV0aWMKICAgICAgICByZXF1aXJlKGF2ZVByaWNlID09IHVpbnQyNTYodWludDEyOChhdmVQcmljZSkpKTsKCiAgICAgICAgdWludDI1NiBuZXh0UHJpY2UgPSBhdmVQcmljZSArIChhdmVQcmljZSAvIDIpOwoKICAgICAgICAvLyBXZSBuZXZlciBhdWN0aW9uIGZvciBsZXNzIHRoYW4gc3RhcnRpbmcgcHJpY2UKICAgICAgICBpZiAobmV4dFByaWNlIDwgR0VOMF9TVEFSVElOR19QUklDRSkgewogICAgICAgICAgICBuZXh0UHJpY2UgPSBHRU4wX1NUQVJUSU5HX1BSSUNFOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5leHRQcmljZTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgQ3J5cHRvTW9uc3RlcnM6IENvbGxlY3RpYmxlLCBicmVlZGFibGUsIGFuZCBvaC1zby1hZG9yYWJsZSBtb25zdGVycyBvbiB0aGUgRXRoZXJldW0gYmxvY2tjaGFpbi4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgVGhlIG1haW4gQ3J5cHRvTW9uc3RlcnMgY29udHJhY3QsIGtlZXBzIHRyYWNrIG9mIG1vbnN0ZXJzIHNvIHRoZXkgZG9uJ3Qgd2FuZGVyIGFyb3VuZCBhbmQgZ2V0IGxvc3QuCmNvbnRyYWN0IE1vbnN0ZXJDb3JlIGlzIE1vbnN0ZXJNaW50aW5nIHsKCiAgICAvLyBUaGlzIGlzIHRoZSBtYWluIENyeXB0b01vbnN0ZXJzIGNvbnRyYWN0LiBJbiBvcmRlciB0byBrZWVwIG91ciBjb2RlIHNlcGVyYXRlZCBpbnRvIGxvZ2ljYWwgc2VjdGlvbnMsCiAgICAvLyB3ZSd2ZSBicm9rZW4gaXQgdXAgaW4gdHdvIHdheXMuIEZpcnN0LCB3ZSBoYXZlIHNldmVyYWwgc2VwZXJhdGVseS1pbnN0YW50aWF0ZWQgc2libGluZyBjb250cmFjdHMKICAgIC8vIHRoYXQgaGFuZGxlIGF1Y3Rpb25zIGFuZCBvdXIgc3VwZXItdG9wLXNlY3JldCBnZW5ldGljIGNvbWJpbmF0aW9uIGFsZ29yaXRobS4gVGhlIGF1Y3Rpb25zIGFyZQogICAgLy8gc2VwZXJhdGUgc2luY2UgdGhlaXIgbG9naWMgaXMgc29tZXdoYXQgY29tcGxleCBhbmQgdGhlcmUncyBhbHdheXMgYSByaXNrIG9mIHN1YnRsZSBidWdzLiBCeSBrZWVwaW5nCiAgICAvLyB0aGVtIGluIHRoZWlyIG93biBjb250cmFjdHMsIHdlIGNhbiB1cGdyYWRlIHRoZW0gd2l0aG91dCBkaXNydXB0aW5nIHRoZSBtYWluIGNvbnRyYWN0IHRoYXQgdHJhY2tzCiAgICAvLyBtb25zdGVyIG93bmVyc2hpcC4gVGhlIGdlbmV0aWMgY29tYmluYXRpb24gYWxnb3JpdGhtIGlzIGtlcHQgc2VwZXJhdGUgc28gd2UgY2FuIG9wZW4tc291cmNlIGFsbCBvZgogICAgLy8gdGhlIHJlc3Qgb2Ygb3VyIGNvZGUgd2l0aG91dCBtYWtpbmcgaXQgX3Rvb18gZWFzeSBmb3IgZm9sa3MgdG8gZmlndXJlIG91dCBob3cgdGhlIGdlbmV0aWNzIHdvcmsuCiAgICAvLyBEb24ndCB3b3JyeSwgSSdtIHN1cmUgc29tZW9uZSB3aWxsIHJldmVyc2UgZW5naW5lZXIgaXQgc29vbiBlbm91Z2ghCiAgICAvLwogICAgLy8gU2Vjb25kbHksIHdlIGJyZWFrIHRoZSBjb3JlIGNvbnRyYWN0IGludG8gbXVsdGlwbGUgZmlsZXMgdXNpbmcgaW5oZXJpdGVuY2UsIG9uZSBmb3IgZWFjaCBtYWpvcgogICAgLy8gZmFjZXQgb2YgZnVuY3Rpb25hbGl0eSBvZiBDSy4gVGhpcyBhbGxvd3MgdXMgdG8ga2VlcCByZWxhdGVkIGNvZGUgYnVuZGxlZCB0b2dldGhlciB3aGlsZSBzdGlsbAogICAgLy8gYXZvaWRpbmcgYSBzaW5nbGUgZ2lhbnQgZmlsZSB3aXRoIGV2ZXJ5dGhpbmcgaW4gaXQuIFRoZSBicmVha2Rvd24gaXMgYXMgZm9sbG93czoKICAgIC8vCiAgICAvLyAgICAgIC0gTW9uc3RlckJhc2U6IFRoaXMgaXMgd2hlcmUgd2UgZGVmaW5lIHRoZSBtb3N0IGZ1bmRhbWVudGFsIGNvZGUgc2hhcmVkIHRocm91Z2hvdXQgdGhlIGNvcmUKICAgIC8vICAgICAgICAgICAgIGZ1bmN0aW9uYWxpdHkuIFRoaXMgaW5jbHVkZXMgb3VyIG1haW4gZGF0YSBzdG9yYWdlLCBjb25zdGFudHMgYW5kIGRhdGEgdHlwZXMsIHBsdXMKICAgIC8vICAgICAgICAgICAgIGludGVybmFsIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgdGhlc2UgaXRlbXMuCiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJBY2Nlc3NDb250cm9sOiBUaGlzIGNvbnRyYWN0IG1hbmFnZXMgdGhlIHZhcmlvdXMgYWRkcmVzc2VzIGFuZCBjb25zdHJhaW50cyBmb3Igb3BlcmF0aW9ucwogICAgLy8gICAgICAgICAgICAgdGhhdCBjYW4gYmUgZXhlY3V0ZWQgb25seSBieSBzcGVjaWZpYyByb2xlcy4gTmFtZWx5IENFTywgQ0ZPIGFuZCBDT08uCiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJPd25lcnNoaXA6IFRoaXMgcHJvdmlkZXMgdGhlIG1ldGhvZHMgcmVxdWlyZWQgZm9yIGJhc2ljIG5vbi1mdW5naWJsZSB0b2tlbgogICAgLy8gICAgICAgICAgICAgdHJhbnNhY3Rpb25zLCBmb2xsb3dpbmcgdGhlIGRyYWZ0IEVSQy03MjEgc3BlYyAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkuCiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJCcmVlZGluZzogVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtZXRob2RzIG5lY2Vzc2FyeSB0byBicmVlZCBtb25zdGVycyB0b2dldGhlciwgaW5jbHVkaW5nCiAgICAvLyAgICAgICAgICAgICBrZWVwaW5nIHRyYWNrIG9mIHNpcmluZyBvZmZlcnMsIGFuZCByZWxpZXMgb24gYW4gZXh0ZXJuYWwgZ2VuZXRpYyBjb21iaW5hdGlvbiBjb250cmFjdC4KICAgIC8vCiAgICAvLyAgICAgIC0gTW9uc3RlckF1Y3Rpb25zOiBIZXJlIHdlIGhhdmUgdGhlIHB1YmxpYyBtZXRob2RzIGZvciBhdWN0aW9uaW5nIG9yIGJpZGRpbmcgb24gbW9uc3RlcnMgb3Igc2lyaW5nCiAgICAvLyAgICAgICAgICAgICBzZXJ2aWNlcy4gVGhlIGFjdHVhbCBhdWN0aW9uIGZ1bmN0aW9uYWxpdHkgaXMgaGFuZGxlZCBpbiB0d28gc2libGluZyBjb250cmFjdHMgKG9uZQogICAgLy8gICAgICAgICAgICAgZm9yIHNhbGVzIGFuZCBvbmUgZm9yIHNpcmluZyksIHdoaWxlIGF1Y3Rpb24gY3JlYXRpb24gYW5kIGJpZGRpbmcgaXMgbW9zdGx5IG1lZGlhdGVkCiAgICAvLyAgICAgICAgICAgICB0aHJvdWdoIHRoaXMgZmFjZXQgb2YgdGhlIGNvcmUgY29udHJhY3QuCiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJNaW50aW5nOiBUaGlzIGZpbmFsIGZhY2V0IGNvbnRhaW5zIHRoZSBmdW5jdGlvbmFsaXR5IHdlIHVzZSBmb3IgY3JlYXRpbmcgbmV3IGdlbjAgbW9uc3RlcnMuCiAgICAvLyAgICAgICAgICAgICBXZSBjYW4gbWFrZSB1cCB0byA1MDAwICJwcm9tbyIgbW9uc3RlcnMgdGhhdCBjYW4gYmUgZ2l2ZW4gYXdheSAoZXNwZWNpYWxseSBpbXBvcnRhbnQgd2hlbgogICAgLy8gICAgICAgICAgICAgdGhlIGNvbW11bml0eSBpcyBuZXcpLCBhbmQgYWxsIG90aGVycyBjYW4gb25seSBiZSBjcmVhdGVkIGFuZCB0aGVuIGltbWVkaWF0ZWx5IHB1dCB1cAogICAgLy8gICAgICAgICAgICAgZm9yIGF1Y3Rpb24gdmlhIGFuIGFsZ29yaXRobWljYWxseSBkZXRlcm1pbmVkIHN0YXJ0aW5nIHByaWNlLiBSZWdhcmRsZXNzIG9mIGhvdyB0aGV5CiAgICAvLyAgICAgICAgICAgICBhcmUgY3JlYXRlZCwgdGhlcmUgaXMgYSBoYXJkIGxpbWl0IG9mIDUwayBnZW4wIG1vbnN0ZXJzLiBBZnRlciB0aGF0LCBpdCdzIGFsbCB1cCB0byB0aGUKICAgIC8vICAgICAgICAgICAgIGNvbW11bml0eSB0byBicmVlZCwgYnJlZWQsIGJyZWVkIQoKICAgIC8vIFNldCBpbiBjYXNlIHRoZSBjb3JlIGNvbnRyYWN0IGlzIGJyb2tlbiBhbmQgYW4gdXBncmFkZSBpcyByZXF1aXJlZAogICAgYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgdGhlIG1haW4gQ3J5cHRvTW9uc3RlcnMgc21hcnQgY29udHJhY3QgaW5zdGFuY2UuCiAgICBmdW5jdGlvbiBNb25zdGVyQ29yZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gU3RhcnRzIHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSBmYWxzZTsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENFTwogICAgICAgIGNlb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgYWxzbyB0aGUgaW5pdGlhbCBDT08KICAgICAgICBjb29BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8KICAgICAgICBjZm9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gc3RhcnQgd2l0aCB0aGUgbXl0aGljYWwgbW9uc3RlciAwIC0gc28gd2UgZG9uJ3QgaGF2ZSBnZW5lcmF0aW9uLTAgcGFyZW50IGlzc3VlcwogICAgICAgIF9jcmVhdGVNb25zdGVyKDAsIDAsIDAsIHVpbnQyNTYoNTc4OTYwNDQ2MTg2NTgwOTc3MTE3ODU0OTI1MDQzNDM5NTM5MjY2MzQ5OTIzMzI4MjAyODIwMTk3Mjg3OTIwMDQwMjE1MTE0NjI4MDcpLCBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvLy8gQGRldiBVc2VkIHRvIG1hcmsgdGhlIHNtYXJ0IGNvbnRyYWN0IGFzIHVwZ3JhZGVkLCBpbiBjYXNlIHRoZXJlIGlzIGEgc2VyaW91cwogICAgLy8vICBicmVha2luZyBidWcuIFRoaXMgbWV0aG9kIGRvZXMgbm90aGluZyBidXQga2VlcCB0cmFjayBvZiB0aGUgbmV3IGNvbnRyYWN0IGFuZAogICAgLy8vICBlbWl0IGEgbWVzc2FnZSBpbmRpbW9uc3RlcmluZyB0aGF0IHRoZSBuZXcgYWRkcmVzcyBpcyBzZXQuIEl0J3MgdXAgdG8gY2xpZW50cyBvZiB0aGlzCiAgICAvLy8gIGNvbnRyYWN0IHRvIHVwZGF0ZSB0byB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MgaW4gdGhhdCBjYXNlLiAoVGhpcyBjb250cmFjdCB3aWxsCiAgICAvLy8gIGJlIHBhdXNlZCBpbmRlZmluaXRlbHkgaWYgc3VjaCBhbiB1cGdyYWRlIHRha2VzIHBsYWNlLikKICAgIC8vLyBAcGFyYW0gX3YyQWRkcmVzcyBuZXcgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgLy8gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgICAgIG5ld0NvbnRyYWN0QWRkcmVzcyA9IF92MkFkZHJlc3M7CiAgICAgICAgQ29udHJhY3RVcGdyYWRlKF92MkFkZHJlc3MpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE5vIHRpcHBpbmchCiAgICAvLy8gQGRldiBSZWplY3QgYWxsIEV0aGVyIGZyb20gYmVpbmcgc2VudCBoZXJlLCB1bmxlc3MgaXQncyBmcm9tIG9uZSBvZiB0aGUKICAgIC8vLyAgdHdvIGF1Y3Rpb24gY29udHJhY3RzLiAoSG9wZWZ1bGx5LCB3ZSBjYW4gcHJldmVudCB1c2VyIGFjY2lkZW50cy4pCiAgICBmdW5jdGlvbigpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKHNhbGVBdWN0aW9uKSB8fAogICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgbW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX2lkIFRoZSBJRCBvZiB0aGUgbW9uc3RlciBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXIodWludDI1NiBfaWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoCiAgICBib29sIGlzR2VzdGF0aW5nLAogICAgYm9vbCBpc1JlYWR5LAogICAgdWludDI1NiBjb29sZG93bkluZGV4LAogICAgdWludDI1NiBuZXh0QWN0aW9uQXQsCiAgICB1aW50MjU2IHNpcmluZ1dpdGhJZCwKICAgIHVpbnQyNTYgYmlydGhUaW1lLAogICAgdWludDI1NiBtYXRyb25JZCwKICAgIHVpbnQyNTYgc2lyZUlkLAogICAgdWludDI1NiBnZW5lcmF0aW9uLAogICAgdWludDI1NiBnZW5lcwogICAgKSB7CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbnN0ZXIgPSBtb25zdGVyc1tfaWRdOwoKICAgICAgICAvLyBpZiB0aGlzIHZhcmlhYmxlIGlzIDAgdGhlbiBpdCdzIG5vdCBnZXN0YXRpbmcKICAgICAgICBpc0dlc3RhdGluZyA9IChtb25zdGVyLnNpcmluZ1dpdGhJZCAhPSAwKTsKICAgICAgICBpc1JlYWR5ID0gKG1vbnN0ZXIuY29vbGRvd25FbmRCbG9jayA8PSBibG9jay5udW1iZXIpOwogICAgICAgIGNvb2xkb3duSW5kZXggPSB1aW50MjU2KG1vbnN0ZXIuY29vbGRvd25JbmRleCk7CiAgICAgICAgbmV4dEFjdGlvbkF0ID0gdWludDI1Nihtb25zdGVyLmNvb2xkb3duRW5kQmxvY2spOwogICAgICAgIHNpcmluZ1dpdGhJZCA9IHVpbnQyNTYobW9uc3Rlci5zaXJpbmdXaXRoSWQpOwogICAgICAgIGJpcnRoVGltZSA9IHVpbnQyNTYobW9uc3Rlci5iaXJ0aFRpbWUpOwogICAgICAgIG1hdHJvbklkID0gdWludDI1Nihtb25zdGVyLm1hdHJvbklkKTsKICAgICAgICBzaXJlSWQgPSB1aW50MjU2KG1vbnN0ZXIuc2lyZUlkKTsKICAgICAgICBnZW5lcmF0aW9uID0gdWludDI1Nihtb25zdGVyLmdlbmVyYXRpb24pOwogICAgICAgIGdlbmVzID0gbW9uc3Rlci5nZW5lczsKICAgIH0KCiAgICAvLy8gQGRldiBPdmVycmlkZSB1bnBhdXNlIHNvIGl0IHJlcXVpcmVzIGFsbCBleHRlcm5hbCBjb250cmFjdCBhZGRyZXNzZXMKICAgIC8vLyAgdG8gYmUgc2V0IGJlZm9yZSBjb250cmFjdCBjYW4gYmUgdW5wYXVzZWQuIEFsc28sIHdlIGNhbid0IGhhdmUKICAgIC8vLyAgbmV3Q29udHJhY3RBZGRyZXNzIHNldCBlaXRoZXIsIGJlY2F1c2UgdGhlbiB0aGUgY29udHJhY3Qgd2FzIHVwZ3JhZGVkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gd2UgY2FuIGNhbGwgc3VwZXIudW5wYXVzZQogICAgLy8vICB3aXRob3V0IHVzaW5nIGFuIGV4cGVuc2l2ZSBDQUxMLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUoc2FsZUF1Y3Rpb24gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShzaXJpbmdBdWN0aW9uICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoZ2VuZVNjaWVuY2UgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShuZXdDb250cmFjdEFkZHJlc3MgPT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIEFjdHVhbGx5IHVucGF1c2UgdGhlIGNvbnRyYWN0LgogICAgICAgIHN1cGVyLnVucGF1c2UoKTsKICAgIH0KCiAgICAvLyBAZGV2IEFsbG93cyB0aGUgQ0ZPIHRvIGNhcHR1cmUgdGhlIGJhbGFuY2UgYXZhaWxhYmxlIHRvIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgICAgICAvLyBTdWJ0cmFjdCBhbGwgdGhlIGN1cnJlbnRseSBwcmVnbmFudCBtb25zdGVycyB3ZSBoYXZlLCBwbHVzIDEgb2YgbWFyZ2luLgogICAgICAgIHVpbnQyNTYgc3VidHJhY3RGZWVzID0gKHByZWduYW50TW9uc3RlcnMgKyAxKSAqIGF1dG9CaXJ0aEZlZTsKCiAgICAgICAgaWYgKGJhbGFuY2UgPiBzdWJ0cmFjdEZlZXMpIHsKICAgICAgICAgICAgY2ZvQWRkcmVzcy5zZW5kKGJhbGFuY2UgLSBzdWJ0cmFjdEZlZXMpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
