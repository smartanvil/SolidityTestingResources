Class {
	#name : #SRTa61c86eea36c9ebe51b70c4a77ecbce0a6078d02,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa61c86eea36c9ebe51b70c4a77ecbce0a6078d02 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gcGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlQWNjZXNzQ29udHJvbCB7CiAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICBhZGRyZXNzIHB1YmxpYyBjZW9BZGRyZXNzOwogIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgYWRkcmVzcyBwdWJsaWMgY29vQWRkcmVzczsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUNGTygpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5Q09PKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICByZXF1aXJlKAogICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MgfHwKICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgIG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcwogICAgKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICBjZW9BZGRyZXNzID0gX25ld0NFTzsKICB9CgogIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgcmVxdWlyZShfbmV3Q0ZPICE9IGFkZHJlc3MoMCkpOwoKICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogIH0KCiAgZnVuY3Rpb24gc2V0Q09PKGFkZHJlc3MgX25ld0NPTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgfQoKICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICBwYXVzZWQgPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgcGF1c2VkID0gZmFsc2U7CiAgfQp9Cgpjb250cmFjdCBUcnVlbG92ZUJhc2UgaXMgVHJ1ZWxvdmVBY2Nlc3NDb250cm9sIHsKCURpYW1vbmRbXSBkaWFtb25kczsKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGRpYW1vbmRJbmRleFRvT3duZXI7CgltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CgltYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBkaWFtb25kSW5kZXhUb0FwcHJvdmVkOwoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGZsb3dlckJhbGFuY2VzOwoKCXN0cnVjdCBEaWFtb25kIHsKCQlieXRlczI0IG1vZGVsOwoJCXVpbnQxNiB5ZWFyOwoJCXVpbnQxNiBubzsKCQl1aW50IGFjdGl2YXRlQXQ7Cgl9CgoJc3RydWN0IE1vZGVsIHsKCQlieXRlczI0IG1vZGVsOwoJCXVpbnQgY3VycmVudDsKCQl1aW50IHRvdGFsOwoJCXVpbnQxNiB5ZWFyOwoJCXVpbnQyNTYgcHJpY2U7Cgl9CgoJTW9kZWwgZGlhbW9uZDE7CglNb2RlbCBkaWFtb25kMjsKCU1vZGVsIGRpYW1vbmQzOwoJTW9kZWwgZmxvd2VyOwoKCXVpbnQgc2VuZEdpZnRQcmljZTsKCXVpbnQgYmVnaW5TYWxlVGltZTsKCXVpbnQgbmV4dFNhbGVUaW1lOwoJdWludCByZWdpc3RlclByaWNlOwoKCURpYW1vbmRBdWN0aW9uIHB1YmxpYyBkaWFtb25kQXVjdGlvbjsKCUZsb3dlckF1Y3Rpb24gcHVibGljIGZsb3dlckF1Y3Rpb247CgoJZnVuY3Rpb24gVHJ1ZWxvdmVCYXNlKCkgaW50ZXJuYWwgewoJCXNlbmRHaWZ0UHJpY2UgPSAwLjAwMSBldGhlcjsgLy8gTUFSSzogTW9kaWZ5IGl0CgkJcmVnaXN0ZXJQcmljZSA9IDAuMDEgZXRoZXI7IC8vIE1BUks6IE1vZGlmeSBpdAoJCV9zZXRWYXJzKCk7CgoJCWRpYW1vbmQxID0gTW9kZWwoe21vZGVsOiAiT25seU9uZSIsIGN1cnJlbnQ6IDAsIHRvdGFsOiAxLCB5ZWFyOiAyMDE4LCBwcmljZTogMTAwMCBldGhlcn0pOyAvLyBNQVJLOiBNb2RpZnkgaXQKCQlkaWFtb25kMiA9IE1vZGVsKHttb2RlbDogIkV0ZXJuaXR5MjAxOCIsIGN1cnJlbnQ6IDAsIHRvdGFsOiA1LCB5ZWFyOiAyMDE4LCBwcmljZTogNTAgZXRoZXJ9KTsgLy8gTUFSSzogTW9kaWZ5IGl0CgkJZGlhbW9uZDMgPSBNb2RlbCh7bW9kZWw6ICJNZW1vcmlhbCIsIGN1cnJlbnQ6IDAsIHRvdGFsOiAxMDAwLCB5ZWFyOiAyMDE4LCBwcmljZTogMSBldGhlcn0pOyAvLyBNQVJLOiBNb2RpZnkgaXQKCQlmbG93ZXIgPSBNb2RlbCh7bW9kZWw6ICJNeVNhc3N5R2lybCIsIGN1cnJlbnQ6IDAsIHRvdGFsOiAxMDAwMDAwMCwgeWVhcjogMjAxOCwgcHJpY2U6IDAuMDEgZXRoZXJ9KTsgLy8gTUFSSzogTW9kaWZ5IGl0Cgl9CgoJZnVuY3Rpb24gX3NldFZhcnMoKSBpbnRlcm5hbCB7CgkJYmVnaW5TYWxlVGltZSA9IG5vdzsKCQluZXh0U2FsZVRpbWUgPSBiZWdpblNhbGVUaW1lICsgMzAwIGRheXM7IC8vIE1BUks6IE1vZGlmeSBpdAoJfQoKCWZ1bmN0aW9uIHNldFNlbmRHaWZ0UHJpY2UodWludCBfc2VuZEdpZnRQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CgkJc2VuZEdpZnRQcmljZSA9IF9zZW5kR2lmdFByaWNlOwoJfQoKCWZ1bmN0aW9uIHNldFJlZ2lzdGVyUHJpY2UodWludCBfcmVnaXN0ZXJQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CgkJcmVnaXN0ZXJQcmljZSA9IF9yZWdpc3RlclByaWNlOwoJfQoKCWZ1bmN0aW9uIF9nZXRNb2RlbCh1aW50IF9pbmRleCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKE1vZGVsIHN0b3JhZ2UpIHsKCQlpZiAoX2luZGV4ID09IDEpIHsKCQkJcmV0dXJuIGRpYW1vbmQxOwoJCX0gZWxzZSBpZiAoX2luZGV4ID09IDIpIHsKCQkJcmV0dXJuIGRpYW1vbmQyOwoJCX0gZWxzZSBpZiAoX2luZGV4ID09IDMpIHsKCQkJcmV0dXJuIGRpYW1vbmQzOwoJCX0gZWxzZSBpZiAoX2luZGV4ID09IDQpIHsKCQkJcmV0dXJuIGZsb3dlcjsKCQl9CgkJcmV2ZXJ0KCk7Cgl9CglmdW5jdGlvbiBnZXRNb2RlbCh1aW50IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKAoJCWJ5dGVzMjQgbW9kZWwsCgkJdWludCBjdXJyZW50LAoJCXVpbnQgdG90YWwsCgkJdWludDE2IHllYXIsCgkJdWludDI1NiBwcmljZQoJKSB7CgkJTW9kZWwgc3RvcmFnZSBfbW9kZWwgPSBfZ2V0TW9kZWwoX2luZGV4KTsKCQltb2RlbCA9IF9tb2RlbC5tb2RlbDsKCQljdXJyZW50ID0gX21vZGVsLmN1cnJlbnQ7CgkJdG90YWwgPSBfbW9kZWwudG90YWw7CgkJeWVhciA9IF9tb2RlbC55ZWFyOwoJCXByaWNlID0gX21vZGVsLnByaWNlOwoJfQp9Cgpjb250cmFjdCBFSVAyMEludGVyZmFjZSB7CiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgaXMgcmVwbGFjZWQgd2l0aDoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAqLwogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIGZsb3dlclRvdGFsU3VwcGx5OwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZGbG93ZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZsb3dlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUZsb3dlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlRmxvd2VyKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlRmxvd2VyKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgLy8gc29saGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zaW1wbGUtZXZlbnQtZnVuYy1uYW1lICAKICAgIGV2ZW50IFRyYW5zZmVyRmxvd2VyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSk7IAogICAgZXZlbnQgQXBwcm92YWxGbG93ZXIoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICBmdW5jdGlvbiBzdXBwb3J0c0VJUDIwSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KY29udHJhY3QgRVJDNzIxIHsKICAgIC8vIFJlcXVpcmVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewoJZnVuY3Rpb24gZ2V0TWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nKSBwdWJsaWMgcHVyZSByZXR1cm5zIChieXRlczMyWzRdIGJ1ZmZlciwgdWludDI1NiBjb3VudCkgewoJCWlmIChfdG9rZW5JZCA9PSAxKSB7CgkJCWJ1ZmZlclswXSA9ICJIZWxsbyBXb3JsZCEgOkQiOwoJCQljb3VudCA9IDE1OwoJCX0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMikgewoJCQlidWZmZXJbMF0gPSAiSSB3b3VsZCBkZWZpbml0ZWx5IGNob29zZSBhIG1lZGkiOwoJCQlidWZmZXJbMV0gPSAidW0gbGVuZ3RoIHN0cmluZy4iOwoJCQljb3VudCA9IDQ5OwoJCX0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMykgewoJCQlidWZmZXJbMF0gPSAiTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIG1pIGUiOwoJCQlidWZmZXJbMV0gPSAic3QgYWNjdW1zYW4gZGFwaWJ1cyBhdWd1ZSBsb3JlbSwiOwoJCQlidWZmZXJbMl0gPSAiIHRyaXN0aXF1ZSB2ZXN0aWJ1bHVtIGlkLCBsaWJlcm8iOwoJCQlidWZmZXJbM10gPSAiIHN1c2NpcGl0IHZhcml1cyBzYXBpZW4gYWxpcXVhbS4iOwoJCQljb3VudCA9IDEyODsKCQl9Cgl9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlT3duZXJzaGlwIGlzIFRydWVsb3ZlQmFzZSwgRVJDNzIxIHsKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJDcnlwdG9UcnVlbG92ZSI7CglzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJDVCI7CgoJLy8gVGhlIGNvbnRyYWN0IHRoYXQgd2lsbCByZXR1cm4ga2l0dHkgbWV0YWRhdGEKCUVSQzcyMU1ldGFkYXRhIHB1YmxpYyBlcmM3MjFNZXRhZGF0YTsKCglieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCQkJLy8gYnl0ZXM0KGtlY2NhazI1Nigic3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KSIpKTsKCglieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCQkJLy8gYnl0ZXM0KGtlY2NhazI1NigibmFtZSgpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1Nigic3ltYm9sKCkiKSkgXgoJCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0b3RhbFN1cHBseSgpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1NigiYmFsYW5jZU9mKGFkZHJlc3MpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1Nigib3duZXJPZih1aW50MjU2KSIpKSBeCgkJCS8vIGJ5dGVzNChrZWNjYWsyNTYoImFwcHJvdmUoYWRkcmVzcyx1aW50MjU2KSIpKSBeCgkJCS8vIGJ5dGVzNChrZWNjYWsyNTYoInRyYW5zZmVyKGFkZHJlc3MsdWludDI1NikiKSkgXgoJCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1NigidG9rZW5zT2ZPd25lcihhZGRyZXNzKSIpKSBeCgkJCS8vIGJ5dGVzNChrZWNjYWsyNTYoInRva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpIikpOwoKCS8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KCS8vLyAgUmV0dXJucyB0cnVlIGZvciBhbnkgc3RhbmRhcmRpemVkIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgdGhpcyBjb250cmFjdC4gV2UgaW1wbGVtZW50CgkvLy8gIEVSQy0xNjUgKG9idmlvdXNseSEpIGFuZCBFUkMtNzIxLgoJZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJLy8gREVCVUcgT05MWQoJCS8vcmVxdWlyZSgoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9PSAweDAxZmZjOWE3KSAmJiAoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9PSAweDlhMjA0ODNkKSk7CgoJCXJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKCX0KCglmdW5jdGlvbiBzZXRNZXRhZGF0YUFkZHJlc3MoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzKSBwdWJsaWMgb25seUNFTyB7CgkJZXJjNzIxTWV0YWRhdGEgPSBFUkM3MjFNZXRhZGF0YShfY29udHJhY3RBZGRyZXNzKTsKCX0KCglmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJCXJldHVybiBkaWFtb25kSW5kZXhUb093bmVyW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7Cgl9CgoJZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CgkJb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CgkJZGlhbW9uZEluZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgkJaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKCQkJb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKCQkJZGVsZXRlIGRpYW1vbmRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwoJCX0KCQlUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKCQkJcmV0dXJuIGRpYW1vbmRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKCX0KCglmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewoJCQlkaWFtb25kSW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKCX0KCgkvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgS2l0dGllcyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCgkvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KCS8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewoJCQlyZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyKAoJCQlhZGRyZXNzIF90bywKCQkJdWludDI1NiBfdG9rZW5JZAoJKQoJCQlleHRlcm5hbAoJCQl3aGVuTm90UGF1c2VkCgl7CgkJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCQlyZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKCQkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhkaWFtb25kQXVjdGlvbikpOwoJCQlyZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgoJCQlfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJZnVuY3Rpb24gYXBwcm92ZSgKCQkJYWRkcmVzcyBfdG8sCgkJCXVpbnQyNTYgX3Rva2VuSWQKCSkKCQkJZXh0ZXJuYWwKCQkJd2hlbk5vdFBhdXNlZAoJewoJCQlyZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgoJCQlfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCgkJCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKCQkJYWRkcmVzcyBfZnJvbSwKCQkJYWRkcmVzcyBfdG8sCgkJCXVpbnQyNTYgX3Rva2VuSWQKCSkKCQkJZXh0ZXJuYWwKCQkJd2hlbk5vdFBhdXNlZAoJewoJCQlyZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCQkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CgkJCXJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgkJCXJlcXVpcmUoX293bnMoX2Zyb20sIF90b2tlbklkKSk7CgoJCQlfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwoJfQoKCWZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewoJCQlyZXR1cm4gZGlhbW9uZHMubGVuZ3RoIC0gMTsKCX0KCglmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCgkJCWV4dGVybmFsCgkJCXZpZXcKCQkJcmV0dXJucyAoYWRkcmVzcyBvd25lcikKCXsKCQkJb3duZXIgPSBkaWFtb25kSW5kZXhUb093bmVyW190b2tlbklkXTsKCgkJCXJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7Cgl9CgoJLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gRmlyc3QsIGl0J3MgZmFpcmx5CgkvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBLaXR0eSBhcnJheSBsb29raW5nIGZvciBjYXRzIGJlbG9uZ2luZyB0byBvd25lciksCgkvLy8gIGJ1dCBpdCBhbHNvIHJldHVybnMgYSBkeW5hbWljIGFycmF5LCB3aGljaCBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscywgYW5kCgkvLy8gIG5vdCBjb250cmFjdC10by1jb250cmFjdCBjYWxscy4KCWZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKCQkJdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgoJCQlpZiAodG9rZW5Db3VudCA9PSAwKSB7CgkJCQkJLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CgkJCQkJcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CgkJCX0gZWxzZSB7CgkJCQkJdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwoJCQkJCXVpbnQyNTYgdG90YWxEaWFtb25kcyA9IHRvdGFsU3VwcGx5KCk7CgkJCQkJdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgoJCQkJCXVpbnQyNTYgZGlhbW9uZElkOwoKCQkJCQlmb3IgKGRpYW1vbmRJZCA9IDE7IGRpYW1vbmRJZCA8PSB0b3RhbERpYW1vbmRzOyBkaWFtb25kSWQrKykgewoJCQkJCQkJaWYgKGRpYW1vbmRJbmRleFRvT3duZXJbZGlhbW9uZElkXSA9PSBfb3duZXIpIHsKCQkJCQkJCQkJcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGRpYW1vbmRJZDsKCQkJCQkJCQkJcmVzdWx0SW5kZXgrKzsKCQkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiByZXN1bHQ7CgkJCX0KCX0KCglmdW5jdGlvbiBfbWVtY3B5KHVpbnQgX2Rlc3QsIHVpbnQgX3NyYywgdWludCBfbGVuKSBwcml2YXRlIHB1cmUgewoJCQkvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQoJCQlmb3IoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CgkJCQkJYXNzZW1ibHkgewoJCQkJCQkJbXN0b3JlKF9kZXN0LCBtbG9hZChfc3JjKSkKCQkJCQl9CgkJCQkJX2Rlc3QgKz0gMzI7CgkJCQkJX3NyYyArPSAzMjsKCQkJfQoKCQkJLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKCQkJdWludDI1NiBtYXNrID0gMjU2ICoqICgzMiAtIF9sZW4pIC0gMTsKCQkJYXNzZW1ibHkgewoJCQkJCWxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChfc3JjKSwgbm90KG1hc2spKQoJCQkJCWxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoX2Rlc3QpLCBtYXNrKQoJCQkJCW1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQoJCQl9Cgl9CgoJZnVuY3Rpb24gX3RvU3RyaW5nKGJ5dGVzMzJbNF0gX3Jhd0J5dGVzLCB1aW50MjU2IF9zdHJpbmdMZW5ndGgpIHByaXZhdGUgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKCQkJdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CgkJCXVpbnQyNTYgb3V0cHV0UHRyOwoJCQl1aW50MjU2IGJ5dGVzUHRyOwoKCQkJYXNzZW1ibHkgewoJCQkJCW91dHB1dFB0ciA6PSBhZGQob3V0cHV0U3RyaW5nLCAzMikKCQkJCQlieXRlc1B0ciA6PSBfcmF3Qnl0ZXMKCQkJfQoKCQkJX21lbWNweShvdXRwdXRQdHIsIGJ5dGVzUHRyLCBfc3RyaW5nTGVuZ3RoKTsKCgkJCXJldHVybiBvdXRwdXRTdHJpbmc7Cgl9CgoJZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkgewoJCQlyZXF1aXJlKGVyYzcyMU1ldGFkYXRhICE9IGFkZHJlc3MoMCkpOwoJCQlieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CgkJCXVpbnQyNTYgY291bnQ7CgkJCShidWZmZXIsIGNvdW50KSA9IGVyYzcyMU1ldGFkYXRhLmdldE1ldGFkYXRhKF90b2tlbklkLCBfcHJlZmVycmVkVHJhbnNwb3J0KTsKCgkJCXJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7Cgl9CgoJZnVuY3Rpb24gZ2V0RGlhbW9uZCh1aW50MjU2IF9pZCkKCQlleHRlcm5hbAoJCXZpZXcKCQlyZXR1cm5zICgKCQlieXRlczI0IG1vZGVsLAoJCXVpbnQxNiB5ZWFyLAoJCXVpbnQxNiBubywKCQl1aW50IGFjdGl2YXRlQXQKCSkgewoJCURpYW1vbmQgc3RvcmFnZSBkaWFtb25kID0gZGlhbW9uZHNbX2lkXTsKCgkJbW9kZWwgPSBkaWFtb25kLm1vZGVsOwoJCXllYXIgPSBkaWFtb25kLnllYXI7CgkJbm8gPSBkaWFtb25kLm5vOwoJCWFjdGl2YXRlQXQgPSBkaWFtb25kLmFjdGl2YXRlQXQ7Cgl9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlRmxvd2VyT3duZXJzaGlwIGlzIFRydWVsb3ZlQmFzZSwgRUlQMjBJbnRlcmZhY2UgewoJdWludDI1NiBjb25zdGFudCBwcml2YXRlIE1BWF9VSU5UMjU2ID0gMioqMjU2IC0gMTsKCW1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGZsb3dlckFsbG93ZWQ7CgoJYnl0ZXM0IGNvbnN0YW50IEVJUDIwSW50ZXJmYWNlU2lnbmF0dXJlID0gYnl0ZXM0KDB4OTg0NzQxMDkpOwoJCS8vIGJ5dGVzNChrZWNjYWsyNTYoImJhbGFuY2VPZkZsb3dlcihhZGRyZXNzKSIpKSBeCgkJLy8gYnl0ZXM0KGtlY2NhazI1NigiYXBwcm92ZUZsb3dlcihhZGRyZXNzLHVpbnQyNTYpIikpIF4KCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2ZlckZsb3dlcihhZGRyZXNzLHVpbnQyNTYpIikpIF4KCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2ZlckZyb21GbG93ZXIoYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpIikpOwoKCWZ1bmN0aW9uIHN1cHBvcnRzRUlQMjBJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJcmV0dXJuIF9pbnRlcmZhY2VJRCA9PSBFSVAyMEludGVyZmFjZVNpZ25hdHVyZTsKCX0KCglmdW5jdGlvbiBfdHJhbnNmZXJGbG93ZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewoJCQlyZXF1aXJlKGZsb3dlckJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwoJCQlmbG93ZXJCYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwoJCX0KCQlmbG93ZXJCYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKCQlUcmFuc2ZlckZsb3dlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRmxvd2VyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXJlcXVpcmUoZmxvd2VyQmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKCQlmbG93ZXJCYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkJZmxvd2VyQmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CgkJVHJhbnNmZXJGbG93ZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbUZsb3dlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQl1aW50MjU2IGFsbG93YW5jZSA9IGZsb3dlckFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoJCXJlcXVpcmUoZmxvd2VyQmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2FuY2UgPj0gX3ZhbHVlKTsKCQlmbG93ZXJCYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKCQlmbG93ZXJCYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwoJCWlmIChhbGxvd2FuY2UgPCBNQVhfVUlOVDI1NikgewoJCQlmbG93ZXJBbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkJfQoJCVRyYW5zZmVyRmxvd2VyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJZnVuY3Rpb24gYmFsYW5jZU9mRmxvd2VyKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKCQlyZXR1cm4gZmxvd2VyQmFsYW5jZXNbX293bmVyXTsKCX0KCglmdW5jdGlvbiBhcHByb3ZlRmxvd2VyKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJZmxvd2VyQWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgkJQXBwcm92YWxGbG93ZXIobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJZnVuY3Rpb24gYWxsb3dhbmNlRmxvd2VyKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewoJCXJldHVybiBmbG93ZXJBbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwoJfQoKCWZ1bmN0aW9uIF9hZGRGbG93ZXIodWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCB7CgkJZmxvd2VyLmN1cnJlbnQgKz0gX2Ftb3VudDsKCQlmbG93ZXJUb3RhbFN1cHBseSArPSBfYW1vdW50OwoJfQp9Cgpjb250cmFjdCBUcnVlbG92ZU5leHRTYWxlIGlzIFRydWVsb3ZlT3duZXJzaGlwLCBUcnVlbG92ZUZsb3dlck93bmVyc2hpcCB7Cgl1aW50MjU2IGNvbnN0YW50IFJFTUFJTklOR19BTU9VTlQgPSA1MDAwMDsgLy8gTUFSSzogTW9kaWZ5IGl0CgoJZnVuY3Rpb24gVHJ1ZWxvdmVOZXh0U2FsZSgpIGludGVybmFsIHsKCQlfZ2l2ZVJlbWFpbmluZ0Zsb3dlcigpOwoJfQoKCWZ1bmN0aW9uIG9wZW5OZXh0U2FsZSh1aW50MjU2IF9kaWFtb25kMVByaWNlLCBieXRlczI0IF9kaWFtb25kMk1vZGVsLCB1aW50MjU2IF9kaWFtb25kMlByaWNlLCBieXRlczI0IF9mbG93ZXJNb2RlbCwgdWludDI1NiBfZmxvd2VyUHJpY2UpCgkJZXh0ZXJuYWwgb25seUNPTwoJCXsKCQlyZXF1aXJlKG5vdyA+PSBuZXh0U2FsZVRpbWUpOwoKCQlfc2V0VmFycygpOwoJCWRpYW1vbmQxLnByaWNlID0gX2RpYW1vbmQxUHJpY2U7CgkJX29wZW5TYWxlRGlhbW9uZDIoX2RpYW1vbmQyTW9kZWwsIF9kaWFtb25kMlByaWNlKTsKCQlfb3BlblNhbGVGbG93ZXIoX2Zsb3dlck1vZGVsLCBfZmxvd2VyUHJpY2UpOwoJCV9naXZlUmVtYWluaW5nRmxvd2VyKCk7Cgl9CgoJZnVuY3Rpb24gX29wZW5TYWxlRGlhbW9uZDIoYnl0ZXMyNCBfZGlhbW9uZDJNb2RlbCwgdWludDI1NiBfZGlhbW9uZDJQcmljZSkgcHJpdmF0ZSB7CgkJZGlhbW9uZDIubW9kZWwgPSBfZGlhbW9uZDJNb2RlbDsKCQlkaWFtb25kMi5jdXJyZW50ID0gMDsKCQlkaWFtb25kMi55ZWFyKys7CgkJZGlhbW9uZDIucHJpY2UgPSBfZGlhbW9uZDJQcmljZTsKCX0KCglmdW5jdGlvbiBfb3BlblNhbGVGbG93ZXIoYnl0ZXMyNCBfZmxvd2VyTW9kZWwsIHVpbnQyNTYgX2Zsb3dlclByaWNlKSBwcml2YXRlIHsKCQlmbG93ZXIubW9kZWwgPSBfZmxvd2VyTW9kZWw7CgkJZmxvd2VyLmN1cnJlbnQgPSAwOwoJCWZsb3dlci55ZWFyKys7CgkJZmxvd2VyLnByaWNlID0gX2Zsb3dlclByaWNlOwoJCWZsb3dlci50b3RhbCA9IDEwMDAwMDA7IC8vIE1BUks6IE1vZGlmeSBpdAoJfQoKCWZ1bmN0aW9uIF9naXZlUmVtYWluaW5nRmxvd2VyKCkgaW50ZXJuYWwgewoJCV90cmFuc2ZlckZsb3dlcigwLCBtc2cuc2VuZGVyLCBSRU1BSU5JTkdfQU1PVU5UKTsKCQlfYWRkRmxvd2VyKFJFTUFJTklOR19BTU9VTlQpOwoJfQp9Cgpjb250cmFjdCBUcnVlbG92ZVJlZ2lzdHJhdGlvbiBpcyBUcnVlbG92ZU5leHRTYWxlIHsKCW1hcHBpbmcgKGFkZHJlc3MgPT4gUmVnaXN0cmF0aW9uUmlnaHQpIHB1YmxpYyByZWdpc3RyYXRpb25SaWdodHM7CgltYXBwaW5nIChieXRlczMyID0+IFJlZ2lzdHJhdGlvbikgcHVibGljIHJlZ2lzdHJhdGlvbnM7CgoJc3RydWN0IFJlZ2lzdHJhdGlvblJpZ2h0IHsKCQlib29sIGFibGU7CgkJYm9vbCB1c2VkOwoJfQoKCXN0cnVjdCBSZWdpc3RyYXRpb24gewoJCWJvb2wgc2lnbmVkOwoJCXN0cmluZyBzZWNyZXQ7IC8vIGluY2x1ZGluZyBib3RoIG5hbWVzCgkJc3RyaW5nIHRvcFNlY3JldDsgLy8gaW5jbHVkaW5nIFNTTiBhbmQgYmlydGhkYXRlCgl9CgoJZnVuY3Rpb24gZ2l2ZVJlZ2lzdHJhdGlvbihhZGRyZXNzIF9hZGRyKSBleHRlcm5hbCBvbmx5Q09PIHsKCQlpZiAocmVnaXN0cmF0aW9uUmlnaHRzW19hZGRyXS5hYmxlID09IGZhbHNlKSB7CgkJCXJlZ2lzdHJhdGlvblJpZ2h0c1tfYWRkcl0uYWJsZSA9IHRydWU7CgkJfSBlbHNlIHsKCQkJcmV2ZXJ0KCk7CgkJfQoJfQoKCWZ1bmN0aW9uIGJ1eVJlZ2lzdHJhdGlvbigpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZShyZWdpc3RlclByaWNlIDw9IG1zZy52YWx1ZSk7CgkJaWYgKHJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID09IGZhbHNlKSB7CgkJCXJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID0gdHJ1ZTsKCQl9IGVsc2UgewoJCQlyZXZlcnQoKTsKCQl9Cgl9CgoJZnVuY3Rpb24gX2dpdmVTZW5kZXJSZWdpc3RyYXRpb24oKSBpbnRlcm5hbCB7CgkJaWYgKHJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID09IGZhbHNlKSB7CgkJCXJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID0gdHJ1ZTsKCQl9Cgl9CgoJZnVuY3Rpb24gZ2V0UmVnaXN0cmF0aW9uUmlnaHQoYWRkcmVzcyBfYWRkcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sIGFibGUsIGJvb2wgdXNlZCkgewoJCWFibGUgPSByZWdpc3RyYXRpb25SaWdodHNbX2FkZHJdLmFibGU7CgkJdXNlZCA9IHJlZ2lzdHJhdGlvblJpZ2h0c1tfYWRkcl0udXNlZDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpc3RyYXRpb24oYnl0ZXMzMiBfdW5pcXVlKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgc2lnbmVkLCBzdHJpbmcgc2VjcmV0LCBzdHJpbmcgdG9wU2VjcmV0KSB7CgkJc2lnbmVkID0gcmVnaXN0cmF0aW9uc1tfdW5pcXVlXS5zaWduZWQ7CgkJc2VjcmV0ID0gcmVnaXN0cmF0aW9uc1tfdW5pcXVlXS5zZWNyZXQ7CgkJdG9wU2VjcmV0ID0gcmVnaXN0cmF0aW9uc1tfdW5pcXVlXS50b3BTZWNyZXQ7Cgl9CgoJZnVuY3Rpb24gc2lnblRydWVsb3ZlKGJ5dGVzMzIgX3JlZ2lzdGVySUQsIHN0cmluZyBfc2VjcmV0LCBzdHJpbmcgX3RvcFNlY3JldCkgcHVibGljIHsKCQlyZXF1aXJlKHJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID09IHRydWUpOwoJCXJlcXVpcmUocmVnaXN0cmF0aW9uUmlnaHRzW21zZy5zZW5kZXJdLnVzZWQgPT0gZmFsc2UpOwoJCXJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS51c2VkID0gdHJ1ZTsKCQlfc2lnblRydWVsb3ZlKF9yZWdpc3RlcklELCBfc2VjcmV0LCBfdG9wU2VjcmV0KTsKCX0KCglmdW5jdGlvbiBzaWduVHJ1ZWxvdmVCeUNPTyhieXRlczMyIF9yZWdpc3RlcklELCBzdHJpbmcgX3NlY3JldCwgc3RyaW5nIF90b3BTZWNyZXQpIGV4dGVybmFsIG9ubHlDT08gewoJCV9zaWduVHJ1ZWxvdmUoX3JlZ2lzdGVySUQsIF9zZWNyZXQsIF90b3BTZWNyZXQpOwoJfQoKCWZ1bmN0aW9uIF9zaWduVHJ1ZWxvdmUoYnl0ZXMzMiBfcmVnaXN0ZXJJRCwgc3RyaW5nIF9zZWNyZXQsIHN0cmluZyBfdG9wU2VjcmV0KSBpbnRlcm5hbCB7CgkJcmVxdWlyZShyZWdpc3RyYXRpb25zW19yZWdpc3RlcklEXS5zaWduZWQgPT0gZmFsc2UpOwoKCQlyZWdpc3RyYXRpb25zW19yZWdpc3RlcklEXS5zaWduZWQgPSB0cnVlOwoJCXJlZ2lzdHJhdGlvbnNbX3JlZ2lzdGVySURdLnNlY3JldCA9IF9zZWNyZXQ7CgkJcmVnaXN0cmF0aW9uc1tfcmVnaXN0ZXJJRF0udG9wU2VjcmV0ID0gX3RvcFNlY3JldDsKCX0KfQoKY29udHJhY3QgVHJ1ZWxvdmVTaG9wIGlzIFRydWVsb3ZlUmVnaXN0cmF0aW9uIHsKCWZ1bmN0aW9uIGJ1eURpYW1vbmQodWludCBfaW5kZXgpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCByZXR1cm5zKHVpbnQyNTYpIHsKCQlyZXF1aXJlKF9pbmRleCA9PSAxIHx8IF9pbmRleCA9PSAyIHx8IF9pbmRleCA9PSAzKTsKCQlNb2RlbCBzdG9yYWdlIG1vZGVsID0gX2dldE1vZGVsKF9pbmRleCk7CgoJCXJlcXVpcmUobW9kZWwuY3VycmVudCA8IG1vZGVsLnRvdGFsKTsKCQlyZXF1aXJlKG1vZGVsLnByaWNlIDw9IG1zZy52YWx1ZSk7CgkJX2dpdmVTZW5kZXJSZWdpc3RyYXRpb24oKTsKCgkJdWludDI1NiBuZXdEaWFtb25kSWQgPSBkaWFtb25kcy5wdXNoKERpYW1vbmQoe21vZGVsOiBtb2RlbC5tb2RlbCwgeWVhcjogbW9kZWwueWVhciwgbm86IHVpbnQxNihtb2RlbC5jdXJyZW50ICsgMSksIGFjdGl2YXRlQXQ6IDB9KSkgLSAxOwoJCV90cmFuc2ZlcigwLCBtc2cuc2VuZGVyLCBuZXdEaWFtb25kSWQpOwoJCQoJCW1vZGVsLmN1cnJlbnQrKzsKCQlyZXR1cm4gbmV3RGlhbW9uZElkOwoJfQoKCWZ1bmN0aW9uIGJ1eUZsb3dlcih1aW50IF9hbW91bnQpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZShmbG93ZXIuY3VycmVudCArIF9hbW91bnQgPCBmbG93ZXIudG90YWwpOwoJCXVpbnQyNTYgcHJpY2UgPSBjdXJyZW50Rmxvd2VyUHJpY2UoKTsKCQlyZXF1aXJlKHByaWNlICogX2Ftb3VudCA8PSBtc2cudmFsdWUpOwoJCV9naXZlU2VuZGVyUmVnaXN0cmF0aW9uKCk7CgoJCV90cmFuc2ZlckZsb3dlcigwLCBtc2cuc2VuZGVyLCBfYW1vdW50KTsKCQlfYWRkRmxvd2VyKF9hbW91bnQpOwoJfQoKCWZ1bmN0aW9uIGN1cnJlbnRGbG93ZXJQcmljZSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewoJCWlmIChmbG93ZXIuY3VycmVudCA8IDEwMDAwMCArIFJFTUFJTklOR19BTU9VTlQpIHsgLy8gTUFSSzogTW9kaWZ5IGl0CgkJCXJldHVybiBmbG93ZXIucHJpY2U7CgkJfSBlbHNlIGlmIChmbG93ZXIuY3VycmVudCA8IDMwMDAwMCArIFJFTUFJTklOR19BTU9VTlQpIHsgLy8gTUFSSzogTW9kaWZ5IGl0CgkJCXJldHVybiBmbG93ZXIucHJpY2UgKiA0OwoJCX0gZWxzZSB7CgkJCXJldHVybiBmbG93ZXIucHJpY2UgKiAxMDsKCQl9Cgl9Cn0KY29udHJhY3QgVHJ1ZWxvdmVEZWxpdmVyeSBpcyBUcnVlbG92ZVNob3AgewoJZW51bSBHaWZ0VHlwZSB7IERpYW1vbmQsIEZsb3dlciB9CgoJZXZlbnQgR2lmdFNlbmQodWludCBpbmRleGVkIGluZGV4LCBhZGRyZXNzIGluZGV4ZWQgcmVjZWl2ZXIsIGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBieXRlczMyIHJlZ2lzdGVySUQsIHN0cmluZyBsZXR0ZXIsIGJ5dGVzMTYgZGF0ZSwKCQlHaWZ0VHlwZSBndHlwZSwKCQlieXRlczI0IG1vZGVsLAoJCXVpbnQxNiB5ZWFyLAoJCXVpbnQxNiBubywKCQl1aW50IGFtb3VudAoJCSk7CgoJdWludCBwdWJsaWMgZ2lmdFNlbmRJbmRleCA9IDE7CgkKCW1vZGlmaWVyIHNlbmRDaGVjayhieXRlczMyIF9yZWdpc3RlcklEKSB7CiAgICByZXF1aXJlKHNlbmRHaWZ0UHJpY2UgPD0gbXNnLnZhbHVlKTsKCQlyZXF1aXJlKHJlZ2lzdHJhdGlvbnNbX3JlZ2lzdGVySURdLnNpZ25lZCk7CiAgICBfOwogIH0KCglmdW5jdGlvbiBzaWduU2VuZERpYW1vbmQoYnl0ZXMzMiBfcmVnaXN0ZXJJRCwgc3RyaW5nIF9zZWNyZXQsIHN0cmluZyBfdG9wU2VjcmV0LCBhZGRyZXNzIF90cnVlbG92ZSwgc3RyaW5nIF9sZXR0ZXIsIGJ5dGVzMTYgX2RhdGUsIHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsIHBheWFibGUgewoJCXNpZ25UcnVlbG92ZShfcmVnaXN0ZXJJRCwgX3NlY3JldCwgX3RvcFNlY3JldCk7CgkJc2VuZERpYW1vbmQoX3RydWVsb3ZlLCBfcmVnaXN0ZXJJRCwgX2xldHRlciwgX2RhdGUsIF90b2tlbklkKTsKCX0KCglmdW5jdGlvbiBzZW5kRGlhbW9uZChhZGRyZXNzIF90cnVlbG92ZSwgYnl0ZXMzMiBfcmVnaXN0ZXJJRCwgc3RyaW5nIF9sZXR0ZXIsIGJ5dGVzMTYgX2RhdGUsIHVpbnQgX3Rva2VuSWQpIHB1YmxpYyBwYXlhYmxlIHNlbmRDaGVjayhfcmVnaXN0ZXJJRCkgewoJCXJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCQlyZXF1aXJlKG5vdyA+IGRpYW1vbmRzW190b2tlbklkXS5hY3RpdmF0ZUF0KTsKCQkKCQlfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RydWVsb3ZlLCBfdG9rZW5JZCk7CgkJCgkJZGlhbW9uZHNbX3Rva2VuSWRdLmFjdGl2YXRlQXQgPSBub3cgKyAzIGRheXM7CgoJCUdpZnRTZW5kKGdpZnRTZW5kSW5kZXgsIF90cnVlbG92ZSwgbXNnLnNlbmRlciwgX3JlZ2lzdGVySUQsIF9sZXR0ZXIsIF9kYXRlLAoJCQlHaWZ0VHlwZS5EaWFtb25kLAoJCQlkaWFtb25kc1tfdG9rZW5JZF0ubW9kZWwsCgkJCWRpYW1vbmRzW190b2tlbklkXS55ZWFyLAoJCQlkaWFtb25kc1tfdG9rZW5JZF0ubm8sCgkJCTEKCQkJKTsKCQlnaWZ0U2VuZEluZGV4Kys7Cgl9CgoJZnVuY3Rpb24gc2lnblNlbmRGbG93ZXIoYnl0ZXMzMiBfcmVnaXN0ZXJJRCwgc3RyaW5nIF9zZWNyZXQsIHN0cmluZyBfdG9wU2VjcmV0LCBhZGRyZXNzIF90cnVlbG92ZSwgc3RyaW5nIF9sZXR0ZXIsIGJ5dGVzMTYgX2RhdGUsIHVpbnQgX2Ftb3VudCkgZXh0ZXJuYWwgcGF5YWJsZSB7CgkJc2lnblRydWVsb3ZlKF9yZWdpc3RlcklELCBfc2VjcmV0LCBfdG9wU2VjcmV0KTsKCQlzZW5kRmxvd2VyKF90cnVlbG92ZSwgX3JlZ2lzdGVySUQsIF9sZXR0ZXIsIF9kYXRlLCBfYW1vdW50KTsKCX0KCglmdW5jdGlvbiBzZW5kRmxvd2VyKGFkZHJlc3MgX3RydWVsb3ZlLCBieXRlczMyIF9yZWdpc3RlcklELCBzdHJpbmcgX2xldHRlciwgYnl0ZXMxNiBfZGF0ZSwgdWludCBfYW1vdW50KSBwdWJsaWMgcGF5YWJsZSBzZW5kQ2hlY2soX3JlZ2lzdGVySUQpIHsKCQlyZXF1aXJlKGZsb3dlckJhbGFuY2VzW21zZy5zZW5kZXJdID49IF9hbW91bnQpOwoKCQlmbG93ZXJCYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwoJCWZsb3dlckJhbGFuY2VzW190cnVlbG92ZV0gKz0gKF9hbW91bnQgKiA5IC8gMTApOwoKCQlHaWZ0U2VuZChnaWZ0U2VuZEluZGV4LCBfdHJ1ZWxvdmUsIG1zZy5zZW5kZXIsIF9yZWdpc3RlcklELCBfbGV0dGVyLCBfZGF0ZSwKCQkJR2lmdFR5cGUuRmxvd2VyLAoJCQlmbG93ZXIubW9kZWwsCgkJCWZsb3dlci55ZWFyLAoJCQkwLAoJCQlfYW1vdW50CgkJCSk7CgkJZ2lmdFNlbmRJbmRleCsrOwoJfQp9Cgpjb250cmFjdCBUcnVlbG92ZUF1Y3Rpb24gaXMgVHJ1ZWxvdmVEZWxpdmVyeSB7CglmdW5jdGlvbiBzZXREaWFtb25kQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CgkJRGlhbW9uZEF1Y3Rpb24gY2FuZGlkYXRlQ29udHJhY3QgPSBEaWFtb25kQXVjdGlvbihfYWRkcmVzcyk7CgoJCS8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKCQlyZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzRGlhbW9uZEF1Y3Rpb24oKSk7CgkJZGlhbW9uZEF1Y3Rpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKCX0KCglmdW5jdGlvbiBjcmVhdGVEaWFtb25kQXVjdGlvbigKCQl1aW50MjU2IF90b2tlbklkLAoJCXVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCgkJdWludDI1NiBfZW5kaW5nUHJpY2UsCgkJdWludDI1NiBfZHVyYXRpb24KCSkKCQlleHRlcm5hbAoJCXdoZW5Ob3RQYXVzZWQKCXsKCQlyZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgkJLy8gcmVxdWlyZSghaXNQcmVnbmFudChfdG9rZW5JZCkpOwoJCV9hcHByb3ZlKF90b2tlbklkLCBkaWFtb25kQXVjdGlvbik7CgkJZGlhbW9uZEF1Y3Rpb24uY3JlYXRlQXVjdGlvbigKCQkJX3Rva2VuSWQsCgkJCV9zdGFydGluZ1ByaWNlLAoJCQlfZW5kaW5nUHJpY2UsCgkJCV9kdXJhdGlvbiwKCQkJbXNnLnNlbmRlcgoJCSk7Cgl9CgoJZnVuY3Rpb24gc2V0Rmxvd2VyQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CgkJRmxvd2VyQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IEZsb3dlckF1Y3Rpb24oX2FkZHJlc3MpOwoKCQkvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CgkJcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0Zsb3dlckF1Y3Rpb24oKSk7CgkJZmxvd2VyQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwoJfQoKCWZ1bmN0aW9uIGNyZWF0ZUZsb3dlckF1Y3Rpb24oCgkJdWludDI1NiBfYW1vdW50LAoJCXVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCgkJdWludDI1NiBfZW5kaW5nUHJpY2UsCgkJdWludDI1NiBfZHVyYXRpb24KCSkKCQlleHRlcm5hbAoJCXdoZW5Ob3RQYXVzZWQKCXsKCQlhcHByb3ZlRmxvd2VyKGZsb3dlckF1Y3Rpb24sIF9hbW91bnQpOwoJCWZsb3dlckF1Y3Rpb24uY3JlYXRlQXVjdGlvbigKCQkJX2Ftb3VudCwKCQkJX3N0YXJ0aW5nUHJpY2UsCgkJCV9lbmRpbmdQcmljZSwKCQkJX2R1cmF0aW9uLAoJCQltc2cuc2VuZGVyCgkJKTsKCX0KCglmdW5jdGlvbiB3aXRoZHJhd0F1Y3Rpb25CYWxhbmNlcygpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewoJCWRpYW1vbmRBdWN0aW9uLndpdGhkcmF3QmFsYW5jZSgpOwoJCWZsb3dlckF1Y3Rpb24ud2l0aGRyYXdCYWxhbmNlKCk7Cgl9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlQ29yZSBpcyBUcnVlbG92ZUF1Y3Rpb24gewoJYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKCWV2ZW50IEFwcHJvdmFsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5JZCk7CgoJZXZlbnQgVHJhbnNmZXJGbG93ZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKTsgCglldmVudCBBcHByb3ZhbEZsb3dlcihhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwoKCWV2ZW50IEdpZnRTZW5kKHVpbnQgaW5kZXhlZCBpbmRleCwgYWRkcmVzcyBpbmRleGVkIHJlY2VpdmVyLCBhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYnl0ZXMzMiByZWdpc3RlcklELCBzdHJpbmcgbGV0dGVyLCBieXRlczE2IGRhdGUsCgkJR2lmdFR5cGUgZ3R5cGUsCgkJYnl0ZXMyNCBtb2RlbCwKCQl1aW50MTYgeWVhciwKCQl1aW50MTYgbm8sCgkJdWludCBhbW91bnQKCQkpOwoJCQoJZnVuY3Rpb24gVHJ1ZWxvdmVDb3JlKCkgcHVibGljIHsKCQljZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCQljb29BZGRyZXNzID0gbXNnLnNlbmRlcjsKCX0KCglmdW5jdGlvbiBzZXROZXdBZGRyZXNzKGFkZHJlc3MgX3YyQWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgIG5ld0NvbnRyYWN0QWRkcmVzcyA9IF92MkFkZHJlc3M7CiAgICBDb250cmFjdFVwZ3JhZGUoX3YyQWRkcmVzcyk7CiAgfQoKICBmdW5jdGlvbigpIGV4dGVybmFsIHBheWFibGUgewogICAgcmVxdWlyZSgKICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKGRpYW1vbmRBdWN0aW9uKSB8fAogICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3MoZmxvd2VyQXVjdGlvbikKICAgICk7CiAgfQoJZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCBvbmx5Q0ZPIHsKCQljZm9BZGRyZXNzLnRyYW5zZmVyKGFtb3VudCk7Cgl9Cn0KCmNvbnRyYWN0IENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvbiBhbiBORlQKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICAvLyBDdXJyZW50IG93bmVyIG9mIE5GVAogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBlbmRpbmdQcmljZTsKICAgICAgICAvLyBEdXJhdGlvbiAoaW4gc2Vjb25kcykgb2YgYXVjdGlvbgogICAgICAgIHVpbnQ2NCBkdXJhdGlvbjsKICAgICAgICAvLyBUaW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAgICAgLy8gTk9URTogMCBpZiB0aGlzIGF1Y3Rpb24gaGFzIGJlZW4gY29uY2x1ZGVkCiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKICAgIH0KCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgTkZUIG93bmVyc2hpcAogICAgRVJDNzIxIHB1YmxpYyBub25GdW5naWJsZUNvbnRyYWN0OwoKICAgIC8vIEN1dCBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG1lYXN1cmVkIGluIGJhc2lzIHBvaW50cyAoMS8xMDAgb2YgYSBwZXJjZW50KS4KICAgIC8vIFZhbHVlcyAwLTEwLDAwMCBtYXAgdG8gMCUtMTAwJQogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CgogICAgLy8gTWFwIGZyb20gdG9rZW4gSUQgdG8gdGhlaXIgY29ycmVzcG9uZGluZyBhdWN0aW9uLgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSB0b2tlbklkVG9BdWN0aW9uOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24pOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiBpbmRleGVkIHRva2VuSWQsIHVpbnQyNTYgdG90YWxQcmljZSwgYWRkcmVzcyB3aW5uZXIpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGxlZCh1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBjbGFpbWFudCBvd25zIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IC0gQWRkcmVzcyBjbGFpbWluZyB0byBvd24gdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIG93bmVyc2hpcCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRXNjcm93cyB0aGUgTkZULCBhc3NpZ25pbmcgb3duZXJzaGlwIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gVGhyb3dzIGlmIHRoZSBlc2Nyb3cgZmFpbHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciAtIEN1cnJlbnQgb3duZXIgYWRkcmVzcyBvZiB0b2tlbiB0byBlc2Nyb3cuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2UgYXBwcm92YWwgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyRnJvbShfb3duZXIsIHRoaXMsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYW4gTkZUIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgc3VjY2VlZHMuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlciAtIEFkZHJlc3MgdG8gdHJhbnNmZXIgTkZUIHRvLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAvLy8gIEF1Y3Rpb25DcmVhdGVkIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHB1dCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICBfYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmR1cmF0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHVuY29uZGl0aW9uYWxseS4KICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3NlbGxlcikgaW50ZXJuYWwgewogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKICAgICAgICBfdHJhbnNmZXIoX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBwcmljZSBhbmQgdHJhbnNmZXJzIHdpbm5pbmdzLgogICAgLy8vIERvZXMgTk9UIHRyYW5zZmVyIG93bmVyc2hpcCBvZiB0b2tlbi4KICAgIGZ1bmN0aW9uIF9iaWQodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfYmlkQW1vdW50KQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIGF1Y3Rpb24gc3RydWN0CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKCiAgICAgICAgLy8gRXhwbGljaXRseSBjaGVjayB0aGF0IHRoaXMgYXVjdGlvbiBpcyBjdXJyZW50bHkgbGl2ZS4KICAgICAgICAvLyAoQmVjYXVzZSBvZiBob3cgRXRoZXJldW0gbWFwcGluZ3Mgd29yaywgd2UgY2FuJ3QganVzdCBjb3VudAogICAgICAgIC8vIG9uIHRoZSBsb29rdXAgYWJvdmUgZmFpbGluZy4gQW4gaW52YWxpZCBfdG9rZW5JZCB3aWxsIGp1c3QKICAgICAgICAvLyByZXR1cm4gYW4gYXVjdGlvbiBvYmplY3QgdGhhdCBpcyBhbGwgemVyb3MuKQogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgYmlkIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgY3VycmVudCBwcmljZQogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgICAgIHJlcXVpcmUoX2JpZEFtb3VudCA+PSBwcmljZSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHNlbGxlciBiZWZvcmUgdGhlIGF1Y3Rpb24gc3RydWN0CiAgICAgICAgLy8gZ2V0cyBkZWxldGVkLgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CgogICAgICAgIC8vIFRoZSBiaWQgaXMgZ29vZCEgUmVtb3ZlIHRoZSBhdWN0aW9uIGJlZm9yZSBzZW5kaW5nIHRoZSBmZWVzCiAgICAgICAgLy8gdG8gdGhlIHNlbmRlciBzbyB3ZSBjYW4ndCBoYXZlIGEgcmVlbnRyYW5jeSBhdHRhY2suCiAgICAgICAgX3JlbW92ZUF1Y3Rpb24oX3Rva2VuSWQpOwoKICAgICAgICAvLyBUcmFuc2ZlciBwcm9jZWVkcyB0byBzZWxsZXIgKGlmIHRoZXJlIGFyZSBhbnkhKQogICAgICAgIGlmIChwcmljZSA+IDApIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhdWN0aW9uZWVyJ3MgY3V0LgogICAgICAgICAgICAvLyAoTk9URTogX2NvbXB1dGVDdXQoKSBpcyBndWFyYW50ZWVkIHRvIHJldHVybiBhCiAgICAgICAgICAgIC8vIHZhbHVlIDw9IHByaWNlLCBzbyB0aGlzIHN1YnRyYWN0aW9uIGNhbid0IGdvIG5lZ2F0aXZlLikKICAgICAgICAgICAgdWludDI1NiBhdWN0aW9uZWVyQ3V0ID0gX2NvbXB1dGVDdXQocHJpY2UpOwogICAgICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gcHJpY2UgLSBhdWN0aW9uZWVyQ3V0OwoKICAgICAgICAgICAgLy8gTk9URTogRG9pbmcgYSB0cmFuc2ZlcigpIGluIHRoZSBtaWRkbGUgb2YgYSBjb21wbGV4CiAgICAgICAgICAgIC8vIG1ldGhvZCBsaWtlIHRoaXMgaXMgZ2VuZXJhbGx5IGRpc2NvdXJhZ2VkIGJlY2F1c2Ugb2YKICAgICAgICAgICAgLy8gcmVlbnRyYW5jeSBhdHRhY2tzIGFuZCBEb1MgYXR0YWNrcyBpZiB0aGUgc2VsbGVyIGlzCiAgICAgICAgICAgIC8vIGEgY29udHJhY3Qgd2l0aCBhbiBpbnZhbGlkIGZhbGxiYWNrIGZ1bmN0aW9uLiBXZSBleHBsaWNpdGx5CiAgICAgICAgICAgIC8vIGd1YXJkIGFnYWluc3QgcmVlbnRyYW5jeSBhdHRhY2tzIGJ5IHJlbW92aW5nIHRoZSBhdWN0aW9uCiAgICAgICAgICAgIC8vIGJlZm9yZSBjYWxsaW5nIHRyYW5zZmVyKCksIGFuZCB0aGUgb25seSB0aGluZyB0aGUgc2VsbGVyCiAgICAgICAgICAgIC8vIGNhbiBEb1MgaXMgdGhlIHNhbGUgb2YgdGhlaXIgb3duIGFzc2V0ISAoQW5kIGlmIGl0J3MgYW4KICAgICAgICAgICAgLy8gYWNjaWRlbnQsIHRoZXkgY2FuIGNhbGwgY2FuY2VsQXVjdGlvbigpLiApCiAgICAgICAgICAgIHNlbGxlci50cmFuc2ZlcihzZWxsZXJQcm9jZWVkcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxjdWxhdGUgYW55IGV4Y2VzcyBmdW5kcyBpbmNsdWRlZCB3aXRoIHRoZSBiaWQuIElmIHRoZSBleGNlc3MKICAgICAgICAvLyBpcyBhbnl0aGluZyB3b3J0aCB3b3JyeWluZyBhYm91dCwgdHJhbnNmZXIgaXQgYmFjayB0byBiaWRkZXIuCiAgICAgICAgLy8gTk9URTogV2UgY2hlY2tlZCBhYm92ZSB0aGF0IHRoZSBiaWQgYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiBvcgogICAgICAgIC8vIGVxdWFsIHRvIHRoZSBwcmljZSBzbyB0aGlzIGNhbm5vdCB1bmRlcmZsb3cuCiAgICAgICAgdWludDI1NiBiaWRFeGNlc3MgPSBfYmlkQW1vdW50IC0gcHJpY2U7CgogICAgICAgIC8vIFJldHVybiB0aGUgZnVuZHMuIFNpbWlsYXIgdG8gdGhlIHByZXZpb3VzIHRyYW5zZmVyLCB0aGlzIGlzCiAgICAgICAgLy8gbm90IHN1c2NlcHRpYmxlIHRvIGEgcmUtZW50cnkgYXR0YWNrIGJlY2F1c2UgdGhlIGF1Y3Rpb24gaXMKICAgICAgICAvLyByZW1vdmVkIGJlZm9yZSBhbnkgdHJhbnNmZXJzIG9jY3VyLgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKCiAgICAgICAgLy8gVGVsbCB0aGUgd29ybGQhCiAgICAgICAgQXVjdGlvblN1Y2Nlc3NmdWwoX3Rva2VuSWQsIHByaWNlLCBtc2cuc2VuZGVyKTsKCiAgICAgICAgcmV0dXJuIHByaWNlOwogICAgfQoKICAgIC8vLyBAZGV2IFJlbW92ZXMgYW4gYXVjdGlvbiBmcm9tIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgTkZUIG9uIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBfcmVtb3ZlQXVjdGlvbih1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgTkZUIGlzIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hdWN0aW9uIC0gQXVjdGlvbiB0byBjaGVjay4KICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBjdXJyZW50IHByaWNlIG9mIGFuIE5GVCBvbiBhdWN0aW9uLiBCcm9rZW4gaW50byB0d28KICAgIC8vLyAgZnVuY3Rpb25zICh0aGlzIG9uZSwgdGhhdCBjb21wdXRlcyB0aGUgZHVyYXRpb24gZnJvbSB0aGUgYXVjdGlvbgogICAgLy8vICBzdHJ1Y3R1cmUsIGFuZCB0aGUgb3RoZXIgdGhhdCBkb2VzIHRoZSBwcmljZSBjb21wdXRhdGlvbikgc28gd2UKICAgIC8vLyAgY2FuIGVhc2lseSB0ZXN0IHRoYXQgdGhlIHByaWNlIGNvbXB1dGF0aW9uIHdvcmtzIGNvcnJlY3RseS4KICAgIGZ1bmN0aW9uIF9jdXJyZW50UHJpY2UoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgdWludDI1NiBzZWNvbmRzUGFzc2VkID0gMDsKCiAgICAgICAgLy8gQSBiaXQgb2YgaW5zdXJhbmNlIGFnYWluc3QgbmVnYXRpdmUgdmFsdWVzIChvciB3cmFwYXJvdW5kKS4KICAgICAgICAvLyBQcm9iYWJseSBub3QgbmVjZXNzYXJ5IChzaW5jZSBFdGhlcmV1bSBndWFybmF0ZWVzIHRoYXQgdGhlCiAgICAgICAgLy8gbm93IHZhcmlhYmxlIGRvZXNuJ3QgZXZlciBnbyBiYWNrd2FyZHMpLgogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICAgICAgX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBzZWNvbmRzUGFzc2VkCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLiBGYWN0b3JlZCBvdXQKICAgIC8vLyAgZnJvbSBfY3VycmVudFByaWNlIHNvIHdlIGNhbiBydW4gZXh0ZW5zaXZlIHVuaXQgdGVzdHMuCiAgICAvLy8gIFdoZW4gdGVzdGluZywgbWFrZSB0aGlzIGZ1bmN0aW9uIHB1YmxpYyBhbmQgdHVybiBvbgogICAgLy8vICBgQ3VycmVudCBwcmljZSBjb21wdXRhdGlvbmAgdGVzdCBzdWl0ZS4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBfc2Vjb25kc1Bhc3NlZAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBwdWJsaWMgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICB0aW1lIChhdCA2NC1iaXRzKSBhbmQgY3VycmVuY3kgKGF0IDEyOC1iaXRzKS4gX2R1cmF0aW9uIGlzCiAgICAgICAgLy8gIGFsc28ga25vd24gdG8gYmUgbm9uLXplcm8gKHNlZSB0aGUgcmVxdWlyZSgpIHN0YXRlbWVudCBpbgogICAgICAgIC8vICBfYWRkQXVjdGlvbigpKQogICAgICAgIGlmIChfc2Vjb25kc1Bhc3NlZCA+PSBfZHVyYXRpb24pIHsKICAgICAgICAgICAgLy8gV2UndmUgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcG9ydGlvbgogICAgICAgICAgICAvLyBvZiB0aGUgYXVjdGlvbiwganVzdCByZXR1cm4gdGhlIGVuZCBwcmljZS4KICAgICAgICAgICAgcmV0dXJuIF9lbmRpbmdQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTdGFydGluZyBwcmljZSBjYW4gYmUgaGlnaGVyIHRoYW4gZW5kaW5nIHByaWNlIChhbmQgb2Z0ZW4gaXMhKSwgc28KICAgICAgICAgICAgLy8gdGhpcyBkZWx0YSBjYW4gYmUgbmVnYXRpdmUuCiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9lbmRpbmdQcmljZSkgLSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpOwoKICAgICAgICAgICAgLy8gVGhpcyBtdWx0aXBsaWNhdGlvbiBjYW4ndCBvdmVyZmxvdywgX3NlY29uZHNQYXNzZWQgd2lsbCBlYXNpbHkgZml0IHdpdGhpbgogICAgICAgICAgICAvLyA2NC1iaXRzLCBhbmQgdG90YWxQcmljZUNoYW5nZSB3aWxsIGVhc2lseSBmaXQgd2l0aGluIDEyOC1iaXRzLCB0aGVpciBwcm9kdWN0CiAgICAgICAgICAgIC8vIHdpbGwgYWx3YXlzIGZpdCB3aXRoaW4gMjU2LWJpdHMuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KF9zZWNvbmRzUGFzc2VkKSAvIGludDI1NihfZHVyYXRpb24pOwoKICAgICAgICAgICAgLy8gY3VycmVudFByaWNlQ2hhbmdlIGNhbiBiZSBuZWdhdGl2ZSwgYnV0IGlmIHNvLCB3aWxsIGhhdmUgYSBtYWduaXR1ZGUKICAgICAgICAgICAgLy8gbGVzcyB0aGF0IF9zdGFydGluZ1ByaWNlLiBUaHVzLCB0aGlzIHJlc3VsdCB3aWxsIGFsd2F5cyBlbmQgdXAgcG9zaXRpdmUuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwoKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgb3duZXIncyBjdXQgb2YgYSBzYWxlLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgLSBTYWxlIHByaWNlIG9mIE5GVC4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9Cgp9CgoKCmNvbnRyYWN0IENsb2NrQXVjdGlvbiBpcyBQYXVzYWJsZSwgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8vIEBkZXYgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPSBieXRlczQoMHg5YTIwNDgzZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgY3JlYXRlcyBhIHJlZmVyZW5jZSB0byB0aGUgTkZUIG93bmVyc2hpcCBjb250cmFjdAogICAgLy8vICBhbmQgdmVyaWZpZXMgdGhlIG93bmVyIGN1dCBpcyBpbiB0aGUgdmFsaWQgcmFuZ2UuCiAgICAvLy8gQHBhcmFtIF9uZnRBZGRyZXNzIC0gYWRkcmVzcyBvZiBhIGRlcGxveWVkIGNvbnRyYWN0IGltcGxlbWVudGluZwogICAgLy8vICB0aGUgTm9uZnVuZ2libGUgSW50ZXJmYWNlLgogICAgLy8vIEBwYXJhbSBfY3V0IC0gcGVyY2VudCBjdXQgdGhlIG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbXVzdCBiZQogICAgLy8vICBiZXR3ZWVuIDAtMTAsMDAwLgogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHJlc3MsIHVpbnQyNTYgX2N1dCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9jdXQgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKCiAgICAgICAgRVJDNzIxIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRVJDNzIxKF9uZnRBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0ID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlIGFsbCBFdGhlciBmcm9tIHRoZSBjb250cmFjdCwgd2hpY2ggaXMgdGhlIG93bmVyJ3MgY3V0cwogICAgLy8vICBhcyB3ZWxsIGFzIGFueSBFdGhlciBzZW50IGRpcmVjdGx5IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzLgogICAgLy8vICBBbHdheXMgdHJhbnNmZXJzIHRvIHRoZSBORlQgY29udHJhY3QsIGJ1dCBjYW4gYmUgY2FsbGVkIGVpdGhlciBieQogICAgLy8vICB0aGUgb3duZXIgb3IgdGhlIE5GVCBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIHsKICAgICAgICBhZGRyZXNzIG5mdEFkZHJlc3MgPSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpOwoKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IG93bmVyIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gbmZ0QWRkcmVzcwogICAgICAgICk7CiAgICAgICAgLy8gV2UgYXJlIHVzaW5nIHRoaXMgYm9vbGVhbiBtZXRob2QgdG8gbWFrZSBzdXJlIHRoYXQgZXZlbiBpZiBvbmUgZmFpbHMgaXQgd2lsbCBzdGlsbCB3b3JrCiAgICAgICAgLy8gYm9vbCByZXMgPSBuZnRBZGRyZXNzLnNlbmQodGhpcy5iYWxhbmNlKTsKICAgICAgICBuZnRBZGRyZXNzLnNlbmQodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcKICAgIC8vLyAgcHJpY2UgYW5kIGVuZGluZyBwcmljZSAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZAogICAgICAgIC8vIHRvIHN0b3JlIHRoZW0gaW4gdGhlIGF1Y3Rpb24gc3RydWN0LgogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwoKICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgX2VzY3Jvdyhtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgfQoKICAgIC8vLyBAZGV2IEJpZHMgb24gYW4gb3BlbiBhdWN0aW9uLCBjb21wbGV0aW5nIHRoZSBhdWN0aW9uIGFuZCB0cmFuc2ZlcnJpbmcKICAgIC8vLyAgb3duZXJzaGlwIG9mIHRoZSBORlQgaWYgZW5vdWdoIEV0aGVyIGlzIHN1cHBsaWVkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIGJpZCBvbi4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBfYmlkIHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBvciBmdW5kcyB0cmFuc2ZlciBmYWlscwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gdGhhdCBoYXNuJ3QgYmVlbiB3b24geWV0LgogICAgLy8vICBSZXR1cm5zIHRoZSBORlQgdG8gb3JpZ2luYWwgb3duZXIuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIGEgc3RhdGUtbW9kaWZ5aW5nIGZ1bmN0aW9uIHRoYXQgY2FuCiAgICAvLy8gIGJlIGNhbGxlZCB3aGlsZSB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIG9uIGF1Y3Rpb24KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIHNlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyAgT25seSB0aGUgb3duZXIgbWF5IGRvIHRoaXMsIGFuZCBORlRzIGFyZSByZXR1cm5lZCB0bwogICAgLy8vICB0aGUgc2VsbGVyLiBUaGlzIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gZW1lcmdlbmNpZXMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIE5GVCBvbiBhdWN0aW9uIHRvIGNhbmNlbC4KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb25XaGVuUGF1c2VkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgd2hlblBhdXNlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGF1Y3Rpb24gaW5mbyBmb3IgYW4gTkZUIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgTkZUIG9uIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucwogICAgKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGVuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBzdGFydGVkQXQKICAgICkgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGF1Y3Rpb24uc2VsbGVyLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIGF1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIGF1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIGF1Y3Rpb24uc3RhcnRlZEF0CiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIHRva2VuIHByaWNlIHdlIGFyZSBjaGVja2luZy4KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICB9Cgp9Cgpjb250cmFjdCBEaWFtb25kQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTYWxlQXVjdGlvbkFkZHJlc3MoKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNEaWFtb25kQXVjdGlvbiA9IHRydWU7CgogICAgZXZlbnQgQXVjdGlvbkNyZWF0ZWQodWludDI1NiBpbmRleGVkIHRva2VuSWQsIGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwgdWludDI1NiBlbmRpbmdQcmljZSwgdWludDI1NiBkdXJhdGlvbik7CiAgICBldmVudCBBdWN0aW9uU3VjY2Vzc2Z1bCh1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCwgdWludDI1NiB0b3RhbFByaWNlLCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKICAgIAogICAgLy8gRGVsZWdhdGUgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIERpYW1vbmRBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHIpIHB1YmxpYwogICAgICAgIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgMCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlcyBsYXN0U2FsZVByaWNlIGlmIHNlbGxlciBpcyB0aGUgbmZ0IGNvbnRyYWN0CiAgICAvLy8gT3RoZXJ3aXNlLCB3b3JrcyB0aGUgc2FtZSBhcyBkZWZhdWx0IGJpZCBtZXRob2QuCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICAvLyBfYmlkIHZlcmlmaWVzIHRva2VuIElEIHNpemUKICAgICAgICB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXS5zZWxsZXI7CiAgICAgICAgX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKfQoKY29udHJhY3QgRmxvd2VyQXVjdGlvbiBpcyBQYXVzYWJsZSB7CiAgICBzdHJ1Y3QgQXVjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQ7CiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwogICAgICAgIHVpbnQxMjggZW5kaW5nUHJpY2U7CiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CgogICAgRUlQMjBJbnRlcmZhY2UgcHVibGljIHRva2VuQ29udHJhY3Q7CgogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSBhdWN0aW9uczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgc2VsbGVyVG9BdWN0aW9uOwogICAgdWludDI1NiBwdWJsaWMgY3VycmVudEF1Y3Rpb25JZDsKCiAgICBldmVudCBBdWN0aW9uQ3JlYXRlZCh1aW50MjU2IGluZGV4ZWQgYXVjdGlvbklkLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGVuZGluZ1ByaWNlLCB1aW50MjU2IGR1cmF0aW9uKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgaW5kZXhlZCBhdWN0aW9uSWQsIHVpbnQyNTYgYW1vdW50LCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uU29sZE91dCh1aW50MjU2IGluZGV4ZWQgYXVjdGlvbklkKTsKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQodWludDI1NiBpbmRleGVkIGF1Y3Rpb25JZCk7CgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FSVAyMCA9IGJ5dGVzNCgweDk4NDc0MTA5KTsKCiAgICBib29sIHB1YmxpYyBpc0Zsb3dlckF1Y3Rpb24gPSB0cnVlOwoKICAgIGZ1bmN0aW9uIEZsb3dlckF1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkcmVzcykgcHVibGljIHsKICAgICAgICBvd25lckN1dCA9IDA7CgogICAgICAgIEVJUDIwSW50ZXJmYWNlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRUlQMjBJbnRlcmZhY2UoX25mdEFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3Quc3VwcG9ydHNFSVAyMEludGVyZmFjZShJbnRlcmZhY2VTaWduYXR1cmVfRUlQMjApKTsKICAgICAgICB0b2tlbkNvbnRyYWN0ID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbigKICAgICAgICB1aW50MjU2IF9hbW91bnQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwoKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0b2tlbkNvbnRyYWN0KSk7CiAgICAgICAgX2VzY3Jvdyhfc2VsbGVyLCBfYW1vdW50KTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihhdWN0aW9uKTsKICAgIH0KCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfYXVjdGlvbklkLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgX2JpZChfYXVjdGlvbklkLCBfYW1vdW50LCBtc2cudmFsdWUpOwogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgIH0KCgoKCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBuZnRBZGRyZXNzID0gYWRkcmVzcyh0b2tlbkNvbnRyYWN0KTsKCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBvd25lciB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IG5mdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIG5mdEFkZHJlc3Muc2VuZCh0aGlzLmJhbGFuY2UpOwogICAgfQoKCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX2F1Y3Rpb25JZCkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gYXVjdGlvbnNbX2F1Y3Rpb25JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX2F1Y3Rpb25JZCwgc2VsbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uV2hlblBhdXNlZCh1aW50MjU2IF9hdWN0aW9uSWQpCiAgICAgICAgd2hlblBhdXNlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBhdWN0aW9uc1tfYXVjdGlvbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX2F1Y3Rpb25JZCwgYXVjdGlvbi5zZWxsZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb24odWludDI1NiBfYXVjdGlvbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMKICAgICgKICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICB1aW50MjU2IGFtb3VudCwKICAgICAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBlbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgc3RhcnRlZEF0CiAgICApIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGF1Y3Rpb25zW19hdWN0aW9uSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5hbW91bnQsCiAgICAgICAgICAgIGF1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50MjU2IF9hdWN0aW9uSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGF1Y3Rpb25zW19hdWN0aW9uSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgIH0KCgoKCgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgdG9rZW5Db250cmFjdC50cmFuc2ZlckZyb21GbG93ZXIoX293bmVyLCB0aGlzLCBfYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfcmVjZWl2ZXIsIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgewogICAgICAgIHRva2VuQ29udHJhY3QudHJhbnNmZXJGbG93ZXIoX3JlY2VpdmVyLCBfYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBfYWRkQXVjdGlvbihBdWN0aW9uIF9hdWN0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfYXVjdGlvbi5kdXJhdGlvbiA+PSAxIG1pbnV0ZXMpOwoKICAgICAgICBjdXJyZW50QXVjdGlvbklkKys7CiAgICAgICAgYXVjdGlvbnNbY3VycmVudEF1Y3Rpb25JZF0gPSBfYXVjdGlvbjsKICAgICAgICBzZWxsZXJUb0F1Y3Rpb25bX2F1Y3Rpb24uc2VsbGVyXSA9IGN1cnJlbnRBdWN0aW9uSWQ7CgogICAgICAgIEF1Y3Rpb25DcmVhdGVkKAogICAgICAgICAgICBjdXJyZW50QXVjdGlvbklkLAogICAgICAgICAgICBfYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgIF9hdWN0aW9uLmFtb3VudCwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uZHVyYXRpb24pCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF9hdWN0aW9uSWQsIGFkZHJlc3MgX3NlbGxlcikgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gYXVjdGlvbnNbX2F1Y3Rpb25JZF0uYW1vdW50OwogICAgICAgIGRlbGV0ZSBzZWxsZXJUb0F1Y3Rpb25bYXVjdGlvbnNbX2F1Y3Rpb25JZF0uc2VsbGVyXTsKICAgICAgICBkZWxldGUgYXVjdGlvbnNbX2F1Y3Rpb25JZF07CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIGFtb3VudCk7CiAgICAgICAgQXVjdGlvbkNhbmNlbGxlZChfYXVjdGlvbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX2F1Y3Rpb25JZCwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9iaWRBbW91bnQpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gYXVjdGlvbnNbX2F1Y3Rpb25JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgICAgIHVpbnQyNTYgdG90YWxQcmljZSA9IHByaWNlICogX2Ftb3VudDsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gdG90YWxQcmljZSk7CiAgICAgICAgYXVjdGlvbi5hbW91bnQgLT0gX2Ftb3VudDsKCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKCiAgICAgICAgaWYgKHRvdGFsUHJpY2UgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHRvdGFsUHJpY2UpOwogICAgICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gdG90YWxQcmljZSAtIGF1Y3Rpb25lZXJDdXQ7CiAgICAgICAgICAgIHNlbGxlci50cmFuc2ZlcihzZWxsZXJQcm9jZWVkcyk7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gX2JpZEFtb3VudCAtIHRvdGFsUHJpY2U7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICBpZiAoYXVjdGlvbi5hbW91bnQgPT0gMCkgewogICAgICAgICAgICBBdWN0aW9uU29sZE91dChfYXVjdGlvbklkKTsKICAgICAgICAgICAgZGVsZXRlIGF1Y3Rpb25zW19hdWN0aW9uSWRdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF9hdWN0aW9uSWQsIF9hbW91bnQsIG1zZy5zZW5kZXIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvdGFsUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzT25BdWN0aW9uKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChfYXVjdGlvbi5zdGFydGVkQXQgPiAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IDA7CgogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICAgICAgX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBzZWNvbmRzUGFzc2VkCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgX3NlY29uZHNQYXNzZWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIGlmIChfc2Vjb25kc1Bhc3NlZCA+PSBfZHVyYXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuIF9lbmRpbmdQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihfZW5kaW5nUHJpY2UpIC0gaW50MjU2KF9zdGFydGluZ1ByaWNlKTsKICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZUNoYW5nZSA9IHRvdGFsUHJpY2VDaGFuZ2UgKiBpbnQyNTYoX3NlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9kdXJhdGlvbik7CiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwogICAgICAgICAgICByZXR1cm4gdWludDI1NihjdXJyZW50UHJpY2UpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1dCh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9Cgp9'.
	

]
