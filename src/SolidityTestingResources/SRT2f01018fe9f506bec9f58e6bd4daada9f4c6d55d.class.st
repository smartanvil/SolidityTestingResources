Class {
	#name : #SRT2f01018fe9f506bec9f58e6bd4daada9f4c6d55d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2f01018fe9f506bec9f58e6bd4daada9f4c6d55d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQovLy8gIGxhdGVyIGNoYW5nZWQKY29udHJhY3QgT3duZWQgewoKICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIG1lc3NhZ2Ugc2VuZGVyIHRvIGJlIGBvd25lcmAKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBpZihtc2cuc2VuZGVyID09IG93bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCgpjb250cmFjdCBEeW5hbWljQ2VpbGluZyBpcyBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBzdHJ1Y3QgQ2VpbGluZyB7CiAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgIHVpbnQyNTYgbGltaXQ7CiAgICAgICAgdWludDI1NiBzbG9wZUZhY3RvcjsKICAgICAgICB1aW50MjU2IGNvbGxlY3RNaW5pbXVtOwogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIHNhbGVBZGRyZXNzOwoKICAgIENlaWxpbmdbXSBwdWJsaWMgY2VpbGluZ3M7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIGN1cnJlbnRJbmRleDsKICAgIHVpbnQyNTYgcHVibGljIHJldmVhbGVkQ2VpbGluZ3M7CiAgICBib29sIHB1YmxpYyBhbGxSZXZlYWxlZDsKCiAgICBtb2RpZmllciBvbmx5U2FsZUFkZHJlc3MgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzYWxlQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBEeW5hbWljQ2VpbGluZyhhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc2FsZUFkZHJlc3MpIHsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgICAgICBzYWxlQWRkcmVzcyA9IF9zYWxlQWRkcmVzczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYnkgdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IHRvIGNvbW1pdAogICAgLy8vICBhbGwgdGhlIGNlaWxpbmdzLgogICAgLy8vIEBwYXJhbSBfY2VpbGluZ0hhc2hlcyBBcnJheSBvZiBoYXNoZXMgb2YgZWFjaCBjZWlsaW5nLiBFYWNoIGhhc2ggaXMgY2FsY3VsYXRlZAogICAgLy8vICBieSB0aGUgYGNhbGN1bGF0ZUhhc2hgIG1ldGhvZC4gTW9yZSBoYXNoZXMgdGhhbiBhY3R1YWwgY2VpbGluZ3MgY2FuIGJlCiAgICAvLy8gIGNvbW1pdHRlZCBpbiBvcmRlciB0byBoaWRlIGFsc28gdGhlIG51bWJlciBvZiBjZWlsaW5ncy4KICAgIC8vLyAgVGhlIHJlbWFpbmluZyBoYXNoZXMgY2FuIGJlIGp1c3QgcmFuZG9tIG51bWJlcnMuCiAgICBmdW5jdGlvbiBzZXRIaWRkZW5DZWlsaW5ncyhieXRlczMyW10gX2NlaWxpbmdIYXNoZXMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoY2VpbGluZ3MubGVuZ3RoID09IDApOwoKICAgICAgICBjZWlsaW5ncy5sZW5ndGggPSBfY2VpbGluZ0hhc2hlcy5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2NlaWxpbmdIYXNoZXMubGVuZ3RoOyBpID0gaS5hZGQoMSkpIHsKICAgICAgICAgICAgY2VpbGluZ3NbaV0uaGFzaCA9IF9jZWlsaW5nSGFzaGVzW2ldOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbnlib2R5IGNhbiByZXZlYWwgdGhlIG5leHQgY2VpbGluZyBpZiBoZSBrbm93cyBpdC4KICAgIC8vLyBAcGFyYW0gX2xpbWl0IENlaWxpbmcgY2FwLgogICAgLy8vICAobXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSBwcmV2aW91cyBvbmUpLgogICAgLy8vIEBwYXJhbSBfbGFzdCBgdHJ1ZWAgaWYgaXQncyB0aGUgbGFzdCBjZWlsaW5nLgogICAgLy8vIEBwYXJhbSBfc2FsdCBSYW5kb20gbnVtYmVyIHVzZWQgdG8gY29tbWl0IHRoZSBjZWlsaW5nCiAgICBmdW5jdGlvbiByZXZlYWxDZWlsaW5nKAogICAgICAgIHVpbnQyNTYgX2xpbWl0LCAKICAgICAgICB1aW50MjU2IF9zbG9wZUZhY3RvciwgCiAgICAgICAgdWludDI1NiBfY29sbGVjdE1pbmltdW0sCiAgICAgICAgYm9vbCBfbGFzdCwgCiAgICAgICAgYnl0ZXMzMiBfc2FsdCkgCiAgICAgICAgcHVibGljIAogICAgICAgIHsKICAgICAgICByZXF1aXJlKCFhbGxSZXZlYWxlZCk7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgY2VpbGluZ3NbcmV2ZWFsZWRDZWlsaW5nc10uaGFzaCA9PSAKICAgICAgICAgICAgY2FsY3VsYXRlSGFzaCgKICAgICAgICAgICAgICAgIF9saW1pdCwgCiAgICAgICAgICAgICAgICBfc2xvcGVGYWN0b3IsIAogICAgICAgICAgICAgICAgX2NvbGxlY3RNaW5pbXVtLCAKICAgICAgICAgICAgICAgIF9sYXN0LCAKICAgICAgICAgICAgICAgIF9zYWx0CiAgICAgICAgICAgICkKICAgICAgICApOwoKICAgICAgICByZXF1aXJlKF9saW1pdCAhPSAwICYmIF9zbG9wZUZhY3RvciAhPSAwICYmIF9jb2xsZWN0TWluaW11bSAhPSAwKTsKICAgICAgICBpZiAocmV2ZWFsZWRDZWlsaW5ncyA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShfbGltaXQgPj0gY2VpbGluZ3NbcmV2ZWFsZWRDZWlsaW5ncy5zdWIoMSldLmxpbWl0KTsKICAgICAgICB9CgogICAgICAgIGNlaWxpbmdzW3JldmVhbGVkQ2VpbGluZ3NdLmxpbWl0ID0gX2xpbWl0OwogICAgICAgIGNlaWxpbmdzW3JldmVhbGVkQ2VpbGluZ3NdLnNsb3BlRmFjdG9yID0gX3Nsb3BlRmFjdG9yOwogICAgICAgIGNlaWxpbmdzW3JldmVhbGVkQ2VpbGluZ3NdLmNvbGxlY3RNaW5pbXVtID0gX2NvbGxlY3RNaW5pbXVtOwogICAgICAgIHJldmVhbGVkQ2VpbGluZ3MgPSByZXZlYWxlZENlaWxpbmdzLmFkZCgxKTsKCiAgICAgICAgaWYgKF9sYXN0KSB7CiAgICAgICAgICAgIGFsbFJldmVhbGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV2ZWFsIG11bHRpcGxlIGNlaWxpbmdzIGF0IG9uY2UKICAgIGZ1bmN0aW9uIHJldmVhbE11bHRpKAogICAgICAgIHVpbnQyNTZbXSBfbGltaXRzLAogICAgICAgIHVpbnQyNTZbXSBfc2xvcGVGYWN0b3JzLAogICAgICAgIHVpbnQyNTZbXSBfY29sbGVjdE1pbmltdW1zLAogICAgICAgIGJvb2xbXSBfbGFzdHMsIAogICAgICAgIGJ5dGVzMzJbXSBfc2FsdHMpIAogICAgICAgIHB1YmxpYyAKICAgICAgICB7CiAgICAgICAgLy8gRG8gbm90IGFsbG93IG5vbmUgYW5kIG5lZWRzIHRvIGJlIHNhbWUgbGVuZ3RoIGZvciBhbGwgcGFyYW1ldGVycwogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIF9saW1pdHMubGVuZ3RoICE9IDAgJiYKICAgICAgICAgICAgX2xpbWl0cy5sZW5ndGggPT0gX3Nsb3BlRmFjdG9ycy5sZW5ndGggJiYKICAgICAgICAgICAgX2xpbWl0cy5sZW5ndGggPT0gX2NvbGxlY3RNaW5pbXVtcy5sZW5ndGggJiYKICAgICAgICAgICAgX2xpbWl0cy5sZW5ndGggPT0gX2xhc3RzLmxlbmd0aCAmJgogICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfc2FsdHMubGVuZ3RoCiAgICAgICAgKTsKCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2xpbWl0cy5sZW5ndGg7IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICAKICAgICAgICAgICAgcmV2ZWFsQ2VpbGluZygKICAgICAgICAgICAgICAgIF9saW1pdHNbaV0sCiAgICAgICAgICAgICAgICBfc2xvcGVGYWN0b3JzW2ldLAogICAgICAgICAgICAgICAgX2NvbGxlY3RNaW5pbXVtc1tpXSwKICAgICAgICAgICAgICAgIF9sYXN0c1tpXSwKICAgICAgICAgICAgICAgIF9zYWx0c1tpXQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBNb3ZlIHRvIGNlaWxpbmcsIHVzZWQgYXMgYSBmYWlsc2FmZQogICAgZnVuY3Rpb24gbW92ZVRvTmV4dENlaWxpbmcoKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICAgICAgY3VycmVudEluZGV4ID0gY3VycmVudEluZGV4LmFkZCgxKTsKICAgIH0KCiAgICAvLy8gQHJldHVybiBSZXR1cm4gdGhlIGZ1bmRzIHRvIGNvbGxlY3QgZm9yIHRoZSBjdXJyZW50IHBvaW50IG9uIHRoZSBjZWlsaW5nCiAgICAvLy8gIChvciAwIGlmIG5vIGNlaWxpbmdzIHJldmVhbGVkIHlldCkKICAgIGZ1bmN0aW9uIGF2YWlsYWJsZUFtb3VudFRvQ29sbGVjdCh1aW50MjU2ICB0b3RhbGxDb2xsZWN0ZWQpIHB1YmxpYyBvbmx5U2FsZUFkZHJlc3MgcmV0dXJucyAodWludDI1NikgewogICAgCiAgICAgICAgaWYgKHJldmVhbGVkQ2VpbGluZ3MgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmICh0b3RhbGxDb2xsZWN0ZWQgPj0gY2VpbGluZ3NbY3VycmVudEluZGV4XS5saW1pdCkgeyAgCiAgICAgICAgICAgIHVpbnQyNTYgbmV4dEluZGV4ID0gY3VycmVudEluZGV4LmFkZCgxKTsKCiAgICAgICAgICAgIGlmIChuZXh0SW5kZXggPj0gcmV2ZWFsZWRDZWlsaW5ncykgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7IAogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnRJbmRleCA9IG5leHRJbmRleDsKICAgICAgICAgICAgaWYgKHRvdGFsbENvbGxlY3RlZCA+PSBjZWlsaW5nc1tjdXJyZW50SW5kZXhdLmxpbWl0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsgIAogICAgICAgICAgICB9CiAgICAgICAgfSAgICAgICAgCiAgICAgICAgdWludDI1NiByZW1haW5lZEZyb21DdXJyZW50Q2VpbGluZyA9IGNlaWxpbmdzW2N1cnJlbnRJbmRleF0ubGltaXQuc3ViKHRvdGFsbENvbGxlY3RlZCk7CiAgICAgICAgdWludDI1NiByZW1pbmRlcldpdGhTbG9wZUZhY3RvciA9IHJlbWFpbmVkRnJvbUN1cnJlbnRDZWlsaW5nLmRpdihjZWlsaW5nc1tjdXJyZW50SW5kZXhdLnNsb3BlRmFjdG9yKTsKCiAgICAgICAgaWYgKHJlbWluZGVyV2l0aFNsb3BlRmFjdG9yID4gY2VpbGluZ3NbY3VycmVudEluZGV4XS5jb2xsZWN0TWluaW11bSkgewogICAgICAgICAgICByZXR1cm4gcmVtaW5kZXJXaXRoU2xvcGVGYWN0b3I7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZW1haW5lZEZyb21DdXJyZW50Q2VpbGluZyA+IGNlaWxpbmdzW2N1cnJlbnRJbmRleF0uY29sbGVjdE1pbmltdW0pIHsKICAgICAgICAgICAgcmV0dXJuIGNlaWxpbmdzW2N1cnJlbnRJbmRleF0uY29sbGVjdE1pbmltdW07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHJlbWFpbmVkRnJvbUN1cnJlbnRDZWlsaW5nOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBoYXNoIG9mIGEgY2VpbGluZy4KICAgIC8vLyBAcGFyYW0gX2xpbWl0IENlaWxpbmcgY2FwLgogICAgLy8vIEBwYXJhbSBfbGFzdCBgdHJ1ZWAgaWYgaXQncyB0aGUgbGFzdCBjZWlsaW5nLgogICAgLy8vIEBwYXJhbSBfY29sbGVjdE1pbmltdW0gdGhlIG1pbmltdW0gYW1vdW50IHRvIGNvbGxlY3QKICAgIC8vLyBAcGFyYW0gX3NhbHQgUmFuZG9tIG51bWJlciB0aGF0IHdpbGwgYmUgbmVlZGVkIHRvIHJldmVhbCB0aGlzIGNlaWxpbmcuCiAgICAvLy8gQHJldHVybiBUaGUgY2FsY3VsYXRlZCBoYXNoIG9mIHRoaXMgY2VpbGluZyB0byBiZSB1c2VkIGluIHRoZSBgc2V0SGlkZGVuQ3VydmVzYCBtZXRob2QKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUhhc2goCiAgICAgICAgdWludDI1NiBfbGltaXQsIAogICAgICAgIHVpbnQyNTYgX3Nsb3BlRmFjdG9yLCAKICAgICAgICB1aW50MjU2IF9jb2xsZWN0TWluaW11bSwKICAgICAgICBib29sIF9sYXN0LCAKICAgICAgICBieXRlczMyIF9zYWx0KSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikgCiAgICAgICAgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoCiAgICAgICAgICAgIF9saW1pdCwKICAgICAgICAgICAgX3Nsb3BlRmFjdG9yLCAKICAgICAgICAgICAgX2NvbGxlY3RNaW5pbXVtLAogICAgICAgICAgICBfbGFzdCwKICAgICAgICAgICAgX3NhbHQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIFJldHVybiB0aGUgdG90YWwgbnVtYmVyIG9mIGNlaWxpbmdzIGNvbW1pdHRlZAogICAgLy8vICAoY2FuIGJlIGxhcmdlciB0aGFuIHRoZSBudW1iZXIgb2YgYWN0dWFsIGNlaWxpbmdzIG9uIHRoZSBjZWlsaW5nIHRvIGhpZGUKICAgIC8vLyAgdGhlIHJlYWwgbnVtYmVyIG9mIGNlaWxpbmdzKQogICAgZnVuY3Rpb24gbkNlaWxpbmdzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY2VpbGluZ3MubGVuZ3RoOwogICAgfQoKfQoKLy8vIEB0aXRsZSBWZXN0aW5nIHRydXN0ZWUKY29udHJhY3QgVHJ1c3RlZSBpcyBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgU0hQIEVSQzIwIHRva2VuLgogICAgU0hQIHB1YmxpYyBzaHA7CgogICAgc3RydWN0IEdyYW50IHsKICAgICAgICB1aW50MjU2IHZhbHVlOwogICAgICAgIHVpbnQyNTYgc3RhcnQ7CiAgICAgICAgdWludDI1NiBjbGlmZjsKICAgICAgICB1aW50MjU2IGVuZDsKICAgICAgICB1aW50MjU2IHRyYW5zZmVycmVkOwogICAgICAgIGJvb2wgcmV2b2thYmxlOwogICAgfQoKICAgIC8vIEdyYW50cyBob2xkZXIuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEdyYW50KSBwdWJsaWMgZ3JhbnRzOwoKICAgIC8vIFRvdGFsIHRva2VucyBhdmFpbGFibGUgZm9yIHZlc3RpbmcuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFZlc3Rpbmc7CgogICAgZXZlbnQgTmV3R3JhbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBVbmxvY2tHcmFudChhZGRyZXNzIGluZGV4ZWQgX2hvbGRlciwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgUmV2b2tlR3JhbnQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3JlZnVuZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgdGhhdCBpbml0aWFsaXplcyB0aGUgYWRkcmVzcyBvZiB0aGUgU0hQIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfc2hwIFNIUCBUaGUgYWRkcmVzcyBvZiB0aGUgcHJldmlvdXNseSBkZXBsb3llZCBTSFAgc21hcnQgY29udHJhY3QuCiAgICBmdW5jdGlvbiBUcnVzdGVlKFNIUCBfc2hwKSB7CiAgICAgICAgcmVxdWlyZShfc2hwICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHNocCA9IF9zaHA7CiAgICB9CgogICAgLy8vIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIGdyYW50IHRva2VucyB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0IHVpbnQyNTYgVGhlIGJlZ2lubmluZyBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9jbGlmZiB1aW50MjU2IER1cmF0aW9uIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9lbmQgdWludDI1NiBUaGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgIC8vLyBAcGFyYW0gX3Jldm9rYWJsZSBib29sIFdoZXRoZXIgdGhlIGdyYW50IGlzIHJldm9rYWJsZSBvciBub3QuCiAgICBmdW5jdGlvbiBncmFudChhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZW5kLCBib29sIF9yZXZva2FibGUpCiAgICAgICAgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgYSBzaW5nbGUgYWRkcmVzcyBjYW4gYmUgZ3JhbnRlZCB0b2tlbnMgb25seSBvbmNlLgogICAgICAgIHJlcXVpcmUoZ3JhbnRzW190b10udmFsdWUgPT0gMCk7CgogICAgICAgIC8vIENoZWNrIGZvciBkYXRlIGluY29uc2lzdGVuY2llcyB0aGF0IG1heSBjYXVzZSB1bmV4cGVjdGVkIGJlaGF2aW9yLgogICAgICAgIHJlcXVpcmUoX3N0YXJ0IDw9IF9jbGlmZiAmJiBfY2xpZmYgPD0gX2VuZCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhpcyBncmFudCBkb2Vzbid0IGV4Y2VlZCB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBjdXJyZW50bHkgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgICAgIHJlcXVpcmUodG90YWxWZXN0aW5nLmFkZChfdmFsdWUpIDw9IHNocC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkpOwoKICAgICAgICAvLyBBc3NpZ24gYSBuZXcgZ3JhbnQuCiAgICAgICAgZ3JhbnRzW190b10gPSBHcmFudCh7CiAgICAgICAgICAgIHZhbHVlOiBfdmFsdWUsCiAgICAgICAgICAgIHN0YXJ0OiBfc3RhcnQsCiAgICAgICAgICAgIGNsaWZmOiBfY2xpZmYsCiAgICAgICAgICAgIGVuZDogX2VuZCwKICAgICAgICAgICAgdHJhbnNmZXJyZWQ6IDAsCiAgICAgICAgICAgIHJldm9rYWJsZTogX3Jldm9rYWJsZQogICAgICAgIH0pOwoKICAgICAgICAvLyBUb2tlbnMgZ3JhbnRlZCwgcmVkdWNlIHRoZSB0b3RhbCBhbW91bnQgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKTsKCiAgICAgICAgTmV3R3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldm9rZSB0aGUgZ3JhbnQgb2YgdG9rZW5zIG9mIGEgc3BlY2lmZWQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLgogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX2hvbGRlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl07CgogICAgICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKCiAgICAgICAgLy8gU2VuZCB0aGUgcmVtYWluaW5nIFNIUCBiYWNrIHRvIHRoZSBvd25lci4KICAgICAgICB1aW50MjU2IHJlZnVuZCA9IGdyYW50LnZhbHVlLnN1YihncmFudC50cmFuc2ZlcnJlZCk7CgogICAgICAgIC8vIFJlbW92ZSB0aGUgZ3JhbnQuCiAgICAgICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXTsKCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLnN1YihyZWZ1bmQpOwogICAgICAgIHNocC50cmFuc2Zlcihtc2cuc2VuZGVyLCByZWZ1bmQpOwoKICAgICAgICBSZXZva2VHcmFudChfaG9sZGVyLCByZWZ1bmQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lLgogICAgLy8vIEBwYXJhbSBfaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlci4KICAgIC8vLyBAcGFyYW0gX3RpbWUgdWludDI1NiBUaGUgc3BlY2lmaWMgdGltZS4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2Vucy4KICAgIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3RpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl07CiAgICAgICAgaWYgKGdyYW50LnZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKGdyYW50LCBfdGltZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLgogICAgLy8vIEBwYXJhbSBfZ3JhbnQgR3JhbnQgVGhlIHZlc3RpbmcgZ3JhbnQuCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAgLy8vIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQuCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgLwogICAgLy8vICAgfCAgICAgICAgICAgICAgLnwKICAgIC8vLyAgIHwgICAgICAgICAgICAuICB8CiAgICAvLy8gICB8ICAgICAgICAgIC4gICAgfAogICAgLy8vICAgfCAgICAgICAgLiAgICAgIHwKICAgIC8vLyAgIHwgICAgICAuICAgICAgICB8CiAgICAvLy8gICB8ICAgIC4gICAgICAgICAgfAogICAgLy8vICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAgLy8vICAgICBTdGFydCAgICAgICBDbGlmZiAgICAgIEVuZAogICAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKEdyYW50IF9ncmFudCwgdWludDI1NiBfdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSWYgd2UncmUgYmVmb3JlIHRoZSBjbGlmZiwgdGhlbiBub3RoaW5nIGlzIHZlc3RlZC4KICAgICAgICBpZiAoX3RpbWUgPCBfZ3JhbnQuY2xpZmYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB3ZSdyZSBhZnRlciB0aGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZCAtIGV2ZXJ5dGhpbmcgaXMgdmVzdGVkOwogICAgICAgIGlmIChfdGltZSA+PSBfZ3JhbnQuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiBfZ3JhbnQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2VuczogdmVzdGVkVG9rZW5zID0gdG9rZW5zLy8vICh0aW1lIC0gc3RhcnQpIC8gKGVuZCAtIHN0YXJ0KQogICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlLm11bChfdGltZS5zdWIoX2dyYW50LnN0YXJ0KSkuZGl2KF9ncmFudC5lbmQuc3ViKF9ncmFudC5zdGFydCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFVubG9jayB2ZXN0ZWQgdG9rZW5zIGFuZCB0cmFuc2ZlciB0aGVtIHRvIHRoZWlyIGhvbGRlci4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoZWlyIGhvbGRlci4KICAgIGZ1bmN0aW9uIHVubG9ja1Zlc3RlZFRva2VucygpIHB1YmxpYyB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShncmFudC52YWx1ZSAhPSAwKTsKCiAgICAgICAgLy8gR2V0IHRoZSB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2VucywgYWNjY29yZGluZyB0byBncmFudC4KICAgICAgICB1aW50MjU2IHZlc3RlZCA9IGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgbm93KTsKICAgICAgICBpZiAodmVzdGVkID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBob2xkZXIgZG9lc24ndCB0cmFuc2ZlciBtb3JlIHRoYW4gd2hhdCBoZSBhbHJlYWR5IGhhcy4KICAgICAgICB1aW50MjU2IHRyYW5zZmVyYWJsZSA9IHZlc3RlZC5zdWIoZ3JhbnQudHJhbnNmZXJyZWQpOwogICAgICAgIGlmICh0cmFuc2ZlcmFibGUgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBncmFudC50cmFuc2ZlcnJlZCA9IGdyYW50LnRyYW5zZmVycmVkLmFkZCh0cmFuc2ZlcmFibGUpOwogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5zdWIodHJhbnNmZXJhYmxlKTsKICAgICAgICBzaHAudHJhbnNmZXIobXNnLnNlbmRlciwgdHJhbnNmZXJhYmxlKTsKCiAgICAgICAgVW5sb2NrR3JhbnQobXNnLnNlbmRlciwgdHJhbnNmZXJhYmxlKTsKICAgIH0KfQoKLy8vIEBkZXYgVGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QgbXVzdCBpbXBsZW1lbnQgdGhlc2UgZnVuY3Rpb25zCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQogICAgICAgIHJldHVybnMoYm9vbCk7Cn0KCmNvbnRyYWN0IENvbnRyb2xsZWQgewogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlciB7IHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb250cm9sbGVyKTsgXzsgfQoKICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CgogICAgZnVuY3Rpb24gQ29udHJvbGxlZCgpIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGNvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsKICAgIH0KfQoKY29udHJhY3QgQXBwcm92ZUFuZENhbGxGYWxsQmFjayB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBmcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSk7Cn0KCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXIKLy8vICB0aGF0IGRlcGxveXMgdGhlIGNvbnRyYWN0LCBzbyB1c3VhbGx5IHRoaXMgdG9rZW4gd2lsbCBiZSBkZXBsb3llZCBieSBhCi8vLyAgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCwgd2hpY2ggR2l2ZXRoIHdpbGwgY2FsbCBhICJDYW1wYWlnbiIKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4xJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKCgogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewoKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwoKICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyCiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgovLy8vLy8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdAogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLAogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGlzIHRoZSBhY3R1YWwgdHJhbnNmZXIgZnVuY3Rpb24gaW4gdGhlIHRva2VuIGNvbnRyYWN0LCBpdCBjYW4KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgewoKICAgICAgICAgICBpZiAoX2Ftb3VudCA9PSAwKSB7CiAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgcmVxdWlyZShwYXJlbnRTbmFwU2hvdEJsb2NrIDwgYmxvY2subnVtYmVyKTsKCiAgICAgICAgICAgLy8gRG8gbm90IGFsbG93IHRyYW5zZmVyIHRvIDB4MCBvciB0aGUgdG9rZW4gY29udHJhY3QgaXRzZWxmCiAgICAgICAgICAgcmVxdWlyZSgoX3RvICE9IDApICYmIChfdG8gIT0gYWRkcmVzcyh0aGlzKSkpOwoKICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsKICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSB0cmFuc2ZlcgogICAgICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpOwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2VucwogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZkF0KF90bywgYmxvY2subnVtYmVyKTsKICAgICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX3RvXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CgogICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZSgoX2Ftb3VudCA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpOwogICAgICAgIH0KCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gcmVhZCB0aGUgYGFsbG93ZWRbXWAgbWFwCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0aGF0IG93bnMgdGhlIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgb2YgX293bmVyIHRoYXQgX3NwZW5kZXIgaXMgYWxsb3dlZAogICAgLy8vICB0byBzcGVuZAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyCiAgICApIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc2VuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzCiAgICAvLy8gIGJlaW5nIGFwcHJvdmVkLCBgX3NwZW5kZXJgLiBUaGlzIGFsbG93cyB1c2VycyB0byB1c2UgdGhlaXIgdG9rZW5zIHRvCiAgICAvLy8gIGludGVyYWN0IHdpdGggY29udHJhY3RzIGluIG9uZSBmdW5jdGlvbiBjYWxsIGluc3RlYWQgb2YgdHdvCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGZ1bmN0aW9uIGNhbGwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKTsKCiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBfYW1vdW50LAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfZXh0cmFEYXRhCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUF0KGJsb2NrLm51bWJlcik7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBRdWVyeSBiYWxhbmNlIGFuZCB0b3RhbFN1cHBseSBpbiBIaXN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgYmFsYW5jZSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZgogICAgICAgIC8vICB0aGlzIHRva2VuCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBIYXMgbm8gcGFyZW50CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYC4KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKSByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3NuYXBzaG90QmxvY2sgPT0gMCkgX3NuYXBzaG90QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgICAgICBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBjbG9uZVRva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CgogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRva2VuIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgIE5ld0Nsb25lVG9rZW4oYWRkcmVzcyhjbG9uZVRva2VuKSwgX3NuYXBzaG90QmxvY2spOwogICAgICAgIHJldHVybiBhZGRyZXNzKGNsb25lVG9rZW4pOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBHZW5lcmF0ZSBhbmQgZGVzdHJveSB0b2tlbnMKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEdlbmVyYXRlcyBgX2Ftb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdGhlIG5ldyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBnZW5lcmF0ZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCA+PSBjdXJUb3RhbFN1cHBseSk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlRnJvbSA+PSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEVuYWJsZXMgdG9rZW4gaG9sZGVycyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZnJlZWx5IGlmIHRydWUKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgb25seUNvbnRyb2xsZXIgewogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcgogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiB2YWx1ZXMgYmVpbmcgcXVlcmllZAogICAgLy8vIEBwYXJhbSBfYmxvY2sgVGhlIGJsb2NrIG51bWJlciB0byByZXRyaWV2ZSB0aGUgdmFsdWUgYXQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQKICAgIGZ1bmN0aW9uIGdldFZhbHVlQXQoQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX2Jsb2NrCiAgICApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOwoKICAgICAgICAvLyBTaG9ydGN1dCBmb3IgdGhlIGFjdHVhbCB2YWx1ZQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykKICAgICAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS52YWx1ZTsKICAgICAgICBpZiAoX2Jsb2NrIDwgY2hlY2twb2ludHNbMF0uZnJvbUJsb2NrKSByZXR1cm4gMDsKCiAgICAgICAgLy8gQmluYXJ5IHNlYXJjaCBvZiB0aGUgdmFsdWUgaW4gdGhlIGFycmF5CiAgICAgICAgdWludCBtaW4gPSAwOwogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7CiAgICAgICAgd2hpbGUgKG1heCA+IG1pbikgewogICAgICAgICAgICB1aW50IG1pZCA9IChtYXggKyBtaW4gKyAxKS8gMjsKICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOwogICAgfQoKICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQogICAgLy8vICBgdG90YWxTdXBwbHlIaXN0b3J5YAogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiBkYXRhIGJlaW5nIHVwZGF0ZWQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfdmFsdWUKICAgICkgaW50ZXJuYWwgIHsKICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLTFdLmZyb21CbG9jayA8IGJsb2NrLm51bWJlcikpIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBvbGRDaGVja1BvaW50ID0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdOwogICAgICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemU+MDsKICAgIH0KCiAgICAvLy8gQGRldiBIZWxwZXIgZnVuY3Rpb24gdG8gcmV0dXJuIGEgbWluIGJldHdlbiB0aGUgdHdvIHVpbnRzCiAgICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgfQoKLy8vLy8vLy8vLwovLyBTYWZldHkgTWV0aG9kcwovLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgY29udHJvbGxlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNaW5pTWVUb2tlbiB0b2tlbiA9IE1pbmlNZVRva2VuKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRXZlbnRzCi8vLy8vLy8vLy8vLy8vLy8KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOwogICAgZXZlbnQgQXBwcm92YWwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9vd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICAgICAgKTsKCn0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIE1pbmlNZVRva2VuRmFjdG9yeQovLy8vLy8vLy8vLy8vLy8vCgovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgdG8gZ2VuZXJhdGUgY2xvbmUgY29udHJhY3RzIGZyb20gYSBjb250cmFjdC4KLy8vICBJbiBzb2xpZGl0eSB0aGlzIGlzIHRoZSB3YXkgdG8gY3JlYXRlIGEgY29udHJhY3QgZnJvbSBhIGNvbnRyYWN0IG9mIHRoZQovLy8gIHNhbWUgY2xhc3MKY29udHJhY3QgTWluaU1lVG9rZW5GYWN0b3J5IHsKCiAgICAvLy8gQG5vdGljZSBVcGRhdGUgdGhlIERBcHAgYnkgY3JlYXRpbmcgYSBuZXcgdG9rZW4gd2l0aCBuZXcgZnVuY3Rpb25hbGl0aWVzCiAgICAvLy8gIHRoZSBtc2cuc2VuZGVyIGJlY29tZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgdG9rZW4gYmVpbmcgY2xvbmVkCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgcmV0dXJucyAoTWluaU1lVG9rZW4pIAogICAgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9Cgpjb250cmFjdCBTSFAgaXMgTWluaU1lVG9rZW4gewogICAgLy8gQGRldiBTSFAgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNIUChhZGRyZXNzIF90b2tlbkZhY3RvcnkpCiAgICAgICAgICAgIE1pbmlNZVRva2VuKAogICAgICAgICAgICAgICAgX3Rva2VuRmFjdG9yeSwKICAgICAgICAgICAgICAgIDB4MCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHBhcmVudCB0b2tlbgogICAgICAgICAgICAgICAgMCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gc25hcHNob3QgYmxvY2sgbnVtYmVyIGZyb20gcGFyZW50CiAgICAgICAgICAgICAgICAiU2hhcnBlIFBsYXRmb3JtIFRva2VuIiwgICAgICAgICAvLyBUb2tlbiBuYW1lCiAgICAgICAgICAgICAgICAxOCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWNpbWFscwogICAgICAgICAgICAgICAgIlNIUCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sCiAgICAgICAgICAgICAgICB0cnVlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgdHJhbnNmZXJzCiAgICAgICAgICAgICkge30KfQoKY29udHJhY3QgQWZmaWxpYXRlVXRpbGl0eSBpcyBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgdWludDI1NiBwdWJsaWMgdGllclR3b01pbjsKICAgIHVpbnQyNTYgcHVibGljIHRpZXJUaHJlZU1pbjsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUSUVSMV9QRVJDRU5UID0gMzsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRJRVIyX1BFUkNFTlQgPSA0OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVElFUjNfUEVSQ0VOVCA9IDU7CiAgICAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQWZmaWxpYXRlKSBwcml2YXRlIGFmZmlsaWF0ZXM7CgogICAgZXZlbnQgQWZmaWxpYXRlUmVjZWl2ZWQoYWRkcmVzcyBhZmZpbGlhdGVBZGRyZXNzLCBhZGRyZXNzIGludmVzdG9yQWRkcmVzcywgYm9vbCB2YWxpZCk7CgogICAgc3RydWN0IEFmZmlsaWF0ZSB7CiAgICAgICAgYWRkcmVzcyBldGhlckFkZHJlc3M7CiAgICAgICAgYm9vbCBpc1ByZXNlbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gQWZmaWxpYXRlVXRpbGl0eSh1aW50MjU2IF90aWVyVHdvTWluLCB1aW50MjU2IF90aWVyVGhyZWVNaW4pIHsKICAgICAgICBzZXRUaWVycyhfdGllclR3b01pbiwgX3RpZXJUaHJlZU1pbik7CiAgICB9CgogICAgLy8vIEBub3RpY2Ugc2V0cyB0aGUgRXRoZXIgdG8gRG9sbGFyIGV4aGNoYW5nZSByYXRlCiAgICAvLy8gQHBhcmFtIF90aWVyVHdvTWluIHRoZSB0aWVyIDIgbWluIChpbiBXRUkpCiAgICAvLy8gQHBhcmFtIF90aWVyVGhyZWVNaW4gdGhlIHRpZXIgMyBtaW4gKGluIFdFSSkKICAgIGZ1bmN0aW9uIHNldFRpZXJzKHVpbnQyNTYgX3RpZXJUd29NaW4sIHVpbnQyNTYgX3RpZXJUaHJlZU1pbikgb25seU93bmVyIHsKICAgICAgICB0aWVyVHdvTWluID0gX3RpZXJUd29NaW47CiAgICAgICAgdGllclRocmVlTWluID0gX3RpZXJUaHJlZU1pbjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIGFkZHMgYW4gYWZmaWxpYXRlIEV0aGVyZXVtIGFkZHJlc3MgdG8gb3VyIHdoaXRlbGlzdAogICAgLy8vIEBwYXJhbSBfaW52ZXN0b3IgVGhlIGludmVzdG9yJ3MgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYWZmaWxpYXRlIFRoZSBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBhZmZpbGlhdGUKICAgIGZ1bmN0aW9uIGFkZEFmZmlsaWF0ZShhZGRyZXNzIF9pbnZlc3RvciwgYWRkcmVzcyBfYWZmaWxpYXRlKSBvbmx5T3duZXIgewogICAgICAgIGFmZmlsaWF0ZXNbX2ludmVzdG9yXSA9IEFmZmlsaWF0ZShfYWZmaWxpYXRlLCB0cnVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjYWxjdWxhdGVzIGFuZCByZXR1cm5zIHRoZSBhbW91bnQgdG8gdG9rZW4gbWludGVkIGZvciBhZmZpbGxpYXRlCiAgICAvLy8gQHBhcmFtIF9pbnZlc3RvciBhZGRyZXNzIG9mIHRoZSBpbnZlc3RvcgogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0b3JUb2tlbnMgYW1vdW50IG9mIFNIUCB0b2tlbnMgbWludGVkIGZvciBjb250cmlidXRvcgogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0aW9uVmFsdWUgYW1vdW50IG9mIEVUSCBjb250cmlidXRlZAogICAgLy8vIEByZXR1cm4gdHVwbGUgb2YgdHdvIHZhbHVlcyAoYWZmaWxpYXRlQm9udXMsIGNvbnRyaWJ1dG9yQm91bnMpCiAgICBmdW5jdGlvbiBhcHBseUFmZmlsaWF0ZSgKICAgICAgICBhZGRyZXNzIF9pbnZlc3RvciwgCiAgICAgICAgdWludDI1NiBfY29udHJpYnV0b3JUb2tlbnMsIAogICAgICAgIHVpbnQyNTYgX2NvbnRyaWJ1dGlvblZhbHVlCiAgICApCiAgICAgICAgcHVibGljIAogICAgICAgIHJldHVybnModWludDI1NiwgdWludDI1NikgCiAgICB7CiAgICAgICAgaWYgKGdldEFmZmlsaWF0ZShfaW52ZXN0b3IpID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV0dXJuICgwLCAwKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgY29udHJpYnV0b3JCb251cyA9IF9jb250cmlidXRvclRva2Vucy5kaXYoMTAwKTsKICAgICAgICB1aW50MjU2IGFmZmlsaWF0ZUJvbnVzID0gMDsKCiAgICAgICAgaWYgKF9jb250cmlidXRpb25WYWx1ZSA8IHRpZXJUd29NaW4pIHsKICAgICAgICAgICAgYWZmaWxpYXRlQm9udXMgPSBfY29udHJpYnV0b3JUb2tlbnMubXVsKFRJRVIxX1BFUkNFTlQpLmRpdigxMDApOwogICAgICAgIH0gZWxzZSBpZiAoX2NvbnRyaWJ1dGlvblZhbHVlID49IHRpZXJUd29NaW4gJiYgX2NvbnRyaWJ1dGlvblZhbHVlIDwgdGllclRocmVlTWluKSB7CiAgICAgICAgICAgIGFmZmlsaWF0ZUJvbnVzID0gX2NvbnRyaWJ1dG9yVG9rZW5zLm11bChUSUVSMl9QRVJDRU5UKS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhZmZpbGlhdGVCb251cyA9IF9jb250cmlidXRvclRva2Vucy5tdWwoVElFUjNfUEVSQ0VOVCkuZGl2KDEwMCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4oYWZmaWxpYXRlQm9udXMsIGNvbnRyaWJ1dG9yQm9udXMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEZldGNoZXMgdGhlIEV0aGVyZXVtIGFkZHJlc3Mgb2YgYSB2YWxpZCBhZmZpbGlhdGUKICAgIC8vLyBAcGFyYW0gX2ludmVzdG9yIFRoZSBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBpbnZlc3RvcgogICAgLy8vIEByZXR1cm4gVGhlIEV0aGVyZXVtIGFkZHJlc3MgYXMgYW4gYWRkcmVzcyB0eXBlCiAgICBmdW5jdGlvbiBnZXRBZmZpbGlhdGUoYWRkcmVzcyBfaW52ZXN0b3IpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhZmZpbGlhdGVzW19pbnZlc3Rvcl0uZXRoZXJBZGRyZXNzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiBhbiBhZmZpbGlhdGUgaXMgdmFsaWQKICAgIC8vLyBAcGFyYW0gX2ludmVzdG9yIFRoZSBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBpbnZlc3RvcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBvciBGYWxzZQogICAgZnVuY3Rpb24gaXNBZmZpbGlhdGVWYWxpZChhZGRyZXNzIF9pbnZlc3RvcikgY29uc3RhbnQgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIEFmZmlsaWF0ZSBtZW1vcnkgYWZmaWxpYXRlID0gYWZmaWxpYXRlc1tfaW52ZXN0b3JdOwogICAgICAgIEFmZmlsaWF0ZVJlY2VpdmVkKGFmZmlsaWF0ZS5ldGhlckFkZHJlc3MsIF9pbnZlc3RvciwgYWZmaWxpYXRlLmlzUHJlc2VudCk7CiAgICAgICAgcmV0dXJuIGFmZmlsaWF0ZS5pc1ByZXNlbnQ7CiAgICB9Cn0KCmNvbnRyYWN0IFNDRCBpcyBNaW5pTWVUb2tlbiB7CiAgICAvLyBAZGV2IFNDRCBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU0NEKGFkZHJlc3MgX3Rva2VuRmFjdG9yeSkKICAgICAgICAgICAgTWluaU1lVG9rZW4oCiAgICAgICAgICAgICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAgICAgICAgICAgMHgwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gcGFyZW50IHRva2VuCiAgICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBzbmFwc2hvdCBibG9jayBudW1iZXIgZnJvbSBwYXJlbnQKICAgICAgICAgICAgICAgICJTaGFycGUgQ3J5cHRvLURlcml2YXRpdmUiLCAgICAgIC8vIFRva2VuIG5hbWUKICAgICAgICAgICAgICAgIDE4LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY2ltYWxzCiAgICAgICAgICAgICAgICAiU0NEIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTeW1ib2wKICAgICAgICAgICAgICAgIHRydWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMKICAgICAgICAgICAgKSB7fQp9CgoKY29udHJhY3QgVG9rZW5TYWxlIGlzIE93bmVkLCBUb2tlbkNvbnRyb2xsZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIFNIUCBwdWJsaWMgc2hwOwogICAgQWZmaWxpYXRlVXRpbGl0eSBwdWJsaWMgYWZmaWxpYXRlVXRpbGl0eTsKICAgIFRydXN0ZWUgcHVibGljIHRydXN0ZWU7CgogICAgYWRkcmVzcyBwdWJsaWMgZXRoZXJFc2Nyb3dBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5QWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIHRydXN0ZWVBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgYXBpQWRkcmVzczsKCiAgICB1aW50MjU2IHB1YmxpYyBmb3VuZGVyVG9rZW5Db3VudCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyByZXNlcnZlVG9rZW5Db3VudCA9IDA7CgogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgQ0FMTEVSX0VYQ0hBTkdFX1JBVEUgPSAyMDAwOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgUkVTRVJWRV9FWENIQU5HRV9SQVRFID0gMTUwMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIEZPVU5ERVJfRVhDSEFOR0VfUkFURSA9IDEwMDA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBCT1VOVFlfRVhDSEFOR0VfUkFURSA9IDUwMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1BWF9HQVNfUFJJQ0UgPSA1MDAwMDAwMDAwMDsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQ7CiAgICBib29sIHB1YmxpYyBjbG9zZWQ7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBhcHByb3ZlZEFkZHJlc3NlczsKCiAgICBldmVudCBDb250cmlidXRpb24odWludDI1NiBldGhlckFtb3VudCwgYWRkcmVzcyBfY2FsbGVyKTsKICAgIGV2ZW50IE5ld1NhbGUoYWRkcmVzcyBpbmRleGVkIGNhbGxlciwgdWludDI1NiBldGhlckFtb3VudCwgdWludDI1NiB0b2tlbnNHZW5lcmF0ZWQpOwogICAgZXZlbnQgU2FsZUNsb3NlZCh1aW50MjU2IHdoZW4pOwogICAgCiAgICBtb2RpZmllciBub3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdENsb3NlZCgpIHsKICAgICAgICByZXF1aXJlKCFjbG9zZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFwaSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYXBpQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1ZhbGlkYXRlZCgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoIWlzQ29udHJhY3QobXNnLnNlbmRlcikpOyAKICAgICAgICByZXF1aXJlKHR4Lmdhc3ByaWNlIDw9IE1BWF9HQVNfUFJJQ0UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNBcHByb3ZlZCgpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmVkQWRkcmVzc2VzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFkZHMgYW4gYXBwcm92ZWQgYWRkcmVzcyBmb3IgdGhlIHNhbGUKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSBmb3IgY29udHJpYnV0aW9uCiAgICBmdW5jdGlvbiBhcHByb3ZlQWRkcmVzcyhhZGRyZXNzIF9hZGRyKSBwdWJsaWMgb25seUFwaSB7CiAgICAgICAgYXBwcm92ZWRBZGRyZXNzZXNbX2FkZHJdID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBzZW5kcyB0aGUgRXRoZXIgcmVjZWl2ZWQgdG8gdGhlIEV0aGVyIGVzY3JvdyBhZGRyZXNzCiAgICAvLy8gYW5kIGdlbmVyYXRlcyB0aGUgY2FsY3VsYXRlZCBudW1iZXIgb2YgU0hQIHRva2Vucywgc2VuZGluZyB0aGVtIHRvIHRoZSBjYWxsZXIncyBhZGRyZXNzLgogICAgLy8vIEl0IGFsc28gZ2VuZXJhdGVzIHRoZSBmb3VuZGVyJ3MgdG9rZW5zIGFuZCB0aGUgcmVzZXJ2ZSB0b2tlbnMgYXQgdGhlIHNhbWUgdGltZS4KICAgIGZ1bmN0aW9uIGRvQnV5KAogICAgICAgIGFkZHJlc3MgX2NhbGxlciwKICAgICAgICB1aW50MjU2IGV0aGVyQW1vdW50CiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKCiAgICAgICAgQ29udHJpYnV0aW9uKGV0aGVyQW1vdW50LCBfY2FsbGVyKTsKCiAgICAgICAgdWludDI1NiBjYWxsZXJUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoQ0FMTEVSX0VYQ0hBTkdFX1JBVEUpOwogICAgICAgIHVpbnQyNTYgY2FsbGVyVG9rZW5zV2l0aERpc2NvdW50ID0gYXBwbHlEaXNjb3VudChldGhlckFtb3VudCwgY2FsbGVyVG9rZW5zKTsKCiAgICAgICAgdWludDI1NiByZXNlcnZlVG9rZW5zID0gZXRoZXJBbW91bnQubXVsKFJFU0VSVkVfRVhDSEFOR0VfUkFURSk7CiAgICAgICAgdWludDI1NiBmb3VuZGVyVG9rZW5zID0gZXRoZXJBbW91bnQubXVsKEZPVU5ERVJfRVhDSEFOR0VfUkFURSk7CiAgICAgICAgdWludDI1NiBib3VudHlUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoQk9VTlRZX0VYQ0hBTkdFX1JBVEUpOwogICAgICAgIHVpbnQyNTYgdmVzdGluZ1Rva2VucyA9IGZvdW5kZXJUb2tlbnMuYWRkKHJlc2VydmVUb2tlbnMpOwoKICAgICAgICBmb3VuZGVyVG9rZW5Db3VudCA9IGZvdW5kZXJUb2tlbkNvdW50LmFkZChmb3VuZGVyVG9rZW5zKTsKICAgICAgICByZXNlcnZlVG9rZW5Db3VudCA9IHJlc2VydmVUb2tlbkNvdW50LmFkZChyZXNlcnZlVG9rZW5zKTsKCiAgICAgICAgcGF5QWZmaWxpYXRlKGNhbGxlclRva2Vuc1dpdGhEaXNjb3VudCwgbXNnLnZhbHVlLCBtc2cuc2VuZGVyKTsKCiAgICAgICAgc2hwLmdlbmVyYXRlVG9rZW5zKF9jYWxsZXIsIGNhbGxlclRva2Vuc1dpdGhEaXNjb3VudCk7CiAgICAgICAgc2hwLmdlbmVyYXRlVG9rZW5zKGJvdW50eUFkZHJlc3MsIGJvdW50eVRva2Vucyk7CiAgICAgICAgc2hwLmdlbmVyYXRlVG9rZW5zKHRydXN0ZWVBZGRyZXNzLCB2ZXN0aW5nVG9rZW5zKTsKCiAgICAgICAgTmV3U2FsZShfY2FsbGVyLCBldGhlckFtb3VudCwgY2FsbGVyVG9rZW5zV2l0aERpc2NvdW50KTsKICAgICAgICBOZXdTYWxlKHRydXN0ZWVBZGRyZXNzLCBldGhlckFtb3VudCwgdmVzdGluZ1Rva2Vucyk7CiAgICAgICAgTmV3U2FsZShib3VudHlBZGRyZXNzLCBldGhlckFtb3VudCwgYm91bnR5VG9rZW5zKTsKCiAgICAgICAgZXRoZXJFc2Nyb3dBZGRyZXNzLnRyYW5zZmVyKGV0aGVyQW1vdW50KTsKICAgICAgICB1cGRhdGVDb3VudGVycyhldGhlckFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQXBwbGllcyB0aGUgZGlzY291bnQgYmFzZWQgb24gdGhlIGRpc2NvdW50IHRpZXJzCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCBUaGUgYW1vdW50IG9mIGV0aGVyIHVzZWQgdG8gZXZhbHVhdGUgdGhlIHRpZXIgdGhlIGNvbnRyaWJ1dGlvbiBsaWVzIHdpdGhpbgogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0b3JUb2tlbnMgVGhlIHRva2VucyBhbGxvY2F0ZWQgYmFzZWQgb24gdGhlIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gYXBwbHlEaXNjb3VudCh1aW50MjU2IF9ldGhlckFtb3VudCwgdWludDI1NiBfY29udHJpYnV0b3JUb2tlbnMpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgdGhlIGNvdW50ZXJzIGZvciB0aGUgYW1vdW50IG9mIEV0aGVyIHBhaWQKICAgIC8vLyBAcGFyYW0gX2V0aGVyQW1vdW50IHRoZSBhbW91bnQgb2YgRXRoZXIgcGFpZAogICAgZnVuY3Rpb24gdXBkYXRlQ291bnRlcnModWludDI1NiBfZXRoZXJBbW91bnQpIGludGVybmFsOwogICAgCiAgICAvLy8gQG5vdGljZSBQYXJlbnQgY29uc3RydWN0b3IuIFRoaXMgbmVlZHMgdG8gYmUgZXh0ZW5kZWQgZnJvbSB0aGUgY2hpbGQgY29udHJhY3RzCiAgICAvLy8gQHBhcmFtIF9ldGhlckVzY3Jvd0FkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIGNyb3dkIGZ1bmRlZCBFdGhlcgogICAgLy8vIEBwYXJhbSBfYm91bnR5QWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgYm91bnR5IHNjaGVtZSBTSFAKICAgIC8vLyBAcGFyYW0gX3RydXN0ZWVBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSB2ZXN0aW5nIFNIUAogICAgLy8vIEBwYXJhbSBfYWZmaWxpYXRlVXRpbGl0eUFkZHJlc3MgYWRkcmVzcyBvZiB0aGUgZGVwbG95ZWQgQWZmaWxpYXRlVXRpbGl0eSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIFRva2VuU2FsZSAoCiAgICAgICAgYWRkcmVzcyBfZXRoZXJFc2Nyb3dBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX2JvdW50eUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfdHJ1c3RlZUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYWZmaWxpYXRlVXRpbGl0eUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYXBpQWRkcmVzcwogICAgKSB7CiAgICAgICAgZXRoZXJFc2Nyb3dBZGRyZXNzID0gX2V0aGVyRXNjcm93QWRkcmVzczsKICAgICAgICBib3VudHlBZGRyZXNzID0gX2JvdW50eUFkZHJlc3M7CiAgICAgICAgdHJ1c3RlZUFkZHJlc3MgPSBfdHJ1c3RlZUFkZHJlc3M7CiAgICAgICAgYXBpQWRkcmVzcyA9IF9hcGlBZGRyZXNzOwogICAgICAgIGFmZmlsaWF0ZVV0aWxpdHkgPSBBZmZpbGlhdGVVdGlsaXR5KF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcyk7CiAgICAgICAgdHJ1c3RlZSA9IFRydXN0ZWUoX3RydXN0ZWVBZGRyZXNzKTsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIGNsb3NlZCA9IGZhbHNlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFBheXMgYW4gYWZmaWxpYXRlIGlmIHRoZXkgYXJlIHZhbGlkIGFuZCBwcmVzZW50IGluIHRoZSB0cmFuc2FjdGlvbiBkYXRhCiAgICAvLy8gQHBhcmFtIF90b2tlbnMgVGhlIGNvbnRyaWJ1dGlvbiB0b2tlbnMgdXNlZCB0byBjYWxjdWxhdGUgYWZmaWxpYXRlIHBheW1lbnQgYW1vdW50CiAgICAvLy8gQHBhcmFtIF9ldGhlclZhbHVlIFRoZSBFdGhlciB2YWx1ZSBzZW50CiAgICAvLy8gQHBhcmFtIF9jYWxsZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNhbGxlcgogICAgZnVuY3Rpb24gcGF5QWZmaWxpYXRlKHVpbnQyNTYgX3Rva2VucywgdWludDI1NiBfZXRoZXJWYWx1ZSwgYWRkcmVzcyBfY2FsbGVyKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGFmZmlsaWF0ZVV0aWxpdHkuaXNBZmZpbGlhdGVWYWxpZChfY2FsbGVyKSkgewogICAgICAgICAgICBhZGRyZXNzIGFmZmlsaWF0ZSA9IGFmZmlsaWF0ZVV0aWxpdHkuZ2V0QWZmaWxpYXRlKF9jYWxsZXIpOwogICAgICAgICAgICB2YXIgKGFmZmlsaWF0ZUJvbnVzLCBjb250cmlidXRvckJvbnVzKSA9IGFmZmlsaWF0ZVV0aWxpdHkuYXBwbHlBZmZpbGlhdGUoX2NhbGxlciwgX3Rva2VucywgX2V0aGVyVmFsdWUpOwogICAgICAgICAgICBzaHAuZ2VuZXJhdGVUb2tlbnMoYWZmaWxpYXRlLCBhZmZpbGlhdGVCb251cyk7CiAgICAgICAgICAgIHNocC5nZW5lcmF0ZVRva2VucyhfY2FsbGVyLCBjb250cmlidXRvckJvbnVzKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0cyB0aGUgU0hQIHRva2VuIHNtYXJ0IGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9zaHAgdGhlIFNIUCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXRTaHAoYWRkcmVzcyBfc2hwKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzaHAgPSBTSFAoX3NocCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIG93bmVyc2hpcCBvZiB0aGUgdG9rZW4gc21hcnQgY29udHJhY3QgYW5kIHRydXN0ZWUKICAgIC8vLyBAcGFyYW0gX3Rva2VuQ29udHJvbGxlciB0aGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyb2xsZXIKICAgIC8vLyBAcGFyYW0gX3RydXN0ZWVPd25lciB0aGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRydXN0ZWUgb3duZXIKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX3Rva2VuQ29udHJvbGxlciwgYWRkcmVzcyBfdHJ1c3RlZU93bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKGNsb3NlZCk7CiAgICAgICAgcmVxdWlyZShfdG9rZW5Db250cm9sbGVyICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdHJ1c3RlZU93bmVyICE9IDB4MCk7CiAgICAgICAgc2hwLmNoYW5nZUNvbnRyb2xsZXIoX3Rva2VuQ29udHJvbGxlcik7CiAgICAgICAgdHJ1c3RlZS5jaGFuZ2VPd25lcihfdHJ1c3RlZU93bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9jYWxsZXIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgY2FsbGVyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2NhbGxlcikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBhc3NlbWJseSB7IHNpemUgOj0gZXh0Y29kZXNpemUoX2NhbGxlcikgfQogICAgICAgIHJldHVybiBzaXplID4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBQYXVzZXMgdGhlIGNvbnRyaWJ1dGlvbiBpZiB0aGVyZSBpcyBhbnkgaXNzdWUKICAgIGZ1bmN0aW9uIHBhdXNlQ29udHJpYnV0aW9uKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXN1bWVzIHRoZSBjb250cmlidXRpb24KICAgIGZ1bmN0aW9uIHJlc3VtZUNvbnRyaWJ1dGlvbigpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQoKICAgIC8vLy8vLy8vLy8KICAgIC8vIE1pbmlNZSBDb250cm9sbGVyIEludGVyZmFjZSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8KCiAgICAvLyBJbiBiZXR3ZWVuIHRoZSBvZmZlcmluZyBhbmQgdGhlIG5ldHdvcmsuIERlZmF1bHQgc2V0dGluZ3MgZm9yIGFsbG93aW5nIHRva2VuIHRyYW5zZmVycy4KICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcywgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CgoKY29udHJhY3QgU2hhcnBlQ3Jvd2RzYWxlIGlzIFRva2VuU2FsZSB7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxFdGhlclBhaWQgPSAwOwogICAgdWludDI1NiBwdWJsaWMgbWluQ29udHJpYnV0aW9uSW5XZWk7CiAgICBhZGRyZXNzIHB1YmxpYyBzYWxlQWRkcmVzczsKICAgIAogICAgRHluYW1pY0NlaWxpbmcgcHVibGljIGR5bmFtaWNDZWlsaW5nOwoKICAgIG1vZGlmaWVyIGFtb3VudFZhbGlkYXRlZCgpIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5Db250cmlidXRpb25JbldlaSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RzIHRoZSBjb250cmFjdCB3aXRoIHRoZSBmb2xsb3dpbmcgYXJndW1lbnRzCiAgICAvLy8gQHBhcmFtIF9ldGhlckVzY3Jvd0FkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIGNyb3dkIGZ1bmRlZCBFdGhlcgogICAgLy8vIEBwYXJhbSBfYm91bnR5QWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgYm91bnR5IFNIUAogICAgLy8vIEBwYXJhbSBfdHJ1c3RlZUFkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIHZlc3RpbmcgU0hQCiAgICAvLy8gQHBhcmFtIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcyBhZGRyZXNzIG9mIHRoZSBkZXBsb3llZCBBZmZpbGlhdGVVdGlsaXR5IGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfbWluQ29udHJpYnV0aW9uSW5XZWkgbWluaW11bSBhbW91bnQgdG8gY29udHJpYnV0aW9uIHBvc3NpbGJsZQogICAgZnVuY3Rpb24gU2hhcnBlQ3Jvd2RzYWxlKCAKICAgICAgICBhZGRyZXNzIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYm91bnR5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90cnVzdGVlQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9hcGlBZGRyZXNzLAogICAgICAgIHVpbnQyNTYgX21pbkNvbnRyaWJ1dGlvbkluV2VpKSAKICAgICAgICBUb2tlblNhbGUgKAogICAgICAgIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgX2JvdW50eUFkZHJlc3MsCiAgICAgICAgX3RydXN0ZWVBZGRyZXNzLAogICAgICAgIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcywKICAgICAgICBfYXBpQWRkcmVzcykgCiAgICB7CiAgICAgICAgbWluQ29udHJpYnV0aW9uSW5XZWkgPSBfbWluQ29udHJpYnV0aW9uSW5XZWk7CiAgICAgICAgc2FsZUFkZHJlc3MgPSBhZGRyZXNzKHRoaXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldER5bmFtaWNDZWlsaW5nQWRkcmVzcyhhZGRyZXNzIF9keW5hbWljQ2VpbGluZ0FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGR5bmFtaWNDZWlsaW5nID0gRHluYW1pY0NlaWxpbmcoX2R5bmFtaWNDZWlsaW5nQWRkcmVzcyk7CiAgICB9CgogICAgZnVuY3Rpb24gKCkgCiAgICAgICAgcHVibGljIAogICAgICAgIHBheWFibGUKICAgICAgICBub3RQYXVzZWQKICAgICAgICBub3RDbG9zZWQKICAgICAgICBpc1ZhbGlkYXRlZCAKICAgICAgICBhbW91bnRWYWxpZGF0ZWQKICAgICAgICBpc0FwcHJvdmVkCiAgICB7CiAgICAgICAgdWludDI1NiBjb250cmlidXRpb24gPSBtc2cudmFsdWU7CiAgICAgICAgdWludDI1NiByZW1haW5pbmcgPSBkeW5hbWljQ2VpbGluZy5hdmFpbGFibGVBbW91bnRUb0NvbGxlY3QodG90YWxFdGhlclBhaWQpOwogICAgICAgIHVpbnQyNTYgcmVmdW5kID0gMDsKCiAgICAgICAgaWYgKHJlbWFpbmluZyA9PSAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRyaWJ1dGlvbiA+IHJlbWFpbmluZykgewogICAgICAgICAgICBjb250cmlidXRpb24gPSByZW1haW5pbmc7CiAgICAgICAgICAgIHJlZnVuZCA9IG1zZy52YWx1ZS5zdWIoY29udHJpYnV0aW9uKTsKICAgICAgICB9CiAgICAgICAgZG9CdXkobXNnLnNlbmRlciwgY29udHJpYnV0aW9uKTsKICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIEFwcGxpZXMgdGhlIGRpc2NvdW50IGJhc2VkIG9uIHRoZSBkaXNjb3VudCB0aWVycwogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgVGhlIGFtb3VudCBvZiBldGhlciB1c2VkIHRvIGV2YWx1YXRlIHRoZSB0aWVyIHRoZSBjb250cmlidXRpb24gbGllcyB3aXRoaW4KICAgIC8vLyBAcGFyYW0gX2NvbnRyaWJ1dG9yVG9rZW5zIFRoZSB0b2tlbnMgYWxsb2NhdGVkIGJhc2VkIG9uIHRoZSBjb250cmlidXRpb24KICAgIGZ1bmN0aW9uIGFwcGx5RGlzY291bnQodWludDI1NiBfZXRoZXJBbW91bnQsIHVpbnQyNTYgX2NvbnRyaWJ1dG9yVG9rZW5zKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF9jb250cmlidXRvclRva2VuczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBVcGRhdGVzIHRoZSBjb3VudGVycyBmb3IgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCB0aGUgYW1vdW50IG9mIEV0aGVyIHBhaWQKICAgIGZ1bmN0aW9uIHVwZGF0ZUNvdW50ZXJzKHVpbnQyNTYgX2V0aGVyQW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgdG90YWxFdGhlclBhaWQgPSB0b3RhbEV0aGVyUGFpZC5hZGQoX2V0aGVyQW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBQdWJsaWMgZnVuY3Rpb24gZW5hYmxlcyBjbG9zaW5nIG9mIHRoZSBjcm93ZHNhbGUgbWFudWFsbHkgaWYgbmVjZXNzYXJ5CiAgICBmdW5jdGlvbiBjbG9zZVNhbGUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBjbG9zZWQgPSB0cnVlOwogICAgICAgIFNhbGVDbG9zZWQobm93KTsKICAgIH0KfQ=='.
	

]
