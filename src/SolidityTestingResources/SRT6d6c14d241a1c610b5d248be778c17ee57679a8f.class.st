Class {
	#name : #SRT6d6c14d241a1c610b5d248be778c17ee57679a8f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6d6c14d241a1c610b5d248be778c17ee57679a8f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7Cgpjb250cmFjdCBTYWZlTWF0aCB7CiAgICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgICAgdWludCBjID0gYSAqIGI7CiAgICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgICAgcmV0dXJuIGM7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICAgICAgICByZXR1cm4gYzsKICAgICB9Cn0KCi8vIEVSQzIwIHN0YW5kYXJkCi8vIFdlIGRvbid0IHVzZSBFUkMyMyBzdGFuZGFyZApjb250cmFjdCBTdGRUb2tlbiBpcyBTYWZlTWF0aCB7Ci8vIEZpZWxkczoKICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsKCi8vIEV2ZW50czoKICAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCi8vIEZ1bmN0aW9uczoKICAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHJldHVybnMoYm9vbCl7CiAgICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sX3ZhbHVlKTsKICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sX3ZhbHVlKTsKCiAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICB9CgogICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMoYm9vbCl7CiAgICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgICAgcmVxdWlyZShhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSxfdmFsdWUpOwogICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sX3ZhbHVlKTsKICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSxfdmFsdWUpOwoKICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICAgfQoKICAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQoKICAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgIH0KCiAgICAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgX3NpemUpIHsKICAgICAgICAgIHJlcXVpcmUobXNnLmRhdGEubGVuZ3RoID49IF9zaXplICsgNCk7CiAgICAgICAgICBfOwogICAgIH0KfQoKY29udHJhY3QgTU5UUCBpcyBTdGRUb2tlbiB7Ci8vIEZpZWxkczoKICAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiR29sZG1pbnQgTU5UIFByZWxhdW5jaCBUb2tlbiI7CiAgICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiTU5UUCI7CiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvciA9IDB4MDsKICAgICBhZGRyZXNzIHB1YmxpYyBpY29Db250cmFjdEFkZHJlc3MgPSAweDA7CiAgICAgYm9vbCBwdWJsaWMgbG9ja1RyYW5zZmVycyA9IGZhbHNlOwoKICAgICAvLyAxMCBtbG4KICAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUT1RBTF9UT0tFTl9TVVBQTFkgPSAxMDAwMDAwMCAqIDEgZXRoZXI7CgovLy8gTW9kaWZpZXJzOgogICAgIG1vZGlmaWVyIG9ubHlDcmVhdG9yKCkgeyAKICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcmVhdG9yKTsgCiAgICAgICAgICBfOyAKICAgICB9CgogICAgIG1vZGlmaWVyIGJ5SWNvQ29udHJhY3QoKSB7IAogICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGljb0NvbnRyYWN0QWRkcmVzcyk7IAogICAgICAgICAgXzsgCiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRDcmVhdG9yKGFkZHJlc3MgX2NyZWF0b3IpIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIGNyZWF0b3IgPSBfY3JlYXRvcjsKICAgICB9CgovLyBTZXR0ZXJzL0dldHRlcnMKICAgICBmdW5jdGlvbiBzZXRJY29Db250cmFjdEFkZHJlc3MoYWRkcmVzcyBfaWNvQ29udHJhY3RBZGRyZXNzKSBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBpY29Db250cmFjdEFkZHJlc3MgPSBfaWNvQ29udHJhY3RBZGRyZXNzOwogICAgIH0KCi8vIEZ1bmN0aW9uczoKICAgICBmdW5jdGlvbiBNTlRQKCkgewogICAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CgogICAgICAgICAgYXNzZXJ0KFRPVEFMX1RPS0VOX1NVUFBMWSA9PSAxMDAwMDAwMCAqIDEgZXRoZXIpOwogICAgIH0KCiAgICAgLy8vIEBkZXYgT3ZlcnJpZGUKICAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wpewogICAgICAgICAgcmVxdWlyZSghbG9ja1RyYW5zZmVycyk7CiAgICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLF92YWx1ZSk7CiAgICAgfQoKICAgICAvLy8gQGRldiBPdmVycmlkZQogICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wpewogICAgICAgICAgcmVxdWlyZSghbG9ja1RyYW5zZmVycyk7CiAgICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLF90byxfdmFsdWUpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpIGJ5SWNvQ29udHJhY3QgewogICAgICAgICAgcmVxdWlyZSgodG90YWxTdXBwbHkgKyBfdG9rZW5zKSA8PSBUT1RBTF9UT0tFTl9TVVBQTFkpOwoKICAgICAgICAgIGJhbGFuY2VzW193aG9dID0gc2FmZUFkZChiYWxhbmNlc1tfd2hvXSxfdG9rZW5zKTsKICAgICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSxfdG9rZW5zKTsKCiAgICAgICAgICBUcmFuc2ZlcigweDAsIF93aG8sIF90b2tlbnMpOwogICAgIH0KCiAgICAgLy8gRm9yIHJlZnVuZHMgb25seQogICAgIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpIGJ5SWNvQ29udHJhY3QgewogICAgICAgICAgYmFsYW5jZXNbX3dob10gPSBzYWZlU3ViKGJhbGFuY2VzW193aG9dLCBfdG9rZW5zKTsKICAgICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgX3Rva2Vucyk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBsb2NrVHJhbnNmZXIoYm9vbCBfbG9jaykgYnlJY29Db250cmFjdCB7CiAgICAgICAgICBsb2NrVHJhbnNmZXJzID0gX2xvY2s7CiAgICAgfQoKICAgICAvLyBEbyBub3QgYWxsb3cgdG8gc2VuZCBtb25leSBkaXJlY3RseSB0byB0aGlzIGNvbnRyYWN0CiAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXZlcnQoKTsKICAgICB9Cn0KCi8vIFRoaXMgY29udHJhY3Qgd2lsbCBob2xkIGFsbCB0b2tlbnMgdGhhdCB3ZXJlIHVuc29sZCBkdXJpbmcgSUNPLgovLwovLyBHb2xkbWludCBUZWFtIHNob3VsZCBiZSBhYmxlIHRvIHdpdGhkcmF3IHRoZW0gYW5kIHNlbGwgb25seSBhZnRlciAxIHllYXIgaXMgcGFzc2VkIGFmdGVyIAovLyBJQ08gaXMgZmluaXNoZWQuCmNvbnRyYWN0IEdvbGRtaW50VW5zb2xkIGlzIFNhZmVNYXRoIHsKICAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yOwogICAgIGFkZHJlc3MgcHVibGljIHRlYW1BY2NvdW50QWRkcmVzczsKICAgICBhZGRyZXNzIHB1YmxpYyBpY29Db250cmFjdEFkZHJlc3M7CiAgICAgdWludDY0IHB1YmxpYyBpY29Jc0ZpbmlzaGVkRGF0ZTsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47CgogICAgIGZ1bmN0aW9uIEdvbGRtaW50VW5zb2xkKGFkZHJlc3MgX3RlYW1BY2NvdW50QWRkcmVzcyxhZGRyZXNzIF9tbnRUb2tlbkFkZHJlc3MpewogICAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICB0ZWFtQWNjb3VudEFkZHJlc3MgPSBfdGVhbUFjY291bnRBZGRyZXNzOwoKICAgICAgICAgIG1udFRva2VuID0gTU5UUChfbW50VG9rZW5BZGRyZXNzKTsgICAgICAgICAgCiAgICAgfQoKICAgICBtb2RpZmllciBvbmx5Q3JlYXRvcigpIHsgCiAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PWNyZWF0b3IpOyAKICAgICAgICAgIF87IAogICAgIH0KCiAgICAgbW9kaWZpZXIgb25seUljb0NvbnRyYWN0KCkgeyAKICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09aWNvQ29udHJhY3RBZGRyZXNzKTsgCiAgICAgICAgICBfOyAKICAgICB9CgovLyBTZXR0ZXJzL0dldHRlcnMKICAgICBmdW5jdGlvbiBzZXRJY29Db250cmFjdEFkZHJlc3MoYWRkcmVzcyBfaWNvQ29udHJhY3RBZGRyZXNzKSBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBpY29Db250cmFjdEFkZHJlc3MgPSBfaWNvQ29udHJhY3RBZGRyZXNzOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZmluaXNoSWNvKCkgcHVibGljIG9ubHlJY29Db250cmFjdCB7CiAgICAgICAgICBpY29Jc0ZpbmlzaGVkRGF0ZSA9IHVpbnQ2NChub3cpOwogICAgIH0KCiAgICAgLy8gY2FuIGJlIGNhbGxlZCBieSBhbnlvbmUuLi4KICAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucygpIHB1YmxpYyB7CiAgICAgICAgICAvLyBDaGVjayBpZiAxIHllYXIgaXMgcGFzc2VkCiAgICAgICAgICB1aW50NjQgb25lWWVhclBhc3NlZCA9IGljb0lzRmluaXNoZWREYXRlICsgMzY1IGRheXM7ICAKICAgICAgICAgIHJlcXVpcmUodWludChub3cpID49IG9uZVllYXJQYXNzZWQpOwoKICAgICAgICAgIC8vIFRyYW5zZmVyIGFsbCB0b2tlbnMgZnJvbSB0aGlzIGNvbnRyYWN0IHRvIHRoZSB0ZWFtQWNjb3VudEFkZHJlc3MKICAgICAgICAgIHVpbnQgdG90YWwgPSBtbnRUb2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICBtbnRUb2tlbi50cmFuc2Zlcih0ZWFtQWNjb3VudEFkZHJlc3MsdG90YWwpOwogICAgIH0KCiAgICAgLy8gRG8gbm90IGFsbG93IHRvIHNlbmQgbW9uZXkgZGlyZWN0bHkgdG8gdGhpcyBjb250cmFjdAogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgICByZXZlcnQoKTsKICAgICB9Cn0KCmNvbnRyYWN0IEZvdW5kZXJzVmVzdGluZyBpcyBTYWZlTWF0aCB7CiAgICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvcjsKICAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtQWNjb3VudEFkZHJlc3M7CiAgICAgdWludDY0IHB1YmxpYyBsYXN0V2l0aGRyYXdUaW1lOwoKICAgICB1aW50IHB1YmxpYyB3aXRoZHJhd3NDb3VudCA9IDA7CiAgICAgdWludCBwdWJsaWMgYW1vdW50VG9TZW5kID0gMDsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47CgogICAgIGZ1bmN0aW9uIEZvdW5kZXJzVmVzdGluZyhhZGRyZXNzIF90ZWFtQWNjb3VudEFkZHJlc3MsYWRkcmVzcyBfbW50VG9rZW5BZGRyZXNzKXsKICAgICAgICAgIHRlYW1BY2NvdW50QWRkcmVzcyA9IF90ZWFtQWNjb3VudEFkZHJlc3M7CiAgICAgICAgICBsYXN0V2l0aGRyYXdUaW1lID0gdWludDY0KG5vdyk7CgogICAgICAgICAgbW50VG9rZW4gPSBNTlRQKF9tbnRUb2tlbkFkZHJlc3MpOyAgICAgICAgICAKCiAgICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKICAgICB9CgogICAgIG1vZGlmaWVyIG9ubHlDcmVhdG9yKCkgeyAKICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09Y3JlYXRvcik7IAogICAgICAgICAgXzsgCiAgICAgfQoKICAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucygpIG9ubHlDcmVhdG9yIHB1YmxpYyB7CiAgICAgICAgICAvLyAxIC0gd2FpdCBmb3IgdGhlIG5leHQgbW9udGgKICAgICAgICAgIHVpbnQ2NCBvbmVNb250aCA9IGxhc3RXaXRoZHJhd1RpbWUgKyAzMCBkYXlzOyAgCiAgICAgICAgICByZXF1aXJlKHVpbnQobm93KSA+PSBvbmVNb250aCk7CgogICAgICAgICAgLy8gMiAtIGNhbGN1bGF0ZSBhbW91bnQgKG9ubHkgZmlyc3QgdGltZSkKICAgICAgICAgIGlmKHdpdGhkcmF3c0NvdW50PT0wKXsKICAgICAgICAgICAgICAgYW1vdW50VG9TZW5kID0gbW50VG9rZW4uYmFsYW5jZU9mKHRoaXMpIC8gMTA7CiAgICAgICAgICB9CgogICAgICAgICAgcmVxdWlyZShhbW91bnRUb1NlbmQhPTApOwoKICAgICAgICAgIC8vIDMgLSBzZW5kIDEvMTB0aAogICAgICAgICAgdWludCBjdXJyZW50QmFsYW5jZSA9IG1udFRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICAgIGlmKGN1cnJlbnRCYWxhbmNlPGFtb3VudFRvU2VuZCl7CiAgICAgICAgICAgICBhbW91bnRUb1NlbmQgPSBjdXJyZW50QmFsYW5jZTsgIAogICAgICAgICAgfQogICAgICAgICAgbW50VG9rZW4udHJhbnNmZXIodGVhbUFjY291bnRBZGRyZXNzLGFtb3VudFRvU2VuZCk7CgogICAgICAgICAgLy8gNCAtIHVwZGF0ZSBjb3VudGVyCiAgICAgICAgICB3aXRoZHJhd3NDb3VudCsrOwogICAgICAgICAgbGFzdFdpdGhkcmF3VGltZSA9IHVpbnQ2NChub3cpOwogICAgIH0KCiAgICAgLy8gRG8gbm90IGFsbG93IHRvIHNlbmQgbW9uZXkgZGlyZWN0bHkgdG8gdGhpcyBjb250cmFjdAogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgICByZXZlcnQoKTsKICAgICB9Cn0KCi8vIFRoaXMgaXMgdGhlIG1haW4gR29sZG1pbnQgSUNPIHNtYXJ0IGNvbnRyYWN0CmNvbnRyYWN0IEdvbGRtaW50IGlzIFNhZmVNYXRoIHsKLy8gQ29uc3RhbnRzOgogICAgIC8vIFRoZXNlIHZhbHVlcyBhcmUgSEFSRCBDT0RFRCEhIQogICAgIC8vIEZvciBleHRyYSBzZWN1cml0eSB3ZSBzcGxpdCBzaW5nbGUgbXVsdGlzaWcgd2FsbGV0IGludG8gMTAgc2VwYXJhdGUgbXVsdGlzaWcgd2FsbGV0cwogICAgIC8vCiAgICAgLy8gVEhJUyBJUyBBIFJFQUwgSUNPIFdBTExFVFMhISEKICAgICAvLyBQTEVBU0UgRE9VQkxFIENIRUNLIFRIQVQuLi4KICAgICBhZGRyZXNzW10gcHVibGljIG11bHRpc2lncyA9IFsKICAgICAgICAgIDB4Y2VjNDJlMjQ3MDk3YzI3NmFkM2Q3Y2ZkMjcwYWRiZDU2MmRhNWM2MSwKICAgICAgICAgIDB4MzczYzQ2YzU0NDY2MmI4YzVkNTVjMjRjZjRmOWE1MDIwMTYzZWMyZiwKICAgICAgICAgIDB4NjcyY2Y4MjkyNzIzMzlhNmM4YzExYjE0YWNjNWY5ZDA3YmFmYWM3YywKICAgICAgICAgIDB4Y2UwZTE5ODFhMTlhNTdhZTgwOGE3NTc1YTY3MzhlNDUyN2ZiOTExOCwKICAgICAgICAgIDB4OTNhYTc2Y2RiMTdlZWE4MGU0ZGU5ODMxMDhlZjU3NWQ4ZmM4ZjEyYiwKICAgICAgICAgIDB4MjBhZTMzMjljZDFlMzVmZWZmNzExNWI0NjIxOGM5ZDA1NmQ0MzBmZCwKICAgICAgICAgIDB4ZTlmYzFhNTdhNWRjMWNhYTNkZTIyYTk0MGU5ZjA5ZTY0MDYxNWY3ZSwKICAgICAgICAgIDB4ZDM2MDQzMzk1MGRlOWY2ZmEwZTkzYzI5NDI1ODQ1ZWVkNmJmYTBkMCwKICAgICAgICAgIDB4ZjBkZTk3ZWFmZjVkNmM5OThjODBlMDc3NDZjODFhMzM2ZTFiYmQ0MywKICAgICAgICAgIDB4ODBiMzY1ZGExQzE4ZjRhYTFlY0ZhMGRGQTA3RWQ0NDE3QjA1Q2M2OQogICAgIF07CgogICAgIC8vIFdlIGNvdW50IEVUSCBpbnZlc3RlZCBieSBwZXJzb24sIGZvciByZWZ1bmRzIChzZWUgYmVsb3cpCiAgICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGV0aEludmVzdGVkQnk7CiAgICAgdWludCBjb2xsZWN0ZWRXZWkgPSAwOwoKICAgICAvLyBUaGVzZSBjYW4gYmUgY2hhbmdlZCBiZWZvcmUgSUNPIHN0YXJ0cyAoJDdVU0QvTU5UUCkKICAgICB1aW50IGNvbnN0YW50IFNURF9QUklDRV9VU0RfUEVSXzEwMDBfVE9LRU5TID0gNzAwMDsKCiAgICAgLy8gVGhlIFVTRC9FVEggZXhjaGFuZ2UgcmF0ZSBtYXkgYmUgY2hhbmdlZCBldmVyeSBob3VyIGFuZCBjYW4gdmFyeSBmcm9tICQxMDAgdG8gJDcwMCBkZXBlbmRpbmcgb24gdGhlIG1hcmtldC4gVGhlIGV4Y2hhbmdlIHJhdGUgaXMgcmV0cmlldmVkIGZyb20gY29pbm1hcmtldGNhcC5jb20gc2l0ZSBhbmQgaXMgcm91bmRlZCB0byAkMSBkb2xsYXIuIEZvciBleGFtcGxlIGlmIGN1cnJlbnQgbWFya2V0Y2FwIHByaWNlIGlzICQzMDYuMTIzIHBlciBFVEgsIHRoZSBwcmljZSBpcyBzZXQgYXMgJDMwNiB0byB0aGUgY29udHJhY3QuCiAgICAgdWludCBwdWJsaWMgdXNkUGVyRXRoQ29pbm1hcmtldGNhcFJhdGUgPSAzMDA7CiAgICAgdWludDY0IHB1YmxpYyBsYXN0VXNkUGVyRXRoQ2hhbmdlRGF0ZSA9IDA7CgogICAgIC8vIFByaWNlIGNoYW5nZXMgZnJvbSBibG9jayB0byBibG9jawogICAgIC8vdWludCBjb25zdGFudCBTSU5HTEVfQkxPQ0tfTEVOID0gNzAwMDAwOwogICAgIC8vIFRPRE86IGZvciB0ZXN0CiAgICAgdWludCBjb25zdGFudCBTSU5HTEVfQkxPQ0tfTEVOID0gMTAwOwoKICAgICAvLyAxIDAwMCAwMDAgdG9rZW5zCiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgQk9OVVNfUkVXQVJEID0gMTAwMDAwMCAqIDEgZXRoZXI7CiAgICAgLy8gMiAwMDAgMDAwIHRva2VucwogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IEZPVU5ERVJTX1JFV0FSRCA9IDIwMDAwMDAgKiAxIGV0aGVyOwogICAgIC8vIDcgMDAwIDAwMCBpcyBzb2xkIGR1cmluZyB0aGUgSUNPCiAgICAgLy91aW50IHB1YmxpYyBjb25zdGFudCBJQ09fVE9LRU5fU1VQUExZX0xJTUlUID0gNzAwMDAwMCAqIDEgZXRoZXI7CgogICAgIC8vIFRPRE86IGZvciB0ZXN0cyBvbmx5IQogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IElDT19UT0tFTl9TVVBQTFlfTElNSVQgPSAyNTAgKiAxIGV0aGVyOwoKICAgICAvLyAxNTAgMDAwIHRva2VucyBzb2Z0IGNhcCAob3RoZXJ3aXNlIC0gcmVmdW5kKQogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IElDT19UT0tFTl9TT0ZUX0NBUCA9IDE1MDAwMCAqIDEgZXRoZXI7CgogICAgIC8vIDMgMDAwIDAwMCBjYW4gYmUgaXNzdWVkIGZyb20gb3RoZXIgY3VycmVuY2llcwogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9JU1NVRURfRlJPTV9PVEhFUl9DVVJSRU5DSUVTID0gMzAwMDAwMCAqIDEgZXRoZXI7CiAgICAgLy8gMzAgMDAwIE1OVFAgdG9rZW5zIHBlciBvbmUgY2FsbCBvbmx5CiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX1NJTkdMRV9JU1NVRURfRlJPTV9PVEhFUl9DVVJSRU5DSUVTID0gMzAwMDAgKiAxIGV0aGVyOwogICAgIHVpbnQgcHVibGljIGlzc3VlZEZyb21PdGhlckN1cnJlbmNpZXMgPSAwOwoKLy8gRmllbGRzOgogICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3IgPSAweDA7ICAgICAgICAgICAgICAgIC8vIGNhbiBub3QgYmUgY2hhbmdlZCBhZnRlciBkZXBsb3kKICAgICBhZGRyZXNzIHB1YmxpYyBldGhSYXRlQ2hhbmdlciA9IDB4MDsgICAgICAgICAvLyBjYW4gbm90IGJlIGNoYW5nZWQgYWZ0ZXIgZGVwbG95CiAgICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5NYW5hZ2VyID0gMHgwOyAgICAgICAgICAgLy8gY2FuIGJlIGNoYW5nZWQgYnkgdG9rZW4gbWFuYWdlciBvbmx5CiAgICAgYWRkcmVzcyBwdWJsaWMgb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciA9IDB4MDsgLy8gY2FuIG5vdCBiZSBjaGFuZ2VkIGFmdGVyIGRlcGxveQoKICAgICB1aW50NjQgcHVibGljIGljb1N0YXJ0ZWRUaW1lID0gMDsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47IAoKICAgICBHb2xkbWludFVuc29sZCBwdWJsaWMgdW5zb2xkQ29udHJhY3Q7CgogICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCBkdXJpbmcgSUNPCiAgICAgdWludCBwdWJsaWMgaWNvVG9rZW5zU29sZCA9IDA7CiAgICAgLy8gVG90YWwgYW1vdW50IG9mIHRva2VucyBzZW50IHRvIEdvbGRtaW50VW5zb2xkIGNvbnRyYWN0IGFmdGVyIElDTyBpcyBmaW5pc2hlZAogICAgIHVpbnQgcHVibGljIGljb1Rva2Vuc1Vuc29sZCA9IDA7CiAgICAgLy8gVG90YWwgbnVtYmVyIG9mIHRva2VucyB0aGF0IHdlcmUgaXNzdWVkIGJ5IGEgc2NyaXB0cwogICAgIHVpbnQgcHVibGljIGlzc3VlZEV4dGVybmFsbHlUb2tlbnMgPSAwOwogICAgIC8vIFRoaXMgaXMgd2hlcmUgRk9VTkRFUlNfUkVXQVJEIHdpbGwgYmUgYWxsb2NhdGVkCiAgICAgYWRkcmVzcyBwdWJsaWMgZm91bmRlcnNSZXdhcmRzQWNjb3VudCA9IDB4MDsKCiAgICAgZW51bSBTdGF0ZXsKICAgICAgICAgIEluaXQsCgogICAgICAgICAgSUNPUnVubmluZywKICAgICAgICAgIElDT1BhdXNlZCwKCiAgICAgICAgICAvLyBDb2xsZWN0ZWQgRVRIIGlzIHRyYW5zZmVycmVkIHRvIG11bHRpc2lncy4KICAgICAgICAgIC8vIFVuc29sZCB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gR29sZG1pbnRVbnNvbGQgY29udHJhY3QuCiAgICAgICAgICBJQ09GaW5pc2hlZCwKCiAgICAgICAgICAvLyBXZSBzdGFydCB0byByZWZ1bmQgaWYgU29mdCBDYXAgaXMgbm90IHJlYWNoZWQuCiAgICAgICAgICAvLyBUaGVuIGVhY2ggdG9rZW4gaG9sZGVyIHNob3VsZCByZXF1ZXN0IGEgcmVmdW5kIHBlcnNvbmFsbHkgZnJvbSBoaXMKICAgICAgICAgIC8vIHBlcnNvbmFsIHdhbGxldC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBXZSB3aWxsIHJldHVybiBFVEhzIG9ubHkgdG8gdGhlIG9yaWdpbmFsIGFkZHJlc3MuIElmIHlvdXIgYWRkcmVzcyBpcyBjaGFuZ2VkCiAgICAgICAgICAvLyBvciB5b3UgaGF2ZSBsb3N0IHlvdXIga2V5cyAtPiB5b3Ugd2lsbCBub3QgYmUgYWJsZSB0byBnZXQgYSByZWZ1bmQuCiAgICAgICAgICAvLyAKICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGFueSBwb3NzaWJpbGl0eSB0byB0cmFuc2ZlciB0b2tlbnMKICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGFueSBwb3NzaWJpbGl0eSB0byBtb3ZlIGJhY2sKICAgICAgICAgIFJlZnVuZGluZywKCiAgICAgICAgICAvLyBJbiB0aGlzIHN0YXRlIHdlIGxvY2sgYWxsIE1OVCB0b2tlbnMgZm9yZXZlci4KICAgICAgICAgIC8vIFdlIGFyZSBnb2luZyB0byBtaWdyYXRlIE1OVFAgLT4gTU5UIHRva2VucyBkdXJpbmcgdGhpcyBzdGFnZS4gCiAgICAgICAgICAvLyAKICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGFueSBwb3NzaWJpbGl0eSB0byB0cmFuc2ZlciB0b2tlbnMKICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGFueSBwb3NzaWJpbGl0eSB0byBtb3ZlIGJhY2sKICAgICAgICAgIE1pZ3JhdGluZwogICAgIH0KICAgICBTdGF0ZSBwdWJsaWMgY3VycmVudFN0YXRlID0gU3RhdGUuSW5pdDsKCi8vIE1vZGlmaWVyczoKICAgICBtb2RpZmllciBvbmx5Q3JlYXRvcigpIHsgCiAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PWNyZWF0b3IpOyAKICAgICAgICAgIF87IAogICAgIH0KICAgICBtb2RpZmllciBvbmx5VG9rZW5NYW5hZ2VyKCkgeyAKICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09dG9rZW5NYW5hZ2VyKTsgCiAgICAgICAgICBfOyAKICAgICB9CiAgICAgbW9kaWZpZXIgb25seU90aGVyQ3VycmVuY2llc0NoZWNrZXIoKSB7IAogICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyPT1vdGhlckN1cnJlbmNpZXNDaGVja2VyKTsgCiAgICAgICAgICBfOyAKICAgICB9CiAgICAgbW9kaWZpZXIgb25seUV0aFNldHRlcigpIHsgCiAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PWV0aFJhdGVDaGFuZ2VyKTsgCiAgICAgICAgICBfOyAKICAgICB9CgogICAgIG1vZGlmaWVyIG9ubHlJblN0YXRlKFN0YXRlIHN0YXRlKXsgCiAgICAgICAgICByZXF1aXJlKHN0YXRlPT1jdXJyZW50U3RhdGUpOyAKICAgICAgICAgIF87IAogICAgIH0KCi8vIEV2ZW50czoKICAgICBldmVudCBMb2dTdGF0ZVN3aXRjaChTdGF0ZSBuZXdTdGF0ZSk7CiAgICAgZXZlbnQgTG9nQnV5KGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCB2YWx1ZSk7CiAgICAgZXZlbnQgTG9nQnVybihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUpOwogICAgIAovLyBGdW5jdGlvbnM6CiAgICAgLy8vIEBkZXYgQ29uc3RydWN0b3IKICAgICBmdW5jdGlvbiBHb2xkbWludCgKICAgICAgICAgIGFkZHJlc3MgX3Rva2VuTWFuYWdlciwKICAgICAgICAgIGFkZHJlc3MgX2V0aFJhdGVDaGFuZ2VyLAogICAgICAgICAgYWRkcmVzcyBfb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciwKCiAgICAgICAgICBhZGRyZXNzIF9tbnRUb2tlbkFkZHJlc3MsCiAgICAgICAgICBhZGRyZXNzIF91bnNvbGRDb250cmFjdEFkZHJlc3MsCiAgICAgICAgICBhZGRyZXNzIF9mb3VuZGVyc1Zlc3RpbmdBZGRyZXNzKQogICAgIHsKICAgICAgICAgIGNyZWF0b3IgPSBtc2cuc2VuZGVyOwoKICAgICAgICAgIHRva2VuTWFuYWdlciA9IF90b2tlbk1hbmFnZXI7CiAgICAgICAgICBldGhSYXRlQ2hhbmdlciA9IF9ldGhSYXRlQ2hhbmdlcjsKICAgICAgICAgIGxhc3RVc2RQZXJFdGhDaGFuZ2VEYXRlID0gdWludDY0KG5vdyk7CgogICAgICAgICAgb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciA9IF9vdGhlckN1cnJlbmNpZXNDaGVja2VyOyAKCiAgICAgICAgICBtbnRUb2tlbiA9IE1OVFAoX21udFRva2VuQWRkcmVzcyk7CiAgICAgICAgICB1bnNvbGRDb250cmFjdCA9IEdvbGRtaW50VW5zb2xkKF91bnNvbGRDb250cmFjdEFkZHJlc3MpOwoKICAgICAgICAgIC8vIHNsaWdodCByZW5hbWUKICAgICAgICAgIGZvdW5kZXJzUmV3YXJkc0FjY291bnQgPSBfZm91bmRlcnNWZXN0aW5nQWRkcmVzczsKCiAgICAgICAgICBhc3NlcnQobXVsdGlzaWdzLmxlbmd0aD09MTApOwogICAgIH0KCiAgICAgZnVuY3Rpb24gc3RhcnRJQ08oKSBwdWJsaWMgb25seUNyZWF0b3Igb25seUluU3RhdGUoU3RhdGUuSW5pdCkgewogICAgICAgICAgc2V0U3RhdGUoU3RhdGUuSUNPUnVubmluZyk7CiAgICAgICAgICBpY29TdGFydGVkVGltZSA9IHVpbnQ2NChub3cpOwogICAgICAgICAgbW50VG9rZW4ubG9ja1RyYW5zZmVyKHRydWUpOwogICAgICAgICAgbW50VG9rZW4uaXNzdWVUb2tlbnMoZm91bmRlcnNSZXdhcmRzQWNjb3VudCwgRk9VTkRFUlNfUkVXQVJEKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIHBhdXNlSUNPKCkgcHVibGljIG9ubHlDcmVhdG9yIG9ubHlJblN0YXRlKFN0YXRlLklDT1J1bm5pbmcpIHsKICAgICAgICAgIHNldFN0YXRlKFN0YXRlLklDT1BhdXNlZCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiByZXN1bWVJQ08oKSBwdWJsaWMgb25seUNyZWF0b3Igb25seUluU3RhdGUoU3RhdGUuSUNPUGF1c2VkKSB7CiAgICAgICAgICBzZXRTdGF0ZShTdGF0ZS5JQ09SdW5uaW5nKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIHN0YXJ0UmVmdW5kaW5nKCkgcHVibGljIG9ubHlDcmVhdG9yIG9ubHlJblN0YXRlKFN0YXRlLklDT1J1bm5pbmcpIHsKICAgICAgICAgIC8vIG9ubHkgc3dpdGNoIHRvIHRoaXMgc3RhdGUgaWYgbGVzcyB0aGFuIElDT19UT0tFTl9TT0ZUX0NBUCBzb2xkCiAgICAgICAgICByZXF1aXJlKGljb1Rva2Vuc1NvbGQgPCBJQ09fVE9LRU5fU09GVF9DQVApOwogICAgICAgICAgc2V0U3RhdGUoU3RhdGUuUmVmdW5kaW5nKTsKCiAgICAgICAgICAvLyBpbiB0aGlzIHN0YXRlIHRva2VucyBzdGlsbCBzaG91bGRuJ3QgYmUgdHJhbnNmZXJyZWQKICAgICAgICAgIGFzc2VydChtbnRUb2tlbi5sb2NrVHJhbnNmZXJzKCkpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gc3RhcnRNaWdyYXRpb24oKSBwdWJsaWMgb25seUNyZWF0b3Igb25seUluU3RhdGUoU3RhdGUuSUNPRmluaXNoZWQpIHsKICAgICAgICAgIC8vIHRoZXJlIGlzIG5vIHdheSBiYWNrLi4uCiAgICAgICAgICBzZXRTdGF0ZShTdGF0ZS5NaWdyYXRpbmcpOwoKICAgICAgICAgIC8vIGRpc2FibGUgdG9rZW4gdHJhbnNmZXJzCiAgICAgICAgICBtbnRUb2tlbi5sb2NrVHJhbnNmZXIodHJ1ZSk7CiAgICAgfQoKICAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgYnkgY3JlYXRvciBhdCBhbnkgdGltZSwKICAgICAvLy8gb3IgYnkgYW55b25lIGlmIElDTyBoYXMgcmVhbGx5IGZpbmlzaGVkLgogICAgIGZ1bmN0aW9uIGZpbmlzaElDTygpIHB1YmxpYyBvbmx5SW5TdGF0ZShTdGF0ZS5JQ09SdW5uaW5nKSB7CiAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3JlYXRvciB8fCBpc0ljb0ZpbmlzaGVkKCkpOwogICAgICAgICAgc2V0U3RhdGUoU3RhdGUuSUNPRmluaXNoZWQpOwoKICAgICAgICAgIC8vIDEgLSBsb2NrIGFsbCB0cmFuc2ZlcnMKICAgICAgICAgIG1udFRva2VuLmxvY2tUcmFuc2ZlcihmYWxzZSk7CgogICAgICAgICAgLy8gMiAtIG1vdmUgYWxsIHVuc29sZCB0b2tlbnMgdG8gdW5zb2xkVG9rZW5zIGNvbnRyYWN0CiAgICAgICAgICBpY29Ub2tlbnNVbnNvbGQgPSBzYWZlU3ViKElDT19UT0tFTl9TVVBQTFlfTElNSVQsaWNvVG9rZW5zU29sZCk7CiAgICAgICAgICBpZihpY29Ub2tlbnNVbnNvbGQ+MCl7CiAgICAgICAgICAgICAgIG1udFRva2VuLmlzc3VlVG9rZW5zKHVuc29sZENvbnRyYWN0LGljb1Rva2Vuc1Vuc29sZCk7CiAgICAgICAgICAgICAgIHVuc29sZENvbnRyYWN0LmZpbmlzaEljbygpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIDMgLSBzZW5kIGFsbCBFVEggdG8gbXVsdGlzaWdzCiAgICAgICAgICAvLyB3ZSBoYXZlIE4gc2VwYXJhdGUgbXVsdGlzaWdzIGZvciBleHRyYSBzZWN1cml0eQogICAgICAgICAgdWludCBzZW5kVGhpc0Ftb3VudCA9ICh0aGlzLmJhbGFuY2UgLyAxMCk7CgogICAgICAgICAgLy8gMy4xIC0gc2VuZCB0byA5IG11bHRpc2lncwogICAgICAgICAgZm9yKHVpbnQgaT0wOyBpPDk7ICsraSl7CiAgICAgICAgICAgICAgIGFkZHJlc3MgbXMgPSBtdWx0aXNpZ3NbaV07CgogICAgICAgICAgICAgICBpZih0aGlzLmJhbGFuY2U+PXNlbmRUaGlzQW1vdW50KXsKICAgICAgICAgICAgICAgICAgICBtcy50cmFuc2ZlcihzZW5kVGhpc0Ftb3VudCk7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyAzLjIgLSBzZW5kIGV2ZXJ5dGhpbmcgbGVmdCB0byAxMHRoIG11bHRpc2lnCiAgICAgICAgICBpZigwIT10aGlzLmJhbGFuY2UpewogICAgICAgICAgICAgICBhZGRyZXNzIGxhc3RNcyA9IG11bHRpc2lnc1s5XTsKICAgICAgICAgICAgICAgbGFzdE1zLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICB9CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRTdGF0ZShTdGF0ZSBfcykgaW50ZXJuYWwgewogICAgICAgICAgY3VycmVudFN0YXRlID0gX3M7CiAgICAgICAgICBMb2dTdGF0ZVN3aXRjaChfcyk7CiAgICAgfQoKLy8gQWNjZXNzIG1ldGhvZHM6CiAgICAgZnVuY3Rpb24gc2V0VG9rZW5NYW5hZ2VyKGFkZHJlc3MgX25ldykgcHVibGljIG9ubHlUb2tlbk1hbmFnZXIgewogICAgICAgICAgdG9rZW5NYW5hZ2VyID0gX25ldzsKICAgICB9CgogICAgIC8vIFRPRE86IHN0ZWFsaW5nIGNyZWF0b3IncyBrZXkgbWVhbnMgc3RlYWxpbmcgb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciBrZXkgdG9vIQogICAgIC8qCiAgICAgZnVuY3Rpb24gc2V0T3RoZXJDdXJyZW5jaWVzQ2hlY2tlcihhZGRyZXNzIF9uZXcpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBvdGhlckN1cnJlbmNpZXNDaGVja2VyID0gX25ldzsKICAgICB9CiAgICAgKi8KCiAgICAgLy8gVGhlc2UgYXJlIHVzZWQgYnkgZnJvbnRlbmQgc28gd2UgY2FuIG5vdCByZW1vdmUgdGhlbQogICAgIGZ1bmN0aW9uIGdldFRva2Vuc0ljb1NvbGQoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCl7ICAgICAgICAgIAogICAgICAgICAgcmV0dXJuIGljb1Rva2Vuc1NvbGQ7ICAgICAgIAogICAgIH0gICAgICAKICAgICAKICAgICBmdW5jdGlvbiBnZXRUb3RhbEljb1Rva2VucygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KXsgICAgICAgICAgCiAgICAgICAgICByZXR1cm4gSUNPX1RPS0VOX1NVUFBMWV9MSU1JVDsgICAgICAgICAKICAgICB9ICAgICAgIAogICAgIAogICAgIGZ1bmN0aW9uIGdldE1udFRva2VuQmFsYW5jZShhZGRyZXNzIF9vZikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpeyAgICAgICAgIAogICAgICAgICAgcmV0dXJuIG1udFRva2VuLmJhbGFuY2VPZihfb2YpOyAgICAgICAgIAogICAgIH0gICAgICAgIAoKICAgICBmdW5jdGlvbiBnZXRCbG9ja0xlbmd0aCgpY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpeyAgICAgICAgICAKICAgICAgICAgIHJldHVybiBTSU5HTEVfQkxPQ0tfTEVOOyAgICAgIAogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKCljb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCl7CiAgICAgICAgICByZXR1cm4gZ2V0TW50VG9rZW5zUGVyRXRoKGljb1Rva2Vuc1NvbGQpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0VG90YWxDb2xsZWN0ZWRXZWkoKWNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KXsKICAgICAgICAgIHJldHVybiBjb2xsZWN0ZWRXZWk7CiAgICAgfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICBmdW5jdGlvbiBpc0ljb0ZpbmlzaGVkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgICAgcmV0dXJuIChpY29TdGFydGVkVGltZSA+IDApCiAgICAgICAgICAgICYmIChub3cgPiAoaWNvU3RhcnRlZFRpbWUgKyAzMCBkYXlzKSB8fCAoaWNvVG9rZW5zU29sZCA+PSBJQ09fVE9LRU5fU1VQUExZX0xJTUlUKSk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRNbnRUb2tlbnNQZXJFdGgodWludCBfdG9rZW5zU29sZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpewogICAgICAgICAgLy8gMTAgYnVja2V0cwogICAgICAgICAgdWludCBwcmljZUluZGV4ID0gKF90b2tlbnNTb2xkIC8gMSBldGhlcikgLyBTSU5HTEVfQkxPQ0tfTEVOOwogICAgICAgICAgYXNzZXJ0KHByaWNlSW5kZXg+PTAgJiYgKHByaWNlSW5kZXg8PTkpKTsKICAgICAgICAgIAogICAgICAgICAgdWludDhbMTBdIG1lbW9yeSBkaXNjb3VudFBlcmNlbnRzID0gWzIwLDE1LDEwLDgsNiw0LDIsMCwwLDBdOwoKICAgICAgICAgIC8vIFdlIGhhdmUgdG8gbXVsdGlwbHkgYnkgJzEgZXRoZXInIHRvIGF2b2lkIGZsb2F0IHRydW5jYXRpb25zCiAgICAgICAgICAvLyBFeGFtcGxlOiAoJDcwMDAgKiAxMDApIC8gMTIwID0gJDU4MzMuMzMzMzMKICAgICAgICAgIHVpbnQgcHJpY2VQZXIxMDAwdG9rZW5zVXNkID0gCiAgICAgICAgICAgICAgICgoU1REX1BSSUNFX1VTRF9QRVJfMTAwMF9UT0tFTlMgKiAxMDApICogMSBldGhlcikgLyAoMTAwICsgZGlzY291bnRQZXJjZW50c1twcmljZUluZGV4XSk7CgogICAgICAgICAgLy8gQ29ycmVjdDogMzAwMDAwIC8gNTgzMy4zMzMzMzMzMyA9IDUxLjQyODU3MTQyCiAgICAgICAgICAvLyBXZSBoYXZlIHRvIG11bHRpcGx5IGJ5ICcxIGV0aGVyJyB0byBhdm9pZCBmbG9hdCB0cnVuY2F0aW9ucwogICAgICAgICAgdWludCBtbnRQZXJFdGggPSAodXNkUGVyRXRoQ29pbm1hcmtldGNhcFJhdGUgKiAxMDAwICogMSBldGhlciAqIDEgZXRoZXIpIC8gcHJpY2VQZXIxMDAwdG9rZW5zVXNkOwogICAgICAgICAgcmV0dXJuIG1udFBlckV0aDsKICAgICB9CgogICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9idXllcikgcHVibGljIHBheWFibGUgb25seUluU3RhdGUoU3RhdGUuSUNPUnVubmluZykgewogICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUhPTApOwoKICAgICAgICAgIC8vIFRoZSBwcmljZSBpcyBzZWxlY3RlZCBiYXNlZCBvbiBjdXJyZW50IHNvbGQgdG9rZW5zLgogICAgICAgICAgLy8gUHJpY2UgY2FuICdvdmVybGFwJy4gRm9yIGV4YW1wbGU6CiAgICAgICAgICAvLyAgIDEuIGlmIGN1cnJlbnRseSB3ZSBzb2xkIDY5OTk1MCB0b2tlbnMgKHRoZSBwcmljZSBpcyAxMCUgZGlzY291bnQpCiAgICAgICAgICAvLyAgIDIuIGJ1eWVyIGJ1eXMgMTAwMCB0b2tlbnMKICAgICAgICAgIC8vICAgMy4gdGhlIHByaWNlIG9mIGFsbCAxMDAwIHRva2VucyB3b3VsZCBiZSB3aXRoIDEwJSBkaXNjb3VudCEhIQogICAgICAgICAgdWludCBuZXdUb2tlbnMgPSAobXNnLnZhbHVlICogZ2V0TW50VG9rZW5zUGVyRXRoKGljb1Rva2Vuc1NvbGQpKSAvIDEgZXRoZXI7CgogICAgICAgICAgaXNzdWVUb2tlbnNJbnRlcm5hbChfYnV5ZXIsbmV3VG9rZW5zKTsKCiAgICAgICAgICAvLyBVcGRhdGUgdGhpcyBvbmx5IHdoZW4gYnV5aW5nIGZyb20gRVRICiAgICAgICAgICBldGhJbnZlc3RlZEJ5W21zZy5zZW5kZXJdID0gc2FmZUFkZChldGhJbnZlc3RlZEJ5W21zZy5zZW5kZXJdLCBtc2cudmFsdWUpOwoKICAgICAgICAgIC8vIFRoaXMgaXMgdG90YWwgY29sbGVjdGVkIEVUSAogICAgICAgICAgY29sbGVjdGVkV2VpID0gc2FmZUFkZChjb2xsZWN0ZWRXZWksIG1zZy52YWx1ZSk7CiAgICAgfQoKICAgICAvLy8gQGRldiBUaGlzIGlzIGNhbGxlZCBieSBvdGhlciBjdXJyZW5jeSBwcm9jZXNzb3JzIHRvIGlzc3VlIG5ldyB0b2tlbnMgCiAgICAgZnVuY3Rpb24gaXNzdWVUb2tlbnNGcm9tT3RoZXJDdXJyZW5jeShhZGRyZXNzIF90bywgdWludCBfd2VpQ291bnQpIG9ubHlJblN0YXRlKFN0YXRlLklDT1J1bm5pbmcpIHB1YmxpYyBvbmx5T3RoZXJDdXJyZW5jaWVzQ2hlY2tlciB7CiAgICAgICAgICByZXF1aXJlKF93ZWlDb3VudCE9MCk7CgogICAgICAgICAgdWludCBuZXdUb2tlbnMgPSAoX3dlaUNvdW50ICogZ2V0TW50VG9rZW5zUGVyRXRoKGljb1Rva2Vuc1NvbGQpKSAvIDEgZXRoZXI7CiAgICAgICAgICAKICAgICAgICAgIHJlcXVpcmUobmV3VG9rZW5zPD1NQVhfU0lOR0xFX0lTU1VFRF9GUk9NX09USEVSX0NVUlJFTkNJRVMpOwogICAgICAgICAgcmVxdWlyZSgoaXNzdWVkRnJvbU90aGVyQ3VycmVuY2llcyArIG5ld1Rva2Vucyk8PU1BWF9JU1NVRURfRlJPTV9PVEhFUl9DVVJSRU5DSUVTKTsKCiAgICAgICAgICBpc3N1ZVRva2Vuc0ludGVybmFsKF90byxuZXdUb2tlbnMpOwoKICAgICAgICAgIGlzc3VlZEZyb21PdGhlckN1cnJlbmNpZXMgPSBpc3N1ZWRGcm9tT3RoZXJDdXJyZW5jaWVzICsgbmV3VG9rZW5zOwogICAgIH0KCiAgICAgLy8vIEBkZXYgVGhpcyBjYW4gYmUgY2FsbGVkIHRvIG1hbnVhbGx5IGlzc3VlIG5ldyB0b2tlbnMgCiAgICAgLy8vIGZyb20gdGhlIGJvbnVzIHJld2FyZAogICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zRXh0ZXJuYWwoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VucykgcHVibGljIG9ubHlJblN0YXRlKFN0YXRlLklDT0ZpbmlzaGVkKSBvbmx5VG9rZW5NYW5hZ2VyIHsKICAgICAgICAgIC8vIGNhbiBub3QgaXNzdWUgbW9yZSB0aGFuIEJPTlVTX1JFV0FSRAogICAgICAgICAgcmVxdWlyZSgoaXNzdWVkRXh0ZXJuYWxseVRva2VucyArIF90b2tlbnMpPD1CT05VU19SRVdBUkQpOwoKICAgICAgICAgIG1udFRva2VuLmlzc3VlVG9rZW5zKF90byxfdG9rZW5zKTsKCiAgICAgICAgICBpc3N1ZWRFeHRlcm5hbGx5VG9rZW5zID0gaXNzdWVkRXh0ZXJuYWxseVRva2VucyArIF90b2tlbnM7CiAgICAgfQoKICAgICBmdW5jdGlvbiBpc3N1ZVRva2Vuc0ludGVybmFsKGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbnMpIGludGVybmFsIHsKICAgICAgICAgIHJlcXVpcmUoKGljb1Rva2Vuc1NvbGQgKyBfdG9rZW5zKTw9SUNPX1RPS0VOX1NVUFBMWV9MSU1JVCk7CgogICAgICAgICAgbW50VG9rZW4uaXNzdWVUb2tlbnMoX3RvLF90b2tlbnMpOyAKICAgICAgICAgIGljb1Rva2Vuc1NvbGQrPV90b2tlbnM7CgogICAgICAgICAgTG9nQnV5KF90byxfdG9rZW5zKTsKICAgICB9CgogICAgIC8vIGFueW9uZSBjYW4gY2FsbCB0aGlzIGFuZCBnZXQgaGlzIG1vbmV5IGJhY2sKICAgICBmdW5jdGlvbiBnZXRNeVJlZnVuZCgpIHB1YmxpYyBvbmx5SW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsKICAgICAgICAgIGFkZHJlc3Mgc2VuZGVyID0gbXNnLnNlbmRlcjsKICAgICAgICAgIHVpbnQgZXRoVmFsdWUgPSBldGhJbnZlc3RlZEJ5W3NlbmRlcl07CgogICAgICAgICAgcmVxdWlyZShldGhWYWx1ZSA+IDApOwoKICAgICAgICAgIC8vIDEgLSBzZW5kIG1vbmV5IGJhY2sKICAgICAgICAgIHNlbmRlci50cmFuc2ZlcihldGhWYWx1ZSk7CiAgICAgICAgICBldGhJbnZlc3RlZEJ5W3NlbmRlcl0gPSAwOwoKICAgICAgICAgIC8vIDIgLSBidXJuIHRva2VucwogICAgICAgICAgbW50VG9rZW4uYnVyblRva2VucyhzZW5kZXIsIG1udFRva2VuLmJhbGFuY2VPZihzZW5kZXIpKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNldFVzZFBlckV0aFJhdGUodWludCBfdXNkUGVyRXRoUmF0ZSkgcHVibGljIG9ubHlFdGhTZXR0ZXIgewogICAgICAgICAgLy8gMSAtIGNoZWNrCiAgICAgICAgICByZXF1aXJlKChfdXNkUGVyRXRoUmF0ZT49MTAwKSAmJiAoX3VzZFBlckV0aFJhdGU8PTcwMCkpOwogICAgICAgICAgdWludDY0IGhvdXJzUGFzc2VkID0gbGFzdFVzZFBlckV0aENoYW5nZURhdGUgKyAxIGhvdXJzOyAgCiAgICAgICAgICByZXF1aXJlKHVpbnQobm93KSA+PSBob3Vyc1Bhc3NlZCk7CgogICAgICAgICAgLy8gMiAtIHVwZGF0ZQogICAgICAgICAgdXNkUGVyRXRoQ29pbm1hcmtldGNhcFJhdGUgPSBfdXNkUGVyRXRoUmF0ZTsKICAgICAgICAgIGxhc3RVc2RQZXJFdGhDaGFuZ2VEYXRlID0gdWludDY0KG5vdyk7CiAgICAgfQoKICAgICAvLyBEZWZhdWx0IGZhbGxiYWNrIGZ1bmN0aW9uCiAgICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICAgIC8vIGJ1eVRva2VucyAtPiBpc3N1ZVRva2Vuc0ludGVybmFsCiAgICAgICAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgICAgfQp9'.
	

]
