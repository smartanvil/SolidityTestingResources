Class {
	#name : #SRTe3d1690ced0245997c13318bc8c131393316eb7e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe3d1690ced0245997c13318bc8c131393316eb7e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogRXRoaW5vIENyb3dkc2FsZSBDb250cmFjdAogKgogKiBUaGlzIGlzIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgZm9yIHRoZSBFdGhpbm8gdG9rZW4uIEl0IHV0aWxpemVzIE1ham9vbHIncwogKiBDcm93ZHNhbGVMaWIgbGlicmFyeSB0byByZWR1Y2UgY3VzdG9tIHNvdXJjZSBjb2RlIHN1cmZhY2UgYXJlYSBhbmQgaW5jcmVhc2Ugb3ZlcmFsbAogKiBzZWN1cml0eS5NYWpvb2xyIHByb3ZpZGVzIHNtYXJ0IGNvbnRyYWN0IHNlcnZpY2VzCiAqIGFuZCBzZWN1cml0eSByZXZpZXdzIGZvciBjb250cmFjdCBkZXBsb3ltZW50cyBpbiBhZGRpdGlvbiB0byB3b3JraW5nIG9uIG9wZW4KICogc291cmNlIHByb2plY3RzIGluIHRoZSBFdGhlcmV1bSBjb21tdW5pdHkuCiAqIEZvciBmdXJ0aGVyIGluZm9ybWF0aW9uOiBldGhpbm8uY29tLCBtYWpvb2xyLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpjb250cmFjdCBFTk9Dcm93ZHNhbGUgewogIHVzaW5nIERpcmVjdENyb3dkc2FsZUxpYiBmb3IgRGlyZWN0Q3Jvd2RzYWxlTGliLkRpcmVjdENyb3dkc2FsZVN0b3JhZ2U7CgogIERpcmVjdENyb3dkc2FsZUxpYi5EaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHNhbGU7CgogIGZ1bmN0aW9uIEVOT0Nyb3dkc2FsZSgKICAgICAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgICAgICAgICAgICB1aW50MjU2IGNhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IHN0YXJ0VGltZSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgZW5kVGltZSwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSB0b2tlblByaWNlUG9pbnRzLAogICAgICAgICAgICAgICAgdWludDI1NiBmYWxsYmFja0V4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgY2hhbmdlSW50ZXJ2YWwsCiAgICAgICAgICAgICAgICB1aW50OCBwZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIHRva2VuKQogIHsKICAJc2FsZS5pbml0KG93bmVyLCBjYXBBbW91bnRJbkNlbnRzLCBzdGFydFRpbWUsIGVuZFRpbWUsIHRva2VuUHJpY2VQb2ludHMsIGZhbGxiYWNrRXhjaGFuZ2VSYXRlLCBjaGFuZ2VJbnRlcnZhbCwgcGVyY2VudEJ1cm4sIHRva2VuKTsKICB9CgogIC8qRVZFTlRTKi8KCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ0Vycm9yTXNnKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dUb2tlblByaWNlQ2hhbmdlKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dUb2tlbnNXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKICBldmVudCBMb2dXZWlXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKICBldmVudCBMb2dPd25lckV0aFdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dOb3RpY2VNc2coYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHN0cmluZyBNc2cpOwogIGV2ZW50IExvZ0Vycm9yTXNnKHN0cmluZyBNc2cpOwoKICAvKkZVTkNUSU9OUyovCgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIHNlbmRQdXJjaGFzZSgpOwogIH0KCiAgZnVuY3Rpb24gc2VuZFB1cmNoYXNlKCkgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBzYWxlLnJlY2VpdmVQdXJjaGFzZShtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aCgpIHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIHNhbGUud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUodWludDI1NiBfZXhjaGFuZ2VSYXRlKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucygpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBzYWxlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKCkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwogIH0KCiAgLypHRVRURVJTKi8KCiAgZnVuY3Rpb24gb3duZXIoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLm93bmVyOwogIH0KCiAgZnVuY3Rpb24gdG9rZW5zUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS50b2tlbnNQZXJFdGg7CiAgfQoKICBmdW5jdGlvbiBleGNoYW5nZVJhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLmV4Y2hhbmdlUmF0ZTsKICB9CgogIGZ1bmN0aW9uIGNhcEFtb3VudCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UuY2FwQW1vdW50OwogIH0KCiAgZnVuY3Rpb24gc3RhcnRUaW1lKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5zdGFydFRpbWU7CiAgfQoKICBmdW5jdGlvbiBlbmRUaW1lKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5lbmRUaW1lOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlSW50ZXJ2YWwoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2FsZS5jaGFuZ2VJbnRlcnZhbDsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIHNhbGUuY3Jvd2RzYWxlQWN0aXZlKCk7CiAgfQoKICBmdW5jdGlvbiBmaXJzdFByaWNlQ2hhbmdlKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUudG9rZW5QcmljZVBvaW50c1sxXTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogIAlyZXR1cm4gc2FsZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KCiAgZnVuY3Rpb24gZXRoUmFpc2VkKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5vd25lckJhbGFuY2U7CiAgfQoKICBmdW5jdGlvbiB0b2tlbnNTb2xkKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5zdGFydGluZ1Rva2VuQmFsYW5jZSAtIHNhbGUuYmFzZS50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgfQoKICBmdW5jdGlvbiBjb250cmlidXRpb25BbW91bnQoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAJcmV0dXJuIHNhbGUuYmFzZS5oYXNDb250cmlidXRlZFtfYnV5ZXJdOwogIH0KCiAgZnVuY3Rpb24gdG9rZW5QdXJjaGFzZUFtb3VudChhZGRyZXNzIF9idXllcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogIAlyZXR1cm4gc2FsZS5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW19idXllcl07CiAgfQoKICBmdW5jdGlvbiBsZWZ0b3ZlcldlaUFtb3VudChhZGRyZXNzIF9idXllcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5sZWZ0b3ZlcldlaVtfYnV5ZXJdOwogIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIERpcmVjdENyb3dkc2FsZUxpYgogKiBAYXV0aG9yIE1ham9vbHIuaW8KICoKICogdmVyc2lvbiAxLjAuMAogKiBDb3B5cmlnaHQgKGMpIDIwMTcgTWFqb29sciwgTExDCiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKQogKiBodHRwczovL2dpdGh1Yi5jb20vTWFqb29sci9ldGhlcmV1bS1saWJyYXJpZXMvYmxvYi9tYXN0ZXIvTElDRU5TRQogKgogKiBUaGUgRGlyZWN0Q3Jvd2RzYWxlIExpYnJhcnkgcHJvdmlkZXMgZnVuY3Rpb25hbGl0eSB0byBjcmVhdGUgYSBpbml0aWFsIGNvaW4gb2ZmZXJpbmcKICogZm9yIGEgc3RhbmRhcmQgdG9rZW4gc2FsZSB3aXRoIGhpZ2ggc3VwcGx5IHdoZXJlIHRoZXJlIGlzIGEgZGlyZWN0IGV0aGVyIHRvCiAqIHRva2VuIHRyYW5zZmVyLgogKgogKiBNYWpvb2xyIHByb3ZpZGVzIHNtYXJ0IGNvbnRyYWN0IHNlcnZpY2VzIGFuZCBzZWN1cml0eSByZXZpZXdzIGZvciBjb250cmFjdAogKiBkZXBsb3ltZW50cyBpbiBhZGRpdGlvbiB0byB3b3JraW5nIG9uIG9wZW4gc291cmNlIHByb2plY3RzIGluIHRoZSBFdGhlcmV1bQogKiBjb21tdW5pdHkuIE91ciBwdXJwb3NlIGlzIHRvIHRlc3QsIGRvY3VtZW50LCBhbmQgZGVwbG95IHJldXNhYmxlIGNvZGUgb250byB0aGUKICogYmxvY2tjaGFpbiBhbmQgaW1wcm92ZSBib3RoIHNlY3VyaXR5IGFuZCB1c2FiaWxpdHkuIFdlIGFsc28gZWR1Y2F0ZSBub24tcHJvZml0cywKICogc2Nob29scywgYW5kIG90aGVyIGNvbW11bml0eSBtZW1iZXJzIGFib3V0IHRoZSBhcHBsaWNhdGlvbiBvZiBibG9ja2NoYWluCiAqIHRlY2hub2xvZ3kuIEZvciBmdXJ0aGVyIGluZm9ybWF0aW9uOiBtYWpvb2xyLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpsaWJyYXJ5IERpcmVjdENyb3dkc2FsZUxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwogIHVzaW5nIENyb3dkc2FsZUxpYiBmb3IgQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2U7CgogIHN0cnVjdCBEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHsKCiAgCUNyb3dkc2FsZUxpYi5Dcm93ZHNhbGVTdG9yYWdlIGJhc2U7IC8vIGJhc2Ugc3RvcmFnZSBmcm9tIENyb3dkc2FsZUxpYgoKICAgIHVpbnQyNTZbXSB0b2tlblByaWNlUG9pbnRzOyAgICAvLyBwcmljZSBwb2ludHMgYXQgZWFjaCBwcmljZSBjaGFuZ2UgaW50ZXJ2YWwgaW4gY2VudHMvdG9rZW4uCgogIAl1aW50MjU2IGNoYW5nZUludGVydmFsOyAgICAgIC8vIGFtb3VudCBvZiB0aW1lIGJldHdlZW4gY2hhbmdlcyBpbiB0aGUgcHJpY2Ugb2YgdGhlIHRva2VuCiAgCXVpbnQyNTYgbGFzdFByaWNlQ2hhbmdlVGltZTsgIC8vIHRpbWUgb2YgdGhlIGxhc3QgY2hhbmdlIGluIHRva2VuIGNvc3QKICB9CgogIGV2ZW50IExvZ1Rva2Vuc0JvdWdodChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBMb2dBZGRyZXNzQ2FwRXhjZWVkZWQoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwogIGV2ZW50IExvZ1Rva2VuUHJpY2VDaGFuZ2UodWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIGNyb3dkc2FsZSBvd25lcgogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfc3RhcnRUaW1lIFRpbWVzdGFtcCBvZiBzYWxlIHN0YXJ0IHRpbWUKICAvLy8gQHBhcmFtIF9lbmRUaW1lIFRpbWVzdGFtcCBvZiBzYWxlIGVuZCB0aW1lCiAgLy8vIEBwYXJhbSBfdG9rZW5QcmljZVBvaW50cyBBcnJheSBvZiBlYWNoIHByaWNlIHBvaW50IGR1cmluZyBzYWxlIGNlbnRzL3Rva2VuCiAgLy8vIEBwYXJhbSBfZmFsbGJhY2tFeGNoYW5nZVJhdGUgRXhjaGFuZ2UgcmF0ZSBvZiBjZW50cy9FVEgKICAvLy8gQHBhcmFtIF9jaGFuZ2VJbnRlcnZhbCBUaGUgbnVtYmVyIG9mIHNlY29uZHMgYmV0d2VlbiBlYWNoIHN0ZXAKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYmVpbmcgc29sZAogIGZ1bmN0aW9uIGluaXQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDI1NltdIF90b2tlblByaWNlUG9pbnRzLAogICAgICAgICAgICAgICAgdWludDI1NiBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9jaGFuZ2VJbnRlcnZhbCwKICAgICAgICAgICAgICAgIHVpbnQ4IF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIF90b2tlbikKICB7CiAgCXNlbGYuYmFzZS5pbml0KF9vd25lciwKICAgICAgICAgICAgICAgIF90b2tlblByaWNlUG9pbnRzWzBdLAogICAgICAgICAgICAgICAgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICBfc3RhcnRUaW1lLAogICAgICAgICAgICAgICAgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBfdG9rZW4pOwoKICAgIHJlcXVpcmUoX3Rva2VuUHJpY2VQb2ludHMubGVuZ3RoID4gMCk7CgogICAgLy8gaWYgdGhlcmUgaXMgbm8gaW5jcmVhc2Ugb3IgZGVjcmVhc2UgaW4gcHJpY2UsIHRoZSB0aW1lIGludGVydmFsIHNob3VsZCBhbHNvIGJlIHplcm8KICAgIGlmIChfdG9rZW5QcmljZVBvaW50cy5sZW5ndGggPT0gMSkgewogICAgCXJlcXVpcmUoX2NoYW5nZUludGVydmFsID09IDApOwogICAgfQogICAgc2VsZi50b2tlblByaWNlUG9pbnRzID0gX3Rva2VuUHJpY2VQb2ludHM7CiAgCXNlbGYuY2hhbmdlSW50ZXJ2YWwgPSBfY2hhbmdlSW50ZXJ2YWw7CiAgCXNlbGYubGFzdFByaWNlQ2hhbmdlVGltZSA9IF9zdGFydFRpbWU7CiAgfQoKICAvLy8gQGRldiBDYWxsZWQgd2hlbiBhbiBhZGRyZXNzIHdhbnRzIHRvIHB1cmNoYXNlIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IGFtb3VuZCBvZiB3ZWkgdGhhdCB0aGUgYnV5ZXIgaXMgc2VuZGluZwogIC8vLyBAcmV0dXJuIHRydWUgb24gc3VjY2VzZnVsIHB1cmNoYXNlCiAgZnVuY3Rpb24gcmVjZWl2ZVB1cmNoYXNlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBzZWxmLmJhc2Uub3duZXIpOwogIAlyZXF1aXJlKHNlbGYuYmFzZS52YWxpZFB1cmNoYXNlKCkpOwoKICAgIHJlcXVpcmUoKHNlbGYuYmFzZS5vd25lckJhbGFuY2UgKyBfYW1vdW50KSA8PSBzZWxmLmJhc2UuY2FwQW1vdW50KTsKCiAgCS8vIGlmIHRoZSB0b2tlbiBwcmljZSBpbmNyZWFzZSBpbnRlcnZhbCBoYXMgcGFzc2VkLCB1cGRhdGUgdGhlIGN1cnJlbnQgZGF5IGFuZCBjaGFuZ2UgdGhlIHRva2VuIHByaWNlCiAgCWlmICgoc2VsZi5jaGFuZ2VJbnRlcnZhbCA+IDApICYmIChub3cgPj0gKHNlbGYubGFzdFByaWNlQ2hhbmdlVGltZSArIHNlbGYuY2hhbmdlSW50ZXJ2YWwpKSkgewogIAkJc2VsZi5sYXN0UHJpY2VDaGFuZ2VUaW1lID0gc2VsZi5sYXN0UHJpY2VDaGFuZ2VUaW1lICsgc2VsZi5jaGFuZ2VJbnRlcnZhbDsKICAgICAgdWludDI1NiBpbmRleCA9IChub3ctc2VsZi5iYXNlLnN0YXJ0VGltZSkvc2VsZi5jaGFuZ2VJbnRlcnZhbDsKCiAgICAgIC8vcHJldmVudHMgZ29pbmcgb3V0IG9mIGJvdW5kcyBvbiB0aGUgdG9rZW5QcmljZVBvaW50cyBhcnJheQogICAgICBpZiAoc2VsZi50b2tlblByaWNlUG9pbnRzLmxlbmd0aCA8PSBpbmRleCkKICAgICAgICBpbmRleCA9IHNlbGYudG9rZW5QcmljZVBvaW50cy5sZW5ndGggLSAxOwoKICAgICAgc2VsZi5iYXNlLmNoYW5nZVRva2VuUHJpY2Uoc2VsZi50b2tlblByaWNlUG9pbnRzW2luZGV4XSk7CgogICAgICBMb2dUb2tlblByaWNlQ2hhbmdlKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgsIlRva2VuIFByaWNlIGhhcyBjaGFuZ2VkISIpOwogIAl9CgogIAl1aW50MjU2IG51bVRva2VuczsgLy9udW1iZXIgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSBwdXJjaGFzZWQKICAJYm9vbCBlcnI7CiAgICB1aW50MjU2IG5ld0JhbGFuY2U7IC8vdGhlIG5ldyBiYWxhbmNlIG9mIHRoZSBvd25lciBvZiB0aGUgY3Jvd2RzYWxlCiAgICB1aW50MjU2IHdlaVRva2VuczsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICB1aW50MjU2IHplcm9zOyAvL2ZvciBjYWxjdWxhdGluZyB0b2tlbgogICAgdWludDI1NiBsZWZ0b3ZlcldlaTsgLy93ZWkgY2hhbmdlIGZvciBwdXJjaGFzZXIKICAgIHVpbnQyNTYgcmVtYWluZGVyOyAvL3RlbXAgY2FsYyBob2xkZXIKCiAgICAvLyBGaW5kIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFzIGEgZnVuY3Rpb24gaW4gd2VpCiAgICAoZXJyLHdlaVRva2VucykgPSBfYW1vdW50LnRpbWVzKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBpZihzZWxmLmJhc2UudG9rZW5EZWNpbWFscyA8PSAxOCl7CiAgICAgIHplcm9zID0gMTAqKigxOC11aW50MjU2KHNlbGYuYmFzZS50b2tlbkRlY2ltYWxzKSk7CiAgICAgIG51bVRva2VucyA9IHdlaVRva2Vucy96ZXJvczsKICAgICAgbGVmdG92ZXJXZWkgPSB3ZWlUb2tlbnMgJSB6ZXJvczsKICAgICAgc2VsZi5iYXNlLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdICs9IGxlZnRvdmVyV2VpOwogICAgfSBlbHNlIHsKICAgICAgemVyb3MgPSAxMCoqKHVpbnQyNTYoc2VsZi5iYXNlLnRva2VuRGVjaW1hbHMpLTE4KTsKICAgICAgbnVtVG9rZW5zID0gd2VpVG9rZW5zKnplcm9zOwogICAgfQoKICAgIC8vIGNhbid0IG92ZXJmbG93IGJlY2F1c2UgaXQgaXMgdW5kZXIgdGhlIGNhcAogICAgc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdICs9IF9hbW91bnQgLSBsZWZ0b3ZlcldlaTsKCiAgICByZXF1aXJlKG51bVRva2VucyA8PSBzZWxmLmJhc2UudG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKCiAgICAvLyBjYWxjdWxhdGUgdGhlIGFtb3V0IG9mIGV0aGVyIGluIHRoZSBvd25lcnMgYmFsYW5jZQogICAgKGVycixuZXdCYWxhbmNlKSA9IHNlbGYuYmFzZS5vd25lckJhbGFuY2UucGx1cyhfYW1vdW50LWxlZnRvdmVyV2VpKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYXNlLm93bmVyQmFsYW5jZSA9IG5ld0JhbGFuY2U7ICAgLy8gImRlcG9zaXQiIHRoZSBhbW91bnQKCiAgICAvLyBjYW4ndCBvdmVyZmxvdyBiZWNhdXNlIGl0IHdpbGwgYmUgdW5kZXIgdGhlIGNhcAoJICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKz0gbnVtVG9rZW5zOwoKICAgIC8vc3VidHJhY3QgdG9rZW5zIGZyb20gb3duZXIncyBzaGFyZQogICAgKGVycixyZW1haW5kZXIpID0gc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW3NlbGYuYmFzZS5vd25lcl0ubWludXMobnVtVG9rZW5zKTsKICAgIHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtzZWxmLmJhc2Uub3duZXJdID0gcmVtYWluZGVyOwoKCSAgTG9nVG9rZW5zQm91Z2h0KG1zZy5zZW5kZXIsIG51bVRva2Vucyk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKkZ1bmN0aW9ucyAiaW5oZXJpdGVkIiBmcm9tIENyb3dkc2FsZUxpYiBsaWJyYXJ5Ki8KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucyhEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3TGVmdG92ZXJXZWkoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlRW5kZWQoKTsKICB9CgogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UudmFsaWRQdXJjaGFzZSgpOwogIH0KfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOgogKiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICoKICogVGhpcyBpcyBhbiBleGFtcGxlIHRva2VuIGNvbnRyYWN0IGJ1aWx0IHVzaW5nIHRoZSBNYWpvb2xyIHRva2VuIGxpYnJhcnkgYXQKICogaHR0cHM6Ly9naXRodWIuY29tL01ham9vbHIvZXRoZXJldW0tbGlicmFyaWVzL3RyZWUvbWFzdGVyL1Rva2VuTGliLiBUaGlzCiAqIGV4YW1wbGUgZG9lcyBub3QgdXNlIGFsbCBvZiB0aGUgZnVuY3Rpb25hbGl0eSBhdmFpbGFibGUsIGl0IGlzIG9ubHkKICogYSBiYXJlYm9uZXMgZXhhbXBsZSBvZiBhIGJhc2ljIEVSQzIwIHRva2VuIGNvbnRyYWN0LgogKgogKiBNYWpvb2xyIHByb3ZpZGVzIHNtYXJ0IGNvbnRyYWN0IHNlcnZpY2VzIGFuZCBzZWN1cml0eSByZXZpZXdzIGZvciBjb250cmFjdAogKiBkZXBsb3ltZW50cyBpbiBhZGRpdGlvbiB0byB3b3JraW5nIG9uIG9wZW4gc291cmNlIHByb2plY3RzIGluIHRoZSBFdGhlcmV1bQogKiBjb21tdW5pdHkuIE91ciBwdXJwb3NlIGlzIHRvIHRlc3QsIGRvY3VtZW50LCBhbmQgZGVwbG95IHJldXNhYmxlIGNvZGUgb250byB0aGUKICogYmxvY2tjaGFpbiBhbmQgaW1wcm92ZSBib3RoIHNlY3VyaXR5IGFuZCB1c2FiaWxpdHkuIFdlIGFsc28gZWR1Y2F0ZSBub24tcHJvZml0cywKICogc2Nob29scywgYW5kIG90aGVyIGNvbW11bml0eSBtZW1iZXJzIGFib3V0IHRoZSBhcHBsaWNhdGlvbiBvZiBibG9ja2NoYWluCiAqIHRlY2hub2xvZ3kuIEZvciBmdXJ0aGVyIGluZm9ybWF0aW9uOiBtYWpvb2xyLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpjb250cmFjdCBDcm93ZHNhbGVUb2tlbiB7CiAgdXNpbmcgVG9rZW5MaWIgZm9yIFRva2VuTGliLlRva2VuU3RvcmFnZTsKCiAgVG9rZW5MaWIuVG9rZW5TdG9yYWdlIHB1YmxpYyB0b2tlbjsKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlVG9rZW4oYWRkcmVzcyBvd25lciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4IGRlY2ltYWxzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5pdGlhbFN1cHBseSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGFsbG93TWludGluZykKICB7CiAgICB0b2tlbi5pbml0KG93bmVyLCBuYW1lLCBzeW1ib2wsIGRlY2ltYWxzLCBpbml0aWFsU3VwcGx5LCBhbGxvd01pbnRpbmcpOwogIH0KCiAgZnVuY3Rpb24gbmFtZSgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIHRva2VuLm5hbWU7CiAgfQoKICBmdW5jdGlvbiBzeW1ib2woKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiB0b2tlbi5zeW1ib2w7CiAgfQoKICBmdW5jdGlvbiBkZWNpbWFscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICByZXR1cm4gdG9rZW4uZGVjaW1hbHM7CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi50b3RhbFN1cHBseTsKICB9CgogIGZ1bmN0aW9uIGluaXRpYWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uSU5JVElBTF9TVVBQTFk7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2Yod2hvKTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5hbGxvd2FuY2Uob3duZXIsIHNwZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBuZXdPd25lcikgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmNoYW5nZU93bmVyKG5ld093bmVyKTsKICB9CgogIGZ1bmN0aW9uIGJ1cm5Ub2tlbih1aW50MjU2IGFtb3VudCkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmJ1cm5Ub2tlbihhbW91bnQpOwogIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIENyb3dkc2FsZUxpYgogKiBAYXV0aG9yIE1ham9vbHIuaW8KICoKICogdmVyc2lvbiAxLjAuMAogKiBDb3B5cmlnaHQgKGMpIDIwMTcgTWFqb29sciwgTExDCiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKQogKiBodHRwczovL2dpdGh1Yi5jb20vTWFqb29sci9ldGhlcmV1bS1saWJyYXJpZXMvYmxvYi9tYXN0ZXIvTElDRU5TRQogKgogKiBUaGUgQ3Jvd2RzYWxlIExpYnJhcnkgcHJvdmlkZXMgYmFzaWMgZnVuY3Rpb25hbGl0eSB0byBjcmVhdGUgYW4gaW5pdGlhbCBjb2luCiAqIG9mZmVyaW5nIGZvciBkaWZmZXJlbnQgdHlwZXMgb2YgdG9rZW4gc2FsZXMuCiAqCiAqIE1ham9vbHIgcHJvdmlkZXMgc21hcnQgY29udHJhY3Qgc2VydmljZXMgYW5kIHNlY3VyaXR5IHJldmlld3MgZm9yIGNvbnRyYWN0CiAqIGRlcGxveW1lbnRzIGluIGFkZGl0aW9uIHRvIHdvcmtpbmcgb24gb3BlbiBzb3VyY2UgcHJvamVjdHMgaW4gdGhlIEV0aGVyZXVtCiAqIGNvbW11bml0eS4gT3VyIHB1cnBvc2UgaXMgdG8gdGVzdCwgZG9jdW1lbnQsIGFuZCBkZXBsb3kgcmV1c2FibGUgY29kZSBvbnRvIHRoZQogKiBibG9ja2NoYWluIGFuZCBpbXByb3ZlIGJvdGggc2VjdXJpdHkgYW5kIHVzYWJpbGl0eS4gV2UgYWxzbyBlZHVjYXRlIG5vbi1wcm9maXRzLAogKiBzY2hvb2xzLCBhbmQgb3RoZXIgY29tbXVuaXR5IG1lbWJlcnMgYWJvdXQgdGhlIGFwcGxpY2F0aW9uIG9mIGJsb2NrY2hhaW4KICogdGVjaG5vbG9neS4gRm9yIGZ1cnRoZXIgaW5mb3JtYXRpb246IG1ham9vbHIuaW8KICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKICogT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgogKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCiAqIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCiAqIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsCiAqIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFCiAqIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgogKi8KCmxpYnJhcnkgQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBDcm93ZHNhbGVTdG9yYWdlIHsKICAJYWRkcmVzcyBvd25lcjsgICAgIC8vb3duZXIgb2YgdGhlIGNyb3dkc2FsZQoKICAJdWludDI1NiB0b2tlbnNQZXJFdGg7ICAvL251bWJlciBvZiB0b2tlbnMgcmVjZWl2ZWQgcGVyIGV0aGVyCiAgCXVpbnQyNTYgY2FwQW1vdW50OyAvL01heGltdW0gYW1vdW50IHRvIGJlIHJhaXNlZCBpbiB3ZWkKICAJdWludDI1NiBzdGFydFRpbWU7IC8vSUNPIHN0YXJ0IHRpbWUsIHRpbWVzdGFtcAogIAl1aW50MjU2IGVuZFRpbWU7IC8vSUNPIGVuZCB0aW1lLCB0aW1lc3RhbXAgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkCiAgICB1aW50MjU2IGV4Y2hhbmdlUmF0ZTsgLy9jZW50cy9FVEggZXhjaGFuZ2UgcmF0ZSBhdCB0aGUgdGltZSBvZiB0aGUgc2FsZQogICAgdWludDI1NiBvd25lckJhbGFuY2U7IC8vb3duZXIgd2VpIEJhbGFuY2UKICAgIHVpbnQyNTYgc3RhcnRpbmdUb2tlbkJhbGFuY2U7IC8vaW5pdGlhbCBhbW91bnQgb2YgdG9rZW5zIGZvciBzYWxlCiAgICB1aW50OCB0b2tlbkRlY2ltYWxzOyAvL3N0b3JlZCB0b2tlbiBkZWNpbWFscyBmb3IgY2FsY3VsYXRpb24gbGF0ZXIKICAgIHVpbnQ4IHBlcmNlbnRCdXJuOyAvL3BlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAgIGJvb2wgdG9rZW5zU2V0OyAvL3RydWUgaWYgdG9rZW5zIGhhdmUgYmVlbiBwcmVwYXJlZCBmb3IgY3Jvd2RzYWxlCiAgICBib29sIHJhdGVTZXQ7IC8vdHJ1ZSBpZiBleGNoYW5nZSByYXRlIGhhcyBiZWVuIHNldAoKICAgIC8vc2hvd3MgaG93IG11Y2ggd2VpIGFuIGFkZHJlc3MgaGFzIGNvbnRyaWJ1dGVkCiAgCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgaGFzQ29udHJpYnV0ZWQ7CgogICAgLy9Gb3IgdG9rZW4gd2l0aGRyYXcgZnVuY3Rpb24sIG1hcHMgYSB1c2VyIGFkZHJlc3MgdG8gdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhleSBjYW4gd2l0aGRyYXcKICAJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSB3aXRoZHJhd1Rva2Vuc01hcDsKCiAgICAvLyBhbnkgbGVmdG92ZXIgd2VpIHRoYXQgYnV5ZXJzIGNvbnRyaWJ1dGVkIHRoYXQgZGlkbid0IGFkZCB1cCB0byBhIHdob2xlIHRva2VuIGFtb3VudAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBsZWZ0b3ZlcldlaTsKCiAgCUNyb3dkc2FsZVRva2VuIHRva2VuOyAvL3Rva2VuIGJlaW5nIHNvbGQKICB9CgogIC8vIEluZGljYXRlcyB3aGVuIGFuIGFkZHJlc3MgaGFzIHdpdGhkcmF3biB0aGVpciBzdXBwbHkgb2YgdG9rZW5zCiAgZXZlbnQgTG9nVG9rZW5zV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CgogIC8vIEluZGljYXRlcyB3aGVuIGFuIGFkZHJlc3MgaGFzIHdpdGhkcmF3biB0aGVpciBzdXBwbHkgb2YgZXh0cmEgd2VpCiAgZXZlbnQgTG9nV2VpV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CgogIC8vIExvZ3Mgd2hlbiBvd25lciBoYXMgcHVsbGVkIGV0aAogIGV2ZW50IExvZ093bmVyRXRoV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLyBHZW5lcmljIE5vdGljZSBtZXNzYWdlIHRoYXQgaW5jbHVkZXMgYW5kIGFkZHJlc3MgYW5kIG51bWJlcgogIGV2ZW50IExvZ05vdGljZU1zZyhhZGRyZXNzIF9idXllciwgdWludDI1NiB2YWx1ZSwgc3RyaW5nIE1zZyk7CgogIC8vIEluZGljYXRlcyB3aGVuIGFuIGVycm9yIGhhcyBvY2N1cnJlZCBpbiB0aGUgZXhlY3V0aW9uIG9mIGEgZnVuY3Rpb24KICBldmVudCBMb2dFcnJvck1zZyhzdHJpbmcgTXNnKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIGNyb3dkc2FsZSBvd25lcgogIC8vLyBAcGFyYW0gX3Rva2VuUHJpY2VJbkNlbnRzIFByaWNlIG9mIHRva2VucyBpbiBjZW50cwogIC8vLyBAcGFyYW0gX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlIEV4Y2hhbmdlIHJhdGUgb2YgY2VudHMvRVRICiAgLy8vIEBwYXJhbSBfY2FwQW1vdW50SW5DZW50cyBUb3RhbCB0byBiZSByYWlzZWQgaW4gY2VudHMKICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgc3RhcnQgdGltZQogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYmVpbmcgc29sZAogIGZ1bmN0aW9uIGluaXQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX3Rva2VuUHJpY2VJbkNlbnRzLAogICAgICAgICAgICAgICAgdWludDI1NiBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzLAogICAgICAgICAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICAgICAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICAgICAgICAgIHVpbnQ4IF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIF90b2tlbikKICB7CiAgCXJlcXVpcmUoc2VsZi5jYXBBbW91bnQgPT0gMCk7CiAgCXJlcXVpcmUoc2VsZi5vd25lciA9PSAwKTsKICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3Rva2VuUHJpY2VJbkNlbnRzID4gMCk7CiAgICByZXF1aXJlKF9jYXBBbW91bnRJbkNlbnRzID4gMCk7CiAgICByZXF1aXJlKF9vd25lciA+IDApOwogICAgcmVxdWlyZShfZmFsbGJhY2tFeGNoYW5nZVJhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3BlcmNlbnRCdXJuIDw9IDEwMCk7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5jYXBBbW91bnQgPSAoKF9jYXBBbW91bnRJbkNlbnRzL19mYWxsYmFja0V4Y2hhbmdlUmF0ZSkgKyAxKSooMTAqKjE4KTsKICAgIHNlbGYuc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIHNlbGYuZW5kVGltZSA9IF9lbmRUaW1lOwogICAgc2VsZi50b2tlbiA9IF90b2tlbjsKICAgIHNlbGYudG9rZW5EZWNpbWFscyA9IF90b2tlbi5kZWNpbWFscygpOwogICAgc2VsZi5wZXJjZW50QnVybiA9IF9wZXJjZW50QnVybjsKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlOwogICAgY2hhbmdlVG9rZW5QcmljZShzZWxmLF90b2tlblByaWNlSW5DZW50cyk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIChub3cgPj0gc2VsZi5zdGFydFRpbWUgJiYgbm93IDw9IHNlbGYuZW5kVGltZSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gc3VjY2VzcwogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBub3cgPiBzZWxmLmVuZFRpbWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHB1cmNoYXNlIGlzIHZhbGlkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICBpZiAoY3Jvd2RzYWxlQWN0aXZlKHNlbGYpICYmIG5vblplcm9QdXJjaGFzZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIExvZ0Vycm9yTXNnKCJJbnZhbGlkIFB1cmNoYXNlISBDaGVjayBzZW5kIHRpbWUgYW5kIGFtb3VudCBvZiBldGhlci4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHdlcmUgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgb2s7CgogICAgaWYgKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygiU2VuZGVyIGhhcyBubyB0b2tlbnMgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKSB7CiAgICAgIGlmKCghY3Jvd2RzYWxlRW5kZWQoc2VsZikpKXsKICAgICAgICBMb2dFcnJvck1zZygiT3duZXIgY2Fubm90IHdpdGhkcmF3IGV4dHJhIHRva2VucyB1bnRpbCBhZnRlciB0aGUgc2FsZSEiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYoc2VsZi5wZXJjZW50QnVybiA+IDApewogICAgICAgICAgdWludDI1NiBfYnVybkFtb3VudCA9IChzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdICogc2VsZi5wZXJjZW50QnVybikvMTAwOwogICAgICAgICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gLSBfYnVybkFtb3VudDsKICAgICAgICAgIG9rID0gc2VsZi50b2tlbi5idXJuVG9rZW4oX2J1cm5BbW91bnQpOwogICAgICAgICAgcmVxdWlyZShvayk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIHRvdGFsID0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXTsKICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSAwOwogICAgb2sgPSBzZWxmLnRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJlcXVpcmUob2spOwogICAgTG9nVG9rZW5zV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCBsZWZ0b3ZlciB3ZWkgZnJvbSB0aGVpciBwdXJjaGFzZXMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgd2VpIHdhcyB3aXRoZHJhd24KICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHNlbGYuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl0gPiAwKTsKICAgIGlmIChzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdID09IDApIHsKICAgICAgTG9nRXJyb3JNc2coIlNlbmRlciBoYXMgbm8gZXh0cmEgd2VpIHRvIHdpdGhkcmF3ISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIHRvdGFsID0gc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXTsKICAgIHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gPSAwOwogICAgbXNnLnNlbmRlci50cmFuc2Zlcih0b3RhbCk7CiAgICBMb2dXZWlXaXRoZHJhd24obXNnLnNlbmRlciwgdG90YWwpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBzZW5kIGV0aGVyIGZyb20gdGhlIGNvbXBsZXRlZCBjcm93ZHNhbGUgdG8gdGhlIG93bmVycyB3YWxsZXQgYWRkcmVzcwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBvd25lciB3aXRoZHJldyBldGgKICBmdW5jdGlvbiB3aXRoZHJhd093bmVyRXRoKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICBpZiAoIWNyb3dkc2FsZUVuZGVkKHNlbGYpKSB7CiAgICAgIExvZ0Vycm9yTXNnKCJDYW5ub3Qgd2l0aGRyYXcgb3duZXIgZXRoZXIgdW50aWwgYWZ0ZXIgdGhlIHNhbGUhIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICByZXF1aXJlKHNlbGYub3duZXJCYWxhbmNlID4gMCk7CgogICAgdWludDI1NiBhbW91bnQgPSBzZWxmLm93bmVyQmFsYW5jZTsKICAgIHNlbGYub3duZXJCYWxhbmNlID0gMDsKICAgIHNlbGYub3duZXIudHJhbnNmZXIoYW1vdW50KTsKICAgIExvZ093bmVyRXRoV2l0aGRyYXduKG1zZy5zZW5kZXIsYW1vdW50LCJDcm93ZHNhbGUgb3duZXIgaGFzIHdpdGhkcmF3biBhbGwgZnVuZHMhIik7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiB0byBjaGFuZ2UgdGhlIHByaWNlIG9mIHRoZSB0b2tlbgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmV3UHJpY2UgbmV3IHRva2VuIHByaWNlIChhbW91bnQgb2YgdG9rZW5zIHBlciBldGhlcikKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0b2tlbiBwcmljZSBjaGFuZ2VkIHN1Y2Nlc3NmdWxseQogIGZ1bmN0aW9uIGNoYW5nZVRva2VuUHJpY2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsdWludDI1NiBfbmV3UHJpY2UpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAJcmVxdWlyZShfbmV3UHJpY2UgPiAwKTsKCiAgICB1aW50MjU2IHJlc3VsdDsKICAgIGJvb2wgZXJyOwoKICAgIChlcnIscmVzdWx0KSA9IHNlbGYuZXhjaGFuZ2VSYXRlLmRpdmlkZWRCeShfbmV3UHJpY2UpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgCXNlbGYudG9rZW5zUGVyRXRoID0gcmVzdWx0ICsgMTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdGhyZWUgZGF5cyBiZWZvcmUgdGhlIHNhbGUgdG8gc2V0IHRoZSB0b2tlbiBhbmQgcHJpY2UKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2V4Y2hhbmdlUmF0ZSAgRVRIIGV4Y2hhbmdlIHJhdGUgZXhwcmVzc2VkIGluIGNlbnRzL0VUSAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgaGFzIGJlZW4gc2V0CiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZSgobm93ID4gKHNlbGYuc3RhcnRUaW1lIC0gMyBkYXlzKSkgJiYgKG5vdyA8IChzZWxmLnN0YXJ0VGltZSkpKTsKICAgIHJlcXVpcmUoIXNlbGYucmF0ZVNldCk7ICAgLy8gdGhlIGV4Y2hhbmdlIHJhdGUgY2FuIG9ubHkgYmUgc2V0IG9uY2UhCiAgICByZXF1aXJlKHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpID4gMCk7CiAgICByZXF1aXJlKF9leGNoYW5nZVJhdGUgPiAwKTsKCiAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzOwogICAgdWludDI1NiBfdG9rZW5QcmljZUluQ2VudHM7CiAgICB1aW50MjU2IF90b2tlbkJhbGFuY2U7CiAgICBib29sIGVycjsKCiAgICAoZXJyLCBfY2FwQW1vdW50SW5DZW50cykgPSBzZWxmLmV4Y2hhbmdlUmF0ZS50aW1lcyhzZWxmLmNhcEFtb3VudCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIChlcnIsIF90b2tlblByaWNlSW5DZW50cykgPSBzZWxmLmV4Y2hhbmdlUmF0ZS5kaXZpZGVkQnkoc2VsZi50b2tlbnNQZXJFdGgpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBfdG9rZW5CYWxhbmNlID0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi50b2tlbnNTZXQgPSB0cnVlOwoKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2V4Y2hhbmdlUmF0ZTsKICAgIHNlbGYuY2FwQW1vdW50ID0gKF9jYXBBbW91bnRJbkNlbnRzL19leGNoYW5nZVJhdGUpICsgMTsKICAgIGNoYW5nZVRva2VuUHJpY2Uoc2VsZixfdG9rZW5QcmljZUluQ2VudHMgKyAxKTsKICAgIHNlbGYucmF0ZVNldCA9IHRydWU7CgogICAgTG9nTm90aWNlTXNnKG1zZy5zZW5kZXIsc2VsZi50b2tlbnNQZXJFdGgsIk93bmVyIGhhcyBzZW50IHRoZSBleGNoYW5nZSBSYXRlIGFuZCB0b2tlbnMgYm91Z2h0IHBlciBFVEghIik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHNldCB0b2tlbnMgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgZnVuY3Rpb24gd2FzIG5vdCBjYWxsZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHNldCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBzZXRUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoIXNlbGYudG9rZW5zU2V0KTsKCiAgICB1aW50MjU2IF90b2tlbkJhbGFuY2U7CgogICAgX3Rva2VuQmFsYW5jZSA9IHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYudG9rZW5zU2V0ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwoKLyoqCiAqIEB0aXRsZSBUb2tlbkxpYgogKiBAYXV0aG9yIE1ham9vbHIuaW8KICoKICogdmVyc2lvbiAxLjEuMAogKiBDb3B5cmlnaHQgKGMpIDIwMTcgTWFqb29sciwgTExDCiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKQogKiBodHRwczovL2dpdGh1Yi5jb20vTWFqb29sci9ldGhlcmV1bS1saWJyYXJpZXMvYmxvYi9tYXN0ZXIvTElDRU5TRQogKgogKiBUaGUgVG9rZW4gTGlicmFyeSBwcm92aWRlcyBmdW5jdGlvbmFsaXR5IHRvIGNyZWF0ZSBhIHZhcmlldHkgb2YgRVJDMjAgdG9rZW5zLgogKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL01ham9vbHIvZXRoZXJldW0tY29udHJhY3RzIGZvciBhbiBleGFtcGxlIG9mIGhvdyB0bwogKiBjcmVhdGUgYSBiYXNpYyBFUkMyMCB0b2tlbi4KICoKICogTWFqb29sciB3b3JrcyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbiB0aGUgRXRoZXJldW0gY29tbXVuaXR5IHdpdGggdGhlCiAqIHB1cnBvc2Ugb2YgdGVzdGluZywgZG9jdW1lbnRpbmcsIGFuZCBkZXBsb3lpbmcgcmV1c2FibGUgY29kZSBvbnRvIHRoZQogKiBibG9ja2NoYWluIHRvIGltcHJvdmUgc2VjdXJpdHkgYW5kIHVzYWJpbGl0eSBvZiBzbWFydCBjb250cmFjdHMuIE1ham9vbHIKICogYWxzbyBzdHJpdmVzIHRvIGVkdWNhdGUgbm9uLXByb2ZpdHMsIHNjaG9vbHMsIGFuZCBvdGhlciBjb21tdW5pdHkgbWVtYmVycwogKiBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbiB0ZWNobm9sb2d5LgogKiBGb3IgZnVydGhlciBpbmZvcm1hdGlvbjogbWFqb29sci5pbwogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwogKiBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKbGlicmFyeSBUb2tlbkxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgVG9rZW5TdG9yYWdlIHsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgc3RyaW5nIG5hbWU7CiAgICBzdHJpbmcgc3ltYm9sOwogICAgdWludDI1NiB0b3RhbFN1cHBseTsKICAgIHVpbnQyNTYgSU5JVElBTF9TVVBQTFk7CiAgICBhZGRyZXNzIG93bmVyOwogICAgdWludDggZGVjaW1hbHM7CiAgICBib29sIHN0aWxsTWludGluZzsKICB9CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IE93bmVyQ2hhbmdlKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0byk7CiAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBNaW50aW5nQ2xvc2VkKGJvb2wgbWludGluZ0Nsb3NlZCk7CgogIC8vLyBAZGV2IENhbGxlZCBieSB0aGUgU3RhbmRhcmQgVG9rZW4gdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9uYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogIC8vLyBAcGFyYW0gX3N5bWJvbCBTeW1ib2wgb2YgdGhlIG5ldyB0b2tlbgogIC8vLyBAcGFyYW0gX2RlY2ltYWxzIERlY2ltYWwgcGxhY2VzIGZvciB0aGUgdG9rZW4gcmVwcmVzZW50ZWQKICAvLy8gQHBhcmFtIF9pbml0aWFsX3N1cHBseSBUaGUgaW5pdGlhbCB0b2tlbiBzdXBwbHkKICAvLy8gQHBhcmFtIF9hbGxvd01pbnRpbmcgVHJ1ZSBpZiBhZGRpdGlvbmFsIHRva2VucyBjYW4gYmUgY3JlYXRlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gaW5pdChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICAgICAgICAgIHVpbnQ4IF9kZWNpbWFscywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2luaXRpYWxfc3VwcGx5LAogICAgICAgICAgICAgICAgYm9vbCBfYWxsb3dNaW50aW5nKQogIHsKICAgIHJlcXVpcmUoc2VsZi5JTklUSUFMX1NVUFBMWSA9PSAwKTsKICAgIHNlbGYubmFtZSA9IF9uYW1lOwogICAgc2VsZi5zeW1ib2wgPSBfc3ltYm9sOwogICAgc2VsZi50b3RhbFN1cHBseSA9IF9pbml0aWFsX3N1cHBseTsKICAgIHNlbGYuSU5JVElBTF9TVVBQTFkgPSBfaW5pdGlhbF9zdXBwbHk7CiAgICBzZWxmLmRlY2ltYWxzID0gX2RlY2ltYWxzOwogICAgc2VsZi5vd25lciA9IF9vd25lcjsKICAgIHNlbGYuc3RpbGxNaW50aW5nID0gX2FsbG93TWludGluZzsKICAgIHNlbGYuYmFsYW5jZXNbX293bmVyXSA9IF9pbml0aWFsX3N1cHBseTsKICB9CgogIC8vLyBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIGNhbGxlcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50LgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMKICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIHRyYW5zZmVyKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IGJhbGFuY2U7CgogICAgKGVycixiYWxhbmNlKSA9IHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0ubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CiAgICBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZTsKICAgIC8vSXQncyBub3QgcG9zc2libGUgdG8gb3ZlcmZsb3cgdG9rZW4gc3VwcGx5CiAgICBzZWxmLmJhbGFuY2VzW190b10gPSBzZWxmLmJhbGFuY2VzW190b10gKyBfdmFsdWU7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZWQgY2FsbGVyIHRyYW5zZmVycyB0b2tlbnMgZnJvbSBvbmUgYWNjb3VudCB0byBhbm90aGVyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfZnJvbSBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIGZyb20KICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHZhciBfYWxsb3dhbmNlID0gc2VsZi5hbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlT3duZXI7CiAgICB1aW50MjU2IGJhbGFuY2VTcGVuZGVyOwoKICAgIChlcnIsYmFsYW5jZU93bmVyKSA9IHNlbGYuYmFsYW5jZXNbX2Zyb21dLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIChlcnIsYmFsYW5jZVNwZW5kZXIpID0gX2FsbG93YW5jZS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VPd25lcjsKICAgIHNlbGYuYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBiYWxhbmNlU3BlbmRlcjsKICAgIHNlbGYuYmFsYW5jZXNbX3RvXSA9IHNlbGYuYmFsYW5jZXNbX3RvXSArIF92YWx1ZTsKCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZXRyaWV2ZSB0b2tlbiBiYWxhbmNlIGZvciBhbiBhY2NvdW50CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyB0byByZXRyaWV2ZSBiYWxhbmNlIG9mCiAgLy8vIEByZXR1cm4gYmFsYW5jZSBUaGUgbnVtYmVyIG9mIHRva2VucyBpbiB0aGUgc3ViamVjdCBhY2NvdW50CiAgZnVuY3Rpb24gYmFsYW5jZU9mKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBzZWxmLmJhbGFuY2VzW19vd25lcl07CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemUgYW4gYWNjb3VudCB0byBzZW5kIHRva2VucyBvbiBjYWxsZXIncyBiZWhhbGYKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3MgdG8gYXV0aG9yaXplCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyBhdXRob3JpemVkIGFjY291bnQgbWF5IHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmUoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUmVtYWluaW5nIHRva2VucyB0aGlyZCBwYXJ0eSBzcGVuZGVyIGhhcyB0byBzZW5kCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBob2xkZXIKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgYXV0aG9yaXplZCBzcGVuZGVyCiAgLy8vIEByZXR1cm4gcmVtYWluaW5nIE51bWJlciBvZiB0b2tlbnMgc3BlbmRlciBoYXMgbGVmdCBpbiBvd25lcidzIGFjY291bnQKICBmdW5jdGlvbiBhbGxvd2FuY2UoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gc2VsZi5hbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplIHRoaXJkIHBhcnR5IHRyYW5zZmVyIGJ5IGluY3JlYXNpbmcvZGVjcmVhc2luZyBhbGxvd2VkIHJhdGhlciB0aGFuIHNldHRpbmcgaXQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3MgdG8gYXV0aG9yaXplCiAgLy8vIEBwYXJhbSBfdmFsdWVDaGFuZ2UgSW5jcmVhc2Ugb3IgZGVjcmVhc2UgaW4gbnVtYmVyIG9mIHRva2VucyBhdXRob3JpemVkIGFjY291bnQgbWF5IHNlbmQKICAvLy8gQHBhcmFtIF9pbmNyZWFzZSBUcnVlIGlmIGluY3JlYXNpbmcgYWxsb3dhbmNlLCBmYWxzZSBpZiBkZWNyZWFzaW5nIGFsbG93YW5jZQogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYXBwcm92ZUNoYW5nZSAoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWVDaGFuZ2UsIGJvb2wgX2luY3JlYXNlKQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgdWludDI1NiBfbmV3QWxsb3dlZDsKICAgIGJvb2wgZXJyOwoKICAgIGlmKF9pbmNyZWFzZSkgewogICAgICAoZXJyLCBfbmV3QWxsb3dlZCkgPSBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLnBsdXMoX3ZhbHVlQ2hhbmdlKTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfbmV3QWxsb3dlZDsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChfdmFsdWVDaGFuZ2UgPiBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKSB7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX25ld0FsbG93ZWQgPSBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdIC0gX3ZhbHVlQ2hhbmdlOwogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfbmV3QWxsb3dlZDsKICAgICAgfQogICAgfQoKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfbmV3QWxsb3dlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IENoYW5nZSBvd25pbmcgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QsIHNwZWNpZmljYWxseSBmb3IgbWludGluZwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX25ld093bmVyIEFkZHJlc3MgZm9yIHRoZSBuZXcgb3duZXIKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX25ld093bmVyKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpICYmIChfbmV3T3duZXIgPiAwKSk7CgogICAgc2VsZi5vd25lciA9IF9uZXdPd25lcjsKICAgIE93bmVyQ2hhbmdlKG1zZy5zZW5kZXIsIF9uZXdPd25lcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IE1pbnRzIGFkZGl0aW9uYWwgdG9rZW5zLCBuZXcgdG9rZW5zIGdvIHRvIG93bmVyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IE51bWJlciBvZiB0b2tlbnMgdG8gbWludAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gbWludFRva2VuKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKSAmJiBzZWxmLnN0aWxsTWludGluZyk7CiAgICB1aW50MjU2IF9uZXdBbW91bnQ7CiAgICBib29sIGVycjsKCiAgICAoZXJyLCBfbmV3QW1vdW50KSA9IHNlbGYudG90YWxTdXBwbHkucGx1cyhfYW1vdW50KTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi50b3RhbFN1cHBseSA9ICBfbmV3QW1vdW50OwogICAgc2VsZi5iYWxhbmNlc1tzZWxmLm93bmVyXSA9IHNlbGYuYmFsYW5jZXNbc2VsZi5vd25lcl0gKyBfYW1vdW50OwogICAgVHJhbnNmZXIoMHgwLCBzZWxmLm93bmVyLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUGVybWFuZW50IHN0b3BzIG1pbnRpbmcKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGNsb3NlTWludChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcik7CgogICAgc2VsZi5zdGlsbE1pbnRpbmcgPSBmYWxzZTsKICAgIE1pbnRpbmdDbG9zZWQodHJ1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudGx5IGJ1cm4gdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgdG8gYnVybgogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYnVyblRva2VuKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCkgewogICAgICB1aW50MjU2IF9uZXdCYWxhbmNlOwogICAgICBib29sIGVycjsKCiAgICAgIChlcnIsIF9uZXdCYWxhbmNlKSA9IHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0ubWludXMoX2Ftb3VudCk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdID0gX25ld0JhbGFuY2U7CiAgICAgIHNlbGYudG90YWxTdXBwbHkgPSBzZWxmLnRvdGFsU3VwcGx5IC0gX2Ftb3VudDsKICAgICAgQnVybihtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfYW1vdW50KTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsKCi8qKgogKiBAdGl0bGUgQmFzaWMgTWF0aCBMaWJyYXJ5CiAqIEBhdXRob3IgTWFqb29sci5pbwogKgogKiB2ZXJzaW9uIDEuMS4wCiAqIENvcHlyaWdodCAoYykgMjAxNyBNYWpvb2xyLCBMTEMKICogVGhlIE1JVCBMaWNlbnNlIChNSVQpCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9NYWpvb2xyL2V0aGVyZXVtLWxpYnJhcmllcy9ibG9iL21hc3Rlci9MSUNFTlNFCiAqCiAqIFRoZSBCYXNpYyBNYXRoIExpYnJhcnkgaXMgaW5zcGlyZWQgYnkgdGhlIFNhZmUgTWF0aCBsaWJyYXJ5IHdyaXR0ZW4gYnkKICogT3BlblplcHBlbGluIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvIC4KICogTWFqb29sciB3b3JrcyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbiB0aGUgRXRoZXJldW0gY29tbXVuaXR5IHdpdGggdGhlCiAqIHB1cnBvc2Ugb2YgdGVzdGluZywgZG9jdW1lbnRpbmcsIGFuZCBkZXBsb3lpbmcgcmV1c2FibGUgY29kZSBvbnRvIHRoZQogKiBibG9ja2NoYWluIHRvIGltcHJvdmUgc2VjdXJpdHkgYW5kIHVzYWJpbGl0eSBvZiBzbWFydCBjb250cmFjdHMuIE1ham9vbHIKICogYWxzbyBzdHJpdmVzIHRvIGVkdWNhdGUgbm9uLXByb2ZpdHMsIHNjaG9vbHMsIGFuZCBvdGhlciBjb21tdW5pdHkgbWVtYmVycwogKiBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbiB0ZWNobm9sb2d5LgogKiBGb3IgZnVydGhlciBpbmZvcm1hdGlvbjogbWFqb29sci5pbywgb3BlbnplcHBlbGluLm9yZwogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwogKiBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKbGlicmFyeSBCYXNpY01hdGhMaWIgewogIGV2ZW50IEVycihzdHJpbmcgdHlwZUVycik7CgogIC8vLyBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHByb2R1Y3Qgb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHRpbWVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBtdWwoYSxiKQogICAgICBzd2l0Y2ggb3IoaXN6ZXJvKGIpLCBlcShkaXYocmVzLGIpLCBhKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICAgIGlmIChlcnIpCiAgICAgIEVycigidGltZXMgZnVuYyBvdmVyZmxvdyIpOwogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdyBidXQgcmF0aGVyIGxvZ3MgYW4gRXJyIGV2ZW50IGlmIDAgaXMgaW4gdGhlIGRpdmlzb3IuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIGBiYCBpcyAwCiAgLy8vIEByZXR1cm4gcmVzIFRoZSBxdW90aWVudCBvZiBhIGFuZCBiLCBvciAwIGlmIGBiYCBpcyAwCiAgZnVuY3Rpb24gZGl2aWRlZEJ5KHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHN3aXRjaCBpc3plcm8oYikKICAgICAgY2FzZSAwIHsKICAgICAgICByZXMgOj0gZGl2KGEsYikKICAgICAgICBtc3RvcmUoYWRkKG1sb2FkKDB4NDApLDB4MjApLHJlcykKICAgICAgICByZXR1cm4obWxvYWQoMHg0MCksMHg0MCkKICAgICAgfQogICAgfQogICAgRXJyKCJ0cmllZCB0byBkaXZpZGUgYnkgemVybyIpOwogICAgcmV0dXJuICh0cnVlLCAwKTsKICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHN1bSBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gcGx1cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBlcnIsIHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IGFkZChhLGIpCiAgICAgIHN3aXRjaCBhbmQoZXEoc3ViKHJlcyxiKSwgYSksIG9yKGd0KHJlcyxiKSxlcShyZXMsYikpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogICAgaWYgKGVycikKICAgICAgRXJyKCJwbHVzIGZ1bmMgb3ZlcmZsb3ciKTsKICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgICBpZiAoZXJyKQogICAgICBFcnIoIm1pbnVzIGZ1bmMgdW5kZXJmbG93Iik7CiAgfQp9'.
	

]
