Class {
	#name : #SRTdd9dbcc279b0e034ce74db24015ebf2606d88539,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdd9dbcc279b0e034ce74db24015ebf2606d88539 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFdhbGxldCBNYWluIExpYnJhcnkKICogQGF1dGhvciBNYWpvb2xyLmlvCiAqCiAqIHZlcnNpb24gMS4wLjAKICogQ29weXJpZ2h0IChjKSAyMDE3IE1ham9vbHIsIExMQwogKiBUaGUgTUlUIExpY2Vuc2UgKE1JVCkKICogaHR0cHM6Ly9naXRodWIuY29tL01ham9vbHIvZXRoZXJldW0tbGlicmFyaWVzL2Jsb2IvbWFzdGVyL0xJQ0VOU0UKICoKICogVGhlIFdhbGxldCBMaWJyYXJ5IGZhbWlseSBpcyBpbnNwaXJlZCBieSB0aGUgbXVsdGlzaWcgd2FsbGV0cyBidWlsdCBieSBDb25zZW5zeXMKICogYXQgaHR0cHM6Ly9naXRodWIuY29tL0NvbnNlblN5cy9NdWx0aVNpZ1dhbGxldCBhbmQgUGFyaXR5IGF0CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXJpdHl0ZWNoL2NvbnRyYWN0cy9ibG9iL21hc3Rlci9XYWxsZXQuc29sIHdpdGggYWRkZWQKICogZnVuY3Rpb25hbGl0eS4gTWFqb29sciB3b3JrcyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbiB0aGUgRXRoZXJldW0KICogY29tbXVuaXR5IHdpdGggdGhlIHB1cnBvc2Ugb2YgdGVzdGluZywgZG9jdW1lbnRpbmcsIGFuZCBkZXBsb3lpbmcgcmV1c2FibGUKICogY29kZSBvbnRvIHRoZSBibG9ja2NoYWluIHRvIGltcHJvdmUgc2VjdXJpdHkgYW5kIHVzYWJpbGl0eSBvZiBzbWFydCBjb250cmFjdHMuCiAqIE1ham9vbHIgYWxzbyBzdHJpdmVzIHRvIGVkdWNhdGUgbm9uLXByb2ZpdHMsIHNjaG9vbHMsIGFuZCBvdGhlciBjb21tdW5pdHkKICogbWVtYmVycyBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbiB0ZWNobm9sb2d5LiBGb3IgZnVydGhlcgogKiBpbmZvcm1hdGlvbjogbWFqb29sci5pbywgY29uc2Vuc3lzLm5ldCwgcGFyaXR5dGVjaC5pbwogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwogKiBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKbGlicmFyeSBXYWxsZXRNYWluTGliIHsKICB1c2luZyBBcnJheTI1NkxpYiBmb3IgdWludDI1NltdOwogIHVzaW5nIEJhc2ljTWF0aExpYiBmb3IgdWludDsKCiAgc3RydWN0IFdhbGxldERhdGEgewogICAgdWludCBtYXhPd25lcnM7IC8vTWF4aW11bSB3YWxsZXQgb3duZXJzLCBzaG91bGQgYmUgNTAKICAgIGFkZHJlc3NbXSBvd25lcnM7IC8vQXJyYXkgb2YgYWxsIG93bmVycwogICAgdWludCByZXF1aXJlZEFkbWluOyAvL051bWJlciBvZiBzaWdzIHJlcXVpcmVkIGZvciBhZG1pbmlzdHJhdGl2ZSBjaGFuZ2VzCiAgICB1aW50IHJlcXVpcmVkTWFqb3I7IC8vTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgZm9yIG1ham9yIHRyYW5zYWN0aW9ucwogICAgdWludCByZXF1aXJlZE1pbm9yOyAvL051bWJlciBvZiBzaWdzIHJlcXVpcmVkIGZvciBtaW5vciB0cmFuc2FjdGlvbnMKCiAgICAvLyBUaGUgYW1vdW50IG9mIGEgdG9rZW4gc3BlbnQgcGVyIGRheSwgZXRoZXIgaXMgYXQgYWRkcmVzcyBtYXBwaW5nIDAsCiAgICAvLyBhbGwgb3RoZXIgdG9rZW5zIGRlZmluZWQgYnkgYWRkcmVzcy4gdWludFswXSBjb3JyZXNwb25kcyB0byB0aGUgY3VycmVudAogICAgLy8gZGF5LCAgdWludFsxXSBpcyB0aGUgc3BlbmQgYW1vdW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnRbMl0pIGN1cnJlbnRTcGVuZDsKICAgIC8vVGhlIGRheSBzcGVuZCB0aHJlc2hvbGQgZm9yIHRyYW5zYWN0aW9ucyB0byBiZSBtYWpvciwgZXRoZXIgYXQgMCwgYWxsIG90aGVycyBieSBhZGRyZXNzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIG1ham9yVGhyZXNob2xkOwogICAgLy9BcnJheSBvZiB0cmFuc2FjdGlvbnMgcGVyIGRheSwgdWludCBpcyB0aGUgZGF5IHRpbWVzdGFtcCwgYnl0ZXMzMiBpcyB0aGUgdHJhbnNhY3Rpb24gaWQKICAgIG1hcHBpbmcgKHVpbnQgPT4gYnl0ZXMzMltdKSB0cmFuc2FjdGlvbnM7CiAgICAvL1RyYWNrcyB0aGUgaW5kZXggb2YgZWFjaCBvd25lciBpbiB0aGUgb3duZXJzIEFycmF5CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIG93bmVySW5kZXg7CiAgICAvL0FycmF5IG9mIFRyYW5zYWN0aW9uJ3MgYnkgaWQsIG5ldyB0eCdzIHdpdGggZXhhY3QgaW5wdXRzIGFzIHByZXZpb3VzIHR4IHdpbGwgYWRkIHRvIGFycmF5CiAgICBtYXBwaW5nIChieXRlczMyID0+IFRyYW5zYWN0aW9uW10pIHRyYW5zYWN0aW9uSW5mbzsKCiAgfQoKICBzdHJ1Y3QgVHJhbnNhY3Rpb24gewogICAgdWludCBkYXk7IC8vVGltZXN0YW1wIG9mIHRoZSBkYXkgaW5pdGlhbGl6ZWQKICAgIHVpbnQgdmFsdWU7IC8vQW1vdW50IG9mIGV0aGVyIGJlaW5nIHNlbnQKICAgIGFkZHJlc3MgdG9rZW5BZHJlc3M7IC8vQWRkcmVzcyBvZiB0b2tlbiB0cmFuc2ZlcnJlZAogICAgdWludCBhbW91bnQ7IC8vQW1vdW50IG9mIHRva2VucyB0cmFuc2ZlcnJlZAogICAgYnl0ZXMgZGF0YTsgLy9UZW1wIGxvY2F0aW9uIGZvciBwZW5kaW5nIHRyYW5zYWN0aW9ucywgZXJhc2VkIGFmdGVyIGZpbmFsIGNvbmZpcm1hdGlvbgogICAgdWludDI1NltdIGNvbmZpcm1lZE93bmVyczsgLy9BcnJheSBvZiBvd25lcnMgY29uZmlybWluZyB0cmFuc2FjdGlvbgogICAgdWludCBjb25maXJtQ291bnQ7IC8vVHJhY2tzIHRoZSBudW1iZXIgb2YgY29uZmlybXMKICAgIHVpbnQgY29uZmlybVJlcXVpcmVkOyAvL051bWJlciBvZiBzaWdzIHJlcXVpcmVkIGZvciB0aGlzIHRyYW5zYWN0aW9uCiAgICBib29sIHN1Y2Nlc3M7IC8vVHJ1ZSBhZnRlciBmaW5hbCBjb25maXJtYXRpb24KICB9CgogIC8qRXZlbnRzKi8KICBldmVudCBMb2dSZXZva2VOb3RpY2UoYnl0ZXMzMiB0eGlkLCBhZGRyZXNzIHNlbmRlciwgdWludCBjb25maXJtc05lZWRlZCk7CiAgZXZlbnQgTG9nVHJhbnNhY3Rpb25GYWlsZWQoYnl0ZXMzMiB0eGlkLCBhZGRyZXNzIHNlbmRlcik7CiAgZXZlbnQgTG9nVHJhbnNhY3Rpb25Db25maXJtZWQoYnl0ZXMzMiB0eGlkLCBhZGRyZXNzIHNlbmRlciwgdWludCBjb25maXJtc05lZWRlZCk7CiAgZXZlbnQgTG9nVHJhbnNhY3Rpb25Db21wbGV0ZShieXRlczMyIHR4aWQsIGFkZHJlc3MgdGFyZ2V0LCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKTsKICBldmVudCBMb2dDb250cmFjdENyZWF0ZWQoYWRkcmVzcyBuZXdDb250cmFjdCwgdWludCB2YWx1ZSk7CiAgZXZlbnQgTG9nRXJyTXNnKHN0cmluZyBtc2cpOwoKICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogIC8vLyBAcGFyYW0gc2VsZiBUaGUgd2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9vd25lcnMgQXJyYXkgb2YgaW5pdGlhbCBvd25lcnMKICAvLy8gQHBhcmFtIF9yZXF1aXJlZEFkbWluIFNldCBudW1iZXIgb2Ygc2lncyBmb3IgYWRtaW5pc3RyYXRpdmUgdGFza3MKICAvLy8gQHBhcmFtIF9yZXF1aXJlZE1ham9yIFNldCBudW1iZXIgb2Ygc2lncyBmb3IgbWFqb3IgdHgKICAvLy8gQHBhcmFtIF9yZXF1aXJlZE1pbm9yIFNldCBudW1iZXIgb2Ygc2lncyBmb3IgbWlub3IgdHgKICAvLy8gQHBhcmFtIF9tYWpvclRocmVzaG9sZCBTZXQgbWFqb3IgdHggdGhyZXNob2xkIGFtb3VudCBmb3IgZXRoZXIKICAvLy8gQHJldHVybiBXaWxsIHJldHVybiB0cnVlIHdoZW4gY29tcGxldGUKICBmdW5jdGlvbiBpbml0KFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzc1tdIF9vd25lcnMsCiAgICAgICAgICAgICAgICB1aW50IF9yZXF1aXJlZEFkbWluLAogICAgICAgICAgICAgICAgdWludCBfcmVxdWlyZWRNYWpvciwKICAgICAgICAgICAgICAgIHVpbnQgX3JlcXVpcmVkTWlub3IsCiAgICAgICAgICAgICAgICB1aW50IF9tYWpvclRocmVzaG9sZCkgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKHNlbGYub3duZXJzLmxlbmd0aCA9PSAwKTsKICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPj0gX3JlcXVpcmVkQWRtaW4gJiYgX3JlcXVpcmVkQWRtaW4gPiAwKTsKICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPj0gX3JlcXVpcmVkTWFqb3IgJiYgX3JlcXVpcmVkTWFqb3IgPiAwKTsKICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPj0gX3JlcXVpcmVkTWlub3IgJiYgX3JlcXVpcmVkTWlub3IgPiAwKTsKICAgIHNlbGYub3duZXJzLnB1c2goMCk7IC8vTGVhdmUgaW5kZXgtMCBlbXB0eSBmb3IgZWFzaWVyIG93bmVyIGNoZWNrcwoKICAgIGZvciAodWludCBpPTA7IGk8X293bmVycy5sZW5ndGg7IGkrKykgewogICAgICByZXF1aXJlKF9vd25lcnNbaV0gIT0gMCk7CiAgICAgIHNlbGYub3duZXJzLnB1c2goX293bmVyc1tpXSk7CiAgICAgIHNlbGYub3duZXJJbmRleFtfb3duZXJzW2ldXSA9IGkrMTsKICAgIH0KICAgIHNlbGYucmVxdWlyZWRBZG1pbiA9IF9yZXF1aXJlZEFkbWluOwogICAgc2VsZi5yZXF1aXJlZE1ham9yID0gX3JlcXVpcmVkTWFqb3I7CiAgICBzZWxmLnJlcXVpcmVkTWlub3IgPSBfcmVxdWlyZWRNaW5vcjsKICAgIHNlbGYubWF4T3duZXJzID0gNTA7IC8vTGltaXRzIHRvIDUwIG93bmVycywgc2hvdWxkIGNyZWF0ZSB3YWxsZXQgcG9vbHMgZm9yIG1vcmUgb3duZXJzCiAgICBzZWxmLm1ham9yVGhyZXNob2xkWzBdID0gX21ham9yVGhyZXNob2xkOyAvL1NldHMgZXRoZXIgdGhyZXNob2xkIGF0IGFkZHJlc3MgMAoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLypDaGVja3MqLwoKICAvLy8gQGRldiBWZXJpZmllcyBhIGNvbmZpcm1pbmcgb3duZXIgaGFzIG5vdCBjb25maXJtZWQgYWxyZWFkeQogIC8vLyBAcGFyYW0gc2VsZiBDb250cmFjdCB3YWxsZXQgaW4gc3RvcmFnZQogIC8vLyBAcGFyYW0gX2lkIElEIG9mIHRoZSB0eCBiZWluZyBjaGVja2VkCiAgLy8vIEBwYXJhbSBfbnVtYmVyIEluZGV4IG51bWJlciBvZiB0aGlzIHR4CiAgLy8vIEByZXR1cm4gUmV0dXJucyB0cnVlIGlmIGNoZWNrIHBhc3NlcywgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gY2hlY2tOb3RDb25maXJtZWQoV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsIGJ5dGVzMzIgX2lkLCB1aW50IF9udW1iZXIpCiAgICAgICAgICAgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKHNlbGYub3duZXJJbmRleFttc2cuc2VuZGVyXSA+IDApOwogICAgdWludCBfdHhMZW4gPSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdLmxlbmd0aDsKCiAgICBpZihfdHhMZW4gPT0gMCB8fCBfbnVtYmVyID49IF90eExlbil7CiAgICAgIExvZ0Vyck1zZygiVHggbm90IGluaXRpYXRlZCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5zdWNjZXNzKXsKICAgICAgTG9nRXJyTXNnKCJUcmFuc2FjdGlvbiBhbHJlYWR5IGNvbXBsZXRlIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvL0Z1bmN0aW9uIGZyb20gTWFqb29sci5pbyBhcnJheSB1dGlsaXR5IGxpYnJhcnkKICAgIGJvb2wgZm91bmQ7CiAgICB1aW50IGluZGV4OwogICAgKGZvdW5kLCBpbmRleCkgPSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1lZE93bmVycy5pbmRleE9mKHVpbnQobXNnLnNlbmRlciksIGZhbHNlKTsKICAgIGlmKGZvdW5kKXsKICAgICAgTG9nRXJyTXNnKCJPd25lciBhbHJlYWR5IGNvbmZpcm1lZCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKlV0aWxpdHkgRnVuY3Rpb25zKi8KCiAgLy8vIEBkZXYgVXNlZCBsYXRlciB0byBjYWxjdWxhdGUgdGhlIG51bWJlciBvZiBjb25maXJtYXRpb25zIG5lZWRlZCBmb3IgdHgKICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2Ygc2lncyByZXF1aXJlZAogIC8vLyBAcGFyYW0gX2NvdW50IEN1cnJlbnQgbnVtYmVyIG9mIHNpZ3MKICBmdW5jdGlvbiBjYWxjQ29uZmlybXNOZWVkZWQodWludCBfcmVxdWlyZWQsIHVpbnQgX2NvdW50KSBjb25zdGFudCByZXR1cm5zICh1aW50KXsKICAgIHJldHVybiBfcmVxdWlyZWQgLSBfY291bnQ7CiAgfQoKICAvLy8gQGRldiBVc2VkIHRvIGNoZWNrIGlmIHR4IGlzIG1vdmluZyB0b2tlbnMgYW5kIHBhcnNlcyBhbW91bnQKICAvLy8gQHBhcmFtIF90eERhdGEgRGF0YSBmb3IgcHJvcG9zZWQgdHgKICAvLy8gQHJldHVybiBib29sIFRydWUgaWYgdHJhbnNhY3Rpb24gaXMgbW92aW5nIHRva2VucwogIC8vLyBAcmV0dXJuIHVpbnQgQW1vdW50IG9mIHRva2VucyBpbnZvbHZlZCwgMCBpZiBub3Qgc3BlbmRpbmcgdHgKICBmdW5jdGlvbiBnZXRBbW91bnQoYnl0ZXMgX3R4RGF0YSkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCx1aW50KSB7CiAgICBieXRlczMyIGdldFNpZzsKICAgIGJ5dGVzNCBzaWc7CiAgICBieXRlczQgdFNpZyA9IDB4YTkwNTljYmI7IC8vdHJhbnNmZXIgZnVuYyBzaWduYXR1cmUKICAgIGJ5dGVzNCBhU2lnID0gMHgwOTVlYTdiMzsgLy9hcHByb3ZlIGZ1bmMgc2lnbmF0dXJlCiAgICBieXRlczQgdGZTaWcgPSAweDIzYjg3MmRkOyAvL3RyYW5zZmVyRnJvbSBmdW5jIHNpZ25hdHVyZQogICAgYm9vbCB0cmFuc2ZlcjsKICAgIGJ5dGVzMzIgX2Ftb3VudERhdGE7CiAgICB1aW50IF9hbW91bnQ7CgogICAgYXNzZW1ibHkgeyBnZXRTaWcgOj0gbWxvYWQoYWRkKF90eERhdGEsMHgyMCkpIH0KICAgIHNpZyA9IGJ5dGVzNChnZXRTaWcpOwogICAgaWYoc2lnID09ICB0U2lnIHx8IHNpZyA9PSBhU2lnKXsKICAgICAgdHJhbnNmZXIgPSB0cnVlOwogICAgICBhc3NlbWJseSB7IF9hbW91bnREYXRhIDo9IG1sb2FkKGFkZChfdHhEYXRhLDB4NDQpKSB9CiAgICAgIF9hbW91bnQgPSB1aW50KF9hbW91bnREYXRhKTsKICAgIH0gZWxzZSBpZihzaWcgPT0gdGZTaWcpewogICAgICB0cmFuc2ZlciA9IHRydWU7CiAgICAgIGFzc2VtYmx5IHsgX2Ftb3VudERhdGEgOj0gbWxvYWQoYWRkKF90eERhdGEsMHg2NCkpIH0KICAgICAgX2Ftb3VudCA9IHVpbnQoX2Ftb3VudERhdGEpOwogICAgfQogICAgcmV0dXJuICh0cmFuc2ZlcixfYW1vdW50KTsKICB9CgogIC8vLyBAZGV2IFJldHJpZXZlcyBzaWcgcmVxdWlyZW1lbnQgZm9yIHNwZW5kaW5nIHR4CiAgLy8vIEBwYXJhbSBzZWxmIENvbnRyYWN0IHdhbGxldCBpbiBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfdG8gVGFyZ2V0IGFkZHJlc3Mgb2YgdHJhbnNhY3Rpb24KICAvLy8gQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgZXRoZXIgc3BlbmQKICAvLy8gQHBhcmFtIF9pc1RyYW5zZmVyIFRydWUgaWYgdHJhbnNmZXJyaW5nIG90aGVyIHRva2VucywgZmFsc2Ugb3RoZXJ3aXNlCiAgLy8vIEBwYXJhbSBfYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQsIDAgaWYgbm90IGEgdHJhbnNmZXIgdHgKICAvLy8gQHJldHVybiB1aW50IFRoZSByZXF1aXJlZCBzaWdzIGZvciB0eAogIGZ1bmN0aW9uIGdldFJlcXVpcmVkKFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX3ZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgIGJvb2wgX2lzVHJhbnNmZXIsCiAgICAgICAgICAgICAgICAgICAgICAgdWludCBfYW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKHVpbnQpCiAgewogICAgYm9vbCBlcnI7CiAgICB1aW50IHJlczsKICAgIGJvb2wgbWFqb3IgPSB0cnVlOwogICAgLy9SZXNldCBzcGVuZCBpZiB0aGlzIGlzIGZpcnN0IGNoZWNrIG9mIHRoZSBkYXkKICAgIGlmKChub3cvIDEgZGF5cykgPiBzZWxmLmN1cnJlbnRTcGVuZFswXVswXSl7CiAgICAgIHNlbGYuY3VycmVudFNwZW5kWzBdWzBdID0gbm93IC8gMSBkYXlzOwogICAgICBzZWxmLmN1cnJlbnRTcGVuZFswXVsxXSA9IDA7CiAgICB9CgogICAgKGVyciwgcmVzKSA9IHNlbGYuY3VycmVudFNwZW5kWzBdWzFdLnBsdXMoX3ZhbHVlKTsKICAgIGlmKGVycil7CiAgICAgIExvZ0Vyck1zZygiT3ZlcmZsb3cgZXRoIHNwZW5kIik7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGlmKHJlcyA8IHNlbGYubWFqb3JUaHJlc2hvbGRbMF0pCiAgICAgIG1ham9yID0gZmFsc2U7CgogICAgaWYoX3RvICE9IDAgJiYgX2lzVHJhbnNmZXIpewogICAgICBpZigobm93IC8gMSBkYXlzKSA+IHNlbGYuY3VycmVudFNwZW5kW190b11bMF0pewogICAgICAgIHNlbGYuY3VycmVudFNwZW5kW190b11bMF0gPSBub3cgLyAxIGRheXM7CiAgICAgICAgc2VsZi5jdXJyZW50U3BlbmRbX3RvXVsxXSA9IDA7CiAgICAgIH0KCiAgICAgIChlcnIsIHJlcykgPSBzZWxmLmN1cnJlbnRTcGVuZFtfdG9dWzFdLnBsdXMoX2Ftb3VudCk7CiAgICAgIGlmKGVycil7CiAgICAgICAgTG9nRXJyTXNnKCJPdmVyZmxvdyB0b2tlbiBzcGVuZCIpOwogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGlmKHJlcyA+PSBzZWxmLm1ham9yVGhyZXNob2xkW190b10pCiAgICAgICAgbWFqb3IgPSB0cnVlOwogICAgfQoKICAgIHJldHVybiBtYWpvciA/IHNlbGYucmVxdWlyZWRNYWpvciA6IHNlbGYucmVxdWlyZWRNaW5vcjsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGNyZWF0ZSBuZXcgY29udHJhY3QKICAvLy8gQHBhcmFtIF90eERhdGEgVHJhbnNhY3Rpb24gZGF0YQogIC8vLyBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiBldGggc2VuZGluZyB0byBuZXcgY29udHJhY3QKICBmdW5jdGlvbiBjcmVhdGVDb250cmFjdChieXRlcyBfdHhEYXRhLCB1aW50IF92YWx1ZSkgewogICAgYWRkcmVzcyBfbmV3Q29udHJhY3Q7CiAgICBib29sIGFsbEdvb2Q7CgogICAgYXNzZW1ibHkgewogICAgICBfbmV3Q29udHJhY3QgOj0gY3JlYXRlKF92YWx1ZSwgYWRkKF90eERhdGEsIDB4MjApLCBtbG9hZChfdHhEYXRhKSkKICAgICAgYWxsR29vZCA6PSBndChleHRjb2Rlc2l6ZShfbmV3Q29udHJhY3QpLDApCiAgICB9CiAgICByZXF1aXJlKGFsbEdvb2QpOwogICAgTG9nQ29udHJhY3RDcmVhdGVkKF9uZXdDb250cmFjdCwgX3ZhbHVlKTsKICB9CgogIC8qUHJpbWFyeSBGdW5jdGlvbiovCgogIC8vLyBAZGV2IENyZWF0ZSBhbmQgZXhlY3V0ZSB0cmFuc2FjdGlvbiBmcm9tIHdhbGxldAogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdGFyZ2V0CiAgLy8vIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIGV0aGVyIHNlbmRpbmcKICAvLy8gQHBhcmFtIF90eERhdGEgRGF0YSBmb3IgZXhlY3V0aW5nIHRyYW5zYWN0aW9uCiAgLy8vIEBwYXJhbSBfY29uZmlybSBUcnVlIGlmIGNvbmZpcm1pbmcsIGZhbHNlIGlmIHJldm9raW5nIGNvbmZpcm1hdGlvbgogIC8vLyBAcGFyYW0gX2RhdGEgTWVzc2FnZSBkYXRhIHBhc3NlZCBmcm9tIHdhbGxldCBjb250cmFjdAogIC8vLyBAcmV0dXJuIGJvb2wgUmV0dXJucyB0cnVlIGlmIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogIC8vLyBAcmV0dXJuIGJ5dGVzMzIgUmV0dXJucyB0aGUgdHggSUQsIGNhbiBiZSB1c2VkIGZvciBjb25maXJtL3Jldm9rZSBmdW5jdGlvbnMKICBmdW5jdGlvbiBzZXJ2ZVR4KFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgICAgICAgICAgICB1aW50IF92YWx1ZSwKICAgICAgICAgICAgICAgICAgIGJ5dGVzIF90eERhdGEsCiAgICAgICAgICAgICAgICAgICBib29sIF9jb25maXJtLAogICAgICAgICAgICAgICAgICAgYnl0ZXMgX2RhdGEpCiAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sLGJ5dGVzMzIpCiAgewogICAgYnl0ZXMzMiBfaWQgPSBzaGEzKCJzZXJ2ZVR4IixfdG8sX3ZhbHVlLF90eERhdGEpOwogICAgdWludCBfbnVtYmVyID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CiAgICB1aW50IF9yZXF1aXJlZCA9IHNlbGYucmVxdWlyZWRNYWpvcjsKCiAgICAvL1J1biBjaGVja3MgaWYgbm90IGNhbGxlZCBmcm9tIGdlbmVyaWMgY29uZmlybS9yZXZva2UgZnVuY3Rpb24KICAgIGlmKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh0aGlzKSl7CiAgICAgIGJvb2wgYWxsR29vZDsKICAgICAgdWludCBfYW1vdW50OwogICAgICAvLyBpZiB0aGUgb3duZXIgaXMgcmV2b2tpbmcgaGlzL2hlciBjb25maXJtYXRpb24gYnV0IGRvZXNuJ3Qga25vdyB0aGUKICAgICAgLy8gc3BlY2lmaWMgdHJhbnNhY3Rpb24gaWQgaGFzaAogICAgICBpZighX2NvbmZpcm0pIHsKICAgICAgICBhbGxHb29kID0gcmV2b2tlQ29uZmlybShzZWxmLCBfaWQpOwogICAgICAgIHJldHVybiAoYWxsR29vZCxfaWQpOwogICAgICB9IGVsc2UgeyAvLyBlbHNlIGNvbmZpcm1pbmcgdGhlIHRyYW5zYWN0aW9uCiAgICAgICAgLy9pZiB0aGlzIGlzIGEgbmV3IHRyYW5zYWN0aW9uIGlkIG9yIGlmIGEgcHJldmlvdXMgaWRlbnRpY2FsIHRyYW5zYWN0aW9uIGhhZCBhbHJlYWR5IHN1Y2NlZWRlZAogICAgICAgIGlmKF9udW1iZXIgPT0gMCB8fCBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXIgLSAxXS5zdWNjZXNzKXsKICAgICAgICAgIHJlcXVpcmUoc2VsZi5vd25lckluZGV4W21zZy5zZW5kZXJdID4gMCk7CgogICAgICAgICAgLy9SZXVzZSBhbGxHb29kIGR1ZSB0byBzdGFjayBsaW1pdAogICAgICAgICAgaWYoX3RvICE9IDApCiAgICAgICAgICAgIChhbGxHb29kLF9hbW91bnQpID0gZ2V0QW1vdW50KF90eERhdGEpOwoKICAgICAgICAgIF9yZXF1aXJlZCA9IGdldFJlcXVpcmVkKHNlbGYsIF90bywgX3ZhbHVlLCBhbGxHb29kLF9hbW91bnQpOwogICAgICAgICAgaWYoX3JlcXVpcmVkID09IDApCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIF9pZCk7CgogICAgICAgICAgLy8gYWRkIHRoaXMgdHJhbnNhY3Rpb24gdG8gdGhlIHdhbGxldHMgcmVjb3JkIGFuZCBpbml0aWFsaXplIHRoZSBzZXR0aW5ncwogICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGgrKzsKICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybVJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5kYXkgPSBub3cgLyAxIGRheXM7CiAgICAgICAgICBzZWxmLnRyYW5zYWN0aW9uc1tub3cgLyAxIGRheXNdLnB1c2goX2lkKTsKICAgICAgICB9IGVsc2UgeyAvLyBlbHNlIHRoZSB0cmFuc2FjdGlvbiBpcyBhbHJlYWR5IHBlbmRpbmcKICAgICAgICAgIF9udW1iZXItLTsgLy8gc2V0IHRoZSBpbmRleCB0byB0aGUgaW5kZXggb2YgdGhlIGV4aXN0aW5nIHRyYW5zYWN0aW9uCiAgICAgICAgICAvL21ha2Ugc3VyZSB0aGUgc2VuZGVyIGlzbid0IGFscmVhZHkgY29uZmlybWVkCiAgICAgICAgICBhbGxHb29kID0gY2hlY2tOb3RDb25maXJtZWQoc2VsZiwgX2lkLCBfbnVtYmVyKTsKICAgICAgICAgIGlmKCFhbGxHb29kKQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLF9pZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBhZGQgdGhlIHNlbmRlcnMgY29uZmlybWF0aW9uIHRvIHRoZSB0cmFuc2FjdGlvbgogICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1lZE93bmVycy5wdXNoKHVpbnQobXNnLnNlbmRlcikpOwogICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1Db3VudCsrOwogICAgfWVsc2UgewogICAgICAvLyBlbHNlIHdlcmUgY2FsbGluZyBmcm9tIGdlbmVyaWMgY29uZmlybS9yZXZva2UgZnVuY3Rpb24sIHNldCB0aGUKICAgICAgLy8gX251bWJlciBpbmRleCB0byB0aGUgaW5kZXggb2YgdGhlIGV4aXN0aW5nIHRyYW5zYWN0aW9uCiAgICAgIF9udW1iZXItLTsKICAgIH0KCiAgICAvLyBpZiB0aGVyZSBhcmUgZW5vdWdoIGNvbmZpcm1hdGlvbnMKICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybUNvdW50ID09CiAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1SZXF1aXJlZCkKICAgIHsKICAgICAgLy8gZXhlY3V0ZSB0aGUgdHJhbnNhY3Rpb24KICAgICAgc2VsZi5jdXJyZW50U3BlbmRbMF1bMV0gKz0gX3ZhbHVlOwogICAgICBzZWxmLmN1cnJlbnRTcGVuZFtfdG9dWzFdICs9IF9hbW91bnQ7CiAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uc3VjY2VzcyA9IHRydWU7CgogICAgICBpZihfdG8gPT0gMCl7CiAgICAgICAgLy9GYWlsdXJlIGlzIHNlbGYgY29udGFpbmVkIGluIG1ldGhvZAogICAgICAgIGNyZWF0ZUNvbnRyYWN0KF90eERhdGEsIF92YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVxdWlyZShfdG8uY2FsbC52YWx1ZShfdmFsdWUpKF90eERhdGEpKTsKICAgICAgfQogICAgICBkZWxldGUgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5kYXRhOwogICAgICBMb2dUcmFuc2FjdGlvbkNvbXBsZXRlKF9pZCwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uZGF0YS5sZW5ndGggPT0gMCkKICAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmRhdGEgPSBfZGF0YTsKCiAgICAgIHVpbnQgY29uZmlybXNOZWVkZWQgPSBjYWxjQ29uZmlybXNOZWVkZWQoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5jb25maXJtUmVxdWlyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5jb25maXJtQ291bnQpOwogICAgICBMb2dUcmFuc2FjdGlvbkNvbmZpcm1lZChfaWQsIG1zZy5zZW5kZXIsIGNvbmZpcm1zTmVlZGVkKTsKICAgIH0KCiAgICByZXR1cm4gKHRydWUsX2lkKTsKICB9CgogIC8qQ29uZmlybS9SZXZva2UgZnVuY3Rpb25zIHVzaW5nIHR4IElEKi8KCiAgLy8vIEBkZXYgQ29uZmlybXMgYSBjdXJyZW50IHBlbmRpbmcgdHgsIHdpbGwgZXhlY3V0ZSBpZiBmaW5hbCBjb25maXJtYXRpb24KICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9pZCBJRCBvZiB0aGUgdHJhbnNhY3Rpb24KICAvLy8gQHJldHVybiBSZXR1cm5zIHRydWUgaWYgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gY29uZmlybVR4KFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9pZCkgcmV0dXJucyAoYm9vbCl7CiAgICByZXF1aXJlKHNlbGYub3duZXJJbmRleFttc2cuc2VuZGVyXSA+IDApOwogICAgdWludCBfbnVtYmVyID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CiAgICBib29sIHJldDsKCiAgICBpZihfbnVtYmVyID09IDApewogICAgICBMb2dFcnJNc2coIlR4IG5vdCBpbml0aWF0ZWQiKTsKICAgICAgTG9nVHJhbnNhY3Rpb25GYWlsZWQoX2lkLCBtc2cuc2VuZGVyKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIF9udW1iZXItLTsKICAgIGJvb2wgYWxsR29vZCA9IGNoZWNrTm90Q29uZmlybWVkKHNlbGYsIF9pZCwgX251bWJlcik7CiAgICBpZighYWxsR29vZCkKICAgICAgcmV0dXJuIGZhbHNlOwoKICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybWVkT3duZXJzLnB1c2godWludDI1Nihtc2cuc2VuZGVyKSk7CiAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1Db3VudCsrOwoKICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybUNvdW50ID09CiAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1SZXF1aXJlZCkKICAgIHsKICAgICAgYWRkcmVzcyBhID0gYWRkcmVzcyh0aGlzKTsKICAgICAgcmVxdWlyZShhLmNhbGwoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5kYXRhKSk7CiAgICB9IGVsc2UgewogICAgICB1aW50IGNvbmZpcm1zTmVlZGVkID0gY2FsY0NvbmZpcm1zTmVlZGVkKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybVJlcXVpcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybUNvdW50KTsKCiAgICAgIExvZ1RyYW5zYWN0aW9uQ29uZmlybWVkKF9pZCwgbXNnLnNlbmRlciwgY29uZmlybXNOZWVkZWQpOwogICAgICByZXQgPSB0cnVlOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfQoKICAvLy8gQGRldiBSZXZva2VzIGEgcHJpb3IgY29uZmlybWF0aW9uIGZyb20gc2VuZGVyLCBjYWxsIHdpdGggdHggSUQKICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9pZCBJRCBvZiB0aGUgdHJhbnNhY3Rpb24KICAvLy8gQHJldHVybiBSZXR1cm5zIHRydWUgaWYgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gcmV2b2tlQ29uZmlybShXYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwgYnl0ZXMzMiBfaWQpCiAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKHNlbGYub3duZXJJbmRleFttc2cuc2VuZGVyXSA+IDApOwogICAgdWludCBfbnVtYmVyID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CgogICAgaWYoX251bWJlciA9PSAwKXsKICAgICAgTG9nRXJyTXNnKCJUeCBub3QgaW5pdGlhdGVkIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBfbnVtYmVyLS07CiAgICBpZihzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLnN1Y2Nlc3MpewogICAgICBMb2dFcnJNc2coIlRyYW5zYWN0aW9uIGFscmVhZHkgY29tcGxldGUiKTsKICAgICAgTG9nVHJhbnNhY3Rpb25GYWlsZWQoX2lkLCBtc2cuc2VuZGVyKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vRnVuY3Rpb24gZnJvbSBNYWpvb2xyLmlvIGFycmF5IHV0aWxpdHkgbGlicmFyeQogICAgYm9vbCBmb3VuZDsKICAgIHVpbnQgaW5kZXg7CiAgICAoZm91bmQsIGluZGV4KSA9IHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybWVkT3duZXJzLmluZGV4T2YodWludChtc2cuc2VuZGVyKSwgZmFsc2UpOwogICAgaWYoIWZvdW5kKXsKICAgICAgTG9nRXJyTXNnKCJPd25lciBoYXMgbm90IGNvbmZpcm1lZCB0eCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1lZE93bmVyc1tpbmRleF0gPSAwOwogICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5jb25maXJtQ291bnQtLTsKCiAgICB1aW50IGNvbmZpcm1zTmVlZGVkID0gY2FsY0NvbmZpcm1zTmVlZGVkKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX251bWJlcl0uY29uZmlybVJlcXVpcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW19udW1iZXJdLmNvbmZpcm1Db3VudCk7CiAgICAvL1RyYW5zYWN0aW9uIHJlbW92ZWQgaWYgYWxsIHNpZ3MgcmV2b2tlZCBidXQgaWQgcmVtYWlucyBpbiB3YWxsZXQgdHJhbnNhY3Rpb24gbGlzdAogICAgaWYoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfbnVtYmVyXS5jb25maXJtQ291bnQgPT0gMCkKICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGgtLTsKCiAgICBMb2dSZXZva2VOb3RpY2UoX2lkLCBtc2cuc2VuZGVyLCBjb25maXJtc05lZWRlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjEzOwoKLyoqCiAqIEB0aXRsZSBBcnJheTI1NiBMaWJyYXJ5CiAqIEBhdXRob3IgTWFqb29sci5pbwogKgogKiB2ZXJzaW9uIDEuMC4wCiAqIENvcHlyaWdodCAoYykgMjAxNyBNYWpvb2xyLCBMTEMKICogVGhlIE1JVCBMaWNlbnNlIChNSVQpCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9NYWpvb2xyL2V0aGVyZXVtLWxpYnJhcmllcy9ibG9iL21hc3Rlci9MSUNFTlNFCiAqCiAqIFRoZSBBcnJheTI1NiBMaWJyYXJ5IHByb3ZpZGVzIGEgZmV3IHV0aWxpdHkgZnVuY3Rpb25zIHRvIHdvcmsgd2l0aAogKiBzdG9yYWdlIHVpbnQyNTZbXSB0eXBlcyBpbiBwbGFjZS4gTWFqb29sciB3b3JrcyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbgogKiB0aGUgRXRoZXJldW0gY29tbXVuaXR5IHdpdGggdGhlIHB1cnBvc2Ugb2YgdGVzdGluZywgZG9jdW1lbnRpbmcsIGFuZCBkZXBsb3lpbmcKICogcmV1c2FibGUgY29kZSBvbnRvIHRoZSBibG9ja2NoYWluIHRvIGltcHJvdmUgc2VjdXJpdHkgYW5kIHVzYWJpbGl0eSBvZiBzbWFydAogKiBjb250cmFjdHMuIE1ham9vbHIgYWxzbyBzdHJpdmVzIHRvIGVkdWNhdGUgbm9uLXByb2ZpdHMsIHNjaG9vbHMsIGFuZCBvdGhlcgogKiBjb21tdW5pdHkgbWVtYmVycyBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbiB0ZWNobm9sb2d5LgogKiBGb3IgZnVydGhlciBpbmZvcm1hdGlvbjogbWFqb29sci5pbwogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwogKiBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKbGlicmFyeSBBcnJheTI1NkxpYiB7CgogIC8vLyBAZGV2IFN1bSB2ZWN0b3IKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICAvLy8gQHJldHVybiBzdW0gVGhlIHN1bSBvZiBhbGwgZWxlbWVudHMsIGRvZXMgbm90IGNoZWNrIGZvciBvdmVyZmxvdwogIGZ1bmN0aW9uIHN1bUVsZW1lbnRzKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnModWludDI1NiBzdW0pIHsKICAgIGFzc2VtYmx5IHsKICAgICAgbXN0b3JlKDB4NjAsc2VsZl9zbG90KQoKICAgICAgZm9yIHsgbGV0IGkgOj0gMCB9IGx0KGksIHNsb2FkKHNlbGZfc2xvdCkpIHsgaSA6PSBhZGQoaSwgMSkgfSB7CiAgICAgICAgc3VtIDo9IGFkZChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGkpKSxzdW0pCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFJldHVybnMgdGhlIG1heCB2YWx1ZSBpbiBhbiBhcnJheS4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICAvLy8gQHJldHVybiBtYXhWYWx1ZSBUaGUgaGlnaGVzdCB2YWx1ZSBpbiB0aGUgYXJyYXkKICBmdW5jdGlvbiBnZXRNYXgodWludDI1NltdIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IG1heFZhbHVlKSB7CiAgICBhc3NlbWJseSB7CiAgICAgIG1zdG9yZSgweDYwLHNlbGZfc2xvdCkKICAgICAgbWF4VmFsdWUgOj0gc2xvYWQoc2hhMygweDYwLDB4MjApKQoKICAgICAgZm9yIHsgbGV0IGkgOj0gMCB9IGx0KGksIHNsb2FkKHNlbGZfc2xvdCkpIHsgaSA6PSBhZGQoaSwgMSkgfSB7CiAgICAgICAgc3dpdGNoIGd0KHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksaSkpLCBtYXhWYWx1ZSkKICAgICAgICBjYXNlIDEgewogICAgICAgICAgbWF4VmFsdWUgOj0gc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxpKSkKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFJldHVybnMgdGhlIG1pbmltdW0gdmFsdWUgaW4gYW4gYXJyYXkuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JhZ2UgYXJyYXkgY29udGFpbmluZyB1aW50MjU2IHR5cGUgdmFyaWFibGVzCiAgLy8vIEByZXR1cm4gbWluVmFsdWUgVGhlIGhpZ2hlc3QgdmFsdWUgaW4gdGhlIGFycmF5CiAgZnVuY3Rpb24gZ2V0TWluKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnModWludDI1NiBtaW5WYWx1ZSkgewogICAgYXNzZW1ibHkgewogICAgICBtc3RvcmUoMHg2MCxzZWxmX3Nsb3QpCiAgICAgIG1pblZhbHVlIDo9IHNsb2FkKHNoYTMoMHg2MCwweDIwKSkKCiAgICAgIGZvciB7IGxldCBpIDo9IDAgfSBsdChpLCBzbG9hZChzZWxmX3Nsb3QpKSB7IGkgOj0gYWRkKGksIDEpIH0gewogICAgICAgIHN3aXRjaCBndChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGkpKSwgbWluVmFsdWUpCiAgICAgICAgY2FzZSAwIHsKICAgICAgICAgIG1pblZhbHVlIDo9IHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksaSkpCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBGaW5kcyB0aGUgaW5kZXggb2YgYSBnaXZlbiB2YWx1ZSBpbiBhbiBhcnJheQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yYWdlIGFycmF5IGNvbnRhaW5pbmcgdWludDI1NiB0eXBlIHZhcmlhYmxlcwogIC8vLyBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IKICAvLy8gQHBhcmFtIGlzU29ydGVkIFRydWUgaWYgdGhlIGFycmF5IGlzIHNvcnRlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgLy8vIEByZXR1cm4gZm91bmQgVHJ1ZSBpZiB0aGUgdmFsdWUgd2FzIGZvdW5kLCBmYWxzZSBvdGhlcndpc2UKICAvLy8gQHJldHVybiBpbmRleCBUaGUgaW5kZXggb2YgdGhlIGdpdmVuIHZhbHVlLCByZXR1cm5zIDAgaWYgZm91bmQgaXMgZmFsc2UKICBmdW5jdGlvbiBpbmRleE9mKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdmFsdWUsIGJvb2wgaXNTb3J0ZWQpIGNvbnN0YW50CiAgICAgICAgICAgcmV0dXJucyhib29sIGZvdW5kLCB1aW50MjU2IGluZGV4KSB7CiAgICBhc3NlbWJseXsKICAgICAgbXN0b3JlKDB4NjAsc2VsZl9zbG90KQogICAgICBzd2l0Y2ggaXNTb3J0ZWQKICAgICAgY2FzZSAxIHsKICAgICAgICBsZXQgaGlnaCA6PSBzdWIoc2xvYWQoc2VsZl9zbG90KSwxKQogICAgICAgIGxldCBtaWQgOj0gMAogICAgICAgIGxldCBsb3cgOj0gMAogICAgICAgIGZvciB7IH0gaXN6ZXJvKGd0KGxvdywgaGlnaCkpIHsgfSB7CiAgICAgICAgICBtaWQgOj0gZGl2KGFkZChsb3csaGlnaCksMikKCiAgICAgICAgICBzd2l0Y2ggbHQoc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxtaWQpKSx2YWx1ZSkKICAgICAgICAgIGNhc2UgMSB7CiAgICAgICAgICAgICBsb3cgOj0gYWRkKG1pZCwxKQogICAgICAgICAgfQogICAgICAgICAgY2FzZSAwIHsKICAgICAgICAgICAgc3dpdGNoIGd0KHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksbWlkKSksdmFsdWUpCiAgICAgICAgICAgIGNhc2UgMSB7CiAgICAgICAgICAgICAgaGlnaCA6PSBzdWIobWlkLDEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAwIHsKICAgICAgICAgICAgICBmb3VuZCA6PSAxCiAgICAgICAgICAgICAgaW5kZXggOj0gbWlkCiAgICAgICAgICAgICAgbG93IDo9IGFkZChoaWdoLDEpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY2FzZSAwIHsKICAgICAgICBmb3IgeyBsZXQgbG93IDo9IDAgfSBsdChsb3csIHNsb2FkKHNlbGZfc2xvdCkpIHsgbG93IDo9IGFkZChsb3csIDEpIH0gewogICAgICAgICAgc3dpdGNoIGVxKHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksbG93KSksIHZhbHVlKQogICAgICAgICAgY2FzZSAxIHsKICAgICAgICAgICAgZm91bmQgOj0gMQogICAgICAgICAgICBpbmRleCA6PSBsb3cKICAgICAgICAgICAgbG93IDo9IHNsb2FkKHNlbGZfc2xvdCkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFV0aWxpdHkgZnVuY3Rpb24gZm9yIGhlYXBTb3J0CiAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgY2hpbGQgbm9kZQogIC8vLyBAcmV0dXJuIHBJIFRoZSBwYXJlbnQgbm9kZSBpbmRleAogIGZ1bmN0aW9uIGdldFBhcmVudEkodWludDI1NiBpbmRleCkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2IHBJKSB7CiAgICB1aW50MjU2IGkgPSBpbmRleCAtIDE7CiAgICBwSSA9IGkvMjsKICB9CgogIC8vLyBAZGV2IFV0aWxpdHkgZnVuY3Rpb24gZm9yIGhlYXBTb3J0CiAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgcGFyZW50IG5vZGUKICAvLy8gQHJldHVybiBsY0kgVGhlIGluZGV4IG9mIGxlZnQgY2hpbGQKICBmdW5jdGlvbiBnZXRMZWZ0Q2hpbGRJKHVpbnQyNTYgaW5kZXgpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludDI1NiBsY0kpIHsKICAgIHVpbnQyNTYgaSA9IGluZGV4ICogMjsKICAgIGxjSSA9IGkgKyAxOwogIH0KCiAgLy8vIEBkZXYgU29ydHMgZ2l2ZW4gYXJyYXkgaW4gcGxhY2UKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICBmdW5jdGlvbiBoZWFwU29ydCh1aW50MjU2W10gc3RvcmFnZSBzZWxmKSB7CiAgICB1aW50MjU2IGVuZCA9IHNlbGYubGVuZ3RoIC0gMTsKICAgIHVpbnQyNTYgc3RhcnQgPSBnZXRQYXJlbnRJKGVuZCk7CiAgICB1aW50MjU2IHJvb3QgPSBzdGFydDsKICAgIHVpbnQyNTYgbENoaWxkOwogICAgdWludDI1NiByQ2hpbGQ7CiAgICB1aW50MjU2IHN3YXA7CiAgICB1aW50MjU2IHRlbXA7CiAgICB3aGlsZShzdGFydCA+PSAwKXsKICAgICAgcm9vdCA9IHN0YXJ0OwogICAgICBsQ2hpbGQgPSBnZXRMZWZ0Q2hpbGRJKHN0YXJ0KTsKICAgICAgd2hpbGUobENoaWxkIDw9IGVuZCl7CiAgICAgICAgckNoaWxkID0gbENoaWxkICsgMTsKICAgICAgICBzd2FwID0gcm9vdDsKICAgICAgICBpZihzZWxmW3N3YXBdIDwgc2VsZltsQ2hpbGRdKQogICAgICAgICAgc3dhcCA9IGxDaGlsZDsKICAgICAgICBpZigockNoaWxkIDw9IGVuZCkgJiYgKHNlbGZbc3dhcF08c2VsZltyQ2hpbGRdKSkKICAgICAgICAgIHN3YXAgPSByQ2hpbGQ7CiAgICAgICAgaWYoc3dhcCA9PSByb290KQogICAgICAgICAgbENoaWxkID0gZW5kKzE7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0ZW1wID0gc2VsZltzd2FwXTsKICAgICAgICAgIHNlbGZbc3dhcF0gPSBzZWxmW3Jvb3RdOwogICAgICAgICAgc2VsZltyb290XSA9IHRlbXA7CiAgICAgICAgICByb290ID0gc3dhcDsKICAgICAgICAgIGxDaGlsZCA9IGdldExlZnRDaGlsZEkocm9vdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmKHN0YXJ0ID09IDApCiAgICAgICAgYnJlYWs7CiAgICAgIGVsc2UKICAgICAgICBzdGFydCA9IHN0YXJ0IC0gMTsKICAgIH0KICAgIHdoaWxlKGVuZCA+IDApewogICAgICB0ZW1wID0gc2VsZltlbmRdOwogICAgICBzZWxmW2VuZF0gPSBzZWxmWzBdOwogICAgICBzZWxmWzBdID0gdGVtcDsKICAgICAgZW5kID0gZW5kIC0gMTsKICAgICAgcm9vdCA9IDA7CiAgICAgIGxDaGlsZCA9IGdldExlZnRDaGlsZEkoMCk7CiAgICAgIHdoaWxlKGxDaGlsZCA8PSBlbmQpewogICAgICAgIHJDaGlsZCA9IGxDaGlsZCArIDE7CiAgICAgICAgc3dhcCA9IHJvb3Q7CiAgICAgICAgaWYoc2VsZltzd2FwXSA8IHNlbGZbbENoaWxkXSkKICAgICAgICAgIHN3YXAgPSBsQ2hpbGQ7CiAgICAgICAgaWYoKHJDaGlsZCA8PSBlbmQpICYmIChzZWxmW3N3YXBdPHNlbGZbckNoaWxkXSkpCiAgICAgICAgICBzd2FwID0gckNoaWxkOwogICAgICAgIGlmKHN3YXAgPT0gcm9vdCkKICAgICAgICAgIGxDaGlsZCA9IGVuZCArIDE7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0ZW1wID0gc2VsZltzd2FwXTsKICAgICAgICAgIHNlbGZbc3dhcF0gPSBzZWxmW3Jvb3RdOwogICAgICAgICAgc2VsZltyb290XSA9IHRlbXA7CiAgICAgICAgICByb290ID0gc3dhcDsKICAgICAgICAgIGxDaGlsZCA9IGdldExlZnRDaGlsZEkocm9vdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsKCi8qKgogKiBAdGl0bGUgQmFzaWMgTWF0aCBMaWJyYXJ5CiAqIEBhdXRob3IgTWFqb29sci5pbwogKgogKiB2ZXJzaW9uIDEuMS4wCiAqIENvcHlyaWdodCAoYykgMjAxNyBNYWpvb2xyLCBMTEMKICogVGhlIE1JVCBMaWNlbnNlIChNSVQpCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9NYWpvb2xyL2V0aGVyZXVtLWxpYnJhcmllcy9ibG9iL21hc3Rlci9MSUNFTlNFCiAqCiAqIFRoZSBCYXNpYyBNYXRoIExpYnJhcnkgaXMgaW5zcGlyZWQgYnkgdGhlIFNhZmUgTWF0aCBsaWJyYXJ5IHdyaXR0ZW4gYnkKICogT3BlblplcHBlbGluIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvIC4KICogTWFqb29sciB3b3JrcyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbiB0aGUgRXRoZXJldW0gY29tbXVuaXR5IHdpdGggdGhlCiAqIHB1cnBvc2Ugb2YgdGVzdGluZywgZG9jdW1lbnRpbmcsIGFuZCBkZXBsb3lpbmcgcmV1c2FibGUgY29kZSBvbnRvIHRoZQogKiBibG9ja2NoYWluIHRvIGltcHJvdmUgc2VjdXJpdHkgYW5kIHVzYWJpbGl0eSBvZiBzbWFydCBjb250cmFjdHMuIE1ham9vbHIKICogYWxzbyBzdHJpdmVzIHRvIGVkdWNhdGUgbm9uLXByb2ZpdHMsIHNjaG9vbHMsIGFuZCBvdGhlciBjb21tdW5pdHkgbWVtYmVycwogKiBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbiB0ZWNobm9sb2d5LgogKiBGb3IgZnVydGhlciBpbmZvcm1hdGlvbjogbWFqb29sci5pbywgb3BlbnplcHBlbGluLm9yZwogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwogKiBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKbGlicmFyeSBCYXNpY01hdGhMaWIgewogIGV2ZW50IEVycihzdHJpbmcgdHlwZUVycik7CgogIC8vLyBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHByb2R1Y3Qgb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHRpbWVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBtdWwoYSxiKQogICAgICBzd2l0Y2ggb3IoaXN6ZXJvKGIpLCBlcShkaXYocmVzLGIpLCBhKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICAgIGlmIChlcnIpCiAgICAgIEVycigidGltZXMgZnVuYyBvdmVyZmxvdyIpOwogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdyBidXQgcmF0aGVyIGxvZ3MgYW4gRXJyIGV2ZW50IGlmIDAgaXMgaW4gdGhlIGRpdmlzb3IuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIGBiYCBpcyAwCiAgLy8vIEByZXR1cm4gcmVzIFRoZSBxdW90aWVudCBvZiBhIGFuZCBiLCBvciAwIGlmIGBiYCBpcyAwCiAgZnVuY3Rpb24gZGl2aWRlZEJ5KHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHN3aXRjaCBpc3plcm8oYikKICAgICAgY2FzZSAwIHsKICAgICAgICByZXMgOj0gZGl2KGEsYikKICAgICAgICBtc3RvcmUoYWRkKG1sb2FkKDB4NDApLDB4MjApLHJlcykKICAgICAgICByZXR1cm4obWxvYWQoMHg0MCksMHg0MCkKICAgICAgfQogICAgfQogICAgRXJyKCJ0cmllZCB0byBkaXZpZGUgYnkgemVybyIpOwogICAgcmV0dXJuICh0cnVlLCAwKTsKICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHN1bSBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gcGx1cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBlcnIsIHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IGFkZChhLGIpCiAgICAgIHN3aXRjaCBhbmQoZXEoc3ViKHJlcyxiKSwgYSksIG9yKGd0KHJlcyxiKSxlcShyZXMsYikpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogICAgaWYgKGVycikKICAgICAgRXJyKCJwbHVzIGZ1bmMgb3ZlcmZsb3ciKTsKICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgICBpZiAoZXJyKQogICAgICBFcnIoIm1pbnVzIGZ1bmMgdW5kZXJmbG93Iik7CiAgfQp9'.
	

]
