Class {
	#name : #SRT55272df80297fbc078952d80ebe82b62e4b0dee2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT55272df80297fbc078952d80ebe82b62e4b0dee2 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBTdGFuZGFyZENvbnRyYWN0IHsKICAgIC8vIGFsbG93cyB1c2FnZSBvZiAicmVxdWlyZSIgYXMgYSBtb2RpZmllcgogICAgbW9kaWZpZXIgcmVxdWlyZXMoYm9vbCBiKSB7CiAgICAgICAgcmVxdWlyZShiKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHJlcXVpcmUgYXQgbGVhc3Qgb25lIG9mIHRoZSB0d28gY29uZGl0aW9ucyB0byBiZSB0cnVlCiAgICBtb2RpZmllciByZXF1aXJlc09uZShib29sIGIxLCBib29sIGIyKSB7CiAgICAgICAgcmVxdWlyZShiMSB8fCBiMik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3ROdWxsKGFkZHJlc3MgYSkgewogICAgICAgIHJlcXVpcmUoYSAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdFplcm8odWludDI1NiBhKSB7CiAgICAgICAgcmVxdWlyZShhICE9IDApOwogICAgICAgIF87CiAgICB9Cn0KCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBSZWVudHJhbmN5R3VhcmQgewoKICAvKioKICAgKiBAZGV2IFdlIHVzZSBhIHNpbmdsZSBsb2NrIGZvciB0aGUgd2hvbGUgY29udHJhY3QuCiAgICovCiAgYm9vbCBwcml2YXRlIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgUHJldmVudHMgYSBjb250cmFjdCBmcm9tIGNhbGxpbmcgaXRzZWxmLCBkaXJlY3RseSBvciBpbmRpcmVjdGx5LgogICAqIEBub3RpY2UgSWYgeW91IG1hcmsgYSBmdW5jdGlvbiBgbm9uUmVlbnRyYW50YCwgeW91IHNob3VsZCBhbHNvCiAgICogbWFyayBpdCBgZXh0ZXJuYWxgLiBDYWxsaW5nIG9uZSBub25SZWVudHJhbnQgZnVuY3Rpb24gZnJvbQogICAqIGFub3RoZXIgaXMgbm90IHN1cHBvcnRlZC4gSW5zdGVhZCwgeW91IGNhbiBpbXBsZW1lbnQgYQogICAqIGBwcml2YXRlYCBmdW5jdGlvbiBkb2luZyB0aGUgYWN0dWFsIHdvcmssIGFuZCBhIGBleHRlcm5hbGAKICAgKiB3cmFwcGVyIG1hcmtlZCBhcyBgbm9uUmVlbnRyYW50YC4KICAgKi8KICBtb2RpZmllciBub25SZWVudHJhbnQoKSB7CiAgICByZXF1aXJlKCFyZW50cmFuY3lfbG9jayk7CiAgICByZW50cmFuY3lfbG9jayA9IHRydWU7CiAgICBfOwogICAgcmVudHJhbmN5X2xvY2sgPSBmYWxzZTsKICB9Cgp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IENsYWltYWJsZSBpcyBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBwZW5kaW5nT3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seVBlbmRpbmdPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHNldCB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHBlbmRpbmdPd25lciA9IG5ld093bmVyOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSB0cmFuc2Zlci4KICAgKi8KICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIG9ubHlQZW5kaW5nT3duZXIgcHVibGljIHsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBwZW5kaW5nT3duZXIpOwogICAgb3duZXIgPSBwZW5kaW5nT3duZXI7CiAgICBwZW5kaW5nT3duZXIgPSAweDA7CiAgfQp9Cgpjb250cmFjdCBIYXNOb0V0aGVyIGlzIE93bmFibGUgewoKICAvKioKICAqIEBkZXYgQ29uc3RydWN0b3IgdGhhdCByZWplY3RzIGluY29taW5nIEV0aGVyCiAgKiBAZGV2IFRoZSBgcGF5YWJsZWAgZmxhZyBpcyBhZGRlZCBzbyB3ZSBjYW4gYWNjZXNzIGBtc2cudmFsdWVgIHdpdGhvdXQgY29tcGlsZXIgd2FybmluZy4gSWYgd2UKICAqIGxlYXZlIG91dCBwYXlhYmxlLCB0aGVuIFNvbGlkaXR5IHdpbGwgYWxsb3cgaW5oZXJpdGluZyBjb250cmFjdHMgdG8gaW1wbGVtZW50IGEgcGF5YWJsZQogICogY29uc3RydWN0b3IuIEJ5IGRvaW5nIGl0IHRoaXMgd2F5IHdlIHByZXZlbnQgYSBwYXlhYmxlIGNvbnN0cnVjdG9yIGZyb20gd29ya2luZy4gQWx0ZXJuYXRpdmVseQogICogd2UgY291bGQgdXNlIGFzc2VtYmx5IHRvIGFjY2VzcyBtc2cudmFsdWUuCiAgKi8KICBmdW5jdGlvbiBIYXNOb0V0aGVyKCkgcGF5YWJsZSB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGlzYWxsb3dzIGRpcmVjdCBzZW5kIGJ5IHNldHRpbmdzIGEgZGVmYXVsdCBmdW5jdGlvbiB3aXRob3V0IHRoZSBgcGF5YWJsZWAgZmxhZy4KICAgKi8KICBmdW5jdGlvbigpIGV4dGVybmFsIHsKICB9CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgYWxsIEV0aGVyIGhlbGQgYnkgdGhlIGNvbnRyYWN0IHRvIHRoZSBvd25lci4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltRXRoZXIoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgYXNzZXJ0KG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgfQp9CgovKgogKiBBIFNpbmdsZVRva2VuTG9ja2VyIGFsbG93cyBhIHVzZXIgdG8gY3JlYXRlIGEgbG9ja2VyIHRoYXQgY2FuIGxvY2sgYSBzaW5nbGUgdHlwZSBvZiBFUkMyMCB0b2tlbi4KICogVGhlIHRva2VuIGxvY2tlciBzaG91bGQ6CiAqICAgIC0gQWxsb3cgdGhlIG93bmVyIHRvIHByb3ZlIGEgY2VydGFpbiBudW1iZXIgb2YgdGhlaXIgb3duIHRva2VucyBhcmUgbG9ja2VkIGZvciB1bnRpbCBhIHBhcnRpY3VsYXIgdGltZQogKiAgICAtIEFsbG93IHRoZSBvd25lciB0byB0cmFuc2ZlciB0b2tlbnMgdG8gYSByZWNpcGllbnQgYW5kIHByb3ZlIHRoZSB0b2tlbnMgYXJlIGxvY2tlZCB1bnRpbCBhIHBhcnRpY3VsYXIgdGltZQogKiAgICAtIEFsbG93IHRoZSBvd25lciB0byBjYW5jZWwgYSB0cmFuc2ZlciBiZWZvcmUgYSByZWNpcGllbnQgY29uZmlybXMgKGluIGNhc2Ugb2YgdHJhbnNmZXIgdG8gYW4gaW5jb3JyZWN0IGFkZHJlc3MpCiAqICAgIC0gQWxsb3cgdGhlIHJlY2lwaWVudCB0byBiZSBjZXJ0YWluIHRoYXQgdGhleSB3aWxsIGhhdmUgYWNjZXNzIHRvIHRyYW5zZmVycmVkIHRva2VucyBvbmNlIHRoZSBsb2NrIGV4cGlyZXMKICogICAgLSBCZSByZS11c2FibGUgYnkgdGhlIG93bmVyLCBzbyBhbiBvd25lciBjYW4gZWFzaWx5IHNjaGVkdWxlL21vbml0b3IgbXVsdGlwbGUgdHJhbnNmZXJzL2xvY2tzCiAqCiAqIFRoaXMgY2xhc3Mgc2hvdWxkIGJlIHJldXNhYmxlIGZvciBhbnkgRVJDMjAgdG9rZW4uICBJZGVhbGx5LCB0aGlzIHNvcnQgb2YgZmluZSBncmFpbmVkIGxvY2tpbmcgd291bGQgYmUgYXZhaWxhYmxlIGluCiAqIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYuICBTaG9ydCBvZiB0aGF0LCB0aGUgdG9rZW4gbG9ja2VyIHJlY2VpdmVzIHRva2VucyAocHJlc3VtYWJseSBmcm9tIHRoZSBsb2NrZXIgb3duZXIpIGFuZAogKiBjYW4gYmUgY29uZmlndXJlZCB0byByZWxlYXNlIHRoZW0gb25seSB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMuCiAqCiAqIFVzYWdlOgogKiAgLSBUaGUgb3duZXIgY3JlYXRlcyBhIHRva2VuIGxvY2tlciBmb3IgYSBwYXJ0aWN1bGFyIEVSQzIwIHRva2VuIHR5cGUKICogIC0gVGhlIG93bmVyIGFwcHJvdmVzIHRoZSBsb2NrZXIgdXAgdG8gc29tZSBudW1iZXIgb2YgdG9rZW5zOiB0b2tlbi5hcHByb3ZlKHRva2VuTG9ja2VyQWRkcmVzcywgdG9rZW5BbW91bnQpCiAqICAgIC0gQWx0ZXJuYXRlbHksIHRoZSBvd25lciBjYW4gc2VuZCB0b2tlbnMgdG8gdGhlIGxvY2tlci4gIFdoZW4gbG9ja2luZyB0b2tlbnMsIHRoZSBsb2NrZXIgY2hlY2tzIGl0cyBiYWxhbmNlIGZpcnN0CiAqICAtIFRoZSBvd25lciBjYWxscyAibG9ja3VwIiB3aXRoIGEgcGFydGljdWxhciByZWNpcGllbnQsIGFtb3VudCwgYW5kIHVubG9jayB0aW1lLiAgVGhlIHJlY2lwaWVudCB3aWxsIGJlIGFsbG93ZWQKICogICAgdG8gY29sbGVjdCB0aGUgdG9rZW5zIG9uY2UgdGhlIGxvY2t1cCBwZXJpb2QgaXMgZW5kZWQuCiAqICAtIFRoZSByZWNpcGllbnQgY2FsbHMgImNvbmZpcm0iIHdoaWNoIGNvbmZpcm1zIHRoYXQgdGhlIHJlY2lwaWVudCdzIGFkZHJlc3MgaXMgY29ycmVjdCBhbmQgaXMgY29udHJvbGxlZCBieSB0aGUKICogICAgaW50ZW5kZWQgcmVjaXBpZW50IChlLmcuIG5vdCBhbiBleGNoYW5nZSBhZGRyZXNzKS4gIFRoZSBhc3N1bXB0aW9uIGlzIHRoYXQgaWYgdGhlIHJlY2lwaWVudCBjYW4gY2FsbCAiY29uZmlybSIKICogICAgdGhleSBoYXZlIGRlbW9uc3RyYXRlZCB0aGF0IHRoZXkgd2lsbCBhbHNvIGJlIGFibGUgdG8gY2FsbCAiY29sbGVjdCIgd2hlbiB0aGUgdG9rZW5zIGFyZSByZWFkeS4KICogIC0gT25jZSB0aGUgbG9jayBleHBpcmVzLCB0aGUgcmVjaXBpZW50IGNhbGxzICJjb2xsZWN0IiBhbmQgdGhlIHRva2VucyBhcmUgdHJhbnNmZXJyZWQgZnJvbSB0aGUgbG9ja2VyIHRvIHRoZQogKiAgICByZWNpcGllbnQuCiAqCiAqIEFuIG93bmVyIGNhbiBsb2NrdXAgaGlzL2hlciBvd24gdG9rZW5zIGluIG9yZGVyIHRvIGRlbW9uc3RyYXRlIHRoZSB0aGV5IHdpbGwgbm90IGJlIG1vdmVkIHVudGlsIGEgcGFydGljdWxhciB0aW1lLgogKiBJbiB0aGlzIGNhc2UsIG5vIHNlcGFyYXRlICJjb25maXJtIiBzdGVwIGlzIG5lZWRlZCAoY29uZmlybSBoYXBwZW5zIGF1dG9tYXRpY2FsbHkpCiAqCiAqIFRoZSBmb2xsb3dpbmcgZGlhZ3JhbSBzaG93cyB0aGUgYWN0dWFsIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGxvY2tlciBhbmQgaG93IGl0IGlzIHRyYWNrZWQgaW50ZXJuYWxseQogKgogKiAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwogKiAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgQWN0dWFsIExvY2tlciBCYWxhbmNlICAgICAgICAgICAgICAgICAgfAogKiAgICAgICAgIHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfAogKiAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgIFByb21pc2VkICAgICAgICAgICAgICAgfAogKiAgU3RhdGUgIHwgICAgIFVuY29tbWl0dGVkICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfAogKiAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICBQZW5kaW5nICAgICAgICAgICAgfCAgTG9ja2VkICAgfAogKiAgICAgICAgIHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfAogKiAgQWN0aW9uc3wgd2l0aGRyYXcgICAgICAgICAgICB8ICBjb25maXJtLCBjYW5jZWwsIGNvbGxlY3QgfCBjb2xsZWN0ICAgfAogKiAgICAgICAgIHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tfAogKiAgRmllbGQgIHwgYmFsYW5jZSAtIHByb21pc2VkICB8IHByb21pc2VkIC0gbG9ja2VkICAgICAgICAgfCBsb2NrZWQgICAgfAogKiAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tKwogKi8KY29udHJhY3QgU2luZ2xlVG9rZW5Mb2NrZXIgaXMgQ2xhaW1hYmxlLCBSZWVudHJhbmN5R3VhcmQsIFN0YW5kYXJkQ29udHJhY3QsIEhhc05vRXRoZXIgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLy8gdGhlIHR5cGUgb2YgdG9rZW4gdGhpcyBsb2NrZXIgaXMgdXNlZCBmb3IKICBFUkMyMCBwdWJsaWMgdG9rZW47CgogIC8vIEEgY291bnRlciB0byBnZW5lcmF0ZSB1bmlxdWUgSWRzIGZvciBwcm9taXNlcwogIHVpbnQyNTYgcHVibGljIG5leHRQcm9taXNlSWQ7CgogIC8vIHByb21pc2Ugc3RvcmFnZQogIG1hcHBpbmcodWludDI1NiA9PiBUb2tlblByb21pc2UpIHB1YmxpYyBwcm9taXNlczsKCiAgLy8gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgbG9ja2VkIG9yIHBlbmRpbmcgbG9jayAoaW4gdGhlIG5vbi1mcmFjdGlvbmFsIHVuaXRzLCBsaWtlIHdlaSkKICB1aW50MjU2IHB1YmxpYyBwcm9taXNlZFRva2VuQmFsYW5jZTsKCiAgLy8gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYWN0dWFsbHkgbG9ja2VkIChyZWNpcGllbnRzIGhhdmUgY29uZmlybWVkKQogIHVpbnQyNTYgcHVibGljIGxvY2tlZFRva2VuQmFsYW5jZTsKCiAgLy8gcHJvbWlzZSBzdGF0ZXMKICAvLyAgbm9uZTogVGhlIGRlZmF1bHQgc3RhdGUuICBOZXZlciBleHBsaWNpdGx5IGFzc2lnbmVkLgogIC8vICBwZW5kaW5nOiBUaGUgb3duZXIgaGFzIGluaXRpYXRlZCBhIHByb21pc2UsIGJ1dCBpdCBoYXMgbm90IGJlZW4gY2xhaW1lZAogIC8vICBjb25maXJtZWQ6IFRoZSByZWNpcGllbnQgaGFzIGNvbmZpcm1lZCB0aGUgcHJvbWlzZQogIC8vICBleGVjdXRlZDogVGhlIHByb21pc2UgaGFzIGNvbXBsZXRlZCAoYWZ0ZXIgdGhlIHJlcXVpcmVkIGxvY2t1cCkKICAvLyAgY2FuY2VsZWQ6IFRoZSBwcm9taXNlIHdhcyBjYW5jZWxlZCAob25seSBmcm9tIHBlbmRpbmcgc3RhdGUpCiAgLy8gIGZhaWxlZDogVGhlIHByb21pc2UgY291bGQgbm90IGJlIGZ1bGZpbGxlZCBkdWUgdG8gYW4gZXJyb3IKICBlbnVtIFByb21pc2VTdGF0ZSB7IG5vbmUsIHBlbmRpbmcsIGNvbmZpcm1lZCwgZXhlY3V0ZWQsIGNhbmNlbGVkLCBmYWlsZWQgfQoKICAvLyBhIG1hdHJpeCBkZXNpZ25hdGluZyB0aGUgbGVnYWwgc3RhdGUgdHJhbnNpdGlvbnMgZm9yIGEgcHJvbWlzZSAoc2VlIGNvbnN0cnVjdG9yKQogIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyh1aW50ID0+IGJvb2wpKSBzdGF0ZVRyYW5zaXRpb25NYXRyaXg7CgogIC8vIHRydWUgaWYgdGhlIGNvbnRyYWN0IGhhcyBiZWVuIGluaXRpYWxpemVkCiAgYm9vbCBpbml0aWFsaXplZDsKCiAgc3RydWN0IFRva2VuUHJvbWlzZSB7CiAgICB1aW50MjU2IHByb21pc2VJZDsKICAgIGFkZHJlc3MgcmVjaXBpZW50OwogICAgdWludDI1NiBhbW91bnQ7CiAgICB1aW50MjU2IGxvY2tlZFVudGlsOwogICAgUHJvbWlzZVN0YXRlIHN0YXRlOwogIH0KCiAgZXZlbnQgbG9nUHJvbWlzZUNyZWF0ZWQodWludDI1NiBwcm9taXNlSWQsIGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IGFtb3VudCwgdWludDI1NiBsb2NrZWRVbnRpbCk7CiAgZXZlbnQgbG9nUHJvbWlzZUNvbmZpcm1lZCh1aW50MjU2IHByb21pc2VJZCk7CiAgZXZlbnQgbG9nUHJvbWlzZUNhbmNlbGVkKHVpbnQyNTYgcHJvbWlzZUlkKTsKICBldmVudCBsb2dQcm9taXNlRnVsZmlsbGVkKHVpbnQyNTYgcHJvbWlzZUlkKTsKICBldmVudCBsb2dQcm9taXNlVW5mdWxmaWxsYWJsZSh1aW50MjU2IHByb21pc2VJZCwgYWRkcmVzcyByZWNpcGllbnQsIHVpbnQyNTYgYW1vdW50KTsKCiAgLyoqCiAgICogR3VhcmRzIGFjdGlvbnMgdGhhdCBvbmx5IHRoZSBpbnRlbmRlZCByZWNpcGllbnQgc2hvdWxkIGJlIGFibGUgdG8gcGVyZm9ybQogICAqLwogIG1vZGlmaWVyIG9ubHlSZWNpcGllbnQodWludDI1NiBwcm9taXNlSWQpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwcm9taXNlc1twcm9taXNlSWRdLnJlY2lwaWVudCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogRW5zdXJlcyB0aGUgcHJvbWlzZUlkIGFzIGFjdHVhbGx5IGluIHVzZS4KICAgKi8KICBtb2RpZmllciBwcm9taXNlRXhpc3RzKHVpbnQgcHJvbWlzZUlkKSB7CiAgICByZXF1aXJlKHByb21pc2VJZCA8IG5leHRQcm9taXNlSWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEVuc3VyZSBzdGF0ZSBjb25zaXN0ZW5jeSBhZnRlciBtb2RpZnlpbmcgbG9ja2VkVG9rZW5CYWxhbmNlIG9yIHByb21pc2VkVG9rZW5CYWxhbmNlCiAgICovCiAgbW9kaWZpZXIgdGhlbkFzc2VydFN0YXRlKCkgewogICAgXzsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuQmFsYW5jZSgpOwogICAgYXNzZXJ0KGxvY2tlZFRva2VuQmFsYW5jZSA8PSBwcm9taXNlZFRva2VuQmFsYW5jZSk7CiAgICBhc3NlcnQocHJvbWlzZWRUb2tlbkJhbGFuY2UgPD0gYmFsYW5jZSk7CiAgfQoKICAvLyBDb25zdHJ1Y3RvcgogIGZ1bmN0aW9uIFNpbmdsZVRva2VuTG9ja2VyKGFkZHJlc3MgdG9rZW5BZGRyZXNzKSB7CiAgICB0b2tlbiA9IEVSQzIwKHRva2VuQWRkcmVzcyk7CgogICAgYWxsb3dUcmFuc2l0aW9uKFByb21pc2VTdGF0ZS5wZW5kaW5nLCBQcm9taXNlU3RhdGUuY2FuY2VsZWQpOwogICAgYWxsb3dUcmFuc2l0aW9uKFByb21pc2VTdGF0ZS5wZW5kaW5nLCBQcm9taXNlU3RhdGUuZXhlY3V0ZWQpOwogICAgYWxsb3dUcmFuc2l0aW9uKFByb21pc2VTdGF0ZS5wZW5kaW5nLCBQcm9taXNlU3RhdGUuY29uZmlybWVkKTsKICAgIGFsbG93VHJhbnNpdGlvbihQcm9taXNlU3RhdGUuY29uZmlybWVkLCBQcm9taXNlU3RhdGUuZXhlY3V0ZWQpOwogICAgYWxsb3dUcmFuc2l0aW9uKFByb21pc2VTdGF0ZS5leGVjdXRlZCwgUHJvbWlzZVN0YXRlLmZhaWxlZCk7CiAgICBpbml0aWFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBJbml0aWF0ZXMgdGhlIHJlcXVlc3QgdG8gbG9ja3VwIHRoZSBnaXZlbiBudW1iZXIgb2YgdG9rZW5zIHVudGlsIHRoZSBnaXZlbiBibG9jay50aW1lc3RhbXAgb2NjdXJzLgogICAqIFRoaXMgY29udHJhY3Qgd2lsbCBhdHRlbXB0IHRvIGFjcXVpcmUgdG9rZW5zIGZyb20gdGhlIFRva2VuIGNvbnRyYWN0IGZyb20gdGhlIG93bmVyIGlmIGl0cyBiYWxhbmNlCiAgICogaXMgbm90IHN1ZmZpY2llbnQuICBUaGVyZWZvcmUsIHRoZSBsb2NrZXIgb3duZXIgbWF5IGNhbGwgdG9rZW4uYXBwcm92ZShsb2NrZXIuYWRkcmVzcywgYW1vdW50KSBvbmUgdGltZQogICAqIGFuZCB0aGVuIGluaXRpYXRlIG1hbnkgc21hbGxlciB0cmFuc2ZlcnMgdG8gaW5kaXZpZHVhbHMuCiAgICoKICAgKiBOb3RlIDE6IGxvY2t1cCBpcyBub3QgZ3VhcmFudGVlZCB1bnRpbCB0aGUgcmVjaXBpZW50IGNvbmZpcm1zLgogICAqIE5vdGUgMjogQXNzdW1lcyB0aGUgb3duZXIgaGFzIGFscmVhZHkgZ2l2ZW4gYXBwcm92YWwgZm9yIHRoZSBUb2tlbkxvY2tlciB0byB0YWtlIG91dCB0aGUgdG9rZW5zCiAgICogICAgICAgICBvciB0aGF0IHRoZSBsb2NrZXIncyBiYWxhbmNlIGlzIHN1ZmZpY2llbnQKICAgKi8KICBmdW5jdGlvbiBsb2NrdXAoYWRkcmVzcyByZWNpcGllbnQsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IGxvY2tlZFVudGlsKQogICAgb25seU93bmVyCiAgICBub3ROdWxsKHJlY2lwaWVudCkKICAgIG5vdFplcm8oYW1vdW50KQogICAgbm9uUmVlbnRyYW50CiAgICBleHRlcm5hbAogIHsKICAgIC8vIGlmIHRoZSBsb2NrZXIgZG9lcyBub3QgaGF2ZSBzdWZmaWNpZW50IHVubG9ja2VkIHRva2VucywgYXNzdW1lIGl0IGhhcyBlbm91Z2gKICAgIC8vIGFwcHJvdmVkIGJ5IHRoZSBvd25lciB0byBtYWtlIHVwIHRoZSBkaWZmZXJlbmNlCiAgICBlbnN1cmVUb2tlbnNBdmFpbGFibGUoYW1vdW50KTsKCiAgICAvLyBzZXR1cCBhIHByb21pc2UgdGhhdCBhbGxvdyB0cmFuc2ZlciB0byB0aGUgcmVjaXBpZW50IGFmdGVyIHRoZSBsb2NrIGV4cGlyZXMKICAgIFRva2VuUHJvbWlzZSBzdG9yYWdlIHByb21pc2UgPSBjcmVhdGVQcm9taXNlKHJlY2lwaWVudCwgYW1vdW50LCBsb2NrZWRVbnRpbCk7CgogICAgLy8gYXV0by1jb25maXJtIGlmIHRoZSByZWNpcGllbnQgaXMgdGhlIG93bmVyCiAgICBpZiAocmVjaXBpZW50ID09IG93bmVyKSB7CiAgICAgIGRvQ29uZmlybShwcm9taXNlKTsKICAgIH0KICB9CgogIC8qKioKICAgKiBAZGV2IENhbmNlbHMgdGhlIHBlbmRpbmcgdHJhbnNhY3Rpb24gYXMgbG9uZyBhcyB0aGUgY2FsbGVyIGhhcyBwZXJtaXNzaW9ucyBhbmQgdGhlIHRyYW5zYWN0aW9uIGhhcyBub3QgYWxyZWFkeQogICAqIGJlZW4gY29uZmlybWVkLiAgQWxsb3dpbmcgKmFueSogdHJhbnNhY3Rpb24gdG8gYmUgY2FuY2VsZWQgd291bGQgbWVhbiBubyBsb2NrdXAgY291bGQgZXZlciBiZSBndWFyYW50ZWVkLgogICAqLwogIGZ1bmN0aW9uIGNhbmNlbCh1aW50MjU2IHByb21pc2VJZCkKICAgIHByb21pc2VFeGlzdHMocHJvbWlzZUlkKQogICAgcmVxdWlyZXMocHJvbWlzZXNbcHJvbWlzZUlkXS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUucGVuZGluZykKICAgIHJlcXVpcmVzT25lKAogICAgICBtc2cuc2VuZGVyID09IG93bmVyLAogICAgICBtc2cuc2VuZGVyID09IHByb21pc2VzW3Byb21pc2VJZF0ucmVjaXBpZW50CiAgICApCiAgICBub25SZWVudHJhbnQKICAgIGV4dGVybmFsCiAgewogICAgVG9rZW5Qcm9taXNlIHN0b3JhZ2UgcHJvbWlzZSA9IHByb21pc2VzW3Byb21pc2VJZF07CiAgICB1bmxvY2tUb2tlbnMocHJvbWlzZSwgUHJvbWlzZVN0YXRlLmNhbmNlbGVkKTsKICAgIGxvZ1Byb21pc2VDYW5jZWxlZChwcm9taXNlLnByb21pc2VJZCk7CiAgfQoKICAvLyBAZGV2IEFsbG93cyB0aGUgcmVjaXBpZW50IHRvIGNvbmZpcm0gdGhlaXIgYWRkcmVzcy4gIElmIHRoaXMgZmFpbHMgKG9yIHRoZXkgY2Fubm90IHNlbmQgZnJvbSB0aGUgc3BlY2lmaWVkIGFkZHJlc3MpCiAgLy8gdGhlIG93bmVyIG9mIHRoZSBUb2tlbkxvY2tlciBjYW4gY2FuY2VsIHRoZSBwcm9taXNlIGFuZCBpbml0aWF0ZSBhIG5ldyBvbmUKICBmdW5jdGlvbiBjb25maXJtKHVpbnQyNTYgcHJvbWlzZUlkKQogICAgcHJvbWlzZUV4aXN0cyhwcm9taXNlSWQpCiAgICBvbmx5UmVjaXBpZW50KHByb21pc2VJZCkKICAgIHJlcXVpcmVzKHByb21pc2VzW3Byb21pc2VJZF0uc3RhdGUgPT0gUHJvbWlzZVN0YXRlLnBlbmRpbmcpCiAgICBub25SZWVudHJhbnQKICAgIGV4dGVybmFsCiAgewogICAgZG9Db25maXJtKHByb21pc2VzW3Byb21pc2VJZF0pOwogIH0KCiAgLyoqKgogICAqIENhbGxlZCBieSB0aGUgcmVjaXBpZW50IGFmdGVyIHRoZSBsb2NrIGhhcyBleHBpcmVkLgogICAqLwogIGZ1bmN0aW9uIGNvbGxlY3QodWludDI1NiBwcm9taXNlSWQpCiAgICBwcm9taXNlRXhpc3RzKHByb21pc2VJZCkKICAgIG9ubHlSZWNpcGllbnQocHJvbWlzZUlkKQogICAgcmVxdWlyZXMoYmxvY2sudGltZXN0YW1wID49IHByb21pc2VzW3Byb21pc2VJZF0ubG9ja2VkVW50aWwpCiAgICByZXF1aXJlc09uZSgKICAgICAgcHJvbWlzZXNbcHJvbWlzZUlkXS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUucGVuZGluZywKICAgICAgcHJvbWlzZXNbcHJvbWlzZUlkXS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUuY29uZmlybWVkCiAgICApCiAgICBub25SZWVudHJhbnQKICAgIGV4dGVybmFsCiAgewogICAgVG9rZW5Qcm9taXNlIHN0b3JhZ2UgcHJvbWlzZSA9IHByb21pc2VzW3Byb21pc2VJZF07CgogICAgdW5sb2NrVG9rZW5zKHByb21pc2UsIFByb21pc2VTdGF0ZS5leGVjdXRlZCk7CiAgICBpZiAodG9rZW4udHJhbnNmZXIocHJvbWlzZS5yZWNpcGllbnQsIHByb21pc2UuYW1vdW50KSkgewogICAgICBsb2dQcm9taXNlRnVsZmlsbGVkKHByb21pc2UucHJvbWlzZUlkKTsKICAgIH0KICAgIGVsc2UgewogICAgICAvLyBldmVyeXRoaW5nIGxvb2tlZCBnb29kLCBidXQgdGhlIHRyYW5zZmVyIGZhaWxlZC4gIDooICBOb3cgd2hhdD8KICAgICAgLy8gVGhlcmUgaXMgbm8gcmVhc29uIHRvIHRoaW5rIGl0IHdpbGwgd29yayB0aGUgbmV4dCB0aW1lLCBzbwogICAgICAvLyByZXZlcnRpbmcgcHJvYmFibHkgd29uJ3QgaGVscCBoZXJlOyB0aGUgdG9rZW5zIHdvdWxkIHJlbWFpbiBsb2NrZWQKICAgICAgLy8gZm9yZXZlci4gIE91ciBvbmx5IGhvcGUgaXMgdGhhdCB0aGUgdG9rZW4gb3duZXIgd2lsbCByZXNvbHZlIHRoZQogICAgICAvLyBpc3N1ZSBpbiB0aGUgcmVhbCB3b3JsZC4gIFNpbmNlIHRoZSBhbW91bnQgaGFzIGJlZW4gZGVkdWN0ZWQgZnJvbSB0aGUKICAgICAgLy8gbG9ja2VkIGFuZCBwZW5kaW5nIHRvdGFscywgaXQgaGFzIGVmZmVjdGl2ZWx5IGJlZW4gcmV0dXJuZWQgdG8gdGhlIG93bmVyLgogICAgICB0cmFuc2l0aW9uKHByb21pc2UsIFByb21pc2VTdGF0ZS5mYWlsZWQpOwogICAgICBsb2dQcm9taXNlVW5mdWxmaWxsYWJsZShwcm9taXNlSWQsIHByb21pc2UucmVjaXBpZW50LCBwcm9taXNlLmFtb3VudCk7CiAgICB9CiAgfQoKICAvKioqCiAgICogV2l0aGRyYXdzIHRoZSBnaXZlbiBudW1iZXIgb2YgdG9rZW5zIGZyb20gdGhlIGxvY2tlciBhcyBsb25nIGFzIHRoZXkgYXJlIG5vdCBhbHJlYWR5IGxvY2tlZCBvciBwcm9taXNlZAogICAqLwogIGZ1bmN0aW9uIHdpdGhkcmF3VW5jb21taXR0ZWRUb2tlbnModWludCBhbW91bnQpCiAgICBvbmx5T3duZXIKICAgIHJlcXVpcmVzKGFtb3VudCA8PSB1bmNvbW1pdHRlZFRva2VuQmFsYW5jZSgpKQogICAgbm9uUmVlbnRyYW50CiAgICBleHRlcm5hbAogIHsKICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBhbW91bnQpOwogIH0KCiAgLyoqKgogICAqIFdpdGhkcmF3IGFsbCB0b2tlbnMgZnJvbSB0aGUgd2FsbGV0IHRoYXQgYXJlIG5vdCBsb2NrZWQgb3IgcHJvbWlzZWQKICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd0FsbFVuY29tbWl0dGVkVG9rZW5zKCkKICAgIG9ubHlPd25lcgogICAgbm9uUmVlbnRyYW50CiAgICBleHRlcm5hbAogIHsKICAgIC8vIG5vdCB1c2luZyB3aXRoZHJhd1VuY29tbWl0dGVkVG9rZW5zKHVuY29tbWl0dGVkVG9rZW5CYWxhbmNlKCkpCiAgICAvLyB0byBoYXZlIHN0cm9uZ2VyIGd1YXJhbnRlZSBvbiBub25SZWVudHJhbnQrZXh0ZXJuYWwKICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCB1bmNvbW1pdHRlZFRva2VuQmFsYW5jZSgpKTsKICB9CgogIC8vIHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQgb3V0IGJ5IHRoZSBvd25lciBpZiBlaXRoZXIKICAvLyAgMTogVGhlIHRva2VucyBhcmUgbm90IHRoZSB0eXBlIHRoYXQgYXJlIGdvdmVybmVkIGJ5IHRoaXMgY29udHJhY3QgKGFjY2lkZW50YWxseSBzZW50IGhlcmUsIG1vc3QgbGlrZWx5KQogIC8vICAyOiBUaGUgdG9rZW5zIGFyZSBub3QgYWxyZWFkeSBwcm9taXNlZCB0byBhIHJlY2lwaWVudCAoZWl0aGVyIHBlbmRpbmcgb3IgY29uZmlybWVkKQogIC8vCiAgLy8gSWYgbmVpdGhlciBvZiB0aGVzZSBjb25kaXRpb25zIGFyZSB0cnVlLCB0aGVuIGFsbG93aW5nIHRoZSBvd25lciB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgLy8gb3V0IHdvdWxkIHZpb2xhdGUgdGhlIHB1cnBvc2Ugb2YgdGhlIHRva2VuIGxvY2tlciwgd2hpY2ggaXMgdG8gcHJvdmUgdGhhdCB0aGUgdG9rZW5zCiAgLy8gY2Fubm90IGJlIG1vdmVkLgogIGZ1bmN0aW9uIHNhbHZhZ2VUb2tlbnNGcm9tQ29udHJhY3QoYWRkcmVzcyB0b2tlbkFkZHJlc3MsIGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KQogICAgb25seU93bmVyCiAgICByZXF1aXJlc09uZSgKICAgICAgdG9rZW5BZGRyZXNzICE9IGFkZHJlc3ModG9rZW4pLAogICAgICBhbW91bnQgPD0gdW5jb21taXR0ZWRUb2tlbkJhbGFuY2UoKQogICAgKQogICAgbm9uUmVlbnRyYW50CiAgICBleHRlcm5hbAogIHsKICAgIEVSQzIwKHRva2VuQWRkcmVzcykudHJhbnNmZXIodG8sIGFtb3VudCk7CiAgfQoKICAvKioqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBwcm9taXNlIGhhcyBiZWVuIGNvbmZpcm1lZCBieSB0aGUgcmVjaXBpZW50CiAgICovCiAgZnVuY3Rpb24gaXNDb25maXJtZWQodWludDI1NiBwcm9taXNlSWQpCiAgICBjb25zdGFudAogICAgcmV0dXJucyhib29sKQogIHsKICAgIHJldHVybiBwcm9taXNlc1twcm9taXNlSWRdLnN0YXRlID09IFByb21pc2VTdGF0ZS5jb25maXJtZWQ7CiAgfQoKICAvKioqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlIHByb21pc2UgY2FuIGJlZW4gY29sbGVjdGVkIGJ5IHRoZSByZWNpcGllbnQKICAgKi8KICBmdW5jdGlvbiBjYW5Db2xsZWN0KHVpbnQyNTYgcHJvbWlzZUlkKQogICAgY29uc3RhbnQKICAgIHJldHVybnMoYm9vbCkKICB7CiAgICByZXR1cm4gKHByb21pc2VzW3Byb21pc2VJZF0uc3RhdGUgPT0gUHJvbWlzZVN0YXRlLmNvbmZpcm1lZCB8fCBwcm9taXNlc1twcm9taXNlSWRdLnN0YXRlID09IFByb21pc2VTdGF0ZS5wZW5kaW5nKQogICAgICAmJiBibG9jay50aW1lc3RhbXAgPj0gcHJvbWlzZXNbcHJvbWlzZUlkXS5sb2NrZWRVbnRpbDsKICB9CgogIC8vIEBkZXYgcmV0dXJucyB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VucyB0aGF0IGFyZSBlbGlnaWJsZSB0byBiZSBjb2xsZWN0ZWQKICBmdW5jdGlvbiBjb2xsZWN0YWJsZVRva2VuQmFsYW5jZSgpCiAgICBjb25zdGFudAogICAgcmV0dXJucyh1aW50MjU2IGNvbGxlY3RhYmxlKQogIHsKICAgIGNvbGxlY3RhYmxlID0gMDsKICAgIGZvciAodWludCBpPTA7IGk8bmV4dFByb21pc2VJZDsgaSsrKSB7CiAgICAgIGlmIChjYW5Db2xsZWN0KGkpKSB7CiAgICAgICAgY29sbGVjdGFibGUgPSBjb2xsZWN0YWJsZS5hZGQocHJvbWlzZXNbaV0uYW1vdW50KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNvbGxlY3RhYmxlOwogIH0KCiAgLyoqKgogICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyB0aGF0IG1lZXQgdGhlIGdpdmVuIGNyaXRlcmlhLiAgVG8gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoCiAgICogZ2V0UHJvbWlzZUlkcygpCiAgICoKICAgKiByZWNpcGllbnQ6IHRoZSByZWNpcGllbnRzIGFkZHJlc3MgdG8gdXNlIGZvciBmaWx0ZXJpbmcsIG9yIDB4MCB0byByZXR1cm4gYWxsCiAgICogaW5jbHVkZUNvbXBsZXRlZDogdHJ1ZSBpZiB0aGUgbGlzdCBzaG91bGQgaW5jbHVkZSB0cmFuc2FjdGlvbnMgdGhhdCBhcmUgYWxyZWFkeSBleGVjdXRlZCBvciBjYW5jZWxlZAogICAqLwogIGZ1bmN0aW9uIGdldFByb21pc2VDb3VudChhZGRyZXNzIHJlY2lwaWVudCwgYm9vbCBpbmNsdWRlQ29tcGxldGVkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCBjb3VudCkKICB7CiAgICBmb3IgKHVpbnQgaT0wOyBpPG5leHRQcm9taXNlSWQ7IGkrKykgewogICAgICBpZiAocmVjaXBpZW50ICE9IDB4MCAmJiByZWNpcGllbnQgIT0gcHJvbWlzZXNbaV0ucmVjaXBpZW50KQogICAgICAgIGNvbnRpbnVlOwoKICAgICAgICBpZiAoaW5jbHVkZUNvbXBsZXRlZAogICAgICAgICAgICB8fCBwcm9taXNlc1tpXS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUucGVuZGluZwogICAgICAgICAgICB8fCBwcm9taXNlc1tpXS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUuY29uZmlybWVkKQogICAgICBjb3VudCArPSAxOwogICAgfQogIH0KCiAgLyoqKgogICAqIFJldHVybiBhIGxpc3Qgb2YgcHJvbWlzZUlkcyB0aGF0IG1hdGNoIHRoZSBnaXZlbiBjcml0ZXJpYQogICAqCiAgICogcmVjaXBpZW50OiB0aGUgcmVjaXBpZW50cyBhZGRyZXNzIHRvIHVzZSBmb3IgZmlsdGVyaW5nLCBvciAweDAgdG8gcmV0dXJuIGFsbAogICAqIGluY2x1ZGVDb21wbGV0ZWQ6IHRydWUgaWYgdGhlIGxpc3Qgc2hvdWxkIGluY2x1ZGUgdHJhbnNhY3Rpb25zIHRoYXQgYXJlIGFscmVhZHkgZXhlY3V0ZWQgb3IgY2FuY2VsZWQKICAgKi8KICBmdW5jdGlvbiBnZXRQcm9taXNlSWRzKHVpbnQgZnJvbSwgdWludCB0bywgYWRkcmVzcyByZWNpcGllbnQsIGJvb2wgaW5jbHVkZUNvbXBsZXRlZCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnRbXSBwcm9taXNlSWRzKQogIHsKICAgIHVpbnRbXSBtZW1vcnkgcHJvbWlzZUlkc1RlbXAgPSBuZXcgdWludFtdKG5leHRQcm9taXNlSWQpOwogICAgdWludCBjb3VudCA9IDA7CiAgICB1aW50IGk7CiAgICBmb3IgKGk9MDsgaTxuZXh0UHJvbWlzZUlkICYmIGNvdW50IDwgdG87IGkrKykgewogICAgICBpZiAocmVjaXBpZW50ICE9IDB4MCAmJiByZWNpcGllbnQgIT0gcHJvbWlzZXNbaV0ucmVjaXBpZW50KQogICAgICAgIGNvbnRpbnVlOwoKICAgICAgaWYgKGluY2x1ZGVDb21wbGV0ZWQKICAgICAgICB8fCBwcm9taXNlc1tpXS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUucGVuZGluZwogICAgICAgIHx8IHByb21pc2VzW2ldLnN0YXRlID09IFByb21pc2VTdGF0ZS5jb25maXJtZWQpCiAgICAgIHsKICAgICAgICBwcm9taXNlSWRzVGVtcFtjb3VudF0gPSBpOwogICAgICAgIGNvdW50ICs9IDE7CiAgICAgIH0KICAgIH0KICAgIHByb21pc2VJZHMgPSBuZXcgdWludFtdKHRvIC0gZnJvbSk7CiAgICBmb3IgKGk9ZnJvbTsgaTx0bzsgaSsrKQogICAgICBwcm9taXNlSWRzW2kgLSBmcm9tXSA9IHByb21pc2VJZHNUZW1wW2ldOwogIH0KCiAgLyoqKgogICAqIHJldHVybnMgdGhlIG51bWJlciBvZiB0b2tlbnMgaGVsZCBieSB0aGUgdG9rZW4gbG9ja2VyIChzb21lIG1pZ2h0IGJlIHByb21pc2VkIG9yIGxvY2tlZCkKICAgKi8KICBmdW5jdGlvbiB0b2tlbkJhbGFuY2UoKQogICAgY29uc3RhbnQKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogIH0KCiAgLyoqKgogICAqIHJldHVybnMgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCBhcmUgbm90IHByb21pc2VkIG9yIGxvY2tlZAogICAqLwogIGZ1bmN0aW9uIHVuY29tbWl0dGVkVG9rZW5CYWxhbmNlKCkKICAgIGNvbnN0YW50CiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIHRva2VuQmFsYW5jZSgpIC0gcHJvbWlzZWRUb2tlbkJhbGFuY2U7CiAgfQoKICAvKioqCiAgICogcmV0dXJucyB0aGUgbnVtYmVyIG9mIHRva2VucyB0aGF0IGEgcHJvbWlzZWQgYnkgaGF2ZSBub3QgYmVlbiBsb2NrZWQgKHBlbmRpbmcgY29uZmlybWF0aW9uIGZyb20gcmVjaXBpZW50KQogICAqLwogIGZ1bmN0aW9uIHBlbmRpbmdUb2tlbkJhbGFuY2UoKQogICAgY29uc3RhbnQKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gcHJvbWlzZWRUb2tlbkJhbGFuY2UgLSBsb2NrZWRUb2tlbkJhbGFuY2U7CiAgfQoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0gaW50ZXJuYWwgbWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0gLy8KCiAgLy8gQGRldiBtb3ZlcyB0aGUgcHJvbWlzZSB0byB0aGUgbmV3IHN0YXRlIGFuZCB1cGRhdGVzIHRoZSBsb2NrZWQvcGVuZGluZyB0b3RhbHMgYWNjb3JkaW5nbHkKICBmdW5jdGlvbiB1bmxvY2tUb2tlbnMoVG9rZW5Qcm9taXNlIHN0b3JhZ2UgcHJvbWlzZSwgUHJvbWlzZVN0YXRlIG5ld1N0YXRlKQogICAgaW50ZXJuYWwKICB7CiAgICBwcm9taXNlZFRva2VuQmFsYW5jZSA9IHByb21pc2VkVG9rZW5CYWxhbmNlLnN1Yihwcm9taXNlLmFtb3VudCk7CiAgICBpZiAocHJvbWlzZS5zdGF0ZSA9PSBQcm9taXNlU3RhdGUuY29uZmlybWVkKSB7CiAgICAgIGxvY2tlZFRva2VuQmFsYW5jZSA9IGxvY2tlZFRva2VuQmFsYW5jZS5zdWIocHJvbWlzZS5hbW91bnQpOwogICAgfQogICAgdHJhbnNpdGlvbihwcm9taXNlLCBuZXdTdGF0ZSk7CiAgfQoKICAvLyBAZGV2IGFkZCBhIG5ldyBzdGF0ZSB0cmFuc2l0aW9uIHRvIHRoZSBzdGF0ZSB0cmFuc2l0aW9uIG1hdHJpeAogIGZ1bmN0aW9uIGFsbG93VHJhbnNpdGlvbihQcm9taXNlU3RhdGUgZnJvbSwgUHJvbWlzZVN0YXRlIHRvKQogICAgcmVxdWlyZXMoIWluaXRpYWxpemVkKQogICAgaW50ZXJuYWwKICB7CiAgICBzdGF0ZVRyYW5zaXRpb25NYXRyaXhbdWludChmcm9tKV1bdWludCh0byldID0gdHJ1ZTsKICB9CgogIC8vIEBkZXYgbW92ZXMgdGhlIHByb21pc2UgdG8gdGhlIG5ldyBzdGF0ZSBhcyBsb25nIGFzIGl0J3MgcGVybWl0dGVkIGJ5IHRoZSBzdGF0ZSB0cmFuc2l0aW9uIG1hdHJpeAogIGZ1bmN0aW9uIHRyYW5zaXRpb24oVG9rZW5Qcm9taXNlIHN0b3JhZ2UgcHJvbWlzZSwgUHJvbWlzZVN0YXRlIG5ld1N0YXRlKQogICAgaW50ZXJuYWwKICB7CiAgICBhc3NlcnQoc3RhdGVUcmFuc2l0aW9uTWF0cml4W3VpbnQocHJvbWlzZS5zdGF0ZSldW3VpbnQobmV3U3RhdGUpXSk7CiAgICBwcm9taXNlLnN0YXRlID0gbmV3U3RhdGU7CiAgfQoKICAvLyBAZGV2IG1vdmVzIHRoZSBwcm9taXNlIHRvIHRoZSBjb25maXJtZWQgc3RhdGUgYW5kIHVwZGF0ZXMgdGhlIGxvY2tlZCB0b2tlbiB0b3RhbAogIGZ1bmN0aW9uIGRvQ29uZmlybShUb2tlblByb21pc2Ugc3RvcmFnZSBwcm9taXNlKQogICAgdGhlbkFzc2VydFN0YXRlCiAgICBpbnRlcm5hbAogIHsKICAgIHRyYW5zaXRpb24ocHJvbWlzZSwgUHJvbWlzZVN0YXRlLmNvbmZpcm1lZCk7CiAgICBsb2NrZWRUb2tlbkJhbGFuY2UgPSBsb2NrZWRUb2tlbkJhbGFuY2UuYWRkKHByb21pc2UuYW1vdW50KTsKICAgIGxvZ1Byb21pc2VDb25maXJtZWQocHJvbWlzZS5wcm9taXNlSWQpOwogIH0KCiAgLyoqKgogICAqIEBkZXYgY3JlYXRlcyBhbmQgc3RvcmVzIGEgbmV3IHByb21pc2Ugb2JqZWN0LCB1cGRhdGVzIHRoZSBwcm9taXNlZFRva2VuQmFsYW5jZQogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZVByb21pc2UoYWRkcmVzcyByZWNpcGllbnQsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IGxvY2tlZFVudGlsKQogICAgcmVxdWlyZXMoYW1vdW50IDw9IHVuY29tbWl0dGVkVG9rZW5CYWxhbmNlKCkpCiAgICB0aGVuQXNzZXJ0U3RhdGUKICAgIGludGVybmFsCiAgICByZXR1cm5zKFRva2VuUHJvbWlzZSBzdG9yYWdlIHByb21pc2UpCiAgewogICAgdWludDI1NiBwcm9taXNlSWQgPSBuZXh0UHJvbWlzZUlkKys7CiAgICBwcm9taXNlID0gcHJvbWlzZXNbcHJvbWlzZUlkXTsKICAgIHByb21pc2UucHJvbWlzZUlkID0gcHJvbWlzZUlkOwogICAgcHJvbWlzZS5yZWNpcGllbnQgPSByZWNpcGllbnQ7CiAgICBwcm9taXNlLmFtb3VudCA9IGFtb3VudDsKICAgIHByb21pc2UubG9ja2VkVW50aWwgPSBsb2NrZWRVbnRpbDsKICAgIHByb21pc2Uuc3RhdGUgPSBQcm9taXNlU3RhdGUucGVuZGluZzsKCiAgICBwcm9taXNlZFRva2VuQmFsYW5jZSA9IHByb21pc2VkVG9rZW5CYWxhbmNlLmFkZChwcm9taXNlLmFtb3VudCk7CgogICAgbG9nUHJvbWlzZUNyZWF0ZWQocHJvbWlzZUlkLCByZWNpcGllbnQsIGFtb3VudCwgbG9ja2VkVW50aWwpOwoKICAgIHJldHVybiBwcm9taXNlOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVja3MgdGhlIHVuY29tbWl0dGVkIGJhbGFuY2UgdG8gZW5zdXJlIHRoZXJlIHRoZSBsb2NrZXIgaGFzIGVub3VnaCB0b2tlbnMgdG8gZ3VhcmFudGVlIHRoZQogICAqIGFtb3VudCBnaXZlbiBjYW4gYmUgcHJvbWlzZWQuICBJZiB0aGUgbG9ja2VyJ3MgYmFsYW5jZSBpcyBub3QgZW5vdWdoLCB0aGUgbG9ja2VyIHdpbGwgYXR0ZW1wdCB0byB0cmFuc2ZlcgogICAqIHRva2VucyBmcm9tIHRoZSBvd25lci4KICAgKi8KICBmdW5jdGlvbiBlbnN1cmVUb2tlbnNBdmFpbGFibGUodWludDI1NiBhbW91bnQpCiAgICBvbmx5T3duZXIKICAgIGludGVybmFsCiAgewogICAgdWludDI1NiB1bmNvbW1pdHRlZEJhbGFuY2UgPSB1bmNvbW1pdHRlZFRva2VuQmFsYW5jZSgpOwogICAgaWYgKHVuY29tbWl0dGVkQmFsYW5jZSA8IGFtb3VudCkgewogICAgICB0b2tlbi50cmFuc2ZlckZyb20ob3duZXIsIHRoaXMsIGFtb3VudC5zdWIodW5jb21taXR0ZWRCYWxhbmNlKSk7CgogICAgICAvLyBKdXN0IGFzc2VydCB0aGF0IHRoZSBjb25kaXRpb24gd2UgcmVhbGx5IGNhcmUgYWJvdXQgaG9sZHMsIHJhdGhlcgogICAgICAvLyB0aGFuIHJlbHlpbmcgb24gdGhlIHJldHVybiB2YWx1ZS4gIHNlZSBHYXZDb2luIGFuZCBhbGwgdGhlIHRva2VucyBjb3B5L3Bhc3RlZCB0aGVyZWZyb20uCiAgICAgIGFzc2VydCh1bmNvbW1pdHRlZFRva2VuQmFsYW5jZSgpID49IGFtb3VudCk7CiAgICB9CiAgfQp9'.
	

]
