Class {
	#name : #SRTb31f5fb63d96d27cf3e92be92a0bd8d751849bef,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb31f5fb63d96d27cf3e92be92a0bd8d751849bef >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQovLy8gIGxhdGVyIGNoYW5nZWQKY29udHJhY3QgT3duZWQgewoKICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIG1lc3NhZ2Ugc2VuZGVyIHRvIGJlIGBvd25lcmAKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBpZihtc2cuc2VuZGVyID09IG93bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKCi8vLyBAdGl0bGUgVmVzdGluZyB0cnVzdGVlCmNvbnRyYWN0IFRydXN0ZWUgaXMgT3duZWQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIFNIUCBFUkMyMCB0b2tlbi4KICAgIFNIUCBwdWJsaWMgc2hwOwoKICAgIHN0cnVjdCBHcmFudCB7CiAgICAgICAgdWludDI1NiB2YWx1ZTsKICAgICAgICB1aW50MjU2IHN0YXJ0OwogICAgICAgIHVpbnQyNTYgY2xpZmY7CiAgICAgICAgdWludDI1NiBlbmQ7CiAgICAgICAgdWludDI1NiB0cmFuc2ZlcnJlZDsKICAgICAgICBib29sIHJldm9rYWJsZTsKICAgIH0KCiAgICAvLyBHcmFudHMgaG9sZGVyLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBHcmFudCkgcHVibGljIGdyYW50czsKCiAgICAvLyBUb3RhbCB0b2tlbnMgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgdWludDI1NiBwdWJsaWMgdG90YWxWZXN0aW5nOwoKICAgIGV2ZW50IE5ld0dyYW50KGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgVW5sb2NrR3JhbnQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IFJldm9rZUdyYW50KGFkZHJlc3MgaW5kZXhlZCBfaG9sZGVyLCB1aW50MjU2IF9yZWZ1bmQpOwoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIGFkZHJlc3Mgb2YgdGhlIFNIUCBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3NocCBTSFAgVGhlIGFkZHJlc3Mgb2YgdGhlIHByZXZpb3VzbHkgZGVwbG95ZWQgU0hQIHNtYXJ0IGNvbnRyYWN0LgogICAgZnVuY3Rpb24gVHJ1c3RlZShTSFAgX3NocCkgewogICAgICAgIHJlcXVpcmUoX3NocCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBzaHAgPSBfc2hwOwogICAgfQoKICAgIC8vLyBAZGV2IEdyYW50IHRva2VucyB0byBhIHNwZWNpZmllZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBncmFudCB0b2tlbnMgdG8uCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICAvLy8gQHBhcmFtIF9zdGFydCB1aW50MjU2IFRoZSBiZWdpbm5pbmcgb2YgdGhlIHZlc3RpbmcgcGVyaW9kLgogICAgLy8vIEBwYXJhbSBfY2xpZmYgdWludDI1NiBEdXJhdGlvbiBvZiB0aGUgY2xpZmYgcGVyaW9kLgogICAgLy8vIEBwYXJhbSBfZW5kIHVpbnQyNTYgVGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9yZXZva2FibGUgYm9vbCBXaGV0aGVyIHRoZSBncmFudCBpcyByZXZva2FibGUgb3Igbm90LgogICAgZnVuY3Rpb24gZ3JhbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9zdGFydCwgdWludDI1NiBfY2xpZmYsIHVpbnQyNTYgX2VuZCwgYm9vbCBfcmV2b2thYmxlKQogICAgICAgIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGEgc2luZ2xlIGFkZHJlc3MgY2FuIGJlIGdyYW50ZWQgdG9rZW5zIG9ubHkgb25jZS4KICAgICAgICByZXF1aXJlKGdyYW50c1tfdG9dLnZhbHVlID09IDApOwoKICAgICAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvci4KICAgICAgICByZXF1aXJlKF9zdGFydCA8PSBfY2xpZmYgJiYgX2NsaWZmIDw9IF9lbmQpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoaXMgZ3JhbnQgZG9lc24ndCBleGNlZWQgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgY3VycmVudGx5IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICByZXF1aXJlKHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKSA8PSBzaHAuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgLy8gQXNzaWduIGEgbmV3IGdyYW50LgogICAgICAgIGdyYW50c1tfdG9dID0gR3JhbnQoewogICAgICAgICAgICB2YWx1ZTogX3ZhbHVlLAogICAgICAgICAgICBzdGFydDogX3N0YXJ0LAogICAgICAgICAgICBjbGlmZjogX2NsaWZmLAogICAgICAgICAgICBlbmQ6IF9lbmQsCiAgICAgICAgICAgIHRyYW5zZmVycmVkOiAwLAogICAgICAgICAgICByZXZva2FibGU6IF9yZXZva2FibGUKICAgICAgICB9KTsKCiAgICAgICAgLy8gVG9rZW5zIGdyYW50ZWQsIHJlZHVjZSB0aGUgdG90YWwgYW1vdW50IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3RpbmcuYWRkKF92YWx1ZSk7CgogICAgICAgIE5ld0dyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgIGZ1bmN0aW9uIHJldm9rZShhZGRyZXNzIF9ob2xkZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOwoKICAgICAgICByZXF1aXJlKGdyYW50LnJldm9rYWJsZSk7CgogICAgICAgIC8vIFNlbmQgdGhlIHJlbWFpbmluZyBTSFAgYmFjayB0byB0aGUgb3duZXIuCiAgICAgICAgdWludDI1NiByZWZ1bmQgPSBncmFudC52YWx1ZS5zdWIoZ3JhbnQudHJhbnNmZXJyZWQpOwoKICAgICAgICAvLyBSZW1vdmUgdGhlIGdyYW50LgogICAgICAgIGRlbGV0ZSBncmFudHNbX2hvbGRlcl07CgogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5zdWIocmVmdW5kKTsKICAgICAgICBzaHAudHJhbnNmZXIobXNnLnNlbmRlciwgcmVmdW5kKTsKCiAgICAgICAgUmV2b2tlR3JhbnQoX2hvbGRlciwgcmVmdW5kKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZS4KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIuCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHNwZWNpZmljIHRpbWUuCiAgICAvLy8gQHJldHVybiBhIHVpbnQyNTYgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMuCiAgICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF90aW1lKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOwogICAgICAgIGlmIChncmFudC52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgX3RpbWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmMgdGltZS4KICAgIC8vLyBAcGFyYW0gX2dyYW50IEdyYW50IFRoZSB2ZXN0aW5nIGdyYW50LgogICAgLy8vIEBwYXJhbSBfdGltZSB1aW50MjU2IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgIC8vLyBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50LgogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QKICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgIF8vCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgIC8KICAgIC8vLyAgIHwgICAgICAgICAgICAgIC58CiAgICAvLy8gICB8ICAgICAgICAgICAgLiAgfAogICAgLy8vICAgfCAgICAgICAgICAuICAgIHwKICAgIC8vLyAgIHwgICAgICAgIC4gICAgICB8CiAgICAvLy8gICB8ICAgICAgLiAgICAgICAgfAogICAgLy8vICAgfCAgICAuICAgICAgICAgIHwKICAgIC8vLyAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKICAgIC8vLyAgICAgU3RhcnQgICAgICAgQ2xpZmYgICAgICBFbmQKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhHcmFudCBfZ3JhbnQsIHVpbnQyNTYgX3RpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIElmIHdlJ3JlIGJlZm9yZSB0aGUgY2xpZmYsIHRoZW4gbm90aGluZyBpcyB2ZXN0ZWQuCiAgICAgICAgaWYgKF90aW1lIDwgX2dyYW50LmNsaWZmKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgd2UncmUgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QgLSBldmVyeXRoaW5nIGlzIHZlc3RlZDsKICAgICAgICBpZiAoX3RpbWUgPj0gX2dyYW50LmVuZCkgewogICAgICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlOwogICAgICAgIH0KCiAgICAgICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnM6IHZlc3RlZFRva2VucyA9IHRva2Vucy8vLyAodGltZSAtIHN0YXJ0KSAvIChlbmQgLSBzdGFydCkKICAgICAgICAgcmV0dXJuIF9ncmFudC52YWx1ZS5tdWwoX3RpbWUuc3ViKF9ncmFudC5zdGFydCkpLmRpdihfZ3JhbnQuZW5kLnN1YihfZ3JhbnQuc3RhcnQpKTsKICAgIH0KCiAgICAvLy8gQGRldiBVbmxvY2sgdmVzdGVkIHRva2VucyBhbmQgdHJhbnNmZXIgdGhlbSB0byB0aGVpciBob2xkZXIuCiAgICAvLy8gQHJldHVybiBhIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyB0cmFuc2ZlcnJlZCB0byB0aGVpciBob2xkZXIuCiAgICBmdW5jdGlvbiB1bmxvY2tWZXN0ZWRUb2tlbnMoKSBwdWJsaWMgewogICAgICAgIEdyYW50IGdyYW50ID0gZ3JhbnRzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUoZ3JhbnQudmFsdWUgIT0gMCk7CgogICAgICAgIC8vIEdldCB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMsIGFjY2NvcmRpbmcgdG8gZ3JhbnQuCiAgICAgICAgdWludDI1NiB2ZXN0ZWQgPSBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoZ3JhbnQsIG5vdyk7CiAgICAgICAgaWYgKHZlc3RlZCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgaG9sZGVyIGRvZXNuJ3QgdHJhbnNmZXIgbW9yZSB0aGFuIHdoYXQgaGUgYWxyZWFkeSBoYXMuCiAgICAgICAgdWludDI1NiB0cmFuc2ZlcmFibGUgPSB2ZXN0ZWQuc3ViKGdyYW50LnRyYW5zZmVycmVkKTsKICAgICAgICBpZiAodHJhbnNmZXJhYmxlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZ3JhbnQudHJhbnNmZXJyZWQgPSBncmFudC50cmFuc2ZlcnJlZC5hZGQodHJhbnNmZXJhYmxlKTsKICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3Rpbmcuc3ViKHRyYW5zZmVyYWJsZSk7CiAgICAgICAgc2hwLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7CgogICAgICAgIFVubG9ja0dyYW50KG1zZy5zZW5kZXIsIHRyYW5zZmVyYWJsZSk7CiAgICB9Cn0KCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsKCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CgogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKCiAgICAvLyBgcGFyZW50U25hcFNob3RCbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRoZSBQYXJlbnQgVG9rZW4gdGhhdCB3YXMKICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOwoKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICAvLyBgYWxsb3dlZGAgdHJhY2tzIGFueSBleHRyYSB0cmFuc2ZlciByaWdodHMgYXMgaW4gYWxsIEVSQzIwIHRva2VucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CgogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIC8vIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIG5ldyBjbG9uZSB0b2tlbnMKICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIHJlcXVpcmUocGFyZW50U25hcFNob3RCbG9jayA8IGJsb2NrLm51bWJlcik7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIHJlcXVpcmUoKF90byAhPSAwKSAmJiAoX3RvICE9IGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSk7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YKICAgICAgICAvLyAgdGhpcyB0b2tlbgogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudAogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgYmFsYW5jZSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPj0gY3VyVG90YWxTdXBwbHkpOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSA+PSBfYW1vdW50KTsKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZUZyb20gPj0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGlzQ29udHJhY3QoY29udHJvbGxlcikpOwogICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKTsKICAgIH0KCi8vLy8vLy8vLy8KLy8gU2FmZXR5IE1ldGhvZHMKLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSAKICAgIHsKICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3BhcmVudFRva2VuLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX3Rva2VuTmFtZSwKICAgICAgICAgICAgX2RlY2ltYWxVbml0cywKICAgICAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKY29udHJhY3QgU0NEIGlzIE1pbmlNZVRva2VuIHsKICAgIC8vIEBkZXYgU0NEIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTQ0QoYWRkcmVzcyBfdG9rZW5GYWN0b3J5KQogICAgICAgICAgICBNaW5pTWVUb2tlbigKICAgICAgICAgICAgICAgIF90b2tlbkZhY3RvcnksCiAgICAgICAgICAgICAgICAweDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgICAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgICAgICAgICAgICAgIlNoYXJwZSBDcnlwdG8tRGVyaXZhdGl2ZSIsICAgICAgLy8gVG9rZW4gbmFtZQogICAgICAgICAgICAgICAgMTgsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMKICAgICAgICAgICAgICAgICJTQ0QiLCAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbAogICAgICAgICAgICAgICAgdHJ1ZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlIHRyYW5zZmVycwogICAgICAgICAgICApIHt9Cn0KCmNvbnRyYWN0IFNIUCBpcyBNaW5pTWVUb2tlbiB7CiAgICAvLyBAZGV2IFNIUCBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU0hQKGFkZHJlc3MgX3Rva2VuRmFjdG9yeSkKICAgICAgICAgICAgTWluaU1lVG9rZW4oCiAgICAgICAgICAgICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAgICAgICAgICAgMHgwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gcGFyZW50IHRva2VuCiAgICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBzbmFwc2hvdCBibG9jayBudW1iZXIgZnJvbSBwYXJlbnQKICAgICAgICAgICAgICAgICJTaGFycGUgUGxhdGZvcm0gVG9rZW4iLCAgICAgICAgIC8vIFRva2VuIG5hbWUKICAgICAgICAgICAgICAgIDE4LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY2ltYWxzCiAgICAgICAgICAgICAgICAiU0hQIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTeW1ib2wKICAgICAgICAgICAgICAgIHRydWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMKICAgICAgICAgICAgKSB7fQp9Cgpjb250cmFjdCBBZmZpbGlhdGVVdGlsaXR5IGlzIE93bmVkIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICB1aW50MjU2IHB1YmxpYyB0aWVyVHdvTWluOwogICAgdWludDI1NiBwdWJsaWMgdGllclRocmVlTWluOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRJRVIxX1BFUkNFTlQgPSAzOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVElFUjJfUEVSQ0VOVCA9IDQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUSUVSM19QRVJDRU5UID0gNTsKICAgIAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBBZmZpbGlhdGUpIHByaXZhdGUgYWZmaWxpYXRlczsKCiAgICBldmVudCBBZmZpbGlhdGVSZWNlaXZlZChhZGRyZXNzIGFmZmlsaWF0ZUFkZHJlc3MsIGFkZHJlc3MgaW52ZXN0b3JBZGRyZXNzLCBib29sIHZhbGlkKTsKCiAgICBzdHJ1Y3QgQWZmaWxpYXRlIHsKICAgICAgICBhZGRyZXNzIGV0aGVyQWRkcmVzczsKICAgICAgICBib29sIGlzUHJlc2VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBBZmZpbGlhdGVVdGlsaXR5KHVpbnQyNTYgX3RpZXJUd29NaW4sIHVpbnQyNTYgX3RpZXJUaHJlZU1pbikgewogICAgICAgIHNldFRpZXJzKF90aWVyVHdvTWluLCBfdGllclRocmVlTWluKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBzZXRzIHRoZSBFdGhlciB0byBEb2xsYXIgZXhoY2hhbmdlIHJhdGUKICAgIC8vLyBAcGFyYW0gX3RpZXJUd29NaW4gdGhlIHRpZXIgMiBtaW4gKGluIFdFSSkKICAgIC8vLyBAcGFyYW0gX3RpZXJUaHJlZU1pbiB0aGUgdGllciAzIG1pbiAoaW4gV0VJKQogICAgZnVuY3Rpb24gc2V0VGllcnModWludDI1NiBfdGllclR3b01pbiwgdWludDI1NiBfdGllclRocmVlTWluKSBvbmx5T3duZXIgewogICAgICAgIHRpZXJUd29NaW4gPSBfdGllclR3b01pbjsKICAgICAgICB0aWVyVGhyZWVNaW4gPSBfdGllclRocmVlTWluOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoaXMgYWRkcyBhbiBhZmZpbGlhdGUgRXRoZXJldW0gYWRkcmVzcyB0byBvdXIgd2hpdGVsaXN0CiAgICAvLy8gQHBhcmFtIF9pbnZlc3RvciBUaGUgaW52ZXN0b3IncyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9hZmZpbGlhdGUgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIGFmZmlsaWF0ZQogICAgZnVuY3Rpb24gYWRkQWZmaWxpYXRlKGFkZHJlc3MgX2ludmVzdG9yLCBhZGRyZXNzIF9hZmZpbGlhdGUpIG9ubHlPd25lciB7CiAgICAgICAgYWZmaWxpYXRlc1tfaW52ZXN0b3JdID0gQWZmaWxpYXRlKF9hZmZpbGlhdGUsIHRydWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGNhbGN1bGF0ZXMgYW5kIHJldHVybnMgdGhlIGFtb3VudCB0byB0b2tlbiBtaW50ZWQgZm9yIGFmZmlsbGlhdGUKICAgIC8vLyBAcGFyYW0gX2ludmVzdG9yIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yCiAgICAvLy8gQHBhcmFtIF9jb250cmlidXRvclRva2VucyBhbW91bnQgb2YgU0hQIHRva2VucyBtaW50ZWQgZm9yIGNvbnRyaWJ1dG9yCiAgICAvLy8gQHBhcmFtIF9jb250cmlidXRpb25WYWx1ZSBhbW91bnQgb2YgRVRIIGNvbnRyaWJ1dGVkCiAgICAvLy8gQHJldHVybiB0dXBsZSBvZiB0d28gdmFsdWVzIChhZmZpbGlhdGVCb251cywgY29udHJpYnV0b3JCb3VucykKICAgIGZ1bmN0aW9uIGFwcGx5QWZmaWxpYXRlKAogICAgICAgIGFkZHJlc3MgX2ludmVzdG9yLCAKICAgICAgICB1aW50MjU2IF9jb250cmlidXRvclRva2VucywgCiAgICAgICAgdWludDI1NiBfY29udHJpYnV0aW9uVmFsdWUKICAgICkKICAgICAgICBwdWJsaWMgCiAgICAgICAgcmV0dXJucyh1aW50MjU2LCB1aW50MjU2KSAKICAgIHsKICAgICAgICBpZiAoZ2V0QWZmaWxpYXRlKF9pbnZlc3RvcikgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICByZXR1cm4gKDAsIDApOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBjb250cmlidXRvckJvbnVzID0gX2NvbnRyaWJ1dG9yVG9rZW5zLmRpdigxMDApOwogICAgICAgIHVpbnQyNTYgYWZmaWxpYXRlQm9udXMgPSAwOwoKICAgICAgICBpZiAoX2NvbnRyaWJ1dGlvblZhbHVlIDwgdGllclR3b01pbikgewogICAgICAgICAgICBhZmZpbGlhdGVCb251cyA9IF9jb250cmlidXRvclRva2Vucy5tdWwoVElFUjFfUEVSQ0VOVCkuZGl2KDEwMCk7CiAgICAgICAgfSBlbHNlIGlmIChfY29udHJpYnV0aW9uVmFsdWUgPj0gdGllclR3b01pbiAmJiBfY29udHJpYnV0aW9uVmFsdWUgPCB0aWVyVGhyZWVNaW4pIHsKICAgICAgICAgICAgYWZmaWxpYXRlQm9udXMgPSBfY29udHJpYnV0b3JUb2tlbnMubXVsKFRJRVIyX1BFUkNFTlQpLmRpdigxMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFmZmlsaWF0ZUJvbnVzID0gX2NvbnRyaWJ1dG9yVG9rZW5zLm11bChUSUVSM19QRVJDRU5UKS5kaXYoMTAwKTsKICAgICAgICB9CgogICAgICAgIHJldHVybihhZmZpbGlhdGVCb251cywgY29udHJpYnV0b3JCb251cyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRmV0Y2hlcyB0aGUgRXRoZXJldW0gYWRkcmVzcyBvZiBhIHZhbGlkIGFmZmlsaWF0ZQogICAgLy8vIEBwYXJhbSBfaW52ZXN0b3IgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yCiAgICAvLy8gQHJldHVybiBUaGUgRXRoZXJldW0gYWRkcmVzcyBhcyBhbiBhZGRyZXNzIHR5cGUKICAgIGZ1bmN0aW9uIGdldEFmZmlsaWF0ZShhZGRyZXNzIF9pbnZlc3RvcikgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGFmZmlsaWF0ZXNbX2ludmVzdG9yXS5ldGhlckFkZHJlc3M7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIGlmIGFuIGFmZmlsaWF0ZSBpcyB2YWxpZAogICAgLy8vIEBwYXJhbSBfaW52ZXN0b3IgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yCiAgICAvLy8gQHJldHVybiBUcnVlIG9yIEZhbHNlCiAgICBmdW5jdGlvbiBpc0FmZmlsaWF0ZVZhbGlkKGFkZHJlc3MgX2ludmVzdG9yKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgQWZmaWxpYXRlIG1lbW9yeSBhZmZpbGlhdGUgPSBhZmZpbGlhdGVzW19pbnZlc3Rvcl07CiAgICAgICAgQWZmaWxpYXRlUmVjZWl2ZWQoYWZmaWxpYXRlLmV0aGVyQWRkcmVzcywgX2ludmVzdG9yLCBhZmZpbGlhdGUuaXNQcmVzZW50KTsKICAgICAgICByZXR1cm4gYWZmaWxpYXRlLmlzUHJlc2VudDsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5TYWxlIGlzIE93bmVkLCBUb2tlbkNvbnRyb2xsZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIFNIUCBwdWJsaWMgc2hwOwogICAgQWZmaWxpYXRlVXRpbGl0eSBwdWJsaWMgYWZmaWxpYXRlVXRpbGl0eTsKICAgIFRydXN0ZWUgcHVibGljIHRydXN0ZWU7CgogICAgYWRkcmVzcyBwdWJsaWMgZXRoZXJFc2Nyb3dBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5QWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIHRydXN0ZWVBZGRyZXNzOwoKICAgIHVpbnQyNTYgcHVibGljIGZvdW5kZXJUb2tlbkNvdW50ID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHJlc2VydmVUb2tlbkNvdW50ID0gMDsKCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBDQUxMRVJfRVhDSEFOR0VfUkFURSA9IDIwMDA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBSRVNFUlZFX0VYQ0hBTkdFX1JBVEUgPSAxNTAwOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgRk9VTkRFUl9FWENIQU5HRV9SQVRFID0gMTAwMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIEJPVU5UWV9FWENIQU5HRV9SQVRFID0gNTAwOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgTUFYX0dBU19QUklDRSA9IDUwMDAwMDAwMDAwOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZDsKICAgIGJvb2wgcHVibGljIGNsb3NlZDsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFwcHJvdmVkQWRkcmVzc2VzOwoKICAgIGV2ZW50IENvbnRyaWJ1dGlvbih1aW50MjU2IGV0aGVyQW1vdW50LCBhZGRyZXNzIF9jYWxsZXIpOwogICAgZXZlbnQgTmV3U2FsZShhZGRyZXNzIGluZGV4ZWQgY2FsbGVyLCB1aW50MjU2IGV0aGVyQW1vdW50LCB1aW50MjU2IHRva2Vuc0dlbmVyYXRlZCk7CiAgICBldmVudCBTYWxlQ2xvc2VkKHVpbnQyNTYgd2hlbik7CiAgICAKICAgIG1vZGlmaWVyIG5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90Q2xvc2VkKCkgewogICAgICAgIHJlcXVpcmUoIWNsb3NlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1ZhbGlkYXRlZCgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoIWlzQ29udHJhY3QobXNnLnNlbmRlcikpOyAKICAgICAgICByZXF1aXJlKHR4Lmdhc3ByaWNlIDw9IE1BWF9HQVNfUFJJQ0UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNBcHByb3ZlZCgpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmVkQWRkcmVzc2VzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFkZHMgYW4gYXBwcm92ZWQgYWRkcmVzcyBmb3IgdGhlIHNhbGUKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSBmb3IgY29udHJpYnV0aW9uCiAgICBmdW5jdGlvbiBhcHByb3ZlQWRkcmVzcyhhZGRyZXNzIF9hZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBhcHByb3ZlZEFkZHJlc3Nlc1tfYWRkcl0gPSB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHNlbmRzIHRoZSBFdGhlciByZWNlaXZlZCB0byB0aGUgRXRoZXIgZXNjcm93IGFkZHJlc3MKICAgIC8vLyBhbmQgZ2VuZXJhdGVzIHRoZSBjYWxjdWxhdGVkIG51bWJlciBvZiBTSFAgdG9rZW5zLCBzZW5kaW5nIHRoZW0gdG8gdGhlIGNhbGxlcidzIGFkZHJlc3MuCiAgICAvLy8gSXQgYWxzbyBnZW5lcmF0ZXMgdGhlIGZvdW5kZXIncyB0b2tlbnMgYW5kIHRoZSByZXNlcnZlIHRva2VucyBhdCB0aGUgc2FtZSB0aW1lLgogICAgZnVuY3Rpb24gZG9CdXkoCiAgICAgICAgYWRkcmVzcyBfY2FsbGVyLAogICAgICAgIHVpbnQyNTYgZXRoZXJBbW91bnQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgewoKICAgICAgICBDb250cmlidXRpb24oZXRoZXJBbW91bnQsIF9jYWxsZXIpOwoKICAgICAgICB1aW50MjU2IGNhbGxlclRva2VucyA9IGV0aGVyQW1vdW50Lm11bChDQUxMRVJfRVhDSEFOR0VfUkFURSk7CiAgICAgICAgdWludDI1NiBjYWxsZXJUb2tlbnNXaXRoRGlzY291bnQgPSBhcHBseURpc2NvdW50KGV0aGVyQW1vdW50LCBjYWxsZXJUb2tlbnMpOwoKICAgICAgICB1aW50MjU2IHJlc2VydmVUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoUkVTRVJWRV9FWENIQU5HRV9SQVRFKTsKICAgICAgICB1aW50MjU2IGZvdW5kZXJUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoRk9VTkRFUl9FWENIQU5HRV9SQVRFKTsKICAgICAgICB1aW50MjU2IGJvdW50eVRva2VucyA9IGV0aGVyQW1vdW50Lm11bChCT1VOVFlfRVhDSEFOR0VfUkFURSk7CiAgICAgICAgdWludDI1NiB2ZXN0aW5nVG9rZW5zID0gZm91bmRlclRva2Vucy5hZGQocmVzZXJ2ZVRva2Vucyk7CgogICAgICAgIGZvdW5kZXJUb2tlbkNvdW50ID0gZm91bmRlclRva2VuQ291bnQuYWRkKGZvdW5kZXJUb2tlbnMpOwogICAgICAgIHJlc2VydmVUb2tlbkNvdW50ID0gcmVzZXJ2ZVRva2VuQ291bnQuYWRkKHJlc2VydmVUb2tlbnMpOwoKICAgICAgICBwYXlBZmZpbGlhdGUoY2FsbGVyVG9rZW5zV2l0aERpc2NvdW50LCBtc2cudmFsdWUsIG1zZy5zZW5kZXIpOwoKICAgICAgICBzaHAuZ2VuZXJhdGVUb2tlbnMoX2NhbGxlciwgY2FsbGVyVG9rZW5zV2l0aERpc2NvdW50KTsKICAgICAgICBzaHAuZ2VuZXJhdGVUb2tlbnMoYm91bnR5QWRkcmVzcywgYm91bnR5VG9rZW5zKTsKICAgICAgICBzaHAuZ2VuZXJhdGVUb2tlbnModHJ1c3RlZUFkZHJlc3MsIHZlc3RpbmdUb2tlbnMpOwoKICAgICAgICBOZXdTYWxlKF9jYWxsZXIsIGV0aGVyQW1vdW50LCBjYWxsZXJUb2tlbnNXaXRoRGlzY291bnQpOwogICAgICAgIE5ld1NhbGUodHJ1c3RlZUFkZHJlc3MsIGV0aGVyQW1vdW50LCB2ZXN0aW5nVG9rZW5zKTsKICAgICAgICBOZXdTYWxlKGJvdW50eUFkZHJlc3MsIGV0aGVyQW1vdW50LCBib3VudHlUb2tlbnMpOwoKICAgICAgICBldGhlckVzY3Jvd0FkZHJlc3MudHJhbnNmZXIoZXRoZXJBbW91bnQpOwogICAgICAgIHVwZGF0ZUNvdW50ZXJzKGV0aGVyQW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBcHBsaWVzIHRoZSBkaXNjb3VudCBiYXNlZCBvbiB0aGUgZGlzY291bnQgdGllcnMKICAgIC8vLyBAcGFyYW0gX2V0aGVyQW1vdW50IFRoZSBhbW91bnQgb2YgZXRoZXIgdXNlZCB0byBldmFsdWF0ZSB0aGUgdGllciB0aGUgY29udHJpYnV0aW9uIGxpZXMgd2l0aGluCiAgICAvLy8gQHBhcmFtIF9jb250cmlidXRvclRva2VucyBUaGUgdG9rZW5zIGFsbG9jYXRlZCBiYXNlZCBvbiB0aGUgY29udHJpYnV0aW9uCiAgICBmdW5jdGlvbiBhcHBseURpc2NvdW50KHVpbnQyNTYgX2V0aGVyQW1vdW50LCB1aW50MjU2IF9jb250cmlidXRvclRva2VucykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlcyB0aGUgY291bnRlcnMgZm9yIHRoZSBhbW91bnQgb2YgRXRoZXIgcGFpZAogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICBmdW5jdGlvbiB1cGRhdGVDb3VudGVycyh1aW50MjU2IF9ldGhlckFtb3VudCkgaW50ZXJuYWw7CiAgICAKICAgIC8vLyBAbm90aWNlIFBhcmVudCBjb25zdHJ1Y3Rvci4gVGhpcyBuZWVkcyB0byBiZSBleHRlbmRlZCBmcm9tIHRoZSBjaGlsZCBjb250cmFjdHMKICAgIC8vLyBAcGFyYW0gX2V0aGVyRXNjcm93QWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgY3Jvd2QgZnVuZGVkIEV0aGVyCiAgICAvLy8gQHBhcmFtIF9ib3VudHlBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBib3VudHkgc2NoZW1lIFNIUAogICAgLy8vIEBwYXJhbSBfdHJ1c3RlZUFkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIHZlc3RpbmcgU0hQCiAgICAvLy8gQHBhcmFtIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcyBhZGRyZXNzIG9mIHRoZSBkZXBsb3llZCBBZmZpbGlhdGVVdGlsaXR5IGNvbnRyYWN0LgogICAgZnVuY3Rpb24gVG9rZW5TYWxlICgKICAgICAgICBhZGRyZXNzIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYm91bnR5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90cnVzdGVlQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9hZmZpbGlhdGVVdGlsaXR5QWRkcmVzcwogICAgKSB7CiAgICAgICAgZXRoZXJFc2Nyb3dBZGRyZXNzID0gX2V0aGVyRXNjcm93QWRkcmVzczsKICAgICAgICBib3VudHlBZGRyZXNzID0gX2JvdW50eUFkZHJlc3M7CiAgICAgICAgdHJ1c3RlZUFkZHJlc3MgPSBfdHJ1c3RlZUFkZHJlc3M7CiAgICAgICAgYWZmaWxpYXRlVXRpbGl0eSA9IEFmZmlsaWF0ZVV0aWxpdHkoX2FmZmlsaWF0ZVV0aWxpdHlBZGRyZXNzKTsKICAgICAgICB0cnVzdGVlID0gVHJ1c3RlZShfdHJ1c3RlZUFkZHJlc3MpOwogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICAgICAgY2xvc2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUGF5cyBhbiBhZmZpbGlhdGUgaWYgdGhleSBhcmUgdmFsaWQgYW5kIHByZXNlbnQgaW4gdGhlIHRyYW5zYWN0aW9uIGRhdGEKICAgIC8vLyBAcGFyYW0gX3Rva2VucyBUaGUgY29udHJpYnV0aW9uIHRva2VucyB1c2VkIHRvIGNhbGN1bGF0ZSBhZmZpbGlhdGUgcGF5bWVudCBhbW91bnQKICAgIC8vLyBAcGFyYW0gX2V0aGVyVmFsdWUgVGhlIEV0aGVyIHZhbHVlIHNlbnQKICAgIC8vLyBAcGFyYW0gX2NhbGxlciBUaGUgYWRkcmVzcyBvZiB0aGUgY2FsbGVyCiAgICBmdW5jdGlvbiBwYXlBZmZpbGlhdGUodWludDI1NiBfdG9rZW5zLCB1aW50MjU2IF9ldGhlclZhbHVlLCBhZGRyZXNzIF9jYWxsZXIpIGludGVybmFsIHsKICAgICAgICBpZiAoYWZmaWxpYXRlVXRpbGl0eS5pc0FmZmlsaWF0ZVZhbGlkKF9jYWxsZXIpKSB7CiAgICAgICAgICAgIGFkZHJlc3MgYWZmaWxpYXRlID0gYWZmaWxpYXRlVXRpbGl0eS5nZXRBZmZpbGlhdGUoX2NhbGxlcik7CiAgICAgICAgICAgIHZhciAoYWZmaWxpYXRlQm9udXMsIGNvbnRyaWJ1dG9yQm9udXMpID0gYWZmaWxpYXRlVXRpbGl0eS5hcHBseUFmZmlsaWF0ZShfY2FsbGVyLCBfdG9rZW5zLCBfZXRoZXJWYWx1ZSk7CiAgICAgICAgICAgIHNocC5nZW5lcmF0ZVRva2VucyhhZmZpbGlhdGUsIGFmZmlsaWF0ZUJvbnVzKTsKICAgICAgICAgICAgc2hwLmdlbmVyYXRlVG9rZW5zKF9jYWxsZXIsIGNvbnRyaWJ1dG9yQm9udXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXRzIHRoZSBTSFAgdG9rZW4gc21hcnQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX3NocCB0aGUgU0hQIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldFNocChhZGRyZXNzIF9zaHApIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHNocCA9IFNIUChfc2hwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgb3duZXJzaGlwIG9mIHRoZSB0b2tlbiBzbWFydCBjb250cmFjdCBhbmQgdHJ1c3RlZQogICAgLy8vIEBwYXJhbSBfdG9rZW5Db250cm9sbGVyIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJvbGxlcgogICAgLy8vIEBwYXJhbSBfdHJ1c3RlZU93bmVyIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdHJ1c3RlZSBvd25lcgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfdG9rZW5Db250cm9sbGVyLCBhZGRyZXNzIF90cnVzdGVlT3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoY2xvc2VkKTsKICAgICAgICByZXF1aXJlKF90b2tlbkNvbnRyb2xsZXIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90cnVzdGVlT3duZXIgIT0gMHgwKTsKICAgICAgICBzaHAuY2hhbmdlQ29udHJvbGxlcihfdG9rZW5Db250cm9sbGVyKTsKICAgICAgICB0cnVzdGVlLmNoYW5nZU93bmVyKF90cnVzdGVlT3duZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2NhbGxlciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBjYWxsZXJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfY2FsbGVyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfY2FsbGVyKSB9CiAgICAgICAgcmV0dXJuIHNpemUgPiAwOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFBhdXNlcyB0aGUgY29udHJpYnV0aW9uIGlmIHRoZXJlIGlzIGFueSBpc3N1ZQogICAgZnVuY3Rpb24gcGF1c2VDb250cmlidXRpb24oKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlc3VtZXMgdGhlIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gcmVzdW1lQ29udHJpYnV0aW9uKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gTWluaU1lIENvbnRyb2xsZXIgSW50ZXJmYWNlIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLwoKICAgIC8vIEluIGJldHdlZW4gdGhlIG9mZmVyaW5nIGFuZCB0aGUgbmV0d29yay4gRGVmYXVsdCBzZXR0aW5ncyBmb3IgYWxsb3dpbmcgdG9rZW4gdHJhbnNmZXJzLgogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzLCBhZGRyZXNzLCB1aW50MjU2KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcywgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IER5bmFtaWNDZWlsaW5nIGlzIE93bmVkIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cnVjdCBDZWlsaW5nIHsKICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgdWludDI1NiBsaW1pdDsKICAgICAgICB1aW50MjU2IHNsb3BlRmFjdG9yOwogICAgICAgIHVpbnQyNTYgY29sbGVjdE1pbmltdW07CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgc2FsZUFkZHJlc3M7CgogICAgQ2VpbGluZ1tdIHB1YmxpYyBjZWlsaW5nczsKICAgIAogICAgdWludDI1NiBwdWJsaWMgY3VycmVudEluZGV4OwogICAgdWludDI1NiBwdWJsaWMgcmV2ZWFsZWRDZWlsaW5nczsKICAgIGJvb2wgcHVibGljIGFsbFJldmVhbGVkOwoKICAgIG1vZGlmaWVyIG9ubHlTYWxlQWRkcmVzcyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNhbGVBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIER5bmFtaWNDZWlsaW5nKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zYWxlQWRkcmVzcykgewogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIHNhbGVBZGRyZXNzID0gX3NhbGVBZGRyZXNzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBieSB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgdG8gY29tbWl0CiAgICAvLy8gIGFsbCB0aGUgY2VpbGluZ3MuCiAgICAvLy8gQHBhcmFtIF9jZWlsaW5nSGFzaGVzIEFycmF5IG9mIGhhc2hlcyBvZiBlYWNoIGNlaWxpbmcuIEVhY2ggaGFzaCBpcyBjYWxjdWxhdGVkCiAgICAvLy8gIGJ5IHRoZSBgY2FsY3VsYXRlSGFzaGAgbWV0aG9kLiBNb3JlIGhhc2hlcyB0aGFuIGFjdHVhbCBjZWlsaW5ncyBjYW4gYmUKICAgIC8vLyAgY29tbWl0dGVkIGluIG9yZGVyIHRvIGhpZGUgYWxzbyB0aGUgbnVtYmVyIG9mIGNlaWxpbmdzLgogICAgLy8vICBUaGUgcmVtYWluaW5nIGhhc2hlcyBjYW4gYmUganVzdCByYW5kb20gbnVtYmVycy4KICAgIGZ1bmN0aW9uIHNldEhpZGRlbkNlaWxpbmdzKGJ5dGVzMzJbXSBfY2VpbGluZ0hhc2hlcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShjZWlsaW5ncy5sZW5ndGggPT0gMCk7CgogICAgICAgIGNlaWxpbmdzLmxlbmd0aCA9IF9jZWlsaW5nSGFzaGVzLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfY2VpbGluZ0hhc2hlcy5sZW5ndGg7IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICBjZWlsaW5nc1tpXS5oYXNoID0gX2NlaWxpbmdIYXNoZXNbaV07CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIEFueWJvZHkgY2FuIHJldmVhbCB0aGUgbmV4dCBjZWlsaW5nIGlmIGhlIGtub3dzIGl0LgogICAgLy8vIEBwYXJhbSBfbGltaXQgQ2VpbGluZyBjYXAuCiAgICAvLy8gIChtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIHByZXZpb3VzIG9uZSkuCiAgICAvLy8gQHBhcmFtIF9sYXN0IGB0cnVlYCBpZiBpdCdzIHRoZSBsYXN0IGNlaWxpbmcuCiAgICAvLy8gQHBhcmFtIF9zYWx0IFJhbmRvbSBudW1iZXIgdXNlZCB0byBjb21taXQgdGhlIGNlaWxpbmcKICAgIGZ1bmN0aW9uIHJldmVhbENlaWxpbmcoCiAgICAgICAgdWludDI1NiBfbGltaXQsIAogICAgICAgIHVpbnQyNTYgX3Nsb3BlRmFjdG9yLCAKICAgICAgICB1aW50MjU2IF9jb2xsZWN0TWluaW11bSwKICAgICAgICBib29sIF9sYXN0LCAKICAgICAgICBieXRlczMyIF9zYWx0KSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgewogICAgICAgIHJlcXVpcmUoIWFsbFJldmVhbGVkKTsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBjZWlsaW5nc1tyZXZlYWxlZENlaWxpbmdzXS5oYXNoID09IAogICAgICAgICAgICBjYWxjdWxhdGVIYXNoKAogICAgICAgICAgICAgICAgX2xpbWl0LCAKICAgICAgICAgICAgICAgIF9zbG9wZUZhY3RvciwgCiAgICAgICAgICAgICAgICBfY29sbGVjdE1pbmltdW0sIAogICAgICAgICAgICAgICAgX2xhc3QsIAogICAgICAgICAgICAgICAgX3NhbHQKICAgICAgICAgICAgKQogICAgICAgICk7CgogICAgICAgIHJlcXVpcmUoX2xpbWl0ICE9IDAgJiYgX3Nsb3BlRmFjdG9yICE9IDAgJiYgX2NvbGxlY3RNaW5pbXVtICE9IDApOwogICAgICAgIGlmIChyZXZlYWxlZENlaWxpbmdzID4gMCkgewogICAgICAgICAgICByZXF1aXJlKF9saW1pdCA+PSBjZWlsaW5nc1tyZXZlYWxlZENlaWxpbmdzLnN1YigxKV0ubGltaXQpOwogICAgICAgIH0KCiAgICAgICAgY2VpbGluZ3NbcmV2ZWFsZWRDZWlsaW5nc10ubGltaXQgPSBfbGltaXQ7CiAgICAgICAgY2VpbGluZ3NbcmV2ZWFsZWRDZWlsaW5nc10uc2xvcGVGYWN0b3IgPSBfc2xvcGVGYWN0b3I7CiAgICAgICAgY2VpbGluZ3NbcmV2ZWFsZWRDZWlsaW5nc10uY29sbGVjdE1pbmltdW0gPSBfY29sbGVjdE1pbmltdW07CiAgICAgICAgcmV2ZWFsZWRDZWlsaW5ncyA9IHJldmVhbGVkQ2VpbGluZ3MuYWRkKDEpOwoKICAgICAgICBpZiAoX2xhc3QpIHsKICAgICAgICAgICAgYWxsUmV2ZWFsZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXZlYWwgbXVsdGlwbGUgY2VpbGluZ3MgYXQgb25jZQogICAgZnVuY3Rpb24gcmV2ZWFsTXVsdGkoCiAgICAgICAgdWludDI1NltdIF9saW1pdHMsCiAgICAgICAgdWludDI1NltdIF9zbG9wZUZhY3RvcnMsCiAgICAgICAgdWludDI1NltdIF9jb2xsZWN0TWluaW11bXMsCiAgICAgICAgYm9vbFtdIF9sYXN0cywgCiAgICAgICAgYnl0ZXMzMltdIF9zYWx0cykgCiAgICAgICAgcHVibGljIAogICAgICAgIHsKICAgICAgICAvLyBEbyBub3QgYWxsb3cgbm9uZSBhbmQgbmVlZHMgdG8gYmUgc2FtZSBsZW5ndGggZm9yIGFsbCBwYXJhbWV0ZXJzCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgX2xpbWl0cy5sZW5ndGggIT0gMCAmJgogICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfc2xvcGVGYWN0b3JzLmxlbmd0aCAmJgogICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfY29sbGVjdE1pbmltdW1zLmxlbmd0aCAmJgogICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfbGFzdHMubGVuZ3RoICYmCiAgICAgICAgICAgIF9saW1pdHMubGVuZ3RoID09IF9zYWx0cy5sZW5ndGgKICAgICAgICApOwoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfbGltaXRzLmxlbmd0aDsgaSA9IGkuYWRkKDEpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXZlYWxDZWlsaW5nKAogICAgICAgICAgICAgICAgX2xpbWl0c1tpXSwKICAgICAgICAgICAgICAgIF9zbG9wZUZhY3RvcnNbaV0sCiAgICAgICAgICAgICAgICBfY29sbGVjdE1pbmltdW1zW2ldLAogICAgICAgICAgICAgICAgX2xhc3RzW2ldLAogICAgICAgICAgICAgICAgX3NhbHRzW2ldCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIE1vdmUgdG8gY2VpbGluZywgdXNlZCBhcyBhIGZhaWxzYWZlCiAgICBmdW5jdGlvbiBtb3ZlVG9OZXh0Q2VpbGluZygpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgICAgICBjdXJyZW50SW5kZXggPSBjdXJyZW50SW5kZXguYWRkKDEpOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIFJldHVybiB0aGUgZnVuZHMgdG8gY29sbGVjdCBmb3IgdGhlIGN1cnJlbnQgcG9pbnQgb24gdGhlIGNlaWxpbmcKICAgIC8vLyAgKG9yIDAgaWYgbm8gY2VpbGluZ3MgcmV2ZWFsZWQgeWV0KQogICAgZnVuY3Rpb24gYXZhaWxhYmxlQW1vdW50VG9Db2xsZWN0KHVpbnQyNTYgIHRvdGFsbENvbGxlY3RlZCkgcHVibGljIG9ubHlTYWxlQWRkcmVzcyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAKICAgICAgICBpZiAocmV2ZWFsZWRDZWlsaW5ncyA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRvdGFsbENvbGxlY3RlZCA+PSBjZWlsaW5nc1tjdXJyZW50SW5kZXhdLmxpbWl0KSB7ICAKICAgICAgICAgICAgdWludDI1NiBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXguYWRkKDEpOwoKICAgICAgICAgICAgaWYgKG5leHRJbmRleCA+PSByZXZlYWxlZENlaWxpbmdzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3VycmVudEluZGV4ID0gbmV4dEluZGV4OwogICAgICAgICAgICBpZiAodG90YWxsQ29sbGVjdGVkID49IGNlaWxpbmdzW2N1cnJlbnRJbmRleF0ubGltaXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOyAgCiAgICAgICAgICAgIH0KICAgICAgICB9ICAgICAgICAKICAgICAgICB1aW50MjU2IHJlbWFpbmVkRnJvbUN1cnJlbnRDZWlsaW5nID0gY2VpbGluZ3NbY3VycmVudEluZGV4XS5saW1pdC5zdWIodG90YWxsQ29sbGVjdGVkKTsKICAgICAgICB1aW50MjU2IHJlbWluZGVyV2l0aFNsb3BlRmFjdG9yID0gcmVtYWluZWRGcm9tQ3VycmVudENlaWxpbmcuZGl2KGNlaWxpbmdzW2N1cnJlbnRJbmRleF0uc2xvcGVGYWN0b3IpOwoKICAgICAgICBpZiAocmVtaW5kZXJXaXRoU2xvcGVGYWN0b3IgPiBjZWlsaW5nc1tjdXJyZW50SW5kZXhdLmNvbGxlY3RNaW5pbXVtKSB7CiAgICAgICAgICAgIHJldHVybiByZW1pbmRlcldpdGhTbG9wZUZhY3RvcjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJlbWFpbmVkRnJvbUN1cnJlbnRDZWlsaW5nID4gY2VpbGluZ3NbY3VycmVudEluZGV4XS5jb2xsZWN0TWluaW11bSkgewogICAgICAgICAgICByZXR1cm4gY2VpbGluZ3NbY3VycmVudEluZGV4XS5jb2xsZWN0TWluaW11bTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gcmVtYWluZWRGcm9tQ3VycmVudENlaWxpbmc7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZXMgdGhlIGhhc2ggb2YgYSBjZWlsaW5nLgogICAgLy8vIEBwYXJhbSBfbGltaXQgQ2VpbGluZyBjYXAuCiAgICAvLy8gQHBhcmFtIF9sYXN0IGB0cnVlYCBpZiBpdCdzIHRoZSBsYXN0IGNlaWxpbmcuCiAgICAvLy8gQHBhcmFtIF9jb2xsZWN0TWluaW11bSB0aGUgbWluaW11bSBhbW91bnQgdG8gY29sbGVjdAogICAgLy8vIEBwYXJhbSBfc2FsdCBSYW5kb20gbnVtYmVyIHRoYXQgd2lsbCBiZSBuZWVkZWQgdG8gcmV2ZWFsIHRoaXMgY2VpbGluZy4KICAgIC8vLyBAcmV0dXJuIFRoZSBjYWxjdWxhdGVkIGhhc2ggb2YgdGhpcyBjZWlsaW5nIHRvIGJlIHVzZWQgaW4gdGhlIGBzZXRIaWRkZW5DdXJ2ZXNgIG1ldGhvZAogICAgZnVuY3Rpb24gY2FsY3VsYXRlSGFzaCgKICAgICAgICB1aW50MjU2IF9saW1pdCwgCiAgICAgICAgdWludDI1NiBfc2xvcGVGYWN0b3IsIAogICAgICAgIHVpbnQyNTYgX2NvbGxlY3RNaW5pbXVtLAogICAgICAgIGJvb2wgX2xhc3QsIAogICAgICAgIGJ5dGVzMzIgX3NhbHQpIAogICAgICAgIHB1YmxpYyAKICAgICAgICBjb25zdGFudCAKICAgICAgICByZXR1cm5zIChieXRlczMyKSAKICAgICAgICB7CiAgICAgICAgcmV0dXJuIGtlY2NhazI1NigKICAgICAgICAgICAgX2xpbWl0LAogICAgICAgICAgICBfc2xvcGVGYWN0b3IsIAogICAgICAgICAgICBfY29sbGVjdE1pbmltdW0sCiAgICAgICAgICAgIF9sYXN0LAogICAgICAgICAgICBfc2FsdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEByZXR1cm4gUmV0dXJuIHRoZSB0b3RhbCBudW1iZXIgb2YgY2VpbGluZ3MgY29tbWl0dGVkCiAgICAvLy8gIChjYW4gYmUgbGFyZ2VyIHRoYW4gdGhlIG51bWJlciBvZiBhY3R1YWwgY2VpbGluZ3Mgb24gdGhlIGNlaWxpbmcgdG8gaGlkZQogICAgLy8vICB0aGUgcmVhbCBudW1iZXIgb2YgY2VpbGluZ3MpCiAgICBmdW5jdGlvbiBuQ2VpbGluZ3MoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjZWlsaW5ncy5sZW5ndGg7CiAgICB9Cgp9Cgpjb250cmFjdCBTaGFycGVQcmVzYWxlIGlzIFRva2VuU2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKIAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB3aGl0ZWxpc3Q7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIHByZVNhbGVFdGhlclBhaWQgPSAwOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxDb250cmlidXRpb25zID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMgPSAwOwoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIEZJUlNUX1RJRVJfRElTQ09VTlQgPSAxMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFNFQ09ORF9USUVSX0RJU0NPVU5UID0gMjA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBUSElSRF9USUVSX0RJU0NPVU5UID0gMzA7CgogICAgdWludDI1NiBwdWJsaWMgbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwoKICAgIHVpbnQyNTYgcHVibGljIGZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CgogICAgdWludDI1NiBwdWJsaWMgcHJlU2FsZUNhcDsKICAgIHVpbnQyNTYgcHVibGljIGhvbm91cldoaXRlbGlzdEVuZDsKCiAgICBhZGRyZXNzIHB1YmxpYyBwcmVzYWxlQWRkcmVzczsKICAgIAogICAgZW51bSBDb250cmlidXRpb25TdGF0ZSB7UGF1c2VkLCBSZXN1bWVkfQogICAgZXZlbnQgQ29udHJpYnV0aW9uU3RhdGVDaGFuZ2VkKGFkZHJlc3MgY2FsbGVyLCBDb250cmlidXRpb25TdGF0ZSBjb250cmlidXRpb25TdGF0ZSk7CiAgICBlbnVtIEFsbG93ZWRDb250cmlidXRpb25TdGF0ZSB7V2hpdGVsaXN0ZWQsIE5vdFdoaXRlbGlzdGVkLCBBYm92ZVdoaXRlbGlzdGVkLCBCZWxvd1doaXRlbGlzdGVkLCBXaGl0ZWxpc3RDbG9zZWR9CiAgICBldmVudCBBbGxvd2VkQ29udHJpYnV0aW9uQ2hlY2sodWludDI1NiBjb250cmlidXRpb24sIEFsbG93ZWRDb250cmlidXRpb25TdGF0ZSBhbGxvd2VkQ29udHJpYnV0aW9uU3RhdGUpOwogICAgZXZlbnQgVmFsaWRDb250cmlidXRpb25DaGVjayh1aW50MjU2IGNvbnRyaWJ1dGlvbiwgYm9vbCBpc0NvbnRyaWJ1dGlvblZhbGlkKTsKICAgIGV2ZW50IERpc2NvdW50QXBwbGllZCh1aW50MjU2IGV0aGVyQW1vdW50LCB1aW50MjU2IHRva2VucywgdWludDI1NiBkaXNjb3VudCk7CiAgICBldmVudCBDb250cmlidXRpb25SZWZ1bmQodWludDI1NiBldGhlckFtb3VudCwgYWRkcmVzcyBfY2FsbGVyKTsKICAgIGV2ZW50IENvdW50ZXJzVXBkYXRlZCh1aW50MjU2IHByZVNhbGVFdGhlclBhaWQsIHVpbnQyNTYgdG90YWxDb250cmlidXRpb25zKTsKICAgIGV2ZW50IFdoaXRlbGlzdGVkVXBkYXRlZCh1aW50MjU2IHBsYW5uZWRDb250cmlidXRpb24sIGJvb2wgY29udHJpYnV0ZWQpOwogICAgZXZlbnQgV2hpdGVsaXN0ZWRDb3VudGVyVXBkYXRlZCh1aW50MjU2IHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMsIHVpbnQyNTYgdXNlZENvbnRyaWJ1dGlvbnMpOwoKICAgIG1vZGlmaWVyIGlzVmFsaWRDb250cmlidXRpb24oKSB7CiAgICAgICAgcmVxdWlyZSh2YWxpZENvbnRyaWJ1dGlvbigpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGNhbGxlZCBvbmx5IG9uY2Ugd2hlbiB0aGUgY29udHJhY3QgaXMgaW5pdGlhbGl6ZWQKICAgIC8vLyBAcGFyYW0gX2V0aGVyRXNjcm93QWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgY3Jvd2QgZnVuZGVkIEV0aGVyCiAgICAvLy8gQHBhcmFtIF9ib3VudHlBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBib3VudHkgU0hQCiAgICAvLy8gQHBhcmFtIF90cnVzdGVlQWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgdmVzdGluZyBTSFAKICAgIC8vLyBAcGFyYW0gX2ZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyIEZpcnN0IGRpc2NvdW50IGxpbWl0cyAoV0VJKQogICAgLy8vIEBwYXJhbSBfc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyIFNlY29uZCBkaXNjb3VudCBsaW1pdHMgKFdFSSkKICAgIC8vLyBAcGFyYW0gX3RoaXJkVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyIFRoaXJkIGRpc2NvdW50IGxpbWl0cyAoV0VJKQogICAgLy8vIEBwYXJhbSBfbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyIExvd2VyIGNvbnRyaWJ1dGlvbiByYW5nZSAoV0VJKQogICAgLy8vIEBwYXJhbSBfbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyIFVwcGVyIGNvbnRyaWJ1dGlvbiByYW5nZSAoV0VJKQogICAgLy8vIEBwYXJhbSBfcHJlU2FsZUNhcCBQcmVzYWxlIGNhcCAoV0VJKQogICAgLy8vIEBwYXJhbSBfaG9ub3VyV2hpdGVsaXN0RW5kIEVuZCB0aW1lIG9mIHdoaXRlbGlzdCBwZXJpb2QKICAgIGZ1bmN0aW9uIFNoYXJwZVByZXNhbGUoCiAgICAgICAgYWRkcmVzcyBfZXRoZXJFc2Nyb3dBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX2JvdW50eUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfdHJ1c3RlZUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYWZmaWxpYXRlVXRpbGl0eUFkZHJlc3MsCiAgICAgICAgdWludDI1NiBfZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIsCiAgICAgICAgdWludDI1NiBfc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyLAogICAgICAgIHVpbnQyNTYgX3RoaXJkVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyLAogICAgICAgIHVpbnQyNTYgX21pblByZXNhbGVDb250cmlidXRpb25FdGhlciwKICAgICAgICB1aW50MjU2IF9tYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIsCiAgICAgICAgdWludDI1NiBfcHJlU2FsZUNhcCwKICAgICAgICB1aW50MjU2IF9ob25vdXJXaGl0ZWxpc3RFbmQpCiAgICAgICAgVG9rZW5TYWxlICgKICAgICAgICAgICAgX2V0aGVyRXNjcm93QWRkcmVzcywKICAgICAgICAgICAgX2JvdW50eUFkZHJlc3MsCiAgICAgICAgICAgIF90cnVzdGVlQWRkcmVzcywKICAgICAgICAgICAgX2FmZmlsaWF0ZVV0aWxpdHlBZGRyZXNzCiAgICAgICAgKQogICAgewogICAgICAgIGhvbm91cldoaXRlbGlzdEVuZCA9IF9ob25vdXJXaGl0ZWxpc3RFbmQ7CiAgICAgICAgcHJlc2FsZUFkZHJlc3MgPSBhZGRyZXNzKHRoaXMpOwogICAgICAgIGZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyID0gX2ZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgICAgIHNlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciA9IF9zZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICAgICAgdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgPSBfdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICAgICAgbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyID0gX21pblByZXNhbGVDb250cmlidXRpb25FdGhlcjsKICAgICAgICBtYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgPSBfbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwogICAgICAgIHByZVNhbGVDYXAgPSBfcHJlU2FsZUNhcDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBZGRzIHRvIHRoZSB3aGl0ZWxpc3QKICAgIC8vLyBAcGFyYW0gX3NlbmRlciBUaGUgYWRkcmVzcyB0byB3aGl0ZWxpc3QKICAgIC8vLyBAcGFyYW0gX3BsYW5uZWRDb250cmlidXRpb24gVGhlIHBsYW5uZWQgY29udHJpYnV0aW9uIChXRUkpCiAgICBmdW5jdGlvbiBhZGRUb1doaXRlbGlzdChhZGRyZXNzIF9zZW5kZXIsIHVpbnQyNTYgX3BsYW5uZWRDb250cmlidXRpb24pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUod2hpdGVsaXN0W19zZW5kZXJdID09IDApOwogICAgICAgIAogICAgICAgIHdoaXRlbGlzdFtfc2VuZGVyXSA9IF9wbGFubmVkQ29udHJpYnV0aW9uOwogICAgICAgIHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMgPSB3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zLmFkZChfcGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiBmaXJlcyB3aGVuIHNvbWVvbmUgc2VuZHMgRXRoZXIgdG8gdGhlIGFkZHJlc3Mgb2YgdGhpcyBjb250cmFjdC4KICAgIC8vLyBUaGUgRVRIIHdpbGwgYmUgZXhjaGFuZ2VkIGZvciBTSFAgYW5kIGl0IGVuc3VyZXMgY29udHJpYnV0aW9ucyBjYW5ub3QgYmUgbWFkZSBmcm9tIGtub3duIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uICgpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIGlzVmFsaWRhdGVkCiAgICAgICAgbm90Q2xvc2VkCiAgICAgICAgbm90UGF1c2VkCiAgICAgICAgaXNBcHByb3ZlZAogICAgewogICAgICAgIGFkZHJlc3MgY2FsbGVyID0gbXNnLnNlbmRlcjsKICAgICAgICBwcm9jZXNzUHJlU2FsZShjYWxsZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFByb2Nlc3NlcyB0aGUgcHJlc2FsZSBpZiB0aGUgYWxsb3dlZCBjb250cmlidXRpb24gaXMgbW9yZSB0aGFuIHplcm8KICAgIC8vLyBAcGFyYW0gX2NhbGxlciB0aGUgYWRkcmVzcyBzZW5kaW5nIHRoZSBFdGhlcgogICAgZnVuY3Rpb24gcHJvY2Vzc1ByZVNhbGUoYWRkcmVzcyBfY2FsbGVyKSBwcml2YXRlIHsKICAgICAgICB2YXIgKGFsbG93ZWRDb250cmlidXRpb24sIHJlZnVuZEFtb3VudCkgPSBwcm9jZXNzQ29udHJpYnV0aW9uKCk7CiAgICAgICAgYXNzZXJ0KG1zZy52YWx1ZT09YWxsb3dlZENvbnRyaWJ1dGlvbi5hZGQocmVmdW5kQW1vdW50KSk7CiAgICAgICAgaWYgKGFsbG93ZWRDb250cmlidXRpb24gPiAwKSB7CiAgICAgICAgICAgIGRvQnV5KF9jYWxsZXIsIGFsbG93ZWRDb250cmlidXRpb24pOwogICAgICAgICAgICBpZiAocmVmdW5kQW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihyZWZ1bmRBbW91bnQpOwogICAgICAgICAgICAgICAgY2xvc2VQcmVTYWxlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENvdmVyaW5nIHRoZSBlZGdlIGNhc2Ugd2hlcmUgdGhlIGxhc3QgY29udHJpYnV0aW9uIGVxdWFscyB0aGUgcmVtYWluaW5nIGNhcAogICAgICAgICAgICB1aW50MjU2IHRpbGxDYXAgPSByZW1haW5pbmdDYXAoKTsKICAgICAgICAgICAgaWYgKHRpbGxDYXAgPT0gMCkgewogICAgICAgICAgICAgICAgY2xvc2VQcmVTYWxlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdHJ1ZSBpZiB0aGUgd2hpdGVsaXN0IHBlcmlvZCBpcyBzdGlsbCBhY3RpdmUsIGZhbHNlIG90aGVyd2lzZS4KICAgIC8vLyBXaGVuIHdoaXRlbGlzdCBwZXJpb2QgZW5kcywgaXQgd2lsbCB0cmFuc2ZlciBhbnkgdW5jbGFpbWVkIHBsYW5uZWQgY29udHJpYnV0aW9ucyB0byB0aGUgcHJlLXNhbGUgY2FwLiAKICAgIGZ1bmN0aW9uIGhvbm91cldoaXRlbGlzdCgpIHByaXZhdGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgaG9ub3VyV2hpdGVsaXN0ID0gdHJ1ZTsKICAgICAgICBpZiAoaG9ub3VyV2hpdGVsaXN0RW5kIDw9IG5vdykgewogICAgICAgICAgICBob25vdXJXaGl0ZWxpc3QgPSBmYWxzZTsKICAgICAgICAgICAgcHJlU2FsZUNhcCA9IHByZVNhbGVDYXAuYWRkKHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMpOwogICAgICAgICAgICB3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zID0gMDsKICAgICAgICAgICAgV2hpdGVsaXN0ZWRDb3VudGVyVXBkYXRlZCh3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zLCAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhvbm91cldoaXRlbGlzdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBjb250cmlidXRpb24gdG8gYmUgdXNlZCBhcyBwYXJ0IG9mIHRoZSB0cmFuc2FjdGlvbiwgYW5kIGFueSByZWZ1bmQgdmFsdWUgaWYgZXhwZWN0ZWQuICAKICAgIGZ1bmN0aW9uIHByb2Nlc3NDb250cmlidXRpb24oKSBwcml2YXRlIGlzVmFsaWRDb250cmlidXRpb24gcmV0dXJucyAodWludDI1NiwgdWludDI1NikgewogICAgICAgIHZhciAoYWxsb3dlZENvbnRyaWJ1dGlvbiwgcmVmdW5kQW1vdW50KSA9IGdldEFsbG93ZWRDb250cmlidXRpb24oKTsKICAgICAgICAKICAgICAgICBpZiAoIWhvbm91cldoaXRlbGlzdCgpKSB7CiAgICAgICAgICAgIEFsbG93ZWRDb250cmlidXRpb25DaGVjayhhbGxvd2VkQ29udHJpYnV0aW9uLCBBbGxvd2VkQ29udHJpYnV0aW9uU3RhdGUuV2hpdGVsaXN0Q2xvc2VkKTsKICAgICAgICAgICAgcmV0dXJuIChhbGxvd2VkQ29udHJpYnV0aW9uLCByZWZ1bmRBbW91bnQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAod2hpdGVsaXN0W21zZy5zZW5kZXJdID4gMCkgewogICAgICAgICAgICByZXR1cm4gcHJvY2Vzc1doaXRlbGlzdGVkQ29udHJpYnV0aW9uKGFsbG93ZWRDb250cmlidXRpb24sIHJlZnVuZEFtb3VudCk7CiAgICAgICAgfSAKCiAgICAgICAgQWxsb3dlZENvbnRyaWJ1dGlvbkNoZWNrKGFsbG93ZWRDb250cmlidXRpb24sIEFsbG93ZWRDb250cmlidXRpb25TdGF0ZS5Ob3RXaGl0ZWxpc3RlZCk7CiAgICAgICAgcmV0dXJuIChhbGxvd2VkQ29udHJpYnV0aW9uLCByZWZ1bmRBbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGNvbnRyaWJ1dGlvbiB0byBiZSB1c2VkIGZvciBhIHNlbmRlciB0aGF0IGhhZCBwcmV2aW91c2x5IGJlZW4gd2hpdGVsaXN0ZWQsIGFuZCBhbnkgcmVmdW5kIHZhbHVlIGlmIGV4cGVjdGVkLgogICAgZnVuY3Rpb24gcHJvY2Vzc1doaXRlbGlzdGVkQ29udHJpYnV0aW9uKHVpbnQyNTYgYWxsb3dlZENvbnRyaWJ1dGlvbiwgdWludDI1NiByZWZ1bmRBbW91bnQpIHByaXZhdGUgcmV0dXJucyAodWludDI1NiwgdWludDI1NikgewogICAgICAgIHVpbnQyNTYgcGxhbm5lZENvbnRyaWJ1dGlvbiA9IHdoaXRlbGlzdFttc2cuc2VuZGVyXTsKICAgICAgICAKICAgICAgICB3aGl0ZWxpc3RbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIFdoaXRlbGlzdGVkVXBkYXRlZChwbGFubmVkQ29udHJpYnV0aW9uLCB0cnVlKTsKICAgICAgICAKICAgICAgICBpZiAobXNnLnZhbHVlID4gcGxhbm5lZENvbnRyaWJ1dGlvbikgewogICAgICAgICAgICByZXR1cm4gaGFuZGxlQWJvdmVQbGFubmVkV2hpdGVsaXN0ZWRDb250cmlidXRpb24oYWxsb3dlZENvbnRyaWJ1dGlvbiwgcGxhbm5lZENvbnRyaWJ1dGlvbiwgcmVmdW5kQW1vdW50KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG1zZy52YWx1ZSA8IHBsYW5uZWRDb250cmlidXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUJlbG93UGxhbm5lZFdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHBsYW5uZWRDb250cmlidXRpb24pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gaGFuZGxlUGxhbm5lZFdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHBsYW5uZWRDb250cmlidXRpb24pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGNvbnRyaWJ1dGlvbiBhbmQgcmVmdW5kIHZhbHVlIHRvIGJlIHVzZWQgd2hlbiB0aGUgdHJhbnNhY3Rpb24gdmFsdWUgZXF1YWxzIHRoZSB3aGl0ZWxpc3RlZCBjb250cmlidXRpb24gZm9yIHRoZSBzZW5kZXIuCiAgICAvLy8gTm90ZSB0aGF0IHJlZnVuZCB2YWx1ZSB3aWxsIGFsd2F5cyBiZSAwIGluIHRoaXMgY2FzZSwgYXMgdGhlIHBsYW5uZWQgY29udHJpYnV0aW9uIGZvciB0aGUgc2VuZGVyIGFuZCB0cmFuc2FjdGlvbiB2YWx1ZSBtYXRjaC4KICAgIGZ1bmN0aW9uIGhhbmRsZVBsYW5uZWRXaGl0ZWxpc3RlZENvbnRyaWJ1dGlvbih1aW50MjU2IHBsYW5uZWRDb250cmlidXRpb24pIHByaXZhdGUgcmV0dXJucyAodWludDI1NiwgdWludDI1NikgewogICAgICAgIHVwZGF0ZVdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHBsYW5uZWRDb250cmlidXRpb24pOwogICAgICAgIEFsbG93ZWRDb250cmlidXRpb25DaGVjayhwbGFubmVkQ29udHJpYnV0aW9uLCBBbGxvd2VkQ29udHJpYnV0aW9uU3RhdGUuV2hpdGVsaXN0ZWQpOwogICAgICAgIHJldHVybiAocGxhbm5lZENvbnRyaWJ1dGlvbiwgMCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGNvbnRyaWJ1dGlvbiBhbmQgcmVmdW5kIHZhbHVlIHRvIGJlIHVzZWQgd2hlbiB0aGUgdHJhbnNhY3Rpb24gdmFsdWUgaXMgaGlnaGVyIHRoYW4gdGhlIHdoaXRlbGlzdGVkIGNvbnRyaWJ1dGlvbiBmb3IgdGhlIHNlbmRlci4KICAgIC8vLyBOb3RlIHRoYXQgb25seSBpbiB0aGlzIGNhc2UsIHRoZSByZWZ1bmQgdmFsdWUgd2lsbCBub3QgYmUgMC4KICAgIGZ1bmN0aW9uIGhhbmRsZUFib3ZlUGxhbm5lZFdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHVpbnQyNTYgYWxsb3dlZENvbnRyaWJ1dGlvbiwgdWludDI1NiBwbGFubmVkQ29udHJpYnV0aW9uLCB1aW50MjU2IHJlZnVuZEFtb3VudCkgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdXBkYXRlV2hpdGVsaXN0ZWRDb250cmlidXRpb24ocGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICAgICAgQWxsb3dlZENvbnRyaWJ1dGlvbkNoZWNrKGFsbG93ZWRDb250cmlidXRpb24sIEFsbG93ZWRDb250cmlidXRpb25TdGF0ZS5BYm92ZVdoaXRlbGlzdGVkKTsKICAgICAgICByZXR1cm4gKGFsbG93ZWRDb250cmlidXRpb24sIHJlZnVuZEFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgY29udHJpYnV0aW9uIGFuZCByZWZ1bmQgdmFsdWUgdG8gYmUgdXNlZCB3aGVuIHRoZSB0cmFuc2FjdGlvbiB2YWx1ZSBpcyBsb3dlciB0aGFuIHRoZSB3aGl0ZWxpc3RlZCBjb250cmlidXRpb24gZm9yIHRoZSBzZW5kZXIuCiAgICAvLy8gTm90ZSB0aGF0IHJlZnVuZCB2YWx1ZSB3aWxsIGFsd2F5cyBiZSAwIGluIHRoaXMgY2FzZSwgYXMgdHJhbnNhY3Rpb24gdmFsdWUgaXMgYmVsb3cgdGhlIHBsYW5uZWQgY29udHJpYnV0aW9uIGZvciB0aGlzIHNlbmRlci4KICAgIGZ1bmN0aW9uIGhhbmRsZUJlbG93UGxhbm5lZFdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHVpbnQyNTYgcGxhbm5lZENvbnRyaWJ1dGlvbikgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBiZWxvd1BsYW5uZWQgPSBwbGFubmVkQ29udHJpYnV0aW9uLnN1Yihtc2cudmFsdWUpOwogICAgICAgIHByZVNhbGVDYXAgPSBwcmVTYWxlQ2FwLmFkZChiZWxvd1BsYW5uZWQpOwogICAgICAgIAogICAgICAgIHVwZGF0ZVdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKG1zZy52YWx1ZSk7CiAgICAgICAgQWxsb3dlZENvbnRyaWJ1dGlvbkNoZWNrKG1zZy52YWx1ZSwgQWxsb3dlZENvbnRyaWJ1dGlvblN0YXRlLkJlbG93V2hpdGVsaXN0ZWQpOwogICAgICAgIHJldHVybiAobXNnLnZhbHVlLCAwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBVcGRhdGVzIHRoZSB3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zIGNvdW50ZXIsIHN1YnRyYWN0aW5nIHRoZSBjb250cmlidXRpb24gYWJvdXQgdG8gYmUgYXBwbGllZC4KICAgIGZ1bmN0aW9uIHVwZGF0ZVdoaXRlbGlzdGVkQ29udHJpYnV0aW9uKHVpbnQyNTYgcGxhbm5lZENvbnRyaWJ1dGlvbikgcHJpdmF0ZSB7CiAgICAgICAgd2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucyA9IHdoaXRlbGlzdGVkUGxhbm5lZENvbnRyaWJ1dGlvbnMuc3ViKHBsYW5uZWRDb250cmlidXRpb24pOwogICAgICAgIFdoaXRlbGlzdGVkQ291bnRlclVwZGF0ZWQod2hpdGVsaXN0ZWRQbGFubmVkQ29udHJpYnV0aW9ucywgcGxhbm5lZENvbnRyaWJ1dGlvbik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlcyB0aGUgYWxsb3dlZCBjb250cmlidXRpb24gYmFzZWQgb24gdGhlIHRyYW5zYWN0aW9uIHZhbHVlIGFuZCBhbW91bnQgcmVtYWluaW5nIHRpbGwgY2FwLgogICAgLy8vIElmIHRoZSB0cmFuc2FjdGlvbiBjb250cmlidXRpb24gaXMgaGlnaGVyIHRoYW4gY2FwLCB3aWxsIHJldHVybiB0aGUgZXhjZXNzIGFtb3VudCB0byBiZSByZWZ1bmRlZCB0byBzZW5kZXIuCiAgICAvLy8gQHJldHVybiB0aGUgYWxsb3dlZCBjb250cmlidXRpb24gYW5kIHJlZnVuZCBhbW91bnQgKGlmIGFueSkuIEFsbCBpbiBXRUkuCiAgICBmdW5jdGlvbiBnZXRBbGxvd2VkQ29udHJpYnV0aW9uKCkgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBhbGxvd2VkQ29udHJpYnV0aW9uID0gbXNnLnZhbHVlOwogICAgICAgIHVpbnQyNTYgdGlsbENhcCA9IHJlbWFpbmluZ0NhcCgpOwogICAgICAgIHVpbnQyNTYgcmVmdW5kQW1vdW50ID0gMDsKICAgICAgICBpZiAobXNnLnZhbHVlID4gdGlsbENhcCkgewogICAgICAgICAgICBhbGxvd2VkQ29udHJpYnV0aW9uID0gdGlsbENhcDsKICAgICAgICAgICAgcmVmdW5kQW1vdW50ID0gbXNnLnZhbHVlLnN1YihhbGxvd2VkQ29udHJpYnV0aW9uKTsKICAgICAgICAgICAgQ29udHJpYnV0aW9uUmVmdW5kKHJlZnVuZEFtb3VudCwgbXNnLnNlbmRlcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoYWxsb3dlZENvbnRyaWJ1dGlvbiwgcmVmdW5kQW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBFdGhlciBhbW91bnQgcmVtYWluaW5nIHVudGlsIHRoZSBoYXJkLWNhcAogICAgLy8vIEByZXR1cm4gdGhlIHJlbWFpbmluZyBjYXAgaW4gV0VJCiAgICBmdW5jdGlvbiByZW1haW5pbmdDYXAoKSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gcHJlU2FsZUNhcC5zdWIocHJlU2FsZUV0aGVyUGFpZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUHVibGljIGZ1bmN0aW9uIGVuYWJsZXMgY2xvc2luZyBvZiB0aGUgcHJlLXNhbGUgbWFudWFsbHkgaWYgbmVjZXNzYXJ5CiAgICBmdW5jdGlvbiBjbG9zZVNhbGUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBjbG9zZVByZVNhbGUoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBQcml2YXRlIGZ1bmN0aW9uIHVzZWQgdG8gY2xvc2UgdGhlIHByZS1zYWxlIHdoZW4gdGhlIGhhcmQtY2FwIGlzIGhpdAogICAgZnVuY3Rpb24gY2xvc2VQcmVTYWxlKCkgcHJpdmF0ZSB7CiAgICAgICAgY2xvc2VkID0gdHJ1ZTsKICAgICAgICBTYWxlQ2xvc2VkKG5vdyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRW5zdXJlIHRoZSBjb250cmlidXRpb24gaXMgdmFsaWQKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgd2hldGhlciB0aGUgY29udHJpYnV0aW9uIGlzIHZhbGlkIG9yIG5vdAogICAgZnVuY3Rpb24gdmFsaWRDb250cmlidXRpb24oKSBwcml2YXRlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIGlzQ29udHJpYnV0aW9uVmFsaWQgPSBtc2cudmFsdWUgPj0gbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyICYmIG1zZy52YWx1ZSA8PSBtYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXI7CiAgICAgICAgVmFsaWRDb250cmlidXRpb25DaGVjayhtc2cudmFsdWUsIGlzQ29udHJpYnV0aW9uVmFsaWQpOwogICAgICAgIHJldHVybiBpc0NvbnRyaWJ1dGlvblZhbGlkOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFwcGxpZXMgdGhlIGRpc2NvdW50IGJhc2VkIG9uIHRoZSBkaXNjb3VudCB0aWVycwogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgVGhlIGFtb3VudCBvZiBldGhlciB1c2VkIHRvIGV2YWx1YXRlIHRoZSB0aWVyIHRoZSBjb250cmlidXRpb24gbGllcyB3aXRoaW4KICAgIC8vLyBAcGFyYW0gX2NvbnRyaWJ1dG9yVG9rZW5zIFRoZSB0b2tlbnMgYWxsb2NhdGVkIGJhc2VkIG9uIHRoZSBjb250cmlidXRpb24KICAgIGZ1bmN0aW9uIGFwcGx5RGlzY291bnQoCiAgICAgICAgdWludDI1NiBfZXRoZXJBbW91bnQsIAogICAgICAgIHVpbnQyNTYgX2NvbnRyaWJ1dG9yVG9rZW5zCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CgogICAgICAgIHVpbnQyNTYgZGlzY291bnQgPSAwOwoKICAgICAgICBpZiAoX2V0aGVyQW1vdW50IDw9IGZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyKSB7CiAgICAgICAgICAgIGRpc2NvdW50ID0gX2NvbnRyaWJ1dG9yVG9rZW5zLm11bChGSVJTVF9USUVSX0RJU0NPVU5UKS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgaWYgKF9ldGhlckFtb3VudCA+IGZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyICYmIF9ldGhlckFtb3VudCA8PSBzZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIpIHsKICAgICAgICAgICAgZGlzY291bnQgPSBfY29udHJpYnV0b3JUb2tlbnMubXVsKFNFQ09ORF9USUVSX0RJU0NPVU5UKS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkaXNjb3VudCA9IF9jb250cmlidXRvclRva2Vucy5tdWwoVEhJUkRfVElFUl9ESVNDT1VOVCkuZGl2KDEwMCk7CiAgICAgICAgfQoKICAgICAgICBEaXNjb3VudEFwcGxpZWQoX2V0aGVyQW1vdW50LCBfY29udHJpYnV0b3JUb2tlbnMsIGRpc2NvdW50KTsKICAgICAgICByZXR1cm4gZGlzY291bnQuYWRkKF9jb250cmlidXRvclRva2Vucyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVXBkYXRlcyB0aGUgY291bnRlcnMgZm9yIHRoZSBhbW91bnQgb2YgRXRoZXIgcGFpZAogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICBmdW5jdGlvbiB1cGRhdGVDb3VudGVycyh1aW50MjU2IF9ldGhlckFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIHByZVNhbGVFdGhlclBhaWQgPSBwcmVTYWxlRXRoZXJQYWlkLmFkZChfZXRoZXJBbW91bnQpOwogICAgICAgIHRvdGFsQ29udHJpYnV0aW9ucyA9IHRvdGFsQ29udHJpYnV0aW9ucy5hZGQoMSk7CiAgICAgICAgQ291bnRlcnNVcGRhdGVkKHByZVNhbGVFdGhlclBhaWQsIF9ldGhlckFtb3VudCk7CiAgICB9Cn0='.
	

]
