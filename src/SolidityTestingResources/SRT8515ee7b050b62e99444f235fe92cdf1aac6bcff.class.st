Class {
	#name : #SRT8515ee7b050b62e99444f235fe92cdf1aac6bcff,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT8515ee7b050b62e99444f235fe92cdf1aac6bcff >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogSG93IGFkZHJlc3NlcyBvZiBub24gRVJDMjAgY29pbnMgd2VyZSBkZWZpbmVkOgogKiBhZGRyZXNzKHdlYjMuc2hhMyhjb2luX3N5bWJvbF9pbl91cHBlcl9jYXNlKSkKICogCiAqIEV4YW1wbGUgZm9yIEJUQzoKICogd2ViMy5zaGEzKCdCVEMnKSA9IDB4ZTk4ZTI4MzBiZTFhN2U0MTU2ZDY1NmE3NTA1ZTY1ZDA4YzY3NjYwZGM2MTgwNzI0MjJlOWM3ODA1M2MyNjFlOQogKiBhZGRyZXNzKDB4ZTk4ZTI4MzBiZTFhN2U0MTU2ZDY1NmE3NTA1ZTY1ZDA4YzY3NjYwZGM2MTgwNzI0MjJlOWM3ODA1M2MyNjFlOSkgPSAweDUwNWU2NWQwOGM2NzY2MGRjNjE4MDcyNDIyZTljNzgwNTNjMjYxZTkKICovCmNvbnRyYWN0IENvaW5MaWIgewogICAgCiAgICAvLyBCaXRjb2luIGFuZCBmb3JrczoKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGJ0YyA9IGFkZHJlc3MoMHhlOThlMjgzMGJlMWE3ZTQxNTZkNjU2YTc1MDVlNjVkMDhjNjc2NjBkYzYxODA3MjQyMmU5Yzc4MDUzYzI2MWU5KTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGJjaCA9IGFkZHJlc3MoMHhjMTU3NjczNzA1ZTlhN2Q2MjUzZmIzNmM1MWUwYjJjOTE5M2I5YjU2MGZkNmQxNDViZDE5ZWNkZjZiM2E4NzNiKTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGJ0ZyA9IGFkZHJlc3MoMHg0ZTVmNDE4ZTY2N2FhMmI5MzcxMzU3MzVkM2RlYjIxOGY5MTMyODRkZDQyOWZhNTZhNjBhMmE4YzJkOTEzZjZjKTsKICAgIAogICAgLy8gRXRoZXJldW0gYW5kIGZvcmtzOgogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgZXRoID0gYWRkcmVzcygweGFhYWViZWJhMzgxMGIxZTZiNzA3ODFmMTRiMmQ3MmMxY2I4OWMwYjJiMzIwYzQzYmI2N2ZmNzlmNTYyZjVmZjQpOwogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgZXRjID0gYWRkcmVzcygweDQ5YjAxOWYzMzIwYjkyYjIyNDRjMTRkMDY0ZGU3ZTdiMDlkYmM0YzY0OWU4NjUwZTdhYTE3ZTVjZTcyNTMyOTQpOwogICAgCiAgICAvLyBCaXRjb2luIHJlbGF0aXZlczoKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGx0YyA9IGFkZHJlc3MoMHhmZGQxOGI3YWE0ZTIxMDdhNzJmMzMxMGUyNDAzYjliZDdhY2U0YTlmMDE0MzEwMDI2MDdiM2IwMTQzMGNlNzVkKTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGRvZ2UgPSBhZGRyZXNzKDB4OWEzZjUyYjFiMzFhZTU4ZGE0MDIwOWYzODM3OWU3OGMzYTA3NTY0OTVhMGY1ODVkMGIzYzg0YTllOTcxOGY5ZCk7CiAgICAKICAgIC8vIEFub25zL3ByaXZhY3kgY29pbnM6IAogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgZGFzaCA9IGFkZHJlc3MoMHgyNzljOGQxMjBkZmRiMWFjMDUxZGZjZmU5ZDM3M2VlMWQxNjYyNDE4N2ZkMmVkMDdkODgxN2I3ZjlkYTJmMDdiKTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IHhtciA9IGFkZHJlc3MoMHg4Zjc2MzFlMDNmNjQ5OWQ2MzcwZGJmZDY5YmM5YmUyYWMyYTg0ZTIwYWE3NDgxODA4NzQxM2E1YzhlMDg1Njg4KTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IHplYyA9IGFkZHJlc3MoMHg4NTExOGEwMjQ0NmE2ZWE3MzcyY2VlNzFiNWZjODQyMGEzZjkwMjc3MjgxYzg4ZjVjMjM3ZjNlZGI0NjQxOWE2KTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGJjbiA9IGFkZHJlc3MoMHgzMzM0MzNjM2QzNWI2NDkxOTI0YTI5ZmJkOTNhOTg1MmEzYzY0ZDNkNWI5MjI5YzA3M2EwNDcwNDVkNTdjYmU0KTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IHBpdnggPSBhZGRyZXNzKDB4YThiMDAzMzgxYmYxZTE0MDQ5YWI4MzE4NmRkNzllMDc0MDhiMDg4NDYxOGJjMjYwZjRlNzZjY2Q3MzA2MzhjNyk7CiAgICAKICAgIC8vIFNtYXJ0IGNvbnRyYWN0czoKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGFkYSA9IGFkZHJlc3MoMHg0ZTFlNmQ4YWExZmY4ZjQzZjkzMzcxOGUxMTMyMjliMGVjNmIwOTFiNjk5ZjdhODY3MWJjYmQ2MDZkYTM2ZWVhKTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IHhlbSA9IGFkZHJlc3MoMHg1ZjgzYTdkOGY0NjQ0NDU3MWZiYmQwZWEyZDI2MTNhYjI5NDM5MWNiMTg3MzQwMWFjNjA5MGRmNzMxZDk0OWU1KTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IG5lbyA9IGFkZHJlc3MoMHg2ZGM1NzkwZDdjNGJmYWFhMmU0ZjhlMmNkNTE3YmFjZDRhMzgzMWY4NWMwOTY0ZTU2ZjI3NDNjYmI4NDdiYzQ2KTsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IGVvcyA9IDB4ODZGYTA0OTg1N0UwMjA5YWE3RDllNjE2RjdlYjNiM0I3OEVDZmRiMDsgLy8gQWRkcmVzcyBvZiBFUkMyMCB0b2tlbi4KICAgIAogICAgYWRkcmVzc1tdIGludGVybmFsIG9sZFNjaG9vbCA9IFtidGMsIGx0YywgZXRoLCBkYXNoXTsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBidGNGb3JrcyA9IFtidGMsIGJjaCwgYnRnXTsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBzbWFydCA9IFtldGgsIGFkYSwgZW9zLCB4ZW1dOwogICAgYWRkcmVzc1tdIGludGVybmFsIGFub25zID0gW2Rhc2gsIHhtciwgemVjLCBiY25dOwogICAgCiAgICBmdW5jdGlvbiBnZXRCdGNGb3JrQ29pbnMoKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYnRjRm9ya3M7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE9sZFNjaG9vbENvaW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9sZFNjaG9vbDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0UHJpdmFjeUNvaW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIGFub25zOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRTbWFydENvaW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIHNtYXJ0OwogICAgfQp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCmNvbnRyYWN0IFN1cGVyT3duZXJzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjE7CiAgICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXIxOwogICAgCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjI7CiAgICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXIyOwoKICAgIGZ1bmN0aW9uIFN1cGVyT3duZXJzKGFkZHJlc3MgX293bmVyMSwgYWRkcmVzcyBfb3duZXIyKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfb3duZXIxICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG93bmVyMSA9IF9vd25lcjE7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfb3duZXIyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG93bmVyMiA9IF9vd25lcjI7CiAgICB9CgogICAgbW9kaWZpZXIgb25seVN1cGVyT3duZXIxKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcjEpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlTdXBlck93bmVyMigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIyKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKiogQW55IG9mIHRoZSBvd25lcnMgY2FuIGV4ZWN1dGUgdGhpcy4gKi8KICAgIG1vZGlmaWVyIG9ubHlTdXBlck93bmVyKCkgewogICAgICAgIHJlcXVpcmUoaXNTdXBlck93bmVyKG1zZy5zZW5kZXIpKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKiogSXMgbXNnLnNlbmRlciBhbnkgb2YgdGhlIG93bmVycy4gKi8KICAgIGZ1bmN0aW9uIGlzU3VwZXJPd25lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIF9hZGRyID09IG93bmVyMSB8fCBfYWRkciA9PSBvd25lcjI7CiAgICB9CgogICAgLyoqIAogICAgICogU2FmZSB0cmFuc2ZlciBvZiBvd25lcnNoaXAgaW4gMiBzdGVwcy4gT25jZSBjYWxsZWQsIGEgbmV3T3duZXIgbmVlZHMgCiAgICAgKiB0byBjYWxsIGNsYWltT3duZXJzaGlwKCkgdG8gcHJvdmUgb3duZXJzaGlwLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcDEoYWRkcmVzcyBfbmV3T3duZXIxKSBvbmx5U3VwZXJPd25lcjEgcHVibGljIHsKICAgICAgICBwZW5kaW5nT3duZXIxID0gX25ld093bmVyMTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAyKGFkZHJlc3MgX25ld093bmVyMikgb25seVN1cGVyT3duZXIyIHB1YmxpYyB7CiAgICAgICAgcGVuZGluZ093bmVyMiA9IF9uZXdPd25lcjI7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAxKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyMSk7CiAgICAgICAgb3duZXIxID0gcGVuZGluZ093bmVyMTsKICAgICAgICBwZW5kaW5nT3duZXIxID0gYWRkcmVzcygwKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyMik7CiAgICAgICAgb3duZXIyID0gcGVuZGluZ093bmVyMjsKICAgICAgICBwZW5kaW5nT3duZXIyID0gYWRkcmVzcygwKTsKICAgIH0KfQoKY29udHJhY3QgTXVsdGlPd25hYmxlIGlzIFN1cGVyT3duZXJzIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBvd25lck1hcDsKICAgIGFkZHJlc3NbXSBwdWJsaWMgb3duZXJIaXN0b3J5OwoKICAgIGV2ZW50IE93bmVyQWRkZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgX25ld093bmVyKTsKICAgIGV2ZW50IE93bmVyUmVtb3ZlZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBfb2xkT3duZXIpOwoKICAgIGZ1bmN0aW9uIE11bHRpT3duYWJsZShhZGRyZXNzIF9vd25lcjEsIGFkZHJlc3MgX293bmVyMikgCiAgICAgICAgU3VwZXJPd25lcnMoX293bmVyMSwgX293bmVyMikgaW50ZXJuYWwge30KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShpc093bmVyKG1zZy5zZW5kZXIpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzT3duZXIoYWRkcmVzcyBvd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBpc1N1cGVyT3duZXIob3duZXIpIHx8IG93bmVyTWFwW293bmVyXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3duZXJIaXN0b3J5Q291bnQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVySGlzdG9yeS5sZW5ndGg7CiAgICB9CgogICAgLy8gQWRkIGV4dHJhIG93bmVyCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIG93bmVyKSBvbmx5U3VwZXJPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZSghb3duZXJNYXBbb3duZXJdKTsKICAgICAgICBvd25lck1hcFtvd25lcl0gPSB0cnVlOwogICAgICAgIG93bmVySGlzdG9yeS5wdXNoKG93bmVyKTsKICAgICAgICBPd25lckFkZGVkRXZlbnQob3duZXIpOwogICAgfQoKICAgIC8vIFJlbW92ZSBleHRyYSBvd25lcgogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBvd25lcikgb25seVN1cGVyT3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKG93bmVyTWFwW293bmVyXSk7CiAgICAgICAgb3duZXJNYXBbb3duZXJdID0gZmFsc2U7CiAgICAgICAgT3duZXJSZW1vdmVkRXZlbnQob3duZXIpOwogICAgfQp9Cgpjb250cmFjdCBQYXVzYWJsZSBpcyBNdWx0aU93bmFibGUgewoKICAgIGJvb2wgcHVibGljIHBhdXNlZDsKCiAgICBtb2RpZmllciBpZk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlmUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBDYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgcGF1c2VkIHN0YXRlCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlTdXBlck93bmVyIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIENhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgIGZ1bmN0aW9uIHJlc3VtZSgpIGV4dGVybmFsIG9ubHlTdXBlck93bmVyIGlmUGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KfQoKY29udHJhY3QgRVJDMjAgewoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCB7CiAgICAKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKICAgICAgICAKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYWxsb3dlZCB0aGlyZCBwYXJ0eSB0byB0cmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBzZW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKICAgICAgICAKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIGZvciBnaXZlbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQp9Cgpjb250cmFjdCBDb21tb25Ub2tlbiBpcyBTdGFuZGFyZFRva2VuLCBNdWx0aU93bmFibGUgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICd2MC4xJzsKCiAgICBhZGRyZXNzIHB1YmxpYyBzZWxsZXI7ICAgICAvLyBUaGUgbWFpbiBhY2NvdW50IHRoYXQgaG9sZHMgYWxsIHRva2VucyBhdCB0aGUgYmVnaW5uaW5nIGFuZCBkdXJpbmcgdG9rZW5zYWxlLgoKICAgIHVpbnQyNTYgcHVibGljIHNhbGVMaW1pdDsgIC8vIChlMTgpIEhvdyBtYW55IHRva2VucyBjYW4gYmUgc29sZCBpbiB0b3RhbCB0aHJvdWdoIGFsbCB0aWVycyBvciB0b2tlbnNhbGVzLgogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZDsgLy8gKGUxOCkgTnVtYmVyIG9mIHRva2VucyBzb2xkIHRocm91Z2ggYWxsIHRpZXJzIG9yIHRva2Vuc2FsZXMuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFNhbGVzOyAvLyBUb3RhbCBudW1iZXIgb2Ygc2FsZXMgKGluY2x1ZGluZyBleHRlcm5hbCBzYWxlcykgbWFkZSB0aHJvdWdoIGFsbCB0aWVycyBvciB0b2tlbnNhbGVzLgoKICAgIC8vIExvY2sgdGhlIHRyYW5zZmVyIGZ1bmN0aW9ucyBkdXJpbmcgdG9rZW5zYWxlcyB0byBwcmV2ZW50IHByaWNlIHNwZWN1bGF0aW9ucy4KICAgIGJvb2wgcHVibGljIGxvY2tlZCA9IHRydWU7CiAgICAKICAgIGV2ZW50IFNlbGxFdmVudChhZGRyZXNzIGluZGV4ZWQgX3NlbGxlciwgYWRkcmVzcyBpbmRleGVkIF9idXllciwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQ2hhbmdlU2VsbGVyRXZlbnQoYWRkcmVzcyBpbmRleGVkIF9vbGRTZWxsZXIsIGFkZHJlc3MgaW5kZXhlZCBfbmV3U2VsbGVyKTsKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIF9idXJuZXIsIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IFVubG9jaygpOwoKICAgIGZ1bmN0aW9uIENvbW1vblRva2VuKAogICAgICAgIGFkZHJlc3MgX293bmVyMSwKICAgICAgICBhZGRyZXNzIF9vd25lcjIsCiAgICAgICAgYWRkcmVzcyBfc2VsbGVyLAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseU5vRGVjaW1hbHMsCiAgICAgICAgdWludDI1NiBfc2FsZUxpbWl0Tm9EZWNpbWFscwogICAgKSBNdWx0aU93bmFibGUoX293bmVyMSwgX293bmVyMikgcHVibGljIHsKCiAgICAgICAgcmVxdWlyZShfc2VsbGVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RvdGFsU3VwcGx5Tm9EZWNpbWFscyA+IDApOwogICAgICAgIHJlcXVpcmUoX3NhbGVMaW1pdE5vRGVjaW1hbHMgPiAwKTsKCiAgICAgICAgc2VsbGVyID0gX3NlbGxlcjsKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICB0b3RhbFN1cHBseSA9IF90b3RhbFN1cHBseU5vRGVjaW1hbHMgKiAxZTE4OwogICAgICAgIHNhbGVMaW1pdCA9IF9zYWxlTGltaXROb0RlY2ltYWxzICogMWUxODsKICAgICAgICBiYWxhbmNlc1tzZWxsZXJdID0gdG90YWxTdXBwbHk7CgogICAgICAgIFRyYW5zZmVyKDB4MCwgc2VsbGVyLCB0b3RhbFN1cHBseSk7CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlmVW5sb2NrZWQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHsKICAgICAgICByZXF1aXJlKCFsb2NrZWQgfHwgaXNPd25lcihfZnJvbSkgfHwgaXNPd25lcihfdG8pKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKiogQ2FuIGJlIGNhbGxlZCBvbmNlIGJ5IHN1cGVyIG93bmVyLiAqLwogICAgZnVuY3Rpb24gdW5sb2NrKCkgb25seVN1cGVyT3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKGxvY2tlZCk7CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICAgICAgVW5sb2NrKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlU2VsbGVyKGFkZHJlc3MgbmV3U2VsbGVyKSBvbmx5U3VwZXJPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobmV3U2VsbGVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoc2VsbGVyICE9IG5ld1NlbGxlcik7CgogICAgICAgIGFkZHJlc3Mgb2xkU2VsbGVyID0gc2VsbGVyOwogICAgICAgIHVpbnQyNTYgdW5zb2xkVG9rZW5zID0gYmFsYW5jZXNbb2xkU2VsbGVyXTsKICAgICAgICBiYWxhbmNlc1tvbGRTZWxsZXJdID0gMDsKICAgICAgICBiYWxhbmNlc1tuZXdTZWxsZXJdID0gYmFsYW5jZXNbbmV3U2VsbGVyXS5hZGQodW5zb2xkVG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcihvbGRTZWxsZXIsIG5ld1NlbGxlciwgdW5zb2xkVG9rZW5zKTsKCiAgICAgICAgc2VsbGVyID0gbmV3U2VsbGVyOwogICAgICAgIENoYW5nZVNlbGxlckV2ZW50KG9sZFNlbGxlciwgbmV3U2VsbGVyKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsTm9EZWNpbWFscyhhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGwoX3RvLCBfdmFsdWUgKiAxZTE4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CgogICAgICAgIC8vIENoZWNrIHRoYXQgd2UgYXJlIG5vdCBvdXQgb2YgbGltaXQgYW5kIHN0aWxsIGNhbiBzZWxsIHRva2VuczoKICAgICAgICByZXF1aXJlKHRva2Vuc1NvbGQuYWRkKF92YWx1ZSkgPD0gc2FsZUxpbWl0KTsKCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tzZWxsZXJdKTsKCiAgICAgICAgYmFsYW5jZXNbc2VsbGVyXSA9IGJhbGFuY2VzW3NlbGxlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoc2VsbGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHRvdGFsU2FsZXMrKzsKICAgICAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQoX3ZhbHVlKTsKICAgICAgICBTZWxsRXZlbnQoc2VsbGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFVudGlsIGFsbCB0b2tlbnMgYXJlIHNvbGQsIHRva2VucyBjYW4gYmUgdHJhbnNmZXJlZCB0by9mcm9tIG93bmVyJ3MgYWNjb3VudHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaWZVbmxvY2tlZChtc2cuc2VuZGVyLCBfdG8pIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVudGlsIGFsbCB0b2tlbnMgYXJlIHNvbGQsIHRva2VucyBjYW4gYmUgdHJhbnNmZXJlZCB0by9mcm9tIG93bmVyJ3MgYWNjb3VudHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlmVW5sb2NrZWQoX2Zyb20sIF90bykgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKSA7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCAweDAsIF92YWx1ZSk7CiAgICAgICAgQnVybihtc2cuc2VuZGVyLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKY29udHJhY3QgUmFjZVRva2VuIGlzIENvbW1vblRva2VuIHsKICAgIAogICAgZnVuY3Rpb24gUmFjZVRva2VuKCkgQ29tbW9uVG9rZW4oCiAgICAgICAgMHgyMjlCOUVmODBEMjVBN2U3NjQ4YjE3ZTJjNTk4ODA1ZDA0MmY5ZTU2LCAvLyBfX09XTkVSMV9fCiAgICAgICAgMHhjZDdjRjFENjEzRDU5NzQ4NzZBZkJmZDYxMkVENkFGZDk0MDkzY2U3LCAvLyBfX09XTkVSMl9fCiAgICAgICAgMHgyODIxZTE0ODZENjA0NTY2ODQyRkYyN0Y2MjZhRjEzM0ZkZEQ1Zjg5LCAvLyBfX1NFTExFUl9fCiAgICAgICAgJ0NvaW4gUmFjZScsCiAgICAgICAgJ1JBQ0UnLAogICAgICAgIDEwMCAqIDFlNiwgLy8gMTAwbSB0b2tlbnMgaW4gdG90YWwuCiAgICAgICAgNzAgKiAxZTYgICAvLyA3MG0gdG9rZW5zIGZvciBzYWxlLgogICAgKSBwdWJsaWMge30KfQoKbGlicmFyeSBSYWNlQ2FsYyB7CiAgICAKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogICAgCiAgICAvLyBDYWxjIGEgc3Rha2Ugb2YgYSBkcml2ZXIgYmFzZWQgb24gaGlzIGN1cnJlbnQgdGltZS4KICAgIC8vIFdlIHVzZSBsaW5lYXIgcmVncmVzc2lvbiwgc28gdGhlIG1vcmUgdGltZSBwYXNzZWQgc2luY2UgCiAgICAvLyB0aGUgc3RhcnQgb2YgdGhlIHJhY2UsIHRoZSBsZXNzIHN0YWtlIG9mIGEgZmluYWwgcmV3YXJkIGhlIHdpbGwgcmVjZWl2ZS4KICAgIGZ1bmN0aW9uIGNhbGNTdGFrZSgKICAgICAgICB1aW50IF9jdXJyZW50VGltZSwgLy8gRXhhbXBsZTogMTUxMzUzMzYwMCAtIDIwMTctMTItMTcgMTg6MDA6MDAgVVRDCiAgICAgICAgdWludCBfZmluaXNoVGltZSAgIC8vIEV4YW1wbGU6IDE1MTM1MzcyMDAgLSAyMDE3LTEyLTE3IDE5OjAwOjAwIFVUQwogICAgKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfY3VycmVudFRpbWUgPiAwKTsKICAgICAgICByZXF1aXJlKF9jdXJyZW50VGltZSA8IF9maW5pc2hUaW1lKTsKICAgICAgICAKICAgICAgICByZXR1cm4gX2ZpbmlzaFRpbWUuc3ViKF9jdXJyZW50VGltZSk7CiAgICB9CiAgICAKICAgIC8vIENhbGMgZ2FpbiBvZiBjYXIgYXQgdGhlIGZpbmlzaCBvZiBhIHJhY2UuCiAgICAvLyBSZXN1bHQgY2FuIGJlIG5lZ2F0aXZlLgogICAgLy8gMTAwJSBpcyByZXByZXNlbnRlZCBhcyAxMF44IHRvIGJlIG1vcmUgcHJlY2lvdXMuCiAgICBmdW5jdGlvbiBjYWxjR2FpbkU4KAogICAgICAgIHVpbnQgX3N0YXJ0UmF0ZVRvVXNkRTgsIC8vIEV4YW1wbGU6IDM0NQogICAgICAgIHVpbnQgX2ZpbmlzaFJhdGVUb1VzZEU4IC8vIEV4YW1wbGU6IDQ1NgogICAgKSBwdWJsaWMgcHVyZSByZXR1cm5zIChpbnQpIHsKICAgICAgICAKICAgICAgICByZXF1aXJlKF9zdGFydFJhdGVUb1VzZEU4ID4gMCk7CiAgICAgICAgcmVxdWlyZShfZmluaXNoUmF0ZVRvVXNkRTggPiAwKTsKICAgICAgICAKICAgICAgICBpbnQgZGlmZiA9IGludChfZmluaXNoUmF0ZVRvVXNkRTgpIC0gaW50KF9zdGFydFJhdGVUb1VzZEU4KTsKICAgICAgICByZXR1cm4gKGRpZmYgKiAxZTgpIC8gaW50KF9zdGFydFJhdGVUb1VzZEU4KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2FsY1ByaXplVG9rZW5zRTE4KAogICAgICAgIHVpbnQgdG90YWxUb2tlbnMsIAogICAgICAgIHVpbnQgd2lubmluZ1N0YWtlLCAKICAgICAgICB1aW50IGRyaXZlclN0YWtlCiAgICApIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAKICAgICAgICBpZiAodG90YWxUb2tlbnMgPT0gMCkgcmV0dXJuIDA7CiAgICAgICAgaWYgKHdpbm5pbmdTdGFrZSA9PSAwKSByZXR1cm4gMDsKICAgICAgICBpZiAoZHJpdmVyU3Rha2UgPT0gMCkgcmV0dXJuIDA7CiAgICAgICAgaWYgKHdpbm5pbmdTdGFrZSA9PSBkcml2ZXJTdGFrZSkgcmV0dXJuIHRvdGFsVG9rZW5zOwogICAgICAgIAogICAgICAgIHJlcXVpcmUod2lubmluZ1N0YWtlID4gZHJpdmVyU3Rha2UpOwogICAgICAgIHVpbnQgc2hhcmUgPSBkcml2ZXJTdGFrZS5tdWwoMWU4KS5kaXYod2lubmluZ1N0YWtlKTsKICAgICAgICByZXR1cm4gdG90YWxUb2tlbnMubXVsKHNoYXJlKS5kaXYoMWU4KTsKICAgIH0KfQoKLyoqIAogKiBIZXJlIHdlIGltcGxlbWVudCBhbGwgdG9rZW4gbWV0aG9kcyB0aGF0IHJlcXVpcmUgbXNnLnNlbmRlciB0byBiZSBhbGJlIAogKiB0byBwZXJmb3JtIG9wZXJhdGlvbnMgb24gYmVoYWxmIG9mIEdhbWVXYWxsZXQgZnJvbSBvdGhlciBDb2luUmFjZSBjb250cmFjdHMgCiAqIGxpa2UgYSBwYXJ0aWN1bGFyIGNvbnRyYWN0IG9mIFJhY2VHYW1lLgogKi8KY29udHJhY3QgQ29tbW9uV2FsbGV0IGlzIE11bHRpT3duYWJsZSB7CiAgICAKICAgIFJhY2VUb2tlbiBwdWJsaWMgdG9rZW47CiAgICAKICAgIGV2ZW50IENoYW5nZVRva2VuRXZlbnQoYWRkcmVzcyBpbmRleGVkIF9vbGRBZGRyZXNzLCBhZGRyZXNzIGluZGV4ZWQgX25ld0FkZHJlc3MpOwogICAgCiAgICBmdW5jdGlvbiBDb21tb25XYWxsZXQoYWRkcmVzcyBfb3duZXIxLCBhZGRyZXNzIF9vd25lcjIpIAogICAgICAgIE11bHRpT3duYWJsZShfb3duZXIxLCBfb3duZXIyKSBwdWJsaWMge30KICAgIAogICAgZnVuY3Rpb24gc2V0VG9rZW4oYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5U3VwZXJPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcyh0b2tlbikpOwogICAgICAgIAogICAgICAgIENoYW5nZVRva2VuRXZlbnQodG9rZW4sIF90b2tlbik7CiAgICAgICAgdG9rZW4gPSBSYWNlVG9rZW4oX3Rva2VuKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW4udHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0b2tlbi5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX3ZhbHVlKSBvbmx5U3VwZXJPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0b2tlbi5idXJuKF92YWx1ZSk7CiAgICB9CiAgICAKICAgIC8qKiBBbW91bnQgb2YgdG9rZW5zIHRoYXQgcGxheWVycyBvZiBDb2luUmFjZSBiZXQgZHVyaW5nIHRoZSBnYW1lcyBhbmQgaGF2ZW4ndCBjbGFpbWVkIHlldC4gKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2VuLmJhbGFuY2VPZihfb3duZXIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG9rZW4uYWxsb3dhbmNlKF9vd25lciwgX3NwZW5kZXIpOwogICAgfQp9Cgpjb250cmFjdCBHYW1lV2FsbGV0IGlzIENvbW1vbldhbGxldCB7CiAgICAKICAgIGZ1bmN0aW9uIEdhbWVXYWxsZXQoKSBDb21tb25XYWxsZXQoCiAgICAgICAgMHgyMjlCOUVmODBEMjVBN2U3NjQ4YjE3ZTJjNTk4ODA1ZDA0MmY5ZTU2LCAvLyBfX09XTkVSMV9fCiAgICAgICAgMHhjZDdjRjFENjEzRDU5NzQ4NzZBZkJmZDYxMkVENkFGZDk0MDkzY2U3ICAvLyBfX09XTkVSMl9fCiAgICApIHB1YmxpYyB7fQp9CgpsaWJyYXJ5IFJhY2VMaWIgewogICAgCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKICAgIAogICAgZnVuY3Rpb24gbWFrZUJldCgKICAgICAgICBSYWNlIHN0b3JhZ2UgX3JhY2UsIAogICAgICAgIGFkZHJlc3MgX2RyaXZlciwgCiAgICAgICAgYWRkcmVzcyBfY2FyLCAKICAgICAgICB1aW50IF90b2tlbnNFMTgKICAgICkgcHVibGljIHsKICAgICAgICByZXF1aXJlKCFpc0ZpbmlzaGVkKF9yYWNlKSk7CiAgICAgICAgCiAgICAgICAgdmFyIGJldCA9IEJldCh7CiAgICAgICAgICAgIGRyaXZlcjogX2RyaXZlciwKICAgICAgICAgICAgY2FyOiBfY2FyLAogICAgICAgICAgICB0b2tlbnM6IF90b2tlbnNFMTgsCiAgICAgICAgICAgIHRpbWU6IG5vdwogICAgICAgIH0pOwoKICAgICAgICBfcmFjZS5iZXRzQnlEcml2ZXJbX2RyaXZlcl0ucHVzaChiZXQpOwogICAgICAgIF9yYWNlLmJldHNCeUNhcltfY2FyXS5wdXNoKGJldCk7CiAgICAgICAgICAgIAogICAgICAgIGlmIChfcmFjZS50b2tlbnNCeUNhckFuZERyaXZlcltfY2FyXVtfZHJpdmVyXSA9PSAwKSB7CiAgICAgICAgICAgIF9yYWNlLmRyaXZlckNvdW50QnlDYXJbX2Nhcl0gPSBfcmFjZS5kcml2ZXJDb3VudEJ5Q2FyW19jYXJdICsgMTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX3JhY2UudG9rZW5zQnlDYXJbX2Nhcl0gPSBfcmFjZS50b2tlbnNCeUNhcltfY2FyXS5hZGQoX3Rva2Vuc0UxOCk7CiAgICAgICAgX3JhY2UudG9rZW5zQnlDYXJBbmREcml2ZXJbX2Nhcl1bX2RyaXZlcl0gPSAKICAgICAgICAgICAgX3JhY2UudG9rZW5zQnlDYXJBbmREcml2ZXJbX2Nhcl1bX2RyaXZlcl0uYWRkKF90b2tlbnNFMTgpOwogICAgICAgIAogICAgICAgIHVpbnQgc3Rha2VUaW1lID0gYmV0LnRpbWU7CiAgICAgICAgaWYgKGJldC50aW1lIDwgX3JhY2UubGVmdEdyYWNlVGltZSAmJiBfcmFjZS5sZWZ0R3JhY2VUaW1lID4gMCkgc3Rha2VUaW1lID0gX3JhY2UubGVmdEdyYWNlVGltZTsKICAgICAgICBpZiAoYmV0LnRpbWUgPiBfcmFjZS5yaWdodEdyYWNlVGltZSAmJiBfcmFjZS5yaWdodEdyYWNlVGltZSA+IDApIHN0YWtlVGltZSA9IF9yYWNlLnJpZ2h0R3JhY2VUaW1lOwogICAgICAgIHVpbnQgc3Rha2UgPSBSYWNlQ2FsYy5jYWxjU3Rha2Uoc3Rha2VUaW1lLCBfcmFjZS5maW5pc2hUaW1lKTsKICAgICAgICBfcmFjZS5zdGFrZUJ5Q2FyW19jYXJdID0gX3JhY2Uuc3Rha2VCeUNhcltfY2FyXS5hZGQoc3Rha2UpOwogICAgICAgIF9yYWNlLnN0YWtlQnlDYXJBbmREcml2ZXJbX2Nhcl1bX2RyaXZlcl0gPSAKICAgICAgICAgICAgX3JhY2Uuc3Rha2VCeUNhckFuZERyaXZlcltfY2FyXVtfZHJpdmVyXS5hZGQoc3Rha2UpOwogICAgICAgIAogICAgICAgIF9yYWNlLnRvdGFsVG9rZW5zID0gX3JhY2UudG90YWxUb2tlbnMuYWRkKF90b2tlbnNFMTgpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBoYXNEcml2ZXJKb2luZWQoCiAgICAgICAgUmFjZSBzdG9yYWdlIF9yYWNlLCAKICAgICAgICBhZGRyZXNzIF9kcml2ZXIKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBiZXRDb3VudEJ5RHJpdmVyKF9yYWNlLCBfZHJpdmVyKSA+IDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJldENvdW50QnlEcml2ZXIoCiAgICAgICAgUmFjZSBzdG9yYWdlIF9yYWNlLCAKICAgICAgICBhZGRyZXNzIF9kcml2ZXIKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfcmFjZS5iZXRzQnlEcml2ZXJbX2RyaXZlcl0ubGVuZ3RoOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBiZXRDb3VudEJ5Q2FyKAogICAgICAgIFJhY2Ugc3RvcmFnZSBfcmFjZSwgCiAgICAgICAgYWRkcmVzcyBfY2FyCiAgICApIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX3JhY2UuYmV0c0J5Q2FyW19jYXJdLmxlbmd0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RhcnRDYXIoCiAgICAgICAgUmFjZSBzdG9yYWdlIF9yYWNlLCAKICAgICAgICBhZGRyZXNzIF9jYXIsCiAgICAgICAgdWludCBfcmF0ZVRvVXNkRTgKICAgICkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9yYXRlVG9Vc2RFOCA+IDApOwogICAgICAgIHJlcXVpcmUoX3JhY2UuY2FyUmF0ZXNbX2Nhcl0uc3RhcnRSYXRlVG9Vc2RFOCA9PSAwKTsKICAgICAgICBfcmFjZS5jYXJSYXRlc1tfY2FyXS5zdGFydFJhdGVUb1VzZEU4ID0gX3JhdGVUb1VzZEU4OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBmaW5pc2goCiAgICAgICAgUmFjZSBzdG9yYWdlIF9yYWNlCiAgICApIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSghX3JhY2UuZmluaXNoZWQpOwogICAgICAgIHJlcXVpcmUobm93ID49IF9yYWNlLmZpbmlzaFRpbWUpOwogICAgICAgIF9yYWNlLmZpbmlzaGVkID0gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNGaW5pc2hlZCgKICAgICAgICBSYWNlIHN0b3JhZ2UgX3JhY2UKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBfcmFjZS5maW5pc2hlZDsKICAgIH0KICAgIAogICAgc3RydWN0IFJhY2UgewogICAgICAgIAogICAgICAgIHVpbnQgaWQ7CiAgICAgICAgCiAgICAgICAgdWludCBsZWZ0R3JhY2VUaW1lOwogICAgICAgIAogICAgICAgIHVpbnQgcmlnaHRHcmFjZVRpbWU7CiAgICAgICAgCiAgICAgICAgdWludCBzdGFydFRpbWU7CiAgICAgICAgCiAgICAgICAgdWludCBmaW5pc2hUaW1lOwogICAgICAgIAogICAgICAgIGJvb2wgZmluaXNoZWQ7CiAgICAgICAgCiAgICAgICAgdWludCBmaW5pc2hlZENhckNvdW50OwogICAgICAgIAogICAgICAgIC8vIDAgLSBpZiByYWNlIGlzIG5vdCBmaW5pc2hlZCB5ZXQuCiAgICAgICAgYWRkcmVzcyBmaXJzdENhcjsKICAgICAgICAKICAgICAgICAvLyBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIHRoYSB0aGF2ZSBiZWVuIGJldCBvbiBhbGwgY2FycyBkdXJpbmcgdGhlIHJhY2U6IAogICAgICAgIHVpbnQgdG90YWxUb2tlbnM7CiAgICAgICAgCiAgICAgICAgdWludCBkcml2ZXJDb3VudDsKICAgICAgICAKICAgICAgICAvLyBudW0gb2YgZHJpdmVyID0+IGRyaXZlcidzIGFkZHJlc3MuCiAgICAgICAgbWFwcGluZyAodWludCA9PiBhZGRyZXNzKSBkcml2ZXJzOwogICAgICAgIAogICAgICAgIC8vIGNhcl9hZGRyZXNzID0+IHRvdGFsX2RyaXZlcnNfdGhhdF9tYWRlX2JldF9vbl90aGlzX2NhcgogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgZHJpdmVyQ291bnRCeUNhcjsKICAgICAgICAKICAgICAgICAvLyBkcml2ZXJfYWRkcmVzcyA9PiBiZXRzIGJ5IGRyaXZlcgogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQmV0W10pIGJldHNCeURyaXZlcjsKICAgICAgICAKICAgICAgICAvLyBjYXJfYWRkcmVzcyA9PiBiZXRzIG9uIHRoaXMgY2FyLgogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQmV0W10pIGJldHNCeUNhcjsKICAgICAgICAKICAgICAgICAvLyBjYXJfYWRkcmVzcyA9PiB0b3RhbF90b2tlbnNfYmV0X29uX3RoaXNfY2FyCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSB0b2tlbnNCeUNhcjsKICAgICAgICAKICAgICAgICAvLyBjYXJfYWRkcmVzcyA9PiBkcml2ZXJfYWRkcmVzcyA9PiB0b3RhbF90b2tlbnNfYmV0X29uX3RoaXNfY2FyX2J5X3RoaXNfZHJpdmVyCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSB0b2tlbnNCeUNhckFuZERyaXZlcjsKCiAgICAgICAgLy8gY2FyX2FkZHJlc3MgPT4gc3Rha2VfYnlfYWxsX2RyaXZlcnMKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHN0YWtlQnlDYXI7CgogICAgICAgIC8vIGNhcl9hZGRyZXNzID0+IGRyaXZlcl9hZGRyZXNzID0+IHN0YWtlCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBzdGFrZUJ5Q2FyQW5kRHJpdmVyOwoKICAgICAgICAvLyBjYXJfYWRkcmVzcyA9PiBpdHMgcmF0ZXMgdG8gVVNELgogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2FyUmF0ZXMpIGNhclJhdGVzOwoKICAgICAgICAvLyBpbnQgYmVjYXVzZSBpdCBjYW4gYmUgbmVnYXRpdmUgdmFsdWUgaWYgZmluaXNoIHJhdGUgaXMgbG93ZXIuCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBpbnQpIGdhaW5CeUNhcjsKICAgICAgICAKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGlzRmluaXNoZWRDYXI7CiAgICAgICAgCiAgICAgICAgLy8gZHJpdmVyX2FkZHJlc3MgPT4gYW1vdW50IG9mIHRva2VucyAoZTE4KSB0aGF0IGhhdmUgYmVlbiBjbGFpbWVkIGJ5IGRyaXZlci4KICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHRva2Vuc0NsYWltZWRCeURyaXZlcjsKICAgIH0KICAgIAogICAgc3RydWN0IEJldCB7CiAgICAgICAgYWRkcmVzcyBkcml2ZXI7CiAgICAgICAgYWRkcmVzcyBjYXI7CiAgICAgICAgdWludCB0b2tlbnM7CiAgICAgICAgdWludCB0aW1lOwogICAgfQogICAgCiAgICBzdHJ1Y3QgQ2FyUmF0ZXMgewogICAgICAgIHVpbnQgc3RhcnRSYXRlVG9Vc2RFODsKICAgICAgICB1aW50IGZpbmlzaFJhdGVUb1VzZEU4OwogICAgfQp9Cgpjb250cmFjdCBDb21tb25SYWNlIGlzIE11bHRpT3duYWJsZSB7CiAgICAKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogICAgdXNpbmcgUmFjZUxpYiBmb3IgUmFjZUxpYi5SYWNlOwogICAgCiAgICBHYW1lV2FsbGV0IHB1YmxpYyB3YWxsZXQ7CiAgICAKICAgIC8vIFRoZSBuYW1lIG9mIHRoZSBnYW1lLgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgCiAgICBhZGRyZXNzW10gcHVibGljIGNhcnM7CiAgICAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzS25vd25DYXI7CiAgICAKICAgIFJhY2VMaWIuUmFjZVtdIHB1YmxpYyByYWNlczsKICAgIAogICAgYWRkcmVzc1tdIHB1YmxpYyBkcml2ZXJzOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzS25vd25Ecml2ZXI7CiAgICAKICAgIG1vZGlmaWVyIGlmV2FsbGV0RGVmaW5lZCgpIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3Mod2FsbGV0KSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBDb21tb25SYWNlKAogICAgICAgIGFkZHJlc3MgX293bmVyMSwKICAgICAgICBhZGRyZXNzIF9vd25lcjIsCiAgICAgICAgYWRkcmVzc1tdIF9jYXJzLAogICAgICAgIHN0cmluZyBfbmFtZQogICAgKSBNdWx0aU93bmFibGUoX293bmVyMSwgX293bmVyMikgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9jYXJzLmxlbmd0aCA+IDApOwoKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgY2FycyA9IF9jYXJzOwogICAgICAgIAogICAgICAgIGZvciAodWludDE2IGkgPSAwOyBpIDwgX2NhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaXNLbm93bkNhcltfY2Fyc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0Tm93KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJhY2VDb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcmFjZXMubGVuZ3RoOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjYXJDb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2Fycy5sZW5ndGg7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRyaXZlckNvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBkcml2ZXJzLmxlbmd0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0V2FsbGV0KGFkZHJlc3MgX25ld1dhbGxldCkgb25seVN1cGVyT3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldCAhPSBfbmV3V2FsbGV0KTsKICAgICAgICByZXF1aXJlKF9uZXdXYWxsZXQgIT0gMCk7CiAgICAgICAgCiAgICAgICAgR2FtZVdhbGxldCBuZXdXYWxsZXQgPSBHYW1lV2FsbGV0KF9uZXdXYWxsZXQpOwogICAgICAgIHdhbGxldCA9IG5ld1dhbGxldDsKICAgIH0KCiAgICBmdW5jdGlvbiBsYXN0TGFwSWQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShyYWNlcy5sZW5ndGggPiAwKTsKICAgICAgICByZXR1cm4gcmFjZXMubGVuZ3RoIC0gMTsKICAgIH0KCiAgICBmdW5jdGlvbiBuZXh0TGFwSWQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJhY2VzLmxlbmd0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0UmFjZSh1aW50IF9sYXBJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChSYWNlTGliLlJhY2Ugc3RvcmFnZSByYWNlKSB7CiAgICAgICAgcmFjZSA9IHJhY2VzW19sYXBJZF07CiAgICAgICAgcmVxdWlyZShyYWNlLnN0YXJ0VGltZSA+IDApOyAvLyBpZiBzdGFydFRpbWUgaXMgPiAwIHRoZW4gcmFjZSBpcyByZWFsLgogICAgfQogICAgCiAgICAvKioKICAgICAqIF9kdXJhdGlvblNlY3MgLSBBIGR1cmF0aW9uIG9mIHJhY2UgaW4gc2Vjb25kcy4KICAgICAqIAogICAgICogU3RydWN0dXJlIG9mIF9jYXJzQW5kUmF0ZXM6CiAgICAgKiAgIE4tdGggZWxlbSBpcyBhIGNhciBhZGRyLgogICAgICogICAoTisxKS10aCBlbGVtIGlzIGNhciByYXRlLgogICAgICovCiAgICBmdW5jdGlvbiBzdGFydE5ld1JhY2UoCiAgICAgICAgdWludCBfbmV3TGFwSWQsIAogICAgICAgIHVpbnRbXSBfY2Fyc0FuZFJhdGVzLAogICAgICAgIHVpbnQgX2R1cmF0aW9uU2VjcywKICAgICAgICB1aW50IF9sZWZ0R3JhY2VTZWNzLCAvLyBIb3cgbWFueSBzZWNvbmRzIGZyb20gdGhlIHN0YXJ0IHdlIHNob3VsZCBub3QgYXBwbHkgcGVuYWx0eSBmb3Igc3Rha2Ugb2YgYmV0PwogICAgICAgIHVpbnQgX3JpZ2h0R3JhY2VTZWNzIC8vIEhvdyBtYW55IHNlY29uZHMgYmVmb3JlIHRoZSBmaW5pc2ggd2Ugc2hvdWxkIG5vdCBhcHBseSBwZW5hbHR5IGZvciBzdGFrZSBvZiBiZXQ/CiAgICApIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX25ld0xhcElkID09IG5leHRMYXBJZCgpKTsKICAgICAgICByZXF1aXJlKF9jYXJzQW5kUmF0ZXMubGVuZ3RoID09IChjYXJzLmxlbmd0aCAqIDIpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvblNlY3MgPiAwKTsKICAgICAgICAKICAgICAgICBpZiAoX2xlZnRHcmFjZVNlY3MgPiAwKSByZXF1aXJlKF9sZWZ0R3JhY2VTZWNzIDw9IF9kdXJhdGlvblNlY3MpOwogICAgICAgIGlmIChfcmlnaHRHcmFjZVNlY3MgPiAwKSByZXF1aXJlKF9yaWdodEdyYWNlU2VjcyA8PSBfZHVyYXRpb25TZWNzKTsKICAgICAgICAKICAgICAgICB1aW50IGZpbmlzaFRpbWUgPSBub3cuYWRkKF9kdXJhdGlvblNlY3MpOwogICAgICAgIAogICAgICAgIHJhY2VzLnB1c2goUmFjZUxpYi5SYWNlKHsKICAgICAgICAgICAgaWQ6IF9uZXdMYXBJZCwKICAgICAgICAgICAgbGVmdEdyYWNlVGltZTogbm93ICsgX2xlZnRHcmFjZVNlY3MsCiAgICAgICAgICAgIHJpZ2h0R3JhY2VUaW1lOiBmaW5pc2hUaW1lIC0gX3JpZ2h0R3JhY2VTZWNzLAogICAgICAgICAgICBzdGFydFRpbWU6IG5vdywKICAgICAgICAgICAgZmluaXNoVGltZTogZmluaXNoVGltZSwKICAgICAgICAgICAgZmluaXNoZWQ6IGZhbHNlLAogICAgICAgICAgICBmaW5pc2hlZENhckNvdW50OiAwLAogICAgICAgICAgICBmaXJzdENhcjogMCwKICAgICAgICAgICAgdG90YWxUb2tlbnM6IDAsCiAgICAgICAgICAgIGRyaXZlckNvdW50OiAwCiAgICAgICAgfSkpOwogICAgICAgIFJhY2VMaWIuUmFjZSBzdG9yYWdlIHJhY2UgPSByYWNlc1tfbmV3TGFwSWRdOwoKICAgICAgICB1aW50OCBqID0gMDsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgX2NhcnNBbmRSYXRlcy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBhZGRyZXNzIGNhciA9IGFkZHJlc3MoX2NhcnNBbmRSYXRlc1tqKytdKTsKICAgICAgICAgICAgdWludCBzdGFydFJhdGVUb1VzZEU4ID0gX2NhcnNBbmRSYXRlc1tqKytdOwogICAgICAgICAgICByZXF1aXJlKGlzS25vd25DYXJbY2FyXSk7CiAgICAgICAgICAgIHJhY2Uuc3RhcnRDYXIoY2FyLCBzdGFydFJhdGVUb1VzZEU4KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJ1Y3R1cmUgb2YgX2NhcnNBbmRSYXRlczoKICAgICAqICAgTi10aCBlbGVtIGlzIGEgY2FyIGFkZHIuCiAgICAgKiAgIChOKzEpLXRoIGVsZW0gaXMgY2FyIHJhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaFJhY2UoCiAgICAgICAgdWludCBfbGFwSWQsIAogICAgICAgIHVpbnRbXSBfY2Fyc0FuZFJhdGVzCiAgICApIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2NhcnNBbmRSYXRlcy5sZW5ndGggPT0gKGNhcnMubGVuZ3RoICogMikpOwogICAgICAgIAogICAgICAgIFJhY2VMaWIuUmFjZSBzdG9yYWdlIHJhY2UgPSBnZXRSYWNlKF9sYXBJZCk7CiAgICAgICAgcmFjZS5maW5pc2goKTsKICAgICAgICAKICAgICAgICBpbnQgbWF4R2FpbiA9IDA7CiAgICAgICAgYWRkcmVzcyBmaXJzdENhcjsgLy8gVGhlIGZpcnN0IGZpbmlzaGVkIGNhci4KICAgICAgICAKICAgICAgICB1aW50OCBqID0gMDsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgX2NhcnNBbmRSYXRlcy5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBhZGRyZXNzIGNhciA9IGFkZHJlc3MoX2NhcnNBbmRSYXRlc1tqKytdKTsKICAgICAgICAgICAgdWludCBmaW5pc2hSYXRlVG9Vc2RFOCA9IF9jYXJzQW5kUmF0ZXNbaisrXTsKICAgICAgICAgICAgcmVxdWlyZSghaXNDYXJGaW5pc2hlZChfbGFwSWQsIGNhcikpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTWFyayBjYXIgYXMgZmluaXNoZWQ6CiAgICAgICAgICAgIFJhY2VMaWIuQ2FyUmF0ZXMgc3RvcmFnZSByYXRlcyA9IHJhY2UuY2FyUmF0ZXNbY2FyXTsKICAgICAgICAgICAgcmF0ZXMuZmluaXNoUmF0ZVRvVXNkRTggPSBmaW5pc2hSYXRlVG9Vc2RFODsKICAgICAgICAgICAgcmFjZS5pc0ZpbmlzaGVkQ2FyW2Nhcl0gPSB0cnVlOwogICAgICAgICAgICByYWNlLmZpbmlzaGVkQ2FyQ291bnQrKzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGMgZ2FpbiBvZiBjYXI6CiAgICAgICAgICAgIGludCBnYWluID0gUmFjZUNhbGMuY2FsY0dhaW5FOChyYXRlcy5zdGFydFJhdGVUb1VzZEU4LCBmaW5pc2hSYXRlVG9Vc2RFOCk7CiAgICAgICAgICAgIHJhY2UuZ2FpbkJ5Q2FyW2Nhcl0gPSBnYWluOwogICAgICAgICAgICBpZiAoaSA9PSAwIHx8IGdhaW4gPiBtYXhHYWluKSB7CiAgICAgICAgICAgICAgICBtYXhHYWluID0gZ2FpbjsKICAgICAgICAgICAgICAgIGZpcnN0Q2FyID0gY2FyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFRoZSBmaXJzdCBmaW5pc2hlZCBjYXIgc2hvdWxkIGJlIGZvdW5kLgogICAgICAgIHJlcXVpcmUoZmlyc3RDYXIgIT0gMCk7CiAgICAgICAgcmFjZS5maXJzdENhciA9IGZpcnN0Q2FyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBmaW5pc2hSYWNlVGhlblN0YXJ0TmV4dCgKICAgICAgICB1aW50IF9sYXBJZCwgCiAgICAgICAgdWludFtdIF9jYXJzQW5kUmF0ZXMsCiAgICAgICAgdWludCBfZHVyYXRpb25TZWNzLAogICAgICAgIHVpbnQgX2xlZnRHcmFjZVNlY3MsIC8vIEhvdyBtYW55IHNlY29uZHMgZnJvbSB0aGUgc3RhcnQgd2Ugc2hvdWxkIG5vdCBhcHBseSBwZW5hbHR5IGZvciBzdGFrZSBvZiBiZXQ/CiAgICAgICAgdWludCBfcmlnaHRHcmFjZVNlY3MgLy8gSG93IG1hbnkgc2Vjb25kcyBiZWZvcmUgdGhlIGZpbmlzaCB3ZSBzaG91bGQgbm90IGFwcGx5IHBlbmFsdHkgZm9yIHN0YWtlIG9mIGJldD8KICAgICkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgZmluaXNoUmFjZShfbGFwSWQsIF9jYXJzQW5kUmF0ZXMpOwogICAgICAgIHN0YXJ0TmV3UmFjZShfbGFwSWQgKyAxLCBfY2Fyc0FuZFJhdGVzLCBfZHVyYXRpb25TZWNzLCBfbGVmdEdyYWNlU2VjcywgX3JpZ2h0R3JhY2VTZWNzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNMYXN0UmFjZUZpbnNpaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBpc0xhcEZpbmlzaGVkKGxhc3RMYXBJZCgpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNMYXBGaW5pc2hlZCgKICAgICAgICB1aW50IF9sYXBJZAogICAgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGdldFJhY2UoX2xhcElkKS5pc0ZpbmlzaGVkKCk7CiAgICB9CiAgICAKICAgIC8vIFVudXNlZCBmdW5jLgogICAgLy8gZnVuY3Rpb24gc2hvdWxkRmluaXNoTGFwKAogICAgLy8gICAgIHVpbnQgX2xhcElkCiAgICAvLyApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIC8vICAgICBSYWNlTGliLlJhY2Ugc3RvcmFnZSBsYXAgPSBnZXRSYWNlKF9sYXBJZCk7CiAgICAvLyAgICAgLy8gJ25vdycgd2lsbCBub3Qgd29yayBmb3IgR2FuYWNoZQogICAgLy8gICAgIHJldHVybiAhbGFwLmlzRmluaXNoZWQoKSAmJiBub3cgPj0gbGFwLmZpbmlzaFRpbWU7CiAgICAvLyB9CiAgICAKICAgIGZ1bmN0aW9uIGxhcFN0YXJ0VGltZSgKICAgICAgICB1aW50IF9sYXBJZAogICAgKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGdldFJhY2UoX2xhcElkKS5zdGFydFRpbWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGxhcEZpbmlzaFRpbWUoCiAgICAgICAgdWludCBfbGFwSWQKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBnZXRSYWNlKF9sYXBJZCkuZmluaXNoVGltZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNDYXJGaW5pc2hlZCgKICAgICAgICB1aW50IF9sYXBJZCwKICAgICAgICBhZGRyZXNzIF9jYXIKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoaXNLbm93bkNhcltfY2FyXSk7CiAgICAgICAgcmV0dXJuIGdldFJhY2UoX2xhcElkKS5pc0ZpbmlzaGVkQ2FyW19jYXJdOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbGxDYXJzRmluaXNoZWQoCiAgICAgICAgdWludCBfbGFwSWQKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmaW5pc2hlZENhckNvdW50KF9sYXBJZCkgPT0gY2Fycy5sZW5ndGg7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGZpbmlzaGVkQ2FyQ291bnQoCiAgICAgICAgdWludCBfbGFwSWQKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBnZXRSYWNlKF9sYXBJZCkuZmluaXNoZWRDYXJDb3VudDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZmlyc3RDYXIoCiAgICAgICAgdWludCBfbGFwSWQKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBnZXRSYWNlKF9sYXBJZCkuZmlyc3RDYXI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzV2lubmluZ0RyaXZlcigKICAgICAgICB1aW50IF9sYXBJZCwgCiAgICAgICAgYWRkcmVzcyBfZHJpdmVyCiAgICApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBSYWNlTGliLlJhY2Ugc3RvcmFnZSByYWNlID0gZ2V0UmFjZShfbGFwSWQpOwogICAgICAgIHJldHVybiByYWNlLnRva2Vuc0J5Q2FyQW5kRHJpdmVyW3JhY2UuZmlyc3RDYXJdW19kcml2ZXJdID4gMDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIGlzIGhlbHBlciBmdW5jdGlvbiB1c2VmdWxsIHdoZW4gZGVidWdnaW5nIGNvbnRyYWN0IG9yIGNoZWNraW5nIHN0YXRlIG9uIEV0aGVyc2Nhbi4KICAgICAqLwogICAgZnVuY3Rpb24gbXlVbmNsYWltZWRUb2tlbnMoCiAgICAgICAgdWludCBfbGFwSWQKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1bmNsYWltZWRUb2tlbnMoX2xhcElkLCBtc2cuc2VuZGVyKTsKICAgIH0KICAgIAogICAgLyoqIAogICAgICogQ2FsY3VsYXRlIGhvdyBtdWNoIHRva2VucyBhIHdpbm5pbmcgZHJpdmVyIGNhbiBjbGFpbSBvbmNlIHJhY2UgaXMgb3Zlci4KICAgICAqIENsYWltZWQgdG9rZW5zIHdpbGwgYmUgYWRkZWQgYmFjayB0byBkcml2ZXIncyB0b2tlbiBiYWxhbmNlLgogICAgICogRm9ybXVsYSA9IHNoYXJlIG9mIGFsbCB0b2tlbnMgYmFzZWQgb24gYmV0cyBtYWRlIG9uIHdpbm5pbmcgY2FyLgogICAgICogVG9rZW5zIGluIGZvcm1hdCBlMTguCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVuY2xhaW1lZFRva2VucygKICAgICAgICB1aW50IF9sYXBJZCwKICAgICAgICBhZGRyZXNzIF9kcml2ZXIKICAgICkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIFJhY2VMaWIuUmFjZSBzdG9yYWdlIHJhY2UgPSBnZXRSYWNlKF9sYXBJZCk7CiAgICAgICAgCiAgICAgICAgLy8gaWYgZHJpdmVyIGhhcyBjbGFpbWVkIGhpcyB0b2tlbnMgYWxyZWFkeS4KICAgICAgICBpZiAocmFjZS50b2tlbnNDbGFpbWVkQnlEcml2ZXJbX2RyaXZlcl0gPiAwKSByZXR1cm4gMDsKICAgICAgICAKICAgICAgICBpZiAoIXJhY2UuaXNGaW5pc2hlZCgpKSByZXR1cm4gMDsKICAgICAgICBpZiAocmFjZS5maXJzdENhciA9PSAwKSByZXR1cm4gMDsKICAgICAgICBpZiAocmFjZS50b3RhbFRva2VucyA9PSAwKSByZXR1cm4gMDsKICAgICAgICBpZiAocmFjZS5zdGFrZUJ5Q2FyW3JhY2UuZmlyc3RDYXJdID09IDApIHJldHVybiAwOwogICAgICAgIAogICAgICAgIC8vIFNpemUgb2YgZHJpdmVyJ3Mgc3Rha2Ugb24gdGhlIGZpcnN0IGZpbmlzaGVkIGNhci4KICAgICAgICB1aW50IGRyaXZlclN0YWtlID0gcmFjZS5zdGFrZUJ5Q2FyQW5kRHJpdmVyW3JhY2UuZmlyc3RDYXJdW19kcml2ZXJdOwogICAgICAgIGlmIChkcml2ZXJTdGFrZSA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgcmV0dXJuIFJhY2VDYWxjLmNhbGNQcml6ZVRva2Vuc0UxOCgKICAgICAgICAgICAgcmFjZS50b3RhbFRva2VucywgCiAgICAgICAgICAgIHJhY2Uuc3Rha2VCeUNhcltyYWNlLmZpcnN0Q2FyXSwKICAgICAgICAgICAgZHJpdmVyU3Rha2UKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKAogICAgICAgIHVpbnQgX2xhcElkCiAgICApIHB1YmxpYyBpZldhbGxldERlZmluZWQgewogICAgICAgIGFkZHJlc3MgZHJpdmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB1aW50IHRva2VucyA9IHVuY2xhaW1lZFRva2VucyhfbGFwSWQsIGRyaXZlcik7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKICAgICAgICAvLyBUcmFuc2ZlciBwcml6ZSB0b2tlbnMgZnJvbSBnYW1lIHdhbGxldCB0byBkcml2ZXIncyBhZGRyZXNzOgogICAgICAgIHJlcXVpcmUod2FsbGV0LnRyYW5zZmVyKGRyaXZlciwgdG9rZW5zKSk7CiAgICAgICAgZ2V0UmFjZShfbGFwSWQpLnRva2Vuc0NsYWltZWRCeURyaXZlcltkcml2ZXJdID0gdG9rZW5zOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBtYWtlQmV0KAogICAgICAgIHVpbnQgX2xhcElkLAogICAgICAgIGFkZHJlc3MgX2NhciwgCiAgICAgICAgdWludCBfdG9rZW5zRTE4CiAgICApIHB1YmxpYyBpZldhbGxldERlZmluZWQgewogICAgICAgIGFkZHJlc3MgZHJpdmVyID0gbXNnLnNlbmRlcjsKICAgICAgICByZXF1aXJlKGlzS25vd25DYXJbX2Nhcl0pOwogICAgICAgIAogICAgICAgIC8vIE5PVEU6IFJlbWVtYmVyIHRoYXQgZHJpdmVyIG5lZWRzIHRvIGNhbGwgVG9rZW4oYWRkcmVzcykuYXBwcm92ZSh3YWxsZXQsIHRva2VucykgCiAgICAgICAgLy8gb3IgdGhpcyBjb250cmFjdCB3aWxsIG5vdCBiZSBhYmxlIHRvIGRvIHRoZSB0cmFuc2ZlciBvbiB5b3VyIGJlaGFsZi4KICAgICAgICAKICAgICAgICAvLyBUcmFuc2ZlciB0b2tlbnMgZnJvbSBkcml2ZXIgdG8gZ2FtZSB3YWxsZXQ6CiAgICAgICAgcmVxdWlyZSh3YWxsZXQudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHdhbGxldCwgX3Rva2Vuc0UxOCkpOwogICAgICAgIGdldFJhY2UoX2xhcElkKS5tYWtlQmV0KGRyaXZlciwgX2NhciwgX3Rva2Vuc0UxOCk7CiAgICAgICAgCiAgICAgICAgaWYgKCFpc0tub3duRHJpdmVyW2RyaXZlcl0pIHsKICAgICAgICAgICAgaXNLbm93bkRyaXZlcltkcml2ZXJdID0gdHJ1ZTsKICAgICAgICAgICAgZHJpdmVycy5wdXNoKGRyaXZlcik7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFJlc3VsdCBhcnJheSBmb3JtYXQ6CiAgICAgKiBbCiAgICAgKiBOKzA6IENPSU5fQUREUkVTUyAoZXg6IDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxMjMwMSkKICAgICAqIE4rMTogTVlfQkVUX1RPS0VOU19FMTgKICAgICAqIC4uLiByZXBlYXQgLi4uCiAgICAgKiBdCiAgICAgKi8KICAgIGZ1bmN0aW9uIG15QmV0c0luTGFwKAogICAgICAgIHVpbnQgX2xhcElkCiAgICApIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnRbXSBtZW1vcnkgdG90YWxzKSB7CiAgICAgICAgUmFjZUxpYi5SYWNlIHN0b3JhZ2UgcmFjZSA9IGdldFJhY2UoX2xhcElkKTsKICAgICAgICB0b3RhbHMgPSBuZXcgdWludFtdKGNhcnMubGVuZ3RoICogMik7CiAgICAgICAgdWludDggaiA9IDA7CiAgICAgICAgYWRkcmVzcyBjYXI7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IGNhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2FyID0gY2Fyc1tpXTsKICAgICAgICAgICAgdG90YWxzW2orK10gPSB1aW50KGNhcik7CiAgICAgICAgICAgIHRvdGFsc1tqKytdID0gcmFjZS50b2tlbnNCeUNhckFuZERyaXZlcltjYXJdW21zZy5zZW5kZXJdOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXN1bHQgYXJyYXkgZm9ybWF0OgogICAgICogWwogICAgICogMDogU1RBUlRfREFURV9VTklYX1RTCiAgICAgKiAxOiBEVVJBVElPTl9TRUMKICAgICAqIDI6IEZJUlNUX0NBUl9JRAogICAgICogMzogISEhIE5FVyAhISEgTVlfVU5DTEFJTUVEX1RPS0VOUwogICAgICogCiAgICAgKiBOKzA6IENPSU5fQUREUkVTUyAoZXg6IDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxMjMwMSkKICAgICAqIE4rMTogU1RBUlRfUkFURV9FOAogICAgICogTisyOiBFTkRfUkFURV9FOAogICAgICogTiszOiBEUklWRVJfQ09VTlQKICAgICAqIE4rNDogVE9UQUxfQkVUX1RPS0VOU19FMTgKICAgICAqIE4rNTogTVlfQkVUX1RPS0VOU19FMTgKICAgICAqIE4rNjogISEhIE5FVyAhISEgR0FJTl9FOAogICAgICogLi4uIHJlcGVhdCBmb3IgZWFjaCBjYXIuLi4KICAgICAqIF0KICAgICAqLwogICAgZnVuY3Rpb24gbGFwVG90YWxzKAogICAgICAgIHVpbnQgX2xhcElkCiAgICApIHB1YmxpYyB2aWV3IHJldHVybnMgKGludFtdIG1lbW9yeSB0b3RhbHMpIHsKICAgICAgICBSYWNlTGliLlJhY2Ugc3RvcmFnZSByYWNlID0gZ2V0UmFjZShfbGFwSWQpOwogICAgICAgIHRvdGFscyA9IG5ldyBpbnRbXSg1ICsgY2Fycy5sZW5ndGggKiA3KTsKICAgICAgICAKICAgICAgICB1aW50IF9teVVuY2xhaW1lZFRva2VucyA9IDA7CiAgICAgICAgaWYgKGlzTGFwRmluaXNoZWQoX2xhcElkKSkgewogICAgICAgICAgICBfbXlVbmNsYWltZWRUb2tlbnMgPSB1bmNsYWltZWRUb2tlbnMoX2xhcElkLCBtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBjYXI7CiAgICAgICAgdWludDggaiA9IDA7CiAgICAgICAgdG90YWxzW2orK10gPSBpbnQobm93KTsKICAgICAgICB0b3RhbHNbaisrXSA9IGludChyYWNlLnN0YXJ0VGltZSk7CiAgICAgICAgdG90YWxzW2orK10gPSBpbnQocmFjZS5maW5pc2hUaW1lIC0gcmFjZS5zdGFydFRpbWUpOwogICAgICAgIHRvdGFsc1tqKytdID0gaW50KHJhY2UuZmlyc3RDYXIpOwogICAgICAgIHRvdGFsc1tqKytdID0gaW50KF9teVVuY2xhaW1lZFRva2Vucyk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IGNhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2FyID0gY2Fyc1tpXTsKICAgICAgICAgICAgdG90YWxzW2orK10gPSBpbnQoY2FyKTsKICAgICAgICAgICAgdG90YWxzW2orK10gPSBpbnQocmFjZS5jYXJSYXRlc1tjYXJdLnN0YXJ0UmF0ZVRvVXNkRTgpOwogICAgICAgICAgICB0b3RhbHNbaisrXSA9IGludChyYWNlLmNhclJhdGVzW2Nhcl0uZmluaXNoUmF0ZVRvVXNkRTgpOwogICAgICAgICAgICB0b3RhbHNbaisrXSA9IGludChyYWNlLmRyaXZlckNvdW50QnlDYXJbY2FyXSk7CiAgICAgICAgICAgIHRvdGFsc1tqKytdID0gaW50KHJhY2UudG9rZW5zQnlDYXJbY2FyXSk7CiAgICAgICAgICAgIHRvdGFsc1tqKytdID0gaW50KHJhY2UudG9rZW5zQnlDYXJBbmREcml2ZXJbY2FyXVttc2cuc2VuZGVyXSk7CiAgICAgICAgICAgIHRvdGFsc1tqKytdID0gcmFjZS5nYWluQnlDYXJbY2FyXTsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFJhY2VPbGRTY2hvb2w0aCBpcyBDb21tb25SYWNlLCBDb2luTGliIHsKICAgIAogICAgZnVuY3Rpb24gUmFjZU9sZFNjaG9vbDRoKCkgQ29tbW9uUmFjZSgKICAgICAgICAweDIyOUI5RWY4MEQyNUE3ZTc2NDhiMTdlMmM1OTg4MDVkMDQyZjllNTYsIC8vIF9fT1dORVIxX18KICAgICAgICAweGNkN2NGMUQ2MTNENTk3NDg3NkFmQmZkNjEyRUQ2QUZkOTQwOTNjZTcsIC8vIF9fT1dORVIyX18KICAgICAgICBvbGRTY2hvb2wsCiAgICAgICAgJ09sZCBTY2hvb2wnCiAgICApIHB1YmxpYyB7fQp9Cgpjb250cmFjdCBSYWNlQnRjRm9ya3M0aCBpcyBDb21tb25SYWNlLCBDb2luTGliIHsKICAgIAogICAgZnVuY3Rpb24gUmFjZUJ0Y0ZvcmtzNGgoKSBDb21tb25SYWNlKAogICAgICAgIDB4MjI5QjlFZjgwRDI1QTdlNzY0OGIxN2UyYzU5ODgwNWQwNDJmOWU1NiwgLy8gX19PV05FUjFfXwogICAgICAgIDB4Y2Q3Y0YxRDYxM0Q1OTc0ODc2QWZCZmQ2MTJFRDZBRmQ5NDA5M2NlNywgLy8gX19PV05FUjJfXwogICAgICAgIGJ0Y0ZvcmtzLAogICAgICAgICdCaXRjb2luIEZvcmtzJwogICAgKSBwdWJsaWMge30KfQoKY29udHJhY3QgUmFjZVNtYXJ0NGggaXMgQ29tbW9uUmFjZSwgQ29pbkxpYiB7CiAgICAKICAgIGZ1bmN0aW9uIFJhY2VTbWFydDRoKCkgQ29tbW9uUmFjZSgKICAgICAgICAweDIyOUI5RWY4MEQyNUE3ZTc2NDhiMTdlMmM1OTg4MDVkMDQyZjllNTYsIC8vIF9fT1dORVIxX18KICAgICAgICAweGNkN2NGMUQ2MTNENTk3NDg3NkFmQmZkNjEyRUQ2QUZkOTQwOTNjZTcsIC8vIF9fT1dORVIyX18KICAgICAgICBzbWFydCwKICAgICAgICAnU21hcnQgQ29pbnMnCiAgICApIHB1YmxpYyB7fQp9Cgpjb250cmFjdCBSYWNlQW5vbnM0aCBpcyBDb21tb25SYWNlLCBDb2luTGliIHsKICAgIAogICAgZnVuY3Rpb24gUmFjZUFub25zNGgoKSBDb21tb25SYWNlKAogICAgICAgIDB4MjI5QjlFZjgwRDI1QTdlNzY0OGIxN2UyYzU5ODgwNWQwNDJmOWU1NiwgLy8gX19PV05FUjFfXwogICAgICAgIDB4Y2Q3Y0YxRDYxM0Q1OTc0ODc2QWZCZmQ2MTJFRDZBRmQ5NDA5M2NlNywgLy8gX19PV05FUjJfXwogICAgICAgIGFub25zLAogICAgICAgICdBbm9ueW1vdXNlcycKICAgICkgcHVibGljIHt9Cn0='.
	

]
