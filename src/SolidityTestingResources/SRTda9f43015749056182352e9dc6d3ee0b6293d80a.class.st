Class {
	#name : #SRTda9f43015749056182352e9dc6d3ee0b6293d80a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTda9f43015749056182352e9dc6d3ee0b6293d80a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKCgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBEaWV0ZXIgU2hpcmxleSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI2MjA2MDcxNjA3MjIwMzFhMGIwZDBmMTgwNzBjNGMwMTBkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4gKGh0dHBzOi8vZ2l0aHViLmNvbS9kZXRlKQpjb250cmFjdCBFUkM3MjEgewogICAgLy8gUmVxdWlyZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIAogICAgLy8gT3B0aW9uYWwgbWV0aG9kcyB1c2VkIGJ5IFNlcnZpY2VTdGF0aW9uIGNvbnRyYWN0CiAgICBmdW5jdGlvbiB0dW5lTGFtYm8odWludDI1NiBfbmV3YXR0cmlidXRlcywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBnZXRMYW1ib0F0dHJpYnV0ZXModWludDI1NiBfaWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBhdHRyaWJ1dGVzKTsKICAgIGZ1bmN0aW9uIGdldExhbWJvTW9kZWwodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50NjQgX21vZGVsKTsKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgICAvLyBPcHRpb25hbAogICAgLy8gZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICAgIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gdG9rZW5JZHMpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwoKICAgIC8vIEVSQy0xNjUgQ29tcGF0aWJpbGl0eSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCgoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIEV0aGVyTGFtYm9Db3JlIHRoYXQgbWFuYWdlcyBzcGVjaWFsIGFjY2VzcyBwcml2aWxlZ2VzLgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKSBhZGFwdGVkIGJ5IEtlbm55IEJhbmlhCi8vLyBAZGV2IC4uLgpjb250cmFjdCBFdGhlckxhbWJvc0FjY2Vzc0NvbnRyb2wgewogICAgLy8gVGhpcyBmYWNldCBjb250cm9scyBhY2Nlc3MgY29udHJvbCBmb3IgRXRoZXJsYW1ib3MuIFRoZXJlIGFyZSBmb3VyIHJvbGVzIG1hbmFnZWQgaGVyZToKICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcyBhbmQgY2hhbmdlIHRoZSBhZGRyZXNzZXMgb2Ygb3VyIGRlcGVuZGVudCBzbWFydAogICAgLy8gICAgICAgICBjb250cmFjdHMuIEl0IGlzIGFsc28gdGhlIG9ubHkgcm9sZSB0aGF0IGNhbiB1bnBhdXNlIHRoZSBzbWFydCBjb250cmFjdC4gSXQgaXMgaW5pdGlhbGx5CiAgICAvLyAgICAgICAgIHNldCB0byB0aGUgYWRkcmVzcyB0aGF0IGNyZWF0ZWQgdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBFdGhlckxhbWJvQ29yZSBjb25zdHJ1Y3Rvci4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0ZPOiBUaGUgQ0ZPIGNhbiB3aXRoZHJhdyBmdW5kcyBmcm9tIEV0aGVyTGFtYm9Db3JlIGFuZCBpdHMgYXVjdGlvbiBjb250cmFjdHMuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENPTzogVGhlIENPTyBjYW4gcmVsZWFzZSBuZXcgbW9kZWxzIGZvciBzYWxlLgogICAgLy8KICAgIC8vIEl0IHNob3VsZCBiZSBub3RlZCB0aGF0IHRoZXNlIHJvbGVzIGFyZSBkaXN0aW5jdCB3aXRob3V0IG92ZXJsYXAgaW4gdGhlaXIgYWNjZXNzIGFiaWxpdGllcywgdGhlCiAgICAvLyBhYmlsaXRpZXMgbGlzdGVkIGZvciBlYWNoIHJvbGUgYWJvdmUgYXJlIGV4aGF1c3RpdmUuIEluIHBhcnRpY3VsYXIsIHdoaWxlIHRoZSBDRU8gY2FuIGFzc2lnbiBhbnkKICAgIC8vIGFkZHJlc3MgdG8gYW55IHJvbGUsIHRoZSBDRU8gYWRkcmVzcyBpdHNlbGYgZG9lc24ndCBoYXZlIHRoZSBhYmlsaXR5IHRvIGFjdCBpbiB0aG9zZSByb2xlcy4gVGhpcwogICAgLy8gcmVzdHJpY3Rpb24gaXMgaW50ZW50aW9uYWwgc28gdGhhdCB3ZSBhcmVuJ3QgdGVtcHRlZCB0byB1c2UgdGhlIENFTyBhZGRyZXNzIGZyZXF1ZW50bHkgb3V0IG9mCiAgICAvLyBjb252ZW5pZW5jZS4gVGhlIGxlc3Mgd2UgdXNlIGFuIGFkZHJlc3MsIHRoZSBsZXNzIGxpa2VseSBpdCBpcyB0aGF0IHdlIHNvbWVob3cgY29tcHJvbWlzZSB0aGUKICAgIC8vIGFjY291bnQuCgogICAgLy8vIEBkZXYgRW1pdGVkIHdoZW4gY29udHJhY3QgaXMgdXBncmFkZWQgLSBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyBuZXdDb250cmFjdCk7CgogICAgLy8gVGhlIGFkZHJlc3NlcyBvZiB0aGUgYWNjb3VudHMgKG9yIGNvbnRyYWN0cykgdGhhdCBjYW4gZXhlY3V0ZSBhY3Rpb25zIHdpdGhpbiBlYWNoIHJvbGVzLgogICAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwoKICAgIC8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENFTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRk8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ09PLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNPTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q0xldmVsKCkgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENFTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0VPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0VPCiAgICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNlb0FkZHJlc3MgPSBfbmV3Q0VPOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENGTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0ZPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0ZPCiAgICBmdW5jdGlvbiBzZXRDRk8oYWRkcmVzcyBfbmV3Q0ZPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRk8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENPTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q09PIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ09PCiAgICBmdW5jdGlvbiBzZXRDT08oYWRkcmVzcyBfbmV3Q09PKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNvb0FkZHJlc3MgPSBfbmV3Q09POwogICAgfQoKICAgIC8qKiogUGF1c2FibGUgZnVuY3Rpb25hbGl0eSBhZGFwdGVkIGZyb20gT3BlblplcHBlbGluICoqKi8KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSAiQy1sZXZlbCIgcm9sZSB0byBwYXVzZSB0aGUgY29udHJhY3QuIFVzZWQgb25seSB3aGVuCiAgICAvLy8gIGEgYnVnIG9yIGV4cGxvaXQgaXMgZGV0ZWN0ZWQgYW5kIHdlIG5lZWQgdG8gbGltaXQgZGFtYWdlLgogICAgZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTywgc2luY2UKICAgIC8vLyAgb25lIHJlYXNvbiB3ZSBtYXkgcGF1c2UgdGhlIGNvbnRyYWN0IGlzIHdoZW4gQ0ZPIG9yIENPTyBhY2NvdW50cyBhcmUKICAgIC8vLyAgY29tcHJvbWlzZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5CiAgICAvLy8gIGRlcml2ZWQgY29udHJhY3RzLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIGNhbid0IHVucGF1c2UgaWYgY29udHJhY3Qgd2FzIHVwZ3JhZGVkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBFdGhlckxhbWJvcy4gSG9sZHMgYWxsIGNvbW1vbiBzdHJ1Y3RzLCBldmVudHMgYW5kIGJhc2UgdmFyaWFibGVzLgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKSBhZGFwdGVkIGJ5IEtlbm55IEJhbmlhCi8vLyBAZGV2IC4uLgpjb250cmFjdCBFdGhlckxhbWJvc0Jhc2UgaXMgRXRoZXJMYW1ib3NBY2Nlc3NDb250cm9sIHsKICAgIC8qKiogRVZFTlRTICoqKi8KCiAgICAvLy8gQGRldiBUaGUgQnVpbGQgZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBuZXcgY2FyIG1vZGVsIGlzIGJ1aWxkIGJ5IHRoZSBDT08KICAgIGV2ZW50IEJ1aWxkKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgbGFtYm9JZCwgdWludDI1NiBhdHRyaWJ1dGVzKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlciBldmVudCBhcyBkZWZpbmVkIGluIGN1cnJlbnQgZHJhZnQgb2YgRVJDNzIxLiBFbWl0dGVkIGV2ZXJ5IHRpbWUgYSBjYXIKICAgIC8vLyAgb3duZXJzaGlwIGlzIGFzc2lnbmVkLCBpbmNsdWRpbmcgYnVpbGRzLgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIGV2ZW50IFR1bmUodWludDI1NiBfbmV3YXR0cmlidXRlcywgdWludDI1NiBfdG9rZW5JZCk7CiAgICAKICAgIC8qKiogREFUQSBUWVBFUyAqKiovCgogICAgLy8vIEBkZXYgVGhlIG1haW4gRXRoZXJMYW1ib3Mgc3RydWN0LiBFdmVyeSBjYXIgaW4gRXRoZXJMYW1ib3MgaXMgcmVwcmVzZW50ZWQgYnkgYSBjb3B5CiAgICAvLy8gIG9mIHRoaXMgc3RydWN0dXJlLCBzbyBncmVhdCBjYXJlIHdhcyB0YWtlbiB0byBlbnN1cmUgdGhhdCBpdCBmaXRzIG5lYXRseSBpbnRvCiAgICAvLy8gIGV4YWN0bHkgdHdvIDI1Ni1iaXQgd29yZHMuIE5vdGUgdGhhdCB0aGUgb3JkZXIgb2YgdGhlIG1lbWJlcnMgaW4gdGhpcyBzdHJ1Y3R1cmUKICAgIC8vLyAgaXMgaW1wb3J0YW50IGJlY2F1c2Ugb2YgdGhlIGJ5dGUtcGFja2luZyBydWxlcyB1c2VkIGJ5IEV0aGVyZXVtLgogICAgLy8vICBSZWY6IGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9kZXZlbG9wL21pc2NlbGxhbmVvdXMuaHRtbAogICAgc3RydWN0IExhbWJvIHsKICAgICAgICAvLyBzcG9ydHMtY2FyIGF0dHJpYnV0ZXMgbGlrZSBtYXggc3BlZWQsIHdlaWdodCBldGMuIGFyZSBzdG9yZWQgaGVyZS4KICAgICAgICAvLyBUaGVzZSBhdHRyaWJ1dGVzIGNhbiBiZSBjaGFuZ2VkIGR1ZSB0byB0dW5pbmcvdXBncmFkZXMKICAgICAgICB1aW50MjU2IGF0dHJpYnV0ZXM7CgogICAgICAgIC8vIFRoZSB0aW1lc3RhbXAgZnJvbSB0aGUgYmxvY2sgd2hlbiB0aGlzIGNhciBjYW1lIHdhcyBjb25zdHJ1Y3RlZC4KICAgICAgICB1aW50NjQgYnVpbGRUaW1lOwogICAgICAgIAogICAgICAgIC8vIHRoZSBMYW1ibyBtb2RlbCBpZGVudGlmaWVyCiAgICAgICAgdWludDY0IG1vZGVsOwoKICAgIH0KCgogICAgLy8gQW4gYXBwcm94aW1hdGlvbiBvZiBjdXJyZW50bHkgaG93IG1hbnkgc2Vjb25kcyBhcmUgaW4gYmV0d2VlbiBibG9ja3MuCiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRzUGVyQmxvY2sgPSAxNTsKCiAgICAvKioqIFNUT1JBR0UgKioqLwoKICAgIC8vLyBAZGV2IEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIExhbWJvIHN0cnVjdCBmb3IgYWxsIExhbWJvcyBpbiBleGlzdGVuY2UuIFRoZSBJRAogICAgLy8vICBvZiBlYWNoIGNhciBpcyBhY3R1YWxseSBhbiBpbmRleCBpbnRvIHRoaXMgYXJyYXkuIE5vdGUgdGhhdCAwIGlzIGludmFsaWQgaW5kZXguCiAgICBMYW1ib1tdIGxhbWJvczsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBjYXIgSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLiBBbGwgY2FycyBoYXZlCiAgICAvLy8gIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGxhbWJvSW5kZXhUb093bmVyOwoKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiB0b2tlbnMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgb3duZXJzaGlwVG9rZW5Db3VudDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBMYW1ib0lEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gRWFjaCBMYW1ibyBjYW4gb25seSBoYXZlIG9uZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0cmFuc2ZlcgogICAgLy8vICBhdCBhbnkgdGltZS4gQSB6ZXJvIHZhbHVlIG1lYW5zIG5vIGFwcHJvdmFsIGlzIG91dHN0YW5kaW5nLgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgbGFtYm9JbmRleFRvQXBwcm92ZWQ7CgogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgdGhlIE1hcmtldFBsYWNlIGNvbnRyYWN0IHRoYXQgaGFuZGxlcyBzYWxlcyBvZiBMYW1ib3MuIFRoaXMKICAgIC8vLyAgc2FtZSBjb250cmFjdCBoYW5kbGVzIGJvdGggcGVlci10by1wZWVyIHNhbGVzIGFzIHdlbGwgYXMgbmV3IG1vZGVsIHNhbGVzLiAKICAgIE1hcmtldFBsYWNlIHB1YmxpYyBtYXJrZXRQbGFjZTsKICAgIFNlcnZpY2VTdGF0aW9uIHB1YmxpYyBzZXJ2aWNlU3RhdGlvbjsKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgTGFtYm8gdG8gYW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFNpbmNlIHRoZSBudW1iZXIgb2YgbGFtYm9zIGlzIGNhcHBlZCB0byAyXjMyIHdlIGNhbid0IG92ZXJmbG93IHRoaXMKICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W190b10rKzsKICAgICAgICAvLyB0cmFuc2ZlciBvd25lcnNoaXAKICAgICAgICBsYW1ib0luZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgLy8gV2hlbiBjcmVhdGluZyBuZXcgbGFtYm9zIF9mcm9tIGlzIDB4MCwgYnV0IHdlIGNhbid0IGFjY291bnQgdGhhdCBhZGRyZXNzLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUgbGFtYm9JbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQW4gaW50ZXJuYWwgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIG5ldyBsYW1ibyBhbmQgc3RvcmVzIGl0LiBUaGlzCiAgICAvLy8gIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuIFdpbGwgZ2VuZXJhdGUgYm90aCBhIEJ1aWxkIGV2ZW50CiAgICAvLy8gIGFuZCBhIFRyYW5zZmVyIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBUaGUgbGFtYm8ncyBhdHRyaWJ1dGVzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGluaXRhbCBvd25lciBvZiB0aGlzIGNhciwgbXVzdCBiZSBub24temVybwogICAgZnVuY3Rpb24gX2NyZWF0ZUxhbWJvKAogICAgICAgIHVpbnQyNTYgX2F0dHJpYnV0ZXMsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludDY0ICBfbW9kZWwKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CgogICAgICAgIAogICAgICAgIExhbWJvIG1lbW9yeSBfbGFtYm8gPSBMYW1ibyh7CiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IF9hdHRyaWJ1dGVzLAogICAgICAgICAgICBidWlsZFRpbWU6IHVpbnQ2NChub3cpLAogICAgICAgICAgICBtb2RlbDpfbW9kZWwKICAgICAgICB9KTsKICAgICAgICB1aW50MjU2IG5ld0xhbWJvSWQgPSBsYW1ib3MucHVzaChfbGFtYm8pIC0gMTsKCiAgICAgICAgLy8gSXQncyBwcm9iYWJseSBuZXZlciBnb2luZyB0byBoYXBwZW4sIDQgYmlsbGlvbiBjYXJzIGlzIEEgTE9ULCBidXQKICAgICAgICAvLyBsZXQncyBqdXN0IGJlIDEwMCUgc3VyZSB3ZSBuZXZlciBsZXQgdGhpcyBoYXBwZW4uCiAgICAgICAgcmVxdWlyZShuZXdMYW1ib0lkID09IHVpbnQyNTYodWludDMyKG5ld0xhbWJvSWQpKSk7CgogICAgICAgIC8vIGVtaXQgdGhlIGJ1aWxkIGV2ZW50CiAgICAgICAgQnVpbGQoCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgbmV3TGFtYm9JZCwKICAgICAgICAgICAgX2xhbWJvLmF0dHJpYnV0ZXMKICAgICAgICApOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQgYXMKICAgICAgICAvLyBwZXIgRVJDNzIxIGRyYWZ0CiAgICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3TGFtYm9JZCk7CgogICAgICAgIHJldHVybiBuZXdMYW1ib0lkOwogICAgfQogICAgIC8vLyBAZGV2IEFuIGludGVybmFsIG1ldGhvZCB0aGF0IHR1bmVzIGFuIGV4aXN0aW5nIGxhbWJvLiBUaGlzCiAgICAvLy8gIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuIFdpbGwgZ2VuZXJhdGUgYSBUdW5lIGV2ZW50CiAgICAvLy8gQHBhcmFtIF9uZXdhdHRyaWJ1dGVzIFRoZSBsYW1ibydzIG5ldyBhdHRyaWJ1dGVzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgY2FyIHRvIGJlIHR1bmVkLgogICAgZnVuY3Rpb24gX3R1bmVMYW1ibygKICAgICAgICB1aW50MjU2IF9uZXdhdHRyaWJ1dGVzLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIGxhbWJvc1tfdG9rZW5JZF0uYXR0cmlidXRlcz1fbmV3YXR0cmlidXRlczsKICAgICAKICAgICAgICAvLyBlbWl0IHRoZSB0dW5lIGV2ZW50CiAgICAgICAgVHVuZSgKICAgICAgICAgICAgX3Rva2VuSWQsCiAgICAgICAgICAgIF9uZXdhdHRyaWJ1dGVzCiAgICAgICAgKTsKCiAgICB9CiAgICAvLyBBbnkgQy1sZXZlbCBjYW4gZml4IGhvdyBtYW55IHNlY29uZHMgcGVyIGJsb2NrcyBhcmUgY3VycmVudGx5IG9ic2VydmVkLgogICAgZnVuY3Rpb24gc2V0U2Vjb25kc1BlckJsb2NrKHVpbnQyNTYgc2VjcykgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgLy9yZXF1aXJlKHNlY3MgPCBjb29sZG93bnNbMF0pOwogICAgICAgIHNlY29uZHNQZXJCbG9jayA9IHNlY3M7CiAgICB9Cn0KCi8vLyBAdGl0bGUgVGhlIGV4dGVybmFsIGNvbnRyYWN0IHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgbWV0YWRhdGEgZm9yIHRoZSBjYXJzLAovLy8gIGl0IGhhcyBvbmUgZnVuY3Rpb24gdGhhdCB3aWxsIHJldHVybiB0aGUgZGF0YSBhcyBieXRlcy4KY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewogICAgLy8vIEBkZXYgR2l2ZW4gYSB0b2tlbiBJZCwgcmV0dXJucyBhIGJ5dGUgYXJyYXkgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBjb252ZXJ0ZWQgaW50byBzdHJpbmcuCiAgICBmdW5jdGlvbiBnZXRNZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzJbNF0gYnVmZmVyLCB1aW50MjU2IGNvdW50KSB7CiAgICAgICAgaWYgKF90b2tlbklkID09IDEpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkhlbGxvIFdvcmxkISA6RCI7CiAgICAgICAgICAgIGNvdW50ID0gMTU7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJJIHdvdWxkIGRlZmluaXRlbHkgY2hvb3NlIGEgbWVkaSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJ1bSBsZW5ndGggc3RyaW5nLiI7CiAgICAgICAgICAgIGNvdW50ID0gNDk7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAzKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgbWkgZSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJzdCBhY2N1bXNhbiBkYXBpYnVzIGF1Z3VlIGxvcmVtLCI7CiAgICAgICAgICAgIGJ1ZmZlclsyXSA9ICIgdHJpc3RpcXVlIHZlc3RpYnVsdW0gaWQsIGxpYmVybyI7CiAgICAgICAgICAgIGJ1ZmZlclszXSA9ICIgc3VzY2lwaXQgdmFyaXVzIHNhcGllbiBhbGlxdWFtLiI7CiAgICAgICAgICAgIGNvdW50ID0gMTI4OwogICAgICAgIH0KICAgIH0KfQoKLy8vIEB0aXRsZSBUaGUgZmFjZXQgb2YgdGhlIEV0aGVyTGFtYm9zQ29yZSBjb250cmFjdCB0aGF0IG1hbmFnZXMgb3duZXJzaGlwLCBFUkMtNzIxIChkcmFmdCkgY29tcGxpYW50LgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKSBhZGFwdGVkIGJ5IENyeXB0b2tuaWdodHMKLy8vIEBkZXYgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCgpjb250cmFjdCBFdGhlckxhbWJvc093bmVyc2hpcCBpcyBFdGhlckxhbWJvc0Jhc2UsIEVSQzcyMSB7CgogICAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkV0aGVyTGFtYm9zIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkVMIjsKCiAgICAvLyBUaGUgY29udHJhY3QgdGhhdCB3aWxsIHJldHVybiBsYW1ibyBtZXRhZGF0YQogICAgRVJDNzIxTWV0YWRhdGEgcHVibGljIGVyYzcyMU1ldGFkYXRhOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCduYW1lKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdiYWxhbmNlT2YoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5zT2ZPd25lcihhZGRyZXNzKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5NZXRhZGF0YSh1aW50MjU2LHN0cmluZyknKSk7CgogICAgLy8vIEBub3RpY2UgSW50cm9zcGVjdGlvbiBpbnRlcmZhY2UgYXMgcGVyIEVSQy0xNjUgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpLgogICAgLy8vICBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LiBXZSBpbXBsZW1lbnQKICAgIC8vLyAgRVJDLTE2NSAob2J2aW91c2x5ISkgYW5kIEVSQy03MjEuCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gREVCVUcgT05MWQogICAgICAgIC8vcmVxdWlyZSgoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9PSAweDAxZmZjOWE3KSAmJiAoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9PSAweDlhMjA0ODNkKSk7CgogICAgICAgIHJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHNpYmxpbmcgY29udHJhY3QgdGhhdCB0cmFja3MgbWV0YWRhdGEuCiAgICAvLy8gIENFTyBvbmx5LgogICAgZnVuY3Rpb24gc2V0TWV0YWRhdGFBZGRyZXNzKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcykgcHVibGljIG9ubHlDRU8gewogICAgICAgIGVyYzcyMU1ldGFkYXRhID0gRVJDNzIxTWV0YWRhdGEoX2NvbnRyYWN0QWRkcmVzcyk7CiAgICB9CgogICAgLy8gSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbnM6IFRoZXNlIGZ1bmN0aW9ucyBhbGwgYXNzdW1lIHRoYXQgdGhlaXIgaW5wdXQgYXJndW1lbnRzCiAgICAvLyBhcmUgdmFsaWQuIFdlIGxlYXZlIGl0IHRvIHB1YmxpYyBtZXRob2RzIHRvIHNhbml0aXplIHRoZWlyIGlucHV0cyBhbmQgZm9sbG93CiAgICAvLyB0aGUgcmVxdWlyZWQgbG9naWMuCgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBpcyB0aGUgY3VycmVudCBvd25lciBvZiBhIHBhcnRpY3VsYXIgTGFtYm8uCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgdmFsaWRhdGluZyBhZ2FpbnN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBraXR0ZW4gaWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbGFtYm9JbmRleFRvT3duZXJbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIExhbWJvLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIGNvbmZpcm1pbmcgTGFtYm8gaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBsYW1ibyBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbGFtYm9JbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBNYXJrcyBhbiBhZGRyZXNzIGFzIGJlaW5nIGFwcHJvdmVkIGZvciB0cmFuc2ZlckZyb20oKSwgb3ZlcndyaXRpbmcgYW55IHByZXZpb3VzCiAgICAvLy8gIGFwcHJvdmFsLiBTZXR0aW5nIF9hcHByb3ZlZCB0byBhZGRyZXNzKDApIGNsZWFycyBhbGwgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAvLy8gIE5PVEU6IF9hcHByb3ZlKCkgZG9lcyBOT1Qgc2VuZCB0aGUgQXBwcm92YWwgZXZlbnQuIFRoaXMgaXMgaW50ZW50aW9uYWwgYmVjYXVzZQogICAgLy8vICBfYXBwcm92ZSgpIGFuZCB0cmFuc2ZlckZyb20oKSBhcmUgdXNlZCB0b2dldGhlciBmb3IgcHV0dGluZyBMYW1ib3Mgb24gc2FsZSwgYW5kCiAgICAvLy8gIHRoZXJlIGlzIG5vIHZhbHVlIGluIHNwYW1taW5nIHRoZSBsb2cgd2l0aCBBcHByb3ZhbCBldmVudHMgaW4gdGhhdCBjYXNlLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIGludGVybmFsIHsKICAgICAgICBsYW1ib0luZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgbnVtYmVyIG9mIExhbWJvcyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBvd25lcnNoaXBUb2tlbkNvdW50W19vd25lcl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIGEgTGFtYm8gdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vICBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSAob3IKICAgIC8vLyAgRXRoZXJMYW1ib3Mgc3BlY2lmaWNhbGx5KSBvciB5b3VyIExhbWJvIG1heSBiZSBsb3N0IGZvcmV2ZXIuIFNlcmlvdXNseS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgTGFtYm8gdG8gdHJhbnNmZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBsYW1ib3MuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoZSBhdWN0aW9uIGNvbnRyYWN0cyB0byBwcmV2ZW50IGFjY2lkZW50YWwKICAgICAgICAvLyBtaXN1c2UuIE1hcmtldHBsYWNlIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBMYW1ib3MKICAgICAgICAvLyB0aHJvdWdoIHRoZSBhbGxvdyArIHRyYW5zZmVyRnJvbSBmbG93LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MobWFya2V0UGxhY2UpKTsKCiAgICAgICAgLy8gWW91IGNhbiBvbmx5IHNlbmQgeW91ciBvd24gY2FyLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwLCBjbGVhciBwZW5kaW5nIGFwcHJvdmFscywgZW1pdCBUcmFuc2ZlciBldmVudC4KICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR3JhbnQgYW5vdGhlciBhZGRyZXNzIHRoZSByaWdodCB0byB0cmFuc2ZlciBhIHNwZWNpZmljIExhbWJvIHZpYQogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gVGhpcyBpcyB0aGUgcHJlZmVycmVkIGZsb3cgZm9yIHRyYW5zZmVyaW5nIE5GVHMgdG8gY29udHJhY3RzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAvLy8gIGNsZWFyIGFsbCBhcHByb3ZhbHMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgTGFtYm8gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIE9ubHkgYW4gb3duZXIgY2FuIGdyYW50IHRyYW5zZmVyIGFwcHJvdmFsLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIChyZXBsYWNpbmcgYW55IHByZXZpb3VzIGFwcHJvdmFsKS4KICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBhcHByb3ZhbCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIExhbWJvIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBMYW1ibyB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIExhbWJvLiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIExhbWJvIHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgbGFtYm9zLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIENoZWNrIGZvciBhcHByb3ZhbCBhbmQgdmFsaWQgb3duZXJzaGlwCiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgTGFtYm9zIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGxhbWJvcy5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIExhbWJvLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzIG93bmVyKQogICAgewogICAgICAgIG93bmVyID0gbGFtYm9JbmRleFRvT3duZXJbX3Rva2VuSWRdOwoKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBsaXN0IG9mIGFsbCBMYW1ibyBJRHMgYXNzaWduZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciB3aG9zZSBMYW1ibyB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4KICAgIC8vLyBAZGV2IFRoaXMgbWV0aG9kIE1VU1QgTkVWRVIgYmUgY2FsbGVkIGJ5IHNtYXJ0IGNvbnRyYWN0IGNvZGUuIEZpcnN0LCBpdCdzIGZhaXJseQogICAgLy8vICBleHBlbnNpdmUgKGl0IHdhbGtzIHRoZSBlbnRpcmUgTGFtYm8gYXJyYXkgbG9va2luZyBmb3IgY2FycyBiZWxvbmdpbmcgdG8gb3duZXIpLAogICAgLy8vICBidXQgaXQgYWxzbyByZXR1cm5zIGEgZHluYW1pYyBhcnJheSwgd2hpY2ggaXMgb25seSBzdXBwb3J0ZWQgZm9yIHdlYjMgY2FsbHMsIGFuZAogICAgLy8vICBub3QgY29udHJhY3QtdG8tY29udHJhY3QgY2FsbHMuCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIG93bmVyVG9rZW5zKSB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbENhcnMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIC8vIFdlIGNvdW50IG9uIHRoZSBmYWN0IHRoYXQgYWxsIGNhcnMgaGF2ZSBJRHMgc3RhcnRpbmcgYXQgMSBhbmQgaW5jcmVhc2luZwogICAgICAgICAgICAvLyBzZXF1ZW50aWFsbHkgdXAgdG8gdGhlIHRvdGFsQ2F0IGNvdW50LgogICAgICAgICAgICB1aW50MjU2IGNhcklkOwoKICAgICAgICAgICAgZm9yIChjYXJJZCA9IDE7IGNhcklkIDw9IHRvdGFsQ2FyczsgY2FySWQrKykgewogICAgICAgICAgICAgICAgaWYgKGxhbWJvSW5kZXhUb093bmVyW2NhcklkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gY2FySWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIG1lbWNweSgpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjIwNDE1MjQxNDM0ODRlNDk0NDYwNGU0ZjU0NDQ0ZjU0MGU0ZTQ1NTQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF9tZW1jcHkodWludCBfZGVzdCwgdWludCBfc3JjLCB1aW50IF9sZW4pIHByaXZhdGUgdmlldyB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgbWxvYWQoX3NyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Rlc3QgKz0gMzI7CiAgICAgICAgICAgIF9zcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQyNTYgbWFzayA9IDI1NiAqKiAoMzIgLSBfbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoX3NyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChfZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gdG9TdHJpbmcoc2xpY2UpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImUxODA5MzgwODI4OThmODg4NWExOGY4ZTk1ODU4ZTk1Y2Y4Zjg0OTUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF90b1N0cmluZyhieXRlczMyWzRdIF9yYXdCeXRlcywgdWludDI1NiBfc3RyaW5nTGVuZ3RoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CiAgICAgICAgdWludDI1NiBvdXRwdXRQdHI7CiAgICAgICAgdWludDI1NiBieXRlc1B0cjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBvdXRwdXRQdHIgOj0gYWRkKG91dHB1dFN0cmluZywgMzIpCiAgICAgICAgICAgIGJ5dGVzUHRyIDo9IF9yYXdCeXRlcwogICAgICAgIH0KCiAgICAgICAgX21lbWNweShvdXRwdXRQdHIsIGJ5dGVzUHRyLCBfc3RyaW5nTGVuZ3RoKTsKCiAgICAgICAgcmV0dXJuIG91dHB1dFN0cmluZzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgVVJJIHBvaW50aW5nIHRvIGEgbWV0YWRhdGEgcGFja2FnZSBmb3IgdGhpcyB0b2tlbiBjb25mb3JtaW5nIHRvCiAgICAvLy8gIEVSQy03MjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBudW1iZXIgb2YgdGhlIExhbWJvcyB3aG9zZSBtZXRhZGF0YSBzaG91bGQgYmUgcmV0dXJuZWQuCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICAgICAgcmVxdWlyZShlcmM3MjFNZXRhZGF0YSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CiAgICAgICAgdWludDI1NiBjb3VudDsKICAgICAgICAoYnVmZmVyLCBjb3VudCkgPSBlcmM3MjFNZXRhZGF0YS5nZXRNZXRhZGF0YShfdG9rZW5JZCwgX3ByZWZlcnJlZFRyYW5zcG9ydCk7CgogICAgICAgIHJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7CiAgICB9Cn0KCgovLy8gQHRpdGxlIE1hcmtldFBsYWNlIGNvcmUKLy8vIEBkZXYgQ29udGFpbnMgbW9kZWxzLCB2YXJpYWJsZXMsIGFuZCBpbnRlcm5hbCBtZXRob2RzIGZvciB0aGUgbWFya2V0cGxhY2UuCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgTWFya2V0UGxhY2VCYXNlIGlzIE93bmFibGUgewoKICAgIC8vIFJlcHJlc2VudHMgYW4gc2FsZSBvbiBhbiBORlQKICAgIHN0cnVjdCBTYWxlIHsKICAgICAgICAvLyBDdXJyZW50IG93bmVyIG9mIE5GVAogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIAogICAgICAgIHVpbnQxMjggcHJpY2U7CiAgICAgICAgLy8gVGltZSB3aGVuIHNhbGUgc3RhcnRlZAogICAgICAgIC8vIE5PVEU6IDAgaWYgdGhpcyBzYWxlIGhhcyBiZWVuIGNvbmNsdWRlZAogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CiAgICAKICAgIHN0cnVjdCBBZmZpbGlhdGVzIHsKICAgICAgICBhZGRyZXNzIGFmZmlsaWF0ZV9hZGRyZXNzOwogICAgICAgIHVpbnQ2NCBjb21taXNzaW9uOwogICAgICAgIHVpbnQ2NCBwcmljZWN1dDsKICAgIH0KICAgIAogICAgLy9BZmZpbGlhdGVzW10gYWZmaWxpYXRlczsKICAgIC8vIFJlZmVyZW5jZSB0byBjb250cmFjdCB0cmFja2luZyBORlQgb3duZXJzaGlwCiAgICBFUkM3MjEgcHVibGljIG5vbkZ1bmdpYmxlQ29udHJhY3Q7CgogICAgLy8gQ3V0IG93bmVyIHRha2VzIG9uIGVhY2ggc2FsZSwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MjU2IHB1YmxpYyBvd25lckN1dDsKCiAgICAvL21hcCB0aGUgQWZmaWxpYXRlIENvZGUgdG8gdGhlIEFmZmlsaWF0ZQogICAgbWFwcGluZyAodWludDI1NiA9PiBBZmZpbGlhdGVzKSBjb2RlVG9BZmZpbGlhdGU7CgogICAgLy8gTWFwIGZyb20gdG9rZW4gSUQgdG8gdGhlaXIgY29ycmVzcG9uZGluZyBzYWxlLgogICAgbWFwcGluZyAodWludDI1NiA9PiBTYWxlKSB0b2tlbklkVG9TYWxlOwoKICAgIGV2ZW50IFNhbGVDcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBwcmljZSk7CiAgICBldmVudCBTYWxlU3VjY2Vzc2Z1bCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgcHJpY2UsIGFkZHJlc3MgYnV5ZXIpOwogICAgZXZlbnQgU2FsZUNhbmNlbGxlZCh1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgY2xhaW1hbnQgb3ducyB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCAtIEFkZHJlc3MgY2xhaW1pbmcgdG8gb3duIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB3aG9zZSBvd25lcnNoaXAgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm9uRnVuZ2libGVDb250cmFjdC5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQpOwogICAgfQoKICAgIC8vLyBAZGV2IEVzY3Jvd3MgdGhlIE5GVCwgYXNzaWduaW5nIG93bmVyc2hpcCB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIFRocm93cyBpZiB0aGUgZXNjcm93IGZhaWxzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgLSBDdXJyZW50IG93bmVyIGFkZHJlc3Mgb2YgdG9rZW4gdG8gZXNjcm93LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIGFwcHJvdmFsIHRvIHZlcmlmeS4KICAgIGZ1bmN0aW9uIF9lc2Nyb3coYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBpdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlckZyb20oX293bmVyLCB0aGlzLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIGFuIE5GVCBvd25lZCBieSB0aGlzIGNvbnRyYWN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgIC8vLyBSZXR1cm5zIHRydWUgaWYgdGhlIHRyYW5zZmVyIHN1Y2NlZWRzLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXIgLSBBZGRyZXNzIHRvIHRyYW5zZmVyIE5GVCB0by4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyKF9yZWNlaXZlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFkZHMgYW4gc2FsZSB0byB0aGUgbGlzdCBvZiBvcGVuIHNhbGVzLiBBbHNvIGZpcmVzIHRoZQogICAgLy8vICBTYWxlQ3JlYXRlZCBldmVudC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSB0b2tlbiB0byBiZSBwdXQgb24gc2FsZS4KICAgIC8vLyBAcGFyYW0gX3NhbGUgU2FsZSB0byBhZGQuCiAgICBmdW5jdGlvbiBfYWRkU2FsZSh1aW50MjU2IF90b2tlbklkLCBTYWxlIF9zYWxlKSBpbnRlcm5hbCB7CiAgICAgICAgCgogICAgICAgIHRva2VuSWRUb1NhbGVbX3Rva2VuSWRdID0gX3NhbGU7CgogICAgICAgIFNhbGVDcmVhdGVkKAogICAgICAgICAgICB1aW50MjU2KF90b2tlbklkKSwKICAgICAgICAgICAgdWludDI1Nihfc2FsZS5wcmljZSkKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYSBzYWxlIHVuY29uZGl0aW9uYWxseS4KICAgIGZ1bmN0aW9uIF9jYW5jZWxTYWxlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3NlbGxlcikgaW50ZXJuYWwgewogICAgICAgIF9yZW1vdmVTYWxlKF90b2tlbklkKTsKICAgICAgICBfdHJhbnNmZXIoX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIFNhbGVDYW5jZWxsZWQoX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBwcmljZSBhbmQgdHJhbnNmZXJzIHdpbm5pbmdzLgogICAgLy8vIERvZXMgTk9UIHRyYW5zZmVyIG93bmVyc2hpcCBvZiB0b2tlbi4KICAgIGZ1bmN0aW9uIF9iaWQodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfYmlkQW1vdW50KQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIHNhbGUgc3RydWN0CiAgICAgICAgU2FsZSBzdG9yYWdlIHNhbGUgPSB0b2tlbklkVG9TYWxlW190b2tlbklkXTsKCiAgICAgICAgLy8gRXhwbGljaXRseSBjaGVjayB0aGF0IHRoaXMgc2FsZSBpcyBjdXJyZW50bHkgbGl2ZS4KICAgICAgICAvLyAoQmVjYXVzZSBvZiBob3cgRXRoZXJldW0gbWFwcGluZ3Mgd29yaywgd2UgY2FuJ3QganVzdCBjb3VudAogICAgICAgIC8vIG9uIHRoZSBsb29rdXAgYWJvdmUgZmFpbGluZy4gQW4gaW52YWxpZCBfdG9rZW5JZCB3aWxsIGp1c3QKICAgICAgICAvLyByZXR1cm4gYSBzYWxlIG9iamVjdCB0aGF0IGlzIGFsbCB6ZXJvcy4pCiAgICAgICAgcmVxdWlyZShfaXNPblNhbGUoc2FsZSkpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBiaWQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBjdXJyZW50IHByaWNlCiAgICAgICAgdWludDI1NiBwcmljZSA9IHNhbGUucHJpY2U7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2VsbGVyIGJlZm9yZSB0aGUgc2FsZSBzdHJ1Y3QKICAgICAgICAvLyBnZXRzIGRlbGV0ZWQuCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBzYWxlLnNlbGxlcjsKCiAgICAgICAgLy8gVGhlIGJpZCBpcyBnb29kISBSZW1vdmUgdGhlIHNhbGUgYmVmb3JlIHNlbmRpbmcgdGhlIGZlZXMKICAgICAgICAvLyB0byB0aGUgc2VuZGVyIHNvIHdlIGNhbid0IGhhdmUgYSByZWVudHJhbmN5IGF0dGFjay4KICAgICAgICBfcmVtb3ZlU2FsZShfdG9rZW5JZCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHByb2NlZWRzIHRvIHNlbGxlciAoaWYgdGhlcmUgYXJlIGFueSEpCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIE1hcmtldHBsYWNlJ3MgY3V0LgogICAgICAgICAgICAvLyAoTk9URTogX2NvbXB1dGVDdXQoKSBpcyBndWFyYW50ZWVkIHRvIHJldHVybiBhCiAgICAgICAgICAgIC8vIHZhbHVlIDw9IHByaWNlLCBzbyB0aGlzIHN1YnRyYWN0aW9uIGNhbid0IGdvIG5lZ2F0aXZlLikKICAgICAgICAgICAgdWludDI1NiBtYXJrZXRwbGFjZUN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gbWFya2V0cGxhY2VDdXQ7CgogICAgICAgICAgICAvLyBOT1RFOiBEb2luZyBhIHRyYW5zZmVyKCkgaW4gdGhlIG1pZGRsZSBvZiBhIGNvbXBsZXgKICAgICAgICAgICAgLy8gbWV0aG9kIGxpa2UgdGhpcyBpcyBnZW5lcmFsbHkgZGlzY291cmFnZWQgYmVjYXVzZSBvZgogICAgICAgICAgICAvLyByZWVudHJhbmN5IGF0dGFja3MgYW5kIERvUyBhdHRhY2tzIGlmIHRoZSBzZWxsZXIgaXMKICAgICAgICAgICAgLy8gYSBjb250cmFjdCB3aXRoIGFuIGludmFsaWQgZmFsbGJhY2sgZnVuY3Rpb24uIFdlIGV4cGxpY2l0bHkKICAgICAgICAgICAgLy8gZ3VhcmQgYWdhaW5zdCByZWVudHJhbmN5IGF0dGFja3MgYnkgcmVtb3ZpbmcgdGhlIGF1Y3Rpb24KICAgICAgICAgICAgLy8gYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIoKSwgYW5kIHRoZSBvbmx5IHRoaW5nIHRoZSBzZWxsZXIKICAgICAgICAgICAgLy8gY2FuIERvUyBpcyB0aGUgc2FsZSBvZiB0aGVpciBvd24gYXNzZXQhIChBbmQgaWYgaXQncyBhbgogICAgICAgICAgICAvLyBhY2NpZGVudCwgdGhleSBjYW4gY2FsbCBjYW5jZWxBdWN0aW9uKCkuICkKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBTYWxlU3VjY2Vzc2Z1bChfdG9rZW5JZCwgcHJpY2UsIG1zZy5zZW5kZXIpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhIHNhbGUgZnJvbSB0aGUgbGlzdCBvZiBvcGVuIHNhbGVzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBzYWxlLgogICAgZnVuY3Rpb24gX3JlbW92ZVNhbGUodWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSB0b2tlbklkVG9TYWxlW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIE5GVCBpcyBvbiBzYWxlLgogICAgLy8vIEBwYXJhbSBfc2FsZSAtIFNhbGUgdG8gY2hlY2suCiAgICBmdW5jdGlvbiBfaXNPblNhbGUoU2FsZSBzdG9yYWdlIF9zYWxlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9zYWxlLnN0YXJ0ZWRBdCA+IDApOwogICAgfQoKCiAgICAvLy8gQGRldiBDb21wdXRlcyBvd25lcidzIGN1dCBvZiBhIHNhbGUuCiAgICAvLy8gQHBhcmFtIF9wcmljZSAtIFNhbGUgcHJpY2Ugb2YgTkZULgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXQodWludDI1NiBfcHJpY2UpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgZW50cnkgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLCBhbmQgb3duZXJDdXQgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gIHN0YXRlbWVudCBpbiB0aGUgTWFya2V0cGxhY2UgY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyAgZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX3ByaWNlLgogICAgICAgIHJldHVybiBfcHJpY2UgKiBvd25lckN1dCAvIDEwMDAwOwogICAgfQogICAgZnVuY3Rpb24gX2NvbXB1dGVBZmZpbGlhdGVDdXQodWludDI1NiBfcHJpY2UsQWZmaWxpYXRlcyBhZmZpbGlhdGUpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgZW50cnkgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLCBhbmQgb3duZXJDdXQgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gIHN0YXRlbWVudCBpbiB0aGUgTWFya2V0cGxhY2UgY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyAgZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX3ByaWNlLgogICAgICAgIHJldHVybiBfcHJpY2UgKiBhZmZpbGlhdGUuY29tbWlzc2lvbiAvIDEwMDAwOwogICAgfQogICAgLy8vIEBkZXYgQWRkcyBhbiBhZmZpbGlhdGUgdG8gdGhlIGxpc3QuCiAgICAvLy8gQHBhcmFtIF9jb2RlIFRoZSByZWZlcmFsbCBjb2RlIG9mIHRoZSBhZmZpbGlhdGUuCiAgICAvLy8gQHBhcmFtIF9hZmZpbGlhdGUgQWZmaWxpYXRlIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBZmZpbGlhdGUodWludDI1NiBfY29kZSwgQWZmaWxpYXRlcyBfYWZmaWxpYXRlKSBpbnRlcm5hbCB7CiAgICAgICAgY29kZVRvQWZmaWxpYXRlW19jb2RlXSA9IF9hZmZpbGlhdGU7CiAgIAogICAgfQogICAgCiAgICAvLy8gQGRldiBSZW1vdmVzIGEgYWZmaWxpYXRlIGZyb20gdGhlIGxpc3QuCiAgICAvLy8gQHBhcmFtIF9jb2RlIC0gVGhlIHJlZmVyYWxsIGNvZGUgb2YgdGhlIGFmZmlsaWF0ZS4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBZmZpbGlhdGUodWludDI1NiBfY29kZSkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSBjb2RlVG9BZmZpbGlhdGVbX2NvZGVdOwogICAgfQogICAgCiAgICAKICAgIC8vX2JpZFJlZmVycmFsKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIHByaWNlIGFuZCB0cmFuc2ZlcnMgd2lubmluZ3MuCiAgICAvLy8gRG9lcyBOT1QgdHJhbnNmZXIgb3duZXJzaGlwIG9mIHRva2VuLgogICAgZnVuY3Rpb24gX2JpZFJlZmVycmFsKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCxBZmZpbGlhdGVzIF9hZmZpbGlhdGUpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIAogICAgICAgIC8vIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgc2FsZSBzdHJ1Y3QKICAgICAgICBTYWxlIHN0b3JhZ2Ugc2FsZSA9IHRva2VuSWRUb1NhbGVbX3Rva2VuSWRdOwoKICAgICAgICAvL09ubHkgT3duZXIgb2YgQ29udHJhY3QgY2FuIHNlbGwgcmVmZXJyYWxzCiAgICAgICAgcmVxdWlyZShzYWxlLnNlbGxlcj09b3duZXIpOwoKICAgICAgICAvLyBFeHBsaWNpdGx5IGNoZWNrIHRoYXQgdGhpcyBzYWxlIGlzIGN1cnJlbnRseSBsaXZlLgogICAgICAgIC8vIChCZWNhdXNlIG9mIGhvdyBFdGhlcmV1bSBtYXBwaW5ncyB3b3JrLCB3ZSBjYW4ndCBqdXN0IGNvdW50CiAgICAgICAgLy8gb24gdGhlIGxvb2t1cCBhYm92ZSBmYWlsaW5nLiBBbiBpbnZhbGlkIF90b2tlbklkIHdpbGwganVzdAogICAgICAgIC8vIHJldHVybiBhIHNhbGUgb2JqZWN0IHRoYXQgaXMgYWxsIHplcm9zLikKICAgICAgICByZXF1aXJlKF9pc09uU2FsZShzYWxlKSk7CiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgYmlkIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgY3VycmVudCBwcmljZQogICAgICAgIAogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBzYWxlLnByaWNlOwogICAgICAgIAogICAgICAgIC8vZGVkdWNlIHRoZSBhZmZpbGlhdGUgcHJpY2VjdXQKICAgICAgICBwcmljZT1wcmljZSAqIF9hZmZpbGlhdGUucHJpY2VjdXQgLyAxMDAwMDsgIAogICAgICAgIHJlcXVpcmUoX2JpZEFtb3VudCA+PSBwcmljZSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHNlbGxlciBiZWZvcmUgdGhlIHNhbGUgc3RydWN0CiAgICAgICAgLy8gZ2V0cyBkZWxldGVkLgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gc2FsZS5zZWxsZXI7CiAgICAgICAgYWRkcmVzcyBhZmZpbGlhdGVfYWRkcmVzcyA9IF9hZmZpbGlhdGUuYWZmaWxpYXRlX2FkZHJlc3M7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGJpZCBpcyBnb29kISBSZW1vdmUgdGhlIHNhbGUgYmVmb3JlIHNlbmRpbmcgdGhlIGZlZXMKICAgICAgICAvLyB0byB0aGUgc2VuZGVyIHNvIHdlIGNhbid0IGhhdmUgYSByZWVudHJhbmN5IGF0dGFjay4KICAgICAgICBfcmVtb3ZlU2FsZShfdG9rZW5JZCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHByb2NlZWRzIHRvIHNlbGxlciAoaWYgdGhlcmUgYXJlIGFueSEpCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIE1hcmtldHBsYWNlJ3MgY3V0LgogICAgICAgICAgICAvLyAoTk9URTogX2NvbXB1dGVDdXQoKSBpcyBndWFyYW50ZWVkIHRvIHJldHVybiBhCiAgICAgICAgICAgIC8vIHZhbHVlIDw9IHByaWNlLCBzbyB0aGlzIHN1YnRyYWN0aW9uIGNhbid0IGdvIG5lZ2F0aXZlLikKICAgICAgICAgICAgdWludDI1NiBhZmZpbGlhdGVDdXQgPSBfY29tcHV0ZUFmZmlsaWF0ZUN1dChwcmljZSxfYWZmaWxpYXRlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYWZmaWxpYXRlQ3V0OwoKICAgICAgICAgICAgLy8gTk9URTogRG9pbmcgYSB0cmFuc2ZlcigpIGluIHRoZSBtaWRkbGUgb2YgYSBjb21wbGV4CiAgICAgICAgICAgIC8vIG1ldGhvZCBsaWtlIHRoaXMgaXMgZ2VuZXJhbGx5IGRpc2NvdXJhZ2VkIGJlY2F1c2Ugb2YKICAgICAgICAgICAgLy8gcmVlbnRyYW5jeSBhdHRhY2tzIGFuZCBEb1MgYXR0YWNrcyBpZiB0aGUgc2VsbGVyIGlzCiAgICAgICAgICAgIC8vIGEgY29udHJhY3Qgd2l0aCBhbiBpbnZhbGlkIGZhbGxiYWNrIGZ1bmN0aW9uLiBXZSBleHBsaWNpdGx5CiAgICAgICAgICAgIC8vIGd1YXJkIGFnYWluc3QgcmVlbnRyYW5jeSBhdHRhY2tzIGJ5IHJlbW92aW5nIHRoZSBhdWN0aW9uCiAgICAgICAgICAgIC8vIGJlZm9yZSBjYWxsaW5nIHRyYW5zZmVyKCksIGFuZCB0aGUgb25seSB0aGluZyB0aGUgc2VsbGVyCiAgICAgICAgICAgIC8vIGNhbiBEb1MgaXMgdGhlIHNhbGUgb2YgdGhlaXIgb3duIGFzc2V0ISAoQW5kIGlmIGl0J3MgYW4KICAgICAgICAgICAgLy8gYWNjaWRlbnQsIHRoZXkgY2FuIGNhbGwgY2FuY2VsQXVjdGlvbigpLiApCiAgICAgICAgICAgIHNlbGxlci50cmFuc2ZlcihzZWxsZXJQcm9jZWVkcyk7CiAgICAgICAgICAgIGFmZmlsaWF0ZV9hZGRyZXNzLnRyYW5zZmVyKGFmZmlsaWF0ZUN1dCk7CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxjdWxhdGUgYW55IGV4Y2VzcyBmdW5kcyBpbmNsdWRlZCB3aXRoIHRoZSBiaWQuIElmIHRoZSBleGNlc3MKICAgICAgICAvLyBpcyBhbnl0aGluZyB3b3J0aCB3b3JyeWluZyBhYm91dCwgdHJhbnNmZXIgaXQgYmFjayB0byBiaWRkZXIuCiAgICAgICAgLy8gTk9URTogV2UgY2hlY2tlZCBhYm92ZSB0aGF0IHRoZSBiaWQgYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiBvcgogICAgICAgIC8vIGVxdWFsIHRvIHRoZSBwcmljZSBzbyB0aGlzIGNhbm5vdCB1bmRlcmZsb3cuCiAgICAgICAgdWludDI1NiBiaWRFeGNlc3MgPSBfYmlkQW1vdW50IC0gcHJpY2U7CgogICAgICAgIC8vIFJldHVybiB0aGUgZnVuZHMuIFNpbWlsYXIgdG8gdGhlIHByZXZpb3VzIHRyYW5zZmVyLCB0aGlzIGlzCiAgICAgICAgLy8gbm90IHN1c2NlcHRpYmxlIHRvIGEgcmUtZW50cnkgYXR0YWNrIGJlY2F1c2UgdGhlIGF1Y3Rpb24gaXMKICAgICAgICAvLyByZW1vdmVkIGJlZm9yZSBhbnkgdHJhbnNmZXJzIG9jY3VyLgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKCiAgICAgICAgLy8gVGVsbCB0aGUgd29ybGQhCiAgICAgICAgU2FsZVN1Y2Nlc3NmdWwoX3Rva2VuSWQsIHByaWNlLCBtc2cuc2VuZGVyKTsKCiAgICAgICAgcmV0dXJuIHByaWNlOwogICAgfQp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8vLyBAdGl0bGUgTWFya2V0UGxhY2UgZm9yIG5vbi1mdW5naWJsZSB0b2tlbnMuCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgTWFya2V0UGxhY2UgaXMgUGF1c2FibGUsIE1hcmtldFBsYWNlQmFzZSB7CgoJLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IGF1Y3Rpb24gaW4gb3VyIHNldFNhbGVNYXJrZXRwbGFjZUFkZHJlc3MoKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNNYXJrZXRwbGFjZSA9IHRydWU7CgkKICAgIC8vLyBAZGV2IFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NQogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0gYnl0ZXM0KDB4OWEyMDQ4M2QpOwoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGNyZWF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIE5GVCBvd25lcnNoaXAgY29udHJhY3QKICAgIC8vLyAgYW5kIHZlcmlmaWVzIHRoZSBvd25lciBjdXQgaXMgaW4gdGhlIHZhbGlkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBfbmZ0QWRkcmVzcyAtIGFkZHJlc3Mgb2YgYSBkZXBsb3llZCBjb250cmFjdCBpbXBsZW1lbnRpbmcKICAgIC8vLyAgdGhlIE5vbmZ1bmdpYmxlIEludGVyZmFjZS4KICAgIC8vLyBAcGFyYW0gX2N1dCAtIHBlcmNlbnQgY3V0IHRoZSBvd25lciB0YWtlcyBvbiBlYWNoIHNhbGUsIG11c3QgYmUKICAgIC8vLyAgYmV0d2VlbiAwLTEwLDAwMC4KICAgIGZ1bmN0aW9uIE1hcmtldFBsYWNlKGFkZHJlc3MgX25mdEFkZHJlc3MsIHVpbnQyNTYgX2N1dCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9jdXQgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKCiAgICAgICAgRVJDNzIxIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRVJDNzIxKF9uZnRBZGRyZXNzKTsKICAgICAgICAvL3JlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3Quc3VwcG9ydHNJbnRlcmZhY2UoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KICAgIGZ1bmN0aW9uIHNldE5GVEFkZHJlc3MoYWRkcmVzcyBfbmZ0QWRkcmVzcywgdWludDI1NiBfY3V0KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX2N1dCA8PSAxMDAwMCk7CiAgICAgICAgb3duZXJDdXQgPSBfY3V0OwogICAgICAgIEVSQzcyMSBjYW5kaWRhdGVDb250cmFjdCA9IEVSQzcyMShfbmZ0QWRkcmVzcyk7CiAgICAgICAgLy9yZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0ID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CiAgICAvLy8gQGRldiBSZW1vdmUgYWxsIEV0aGVyIGZyb20gdGhlIGNvbnRyYWN0LCB3aGljaCBpcyB0aGUgb3duZXIncyBjdXRzCiAgICAvLy8gIGFzIHdlbGwgYXMgYW55IEV0aGVyIHNlbnQgZGlyZWN0bHkgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8gIEFsd2F5cyB0cmFuc2ZlcnMgdG8gdGhlIE5GVCBjb250cmFjdCwgYnV0IGNhbiBiZSBjYWxsZWQgZWl0aGVyIGJ5CiAgICAvLy8gIHRoZSBvd25lciBvciB0aGUgTkZUIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIGFkZHJlc3MgbmZ0QWRkcmVzcyA9IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCk7CgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICAvLyBXZSBhcmUgdXNpbmcgdGhpcyBib29sZWFuIG1ldGhvZCB0byBtYWtlIHN1cmUgdGhhdCBldmVuIGlmIG9uZSBmYWlscyBpdCB3aWxsIHN0aWxsIHdvcmsKICAgICAgICBib29sIHJlcyA9IG5mdEFkZHJlc3Muc2VuZCh0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYW5kIGJlZ2lucyBhIG5ldyBzYWxlLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHNhbGUsIHNlbmRlciBtdXN0IGJlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZVNhbGUoCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9wcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3ByaWNlKSkpOwogICAgICAgIAogICAgICAgIC8vcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIC8vX2VzY3Jvdyhtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpOwogICAgICAgIF9lc2Nyb3coX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIAogICAgICAgIFNhbGUgbWVtb3J5IHNhbGUgPSBTYWxlKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9wcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkU2FsZShfdG9rZW5JZCwgc2FsZSk7CiAgICB9CgoKICAgIAoKICAgIC8vLyBAZGV2IEJpZHMgb24gYSBzYWxlLCBjb21wbGV0aW5nIHRoZSBzYWxlIGFuZCB0cmFuc2ZlcnJpbmcKICAgIC8vLyAgb3duZXJzaGlwIG9mIHRoZSBORlQgaWYgZW5vdWdoIEV0aGVyIGlzIHN1cHBsaWVkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIGJpZCBvbi4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBfYmlkIHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBvciBmdW5kcyB0cmFuc2ZlciBmYWlscwogICAgICAgX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsgCiAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAKICAgIH0KCiAgICAvLy8gQGRldiBCaWRzIG9uIGEgc2FsZSwgY29tcGxldGluZyB0aGUgc2FsZSBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWRSZWZlcnJhbCh1aW50MjU2IF90b2tlbklkLHVpbnQyNTYgX2NvZGUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIF9iaWQgd2lsbCB0aHJvdyBpZiB0aGUgYmlkIG9yIGZ1bmRzIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgQWZmaWxpYXRlcyBzdG9yYWdlIGFmZmlsaWF0ZSA9IGNvZGVUb0FmZmlsaWF0ZVtfY29kZV07CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShhZmZpbGlhdGUuYWZmaWxpYXRlX2FkZHJlc3MhPTAmJl9jb2RlPjApOwogICAgICAgIF9iaWRSZWZlcnJhbChfdG9rZW5JZCwgbXNnLnZhbHVlLGFmZmlsaWF0ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKCiAgICAgICAKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBzYWxlIHRoYXQgaGFzbid0IGJlZW4gd29uIHlldC4KICAgIC8vLyAgUmV0dXJucyB0aGUgTkZUIHRvIG9yaWdpbmFsIG93bmVyLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBhIHN0YXRlLW1vZGlmeWluZyBmdW5jdGlvbiB0aGF0IGNhbgogICAgLy8vICBiZSBjYWxsZWQgd2hpbGUgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiBvbiBzYWxlCiAgICBmdW5jdGlvbiBjYW5jZWxTYWxlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBTYWxlIHN0b3JhZ2Ugc2FsZSA9IHRva2VuSWRUb1NhbGVbX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25TYWxlKHNhbGUpKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHNhbGUuc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxTYWxlKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYSBzYWxlIHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyAgT25seSB0aGUgb3duZXIgbWF5IGRvIHRoaXMsIGFuZCBORlRzIGFyZSByZXR1cm5lZCB0bwogICAgLy8vICB0aGUgc2VsbGVyLiBUaGlzIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gZW1lcmdlbmNpZXMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIE5GVCBvbiBzYWxlIHRvIGNhbmNlbC4KICAgIGZ1bmN0aW9uIGNhbmNlbFNhbGVXaGVuUGF1c2VkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgd2hlblBhdXNlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgU2FsZSBzdG9yYWdlIHNhbGUgPSB0b2tlbklkVG9TYWxlW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uU2FsZShzYWxlKSk7CiAgICAgICAgX2NhbmNlbFNhbGUoX3Rva2VuSWQsIHNhbGUuc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHNhbGUgaW5mbyBmb3IgYW4gTkZUIG9uIHNhbGUuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgTkZUIG9uIHNhbGUuCiAgICBmdW5jdGlvbiBnZXRTYWxlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucwogICAgKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQyNTYgcHJpY2UsCiAgICAgICAgdWludDI1NiBzdGFydGVkQXQKICAgICkgewogICAgICAgIFNhbGUgc3RvcmFnZSBzYWxlID0gdG9rZW5JZFRvU2FsZVtfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPblNhbGUoc2FsZSkpOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIHNhbGUuc2VsbGVyLAogICAgICAgICAgICBzYWxlLnByaWNlLAogICAgICAgICAgICBzYWxlLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhIHNhbGUuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIHRva2VuIHByaWNlIHdlIGFyZSBjaGVja2luZy4KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgU2FsZSBzdG9yYWdlIHNhbGUgPSB0b2tlbklkVG9TYWxlW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uU2FsZShzYWxlKSk7CiAgICAgICAgcmV0dXJuIHNhbGUucHJpY2U7CiAgICB9CgoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYW5kIGJlZ2lucyBhIG5ldyBzYWxlLgogICAgLy8vIEBwYXJhbSBfY29kZSAtIElEIG9mIHRva2VuIHRvIHNhbGUsIHNlbmRlciBtdXN0IGJlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfY29tbWlzc2lvbiAtIHBlcmNlbnRhZ2Ugb2YgY29tbWlzc2lvbiBmb3IgYWZmaWxpYXRlCiAgICAvLy8gQHBhcmFtIF9wcmljZWN1dCAtIHBlcmNlbnRhZ2Ugb2Ygc2VsbCBwcmljZSBjdXQgZm9yIGJ1eWVyCiAgICAvLy8gQHBhcmFtIF9hZmZpbGlhdGVfYWRkcmVzcyAtIGFmZmlsaWF0ZSBhZGRyZXNzIAogICAgZnVuY3Rpb24gY3JlYXRlQWZmaWxpYXRlKAogICAgICAgIHVpbnQyNTYgX2NvZGUsCiAgICAgICAgdWludDY0ICBfY29tbWlzc2lvbiwKICAgICAgICB1aW50NjQgIF9wcmljZWN1dCwKICAgICAgICBhZGRyZXNzIF9hZmZpbGlhdGVfYWRkcmVzcwogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CgogICAgICAgIEFmZmlsaWF0ZXMgbWVtb3J5IGFmZmlsaWF0ZSA9IEFmZmlsaWF0ZXMoCiAgICAgICAgICAgIGFkZHJlc3MoX2FmZmlsaWF0ZV9hZGRyZXNzKSwKICAgICAgICAgICAgdWludDY0KF9jb21taXNzaW9uKSwKICAgICAgICAgICAgdWludDY0KF9wcmljZWN1dCkKICAgICAgICApOwogICAgICAgIF9hZGRBZmZpbGlhdGUoX2NvZGUsIGFmZmlsaWF0ZSk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFJldHVybnMgYWZmaWxpYXRlIGluZm8gZm9yIGFuIGFmZmlsaWF0ZSBjb2RlLgogICAgLy8vIEBwYXJhbSBfY29kZSAtIGNvZGUgZm9yIGFuIGFmZmlsaWF0ZS4KICAgIGZ1bmN0aW9uIGdldEFmZmlsaWF0ZSh1aW50MjU2IF9jb2RlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMKICAgICgKICAgICAgICAgYWRkcmVzcyBhZmZpbGlhdGVfYWRkcmVzcywKICAgICAgICAgdWludDY0IGNvbW1pc3Npb24sCiAgICAgICAgIHVpbnQ2NCBwcmljZWN1dAogICAgKSB7CiAgICAgICAgQWZmaWxpYXRlcyBzdG9yYWdlIGFmZmlsaWF0ZSA9IGNvZGVUb0FmZmlsaWF0ZVtfY29kZV07CiAgICAgICAgCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYWZmaWxpYXRlLmFmZmlsaWF0ZV9hZGRyZXNzLAogICAgICAgICAgICBhZmZpbGlhdGUuY29tbWlzc2lvbiwKICAgICAgICAgICAgYWZmaWxpYXRlLnByaWNlY3V0CiAgICAgICAgKTsKICAgIH0KICAgICAvLy8gQGRldiBSZW1vdmVzIGFmZmlsaWF0ZS4KICAgIC8vLyAgT25seSB0aGUgb3duZXIgbWF5IGRvIHRoaXMKICAgIC8vLyBAcGFyYW0gX2NvZGUgLSBjb2RlIGZvciBhbiBhZmZpbGlhdGUuCiAgICBmdW5jdGlvbiByZW1vdmVBZmZpbGlhdGUodWludDI1NiBfY29kZSkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIF9yZW1vdmVBZmZpbGlhdGUoX2NvZGUpOyAKICAgICAgICAKICAgIH0KfQoKCi8vLyBAdGl0bGUgU2VydmljZVN0YXRpb25CYXNlIGNvcmUKLy8vIEBkZXYgQ29udGFpbnMgbW9kZWxzLCB2YXJpYWJsZXMsIGFuZCBpbnRlcm5hbCBtZXRob2RzIGZvciB0aGUgU2VydmljZVN0YXRpb24uCmNvbnRyYWN0IFNlcnZpY2VTdGF0aW9uQmFzZSB7CgogICAgLy8gUmVmZXJlbmNlIHRvIGNvbnRyYWN0IHRyYWNraW5nIE5GVCBvd25lcnNoaXAKICAgIEVSQzcyMSBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCiAgICBzdHJ1Y3QgVHVuZXsKICAgICAgICB1aW50MjU2IHN0YXJ0Q2hhbmdlOwogICAgICAgIHVpbnQyNTYgcmFuZ2VDaGFuZ2U7CiAgICAgICAgdWludDI1NiBhdHRDaGFuZ2U7CiAgICAgICAgYm9vbCBwbHVzTWludXM7CiAgICAgICAgYm9vbCByZXBsYWNlOwogICAgICAgIHVpbnQxMjggcHJpY2U7CiAgICAgICAgYm9vbCBhY3RpdmU7CiAgICAgICAgdWludDY0IG1vZGVsOwogICAgfQogICAgVHVuZVtdIG9wdGlvbnM7CiAgICAKICAgCiAgICAKICAgIC8vLyBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgY2xhaW1hbnQgb3ducyB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCAtIEFkZHJlc3MgY2xhaW1pbmcgdG8gb3duIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB3aG9zZSBvd25lcnNoaXAgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm9uRnVuZ2libGVDb250cmFjdC5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQpOwogICAgfQogIAogICAgLy8vIEBkZXYgQ2FsbHMgdGhlIE5GVCBDb250cmFjdCB3aXRoIHRoZSB0dW5lZCBhdHRyaWJ1dGVzIAogICAgZnVuY3Rpb24gX3R1bmUodWludDI1NiBfbmV3YXR0cmlidXRlcywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgbm9uRnVuZ2libGVDb250cmFjdC50dW5lTGFtYm8oX25ld2F0dHJpYnV0ZXMsIF90b2tlbklkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NoYW5nZUF0dHJpYnV0ZXModWludDI1NiBfdG9rZW5JZCx1aW50MjU2IF9vcHRpb25JbmRleCkgaW50ZXJuYWwgewogICAgCiAgICAvL0dldCBtb2RlbCBmcm9tIHRva2VuCiAgICB1aW50NjQgbW9kZWwgPSBub25GdW5naWJsZUNvbnRyYWN0LmdldExhbWJvTW9kZWwoX3Rva2VuSWQpOwogICAgLy90aHJvdyBpZiB0dW5lIG9wdGlvbiBpcyBub3QgbWFkZSBmb3IgbW9kZWwKICAgIHJlcXVpcmUob3B0aW9uc1tfb3B0aW9uSW5kZXhdLm1vZGVsPT1tb2RlbCk7CiAgICAKICAgIC8vR2V0IG9yaWdpbmFsIGF0dHJpYnV0ZXMKICAgIHVpbnQyNTYgYXR0cmlidXRlcyA9IG5vbkZ1bmdpYmxlQ29udHJhY3QuZ2V0TGFtYm9BdHRyaWJ1dGVzKF90b2tlbklkKTsKICAgIHVpbnQyNTYgcGFydD0wOwogICAgCiAgICAvL0Rpc3NlY3QgZm9yIG9wdGlvbnMKICAgIHBhcnQ9KGF0dHJpYnV0ZXMvKDEwICoqIG9wdGlvbnNbX29wdGlvbkluZGV4XS5zdGFydENoYW5nZSkpICUgKDEwICoqIG9wdGlvbnNbX29wdGlvbkluZGV4XS5yYW5nZUNoYW5nZSk7CiAgICAvL3BhcnQ9MTU0NDsKICAgIC8vQ2hhbmdlIGF0dHJpYnV0ZXMgJiB2ZXJpZnkKICAgIC8vU2hvdWxkIGF0dENoYW5nZSBiZSBhZGRlZCxzdWJ0cmFjdGVkIG9yIHJlcGxhY2VkPwogICAgaWYob3B0aW9uc1tfb3B0aW9uSW5kZXhdLnJlcGxhY2UgPT0gZmFsc2UpCiAgICAgICAgewogICAgICAgICAgICAKICAgICAgICAgICAgLy9jaGFuZ2Ugc2hvdWxkIGJlIGFkZGVkCiAgICAgICAgICAgIGlmKG9wdGlvbnNbX29wdGlvbkluZGV4XS5wbHVzTWludXMgPT0gZmFsc2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vZS5nLiBpZiByYW5nZSA9IDQgdGhlbiB2YWx1ZSBjYW4gbm90IGJlIGhpZ2hlciB0aGVuIDk5OTkgLSBvdmVyZmxvdyBjaGVjawogICAgICAgICAgICAgICAgcmVxdWlyZSgocGFydCtvcHRpb25zW19vcHRpb25JbmRleF0uYXR0Q2hhbmdlKTwoMTAqKm9wdGlvbnNbX29wdGlvbkluZGV4XS5yYW5nZUNoYW5nZSkpOwogICAgICAgICAgICAgICAgLy9hZGQgdG8gYXR0cmlidXRlcwogICAgICAgICAgICAgICAgYXR0cmlidXRlcz1hdHRyaWJ1dGVzK29wdGlvbnNbX29wdGlvbkluZGV4XS5hdHRDaGFuZ2UqKDEwICoqIG9wdGlvbnNbX29wdGlvbkluZGV4XS5zdGFydENoYW5nZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIC8vZG8gc29tZSBzdWJ0cmFjdGlvbgogICAgICAgICAgICAgICAgLy9lLmcuIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGVuIDAKICAgICAgICAgICAgICAgIHJlcXVpcmUocGFydD5vcHRpb25zW19vcHRpb25JbmRleF0uYXR0Q2hhbmdlKTsKICAgICAgICAgICAgICAgIC8vc3Vic3RyYWN0IGZyb20gYXR0cmlidXRlcyAKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMtPW9wdGlvbnNbX29wdGlvbkluZGV4XS5hdHRDaGFuZ2UqKDEwICoqIG9wdGlvbnNbX29wdGlvbkluZGV4XS5zdGFydENoYW5nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvL2RvIHNvbWUgcmVwbGFjaW5nCiAgICAgICAgICAgIGF0dHJpYnV0ZXM9YXR0cmlidXRlcy1wYXJ0KigxMCAqKiBvcHRpb25zW19vcHRpb25JbmRleF0uc3RhcnRDaGFuZ2UpOwogICAgICAgICAgICBhdHRyaWJ1dGVzKz1vcHRpb25zW19vcHRpb25JbmRleF0uYXR0Q2hhbmdlKigxMCAqKiBvcHRpb25zW19vcHRpb25JbmRleF0uc3RhcnRDaGFuZ2UpOwogICAgICAgIH0KICAgIAogIAogICAKICAgIC8vVHVuZSBMYW1ibyBpbiBORlQgY29udHJhY3QKICAgIF90dW5lKHVpbnQyNTYoYXR0cmlidXRlcyksIF90b2tlbklkKTsKICAgICAgIAogICAgICAgIAogICAgfQogICAgCiAgICAKfQoKCi8vLyBAdGl0bGUgU2VydmljZVN0YXRpb24gZm9yIG5vbi1mdW5naWJsZSB0b2tlbnMuCmNvbnRyYWN0IFNlcnZpY2VTdGF0aW9uIGlzIFBhdXNhYmxlLCBTZXJ2aWNlU3RhdGlvbkJhc2UgewoKCS8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUgcmlnaHQgY2FsbC4KICAgIGJvb2wgcHVibGljIGlzU2VydmljZXN0YXRpb24gPSB0cnVlOwoJCiAgICAvLy8gQGRldiBUaGUgRVJDLTE2NSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkMtNzIxLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUKICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCiAgICB1aW50MjU2IHB1YmxpYyBvcHRpb25Db3VudDsKICAgIG1hcHBpbmcgKHVpbnQ2NCA9PiB1aW50MjU2KSBwdWJsaWMgbW9kZWxJbmRleFRvT3B0aW9uQ291bnQ7CiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciBjcmVhdGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gIGFuZCB2ZXJpZmllcyB0aGUgb3duZXIgY3V0IGlzIGluIHRoZSB2YWxpZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gX25mdEFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nCiAgICAvLy8gIHRoZSBOb25mdW5naWJsZSBJbnRlcmZhY2UuCiAgICBmdW5jdGlvbiBTZXJ2aWNlU3RhdGlvbihhZGRyZXNzIF9uZnRBZGRyZXNzKSBwdWJsaWMgewoKICAgICAgICBFUkM3MjEgY2FuZGlkYXRlQ29udHJhY3QgPSBFUkM3MjEoX25mdEFkZHJlc3MpOwogICAgICAgIC8vcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5zdXBwb3J0c0ludGVyZmFjZShJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgICAgIF9uZXdUdW5lT3B0aW9uKDAsMCwwLGZhbHNlLGZhbHNlLDAsMCk7CiAgICAgICAgCiAgICB9CiAgICBmdW5jdGlvbiBzZXRORlRBZGRyZXNzKGFkZHJlc3MgX25mdEFkZHJlc3MpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgCiAgICAgICAgRVJDNzIxIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRVJDNzIxKF9uZnRBZGRyZXNzKTsKICAgICAgICAvL3JlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3Quc3VwcG9ydHNJbnRlcmZhY2UoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbmV3VHVuZU9wdGlvbigKICAgICAgICB1aW50MzIgX3N0YXJ0Q2hhbmdlLAogICAgICAgIHVpbnQzMiBfcmFuZ2VDaGFuZ2UsCiAgICAgICAgdWludDI1NiBfYXR0Q2hhbmdlLAogICAgICAgIGJvb2wgX3BsdXNNaW51cywKICAgICAgICBib29sIF9yZXBsYWNlLAogICAgICAgIHVpbnQxMjggX3ByaWNlLAogICAgICAgIHVpbnQ2NCBfbW9kZWwKICAgICAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB7CiAgICAgICAgICAgLy9Pbmx5IGFsbG93IG93bmVyIHRvIGFkZCBuZXcgb3B0aW9ucwogICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciApOyAKICAgICAgICAgICBvcHRpb25Db3VudCsrOwogICAgICAgICAgIG1vZGVsSW5kZXhUb09wdGlvbkNvdW50W19tb2RlbF0rKzsKICAgICAgICAgICBfbmV3VHVuZU9wdGlvbihfc3RhcnRDaGFuZ2UsX3JhbmdlQ2hhbmdlLF9hdHRDaGFuZ2UsX3BsdXNNaW51cywgX3JlcGxhY2UsX3ByaWNlLF9tb2RlbCk7CiAgICAgICAKICAgICAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VUdW5lT3B0aW9uKAogICAgICAgIHVpbnQzMiBfc3RhcnRDaGFuZ2UsCiAgICAgICAgdWludDMyIF9yYW5nZUNoYW5nZSwKICAgICAgICB1aW50MjU2IF9hdHRDaGFuZ2UsCiAgICAgICAgYm9vbCBfcGx1c01pbnVzLAogICAgICAgIGJvb2wgX3JlcGxhY2UsCiAgICAgICAgdWludDEyOCBfcHJpY2UsCiAgICAgICAgYm9vbCBfaXNhY3RpdmUsCiAgICAgICAgdWludDY0IF9tb2RlbCwKICAgICAgICB1aW50MjU2IF9vcHRpb25JbmRleAogICAgICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHsKICAgICAgICAgICAvL09ubHkgYWxsb3cgb3duZXIgdG8gYWRkIG5ldyBvcHRpb25zCiAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyICk7IAogICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgIF9jaGFuZ2VUdW5lT3B0aW9uKF9zdGFydENoYW5nZSxfcmFuZ2VDaGFuZ2UsX2F0dENoYW5nZSxfcGx1c01pbnVzLCBfcmVwbGFjZSxfcHJpY2UsX2lzYWN0aXZlLF9tb2RlbCxfb3B0aW9uSW5kZXgpOwogICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgZnVuY3Rpb24gX25ld1R1bmVPcHRpb24oIHVpbnQzMiBfc3RhcnRDaGFuZ2UsCiAgICAgICAgdWludDMyIF9yYW5nZUNoYW5nZSwKICAgICAgICB1aW50MjU2IF9hdHRDaGFuZ2UsCiAgICAgICAgYm9vbCBfcGx1c01pbnVzLAogICAgICAgIGJvb2wgX3JlcGxhY2UsCiAgICAgICAgdWludDEyOCBfcHJpY2UsCiAgICAgICAgdWludDY0IF9tb2RlbAogICAgICAgICkgCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB7CiAgICAgICAgCiAgICAgICAgICAgVHVuZSBtZW1vcnkgX29wdGlvbiA9IFR1bmUoewogICAgICAgICAgICBzdGFydENoYW5nZTogX3N0YXJ0Q2hhbmdlLAogICAgICAgICAgICByYW5nZUNoYW5nZTogX3JhbmdlQ2hhbmdlLAogICAgICAgICAgICBhdHRDaGFuZ2U6IF9hdHRDaGFuZ2UsCiAgICAgICAgICAgIHBsdXNNaW51czogX3BsdXNNaW51cywKICAgICAgICAgICAgcmVwbGFjZTogX3JlcGxhY2UsCiAgICAgICAgICAgIHByaWNlOiBfcHJpY2UsCiAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICAgICAgbW9kZWw6IF9tb2RlbAogICAgICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBvcHRpb25zLnB1c2goX29wdGlvbik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jaGFuZ2VUdW5lT3B0aW9uKCB1aW50MzIgX3N0YXJ0Q2hhbmdlLAogICAgICAgIHVpbnQzMiBfcmFuZ2VDaGFuZ2UsCiAgICAgICAgdWludDI1NiBfYXR0Q2hhbmdlLAogICAgICAgIGJvb2wgX3BsdXNNaW51cywKICAgICAgICBib29sIF9yZXBsYWNlLAogICAgICAgIHVpbnQxMjggX3ByaWNlLAogICAgICAgIGJvb2wgX2lzYWN0aXZlLAogICAgICAgIHVpbnQ2NCBfbW9kZWwsCiAgICAgICAgdWludDI1NiBfb3B0aW9uSW5kZXgKICAgICAgICApIAogICAgICAgIGludGVybmFsCiAgICAgICAgewogICAgICAgIAogICAgICAgICAgIFR1bmUgbWVtb3J5IF9vcHRpb24gPSBUdW5lKHsKICAgICAgICAgICAgc3RhcnRDaGFuZ2U6IF9zdGFydENoYW5nZSwKICAgICAgICAgICAgcmFuZ2VDaGFuZ2U6IF9yYW5nZUNoYW5nZSwKICAgICAgICAgICAgYXR0Q2hhbmdlOiBfYXR0Q2hhbmdlLAogICAgICAgICAgICBwbHVzTWludXM6IF9wbHVzTWludXMsCiAgICAgICAgICAgIHJlcGxhY2U6IF9yZXBsYWNlLAogICAgICAgICAgICBwcmljZTogX3ByaWNlLAogICAgICAgICAgICBhY3RpdmU6IF9pc2FjdGl2ZSwKICAgICAgICAgICAgbW9kZWw6IF9tb2RlbAogICAgICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBvcHRpb25zW19vcHRpb25JbmRleF09X29wdGlvbjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZGlzYWJsZVR1bmVPcHRpb24odWludDI1NiBpbmRleCkgZXh0ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgKTsgCiAgICAgICAgb3B0aW9uc1tpbmRleF0uYWN0aXZlPWZhbHNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBlbmFibGVUdW5lT3B0aW9uKHVpbnQyNTYgaW5kZXgpIGV4dGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyICk7IAogICAgICAgIG9wdGlvbnNbaW5kZXhdLmFjdGl2ZT10cnVlOwogICAgfQogICAgZnVuY3Rpb24gZ2V0T3B0aW9uKHVpbnQyNTYgX2luZGV4KSAKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKAogICAgICAgIHVpbnQyNTYgX3N0YXJ0Q2hhbmdlLAogICAgICAgIHVpbnQyNTYgX3JhbmdlQ2hhbmdlLAogICAgICAgIHVpbnQyNTYgX2F0dENoYW5nZSwKICAgICAgICBib29sIF9wbHVzTWludXMsCiAgICAgICAgdWludDEyOCBfcHJpY2UsCiAgICAgICAgYm9vbCBhY3RpdmUsCiAgICAgICAgdWludDY0IG1vZGVsCiAgICApIAogICAgewogICAgICAKICAgICAgICAvL3JlcXVpcmUob3B0aW9uc1tfaW5kZXhdLmFjdGl2ZSk7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgb3B0aW9uc1tfaW5kZXhdLnN0YXJ0Q2hhbmdlLAogICAgICAgICAgICBvcHRpb25zW19pbmRleF0ucmFuZ2VDaGFuZ2UsCiAgICAgICAgICAgIG9wdGlvbnNbX2luZGV4XS5hdHRDaGFuZ2UsCiAgICAgICAgICAgIG9wdGlvbnNbX2luZGV4XS5wbHVzTWludXMsCiAgICAgICAgICAgIG9wdGlvbnNbX2luZGV4XS5wcmljZSwKICAgICAgICAgICAgb3B0aW9uc1tfaW5kZXhdLmFjdGl2ZSwKICAgICAgICAgICAgb3B0aW9uc1tfaW5kZXhdLm1vZGVsCiAgICAgICAgKTsgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRPcHRpb25Db3VudCgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfb3B0aW9uQ291bnQpCiAgICAgICAgewogICAgICAgIHJldHVybiBvcHRpb25Db3VudDsgICAgCiAgICAgICAgfQogICAgCiAgICBmdW5jdGlvbiB0dW5lTGFtYm8odWludDI1NiBfdG9rZW5JZCx1aW50MjU2IF9vcHRpb25JbmRleCkgZXh0ZXJuYWwgcGF5YWJsZQogICAgewogICAgICAgLy9DYWxsZXIgbmVlZHMgdG8gb3duIExhbWJvCiAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7IAogICAgICAgLy9UdW5pbmcgT3B0aW9uIG5lZWRzIHRvIGJlIGVuYWJsZWQKICAgICAgIHJlcXVpcmUob3B0aW9uc1tfb3B0aW9uSW5kZXhdLmFjdGl2ZSk7CiAgICAgICAvL0Vub3VnaCBtb25leSBmb3IgdHVuaW5nIHRvIHNwZW5kPwogICAgICAgcmVxdWlyZShtc2cudmFsdWU+PW9wdGlvbnNbX29wdGlvbkluZGV4XS5wcmljZSk7CiAgICAgICAKICAgICAgIF9jaGFuZ2VBdHRyaWJ1dGVzKF90b2tlbklkLF9vcHRpb25JbmRleCk7CiAgICB9CiAgICAvLy8gQGRldiBSZW1vdmUgYWxsIEV0aGVyIGZyb20gdGhlIGNvbnRyYWN0LCB3aGljaCBpcyB0aGUgb3duZXIncyBjdXRzCiAgICAvLy8gIGFzIHdlbGwgYXMgYW55IEV0aGVyIHNlbnQgZGlyZWN0bHkgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8gIEFsd2F5cyB0cmFuc2ZlcnMgdG8gdGhlIE5GVCBjb250cmFjdCwgYnV0IGNhbiBiZSBjYWxsZWQgZWl0aGVyIGJ5CiAgICAvLy8gIHRoZSBvd25lciBvciB0aGUgTkZUIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIGFkZHJlc3MgbmZ0QWRkcmVzcyA9IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCk7CgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICAvLyBXZSBhcmUgdXNpbmcgdGhpcyBib29sZWFuIG1ldGhvZCB0byBtYWtlIHN1cmUgdGhhdCBldmVuIGlmIG9uZSBmYWlscyBpdCB3aWxsIHN0aWxsIHdvcmsKICAgICAgICBib29sIHJlcyA9IG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRPcHRpb25zRm9yTW9kZWwodWludDY0IF9tb2RlbCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBfb3B0aW9uc01vZGVsKSB7CiAgICAgICAgLy91aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICAgICAgLy9pZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgIC8vICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIC8vfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKG1vZGVsSW5kZXhUb09wdGlvbkNvdW50W19tb2RlbF0pOwogICAgICAgICAgICAvL3VpbnQyNTYgdG90YWxDYXJzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICAvLyBXZSBjb3VudCBvbiB0aGUgZmFjdCB0aGF0IGFsbCBjYXJzIGhhdmUgSURzIHN0YXJ0aW5nIGF0IDAgYW5kIGluY3JlYXNpbmcKICAgICAgICAgICAgLy8gc2VxdWVudGlhbGx5IHVwIHRvIHRoZSBvcHRpb25Db3VudCBjb3VudC4KICAgICAgICAgICAgdWludDI1NiBvcHRpb25JZDsKCiAgICAgICAgICAgIGZvciAob3B0aW9uSWQgPSAxOyBvcHRpb25JZCA8PSBvcHRpb25Db3VudDsgb3B0aW9uSWQrKykgewogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnNbb3B0aW9uSWRdLm1vZGVsID09IF9tb2RlbCAmJiBvcHRpb25zW29wdGlvbklkXS5hY3RpdmUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBvcHRpb25JZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgLy8gfQogICAgfQoKfQoKCgovLy8vTm8gU2lyaW5nQ2xvY2tBdWN0aW9uIG5lZWRlZCBmb3IgTGFtYm9zCi8vLy9ObyBzZXBhcmF0ZSBtb2RpZmljYXRpb24gZm9yIFNhbGVDb250cmFjdCBuZWVkZWQKCi8vLyBAdGl0bGUgSGFuZGxlcyBjcmVhdGluZyBzYWxlcyBmb3Igc2FsZSBvZiBsYW1ib3MuCi8vLyAgVGhpcyB3cmFwcGVyIG9mIFJldmVyc2VTYWxlIGV4aXN0cyBvbmx5IHNvIHRoYXQgdXNlcnMgY2FuIGNyZWF0ZQovLy8gIHNhbGVzIHdpdGggb25seSBvbmUgdHJhbnNhY3Rpb24uCmNvbnRyYWN0IEV0aGVyTGFtYm9zU2FsZSBpcyBFdGhlckxhbWJvc093bmVyc2hpcCB7CgogICAgLy8gQG5vdGljZSBUaGUgc2FsZSBjb250cmFjdCB2YXJpYWJsZXMgYXJlIGRlZmluZWQgaW4gRXRoZXJMYW1ib3NCYXNlIHRvIGFsbG93CiAgICAvLyAgdXMgdG8gcmVmZXIgdG8gdGhlbSBpbiBFdGhlckxhbWJvc093bmVyc2hpcCB0byBwcmV2ZW50IGFjY2lkZW50YWwgdHJhbnNmZXJzLgogICAgLy8gYHNhbGVNYXJrZXRwbGFjZWAgcmVmZXJzIHRvIHRoZSBhdWN0aW9uIGZvciBwMnAgc2FsZSBvZiBjYXJzLgogICAKCiAgICAvLy8gQGRldiBTZXRzIHRoZSByZWZlcmVuY2UgdG8gdGhlIHNhbGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgLSBBZGRyZXNzIG9mIHNhbGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRNYXJrZXRwbGFjZUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgTWFya2V0UGxhY2UgY2FuZGlkYXRlQ29udHJhY3QgPSBNYXJrZXRQbGFjZShfYWRkcmVzcyk7CgogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzTWFya2V0cGxhY2UoKSk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBtYXJrZXRQbGFjZSA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKCiAgICAvLy8gQGRldiBQdXQgYSBsYW1ibyB1cCBmb3Igc2FsZS4KICAgIC8vLyAgRG9lcyBzb21lIG93bmVyc2hpcCB0cmlja2VyeSB0byBjcmVhdGUgYXVjdGlvbnMgaW4gb25lIHR4LgogICAgZnVuY3Rpb24gY3JlYXRlTGFtYm9TYWxlKAogICAgICAgIHVpbnQyNTYgX2NhcklkLAogICAgICAgIHVpbnQyNTYgX3ByaWNlCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FsZSBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBsYW1ibyBpcyBhbHJlYWR5IG9uIGFueSBzYWxlLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIHNhbGUgY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfY2FySWQpKTsKICAgICAgICAKICAgICAgICBfYXBwcm92ZShfY2FySWQsIG1hcmtldFBsYWNlKTsKICAgICAgICAvLyBTYWxlIHRocm93cyBpZiBpbnB1dHMgYXJlIGludmFsaWQgYW5kIGNsZWFycwogICAgICAgIC8vIHRyYW5zZmVyIGFmdGVyIGVzY3Jvd2luZyB0aGUgbGFtYm8uCiAgICAgICAgbWFya2V0UGxhY2UuY3JlYXRlU2FsZSgKICAgICAgICAgICAgX2NhcklkLAogICAgICAgICAgICBfcHJpY2UsCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIGJ1bGtDcmVhdGVMYW1ib1NhbGUoCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDI1NiBfdG9rZW5JZFN0YXJ0LAogICAgICAgIHVpbnQyNTYgX3Rva2VuQ291bnQKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlDT08KICAgIHsKICAgICAgICAvLyBTYWxlIGNvbnRyYWN0IGNoZWNrcyBpbnB1dCBzaXplcwogICAgICAgIC8vIElmIGxhbWJvIGlzIGFscmVhZHkgb24gYW55IHNhbGUsIHRoaXMgd2lsbCB0aHJvdwogICAgICAgIC8vIGJlY2F1c2UgaXQgd2lsbCBiZSBvd25lZCBieSB0aGUgc2FsZSBjb250cmFjdC4KICAgICAgICBmb3IodWludDI1NiBpPTA7aTxfdG9rZW5Db3VudDtpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZFN0YXJ0K2kpKTsKICAgICAgICAKICAgICAgICAgICAgX2FwcHJvdmUoX3Rva2VuSWRTdGFydCtpLCBtYXJrZXRQbGFjZSk7CiAgICAgICAgICAgIC8vIFNhbGUgdGhyb3dzIGlmIGlucHV0cyBhcmUgaW52YWxpZCBhbmQgY2xlYXJzCiAgICAgICAgICAgIC8vIHRyYW5zZmVyIGFmdGVyIGVzY3Jvd2luZyB0aGUgbGFtYm8uCiAgICAgICAgICAgIG1hcmtldFBsYWNlLmNyZWF0ZVNhbGUoCiAgICAgICAgICAgICAgICBfdG9rZW5JZFN0YXJ0K2ksCiAgICAgICAgICAgICAgICBfcHJpY2UsCiAgICAgICAgICAgICBtc2cuc2VuZGVyCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHRoZSBiYWxhbmNlIG9mIHRoZSBtYXJrZXRQbGFjZSBjb250cmFjdAogICAgLy8vIHRvIHRoZSBFdGhlckxhbWJvc0NvcmUgY29udHJhY3QuIFdlIHVzZSB0d28tc3RlcCB3aXRoZHJhd2FsIHRvCiAgICAvLy8gcHJldmVudCB0d28gdHJhbnNmZXIgY2FsbHMgaW4gdGhlIGF1Y3Rpb24gYmlkIGZ1bmN0aW9uLgogICAgZnVuY3Rpb24gd2l0aGRyYXdTYWxlQmFsYW5jZXMoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKICAgICAgICBtYXJrZXRQbGFjZS53aXRoZHJhd0JhbGFuY2UoKTsKICAgICAgICAKICAgIH0KfQoKLy8vIEB0aXRsZSBhbGwgZnVuY3Rpb25zIHJlbGF0ZWQgdG8gY3JlYXRpbmcgbGFtYm9zCmNvbnRyYWN0IEV0aGVyTGFtYm9zQnVpbGRpbmcgaXMgRXRoZXJMYW1ib3NTYWxlIHsKCiAgICAvLyBMaW1pdHMgdGhlIG51bWJlciBvZiBjYXJzIHRoZSBjb250cmFjdCBvd25lciBjYW4gZXZlciBjcmVhdGUuCiAgICAvL3VpbnQyNTYgcHVibGljIGNvbnN0YW50IFBST01PX0NSRUFUSU9OX0xJTUlUID0gNTAwMDsKICAgIC8vdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9DUkVBVElPTl9MSU1JVCA9IDQ1MDAwOwoKCiAgICAvLyBDb3VudHMgdGhlIG51bWJlciBvZiBjYXJzIHRoZSBjb250cmFjdCBvd25lciBoYXMgY3JlYXRlZC4KICAgIHVpbnQyNTYgcHVibGljIGxhbWJvc0J1aWxkQ291bnQ7CgoKICAgIC8vLyBAZGV2IHdlIGNhbiBidWlsZCBsYW1ib3MuIE9ubHkgY2FsbGFibGUgYnkgQ09PCiAgICAvLy8gQHBhcmFtIF9hdHRyaWJ1dGVzIHRoZSBlbmNvZGVkIGF0dHJpYnV0ZXMgb2YgdGhlIGxhbWJvIHRvIGJlIGNyZWF0ZWQsIGFueSB2YWx1ZSBpcyBhY2NlcHRlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgdGhlIGZ1dHVyZSBvd25lciBvZiB0aGUgY3JlYXRlZCBsYW1iby4gRGVmYXVsdCB0byBjb250cmFjdCBDT08KICAgIC8vLyBAcGFyYW0gX21vZGVsIHRoZSBtb2RlbCBvZiB0aGUgY3JlYXRlZCBsYW1iby4gCiAgICBmdW5jdGlvbiBjcmVhdGVMYW1ibyh1aW50MjU2IF9hdHRyaWJ1dGVzLCBhZGRyZXNzIF9vd25lciwgdWludDY0IF9tb2RlbCkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYWRkcmVzcyBsYW1ib093bmVyID0gX293bmVyOwogICAgICAgIGlmIChsYW1ib093bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgIGxhbWJvT3duZXIgPSBjb29BZGRyZXNzOwogICAgICAgIH0KICAgICAgICAvL3JlcXVpcmUocHJvbW9DcmVhdGVkQ291bnQgPCBQUk9NT19DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIGxhbWJvc0J1aWxkQ291bnQrKzsKICAgICAgICBfY3JlYXRlTGFtYm8oX2F0dHJpYnV0ZXMsIGxhbWJvT3duZXIsIF9tb2RlbCk7CiAgICB9CgogICAgZnVuY3Rpb24gYnVsa0NyZWF0ZUxhbWJvKHVpbnQyNTYgX2F0dHJpYnV0ZXMsIGFkZHJlc3MgX293bmVyLCB1aW50NjQgX21vZGVsLHVpbnQyNTYgY291bnQsIHVpbnQyNTYgc3RhcnRObykgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYWRkcmVzcyBsYW1ib093bmVyID0gX293bmVyOwogICAgICAgIHVpbnQyNTYgYXR0PV9hdHRyaWJ1dGVzOwogICAgICAgIGlmIChsYW1ib093bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgIGxhbWJvT3duZXIgPSBjb29BZGRyZXNzOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvL2RvIHNvbWUgcmVwbGFjaW5nCiAgICAgICAgICAgIC8vX2F0dHJpYnV0ZXM9X2F0dHJpYnV0ZXMtcGFydCooMTAgKiogNjYpOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vcmVxdWlyZShwcm9tb0NyZWF0ZWRDb3VudCA8IFBST01PX0NSRUFUSU9OX0xJTUlUKTsKICAgICAgICBmb3IodWludDI1NiBpPTA7aTxjb3VudDtpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgbGFtYm9zQnVpbGRDb3VudCsrOwogICAgICAgICAgICBhdHQ9X2F0dHJpYnV0ZXMrKHN0YXJ0Tm8raSkqKDEwICoqIDY2KTsKICAgICAgICAgICAgX2NyZWF0ZUxhbWJvKGF0dCwgbGFtYm9Pd25lciwgX21vZGVsKTsKICAgICAgICAgICAgfQogICAgfQp9CgovLy8gQHRpdGxlIGFsbCBmdW5jdGlvbnMgcmVsYXRlZCB0byB0dW5pbmcgbGFtYm9zCmNvbnRyYWN0IEV0aGVyTGFtYm9zVHVuaW5nIGlzIEV0aGVyTGFtYm9zQnVpbGRpbmcgewoKICAgIC8vIENvdW50cyB0aGUgbnVtYmVyIG9mIHR1bmluZ3MgaGF2ZSBiZWVuIGRvbmUuCiAgICB1aW50MjU2IHB1YmxpYyBsYW1ib3NUdW5lQ291bnQ7CgogICAgZnVuY3Rpb24gc2V0U2VydmljZXN0YXRpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIFNlcnZpY2VTdGF0aW9uIGNhbmRpZGF0ZUNvbnRyYWN0ID0gU2VydmljZVN0YXRpb24oX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc1NlcnZpY2VzdGF0aW9uKCkpOwoKICAgICAgICAvLyBTZXQgdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgc2VydmljZVN0YXRpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KICAgIC8vLyBAZGV2IHdlIGNhbiB0dW5lIGxhbWJvcy4gT25seSBjYWxsYWJsZSBieSBTZXJ2aWNlU3RhdGlvbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3YXR0cmlidXRlcyB0aGUgbmV3IGVuY29kZWQgYXR0cmlidXRlcyBvZiB0aGUgbGFtYm8gdG8gYmUgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCB0aGUgbGFtYm8gdG8gYmUgdHVuZWQuCiAgICBmdW5jdGlvbiB0dW5lTGFtYm8odWludDI1NiBfbmV3YXR0cmlidXRlcywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgICAgIAogICAgICAgIC8vVHVuaW5nIGNhbiBvbmx5IGJlIGRvbmUgYnkgdGhlIFNlcnZpY2VTdGF0aW9uIENvbnRyYWN0LiAKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2VydmljZVN0YXRpb24pCiAgICAgICAgKTsKICAgICAgICAKICAgICAgICAKICAgICAgICBsYW1ib3NUdW5lQ291bnQrKzsKICAgICAgICBfdHVuZUxhbWJvKF9uZXdhdHRyaWJ1dGVzLCBfdG9rZW5JZCk7CiAgICB9CiAgICBmdW5jdGlvbiB3aXRoZHJhd1R1bmVCYWxhbmNlcygpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHNlcnZpY2VTdGF0aW9uLndpdGhkcmF3QmFsYW5jZSgpOwogICAgICAgIAogICAgfQoKfQoKLy8vIEB0aXRsZSBFdGhlckxhbWJvczogQ29sbGVjdGlibGUsIHR1bmVhYmxlLCBhbmQgc3VwZXIgc3R5bGlzaCBsYW1ib3Mgb24gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4uCi8vLyBAYXV0aG9yIENyeXB0b2tuaWdodHMgY29kZSBhZGFwdGVkIGZyb20gQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgVGhlIG1haW4gRXRoZXJMYW1ib3MgY29udHJhY3QsIGtlZXBzIHRyYWNrIG9mIGxhbWJvcy4KY29udHJhY3QgRXRoZXJMYW1ib3NDb3JlIGlzIEV0aGVyTGFtYm9zVHVuaW5nIHsKCiAgICAvLyBUaGlzIGlzIHRoZSBtYWluIEV0aGVyTGFtYm9zIGNvbnRyYWN0LiBJbiBvcmRlciB0byBrZWVwIG91ciBjb2RlIHNlcGVyYXRlZCBpbnRvIGxvZ2ljYWwgc2VjdGlvbnMsCiAgICAvLyB3ZSd2ZSBicm9rZW4gaXQgdXAgaW4gdHdvIHdheXMuIEZpcnN0LCB3ZSBoYXZlIHNldmVyYWwgc2VwZXJhdGVseS1pbnN0YW50aWF0ZWQgc2libGluZyBjb250cmFjdHMKICAgIC8vIHRoYXQgaGFuZGxlIHNhbGVzLiBUaGUgc2FsZXMgYXJlCiAgICAvLyBzZXBlcmF0ZSBzaW5jZSB0aGVpciBsb2dpYyBpcyBzb21ld2hhdCBjb21wbGV4IGFuZCB0aGVyZSdzIGFsd2F5cyBhIHJpc2sgb2Ygc3VidGxlIGJ1Z3MuIEJ5IGtlZXBpbmcKICAgIC8vIHRoZW0gaW4gdGhlaXIgb3duIGNvbnRyYWN0cywgd2UgY2FuIHVwZ3JhZGUgdGhlbSB3aXRob3V0IGRpc3J1cHRpbmcgdGhlIG1haW4gY29udHJhY3QgdGhhdCB0cmFja3MKICAgIC8vIGxhbWJvIG93bmVyc2hpcC4gCiAgICAvLwogICAgLy8gU2Vjb25kbHksIHdlIGJyZWFrIHRoZSBjb3JlIGNvbnRyYWN0IGludG8gbXVsdGlwbGUgZmlsZXMgdXNpbmcgaW5oZXJpdGVuY2UsIG9uZSBmb3IgZWFjaCBtYWpvcgogICAgLy8gZmFjZXQgb2YgZnVuY3Rpb25hbGl0eSBvZiBFdGhlckxhbWJvcy4gVGhpcyBhbGxvd3MgdXMgdG8ga2VlcCByZWxhdGVkIGNvZGUgYnVuZGxlZCB0b2dldGhlciB3aGlsZSBzdGlsbAogICAgLy8gYXZvaWRpbmcgYSBzaW5nbGUgZ2lhbnQgZmlsZSB3aXRoIGV2ZXJ5dGhpbmcgaW4gaXQuIFRoZSBicmVha2Rvd24gaXMgYXMgZm9sbG93czoKICAgIC8vCiAgICAvLyAgICAgIC0gRXRoZXJMYW1ib3NCYXNlOiBUaGlzIGlzIHdoZXJlIHdlIGRlZmluZSB0aGUgbW9zdCBmdW5kYW1lbnRhbCBjb2RlIHNoYXJlZCB0aHJvdWdob3V0IHRoZSBjb3JlCiAgICAvLyAgICAgICAgICAgICBmdW5jdGlvbmFsaXR5LiBUaGlzIGluY2x1ZGVzIG91ciBtYWluIGRhdGEgc3RvcmFnZSwgY29uc3RhbnRzIGFuZCBkYXRhIHR5cGVzLCBwbHVzCiAgICAvLyAgICAgICAgICAgICBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIHRoZXNlIGl0ZW1zLgogICAgLy8KICAgIC8vICAgICAgLSBFdGhlckxhbWJvc0FjY2Vzc0NvbnRyb2w6IFRoaXMgY29udHJhY3QgbWFuYWdlcyB0aGUgdmFyaW91cyBhZGRyZXNzZXMgYW5kIGNvbnN0cmFpbnRzIGZvciBvcGVyYXRpb25zCiAgICAvLyAgICAgICAgICAgICB0aGF0IGNhbiBiZSBleGVjdXRlZCBvbmx5IGJ5IHNwZWNpZmljIHJvbGVzLiBOYW1lbHkgQ0VPLCBDRk8gYW5kIENPTy4KICAgIC8vCiAgICAvLyAgICAgIC0gRXRoZXJMYW1ib3NPd25lcnNoaXA6IFRoaXMgcHJvdmlkZXMgdGhlIG1ldGhvZHMgcmVxdWlyZWQgZm9yIGJhc2ljIG5vbi1mdW5naWJsZSB0b2tlbgogICAgLy8gICAgICAgICAgICAgdHJhbnNhY3Rpb25zLCBmb2xsb3dpbmcgdGhlIGRyYWZ0IEVSQy03MjEgc3BlYyAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkuCiAgICAvLwogICAgLy8gICAgICAtIEV0aGVyTGFtYm9zU2FsZTogSGVyZSB3ZSBoYXZlIHRoZSBwdWJsaWMgbWV0aG9kcyBmb3Igc2FsZXMuIAogICAgLy8KICAgIC8vICAgICAgLSBFdGhlckxhbWJvc0J1aWxkaW5nOiBUaGlzIGZpbmFsIGZhY2V0IGNvbnRhaW5zIHRoZSBmdW5jdGlvbmFsaXR5IHdlIHVzZSBmb3IgY3JlYXRpbmcgbmV3IGNhcnMuCiAgICAvLyAgICAgICAgICAgICAKCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgY29yZSBjb250cmFjdCBpcyBicm9rZW4gYW5kIGFuIHVwZ3JhZGUgaXMgcmVxdWlyZWQKICAgIGFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIHRoZSBtYWluIEV0aGVyTGFtYm9zIHNtYXJ0IGNvbnRyYWN0IGluc3RhbmNlLgogICAgZnVuY3Rpb24gRXRoZXJMYW1ib3NDb3JlKCkgcHVibGljIHsKICAgICAgICAvLyBTdGFydHMgcGF1c2VkLgogICAgICAgIHBhdXNlZCA9IHRydWU7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRU8KICAgICAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIGFsc28gdGhlIGluaXRpYWwgQ09PCiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHN0YXJ0IHdpdGggdGhlIGNhciAwIAogICAgICAgIF9jcmVhdGVMYW1ibyh1aW50MjU2KC0xKSwgYWRkcmVzcygwKSwwKTsKICAgIH0KCiAgICAvLy8gQGRldiBVc2VkIHRvIG1hcmsgdGhlIHNtYXJ0IGNvbnRyYWN0IGFzIHVwZ3JhZGVkLCBpbiBjYXNlIHRoZXJlIGlzIGEgc2VyaW91cwogICAgLy8vICBicmVha2luZyBidWcuIFRoaXMgbWV0aG9kIGRvZXMgbm90aGluZyBidXQga2VlcCB0cmFjayBvZiB0aGUgbmV3IGNvbnRyYWN0IGFuZAogICAgLy8vICBlbWl0IGEgbWVzc2FnZSBpbmRpY2F0aW5nIHRoYXQgdGhlIG5ldyBhZGRyZXNzIGlzIHNldC4gSXQncyB1cCB0byBjbGllbnRzIG9mIHRoaXMKICAgIC8vLyAgY29udHJhY3QgdG8gdXBkYXRlIHRvIHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcyBpbiB0aGF0IGNhc2UuIChUaGlzIGNvbnRyYWN0IHdpbGwKICAgIC8vLyAgYmUgcGF1c2VkIGluZGVmaW5pdGVseSBpZiBzdWNoIGFuIHVwZ3JhZGUgdGFrZXMgcGxhY2UuKQogICAgLy8vIEBwYXJhbSBfdjJBZGRyZXNzIG5ldyBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXROZXdBZGRyZXNzKGFkZHJlc3MgX3YyQWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgbmV3Q29udHJhY3RBZGRyZXNzID0gX3YyQWRkcmVzczsKICAgICAgICBDb250cmFjdFVwZ3JhZGUoX3YyQWRkcmVzcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTm8gdGlwcGluZyEKICAgIC8vLyBAZGV2IFJlamVjdCBhbGwgRXRoZXIgZnJvbSBiZWluZyBzZW50IGhlcmUsIHVubGVzcyBpdCdzIGZyb20gdGhlIG1hcmtldFBsYWNlIGNvbnRyYWN0LgogICAgLy8vIChIb3BlZnVsbHksIHdlIGNhbiBwcmV2ZW50IHVzZXIgYWNjaWRlbnRzLikKICAgIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKG1hcmtldFBsYWNlKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgbGFtYm8uCiAgICAvLy8gQHBhcmFtIF9pZCBUaGUgSUQgb2YgdGhlIGxhbWJvIG9mIGludGVyZXN0LgogICAgZnVuY3Rpb24gZ2V0TGFtYm8odWludDI1NiBfaWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoCiAgICAgICAgdWludDI1NiBidWlsZFRpbWUsCiAgICAgICAgdWludDI1NiBhdHRyaWJ1dGVzCiAgICApIHsKICAgICAgICBMYW1ibyBzdG9yYWdlIGtpdCA9IGxhbWJvc1tfaWRdOwoKICAgICAgICBidWlsZFRpbWUgPSB1aW50MjU2KGtpdC5idWlsZFRpbWUpOwogICAgICAgIGF0dHJpYnV0ZXMgPSBraXQuYXR0cmlidXRlczsKICAgIH0KICAgIC8vLyBAbm90aWNlIFJldHVybnMgYWxsIHRoZSByZWxldmFudCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGxhbWJvLgogICAgLy8vIEBwYXJhbSBfaWQgVGhlIElEIG9mIHRoZSBsYW1ibyBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldExhbWJvQXR0cmlidXRlcyh1aW50MjU2IF9pZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICB1aW50MjU2IGF0dHJpYnV0ZXMKICAgICkgewogICAgICAgIExhbWJvIHN0b3JhZ2Uga2l0ID0gbGFtYm9zW19pZF07CiAgICAgICAgYXR0cmlidXRlcyA9IGtpdC5hdHRyaWJ1dGVzOwogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGFsbCB0aGUgcmVsZXZhbnQgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZpYyBsYW1iby4KICAgIC8vLyBAcGFyYW0gX2lkIFRoZSBJRCBvZiB0aGUgbGFtYm8gb2YgaW50ZXJlc3QuCiAgICBmdW5jdGlvbiBnZXRMYW1ib01vZGVsKHVpbnQyNTYgX2lkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgIHVpbnQ2NCBtb2RlbAogICAgKSB7CiAgICAgICAgTGFtYm8gc3RvcmFnZSBraXQgPSBsYW1ib3NbX2lkXTsKICAgICAgICBtb2RlbCA9IGtpdC5tb2RlbDsKICAgICAgICByZXR1cm4gbW9kZWw7CiAgICB9CiAgICAvLy8gQGRldiBPdmVycmlkZSB1bnBhdXNlIHNvIGl0IHJlcXVpcmVzIGFsbCBleHRlcm5hbCBjb250cmFjdCBhZGRyZXNzZXMKICAgIC8vLyAgdG8gYmUgc2V0IGJlZm9yZSBjb250cmFjdCBjYW4gYmUgdW5wYXVzZWQuIEFsc28sIHdlIGNhbid0IGhhdmUKICAgIC8vLyAgbmV3Q29udHJhY3RBZGRyZXNzIHNldCBlaXRoZXIsIGJlY2F1c2UgdGhlbiB0aGUgY29udHJhY3Qgd2FzIHVwZ3JhZGVkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gd2UgY2FuIGNhbGwgc3VwZXIudW5wYXVzZQogICAgLy8vICB3aXRob3V0IHVzaW5nIGFuIGV4cGVuc2l2ZSBDQUxMLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUobWFya2V0UGxhY2UgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShzZXJ2aWNlU3RhdGlvbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG5ld0NvbnRyYWN0QWRkcmVzcyA9PSBhZGRyZXNzKDApKTsKCiAgICAgICAgLy8gQWN0dWFsbHkgdW5wYXVzZSB0aGUgY29udHJhY3QuCiAgICAgICAgc3VwZXIudW5wYXVzZSgpOwogICAgfQoKICAgIC8vIEBkZXYgQWxsb3dzIHRoZSBDRk8gdG8gY2FwdHVyZSB0aGUgYmFsYW5jZSBhdmFpbGFibGUgdG8gdGhlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgIGNmb0FkZHJlc3Muc2VuZChiYWxhbmNlKTsKICAgICAKICAgIH0KfQ=='.
	

]
