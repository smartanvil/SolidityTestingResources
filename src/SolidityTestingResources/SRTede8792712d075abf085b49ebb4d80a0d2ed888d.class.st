Class {
	#name : #SRTede8792712d075abf085b49ebb4d80a0d2ed888d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTede8792712d075abf085b49ebb4d80a0d2ed888d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgICAvKioKICAgICogTXVsdGlwbGljYXRpb24gd2l0aCBzYWZldHkgY2hlY2sKICAgICovCiAgICBmdW5jdGlvbiBNdWwodWludDI1NiBhLCB1aW50MjU2IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICB1aW50MjU2IGMgPSBhICogYjsKICAgICAgLy9jaGVjayByZXN1bHQgc2hvdWxkIG5vdCBiZSBvdGhlciB3aXNlIHVudGlsIGE9MAogICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogRGl2aXNpb24gd2l0aCBzYWZldHkgY2hlY2sKICAgICovCiAgICBmdW5jdGlvbiBEaXYodWludDI1NiBhLCB1aW50MjU2IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBTdWJ0cmFjdGlvbiB3aXRoIHNhZmV0eSBjaGVjawogICAgKi8KICAgIGZ1bmN0aW9uIFN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVyZSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIC8vYiBtdXN0IGJlIGdyZWF0ZXIgdGhhdCBhIGFzIHdlIG5lZWQgdG8gc3RvcmUgdmFsdWUgaW4gdW5zaWduZWQgaW50ZWdlcgogICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8qKgogICAgKiBBZGRpdGlvbiB3aXRoIHNhZmV0eSBjaGVjawogICAgKi8KICAgIGZ1bmN0aW9uIEFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVyZSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAvL1dlIG5lZWQgdG8gY2hlY2sgcmVzdWx0IGdyZWF0ZXIgdGhhbiBvbmx5IG9uZSBudW1iZXIgZm9yIHZhbGlkIEFkZGl0aW9uCiAgICAgIC8vcmVmZXIgaHR0cHM6Ly9ldGhlcmV1bS5zdGFja2V4Y2hhbmdlLmNvbS9hLzE1MjcwLzE2MDQ4CiAgICAgIGFzc2VydChjID49IGEpOwogICAgICByZXR1cm4gYzsKICAgIH0KfQoKLyoqCiAqIENvbnRyYWN0ICJFUkMyMEJhc2ljIgogKiBQdXJwb3NlOiBEZWZpbmluZyBFUkMyMCBzdGFuZGFyZCB3aXRoIGJhc2ljIGZ1bmN0aW9uYWxpdHkgbGlrZSAtIENoZWNrQmFsYW5jZSBhbmQgVHJhbnNmZXIgaW5jbHVkaW5nIFRyYW5zZmVyIGV2ZW50CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKCiAgLy9HaXZlIHJlYWx0aW1lIHRvdGFsU3VwcGx5IG9mIElBQyB0b2tlbgogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAvL0dldCBJQUMgdG9rZW4gYmFsYW5jZSBmb3IgcHJvdmlkZWQgYWRkcmVzcwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7CgogIC8vVHJhbnNmZXIgSUFDIHRva2VuIHRvIHByb3ZpZGVkIGFkZHJlc3MKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAvL0VtaXQgVHJhbnNmZXIgZXZlbnQgb3V0c2lkZSBvZiBibG9ja2NoYWluIGZvciBldmVyeSBJQUMgdG9rZW4gdHJhbnNmZXIKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKfQoKLyoqCiAqIENvbnRyYWN0ICJFUkMyMCIKICogUHVycG9zZTogRGVmaW5pbmcgRVJDMjAgc3RhbmRhcmQgd2l0aCBtb3JlIGFkdmFuY2VkIGZ1bmN0aW9uYWxpdHkgbGlrZSAtIEF1dGhvcml6ZSBzcGVuZGVyIHRvIHRyYW5zZmVyIElBQyB0b2tlbgogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CgogIC8vR2V0IElBQyB0b2tlbiBhbW91bnQgdGhhdCBzcGVuZGVyIGNhbiBzcGVuZCBmcm9tIHByb3ZpZGVkIG93bmVyJ3MgYWNjb3VudAogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwoKICAvL1RyYW5zZmVyIGluaXRpYXRlZCBieSBzcGVuZGVyCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCBvayk7CgogIC8vQWRkIHNwZW5kZXIgdG8gYXV0aHJpemUgZm9yIHNwZW5kaW5nIHNwZWNpZmllZCBhbW91bnQgb2YgSUFDIFRva2VuCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCBvayk7CgogIC8vRW1pdCBldmVudCBmb3IgYW55IGFwcHJvdmFsIHByb3ZpZGVkIHRvIHNwZW5kZXIKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBDb250cmFjdCAiT3duYWJsZSIKICogUHVycG9zZTogRGVmaW5lcyBPd25lciBmb3IgY29udHJhY3QgYW5kIHByb3ZpZGUgZnVuY3Rpb25hbGl0eSB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8gYW5vdGhlciBhY2NvdW50CiAqLwpjb250cmFjdCBPd25hYmxlIHsKCiAgLy9vd25lciB2YXJpYWJsZSB0byBzdG9yZSBjb250cmFjdCBvd25lciBhY2NvdW50CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIC8vQ29uc3RydWN0b3IgZm9yIHRoZSBjb250cmFjdCB0byBzdG9yZSBvd25lcidzIGFjY291bnQgb24gZGVwbG95bWVudAogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLy9tb2RpZmllciB0byBjaGVjayB0cmFuc2FjdGlvbiBpbml0aWF0b3IgaXMgb25seSBvd25lcgogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICBfOwogIH0KCiAgLy9vd25lcnNoaXAgY2FuIGJlIHRyYW5zZmVycmVkIHRvIHByb3ZpZGVkIG5ld093bmVyLiBGdW5jdGlvbiBjYW4gb25seSBiZSBpbml0aWF0ZWQgYnkgY29udHJhY3Qgb3duZXIncyBhY2NvdW50CiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQ29udHJhY3QgIlBhdXNhYmxlIgogKiBQdXJwb3NlOiBDb250cmFjdCB0byBwcm92aWRlIGZ1bmN0aW9uYWxpdHkgdG8gcGF1c2UgYW5kIHJlc3VtZSBTYWxlIGluIGNhc2Ugb2YgZW1lcmdlbmN5CiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKCiAgLy9mbGFnIHRvIGluZGljYXRlIHdoZXRoZXIgU2FsZSBpcyBwYXVzZWQgb3Igbm90CiAgYm9vbCBwdWJsaWMgc3RvcHBlZDsKCiAgLy9FbWl0IGV2ZW50IHdoZW4gYW55IGNoYW5nZSBoYXBwZW5zIGluIGNyb3dkc2FsZSBzdGF0ZQogIGV2ZW50IFN0YXRlQ2hhbmdlZChib29sIGNoYW5nZWQpOwoKICAvL21vZGlmaWVyIHRvIGNvbnRpbnVlIHdpdGggdHJhbnNhY3Rpb24gb25seSB3aGVuIFNhbGUgaXMgbm90IHBhdXNlZAogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKCFzdG9wcGVkKTsKICAgIF87CiAgfQoKICAvL21vZGlmaWVyIHRvIGNvbnRpbnVlIHdpdGggdHJhbnNhY3Rpb24gb25seSB3aGVuIFNhbGUgaXMgcGF1c2VkCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgIHJlcXVpcmUoc3RvcHBlZCk7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHBhdXNlIFNhbGUKICBmdW5jdGlvbiBlbWVyZ2VuY3lTdG9wKCkgZXh0ZXJuYWwgb25seU93bmVyICB7CiAgICBzdG9wcGVkID0gdHJ1ZTsKICAgIC8vRW1pdCBldmVudCB3aGVuIGNyb3dkc2FsZSBzdGF0ZSBjaGFuZ2VzCiAgICBTdGF0ZUNoYW5nZWQodHJ1ZSk7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJlc3VtZXMgU2FsZQogIGZ1bmN0aW9uIHJlbGVhc2UoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgIHN0b3BwZWQgPSBmYWxzZTsKICAgIC8vRW1pdCBldmVudCB3aGVuIGNyb3dkc2FsZSBzdGF0ZSBjaGFuZ2VzCiAgICBTdGF0ZUNoYW5nZWQodHJ1ZSk7CiAgfQoKfQoKLyoqCiAqIENvbnRyYWN0ICJJQUMiCiAqIFB1cnBvc2U6IENyZWF0ZSBJQUMgdG9rZW4KICovCmNvbnRyYWN0IEluamlpIGlzIEVSQzIwLCBPd25hYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8qIFB1YmxpYyB2YXJpYWJsZXMgb2YgdGhlIHRva2VuICovCiAgLy9UbyBzdG9yZSBuYW1lIGZvciB0b2tlbgogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJJbmppaSBBY2Nlc3MgQ29pbnMiOwoKICAvL1RvIHN0b3JlIHN5bWJvbCBmb3IgdG9rZW4KICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJJQUMiOwoKICAvL1RvIHN0b3JlIGRlY2ltYWwgcGxhY2VzIGZvciB0b2tlbgogIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDA7CgogIC8vVG8gc3RvcmUgZGVjaW1hbCB2ZXJzaW9uIGZvciB0b2tlbgogIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICd2MS4wJzsKCiAgLy9mbGFnIHRvIGluZGljYXRlIHdoZXRoZXIgdHJhbnNmZXIgb2YgSUFDIFRva2VuIGlzIGFsbG93ZWQgb3Igbm90CiAgYm9vbCBwdWJsaWMgbG9ja2VkOwoKICAvL21hcCB0byBzdG9yZSBJQUMgVG9rZW4gYmFsYW5jZSBjb3JyZXNwb25kaW5nIHRvIGFkZHJlc3MKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8vVG8gc3RvcmUgc3BlbmRlciB3aXRoIGFsbG93ZWQgYW1vdW50IG9mIElBQyBUb2tlbiB0byBzcGVuZCBjb3JyZXNwb25kaW5nIHRvIElBQyBUb2tlbiBob2xkZXIncyBhY2NvdW50CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAvL1RvIGhhbmRsZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjawogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50MjU2IHNpemUpIHsKICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA+PSBzaXplICsgNCk7CiAgICAgXzsKICB9CgogIC8vIExvY2sgdHJhbnNmZXIgZHVyaW5nIFNhbGUKICBtb2RpZmllciBvbmx5VW5sb2NrZWQoKSB7CiAgICByZXF1aXJlKCFsb2NrZWQpOwogICAgXzsKICB9CgogIC8vQ29udHJ1Y3RvciB0byBkZWZpbmUgSUFDIFRva2VuIHByb3BlcnRpZXMKICBmdW5jdGlvbiBJbmppaSgpIHB1YmxpYyB7CiAgICAvLyBsb2NrIHRoZSB0cmFuc2ZlciBmdW5jdGlvbiBkdXJpbmcgU2FsZQogICAgbG9ja2VkID0gdHJ1ZTsKCiAgICAvL2luaXRpYWwgdG9rZW4gc3VwcGx5IGlzIDAKICAgIHRvdGFsU3VwcGx5ID0gMDsKICB9CgogIC8vSW1wbGVtZW50YXRpb24gZm9yIHRyYW5zZmVycmluZyBJQUMgVG9rZW4gdG8gcHJvdmlkZWQgYWRkcmVzcwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgcHVibGljIG9ubHlVbmxvY2tlZCByZXR1cm5zIChib29sKXsKCiAgICAvL0NoZWNrIHByb3ZpZGVkIElBQyBUb2tlbiBzaG91bGQgbm90IGJlIDAKICAgIGlmIChfdG8gIT0gYWRkcmVzcygwKSAmJiBfdmFsdWUgPj0gMSkgewogICAgICAvL2RlZHVjdCBJQUMgVG9rZW4gYW1vdW50IGZyb20gdHJhbnNhY3Rpb24gaW5pdGlhdG9yCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uU3ViKF92YWx1ZSk7CiAgICAgIC8vQWRkIElBQyBUb2tlbiB0byBiYWxhY2Ugb2YgdGFyZ2V0IGFjY291bnQKICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uQWRkKF92YWx1ZSk7CiAgICAgIC8vRW1pdCBldmVudCBmb3IgdHJhbnNmZXJyaW5nIElBQyBUb2tlbgogICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZWxzZXsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy9UcmFuc2ZlciBpbml0aWF0ZWQgYnkgc3BlbmRlcgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHB1YmxpYyBvbmx5VW5sb2NrZWQgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vQ2hlY2sgcHJvdmlkZWQgSUFDIFRva2VuIHNob3VsZCBub3QgYmUgMAogICAgaWYgKF90byAhPSBhZGRyZXNzKDApICYmIF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgLy9HZXQgYW1vdW50IG9mIElBQyBUb2tlbiBmb3Igd2hpY2ggc3BlbmRlciBpcyBhdXRob3JpemVkCiAgICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICAgIC8vQWRkIGFtb3VudCBvZiBJQUMgVG9rZW4gaW4gdHJhcmdldCBhY2NvdW50J3MgYmFsYW5jZQogICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5BZGQoX3ZhbHVlKTsKICAgICAgLy9EZWR1Y3QgSUFDIFRva2VuIGFtb3VudCBmcm9tIF9mcm9tIGFjY291bnQKICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLlN1YihfdmFsdWUpOwogICAgICAvL0RlZHVjdCBBdXRob3JpemVkIGFtb3VudCBmb3Igc3BlbmRlcgogICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2UuU3ViKF92YWx1ZSk7CiAgICAgIC8vRW1pdCBldmVudCBmb3IgVHJhbnNmZXIKICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9ZWxzZXsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy9HZXQgSUFDIFRva2VuIGJhbGFuY2UgZm9yIHByb3ZpZGVkIGFkZHJlc3MKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKICAvL0FkZCBzcGVuZGVyIHRvIGF1dGhvcml6ZSBmb3Igc3BlbmRpbmcgc3BlY2lmaWVkIGFtb3VudCBvZiBJQUMgVG9rZW4KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfc3BlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgIC8vZG8gbm90IGFsbG93IGRlY2ltYWxzCiAgICB1aW50MjU2IGlhY1RvQXBwcm92ZSA9IF92YWx1ZTsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gaWFjVG9BcHByb3ZlOwogICAgLy9FbWl0IGV2ZW50IGZvciBhcHByb3ZhbCBwcm92aWRlZCB0byBzcGVuZGVyCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgaWFjVG9BcHByb3ZlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy9HZXQgSUFDIFRva2VuIGFtb3VudCB0aGF0IHNwZW5kZXIgY2FuIHNwZW5kIGZyb20gcHJvdmlkZWQgb3duZXIncyBhY2NvdW50CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKY29udHJhY3QgTWV0YWRhdGEgewogICAgCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIAogICAgbWFwcGluZyAodWludCA9PiBhZGRyZXNzKSByZWdpc3Rlck1hcDsKCiAgICBmdW5jdGlvbiBNZXRhZGF0YSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlZ2lzdGVyTWFwWzBdID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvL2dldCBjb250cmFjdCBhZGRyZXNzIGJ5IGl0cyBJRAogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcyAodWludCBhZGRyZXNzSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIHJldHVybiByZWdpc3Rlck1hcFthZGRyZXNzSWRdOwogICAgfQoKICAgIC8vYWRkIG9yIHJlcGxhY2UgY29udHJhY3QgYWRkcmVzcyBieSBpZC4gVGhpcyBpcyBhbHNvIHRoZSBvcmRlciBvZiBkZXBsb3ltZW50CiAgICAvLzAgPSBvd25lcgogICAgLy8xID0gRWNvc3lzdGVtCiAgICAvLzIgPSBDcm93ZHNhbGUuIFRoaXMgd2lsbCBkZXBsb3kgdGhlIHRva2VuIGNvbnRyYWN0IGFsc28uCiAgICAvLzMgPSBDb21wYW55IEludmVudG9yeQogICAgZnVuY3Rpb24gYWRkQWRkcmVzcyAodWludCBhZGRyZXNzSWQsIGFkZHJlc3MgYWRkcmVzc0NvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIGFzc2VydChhZGRyZXNzQ29udHJhY3QgIT0gMHgwICk7CiAgICAgICAgcmVxdWlyZSAob3duZXIgPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSB0eC5vcmlnaW4pOwogICAgICAgIHJlZ2lzdGVyTWFwW2FkZHJlc3NJZF0gPSBhZGRyZXNzQ29udHJhY3Q7CiAgICB9Cn0KCmNvbnRyYWN0IEVjb3N5c3RlbSBpcyBPd25hYmxlewoKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgLy92YXJpYWJsZSBvZiB0eXBlIG1ldGFkYXRhIHRvIHN0b3JlIG1ldGFkYXRhIGNvbnRyYWN0IG9iamVjdAogICAgTWV0YWRhdGEgcHJpdmF0ZSBvYmpNZXRhZGF0YTsKICAgIENyb3dkc2FsZSBwcml2YXRlIG9iakNyb3dkc2FsZTsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHJpdmF0ZSBlY29zeXN0ZW1Db250cmFjdElEID0gMTsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHJpdmF0ZSBjcm93ZHNhbGVDb250cmFjdElEID0gMjsKICAgIGJvb2wgcHVibGljIGNyb3dkc2FsZUFkZHJlc3NTZXQ7CiAgICBldmVudCBUb2tlbnNSZWNlaXZlZChhZGRyZXNzIHJlY2VpdmVkRnJvbSwgdWludDI1NiBudW1iZXJPZlRva2Vuc1JlY2VpdmUpOwoKICAgIC8vQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEVjb3N5c3RlbShhZGRyZXNzIF9tZXRhZGF0YUNvbnRyYWN0QWRkcikgcHVibGljIHsKICAgICAgICBhc3NlcnQoX21ldGFkYXRhQ29udHJhY3RBZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vcGFzc2luZyBhZGRyZXNzIG9mIG1ldGEgZGF0YSBjb250cmFjdCB0byBtZXRhZGF0YSB0eXBlIGFkZHJlc3MgdmFyaWFibGUKICAgICAgICBvYmpNZXRhZGF0YSA9IE1ldGFkYXRhKF9tZXRhZGF0YUNvbnRyYWN0QWRkcik7CiAgICAgICAgLy9yZWdpc3RlciB0aGlzIGNvbnRyYWN0IGluIG1ldGFkYXRhCiAgICAgICAgb2JqTWV0YWRhdGEuYWRkQWRkcmVzcyhlY29zeXN0ZW1Db250cmFjdElELCB0aGlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDcm93ZHNhbGVBZGRyZXNzICgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoIWNyb3dkc2FsZUFkZHJlc3NTZXQpOwogICAgICAgIGFkZHJlc3MgY3Jvd2RzYWxlQ29udHJhY3RBZGRyZXNzID0gb2JqTWV0YWRhdGEuZ2V0QWRkcmVzcyhjcm93ZHNhbGVDb250cmFjdElEKTsKICAgICAgICBhc3NlcnQoY3Jvd2RzYWxlQ29udHJhY3RBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG9iakNyb3dkc2FsZSA9IENyb3dkc2FsZShjcm93ZHNhbGVDb250cmFjdEFkZHJlc3MpOwogICAgICAgIGNyb3dkc2FsZUFkZHJlc3NTZXQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJld2FyZFVzZXIoYWRkcmVzcyB1c2VyLCB1aW50MjU2IGlhY1RvU2VuZCkgcHVibGljIG9ubHlPd25lcnsKICAgICAgICBhc3NlcnQoY3Jvd2RzYWxlQWRkcmVzc1NldCk7CiAgICAgICAgb2JqQ3Jvd2RzYWxlLnRyYW5zZmVyKHVzZXIsIGlhY1RvU2VuZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSl7CiAgICAgICAgVG9rZW5zUmVjZWl2ZWQoX2Zyb20sIF92YWx1ZSk7CiAgICB9Cgp9Cgpjb250cmFjdCBDb21wYW55SW52ZW50b3J5IGlzIE93bmFibGV7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgLy9yZWNvcmQgdGltZXN0YW1wIHdoZW4gdGhlIGxvY2sgd2FzIGluaXRpYXRlZAogICAgdWludDI1NiBwdWJsaWMgc3RhcnRCbG9jazsKICAgIC8vdG8gcmVjb3JkIGhvdyBtYW55IHRva2VucyBhcmUgdW5sb2NrZWQKICAgIHVpbnQyNTYgcHVibGljIHVubG9ja2VkVG9rZW5zOwogICAgdWludDI1NiBwdWJsaWMgaW5pdGlhbFJlbGVhc2VEb25lID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHNlY29uZFJlbGVhc2VEb25lID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGxpZWRBZnRlckxvY2sgPSAwOwogICAgdWludDI1NiBwdWJsaWMgYmFsYW5jZSA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseUZyb21JbnZlbnRvcnk7CiAgICAvL3RvdGFsIG51bWJlciBvZiB0b2tlbnMgYXZhaWxhYmxlIGluIGludmVudG9yeQogICAgdWludDI1NiBwdWJsaWMgdG90YWxSZW1haW5JbkludmVudG9yeTsKICAgIC8vdmFyaWFibGUgb2YgdHlwZSBtZXRhZGF0YSB0byBzdG9yZSBtZXRhZGF0YSBjb250cmFjdCBvYmplY3QKICAgIE1ldGFkYXRhIHByaXZhdGUgb2JqTWV0YWRhdGE7CiAgICBDcm93ZHNhbGUgcHJpdmF0ZSBvYmpDcm93ZHNhbGU7CiAgICB1aW50MjU2IGNvbnN0YW50IHByaXZhdGUgY3Jvd2RzYWxlQ29udHJhY3RJRCA9IDI7CiAgICB1aW50MjU2IGNvbnN0YW50IHByaXZhdGUgaW52ZW50b3J5Q29udHJhY3RJRCA9IDM7CiAgICAvL0VtaXQgZXZlbnQgd2hlbiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkIGZyb20gY29tcGFueSBpbnZlbnRvcnkKICAgIGV2ZW50IFRyYW5zZmVycmVkVW5sb2NrZWRUb2tlbnMoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlLCBieXRlczMyIGNvbW1lbnQpOwogICAgLy9FbWl0IGV2ZW50IHdoZW4gYW55IGNoYW5nZSBoYXBwZW5zIGluIGNyb3dkc2FsZSBzdGF0ZQogICAgZXZlbnQgU3RhdGVDaGFuZ2VkKGJvb2wgY2hhbmdlZCk7CiAgICAKICAgIC8vY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIENvbXBhbnlJbnZlbnRvcnkoYWRkcmVzcyBfbWV0YWRhdGFDb250cmFjdEFkZHIpIHB1YmxpYyB7CiAgICAgICAgYXNzZXJ0KF9tZXRhZGF0YUNvbnRyYWN0QWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvL3Bhc3NpbmcgYWRkcmVzcyBvZiBtZXRhIGRhdGEgY29udHJhY3QgdG8gbWV0YWRhdCB0eXBlIGFkZHJlc3MgdmFyaWFibGUKICAgICAgICBvYmpNZXRhZGF0YSA9IE1ldGFkYXRhKF9tZXRhZGF0YUNvbnRyYWN0QWRkcik7CiAgICAgICAgb2JqTWV0YWRhdGEuYWRkQWRkcmVzcyhpbnZlbnRvcnlDb250cmFjdElELCB0aGlzKTsKICAgICAgICBvYmpDcm93ZHNhbGUgPSBDcm93ZHNhbGUob2JqTWV0YWRhdGEuZ2V0QWRkcmVzcyhjcm93ZHNhbGVDb250cmFjdElEKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGluaXRpYXRlTG9ja2luZyAodWludDI1NiBfYWxyZWFkeVRyYW5zZmVycmVkVG9rZW5zKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvYmpNZXRhZGF0YS5nZXRBZGRyZXNzKGNyb3dkc2FsZUNvbnRyYWN0SUQpICYmIHN0YXJ0QmxvY2sgPT0gMCk7CiAgICAgICAgc3RhcnRCbG9jayA9IG5vdzsKICAgICAgICB1bmxvY2tlZFRva2VucyA9IDA7CiAgICAgICAgYmFsYW5jZSA9IG9iakNyb3dkc2FsZS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgdG90YWxTdXBwbHlGcm9tSW52ZW50b3J5ID0gX2FscmVhZHlUcmFuc2ZlcnJlZFRva2VuczsKICAgICAgICB0b3RhbFJlbWFpbkluSW52ZW50b3J5ID0gYmFsYW5jZS5BZGQoX2FscmVhZHlUcmFuc2ZlcnJlZFRva2VucykuU3ViKF9hbHJlYWR5VHJhbnNmZXJyZWRUb2tlbnMpOwogICAgICAgIFN0YXRlQ2hhbmdlZCh0cnVlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVsZWFzZVRva2VucyAoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHN0YXJ0QmxvY2sgPiAwKTsKICAgICAgICBpZihpbml0aWFsUmVsZWFzZURvbmUgPT0gMCl7CiAgICAgICAgICAgIHJlcXVpcmUobm93ID49IHN0YXJ0QmxvY2suQWRkKDEgeWVhcnMpKTsKICAgICAgICAgICAgdW5sb2NrZWRUb2tlbnMgPSAgYmFsYW5jZS8yOwogICAgICAgICAgICBpbml0aWFsUmVsZWFzZURvbmUgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHNlY29uZFJlbGVhc2VEb25lID09IDApewogICAgICAgICAgICByZXF1aXJlKG5vdyA+PSBzdGFydEJsb2NrLkFkZCgyIHllYXJzKSk7CiAgICAgICAgICAgIHVubG9ja2VkVG9rZW5zID0gYmFsYW5jZTsKICAgICAgICAgICAgc2Vjb25kUmVsZWFzZURvbmUgPSAxOwogICAgICAgIH0KICAgICAgICBTdGF0ZUNoYW5nZWQodHJ1ZSk7CiAgICB9CiAgICAKICAgIC8qCiAgICAqIFRvIGVuYWJsZSB0cmFuc2ZlcnJpbmcgdG9rZW5zIGZyb20gY29tcGFueSBpbnZlbnRvcnkKICAgICovCiAgICBmdW5jdGlvbiBUcmFuc2ZlckZyb21Db21wYW55SW52ZW50b3J5KGFkZHJlc3MgYmVuZWZpY2lhcnksdWludDI1NiBpYWNUb0NyZWRpdCxieXRlczMyIGNvbW1lbnQpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHRvdGFsU3VwcGxpZWRBZnRlckxvY2suQWRkKGlhY1RvQ3JlZGl0KSA8PSB1bmxvY2tlZFRva2Vucyk7CiAgICAgICAgb2JqQ3Jvd2RzYWxlLnRyYW5zZmVyKGJlbmVmaWNpYXJ5LGlhY1RvQ3JlZGl0KTsKICAgICAgICAvL1VwZGF0ZSB0b3RhbCBzdXBwbHkgZm9yIElBQyBUb2tlbgogICAgICAgIHRvdGFsU3VwcGxpZWRBZnRlckxvY2sgPSB0b3RhbFN1cHBsaWVkQWZ0ZXJMb2NrLkFkZChpYWNUb0NyZWRpdCk7CiAgICAgICAgdG90YWxTdXBwbHlGcm9tSW52ZW50b3J5ID0gdG90YWxTdXBwbHlGcm9tSW52ZW50b3J5LkFkZChpYWNUb0NyZWRpdCk7CiAgICAgICAgLy90b3RhbCBudW1iZXIgb2YgdG9rZW5zIHJlbWFpbmluZyBpbiBpbnZlbnRvcnkKICAgICAgICB0b3RhbFJlbWFpbkluSW52ZW50b3J5ID0gdG90YWxSZW1haW5JbkludmVudG9yeS5TdWIoaWFjVG9DcmVkaXQpOwogICAgICAgIC8vIHNlbmQgZXZlbnQgZm9yIHRyYW5zZmVycmluZyBJQUMgVG9rZW4gb24gb2ZmbGluZSBwYXltZW50CiAgICAgICAgVHJhbnNmZXJyZWRVbmxvY2tlZFRva2VucyhiZW5lZmljaWFyeSwgaWFjVG9DcmVkaXQsIGNvbW1lbnQpOwogICAgICAgIC8vRW1pdCBldmVudCB3aGVuIGNyb3dkc2FsZSBzdGF0ZSBjaGFuZ2VzCiAgICAgICAgU3RhdGVDaGFuZ2VkKHRydWUpOwogICAgfQp9Cgpjb250cmFjdCBDcm93ZHNhbGUgaXMgSW5qaWksIFBhdXNhYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgLy9SZWNvcmQgdGhlIHRpbWVzdGFtcCB3aGVuIHNhbGUgc3RhcnRzCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydEJsb2NrOwogICAgLy9ObyBvZiBkYXlzIGZvciB3aGljaCB0aGUgY29tcGxldGUgY3Jvd2RzYWxlIHdpbGwgcnVuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkdXJhdGlvbkNyb3dkU2FsZSA9IDI1IGRheXM7CiAgICAvL3RoZSBnYXAgcGVyaW9kIGJldHdlZW4gZW5kaW5nIG9mIHByaW1hcnkgY3Jvd2RzYWxlIGFuZCBzdGFydGluZyBvZiBzZWNvbmRhcnkgY3Jvd2RzYWxlCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBnYXBJblByaW1hcnlDcm93ZHNhbGVBbmRTZWNvbmRhcnlDcm93ZHNhbGUgPSAyIHllYXJzOwogICAgLy9SZWNvcmQgdGhlIHRpbWVzdGFtcCB3aGVuIHNhbGUgZW5kcwogICAgdWludDI1NiBwdWJsaWMgZW5kQmxvY2s7CgogICAgLy9tYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgYXZhaWxhYmxlIGluIGNvbXBhbnkgaW52ZW50b3J5CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtYXhDYXBDb21wYW55SW52ZW50b3J5ID0gMjUwZTY7CiAgICAvL01heGltdW0gbnVtYmVyIG9mIHRva2VucyBpbiBjcm93ZHNhbGUgPSA1MDBNIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWF4Q2FwID0gNTAwZTY7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtYXhDYXBFY29zeXN0ZW0gPSAyNTBlNjsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG51bWJlck9mVG9rZW5zVG9BdmFpbDUwUGVyY2VudERpc2NvdW50ID0gMmU2OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbnVtYmVyT2ZUb2tlbnNUb0F2YWlsMjVwZXJjZW50RGlzY291bnQgPSA1ZTU7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtaW5pbXVtTnVtYmVyT2ZUb2tlbnMgPSAyNTAwOwogICAgdWludDI1NiBwdWJsaWMgdGFyZ2V0VG9BY2hpZXZlOwoKICAgIGJvb2wgcHVibGljIGludmVudG9yeUxvY2tlZCA9IGZhbHNlOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICAvL1RvdGFsIHRva2VucyBmb3IgY3Jvd2RzYWxlIGluY2x1ZGluZyBtaW50IGFuZCB0cmFuc2ZlciAKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5Rm9yQ3Jvd2RzYWxlQW5kTWludCA9IDA7CiAgICAvL2NvaW5iYXNlIGFjY291bnQgd2hlcmUgYWxsIGV0aGVycyBzaG91bGQgZ28KICAgIGFkZHJlc3MgcHVibGljIGNvaW5iYXNlOwogICAgLy9UbyBzdG9yZSB0b3RhbCBudW1iZXIgb2YgRVRIIHJlY2VpdmVkCiAgICB1aW50MjU2IHB1YmxpYyBFVEhSZWNlaXZlZDsKICAgIC8vdG90YWwgbnVtYmVyIG9mIHRva2VucyBzdXBwbGllZCBmcm9tIGNvbXBhbnkgaW52ZW50b3J5CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseUZyb21JbnZlbnRvcnk7CiAgICAvL3RvdGFsIG51bWJlciBvZiB0b2tlbnMgYXZhaWxhYmxlIGluIGludmVudG9yeQogICAgdWludDI1NiBwdWJsaWMgdG90YWxSZW1haW5JbkludmVudG9yeTsKICAgIC8vbnVtYmVyIG9mIHRva2VucyBwZXIgZXRoZXIKICAgIHVpbnQyNTYgcHVibGljIGdldFByaWNlOwogICAgLy8gVG8gaW5kaWNhdGUgU2FsZSBzdGF0dXMKICAgIC8vY3Jvd2RzYWxlU3RhdHVzPTAgPT4gY3Jvd2RzYWxlIG5vdCBzdGFydGVkCiAgICAvL2Nyb3dkc2FsZVN0YXR1cz0xID0+IGNyb3dkc2FsZSBzdGFydGVkOwogICAgLy9jcm93ZHNhbGVTdGF0dXM9MiA9PiBjcm93ZHNhbGUgZmluaXNoZWQKICAgIHVpbnQyNTYgcHVibGljIGNyb3dkc2FsZVN0YXR1czsKICAgIC8vdHlwZSBvZiBDcm93ZFNhbGU6CiAgICAvLzEgPSBjcm93ZHNhbGUKICAgIC8vMiA9IHNlY29uYWRyeSBjcm93ZHNhbGUgZm9yIHJlbWFpbmluZyB0b2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBjcm93ZFNhbGVUeXBlOwogICAgLy9FbWl0IGV2ZW50IG9uIHJlY2VpdmluZyBFVEgKICAgIGV2ZW50IFJlY2VpdmVkRVRIKGFkZHJlc3MgYWRkciwgdWludCB2YWx1ZSk7CiAgICAvL0VtaXQgZXZlbnQgb24gdHJhbnNmZXJyaW5nIElBQyBUb2tlbiB0byB1c2VyIHdoZW4gcGF5bWVudCBpcyByZWNlaXZlZCBpbiB0cmFkaXRpb25hbCB3YXlzCiAgICBldmVudCBNaW50QW5kVHJhbnNmZXJJQUMoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlLCBieXRlczMyIGNvbW1lbnQpOwogICAgLy9FbWl0IGV2ZW50IHdoZW4gdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZCBmcm9tIGNvbXBhbnkgaW52ZW50b3J5CiAgICBldmVudCBTdWNjZXNzZnVsbHlUcmFuc2ZlcmVkRnJvbUNvbXBhbnlJbnZlbnRvcnkoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlLCBieXRlczMyIGNvbW1lbnQpOwogICAgLy9ldmVudCB0byBsb2cgdG9rZW4gc3VwcGxpZWQKICAgIGV2ZW50IFRva2VuU3VwcGxpZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IGluZGV4ZWQgdG9rZW5zLCB1aW50MjU2IHZhbHVlKTsKICAgIC8vRW1pdCBldmVudCB3aGVuIGFueSBjaGFuZ2UgaGFwcGVucyBpbiBjcm93ZHNhbGUgc3RhdGUKICAgIGV2ZW50IFN0YXRlQ2hhbmdlZChib29sIGNoYW5nZWQpOwoKICAgIC8vdmFyaWFibGUgdG8gc3RvcmUgb2JqZWN0IG9mIE1ldGFkYXRhIGNvbnRyYWN0CiAgICBNZXRhZGF0YSBwcml2YXRlIG9iak1ldGFkYTsKICAgIEVjb3N5c3RlbSBwcml2YXRlIG9iakVjb3N5c3RlbTsKICAgIENvbXBhbnlJbnZlbnRvcnkgcHJpdmF0ZSBvYmpDb21wYW55SW52ZW50b3J5OwogICAgYWRkcmVzcyBwcml2YXRlIGVjb3N5c3RlbUNvbnRyYWN0QWRkcmVzczsKICAgIC8vSUQgb2YgRWNvc3lzdGVtIGNvbnRyYWN0CiAgICB1aW50MjU2IGNvbnN0YW50IGVjb3N5c3RlbUNvbnRyYWN0SUQgPSAxOwogICAgLy9JRCBvZiB0aGlzIGNvbnRyYWN0CiAgICB1aW50MjU2IGNvbnN0YW50IHByaXZhdGUgY3Jvd2RzYWxlQ29udHJhY3RJRCA9IDI7CiAgICAvL0lEIG9mIGNvbXBhbnkgaW52ZW50b3J5CiAgICB1aW50MjU2IGNvbnN0YW50IHByaXZhdGUgaW52ZW50b3J5Q29udHJhY3RJRCA9IDM7CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnN0dWN0b3Igb2YgdGhlIGNvbnRyYWN0CiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBDcm93ZHNhbGUoKSBwdWJsaWMgewogICAgICAgIGFkZHJlc3MgX21ldGFkYXRhQ29udHJhY3RBZGRyID0gMHg4QTg0NzNFNTFEN2Y1NjJlYTc3M0EwMTlkNzM1MUE5NmM0MTlCNjMzOwogICAgICAgIHN0YXJ0QmxvY2sgPSAwOwogICAgICAgIGVuZEJsb2NrID0gMDsKICAgICAgICBjcm93ZFNhbGVUeXBlID0gMTsKICAgICAgICB0b3RhbFN1cHBseSA9IG1heENhcEVjb3N5c3RlbTsKICAgICAgICBjcm93ZHNhbGVTdGF0dXM9MDsKICAgICAgICBjb2luYmFzZSA9IDB4QTg0MTk2OTcyZDZiNTc5NmNFNTIzZjg2MUNDOUUzNjdGNzM5NDIxRjsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgdG90YWxTdXBwbHlGcm9tSW52ZW50b3J5PTA7CiAgICAgICAgdG90YWxSZW1haW5JbkludmVudG9yeSA9IG1heENhcENvbXBhbnlJbnZlbnRvcnk7CiAgICAgICAgZ2V0UHJpY2UgPSAyNzc4OwogICAgICAgIG9iak1ldGFkYSA9IE1ldGFkYXRhKF9tZXRhZGF0YUNvbnRyYWN0QWRkcik7CiAgICAgICAgZWNvc3lzdGVtQ29udHJhY3RBZGRyZXNzID0gb2JqTWV0YWRhLmdldEFkZHJlc3MoZWNvc3lzdGVtQ29udHJhY3RJRCk7CiAgICAgICAgYXNzZXJ0KGVjb3N5c3RlbUNvbnRyYWN0QWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBvYmpFY29zeXN0ZW0gPSBFY29zeXN0ZW0oZWNvc3lzdGVtQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICBvYmpNZXRhZGEuYWRkQWRkcmVzcyhjcm93ZHNhbGVDb250cmFjdElELCB0aGlzKTsKICAgICAgICBiYWxhbmNlc1tlY29zeXN0ZW1Db250cmFjdEFkZHJlc3NdID0gbWF4Q2FwRWNvc3lzdGVtOwogICAgICAgIHRhcmdldFRvQWNoaWV2ZSA9ICg1MDAwMCoxMDBlMTgpLygxMipnZXRQcmljZSk7CiAgICB9CgogICAgLy9WZXJpZnkgaWYgdGhlIHNlbmRlciBpcyBvd25lcgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICBfOwogICAgfQoKICAgIC8vTW9kaWZpZXIgdG8gbWFrZSBzdXJlIHRyYW5zYWN0aW9uIGlzIGhhcHBlbmluZyBkdXJpbmcgc2FsZSB3aGVuIGl0IGlzIG5vdCBzdG9wcGVkCiAgICBtb2RpZmllciByZXNwZWN0VGltZUZyYW1lKCkgewogICAgICAvLyBXaGVuIGNvbnRyYWN0IGlzIGRlcGxveWVkLCBzdGFydGJsb2NrIGlzIDAuIFdoZW4gc2FsZSBpcyBzdGFydGVkLCBzdGFydEJsb2NrIHNob3VsZCBub3QgYmUgemVybwogICAgICBhc3NlcnQoc3RhcnRCbG9jayAhPSAwICYmICFzdG9wcGVkICYmIGNyb3dkc2FsZVN0YXR1cyA9PSAxKTsKICAgICAgLy9jaGVjayBpZiByZXF1aXJlc3QgaXMgbWFkZSBhZnRlciB0aW1lIGlzIHVwCiAgICAgIGlmKG5vdyA+IGVuZEJsb2NrKXsKICAgICAgICAgIC8vdG9rZW5zIGNhbm5vdCBiZSBib3VnaHQgYWZ0ZXIgdGltZSBpcyB1cAogICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgIH0KICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVG8gdXBncmFkZSBlY29zeXN0ZW0gY29udHJhY3QKICAgICAqCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNldEVjb3N5c3RlbUNvbnRyYWN0ICgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHVpbnQyNTYgYmFsYW5jZU9mT2xkRWNvc3lzdGVtID0gYmFsYW5jZXNbZWNvc3lzdGVtQ29udHJhY3RBZGRyZXNzXTsKICAgICAgICBiYWxhbmNlc1tlY29zeXN0ZW1Db250cmFjdEFkZHJlc3NdID0gMDsKICAgICAgICAvL2ZpbmQgbmV3IGFkZHJlc3Mgb2YgY29udHJhY3QgZnJvbSBtZXRhZGF0YQogICAgICAgIGVjb3N5c3RlbUNvbnRyYWN0QWRkcmVzcyA9IG9iak1ldGFkYS5nZXRBZGRyZXNzKGVjb3N5c3RlbUNvbnRyYWN0SUQpOwogICAgICAgIC8vdXBkYXRlIHRoZSBiYWxhbmNlIG9mIG5ldyBjb250cmFjdAogICAgICAgIGJhbGFuY2VzW2Vjb3N5c3RlbUNvbnRyYWN0QWRkcmVzc10gPSBiYWxhbmNlT2ZPbGRFY29zeXN0ZW07CiAgICAgICAgYXNzZXJ0KGVjb3N5c3RlbUNvbnRyYWN0QWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBvYmpFY29zeXN0ZW0gPSBFY29zeXN0ZW0oZWNvc3lzdGVtQ29udHJhY3RBZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRJQUNGdW5kQWNjb3VudCgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHVpbnQgcmVtYWluZGVyID0gYmxvY2subnVtYmVyJTEwOwogICAgICAgIGlmKHJlbWFpbmRlcj09MCl7CiAgICAgICAgICAgIHJldHVybiAweDg3ODZEQjUyRDI5MjU1MWY0MTM5YTk2M0Y3OUNlMTAxOGQ5MDk2NTU7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09MSl7CiAgICAgICAgICAgIHJldHVybiAweDExODE4RTIyQ0RjMDU5MkY2OWEyMmIzMENGMDE4Mjg4OGYzMTVGQkM7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09Mil7CiAgICAgICAgICAgIHJldHVybiAweDE3NjE2YjY1MkMzYzJlQWYyYWE4MmE3MkJkMmIzY0ZmNDBBODU0ZkU7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09Myl7CiAgICAgICAgICAgIHJldHVybiAweEQ0MzM2MzJDQTVjQUZEYTI3NjU1YjhFNTM2RTVjNjMzNTM0M2Q0MDg7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09NCl7CiAgICAgICAgICAgIHJldHVybiAweGIwRGM1OUE4MzEyRDkwMUMyNTBmODk3NUU0ZDk5ZUFCNzRENzk0ODQ7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09NSl7CiAgICAgICAgICAgIHJldHVybiAweDBlNkIxRjc5NTVFRjUyNUMyNzA3Nzk5OTYzMzE4YzQ5ZjlBZDczNzQ7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09Nil7CiAgICAgICAgICAgIHJldHVybiAweDJmRTZDNEQyREMwRUI3MWQyYWM4ODVGNjRmMDI5Q0U3OGI5Rjk4ZDk7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09Nyl7CiAgICAgICAgICAgIHJldHVybiAweDBhN2NEMWNDYzU1MTkxRjgwNDZEMTAyMzM0MGJkZmRmYTQ3NUYyNjc7CiAgICAgICAgfSBlbHNlIGlmKHJlbWFpbmRlcj09OCl7CiAgICAgICAgICAgIHJldHVybiAweDc2QzQwZkRGZDMyODRkYTc5Njg1MTYxMWU3ZTllOERlMENjQTU0NkM7CiAgICAgICAgfWVsc2UgewogICAgICAgICAgICByZXR1cm4gMHhlNEZFNTI5NTc3Mjk5NzI3MjkxNDQ0NzU0OUQ1NzA4ODI0MjNBMjI3OwogICAgICAgIH0KICB9CiAgICAvKgogICAgKiBUbyBzdGFydCBDcm93ZHNhbGUKICAgICovCiAgICBmdW5jdGlvbiBzdGFydFNhbGUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQoc3RhcnRCbG9jayA9PSAwKTsKICAgICAgICAvL3JlY29yZCB0aW1lc3RhbXAgd2hlbiBzYWxlIGlzIHN0YXJ0ZWQKICAgICAgICBzdGFydEJsb2NrID0gbm93OwogICAgICAgIC8vY2hhbmdlIHRoZSB0eXBlIG9mIHNhbGUgdG8gY3Jvd2RzYWxlCiAgICAgICAgY3Jvd2RTYWxlVHlwZSA9IDE7CiAgICAgICAgLy9DaGFuZ2Ugc3RhdHVzIG9mIGNyb3dkc2FsZSB0byBydW5uaW5nCiAgICAgICAgY3Jvd2RzYWxlU3RhdHVzID0gMTsKICAgICAgICAvL0Nyb3dkc2FsZSBzaG91bGQgZW5kIGFmdGVyIGl0cyBwcm9wZXIgZHVyYXRpb24gd2hlbiBzdGFydGVkCiAgICAgICAgZW5kQmxvY2sgPSBub3cuQWRkKGR1cmF0aW9uQ3Jvd2RTYWxlKTsKICAgICAgICAvL0VtaXQgZXZlbnQgd2hlbiBjcm93ZHNhbGUgc3RhdGUgY2hhbmdlcwogICAgICAgIFN0YXRlQ2hhbmdlZCh0cnVlKTsKICAgIH0KCiAgICAvKgogICAgKiBUbyBzdGFydCBjcm93ZHNhbGUgYWZ0ZXIgMiB5ZWFycyhnYXBJblByaW1hcnlDcm93ZHNhbGVBbmRTZWNvbmRhcnlDcm93ZHNhbGUpCiAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRTZWNvbmRhcnlDcm93ZHNhbGUgKHVpbnQyNTYgZHVyYXRpb25TZWNvbmRhcnlDcm93ZFNhbGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAvL2Nyb3dkc2FsZSBzaG91bGQgaGF2ZSBiZWVuIHN0b3BwZWQKICAgICAgLy9zdGFydEJsb2NrIHNob3VsZCBoYXZlIGEgdmFsdWUuIEl0IHNob3cgdGhhdCBzYWxlIHdhcyBzdGFydGVkIGF0IHNvbWUgcG9pbnQgb2YgdGltZQogICAgICAvL2VuZEJsb2NrID4gdGhlIGR1cmF0aW9uIG9mIGNyb3dkc2FsZTogdGhpcyBlbnN1cmVzIGVuZGJsb2NrIHdhcyB1cGRhdGVkIGJ5IGZpbmFsaXplCiAgICAgIGFzc2VydChjcm93ZHNhbGVTdGF0dXMgPT0gMiAmJiBjcm93ZFNhbGVUeXBlID09IDEpOwogICAgICBpZihub3cgPiBlbmRCbG9jay5BZGQoZ2FwSW5QcmltYXJ5Q3Jvd2RzYWxlQW5kU2Vjb25kYXJ5Q3Jvd2RzYWxlKSl7CiAgICAgICAgICAvL2Nyb3dkc2FsZSBzdGF0dXMgc2V0IHRvICJydW5uaW5nIgogICAgICAgICAgY3Jvd2RzYWxlU3RhdHVzID0gMTsKICAgICAgICAgIC8vY2hhbmdlIHRoZSB0eXBlIG9mIENyb3dkU2FsZQogICAgICAgICAgY3Jvd2RTYWxlVHlwZSA9IDI7CiAgICAgICAgICAvL0R1cmF0aW9uIGlzIHJlY2VpdmVkIGluIGRheXMKICAgICAgICAgIGVuZEJsb2NrID0gbm93LkFkZChkdXJhdGlvblNlY29uZGFyeUNyb3dkU2FsZSAqIDg2NDAwKTsKICAgICAgICAgIC8vRW1pdCBldmVudCB3aGVuIGNyb3dkc2FsZSBzdGF0ZSBjaGFuZ2VzCiAgICAgICAgICBTdGF0ZUNoYW5nZWQodHJ1ZSk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICAgIHJldmVydCgpOwogICAgfQogICAgCgogICAgLyoKICAgICogVG8gc2V0IHByaWNlIGZvciBJQUMgVG9rZW4gcGVyIGV0aGVyCiAgICAqLwogICAgZnVuY3Rpb24gc2V0UHJpY2UodWludCBfdG9rZW5zUGVyRXRoZXIpIHB1YmxpYyBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKCBfdG9rZW5zUGVyRXRoZXIgIT0gMCk7CiAgICAgICAgZ2V0UHJpY2UgPSBfdG9rZW5zUGVyRXRoZXI7CiAgICAgICAgdGFyZ2V0VG9BY2hpZXZlID0gKDUwMDAwKjEwMGUxOCkvKDEyKl90b2tlbnNQZXJFdGhlcik7CiAgICAgICAgLy9FbWl0IGV2ZW50IHdoZW4gY3Jvd2RzYWxlIHN0YXRlIGNoYW5nZXMKICAgICAgICBTdGF0ZUNoYW5nZWQodHJ1ZSk7CiAgICB9CgogICAgLyoKICAgICogVG8gY3JlYXRlIGFuZCBhc3NpZ24gSUFDIFRva2VucyB0byB0cmFuc2FjdGlvbiBpbml0aWF0b3IKICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgaW50ZXJuYWwgc3RvcEluRW1lcmdlbmN5ICByZXNwZWN0VGltZUZyYW1lIHsKICAgICAgICAvL01ha2Ugc3VyZSBzZW50IEV0aCBpcyBub3QgMAogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlICE9IDApOwogICAgICAgIC8vSW5pdGlhbGx5IGNvdW50IHdpdGhvdXQgZ2l2aW5nIGRpc2NvdW50CiAgICAgICAgdWludDI1NiBpYWNUb1NlbmQgPSAobXNnLnZhbHVlLk11bChnZXRQcmljZSkpLzFlMTg7CiAgICAgICAgLy9jYWxjdWxhdGUgcHJpY2UgdG8gYXZhaWwgNTAlIGRpc2NvdW50CiAgICAgICAgdWludDI1NiBwcmljZVRvQXZhaWw1MFBlcmNlbnREaXNjb3VudCA9IG51bWJlck9mVG9rZW5zVG9BdmFpbDUwUGVyY2VudERpc2NvdW50LkRpdigyKmdldFByaWNlKS5NdWwoMWUxOCk7CiAgICAgICAgLy9jYWxjdWxhdGUgcHJpY2Ugb2YgdG9rZW5zIGF0IDI1JSBkaXNjb3VudAogICAgICAgIHVpbnQyNTYgcHJpY2VUb0F2YWlsMjVQZXJjZW50RGlzY291bnQgPSAzKm51bWJlck9mVG9rZW5zVG9BdmFpbDI1cGVyY2VudERpc2NvdW50LkRpdig0KmdldFByaWNlKS5NdWwoMWUxOCk7CiAgICAgICAgLy9DaGVjayBpZiBsZXNzIHRoYW4gbWluaW11bSBudW1iZXIgb2YgdG9rZW5zIGFyZSBib3VnaHQKICAgICAgICBpZihpYWNUb1NlbmQgPCBtaW5pbXVtTnVtYmVyT2ZUb2tlbnMpewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihtc2cudmFsdWUgPj0gcHJpY2VUb0F2YWlsMjVQZXJjZW50RGlzY291bnQgJiYgbXNnLnZhbHVlIDwgcHJpY2VUb0F2YWlsNTBQZXJjZW50RGlzY291bnQpewogICAgICAgICAgICAvL2dyYW50IHRva2VucyBhY2NvcmRpbmcgdG8gMjUlIGRpc2NvdW50CiAgICAgICAgICAgIGlhY1RvU2VuZCA9ICgoKG1zZy52YWx1ZS5NdWwoZ2V0UHJpY2UpKS5NdWwoNCkpLkRpdigzKSkvMWUxODsKICAgICAgICB9CiAgICAgICAgLy9jaGVjayBpZiB1c2VyIGlzIGVsaWdpYmxlIGZvciA1MCUgZGlzY291bnQKICAgICAgICBlbHNlIGlmKG1zZy52YWx1ZSA+PSBwcmljZVRvQXZhaWw1MFBlcmNlbnREaXNjb3VudCl7CiAgICAgICAgICAgIC8vaGVyZSB0b2tlbnMgYXJlIGdpdmVuIGF0IDUwJSBkaXNjb3VudAogICAgICAgICAgICBpYWNUb1NlbmQgPSAobXNnLnZhbHVlLk11bCgyKmdldFByaWNlKSkvMWUxODsKICAgICAgICB9CiAgICAgICAgLy9kZWZhdWx0IGNhc2U6IG5vIGRpc2NvdW50CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlhY1RvU2VuZCA9IChtc2cudmFsdWUuTXVsKGdldFByaWNlKSkvMWUxODsKICAgICAgICB9CiAgICAgICAgLy93ZSBzaG91bGQgbm90IGJlIHN1cHBseWluZyBtb3JlIHRva2VucyB0aGFuIG1heENhcAogICAgICAgIGFzc2VydChpYWNUb1NlbmQuQWRkKHRvdGFsU3VwcGx5Rm9yQ3Jvd2RzYWxlQW5kTWludCkgPD0gbWF4Q2FwKTsKICAgICAgICAvL2luY3JlYXNlIHRvdGFsU3VwcGx5CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5BZGQoaWFjVG9TZW5kKTsKCiAgICAgICAgdG90YWxTdXBwbHlGb3JDcm93ZHNhbGVBbmRNaW50ID0gdG90YWxTdXBwbHlGb3JDcm93ZHNhbGVBbmRNaW50LkFkZChpYWNUb1NlbmQpOwoKICAgICAgICBpZihFVEhSZWNlaXZlZCA8IHRhcmdldFRvQWNoaWV2ZSl7CiAgICAgICAgICAgIC8vdHJhbnNmZXIgZXRoZXIgdG8gY29pbmJhc2UgYWNjb3VudAogICAgICAgICAgICBjb2luYmFzZS50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBHZXRJQUNGdW5kQWNjb3VudCgpLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICAvL3N0b3JlIEVUSFJlY2VpdmVkCiAgICAgICAgRVRIUmVjZWl2ZWQgPSBFVEhSZWNlaXZlZC5BZGQobXNnLnZhbHVlKTsKICAgICAgICAvL0VtaXQgZXZlbnQgZm9yIGNvbnRyaWJ1dGlvbgogICAgICAgIFJlY2VpdmVkRVRIKGJlbmVmaWNpYXJ5LEVUSFJlY2VpdmVkKTsKICAgICAgICBiYWxhbmNlc1tiZW5lZmljaWFyeV0gPSBiYWxhbmNlc1tiZW5lZmljaWFyeV0uQWRkKGlhY1RvU2VuZCk7CgogICAgICAgIFRva2VuU3VwcGxpZWQoYmVuZWZpY2lhcnksIGlhY1RvU2VuZCwgbXNnLnZhbHVlKTsKICAgICAgICAvL0VtaXQgZXZlbnQgd2hlbiBjcm93ZHNhbGUgc3RhdGUgY2hhbmdlcwogICAgICAgIFN0YXRlQ2hhbmdlZCh0cnVlKTsKICAgIH0KCiAgICAvKgogICAgKiBUbyBlbmFibGUgb3duZXIgdG8gbWludCB0b2tlbnMKICAgICovCiAgICBmdW5jdGlvbiBNaW50QW5kVHJhbnNmZXJUb2tlbihhZGRyZXNzIGJlbmVmaWNpYXJ5LHVpbnQyNTYgaWFjVG9DcmVkaXQsYnl0ZXMzMiBjb21tZW50KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIC8vQXZhaWxhYmxlIGFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgc3RhcnRlZAogICAgICAgIGFzc2VydChjcm93ZHNhbGVTdGF0dXMgPT0gMSAmJiBiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvL251bWJlciBvZiB0b2tlbnMgdG8gbWludCBzaG91bGQgYmUgd2hvbGUgbnVtYmVyCiAgICAgICAgcmVxdWlyZShpYWNUb0NyZWRpdCA+PSAxKTsKICAgICAgICAvL0NoZWNrIHdoZXRoZXIgdG9rZW5zIGFyZSBhdmFpbGFibGUgb3Igbm90CiAgICAgICAgYXNzZXJ0KHRvdGFsU3VwcGx5Rm9yQ3Jvd2RzYWxlQW5kTWludCA8PSBtYXhDYXApOwogICAgICAgIC8vQ2hlY2sgd2hldGhlciB0aGUgYW1vdW50IG9mIHRva2VuIGFyZSBhdmFpbGFibGUgdG8gdHJhbnNmZXIKICAgICAgICByZXF1aXJlKHRvdGFsU3VwcGx5Rm9yQ3Jvd2RzYWxlQW5kTWludC5BZGQoaWFjVG9DcmVkaXQpIDw9IG1heENhcCk7CiAgICAgICAgLy9VcGRhdGUgSUFDIFRva2VuIGJhbGFuY2UgZm9yIGJlbmVmaWNpYXJ5CiAgICAgICAgYmFsYW5jZXNbYmVuZWZpY2lhcnldID0gYmFsYW5jZXNbYmVuZWZpY2lhcnldLkFkZChpYWNUb0NyZWRpdCk7CiAgICAgICAgLy9VcGRhdGUgdG90YWwgc3VwcGx5IGZvciBJQUMgVG9rZW4KICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LkFkZChpYWNUb0NyZWRpdCk7CiAgICAgICAgdG90YWxTdXBwbHlGb3JDcm93ZHNhbGVBbmRNaW50ID0gdG90YWxTdXBwbHlGb3JDcm93ZHNhbGVBbmRNaW50LkFkZChpYWNUb0NyZWRpdCk7CiAgICAgICAgLy8gc2VuZCBldmVudCBmb3IgdHJhbnNmZXJyaW5nIElBQyBUb2tlbiBvbiBvZmZsaW5lIHBheW1lbnQKICAgICAgICBNaW50QW5kVHJhbnNmZXJJQUMoYmVuZWZpY2lhcnksIGlhY1RvQ3JlZGl0LCBjb21tZW50KTsKICAgICAgICAvL0VtaXQgZXZlbnQgd2hlbiBjcm93ZHNhbGUgc3RhdGUgY2hhbmdlcwogICAgICAgIFN0YXRlQ2hhbmdlZCh0cnVlKTsKICAgIH0KCiAgICAvKgogICAgKiBUbyBlbmFibGUgdHJhbnNmZXJyaW5nIHRva2VucyBmcm9tIGNvbXBhbnkgaW52ZW50b3J5CiAgICAqLwogICAgZnVuY3Rpb24gVHJhbnNmZXJGcm9tQ29tcGFueUludmVudG9yeShhZGRyZXNzIGJlbmVmaWNpYXJ5LHVpbnQyNTYgaWFjVG9DcmVkaXQsYnl0ZXMzMiBjb21tZW50KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIC8vQXZhaWxhYmxlIGFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgc3RhcnRlZAogICAgICAgIGFzc2VydChzdGFydEJsb2NrICE9IDAgJiYgYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy9DaGVjayB3aGV0aGVyIHRva2VucyBhcmUgYXZhaWxhYmxlIG9yIG5vdAogICAgICAgIGFzc2VydCh0b3RhbFN1cHBseUZyb21JbnZlbnRvcnkgPD0gbWF4Q2FwQ29tcGFueUludmVudG9yeSAmJiAhaW52ZW50b3J5TG9ja2VkKTsKICAgICAgICAvL251bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIgc2hvdWxkIGJlIHdob2xlIG51bWJlcgogICAgICAgIHJlcXVpcmUoaWFjVG9DcmVkaXQgPj0gMSk7CiAgICAgICAgLy9DaGVjayB3aGV0aGVyIHRoZSBhbW91bnQgb2YgdG9rZW4gYXJlIGF2YWlsYWJsZSB0byB0cmFuc2ZlcgogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHlGcm9tSW52ZW50b3J5LkFkZChpYWNUb0NyZWRpdCkgPD0gbWF4Q2FwQ29tcGFueUludmVudG9yeSk7CiAgICAgICAgLy9VcGRhdGUgSUFDIFRva2VuIGJhbGFuY2UgZm9yIGJlbmVmaWNpYXJ5CiAgICAgICAgYmFsYW5jZXNbYmVuZWZpY2lhcnldID0gYmFsYW5jZXNbYmVuZWZpY2lhcnldLkFkZChpYWNUb0NyZWRpdCk7CiAgICAgICAgLy9VcGRhdGUgdG90YWwgc3VwcGx5IGZvciBJQUMgVG9rZW4KICAgICAgICB0b3RhbFN1cHBseUZyb21JbnZlbnRvcnkgPSB0b3RhbFN1cHBseUZyb21JbnZlbnRvcnkuQWRkKGlhY1RvQ3JlZGl0KTsKICAgICAgICAvL1VwZGF0ZSB0b3RhbCBzdXBwbHkgZm9yIElBQyBUb2tlbgogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuQWRkKGlhY1RvQ3JlZGl0KTsKICAgICAgICAvL3RvdGFsIG51bWJlciBvZiB0b2tlbnMgcmVtYWluaW5nIGluIGludmVudG9yeQogICAgICAgIHRvdGFsUmVtYWluSW5JbnZlbnRvcnkgPSB0b3RhbFJlbWFpbkluSW52ZW50b3J5LlN1YihpYWNUb0NyZWRpdCk7CiAgICAgICAgLy9zZW5kIGV2ZW50IGZvciB0cmFuc2ZlcnJpbmcgSUFDIFRva2VuIG9uIG9mZmxpbmUgcGF5bWVudAogICAgICAgIFN1Y2Nlc3NmdWxseVRyYW5zZmVyZWRGcm9tQ29tcGFueUludmVudG9yeShiZW5lZmljaWFyeSwgaWFjVG9DcmVkaXQsIGNvbW1lbnQpOwogICAgICAgIC8vRW1pdCBldmVudCB3aGVuIGNyb3dkc2FsZSBzdGF0ZSBjaGFuZ2VzCiAgICAgICAgU3RhdGVDaGFuZ2VkKHRydWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIExvY2tJbnZlbnRvcnkgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShzdGFydEJsb2NrID4gMCAmJiBub3cgPj0gc3RhcnRCbG9jay5BZGQoZHVyYXRpb25Dcm93ZFNhbGUuQWRkKDkwIGRheXMpKSAmJiAhaW52ZW50b3J5TG9ja2VkKTsKICAgICAgICBhZGRyZXNzIGludmVudG9yeUNvbnRyYWN0QWRkcmVzcyA9IG9iak1ldGFkYS5nZXRBZGRyZXNzKGludmVudG9yeUNvbnRyYWN0SUQpOwogICAgICAgIHJlcXVpcmUoaW52ZW50b3J5Q29udHJhY3RBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGJhbGFuY2VzW2ludmVudG9yeUNvbnRyYWN0QWRkcmVzc10gPSB0b3RhbFJlbWFpbkluSW52ZW50b3J5OwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuQWRkKHRvdGFsUmVtYWluSW5JbnZlbnRvcnkpOwogICAgICAgIG9iakNvbXBhbnlJbnZlbnRvcnkgPSBDb21wYW55SW52ZW50b3J5KGludmVudG9yeUNvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgb2JqQ29tcGFueUludmVudG9yeS5pbml0aWF0ZUxvY2tpbmcodG90YWxTdXBwbHlGcm9tSW52ZW50b3J5KTsKICAgICAgICBpbnZlbnRvcnlMb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIC8qCiAgICAqIEZpbmFsaXplIHRoZSBjcm93ZHNhbGUKICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgICAgLy9NYWtlIHN1cmUgU2FsZSBpcyBydW5uaW5nCiAgICAgICAgICAvL2ZpbmFsaXplIHNob3VsZCBiZSBjYWxsZWQgb25seSBpZiBjcm93ZHNhbGUgaXMgcnVubmluZwogICAgICAgICAgYXNzZXJ0KGNyb3dkc2FsZVN0YXR1cyA9PSAxICYmIChjcm93ZFNhbGVUeXBlID09IDEgfHwgY3Jvd2RTYWxlVHlwZSA9PSAyKSk7CiAgICAgICAgICAvL2ZpbmFsaXplIG9ubHkgaWYgbGVzcyB0aGFuIG1pbmltdW0gbnVtYmVyIG9mIHRva2VucyBhcmUgbGVmdCBvciBpZiB0aW1lIGlzIHVwCiAgICAgICAgICBhc3NlcnQobWF4Q2FwLlN1Yih0b3RhbFN1cHBseUZvckNyb3dkc2FsZUFuZE1pbnQpIDwgbWluaW11bU51bWJlck9mVG9rZW5zIHx8IG5vdyA+PSBlbmRCbG9jayk7CiAgICAgICAgICAvL2Nyb3dkc2FsZSBpcyBlbmRlZAogICAgICAgICAgY3Jvd2RzYWxlU3RhdHVzID0gMjsKICAgICAgICAgIC8vdXBkYXRlIGVuZEJsb2NrIHRvIHRoZSBhY3R1YWwgZW5kaW5nIG9mIGNyb3dkc2FsZQogICAgICAgICAgZW5kQmxvY2sgPSBub3c7CiAgICAgICAgICAvL0VtaXQgZXZlbnQgd2hlbiBjcm93ZHNhbGUgc3RhdGUgY2hhbmdlcwogICAgICAgICAgU3RhdGVDaGFuZ2VkKHRydWUpOwogICAgfQoKICAgIC8qCiAgICAqIFRvIGVuYWJsZSB0cmFuc2ZlcnMgb2YgSUFDIFRva2VuIGFueXRpbWUgb3duZXIgd2lzaGVzCiAgICAqLwogICAgZnVuY3Rpb24gdW5sb2NrKCkgcHVibGljIG9ubHlPd25lcgogICAgewogICAgICAgIC8vdW5sb2NrIHdpbGwgaGFwcGVuIGFmdGVyIDkwIGRheXMgb2YgZW5kaW5nIG9mIGNyb3dkc2FsZQogICAgICAgIC8vY3Jvd2RzYWxlIGl0c2VsZiBiZWluZyBvZiAyNSBkYXlzCiAgICAgICAgYXNzZXJ0KGNyb3dkc2FsZVN0YXR1cz09MiAmJiBub3cgPj0gc3RhcnRCbG9jay5BZGQoZHVyYXRpb25Dcm93ZFNhbGUuQWRkKDkwIGRheXMpKSk7CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICAgICAgLy9FbWl0IGV2ZW50IHdoZW4gY3Jvd2RzYWxlIHN0YXRlIGNoYW5nZXMKICAgICAgICBTdGF0ZUNoYW5nZWQodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHBheWFibGUgZnVuY3Rpb24gdG8gYWNjZXB0IGV0aGVyLgogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGNyZWF0ZVRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0KCiAgIC8qCiAgICAqIEZhaWxzYWZlIGRyYWluCiAgICAqLwogICBmdW5jdGlvbiBkcmFpbigpIHB1YmxpYyAgb25seU93bmVyIHsKICAgICAgICBHZXRJQUNGdW5kQWNjb3VudCgpLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQp9'.
	

]
