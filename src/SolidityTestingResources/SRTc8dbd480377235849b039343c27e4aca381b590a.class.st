Class {
	#name : #SRTc8dbd480377235849b039343c27e4aca381b590a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc8dbd480377235849b039343c27e4aca381b590a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgogLyoKICogQ29udHJhY3QgdGhhdCBpcyB3b3JraW5nIHdpdGggRVJDMjIzIHRva2VucwogKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjIzCiAqLwoKLy8vIEB0aXRsZSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCAtIFN0YW5kYXJkIGNvbnRyYWN0IGltcGxlbWVudGF0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggRVJDMjIzIHRva2Vucy4KY29udHJhY3QgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewoKICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRyYW5zYWN0aW9uIGluaXRpYXRvciwgYW5hbG9ndWUgb2YgbXNnLnNlbmRlcgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX2RhdGEgRGF0YSBjb250YWluaWcgYSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kL29yIHBhcmFtZXRlcnMKICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWM7Cn0KCi8vLyBAdGl0bGUgQmFzZSBUb2tlbiBjb250cmFjdCAtIEZ1bmN0aW9ucyB0byBiZSBpbXBsZW1lbnRlZCBieSB0b2tlbiBjb250cmFjdHMuCmNvbnRyYWN0IFRva2VuIHsKICAgIC8qCiAgICAgKiBJbXBsZW1lbnRzIEVSQyAyMCBzdGFuZGFyZC4KICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvZjkwODY0YTNkMmIyYjQ1YzRkZWNmOTVlZmQyNmIzZjBjMjc2MDUxYS9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAgICAgKgogICAgICogIEFkZGVkIHN1cHBvcnQgZm9yIHRoZSBFUkMgMjIzICJ0b2tlbkZhbGxiYWNrIiBtZXRob2QgaW4gYSAidHJhbnNmZXIiIGZ1bmN0aW9uIHdpdGggYSBwYXlsb2FkLgogICAgICogIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMjMKICAgICAqLwoKICAgIC8qCiAgICAgKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgICAqIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgICogaXMgcmVwbGFjZWQgd2l0aDoKICAgICAqIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgICogVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgICAqIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgICogY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICAgKiBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAgKi8KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8qCiAgICAgKiBFUkMgMjAKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIC8qCiAgICAgKiBFUkMgMjIzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qCiAgICAgKiBFdmVudHMKICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICAvLyBUaGVyZSBpcyBubyBFUkMyMjMgY29tcGF0aWJsZSBUcmFuc2ZlciBldmVudCwgd2l0aCBgX2RhdGFgIGluY2x1ZGVkLgp9CgoKLy8vIEB0aXRsZSBTdGFuZGFyZCB0b2tlbiBjb250cmFjdCAtIFN0YW5kYXJkIHRva2VuIGltcGxlbWVudGF0aW9uLgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuIHsKCiAgICAvKgogICAgICogRGF0YSBzdHJ1Y3R1cmVzCiAgICAgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBub3RpY2UgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAuCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgc2VuZGVyJ3MgdG9rZW5zIHRvIGEgZ2l2ZW4gYWRkcmVzcy4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlci4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYCBhbmQgdHJpZ2dlcgogICAgLy8vIHRva2VuRmFsbGJhY2sgaWYgc2VuZGVyIGlzIGEgY29udHJhY3QuCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBhbm90aGVyIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzLgogICAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlci4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIF9kYXRhIERhdGEgdG8gYmUgc2VudCB0byB0b2tlbkZhbGxiYWNrCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgICAgIGJ5dGVzIF9kYXRhKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcihfdG8sIF92YWx1ZSkpOwoKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkuCiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KCiAgICAgICAgaWYgKGNvZGVMZW5ndGggPiAwKSB7CiAgICAgICAgICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgICAgICAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBfZnJvbWAgdG8gYF90b2AgaWYgYG1zZy5zZW5kZXJgIGlzIGFsbG93ZWQuCiAgICAvLy8gQGRldiBBbGxvd3MgZm9yIGFuIGFwcHJvdmVkIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZQogICAgLy8vIGFkZHJlc3MgdG8gYW5vdGhlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGFyZSB3aXRoZHJhd24uCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9mcm9tICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwoKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgYF9zcGVuZGVyYCB0byB0cmFuc2ZlciBgX3ZhbHVlYCB0b2tlbnMgZnJvbSBgbXNnLnNlbmRlcmAgdG8gYW55IGFkZHJlc3MuCiAgICAvLy8gQGRldiBTZXRzIGFwcHJvdmVkIGFtb3VudCBvZiB0b2tlbnMgZm9yIHNwZW5kZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiBhbGxvd2VkIGFjY291bnQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgYXBwcm92ZWQgdG9rZW5zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3NwZW5kZXIgIT0gMHgwKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoX3ZhbHVlID09IDAgfHwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCk7CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qCiAgICAgKiBSZWFkIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBhbGxvd2VkIHRva2VucyB0aGF0IGEgc3BlbmRlciBjYW4gdHJhbnNmZXIgb24KICAgIC8vLyBiZWhhbGYgb2YgYSB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgdG9rZW4gc3BlbmRlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgcmVtYWluaW5nIGFsbG93YW5jZSBmb3Igc3BlbmRlci4KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKICAgICAgICBjb25zdGFudAogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgdG9rZW5zIG93bmVkIGJ5IHRoZSBnaXZlbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYmFsYW5jZSBvZiBvd25lci4KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgUmFpZGVuIFRva2VuCmNvbnRyYWN0IFJhaWRlblRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8qCiAgICAgKiAgVGVybWlub2xvZ3k6CiAgICAgKiAgMSB0b2tlbiB1bml0ID0gUmVpCiAgICAgKiAgMSB0b2tlbiA9IFJETiA9IFJlaSAqIG11bHRpcGxpZXIKICAgICAqICBtdWx0aXBsaWVyIHNldCBmcm9tIHRva2VuJ3MgbnVtYmVyIG9mIGRlY2ltYWxzIChpLmUuIDEwICoqIGRlY2ltYWxzKQogICAgICovCgogICAgLyoKICAgICAqICBUb2tlbiBtZXRhZGF0YQogICAgICovCiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIG5hbWUgPSAiUmFpZGVuIFRva2VuIjsKICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgc3ltYm9sID0gIlJETiI7CiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKICAgIHVpbnQgY29uc3RhbnQgbXVsdGlwbGllciA9IDEwICoqIHVpbnQoZGVjaW1hbHMpOwoKICAgIGV2ZW50IERlcGxveWVkKHVpbnQgaW5kZXhlZCBfdG90YWxfc3VwcGx5KTsKICAgIGV2ZW50IEJ1cm50KAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfcmVjZWl2ZXIsCiAgICAgICAgdWludCBpbmRleGVkIF9udW0sCiAgICAgICAgdWludCBpbmRleGVkIF90b3RhbF9zdXBwbHkKICAgICk7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgZHV0Y2ggYXVjdGlvbiBjb250cmFjdCBhZGRyZXNzCiAgICAvLy8gYW5kIGFzc2lnbnMgYWxsIHRva2VucyB0byBkdXRjaCBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBhdWN0aW9uX2FkZHJlc3MgQWRkcmVzcyBvZiBkdXRjaCBhdWN0aW9uIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSB3YWxsZXRfYWRkcmVzcyBBZGRyZXNzIG9mIHdhbGxldC4KICAgIC8vLyBAcGFyYW0gaW5pdGlhbF9zdXBwbHkgTnVtYmVyIG9mIGluaXRpYWxseSBwcm92aWRlZCB0b2tlbiB1bml0cyAoUmVpKS4KICAgIGZ1bmN0aW9uIFJhaWRlblRva2VuKAogICAgICAgIGFkZHJlc3MgYXVjdGlvbl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3Mgd2FsbGV0X2FkZHJlc3MsCiAgICAgICAgdWludCBpbml0aWFsX3N1cHBseSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBBdWN0aW9uIGFkZHJlc3Mgc2hvdWxkIG5vdCBiZSBudWxsLgogICAgICAgIHJlcXVpcmUoYXVjdGlvbl9hZGRyZXNzICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZSh3YWxsZXRfYWRkcmVzcyAhPSAweDApOwoKICAgICAgICAvLyBJbml0aWFsIHN1cHBseSBpcyBpbiBSZWkKICAgICAgICByZXF1aXJlKGluaXRpYWxfc3VwcGx5ID4gbXVsdGlwbGllcik7CgogICAgICAgIC8vIFRvdGFsIHN1cHBseSBvZiBSZWkgYXQgZGVwbG95bWVudAogICAgICAgIHRvdGFsU3VwcGx5ID0gaW5pdGlhbF9zdXBwbHk7CgogICAgICAgIGJhbGFuY2VzW2F1Y3Rpb25fYWRkcmVzc10gPSBpbml0aWFsX3N1cHBseSAvIDI7CiAgICAgICAgYmFsYW5jZXNbd2FsbGV0X2FkZHJlc3NdID0gaW5pdGlhbF9zdXBwbHkgLyAyOwoKICAgICAgICBUcmFuc2ZlcigweDAsIGF1Y3Rpb25fYWRkcmVzcywgYmFsYW5jZXNbYXVjdGlvbl9hZGRyZXNzXSk7CiAgICAgICAgVHJhbnNmZXIoMHgwLCB3YWxsZXRfYWRkcmVzcywgYmFsYW5jZXNbd2FsbGV0X2FkZHJlc3NdKTsKCiAgICAgICAgRGVwbG95ZWQodG90YWxTdXBwbHkpOwoKICAgICAgICBhc3NlcnQodG90YWxTdXBwbHkgPT0gYmFsYW5jZXNbYXVjdGlvbl9hZGRyZXNzXSArIGJhbGFuY2VzW3dhbGxldF9hZGRyZXNzXSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQWxsb3dzIGBtc2cuc2VuZGVyYCB0byBzaW1wbHkgZGVzdHJveSBgbnVtYCB0b2tlbiB1bml0cyAoUmVpKS4gVGhpcyBtZWFucyB0aGUgdG90YWwKICAgIC8vLyB0b2tlbiBzdXBwbHkgd2lsbCBkZWNyZWFzZS4KICAgIC8vLyBAZGV2IEFsbG93cyB0byBkZXN0cm95IHRva2VuIHVuaXRzIChSZWkpLgogICAgLy8vIEBwYXJhbSBudW0gTnVtYmVyIG9mIHRva2VuIHVuaXRzIChSZWkpIHRvIGJ1cm4uCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgbnVtKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobnVtID4gMCk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBudW0pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPj0gbnVtKTsKCiAgICAgICAgdWludCBwcmVfYmFsYW5jZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBudW07CiAgICAgICAgdG90YWxTdXBwbHkgLT0gbnVtOwogICAgICAgIEJ1cm50KG1zZy5zZW5kZXIsIG51bSwgdG90YWxTdXBwbHkpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgbnVtKTsKCiAgICAgICAgYXNzZXJ0KGJhbGFuY2VzW21zZy5zZW5kZXJdID09IHByZV9iYWxhbmNlIC0gbnVtKTsKICAgIH0KCn0KCgovLy8gQHRpdGxlIER1dGNoIGF1Y3Rpb24gY29udHJhY3QgLSBkaXN0cmlidXRpb24gb2YgYSBmaXhlZCBudW1iZXIgb2YgdG9rZW5zIHVzaW5nIGFuIGF1Y3Rpb24uCi8vLyBUaGUgY29udHJhY3QgY29kZSBpcyBpbnNwaXJlZCBieSB0aGUgR25vc2lzIGF1Y3Rpb24gY29udHJhY3QuIE1haW4gZGlmZmVyZW5jZSBpcyB0aGF0IHRoZQovLy8gYXVjdGlvbiBlbmRzIGlmIGEgZml4ZWQgbnVtYmVyIG9mIHRva2VucyB3YXMgc29sZC4KY29udHJhY3QgRHV0Y2hBdWN0aW9uIHsKICAgIC8qCiAgICAgKiBBdWN0aW9uIGZvciB0aGUgUkROIFRva2VuLgogICAgICoKICAgICAqIFRlcm1pbm9sb2d5OgogICAgICogMSB0b2tlbiB1bml0ID0gUmVpCiAgICAgKiAxIHRva2VuID0gUkROID0gUmVpICogdG9rZW5fbXVsdGlwbGllcgogICAgICogdG9rZW5fbXVsdGlwbGllciBzZXQgZnJvbSB0b2tlbidzIG51bWJlciBvZiBkZWNpbWFscyAoaS5lLiAxMCAqKiBkZWNpbWFscykKICAgICAqLwoKICAgIC8vIFdhaXQgNyBkYXlzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGF1Y3Rpb24sIGJlZm9yZSBheW9uZSBjYW4gY2xhaW0gdG9rZW5zCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyB0b2tlbl9jbGFpbV93YWl0aW5nX3BlcmlvZCA9IDUgbWludXRlczsKCiAgICAvLyBCaWQgdmFsdWUgb3ZlciB3aGljaCB0aGUgYWRkcmVzcyBoYXMgdG8gYmUgd2hpdGVsaXN0ZWQKICAgIC8vIEF0IGRlcGxveW1lbnQgbW9tZW50LCBlcXVpdmFsZW50IHdpdGggJDE1LDAwMAogICAgdWludCBjb25zdGFudCBwdWJsaWMgYmlkX3RocmVzaG9sZCA9IDkgZXRoZXI7CgogICAgLyoKICAgICAqIFN0b3JhZ2UKICAgICAqLwoKICAgIFJhaWRlblRva2VuIHB1YmxpYyB0b2tlbjsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyX2FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXRfYWRkcmVzczsKCiAgICAvLyBQcmljZSBkZWNheSBmdW5jdGlvbiBwYXJhbWV0ZXJzIHRvIGJlIGNoYW5nZWQgZGVwZW5kaW5nIG9uIHRoZSBkZXNpcmVkIG91dGNvbWUKCiAgICAvLyBTdGFydGluZyBwcmljZSBpbiBXRUk7IGUuZy4gMiAqIDEwICoqIDE4CiAgICB1aW50IHB1YmxpYyBwcmljZV9zdGFydDsKCiAgICAvLyBEaXZpc29yIGNvbnN0YW50OyBlLmcuIDUyNDg4MDAwMAogICAgdWludCBwdWJsaWMgcHJpY2VfY29uc3RhbnQ7CgogICAgLy8gRGl2aXNvciBleHBvbmVudDsgZS5nLiAzCiAgICB1aW50MzIgcHVibGljIHByaWNlX2V4cG9uZW50OwoKICAgIC8vIEZvciBjYWxjdWxhdGluZyBlbGFwc2VkIHRpbWUgZm9yIHByaWNlCiAgICB1aW50IHB1YmxpYyBzdGFydF90aW1lOwogICAgdWludCBwdWJsaWMgZW5kX3RpbWU7CiAgICB1aW50IHB1YmxpYyBzdGFydF9ibG9jazsKCiAgICAvLyBLZWVwIHRyYWNrIG9mIGFsbCBFVEggcmVjZWl2ZWQgaW4gdGhlIGJpZHMKICAgIHVpbnQgcHVibGljIHJlY2VpdmVkX3dlaTsKCiAgICAvLyBLZWVwIHRyYWNrIG9mIGN1bXVsYXRpdmUgRVRIIGZ1bmRzIGZvciB3aGljaCB0aGUgdG9rZW5zIGhhdmUgYmVlbiBjbGFpbWVkCiAgICB1aW50IHB1YmxpYyBmdW5kc19jbGFpbWVkOwoKICAgIHVpbnQgcHVibGljIHRva2VuX211bHRpcGxpZXI7CgogICAgLy8gVG90YWwgbnVtYmVyIG9mIFJlaSAoUkROICogdG9rZW5fbXVsdGlwbGllcikgdGhhdCB3aWxsIGJlIGF1Y3Rpb25lZAogICAgdWludCBwdWJsaWMgbnVtX3Rva2Vuc19hdWN0aW9uZWQ7CgogICAgLy8gV2VpIHBlciBSRE4gKFJlaSAqIHRva2VuX211bHRpcGxpZXIpCiAgICB1aW50IHB1YmxpYyBmaW5hbF9wcmljZTsKCiAgICAvLyBCaWRkZXIgYWRkcmVzcyA9PiBiaWQgdmFsdWUKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJpZHM7CgogICAgLy8gV2hpdGVsaXN0IGZvciBhZGRyZXNzZXMgdGhhdCB3YW50IHRvIGJpZCBtb3JlIHRoYW4gYmlkX3RocmVzaG9sZAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0OwoKICAgIFN0YWdlcyBwdWJsaWMgc3RhZ2U7CgogICAgLyoKICAgICAqIEVudW1zCiAgICAgKi8KICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBBdWN0aW9uRGVwbG95ZWQsCiAgICAgICAgQXVjdGlvblNldFVwLAogICAgICAgIEF1Y3Rpb25TdGFydGVkLAogICAgICAgIEF1Y3Rpb25FbmRlZCwKICAgICAgICBUb2tlbnNEaXN0cmlidXRlZAogICAgfQoKICAgIC8qCiAgICAgKiBNb2RpZmllcnMKICAgICAqLwogICAgbW9kaWZpZXIgYXRTdGFnZShTdGFnZXMgX3N0YWdlKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBfc3RhZ2UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJfYWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogRXZlbnRzCiAgICAgKi8KCiAgICBldmVudCBEZXBsb3llZCgKICAgICAgICB1aW50IGluZGV4ZWQgX3ByaWNlX3N0YXJ0LAogICAgICAgIHVpbnQgaW5kZXhlZCBfcHJpY2VfY29uc3RhbnQsCiAgICAgICAgdWludDMyIGluZGV4ZWQgX3ByaWNlX2V4cG9uZW50CiAgICApOwogICAgZXZlbnQgU2V0dXAoKTsKICAgIGV2ZW50IEF1Y3Rpb25TdGFydGVkKHVpbnQgaW5kZXhlZCBfc3RhcnRfdGltZSwgdWludCBpbmRleGVkIF9ibG9ja19udW1iZXIpOwogICAgZXZlbnQgQmlkU3VibWlzc2lvbigKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NlbmRlciwKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfbWlzc2luZ19mdW5kcwogICAgKTsKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF9yZWNpcGllbnQsIHVpbnQgX3NlbnRfYW1vdW50KTsKICAgIGV2ZW50IEF1Y3Rpb25FbmRlZCh1aW50IF9maW5hbF9wcmljZSk7CiAgICBldmVudCBUb2tlbnNEaXN0cmlidXRlZCgpOwoKICAgIC8qCiAgICAgKiBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBmdW5jdGlvbiBzZXRzIHRoZSBzdGFydGluZyBwcmljZSwgZGl2aXNvciBjb25zdGFudCBhbmQKICAgIC8vLyBkaXZpc29yIGV4cG9uZW50IGZvciBjYWxjdWxhdGluZyB0aGUgRHV0Y2ggQXVjdGlvbiBwcmljZS4KICAgIC8vLyBAcGFyYW0gX3dhbGxldF9hZGRyZXNzIFdhbGxldCBhZGRyZXNzIHRvIHdoaWNoIGFsbCBjb250cmlidXRlZCBFVEggd2lsbCBiZSBmb3J3YXJkZWQuCiAgICAvLy8gQHBhcmFtIF9wcmljZV9zdGFydCBIaWdoIHByaWNlIGluIFdFSSBhdCB3aGljaCB0aGUgYXVjdGlvbiBzdGFydHMuCiAgICAvLy8gQHBhcmFtIF9wcmljZV9jb25zdGFudCBBdWN0aW9uIHByaWNlIGRpdmlzb3IgY29uc3RhbnQuCiAgICAvLy8gQHBhcmFtIF9wcmljZV9leHBvbmVudCBBdWN0aW9uIHByaWNlIGRpdmlzb3IgZXhwb25lbnQuCiAgICBmdW5jdGlvbiBEdXRjaEF1Y3Rpb24oCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0X2FkZHJlc3MsCiAgICAgICAgdWludCBfcHJpY2Vfc3RhcnQsCiAgICAgICAgdWludCBfcHJpY2VfY29uc3RhbnQsCiAgICAgICAgdWludDMyIF9wcmljZV9leHBvbmVudCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF93YWxsZXRfYWRkcmVzcyAhPSAweDApOwogICAgICAgIHdhbGxldF9hZGRyZXNzID0gX3dhbGxldF9hZGRyZXNzOwoKICAgICAgICBvd25lcl9hZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQ7CiAgICAgICAgY2hhbmdlU2V0dGluZ3MoX3ByaWNlX3N0YXJ0LCBfcHJpY2VfY29uc3RhbnQsIF9wcmljZV9leHBvbmVudCk7CiAgICAgICAgRGVwbG95ZWQoX3ByaWNlX3N0YXJ0LCBfcHJpY2VfY29uc3RhbnQsIF9wcmljZV9leHBvbmVudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBjb250cmFjdCwgd2hpY2ggY2FsbHMgYmlkKCkgaWYgdGhlIGF1Y3Rpb24gaGFzIHN0YXJ0ZWQuCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkgewogICAgICAgIGJpZCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBgX3Rva2VuX2FkZHJlc3NgIGFzIHRoZSB0b2tlbiBhZGRyZXNzIHRvIGJlIHVzZWQgaW4gdGhlIGF1Y3Rpb24uCiAgICAvLy8gQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0cyBhZGRyZXNzZXMuCiAgICAvLy8gQHBhcmFtIF90b2tlbl9hZGRyZXNzIFRva2VuIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIF90b2tlbl9hZGRyZXNzKSBwdWJsaWMgaXNPd25lciBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQpIHsKICAgICAgICByZXF1aXJlKF90b2tlbl9hZGRyZXNzICE9IDB4MCk7CiAgICAgICAgdG9rZW4gPSBSYWlkZW5Ub2tlbihfdG9rZW5fYWRkcmVzcyk7CgogICAgICAgIC8vIEdldCBudW1iZXIgb2YgUmVpIChSRE4gKiB0b2tlbl9tdWx0aXBsaWVyKSB0byBiZSBhdWN0aW9uZWQgZnJvbSB0b2tlbiBhdWN0aW9uIGJhbGFuY2UKICAgICAgICBudW1fdG9rZW5zX2F1Y3Rpb25lZCA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBudW1iZXIgb2YgdGhlIHRva2VuIG11bHRpcGxpZXIgZm9yIGl0cyBkZWNpbWFscwogICAgICAgIHRva2VuX211bHRpcGxpZXIgPSAxMCAqKiB1aW50KHRva2VuLmRlY2ltYWxzKCkpOwoKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uU2V0VXA7CiAgICAgICAgU2V0dXAoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYF9wcmljZV9zdGFydGAsIGBfcHJpY2VfY29uc3RhbnRgIGFuZCBgX3ByaWNlX2V4cG9uZW50YCBhcwogICAgLy8vIHRoZSBuZXcgc3RhcnRpbmcgcHJpY2UsIHByaWNlIGRpdmlzb3IgY29uc3RhbnQgYW5kIHByaWNlIGRpdmlzb3IgZXhwb25lbnQuCiAgICAvLy8gQGRldiBDaGFuZ2VzIGF1Y3Rpb24gcHJpY2UgZnVuY3Rpb24gcGFyYW1ldGVycyBiZWZvcmUgYXVjdGlvbiBpcyBzdGFydGVkLgogICAgLy8vIEBwYXJhbSBfcHJpY2Vfc3RhcnQgVXBkYXRlZCBzdGFydCBwcmljZS4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX2NvbnN0YW50IFVwZGF0ZWQgcHJpY2UgZGl2aXNvciBjb25zdGFudC4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX2V4cG9uZW50IFVwZGF0ZWQgcHJpY2UgZGl2aXNvciBleHBvbmVudC4KICAgIGZ1bmN0aW9uIGNoYW5nZVNldHRpbmdzKAogICAgICAgIHVpbnQgX3ByaWNlX3N0YXJ0LAogICAgICAgIHVpbnQgX3ByaWNlX2NvbnN0YW50LAogICAgICAgIHVpbnQzMiBfcHJpY2VfZXhwb25lbnQpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKHN0YWdlID09IFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQgfHwgc3RhZ2UgPT0gU3RhZ2VzLkF1Y3Rpb25TZXRVcCk7CiAgICAgICAgcmVxdWlyZShfcHJpY2Vfc3RhcnQgPiAwKTsKICAgICAgICByZXF1aXJlKF9wcmljZV9jb25zdGFudCA+IDApOwoKICAgICAgICBwcmljZV9zdGFydCA9IF9wcmljZV9zdGFydDsKICAgICAgICBwcmljZV9jb25zdGFudCA9IF9wcmljZV9jb25zdGFudDsKICAgICAgICBwcmljZV9leHBvbmVudCA9IF9wcmljZV9leHBvbmVudDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBZGRzIGFjY291bnQgYWRkcmVzc2VzIHRvIHdoaXRlbGlzdC4KICAgIC8vLyBAZGV2IEFkZHMgYWNjb3VudCBhZGRyZXNzZXMgdG8gd2hpdGVsaXN0LgogICAgLy8vIEBwYXJhbSBfYmlkZGVyX2FkZHJlc3NlcyBBcnJheSBvZiBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBhZGRUb1doaXRlbGlzdChhZGRyZXNzW10gX2JpZGRlcl9hZGRyZXNzZXMpIHB1YmxpYyBpc093bmVyIHsKICAgICAgICBmb3IgKHVpbnQzMiBpID0gMDsgaSA8IF9iaWRkZXJfYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdFtfYmlkZGVyX2FkZHJlc3Nlc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZW1vdmVzIGFjY291bnQgYWRkcmVzc2VzIGZyb20gd2hpdGVsaXN0LgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhY2NvdW50IGFkZHJlc3NlcyBmcm9tIHdoaXRlbGlzdC4KICAgIC8vLyBAcGFyYW0gX2JpZGRlcl9hZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gcmVtb3ZlRnJvbVdoaXRlbGlzdChhZGRyZXNzW10gX2JpZGRlcl9hZGRyZXNzZXMpIHB1YmxpYyBpc093bmVyIHsKICAgICAgICBmb3IgKHVpbnQzMiBpID0gMDsgaSA8IF9iaWRkZXJfYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdFtfYmlkZGVyX2FkZHJlc3Nlc1tpXV0gPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgU3RhcnQgdGhlIGF1Y3Rpb24uCiAgICAvLy8gQGRldiBTdGFydHMgYXVjdGlvbiBhbmQgc2V0cyBzdGFydF90aW1lLgogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9uKCkgcHVibGljIGlzT3duZXIgYXRTdGFnZShTdGFnZXMuQXVjdGlvblNldFVwKSB7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuQXVjdGlvblN0YXJ0ZWQ7CiAgICAgICAgc3RhcnRfdGltZSA9IG5vdzsKICAgICAgICBzdGFydF9ibG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBBdWN0aW9uU3RhcnRlZChzdGFydF90aW1lLCBzdGFydF9ibG9jayk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRmluYWxpemUgdGhlIGF1Y3Rpb24gLSBzZXRzIHRoZSBmaW5hbCBSRE4gdG9rZW4gcHJpY2UgYW5kIGNoYW5nZXMgdGhlIGF1Y3Rpb24KICAgIC8vLyBzdGFnZSBhZnRlciBubyBiaWRzIGFyZSBhbGxvd2VkIGFueW1vcmUuCiAgICAvLy8gQGRldiBGaW5hbGl6ZSBhdWN0aW9uIGFuZCBzZXQgdGhlIGZpbmFsIFJETiB0b2tlbiBwcmljZS4KICAgIGZ1bmN0aW9uIGZpbmFsaXplQXVjdGlvbigpIHB1YmxpYyBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkKICAgIHsKICAgICAgICAvLyBNaXNzaW5nIGZ1bmRzIHNob3VsZCBiZSAwIGF0IHRoaXMgcG9pbnQKICAgICAgICB1aW50IG1pc3NpbmdfZnVuZHMgPSBtaXNzaW5nRnVuZHNUb0VuZEF1Y3Rpb24oKTsKICAgICAgICByZXF1aXJlKG1pc3NpbmdfZnVuZHMgPT0gMCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZmluYWwgcHJpY2UgPSBXRUkgLyBSRE4gPSBXRUkgLyAoUmVpIC8gdG9rZW5fbXVsdGlwbGllcikKICAgICAgICAvLyBSZW1pbmRlcjogbnVtX3Rva2Vuc19hdWN0aW9uZWQgaXMgdGhlIG51bWJlciBvZiBSZWkgKFJETiAqIHRva2VuX211bHRpcGxpZXIpIHRoYXQgYXJlIGF1Y3Rpb25lZAogICAgICAgIGZpbmFsX3ByaWNlID0gdG9rZW5fbXVsdGlwbGllciAqIHJlY2VpdmVkX3dlaSAvIG51bV90b2tlbnNfYXVjdGlvbmVkOwoKICAgICAgICBlbmRfdGltZSA9IG5vdzsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uRW5kZWQ7CiAgICAgICAgQXVjdGlvbkVuZGVkKGZpbmFsX3ByaWNlKTsKCiAgICAgICAgYXNzZXJ0KGZpbmFsX3ByaWNlID4gMCk7CiAgICB9CgogICAgLy8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBBdWN0aW9uIEZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0KCgogICAgLy8vIEBub3RpY2UgU2VuZCBgbXNnLnZhbHVlYCBXRUkgdG8gdGhlIGF1Y3Rpb24gZnJvbSB0aGUgYG1zZy5zZW5kZXJgIGFjY291bnQuCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gc2VuZCBhIGJpZCB0byB0aGUgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGJpZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25TdGFydGVkKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShiaWRzW21zZy5zZW5kZXJdICsgbXNnLnZhbHVlIDw9IGJpZF90aHJlc2hvbGQgfHwgd2hpdGVsaXN0W21zZy5zZW5kZXJdKTsKICAgICAgICBhc3NlcnQoYmlkc1ttc2cuc2VuZGVyXSArIG1zZy52YWx1ZSA+PSBtc2cudmFsdWUpOwoKICAgICAgICAvLyBNaXNzaW5nIGZ1bmRzIHdpdGhvdXQgdGhlIGN1cnJlbnQgYmlkIHZhbHVlCiAgICAgICAgdWludCBtaXNzaW5nX2Z1bmRzID0gbWlzc2luZ0Z1bmRzVG9FbmRBdWN0aW9uKCk7CgogICAgICAgIC8vIFdlIHJlcXVpcmUgYmlkIHZhbHVlcyB0byBiZSBsZXNzIHRoYW4gdGhlIGZ1bmRzIG1pc3NpbmcgdG8gZW5kIHRoZSBhdWN0aW9uCiAgICAgICAgLy8gYXQgdGhlIGN1cnJlbnQgcHJpY2UuCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPD0gbWlzc2luZ19mdW5kcyk7CgogICAgICAgIGJpZHNbbXNnLnNlbmRlcl0gKz0gbXNnLnZhbHVlOwogICAgICAgIHJlY2VpdmVkX3dlaSArPSBtc2cudmFsdWU7CgogICAgICAgIC8vIFNlbmQgYmlkIGFtb3VudCB0byB3YWxsZXQKICAgICAgICB3YWxsZXRfYWRkcmVzcy50cmFuc2Zlcihtc2cudmFsdWUpOwoKICAgICAgICBCaWRTdWJtaXNzaW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgbWlzc2luZ19mdW5kcyk7CgogICAgICAgIGFzc2VydChyZWNlaXZlZF93ZWkgPj0gbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDbGFpbSBhdWN0aW9uIHRva2VucyBmb3IgYG1zZy5zZW5kZXJgIGFmdGVyIHRoZSBhdWN0aW9uIGhhcyBlbmRlZC4KICAgIC8vLyBAZGV2IENsYWltcyB0b2tlbnMgZm9yIGBtc2cuc2VuZGVyYCBhZnRlciBhdWN0aW9uLiBUbyBiZSB1c2VkIGlmIHRva2VucyBjYW4KICAgIC8vLyBiZSBjbGFpbWVkIGJ5IGJlbmVmaWNpYXJpZXMsIGluZGl2aWR1YWxseS4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKCkgcHVibGljIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25FbmRlZCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBwcm94eUNsYWltVG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENsYWltIGF1Y3Rpb24gdG9rZW5zIGZvciBgcmVjZWl2ZXJfYWRkcmVzc2AgYWZ0ZXIgdGhlIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBkZXYgQ2xhaW1zIHRva2VucyBmb3IgYHJlY2VpdmVyX2FkZHJlc3NgIGFmdGVyIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBwYXJhbSByZWNlaXZlcl9hZGRyZXNzIFRva2VucyB3aWxsIGJlIGFzc2lnbmVkIHRvIHRoaXMgYWRkcmVzcyBpZiBlbGlnaWJsZS4KICAgIGZ1bmN0aW9uIHByb3h5Q2xhaW1Ub2tlbnMoYWRkcmVzcyByZWNlaXZlcl9hZGRyZXNzKQogICAgICAgIHB1YmxpYwogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25FbmRlZCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIFdhaXRpbmcgcGVyaW9kIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGF1Y3Rpb24sIGJlZm9yZSBhbnlvbmUgY2FuIGNsYWltIHRva2VucwogICAgICAgIC8vIEVuc3VyZXMgZW5vdWdoIHRpbWUgdG8gY2hlY2sgaWYgYXVjdGlvbiB3YXMgZmluYWxpemVkIGNvcnJlY3RseQogICAgICAgIC8vIGJlZm9yZSB1c2VycyBzdGFydCB0cmFuc2FjdGluZyB0b2tlbnMKICAgICAgICByZXF1aXJlKG5vdyA+IGVuZF90aW1lICsgdG9rZW5fY2xhaW1fd2FpdGluZ19wZXJpb2QpOwogICAgICAgIHJlcXVpcmUocmVjZWl2ZXJfYWRkcmVzcyAhPSAweDApOwoKICAgICAgICBpZiAoYmlkc1tyZWNlaXZlcl9hZGRyZXNzXSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIE51bWJlciBvZiBSZWkgPSBiaWRfd2VpIC8gUmVpID0gYmlkX3dlaSAvICh3ZWlfcGVyX1JETiAqIHRva2VuX211bHRpcGxpZXIpCiAgICAgICAgdWludCBudW0gPSAodG9rZW5fbXVsdGlwbGllciAqIGJpZHNbcmVjZWl2ZXJfYWRkcmVzc10pIC8gZmluYWxfcHJpY2U7CgogICAgICAgIC8vIER1ZSB0byBmaW5hbF9wcmljZSBmbG9vciByb3VuZGluZywgdGhlIG51bWJlciBvZiBhc3NpZ25lZCB0b2tlbnMgbWF5IGJlIGhpZ2hlcgogICAgICAgIC8vIHRoYW4gZXhwZWN0ZWQuIFRoZXJlZm9yZSwgdGhlIG51bWJlciBvZiByZW1haW5pbmcgdW5hc3NpZ25lZCBhdWN0aW9uIHRva2VucwogICAgICAgIC8vIG1heSBiZSBzbWFsbGVyIHRoYW4gdGhlIG51bWJlciBvZiB0b2tlbnMgbmVlZGVkIGZvciB0aGUgbGFzdCBjbGFpbVRva2VucyBjYWxsCiAgICAgICAgdWludCBhdWN0aW9uX3Rva2Vuc19iYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIGlmIChudW0gPiBhdWN0aW9uX3Rva2Vuc19iYWxhbmNlKSB7CiAgICAgICAgICAgIG51bSA9IGF1Y3Rpb25fdG9rZW5zX2JhbGFuY2U7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiBmdW5kcyBmb3Igd2hpY2ggdG9rZW5zIGhhdmUgYmVlbiBjbGFpbWVkCiAgICAgICAgZnVuZHNfY2xhaW1lZCArPSBiaWRzW3JlY2VpdmVyX2FkZHJlc3NdOwoKICAgICAgICAvLyBTZXQgcmVjZWl2ZXIgYmlkIHRvIDAgYmVmb3JlIGFzc2lnbmluZyB0b2tlbnMKICAgICAgICBiaWRzW3JlY2VpdmVyX2FkZHJlc3NdID0gMDsKCiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihyZWNlaXZlcl9hZGRyZXNzLCBudW0pKTsKCiAgICAgICAgQ2xhaW1lZFRva2VucyhyZWNlaXZlcl9hZGRyZXNzLCBudW0pOwoKICAgICAgICAvLyBBZnRlciB0aGUgbGFzdCB0b2tlbnMgYXJlIGNsYWltZWQsIHdlIGNoYW5nZSB0aGUgYXVjdGlvbiBzdGFnZQogICAgICAgIC8vIER1ZSB0byB0aGUgYWJvdmUgbG9naWMsIHJvdW5kaW5nIGVycm9ycyB3aWxsIG5vdCBiZSBhbiBpc3N1ZQogICAgICAgIGlmIChmdW5kc19jbGFpbWVkID09IHJlY2VpdmVkX3dlaSkgewogICAgICAgICAgICBzdGFnZSA9IFN0YWdlcy5Ub2tlbnNEaXN0cmlidXRlZDsKICAgICAgICAgICAgVG9rZW5zRGlzdHJpYnV0ZWQoKTsKICAgICAgICB9CgogICAgICAgIGFzc2VydCh0b2tlbi5iYWxhbmNlT2YocmVjZWl2ZXJfYWRkcmVzcykgPj0gbnVtKTsKICAgICAgICBhc3NlcnQoYmlkc1tyZWNlaXZlcl9hZGRyZXNzXSA9PSAwKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIFJETiBwcmljZSBpbiBXRUkgZHVyaW5nIHRoZSBhdWN0aW9uLCBhdCB0aGUgdGltZSBvZgogICAgLy8vIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4gUmV0dXJucyBgMGAgaWYgYXVjdGlvbiBoYXMgZW5kZWQuCiAgICAvLy8gUmV0dXJucyBgcHJpY2Vfc3RhcnRgIGJlZm9yZSBhdWN0aW9uIGhhcyBzdGFydGVkLgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgY3VycmVudCBSRE4gdG9rZW4gcHJpY2UgaW4gV0VJLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBXRUkgcGVyIFJETiAodG9rZW5fbXVsdGlwbGllciAqIFJlaSkuCiAgICBmdW5jdGlvbiBwcmljZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5BdWN0aW9uRW5kZWQgfHwKICAgICAgICAgICAgc3RhZ2UgPT0gU3RhZ2VzLlRva2Vuc0Rpc3RyaWJ1dGVkKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsY1Rva2VuUHJpY2UoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIG1pc3NpbmcgZnVuZHMgbmVlZGVkIHRvIGVuZCB0aGUgYXVjdGlvbiwKICAgIC8vLyBjYWxjdWxhdGVkIGF0IHRoZSBjdXJyZW50IFJETiBwcmljZSBpbiBXRUkuCiAgICAvLy8gQGRldiBUaGUgbWlzc2luZyBmdW5kcyBhbW91bnQgbmVjZXNzYXJ5IHRvIGVuZCB0aGUgYXVjdGlvbiBhdCB0aGUgY3VycmVudCBSRE4gcHJpY2UgaW4gV0VJLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgbWlzc2luZyBmdW5kcyBhbW91bnQgaW4gV0VJLgogICAgZnVuY3Rpb24gbWlzc2luZ0Z1bmRzVG9FbmRBdWN0aW9uKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gbnVtX3Rva2Vuc19hdWN0aW9uZWQgPSB0b3RhbCBudW1iZXIgb2YgUmVpIChSRE4gKiB0b2tlbl9tdWx0aXBsaWVyKSB0aGF0IGlzIGF1Y3Rpb25lZAogICAgICAgIHVpbnQgcmVxdWlyZWRfd2VpX2F0X3ByaWNlID0gbnVtX3Rva2Vuc19hdWN0aW9uZWQgKiBwcmljZSgpIC8gdG9rZW5fbXVsdGlwbGllcjsKICAgICAgICBpZiAocmVxdWlyZWRfd2VpX2F0X3ByaWNlIDw9IHJlY2VpdmVkX3dlaSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIGFzc2VydChyZXF1aXJlZF93ZWlfYXRfcHJpY2UgLSByZWNlaXZlZF93ZWkgPiAwKTsKICAgICAgICByZXR1cm4gcmVxdWlyZWRfd2VpX2F0X3ByaWNlIC0gcmVjZWl2ZWRfd2VpOwogICAgfQoKICAgIC8qCiAgICAgKiAgUHJpdmF0ZSBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIHRva2VuIHByaWNlIChXRUkgLyBSRE4pIGF0IHRoZSBjdXJyZW50IHRpbWVzdGFtcAogICAgLy8vIGR1cmluZyB0aGUgYXVjdGlvbjsgZWxhcHNlZCB0aW1lID0gMCBiZWZvcmUgYXVjdGlvbiBzdGFydHMuCiAgICAvLy8gQmFzZWQgb24gdGhlIHByb3ZpZGVkIHBhcmFtZXRlcnMsIHRoZSBwcmljZSBkb2VzIG5vdCBjaGFuZ2UgaW4gdGhlIGZpcnN0CiAgICAvLy8gYHByaWNlX2NvbnN0YW50XigxL3ByaWNlX2V4cG9uZW50KWAgc2Vjb25kcyBkdWUgdG8gcm91bmRpbmcuCiAgICAvLy8gUm91bmRpbmcgaW4gYGRlY2F5X3JhdGVgIGFsc28gcHJvZHVjZXMgdmFsdWVzIHRoYXQgaW5jcmVhc2UgaW5zdGVhZCBvZiBkZWNyZWFzZQogICAgLy8vIGluIHRoZSBiZWdpbm5pbmc7IHRoZXNlIHNwaWtlcyBkZWNyZWFzZSBvdmVyIHRpbWUgYW5kIGFyZSBub3RpY2VhYmxlCiAgICAvLy8gb25seSBpbiBmaXJzdCBob3Vycy4gVGhpcyBzaG91bGQgYmUgY2FsY3VsYXRlZCBiZWZvcmUgdXNhZ2UuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSB0b2tlbiBwcmljZSAtIFdlaSBwZXIgUkROLgogICAgZnVuY3Rpb24gY2FsY1Rva2VuUHJpY2UoKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGVsYXBzZWQ7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkgewogICAgICAgICAgICBlbGFwc2VkID0gbm93IC0gc3RhcnRfdGltZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgZGVjYXlfcmF0ZSA9IGVsYXBzZWQgKiogcHJpY2VfZXhwb25lbnQgLyBwcmljZV9jb25zdGFudDsKICAgICAgICByZXR1cm4gcHJpY2Vfc3RhcnQgKiAoMSArIGVsYXBzZWQpIC8gKDEgKyBlbGFwc2VkICsgZGVjYXlfcmF0ZSk7CiAgICB9Cn0='.
	

]
