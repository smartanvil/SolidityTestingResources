Class {
	#name : #SRT491C05896EF656d7FeE0FB90CE487315ff0aC14C,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT491C05896EF656d7FeE0FB90CE487315ff0aC14C >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKCmNvbnRyYWN0IEVSQzcyMSB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKfQoKY29udHJhY3QgR2VuZVNjaWVuY2VJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gaXNHZW5lU2NpZW5jZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gbWl4R2VuZXModWludDI1NiBnZW5lczEsIHVpbnQyNTYgZ2VuZXMyLCB1aW50MjU2IHRhcmdldEJsb2NrKSBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7Cn0KCmNvbnRyYWN0IEJvdEFjY2Vzc0NvbnRyb2wgewogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwogICAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDT08oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNMZXZlbCgpIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNlb0FkZHJlc3MgPSBfbmV3Q0VPOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2ZvQWRkcmVzcyA9IF9uZXdDRk87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q09PKGFkZHJlc3MgX25ld0NPTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShfbmV3Q09PICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjb29BZGRyZXNzID0gX25ld0NPTzsKICAgIH0KCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cn0KCgpjb250cmFjdCBCb3RCYXNlIGlzIEJvdEFjY2Vzc0NvbnRyb2wgewogICAgZXZlbnQgQmlydGgoCiAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgIHVpbnQyNTYgYm90SWQsCiAgICAgIHVpbnQyNTYgbWF0cm9uSWQsCiAgICAgIHVpbnQyNTYgc2lyZUlkLAogICAgICB1aW50MjU2IGdlbmVzLAogICAgICB1aW50MjU2IGJpcnRoVGltZQogICAgKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgc3RydWN0IEJvdCB7CiAgICAgICAgdWludDI1NiBnZW5lczsKICAgICAgICB1aW50NjQgYmlydGhUaW1lOwogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwogICAgICAgIHVpbnQzMiBtYXRyb25JZDsKICAgICAgICB1aW50MzIgc2lyZUlkOwogICAgICAgIHVpbnQzMiBzaXJpbmdXaXRoSWQ7CiAgICAgICAgdWludDE2IGNvb2xkb3duSW5kZXg7CiAgICAgICAgdWludDE2IGdlbmVyYXRpb247CiAgICB9CgogICAgdWludDMyWzE0XSBwdWJsaWMgY29vbGRvd25zID0gWwogICAgICAgIHVpbnQzMigxIG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMigyIG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMig1IG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMigxMCBtaW51dGVzKSwKICAgICAgICB1aW50MzIoMzAgbWludXRlcyksCiAgICAgICAgdWludDMyKDEgaG91cnMpLAogICAgICAgIHVpbnQzMigyIGhvdXJzKSwKICAgICAgICB1aW50MzIoNCBob3VycyksCiAgICAgICAgdWludDMyKDggaG91cnMpLAogICAgICAgIHVpbnQzMigxNiBob3VycyksCiAgICAgICAgdWludDMyKDEgZGF5cyksCiAgICAgICAgdWludDMyKDIgZGF5cyksCiAgICAgICAgdWludDMyKDQgZGF5cyksCiAgICAgICAgdWludDMyKDcgZGF5cykKICAgIF07CgogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kc1BlckJsb2NrID0gMTU7CgogICAgQm90W10gYm90czsKCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBib3RJbmRleFRvT3duZXI7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBib3RJbmRleFRvQXBwcm92ZWQ7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBzaXJlQWxsb3dlZFRvQWRkcmVzczsKICAgIHVpbnQzMiBwdWJsaWMgZGVzdHJveWVkQm90czsKICAgIFNhbGVDbG9ja0F1Y3Rpb24gcHVibGljIHNhbGVBdWN0aW9uOwogICAgU2lyaW5nQ2xvY2tBdWN0aW9uIHB1YmxpYyBzaXJpbmdBdWN0aW9uOwoKICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBkZWxldGUgYm90SW5kZXhUb093bmVyW190b2tlbklkXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W190b10rKzsKICAgICAgICAgICAgYm90SW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKICAgICAgICB9CiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW190b2tlbklkXTsKICAgICAgICAgICAgZGVsZXRlIGJvdEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgfQogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQm90KAogICAgICAgIHVpbnQyNTYgX21hdHJvbklkLAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9nZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgX2dlbmVzLAogICAgICAgIGFkZHJlc3MgX293bmVyCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJlcXVpcmUoX21hdHJvbklkID09IHVpbnQyNTYodWludDMyKF9tYXRyb25JZCkpKTsKICAgICAgICByZXF1aXJlKF9zaXJlSWQgPT0gdWludDI1Nih1aW50MzIoX3NpcmVJZCkpKTsKICAgICAgICByZXF1aXJlKF9nZW5lcmF0aW9uID09IHVpbnQyNTYodWludDE2KF9nZW5lcmF0aW9uKSkpOwoKICAgICAgICB1aW50MTYgY29vbGRvd25JbmRleCA9IHVpbnQxNihfZ2VuZXJhdGlvbiAvIDIpOwogICAgICAgIGlmIChjb29sZG93bkluZGV4ID4gMTMpIHsKICAgICAgICAgICAgY29vbGRvd25JbmRleCA9IDEzOwogICAgICAgIH0KCiAgICAgICAgQm90IG1lbW9yeSBfYm90ID0gQm90KHsKICAgICAgICAgICAgZ2VuZXM6IF9nZW5lcywKICAgICAgICAgICAgYmlydGhUaW1lOiB1aW50NjQobm93KSwKICAgICAgICAgICAgY29vbGRvd25FbmRCbG9jazogMCwKICAgICAgICAgICAgbWF0cm9uSWQ6IHVpbnQzMihfbWF0cm9uSWQpLAogICAgICAgICAgICBzaXJlSWQ6IHVpbnQzMihfc2lyZUlkKSwKICAgICAgICAgICAgc2lyaW5nV2l0aElkOiAwLAogICAgICAgICAgICBjb29sZG93bkluZGV4OiBjb29sZG93bkluZGV4LAogICAgICAgICAgICBnZW5lcmF0aW9uOiB1aW50MTYoX2dlbmVyYXRpb24pCiAgICAgICAgfSk7CiAgICAgICAgdWludDI1NiBuZXdCb3RJZCA9IGJvdHMucHVzaChfYm90KSAtIDE7CgogICAgICAgIHJlcXVpcmUobmV3Qm90SWQgPT0gdWludDI1Nih1aW50MzIobmV3Qm90SWQpKSk7CgogICAgICAgIEJpcnRoKAogICAgICAgICAgICBfb3duZXIsCiAgICAgICAgICAgIG5ld0JvdElkLAogICAgICAgICAgICB1aW50MjU2KF9ib3QubWF0cm9uSWQpLAogICAgICAgICAgICB1aW50MjU2KF9ib3Quc2lyZUlkKSwKICAgICAgICAgICAgX2JvdC5nZW5lcywKICAgICAgICAgICAgdWludDI1NihfYm90LmJpcnRoVGltZSkKICAgICAgICk7CgogICAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld0JvdElkKTsKCiAgICAgICAgcmV0dXJuIG5ld0JvdElkOwogICAgfQoKICAgIGZ1bmN0aW9uIF9kZXN0cm95Qm90KHVpbnQyNTYgX2JvdElkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfYm90SWQgPiAwKTsKICAgICAgICBhZGRyZXNzIGZyb20gPSBib3RJbmRleFRvT3duZXJbX2JvdElkXTsKICAgICAgICByZXF1aXJlKGZyb20gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgZGVzdHJveWVkQm90cysrOwogICAgICAgIF90cmFuc2Zlcihmcm9tLCAwLCBfYm90SWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IHNlY3MpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHJlcXVpcmUoc2VjcyA8IGNvb2xkb3duc1swXSk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KfQoKCmNvbnRyYWN0IEJvdEV4dGVuc2lvbiBpcyBCb3RCYXNlIHsKICAgIGV2ZW50IExvY2sodWludDI1NiBib3RJZCwgdWludDE2IG1hc2spOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBleHRlbnNpb25zOwogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MTYpIGxvY2tzOwogICAgdWludDE2IGNvbnN0YW50IExPQ0tfQlJFRURJTkcgPSAxOwogICAgdWludDE2IGNvbnN0YW50IExPQ0tfVFJBTlNGRVIgPSAyOwogICAgdWludDE2IGNvbnN0YW50IExPQ0tfQUxMID0gTE9DS19CUkVFRElORyB8IExPQ0tfVFJBTlNGRVI7CgogICAgZnVuY3Rpb24gYWRkRXh0ZW5zaW9uKGFkZHJlc3MgX2NvbnRyYWN0KSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBleHRlbnNpb25zW19jb250cmFjdF0gPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUV4dGVuc2lvbihhZGRyZXNzIF9jb250cmFjdCkgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgZGVsZXRlIGV4dGVuc2lvbnNbX2NvbnRyYWN0XTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RXh0ZW5zaW9uKCkgewogICAgICAgIHJlcXVpcmUoZXh0ZW5zaW9uc1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dENyZWF0ZUJvdCgKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICB1aW50MjU2IF9zaXJlSWQsCiAgICAgICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9nZW5lcywKICAgICAgICBhZGRyZXNzIF9vd25lcgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFeHRlbnNpb24KICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBfY3JlYXRlQm90KF9tYXRyb25JZCwgX3NpcmVJZCwgX2dlbmVyYXRpb24sIF9nZW5lcywgX293bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleHREZXN0cm95Qm90KHVpbnQyNTYgX2JvdElkKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFeHRlbnNpb24KICAgIHsKICAgICAgICByZXF1aXJlKGxvY2tzW19ib3RJZF0gPT0gMCk7CgogICAgICAgIF9kZXN0cm95Qm90KF9ib3RJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0TG9ja0JvdCh1aW50MjU2IF9ib3RJZCwgdWludDE2IF9tYXNrKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFeHRlbnNpb24KICAgIHsKICAgICAgICBfbG9ja0JvdChfYm90SWQsIF9tYXNrKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfbG9ja0JvdCh1aW50MjU2IF9ib3RJZCwgdWludDE2IF9tYXNrKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZShfbWFzayA+IDApOwoKICAgICAgICB1aW50MTYgbWFzayA9IGxvY2tzW19ib3RJZF07CiAgICAgICAgcmVxdWlyZShtYXNrICYgX21hc2sgPT0gMCk7CgogICAgICAgIGlmIChfbWFzayAmIExPQ0tfQlJFRURJTkcgPiAwKSB7CiAgICAgICAgICAgIEJvdCBzdG9yYWdlIGJvdCA9IGJvdHNbX2JvdElkXTsKICAgICAgICAgICAgcmVxdWlyZShib3Quc2lyaW5nV2l0aElkID09IDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9tYXNrICYgTE9DS19UUkFOU0ZFUiA+IDApIHsKICAgICAgICAgICAgYWRkcmVzcyBvd25lciA9IGJvdEluZGV4VG9Pd25lcltfYm90SWRdOwogICAgICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3Moc2FsZUF1Y3Rpb24pKTsKICAgICAgICAgICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKHNpcmluZ0F1Y3Rpb24pKTsKICAgICAgICB9CgogICAgICAgIG1hc2sgfD0gX21hc2s7CgogICAgICAgIGxvY2tzW19ib3RJZF0gPSBtYXNrOwoKICAgICAgICBMb2NrKF9ib3RJZCwgbWFzayk7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0VW5sb2NrQm90KHVpbnQyNTYgX2JvdElkLCB1aW50MTYgX21hc2spCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUV4dGVuc2lvbgogICAgICAgIHJldHVybnMgKHVpbnQxNikKICAgIHsKICAgICAgICBfdW5sb2NrQm90KF9ib3RJZCwgX21hc2spOwogICAgfQoKICAgIGZ1bmN0aW9uIF91bmxvY2tCb3QodWludDI1NiBfYm90SWQsIHVpbnQxNiBfbWFzaykKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoX21hc2sgPiAwKTsKCiAgICAgICAgdWludDE2IG1hc2sgPSBsb2Nrc1tfYm90SWRdOwogICAgICAgIHJlcXVpcmUobWFzayAmIF9tYXNrID09IF9tYXNrKTsKICAgICAgICBtYXNrIF49IF9tYXNrOwoKICAgICAgICBsb2Nrc1tfYm90SWRdID0gbWFzazsKCiAgICAgICAgTG9jayhfYm90SWQsIG1hc2spOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dEdldExvY2sodWludDI1NiBfYm90SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIG9ubHlFeHRlbnNpb24KICAgICAgICByZXR1cm5zICh1aW50MTYpCiAgICB7CiAgICAgICAgcmV0dXJuIGxvY2tzW19ib3RJZF07CiAgICB9Cn0KCgpjb250cmFjdCBCb3RPd25lcnNoaXAgaXMgQm90RXh0ZW5zaW9uLCBFUkM3MjEgewogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkNyeXB0b0JvdHMiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQ0JUIjsKCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGJvdEluZGV4VG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGJvdEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgYm90SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHNhbGVBdWN0aW9uKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUobG9ja3NbX3Rva2VuSWRdICYgTE9DS19UUkFOU0ZFUiA9PSAwKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZSgKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUobG9ja3NbX3Rva2VuSWRdICYgTE9DS19UUkFOU0ZFUiA9PSAwKTsKICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUobG9ja3NbX3Rva2VuSWRdICYgTE9DS19UUkFOU0ZFUiA9PSAwKTsKICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBib3RzLmxlbmd0aCAtIGRlc3Ryb3llZEJvdHM7CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgb3duZXIgPSBib3RJbmRleFRvT3duZXJbX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbEJvdHMgPSBib3RzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwogICAgICAgICAgICB1aW50MjU2IGJvdElkOwogICAgICAgICAgICBmb3IgKGJvdElkID0gMDsgYm90SWQgPD0gdG90YWxCb3RzOyBib3RJZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoYm90SW5kZXhUb093bmVyW2JvdElkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gYm90SWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9Cn0KCgpjb250cmFjdCBCb3RCcmVlZGluZyBpcyBCb3RPd25lcnNoaXAgewogICAgZXZlbnQgUHJlZ25hbnQoYWRkcmVzcyBvd25lciwgdWludDI1NiBtYXRyb25JZCwgdWludDI1NiBzaXJlSWQsIHVpbnQyNTYgY29vbGRvd25FbmRCbG9jayk7CiAgICB1aW50MjU2IHB1YmxpYyBhdXRvQmlydGhGZWUgPSAyIGZpbm5leTsKICAgIHVpbnQyNTYgcHVibGljIHByZWduYW50Qm90czsKICAgIEdlbmVTY2llbmNlSW50ZXJmYWNlIHB1YmxpYyBnZW5lU2NpZW5jZTsKCiAgICBmdW5jdGlvbiBzZXRHZW5lU2NpZW5jZUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgR2VuZVNjaWVuY2VJbnRlcmZhY2UgY2FuZGlkYXRlQ29udHJhY3QgPSBHZW5lU2NpZW5jZUludGVyZmFjZShfYWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0dlbmVTY2llbmNlKCkpOwogICAgICAgIGdlbmVTY2llbmNlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzUmVhZHlUb0JyZWVkKHVpbnQyNTYgX2JvdElkLCBCb3QgX2JvdCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIChfYm90LnNpcmluZ1dpdGhJZCA9PSAwKSAmJgogICAgICAgICAgICAoX2JvdC5jb29sZG93bkVuZEJsb2NrIDw9IHVpbnQ2NChibG9jay5udW1iZXIpKSAmJgogICAgICAgICAgICAobG9ja3NbX2JvdElkXSAmIExPQ0tfQlJFRURJTkcgPT0gMCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzU2lyaW5nUGVybWl0dGVkKHVpbnQyNTYgX3NpcmVJZCwgdWludDI1NiBfbWF0cm9uSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFkZHJlc3MgbWF0cm9uT3duZXIgPSBib3RJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICBhZGRyZXNzIHNpcmVPd25lciA9IGJvdEluZGV4VG9Pd25lcltfc2lyZUlkXTsKICAgICAgICByZXR1cm4gKG1hdHJvbk93bmVyID09IHNpcmVPd25lciB8fCBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfc2lyZUlkXSA9PSBtYXRyb25Pd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gX3RyaWdnZXJDb29sZG93bihCb3Qgc3RvcmFnZSBfYm90KSBpbnRlcm5hbCB7CiAgICAgICAgX2JvdC5jb29sZG93bkVuZEJsb2NrID0gdWludDY0KChjb29sZG93bnNbX2JvdC5jb29sZG93bkluZGV4XS9zZWNvbmRzUGVyQmxvY2spICsgYmxvY2subnVtYmVyKTsKICAgICAgICBpZiAoX2JvdC5jb29sZG93bkluZGV4IDwgMTMpIHsKICAgICAgICAgICAgX2JvdC5jb29sZG93bkluZGV4ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmVTaXJpbmcoYWRkcmVzcyBfYWRkciwgdWludDI1NiBfc2lyZUlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3NpcmVJZCkpOwogICAgICAgIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdID0gX2FkZHI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QXV0b0JpcnRoRmVlKHVpbnQyNTYgdmFsKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBhdXRvQmlydGhGZWUgPSB2YWw7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzUmVhZHlUb0dpdmVCaXJ0aChCb3QgX21hdHJvbikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9tYXRyb24uc2lyaW5nV2l0aElkICE9IDApICYmIChfbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgPD0gdWludDY0KGJsb2NrLm51bWJlcikpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzUmVhZHlUb0JyZWVkKHVpbnQyNTYgX2JvdElkKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIEJvdCBzdG9yYWdlIGJvdCA9IGJvdHNbX2JvdElkXTsKICAgICAgICByZXR1cm4gX2JvdElkID4gMCAmJiBfaXNSZWFkeVRvQnJlZWQoX2JvdElkLCBib3QpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzUHJlZ25hbnQodWludDI1NiBfYm90SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIF9ib3RJZCA+IDAgJiYgYm90c1tfYm90SWRdLnNpcmluZ1dpdGhJZCAhPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICBCb3Qgc3RvcmFnZSBfbWF0cm9uLAogICAgICAgIHVpbnQyNTYgX21hdHJvbklkLAogICAgICAgIEJvdCBzdG9yYWdlIF9zaXJlLAogICAgICAgIHVpbnQyNTYgX3NpcmVJZAogICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIGlmIChfbWF0cm9uSWQgPT0gX3NpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfbWF0cm9uLm1hdHJvbklkID09IF9zaXJlSWQgfHwgX21hdHJvbi5zaXJlSWQgPT0gX3NpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSBfbWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb25JZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSAwIHx8IF9tYXRyb24ubWF0cm9uSWQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9zaXJlLm1hdHJvbklkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbi5zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX3NpcmUuc2lyZUlkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb24uc2lyZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gX2NhbkJyZWVkV2l0aFZpYUF1Y3Rpb24odWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIEJvdCBzdG9yYWdlIG1hdHJvbiA9IGJvdHNbX21hdHJvbklkXTsKICAgICAgICBCb3Qgc3RvcmFnZSBzaXJlID0gYm90c1tfc2lyZUlkXTsKICAgICAgICByZXR1cm4gX2lzVmFsaWRNYXRpbmdQYWlyKG1hdHJvbiwgX21hdHJvbklkLCBzaXJlLCBfc2lyZUlkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5CcmVlZFdpdGgodWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfbWF0cm9uSWQgPiAwKTsKICAgICAgICByZXF1aXJlKF9zaXJlSWQgPiAwKTsKICAgICAgICBCb3Qgc3RvcmFnZSBtYXRyb24gPSBib3RzW19tYXRyb25JZF07CiAgICAgICAgQm90IHN0b3JhZ2Ugc2lyZSA9IGJvdHNbX3NpcmVJZF07CiAgICAgICAgcmV0dXJuIF9pc1ZhbGlkTWF0aW5nUGFpcihtYXRyb24sIF9tYXRyb25JZCwgc2lyZSwgX3NpcmVJZCkgJiYKICAgICAgICAgICAgX2lzU2lyaW5nUGVybWl0dGVkKF9zaXJlSWQsIF9tYXRyb25JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2JyZWVkV2l0aCh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKSBpbnRlcm5hbCB7CiAgICAgICAgQm90IHN0b3JhZ2Ugc2lyZSA9IGJvdHNbX3NpcmVJZF07CiAgICAgICAgQm90IHN0b3JhZ2UgbWF0cm9uID0gYm90c1tfbWF0cm9uSWRdOwogICAgICAgIG1hdHJvbi5zaXJpbmdXaXRoSWQgPSB1aW50MzIoX3NpcmVJZCk7CiAgICAgICAgX3RyaWdnZXJDb29sZG93bihzaXJlKTsKICAgICAgICBfdHJpZ2dlckNvb2xkb3duKG1hdHJvbik7CiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19tYXRyb25JZF07CiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdOwogICAgICAgIHByZWduYW50Qm90cysrOwogICAgICAgIFByZWduYW50KGJvdEluZGV4VG9Pd25lcltfbWF0cm9uSWRdLCBfbWF0cm9uSWQsIF9zaXJlSWQsIG1hdHJvbi5jb29sZG93bkVuZEJsb2NrKTsKICAgIH0KCiAgICBmdW5jdGlvbiBicmVlZFdpdGhBdXRvKHVpbnQyNTYgX21hdHJvbklkLCB1aW50MjU2IF9zaXJlSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGF1dG9CaXJ0aEZlZSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbWF0cm9uSWQpKTsKICAgICAgICByZXF1aXJlKF9pc1NpcmluZ1Blcm1pdHRlZChfc2lyZUlkLCBfbWF0cm9uSWQpKTsKICAgICAgICBCb3Qgc3RvcmFnZSBtYXRyb24gPSBib3RzW19tYXRyb25JZF07CiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvQnJlZWQoX21hdHJvbklkLCBtYXRyb24pKTsKICAgICAgICBCb3Qgc3RvcmFnZSBzaXJlID0gYm90c1tfc2lyZUlkXTsKICAgICAgICByZXF1aXJlKF9pc1JlYWR5VG9CcmVlZChfc2lyZUlkLCBzaXJlKSk7CiAgICAgICAgcmVxdWlyZShfaXNWYWxpZE1hdGluZ1BhaXIoCiAgICAgICAgICAgIG1hdHJvbiwKICAgICAgICAgICAgX21hdHJvbklkLAogICAgICAgICAgICBzaXJlLAogICAgICAgICAgICBfc2lyZUlkCiAgICAgICAgKSk7CiAgICAgICAgX2JyZWVkV2l0aChfbWF0cm9uSWQsIF9zaXJlSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdpdmVCaXJ0aCh1aW50MjU2IF9tYXRyb25JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQm90IHN0b3JhZ2UgbWF0cm9uID0gYm90c1tfbWF0cm9uSWRdOwogICAgICAgIHJlcXVpcmUobWF0cm9uLmJpcnRoVGltZSAhPSAwKTsKICAgICAgICByZXF1aXJlKF9pc1JlYWR5VG9HaXZlQmlydGgobWF0cm9uKSk7CiAgICAgICAgdWludDI1NiBzaXJlSWQgPSBtYXRyb24uc2lyaW5nV2l0aElkOwogICAgICAgIEJvdCBzdG9yYWdlIHNpcmUgPSBib3RzW3NpcmVJZF07CiAgICAgICAgdWludDE2IHBhcmVudEdlbiA9IG1hdHJvbi5nZW5lcmF0aW9uOwogICAgICAgIGlmIChzaXJlLmdlbmVyYXRpb24gPiBtYXRyb24uZ2VuZXJhdGlvbikgewogICAgICAgICAgICBwYXJlbnRHZW4gPSBzaXJlLmdlbmVyYXRpb247CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgY2hpbGRHZW5lcyA9IGdlbmVTY2llbmNlLm1peEdlbmVzKG1hdHJvbi5nZW5lcywgc2lyZS5nZW5lcywgbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgLSAxKTsKICAgICAgICBhZGRyZXNzIG93bmVyID0gYm90SW5kZXhUb093bmVyW19tYXRyb25JZF07CiAgICAgICAgdWludDI1NiBib3RJZCA9IF9jcmVhdGVCb3QoX21hdHJvbklkLCBtYXRyb24uc2lyaW5nV2l0aElkLCBwYXJlbnRHZW4gKyAxLCBjaGlsZEdlbmVzLCBvd25lcik7CiAgICAgICAgZGVsZXRlIG1hdHJvbi5zaXJpbmdXaXRoSWQ7CiAgICAgICAgcHJlZ25hbnRCb3RzLS07CiAgICAgICAgbXNnLnNlbmRlci5zZW5kKGF1dG9CaXJ0aEZlZSk7CiAgICAgICAgcmV0dXJuIGJvdElkOwogICAgfQp9CgoKY29udHJhY3QgQ2xvY2tBdWN0aW9uQmFzZSB7CiAgICBzdHJ1Y3QgQXVjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwogICAgICAgIHVpbnQxMjggZW5kaW5nUHJpY2U7CiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CiAgICBFUkM3MjEgcHVibGljIG5vbkZ1bmdpYmxlQ29udHJhY3Q7CiAgICB1aW50MjU2IHB1YmxpYyBvd25lckN1dDsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikgdG9rZW5JZFRvQXVjdGlvbjsKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKAogICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgdWludDI1NiB0b2tlbklkLAogICAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsCiAgICAgIHVpbnQyNTYgZW5kaW5nUHJpY2UsCiAgICAgIHVpbnQyNTYgY3JlYXRpb25UaW1lLAogICAgICB1aW50MjU2IGR1cmF0aW9uCiAgICApOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHRvdGFsUHJpY2UsIGFkZHJlc3Mgc2VsbGVyLCBhZGRyZXNzIHdpbm5lciwgdWludDI1NiB0aW1lKTsKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQodWludDI1NiB0b2tlbklkLCBhZGRyZXNzIHNlbGxlciwgdWludDI1NiB0aW1lKTsKCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXJGcm9tKF9vd25lciwgdGhpcywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2FkZEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKICAgICAgICB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXSA9IF9hdWN0aW9uOwogICAgICAgIEF1Y3Rpb25DcmVhdGVkKAogICAgICAgICAgICBfYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5zdGFydGVkQXQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmR1cmF0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gX2NhbmNlbEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfc2VsbGVyKSBpbnRlcm5hbCB7CiAgICAgICAgX3JlbW92ZUF1Y3Rpb24oX3Rva2VuSWQpOwogICAgICAgIF90cmFuc2Zlcihfc2VsbGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbkNhbmNlbGxlZChfdG9rZW5JZCwgX3NlbGxlciwgdWludDI1Nihub3cpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBiaWRFeGNlc3MgPSBfYmlkQW1vdW50IC0gcHJpY2U7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbklkLCBwcmljZSwgc2VsbGVyLCBtc2cuc2VuZGVyLCB1aW50MjU2KG5vdykpOwogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfcmVtb3ZlQXVjdGlvbih1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2N1cnJlbnRQcmljZShBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IHNlY29uZHNQYXNzZWQgPSAwOwogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgICAgICBfYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBfc2Vjb25kc1Bhc3NlZAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKF9zZWNvbmRzUGFzc2VkID49IF9kdXJhdGlvbikgewogICAgICAgICAgICByZXR1cm4gX2VuZGluZ1ByaWNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9lbmRpbmdQcmljZSkgLSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpOwogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludDI1Nihfc2Vjb25kc1Bhc3NlZCkgLyBpbnQyNTYoX2R1cmF0aW9uKTsKICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZSA9IGludDI1Nihfc3RhcnRpbmdQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KGN1cnJlbnRQcmljZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gX3ByaWNlICogb3duZXJDdXQgLyAxMDAwMDsKICAgIH0KfQoKCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUocGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIFBhdXNlKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgoKY29udHJhY3QgQ2xvY2tBdWN0aW9uIGlzIFBhdXNhYmxlLCBDbG9ja0F1Y3Rpb25CYXNlIHsKICAgIGZ1bmN0aW9uIENsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyZXNzLCB1aW50MjU2IF9jdXQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfY3V0IDw9IDEwMDAwKTsKICAgICAgICBvd25lckN1dCA9IF9jdXQ7CgogICAgICAgIEVSQzcyMSBjYW5kaWRhdGVDb250cmFjdCA9IEVSQzcyMShfbmZ0QWRkcmVzcyk7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIHsKICAgICAgICBhZGRyZXNzIG5mdEFkZHJlc3MgPSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpOwogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBib29sIHJlcyA9IG5mdEFkZHJlc3Muc2VuZCh0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICBfZXNjcm93KG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb25XaGVuUGF1c2VkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuUGF1c2VkCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucwogICAgKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGVuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBzdGFydGVkQXQKICAgICkKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgIH0KCn0KCgpjb250cmFjdCBTaXJpbmdDbG9ja0F1Y3Rpb24gaXMgQ2xvY2tBdWN0aW9uIHsKICAgIGJvb2wgcHVibGljIGlzU2lyaW5nQ2xvY2tBdWN0aW9uID0gdHJ1ZTsKCiAgICBmdW5jdGlvbiBTaXJpbmdDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkciwgdWludDI1NiBfY3V0KSBwdWJsaWMKICAgICAgICBDbG9ja0F1Y3Rpb24oX25mdEFkZHIsIF9jdXQpIHt9CgogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbigKICAgICAgICB1aW50MjU2IF90b2tlbklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgYWRkcmVzcyBfc2VsbGVyCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSk7CiAgICAgICAgX2VzY3Jvdyhfc2VsbGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgfQoKICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIF90cmFuc2ZlcihzZWxsZXIsIF90b2tlbklkKTsKICAgIH0KCn0KCgpjb250cmFjdCBTYWxlQ2xvY2tBdWN0aW9uIGlzIENsb2NrQXVjdGlvbiB7CiAgICBib29sIHB1YmxpYyBpc1NhbGVDbG9ja0F1Y3Rpb24gPSB0cnVlOwogICAgdWludDI1NiBwdWJsaWMgZ2VuMFNhbGVDb3VudDsKICAgIHVpbnQyNTZbNV0gcHVibGljIGxhc3RHZW4wU2FsZVByaWNlczsKCiAgICBmdW5jdGlvbiBTYWxlQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHIsIHVpbnQyNTYgX2N1dCkgcHVibGljCiAgICAgICAgQ2xvY2tBdWN0aW9uKF9uZnRBZGRyLCBfY3V0KSB7fQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpOwogICAgICAgIF9lc2Nyb3coX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICB1aW50MjU2IHByaWNlID0gX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgIGlmIChzZWxsZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSkgewogICAgICAgICAgICBsYXN0R2VuMFNhbGVQcmljZXNbZ2VuMFNhbGVDb3VudCAlIDVdID0gcHJpY2U7CiAgICAgICAgICAgIGdlbjBTYWxlQ291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZUdlbjBTYWxlUHJpY2UoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBsYXN0R2VuMFNhbGVQcmljZXNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdW0gLyA1OwogICAgfQoKfQoKCmNvbnRyYWN0IEJvdEF1Y3Rpb24gaXMgQm90QnJlZWRpbmcgewogICAgZnVuY3Rpb24gc2V0U2FsZUF1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIFNhbGVDbG9ja0F1Y3Rpb24gY2FuZGlkYXRlQ29udHJhY3QgPSBTYWxlQ2xvY2tBdWN0aW9uKF9hZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2FsZUNsb2NrQXVjdGlvbigpKTsKICAgICAgICBzYWxlQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNpcmluZ0F1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIFNpcmluZ0Nsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNpcmluZ0Nsb2NrQXVjdGlvbihfYWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc1NpcmluZ0Nsb2NrQXVjdGlvbigpKTsKICAgICAgICBzaXJpbmdBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlU2FsZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfYm90SWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2JvdElkKSk7CiAgICAgICAgcmVxdWlyZSghaXNQcmVnbmFudChfYm90SWQpKTsKICAgICAgICBfYXBwcm92ZShfYm90SWQsIHNhbGVBdWN0aW9uKTsKICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfYm90SWQsCiAgICAgICAgICAgIF9zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBfZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIF9kdXJhdGlvbiwKICAgICAgICAgICAgbXNnLnNlbmRlcgogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlU2lyaW5nQXVjdGlvbigKICAgICAgICB1aW50MjU2IF9ib3RJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfYm90SWQpKTsKICAgICAgICByZXF1aXJlKGlzUmVhZHlUb0JyZWVkKF9ib3RJZCkpOwogICAgICAgIF9hcHByb3ZlKF9ib3RJZCwgc2lyaW5nQXVjdGlvbik7CiAgICAgICAgc2lyaW5nQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfYm90SWQsCiAgICAgICAgICAgIF9zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBfZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIF9kdXJhdGlvbiwKICAgICAgICAgICAgbXNnLnNlbmRlcgogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gYmlkT25TaXJpbmdBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9tYXRyb25JZCkpOwogICAgICAgIHJlcXVpcmUoaXNSZWFkeVRvQnJlZWQoX21hdHJvbklkKSk7CiAgICAgICAgcmVxdWlyZShfY2FuQnJlZWRXaXRoVmlhQXVjdGlvbihfbWF0cm9uSWQsIF9zaXJlSWQpKTsKICAgICAgICB1aW50MjU2IGN1cnJlbnRQcmljZSA9IHNpcmluZ0F1Y3Rpb24uZ2V0Q3VycmVudFByaWNlKF9zaXJlSWQpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGN1cnJlbnRQcmljZSArIGF1dG9CaXJ0aEZlZSk7CiAgICAgICAgc2lyaW5nQXVjdGlvbi5iaWQudmFsdWUobXNnLnZhbHVlIC0gYXV0b0JpcnRoRmVlKShfc2lyZUlkKTsKICAgICAgICBfYnJlZWRXaXRoKHVpbnQzMihfbWF0cm9uSWQpLCB1aW50MzIoX3NpcmVJZCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QXVjdGlvbkJhbGFuY2VzKCkgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgc2FsZUF1Y3Rpb24ud2l0aGRyYXdCYWxhbmNlKCk7CiAgICAgICAgc2lyaW5nQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKICAgIH0KfQoKCmNvbnRyYWN0IEJvdE1pbnRpbmcgaXMgQm90QXVjdGlvbiB7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUk9NT19DUkVBVElPTl9MSU1JVCA9IDUwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX0NSRUFUSU9OX0xJTUlUID0gNDUwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX1NUQVJUSU5HX1BSSUNFID0gMTAgZmlubmV5OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9BVUNUSU9OX0RVUkFUSU9OID0gMSBkYXlzOwogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CiAgICB1aW50MjU2IHB1YmxpYyBnZW4wQ3JlYXRlZENvdW50OwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21vQm90KHVpbnQyNTYgX2dlbmVzLCBhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYWRkcmVzcyBib3RPd25lciA9IF9vd25lcjsKICAgICAgICBpZiAoYm90T3duZXIgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBib3RPd25lciA9IGNvb0FkZHJlc3M7CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUocHJvbW9DcmVhdGVkQ291bnQgPCBQUk9NT19DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHByb21vQ3JlYXRlZENvdW50Kys7CiAgICAgICAgX2NyZWF0ZUJvdCgwLCAwLCAwLCBfZ2VuZXMsIGJvdE93bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVHZW4wQXVjdGlvbih1aW50MjU2IF9nZW5lcykgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgcmVxdWlyZShnZW4wQ3JlYXRlZENvdW50IDwgR0VOMF9DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHVpbnQyNTYgYm90SWQgPSBfY3JlYXRlQm90KDAsIDAsIDAsIF9nZW5lcywgYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgX2FwcHJvdmUoYm90SWQsIHNhbGVBdWN0aW9uKTsKCiAgICAgICAgc2FsZUF1Y3Rpb24uY3JlYXRlQXVjdGlvbigKICAgICAgICAgICAgYm90SWQsCiAgICAgICAgICAgIF9jb21wdXRlTmV4dEdlbjBQcmljZSgpLAogICAgICAgICAgICAwLAogICAgICAgICAgICBHRU4wX0FVQ1RJT05fRFVSQVRJT04sCiAgICAgICAgICAgIGFkZHJlc3ModGhpcykKICAgICAgICApOwoKICAgICAgICBnZW4wQ3JlYXRlZENvdW50Kys7CiAgICB9CgogICAgZnVuY3Rpb24gX2NvbXB1dGVOZXh0R2VuMFByaWNlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBhdmVQcmljZSA9IHNhbGVBdWN0aW9uLmF2ZXJhZ2VHZW4wU2FsZVByaWNlKCk7CiAgICAgICAgcmVxdWlyZShhdmVQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoYXZlUHJpY2UpKSk7CiAgICAgICAgdWludDI1NiBuZXh0UHJpY2UgPSBhdmVQcmljZSArIChhdmVQcmljZSAvIDIpOwogICAgICAgIGlmIChuZXh0UHJpY2UgPCBHRU4wX1NUQVJUSU5HX1BSSUNFKSB7CiAgICAgICAgICAgIG5leHRQcmljZSA9IEdFTjBfU1RBUlRJTkdfUFJJQ0U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXh0UHJpY2U7CiAgICB9Cn0KCgpjb250cmFjdCBCb3RDb3JlIGlzIEJvdE1pbnRpbmcgewogICAgYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKICAgIGZ1bmN0aW9uIEJvdENvcmUoKSBwdWJsaWMgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgX2NyZWF0ZUJvdCgwLCAwLCAwLCB1aW50MjU2KC0xKSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgbmV3Q29udHJhY3RBZGRyZXNzID0gX3YyQWRkcmVzczsKICAgICAgICBDb250cmFjdFVwZ3JhZGUoX3YyQWRkcmVzcyk7CiAgICB9CgogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2FsZUF1Y3Rpb24pIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Qm90KHVpbnQyNTYgX2lkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgIGJvb2wgaXNHZXN0YXRpbmcsCiAgICAgICAgYm9vbCBpc1JlYWR5LAogICAgICAgIHVpbnQyNTYgY29vbGRvd25JbmRleCwKICAgICAgICB1aW50MjU2IG5leHRBY3Rpb25BdCwKICAgICAgICB1aW50MjU2IHNpcmluZ1dpdGhJZCwKICAgICAgICB1aW50MjU2IGJpcnRoVGltZSwKICAgICAgICB1aW50MjU2IG1hdHJvbklkLAogICAgICAgIHVpbnQyNTYgc2lyZUlkLAogICAgICAgIHVpbnQyNTYgZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IGdlbmVzCiAgICApCiAgICB7CiAgICAgICAgcmVxdWlyZShib3RJbmRleFRvT3duZXJbX2lkXSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBCb3Qgc3RvcmFnZSBib3QgPSBib3RzW19pZF07CiAgICAgICAgaXNHZXN0YXRpbmcgPSAoYm90LnNpcmluZ1dpdGhJZCAhPSAwKTsKICAgICAgICBpc1JlYWR5ID0gKGJvdC5jb29sZG93bkVuZEJsb2NrIDw9IGJsb2NrLm51bWJlcik7CiAgICAgICAgY29vbGRvd25JbmRleCA9IHVpbnQyNTYoYm90LmNvb2xkb3duSW5kZXgpOwogICAgICAgIG5leHRBY3Rpb25BdCA9IHVpbnQyNTYoYm90LmNvb2xkb3duRW5kQmxvY2spOwogICAgICAgIHNpcmluZ1dpdGhJZCA9IHVpbnQyNTYoYm90LnNpcmluZ1dpdGhJZCk7CiAgICAgICAgYmlydGhUaW1lID0gdWludDI1Nihib3QuYmlydGhUaW1lKTsKICAgICAgICBtYXRyb25JZCA9IHVpbnQyNTYoYm90Lm1hdHJvbklkKTsKICAgICAgICBzaXJlSWQgPSB1aW50MjU2KGJvdC5zaXJlSWQpOwogICAgICAgIGdlbmVyYXRpb24gPSB1aW50MjU2KGJvdC5nZW5lcmF0aW9uKTsKICAgICAgICBnZW5lcyA9IGJvdC5nZW5lczsKICAgIH0KCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShzYWxlQXVjdGlvbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHNpcmluZ0F1Y3Rpb24gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShnZW5lU2NpZW5jZSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG5ld0NvbnRyYWN0QWRkcmVzcyA9PSBhZGRyZXNzKDApKTsKICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgIHVpbnQyNTYgc3VidHJhY3RGZWVzID0gKHByZWduYW50Qm90cyArIDEpICogYXV0b0JpcnRoRmVlOwogICAgICAgIGlmIChiYWxhbmNlID4gc3VidHJhY3RGZWVzKSB7CiAgICAgICAgICAgIGNmb0FkZHJlc3Muc2VuZChiYWxhbmNlIC0gc3VidHJhY3RGZWVzKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZGVzdHJveUJvdCh1aW50MjU2IF9ib3RJZCkgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShsb2Nrc1tfYm90SWRdID09IDApOwogICAgICAgIF9kZXN0cm95Qm90KF9ib3RJZCk7CiAgICB9Cn0='.
	

]
