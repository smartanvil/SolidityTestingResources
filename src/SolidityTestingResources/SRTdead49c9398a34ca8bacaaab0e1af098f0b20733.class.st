Class {
	#name : #SRTdead49c9398a34ca8bacaaab0e1af098f0b20733,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdead49c9398a34ca8bacaaab0e1af098f0b20733 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vc29sYyAtLWJpbiAtLWFiaSAtLW9wdGltaXplICAtLW9wdGltaXplLXJ1bnMgMjAwMDAgLW8gLiBUZXN0cG9vbC5zb2wgCgoKLy9pbXBvcnQgIi4vU0hBM181MTIuc29sIjsKCmNvbnRyYWN0IFNIQTNfNTEyIHsKICAgIGZ1bmN0aW9uIFNIQTNfNTEyKCkge30KICAgIAogICAgZnVuY3Rpb24ga2VjY2FrX2YodWludFsyNV0gQSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50WzI1XSkgewogICAgICAgIHVpbnRbNV0gbWVtb3J5IEM7CiAgICAgICAgdWludFs1XSBtZW1vcnkgRDsKICAgICAgICB1aW50IHg7CiAgICAgICAgdWludCB5OwogICAgICAgIC8vdWludCBEXzA7IHVpbnQgRF8xOyB1aW50IERfMjsgdWludCBEXzM7IHVpbnQgRF80OwogICAgICAgIHVpbnRbMjVdIG1lbW9yeSBCOwogICAgICAgIAogICAgICAgIHVpbnRbMjRdIG1lbW9yeSBSQz0gWwogICAgICAgICAgICAgICAgICAgdWludCgweDAwMDAwMDAwMDAwMDAwMDEpLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDA4MDgyLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDhBLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDAwLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDA4MDhCLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDAwMDAxLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDgxLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDA5LAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDAwMDhBLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDAwMDg4LAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDA4MDA5LAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDAwMDBBLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDA4MDhCLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDAwMDhCLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDg5LAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDAzLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDAyLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDAwMDgwLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDAwMDA4MDBBLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDAwMDBBLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDgxLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDAwMDA4MDgwLAogICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMDgwMDAwMDAxLAogICAgICAgICAgICAgICAgICAgMHg4MDAwMDAwMDgwMDA4MDA4IF07CiAgICAgICAgCiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IDI0IDsgaSsrICkgewogICAgICAgICAgICAvKgogICAgICAgICAgICBmb3IoIHggPSAwIDsgeCA8IDUgOyB4KysgKSB7CiAgICAgICAgICAgICAgICBDW3hdID0gQVs1KnhdXkFbNSp4KzFdXkFbNSp4KzJdXkFbNSp4KzNdXkFbNSp4KzRdOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSovCiAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIENbMF09QVswXV5BWzFdXkFbMl1eQVszXV5BWzRdOwogICAgICAgICAgICBDWzFdPUFbNV1eQVs2XV5BWzddXkFbOF1eQVs5XTsKICAgICAgICAgICAgQ1syXT1BWzEwXV5BWzExXV5BWzEyXV5BWzEzXV5BWzE0XTsKICAgICAgICAgICAgQ1szXT1BWzE1XV5BWzE2XV5BWzE3XV5BWzE4XV5BWzE5XTsKICAgICAgICAgICAgQ1s0XT1BWzIwXV5BWzIxXV5BWzIyXV5BWzIzXV5BWzI0XTsKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIGZvciggeCA9IDAgOyB4IDwgNSA7IHgrKyApIHsKICAgICAgICAgICAgICAgIERbeF0gPSBDWyh4KzQpJTVdXigoQ1soeCsxKSU1XSAqIDIpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChDWyh4KzEpJTVdLygyKio2MykpKTsKICAgICAgICAgICAgfSovCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgRFswXT1DWzRdIF4gKChDWzFdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbMV0gLyAoMiAqKiA2MykpKTsKICAgICAgICAgICAgRFsxXT1DWzBdIF4gKChDWzJdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbMl0gLyAoMiAqKiA2MykpKTsKICAgICAgICAgICAgRFsyXT1DWzFdIF4gKChDWzNdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbM10gLyAoMiAqKiA2MykpKTsKICAgICAgICAgICAgRFszXT1DWzJdIF4gKChDWzRdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbNF0gLyAoMiAqKiA2MykpKTsKICAgICAgICAgICAgRFs0XT1DWzNdIF4gKChDWzBdICogMikmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKENbMF0gLyAoMiAqKiA2MykpKTsKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIGZvciggeCA9IDAgOyB4IDwgNSA7IHgrKyApIHsKICAgICAgICAgICAgICAgIGZvciggeSA9IDAgOyB5IDwgNSA7IHkrKyApIHsKICAgICAgICAgICAgICAgICAgICBBWzUqeCt5XSA9IEFbNSp4K3ldIF4gRFt4XTsKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICAgICAgfSovCiAgICAgICAgICAgIAoKICAgICAgICAgICAgCiAgICAgICAgICAgIEFbMF09QVswXSBeIERbMF07CiAgICAgICAgICAgIEFbMV09QVsxXSBeIERbMF07CiAgICAgICAgICAgIEFbMl09QVsyXSBeIERbMF07CiAgICAgICAgICAgIEFbM109QVszXSBeIERbMF07CiAgICAgICAgICAgIEFbNF09QVs0XSBeIERbMF07CiAgICAgICAgICAgIEFbNV09QVs1XSBeIERbMV07CiAgICAgICAgICAgIEFbNl09QVs2XSBeIERbMV07CiAgICAgICAgICAgIEFbN109QVs3XSBeIERbMV07CiAgICAgICAgICAgIEFbOF09QVs4XSBeIERbMV07CiAgICAgICAgICAgIEFbOV09QVs5XSBeIERbMV07CiAgICAgICAgICAgIEFbMTBdPUFbMTBdIF4gRFsyXTsKICAgICAgICAgICAgQVsxMV09QVsxMV0gXiBEWzJdOwogICAgICAgICAgICBBWzEyXT1BWzEyXSBeIERbMl07CiAgICAgICAgICAgIEFbMTNdPUFbMTNdIF4gRFsyXTsKICAgICAgICAgICAgQVsxNF09QVsxNF0gXiBEWzJdOwogICAgICAgICAgICBBWzE1XT1BWzE1XSBeIERbM107CiAgICAgICAgICAgIEFbMTZdPUFbMTZdIF4gRFszXTsKICAgICAgICAgICAgQVsxN109QVsxN10gXiBEWzNdOwogICAgICAgICAgICBBWzE4XT1BWzE4XSBeIERbM107CiAgICAgICAgICAgIEFbMTldPUFbMTldIF4gRFszXTsKICAgICAgICAgICAgQVsyMF09QVsyMF0gXiBEWzRdOwogICAgICAgICAgICBBWzIxXT1BWzIxXSBeIERbNF07CiAgICAgICAgICAgIEFbMjJdPUFbMjJdIF4gRFs0XTsKICAgICAgICAgICAgQVsyM109QVsyM10gXiBEWzRdOwogICAgICAgICAgICBBWzI0XT1BWzI0XSBeIERbNF07CgogICAgICAgICAgICAvKlJobyBhbmQgcGkgc3RlcHMqLyAgICAgICAgICAgIAogICAgICAgICAgICBCWzBdPUFbMF07CiAgICAgICAgICAgIEJbOF09KChBWzFdICogKDIgKiogMzYpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxXSAvICgyICoqIDI4KSkpOwogICAgICAgICAgICBCWzExXT0oKEFbMl0gKiAoMiAqKiAzKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMl0gLyAoMiAqKiA2MSkpKTsKICAgICAgICAgICAgQlsxOV09KChBWzNdICogKDIgKiogNDEpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVszXSAvICgyICoqIDIzKSkpOwogICAgICAgICAgICBCWzIyXT0oKEFbNF0gKiAoMiAqKiAxOCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzRdIC8gKDIgKiogNDYpKSk7CiAgICAgICAgICAgIEJbMl09KChBWzVdICogKDIgKiogMSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzVdIC8gKDIgKiogNjMpKSk7CiAgICAgICAgICAgIEJbNV09KChBWzZdICogKDIgKiogNDQpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVs2XSAvICgyICoqIDIwKSkpOwogICAgICAgICAgICBCWzEzXT0oKEFbN10gKiAoMiAqKiAxMCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzddIC8gKDIgKiogNTQpKSk7CiAgICAgICAgICAgIEJbMTZdPSgoQVs4XSAqICgyICoqIDQ1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbOF0gLyAoMiAqKiAxOSkpKTsKICAgICAgICAgICAgQlsyNF09KChBWzldICogKDIgKiogMikpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzldIC8gKDIgKiogNjIpKSk7CiAgICAgICAgICAgIEJbNF09KChBWzEwXSAqICgyICoqIDYyKSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTBdIC8gKDIgKiogMikpKTsKICAgICAgICAgICAgQls3XT0oKEFbMTFdICogKDIgKiogNikpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzExXSAvICgyICoqIDU4KSkpOwogICAgICAgICAgICBCWzEwXT0oKEFbMTJdICogKDIgKiogNDMpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxMl0gLyAoMiAqKiAyMSkpKTsKICAgICAgICAgICAgQlsxOF09KChBWzEzXSAqICgyICoqIDE1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTNdIC8gKDIgKiogNDkpKSk7CiAgICAgICAgICAgIEJbMjFdPSgoQVsxNF0gKiAoMiAqKiA2MSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzE0XSAvICgyICoqIDMpKSk7CiAgICAgICAgICAgIEJbMV09KChBWzE1XSAqICgyICoqIDI4KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTVdIC8gKDIgKiogMzYpKSk7CiAgICAgICAgICAgIEJbOV09KChBWzE2XSAqICgyICoqIDU1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTZdIC8gKDIgKiogOSkpKTsKICAgICAgICAgICAgQlsxMl09KChBWzE3XSAqICgyICoqIDI1KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMTddIC8gKDIgKiogMzkpKSk7CiAgICAgICAgICAgIEJbMTVdPSgoQVsxOF0gKiAoMiAqKiAyMSkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzE4XSAvICgyICoqIDQzKSkpOwogICAgICAgICAgICBCWzIzXT0oKEFbMTldICogKDIgKiogNTYpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsxOV0gLyAoMiAqKiA4KSkpOwogICAgICAgICAgICBCWzNdPSgoQVsyMF0gKiAoMiAqKiAyNykpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzIwXSAvICgyICoqIDM3KSkpOwogICAgICAgICAgICBCWzZdPSgoQVsyMV0gKiAoMiAqKiAyMCkpJjB4ZmZmZmZmZmZmZmZmZmZmZiB8IChBWzIxXSAvICgyICoqIDQ0KSkpOwogICAgICAgICAgICBCWzE0XT0oKEFbMjJdICogKDIgKiogMzkpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyMl0gLyAoMiAqKiAyNSkpKTsKICAgICAgICAgICAgQlsxN109KChBWzIzXSAqICgyICoqIDgpKSYweGZmZmZmZmZmZmZmZmZmZmYgfCAoQVsyM10gLyAoMiAqKiA1NikpKTsKICAgICAgICAgICAgQlsyMF09KChBWzI0XSAqICgyICoqIDE0KSkmMHhmZmZmZmZmZmZmZmZmZmZmIHwgKEFbMjRdIC8gKDIgKiogNTApKSk7CgogICAgICAgICAgICAvKlhpIHN0YXRlKi8KICAgICAgICAgICAgLyoKICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgewogICAgICAgICAgICAgICAgZm9yKCB5ID0gMCA7IHkgPCA1IDsgeSsrICkgewogICAgICAgICAgICAgICAgICAgIEFbNSp4K3ldID0gQls1KngreV1eKCh+Qls1KigoeCsxKSU1KSt5XSkgJiBCWzUqKCh4KzIpJTUpK3ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSovCiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgQVswXT1CWzBdXigofkJbNV0pICYgQlsxMF0pOwogICAgICAgICAgICBBWzFdPUJbMV1eKCh+Qls2XSkgJiBCWzExXSk7CiAgICAgICAgICAgIEFbMl09QlsyXV4oKH5CWzddKSAmIEJbMTJdKTsKICAgICAgICAgICAgQVszXT1CWzNdXigofkJbOF0pICYgQlsxM10pOwogICAgICAgICAgICBBWzRdPUJbNF1eKCh+Qls5XSkgJiBCWzE0XSk7CiAgICAgICAgICAgIEFbNV09Qls1XV4oKH5CWzEwXSkgJiBCWzE1XSk7CiAgICAgICAgICAgIEFbNl09Qls2XV4oKH5CWzExXSkgJiBCWzE2XSk7CiAgICAgICAgICAgIEFbN109Qls3XV4oKH5CWzEyXSkgJiBCWzE3XSk7CiAgICAgICAgICAgIEFbOF09Qls4XV4oKH5CWzEzXSkgJiBCWzE4XSk7CiAgICAgICAgICAgIEFbOV09Qls5XV4oKH5CWzE0XSkgJiBCWzE5XSk7CiAgICAgICAgICAgIEFbMTBdPUJbMTBdXigofkJbMTVdKSAmIEJbMjBdKTsKICAgICAgICAgICAgQVsxMV09QlsxMV1eKCh+QlsxNl0pICYgQlsyMV0pOwogICAgICAgICAgICBBWzEyXT1CWzEyXV4oKH5CWzE3XSkgJiBCWzIyXSk7CiAgICAgICAgICAgIEFbMTNdPUJbMTNdXigofkJbMThdKSAmIEJbMjNdKTsKICAgICAgICAgICAgQVsxNF09QlsxNF1eKCh+QlsxOV0pICYgQlsyNF0pOwogICAgICAgICAgICBBWzE1XT1CWzE1XV4oKH5CWzIwXSkgJiBCWzBdKTsKICAgICAgICAgICAgQVsxNl09QlsxNl1eKCh+QlsyMV0pICYgQlsxXSk7CiAgICAgICAgICAgIEFbMTddPUJbMTddXigofkJbMjJdKSAmIEJbMl0pOwogICAgICAgICAgICBBWzE4XT1CWzE4XV4oKH5CWzIzXSkgJiBCWzNdKTsKICAgICAgICAgICAgQVsxOV09QlsxOV1eKCh+QlsyNF0pICYgQls0XSk7CiAgICAgICAgICAgIEFbMjBdPUJbMjBdXigofkJbMF0pICYgQls1XSk7CiAgICAgICAgICAgIEFbMjFdPUJbMjFdXigofkJbMV0pICYgQls2XSk7CiAgICAgICAgICAgIEFbMjJdPUJbMjJdXigofkJbMl0pICYgQls3XSk7CiAgICAgICAgICAgIEFbMjNdPUJbMjNdXigofkJbM10pICYgQls4XSk7CiAgICAgICAgICAgIEFbMjRdPUJbMjRdXigofkJbNF0pICYgQls5XSk7CgogICAgICAgICAgICAvKkxhc3Qgc3RlcCovCiAgICAgICAgICAgIEFbMF09QVswXV5SQ1tpXTsgICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIAogICAgICAgIHJldHVybiBBOwogICAgfQogCiAgICAKICAgIGZ1bmN0aW9uIHNwb25nZSh1aW50WzldIE0pIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludFsxNl0pIHsKICAgICAgICBpZiggKE0ubGVuZ3RoICogOCkgIT0gNzIgKSB0aHJvdzsKICAgICAgICBNWzVdID0gMHgwMTsKICAgICAgICBNWzhdID0gMHg4MDAwMDAwMDAwMDAwMDAwOwogICAgICAgIAogICAgICAgIHVpbnQgciA9IDcyOwogICAgICAgIHVpbnQgdyA9IDg7CiAgICAgICAgdWludCBzaXplID0gTS5sZW5ndGggKiA4OwogICAgICAgIAogICAgICAgIHVpbnRbMjVdIG1lbW9yeSBTOwogICAgICAgIHVpbnQgaTsgdWludCB5OyB1aW50IHg7CiAgICAgICAgLypBYnNvcmJpbmcgUGhhc2UqLwogICAgICAgIGZvciggaSA9IDAgOyBpIDwgc2l6ZS9yIDsgaSsrICkgewogICAgICAgICAgICBmb3IoIHkgPSAwIDsgeSA8IDUgOyB5KysgKSB7CiAgICAgICAgICAgICAgICBmb3IoIHggPSAwIDsgeCA8IDUgOyB4KysgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoICh4KzUqeSkgPCAoci93KSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgU1s1KngreV0gPSBTWzUqeCt5XSBeIE1baSo5ICsgeCArIDUqeV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFMgPSBrZWNjYWtfZihTKTsKICAgICAgICB9CgogICAgICAgIC8qU3F1ZWV6aW5nIHBoYXNlKi8KICAgICAgICB1aW50WzE2XSBtZW1vcnkgcmVzdWx0OwogICAgICAgIHVpbnQgYiA9IDA7CiAgICAgICAgd2hpbGUoIGIgPCAxNiApIHsKICAgICAgICAgICAgZm9yKCB5ID0gMCA7IHkgPCA1IDsgeSsrICkgewogICAgICAgICAgICAgICAgZm9yKCB4ID0gMCA7IHggPCA1IDsgeCsrICkgewogICAgICAgICAgICAgICAgICAgIGlmKCAoeCs1KnkpPChyL3cpICYmIChiPDE2KSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2JdID0gU1s1KngreV0gJiAweEZGRkZGRkZGOyAKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2IrMV0gPSBTWzUqeCt5XSAvIDB4MTAwMDAwMDAwOwogICAgICAgICAgICAgICAgICAgICAgICBiKz0yOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgfQoKfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCmNvbnRyYWN0IEV0aGFzaCBpcyBTSEEzXzUxMiB7CiAgICAKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgcHVibGljIG93bmVyczsKICAgIAogICAgZnVuY3Rpb24gRXRoYXNoKGFkZHJlc3NbM10gX293bmVycykgewogICAgICAgIG93bmVyc1tfb3duZXJzWzBdXSA9IHRydWU7CiAgICAgICAgb3duZXJzW19vd25lcnNbMV1dID0gdHJ1ZTsKICAgICAgICBvd25lcnNbX293bmVyc1syXV0gPSB0cnVlOyAgICAgICAgICAgICAgICAKICAgIH0KICAgICAKICAgIGZ1bmN0aW9uIGZudiggdWludCB2MSwgdWludCB2MiApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIHJldHVybiAoKHYxKjB4MDEwMDAxOTMpIF4gdjIpICYgMHhGRkZGRkZGRjsKICAgIH0KCgoKICAgIGZ1bmN0aW9uIGNvbXB1dGVDYWNoZVJvb3QoIHVpbnQgaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGluZGV4SW5FbGVtZW50c0FycmF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGVsZW1lbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIHdpdG5lc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGJyYW5jaFNpemUgKSBjb25zdGFudCBwcml2YXRlIHJldHVybnModWludCkgewogCiAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdWludCBsZWFmID0gY29tcHV0ZUxlYWYoZWxlbWVudHMsIGluZGV4SW5FbGVtZW50c0FycmF5KSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7CgogICAgICAgIHVpbnQgbGVmdDsKICAgICAgICB1aW50IHJpZ2h0OwogICAgICAgIHVpbnQgbm9kZTsKICAgICAgICBib29sIG9kZEJyYW5jaFNpemUgPSAoYnJhbmNoU2l6ZSAlIDIpID4gMDsKICAgICAgICAgCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBicmFuY2hTaXplIDo9IGRpdihicmFuY2hTaXplLDIpCiAgICAgICAgICAgIC8vYnJhbmNoU2l6ZSAvPSAyOwogICAgICAgIH0KICAgICAgICB1aW50IHdpdG5lc3NJbmRleCA9IGluZGV4SW5FbGVtZW50c0FycmF5ICogYnJhbmNoU2l6ZTsKICAgICAgICBpZiggb2RkQnJhbmNoU2l6ZSApIHdpdG5lc3NJbmRleCArPSBpbmRleEluRWxlbWVudHNBcnJheTsgIAoKICAgICAgICBmb3IoIHVpbnQgZGVwdGggPSAwIDsgZGVwdGggPCBicmFuY2hTaXplIDsgZGVwdGgrKyApIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbm9kZSA6PSBtbG9hZChhZGQoYWRkKHdpdG5lc3MsMHgyMCksbXVsKGFkZChkZXB0aCx3aXRuZXNzSW5kZXgpLDB4MjApKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAvL25vZGUgID0gd2l0bmVzc1t3aXRuZXNzSW5kZXggKyBkZXB0aF0gJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgICAgICBpZiggaW5kZXggJiAweDEgPT0gMCApIHsKICAgICAgICAgICAgICAgIGxlZnQgPSBsZWFmOwogICAgICAgICAgICAgICAgYXNzZW1ibHl7CiAgICAgICAgICAgICAgICAgICAgLy9yaWdodCA9IG5vZGUgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByaWdodCA6PSBhbmQobm9kZSwweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhc3NlbWJseXsKICAgICAgICAgICAgICAgICAgICAvL2xlZnQgPSBub2RlICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICAgICAgICAgICAgICBsZWZ0IDo9IGFuZChub2RlLDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByaWdodCA9IGxlYWY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxlYWYgPSB1aW50KHNoYTMobGVmdCxyaWdodCkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgaW5kZXggOj0gZGl2KGluZGV4LDIpIAogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vaW5kZXggPSBpbmRleCAvIDI7CgogICAgICAgICAgICAvL25vZGUgID0gd2l0bmVzc1t3aXRuZXNzSW5kZXggKyBkZXB0aF0gLyAoMioqMTI4KTsKICAgICAgICAgICAgaWYoIGluZGV4ICYgMHgxID09IDAgKSB7CiAgICAgICAgICAgICAgICBsZWZ0ID0gbGVhZjsKICAgICAgICAgICAgICAgIGFzc2VtYmx5ewogICAgICAgICAgICAgICAgICAgIHJpZ2h0IDo9IGRpdihub2RlLDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKQogICAgICAgICAgICAgICAgICAgIC8vcmlnaHQgPSBub2RlIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgLy9sZWZ0ID0gbm9kZSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgICAgICAgICAgICAgICAgIGxlZnQgOj0gZGl2KG5vZGUsMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByaWdodCA9IGxlYWY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxlYWYgPSB1aW50KHNoYTMobGVmdCxyaWdodCkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgaW5kZXggOj0gZGl2KGluZGV4LDIpIAogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vaW5kZXggPSBpbmRleCAvIDI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmKCBvZGRCcmFuY2hTaXplICkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBub2RlIDo9IG1sb2FkKGFkZChhZGQod2l0bmVzcywweDIwKSxtdWwoYWRkKGRlcHRoLHdpdG5lc3NJbmRleCksMHgyMCkpKQogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgICAgIC8vbm9kZSAgPSB3aXRuZXNzW3dpdG5lc3NJbmRleCArIGRlcHRoXSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7CiAgICAgICAgICAgIGlmKCBpbmRleCAmIDB4MSA9PSAwICkgewogICAgICAgICAgICAgICAgbGVmdCA9IGxlYWY7CiAgICAgICAgICAgICAgICBhc3NlbWJseXsKICAgICAgICAgICAgICAgICAgICAvL3JpZ2h0ID0gbm9kZSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJpZ2h0IDo9IGFuZChub2RlLDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYpCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYXNzZW1ibHl7CiAgICAgICAgICAgICAgICAgICAgLy9sZWZ0ID0gbm9kZSAmIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxlZnQgOj0gYW5kKG5vZGUsMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByaWdodCA9IGxlYWY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxlYWYgPSB1aW50KHNoYTMobGVmdCxyaWdodCkpICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICAKICAgICAgICByZXR1cm4gbGVhZjsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHRvQkUoIHVpbnQgeCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIHVpbnQgeSA9IDA7CiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IDMyIDsgaSsrICkgewogICAgICAgICAgICB5ID0geSAqIDI1NjsKICAgICAgICAgICAgeSArPSAoeCAmIDB4RkYpOwogICAgICAgICAgICB4ID0geCAvIDI1NjsgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHk7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNvbXB1dGVTaGEzKCB1aW50WzE2XSBzLCB1aW50WzhdIGNtaXggKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IHMwID0gc1swXSArIHNbMV0gKiAoMioqMzIpICsgc1syXSAqICgyKio2NCkgKyBzWzNdICogKDIqKjk2KSArCiAgICAgICAgICAgICAgICAgIChzWzRdICsgc1s1XSAqICgyKiozMikgKyBzWzZdICogKDIqKjY0KSArIHNbN10gKiAoMioqOTYpKSooMioqMTI4KTsKCiAgICAgICAgdWludCBzMSA9IHNbOF0gKyBzWzldICogKDIqKjMyKSArIHNbMTBdICogKDIqKjY0KSArIHNbMTFdICogKDIqKjk2KSArCiAgICAgICAgICAgICAgICAgIChzWzEyXSArIHNbMTNdICogKDIqKjMyKSArIHNbMTRdICogKDIqKjY0KSArIHNbMTVdICogKDIqKjk2KSkqKDIqKjEyOCk7CiAgICAgICAgICAgICAgICAgIAogICAgICAgIHVpbnQgYyA9IGNtaXhbMF0gKyBjbWl4WzFdICogKDIqKjMyKSArIGNtaXhbMl0gKiAoMioqNjQpICsgY21peFszXSAqICgyKio5NikgKwogICAgICAgICAgICAgICAgICAoY21peFs0XSArIGNtaXhbNV0gKiAoMioqMzIpICsgY21peFs2XSAqICgyKio2NCkgKyBjbWl4WzddICogKDIqKjk2KSkqKDIqKjEyOCk7CgogICAgICAgIAogICAgICAgIC8qIGdvZCBrbm93cyB3aHkgbmVlZCB0byBjb252ZXJ0IHRvIGJpZyBlbmRpYW4gKi8KICAgICAgICByZXR1cm4gdWludCggc2hhMyh0b0JFKHMwKSx0b0JFKHMxKSx0b0JFKGMpKSApOwogICAgfQogCiAKICAgIGZ1bmN0aW9uIGNvbXB1dGVMZWFmKCB1aW50W10gZGF0YVNldExvb2t1cCwgdWludCBpbmRleCApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIHJldHVybiB1aW50KCBzaGEzKGRhdGFTZXRMb29rdXBbNCppbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNldExvb2t1cFs0KmluZGV4ICsgMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNldExvb2t1cFs0KmluZGV4ICsgMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNldExvb2t1cFs0KmluZGV4ICsgM10pICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgfQogCiAgICBmdW5jdGlvbiBjb21wdXRlUyggdWludCBoZWFkZXIsIHVpbnQgbm9uY2VMZSApIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludFsxNl0pIHsKICAgICAgICB1aW50WzldICBtZW1vcnkgTTsKICAgICAgICAKICAgICAgICBoZWFkZXIgPSByZXZlcnNlQnl0ZXMoaGVhZGVyKTsKICAgICAgICAKICAgICAgICBNWzBdID0gdWludChoZWFkZXIpICYgMHhGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgIGhlYWRlciA9IGhlYWRlciAvIDIqKjY0OwogICAgICAgIE1bMV0gPSB1aW50KGhlYWRlcikgJiAweEZGRkZGRkZGRkZGRkZGRkY7CiAgICAgICAgaGVhZGVyID0gaGVhZGVyIC8gMioqNjQ7CiAgICAgICAgTVsyXSA9IHVpbnQoaGVhZGVyKSAmIDB4RkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICBoZWFkZXIgPSBoZWFkZXIgLyAyKio2NDsKICAgICAgICBNWzNdID0gdWludChoZWFkZXIpICYgMHhGRkZGRkZGRkZGRkZGRkZGOwoKICAgICAgICAvLyBtYWtlIGxpdHRsZSBlbmRpYW4gbm9uY2UKICAgICAgICBNWzRdID0gbm9uY2VMZTsKICAgICAgICByZXR1cm4gc3BvbmdlKE0pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZXZlcnNlQnl0ZXMoIHVpbnQgaW5wdXQgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IHJlc3VsdCA9IDA7CiAgICAgICAgZm9yKHVpbnQgaSA9IDAgOyBpIDwgMzIgOyBpKysgKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCAqIDI1NjsKICAgICAgICAgICAgcmVzdWx0ICs9IGlucHV0ICYgMHhmZjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlucHV0IC89IDI1NjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgc3RydWN0IEV0aGFzaENhY2hlT3B0RGF0YSB7CiAgICAgICAgdWludFs1MTJdICAgIG1lcmtsZU5vZGVzOwogICAgICAgIHVpbnQgICAgICAgICBmdWxsU2l6ZUluMTI4UmVzdWx0aW9uOwogICAgICAgIHVpbnQgICAgICAgICBicmFuY2hEZXB0aDsKICAgIH0KICAgIAogICAgbWFwcGluZyh1aW50PT5FdGhhc2hDYWNoZU9wdERhdGEpIGVwb2NoRGF0YTsKICAgIAogICAgZnVuY3Rpb24gZ2V0RXBvY2hEYXRhKCB1aW50IGVwb2NoSW5kZXgsIHVpbnQgbm9kZUluZGV4ICkgY29uc3RhbnQgcmV0dXJucyh1aW50WzNdKSB7CiAgICAgICAgcmV0dXJuIFtlcG9jaERhdGFbZXBvY2hJbmRleF0ubWVya2xlTm9kZXNbbm9kZUluZGV4XSwKICAgICAgICAgICAgICAgIGVwb2NoRGF0YVtlcG9jaEluZGV4XS5mdWxsU2l6ZUluMTI4UmVzdWx0aW9uLAogICAgICAgICAgICAgICAgZXBvY2hEYXRhW2Vwb2NoSW5kZXhdLmJyYW5jaERlcHRoXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNFcG9jaERhdGFTZXQoIHVpbnQgZXBvY2hJbmRleCApIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBlcG9jaERhdGFbZXBvY2hJbmRleF0uZnVsbFNpemVJbjEyOFJlc3VsdGlvbiAhPSAwOwogICAgCiAgICB9CiAgICAgICAgCiAgICBldmVudCBTZXRFcG9jaERhdGEoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7ICAgIAogICAgZnVuY3Rpb24gc2V0RXBvY2hEYXRhKCB1aW50IGVwb2NoLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IGZ1bGxTaXplSW4xMjhSZXN1bHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgYnJhbmNoRGVwdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBtZXJrbGVOb2RlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBzdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBudW1FbGVtcyApIHsKCiAgICAgICAgaWYoICEgb3duZXJzW21zZy5zZW5kZXJdICkgewogICAgICAgICAgICAvL0Vycm9yTG9nKCAic2V0RXBvY2hEYXRhOiBvbmx5IG93bmVyIGNhbiBzZXQgZGF0YSIsIHVpbnQobXNnLnNlbmRlcikgKTsKICAgICAgICAgICAgU2V0RXBvY2hEYXRhKCBtc2cuc2VuZGVyLCAweDgyMDAwMDAwLCB1aW50KG1zZy5zZW5kZXIpICk7CiAgICAgICAgICAgIHJldHVybjsgICAgICAgIAogICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IG51bUVsZW1zIDsgaSsrICkgewogICAgICAgICAgICBpZiggZXBvY2hEYXRhW2Vwb2NoXS5tZXJrbGVOb2Rlc1tzdGFydCtpXSA+IDAgKSB7CiAgICAgICAgICAgICAgICAvL0Vycm9yTG9nKCJlcG9jaCBhbHJlYWR5IHNldCIsIGVwb2NoW2ldKTsKICAgICAgICAgICAgICAgIFNldEVwb2NoRGF0YSggbXNnLnNlbmRlciwgMHg4MjAwMDAwMSwgZXBvY2ggKiAoMioqMTI4KSArIHN0YXJ0ICsgaSApOwogICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgIAoKICAgICAgICAgICAgfSAKICAgICAgICAgICAgZXBvY2hEYXRhW2Vwb2NoXS5tZXJrbGVOb2Rlc1tzdGFydCtpXSA9IG1lcmtsZU5vZGVzW2ldOwogICAgICAgIH0KICAgICAgICBlcG9jaERhdGFbZXBvY2hdLmZ1bGxTaXplSW4xMjhSZXN1bHRpb24gPSBmdWxsU2l6ZUluMTI4UmVzdWx0aW9uOwogICAgICAgIGVwb2NoRGF0YVtlcG9jaF0uYnJhbmNoRGVwdGggPSBicmFuY2hEZXB0aDsKICAgICAgICAKICAgICAgICBTZXRFcG9jaERhdGEoIG1zZy5zZW5kZXIsIDAgLCAwICk7ICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNZXJrbGVMZWF2ZSggdWludCBlcG9jaEluZGV4LCB1aW50IHAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsgICAgICAgIAogICAgICAgIHVpbnQgcm9vdEluZGV4ID0gcCA+PiBlcG9jaERhdGFbZXBvY2hJbmRleF0uYnJhbmNoRGVwdGg7CiAgICAgICAgdWludCBleHBlY3RlZFJvb3QgPSBlcG9jaERhdGFbZXBvY2hJbmRleF0ubWVya2xlTm9kZXNbKHJvb3RJbmRleC8yKV07CiAgICAgICAgaWYoIChyb290SW5kZXggJSAyKSA9PSAwICkgZXhwZWN0ZWRSb290ID0gZXhwZWN0ZWRSb290ICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICBlbHNlIGV4cGVjdGVkUm9vdCA9IGV4cGVjdGVkUm9vdCAvICgyKioxMjgpOwogICAgICAgIAogICAgICAgIHJldHVybiBleHBlY3RlZFJvb3Q7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGhhc2hpbW90byggYnl0ZXMzMiAgICAgIGhlYWRlciwKICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXM4ICAgICAgIG5vbmNlTGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSAgICAgICBkYXRhU2V0TG9va3VwLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gICAgICAgd2l0bmVzc0Zvckxvb2t1cCwKICAgICAgICAgICAgICAgICAgICAgICAgdWludCAgICAgICAgIGVwb2NoSW5kZXggKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgCiAgICAgICAgdWludFsxNl0gbWVtb3J5IHM7CiAgICAgICAgdWludFszMl0gbWVtb3J5IG1peDsKICAgICAgICB1aW50WzhdICBtZW1vcnkgY21peDsKICAgICAgICAKICAgICAgICB1aW50WzJdICBtZW1vcnkgZGVwdGhBbmRGdWxsU2l6ZSA9IFtlcG9jaERhdGFbZXBvY2hJbmRleF0uYnJhbmNoRGVwdGgsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVwb2NoRGF0YVtlcG9jaEluZGV4XS5mdWxsU2l6ZUluMTI4UmVzdWx0aW9uXTsKICAgICAgICAgICAgICAgIAogICAgICAgIHVpbnQgaTsKICAgICAgICB1aW50IGo7CiAgICAgICAgCiAgICAgICAgaWYoICEgaXNFcG9jaERhdGFTZXQoIGVwb2NoSW5kZXggKSApIHJldHVybiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkU7CiAgICAgICAgCiAgICAgICAgaWYoIGRlcHRoQW5kRnVsbFNpemVbMV0gPT0gMCApIHsKICAgICAgICAgICAgcmV0dXJuIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICB9CgogICAgICAgIAogICAgICAgIHMgPSBjb21wdXRlUyh1aW50KGhlYWRlciksIHVpbnQobm9uY2VMZSkpOwogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMTYgOyBpKysgKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gbXVsKGksMHgyMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy9taXhbaV0gPSBzW2ldOwogICAgICAgICAgICAgICAgbXN0b3JlKGFkZChtaXgsb2Zmc2V0KSxtbG9hZChhZGQocyxvZmZzZXQpKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gbWl4W2krMTZdID0gc1tpXTsKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQobWl4LGFkZCgweDIwMCxvZmZzZXQpKSxtbG9hZChhZGQocyxvZmZzZXQpKSkgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciggaSA9IDAgOyBpIDwgNjQgOyBpKysgKSB7CiAgICAgICAgICAgIHVpbnQgcCA9IGZudiggaSBeIHNbMF0sIG1peFtpICUgMzJdKSAlIGRlcHRoQW5kRnVsbFNpemVbMV07CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgaWYoIGNvbXB1dGVDYWNoZVJvb3QoIHAsIGksIGRhdGFTZXRMb29rdXAsICB3aXRuZXNzRm9yTG9va3VwLCBkZXB0aEFuZEZ1bGxTaXplWzBdICkgICE9IGdldE1lcmtsZUxlYXZlKCBlcG9jaEluZGV4LCBwICkgKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUG9XIGZhaWxlZAogICAgICAgICAgICAgICAgcmV0dXJuIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICAgICAgfSAgICAgICAKCiAgICAgICAgICAgIGZvciggaiA9IDAgOyBqIDwgOCA7IGorKyApIHsKCiAgICAgICAgICAgICAgICBhc3NlbWJseXsKICAgICAgICAgICAgICAgICAgICAvL21peFtqXSA9IGZudihtaXhbal0sIGRhdGFTZXRMb29rdXBbNCppXSAmIHZhckZGRkZGRkZGICk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGFPZmZzZXQgOj0gYWRkKG11bCgweDgwLGkpLGFkZChkYXRhU2V0TG9va3VwLDB4MjApKQogICAgICAgICAgICAgICAgICAgIGxldCBkYXRhVmFsdWUgICA6PSBhbmQobWxvYWQoZGF0YU9mZnNldCksMHhGRkZGRkZGRikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgbWl4T2Zmc2V0IDo9IGFkZChtaXgsbXVsKDB4MjAsaikpCiAgICAgICAgICAgICAgICAgICAgbGV0IG1peFZhbHVlICA6PSBtbG9hZChtaXhPZmZzZXQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gZm52ID0gcmV0dXJuICgodjEqMHgwMTAwMDE5MykgXiB2MikgJiAweEZGRkZGRkZGOwogICAgICAgICAgICAgICAgICAgIGxldCBmbnZWYWx1ZSA6PSBhbmQoeG9yKG11bChtaXhWYWx1ZSwweDAxMDAwMTkzKSxkYXRhVmFsdWUpLDB4RkZGRkZGRkYpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtc3RvcmUobWl4T2Zmc2V0LGZudlZhbHVlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vbWl4W2orOF0gPSBmbnYobWl4W2orOF0sIGRhdGFTZXRMb29rdXBbNCppICsgMV0gJiAweEZGRkZGRkZGICk7CiAgICAgICAgICAgICAgICAgICAgZGF0YU9mZnNldCA6PSBhZGQoZGF0YU9mZnNldCwweDIwKQogICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZSAgIDo9IGFuZChtbG9hZChkYXRhT2Zmc2V0KSwweEZGRkZGRkZGKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1peE9mZnNldCA6PSBhZGQobWl4T2Zmc2V0LDB4MTAwKQogICAgICAgICAgICAgICAgICAgIG1peFZhbHVlICA6PSBtbG9hZChtaXhPZmZzZXQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gZm52ID0gcmV0dXJuICgodjEqMHgwMTAwMDE5MykgXiB2MikgJiAweEZGRkZGRkZGOwogICAgICAgICAgICAgICAgICAgIGZudlZhbHVlIDo9IGFuZCh4b3IobXVsKG1peFZhbHVlLDB4MDEwMDAxOTMpLGRhdGFWYWx1ZSksMHhGRkZGRkZGRikgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG1zdG9yZShtaXhPZmZzZXQsZm52VmFsdWUpCgogICAgICAgICAgICAgICAgICAgIC8vbWl4W2orMTZdID0gZm52KG1peFtqKzE2XSwgZGF0YVNldExvb2t1cFs0KmkgKyAyXSAmIDB4RkZGRkZGRkYgKTsKICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0IDo9IGFkZChkYXRhT2Zmc2V0LDB4MjApCiAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlICAgOj0gYW5kKG1sb2FkKGRhdGFPZmZzZXQpLDB4RkZGRkZGRkYpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbWl4T2Zmc2V0IDo9IGFkZChtaXhPZmZzZXQsMHgxMDApCiAgICAgICAgICAgICAgICAgICAgbWl4VmFsdWUgIDo9IG1sb2FkKG1peE9mZnNldCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBmbnYgPSByZXR1cm4gKCh2MSoweDAxMDAwMTkzKSBeIHYyKSAmIDB4RkZGRkZGRkY7CiAgICAgICAgICAgICAgICAgICAgZm52VmFsdWUgOj0gYW5kKHhvcihtdWwobWl4VmFsdWUsMHgwMTAwMDE5MyksZGF0YVZhbHVlKSwweEZGRkZGRkZGKSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbXN0b3JlKG1peE9mZnNldCxmbnZWYWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgLy9taXhbaisyNF0gPSBmbnYobWl4W2orMjRdLCBkYXRhU2V0TG9va3VwWzQqaSArIDNdICYgMHhGRkZGRkZGRiApOwogICAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQgOj0gYWRkKGRhdGFPZmZzZXQsMHgyMCkKICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWUgICA6PSBhbmQobWxvYWQoZGF0YU9mZnNldCksMHhGRkZGRkZGRikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtaXhPZmZzZXQgOj0gYWRkKG1peE9mZnNldCwweDEwMCkKICAgICAgICAgICAgICAgICAgICBtaXhWYWx1ZSAgOj0gbWxvYWQobWl4T2Zmc2V0KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIGZudiA9IHJldHVybiAoKHYxKjB4MDEwMDAxOTMpIF4gdjIpICYgMHhGRkZGRkZGRjsKICAgICAgICAgICAgICAgICAgICBmbnZWYWx1ZSA6PSBhbmQoeG9yKG11bChtaXhWYWx1ZSwweDAxMDAwMTkzKSxkYXRhVmFsdWUpLDB4RkZGRkZGRkYpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtc3RvcmUobWl4T2Zmc2V0LGZudlZhbHVlKSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vbWl4W2pdID0gZm52KG1peFtqXSwgZGF0YVNldExvb2t1cFs0KmldICYgMHhGRkZGRkZGRiApOwogICAgICAgICAgICAgICAgLy9taXhbais4XSA9IGZudihtaXhbais4XSwgZGF0YVNldExvb2t1cFs0KmkgKyAxXSAmIDB4RkZGRkZGRkYgKTsKICAgICAgICAgICAgICAgIC8vbWl4W2orMTZdID0gZm52KG1peFtqKzE2XSwgZGF0YVNldExvb2t1cFs0KmkgKyAyXSAmIDB4RkZGRkZGRkYgKTsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL21peFtqKzI0XSA9IGZudihtaXhbaisyNF0sIGRhdGFTZXRMb29rdXBbNCppICsgM10gJiAweEZGRkZGRkZGICk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSAgICBdID0gZGF0YVNldExvb2t1cFs0KmkgICAgXS8oMioqMzIpOwogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSArIDFdID0gZGF0YVNldExvb2t1cFs0KmkgKyAxXS8oMioqMzIpOwogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSArIDJdID0gZGF0YVNldExvb2t1cFs0KmkgKyAyXS8oMioqMzIpOwogICAgICAgICAgICAgICAgLy9kYXRhU2V0TG9va3VwWzQqaSArIDNdID0gZGF0YVNldExvb2t1cFs0KmkgKyAzXS8oMioqMzIpOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXNzZW1ibHl7CiAgICAgICAgICAgICAgICAgICAgbGV0IG9mZnNldCA6PSBhZGQoYWRkKGRhdGFTZXRMb29rdXAsMHgyMCksbXVsKGksMHg4MCkpCiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlICA6PSBkaXYobWxvYWQob2Zmc2V0KSwweDEwMDAwMDAwMCkKICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBvZmZzZXQgOj0gYWRkKG9mZnNldCwweDIwKQogICAgICAgICAgICAgICAgICAgIHZhbHVlICA6PSBkaXYobWxvYWQob2Zmc2V0KSwweDEwMDAwMDAwMCkKICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG9mZnNldCA6PSBhZGQob2Zmc2V0LDB4MjApCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgIDo9IGRpdihtbG9hZChvZmZzZXQpLDB4MTAwMDAwMDAwKQogICAgICAgICAgICAgICAgICAgIG1zdG9yZShvZmZzZXQsdmFsdWUpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBvZmZzZXQgOj0gYWRkKG9mZnNldCwweDIwKQogICAgICAgICAgICAgICAgICAgIHZhbHVlICA6PSBkaXYobWxvYWQob2Zmc2V0KSwweDEwMDAwMDAwMCkKICAgICAgICAgICAgICAgICAgICBtc3RvcmUob2Zmc2V0LHZhbHVlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMzIgOyBpICs9IDQpIHsKICAgICAgICAgICAgY21peFtpLzRdID0gKGZudihmbnYoZm52KG1peFtpXSwgbWl4W2krMV0pLCBtaXhbaSsyXSksIG1peFtpKzNdKSk7CiAgICAgICAgfQogICAgICAgIAoKICAgICAgICB1aW50IHJlc3VsdCA9IGNvbXB1dGVTaGEzKHMsY21peCk7IAoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIAogICAgfQp9CgovKioKKiBAdGl0bGUgUkxQUmVhZGVyCioKKiBSTFBSZWFkZXIgaXMgdXNlZCB0byByZWFkIGFuZCBwYXJzZSBSTFAgZW5jb2RlZCBkYXRhIGluIG1lbW9yeS4KKgoqIEBhdXRob3IgQW5kcmVhcyBPbG9mc3NvbiAoPGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjY4MDkwNjBjMWEwNzA0MDc1OTUxNTA1ODI4MGYwNTA5MDEwNDQ2MGIwNzA1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPikKKi8KbGlicmFyeSBSTFAgewoKIHVpbnQgY29uc3RhbnQgREFUQV9TSE9SVF9TVEFSVCA9IDB4ODA7CiB1aW50IGNvbnN0YW50IERBVEFfTE9OR19TVEFSVCA9IDB4Qjg7CiB1aW50IGNvbnN0YW50IExJU1RfU0hPUlRfU1RBUlQgPSAweEMwOwogdWludCBjb25zdGFudCBMSVNUX0xPTkdfU1RBUlQgPSAweEY4OwoKIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX09GRlNFVCA9IDB4Qjc7CiB1aW50IGNvbnN0YW50IExJU1RfTE9OR19PRkZTRVQgPSAweEY3OwoKCiBzdHJ1Y3QgUkxQSXRlbSB7CiAgICAgdWludCBfdW5zYWZlX21lbVB0cjsgICAgLy8gUG9pbnRlciB0byB0aGUgUkxQLWVuY29kZWQgYnl0ZXMuCiAgICAgdWludCBfdW5zYWZlX2xlbmd0aDsgICAgLy8gTnVtYmVyIG9mIGJ5dGVzLiBUaGlzIGlzIHRoZSBmdWxsIGxlbmd0aCBvZiB0aGUgc3RyaW5nLgogfQoKIHN0cnVjdCBJdGVyYXRvciB7CiAgICAgUkxQSXRlbSBfdW5zYWZlX2l0ZW07ICAgLy8gSXRlbSB0aGF0J3MgYmVpbmcgaXRlcmF0ZWQgb3Zlci4KICAgICB1aW50IF91bnNhZmVfbmV4dFB0cjsgICAvLyBQb3NpdGlvbiBvZiB0aGUgbmV4dCBpdGVtIGluIHRoZSBsaXN0LgogfQoKIC8qIEl0ZXJhdG9yICovCgogZnVuY3Rpb24gbmV4dChJdGVyYXRvciBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkgc3ViSXRlbSkgewogICAgIGlmKGhhc05leHQoc2VsZikpIHsKICAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3Vuc2FmZV9uZXh0UHRyOwogICAgICAgICB2YXIgaXRlbUxlbmd0aCA9IF9pdGVtTGVuZ3RoKHB0cik7CiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9tZW1QdHIgPSBwdHI7CiAgICAgICAgIHN1Ykl0ZW0uX3Vuc2FmZV9sZW5ndGggPSBpdGVtTGVuZ3RoOwogICAgICAgICBzZWxmLl91bnNhZmVfbmV4dFB0ciA9IHB0ciArIGl0ZW1MZW5ndGg7CiAgICAgfQogICAgIGVsc2UKICAgICAgICAgdGhyb3c7CiB9CgogZnVuY3Rpb24gbmV4dChJdGVyYXRvciBtZW1vcnkgc2VsZiwgYm9vbCBzdHJpY3QpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5IHN1Ykl0ZW0pIHsKICAgICBzdWJJdGVtID0gbmV4dChzZWxmKTsKICAgICBpZihzdHJpY3QgJiYgIV92YWxpZGF0ZShzdWJJdGVtKSkKICAgICAgICAgdGhyb3c7CiAgICAgcmV0dXJuOwogfQoKIGZ1bmN0aW9uIGhhc05leHQoSXRlcmF0b3IgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICB2YXIgaXRlbSA9IHNlbGYuX3Vuc2FmZV9pdGVtOwogICAgIHJldHVybiBzZWxmLl91bnNhZmVfbmV4dFB0ciA8IGl0ZW0uX3Vuc2FmZV9tZW1QdHIgKyBpdGVtLl91bnNhZmVfbGVuZ3RoOwogfQoKIC8qIFJMUEl0ZW0gKi8KCiAvLy8gQGRldiBDcmVhdGVzIGFuIFJMUEl0ZW0gZnJvbSBhbiBhcnJheSBvZiBSTFAgZW5jb2RlZCBieXRlcy4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGVuY29kZWQgYnl0ZXMuCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtCiBmdW5jdGlvbiB0b1JMUEl0ZW0oYnl0ZXMgbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7CiAgICAgdWludCBsZW4gPSBzZWxmLmxlbmd0aDsKICAgICBpZiAobGVuID09IDApIHsKICAgICAgICAgcmV0dXJuIFJMUEl0ZW0oMCwgMCk7CiAgICAgfQogICAgIHVpbnQgbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgbWVtUHRyIDo9IGFkZChzZWxmLCAweDIwKQogICAgIH0KICAgICByZXR1cm4gUkxQSXRlbShtZW1QdHIsIGxlbik7CiB9CgogLy8vIEBkZXYgQ3JlYXRlcyBhbiBSTFBJdGVtIGZyb20gYW4gYXJyYXkgb2YgUkxQIGVuY29kZWQgYnl0ZXMuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBlbmNvZGVkIGJ5dGVzLgogLy8vIEBwYXJhbSBzdHJpY3QgV2lsbCB0aHJvdyBpZiB0aGUgZGF0YSBpcyBub3QgUkxQIGVuY29kZWQuCiAvLy8gQHJldHVybiBBbiBSTFBJdGVtCiBmdW5jdGlvbiB0b1JMUEl0ZW0oYnl0ZXMgbWVtb3J5IHNlbGYsIGJvb2wgc3RyaWN0KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSkgewogICAgIHZhciBpdGVtID0gdG9STFBJdGVtKHNlbGYpOwogICAgIGlmKHN0cmljdCkgewogICAgICAgICB1aW50IGxlbiA9IHNlbGYubGVuZ3RoOwogICAgICAgICBpZihfcGF5bG9hZE9mZnNldChpdGVtKSA+IGxlbikKICAgICAgICAgICAgIHRocm93OwogICAgICAgICBpZihfaXRlbUxlbmd0aChpdGVtLl91bnNhZmVfbWVtUHRyKSAhPSBsZW4pCiAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgaWYoIV92YWxpZGF0ZShpdGVtKSkKICAgICAgICAgICAgIHRocm93OwogICAgIH0KICAgICByZXR1cm4gaXRlbTsKIH0KCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgbnVsbC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4KIGZ1bmN0aW9uIGlzTnVsbChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgewogICAgIHJldHVybiBzZWxmLl91bnNhZmVfbGVuZ3RoID09IDA7CiB9CgogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgYSBsaXN0LgogZnVuY3Rpb24gaXNMaXN0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7CiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIHJldCA6PSBpc3plcm8obHQoYnl0ZSgwLCBtbG9hZChtZW1QdHIpKSwgMHhDMCkpCiAgICAgfQogfQoKIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBkYXRhLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBkYXRhLgogZnVuY3Rpb24gaXNEYXRhKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7CiAgICAgaWYgKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIHJldCA6PSBsdChieXRlKDAsIG1sb2FkKG1lbVB0cikpLCAweEMwKQogICAgIH0KIH0KCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgZW1wdHkgKHN0cmluZyBvciBsaXN0KS4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiAndHJ1ZScgaWYgdGhlIGl0ZW0gaXMgbnVsbC4KIGZ1bmN0aW9uIGlzRW1wdHkoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICBpZihpc051bGwoc2VsZikpCiAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICB1aW50IGIwOwogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkKICAgICB9CiAgICAgcmV0dXJuIChiMCA9PSBEQVRBX1NIT1JUX1NUQVJUIHx8IGIwID09IExJU1RfU0hPUlRfU1RBUlQpOwogfQoKIC8vLyBAZGV2IEdldCB0aGUgbnVtYmVyIG9mIGl0ZW1zIGluIGFuIFJMUCBlbmNvZGVkIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLgogLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBpdGVtcy4KIGZ1bmN0aW9uIGl0ZW1zKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICBpZiAoIWlzTGlzdChzZWxmKSkKICAgICAgICAgcmV0dXJuIDA7CiAgICAgdWludCBiMDsKICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpCiAgICAgfQogICAgIHVpbnQgcG9zID0gbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7CiAgICAgdWludCBsYXN0ID0gbWVtUHRyICsgc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDE7CiAgICAgdWludCBpdG1zOwogICAgIHdoaWxlKHBvcyA8PSBsYXN0KSB7CiAgICAgICAgIHBvcyArPSBfaXRlbUxlbmd0aChwb3MpOwogICAgICAgICBpdG1zKys7CiAgICAgfQogICAgIHJldHVybiBpdG1zOwogfQoKIC8vLyBAZGV2IENyZWF0ZSBhbiBpdGVyYXRvci4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiBBbiAnSXRlcmF0b3InIG92ZXIgdGhlIGl0ZW0uCiBmdW5jdGlvbiBpdGVyYXRvcihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChJdGVyYXRvciBtZW1vcnkgaXQpIHsKICAgICBpZiAoIWlzTGlzdChzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdWludCBwdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyICsgX3BheWxvYWRPZmZzZXQoc2VsZik7CiAgICAgaXQuX3Vuc2FmZV9pdGVtID0gc2VsZjsKICAgICBpdC5fdW5zYWZlX25leHRQdHIgPSBwdHI7CiB9CgogLy8vIEBkZXYgUmV0dXJuIHRoZSBSTFAgZW5jb2RlZCBieXRlcy4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBieXRlcy4KIGZ1bmN0aW9uIHRvQnl0ZXMoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgewogICAgIHZhciBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoOwogICAgIGlmIChsZW4gPT0gMCkKICAgICAgICAgcmV0dXJuOwogICAgIGJ0cyA9IG5ldyBieXRlcyhsZW4pOwogICAgIF9jb3B5VG9CeXRlcyhzZWxmLl91bnNhZmVfbWVtUHRyLCBidHMsIGxlbik7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBieXRlcy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9EYXRhKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzIG1lbW9yeSBidHMpIHsKICAgICBpZighaXNEYXRhKHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7CiAgICAgYnRzID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgX2NvcHlUb0J5dGVzKHJTdGFydFBvcywgYnRzLCBsZW4pOwogfQoKIC8vLyBAZGV2IEdldCB0aGUgbGlzdCBvZiBzdWItaXRlbXMgZnJvbSBhbiBSTFAgZW5jb2RlZCBsaXN0LgogLy8vIFdhcm5pbmc6IFRoaXMgaXMgaW5lZmZpY2llbnQsIGFzIGl0IHJlcXVpcmVzIHRoYXQgdGhlIGxpc3QgaXMgcmVhZCB0d2ljZS4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiBBcnJheSBvZiBSTFBJdGVtcy4KIGZ1bmN0aW9uIHRvTGlzdChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtW10gbWVtb3J5IGxpc3QpIHsKICAgICBpZighaXNMaXN0KHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB2YXIgbnVtSXRlbXMgPSBpdGVtcyhzZWxmKTsKICAgICBsaXN0ID0gbmV3IFJMUEl0ZW1bXShudW1JdGVtcyk7CiAgICAgdmFyIGl0ID0gaXRlcmF0b3Ioc2VsZik7CiAgICAgdWludCBpZHg7CiAgICAgd2hpbGUoaGFzTmV4dChpdCkpIHsKICAgICAgICAgbGlzdFtpZHhdID0gbmV4dChpdCk7CiAgICAgICAgIGlkeCsrOwogICAgIH0KIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFzY2lpIHN0cmluZy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9Bc2NpaShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgbWVtb3J5IHN0cikgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBieXRlcyBtZW1vcnkgYnRzID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgX2NvcHlUb0J5dGVzKHJTdGFydFBvcywgYnRzLCBsZW4pOwogICAgIHN0ciA9IHN0cmluZyhidHMpOwogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSB1aW50LiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b1VpbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBkYXRhKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOwogICAgIGlmIChsZW4gPiAzMiB8fCBsZW4gPT0gMCkKICAgICAgICAgdGhyb3c7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBkYXRhIDo9IGRpdihtbG9hZChyU3RhcnRQb3MpLCBleHAoMjU2LCBzdWIoMzIsIGxlbikpKQogICAgIH0KIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYm9vbGVhbi4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9Cb29sKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZGF0YSkgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBpZiAobGVuICE9IDEpCiAgICAgICAgIHRocm93OwogICAgIHVpbnQgdGVtcDsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIHRlbXAgOj0gYnl0ZSgwLCBtbG9hZChyU3RhcnRQb3MpKQogICAgIH0KICAgICBpZiAodGVtcCA+IDEpCiAgICAgICAgIHRocm93OwogICAgIHJldHVybiB0ZW1wID09IDEgPyB0cnVlIDogZmFsc2U7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJ5dGUuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvQnl0ZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlIGRhdGEpIHsKICAgICBpZighaXNEYXRhKHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7CiAgICAgaWYgKGxlbiAhPSAxKQogICAgICAgICB0aHJvdzsKICAgICB1aW50IHRlbXA7CiAgICAgYXNzZW1ibHkgewogICAgICAgICB0ZW1wIDo9IGJ5dGUoMCwgbWxvYWQoclN0YXJ0UG9zKSkKICAgICB9CiAgICAgcmV0dXJuIGJ5dGUodGVtcCk7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhbiBpbnQuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvSW50KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGludCBkYXRhKSB7CiAgICAgcmV0dXJuIGludCh0b1VpbnQoc2VsZikpOwogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBieXRlczMyLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0J5dGVzMzIoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiBkYXRhKSB7CiAgICAgcmV0dXJuIGJ5dGVzMzIodG9VaW50KHNlbGYpKTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGFkZHJlc3MuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvQWRkcmVzcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGRhdGEpIHsKICAgICBpZighaXNEYXRhKHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7CiAgICAgaWYgKGxlbiAhPSAyMCkKICAgICAgICAgdGhyb3c7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBkYXRhIDo9IGRpdihtbG9hZChyU3RhcnRQb3MpLCBleHAoMjU2LCAxMikpCiAgICAgfQogfQoKIC8vIEdldCB0aGUgcGF5bG9hZCBvZmZzZXQuCiBmdW5jdGlvbiBfcGF5bG9hZE9mZnNldChSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICBpZihzZWxmLl91bnNhZmVfbGVuZ3RoID09IDApCiAgICAgICAgIHJldHVybiAwOwogICAgIHVpbnQgYjA7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQogICAgIH0KICAgICBpZihiMCA8IERBVEFfU0hPUlRfU1RBUlQpCiAgICAgICAgIHJldHVybiAwOwogICAgIGlmKGIwIDwgREFUQV9MT05HX1NUQVJUIHx8IChiMCA+PSBMSVNUX1NIT1JUX1NUQVJUICYmIGIwIDwgTElTVF9MT05HX1NUQVJUKSkKICAgICAgICAgcmV0dXJuIDE7CiAgICAgaWYoYjAgPCBMSVNUX1NIT1JUX1NUQVJUKQogICAgICAgICByZXR1cm4gYjAgLSBEQVRBX0xPTkdfT0ZGU0VUICsgMTsKICAgICByZXR1cm4gYjAgLSBMSVNUX0xPTkdfT0ZGU0VUICsgMTsKIH0KCiAvLyBHZXQgdGhlIGZ1bGwgbGVuZ3RoIG9mIGFuIFJMUCBpdGVtLgogZnVuY3Rpb24gX2l0ZW1MZW5ndGgodWludCBtZW1QdHIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBsZW4pIHsKICAgICB1aW50IGIwOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQogICAgIH0KICAgICBpZiAoYjAgPCBEQVRBX1NIT1JUX1NUQVJUKQogICAgICAgICBsZW4gPSAxOwogICAgIGVsc2UgaWYgKGIwIDwgREFUQV9MT05HX1NUQVJUKQogICAgICAgICBsZW4gPSBiMCAtIERBVEFfU0hPUlRfU1RBUlQgKyAxOwogICAgIGVsc2UgaWYgKGIwIDwgTElTVF9TSE9SVF9TVEFSVCkgewogICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIGJ5dGVzIGxlbmd0aCAoREFUQV9MT05HX09GRlNFVCkKICAgICAgICAgICAgIGxldCBkTGVuIDo9IGRpdihtbG9hZChhZGQobWVtUHRyLCAxKSksIGV4cCgyNTYsIHN1YigzMiwgYkxlbikpKSAvLyBkYXRhIGxlbmd0aAogICAgICAgICAgICAgbGVuIDo9IGFkZCgxLCBhZGQoYkxlbiwgZExlbikpIC8vIHRvdGFsIGxlbmd0aAogICAgICAgICB9CiAgICAgfQogICAgIGVsc2UgaWYgKGIwIDwgTElTVF9MT05HX1NUQVJUKQogICAgICAgICBsZW4gPSBiMCAtIExJU1RfU0hPUlRfU1RBUlQgKyAxOwogICAgIGVsc2UgewogICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICBsZXQgYkxlbiA6PSBzdWIoYjAsIDB4RjcpIC8vIGJ5dGVzIGxlbmd0aCAoTElTVF9MT05HX09GRlNFVCkKICAgICAgICAgICAgIGxldCBkTGVuIDo9IGRpdihtbG9hZChhZGQobWVtUHRyLCAxKSksIGV4cCgyNTYsIHN1YigzMiwgYkxlbikpKSAvLyBkYXRhIGxlbmd0aAogICAgICAgICAgICAgbGVuIDo9IGFkZCgxLCBhZGQoYkxlbiwgZExlbikpIC8vIHRvdGFsIGxlbmd0aAogICAgICAgICB9CiAgICAgfQogfQoKIC8vIEdldCBzdGFydCBwb3NpdGlvbiBhbmQgbGVuZ3RoIG9mIHRoZSBkYXRhLgogZnVuY3Rpb24gX2RlY29kZShSTFBJdGVtIG1lbW9yeSBzZWxmKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbWVtUHRyLCB1aW50IGxlbikgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHVpbnQgYjA7CiAgICAgdWludCBzdGFydCA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKHN0YXJ0KSkKICAgICB9CiAgICAgaWYgKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkgewogICAgICAgICBtZW1QdHIgPSBzdGFydDsKICAgICAgICAgbGVuID0gMTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KICAgICBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpIHsKICAgICAgICAgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDE7CiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0ICsgMTsKICAgICB9IGVsc2UgewogICAgICAgICB1aW50IGJMZW47CiAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgIGJMZW4gOj0gc3ViKGIwLCAweEI3KSAvLyBEQVRBX0xPTkdfT0ZGU0VUCiAgICAgICAgIH0KICAgICAgICAgbGVuID0gc2VsZi5fdW5zYWZlX2xlbmd0aCAtIDEgLSBiTGVuOwogICAgICAgICBtZW1QdHIgPSBzdGFydCArIGJMZW4gKyAxOwogICAgIH0KICAgICByZXR1cm47CiB9CgogLy8gQXNzdW1lcyB0aGF0IGVub3VnaCBtZW1vcnkgaGFzIGJlZW4gYWxsb2NhdGVkIHRvIHN0b3JlIGluIHRhcmdldC4KIGZ1bmN0aW9uIF9jb3B5VG9CeXRlcyh1aW50IGJ0c1B0ciwgYnl0ZXMgbWVtb3J5IHRndCwgdWludCBidHNMZW4pIHByaXZhdGUgY29uc3RhbnQgewogICAgIC8vIEV4cGxvaXRpbmcgdGhlIGZhY3QgdGhhdCAndGd0JyB3YXMgdGhlIGxhc3QgdGhpbmcgdG8gYmUgYWxsb2NhdGVkLAogICAgIC8vIHdlIGNhbiB3cml0ZSBlbnRpcmUgd29yZHMsIGFuZCBqdXN0IG92ZXJ3cml0ZSBhbnkgZXhjZXNzLgogICAgIGFzc2VtYmx5IHsKICAgICAgICAgewogICAgICAgICAgICAgICAgIGxldCBpIDo9IDAgLy8gU3RhcnQgYXQgYXJyICsgMHgyMAogICAgICAgICAgICAgICAgIGxldCB3b3JkcyA6PSBkaXYoYWRkKGJ0c0xlbiwgMzEpLCAzMikKICAgICAgICAgICAgICAgICBsZXQgck9mZnNldCA6PSBidHNQdHIKICAgICAgICAgICAgICAgICBsZXQgd09mZnNldCA6PSBhZGQodGd0LCAweDIwKQogICAgICAgICAgICAgdGFnX2xvb3A6CiAgICAgICAgICAgICAgICAganVtcGkoZW5kLCBlcShpLCB3b3JkcykpCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0IDo9IG11bChpLCAweDIwKQogICAgICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHdPZmZzZXQsIG9mZnNldCksIG1sb2FkKGFkZChyT2Zmc2V0LCBvZmZzZXQpKSkKICAgICAgICAgICAgICAgICAgICAgaSA6PSBhZGQoaSwgMSkKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAganVtcCh0YWdfbG9vcCkKICAgICAgICAgICAgIGVuZDoKICAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRndCwgYWRkKDB4MjAsIG1sb2FkKHRndCkpKSwgMCkKICAgICAgICAgfQogICAgIH0KIH0KCiAgICAgLy8gQ2hlY2sgdGhhdCBhbiBSTFAgaXRlbSBpcyB2YWxpZC4KICAgICBmdW5jdGlvbiBfdmFsaWRhdGUoUkxQSXRlbSBtZW1vcnkgc2VsZikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgewogICAgICAgICAvLyBDaGVjayB0aGF0IFJMUCBpcyB3ZWxsLWZvcm1lZC4KICAgICAgICAgdWludCBiMDsKICAgICAgICAgdWludCBiMTsKICAgICAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpCiAgICAgICAgICAgICBiMSA6PSBieXRlKDEsIG1sb2FkKG1lbVB0cikpCiAgICAgICAgIH0KICAgICAgICAgaWYoYjAgPT0gREFUQV9TSE9SVF9TVEFSVCArIDEgJiYgYjEgPCBEQVRBX1NIT1JUX1NUQVJUKQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICB9Cn0KCgoKCmNvbnRyYWN0IEFndCB7CiAgICB1c2luZyBSTFAgZm9yIFJMUC5STFBJdGVtOwogICAgdXNpbmcgUkxQIGZvciBSTFAuSXRlcmF0b3I7CiAgICB1c2luZyBSTFAgZm9yIGJ5dGVzOwogCiAgICBzdHJ1Y3QgQmxvY2tIZWFkZXIgewogICAgICAgIHVpbnQgICAgICAgcHJldkJsb2NrSGFzaDsgLy8gMAogICAgICAgIHVpbnQgICAgICAgY29pbmJhc2U7ICAgICAgLy8gMQogICAgICAgIHVpbnQgICAgICAgYmxvY2tOdW1iZXI7ICAgLy8gOAogICAgICAgIC8vdWludCAgICAgICBnYXNVc2VkOyAgICAgICAvLyAxMAogICAgICAgIHVpbnQgICAgICAgdGltZXN0YW1wOyAgICAgLy8gMTEKICAgICAgICBieXRlczMyICAgIGV4dHJhRGF0YTsgICAgIC8vIDEyCiAgICB9CiAKICAgIGZ1bmN0aW9uIEFndCgpIHt9CiAgICAgCiAgICBmdW5jdGlvbiBwYXJzZUJsb2NrSGVhZGVyKCBieXRlcyBybHBIZWFkZXIgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKEJsb2NrSGVhZGVyKSB7CiAgICAgICAgQmxvY2tIZWFkZXIgbWVtb3J5IGhlYWRlcjsKICAgICAgICAKICAgICAgICB2YXIgaXQgPSBybHBIZWFkZXIudG9STFBJdGVtKCkuaXRlcmF0b3IoKTsgICAgICAgIAogICAgICAgIHVpbnQgaWR4OwogICAgICAgIHdoaWxlKGl0Lmhhc05leHQoKSkgewogICAgICAgICAgICBpZiggaWR4ID09IDAgKSBoZWFkZXIucHJldkJsb2NrSGFzaCA9IGl0Lm5leHQoKS50b1VpbnQoKTsKICAgICAgICAgICAgZWxzZSBpZiAoIGlkeCA9PSAyICkgaGVhZGVyLmNvaW5iYXNlID0gaXQubmV4dCgpLnRvVWludCgpOwogICAgICAgICAgICBlbHNlIGlmICggaWR4ID09IDggKSBoZWFkZXIuYmxvY2tOdW1iZXIgPSBpdC5uZXh0KCkudG9VaW50KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCBpZHggPT0gMTEgKSBoZWFkZXIudGltZXN0YW1wID0gaXQubmV4dCgpLnRvVWludCgpOwogICAgICAgICAgICBlbHNlIGlmICggaWR4ID09IDEyICkgaGVhZGVyLmV4dHJhRGF0YSA9IGJ5dGVzMzIoaXQubmV4dCgpLnRvVWludCgpKTsKICAgICAgICAgICAgZWxzZSBpdC5uZXh0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZHgrKzsKICAgICAgICB9CiAKICAgICAgICByZXR1cm4gaGVhZGVyOyAgICAgICAgCiAgICB9CiAgICAgICAgICAgIAogICAgLy9ldmVudCBWZXJpZnlBZ3QoIHN0cmluZyBtc2csIHVpbnQgaW5kZXggKTsKICAgIGV2ZW50IFZlcmlmeUFndCggdWludCBlcnJvciwgdWludCBpbmRleCApOyAgICAKICAgIAogICAgc3RydWN0IFZlcmlmeUFndERhdGEgewogICAgICAgIHVpbnQgcm9vdEhhc2g7CiAgICAgICAgdWludCByb290TWluOwogICAgICAgIHVpbnQgcm9vdE1heDsKICAgICAgICAKICAgICAgICB1aW50IGxlYWZIYXNoOwogICAgICAgIHVpbnQgbGVhZkNvdW50ZXI7ICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiB2ZXJpZnlBZ3QoIFZlcmlmeUFndERhdGEgZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgdWludCAgIGJyYW5jaEluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gY291bnRlcnNCcmFuY2gsCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBoYXNoZXNCcmFuY2ggKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdWludCBjdXJyZW50SGFzaCA9IGRhdGEubGVhZkhhc2ggJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgIAogICAgICAgIHVpbnQgbGVmdENvdW50ZXJNaW47CiAgICAgICAgdWludCBsZWZ0Q291bnRlck1heDsgICAgICAgIAogICAgICAgIHVpbnQgbGVmdEhhc2g7CiAgICAgICAgCiAgICAgICAgdWludCByaWdodENvdW50ZXJNaW47CiAgICAgICAgdWludCByaWdodENvdW50ZXJNYXg7ICAgICAgICAKICAgICAgICB1aW50IHJpZ2h0SGFzaDsKICAgICAgICAKICAgICAgICB1aW50IG1pbiA9IGRhdGEubGVhZkNvdW50ZXI7CiAgICAgICAgdWludCBtYXggPSBkYXRhLmxlYWZDb3VudGVyOwogICAgICAgIAogICAgICAgIGZvciggdWludCBpID0gMCA7IGkgPCBjb3VudGVyc0JyYW5jaC5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgICAgIGlmKCBicmFuY2hJbmRleCAmIDB4MSA+IDAgKSB7CiAgICAgICAgICAgICAgICBsZWZ0Q291bnRlck1pbiA9IGNvdW50ZXJzQnJhbmNoW2ldICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICAgICAgICAgIGxlZnRDb3VudGVyTWF4ID0gY291bnRlcnNCcmFuY2hbaV0gPj4gMTI4OyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxlZnRIYXNoICAgID0gaGFzaGVzQnJhbmNoW2ldOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByaWdodENvdW50ZXJNaW4gPSBtaW47CiAgICAgICAgICAgICAgICByaWdodENvdW50ZXJNYXggPSBtYXg7CiAgICAgICAgICAgICAgICByaWdodEhhc2ggICAgPSBjdXJyZW50SGFzaDsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGVmdENvdW50ZXJNaW4gPSBtaW47CiAgICAgICAgICAgICAgICBsZWZ0Q291bnRlck1heCA9IG1heDsKICAgICAgICAgICAgICAgIGxlZnRIYXNoICAgID0gY3VycmVudEhhc2g7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1pbiA9IGNvdW50ZXJzQnJhbmNoW2ldICYgMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1heCA9IGNvdW50ZXJzQnJhbmNoW2ldID4+IDEyODsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByaWdodEhhc2ggICAgPSBoYXNoZXNCcmFuY2hbaV07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY3VycmVudEhhc2ggPSB1aW50KHNoYTMobGVmdENvdW50ZXJNaW4gKyAobGVmdENvdW50ZXJNYXggPDwgMTI4KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdEhhc2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0Q291bnRlck1pbiArIChyaWdodENvdW50ZXJNYXggPDwgMTI4KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRIYXNoKSkgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoIChsZWZ0Q291bnRlck1pbiA+PSBsZWZ0Q291bnRlck1heCkgfHwgKHJpZ2h0Q291bnRlck1pbiA+PSByaWdodENvdW50ZXJNYXgpICkgewogICAgICAgICAgICAgICAgaWYoIGkgPiAwICkgewogICAgICAgICAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAiY291bnRlcnMgbWlzbWF0Y2giLGkpOwogICAgICAgICAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwMCwgaSApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCBsZWZ0Q291bnRlck1pbiA+IGxlZnRDb3VudGVyTWF4ICkgewogICAgICAgICAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAiY291bnRlcnMgbWlzbWF0Y2giLGkpOwogICAgICAgICAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwMSwgaSApOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggcmlnaHRDb3VudGVyTWluID4gcmlnaHRDb3VudGVyTWF4ICkgewogICAgICAgICAgICAgICAgICAgIC8vVmVyaWZ5QWd0KCAiY291bnRlcnMgbWlzbWF0Y2giLGkpOwogICAgICAgICAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwMiwgaSApOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiggbGVmdENvdW50ZXJNYXggPj0gcmlnaHRDb3VudGVyTWluICkgewogICAgICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDA5LCBpICk7ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pbiA9IGxlZnRDb3VudGVyTWluOwogICAgICAgICAgICBtYXggPSByaWdodENvdW50ZXJNYXg7CiAgICAgICAgICAgIAogICAgICAgICAgICBicmFuY2hJbmRleCA9IGJyYW5jaEluZGV4IC8gMjsKICAgICAgICB9CgogICAgICAgIGlmKCBtaW4gIT0gZGF0YS5yb290TWluICkgewogICAgICAgICAgICAvL1ZlcmlmeUFndCggIm1pbiBkb2VzIG5vdCBtYXRjaCByb290IG1pbiIsbWluKTsKICAgICAgICAgICAgVmVyaWZ5QWd0KCAweDgwMDAwMDAzLCBtaW4gKTsgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiggbWF4ICE9IGRhdGEucm9vdE1heCApIHsKICAgICAgICAgICAgLy9WZXJpZnlBZ3QoICJtYXggZG9lcyBub3QgbWF0Y2ggcm9vdCBtYXgiLG1heCk7CiAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwNCwgbWF4ICk7ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiggY3VycmVudEhhc2ggIT0gZGF0YS5yb290SGFzaCApIHsKICAgICAgICAgICAgLy9WZXJpZnlBZ3QoICJoYXNoIGRvZXMgbm90IG1hdGNoIHJvb3QgaGFzaCIsY3VycmVudEhhc2gpOyAgICAgICAgCiAgICAgICAgICAgIFZlcmlmeUFndCggMHg4MDAwMDAwNSwgY3VycmVudEhhc2ggKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdmVyaWZ5QWd0RGVidWdGb3JUZXN0aW5nKCB1aW50IHJvb3RIYXNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IHJvb3RNaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgcm9vdE1heCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsZWFmSGFzaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsZWFmQ291bnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBicmFuY2hJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGNvdW50ZXJzQnJhbmNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gaGFzaGVzQnJhbmNoICkgcmV0dXJucyhib29sKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIFZlcmlmeUFndERhdGEgbWVtb3J5IGRhdGE7CiAgICAgICAgZGF0YS5yb290SGFzaCA9IHJvb3RIYXNoOwogICAgICAgIGRhdGEucm9vdE1pbiA9IHJvb3RNaW47CiAgICAgICAgZGF0YS5yb290TWF4ID0gcm9vdE1heDsKICAgICAgICBkYXRhLmxlYWZIYXNoID0gbGVhZkhhc2g7CiAgICAgICAgZGF0YS5sZWFmQ291bnRlciA9IGxlYWZDb3VudGVyOwogICAgICAgIAogICAgICAgIHJldHVybiB2ZXJpZnlBZ3QoIGRhdGEsIGJyYW5jaEluZGV4LCBjb3VudGVyc0JyYW5jaCwgaGFzaGVzQnJhbmNoICk7CiAgICB9ICAgICAgICAgCn0KCmNvbnRyYWN0IFdlaWdodGVkU3VibWlzc2lvbiB7CiAgICBmdW5jdGlvbiBXZWlnaHRlZFN1Ym1pc3Npb24oKXt9CiAgICAKICAgIHN0cnVjdCBTaW5nbGVTdWJtaXNzaW9uRGF0YSB7CiAgICAgICAgdWludDEyOCBudW1TaGFyZXM7CiAgICAgICAgdWludDEyOCBzdWJtaXNzaW9uVmFsdWU7CiAgICAgICAgdWludDEyOCB0b3RhbFByZXZpb3VzU3VibWlzc2lvblZhbHVlOwogICAgICAgIHVpbnQxMjggbWluOwogICAgICAgIHVpbnQxMjggbWF4OwogICAgICAgIHVpbnQxMjggYXVnUm9vdDsKICAgIH0KICAgIAogICAgc3RydWN0IFN1Ym1pc3Npb25NZXRhRGF0YSB7CiAgICAgICAgdWludDY0ICBudW1QZW5kaW5nU3VibWlzc2lvbnM7CiAgICAgICAgdWludDMyICByZWFkeUZvclZlcmlmaWNhdGlvbjsgLy8gc3VwcG9zZSB0byBiZSBib29sCiAgICAgICAgdWludDMyICBsYXN0U3VibWlzc2lvbkJsb2NrTnVtYmVyOwogICAgICAgIHVpbnQxMjggdG90YWxTdWJtaXNzaW9uVmFsdWU7CiAgICAgICAgdWludDEyOCBkaWZmaWN1bHR5OwogICAgICAgIHVpbnQxMjggbGFzdENvdW50ZXI7CiAgICAgICAgCiAgICAgICAgdWludCAgICBzdWJtaXNzaW9uU2VlZDsKICAgICAgICAKICAgIH0KICAgIAogICAgbWFwcGluZyhhZGRyZXNzPT5TdWJtaXNzaW9uTWV0YURhdGEpIHN1Ym1pc3Npb25zTWV0YURhdGE7CiAgICAKICAgIC8vICh1c2VyLCBzdWJtaXNzaW9uIG51bWJlcik9PmRhdGEKICAgIG1hcHBpbmcoYWRkcmVzcz0+bWFwcGluZyh1aW50PT5TaW5nbGVTdWJtaXNzaW9uRGF0YSkpIHN1Ym1pc3Npb25zRGF0YTsKICAgIAogICAgZXZlbnQgU3VibWl0Q2xhaW0oIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7CiAgICBmdW5jdGlvbiBzdWJtaXRDbGFpbSggdWludCBudW1TaGFyZXMsIHVpbnQgZGlmZmljdWx0eSwgdWludCBtaW4sIHVpbnQgbWF4LCB1aW50IGF1Z1Jvb3QsIGJvb2wgbGFzdENsYWltQmVmb3JlVmVyaWZpY2F0aW9uICkgewogICAgICAgIFN1Ym1pc3Npb25NZXRhRGF0YSBtZW1vcnkgbWV0YURhdGEgPSBzdWJtaXNzaW9uc01ldGFEYXRhW21zZy5zZW5kZXJdOwogICAgICAgIAogICAgICAgIGlmKCBtZXRhRGF0YS5sYXN0Q291bnRlciA+PSBtaW4gKSB7CiAgICAgICAgICAgIC8vIG1pbmVyIGNoZWF0ZWQuIG1pbiBjb3VudGVyIGlzIHRvbyBsb3cKICAgICAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODEwMDAwMDEsIG1ldGFEYXRhLmxhc3RDb3VudGVyICk7IAogICAgICAgICAgICByZXR1cm47ICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYoIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID4gMCApIHsKICAgICAgICAgICAgLy8gbWluZXIgY2hlYXRlZCAtIHNob3VsZCBnbyB2ZXJpZmljYXRpb24gZmlyc3QKICAgICAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODEwMDAwMDIsIDAgKTsgCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYoIG1ldGFEYXRhLm51bVBlbmRpbmdTdWJtaXNzaW9ucyA+IDAgKSB7CiAgICAgICAgICAgIGlmKCBtZXRhRGF0YS5kaWZmaWN1bHR5ICE9IGRpZmZpY3VsdHkgKSB7CiAgICAgICAgICAgICAgICAvLyBjb3VsZCBub3QgY2hhbmdlIGRpZmZpY3VsdHkgYmVmb3JlIHZlcmlmaWNhdGlvbgogICAgICAgICAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODEwMDAwMDMsIG1ldGFEYXRhLmRpZmZpY3VsdHkgKTsgCiAgICAgICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgU2luZ2xlU3VibWlzc2lvbkRhdGEgbWVtb3J5IHN1Ym1pc3Npb25EYXRhOwogICAgICAgIAogICAgICAgIHN1Ym1pc3Npb25EYXRhLm51bVNoYXJlcyA9IHVpbnQ2NChudW1TaGFyZXMpOwogICAgICAgIHVpbnQgYmxvY2tEaWZmaWN1bHR5OwogICAgICAgIGlmKCBibG9jay5kaWZmaWN1bHR5ID09IDAgKSB7CiAgICAgICAgICAgIC8vIHRlc3RycGMgLSBmYWtlIGluY3JlYXNpbmcgZGlmZmljdWx0eQogICAgICAgICAgICBibG9ja0RpZmZpY3VsdHkgPSAoOTAwMDAwMDAwICogKG1ldGFEYXRhLm51bVBlbmRpbmdTdWJtaXNzaW9ucysxKSk7IAogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYmxvY2tEaWZmaWN1bHR5ID0gYmxvY2suZGlmZmljdWx0eTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc3VibWlzc2lvbkRhdGEuc3VibWlzc2lvblZhbHVlID0gdWludDEyOCgodWludChudW1TaGFyZXMgKiBkaWZmaWN1bHR5KSAqICg1IGV0aGVyKSkgLyBibG9ja0RpZmZpY3VsdHkpOwogICAgICAgIAogICAgICAgIHN1Ym1pc3Npb25EYXRhLnRvdGFsUHJldmlvdXNTdWJtaXNzaW9uVmFsdWUgPSBtZXRhRGF0YS50b3RhbFN1Ym1pc3Npb25WYWx1ZTsKICAgICAgICBzdWJtaXNzaW9uRGF0YS5taW4gPSB1aW50MTI4KG1pbik7CiAgICAgICAgc3VibWlzc2lvbkRhdGEubWF4ID0gdWludDEyOChtYXgpOwogICAgICAgIHN1Ym1pc3Npb25EYXRhLmF1Z1Jvb3QgPSB1aW50MTI4KGF1Z1Jvb3QpOwogICAgICAgIAogICAgICAgIChzdWJtaXNzaW9uc0RhdGFbbXNnLnNlbmRlcl0pW21ldGFEYXRhLm51bVBlbmRpbmdTdWJtaXNzaW9uc10gPSBzdWJtaXNzaW9uRGF0YTsKICAgICAgICAKICAgICAgICAvLyB1cGRhdGUgbWV0YSBkYXRhCiAgICAgICAgbWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zKys7CiAgICAgICAgbWV0YURhdGEubGFzdFN1Ym1pc3Npb25CbG9ja051bWJlciA9IHVpbnQzMihibG9jay5udW1iZXIpOwogICAgICAgIG1ldGFEYXRhLmRpZmZpY3VsdHkgPSB1aW50MTI4KGRpZmZpY3VsdHkpOwogICAgICAgIG1ldGFEYXRhLmxhc3RDb3VudGVyID0gdWludDEyOChtYXgpOwogICAgICAgIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID0gbGFzdENsYWltQmVmb3JlVmVyaWZpY2F0aW9uID8gdWludDMyKDEpIDogdWludDMyKDApOwoKICAgICAgICB1aW50MTI4IHRlbXAxMjg7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgdGVtcDEyOCA9IG1ldGFEYXRhLnRvdGFsU3VibWlzc2lvblZhbHVlOyAKCiAgICAgICAgbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWUgKz0gc3VibWlzc2lvbkRhdGEuc3VibWlzc2lvblZhbHVlOwogICAgICAgIAogICAgICAgIGlmKCB0ZW1wMTI4ID4gbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWUgKSB7CiAgICAgICAgICAgIC8vIG92ZXJmbG93IGluIGNhbGN1bGF0aW9uCiAgICAgICAgICAgIC8vIG5vdGUgdGhhdCB0aGlzIGNvZGUgaXMgcmVhY2hhYmxlIGlmIHVzZXIgaXMgZGlzaG9uZXN0IGFuZCBnaXZlIGZhbHNlCiAgICAgICAgICAgIC8vIHJlcG9ydCBvbiBoaXMgc3VibWlzc2lvbi4gYnV0IGV2ZW4gd2l0aG91dAogICAgICAgICAgICAvLyB0aGlzIHZhbGlkYXRpb24sIHVzZXIgY2Fubm90IGJlbmlmaXQgZnJvbSB0aGUgb3ZlcmZsb3cKICAgICAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODEwMDAwMDUsIDAgKTsgCiAgICAgICAgICAgIHJldHVybjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIAogICAgICAgIHN1Ym1pc3Npb25zTWV0YURhdGFbbXNnLnNlbmRlcl0gPSBtZXRhRGF0YTsKICAgICAgICAKICAgICAgICAvLyBldmVyeXRoaW5nIGlzIG9rCiAgICAgICAgU3VibWl0Q2xhaW0oIG1zZy5zZW5kZXIsIDAsIG51bVNoYXJlcyAqIGRpZmZpY3VsdHkgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDbGFpbVNlZWQoYWRkcmVzcyBzZW5kZXIpIGNvbnN0YW50IHJldHVybnModWludCl7CiAgICAgICAgU3VibWlzc2lvbk1ldGFEYXRhIG1lbW9yeSBtZXRhRGF0YSA9IHN1Ym1pc3Npb25zTWV0YURhdGFbc2VuZGVyXTsKICAgICAgICBpZiggbWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPT0gMCApIHJldHVybiAwOwogICAgICAgIAogICAgICAgIGlmKCBtZXRhRGF0YS5zdWJtaXNzaW9uU2VlZCAhPSAwICkgcmV0dXJuIG1ldGFEYXRhLnN1Ym1pc3Npb25TZWVkOyAKICAgICAgICAKICAgICAgICB1aW50IGxhc3RCbG9ja051bWJlciA9IHVpbnQobWV0YURhdGEubGFzdFN1Ym1pc3Npb25CbG9ja051bWJlcik7CiAgICAgICAgCiAgICAgICAgaWYoIGJsb2NrLm51bWJlciA+IGxhc3RCbG9ja051bWJlciArIDIwMCApIHJldHVybiAwOwogICAgICAgIGlmKCBibG9jay5udW1iZXIgPD0gbGFzdEJsb2NrTnVtYmVyICsgMTUgKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgIAogICAgICAgIHJldHVybiB1aW50KGJsb2NrLmJsb2NraGFzaChsYXN0QmxvY2tOdW1iZXIgKyAxMCkpOwogICAgfQogICAgCiAgICBldmVudCBTdG9yZUNsYWltU2VlZCggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsKICAgIGZ1bmN0aW9uIHN0b3JlQ2xhaW1TZWVkKCBhZGRyZXNzIG1pbmVyICkgewogICAgICAgIC8vIGFueW9uZSB3aG8gaXMgd2lsbGluZyB0byBwYXkgZ2FzIGZlZXMgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbgogICAgICAgIHVpbnQgc2VlZCA9IGdldENsYWltU2VlZCggbWluZXIgKTsKICAgICAgICBpZiggc2VlZCAhPSAwICkgewogICAgICAgICAgICBzdWJtaXNzaW9uc01ldGFEYXRhW21pbmVyXS5zdWJtaXNzaW9uU2VlZCA9IHNlZWQ7CiAgICAgICAgICAgIFN0b3JlQ2xhaW1TZWVkKCBtc2cuc2VuZGVyLCAwLCB1aW50KG1pbmVyKSApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGVsc2UKICAgICAgICBTdWJtaXNzaW9uTWV0YURhdGEgbWVtb3J5IG1ldGFEYXRhID0gc3VibWlzc2lvbnNNZXRhRGF0YVttaW5lcl07CiAgICAgICAgdWludCBsYXN0QmxvY2tOdW1iZXIgPSB1aW50KG1ldGFEYXRhLmxhc3RTdWJtaXNzaW9uQmxvY2tOdW1iZXIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgaWYoIG1ldGFEYXRhLnJlYWR5Rm9yVmVyaWZpY2F0aW9uID09IDAgKSB7CiAgICAgICAgICAgIC8vIHN1Ym1pc3Npb24gaXMgbm90IHJlYWR5IGZvciB2ZXJpZmljYXRpb24KICAgICAgICAgICAgU3RvcmVDbGFpbVNlZWQoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMCwgdWludChtaW5lcikgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiggYmxvY2subnVtYmVyID4gbGFzdEJsb2NrTnVtYmVyICsgMjAwICkgewogICAgICAgICAgICAvLyBzdWJtaXNzaW9uIGlzIG5vdCByZWFkeSBmb3IgdmVyaWZpY2F0aW9uCiAgICAgICAgICAgIFN0b3JlQ2xhaW1TZWVkKCBtc2cuc2VuZGVyLCAweDgwMDAwMDEsIHVpbnQobWluZXIpICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoIGJsb2NrLm51bWJlciA8PSBsYXN0QmxvY2tOdW1iZXIgKyAxNSApIHsKICAgICAgICAgICAgLy8gaXQgaXMgdG9vIGxhdGUgdG8gY2FsbCBzdG9yZSBmdW5jdGlvbgogICAgICAgICAgICBTdG9yZUNsYWltU2VlZCggbXNnLnNlbmRlciwgMHg4MDAwMDAyLCB1aW50KG1pbmVyKSApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gdW5rbm93biBlcnJvcgogICAgICAgICAgICBTdG9yZUNsYWltU2VlZCggbXNnLnNlbmRlciwgMHg4MDAwMDAzLCB1aW50KG1pbmVyKSApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB2ZXJpZnlTdWJtaXNzaW9uSW5kZXgoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IHNlZWQsIHVpbnQgc3VibWlzc2lvbk51bWJlciwgdWludCBzaGFyZUluZGV4ICkgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYoIHNlZWQgPT0gMCApIHJldHVybiBmYWxzZTsKICAgIAogICAgICAgIHVpbnQgdG90YWxWYWx1ZSA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLnRvdGFsU3VibWlzc2lvblZhbHVlKTsKICAgICAgICB1aW50IG51bVBlbmRpbmdTdWJtaXNzaW9ucyA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLm51bVBlbmRpbmdTdWJtaXNzaW9ucyk7CgogICAgICAgIFNpbmdsZVN1Ym1pc3Npb25EYXRhIG1lbW9yeSBzdWJtaXNzaW9uRGF0YSA9IChzdWJtaXNzaW9uc0RhdGFbc2VuZGVyXSlbc3VibWlzc2lvbk51bWJlcl07ICAgICAgICAKICAgICAgICAKICAgICAgICBpZiggc3VibWlzc2lvbk51bWJlciA+PSBudW1QZW5kaW5nU3VibWlzc2lvbnMgKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgdWludCBzZWVkMSA9IHNlZWQgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgIHVpbnQgc2VlZDIgPSBzZWVkIC8gKDIqKjEyOCk7CiAgICAgICAgCiAgICAgICAgdWludCBzZWxlY3RlZFZhbHVlID0gc2VlZDEgJSB0b3RhbFZhbHVlOwogICAgICAgIGlmKCB1aW50KHN1Ym1pc3Npb25EYXRhLnRvdGFsUHJldmlvdXNTdWJtaXNzaW9uVmFsdWUpID49IHNlbGVjdGVkVmFsdWUgKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYoIHVpbnQoc3VibWlzc2lvbkRhdGEudG90YWxQcmV2aW91c1N1Ym1pc3Npb25WYWx1ZSArIHN1Ym1pc3Npb25EYXRhLnN1Ym1pc3Npb25WYWx1ZSkgPCBzZWxlY3RlZFZhbHVlICkgcmV0dXJuIGZhbHNlOyAgCgogICAgICAgIHVpbnQgZXhwZWN0ZWRTaGFyZXNoYXJlSW5kZXggPSAoc2VlZDIgJSB1aW50KHN1Ym1pc3Npb25EYXRhLm51bVNoYXJlcykpOwogICAgICAgIGlmKCBleHBlY3RlZFNoYXJlc2hhcmVJbmRleCAhPSBzaGFyZUluZGV4ICkgcmV0dXJuIGZhbHNlOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTdWJtaXNzaW9uSW5kZXgoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IHNlZWQgKSBjb25zdGFudCByZXR1cm5zKHVpbnRbMl0pIHsKICAgICAgICAvLyB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBleGVjdXRlZCBvZmYgY2hhaW4gLSBoZW5lLCBpdCBpcyBub3Qgb3B0aW1pemVkCiAgICAgICAgdWludCBzZWVkMSA9IHNlZWQgJiAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGOwogICAgICAgIHVpbnQgc2VlZDIgPSBzZWVkIC8gKDIqKjEyOCk7CgogICAgICAgIHVpbnQgdG90YWxWYWx1ZSA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLnRvdGFsU3VibWlzc2lvblZhbHVlKTsKICAgICAgICB1aW50IG51bVBlbmRpbmdTdWJtaXNzaW9ucyA9IHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLm51bVBlbmRpbmdTdWJtaXNzaW9ucyk7CgogICAgICAgIHVpbnQgc2VsZWN0ZWRWYWx1ZSA9IHNlZWQxICUgdG90YWxWYWx1ZTsKICAgICAgICAKICAgICAgICBTaW5nbGVTdWJtaXNzaW9uRGF0YSBtZW1vcnkgc3VibWlzc2lvbkRhdGE7ICAgICAgICAKICAgICAgICAKICAgICAgICBmb3IoIHVpbnQgc3VibWlzc2lvbkluZCA9IDAgOyBzdWJtaXNzaW9uSW5kIDwgbnVtUGVuZGluZ1N1Ym1pc3Npb25zIDsgc3VibWlzc2lvbkluZCsrICkgewogICAgICAgICAgICBzdWJtaXNzaW9uRGF0YSA9IChzdWJtaXNzaW9uc0RhdGFbc2VuZGVyXSlbc3VibWlzc2lvbkluZF07ICAgICAgICAKICAgICAgICAgICAgaWYoIHVpbnQoc3VibWlzc2lvbkRhdGEudG90YWxQcmV2aW91c1N1Ym1pc3Npb25WYWx1ZSArIHN1Ym1pc3Npb25EYXRhLnN1Ym1pc3Npb25WYWx1ZSkgPj0gc2VsZWN0ZWRWYWx1ZSApIGJyZWFrOyAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHVuZXhwZWN0ZWQgZXJyb3IKICAgICAgICBpZiggc3VibWlzc2lvbkluZCA9PSBudW1QZW5kaW5nU3VibWlzc2lvbnMgKSByZXR1cm4gW3VpbnQoMHhGRkZGRkZGRkZGRkZGRkZGKSwweEZGRkZGRkZGRkZGRkZGRkZdOwoKICAgICAgICB1aW50IHNoYXJlSW5kZXggPSBzZWVkMiAlIHVpbnQoc3VibWlzc2lvbkRhdGEubnVtU2hhcmVzKTsgCiAgICAgICAgCiAgICAgICAgcmV0dXJuIFtzdWJtaXNzaW9uSW5kLCBzaGFyZUluZGV4XTsKICAgIH0KICAgIAogICAgLy8gc2hvdWxkIGJlIGNhbGxlZCBvbmx5IGZyb20gdmVyaWZ5IGNsYWltCiAgICBmdW5jdGlvbiBjbG9zZVN1Ym1pc3Npb24oIGFkZHJlc3Mgc2VuZGVyICkgaW50ZXJuYWwgewogICAgICAgIFN1Ym1pc3Npb25NZXRhRGF0YSBtZW1vcnkgbWV0YURhdGEgPSBzdWJtaXNzaW9uc01ldGFEYXRhW3NlbmRlcl07CiAgICAgICAgbWV0YURhdGEubnVtUGVuZGluZ1N1Ym1pc3Npb25zID0gMDsKICAgICAgICBtZXRhRGF0YS50b3RhbFN1Ym1pc3Npb25WYWx1ZSA9IDA7CiAgICAgICAgbWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPSAwOwogICAgICAgIG1ldGFEYXRhLnN1Ym1pc3Npb25TZWVkID0gMDsKICAgICAgICAKICAgICAgICAvLyBsYXN0IGNvdW50ZXIgbXVzdCBub3QgYmUgcmVzZXQKICAgICAgICAvLyBsYXN0IHN1Ym1pc3Npb24gYmxvY2sgbnVtYmVyIGFuZCBkaWZmaWN1bHR5IGFyZSBhbHNvIGtlcHQsIGJ1dCBpdCBpcyBub3QgYSBtdXN0CiAgICAgICAgLy8gb25seSB0byBzYXZlIHNvbWUgZ2FzICAgICAgICAKICAgICAgICAKICAgICAgICBzdWJtaXNzaW9uc01ldGFEYXRhW3NlbmRlcl0gPSBtZXRhRGF0YTsKICAgIH0KICAgIAogICAgc3RydWN0IFN1Ym1pc3Npb25EYXRhRm9yQ2xhaW1WZXJpZmljYXRpb24gewogICAgICAgIHVpbnQgbGFzdENvdW50ZXI7CiAgICAgICAgdWludCBzaGFyZURpZmZpY3VsdHk7CiAgICAgICAgdWludCB0b3RhbFN1Ym1pc3Npb25WYWx1ZTsKICAgICAgICB1aW50IG1pbjsKICAgICAgICB1aW50IG1heDsKICAgICAgICB1aW50IGF1Z01lcmtsZTsKICAgICAgICAKICAgICAgICBib29sIGluZGljZXNBcmVWYWxpZDsKICAgICAgICBib29sIHJlYWR5Rm9yVmVyaWZpY2F0aW9uOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDbGFpbURhdGEoIGFkZHJlc3Mgc2VuZGVyLCB1aW50IHN1Ym1pc3Npb25JbmRleCwgdWludCBzaGFyZUluZGV4LCB1aW50IHNlZWQgKQogICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKFN1Ym1pc3Npb25EYXRhRm9yQ2xhaW1WZXJpZmljYXRpb24pewogICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBTdWJtaXNzaW9uRGF0YUZvckNsYWltVmVyaWZpY2F0aW9uIG1lbW9yeSBvdXRwdXQ7CgogICAgICAgIFN1Ym1pc3Npb25NZXRhRGF0YSBtZW1vcnkgbWV0YURhdGEgPSBzdWJtaXNzaW9uc01ldGFEYXRhW3NlbmRlcl07CiAgICAgICAgCiAgICAgICAgb3V0cHV0Lmxhc3RDb3VudGVyID0gdWludChtZXRhRGF0YS5sYXN0Q291bnRlcik7CiAgICAgICAgb3V0cHV0LnNoYXJlRGlmZmljdWx0eSA9IHVpbnQobWV0YURhdGEuZGlmZmljdWx0eSk7CiAgICAgICAgb3V0cHV0LnRvdGFsU3VibWlzc2lvblZhbHVlID0gbWV0YURhdGEudG90YWxTdWJtaXNzaW9uVmFsdWU7CiAgICAgICAgCgogICAgICAgIFNpbmdsZVN1Ym1pc3Npb25EYXRhIG1lbW9yeSBzdWJtaXNzaW9uRGF0YSA9IChzdWJtaXNzaW9uc0RhdGFbc2VuZGVyXSlbc3VibWlzc2lvbkluZGV4XTsKICAgICAgICAKICAgICAgICBvdXRwdXQubWluID0gdWludChzdWJtaXNzaW9uRGF0YS5taW4pOwogICAgICAgIG91dHB1dC5tYXggPSB1aW50KHN1Ym1pc3Npb25EYXRhLm1heCk7CiAgICAgICAgb3V0cHV0LmF1Z01lcmtsZSA9IHVpbnQoc3VibWlzc2lvbkRhdGEuYXVnUm9vdCk7CiAgICAgICAgCiAgICAgICAgb3V0cHV0LmluZGljZXNBcmVWYWxpZCA9IHZlcmlmeVN1Ym1pc3Npb25JbmRleCggc2VuZGVyLCBzZWVkLCBzdWJtaXNzaW9uSW5kZXgsIHNoYXJlSW5kZXggKTsKICAgICAgICBvdXRwdXQucmVhZHlGb3JWZXJpZmljYXRpb24gPSAobWV0YURhdGEucmVhZHlGb3JWZXJpZmljYXRpb24gPiAwKTsKICAgICAgICAKICAgICAgICByZXR1cm4gb3V0cHV0OyAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZGVidWdHZXROdW1QZW5kaW5nU3VibWlzc2lvbnMoIGFkZHJlc3Mgc2VuZGVyICkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoc3VibWlzc2lvbnNNZXRhRGF0YVtzZW5kZXJdLm51bVBlbmRpbmdTdWJtaXNzaW9ucyk7CiAgICB9CiAgICAKICAgIGV2ZW50IERlYnVnUmVzZXRTdWJtaXNzaW9ucyggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8gKTsKICAgIGZ1bmN0aW9uIGRlYnVnUmVzZXRTdWJtaXNzaW9ucyggKSB7CiAgICAgICAgLy8gc2hvdWxkIGJlIGNhbGxlZCBvbmx5IGluIGVtZXJnZW5jeQogICAgICAgIC8vIG1zZy5zZW5kZXIgd2lsbCBsb29zZSBhbGwgaXRzIHBlbmRpbmcgc2hhcmVzCiAgICAgICAgY2xvc2VTdWJtaXNzaW9uKG1zZy5zZW5kZXIpOwogICAgICAgIERlYnVnUmVzZXRTdWJtaXNzaW9ucyggbXNnLnNlbmRlciwgMCwgMCApOwogICAgfSAgICAKfQoKCmNvbnRyYWN0IFNtYXJ0UG9vbCBpcyBBZ3QsIFdlaWdodGVkU3VibWlzc2lvbiB7ICAgIAogICAgc3RyaW5nICBwdWJsaWMgdmVyc2lvbiA9ICIwLjEuMSI7CiAgICAKICAgIEV0aGFzaCAgcHVibGljIGV0aGFzaENvbnRyYWN0OyAKICAgIGFkZHJlc3MgcHVibGljIHdpdGhkcmF3YWxBZGRyZXNzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBwdWJsaWMgb3duZXJzOyAKICAgIAogICAgYm9vbCBwdWJsaWMgbmV3VmVyc2lvblJlbGVhc2VkID0gZmFsc2U7CiAgICAgICAgCiAgICBzdHJ1Y3QgTWluZXJEYXRhIHsKICAgICAgICBieXRlczMyICAgICAgICBtaW5lcklkOwogICAgICAgIGFkZHJlc3MgICAgICAgIHBheW1lbnRBZGRyZXNzOwogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcz0+TWluZXJEYXRhKSBtaW5lcnNEYXRhOwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSAgICAgIHB1YmxpYyBleGlzdGluZ0lkczsgICAgICAgIAogICAgCiAgICBib29sIHB1YmxpYyB3aGl0ZUxpc3RFbmFibGVkOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSB3aGl0ZUxpc3Q7CiAgICAKICAgIGZ1bmN0aW9uIFNtYXJ0UG9vbCggYWRkcmVzc1szXSBfb3duZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBFdGhhc2ggX2V0aGFzaENvbnRyYWN0LAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF93aXRoZHJhd2FsQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBfd2hpdGVMaXN0RW5hYmVsZWQgKSBwYXlhYmxlIHsKICAgICAgICBvd25lcnNbX293bmVyc1swXV0gPSB0cnVlOyAKICAgICAgICBvd25lcnNbX293bmVyc1sxXV0gPSB0cnVlOwogICAgICAgIG93bmVyc1tfb3duZXJzWzJdXSA9IHRydWU7CiAgICAgICAgCiAgICAgICAgd2hpdGVMaXN0RW5hYmxlZCA9IF93aGl0ZUxpc3RFbmFiZWxlZDsKICAgICAgICBldGhhc2hDb250cmFjdCA9IF9ldGhhc2hDb250cmFjdDsKICAgICAgICB3aXRoZHJhd2FsQWRkcmVzcyA9IF93aXRoZHJhd2FsQWRkcmVzczsgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRlY2xhcmVOZXdlclZlcnNpb24oKSB7CiAgICAgICAgaWYoICEgb3duZXJzW21zZy5zZW5kZXJdICkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgbmV3VmVyc2lvblJlbGVhc2VkID0gdHJ1ZTsKICAgICAgICAKICAgICAgICAvL2lmKCAhIG1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpICkgdGhyb3c7CiAgICB9CiAgICAKICAgIGV2ZW50IFdpdGhkcmF3KCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOwogICAgZnVuY3Rpb24gd2l0aGRyYXcoIHVpbnQgYW1vdW50ICkgewogICAgICAgIGlmKCAhIG93bmVyc1ttc2cuc2VuZGVyXSApIHsKICAgICAgICAgICAgLy8gb25seSBvd25kZXIgY2FuIHdpdGhkcmF3CiAgICAgICAgICAgIFdpdGhkcmF3KCBtc2cuc2VuZGVyLCAweDgwMDAwMDAwLCBhbW91bnQgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiggISB3aXRoZHJhd2FsQWRkcmVzcy5zZW5kKCBhbW91bnQgKSApIHRocm93OwogICAgICAgIAogICAgICAgIFdpdGhkcmF3KCBtc2cuc2VuZGVyLCAwLCBhbW91bnQgKTsgICAgICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdG82MkVuY29kaW5nKCB1aW50IGlkLCB1aW50IG51bUNoYXJzICkgY29uc3RhbnQgcmV0dXJucyhieXRlczMyKSB7CiAgICAgICAgaWYoIGlkID49ICgyNisyNisxMCkqKm51bUNoYXJzICkgdGhyb3c7CiAgICAgICAgdWludCByZXN1bHQgPSAwOwogICAgICAgIGZvciggdWludCBpID0gMCA7IGkgPCBudW1DaGFycyA7IGkrKyApIHsKICAgICAgICAgICAgdWludCBiID0gaWQgJSAoMjYrMjYrMTApOwogICAgICAgICAgICB1aW50OCBjaGFyOwogICAgICAgICAgICBpZiggYiA8IDEwICkgewogICAgICAgICAgICAgICAgY2hhciA9IHVpbnQ4KGIgKyAweDMwKTsgLy8gMHgzMCA9ICcwJyAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmKCBiIDwgMjYgKyAxMCApIHsKICAgICAgICAgICAgICAgIGNoYXIgPSB1aW50OChiICsgMHg2MSAtIDEwKTsgLy8weDYxID0gJ2EnCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjaGFyID0gdWludDgoYiArIDB4NDEgLSAyNiAtIDEwKTsgLy8gMHg0MSA9ICdBJyAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0ICogMjU2KSArIGNoYXI7CiAgICAgICAgICAgIGlkIC89ICgyNisyNisxMCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnl0ZXMzMihyZXN1bHQpOwogICAgfQogICAgICAgIAogICAgZXZlbnQgUmVnaXN0ZXIoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7ICAgIAogICAgZnVuY3Rpb24gcmVnaXN0ZXIoIGFkZHJlc3MgcGF5bWVudEFkZHJlc3MgKSB7CiAgICAgICAgYWRkcmVzcyBtaW5lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIAogICAgICAgIC8vIGJ1aWxkIGlkCiAgICAgICAgdWludCBpZCA9IHVpbnQobWluZXJBZGRyZXNzKSAlICgyNisyNisxMCkqKjExOyAgICAgICAgCiAgICAgICAgYnl0ZXMzMiBtaW5lcklkID0gdG82MkVuY29kaW5nKGlkLDExKTsKICAgICAgICAKICAgICAgICBpZiggZXhpc3RpbmdJZHNbbWluZXJzRGF0YVttaW5lckFkZHJlc3NdLm1pbmVySWRdICkgewogICAgICAgICAgICAvLyBtaW5lciBpZCBpcyBhbHJlYWR5IGluIHVzZQogICAgICAgICAgICBSZWdpc3RlciggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgdWludChtaW5lcklkKSApOyAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiggcGF5bWVudEFkZHJlc3MgPT0gYWRkcmVzcygwKSApIHsKICAgICAgICAgICAgLy8gcGF5bWVudCBhZGRyZXNzIGlzIDAKICAgICAgICAgICAgUmVnaXN0ZXIoIG1zZy5zZW5kZXIsIDB4ODAwMDAwMDEsIHVpbnQocGF5bWVudEFkZHJlc3MpICk7IAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmKCB3aGl0ZUxpc3RFbmFibGVkICkgewogICAgICAgICAgICBpZiggISB3aGl0ZUxpc3RbIG1zZy5zZW5kZXIgXSApIHsKICAgICAgICAgICAgICAgIC8vIG1pbmVyIG5vdCBpbiB3aGl0ZSBsaXN0CiAgICAgICAgICAgICAgICBSZWdpc3RlciggbXNnLnNlbmRlciwgMHg4MDAwMDAwMiwgdWludChtaW5lcklkKSApOwogICAgICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gbGFzdCBjb3VudGVyIGlzIHNldCB0byAwLiAKICAgICAgICAvLyBJdCBtaWdodCBiZSBzYWZlciB0byBjaGFuZ2UgaXQgdG8gbm93LgogICAgICAgIC8vbWluZXJzRGF0YVttaW5lckFkZHJlc3NdLmxhc3RDb3VudGVyID0gbm93ICogKDIqKjY0KTsKICAgICAgICBtaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ucGF5bWVudEFkZHJlc3MgPSBwYXltZW50QWRkcmVzczsgICAgICAgIAogICAgICAgIG1pbmVyc0RhdGFbbWluZXJBZGRyZXNzXS5taW5lcklkID0gbWluZXJJZDsKICAgICAgICBleGlzdGluZ0lkc1ttaW5lcnNEYXRhW21pbmVyQWRkcmVzc10ubWluZXJJZF0gPSB0cnVlOwogICAgICAgIAogICAgICAgIC8vIHN1Y2Nlc2Z1bCByZWdpc3RyYXRpb24KICAgICAgICBSZWdpc3RlciggbXNnLnNlbmRlciwgMCwgMCApOyAKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5SZWdpc3RlcihhZGRyZXNzIHNlbmRlcikgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBpZCA9IHVpbnQoc2VuZGVyKSAlICgyNisyNisxMCkqKjExOwogICAgICAgIGJ5dGVzMzIgZXhwZWN0ZWRJZCA9IHRvNjJFbmNvZGluZyhpZCwxMSk7CiAgICAgICAgCiAgICAgICAgaWYoIHdoaXRlTGlzdEVuYWJsZWQgKSB7CiAgICAgICAgICAgIGlmKCAhIHdoaXRlTGlzdFsgc2VuZGVyIF0gKSByZXR1cm4gZmFsc2U7IAogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gISBleGlzdGluZ0lkc1tleHBlY3RlZElkXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNSZWdpc3RlcmVkKGFkZHJlc3Mgc2VuZGVyKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gbWluZXJzRGF0YVtzZW5kZXJdLnBheW1lbnRBZGRyZXNzICE9IGFkZHJlc3MoMCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE1pbmVySWQoYWRkcmVzcyBzZW5kZXIpIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBtaW5lcnNEYXRhW3NlbmRlcl0ubWluZXJJZDsKICAgIH0KCiAgICBldmVudCBVcGRhdGVXaGl0ZUxpc3QoIGFkZHJlc3MgaW5kZXhlZCBtaW5lciwgdWludCBlcnJvciwgdWludCBlcnJvckluZm8sIGJvb2wgYWRkICk7CiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZVdoaXRlTGlzdCggYWRkcmVzcyBtaW5lciwgYm9vbCBhZGQgKSB7CiAgICAgICAgaWYoICEgb3duZXJzWyBtc2cuc2VuZGVyIF0gKSB7CiAgICAgICAgICAgIC8vIG9ubHkgb3duZXIgY2FuIHVwZGF0ZSBsaXN0CiAgICAgICAgICAgIFVwZGF0ZVdoaXRlTGlzdCggbXNnLnNlbmRlciwgMHg4MDAwMDAwMCwgMCwgYWRkICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYoICEgd2hpdGVMaXN0RW5hYmxlZCApIHsKICAgICAgICAgICAgLy8gd2hpdGUgbGlzdCBpcyBub3QgZW5hYmVsZWQKICAgICAgICAgICAgVXBkYXRlV2hpdGVMaXN0KCBtc2cuc2VuZGVyLCAweDgwMDAwMDAxLCAwLCBhZGQgKTsgICAgICAgIAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHdoaXRlTGlzdFsgbWluZXIgXSA9IGFkZDsKICAgICAgICBpZiggISBhZGQgJiYgaXNSZWdpc3RlcmVkKCBtaW5lciApICkgewogICAgICAgICAgICAvLyB1bnJlZ2lzdGVyCiAgICAgICAgICAgIG1pbmVyc0RhdGFbbWluZXJdLnBheW1lbnRBZGRyZXNzID0gYWRkcmVzcygwKTsKICAgICAgICAgICAgZXhpc3RpbmdJZHNbbWluZXJzRGF0YVttaW5lcl0ubWluZXJJZF0gPSBmYWxzZTsgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICBVcGRhdGVXaGl0ZUxpc3QoIG1zZy5zZW5kZXIsIDAsIHVpbnQobWluZXIpLCBhZGQgKTsKICAgIH0KICAgIAogICAgZXZlbnQgVmVyaWZ5RXh0cmFEYXRhKCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOyAgICAKICAgIGZ1bmN0aW9uIHZlcmlmeUV4dHJhRGF0YSggYnl0ZXMzMiBleHRyYURhdGEsIGJ5dGVzMzIgbWluZXJJZCwgdWludCBkaWZmaWN1bHR5ICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBpOwogICAgICAgIC8vIGNvbXBhcmUgaWQKICAgICAgICBmb3IoIGkgPSAwIDsgaSA8IDExIDsgaSsrICkgewogICAgICAgICAgICBpZiggZXh0cmFEYXRhWzEwK2ldICE9IG1pbmVySWRbMjEraV0gKSB7CiAgICAgICAgICAgICAgICAvL0Vycm9yTG9nKCAidmVyaWZ5RXh0cmFEYXRhOiBtaW5lciBpZCBub3QgYXMgZXhwZWN0ZWQiLCAwICk7CiAgICAgICAgICAgICAgICBWZXJpZnlFeHRyYURhdGEoIG1zZy5zZW5kZXIsIDB4ODMwMDAwMDAsIHVpbnQobWluZXJJZCkgKTsgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjb21wYXJlIGRpZmZpY3VsdHkKICAgICAgICBieXRlczMyIGVuY29kZWREaWZmID0gdG82MkVuY29kaW5nKGRpZmZpY3VsdHksMTEpOwogICAgICAgIGZvciggaSA9IDAgOyBpIDwgMTEgOyBpKysgKSB7CiAgICAgICAgICAgIGlmKGV4dHJhRGF0YVtpKzIxXSAhPSBlbmNvZGVkRGlmZlsyMStpXSkgewogICAgICAgICAgICAgICAgLy9FcnJvckxvZyggInZlcmlmeUV4dHJhRGF0YTogZGlmZmljdWx0eSBpcyBub3QgYXMgZXhwZWN0ZWQiLCB1aW50KGVuY29kZWREaWZmKSApOwogICAgICAgICAgICAgICAgVmVyaWZ5RXh0cmFEYXRhKCBtc2cuc2VuZGVyLCAweDgzMDAwMDAxLCB1aW50KGVuY29kZWREaWZmKSApOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAgICAgICAgIAogICAgICAgICAgICB9ICAKICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsgICAgICAgICAgICAKICAgIH0gICAgCiAgICAKICAgIGV2ZW50IFZlcmlmeUNsYWltKCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOwogICAgCiAgICAgICAgCiAgICBmdW5jdGlvbiB2ZXJpZnlDbGFpbSggYnl0ZXMgcmxwSGVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgIG5vbmNlLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgIHN1Ym1pc3Npb25JbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50ICBzaGFyZUluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBkYXRhU2V0TG9va3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSB3aXRuZXNzRm9yTG9va3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBhdWdDb3VudGVyc0JyYW5jaCwKICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gYXVnSGFzaGVzQnJhbmNoICkgewoKICAgICAgICBpZiggISBpc1JlZ2lzdGVyZWQobXNnLnNlbmRlcikgKSB7CiAgICAgICAgICAgIC8vIG1pbmVyIGlzIG5vdCByZWdpc3RlcmVkCiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBjLCAwICk7CiAgICAgICAgICAgIHJldHVybjsgICAgICAgICAKICAgICAgICB9CgogICAgICAgIFN1Ym1pc3Npb25EYXRhRm9yQ2xhaW1WZXJpZmljYXRpb24gbWVtb3J5IHN1Ym1pc3Npb25EYXRhID0gZ2V0Q2xhaW1EYXRhKCBtc2cuc2VuZGVyLAogICAgICAgICAgICBzdWJtaXNzaW9uSW5kZXgsIHNoYXJlSW5kZXgsIGdldENsYWltU2VlZCggbXNnLnNlbmRlciApICk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZiggISBzdWJtaXNzaW9uRGF0YS5yZWFkeUZvclZlcmlmaWNhdGlvbiApIHsKICAgICAgICAgICAgLy9FcnJvckxvZyggInRoZXJlIGFyZSBubyBwZW5kaW5nIGNsYWltcyIsIDAgKTsKICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDMsIDAgKTsgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBCbG9ja0hlYWRlciBtZW1vcnkgaGVhZGVyID0gcGFyc2VCbG9ja0hlYWRlcihybHBIZWFkZXIpOwoKICAgICAgICAvLyBjaGVjayBleHRyYSBkYXRhCiAgICAgICAgaWYoICEgdmVyaWZ5RXh0cmFEYXRhKCBoZWFkZXIuZXh0cmFEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluZXJzRGF0YVsgbXNnLnNlbmRlciBdLm1pbmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uRGF0YS5zaGFyZURpZmZpY3VsdHkgKSApIHsKICAgICAgICAgICAgLy9FcnJvckxvZyggImV4dHJhIGRhdGEgbm90IGFzIGV4cGVjdGVkIiwgdWludChoZWFkZXIuZXh0cmFEYXRhKSApOwogICAgICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMHg4NDAwMDAwNCwgdWludChoZWFkZXIuZXh0cmFEYXRhKSApOyAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm47ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjaGVjayBjb2luYmFzZSBkYXRhCiAgICAgICAgaWYoIGhlYWRlci5jb2luYmFzZSAhPSB1aW50KHRoaXMpICkgewogICAgICAgICAgICAvL0Vycm9yTG9nKCAiY29pbmJhc2Ugbm90IGFzIGV4cGVjdGVkIiwgdWludChoZWFkZXIuY29pbmJhc2UpICk7CiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA1LCB1aW50KGhlYWRlci5jb2luYmFzZSkgKTsgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgY291bnRlcgogICAgICAgIHVpbnQgY291bnRlciA9IGhlYWRlci50aW1lc3RhbXAgKiAoMiAqKiA2NCkgKyBub25jZTsKICAgICAgICBpZiggY291bnRlciA8IHN1Ym1pc3Npb25EYXRhLm1pbiApIHsKICAgICAgICAgICAgLy9FcnJvckxvZyggImNvdW50ZXIgaXMgc21hbGxlciB0aGFuIG1pbiIsY291bnRlcik7CiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA3LCBjb3VudGVyICk7ICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybjsgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIGlmKCBjb3VudGVyID4gc3VibWlzc2lvbkRhdGEubWF4ICkgewogICAgICAgICAgICAvL0Vycm9yTG9nKCAiY291bnRlciBpcyBzbWFsbGVyIHRoYW4gbWF4Iixjb3VudGVyKTsKICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDgsIGNvdW50ZXIgKTsgICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gdmVyaWZ5IGFndAogICAgICAgIHVpbnQgbGVhZkhhc2ggPSB1aW50KHNoYTMocmxwSGVhZGVyKSk7CiAgICAgICAgVmVyaWZ5QWd0RGF0YSBtZW1vcnkgYWd0RGF0YTsKICAgICAgICBhZ3REYXRhLnJvb3RIYXNoID0gc3VibWlzc2lvbkRhdGEuYXVnTWVya2xlOwogICAgICAgIGFndERhdGEucm9vdE1pbiA9IHN1Ym1pc3Npb25EYXRhLm1pbjsKICAgICAgICBhZ3REYXRhLnJvb3RNYXggPSBzdWJtaXNzaW9uRGF0YS5tYXg7CiAgICAgICAgYWd0RGF0YS5sZWFmSGFzaCA9IGxlYWZIYXNoOwogICAgICAgIGFndERhdGEubGVhZkNvdW50ZXIgPSBjb3VudGVyOwogICAgICAgICAgICAgICAgCgogICAgICAgIGlmKCAhIHZlcmlmeUFndCggYWd0RGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICBhdWdDb3VudGVyc0JyYW5jaCwKICAgICAgICAgICAgICAgICAgICAgICAgIGF1Z0hhc2hlc0JyYW5jaCApICkgewogICAgICAgICAgICAvL0Vycm9yTG9nKCAidmVyaWZ5QWd0IGZhaWxlZCIsMCk7CiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDA5LCAwICk7ICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgLyoKICAgICAgICAvLyBjaGVjayBlcG9jaCBkYXRhIC0gZG9uZSBpbnNpZGUgaGFzaGltb3RvCiAgICAgICAgaWYoICEgZXRoYXNoQ29udHJhY3QuaXNFcG9jaERhdGFTZXQoIGhlYWRlci5ibG9ja051bWJlciAvIDMwMDAwICkgKSB7CiAgICAgICAgICAgIC8vRXJyb3JMb2coICJlcG9jaCBkYXRhIHdhcyBub3Qgc2V0IixoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCk7CiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBhLCBoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCApOyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm47ICAgICAgICAKICAgICAgICB9Ki8KCgogICAgICAgIC8vIHZlcmlmeSBldGhhc2gKICAgICAgICB1aW50IGV0aGFzaCA9IGV0aGFzaENvbnRyYWN0Lmhhc2hpbW90byggYnl0ZXMzMihsZWFmSGFzaCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzOChub25jZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTZXRMb29rdXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdG5lc3NGb3JMb29rdXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlci5ibG9ja051bWJlciAvIDMwMDAwICk7CiAgICAgICAgaWYoIGV0aGFzaCA+ICgoMioqMjU2LTEpL3N1Ym1pc3Npb25EYXRhLnNoYXJlRGlmZmljdWx0eSApKSB7CiAgICAgICAgICAgIGlmKCBldGhhc2ggPT0gMHhGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZFICkgewogICAgICAgICAgICAgICAgLy9FcnJvckxvZyggImVwb2NoIGRhdGEgd2FzIG5vdCBzZXQiLGhlYWRlci5ibG9ja051bWJlciAvIDMwMDAwKTsKICAgICAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDBhLCBoZWFkZXIuYmxvY2tOdW1iZXIgLyAzMDAwMCApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vRXJyb3JMb2coICJldGhhc2ggZGlmZmljdWx0eSB0b28gbG93IixldGhhc2gpOwogICAgICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMGIsIGV0aGFzaCApOwogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybjsgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiggZ2V0Q2xhaW1TZWVkKG1zZy5zZW5kZXIpID09IDAgKSB7CiAgICAgICAgICAgIC8vRXJyb3JMb2coICJjbGFpbSBzZWVkIGlzIDAiLCAwICk7CiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDAxLCAwICk7CiAgICAgICAgICAgIHJldHVybjsgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiggISBzdWJtaXNzaW9uRGF0YS5pbmRpY2VzQXJlVmFsaWQgKSB7CiAgICAgICAgICAgIC8vRXJyb3JMb2coICJzaGFyZSBpbmRleCBvciBzdWJtaXNzaW9uIGFyZSBub3QgYXMgZXhwZWN0ZWQuIHNob3VsZCBiZToiLCBnZXRTaGFyZUluZGV4KCkgKTsKICAgICAgICAgICAgVmVyaWZ5Q2xhaW0oIG1zZy5zZW5kZXIsIDB4ODQwMDAwMDIsIDAgKTsKICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgICAgICAKICAgICAgICB9IAogICAgICAgIAogICAgICAgIC8vIHJlY3J1c2l2ZSBhdHRhY2sgaXMgbm90IHBvc3NpYmxlIGFzIGRvUGF5bWVudCBpcyB1c2luZyBzZW5kIGFuZCBub3QgY2FsbC4KICAgICAgICBpZiggISBkb1BheW1lbnQoc3VibWlzc2lvbkRhdGEudG90YWxTdWJtaXNzaW9uVmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmVyc0RhdGFbIG1zZy5zZW5kZXIgXS5wYXltZW50QWRkcmVzcykgKSB7CiAgICAgICAgICAgIC8vIGVycm9yIG1zZyBpcyBnaXZlbiBpbiBkb1BheW1lbnQgZnVuY3Rpb24KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjbG9zZVN1Ym1pc3Npb24oIG1zZy5zZW5kZXIgKTsKICAgICAgICAvL21pbmVyc0RhdGFbIG1zZy5zZW5kZXIgXS5wZW5kaW5nQ2xhaW0gPSBmYWxzZTsKICAgICAgICAKICAgICAgICAKICAgICAgICBWZXJpZnlDbGFpbSggbXNnLnNlbmRlciwgMCwgMCApOyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIAogICAgICAgIAogICAgICAgIHJldHVybjsKICAgIH0gICAgCiAgICAKCiAgICAvLyAxMDAwMCA9IDEwMCUKICAgIHVpbnQgcHVibGljIHVuY2xlUmF0ZSA9IDUwMDsgLy8gNSUKICAgIC8vIDEwMDAwID0gMTAwJQogICAgdWludCBwdWJsaWMgcG9vbEZlZXMgPSAwOwoKCiAgICBldmVudCBJbmNvbWluZ0Z1bmRzKCBhZGRyZXNzIHNlbmRlciwgdWludCBhbW91bnRJbldlaSApOwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICBJbmNvbWluZ0Z1bmRzKCBtc2cuc2VuZGVyLCBtc2cudmFsdWUgKTsKICAgIH0KCiAgICBldmVudCBTZXRVbmxjZVJhdGVBbmRGZWVzKCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOwogICAgZnVuY3Rpb24gc2V0VW5sY2VSYXRlQW5kRmVlcyggdWludCBfdW5jbGVSYXRlLCB1aW50IF9wb29sRmVlcyApIHsKICAgICAgICBpZiggISBvd25lcnNbbXNnLnNlbmRlcl0gKSB7CiAgICAgICAgICAgIC8vIG9ubHkgb3duZXIgc2hvdWxkIGNoYW5nZSByYXRlcwogICAgICAgICAgICBTZXRVbmxjZVJhdGVBbmRGZWVzKCBtc2cuc2VuZGVyLCAweDgwMDAwMDAwLCAwICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdW5jbGVSYXRlID0gX3VuY2xlUmF0ZTsKICAgICAgICBwb29sRmVlcyA9IF9wb29sRmVlczsKICAgICAgICAKICAgICAgICBTZXRVbmxjZVJhdGVBbmRGZWVzKCBtc2cuc2VuZGVyLCAwLCAwICk7CiAgICB9CiAgICAgICAgCiAgICBldmVudCBEb1BheW1lbnQoIGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgcGF5bWVudEFkZHJlc3MsIHVpbnQgdmFsdWVJbldlaSApOwogICAgZnVuY3Rpb24gZG9QYXltZW50KCB1aW50IHN1Ym1pc3Npb25WYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBwYXltZW50QWRkcmVzcyApIGludGVybmFsIHJldHVybnMoYm9vbCkgewoKICAgICAgICB1aW50IHBheW1lbnQgPSBzdWJtaXNzaW9uVmFsdWU7CiAgICAgICAgLy8gdGFrZSB1bmNsZSByYXRlIGludG8gYWNjb3VudAogICAgICAgIAogICAgICAgIC8vIHBheW1lbnQgPSBwYXltZW50ICogKDEtMC4yNSp1bmNsZVJhdGUpCiAgICAgICAgLy8gdW5jbGVSYXRlIGluIFswLDEwMDAwXQogICAgICAgIHBheW1lbnQgPSAocGF5bWVudCAqICg0KjEwMDAwIC0gdW5jbGVSYXRlKSkgLyAoNCoxMDAwMCk7CiAgICAgICAgCiAgICAgICAgLy8gZmVlcwogICAgICAgIHBheW1lbnQgPSAocGF5bWVudCAqICgxMDAwMCAtIHBvb2xGZWVzKSkgLyAxMDAwMDsKCiAgICAgICAgaWYoIHBheW1lbnQgPiB0aGlzLmJhbGFuY2UgKXsKICAgICAgICAgICAgLy9FcnJvckxvZyggImNhbm5vdCBhZmZvcmQgdG8gcGF5IiwgY2FsY1BheW1lbnQoIHN1Ym1pc3Npb25EYXRhLm51bVNoYXJlcywgc3VibWlzc2lvbkRhdGEuZGlmZmljdWx0eSApICk7CiAgICAgICAgICAgIFZlcmlmeUNsYWltKCBtc2cuc2VuZGVyLCAweDg0MDAwMDAwLCBwYXltZW50ICk7ICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIGlmKCAhIHBheW1lbnRBZGRyZXNzLnNlbmQoIHBheW1lbnQgKSApIHRocm93OwogICAgICAgIAogICAgICAgIERvUGF5bWVudCggbXNnLnNlbmRlciwgcGF5bWVudEFkZHJlc3MsIHBheW1lbnQgKTsgCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFBvb2xFVEhCYWxhbmNlKCApIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIC8vIGRlYnVnIGZ1bmN0aW9uIGZvciB0ZXN0cnBjCiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KCiAgICBldmVudCBHZXRTaGFyZUluZGV4RGVidWdGb3JUZXN0UlBDU3VibWlzc2lvbkluZGV4KCB1aW50IGluZGV4ICk7ICAgIAogICAgZXZlbnQgR2V0U2hhcmVJbmRleERlYnVnRm9yVGVzdFJQQ1NoYXJlSW5kZXgoIHVpbnQgaW5kZXggKTsKICAgICAKICAgIGZ1bmN0aW9uIGdldFNoYXJlSW5kZXhEZWJ1Z0ZvclRlc3RSUEMoIGFkZHJlc3Mgc2VuZGVyICkgewogICAgICAgIHVpbnQgc2VlZCA9IGdldENsYWltU2VlZCggc2VuZGVyICk7CiAgICAgICAgdWludFsyXSBtZW1vcnkgcmVzdWx0ID0gY2FsY3VsYXRlU3VibWlzc2lvbkluZGV4KCBzZW5kZXIsIHNlZWQgKTsKICAgICAgICAKICAgICAgICBHZXRTaGFyZUluZGV4RGVidWdGb3JUZXN0UlBDU3VibWlzc2lvbkluZGV4KCByZXN1bHRbMF0gKTsKICAgICAgICBHZXRTaGFyZUluZGV4RGVidWdGb3JUZXN0UlBDU2hhcmVJbmRleCggcmVzdWx0WzFdICk7ICAgICAgICAKICAgICAgICAgICAgCiAgICB9ICAgICAgICAKfQ=='.
	

]
