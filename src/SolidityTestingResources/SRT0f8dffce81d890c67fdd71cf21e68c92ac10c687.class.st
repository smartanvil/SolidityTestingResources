Class {
	#name : #SRT0f8dffce81d890c67fdd71cf21e68c92ac10c687,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0f8dffce81d890c67fdd71cf21e68c92ac10c687 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKLyoKVGhpcyB2U2xpY2UgdG9rZW4gY29udHJhY3QgaXMgYmFzZWQgb24gdGhlIEVSQzIwIHRva2VuIGNvbnRyYWN0LiBBZGRpdGlvbmFsCmZ1bmN0aW9uYWxpdHkgaGFzIGJlZW4gaW50ZWdyYXRlZDoKKiB0aGUgY29udHJhY3QgTG9ja2FibGUsIHdoaWNoIGlzIHVzZWQgYXMgYSBwYXJlbnQgb2YgdGhlIFRva2VuIGNvbnRyYWN0CiogdGhlIGZ1bmN0aW9uIG1pbnRUb2tlbnMoKSwgd2hpY2ggbWFrZXMgdXNlIG9mIHRoZSBjdXJyZW50U3dhcFJhdGUoKSBhbmQgc2FmZVRvQWRkKCkgaGVscGVycwoqIHRoZSBmdW5jdGlvbiBkaXNhYmxlVG9rZW5Td2FwTG9jaygpCiovCgpjb250cmFjdCBMb2NrYWJsZSB7CiAgICB1aW50IHB1YmxpYyBudW1PZkN1cnJlbnRFcG9jaDsKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uVGltZTsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFVOTE9DS0VEX1RJTUUgPSAyNSBkYXlzOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTE9DS0VEX1RJTUUgPSA1IGRheXM7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBFUE9DSF9MRU5HVEggPSAzMCBkYXlzOwogICAgYm9vbCBwdWJsaWMgbG9jazsKICAgIGJvb2wgcHVibGljIHRva2VuU3dhcExvY2s7CgogICAgZXZlbnQgTG9ja2VkKCk7CiAgICBldmVudCBVbmxvY2tlZCgpOwoKICAgIC8vIFRoaXMgbW9kaWZpZXIgc2hvdWxkIHByZXZlbnQgdG9rZW5zIHRyYW5zZmVycyB3aGlsZSB0aGUgdG9rZW5zd2FwCiAgICAvLyBpcyBzdGlsbCBvbmdvaW5nCiAgICBtb2RpZmllciBpc1Rva2VuU3dhcE9uIHsKICAgICAgICBpZiAodG9rZW5Td2FwTG9jaykgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBUaGlzIG1vZGlmaWVyIGNoZWNrcyBhbmQsIGlmIG5lZWRlZCwgdXBkYXRlcyB0aGUgdmFsdWUgb2YgY3VycmVudAogICAgLy8gdG9rZW4gY29udHJhY3QgZXBvY2gsIGJlZm9yZSBleGVjdXRpbmcgYSB0b2tlbiB0cmFuc2ZlciBvZiBhbnkKICAgIC8vIGtpbmQKICAgIG1vZGlmaWVyIGlzTmV3RXBvY2ggewogICAgICAgIGlmIChudW1PZkN1cnJlbnRFcG9jaCAqIEVQT0NIX0xFTkdUSCArIGNyZWF0aW9uVGltZSA8IG5vdyApIHsKICAgICAgICAgICAgbnVtT2ZDdXJyZW50RXBvY2ggPSAobm93IC0gY3JlYXRpb25UaW1lKSAvIEVQT0NIX0xFTkdUSCArIDE7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLy8gVGhpcyBtb2RpZmllciBjaGVjayB3aGV0aGVyIHRoZSBjb250cmFjdCBzaG91bGQgYmUgaW4gYSBsb2NrZWQKICAgIC8vIG9yIHVubG9ja2VkIHN0YXRlLCB0aGVuIGFjdHMgYW5kIHVwZGF0ZXMgYWNjb3JkaW5nbHkgaWYKICAgIC8vIG5lY2Vzc2FyeQogICAgbW9kaWZpZXIgY2hlY2tMb2NrIHsKICAgICAgICBpZiAoKGNyZWF0aW9uVGltZSArIG51bU9mQ3VycmVudEVwb2NoICogVU5MT0NLRURfVElNRSkgKwogICAgICAgIChudW1PZkN1cnJlbnRFcG9jaCAtIDEpICogTE9DS0VEX1RJTUUgPCBub3cpIHsKICAgICAgICAgICAgLy8gYXZvaWRzIG5lZWRsZXNzIGxvY2sgc3RhdGUgY2hhbmdlIGFuZCBldmVudCBzcGFtbWluZwogICAgICAgICAgICBpZiAobG9jaykgdGhyb3c7CgogICAgICAgICAgICBsb2NrID0gdHJ1ZTsKICAgICAgICAgICAgTG9ja2VkKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIG9ubHkgc2V0IHRvIGZhbHNlIGlmIGluIGEgbG9ja2VkIHN0YXRlLCB0byBhdm9pZAogICAgICAgICAgICAvLyBuZWVkbGVzcyBzdGF0ZSBjaGFuZ2UgYW5kIGV2ZW50IHNwYW0KICAgICAgICAgICAgaWYgKGxvY2spIHsKICAgICAgICAgICAgICAgIGxvY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIFVubG9ja2VkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBMb2NrYWJsZSgpIHsKICAgICAgICBjcmVhdGlvblRpbWUgPSBub3c7CiAgICAgICAgbnVtT2ZDdXJyZW50RXBvY2ggPSAxOwogICAgICAgIHRva2VuU3dhcExvY2sgPSB0cnVlOwogICAgfQp9CgoKY29udHJhY3QgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCmNvbnRyYWN0IFRva2VuIGlzIEVSQzIwLCBMb2NrYWJsZSB7CgogIG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApIF9iYWxhbmNlczsKICBtYXBwaW5nKCBhZGRyZXNzID0+IG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApICkgX2FwcHJvdmFsczsKICB1aW50IF9zdXBwbHk7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0QWRkcmVzczsKCiAgZXZlbnQgVG9rZW5NaW50KGFkZHJlc3MgbmV3VG9rZW5Ib2xkZXIsIHVpbnQgYW1vdW50T2ZUb2tlbnMpOwogIGV2ZW50IFRva2VuU3dhcE92ZXIoKTsKCiAgbW9kaWZpZXIgb25seUZyb21XYWxsZXQgewogICAgICBpZiAobXNnLnNlbmRlciAhPSB3YWxsZXRBZGRyZXNzKSB0aHJvdzsKICAgICAgXzsKICB9CgogIGZ1bmN0aW9uIFRva2VuKCB1aW50IGluaXRpYWxfYmFsYW5jZSwgYWRkcmVzcyB3YWxsZXQpIHsKICAgIF9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRpYWxfYmFsYW5jZTsKICAgIF9zdXBwbHkgPSBpbml0aWFsX2JhbGFuY2U7CiAgICB3YWxsZXRBZGRyZXNzID0gd2FsbGV0OwogIH0KCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHN1cHBseSkgewogICAgcmV0dXJuIF9zdXBwbHk7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoIGFkZHJlc3Mgd2hvICkgY29uc3RhbnQgcmV0dXJucyAodWludCB2YWx1ZSkgewogICAgcmV0dXJuIF9iYWxhbmNlc1t3aG9dOwogIH0KCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCBfYWxsb3dhbmNlKSB7CiAgICByZXR1cm4gX2FwcHJvdmFsc1tvd25lcl1bc3BlbmRlcl07CiAgfQoKICAvLyBBIGhlbHBlciB0byBub3RpZnkgaWYgb3ZlcmZsb3cgb2NjdXJzCiAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gKGEgKyBiID49IGEgJiYgYSArIGIgPj0gYik7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgIGlzVG9rZW5Td2FwT24KICAgIGlzTmV3RXBvY2gKICAgIGNoZWNrTG9jawogICAgcmV0dXJucyAoYm9vbCBvaykgewoKICAgIGlmKCBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCB2YWx1ZSApIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIGlmKCAhc2FmZVRvQWRkKF9iYWxhbmNlc1t0b10sIHZhbHVlKSApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gdmFsdWU7CiAgICBfYmFsYW5jZXNbdG9dICs9IHZhbHVlOwogICAgVHJhbnNmZXIoIG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSApOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgIGlzVG9rZW5Td2FwT24KICAgIGlzTmV3RXBvY2gKICAgIGNoZWNrTG9jawogICAgcmV0dXJucyAoYm9vbCBvaykgewogICAgLy8gaWYgeW91IGRvbid0IGhhdmUgZW5vdWdoIGJhbGFuY2UsIHRocm93CiAgICBpZiggX2JhbGFuY2VzW2Zyb21dIDwgdmFsdWUgKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICAvLyBpZiB5b3UgZG9uJ3QgaGF2ZSBhcHByb3ZhbCwgdGhyb3cKICAgIGlmKCBfYXBwcm92YWxzW2Zyb21dW21zZy5zZW5kZXJdIDwgdmFsdWUgKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBpZiggIXNhZmVUb0FkZChfYmFsYW5jZXNbdG9dLCB2YWx1ZSkgKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICAvLyB0cmFuc2ZlciBhbmQgcmV0dXJuIHRydWUKICAgIF9hcHByb3ZhbHNbZnJvbV1bbXNnLnNlbmRlcl0gLT0gdmFsdWU7CiAgICBfYmFsYW5jZXNbZnJvbV0gLT0gdmFsdWU7CiAgICBfYmFsYW5jZXNbdG9dICs9IHZhbHVlOwogICAgVHJhbnNmZXIoIGZyb20sIHRvLCB2YWx1ZSApOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkKICAgIGlzVG9rZW5Td2FwT24KICAgIGlzTmV3RXBvY2gKICAgIGNoZWNrTG9jawogICAgcmV0dXJucyAoYm9vbCBvaykgewogICAgX2FwcHJvdmFsc1ttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IHZhbHVlOwogICAgQXBwcm92YWwoIG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlICk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vIFRoZSBmdW5jdGlvbiBjdXJyZW50U3dhcFJhdGUoKSByZXR1cm5zIHRoZSBjdXJyZW50IGV4Y2hhbmdlIHJhdGUKICAvLyBiZXR3ZWVuIHZTbGljZSB0b2tlbnMgYW5kIEV0aGVyIGR1cmluZyB0aGUgdG9rZW4gc3dhcCBwZXJpb2QKICBmdW5jdGlvbiBjdXJyZW50U3dhcFJhdGUoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgaWYgKGNyZWF0aW9uVGltZSArIDEgd2Vla3MgPiBub3cpIHsKICAgICAgICAgIHJldHVybiAxMzA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY3JlYXRpb25UaW1lICsgMiB3ZWVrcyA+IG5vdykgewogICAgICAgICAgcmV0dXJuIDEyMDsKICAgICAgfQogICAgICBlbHNlIGlmIChjcmVhdGlvblRpbWUgKyA0IHdlZWtzID4gbm93KSB7CiAgICAgICAgICByZXR1cm4gMTAwOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICB9CgogIC8vIFRoZSBmdW5jdGlvbiBtaW50VG9rZW5zIGlzIG9ubHkgdXNhYmxlIGJ5IHRoZSBjaG9zZW4gd2FsbGV0CiAgLy8gY29udHJhY3QgdG8gbWludCBhIG51bWJlciBvZiB0b2tlbnMgcHJvcG9ydGlvbmFsIHRvIHRoZQogIC8vIGFtb3VudCBvZiBldGhlciBzZW50IHRvIHRoZSB3YWxsZXQgY29udHJhY3QuIFRoZSBmdW5jdGlvbgogIC8vIGNhbiBvbmx5IGJlIGNhbGxlZCBkdXJpbmcgdGhlIHRva2Vuc3dhcCBwZXJpb2QKICBmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3MgbmV3VG9rZW5Ib2xkZXIsIHVpbnQgZXRoZXJBbW91bnQpCiAgICBleHRlcm5hbAogICAgb25seUZyb21XYWxsZXQgewoKICAgICAgICB1aW50IHRva2Vuc0Ftb3VudCA9IGN1cnJlbnRTd2FwUmF0ZSgpICogZXRoZXJBbW91bnQ7CiAgICAgICAgaWYoIXNhZmVUb0FkZChfYmFsYW5jZXNbbmV3VG9rZW5Ib2xkZXJdLHRva2Vuc0Ftb3VudCApKSB0aHJvdzsKICAgICAgICBpZighc2FmZVRvQWRkKF9zdXBwbHksdG9rZW5zQW1vdW50KSkgdGhyb3c7CgogICAgICAgIF9iYWxhbmNlc1tuZXdUb2tlbkhvbGRlcl0gKz0gdG9rZW5zQW1vdW50OwogICAgICAgIF9zdXBwbHkgKz0gdG9rZW5zQW1vdW50OwoKICAgICAgICBUb2tlbk1pbnQobmV3VG9rZW5Ib2xkZXIsIHRva2Vuc0Ftb3VudCk7CiAgfQoKICAvLyBUaGUgZnVuY3Rpb24gZGlzYWJsZVRva2VuU3dhcExvY2soKSBpcyBjYWxsZWQgYnkgdGhlIHdhbGxldAogIC8vIGNvbnRyYWN0IG9uY2UgdGhlIHRva2VuIHN3YXAgaGFzIHJlYWNoZWQgaXRzIGVuZCBjb25kaXRpb25zCiAgZnVuY3Rpb24gZGlzYWJsZVRva2VuU3dhcExvY2soKQogICAgZXh0ZXJuYWwKICAgIG9ubHlGcm9tV2FsbGV0IHsKICAgICAgICB0b2tlblN3YXBMb2NrID0gZmFsc2U7CiAgICAgICAgVG9rZW5Td2FwT3ZlcigpOwogIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8qClRoZSBzdGFuZGFyZCBXYWxsZXQgY29udHJhY3QsIHJldHJpZXZhYmxlIGF0Cmh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9kYXBwLWJpbi9ibG9iL21hc3Rlci93YWxsZXQvd2FsbGV0LnNvbCBoYXMgYmVlbgptb2RpZmllZCB0byBpbmNsdWRlIGFkZGl0aW9uYWwgZnVuY3Rpb25hbGl0eSwgaW4gcGFydGljdWxhcjoKKiBBbiBhZGRpdGlvbmFsIHBhcmVudCBvZiB3YWxsZXQgY29udHJhY3QgY2FsbGVkIHRva2Vuc3dhcCwgaW1wbGVtZW50aW5nIGFsbW9zdAphbGwgdGhlIGNoYW5nZXM6CiAgICAtIEZ1bmN0aW9ucyBmb3Igc3RhcnRpbmcgYW5kIHN0b3BwaW5nIHRoZSB0b2tlbnN3YXAKICAgIC0gQSBzZXQtb25seS1vbmNlIGZ1bmN0aW9uIGZvciB0aGUgdG9rZW4gY29udHJhY3QKICAgIC0gYnV5VG9rZW5zKCksIHdoaWNoIGNhbGxzIG1pbnRUb2tlbnMoKSBpbiB0aGUgdG9rZW4gY29udHJhY3QKICAgIC0gTW9kaWZpZXJzIGZvciBlbmZvcmNpbmcgdG9rZW5zd2FwIHRpbWUgbGltaXRzIGFuZCBtYXggZXRoZXIgY2FwCiogdGhlIHdhbGxldCBmYWxsYmFjayBmdW5jdGlvbiBjYWxscyB0aGUgYnV5VG9rZW5zIGZ1bmN0aW9uCiogdGhlIHdhbGxldCBjb250cmFjdCBjYW5ub3Qgc2VsZmRlc3RydWN0IGR1cmluZyB0aGUgdG9rZW5zd2FwCiovCgpjb250cmFjdCBtdWx0aW93bmVkIHsKCgkvLyBUWVBFUwoKICAgIC8vIHN0cnVjdCBmb3IgdGhlIHN0YXR1cyBvZiBhIHBlbmRpbmcgb3BlcmF0aW9uLgogICAgc3RydWN0IFBlbmRpbmdTdGF0ZSB7CiAgICAgICAgdWludCB5ZXROZWVkZWQ7CiAgICAgICAgdWludCBvd25lcnNEb25lOwogICAgICAgIHVpbnQgaW5kZXg7CiAgICB9CgoJLy8gRVZFTlRTCgogICAgLy8gdGhpcyBjb250cmFjdCBvbmx5IGhhcyBzaXggdHlwZXMgb2YgZXZlbnRzOiBpdCBjYW4gYWNjZXB0IGEgY29uZmlybWF0aW9uLCBpbiB3aGljaCBjYXNlCiAgICAvLyB3ZSByZWNvcmQgb3duZXIgYW5kIG9wZXJhdGlvbiAoaGFzaCkgYWxvbmdzaWRlIGl0LgogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IFJldm9rZShhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwogICAgLy8gdGhlIGxhc3Qgb25lIGlzIGVtaXR0ZWQgaWYgdGhlIHJlcXVpcmVkIHNpZ25hdHVyZXMgY2hhbmdlCiAgICBldmVudCBSZXF1aXJlbWVudENoYW5nZWQodWludCBuZXdSZXF1aXJlbWVudCk7CgoJLy8gTU9ESUZJRVJTCgogICAgLy8gc2ltcGxlIHNpbmdsZS1zaWcgZnVuY3Rpb24gbW9kaWZpZXIuCiAgICBtb2RpZmllciBvbmx5b3duZXIgewogICAgICAgIGlmIChpc093bmVyKG1zZy5zZW5kZXIpKQogICAgICAgICAgICBfOwogICAgfQogICAgLy8gbXVsdGktc2lnIGZ1bmN0aW9uIG1vZGlmaWVyOiB0aGUgb3BlcmF0aW9uIG11c3QgaGF2ZSBhbiBpbnRyaW5zaWMgaGFzaCBpbiBvcmRlcgogICAgLy8gdGhhdCBsYXRlciBhdHRlbXB0cyBjYW4gYmUgcmVhbGlzZWQgYXMgdGhlIHNhbWUgdW5kZXJseWluZyBvcGVyYXRpb24gYW5kCiAgICAvLyB0aHVzIGNvdW50IGFzIGNvbmZpcm1hdGlvbnMuCiAgICBtb2RpZmllciBvbmx5bWFueW93bmVycyhieXRlczMyIF9vcGVyYXRpb24pIHsKICAgICAgICBpZiAoY29uZmlybUFuZENoZWNrKF9vcGVyYXRpb24pKQogICAgICAgICAgICBfOwogICAgfQoKCS8vIE1FVEhPRFMKCiAgICAvLyBjb25zdHJ1Y3RvciBpcyBnaXZlbiBudW1iZXIgb2Ygc2lncyByZXF1aXJlZCB0byBkbyBwcm90ZWN0ZWQgIm9ubHltYW55b3duZXJzIiB0cmFuc2FjdGlvbnMKICAgIC8vIGFzIHdlbGwgYXMgdGhlIHNlbGVjdGlvbiBvZiBhZGRyZXNzZXMgY2FwYWJsZSBvZiBjb25maXJtaW5nIHRoZW0uCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkgewogICAgICAgIG1fbnVtT3duZXJzID0gX293bmVycy5sZW5ndGggKyAxOwogICAgICAgIG1fb3duZXJzWzFdID0gdWludChtc2cuc2VuZGVyKTsKICAgICAgICBtX293bmVySW5kZXhbdWludChtc2cuc2VuZGVyKV0gPSAxOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9vd25lcnMubGVuZ3RoOyArK2kpCiAgICAgICAgewogICAgICAgICAgICBtX293bmVyc1syICsgaV0gPSB1aW50KF9vd25lcnNbaV0pOwogICAgICAgICAgICBtX293bmVySW5kZXhbdWludChfb3duZXJzW2ldKV0gPSAyICsgaTsKICAgICAgICB9CiAgICAgICAgbV9yZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgIH0KCiAgICAvLyBSZXZva2VzIGEgcHJpb3IgY29uZmlybWF0aW9uIG9mIHRoZSBnaXZlbiBvcGVyYXRpb24KICAgIGZ1bmN0aW9uIHJldm9rZShieXRlczMyIF9vcGVyYXRpb24pIGV4dGVybmFsIHsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChtc2cuc2VuZGVyKV07CiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZXkncmUgYW4gb3duZXIKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA+IDApIHsKICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQrKzsKICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lIC09IG93bmVySW5kZXhCaXQ7CiAgICAgICAgICAgIFJldm9rZShtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmVwbGFjZXMgYW4gb3duZXIgYF9mcm9tYCB3aXRoIGFub3RoZXIgYF90b2AuCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICBpZiAoaXNPd25lcihfdG8pKSByZXR1cm47CiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX2Zyb20pXTsKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gdWludChfdG8pOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9mcm9tKV0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF90byldID0gb3duZXJJbmRleDsKICAgICAgICBPd25lckNoYW5nZWQoX2Zyb20sIF90byk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBfb3duZXIpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKGlzT3duZXIoX293bmVyKSkgcmV0dXJuOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBpZiAobV9udW1Pd25lcnMgPj0gY19tYXhPd25lcnMpCiAgICAgICAgICAgIHJlb3JnYW5pemVPd25lcnMoKTsKICAgICAgICBpZiAobV9udW1Pd25lcnMgPj0gY19tYXhPd25lcnMpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBtX251bU93bmVycysrOwogICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IHVpbnQoX293bmVyKTsKICAgICAgICBtX293bmVySW5kZXhbdWludChfb3duZXIpXSA9IG1fbnVtT3duZXJzOwogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcihhZGRyZXNzIF9vd25lcikgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChfb3duZXIpXTsKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47CiAgICAgICAgaWYgKG1fcmVxdWlyZWQgPiBtX251bU93bmVycyAtIDEpIHJldHVybjsKCiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcildID0gMDsKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICByZW9yZ2FuaXplT3duZXJzKCk7IC8vbWFrZSBzdXJlIG1fbnVtT3duZXIgaXMgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBvd25lcnMgYW5kIGFsd2F5cyBwb2ludHMgdG8gdGhlIG9wdGltYWwgZnJlZSBzbG90CiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKF9uZXdSZXF1aXJlZCA+IG1fbnVtT3duZXJzKSByZXR1cm47CiAgICAgICAgbV9yZXF1aXJlZCA9IF9uZXdSZXF1aXJlZDsKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBSZXF1aXJlbWVudENoYW5nZWQoX25ld1JlcXVpcmVkKTsKICAgIH0KCiAgICAvLyBHZXRzIGFuIG93bmVyIGJ5IDAtaW5kZXhlZCBwb3NpdGlvbiAodXNpbmcgbnVtT3duZXJzIGFzIHRoZSBjb3VudCkKICAgIGZ1bmN0aW9uIGdldE93bmVyKHVpbnQgb3duZXJJbmRleCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhZGRyZXNzKG1fb3duZXJzW293bmVySW5kZXggKyAxXSk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJJbmRleFt1aW50KF9hZGRyKV0gPiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX3BlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX293bmVyKV07CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGV5J3JlIGFuIG93bmVyCiAgICAgICAgaWYgKG93bmVySW5kZXggPT0gMCkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsKICAgICAgICByZXR1cm4gIShwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID09IDApOwogICAgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBjb25maXJtQW5kQ2hlY2soYnl0ZXMzMiBfb3BlcmF0aW9uKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gZGV0ZXJtaW5lIHdoYXQgaW5kZXggdGhlIHByZXNlbnQgc2VuZGVyIGlzOgogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IG1fb3duZXJJbmRleFt1aW50KG1zZy5zZW5kZXIpXTsKICAgICAgICAvLyBtYWtlIHN1cmUgdGhleSdyZSBhbiBvd25lcgogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsKCiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX3BlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgLy8gaWYgd2UncmUgbm90IHlldCB3b3JraW5nIG9uIHRoaXMgb3BlcmF0aW9uLCBzd2l0Y2ggb3ZlciBhbmQgcmVzZXQgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICAgICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkID09IDApIHsKICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuCiAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkID0gbV9yZXF1aXJlZDsKICAgICAgICAgICAgLy8gcmVzZXQgd2hpY2ggb3duZXJzIGhhdmUgY29uZmlybWVkIChub25lKSAtIHNldCBvdXIgYml0bWFwIHRvIDAuCiAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSA9IDA7CiAgICAgICAgICAgIHBlbmRpbmcuaW5kZXggPSBtX3BlbmRpbmdJbmRleC5sZW5ndGgrKzsKICAgICAgICAgICAgbV9wZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPSBfb3BlcmF0aW9uOwogICAgICAgIH0KICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgKHRoZSBtZXNzYWdlIHNlbmRlcikgaGF2ZW4ndCBjb25maXJtZWQgdGhpcyBvcGVyYXRpb24gcHJldmlvdXNseS4KICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA9PSAwKSB7CiAgICAgICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgLy8gb2sgLSBjaGVjayBpZiBjb3VudCBpcyBlbm91Z2ggdG8gZ28gYWhlYWQuCiAgICAgICAgICAgIGlmIChwZW5kaW5nLnlldE5lZWRlZCA8PSAxKSB7CiAgICAgICAgICAgICAgICAvLyBlbm91Z2ggY29uZmlybWF0aW9uczogcmVzZXQgYW5kIHJ1biBpbnRlcmlvci4KICAgICAgICAgICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdJbmRleFttX3BlbmRpbmdbX29wZXJhdGlvbl0uaW5kZXhdOwogICAgICAgICAgICAgICAgZGVsZXRlIG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4KICAgICAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkLS07CiAgICAgICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgfD0gb3duZXJJbmRleEJpdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW9yZ2FuaXplT3duZXJzKCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBmcmVlID0gMTsKICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzKQogICAgICAgIHsKICAgICAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1tmcmVlXSAhPSAwKSBmcmVlKys7CiAgICAgICAgICAgIHdoaWxlIChtX251bU93bmVycyA+IDEgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdID09IDApIG1fbnVtT3duZXJzLS07CiAgICAgICAgICAgIGlmIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdICE9IDAgJiYgbV9vd25lcnNbZnJlZV0gPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbV9vd25lcnNbZnJlZV0gPSBtX293bmVyc1ttX251bU93bmVyc107CiAgICAgICAgICAgICAgICBtX293bmVySW5kZXhbbV9vd25lcnNbZnJlZV1dID0gZnJlZTsKICAgICAgICAgICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJQZW5kaW5nKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbGVuZ3RoID0gbV9wZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKQogICAgICAgICAgICBpZiAobV9wZW5kaW5nSW5kZXhbaV0gIT0gMCkKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdbbV9wZW5kaW5nSW5kZXhbaV1dOwogICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdJbmRleDsKICAgIH0KCiAgIAkvLyBGSUVMRFMKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fcmVxdWlyZWQ7CiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMKICAgIHVpbnRbMjU2XSBtX293bmVyczsKICAgIHVpbnQgY29uc3RhbnQgY19tYXhPd25lcnMgPSAyNTA7CiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXAKICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBtX293bmVySW5kZXg7CiAgICAvLyB0aGUgb25nb2luZyBvcGVyYXRpb25zLgogICAgbWFwcGluZyhieXRlczMyID0+IFBlbmRpbmdTdGF0ZSkgbV9wZW5kaW5nOwogICAgYnl0ZXMzMltdIG1fcGVuZGluZ0luZGV4Owp9CgovLyBpbmhlcml0YWJsZSAicHJvcGVydHkiIGNvbnRyYWN0IHRoYXQgZW5hYmxlcyBtZXRob2RzIHRvIGJlIHByb3RlY3RlZCBieSBwbGFjaW5nIGEgbGluZWFyIGxpbWl0IChzcGVjaWZpYWJsZSkKLy8gb24gYSBwYXJ0aWN1bGFyIHJlc291cmNlIHBlciBjYWxlbmRhciBkYXkuIGlzIG11bHRpb3duZWQgdG8gYWxsb3cgdGhlIGxpbWl0IHRvIGJlIGFsdGVyZWQuIHJlc291cmNlIHRoYXQgbWV0aG9kCi8vIHVzZXMgaXMgc3BlY2lmaWVkIGluIHRoZSBtb2RpZmllci4KY29udHJhY3QgZGF5bGltaXQgaXMgbXVsdGlvd25lZCB7CgoJLy8gTU9ESUZJRVJTCgogICAgLy8gc2ltcGxlIG1vZGlmaWVyIGZvciBkYWlseSBsaW1pdC4KICAgIG1vZGlmaWVyIGxpbWl0ZWREYWlseSh1aW50IF92YWx1ZSkgewogICAgICAgIGlmICh1bmRlckxpbWl0KF92YWx1ZSkpCiAgICAgICAgICAgIF87CiAgICB9CgoJLy8gTUVUSE9EUwoKICAgIC8vIGNvbnN0cnVjdG9yIC0gc3RvcmVzIGluaXRpYWwgZGFpbHkgbGltaXQgYW5kIHJlY29yZHMgdGhlIHByZXNlbnQgZGF5J3MgaW5kZXguCiAgICBmdW5jdGlvbiBkYXlsaW1pdCh1aW50IF9saW1pdCkgewogICAgICAgIG1fZGFpbHlMaW1pdCA9IF9saW1pdDsKICAgICAgICBtX2xhc3REYXkgPSB0b2RheSgpOwogICAgfQogICAgLy8gKHJlKXNldHMgdGhlIGRhaWx5IGxpbWl0LiBuZWVkcyBtYW55IG9mIHRoZSBvd25lcnMgdG8gY29uZmlybS4gZG9lc24ndCBhbHRlciB0aGUgYW1vdW50IGFscmVhZHkgc3BlbnQgdG9kYXkuCiAgICBmdW5jdGlvbiBzZXREYWlseUxpbWl0KHVpbnQgX25ld0xpbWl0KSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgewogICAgICAgIG1fZGFpbHlMaW1pdCA9IF9uZXdMaW1pdDsKICAgIH0KICAgIC8vIHJlc2V0cyB0aGUgYW1vdW50IGFscmVhZHkgc3BlbnQgdG9kYXkuIG5lZWRzIG1hbnkgb2YgdGhlIG93bmVycyB0byBjb25maXJtLgogICAgZnVuY3Rpb24gcmVzZXRTcGVudFRvZGF5KCkgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICBtX3NwZW50VG9kYXkgPSAwOwogICAgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICAvLyBjaGVja3MgdG8gc2VlIGlmIHRoZXJlIGlzIGF0IGxlYXN0IGBfdmFsdWVgIGxlZnQgZnJvbSB0aGUgZGFpbHkgbGltaXQgdG9kYXkuIGlmIHRoZXJlIGlzLCBzdWJ0cmFjdHMgaXQgYW5kCiAgICAvLyByZXR1cm5zIHRydWUuIG90aGVyd2lzZSBqdXN0IHJldHVybnMgZmFsc2UuCiAgICBmdW5jdGlvbiB1bmRlckxpbWl0KHVpbnQgX3ZhbHVlKSBpbnRlcm5hbCBvbmx5b3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIHJlc2V0IHRoZSBzcGVuZCBsaW1pdCBpZiB3ZSdyZSBvbiBhIGRpZmZlcmVudCBkYXkgdG8gbGFzdCB0aW1lLgogICAgICAgIGlmICh0b2RheSgpID4gbV9sYXN0RGF5KSB7CiAgICAgICAgICAgIG1fc3BlbnRUb2RheSA9IDA7CiAgICAgICAgICAgIG1fbGFzdERheSA9IHRvZGF5KCk7CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGVub3VnaCBsZWZ0IC0gaWYgc28sIHN1YnRyYWN0IGFuZCByZXR1cm4gdHJ1ZS4KICAgICAgICAvLyBvdmVyZmxvdyBwcm90ZWN0aW9uICAgICAgICAgICAgICAgICAgICAvLyBkYWlseUxpbWl0IGNoZWNrCiAgICAgICAgaWYgKG1fc3BlbnRUb2RheSArIF92YWx1ZSA+PSBtX3NwZW50VG9kYXkgJiYgbV9zcGVudFRvZGF5ICsgX3ZhbHVlIDw9IG1fZGFpbHlMaW1pdCkgewogICAgICAgICAgICBtX3NwZW50VG9kYXkgKz0gX3ZhbHVlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gZGV0ZXJtaW5lcyB0b2RheSdzIGluZGV4LgogICAgZnVuY3Rpb24gdG9kYXkoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIG5vdyAvIDEgZGF5czsgfQoKCS8vIEZJRUxEUwoKICAgIHVpbnQgcHVibGljIG1fZGFpbHlMaW1pdDsKICAgIHVpbnQgcHVibGljIG1fc3BlbnRUb2RheTsKICAgIHVpbnQgcHVibGljIG1fbGFzdERheTsKfQoKLy8gaW50ZXJmYWNlIGNvbnRyYWN0IGZvciBtdWx0aXNpZyBwcm94eSBjb250cmFjdHM7IHNlZSBiZWxvdyBmb3IgZG9jcy4KY29udHJhY3QgbXVsdGlzaWcgewoKCS8vIEVWRU5UUwoKICAgIC8vIGxvZ2dlZCBldmVudHM6CiAgICAvLyBGdW5kcyBoYXMgYXJyaXZlZCBpbnRvIHRoZSB3YWxsZXQgKHJlY29yZCBob3cgbXVjaCkuCiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgX2Zyb20sIHVpbnQgdmFsdWUpOwogICAgLy8gU2luZ2xlIHRyYW5zYWN0aW9uIGdvaW5nIG91dCBvZiB0aGUgd2FsbGV0IChyZWNvcmQgd2hvIHNpZ25lZCBmb3IgaXQsIGhvdyBtdWNoLCBhbmQgdG8gd2hvbSBpdCdzIGdvaW5nKS4KICAgIGV2ZW50IFNpbmdsZVRyYW5zYWN0KGFkZHJlc3Mgb3duZXIsIHVpbnQgdmFsdWUsIGFkZHJlc3MgdG8sIGJ5dGVzIGRhdGEpOwogICAgLy8gTXVsdGktc2lnIHRyYW5zYWN0aW9uIGdvaW5nIG91dCBvZiB0aGUgd2FsbGV0IChyZWNvcmQgd2hvIHNpZ25lZCBmb3IgaXQgbGFzdCwgdGhlIG9wZXJhdGlvbiBoYXNoLCBob3cgbXVjaCwgYW5kIHRvIHdob20gaXQncyBnb2luZykuCiAgICBldmVudCBNdWx0aVRyYW5zYWN0KGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uLCB1aW50IHZhbHVlLCBhZGRyZXNzIHRvLCBieXRlcyBkYXRhKTsKICAgIC8vIENvbmZpcm1hdGlvbiBzdGlsbCBuZWVkZWQgZm9yIGEgdHJhbnNhY3Rpb24uCiAgICBldmVudCBDb25maXJtYXRpb25OZWVkZWQoYnl0ZXMzMiBvcGVyYXRpb24sIGFkZHJlc3MgaW5pdGlhdG9yLCB1aW50IHZhbHVlLCBhZGRyZXNzIHRvLCBieXRlcyBkYXRhKTsKCiAgICAvLyBGVU5DVElPTlMKCiAgICAvLyBUT0RPOiBkb2N1bWVudAogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIGV4dGVybmFsOwogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBleHRlcm5hbCByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGNvbmZpcm0oYnl0ZXMzMiBfaCkgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IHRva2Vuc3dhcCBpcyBtdWx0aXNpZywgbXVsdGlvd25lZCB7CiAgICBUb2tlbiBwdWJsaWMgdG9rZW5DdHI7CiAgICBib29sIHB1YmxpYyB0b2tlblN3YXA7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBTV0FQX0xFTkdUSCA9IDQgIHdlZWtzOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX0VUSCA9IDcwMDAwMCBldGhlcjsKICAgIHVpbnQgcHVibGljIGFtb3VudFJhaXNlZDsKCiAgICBtb2RpZmllciBpc1plcm9WYWx1ZSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzT3ZlckNhcCB7CglpZiAoYW1vdW50UmFpc2VkICsgbXNnLnZhbHVlID4gTUFYX0VUSCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1N3YXBTdG9wcGVkIHsKICAgICAgICBpZiAoIXRva2VuU3dhcCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBhcmVDb25kaXRpb25zU2F0aXNmaWVkIHsKCS8vIEVuZCB0b2tlbiBzd2FwIGlmIHNhbGUgcGVyaW9kIGVuZGVkCglpZiAodG9rZW5DdHIuY3JlYXRpb25UaW1lKCkgKyBTV0FQX0xFTkdUSCA8IG5vdykgewogICAgICAgICAgICB0b2tlbkN0ci5kaXNhYmxlVG9rZW5Td2FwTG9jaygpOwogICAgICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF87CgkgICAgICAgIC8vIENoZWNrIGlmIGNhcCBoYXMgYmVlbiByZWFjaGVkIGluIHRoaXMgdHgKICAgICAgICAgICAgaWYgKGFtb3VudFJhaXNlZCA9PSBNQVhfRVRIKSB7CiAgICAgICAgICAgICAgICB0b2tlbkN0ci5kaXNhYmxlVG9rZW5Td2FwTG9jaygpOwogICAgICAgICAgICAgICAgdG9rZW5Td2FwID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiAoYSArIGIgPj0gYSAmJiBhICsgYiA+PSBiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydFRva2VuU3dhcCgpIG9ubHlvd25lciB7CiAgICAgICAgdG9rZW5Td2FwID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdG9wVG9rZW5Td2FwKCkgb25seW93bmVyIHsKICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUb2tlbkNvbnRyYWN0KGFkZHJlc3MgbmV3VG9rZW5Db250cmFjdEFkZHIpIG9ubHlvd25lciB7CiAgICAgICAgaWYgKG5ld1Rva2VuQ29udHJhY3RBZGRyID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CiAgICAgICAgLy8gQWxsb3cgc2V0dGluZyBvbmx5IG9uY2UKICAgICAgICBpZiAodG9rZW5DdHIgIT0gYWRkcmVzcygweDApKSB0aHJvdzsKCiAgICAgICAgdG9rZW5DdHIgPSBUb2tlbihuZXdUb2tlbkNvbnRyYWN0QWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KQogICAgcGF5YWJsZQogICAgaXNaZXJvVmFsdWUKICAgIGlzT3ZlckNhcAogICAgaXNTd2FwU3RvcHBlZAogICAgYXJlQ29uZGl0aW9uc1NhdGlzZmllZCB7CiAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgICAgIHRva2VuQ3RyLm1pbnRUb2tlbnMoX2JlbmVmaWNpYXJ5LCBtc2cudmFsdWUpOwogICAgICAgIGlmICghc2FmZVRvQWRkKGFtb3VudFJhaXNlZCwgbXNnLnZhbHVlKSkgdGhyb3c7CiAgICAgICAgYW1vdW50UmFpc2VkICs9IG1zZy52YWx1ZTsKICAgIH0KfQoKLy8gdXNhZ2U6Ci8vIGJ5dGVzMzIgaCA9IFdhbGxldCh3KS5mcm9tKG9uZU93bmVyKS50cmFuc2FjdCh0bywgdmFsdWUsIGRhdGEpOwovLyBXYWxsZXQodykuZnJvbShhbm90aGVyT3duZXIpLmNvbmZpcm0oaCk7CmNvbnRyYWN0IFdhbGxldCBpcyBtdWx0aXNpZywgbXVsdGlvd25lZCwgZGF5bGltaXQsIHRva2Vuc3dhcCB7CgoJLy8gVFlQRVMKCiAgICAvLyBUcmFuc2FjdGlvbiBzdHJ1Y3R1cmUgdG8gcmVtZW1iZXIgZGV0YWlscyBvZiB0cmFuc2FjdGlvbiBsZXN0IGl0IG5lZWQgYmUgc2F2ZWQgZm9yIGEgbGF0ZXIgY2FsbC4KICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAgICAgYWRkcmVzcyB0bzsKICAgICAgICB1aW50IHZhbHVlOwogICAgICAgIGJ5dGVzIGRhdGE7CiAgICB9CgogICAgLy8gTUVUSE9EUwoKICAgIC8vIGNvbnN0cnVjdG9yIC0ganVzdCBwYXNzIG9uIHRoZSBvd25lciBhcnJheSB0byB0aGUgbXVsdGlvd25lZCBhbmQKICAgIC8vIHRoZSBsaW1pdCB0byBkYXlsaW1pdAogICAgZnVuY3Rpb24gV2FsbGV0KGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCwgdWludCBfZGF5bGltaXQpCiAgICAgICAgICAgIG11bHRpb3duZWQoX293bmVycywgX3JlcXVpcmVkKSBkYXlsaW1pdChfZGF5bGltaXQpIHsKICAgIH0KCiAgICAvLyBraWxscyB0aGUgY29udHJhY3Qgc2VuZGluZyBldmVyeXRoaW5nIHRvIGBfdG9gLgogICAgZnVuY3Rpb24ga2lsbChhZGRyZXNzIF90bykgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICAvL2Vuc3VyZSBvd25lcnMgY2FuJ3QgcHJlbWF0dXJlbHkgc3RvcCB0b2tlbiBzYWxlCiAgICAgICAgLy9hbmQgdGhlbiByZW5kZXIgdG9rZW5zIHVudHJhZGFibGUsIGFzIHdpdGhvdXQgdGhpcwogICAgICAgIC8vY2hlY2ssIHRoZSB0b2tlblN3YXBMb2NrIHdvdWxkIG5ldmVyIGdldCBkaXNpYWJsZWQKICAgICAgICAvL2lmIHRoaXMgZmlyZXMKICAgICAgICBpZiAodG9rZW5DdHIudG9rZW5Td2FwTG9jaygpKSB0aHJvdzsKCiAgICAgICAgc3VpY2lkZShfdG8pOwogICAgfQoKICAgIC8vIGdldHMgY2FsbGVkIHdoZW4gbm8gb3RoZXIgZnVuY3Rpb24gbWF0Y2hlcwogICAgZnVuY3Rpb24oKQogICAgcGF5YWJsZSB7CiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIE91dHNpZGUtdmlzaWJsZSB0cmFuc2FjdCBlbnRyeSBwb2ludC4gRXhlY3V0ZXMgdHJhbnNhY3Rpb24gaW1tZWRpYXRlbHkgaWYgYmVsb3cgZGFpbHkgc3BlbmQgbGltaXQuCiAgICAvLyBJZiBub3QsIGdvZXMgaW50byBtdWx0aXNpZyBwcm9jZXNzLiBXZSBwcm92aWRlIGEgaGFzaCBvbiByZXR1cm4gdG8gYWxsb3cgdGhlIHNlbmRlciB0byBwcm92aWRlCiAgICAvLyBzaG9ydGN1dHMgZm9yIHRoZSBvdGhlciBjb25maXJtYXRpb25zIChhbGxvd2luZyB0aGVtIHRvIGF2b2lkIHJlcGxpY2F0aW5nIHRoZSBfdG8sIF92YWx1ZQogICAgLy8gYW5kIF9kYXRhIGFyZ3VtZW50cykuIFRoZXkgc3RpbGwgZ2V0IHRoZSBvcHRpb24gb2YgdXNpbmcgdGhlbSBpZiB0aGV5IHdhbnQsIGFueXdheXMuCiAgICBmdW5jdGlvbiBleGVjdXRlKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIGV4dGVybmFsIG9ubHlvd25lciByZXR1cm5zIChieXRlczMyIF9yKSB7CiAgICAgICAgLy8gRGlzYWxsb3cgdGhlIHdhbGxldCBjb250cmFjdCBmcm9tIGNhbGxpbmcgdG9rZW4gY29udHJhY3Qgb25jZSBpdCdzIHNldAogICAgICAgIC8vIHNvIHRva2VucyBjYW4ndCBiZSBtaW50ZWQgYXJiaXRyYXJpbHkgb25jZSB0aGUgc2FsZSBzdGFydHMuCiAgICAgICAgLy8gVG9rZW5zIGNhbiBiZSBtaW50ZWQgZm9yIHByZW1pbmUgYmVmb3JlIHRoZSBzYWxlIG9wZW5zIGFuZCB0b2tlbkN0ciBpcyBzZXQuCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRva2VuQ3RyKSkgdGhyb3c7CgogICAgICAgIC8vIGZpcnN0LCB0YWtlIHRoZSBvcHBvcnR1bml0eSB0byBjaGVjayB0aGF0IHdlJ3JlIHVuZGVyIHRoZSBkYWlseSBsaW1pdC4KICAgICAgICBpZiAodW5kZXJMaW1pdChfdmFsdWUpKSB7CiAgICAgICAgICAgIFNpbmdsZVRyYW5zYWN0KG1zZy5zZW5kZXIsIF92YWx1ZSwgX3RvLCBfZGF0YSk7CiAgICAgICAgICAgIC8vIHllcyAtIGp1c3QgZXhlY3V0ZSB0aGUgY2FsbC4KICAgICAgICAgICAgaWYoIV90by5jYWxsLnZhbHVlKF92YWx1ZSkoX2RhdGEpKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgLy8gZGV0ZXJtaW5lIG91ciBvcGVyYXRpb24gaGFzaC4KICAgICAgICBfciA9IHNoYTMobXNnLmRhdGEsIGJsb2NrLm51bWJlcik7CiAgICAgICAgaWYgKCFjb25maXJtKF9yKSAmJiBtX3R4c1tfcl0udG8gPT0gMCkgewogICAgICAgICAgICBtX3R4c1tfcl0udG8gPSBfdG87CiAgICAgICAgICAgIG1fdHhzW19yXS52YWx1ZSA9IF92YWx1ZTsKICAgICAgICAgICAgbV90eHNbX3JdLmRhdGEgPSBfZGF0YTsKICAgICAgICAgICAgQ29uZmlybWF0aW9uTmVlZGVkKF9yLCBtc2cuc2VuZGVyLCBfdmFsdWUsIF90bywgX2RhdGEpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBjb25maXJtIGEgdHJhbnNhY3Rpb24gdGhyb3VnaCBqdXN0IHRoZSBoYXNoLiB3ZSB1c2UgdGhlIHByZXZpb3VzIHRyYW5zYWN0aW9ucyBtYXAsIG1fdHhzLCBpbiBvcmRlcgogICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBib2R5IG9mIHRoZSB0cmFuc2FjdGlvbiBmcm9tIHRoZSBoYXNoIHByb3ZpZGVkLgogICAgZnVuY3Rpb24gY29uZmlybShieXRlczMyIF9oKSBvbmx5bWFueW93bmVycyhfaCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChtX3R4c1tfaF0udG8gIT0gMCkgewogICAgICAgICAgICBpZighbV90eHNbX2hdLnRvLmNhbGwudmFsdWUobV90eHNbX2hdLnZhbHVlKShtX3R4c1tfaF0uZGF0YSkpCiAgICAgICAgICAgIE11bHRpVHJhbnNhY3QobXNnLnNlbmRlciwgX2gsIG1fdHhzW19oXS52YWx1ZSwgbV90eHNbX2hdLnRvLCBtX3R4c1tfaF0uZGF0YSk7CiAgICAgICAgICAgIGRlbGV0ZSBtX3R4c1tfaF07CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTCgogICAgZnVuY3Rpb24gY2xlYXJQZW5kaW5nKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbGVuZ3RoID0gbV9wZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKQogICAgICAgICAgICBkZWxldGUgbV90eHNbbV9wZW5kaW5nSW5kZXhbaV1dOwogICAgICAgIHN1cGVyLmNsZWFyUGVuZGluZygpOwogICAgfQoKCS8vIEZJRUxEUwoKICAgIC8vIHBlbmRpbmcgdHJhbnNhY3Rpb25zIHdlIGhhdmUgYXQgcHJlc2VudC4KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gVHJhbnNhY3Rpb24pIG1fdHhzOwp9'.
	

]
