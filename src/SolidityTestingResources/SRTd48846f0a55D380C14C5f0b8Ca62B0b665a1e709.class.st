Class {
	#name : #SRTd48846f0a55D380C14C5f0b8Ca62B0b665a1e709,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd48846f0a55D380C14C5f0b8Ca62B0b665a1e709 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgppbnRlcmZhY2UgRXhwZWN0ZWRSYXRlSW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGdldEV4cGVjdGVkUmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5KSBwdWJsaWMgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQgZXhwZWN0ZWRSYXRlLCB1aW50IHNsaXBwYWdlUmF0ZSk7Cn0KCmludGVyZmFjZSBLeWJlclJlc2VydmVJbnRlcmZhY2UgewoKICAgIGZ1bmN0aW9uIHRyYWRlKAogICAgICAgIEVSQzIwIHNyY1Rva2VuLAogICAgICAgIHVpbnQgc3JjQW1vdW50LAogICAgICAgIEVSQzIwIGRlc3RUb2tlbiwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzLAogICAgICAgIHVpbnQgY29udmVyc2lvblJhdGUsCiAgICAgICAgYm9vbCB2YWxpZGF0ZQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zKGJvb2wpOwoKICAgIGZ1bmN0aW9uIGdldENvbnZlcnNpb25SYXRlKEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBzcmNRdHksIHVpbnQgYmxvY2tOdW1iZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCk7Cn0KCmNvbnRyYWN0IFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGFkZHJlc3MgcHVibGljIGFkbWluOwogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ0FkbWluOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBvcGVyYXRvcnM7CiAgICBtYXBwaW5nKGFkZHJlc3M9PmJvb2wpIGludGVybmFsIGFsZXJ0ZXJzOwogICAgYWRkcmVzc1tdIGludGVybmFsIG9wZXJhdG9yc0dyb3VwOwogICAgYWRkcmVzc1tdIGludGVybmFsIGFsZXJ0ZXJzR3JvdXA7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIE1BWF9HUk9VUF9TSVpFID0gNTA7CgogICAgZnVuY3Rpb24gUGVybWlzc2lvbkdyb3VwcygpIHB1YmxpYyB7CiAgICAgICAgYWRtaW4gPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRtaW4pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU9wZXJhdG9yKCkgewogICAgICAgIHJlcXVpcmUob3BlcmF0b3JzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBbGVydGVyKCkgewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0T3BlcmF0b3JzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gb3BlcmF0b3JzR3JvdXA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWxlcnRlcnMgKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3NbXSkgewogICAgICAgIHJldHVybiBhbGVydGVyc0dyb3VwOwogICAgfQoKICAgIGV2ZW50IFRyYW5zZmVyQWRtaW5QZW5kaW5nKGFkZHJlc3MgcGVuZGluZ0FkbWluKTsKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IGFkbWluIHRvIHNldCB0aGUgcGVuZGluZ0FkbWluIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gbmV3QWRtaW4gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFkbWluKGFkZHJlc3MgbmV3QWRtaW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUobmV3QWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgVHJhbnNmZXJBZG1pblBlbmRpbmcocGVuZGluZ0FkbWluKTsKICAgICAgICBwZW5kaW5nQWRtaW4gPSBuZXdBZG1pbjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IGFkbWluIHRvIHNldCB0aGUgYWRtaW4gaW4gb25lIHR4LiBVc2VmdWwgaW5pdGlhbCBkZXBsb3ltZW50LgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pblF1aWNrbHkoYWRkcmVzcyBuZXdBZG1pbikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShuZXdBZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBUcmFuc2ZlckFkbWluUGVuZGluZyhuZXdBZG1pbik7CiAgICAgICAgQWRtaW5DbGFpbWVkKG5ld0FkbWluLCBhZG1pbik7CiAgICAgICAgYWRtaW4gPSBuZXdBZG1pbjsKICAgIH0KCiAgICBldmVudCBBZG1pbkNsYWltZWQoIGFkZHJlc3MgbmV3QWRtaW4sIGFkZHJlc3MgcHJldmlvdXNBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ0FkbWluIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIGNoYW5nZSBhZG1pbiBwcm9jZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbUFkbWluKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHBlbmRpbmdBZG1pbiA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBBZG1pbkNsYWltZWQocGVuZGluZ0FkbWluLCBhZG1pbik7CiAgICAgICAgYWRtaW4gPSBwZW5kaW5nQWRtaW47CiAgICAgICAgcGVuZGluZ0FkbWluID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICBldmVudCBBbGVydGVyQWRkZWQgKGFkZHJlc3MgbmV3QWxlcnRlciwgYm9vbCBpc0FkZCk7CgogICAgZnVuY3Rpb24gYWRkQWxlcnRlcihhZGRyZXNzIG5ld0FsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoIWFsZXJ0ZXJzW25ld0FsZXJ0ZXJdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNHcm91cC5sZW5ndGggPCBNQVhfR1JPVVBfU0laRSk7CgogICAgICAgIEFsZXJ0ZXJBZGRlZChuZXdBbGVydGVyLCB0cnVlKTsKICAgICAgICBhbGVydGVyc1tuZXdBbGVydGVyXSA9IHRydWU7CiAgICAgICAgYWxlcnRlcnNHcm91cC5wdXNoKG5ld0FsZXJ0ZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUFsZXJ0ZXIgKGFkZHJlc3MgYWxlcnRlcikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShhbGVydGVyc1thbGVydGVyXSk7CiAgICAgICAgYWxlcnRlcnNbYWxlcnRlcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWxlcnRlcnNHcm91cC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAoYWxlcnRlcnNHcm91cFtpXSA9PSBhbGVydGVyKSB7CiAgICAgICAgICAgICAgICBhbGVydGVyc0dyb3VwW2ldID0gYWxlcnRlcnNHcm91cFthbGVydGVyc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cC5sZW5ndGgtLTsKICAgICAgICAgICAgICAgIEFsZXJ0ZXJBZGRlZChhbGVydGVyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBldmVudCBPcGVyYXRvckFkZGVkKGFkZHJlc3MgbmV3T3BlcmF0b3IsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZE9wZXJhdG9yKGFkZHJlc3MgbmV3T3BlcmF0b3IpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoIW9wZXJhdG9yc1tuZXdPcGVyYXRvcl0pOyAvLyBwcmV2ZW50IGR1cGxpY2F0ZXMuCiAgICAgICAgcmVxdWlyZShvcGVyYXRvcnNHcm91cC5sZW5ndGggPCBNQVhfR1JPVVBfU0laRSk7CgogICAgICAgIE9wZXJhdG9yQWRkZWQobmV3T3BlcmF0b3IsIHRydWUpOwogICAgICAgIG9wZXJhdG9yc1tuZXdPcGVyYXRvcl0gPSB0cnVlOwogICAgICAgIG9wZXJhdG9yc0dyb3VwLnB1c2gobmV3T3BlcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wZXJhdG9yIChhZGRyZXNzIG9wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1tvcGVyYXRvcl0pOwogICAgICAgIG9wZXJhdG9yc1tvcGVyYXRvcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3BlcmF0b3JzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG9wZXJhdG9yc0dyb3VwW2ldID09IG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cFtpXSA9IG9wZXJhdG9yc0dyb3VwW29wZXJhdG9yc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC09IDE7CiAgICAgICAgICAgICAgICBPcGVyYXRvckFkZGVkKG9wZXJhdG9yLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgV2l0aGRyYXdhYmxlIGlzIFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGV2ZW50IFRva2VuV2l0aGRyYXcoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IGFsbCBFUkMyMCBjb21wYXRpYmxlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuIEVSQzIwIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihzZW5kVG8sIGFtb3VudCkpOwogICAgICAgIFRva2VuV2l0aGRyYXcodG9rZW4sIGFtb3VudCwgc2VuZFRvKTsKICAgIH0KCiAgICBldmVudCBFdGhlcldpdGhkcmF3KHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IEV0aGVycwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBzZW5kVG8udHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBFdGhlcldpdGhkcmF3KGFtb3VudCwgc2VuZFRvKTsKICAgIH0KfQoKY29udHJhY3QgVXRpbHMgewoKICAgIEVSQzIwIGNvbnN0YW50IGludGVybmFsIEVUSF9UT0tFTl9BRERSRVNTID0gRVJDMjAoMHgwMGVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWUpOwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgUFJFQ0lTSU9OID0gKDEwKioxOCk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfUVRZICAgPSAoMTAqKjI4KTsgLy8gMTBCIHRva2VucwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX1JBVEUgID0gKFBSRUNJU0lPTiAqIDEwKio2KTsgLy8gdXAgdG8gMU0gdG9rZW5zIHBlciBFVEgKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9ERUNJTUFMUyA9IDE4OwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX0RFQ0lNQUxTID0gMTg7CiAgICBtYXBwaW5nKGFkZHJlc3M9PnVpbnQpIGludGVybmFsIGRlY2ltYWxzOwoKICAgIGZ1bmN0aW9uIHNldERlY2ltYWxzKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSBkZWNpbWFsc1t0b2tlbl0gPSBFVEhfREVDSU1BTFM7CiAgICAgICAgZWxzZSBkZWNpbWFsc1t0b2tlbl0gPSB0b2tlbi5kZWNpbWFscygpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGlmICh0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykgcmV0dXJuIEVUSF9ERUNJTUFMUzsgLy8gc2F2ZSBzdG9yYWdlIGFjY2VzcwogICAgICAgIHVpbnQgdG9rZW5EZWNpbWFscyA9IGRlY2ltYWxzW3Rva2VuXTsKICAgICAgICAvLyB0ZWNobmljYWxseSwgdGhlcmUgbWlnaHQgYmUgdG9rZW4gd2l0aCBkZWNpbWFscyAwCiAgICAgICAgLy8gbW9yZW92ZXIsIHZlcnkgcG9zc2libGUgdGhhdCBvbGQgdG9rZW5zIGhhdmUgZGVjaW1hbHMgMAogICAgICAgIC8vIHRoZXNlIHRva2VucyB3aWxsIGp1c3QgaGF2ZSBoaWdoZXIgZ2FzIGZlZXMuCiAgICAgICAgaWYodG9rZW5EZWNpbWFscyA9PSAwKSByZXR1cm4gdG9rZW4uZGVjaW1hbHMoKTsKCiAgICAgICAgcmV0dXJuIHRva2VuRGVjaW1hbHM7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY0RzdFF0eSh1aW50IHNyY1F0eSwgdWludCBzcmNEZWNpbWFscywgdWludCBkc3REZWNpbWFscywgdWludCByYXRlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJlcXVpcmUoc3JjUXR5IDw9IE1BWF9RVFkpOwogICAgICAgIHJlcXVpcmUocmF0ZSA8PSBNQVhfUkFURSk7CgogICAgICAgIGlmIChkc3REZWNpbWFscyA+PSBzcmNEZWNpbWFscykgewogICAgICAgICAgICByZXF1aXJlKChkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICByZXR1cm4gKHNyY1F0eSAqIHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpIC8gUFJFQ0lTSU9OOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSkgLyAoUFJFQ0lTSU9OICogKDEwKiooc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykpKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY1NyY1F0eSh1aW50IGRzdFF0eSwgdWludCBzcmNEZWNpbWFscywgdWludCBkc3REZWNpbWFscywgdWludCByYXRlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJlcXVpcmUoZHN0UXR5IDw9IE1BWF9RVFkpOwogICAgICAgIHJlcXVpcmUocmF0ZSA8PSBNQVhfUkFURSk7CgogICAgICAgIC8vc291cmNlIHF1YW50aXR5IGlzIHJvdW5kZWQgdXAuIHRvIGF2b2lkIGRlc3QgcXVhbnRpdHkgYmVpbmcgdG9vIGxvdy4KICAgICAgICB1aW50IG51bWVyYXRvcjsKICAgICAgICB1aW50IGRlbm9taW5hdG9yOwogICAgICAgIGlmIChzcmNEZWNpbWFscyA+PSBkc3REZWNpbWFscykgewogICAgICAgICAgICByZXF1aXJlKChzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICBudW1lcmF0b3IgPSAoUFJFQ0lTSU9OICogZHN0UXR5ICogKDEwKiooc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykpKTsKICAgICAgICAgICAgZGVub21pbmF0b3IgPSByYXRlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IChyYXRlICogKDEwKiooZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChudW1lcmF0b3IgKyBkZW5vbWluYXRvciAtIDEpIC8gZGVub21pbmF0b3I7IC8vYXZvaWQgcm91bmRpbmcgZG93biBlcnJvcnMKICAgIH0KfQoKY29udHJhY3QgS3liZXJOZXR3b3JrIGlzIFdpdGhkcmF3YWJsZSwgVXRpbHMgewoKICAgIHVpbnQgcHVibGljIG5lZ2xpZ2libGVSYXRlRGlmZiA9IDEwOyAvLyBiYXNpYyByYXRlIHN0ZXBzIHdpbGwgYmUgaW4gMC4wMSUKICAgIEt5YmVyUmVzZXJ2ZUludGVyZmFjZVtdIHB1YmxpYyByZXNlcnZlczsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgcHVibGljIGlzUmVzZXJ2ZTsKICAgIFdoaXRlTGlzdEludGVyZmFjZSBwdWJsaWMgd2hpdGVMaXN0Q29udHJhY3Q7CiAgICBFeHBlY3RlZFJhdGVJbnRlcmZhY2UgcHVibGljIGV4cGVjdGVkUmF0ZUNvbnRyYWN0OwogICAgRmVlQnVybmVySW50ZXJmYWNlICAgIHB1YmxpYyBmZWVCdXJuZXJDb250cmFjdDsKICAgIHVpbnQgICAgICAgICAgICAgICAgICBwdWJsaWMgbWF4R2FzUHJpY2UgPSA1MCAqIDEwMDAgKiAxMDAwICogMTAwMDsgLy8gNTAgZ3dlaQogICAgYm9vbCAgICAgICAgICAgICAgICAgIHB1YmxpYyBlbmFibGVkID0gZmFsc2U7IC8vIG5ldHdvcmsgaXMgZW5hYmxlZAogICAgdWludCAgICAgICAgICAgICAgICAgIHB1YmxpYyBuZXR3b3JrU3RhdGU7IC8vIHRoaXMgaXMgb25seSBhIGZpZWxkIGZvciBVSS4KICAgIG1hcHBpbmcoYWRkcmVzcz0+bWFwcGluZyhieXRlczMyPT5ib29sKSkgcHVibGljIHBlclJlc2VydmVMaXN0ZWRQYWlyczsKCiAgICBmdW5jdGlvbiBLeWJlck5ldHdvcmsoYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYWRtaW4gPSBfYWRtaW47CiAgICB9CgogICAgZXZlbnQgRXRoZXJSZWNlaXZhbChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGFtb3VudCk7CgogICAgLyogc29saGludC1kaXNhYmxlIG5vLWNvbXBsZXgtZmFsbGJhY2sgKi8KICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNSZXNlcnZlW21zZy5zZW5kZXJdKTsKICAgICAgICBFdGhlclJlY2VpdmFsKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CiAgICAvKiBzb2xoaW50LWVuYWJsZSBuby1jb21wbGV4LWZhbGxiYWNrICovCgogICAgZXZlbnQgRXhlY3V0ZVRyYWRlKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBhY3R1YWxTcmNBbW91bnQsIHVpbnQgYWN0dWFsRGVzdEFtb3VudCk7CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBtYWtlcyBhIHRyYWRlIGJldHdlZW4gc3JjIGFuZCBkZXN0IHRva2VuIGFuZCBzZW5kIGRlc3QgdG9rZW4gdG8gZGVzdEFkZHJlc3MKICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBzcmNBbW91bnQgYW1vdW50IG9mIHNyYyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gbWF4RGVzdEFtb3VudCBBIGxpbWl0IG9uIHRoZSBhbW91bnQgb2YgZGVzdCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gbWluQ29udmVyc2lvblJhdGUgVGhlIG1pbmltYWwgY29udmVyc2lvbiByYXRlLiBJZiBhY3R1YWwgcmF0ZSBpcyBsb3dlciwgdHJhZGUgaXMgY2FuY2VsZWQuCiAgICAvLy8gQHBhcmFtIHdhbGxldElkIGlzIHRoZSB3YWxsZXQgSUQgdG8gc2VuZCBwYXJ0IG9mIHRoZSBmZWVzCiAgICAvLy8gQHJldHVybiBhbW91bnQgb2YgYWN0dWFsIGRlc3QgdG9rZW5zCiAgICBmdW5jdGlvbiB0cmFkZSgKICAgICAgICBFUkMyMCBzcmMsCiAgICAgICAgdWludCBzcmNBbW91bnQsCiAgICAgICAgRVJDMjAgZGVzdCwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzLAogICAgICAgIHVpbnQgbWF4RGVzdEFtb3VudCwKICAgICAgICB1aW50IG1pbkNvbnZlcnNpb25SYXRlLAogICAgICAgIGFkZHJlc3Mgd2FsbGV0SWQKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHJlcXVpcmUoZW5hYmxlZCk7CgogICAgICAgIHVpbnQgdXNlclNyY0JhbGFuY2VCZWZvcmU7CiAgICAgICAgdWludCB1c2VyU3JjQmFsYW5jZUFmdGVyOwogICAgICAgIHVpbnQgdXNlckRlc3RCYWxhbmNlQmVmb3JlOwogICAgICAgIHVpbnQgdXNlckRlc3RCYWxhbmNlQWZ0ZXI7CgogICAgICAgIHVzZXJTcmNCYWxhbmNlQmVmb3JlID0gZ2V0QmFsYW5jZShzcmMsIG1zZy5zZW5kZXIpOwogICAgICAgIGlmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpCiAgICAgICAgICAgIHVzZXJTcmNCYWxhbmNlQmVmb3JlICs9IG1zZy52YWx1ZTsKICAgICAgICB1c2VyRGVzdEJhbGFuY2VCZWZvcmUgPSBnZXRCYWxhbmNlKGRlc3QsIGRlc3RBZGRyZXNzKTsKCiAgICAgICAgdWludCBhY3R1YWxEZXN0QW1vdW50ID0gZG9UcmFkZShzcmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhEZXN0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluQ29udmVyc2lvblJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWxsZXRJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICByZXF1aXJlKGFjdHVhbERlc3RBbW91bnQgPiAwKTsKCiAgICAgICAgdXNlclNyY0JhbGFuY2VBZnRlciA9IGdldEJhbGFuY2Uoc3JjLCBtc2cuc2VuZGVyKTsKICAgICAgICB1c2VyRGVzdEJhbGFuY2VBZnRlciA9IGdldEJhbGFuY2UoZGVzdCwgZGVzdEFkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKHVzZXJTcmNCYWxhbmNlQWZ0ZXIgPD0gdXNlclNyY0JhbGFuY2VCZWZvcmUpOwogICAgICAgIHJlcXVpcmUodXNlckRlc3RCYWxhbmNlQWZ0ZXIgPj0gdXNlckRlc3RCYWxhbmNlQmVmb3JlKTsKCiAgICAgICAgcmVxdWlyZSgodXNlckRlc3RCYWxhbmNlQWZ0ZXIgLSB1c2VyRGVzdEJhbGFuY2VCZWZvcmUpID49CiAgICAgICAgICAgIGNhbGNEc3RRdHkoKHVzZXJTcmNCYWxhbmNlQmVmb3JlIC0gdXNlclNyY0JhbGFuY2VBZnRlciksIGdldERlY2ltYWxzKHNyYyksIGdldERlY2ltYWxzKGRlc3QpLAogICAgICAgICAgICAgICAgbWluQ29udmVyc2lvblJhdGUpKTsKCiAgICAgICAgcmV0dXJuIGFjdHVhbERlc3RBbW91bnQ7CiAgICB9CgogICAgZXZlbnQgQWRkUmVzZXJ2ZVRvTmV0d29yayhLeWJlclJlc2VydmVJbnRlcmZhY2UgcmVzZXJ2ZSwgYm9vbCBhZGQpOwoKICAgIC8vLyBAbm90aWNlIGNhbiBiZSBjYWxsZWQgb25seSBieSBhZG1pbgogICAgLy8vIEBkZXYgYWRkIG9yIGRlbGV0ZXMgYSByZXNlcnZlIHRvL2Zyb20gdGhlIG5ldHdvcmsuCiAgICAvLy8gQHBhcmFtIHJlc2VydmUgVGhlIHJlc2VydmUgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkIElmIHRydWUsIHRoZSBhZGQgcmVzZXJ2ZS4gT3RoZXJ3aXNlIGRlbGV0ZSByZXNlcnZlLgogICAgZnVuY3Rpb24gYWRkUmVzZXJ2ZShLeWJlclJlc2VydmVJbnRlcmZhY2UgcmVzZXJ2ZSwgYm9vbCBhZGQpIHB1YmxpYyBvbmx5QWRtaW4gewoKICAgICAgICBpZiAoYWRkKSB7CiAgICAgICAgICAgIHJlcXVpcmUoIWlzUmVzZXJ2ZVtyZXNlcnZlXSk7CiAgICAgICAgICAgIHJlc2VydmVzLnB1c2gocmVzZXJ2ZSk7CiAgICAgICAgICAgIGlzUmVzZXJ2ZVtyZXNlcnZlXSA9IHRydWU7CiAgICAgICAgICAgIEFkZFJlc2VydmVUb05ldHdvcmsocmVzZXJ2ZSwgdHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXNSZXNlcnZlW3Jlc2VydmVdID0gZmFsc2U7CiAgICAgICAgICAgIC8vIHdpbGwgaGF2ZSB0cm91YmxlIGlmIG1vcmUgdGhhbiA1MGsgcmVzZXJ2ZXMuLi4KICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmVzZXJ2ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChyZXNlcnZlc1tpXSA9PSByZXNlcnZlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZXNbaV0gPSByZXNlcnZlc1tyZXNlcnZlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICByZXNlcnZlcy5sZW5ndGgtLTsKICAgICAgICAgICAgICAgICAgICBBZGRSZXNlcnZlVG9OZXR3b3JrKHJlc2VydmUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBldmVudCBMaXN0UmVzZXJ2ZVBhaXJzKGFkZHJlc3MgcmVzZXJ2ZSwgRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCBib29sIGFkZCk7CgogICAgLy8vIEBub3RpY2UgY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGFkbWluCiAgICAvLy8gQGRldiBhbGxvdyBvciBwcmV2ZW50IGEgc3BlY2lmaWMgcmVzZXJ2ZSB0byB0cmFkZSBhIHBhaXIgb2YgdG9rZW5zCiAgICAvLy8gQHBhcmFtIHJlc2VydmUgVGhlIHJlc2VydmUgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0IERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGFkZCBJZiB0cnVlIHRoZW4gZW5hYmxlIHRyYWRlLCBvdGhlcndpc2UgZGVsaXN0IHBhaXIuCiAgICBmdW5jdGlvbiBsaXN0UGFpckZvclJlc2VydmUoYWRkcmVzcyByZXNlcnZlLCBFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIGJvb2wgYWRkKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICAocGVyUmVzZXJ2ZUxpc3RlZFBhaXJzW3Jlc2VydmVdKVtrZWNjYWsyNTYoc3JjLCBkZXN0KV0gPSBhZGQ7CgogICAgICAgIGlmIChzcmMgIT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgaWYgKGFkZCkgewogICAgICAgICAgICAgICAgc3JjLmFwcHJvdmUocmVzZXJ2ZSwgMioqMjU1KTsgLy8gYXBwcm92ZSBpbmZpbml0eQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3JjLmFwcHJvdmUocmVzZXJ2ZSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNldERlY2ltYWxzKHNyYyk7CiAgICAgICAgc2V0RGVjaW1hbHMoZGVzdCk7CgogICAgICAgIExpc3RSZXNlcnZlUGFpcnMocmVzZXJ2ZSwgc3JjLCBkZXN0LCBhZGQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFBhcmFtcygKICAgICAgICBXaGl0ZUxpc3RJbnRlcmZhY2UgICAgX3doaXRlTGlzdCwKICAgICAgICBFeHBlY3RlZFJhdGVJbnRlcmZhY2UgX2V4cGVjdGVkUmF0ZSwKICAgICAgICBGZWVCdXJuZXJJbnRlcmZhY2UgICAgX2ZlZUJ1cm5lciwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgICAgX21heEdhc1ByaWNlLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgICBfbmVnbGlnaWJsZVJhdGVEaWZmCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUFkbWluCiAgICB7CiAgICAgICAgcmVxdWlyZShfd2hpdGVMaXN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2ZlZUJ1cm5lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9leHBlY3RlZFJhdGUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgd2hpdGVMaXN0Q29udHJhY3QgPSBfd2hpdGVMaXN0OwogICAgICAgIGV4cGVjdGVkUmF0ZUNvbnRyYWN0ID0gX2V4cGVjdGVkUmF0ZTsKICAgICAgICBmZWVCdXJuZXJDb250cmFjdCA9IF9mZWVCdXJuZXI7CiAgICAgICAgbWF4R2FzUHJpY2UgPSBfbWF4R2FzUHJpY2U7CiAgICAgICAgbmVnbGlnaWJsZVJhdGVEaWZmID0gX25lZ2xpZ2libGVSYXRlRGlmZjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRFbmFibGUoYm9vbCBfZW5hYmxlKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICBpZiAoX2VuYWJsZSkgewogICAgICAgICAgICByZXF1aXJlKHdoaXRlTGlzdENvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKGZlZUJ1cm5lckNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKGV4cGVjdGVkUmF0ZUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIH0KICAgICAgICBlbmFibGVkID0gX2VuYWJsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXROZXR3b3JrU3RhdGUodWludCBfbmV0d29ya1N0YXRlKSBwdWJsaWMgb25seU9wZXJhdG9yIHsKICAgICAgICBuZXR3b3JrU3RhdGUgPSBfbmV0d29ya1N0YXRlOwogICAgfQoKICAgIC8vLyBAZGV2IHJldHVybnMgbnVtYmVyIG9mIHJlc2VydmVzCiAgICAvLy8gQHJldHVybiBudW1iZXIgb2YgcmVzZXJ2ZXMKICAgIGZ1bmN0aW9uIGdldE51bVJlc2VydmVzKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJlc2VydmVzLmxlbmd0aDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBzaG91bGQgYmUgY2FsbGVkIG9mZiBjaGFpbiB3aXRoIGFzIG11Y2ggZ2FzIGFzIG5lZWRlZAogICAgLy8vIEBkZXYgZ2V0IGFuIGFycmF5IG9mIGFsbCByZXNlcnZlcwogICAgLy8vIEByZXR1cm4gQW4gYXJyYXkgb2YgYWxsIHJlc2VydmVzCiAgICBmdW5jdGlvbiBnZXRSZXNlcnZlcygpIHB1YmxpYyB2aWV3IHJldHVybnMoS3liZXJSZXNlcnZlSW50ZXJmYWNlW10pIHsKICAgICAgICByZXR1cm4gcmVzZXJ2ZXM7CiAgICB9CgogICAgLy8vIEBkZXYgZ2V0IHRoZSBiYWxhbmNlIG9mIGEgdXNlci4KICAgIC8vLyBAcGFyYW0gdG9rZW4gVGhlIHRva2VuIHR5cGUKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHVzZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGlmICh0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykKICAgICAgICAgICAgcmV0dXJuIHVzZXIuYmFsYW5jZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YodXNlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBiZXN0IGNvbnZlcnNpb24gcmF0ZSBmb3IgYSBwYWlyIG9mIHRva2VucywgaWYgbnVtYmVyIG9mIHJlc2VydmVzIGhhdmUgc21hbGwgZGlmZmVyZW5jZXMuIHJhbmRvbWl6ZQogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3QgRGVzdGluYXRpb24gdG9rZW4KICAgIC8qIHNvbGhpbnQtZGlzYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KICAgIGZ1bmN0aW9uIGZpbmRCZXN0UmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQpIHsKICAgICAgICB1aW50IGJlc3RSYXRlID0gMDsKICAgICAgICB1aW50IGJlc3RSZXNlcnZlID0gMDsKICAgICAgICB1aW50IG51bVJlbGV2YW50UmVzZXJ2ZXMgPSAwOwogICAgICAgIHVpbnQgbnVtUmVzZXJ2ZXMgPSByZXNlcnZlcy5sZW5ndGg7CiAgICAgICAgdWludFtdIG1lbW9yeSByYXRlcyA9IG5ldyB1aW50W10obnVtUmVzZXJ2ZXMpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgcmVzZXJ2ZUNhbmRpZGF0ZXMgPSBuZXcgdWludFtdKG51bVJlc2VydmVzKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtUmVzZXJ2ZXM7IGkrKykgewogICAgICAgICAgICAvL2xpc3QgYWxsIHJlc2VydmVzIHRoYXQgaGF2ZSB0aGlzIHRva2VuLgogICAgICAgICAgICBpZiAoIShwZXJSZXNlcnZlTGlzdGVkUGFpcnNbcmVzZXJ2ZXNbaV1dKVtrZWNjYWsyNTYoc3JjLCBkZXN0KV0pIGNvbnRpbnVlOwoKICAgICAgICAgICAgcmF0ZXNbaV0gPSByZXNlcnZlc1tpXS5nZXRDb252ZXJzaW9uUmF0ZShzcmMsIGRlc3QsIHNyY1F0eSwgYmxvY2subnVtYmVyKTsKCiAgICAgICAgICAgIGlmIChyYXRlc1tpXSA+IGJlc3RSYXRlKSB7CiAgICAgICAgICAgICAgICAvL2Jlc3QgcmF0ZSBpcyBoaWdoZXN0IHJhdGUKICAgICAgICAgICAgICAgIGJlc3RSYXRlID0gcmF0ZXNbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiZXN0UmF0ZSA+IDApIHsKICAgICAgICAgICAgdWludCByYW5kb20gPSAwOwogICAgICAgICAgICB1aW50IHNtYWxsZXN0UmVsZXZhbnRSYXRlID0gKGJlc3RSYXRlICogMTAwMDApIC8gKDEwMDAwICsgbmVnbGlnaWJsZVJhdGVEaWZmKTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1SZXNlcnZlczsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocmF0ZXNbaV0gPj0gc21hbGxlc3RSZWxldmFudFJhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXNlcnZlQ2FuZGlkYXRlc1tudW1SZWxldmFudFJlc2VydmVzKytdID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG51bVJlbGV2YW50UmVzZXJ2ZXMgPiAxKSB7CiAgICAgICAgICAgICAgICAvL3doZW4gZW5jb3VudGVyaW5nIHNtYWxsIHJhdGUgZGlmZiBmcm9tIGJlc3RSYXRlLiBkcmF3IGZyb20gcmVsZXZhbnQgcmVzZXJ2ZXMKICAgICAgICAgICAgICAgIHJhbmRvbSA9IHVpbnQoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSkgJSBudW1SZWxldmFudFJlc2VydmVzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBiZXN0UmVzZXJ2ZSA9IHJlc2VydmVDYW5kaWRhdGVzW3JhbmRvbV07CiAgICAgICAgICAgIGJlc3RSYXRlID0gcmF0ZXNbYmVzdFJlc2VydmVdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChiZXN0UmVzZXJ2ZSwgYmVzdFJhdGUpOwogICAgfQogICAgLyogc29saGludC1lbmFibGUgY29kZS1jb21wbGV4aXR5ICovCgogICAgZnVuY3Rpb24gZ2V0RXhwZWN0ZWRSYXRlKEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBzcmNRdHkpCiAgICAgICAgcHVibGljIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IGV4cGVjdGVkUmF0ZSwgdWludCBzbGlwcGFnZVJhdGUpCiAgICB7CiAgICAgICAgcmVxdWlyZShleHBlY3RlZFJhdGVDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXR1cm4gZXhwZWN0ZWRSYXRlQ29udHJhY3QuZ2V0RXhwZWN0ZWRSYXRlKHNyYywgZGVzdCwgc3JjUXR5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVc2VyQ2FwSW5XZWkoYWRkcmVzcyB1c2VyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gd2hpdGVMaXN0Q29udHJhY3QuZ2V0VXNlckNhcEluV2VpKHVzZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRvVHJhZGUoCiAgICAgICAgRVJDMjAgc3JjLAogICAgICAgIHVpbnQgc3JjQW1vdW50LAogICAgICAgIEVSQzIwIGRlc3QsCiAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICB1aW50IG1heERlc3RBbW91bnQsCiAgICAgICAgdWludCBtaW5Db252ZXJzaW9uUmF0ZSwKICAgICAgICBhZGRyZXNzIHdhbGxldElkCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSBtYXhHYXNQcmljZSk7CiAgICAgICAgcmVxdWlyZSh2YWxpZGF0ZVRyYWRlSW5wdXQoc3JjLCBzcmNBbW91bnQsIGRlc3RBZGRyZXNzKSk7CgogICAgICAgIHVpbnQgcmVzZXJ2ZUluZDsKICAgICAgICB1aW50IHJhdGU7CgogICAgICAgIChyZXNlcnZlSW5kLCByYXRlKSA9IGZpbmRCZXN0UmF0ZShzcmMsIGRlc3QsIHNyY0Ftb3VudCk7CiAgICAgICAgS3liZXJSZXNlcnZlSW50ZXJmYWNlIHRoZVJlc2VydmUgPSByZXNlcnZlc1tyZXNlcnZlSW5kXTsKICAgICAgICByZXF1aXJlKHJhdGUgPiAwKTsKICAgICAgICByZXF1aXJlKHJhdGUgPCBNQVhfUkFURSk7CiAgICAgICAgcmVxdWlyZShyYXRlID49IG1pbkNvbnZlcnNpb25SYXRlKTsKCiAgICAgICAgdWludCBhY3R1YWxTcmNBbW91bnQgPSBzcmNBbW91bnQ7CiAgICAgICAgdWludCBhY3R1YWxEZXN0QW1vdW50ID0gY2FsY0Rlc3RBbW91bnQoc3JjLCBkZXN0LCBhY3R1YWxTcmNBbW91bnQsIHJhdGUpOwogICAgICAgIGlmIChhY3R1YWxEZXN0QW1vdW50ID4gbWF4RGVzdEFtb3VudCkgewogICAgICAgICAgICBhY3R1YWxEZXN0QW1vdW50ID0gbWF4RGVzdEFtb3VudDsKICAgICAgICAgICAgYWN0dWFsU3JjQW1vdW50ID0gY2FsY1NyY0Ftb3VudChzcmMsIGRlc3QsIGFjdHVhbERlc3RBbW91bnQsIHJhdGUpOwogICAgICAgICAgICByZXF1aXJlKGFjdHVhbFNyY0Ftb3VudCA8PSBzcmNBbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgLy8gZG8gdGhlIHRyYWRlCiAgICAgICAgLy8gdmVyaWZ5IHRyYWRlIHNpemUgaXMgc21hbGxlciB0aGFuIHVzZXIgY2FwCiAgICAgICAgdWludCBldGhBbW91bnQ7CiAgICAgICAgaWYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBldGhBbW91bnQgPSBhY3R1YWxTcmNBbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXRoQW1vdW50ID0gYWN0dWFsRGVzdEFtb3VudDsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoZXRoQW1vdW50IDw9IGdldFVzZXJDYXBJbldlaShtc2cuc2VuZGVyKSk7CiAgICAgICAgcmVxdWlyZShkb1Jlc2VydmVUcmFkZSgKICAgICAgICAgICAgICAgIHNyYywKICAgICAgICAgICAgICAgIGFjdHVhbFNyY0Ftb3VudCwKICAgICAgICAgICAgICAgIGRlc3QsCiAgICAgICAgICAgICAgICBkZXN0QWRkcmVzcywKICAgICAgICAgICAgICAgIGFjdHVhbERlc3RBbW91bnQsCiAgICAgICAgICAgICAgICB0aGVSZXNlcnZlLAogICAgICAgICAgICAgICAgcmF0ZSwKICAgICAgICAgICAgICAgIHRydWUpKTsKCiAgICAgICAgaWYgKChhY3R1YWxTcmNBbW91bnQgPCBzcmNBbW91bnQpICYmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoc3JjQW1vdW50IC0gYWN0dWFsU3JjQW1vdW50KTsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoZmVlQnVybmVyQ29udHJhY3QuaGFuZGxlRmVlcyhldGhBbW91bnQsIHRoZVJlc2VydmUsIHdhbGxldElkKSk7CgogICAgICAgIEV4ZWN1dGVUcmFkZShtc2cuc2VuZGVyLCBzcmMsIGRlc3QsIGFjdHVhbFNyY0Ftb3VudCwgYWN0dWFsRGVzdEFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFjdHVhbERlc3RBbW91bnQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBkbyBvbmUgdHJhZGUgd2l0aCBhIHJlc2VydmUKICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHNyYyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gcmVzZXJ2ZSBSZXNlcnZlIHRvIHVzZQogICAgLy8vIEBwYXJhbSB2YWxpZGF0ZSBJZiB0cnVlLCBhZGRpdGlvbmFsIHZhbGlkYXRpb25zIGFyZSBhcHBsaWNhYmxlCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHRyYWRlIGlzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvUmVzZXJ2ZVRyYWRlKAogICAgICAgIEVSQzIwIHNyYywKICAgICAgICB1aW50IGFtb3VudCwKICAgICAgICBFUkMyMCBkZXN0LAogICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgdWludCBleHBlY3RlZERlc3RBbW91bnQsCiAgICAgICAgS3liZXJSZXNlcnZlSW50ZXJmYWNlIHJlc2VydmUsCiAgICAgICAgdWludCBjb252ZXJzaW9uUmF0ZSwKICAgICAgICBib29sIHZhbGlkYXRlCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgdWludCBjYWxsVmFsdWUgPSAwOwoKICAgICAgICBpZiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGNhbGxWYWx1ZSA9IGFtb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0YWtlIHNyYyB0b2tlbnMgdG8gdGhpcyBjb250cmFjdAogICAgICAgICAgICBzcmMudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIGFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXNlcnZlIHNlbmRzIHRva2Vucy9ldGggdG8gbmV0d29yay4gbmV0d29yayBzZW5kcyBpdCB0byBkZXN0aW5hdGlvbgogICAgICAgIHJlcXVpcmUocmVzZXJ2ZS50cmFkZS52YWx1ZShjYWxsVmFsdWUpKHNyYywgYW1vdW50LCBkZXN0LCB0aGlzLCBjb252ZXJzaW9uUmF0ZSwgdmFsaWRhdGUpKTsKCiAgICAgICAgaWYgKGRlc3QgPT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgZGVzdEFkZHJlc3MudHJhbnNmZXIoZXhwZWN0ZWREZXN0QW1vdW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKGRlc3QudHJhbnNmZXIoZGVzdEFkZHJlc3MsIGV4cGVjdGVkRGVzdEFtb3VudCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY0Rlc3RBbW91bnQoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY0Ftb3VudCwgdWludCByYXRlKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBjYWxjRHN0UXR5KHNyY0Ftb3VudCwgZ2V0RGVjaW1hbHMoc3JjKSwgZ2V0RGVjaW1hbHMoZGVzdCksIHJhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNTcmNBbW91bnQoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IGRlc3RBbW91bnQsIHVpbnQgcmF0ZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2FsY1NyY1F0eShkZXN0QW1vdW50LCBnZXREZWNpbWFscyhzcmMpLCBnZXREZWNpbWFscyhkZXN0KSwgcmF0ZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBjaGVja3MgdGhhdCB1c2VyIHNlbnQgZXRoZXIvdG9rZW5zIHRvIGNvbnRyYWN0IGJlZm9yZSB0cmFkZQogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIHNyY0Ftb3VudCBhbW91bnQgb2Ygc3JjIHRva2VucwogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpbnB1dCBpcyB2YWxpZAogICAgZnVuY3Rpb24gdmFsaWRhdGVUcmFkZUlucHV0KEVSQzIwIHNyYywgdWludCBzcmNBbW91bnQsIGFkZHJlc3MgZGVzdEFkZHJlc3MpIGludGVybmFsIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKChzcmNBbW91bnQgPj0gTUFYX1FUWSkgfHwgKHNyY0Ftb3VudCA9PSAwKSB8fCAoZGVzdEFkZHJlc3MgPT0gMCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBpZiAobXNnLnZhbHVlICE9IHNyY0Ftb3VudCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoKG1zZy52YWx1ZSAhPSAwKSB8fCAoc3JjLmFsbG93YW5jZShtc2cuc2VuZGVyLCB0aGlzKSA8IHNyY0Ftb3VudCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKY29udHJhY3QgV2hpdGVMaXN0SW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGdldFVzZXJDYXBJbldlaShhZGRyZXNzIHVzZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCB1c2VyQ2FwV2VpKTsKfQoKaW50ZXJmYWNlIEZlZUJ1cm5lckludGVyZmFjZSB7CiAgICBmdW5jdGlvbiBoYW5kbGVGZWVzICh1aW50IHRyYWRlV2VpQW1vdW50LCBhZGRyZXNzIHJlc2VydmUsIGFkZHJlc3Mgd2FsbGV0KSBwdWJsaWMgcmV0dXJucyhib29sKTsKfQ=='.
	

]
