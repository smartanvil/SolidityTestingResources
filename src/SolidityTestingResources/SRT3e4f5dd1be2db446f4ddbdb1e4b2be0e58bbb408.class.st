Class {
	#name : #SRT3e4f5dd1be2db446f4ddbdb1e4b2be0e58bbb408,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3e4f5dd1be2db446f4ddbdb1e4b2be0e58bbb408 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Ci8vIDxPUkFDTElaRV9BUEk+Ci8qCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTApDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFRECgoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKCgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCi8vIFRoaXMgYXBpIGlzIGN1cnJlbnRseSB0YXJnZXRlZCBhdCAwLjQuMTgsIHBsZWFzZSBpbXBvcnQgb3JhY2xpemVBUElfcHJlMC40LnNvbCBvciBvcmFjbGl6ZUFQSV8wLjQgd2hlcmUgbmVjZXNzYXJ5CgoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTikgcHVibGljIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04sIHVpbnQgX2dhc2xpbWl0KSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcHVibGljIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBwdWJsaWMgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhieXRlczMyKTsKfQpjb250cmFjdCBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgewogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHB1YmxpYyByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfQW5kcm9pZCA9IDB4MjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9MZWRnZXIgPSAweDMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTmF0aXZlID0gMHhGMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwoKICAgICAgICBpZihhZGRyZXNzKG9yYWNsaXplKSAhPSBPQVIuZ2V0QWRkcmVzcygpKQogICAgICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKCiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgcmV0dXJuIG9yYWNsaXplX3NldE5ldHdvcmsoKTsKICAgICAgbmV0d29ya0lEOyAvLyBzaWxlbmNlIHRoZSB3YXJuaW5nIGFuZCByZW1haW4gYmFja3dhcmRzIGNvbXBhdGlibGUKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsoKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfbWFpbm5ldCIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk+MCl7IC8vcm9wc3RlbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JvcHN0ZW4zIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX2tvdmFuIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KT4wKXsgLy9yaW5rZWJ5IHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcmlua2VieSIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik+MCl7IC8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSBwdWJsaWMgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSBwdWJsaWMgewogICAgICByZXR1cm47CiAgICAgIG15aWQ7IHJlc3VsdDsgcHJvb2Y7IC8vIFNpbGVuY2UgY29tcGlsZXIgd2FybmluZ3MKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2NiQWRkcmVzcygpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldFByb29mKGJ5dGUgcHJvb2ZQKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUucmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgZnVuY3Rpb24gYmEyY2JvcihieXRlc1tdIGFycikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKCiAgICBzdHJpbmcgb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29ya05hbWUoc3RyaW5nIF9uZXR3b3JrX25hbWUpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9uZXR3b3JrX25hbWUgPSBfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkodWludCBfZGVsYXksIHVpbnQgX25ieXRlcywgdWludCBfY3VzdG9tR2FzTGltaXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJlcXVpcmUoKF9uYnl0ZXMgPiAwKSAmJiAoX25ieXRlcyA8PSAzMikpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBuYnl0ZXMgPSBuZXcgYnl0ZXMoMSk7CiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsKICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBtc3RvcmUodW5vbmNlLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHVub25jZSwgMHgyMCksIHhvcihibG9ja2hhc2goc3ViKG51bWJlciwgMSkpLCB4b3IoY29pbmJhc2UsIHRpbWVzdGFtcCkpKQogICAgICAgICAgICBtc3RvcmUoc2Vzc2lvbktleUhhc2gsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2Vzc2lvbktleUhhc2gsIDB4MjApLCBzZXNzaW9uS2V5SGFzaF9ieXRlczMyKQogICAgICAgIH0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOwogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBrZWNjYWsyNTYoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID0gY29tbWl0bWVudDsKICAgIH0KCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJ5dGVzMzIpIG9yYWNsaXplX3JhbmRvbURTX2FyZ3M7CiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJvb2wpIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkOwoKICAgIGZ1bmN0aW9uIHZlcmlmeVNpZyhieXRlczMyIHRvc2lnbmgsIGJ5dGVzIGRlcnNpZywgYnl0ZXMgcHVia2V5KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIHNpZ29rOwogICAgICAgIGFkZHJlc3Mgc2lnbmVyOwoKICAgICAgICBieXRlczMyIHNpZ3I7CiAgICAgICAgYnl0ZXMzMiBzaWdzOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lncl8gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCsodWludChkZXJzaWdbM10pIC0gMHgyMCk7CiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3NfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOwogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0Kyh1aW50KGRlcnNpZ1tvZmZzZXQtMV0pIC0gMHgyMCksIDMyLCBzaWdzXywgMCk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CgoKICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjcsIHNpZ3IsIHNpZ3MpOwogICAgICAgIGlmIChhZGRyZXNzKGtlY2NhazI1NihwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moa2VjY2FrMjU2KHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CgogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFwcGtleTFfcHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrMSwgNjQsIGFwcGtleTFfcHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IGJ5dGUoMSk7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMrNjUrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMys2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOwoKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CgogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICByZXF1aXJlKChfcHJvb2ZbMF0gPT0gIkwiKSAmJiAoX3Byb29mWzFdID09ICJQIikgJiYgKF9wcm9vZlsyXSA9PSAxKSk7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICByZXF1aXJlKHByb29mVmVyaWZpZWQpOwoKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19yZXR1cm5Db2RlKGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIGludGVybmFsIHJldHVybnMgKHVpbnQ4KXsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIGlmICgoX3Byb29mWzBdICE9ICJMIil8fChfcHJvb2ZbMV0gIT0gIlAiKXx8KF9wcm9vZlsyXSAhPSAxKSkgcmV0dXJuIDE7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgcmV0dXJuIDI7CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCwgdWludCBuX3JhbmRvbV9ieXRlcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CiAgICAgICAgCgogICAgICAgIGZvciAodWludDI1NiBpPTA7IGk8IG5fcmFuZG9tX2J5dGVzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGlmICghKGtlY2NhazI1NihrZXloYXNoKSA9PSBrZWNjYWsyNTYoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGlmICghbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0LCB1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKzMyKzhdKSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwga2VjY2FrMjU2KGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrMzIsIDgrMSszMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCszMisoOCsxKzMyKStzaWcxLmxlbmd0aCs2NTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uUHVia2V5SGFzaCA9IHNoYTI1NihzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9PSBrZWNjYWsyNTYoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBpZiAoIXZlcmlmeVNpZyhzaGEyNTYodG9zaWduMSksIHNpZzEsIHNlc3Npb25QdWJrZXkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHZlcmlmeSBpZiBzZXNzaW9uUHVia2V5SGFzaCB3YXMgdmVyaWZpZWQgYWxyZWFkeSwgaWYgbm90Li4gbGV0J3MgZG8gaXQhCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9PSBmYWxzZSl7CiAgICAgICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkocHJvb2YsIHNpZzJvZmZzZXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgIHJlcXVpcmUodG8ubGVuZ3RoID49IG1pbkxlbmd0aCk7IC8vIFNob3VsZCBiZSBhIGJldHRlciB3YXk/CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCn0KLy8gPC9PUkFDTElaRV9BUEk+Ci8qCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4KICogQGF1dGhvciBOaWNrIEpvaG5zb24gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iOWFmYmU4ZmJmOWYyZjRmM2ZlZGFmNGY1ZWVmZWY1ZWViNGY0ZmZlZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CiAqCiAqIEBkZXYgRnVuY3Rpb25hbGl0eSBpbiB0aGlzIGxpYnJhcnkgaXMgbGFyZ2VseSBpbXBsZW1lbnRlZCB1c2luZyBhbgogKiAgICAgIGFic3RyYWN0aW9uIGNhbGxlZCBhICdzbGljZScuIEEgc2xpY2UgcmVwcmVzZW50cyBhIHBhcnQgb2YgYSBzdHJpbmcgLQogKiAgICAgIGFueXRoaW5nIGZyb20gdGhlIGVudGlyZSBzdHJpbmcgdG8gYSBzaW5nbGUgY2hhcmFjdGVyLCBvciBldmVuIG5vCiAqICAgICAgY2hhcmFjdGVycyBhdCBhbGwgKGEgMC1sZW5ndGggc2xpY2UpLiBTaW5jZSBhIHNsaWNlIG9ubHkgaGFzIHRvIHNwZWNpZnkKICogICAgICBhbiBvZmZzZXQgYW5kIGEgbGVuZ3RoLCBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgc2xpY2VzIGlzIGEgbG90IGxlc3MKICogICAgICBleHBlbnNpdmUgdGhhbiBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgdGhlIHN0cmluZ3MgdGhleSByZWZlcmVuY2UuCiAqCiAqICAgICAgVG8gZnVydGhlciByZWR1Y2UgZ2FzIGNvc3RzLCBtb3N0IGZ1bmN0aW9ucyBvbiBzbGljZSB0aGF0IG5lZWQgdG8gcmV0dXJuCiAqICAgICAgYSBzbGljZSBtb2RpZnkgdGhlIG9yaWdpbmFsIG9uZSBpbnN0ZWFkIG9mIGFsbG9jYXRpbmcgYSBuZXcgb25lOyBmb3IKICogICAgICBpbnN0YW5jZSwgYHMuc3BsaXQoIi4iKWAgd2lsbCByZXR1cm4gdGhlIHRleHQgdXAgdG8gdGhlIGZpcnN0ICcuJywKICogICAgICBtb2RpZnlpbmcgcyB0byBvbmx5IGNvbnRhaW4gdGhlIHJlbWFpbmRlciBvZiB0aGUgc3RyaW5nIGFmdGVyIHRoZSAnLicuCiAqICAgICAgSW4gc2l0dWF0aW9ucyB3aGVyZSB5b3UgZG8gbm90IHdhbnQgdG8gbW9kaWZ5IHRoZSBvcmlnaW5hbCBzbGljZSwgeW91CiAqICAgICAgY2FuIG1ha2UgYSBjb3B5IGZpcnN0IHdpdGggYC5jb3B5KClgLCBmb3IgZXhhbXBsZToKICogICAgICBgcy5jb3B5KCkuc3BsaXQoIi4iKWAuIFRyeSBhbmQgYXZvaWQgdXNpbmcgdGhpcyBpZGlvbSBpbiBsb29wczsgc2luY2UKICogICAgICBTb2xpZGl0eSBoYXMgbm8gbWVtb3J5IG1hbmFnZW1lbnQsIGl0IHdpbGwgcmVzdWx0IGluIGFsbG9jYXRpbmcgbWFueQogKiAgICAgIHNob3J0LWxpdmVkIHNsaWNlcyB0aGF0IGFyZSBsYXRlciBkaXNjYXJkZWQuCiAqCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgcmV0dXJuIHR3byBzbGljZXMgY29tZSBpbiB0d28gdmVyc2lvbnM6IGEgbm9uLWFsbG9jYXRpbmcKICogICAgICB2ZXJzaW9uIHRoYXQgdGFrZXMgdGhlIHNlY29uZCBzbGljZSBhcyBhbiBhcmd1bWVudCwgbW9kaWZ5aW5nIGl0IGluCiAqICAgICAgcGxhY2UsIGFuZCBhbiBhbGxvY2F0aW5nIHZlcnNpb24gdGhhdCBhbGxvY2F0ZXMgYW5kIHJldHVybnMgdGhlIHNlY29uZAogKiAgICAgIHNsaWNlOyBzZWUgYG5leHRSdW5lYCBmb3IgZXhhbXBsZS4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCBoYXZlIHRvIGNvcHkgc3RyaW5nIGRhdGEgd2lsbCByZXR1cm4gc3RyaW5ncyByYXRoZXIgdGhhbgogKiAgICAgIHNsaWNlczsgdGhlc2UgY2FuIGJlIGNhc3QgYmFjayB0byBzbGljZXMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZyBpZgogKiAgICAgIHJlcXVpcmVkLgogKgogKiAgICAgIEZvciBjb252ZW5pZW5jZSwgc29tZSBmdW5jdGlvbnMgYXJlIHByb3ZpZGVkIHdpdGggbm9uLW1vZGlmeWluZwogKiAgICAgIHZhcmlhbnRzIHRoYXQgY3JlYXRlIGEgbmV3IHNsaWNlIGFuZCByZXR1cm4gYm90aDsgZm9yIGluc3RhbmNlLAogKiAgICAgIGBzLnNwbGl0TmV3KCcuJylgIGxlYXZlcyBzIHVubW9kaWZpZWQsIGFuZCByZXR1cm5zIHR3byB2YWx1ZXMKICogICAgICBjb3JyZXNwb25kaW5nIHRvIHRoZSBsZWZ0IGFuZCByaWdodCBwYXJ0cyBvZiB0aGUgc3RyaW5nLgogKi8KIAoKCmxpYnJhcnkgc3RyaW5ncyB7CiAgICBzdHJ1Y3Qgc2xpY2UgewogICAgICAgIHVpbnQgX2xlbjsKICAgICAgICB1aW50IF9wdHI7CiAgICB9CgogICAgZnVuY3Rpb24gbWVtY3B5KHVpbnQgZGVzdCwgdWludCBzcmMsIHVpbnQgbGVuKSBwcml2YXRlIHsKICAgICAgICAvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShkZXN0LCBtbG9hZChzcmMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlc3QgKz0gMzI7CiAgICAgICAgICAgIHNyYyArPSAzMjsKICAgICAgICB9CgogICAgICAgIC8vIENvcHkgcmVtYWluaW5nIGJ5dGVzCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKHNyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykKICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc3RyaW5nIHRvIG1ha2UgYSBzbGljZSBmcm9tLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICovCiAgICBmdW5jdGlvbiB0b1NsaWNlKHN0cmluZyBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBvZiBhIG51bGwtdGVybWluYXRlZCBieXRlczMyIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSB2YWx1ZSB0byBmaW5kIHRoZSBsZW5ndGggb2YuCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHN0cmluZywgZnJvbSAwIHRvIDMyLgogICAgICovCiAgICBmdW5jdGlvbiBsZW4oYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCByZXQ7CiAgICAgICAgaWYgKHNlbGYgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDE2OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSA4OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSA0OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAyOwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMzIgLSByZXQ7CiAgICB9CgogCgoKICAgIC8qCiAgICAgKiBAZGV2IENvcGllcyBhIHNsaWNlIHRvIGEgbmV3IHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgc2xpY2UncyB0ZXh0LgogICAgICovCiAgICBmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBpbiBydW5lcyBvZiB0aGUgc2xpY2UuIE5vdGUgdGhhdCB0aGlzIG9wZXJhdGlvbgogICAgICogICAgICB0YWtlcyB0aW1lIHByb3BvcnRpb25hbCB0byB0aGUgbGVuZ3RoIG9mIHRoZSBzbGljZTsgYXZvaWQgdXNpbmcgaXQKICAgICAqICAgICAgaW4gbG9vcHMsIGFuZCBjYWxsIGBzbGljZS5lbXB0eSgpYCBpZiB5b3Ugb25seSBuZWVkIHRvIGtub3cgd2hldGhlcgogICAgICogICAgICB0aGUgc2xpY2UgaXMgZW1wdHkgb3Igbm90LgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHNsaWNlIGluIHJ1bmVzLgogICAgICovCiAgICBmdW5jdGlvbiBsZW4oc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCBsKSB7CiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0CiAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3B0ciAtIDMxOwogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47CiAgICAgICAgZm9yIChsID0gMDsgcHRyIDwgZW5kOyBsKyspIHsKICAgICAgICAgICAgdWludDggYjsKICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9CiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDM7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgewogICAgICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgewogICAgICAgICAgICAgICAgcHRyICs9IDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAgIC8qCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNudCkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwogICAgICAgIHdoaWxlIChwdHIgPD0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIGNudCsrOwogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICB9CiAgICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogICAgICovCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICB1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOwogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7CiAgICAgICAgZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsKICAgICAgICAgICAgdWludCBhOwogICAgICAgICAgICB1aW50IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikKICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEgIT0gYikgewogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICAgICAgICAgIHVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsKICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7CiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoZGlmZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsKICAgICAgICAgICAgb3RoZXJwdHIgKz0gMzI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsKICAgIH0KCgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOwogICAgfQoKCiAgICAvKgogICAgICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7CiAgICAgICAgaWYgKHNlbGYuX3B0ciAhPSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgbGVuZ3RoIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkKICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbmd0aCksIHNoYTMobmVlZGxlcHRyLCBsZW5ndGgpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgKz0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCgoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKGtlY2NhazI1NihzZWxmcHRyLCBsZW5ndGgpLCBrZWNjYWsyNTYobmVlZGxlcHRyLCBsZW5ndGgpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgdWludCBpZHg7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBsdChzdWIocHRyLCAxKSwgZW5kKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7CiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcHRyOwoKICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsKICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgewogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OSBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncwogICAgICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBsb29wOgogICAgICAgICAgICAgICAgICAgIGp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc3ViKHB0ciwgMSkKICAgICAgICAgICAgICAgICAgICBqdW1waShsb29wLCBndChhZGQocHRyLCAxKSwgc2VsZnB0cikpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHIKICAgICAgICAgICAgICAgICAgICBqdW1wKGV4aXQpCiAgICAgICAgICAgICAgICAgICAgcmV0OgogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCBuZWVkbGVsZW4pCiAgICAgICAgICAgICAgICAgICAgZXhpdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyAoc2VsZmxlbiAtIG5lZWRsZWxlbik7CiAgICAgICAgICAgICAgICB3aGlsZSAocHRyID49IHNlbGZwdHIpIHsKICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOwogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyICsgbmVlZGxlbGVuOwogICAgICAgICAgICAgICAgICAgIHB0ciAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmcHRyOwogICAgfQoKCgoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsKICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewogICAgICAgIHNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKCgoKICAgIC8qCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQogICAgICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLAogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gIiI7CgogICAgICAgIHVpbnQgbGVuZ3RoID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGxlbmd0aCArPSBwYXJ0c1tpXS5fbGVuOwoKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhsZW5ndGgpOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIGZvcihpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOwogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsKICAgICAgICAgICAgaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQp9CgovLyBzdGFydCBvZiBzYXRvc2hpIGZ1dHVyZXMgY29udHJhY3QKCmNvbnRyYWN0IFNhdG9zaGlGdXR1cmVzIGlzIHVzaW5nT3JhY2xpemUgewogICAgdXNpbmcgc3RyaW5ncyBmb3IgKjsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciAqOwoKICAgIAogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSAweDA0N2Y2MDZmZDViMmJhYTVmNWM2YzRhYjg5NThlNDVjYjZiMDU0Yjc7CiAgICB1aW50IHB1YmxpYyBhbGxPcGVuVHJhZGVzQW1vdW50cyA9IDA7CiAgICB1aW50IHNhZmVHYXMgPSAyMzAwOwogICAgdWludCBjb25zdGFudCBPUkFDTElaRV9HQVNfTElNSVQgPSAzMDAwMDA7CiAgICBib29sIHB1YmxpYyAgaXNTdG9wcGVkID0gZmFsc2U7CiAgICB1aW50IHB1YmxpYyBvd25lckZlZSA9IDM7CiAgICB1aW50IHB1YmxpYyBjdXJyZW50UHJvZml0UGN0ID0gNzA7CiAgICB1aW50IHB1YmxpYyBtaW5UcmFkZSA9IDEwIGZpbm5leTsKICAgIGJvb2wgcHVibGljIGVtZXJnZW5jeVdpdGhkcmF3YWxBY3RpdmF0ZWQgPSBmYWxzZTsKICAgIHVpbnQgcHVibGljIHRyYWRlc0NvdW50ID0gMDsKICAgCiAgICAKCiAgICBzdHJ1Y3QgVHJhZGUgewogICAgICAgIGFkZHJlc3MgaW52ZXN0b3I7CiAgICAgICAgdWludCBhbW91bnRJbnZlc3RlZDsKICAgICAgICB1aW50IGluaXRpYWxQcmljZTsKICAgICAgICB1aW50IGZpbmFsUHJpY2U7CiAgICAgICAgc3RyaW5nIGNvaW5TeW1ib2w7CiAgICAgICAgc3RyaW5nIHB1dE9yQ2FsbDsKICAgIH0KCiAgICBzdHJ1Y3QgVHJhZGVTdGF0cyB7CiAgICAgICAgdWludCBpbml0aWFsVGltZTsKICAgICAgICB1aW50IGZpbmFsVGltZTsKICAgICAgICBib29sIHJlc29sdmVkOwogICAgICAgIHVpbnQgdHJhZGVQZXJpb2Q7CiAgICAgICAgYm9vbCB3b25Pckxvc3Q7CiAgICAgICAgc3RyaW5nIHF1ZXJ5OwogICAgfQoKICAgIHN0cnVjdCBJbnZlc3RvciB7CiAgICAgICAgYWRkcmVzcyBpbnZlc3RvckFkZHJlc3M7CiAgICAgICAgdWludCBiYWxhbmNlVG9QYXlvdXQ7CiAgICAgICAgYm9vbCB3aXRoZHJldzsKICAgIH0KICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RvcklEczsKICAgIG1hcHBpbmcodWludCA9PiBJbnZlc3RvcikgcHVibGljIGludmVzdG9yczsKICAgIHVpbnQgcHVibGljIG51bUludmVzdG9ycyA9IDA7CgoKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBUcmFkZSkgcHVibGljIHRyYWRlczsKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBUcmFkZVN0YXRzKSBwdWJsaWMgdHJhZGVzU3RhdHM7CiAgICBtYXBwaW5nKHVpbnQgPT4gYnl0ZXMzMikgcHVibGljIHRyYWRlc0lkczsgCiAgICAKICAgIGV2ZW50IExPR19NYXhUcmFkZUFtb3VudENoYW5nZWQodWludCBtYXhUcmFkZUFtb3VudCk7CiAgICBldmVudCBMT0dfTmV3VHJhZGVDcmVhdGVkKGJ5dGVzMzIgdHJhZGVJZCwgYWRkcmVzcyBpbnZlc3Rvcik7CiAgICBldmVudCBMT0dfQ29udHJhY3RTdG9wcGVkKHN0cmluZyBzdGF0dXMpOwogICAgZXZlbnQgTE9HX093bmVyQWRkcmVzc0NoYW5nZWQoYWRkcmVzcyBvbGRBZGRyLCBhZGRyZXNzIG5ld093bmVyQWRkcmVzcyk7CiAgICBldmVudCBMT0dfVHJhZGVXb24gKGFkZHJlc3MgaW52ZXN0b3JBZGRyZXNzLCB1aW50IGFtb3VudEludmVzdGVkLCBieXRlczMyIHRyYWRlSWQsIHVpbnQgX3N0YXJ0VHJhZGUsIHVpbnQgX2VuZFRyYWRlLCB1aW50IF9zdGFydFByaWNlLCB1aW50IF9lbmRQcmljZSwgc3RyaW5nIF9jb2luU3ltYm9sLCB1aW50IF9wY3RUb0dhaW4sIHN0cmluZyBfcXVlcnlVcmwpOwogICAgZXZlbnQgTE9HX1RyYWRlTG9zdChhZGRyZXNzIGludmVzdG9yQWRkcmVzcywgdWludCBhbW91bnRJbnZlc3RlZCwgYnl0ZXMzMiB0cmFkZUlkLCB1aW50IF9zdGFydFRyYWRlLCB1aW50IF9lbmRUcmFkZSwgdWludCBfc3RhcnRQcmljZSwgdWludCBfZW5kUHJpY2UsIHN0cmluZyBfY29pblN5bWJvbCwgdWludCBfcGN0VG9HYWluLCBzdHJpbmcgX3F1ZXJ5VXJsKTsKICAgIGV2ZW50IExPR19UcmFkZURyYXcoYWRkcmVzcyBpbnZlc3RvckFkZHJlc3MsIHVpbnQgYW1vdW50SW52ZXN0ZWQsIGJ5dGVzMzIgdHJhZGVJZCwgdWludCBfc3RhcnRUcmFkZSwgdWludCBfZW5kVHJhZGUsIHVpbnQgX3N0YXJ0UHJpY2UsIHVpbnQgX2VuZFByaWNlLCBzdHJpbmcgX2NvaW5TeW1ib2wsIHVpbnQgX3BjdFRvR2Fpbiwgc3RyaW5nIF9xdWVyeVVybCk7CiAgICBldmVudCBMT0dfR2FzTGltaXRDaGFuZ2VkKHVpbnQgb2xkR2FzTGltaXQsIHVpbnQgbmV3R2FzTGltaXQpOwoKCiAgICAvL0NPTlNUUlVDVE9SIEZVTkNUSU9OCiAgICAKCiAgICAvL1NFQ1RJT04gSTogTU9ESUZJRVJTIEFORCBIRUxQRVIgRlVOQ1RJT05TCiAgICAKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlPcmFjbGl6ZSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9yYWNsaXplX2NiQWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5SWZWYWxpZEdhcyh1aW50IG5ld0dhc0xpbWl0KSB7CiAgICAgICAgcmVxdWlyZShPUkFDTElaRV9HQVNfTElNSVQgKyBuZXdHYXNMaW1pdCA+IE9SQUNMSVpFX0dBU19MSU1JVCk7CiAgICAgICAgcmVxdWlyZShuZXdHYXNMaW1pdCA+IDI1MDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlJZk5vdFN0b3BwZWQgewogICAgICByZXF1aXJlKCFpc1N0b3BwZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmU3RvcHBlZCB7CiAgICAgIHJlcXVpcmUoaXNTdG9wcGVkKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5SWZUcmFkZUV4aXN0cyhieXRlczMyIG15aWQpIHsKICAgICAgICByZXF1aXJlKHRyYWRlc1tteWlkXS5pbnZlc3RvciAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmVHJhZGVVbnJlc29sdmVkKGJ5dGVzMzIgbXlpZCkgewogICAgICAgIHJlcXVpcmUodHJhZGVzU3RhdHNbbXlpZF0ucmVzb2x2ZWQgIT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZFbm91Z2hCYWxhbmNlVG9QYXlPdXQodWludCBfYW1vdW50SW52ZXN0ZWQpIHsKICAgICAgICByZXF1aXJlKCBfYW1vdW50SW52ZXN0ZWQgPCBnZXRNYXhUcmFkZUFtb3VudCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJbnZlc3RvcnMgewogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl0gIT0gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seU5vdEludmVzdG9ycyB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSA9PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEludmVzdG9yQXRJRCh1aW50IGlkKQogICAgb25seU5vdEludmVzdG9ycwogICAgICAgIHByaXZhdGUgewogICAgICAgIGludmVzdG9ySURzW21zZy5zZW5kZXJdID0gaWQ7CiAgICAgICAgaW52ZXN0b3JzW2lkXS5pbnZlc3RvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5SWZWYWxpZFRyYWRlUGVyaW9kKHVpbnQgdHJhZGVQZXJpb2QpIHsKICAgICAgICByZXF1aXJlKHRyYWRlUGVyaW9kIDw9IDMwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZlRyYWRlVGltZUVuZGVkKHVpbnQgX2VuZFRpbWUpIHsKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA+IF9lbmRUaW1lKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5TW9yZVRoYW5NaW5UcmFkZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5UcmFkZSk7CiAgICAgICAgXzsKICAgIH0KICAgIGZ1bmN0aW9uIGdldE1heFRyYWRlQW1vdW50KCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgTE9HX01heFRyYWRlQW1vdW50Q2hhbmdlZCgodGhpcy5iYWxhbmNlIC0gYWxsT3BlblRyYWRlc0Ftb3VudHMpICogMTAwL2N1cnJlbnRQcm9maXRQY3QpOwogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IGFsbE9wZW5UcmFkZXNBbW91bnRzKTsKICAgICAgICByZXR1cm4gKCh0aGlzLmJhbGFuY2UgLSBhbGxPcGVuVHJhZGVzQW1vdW50cykgKiAxMDAvY3VycmVudFByb2ZpdFBjdCk7CiAgICB9CgogICAgCiAgICAvLyBTRUNUSU9OIElJOiBUUkFERVMgJiBUUkFERSBQUk9DRVNTSU5HCiAgICAgCiAgICAgLyoKICAgICAqIEBkZXYgQWRkIG1vbmV5IHRvIHRoZSBjb250cmFjdCBpbiBjYXNlIGJhbGFuY2UgZ29lcyB0byAwLgogICAgICovCiAgICAKCiAgICBmdW5jdGlvbiBhZGRNb25leVRvQ29udHJhY3QoKSBwYXlhYmxlIHJldHVybnModWludCkgewogICAgICAgIC8vdG8gYWRkIGJhbGFuY2UgdG8gdGhlIGNvbnRyYWN0IHNvIHRyYWRlcyBhcmUgcG9zaWJsZQogICAgICAgIHJldHVybiBtc2cudmFsdWU7CiAgICAgICAgZ2V0TWF4VHJhZGVBbW91bnQoKTsKICAgIH0KCgogICAgIC8qCiAgICAgKiBAZGV2IEluaXRpYXRlIGEgdHJhZGUgYnkgcHJvdmlkaW5nIGFsbCB0aGUgcmlnaHQgcGFyYW1zLgogICAgICovCgogICAgZnVuY3Rpb24gc3RhcnRUcmFkZShzdHJpbmcgX2NvaW5TeW1ib2wsIHVpbnQgX3RyYWRlUGVyaW9kLCBib29sIF9wdXRPckNhbGwpIAogICAgICAgIHBheWFibGUgCiAgICAgICAgb25seUlmTm90U3RvcHBlZAogICAgICAgIC8vIG9ubHlJZlJpZ2h0Q29pbkNob29zZW4oX2NvaW5TeW1ib2wpCiAgICAgICAgb25seU1vcmVUaGFuTWluVHJhZGUgCiAgICAgICAgb25seUlmVmFsaWRUcmFkZVBlcmlvZChfdHJhZGVQZXJpb2QpCiAgICAgICAgb25seUlmRW5vdWdoQmFsYW5jZVRvUGF5T3V0KG1zZy52YWx1ZSkgewogICAgICAgIHN0cmluZyBtZW1vcnkgc2VyaWFsaXplUHV0T3JDYWxsOyAKICAgICAgICBpZihfcHV0T3JDYWxsID09IHRydWUpIHsKICAgICAgICAgICAgc2VyaWFsaXplUHV0T3JDYWxsID0gInB1dCI7CiAgICAgICAgfSBlbHNlICB7CiAgICAgICAgICAgIHNlcmlhbGl6ZVB1dE9yQ2FsbCA9ICJjYWxsIjsKICAgICAgICB9CiAgICAgICAgdmFyIGZpbmFsVGltZSA9IGJsb2NrLnRpbWVzdGFtcCArICgoX3RyYWRlUGVyaW9kICsgMSkgKiA2MCk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBxdWVyeVVybCA9IGdlbmVyYXRlVXJsKF9jb2luU3ltYm9sLCBibG9jay50aW1lc3RhbXAsICBfdHJhZGVQZXJpb2QgKTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeShibG9jay50aW1lc3RhbXAgKyAoKF90cmFkZVBlcmlvZCArIDUpICogNjApLCAiVVJMIiwgcXVlcnlVcmwsT1JBQ0xJWkVfR0FTX0xJTUlUICsgc2FmZUdhcyk7CiAgICAgICAgdmFyIHRoaXNUcmFkZSA9IHRyYWRlc1txdWVyeUlkXTsKICAgICAgICB2YXIgdGhpc1RyYWRlU3RhdHMgPSB0cmFkZXNTdGF0c1txdWVyeUlkXTsKICAgICAgICB0aGlzVHJhZGUuaW52ZXN0b3IgPSBtc2cuc2VuZGVyOwogICAgICAgIHRoaXNUcmFkZS5hbW91bnRJbnZlc3RlZCA9IG1zZy52YWx1ZSAtIChtc2cudmFsdWUgKiBvd25lckZlZSAvIDEwMCApOyAKICAgICAgICB0aGlzVHJhZGUuaW5pdGlhbFByaWNlID0gMDsgCiAgICAgICAgdGhpc1RyYWRlLmZpbmFsUHJpY2UgPSAwOyAKICAgICAgICB0aGlzVHJhZGUuY29pblN5bWJvbCA9IF9jb2luU3ltYm9sOyAKICAgICAgICB0aGlzVHJhZGVTdGF0cy50cmFkZVBlcmlvZCA9IF90cmFkZVBlcmlvZDsgCiAgICAgICAgdGhpc1RyYWRlLnB1dE9yQ2FsbCA9IHNlcmlhbGl6ZVB1dE9yQ2FsbDsgCiAgICAgICAgdGhpc1RyYWRlU3RhdHMud29uT3JMb3N0ID0gZmFsc2U7IAogICAgICAgIHRoaXNUcmFkZVN0YXRzLmluaXRpYWxUaW1lID0gYmxvY2sudGltZXN0YW1wOyAKICAgICAgICB0aGlzVHJhZGVTdGF0cy5maW5hbFRpbWUgPSBmaW5hbFRpbWUgLSA2MDsgCiAgICAgICAgdGhpc1RyYWRlU3RhdHMucmVzb2x2ZWQgPSBmYWxzZTsgCiAgICAgICAgdGhpc1RyYWRlU3RhdHMucXVlcnkgPSBxdWVyeVVybDsgCiAgICAgICAgYWxsT3BlblRyYWRlc0Ftb3VudHMgKz0gdGhpc1RyYWRlLmFtb3VudEludmVzdGVkICsgKCh0aGlzVHJhZGUuYW1vdW50SW52ZXN0ZWQgKiBjdXJyZW50UHJvZml0UGN0KSAvIDEwMCk7CiAgICAgICAgdHJhZGVzSWRzW3RyYWRlc0NvdW50KytdID0gcXVlcnlJZDsKICAgICAgICBvd25lci50cmFuc2Zlcihtc2cudmFsdWUgICogb3duZXJGZWUgLyAxMDApOyAKICAgICAgICBnZXRNYXhUcmFkZUFtb3VudCgpOwogICAgICAgIGlmIChpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgICAgICAgbnVtSW52ZXN0b3JzKys7CiAgICAgICAgICAgYWRkSW52ZXN0b3JBdElEKG51bUludmVzdG9ycyk7IAogICAgICAgIH0gCiAgICAgICAgCiAgICAgICAgTE9HX05ld1RyYWRlQ3JlYXRlZChxdWVyeUlkLCB0aGlzVHJhZGUuaW52ZXN0b3IpOwoKICAgIH0KCiAgICAvLyBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHB1YmxpYyB7CiAgICAvLyAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQpOwogICAgLy8gfQogICAgCgogICAgIC8qCiAgICAgKiBAZGV2IENhbGxiYWNrIGZ1bmN0aW9uIGZyb20gb3JhY2xpemUgYWZ0ZXIgdGhlIHRyYWRlIHBlcmlvZCBpcyBvdmVyLgogICAgICogdXBkYXRlcyB0cmFkZSBpbml0aWFsIGFuZCBmaW5hbCBwcmljZSBhbmQgdGhhbiBjYWxscyB0aGUgcmVzb2x2ZSB0cmFkZSBmdW5jdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKQogICAgICAgIG9ubHlPcmFjbGl6ZSAKICAgICAgICBvbmx5SWZUcmFkZUV4aXN0cyhteWlkKQogICAgICAgIG9ubHlJZlRyYWRlVW5yZXNvbHZlZChteWlkKSB7CiAgICAgICAgdmFyIHMgPSByZXN1bHQudG9TbGljZSgpOwogICAgICAgIHZhciBkID0gcy5iZXlvbmQoIlsiLnRvU2xpY2UoKSkudW50aWwoIl0iLnRvU2xpY2UoKSk7CiAgICAgICAgdmFyIGRlbGltID0gIiwiLnRvU2xpY2UoKTsKICAgICAgICB2YXIgcGFydHMgPSBuZXcgc3RyaW5nW10oZC5jb3VudChkZWxpbSkgKyAxICk7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcGFydHNbaV0gPSBkLnNwbGl0KGRlbGltKS50b1N0cmluZygpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0cmFkZXNbbXlpZF0uaW5pdGlhbFByaWNlID0gcGFyc2VJbnQocGFydHNbMF0sNCk7CiAgICAgICAgdHJhZGVzW215aWRdLmZpbmFsUHJpY2UgPSBwYXJzZUludChwYXJ0c1t0cmFkZXNTdGF0c1tteWlkXS50cmFkZVBlcmlvZF0sNCk7CiAgICAgICAgcmVzb2x2ZVRyYWRlKG15aWQpOyAgICAgICAgIAogICAgfQogICAgCgogICAgIC8qCiAgICAgKiBAZGV2IFJlc29sdmVzIHRoZSB0cmFkZSBiYXNlZCBvbiB0aGUgaW5pdGlhbCBhbmQgZmluYWwgYW1vdW50LAogICAgICogZGVwZW5kaW5nIGlmIHB1dCBvciBjYWxsIHdlcmUgY2hvc2VuLCBpZiBpdHMgYSBkcmF3IHRoZSBtb25leSBnb2VzIGJhY2sKICAgICAqIHRvIGludmVzdG9yLgogICAgICovCiAgICBmdW5jdGlvbiByZXNvbHZlVHJhZGUoYnl0ZXMzMiBfbXlJZCkgaW50ZXJuYWwKICAgIG9ubHlJZlRyYWRlRXhpc3RzKF9teUlkKQogICAgb25seUlmVHJhZGVVbnJlc29sdmVkKF9teUlkKQogICAgb25seUlmVHJhZGVUaW1lRW5kZWQodHJhZGVzU3RhdHNbX215SWRdLmZpbmFsVGltZSkKICAgICAgICB7CiAgICB0cmFkZXNTdGF0c1tfbXlJZF0ucmVzb2x2ZWQgPSB0cnVlOyAgICAKICAgIGlmKHRyYWRlc1tfbXlJZF0uaW5pdGlhbFByaWNlID09IHRyYWRlc1tfbXlJZF0uZmluYWxQcmljZSkgewogICAgICAgIHRyYWRlc1tfbXlJZF0uaW52ZXN0b3IudHJhbnNmZXIodHJhZGVzW19teUlkXS5hbW91bnRJbnZlc3RlZCk7CiAgICAgICAgTE9HX1RyYWRlRHJhdyh0cmFkZXNbX215SWRdLmludmVzdG9yLCB0cmFkZXNbX215SWRdLmFtb3VudEludmVzdGVkLF9teUlkLCB0cmFkZXNTdGF0c1tfbXlJZF0uaW5pdGlhbFRpbWUsIHRyYWRlc1N0YXRzW19teUlkXS5maW5hbFRpbWUsIHRyYWRlc1tfbXlJZF0uaW5pdGlhbFByaWNlLCB0cmFkZXNbX215SWRdLmZpbmFsUHJpY2UsIHRyYWRlc1tfbXlJZF0uY29pblN5bWJvbCwgY3VycmVudFByb2ZpdFBjdCwgdHJhZGVzU3RhdHNbX215SWRdLnF1ZXJ5KTsKICAgICAgICB9CiAgICAgaWYodHJhZGVzW19teUlkXS5wdXRPckNhbGwudG9TbGljZSgpLmVxdWFscygicHV0Ii50b1NsaWNlKCkpKSB7IAogICAgICAgICBpZih0cmFkZXNbX215SWRdLmluaXRpYWxQcmljZSA+IHRyYWRlc1tfbXlJZF0uZmluYWxQcmljZSkgewogICAgICAgICAgICB0cmFkZXNTdGF0c1tfbXlJZF0ud29uT3JMb3N0ID0gdHJ1ZTsKICAgICAgICAgICAgdHJhZGVzW19teUlkXS5pbnZlc3Rvci50cmFuc2Zlcih0cmFkZXNbX215SWRdLmFtb3VudEludmVzdGVkICsgKCh0cmFkZXNbX215SWRdLmFtb3VudEludmVzdGVkICogY3VycmVudFByb2ZpdFBjdCkgLyAxMDApKTsgCiAgICAgICAgICAgIExPR19UcmFkZVdvbih0cmFkZXNbX215SWRdLmludmVzdG9yLCB0cmFkZXNbX215SWRdLmFtb3VudEludmVzdGVkLF9teUlkLCB0cmFkZXNTdGF0c1tfbXlJZF0uaW5pdGlhbFRpbWUsIHRyYWRlc1N0YXRzW19teUlkXS5maW5hbFRpbWUsIHRyYWRlc1tfbXlJZF0uaW5pdGlhbFByaWNlLCB0cmFkZXNbX215SWRdLmZpbmFsUHJpY2UsIHRyYWRlc1tfbXlJZF0uY29pblN5bWJvbCwgY3VycmVudFByb2ZpdFBjdCwgdHJhZGVzU3RhdHNbX215SWRdLnF1ZXJ5KTsKICAgICAgICB9CiAgICAgICAgaWYodHJhZGVzW19teUlkXS5pbml0aWFsUHJpY2UgPCB0cmFkZXNbX215SWRdLmZpbmFsUHJpY2UpIHsKICAgICAgICAgICAgdHJhZGVzU3RhdHNbX215SWRdLndvbk9yTG9zdCA9IGZhbHNlOwogICAgICAgICAgICB0cmFkZXNbX215SWRdLmludmVzdG9yLnRyYW5zZmVyKDEpOyAKICAgICAgICAgICAgTE9HX1RyYWRlTG9zdCh0cmFkZXNbX215SWRdLmludmVzdG9yLCB0cmFkZXNbX215SWRdLmFtb3VudEludmVzdGVkLF9teUlkLCB0cmFkZXNTdGF0c1tfbXlJZF0uaW5pdGlhbFRpbWUsIHRyYWRlc1N0YXRzW19teUlkXS5maW5hbFRpbWUsIHRyYWRlc1tfbXlJZF0uaW5pdGlhbFByaWNlLCB0cmFkZXNbX215SWRdLmZpbmFsUHJpY2UsIHRyYWRlc1tfbXlJZF0uY29pblN5bWJvbCwgY3VycmVudFByb2ZpdFBjdCwgdHJhZGVzU3RhdHNbX215SWRdLnF1ZXJ5KTsKICAgICAgICB9ICAgIAogICAgIH0KCiAgICAgaWYodHJhZGVzW19teUlkXS5wdXRPckNhbGwudG9TbGljZSgpLmVxdWFscygiY2FsbCIudG9TbGljZSgpKSkgeyAKICAgICAgICAgaWYodHJhZGVzW19teUlkXS5pbml0aWFsUHJpY2UgPCB0cmFkZXNbX215SWRdLmZpbmFsUHJpY2UpIHsKICAgICAgICAgICAgdHJhZGVzU3RhdHNbX215SWRdLndvbk9yTG9zdCA9IHRydWU7CiAgICAgICAgICAgIHRyYWRlc1tfbXlJZF0uaW52ZXN0b3IudHJhbnNmZXIodHJhZGVzW19teUlkXS5hbW91bnRJbnZlc3RlZCArICgodHJhZGVzW19teUlkXS5hbW91bnRJbnZlc3RlZCAqIGN1cnJlbnRQcm9maXRQY3QpIC8gMTAwKSk7IAogICAgICAgICAgICBMT0dfVHJhZGVXb24odHJhZGVzW19teUlkXS5pbnZlc3RvciwgdHJhZGVzW19teUlkXS5hbW91bnRJbnZlc3RlZCxfbXlJZCwgdHJhZGVzU3RhdHNbX215SWRdLmluaXRpYWxUaW1lLCB0cmFkZXNTdGF0c1tfbXlJZF0uZmluYWxUaW1lLCB0cmFkZXNbX215SWRdLmluaXRpYWxQcmljZSwgdHJhZGVzW19teUlkXS5maW5hbFByaWNlLCB0cmFkZXNbX215SWRdLmNvaW5TeW1ib2wsIGN1cnJlbnRQcm9maXRQY3QsIHRyYWRlc1N0YXRzW19teUlkXS5xdWVyeSk7CiAgICAgICAgfQogICAgICAgIGlmKHRyYWRlc1tfbXlJZF0uaW5pdGlhbFByaWNlID4gdHJhZGVzW19teUlkXS5maW5hbFByaWNlKSB7CiAgICAgICAgICAgIHRyYWRlc1N0YXRzW19teUlkXS53b25Pckxvc3QgPSBmYWxzZTsKICAgICAgICAgICAgdHJhZGVzW19teUlkXS5pbnZlc3Rvci50cmFuc2ZlcigxKTsgCiAgICAgICAgICAgIExPR19UcmFkZUxvc3QodHJhZGVzW19teUlkXS5pbnZlc3RvciwgdHJhZGVzW19teUlkXS5hbW91bnRJbnZlc3RlZCxfbXlJZCwgdHJhZGVzU3RhdHNbX215SWRdLmluaXRpYWxUaW1lLCB0cmFkZXNTdGF0c1tfbXlJZF0uZmluYWxUaW1lLCB0cmFkZXNbX215SWRdLmluaXRpYWxQcmljZSwgdHJhZGVzW19teUlkXS5maW5hbFByaWNlLCB0cmFkZXNbX215SWRdLmNvaW5TeW1ib2wsIGN1cnJlbnRQcm9maXRQY3QsIHRyYWRlc1N0YXRzW19teUlkXS5xdWVyeSk7CiAgICAgICAgfQogICAgIH0KICAgIGFsbE9wZW5UcmFkZXNBbW91bnRzIC09IHRyYWRlc1tfbXlJZF0uYW1vdW50SW52ZXN0ZWQgKyAoKHRyYWRlc1tfbXlJZF0uYW1vdW50SW52ZXN0ZWQgKiBjdXJyZW50UHJvZml0UGN0KSAvIDEwMCk7CiAgICBnZXRNYXhUcmFkZUFtb3VudCgpOwoKICAgIH0KICAKICAgCgogICAgLyoKICAgICAqIEBkZXYgR2VuZXJhdGUgdGhlIHVybCBmb3IgdGhlIGFwaSBjYWxsIGZvciBvcmFjbGl6ZS4KICAgICAqLwogICBmdW5jdGlvbiBnZW5lcmF0ZVVybChzdHJpbmcgX2NvaW5DaG9zZW4sIHVpbnQgX3RpbWVzU3RhcnRUcmFkZSAsdWludCBfdHJhZGVQZXJpb2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHN0cmluZ3Muc2xpY2VbXSBtZW1vcnkgcGFydHMgPSBuZXcgc3RyaW5ncy5zbGljZVtdKDExKTsKICAgICAgICBwYXJ0c1swXSA9ICJqc29uKGh0dHBzOi8vYXBpLmNyeXB0b3dhdC5jaC9tYXJrZXRzL2JpdGZpbmV4LyIudG9TbGljZSgpOwogICAgICAgIHBhcnRzWzFdID0gX2NvaW5DaG9zZW4udG9TbGljZSgpOwogICAgICAgIHBhcnRzWzJdID0gIi9vaGxjP3BlcmlvZHM9NjAmYWZ0ZXI9Ii50b1NsaWNlKCk7CiAgICAgICAgcGFydHNbM10gPSB1aW50MnN0cihfdGltZXNTdGFydFRyYWRlKS50b1NsaWNlKCk7CiAgICAgICAgLy8gcGFydHNbNF0gPSAiJmJlZm9yZT0iLnRvU2xpY2UoKTsKICAgICAgICAvLyBwYXJ0c1s1XSA9IHVpbnQyc3RyKChfdGltZXNTdGFydFRyYWRlICsgKCAoX3RyYWRlUGVyaW9kICsgMSApICogNjApKSkudG9TbGljZSgpOwogICAgICAgIHBhcnRzWzRdID0gIikucmVzdWx0LiIudG9TbGljZSgpOwogICAgICAgIHBhcnRzWzVdID0gc3RyQ29uY2F0KCciJyx1aW50MnN0cig2MCksJyInKS50b1NsaWNlKCk7CiAgICAgICAgcGFydHNbNl0gPSAiLlswOiIudG9TbGljZSgpOwogICAgICAgIHBhcnRzWzddID0gdWludDJzdHIoX3RyYWRlUGVyaW9kICsgMSkudG9TbGljZSgpOwogICAgICAgIHBhcnRzWzhdID0gIl0uMSIudG9TbGljZSgpOwogICAgICAgIHJldHVybiAnJy50b1NsaWNlKCkuam9pbihwYXJ0cyk7CiAgICB9CiAKICAgCiAgICAKICAgIAogICAgLy9TRUNUSU9OIElWOiBDT05UUkFDVCBNQU5BR0VNRU5UCgogICAgCiAgICAKICAgIGZ1bmN0aW9uIHN0b3BDb250cmFjdCgpCiAgICBvbmx5T3duZXIgewogICAgaXNTdG9wcGVkID0gdHJ1ZTsKICAgIExPR19Db250cmFjdFN0b3BwZWQoInRoZSBjb250cmFjdCBpcyBzdG9wcGVkIik7CiAgICB9CgogICAgZnVuY3Rpb24gcmVzdW1lQ29udHJhY3QoKQogICAgb25seU93bmVyIHsKICAgIGlzU3RvcHBlZCA9IGZhbHNlOwogICAgTE9HX0NvbnRyYWN0U3RvcHBlZCgidGhlIGNvbnRyYWN0IGlzIHJlc3VtZWQiKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2hhbmdlT3duZXJBZGRyZXNzKGFkZHJlc3MgbmV3T3duZXIpCiAgICBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDB4MCkpOyAvL2NoYW5nZWQgYmFzZWQgb24gYXVkaXQgZmVlZGJhY2sKICAgIG93bmVyID0gbmV3T3duZXI7CiAgICBMT0dfT3duZXJBZGRyZXNzQ2hhbmdlZChvd25lciwgbmV3T3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyRmVlKHVpbnQgX25ld0ZlZSkgCiAgICBvbmx5T3duZXIgewogICAgICAgIG93bmVyRmVlID0gX25ld0ZlZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQcm9maXRQY250KHVpbnQgX25ld1BjdCkgb25seU93bmVyIHsKICAgICAgICBjdXJyZW50UHJvZml0UGN0ID0gX25ld1BjdDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaW5pdGlhbE9yYWNsaXplU2V0dGluZ3MoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSg0MDAwMDAwMDAwMCB3ZWkpOwogICAgICAgIG9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9UTFNOb3RhcnkgfCBwcm9vZlN0b3JhZ2VfSVBGUyk7CiAgICB9CiAKICAgIGZ1bmN0aW9uIGNoYW5nZU9yYWNsaXplUHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSkKICAgICAgICBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3Byb29mVHlwZSAhPSAweDAwKTsKICAgICAgICBvcmFjbGl6ZV9zZXRQcm9vZiggX3Byb29mVHlwZSB8ICBwcm9vZlN0b3JhZ2VfSVBGUyApOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZU1pblRyYWRlKHVpbnQgX25ld01pblRyYWRlKSBvbmx5T3duZXIgewogICAgICAgIG1pblRyYWRlID0gX25ld01pblRyYWRlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjaGFuZ2VHYXNMaW1pdE9mU2FmZVNlbmQodWludCBuZXdHYXNMaW1pdCkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5SWZWYWxpZEdhcyhuZXdHYXNMaW1pdCkgewogICAgICAgIHNhZmVHYXMgPSBuZXdHYXNMaW1pdDsKICAgICAgICBMT0dfR2FzTGltaXRDaGFuZ2VkKHNhZmVHYXMsIG5ld0dhc0xpbWl0KTsKCiAgICB9CgogICAgIGZ1bmN0aW9uIGNoYW5nZU9yYWNsaXplR2FzUHJpemUodWludCBfbmV3R2FzUHJpY2UpIG9ubHlPd25lcnsKICAgICAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZShfbmV3R2FzUHJpY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3BFbWVyZ2VuY3lXaXRoZHJhd2FsKCkgb25seU93bmVyIHsKICAgICAgICBlbWVyZ2VuY3lXaXRoZHJhd2FsQWN0aXZhdGVkID0gZmFsc2U7CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmRW1lcmdlbmN5V2l0aGRyYXdhbEFjdGl2YXRlZCgpIHsKICAgICAgICByZXF1aXJlKGVtZXJnZW5jeVdpdGhkcmF3YWxBY3RpdmF0ZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmbm90V2l0aGRyZXcoKSB7CiAgICAgICAgcmVxdWlyZSghaW52ZXN0b3JzW2ludmVzdG9ySURzW21zZy5zZW5kZXJdXS53aXRoZHJldyk7CiAgICAgICAgXzsKICAgIH0KCgoKICAgIC8qCiAgICAgKiBAZGV2IEluIHRoZSBjYXNlIG9mIGVtZXJnZW5jeSBzdG9wIHRyYWRlcyBhbmQKICAgICAgICBkaXZpZGUgYmFsYW5jZSBlcXVhbGx5IHRvIGFsbCBpbnZlc3RvcnMgYW5kIGFsbG93CiAgICAgICAgdGhlbSB0byB3aXRoZHJhdyBpdC4KICAgICAqLyAKICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVCYWxhbmNlVG9JbnZlc3RvcnMoKSAKICAgIG9ubHlPd25lcgogICAgIHsgIAogICAgICAgIGlzU3RvcHBlZCA9IHRydWU7CiAgICAgICAgZW1lcmdlbmN5V2l0aGRyYXdhbEFjdGl2YXRlZCA9IHRydWU7CiAgICAgICAgdWludCBkaXZpZGVuZHNGb3JJbnZlc3RvcnMgPSBTYWZlTWF0aC5kaXYodGhpcy5iYWxhbmNlLCBudW1JbnZlc3RvcnMpOwogICAgICAgIGZvcih1aW50IGkgPSAxOyBpIDw9ICBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBpbnZlc3RvcnNbaV0uYmFsYW5jZVRvUGF5b3V0ID0gZGl2aWRlbmRzRm9ySW52ZXN0b3JzOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBXaXRoZHJhdyB5b3VyIHBhcnQgZnJvbSB0aGUgdG90YWwgYmFsYW5jZSBpbiBjYXNlIAogICAgICAgIG9mIGVtZXJnZW5jeS4KICAgICAqLyAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RGl2aWRlbmRzKCkgCiAgICBvbmx5SWZFbWVyZ2VuY3lXaXRoZHJhd2FsQWN0aXZhdGVkIAogICAgb25seUludmVzdG9ycwogICAgb25seUlmbm90V2l0aGRyZXcKICAgIHsgICAKICAgICAgIC8vc2VuZCByaWdodCBiYWxhbmNlIHRvIGludmVzdG9yLiAKICAgICAgIGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0ud2l0aGRyZXcgPSB0cnVlOyAKICAgICAgIGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0uaW52ZXN0b3JBZGRyZXNzLnRyYW5zZmVyKGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0uYmFsYW5jZVRvUGF5b3V0KTsgCiAgICAgICAgaW52ZXN0b3JzW2ludmVzdG9ySURzW21zZy5zZW5kZXJdXS5iYWxhbmNlVG9QYXlvdXQgPSAwOwoKICAgIH0KCiAKfQ=='.
	

]
