Class {
	#name : #SRT3d92a0e142e05c1077d8ebeccf1601bd8e17a0cc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3d92a0e142e05c1077d8ebeccf1601bd8e17a0cc >> base64 [
	^ 'Ly8vIEB0aXRsZSBTYWZlTWF0aAovLy8gQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKbGlicmFyeSBTYWZlTWF0aCB7CiAgICAvLy8gQGRldiBNdWx0aXBsaWVzIGEgdGltZXMgYgogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSAKICAgIGludGVybmFsIAogICAgcHVyZQogICAgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgcmVxdWlyZShhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLy8vIEBkZXYgRGl2aWRlcyBhIGJ5IGIKICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgCiAgICBpbnRlcm5hbCAKICAgIHB1cmUKICAgIHJldHVybnMgKHVpbnQyNTYpIAogICAgewogICAgICAgIC8vIHJlcXVpcmUoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyByZXF1aXJlKGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvLy8gQGRldiBTdWJ0cmFjdHMgYSBmcm9tIGIKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgCiAgICBpbnRlcm5hbCAKICAgIHB1cmUKICAgIHJldHVybnMgKHVpbnQyNTYpIAogICAgewogICAgICAgIHJlcXVpcmUoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhIHRvIGIKICAgIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgCiAgICBpbnRlcm5hbCAKICAgIHB1cmUKICAgIHJldHVybnMgKHVpbnQyNTYpIAogICAgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIHJlcXVpcmUoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KfQoKCgovLy8gSW1wbGVtZW50cyBFUkMgMjAgVG9rZW4gc3RhbmRhcmQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAovLy8gQHRpdGxlIEFic3RyYWN0IHRva2VuIGNvbnRyYWN0IC0gRnVuY3Rpb25zIHRvIGJlIGltcGxlbWVudGVkIGJ5IHRva2VuIGNvbnRyYWN0cwpjb250cmFjdCBUb2tlbiB7CiAgICAvKgogICAgICogRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKfQoKCi8vLyBAdGl0bGUgU3RhbmRhcmQgdG9rZW4gY29udHJhY3QgLSBTdGFuZGFyZCB0b2tlbiBpbnRlcmZhY2UgaW1wbGVtZW50YXRpb24KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbiB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2VzOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MKICAgIC8vLyBAcGFyYW0gdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlcgogICAgLy8vIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIodmFsdWUpOwogICAgICAgIGJhbGFuY2VzW3RvXSA9IGJhbGFuY2VzW3RvXS5hZGQodmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFsbG93YW5jZXMgdGhpcmQgcGFydHkgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlci4gUmV0dXJucyBzdWNjZXNzCiAgICAvLy8gQHBhcmFtIGZyb20gQWRkcmVzcyBmcm9tIHdoZXJlIHRva2VucyBhcmUgd2l0aGRyYXduCiAgICAvLy8gQHBhcmFtIHRvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBzZW50CiAgICAvLy8gQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gaWYgKGJhbGFuY2VzW2Zyb21dIDwgdmFsdWUgfHwgYWxsb3dhbmNlc1tmcm9tXVttc2cuc2VuZGVyXSA8IHZhbHVlKQogICAgICAgIC8vICAgICAvLyBCYWxhbmNlIG9yIGFsbG93YW5jZSB0b28gbG93CiAgICAgICAgLy8gICAgIHJldmVydCgpOwogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8PSBiYWxhbmNlc1tmcm9tXSk7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8PSBhbGxvd2FuY2VzW2Zyb21dW21zZy5zZW5kZXJdKTsKICAgICAgICBiYWxhbmNlc1t0b10gPSBiYWxhbmNlc1t0b10uYWRkKHZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tmcm9tXSA9IGJhbGFuY2VzW2Zyb21dLnN1Yih2YWx1ZSk7CiAgICAgICAgYWxsb3dhbmNlc1tmcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93YW5jZXNbZnJvbV1bbXNnLnNlbmRlcl0uc3ViKHZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgYWxsb3dhbmNlcyBhY2NvdW50CiAgICAvLy8gQHBhcmFtIHZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoKHZhbHVlID09IDApIHx8IChhbGxvd2FuY2VzW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICAgICAgYWxsb3dhbmNlc1ttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSB2YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93YW5jZXNbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93YW5jZXMgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhbGxvd2FuY2VzW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93YW5jZXNbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93YW5jZXNbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKSAKICAgIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dhbmNlc1ttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2FuY2VzW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dhbmNlc1ttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2FuY2VzW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgYWxsb3dhbmNlcyB0b2tlbnMgZm9yIGdpdmVuIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHJlbWFpbmluZyBhbGxvd2FuY2UgZm9yIHNwZW5kZXIKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG93YW5jZXNbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgdG9rZW5zIG93bmVkIGJ5IGdpdmVuIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYmFsYW5jZSBvZiBvd25lcgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KfQoKCmNvbnRyYWN0IEJhbGVodWJ1Y2sgaXMgU3RhbmRhcmRUb2tlbiB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJiYWxlaHVidWNrIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkJVWCI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPVEFMX1NVUFBMWSA9IDEwMDAwMDAwMDAgKiAxMCoqMTg7CiAgICAvLyBQcmVzYWxlIEFsbG9jYXRpb24gPSA1MDAgKiAoNTAwMCArIDQ1MDAgKyA0MDAwICsgMzUwMCArIDMyNTAgKyAzMDAwKQogICAgLy8gTWFpbiBTYWxlIEFsbG9jYXRpb24gPSA3NTAwMCAqIDI1MDAKICAgIC8vIFRva2VuIFNhbGUgQWxsb2NhdGlvbiA9IFByZXNhbGUgQWxsb2NhdGlvbiArIE1haW4gU2FsZSBBbGxvY2F0aW9uCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TQUxFX0FMTE9DQVRJT04gPSAxOTkxMjUwMDAgKiAxMCoqMTg7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBXQUxMRVRfQUxMT0NBVElPTiA9IDgwMDg3NTAwMCAqIDEwKioxODsKCiAgICBmdW5jdGlvbiBCYWxlaHVidWNrKGFkZHJlc3Mgd2FsbGV0KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHRvdGFsU3VwcGx5ID0gVE9UQUxfU1VQUExZOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gVE9LRU5fU0FMRV9BTExPQ0FUSU9OOwogICAgICAgIGJhbGFuY2VzW3dhbGxldF0gPSBXQUxMRVRfQUxMT0NBVElPTjsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdG8gbWFrZSBzdXJlIHRvdGFsIGFsbG9jYXRpb25zIG1hdGNoIHRvdGFsIHN1cHBseQogICAgICAgIHJlcXVpcmUoVE9LRU5fU0FMRV9BTExPQ0FUSU9OICsgV0FMTEVUX0FMTE9DQVRJT04gPT0gVE9UQUxfU1VQUExZKTsKICAgIH0KfQoKCmNvbnRyYWN0IFRva2VuU2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IFByZXNhbGVTdGFydCh1aW50MjU2IGluZGV4ZWQgcHJlc2FsZVN0YXJ0VGltZSk7CiAgICBldmVudCBBbGxvY2F0ZVByZXNhbGUoYWRkcmVzcyBpbmRleGVkIHJlY2VpdmVyLCB1aW50MjU2IHRva2VuUXVhbnRpdHkpOwogICAgZXZlbnQgUHJlc2FsZUVuZCh1aW50MjU2IGluZGV4ZWQgcHJlc2FsZUVuZFRpbWUpOwogICAgZXZlbnQgTWFpblNhbGVTdGFydCh1aW50MjU2IGluZGV4ZWQgc3RhcnRNYWluU2FsZVRpbWUpOwogICAgZXZlbnQgQWxsb2NhdGVNYWluU2FsZShhZGRyZXNzIGluZGV4ZWQgcmVjZWl2ZXIsIHVpbnQyNTYgZXRoZXJBbW91bnQpOwogICAgZXZlbnQgTWFpblNhbGVFbmQodWludDI1NiBpbmRleGVkIGVuZE1haW5TYWxlVGltZSk7CiAgICBldmVudCBUcmFkaW5nU3RhcnQodWludDI1NiBpbmRleGVkIHN0YXJ0VHJhZGluZ1RpbWUpOwogICAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW5kZXhlZCByZWNlaXZlciwgdWludDI1NiBldGhlckFtb3VudCk7CgogICAgLyoKICAgICAqICBDb25zdGFudHMKICAgICAqLwogICAgLy8gUHJlc2FsZSBBbGxvY2F0aW9uID0gNTAwICogKDUwMDAgKyA0NTAwICsgNDAwMCArIDM1MDAgKyAzMjUwICsgMzAwMCkgKiAxMCoqMTgKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBSRVNBTEVfVE9LRU5fQUxMT0NBVElPTiA9IDExNjI1MDAwICogMTAqKjE4OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJFU0FMRV9NQVhfUkFJU0UgPSAzMDAwICogMTAqKjE4OwoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwcmVzYWxlQWxsb2NhdGlvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBtYWluU2FsZUFsbG9jYXRpb25zOwogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogICAgQmFsZWh1YnVjayBwdWJsaWMgdG9rZW47CiAgICB1aW50MjU2IHB1YmxpYyBwcmVzYWxlRW5kVGltZTsKICAgIHVpbnQyNTYgcHVibGljIG1haW5TYWxlRW5kVGltZTsKICAgIHVpbnQyNTYgcHVibGljIG1pblRyYWRpbmdTdGFydFRpbWU7CiAgICB1aW50MjU2IHB1YmxpYyBtYXhUcmFkaW5nU3RhcnRUaW1lOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxSZWNlaXZlZDsKICAgIHVpbnQyNTYgcHVibGljIG1pbmltdW1NYWluU2FsZVJhaXNlOwogICAgdWludDI1NiBwdWJsaWMgbWF4aW11bU1haW5TYWxlUmFpc2U7CiAgICB1aW50MjU2IHB1YmxpYyBtYXhpbXVtQWxsb2NhdGlvblBlclBhcnRpY2lwYW50OwogICAgdWludDI1NiBwdWJsaWMgbWFpblNhbGVFeGNoYW5nZVJhdGU7CiAgICBTdGFnZXMgcHVibGljIHN0YWdlOwoKICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBEZXBsb3llZCwKICAgICAgICBQcmVzYWxlU3RhcnRlZCwKICAgICAgICBQcmVzYWxlRW5kZWQsCiAgICAgICAgTWFpblNhbGVTdGFydGVkLAogICAgICAgIE1haW5TYWxlRW5kZWQsCiAgICAgICAgUmVmdW5kLAogICAgICAgIFRyYWRpbmcKICAgIH0KCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIHJlcXVpcmUod2FsbGV0ID09IG1zZy5zZW5kZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgYXRTdGFnZShTdGFnZXMgX3N0YWdlKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBfc3RhZ2UpOwogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBGYWxsYmFjayBmdW5jdGlvbgogICAgICovCiAgICBmdW5jdGlvbiAoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIGJ1eShtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKgogICAgICogIENvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAgKi8KICAgIC8vIEBkZXYgQ29uc3RydWN0b3IgZnVuY3Rpb24gdGhhdCBjcmVhdGUgdGhlIEJhbGVodWJ1Y2sgdG9rZW4gYW5kIHNldHMgdGhlIGluaXRpYWwgdmFyaWFibGVzCiAgICAvLyBAcGFyYW0gX3dhbGxldCBzZXRzIHRoZSB3YWxsZXQgc3RhdGUgdmFyaWFibGUgd2hpY2ggd2lsbCBiZSB1c2VkIHRvIHN0YXJ0IHN0YWdlcyB0aHJvdWdob3V0IHRoZSB0b2tlbiBzYWxlCiAgICBmdW5jdGlvbiBUb2tlblNhbGUoYWRkcmVzcyBfd2FsbGV0KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwogICAgICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICAgICAgdG9rZW4gPSBuZXcgQmFsZWh1YnVjayh3YWxsZXQpOwogICAgICAgIC8vIFNldHMgdGhlIGRlZmF1bHQgbWFpbiBzYWxlIHZhbHVlcwogICAgICAgIG1pbmltdW1NYWluU2FsZVJhaXNlID0gMjMwMDAgKiAxMCoqMTg7CiAgICAgICAgbWF4aW11bU1haW5TYWxlUmFpc2UgPSA3ODAwMCAqIDEwKioxODsKICAgICAgICBtYXhpbXVtQWxsb2NhdGlvblBlclBhcnRpY2lwYW50ID0gNzUwICogMTAqKjE4OwogICAgICAgIG1haW5TYWxlRXhjaGFuZ2VSYXRlID0gMjUwMDsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5EZXBsb3llZDsKICAgICAgICB0b3RhbFJlY2VpdmVkID0gMDsKICAgIH0KCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8gQGV2IEFsbG93cyBidXllcnMgdG8gYnV5IHRva2VucywgdGhyb3dzIGlmIG5laXRoZXIgdGhlIHByZXNhbGUgb3IgbWFpbiBzYWxlIGlzIGhhcHBlbmluZwogICAgLy8gQHBhcmFtIF9yZWNlaXZlciBUaGUgYWRkcmVzcyB0aGUgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMKICAgIGZ1bmN0aW9uIGJ1eShhZGRyZXNzIF9yZWNlaXZlcikKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICBhZGRyZXNzIHJlY2VpdmVyID0gX3JlY2VpdmVyOwogICAgICAgIGlmIChyZWNlaXZlciA9PSAweDApCiAgICAgICAgICAgIHJlY2VpdmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBpZiAoc3RhZ2UgPT0gU3RhZ2VzLlByZXNhbGVTdGFydGVkKSB7CiAgICAgICAgICAgIGJ1eVByZXNhbGUocmVjZWl2ZXIpOwogICAgICAgIH0gZWxzZSBpZiAoc3RhZ2UgPT0gU3RhZ2VzLk1haW5TYWxlU3RhcnRlZCkgewogICAgICAgICAgICBidXlNYWluU2FsZShyZWNlaXZlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiAgRXh0ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vIEBkZXYgU3RhcnRzIHRoZSBwcmVzYWxlCiAgICBmdW5jdGlvbiBzdGFydFByZXNhbGUoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seVdhbGxldAogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkRlcGxveWVkKQogICAgewogICAgICAgIHN0YWdlID0gU3RhZ2VzLlByZXNhbGVTdGFydGVkOwogICAgICAgIHByZXNhbGVFbmRUaW1lID0gbm93ICsgOCB3ZWVrczsKICAgICAgICBQcmVzYWxlU3RhcnQobm93KTsKICAgIH0KCiAgICAvLyBAZGV2IFNldHMgdGhlIG1heGltdW0gYW5kIG1pbmltdW0gcmFpc2UgYW1vdW50cyBwcmlvciB0byB0aGUgbWFpbiBzYWxlCiAgICAvLyBAZGV2IFVzZSB0aGlzIG1ldGhvZCB3aXRoIGV4dHJlbWUgY2F1dGlvbiEKICAgIC8vIEBwYXJhbSBfbWluaW11bU1haW5TYWxlUmFpc2UgU2V0cyB0aGUgbWluaW1pdW0gbWFpbiBzYWxlIHJhaXNlCiAgICAvLyBAcGFyYW0gX21heGltdW1NYWluU2FsZVJhaXNlIFNldHMgdGhlIG1heGltdW0gbWFpbiBzYWxlIHJhaXNlCiAgICAvLyBAcGFyYW0gX21heGltdW1BbGxvY2F0aW9uUGVyUGFydGljaXBhbnQgc2V0cyB0aGUgbWF4aW11bSBtYWluIHNhbGUgYWxsb2NhdGlvbiBwZXIgcGFydGljaXBhbnQKICAgIGZ1bmN0aW9uIGNoYW5nZVNldHRpbmdzKHVpbnQyNTYgX21pbmltdW1NYWluU2FsZVJhaXNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfbWF4aW11bU1haW5TYWxlUmFpc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9tYXhpbXVtQWxsb2NhdGlvblBlclBhcnRpY2lwYW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfbWFpblNhbGVFeGNoYW5nZVJhdGUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgYXRTdGFnZShTdGFnZXMuUHJlc2FsZUVuZGVkKQogICAgewogICAgICAgIC8vIENoZWNrcyB0aGUgaW5wdXRzIGZvciBudWxsIHZhbHVlcwogICAgICAgIHJlcXVpcmUoX21pbmltdW1NYWluU2FsZVJhaXNlID4gMCAmJgogICAgICAgICAgICAgICAgX21heGltdW1NYWluU2FsZVJhaXNlID4gMCAmJgogICAgICAgICAgICAgICAgX21heGltdW1BbGxvY2F0aW9uUGVyUGFydGljaXBhbnQgPiAwICYmCiAgICAgICAgICAgICAgICBfbWFpblNhbGVFeGNoYW5nZVJhdGUgPiAwKTsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCByZXF1aXJlcyB0aGUgbWluIHJhaXNlIHRvIGJlIGxlc3MgdGhlbiB0aGUgbWF4CiAgICAgICAgcmVxdWlyZShfbWluaW11bU1haW5TYWxlUmFpc2UgPCBfbWF4aW11bU1haW5TYWxlUmFpc2UpOwogICAgICAgIC8vIFRoaXMgY2hlY2sgdmVyaWZpZXMgdGhhdCB0aGUgdG9rZW5fc2FsZSBjb250cmFjdCBoYXMgZW5vdWdoIHRva2VucyB0byBtYXRjaCB0aGUKICAgICAgICAvLyBfbWF4aW11bU1haW5TYWxlUmFpc2VBbW91bnQgKiBfbWFpblNhbGVFeGNoYW5nZVJhdGUgKHN1YnRyYWN0cyBwcmVzYWxlIGFtb3VudHMgZmlyc3QpCiAgICAgICAgcmVxdWlyZShfbWF4aW11bU1haW5TYWxlUmFpc2Uuc3ViKFBSRVNBTEVfTUFYX1JBSVNFKS5tdWwoX21haW5TYWxlRXhjaGFuZ2VSYXRlKSA8PSB0b2tlbi5iYWxhbmNlT2YodGhpcykuc3ViKFBSRVNBTEVfVE9LRU5fQUxMT0NBVElPTikpOwogICAgICAgIG1pbmltdW1NYWluU2FsZVJhaXNlID0gX21pbmltdW1NYWluU2FsZVJhaXNlOwogICAgICAgIG1heGltdW1NYWluU2FsZVJhaXNlID0gX21heGltdW1NYWluU2FsZVJhaXNlOwogICAgICAgIG1haW5TYWxlRXhjaGFuZ2VSYXRlID0gX21haW5TYWxlRXhjaGFuZ2VSYXRlOwogICAgICAgIG1heGltdW1BbGxvY2F0aW9uUGVyUGFydGljaXBhbnQgPSBfbWF4aW11bUFsbG9jYXRpb25QZXJQYXJ0aWNpcGFudDsKICAgIH0KCiAgICAvLyBAZGV2IFN0YXJ0cyB0aGUgbWFpbiBzYWxlCiAgICAvLyBAZGV2IE1ha2Ugc3VyZSB0aGUgbWFpbiBzYWxlIHZhcmlhYmxlcyBhcmUgY29ycmVjdCBiZWZvcmUgY2FsbGluZwogICAgZnVuY3Rpb24gc3RhcnRNYWluU2FsZSgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgYXRTdGFnZShTdGFnZXMuUHJlc2FsZUVuZGVkKQogICAgewogICAgICAgIHN0YWdlID0gU3RhZ2VzLk1haW5TYWxlU3RhcnRlZDsKICAgICAgICBtYWluU2FsZUVuZFRpbWUgPSBub3cgKyA4IHdlZWtzOwogICAgICAgIE1haW5TYWxlU3RhcnQobm93KTsKICAgIH0KCiAgICAvLyBAZGV2IFN0YXJ0cyB0aGUgdHJhZGluZyBzdGFnZSwgYWxsb3dpbmcgYnV5ZXIgdG8gY2xhaW0gdGhlaXIgdG9rZW5zCiAgICBmdW5jdGlvbiBzdGFydFRyYWRpbmcoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgYXRTdGFnZShTdGFnZXMuTWFpblNhbGVFbmRlZCkKICAgIHsKICAgICAgICAvLyBUcmFkaW5nIHN0YXJ0cyBiZXR3ZWVuIHR3byB3ZWVrcyAoaWYgY2FsbGVkIGJ5IHRoZSB3YWxsZXQpIGFuZCB0d28gbW9udGhzIChjYWxsYWJsZSBieSBhbnlvbmUpCiAgICAgICAgLy8gYWZ0ZXIgdGhlIG1haW4gc2FsZSBoYXMgZW5kZWQKICAgICAgICByZXF1aXJlKChtc2cuc2VuZGVyID09IHdhbGxldCAmJiBub3cgPj0gbWluVHJhZGluZ1N0YXJ0VGltZSkgfHwgbm93ID49IG1heFRyYWRpbmdTdGFydFRpbWUpOwogICAgICAgIHN0YWdlID0gU3RhZ2VzLlRyYWRpbmc7CiAgICAgICAgVHJhZGluZ1N0YXJ0KG5vdyk7CiAgICB9CgogICAgLy8gQGRldiBBbGxvd3MgYnV5ZXIgdG8gYmUgcmVmdW5kZWQgdGhlaXIgRVRIIGlmIHRoZSBtaW5pbXVtIHByZXNhbGUgcmFpc2UgYW1vdW50IGhhc24ndCBiZWVuIG1ldAogICAgZnVuY3Rpb24gcmVmdW5kKCkgCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBhdFN0YWdlKFN0YWdlcy5SZWZ1bmQpCiAgICB7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBtYWluU2FsZUFsbG9jYXRpb25zW21zZy5zZW5kZXJdOwogICAgICAgIG1haW5TYWxlQWxsb2NhdGlvbnNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBSZWZ1bmQobXNnLnNlbmRlciwgYW1vdW50KTsKICAgIH0KCiAgICAvLyBAZGV2IEFsbG93cyBidXllcnMgdG8gY2xhaW0gdGhlIHRva2VucyB0aGV5J3ZlIHB1cmNoYXNlZAogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgYXRTdGFnZShTdGFnZXMuVHJhZGluZykKICAgIHsKICAgICAgICB1aW50MjU2IHRva2VuQWxsb2NhdGlvbiA9IHByZXNhbGVBbGxvY2F0aW9uc1ttc2cuc2VuZGVyXS5hZGQobWFpblNhbGVBbGxvY2F0aW9uc1ttc2cuc2VuZGVyXS5tdWwobWFpblNhbGVFeGNoYW5nZVJhdGUpKTsKICAgICAgICBwcmVzYWxlQWxsb2NhdGlvbnNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIG1haW5TYWxlQWxsb2NhdGlvbnNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRva2VuQWxsb2NhdGlvbik7CiAgICB9CgogICAgLyoKICAgICAqICBQcml2YXRlIGZ1bmN0aW9ucwogICAgICovCiAgICAvLyBAZGV2IEFsbG9jYXRlZCB0b2tlbnMgdG8gdGhlIHByZXNhbGUgYnV5ZXIgYXQgYSByYXRlIGJhc2VkIG9uIHRoZSB0b3RhbCByZWNlaXZlZAogICAgLy8gQHBhcmFtIHJlY2VpdmVyIFRoZSBhZGRyZXNzIHByZXNhbGUgYmFsZWh1YnVja3Mgd2lsbCBiZSBhbGxvY2F0ZWQgdG8KICAgIGZ1bmN0aW9uIGJ1eVByZXNhbGUoYWRkcmVzcyByZWNlaXZlcikKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgaWYgKG5vdyA+PSBwcmVzYWxlRW5kVGltZSkgewogICAgICAgICAgICBlbmRQcmVzYWxlKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdWludDI1NiB0b3RhbFRva2VuQWxsb2NhdGlvbiA9IDA7CiAgICAgICAgdWludDI1NiBvbGRUb3RhbFJlY2VpdmVkID0gdG90YWxSZWNlaXZlZDsKICAgICAgICB1aW50MjU2IHRva2VuQWxsb2NhdGlvbiA9IDA7CiAgICAgICAgdWludDI1NiB3ZWlVc2luZyA9IDA7CiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgdWludDI1NiBtYXhXZWlGb3JQcmVzYWxlU3RhZ2UgPSAwOwogICAgICAgIHVpbnQyNTYgYnV5ZXJSZWZ1bmQgPSAwOwogICAgICAgIC8vIEN5Y2xlcyB0aHJvdWdoIHRoZSBwcmVzYWxlIHBoYXNlcyBjb25kaXRpb25hbCBnaXZpbmcgYSBkaWZmZXJlbnQgZXhjaGFuZ2UgcmF0ZSBmb3IKICAgICAgICAvLyBlYWNoIHBoYXNlIG9mIHRoZSBwcmVzYWxlIHVudGlsIHRva2VucyBoYXZlIGJlZW4gYWxsb2NhdGVkIGZvciBhbGwgRXRoZXIgc2VudCBvciAKICAgICAgICAvLyB1bnRpbCB0aGUgcHJlc2FsZSBjYXAgb2YgMywwMDAgRXRoZXIgaGFzIGJlZW4gcmVhY2hlZAogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIC8vIFRoZSBFVk0gZGVhbHMgd2l0aCBkaXZpc2lvbiBieSByb3VuZGluZyBkb3duLCBjYXVzaW5nIHRoZSBiZWxvdyBzdGF0ZW1lbnQgdG8KICAgICAgICAgICAgLy8gcm91bmQgZG93biB0byB0aGUgY29ycmVjdCBzdGFnZQogICAgICAgICAgICAvLyBzdGFnZUFtb3VudCA9IHRvdGFsUmVjZWl2ZWQuYWRkKDUwMCAqIDEwKioxOCkuZGl2KDUwMCAqIDEwKioxOCkubXVsKDUwMCAqIDEwKioxOCk7CiAgICAgICAgICAgIC8vIG1heFdlaUZvclByZXNhbGVTdGFnZSA9IHN0YWdlQW1vdW50IC0gdG90YWxSZWNlaXZlZAogICAgICAgICAgICBtYXhXZWlGb3JQcmVzYWxlU3RhZ2UgPSAodG90YWxSZWNlaXZlZC5hZGQoNTAwICogMTAqKjE4KS5kaXYoNTAwICogMTAqKjE4KS5tdWwoNTAwICogMTAqKjE4KSkuc3ViKHRvdGFsUmVjZWl2ZWQpOwogICAgICAgICAgICBpZiAod2VpQW1vdW50ID4gbWF4V2VpRm9yUHJlc2FsZVN0YWdlKSB7CiAgICAgICAgICAgICAgICB3ZWlVc2luZyA9IG1heFdlaUZvclByZXNhbGVTdGFnZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHdlaVVzaW5nID0gd2VpQW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdlaUFtb3VudCA9IHdlaUFtb3VudC5zdWIod2VpVXNpbmcpOwogICAgICAgICAgICBpZiAodG90YWxSZWNlaXZlZCA8IDUwMCAqIDEwKioxOCkgewogICAgICAgICAgICAvLyBTdGFnZSAxOiB1cCB0byA1MDAgRXRoZXIsIGV4Y2hhbmdlIHJhdGUgb2YgMSBFVEggZm9yIDUwMDAgQlVYCiAgICAgICAgICAgICAgICB0b2tlbkFsbG9jYXRpb24gPSBjYWxjcHJlc2FsZUFsbG9jYXRpb25zKHdlaVVzaW5nLCA1MDAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0b3RhbFJlY2VpdmVkIDwgMTAwMCAqIDEwKioxOCkgewogICAgICAgICAgICAvLyBTdGFnZSAyOiB1cCB0byAxMDAwIEV0aGVyLCBleGNoYW5nZSByYXRlIG9mIDEgRVRIIGZvciA0NTAwIEJVWAogICAgICAgICAgICAgICAgdG9rZW5BbGxvY2F0aW9uID0gY2FsY3ByZXNhbGVBbGxvY2F0aW9ucyh3ZWlVc2luZywgNDUwMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodG90YWxSZWNlaXZlZCA8IDE1MDAgKiAxMCoqMTgpIHsKICAgICAgICAgICAgLy8gU3RhZ2UgMzogdXAgdG8gMTUwMCBFdGhlciwgZXhjaGFuZ2UgcmF0ZSBvZiAxIEVUSCBmb3IgNDAwMCBCVVgKICAgICAgICAgICAgICAgIHRva2VuQWxsb2NhdGlvbiA9IGNhbGNwcmVzYWxlQWxsb2NhdGlvbnMod2VpVXNpbmcsIDQwMDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRvdGFsUmVjZWl2ZWQgPCAyMDAwICogMTAqKjE4KSB7CiAgICAgICAgICAgIC8vIFN0YWdlIDQ6IHVwIHRvIDIwMDAgRXRoZXIsIGV4Y2hhbmdlIHJhdGUgb2YgMSBFVEggZm9yIDM1MDAgQlVYCiAgICAgICAgICAgICAgICB0b2tlbkFsbG9jYXRpb24gPSBjYWxjcHJlc2FsZUFsbG9jYXRpb25zKHdlaVVzaW5nLCAzNTAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0b3RhbFJlY2VpdmVkIDwgMjUwMCAqIDEwKioxOCkgewogICAgICAgICAgICAvLyBTdGFnZSA1OiB1cCB0byAyNTAwIEV0aGVyLCBleGNoYW5nZSByYXRlIG9mIDEgRVRIIGZvciAzMjUwIEJVWAogICAgICAgICAgICAgICAgdG9rZW5BbGxvY2F0aW9uID0gY2FsY3ByZXNhbGVBbGxvY2F0aW9ucyh3ZWlVc2luZywgMzI1MCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodG90YWxSZWNlaXZlZCA8IDMwMDAgKiAxMCoqMTgpIHsKICAgICAgICAgICAgLy8gU3RhZ2UgNjogdXAgdG8gMzAwMCBFdGhlciwgZXhjaGFuZ2UgcmF0ZSBvZiAxIEVUSCBmb3IgMzAwMCBCVVgKICAgICAgICAgICAgICAgIHRva2VuQWxsb2NhdGlvbiA9IGNhbGNwcmVzYWxlQWxsb2NhdGlvbnMod2VpVXNpbmcsIDMwMDApOwogICAgICAgICAgICB9IAogICAgICAgICAgICB0b3RhbFRva2VuQWxsb2NhdGlvbiA9IHRvdGFsVG9rZW5BbGxvY2F0aW9uLmFkZCh0b2tlbkFsbG9jYXRpb24pOwogICAgICAgICAgICB0b3RhbFJlY2VpdmVkID0gdG90YWxSZWNlaXZlZC5hZGQod2VpVXNpbmcpOwogICAgICAgICAgICBpZiAodG90YWxSZWNlaXZlZCA+PSBQUkVTQUxFX01BWF9SQUlTRSkgewogICAgICAgICAgICAgICAgICAgIGJ1eWVyUmVmdW5kID0gd2VpQW1vdW50OwogICAgICAgICAgICAgICAgICAgIGVuZFByZXNhbGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBFeGl0cyB0aGUgZm9yIGxvb3BzIGlmIHRoZSBwcmVzYWxlIGNhcCBoYXMgYmVlbiByZWFjaGVkIChjaGFuZ2luZyB0aGUgc3RhZ2UpCiAgICAgICAgICAgIC8vIG9yIGFsbCBvZiB0aGUgd2VpIHNlbmQgdG8gdGhlIHByZXNhbGUgaGFzIGJlZW4gYWxsb2NhdGVkCiAgICAgICAgICAgIGlmICh3ZWlBbW91bnQgPT0gMCB8fCBzdGFnZSAhPSBTdGFnZXMuUHJlc2FsZVN0YXJ0ZWQpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcHJlc2FsZUFsbG9jYXRpb25zW3JlY2VpdmVyXSA9IHByZXNhbGVBbGxvY2F0aW9uc1tyZWNlaXZlcl0uYWRkKHRvdGFsVG9rZW5BbGxvY2F0aW9uKTsKICAgICAgICB3YWxsZXQudHJhbnNmZXIodG90YWxSZWNlaXZlZC5zdWIob2xkVG90YWxSZWNlaXZlZCkpOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYnV5ZXJSZWZ1bmQpOwogICAgICAgIEFsbG9jYXRlUHJlc2FsZShyZWNlaXZlciwgdG90YWxUb2tlbkFsbG9jYXRpb24pOwogICAgfQoKICAgIC8vIEBkZXYgQWxsb2NhdGVkIHRva2VucyB0byB0aGUgcHJlc2FsZSBidXllciBhdCBhIHJhdGUgYmFzZWQgb24gdGhlIHRvdGFsIHJlY2VpdmVkCiAgICAvLyBAcGFyYW0gcmVjZWl2ZXIgVGhlIGFkZHJlc3MgbWFpbiBzYWxlIGJhbGVodWJ1Y2tzIHdpbGwgYmUgYWxsb2NhdGVkIHRvCiAgICBmdW5jdGlvbiBidXlNYWluU2FsZShhZGRyZXNzIHJlY2VpdmVyKQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICBpZiAobm93ID49IG1haW5TYWxlRW5kVGltZSkgewogICAgICAgICAgICBlbmRNYWluU2FsZShtc2cudmFsdWUpOwogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBidXllclJlZnVuZCA9IDA7CiAgICAgICAgdWludDI1NiB3ZWlBbGxvY2F0aW9uID0gbWFpblNhbGVBbGxvY2F0aW9uc1tyZWNlaXZlcl0uYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgaWYgKHdlaUFsbG9jYXRpb24gPj0gbWF4aW11bUFsbG9jYXRpb25QZXJQYXJ0aWNpcGFudCkgewogICAgICAgICAgICB3ZWlBbGxvY2F0aW9uID0gbWF4aW11bUFsbG9jYXRpb25QZXJQYXJ0aWNpcGFudC5zdWIobWFpblNhbGVBbGxvY2F0aW9uc1tyZWNlaXZlcl0pOwogICAgICAgICAgICBidXllclJlZnVuZCA9IG1zZy52YWx1ZS5zdWIod2VpQWxsb2NhdGlvbik7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgcG90ZW50aWFsUmVjZWl2ZWQgPSB0b3RhbFJlY2VpdmVkLmFkZCh3ZWlBbGxvY2F0aW9uKTsKICAgICAgICBpZiAocG90ZW50aWFsUmVjZWl2ZWQgPiBtYXhpbXVtTWFpblNhbGVSYWlzZSkgewogICAgICAgICAgICB3ZWlBbGxvY2F0aW9uID0gbWF4aW11bU1haW5TYWxlUmFpc2Uuc3ViKHRvdGFsUmVjZWl2ZWQpOwogICAgICAgICAgICBidXllclJlZnVuZCA9IGJ1eWVyUmVmdW5kLmFkZChwb3RlbnRpYWxSZWNlaXZlZC5zdWIobWF4aW11bU1haW5TYWxlUmFpc2UpKTsKICAgICAgICAgICAgZW5kTWFpblNhbGUoYnV5ZXJSZWZ1bmQpOwogICAgICAgIH0KICAgICAgICB0b3RhbFJlY2VpdmVkID0gdG90YWxSZWNlaXZlZC5hZGQod2VpQWxsb2NhdGlvbik7CiAgICAgICAgbWFpblNhbGVBbGxvY2F0aW9uc1tyZWNlaXZlcl0gPSBtYWluU2FsZUFsbG9jYXRpb25zW3JlY2VpdmVyXS5hZGQod2VpQWxsb2NhdGlvbik7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihidXllclJlZnVuZCk7CiAgICAgICAgQWxsb2NhdGVNYWluU2FsZShyZWNlaXZlciwgd2VpQWxsb2NhdGlvbik7CiAgICB9CgogICAgLy8gQGRldiBDYWxjdWxhdGVzIHRoZSBhbW91bnQgb2YgcHJlc2FsZSB0b2tlbnMgdG8gYWxsb2NhdGUKICAgIC8vIEBwYXJhbSB3ZWlVc2luZyBUaGUgYW1vdW50IG9mIHdlaSBiZWluZyB1c2VkIHRvIGZvciB0aGUgZ2l2ZW4gdG9rZW4gYWxsb2NhdGlvbgogICAgLy8gQHBhcmFtIHJhdGUgVGhlIGV0aC90b2tlbiBleGNoYW5nZSByYXRlLCB0aGlzIGNoYW5nZXMgYmFzZWQgb24gaG93IG11Y2ggdGhlIHByZXNhbGUgaGFzIHJlY2VpdmVkIHNvIGZhcgogICAgZnVuY3Rpb24gY2FsY3ByZXNhbGVBbGxvY2F0aW9ucyh1aW50MjU2IHdlaVVzaW5nLCB1aW50MjU2IHJhdGUpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiB3ZWlVc2luZy5tdWwocmF0ZSk7CiAgICB9CgogICAgLy8gQGRldiBFbmRzIHRoZSBwcmVzYWxlCiAgICBmdW5jdGlvbiBlbmRQcmVzYWxlKCkKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuUHJlc2FsZUVuZGVkOwogICAgICAgIFByZXNhbGVFbmQobm93KTsKICAgIH0KCiAgICAvLyBAZGV2IEVuZHMgdGhlIG1haW4gc2FsZSB0cmlnZ2VyaW5nIGEgcmVmdW5kIGlmIHRoZSBtaW5pbXVtIHNhbGUgcmFpc2UgaGFzIG5vIGJlZW4gbWV0IAogICAgLy8gQGRldiBvciBwYXNzZXMgZnVuZHMgcmFpc2VkIHRvIHRoZSB3YWxsZXQgYW5kIHN0YXJ0cyB0aGUgdHJhZGluZyBjb3VudCBkb3duCiAgICBmdW5jdGlvbiBlbmRNYWluU2FsZSh1aW50MjU2IGJ1eWVyUmVmdW5kKQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICBpZiAodG90YWxSZWNlaXZlZCA8IG1pbmltdW1NYWluU2FsZVJhaXNlKSB7CiAgICAgICAgICAgIHN0YWdlID0gU3RhZ2VzLlJlZnVuZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtaW5UcmFkaW5nU3RhcnRUaW1lID0gbm93ICsgMiB3ZWVrczsKICAgICAgICAgICAgbWF4VHJhZGluZ1N0YXJ0VGltZSA9IG5vdyArIDggd2Vla3M7CiAgICAgICAgICAgIHN0YWdlID0gU3RhZ2VzLk1haW5TYWxlRW5kZWQ7CiAgICAgICAgICAgIC8vIFRyYW5zZmVycyBhbGwgZnVuZHMgcmFpc2VkIHRvIHRoZSBCYWxlaHUgd2FsbGV0IG1pbnVzIHRoZSBmdW5kcyB0aGF0IG5lZWQgdG8gYmUgcmVmdW5kZWQKICAgICAgICAgICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZS5zdWIoYnV5ZXJSZWZ1bmQpKTsKICAgICAgICAgICAgLy8gQWxsIHVuc29sZCB0b2tlbnMgd2lsbCByZW1haW4gd2l0aGluIHRoZSB0b2tlbl9zYWxlIGNvbnRyYWN0CiAgICAgICAgICAgIC8vIGFuZCB3aWxsIGJlIHRyZWF0ZWQgYXMgYnVybmVkCiAgICAgICAgfQogICAgICAgIE1haW5TYWxlRW5kKG5vdyk7CiAgICB9Cn0='.
	

]
