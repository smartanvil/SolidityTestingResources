Class {
	#name : #SRTAB6CF87a50F17d7F5E1FEaf81B6fE9FfBe8EBF84,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTAB6CF87a50F17d7F5E1FEaf81B6fE9FfBe8EBF84 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiAKICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4KICAgKi8KICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludDI1NiBzaXplKSB7CiAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsKICAgICAgIHRocm93OwogICAgIH0KICAgICBfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4gCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1hbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcnQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyBpZiAoX3ZhbHVlID4gX2FsbG93YW5jZSkgdGhyb3c7CgogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIAogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKiogCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4gCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4gCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKLyoqIAogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gVG9rZW5zCiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjIwNTI0NTRkNDM0ZjYwMTIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+z4AuY29tPgogKiBAZGV2IFRoaXMgYmxvY2tzIGluY29taW5nIEVSQzIzIHRva2VucyB0byBwcmV2ZW50IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuCiAqIFNob3VsZCB0b2tlbnMgKGFueSBFUkMyMEJhc2ljIGNvbXBhdGlibGUpIGVuZCB1cCBpbiB0aGUgY29udHJhY3QsIGl0IGFsbG93cyB0aGUKICogb3duZXIgdG8gcmVjbGFpbSB0aGUgdG9rZW5zLgogKi8KY29udHJhY3QgSGFzTm9Ub2tlbnMgaXMgT3duYWJsZSB7CgogLyoqIAogICogQGRldiBSZWplY3QgYWxsIEVSQzIzIGNvbXBhdGlibGUgdG9rZW5zCiAgKiBAcGFyYW0gZnJvbV8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IGlzIHRyYW5zZmVycmluZyB0aGUgdG9rZW5zCiAgKiBAcGFyYW0gdmFsdWVfIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0aGUgc3BlY2lmaWVkIHRva2VuCiAgKiBAcGFyYW0gZGF0YV8gQnl0ZXMgVGhlIGRhdGEgcGFzc2VkIGZyb20gdGhlIGNhbGxlci4KICAqLwogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBmcm9tXywgdWludDI1NiB2YWx1ZV8sIGJ5dGVzIGRhdGFfKSBleHRlcm5hbCB7CiAgICB0aHJvdzsKICB9CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBhbGwgRVJDMjBCYXNpYyBjb21wYXRpYmxlIHRva2VucwogICAqIEBwYXJhbSB0b2tlbkFkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiByZWNsYWltVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBFUkMyMEJhc2ljIHRva2VuSW5zdCA9IEVSQzIwQmFzaWModG9rZW5BZGRyKTsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuSW5zdC5iYWxhbmNlT2YodGhpcyk7CiAgICB0b2tlbkluc3QudHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogIH0KfQoKLyoqIAogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gQ29udHJhY3RzCiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjFkNmY3ODcwN2U3MjVkMmYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+z4AuY29tPgogKiBAZGV2IFNob3VsZCBjb250cmFjdHMgKGFueXRoaW5nIE93bmFibGUpIGVuZCB1cCBiZWluZyBvd25lZCBieSB0aGlzIGNvbnRyYWN0LCBpdCBhbGxvd3MgdGhlIG93bmVyCiAqIG9mIHRoaXMgY29udHJhY3QgdG8gcmVjbGFpbSBvd25lcnNoaXAgb2YgdGhlIGNvbnRyYWN0cy4KICovCmNvbnRyYWN0IEhhc05vQ29udHJhY3RzIGlzIE93bmFibGUgewoKICAvKioKICAgKiBAZGV2IFJlY2xhaW0gb3duZXJzaGlwIG9mIE93bmFibGUgY29udHJhY3RzCiAgICogQHBhcmFtIGNvbnRyYWN0QWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgT3duYWJsZSB0byBiZSByZWNsYWltZWQuCiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbUNvbnRyYWN0KGFkZHJlc3MgY29udHJhY3RBZGRyKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgT3duYWJsZSBjb250cmFjdEluc3QgPSBPd25hYmxlKGNvbnRyYWN0QWRkcik7CiAgICBjb250cmFjdEluc3QudHJhbnNmZXJPd25lcnNoaXAob3duZXIpOwogIH0KfQoKLyoqCiAqIE1SViB0b2tlbiwgZGlzdHJpYnV0ZWQgYnkgY3Jvd2RzYWxlLiBUb2tlbiBhbmQgY3Jvd2RzYWxlIGZ1bmN0aW9uYWxpdHkgYXJlIHVuaWZpZWQgaW4gYSBzaW5nbGUKICogY29udHJhY3QsIHRvIG1ha2UgY2xlYXIgYW5kIHJlc3RyaWN0IHRoZSBjb25kaXRpb25zIHVuZGVyIHdoaWNoIHRva2VucyBjYW4gYmUgY3JlYXRlZCBvciBkZXN0cm95ZWQuCiAqIERlcml2ZWQgZnJvbSBPcGVuWmVwcGVsaW4gQ3Jvd2RzYWxlVG9rZW4gdGVtcGxhdGUuCiAqCiAqIEtleSBDcm93ZHNhbGUgRmFjdHM6CiAqIAogKiAqIE1SViB0b2tlbnMgd2lsbCBiZSBzb2xkIGF0IGEgcmF0ZSBvZiA1LDAwMCBwZXIgRVRILgogKgogKiAqIEFsbCBNUlYgdG9rZW4gc2FsZXMgYXJlIGZpbmFsLiBObyByZWZ1bmRzIGNhbiBiZSBpc3N1ZWQgYnkgdGhlIGNvbnRyYWN0LgogKgogKiAqIFVubGVzcyBhZGp1c3RlZCBsYXRlciBieSB0aGUgY3Jvd2RzYWxlIG9wZXJhdG9yLCB1cCB0byAxMDAgbWlsbGlvbiB0b2tlbnMgd2lsbCBiZSBhdmFpbGFibGUuCiAqCiAqICogQW4gYWRkaXRpb25hbCA1LDAwMCB0b2tlbnMgYXJlIHJlc2VydmVkLiAKICoKICogKiBQYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlIGJ5IHNlbmRpbmcgRVRIIHRvIHRoaXMgY29udHJhY3QsIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBvcGVuLgogKgogKiAqIFNlbmRpbmcgbW9yZSBFVEggdGhhbiByZXF1aXJlZCB0byBwdXJjaGFzZSBhbGwgdGhlIHJlbWFpbmluZyB0b2tlbnMgd2lsbCBmYWlsLgogKgogKiAqIFRpbWVycyBjYW4gYmUgc2V0IHRvIGFsbG93IGFueW9uZSB0byBvcGVuL2Nsb3NlIHRoZSBjcm93ZHNhbGUgYXQgdGhlIHByb3BlciB0aW1lLiBUaGUgY3Jvd2RzYWxlCiAqICAgb3BlcmF0b3IgcmVzZXJ2ZXMgdGhlIHJpZ2h0IHRvIHNldCwgdW5zZXQsIGFuZCByZXNldCB0aGVzZSB0aW1lcnMgYXQgYW55IHRpbWUsIGZvciBhbnkgcmVhc29uLAogKiAgIGFuZCB3aXRob3V0IG5vdGljZS4KICoKICogKiBUaGUgb3BlcmF0b3Igb2YgdGhlIGNyb3dkc2FsZSBoYXMgdGhlIGFiaWxpdHkgdG8gbWFudWFsbHkgb3BlbiBpdCBhbmQgY2xvc2UgaXQsIGFuZCByZXNlcnZlcwogKiAgIHRoZSByaWdodCB0byBkbyBzbyBhdCBhbnkgdGltZSwgZm9yIGFueSByZWFzb24sIGFuZCB3aXRob3V0IG5vdGljZS4KICoKICogKiBUaGUgY3Jvd2RzYWxlIGNhbm5vdCBiZSByZW9wZW5lZCwgYW5kIG5vIHRva2VucyBjYW4gYmUgY3JlYXRlZCwgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBjbG9zZXMuCiAqCiAqICogVGhlIGNyb3dkc2FsZSBvcGVyYXRvciByZXNlcnZlcyB0aGUgcmlnaHQgdG8gYWRqdXN0IHRoZSBkZWNpbWFsIHBsYWNlcyBvZiB0aGUgTVJWIHRva2VuIGF0CiAqICAgYW55IHRpbWUgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBjbG9zZXMsIGZvciBhbnkgcmVhc29uLCBhbmQgd2l0aG91dCBub3RpY2UuIE1SViB0b2tlbnMgYXJlCiAqICAgaW5pdGlhbGx5IGRpdmlzaWJsZSB0byAxOCBkZWNpbWFsIHBsYWNlcy4KICoKICogKiBUaGUgY3Jvd2RzYWxlIG9wZXJhdG9yIHJlc2VydmVzIHRoZSByaWdodCB0byBub3Qgb3BlbiBvciBjbG9zZSB0aGUgY3Jvd2RzYWxlLCBub3Qgc2V0IHRoZQogKiAgIG9wZW4gb3IgY2xvc2UgdGltZXIsIGFuZCBnZW5lcmFsbHkgcmVmcmFpbiBmcm9tIGRvaW5nIHRoaW5ncyB0aGF0IHRoZSBjb250cmFjdCB3b3VsZCBvdGhlcndpc2UKICogICBhdXRob3JpemUgdGhlbSB0byBkby4KICoKICogKiBUaGUgY3Jvd2RzYWxlIG9wZXJhdG9yIHJlc2VydmVzIHRoZSByaWdodCB0byBjbGFpbSBhbmQga2VlcCBhbnkgRVRIIG9yIHRva2VucyB0aGF0IGVuZCB1cCBpbgogKiAgIHRoZSBjb250cmFjdCdzIGFjY291bnQuIER1cmluZyBub3JtYWwgY3Jvd2RzYWxlIG9wZXJhdGlvbiwgRVRIIGlzIG5vdCBzdG9yZWQgaW4gdGhlIGNvbnRyYWN0J3MKICogICBhY2NvdW50LCBhbmQgaXMgaW5zdGVhZCBzZW50IGRpcmVjdGx5IHRvIHRoZSBiZW5lZmljaWFyeS4KICovCmNvbnRyYWN0IE1SVlRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUsIEhhc05vVG9rZW5zLCBIYXNOb0NvbnRyYWN0cyB7CgogICAgLy8gVG9rZW4gUGFyYW1ldGVycwoKICAgIC8vIEZyb20gU3RhbmRhcmRUb2tlbiB3ZSBpbmhlcml0IGJhbGFuY2VzIGFuZCB0b3RhbFN1cHBseS4KICAgIAogICAgLy8gV2hhdCBpcyB0aGUgZnVsbCBuYW1lIG9mIHRoZSB0b2tlbj8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJNYWNyb3ZlcnNlIFRva2VuIjsKICAgIC8vIFdoYXQgaXMgaXRzIHN1Z2dlc3RlZCBzeW1ib2w/CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJNUlYiOwogICAgLy8gSG93IG1hbnkgb2YgdGhlIGxvdyBiYXNlLTEwIGRpZ2l0cyBhcmUgdG8gdGhlIHJpZ2h0IG9mIHRoZSBkZWNpbWFsIHBvaW50PwogICAgLy8gTm90ZSB0aGF0IHRoaXMgaXMgbm90IGNvbnN0YW50ISBBZnRlciB0aGUgY3Jvd2RzYWxlLCB0aGUgY29udHJhY3Qgb3duZXIgY2FuCiAgICAvLyBhZGp1c3QgdGhlIGRlY2ltYWwgcGxhY2VzLCBhbGxvd2luZyBmb3IgMTAtdG8tMSBzcGxpdHMgYW5kIG1lcmdlcy4KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICAgIAogICAgLy8gQ3Jvd2RzYWxlIFBhcmFtZXRlcnMKICAgIAogICAgLy8gV2hlcmUgd2lsbCBmdW5kcyBjb2xsZWN0ZWQgZHVyaW5nIHRoZSBjcm93ZHNhbGUgYmUgc2VudD8KICAgIGFkZHJlc3MgYmVuZWZpY2lhcnk7CiAgICAvLyBIb3cgbWFueSBNUlYgY2FuIGJlIHNvbGQgaW4gdGhlIGNyb3dkc2FsZT8KICAgIHVpbnQgcHVibGljIG1heENyb3dkc2FsZVN1cHBseUluV2hvbGVUb2tlbnM7CiAgICAvLyBIb3cgbWFueSB3aG9sZSB0b2tlbnMgYXJlIHJlc2VydmVkIGZvciB0aGUgYmVuZWZpY2lhcnk/CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCB3aG9sZVRva2Vuc1Jlc2VydmVkID0gNTAwMDsKICAgIC8vIEhvdyBtYW55IHRva2VucyBwZXIgRVRIIGR1cmluZyB0aGUgY3Jvd2RzYWxlPwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgd2hvbGVUb2tlbnNQZXJFdGggPSA1MDAwOwogICAgCiAgICAvLyBTZXQgdG8gdHJ1ZSB3aGVuIHRoZSBjcm93ZHNhbGUgc3RhcnRzCiAgICAvLyBJbnRlcm5hbCBmbGFnLiBVc2UgaXNDcm93ZHNhbGVBY3RpdmUgaW5zdGVhZCgpLgogICAgYm9vbCBjcm93ZHNhbGVTdGFydGVkOwogICAgLy8gU2V0IHRvIHRydWUgd2hlbiB0aGUgY3Jvd2RzYWxlIGVuZHMKICAgIC8vIEludGVybmFsIGZsYWcuIFVzZSBpc0Nyb3dkc2FsZUFjdGl2ZSBpbnN0ZWFkKCkuCiAgICBib29sIGNyb3dkc2FsZUVuZGVkOwogICAgLy8gV2UgY2FuIGFsc28gc2V0IHNvbWUgdGltZXJzIHRvIG9wZW4gYW5kIGNsb3NlIHRoZSBjcm93ZHNhbGUuIDAgPSB0aW1lciBpcyBub3Qgc2V0LgogICAgLy8gQWZ0ZXIgdGhpcyB0aW1lLCB0aGUgY3Jvd2RzYWxlIHdpbGwgb3BlbiB3aXRoIGEgY2FsbCB0byBjaGVja09wZW5UaW1lcigpLgogICAgdWludCBwdWJsaWMgb3BlblRpbWVyID0gMDsKICAgIC8vIEFmdGVyIHRoaXMgdGltZSwgbm8gY29udHJpYnV0aW9ucyB3aWxsIGJlIGFjY2VwdGVkLCBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGNsb3NlIHdpdGggYSBjYWxsIHRvIGNoZWNrQ2xvc2VUaW1lcigpLgogICAgdWludCBwdWJsaWMgY2xvc2VUaW1lciA9IDA7CiAgICAKICAgIC8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vLy8vLy8vLy8vLwogICAgCiAgICAvKioKICAgICogRGVwbG95IGEgbmV3IE1SVlRva2VuIGNvbnRyYWN0LCBwYXlpbmcgY3Jvd2RzYWxlIHByb2NlZWRzIHRvIHRoZSBnaXZlbiBhZGRyZXNzLAogICAgKiBhbmQgYXdhcmRpbmcgcmVzZXJ2ZWQgdG9rZW5zIHRvIHRoZSBvdGhlciBnaXZlbiBhZGRyZXNzLgogICAgKi8KICAgIGZ1bmN0aW9uIE1SVlRva2VuKGFkZHJlc3Mgc2VuZFByb2NlZWRzVG8sIGFkZHJlc3Mgc2VuZFRva2Vuc1RvKSB7CiAgICAgICAgLy8gUHJvY2VlZHMgb2YgdGhlIGNyb3dkc2FsZSBnbyBoZXJlLgogICAgICAgIGJlbmVmaWNpYXJ5ID0gc2VuZFByb2NlZWRzVG87CiAgICAgICAgCiAgICAgICAgLy8gU3RhcnQgd2l0aCAxOCBkZWNpbWFscywgc2FtZSBhcyBFVEgKICAgICAgICBkZWNpbWFscyA9IDE4OwogICAgICAgIAogICAgICAgIC8vIEluaXRpYWxseSwgdGhlIHJlc2VydmVkIHRva2VucyBiZWxvbmcgdG8gdGhlIGdpdmVuIGFkZHJlc3MuCiAgICAgICAgdG90YWxTdXBwbHkgPSB3aG9sZVRva2Vuc1Jlc2VydmVkICogMTAgKiogMTg7CiAgICAgICAgYmFsYW5jZXNbc2VuZFRva2Vuc1RvXSA9IHRvdGFsU3VwcGx5OwogICAgICAgIAogICAgICAgIC8vIEluaXRpYWxseSB0aGUgY3Jvd2RzYWxlIGhhcyBub3QgeWV0IHN0YXJ0ZWQgb3IgZW5kZWQuCiAgICAgICAgY3Jvd2RzYWxlU3RhcnRlZCA9IGZhbHNlOwogICAgICAgIGNyb3dkc2FsZUVuZGVkID0gZmFsc2U7CiAgICAgICAgLy8gRGVmYXVsdCB0byBhIG1heCBzdXBwbHkgb2YgMTAwIG1pbGxpb24gdG9rZW5zIGF2YWlsYWJsZS4KICAgICAgICBtYXhDcm93ZHNhbGVTdXBwbHlJbldob2xlVG9rZW5zID0gMTAwMDAwMDAwOwogICAgfQogICAgCiAgICAvLy8vLy8vLy8vLy8KICAgIC8vIEZhbGxiYWNrIGZ1bmN0aW9uCiAgICAvLy8vLy8vLy8vLy8KICAgIAogICAgLyoqCiAgICAqIFRoaXMgaXMgdGhlIE1BSU4gQ1JPV0RTQUxFIEVOVFJZIFBPSU5ULiBZb3UgcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBieSAKICAgICogc2VuZGluZyBFVEggdG8gdGhpcyBjb250cmFjdC4gVGhhdCBjYWxscyB0aGlzIGZ1bmN0aW9uLCB3aGljaCBjcmVkaXRzIHRva2VucwogICAgKiB0byB0aGUgYWRkcmVzcyBvciBjb250cmFjdCB0aGF0IHNlbnQgdGhlIEVUSC4KICAgICoKICAgICogU2luY2UgTVJWIHRva2VucyBhcmUgc29sZCBhdCBhIHJhdGUgb2YgbW9yZSB0aGFuIG9uZSBwZXIgZXRoZXIsIGFuZCBzaW5jZQogICAgKiB0aGV5LCBsaWtlIEVUSCwgaGF2ZSAxOCBkZWNpbWFsIHBsYWNlcyAoYXQgdGhlIHRpbWUgb2Ygc2FsZSksIGFueSBmcmFjdGlvbmFsCiAgICAqIGFtb3VudCBvZiBFVEggc2hvdWxkIGJlIGhhbmRsZWQgc2FmZWx5LgogICAgKgogICAgKiBOb3RlIHRoYXQgYWxsIG9yZGVycyBhcmUgZmlsbC1vci1raWxsLiBJZiB5b3Ugc2VuZCBpbiBtb3JlIGV0aGVyIHRoYW4gdGhlcmUgYXJlCiAgICAqIHRva2VucyByZW1haW5pbmcgdG8gYmUgYm91Z2h0LCB5b3VyIHRyYW5zYWN0aW9uIHdpbGwgYmUgcm9sbGVkIGJhY2sgYW5kIHlvdSB3aWxsCiAgICAqIGdldCBubyB0b2tlbnMgYW5kIHdhc3RlIHlvdXIgZ2FzLgogICAgKi8KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBvbmx5RHVyaW5nQ3Jvd2RzYWxlIHsKICAgICAgICBjcmVhdGVUb2tlbnMobXNnLnNlbmRlcik7CiAgICB9CiAgICAKICAgIC8vLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8vLy8vLy8KICAgIAogICAgLy8gRmlyZWQgd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJlY29yZGVkIGFzIHN0YXJ0ZWQuCiAgICBldmVudCBDcm93ZHNhbGVPcGVuKHVpbnQgdGltZSk7CiAgICAvLyBGaXJlZCB3aGVuIHNvbWVvbmUgY29udHJpYnV0ZXMgdG8gdGhlIGNyb3dkc2FsZSBhbmQgYnV5cyBNUlYKICAgIGV2ZW50IFRva2VuUHVyY2hhc2UodWludCB0aW1lLCB1aW50IGV0aGVyQW1vdW50LCBhZGRyZXNzIGZyb20pOwogICAgLy8gRmlyZWQgd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJlY29yZGVkIGFzIGVuZGVkLgogICAgZXZlbnQgQ3Jvd2RzYWxlQ2xvc2UodWludCB0aW1lKTsKICAgIC8vIEZpcmVkIHdoZW4gdGhlIGRlY2ltYWwgcG9pbnQgbW92ZXMKICAgIGV2ZW50IERlY2ltYWxDaGFuZ2UodWludDggbmV3RGVjaW1hbHMpOwogICAgCiAgICAvLy8vLy8vLy8vLy8KICAgIC8vIE1vZGlmaWVycyAoZW5jb2RpbmcgaW1wb3J0YW50IGNyb3dkc2FsZSBsb2dpYykKICAgIC8vLy8vLy8vLy8vLwogICAgCiAgICAvKioKICAgICAqIE9ubHkgYWxsb3cgc29tZSBhY3Rpb25zIGJlZm9yZSB0aGUgY3Jvd2RzYWxlIGNsb3Nlcywgd2hldGhlciBpdCdzIG9wZW4gb3Igbm90LgogICAgICovCiAgICBtb2RpZmllciBvbmx5QmVmb3JlQ2xvc2VkIHsKICAgICAgICBjaGVja0Nsb3NlVGltZXIoKTsKICAgICAgICBpZiAoY3Jvd2RzYWxlRW5kZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8qKgogICAgICogT25seSBhbGxvdyBzb21lIGFjdGlvbnMgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAgICogV2lsbCBzZXQgdGhlIGNyb3dkc2FsZSBjbG9zZWQgaWYgaXQgc2hvdWxkIGJlLgogICAgICovCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJDbG9zZWQgewogICAgICAgIGNoZWNrQ2xvc2VUaW1lcigpOwogICAgICAgIGlmICghY3Jvd2RzYWxlRW5kZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8qKgogICAgICogT25seSBhbGxvdyBzb21lIGFjdGlvbnMgYmVmb3JlIHRoZSBjcm93ZHNhbGUgc3RhcnRzLgogICAgICovCiAgICBtb2RpZmllciBvbmx5QmVmb3JlT3BlbmVkIHsKICAgICAgICBjaGVja09wZW5UaW1lcigpOwogICAgICAgIGlmIChjcm93ZHNhbGVTdGFydGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKioKICAgICAqIE9ubHkgYWxsb3cgc29tZSBhY3Rpb25zIHdoaWxlIHRoZSBjcm93ZHNhbGUgaXMgYWN0aXZlLgogICAgICogV2lsbCBzZXQgdGhlIGNyb3dkc2FsZSBvcGVuIGlmIGl0IHNob3VsZCBiZS4KICAgICAqLwogICAgbW9kaWZpZXIgb25seUR1cmluZ0Nyb3dkc2FsZSB7CiAgICAgICAgY2hlY2tPcGVuVGltZXIoKTsKICAgICAgICBjaGVja0Nsb3NlVGltZXIoKTsKICAgICAgICBpZiAoY3Jvd2RzYWxlRW5kZWQpIHRocm93OwogICAgICAgIGlmICghY3Jvd2RzYWxlU3RhcnRlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8KICAgIC8vIFN0YXR1cyBhbmQgdXRpbGl0eSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLwogICAgCiAgICAvKioKICAgICAqIERldGVybWluZSBpZiB0aGUgY3Jvd2RzYWxlIHNob3VsZCBvcGVuIGJ5IHRpbWVyLgogICAgICovCiAgICBmdW5jdGlvbiBvcGVuVGltZXJFbGFwc2VkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAob3BlblRpbWVyICE9IDAgJiYgbm93ID4gb3BlblRpbWVyKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGNyb3dkc2FsZSBzaG91bGQgY2xvc2UgYnkgdGltZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlVGltZXJFbGFwc2VkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoY2xvc2VUaW1lciAhPSAwICYmIG5vdyA+IGNsb3NlVGltZXIpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIElmIHRoZSBvcGVuIHRpbWVyIGhhcyBlbGFwc2VkLCBzdGFydCB0aGUgY3Jvd2RzYWxlLgogICAgICogQ2FuIGJlIGNhbGxlZCBieSBwZW9wbGUsIGJ1dCBhbHNvIGdldHMgY2FsbGVkIHdoZW4gcGVvcGxlIHRyeSB0byBjb250cmlidXRlLgogICAgICovCiAgICBmdW5jdGlvbiBjaGVja09wZW5UaW1lcigpIHsKICAgICAgICBpZiAob3BlblRpbWVyRWxhcHNlZCgpKSB7CiAgICAgICAgICAgIGNyb3dkc2FsZVN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBvcGVuVGltZXIgPSAwOwogICAgICAgICAgICBDcm93ZHNhbGVPcGVuKG5vdyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIElmIHRoZSBjbG9zZSB0aW1lciBoYXMgZWxhcHNlZCwgc3RvcCB0aGUgY3Jvd2RzYWxlLgogICAgICovCiAgICBmdW5jdGlvbiBjaGVja0Nsb3NlVGltZXIoKSB7CiAgICAgICAgaWYgKGNsb3NlVGltZXJFbGFwc2VkKCkpIHsKICAgICAgICAgICAgY3Jvd2RzYWxlRW5kZWQgPSB0cnVlOwogICAgICAgICAgICBjbG9zZVRpbWVyID0gMDsKICAgICAgICAgICAgQ3Jvd2RzYWxlQ2xvc2Uobm93KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IGhhcHBlbmluZy4KICAgICAqLwogICAgZnVuY3Rpb24gaXNDcm93ZHNhbGVBY3RpdmUoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gVGhlIGNyb3dkc2FsZSBpcyBoYXBwZW5pbmcgaWYgaXQgaXMgb3BlbiBvciBkdWUgdG8gb3BlbiwgYW5kIGl0IGlzbid0IGNsb3NlZCBvciBkdWUgdG8gY2xvc2UuCiAgICAgICAgcmV0dXJuICgoY3Jvd2RzYWxlU3RhcnRlZCB8fCBvcGVuVGltZXJFbGFwc2VkKCkpICYmICEoY3Jvd2RzYWxlRW5kZWQgfHwgY2xvc2VUaW1lckVsYXBzZWQoKSkpOwogICAgfQogICAgCiAgICAvLy8vLy8vLy8vLy8KICAgIC8vIEJlZm9yZSB0aGUgY3Jvd2RzYWxlOiBjb25maWd1cmF0aW9uCiAgICAvLy8vLy8vLy8vLy8KICAgIAogICAgLyoqCiAgICAgKiBCZWZvcmUgdGhlIGNyb3dkc2FsZSBvcGVucywgdGhlIG1heCB0b2tlbiBjb3VudCBjYW4gYmUgY29uZmlndXJlZC4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0TWF4U3VwcGx5KHVpbnQgbmV3TWF4SW5XaG9sZVRva2Vucykgb25seU93bmVyIG9ubHlCZWZvcmVPcGVuZWQgewogICAgICAgIG1heENyb3dkc2FsZVN1cHBseUluV2hvbGVUb2tlbnMgPSBuZXdNYXhJbldob2xlVG9rZW5zOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFsbG93IHRoZSBvd25lciB0byBzdGFydCB0aGUgY3Jvd2RzYWxlIG1hbnVhbGx5LgogICAgICovCiAgICBmdW5jdGlvbiBvcGVuQ3Jvd2RzYWxlKCkgb25seU93bmVyIG9ubHlCZWZvcmVPcGVuZWQgewogICAgICAgIGNyb3dkc2FsZVN0YXJ0ZWQgPSB0cnVlOwogICAgICAgIG9wZW5UaW1lciA9IDA7CiAgICAgICAgQ3Jvd2RzYWxlT3Blbihub3cpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIExldCB0aGUgb3duZXIgc3RhcnQgdGhlIHRpbWVyIGZvciB0aGUgY3Jvd2RzYWxlIHN0YXJ0LiBXaXRob3V0IGZ1cnRoZXIgb3duZXIgaW50ZXJ2ZW50aW9uLAogICAgICogYW55b25lIHdpbGwgYmUgYWJsZSB0byBvcGVuIHRoZSBjcm93ZHNhbGUgd2hlbiB0aGUgdGltZXIgZXhwaXJlcy4KICAgICAqIEZ1cnRoZXIgY2FsbHMgd2lsbCByZS1zZXQgdGhlIHRpbWVyIHRvIGNvdW50IGZyb20gdGhlIHRpbWUgdGhlIHRyYW5zYWN0aW9uIGlzIHByb2Nlc3NlZC4KICAgICAqIFRoZSB0aW1lciBjYW4gYmUgcmUtc2V0IGFmdGVyIGl0IGhhcyB0cmlwcGVkLCB1bmxlc3Mgc29tZW9uZSBoYXMgYWxyZWFkeSBvcGVuZWQgdGhlIGNyb3dkc2FsZS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlT3BlblRpbWVyRm9yKHVpbnQgbWludXRlc0Zyb21Ob3cpIG9ubHlPd25lciBvbmx5QmVmb3JlT3BlbmVkIHsKICAgICAgICBvcGVuVGltZXIgPSBub3cgKyBtaW51dGVzRnJvbU5vdyAqIDEgbWludXRlczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBMZXQgdGhlIG93bmVyIHN0b3AgdGhlIGNyb3dkc2FsZSBvcGVuIHRpbWVyLCBhcyBsb25nIGFzIHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgb3BlbmVkLgogICAgICovCiAgICBmdW5jdGlvbiBjbGVhckNyb3dkc2FsZU9wZW5UaW1lcigpIG9ubHlPd25lciBvbmx5QmVmb3JlT3BlbmVkIHsKICAgICAgICBvcGVuVGltZXIgPSAwOwogICAgfQogICAgCiAgICAvKioKICAgICAqIExldCB0aGUgb3duZXIgc3RhcnQgdGhlIHRpbWVyIGZvciB0aGUgY3Jvd2RzYWxlIGVuZC4gQ291bnRzIGZyb20gd2hlbiB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkLAogICAgICogKm5vdCogZnJvbSB0aGUgc3RhcnQgb2YgdGhlIGNyb3dkc2FsZS4KICAgICAqIEl0IGlzIHBvc3NpYmxlLCBidXQgYSBiYWQgaWRlYSwgdG8gc2V0IHRoaXMgYmVmb3JlIHRoZSBvcGVuIHRpbWVyLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVDbG9zZVRpbWVyRm9yKHVpbnQgbWludXRlc0Zyb21Ob3cpIG9ubHlPd25lciBvbmx5QmVmb3JlQ2xvc2VkIHsKICAgICAgICBjbG9zZVRpbWVyID0gbm93ICsgbWludXRlc0Zyb21Ob3cgKiAxIG1pbnV0ZXM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogTGV0IHRoZSBvd25lciBzdG9wIHRoZSBjcm93ZHNhbGUgY2xvc2UgdGltZXIsIGFzIGxvbmcgYXMgaXQgaGFzIG5vdCB5ZXQgZXhwaXJlZC4KICAgICAqLwogICAgZnVuY3Rpb24gY2xlYXJDcm93ZHNhbGVDbG9zZVRpbWVyKCkgb25seU93bmVyIG9ubHlCZWZvcmVDbG9zZWQgewogICAgICAgIGNsb3NlVGltZXIgPSAwOwogICAgfQogICAgCiAgICAKICAgIC8vLy8vLy8vLy8vLwogICAgLy8gRHVyaW5nIHRoZSBjcm93ZHNhbGUKICAgIC8vLy8vLy8vLy8vLwogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSB0b2tlbnMgZm9yIHRoZSBnaXZlbiBhZGRyZXNzLCBpbiByZXNwb25zZSB0byBhIHBheW1lbnQuCiAgICAgKiBDYW5ub3QgYmUgY2FsbGVkIGJ5IG91dHNpZGUgY2FsbGVyczsgdXNlIHRoZSBmYWxsYmFjayBmdW5jdGlvbiwgd2hpY2ggd2lsbCBjcmVhdGUgdG9rZW5zIGZvciB3aG9ldmVyIHBheXMgaXQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VucyhhZGRyZXNzIHJlY2lwaWVudCkgaW50ZXJuYWwgb25seUR1cmluZ0Nyb3dkc2FsZSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgdWludCB0b2tlbnMgPSBtc2cudmFsdWUubXVsKHdob2xlVG9rZW5zUGVyRXRoKTsgLy8gRXhwbG9pdHMgdGhlIGZhY3QgdGhhdCB3ZSBoYXZlIDE4IGRlY2ltYWxzLCBsaWtlIEVUSC4KICAgICAgICAKICAgICAgICB2YXIgbmV3VG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQodG9rZW5zKTsKICAgICAgICAKICAgICAgICBpZiAobmV3VG90YWxTdXBwbHkgPiAod2hvbGVUb2tlbnNSZXNlcnZlZCArIG1heENyb3dkc2FsZVN1cHBseUluV2hvbGVUb2tlbnMpICogMTAgKiogMTgpIHsKICAgICAgICAgICAgLy8gVGhpcyB3b3VsZCBiZSB0b28gbWFueSB0b2tlbnMgaXNzdWVkLgogICAgICAgICAgICAvLyBEb24ndCBtZXNzIGFyb3VuZCB3aXRoIHBhcnRpYWwgb3JkZXIgZmlsbHMuCiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBPdGhlcndpc2UsIHdlIGNhbiBmaWxsIHRoZSBvcmRlciBlbnRpcmVseSwgc28gbWFrZSB0aGUgdG9rZW5zIGFuZCBwdXQgdGhlbSBpbiB0aGUgc3BlY2lmaWVkIGFjY291bnQuCiAgICAgICAgdG90YWxTdXBwbHkgPSBuZXdUb3RhbFN1cHBseTsKICAgICAgICBiYWxhbmNlc1tyZWNpcGllbnRdID0gYmFsYW5jZXNbcmVjaXBpZW50XS5hZGQodG9rZW5zKTsKICAgICAgICAKICAgICAgICAvLyBBbm5vdW5jZSB0aGUgcHVyY2hhc2UKICAgICAgICBUb2tlblB1cmNoYXNlKG5vdywgbXNnLnZhbHVlLCByZWNpcGllbnQpOwoKICAgICAgICAvLyBMYXN0bHkgKGFmdGVyIGFsbCBzdGF0ZSBjaGFuZ2VzKSwgc2VuZCB0aGUgbW9uZXkgdG8gdGhlIGNyb3dkc2FsZSBiZW5lZmljaWFyeS4KICAgICAgICAvLyBUaGlzIGFsbG93cyB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGl0c2VsZiBub3QgdG8gaG9sZCBhbnkgRVRILgogICAgICAgIC8vIEl0IGFsc28gbWVhbnMgdGhhdCBBTEwgU0FMRVMgQVJFIEZJTkFMIQogICAgICAgIGlmICghYmVuZWZpY2lhcnkuc2VuZChtc2cudmFsdWUpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBbGxvdyB0aGUgb3duZXIgdG8gZW5kIHRoZSBjcm93ZHNhbGUgbWFudWFsbHkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlQ3Jvd2RzYWxlKCkgb25seU93bmVyIG9ubHlEdXJpbmdDcm93ZHNhbGUgewogICAgICAgIGNyb3dkc2FsZUVuZGVkID0gdHJ1ZTsKICAgICAgICBjbG9zZVRpbWVyID0gMDsKICAgICAgICBDcm93ZHNhbGVDbG9zZShub3cpOwogICAgfSAgCiAgICAKICAgIC8vLy8vLy8vLy8vLwogICAgLy8gQWZ0ZXIgdGhlIGNyb3dkc2FsZTogdG9rZW4gbWFpbnRhaW5hbmNlCiAgICAvLy8vLy8vLy8vLy8KICAgIAogICAgLyoqCiAgICAgKiBXaGVuIHRoZSBjcm93ZHNhbGUgaXMgZmluaXNoZWQsIHRoZSBjb250cmFjdCBvd25lciBtYXkgYWRqdXN0IHRoZSBkZWNpbWFsIHBsYWNlcyBmb3IgZGlzcGxheSBwdXJwb3Nlcy4KICAgICAqIFRoaXMgc2hvdWxkIHdvcmsgbGlrZSBhIDEwLXRvLTEgc3BsaXQgb3IgcmV2ZXJzZS1zcGxpdC4KICAgICAqIFRoZSBwb2ludCBvZiB0aGlzIG1lY2hhbmlzbSBpcyB0byBrZWVwIHRoZSBpbmRpdmlkdWFsIE1SViB0b2tlbnMgZnJvbSBnZXR0aW5nIGluY29udmVuaWVudGx5IHZhbHVhYmxlIG9yIGNoZWFwLgogICAgICogSG93ZXZlciwgaXQgcmVsaWVzIG9uIHRoZSBjb250cmFjdCBvd25lciB0YWtpbmcgdGhlIHRpbWUgdG8gdXBkYXRlIHRoZSBkZWNpbWFsIHBsYWNlIHZhbHVlLgogICAgICogTm90ZSB0aGF0IHRoaXMgY2hhbmdlcyB0aGUgZGVjaW1hbHMgSU1NRURJQVRFTFkgd2l0aCBOTyBOT1RJQ0UgdG8gdXNlcnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldERlY2ltYWxzKHVpbnQ4IG5ld0RlY2ltYWxzKSBvbmx5T3duZXIgb25seUFmdGVyQ2xvc2VkIHsKICAgICAgICBkZWNpbWFscyA9IG5ld0RlY2ltYWxzOwogICAgICAgIC8vIEFubm91bmNlIHRoZSBjaGFuZ2UKICAgICAgICBEZWNpbWFsQ2hhbmdlKGRlY2ltYWxzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBJZiBFdGhlciBzb21laG93IG1hbmFnZXMgdG8gZ2V0IGludG8gdGhpcyBjb250cmFjdCwgcHJvdmlkZSBhIHdheSB0byBnZXQgaXQgb3V0IGFnYWluLgogICAgICogRHVyaW5nIG5vcm1hbCBjcm93ZHNhbGUgb3BlcmF0aW9uLCBFVEggaXMgaW1tZWRpYXRlbHkgZm9yd2FyZGVkIHRvIHRoZSBiZW5lZmljaWFyeS4KICAgICAqLwogICAgZnVuY3Rpb24gcmVjbGFpbUV0aGVyKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICAvLyBTZW5kIHRoZSBFVEguIE1ha2Ugc3VyZSBpdCB3b3JrZWQuCiAgICAgICAgYXNzZXJ0KG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgICB9Cgp9'.
	

]
