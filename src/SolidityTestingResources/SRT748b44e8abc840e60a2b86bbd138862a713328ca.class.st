Class {
	#name : #SRT748b44e8abc840e60a2b86bbd138862a713328ca,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT748b44e8abc840e60a2b86bbd138862a713328ca >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlVG9rZW4gewogICAgZnVuY3Rpb24gaXNGdW5kcmFpc2VyKGFkZHJlc3MgZnVuZHJhaXNlckFkZHJlc3MpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGNvbXBhbnkoKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvQ3Jvd2RzYWxlUHVyY2hhc2VyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9NYXJrZXRpbmdTdXBwb3J0ZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHsKICAgIGZ1bmN0aW9uIHN0YXJ0RGF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBlbmRlZEF0KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KICAgIGZ1bmN0aW9uIGlzRW5kZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRvdGFsUmFpc2VkQW1vdW50SW5DbnkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5KGFkZHJlc3MgcHVyY2hhc2VyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VkVG9rZW5zT25FcEJ5KGFkZHJlc3MgcHVyY2hhc2VyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKfQoKY29udHJhY3QgU3RhcmJhc2VFYXJseVB1cmNoYXNlIHsKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX1VOSVQgPSAnQ05ZJzsgICAgLy8gQ2hpbmVzZSBZdWFuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9SQVRFX1JFRkVSRU5DRSA9ICdodHRwOi8vd3d3LnhlLmNvbS9jdXJyZW5jeXRhYmxlcy8nOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX0NBUCA9IDkwMDAwMDA7CgogICAgLyoKICAgICAqICBUeXBlcwogICAgICovCiAgICBzdHJ1Y3QgRWFybHlQdXJjaGFzZSB7CiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXI7CiAgICAgICAgdWludCBhbW91bnQ7ICAgICAgICAvLyBDTlkgYmFzZWQgYW1vdW50CiAgICAgICAgdWludCBwdXJjaGFzZWRBdDsgICAvLyB0aW1lc3RhbXAKICAgIH0KCiAgICAvKgogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cwogICAgICovCiAgICBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHB1YmxpYyBzdGFyYmFzZUNyb3dkc2FsZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBFYXJseVB1cmNoYXNlW10gcHVibGljIGVhcmx5UHVyY2hhc2VzOwogICAgdWludCBwdWJsaWMgZWFybHlQdXJjaGFzZUNsb3NlZEF0OwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG5vRXRoZXIoKSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDcm93ZHNhbGUoKSB7CiAgICAgICAgaWYgKGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpICE9IDAgJiYKICAgICAgICAgICAgc3RhcmJhc2VDcm93ZHNhbGUuc3RhcnREYXRlKCkgPiAwKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUVhcmx5UHVyY2hhc2VUZXJtKCkgewogICAgICAgIGlmIChlYXJseVB1cmNoYXNlQ2xvc2VkQXQgPiAwKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgZWFybHkgcHVyY2hhc2VkIGFtb3VudCBieSBwdXJjaGFzZXIncyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIHB1cmNoYXNlciBQdXJjaGFzZXIgYWRkcmVzcwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50IGFtb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IGVhcmx5UHVyY2hhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChlYXJseVB1cmNoYXNlc1tpXS5wdXJjaGFzZXIgPT0gcHVyY2hhc2VyKSB7CiAgICAgICAgICAgICAgICBhbW91bnQgKz0gZWFybHlQdXJjaGFzZXNbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgYW1vdW50IG9mIHJhaXNlZCBmdW5kcyBieSBFYXJseSBQdXJjaGFzZXJzCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKHVpbnQgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk7IGkgPCBlYXJseVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbEFtb3VudCArPSBlYXJseVB1cmNoYXNlc1tpXS5hbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcwogICAgZnVuY3Rpb24gbnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBlYXJseVB1cmNoYXNlcy5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBkZXYgQXBwZW5kIGFuIGVhcmx5IHB1cmNoYXNlIGxvZwogICAgLy8vIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gYW1vdW50IFB1cmNoYXNlIGFtb3VudAogICAgLy8vIEBwYXJhbSBwdXJjaGFzZWRBdCBUaW1lc3RhbXAgb2YgcHVyY2hhc2VkIGRhdGUKICAgIGZ1bmN0aW9uIGFwcGVuZEVhcmx5UHVyY2hhc2UoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQgYW1vdW50LCB1aW50IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZVRlcm0KICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhbW91bnQgPT0gMCB8fAogICAgICAgICAgICB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSArIGFtb3VudCA+IFBVUkNIQVNFX0FNT1VOVF9DQVApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAocHVyY2hhc2VkQXQgPT0gMCB8fCBwdXJjaGFzZWRBdCA+IG5vdykgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIGVhcmx5UHVyY2hhc2VzLnB1c2goRWFybHlQdXJjaGFzZShwdXJjaGFzZXIsIGFtb3VudCwgcHVyY2hhc2VkQXQpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBDbG9zZSBlYXJseSBwdXJjaGFzZSB0ZXJtCiAgICBmdW5jdGlvbiBjbG9zZUVhcmx5UHVyY2hhc2UoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgZWFybHlQdXJjaGFzZUNsb3NlZEF0ID0gbm93OwogICAgfQoKICAgIC8vLyBAZGV2IFNldHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3QncyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcyBUb2tlbiBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcykKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSAwKSB7CiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlID0gQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZShzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UoKSBub0V0aGVyIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gYWx3YXlzIGZhaWxzCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3c7CiAgICB9Cn0KCgpjb250cmFjdCBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgewogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgRWFybHlQdXJjaGFzZUludmFsaWRhdGVkKHVpbnQgZXBJZHgpOwogICAgZXZlbnQgRWFybHlQdXJjaGFzZUFtZW5kZWQodWludCBlcElkeCk7CgogICAgLyoKICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMKICAgICAqLwogICAgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSBwdWJsaWMgc3RhcmJhc2VDcm93ZHNhbGU7CiAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UgcHVibGljIHN0YXJiYXNlRWFybHlQdXJjaGFzZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICB1aW50W10gcHVibGljIGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlczsKICAgIHVpbnRbXSBwdWJsaWMgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzOwogICAgbWFwcGluZyAodWludCA9PiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSkgcHVibGljIGFtZW5kZWRFYXJseVB1cmNoYXNlczsKCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBub0V0aGVyKCkgewogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QmVmb3JlQ3Jvd2RzYWxlKCkgewogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSAhPSAwICYmCiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlLnN0YXJ0RGF0ZSgpID4gMCkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZCgpIHsKICAgICAgICBpZiAoYWRkcmVzcyhzdGFyYmFzZUVhcmx5UHVyY2hhc2UpID09IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBDb250cmFjdCBmdW5jdGlvbnMgYXJlIGNvbXBhdGlibGUgd2l0aCBvcmlnaW5hbCBvbmVzCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgYW4gZWFybHkgcHVyY2hhc2UgcmVjb3JkCiAgICAvLy8gQHBhcmFtIGVhcmx5UHVyY2hhc2VJbmRleCBJbmRleCBudW1iZXIgb2YgYW4gZWFybHkgcHVyY2hhc2UKICAgIGZ1bmN0aW9uIGVhcmx5UHVyY2hhc2VzKHVpbnQgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICByZXR1cm5zIChhZGRyZXNzIHB1cmNoYXNlciwgdWludCBhbW91bnQsIHVpbnQgcHVyY2hhc2VkQXQpCiAgICB7CiAgICAgICAgcmV0dXJuIHN0YXJiYXNlRWFybHlQdXJjaGFzZS5lYXJseVB1cmNoYXNlcyhlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgZWFybHkgcHVyY2hhc2VkIGFtb3VudCBieSBwdXJjaGFzZXIncyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIHB1cmNoYXNlciBQdXJjaGFzZXIgYWRkcmVzcwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50IGFtb3VudCkKICAgIHsKICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG1lbW9yeSBub3JtYWxpemVkRVAgPQogICAgICAgICAgICBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKTsKICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IG5vcm1hbGl6ZWRFUC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobm9ybWFsaXplZEVQW2ldLnB1cmNoYXNlciA9PSBwdXJjaGFzZXIpIHsKICAgICAgICAgICAgICAgIGFtb3VudCArPSBub3JtYWxpemVkRVBbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgYW1vdW50IG9mIHJhaXNlZCBmdW5kcyBieSBFYXJseSBQdXJjaGFzZXJzCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKHVpbnQgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2VbXSBtZW1vcnkgbm9ybWFsaXplZEVQID0KICAgICAgICAgICAgbm9ybWFsaXplZEVhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgZm9yICh1aW50IGk7IGkgPCBub3JtYWxpemVkRVAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG90YWxBbW91bnQgKz0gbm9ybWFsaXplZEVQW2ldLmFtb3VudDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgZWFybHkgcHVyY2hhc2VzCiAgICBmdW5jdGlvbiBudW1iZXJPZkVhcmx5UHVyY2hhc2VzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRFYXJseVB1cmNoYXNlcygpLmxlbmd0aDsKICAgIH0KCiAgICAvLy8gQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0J3MgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MgVG9rZW4gYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0dXAoYWRkcmVzcyBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoYWRkcmVzcyhzdGFyYmFzZUNyb3dkc2FsZSkgPT0gMCkgewogICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZSA9IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUoc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKgogICAgICogIENvbnRyYWN0IGZ1bmN0aW9ucwogICAgICovCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlRWFybHlQdXJjaGFzZSh1aW50IGVhcmx5UHVyY2hhc2VJbmRleCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICBvbmx5QmVmb3JlQ3Jvd2RzYWxlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAobnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpIDw9IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICB0aHJvdzsgIC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICAgICAgdGhyb3c7ICAvLyBkaXNhbGxvdyBkdXBsaWNhdGVkIGludmFsaWRhdGlvbgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXMucHVzaChlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIEVhcmx5UHVyY2hhc2VJbnZhbGlkYXRlZChlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSW52YWxpZEVhcmx5UHVyY2hhc2UodWludCBlYXJseVB1cmNoYXNlSW5kZXgpCiAgICAgICAgY29uc3RhbnQKICAgICAgICBub0V0aGVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAobnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpIDw9IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICB0aHJvdzsgIC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFtZW5kRWFybHlQdXJjaGFzZSh1aW50IGVhcmx5UHVyY2hhc2VJbmRleCwgYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQgYW1vdW50LCB1aW50IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZAogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChwdXJjaGFzZWRBdCA9PSAwIHx8IHB1cmNoYXNlZEF0ID4gbm93KSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgaWYgKG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA8PSBlYXJseVB1cmNoYXNlSW5kZXgpIHsKICAgICAgICAgICAgdGhyb3c7ICAvLyBBcnJheSBJbmRleCBPdXQgb2YgQm91bmRzIEV4Y2VwdGlvbgogICAgICAgIH0KCiAgICAgICAgaWYgKGlzSW52YWxpZEVhcmx5UHVyY2hhc2UoZWFybHlQdXJjaGFzZUluZGV4KSkgewogICAgICAgICAgICB0aHJvdzsgIC8vIEludmFsaWQgZWFybHkgcHVyY2hhc2UgY2Fubm90IGJlIGFtZW5kZWQKICAgICAgICB9CgogICAgICAgIGlmICghaXNBbWVuZGVkRWFybHlQdXJjaGFzZShlYXJseVB1cmNoYXNlSW5kZXgpKSB7CiAgICAgICAgICAgIGFtZW5kZWRFYXJseVB1cmNoYXNlSW5kZXhlcy5wdXNoKGVhcmx5UHVyY2hhc2VJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBhbWVuZGVkRWFybHlQdXJjaGFzZXNbZWFybHlQdXJjaGFzZUluZGV4XSA9CiAgICAgICAgICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlKHB1cmNoYXNlciwgYW1vdW50LCBwdXJjaGFzZWRBdCk7CiAgICAgICAgRWFybHlQdXJjaGFzZUFtZW5kZWQoZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0FtZW5kZWRFYXJseVB1cmNoYXNlKHVpbnQgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA8PSBlYXJseVB1cmNoYXNlSW5kZXgpIHsKICAgICAgICAgICAgdGhyb3c7ICAvLyBBcnJheSBJbmRleCBPdXQgb2YgQm91bmRzIEV4Y2VwdGlvbgogICAgICAgIH0KCiAgICAgICAgZm9yICh1aW50IGk7IGkgPCBhbWVuZGVkRWFybHlQdXJjaGFzZUluZGV4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFtZW5kZWRFYXJseVB1cmNoYXNlSW5kZXhlc1tpXSA9PSBlYXJseVB1cmNoYXNlSW5kZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2FkU3RhcmJhc2VFYXJseVB1cmNoYXNlcyhhZGRyZXNzIHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MgPT0gMCB8fAogICAgICAgICAgICBhZGRyZXNzKHN0YXJiYXNlRWFybHlQdXJjaGFzZSkgIT0gMCkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgc3RhcmJhc2VFYXJseVB1cmNoYXNlID0gU3RhcmJhc2VFYXJseVB1cmNoYXNlKHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MpOwogICAgICAgIGlmIChzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZUNsb3NlZEF0KCkgPT0gMCkgewogICAgICAgICAgICB0aHJvdzsgICAvLyB0aGUgZWFybHkgcHVyY2hhc2UgbXVzdCBiZSBjbG9zZWQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCgpIG5vRXRoZXIgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbHdheXMgZmFpbHMKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCiAgICBmdW5jdGlvbiBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zIChTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG5vcm1hbGl6ZWRFUCkKICAgIHsKICAgICAgICB1aW50IHJhd0VQQ291bnQgPSBudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgbm9ybWFsaXplZEVQID0gbmV3IFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlW10oCiAgICAgICAgICAgIHJhd0VQQ291bnQgLSBpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXMubGVuZ3RoKTsKCiAgICAgICAgdWludCBub3JtYWxpemVkSWR4OwogICAgICAgIGZvciAodWludCBpOyBpIDwgcmF3RVBDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc0ludmFsaWRFYXJseVB1cmNoYXNlKGkpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsgICAvLyBpbnZhbGlkIGVhcmx5IHB1cmNoYXNlIHNob3VsZCBiZSBpZ25vcmVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlIG1lbW9yeSBlcDsKICAgICAgICAgICAgaWYgKGlzQW1lbmRlZEVhcmx5UHVyY2hhc2UoaSkpIHsKICAgICAgICAgICAgICAgIGVwID0gYW1lbmRlZEVhcmx5UHVyY2hhc2VzW2ldOyAgLy8gYW1lbmRlZCBlYXJseSBwdXJjaGFzZSBzaG91bGQgdGFrZSBhIHByaW9yaXR5CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlcCA9IGdldEVhcmx5UHVyY2hhc2UoaSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5vcm1hbGl6ZWRFUFtub3JtYWxpemVkSWR4XSA9IGVwOwogICAgICAgICAgICBub3JtYWxpemVkSWR4Kys7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEVhcmx5UHVyY2hhc2UodWludCBlYXJseVB1cmNoYXNlSW5kZXgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZAogICAgICAgIHJldHVybnMgKFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlKQogICAgewogICAgICAgIHZhciAocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSA9CiAgICAgICAgICAgIHN0YXJiYXNlRWFybHlQdXJjaGFzZS5lYXJseVB1cmNoYXNlcyhlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIHJldHVybiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZShwdXJjaGFzZXIsIGFtb3VudCwgcHVyY2hhc2VkQXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBzdGFyYmFzZUVhcmx5UHVyY2hhc2UubnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpOwogICAgfQp9Cgpjb250cmFjdCBDZXJ0aWZpZXIgewoJZXZlbnQgQ29uZmlybWVkKGFkZHJlc3MgaW5kZXhlZCB3aG8pOwoJZXZlbnQgUmV2b2tlZChhZGRyZXNzIGluZGV4ZWQgd2hvKTsKCWZ1bmN0aW9uIGNlcnRpZmllZChhZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CglmdW5jdGlvbiBnZXQoYWRkcmVzcywgc3RyaW5nKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMik7CglmdW5jdGlvbiBnZXRBZGRyZXNzKGFkZHJlc3MsIHN0cmluZykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpOwoJZnVuY3Rpb24gZ2V0VWludChhZGRyZXNzLCBzdHJpbmcpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKfQoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUgY29udHJhY3QgLSBTdGFyYmFzZSBjcm93ZHNhbGUgdG8gY3JlYXRlIFNUQVIuCiAqIEBhdXRob3IgU3RhcmJhc2UgUFRFLiBMVEQuIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0YjIyMjUyZDI0MGIzODNmMmEzOTI5MmEzODJlNjUyODI0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICovCmNvbnRyYWN0IFN0YXJiYXNlQ3Jvd2RzYWxlIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAvKgogICAgICogIEV2ZW50cwogICAgICovCiAgICBldmVudCBDcm93ZHNhbGVFbmRlZCh1aW50MjU2IGVuZGVkQXQpOwogICAgZXZlbnQgU3RhcmJhc2VQdXJjaGFzZWRXaXRoRXRoKGFkZHJlc3MgcHVyY2hhc2VyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiByYXdBbW91bnQsIHVpbnQyNTYgY255RXRoUmF0ZSk7CiAgICBldmVudCBDbnlFdGhSYXRlVXBkYXRlZCh1aW50MjU2IGNueUV0aFJhdGUpOwogICAgZXZlbnQgQ255QnRjUmF0ZVVwZGF0ZWQodWludDI1NiBjbnlCdGNSYXRlKTsKICAgIGV2ZW50IFF1YWxpZmllZFBhcnRuZXJBZGRyZXNzKGFkZHJlc3MgcXVhbGlmaWVkUGFydG5lcik7CgogICAgLyoqCiAgICAgKiAgRXh0ZXJuYWwgY29udHJhY3RzCiAgICAgKi8KICAgIEFic3RyYWN0U3RhcmJhc2VUb2tlbiBwdWJsaWMgc3RhcmJhc2VUb2tlbjsKICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBwdWJsaWMgc3RhcmJhc2VFcEFtZW5kbWVudDsKICAgIENlcnRpZmllciBwdWJsaWMgcGljb3BzQ2VydGlmaWVyOwoKICAgIC8qKgogICAgICogIENvbnN0YW50cwogICAgICovCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBjcm93ZHNhbGVUb2tlbkFtb3VudCA9IDEyNTAwMDAwMGUxODsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGVhcmx5UHVyY2hhc2VUb2tlbkFtb3VudCA9IDUwMDAwMDAwZTE4OwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgTUlOX0lOVkVTVE1FTlQgPSAxOyAvLyBtaW4gaXMgMSBXZWkKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1BWF9DQVAgPSA2NzAwMDAwMDsgLy8gaW4gQ05ZLiBhcHByb3hpbWF0ZWx5IDEwTSBVU0QuIChpbmNsdWRlcyByYWlzZWQgYW1vdW50IGZyb20gYm90aCBFUCBhbmQgQ1MpCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9VTklUID0gJ0NOWSc7ICAvLyBDaGluZXNlIFl1YW4KCiAgICAvKioKICAgICAqIFR5cGVzCiAgICAgKi8KICAgIHN0cnVjdCBDcm93ZHNhbGVQdXJjaGFzZSB7CiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAvLyBDTlkgYmFzZWQgYW1vdW50IHdpdGggYm9udXMKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudDsgICAgIC8vIENOWSBiYXNlZCBhbW91bnQgbm8gYm9udXMKICAgICAgICB1aW50MjU2IHB1cmNoYXNlZEF0OyAgIC8vIHRpbWVzdGFtcAogICAgfQoKICAgIHN0cnVjdCBRdWFsaWZpZWRQYXJ0bmVycyB7CiAgICAgICAgdWludDI1NiBhbW91bnRDYXA7CiAgICAgICAgdWludDI1NiBhbW91bnRSYWlzZWQ7CiAgICAgICAgYm9vbCAgICBib25hRmlkZTsKICAgICAgICB1aW50MjU2IGNvbW1pc3Npb25GZWVQZXJjZW50YWdlOyAvLyBleGFtcGxlIDUgd2lsbCBjYWxjdWxhdGUgdGhlIHBlcmNlbnRhZ2UgYXMgNSUKICAgIH0KCiAgICAvKgogICAgICogIEVudW1zCiAgICAgKi8KICAgIGVudW0gQm9udXNNaWxlc3RvbmVzIHsKICAgICAgICBGaXJzdCwKICAgICAgICBTZWNvbmQsCiAgICAgICAgVGhpcmQsCiAgICAgICAgRm91cnRoLAogICAgICAgIEZpZnRoCiAgICB9CgogICAgLy8gSW5pdGlhbGl6ZSBib251c01pbGVzdG9uZXMKICAgIEJvbnVzTWlsZXN0b25lcyBwdWJsaWMgYm9udXNNaWxlc3RvbmVzID0gQm9udXNNaWxlc3RvbmVzLkZpcnN0OwoKICAgIC8qKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgdWludCBwdWJsaWMgbnVtT2ZEZWxpdmVyZWRDcm93ZHNhbGVQdXJjaGFzZXM7ICAvLyBpbmRleCB0byBrZWVwIHRoZSBudW1iZXIgb2YgY3Jvd2RzYWxlIHB1cmNoYXNlcyBoYXZlIGFscmVhZHkgYmVlbiBwcm9jZXNzZWQgYnkgYHdpdGhkcmF3UHVyY2hhc2VkVG9rZW5zYAogICAgdWludCBwdWJsaWMgbnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlczsgIC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMgaGF2ZSBhbHJlYWR5IGJlZW4gcHJvY2Vzc2VkIGJ5IGB3aXRoZHJhd1B1cmNoYXNlZFRva2Vuc2AKICAgIHVpbnQyNTYgcHVibGljIG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXM7IC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiBsb2FkZWQgYnkgYGxvYWRFYXJseVB1cmNoYXNlc2AKCiAgICAvLyBlYXJseSBwdXJjaGFzZQogICAgYWRkcmVzc1tdIHB1YmxpYyBlYXJseVB1cmNoYXNlcnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBlYXJseVB1cmNoYXNlZEFtb3VudEJ5OyAvLyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGluIENOWSBwZXIgcHVyY2hhc2VycycgYWRkcmVzcwogICAgYm9vbCBwdWJsaWMgZWFybHlQdXJjaGFzZXNMb2FkZWQgPSBmYWxzZTsgIC8vIHJldHVybnMgd2hldGhlciBhbGwgZWFybHkgcHVyY2hhc2VzIGFyZSBsb2FkZWQgaW50byB0aGlzIGNvbnRyYWN0CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXNJbkNueTsKCiAgICAvLyBjcm93ZHNhbGUKICAgIHVpbnQyNTYgcHVibGljIG1heENyb3dkc2FsZUNhcDsgICAgIC8vID0gNjdNIENOWSAtICh0b3RhbCByYWlzZWQgYW1vdW50IGZyb20gRVApCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEFtb3VudE9mUHVyY2hhc2VzSW5Dbnk7IC8vIHRvdGFsUHJlU2FsZSArIHRvdGFsQ3Jvd2RzYWxlCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFF1YWxpZmllZFBhcnRuZXJzKSBwdWJsaWMgcXVhbGlmaWVkUGFydG5lcnM7CiAgICB1aW50MjU2IHB1YmxpYyBwdXJjaGFzZVN0YXJ0QmxvY2s7ICAvLyBjcm93ZHNhbGUgcHVyY2hhc2VzIGNhbiBiZSBhY2NlcHRlZCBmcm9tIHRoaXMgYmxvY2sgbnVtYmVyCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydERhdGU7CiAgICB1aW50MjU2IHB1YmxpYyBlbmRlZEF0OwogICAgQ3Jvd2RzYWxlUHVyY2hhc2VbXSBwdWJsaWMgY3Jvd2RzYWxlUHVyY2hhc2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY3Jvd2RzYWxlUHVyY2hhc2VBbW91bnRCeTsgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlIGFtb3VudCBpbiBDTlkgcGVyIHB1cmNoYXNlcnMnIGFkZHJlc3MKICAgIHVpbnQyNTYgcHVibGljIGNueUJ0Y1JhdGU7IC8vIHRoaXMgcmF0ZSB3b24ndCBiZSB1c2VkIGZyb20gYSBzbWFydCBjb250cmFjdCBmdW5jdGlvbiBidXQgZXh0ZXJuYWwgc3lzdGVtCiAgICB1aW50MjU2IHB1YmxpYyBjbnlFdGhSYXRlOwoKICAgIC8vIGJvbnVzIG1pbGVzdG9uZXMKICAgIHVpbnQyNTYgcHVibGljIGZpcnN0Qm9udXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kQm9udXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgdGhpcmRCb251c0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBmb3VydGhCb251c0VuZHM7CgogICAgLy8gYWZ0ZXIgdGhlIGNyb3dkc2FsZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnk7ICAgIC8vIHRoZSBudW1iZXIgb2YgdG9rZW5zIHB1cmNoYXNlZCBvbiB0aGUgY3Jvd2RzYWxlIGJ5IGEgcHVyY2hhc2VyCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeTsgICAgLy8gdGhlIG51bWJlciBvZiB0b2tlbnMgZWFybHkgcHVyY2hhc2VkIGJ5IGEgcHVyY2hhc2VyCgogICAgLyoqCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG1pbkludmVzdG1lbnQoKSB7CiAgICAgICAgLy8gVXNlciBoYXMgdG8gc2VuZCBhdCBsZWFzdCB0aGUgZXRoZXIgdmFsdWUgb2Ygb25lIHRva2VuLgogICAgICAgIGFzc2VydChtc2cudmFsdWUgPj0gTUlOX0lOVkVTVE1FTlQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgd2hlbkVuZGVkKCkgewogICAgICAgIGFzc2VydChpc0VuZGVkKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaGFzQmFsYW5jZSgpIHsKICAgICAgICBhc3NlcnQodGhpcy5iYWxhbmNlID4gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHJhdGVJc1NldCh1aW50MjU2IF9yYXRlKSB7CiAgICAgICAgYXNzZXJ0KF9yYXRlICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgd2hlbk5vdEVuZGVkKCkgewogICAgICAgIGFzc2VydCghaXNFbmRlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHRva2Vuc05vdERlbGl2ZXJlZCgpIHsKICAgICAgICBhc3NlcnQobnVtT2ZEZWxpdmVyZWRDcm93ZHNhbGVQdXJjaGFzZXMgPT0gMCk7CiAgICAgICAgYXNzZXJ0KG51bU9mRGVsaXZlcmVkRWFybHlQdXJjaGFzZXMgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RnVuZHJhaXNlcigpIHsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzdGFyYmFzZVRva2VuKSAhPSAwKTsKICAgICAgICBhc3NlcnQoc3RhcmJhc2VUb2tlbi5pc0Z1bmRyYWlzZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVF1YWxpZmllZFBhcnRuZXIoKSB7CiAgICAgICAgYXNzZXJ0KHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmJvbmFGaWRlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlRdWFsaWZpZWRQYXJ0bmVyT1JQaWNvcHNDZXJ0aWZpZWQoKSB7CiAgICAgICAgYXNzZXJ0KHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmJvbmFGaWRlIHx8IHBpY29wc0NlcnRpZmllci5jZXJ0aWZpZWQobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBDb250cmFjdCBmdW5jdGlvbnMKICAgICAqLwogICAgLyoqCiAgICAgKiBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgb3duZXIgYWRkcmVzcyBhbmQKICAgICAqICAgICAgYWRkcmVzcyBvZiBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgY29udHJhY3QuCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VFcEFkZHIgVGhlIGFkZHJlc3MgdGhhdCBob2xkcyB0aGUgZWFybHkgcHVyY2hhc2VycyBTdGFyIHRva2VucwogICAgICogQHBhcmFtIHBpY29wc0NlcnRpZmllckFkZHIgVGhlIGFkZHJlc3Mgb2YgdGhlIFBJQ09QUyBjZXJ0aWZpZXIuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWUgYWxzbyBodHRwczovL3BpY29wcy5wYXJpdHkuaW8vIy9kZXRhaWxzCiAgICAgKi8KICAgIGZ1bmN0aW9uIFN0YXJiYXNlQ3Jvd2RzYWxlKGFkZHJlc3Mgc3RhcmJhc2VFcEFkZHIsIGFkZHJlc3MgcGljb3BzQ2VydGlmaWVyQWRkcikgewogICAgICAgIHJlcXVpcmUoc3RhcmJhc2VFcEFkZHIgIT0gMCAmJiBwaWNvcHNDZXJ0aWZpZXJBZGRyICE9IDApOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBzdGFyYmFzZUVwQW1lbmRtZW50ID0gU3RhcmJhc2VFYXJseVB1cmNoYXNlQW1lbmRtZW50KHN0YXJiYXNlRXBBZGRyKTsKICAgICAgICBwaWNvcHNDZXJ0aWZpZXIgPSBDZXJ0aWZpZXIocGljb3BzQ2VydGlmaWVyQWRkcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZhbGxiYWNrIGFjY2VwdHMgcGF5bWVudCBmb3IgU3RhciB0b2tlbnMgd2l0aCBFdGgKICAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICByZWRpcmVjdFRvUHVyY2hhc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IFNldHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3RzJyBhZGRyZXNzZXMgYW5kIHNldCB0aGUgbWF4IGNyb3dkc2FsZSBjYXAKICAgICAqIEBwYXJhbSBzdGFyYmFzZVRva2VuQWRkcmVzcyBUb2tlbiBhZGRyZXNzLgogICAgICogQHBhcmFtIF9wdXJjaGFzZVN0YXJ0QmxvY2sgQmxvY2sgbnVtYmVyIHRvIHN0YXJ0IGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlVG9rZW5BZGRyZXNzLCB1aW50MjU2IF9wdXJjaGFzZVN0YXJ0QmxvY2spCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoc3RhcmJhc2VUb2tlbkFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHN0YXJiYXNlVG9rZW4pID09IDApOwogICAgICAgIHN0YXJiYXNlVG9rZW4gPSBBYnN0cmFjdFN0YXJiYXNlVG9rZW4oc3RhcmJhc2VUb2tlbkFkZHJlc3MpOwogICAgICAgIHB1cmNoYXNlU3RhcnRCbG9jayA9IF9wdXJjaGFzZVN0YXJ0QmxvY2s7CgogICAgICAgIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlc0luQ255ID0gdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzKCk7CgogICAgICAgIC8vIHNldCB0aGUgbWF4IGNhcCBvZiB0aGlzIGNyb3dkc2FsZQogICAgICAgIG1heENyb3dkc2FsZUNhcCA9IE1BWF9DQVAuc3ViKHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlc0luQ255KTsKCiAgICAgICAgYXNzZXJ0KG1heENyb3dkc2FsZUNhcCA+IDApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXJzIHJhaXNlZCBmdW5kcyB0byBjb21wYW55J3Mgd2FsbGV0IGFkZHJlc3MgYXQgYW55IGdpdmVuIHRpbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3Rm9yQ29tcGFueSgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIGhhc0JhbGFuY2UKICAgIHsKICAgICAgICBhZGRyZXNzIGNvbXBhbnkgPSBzdGFyYmFzZVRva2VuLmNvbXBhbnkoKTsKICAgICAgICByZXF1aXJlKGNvbXBhbnkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY29tcGFueS50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgdGhlIENOWS9FVEggcmF0ZSB0byByZWNvcmQgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDbnlFdGhSYXRlKHVpbnQyNTYgcmF0ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBjbnlFdGhSYXRlID0gcmF0ZTsKICAgICAgICBDbnlFdGhSYXRlVXBkYXRlZChjbnlFdGhSYXRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHRoZSBDTlkvQlRDIHJhdGUgdG8gcmVjb3JkIHB1cmNoYXNlcyBpbiBDTlkKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlQ255QnRjUmF0ZSh1aW50MjU2IHJhdGUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgY255QnRjUmF0ZSA9IHJhdGU7CiAgICAgICAgQ255QnRjUmF0ZVVwZGF0ZWQoY255QnRjUmF0ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93IGZvciB0aGUgcG9zc2liaWxpdHkgZm9yIGNvbnRyYWN0IG93bmVyIHRvIHN0YXJ0IGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBvd25lclN0YXJ0c0Nyb3dkc2FsZSh1aW50MjU2IHRpbWVzdGFtcCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGFzc2VydChzdGFydERhdGUgPT0gMCAmJiBibG9jay5udW1iZXIgPj0gcHVyY2hhc2VTdGFydEJsb2NrKTsgICAvLyBvdmVyd3JpdGluZyBzdGFydERhdGUgaXMgbm90IHBlcm1pdHRlZCBhbmQgaXQgc2hvdWxkIGJlIGFmdGVyIHRoZSBjcm93ZHNhbGUgc3RhcnQgYmxvY2sKICAgICAgICBzdGFydENyb3dkc2FsZSh0aW1lc3RhbXApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBFbmRzIGNyb3dkc2FsZQogICAgICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgYXQgdGhlIGNyb3dkc2FsZSBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBlbmRDcm93ZHNhbGUodWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBhc3NlcnQodGltZXN0YW1wID4gMCAmJiB0aW1lc3RhbXAgPD0gbm93KTsKICAgICAgICBhc3NlcnQoYmxvY2subnVtYmVyID4gcHVyY2hhc2VTdGFydEJsb2NrICYmIGVuZGVkQXQgPT0gMCk7ICAgLy8gY2Fubm90IGVuZCBiZWZvcmUgaXQgc3RhcnRzIGFuZCBvdmVyd3JpdGluZyB0aW1lIGlzIG5vdCBwZXJtaXR0ZWQKICAgICAgICBlbmRlZEF0ID0gdGltZXN0YW1wOwogICAgICAgIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlc0luQ255ID0gdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255ID0gdG90YWxSYWlzZWRBbW91bnRJbkNueSgpOwogICAgICAgIENyb3dkc2FsZUVuZGVkKGVuZGVkQXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWxpdmVyIHRva2VucyB0byBwdXJjaGFzZXJzIGFjY29yZGluZyB0byB0aGVpciBwdXJjaGFzZSBhbW91bnQgaW4gQ05ZCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UHVyY2hhc2VkVG9rZW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5FbmRlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VzTG9hZGVkKTsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzdGFyYmFzZVRva2VuKSAhPSAwKTsKCiAgICAgICAgLyoKICAgICAgICAgKiDigJxWYWx1ZeKAnSByZWZlcnMgdG8gdGhlIGNvbnRyaWJ1dGlvbiBvZiB0aGUgVXNlcjoKICAgICAgICAgKiAge2Nyb3dkc2FsZV9wdXJjaGFzZXJfdG9rZW5fYW1vdW50fSA9CiAgICAgICAgICogIHtjcm93ZHNhbGVfdG9rZW5fYW1vdW50fSAqIHtjcm93ZHNhbGVQdXJjaGFzZV92YWx1ZX0gLyB7ZWFybHlwdXJjaGFzZV92YWx1ZX0gKyB7Y3Jvd2RzYWxlX3ZhbHVlfS4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGU6IElmIGEgVXNlciBjb250cmlidXRlcyBkdXJpbmcgdGhlIENvbnRyaWJ1dGlvbiBQZXJpb2QgMTAwIENOWSAoaW5jbHVkaW5nIGFwcGxpY2FibGUKICAgICAgICAgKiBCb251cywgaWYgYW55KSBhbmQgdGhlIHRvdGFsIGFtb3VudCBlYXJseSBwdXJjaGFzZXMgYW1vdW50cyB0byA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAqIGFuZCB0b3RhbCBhbW91bnQgcmFpc2VkIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCwgdGhlbiBoZSB3aWxsIGdldAogICAgICAgICAqIDM0Ny4yMiBTVEFSID0gMTI14oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8gMzDigJkwMDDigJkwMDAgQ05ZICsgNuKAmTAwMOKAmTAwMCBDTlkuCiAgICAgICAgKi8KCiAgICAgICAgaWYgKGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl0gPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgY3Jvd2RzYWxlUHVyY2hhc2VWYWx1ZSA9IGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0KICAgICAgICAgICAgICAgIFNhZmVNYXRoLm11bChjcm93ZHNhbGVUb2tlbkFtb3VudCwgY3Jvd2RzYWxlUHVyY2hhc2VWYWx1ZSkgLwogICAgICAgICAgICAgICAgdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255OwoKICAgICAgICAgICAgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnlbbXNnLnNlbmRlcl0gPQogICAgICAgICAgICAgICAgU2FmZU1hdGguYWRkKG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5W21zZy5zZW5kZXJdLCB0b2tlbkNvdW50KTsKICAgICAgICAgICAgYXNzZXJ0KHN0YXJiYXNlVG9rZW4uYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihtc2cuc2VuZGVyLCB0b2tlbkNvdW50KSk7CiAgICAgICAgICAgIG51bU9mRGVsaXZlcmVkQ3Jvd2RzYWxlUHVyY2hhc2VzKys7CiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAqIOKAnFZhbHVl4oCdIHJlZmVycyB0byB0aGUgY29udHJpYnV0aW9uIG9mIHRoZSBVc2VyOgogICAgICAgICAqIHtlYXJseXB1cmNoYXNlcl90b2tlbl9hbW91bnR9ID0KICAgICAgICAgKiB7ZWFybHlwdXJjaGFzZXJfdG9rZW5fYW1vdW50fSAqICh7ZWFybHlwdXJjaGFzZV92YWx1ZX0gLyB7dG90YWxfZWFybHlwdXJjaGFzZV92YWx1ZX0pCiAgICAgICAgICogICsge2Nyb3dkc2FsZV90b2tlbl9hbW91bnR9ICogKHtlYXJseXB1cmNoYXNlX3ZhbHVlfSAvIHtlYXJseXB1cmNoYXNlX3ZhbHVlfSArIHtjcm93ZHNhbGVfdmFsdWV9KS4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGU6IElmIGFuIEVhcmx5IFB1cmNoYXNlciBjb250cmlidXRlcyAxMDAgQ05ZIChpbmNsdWRpbmcgQm9udXMgb2YgMjAlKSBhbmQgdGhlCiAgICAgICAgICogdG90YWwgYW1vdW50IG9mIGVhcmx5IHB1cmNoYXNlcyBhbW91bnRzIHRvIDbigJkwMDDigJkwMDAgQ05ZIGFuZCB0aGUgdG90YWwgYW1vdW50IHJhaXNlZAogICAgICAgICAqIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCBDTlksIHRoZW4gaGUgd2lsbCBnZXQgMTE4MC41NSBTVEFSID0KICAgICAgICAgKiA1MOKAmTAwMOKAmTAwMCBTVEFSICogMTAwIENOWSAvIDbigJkwMDDigJkwMDAgQ05ZICsgMTI14oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8KICAgICAgICAgKiAzMOKAmTAwMOKAmTAwMCBDTlkgKyA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAqLwoKICAgICAgICBpZiAoZWFybHlQdXJjaGFzZWRBbW91bnRCeVttc2cuc2VuZGVyXSA+IDApIHsgIC8vIHNraXAgaWYgaXMgbm90IGFuIGVhcmx5IHB1cmNoYXNlcgogICAgICAgICAgICB1aW50MjU2IGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSA9IGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgdWludDI1NiBlcFRva2VuQ2FsY3VsYXRpb25Gcm9tRVBUb2tlbkFtb3VudCA9IFNhZmVNYXRoLm11bChlYXJseVB1cmNoYXNlVG9rZW5BbW91bnQsIGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSkgLyB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXNJbkNueTsKCiAgICAgICAgICAgIHVpbnQyNTYgZXBUb2tlbkNhbGN1bGF0aW9uRnJvbUNyb3dkc2FsZVRva2VuQW1vdW50ID0gU2FmZU1hdGgubXVsKGNyb3dkc2FsZVRva2VuQW1vdW50LCBlYXJseVB1cmNoYXNlclB1cmNoYXNlVmFsdWUpIC8gdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255OwoKICAgICAgICAgICAgdWludDI1NiBlcFRva2VuQ291bnQgPSBTYWZlTWF0aC5hZGQoZXBUb2tlbkNhbGN1bGF0aW9uRnJvbUVQVG9rZW5BbW91bnQsIGVwVG9rZW5DYWxjdWxhdGlvbkZyb21Dcm93ZHNhbGVUb2tlbkFtb3VudCk7CgogICAgICAgICAgICBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeVttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLmFkZChudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeVttc2cuc2VuZGVyXSwgZXBUb2tlbkNvdW50KTsKICAgICAgICAgICAgYXNzZXJ0KHN0YXJiYXNlVG9rZW4uYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihtc2cuc2VuZGVyLCBlcFRva2VuQ291bnQpKTsKICAgICAgICAgICAgbnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlcysrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IExvYWQgZWFybHkgcHVyY2hhc2VzIGZyb20gdGhlIGNvbnRyYWN0IGtlZXBzIHRyYWNrIG9mIHRoZW0KICAgICAqLwogICAgZnVuY3Rpb24gbG9hZEVhcmx5UHVyY2hhc2VzKCkgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoZWFybHlQdXJjaGFzZXNMb2FkZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAvLyBhbGwgRVBzIGhhdmUgYWxyZWFkeSBiZWVuIGxvYWRlZAogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBudW1PZk9yaWdFcCA9IHN0YXJiYXNlRXBBbWVuZG1lbnQKICAgICAgICAgICAgLnN0YXJiYXNlRWFybHlQdXJjaGFzZSgpCiAgICAgICAgICAgIC5udW1iZXJPZkVhcmx5UHVyY2hhc2VzKCk7CgogICAgICAgIGZvciAodWludDI1NiBpID0gbnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlczsgaSA8IG51bU9mT3JpZ0VwICYmIG1zZy5nYXMgPiAyMDAwMDA7IGkrKykgewogICAgICAgICAgICBpZiAoc3RhcmJhc2VFcEFtZW5kbWVudC5pc0ludmFsaWRFYXJseVB1cmNoYXNlKGkpKSB7CiAgICAgICAgICAgICAgICBudW1PZkxvYWRlZEVhcmx5UHVyY2hhc2VzID0gU2FmZU1hdGguYWRkKG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMsIDEpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIChwdXJjaGFzZXIsIGFtb3VudCwpID0KICAgICAgICAgICAgICAgIHN0YXJiYXNlRXBBbWVuZG1lbnQuaXNBbWVuZGVkRWFybHlQdXJjaGFzZShpKQogICAgICAgICAgICAgICAgPyBzdGFyYmFzZUVwQW1lbmRtZW50LmFtZW5kZWRFYXJseVB1cmNoYXNlcyhpKQogICAgICAgICAgICAgICAgOiBzdGFyYmFzZUVwQW1lbmRtZW50LmVhcmx5UHVyY2hhc2VzKGkpOwogICAgICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbcHVyY2hhc2VyXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZWFybHlQdXJjaGFzZXJzLnB1c2gocHVyY2hhc2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGVhY2ggZWFybHkgcHVyY2hhc2VyIHJlY2VpdmVzIDIwJSBib251cwogICAgICAgICAgICAgICAgdWludDI1NiBib251cyA9IFNhZmVNYXRoLm11bChhbW91bnQsIDIwKSAvIDEwMDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgYW1vdW50V2l0aEJvbnVzID0gU2FmZU1hdGguYWRkKGFtb3VudCwgYm9udXMpOwoKICAgICAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbcHVyY2hhc2VyXSA9IFNhZmVNYXRoLmFkZChlYXJseVB1cmNoYXNlZEFtb3VudEJ5W3B1cmNoYXNlcl0sIGFtb3VudFdpdGhCb251cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgPSBTYWZlTWF0aC5hZGQobnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlcywgMSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnQobnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlcyA8PSBudW1PZk9yaWdFcCk7CiAgICAgICAgaWYgKG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgPT0gbnVtT2ZPcmlnRXApIHsKICAgICAgICAgICAgZWFybHlQdXJjaGFzZXNMb2FkZWQgPSB0cnVlOyAgICAvLyBlbmFibGUgdGhlIGZsYWcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICogQGRldiBTZXQgcXVhbGlmaWVkIGNyb3dkc2FsZSBwYXJ0bmVyIGkuZS4gQml0Y29pbiBTdWlzc2UgYWRkcmVzcwogICAgICAqIEBwYXJhbSBfcXVhbGlmaWVkUGFydG5lciBBZGRyZXNzIG9mIHRoZSBxdWFsaWZpZWQgcGFydG5lciB0aGF0IGNhbiBwdXJjaGFzZSBkdXJpbmcgY3Jvd2RzYWxlCiAgICAgICogQHBhcmFtIF9hbW91bnRDYXAgRXRoZXIgdmFsdWUgd2hpY2ggcGFydG5lciBpcyBhYmxlIHRvIGNvbnRyaWJ1dGUKICAgICAgKiBAcGFyYW0gX2NvbW1pc3Npb25GZWVQZXJjZW50YWdlIEludGVnZXIgdGhhdCByZXByZXNlbnRzIHRoZSBmZWUgdG8gcGF5IHF1YWxpZmllZCBwYXJ0bmVyIDUgaXMgNSUKICAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lciwgdWludDI1NiBfYW1vdW50Q2FwLCB1aW50MjU2IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGFzc2VydCghcXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSB0cnVlOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5hbW91bnRDYXAgPSBfYW1vdW50Q2FwOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA9IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZTsKICAgICAgICBRdWFsaWZpZWRQYXJ0bmVyQWRkcmVzcyhfcXVhbGlmaWVkUGFydG5lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSBhZGRyZXNzIGZyb20gcXVhbGlmaWVkIHBhcnRuZXJzIGxpc3QuCiAgICAgKiBAcGFyYW0gX3F1YWxpZmllZFBhcnRuZXIgQWRkcmVzcyB0byBiZSByZW1vdmVkIGZyb20gdGhlIGxpc3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVubGlzdFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHdoaXRlbGlzdGVkIGFkZHJlc3MgYW1vdW50IGFsbG93ZWQgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICogQHBhcmFtIF9xdWFsaWZpZWRQYXJ0bmVyIFF1YWxpZmllZCBQYXJ0bmVyIGFkZHJlc3MgdG8gYmUgdXBkYXRlZC4KICAgICAqIEBwYXJhbSBfYW1vdW50Q2FwIEFtb3VudCB0aGF0IHRoZSBhZGRyZXNzIGlzIGFibGUgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVRdWFsaWZpZWRQYXJ0bmVyQ2FwQW1vdW50KGFkZHJlc3MgX3F1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgX2Ftb3VudENhcCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYW1vdW50Q2FwID0gX2Ftb3VudENhcDsKICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGJvb2xlYW4gZm9yIHdoZXRoZXIgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKGVuZGVkQXQgPiAwICYmIGVuZGVkQXQgPD0gbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgcHVyY2hhc2VzIHRvIGRhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY3Jvd2RzYWxlUHVyY2hhc2VzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2FsY3VsYXRlcyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZCBpbmNsdWRlcyBib251cyB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGNyb3dkc2FsZVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhbW91bnQgPSBTYWZlTWF0aC5hZGQoYW1vdW50LCBjcm93ZHNhbGVQdXJjaGFzZXNbaV0uYW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgdG90YWwgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQgd2l0aG91dCBib251cyBjb252ZXJzaW9uLgogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KSB7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBjcm93ZHNhbGVQdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguYWRkKGFtb3VudCwgY3Jvd2RzYWxlUHVyY2hhc2VzW2ldLnJhd0Ftb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIHJhaXNlZCBhbW91bnQgaW4gQ05ZIChpbmNsdWRlcyBFUCkgYW5kIGJvbnVzZXMKICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxSYWlzZWRBbW91bnRJbkNueSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmFkZCh0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSwgdG90YWxBbW91bnRPZkNyb3dkc2FsZVB1cmNoYXNlcygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0b3RhbCBhbW91bnQgb2YgZWFybHkgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICByZXR1cm4gc3RhcmJhc2VFcEFtZW5kbWVudC50b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHF1YWxpZmllZCBjcm93ZHNhbGUgcGFydG5lciB0byBwdXJjaGFzZSBTdGFyIFRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBwdXJjaGFzZUFzUXVhbGlmaWVkUGFydG5lcigpCiAgICAgICAgcGF5YWJsZQogICAgICAgIHB1YmxpYwogICAgICAgIHJhdGVJc1NldChjbnlFdGhSYXRlKQogICAgICAgIG9ubHlRdWFsaWZpZWRQYXJ0bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmFtb3VudFJhaXNlZCA9IFNhZmVNYXRoLmFkZChtc2cudmFsdWUsIHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmFtb3VudFJhaXNlZCk7CgogICAgICAgIGFzc2VydChxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5hbW91bnRSYWlzZWQgPD0gcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50Q2FwKTsKCiAgICAgICAgdWludDI1NiByYXdBbW91bnQgPSBTYWZlTWF0aC5tdWwobXNnLnZhbHVlLCBjbnlFdGhSYXRlKSAvIDFlMTg7CiAgICAgICAgcmVjb3JkUHVyY2hhc2UobXNnLnNlbmRlciwgcmF3QW1vdW50LCBub3cpOwoKICAgICAgICBpZiAocXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uY29tbWlzc2lvbkZlZVBlcmNlbnRhZ2UgPiAwKSB7CiAgICAgICAgICAgIHNlbmRRdWFsaWZpZWRQYXJ0bmVyQ29tbWlzc2lvbkZlZShtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB1c2VyIHRvIHB1cmNoYXNlIFNUQVIgdG9rZW5zIHdpdGggRXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VXaXRoRXRoKCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgcHVibGljCiAgICAgICAgbWluSW52ZXN0bWVudAogICAgICAgIHdoZW5Ob3RFbmRlZAogICAgICAgIHJhdGVJc1NldChjbnlFdGhSYXRlKQogICAgICAgIG9ubHlRdWFsaWZpZWRQYXJ0bmVyT1JQaWNvcHNDZXJ0aWZpZWQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUocHVyY2hhc2VTdGFydEJsb2NrID4gMCAmJiBibG9jay5udW1iZXIgPj0gcHVyY2hhc2VTdGFydEJsb2NrKTsKCiAgICAgICAgaWYgKHN0YXJ0RGF0ZSA9PSAwKSB7CiAgICAgICAgICAgIHN0YXJ0Q3Jvd2RzYWxlKGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudCA9IFNhZmVNYXRoLm11bChtc2cudmFsdWUsIGNueUV0aFJhdGUpIC8gMWUxODsKICAgICAgICByZWNvcmRQdXJjaGFzZShtc2cuc2VuZGVyLCByYXdBbW91bnQsIG5vdyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgSW5pdGlhbGl6ZXMgU3RhcmJhc2UgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0Q3Jvd2RzYWxlKHVpbnQyNTYgdGltZXN0YW1wKSBpbnRlcm5hbCB7CiAgICAgICAgc3RhcnREYXRlID0gdGltZXN0YW1wOwogICAgICAgIHVpbnQyNTYgcHJlc2FsZUFtb3VudCA9IHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMoKTsKICAgICAgICBpZiAobWF4Q3Jvd2RzYWxlQ2FwID4gcHJlc2FsZUFtb3VudCkgewogICAgICAgICAgICB1aW50MjU2IG1haW5TYWxlQ2FwID0gbWF4Q3Jvd2RzYWxlQ2FwLnN1YihwcmVzYWxlQW1vdW50KTsKICAgICAgICAgICAgdWludDI1NiB0d2VudHlQZXJjZW50T2ZDcm93ZHNhbGVQdXJjaGFzZSA9IG1haW5TYWxlQ2FwLm11bCgyMCkuZGl2KDEwMCk7CgogICAgICAgICAgICAvLyBzZXQgdG9rZW4gYm9udXMgbWlsZXN0b25lcyBpbiBjbnkgdG90YWwgY3Jvd2RzYWxlIHB1cmNoYXNlCiAgICAgICAgICAgIGZpcnN0Qm9udXNFbmRzID0gIHR3ZW50eVBlcmNlbnRPZkNyb3dkc2FsZVB1cmNoYXNlOwogICAgICAgICAgICBzZWNvbmRCb251c0VuZHMgPSBmaXJzdEJvbnVzRW5kcy5hZGQodHdlbnR5UGVyY2VudE9mQ3Jvd2RzYWxlUHVyY2hhc2UpOwogICAgICAgICAgICB0aGlyZEJvbnVzRW5kcyA9ICBzZWNvbmRCb251c0VuZHMuYWRkKHR3ZW50eVBlcmNlbnRPZkNyb3dkc2FsZVB1cmNoYXNlKTsKICAgICAgICAgICAgZm91cnRoQm9udXNFbmRzID0gdGhpcmRCb251c0VuZHMuYWRkKHR3ZW50eVBlcmNlbnRPZkNyb3dkc2FsZVB1cmNoYXNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFic3RyYWN0IHJlY29yZCBvZiBhIHB1cmNoYXNlIHRvIFRva2VucwogICAgICogQHBhcmFtIHB1cmNoYXNlciBBZGRyZXNzIG9mIHRoZSBidXllcgogICAgICogQHBhcmFtIHJhd0Ftb3VudCBBbW91bnQgaW4gQ05ZIGFzIHBlciB0aGUgQ05ZL0VUSCByYXRlIHVzZWQKICAgICAqIEBwYXJhbSB0aW1lc3RhbXAgVGltZXN0YW1wIGF0IHRoZSBwdXJjaGFzZSBtYWRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlY29yZFB1cmNoYXNlKAogICAgICAgIGFkZHJlc3MgcHVyY2hhc2VyLAogICAgICAgIHVpbnQyNTYgcmF3QW1vdW50LAogICAgICAgIHVpbnQyNTYgdGltZXN0YW1wCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIGFtb3VudCA9IHJhd0Ftb3VudDsgLy8gYW1vdW50IHRvIGNoZWNrIHJlYWNoIG9mIG1heCBjYXAuIGl0IGRvZXMgbm90IGNhcmUgZm9yIGJvbnVzIHRva2VucyBoZXJlCgogICAgICAgIC8vIHByZXNhbGUgdHJhbnNmZXJzIHdoaWNoIG9jY3VycyBiZWZvcmUgdGhlIGNyb3dkc2FsZSBpZ25vcmVzIHRoZSBjcm93ZHNhbGUgaGFyZCBjYXAKICAgICAgICBpZiAoYmxvY2subnVtYmVyID49IHB1cmNoYXNlU3RhcnRCbG9jaykgewogICAgICAgICAgICByZXF1aXJlKHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMoKSA8IG1heENyb3dkc2FsZUNhcCk7ICAgLy8gY2hlY2sgaWYgdGhlIGFtb3VudCBoYXMgYWxyZWFkeSByZWFjaGVkIHRoZSBjYXAKCiAgICAgICAgICAgIHVpbnQyNTYgY3Jvd2RzYWxlVG90YWxBbW91bnRBZnRlclB1cmNoYXNlID0KICAgICAgICAgICAgICAgIFNhZmVNYXRoLmFkZCh0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzKCksIGFtb3VudCk7CgogICAgICAgICAgICAvLyBjaGVjayB3aGV0aGVyIHB1cmNoYXNlIGdvZXMgb3ZlciB0aGUgY2FwIGFuZCBzZW5kIHRoZSBkaWZmZXJlbmNlIGJhY2sgdG8gdGhlIHB1cmNoYXNlci4KICAgICAgICAgICAgaWYgKGNyb3dkc2FsZVRvdGFsQW1vdW50QWZ0ZXJQdXJjaGFzZSA+IG1heENyb3dkc2FsZUNhcCkgewogICAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IFNhZmVNYXRoLnN1Yihjcm93ZHNhbGVUb3RhbEFtb3VudEFmdGVyUHVyY2hhc2UsIG1heENyb3dkc2FsZUNhcCk7CiAgICAgICAgICAgICAgdWludDI1NiBldGhWYWx1ZVRvUmV0dXJuID0gU2FmZU1hdGgubXVsKGRpZmZlcmVuY2UsIDFlMTgpIC8gY255RXRoUmF0ZTsKICAgICAgICAgICAgICBwdXJjaGFzZXIudHJhbnNmZXIoZXRoVmFsdWVUb1JldHVybik7CiAgICAgICAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguc3ViKGFtb3VudCwgZGlmZmVyZW5jZSk7CiAgICAgICAgICAgICAgcmF3QW1vdW50ID0gYW1vdW50OwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgYW1vdW50ID0gZ2V0Qm9udXNBbW91bnRDYWxjdWxhdGlvbihhbW91bnQpOyAvLyBhdCB0aGlzIHBvaW50IGFtb3VudCBib251cyBpcyBjYWxjdWxhdGVkCgogICAgICAgIENyb3dkc2FsZVB1cmNoYXNlIG1lbW9yeSBwdXJjaGFzZSA9IENyb3dkc2FsZVB1cmNoYXNlKHB1cmNoYXNlciwgYW1vdW50LCByYXdBbW91bnQsIHRpbWVzdGFtcCk7CiAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VzLnB1c2gocHVyY2hhc2UpOwogICAgICAgIFN0YXJiYXNlUHVyY2hhc2VkV2l0aEV0aChtc2cuc2VuZGVyLCBhbW91bnQsIHJhd0Ftb3VudCwgY255RXRoUmF0ZSk7CiAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VBbW91bnRCeVtwdXJjaGFzZXJdID0gU2FmZU1hdGguYWRkKGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbcHVyY2hhc2VyXSwgYW1vdW50KTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDYWxjdWxhdGVzIGFtb3VudCB3aXRoIGJvbnVzIGZvciBib251cyBtaWxlc3RvbmVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUJvbnVzCiAgICAgICAgKAogICAgICAgICAgICBCb251c01pbGVzdG9uZXMgbmV4dE1pbGVzdG9uZSwKICAgICAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgICAgIHVpbnQyNTYgYm9udXNSYW5nZSwKICAgICAgICAgICAgdWludDI1NiBib251c1RpZXIsCiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0cwogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYgcmVzdWx0LCB1aW50MjU2IG5ld0Ftb3VudCkKICAgIHsKICAgICAgICB1aW50MjU2IGJvbnVzQ2FsYzsKCiAgICAgICAgaWYgKGFtb3VudCA8PSBib251c1JhbmdlKSB7CiAgICAgICAgICAgIGJvbnVzQ2FsYyA9IGFtb3VudC5tdWwoYm9udXNUaWVyKS5kaXYoMTAwKTsKCiAgICAgICAgICAgIGlmIChhbW91bnQuYWRkKHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMoKSkgPj0gYm9udXNSYW5nZSkKICAgICAgICAgICAgICAgIGJvbnVzTWlsZXN0b25lcyA9IG5leHRNaWxlc3RvbmU7CgogICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzLmFkZChhbW91bnQpLmFkZChib251c0NhbGMpOwogICAgICAgICAgICBuZXdBbW91bnQgPSAwOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBib251c0NhbGMgPSBib251c1JhbmdlLm11bChib251c1RpZXIpLmRpdigxMDApOwogICAgICAgICAgICBib251c01pbGVzdG9uZXMgPSBuZXh0TWlsZXN0b25lOwogICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzLmFkZChib251c1JhbmdlKS5hZGQoYm9udXNDYWxjKTsKICAgICAgICAgICAgbmV3QW1vdW50ID0gYW1vdW50LnN1Yihib251c1JhbmdlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZldGNocyBCb251cyB0aWVyIHBlcmNlbnRhZ2UgcGVyIGJvbnVzIG1pbGVzdG9uZXMKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Qm9udXNBbW91bnRDYWxjdWxhdGlvbih1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPCBwdXJjaGFzZVN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgdWludDI1NiBib251c0Zyb21BbW91bnQgPSBhbW91bnQubXVsKDMwKS5kaXYoMTAwKTsgLy8gcHJlc2FsZSBoYXMgMzAlIGJvbnVzCiAgICAgICAgICAgIHJldHVybiBhbW91bnQuYWRkKGJvbnVzRnJvbUFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyByYW5nZSBvZiBlYWNoIGJvbnVzIG1pbGVzdG9uZXMKICAgICAgICB1aW50MjU2IGZpcnN0Qm9udXNSYW5nZSA9IGZpcnN0Qm9udXNFbmRzOwogICAgICAgIHVpbnQyNTYgc2Vjb25kQm9udXNSYW5nZSA9IHNlY29uZEJvbnVzRW5kcy5zdWIoZmlyc3RCb251c0VuZHMpOwogICAgICAgIHVpbnQyNTYgdGhpcmRCb251c1JhbmdlID0gdGhpcmRCb251c0VuZHMuc3ViKHNlY29uZEJvbnVzRW5kcyk7CiAgICAgICAgdWludDI1NiBmb3VydGhCb251c1JhbmdlID0gZm91cnRoQm9udXNFbmRzLnN1Yih0aGlyZEJvbnVzRW5kcyk7CiAgICAgICAgdWludDI1NiByZXN1bHQ7CgogICAgICAgIGlmIChib251c01pbGVzdG9uZXMgPT0gQm9udXNNaWxlc3RvbmVzLkZpcnN0KQogICAgICAgICAgICAocmVzdWx0LCBhbW91bnQpID0gY2FsY3VsYXRlQm9udXMoQm9udXNNaWxlc3RvbmVzLlNlY29uZCwgYW1vdW50LCBmaXJzdEJvbnVzUmFuZ2UsIDIwLCByZXN1bHQpOwoKICAgICAgICBpZiAoYm9udXNNaWxlc3RvbmVzID09IEJvbnVzTWlsZXN0b25lcy5TZWNvbmQpCiAgICAgICAgICAgIChyZXN1bHQsIGFtb3VudCkgPSBjYWxjdWxhdGVCb251cyhCb251c01pbGVzdG9uZXMuVGhpcmQsIGFtb3VudCwgc2Vjb25kQm9udXNSYW5nZSwgMTUsIHJlc3VsdCk7CgogICAgICAgIGlmIChib251c01pbGVzdG9uZXMgPT0gQm9udXNNaWxlc3RvbmVzLlRoaXJkKQogICAgICAgICAgICAocmVzdWx0LCBhbW91bnQpID0gY2FsY3VsYXRlQm9udXMoQm9udXNNaWxlc3RvbmVzLkZvdXJ0aCwgYW1vdW50LCB0aGlyZEJvbnVzUmFuZ2UsIDEwLCByZXN1bHQpOwoKICAgICAgICBpZiAoYm9udXNNaWxlc3RvbmVzID09IEJvbnVzTWlsZXN0b25lcy5Gb3VydGgpCiAgICAgICAgICAgIChyZXN1bHQsIGFtb3VudCkgPSBjYWxjdWxhdGVCb251cyhCb251c01pbGVzdG9uZXMuRmlmdGgsIGFtb3VudCwgZm91cnRoQm9udXNSYW5nZSwgNSwgcmVzdWx0KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdC5hZGQoYW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmV0Y2hzIEJvbnVzIHRpZXIgcGVyY2VudGFnZSBwZXIgYm9udXMgbWlsZXN0b25lcwogICAgICogQGRldiBxdWFsaWZpZWRQYXJ0bmVyIEFkZHJlc3Mgb2YgcGFydG5lcnMgdGhhdCBwYXJ0aWNpcGF0ZWQgaW4gcHJlIHNhbGUKICAgICAqIEBkZXYgYW1vdW50U2VudCBWYWx1ZSBzZW50IGJ5IHF1YWxpZmllZCBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbmRRdWFsaWZpZWRQYXJ0bmVyQ29tbWlzc2lvbkZlZShhZGRyZXNzIHF1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgYW1vdW50U2VudCkgaW50ZXJuYWwgewogICAgICAgIC8vY2FsY3VsYXRlIHRoZSBjb21taXNzaW9uIGZlZSB0byBzZW5kIHRvIHF1YWxpZmllZCBwYXJ0bmVyCiAgICAgICAgdWludDI1NiBjb21taXNzaW9uRmVlUGVyY2VudGFnZUNhbGN1bGF0aW9uQW1vdW50ID0gU2FmZU1hdGgubXVsKGFtb3VudFNlbnQsIHF1YWxpZmllZFBhcnRuZXJzW3F1YWxpZmllZFBhcnRuZXJdLmNvbW1pc3Npb25GZWVQZXJjZW50YWdlKSAvIDEwMDsKCiAgICAgICAgLy8gc2VuZCBjb21taXNzaW9uIGZlZSBhbW91bnQKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyLnRyYW5zZmVyKGNvbW1pc3Npb25GZWVQZXJjZW50YWdlQ2FsY3VsYXRpb25BbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZWRpcmVjdFRvUHVyY2hhc2UgUmVkaXJlY3QgdG8gYWRlcXVhdGUgcHVyY2hhc2UgZnVuY3Rpb24gd2l0aGluIHRoZSBzbWFydCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiByZWRpcmVjdFRvUHVyY2hhc2UoKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8IHB1cmNoYXNlU3RhcnRCbG9jaykgewogICAgICAgICAgICBwdXJjaGFzZUFzUXVhbGlmaWVkUGFydG5lcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1cmNoYXNlV2l0aEV0aCgpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
