Class {
	#name : #SRT25984508b7060e460b224c8d5c7eb4fae76e440c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT25984508b7060e460b224c8d5c7eb4fae76e440c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBXb2xmIENyeXB0byBwb29saW5nIGNvbnRyYWN0IGZvciBBbGNoZW1pbnQKLy8gd3JpdHRlbiBieSBAaWFtZGVmaW5pdGVseWFodW1hbgoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgpjb250cmFjdCBFUkMyMCB7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHt9CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9Cn0KCgpjb250cmFjdCBXaGl0ZUxpc3QgewogICBmdW5jdGlvbiBjaGVja01lbWJlckxldmVsIChhZGRyZXNzIGFkZHIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQpIHt9Cn0KCgpjb250cmFjdCBQcmVzYWxlUG9vbCB7CgogIC8vIFNhZmVNYXRoIGlzIGEgbGlicmFyeSB0byBlbnN1cmUgdGhhdCBtYXRoIG9wZXJhdGlvbnMgZG8gbm90IGhhdmUgb3ZlcmZsb3cgZXJyb3JzCiAgLy8gaHR0cHM6Ly96ZXBwZWxpbi1zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9sYXRlc3Qvc2FmZW1hdGguaHRtbAogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogIAogIC8vIFRoZSBjb250cmFjdCBoYXMgMyBzdGFnZXM6CiAgLy8gMSAtIFRoZSBpbml0aWFsIHN0YXRlLiBUaGUgb3duZXIgaXMgYWJsZSB0byBhZGQgYWRkcmVzc2VzIHRvIHRoZSB3aGl0ZWxpc3QsIGFuZCBhbnkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzIGNhbiBkZXBvc2l0IG9yIHdpdGhkcmF3IGV0aCB0byB0aGUgY29udHJhY3QuCiAgLy8gMiAtIFRoZSBvd25lciBoYXMgY2xvc2VkIHRoZSBjb250cmFjdCBmb3IgZnVydGhlciBkZXBvc2l0cy4gV2hpdGVsaXN0ZWQgYWRkcmVzc2VzIGNhbiBzdGlsbCB3aXRoZHJhdyBldGggZnJvbSB0aGUgY29udHJhY3QuCiAgLy8gMyAtIFRoZSBldGggaXMgc2VudCBmcm9tIHRoZSBjb250cmFjdCB0byB0aGUgcmVjZWl2ZXIuIFVudXNlZCBldGggY2FuIGJlIGNsYWltZWQgYnkgY29udHJpYnV0b3JzIGltbWVkaWF0ZWx5LiBPbmNlIHRva2VucyBhcmUgc2VudCB0byB0aGUgY29udHJhY3QsCiAgLy8gICAgIHRoZSBvd25lciBlbmFibGVzIHdpdGhkcmF3YWxzIGFuZCBjb250cmlidXRvcnMgY2FuIHdpdGhkcmF3IHRoZWlyIHRva2Vucy4KICB1aW50OCBwdWJsaWMgY29udHJhY3RTdGFnZSA9IDE7CiAgCiAgLy8gVGhlc2UgdmFyaWFibGVzIGFyZSBzZXQgYXQgdGhlIHRpbWUgb2YgY29udHJhY3QgY3JlYXRpb24KICAvLyBhZGRyZXNzIHRoYXQgY3JlYXRlcyB0aGUgY29udHJhY3QKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAvLyBtYXhpbXVtIGV0aCBhbW91bnQgKGluIHdlaSkgdGhhdCBjYW4gYmUgc2VudCBieSBhIHdoaXRlbGlzdGVkIGFkZHJlc3MKICB1aW50W10gcHVibGljIGNvbnRyaWJ1dGlvbkNhcHM7CiAgLy8gdGhlICUgb2YgdG9rZW5zIGtlcHQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCiAgdWludCBwdWJsaWMgZmVlUGN0OwogIC8vIHRoZSBhZGRyZXNzIHRoYXQgdGhlIHBvb2wgd2lsbCBiZSBwYWlkIG91dCB0bwogIGFkZHJlc3MgcHVibGljIHJlY2VpdmVyQWRkcmVzczsKICAKICAvLyBUaGVzZSBjb25zdGFudCB2YXJpYWJsZXMgZG8gbm90IGNoYW5nZSB3aXRoIGVhY2ggY29udHJhY3QgZGVwbG95bWVudAogIC8vIG1pbmltdW0gZXRoIGFtb3VudCAoaW4gd2VpKSB0aGF0IGNhbiBiZSBzZW50IGJ5IGEgd2hpdGVsaXN0ZWQgYWRkcmVzcwogIHVpbnQgY29uc3RhbnQgcHVibGljIGNvbnRyaWJ1dGlvbk1pbiA9IDEwMDAwMDAwMDAwMDAwMDAwMDsKICAvLyBtYXhpbXVtIGdhcyBwcmljZSBhbGxvd2VkIGZvciBkZXBvc2l0cyBpbiBzdGFnZSAxCiAgdWludCBjb25zdGFudCBwdWJsaWMgbWF4R2FzUHJpY2UgPSA1MDAwMDAwMDAwMDsKICAvLyB3aGl0ZWxpc3RpbmcgY29udHJhY3QKICBXaGl0ZUxpc3QgY29uc3RhbnQgcHVibGljIHdoaXRlbGlzdENvbnRyYWN0ID0gV2hpdGVMaXN0KDB4OEQ5NUIwMzhjQTgwQTk4NjQyNUZBMjQwQzNDMTdGYjJCNmU5YmM2Myk7CiAgCiAgCiAgLy8gVGhlc2UgdmFyaWFibGVzIGFyZSBhbGwgaW5pdGlhbGx5IHNldCB0byAwIGFuZCB3aWxsIGJlIHNldCBhdCBzb21lIHBvaW50IGR1cmluZyB0aGUgY29udHJhY3QKICAvLyBlcG9jaCB0aW1lIHRoYXQgdGhlIG5leHQgY29udHJpYnV0aW9uIGNhcHMgYmVjb21lIGFjdGl2ZQogIHVpbnQgcHVibGljIG5leHRDYXBUaW1lOwogIC8vIHBlbmRpbmcgY29udHJpYnV0aW9uIGNhcHMKICB1aW50IFtdIHB1YmxpYyBuZXh0Q29udHJpYnV0aW9uQ2FwczsKICAvLyBibG9jayBudW1iZXIgb2YgdGhlIGxhc3QgY2hhbmdlIHRvIHRoZSByZWNlaXZpbmcgYWRkcmVzcyAoc2V0IGlmIHJlY2VpdmluZyBhZGRyZXNzIGlzIGNoYW5nZWQsIHN0YWdlIDEgb3IgMikKICB1aW50IHB1YmxpYyBhZGRyZXNzQ2hhbmdlQmxvY2s7CiAgLy8gYW1vdW50IG9mIGV0aCAoaW4gd2VpKSBwcmVzZW50IGluIHRoZSBjb250cmFjdCB3aGVuIGl0IHdhcyBzdWJtaXR0ZWQKICB1aW50IHB1YmxpYyBmaW5hbEJhbGFuY2U7CiAgLy8gYXJyYXkgY29udGFpbmluZyBldGggYW1vdW50cyB0byBiZSByZWZ1bmRlZCBpbiBzdGFnZSAzCiAgdWludFtdIHB1YmxpYyBldGhSZWZ1bmRBbW91bnQ7CiAgLy8gZGVmYXVsdCB0b2tlbiBjb250cmFjdCB0byBiZSB1c2VkIGZvciB3aXRoZHJhd2luZyB0b2tlbnMgaW4gc3RhZ2UgMwogIGFkZHJlc3MgcHVibGljIGFjdGl2ZVRva2VuOwogIAogIC8vIGRhdGEgc3RydWN0dXJlIGZvciBob2xkaW5nIHRoZSBjb250cmlidXRpb24gYW1vdW50LCBjYXAsIGV0aCByZWZ1bmQgc3RhdHVzLCBhbmQgdG9rZW4gd2l0aGRyYXdhbCBzdGF0dXMgZm9yIGVhY2ggd2hpdGVsaXN0ZWQgYWRkcmVzcwogIHN0cnVjdCBDb250cmlidXRvciB7CiAgICBib29sIGF1dGhvcml6ZWQ7CiAgICB1aW50IGV0aFJlZnVuZDsKICAgIHVpbnQgYmFsYW5jZTsKICAgIHVpbnQgY2FwOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSB0b2tlbnNDbGFpbWVkOwogIH0KICAvLyBtYXBwaW5nIHRoYXQgaG9sZHMgdGhlIGNvbnRyaWJ1dG9yIHN0cnVjdCBmb3IgZWFjaCB3aGl0ZWxpc3RlZCBhZGRyZXNzCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBDb250cmlidXRvcikgd2hpdGVsaXN0OwogIAogIC8vIGRhdGEgc3RydWN0dXJlIGZvciBob2xkaW5nIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gdG9rZW4gd2l0aGRyYXdhbHMuCiAgc3RydWN0IFRva2VuQWxsb2NhdGlvbiB7CiAgICBFUkMyMCB0b2tlbjsKICAgIHVpbnRbXSBwY3Q7CiAgICB1aW50IGJhbGFuY2VSZW1haW5pbmc7CiAgfQogIC8vIG1hcHBpbmcgdGhhdCBob2xkcyB0aGUgdG9rZW4gYWxsb2NhdGlvbiBzdHJ1Y3QgZm9yIGVhY2ggdG9rZW4gYWRkcmVzcwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5BbGxvY2F0aW9uKSBkaXN0cmlidXRpb25NYXA7CiAgCiAgCiAgLy8gbW9kaWZpZXIgZm9yIGZ1bmN0aW9ucyB0aGF0IGNhbiBvbmx5IGJlIGFjY2Vzc2VkIGJ5IHRoZSBjb250cmFjdCBjcmVhdG9yCiAgbW9kaWZpZXIgb25seU93bmVyICgpIHsKICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CiAgCiAgLy8gbW9kaWZpZXIgdG8gcHJldmVudCByZS1lbnRyYW5jeSBleHBsb2l0cyBkdXJpbmcgY29udHJhY3QgPiBjb250cmFjdCBpbnRlcmFjdGlvbgogIGJvb2wgbG9ja2VkOwogIG1vZGlmaWVyIG5vUmVlbnRyYW5jeSgpIHsKICAgIHJlcXVpcmUoIWxvY2tlZCk7CiAgICBsb2NrZWQgPSB0cnVlOwogICAgXzsKICAgIGxvY2tlZCA9IGZhbHNlOwogIH0KICAKICAvLyBFdmVudHMgdHJpZ2dlcmVkIHRocm91Z2hvdXQgY29udHJhY3QgZXhlY3V0aW9uCiAgLy8gVGhlc2UgY2FuIGJlIHdhdGNoZWQgdmlhIGdldGggZmlsdGVycyB0byBrZWVwIHVwLXRvLWRhdGUgd2l0aCB0aGUgY29udHJhY3QKICBldmVudCBDb250cmlidXRvckJhbGFuY2VDaGFuZ2VkIChhZGRyZXNzIGNvbnRyaWJ1dG9yLCB1aW50IHRvdGFsQmFsYW5jZSk7CiAgZXZlbnQgUmVjZWl2ZXJBZGRyZXNzU2V0ICggYWRkcmVzcyBfYWRkcik7CiAgZXZlbnQgUG9vbFN1Ym1pdHRlZCAoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwogIGV2ZW50IFdpdGhkcmF3YWxzT3BlbiAoYWRkcmVzcyB0b2tlbkFkZHIpOwogIGV2ZW50IEV0aFJlZnVuZFJlY2VpdmVkIChhZGRyZXNzIHNlbmRlciwgdWludCBhbW91bnQpOwogIGV2ZW50IEV0aFJlZnVuZGVkIChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgVG9rZW5zV2l0aGRyYXduIChhZGRyZXNzIHJlY2VpdmVyLCBhZGRyZXNzIHRva2VuLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgRVJDMjIzUmVjZWl2ZWQgKGFkZHJlc3MgdG9rZW4sIHVpbnQgdmFsdWUpOwogICAKICAvLyBUaGVzZSBhcmUgaW50ZXJuYWwgZnVuY3Rpb25zIHVzZWQgZm9yIGNhbGN1bGF0aW5nIGZlZXMsIGV0aCBhbmQgdG9rZW4gYWxsb2NhdGlvbnMgYXMgJQogIC8vIHJldHVybnMgYSB2YWx1ZSBhcyBhICUgYWNjdXJhdGUgdG8gMjAgZGVjaW1hbCBwb2ludHMKICBmdW5jdGlvbiBfdG9QY3QgKHVpbnQgbnVtZXJhdG9yLCB1aW50IGRlbm9taW5hdG9yICkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gbnVtZXJhdG9yLm11bCgxMCAqKiAyMCkgLyBkZW5vbWluYXRvcjsKICB9CiAgCiAgLy8gcmV0dXJucyAlIG9mIGFueSBudW1iZXIsIHdoZXJlICUgZ2l2ZW4gd2FzIGdlbmVyYXRlZCB3aXRoIHRvUGN0CiAgZnVuY3Rpb24gX2FwcGx5UGN0ICh1aW50IG51bWVyYXRvciwgdWludCBwY3QpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIG51bWVyYXRvci5tdWwocGN0KSAvICgxMCAqKiAyMCk7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGF0IHRoZSB0aW1lIG9mIGNvbnRyYWN0IGNyZWF0aW9uLAogIC8vIGl0IHNldHMgdGhlIGluaXRpYWwgdmFyaWFibGVzIGFuZCB3aGl0ZWxpc3RzIHRoZSBjb250cmFjdCBvd25lci4KICBmdW5jdGlvbiBQcmVzYWxlUG9vbChhZGRyZXNzIHJlY2VpdmVyQWRkciwgdWludFtdIGNhcEFtb3VudHMsIHVpbnQgZmVlKSBwdWJsaWMgewogICAgcmVxdWlyZSAoZmVlIDwgMTAwKTsKICAgIHJlcXVpcmUgKGNhcEFtb3VudHMubGVuZ3RoPjEgJiYgY2FwQW1vdW50cy5sZW5ndGg8MjU2KTsKICAgIGZvciAodWludDggaT0xOyBpPGNhcEFtb3VudHMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVxdWlyZSAoY2FwQW1vdW50c1tpXSA8PSBjYXBBbW91bnRzWzBdKTsKICAgIH0KICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIHJlY2VpdmVyQWRkcmVzcyA9IHJlY2VpdmVyQWRkcjsKICAgIGNvbnRyaWJ1dGlvbkNhcHMgPSBjYXBBbW91bnRzOwogICAgZmVlUGN0ID0gX3RvUGN0KGZlZSwxMDApOwogICAgd2hpdGVsaXN0W21zZy5zZW5kZXJdLmF1dGhvcml6ZWQgPSB0cnVlOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuZXZlciBldGggaXMgc2VudCBpbnRvIHRoZSBjb250cmFjdC4KICAvLyBUaGUgc2VuZCB3aWxsIGZhaWwgdW5sZXNzIHRoZSBjb250cmFjdCBpcyBpbiBzdGFnZSBvbmUgYW5kIHRoZSBzZW5kZXIgaGFzIGJlZW4gd2hpdGVsaXN0ZWQuCiAgLy8gVGhlIGFtb3VudCBzZW50IGlzIGFkZGVkIHRvIHRoZSBiYWxhbmNlIGluIHRoZSBDb250cmlidXRvciBzdHJ1Y3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZW5kaW5nIGFkZHJlc3MuCiAgZnVuY3Rpb24gKCkgcGF5YWJsZSBwdWJsaWMgewogICAgaWYgKGNvbnRyYWN0U3RhZ2UgPT0gMSkgewogICAgICBfZXRoRGVwb3NpdCgpOwogICAgfSBlbHNlIGlmIChjb250cmFjdFN0YWdlID09IDMpIHsKICAgICAgX2V0aFJlZnVuZCgpOwogICAgfSBlbHNlIHJldmVydCgpOwogIH0KICAKICAvLyBJbnRlcm5hbCBmdW5jdGlvbiBmb3IgaGFuZGxpbmcgZXRoIGRlcG9zaXRzIGR1cmluZyBjb250cmFjdCBzdGFnZSBvbmUuCiAgZnVuY3Rpb24gX2V0aERlcG9zaXQgKCkgaW50ZXJuYWwgewogICAgYXNzZXJ0IChjb250cmFjdFN0YWdlID09IDEpOwogICAgcmVxdWlyZSAodHguZ2FzcHJpY2UgPD0gbWF4R2FzUHJpY2UpOwogICAgcmVxdWlyZSAodGhpcy5iYWxhbmNlIDw9IGNvbnRyaWJ1dGlvbkNhcHNbMF0pOwogICAgdmFyIGMgPSB3aGl0ZWxpc3RbbXNnLnNlbmRlcl07CiAgICB1aW50IG5ld0JhbGFuY2UgPSBjLmJhbGFuY2UuYWRkKG1zZy52YWx1ZSk7CiAgICByZXF1aXJlIChuZXdCYWxhbmNlID49IGNvbnRyaWJ1dGlvbk1pbik7CiAgICByZXF1aXJlIChuZXdCYWxhbmNlIDw9IF9jaGVja0NhcChtc2cuc2VuZGVyKSk7CiAgICBjLmJhbGFuY2UgPSBuZXdCYWxhbmNlOwogICAgQ29udHJpYnV0b3JCYWxhbmNlQ2hhbmdlZChtc2cuc2VuZGVyLCBuZXdCYWxhbmNlKTsKICB9CiAgCiAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gZm9yIGhhbmRsaW5nIGV0aCByZWZ1bmRzIGR1cmluZyBzdGFnZSB0aHJlZS4KICBmdW5jdGlvbiBfZXRoUmVmdW5kICgpIGludGVybmFsIHsKICAgIGFzc2VydCAoY29udHJhY3RTdGFnZSA9PSAzKTsKICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSByZWNlaXZlckFkZHJlc3MpOwogICAgcmVxdWlyZSAobXNnLnZhbHVlID49IGNvbnRyaWJ1dGlvbk1pbik7CiAgICBldGhSZWZ1bmRBbW91bnQucHVzaChtc2cudmFsdWUpOwogICAgRXRoUmVmdW5kUmVjZWl2ZWQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgdG8gd2l0aGRyYXcgZXRoIG9yIHRva2VucyBmcm9tIHRoZSBjb250cmFjdC4KICAvLyBJdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgYWRkcmVzc2VzIHRoYXQgYXJlIHdoaXRlbGlzdGVkIGFuZCBzaG93IGEgYmFsYW5jZSBncmVhdGVyIHRoYW4gMC4KICAvLyBJZiBjYWxsZWQgZHVyaW5nIHN0YWdlcyBvbmUgb3IgdHdvLCB0aGUgZnVsbCBldGggYmFsYW5jZSBkZXBvc2l0ZWQgaW50byB0aGUgY29udHJhY3QgaXMgcmV0dXJuZWQgYW5kIHRoZSBjb250cmlidXRvcidzIGJhbGFuY2UgcmVzZXQgdG8gMC4KICAvLyBJZiBjYWxsZWQgZHVyaW5nIHN0YWdlIHRocmVlLCB0aGUgY29udHJpYnV0b3IncyB1bnVzZWQgZXRoIHdpbGwgYmUgcmV0dXJuZWQsIGFzIHdlbGwgYXMgYW55IGF2YWlsYWJsZSB0b2tlbnMuCiAgLy8gVGhlIHRva2VuIGFkZHJlc3MgbWF5IGJlIHByb3ZpZGVkIG9wdGlvbmFsbHkgdG8gd2l0aGRyYXcgdG9rZW5zIHRoYXQgYXJlIG5vdCBjdXJyZW50bHkgdGhlIGRlZmF1bHQgdG9rZW4gKGFpcmRyb3BzKS4KICBmdW5jdGlvbiB3aXRoZHJhdyAoYWRkcmVzcyB0b2tlbkFkZHIpIHB1YmxpYyB7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFttc2cuc2VuZGVyXTsKICAgIHJlcXVpcmUgKGMuYmFsYW5jZSA+IDApOwogICAgaWYgKGNvbnRyYWN0U3RhZ2UgPCAzKSB7CiAgICAgIHVpbnQgYW1vdW50VG9UcmFuc2ZlciA9IGMuYmFsYW5jZTsKICAgICAgYy5iYWxhbmNlID0gMDsKICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnRUb1RyYW5zZmVyKTsKICAgICAgQ29udHJpYnV0b3JCYWxhbmNlQ2hhbmdlZChtc2cuc2VuZGVyLCAwKTsKICAgIH0gZWxzZSB7CiAgICAgIF93aXRoZHJhdyhtc2cuc2VuZGVyLHRva2VuQWRkcik7CiAgICB9ICAKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIGNvbnRyYWN0IG93bmVyIHRvIGZvcmNlIGEgd2l0aGRyYXdhbCB0byBhbnkgY29udHJpYnV0b3IuCiAgZnVuY3Rpb24gd2l0aGRyYXdGb3IgKGFkZHJlc3MgY29udHJpYnV0b3IsIGFkZHJlc3MgdG9rZW5BZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPT0gMyk7CiAgICByZXF1aXJlICh3aGl0ZWxpc3RbY29udHJpYnV0b3JdLmJhbGFuY2UgPiAwKTsKICAgIF93aXRoZHJhdyhjb250cmlidXRvcix0b2tlbkFkZHIpOwogIH0KICAKICAvLyBUaGlzIGludGVybmFsIGZ1bmN0aW9uIGhhbmRsZXMgd2l0aGRyYXdhbHMgZHVyaW5nIHN0YWdlIHRocmVlLgogIC8vIFRoZSBhc3NvY2lhdGVkIGV2ZW50cyB3aWxsIGZpcmUgdG8gbm90aWZ5IHdoZW4gYSByZWZ1bmQgb3IgdG9rZW4gYWxsb2NhdGlvbiBpcyBjbGFpbWVkLgogIGZ1bmN0aW9uIF93aXRoZHJhdyAoYWRkcmVzcyByZWNlaXZlciwgYWRkcmVzcyB0b2tlbkFkZHIpIGludGVybmFsIHsKICAgIGFzc2VydCAoY29udHJhY3RTdGFnZSA9PSAzKTsKICAgIHZhciBjID0gd2hpdGVsaXN0W3JlY2VpdmVyXTsKICAgIGlmICh0b2tlbkFkZHIgPT0gMHgwMCkgewogICAgICB0b2tlbkFkZHIgPSBhY3RpdmVUb2tlbjsKICAgIH0KICAgIHZhciBkID0gZGlzdHJpYnV0aW9uTWFwW3Rva2VuQWRkcl07CiAgICByZXF1aXJlICggKGV0aFJlZnVuZEFtb3VudC5sZW5ndGggPiBjLmV0aFJlZnVuZCkgfHwgZC5wY3QubGVuZ3RoID4gYy50b2tlbnNDbGFpbWVkW3Rva2VuQWRkcl0gKTsKICAgIGlmIChldGhSZWZ1bmRBbW91bnQubGVuZ3RoID4gYy5ldGhSZWZ1bmQpIHsKICAgICAgdWludCBwY3QgPSBfdG9QY3QoYy5iYWxhbmNlLGZpbmFsQmFsYW5jZSk7CiAgICAgIHVpbnQgZXRoQW1vdW50ID0gMDsKICAgICAgZm9yICh1aW50IGk9Yy5ldGhSZWZ1bmQ7IGk8ZXRoUmVmdW5kQW1vdW50Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXRoQW1vdW50ID0gZXRoQW1vdW50LmFkZChfYXBwbHlQY3QoZXRoUmVmdW5kQW1vdW50W2ldLHBjdCkpOwogICAgICB9CiAgICAgIGMuZXRoUmVmdW5kID0gZXRoUmVmdW5kQW1vdW50Lmxlbmd0aDsKICAgICAgaWYgKGV0aEFtb3VudCA+IDApIHsKICAgICAgICByZWNlaXZlci50cmFuc2ZlcihldGhBbW91bnQpOwogICAgICAgIEV0aFJlZnVuZGVkKHJlY2VpdmVyLGV0aEFtb3VudCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChkLnBjdC5sZW5ndGggPiBjLnRva2Vuc0NsYWltZWRbdG9rZW5BZGRyXSkgewogICAgICB1aW50IHRva2VuQW1vdW50ID0gMDsKICAgICAgZm9yIChpPWMudG9rZW5zQ2xhaW1lZFt0b2tlbkFkZHJdOyBpPGQucGN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbkFtb3VudC5hZGQoX2FwcGx5UGN0KGMuYmFsYW5jZSxkLnBjdFtpXSkpOwogICAgICB9CiAgICAgIGMudG9rZW5zQ2xhaW1lZFt0b2tlbkFkZHJdID0gZC5wY3QubGVuZ3RoOwogICAgICBpZiAodG9rZW5BbW91bnQgPiAwKSB7CiAgICAgICAgcmVxdWlyZShkLnRva2VuLnRyYW5zZmVyKHJlY2VpdmVyLHRva2VuQW1vdW50KSk7CiAgICAgICAgZC5iYWxhbmNlUmVtYWluaW5nID0gZC5iYWxhbmNlUmVtYWluaW5nLnN1Yih0b2tlbkFtb3VudCk7CiAgICAgICAgVG9rZW5zV2l0aGRyYXduKHJlY2VpdmVyLHRva2VuQWRkcix0b2tlbkFtb3VudCk7CiAgICAgIH0gIAogICAgfQogICAgCiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgZXhlY3V0ZWQgYnkgdGhlIG93bmVyLCBpdCBhZGRzIGFuIGFkZHJlc3MgdG8gdGhlIHdoaXRlbGlzdC4KICAvLyBUbyBleGVjdXRlLCB0aGUgY29udHJhY3QgbXVzdCBiZSBpbiBzdGFnZSAxLCB0aGUgYWRkcmVzcyBjYW5ub3QgYWxyZWFkeSBiZSB3aGl0ZWxpc3RlZCwgYW5kIHRoZSBhZGRyZXNzIGNhbm5vdCBiZSBhIGNvbnRyYWN0IGl0c2VsZi4KICAvLyBCbG9ja2luZyBjb250cmFjdHMgZnJvbSBiZWluZyB3aGl0ZWxpc3RlZCBwcmV2ZW50cyBhdHRhY2tzIGZyb20gdW5leHBlY3RlZCBjb250cmFjdCB0byBjb250cmFjdCBpbnRlcmFjdGlvbiAtIHZlcnkgaW1wb3J0YW50IQogIGZ1bmN0aW9uIGF1dGhvcml6ZSAoYWRkcmVzcyBhZGRyLCB1aW50IGNhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDEpOwogICAgX2NoZWNrV2hpdGVsaXN0Q29udHJhY3QoYWRkcik7CiAgICByZXF1aXJlICghd2hpdGVsaXN0W2FkZHJdLmF1dGhvcml6ZWQpOwogICAgcmVxdWlyZSAoKGNhcCA+IDAgJiYgY2FwIDwgY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpIHx8IChjYXAgPj0gY29udHJpYnV0aW9uTWluICYmIGNhcCA8PSBjb250cmlidXRpb25DYXBzWzBdKSApOwogICAgdWludCBzaXplOwogICAgYXNzZW1ibHkgeyBzaXplIDo9IGV4dGNvZGVzaXplKGFkZHIpIH0KICAgIHJlcXVpcmUgKHNpemUgPT0gMCk7CiAgICB3aGl0ZWxpc3RbYWRkcl0uY2FwID0gY2FwOwogICAgd2hpdGVsaXN0W2FkZHJdLmF1dGhvcml6ZWQgPSB0cnVlOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgYnkgdGhlIG93bmVyIHRvIGF1dGhvcml6ZSBtYW55IGFkZHJlc3NlcyBpbiBhIHNpbmdsZSBjYWxsLgogIC8vIEVhY2ggYWRkcmVzcyB3aWxsIGJlIGdpdmVuIHRoZSBzYW1lIGNhcCwgYW5kIHRoZSBjYXAgbXVzdCBiZSBvbmUgb2YgdGhlIHN0YW5kYXJkIGxldmVscy4KICBmdW5jdGlvbiBhdXRob3JpemVNYW55IChhZGRyZXNzW10gYWRkciwgdWludCBjYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoYWRkci5sZW5ndGggPCAyNTUpOwogICAgcmVxdWlyZSAoY2FwID4gMCAmJiBjYXAgPCBjb250cmlidXRpb25DYXBzLmxlbmd0aCk7CiAgICBmb3IgKHVpbnQ4IGk9MDsgaTxhZGRyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGF1dGhvcml6ZShhZGRyW2ldLCBjYXApOwogICAgfQogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcmVtb3ZlIGFuIGFkZHJlc3MgZnJvbSB0aGUgd2hpdGVsaXN0LgogIC8vIEl0IG1heSBvbmx5IGJlIGV4ZWN1dGVkIGR1cmluZyBzdGFnZXMgMSBhbmQgMi4gIEFueSBldGggc2VudCBieSB0aGUgYWRkcmVzcyBpcyByZWZ1bmRlZCBhbmQgdGhlaXIgcGVyc29uYWwgY2FwIGlzIHNldCB0byAwLgogIC8vIEl0IHdpbGwgdGhyb3cgaWYgdGhlIGFkZHJlc3MgaXMgc3RpbGwgYXV0aG9yaXNlZCBpbiB0aGUgd2hpdGVsaXN0IGNvbnRyYWN0LgogIGZ1bmN0aW9uIHJldm9rZSAoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPCAzKTsKICAgIHJlcXVpcmUgKHdoaXRlbGlzdFthZGRyXS5hdXRob3JpemVkKTsKICAgIHJlcXVpcmUgKHdoaXRlbGlzdENvbnRyYWN0LmNoZWNrTWVtYmVyTGV2ZWwoYWRkcikgPT0gMCk7CiAgICB3aGl0ZWxpc3RbYWRkcl0uYXV0aG9yaXplZCA9IGZhbHNlOwogICAgaWYgKHdoaXRlbGlzdFthZGRyXS5iYWxhbmNlID4gMCkgewogICAgICB1aW50IGFtb3VudFRvVHJhbnNmZXIgPSB3aGl0ZWxpc3RbYWRkcl0uYmFsYW5jZTsKICAgICAgd2hpdGVsaXN0W2FkZHJdLmJhbGFuY2UgPSAwOwogICAgICBhZGRyLnRyYW5zZmVyKGFtb3VudFRvVHJhbnNmZXIpOwogICAgICBDb250cmlidXRvckJhbGFuY2VDaGFuZ2VkKGFkZHIsIDApOwogICAgfQogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gbW9kaWZ5IHRoZSBjb250cmlidXRpb24gY2FwIG9mIGEgd2hpdGVsaXN0ZWQgYWRkcmVzcy4KICAvLyBJZiB0aGUgY3VycmVudCBjb250cmlidXRpb24gYmFsYW5jZSBleGNlZWRzIHRoZSBuZXcgY2FwLCB0aGUgZXhjZXNzIGJhbGFuY2UgaXMgcmVmdW5kZWQuCiAgZnVuY3Rpb24gbW9kaWZ5SW5kaXZpZHVhbENhcCAoYWRkcmVzcyBhZGRyLCB1aW50IGNhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChjYXAgPCBjb250cmlidXRpb25DYXBzLmxlbmd0aCB8fCAoY2FwID49IGNvbnRyaWJ1dGlvbk1pbiAmJiBjYXAgPD0gY29udHJpYnV0aW9uQ2Fwc1swXSkgKTsKICAgIF9jaGVja1doaXRlbGlzdENvbnRyYWN0KGFkZHIpOwogICAgdmFyIGMgPSB3aGl0ZWxpc3RbYWRkcl07CiAgICByZXF1aXJlIChjLmF1dGhvcml6ZWQpOwogICAgdWludCBhbW91bnQgPSBjLmJhbGFuY2U7CiAgICBjLmNhcCA9IGNhcDsKICAgIHVpbnQgY2FwQW1vdW50ID0gX2NoZWNrQ2FwKGFkZHIpOwogICAgaWYgKGFtb3VudCA+IGNhcEFtb3VudCkgewogICAgICBjLmJhbGFuY2UgPSBjYXBBbW91bnQ7CiAgICAgIGFkZHIudHJhbnNmZXIoYW1vdW50LnN1YihjYXBBbW91bnQpKTsKICAgICAgQ29udHJpYnV0b3JCYWxhbmNlQ2hhbmdlZChhZGRyLCBjYXBBbW91bnQpOwogICAgfQogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgb3duZXIgdG8gbW9kaWZ5IHRoZSBjYXAgZm9yIGEgY29udHJpYnV0aW9uIGxldmVsLgogIC8vIFRoZSBjYXAgY2Fubm90IGJlIGRlY3JlYXNlZCBiZWxvdyB0aGUgY3VycmVudCBiYWxhbmNlIG9yIGluY3JlYXNlZCBwYXN0IHRoZSBjb250cmFjdCBsaW1pdC4KICBmdW5jdGlvbiBtb2RpZnlMZXZlbENhcCAodWludCBsZXZlbCwgdWludCBjYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVxdWlyZSAobGV2ZWwgPiAwICYmIGxldmVsIDwgY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpOwogICAgcmVxdWlyZSAodGhpcy5iYWxhbmNlIDw9IGNhcCAmJiBjb250cmlidXRpb25DYXBzWzBdID49IGNhcCk7CiAgICBjb250cmlidXRpb25DYXBzW2xldmVsXSA9IGNhcDsKICAgIG5leHRDYXBUaW1lID0gMDsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBjaGFuZ2VzIGV2ZXJ5IGxldmVsIGNhcCBhdCBvbmNlLCB3aXRoIGFuIG9wdGlvbmFsIGRlbGF5LgogIC8vIE1vZGlmeWluZyB0aGUgY2FwcyBpbW1lZGlhdGVseSB3aWxsIGNhbmNlbCBhbnkgZGVsYXllZCBjYXAgY2hhbmdlLgogIGZ1bmN0aW9uIG1vZGlmeUFsbExldmVsQ2FwcyAodWludFtdIGNhcCwgdWludCB0aW1lKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPCAzKTsKICAgIHJlcXVpcmUgKGNhcC5sZW5ndGggPT0gY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgtMSk7CiAgICByZXF1aXJlICh0aW1lID09IDAgfHwgdGltZT5ibG9jay50aW1lc3RhbXApOwogICAgaWYgKHRpbWUgPT0gMCkgewogICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgY2FwLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbW9kaWZ5TGV2ZWxDYXAoaSsxLCBjYXBbaV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBuZXh0Q29udHJpYnV0aW9uQ2FwcyA9IGNvbnRyaWJ1dGlvbkNhcHM7CiAgICAgIG5leHRDYXBUaW1lID0gdGltZTsKICAgICAgZm9yIChpID0gMDsgaSA8IGNhcC5sZW5ndGg7IGkrKykgewogICAgICAgIHJlcXVpcmUgKGNvbnRyaWJ1dGlvbkNhcHNbaSsxXSA8PSBjYXBbaV0gJiYgY29udHJpYnV0aW9uQ2Fwc1swXSA+PSBjYXBbaV0pOwogICAgICAgIG5leHRDb250cmlidXRpb25DYXBzW2krMV0gPSBjYXBbaV07CiAgICAgIH0KICAgIH0KICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIGR1cmluZyBzdGFnZXMgb25lIG9yIHR3byB0byBtb2RpZnkgdGhlIG1heGltdW0gYmFsYW5jZSBvZiB0aGUgY29udHJhY3QuCiAgLy8gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lci4gVGhlIGFtb3VudCBjYW5ub3QgYmUgc2V0IHRvIGxvd2VyIHRoYW4gdGhlIGN1cnJlbnQgYmFsYW5jZSBvZiB0aGUgY29udHJhY3QuCiAgZnVuY3Rpb24gbW9kaWZ5TWF4Q29udHJhY3RCYWxhbmNlICh1aW50IGFtb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChhbW91bnQgPj0gY29udHJpYnV0aW9uTWluKTsKICAgIHJlcXVpcmUgKGFtb3VudCA+PSB0aGlzLmJhbGFuY2UpOwogICAgY29udHJpYnV0aW9uQ2Fwc1swXSA9IGFtb3VudDsKICAgIG5leHRDYXBUaW1lID0gMDsKICAgIGZvciAodWludDggaT0xOyBpPGNvbnRyaWJ1dGlvbkNhcHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGNvbnRyaWJ1dGlvbkNhcHNbaV0+YW1vdW50KSBjb250cmlidXRpb25DYXBzW2ldPWFtb3VudDsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiByZXR1cm5zIHRoZSBjYXAgYW1vdW50IG9mIGEgd2hpdGVsaXN0ZWQgYWRkcmVzcy4KICBmdW5jdGlvbiBfY2hlY2tDYXAgKGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgX2NoZWNrV2hpdGVsaXN0Q29udHJhY3QoYWRkcik7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFthZGRyXTsKICAgIGlmICghYy5hdXRob3JpemVkKSByZXR1cm4gMDsKICAgIGlmIChuZXh0Q2FwVGltZT4wICYmIGJsb2NrLnRpbWVzdGFtcD5uZXh0Q2FwVGltZSkgewogICAgICBjb250cmlidXRpb25DYXBzID0gbmV4dENvbnRyaWJ1dGlvbkNhcHM7CiAgICAgIG5leHRDYXBUaW1lID0gMDsKICAgIH0KICAgIGlmIChjLmNhcDxjb250cmlidXRpb25DYXBzLmxlbmd0aCkgcmV0dXJuIGNvbnRyaWJ1dGlvbkNhcHNbYy5jYXBdOwogICAgcmV0dXJuIGMuY2FwOyAKICB9CiAgCiAgLy8gVGhpcyBpbnRlcm5hbCBmdW5jdGlvbiBjaGVja3MgaWYgYW4gYWRkcmVzcyBpcyB3aGl0ZWxpc3RlZCBpbiB0aGUgd2hpdGVsaXN0IGNvbnRyYWN0LgogIGZ1bmN0aW9uIF9jaGVja1doaXRlbGlzdENvbnRyYWN0IChhZGRyZXNzIGFkZHIpIGludGVybmFsIHsKICAgIHZhciBjID0gd2hpdGVsaXN0W2FkZHJdOwogICAgaWYgKCFjLmF1dGhvcml6ZWQpIHsKICAgICAgdmFyIGxldmVsID0gd2hpdGVsaXN0Q29udHJhY3QuY2hlY2tNZW1iZXJMZXZlbChhZGRyKTsKICAgICAgaWYgKGxldmVsID09IDAgfHwgbGV2ZWwgPj0gY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpIHJldHVybjsKICAgICAgYy5jYXAgPSBsZXZlbDsKICAgICAgYy5hdXRob3JpemVkID0gdHJ1ZTsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBjYWxsYWJsZSBmdW5jdGlvbiByZXR1cm5zIHRoZSB0b3RhbCBwb29sIGNhcCwgY3VycmVudCBiYWxhbmNlIGFuZCByZW1haW5pbmcgYmFsYW5jZSB0byBiZSBmaWxsZWQuCiAgZnVuY3Rpb24gY2hlY2tQb29sQmFsYW5jZSAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IHBvb2xDYXAsIHVpbnQgYmFsYW5jZSwgdWludCByZW1haW5pbmcpIHsKICAgIGlmIChjb250cmFjdFN0YWdlID09IDEpIHsKICAgICAgcmVtYWluaW5nID0gY29udHJpYnV0aW9uQ2Fwc1swXS5zdWIodGhpcy5iYWxhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlbWFpbmluZyA9IDA7CiAgICB9CiAgICByZXR1cm4gKGNvbnRyaWJ1dGlvbkNhcHNbMF0sdGhpcy5iYWxhbmNlLHJlbWFpbmluZyk7CiAgfQogIAogIC8vIFRoaXMgY2FsbGFibGUgZnVuY3Rpb24gcmV0dXJucyB0aGUgYmFsYW5jZSwgY29udHJpYnV0aW9uIGNhcCwgYW5kIHJlbWFpbmluZyBhdmFpbGFibGUgYmFsYW5jZSBvZiBhbnkgY29udHJpYnV0b3IuCiAgZnVuY3Rpb24gY2hlY2tDb250cmlidXRvckJhbGFuY2UgKGFkZHJlc3MgYWRkcikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlLCB1aW50IGNhcCwgdWludCByZW1haW5pbmcpIHsKICAgIHZhciBjID0gd2hpdGVsaXN0W2FkZHJdOwogICAgaWYgKCFjLmF1dGhvcml6ZWQpIHsKICAgICAgY2FwID0gd2hpdGVsaXN0Q29udHJhY3QuY2hlY2tNZW1iZXJMZXZlbChhZGRyKTsKICAgICAgaWYgKGNhcCA9PSAwKSByZXR1cm4gKDAsMCwwKTsKICAgIH0gZWxzZSB7CiAgICAgIGNhcCA9IGMuY2FwOwogICAgfQogICAgYmFsYW5jZSA9IGMuYmFsYW5jZTsKICAgIGlmIChjb250cmFjdFN0YWdlID09IDEpIHsKICAgICAgaWYgKGNhcDxjb250cmlidXRpb25DYXBzLmxlbmd0aCkgeyAKICAgICAgICBpZiAobmV4dENhcFRpbWUgPT0gMCB8fCBuZXh0Q2FwVGltZSA+IGJsb2NrLnRpbWVzdGFtcCkgewogICAgICAgICAgY2FwID0gY29udHJpYnV0aW9uQ2Fwc1tjYXBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYXAgPSBuZXh0Q29udHJpYnV0aW9uQ2Fwc1tjYXBdOwogICAgICAgIH0KICAgICAgfQogICAgICByZW1haW5pbmcgPSBjYXAuc3ViKGJhbGFuY2UpOwogICAgICBpZiAoY29udHJpYnV0aW9uQ2Fwc1swXS5zdWIodGhpcy5iYWxhbmNlKSA8IHJlbWFpbmluZykgcmVtYWluaW5nID0gY29udHJpYnV0aW9uQ2Fwc1swXS5zdWIodGhpcy5iYWxhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlbWFpbmluZyA9IDA7CiAgICB9CiAgICByZXR1cm4gKGJhbGFuY2UsIGNhcCwgcmVtYWluaW5nKTsKICB9CiAgCiAgLy8gVGhpcyBjYWxsYWJsZSBmdW5jdGlvbiByZXR1cm5zIHRoZSB0b2tlbiBiYWxhbmNlIHRoYXQgYSBjb250cmlidXRvciBjYW4gY3VycmVudGx5IGNsYWltLgogIGZ1bmN0aW9uIGNoZWNrQXZhaWxhYmxlVG9rZW5zIChhZGRyZXNzIGFkZHIsIGFkZHJlc3MgdG9rZW5BZGRyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KSB7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFthZGRyXTsKICAgIHZhciBkID0gZGlzdHJpYnV0aW9uTWFwW3Rva2VuQWRkcl07CiAgICBmb3IgKHVpbnQgaSA9IGMudG9rZW5zQ2xhaW1lZFt0b2tlbkFkZHJdOyBpIDwgZC5wY3QubGVuZ3RoOyBpKyspIHsKICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbkFtb3VudC5hZGQoX2FwcGx5UGN0KGMuYmFsYW5jZSwgZC5wY3RbaV0pKTsKICAgIH0KICAgIHJldHVybiB0b2tlbkFtb3VudDsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBjbG9zZXMgZnVydGhlciBjb250cmlidXRpb25zIHRvIHRoZSBjb250cmFjdCwgYWR2YW5jaW5nIGl0IHRvIHN0YWdlIHR3by4KICAvLyBJdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyLiAgQWZ0ZXIgdGhpcyBjYWxsIGhhcyBiZWVuIG1hZGUsIHdoaXRlbGlzdGVkIGFkZHJlc3NlcwogIC8vIGNhbiBzdGlsbCByZW1vdmUgdGhlaXIgZXRoIGZyb20gdGhlIGNvbnRyYWN0IGJ1dCBjYW5ub3QgY29udHJpYnV0ZSBhbnkgbW9yZS4KICBmdW5jdGlvbiBjbG9zZUNvbnRyaWJ1dGlvbnMgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDEpOwogICAgY29udHJhY3RTdGFnZSA9IDI7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gcmVvcGVucyB0aGUgY29udHJhY3QgdG8gY29udHJpYnV0aW9ucyBhbmQgZnVydGhlciB3aGl0ZWxpc3RpbmcsIHJldHVybmluZyBpdCB0byBzdGFnZSBvbmUuCiAgLy8gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBkdXJpbmcgc3RhZ2UgdHdvLgogIGZ1bmN0aW9uIHJlb3BlbkNvbnRyaWJ1dGlvbnMgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlID09IDIpOwogICAgY29udHJhY3RTdGFnZSA9IDE7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gc2V0cyB0aGUgcmVjZWl2aW5nIGFkZHJlc3MgdGhhdCB0aGUgY29udHJhY3Qgd2lsbCBzZW5kIHRoZSBwb29sZWQgZXRoIHRvLgogIC8vIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIgaWYgdGhlIHJlY2VpdmVyIGFkZHJlc3MgaGFzIG5vdCBhbHJlYWR5IGJlZW4gc2V0LgogIC8vIEFmdGVyIG1ha2luZyB0aGlzIGNhbGwsIHRoZSBjb250cmFjdCB3aWxsIGJlIHVuYWJsZSB0byBzZW5kIHRoZSBwb29sZWQgZXRoIGZvciA2MDAwIGJsb2Nrcy4KICAvLyBUaGlzIGxpbWl0YXRpb24gaXMgc28gdGhhdCBpZiB0aGUgb3duZXIgYWN0cyBtYWxpY2lvdXNseSBpbiBtYWtpbmcgdGhlIGNoYW5nZSwgYWxsIHdoaXRlbGlzdGVkCiAgLy8gYWRkcmVzc2VzIGhhdmUgfjI0IGhvdXJzIHRvIHdpdGhkcmF3IHRoZWlyIGV0aCBmcm9tIHRoZSBjb250cmFjdC4KICBmdW5jdGlvbiBzZXRSZWNlaXZlckFkZHJlc3MgKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChhZGRyICE9IDB4MDAgJiYgcmVjZWl2ZXJBZGRyZXNzID09IDB4MDApOwogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVjZWl2ZXJBZGRyZXNzID0gYWRkcjsKICAgIGFkZHJlc3NDaGFuZ2VCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIFJlY2VpdmVyQWRkcmVzc1NldChhZGRyKTsKICB9CgogIC8vIFRoaXMgZnVuY3Rpb24gc2VuZHMgdGhlIHBvb2xlZCBldGggdG8gdGhlIHJlY2VpdmluZyBhZGRyZXNzLCBjYWxjdWxhdGVzIHRoZSAlIG9mIHVudXNlZCBldGggdG8gYmUgcmV0dXJuZWQsCiAgLy8gYW5kIGFkdmFuY2VzIHRoZSBjb250cmFjdCB0byBzdGFnZSB0aHJlZS4gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lciBkdXJpbmcgc3RhZ2VzIG9uZSBvciB0d28uCiAgLy8gVGhlIGFtb3VudCB0byBzZW5kIChnaXZlbiBpbiB3ZWkpIG11c3QgYmUgc3BlY2lmaWVkIGR1cmluZyB0aGUgY2FsbC4gQXMgdGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBleGVjdXRlZCBvbmNlLAogIC8vIGl0IGlzIFZFUlkgSU1QT1JUQU5UIG5vdCB0byBnZXQgdGhlIGFtb3VudCB3cm9uZy4KICBmdW5jdGlvbiBzdWJtaXRQb29sICh1aW50IGFtb3VudEluV2VpKSBwdWJsaWMgb25seU93bmVyIG5vUmVlbnRyYW5jeSB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChyZWNlaXZlckFkZHJlc3MgIT0gMHgwMCk7CiAgICByZXF1aXJlIChibG9jay5udW1iZXIgPj0gYWRkcmVzc0NoYW5nZUJsb2NrLmFkZCg2MDAwKSk7CiAgICByZXF1aXJlIChjb250cmlidXRpb25NaW4gPD0gYW1vdW50SW5XZWkgJiYgYW1vdW50SW5XZWkgPD0gdGhpcy5iYWxhbmNlKTsKICAgIGZpbmFsQmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgIHJlcXVpcmUgKHJlY2VpdmVyQWRkcmVzcy5jYWxsLnZhbHVlKGFtb3VudEluV2VpKS5nYXMobXNnLmdhcy5zdWIoNTAwMCkpKCkpOwogICAgaWYgKHRoaXMuYmFsYW5jZSA+IDApIGV0aFJlZnVuZEFtb3VudC5wdXNoKHRoaXMuYmFsYW5jZSk7CiAgICBjb250cmFjdFN0YWdlID0gMzsKICAgIFBvb2xTdWJtaXR0ZWQocmVjZWl2ZXJBZGRyZXNzLCBhbW91bnRJbldlaSk7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gb3BlbnMgdGhlIGNvbnRyYWN0IHVwIGZvciB0b2tlbiB3aXRoZHJhd2Fscy4KICAvLyBJdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGR1cmluZyBzdGFnZSAzLiAgVGhlIG93bmVyIHNwZWNpZmllcyB0aGUgYWRkcmVzcyBvZiBhbiBFUkMyMCB0b2tlbgogIC8vIGNvbnRyYWN0IHRoYXQgdGhpcyBjb250cmFjdCBoYXMgYSBiYWxhbmNlIGluLCBhbmQgb3B0aW9uYWxseSBhIGJvb2wgdG8gcHJldmVudCB0aGlzIHRva2VuIGZyb20gYmVpbmcKICAvLyB0aGUgZGVmYXVsdCB3aXRoZHJhd2FsIChpbiB0aGUgZXZlbnQgb2YgYW4gYWlyZHJvcCwgZm9yIGV4YW1wbGUpLgogIGZ1bmN0aW9uIGVuYWJsZVRva2VuV2l0aGRyYXdhbHMgKGFkZHJlc3MgdG9rZW5BZGRyLCBib29sIG5vdERlZmF1bHQpIHB1YmxpYyBvbmx5T3duZXIgbm9SZWVudHJhbmN5IHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPT0gMyk7CiAgICBpZiAobm90RGVmYXVsdCkgewogICAgICByZXF1aXJlIChhY3RpdmVUb2tlbiAhPSAweDAwKTsKICAgIH0gZWxzZSB7CiAgICAgIGFjdGl2ZVRva2VuID0gdG9rZW5BZGRyOwogICAgfQogICAgdmFyIGQgPSBkaXN0cmlidXRpb25NYXBbdG9rZW5BZGRyXTsgICAgCiAgICBpZiAoZC5wY3QubGVuZ3RoPT0wKSBkLnRva2VuID0gRVJDMjAodG9rZW5BZGRyKTsKICAgIHVpbnQgYW1vdW50ID0gZC50b2tlbi5iYWxhbmNlT2YodGhpcykuc3ViKGQuYmFsYW5jZVJlbWFpbmluZyk7CiAgICByZXF1aXJlIChhbW91bnQgPiAwKTsKICAgIGlmIChmZWVQY3QgPiAwKSB7CiAgICAgIHJlcXVpcmUgKGQudG9rZW4udHJhbnNmZXIob3duZXIsX2FwcGx5UGN0KGFtb3VudCxmZWVQY3QpKSk7CiAgICB9CiAgICBhbW91bnQgPSBkLnRva2VuLmJhbGFuY2VPZih0aGlzKS5zdWIoZC5iYWxhbmNlUmVtYWluaW5nKTsKICAgIGQuYmFsYW5jZVJlbWFpbmluZyA9IGQudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgZC5wY3QucHVzaChfdG9QY3QoYW1vdW50LGZpbmFsQmFsYW5jZSkpOwogIH0KICAKICAvLyBUaGlzIGlzIGEgc3RhbmRhcmQgZnVuY3Rpb24gcmVxdWlyZWQgZm9yIEVSQzIyMyBjb21wYXRpYmlsaXR5LgogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2sgKGFkZHJlc3MgZnJvbSwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcHVibGljIHsKICAgIEVSQzIyM1JlY2VpdmVkIChmcm9tLCB2YWx1ZSk7CiAgfQogIAp9'.
	

]
