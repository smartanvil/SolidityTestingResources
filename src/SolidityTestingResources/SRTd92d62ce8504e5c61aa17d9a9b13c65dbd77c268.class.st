Class {
	#name : #SRTd92d62ce8504e5c61aa17d9a9b13c65dbd77c268,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd92d62ce8504e5c61aa17d9a9b13c65dbd77c268 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuOTsKCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cgp9CgovKioKCSAqIEB0aXRsZSBFUkMyMEJhc2ljCgkgKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKCSAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAoJICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewoJICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCSAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKCSAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSk7CgkgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50MjU2IHNpemUpIHsKICAgICByZXF1aXJlKCEobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpKTsKICAgICBfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4gCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1hbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcnQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyBpZiAoX3ZhbHVlID4gX2FsbG93YW5jZSkgdGhyb3c7CgogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWFobGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSghKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSApOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYW4gYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9Cgpjb250cmFjdCBQaXhpdSBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICB1aW50IHB1YmxpYyBkZWNpbWFscyA9IDY7CiAgICBib29sIHB1YmxpYyBpc1BheWFibGUgPSB0cnVlOwogICAgYm9vbCBwdWJsaWMgaXNXaXRoZHJhd2FibGUgPSB0cnVlOwogICAgYm9vbCBwdWJsaWMgaXNSZXF1aXJlRGF0YSA9IGZhbHNlOwoJCiAgICBzdHJ1Y3QgZXhjaGFuZ2VSYXRlIHsKICAgICAgICAKICAgICAgICB1aW50IHRpbWUxOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdWludCB0aW1lMjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICAKICAgIH0KICAgIAogICAgc3RydWN0IE1lbWJlciB7CiAgICAgICAgIAogICAgICAgIGJvb2wgaXNFeGlzdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBib29sIGlzRGl2aWRlbmQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgYm9vbCBpc1dpdGhkcmF3OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICB1aW50MjU2IGRpdmlkZW5kOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdWludDI1NiB3aXRoZHJhdzsKICAgICAgICAKICAgIH0KICAgIAogICAgZXhjaGFuZ2VSYXRlW10gcHVibGljIGV4Y2hhbmdlUmF0ZUFycmF5OyAgCgoJbWFwcGluZyAoYWRkcmVzcyA9PiBNZW1iZXIpIHB1YmxpYyBtZW1iZXJzOyAKICAgIGFkZHJlc3NbXSBwdWJsaWMgYWRtaW5BcnJheTsgICAKICAgIGFkZHJlc3NbXSBwdWJsaWMgbWVtYmVyQXJyYXk7CiAgICAKCSAKICAgIGFkZHJlc3MgcHVibGljIGRlcG9zaXRfYWRkcmVzczsKICAgIHVpbnQyNTYgcHVibGljIHRva2VuRXhjaGFuZ2VSYXRlSW5XZWkgPSAzMDAqMTAqKjY7CgkKCS8qCiAgICAq6Jmb5pOs5biz6JmfICAg5YWxMjDnorwKICAgICoxLTQg5Zu65a6aIDB4RkZGRkZGRkYgCiAgICAqNS04IOe5s+iyu+acn+mZkAogICAgKjktMTEg5rWB5rC06JmfIOWVhuWutuS7o+eivCAweDAwMDAwMC0weEZGRkZGRgogICAgKjEyLTE1IOWVhuWutuiHquiogiA056K8PTjkvY0gMC1GCiAgICAqMTYtMTgg6YeR6aGNCiAgICAqMTkgOjB4MzAgKzRiaXTlgJnoo5zpm7YKICAgICog55W2IEJZVEUxOSA9IDAwICAxMi0xOCDngrrllYblrrboh6roqIIKICAgICoyMCDmqqLmn6XnorwgCiAgICAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgc2hvcFN0b3JlSWQ7IAogICAgbWFwcGluZyAodWludCA9PiBhZGRyZXNzKSBwdWJsaWMgc2hvcFN0b3JlQWRkcmVzczsgCiAgICB1aW50MjU2IHB1YmxpYyBzaG9wU3RvcmVQcmljZSA9IDEqMTAqKjY7CiAgICB1aW50MjU2IHB1YmxpYyBzaG9wU3RvcmVOZXh0SWQgPSAwOwogICAgYWRkcmVzcyBwdWJsaWMgc2hvcFN0b3JlUmVnaXN0ZXI7CgoJLy/kuI3mrbjpm7YKCQoJdWludDI1NiBwdWJsaWMgdG90YWxfdG9rZW53ZWkgPSAwOyAKCXVpbnQyNTYgcHVibGljIG1pbl9wYXlfd2VpID0gMDsKCS8vIGFkbWluX3dpdGhkcmF3X2FsbCDmrbjpm7YKCXVpbnQyNTYgcHVibGljIHRvdGFsX2RldmlkZW5kID0gMDsgLy9tZW1iZXIKCXVpbnQyNTYgcHVibGljIHRvdGFsX3dpdGhkcmF3ID0gMDsgLy9tZW1iZXIKICAgIHVpbnQyNTYgcHVibGljIGRlcG9zaXRfYW1vdW50ID0gMDsgIC8vZGVwb3NpdAogICAgdWludDI1NiBwdWJsaWMgd2l0aGRyYXdfYW1vdW50ID0gMDsgLy9kZXBvc2l0CiAgICB1aW50MjU2IHB1YmxpYyBkaXZpZGVuZF9hbW91bnQgPSAwOyAvL2FkbWluICAgCiAgICAKICAgIGV2ZW50IFBheWRhdGEoYWRkcmVzcyBpbmRleGVkIHBheWVyLCB1aW50MjU2IHZhbHVlLCBieXRlcyBkYXRhLCB1aW50MjU2IHRoaXNUb2tlbldlaSk7CiAgICAKICAgIGZ1bmN0aW9uIFBpeGl1KCkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gMjEwMDAwMDAwMDAwMDA7IAogICAgICAgIGFkbWluQXJyYXkucHVzaChtc2cuc2VuZGVyKTsKICAgICAgICBhZG1pbl9zZXRfZGVwb3NpdChtc2cuc2VuZGVyKTsKICAgICAgICBhZG1pbl9zZXRfc2hvcFN0b3JlUmVnaXN0ZXIobXNnLnNlbmRlcik7CiAgICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRfb3JkZXJBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MsdWludCBfZXhwaXJlX2RheSx1aW50IF91c2VyZGF0YSx1aW50IF9hbW91bnQpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIAogICAgICAgIHVpbnQyNTYgc3RvcmVpZCA9IHNob3BTdG9yZUlkW19hZGRyZXNzXTsKICAgICAgICB1aW50MTYwIHJlc3VsdCA9IHVpbnQxNTIoMHhmZmZmZmZmZjw8MTIwKSArIHVpbnQxMjAoKF9leHBpcmVfZGF5ICogODY0MDAgKyBub3cpPDw4OCkgKyB1aW50ODgoc3RvcmVpZDw8NjQpOyAKICAgICAgICB1aW50IF96ZXJvID0gMDsKICAgICAgICB1aW50MjU2IF9hbW91bnQyID0gX2Ftb3VudCAqIDEwICoqIDY7CiAgICAgICAgd2hpbGUoX2Ftb3VudDIgJSAxMCA9PSAwKXsKICAgICAgICAgICAgCiAgICAgICAgICAgIF9hbW91bnQyIC89IDEwOwogICAgICAgICAgICBfemVybysrOwogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX3VzZXJkYXRhID0gX3VzZXJkYXRhPDwxNjsKICAgICAgICBfdXNlcmRhdGEgKz0gX2Ftb3VudDsKICAgICAgICAKICAgICAgICByZXN1bHQgKz0gdWludDY0KF91c2VyZGF0YTw8OCk7CiAgICAgICAgcmVzdWx0ICs9IHVpbnQ4KDB4MzArX3plcm8pOwogICAgICAgIHVpbnQ4IGNyYyA9IHVpbnQ4KHNoYTI1Nih1aW50MTUyKHJlc3VsdCkgKSk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoKHJlc3VsdCA8PCA4KSArIGNyYyk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzTGVhZGluZzRGRihhZGRyZXNzIF9zZW5kZXIgKSBwcml2YXRlICByZXR1cm5zKGJvb2wpewogICAgICAgIHVpbnQzMiBmZjQ9IHVpbnQzMih1aW50MjU2KF9zZW5kZXIpID4+IDEyOCk7CiAgICAgICAgcmV0dXJuIChmZjQgPT0gMHhmZmZmZmZmZik7CiAgICB9CgogICAgbW9kaWZpZXIgb25seURlcG9zaXQoKSB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGRlcG9zaXRfYWRkcmVzcyk7CiAgICAgICAgXzsKICAgICAgICAKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seUFkbWluKCkgewogICAgICAgIAogICAgICAgIGJvb2wgb2sgPSBhZG1pbl9jaGVjayhtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKG9rKTsKICAgICAgICBfOwogICAgICAgIAogICAgfQogICAgCiAgICBtb2RpZmllciBhZG1pbkV4aXN0cyhhZGRyZXNzIGFkbWluKSB7CgogICAgICAgIGJvb2wgb2sgPSBmYWxzZTsKICAgICAgICBpZihhZG1pbiAhPSBtc2cuc2VuZGVyKXsKICAgICAgICAgICAgCiAgICAgICAgICAgIG9rID0gYWRtaW5fY2hlY2soYWRtaW4pOwogICAgICAgIAogICAgICAgIH0KICAgICAgICByZXF1aXJlKG9rKTsKICAgICAgICBfOyAKICAgICAgICAKICAgIH0KICAgIAogICAgbW9kaWZpZXIgYWRtaW5Eb2VzTm90RXhpc3QoYWRkcmVzcyBhZG1pbikgewoKICAgICAgICBib29sIG9rID0gYWRtaW5fY2hlY2soYWRtaW4pOwogICAgICAgIHJlcXVpcmUoIW9rKTsKICAgICAgICBfOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZG1pbl9jaGVjayhhZGRyZXNzIGFkbWluKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMoYm9vbCl7CiAgICAgICAgCiAgICAgICAgYm9vbCBvayA9IGZhbHNlOwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFkbWluQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFkbWluID09IGFkbWluQXJyYXlbaV0pIHsKICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBvazsKICAgICAgICAKICAgIH0KICAgIAogICAgbW9kaWZpZXIgbWVtYmVyRXhpc3RzKGFkZHJlc3MgbWVtYmVyKSB7CgogICAgICAgIGJvb2wgb2sgPSBmYWxzZTsKICAgICAgICBpZiAobWVtYmVyc1ttZW1iZXJdLmlzRXhpc3RzID09IHRydWUpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIG9rID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIHJlcXVpcmUob2spOwogICAgICAgIF87CiAgICAgICAgCiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlzTWVtYmVyKCkgewoKICAgICAgICBib29sIG9rID0gZmFsc2U7CiAgICAgICAgaWYgKG1lbWJlcnNbbXNnLnNlbmRlcl0uaXNFeGlzdHMgPT0gdHJ1ZSkgeyAgICAgICAgICAgIAogICAgICAgICAgICBvayA9IHRydWU7ICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIHJlcXVpcmUob2spOwogICAgICAgIF87CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX2RlcG9zaXQoaW50IF9FdGgsIGludCBfV2VpKSBvbmx5QWRtaW57CiAgICAgICAgCiAgICAgICAgaW50IHhXZWkgPSBfRXRoICogMTAgKiogMTggKyBfV2VpOwogICAgICAgIGlmKHhXZWkgPiAwKXsKICAgICAgICAgICAgCiAgICAgICAgICAgIGRlcG9zaXRfYW1vdW50ICs9IHVpbnQyNTYoeFdlaSk7CiAgICAgICAgICAgIAogICAgICAgIH1lbHNlewogICAgICAgICAgICAKICAgICAgICAgICAgZGVwb3NpdF9hbW91bnQgLT0gdWludDI1Nih4V2VpICogLTEpOwogICAgICAgICAgICAKICAgICAgICB9IAogICAgICAgIAogICAgICAgIAogICAgfQogICAgCiAgICAvKioJKgnnrqHnkIblk6HnmbzmlL7ogqHmga8JKgnmr4/lgIvmnIPlk6HogqHmga/kvp0gCSoJKi8KICAgIGZ1bmN0aW9uIGFkbWluX2RpdmlkZW5kKGludCBfRXRoLCBpbnQgX1dlaSkgb25seUFkbWluIHsKICAgICAgICAKICAgICAgICBpbnQgeFdlaSA9IF9FdGggKiAxMCAqKiAxOCArIF9XZWk7CgkJYm9vbCBpc19hZGQgPSB0cnVlOwoKICAgICAgICBpZih4V2VpID4gMCl7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlKHVpbnQyNTYoeFdlaSkgPD0gKGRlcG9zaXRfYW1vdW50LWRpdmlkZW5kX2Ftb3VudCkgKTsgCiAgICAgICAgICAgIGRpdmlkZW5kX2Ftb3VudCArPSB1aW50MjU2KHhXZWkpOwogICAgICAgICAgICAKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgCiAgICAgICAgICAgIHhXZWkgKj0gLTE7CiAgICAgICAgICAgIGlzX2FkZCA9IGZhbHNlOwogICAgICAgICAgICByZXF1aXJlKHVpbnQyNTYoeFdlaSkgPD0gZGVwb3NpdF9hbW91bnQpOyAKICAgICAgICAgICAgZGl2aWRlbmRfYW1vdW50IC09IHVpbnQyNTYoeFdlaSAqIC0xKTsKICAgICAgICAgICAgCiAgICAgICAgfSAKICAgICAgICAKICAgICAgICB1aW50MjU2IGxlbiA9IG1lbWJlckFycmF5Lmxlbmd0aDsJCiAgICAgICAgdWludCBpID0gMDsKICAgICAgICBhZGRyZXNzIF9tZW1iZXI7CiAgICAgICAgCgkJdWludCB0b3RhbF9iYWxhbmNlX2RpdmlkZW5lZD0wOwogICAgICAgIGZvciggaSA9IDA7IGkgPCBsZW47IGkrKyl7ICAgICAgICAgICAgCiAgICAgICAgICAgIF9tZW1iZXIgPSBtZW1iZXJBcnJheVtpXTsKCQkJaWYobWVtYmVyc1tfbWVtYmVyXS5pc0RpdmlkZW5kKXsKCQkJCXRvdGFsX2JhbGFuY2VfZGl2aWRlbmVkICs9IGJhbGFuY2VzW19tZW1iZXJdOyAKCQkJfSAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgZm9yKCBpID0gMDsgaSA8IGxlbjsgaSsrKXsgICAgICAgICAgICAKICAgICAgICAgICAgX21lbWJlciA9IG1lbWJlckFycmF5W2ldOwoJCQlpZihtZW1iZXJzW19tZW1iZXJdLmlzRGl2aWRlbmQpewoJCQkJdWludDI1NiB0aGlzV2VpID0gYmFsYW5jZXNbX21lbWJlcl0gKiB1aW50MjU2KHhXZWkpIC8gdG90YWxfYmFsYW5jZV9kaXZpZGVuZWQ7CgkJCQlpZihpc19hZGQpewoJCQkJICAgIG1lbWJlcnNbX21lbWJlcl0uZGl2aWRlbmQgKz0gdGhpc1dlaTsgCgkJCQkgICAgdG90YWxfZGV2aWRlbmQgKz0gdGhpc1dlaTsKCQkJCX1lbHNlewoJCQkJICAgIG1lbWJlcnNbX21lbWJlcl0uZGl2aWRlbmQgLT0gdGhpc1dlaTsgCgkJCQkgICAgdG90YWxfZGV2aWRlbmQgLT0gdGhpc1dlaTsKCQkJCX0KCQkJfSAgICAgICAgICAgIAogICAgICAgIH0KICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZG1pbl9zZXRfZXhjaGFuZ2VfcmF0ZSh1aW50W10gZXhjaGFuZ2VSYXRlcykgb25seUFkbWluewogICAgICAgICAKICAgICAgICB1aW50IGxlbiA9IGV4Y2hhbmdlUmF0ZXMubGVuZ3RoOwogICAgICAgIGV4Y2hhbmdlUmF0ZUFycmF5Lmxlbmd0aCA9IDA7CiAgICAgICAgCiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkgKz0gMyl7CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50IHRpbWUxID0gZXhjaGFuZ2VSYXRlc1tpXTsKICAgICAgICAgICAgdWludCB0aW1lMiA9IGV4Y2hhbmdlUmF0ZXNbaSArIDFdOwogICAgICAgICAgICB1aW50IHZhbHVlID0gZXhjaGFuZ2VSYXRlc1tpICsgMl0qMTAwMDsKICAgICAgICAgICAgZXhjaGFuZ2VSYXRlQXJyYXkucHVzaChleGNoYW5nZVJhdGUodGltZTEsIHRpbWUyLCB2YWx1ZSkpOyAgICAgIAogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX3NldF9zaG9wU3RvcmVSZWdpc3RlcihhZGRyZXNzIF9hZGRyZXNzKSBvbmx5QWRtaW57CiAgICAgICAgCiAgICAgICAgc2hvcFN0b3JlUmVnaXN0ZXIgPSBfYWRkcmVzczsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRtaW5fc2V0X0V4Y2hhbmdlUmF0ZUluV2VpKHVpbnQyNTYgZXhjaGFuZ2VSYXRlcykgb25seUFkbWluewogICAgICAgIAogICAgICAgIHRva2VuRXhjaGFuZ2VSYXRlSW5XZWkgPSBleGNoYW5nZVJhdGVzOwogICAgICAgIAogICAgfQoKCWZ1bmN0aW9uIGdldF9leGNoYW5nZV93ZWkoKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpewoKCQl1aW50IGxlbiA9IGV4Y2hhbmdlUmF0ZUFycmF5Lmxlbmd0aDsgIAoJCXVpbnQgbm93VGltZSA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IGxlbjsgaSArPSAzKXsKICAgICAgICAgICAgCgkJCWV4Y2hhbmdlUmF0ZSBtZW1vcnkgcmF0ZSA9IGV4Y2hhbmdlUmF0ZUFycmF5W2ldOwogICAgICAgICAgICB1aW50IHRpbWUxID0gcmF0ZS50aW1lMTsKICAgICAgICAgICAgdWludCB0aW1lMiA9IHJhdGUudGltZTI7CiAgICAgICAgICAgIHVpbnQgdmFsdWUgPSByYXRlLnZhbHVlOwoJCQlpZiAobm93VGltZT49IHRpbWUxICYmIG5vd1RpbWU8PXRpbWUyKSB7CgkJCQl0b2tlbkV4Y2hhbmdlUmF0ZUluV2VpID0gdmFsdWU7CgkJCQlyZXR1cm4gdmFsdWU7CgkJCX0KICAgICAgICAgICAgCiAgICAgICAgfQoJCXJldHVybiB0b2tlbkV4Y2hhbmdlUmF0ZUluV2VpOwoJfQoJCglmdW5jdGlvbiBhZG1pbl9zZXRfbWluX3BheSh1aW50MjU2IF9taW5fcGF5KSBvbmx5QWRtaW57CgkgICAgCgkgICAgcmVxdWlyZShfbWluX3BheSA+PSAwKTsKCSAgICBtaW5fcGF5X3dlaSA9IF9taW5fcGF5OwoJICAgIAoJfQogICAgCiAgICBmdW5jdGlvbiBnZXRfYWRtaW5fbGlzdCgpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzc1tdIF9hZG1pbkFycmF5KXsKICAgICAgICAKICAgICAgICBfYWRtaW5BcnJheSA9IGFkbWluQXJyYXk7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX2FkZChhZGRyZXNzIGFkbWluKSBvbmx5QWRtaW4gYWRtaW5Eb2VzTm90RXhpc3QoYWRtaW4pewogICAgICAgIAogICAgICAgIGFkbWluQXJyYXkucHVzaChhZG1pbik7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX2RlbChhZGRyZXNzIGFkbWluKSBvbmx5QWRtaW4gYWRtaW5FeGlzdHMoYWRtaW4pewogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFkbWluQXJyYXkubGVuZ3RoIC0gMTsgaSsrKQogICAgICAgICAgICBpZiAoYWRtaW5BcnJheVtpXSA9PSBhZG1pbikgewogICAgICAgICAgICAgICAgYWRtaW5BcnJheVtpXSA9IGFkbWluQXJyYXlbYWRtaW5BcnJheS5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGFkbWluQXJyYXkubGVuZ3RoIC09IDE7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX3NldF9kZXBvc2l0KGFkZHJlc3MgYWRkcikgb25seUFkbWluewogICAgICAgIAogICAgICAgIGRlcG9zaXRfYWRkcmVzcyA9IGFkZHI7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX3NldF9zaG9wU3RvcmVQcmljZSh1aW50MjU2IF9zaG9wU3RvcmVQcmljZSkgb25seUFkbWluewogICAgICAgIAogICAgICAgIHNob3BTdG9yZVByaWNlID0gX3Nob3BTdG9yZVByaWNlOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZG1pbl9zZXRfaXNSZXF1aXJlRGF0YShib29sIF9yZXF1aXJlRGF0YSkgb25seUFkbWluewogICAgCiAgICAgICAgaXNSZXF1aXJlRGF0YSA9IF9yZXF1aXJlRGF0YTsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRtaW5fc2V0X3BheWFibGUoYm9vbCBfcGF5YWJsZSkgb25seUFkbWluewogICAgCiAgICAgICAgaXNQYXlhYmxlID0gX3BheWFibGU7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX3NldF93aXRoZHJhd2FibGUoYm9vbCBfd2l0aGRyYXdhYmxlKSBvbmx5QWRtaW57CiAgICAgICAgCiAgICAgICAgaXNXaXRoZHJhd2FibGUgPSBfd2l0aGRyYXdhYmxlOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZG1pbl9zZXRfZGl2aWRlbmQoYWRkcmVzcyBfbWVtYmVyLCBib29sIF9kaXZpZGVuZCkgb25seUFkbWluIG1lbWJlckV4aXN0cyhfbWVtYmVyKXsKICAgICAgICAKICAgICAgICBtZW1iZXJzW19tZW1iZXJdLmlzRGl2aWRlbmQgPSBfZGl2aWRlbmQ7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkbWluX3NldF93aXRoZHJhdyhhZGRyZXNzIF9tZW1iZXIsIGJvb2wgX3dpdGhkcmF3KSBvbmx5QWRtaW4gbWVtYmVyRXhpc3RzKF9tZW1iZXIpewogICAgICAgIAogICAgICAgIG1lbWJlcnNbX21lbWJlcl0uaXNXaXRoZHJhdyA9IF93aXRoZHJhdzsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0X3RvdGFsX2luZm8oKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgX2RlcG9zaXRfYW1vdW50LCB1aW50MjU2IF90b3RhbF9kZXZpZGVuZCwgdWludDI1NiBfdG90YWxfcmVtYWluLCB1aW50MjU2IF90b3RhbF93aXRoZHJhdyl7CgogICAgICAgIF90b3RhbF9yZW1haW4gPSB0b3RhbF9kZXZpZGVuZCAtIHRvdGFsX3dpdGhkcmF3OwogICAgICAgIF9kZXBvc2l0X2Ftb3VudCA9IGRlcG9zaXRfYW1vdW50OwogICAgICAgIF90b3RhbF9kZXZpZGVuZCA9IHRvdGFsX2RldmlkZW5kOwogICAgICAgIF90b3RhbF93aXRoZHJhdyA9IHRvdGFsX3dpdGhkcmF3OwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRfaW5mbyhhZGRyZXNzIF9tZW1iZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX2JhbGFuY2UsIHVpbnQyNTYgX2RldmlkZW5kLCB1aW50MjU2IF9yZW1haW4sIHVpbnQyNTYgX3dpdGhkcmF3KXsKICAgICAgICAKICAgICAgICBfZGV2aWRlbmQgPSBtZW1iZXJzW19tZW1iZXJdLmRpdmlkZW5kOwogICAgICAgIF93aXRoZHJhdyA9IG1lbWJlcnNbX21lbWJlcl0ud2l0aGRyYXc7CiAgICAgICAgX3JlbWFpbiA9IF9kZXZpZGVuZCAtIF93aXRoZHJhdzsKICAgICAgICBfYmFsYW5jZSA9IGJhbGFuY2VzW19tZW1iZXJdOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIGlzTWVtYmVyIHsKICAgICAgICAKICAgICAgICB1aW50MjU2IF9yZW1haW4gPSBtZW1iZXJzW21zZy5zZW5kZXJdLmRpdmlkZW5kIC0gbWVtYmVyc1ttc2cuc2VuZGVyXS53aXRoZHJhdzsKICAgICAgICByZXF1aXJlKF9yZW1haW4gPiAwKTsKICAgICAgICByZXF1aXJlKGlzV2l0aGRyYXdhYmxlKTsKICAgICAgICByZXF1aXJlKG1lbWJlcnNbbXNnLnNlbmRlcl0uaXNXaXRoZHJhdyk7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfcmVtYWluKTsKICAgICAgICBtZW1iZXJzW21zZy5zZW5kZXJdLndpdGhkcmF3ICs9IF9yZW1haW47IAogICAgICAgIHRvdGFsX3dpdGhkcmF3ICs9IF9yZW1haW47ICAgICAgICAgIAoKICAgIH0KCiAgICBmdW5jdGlvbiBhZG1pbl93aXRoZHJhdyh1aW50IHhXZWkpIG9ubHlEZXBvc2l0ewoKICAgICAgICB1aW50MjU2IF93aXRoZHJhdyA9IHhXZWk7CgkJcmVxdWlyZSggbXNnLnNlbmRlciA9PSBkZXBvc2l0X2FkZHJlc3MgKTsKCgkJcmVxdWlyZSh0aGlzLmJhbGFuY2UgPiBfd2l0aGRyYXcpOwoJCW1zZy5zZW5kZXIudHJhbnNmZXIoX3dpdGhkcmF3KTsKCiAgICAgICAgd2l0aGRyYXdfYW1vdW50ICs9IF93aXRoZHJhdzsgIAogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZG1pbl93aXRoZHJhd19hbGwoYWRkcmVzcyBfZGVwb3NpdCkgb25seUFkbWluIHsKICAgICAgICAKCQlyZXF1aXJlKCBfZGVwb3NpdCA9PSBkZXBvc2l0X2FkZHJlc3MgKTsgCgoJCV9kZXBvc2l0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CgoJCXRvdGFsX2RldmlkZW5kID0gMDsgLy9tZW1iZXIKCQl0b3RhbF93aXRoZHJhdyA9IDA7IC8vbWVtYmVyCgkJZGVwb3NpdF9hbW91bnQgPSAwOyAgLy9kZXBvc2l0CgkJd2l0aGRyYXdfYW1vdW50ID0gMDsgLy9kZXBvc2l0CgkJZGl2aWRlbmRfYW1vdW50ID0gMDsgLy9hZG1pbiAgIAogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZG1pbl90cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlBZG1pbiBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSAgICAgewogICAgICAgIAogICAgICAgIHJlcXVpcmUoX3RvICE9IGRlcG9zaXRfYWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZSh0b3RhbF90b2tlbndlaSA8PSB0b3RhbFN1cHBseSAtIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgCiAgICAgICAgdG90YWxfdG9rZW53ZWkgKz0gX3ZhbHVlOwogICAgCiAgICAgICAgaWYgKG1lbWJlcnNbX3RvXS5pc0V4aXN0cyAhPSB0cnVlKSB7ICAKICAgICAgICAgICAgbWVtYmVyc1tfdG9dLmlzRXhpc3RzID0gdHJ1ZTsKICAgICAgICAgICAgbWVtYmVyc1tfdG9dLmlzRGl2aWRlbmQgPSB0cnVlOwogICAgICAgICAgICBtZW1iZXJzW190b10uaXNXaXRoZHJhdyA9IHRydWU7IAogICAgICAgICAgICBtZW1iZXJBcnJheS5wdXNoKF90byk7ICAKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAKCWZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgICAgIHsKCSAgICAKCQlyZXF1aXJlKF90byAhPSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKGlzUGF5YWJsZSk7CgkJYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKCQkKCQlpZihfdG8gPT0gZGVwb3NpdF9hZGRyZXNzKXsKCQkgICAgCgkJICAgIHJlcXVpcmUoX3ZhbHVlID09IHNob3BTdG9yZVByaWNlKTsKCQkgICAgc2hvcFN0b3JlTmV4dElkKys7CgkJICAgIHNob3BTdG9yZUlkW21zZy5zZW5kZXJdID0gc2hvcFN0b3JlTmV4dElkOwoJCSAgICBzaG9wU3RvcmVBZGRyZXNzW3Nob3BTdG9yZU5leHRJZF0gPSBtc2cuc2VuZGVyOwoJCQoJCX0gZWxzZSB7IAoJCSAgICAKCQkgICAgaWYoaXNMZWFkaW5nNEZGKF90bykpewoJCSAgICAKICAgIAkJICAgIHVpbnQyNTYgdG8yNTYgPSB1aW50MjU2KF90byk7CiAgICAgICAgICAgICAgICB1aW50MzIgZXhwaXJlID0gdWludDMyKHRvMjU2Pj45Nik7CiAgICAgICAgICAgICAgICB1aW50MzIgc3RvcmVpZCA9IHVpbnQyNCh0bzI1Nj4+NzIpOwogICAgICAgICAgICAgICAgLy91aW50OCBjcmM4ID0gdWludDgodG8yNTYpOwogICAgICAgICAgICAgICAgLy91aW50OCBieXRlMTkgPSB1aW50OCh0bzI1Nj4+OCk7CiAgICAgICAgICAgICAgICB1aW50OCBieXRlMTlfMSA9IHVpbnQ4KHVpbnQ4KHRvMjU2Pj44KT4+NCk7CiAgICAgICAgICAgICAgICB1aW50OCBieXRlMTlfMiA9IHVpbnQ4KHVpbnQ4KHRvMjU2Pj44KTw8NCk7CiAgICAgICAgICAgICAgICBieXRlMTlfMiA9IGJ5dGUxOV8yPj40OwogICAgICAgICAgICAgICAgdWludDU2IGJ5dGUxMjE4ID0gdWludDU2KHRvMjU2Pj4xNik7CiAgICAgICAgICAgICAgICB1aW50MzIgYnl0ZTEyMTUgPSB1aW50MzIodG8yNTY+PjQwKTsKICAgICAgICAgICAgICAgIHVpbnQyNCBieXRlMTYxOCA9IHVpbnQyNCh0bzI1Nj4+MTYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXF1aXJlKHVpbnQzMihub3cpPGV4cGlyZSB8fCBleHBpcmU9PTApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvL3VpbnQ4IGNyYzIwID0gdWludDgoc2hhMjU2KHVpbnQxNTIodG8yNTY+PjgpKSk7CiAgICAgICAgICAgICAgICByZXF1aXJlKHVpbnQ4KHNoYTI1Nih1aW50MTUyKHRvMjU2Pj44KSkpPT11aW50OCh0bzI1NikpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfdG8gPSBzaG9wU3RvcmVBZGRyZXNzW3VpbnQoc3RvcmVpZCldOwogICAgICAgICAgICAgICAgcmVxdWlyZSh1aW50KF90byk+MCk7CiAgICAKICAgICAgICAgICAgICAgIGlmKGJ5dGUxOV8xID09IDMpewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yKGludCBpID0gMDsgaSA8IGJ5dGUxOV8yOyBpKyspewogICAgICAgICAgICAgICAgICAgICAgICBieXRlMTYxOCAqPSAxMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZShieXRlMTYxOCA9PSBfdmFsdWUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAJCQogICAgCQl9CgkJICAgIAogICAgCQliYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIAkJaWYgKG1lbWJlcnNbX3RvXS5pc0V4aXN0cyAhPSB0cnVlKSB7CQkKICAgIAkJCW1lbWJlcnNbX3RvXS5pc0V4aXN0cyA9IHRydWU7CiAgICAJCQltZW1iZXJzW190b10uaXNEaXZpZGVuZCA9IHRydWU7CiAgICAJCQltZW1iZXJzW190b10uaXNXaXRoZHJhdyA9IHRydWU7IAogICAgCQkJbWVtYmVyQXJyYXkucHVzaChfdG8pOwkJCiAgICAJCX0gIAoKICAgICAgICB9CgoJCVRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKCX0KCQoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgICAgIHsKCQlyZXF1aXJlKF90byAhPSBkZXBvc2l0X2FkZHJlc3MpOwoJCXJlcXVpcmUoX2Zyb20gIT0gZGVwb3NpdF9hZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGlzUGF5YWJsZSk7CgkJdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsgCgkJcmVxdWlyZShfYWxsb3dhbmNlID49IF92YWx1ZSk7CgoJCWJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoJCWJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKCQlhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CgkJCgkJaWYgKG1lbWJlcnNbX3RvXS5pc0V4aXN0cyAhPSB0cnVlKSB7CQkKCQkJbWVtYmVyc1tfdG9dLmlzRXhpc3RzID0gdHJ1ZTsKCQkJbWVtYmVyc1tfdG9dLmlzRGl2aWRlbmQgPSB0cnVlOwoJCQltZW1iZXJzW190b10uaXNXaXRoZHJhdyA9IHRydWU7IAoJCQltZW1iZXJBcnJheS5wdXNoKF90byk7CQkKCQl9ICAKCgkJVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCX0KCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICAKICAgICAgICBwYXkoKTsKICAgICAgICAKICAgIH0KICAKICAgIGZ1bmN0aW9uIHBheSgpIHB1YmxpYyBwYXlhYmxlICByZXR1cm5zIChib29sKSB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZSghaXNMZWFkaW5nNEZGKG1zZy5zZW5kZXIpKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IG1pbl9wYXlfd2VpKTsKICAgICAgICByZXF1aXJlKGlzUGF5YWJsZSk7CiAgICAgICAgCiAgICAgICAgaWYobXNnLnNlbmRlciA9PSBkZXBvc2l0X2FkZHJlc3MpewogICAgICAgICAgICAgZGVwb3NpdF9hbW91bnQgKz0gbXNnLnZhbHVlOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAKICAgICAgICAgICAgaWYoaXNSZXF1aXJlRGF0YSl7CiAgICAgICAgICAgICAgICByZXF1aXJlKHVpbnQzMihtc2cuZGF0YVswXSkgPT0gdWludDMyKDB4RkZGRkZGRkYpKTsgICAKICAgICAgICAgICAgfQogICAgICAgIAogICAgCQl1aW50MjU2IGV4Y2hhbmdlV2VpID0gZ2V0X2V4Y2hhbmdlX3dlaSgpOwogICAgCQl1aW50MjU2IHRoaXNUb2tlbldlaSA9IGV4Y2hhbmdlV2VpICogbXNnLnZhbHVlIC8gMTAqKjE4IDsKICAgIAkJCiAgICAJCXJlcXVpcmUodG90YWxfdG9rZW53ZWkgPD0gdG90YWxTdXBwbHkgLSB0aGlzVG9rZW5XZWkpOwogICAgICAgIAogICAgICAgICAgICBpZiAobWVtYmVyc1ttc2cuc2VuZGVyXS5pc0V4aXN0cyAhPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG1lbWJlcnNbbXNnLnNlbmRlcl0uaXNFeGlzdHMgPSB0cnVlOwogICAgICAgICAgICAgICAgbWVtYmVyc1ttc2cuc2VuZGVyXS5pc0RpdmlkZW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1lbWJlcnNbbXNnLnNlbmRlcl0uaXNXaXRoZHJhdyA9IHRydWU7IAogICAgICAgICAgICAgICAgbWVtYmVyQXJyYXkucHVzaChtc2cuc2VuZGVyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9ICAKICAgIAkJYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdGhpc1Rva2VuV2VpOwogICAgCQl0b3RhbF90b2tlbndlaSArPSB0aGlzVG9rZW5XZWk7CiAgICAJCQogICAgCQlQYXlkYXRhKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgbXNnLmRhdGEsIHRoaXNUb2tlbldlaSk7CiAgICAJCVRyYW5zZmVyKHRoaXMsIG1zZy5zZW5kZXIsIHRoaXNUb2tlbldlaSk7CgkJCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgCiAgICB9CiAgICAgICAgICAgIAogICAgZnVuY3Rpb24gZ2V0X3RoaXNfYmFsYW5jZSgpIGNvbnN0YW50IHJldHVybnModWludDI1Nil7CiAgICAgIAogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICAgIAogICAgfQogICAgCn0='.
	

]
