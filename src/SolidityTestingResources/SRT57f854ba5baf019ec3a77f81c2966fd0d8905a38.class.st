Class {
	#name : #SRT57f854ba5baf019ec3a77f81c2966fd0d8905a38,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT57f854ba5baf019ec3a77f81c2966fd0d8905a38 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgovLyBjb3B5cmlnaHQgPGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijg0ZTdlYmVhZjBlNWU3ZjBjNGMxZjBlY2UxZjZlMWU5ZWJlYWFhZTdlYmU5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPgoKY29udHJhY3QgU2FmZU1hdGggewoKICAgIC8qIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgeyAqLwogICAgLyogICBpZiAoIWFzc2VydGlvbikgeyAqLwogICAgLyogICAgIHRocm93OyAqLwogICAgLyogICB9ICovCiAgICAvKiB9ICAgICAgLy8gYXNzZXJ0IG5vIGxvbmdlciBuZWVkZWQgb25jZSBzb2xpZGl0eSBpcyBvbiAwLjQuMTAgKi8KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdXJlIGludGVybmFsIHJldHVybnModWludDI1NikgewogICAgICB1aW50MjU2IHogPSB4ICsgeTsKICAgICAgYXNzZXJ0KCh6ID49IHgpICYmICh6ID49IHkpKTsKICAgICAgcmV0dXJuIHo7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1YnRyYWN0KHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdXJlIGludGVybmFsIHJldHVybnModWludDI1NikgewogICAgICBhc3NlcnQoeCA+PSB5KTsKICAgICAgdWludDI1NiB6ID0geCAtIHk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVNdWx0KHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdXJlIGludGVybmFsIHJldHVybnModWludDI1NikgewogICAgICB1aW50MjU2IHogPSB4ICogeTsKICAgICAgYXNzZXJ0KCh4ID09IDApfHwoei94ID09IHkpKTsKICAgICAgcmV0dXJuIHo7CiAgICB9Cgp9Cgpjb250cmFjdCBCYXNpY0FjY2Vzc0NvbnRyb2wgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICAvLyBhZGRyZXNzW10gcHVibGljIG1vZGVyYXRvcnM7CiAgICB1aW50MTYgcHVibGljIHRvdGFsTW9kZXJhdG9ycyA9IDA7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtb2RlcmF0b3JzOwogICAgYm9vbCBwdWJsaWMgaXNNYWludGFpbmluZyA9IHRydWU7CgogICAgZnVuY3Rpb24gQmFzaWNBY2Nlc3NDb250cm9sKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1vZGVyYXRvcnMoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyIHx8IG1vZGVyYXRvcnNbbXNnLnNlbmRlcl0gPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc0FjdGl2ZSB7CiAgICAgICAgcmVxdWlyZSghaXNNYWludGFpbmluZyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBDaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaWYgKF9uZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gQWRkTW9kZXJhdG9yKGFkZHJlc3MgX25ld01vZGVyYXRvcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaWYgKG1vZGVyYXRvcnNbX25ld01vZGVyYXRvcl0gPT0gZmFsc2UpIHsKICAgICAgICAgICAgbW9kZXJhdG9yc1tfbmV3TW9kZXJhdG9yXSA9IHRydWU7CiAgICAgICAgICAgIHRvdGFsTW9kZXJhdG9ycyArPSAxOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gUmVtb3ZlTW9kZXJhdG9yKGFkZHJlc3MgX29sZE1vZGVyYXRvcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaWYgKG1vZGVyYXRvcnNbX29sZE1vZGVyYXRvcl0gPT0gdHJ1ZSkgewogICAgICAgICAgICBtb2RlcmF0b3JzW19vbGRNb2RlcmF0b3JdID0gZmFsc2U7CiAgICAgICAgICAgIHRvdGFsTW9kZXJhdG9ycyAtPSAxOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBVcGRhdGVNYWludGFpbmluZyhib29sIF9pc01haW50YWluaW5nKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpc01haW50YWluaW5nID0gX2lzTWFpbnRhaW5pbmc7CiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyZW1vbkVudW0gewoKICAgIGVudW0gUmVzdWx0Q29kZSB7CiAgICAgICAgU1VDQ0VTUywKICAgICAgICBFUlJPUl9DTEFTU19OT1RfRk9VTkQsCiAgICAgICAgRVJST1JfTE9XX0JBTEFOQ0UsCiAgICAgICAgRVJST1JfU0VORF9GQUlMLAogICAgICAgIEVSUk9SX05PVF9UUkFJTkVSLAogICAgICAgIEVSUk9SX05PVF9FTk9VR0hfTU9ORVksCiAgICAgICAgRVJST1JfSU5WQUxJRF9BTU9VTlQsCiAgICAgICAgRVJST1JfT0JKX05PVF9GT1VORCwKICAgICAgICBFUlJPUl9PQkpfSU5WQUxJRF9PV05FUlNISVAKICAgIH0KICAgIAogICAgZW51bSBBcnJheVR5cGUgewogICAgICAgIENMQVNTX1RZUEUsCiAgICAgICAgU1RBVF9TVEVQLAogICAgICAgIFNUQVRfU1RBUlQsCiAgICAgICAgU1RBVF9CQVNFLAogICAgICAgIE9CSl9TS0lMTAogICAgfQogICAgCiAgICBlbnVtIFByb3BlcnR5VHlwZSB7CiAgICAgICAgQU5DRVNUT1IsCiAgICAgICAgWEZBQ1RPUgogICAgfQp9Cgpjb250cmFjdCBFdGhlcmVtb25EYXRhQmFzZSBpcyBFdGhlcmVtb25FbnVtLCBCYXNpY0FjY2Vzc0NvbnRyb2wsIFNhZmVNYXRoIHsKICAgIAogICAgdWludDY0IHB1YmxpYyB0b3RhbE1vbnN0ZXI7CiAgICB1aW50MzIgcHVibGljIHRvdGFsQ2xhc3M7CiAgICAKICAgIC8vIHdyaXRlCiAgICBmdW5jdGlvbiBhZGRFbGVtZW50VG9BcnJheVR5cGUoQXJyYXlUeXBlIF90eXBlLCB1aW50NjQgX2lkLCB1aW50OCBfdmFsdWUpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gcmVtb3ZlRWxlbWVudE9mQXJyYXlUeXBlKEFycmF5VHlwZSBfdHlwZSwgdWludDY0IF9pZCwgdWludDggX3ZhbHVlKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIHNldE1vbnN0ZXJDbGFzcyh1aW50MzIgX2NsYXNzSWQsIHVpbnQyNTYgX3ByaWNlLCB1aW50MjU2IF9yZXR1cm5QcmljZSwgYm9vbCBfY2F0Y2hhYmxlKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50MzIpOwogICAgZnVuY3Rpb24gYWRkTW9uc3Rlck9iaih1aW50MzIgX2NsYXNzSWQsIGFkZHJlc3MgX3RyYWluZXIsIHN0cmluZyBfbmFtZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIHNldE1vbnN0ZXJPYmoodWludDY0IF9vYmpJZCwgc3RyaW5nIF9uYW1lLCB1aW50MzIgX2V4cCwgdWludDMyIF9jcmVhdGVJbmRleCwgdWludDMyIF9sYXN0Q2xhaW1JbmRleCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gaW5jcmVhc2VNb25zdGVyRXhwKHVpbnQ2NCBfb2JqSWQsIHVpbnQzMiBhbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGRlY3JlYXNlTW9uc3RlckV4cCh1aW50NjQgX29iaklkLCB1aW50MzIgYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICBmdW5jdGlvbiByZW1vdmVNb25zdGVySWRNYXBwaW5nKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQ2NCBfbW9uc3RlcklkKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICBmdW5jdGlvbiBhZGRNb25zdGVySWRNYXBwaW5nKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQ2NCBfbW9uc3RlcklkKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICBmdW5jdGlvbiBjbGVhck1vbnN0ZXJSZXR1cm5CYWxhbmNlKHVpbnQ2NCBfbW9uc3RlcklkKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50MjU2IGFtb3VudCk7CiAgICBmdW5jdGlvbiBjb2xsZWN0QWxsUmV0dXJuQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50MjU2IGFtb3VudCk7CiAgICBmdW5jdGlvbiB0cmFuc2Zlck1vbnN0ZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQ2NCBfbW9uc3RlcklkKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyhSZXN1bHRDb2RlKTsKICAgIGZ1bmN0aW9uIGFkZEV4dHJhQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyLCB1aW50MjU2IF9hbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZGVkdWN0RXh0cmFCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQyNTYgX2Ftb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDI1Nik7CiAgICBmdW5jdGlvbiBzZXRFeHRyYUJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lciwgdWludDI1NiBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICAKICAgIC8vIHJlYWQKICAgIGZ1bmN0aW9uIGdldFNpemVBcnJheVR5cGUoQXJyYXlUeXBlIF90eXBlLCB1aW50NjQgX2lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGdldEVsZW1lbnRJbkFycmF5VHlwZShBcnJheVR5cGUgX3R5cGUsIHVpbnQ2NCBfaWQsIHVpbnQgX2luZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCk7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyQ2xhc3ModWludDMyIF9jbGFzc0lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MzIgY2xhc3NJZCwgdWludDI1NiBwcmljZSwgdWludDI1NiByZXR1cm5QcmljZSwgdWludDMyIHRvdGFsLCBib29sIGNhdGNoYWJsZSk7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyT2JqKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ2NCBvYmpJZCwgdWludDMyIGNsYXNzSWQsIGFkZHJlc3MgdHJhaW5lciwgdWludDMyIGV4cCwgdWludDMyIGNyZWF0ZUluZGV4LCB1aW50MzIgbGFzdENsYWltSW5kZXgsIHVpbnQgY3JlYXRlVGltZSk7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyTmFtZSh1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhzdHJpbmcgbmFtZSk7CiAgICBmdW5jdGlvbiBnZXRFeHRyYUJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyRGV4U2l6ZShhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJPYmpJZChhZGRyZXNzIF90cmFpbmVyLCB1aW50IGluZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gZ2V0RXhwZWN0ZWRCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlclJldHVybih1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2IGN1cnJlbnQsIHVpbnQyNTYgdG90YWwpOwp9Cgpjb250cmFjdCBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHsKICAgIHVpbnQ2NCBwdWJsaWMgdG90YWxFZ2cgPSAwOwogICAgZnVuY3Rpb24gZ2V0SGF0Y2hpbmdFZ2dJZChhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBnZXRIYXRjaGluZ0VnZ0RhdGEoYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQsIHVpbnQ2NCwgdWludDMyLCBhZGRyZXNzLCB1aW50LCB1aW50NjQpOwogICAgZnVuY3Rpb24gZ2V0VHJhbmZvcm1lZElkKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIGNvdW50RWdnKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludCk7CiAgICAKICAgIGZ1bmN0aW9uIHNldEhhdGNoVGltZSh1aW50NjQgX2VnZ0lkLCB1aW50IF9oYXRjaFRpbWUpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0SGF0Y2hlZEVnZyh1aW50NjQgX2VnZ0lkLCB1aW50NjQgX25ld09iaklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGFkZEVnZyh1aW50NjQgX29iaklkLCB1aW50MzIgX2NsYXNzSWQsIGFkZHJlc3MgX3RyYWluZXIsIHVpbnQgX2hhdGNoVGltZSkgZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gc2V0VHJhbmZvcm1lZCh1aW50NjQgX29iaklkLCB1aW50NjQgX25ld09iaklkKSBleHRlcm5hbDsKfQoKY29udHJhY3QgRXRoZXJlbW9uV29ybGQgaXMgRXRoZXJlbW9uRW51bSB7CiAgICAKICAgIGZ1bmN0aW9uIGdldEdlbjBDT25maWcodWludDMyIF9jbGFzc0lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MzIsIHVpbnQyNTYsIHVpbnQzMik7CiAgICBmdW5jdGlvbiBnZXRUcmFpbmVyRWFybihhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldFJldHVybkZyb21Nb25zdGVyKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYgY3VycmVudCwgdWludDI1NiB0b3RhbCk7CiAgICBmdW5jdGlvbiBnZXRDbGFzc1Byb3BlcnR5VmFsdWUodWludDMyIF9jbGFzc0lkLCBQcm9wZXJ0eVR5cGUgX3R5cGUsIHVpbnQgaW5kZXgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludDMyKTsKICAgIGZ1bmN0aW9uIGdldENsYXNzUHJvcGVydHlTaXplKHVpbnQzMiBfY2xhc3NJZCwgUHJvcGVydHlUeXBlIF90eXBlKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQpOwp9CgppbnRlcmZhY2UgRXRoZXJlbW9uQmF0dGxlIHsKICAgIGZ1bmN0aW9uIGlzT25CYXR0bGUodWludDY0IF9vYmpJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJMZXZlbCh1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCk7Cn0KCmludGVyZmFjZSBFdGhlcmVtb25UcmFkZUludGVyZmFjZSB7CiAgICBmdW5jdGlvbiBpc09uVHJhZGluZyh1aW50NjQgX29iaklkKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBFdGhlcmVtb25UcmFuc2Zvcm0gaXMgRXRoZXJlbW9uRW51bSwgQmFzaWNBY2Nlc3NDb250cm9sLCBTYWZlTWF0aCB7CiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgU1RBVF9DT1VOVCA9IDY7CiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgU1RBVF9NQVggPSAzMjsKICAgIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBHRU4wX05PID0gMjQ7CiAgICAKICAgIHN0cnVjdCBNb25zdGVyQ2xhc3NBY2MgewogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIHVpbnQyNTYgcHJpY2U7CiAgICAgICAgdWludDI1NiByZXR1cm5QcmljZTsKICAgICAgICB1aW50MzIgdG90YWw7CiAgICAgICAgYm9vbCBjYXRjaGFibGU7CiAgICB9CgogICAgc3RydWN0IE1vbnN0ZXJPYmpBY2MgewogICAgICAgIHVpbnQ2NCBtb25zdGVySWQ7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgYWRkcmVzcyB0cmFpbmVyOwogICAgICAgIHN0cmluZyBuYW1lOwogICAgICAgIHVpbnQzMiBleHA7CiAgICAgICAgdWludDMyIGNyZWF0ZUluZGV4OwogICAgICAgIHVpbnQzMiBsYXN0Q2xhaW1JbmRleDsKICAgICAgICB1aW50IGNyZWF0ZVRpbWU7CiAgICB9CiAgICAKICAgIHN0cnVjdCBNb25zdGVyRWdnIHsKICAgICAgICB1aW50NjQgZWdnSWQ7CiAgICAgICAgdWludDY0IG9iaklkOwogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIGFkZHJlc3MgdHJhaW5lcjsKICAgICAgICB1aW50IGhhdGNoVGltZTsKICAgICAgICB1aW50NjQgbmV3T2JqSWQ7CiAgICB9CiAgICAKICAgIHN0cnVjdCBCYXNpY09iakluZm8gewogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgICAgdWludDggbGV2ZWw7CiAgICB9CiAgICAKICAgIC8vIEdlbjAgaGFzIHJldHVybiBwcmljZSAmIG5vIGxvbmdlciBjYW4gYmUgY2F1Z2h0IHdoZW4gdGhpcyBjb250cmFjdCBpcyBkZXBsb3llZAogICAgc3RydWN0IEdlbjBDb25maWcgewogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIHVpbnQyNTYgb3JpZ2luYWxQcmljZTsKICAgICAgICB1aW50MjU2IHJldHVyblByaWNlOwogICAgICAgIHVpbnQzMiB0b3RhbDsgLy8gdG90YWwgY2F1Z2h0IChub3QgY291bnQgdGhvc2UgZnJvbSBlZ2dzKQogICAgfQogICAgCiAgICAvLyBoYXRjaGluZyByYW5nZQogICAgdWludDE2IHB1YmxpYyBoYXRjaFN0YXJ0VGltZSA9IDI7IC8vIGhvdXIKICAgIHVpbnQxNiBwdWJsaWMgaGF0Y2hNYXhUaW1lID0gNDY7IC8vIGhvdXIKICAgIHVpbnQgcHVibGljIHJlbW92ZUhhdGNoaW5nVGltZUZlZSA9IDAuMDUgZXRoZXI7IC8vIEVUSAogICAgdWludCBwdWJsaWMgYnV5RWdnRmVlID0gMC4wNiBldGhlcjsgLy8gRVRICiAgICAKICAgIHVpbnQzMltdIHB1YmxpYyByYW5kb21DbGFzc0lkczsKICAgIG1hcHBpbmcodWludDMyID0+IHVpbnQ4KSBwdWJsaWMgbGF5aW5nRWdnTGV2ZWxzOwogICAgbWFwcGluZyh1aW50MzIgPT4gdWludDgpIHB1YmxpYyBsYXlpbmdFZ2dEZWR1Y3Rpb25zOwogICAgbWFwcGluZyh1aW50MzIgPT4gdWludDgpIHB1YmxpYyB0cmFuc2Zvcm1MZXZlbHM7CiAgICBtYXBwaW5nKHVpbnQzMiA9PiB1aW50MzIpIHB1YmxpYyB0cmFuc2Zvcm1DbGFzc2VzOwoKICAgIG1hcHBpbmcodWludDggPT4gdWludDMyKSBwdWJsaWMgbGV2ZWxFeHBzOwogICAgYWRkcmVzcyBwcml2YXRlIGxhc3RIYXRjaGluZ0FkZHJlc3M7CiAgICAKICAgIG1hcHBpbmcodWludDMyID0+IEdlbjBDb25maWcpIHB1YmxpYyBnZW4wQ29uZmlnOwogICAgCiAgICAvLyBsaW5rZWQgc21hcnQgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIGRhdGFDb250cmFjdDsKICAgIGFkZHJlc3MgcHVibGljIHdvcmxkQ29udHJhY3Q7CiAgICBhZGRyZXNzIHB1YmxpYyB0cmFuc2Zvcm1EYXRhQ29udHJhY3Q7CiAgICBhZGRyZXNzIHB1YmxpYyBiYXR0bGVDb250cmFjdDsKICAgIGFkZHJlc3MgcHVibGljIHRyYWRlQ29udHJhY3Q7CiAgICAKICAgIC8vIGV2ZW50cwogICAgZXZlbnQgRXZlbnRMYXlFZ2coYWRkcmVzcyBpbmRleGVkIHRyYWluZXIsIHVpbnQ2NCBvYmpJZCwgdWludDY0IGVnZ0lkKTsKICAgIGV2ZW50IEV2ZW50SGF0Y2hFZ2coYWRkcmVzcyBpbmRleGVkIHRyYWluZXIsIHVpbnQ2NCBlZ2dJZCwgdWludDY0IG9iaklkKTsKICAgIGV2ZW50IEV2ZW50VHJhbnNmb3JtKGFkZHJlc3MgaW5kZXhlZCB0cmFpbmVyLCB1aW50NjQgb2xkT2JqSWQsIHVpbnQ2NCBuZXdPYmpJZCk7CiAgICBldmVudCBFdmVudFJlbGVhc2UoYWRkcmVzcyBpbmRleGVkIHRyYWluZXIsIHVpbnQ2NCBvYmpJZCk7CiAgICAKICAgIC8vIG1vZGlmaWVyCiAgICAKICAgIG1vZGlmaWVyIHJlcXVpcmVEYXRhQ29udHJhY3QgewogICAgICAgIHJlcXVpcmUoZGF0YUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIHJlcXVpcmVUcmFuc2Zvcm1EYXRhQ29udHJhY3QgewogICAgICAgIHJlcXVpcmUodHJhbnNmb3JtRGF0YUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIHJlcXVpcmVCYXR0bGVDb250cmFjdCB7CiAgICAgICAgcmVxdWlyZShiYXR0bGVDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciByZXF1aXJlVHJhZGVDb250cmFjdCB7CiAgICAgICAgcmVxdWlyZSh0cmFkZUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87ICAgICAgICAKICAgIH0KICAgIAogICAgCiAgICAvLyBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gRXRoZXJlbW9uVHJhbnNmb3JtKGFkZHJlc3MgX2RhdGFDb250cmFjdCwgYWRkcmVzcyBfd29ybGRDb250cmFjdCwgYWRkcmVzcyBfdHJhbnNmb3JtRGF0YUNvbnRyYWN0LCBhZGRyZXNzIF9iYXR0bGVDb250cmFjdCwgYWRkcmVzcyBfdHJhZGVDb250cmFjdCkgcHVibGljIHsKICAgICAgICBkYXRhQ29udHJhY3QgPSBfZGF0YUNvbnRyYWN0OwogICAgICAgIHdvcmxkQ29udHJhY3QgPSBfd29ybGRDb250cmFjdDsKICAgICAgICB0cmFuc2Zvcm1EYXRhQ29udHJhY3QgPSBfdHJhbnNmb3JtRGF0YUNvbnRyYWN0OwogICAgICAgIGJhdHRsZUNvbnRyYWN0ID0gX2JhdHRsZUNvbnRyYWN0OwogICAgICAgIHRyYWRlQ29udHJhY3QgPSBfdHJhZGVDb250cmFjdDsKICAgIH0KICAgIAogICAgLy8gaGVscGVyCiAgICBmdW5jdGlvbiBnZXRSYW5kb20odWludDE2IG1heFJhbiwgdWludDggaW5kZXgsIGFkZHJlc3MgcHJpQWRkcmVzcykgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDgpIHsKICAgICAgICB1aW50MjU2IGdlbk51bSA9IHVpbnQyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSkgKyB1aW50MjU2KHByaUFkZHJlc3MpOwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBpbmRleCAmJiBpIDwgNjsgaSArKykgewogICAgICAgICAgICBnZW5OdW0gLz0gMjU2OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdWludDgoZ2VuTnVtICUgbWF4UmFuKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkTmV3T2JqKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQzMiBfY2xhc3NJZCkgcHJpdmF0ZSByZXR1cm5zKHVpbnQ2NCkgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIHVpbnQ2NCBvYmpJZCA9IGRhdGEuYWRkTW9uc3Rlck9iaihfY2xhc3NJZCwgX3RyYWluZXIsICIuLm5hbWUgbWUuLi4iKTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgU1RBVF9DT1VOVDsgaSs9IDEpIHsKICAgICAgICAgICAgdWludDggdmFsdWUgPSBnZXRSYW5kb20oU1RBVF9NQVgsIHVpbnQ4KGkpLCBsYXN0SGF0Y2hpbmdBZGRyZXNzKSArIGRhdGEuZ2V0RWxlbWVudEluQXJyYXlUeXBlKEFycmF5VHlwZS5TVEFUX1NUQVJULCB1aW50NjQoX2NsYXNzSWQpLCBpKTsKICAgICAgICAgICAgZGF0YS5hZGRFbGVtZW50VG9BcnJheVR5cGUoQXJyYXlUeXBlLlNUQVRfQkFTRSwgb2JqSWQsIHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9iaklkOwogICAgfQogICAgCiAgICAvLyBhZG1pbiAmIG1vZGVyYXRvcnMKICAgIGZ1bmN0aW9uIHNldENvbnRyYWN0KGFkZHJlc3MgX2RhdGFDb250cmFjdCwgYWRkcmVzcyBfd29ybGRDb250cmFjdCwgYWRkcmVzcyBfdHJhbnNmb3JtRGF0YUNvbnRyYWN0LCBhZGRyZXNzIF9iYXR0bGVDb250cmFjdCwgYWRkcmVzcyBfdHJhZGVDb250cmFjdCkgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIGRhdGFDb250cmFjdCA9IF9kYXRhQ29udHJhY3Q7CiAgICAgICAgd29ybGRDb250cmFjdCA9IF93b3JsZENvbnRyYWN0OwogICAgICAgIHRyYW5zZm9ybURhdGFDb250cmFjdCA9IF90cmFuc2Zvcm1EYXRhQ29udHJhY3Q7CiAgICAgICAgYmF0dGxlQ29udHJhY3QgPSBfYmF0dGxlQ29udHJhY3Q7CiAgICAgICAgdHJhZGVDb250cmFjdCA9IF90cmFkZUNvbnRyYWN0OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE9yaWdpbmFsUHJpY2VHZW4wKCkgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIGdlbjBDb25maWdbMV0gPSBHZW4wQ29uZmlnKDEsIDAuMyBldGhlciwgMC4wMDMgZXRoZXIsIDM3NCk7CiAgICAgICAgZ2VuMENvbmZpZ1syXSA9IEdlbjBDb25maWcoMiwgMC4zIGV0aGVyLCAwLjAwMyBldGhlciwgNDA4KTsKICAgICAgICBnZW4wQ29uZmlnWzNdID0gR2VuMENvbmZpZygzLCAwLjMgZXRoZXIsIDAuMDAzIGV0aGVyLCAzNzMpOwogICAgICAgIGdlbjBDb25maWdbNF0gPSBHZW4wQ29uZmlnKDQsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDQzNyk7CiAgICAgICAgZ2VuMENvbmZpZ1s1XSA9IEdlbjBDb25maWcoNSwgMC4xIGV0aGVyLCAwLjAwMSBldGhlciwgNDk3KTsKICAgICAgICBnZW4wQ29uZmlnWzZdID0gR2VuMENvbmZpZyg2LCAwLjMgZXRoZXIsIDAuMDAzIGV0aGVyLCAzODApOyAKICAgICAgICBnZW4wQ29uZmlnWzddID0gR2VuMENvbmZpZyg3LCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzNDUpOwogICAgICAgIGdlbjBDb25maWdbOF0gPSBHZW4wQ29uZmlnKDgsIDAuMSBldGhlciwgMC4wMDEgZXRoZXIsIDUxOCk7IAogICAgICAgIGdlbjBDb25maWdbOV0gPSBHZW4wQ29uZmlnKDksIDAuMSBldGhlciwgMC4wMDEgZXRoZXIsIDQ0Nyk7CiAgICAgICAgZ2VuMENvbmZpZ1sxMF0gPSBHZW4wQ29uZmlnKDEwLCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzODApOyAKICAgICAgICBnZW4wQ29uZmlnWzExXSA9IEdlbjBDb25maWcoMTEsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM1NCk7CiAgICAgICAgZ2VuMENvbmZpZ1sxMl0gPSBHZW4wQ29uZmlnKDEyLCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzNDYpOwogICAgICAgIGdlbjBDb25maWdbMTNdID0gR2VuMENvbmZpZygxMywgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzUxKTsgCiAgICAgICAgZ2VuMENvbmZpZ1sxNF0gPSBHZW4wQ29uZmlnKDE0LCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzMzgpOwogICAgICAgIGdlbjBDb25maWdbMTVdID0gR2VuMENvbmZpZygxNSwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzQxKTsKICAgICAgICBnZW4wQ29uZmlnWzE2XSA9IEdlbjBDb25maWcoMTYsIDAuMzUgZXRoZXIsIDAuMDAzNSBldGhlciwgMzg0KTsKICAgICAgICBnZW4wQ29uZmlnWzE3XSA9IEdlbjBDb25maWcoMTcsIDEgZXRoZXIsIDAuMDEgZXRoZXIsIDMwNSk7IAogICAgICAgIGdlbjBDb25maWdbMThdID0gR2VuMENvbmZpZygxOCwgMC4xIGV0aGVyLCAwLjAwMSBldGhlciwgNDI3KTsKICAgICAgICBnZW4wQ29uZmlnWzE5XSA9IEdlbjBDb25maWcoMTksIDEgZXRoZXIsIDAuMDEgZXRoZXIsIDMwNCk7CiAgICAgICAgZ2VuMENvbmZpZ1syMF0gPSBHZW4wQ29uZmlnKDIwLCAwLjQgZXRoZXIsIDAuMDUgZXRoZXIsIDgyKTsKICAgICAgICBnZW4wQ29uZmlnWzIxXSA9IEdlbjBDb25maWcoMjEsIDEsIDEsIDEyMyk7CiAgICAgICAgZ2VuMENvbmZpZ1syMl0gPSBHZW4wQ29uZmlnKDIyLCAwLjIgZXRoZXIsIDAuMDAxIGV0aGVyLCA0NjgpOwogICAgICAgIGdlbjBDb25maWdbMjNdID0gR2VuMENvbmZpZygyMywgMC41IGV0aGVyLCAwLjAwMjUgZXRoZXIsIDMwMik7CiAgICAgICAgZ2VuMENvbmZpZ1syNF0gPSBHZW4wQ29uZmlnKDI0LCAxIGV0aGVyLCAwLjAwNSBldGhlciwgMTk1KTsKICAgIH0gICAgCgogICAgZnVuY3Rpb24gdXBkYXRlSGF0Y2hpbmdSYW5nZSh1aW50MTYgX3N0YXJ0LCB1aW50MTYgX21heCkgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIGhhdGNoU3RhcnRUaW1lID0gX3N0YXJ0OwogICAgICAgIGhhdGNoTWF4VGltZSA9IF9tYXg7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcihhZGRyZXNzIF9zZW5kVG8sIHVpbnQgX2Ftb3VudCkgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIC8vIG5vIHVzZXIgbW9uZXkgaXMga2VwdCBpbiB0aGlzIGNvbnRyYWN0LCBvbmx5IHRyYXNhY3Rpb24gZmVlCiAgICAgICAgaWYgKF9hbW91bnQgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF9zZW5kVG8udHJhbnNmZXIoX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29uZmlnQ2xhc3ModWludDMyIF9jbGFzc0lkLCB1aW50OCBfbGF5aW5nTGV2ZWwsIHVpbnQ4IF9sYXlpbmdDb3N0LCB1aW50OCBfdHJhbnNmb3JtTGV2ZWwsIHVpbnQzMiBfdHJhbmZvcm1DbGFzcykgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIGxheWluZ0VnZ0xldmVsc1tfY2xhc3NJZF0gPSBfbGF5aW5nTGV2ZWw7CiAgICAgICAgbGF5aW5nRWdnRGVkdWN0aW9uc1tfY2xhc3NJZF0gPSBfbGF5aW5nQ29zdDsKICAgICAgICB0cmFuc2Zvcm1MZXZlbHNbX2NsYXNzSWRdID0gX3RyYW5zZm9ybUxldmVsOwogICAgICAgIHRyYW5zZm9ybUNsYXNzZXNbX2NsYXNzSWRdID0gX3RyYW5mb3JtQ2xhc3M7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldENvbmZpZyh1aW50IF9yZW1vdmVIYXRjaGluZ1RpbWVGZWUsIHVpbnQgX2J1eUVnZ0ZlZSkgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIHJlbW92ZUhhdGNoaW5nVGltZUZlZSA9IF9yZW1vdmVIYXRjaGluZ1RpbWVGZWU7CiAgICAgICAgYnV5RWdnRmVlID0gX2J1eUVnZ0ZlZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5MZXZlbEV4cCgpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICB1aW50OCBsZXZlbCA9IDE7CiAgICAgICAgdWludDMyIHJlcXVpcmVtZW50ID0gMTAwOwogICAgICAgIHVpbnQzMiBzdW0gPSByZXF1aXJlbWVudDsKICAgICAgICB3aGlsZShsZXZlbCA8PSAxMDApIHsKICAgICAgICAgICAgbGV2ZWxFeHBzW2xldmVsXSA9IHN1bTsKICAgICAgICAgICAgbGV2ZWwgKz0gMTsKICAgICAgICAgICAgcmVxdWlyZW1lbnQgPSAocmVxdWlyZW1lbnQgKiAxMSkgLyAxMCArIDU7CiAgICAgICAgICAgIHN1bSArPSByZXF1aXJlbWVudDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkZFJhbmRvbUNsYXNzKHVpbnQzMiBfbmV3Q2xhc3NJZCkgb25seU1vZGVyYXRvcnMgcHVibGljIHsKICAgICAgICBpZiAoX25ld0NsYXNzSWQgPiAwKSB7CiAgICAgICAgICAgIGZvciAodWludCBpbmRleCA9IDA7IGluZGV4IDwgcmFuZG9tQ2xhc3NJZHMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICBpZiAocmFuZG9tQ2xhc3NJZHNbaW5kZXhdID09IF9uZXdDbGFzc0lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJhbmRvbUNsYXNzSWRzLnB1c2goX25ld0NsYXNzSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlUmFuZG9tQ2xhc3ModWludDMyIF9vbGRDbGFzc0lkKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgewogICAgICAgIHVpbnQgZm91bmRJbmRleCA9IDA7CiAgICAgICAgZm9yICg7IGZvdW5kSW5kZXggPCByYW5kb21DbGFzc0lkcy5sZW5ndGg7IGZvdW5kSW5kZXgrKykgewogICAgICAgICAgICBpZiAocmFuZG9tQ2xhc3NJZHNbZm91bmRJbmRleF0gPT0gX29sZENsYXNzSWQpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChmb3VuZEluZGV4IDwgcmFuZG9tQ2xhc3NJZHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHJhbmRvbUNsYXNzSWRzW2ZvdW5kSW5kZXhdID0gcmFuZG9tQ2xhc3NJZHNbcmFuZG9tQ2xhc3NJZHMubGVuZ3RoLTFdOwogICAgICAgICAgICBkZWxldGUgcmFuZG9tQ2xhc3NJZHNbcmFuZG9tQ2xhc3NJZHMubGVuZ3RoLTFdOwogICAgICAgICAgICByYW5kb21DbGFzc0lkcy5sZW5ndGgtLTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZUhhdGNoaW5nVGltZVdpdGhUb2tlbihhZGRyZXNzIF90cmFpbmVyKSBpc0FjdGl2ZSBvbmx5TW9kZXJhdG9ycyByZXF1aXJlRGF0YUNvbnRyYWN0IHJlcXVpcmVUcmFuc2Zvcm1EYXRhQ29udHJhY3QgZXh0ZXJuYWwgewogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyRWdnIG1lbW9yeSBlZ2c7CiAgICAgICAgKGVnZy5lZ2dJZCwgZWdnLm9iaklkLCBlZ2cuY2xhc3NJZCwgZWdnLnRyYWluZXIsIGVnZy5oYXRjaFRpbWUsIGVnZy5uZXdPYmpJZCkgPSB0cmFuc2Zvcm1EYXRhLmdldEhhdGNoaW5nRWdnRGF0YShfdHJhaW5lcik7CiAgICAgICAgLy8gbm90IGhhdGNoaW5nIGFueSBlZ2cKICAgICAgICBpZiAoZWdnLmVnZ0lkID09IDAgfHwgZWdnLnRyYWluZXIgIT0gX3RyYWluZXIgfHwgZWdnLm5ld09iaklkID4gMCkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgdHJhbnNmb3JtRGF0YS5zZXRIYXRjaFRpbWUoZWdnLmVnZ0lkLCAwKTsKICAgIH0gICAgCiAgICAKICAgIGZ1bmN0aW9uIGJ1eUVnZ1dpdGhUb2tlbihhZGRyZXNzIF90cmFpbmVyKSBpc0FjdGl2ZSBvbmx5TW9kZXJhdG9ycyByZXF1aXJlRGF0YUNvbnRyYWN0IHJlcXVpcmVUcmFuc2Zvcm1EYXRhQ29udHJhY3QgZXh0ZXJuYWwgewogICAgICAgIGlmIChyYW5kb21DbGFzc0lkcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgIC8vIG1ha2Ugc3VyZSBubyBoYXRjaGluZyBlZ2cgYXQgdGhlIHNhbWUgdGltZQogICAgICAgIGlmICh0cmFuc2Zvcm1EYXRhLmdldEhhdGNoaW5nRWdnSWQoX3RyYWluZXIpID4gMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCByYW5kb20gZWdnCiAgICAgICAgdWludDggY2xhc3NJbmRleCA9IGdldFJhbmRvbSh1aW50MTYocmFuZG9tQ2xhc3NJZHMubGVuZ3RoKSwgMSwgbGFzdEhhdGNoaW5nQWRkcmVzcyk7CiAgICAgICAgdWludDY0IGVnZ0lkID0gdHJhbnNmb3JtRGF0YS5hZGRFZ2coMCwgcmFuZG9tQ2xhc3NJZHNbY2xhc3NJbmRleF0sIF90cmFpbmVyLCBibG9jay50aW1lc3RhbXAgKyAoaGF0Y2hTdGFydFRpbWUgKyBnZXRSYW5kb20oaGF0Y2hNYXhUaW1lLCAwLCBsYXN0SGF0Y2hpbmdBZGRyZXNzKSkgKiAzNjAwKTsKICAgICAgICAvLyBkZWR1Y3QgZXhwCiAgICAgICAgRXZlbnRMYXlFZ2cobXNnLnNlbmRlciwgMCwgZWdnSWQpOwogICAgfQogICAgCiAgICAvLyBwdWJsaWMKCiAgICBmdW5jdGlvbiBjZWlsKHVpbnQgYSwgdWludCBtKSBwdXJlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuICgoYSArIG0gLSAxKSAvIG0pICogbTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMZXZlbCh1aW50MzIgZXhwKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHVpbnQ4IG1pbkluZGV4ID0gMTsKICAgICAgICB1aW50OCBtYXhJbmRleCA9IDEwMDsKICAgICAgICB1aW50OCBjdXJyZW50SW5kZXg7CiAgICAgCiAgICAgICAgd2hpbGUgKG1pbkluZGV4IDwgbWF4SW5kZXgpIHsKICAgICAgICAgICAgY3VycmVudEluZGV4ID0gKG1pbkluZGV4ICsgbWF4SW5kZXgpIC8gMjsKICAgICAgICAgICAgaWYgKGV4cCA8IGxldmVsRXhwc1tjdXJyZW50SW5kZXhdKQogICAgICAgICAgICAgICAgbWF4SW5kZXggPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG1pbkluZGV4ID0gY3VycmVudEluZGV4ICsgMTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtaW5JbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRHZW4wT2JqSW5mbyh1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MzIsIHVpbnQzMiwgdWludDI1NikgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIAogICAgICAgIE1vbnN0ZXJPYmpBY2MgbWVtb3J5IG9iajsKICAgICAgICAob2JqLm1vbnN0ZXJJZCwgb2JqLmNsYXNzSWQsIG9iai50cmFpbmVyLCBvYmouZXhwLCBvYmouY3JlYXRlSW5kZXgsIG9iai5sYXN0Q2xhaW1JbmRleCwgb2JqLmNyZWF0ZVRpbWUpID0gZGF0YS5nZXRNb25zdGVyT2JqKF9vYmpJZCk7CiAgICAgICAgCiAgICAgICAgR2VuMENvbmZpZyBtZW1vcnkgZ2VuMCA9IGdlbjBDb25maWdbb2JqLmNsYXNzSWRdOwogICAgICAgIGlmIChnZW4wLmNsYXNzSWQgIT0gb2JqLmNsYXNzSWQpIHsKICAgICAgICAgICAgcmV0dXJuIChnZW4wLmNsYXNzSWQsIG9iai5jcmVhdGVJbmRleCwgMCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQzMiB0b3RhbEdhcCA9IDA7CiAgICAgICAgaWYgKG9iai5jcmVhdGVJbmRleCA8IGdlbjAudG90YWwpCiAgICAgICAgICAgIHRvdGFsR2FwID0gZ2VuMC50b3RhbCAtIG9iai5jcmVhdGVJbmRleDsKICAgICAgICAKICAgICAgICByZXR1cm4gKG9iai5jbGFzc0lkLCBvYmouY3JlYXRlSW5kZXgsIHNhZmVNdWx0KHRvdGFsR2FwLCBnZW4wLnJldHVyblByaWNlKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE9iakNsYXNzSWQodWludDY0IF9vYmpJZCkgcmVxdWlyZURhdGFDb250cmFjdCBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MzIsIGFkZHJlc3MsIHVpbnQ4KSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgIHVpbnQzMiBfID0gMDsKICAgICAgICAob2JqLm1vbnN0ZXJJZCwgb2JqLmNsYXNzSWQsIG9iai50cmFpbmVyLCBvYmouZXhwLCBfLCBfLCBvYmouY3JlYXRlVGltZSkgPSBkYXRhLmdldE1vbnN0ZXJPYmooX29iaklkKTsKICAgICAgICByZXR1cm4gKG9iai5jbGFzc0lkLCBvYmoudHJhaW5lciwgZ2V0TGV2ZWwob2JqLmV4cCkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDbGFzc0NoZWNrT3duZXIodWludDY0IF9vYmpJZCwgYWRkcmVzcyBfdHJhaW5lcikgcmVxdWlyZURhdGFDb250cmFjdCBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MzIpIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyT2JqQWNjIG1lbW9yeSBvYmo7CiAgICAgICAgdWludDMyIF8gPSAwOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIF8sIF8sIG9iai5jcmVhdGVUaW1lKSA9IGRhdGEuZ2V0TW9uc3Rlck9iaihfb2JqSWQpOwogICAgICAgIGlmIChfdHJhaW5lciAhPSBvYmoudHJhaW5lcikKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIG9iai5jbGFzc0lkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU1heEVnZ0cwKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICB1aW50MzIgY3JlYXRlSW5kZXg7IAogICAgICAgIHVpbnQyNTYgdG90YWxFYXJuOwogICAgICAgIChjbGFzc0lkLCBjcmVhdGVJbmRleCwgdG90YWxFYXJuKSA9IGdldEdlbjBPYmpJbmZvKF9vYmpJZCk7CiAgICAgICAgaWYgKGNsYXNzSWQgPiBHRU4wX05PIHx8IGNsYXNzSWQgPT0gMjAgfHwgY2xhc3NJZCA9PSAyMSkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgCiAgICAgICAgR2VuMENvbmZpZyBtZW1vcnkgY29uZmlnID0gZ2VuMENvbmZpZ1tjbGFzc0lkXTsKICAgICAgICAvLyB0aGUgb25lIGZyb20gZWdnIGNhbiBub3QgbGF5CiAgICAgICAgaWYgKGNyZWF0ZUluZGV4ID4gY29uZmlnLnRvdGFsKQogICAgICAgICAgICByZXR1cm4gMDsKCiAgICAgICAgLy8gY2FsY3VsYXRlIGFndiBwcmljZQogICAgICAgIHVpbnQyNTYgYXZnUHJpY2UgPSBjb25maWcub3JpZ2luYWxQcmljZTsKICAgICAgICB1aW50IHJhdGUgPSBjb25maWcub3JpZ2luYWxQcmljZS9jb25maWcucmV0dXJuUHJpY2U7CiAgICAgICAgaWYgKGNvbmZpZy50b3RhbCA+IHJhdGUpIHsKICAgICAgICAgICAgdWludCBrID0gY29uZmlnLnRvdGFsIC0gcmF0ZTsKICAgICAgICAgICAgYXZnUHJpY2UgPSAoY29uZmlnLnRvdGFsICogY29uZmlnLm9yaWdpbmFsUHJpY2UgKyBjb25maWcucmV0dXJuUHJpY2UgKiBrICogKGsrMSkgLyAyKSAvIGNvbmZpZy50b3RhbDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBjYXRjaFByaWNlID0gY29uZmlnLm9yaWdpbmFsUHJpY2U7ICAgICAgICAgICAgCiAgICAgICAgaWYgKGNyZWF0ZUluZGV4ID4gcmF0ZSkgewogICAgICAgICAgICBjYXRjaFByaWNlICs9IGNvbmZpZy5yZXR1cm5QcmljZSAqIHNhZmVTdWJ0cmFjdChjcmVhdGVJbmRleCwgcmF0ZSk7CiAgICAgICAgfQogICAgICAgIGlmICh0b3RhbEVhcm4gPj0gY2F0Y2hQcmljZSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNlaWwoKGNhdGNoUHJpY2UgLSB0b3RhbEVhcm4pKjE1KjEwMDAvYXZnUHJpY2UsIDEwMDAwKS8xMDAwMDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2FuTGF5RWdnKHVpbnQ2NCBfb2JqSWQsIHVpbnQzMiBfY2xhc3NJZCwgdWludDMyIF9sZXZlbCkgY29uc3RhbnQgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIGlmIChfY2xhc3NJZCA8PSBHRU4wX05PKSB7CiAgICAgICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgLy8gbGVnZW5kcwogICAgICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5jb3VudEVnZyhfb2JqSWQpID49IGNhbGN1bGF0ZU1heEVnZ0cwKF9vYmpJZCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChsYXlpbmdFZ2dMZXZlbHNbX2NsYXNzSWRdID09IDAgfHwgX2xldmVsIDwgbGF5aW5nRWdnTGV2ZWxzW19jbGFzc0lkXSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBsYXlFZ2codWludDY0IF9vYmpJZCkgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHsKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgLy8gbWFrZSBzdXJlIG5vIGhhdGNoaW5nIGVnZyBhdCB0aGUgc2FtZSB0aW1lCiAgICAgICAgaWYgKHRyYW5zZm9ybURhdGEuZ2V0SGF0Y2hpbmdFZ2dJZChtc2cuc2VuZGVyKSA+IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGNoZWNrIG9iaiAKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyT2JqQWNjIG1lbW9yeSBvYmo7CiAgICAgICAgdWludDMyIF8gPSAwOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIF8sIF8sIG9iai5jcmVhdGVUaW1lKSA9IGRhdGEuZ2V0TW9uc3Rlck9iaihfb2JqSWQpOwogICAgICAgIGlmIChvYmoubW9uc3RlcklkICE9IF9vYmpJZCB8fCBvYmoudHJhaW5lciAhPSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjaGVjayBsYXkgZWdnIGNvbmRpdGlvbgogICAgICAgIHVpbnQ4IGN1cnJlbnRMZXZlbCA9IGdldExldmVsKG9iai5leHApOwogICAgICAgIHVpbnQ4IGFmdGVyTGV2ZWwgPSAwOwogICAgICAgIGlmICghY2FuTGF5RWdnKF9vYmpJZCwgb2JqLmNsYXNzSWQsIGN1cnJlbnRMZXZlbCkpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIGlmIChsYXlpbmdFZ2dEZWR1Y3Rpb25zW29iai5jbGFzc0lkXSA+PSBjdXJyZW50TGV2ZWwpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIGFmdGVyTGV2ZWwgPSBjdXJyZW50TGV2ZWwgLSBsYXlpbmdFZ2dEZWR1Y3Rpb25zW29iai5jbGFzc0lkXTsKCiAgICAgICAgLy8gYWRkIGVnZyAKICAgICAgICB1aW50NjQgZWdnSWQgPSB0cmFuc2Zvcm1EYXRhLmFkZEVnZyhvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgbXNnLnNlbmRlciwgYmxvY2sudGltZXN0YW1wICsgKGhhdGNoU3RhcnRUaW1lICsgZ2V0UmFuZG9tKGhhdGNoTWF4VGltZSwgMCwgbGFzdEhhdGNoaW5nQWRkcmVzcykpICogMzYwMCk7CiAgICAgICAgCiAgICAgICAgLy8gZGVkdWN0IGV4cCAKICAgICAgICBpZiAoYWZ0ZXJMZXZlbCA8IGN1cnJlbnRMZXZlbCkKICAgICAgICAgICAgZGF0YS5kZWNyZWFzZU1vbnN0ZXJFeHAoX29iaklkLCBvYmouZXhwIC0gbGV2ZWxFeHBzW2FmdGVyTGV2ZWwtMV0pOwogICAgICAgIEV2ZW50TGF5RWdnKG1zZy5zZW5kZXIsIF9vYmpJZCwgZWdnSWQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBoYXRjaEVnZygpIGlzQWN0aXZlIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCB7CiAgICAgICAgLy8gdXNlIGFzIGEgc2VlZCBmb3IgcmFuZG9tCiAgICAgICAgbGFzdEhhdGNoaW5nQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJFZ2cgbWVtb3J5IGVnZzsKICAgICAgICAoZWdnLmVnZ0lkLCBlZ2cub2JqSWQsIGVnZy5jbGFzc0lkLCBlZ2cudHJhaW5lciwgZWdnLmhhdGNoVGltZSwgZWdnLm5ld09iaklkKSA9IHRyYW5zZm9ybURhdGEuZ2V0SGF0Y2hpbmdFZ2dEYXRhKG1zZy5zZW5kZXIpOwogICAgICAgIC8vIG5vdCBoYXRjaGluZyBhbnkgZWdnCiAgICAgICAgaWYgKGVnZy5lZ2dJZCA9PSAwIHx8IGVnZy50cmFpbmVyICE9IG1zZy5zZW5kZXIpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIC8vIG5lZWQgbW9yZSB0aW1lCiAgICAgICAgaWYgKGVnZy5uZXdPYmpJZCA+IDAgfHwgZWdnLmhhdGNoVGltZSA+IGJsb2NrLnRpbWVzdGFtcCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDY0IG9iaklkID0gYWRkTmV3T2JqKG1zZy5zZW5kZXIsIGVnZy5jbGFzc0lkKTsKICAgICAgICB0cmFuc2Zvcm1EYXRhLnNldEhhdGNoZWRFZ2coZWdnLmVnZ0lkLCBvYmpJZCk7CiAgICAgICAgRXZlbnRIYXRjaEVnZyhtc2cuc2VuZGVyLCBlZ2cuZWdnSWQsIG9iaklkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlSGF0Y2hpbmdUaW1lKCkgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHBheWFibGUgIHsKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3RlckVnZyBtZW1vcnkgZWdnOwogICAgICAgIChlZ2cuZWdnSWQsIGVnZy5vYmpJZCwgZWdnLmNsYXNzSWQsIGVnZy50cmFpbmVyLCBlZ2cuaGF0Y2hUaW1lLCBlZ2cubmV3T2JqSWQpID0gdHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0RhdGEobXNnLnNlbmRlcik7CiAgICAgICAgLy8gbm90IGhhdGNoaW5nIGFueSBlZ2cKICAgICAgICBpZiAoZWdnLmVnZ0lkID09IDAgfHwgZWdnLnRyYWluZXIgIT0gbXNnLnNlbmRlciB8fCBlZ2cubmV3T2JqSWQgPiAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAKICAgICAgICBpZiAobXNnLnZhbHVlICE9IHJlbW92ZUhhdGNoaW5nVGltZUZlZSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgdHJhbnNmb3JtRGF0YS5zZXRIYXRjaFRpbWUoZWdnLmVnZ0lkLCAwKTsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIGNoZWNrQW5jZXN0b3JzKHVpbnQzMiBfY2xhc3NJZCwgYWRkcmVzcyBfdHJhaW5lciwgdWludDY0IF9hMSwgdWludDY0IF9hMiwgdWludDY0IF9hMykgY29uc3RhbnQgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIEV0aGVyZW1vbldvcmxkIHdvcmxkID0gRXRoZXJlbW9uV29ybGQod29ybGRDb250cmFjdCk7CiAgICAgICAgdWludCBpbmRleCA9IDA7CiAgICAgICAgdWludDMyIHRlbXAgPSAwOwogICAgICAgIC8vIGNoZWNrIGFuY2VzdG9yCiAgICAgICAgdWludDMyWzNdIG1lbW9yeSBhbmNlc3RvcnM7CiAgICAgICAgdWludDMyWzNdIG1lbW9yeSByZXF1ZXN0QW5jZXN0b3JzOwogICAgICAgIGluZGV4ID0gd29ybGQuZ2V0Q2xhc3NQcm9wZXJ0eVNpemUoX2NsYXNzSWQsIFByb3BlcnR5VHlwZS5BTkNFU1RPUik7CiAgICAgICAgd2hpbGUgKGluZGV4ID4gMCkgewogICAgICAgICAgICBpbmRleCAtPSAxOwogICAgICAgICAgICBhbmNlc3RvcnNbaW5kZXhdID0gd29ybGQuZ2V0Q2xhc3NQcm9wZXJ0eVZhbHVlKF9jbGFzc0lkLCBQcm9wZXJ0eVR5cGUuQU5DRVNUT1IsIGluZGV4KTsKICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGlmIChfYTEgPiAwKSB7CiAgICAgICAgICAgIHRlbXAgPSBnZXRDbGFzc0NoZWNrT3duZXIoX2ExLCBfdHJhaW5lcik7CiAgICAgICAgICAgIGlmICh0ZW1wID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJlcXVlc3RBbmNlc3RvcnNbMF0gPSB0ZW1wOwogICAgICAgIH0KICAgICAgICBpZiAoX2EyID4gMCkgewogICAgICAgICAgICB0ZW1wID0gZ2V0Q2xhc3NDaGVja093bmVyKF9hMiwgX3RyYWluZXIpOwogICAgICAgICAgICBpZiAodGVtcCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXF1ZXN0QW5jZXN0b3JzWzFdID0gdGVtcDsKICAgICAgICB9CiAgICAgICAgaWYgKF9hMyA+IDApIHsKICAgICAgICAgICAgdGVtcCA9IGdldENsYXNzQ2hlY2tPd25lcihfYTMsIF90cmFpbmVyKTsKICAgICAgICAgICAgaWYgKHRlbXAgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmVxdWVzdEFuY2VzdG9yc1syXSA9IHRlbXA7CiAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdEFuY2VzdG9yc1swXSA+IDAgJiYgKHJlcXVlc3RBbmNlc3RvcnNbMF0gPT0gcmVxdWVzdEFuY2VzdG9yc1sxXSB8fCByZXF1ZXN0QW5jZXN0b3JzWzBdID09IHJlcXVlc3RBbmNlc3RvcnNbMl0pKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHJlcXVlc3RBbmNlc3RvcnNbMV0gPiAwICYmIChyZXF1ZXN0QW5jZXN0b3JzWzFdID09IHJlcXVlc3RBbmNlc3RvcnNbMl0pKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAKICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBhbmNlc3RvcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHRlbXAgPSBhbmNlc3RvcnNbaW5kZXhdOwogICAgICAgICAgICBpZiAodGVtcCA+IDAgJiYgdGVtcCAhPSByZXF1ZXN0QW5jZXN0b3JzWzBdICAmJiB0ZW1wICE9IHJlcXVlc3RBbmNlc3RvcnNbMV0gJiYgdGVtcCAhPSByZXF1ZXN0QW5jZXN0b3JzWzJdKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmb3JtKHVpbnQ2NCBfb2JqSWQsIHVpbnQ2NCBfYTEsIHVpbnQ2NCBfYTIsIHVpbnQ2NCBfYTMpIGlzQWN0aXZlIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgaWYgKHRyYW5zZm9ybURhdGEuZ2V0VHJhbmZvcm1lZElkKF9vYmpJZCkgPiAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAKICAgICAgICBFdGhlcmVtb25CYXR0bGUgYmF0dGxlID0gRXRoZXJlbW9uQmF0dGxlKGJhdHRsZUNvbnRyYWN0KTsKICAgICAgICBFdGhlcmVtb25UcmFkZUludGVyZmFjZSB0cmFkZSA9IEV0aGVyZW1vblRyYWRlSW50ZXJmYWNlKHRyYWRlQ29udHJhY3QpOwogICAgICAgIGlmIChiYXR0bGUuaXNPbkJhdHRsZShfb2JqSWQpIHx8IHRyYWRlLmlzT25UcmFkaW5nKF9vYmpJZCkpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIAogICAgICAgIEJhc2ljT2JqSW5mbyBtZW1vcnkgb2JqSW5mbzsKICAgICAgICAob2JqSW5mby5jbGFzc0lkLCBvYmpJbmZvLm93bmVyLCBvYmpJbmZvLmxldmVsKSA9IGdldE9iakNsYXNzSWQoX29iaklkKTsKICAgICAgICB1aW50MzIgdHJhbnNmb3JtQ2xhc3MgPSB0cmFuc2Zvcm1DbGFzc2VzW29iakluZm8uY2xhc3NJZF07CiAgICAgICAgaWYgKG9iakluZm8uY2xhc3NJZCA9PSAwIHx8IG9iakluZm8ub3duZXIgIT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKHRyYW5zZm9ybUxldmVsc1tvYmpJbmZvLmNsYXNzSWRdID09IDAgfHwgb2JqSW5mby5sZXZlbCA8IHRyYW5zZm9ybUxldmVsc1tvYmpJbmZvLmNsYXNzSWRdKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBpZiAodHJhbnNmb3JtQ2xhc3MgPT0gMCkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gZ2VuMCAtIGNhbiBub3QgdHJhbnNmb3JtIGlmIGl0IGhhcyBib251cyBlZ2cgCiAgICAgICAgaWYgKG9iakluZm8uY2xhc3NJZCA8PSBHRU4wX05PKSB7CiAgICAgICAgICAgIC8vIGxlZ2VuZHMKICAgICAgICAgICAgaWYgKGdldEJvbnVzRWdnKF9vYmpJZCkgPiAwKQogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFjaGVja0FuY2VzdG9ycyhvYmpJbmZvLmNsYXNzSWQsIG1zZy5zZW5kZXIsIF9hMSwgX2EyLCBfYTMpKQogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQ2NCBuZXdPYmpJZCA9IGFkZE5ld09iaihtc2cuc2VuZGVyLCB0cmFuc2Zvcm1DbGFzcyk7CiAgICAgICAgLy8gcmVtb3ZlIG9sZCBvbmUKICAgICAgICBkYXRhLnJlbW92ZU1vbnN0ZXJJZE1hcHBpbmcobXNnLnNlbmRlciwgX29iaklkKTsKICAgICAgICB0cmFuc2Zvcm1EYXRhLnNldFRyYW5mb3JtZWQoX29iaklkLCBuZXdPYmpJZCk7CiAgICAgICAgRXZlbnRUcmFuc2Zvcm0obXNnLnNlbmRlciwgX29iaklkLCBuZXdPYmpJZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJ1eUVnZygpIGlzQWN0aXZlIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBpZiAobXNnLnZhbHVlICE9IGJ1eUVnZ0ZlZSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJhbmRvbUNsYXNzSWRzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgLy8gbWFrZSBzdXJlIG5vIGhhdGNoaW5nIGVnZyBhdCB0aGUgc2FtZSB0aW1lCiAgICAgICAgaWYgKHRyYW5zZm9ybURhdGEuZ2V0SGF0Y2hpbmdFZ2dJZChtc2cuc2VuZGVyKSA+IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgcmFuZG9tIGVnZwogICAgICAgIHVpbnQ4IGNsYXNzSW5kZXggPSBnZXRSYW5kb20odWludDE2KHJhbmRvbUNsYXNzSWRzLmxlbmd0aCksIDEsIGxhc3RIYXRjaGluZ0FkZHJlc3MpOwogICAgICAgIHVpbnQ2NCBlZ2dJZCA9IHRyYW5zZm9ybURhdGEuYWRkRWdnKDAsIHJhbmRvbUNsYXNzSWRzW2NsYXNzSW5kZXhdLCBtc2cuc2VuZGVyLCBibG9jay50aW1lc3RhbXAgKyAoaGF0Y2hTdGFydFRpbWUgKyBnZXRSYW5kb20oaGF0Y2hNYXhUaW1lLCAwLCBsYXN0SGF0Y2hpbmdBZGRyZXNzKSkgKiAzNjAwKTsKICAgICAgICAvLyBkZWR1Y3QgZXhwCiAgICAgICAgRXZlbnRMYXlFZ2cobXNnLnNlbmRlciwgMCwgZWdnSWQpOwogICAgfQogICAgCiAgICAvLyByZWFkCiAgICBmdW5jdGlvbiBnZXRCb251c0VnZyh1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KSB7CiAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgIHVpbnQgdG90YWxCb251c0VnZyA9IGNhbGN1bGF0ZU1heEVnZ0cwKF9vYmpJZCk7CiAgICAgICAgaWYgKHRvdGFsQm9udXNFZ2cgPiAwKSB7CiAgICAgICAgICAgIHJldHVybiAodG90YWxCb251c0VnZyAtIHRyYW5zZm9ybURhdGEuY291bnRFZ2coX29iaklkKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCn0='.
	

]
