Class {
	#name : #SRT09bca6ebab05ee2ae945be4eda51393d94bf7b99,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT09bca6ebab05ee2ae945be4eda51393d94bf7b99 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLy8gQHRpdGxlIFNUQUJMRSBQcm9qZWN0IElDTwovLy8gQGF1dGhvciBLb25yYWQgU3phxYJhcGFrIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjhhZTFlNWU0ZjhlYmVlYTRmOWYwZWJlNmViZmFlYmUxY2FlZGU3ZWJlM2U2YTRlOWU1ZTciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKLyoKICogT3duYWJsZQogKgogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KfQogIAovKiBOZXcgRVJDMjMgY29udHJhY3QgaW50ZXJmYWNlICovCmNvbnRyYWN0IEVSQzIyMyB7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgCiAgICBmdW5jdGlvbiBuYW1lKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9uYW1lKTsKICAgIGZ1bmN0aW9uIHN5bWJvbCgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBfc3ltYm9sKTsKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgY29uc3RhbnQgcmV0dXJucyAodWludDggX2RlY2ltYWxzKTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfc3VwcGx5KTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpIHJldHVybnMgKGJvb2wgb2spOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSwgYnl0ZXMgaW5kZXhlZCBkYXRhKTsKfQoKLyoKKiBDb250cmFjdCB0aGF0IGlzIHdvcmtpbmcgd2l0aCBFUkMyMjMgdG9rZW5zCiovCmNvbnRyYWN0IENvbnRyYWN0UmVjZWl2ZXIgewogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpOwp9CgovKioKKiBFUkMyMyB0b2tlbiBieSBEZXhhcmFuCioKKiBodHRwczovL2dpdGh1Yi5jb20vRGV4YXJhbi9FUkMyMy10b2tlbnMKKi8KIAogCi8qIGh0dHBzOi8vZ2l0aHViLmNvbS9MeWtrZUNpdHkvRXRoZXJldW1BcGlEb3ROZXRDb3JlL2Jsb2IvbWFzdGVyL3NyYy9Db250cmFjdEJ1aWxkZXIvY29udHJhY3RzL3Rva2VuL1NhZmVNYXRoLnNvbCAqLwpjb250cmFjdCBTYWZlTWF0aCB7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBNQVhfVUlOVDI1NiA9CiAgICAweEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY7CgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgaWYgKHggPiBNQVhfVUlOVDI1NiAtIHkpIHRocm93OwogICAgICAgIHJldHVybiB4ICsgeTsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICBpZiAoeCA8IHkpIHRocm93OwogICAgICAgIHJldHVybiB4IC0geTsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICBpZiAoeSA9PSAwKSByZXR1cm4gMDsKICAgICAgICBpZiAoeCA+IE1BWF9VSU5UMjU2IC8geSkgdGhyb3c7CiAgICAgICAgcmV0dXJuIHggKiB5OwogICAgfQp9CgovKioKKiBTVEFCTEUgQXdhcmVuZXNzIFRva2VuIC0gU1RBCiovCmNvbnRyYWN0IEVSQzIyM1Rva2VuX1NUQSBpcyBFUkMyMjMsIFNhZmVNYXRoLCBPd25hYmxlIHsKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDggcHVibGljIGRlY2ltYWxzOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CiAgICAKICAgIC8vIHN0YWJsZSBwYXJhbXM6CiAgICB1aW50MjU2IHB1YmxpYyBpY29FbmRCbG9jazsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsYXN0IGJsb2NrIG51bWJlciBvZiBJQ08gCiAgICB1aW50MjU2IHB1YmxpYyBtYXhTdXBwbHk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXhpbXVtIHRva2VuIHN1cHBseQogICAgdWludDI1NiBwdWJsaWMgbWluZWRUb2tlbkNvdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY291bnRlciBvZiBtaW5lZCB0b2tlbnMKICAgIGFkZHJlc3MgcHVibGljIGljb0FkZHJlc3M7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZHJlc3Mgb2YgSUNPIGNvbnRyYWN0ICAgIAogICAgdWludDI1NiBwcml2YXRlIG11bHRpcGxpZXI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm9yIG1hbmFnaW5nIHRva2VuIGZyYWN0aW9uYWxzCiAgICBzdHJ1Y3QgTWluZXIgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJ1Y3QgZm9yIG1pbmVkIHRva2VucyBkYXRhCiAgICAgICAgdWludDI1NiBibG9jazsKICAgICAgICBhZGRyZXNzIG1pbmVyQWRkcmVzczsKICAgIH0KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gTWluZXIpIHB1YmxpYyBtaW5lZFRva2VuczsgICAgICAgICAgIC8vIG1pbmVkIHRva2VucyBkYXRhCiAgICBldmVudCBNZXNzYWdlQ2xhaW1NaW5pbmdSZXdhcmQoYWRkcmVzcyBpbmRleGVkIG1pbmVyLCB1aW50MjU2IGJsb2NrLCB1aW50MjU2IHN0YSk7ICAvLyBub3RpZmllcyBjbGllbnRzIGFib3V0IHN0YSB3aW5uaW5nIG1pbmVyCiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlKTsgICAgICAgICAvLyBub3RpZmllcyBjbGllbnRzIGFib3V0IHRoZSBhbW91bnQgYnVybnQKICAgIAogICAgZnVuY3Rpb24gRVJDMjIzVG9rZW5fU1RBKCkgewogICAgICAgIGRlY2ltYWxzID0gODsKICAgICAgICBtdWx0aXBsaWVyID0gMTAqKnVpbnQyNTYoZGVjaW1hbHMpOwogICAgICAgIG1heFN1cHBseSA9IDEwMDAwMDAwMDAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWF4aW11bSBwb3NzaWJsZSBzdXBwbHkgPT0gMTAwIFNUQQogICAgICAgIG5hbWUgPSAiU1RBQkxFIFNUQSBUb2tlbiI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gIlNUQSI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGljb0VuZEJsb2NrID0gNDMzMjAwMDsgIC8vIElOSVQgICAgICAgICAgICAgICAgICAgICAgLy8gbGFzdCBibG9jayBudW1iZXIgZm9yIElDTwogICAgICAgIHRvdGFsU3VwcGx5ID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRvdGFsIHN1cHBseQogICAgICAgIC8vIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gdG90YWxTdXBwbHk7ICAgICAgICAgICAgICAgLy8gR2l2ZSB0aGUgY3JlYXRvciBhbGwgaW5pdGlhbCB0b2tlbnMKICAgIH0KIAogICAgLy8gdHJpZ2dlciByZXdhcmRpbmcgYSBtaW5lciB3aXRoIFNUQSB0b2tlbjoKICAgIGZ1bmN0aW9uIGNsYWltTWluaW5nUmV3YXJkKCkgeyAgCiAgICAgICAgaWYgKGljb0FkZHJlc3MgPT0gYWRkcmVzcygwKSkgdGhyb3c7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElDTyBhZGRyZXNzIG11c3QgYmUgc2V0IHVwIGZpcnN0CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gaWNvQWRkcmVzcyAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsgIC8vIHRyaWdnZXJpbmcgZW5hYmxlZCBvbmx5IGZvciBJQ08gb3Igb3duZXIKICAgICAgICBpZiAoYmxvY2subnVtYmVyID4gaWNvRW5kQmxvY2spIHRocm93OyAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV3YXJkaW5nIGVuYWJsZWQgb25seSBiZWZvcmUgdGhlIGVuZCBvZiBJQ08KICAgICAgICBpZiAobWluZWRUb2tlbkNvdW50ICogbXVsdGlwbGllciA+PSBtYXhTdXBwbHkpIHRocm93OyAKICAgICAgICBpZiAobWluZWRUb2tlbkNvdW50ID4gMCkgewogICAgICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBtaW5lZFRva2VuQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKG1pbmVkVG9rZW5zW2ldLmJsb2NrID09IGJsb2NrLm51bWJlcikgdGhyb3c7IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRvdGFsU3VwcGx5ICs9IDEgKiBtdWx0aXBsaWVyOwogICAgICAgIGJhbGFuY2VzW2Jsb2NrLmNvaW5iYXNlXSArPSAxICogbXVsdGlwbGllcjsgICAgICAgICAgICAgICAgICAvLyByZXdhcmQgbWluZXIgd2l0aCBvbmUgU1RBIHRva2VuCiAgICAgICAgbWluZWRUb2tlbnNbbWluZWRUb2tlbkNvdW50XSA9IE1pbmVyKGJsb2NrLm51bWJlciwgYmxvY2suY29pbmJhc2UpOwogICAgICAgIG1pbmVkVG9rZW5Db3VudCArPSAxOwogICAgICAgIE1lc3NhZ2VDbGFpbU1pbmluZ1Jld2FyZChibG9jay5jb2luYmFzZSwgYmxvY2subnVtYmVyLCAxICogbXVsdGlwbGllcik7CiAgICB9IAogICAgCiAgICBmdW5jdGlvbiBzZWxmRGVzdHJveSgpIG9ubHlPd25lciB7CiAgICAgICAgLy8gYWxsb3cgdG8gc3VpY2lkZSBTVEEgdG9rZW4gYWZ0ZXIgYXJvdW5kIDIgd2Vla3MgKDI1cy9ibG9jaykgZnJvbSB0aGUgZW5kIG9mIElDTwogICAgICAgIGlmIChibG9jay5udW1iZXIgPD0gaWNvRW5kQmxvY2srMTQqMzQ1NikgdGhyb3c7CiAgICAgICAgc3VpY2lkZSh0aGlzKTsgCiAgICB9CiAgICAvLyAvc3RhYmxlIHBhcmFtcwogICAKICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyBuYW1lIG9mIHRva2VuIC4KICAgIGZ1bmN0aW9uIG5hbWUoKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgX25hbWUpIHsKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyBzeW1ib2wgb2YgdG9rZW4gLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9zeW1ib2wpIHsKICAgICAgICByZXR1cm4gc3ltYm9sOwogICAgfQogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIGRlY2ltYWxzIG9mIHRva2VuIC4KICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgY29uc3RhbnQgcmV0dXJucyAodWludDggX2RlY2ltYWxzKSB7CiAgICAgICAgcmV0dXJuIGRlY2ltYWxzOwogICAgfQogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIHRvdGFsIHN1cHBseSBvZiB0b2tlbnMgLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IF90b3RhbFN1cHBseSkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbmVkVG9rZW5Db3VudCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX21pbmVkVG9rZW5Db3VudCkgewogICAgICAgIHJldHVybiBtaW5lZFRva2VuQ291bnQ7CiAgICB9CiAgICBmdW5jdGlvbiBpY29BZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBfaWNvQWRkcmVzcykgewogICAgICAgIHJldHVybiBpY29BZGRyZXNzOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgCiAgICAvLyBTdGFuZGFyZCBmdW5jdGlvbiB0cmFuc2ZlciBzaW1pbGFyIHRvIEVSQzIwIHRyYW5zZmVyIHdpdGggbm8gX2RhdGEgLgogICAgLy8gQWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9hc3NlbWJsZSB0aGUgZ2l2ZW4gYWRkcmVzcyBieXRlY29kZS4gSWYgYnl0ZWNvZGUgZXhpc3RzIHRoZW4gdGhlIF9hZGRyIGlzIGEgY29udHJhY3QuCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBpc19jb250cmFjdCkgewogICAgICAgIHVpbnQgbGVuZ3RoOwogICAgICAgIF9hZGRyID0gX2FkZHI7ICAvLyB3b3JrYXJvdW5kIGZvciBNaXN0J3MgaW5hYmlsaXR5IHRvIGNvbXBpbGUKICAgICAgICBpc19jb250cmFjdCA9IGlzX2NvbnRyYWN0OyAgLy8gd29ya2Fyb3VuZCBmb3IgTWlzdCdzIGluYWJpbGl0eSB0byBjb21waWxlCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgLy9yZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICAgICAgbGVuZ3RoIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICBpZihsZW5ndGg+MCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy9mdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRyYW5zYWN0aW9uIHRhcmdldCBpcyBhbiBhZGRyZXNzCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvQWRkcmVzcyhhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwcml2YXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlT2YobXNnLnNlbmRlcikgPCBfdmFsdWUpIHRocm93OwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlT2YobXNnLnNlbmRlciksIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mKF90byksIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAKICAgIC8vZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0cmFuc2FjdGlvbiB0YXJnZXQgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gdHJhbnNmZXJUb0NvbnRyYWN0KGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA8IF92YWx1ZSkgdGhyb3c7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VPZihtc2cuc2VuZGVyKSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlT2YoX3RvKSwgX3ZhbHVlKTsKICAgICAgICBDb250cmFjdFJlY2VpdmVyIHJlY2VpdmVyID0gQ29udHJhY3RSZWNlaXZlcihfdG8pOwogICAgICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2sobXNnLnNlbmRlciwgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoJCiAgICBmdW5jdGlvbiBidXJuKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoaWNvQWRkcmVzcyA9PSBhZGRyZXNzKDApKSB0aHJvdzsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IGljb0FkZHJlc3MpIHRocm93OyAvLyBvbmx5IG93bmVyIGFuZCBpY28gY29udHJhY3QgYXJlIGFsbG93ZWQKICAgICAgICBpZiAoYmFsYW5jZXNbX2FkZHJlc3NdIDwgX3ZhbHVlKSB0aHJvdzsgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2ggdG9rZW5zCiAgICAgICAgYmFsYW5jZXNbX2FkZHJlc3NdIC09IF92YWx1ZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3VidHJhY3QgZnJvbSB0aGUgc2VuZGVyCiAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBCdXJuKF9hZGRyZXNzLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoJCiAgICAvKiBzZXR0aW5nIElDTyBhZGRyZXNzIGZvciBhbGxvd2luZyBleGVjdXRpb24gZnJvbSB0aGUgSUNPIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBzZXRJY29BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGljb0FkZHJlc3MgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBpY29BZGRyZXNzID0gX2FkZHJlc3M7CiAgICAgICAgfSAgICAKICAgICAgICBlbHNlIHRocm93OwogICAgfQp9CgovKioKKiBTdGFibGUgVG9rZW4gLSBTVEIKKi8KY29udHJhY3QgRVJDMjIzVG9rZW5fU1RCIGlzIEVSQzIyMywgU2FmZU1hdGgsIE93bmFibGUgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICAgIAogICAgLy8gc3RhYmxlIHBhcmFtczoKICAgIHVpbnQyNTYgcHVibGljIG1heFN1cHBseTsKICAgIHVpbnQyNTYgcHVibGljIGljb0VuZEJsb2NrOwogICAgYWRkcmVzcyBwdWJsaWMgaWNvQWRkcmVzczsKCQogICAgZnVuY3Rpb24gRVJDMjIzVG9rZW5fU1RCKCkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRvdGFsIHN1cHBseQogICAgICAgIG1heFN1cHBseSA9IDEwMDAwMDAwMDAwMDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWF4aW11bSBwb3NzaWJsZSBzdXBwbHkgb2YgU1RCID09IDEwME0gU1RCCiAgICAgICAgbmFtZSA9ICJTVEFCTEUgU1RCIFRva2VuIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBkZWNpbWFscyA9IDQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFtb3VudCBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIHN5bWJvbCA9ICJTVEIiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBpY29FbmRCbG9jayA9IDQzMzIwMDA7ICAvLyBJTklUICAgICAgICAgICAgICAgICAgICAgIC8vIGxhc3QgYmxvY2sgbnVtYmVyIG9mIElDTyAgICAgICAgICAKICAgICAgICAvL2JhbGFuY2VzW21zZy5zZW5kZXJdID0gdG90YWxTdXBwbHk7ICAgICAgICAgICAgICAgIC8vIEdpdmUgdGhlIGNyZWF0b3IgYWxsIGluaXRpYWwgdG9rZW5zICAgICAgIAogICAgfQogICAgCiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3MgbWF4IHN1cHBseSBvZiB0b2tlbnMgLgogICAgZnVuY3Rpb24gbWF4U3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfbWF4U3VwcGx5KSB7CiAgICAgICAgcmV0dXJuIG1heFN1cHBseTsKICAgIH0KICAgIC8vIC9zdGFibGUgcGFyYW1zCiAgCiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3MgbmFtZSBvZiB0b2tlbiAuCiAgICBmdW5jdGlvbiBuYW1lKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9uYW1lKSB7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3Mgc3ltYm9sIG9mIHRva2VuIC4KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBfc3ltYm9sKSB7CiAgICAgICAgcmV0dXJuIHN5bWJvbDsKICAgIH0KICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyBkZWNpbWFscyBvZiB0b2tlbiAuCiAgICBmdW5jdGlvbiBkZWNpbWFscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IF9kZWNpbWFscykgewogICAgICAgIHJldHVybiBkZWNpbWFsczsKICAgIH0KICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zIC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfdG90YWxTdXBwbHkpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHk7CiAgICB9CiAgICBmdW5jdGlvbiBpY29BZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBfaWNvQWRkcmVzcykgewogICAgICAgIHJldHVybiBpY29BZGRyZXNzOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgCiAgICAvLyBTdGFuZGFyZCBmdW5jdGlvbiB0cmFuc2ZlciBzaW1pbGFyIHRvIEVSQzIwIHRyYW5zZmVyIHdpdGggbm8gX2RhdGEgLgogICAgLy8gQWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9hc3NlbWJsZSB0aGUgZ2l2ZW4gYWRkcmVzcyBieXRlY29kZS4gSWYgYnl0ZWNvZGUgZXhpc3RzIHRoZW4gdGhlIF9hZGRyIGlzIGEgY29udHJhY3QuCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBpc19jb250cmFjdCkgewogICAgICAgIHVpbnQgbGVuZ3RoOwogICAgICAgIF9hZGRyID0gX2FkZHI7ICAvLyB3b3JrYXJvdW5kIGZvciBNaXN0J3MgaW5hYmlsaXR5IHRvIGNvbXBpbGUKICAgICAgICBpc19jb250cmFjdCA9IGlzX2NvbnRyYWN0OyAgLy8gd29ya2Fyb3VuZCBmb3IgTWlzdCdzIGluYWJpbGl0eSB0byBjb21waWxlCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvL3JldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5CiAgICAgICAgICAgIGxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgaWYobGVuZ3RoPjApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0cmFuc2FjdGlvbiB0YXJnZXQgaXMgYW4gYWRkcmVzcwogICAgZnVuY3Rpb24gdHJhbnNmZXJUb0FkZHJlc3MoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKSB0aHJvdzsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mKG1zZy5zZW5kZXIpLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZihfdG8pLCBfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgCiAgICAvL2Z1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdHJhbnNhY3Rpb24gdGFyZ2V0IGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9Db250cmFjdChhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwcml2YXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlT2YobXNnLnNlbmRlcikgPCBfdmFsdWUpIHRocm93OwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlT2YobXNnLnNlbmRlciksIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mKF90byksIF92YWx1ZSk7CiAgICAgICAgQ29udHJhY3RSZWNlaXZlciByZWNlaXZlciA9IENvbnRyYWN0UmVjZWl2ZXIoX3RvKTsKICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvKiBzZXR0aW5nIElDTyBhZGRyZXNzIGZvciBhbGxvd2luZyBleGVjdXRpb24gZnJvbSB0aGUgSUNPIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBzZXRJY29BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGljb0FkZHJlc3MgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBpY29BZGRyZXNzID0gX2FkZHJlc3M7CiAgICAgICAgfSAgICAKICAgICAgICBlbHNlIHRocm93OwogICAgfQoKICAgIC8qIG1pbnQgbmV3IHRva2VucyAqLwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgaWYgKGljb0FkZHJlc3MgPT0gYWRkcmVzcygwKSkgdGhyb3c7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gaWNvQWRkcmVzcyAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsgICAgIC8vIG1pbnQgYWxsb3dlZCBvbmx5IGZvciBJQ08gY29udHJhY3Qgb3Igb3duZXIKICAgICAgICBpZiAoc2FmZUFkZCh0b3RhbFN1cHBseSwgX2Ftb3VudCkgPiBtYXhTdXBwbHkpIHRocm93OwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgX2Ftb3VudCk7IAogICAgICAgIGJhbGFuY2VzW19yZWNlaXZlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW19yZWNlaXZlcl0sIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9yZWNlaXZlciwgX2Ftb3VudCwgbmV3IGJ5dGVzKDApKTsgCiAgICB9CiAgICAKfQoKLyogbWFpbiBjb250cmFjdCAtIElDTyAqLwpjb250cmFjdCBTdGFibGVJQ08gaXMgT3duYWJsZSwgU2FmZU1hdGggewogICAgdWludDI1NiBwdWJsaWMgY3Jvd2RmdW5kaW5nVGFyZ2V0OyAgICAgICAgIC8vIElDTyB0YXJnZXQsIGluIHdlaQogICAgRVJDMjIzVG9rZW5fU1RBIHB1YmxpYyBzdGE7ICAgICAgICAgICAgICAgIC8vIGFkZHJlc3Mgb2YgU1RBIHRva2VuCiAgICBFUkMyMjNUb2tlbl9TVEIgcHVibGljIHN0YjsgICAgICAgICAgICAgICAgLy8gYWRkcmVzcyBvZiBTVEIgdG9rZW4KICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OyAgICAgICAgICAgICAgICAvLyB3aGVyZSB0aGUgZG9uYXRpb24gaXMgdHJhbnNmZXJyZWQgYWZ0ZXIgc3VjY2Vzc2Z1bCBJQ08KICAgIHVpbnQyNTYgcHVibGljIGljb1N0YXJ0QmxvY2s7ICAgICAgICAgICAgICAvLyBudW1iZXIgb2Ygc3RhcnQgYmxvY2sgb2YgSUNPCiAgICB1aW50MjU2IHB1YmxpYyBpY29FbmRCbG9jazsgICAgICAgICAgICAgICAgLy8gbnVtYmVyIG9mIGVuZCBibG9jayBvZiBJQ08KICAgIGJvb2wgcHVibGljIGlzSWNvRmluaXNoZWQ7ICAgICAgICAgICAgICAgICAvLyBib29sZWFuIGZvciBJQ08gc3RhdHVzIC0gaXMgSUNPIGZpbmlzaGVkPwogICAgYm9vbCBwdWJsaWMgaXNJY29TdWNjZWVkZWQ7ICAgICAgICAgICAgICAgIC8vIGJvb2xlYW4gZm9yIElDTyBzdGF0dXMgLSBpcyBjcm93ZGZ1bmRpbmcgdGFyZ2V0IHJlYWNoZWQ/CiAgICBib29sIHB1YmxpYyBpc0RvbmF0ZWRFdGhUcmFuc2ZlcnJlZDsgICAgICAgLy8gYm9vbGVhbiBmb3IgSUNPIHN0YXR1cyAtIGlzIGRvbmF0aW9uIHRyYW5zZmVycmVkIHRvIHRoZSBzZWN1cmUgYWNjb3VudD8KICAgIGJvb2wgcHVibGljIGlzU3RiTWludGVkRm9yU3RhRXg7ICAgICAgICAgICAvLyBib29sZWFuIGZvciBJQ08gc3RhdHVzIC0gaXMgZXh0cmEgU1RCIHRva2VucyBtaW50ZWQgZm9yIGNvdmVyaW5nIGV4Y2hhbmdlIG9mIFNUQSB0b2tlbj8KICAgIHVpbnQyNTYgcHVibGljIHJlY2VpdmVkU3RhQW1vdW50OyAgICAgICAgICAvLyBhbW91bnQgb2YgcmVjZWl2ZWQgU1RBIHRva2VucyBmcm9tIHJld2FyZGVkIG1pbmVycwogICAgdWludDI1NiBwdWJsaWMgdG90YWxGdW5kZWQ7ICAgICAgICAgICAgICAgIC8vIGFtb3VudCBvZiBFVEggZG9uYXRpb25zCiAgICB1aW50MjU2IHB1YmxpYyBvd25lcnNFdGg7ICAgICAgICAgICAgICAgICAgLy8gYW1vdW50IG9mIEVUSCB0cmFuc2ZlcnJlZCB0byBJQ08gY29udHJhY3QgYnkgdGhlIG93bmVyCiAgICB1aW50MjU2IHB1YmxpYyBvbmVTdGFJc1N0YjsgICAgICAgICAgICAgICAgLy8gb25lIFNUQSB2YWx1ZSBpbiBTVEIKICAgIAogICAgc3RydWN0IERvbm9yIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJ1Y3QgZm9yIEVUSCBkb25hdGlvbnMKICAgICAgICBhZGRyZXNzIGRvbm9yQWRkcmVzczsKICAgICAgICB1aW50MjU2IGV0aEFtb3VudDsKICAgICAgICB1aW50MjU2IGJsb2NrOwogICAgICAgIGJvb2wgZXhjaGFuZ2VkT3JSZWZ1bmRlZDsKICAgICAgICB1aW50MjU2IHN0YkFtb3VudDsKICAgIH0KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gRG9ub3IpIHB1YmxpYyBkb25hdGlvbnM7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmFnZSBmb3IgRVRIIGRvbmF0aW9ucwogICAgdWludDI1NiBwdWJsaWMgZG9uYXRpb25OdW07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb3VudGVyIG9mIEVUSCBkb25hdGlvbnMKCQogICAgc3RydWN0IE1pbmVyIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJ1Y3QgZm9yIHJlY2VpdmVkIFNUQSB0b2tlbnMKICAgICAgICBhZGRyZXNzIG1pbmVyQWRkcmVzczsKICAgICAgICB1aW50MjU2IHN0YUFtb3VudDsKICAgICAgICB1aW50MjU2IGJsb2NrOwogICAgICAgIGJvb2wgZXhjaGFuZ2VkOwogICAgICAgIHVpbnQyNTYgc3RiQW1vdW50OwogICAgfQogICAgbWFwcGluZyAodWludDI1NiA9PiBNaW5lcikgcHVibGljIHJlY2VpdmVkU3RhOyAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yYWdlIGZvciByZWNlaXZlZCBTVEEgdG9rZW5zCiAgICB1aW50MjU2IHB1YmxpYyBtaW5lck51bTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvdW50ZXIgb2YgU1RBIHJlY2VpdmVzCgogICAgLyogVGhpcyBnZW5lcmF0ZXMgYSBwdWJsaWMgZXZlbnQgb24gdGhlIGJsb2NrY2hhaW4gdGhhdCB3aWxsIG5vdGlmeSBjbGllbnRzICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsgCiAgICAKICAgIGV2ZW50IE1lc3NhZ2VFeGNoYW5nZUV0aFN0YihhZGRyZXNzIGZyb20sIHVpbnQyNTYgZXRoLCB1aW50MjU2IHN0Yik7CiAgICBldmVudCBNZXNzYWdlRXhjaGFuZ2VTdGFTdGIoYWRkcmVzcyBmcm9tLCB1aW50MjU2IHN0YSwgdWludDI1NiBzdGIpOwogICAgZXZlbnQgTWVzc2FnZVJlY2VpdmVFdGgoYWRkcmVzcyBmcm9tLCB1aW50MjU2IGV0aCwgdWludDI1NiBibG9jayk7CiAgICBldmVudCBNZXNzYWdlUmVjZWl2ZVN0YShhZGRyZXNzIGZyb20sIHVpbnQyNTYgc3RhLCB1aW50MjU2IGJsb2NrKTsKICAgIGV2ZW50IE1lc3NhZ2VSZWNlaXZlU3RiKGFkZHJlc3MgZnJvbSwgdWludDI1NiBzdGIsIHVpbnQyNTYgYmxvY2ssIGJ5dGVzIGRhdGEpOyAgLy8gaXQgc2hvdWxkIG5ldmVyIGhhcHBlbgogICAgZXZlbnQgTWVzc2FnZVJlZnVuZEV0aChhZGRyZXNzIGRvbm9yX2FkZHJlc3MsIHVpbnQyNTYgZXRoKTsKICAKICAgIC8qIGNvbnN0cnVjdG9yICovCiAgICBmdW5jdGlvbiBTdGFibGVJQ08oKSB7CiAgICAgICAgY3Jvd2RmdW5kaW5nVGFyZ2V0ID0gNzUwMDAwMDAwMDAwMDAwMDAwMDAwOyAvLyBJTklUCiAgICAgICAgc3RhID0gRVJDMjIzVG9rZW5fU1RBKDB4MTY0NDg5QUI2NzZDNTc4YkVEMDUxNWREQ0Y5MkVmMzdhYWNGOWEyOSk7ICAvLyBJTklUCiAgICAgICAgc3RiID0gRVJDMjIzVG9rZW5fU1RCKDB4MDliY2E2ZWJhYjA1ZWUyYWU5NDViZTRlZGE1MTM5M2Q5NGJmN2I5OSk7ICAvLyBJTklUCiAgICAgICAgYmVuZWZpY2lhcnkgPSAweGIyZTc1NzlmODRhOGRkYWZkYjM3NmY5ODcyOTE2YjdmY2I4ZGJlYzA7ICAvLyBJTklUCiAgICAgICAgaWNvU3RhcnRCbG9jayA9IDQyMzIwMDA7ICAvLyBJTklUCiAgICAgICAgaWNvRW5kQmxvY2sgPSA0MzMyMDAwOyAgLy8gSU5JVAogICAgfQkJCiAgICAKICAgIC8qIHRyaWdnZXIgcmV3YXJkaW5nIHRoZSBtaW5lciB3aXRoIFNUQSB0b2tlbiAqLwogICAgZnVuY3Rpb24gY2xhaW1NaW5pbmdSZXdhcmQoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzdGEuY2xhaW1NaW5pbmdSZXdhcmQoKTsKICAgIH0KCQogICAgLyogUmVjZWl2aW5nIFNUQSBmcm9tIG1pbmVycyAtIGR1cmluZyBhbmQgYWZ0ZXIgSUNPICovCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPCBpY29TdGFydEJsb2NrKSB0aHJvdzsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBhZGRyZXNzKHN0YSkpIHsKICAgICAgICAgICAgaWYgKF92YWx1ZSA8IDUwMDAwMDAwKSB0aHJvdzsgLy8gbWluaW11bSAwLjUgU1RBCiAgICAgICAgICAgIGlmIChibG9jay5udW1iZXIgPCBpY29FbmRCbG9jaysxNCozNDU2KSB7ICAvLyBhbGxvdyBTVEEgdG9rZW5zIGV4Y2hhbmdlIGZvciBhcm91bmQgMTQgZGF5cyAoMjVzL2Jsb2NrKSBhZnRlciBJQ08KICAgICAgICAgICAgICAgIHJlY2VpdmVkU3RhW21pbmVyTnVtXSA9IE1pbmVyKF9mcm9tLCBfdmFsdWUsIGJsb2NrLm51bWJlciwgZmFsc2UsIDApOwogICAgICAgICAgICAgICAgbWluZXJOdW0gKz0gMTsKICAgICAgICAgICAgICAgIHJlY2VpdmVkU3RhQW1vdW50ID0gc2FmZUFkZChyZWNlaXZlZFN0YUFtb3VudCwgX3ZhbHVlKTsKICAgICAgICAgICAgICAgIE1lc3NhZ2VSZWNlaXZlU3RhKF9mcm9tLCBfdmFsdWUsIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIH0gZWxzZSB0aHJvdzsJCiAgICAgICAgfSBlbHNlIGlmKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzdGIpKSB7CiAgICAgICAgICAgIE1lc3NhZ2VSZWNlaXZlU3RiKF9mcm9tLCBfdmFsdWUsIGJsb2NrLm51bWJlciwgX2RhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93OyAvLyBvdGhlciB0b2tlbnMKICAgICAgICB9CiAgICB9CgogICAgLyogUmVjZWl2aW5nIEVUSCAqLwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CgogICAgICAgIGlmIChtc2cudmFsdWUgPCAxMDAwMDAwMDAwMDAwMDAwMDApIHRocm93OyAgLy8gbWluaW11bSAwLjEgRVRICgkJCiAgICAgICAgLy8gYmVmb3JlIElDTyAocHJlLWljbykKICAgICAgICBpZiAoYmxvY2subnVtYmVyIDwgaWNvU3RhcnRCbG9jaykgewogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgewogICAgICAgICAgICAgICAgb3duZXJzRXRoID0gc2FmZUFkZChvd25lcnNFdGgsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b3RhbEZ1bmRlZCA9IHNhZmVBZGQodG90YWxGdW5kZWQsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICBkb25hdGlvbnNbZG9uYXRpb25OdW1dID0gRG9ub3IobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBibG9jay5udW1iZXIsIGZhbHNlLCAwKTsKICAgICAgICAgICAgICAgIGRvbmF0aW9uTnVtICs9IDE7CiAgICAgICAgICAgICAgICBNZXNzYWdlUmVjZWl2ZUV0aChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfSAKICAgICAgICAvLyBkdXJpbmcgSUNPCiAgICAgICAgZWxzZSBpZiAoYmxvY2subnVtYmVyID49IGljb1N0YXJ0QmxvY2sgJiYgYmxvY2subnVtYmVyIDw9IGljb0VuZEJsb2NrKSB7CiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgICAgICB0b3RhbEZ1bmRlZCA9IHNhZmVBZGQodG90YWxGdW5kZWQsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICBkb25hdGlvbnNbZG9uYXRpb25OdW1dID0gRG9ub3IobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBibG9jay5udW1iZXIsIGZhbHNlLCAwKTsKICAgICAgICAgICAgICAgIGRvbmF0aW9uTnVtICs9IDE7CiAgICAgICAgICAgICAgICBNZXNzYWdlUmVjZWl2ZUV0aChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIH0gZWxzZSBvd25lcnNFdGggPSBzYWZlQWRkKG93bmVyc0V0aCwgbXNnLnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgLy8gYWZ0ZXIgSUNPIC0gZmlyc3QgRVRIIHRyYW5zZmVyIGlzIHJldHVybmVkIHRvIHRoZSBzZW5kZXIKICAgICAgICBlbHNlIGlmIChibG9jay5udW1iZXIgPiBpY29FbmRCbG9jaykgewogICAgICAgICAgICBpZiAoIWlzSWNvRmluaXNoZWQpIHsKICAgICAgICAgICAgICAgIGlzSWNvRmluaXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOyAgLy8gcmV0dXJuIEVUSCB0byB0aGUgc2VuZGVyCiAgICAgICAgICAgICAgICBpZiAodG90YWxGdW5kZWQgPj0gY3Jvd2RmdW5kaW5nVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgaXNJY29TdWNjZWVkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlU3RhU3RiKDAsIG1pbmVyTnVtKTsKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUV0aFN0YigwLCBkb25hdGlvbk51bSk7CiAgICAgICAgICAgICAgICAgICAgZHJhd2Rvd24oKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVmdW5kKDAsIGRvbmF0aW9uTnVtKTsKICAgICAgICAgICAgICAgIH0JCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7ICAvLyBXQVJOSU5HOiBzZW5kZXJzIEVUSCBtYXkgYmUgbG9zdCAoaWYgdHJhbnNmZXJyZWQgYWZ0ZXIgZmluaXNoZWQgSUNPKQogICAgICAgICAgICAgICAgb3duZXJzRXRoID0gc2FmZUFkZChvd25lcnNFdGgsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3c7ICAvLyBXQVJOSU5HOiBzZW5kZXJzIEVUSCBtYXkgYmUgbG9zdCAoaWYgdHJhbnNmZXJyZWQgYWZ0ZXIgZmluaXNoZWQgSUNPKQogICAgICAgIH0KICAgIH0KCiAgICAvKiBzZW5kIFNUQiB0byB0aGUgbWluZXJzIHdobyByZXR1cm5lZCBTVEEgdG9rZW5zIC0gYWZ0ZXIgc3VjY2Vzc2Z1bCBJQ08gKi8KICAgIGZ1bmN0aW9uIGV4Y2hhbmdlU3RhU3RiKHVpbnQyNTYgX2Zyb20sIHVpbnQyNTYgX3RvKSBwcml2YXRlIHsgIAogICAgICAgIGlmICghaXNJY29TdWNjZWVkZWQpIHRocm93OwogICAgICAgIGlmIChfZnJvbSA+PSBfdG8pIHJldHVybjsgIC8vIHNraXAgdGhlIGZ1bmN0aW9uIGlmIHRoZXJlIGlzIGludmFsaWQgcmFuZ2UgZ2l2ZW4gZm9yIGxvb3AKICAgICAgICB1aW50MjU2IF9zdGEyc3RiID0gMTAqKjQ7IAogICAgICAgIHVpbnQyNTYgX3dlaTJzdGIgPSAxMCoqMTQ7IAoKICAgICAgICBpZiAoIWlzU3RiTWludGVkRm9yU3RhRXgpIHsKICAgICAgICAgICAgdWludDI1NiBfbWludEFtb3VudCA9ICgxMCp0b3RhbEZ1bmRlZCkqNS8xMDAwIC8gX3dlaTJzdGI7ICAvLyAwLjUlIGV4dHJhIFNUQiBtaW50aW5nIGZvciBTVEEgY292ZXJpbmcKICAgICAgICAgICAgb25lU3RhSXNTdGIgPSBfbWludEFtb3VudCAvIDEwMDsKICAgICAgICAgICAgc3RiLm1pbnQoYWRkcmVzcyh0aGlzKSwgX21pbnRBbW91bnQpOwogICAgICAgICAgICBpc1N0Yk1pbnRlZEZvclN0YUV4ID0gdHJ1ZTsKICAgICAgICB9CQoJCQkKICAgICAgICAvKiBleGNoYW5nZSAqLwogICAgICAgIHVpbnQyNTYgX3RvQnVybiA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSBfZnJvbTsgaSA8IF90bzsgaSsrKSB7CiAgICAgICAgICAgIGlmIChyZWNlaXZlZFN0YVtpXS5leGNoYW5nZWQpIGNvbnRpbnVlOyAgLy8gc2tpcCBhbHJlYWR5IGV4Y2hhbmdlZCBTVEEKICAgICAgICAgICAgc3RiLnRyYW5zZmVyKHJlY2VpdmVkU3RhW2ldLm1pbmVyQWRkcmVzcywgcmVjZWl2ZWRTdGFbaV0uc3RhQW1vdW50L19zdGEyc3RiICogb25lU3RhSXNTdGIgLyAxMCoqNCk7CiAgICAgICAgICAgIHJlY2VpdmVkU3RhW2ldLmV4Y2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHJlY2VpdmVkU3RhW2ldLnN0YkFtb3VudCA9IHJlY2VpdmVkU3RhW2ldLnN0YUFtb3VudC9fc3RhMnN0YiAqIG9uZVN0YUlzU3RiIC8gMTAqKjQ7CiAgICAgICAgICAgIF90b0J1cm4gKz0gcmVjZWl2ZWRTdGFbaV0uc3RhQW1vdW50OwogICAgICAgICAgICBNZXNzYWdlRXhjaGFuZ2VTdGFTdGIocmVjZWl2ZWRTdGFbaV0ubWluZXJBZGRyZXNzLCByZWNlaXZlZFN0YVtpXS5zdGFBbW91bnQsIAogICAgICAgICAgICAgIHJlY2VpdmVkU3RhW2ldLnN0YUFtb3VudC9fc3RhMnN0YiAqIG9uZVN0YUlzU3RiIC8gMTAqKjQpOwogICAgICAgIH0KICAgICAgICBzdGEuYnVybihhZGRyZXNzKHRoaXMpLCBfdG9CdXJuKTsgIC8vIGJ1cm4gcmVjZWl2ZWQgYW5kIHByb2Nlc3NlZCBTVEEgdG9rZW5zCiAgICB9CgkKICAgIC8qIHNlbmQgU1RCIHRvIHRoZSBkb25vcnMgLSBhZnRlciBzdWNjZXNzZnVsIElDTyAqLwogICAgZnVuY3Rpb24gZXhjaGFuZ2VFdGhTdGIodWludDI1NiBfZnJvbSwgdWludDI1NiBfdG8pIHByaXZhdGUgeyAKICAgICAgICBpZiAoIWlzSWNvU3VjY2VlZGVkKSB0aHJvdzsKICAgICAgICBpZiAoX2Zyb20gPj0gX3RvKSByZXR1cm47ICAvLyBza2lwIHRoZSBmdW5jdGlvbiBpZiB0aGVyZSBpcyBpbnZhbGlkIHJhbmdlIGdpdmVuIGZvciBsb29wCiAgICAgICAgdWludDI1NiBfd2VpMnN0YiA9IDEwKioxNDsgLy8gY2FsY3VsYXRlIGV0aCB0byBzdGIgZXhjaGFuZ2UKICAgICAgICB1aW50IF9wYiA9IChpY29FbmRCbG9jayAtIGljb1N0YXJ0QmxvY2spLzQ7IAogICAgICAgIHVpbnQgX2JvbnVzOwoKICAgICAgICAvKiBtaW50ICovCiAgICAgICAgdWludDI1NiBfbWludEFtb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSBfZnJvbTsgaSA8IF90bzsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkb25hdGlvbnNbaV0uZXhjaGFuZ2VkT3JSZWZ1bmRlZCkgY29udGludWU7ICAvLyBza2lwIGFscmVhZHkgbWludGVkIFNUQgogICAgICAgICAgICBpZiAoZG9uYXRpb25zW2ldLmJsb2NrIDwgaWNvU3RhcnRCbG9jayArIF9wYikgX2JvbnVzID0gNjsgIC8vIGZpcnN0IHBlcmlvZDsgYm9udXMgaW4gJQogICAgICAgICAgICBlbHNlIGlmIChkb25hdGlvbnNbaV0uYmxvY2sgPj0gaWNvU3RhcnRCbG9jayArIF9wYiAmJiBkb25hdGlvbnNbaV0uYmxvY2sgPCBpY29TdGFydEJsb2NrICsgMipfcGIpIF9ib251cyA9IDQ7ICAvLyAybmQKICAgICAgICAgICAgZWxzZSBpZiAoZG9uYXRpb25zW2ldLmJsb2NrID49IGljb1N0YXJ0QmxvY2sgKyAyKl9wYiAmJiBkb25hdGlvbnNbaV0uYmxvY2sgPCBpY29TdGFydEJsb2NrICsgMypfcGIpIF9ib251cyA9IDI7ICAvLyAzcmQKICAgICAgICAgICAgZWxzZSBfYm9udXMgPSAwOyAgLy8gNHRoCiAgICAgICAgICAgIF9taW50QW1vdW50ICs9IDEwICogKCAoMTAwICsgX2JvbnVzKSAqIChkb25hdGlvbnNbaV0uZXRoQW1vdW50IC8gX3dlaTJzdGIpIC8gMTAwKTsKICAgICAgICB9CiAgICAgICAgc3RiLm1pbnQoYWRkcmVzcyh0aGlzKSwgX21pbnRBbW91bnQpOwoKICAgICAgICAvKiBleGNoYW5nZSAqLwogICAgICAgIGZvciAoaSA9IF9mcm9tOyBpIDwgX3RvOyBpKyspIHsKICAgICAgICAgICAgaWYgKGRvbmF0aW9uc1tpXS5leGNoYW5nZWRPclJlZnVuZGVkKSBjb250aW51ZTsgIC8vIHNraXAgYWxyZWFkeSBleGNoYW5nZWQgRVRICiAgICAgICAgICAgIGlmIChkb25hdGlvbnNbaV0uYmxvY2sgPCBpY29TdGFydEJsb2NrICsgX3BiKSBfYm9udXMgPSA2OyAgLy8gZmlyc3QgcGVyaW9kOyBib251cyBpbiAlCiAgICAgICAgICAgIGVsc2UgaWYgKGRvbmF0aW9uc1tpXS5ibG9jayA+PSBpY29TdGFydEJsb2NrICsgX3BiICYmIGRvbmF0aW9uc1tpXS5ibG9jayA8IGljb1N0YXJ0QmxvY2sgKyAyKl9wYikgX2JvbnVzID0gNDsgIC8vIDJuZAogICAgICAgICAgICBlbHNlIGlmIChkb25hdGlvbnNbaV0uYmxvY2sgPj0gaWNvU3RhcnRCbG9jayArIDIqX3BiICYmIGRvbmF0aW9uc1tpXS5ibG9jayA8IGljb1N0YXJ0QmxvY2sgKyAzKl9wYikgX2JvbnVzID0gMjsgIC8vIDNyZAogICAgICAgICAgICBlbHNlIF9ib251cyA9IDA7ICAvLyA0dGgKICAgICAgICAgICAgc3RiLnRyYW5zZmVyKGRvbmF0aW9uc1tpXS5kb25vckFkZHJlc3MsIDEwICogKCAoMTAwICsgX2JvbnVzKSAqIChkb25hdGlvbnNbaV0uZXRoQW1vdW50IC8gX3dlaTJzdGIpIC8gMTAwKSApOwogICAgICAgICAgICBkb25hdGlvbnNbaV0uZXhjaGFuZ2VkT3JSZWZ1bmRlZCA9IHRydWU7CiAgICAgICAgICAgIGRvbmF0aW9uc1tpXS5zdGJBbW91bnQgPSAxMCAqICggKDEwMCArIF9ib251cykgKiAoZG9uYXRpb25zW2ldLmV0aEFtb3VudCAvIF93ZWkyc3RiKSAvIDEwMCk7CiAgICAgICAgICAgIE1lc3NhZ2VFeGNoYW5nZUV0aFN0Yihkb25hdGlvbnNbaV0uZG9ub3JBZGRyZXNzLCBkb25hdGlvbnNbaV0uZXRoQW1vdW50LCAKICAgICAgICAgICAgICAxMCAqICggKDEwMCArIF9ib251cykgKiAoZG9uYXRpb25zW2ldLmV0aEFtb3VudCAvIF93ZWkyc3RiKSAvIDEwMCkpOwogICAgICAgIH0KICAgIH0KICAKICAgIC8vIHNlbmQgZnVuZHMgdG8gdGhlIElDTyBiZW5lZmljaWFyeSBhY2NvdW50IC0gYWZ0ZXIgc3VjY2Vzc2Z1bCBJQ08KICAgIGZ1bmN0aW9uIGRyYXdkb3duKCkgcHJpdmF0ZSB7CiAgICAgICAgaWYgKCFpc0ljb1N1Y2NlZWRlZCB8fCBpc0RvbmF0ZWRFdGhUcmFuc2ZlcnJlZCkgdGhyb3c7CiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIodG90YWxGdW5kZWQpOyAgCiAgICAgICAgaXNEb25hdGVkRXRoVHJhbnNmZXJyZWQgPSB0cnVlOwogICAgfQogIAogICAgLyogcmVmdW5kIEVUSCAtIGFmdGVyIHVuc3VjY2Vzc2Z1bCBJQ08gKi8KICAgIGZ1bmN0aW9uIHJlZnVuZCh1aW50MjU2IF9mcm9tLCB1aW50MjU2IF90bykgcHJpdmF0ZSB7CiAgICAgICAgaWYgKCFpc0ljb0ZpbmlzaGVkIHx8IGlzSWNvU3VjY2VlZGVkKSB0aHJvdzsKICAgICAgICBpZiAoX2Zyb20gPj0gX3RvKSByZXR1cm47CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSBfZnJvbTsgaSA8IF90bzsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkb25hdGlvbnNbaV0uZXhjaGFuZ2VkT3JSZWZ1bmRlZCkgY29udGludWU7CiAgICAgICAgICAgIGRvbmF0aW9uc1tpXS5kb25vckFkZHJlc3MudHJhbnNmZXIoZG9uYXRpb25zW2ldLmV0aEFtb3VudCk7CiAgICAgICAgICAgIGRvbmF0aW9uc1tpXS5leGNoYW5nZWRPclJlZnVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgTWVzc2FnZVJlZnVuZEV0aChkb25hdGlvbnNbaV0uZG9ub3JBZGRyZXNzLCBkb25hdGlvbnNbaV0uZXRoQW1vdW50KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIHNlbmQgb3duZXIncyBmdW5kcyB0byB0aGUgSUNPIG93bmVyIC0gYWZ0ZXIgSUNPCiAgICBmdW5jdGlvbiB0cmFuc2ZlckV0aFRvT3duZXIodWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgaWYgKCFpc0ljb0ZpbmlzaGVkIHx8IF9hbW91bnQgPD0gMCB8fCBfYW1vdW50ID4gb3duZXJzRXRoKSB0aHJvdzsKICAgICAgICBvd25lci50cmFuc2ZlcihfYW1vdW50KTsgCiAgICAgICAgb3duZXJzRXRoIC09IF9hbW91bnQ7CiAgICB9ICAgIAoKICAgIC8vIHNlbmQgU1RCIHRvIHRoZSBJQ08gb3duZXIgLSBhZnRlciBJQ08KICAgIGZ1bmN0aW9uIHRyYW5zZmVyU3RiVG9Pd25lcih1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgeyAKICAgICAgICBpZiAoIWlzSWNvRmluaXNoZWQgfHwgX2Ftb3VudCA8PSAwKSB0aHJvdzsKICAgICAgICBzdGIudHJhbnNmZXIob3duZXIsIF9hbW91bnQpOyAKICAgIH0gICAgCiAgICAKICAgIAogICAgLyogYmFja3VwIGZ1bmN0aW9ucyB0byBiZSBleGVjdXRlZCAibWFudWFsbHkiIC0gaW4gY2FzZSBvZiBhIGNyaXRpY2FsIGV0aGVyZXVtIHBsYXRmb3JtIGZhaWx1cmUgCiAgICAgIGR1cmluZyBhdXRvbWF0aWMgZnVuY3Rpb24gZXhlY3V0aW9uICovCiAgICBmdW5jdGlvbiBiYWNrdXBfZmluaXNoSWNvVmFycygpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPD0gaWNvRW5kQmxvY2sgfHwgaXNJY29GaW5pc2hlZCkgdGhyb3c7CiAgICAgICAgaXNJY29GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgaWYgKHRvdGFsRnVuZGVkID49IGNyb3dkZnVuZGluZ1RhcmdldCkgaXNJY29TdWNjZWVkZWQgPSB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYmFja3VwX2V4Y2hhbmdlU3RhU3RiKHVpbnQyNTYgX2Zyb20sIHVpbnQyNTYgX3RvKSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgZXhjaGFuZ2VTdGFTdGIoX2Zyb20sIF90byk7CiAgICB9CiAgICBmdW5jdGlvbiBiYWNrdXBfZXhjaGFuZ2VFdGhTdGIodWludDI1NiBfZnJvbSwgdWludDI1NiBfdG8pIHB1YmxpYyBvbmx5T3duZXIgeyAKICAgICAgICBleGNoYW5nZUV0aFN0YihfZnJvbSwgX3RvKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJhY2t1cF9kcmF3ZG93bigpIHB1YmxpYyBvbmx5T3duZXIgeyAKICAgICAgICBkcmF3ZG93bigpOwogICAgfQogICAgZnVuY3Rpb24gYmFja3VwX2RyYXdkb3duX2Ftb3VudCh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmICghaXNJY29TdWNjZWVkZWQpIHRocm93OwogICAgICAgIGJlbmVmaWNpYXJ5LnRyYW5zZmVyKF9hbW91bnQpOyAgCiAgICB9CiAgICBmdW5jdGlvbiBiYWNrdXBfcmVmdW5kKHVpbnQyNTYgX2Zyb20sIHVpbnQyNTYgX3RvKSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgcmVmdW5kKF9mcm9tLCBfdG8pOwogICAgfQogICAgLyogL2JhY2t1cCAqLwogCn0='.
	

]
