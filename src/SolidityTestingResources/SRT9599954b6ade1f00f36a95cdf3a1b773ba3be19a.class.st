Class {
	#name : #SRT9599954b6ade1f00f36a95cdf3a1b773ba3be19a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9599954b6ade1f00f36a95cdf3a1b773ba3be19a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8qIFRoZSBTSUZUIGl0c2VsZiBpcyBhIHNpbXBsZSBleHRlbnNpb24gb2YgdGhlIEVSQzIwIHRoYXQgYWxsb3dzIGZvciBncmFudGluZyBvdGhlciBTSUZUIGNvbnRyYWN0cyBzcGVjaWFsIHJpZ2h0cyB0byBhY3Qgb24gYmVoYWxmIG9mIGFsbCB0cmFuc2ZlcnMuICovCmNvbnRyYWN0IFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvKiBNYXAgYWxsIG91ciBvdXIgYmFsYW5jZXMgZm9yIGlzc3VlZCB0b2tlbnMgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgLyogTWFwIGJldHdlZW4gdXNlcnMgYW5kIHRoZWlyIGFwcHJvdmFsIGFkZHJlc3NlcyBhbmQgYW1vdW50cyAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLyogTGlzdCBvZiBhbGwgdG9rZW4gaG9sZGVycyAqLwogICAgYWRkcmVzc1tdIGFsbFRva2VuSG9sZGVyczsKCiAgICAvKiBUaGUgbmFtZSBvZiB0aGUgY29udHJhY3QgKi8KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgICAvKiBUaGUgc3ltYm9sIGZvciB0aGUgY29udHJhY3QgKi8KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICAgIC8qIEhvdyBtYW55IERQcyBhcmUgaW4gdXNlIGluIHRoaXMgY29udHJhY3QgKi8KICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgICAvKiBEZWZpbmVzIHRoZSBjdXJyZW50IHN1cHBseSBvZiB0aGUgdG9rZW4gaW4gaXRzIG93biB1bml0cyAqLwogICAgdWludDI1NiB0b3RhbFN1cHBseUFtb3VudCA9IDA7CgogICAgLyogRGVmaW5lcyB0aGUgYWRkcmVzcyBvZiB0aGUgSUNPIGNvbnRyYWN0IHdoaWNoIGlzIHRoZSBvbmx5IGNvbnRyYWN0IHBlcm1pdHRlZCB0byBtaW50IHRva2Vucy4gKi8KICAgIGFkZHJlc3MgcHVibGljIGljb0NvbnRyYWN0QWRkcmVzczsKCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBmdW5kIGlzIGNsb3NlZC4gKi8KICAgIGJvb2wgcHVibGljIGlzQ2xvc2VkOwoKICAgIC8qIERlZmluZXMgdGhlIGNvbnRyYWN0IGhhbmRsaW5nIHRoZSBJQ08gcGhhc2UuICovCiAgICBJY29QaGFzZU1hbmFnZW1lbnQgaWNvUGhhc2VNYW5hZ2VtZW50OwoKICAgIC8qIERlZmluZXMgdGhlIGFkbWluIGNvbnRyYWN0IHdlIGludGVyZmFjZSB3aXRoIGZvciBjcmVkZW50YWlscy4gKi8KICAgIEF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXI7CgogICAgLyogRmlyZWQgd2hlbiB0aGUgZnVuZCBpcyBldmVudHVhbGx5IGNsb3NlZC4gKi8KICAgIGV2ZW50IEZ1bmRDbG9zZWQoKTsKICAgIAogICAgLyogT3VyIHRyYW5zZmVyIGV2ZW50IHRvIGZpcmUgd2hlbmV2ZXIgd2Ugc2hpZnQgU01SVCBhcm91bmQgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgCiAgICAvKiBPdXIgYXBwcm92YWwgZXZlbnQgd2hlbiBvbmUgdXNlciBhcHByb3ZlcyBhbm90aGVyIHRvIGNvbnRyb2wgKi8KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKICAgIC8qIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiB0aGlzIGZ1bmQgd2l0aCBsaW5rcyB0byBvdGhlciBjb250cmFjdHMgdGhhdCBhcmUgcmVxdWlyZWQuICovCiAgICBmdW5jdGlvbiBTbWFydEludmVzdG1lbnRGdW5kVG9rZW4oYWRkcmVzcyBfaWNvQ29udHJhY3RBZGRyZXNzLCBhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7CiAgICAgICAgLy8gU2V0dXAgZGVmYXVsdHMKICAgICAgICBuYW1lID0gIlNtYXJ0IEludmVzdG1lbnQgRnVuZCBUb2tlbiI7CiAgICAgICAgc3ltYm9sID0gIlNJRlQiOwogICAgICAgIGRlY2ltYWxzID0gMDsKCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovCiAgICAgICAgaWNvUGhhc2VNYW5hZ2VtZW50ID0gSWNvUGhhc2VNYW5hZ2VtZW50KF9pY29Db250cmFjdEFkZHJlc3MpOwogICAgICAgIGlmIChpY29QaGFzZU1hbmFnZW1lbnQuY29udHJhY3RWZXJzaW9uKCkgIT0gMzAwMjAxNzA3MTcxNDQwKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICBhdXRoZW50aWNhdGlvbk1hbmFnZXIgPSBBdXRoZW50aWNhdGlvbk1hbmFnZXIoX2F1dGhlbnRpY2F0aW9uTWFuYWdlckFkZHJlc3MpOwogICAgICAgIGlmIChhdXRoZW50aWNhdGlvbk1hbmFnZXIuY29udHJhY3RWZXJzaW9uKCkgIT0gMTAwMjAxNzA3MTcxNTAzKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvKiBTdG9yZSBvdXIgc3BlY2lhbCBhZGRyZXNzZXMgKi8KICAgICAgICBpY29Db250cmFjdEFkZHJlc3MgPSBfaWNvQ29udHJhY3RBZGRyZXNzOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IG51bXdvcmRzKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5kYXRhLmxlbmd0aCA9PSBudW13b3JkcyAqIDMyICsgNCk7CiAgICAgICAgXzsKICAgIH0gCgogICAgLyogVGhpcyBtb2RpZmllciBhbGxvd3MgYSBtZXRob2QgdG8gb25seSBiZSBjYWxsZWQgYnkgYWNjb3VudCByZWFkZXJzICovCiAgICBtb2RpZmllciBhY2NvdW50UmVhZGVyT25seSB7CiAgICAgICAgaWYgKCFhdXRoZW50aWNhdGlvbk1hbmFnZXIuaXNDdXJyZW50QWNjb3VudFJlYWRlcihtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBmdW5kU2VuZGFibGVQaGFzZSB7CiAgICAgICAgLy8gSWYgaXQncyBpbiBJQ08gcGhhc2UsIGZvcmJpZCBpdAogICAgICAgIGlmIChpY29QaGFzZU1hbmFnZW1lbnQuaWNvUGhhc2UoKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIElmIGl0J3MgYWJhbmRvbmVkLCBmb3JiaWQgaXQKICAgICAgICBpZiAoaWNvUGhhc2VNYW5hZ2VtZW50Lmljb0FiYW5kb25lZCgpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gV2UncmUgZ29vZCwgZnVuZHMgY2FuIG5vdyBiZSB0cmFuc2ZlcnJlZAogICAgICAgIF87CiAgICB9CgogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLwogICAgZnVuY3Rpb24gY29udHJhY3RWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgLyogU0lGVCBjb250cmFjdCBpZGVudGlmaWVzIGFzIDUwMFlZWVlNTURESEhNTSAqLwogICAgICAgIHJldHVybiA1MDAyMDE3MDcxNzE0NDA7CiAgICB9CiAgICAKICAgIC8qIFRyYW5zZmVyIGZ1bmRzIGJldHdlZW4gdHdvIGFkZHJlc3NlcyB0aGF0IGFyZSBub3QgdGhlIGN1cnJlbnQgbXNnLnNlbmRlciAtIHRoaXMgcmVxdWlyZXMgYXBwcm92YWwgdG8gaGF2ZSBiZWVuIHNldCBzZXBhcmF0ZWx5IGFuZCBmb2xsb3dzIHN0YW5kYXJkIEVSQzIwIGd1aWRlbGluZXMgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBmdW5kU2VuZGFibGVQaGFzZSBvbmx5UGF5bG9hZFNpemUoMykgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX2Ftb3VudCAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfYW1vdW50ICYmIF9hbW91bnQgPiAwICYmIGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpID4gYmFsYW5jZXNbX3RvXSkgewogICAgICAgICAgICBib29sIGlzTmV3ID0gYmFsYW5jZXNbX3RvXSA9PSAwOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF9hbW91bnQpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfYW1vdW50KTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgICAgICBpZiAoaXNOZXcpCiAgICAgICAgICAgICAgICB0b2tlbk93bmVyQWRkKF90byk7CiAgICAgICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPT0gMCkKICAgICAgICAgICAgICAgIHRva2VuT3duZXJSZW1vdmUoX2Zyb20pOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKiBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgaG9sZGVycyBvZiB0aGlzIGN1cnJlbmN5LiAqLwogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXJDb3VudCgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aDsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSB0b2tlbiBob2xkZXIgYXQgdGhlIHNwZWNpZmllZCBpbmRleC4gKi8KICAgIGZ1bmN0aW9uIHRva2VuSG9sZGVyKHVpbnQyNTYgX2luZGV4KSBhY2NvdW50UmVhZGVyT25seSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVyc1tfaW5kZXhdOwogICAgfQogCiAgICAvKiBBZGRzIGFuIGFwcHJvdmFsIGZvciB0aGUgc3BlY2lmaWVkIGFjY291bnQgdG8gc3BlbmQgbW9uZXkgb2YgdGhlIG1lc3NhZ2Ugc2VuZGVyIHVwIHRvIHRoZSBkZWZpbmVkIGxpbWl0ICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgZnVuZFNlbmRhYmxlUGhhc2Ugb25seVBheWxvYWRTaXplKDIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyogR2V0cyB0aGUgY3VycmVudCBhbGxvd2FuY2UgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCBmb3IgdGhlIHNwZWNpZmllZCBzcGVuZGVyIG9mIHRoZSBvd25lciBhZGRyZXNzICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLyogR2V0cyB0aGUgdG90YWwgc3VwcGx5IGF2YWlsYWJsZSBvZiB0aGlzIHRva2VuICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBbW91bnQ7CiAgICB9CgogICAgLyogR2V0cyB0aGUgYmFsYW5jZSBvZiBhIHNwZWNpZmllZCBhY2NvdW50ICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8qIFRyYW5zZmVyIHRoZSBiYWxhbmNlIGZyb20gb3duZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudCAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgZnVuZFNlbmRhYmxlUGhhc2Ugb25seVBheWxvYWRTaXplKDIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvKiBDaGVjayBpZiBzZW5kZXIgaGFzIGJhbGFuY2UgYW5kIGZvciBvdmVyZmxvd3MgKi8KICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCBfYW1vdW50IHx8IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpIDwgYmFsYW5jZXNbX3RvXSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvKiBEbyBhIGNoZWNrIHRvIHNlZSBpZiB0aGV5IGFyZSBuZXcsIGlmIHNvIHdlJ2xsIHdhbnQgdG8gYWRkIGl0IHRvIG91ciBhcnJheSAqLwogICAgICAgIGJvb2wgaXNSZWNpcGllbnROZXcgPSBiYWxhbmNlc1tfdG9dIDwgMTsKCiAgICAgICAgLyogQWRkIGFuZCBzdWJ0cmFjdCBuZXcgYmFsYW5jZXMgKi8KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CgogICAgICAgIC8qIENvbnNvbGlkYXRlIGFycmF5cyBpZiB0aGV5IGFyZSBuZXcgb3IgaWYgc2VuZGVyIG5vdyBoYXMgZW1wdHkgYmFsYW5jZSAqLwogICAgICAgIGlmIChpc1JlY2lwaWVudE5ldykKICAgICAgICAgICAgdG9rZW5Pd25lckFkZChfdG8pOwogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA8IDEpCiAgICAgICAgICAgIHRva2VuT3duZXJSZW1vdmUobXNnLnNlbmRlcik7CgogICAgICAgIC8qIEZpcmUgbm90aWZpY2F0aW9uIGV2ZW50ICovCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKiBJZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaXMgbm90IGluIG91ciBvd25lciBsaXN0LCBhZGQgdGhlbSAtIHRoaXMgY2FuIGJlIGNhbGxlZCBieSBkZXNjZW5kZW50cyB0byBlbnN1cmUgdGhlIGRhdGFiYXNlIGlzIGtlcHQgdXAgdG8gZGF0ZS4gKi8KICAgIGZ1bmN0aW9uIHRva2VuT3duZXJBZGQoYWRkcmVzcyBfYWRkcikgaW50ZXJuYWwgewogICAgICAgIC8qIEZpcnN0IGNoZWNrIGlmIHRoZXkgYWxyZWFkeSBleGlzdCAqLwogICAgICAgIHVpbnQyNTYgdG9rZW5Ib2xkZXJDb3VudCA9IGFsbFRva2VuSG9sZGVycy5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgdG9rZW5Ib2xkZXJDb3VudDsgaSsrKQogICAgICAgICAgICBpZiAoYWxsVG9rZW5Ib2xkZXJzW2ldID09IF9hZGRyKQogICAgICAgICAgICAgICAgLyogQWxyZWFkeSBmb3VuZCBzbyB3ZSBjYW4gYWJvcnQgbm93ICovCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgCiAgICAgICAgLyogVGhleSBkb24ndCBzZWVtIHRvIGV4aXN0LCBzbyBsZXQncyBhZGQgdGhlbSAqLwogICAgICAgIGFsbFRva2VuSG9sZGVycy5sZW5ndGgrKzsKICAgICAgICBhbGxUb2tlbkhvbGRlcnNbYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCAtIDFdID0gX2FkZHI7CiAgICB9CgogICAgLyogSWYgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGluIG91ciBvd25lciBsaXN0LCByZW1vdmUgdGhlbSAtIHRoaXMgY2FuIGJlIGNhbGxlZCBieSBkZXNjZW5kZW50cyB0byBlbnN1cmUgdGhlIGRhdGFiYXNlIGlzIGtlcHQgdXAgdG8gZGF0ZS4gKi8KICAgIGZ1bmN0aW9uIHRva2VuT3duZXJSZW1vdmUoYWRkcmVzcyBfYWRkcikgaW50ZXJuYWwgewogICAgICAgIC8qIEZpbmQgb3V0IHdoZXJlIGluIG91ciBhcnJheSB0aGV5IGFyZSAqLwogICAgICAgIHVpbnQyNTYgdG9rZW5Ib2xkZXJDb3VudCA9IGFsbFRva2VuSG9sZGVycy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBmb3VuZEluZGV4ID0gMDsKICAgICAgICBib29sIGZvdW5kID0gZmFsc2U7CiAgICAgICAgdWludDI1NiBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbkhvbGRlckNvdW50OyBpKyspCiAgICAgICAgICAgIGlmIChhbGxUb2tlbkhvbGRlcnNbaV0gPT0gX2FkZHIpIHsKICAgICAgICAgICAgICAgIGZvdW5kSW5kZXggPSBpOwogICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBJZiB3ZSBkaWRuJ3QgZmluZCB0aGVtIGp1c3QgcmV0dXJuICovCiAgICAgICAgaWYgKCFmb3VuZCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIAogICAgICAgIC8qIFdlIG5vdyBuZWVkIHRvIHNodWZmbGUgZG93biB0aGUgYXJyYXkgKi8KICAgICAgICBmb3IgKGkgPSBmb3VuZEluZGV4OyBpIDwgdG9rZW5Ib2xkZXJDb3VudCAtIDE7IGkrKykKICAgICAgICAgICAgYWxsVG9rZW5Ib2xkZXJzW2ldID0gYWxsVG9rZW5Ib2xkZXJzW2kgKyAxXTsKICAgICAgICBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoLS07CiAgICB9CgogICAgLyogTWludCBuZXcgdG9rZW5zIC0gdGhpcyBjYW4gb25seSBiZSBkb25lIGJ5IHNwZWNpYWwgY2FsbGVycyAoaS5lLiB0aGUgSUNPIG1hbmFnZW1lbnQpIGR1cmluZyB0aGUgSUNPIHBoYXNlLiAqLwogICAgZnVuY3Rpb24gbWludFRva2VucyhhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF9hbW91bnQpIG9ubHlQYXlsb2FkU2l6ZSgyKSB7CiAgICAgICAgLyogRW5zdXJlIHdlIGFyZSB0aGUgSUNPIGNvbnRyYWN0IGNhbGxpbmcgKi8KICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBpY29Db250cmFjdEFkZHJlc3MgfHwgIWljb1BoYXNlTWFuYWdlbWVudC5pY29QaGFzZSgpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogTWludCB0aGUgdG9rZW5zIGZvciB0aGUgbmV3IGFkZHJlc3MqLwogICAgICAgIGJvb2wgaXNOZXcgPSBiYWxhbmNlc1tfYWRkcmVzc10gPT0gMDsKICAgICAgICB0b3RhbFN1cHBseUFtb3VudCA9IHRvdGFsU3VwcGx5QW1vdW50LmFkZChfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfYWRkcmVzc10gPSBiYWxhbmNlc1tfYWRkcmVzc10uYWRkKF9hbW91bnQpOwogICAgICAgIGlmIChpc05ldykKICAgICAgICAgICAgdG9rZW5Pd25lckFkZChfYWRkcmVzcyk7CiAgICAgICAgVHJhbnNmZXIoMCwgX2FkZHJlc3MsIF9hbW91bnQpOwogICAgfQp9Cgpjb250cmFjdCBJY29QaGFzZU1hbmFnZW1lbnQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIC8qIERlZmluZXMgd2hldGhlciBvciBub3Qgd2UgYXJlIGluIHRoZSBJQ08gcGhhc2UgKi8KICAgIGJvb2wgcHVibGljIGljb1BoYXNlID0gdHJ1ZTsKCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBJQ08gaGFzIGJlZW4gYWJhbmRvbmVkICovCiAgICBib29sIHB1YmxpYyBpY29BYmFuZG9uZWQgPSBmYWxzZTsKCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBTSUZUIGNvbnRyYWN0IGFkZHJlc3MgaGFzIHlldCBiZWVuIHNldC4gICovCiAgICBib29sIHNpZnRDb250cmFjdERlZmluZWQgPSBmYWxzZTsKICAgIAogICAgLyogRGVmaW5lcyB0aGUgc2FsZSBwcmljZSBkdXJpbmcgSUNPICovCiAgICB1aW50MjU2IGNvbnN0YW50IGljb1VuaXRQcmljZSA9IDEwIGZpbm5leTsKCiAgICAvKiBJZiBhbiBJQ08gaXMgYWJhbmRvbmVkIGFuZCBzb21lIHdpdGhkcmF3YWxzIGZhaWwgdGhlbiB0aGlzIG1hcCBhbGxvd3MgcGVvcGxlIHRvIHJlcXVlc3Qgd2l0aGRyYXdhbCBvZiBsb2NrZWQtaW4gZXRoZXIuICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFiYW5kb25lZEljb0JhbGFuY2VzOwoKICAgIC8qIERlZmluZXMgb3VyIGludGVyZmFjZSB0byB0aGUgU0lGVCBjb250cmFjdC4gKi8KICAgIFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiBzbWFydEludmVzdG1lbnRGdW5kVG9rZW47CgogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLwogICAgQXV0aGVudGljYXRpb25NYW5hZ2VyIGF1dGhlbnRpY2F0aW9uTWFuYWdlcjsKCiAgICAvKiBEZWZpbmVzIHRoZSB0aW1lIHRoYXQgdGhlIElDTyBzdGFydHMuICovCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpY29TdGFydFRpbWUgPSAxNTAxNTQ1NjAwOyAvLyBBdWd1c3QgMXN0IDIwMTcgYXQgMDA6MDA6MDAgVVRDCgogICAgLyogRGVmaW5lcyB0aGUgdGltZSB0aGF0IHRoZSBJQ08gZW5kcy4gKi8KICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGljb0VuZFRpbWUgPSAxNTA1NDMzNjAwOyAvLyBTZXB0ZW1iZXIgMTV0aCAyMDE3IGF0IDAwOjAwOjAwIFVUQwoKICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIHdoZW4gdGhlIElDTyBpcyBjbG9zZWQgKi8KICAgIGV2ZW50IEljb0Nsb3NlZCgpOwoKICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIGlmIHRoZSBJQ08gaXMgYWJhbmRvbmVkICovCiAgICBldmVudCBJY29BYmFuZG9uZWQoc3RyaW5nIGRldGFpbHMpOwogICAgCiAgICAvKiBFbnN1cmVzIHRoYXQgb25jZSB0aGUgSUNPIGlzIG92ZXIgdGhpcyBjb250cmFjdCBjYW5ub3QgYmUgdXNlZCB1bnRpbCB0aGUgcG9pbnQgaXQgaXMgZGVzdHJ1Y3RlZC4gKi8KICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdJY28gewogICAgICAgIGJvb2wgY29udHJhY3RWYWxpZCA9IHNpZnRDb250cmFjdERlZmluZWQgJiYgIXNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5pc0Nsb3NlZCgpOwogICAgICAgIGlmICghY29udHJhY3RWYWxpZCB8fCAoIWljb1BoYXNlICYmICFpY29BYmFuZG9uZWQpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8qIFRoaXMgbW9kaWZpZXIgYWxsb3dzIGEgbWV0aG9kIHRvIG9ubHkgYmUgY2FsbGVkIGJ5IGN1cnJlbnQgYWRtaW5zICovCiAgICBtb2RpZmllciBhZG1pbk9ubHkgewogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8qIENyZWF0ZSB0aGUgSUNPIHBoYXNlIG1hbmFnZXJtZW50IGFuZCBkZWZpbmUgdGhlIGFkZHJlc3Mgb2YgdGhlIG1haW4gU0lGVCBjb250cmFjdC4gKi8KICAgIGZ1bmN0aW9uIEljb1BoYXNlTWFuYWdlbWVudChhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7CiAgICAgICAgLyogQSBiYXNpYyBzYW5pdHkgY2hlY2sgKi8KICAgICAgICBpZiAoaWNvU3RhcnRUaW1lID49IGljb0VuZFRpbWUpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyBhbmQgdmFsaWRhdGUgdGhlaXIgdmVyc2lvbnMgKi8KICAgICAgICBhdXRoZW50aWNhdGlvbk1hbmFnZXIgPSBBdXRoZW50aWNhdGlvbk1hbmFnZXIoX2F1dGhlbnRpY2F0aW9uTWFuYWdlckFkZHJlc3MpOwogICAgICAgIGlmIChhdXRoZW50aWNhdGlvbk1hbmFnZXIuY29udHJhY3RWZXJzaW9uKCkgIT0gMTAwMjAxNzA3MTcxNTAzKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvKiBTZXQgdGhlIFNJRlQgY29udHJhY3QgYWRkcmVzcyBhcyBhIG9uZS10aW1lIG9wZXJhdGlvbi4gIFRoaXMgaGFwcGVucyBhZnRlciBhbGwgdGhlIGNvbnRyYWN0cyBhcmUgY3JlYXRlZCBhbmQgbm8KICAgICAgIG90aGVyIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIHVzZWQgdW50aWwgdGhpcyBpcyBzZXQuICovCiAgICBmdW5jdGlvbiBzZXRTaWZ0Q29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX3NpZnRDb250cmFjdEFkZHJlc3MpIGFkbWluT25seSB7CiAgICAgICAgLyogVGhpcyBjYW4gb25seSBoYXBwZW4gb25jZSBpbiB0aGUgbGlmZXRpbWUgb2YgdGhpcyBjb250cmFjdCAqLwogICAgICAgIGlmIChzaWZ0Q29udHJhY3REZWZpbmVkKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovCiAgICAgICAgc21hcnRJbnZlc3RtZW50RnVuZFRva2VuID0gU21hcnRJbnZlc3RtZW50RnVuZFRva2VuKF9zaWZ0Q29udHJhY3RBZGRyZXNzKTsKICAgICAgICBpZiAoc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLmNvbnRyYWN0VmVyc2lvbigpICE9IDUwMDIwMTcwNzE3MTQ0MCkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgc2lmdENvbnRyYWN0RGVmaW5lZCA9IHRydWU7CiAgICB9CgogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLwogICAgZnVuY3Rpb24gY29udHJhY3RWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgLyogSUNPIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgMzAwWVlZWU1NRERISE1NICovCiAgICAgICAgcmV0dXJuIDMwMDIwMTcwNzE3MTQ0MDsKICAgIH0KCiAgICAvKiBDbG9zZSB0aGUgSUNPIHBoYXNlIGFuZCB0cmFuc2l0aW9uIHRvIGV4ZWN1dGlvbiBwaGFzZSAqLwogICAgZnVuY3Rpb24gY2xvc2UoKSBhZG1pbk9ubHkgb25seUR1cmluZ0ljbyB7CiAgICAgICAgLy8gRm9yYmlkIGNsb3NpbmcgY29udHJhY3QgYmVmb3JlIHRoZSBlbmQgb2YgSUNPCiAgICAgICAgaWYgKG5vdyA8PSBpY29FbmRUaW1lKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gQ2xvc2UgdGhlIElDTwogICAgICAgIGljb1BoYXNlID0gZmFsc2U7CiAgICAgICAgSWNvQ2xvc2VkKCk7CgogICAgICAgIC8vIFdpdGhkcmF3IGZ1bmRzIHRvIHRoZSBjYWxsZXIKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KICAgIAogICAgLyogSGFuZGxlIHJlY2VpdmluZyBldGhlciBpbiBJQ08gcGhhc2UgLSB3ZSB3b3JrIG91dCBob3cgbXVjaCB0aGUgdXNlciBoYXMgYm91Z2h0LCBhbGxvY2F0ZSBhIHN1aXRhYmxlIGJhbGFuY2UgYW5kIHNlbmQgdGhlaXIgY2hhbmdlICovCiAgICBmdW5jdGlvbiAoKSBvbmx5RHVyaW5nSWNvIHBheWFibGUgewogICAgICAgIC8vIEZvcmJpZCBmdW5kaW5nIG91dHNpZGUgb2YgSUNPCiAgICAgICAgaWYgKG5vdyA8IGljb1N0YXJ0VGltZSB8fCBub3cgPiBpY29FbmRUaW1lKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogRGV0ZXJtaW5lIGhvdyBtdWNoIHRoZXkndmUgYWN0dWFsbHkgcHVyaGNhc2VkIGFuZCBhbnkgZXRoZXIgY2hhbmdlICovCiAgICAgICAgdWludDI1NiB0b2tlbnNQdXJjaGFzZWQgPSBtc2cudmFsdWUgLyBpY29Vbml0UHJpY2U7CiAgICAgICAgdWludDI1NiBwdXJjaGFzZVRvdGFsUHJpY2UgPSB0b2tlbnNQdXJjaGFzZWQgKiBpY29Vbml0UHJpY2U7CiAgICAgICAgdWludDI1NiBjaGFuZ2UgPSBtc2cudmFsdWUuc3ViKHB1cmNoYXNlVG90YWxQcmljZSk7CgogICAgICAgIC8qIEluY3JlYXNlIHRoZWlyIG5ldyBiYWxhbmNlIGlmIHRoZXkgYWN0dWFsbHkgcHVyY2hhc2VkIGFueSAqLwogICAgICAgIGlmICh0b2tlbnNQdXJjaGFzZWQgPiAwKQogICAgICAgICAgICBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4ubWludFRva2Vucyhtc2cuc2VuZGVyLCB0b2tlbnNQdXJjaGFzZWQpOwoKICAgICAgICAvKiBTZW5kIGNoYW5nZSBiYWNrIHRvIHJlY2lwaWVudCAqLwogICAgICAgIGlmIChjaGFuZ2UgPiAwICYmICFtc2cuc2VuZGVyLnNlbmQoY2hhbmdlKSkKICAgICAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLyogQWJhbmRvbnMgdGhlIElDTyBhbmQgcmV0dXJucyBmdW5kcyB0byBzaGFyZWhvbGRlcnMuICBBbnkgZmFpbGVkIGZ1bmRzIGNhbiBiZSBzZXBhcmF0ZWx5IHdpdGhkcmF3biBvbmNlIHRoZSBJQ08gaXMgYWJhbmRvbmVkLiAqLwogICAgZnVuY3Rpb24gYWJhbmRvbihzdHJpbmcgZGV0YWlscykgYWRtaW5Pbmx5IG9ubHlEdXJpbmdJY28gewogICAgICAgIC8vIEZvcmJpZCBjbG9zaW5nIGNvbnRyYWN0IGJlZm9yZSB0aGUgZW5kIG9mIElDTwogICAgICAgIGlmIChub3cgPD0gaWNvRW5kVGltZSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIElmIGFscmVhZHkgYWJhbmRvbmVkIHRocm93IGFuIGVycm9yICovCiAgICAgICAgaWYgKGljb0FiYW5kb25lZCkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFdvcmsgb3V0IGEgcmVmdW5kIHBlciBzaGFyZSBwZXIgc2hhcmUgKi8KICAgICAgICB1aW50MjU2IHBheW1lbnRQZXJTaGFyZSA9IHRoaXMuYmFsYW5jZSAvIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b3RhbFN1cHBseSgpOwoKICAgICAgICAvKiBFbnVtIGFsbCBhY2NvdW50cyBhbmQgc2VuZCB0aGVtIHJlZnVuZCAqLwogICAgICAgIHVpbnQgbnVtYmVyVG9rZW5Ib2xkZXJzID0gc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLnRva2VuSG9sZGVyQ291bnQoKTsKICAgICAgICB1aW50MjU2IHRvdGFsQWJhbmRvbmVkID0gMDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBudW1iZXJUb2tlbkhvbGRlcnM7IGkrKykgewogICAgICAgICAgICAvKiBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0byB0aGlzIHNoYXJlaG9sZGVyICovCiAgICAgICAgICAgIGFkZHJlc3MgYWRkciA9IHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b2tlbkhvbGRlcihpKTsKICAgICAgICAgICAgdWludDI1NiBldGhlclRvU2VuZCA9IHBheW1lbnRQZXJTaGFyZSAqIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5iYWxhbmNlT2YoYWRkcik7CiAgICAgICAgICAgIGlmIChldGhlclRvU2VuZCA8IDEpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8qIEFsbG9jYXRlIGFwcHJvcHJpYXRlIGFtb3VudCBvZiBmdW5kIHRvIHRoZW0gKi8KICAgICAgICAgICAgYWJhbmRvbmVkSWNvQmFsYW5jZXNbYWRkcl0gPSBhYmFuZG9uZWRJY29CYWxhbmNlc1thZGRyXS5hZGQoZXRoZXJUb1NlbmQpOwogICAgICAgICAgICB0b3RhbEFiYW5kb25lZCA9IHRvdGFsQWJhbmRvbmVkLmFkZChldGhlclRvU2VuZCk7CiAgICAgICAgfQoKICAgICAgICAvKiBBdWRpdCB0aGUgYWJhbmRvbm1lbnQgKi8KICAgICAgICBpY29BYmFuZG9uZWQgPSB0cnVlOwogICAgICAgIEljb0FiYW5kb25lZChkZXRhaWxzKTsKCiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIGJlIG5vIG1vbmV5IGxlZnQsIGJ1dCB3aXRoZHJhdyBqdXN0IGluY2FzZSBmb3IgbWFudWFsIHJlc29sdXRpb24KICAgICAgICB1aW50MjU2IHJlbWFpbmRlciA9IHRoaXMuYmFsYW5jZS5zdWIodG90YWxBYmFuZG9uZWQpOwogICAgICAgIGlmIChyZW1haW5kZXIgPiAwKQogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChyZW1haW5kZXIpKQogICAgICAgICAgICAgICAgLy8gQWRkIHRoaXMgdG8gdGhlIGNhbGxlcnMgYmFsYW5jZSBmb3IgZW1lcmdlbmN5IHJlZnVuZHMKICAgICAgICAgICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID0gYWJhbmRvbmVkSWNvQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKHJlbWFpbmRlcik7CiAgICB9CgogICAgLyogQWxsb3dzIHBlb3BsZSB0byB3aXRoZHJhdyBmdW5kcyB0aGF0IGZhaWxlZCB0byBzZW5kIGR1cmluZyB0aGUgYWJhbmRvbm1lbnQgb2YgdGhlIElDTyBmb3IgYW55IHJlYXNvbi4gKi8KICAgIGZ1bmN0aW9uIGFiYW5kb25lZEZ1bmRXaXRoZHJhd2FsKCkgewogICAgICAgIC8vIFRoaXMgZnVuY3Rpb25hbGl0eSBvbmx5IGV4aXN0cyBpZiBhbiBJQ08gd2FzIGFiYW5kb25lZAogICAgICAgIGlmICghaWNvQWJhbmRvbmVkIHx8IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID09IDApCiAgICAgICAgICAgIHRocm93OwogICAgICAgIAogICAgICAgIC8vIEF0dGVtcHQgdG8gc2VuZCB0aGVtIHRvIGZ1bmRzCiAgICAgICAgdWludDI1NiBmdW5kcyA9IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChmdW5kcykpCiAgICAgICAgICAgIHRocm93OwogICAgfQp9CgovKiBUaGUgYXV0aGVudGljYXRpb24gbWFuYWdlciBkZXRhaWxzIHVzZXIgYWNjb3VudHMgdGhhdCBoYXZlIGFjY2VzcyB0byBjZXJ0YWluIHByaXZpbGVkZ2VzIGFuZCBrZWVwcyBhIHBlcm1hbmVudCBsZWRnZXIgb2Ygd2hvIGhhcyBhbmQgaGFzIGhhZCB0aGVzZSByaWdodHMuICovCmNvbnRyYWN0IEF1dGhlbnRpY2F0aW9uTWFuYWdlciB7CiAgICAvKiBNYXAgYWRkcmVzc2VzIHRvIGFkbWlucyAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhZG1pbkFkZHJlc3NlczsKCiAgICAvKiBNYXAgYWRkcmVzc2VzIHRvIGFjY291bnQgcmVhZGVycyAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhY2NvdW50UmVhZGVyQWRkcmVzc2VzOwoKICAgIC8qIERldGFpbHMgb2YgYWxsIGFkbWlucyB0aGF0IGhhdmUgZXZlciBleGlzdGVkICovCiAgICBhZGRyZXNzW10gYWRtaW5BdWRpdDsKCiAgICAvKiBEZXRhaWxzIG9mIGFsbCBhY2NvdW50IHJlYWRlcnMgdGhhdCBoYXZlIGV2ZXIgZXhpc3RlZCAqLwogICAgYWRkcmVzc1tdIGFjY291bnRSZWFkZXJBdWRpdDsKCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhZG1pbiBpcyBhZGRlZCB0byB0aGUgY29udHJhY3QuICovCiAgICBldmVudCBBZG1pbkFkZGVkKGFkZHJlc3MgYWRkZWRCeSwgYWRkcmVzcyBhZG1pbik7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWRtaW4gaXMgcmVtb3ZlZCBmcm9tIHRoZSBjb250cmFjdC4gKi8KICAgIGV2ZW50IEFkbWluUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhZG1pbik7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWNjb3VudC1yZWFkZXIgY29udHJhY3QgaXMgYWRkZWQuICovCiAgICBldmVudCBBY2NvdW50UmVhZGVyQWRkZWQoYWRkcmVzcyBhZGRlZEJ5LCBhZGRyZXNzIGFjY291bnQpOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFjY291bnQtcmVhZGVyIGNvbnRyYWN0IGlzIHJlbW92ZWQuICovCiAgICBldmVudCBBY2NvdW50UmVhZGVyUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhY2NvdW50KTsKCiAgICAvKiBXaGVuIHRoaXMgY29udHJhY3QgaXMgZmlyc3Qgc2V0dXAgd2UgdXNlIHRoZSBjcmVhdG9yIGFzIHRoZSBmaXJzdCBhZG1pbiAqLyAgICAKICAgIGZ1bmN0aW9uIEF1dGhlbnRpY2F0aW9uTWFuYWdlcigpIHsKICAgICAgICAvKiBTZXQgdGhlIGZpcnN0IGFkbWluIHRvIGJlIHRoZSBwZXJzb24gY3JlYXRpbmcgdGhlIGNvbnRyYWN0ICovCiAgICAgICAgYWRtaW5BZGRyZXNzZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIEFkbWluQWRkZWQoMCwgbXNnLnNlbmRlcik7CiAgICAgICAgYWRtaW5BdWRpdC5sZW5ndGgrKzsKICAgICAgICBhZG1pbkF1ZGl0W2FkbWluQXVkaXQubGVuZ3RoIC0gMV0gPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qIEdldHMgdGhlIGNvbnRyYWN0IHZlcnNpb24gZm9yIHZhbGlkYXRpb24gKi8KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIC8vIEFkbWluIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgMTAwWVlZWU1NRERISE1NCiAgICAgICAgcmV0dXJuIDEwMDIwMTcwNzE3MTUwMzsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBjdXJyZW50bHkgYW4gYWRtaW4gKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdOwogICAgfQoKICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBldmVyIGJlZW4gYW4gYWRtaW4gKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudE9yUGFzdEFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhZG1pbkF1ZGl0Lmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoYWRtaW5BdWRpdFtpXSA9PSBfYWRkcmVzcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBjdXJyZW50bHkgYW4gYWNjb3VudCByZWFkZXIgKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFjY291bnRSZWFkZXIoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBoYXMgZXZlciBiZWVuIGFuIGFkbWluICovCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRPclBhc3RBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhY2NvdW50UmVhZGVyQXVkaXQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChhY2NvdW50UmVhZGVyQXVkaXRbaV0gPT0gX2FkZHJlc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyogQWRkcyBhIHVzZXIgdG8gb3VyIGxpc3Qgb2YgYWRtaW5zICovCiAgICBmdW5jdGlvbiBhZGRBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgYWRtaW4KICAgICAgICBpZiAoYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBBZGQgdGhlIHVzZXIKICAgICAgICBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOwogICAgICAgIEFkbWluQWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgICAgIGFkbWluQXVkaXQubGVuZ3RoKys7CiAgICAgICAgYWRtaW5BdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7CiAgICB9CgogICAgLyogUmVtb3ZlcyBhIHVzZXIgZnJvbSBvdXIgbGlzdCBvZiBhZG1pbnMgYnV0IGtlZXBzIHRoZW0gaW4gdGhlIGhpc3RvcnkgYXVkaXQgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZUFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogRG9uJ3QgYWxsb3cgcmVtb3ZhbCBvZiBzZWxmICovCiAgICAgICAgaWYgKF9hZGRyZXNzID09IG1zZy5zZW5kZXIpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvLyBGYWlsIGlmIHRoaXMgYWNjb3VudCBpcyBhbHJlYWR5IG5vbi1hZG1pbgogICAgICAgIGlmICghYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogUmVtb3ZlIHRoaXMgYWRtaW4gdXNlciAqLwogICAgICAgIGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSA9IGZhbHNlOwogICAgICAgIEFkbWluUmVtb3ZlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7CiAgICB9CgogICAgLyogQWRkcyBhIHVzZXIvY29udHJhY3QgdG8gb3VyIGxpc3Qgb2YgYWNjb3VudCByZWFkZXJzICovCiAgICBmdW5jdGlvbiBhZGRBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdAogICAgICAgIGlmIChhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIHRoZSB1c2VyCiAgICAgICAgYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOwogICAgICAgIEFjY291bnRSZWFkZXJBZGRlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7CiAgICAgICAgYWNjb3VudFJlYWRlckF1ZGl0Lmxlbmd0aCsrOwogICAgICAgIGFjY291bnRSZWFkZXJBdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7CiAgICB9CgogICAgLyogUmVtb3ZlcyBhIHVzZXIvY29udHJhY3RzIGZyb20gb3VyIGxpc3Qgb2YgYWNjb3VudCByZWFkZXJzIGJ1dCBrZWVwcyB0aGVtIGluIHRoZSBoaXN0b3J5IGF1ZGl0ICovCiAgICBmdW5jdGlvbiByZW1vdmVBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBub3QgaW4gdGhlIGxpc3QKICAgICAgICBpZiAoIWFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogUmVtb3ZlIHRoaXMgYWRtaW4gdXNlciAqLwogICAgICAgIGFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdID0gZmFsc2U7CiAgICAgICAgQWNjb3VudFJlYWRlclJlbW92ZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgfQp9Cgpjb250cmFjdCBEaXZpZGVuZE1hbmFnZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLyogT3VyIGhhbmRsZSB0byB0aGUgU0lGVCBjb250cmFjdC4gKi8KICAgIFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiBzaWZ0Q29udHJhY3Q7CgogICAgLyogSGFuZGxlIHBheW1lbnRzIHdlIGNvdWxkbid0IG1ha2UuICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkaXZpZGVuZHM7CgogICAgLyogSW5kaWNhdGVzIGEgcGF5bWVudCBpcyBub3cgYXZhaWxhYmxlIHRvIGEgc2hhcmVob2xkZXIgKi8KICAgIGV2ZW50IFBheW1lbnRBdmFpbGFibGUoYWRkcmVzcyBhZGRyLCB1aW50MjU2IGFtb3VudCk7CgogICAgLyogSW5kaWNhdGVzIGEgZGl2aWRlbmQgcGF5bWVudCB3YXMgbWFkZS4gKi8KICAgIGV2ZW50IERpdmlkZW5kUGF5bWVudCh1aW50MjU2IHBheW1lbnRQZXJTaGFyZSwgdWludDI1NiB0aW1lc3RhbXApOwoKICAgIC8qIENyZWF0ZSBvdXIgY29udHJhY3Qgd2l0aCByZWZlcmVuY2VzIHRvIG90aGVyIGNvbnRyYWN0cyBhcyByZXF1aXJlZC4gKi8KICAgIGZ1bmN0aW9uIERpdmlkZW5kTWFuYWdlcihhZGRyZXNzIF9zaWZ0Q29udHJhY3RBZGRyZXNzKSB7CiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovCiAgICAgICAgc2lmdENvbnRyYWN0ID0gU21hcnRJbnZlc3RtZW50RnVuZFRva2VuKF9zaWZ0Q29udHJhY3RBZGRyZXNzKTsKICAgICAgICBpZiAoc2lmdENvbnRyYWN0LmNvbnRyYWN0VmVyc2lvbigpICE9IDUwMDIwMTcwNzE3MTQ0MCkKICAgICAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLwogICAgZnVuY3Rpb24gY29udHJhY3RWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgLyogRGl2aWRlbmQgY29udHJhY3QgaWRlbnRpZmllcyBhcyA2MDBZWVlZTU1EREhITU0gKi8KICAgICAgICByZXR1cm4gNjAwMjAxNzA3MTcxNDQwOwogICAgfQoKICAgIC8qIE1ha2VzIGEgZGl2aWRlbmQgcGF5bWVudCAtIHdlIG1ha2UgaXQgYXZhaWxhYmxlIHRvIGFsbCBzZW5kZXJzIHRoZW4gc2VuZCB0aGUgY2hhbmdlIGJhY2sgdG8gdGhlIGNhbGxlci4gIFdlIGRvbid0IGFjdHVhbGx5IHNlbmQgdGhlIHBheW1lbnRzIHRvIGV2ZXJ5b25lIHRvIHJlZHVjZSBnYXMgY29zdCBhbmQgYWxzbyB0byAKICAgICAgIHByZXZlbnQgcG90ZW50aWFsbHkgZ2V0dGluZyBpbnRvIGEgc2l0dWF0aW9uIHdoZXJlIHdlIGhhdmUgcmVjaXBpZW50cyB0aHJvd2luZyBjYXVzaW5nIGRpdmlkZW5kIGZhaWx1cmVzIGFuZCBoYXZpbmcgdG8gY29uc29saWRhdGUgdGhlaXIgZGl2aWRlbmRzIGluIGEgc2VwYXJhdGUgcHJvY2Vzcy4gKi8KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgICAgIGlmIChzaWZ0Q29udHJhY3QuaXNDbG9zZWQoKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIERldGVybWluZSBob3cgbXVjaCB0byBwYXkgZWFjaCBzaGFyZWhvbGRlci4gKi8KICAgICAgICB1aW50MjU2IHZhbGlkU3VwcGx5ID0gc2lmdENvbnRyYWN0LnRvdGFsU3VwcGx5KCk7CiAgICAgICAgdWludDI1NiBwYXltZW50UGVyU2hhcmUgPSBtc2cudmFsdWUgLyB2YWxpZFN1cHBseTsKICAgICAgICBpZiAocGF5bWVudFBlclNoYXJlID09IDApCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBFbnVtIGFsbCBhY2NvdW50cyBhbmQgc2VuZCB0aGVtIHBheW1lbnQgKi8KICAgICAgICB1aW50MjU2IHRvdGFsUGFpZE91dCA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgc2lmdENvbnRyYWN0LnRva2VuSG9sZGVyQ291bnQoKTsgaSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgYWRkciA9IHNpZnRDb250cmFjdC50b2tlbkhvbGRlcihpKTsKICAgICAgICAgICAgdWludDI1NiBkaXZpZGVuZCA9IHBheW1lbnRQZXJTaGFyZSAqIHNpZnRDb250cmFjdC5iYWxhbmNlT2YoYWRkcik7CiAgICAgICAgICAgIGRpdmlkZW5kc1thZGRyXSA9IGRpdmlkZW5kc1thZGRyXS5hZGQoZGl2aWRlbmQpOwogICAgICAgICAgICBQYXltZW50QXZhaWxhYmxlKGFkZHIsIGRpdmlkZW5kKTsKICAgICAgICAgICAgdG90YWxQYWlkT3V0ID0gdG90YWxQYWlkT3V0LmFkZChkaXZpZGVuZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBdHRlbXB0IHRvIHNlbmQgY2hhbmdlCiAgICAgICAgdWludDI1NiByZW1haW5kZXIgPSBtc2cudmFsdWUuc3ViKHRvdGFsUGFpZE91dCk7CiAgICAgICAgaWYgKHJlbWFpbmRlciA+IDAgJiYgIW1zZy5zZW5kZXIuc2VuZChyZW1haW5kZXIpKSB7CiAgICAgICAgICAgIGRpdmlkZW5kc1ttc2cuc2VuZGVyXSA9IGRpdmlkZW5kc1ttc2cuc2VuZGVyXS5hZGQocmVtYWluZGVyKTsKICAgICAgICAgICAgUGF5bWVudEF2YWlsYWJsZShtc2cuc2VuZGVyLCByZW1haW5kZXIpOwogICAgICAgIH0KCiAgICAgICAgLyogQXVkaXQgdGhpcyAqLwogICAgICAgIERpdmlkZW5kUGF5bWVudChwYXltZW50UGVyU2hhcmUsIG5vdyk7CiAgICB9CgogICAgLyogQWxsb3dzIGEgdXNlciB0byByZXF1ZXN0IGEgd2l0aGRyYXdhbCBvZiB0aGVpciBkaXZpZGVuZCBpbiBmdWxsLiAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdEaXZpZGVuZCgpIHsKICAgICAgICAvLyBFbnN1cmUgd2UgaGF2ZSBkaXZpZGVuZHMgYXZhaWxhYmxlCiAgICAgICAgaWYgKGRpdmlkZW5kc1ttc2cuc2VuZGVyXSA9PSAwKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBEZXRlcm1pbmUgaG93IG11Y2ggd2UncmUgc2VuZGluZyBhbmQgcmVzZXQgdGhlIGNvdW50CiAgICAgICAgdWludDI1NiBkaXZpZGVuZCA9IGRpdmlkZW5kc1ttc2cuc2VuZGVyXTsKICAgICAgICBkaXZpZGVuZHNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAvLyBBdHRlbXB0IHRvIHdpdGhkcmF3CiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoZGl2aWRlbmQpKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KfQ=='.
	

]
