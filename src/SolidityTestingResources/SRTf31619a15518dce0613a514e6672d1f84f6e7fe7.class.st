Class {
	#name : #SRTf31619a15518dce0613a514e6672d1f84f6e7fe7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf31619a15518dce0613a514e6672d1f84f6e7fe7 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgVXRpbGl0aWVzICYgQ29tbW9uIE1vZGlmaWVycwoqLwpjb250cmFjdCBVdGlscyB7CiAgICAvKioKICAgICAgICBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFV0aWxzKCkgewogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgYW4gYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiB6ZXJvCiAgICBtb2RpZmllciBncmVhdGVyVGhhblplcm8odWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYW4gYWRkcmVzcyAtIGN1cnJlbnRseSBvbmx5IGNoZWNrcyB0aGF0IGl0IGlzbid0IG51bGwKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGlzIGNvbnRyYWN0IGFkZHJlc3MKICAgIG1vZGlmaWVyIG5vdFRoaXMoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBPdmVyZmxvdyBwcm90ZWN0ZWQgbWF0aCBmdW5jdGlvbnMKCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIHN1bSBvZiBfeCBhbmQgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cwoKICAgICAgICBAcGFyYW0gX3ggICB2YWx1ZSAxCiAgICAgICAgQHBhcmFtIF95ICAgdmFsdWUgMgoKICAgICAgICBAcmV0dXJuIHN1bQogICAgKi8KICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiBfeCwgdWludDI1NiBfeSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7CiAgICAgICAgYXNzZXJ0KHogPj0gX3gpOwogICAgICAgIHJldHVybiB6OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcgoKICAgICAgICBAcGFyYW0gX3ggICBtaW51ZW5kCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZAoKICAgICAgICBAcmV0dXJuIGRpZmZlcmVuY2UKICAgICovCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoX3ggPj0gX3kpOwogICAgICAgIHJldHVybiBfeCAtIF95OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBtdWx0aXBseWluZyBfeCBieSBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzCgogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxCiAgICAgICAgQHBhcmFtIF95ICAgZmFjdG9yIDIKCiAgICAgICAgQHJldHVybiBwcm9kdWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiB6ID0gX3ggKiBfeTsKICAgICAgICBhc3NlcnQoX3ggPT0gMCB8fCB6IC8gX3ggPT0gX3kpOwogICAgICAgIHJldHVybiB6OwogICAgfQp9CgovKgogICAgT3duZWQgY29udHJhY3QgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElPd25lZCB7CiAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBvd25lcigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIG93bmVyKSB7IG93bmVyOyB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsKfQoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3Qgb3duZXJzaGlwCiovCmNvbnRyYWN0IE93bmVkIGlzIElPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgX3ByZXZPd25lciwgYWRkcmVzcyBfbmV3T3duZXIpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgb3duZXIgb25seQogICAgbW9kaWZpZXIgb3duZXJPbmx5IHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0cmFuc2ZlcnJpbmcgdGhlIGNvbnRyYWN0IG93bmVyc2hpcAogICAgICAgIHRoZSBuZXcgb3duZXIgc3RpbGwgbmVlZHMgdG8gYWNjZXB0IHRoZSB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9uZXdPd25lciAgICBuZXcgY29udHJhY3Qgb3duZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgcmVxdWlyZShfbmV3T3duZXIgIT0gb3duZXIpOwogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBvd25lciB0byBhY2NlcHQgYW4gb3duZXJzaGlwIHRyYW5zZmVyCiAgICAqLwogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3T3duZXIpOwogICAgICAgIE93bmVyVXBkYXRlKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICBuZXdPd25lciA9IDB4MDsKICAgIH0KfQoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3QgbWFuYWdlbWVudAoqLwpjb250cmFjdCBNYW5hZ2VkIHsKICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdNYW5hZ2VyOwoKICAgIGV2ZW50IE1hbmFnZXJVcGRhdGUoYWRkcmVzcyBfcHJldk1hbmFnZXIsIGFkZHJlc3MgX25ld01hbmFnZXIpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBNYW5hZ2VkKCkgewogICAgICAgIG1hbmFnZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gYnkgdGhlIG1hbmFnZXIgb25seQogICAgbW9kaWZpZXIgbWFuYWdlck9ubHkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG1hbmFnZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSBjb250cmFjdCBtYW5hZ2VtZW50CiAgICAgICAgdGhlIG5ldyBtYW5hZ2VyIHN0aWxsIG5lZWRzIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9uZXdNYW5hZ2VyICAgIG5ldyBjb250cmFjdCBtYW5hZ2VyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJNYW5hZ2VtZW50KGFkZHJlc3MgX25ld01hbmFnZXIpIHB1YmxpYyBtYW5hZ2VyT25seSB7CiAgICAgICAgcmVxdWlyZShfbmV3TWFuYWdlciAhPSBtYW5hZ2VyKTsKICAgICAgICBuZXdNYW5hZ2VyID0gX25ld01hbmFnZXI7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG1hbmFnZXIgdG8gYWNjZXB0IGEgbWFuYWdlbWVudCB0cmFuc2ZlcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdE1hbmFnZW1lbnQoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdNYW5hZ2VyKTsKICAgICAgICBNYW5hZ2VyVXBkYXRlKG1hbmFnZXIsIG5ld01hbmFnZXIpOwogICAgICAgIG1hbmFnZXIgPSBuZXdNYW5hZ2VyOwogICAgICAgIG5ld01hbmFnZXIgPSAweDA7CiAgICB9Cn0KCi8qCiAgICBUb2tlbiBIb2xkZXIgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElUb2tlbkhvbGRlciBpcyBJT3duZWQgewogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7Cn0KCi8qCiAgICBXZSBjb25zaWRlciBldmVyeSBjb250cmFjdCB0byBiZSBhICd0b2tlbiBob2xkZXInIHNpbmNlIGl0J3MgY3VycmVudGx5IG5vdCBwb3NzaWJsZQogICAgZm9yIGEgY29udHJhY3QgdG8gZGVueSByZWNlaXZpbmcgdG9rZW5zLgoKICAgIFRoZSBUb2tlbkhvbGRlcidzIGNvbnRyYWN0IHNvbGUgcHVycG9zZSBpcyB0byBwcm92aWRlIGEgc2FmZXR5IG1lY2hhbmlzbSB0aGF0IGFsbG93cwogICAgdGhlIG93bmVyIHRvIHNlbmQgdG9rZW5zIHRoYXQgd2VyZSBzZW50IHRvIHRoZSBjb250cmFjdCBieSBtaXN0YWtlIGJhY2sgdG8gdGhlaXIgc2VuZGVyLgoqLwpjb250cmFjdCBUb2tlbkhvbGRlciBpcyBJVG9rZW5Ib2xkZXIsIE93bmVkLCBVdGlscyB7CiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXIoKSB7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB3aXRoZHJhd3MgdG9rZW5zIGhlbGQgYnkgdGhlIGNvbnRyYWN0IGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQogICAgICAgIG5vdFRoaXMoX3RvKQogICAgewogICAgICAgIGFzc2VydChfdG9rZW4udHJhbnNmZXIoX3RvLCBfYW1vdW50KSk7CiAgICB9Cn0KCi8qCiAgICBUaGUgc21hcnQgdG9rZW4gY29udHJvbGxlciBpcyBhbiB1cGdyYWRhYmxlIHBhcnQgb2YgdGhlIHNtYXJ0IHRva2VuIHRoYXQgYWxsb3dzCiAgICBtb3JlIGZ1bmN0aW9uYWxpdHkgYXMgd2VsbCBhcyBmaXhlcyBmb3IgYnVncy9leHBsb2l0cy4KICAgIE9uY2UgaXQgYWNjZXB0cyBvd25lcnNoaXAgb2YgdGhlIHRva2VuLCBpdCBiZWNvbWVzIHRoZSB0b2tlbidzIHNvbGUgY29udHJvbGxlcgogICAgdGhhdCBjYW4gZXhlY3V0ZSBhbnkgb2YgaXRzIGZ1bmN0aW9ucy4KCiAgICBUbyB1cGdyYWRlIHRoZSBjb250cm9sbGVyLCBvd25lcnNoaXAgbXVzdCBiZSB0cmFuc2ZlcnJlZCB0byBhIG5ldyBjb250cm9sbGVyLCBhbG9uZyB3aXRoCiAgICBhbnkgcmVsZXZhbnQgZGF0YS4KCiAgICBUaGUgc21hcnQgdG9rZW4gbXVzdCBiZSBzZXQgb24gY29uc3RydWN0aW9uIGFuZCBjYW5ub3QgYmUgY2hhbmdlZCBhZnRlcndhcmRzLgogICAgV3JhcHBlcnMgYXJlIHByb3ZpZGVkIChhcyBvcHBvc2VkIHRvIGEgc2luZ2xlICdleGVjdXRlJyBmdW5jdGlvbikgZm9yIGVhY2ggb2YgdGhlIHRva2VuJ3MgZnVuY3Rpb25zLCBmb3IgZWFzaWVyIGFjY2Vzcy4KCiAgICBOb3RlIHRoYXQgdGhlIGNvbnRyb2xsZXIgY2FuIHRyYW5zZmVyIHRva2VuIG93bmVyc2hpcCB0byBhIG5ldyBjb250cm9sbGVyIHRoYXQKICAgIGRvZXNuJ3QgYWxsb3cgZXhlY3V0aW5nIGFueSBmdW5jdGlvbiBvbiB0aGUgdG9rZW4sIGZvciBhIHRydXN0bGVzcyBzb2x1dGlvbi4KICAgIERvaW5nIHRoYXQgd2lsbCBhbHNvIHJlbW92ZSB0aGUgb3duZXIncyBhYmlsaXR5IHRvIHVwZ3JhZGUgdGhlIGNvbnRyb2xsZXIuCiovCmNvbnRyYWN0IFNtYXJ0VG9rZW5Db250cm9sbGVyIGlzIFRva2VuSG9sZGVyIHsKICAgIElTbWFydFRva2VuIHB1YmxpYyB0b2tlbjsgICAvLyBzbWFydCB0b2tlbgoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBTbWFydFRva2VuQ29udHJvbGxlcihJU21hcnRUb2tlbiBfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgIHsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIHRva2VuJ3Mgb3duZXIKICAgIG1vZGlmaWVyIGFjdGl2ZSgpIHsKICAgICAgICBhc3NlcnQodG9rZW4ub3duZXIoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGVuc3VyZXMgdGhhdCB0aGUgY29udHJvbGxlciBpcyBub3QgdGhlIHRva2VuJ3Mgb3duZXIKICAgIG1vZGlmaWVyIGluYWN0aXZlKCkgewogICAgICAgIGFzc2VydCh0b2tlbi5vd25lcigpICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSB0b2tlbiBvd25lcnNoaXAKICAgICAgICB0aGUgbmV3IG93bmVyIHN0aWxsIG5lZWQgdG8gYWNjZXB0IHRoZSB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9uZXdPd25lciAgICBuZXcgdG9rZW4gb3duZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICB0b2tlbi50cmFuc2Zlck93bmVyc2hpcChfbmV3T3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBvd25lciB0byBhY2NlcHQgYSB0b2tlbiBvd25lcnNoaXAgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gYWNjZXB0VG9rZW5Pd25lcnNoaXAoKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICB0b2tlbi5hY2NlcHRPd25lcnNoaXAoKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRpc2FibGVzL2VuYWJsZXMgdG9rZW4gdHJhbnNmZXJzCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX2Rpc2FibGUgICAgdHJ1ZSB0byBkaXNhYmxlIHRyYW5zZmVycywgZmFsc2UgdG8gZW5hYmxlIHRoZW0KICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5UcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4uZGlzYWJsZVRyYW5zZmVycyhfZGlzYWJsZSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB3aXRoZHJhd3MgdG9rZW5zIGhlbGQgYnkgdGhlIHRva2VuIGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0Zyb21Ub2tlbihJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLndpdGhkcmF3VG9rZW5zKF90b2tlbiwgX3RvLCBfYW1vdW50KTsKICAgIH0KfQoKLyoKICAgIEVSQzIwIFN0YW5kYXJkIFRva2VuIGludGVyZmFjZQoqLwpjb250cmFjdCBJRVJDMjBUb2tlbiB7CiAgICAvLyB0aGVzZSBmdW5jdGlvbnMgYXJlbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBuYW1lKSB7IG5hbWU7IH0KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgc3ltYm9sKSB7IHN5bWJvbDsgfQogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggZGVjaW1hbHMpIHsgZGVjaW1hbHM7IH0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpIHsgdG90YWxTdXBwbHk7IH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgeyBfb3duZXI7IGJhbGFuY2U7IH0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7IF9vd25lcjsgX3NwZW5kZXI7IHJlbWFpbmluZzsgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9CgovKgogICAgRXRoZXIgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElFdGhlclRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHB1YmxpYyBwYXlhYmxlOwogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiB3aXRoZHJhd1RvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpOwp9CgovKgogICAgU21hcnQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgovKgogICAgQmFuY29yIEZvcm11bGEgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElCYW5jb3JGb3JtdWxhIHsKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVB1cmNoYXNlUmV0dXJuKHVpbnQyNTYgX3N1cHBseSwgdWludDI1NiBfcmVzZXJ2ZUJhbGFuY2UsIHVpbnQzMiBfcmVzZXJ2ZVJhdGlvLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTYWxlUmV0dXJuKHVpbnQyNTYgX3N1cHBseSwgdWludDI1NiBfcmVzZXJ2ZUJhbGFuY2UsIHVpbnQzMiBfcmVzZXJ2ZVJhdGlvLCB1aW50MjU2IF9zZWxsQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7Cn0KCi8qCiAgICBFSVAyMjggVG9rZW4gQ2hhbmdlciBpbnRlcmZhY2UKKi8KY29udHJhY3QgSVRva2VuQ2hhbmdlciB7CiAgICBmdW5jdGlvbiBjaGFuZ2VhYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYgY291bnQpOwogICAgZnVuY3Rpb24gY2hhbmdlYWJsZVRva2VuKHVpbnQxNiBfdG9rZW5JbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgdG9rZW5BZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldFJldHVybihJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQpOwogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KTsKfQoKLyoKICAgIE9wZW4gaXNzdWVzOgogICAgLSBBZGQgbWluZXIgZnJvbnQtcnVubmluZyBhdHRhY2sgcHJvdGVjdGlvbi4gVGhlIGlzc3VlIGlzIHNvbWV3aGF0IG1pdGlnYXRlZCBieSB0aGUgdXNlIG9mIF9taW5SZXR1cm4gd2hlbiBjaGFuZ2luZwogICAgLSBQb3NzaWJseSBhZGQgZ2V0dGVycyBmb3IgcmVzZXJ2ZSBmaWVsZHMgc28gdGhhdCB0aGUgY2xpZW50IHdvbid0IG5lZWQgdG8gcmVseSBvbiB0aGUgb3JkZXIgaW4gdGhlIHN0cnVjdAoqLwoKLyoKICAgIEJhbmNvciBDaGFuZ2VyIHYwLjMKCiAgICBUaGUgQmFuY29yIHZlcnNpb24gb2YgdGhlIHRva2VuIGNoYW5nZXIsIGFsbG93cyBjaGFuZ2luZyBiZXR3ZWVuIGEgc21hcnQgdG9rZW4gYW5kIG90aGVyIEVSQzIwIHRva2VucyBhbmQgYmV0d2VlbiBkaWZmZXJlbnQgRVJDMjAgdG9rZW5zIGFuZCB0aGVtc2VsdmVzLgoKICAgIEVSQzIwIHJlc2VydmUgdG9rZW4gYmFsYW5jZSBjYW4gYmUgdmlydHVhbCwgbWVhbmluZyB0aGF0IHRoZSBjYWxjdWxhdGlvbnMgYXJlIGJhc2VkIG9uIHRoZSB2aXJ0dWFsIGJhbGFuY2UgaW5zdGVhZCBvZiByZWx5aW5nIG9uCiAgICB0aGUgYWN0dWFsIHJlc2VydmUgYmFsYW5jZS4gVGhpcyBpcyBhIHNlY3VyaXR5IG1lY2hhbmlzbSB0aGF0IHByZXZlbnRzIHRoZSBuZWVkIHRvIGtlZXAgYSB2ZXJ5IGxhcmdlIChhbmQgdmFsdWFibGUpIGJhbGFuY2UgaW4gYSBzaW5nbGUgY29udHJhY3QuCgogICAgVGhlIGNoYW5nZXIgaXMgdXBncmFkYWJsZSAoanVzdCBsaWtlIGFueSBTbWFydFRva2VuQ29udHJvbGxlcikuCgogICAgQSBub3RlIG9uIGNoYW5nZSBwYXRocyAtCiAgICBDaGFuZ2UgcGF0aCBpcyBhIGRhdGEgc3RydWN0dXJlIHRoYXQncyB1c2VkIHdoZW4gY2hhbmdpbmcgYSB0b2tlbiB0byBhbm90aGVyIHRva2VuIGluIHRoZSBiYW5jb3IgbmV0d29yawogICAgd2hlbiB0aGUgY2hhbmdlIGNhbm5vdCBuZWNlc3NhcmlseSBiZSBkb25lIGJ5IHNpbmdsZSBjaGFuZ2VyIGFuZCBtaWdodCByZXF1aXJlIG11bHRpcGxlICdob3BzJy4KICAgIFRoZSBwYXRoIGRlZmluZXMgd2hpY2ggY2hhbmdlcnMgc2hvdWxkIGJlIHVzZWQgYW5kIHdoYXQga2luZCBvZiBjaGFuZ2Ugc2hvdWxkIGJlIGRvbmUgaW4gZWFjaCBzdGVwLgoKICAgIFRoZSBwYXRoIGZvcm1hdCBkb2Vzbid0IGluY2x1ZGUgY29tcGxleCBzdHJ1Y3R1cmUgYW5kIGluc3RlYWQsIGl0IGlzIHJlcHJlc2VudGVkIGJ5IGEgc2luZ2xlIGFycmF5CiAgICBpbiB3aGljaCBlYWNoICdob3AnIGlzIHJlcHJlc2VudGVkIGJ5IGEgMi10dXBsZSAtIHNtYXJ0IHRva2VuICYgdG8gdG9rZW4uCiAgICBJbiBhZGRpdGlvbiwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgYWx3YXlzIHRoZSBzb3VyY2UgdG9rZW4uCiAgICBUaGUgc21hcnQgdG9rZW4gaXMgb25seSB1c2VkIGFzIGEgcG9pbnRlciB0byBhIGNoYW5nZXIgKHNpbmNlIGNoYW5nZXIgYWRkcmVzc2VzIGFyZSBtb3JlIGxpa2VseSB0byBjaGFuZ2UpLgoKICAgIEZvcm1hdDoKICAgIFtzb3VyY2UgdG9rZW4sIHNtYXJ0IHRva2VuLCB0byB0b2tlbiwgc21hcnQgdG9rZW4sIHRvIHRva2VuLi4uXQoKCiAgICBXQVJOSU5HOiBJdCBpcyBOT1QgUkVDT01NRU5ERUQgdG8gdXNlIHRoZSBjaGFuZ2VyIHdpdGggU21hcnQgVG9rZW5zIHRoYXQgaGF2ZSBsZXNzIHRoYW4gOCBkZWNpbWFsIGRpZ2l0cwogICAgICAgICAgICAgb3Igd2l0aCB2ZXJ5IHNtYWxsIG51bWJlcnMgYmVjYXVzZSBvZiBwcmVjaXNpb24gbG9zcwoqLwpjb250cmFjdCBCYW5jb3JDaGFuZ2VyIGlzIElUb2tlbkNoYW5nZXIsIFNtYXJ0VG9rZW5Db250cm9sbGVyLCBNYW5hZ2VkIHsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9DUlIgPSAxMDAwMDAwOwogICAgdWludDMyIHByaXZhdGUgY29uc3RhbnQgTUFYX0NIQU5HRV9GRUUgPSAxMDAwMDAwOwoKICAgIHN0cnVjdCBSZXNlcnZlIHsKICAgICAgICB1aW50MjU2IHZpcnR1YWxCYWxhbmNlOyAgICAgICAgIC8vIHZpcnR1YWwgYmFsYW5jZQogICAgICAgIHVpbnQzMiByYXRpbzsgICAgICAgICAgICAgICAgICAgLy8gY29uc3RhbnQgcmVzZXJ2ZSByYXRpbyAoQ1JSKSwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBib29sIGlzVmlydHVhbEJhbGFuY2VFbmFibGVkOyAgIC8vIHRydWUgaWYgdmlydHVhbCBiYWxhbmNlIGlzIGVuYWJsZWQsIGZhbHNlIGlmIG5vdAogICAgICAgIGJvb2wgaXNQdXJjaGFzZUVuYWJsZWQ7ICAgICAgICAgLy8gaXMgcHVyY2hhc2Ugb2YgdGhlIHNtYXJ0IHRva2VuIGVuYWJsZWQgd2l0aCB0aGUgcmVzZXJ2ZSwgY2FuIGJlIHNldCBieSB0aGUgb3duZXIKICAgICAgICBib29sIGlzU2V0OyAgICAgICAgICAgICAgICAgICAgIC8vIHVzZWQgdG8gdGVsbCBpZiB0aGUgbWFwcGluZyBlbGVtZW50IGlzIGRlZmluZWQKICAgIH0KCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4zJzsKICAgIHN0cmluZyBwdWJsaWMgY2hhbmdlclR5cGUgPSAnYmFuY29yJzsKCiAgICBJQmFuY29yRm9ybXVsYSBwdWJsaWMgZm9ybXVsYTsgICAgICAgICAgICAgICAgICAvLyBiYW5jb3IgY2FsY3VsYXRpb24gZm9ybXVsYSBjb250cmFjdAogICAgSUVSQzIwVG9rZW5bXSBwdWJsaWMgcmVzZXJ2ZVRva2VuczsgICAgICAgICAgICAgLy8gRVJDMjAgc3RhbmRhcmQgdG9rZW4gYWRkcmVzc2VzCiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyBxdWlja0J1eVBhdGg7ICAgICAgICAgICAgICAvLyBjaGFuZ2UgcGF0aCB0aGF0J3MgdXNlZCBpbiBvcmRlciB0byBidXkgdGhlIHRva2VuIHdpdGggRVRICiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFJlc2VydmUpIHB1YmxpYyByZXNlcnZlczsgICAvLyByZXNlcnZlIHRva2VuIGFkZHJlc3NlcyAtPiByZXNlcnZlIGRhdGEKICAgIHVpbnQzMiBwcml2YXRlIHRvdGFsUmVzZXJ2ZVJhdGlvID0gMDsgICAgICAgICAgIC8vIHVzZWQgdG8gZWZmaWNpZW50bHkgcHJldmVudCBpbmNyZWFzaW5nIHRoZSB0b3RhbCByZXNlcnZlIHJhdGlvIGFib3ZlIDEwMCUKICAgIHVpbnQzMiBwdWJsaWMgbWF4Q2hhbmdlRmVlID0gMDsgICAgICAgICAgICAgICAgIC8vIG1heGltdW0gY2hhbmdlIGZlZSBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBjb250cmFjdCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAwLi4uMTAwMDAwMCAoMCA9IG5vIGZlZSwgMTAwID0gMC4wMSUsIDEwMDAwMDAgPSAxMDAlKQogICAgdWludDMyIHB1YmxpYyBjaGFuZ2VGZWUgPSAwOyAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBjaGFuZ2UgZmVlLCByZXByZXNlbnRlZCBpbiBwcG0sIDAuLi5tYXhDaGFuZ2VGZWUKICAgIGJvb2wgcHVibGljIGNoYW5naW5nRW5hYmxlZCA9IHRydWU7ICAgICAgICAgICAgIC8vIHRydWUgaWYgdG9rZW4gY2hhbmdpbmcgaXMgZW5hYmxlZCwgZmFsc2UgaWYgbm90CgogICAgLy8gdHJpZ2dlcmVkIHdoZW4gYSBjaGFuZ2UgYmV0d2VlbiB0d28gdG9rZW5zIG9jY3VycyAoVG9rZW5DaGFuZ2VyIGV2ZW50KQogICAgZXZlbnQgQ2hhbmdlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbVRva2VuLCBhZGRyZXNzIGluZGV4ZWQgX3RvVG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfdHJhZGVyLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3JldHVybiwKICAgICAgICAgICAgICAgICB1aW50MjU2IF9jdXJyZW50UHJpY2VOLCB1aW50MjU2IF9jdXJyZW50UHJpY2VEKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSAgX3Rva2VuICAgICAgICAgIHNtYXJ0IHRva2VuIGdvdmVybmVkIGJ5IHRoZSBjaGFuZ2VyCiAgICAgICAgQHBhcmFtICBfZm9ybXVsYSAgICAgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBmb3JtdWxhIGNvbnRyYWN0CiAgICAgICAgQHBhcmFtICBfbWF4Q2hhbmdlRmVlICAgbWF4aW11bSBjaGFuZ2UgZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICAgICBAcGFyYW0gIF9yZXNlcnZlVG9rZW4gICBvcHRpb25hbCwgaW5pdGlhbCByZXNlcnZlLCBhbGxvd3MgZGVmaW5pbmcgdGhlIGZpcnN0IHJlc2VydmUgYXQgZGVwbG95bWVudCB0aW1lCiAgICAgICAgQHBhcmFtICBfcmVzZXJ2ZVJhdGlvICAgb3B0aW9uYWwsIHJhdGlvIGZvciB0aGUgaW5pdGlhbCByZXNlcnZlCiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yQ2hhbmdlcihJU21hcnRUb2tlbiBfdG9rZW4sIElCYW5jb3JGb3JtdWxhIF9mb3JtdWxhLCB1aW50MzIgX21heENoYW5nZUZlZSwgSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDMyIF9yZXNlcnZlUmF0aW8pCiAgICAgICAgU21hcnRUb2tlbkNvbnRyb2xsZXIoX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfZm9ybXVsYSkKICAgICAgICB2YWxpZE1heENoYW5nZUZlZShfbWF4Q2hhbmdlRmVlKQogICAgewogICAgICAgIGZvcm11bGEgPSBfZm9ybXVsYTsKICAgICAgICBtYXhDaGFuZ2VGZWUgPSBfbWF4Q2hhbmdlRmVlOwoKICAgICAgICBpZiAoYWRkcmVzcyhfcmVzZXJ2ZVRva2VuKSAhPSAweDApCiAgICAgICAgICAgIGFkZFJlc2VydmUoX3Jlc2VydmVUb2tlbiwgX3Jlc2VydmVSYXRpbywgZmFsc2UpOwogICAgfQoKICAgIC8vIHZhbGlkYXRlcyBhIHJlc2VydmUgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIHJlc2VydmUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFJlc2VydmUoSUVSQzIwVG9rZW4gX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKHJlc2VydmVzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgY2hhbmdlYWJsZSB0b2tlbnMKICAgIG1vZGlmaWVyIHZhbGlkVG9rZW4oSUVSQzIwVG9rZW4gX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzID09IHRva2VuIHx8IHJlc2VydmVzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgbWF4aW11bSBjaGFuZ2UgZmVlCiAgICBtb2RpZmllciB2YWxpZE1heENoYW5nZUZlZSh1aW50MzIgX2NoYW5nZUZlZSkgewogICAgICAgIHJlcXVpcmUoX2NoYW5nZUZlZSA+PSAwICYmIF9jaGFuZ2VGZWUgPD0gTUFYX0NIQU5HRV9GRUUpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGNoYW5nZSBmZWUKICAgIG1vZGlmaWVyIHZhbGlkQ2hhbmdlRmVlKHVpbnQzMiBfY2hhbmdlRmVlKSB7CiAgICAgICAgcmVxdWlyZShfY2hhbmdlRmVlID49IDAgJiYgX2NoYW5nZUZlZSA8PSBtYXhDaGFuZ2VGZWUpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIHJlc2VydmUgcmF0aW8gcmFuZ2UKICAgIG1vZGlmaWVyIHZhbGlkUmVzZXJ2ZVJhdGlvKHVpbnQzMiBfcmF0aW8pIHsKICAgICAgICByZXF1aXJlKF9yYXRpbyA+IDAgJiYgX3JhdGlvIDw9IE1BWF9DUlIpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGEgY2hhbmdlIHBhdGggLSB2ZXJpZmllcyB0aGF0IHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaXMgb2RkIGFuZCB0aGF0IG1heGltdW0gbnVtYmVyIG9mICdob3BzJyBpcyAxMAogICAgbW9kaWZpZXIgdmFsaWRDaGFuZ2VQYXRoKElFUkMyMFRva2VuW10gX3BhdGgpIHsKICAgICAgICByZXF1aXJlKF9wYXRoLmxlbmd0aCA+IDIgJiYgX3BhdGgubGVuZ3RoIDw9ICgxICsgMiAqIDEwKSAmJiBfcGF0aC5sZW5ndGggJSAyID09IDEpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBvbmx5IHdoZW4gY2hhbmdpbmcgaXNuJ3QgZGlzYWJsZWQKICAgIG1vZGlmaWVyIGNoYW5naW5nQWxsb3dlZCB7CiAgICAgICAgYXNzZXJ0KGNoYW5naW5nRW5hYmxlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIG51bWJlciBvZiByZXNlcnZlIHRva2VucyBkZWZpbmVkCgogICAgICAgIEByZXR1cm4gbnVtYmVyIG9mIHJlc2VydmUgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gcmVzZXJ2ZVRva2VuQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQxNihyZXNlcnZlVG9rZW5zLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBudW1iZXIgb2YgY2hhbmdlYWJsZSB0b2tlbnMgc3VwcG9ydGVkIGJ5IHRoZSBjb250cmFjdAogICAgICAgIG5vdGUgdGhhdCB0aGUgbnVtYmVyIG9mIGNoYW5nZWFibGUgdG9rZW5zIGlzIHRoZSBudW1iZXIgb2YgcmVzZXJ2ZSB0b2tlbiwgcGx1cyAxICh0aGF0IHJlcHJlc2VudHMgdGhlIHNtYXJ0IHRva2VuKQoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjaGFuZ2VhYmxlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZWFibGVUb2tlbkNvdW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNiBjb3VudCkgewogICAgICAgIHJldHVybiByZXNlcnZlVG9rZW5Db3VudCgpICsgMTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGdpdmVuIGEgY2hhbmdlYWJsZSB0b2tlbiBpbmRleCwgcmV0dXJucyB0aGUgY2hhbmdlYWJsZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfdG9rZW5JbmRleCAgY2hhbmdlYWJsZSB0b2tlbiBpbmRleAoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjaGFuZ2VhYmxlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZWFibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHRva2VuQWRkcmVzcykgewogICAgICAgIGlmIChfdG9rZW5JbmRleCA9PSAwKQogICAgICAgICAgICByZXR1cm4gdG9rZW47CiAgICAgICAgcmV0dXJuIHJlc2VydmVUb2tlbnNbX3Rva2VuSW5kZXggLSAxXTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIGZvcm11bGEgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2Zvcm11bGEgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBmb3JtdWxhIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2V0Rm9ybXVsYShJQmFuY29yRm9ybXVsYSBfZm9ybXVsYSkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX2Zvcm11bGEpCiAgICAgICAgbm90VGhpcyhfZm9ybXVsYSkKICAgIHsKICAgICAgICBmb3JtdWxhID0gX2Zvcm11bGE7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgbWFuYWdlciB0byB1cGRhdGUgdGhlIHF1aWNrIGJ1eSBwYXRoCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICBuZXcgcXVpY2sgYnV5IHBhdGgsIHNlZSBjaGFuZ2UgcGF0aCBmb3JtYXQgYWJvdmUKICAgICovCiAgICBmdW5jdGlvbiBzZXRRdWlja0J1eVBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZENoYW5nZVBhdGgoX3BhdGgpCiAgICB7CiAgICAgICAgcXVpY2tCdXlQYXRoID0gX3BhdGg7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgbWFuYWdlciB0byBjbGVhciB0aGUgcXVpY2sgYnV5IHBhdGgKICAgICovCiAgICBmdW5jdGlvbiBjbGVhclF1aWNrQnV5UGF0aCgpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHF1aWNrQnV5UGF0aC5sZW5ndGggPSAwOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBxdWljayBidXkgcGF0aCBhcnJheQoKICAgICAgICBAcmV0dXJuIHF1aWNrIGJ1eSBwYXRoIGxlbmd0aAogICAgKi8KICAgIGZ1bmN0aW9uIGdldFF1aWNrQnV5UGF0aExlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGxlbmd0aCkgewogICAgICAgIHJldHVybiBxdWlja0J1eVBhdGgubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0cnVlIGlmIGV0aGVyIHRva2VuIGV4aXN0cyBpbiB0aGUgcXVpY2sgYnV5IHBhdGgsIGZhbHNlIGlmIG5vdAogICAgICAgIG5vdGUgdGhhdCB0aGVyZSBzaG91bGQgYWx3YXlzIGJlIG9uZSBpbiB0aGUgcXVpY2sgYnV5IHBhdGgsIGlmIG9uZSBpcyBzZXQKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIGV0aGVyIHRva2VuIGV4aXN0cywgZmFsc2UgaWYgbm90CiAgICAqLwogICAgZnVuY3Rpb24gaGFzUXVpY2tCdXlFdGhlclRva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcXVpY2tCdXlQYXRoLmxlbmd0aCA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBhZGRyZXNzIG9mIHRoZSBldGhlciB0b2tlbiB1c2VkIGJ5IHRoZSBxdWljayBidXkgZnVuY3Rpb25hbGl0eQogICAgICAgIG5vdGUgdGhhdCBpdCBzaG91bGQgYWx3YXlzIGJlIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBxdWljayBidXkgcGF0aCwgaWYgb25lIGlzIHNldAoKICAgICAgICBAcmV0dXJuIGV0aGVyIHRva2VuIGFkZHJlc3MKICAgICovCiAgICBmdW5jdGlvbiBnZXRRdWlja0J1eUV0aGVyVG9rZW4oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoSUV0aGVyVG9rZW4gZXRoZXJUb2tlbikgewogICAgICAgIGFzc2VydChxdWlja0J1eVBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgcmV0dXJuIElFdGhlclRva2VuKHF1aWNrQnV5UGF0aFswXSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcyB0aGUgZW50aXJlIGNoYW5nZSBmdW5jdGlvbmFsaXR5CiAgICAgICAgdGhpcyBpcyBhIHNhZmV0eSBtZWNoYW5pc20gaW4gY2FzZSBvZiBhIGVtZXJnZW5jeQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX2Rpc2FibGUgdHJ1ZSB0byBkaXNhYmxlIGNoYW5naW5nLCBmYWxzZSB0byByZS1lbmFibGUgaXQKICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQ2hhbmdpbmcoYm9vbCBfZGlzYWJsZSkgcHVibGljIG1hbmFnZXJPbmx5IHsKICAgICAgICBjaGFuZ2luZ0VuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1cGRhdGVzIHRoZSBjdXJyZW50IGNoYW5nZSBmZWUKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9jaGFuZ2VGZWUgbmV3IGNoYW5nZSBmZWUsIHJlcHJlc2VudGVkIGluIHBwbQogICAgKi8KICAgIGZ1bmN0aW9uIHNldENoYW5nZUZlZSh1aW50MzIgX2NoYW5nZUZlZSkKICAgICAgICBwdWJsaWMKICAgICAgICBtYW5hZ2VyT25seQogICAgICAgIHZhbGlkQ2hhbmdlRmVlKF9jaGFuZ2VGZWUpCiAgICB7CiAgICAgICAgY2hhbmdlRmVlID0gX2NoYW5nZUZlZTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgY2hhbmdlIGZlZSBhbW91bnQgZm9yIGEgZ2l2ZW4gcmV0dXJuIGFtb3VudAoKICAgICAgICBAcmV0dXJuIGNoYW5nZSBmZWUgYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0Q2hhbmdlRmVlQW1vdW50KHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgZmVlQW1vdW50KSB7CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2Ftb3VudCwgY2hhbmdlRmVlKSAvIE1BWF9DSEFOR0VfRkVFOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGVmaW5lcyBhIG5ldyByZXNlcnZlIGZvciB0aGUgdG9rZW4KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIHdoaWxlIHRoZSBjaGFuZ2VyIGlzIGluYWN0aXZlCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICBhZGRyZXNzIG9mIHRoZSByZXNlcnZlIHRva2VuCiAgICAgICAgQHBhcmFtIF9yYXRpbyAgICAgICAgICAgICAgICAgIGNvbnN0YW50IHJlc2VydmUgcmF0aW8sIHJlcHJlc2VudGVkIGluIHBwbSwgMS0xMDAwMDAwCiAgICAgICAgQHBhcmFtIF9lbmFibGVWaXJ0dWFsQmFsYW5jZSAgIHRydWUgdG8gZW5hYmxlIHZpcnR1YWwgYmFsYW5jZSBmb3IgdGhlIHJlc2VydmUsIGZhbHNlIHRvIGRpc2FibGUgaXQKICAgICovCiAgICBmdW5jdGlvbiBhZGRSZXNlcnZlKElFUkMyMFRva2VuIF90b2tlbiwgdWludDMyIF9yYXRpbywgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgaW5hY3RpdmUKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgICAgIG5vdFRoaXMoX3Rva2VuKQogICAgICAgIHZhbGlkUmVzZXJ2ZVJhdGlvKF9yYXRpbykKICAgIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSB0b2tlbiAmJiAhcmVzZXJ2ZXNbX3Rva2VuXS5pc1NldCAmJiB0b3RhbFJlc2VydmVSYXRpbyArIF9yYXRpbyA8PSBNQVhfQ1JSKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS52aXJ0dWFsQmFsYW5jZSA9IDA7CiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS5yYXRpbyA9IF9yYXRpbzsKICAgICAgICByZXNlcnZlc1tfdG9rZW5dLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkID0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlOwogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSB0cnVlOwogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNTZXQgPSB0cnVlOwogICAgICAgIHJlc2VydmVUb2tlbnMucHVzaChfdG9rZW4pOwogICAgICAgIHRvdGFsUmVzZXJ2ZVJhdGlvICs9IF9yYXRpbzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVwZGF0ZXMgb25lIG9mIHRoZSB0b2tlbiByZXNlcnZlcwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgICAgICAgIGFkZHJlc3Mgb2YgdGhlIHJlc2VydmUgdG9rZW4KICAgICAgICBAcGFyYW0gX3JhdGlvICAgICAgICAgICAgICAgICAgY29uc3RhbnQgcmVzZXJ2ZSByYXRpbywgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgcmVzZXJ2ZSwgZmFsc2UgdG8gZGlzYWJsZSBpdAogICAgICAgIEBwYXJhbSBfdmlydHVhbEJhbGFuY2UgICAgICAgICBuZXcgcmVzZXJ2ZSdzIHZpcnR1YWwgYmFsYW5jZQogICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZVJlc2VydmUoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDMyIF9yYXRpbywgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UsIHVpbnQyNTYgX3ZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHZhbGlkUmVzZXJ2ZVJhdGlvKF9yYXRpbykKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHJlcXVpcmUodG90YWxSZXNlcnZlUmF0aW8gLSByZXNlcnZlLnJhdGlvICsgX3JhdGlvIDw9IE1BWF9DUlIpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB0b3RhbFJlc2VydmVSYXRpbyA9IHRvdGFsUmVzZXJ2ZVJhdGlvIC0gcmVzZXJ2ZS5yYXRpbyArIF9yYXRpbzsKICAgICAgICByZXNlcnZlLnJhdGlvID0gX3JhdGlvOwogICAgICAgIHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7CiAgICAgICAgcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA9IF92aXJ0dWFsQmFsYW5jZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRpc2FibGVzIHB1cmNoYXNpbmcgd2l0aCB0aGUgZ2l2ZW4gcmVzZXJ2ZSB0b2tlbiBpbiBjYXNlIHRoZSByZXNlcnZlIHRva2VuIGdvdCBjb21wcm9taXNlZAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgICAgICBub3RlIHRoYXQgc2VsbGluZyBpcyBzdGlsbCBlbmFibGVkIHJlZ2FyZGxlc3Mgb2YgdGhpcyBmbGFnIGFuZCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfZGlzYWJsZSAgICAgICAgIHRydWUgdG8gZGlzYWJsZSB0aGUgdG9rZW4sIGZhbHNlIHRvIHJlLWVuYWJsZSBpdAogICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVSZXNlcnZlUHVyY2hhc2VzKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIGJvb2wgX2Rpc2FibGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pCiAgICB7CiAgICAgICAgcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSByZXNlcnZlJ3MgdmlydHVhbCBiYWxhbmNlIGlmIG9uZSBpcyBkZWZpbmVkLCBvdGhlcndpc2UgcmV0dXJucyB0aGUgYWN0dWFsIGJhbGFuY2UKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgcmVzZXJ2ZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gcmVzZXJ2ZSBiYWxhbmNlCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZUJhbGFuY2UoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHJldHVybiByZXNlcnZlLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkID8gcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA6IF9yZXNlcnZlVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBjaGFuZ2luZyBhIHNwZWNpZmljIGFtb3VudCBvZiBfZnJvbVRva2VuIHRvIF90b1Rva2VuCgogICAgICAgIEBwYXJhbSBfZnJvbVRva2VuICBFUkMyMCB0b2tlbiB0byBjaGFuZ2UgZnJvbQogICAgICAgIEBwYXJhbSBfdG9Ub2tlbiAgICBFUkMyMCB0b2tlbiB0byBjaGFuZ2UgdG8KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGNoYW5nZSwgaW4gZnJvbVRva2VuCgogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgY2hhbmdlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRSZXR1cm4oSUVSQzIwVG9rZW4gX2Zyb21Ub2tlbiwgSUVSQzIwVG9rZW4gX3RvVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfZnJvbVRva2VuICE9IF90b1Rva2VuKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgLy8gY2hhbmdlIGJldHdlZW4gdGhlIHRva2VuIGFuZCBvbmUgb2YgaXRzIHJlc2VydmVzCiAgICAgICAgaWYgKF90b1Rva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gZ2V0UHVyY2hhc2VSZXR1cm4oX2Zyb21Ub2tlbiwgX2Ftb3VudCk7CiAgICAgICAgZWxzZSBpZiAoX2Zyb21Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3RvVG9rZW4sIF9hbW91bnQpOwoKICAgICAgICAvLyBjaGFuZ2UgYmV0d2VlbiAyIHJlc2VydmVzCiAgICAgICAgdWludDI1NiBwdXJjaGFzZVJldHVybkFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9mcm9tVG9rZW4sIF9hbW91bnQpOwogICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBwdXJjaGFzZVJldHVybkFtb3VudCwgc2FmZUFkZCh0b2tlbi50b3RhbFN1cHBseSgpLCBwdXJjaGFzZVJldHVybkFtb3VudCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBidXlpbmcgdGhlIHRva2VuIGZvciBhIHJlc2VydmUgdG9rZW4KCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBwdXJjaGFzZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHVyY2hhc2VSZXR1cm4oSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDI1NiBfZGVwb3NpdEFtb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIGFjdGl2ZQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIFJlc2VydmUgc3RvcmFnZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07CiAgICAgICAgcmVxdWlyZShyZXNlcnZlLmlzUHVyY2hhc2VFbmFibGVkKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgdWludDI1NiB0b2tlblN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgdWludDI1NiByZXNlcnZlQmFsYW5jZSA9IGdldFJlc2VydmVCYWxhbmNlKF9yZXNlcnZlVG9rZW4pOwogICAgICAgIGFtb3VudCA9IGZvcm11bGEuY2FsY3VsYXRlUHVyY2hhc2VSZXR1cm4odG9rZW5TdXBwbHksIHJlc2VydmVCYWxhbmNlLCByZXNlcnZlLnJhdGlvLCBfZGVwb3NpdEFtb3VudCk7CgogICAgICAgIC8vIGRlZHVjdCB0aGUgZmVlIGZyb20gdGhlIHJldHVybiBhbW91bnQKICAgICAgICB1aW50MjU2IGZlZUFtb3VudCA9IGdldENoYW5nZUZlZUFtb3VudChhbW91bnQpOwogICAgICAgIHJldHVybiBzYWZlU3ViKGFtb3VudCwgZmVlQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3Igc2VsbGluZyB0aGUgdG9rZW4gZm9yIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCgogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsKICAgICAgICByZXR1cm4gZ2V0U2FsZVJldHVybihfcmVzZXJ2ZVRva2VuLCBfc2VsbEFtb3VudCwgdG9rZW4udG90YWxTdXBwbHkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjaGFuZ2VzIGEgc3BlY2lmaWMgYW1vdW50IG9mIF9mcm9tVG9rZW4gdG8gX3RvVG9rZW4KCiAgICAgICAgQHBhcmFtIF9mcm9tVG9rZW4gIEVSQzIwIHRva2VuIHRvIGNoYW5nZSBmcm9tCiAgICAgICAgQHBhcmFtIF90b1Rva2VuICAgIEVSQzIwIHRva2VuIHRvIGNoYW5nZSB0bwogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gY2hhbmdlLCBpbiBmcm9tVG9rZW4KICAgICAgICBAcGFyYW0gX21pblJldHVybiAgaWYgdGhlIGNoYW5nZSByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBjaGFuZ2UgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2IGFtb3VudCkgewogICAgICAgIHJlcXVpcmUoX2Zyb21Ub2tlbiAhPSBfdG9Ub2tlbik7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIC8vIGNoYW5nZSBiZXR3ZWVuIHRoZSB0b2tlbiBhbmQgb25lIG9mIGl0cyByZXNlcnZlcwogICAgICAgIGlmIChfdG9Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGJ1eShfZnJvbVRva2VuLCBfYW1vdW50LCBfbWluUmV0dXJuKTsKICAgICAgICBlbHNlIGlmIChfZnJvbVRva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gc2VsbChfdG9Ub2tlbiwgX2Ftb3VudCwgX21pblJldHVybik7CgogICAgICAgIC8vIGNoYW5nZSBiZXR3ZWVuIDIgcmVzZXJ2ZXMKICAgICAgICB1aW50MjU2IHB1cmNoYXNlQW1vdW50ID0gYnV5KF9mcm9tVG9rZW4sIF9hbW91bnQsIDEpOwogICAgICAgIHJldHVybiBzZWxsKF90b1Rva2VuLCBwdXJjaGFzZUFtb3VudCwgX21pblJldHVybik7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBidXlzIHRoZSB0b2tlbiBieSBkZXBvc2l0aW5nIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgIGlmIHRoZSBjaGFuZ2UgcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gYnV5IHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBidXkoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDI1NiBfZGVwb3NpdEFtb3VudCwgdWludDI1NiBfbWluUmV0dXJuKQogICAgICAgIHB1YmxpYwogICAgICAgIGNoYW5naW5nQWxsb3dlZAogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfbWluUmV0dXJuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIGFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9yZXNlcnZlVG9rZW4sIF9kZXBvc2l0QW1vdW50KTsKICAgICAgICBhc3NlcnQoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIFJlc2VydmUgc3RvcmFnZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07CiAgICAgICAgaWYgKHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQpCiAgICAgICAgICAgIHJlc2VydmUudmlydHVhbEJhbGFuY2UgPSBzYWZlQWRkKHJlc2VydmUudmlydHVhbEJhbGFuY2UsIF9kZXBvc2l0QW1vdW50KTsKCiAgICAgICAgLy8gdHJhbnNmZXIgX2RlcG9zaXRBbW91bnQgZnVuZHMgZnJvbSB0aGUgY2FsbGVyIGluIHRoZSByZXNlcnZlIHRva2VuCiAgICAgICAgLy8gbm90ZSB0aGF0IHRoZXJlJ3Mgbm8gbmVlZCB0byBleGVjdXRlIHRoZSB0cmFuc2ZlciBpZiB0aGUgc2VuZGVyIGlzIHRoZSBsb2NhbCBjb250cmFjdAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpCiAgICAgICAgICAgIGFzc2VydChfcmVzZXJ2ZVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfZGVwb3NpdEFtb3VudCkpOwogICAgICAgIC8vIGlzc3VlIG5ldyBmdW5kcyB0byB0aGUgY2FsbGVyIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgIHRva2VuLmlzc3VlKG1zZy5zZW5kZXIsIGFtb3VudCk7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgbmV3IHByaWNlIHVzaW5nIHRoZSBzaW1wbGUgcHJpY2UgZm9ybXVsYQogICAgICAgIC8vIHByaWNlID0gcmVzZXJ2ZSBiYWxhbmNlIC8gKHN1cHBseSAqIENSUikKICAgICAgICAvLyBDUlIgaXMgcmVwcmVzZW50ZWQgaW4gcHBtLCBzbyBtdWx0aXBseWluZyBieSAxMDAwMDAwCiAgICAgICAgdWludDI1NiByZXNlcnZlQW1vdW50ID0gc2FmZU11bChnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKSwgTUFYX0NSUik7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IHNhZmVNdWwodG9rZW4udG90YWxTdXBwbHkoKSwgcmVzZXJ2ZS5yYXRpbyk7CiAgICAgICAgQ2hhbmdlKF9yZXNlcnZlVG9rZW4sIHRva2VuLCBtc2cuc2VuZGVyLCBfZGVwb3NpdEFtb3VudCwgYW1vdW50LCByZXNlcnZlQW1vdW50LCB0b2tlbkFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHNlbGxzIHRoZSB0b2tlbiBieSB3aXRoZHJhd2luZyBmcm9tIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICAgICBpZiB0aGUgY2hhbmdlIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBzZWxsIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBzZWxsKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICBjaGFuZ2luZ0FsbG93ZWQKICAgICAgICBncmVhdGVyVGhhblplcm8oX21pblJldHVybikKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICByZXF1aXJlKF9zZWxsQW1vdW50IDw9IHRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKSk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIGFtb3VudCA9IGdldFNhbGVSZXR1cm4oX3Jlc2VydmVUb2tlbiwgX3NlbGxBbW91bnQpOwogICAgICAgIGFzc2VydChhbW91bnQgIT0gMCAmJiBhbW91bnQgPj0gX21pblJldHVybik7IC8vIGVuc3VyZSB0aGUgdHJhZGUgZ2l2ZXMgc29tZXRoaW5nIGluIHJldHVybiBhbmQgbWVldHMgdGhlIG1pbmltdW0gcmVxdWVzdGVkIGFtb3VudAoKICAgICAgICB1aW50MjU2IHRva2VuU3VwcGx5ID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IHJlc2VydmVCYWxhbmNlID0gZ2V0UmVzZXJ2ZUJhbGFuY2UoX3Jlc2VydmVUb2tlbik7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIHRyYWRlIHdpbGwgb25seSBkZXBsZXRlIHRoZSByZXNlcnZlIGlmIHRoZSB0b3RhbCBzdXBwbHkgaXMgZGVwbGV0ZWQgYXMgd2VsbAogICAgICAgIGFzc2VydChhbW91bnQgPCByZXNlcnZlQmFsYW5jZSB8fCAoYW1vdW50ID09IHJlc2VydmVCYWxhbmNlICYmIF9zZWxsQW1vdW50ID09IHRva2VuU3VwcGx5KSk7CgogICAgICAgIC8vIHVwZGF0ZSB2aXJ0dWFsIGJhbGFuY2UgaWYgcmVsZXZhbnQKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIGlmIChyZXNlcnZlLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICByZXNlcnZlLnZpcnR1YWxCYWxhbmNlID0gc2FmZVN1YihyZXNlcnZlLnZpcnR1YWxCYWxhbmNlLCBhbW91bnQpOwoKICAgICAgICAvLyBkZXN0cm95IF9zZWxsQW1vdW50IGZyb20gdGhlIGNhbGxlcidzIGJhbGFuY2UgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfc2VsbEFtb3VudCk7CiAgICAgICAgLy8gdHJhbnNmZXIgZnVuZHMgdG8gdGhlIGNhbGxlciBpbiB0aGUgcmVzZXJ2ZSB0b2tlbgogICAgICAgIC8vIHRoZSB0cmFuc2ZlciBtaWdodCBmYWlsIGlmIHRoZSBhY3R1YWwgcmVzZXJ2ZSBiYWxhbmNlIGlzIHNtYWxsZXIgdGhhbiB0aGUgdmlydHVhbCBiYWxhbmNlCiAgICAgICAgLy8gbm90ZSB0aGF0IHRoZXJlJ3Mgbm8gbmVlZCB0byBleGVjdXRlIHRoZSB0cmFuc2ZlciBpZiB0aGUgc2VuZGVyIGlzIHRoZSBsb2NhbCBjb250cmFjdAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpCiAgICAgICAgICAgIGFzc2VydChfcmVzZXJ2ZVRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCkpOwoKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG5ldyBwcmljZSB1c2luZyB0aGUgc2ltcGxlIHByaWNlIGZvcm11bGEKICAgICAgICAvLyBwcmljZSA9IHJlc2VydmUgYmFsYW5jZSAvIChzdXBwbHkgKiBDUlIpCiAgICAgICAgLy8gQ1JSIGlzIHJlcHJlc2VudGVkIGluIHBwbSwgc28gbXVsdGlwbHlpbmcgYnkgMTAwMDAwMAogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUFtb3VudCA9IHNhZmVNdWwoZ2V0UmVzZXJ2ZUJhbGFuY2UoX3Jlc2VydmVUb2tlbiksIE1BWF9DUlIpOwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuLnRvdGFsU3VwcGx5KCksIHJlc2VydmUucmF0aW8pOwogICAgICAgIENoYW5nZSh0b2tlbiwgX3Jlc2VydmVUb2tlbiwgbXNnLnNlbmRlciwgX3NlbGxBbW91bnQsIGFtb3VudCwgdG9rZW5BbW91bnQsIHJlc2VydmVBbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjaGFuZ2VzIHRoZSB0b2tlbiB0byBhbnkgb3RoZXIgdG9rZW4gaW4gdGhlIGJhbmNvciBuZXR3b3JrIGJ5IGZvbGxvd2luZyBhIHByZWRlZmluZWQgY2hhbmdlIHBhdGgKICAgICAgICBub3RlIHRoYXQgd2hlbiBjaGFuZ2luZyBmcm9tIGFuIEVSQzIwIHRva2VuIChhcyBvcHBvc2VkIHRvIGEgc21hcnQgdG9rZW4pLCBhbGxvd2FuY2UgbXVzdCBiZSBzZXQgYmVmb3JlaGFuZAoKICAgICAgICBAcGFyYW0gX3BhdGggICAgICAgIGNoYW5nZSBwYXRoLCBzZWUgY2hhbmdlIHBhdGggZm9ybWF0IGFib3ZlCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgICBhbW91bnQgdG8gY2hhbmdlIGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjaGFuZ2UgcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gdG9rZW5zIGlzc3VlZCBpbiByZXR1cm4KICAgICovCiAgICBmdW5jdGlvbiBxdWlja0NoYW5nZShJRVJDMjBUb2tlbltdIF9wYXRoLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZENoYW5nZVBhdGgoX3BhdGgpCiAgICAgICAgcmV0dXJucyAodWludDI1NiBhbW91bnQpCiAgICB7CiAgICAgICAgLy8gd2UgbmVlZCB0byB0cmFuc2ZlciB0aGUgdG9rZW5zIGZyb20gdGhlIGNhbGxlciB0byB0aGUgbG9jYWwgY29udHJhY3QgYmVmb3JlIHdlCiAgICAgICAgLy8gZm9sbG93IHRoZSBjaGFuZ2UgcGF0aCwgdG8gYWxsb3cgaXQgdG8gZXhlY3V0ZSB0aGUgY2hhbmdlIG9uIGJlaGFsZiBvZiB0aGUgY2FsbGVyCiAgICAgICAgSUVSQzIwVG9rZW4gZnJvbVRva2VuID0gX3BhdGhbMF07CiAgICAgICAgY2xhaW1Ub2tlbnMoZnJvbVRva2VuLCBtc2cuc2VuZGVyLCBfYW1vdW50KTsKCiAgICAgICAgSVNtYXJ0VG9rZW4gc21hcnRUb2tlbjsKICAgICAgICBJRVJDMjBUb2tlbiB0b1Rva2VuOwogICAgICAgIEJhbmNvckNoYW5nZXIgY2hhbmdlcjsKICAgICAgICB1aW50MjU2IHBhdGhMZW5ndGggPSBfcGF0aC5sZW5ndGg7CgogICAgICAgIC8vIGl0ZXJhdGUgb3ZlciB0aGUgY2hhbmdlIHBhdGgKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDE7IGkgPCBwYXRoTGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICAgICAgc21hcnRUb2tlbiA9IElTbWFydFRva2VuKF9wYXRoW2ldKTsKICAgICAgICAgICAgdG9Ub2tlbiA9IF9wYXRoW2kgKyAxXTsKICAgICAgICAgICAgY2hhbmdlciA9IEJhbmNvckNoYW5nZXIoc21hcnRUb2tlbi5vd25lcigpKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBzbWFydCB0b2tlbiBpc24ndCB0aGUgc291cmNlIChmcm9tIHRva2VuKSwgdGhlIGNoYW5nZXIgZG9lc24ndCBoYXZlIGNvbnRyb2wgb3ZlciBpdCBhbmQgdGh1cyB3ZSBuZWVkIHRvIGFwcHJvdmUgdGhlIHJlcXVlc3QKICAgICAgICAgICAgaWYgKHNtYXJ0VG9rZW4gIT0gZnJvbVRva2VuKQogICAgICAgICAgICAgICAgZW5zdXJlQWxsb3dhbmNlKGZyb21Ub2tlbiwgY2hhbmdlciwgX2Ftb3VudCk7CgogICAgICAgICAgICAvLyBtYWtlIHRoZSBjaGFuZ2UgLSBpZiBpdCdzIHRoZSBsYXN0IG9uZSwgYWxzbyBwcm92aWRlIHRoZSBtaW5pbXVtIHJldHVybiB2YWx1ZQogICAgICAgICAgICBfYW1vdW50ID0gY2hhbmdlci5jaGFuZ2UoZnJvbVRva2VuLCB0b1Rva2VuLCBfYW1vdW50LCBpID09IHBhdGhMZW5ndGggLSAyID8gX21pblJldHVybiA6IDEpOwogICAgICAgICAgICBmcm9tVG9rZW4gPSB0b1Rva2VuOwogICAgICAgIH0KCiAgICAgICAgLy8gZmluaXNoZWQgdGhlIGNoYW5nZSwgdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgdG8gdGhlIGNhbGxlcgogICAgICAgIC8vIGlmIHRoZSBsYXN0IGNoYW5nZSByZXN1bHRlZCBpbiBldGhlciB0b2tlbnMsIHdpdGhkcmF3IHRoZW0gYW5kIHNlbmQgdGhlbSBhcyBFVEggdG8gdGhlIGNhbGxlcgogICAgICAgIGlmIChjaGFuZ2VyLmhhc1F1aWNrQnV5RXRoZXJUb2tlbigpICYmIGNoYW5nZXIuZ2V0UXVpY2tCdXlFdGhlclRva2VuKCkgPT0gdG9Ub2tlbikgewogICAgICAgICAgICBJRXRoZXJUb2tlbiBldGhlclRva2VuID0gSUV0aGVyVG9rZW4odG9Ub2tlbik7CiAgICAgICAgICAgIGV0aGVyVG9rZW4ud2l0aGRyYXdUbyhtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgLy8gbm8gbmVlZCB0byB0cmFuc2ZlciB0aGUgdG9rZW5zIGlmIHRoZSBzZW5kZXIgaXMgdGhlIGxvY2FsIGNvbnRyYWN0CiAgICAgICAgZWxzZSBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIC8vIG5vdCBFVEgsIHRyYW5zZmVyIHRoZSB0b2tlbnMgdG8gdGhlIGNhbGxlcgogICAgICAgICAgICBhc3NlcnQodG9Ub2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBfYW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2Ftb3VudDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGJ1eXMgdGhlIHNtYXJ0IHRva2VuIHdpdGggRVRIIGlmIHRoZSByZXR1cm4gYW1vdW50IG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZAogICAgICAgIG5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGNhbiBldmVudHVhbGx5IGJlIG1vdmVkIGludG8gYSBzZXBhcmF0ZSBjb250cmFjdAoKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgaWYgdGhlIGNoYW5nZSByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiB0b2tlbnMgaXNzdWVkIGluIHJldHVybgogICAgKi8KICAgIGZ1bmN0aW9uIHF1aWNrQnV5KHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsKICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgcXVpY2sgYnV5IHBhdGggd2FzIHNldAogICAgICAgIGFzc2VydChxdWlja0J1eVBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgLy8gZ2V0IHRoZSBldGhlciB0b2tlbgogICAgICAgIElFdGhlclRva2VuIGV0aGVyVG9rZW4gPSBnZXRRdWlja0J1eUV0aGVyVG9rZW4oKTsKICAgICAgICAvLyBkZXBvc2l0IEVUSCBpbiB0aGUgZXRoZXIgdG9rZW4KICAgICAgICBldGhlclRva2VuLmRlcG9zaXQudmFsdWUobXNnLnZhbHVlKSgpOwogICAgICAgIC8vIGV4ZWN1dGUgdGhlIGNoYW5nZQogICAgICAgIHVpbnQyNTYgcmV0dXJuQW1vdW50ID0gdGhpcy5xdWlja0NoYW5nZShxdWlja0J1eVBhdGgsIG1zZy52YWx1ZSwgX21pblJldHVybik7CiAgICAgICAgLy8gZ2V0IHRoZSB0YXJnZXQgdG9rZW4KICAgICAgICBJRVJDMjBUb2tlbiB0b1Rva2VuID0gcXVpY2tCdXlQYXRoW3F1aWNrQnV5UGF0aC5sZW5ndGggLSAxXTsKICAgICAgICAvLyB0cmFuc2ZlciB0aGUgdG9rZW5zIHRvIHRoZSBjYWxsZXIKICAgICAgICBhc3NlcnQodG9Ub2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCByZXR1cm5BbW91bnQpKTsKICAgICAgICByZXR1cm4gcmV0dXJuQW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyByZXNlcnZlIHRva2VucywgZ2l2ZW4gYSB0b3RhbCBzdXBwbHkgb3ZlcnJpZGUKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF90b3RhbFN1cHBseSAgICB0b3RhbCB0b2tlbiBzdXBwbHksIG92ZXJyaWRlcyB0aGUgYWN0dWFsIHRva2VuIHRvdGFsIHN1cHBseSB3aGVuIGNhbGN1bGF0aW5nIHRoZSByZXR1cm4KCiAgICAgICAgQHJldHVybiBzYWxlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRTYWxlUmV0dXJuKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX3RvdGFsU3VwcGx5KQogICAgICAgIHByaXZhdGUKICAgICAgICBjb25zdGFudAogICAgICAgIGFjdGl2ZQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfdG90YWxTdXBwbHkpCiAgICAgICAgcmV0dXJucyAodWludDI1NiBhbW91bnQpCiAgICB7CiAgICAgICAgUmVzZXJ2ZSBzdG9yYWdlIHJlc2VydmUgPSByZXNlcnZlc1tfcmVzZXJ2ZVRva2VuXTsKICAgICAgICB1aW50MjU2IHJlc2VydmVCYWxhbmNlID0gZ2V0UmVzZXJ2ZUJhbGFuY2UoX3Jlc2VydmVUb2tlbik7CiAgICAgICAgYW1vdW50ID0gZm9ybXVsYS5jYWxjdWxhdGVTYWxlUmV0dXJuKF90b3RhbFN1cHBseSwgcmVzZXJ2ZUJhbGFuY2UsIHJlc2VydmUucmF0aW8sIF9zZWxsQW1vdW50KTsKCiAgICAgICAgLy8gZGVkdWN0IHRoZSBmZWUgZnJvbSB0aGUgcmV0dXJuIGFtb3VudAogICAgICAgIHVpbnQyNTYgZmVlQW1vdW50ID0gZ2V0Q2hhbmdlRmVlQW1vdW50KGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHNhZmVTdWIoYW1vdW50LCBmZWVBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgY2hlY2tzIHdoZXRoZXIgYWxsb3dhbmNlIGZvciB0aGUgZ2l2ZW4gc3BlbmRlciBleGlzdHMgYW5kIGFwcHJvdmVzIG9uZSBpZiBpdCBkb2Vzbid0CgogICAgICAgIEBwYXJhbSBfdG9rZW4gICB0b2tlbiB0byBjaGVjayB0aGUgYWxsb3dhbmNlIGluCiAgICAgICAgQHBhcmFtIF9zcGVuZGVyIGFwcHJvdmVkIGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3ZhbHVlICAgYWxsb3dhbmNlIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGVuc3VyZUFsbG93YW5jZShJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwcml2YXRlIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHNldCBhbiBhbGxvd2FuY2UgaWYgdGhlIHNwZW5kZXIgaXMgdGhlIGxvY2FsIGNvbnRyYWN0CiAgICAgICAgaWYgKF9zcGVuZGVyID09IGFkZHJlc3ModGhpcykpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gY2hlY2sgaWYgYWxsb3dhbmNlIGZvciB0aGUgZ2l2ZW4gYW1vdW50IGFscmVhZHkgZXhpc3RzCiAgICAgICAgaWYgKF90b2tlbi5hbGxvd2FuY2UodGhpcywgX3NwZW5kZXIpID49IF92YWx1ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB0aGUgYWxsb3dhbmNlIGlzIG5vbnplcm8sIG11c3QgcmVzZXQgaXQgdG8gMCBmaXJzdAogICAgICAgIGlmIChfdG9rZW4uYWxsb3dhbmNlKHRoaXMsIF9zcGVuZGVyKSAhPSAwKQogICAgICAgICAgICBhc3NlcnQoX3Rva2VuLmFwcHJvdmUoX3NwZW5kZXIsIDApKTsKCiAgICAgICAgLy8gYXBwcm92ZSB0aGUgbmV3IGFsbG93YW5jZQogICAgICAgIGFzc2VydChfdG9rZW4uYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1dGlsaXR5LCB0cmFuc2ZlcnMgdG9rZW5zIGZyb20gYW4gYWNjb3VudCB0byB0aGUgbG9jYWwgY29udHJhY3QKCiAgICAgICAgQHBhcmFtIF90b2tlbiAgIHRva2VuIHRvIGNsYWltCiAgICAgICAgQHBhcmFtIF9mcm9tICAgIGFjY291bnQgdG8gY2xhaW0gdGhlIHRva2VucyBmcm9tCiAgICAgICAgQHBhcmFtIF9hbW91bnQgIGFtb3VudCB0byBjbGFpbQogICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KSBwcml2YXRlIHsKICAgICAgICAvLyBubyBuZWVkIHRvIGNsYWltIHRoZSB0b2tlbnMgaWYgdGhlIHNvdXJjZSBpcyB0aGUgbG9jYWwgY29udHJhY3QKICAgICAgICBpZiAoX2Zyb20gPT0gYWRkcmVzcyh0aGlzKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB0aGUgdG9rZW4gaXMgdGhlIHNtYXJ0IHRva2VuLCBubyBhbGxvd2FuY2UgaXMgcmVxdWlyZWQgLSBkZXN0cm95IHRoZSB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIGFuZCBpc3N1ZSB0aGVtIHRvIHRoZSBsb2NhbCBjb250cmFjdAogICAgICAgIGlmIChfdG9rZW4gPT0gdG9rZW4pIHsKICAgICAgICAgICAgdG9rZW4uZGVzdHJveShfZnJvbSwgX2Ftb3VudCk7IC8vIGRlc3Ryb3kgX2Ftb3VudCB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyJ3MgYmFsYW5jZSBpbiB0aGUgc21hcnQgdG9rZW4KICAgICAgICAgICAgdG9rZW4uaXNzdWUodGhpcywgX2Ftb3VudCk7IC8vIGlzc3VlIF9hbW91bnQgbmV3IHRva2VucyB0byB0aGUgbG9jYWwgY29udHJhY3QKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gb3RoZXJ3aXNlLCB3ZSBhc3N1bWUgd2UgYWxyZWFkeSBoYXZlIGFsbG93YW5jZQogICAgICAgIGFzc2VydChfdG9rZW4udHJhbnNmZXJGcm9tKF9mcm9tLCB0aGlzLCBfYW1vdW50KSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBmYWxsYmFjaywgYnV5cyB0aGUgc21hcnQgdG9rZW4gd2l0aCBFVEgKICAgICAgICBub3RlIHRoYXQgdGhlIHB1cmNoYXNlIHdpbGwgdXNlIHRoZSBwcmljZSBhdCB0aGUgdGltZSBvZiB0aGUgcHVyY2hhc2UKICAgICovCiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIHF1aWNrQnV5KDEpOwogICAgfQp9'.
	

]
