Class {
	#name : #SRTc22462d4bc50952b061c9e6c585fdd9a04d0d75a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc22462d4bc50952b061c9e6c585fdd9a04d0d75a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7Cgpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9Cgpjb250cmFjdCBNaW5pTWVUb2tlbiBpcyBDb250cm9sbGVkIHsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjEnOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQoKCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGEKICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUKICAgIC8vLyAgdmFsdWUKICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7CgogICAgICAgIC8vIGBmcm9tQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBmcm9tCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CgogICAgICAgIC8vIGB2YWx1ZWAgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBibG9jayBudW1iZXIKICAgICAgICB1aW50MTI4IHZhbHVlOwogICAgfQoKICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsKICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgcGFyZW50VG9rZW47CgogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzCiAgICAvLyAgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBDbG9uZSBUb2tlbgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKCiAgICAvLyBgY3JlYXRpb25CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBDbG9uZSBUb2tlbiB3YXMgY3JlYXRlZAogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsKCiAgICAvLyBgYmFsYW5jZXNgIGlzIHRoZSBtYXAgdGhhdCB0cmFja3MgdGhlIGJhbGFuY2Ugb2YgZWFjaCBhZGRyZXNzLCBpbiB0aGlzCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IENoZWNrcG9pbnRbXSkgYmFsYW5jZXM7CgogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuCiAgICBDaGVja3BvaW50W10gdG90YWxTdXBwbHlIaXN0b3J5OwoKICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90LgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZDsKCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zCiAgICBNaW5pTWVUb2tlbkZhY3RvcnkgcHVibGljIHRva2VuRmFjdG9yeTsKCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIE1pbmlNZVRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0CiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlCiAgICAvLy8gIGRlcGxveWVkIGZpcnN0CiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQogICAgLy8vICBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFNuYXBTaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0CiAgICAvLy8gIGlzIGEgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigKICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSB7CiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOwogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGVjaW1hbHMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbAogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsKICAgICAgICBwYXJlbnRTbmFwU2hvdEJsb2NrID0gX3BhcmVudFNuYXBTaG90QmxvY2s7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBFUkMyMCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0CiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudAogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUKICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQogICAgICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfYW1vdW50KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQoKICAgICAgICAgICByZXF1aXJlKHBhcmVudFNuYXBTaG90QmxvY2sgPCBibG9jay5udW1iZXIpOwoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICByZXF1aXJlKChfdG8gIT0gMCkgJiYgKF90byAhPSBhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSk7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZU9mQXQoX293bmVyLCBibG9jay5udW1iZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlKChfYW1vdW50ID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgYXBwcm92ZSBmdW5jdGlvbiBjYWxsCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25BcHByb3ZlKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpOwoKICAgICAgICBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLgogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIENsb25lIFRva2VuIE1ldGhvZAovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIG5ldyBjbG9uZSB0b2tlbiB3aXRoIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBiZWluZwogICAgLy8vICB0aGlzIHRva2VuIGF0IGBfc25hcHNob3RCbG9ja2AKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9jbG9uZURlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5TeW1ib2wgU3ltYm9sIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcwogICAgLy8vICBjb3BpZWQgdG8gc2V0IHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbmV3IGNsb25lIHRva2VuOwogICAgLy8vICBpZiB0aGUgYmxvY2sgaXMgemVybyB0aGFuIHRoZSBhY3R1YWwgYmxvY2ssIHRoZSBjdXJyZW50IGJsb2NrIGlzIHVzZWQKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBNaW5pTWVUb2tlbiBjbG9uZVRva2VuID0gdG9rZW5GYWN0b3J5LmNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdG9rZW4gZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgTmV3Q2xvbmVUb2tlbihhZGRyZXNzKGNsb25lVG9rZW4pLCBfc25hcHNob3RCbG9jayk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2VucwovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgR2VuZXJhdGVzIGBfYW1vdW50YCB0b2tlbnMgdGhhdCBhcmUgYXNzaWduZWQgdG8gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSBhc3NpZ25lZCB0aGUgbmV3IHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgZ2VuZXJhdGVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGdlbmVyYXRlZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgPj0gX2Ftb3VudCk7CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VGcm9tID49IF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEVuYWJsZSB0b2tlbnMgdHJhbnNmZXJzCi8vLy8vLy8vLy8vLy8vLy8KCgogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIHZhbHVlcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdAogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZAogICAgZnVuY3Rpb24gZ2V0VmFsdWVBdChDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfYmxvY2sKICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwoKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlCiAgICAvLy8gIGB0b3RhbFN1cHBseUhpc3RvcnlgCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZUF0Tm93KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF92YWx1ZQogICAgKSBpbnRlcm5hbCAgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtMV0uZnJvbUJsb2NrIDwgYmxvY2subnVtYmVyKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2UgbmV3Q2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzWyBjaGVja3BvaW50cy5sZW5ndGgrKyBdOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9ICB1aW50MTI4KGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07CiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZT4wOwogICAgfQoKICAgIC8vLyBAZGV2IEhlbHBlciBmdW5jdGlvbiB0byByZXR1cm4gYSBtaW4gYmV0d2VuIHRoZSB0d28gdWludHMKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoZSBmYWxsYmFjayBmdW5jdGlvbjogSWYgdGhlIGNvbnRyYWN0J3MgY29udHJvbGxlciBoYXMgbm90IGJlZW4KICAgIC8vLyAgc2V0IHRvIDAsIHRoZW4gdGhlIGBwcm94eVBheW1lbnRgIG1ldGhvZCBpcyBjYWxsZWQgd2hpY2ggcmVsYXlzIHRoZQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKTsKICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSk7CiAgICB9CgovLy8vLy8vLy8vCi8vIFNhZmV0eSBNZXRob2RzCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgY29udHJvbGxlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNaW5pTWVUb2tlbiB0b2tlbiA9IE1pbmlNZVRva2VuKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRXZlbnRzCi8vLy8vLy8vLy8vLy8vLy8KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOwogICAgZXZlbnQgQXBwcm92YWwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9vd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICAgICAgKTsKCn0KCmNvbnRyYWN0IENORCBpcyBNaW5pTWVUb2tlbiB7CiAgLyoqCiAgICAqIEBkZXYgQ29uc3RydWN0b3IKICAqLwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElTX0NORF9DT05UUkFDVF9NQUdJQ19OVU1CRVIgPSAweDEzMzg7CiAgZnVuY3Rpb24gQ05EKGFkZHJlc3MgX3Rva2VuRmFjdG9yeSkKICAgIE1pbmlNZVRva2VuKAogICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAweDAsICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHBhcmVudCB0b2tlbgogICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgICAiQ2luZGljYXRvciBUb2tlbiIsICAgLy8gVG9rZW4gbmFtZQogICAgICAxOCwgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY2ltYWxzCiAgICAgICJDTkQiLCAgICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sCiAgICAgIHRydWUgICAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlIHRyYW5zZmVycwogICAgKSAKICAgIHt9CgogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgcmVxdWlyZShmYWxzZSk7CiAgICB9Cn0KCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSB7CiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF90b2tlbk5hbWUsCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gbmV3VG9rZW47CiAgICB9Cn0KCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBDb250cmlidXRpb24gaXMgQ29udHJvbGxlZCwgVG9rZW5Db250cm9sbGVyIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgc3RydWN0IFdoaXRlbGlzdGVkSW52ZXN0b3IgewogICAgdWludDI1NiB0aWVyOwogICAgYm9vbCBzdGF0dXM7CiAgICB1aW50MjU2IGNvbnRyaWJ1dGVkQW1vdW50OwogIH0KCiAgbWFwcGluZyhhZGRyZXNzID0+IFdoaXRlbGlzdGVkSW52ZXN0b3IpIGludmVzdG9yczsKICBUaWVyWzRdIHB1YmxpYyB0aWVyczsKICB1aW50MjU2IHB1YmxpYyB0aWVyQ291bnQ7CgogIE1pbmlNZVRva2VuIHB1YmxpYyBjbmQ7CiAgYm9vbCBwdWJsaWMgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgdWludDI1NiBwdWJsaWMgT2N0b2JlcjEyXzIwMTcgPSAxNTA3ODMwNDAwOwogIGFkZHJlc3MgcHVibGljIGNvbnRyaWJ1dGlvbldhbGxldDsKICBhZGRyZXNzIHB1YmxpYyBmb3VuZGVyc1dhbGxldDsKICBhZGRyZXNzIHB1YmxpYyBhZHZpc29yc1dhbGxldDsKICBhZGRyZXNzIHB1YmxpYyBib3VudHlXYWxsZXQ7CiAgYm9vbCBwdWJsaWMgZmluYWxBbGxvY2F0aW9uOwoKICB1aW50MjU2IHB1YmxpYyB0b3RhbFRva2Vuc1NvbGQ7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICBtb2RpZmllciBub3RBbGxvY2F0ZWQoKSB7CiAgICByZXF1aXJlKGZpbmFsQWxsb2NhdGlvbiA9PSBmYWxzZSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgZW5kZWRTYWxlKCkgewogICAgcmVxdWlyZSh0aWVyQ291bnQgPT0gNCk7IC8vd2hlbiBsYXN0IG9uZSBmaW5pc2hlZCBpdCBzaG91bGQgYmUgZXF1YWwgdG8gNAogICAgXzsKICB9CgogIG1vZGlmaWVyIHRva2VuSW5pdGlhbGl6ZWQoKSB7CiAgICBhc3NlcnQoYWRkcmVzcyhjbmQpICE9IDB4MCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgaW5pdGlhbGl6ZWQoKSB7CiAgICBUaWVyIHRpZXIgPSB0aWVyc1t0aWVyQ291bnRdOwogICAgYXNzZXJ0KHRpZXIuaW5pdGlhbGl6ZWRUaW1lKCkgIT0gMCk7CiAgICBfOwogIH0KICAvLy8gQG5vdGljZSBQcm92aWRlcyBpbmZvcm1hdGlvbiBpZiBjb250cmlidXRpb24gaXMgb3BlbgogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cmlidWlvbiBpcyBjbG9zZWQKICBmdW5jdGlvbiBjb250cmlidXRpb25PcGVuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgVGllciB0aWVyID0gdGllcnNbdGllckNvdW50XTsKICAgIHJldHVybiAoZ2V0QmxvY2tUaW1lc3RhbXAoKSA+PSB0aWVyLnN0YXJ0VGltZSgpICYmIAogICAgICAgICAgIGdldEJsb2NrVGltZXN0YW1wKCkgPD0gdGllci5lbmRUaW1lKCkgJiYKICAgICAgICAgICB0aWVyLmZpbmFsaXplZFRpbWUoKSA9PSAwKTsKICB9CgogIG1vZGlmaWVyIG5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gQ29udHJpYnV0aW9uKGFkZHJlc3MgX2NvbnRyaWJ1dGlvbldhbGxldCwgYWRkcmVzcyBfZm91bmRlcnNXYWxsZXQsIGFkZHJlc3MgX2Fkdmlzb3JzV2FsbGV0LCBhZGRyZXNzIF9ib3VudHlXYWxsZXQpIHsKICAgIHJlcXVpcmUoX2NvbnRyaWJ1dGlvbldhbGxldCAhPSAweDApOwogICAgcmVxdWlyZShfZm91bmRlcnNXYWxsZXQgIT0gMHgwKTsKICAgIHJlcXVpcmUoX2Fkdmlzb3JzV2FsbGV0ICE9IDB4MCk7CiAgICByZXF1aXJlKF9ib3VudHlXYWxsZXQgIT0gMHgwKTsKICAgIGNvbnRyaWJ1dGlvbldhbGxldCA9IF9jb250cmlidXRpb25XYWxsZXQ7CiAgICBmb3VuZGVyc1dhbGxldCA9IF9mb3VuZGVyc1dhbGxldDsKICAgIGFkdmlzb3JzV2FsbGV0ID1fYWR2aXNvcnNXYWxsZXQ7CiAgICBib3VudHlXYWxsZXQgPSBfYm91bnR5V2FsbGV0OwogICAgdGllckNvdW50ID0gMDsKICB9CiAgLy8vIEBub3RpY2UgSW5pdGlhbGl6ZXMgQ05EIHRva2VuIHRvIGNvbnRyaWJ1dGlvbgogIC8vLyBAcGFyYW0gX2NuZCBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byBzZXQKICBmdW5jdGlvbiBpbml0aWFsaXplVG9rZW4oYWRkcmVzcyBfY25kKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgYXNzZXJ0KENORChfY25kKS5jb250cm9sbGVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICBhc3NlcnQoQ05EKF9jbmQpLklTX0NORF9DT05UUkFDVF9NQUdJQ19OVU1CRVIoKSA9PSAweDEzMzgpOwogICAgcmVxdWlyZShfY25kICE9IDB4MCk7CiAgICBjbmQgPSBDTkQoX2NuZCk7CiAgfQogIC8vLyBAbm90aWNlIEluaXRpYWxpemVzIFRpZXIgY29udHJpYnV0aW9uCiAgLy8vIEBwYXJhbSBfdGllck51bWJlciBudW1iZXIgb2YgdGllciB0byBpbml0aWFsaXplCiAgLy8vIEBwYXJhbSBfdGllckFkZHJlc3MgYWRkcmVzcyBvZiBkZXBsb3llZCB0aWVyCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZVRpZXIoCiAgICB1aW50MjU2IF90aWVyTnVtYmVyLAogICAgYWRkcmVzcyBfdGllckFkZHJlc3MKICApIHB1YmxpYyBvbmx5Q29udHJvbGxlciB0b2tlbkluaXRpYWxpemVkCiAgewogICAgVGllciB0aWVyID0gVGllcihfdGllckFkZHJlc3MpOwogICAgYXNzZXJ0KHRpZXIuY29udHJvbGxlcigpID09IGFkZHJlc3ModGhpcykpOwogICAgLy9jYW5ub3QgYmUgbW9yZSB0aGFuIDQgdGllcnMKICAgIHJlcXVpcmUoX3RpZXJOdW1iZXIgPj0gMCAmJiBfdGllck51bWJlciA8PSAzKTsKICAgIGFzc2VydCh0aWVyLklTX1RJRVJfQ09OVFJBQ1RfTUFHSUNfTlVNQkVSKCkgPT0gMHgxMzM3KTsKICAgIC8vIGNoZWNrIGlmIHRpZXIgaXMgbm90IGRlZmluZWQKICAgIGFzc2VydCh0aWVyc1tfdGllck51bWJlcl0gPT0gYWRkcmVzcygwKSk7CiAgICB0aWVyc1tfdGllck51bWJlcl0gPSB0aWVyOwogICAgSW5pdGlhbGl6ZWRUaWVyKF90aWVyTnVtYmVyLCBfdGllckFkZHJlc3MpOwogIH0KCiAgLy8vIEBub3RpY2UgSWYgYW55Ym9keSBzZW5kcyBFdGhlciBkaXJlY3RseSB0byB0aGlzIGNvbnRyYWN0LCBjb25zaWRlciB0aGUgc2VuZGVyIHdpbGwKICAvLy8gYmUgcmVqZWN0ZWQuCiAgZnVuY3Rpb24gKCkgcHVibGljIHsKICAgIHJlcXVpcmUoZmFsc2UpOwogIH0KICAvLy8gQG5vdGljZSBBbW91bnQgb2YgdG9rZW5zIGFuIGludmVzdG9yIGNhbiBwdXJjaGFzZQogIC8vLyBAcGFyYW0gX2ludmVzdG9yIGludmVzdG9yIGFkZHJlc3MKICAvLy8gQHJldHVybiBudW1iZXIgb2YgdG9rZW5zICAKICBmdW5jdGlvbiBpbnZlc3RvckFtb3VudFRva2Vuc1RvQnV5KGFkZHJlc3MgX2ludmVzdG9yKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICBXaGl0ZWxpc3RlZEludmVzdG9yIG1lbW9yeSBpbnZlc3RvciA9IGludmVzdG9yc1tfaW52ZXN0b3JdOwogICAgVGllciB0aWVyID0gdGllcnNbdGllckNvdW50XTsKICAgIHVpbnQyNTYgbGVmdFRvQnV5ID0gdGllci5tYXhJbnZlc3RvckNhcCgpLnN1YihpbnZlc3Rvci5jb250cmlidXRlZEFtb3VudCkubXVsKHRpZXIuZXhjaGFuZ2VSYXRlKCkpOwogICAgcmV0dXJuIGxlZnRUb0J1eTsKICB9CiAgLy8vIEBub3RpY2UgTm90aWZpZXMgaWYgYW4gaW52ZXN0b3IgaXMgd2hpdGVsaXN0ZWQgZm9yIGNvbnRyaWJ1dGlvbgogIC8vLyBAcGFyYW0gX2ludmVzdG9yIGludmVzdG9yIGFkZHJlc3MKICAvLy8gQHBhcmFtIF90aWVyIHRpZXIgTnVtYmVyCiAgLy8vIEByZXR1cm4gbnVtYmVyIG9mIHRva2VucyAKICBmdW5jdGlvbiBpc1doaXRlbGlzdGVkKGFkZHJlc3MgX2ludmVzdG9yLCB1aW50MjU2IF90aWVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICBXaGl0ZWxpc3RlZEludmVzdG9yIG1lbW9yeSBpbnZlc3RvciA9IGludmVzdG9yc1tfaW52ZXN0b3JdOwogICAgcmV0dXJuIChpbnZlc3Rvci50aWVyIDw9IF90aWVyICYmIGludmVzdG9yLnN0YXR1cyk7CiAgfQogIC8vLyBAbm90aWNlIGludGVyZmFjZSBmb3IgZm91bmRlcnMgdG8gd2hpdGVsaXN0IGludmVzdG9ycwogIC8vLyBAcGFyYW0gX2FkZHJlc3NlcyBhcnJheSBvZiBpbnZlc3RvcnMKICAvLy8gQHBhcmFtIF90aWVyIHRpZXIgTnVtYmVyCiAgLy8vIEBwYXJhbSBfc3RhdHVzIGVuYWJsZSBvciBkaXNhYmxlCiAgZnVuY3Rpb24gd2hpdGVsaXN0QWRkcmVzc2VzKGFkZHJlc3NbXSBfYWRkcmVzc2VzLCB1aW50MjU2IF90aWVyLCBib29sIF9zdGF0dXMpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYWRkcmVzcyBpbnZlc3RvckFkZHJlc3MgPSBfYWRkcmVzc2VzW2ldOwogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW2ludmVzdG9yQWRkcmVzc10uY29udHJpYnV0ZWRBbW91bnQgPT0gMCk7CiAgICAgICAgaW52ZXN0b3JzW2ludmVzdG9yQWRkcmVzc10gPSBXaGl0ZWxpc3RlZEludmVzdG9yKF90aWVyLCBfc3RhdHVzLCAwKTsKICAgIH0KICAgfQogIC8vLyBAbm90aWNlIFB1YmxpYyBmdW5jdGlvbiB0byBidXkgdG9rZW5zCiAgIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICBwcm94eVBheW1lbnQobXNnLnNlbmRlcik7CiAgIH0KICAvLy8gdXNlIGJ1eSBmdW5jdGlvbiBpbnN0ZWFkIG9mIHByb3h5UGF5bWVudAogIC8vLyB0aGUgcGFyYW0gYWRkcmVzcyBpcyB1c2VsZXNzLCBpdCBhbHdheXMgcmVhc3NpZ25zIHRvIG1zZy5zZW5kZXIKICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcykgcHVibGljIHBheWFibGUgCiAgICBub3RQYXVzZWQKICAgIGluaXRpYWxpemVkCiAgICByZXR1cm5zIChib29sKSAKICB7CiAgICBhc3NlcnQoaXNDdXJyZW50VGllckNhcFJlYWNoZWQoKSA9PSBmYWxzZSk7CiAgICBhc3NlcnQoY29udHJpYnV0aW9uT3BlbigpKTsKICAgIHJlcXVpcmUoaXNXaGl0ZWxpc3RlZChtc2cuc2VuZGVyLCB0aWVyQ291bnQpKTsKICAgIGRvQnV5KCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIC8qIF9mcm9tICovLCBhZGRyZXNzIC8qIF90byAqLywgdWludDI1NiAvKiBfYW1vdW50ICovKSByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiAodHJhbnNmZXJhYmxlIHx8IGdldEJsb2NrVGltZXN0YW1wKCkgPj0gT2N0b2JlcjEyXzIwMTcgKTsKICB9IAoKICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyAvKiBfb3duZXIgKi8sIGFkZHJlc3MgLyogX3NwZW5kZXIgKi8sIHVpbnQgLyogX2Ftb3VudCAqLykgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gKHRyYW5zZmVyYWJsZSB8fCBnZXRCbG9ja1RpbWVzdGFtcCgpID49IE9jdG9iZXIxMl8yMDE3KTsKICB9CiAgLy8vIEBub3RpY2UgQWxsb3dzIGZvdW5kZXJzIHRvIHNldCB0cmFuc2ZlcnMgYmVmb3JlIE9jdG9iZXIxMl8yMDE3CiAgLy8vIEBwYXJhbSBfdHJhbnNmZXJhYmxlIHNldCBUcnVlIGlmIGZvdW5kZXJzIHdhbnQgdG8gbGV0IHBlb3BsZSBtYWtlIHRyYW5zZmVycwogIGZ1bmN0aW9uIGFsbG93VHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyYWJsZSkgb25seUNvbnRyb2xsZXIgewogICAgdHJhbnNmZXJhYmxlID0gX3RyYW5zZmVyYWJsZTsKICB9CiAgLy8vIEBub3RpY2UgY2FsY3VsYXRlcyBob3cgbWFueSB0b2tlbnMgbGVmdCBmb3Igc2FsZQogIC8vLyBAcmV0dXJuIE51bWJlciBvZiB0b2tlbnMgbGVmdCBmb3IgdGllcgogIGZ1bmN0aW9uIGxlZnRGb3JTYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgVGllciB0aWVyID0gdGllcnNbdGllckNvdW50XTsKICAgIHVpbnQyNTYgd2VpTGVmdCA9IHRpZXIuY2FwKCkuc3ViKHRpZXIudG90YWxJbnZlc3RlZFdlaSgpKTsKICAgIHVpbnQyNTYgdG9rZW5zTGVmdCA9IHdlaUxlZnQubXVsKHRpZXIuZXhjaGFuZ2VSYXRlKCkpOwogICAgcmV0dXJuIHRva2Vuc0xlZnQ7CiAgfQogIC8vLyBAbm90aWNlIGFjdHVhbCBtZXRob2QgdGhhdCBmdW5kcyBpbnZlc3RvciBhbmQgY29udHJpYnV0aW9uIHdhbGxldAogIGZ1bmN0aW9uIGRvQnV5KCkgaW50ZXJuYWwgewogICAgVGllciB0aWVyID0gdGllcnNbdGllckNvdW50XTsKICAgIGFzc2VydChtc2cudmFsdWUgPD0gdGllci5tYXhJbnZlc3RvckNhcCgpKTsKICAgIGFkZHJlc3MgY2FsbGVyID0gbXNnLnNlbmRlcjsKICAgIFdoaXRlbGlzdGVkSW52ZXN0b3Igc3RvcmFnZSBpbnZlc3RvciA9IGludmVzdG9yc1tjYWxsZXJdOwogICAgdWludDI1NiBpbnZlc3RvclRva2VuQlAgPSBpbnZlc3RvckFtb3VudFRva2Vuc1RvQnV5KGNhbGxlcik7CiAgICByZXF1aXJlKGludmVzdG9yVG9rZW5CUCA+IDApOwoKICAgIGlmKGludmVzdG9yLmNvbnRyaWJ1dGVkQW1vdW50ID09IDApIHsKICAgICAgYXNzZXJ0KG1zZy52YWx1ZSA+PSB0aWVyLm1pbkludmVzdG9yQ2FwKCkpOyAgCiAgICB9CgogICAgdWludDI1NiB0b0Z1bmQgPSBtc2cudmFsdWU7ICAKICAgIHVpbnQyNTYgdG9rZW5zR2VuZXJhdGVkID0gdG9GdW5kLm11bCh0aWVyLmV4Y2hhbmdlUmF0ZSgpKTsKICAgIC8vIGNoZWNrIHRoYXQgYXQgbGVhc3QgMSB0b2tlbiB3aWxsIGJlIGdlbmVyYXRlZAogICAgcmVxdWlyZSh0b2tlbnNHZW5lcmF0ZWQgPj0gMSk7CiAgICB1aW50MjU2IHRva2Vuc2xlZnRGb3JTYWxlID0gbGVmdEZvclNhbGUoKTsgICAgCgogICAgaWYodG9rZW5zbGVmdEZvclNhbGUgPiBpbnZlc3RvclRva2VuQlAgKSB7CiAgICAgIGlmKHRva2Vuc0dlbmVyYXRlZCA+IGludmVzdG9yVG9rZW5CUCkgewogICAgICAgIHRva2Vuc0dlbmVyYXRlZCA9IGludmVzdG9yVG9rZW5CUDsKICAgICAgICB0b0Z1bmQgPSBpbnZlc3RvclRva2VuQlAuZGl2KHRpZXIuZXhjaGFuZ2VSYXRlKCkpOwogICAgICB9CiAgICB9CgogICAgaWYoaW52ZXN0b3JUb2tlbkJQID4gdG9rZW5zbGVmdEZvclNhbGUpIHsKICAgICAgaWYodG9rZW5zR2VuZXJhdGVkID4gdG9rZW5zbGVmdEZvclNhbGUpIHsKICAgICAgICB0b2tlbnNHZW5lcmF0ZWQgPSB0b2tlbnNsZWZ0Rm9yU2FsZTsKICAgICAgICB0b0Z1bmQgPSB0b2tlbnNsZWZ0Rm9yU2FsZS5kaXYodGllci5leGNoYW5nZVJhdGUoKSk7CiAgICAgIH0KICAgIH0KCiAgICBpbnZlc3Rvci5jb250cmlidXRlZEFtb3VudCA9IGludmVzdG9yLmNvbnRyaWJ1dGVkQW1vdW50LmFkZCh0b0Z1bmQpOwogICAgdGllci5pbmNyZWFzZUludmVzdGVkV2VpKHRvRnVuZCk7CiAgICBpZiAodG9rZW5zR2VuZXJhdGVkID09IHRva2Vuc2xlZnRGb3JTYWxlKSB7CiAgICAgIGZpbmFsaXplKCk7CiAgICB9CiAgICAKICAgIGFzc2VydChjbmQuZ2VuZXJhdGVUb2tlbnMoY2FsbGVyLCB0b2tlbnNHZW5lcmF0ZWQpKTsKICAgIHRvdGFsVG9rZW5zU29sZCA9IHRvdGFsVG9rZW5zU29sZC5hZGQodG9rZW5zR2VuZXJhdGVkKTsKCiAgICBjb250cmlidXRpb25XYWxsZXQudHJhbnNmZXIodG9GdW5kKTsKCiAgICBOZXdTYWxlKGNhbGxlciwgdG9GdW5kLCB0b2tlbnNHZW5lcmF0ZWQpOwoKICAgIHVpbnQyNTYgdG9SZXR1cm4gPSBtc2cudmFsdWUuc3ViKHRvRnVuZCk7CiAgICBpZiAodG9SZXR1cm4gPiAwKSB7CiAgICAgIGNhbGxlci50cmFuc2Zlcih0b1JldHVybik7CiAgICAgIFJlZnVuZCh0b1JldHVybik7CiAgICB9CiAgfQogIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHdpbGwgY2FuIGJlIGNhbGxlZCBieSB0aGUgYW55Ym9keSB0byBtYWtlIGZpbmFsIGFsbG9jYXRpb24KICAvLy8gQHJldHVybiByZXN1bHQgaWYgZXZlcnl0aGluZyB3ZW50IHN1Y2Nlc2Z1bGx5CiAgZnVuY3Rpb24gYWxsb2NhdGUoKSBwdWJsaWMgbm90QWxsb2NhdGVkIGVuZGVkU2FsZSByZXR1cm5zKGJvb2wpIHsKICAgIGZpbmFsQWxsb2NhdGlvbiA9IHRydWU7CiAgICB1aW50MjU2IHRvdGFsU3VwcGx5Q0ROID0gdG90YWxUb2tlbnNTb2xkLm11bCgxMDApLmRpdig3NSk7IC8vIGNhbGN1bGF0ZSAxMDAlCiAgICB1aW50MjU2IGZvdW5kZXJzQWxsb2NhdGlvbiA9IHRvdGFsU3VwcGx5Q0ROLmRpdig1KTsgLy8gMjAlIGdvZXMgdG8gZm91bmRlcnMKICAgIGFzc2VydChjbmQuZ2VuZXJhdGVUb2tlbnMoZm91bmRlcnNXYWxsZXQsIGZvdW5kZXJzQWxsb2NhdGlvbikpOwogICAgCiAgICB1aW50MjU2IGFkdmlzb3JzQWxsb2NhdGlvbiA9IHRvdGFsU3VwcGx5Q0ROLm11bCgzOCkuZGl2KDEwMDApOyAvLyAzLjglIGdvZXMgdG8gYWR2aXNvcnMKICAgIGFzc2VydChjbmQuZ2VuZXJhdGVUb2tlbnMoYWR2aXNvcnNXYWxsZXQsIGFkdmlzb3JzQWxsb2NhdGlvbikpOwogICAgdWludDI1NiBib3VudHlBbGxvY2F0aW9uID0gdG90YWxTdXBwbHlDRE4ubXVsKDEyKS5kaXYoMTAwMCk7IC8vIDEuMiUgZ29lcyB0byAgYm91bnR5IHByb2dyYW0KICAgIGFzc2VydChjbmQuZ2VuZXJhdGVUb2tlbnMoYm91bnR5V2FsbGV0LCBib3VudHlBbGxvY2F0aW9uKSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHdpbGwgY2FuIGJlIGNhbGxlZCBieSB0aGUgY29udHJvbGxlciBhZnRlciB0aGUgY29udHJpYnV0aW9uIHBlcmlvZAogIC8vLyAgZW5kIG9yIGJ5IGFueWJvZHkgYWZ0ZXIgdGhlIGBlbmRUaW1lYC4gVGhpcyBtZXRob2QgZmluYWxpemVzIHRoZSBjb250cmlidXRpb24gcGVyaW9kCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5pdGlhbGl6ZWQgewogICAgVGllciB0aWVyID0gdGllcnNbdGllckNvdW50XTsKICAgIGFzc2VydCh0aWVyLmZpbmFsaXplZFRpbWUoKSA9PSAwKTsKICAgIGFzc2VydChnZXRCbG9ja1RpbWVzdGFtcCgpID49IHRpZXIuc3RhcnRUaW1lKCkpOwogICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gY29udHJvbGxlciB8fCBnZXRCbG9ja1RpbWVzdGFtcCgpID4gdGllci5lbmRUaW1lKCkgfHwgaXNDdXJyZW50VGllckNhcFJlYWNoZWQoKSk7CgogICAgdGllci5maW5hbGl6ZSgpOwogICAgdGllckNvdW50Kys7CgogICAgRmluYWxpemVkVGllcih0aWVyQ291bnQsIHRpZXIuZmluYWxpemVkVGltZSgpKTsKICB9CiAgLy8vIEBub3RpY2UgY2hlY2sgaWYgdGllciBjYXAgaGFzIHJlYWNoZWQKICAvLy8gQHJldHVybiBGYWxzZSBpZiBpdCdzIHN0aWxsIG9wZW4KICBmdW5jdGlvbiBpc0N1cnJlbnRUaWVyQ2FwUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIFRpZXIgdGllciA9IHRpZXJzW3RpZXJDb3VudF07CiAgICByZXR1cm4gdGllci5pc0NhcFJlYWNoZWQoKTsKICB9CgogIC8vLy8vLy8vLy8KICAvLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMKICAvLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGdldEJsb2NrVGltZXN0YW1wKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJsb2NrLnRpbWVzdGFtcDsKICB9CgoKCiAgLy8vLy8vLy8vLwogIC8vIFNhZmV0eSBNZXRob2RzCiAgLy8vLy8vLy8vLwoKICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgaWYgKGNuZC5jb250cm9sbGVyKCkgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICBjbmQuY2xhaW1Ub2tlbnMoX3Rva2VuKTsKICAgIH0KCiAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBDTkQgdG9rZW4gPSBDTkQoX3Rva2VuKTsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogIH0KCiAgLy8vIEBub3RpY2UgUGF1c2VzIHRoZSBjb250cmlidXRpb24gaWYgdGhlcmUgaXMgYW55IGlzc3VlCiAgZnVuY3Rpb24gcGF1c2VDb250cmlidXRpb24oYm9vbCBfcGF1c2VkKSBvbmx5Q29udHJvbGxlciB7CiAgICBwYXVzZWQgPSBfcGF1c2VkOwogIH0KCiAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQyNTYgX2Ftb3VudCk7CiAgZXZlbnQgTmV3U2FsZShhZGRyZXNzIGluZGV4ZWQgX3RoLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3Rva2Vucyk7CiAgZXZlbnQgSW5pdGlhbGl6ZWRUaWVyKHVpbnQyNTYgX3RpZXJOdW1iZXIsIGFkZHJlc3MgX3RpZXJBZGRyZXNzKTsKICBldmVudCBGaW5hbGl6ZWRUaWVyKHVpbnQyNTYgX3RpZXJDb3VudCwgdWludDI1NiBfbm93KTsKICBldmVudCBSZWZ1bmQodWludDI1NiBfYW1vdW50KTsKICAKfQoKY29udHJhY3QgVGllciBpcyBDb250cm9sbGVkIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICB1aW50MjU2IHB1YmxpYyBjYXA7CiAgdWludDI1NiBwdWJsaWMgZXhjaGFuZ2VSYXRlOwogIHVpbnQyNTYgcHVibGljIG1pbkludmVzdG9yQ2FwOwogIHVpbnQyNTYgcHVibGljIG1heEludmVzdG9yQ2FwOwogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwogIHVpbnQyNTYgcHVibGljIGluaXRpYWxpemVkVGltZTsKICB1aW50MjU2IHB1YmxpYyBmaW5hbGl6ZWRUaW1lOwogIHVpbnQyNTYgcHVibGljIHRvdGFsSW52ZXN0ZWRXZWk7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSVNfVElFUl9DT05UUkFDVF9NQUdJQ19OVU1CRVIgPSAweDEzMzc7CgogIG1vZGlmaWVyIG5vdEZpbmlzaGVkKCkgewogICAgcmVxdWlyZShmaW5hbGl6ZWRUaW1lID09IDApOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIFRpZXIoCiAgICB1aW50MjU2IF9jYXAsCiAgICB1aW50MjU2IF9taW5JbnZlc3RvckNhcCwKICAgIHVpbnQyNTYgX21heEludmVzdG9yQ2FwLAogICAgdWludDI1NiBfZXhjaGFuZ2VSYXRlLAogICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgdWludDI1NiBfZW5kVGltZQogICkKICB7CiAgICByZXF1aXJlKGluaXRpYWxpemVkVGltZSA9PSAwKTsKICAgIGFzc2VydChfc3RhcnRUaW1lID49IGdldEJsb2NrVGltZXN0YW1wKCkpOwogICAgcmVxdWlyZShfc3RhcnRUaW1lIDwgX2VuZFRpbWUpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKCiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIHJlcXVpcmUoX2NhcCA+IF9tYXhJbnZlc3RvckNhcCk7CiAgICBjYXAgPSBfY2FwOwoKICAgIHJlcXVpcmUoX21pbkludmVzdG9yQ2FwIDwgX21heEludmVzdG9yQ2FwICYmIF9tYXhJbnZlc3RvckNhcCA+IDApOwogICAgbWluSW52ZXN0b3JDYXAgPSBfbWluSW52ZXN0b3JDYXA7CiAgICBtYXhJbnZlc3RvckNhcCA9IF9tYXhJbnZlc3RvckNhcDsKCiAgICByZXF1aXJlKF9leGNoYW5nZVJhdGUgPiAwKTsKICAgIGV4Y2hhbmdlUmF0ZSA9IF9leGNoYW5nZVJhdGU7CgogICAgaW5pdGlhbGl6ZWRUaW1lID0gZ2V0QmxvY2tUaW1lc3RhbXAoKTsKICAgIEluaXRpYWxpemVkVGllcihfY2FwLCBfbWluSW52ZXN0b3JDYXAsIG1heEludmVzdG9yQ2FwLCBfc3RhcnRUaW1lLCBfZW5kVGltZSk7CiAgfQoKICBmdW5jdGlvbiBnZXRCbG9ja1RpbWVzdGFtcCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBibG9jay50aW1lc3RhbXA7CiAgfQoKICBmdW5jdGlvbiBpc0NhcFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gdG90YWxJbnZlc3RlZFdlaSA9PSBjYXA7CiAgfQoKICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICByZXF1aXJlKGZpbmFsaXplZFRpbWUgPT0gMCk7CiAgICB1aW50MjU2IGN1cnJlbnRUaW1lID0gZ2V0QmxvY2tUaW1lc3RhbXAoKTsKICAgIGFzc2VydChjYXAgPT0gdG90YWxJbnZlc3RlZFdlaSB8fCBjdXJyZW50VGltZSA+IGVuZFRpbWUgfHwgbXNnLnNlbmRlciA9PSBjb250cm9sbGVyKTsKICAgIGZpbmFsaXplZFRpbWUgPSBjdXJyZW50VGltZTsKICB9CgogIGZ1bmN0aW9uIGluY3JlYXNlSW52ZXN0ZWRXZWkodWludDI1NiBfd2VpKSBleHRlcm5hbCBvbmx5Q29udHJvbGxlciBub3RGaW5pc2hlZCB7CiAgICB0b3RhbEludmVzdGVkV2VpID0gdG90YWxJbnZlc3RlZFdlaS5hZGQoX3dlaSk7CiAgICBJbmNyZWFzZUludmVzdGVkV2VpQW1vdW50KF93ZWksIHRvdGFsSW52ZXN0ZWRXZWkpOwogIH0KCiAgZXZlbnQgSW5pdGlhbGl6ZWRUaWVyKAogICB1aW50MjU2IF9jYXAsCiAgIHVpbnQyNTYgX21pbkludmVzdG9yQ2FwLCAKICAgdWludDI1NiBfbWF4SW52ZXN0b3JDYXAsIAogICB1aW50MjU2IF9zdGFydFRpbWUsCiAgIHVpbnQyNTYgX2VuZFRpbWUKICApOwoKICBmdW5jdGlvbiAoKSBwdWJsaWMgewogICAgcmVxdWlyZShmYWxzZSk7CiAgfQogIGV2ZW50IEluY3JlYXNlSW52ZXN0ZWRXZWlBbW91bnQodWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9uZXdXZWkpOwp9'.
	

]
