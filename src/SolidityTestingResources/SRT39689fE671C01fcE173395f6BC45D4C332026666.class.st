Class {
	#name : #SRT39689fE671C01fcE173395f6BC45D4C332026666,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT39689fE671C01fcE173395f6BC45D4C332026666 >> base64 [
	^ 'Y29udHJhY3QgRFNBdXRob3JpdHkgewogICAgZnVuY3Rpb24gY2FuQ2FsbCgKICAgICAgICBhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIGJ5dGVzNCBzaWcKICAgICkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IERTQXV0aEV2ZW50cyB7CiAgICBldmVudCBMb2dTZXRBdXRob3JpdHkgKGFkZHJlc3MgaW5kZXhlZCBhdXRob3JpdHkpOwogICAgZXZlbnQgTG9nU2V0T3duZXIgICAgIChhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwp9Cgpjb250cmFjdCBEU0F1dGggaXMgRFNBdXRoRXZlbnRzIHsKICAgIERTQXV0aG9yaXR5ICBwdWJsaWMgIGF1dGhvcml0eTsKICAgIGFkZHJlc3MgICAgICBwdWJsaWMgIG93bmVyOwoKICAgIGZ1bmN0aW9uIERTQXV0aCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgTG9nU2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pCiAgICAgICAgYXV0aAogICAgewogICAgICAgIG93bmVyID0gb3duZXJfOwogICAgICAgIExvZ1NldE93bmVyKG93bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBdXRob3JpdHkoRFNBdXRob3JpdHkgYXV0aG9yaXR5XykKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgYXV0aG9yaXR5ID0gYXV0aG9yaXR5XzsKICAgICAgICBMb2dTZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKICAgIH0KCiAgICBtb2RpZmllciBhdXRoIHsKICAgICAgICBhc3NlcnQoaXNBdXRob3JpemVkKG1zZy5zZW5kZXIsIG1zZy5zaWcpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQXV0aG9yaXplZChhZGRyZXNzIHNyYywgYnl0ZXM0IHNpZykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzcmMgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNyYyA9PSBvd25lcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGF1dGhvcml0eSA9PSBEU0F1dGhvcml0eSgwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eS5jYW5DYWxsKHNyYywgdGhpcywgc2lnKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgeCkgaW50ZXJuYWwgewogICAgICAgIGlmICgheCkgdGhyb3c7CiAgICB9Cn0KCgoKCgpjb250cmFjdCBFUkMyMCB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgc3VwcGx5KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBjb25zdGFudCByZXR1cm5zICh1aW50IHZhbHVlKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZSggYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyICkgY29uc3RhbnQgcmV0dXJucyAodWludCBfYWxsb3dhbmNlKTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUgKSByZXR1cm5zIChib29sIG9rKTsKCiAgICBldmVudCBUcmFuc2ZlciggYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbCggYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCmNvbnRyYWN0IERTTWF0aCB7CiAgICAKCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHogPSB4ICogeTsKICAgICAgICBhc3NlcnQoeCA9PSAwIHx8IHogLyB4ID09IHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgeiA9IHggLyB5OwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gbWF4KHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CgoKCiAgICBmdW5jdGlvbiBoYWRkKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICBhc3NlcnQoKHogPSB4ICsgeSkgPj0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gaHN1Yih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgYXNzZXJ0KCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSB4ICogeTsKICAgICAgICBhc3NlcnQoeCA9PSAwIHx8IHogLyB4ID09IHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhkaXYodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSB4IC8geTsKICAgIH0KCiAgICBmdW5jdGlvbiBobWluKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBobWF4KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CgoKCiAgICBmdW5jdGlvbiBpbWluKGludDI1NiB4LCBpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoaW50MjU2IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBpbWF4KGludDI1NiB4LCBpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoaW50MjU2IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CgogICAgLyoKICAgIFdBRCBtYXRoCiAgICAgKi8KCiAgICB1aW50MTI4IGNvbnN0YW50IFdBRCA9IDEwICoqIDE4OwoKICAgIGZ1bmN0aW9uIHdhZGQodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaGFkZCh4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiB3c3ViKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhzdWIoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gd211bCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgeiA9IGNhc3QoKHVpbnQyNTYoeCkgKiB5ICsgV0FEIC8gMikgLyBXQUQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdkaXYodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSBjYXN0KCh1aW50MjU2KHgpICogV0FEICsgeSAvIDIpIC8geSk7CiAgICB9CgogICAgZnVuY3Rpb24gd21pbih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBobWluKHgsIHkpOwogICAgfQogICAgZnVuY3Rpb24gd21heCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBobWF4KHgsIHkpOwogICAgfQoKICAgIC8qCiAgICBSQVkgbWF0aAogICAgICovCgogICAgdWludDEyOCBjb25zdGFudCBSQVkgPSAxMCAqKiAyNzsKCiAgICBmdW5jdGlvbiByYWRkKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhhZGQoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gcnN1Yih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBoc3ViKHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSBjYXN0KCh1aW50MjU2KHgpICogeSArIFJBWSAvIDIpIC8gUkFZKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZGl2KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0gY2FzdCgodWludDI1Nih4KSAqIFJBWSArIHkgLyAyKSAvIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJwb3codWludDEyOCB4LCB1aW50NjQgbikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgCgogICAgICAgIHogPSBuICUgMiAhPSAwID8geCA6IFJBWTsKCiAgICAgICAgZm9yIChuIC89IDI7IG4gIT0gMDsgbiAvPSAyKSB7CiAgICAgICAgICAgIHggPSBybXVsKHgsIHgpOwoKICAgICAgICAgICAgaWYgKG4gJSAyICE9IDApIHsKICAgICAgICAgICAgICAgIHogPSBybXVsKHosIHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJtaW4odWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaG1pbih4LCB5KTsKICAgIH0KICAgIGZ1bmN0aW9uIHJtYXgodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaG1heCh4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYXN0KHVpbnQyNTYgeCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgYXNzZXJ0KCh6ID0gdWludDEyOCh4KSkgPT0geCk7CiAgICB9Cgp9Cgpjb250cmFjdCBJa3VyYVN0b3JhZ2UgaXMgRFNNYXRoLCBEU0F1dGggewogIAogIGFkZHJlc3NbXSBvd25lckFkZHJlc3NlczsKCiAgCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGNvaW5CYWxhbmNlczsKCiAgCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHRva2VuQmFsYW5jZXM7CgogIAogIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBjb2luQWxsb3dhbmNlczsKCiAgCiAgdWludCBfdG90YWxTdXBwbHkgPSAwOwoKICAKICAKICAKICB1aW50IF90cmFuc2ZlckZlZVJhdGUgPSA1MDA7CgogIAogIAogIAogIHVpbnQ4IF90cmFuc2Zlck1pbmltdW1GZWUgPSA1OwoKICBhZGRyZXNzIHRva2VuQWRkcmVzczsKICBhZGRyZXNzIG11bHRpU2lnQWRkcmVzczsKICBhZGRyZXNzIGF1dGhvcml0eUFkZHJlc3M7CgogIAogIAogIAogIGZ1bmN0aW9uIElrdXJhU3RvcmFnZSgpIERTQXV0aCgpIHsKICAgIC8qYWRkcmVzcyBjb250cm9sbGVyQWRkcmVzcyA9IDB4MzRjNTYwNUE0RWYxQzk4NTc1REI2NTQyMTc5RTU1ZUUxZjc3QTE4ODsKICAgIG93bmVyID0gY29udHJvbGxlckFkZHJlc3M7CiAgICBMb2dTZXRPd25lcihjb250cm9sbGVyQWRkcmVzcyk7Ki8KICB9CgogIGZ1bmN0aW9uIGNoYW5nZVRva2VuKGFkZHJlc3MgdG9rZW5BZGRyZXNzXykgYXV0aCB7CiAgICB0b2tlbkFkZHJlc3MgPSB0b2tlbkFkZHJlc3NfOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlQXNzb2NpYXRpb24oYWRkcmVzcyBtdWx0aVNpZ0FkZHJlc3NfKSBhdXRoIHsKICAgIG11bHRpU2lnQWRkcmVzcyA9IG11bHRpU2lnQWRkcmVzc187CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VBdXRob3JpdHkoYWRkcmVzcyBhdXRob3JpdHlBZGRyZXNzXykgYXV0aCB7CiAgICBhdXRob3JpdHlBZGRyZXNzID0gYXV0aG9yaXR5QWRkcmVzc187CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGF1dGggcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIF90b3RhbFN1cHBseTsKICB9CiAgZnVuY3Rpb24gYWRkVG90YWxTdXBwbHkodWludCBhbW91bnQpIGF1dGggewogICAgX3RvdGFsU3VwcGx5ID0gYWRkKF90b3RhbFN1cHBseSwgYW1vdW50KTsKICB9CiAgZnVuY3Rpb24gc3ViVG90YWxTdXBwbHkodWludCBhbW91bnQpIGF1dGggewogICAgX3RvdGFsU3VwcGx5ID0gc3ViKF90b3RhbFN1cHBseSwgYW1vdW50KTsKICB9CiAgZnVuY3Rpb24gdHJhbnNmZXJGZWVSYXRlKCkgYXV0aCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gX3RyYW5zZmVyRmVlUmF0ZTsKICB9CgogIGZ1bmN0aW9uIHNldFRyYW5zZmVyRmVlUmF0ZSh1aW50IG5ld1RyYW5zZmVyRmVlUmF0ZSkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBfdHJhbnNmZXJGZWVSYXRlID0gbmV3VHJhbnNmZXJGZWVSYXRlOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgCiAgCiAgCgogIGZ1bmN0aW9uIHRyYW5zZmVyTWluaW11bUZlZSgpIGF1dGggcmV0dXJucyAodWludDgpIHsKICAgIHJldHVybiBfdHJhbnNmZXJNaW5pbXVtRmVlOwogIH0KCiAgZnVuY3Rpb24gc2V0VHJhbnNmZXJNaW5pbXVtRmVlKHVpbnQ4IG5ld1RyYW5zZmVyTWluaW11bUZlZSkgYXV0aCB7CiAgICBfdHJhbnNmZXJNaW5pbXVtRmVlID0gbmV3VHJhbnNmZXJNaW5pbXVtRmVlOwogIH0KCiAgZnVuY3Rpb24gYWRkT3duZXJBZGRyZXNzKGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgb3duZXJBZGRyZXNzZXMucHVzaChhZGRyKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZU93bmVyQWRkcmVzcyhhZGRyZXNzIGFkZHIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgaSA9IDA7CgogICAgd2hpbGUgKG93bmVyQWRkcmVzc2VzW2ldICE9IGFkZHIpIHsgaSsrOyB9CgogICAgd2hpbGUgKGkgPCBvd25lckFkZHJlc3Nlcy5sZW5ndGggLSAxKSB7CiAgICAgIG93bmVyQWRkcmVzc2VzW2ldID0gb3duZXJBZGRyZXNzZXNbaSArIDFdOwogICAgICBpKys7CiAgICB9CgogICAgb3duZXJBZGRyZXNzZXMubGVuZ3RoLS07CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBwcmltYXJ5T3duZXIoKSBhdXRoIHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBvd25lckFkZHJlc3Nlc1swXTsKICB9CgogIGZ1bmN0aW9uIGlzT3duZXJBZGRyZXNzKGFkZHJlc3MgYWRkcikgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvd25lckFkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAob3duZXJBZGRyZXNzZXNbaV0gPT0gYWRkcikgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gbnVtT3duZXJBZGRyZXNzKCkgYXV0aCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gb3duZXJBZGRyZXNzZXMubGVuZ3RoOwogIH0KCiAgCiAgCiAgCgogIGZ1bmN0aW9uIGNvaW5CYWxhbmNlKGFkZHJlc3MgYWRkcikgYXV0aCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gY29pbkJhbGFuY2VzW2FkZHJdOwogIH0KCiAgZnVuY3Rpb24gYWRkQ29pbkJhbGFuY2UoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBjb2luQmFsYW5jZXNbYWRkcl0gPSBhZGQoY29pbkJhbGFuY2VzW2FkZHJdLCBhbW91bnQpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gc3ViQ29pbkJhbGFuY2UoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBjb2luQmFsYW5jZXNbYWRkcl0gPSBzdWIoY29pbkJhbGFuY2VzW2FkZHJdLCBhbW91bnQpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgCiAgCiAgCgogIGZ1bmN0aW9uIHRva2VuQmFsYW5jZShhZGRyZXNzIGFkZHIpIGF1dGggcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRva2VuQmFsYW5jZXNbYWRkcl07CiAgfQoKICBmdW5jdGlvbiBhZGRUb2tlbkJhbGFuY2UoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICB0b2tlbkJhbGFuY2VzW2FkZHJdID0gYWRkKHRva2VuQmFsYW5jZXNbYWRkcl0sIGFtb3VudCk7CgogICAgaWYgKHRva2VuQmFsYW5jZXNbYWRkcl0gPiAwICYmICFpc093bmVyQWRkcmVzcyhhZGRyKSkgewogICAgICBhZGRPd25lckFkZHJlc3MoYWRkcik7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBzdWJUb2tlbkJhbGFuY2UoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICB0b2tlbkJhbGFuY2VzW2FkZHJdID0gc3ViKHRva2VuQmFsYW5jZXNbYWRkcl0sIGFtb3VudCk7CgogICAgaWYgKHRva2VuQmFsYW5jZXNbYWRkcl0gPD0gMCkgewogICAgICByZW1vdmVPd25lckFkZHJlc3MoYWRkcik7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAKICAKICAKCiAgZnVuY3Rpb24gY29pbkFsbG93YW5jZShhZGRyZXNzIG93bmVyXywgYWRkcmVzcyBzcGVuZGVyKSBhdXRoIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBjb2luQWxsb3dhbmNlc1tvd25lcl9dW3NwZW5kZXJdOwogIH0KCiAgZnVuY3Rpb24gYWRkQ29pbkFsbG93YW5jZShhZGRyZXNzIG93bmVyXywgYWRkcmVzcyBzcGVuZGVyLCB1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBjb2luQWxsb3dhbmNlc1tvd25lcl9dW3NwZW5kZXJdID0gYWRkKGNvaW5BbGxvd2FuY2VzW293bmVyX11bc3BlbmRlcl0sIGFtb3VudCk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBzdWJDb2luQWxsb3dhbmNlKGFkZHJlc3Mgb3duZXJfLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYW1vdW50KSBhdXRoIHJldHVybnMgKGJvb2wpIHsKICAgIGNvaW5BbGxvd2FuY2VzW293bmVyX11bc3BlbmRlcl0gPSBzdWIoY29pbkFsbG93YW5jZXNbb3duZXJfXVtzcGVuZGVyXSwgYW1vdW50KTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHNldENvaW5BbGxvd2FuY2UoYWRkcmVzcyBvd25lcl8sIGFkZHJlc3Mgc3BlbmRlciwgdWludCBhbW91bnQpIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgY29pbkFsbG93YW5jZXNbb3duZXJfXVtzcGVuZGVyXSA9IGFtb3VudDsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGlzQXV0aG9yaXplZChhZGRyZXNzIHNyYywgYnl0ZXM0IHNpZykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgc2lnOyAKCiAgICByZXR1cm4gIHNyYyA9PSBhZGRyZXNzKHRoaXMpIHx8CiAgICAgICAgICAgIHNyYyA9PSBvd25lciB8fAogICAgICAgICAgICBzcmMgPT0gdG9rZW5BZGRyZXNzIHx8CiAgICAgICAgICAgIHNyYyA9PSBhdXRob3JpdHlBZGRyZXNzIHx8CiAgICAgICAgICAgIHNyYyA9PSBtdWx0aVNpZ0FkZHJlc3M7CiAgfQp9Cgpjb250cmFjdCBJa3VyYVRva2VuRXZlbnQgewogIC8qKiDjgqrjg7zjg4rjg7zjgYxkSlBZ44KS6Yuz6YCg44GX44Gf6Zqb44Gr55m654Gr44GZ44KL44Kk44OZ44Oz44OIICovCiAgZXZlbnQgSWt1cmFNaW50KGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCk7CgogIC8qKiDjgqrjg7zjg4rjg7zjgYxkSlBZ44KS5raI5Y2044GX44Gf6Zqb44Gr55m654Gr44GZ44KL44Kk44OZ44Oz44OIICovCiAgZXZlbnQgSWt1cmFCdXJuKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCk7CgogIC8qKiDjg4jjg7zjgq/jg7Pjga7np7vli5XmmYLjgavnmbrngavjgZnjgovjgqTjg5njg7Pjg4ggKi8KICBldmVudCBJa3VyYVRyYW5zZmVyVG9rZW4oYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CgogIC8qKiDmiYvmlbDmlpnjgYznmbrnlJ/jgZfjgZ/jgajjgY3jgavnmbrngavjgZnjgovjgqTjg5njg7Pjg4ggKi8KICBldmVudCBJa3VyYVRyYW5zZmVyRmVlKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCB2YWx1ZSk7CgogIGV2ZW50IElrdXJhVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CgogIC8qKiDpgIHph5HoqLHlj6/jgqTjg5njg7Pjg4ggKi8KICBldmVudCBJa3VyYUFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBJa3VyYUFzc29jaWF0aW9uIGlzIERTTWF0aCwgRFNBdXRoIHsKICAKICAKICAKCiAgCiAgdWludCBwdWJsaWMgY29uZmlybVRvdGFsVG9rZW5UaHJlc2hvbGQgPSA1MDsKCiAgCiAgCiAgCgogIAogIElrdXJhU3RvcmFnZSBfc3RvcmFnZTsKICBJa3VyYVRva2VuIF90b2tlbjsKCiAgCiAgUHJvcG9zYWxbXSBtaW50UHJvcG9zYWxzOwogIFByb3Bvc2FsW10gYnVyblByb3Bvc2FsczsKICBQcm9wb3NhbFtdIHRyYW5zZmVyTWluaW11bUZlZVByb3Bvc2FsczsKICBQcm9wb3NhbFtdIHRyYW5zZmVyRmVlUmF0ZVByb3Bvc2FsczsKCiAgbWFwcGluZyAoYnl0ZXMzMiA9PiBQcm9wb3NhbFtdKSBwcm9wb3NhbHM7CgogIHN0cnVjdCBQcm9wb3NhbCB7CiAgICBhZGRyZXNzIHByb3Bvc2VyOyAgICAgICAgICAgICAgICAgICAgIAogICAgYnl0ZXMzMiBkaWdlc3Q7ICAgICAgICAgICAgICAgICAgICAgICAKICAgIGJvb2wgZXhlY3V0ZWQ7ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICB1aW50IGNyZWF0ZWRBdDsgICAgICAgICAgICAgICAgICAgICAgIAogICAgdWludCBleHBpcmVBdDsgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGFkZHJlc3NbXSBjb25maXJtZXJzOyAgICAgICAgICAgICAgICAgCiAgICB1aW50IGFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgdWludDggdHJhbnNmZXJNaW5pbXVtRmVlOyAgICAgICAgICAgICAKICAgIHVpbnQgdHJhbnNmZXJGZWVSYXRlOyAgICAgICAgICAgICAgICAgCiAgfQoKICAKICAKICAKCiAgZXZlbnQgTWludFByb3Bvc2FsQWRkZWQodWludCBwcm9wb3NhbElkLCBhZGRyZXNzIHByb3Bvc2VyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgTWludENvbmZpcm1lZCh1aW50IHByb3Bvc2FsSWQsIGFkZHJlc3MgY29uZmlybWVyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgTWludEV4ZWN1dGVkKHVpbnQgcHJvcG9zYWxJZCwgYWRkcmVzcyBwcm9wb3NlciwgdWludCBhbW91bnQpOwoKICBldmVudCBCdXJuUHJvcG9zYWxBZGRlZCh1aW50IHByb3Bvc2FsSWQsIGFkZHJlc3MgcHJvcG9zZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBCdXJuQ29uZmlybWVkKHVpbnQgcHJvcG9zYWxJZCwgYWRkcmVzcyBjb25maXJtZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBCdXJuRXhlY3V0ZWQodWludCBwcm9wb3NhbElkLCBhZGRyZXNzIHByb3Bvc2VyLCB1aW50IGFtb3VudCk7CgogIGV2ZW50IFRyYW5zZmVyTWluaW11bUZlZVByb3Bvc2FsQWRkZWQodWludCBwcm9wb3NhbElkLCBhZGRyZXNzIHByb3Bvc2VyLCB1aW50OCB0cmFuc2Zlck1pbmltdW1GZWUpOwogIGV2ZW50IFRyYW5zZmVyTWluaW11bUZlZUNvbmZpcm1lZCh1aW50IHByb3Bvc2FsSWQsIGFkZHJlc3MgY29uZmlybWVyLCB1aW50OCB0cmFuc2Zlck1pbmltdW1GZWUpOwogIGV2ZW50IFRyYW5zZmVyTWluaW11bUZlZUV4ZWN1dGVkKHVpbnQgcHJvcG9zYWxJZCwgYWRkcmVzcyBwcm9wb3NlciwgdWludDggdHJhbnNmZXJNaW5pbXVtRmVlKTsKCiAgZXZlbnQgVHJhbnNmZXJGZWVSYXRlUHJvcG9zYWxBZGRlZCh1aW50IHByb3Bvc2FsSWQsIGFkZHJlc3MgcHJvcG9zZXIsIHVpbnQgdHJhbnNmZXJGZWVSYXRlKTsKICBldmVudCBUcmFuc2ZlckZlZVJhdGVDb25maXJtZWQodWludCBwcm9wb3NhbElkLCBhZGRyZXNzIGNvbmZpcm1lciwgdWludCB0cmFuc2ZlckZlZVJhdGUpOwogIGV2ZW50IFRyYW5zZmVyRmVlUmF0ZUV4ZWN1dGVkKHVpbnQgcHJvcG9zYWxJZCwgYWRkcmVzcyBwcm9wb3NlciwgdWludCB0cmFuc2ZlckZlZVJhdGUpOwoKICBmdW5jdGlvbiBJa3VyYUFzc29jaWF0aW9uKCkgewogICAgcHJvcG9zYWxzW3NoYTMoJ21pbnQnKV0gPSBtaW50UHJvcG9zYWxzOwogICAgcHJvcG9zYWxzW3NoYTMoJ2J1cm4nKV0gPSBidXJuUHJvcG9zYWxzOwogICAgcHJvcG9zYWxzW3NoYTMoJ3RyYW5zZmVyTWluaW11bUZlZScpXSA9IHRyYW5zZmVyTWluaW11bUZlZVByb3Bvc2FsczsKICAgIHByb3Bvc2Fsc1tzaGEzKCd0cmFuc2ZlckZlZVJhdGUnKV0gPSB0cmFuc2ZlckZlZVJhdGVQcm9wb3NhbHM7CgogIH0KCiAgZnVuY3Rpb24gY2hhbmdlU3RvcmFnZShJa3VyYVN0b3JhZ2UgbmV3U3RvcmFnZSkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBfc3RvcmFnZSA9IG5ld1N0b3JhZ2U7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VUb2tlbihJa3VyYVRva2VuIHRva2VuXykgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBfdG9rZW4gPSB0b2tlbl87CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBuZXdQcm9wb3NhbChieXRlczMyIHR5cGVfLCBhZGRyZXNzIHByb3Bvc2VyLCB1aW50IGFtb3VudCwgdWludDggdHJhbnNmZXJNaW5pbXVtRmVlLCB1aW50IHRyYW5zZmVyRmVlUmF0ZSwgYnl0ZXMgdHJhbnNhdGlvbkJ5dGVjb2RlKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IHByb3Bvc2FsSWQgPSBwcm9wb3NhbHNbdHlwZV9dLmxlbmd0aCsrOwogICAgUHJvcG9zYWwgcHJvcG9zYWwgPSBwcm9wb3NhbHNbdHlwZV9dW3Byb3Bvc2FsSWRdOwogICAgcHJvcG9zYWwucHJvcG9zZXIgPSBwcm9wb3NlcjsKICAgIHByb3Bvc2FsLmFtb3VudCA9IGFtb3VudDsKICAgIHByb3Bvc2FsLnRyYW5zZmVyTWluaW11bUZlZSA9IHRyYW5zZmVyTWluaW11bUZlZTsKICAgIHByb3Bvc2FsLnRyYW5zZmVyRmVlUmF0ZSA9IHRyYW5zZmVyRmVlUmF0ZTsKICAgIHByb3Bvc2FsLmRpZ2VzdCA9IHNoYTMocHJvcG9zZXIsIGFtb3VudCwgdHJhbnNhdGlvbkJ5dGVjb2RlKTsKICAgIHByb3Bvc2FsLmV4ZWN1dGVkID0gZmFsc2U7CiAgICBwcm9wb3NhbC5jcmVhdGVkQXQgPSBub3c7CiAgICBwcm9wb3NhbC5leHBpcmVBdCA9IHByb3Bvc2FsLmNyZWF0ZWRBdCArIDg2NDAwOwoKICAgIAogICAgCiAgICBpZiAodHlwZV8gPT0gc2hhMygnbWludCcpKSBNaW50UHJvcG9zYWxBZGRlZChwcm9wb3NhbElkLCBwcm9wb3NlciwgYW1vdW50KTsKICAgIGlmICh0eXBlXyA9PSBzaGEzKCdidXJuJykpIEJ1cm5Qcm9wb3NhbEFkZGVkKHByb3Bvc2FsSWQsIHByb3Bvc2VyLCBhbW91bnQpOwogICAgaWYgKHR5cGVfID09IHNoYTMoJ3RyYW5zZmVyTWluaW11bUZlZScpKSBUcmFuc2Zlck1pbmltdW1GZWVQcm9wb3NhbEFkZGVkKHByb3Bvc2FsSWQsIHByb3Bvc2VyLCB0cmFuc2Zlck1pbmltdW1GZWUpOwogICAgaWYgKHR5cGVfID09IHNoYTMoJ3RyYW5zZmVyRmVlUmF0ZScpKSBUcmFuc2ZlckZlZVJhdGVQcm9wb3NhbEFkZGVkKHByb3Bvc2FsSWQsIHByb3Bvc2VyLCB0cmFuc2ZlckZlZVJhdGUpOwoKICAgIAogICAgY29uZmlybVByb3Bvc2FsKHR5cGVfLCBwcm9wb3NlciwgcHJvcG9zYWxJZCk7CgogICAgcmV0dXJuIHByb3Bvc2FsSWQ7CiAgfQoKICBmdW5jdGlvbiBjb25maXJtUHJvcG9zYWwoYnl0ZXMzMiB0eXBlXywgYWRkcmVzcyBjb25maXJtZXIsIHVpbnQgcHJvcG9zYWxJZCkgewogICAgUHJvcG9zYWwgcHJvcG9zYWwgPSBwcm9wb3NhbHNbdHlwZV9dW3Byb3Bvc2FsSWRdOwoKICAgIAogICAgaWYgKGhhc0NvbmZpcm1lZCh0eXBlXywgY29uZmlybWVyLCBwcm9wb3NhbElkKSkgdGhyb3c7CgogICAgCiAgICBwcm9wb3NhbC5jb25maXJtZXJzLnB1c2goY29uZmlybWVyKTsKCiAgICAKICAgIAogICAgaWYgKHR5cGVfID09IHNoYTMoJ21pbnQnKSkgTWludENvbmZpcm1lZChwcm9wb3NhbElkLCBjb25maXJtZXIsIHByb3Bvc2FsLmFtb3VudCk7CiAgICBpZiAodHlwZV8gPT0gc2hhMygnYnVybicpKSBCdXJuQ29uZmlybWVkKHByb3Bvc2FsSWQsIGNvbmZpcm1lciwgcHJvcG9zYWwuYW1vdW50KTsKICAgIGlmICh0eXBlXyA9PSBzaGEzKCd0cmFuc2Zlck1pbmltdW1GZWUnKSkgVHJhbnNmZXJNaW5pbXVtRmVlQ29uZmlybWVkKHByb3Bvc2FsSWQsIGNvbmZpcm1lciwgcHJvcG9zYWwudHJhbnNmZXJNaW5pbXVtRmVlKTsKICAgIGlmICh0eXBlXyA9PSBzaGEzKCd0cmFuc2ZlckZlZVJhdGUnKSkgVHJhbnNmZXJGZWVSYXRlQ29uZmlybWVkKHByb3Bvc2FsSWQsIGNvbmZpcm1lciwgcHJvcG9zYWwudHJhbnNmZXJGZWVSYXRlKTsKCiAgICBpZiAoaXNQcm9wb3NhbEV4ZWN1dGFibGUodHlwZV8sIHByb3Bvc2FsSWQsIHByb3Bvc2FsLnByb3Bvc2VyLCAnJykpIHsKICAgICAgcHJvcG9zYWwuZXhlY3V0ZWQgPSB0cnVlOwoKICAgICAgCiAgICAgIAogICAgICBpZiAodHlwZV8gPT0gc2hhMygnbWludCcpKSBleGVjdXRlTWludFByb3Bvc2FsKHByb3Bvc2FsSWQpOwogICAgICBpZiAodHlwZV8gPT0gc2hhMygnYnVybicpKSBleGVjdXRlQnVyblByb3Bvc2FsKHByb3Bvc2FsSWQpOwogICAgICBpZiAodHlwZV8gPT0gc2hhMygndHJhbnNmZXJNaW5pbXVtRmVlJykpIGV4ZWN1dGVVcGRhdGVUcmFuc2Zlck1pbmltdW1GZWVQcm9wb3NhbChwcm9wb3NhbElkKTsKICAgICAgaWYgKHR5cGVfID09IHNoYTMoJ3RyYW5zZmVyRmVlUmF0ZScpKSBleGVjdXRlVXBkYXRlVHJhbnNmZXJGZWVSYXRlUHJvcG9zYWwocHJvcG9zYWxJZCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYXNDb25maXJtZWQoYnl0ZXMzMiB0eXBlXywgYWRkcmVzcyBhZGRyLCB1aW50IHByb3Bvc2FsSWQpIHJldHVybnMgKGJvb2wpIHsKICAgIFByb3Bvc2FsIHByb3Bvc2FsID0gcHJvcG9zYWxzW3R5cGVfXVtwcm9wb3NhbElkXTsKICAgIHVpbnQgbGVuZ3RoID0gcHJvcG9zYWwuY29uZmlybWVycy5sZW5ndGg7CgogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHByb3Bvc2FsLmNvbmZpcm1lcnNbaV0gPT0gYWRkcikgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gY29uZmlybWVkVG90YWxUb2tlbihieXRlczMyIHR5cGVfLCB1aW50IHByb3Bvc2FsSWQpIHJldHVybnMgKHVpbnQpIHsKICAgIFByb3Bvc2FsIHByb3Bvc2FsID0gcHJvcG9zYWxzW3R5cGVfXVtwcm9wb3NhbElkXTsKICAgIHVpbnQgbGVuZ3RoID0gcHJvcG9zYWwuY29uZmlybWVycy5sZW5ndGg7CiAgICB1aW50IHRvdGFsID0gMDsKCiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB0b3RhbCA9IGFkZCh0b3RhbCwgX3N0b3JhZ2UudG9rZW5CYWxhbmNlKHByb3Bvc2FsLmNvbmZpcm1lcnNbaV0pKTsKICAgIH0KCiAgICByZXR1cm4gdG90YWw7CiAgfQoKICBmdW5jdGlvbiBwcm9wb3NhbEV4cGlyZUF0KGJ5dGVzMzIgdHlwZV8sIHVpbnQgcHJvcG9zYWxJZCkgcmV0dXJucyAodWludCkgewogICAgUHJvcG9zYWwgcHJvcG9zYWwgPSBwcm9wb3NhbHNbdHlwZV9dW3Byb3Bvc2FsSWRdOwogICAgcmV0dXJuIHByb3Bvc2FsLmV4cGlyZUF0OwogIH0KCiAgZnVuY3Rpb24gaXNQcm9wb3NhbEV4ZWN1dGFibGUoYnl0ZXMzMiB0eXBlXywgdWludCBwcm9wb3NhbElkLCBhZGRyZXNzIHByb3Bvc2VyLCBieXRlcyB0cmFuc2FjdGlvbkJ5dGVjb2RlKSByZXR1cm5zIChib29sKSB7CiAgICBQcm9wb3NhbCBwcm9wb3NhbCA9IHByb3Bvc2Fsc1t0eXBlX11bcHJvcG9zYWxJZF07CgogICAgCiAgICBpZiAoX3N0b3JhZ2UubnVtT3duZXJBZGRyZXNzKCkgPCAyKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHJldHVybiAgcHJvcG9zYWwuZGlnZXN0ID09IHNoYTMocHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCwgdHJhbnNhY3Rpb25CeXRlY29kZSkgJiYKICAgICAgICAgICAgaXNQcm9wb3NhbE5vdEV4cGlyZWQodHlwZV8sIHByb3Bvc2FsSWQpICYmCiAgICAgICAgICAgIGRpdihtdWwoMTAwLCBjb25maXJtZWRUb3RhbFRva2VuKHR5cGVfLCBwcm9wb3NhbElkKSksIF9zdG9yYWdlLnRvdGFsU3VwcGx5KCkpID4gY29uZmlybVRvdGFsVG9rZW5UaHJlc2hvbGQ7CiAgfQoKICBmdW5jdGlvbiBudW1iZXJPZlByb3Bvc2FscyhieXRlczMyIHR5cGVfKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gcHJvcG9zYWxzW3R5cGVfXS5sZW5ndGg7CiAgfQoKICBmdW5jdGlvbiBudW1iZXJPZkFjdGl2ZVByb3Bvc2FscyhieXRlczMyIHR5cGVfKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IG51bUFjdGl2ZVByb3Bvc2FsID0gMDsKCiAgICBmb3IodWludCBpID0gMDsgaSA8IHByb3Bvc2Fsc1t0eXBlX10ubGVuZ3RoOyBpKyspIHsKICAgICAgUHJvcG9zYWwgcHJvcG9zYWwgPSBwcm9wb3NhbHNbdHlwZV9dW2ldOwoKICAgICAgaWYgKGlzUHJvcG9zYWxOb3RFeHBpcmVkKHR5cGVfLCBpKSkgewogICAgICAgIG51bUFjdGl2ZVByb3Bvc2FsKys7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbnVtQWN0aXZlUHJvcG9zYWw7CiAgfQoKICBmdW5jdGlvbiBpc1Byb3Bvc2FsTm90RXhwaXJlZChieXRlczMyIHR5cGVfLCB1aW50IHByb3Bvc2FsSWQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgIFByb3Bvc2FsIHByb3Bvc2FsID0gcHJvcG9zYWxzW3R5cGVfXVtwcm9wb3NhbElkXTsKCiAgICByZXR1cm4gICFwcm9wb3NhbC5leGVjdXRlZCAmJgogICAgICAgICAgICBub3cgPCBwcm9wb3NhbC5leHBpcmVBdDsKICB9CgogIGZ1bmN0aW9uIGV4ZWN1dGVNaW50UHJvcG9zYWwodWludCBwcm9wb3NhbElkKSBpbnRlcm5hbCB7CiAgICBQcm9wb3NhbCBwcm9wb3NhbCA9IHByb3Bvc2Fsc1tzaGEzKCdtaW50JyldW3Byb3Bvc2FsSWRdOwoKICAgIAogICAgaWYgKHByb3Bvc2FsLmFtb3VudCA8PSAwKSB0aHJvdzsKCiAgICBNaW50RXhlY3V0ZWQocHJvcG9zYWxJZCwgcHJvcG9zYWwucHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCk7CgogICAgCiAgICBfc3RvcmFnZS5hZGRUb3RhbFN1cHBseShwcm9wb3NhbC5hbW91bnQpOwogICAgX3N0b3JhZ2UuYWRkQ29pbkJhbGFuY2UocHJvcG9zYWwucHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCk7CiAgICBfc3RvcmFnZS5hZGRUb2tlbkJhbGFuY2UocHJvcG9zYWwucHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCk7CiAgfQoKICBmdW5jdGlvbiBleGVjdXRlQnVyblByb3Bvc2FsKHVpbnQgcHJvcG9zYWxJZCkgaW50ZXJuYWwgewogICAgUHJvcG9zYWwgcHJvcG9zYWwgPSBwcm9wb3NhbHNbc2hhMygnYnVybicpXVtwcm9wb3NhbElkXTsKCiAgICAKICAgIGlmIChwcm9wb3NhbC5hbW91bnQgPD0gMCkgdGhyb3c7CiAgICBpZiAoX3N0b3JhZ2UuY29pbkJhbGFuY2UocHJvcG9zYWwucHJvcG9zZXIpIDwgcHJvcG9zYWwuYW1vdW50KSB0aHJvdzsKICAgIGlmIChfc3RvcmFnZS50b2tlbkJhbGFuY2UocHJvcG9zYWwucHJvcG9zZXIpIDwgcHJvcG9zYWwuYW1vdW50KSB0aHJvdzsKCiAgICBCdXJuRXhlY3V0ZWQocHJvcG9zYWxJZCwgcHJvcG9zYWwucHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCk7CgogICAgCiAgICBfc3RvcmFnZS5zdWJUb3RhbFN1cHBseShwcm9wb3NhbC5hbW91bnQpOwogICAgX3N0b3JhZ2Uuc3ViQ29pbkJhbGFuY2UocHJvcG9zYWwucHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCk7CiAgICBfc3RvcmFnZS5zdWJUb2tlbkJhbGFuY2UocHJvcG9zYWwucHJvcG9zZXIsIHByb3Bvc2FsLmFtb3VudCk7CiAgfQoKICBmdW5jdGlvbiBleGVjdXRlVXBkYXRlVHJhbnNmZXJNaW5pbXVtRmVlUHJvcG9zYWwodWludCBwcm9wb3NhbElkKSBpbnRlcm5hbCB7CiAgICBQcm9wb3NhbCBwcm9wb3NhbCA9IHByb3Bvc2Fsc1tzaGEzKCd0cmFuc2Zlck1pbmltdW1GZWUnKV1bcHJvcG9zYWxJZF07CgogICAgaWYgKHByb3Bvc2FsLnRyYW5zZmVyTWluaW11bUZlZSA8IDApIHRocm93OwoKICAgIFRyYW5zZmVyTWluaW11bUZlZUV4ZWN1dGVkKHByb3Bvc2FsSWQsIHByb3Bvc2FsLnByb3Bvc2VyLCBwcm9wb3NhbC50cmFuc2Zlck1pbmltdW1GZWUpOwoKICAgIF9zdG9yYWdlLnNldFRyYW5zZmVyTWluaW11bUZlZShwcm9wb3NhbC50cmFuc2Zlck1pbmltdW1GZWUpOwogIH0KCiAgZnVuY3Rpb24gZXhlY3V0ZVVwZGF0ZVRyYW5zZmVyRmVlUmF0ZVByb3Bvc2FsKHVpbnQgcHJvcG9zYWxJZCkgaW50ZXJuYWwgewogICAgUHJvcG9zYWwgcHJvcG9zYWwgPSBwcm9wb3NhbHNbc2hhMygndHJhbnNmZXJGZWVSYXRlJyldW3Byb3Bvc2FsSWRdOwoKICAgIGlmIChwcm9wb3NhbC50cmFuc2ZlckZlZVJhdGUgPCAwKSB0aHJvdzsKCiAgICBUcmFuc2ZlckZlZVJhdGVFeGVjdXRlZChwcm9wb3NhbElkLCBwcm9wb3NhbC5wcm9wb3NlciwgcHJvcG9zYWwudHJhbnNmZXJGZWVSYXRlKTsKCiAgICBfc3RvcmFnZS5zZXRUcmFuc2ZlckZlZVJhdGUocHJvcG9zYWwudHJhbnNmZXJGZWVSYXRlKTsKICB9CgogIGZ1bmN0aW9uIGlzQXV0aG9yaXplZChhZGRyZXNzIHNyYywgYnl0ZXM0IHNpZykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgc2lnOyAKCiAgICByZXR1cm4gIHNyYyA9PSBhZGRyZXNzKHRoaXMpIHx8CiAgICAgICAgICAgIHNyYyA9PSBvd25lciB8fAogICAgICAgICAgICBzcmMgPT0gYWRkcmVzcyhfdG9rZW4pOwogIH0KfQpsaWJyYXJ5IFByb3Bvc2FsTGlicmFyeSB7CiAgCiAgCiAgCgogIAogIHN0cnVjdCBFbnRpdHkgewogICAgSWt1cmFTdG9yYWdlIF9zdG9yYWdlOwogICAgSWt1cmFBc3NvY2lhdGlvbiBfYXNzb2NpYXRpb247CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VTdG9yYWdlKEVudGl0eSBzdG9yYWdlIHNlbGYsIGFkZHJlc3Mgc3RvcmFnZV8pIGludGVybmFsIHsKICAgIHNlbGYuX3N0b3JhZ2UgPSBJa3VyYVN0b3JhZ2Uoc3RvcmFnZV8pOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlQXNzb2NpYXRpb24oRW50aXR5IHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBhc3NvY2lhdGlvbl8pIGludGVybmFsIHsKICAgIHNlbGYuX2Fzc29jaWF0aW9uID0gSWt1cmFBc3NvY2lhdGlvbihhc3NvY2lhdGlvbl8pOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlVHJhbnNmZXJNaW5pbXVtRmVlKEVudGl0eSBzdG9yYWdlIHNlbGYsIGFkZHJlc3Mgc2VuZGVyLCB1aW50OCBmZWUpIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChmZWUgPCAwKSB0aHJvdzsKCiAgICBzZWxmLl9hc3NvY2lhdGlvbi5uZXdQcm9wb3NhbChzaGEzKCd0cmFuc2Zlck1pbmltdW1GZWUnKSwgc2VuZGVyLCAwLCBmZWUsIDAsICcnKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZVRyYW5zZmVyRmVlUmF0ZShFbnRpdHkgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHNlbmRlciwgdWludCByYXRlKSByZXR1cm5zIChib29sKSB7CiAgICBpZiAocmF0ZSA8IDApIHRocm93OwoKICAgIHNlbGYuX2Fzc29jaWF0aW9uLm5ld1Byb3Bvc2FsKHNoYTMoJ3RyYW5zZmVyRmVlUmF0ZScpLCBzZW5kZXIsIDAsIDAsIHJhdGUsICcnKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIG1pbnQoRW50aXR5IHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBzZW5kZXIsIHVpbnQgYW1vdW50KSByZXR1cm5zIChib29sKSB7CiAgICBpZiAoYW1vdW50IDw9IDApIHRocm93OwoKICAgIHNlbGYuX2Fzc29jaWF0aW9uLm5ld1Byb3Bvc2FsKHNoYTMoJ21pbnQnKSwgc2VuZGVyLCBhbW91bnQsIDAsIDAsICcnKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGJ1cm4oRW50aXR5IHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBzZW5kZXIsIHVpbnQgYW1vdW50KSByZXR1cm5zIChib29sKSB7CiAgICBpZiAoYW1vdW50IDw9IDApIHRocm93OwogICAgaWYgKHNlbGYuX3N0b3JhZ2UuY29pbkJhbGFuY2Uoc2VuZGVyKSA8IGFtb3VudCkgdGhyb3c7CiAgICBpZiAoc2VsZi5fc3RvcmFnZS50b2tlbkJhbGFuY2Uoc2VuZGVyKSA8IGFtb3VudCkgdGhyb3c7CgogICAgc2VsZi5fYXNzb2NpYXRpb24ubmV3UHJvcG9zYWwoc2hhMygnYnVybicpLCBzZW5kZXIsIGFtb3VudCwgMCwgMCwgJycpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gY29uZmlybVByb3Bvc2FsKEVudGl0eSBzdG9yYWdlIHNlbGYsIGFkZHJlc3Mgc2VuZGVyLCBieXRlczMyIHR5cGVfLCB1aW50IHByb3Bvc2FsSWQpIHsKICAgIHNlbGYuX2Fzc29jaWF0aW9uLmNvbmZpcm1Qcm9wb3NhbCh0eXBlXywgc2VuZGVyLCBwcm9wb3NhbElkKTsKICB9CgogIGZ1bmN0aW9uIG51bWJlck9mUHJvcG9zYWxzKEVudGl0eSBzdG9yYWdlIHNlbGYsIGJ5dGVzMzIgdHlwZV8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBzZWxmLl9hc3NvY2lhdGlvbi5udW1iZXJPZlByb3Bvc2Fscyh0eXBlXyk7CiAgfQp9Cgpjb250cmFjdCBJa3VyYVRva2VuIGlzIElrdXJhVG9rZW5FdmVudCwgRFNNYXRoLCBEU0F1dGggewogIAogIAogIAoKICAvKnVzaW5nIFByb3Bvc2FsTGlicmFyeSBmb3IgUHJvcG9zYWxMaWJyYXJ5LkVudGl0eTsKICBQcm9wb3NhbExpYnJhcnkuRW50aXR5IHByb3Bvc2FsRW50aXR5OyovCgogIAogIAogIAoKICAKICBJa3VyYVN0b3JhZ2UgX3N0b3JhZ2U7CiAgSWt1cmFBc3NvY2lhdGlvbiBfYXNzb2NpYXRpb247CgogIGZ1bmN0aW9uIElrdXJhVG9rZW4oKSBEU0F1dGgoKSB7CiAgICAKICAgIAogICAgCiAgICAvKmFkZHJlc3MgY29udHJvbGxlckFkZHJlc3MgPSAweDM0YzU2MDVBNEVmMUM5ODU3NURCNjU0MjE3OUU1NWVFMWY3N0ExODg7CiAgICBvd25lciA9IGNvbnRyb2xsZXJBZGRyZXNzOwogICAgTG9nU2V0T3duZXIoY29udHJvbGxlckFkZHJlc3MpOyovCiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseShhZGRyZXNzIHNlbmRlcikgYXV0aCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICBzZW5kZXI7IAoKICAgIHJldHVybiBfc3RvcmFnZS50b3RhbFN1cHBseSgpOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgc2VuZGVyLCBhZGRyZXNzIGFkZHIpIGF1dGggY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgc2VuZGVyOyAKCiAgICByZXR1cm4gX3N0b3JhZ2UuY29pbkJhbGFuY2UoYWRkcik7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyB0bywgdWludCBhbW91bnQpIGF1dGggcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IGZlZSA9IHRyYW5zZmVyRmVlKHNlbmRlciwgc2VuZGVyLCB0bywgYW1vdW50KTsKCiAgICBpZiAoX3N0b3JhZ2UuY29pbkJhbGFuY2Uoc2VuZGVyKSA8IGFkZChhbW91bnQsIGZlZSkpIHRocm93OwogICAgaWYgKGFtb3VudCA8PSAwKSB0aHJvdzsKCiAgICAKICAgIGFkZHJlc3Mgb3duZXIgPSBzZWxlY3RPd25lckFkZHJlc3NGb3JUcmFuc2FjdGlvbkZlZShzZW5kZXIpOwoKICAgIAogICAgX3N0b3JhZ2Uuc3ViQ29pbkJhbGFuY2Uoc2VuZGVyLCBhZGQoYW1vdW50LCBmZWUpKTsKCiAgICAKICAgIF9zdG9yYWdlLmFkZENvaW5CYWxhbmNlKHRvLCBhbW91bnQpOwoKICAgIAogICAgX3N0b3JhZ2UuYWRkQ29pbkJhbGFuY2Uob3duZXIsIGZlZSk7CgogICAgCiAgICBJa3VyYVRyYW5zZmVyKHNlbmRlciwgdG8sIGFtb3VudCk7CiAgICBJa3VyYVRyYW5zZmVyRmVlKHNlbmRlciwgdG8sIG93bmVyLCBmZWUpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc2VuZGVyLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KSBhdXRoIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBmZWUgPSB0cmFuc2ZlckZlZShzZW5kZXIsIGZyb20sIHRvLCBhbW91bnQpOwoKICAgIGlmIChfc3RvcmFnZS5jb2luQmFsYW5jZShmcm9tKSA8IGFtb3VudCkgdGhyb3c7CiAgICBpZiAoX3N0b3JhZ2UuY29pbkFsbG93YW5jZShmcm9tLCBzZW5kZXIpIDwgYW1vdW50KSB0aHJvdzsKICAgIGlmIChhbW91bnQgPD0gMCkgdGhyb3c7CiAgICBpZiAoYWRkKF9zdG9yYWdlLmNvaW5CYWxhbmNlKHRvKSwgYW1vdW50KSA8PSBfc3RvcmFnZS5jb2luQmFsYW5jZSh0bykpIHRocm93OwogICAgaWYgKF9zdG9yYWdlLmNvaW5CYWxhbmNlKHNlbmRlcikgPCBmZWUpIHRocm93OwoKICAgIAogICAgYWRkcmVzcyBvd25lciA9IHNlbGVjdE93bmVyQWRkcmVzc0ZvclRyYW5zYWN0aW9uRmVlKHNlbmRlcik7CgogICAgCiAgICBfc3RvcmFnZS5zdWJDb2luQmFsYW5jZShzZW5kZXIsIGZlZSk7CgogICAgCiAgICBfc3RvcmFnZS5zdWJDb2luQmFsYW5jZShmcm9tLCBhbW91bnQpOwoKICAgIAogICAgX3N0b3JhZ2Uuc3ViQ29pbkFsbG93YW5jZShmcm9tLCBzZW5kZXIsIGFtb3VudCk7CgogICAgCiAgICBfc3RvcmFnZS5hZGRDb2luQmFsYW5jZSh0bywgYW1vdW50KTsKCiAgICAKICAgIF9zdG9yYWdlLmFkZENvaW5CYWxhbmNlKG93bmVyLCBmZWUpOwoKICAgIAogICAgSWt1cmFUcmFuc2Zlcihmcm9tLCB0bywgYW1vdW50KTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludCBhbW91bnQpIGF1dGggcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBfc3RvcmFnZS5zZXRDb2luQWxsb3dhbmNlKHNlbmRlciwgc3BlbmRlciwgYW1vdW50KTsKCiAgICAKICAgIElrdXJhQXBwcm92YWwoc2VuZGVyLCBzcGVuZGVyLCBhbW91bnQpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBhdXRoIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICBzZW5kZXI7IAoKICAgIHJldHVybiBfc3RvcmFnZS5jb2luQWxsb3dhbmNlKG93bmVyLCBzcGVuZGVyKTsKICB9CgogIAogIAogIAoKCiAgZnVuY3Rpb24gdG9rZW5CYWxhbmNlT2YoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3Mgb3duZXIpIGF1dGggY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICBzZW5kZXI7IAoKICAgIHJldHVybiBfc3RvcmFnZS50b2tlbkJhbGFuY2Uob3duZXIpOwogIH0KCgogIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KSBhdXRoIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgaWYgKF9zdG9yYWdlLnRva2VuQmFsYW5jZShzZW5kZXIpIDwgYW1vdW50ICkgdGhyb3c7CiAgICBpZiAoYW1vdW50IDw9IDApIHRocm93OwogICAgaWYgKGFkZChfc3RvcmFnZS50b2tlbkJhbGFuY2UodG8pLCBhbW91bnQpIDw9IF9zdG9yYWdlLnRva2VuQmFsYW5jZSh0bykpIHRocm93OwoKICAgIF9zdG9yYWdlLnN1YlRva2VuQmFsYW5jZShzZW5kZXIsIGFtb3VudCk7CiAgICBfc3RvcmFnZS5hZGRUb2tlbkJhbGFuY2UodG8sIGFtb3VudCk7CgogICAgSWt1cmFUcmFuc2ZlclRva2VuKHNlbmRlciwgdG8sIGFtb3VudCk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKCiAgZnVuY3Rpb24gdHJhbnNmZXJGZWVSYXRlKGFkZHJlc3Mgc2VuZGVyKSBhdXRoIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHNlbmRlcjsgCgogICAgcmV0dXJuIF9zdG9yYWdlLnRyYW5zZmVyRmVlUmF0ZSgpOwogIH0KCgogIGZ1bmN0aW9uIHRyYW5zZmVyTWluaW11bUZlZShhZGRyZXNzIHNlbmRlcikgYXV0aCBjb25zdGFudCByZXR1cm5zICh1aW50OCkgewogICAgc2VuZGVyOyAKCiAgICByZXR1cm4gX3N0b3JhZ2UudHJhbnNmZXJNaW5pbXVtRmVlKCk7CiAgfQoKCiAgZnVuY3Rpb24gdHJhbnNmZXJGZWUoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCBhbW91bnQpIGF1dGggcmV0dXJucyAodWludCkgewogICAgZnJvbTsgdG87IAoKICAgIHVpbnQgcmF0ZSA9IHRyYW5zZmVyRmVlUmF0ZShzZW5kZXIpOwogICAgdWludCBkZW5vbWluYXRvciA9IDEwMDAwMDA7IAogICAgdWludCBudW1lcmF0b3IgPSBtdWwoYW1vdW50LCByYXRlKTsKCiAgICB1aW50IGZlZSA9IGRpdihudW1lcmF0b3IsIGRlbm9taW5hdG9yKTsKICAgIHVpbnQgcmVtYWluZGVyID0gc3ViKG51bWVyYXRvciwgbXVsKGRlbm9taW5hdG9yLCBmZWUpKTsKCiAgICAKICAgIGlmIChyZW1haW5kZXIgPiAwKSB7CiAgICAgIGZlZSsrOwogICAgfQoKICAgIGlmIChmZWUgPCB0cmFuc2Zlck1pbmltdW1GZWUoc2VuZGVyKSkgewogICAgICBmZWUgPSB0cmFuc2Zlck1pbmltdW1GZWUoc2VuZGVyKTsKICAgIH0KCiAgICByZXR1cm4gZmVlOwogIH0KCgogIGZ1bmN0aW9uIHVwZGF0ZVRyYW5zZmVyTWluaW11bUZlZShhZGRyZXNzIHNlbmRlciwgdWludDggZmVlKSBhdXRoIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChmZWUgPCAwKSB0aHJvdzsKCiAgICBfYXNzb2NpYXRpb24ubmV3UHJvcG9zYWwoc2hhMygndHJhbnNmZXJNaW5pbXVtRmVlJyksIHNlbmRlciwgMCwgZmVlLCAwLCAnJyk7CiAgICByZXR1cm4gdHJ1ZTsKCiAgICAvKnJldHVybiBwcm9wb3NhbEVudGl0eS51cGRhdGVUcmFuc2Zlck1pbmltdW1GZWUoc2VuZGVyLCBmZWUpOyovCiAgfQoKCiAgZnVuY3Rpb24gdXBkYXRlVHJhbnNmZXJGZWVSYXRlKGFkZHJlc3Mgc2VuZGVyLCB1aW50IHJhdGUpIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgaWYgKHJhdGUgPCAwKSB0aHJvdzsKCiAgICBfYXNzb2NpYXRpb24ubmV3UHJvcG9zYWwoc2hhMygndHJhbnNmZXJGZWVSYXRlJyksIHNlbmRlciwgMCwgMCwgcmF0ZSwgJycpOwogICAgcmV0dXJuIHRydWU7CgogICAgLypyZXR1cm4gcHJvcG9zYWxFbnRpdHkudXBkYXRlVHJhbnNmZXJGZWVSYXRlKHNlbmRlciwgcmF0ZSk7Ki8KICB9CgoKICBmdW5jdGlvbiBzZWxlY3RPd25lckFkZHJlc3NGb3JUcmFuc2FjdGlvbkZlZShhZGRyZXNzIHNlbmRlcikgYXV0aCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICBzZW5kZXI7IAoKICAgIHJldHVybiBfc3RvcmFnZS5wcmltYXJ5T3duZXIoKTsKICB9CgogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBzZW5kZXIsIHVpbnQgYW1vdW50KSBhdXRoIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChhbW91bnQgPD0gMCkgdGhyb3c7CgogICAgX2Fzc29jaWF0aW9uLm5ld1Byb3Bvc2FsKHNoYTMoJ21pbnQnKSwgc2VuZGVyLCBhbW91bnQsIDAsIDAsICcnKTsKCiAgICAvKnJldHVybiBwcm9wb3NhbEVudGl0eS5taW50KHNlbmRlciwgYW1vdW50KTsqLwogIH0KCgogIGZ1bmN0aW9uIGJ1cm4oYWRkcmVzcyBzZW5kZXIsIHVpbnQgYW1vdW50KSBhdXRoIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChhbW91bnQgPD0gMCkgdGhyb3c7CiAgICBpZiAoX3N0b3JhZ2UuY29pbkJhbGFuY2Uoc2VuZGVyKSA8IGFtb3VudCkgdGhyb3c7CiAgICBpZiAoX3N0b3JhZ2UudG9rZW5CYWxhbmNlKHNlbmRlcikgPCBhbW91bnQpIHRocm93OwoKICAgIF9hc3NvY2lhdGlvbi5uZXdQcm9wb3NhbChzaGEzKCdidXJuJyksIHNlbmRlciwgYW1vdW50LCAwLCAwLCAnJyk7CiAgICAvKnJldHVybiBwcm9wb3NhbEVudGl0eS5idXJuKHNlbmRlciwgYW1vdW50KTsqLwogIH0KCiAgZnVuY3Rpb24gY29uZmlybVByb3Bvc2FsKGFkZHJlc3Mgc2VuZGVyLCBieXRlczMyIHR5cGVfLCB1aW50IHByb3Bvc2FsSWQpIGF1dGggewogICAgX2Fzc29jaWF0aW9uLmNvbmZpcm1Qcm9wb3NhbCh0eXBlXywgc2VuZGVyLCBwcm9wb3NhbElkKTsKICAgIC8qcHJvcG9zYWxFbnRpdHkuY29uZmlybVByb3Bvc2FsKHNlbmRlciwgdHlwZV8sIHByb3Bvc2FsSWQpOyovCiAgfQoKCiAgZnVuY3Rpb24gbnVtYmVyT2ZQcm9wb3NhbHMoYnl0ZXMzMiB0eXBlXykgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIF9hc3NvY2lhdGlvbi5udW1iZXJPZlByb3Bvc2Fscyh0eXBlXyk7CiAgICAvKnJldHVybiBwcm9wb3NhbEVudGl0eS5udW1iZXJPZlByb3Bvc2Fscyh0eXBlXyk7Ki8KICB9CgoKICBmdW5jdGlvbiBjaGFuZ2VBc3NvY2lhdGlvbihhZGRyZXNzIGFzc29jaWF0aW9uXykgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICBfYXNzb2NpYXRpb24gPSBJa3VyYUFzc29jaWF0aW9uKGFzc29jaWF0aW9uXyk7CiAgICAvKnByb3Bvc2FsRW50aXR5LmNoYW5nZUFzc29jaWF0aW9uKF9hc3NvY2lhdGlvbik7Ki8KCiAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICBmdW5jdGlvbiBjaGFuZ2VTdG9yYWdlKGFkZHJlc3Mgc3RvcmFnZV8pIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgX3N0b3JhZ2UgPSBJa3VyYVN0b3JhZ2Uoc3RvcmFnZV8pOwogICAgLypwcm9wb3NhbEVudGl0eS5jaGFuZ2VTdG9yYWdlKF9zdG9yYWdlKTsqLwoKICAgIHJldHVybiB0cnVlOwogIH0KCgogIGZ1bmN0aW9uIGxvZ2ljVmVyc2lvbihhZGRyZXNzIHNlbmRlcikgYXV0aCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICBzZW5kZXI7IAoKICAgIHJldHVybiAxOwogIH0KfQoKCmNvbnRyYWN0IElrdXJhQXV0aG9yaXR5IGlzIERTQXV0aG9yaXR5LCBEU0F1dGggewogIAogIElrdXJhU3RvcmFnZSB0b2tlblN0b3JhZ2U7CgogIAogIAogIG1hcHBpbmcoYnl0ZXM0ID0+IGJvb2wpIGFjdGlvbnNXaXRoVG9rZW47CgogIAogIG1hcHBpbmcoYnl0ZXM0ID0+IGJvb2wpIGFjdGlvbnNGb3JiaWRkZW47CgogIAogIAogIAogIGZ1bmN0aW9uIElrdXJhQXV0aG9yaXR5KCkgRFNBdXRoKCkgewogICAgLyphZGRyZXNzIGNvbnRyb2xsZXJBZGRyZXNzID0gMHgzNGM1NjA1QTRFZjFDOTg1NzVEQjY1NDIxNzlFNTVlRTFmNzdBMTg4OwogICAgb3duZXIgPSBjb250cm9sbGVyQWRkcmVzczsKICAgIExvZ1NldE93bmVyKGNvbnRyb2xsZXJBZGRyZXNzKTsqLwogIH0KCgogIGZ1bmN0aW9uIGNoYW5nZVN0b3JhZ2UoYWRkcmVzcyBzdG9yYWdlXykgYXV0aCB7CiAgICB0b2tlblN0b3JhZ2UgPSBJa3VyYVN0b3JhZ2Uoc3RvcmFnZV8pOwoKICAgIAogICAgYWN0aW9uc1dpdGhUb2tlbltzdHJpbmdUb1NpZygnbWludCh1aW50MjU2KScpXSA9IHRydWU7CiAgICBhY3Rpb25zV2l0aFRva2VuW3N0cmluZ1RvU2lnKCdidXJuKHVpbnQyNTYpJyldID0gdHJ1ZTsKICAgIGFjdGlvbnNXaXRoVG9rZW5bc3RyaW5nVG9TaWcoJ3VwZGF0ZVRyYW5zZmVyTWluaW11bUZlZSh1aW50OCknKV0gPSB0cnVlOwogICAgYWN0aW9uc1dpdGhUb2tlbltzdHJpbmdUb1NpZygndXBkYXRlVHJhbnNmZXJGZWVSYXRlKHVpbnQyNTYpJyldID0gdHJ1ZTsKICAgIGFjdGlvbnNXaXRoVG9rZW5bc3RyaW5nVG9TaWcoJ2NvbmZpcm1Qcm9wb3NhbChzdHJpbmcsIHVpbnQyNTYpJyldID0gdHJ1ZTsKICAgIGFjdGlvbnNXaXRoVG9rZW5bc3RyaW5nVG9TaWcoJ251bWJlck9mUHJvcG9zYWxzKHN0cmluZyknKV0gPSB0cnVlOwoKICAgIAogICAgYWN0aW9uc0ZvcmJpZGRlbltzdHJpbmdUb1NpZygnZm9yYmlkZGVuQWN0aW9uKCknKV0gPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gY2FuQ2FsbChhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIGJ5dGVzNCBzaWcpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIAogICAgaWYgKGFjdGlvbnNXaXRoVG9rZW5bc2lnXSkgcmV0dXJuIGNhbkNhbGxXaXRoQXNzb2NpYXRpb24oc3JjLCBkc3QpOwoKICAgIAogICAgaWYgKGFjdGlvbnNGb3JiaWRkZW5bc2lnXSkgcmV0dXJuIGNhbkNhbGxXaXRoTm9PbmUoKTsKCiAgICAKICAgIHJldHVybiBjYW5DYWxsRGVmYXVsdChzcmMpOwogIH0KCiAgZnVuY3Rpb24gY2FuQ2FsbERlZmF1bHQoYWRkcmVzcyBzcmMpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0b2tlblN0b3JhZ2UuaXNPd25lckFkZHJlc3Moc3JjKTsKICB9CgoKICBmdW5jdGlvbiBjYW5DYWxsV2l0aEFzc29jaWF0aW9uKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgCiAgICBkc3Q7CgogICAgcmV0dXJuIHRva2VuU3RvcmFnZS5pc093bmVyQWRkcmVzcyhzcmMpICYmCiAgICAgICAgICAgKHRva2VuU3RvcmFnZS5udW1Pd25lckFkZHJlc3MoKSA9PSAxIHx8IHRva2VuU3RvcmFnZS50b2tlbkJhbGFuY2Uoc3JjKSA+IDApOwogIH0KCgogIGZ1bmN0aW9uIGNhbkNhbGxXaXRoTm9PbmUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKCiAgZnVuY3Rpb24gc3RyaW5nVG9TaWcoc3RyaW5nIHN0cikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXM0KSB7CiAgICByZXR1cm4gYnl0ZXM0KHNoYTMoc3RyKSk7CiAgfQp9CgoKY29udHJhY3QgSWt1cmFDb250cm9sbGVyIGlzIEVSQzIwLCBEU0F1dGggewogIAogIAogIAoKICAKICBzdHJpbmcgcHVibGljIG5hbWUgPSAiWEpQIDAuNi4wIjsKCiAgCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiWEpQIjsKCiAgCiAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMDsKCiAgCiAgCiAgCgogIAogIAogIElrdXJhVG9rZW4gcHJpdmF0ZSB0b2tlbjsKCiAgCiAgSWt1cmFTdG9yYWdlIHByaXZhdGUgdG9rZW5TdG9yYWdlOwoKICAKICBJa3VyYUF1dGhvcml0eSBwcml2YXRlIGF1dGhvcml0eTsKCiAgCiAgSWt1cmFBc3NvY2lhdGlvbiBwcml2YXRlIGFzc29jaWF0aW9uOwoKICAKICAKICAKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG9rZW4udG90YWxTdXBwbHkobXNnLnNlbmRlcik7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBhZGRyKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIsIGFkZHIpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCBhbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgIGlmICh0b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgYW1vdW50KSkgewogICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgYW1vdW50KTsKCiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCBhbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgIGlmICh0b2tlbi50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgZnJvbSwgdG8sIGFtb3VudCkpIHsKICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIGFtb3VudCk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IGFtb3VudCkgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKHRva2VuLmFwcHJvdmUobXNnLnNlbmRlciwgc3BlbmRlciwgYW1vdW50KSkgewogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbW91bnQpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBhZGRyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi5hbGxvd2FuY2UobXNnLnNlbmRlciwgYWRkciwgc3BlbmRlcik7CiAgfQoKICAKICAKICAKCiAgZnVuY3Rpb24gdG9rZW5CYWxhbmNlT2YoYWRkcmVzcyBhZGRyKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG9rZW4udG9rZW5CYWxhbmNlT2YobXNnLnNlbmRlciwgYWRkcik7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuKGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJUb2tlbihtc2cuc2VuZGVyLCB0bywgYW1vdW50KTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRmVlUmF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2ZlckZlZVJhdGUobXNnLnNlbmRlcik7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2Zlck1pbmltdW1GZWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCkgewogICAgcmV0dXJuIHRva2VuLnRyYW5zZmVyTWluaW11bUZlZShtc2cuc2VuZGVyKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRmVlKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCBhbW91bnQpIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2ZlckZlZShtc2cuc2VuZGVyLCBmcm9tLCB0bywgYW1vdW50KTsKICB9CgogIAoKICBmdW5jdGlvbiB1cGRhdGVUcmFuc2Zlck1pbmltdW1GZWUodWludDggbWluaW11bUZlZSkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW4udXBkYXRlVHJhbnNmZXJNaW5pbXVtRmVlKG1zZy5zZW5kZXIsIG1pbmltdW1GZWUpOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlVHJhbnNmZXJGZWVSYXRlKHVpbnQgZmVlUmF0ZSkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW4udXBkYXRlVHJhbnNmZXJGZWVSYXRlKG1zZy5zZW5kZXIsIGZlZVJhdGUpOwogIH0KCiAgZnVuY3Rpb24gbWludCh1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW4ubWludChtc2cuc2VuZGVyLCBhbW91bnQpOwogIH0KCiAgZnVuY3Rpb24gYnVybih1aW50IGFtb3VudCkgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW4uYnVybihtc2cuc2VuZGVyLCBhbW91bnQpOwogIH0KCiAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIGFkZHIpIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRva2VuU3RvcmFnZS5pc093bmVyQWRkcmVzcyhhZGRyKTsKICB9CgoKICBmdW5jdGlvbiBjb25maXJtUHJvcG9zYWwoc3RyaW5nIHR5cGVfLCB1aW50IHByb3Bvc2FsSWQpIGF1dGggewogICAgdG9rZW4uY29uZmlybVByb3Bvc2FsKG1zZy5zZW5kZXIsIHNoYTModHlwZV8pLCBwcm9wb3NhbElkKTsKICB9CgogIGZ1bmN0aW9uIG51bU93bmVyQWRkcmVzcygpIGF1dGggY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRva2VuU3RvcmFnZS5udW1Pd25lckFkZHJlc3MoKTsKICB9CgoKICBmdW5jdGlvbiBudW1iZXJPZlByb3Bvc2FscyhzdHJpbmcgdHlwZV8pIGF1dGggY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRva2VuLm51bWJlck9mUHJvcG9zYWxzKHNoYTModHlwZV8pKTsKICB9CgogIAogIAogIAoKCiAgZnVuY3Rpb24gc2V0dXAoYWRkcmVzcyBzdG9yYWdlQWRkcmVzcywgYWRkcmVzcyB0b2tlbkFkZHJlc3MsIGFkZHJlc3MgYXV0aG9yaXR5QWRkcmVzcywgYWRkcmVzcyBhc3NvY2lhdGlvbkFkZHJlc3MpIGF1dGggewogICAgY2hhbmdlU3RvcmFnZShzdG9yYWdlQWRkcmVzcyk7CiAgICBjaGFuZ2VUb2tlbih0b2tlbkFkZHJlc3MpOwogICAgY2hhbmdlQXV0aG9yaXR5KGF1dGhvcml0eUFkZHJlc3MpOwogICAgY2hhbmdlQXNzb2NpYXRpb24oYXNzb2NpYXRpb25BZGRyZXNzKTsKICB9CgoKICBmdW5jdGlvbiBjaGFuZ2VUb2tlbihhZGRyZXNzIHRva2VuQWRkcmVzcykgYXV0aCB7CiAgICAKICAgIHRva2VuID0gSWt1cmFUb2tlbih0b2tlbkFkZHJlc3MpOwoKICAgIAogICAgdG9rZW5TdG9yYWdlLmNoYW5nZVRva2VuKHRva2VuKTsKICAgIHRva2VuLmNoYW5nZVN0b3JhZ2UodG9rZW5TdG9yYWdlKTsKCiAgICAKICAgIGlmIChhc3NvY2lhdGlvbiAhPSBhZGRyZXNzKDApKSB7CiAgICAgIGFzc29jaWF0aW9uLmNoYW5nZVRva2VuKHRva2VuKTsKICAgICAgdG9rZW4uY2hhbmdlQXNzb2NpYXRpb24oYXNzb2NpYXRpb24pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hhbmdlU3RvcmFnZShhZGRyZXNzIHN0b3JhZ2VBZGRyZXNzKSBhdXRoIHsKICAgIAogICAgdG9rZW5TdG9yYWdlID0gSWt1cmFTdG9yYWdlKHN0b3JhZ2VBZGRyZXNzKTsKICB9CgoKICBmdW5jdGlvbiBjaGFuZ2VBdXRob3JpdHkoYWRkcmVzcyBhdXRob3JpdHlBZGRyZXNzKSBhdXRoIHsKICAgIAogICAgYXV0aG9yaXR5ID0gSWt1cmFBdXRob3JpdHkoYXV0aG9yaXR5QWRkcmVzcyk7CiAgICBzZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKCiAgICAKICAgIGF1dGhvcml0eS5jaGFuZ2VTdG9yYWdlKHRva2VuU3RvcmFnZSk7CiAgICB0b2tlblN0b3JhZ2UuY2hhbmdlQXV0aG9yaXR5KGF1dGhvcml0eSk7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VBc3NvY2lhdGlvbihhZGRyZXNzIGFzc29jaWF0aW9uQWRkcmVzcykgYXV0aCB7CiAgICAKICAgIGFzc29jaWF0aW9uID0gSWt1cmFBc3NvY2lhdGlvbihhc3NvY2lhdGlvbkFkZHJlc3MpOwoKICAgIAogICAgYXNzb2NpYXRpb24uY2hhbmdlU3RvcmFnZSh0b2tlblN0b3JhZ2UpOwogICAgdG9rZW5TdG9yYWdlLmNoYW5nZUFzc29jaWF0aW9uKGFzc29jaWF0aW9uKTsKCiAgICAKICAgIGlmICh0b2tlbiAhPSBhZGRyZXNzKDApKSB7CiAgICAgIGFzc29jaWF0aW9uLmNoYW5nZVRva2VuKHRva2VuKTsKICAgICAgdG9rZW4uY2hhbmdlQXNzb2NpYXRpb24oYXNzb2NpYXRpb24pOwogICAgfQogIH0KCgogIGZ1bmN0aW9uIGZvcmJpZGRlbkFjdGlvbigpIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKIAogIGZ1bmN0aW9uIGxvZ2ljVmVyc2lvbigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi5sb2dpY1ZlcnNpb24obXNnLnNlbmRlcik7CiAgfQoKCiAgZnVuY3Rpb24gaXNBdXRob3JpemVkKGFkZHJlc3Mgc3JjLCBieXRlczQgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gIHNyYyA9PSBhZGRyZXNzKHRoaXMpIHx8CiAgICAgICAgICAgIHNyYyA9PSBvd25lciB8fAogICAgICAgICAgICBhdXRob3JpdHkuY2FuQ2FsbChzcmMsIHRoaXMsIHNpZyk7CiAgfQp9'.
	

]
