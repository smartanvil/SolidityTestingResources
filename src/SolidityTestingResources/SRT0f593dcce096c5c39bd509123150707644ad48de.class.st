Class {
	#name : #SRT0f593dcce096c5c39bd509123150707644ad48de,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0f593dcce096c5c39bd509123150707644ad48de >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNjsKCi8qKgoqIEB0aXRsZSBSTFBSZWFkZXIKKgoqIFJMUFJlYWRlciBpcyB1c2VkIHRvIHJlYWQgYW5kIHBhcnNlIFJMUCBlbmNvZGVkIGRhdGEgaW4gbWVtb3J5LgoqCiogQGF1dGhvciBBbmRyZWFzIE9sb2Zzc29uICg8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTgzOTM2M2MyYTM3MzQzNzY5NjE2MDY4MTgzZjM1MzkzMTM0NzYzYjM3MzUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+KQoqLwpsaWJyYXJ5IFJMUCB7CgogdWludCBjb25zdGFudCBEQVRBX1NIT1JUX1NUQVJUID0gMHg4MDsKIHVpbnQgY29uc3RhbnQgREFUQV9MT05HX1NUQVJUID0gMHhCODsKIHVpbnQgY29uc3RhbnQgTElTVF9TSE9SVF9TVEFSVCA9IDB4QzA7CiB1aW50IGNvbnN0YW50IExJU1RfTE9OR19TVEFSVCA9IDB4Rjg7CgogdWludCBjb25zdGFudCBEQVRBX0xPTkdfT0ZGU0VUID0gMHhCNzsKIHVpbnQgY29uc3RhbnQgTElTVF9MT05HX09GRlNFVCA9IDB4Rjc7CgoKIHN0cnVjdCBSTFBJdGVtIHsKICAgICB1aW50IF91bnNhZmVfbWVtUHRyOyAgICAvLyBQb2ludGVyIHRvIHRoZSBSTFAtZW5jb2RlZCBieXRlcy4KICAgICB1aW50IF91bnNhZmVfbGVuZ3RoOyAgICAvLyBOdW1iZXIgb2YgYnl0ZXMuIFRoaXMgaXMgdGhlIGZ1bGwgbGVuZ3RoIG9mIHRoZSBzdHJpbmcuCiB9Cgogc3RydWN0IEl0ZXJhdG9yIHsKICAgICBSTFBJdGVtIF91bnNhZmVfaXRlbTsgICAvLyBJdGVtIHRoYXQncyBiZWluZyBpdGVyYXRlZCBvdmVyLgogICAgIHVpbnQgX3Vuc2FmZV9uZXh0UHRyOyAgIC8vIFBvc2l0aW9uIG9mIHRoZSBuZXh0IGl0ZW0gaW4gdGhlIGxpc3QuCiB9CgogLyogSXRlcmF0b3IgKi8KCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChSTFBJdGVtIG1lbW9yeSBzdWJJdGVtKSB7CiAgICAgaWYoaGFzTmV4dChzZWxmKSkgewogICAgICAgICB2YXIgcHRyID0gc2VsZi5fdW5zYWZlX25leHRQdHI7CiAgICAgICAgIHZhciBpdGVtTGVuZ3RoID0gX2l0ZW1MZW5ndGgocHRyKTsKICAgICAgICAgc3ViSXRlbS5fdW5zYWZlX21lbVB0ciA9IHB0cjsKICAgICAgICAgc3ViSXRlbS5fdW5zYWZlX2xlbmd0aCA9IGl0ZW1MZW5ndGg7CiAgICAgICAgIHNlbGYuX3Vuc2FmZV9uZXh0UHRyID0gcHRyICsgaXRlbUxlbmd0aDsKICAgICB9CiAgICAgZWxzZQogICAgICAgICB0aHJvdzsKIH0KCiBmdW5jdGlvbiBuZXh0KEl0ZXJhdG9yIG1lbW9yeSBzZWxmLCBib29sIHN0cmljdCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkgc3ViSXRlbSkgewogICAgIHN1Ykl0ZW0gPSBuZXh0KHNlbGYpOwogICAgIGlmKHN0cmljdCAmJiAhX3ZhbGlkYXRlKHN1Ykl0ZW0pKQogICAgICAgICB0aHJvdzsKICAgICByZXR1cm47CiB9CgogZnVuY3Rpb24gaGFzTmV4dChJdGVyYXRvciBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgIHZhciBpdGVtID0gc2VsZi5fdW5zYWZlX2l0ZW07CiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9uZXh0UHRyIDwgaXRlbS5fdW5zYWZlX21lbVB0ciArIGl0ZW0uX3Vuc2FmZV9sZW5ndGg7CiB9CgogLyogUkxQSXRlbSAqLwoKIC8vLyBAZGV2IENyZWF0ZXMgYW4gUkxQSXRlbSBmcm9tIGFuIGFycmF5IG9mIFJMUCBlbmNvZGVkIGJ5dGVzLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgZW5jb2RlZCBieXRlcy4KIC8vLyBAcmV0dXJuIEFuIFJMUEl0ZW0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoUkxQSXRlbSBtZW1vcnkpIHsKICAgICB1aW50IGxlbiA9IHNlbGYubGVuZ3RoOwogICAgIGlmIChsZW4gPT0gMCkgewogICAgICAgICByZXR1cm4gUkxQSXRlbSgwLCAwKTsKICAgICB9CiAgICAgdWludCBtZW1QdHI7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBtZW1QdHIgOj0gYWRkKHNlbGYsIDB4MjApCiAgICAgfQogICAgIHJldHVybiBSTFBJdGVtKG1lbVB0ciwgbGVuKTsKIH0KCiAvLy8gQGRldiBDcmVhdGVzIGFuIFJMUEl0ZW0gZnJvbSBhbiBhcnJheSBvZiBSTFAgZW5jb2RlZCBieXRlcy4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGVuY29kZWQgYnl0ZXMuCiAvLy8gQHBhcmFtIHN0cmljdCBXaWxsIHRocm93IGlmIHRoZSBkYXRhIGlzIG5vdCBSTFAgZW5jb2RlZC4KIC8vLyBAcmV0dXJuIEFuIFJMUEl0ZW0KIGZ1bmN0aW9uIHRvUkxQSXRlbShieXRlcyBtZW1vcnkgc2VsZiwgYm9vbCBzdHJpY3QpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW0gbWVtb3J5KSB7CiAgICAgdmFyIGl0ZW0gPSB0b1JMUEl0ZW0oc2VsZik7CiAgICAgaWYoc3RyaWN0KSB7CiAgICAgICAgIHVpbnQgbGVuID0gc2VsZi5sZW5ndGg7CiAgICAgICAgIGlmKF9wYXlsb2FkT2Zmc2V0KGl0ZW0pID4gbGVuKQogICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgIGlmKF9pdGVtTGVuZ3RoKGl0ZW0uX3Vuc2FmZV9tZW1QdHIpICE9IGxlbikKICAgICAgICAgICAgIHRocm93OwogICAgICAgICBpZighX3ZhbGlkYXRlKGl0ZW0pKQogICAgICAgICAgICAgdGhyb3c7CiAgICAgfQogICAgIHJldHVybiBpdGVtOwogfQoKIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBudWxsLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBudWxsLgogZnVuY3Rpb24gaXNOdWxsKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KSB7CiAgICAgcmV0dXJuIHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMDsKIH0KCiAvLy8gQGRldiBDaGVjayBpZiB0aGUgUkxQIGl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBhIGxpc3QuCiBmdW5jdGlvbiBpc0xpc3QoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgcmV0IDo9IGlzemVybyhsdChieXRlKDAsIG1sb2FkKG1lbVB0cikpLCAweEMwKSkKICAgICB9CiB9CgogLy8vIEBkZXYgQ2hlY2sgaWYgdGhlIFJMUCBpdGVtIGlzIGRhdGEuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUCBpdGVtLgogLy8vIEByZXR1cm4gJ3RydWUnIGlmIHRoZSBpdGVtIGlzIGRhdGEuCiBmdW5jdGlvbiBpc0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICBpZiAoc2VsZi5fdW5zYWZlX2xlbmd0aCA9PSAwKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgcmV0IDo9IGx0KGJ5dGUoMCwgbWxvYWQobWVtUHRyKSksIDB4QzApCiAgICAgfQogfQoKIC8vLyBAZGV2IENoZWNrIGlmIHRoZSBSTFAgaXRlbSBpcyBlbXB0eSAoc3RyaW5nIG9yIGxpc3QpLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuICd0cnVlJyBpZiB0aGUgaXRlbSBpcyBudWxsLgogZnVuY3Rpb24gaXNFbXB0eShSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHJldCkgewogICAgIGlmKGlzTnVsbChzZWxmKSkKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgIHVpbnQgYjA7CiAgICAgdWludCBtZW1QdHIgPSBzZWxmLl91bnNhZmVfbWVtUHRyOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQogICAgIH0KICAgICByZXR1cm4gKGIwID09IERBVEFfU0hPUlRfU1RBUlQgfHwgYjAgPT0gTElTVF9TSE9SVF9TVEFSVCk7CiB9CgogLy8vIEBkZXYgR2V0IHRoZSBudW1iZXIgb2YgaXRlbXMgaW4gYW4gUkxQIGVuY29kZWQgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQIGl0ZW0uCiAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIGl0ZW1zLgogZnVuY3Rpb24gaXRlbXMoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgIGlmICghaXNMaXN0KHNlbGYpKQogICAgICAgICByZXR1cm4gMDsKICAgICB1aW50IGIwOwogICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQobWVtUHRyKSkKICAgICB9CiAgICAgdWludCBwb3MgPSBtZW1QdHIgKyBfcGF5bG9hZE9mZnNldChzZWxmKTsKICAgICB1aW50IGxhc3QgPSBtZW1QdHIgKyBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMTsKICAgICB1aW50IGl0bXM7CiAgICAgd2hpbGUocG9zIDw9IGxhc3QpIHsKICAgICAgICAgcG9zICs9IF9pdGVtTGVuZ3RoKHBvcyk7CiAgICAgICAgIGl0bXMrKzsKICAgICB9CiAgICAgcmV0dXJuIGl0bXM7CiB9CgogLy8vIEBkZXYgQ3JlYXRlIGFuIGl0ZXJhdG9yLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuIEFuICdJdGVyYXRvcicgb3ZlciB0aGUgaXRlbS4KIGZ1bmN0aW9uIGl0ZXJhdG9yKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKEl0ZXJhdG9yIG1lbW9yeSBpdCkgewogICAgIGlmICghaXNMaXN0KHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB1aW50IHB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHIgKyBfcGF5bG9hZE9mZnNldChzZWxmKTsKICAgICBpdC5fdW5zYWZlX2l0ZW0gPSBzZWxmOwogICAgIGl0Ll91bnNhZmVfbmV4dFB0ciA9IHB0cjsKIH0KCiAvLy8gQGRldiBSZXR1cm4gdGhlIFJMUCBlbmNvZGVkIGJ5dGVzLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGJ5dGVzLgogZnVuY3Rpb24gdG9CeXRlcyhSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlcyBtZW1vcnkgYnRzKSB7CiAgICAgdmFyIGxlbiA9IHNlbGYuX3Vuc2FmZV9sZW5ndGg7CiAgICAgaWYgKGxlbiA9PSAwKQogICAgICAgICByZXR1cm47CiAgICAgYnRzID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgX2NvcHlUb0J5dGVzKHNlbGYuX3Vuc2FmZV9tZW1QdHIsIGJ0cywgbGVuKTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGJ5dGVzLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0RhdGEoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMgbWVtb3J5IGJ0cykgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBidHMgPSBuZXcgYnl0ZXMobGVuKTsKICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7CiB9CgogLy8vIEBkZXYgR2V0IHRoZSBsaXN0IG9mIHN1Yi1pdGVtcyBmcm9tIGFuIFJMUCBlbmNvZGVkIGxpc3QuCiAvLy8gV2FybmluZzogVGhpcyBpcyBpbmVmZmljaWVudCwgYXMgaXQgcmVxdWlyZXMgdGhhdCB0aGUgbGlzdCBpcyByZWFkIHR3aWNlLgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFAgaXRlbS4KIC8vLyBAcmV0dXJuIEFycmF5IG9mIFJMUEl0ZW1zLgogZnVuY3Rpb24gdG9MaXN0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKFJMUEl0ZW1bXSBtZW1vcnkgbGlzdCkgewogICAgIGlmKCFpc0xpc3Qoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciBudW1JdGVtcyA9IGl0ZW1zKHNlbGYpOwogICAgIGxpc3QgPSBuZXcgUkxQSXRlbVtdKG51bUl0ZW1zKTsKICAgICB2YXIgaXQgPSBpdGVyYXRvcihzZWxmKTsKICAgICB1aW50IGlkeDsKICAgICB3aGlsZShoYXNOZXh0KGl0KSkgewogICAgICAgICBsaXN0W2lkeF0gPSBuZXh0KGl0KTsKICAgICAgICAgaWR4Kys7CiAgICAgfQogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gYXNjaWkgc3RyaW5nLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0FzY2lpKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBtZW1vcnkgc3RyKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOwogICAgIGJ5dGVzIG1lbW9yeSBidHMgPSBuZXcgYnl0ZXMobGVuKTsKICAgICBfY29weVRvQnl0ZXMoclN0YXJ0UG9zLCBidHMsIGxlbik7CiAgICAgc3RyID0gc3RyaW5nKGJ0cyk7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIHVpbnQuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvVWludChSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IGRhdGEpIHsKICAgICBpZighaXNEYXRhKHNlbGYpKQogICAgICAgICB0aHJvdzsKICAgICB2YXIgKHJTdGFydFBvcywgbGVuKSA9IF9kZWNvZGUoc2VsZik7CiAgICAgaWYgKGxlbiA+IDMyIHx8IGxlbiA9PSAwKQogICAgICAgICB0aHJvdzsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIHN1YigzMiwgbGVuKSkpCiAgICAgfQogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYSBib29sZWFuLiBUaGlzIHdpbGwgbm90IHdvcmsgaWYgdGhlCiAvLy8gUkxQSXRlbSBpcyBhIGxpc3QuCiAvLy8gQHBhcmFtIHNlbGYgVGhlIFJMUEl0ZW0uCiAvLy8gQHJldHVybiBUaGUgZGVjb2RlZCBzdHJpbmcuCiBmdW5jdGlvbiB0b0Jvb2woUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBkYXRhKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdmFyIChyU3RhcnRQb3MsIGxlbikgPSBfZGVjb2RlKHNlbGYpOwogICAgIGlmIChsZW4gIT0gMSkKICAgICAgICAgdGhyb3c7CiAgICAgdWludCB0ZW1wOwogICAgIGFzc2VtYmx5IHsKICAgICAgICAgdGVtcCA6PSBieXRlKDAsIG1sb2FkKHJTdGFydFBvcykpCiAgICAgfQogICAgIGlmICh0ZW1wID4gMSkKICAgICAgICAgdGhyb3c7CiAgICAgcmV0dXJuIHRlbXAgPT0gMSA/IHRydWUgOiBmYWxzZTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGEgYnl0ZS4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9CeXRlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGUgZGF0YSkgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBpZiAobGVuICE9IDEpCiAgICAgICAgIHRocm93OwogICAgIHVpbnQgdGVtcDsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIHRlbXAgOj0gYnl0ZSgwLCBtbG9hZChyU3RhcnRQb3MpKQogICAgIH0KICAgICByZXR1cm4gYnl0ZSh0ZW1wKTsKIH0KCiAvLy8gQGRldiBEZWNvZGUgYW4gUkxQSXRlbSBpbnRvIGFuIGludC4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9JbnQoUkxQSXRlbSBtZW1vcnkgc2VsZikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoaW50IGRhdGEpIHsKICAgICByZXR1cm4gaW50KHRvVWludChzZWxmKSk7CiB9CgogLy8vIEBkZXYgRGVjb2RlIGFuIFJMUEl0ZW0gaW50byBhIGJ5dGVzMzIuIFRoaXMgd2lsbCBub3Qgd29yayBpZiB0aGUKIC8vLyBSTFBJdGVtIGlzIGEgbGlzdC4KIC8vLyBAcGFyYW0gc2VsZiBUaGUgUkxQSXRlbS4KIC8vLyBAcmV0dXJuIFRoZSBkZWNvZGVkIHN0cmluZy4KIGZ1bmN0aW9uIHRvQnl0ZXMzMihSTFBJdGVtIG1lbW9yeSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIGRhdGEpIHsKICAgICByZXR1cm4gYnl0ZXMzMih0b1VpbnQoc2VsZikpOwogfQoKIC8vLyBAZGV2IERlY29kZSBhbiBSTFBJdGVtIGludG8gYW4gYWRkcmVzcy4gVGhpcyB3aWxsIG5vdCB3b3JrIGlmIHRoZQogLy8vIFJMUEl0ZW0gaXMgYSBsaXN0LgogLy8vIEBwYXJhbSBzZWxmIFRoZSBSTFBJdGVtLgogLy8vIEByZXR1cm4gVGhlIGRlY29kZWQgc3RyaW5nLgogZnVuY3Rpb24gdG9BZGRyZXNzKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZGF0YSkgewogICAgIGlmKCFpc0RhdGEoc2VsZikpCiAgICAgICAgIHRocm93OwogICAgIHZhciAoclN0YXJ0UG9zLCBsZW4pID0gX2RlY29kZShzZWxmKTsKICAgICBpZiAobGVuICE9IDIwKQogICAgICAgICB0aHJvdzsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGRhdGEgOj0gZGl2KG1sb2FkKHJTdGFydFBvcyksIGV4cCgyNTYsIDEyKSkKICAgICB9CiB9CgogLy8gR2V0IHRoZSBwYXlsb2FkIG9mZnNldC4KIGZ1bmN0aW9uIF9wYXlsb2FkT2Zmc2V0KFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgIGlmKHNlbGYuX3Vuc2FmZV9sZW5ndGggPT0gMCkKICAgICAgICAgcmV0dXJuIDA7CiAgICAgdWludCBiMDsKICAgICB1aW50IG1lbVB0ciA9IHNlbGYuX3Vuc2FmZV9tZW1QdHI7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpCiAgICAgfQogICAgIGlmKGIwIDwgREFUQV9TSE9SVF9TVEFSVCkKICAgICAgICAgcmV0dXJuIDA7CiAgICAgaWYoYjAgPCBEQVRBX0xPTkdfU1RBUlQgfHwgKGIwID49IExJU1RfU0hPUlRfU1RBUlQgJiYgYjAgPCBMSVNUX0xPTkdfU1RBUlQpKQogICAgICAgICByZXR1cm4gMTsKICAgICBpZihiMCA8IExJU1RfU0hPUlRfU1RBUlQpCiAgICAgICAgIHJldHVybiBiMCAtIERBVEFfTE9OR19PRkZTRVQgKyAxOwogICAgIHJldHVybiBiMCAtIExJU1RfTE9OR19PRkZTRVQgKyAxOwogfQoKIC8vIEdldCB0aGUgZnVsbCBsZW5ndGggb2YgYW4gUkxQIGl0ZW0uCiBmdW5jdGlvbiBfaXRlbUxlbmd0aCh1aW50IG1lbVB0cikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50IGxlbikgewogICAgIHVpbnQgYjA7CiAgICAgYXNzZW1ibHkgewogICAgICAgICBiMCA6PSBieXRlKDAsIG1sb2FkKG1lbVB0cikpCiAgICAgfQogICAgIGlmIChiMCA8IERBVEFfU0hPUlRfU1RBUlQpCiAgICAgICAgIGxlbiA9IDE7CiAgICAgZWxzZSBpZiAoYjAgPCBEQVRBX0xPTkdfU1RBUlQpCiAgICAgICAgIGxlbiA9IGIwIC0gREFUQV9TSE9SVF9TVEFSVCArIDE7CiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX1NIT1JUX1NUQVJUKSB7CiAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhCNykgLy8gYnl0ZXMgbGVuZ3RoIChEQVRBX0xPTkdfT0ZGU0VUKQogICAgICAgICAgICAgbGV0IGRMZW4gOj0gZGl2KG1sb2FkKGFkZChtZW1QdHIsIDEpKSwgZXhwKDI1Niwgc3ViKDMyLCBiTGVuKSkpIC8vIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoCiAgICAgICAgIH0KICAgICB9CiAgICAgZWxzZSBpZiAoYjAgPCBMSVNUX0xPTkdfU1RBUlQpCiAgICAgICAgIGxlbiA9IGIwIC0gTElTVF9TSE9SVF9TVEFSVCArIDE7CiAgICAgZWxzZSB7CiAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgIGxldCBiTGVuIDo9IHN1YihiMCwgMHhGNykgLy8gYnl0ZXMgbGVuZ3RoIChMSVNUX0xPTkdfT0ZGU0VUKQogICAgICAgICAgICAgbGV0IGRMZW4gOj0gZGl2KG1sb2FkKGFkZChtZW1QdHIsIDEpKSwgZXhwKDI1Niwgc3ViKDMyLCBiTGVuKSkpIC8vIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgICBsZW4gOj0gYWRkKDEsIGFkZChiTGVuLCBkTGVuKSkgLy8gdG90YWwgbGVuZ3RoCiAgICAgICAgIH0KICAgICB9CiB9CgogLy8gR2V0IHN0YXJ0IHBvc2l0aW9uIGFuZCBsZW5ndGggb2YgdGhlIGRhdGEuCiBmdW5jdGlvbiBfZGVjb2RlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCBtZW1QdHIsIHVpbnQgbGVuKSB7CiAgICAgaWYoIWlzRGF0YShzZWxmKSkKICAgICAgICAgdGhyb3c7CiAgICAgdWludCBiMDsKICAgICB1aW50IHN0YXJ0ID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICBhc3NlbWJseSB7CiAgICAgICAgIGIwIDo9IGJ5dGUoMCwgbWxvYWQoc3RhcnQpKQogICAgIH0KICAgICBpZiAoYjAgPCBEQVRBX1NIT1JUX1NUQVJUKSB7CiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0OwogICAgICAgICBsZW4gPSAxOwogICAgICAgICByZXR1cm47CiAgICAgfQogICAgIGlmIChiMCA8IERBVEFfTE9OR19TVEFSVCkgewogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMTsKICAgICAgICAgbWVtUHRyID0gc3RhcnQgKyAxOwogICAgIH0gZWxzZSB7CiAgICAgICAgIHVpbnQgYkxlbjsKICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgYkxlbiA6PSBzdWIoYjAsIDB4QjcpIC8vIERBVEFfTE9OR19PRkZTRVQKICAgICAgICAgfQogICAgICAgICBsZW4gPSBzZWxmLl91bnNhZmVfbGVuZ3RoIC0gMSAtIGJMZW47CiAgICAgICAgIG1lbVB0ciA9IHN0YXJ0ICsgYkxlbiArIDE7CiAgICAgfQogICAgIHJldHVybjsKIH0KCiAvLyBBc3N1bWVzIHRoYXQgZW5vdWdoIG1lbW9yeSBoYXMgYmVlbiBhbGxvY2F0ZWQgdG8gc3RvcmUgaW4gdGFyZ2V0LgogZnVuY3Rpb24gX2NvcHlUb0J5dGVzKHVpbnQgYnRzUHRyLCBieXRlcyBtZW1vcnkgdGd0LCB1aW50IGJ0c0xlbikgcHJpdmF0ZSBjb25zdGFudCB7CiAgICAgLy8gRXhwbG9pdGluZyB0aGUgZmFjdCB0aGF0ICd0Z3QnIHdhcyB0aGUgbGFzdCB0aGluZyB0byBiZSBhbGxvY2F0ZWQsCiAgICAgLy8gd2UgY2FuIHdyaXRlIGVudGlyZSB3b3JkcywgYW5kIGp1c3Qgb3ZlcndyaXRlIGFueSBleGNlc3MuCiAgICAgYXNzZW1ibHkgewogICAgICAgICB7CiAgICAgICAgICAgICAgICAgbGV0IGkgOj0gMCAvLyBTdGFydCBhdCBhcnIgKyAweDIwCiAgICAgICAgICAgICAgICAgbGV0IHdvcmRzIDo9IGRpdihhZGQoYnRzTGVuLCAzMSksIDMyKQogICAgICAgICAgICAgICAgIGxldCByT2Zmc2V0IDo9IGJ0c1B0cgogICAgICAgICAgICAgICAgIGxldCB3T2Zmc2V0IDo9IGFkZCh0Z3QsIDB4MjApCiAgICAgICAgICAgICB0YWdfbG9vcDoKICAgICAgICAgICAgICAgICBqdW1waShlbmQsIGVxKGksIHdvcmRzKSkKICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gbXVsKGksIDB4MjApCiAgICAgICAgICAgICAgICAgICAgIG1zdG9yZShhZGQod09mZnNldCwgb2Zmc2V0KSwgbWxvYWQoYWRkKHJPZmZzZXQsIG9mZnNldCkpKQogICAgICAgICAgICAgICAgICAgICBpIDo9IGFkZChpLCAxKQogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBqdW1wKHRhZ19sb29wKQogICAgICAgICAgICAgZW5kOgogICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodGd0LCBhZGQoMHgyMCwgbWxvYWQodGd0KSkpLCAwKQogICAgICAgICB9CiAgICAgfQogfQoKIC8vIENoZWNrIHRoYXQgYW4gUkxQIGl0ZW0gaXMgdmFsaWQuCiAgICAgZnVuY3Rpb24gX3ZhbGlkYXRlKFJMUEl0ZW0gbWVtb3J5IHNlbGYpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpIHsKICAgICAgICAgLy8gQ2hlY2sgdGhhdCBSTFAgaXMgd2VsbC1mb3JtZWQuCiAgICAgICAgIHVpbnQgYjA7CiAgICAgICAgIHVpbnQgYjE7CiAgICAgICAgIHVpbnQgbWVtUHRyID0gc2VsZi5fdW5zYWZlX21lbVB0cjsKICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgYjAgOj0gYnl0ZSgwLCBtbG9hZChtZW1QdHIpKQogICAgICAgICAgICAgYjEgOj0gYnl0ZSgxLCBtbG9hZChtZW1QdHIpKQogICAgICAgICB9CiAgICAgICAgIGlmKGIwID09IERBVEFfU0hPUlRfU1RBUlQgKyAxICYmIGIxIDwgREFUQV9TSE9SVF9TVEFSVCkKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC42OwoKLyoKICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIE1pbGVzdG9uZVRyYWNrZXIgQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IHRyYWNrcyB0aGUKCgovLy8gaXMgcnVsZXMgdGhlIHJlbGF0aW9uIGJldHdlbiBhIGRvbm9yIGFuZCBhIHJlY2lwaWVudAovLy8gIGluIG9yZGVyIHRvIGd1YXJhbnR5IHRvIHRoZSBkb25vciB0aGF0IHRoZSBqb2Igd2lsbCBiZSBkb25lIGFuZCB0byBndWFyYW50eQovLy8gIHRvIHRoZSByZWNpcGllbnQgdGhhdCBoZSB3aWxsIGJlIHBhaWQKCgovLy8gQGRldiBXZSB1c2UgdGhlIFJMUCBsaWJyYXJ5IHRvIGRlY29kZSBSTFAgc28gdGhhdCB0aGUgZG9ub3IgY2FuIGFwcHJvdmUgb25lCi8vLyAgc2V0IG9mIG1pbGVzdG9uZSBjaGFuZ2VzIGF0IGEgdGltZS4KLy8vICBodHRwczovL2dpdGh1Yi5jb20vYW5kcm9sby9zdGFuZGFyZC1jb250cmFjdHMvYmxvYi9tYXN0ZXIvY29udHJhY3RzL3NyYy9jb2RlYy9STFAuc29sCgoKCgovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGFsbG93cyBmb3IgYHJlY2lwaWVudGAgdG8gc2V0IGFuZCBtb2RpZnkgbWlsZXN0b25lcwpjb250cmFjdCBNaWxlc3RvbmVUcmFja2VyIHsKICAgIHVzaW5nIFJMUCBmb3IgUkxQLlJMUEl0ZW07CiAgICB1c2luZyBSTFAgZm9yIFJMUC5JdGVyYXRvcjsKICAgIHVzaW5nIFJMUCBmb3IgYnl0ZXM7CgogICAgc3RydWN0IE1pbGVzdG9uZSB7CiAgICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uOyAgICAgLy8gRGVzY3JpcHRpb24gb2YgdGhpcyBtaWxlc3RvbmUKICAgICAgICBzdHJpbmcgdXJsOyAgICAgICAgICAgICAvLyBBIGxpbmsgdG8gbW9yZSBpbmZvcm1hdGlvbiAoc3dhcm0gZ2F0ZXdheSkKICAgICAgICB1aW50IG1pbkNvbXBsZXRpb25EYXRlOyAvLyBFYXJsaWVzdCBVTklYIHRpbWUgdGhlIG1pbGVzdG9uZSBjYW4gYmUgcGFpZAogICAgICAgIHVpbnQgbWF4Q29tcGxldGlvbkRhdGU7IC8vIExhdGVzdCBVTklYIHRpbWUgdGhlIG1pbGVzdG9uZSBjYW4gYmUgcGFpZAogICAgICAgIGFkZHJlc3MgbWlsZXN0b25lTGVhZExpbms7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2ltaWxhciB0byBgcmVjaXBpZW50YGJ1dCBmb3IgdGhpcyBtaWxlc3RvbmUKICAgICAgICBhZGRyZXNzIHJldmlld2VyOyAgICAgICAvLyBDYW4gcmVqZWN0IHRoZSBjb21wbGV0aW9uIG9mIHRoaXMgbWlsZXN0b25lCiAgICAgICAgdWludCByZXZpZXdUaW1lOyAgICAgICAgLy8gSG93IG1hbnkgc2Vjb25kcyB0aGUgcmV2aWV3ZXIgaGFzIHRvIHJldmlldwogICAgICAgIGFkZHJlc3MgcGF5bWVudFNvdXJjZTsgIC8vIFdoZXJlIHRoZSBtaWxlc3RvbmUgcGF5bWVudCBpcyBzZW50IGZyb20KICAgICAgICBieXRlcyBwYXlEYXRhOyAgICAgICAgICAvLyBEYXRhIGRlZmluaW5nIGhvdyBtdWNoIGV0aGVyIGlzIHNlbnQgd2hlcmUKCiAgICAgICAgTWlsZXN0b25lU3RhdHVzIHN0YXR1czsgLy8gQ3VycmVudCBzdGF0dXMgb2YgdGhlIG1pbGVzdG9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIChDb21wbGV0ZWQsIEF1dGhvcml6ZWRGb3JQYXltZW50Li4uKQogICAgICAgIHVpbnQgZG9uZVRpbWU7ICAgICAgICAgIC8vIFVOSVggdGltZSB3aGVuIHRoZSBtaWxlc3RvbmUgd2FzIG1hcmtlZCBET05FCiAgICB9CgogICAgLy8gVGhlIGxpc3Qgb2YgYWxsIHRoZSBtaWxlc3RvbmVzLgogICAgTWlsZXN0b25lW10gcHVibGljIG1pbGVzdG9uZXM7CgogICAgYWRkcmVzcyBwdWJsaWMgcmVjaXBpZW50OyAgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgcmVjaXBpZW50CiAgICBhZGRyZXNzIHB1YmxpYyBkb25vcjsgICAgICAgLy8gQ2FsbHMgZnVuY3Rpb25zIGluIHRoZSBuYW1lIG9mIHRoZSBkb25vcgogICAgYWRkcmVzcyBwdWJsaWMgYXJiaXRyYXRvcjsgIC8vIENhbGxzIGZ1bmN0aW9ucyBpbiB0aGUgbmFtZSBvZiB0aGUgYXJiaXRyYXRvcgoKICAgIGVudW0gTWlsZXN0b25lU3RhdHVzIHsKICAgICAgICBBY2NlcHRlZEFuZEluUHJvZ3Jlc3MsCiAgICAgICAgQ29tcGxldGVkLAogICAgICAgIEF1dGhvcml6ZWRGb3JQYXltZW50LAogICAgICAgIENhbmNlbGVkCiAgICB9CgogICAgLy8gVHJ1ZSBpZiB0aGUgY2FtcGFpZ24gaGFzIGJlZW4gY2FuY2VsZWQKICAgIGJvb2wgcHVibGljIGNhbXBhaWduQ2FuY2VsZWQ7CgogICAgLy8gVHJ1ZSBpZiBhbiBhcHByb3ZhbCBvbiBhIGNoYW5nZSB0byBgbWlsZXN0b25lc2AgaXMgYSBwZW5kaW5nCiAgICBib29sIHB1YmxpYyBjaGFuZ2luZ01pbGVzdG9uZXM7CgogICAgLy8gVGhlIHBlbmRpbmcgY2hhbmdlIHRvIGBtaWxlc3RvbmVzYCBlbmNvZGVkIGluIFJMUAogICAgYnl0ZXMgcHVibGljIHByb3Bvc2VkTWlsZXN0b25lczsKCgogICAgLy8vIEBkZXYgVGhlIGZvbGxvd2luZyBtb2RpZmllcnMgb25seSBhbGxvdyBzcGVjaWZpYyByb2xlcyB0byBjYWxsIGZ1bmN0aW9ucwogICAgLy8vIHdpdGggdGhlc2UgbW9kaWZpZXJzCiAgICBtb2RpZmllciBvbmx5UmVjaXBpZW50IHsgaWYgKG1zZy5zZW5kZXIgIT0gIHJlY2lwaWVudCkgdGhyb3c7IF87IH0KICAgIG1vZGlmaWVyIG9ubHlBcmJpdHJhdG9yIHsgaWYgKG1zZy5zZW5kZXIgIT0gYXJiaXRyYXRvcikgdGhyb3c7IF87IH0KICAgIG1vZGlmaWVyIG9ubHlEb25vciB7IGlmIChtc2cuc2VuZGVyICE9IGRvbm9yKSB0aHJvdzsgXzsgfQoKICAgIC8vLyBAZGV2IFRoZSBmb2xsb3dpbmcgbW9kaWZpZXJzIHByZXZlbnQgZnVuY3Rpb25zIGZyb20gYmVpbmcgY2FsbGVkIGlmIHRoZQogICAgLy8vIGNhbXBhaWduIGhhcyBiZWVuIGNhbmNlbGVkIG9yIGlmIG5ldyBtaWxlc3RvbmVzIGFyZSBiZWluZyBwcm9wb3NlZAogICAgbW9kaWZpZXIgY2FtcGFpZ25Ob3RDYW5jZWxlZCB7IGlmIChjYW1wYWlnbkNhbmNlbGVkKSB0aHJvdzsgXzsgfQogICAgbW9kaWZpZXIgbm90Q2hhbmdpbmcgeyBpZiAoY2hhbmdpbmdNaWxlc3RvbmVzKSB0aHJvdzsgXzsgfQoKIC8vIEBkZXYgRXZlbnRzIHRvIG1ha2UgdGhlIHBheW1lbnQgbW92ZW1lbnRzIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdFByb3Bvc2VkKCk7CiAgICBldmVudCBOZXdNaWxlc3RvbmVMaXN0VW5wcm9wb3NlZCgpOwogICAgZXZlbnQgTmV3TWlsZXN0b25lTGlzdEFjY2VwdGVkKCk7CiAgICBldmVudCBQcm9wb3NhbFN0YXR1c0NoYW5nZWQodWludCBpZFByb3Bvc2FsLCBNaWxlc3RvbmVTdGF0dXMgbmV3UHJvcG9zYWwpOwogICAgZXZlbnQgQ2FtcGFpZ25DYW5jZWxlZCgpOwoKCi8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGNyZWF0ZXMgdGhlIE1pbGVzdG9uZSBjb250cmFjdCBvbiB0aGUgYmxvY2tjaGFpbgogICAgLy8vIEBwYXJhbSBfYXJiaXRyYXRvciBBZGRyZXNzIGFzc2lnbmVkIHRvIGJlIHRoZSBhcmJpdHJhdG9yCiAgICAvLy8gQHBhcmFtIF9kb25vciBBZGRyZXNzIGFzc2lnbmVkIHRvIGJlIHRoZSBkb25vcgogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IEFkZHJlc3MgYXNzaWduZWQgdG8gYmUgdGhlIHJlY2lwaWVudAogICAgZnVuY3Rpb24gTWlsZXN0b25lVHJhY2tlciAoCiAgICAgICAgYWRkcmVzcyBfYXJiaXRyYXRvciwKICAgICAgICBhZGRyZXNzIF9kb25vciwKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQKICAgICkgewogICAgICAgIGFyYml0cmF0b3IgPSBfYXJiaXRyYXRvcjsKICAgICAgICBkb25vciA9IF9kb25vcjsKICAgICAgICByZWNpcGllbnQgPSBfcmVjaXBpZW50OwogICAgfQoKCi8vLy8vLy8vLwovLyBIZWxwZXIgZnVuY3Rpb25zCi8vLy8vLy8vLwoKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgbWlsZXN0b25lcyBldmVyIGNyZWF0ZWQgZXZlbiBpZiB0aGV5IHdlcmUgY2FuY2VsZWQKICAgIGZ1bmN0aW9uIG51bWJlck9mTWlsZXN0b25lcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbWlsZXN0b25lcy5sZW5ndGg7CiAgICB9CgoKLy8vLy8vLy8KLy8gQ2hhbmdlIHBsYXllcnMKLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgb25seUFyYml0cmF0b3JgIFJlYXNzaWducyB0aGUgYXJiaXRyYXRvciB0byBhIG5ldyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9uZXdBcmJpdHJhdG9yIFRoZSBuZXcgYXJiaXRyYXRvcgogICAgZnVuY3Rpb24gY2hhbmdlQXJiaXRyYXRvcihhZGRyZXNzIF9uZXdBcmJpdHJhdG9yKSBvbmx5QXJiaXRyYXRvciB7CiAgICAgICAgYXJiaXRyYXRvciA9IF9uZXdBcmJpdHJhdG9yOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5RG9ub3JgIFJlYXNzaWducyB0aGUgYGRvbm9yYCB0byBhIG5ldyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9uZXdEb25vciBUaGUgbmV3IGRvbm9yCiAgICBmdW5jdGlvbiBjaGFuZ2VEb25vcihhZGRyZXNzIF9uZXdEb25vcikgb25seURvbm9yIHsKICAgICAgICBkb25vciA9IF9uZXdEb25vcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgUmVhc3NpZ25zIHRoZSBgcmVjaXBpZW50YCB0byBhIG5ldyBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9uZXdSZWNpcGllbnQgVGhlIG5ldyByZWNpcGllbnQKICAgIGZ1bmN0aW9uIGNoYW5nZVJlY2lwaWVudChhZGRyZXNzIF9uZXdSZWNpcGllbnQpIG9ubHlSZWNpcGllbnQgewogICAgICAgIHJlY2lwaWVudCA9IF9uZXdSZWNpcGllbnQ7CiAgICB9CgoKLy8vLy8vLy8vLy8vCi8vIENyZWF0aW9uIGFuZCBtb2RpZmljYXRpb24gb2YgTWlsZXN0b25lcwovLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgUHJvcG9zZXMgbmV3IG1pbGVzdG9uZXMgb3IgY2hhbmdlcyBvbGQKICAgIC8vLyAgbWlsZXN0b25lcywgdGhpcyB3aWxsIHJlcXVpcmUgYSB1c2VyIGludGVyZmFjZSB0byBiZSBidWlsdCB1cCB0bwogICAgLy8vICBzdXBwb3J0IHRoaXMgZnVuY3Rpb25hbGl0eSBhcyBhc2tzIGZvciBSTFAgZW5jb2RlZCBieXRlY29kZSB0byBiZQogICAgLy8vICBnZW5lcmF0ZWQsIHVudGlsIHRoaXMgaW50ZXJmYWNlIGlzIGJ1aWx0IHlvdSBjYW4gdXNlIHRoaXMgc2NyaXB0OgogICAgLy8vICBodHRwczovL2dpdGh1Yi5jb20vR2l2ZXRoL21pbGVzdG9uZXRyYWNrZXIvYmxvYi9tYXN0ZXIvanMvbWlsZXN0b25ldHJhY2tlcl9oZWxwZXIuanMKICAgIC8vLyAgdGhlIGZ1bmN0aW9ucyBtaWxlc3RvbmVzMmJ5dGVzIGFuZCBieXRlczJtaWxlc3RvbmVzIHdpbGwgZW5hYmxlIHRoZQogICAgLy8vICByZWNpcGllbnQgdG8gZW5jb2RlIGFuZCBkZWNvZGUgYSBsaXN0IG9mIG1pbGVzdG9uZXMsIGFsc28gc2VlCiAgICAvLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9HaXZldGgvbWlsZXN0b25ldHJhY2tlci9ibG9iL21hc3Rlci9SRUFETUUubWQKICAgIC8vLyBAcGFyYW0gX25ld01pbGVzdG9uZXMgVGhlIFJMUCBlbmNvZGVkIGxpc3Qgb2YgbWlsZXN0b25lczsgZWFjaCBtaWxlc3RvbmUKICAgIC8vLyAgaGFzIHRoZXNlIGZpZWxkczoKICAgIC8vLyAgICAgICBzdHJpbmcgZGVzY3JpcHRpb24sCiAgICAvLy8gICAgICAgc3RyaW5nIHVybCwKICAgIC8vLyAgICAgICB1aW50IG1pbkNvbXBsZXRpb25EYXRlLCAgLy8gc2Vjb25kcyBzaW5jZSAxLzEvMTk3MCAoVU5JWCB0aW1lKQogICAgLy8vICAgICAgIHVpbnQgbWF4Q29tcGxldGlvbkRhdGUsICAvLyBzZWNvbmRzIHNpbmNlIDEvMS8xOTcwIChVTklYIHRpbWUpCiAgICAvLy8gICAgICAgYWRkcmVzcyBtaWxlc3RvbmVMZWFkTGluaywKICAgIC8vLyAgICAgICBhZGRyZXNzIHJldmlld2VyLAogICAgLy8vICAgICAgIHVpbnQgcmV2aWV3VGltZQogICAgLy8vICAgICAgIGFkZHJlc3MgcGF5bWVudFNvdXJjZSwKICAgIC8vLyAgICAgICBieXRlcyBwYXlEYXRhLAogICAgZnVuY3Rpb24gcHJvcG9zZU1pbGVzdG9uZXMoYnl0ZXMgX25ld01pbGVzdG9uZXMKICAgICkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsKICAgICAgICBwcm9wb3NlZE1pbGVzdG9uZXMgPSBfbmV3TWlsZXN0b25lczsKICAgICAgICBjaGFuZ2luZ01pbGVzdG9uZXMgPSB0cnVlOwogICAgICAgIE5ld01pbGVzdG9uZUxpc3RQcm9wb3NlZCgpOwogICAgfQoKCi8vLy8vLy8vLy8vLwovLyBOb3JtYWwgYWN0aW9ucyB0aGF0IHdpbGwgY2hhbmdlIHRoZSBzdGF0ZSBvZiB0aGUgbWlsZXN0b25lcwovLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgb25seVJlY2lwaWVudGAgQ2FuY2VscyB0aGUgcHJvcG9zZWQgbWlsZXN0b25lcyBhbmQgcmVhY3RpdmF0ZXMKICAgIC8vLyAgdGhlIHByZXZpb3VzIHNldCBvZiBtaWxlc3RvbmVzCiAgICBmdW5jdGlvbiB1bnByb3Bvc2VNaWxlc3RvbmVzKCkgb25seVJlY2lwaWVudCBjYW1wYWlnbk5vdENhbmNlbGVkIHsKICAgICAgICBkZWxldGUgcHJvcG9zZWRNaWxlc3RvbmVzOwogICAgICAgIGNoYW5naW5nTWlsZXN0b25lcyA9IGZhbHNlOwogICAgICAgIE5ld01pbGVzdG9uZUxpc3RVbnByb3Bvc2VkKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlEb25vcmAgQXBwcm92ZXMgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZSBsaXN0CiAgICAvLy8gQHBhcmFtIF9oYXNoUHJvcG9zYWxzIFRoZSBzaGEzKCkgb2YgdGhlIHByb3Bvc2VkIG1pbGVzdG9uZSBsaXN0J3MKICAgIC8vLyAgYnl0ZWNvZGU7IHRoaXMgY29uZmlybXMgdGhhdCB0aGUgYGRvbm9yYCBrbm93cyB0aGUgc2V0IG9mIG1pbGVzdG9uZXMKICAgIC8vLyAgdGhleSBhcmUgYXBwcm92aW5nCiAgICBmdW5jdGlvbiBhY2NlcHRQcm9wb3NlZE1pbGVzdG9uZXMoYnl0ZXMzMiBfaGFzaFByb3Bvc2FscwogICAgKSBvbmx5RG9ub3IgY2FtcGFpZ25Ob3RDYW5jZWxlZCB7CgogICAgICAgIHVpbnQgaTsKCiAgICAgICAgaWYgKCFjaGFuZ2luZ01pbGVzdG9uZXMpIHRocm93OwogICAgICAgIGlmIChzaGEzKHByb3Bvc2VkTWlsZXN0b25lcykgIT0gX2hhc2hQcm9wb3NhbHMpIHRocm93OwoKICAgICAgICAvLyBDYW5jZWwgYWxsIHRoZSB1bmZpbmlzaGVkIG1pbGVzdG9uZXMKICAgICAgICBmb3IgKGk9MDsgaTxtaWxlc3RvbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChtaWxlc3RvbmVzW2ldLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQXV0aG9yaXplZEZvclBheW1lbnQpIHsKICAgICAgICAgICAgICAgIG1pbGVzdG9uZXNbaV0uc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNhbmNlbGVkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIERlY29kZSB0aGUgUkxQIGVuY29kZWQgbWlsZXN0b25lcyBhbmQgYWRkIHRoZW0gdG8gdGhlIG1pbGVzdG9uZXMgbGlzdAogICAgICAgIGJ5dGVzIG1lbW9yeSBtUHJvcG9zZWRNaWxlc3RvbmVzID0gcHJvcG9zZWRNaWxlc3RvbmVzOwoKICAgICAgICB2YXIgaXRtUHJvcG9zYWxzID0gbVByb3Bvc2VkTWlsZXN0b25lcy50b1JMUEl0ZW0odHJ1ZSk7CgogICAgICAgIGlmICghaXRtUHJvcG9zYWxzLmlzTGlzdCgpKSB0aHJvdzsKCiAgICAgICAgdmFyIGl0clByb3Bvc2FscyA9IGl0bVByb3Bvc2Fscy5pdGVyYXRvcigpOwoKICAgICAgICB3aGlsZShpdHJQcm9wb3NhbHMuaGFzTmV4dCgpKSB7CgoKICAgICAgICAgICAgdmFyIGl0bVByb3Bvc2FsID0gaXRyUHJvcG9zYWxzLm5leHQoKTsKCiAgICAgICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW21pbGVzdG9uZXMubGVuZ3RoICsrXTsKCiAgICAgICAgICAgIGlmICghaXRtUHJvcG9zYWwuaXNMaXN0KCkpIHRocm93OwoKICAgICAgICAgICAgdmFyIGl0clByb3Bvc2FsID0gaXRtUHJvcG9zYWwuaXRlcmF0b3IoKTsKCiAgICAgICAgICAgIG1pbGVzdG9uZS5kZXNjcmlwdGlvbiA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FzY2lpKCk7CiAgICAgICAgICAgIG1pbGVzdG9uZS51cmwgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9Bc2NpaSgpOwogICAgICAgICAgICBtaWxlc3RvbmUubWluQ29tcGxldGlvbkRhdGUgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9VaW50KCk7CiAgICAgICAgICAgIG1pbGVzdG9uZS5tYXhDb21wbGV0aW9uRGF0ZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b1VpbnQoKTsKICAgICAgICAgICAgbWlsZXN0b25lLm1pbGVzdG9uZUxlYWRMaW5rID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvQWRkcmVzcygpOwogICAgICAgICAgICBtaWxlc3RvbmUucmV2aWV3ZXIgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9BZGRyZXNzKCk7CiAgICAgICAgICAgIG1pbGVzdG9uZS5yZXZpZXdUaW1lID0gaXRyUHJvcG9zYWwubmV4dCgpLnRvVWludCgpOwogICAgICAgICAgICBtaWxlc3RvbmUucGF5bWVudFNvdXJjZSA9IGl0clByb3Bvc2FsLm5leHQoKS50b0FkZHJlc3MoKTsKICAgICAgICAgICAgbWlsZXN0b25lLnBheURhdGEgPSBpdHJQcm9wb3NhbC5uZXh0KCkudG9EYXRhKCk7CgogICAgICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzczsKCiAgICAgICAgfQoKICAgICAgICBkZWxldGUgcHJvcG9zZWRNaWxlc3RvbmVzOwogICAgICAgIGNoYW5naW5nTWlsZXN0b25lcyA9IGZhbHNlOwogICAgICAgIE5ld01pbGVzdG9uZUxpc3RBY2NlcHRlZCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5UmVjaXBpZW50T3JMZWFkTGlua2BNYXJrcyBhIG1pbGVzdG9uZSBhcyBET05FIGFuZAogICAgLy8vICByZWFkeSBmb3IgcmV2aWV3CiAgICAvLy8gQHBhcmFtIF9pZE1pbGVzdG9uZSBJRCBvZiB0aGUgbWlsZXN0b25lIHRoYXQgaGFzIGJlZW4gY29tcGxldGVkCiAgICBmdW5jdGlvbiBtYXJrTWlsZXN0b25lQ29tcGxldGUodWludCBfaWRNaWxlc3RvbmUpCiAgICAgICAgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZwogICAgewogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93OwogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07CiAgICAgICAgaWYgKCAgKG1zZy5zZW5kZXIgIT0gbWlsZXN0b25lLm1pbGVzdG9uZUxlYWRMaW5rKQogICAgICAgICAgICAmJihtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkpCiAgICAgICAgICAgIHRocm93OwogICAgICAgIGlmIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3MpIHRocm93OwogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmUubWluQ29tcGxldGlvbkRhdGUpIHRocm93OwogICAgICAgIGlmIChub3cgPiBtaWxlc3RvbmUubWF4Q29tcGxldGlvbkRhdGUpIHRocm93OwogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQ29tcGxldGVkOwogICAgICAgIG1pbGVzdG9uZS5kb25lVGltZSA9IG5vdzsKICAgICAgICBQcm9wb3NhbFN0YXR1c0NoYW5nZWQoX2lkTWlsZXN0b25lLCBtaWxlc3RvbmUuc3RhdHVzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgb25seVJldmlld2VyYCBBcHByb3ZlcyBhIHNwZWNpZmljIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0aGF0IGlzIGFwcHJvdmVkCiAgICBmdW5jdGlvbiBhcHByb3ZlQ29tcGxldGVkTWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQogICAgICAgIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcKICAgIHsKICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsKICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOwogICAgICAgIGlmICgobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUucmV2aWV3ZXIpIHx8CiAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKSB0aHJvdzsKCiAgICAgICAgYXV0aG9yaXplUGF5bWVudChfaWRNaWxlc3RvbmUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5UmV2aWV3ZXJgIFJlamVjdHMgYSBzcGVjaWZpYyBtaWxlc3RvbmUncyBjb21wbGV0aW9uIGFuZAogICAgLy8vICByZXZlcnRzIHRoZSBgbWlsZXN0b25lLnN0YXR1c2AgYmFjayB0byB0aGUgYEFjY2VwdGVkQW5kSW5Qcm9ncmVzc2AKICAgIC8vLyAgc3RhdGUKICAgIC8vLyBAcGFyYW0gX2lkTWlsZXN0b25lIElEIG9mIHRoZSBtaWxlc3RvbmUgdGhhdCBpcyBiZWluZyByZWplY3RlZAogICAgZnVuY3Rpb24gcmVqZWN0TWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQogICAgICAgIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcKICAgIHsKICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsKICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOwogICAgICAgIGlmICgobXNnLnNlbmRlciAhPSBtaWxlc3RvbmUucmV2aWV3ZXIpIHx8CiAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKSB0aHJvdzsKCiAgICAgICAgbWlsZXN0b25lLnN0YXR1cyA9IE1pbGVzdG9uZVN0YXR1cy5BY2NlcHRlZEFuZEluUHJvZ3Jlc3M7CiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRPckxlYWRMaW5rYCBTZW5kcyB0aGUgbWlsZXN0b25lIHBheW1lbnQgYXMKICAgIC8vLyAgc3BlY2lmaWVkIGluIGBwYXlEYXRhYDsgdGhlIHJlY2lwaWVudCBjYW4gb25seSBjYWxsIHRoaXMgYWZ0ZXIgdGhlCiAgICAvLy8gIGByZXZpZXdUaW1lYCBoYXMgZWxhcHNlZAogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dAogICAgZnVuY3Rpb24gcmVxdWVzdE1pbGVzdG9uZVBheW1lbnQodWludCBfaWRNaWxlc3RvbmUKICAgICAgICApIGNhbXBhaWduTm90Q2FuY2VsZWQgbm90Q2hhbmdpbmcgewogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93OwogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07CiAgICAgICAgaWYgKCAgKG1zZy5zZW5kZXIgIT0gbWlsZXN0b25lLm1pbGVzdG9uZUxlYWRMaW5rKQogICAgICAgICAgICAmJihtc2cuc2VuZGVyICE9IHJlY2lwaWVudCkpCiAgICAgICAgICAgIHRocm93OwogICAgICAgIGlmICAoKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkgfHwKICAgICAgICAgICAgIChub3cgPCBtaWxlc3RvbmUuZG9uZVRpbWUgKyBtaWxlc3RvbmUucmV2aWV3VGltZSkpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICBhdXRob3JpemVQYXltZW50KF9pZE1pbGVzdG9uZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG9ubHlSZWNpcGllbnRgIENhbmNlbHMgYSBwcmV2aW91c2x5IGFjY2VwdGVkIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBjYW5jZWxlZAogICAgZnVuY3Rpb24gY2FuY2VsTWlsZXN0b25lKHVpbnQgX2lkTWlsZXN0b25lKQogICAgICAgIG9ubHlSZWNpcGllbnQgY2FtcGFpZ25Ob3RDYW5jZWxlZCBub3RDaGFuZ2luZwogICAgewogICAgICAgIGlmIChfaWRNaWxlc3RvbmUgPj0gbWlsZXN0b25lcy5sZW5ndGgpIHRocm93OwogICAgICAgIE1pbGVzdG9uZSBtaWxlc3RvbmUgPSBtaWxlc3RvbmVzW19pZE1pbGVzdG9uZV07CiAgICAgICAgaWYgICgobWlsZXN0b25lLnN0YXR1cyAhPSBNaWxlc3RvbmVTdGF0dXMuQWNjZXB0ZWRBbmRJblByb2dyZXNzKSAmJgogICAgICAgICAgICAgKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkNvbXBsZXRlZCkpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICBtaWxlc3RvbmUuc3RhdHVzID0gTWlsZXN0b25lU3RhdHVzLkNhbmNlbGVkOwogICAgICAgIFByb3Bvc2FsU3RhdHVzQ2hhbmdlZChfaWRNaWxlc3RvbmUsIG1pbGVzdG9uZS5zdGF0dXMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5QXJiaXRyYXRvcmAgRm9yY2VzIGEgbWlsZXN0b25lIHRvIGJlIHBhaWQgb3V0IGFzIGxvbmcgYXMgaXQKICAgIC8vLyBoYXMgbm90IGJlZW4gcGFpZCBvciBjYW5jZWxlZAogICAgLy8vIEBwYXJhbSBfaWRNaWxlc3RvbmUgSUQgb2YgdGhlIG1pbGVzdG9uZSB0byBiZSBwYWlkIG91dAogICAgZnVuY3Rpb24gYXJiaXRyYXRlQXBwcm92ZU1pbGVzdG9uZSh1aW50IF9pZE1pbGVzdG9uZQogICAgKSBvbmx5QXJiaXRyYXRvciBjYW1wYWlnbk5vdENhbmNlbGVkIG5vdENoYW5naW5nIHsKICAgICAgICBpZiAoX2lkTWlsZXN0b25lID49IG1pbGVzdG9uZXMubGVuZ3RoKSB0aHJvdzsKICAgICAgICBNaWxlc3RvbmUgbWlsZXN0b25lID0gbWlsZXN0b25lc1tfaWRNaWxlc3RvbmVdOwogICAgICAgIGlmICAoKG1pbGVzdG9uZS5zdGF0dXMgIT0gTWlsZXN0b25lU3RhdHVzLkFjY2VwdGVkQW5kSW5Qcm9ncmVzcykgJiYKICAgICAgICAgICAgIChtaWxlc3RvbmUuc3RhdHVzICE9IE1pbGVzdG9uZVN0YXR1cy5Db21wbGV0ZWQpKQogICAgICAgICAgIHRocm93OwogICAgICAgIGF1dGhvcml6ZVBheW1lbnQoX2lkTWlsZXN0b25lKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgb25seUFyYml0cmF0b3JgIENhbmNlbHMgdGhlIGVudGlyZSBjYW1wYWlnbiB2b2lkaW5nIGFsbAogICAgLy8vICBtaWxlc3RvbmVzIHZvCiAgICBmdW5jdGlvbiBhcmJpdHJhdGVDYW5jZWxDYW1wYWlnbigpIG9ubHlBcmJpdHJhdG9yIGNhbXBhaWduTm90Q2FuY2VsZWQgewogICAgICAgIGNhbXBhaWduQ2FuY2VsZWQgPSB0cnVlOwogICAgICAgIENhbXBhaWduQ2FuY2VsZWQoKTsKICAgIH0KCiAgICAvLyBAZGV2IFRoaXMgaW50ZXJuYWwgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgd2hlbiB0aGUgbWlsZXN0b25lIGlzIHBhaWQgb3V0CiAgICBmdW5jdGlvbiBhdXRob3JpemVQYXltZW50KHVpbnQgX2lkTWlsZXN0b25lKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKF9pZE1pbGVzdG9uZSA+PSBtaWxlc3RvbmVzLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgTWlsZXN0b25lIG1pbGVzdG9uZSA9IG1pbGVzdG9uZXNbX2lkTWlsZXN0b25lXTsKICAgICAgICAvLyBSZWNoZWNrIGFnYWluIHRvIG5vdCBwYXkgdHdpY2UKICAgICAgICBpZiAobWlsZXN0b25lLnN0YXR1cyA9PSBNaWxlc3RvbmVTdGF0dXMuQXV0aG9yaXplZEZvclBheW1lbnQpIHRocm93OwogICAgICAgIG1pbGVzdG9uZS5zdGF0dXMgPSBNaWxlc3RvbmVTdGF0dXMuQXV0aG9yaXplZEZvclBheW1lbnQ7CiAgICAgICAgaWYgKCFtaWxlc3RvbmUucGF5bWVudFNvdXJjZS5jYWxsLnZhbHVlKDApKG1pbGVzdG9uZS5wYXlEYXRhKSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgUHJvcG9zYWxTdGF0dXNDaGFuZ2VkKF9pZE1pbGVzdG9uZSwgbWlsZXN0b25lLnN0YXR1cyk7CiAgICB9Cn0='.
	

]
