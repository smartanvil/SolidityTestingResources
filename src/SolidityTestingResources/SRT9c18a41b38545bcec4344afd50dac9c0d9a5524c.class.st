Class {
	#name : #SRT9c18a41b38545bcec4344afd50dac9c0d9a5524c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9c18a41b38545bcec4344afd50dac9c0d9a5524c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBTYWZlTWF0aCBUYWtlbiBGcm9tIEZpcnN0Qmxvb2QKY29udHJhY3QgU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGFzc2VydChiID4gMCk7CiAgICAgICAgdWludCBjID0gYSAvIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCi8vIEVSQzIwIEludGVyZmFjZQpjb250cmFjdCBFUkMyMCB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG90YWxTdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7Cn0KCi8vIEVSQzIwVG9rZW4KY29udHJhY3QgRVJDMjBUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggewoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVG9rZW5zOyAKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxUb2tlbnM7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9Cn0KCmNvbnRyYWN0IFdvbGsgaXMgRVJDMjBUb2tlbiB7CgogICAgLy8gVE9LRU4gSU5GTwogICAgc3RyaW5nICBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJXb2xrIFByb3RvY29sIFRva2VuIjsKICAgIHN0cmluZyAgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJXT0xLIjsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLy8gUkVTRVJWRQogICAgdWludDI1NiBwdWJsaWMgcmVzZXJ2ZUJhbGFuY2UgPSAwOyAKICAgIHVpbnQxNiAgcHVibGljIGNvbnN0YW50IHBlcmNlbnRhZ2VFVEhSZXNlcnZlID0gMjA7CgogICAgLy8gQ09OVFJBQ1QgT1dORVIKICAgIGFkZHJlc3MgcHVibGljIG93bmVyID0gbXNnLnNlbmRlcjsgICAgICAKICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0OwogICAgbW9kaWZpZXIgb25seU93bmVyIHsgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3duZXIpOyBfOyB9CgogICAgLy8gVE9LRU4gR0VORVJBVElPTiBFVkVOVAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBjb250cmlidXRpb247CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlbkdlbmVyYXRpb25NaW4gPSA1MCAqIDEwKio2ICogMTAqKmRlY2ltYWxzOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG9rZW5HZW5lcmF0aW9uTWF4ID0gNTAwICogMTAqKjYgKiAxMCoqZGVjaW1hbHM7CiAgICB1aW50MjU2IHB1YmxpYyBzdGFydF9ibG9jazsgCiAgICB1aW50MjU2IHB1YmxpYyBlbmRfYmxvY2s7CiAgICBib29sICAgIHB1YmxpYyBzYWxlQ29tcGxldGVkID0gZmFsc2U7CiAgICBtb2RpZmllciBpc1RyYW5zZmVyYWJsZSB7IGFzc2VydChzYWxlQ29tcGxldGVkKTsgXzsgfQoKICAgIC8vIFdPTEsgU0VUVExFUlMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgc2V0dGxlcnM7CiAgICBtb2RpZmllciBvbmx5U2V0dGxlciB7IGFzc2VydChzZXR0bGVyc1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsgXzsgfQoKICAgIC8vIFRPS0VOIEdFTkVSQVRJT04gRVZFTlRMT0cKICAgIGV2ZW50IFdvbGtDcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuQ3JlYXRlZCk7CiAgICBldmVudCBXb2xrRGVzdHJveWVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgdWludDI1NiBfdG9rZW5EZXN0cm95ZWQpOwogICAgZXZlbnQgTG9nUmVmdW5kKGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICAvLyBAcGFyYW0gX3N0YXJ0QmxvY2sKICAgIC8vIEBwYXJhbSBfZW5kQmxvY2sKICAgIC8vIEBwYXJhbSBfd29sa1dhbGxldAogICAgLy8gQHJldHVybiBzdWNjZXNzCiAgICAvLyBAZGV2IFdvbGsgR2VuZXNpcyBFdmVudCBbb25seSBhY2Nlc3NpYmxlIGJ5IENvbnRyYWN0IE93bmVyXQogICAgZnVuY3Rpb24gd29sa0dlbmVzaXModWludDI1NiBfc3RhcnRCbG9jaywgdWludDI1NiBfZW5kQmxvY2ssIGFkZHJlc3MgX3dvbGtXYWxsZXQpIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpewogICAgICAgIHJlcXVpcmUoICh0b3RhbFRva2VucyA8IDEpICYmICghc2V0dGxlcnNbbXNnLnNlbmRlcl0pICYmIChfZW5kQmxvY2sgPiBfc3RhcnRCbG9jaykgKTsKICAgICAgICBzdGFydF9ibG9jayA9IF9zdGFydEJsb2NrOwogICAgICAgIGVuZF9ibG9jayA9IF9lbmRCbG9jazsKICAgICAgICBtdWx0aXNpZ1dhbGxldCA9IF93b2xrV2FsbGV0OwogICAgICAgIHNldHRsZXJzW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAcGFyYW0gX25ld093bmVyCiAgICAvLyBAcmV0dXJuIHN1Y2Nlc3MKICAgIC8vIEBkZXYgVHJhbnNmZXJpbmcgQ29udHJhY3QgT3duZXJzaGlwLiBbb25seSBhY2Nlc3NpYmxlIGJ5IGN1cnJlbnQgQ29udHJhY3QgT3duZXJdCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgc2V0dGxlcnNbX25ld093bmVyXSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQGRldiBUb2tlbiBHZW5lcmF0aW9uIEV2ZW50IGZvciBXb2xrIFByb3RvY29sIFRva2VuLiBUR0UgUGFydGljaXBhbnQgc2VuZCBFdGggaW50byB0aGlzIGZ1bmMgaW4gZXhjaGFuZ2Ugb2YgV29sayBQcm90b2NvbCBUb2tlbgogICAgZnVuY3Rpb24gdG9rZW5HZW5lcmF0aW9uRXZlbnQoKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKCFzYWxlQ29tcGxldGVkKTsKICAgICAgICByZXF1aXJlKCAoYmxvY2subnVtYmVyID49IHN0YXJ0X2Jsb2NrKSAmJiAoYmxvY2subnVtYmVyIDw9IGVuZF9ibG9jaykgKTsKICAgICAgICB1aW50MjU2IHRva2VucyA9IHNhZmVNdWwobXNnLnZhbHVlLCA1KjEwKio5KTsgLy9leGNoYW5nZSByYXRlCiAgICAgICAgdWludDI1NiBjaGVja2VkU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFRva2VucywgdG9rZW5zKTsKICAgICAgICByZXF1aXJlKGNoZWNrZWRTdXBwbHkgPD0gdG9rZW5HZW5lcmF0aW9uTWF4KTsKICAgICAgICB0b3RhbFRva2VucyA9IGNoZWNrZWRTdXBwbHk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCB0b2tlbnMpOyAgCiAgICAgICAgY29udHJpYnV0aW9uW21zZy5zZW5kZXJdID0gc2FmZUFkZChjb250cmlidXRpb25bbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7ICAKICAgICAgICBXb2xrQ3JlYXRlZChtc2cuc2VuZGVyLCB0b2tlbnMpOyAvLyBsb2dzIHRva2VuIGNyZWF0aW9uCiAgICB9CgogICAgLy8gQGRldiBJZiBUb2tlbiBHZW5lcmF0aW9uIE1pbmltdW0gaXMgTm90IE1ldCwgVEdFIFBhcnRpY2lwYW50cyBjYW4gY2FsbCB0aGlzIGZ1bmMgYW5kIHJlcXVlc3QgZm9yIHJlZnVuZAogICAgZnVuY3Rpb24gcmVmdW5kKCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoIChjb250cmlidXRpb25bbXNnLnNlbmRlcl0gPiAwKSAmJiAoIXNhbGVDb21wbGV0ZWQpICYmICh0b3RhbFRva2VucyA8IHRva2VuR2VuZXJhdGlvbk1pbikgJiYgKGJsb2NrLm51bWJlciA+IGVuZF9ibG9jaykgKTsKICAgICAgICB1aW50MjU2IHRva2VuQmFsYW5jZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIHVpbnQyNTYgcmVmdW5kQmFsYW5jZSA9IGNvbnRyaWJ1dGlvblttc2cuc2VuZGVyXTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgY29udHJpYnV0aW9uW21zZy5zZW5kZXJdID0gMDsKICAgICAgICB0b3RhbFRva2VucyA9IHNhZmVTdWIodG90YWxUb2tlbnMsIHRva2VuQmFsYW5jZSk7CiAgICAgICAgV29sa0Rlc3Ryb3llZChtc2cuc2VuZGVyLCB0b2tlbkJhbGFuY2UpOwogICAgICAgIExvZ1JlZnVuZChtc2cuc2VuZGVyLCByZWZ1bmRCYWxhbmNlKTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZEJhbGFuY2UpOyAKICAgIH0KCiAgICAvLyBAZGV2IEZpbmFsaXppbmcgdGhlIFRva2VuIEdlbmVyYXRpb24gRXZlbnQuIDIwJSBvZiBFdGggd2lsbCBiZSBrZXB0IGluIGNvbnRyYWN0IHRvIHByb3ZpZGUgbGlxdWlkaXR5CiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZSggKCFzYWxlQ29tcGxldGVkKSAmJiAodG90YWxUb2tlbnMgPj0gdG9rZW5HZW5lcmF0aW9uTWluKSApOwogICAgICAgIHNhbGVDb21wbGV0ZWQgPSB0cnVlOwogICAgICAgIGVuZF9ibG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICByZXNlcnZlQmFsYW5jZSA9IHNhZmVEaXYoc2FmZU11bCh0aGlzLmJhbGFuY2UsIHBlcmNlbnRhZ2VFVEhSZXNlcnZlKSwgMTAwKTsKICAgICAgICB2YXIgd2l0aGRyYXdhbEJhbGFuY2UgPSBzYWZlU3ViKHRoaXMuYmFsYW5jZSwgcmVzZXJ2ZUJhbGFuY2UpOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIod2l0aGRyYXdhbEJhbGFuY2UpOwogICAgfQp9Cgpjb250cmFjdCBXb2xrUHJvdG9jb2wgaXMgV29sayB7CgogICAgLy8gV09MSyBORVRXT1JLIFBST1RPQ09MCiAgICB1aW50MjU2IHB1YmxpYyBidXJuQmFzaXNQb2ludHMgPSA1MDA7ICAvLyBCdXJuIHJhdGUgKGluIEJQKSB3aGVuIFNlcnZpY2UgUHJvdmlkZXIgd2l0aGRyYXdzIGZyb20gZGF0YSBidXllcnMnIGFjY291bnRzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkpIGF1dGhvcml6ZWQ7IC8vIGhvbGRzIHdoaWNoIGFjY291bnRzIGhhdmUgYXBwcm92ZWQgd2hpY2ggU2VydmljZSBQcm92aWRlcnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgZmVlQmFzaXNQb2ludHM7ICAgLy8gRmVlIChpbiBCUCkgZWFybmVkIGJ5IFNlcnZpY2UgUHJvdmlkZXIgd2hlbiBkZXBvc2l0aW5nIHRvIGRhdGEgc2VsbGVyIAoKICAgIC8vIFdPTEsgUFJPVE9DT0wgRXZlbnRzOgogICAgZXZlbnQgQXV0aG9yaXplU2VydmljZVByb3ZpZGVyKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgX3NlcnZpY2VQcm92aWRlcik7CiAgICBldmVudCBEZWF1dGhvcml6ZVNlcnZpY2VQcm92aWRlcihhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIF9zZXJ2aWNlUHJvdmlkZXIpOwogICAgZXZlbnQgU2V0U2VydmljZVByb3ZpZGVyRmVlKGFkZHJlc3MgaW5kZXhlZCBfc2VydmljZVByb3ZpZGVyLCB1aW50MjU2IF9mZWVCYXNpc1BvaW50cyk7CiAgICBldmVudCBCdXJuVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF9zZXJ2aWNlUHJvdmlkZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICAvLyBAcGFyYW0gIF9idXJuQmFzaXNQb2ludHMKICAgIC8vIEByZXR1cm4gc3VjY2VzcwogICAgLy8gQGRldiBTZXQgQnVyblJhdGUgb24gV29sayBQcm90b2NvbCAtLSBvbmx5IFdvbGsgRm91bmRhdGlvbiBjYW4gc2V0IHRoaXMsIGFmZmVjdHMgU2VydmljZSBQcm92aWRlciBzZXR0bGVCdXllcgogICAgZnVuY3Rpb24gc2V0QnVyblJhdGUodWludDI1NiBfYnVybkJhc2lzUG9pbnRzKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSggKF9idXJuQmFzaXNQb2ludHMgPiAwKSAmJiAoX2J1cm5CYXNpc1BvaW50cyA8PSAxMDAwKSApOwogICAgICAgIGJ1cm5CYXNpc1BvaW50cyA9IF9idXJuQmFzaXNQb2ludHM7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQHBhcmFtICBfc2VydmljZVByb3ZpZGVyCiAgICAvLyBAcGFyYW0gIF9mZWVCYXNpc1BvaW50cwogICAgLy8gQHJldHVybiBzdWNjZXNzCiAgICAvLyBAZGV2IFNldCBTZXJ2aWNlIFByb3ZpZGVyIGZlZSAtLSBvbmx5IENvbnRyYWN0IE93bmVyIGNhbiBkbyB0aGlzLCBhZmZlY3RzIFNlcnZpY2UgUHJvdmlkZXIgc2V0dGxlU2VsbGVyCiAgICBmdW5jdGlvbiBzZXRTZXJ2aWNlRmVlKGFkZHJlc3MgX3NlcnZpY2VQcm92aWRlciwgdWludDI1NiBfZmVlQmFzaXNQb2ludHMpIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIF9mZWVCYXNpc1BvaW50cyA8PSAwIHx8IF9mZWVCYXNpc1BvaW50cyA+IDQwMDApewogICAgICAgICAgICAvLyByZXZva2UgU2V0dGxlciBwcml2aWxlZ2UKICAgICAgICAgICAgc2V0dGxlcnNbX3NlcnZpY2VQcm92aWRlcl0gPSBmYWxzZTsKICAgICAgICAgICAgZmVlQmFzaXNQb2ludHNbX3NlcnZpY2VQcm92aWRlcl0gPSAwOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGZlZUJhc2lzUG9pbnRzW19zZXJ2aWNlUHJvdmlkZXJdID0gX2ZlZUJhc2lzUG9pbnRzOwogICAgICAgICAgICBzZXR0bGVyc1tfc2VydmljZVByb3ZpZGVyXSA9IHRydWU7CiAgICAgICAgICAgIFNldFNlcnZpY2VQcm92aWRlckZlZShfc2VydmljZVByb3ZpZGVyLCBfZmVlQmFzaXNQb2ludHMpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQHBhcmFtICBfc2VydmljZVByb3ZpZGVyCiAgICAvLyBAcmV0dXJuIF9mZWVCYXNpc1BvaW50cwogICAgLy8gQGRldiBDaGVjayBzZXJ2aWNlIGVlIChpbiBCUCkgZm9yIGEgZ2l2ZW4gcHJvdmlkZXIKICAgIGZ1bmN0aW9uIGNoZWNrU2VydmljZUZlZShhZGRyZXNzIF9zZXJ2aWNlUHJvdmlkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX2ZlZUJhc2lzUG9pbnRzKSB7CiAgICAgICAgcmV0dXJuIGZlZUJhc2lzUG9pbnRzW19zZXJ2aWNlUHJvdmlkZXJdOwogICAgfQoKICAgIC8vIEBwYXJhbSAgX2J1eWVyCiAgICAvLyBAcGFyYW0gIF92YWx1ZQogICAgLy8gQHJldHVybiBzdWNjZXNzCiAgICAvLyBAZGV2IFNlcnZpY2UgUHJvdmlkZXIgU2V0dGxlbWVudCB3aXRoIEJ1eWVyOiBhIHNtYWxsIHBlcmNlbnQgaXMgYnVybnQgKHNldCBpbiBzZXRCdXJuUmF0ZSwgc3RvcmVkIGluIGJ1cm5CYXNpc1BvaW50cykgd2hlbiBmdW5kcyBhcmUgdHJhbnNmZXJyZWQgZnJvbSBidXllciB0byBTZXJ2aWNlIFByb3ZpZGVyIFtvbmx5IGFjY2Vzc2libGUgYnkgc2V0dGxlcnNdCiAgICBmdW5jdGlvbiBzZXR0bGVCdXllcihhZGRyZXNzIF9idXllciwgdWludDI1NiBfdmFsdWUpIG9ubHlTZXR0bGVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIChidXJuQmFzaXNQb2ludHMgPiAwKSAmJiAoYnVybkJhc2lzUG9pbnRzIDw9IDEwMDApICYmIGF1dGhvcml6ZWRbX2J1eWVyXVttc2cuc2VuZGVyXSApOyAvLyBCdXllciBtdXN0IGF1dGhvcml6ZSBTZXJ2aWNlIFByb3ZpZGVyIAogICAgICAgIGlmICggYmFsYW5jZXNbX2J1eWVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICB2YXIgYnVybkNhcCA9IHNhZmVEaXYoc2FmZU11bChfdmFsdWUsIGJ1cm5CYXNpc1BvaW50cyksIDEwMDAwKTsKICAgICAgICAgICAgdmFyIHRyYW5zZmVycmVkVG9TZXJ2aWNlUHJvdmlkZXIgPSBzYWZlU3ViKF92YWx1ZSwgYnVybkNhcCk7CiAgICAgICAgICAgIGJhbGFuY2VzW19idXllcl0gPSBzYWZlU3ViKGJhbGFuY2VzW19idXllcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZUFkZChiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdHJhbnNmZXJyZWRUb1NlcnZpY2VQcm92aWRlcik7CiAgICAgICAgICAgIHRvdGFsVG9rZW5zID0gc2FmZVN1Yih0b3RhbFRva2VucywgYnVybkNhcCk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9idXllciwgbXNnLnNlbmRlciwgdHJhbnNmZXJyZWRUb1NlcnZpY2VQcm92aWRlcik7CiAgICAgICAgICAgIEJ1cm5Ub2tlbnMoX2J1eWVyLCBtc2cuc2VuZGVyLCBidXJuQ2FwKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0gCgogICAgLy8gQHBhcmFtICBfc2VsbGVyCiAgICAvLyBAcGFyYW0gIF92YWx1ZQogICAgLy8gQHJldHVybiBzdWNjZXNzCiAgICAvLyBAZGV2IFNlcnZpY2UgUHJvdmlkZXIgU2V0dGxlbWVudCB3aXRoIFNlbGxlcjogYSBzbWFsbCBwZXJjZW50IGlzIGtlcHQgYnkgU2VydmljZSBQcm92aWRlciAoc2V0IGluIHNldFNlcnZpY2VGZWUsIHN0b3JlZCBpbiBmZWVCYXNpc1BvaW50cykgd2hlbiBmdW5kcyBhcmUgdHJhbnNmZXJyZWQgZnJvbSBTZXJ2aWNlIFByb3ZpZGVyIHRvIHNlbGxlciBbb25seSBhY2Nlc3NpYmxlIGJ5IHNldHRsZXJzXQogICAgZnVuY3Rpb24gc2V0dGxlU2VsbGVyKGFkZHJlc3MgX3NlbGxlciwgdWludDI1NiBfdmFsdWUpIG9ubHlTZXR0bGVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vIFNlcnZpY2UgUHJvdmlkZXJzIGhhdmUgYSAlIGZlZSBmb3IgU2VsbGVycyAoZS5nLiAyMCUpCiAgICAgICAgdmFyIHNlcnZpY2VQcm92aWRlckJQID0gZmVlQmFzaXNQb2ludHNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZSggKHNlcnZpY2VQcm92aWRlckJQID4gMCkgJiYgKHNlcnZpY2VQcm92aWRlckJQIDw9IDQwMDApICk7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHZhciBmZWUgPSBzYWZlRGl2KHNhZmVNdWwoX3ZhbHVlLCBzZXJ2aWNlUHJvdmlkZXJCUCksIDEwMDAwKTsKICAgICAgICAgICAgdmFyIHRyYW5zZmVycmVkVG9TZWxsZXIgPSBzYWZlU3ViKF92YWx1ZSwgZmVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX3NlbGxlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW19zZWxsZXJdLCB0cmFuc2ZlcnJlZFRvU2VsbGVyKTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3NlbGxlciwgdHJhbnNmZXJyZWRUb1NlbGxlcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQHBhcmFtIF9wcm92aWRlclRvQWRkCiAgICAvLyBAcmV0dXJuIHN1Y2Nlc3MKICAgIC8vIEBkZXYgQnV5ZXIgYXV0aG9yaXplcyB0aGUgU2VydmljZSBQcm92aWRlciAodG8gY2FsbCBzZXR0bGVCdXllcikuIEZvciBzZWN1cml0eSByZWFzb24sIF9wcm92aWRlclRvQWRkIG5lZWRzIHRvIGJlIHdoaXRlbGlzdGVkIGJ5IFdvbGsgRm91bmRhdGlvbiBmaXJzdAogICAgZnVuY3Rpb24gYXV0aG9yaXplUHJvdmlkZXIoYWRkcmVzcyBfcHJvdmlkZXJUb0FkZCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShzZXR0bGVyc1tfcHJvdmlkZXJUb0FkZF0pOwogICAgICAgIGF1dGhvcml6ZWRbbXNnLnNlbmRlcl1bX3Byb3ZpZGVyVG9BZGRdID0gdHJ1ZTsKICAgICAgICBBdXRob3JpemVTZXJ2aWNlUHJvdmlkZXIobXNnLnNlbmRlciwgX3Byb3ZpZGVyVG9BZGQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEBwYXJhbSBfcHJvdmlkZXJUb1JlbW92ZQogICAgLy8gQHJldHVybiBzdWNjZXNzCiAgICAvLyBAZGV2IEJ1eWVyIGRlYXV0aG9yaXplcyB0aGUgU2VydmljZSBQcm92aWRlciAoZnJvbSBjYWxsaW5nIHNldHRsZUJ1eWVyKQogICAgZnVuY3Rpb24gZGVhdXRob3JpemVQcm92aWRlcihhZGRyZXNzIF9wcm92aWRlclRvUmVtb3ZlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhdXRob3JpemVkW21zZy5zZW5kZXJdW19wcm92aWRlclRvUmVtb3ZlXSA9IGZhbHNlOwogICAgICAgIERlYXV0aG9yaXplU2VydmljZVByb3ZpZGVyKG1zZy5zZW5kZXIsIF9wcm92aWRlclRvUmVtb3ZlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAcGFyYW0gX293bmVyCiAgICAvLyBAcGFyYW0gX3NlcnZpY2VQcm92aWRlcgogICAgLy8gQHJldHVybiBhdXRob3JpemF0aW9uU3RhdHVzCiAgICAvLyBAZGV2IENoZWNrIGF1dGhvcml6YXRpb24gYmV0d2VlbiBhY2NvdW50IGFuZCBTZXJ2aWNlIFByb3ZpZGVyCiAgICBmdW5jdGlvbiBjaGVja0F1dGhvcml6YXRpb24oYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NlcnZpY2VQcm92aWRlcikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhdXRob3JpemF0aW9uU3RhdHVzKSB7CiAgICAgICAgcmV0dXJuIGF1dGhvcml6ZWRbX293bmVyXVtfc2VydmljZVByb3ZpZGVyXTsKICAgIH0KCiAgICAvLyBAcGFyYW0gX293bmVyCiAgICAvLyBAcGFyYW0gX3Byb3ZpZGVyVG9BZGQKICAgIC8vIEByZXR1cm4gYXV0aG9yaXphdGlvblN0YXR1cwogICAgLy8gQGRldiBHcmFudCBhdXRob3JpemF0aW9uIGJldHdlZW4gYWNjb3VudCBhbmQgU2VydmljZSBQcm92aWRlciBvbiBidXllcnMnIGJlaGFsZiBbb25seSBhY2Nlc3NpYmxlIGJ5IENvbnRyYWN0IE93bmVyXQogICAgLy8gQG5vdGUgRXhwbGljaXQgcGVybWlzc2lvbiBmcm9tIGJhbGFuY2Ugb3duZXIgTVVTVCBiZSBvYnRhaW5lZCBiZWZvcmVoYW5kCiAgICBmdW5jdGlvbiBncmFudFNlcnZpY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3Byb3ZpZGVyVG9BZGQpIG9ubHlPd25lciByZXR1cm5zIChib29sIGF1dGhvcml6YXRpb25TdGF0dXMpIHsKICAgICAgICB2YXIgaXNQcmVhdXRob3JpemVkID0gYXV0aG9yaXplZFtfb3duZXJdW21zZy5zZW5kZXJdOwogICAgICAgIGlmIChpc1ByZWF1dGhvcml6ZWQgJiYgc2V0dGxlcnNbX3Byb3ZpZGVyVG9BZGRdICkgewogICAgICAgICAgICBhdXRob3JpemVkW19vd25lcl1bX3Byb3ZpZGVyVG9BZGRdID0gdHJ1ZTsKICAgICAgICAgICAgQXV0aG9yaXplU2VydmljZVByb3ZpZGVyKG1zZy5zZW5kZXIsIF9wcm92aWRlclRvQWRkKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQHBhcmFtIF9vd25lcgogICAgLy8gQHBhcmFtIF9wcm92aWRlclRvUmVtb3ZlCiAgICAvLyBAcmV0dXJuIGF1dGhvcml6YXRpb25fc3RhdHVzCiAgICAvLyBAZGV2IFJldm9rZSBhdXRob3JpemF0aW9uIGJldHdlZW4gYWNjb3VudCBhbmQgU2VydmljZSBQcm92aWRlciBvbiBidXllcnMnIGJlaGFsZiBbb25seSBhY2Nlc3NpYmxlIGJ5IENvbnRyYWN0IE93bmVyXQogICAgLy8gQG5vdGUgRXhwbGljaXQgcGVybWlzc2lvbiBmcm9tIGJhbGFuY2Ugb3duZXIgYXJlIE5PVCByZXF1aXJlZCBmb3IgZGlzYWJsaW5nIGlsbC1pbnRlbnQgU2VydmljZSBQcm92aWRlcgogICAgZnVuY3Rpb24gcmVtb3ZlU2VydmljZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfcHJvdmlkZXJUb1JlbW92ZSkgb25seU93bmVyIHJldHVybnMgKGJvb2wgYXV0aG9yaXphdGlvblN0YXR1cykgewogICAgICAgIGF1dGhvcml6ZWRbX293bmVyXVtfcHJvdmlkZXJUb1JlbW92ZV0gPSBmYWxzZTsKICAgICAgICBEZWF1dGhvcml6ZVNlcnZpY2VQcm92aWRlcihfb3duZXIsIF9wcm92aWRlclRvUmVtb3ZlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKY29udHJhY3QgQmFuY29yRm9ybXVsYSBpcyBTYWZlTWF0aCB7CgogICAgLy8gVGFrZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vYmFuY29ycHJvdG9jb2wvY29udHJhY3RzL2Jsb2IvbWFzdGVyL3NvbGlkaXR5L2NvbnRyYWN0cy9CYW5jb3JGb3JtdWxhLnNvbAogICAgdWludDggY29uc3RhbnQgUFJFQ0lTSU9OICAgPSAzMjsgIC8vIGZyYWN0aW9uYWwgYml0cwogICAgdWludDI1NiBjb25zdGFudCBGSVhFRF9PTkUgPSB1aW50MjU2KDEpIDw8IFBSRUNJU0lPTjsgLy8gMHgxMDAwMDAwMDAKICAgIHVpbnQyNTYgY29uc3RhbnQgRklYRURfVFdPID0gdWludDI1NigyKSA8PCBQUkVDSVNJT047IC8vIDB4MjAwMDAwMDAwCiAgICB1aW50MjU2IGNvbnN0YW50IE1BWF9WQUwgICA9IHVpbnQyNTYoMSkgPDwgKDI1NiAtIFBSRUNJU0lPTik7IC8vIDB4MDAwMDAwMDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAoKICAgIC8qKgogICAgICAgIEBkZXYgZ2l2ZW4gYSB0b2tlbiBzdXBwbHksIHJlc2VydmUsIENSUiBhbmQgYSBkZXBvc2l0IGFtb3VudCAoaW4gdGhlIHJlc2VydmUgdG9rZW4pLCBjYWxjdWxhdGVzIHRoZSByZXR1cm4gZm9yIGEgZ2l2ZW4gY2hhbmdlIChpbiB0aGUgbWFpbiB0b2tlbikKCiAgICAgICAgRm9ybXVsYToKICAgICAgICBSZXR1cm4gPSBfc3VwcGx5ICogKCgxICsgX2RlcG9zaXRBbW91bnQgLyBfcmVzZXJ2ZUJhbGFuY2UpIF4gKF9yZXNlcnZlUmF0aW8gLyAxMDApIC0gMSkKCiAgICAgICAgQHBhcmFtIF9zdXBwbHkgICAgICAgICAgICAgdG9rZW4gdG90YWwgc3VwcGx5CiAgICAgICAgQHBhcmFtIF9yZXNlcnZlQmFsYW5jZSAgICAgdG90YWwgcmVzZXJ2ZQogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVJhdGlvICAgICAgIGNvbnN0YW50IHJlc2VydmUgcmF0aW8sIDEtMTAwCiAgICAgICAgQHBhcmFtIF9kZXBvc2l0QW1vdW50ICAgICAgZGVwb3NpdCBhbW91bnQsIGluIHJlc2VydmUgdG9rZW4KCiAgICAgICAgQHJldHVybiBwdXJjaGFzZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlUHVyY2hhc2VSZXR1cm4odWludDI1NiBfc3VwcGx5LCB1aW50MjU2IF9yZXNlcnZlQmFsYW5jZSwgdWludDE2IF9yZXNlcnZlUmF0aW8sIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gdmFsaWRhdGUgaW5wdXQKICAgICAgICByZXF1aXJlKF9zdXBwbHkgIT0gMCAmJiBfcmVzZXJ2ZUJhbGFuY2UgIT0gMCAmJiBfcmVzZXJ2ZVJhdGlvID4gMCAmJiBfcmVzZXJ2ZVJhdGlvIDw9IDEwMCk7CgogICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgMCBkZXBvc2l0IGFtb3VudAogICAgICAgIGlmIChfZGVwb3NpdEFtb3VudCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKCiAgICAgICAgdWludDI1NiBiYXNlTiA9IHNhZmVBZGQoX2RlcG9zaXRBbW91bnQsIF9yZXNlcnZlQmFsYW5jZSk7CiAgICAgICAgdWludDI1NiB0ZW1wOwoKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgaWYgdGhlIENSUiA9IDEwMAogICAgICAgIGlmIChfcmVzZXJ2ZVJhdGlvID09IDEwMCkgewogICAgICAgICAgICB0ZW1wID0gc2FmZU11bChfc3VwcGx5LCBiYXNlTikgLyBfcmVzZXJ2ZUJhbGFuY2U7CiAgICAgICAgICAgIHJldHVybiBzYWZlU3ViKHRlbXAsIF9zdXBwbHkpOyAKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcmVzTiA9IHBvd2VyKGJhc2VOLCBfcmVzZXJ2ZUJhbGFuY2UsIF9yZXNlcnZlUmF0aW8sIDEwMCk7CgogICAgICAgIHRlbXAgPSBzYWZlTXVsKF9zdXBwbHksIHJlc04pIC8gRklYRURfT05FOwoKICAgICAgICB1aW50MjU2IHJlc3VsdCA9ICBzYWZlU3ViKHRlbXAsIF9zdXBwbHkpOwogICAgICAgIC8vIGZyb20gdGhlIHJlc3VsdCwgd2UgZGVkdWN0IHRoZSBtaW5pbWFsIGluY3JlbWVudCwgd2hpY2ggaXMgYSAgICAgICAgIAogICAgICAgIC8vIGZ1bmN0aW9uIG9mIFMgYW5kIHByZWNpc2lvbi4gICAgICAgCiAgICAgICAgcmV0dXJuIHNhZmVTdWIocmVzdWx0LCBfc3VwcGx5IC8gMHgxMDAwMDAwMDApOwogICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGdpdmVuIGEgdG9rZW4gc3VwcGx5LCByZXNlcnZlLCBDUlIgYW5kIGEgc2VsbCBhbW91bnQgKGluIHRoZSBtYWluIHRva2VuKSwgY2FsY3VsYXRlcyB0aGUgcmV0dXJuIGZvciBhIGdpdmVuIGNoYW5nZSAoaW4gdGhlIHJlc2VydmUgdG9rZW4pCgogICAgICAgIEZvcm11bGE6CiAgICAgICAgUmV0dXJuID0gX3Jlc2VydmVCYWxhbmNlICogKDEgLSAoMSAtIF9zZWxsQW1vdW50IC8gX3N1cHBseSkgXiAoMSAvIChfcmVzZXJ2ZVJhdGlvIC8gMTAwKSkpCgogICAgICAgIEBwYXJhbSBfc3VwcGx5ICAgICAgICAgICAgIHRva2VuIHRvdGFsIHN1cHBseQogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZUJhbGFuY2UgICAgIHRvdGFsIHJlc2VydmUKICAgICAgICBAcGFyYW0gX3Jlc2VydmVSYXRpbyAgICAgICBjb25zdGFudCByZXNlcnZlIHJhdGlvLCAxLTEwMAogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgICAgIHNlbGwgYW1vdW50LCBpbiB0aGUgdG9rZW4gaXRzZWxmCgogICAgICAgIEByZXR1cm4gc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlU2FsZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX3Jlc2VydmVCYWxhbmNlLCB1aW50MTYgX3Jlc2VydmVSYXRpbywgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dAogICAgICAgIHJlcXVpcmUoX3N1cHBseSAhPSAwICYmIF9yZXNlcnZlQmFsYW5jZSAhPSAwICYmIF9yZXNlcnZlUmF0aW8gPiAwICYmIF9yZXNlcnZlUmF0aW8gPD0gMTAwICYmIF9zZWxsQW1vdW50IDw9IF9zdXBwbHkpOwoKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIDAgc2VsbCBhbW91bnQKICAgICAgICBpZiAoX3NlbGxBbW91bnQgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIHVpbnQyNTYgYmFzZU4gPSBzYWZlU3ViKF9zdXBwbHksIF9zZWxsQW1vdW50KTsKICAgICAgICB1aW50MjU2IHRlbXAxOwogICAgICAgIHVpbnQyNTYgdGVtcDI7CgogICAgICAgIC8vIHNwZWNpYWwgY2FzZSBpZiB0aGUgQ1JSID0gMTAwCiAgICAgICAgaWYgKF9yZXNlcnZlUmF0aW8gPT0gMTAwKSB7CiAgICAgICAgICAgIHRlbXAxID0gc2FmZU11bChfcmVzZXJ2ZUJhbGFuY2UsIF9zdXBwbHkpOwogICAgICAgICAgICB0ZW1wMiA9IHNhZmVNdWwoX3Jlc2VydmVCYWxhbmNlLCBiYXNlTik7CiAgICAgICAgICAgIHJldHVybiBzYWZlU3ViKHRlbXAxLCB0ZW1wMikgLyBfc3VwcGx5OwogICAgICAgIH0KCiAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciBzZWxsaW5nIHRoZSBlbnRpcmUgc3VwcGx5CiAgICAgICAgaWYgKF9zZWxsQW1vdW50ID09IF9zdXBwbHkpCiAgICAgICAgICAgIHJldHVybiBfcmVzZXJ2ZUJhbGFuY2U7CgogICAgICAgIHVpbnQyNTYgcmVzTiA9IHBvd2VyKF9zdXBwbHksIGJhc2VOLCAxMDAsIF9yZXNlcnZlUmF0aW8pOwoKICAgICAgICB0ZW1wMSA9IHNhZmVNdWwoX3Jlc2VydmVCYWxhbmNlLCByZXNOKTsKICAgICAgICB0ZW1wMiA9IHNhZmVNdWwoX3Jlc2VydmVCYWxhbmNlLCBGSVhFRF9PTkUpOwoKICAgICAgICB1aW50MjU2IHJlc3VsdCA9IHNhZmVTdWIodGVtcDEsIHRlbXAyKSAvIHJlc047CgogICAgICAgIC8vIGZyb20gdGhlIHJlc3VsdCwgd2UgZGVkdWN0IHRoZSBtaW5pbWFsIGluY3JlbWVudCwgd2hpY2ggaXMgYSAgICAgICAgIAogICAgICAgIC8vIGZ1bmN0aW9uIG9mIFIgYW5kIHByZWNpc2lvbi4gICAgICAgCiAgICAgICAgcmV0dXJuIHNhZmVTdWIocmVzdWx0LCBfcmVzZXJ2ZUJhbGFuY2UgLyAweDEwMDAwMDAwMCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBDYWxjdWxhdGUgKF9iYXNlTiAvIF9iYXNlRCkgXiAoX2V4cE4gLyBfZXhwRCkKICAgICAgICBSZXR1cm5zIHJlc3VsdCB1cHNoaWZ0ZWQgYnkgUFJFQ0lTSU9OCgogICAgICAgIFRoaXMgbWV0aG9kIGlzIG92ZXJmbG93LXNhZmUKICAgICovIAogICAgZnVuY3Rpb24gcG93ZXIodWludDI1NiBfYmFzZU4sIHVpbnQyNTYgX2Jhc2VELCB1aW50MzIgX2V4cE4sIHVpbnQzMiBfZXhwRCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiByZXNOKSB7CiAgICAgICAgdWludDI1NiBsb2diYXNlID0gbG4oX2Jhc2VOLCBfYmFzZUQpOwogICAgICAgIC8vIE5vdCB1c2luZyBzYWZlRGl2IGhlcmUsIHNpbmNlIHNhZmVEaXYgcHJvdGVjdHMgYWdhaW5zdAogICAgICAgIC8vIHByZWNpc2lvbiBsb3NzLiBJdOKAmXMgdW5hdm9pZGFibGUsIGhvd2V2ZXIKICAgICAgICAvLyBCb3RoIGBsbmAgYW5kIGBmaXhlZEV4cGAgYXJlIG92ZXJmbG93LXNhZmUuIAogICAgICAgIHJlc04gPSBmaXhlZEV4cChzYWZlTXVsKGxvZ2Jhc2UsIF9leHBOKSAvIF9leHBEKTsKICAgICAgICByZXR1cm4gcmVzTjsKICAgIH0KICAgIAogICAgLyoqCiAgICAgICAgaW5wdXQgcmFuZ2U6IAogICAgICAgICAgICAtIG51bWVyYXRvcjogWzEsIHVpbnQyNTZfbWF4ID4+IFBSRUNJU0lPTl0gICAgCiAgICAgICAgICAgIC0gZGVub21pbmF0b3I6IFsxLCB1aW50MjU2X21heCA+PiBQUkVDSVNJT05dCiAgICAgICAgb3V0cHV0IHJhbmdlOgogICAgICAgICAgICBbMCwgMHg5YjQzZDRmOGQ2XQoKICAgICAgICBUaGlzIG1ldGhvZCBhc3NlcnRzIG91dHNpZGUgb2YgYm91bmRzCgogICAgKi8KICAgIGZ1bmN0aW9uIGxuKHVpbnQyNTYgX251bWVyYXRvciwgdWludDI1NiBfZGVub21pbmF0b3IpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBkZW5vbWluYXRvciA+IG51bWVyYXRvcjogbGVzcyB0aGFuIG9uZSB5aWVsZHMgbmVnYXRpdmUgdmFsdWVzLiBVbnN1cHBvcnRlZAogICAgICAgIGFzc2VydChfZGVub21pbmF0b3IgPD0gX251bWVyYXRvcik7CgogICAgICAgIC8vIGxvZygxKSBpcyB0aGUgbG93ZXN0IHdlIGNhbiBnbwogICAgICAgIGFzc2VydChfZGVub21pbmF0b3IgIT0gMCAmJiBfbnVtZXJhdG9yICE9IDApOwoKICAgICAgICAvLyBVcHBlciAzMiBiaXRzIGFyZSBzY2FsZWQgb2ZmIGJ5IFBSRUNJU0lPTgogICAgICAgIGFzc2VydChfbnVtZXJhdG9yIDwgTUFYX1ZBTCk7CiAgICAgICAgYXNzZXJ0KF9kZW5vbWluYXRvciA8IE1BWF9WQUwpOwoKICAgICAgICByZXR1cm4gZml4ZWRMb2dlKCAoX251bWVyYXRvciAqIEZJWEVEX09ORSkgLyBfZGVub21pbmF0b3IpOwogICAgfQoKICAgIC8qKgogICAgICAgIGlucHV0IHJhbmdlOiAKICAgICAgICAgICAgWzB4MTAwMDAwMDAwLHVpbnQyNTZfbWF4XQogICAgICAgIG91dHB1dCByYW5nZToKICAgICAgICAgICAgWzAsIDB4OWI0M2Q0ZjhkNl0KCiAgICAgICAgVGhpcyBtZXRob2QgYXNzZXJ0cyBvdXRzaWRlIG9mIGJvdW5kcwoKICAgICovCiAgICBmdW5jdGlvbiBmaXhlZExvZ2UodWludDI1NiBfeCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiBsb2dFKSB7CiAgICAgICAgLyoKICAgICAgICBTaW5jZSBgZml4ZWRMb2cyX21pbmAgb3V0cHV0IHJhbmdlIGlzIG1heCBgMHhkZmZmZmZmZmZmYCAKICAgICAgICAoNDAgYml0cywgb3IgNSBieXRlcyksIHdlIGNhbiB1c2UgYSB2ZXJ5IGxhcmdlIGFwcHJveGltYXRpb24KICAgICAgICBmb3IgYGxuKDIpYC4gVGhpcyBvbmUgaXMgdXNlZCBzaW5jZSBpdOKAmXMgdGhlIG1heCBhY2N1cmFjeSAKICAgICAgICBvZiBQeXRob24gYGxuKDIpYAoKICAgICAgICAweGIxNzIxN2Y3ZDFjZjc4ID0gbG4oMikgKiAoMSA8PCA1NikKICAgICAgICAKICAgICAgICAqLwogICAgICAgIC8vQ2Fubm90IHJlcHJlc2VudCBuZWdhdGl2ZSBudW1iZXJzIChiZWxvdyAxKQogICAgICAgIGFzc2VydChfeCA+PSBGSVhFRF9PTkUpOwoKICAgICAgICB1aW50MjU2IGxvZzIgPSBmaXhlZExvZzIoX3gpOwogICAgICAgIGxvZ0UgPSAobG9nMiAqIDB4YjE3MjE3ZjdkMWNmNzgpID4+IDU2OwogICAgfQoKICAgIC8qKgogICAgICAgIFJldHVybnMgbG9nMih4ID4+IDMyKSA8PCAzMiBbMV0KICAgICAgICBTbyB4IGlzIGFzc3VtZWQgdG8gYmUgYWxyZWFkeSB1cHNoaWZ0ZWQgMzIgYml0cywgYW5kIAogICAgICAgIHRoZSByZXN1bHQgaXMgYWxzbyB1cHNoaWZ0ZWQgMzIgYml0cy4gCiAgICAgICAgCiAgICAgICAgWzFdIFRoZSBmdW5jdGlvbiByZXR1cm5zIGEgbnVtYmVyIHdoaWNoIGlzIGxvd2VyIHRoYW4gdGhlIAogICAgICAgIGFjdHVhbCB2YWx1ZQoKICAgICAgICBpbnB1dC1yYW5nZSA6IAogICAgICAgICAgICBbMHgxMDAwMDAwMDAsdWludDI1Nl9tYXhdCiAgICAgICAgb3V0cHV0LXJhbmdlOiAKICAgICAgICAgICAgWzAsMHhkZmZmZmZmZmZmXQoKICAgICAgICBUaGlzIG1ldGhvZCBhc3NlcnRzIG91dHNpZGUgb2YgYm91bmRzCgogICAgKi8KICAgIGZ1bmN0aW9uIGZpeGVkTG9nMih1aW50MjU2IF94KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gTnVtYmVycyBiZWxvdyAxIGFyZSBuZWdhdGl2ZS4gCiAgICAgICAgYXNzZXJ0KCBfeCA+PSBGSVhFRF9PTkUpOwoKICAgICAgICB1aW50MjU2IGhpID0gMDsKICAgICAgICB3aGlsZSAoX3ggPj0gRklYRURfVFdPKSB7CiAgICAgICAgICAgIF94ID4+PSAxOwogICAgICAgICAgICBoaSArPSBGSVhFRF9PTkU7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgUFJFQ0lTSU9OOyArK2kpIHsKICAgICAgICAgICAgX3ggPSAoX3ggKiBfeCkgLyBGSVhFRF9PTkU7CiAgICAgICAgICAgIGlmIChfeCA+PSBGSVhFRF9UV08pIHsKICAgICAgICAgICAgICAgIF94ID4+PSAxOwogICAgICAgICAgICAgICAgaGkgKz0gdWludDI1NigxKSA8PCAoUFJFQ0lTSU9OIC0gMSAtIGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaGk7CiAgICB9CgogICAgLyoqCiAgICAgICAgZml4ZWRFeHAgaXMgYSDigJhwcm90ZWN0ZWTigJkgdmVyc2lvbiBvZiBgZml4ZWRFeHBVbnNhZmVgLCB3aGljaCAKICAgICAgICBhc3NlcnRzIGluc3RlYWQgb2Ygb3ZlcmZsb3dzCiAgICAqLwogICAgZnVuY3Rpb24gZml4ZWRFeHAodWludDI1NiBfeCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChfeCA8PSAweDM4NmJmZGJhMjkpOwogICAgICAgIHJldHVybiBmaXhlZEV4cFVuc2FmZShfeCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgZml4ZWRFeHAgCiAgICAgICAgQ2FsY3VsYXRlcyBlXnggYWNjb3JkaW5nIHRvIG1hY2xhdXJlbiBzdW1tYXRpb246CgogICAgICAgIGVeeCA9IDEreCt4XjIvMiEuLi4reF5uL24hCgogICAgICAgIGFuZCByZXR1cm5zIGVeKHg+PjMyKSA8PCAzMiwgdGhhdCBpcywgdXBzaGlmdGVkIGZvciBhY2N1cmFjeQoKICAgICAgICBJbnB1dCByYW5nZToKICAgICAgICAgICAgLSBGdW5jdGlvbiBvayBhdCAgICA8PSAyNDIzMjk5NTg5NTMgCiAgICAgICAgICAgIC0gRnVuY3Rpb24gZmFpbHMgYXQgPj0gMjQyMzI5OTU4OTU0CgogICAgICAgIFRoaXMgbWV0aG9kIGlzIGlzIHZpc2libGUgZm9yIHRlc3RjYXNlcywgYnV0IG5vdCBtZWFudCBmb3IgZGlyZWN0IHVzZS4gCiAKICAgICAgICBUaGUgdmFsdWVzIGluIHRoaXMgbWV0aG9kIGJlZW4gZ2VuZXJhdGVkIHZpYSB0aGUgZm9sbG93aW5nIHB5dGhvbiBzbmlwcGV0OiAKCiAgICAgICAgZGVmIGNhbGN1bGF0ZUZhY3RvcmlhbHMoKToKICAgICAgICAgICAg4oCc4oCdIk1ldGhvZCB0byBwcmludCBvdXQgdGhlIGZhY3RvcmlhbHMgZm9yIGZpeGVkRXhw4oCd4oCc4oCdCgogICAgICAgICAgICBuaSA9IFtdCiAgICAgICAgICAgIG5pLmFwcGVuZCggMjk1MjMyNzk5MDM5NjA0MTQwODQ3NjE4NjA5NjQzNTIwMDAwMDAwKSAjIDM0IQogICAgICAgICAgICBJVEVSQVRJT05TID0gMzQKICAgICAgICAgICAgZm9yIG4gaW4gcmFuZ2UoIDEsICBJVEVSQVRJT05TLDEgKSA6CiAgICAgICAgICAgICAgICBuaS5hcHBlbmQobWF0aC5mbG9vcihuaVtuIC0gMV0gLyBuKSkKICAgICAgICAgICAgcHJpbnQoIOKAnFxuICAgICAgICDigJwuam9pbihb4oCceGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OO1xuICAgICAgICByZXMgKz0geGkgKiAlczvigJ0gJSBoZXgoaW50KHgpKSBmb3IgeCBpbiBuaV0pKQoKICAgICovCiAgICBmdW5jdGlvbiBmaXhlZEV4cFVuc2FmZSh1aW50MjU2IF94KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAKICAgICAgICB1aW50MjU2IHhpID0gRklYRURfT05FOwogICAgICAgIHVpbnQyNTYgcmVzID0gMHhkZTFiYzRkMTllZmNhYzgyNDQ1ZGE3NWIwMDAwMDAwMCAqIHhpOwoKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBQUkVDSVNJT047CiAgICAgICAgcmVzICs9IHhpICogMHhkZTFiYzRkMTllZmNiMDAwMDAwMDAwMDAwMDAwMDAwMDsKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBQUkVDSVNJT047CiAgICAgICAgcmVzICs9IHhpICogMHg2ZjBkZTI2OGNmN2U1ODAwMDAwMDAwMDAwMDAwMDAwMDsKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBQUkVDSVNJT047CiAgICAgICAgcmVzICs9IHhpICogMHgyNTA0YTBjZDlhN2Y3MjAwMDAwMDAwMDAwMDAwMDAwMDsKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBQUkVDSVNJT047CiAgICAgICAgcmVzICs9IHhpICogMHg5NDEyODMzNjY5ZmRjODAwMDAwMDAwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDFkOWQ0ZDcxNDg2NWY1MDAwMDAwMDAwMDAwMDAwMDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4NGVmOGNlODM2YmJhOGMwMDAwMDAwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweGI0ODFkODA3ZDFhYTY4MDAwMDAwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDE2OTAzYjAwZmEzNTRkMDAwMDAwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDI4MWNkYWFjNjc3YjM0MDAwMDAwMDAwMDAwMDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4NDAyZTJhYWQ3MjVlYjgwMDAwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDVkNWE2YzlmMzFmZTI0MDAwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDdjNzg5MGQ0NDJhODMwMDAwMDAwMDAwMDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4OTkzMWVkNTQwMzQ1MjgwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweGFmMTQ3Y2YyNGNlMTUwMDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweGJhYzA4NTQ2Yjg2N2QwMDAwMDAwMDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4YmFjMDg1NDZiODY3ZDAwMDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweGFmYzQ0MTMzODA2MWI4MDAwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDljM2NhYmJjMDA1NmUwMDAwMDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4ODM5MTY4MzI4NzA1YzgwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDY5NDEyMDI4NmMwNGEwMDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDUwMzE5ZTk4YjNkMmM0MDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4M2E1MmExZTM2YjgyMDIwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDI4OTI4NmUwZmNlMDAyOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDFiMGM1OWViNTM0MDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4MTE0Zjk1YjU1NDAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweGFhNzIxMGQyMDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4NjUwMTM5NjAwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDM5Yjc4ZTgwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDFmZDgwODA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4MTBmYmMwOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDhjNDA7CiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gUFJFQ0lTSU9OOwogICAgICAgIHJlcyArPSB4aSAqIDB4NDYyOwogICAgICAgIHhpID0gKHhpICogX3gpID4+IFBSRUNJU0lPTjsKICAgICAgICByZXMgKz0geGkgKiAweDIyOwoKICAgICAgICByZXR1cm4gcmVzIC8gMHhkZTFiYzRkMTllZmNhYzgyNDQ1ZGE3NWIwMDAwMDAwMDsKICAgIH0gIAp9Cgpjb250cmFjdCBXb2xrRXhjaGFuZ2UgaXMgV29sa1Byb3RvY29sLCBCYW5jb3JGb3JtdWxhIHsKCiAgICB1aW50MjU2IHB1YmxpYyBtYXhQZXJFeGNoYW5nZUJQID0gNTA7CgogICAgLy8gQHBhcmFtICBfbWF4UGVyRXhjaGFuZ2UKICAgIC8vIEByZXR1cm4gc3VjY2VzcwogICAgLy8gQGRldiBTZXQgbWF4IHNlbGwgdG9rZW4gYW1vdW50IHBlciB0cmFuc2FjdGlvbiAtLSBvbmx5IFdvbGsgRm91bmRhdGlvbiBjYW4gc2V0IHRoaXMKICAgIGZ1bmN0aW9uIHNldE1heFBlckV4Y2hhbmdlKHVpbnQyNTYgX21heFBlckV4Y2hhbmdlKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSggKF9tYXhQZXJFeGNoYW5nZSA+PSAxMCkgJiYgKF9tYXhQZXJFeGNoYW5nZSA8PSAxMDApICk7CiAgICAgICAgbWF4UGVyRXhjaGFuZ2VCUCA9IF9tYXhQZXJFeGNoYW5nZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAcmV0dXJuIEVzdGltYXRlZCBMaXF1aWRhdGlvbiBDYXAKICAgIC8vIEBkZXYgTGlxdWlkYXRpb24gQ2FwIHBlciB0cmFuc2FjdGlvbiBpcyB1c2VkIHRvIGVuc3VyZSBwcm9wZXIgcHJpY2UgZGlzY292ZXJ5IGZvciBXb2xrIEV4Y2hhbmdlIAogICAgZnVuY3Rpb24gRXN0TGlxdWlkYXRpb25DYXAoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChzYWxlQ29tcGxldGVkKXsKICAgICAgICAgICAgdmFyIGxpcXVpZGF0aW9uTWF4ICA9IHNhZmVEaXYoc2FmZU11bCh0b3RhbFRva2VucywgbWF4UGVyRXhjaGFuZ2VCUCksIDEwMDAwKTsKICAgICAgICAgICAgaWYgKGxpcXVpZGF0aW9uTWF4IDwgMTAwICogMTAqKmRlY2ltYWxzKXsgCiAgICAgICAgICAgICAgICBsaXF1aWRhdGlvbk1heCA9IDEwMCAqIDEwKipkZWNpbWFsczsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbGlxdWlkYXRpb25NYXg7ICAgCiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBAcGFyYW0gX3dvbGtBbW91bnQKICAgIC8vIEByZXR1cm4gZXRoUmVjZWl2YWJsZQogICAgLy8gQGRldiBzZW5kIFdvbGsgaW50byBjb250cmFjdCBpbiBleGNoYW5nZSBmb3IgZXRoLCBhdCBhbiBleGNoYW5nZSByYXRlIGJhc2VkIG9uIHRoZSBCYW5jb3IgUHJvdG9jb2wgZGVyaXZhdGlvbiBhbmQgZGVjcmVhc2UgdG90YWxTdXBwbHkgYWNjb3JkaW5nbHkKICAgIGZ1bmN0aW9uIHNlbGxXb2xrKHVpbnQyNTYgX3dvbGtBbW91bnQpIGlzVHJhbnNmZXJhYmxlKCkgZXh0ZXJuYWwgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBzZWxsQ2FwID0gRXN0TGlxdWlkYXRpb25DYXAoKTsKICAgICAgICB1aW50MjU2IGV0aFJlY2VpdmFibGUgPSBjYWxjdWxhdGVTYWxlUmV0dXJuKHRvdGFsVG9rZW5zLCByZXNlcnZlQmFsYW5jZSwgcGVyY2VudGFnZUVUSFJlc2VydmUsIF93b2xrQW1vdW50KTsKICAgICAgICByZXF1aXJlKCAoc2VsbENhcCA+PSBfd29sa0Ftb3VudCkgJiYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF93b2xrQW1vdW50KSAmJiAodGhpcy5iYWxhbmNlID4gZXRoUmVjZWl2YWJsZSkgKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF93b2xrQW1vdW50KTsKICAgICAgICB0b3RhbFRva2VucyA9IHNhZmVTdWIodG90YWxUb2tlbnMsIF93b2xrQW1vdW50KTsKICAgICAgICByZXNlcnZlQmFsYW5jZSA9IHNhZmVTdWIodGhpcy5iYWxhbmNlLCBldGhSZWNlaXZhYmxlKTsKICAgICAgICBXb2xrRGVzdHJveWVkKG1zZy5zZW5kZXIsIF93b2xrQW1vdW50KTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV0aFJlY2VpdmFibGUpOwogICAgICAgIHJldHVybiBldGhSZWNlaXZhYmxlOyAgICAgCiAgICB9CgogICAgLy8gQHJldHVybiB3b2xrUmVjZWl2YWJsZSAgICAKICAgIC8vIEBkZXYgc2VuZCBldGggaW50byBjb250cmFjdCBpbiBleGNoYW5nZSBmb3IgV29sayB0b2tlbnMsIGF0IGFuIGV4Y2hhbmdlIHJhdGUgYmFzZWQgb24gdGhlIEJhbmNvciBQcm90b2NvbCBkZXJpdmF0aW9uIGFuZCBpbmNyZWFzZSB0b3RhbFN1cHBseSBhY2NvcmRpbmdseQogICAgZnVuY3Rpb24gcHVyY2hhc2VXb2xrKCkgaXNUcmFuc2ZlcmFibGUoKSBwYXlhYmxlIGV4dGVybmFsIHJldHVybnModWludDI1Nil7CiAgICAgICAgdWludDI1NiB3b2xrUmVjZWl2YWJsZSA9IGNhbGN1bGF0ZVB1cmNoYXNlUmV0dXJuKHRvdGFsVG9rZW5zLCByZXNlcnZlQmFsYW5jZSwgcGVyY2VudGFnZUVUSFJlc2VydmUsIG1zZy52YWx1ZSk7CiAgICAgICAgdG90YWxUb2tlbnMgPSBzYWZlQWRkKHRvdGFsVG9rZW5zLCB3b2xrUmVjZWl2YWJsZSk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCB3b2xrUmVjZWl2YWJsZSk7CiAgICAgICAgcmVzZXJ2ZUJhbGFuY2UgPSBzYWZlQWRkKHJlc2VydmVCYWxhbmNlLCBtc2cudmFsdWUpOwogICAgICAgIFdvbGtDcmVhdGVkKG1zZy5zZW5kZXIsIHdvbGtSZWNlaXZhYmxlKTsKICAgICAgICByZXR1cm4gd29sa1JlY2VpdmFibGU7CiAgICB9CgogICAgLy8gQHBhcmFtIF9leGFjdFdvbGsKICAgIC8vIEByZXR1cm4gZXRoUmVmdW5kYWJsZQogICAgLy8gQGRldiBzZW5kIGV0aCBpbnRvIGNvbnRyYWN0IGluIGV4Y2hhbmdlIGZvciBleGFjdCBhbW91bnQgb2YgV29sayB0b2tlbnMgd2l0aCBtYXJnaW4gb2YgZXJyb3Igb2Ygbm8gbW9yZSB0aGFuIDEgV29say4gCiAgICAvLyBAbm90ZSBQdXJjaGFzZSB3aXRoIHRoZSBpbnN1ZmZpY2llbnQgZXRoIHdpbGwgYmUgY2FuY2VsbGVkIGFuZCByZXR1cm5lZDsgZXhjZWVkaW5nIGV0aCBiYWxhbmFuY2UgZnJvbSBwdXJjaGFzZSwgaWYgYW55LCB3aWxsIGJlIHJldHVybmVkLiAgICAgCiAgICBmdW5jdGlvbiBwdXJjaGFzZUV4YWN0V29sayh1aW50MjU2IF9leGFjdFdvbGspIGlzVHJhbnNmZXJhYmxlKCkgcGF5YWJsZSBleHRlcm5hbCByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHVpbnQyNTYgd29sa1JlY2VpdmFibGUgPSBjYWxjdWxhdGVQdXJjaGFzZVJldHVybih0b3RhbFRva2VucywgcmVzZXJ2ZUJhbGFuY2UsIHBlcmNlbnRhZ2VFVEhSZXNlcnZlLCBtc2cudmFsdWUpOwogICAgICAgIGlmICh3b2xrUmVjZWl2YWJsZSA8IF9leGFjdFdvbGspewogICAgICAgICAgICAvLyBDYW5jZWwgSW5zdWZmaWNpZW50IFB1cmNoYXNlCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICByZXR1cm4gbXNnLnZhbHVlOwogICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgdmFyIHdvbGtEaWZmID0gc2FmZVN1Yih3b2xrUmVjZWl2YWJsZSwgX2V4YWN0V29sayk7CiAgICAgICAgICAgIHVpbnQyNTYgZXRoUmVmdW5kYWJsZSA9IDA7CiAgICAgICAgICAgIC8vIFJlZnVuZCBpZiB3b2xrRGlmZiBleGNlZWRzIDEgV29sawogICAgICAgICAgICBpZiAod29sa0RpZmYgPCAxMCoqZGVjaW1hbHMpewogICAgICAgICAgICAgICAgLy8gQ3JlZGl0IEJ1eWVyIEZ1bGwgYW1vdW50IGlmIHdpdGhpbiBtYXJnaW4gb2YgZXJyb3IKICAgICAgICAgICAgICAgIHRvdGFsVG9rZW5zID0gc2FmZUFkZCh0b3RhbFRva2Vucywgd29sa1JlY2VpdmFibGUpOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCB3b2xrUmVjZWl2YWJsZSk7CiAgICAgICAgICAgICAgICByZXNlcnZlQmFsYW5jZSA9IHNhZmVBZGQocmVzZXJ2ZUJhbGFuY2UsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICBXb2xrQ3JlYXRlZChtc2cuc2VuZGVyLCB3b2xrUmVjZWl2YWJsZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsgICAgIAogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIGV0aFJlZnVuZGFibGUgPSBjYWxjdWxhdGVTYWxlUmV0dXJuKCBzYWZlQWRkKHRvdGFsVG9rZW5zLCB3b2xrUmVjZWl2YWJsZSkgLCBzYWZlQWRkKHJlc2VydmVCYWxhbmNlLCBtc2cudmFsdWUpLCBwZXJjZW50YWdlRVRIUmVzZXJ2ZSwgd29sa0RpZmYpOwogICAgICAgICAgICAgICAgdG90YWxUb2tlbnMgPSBzYWZlQWRkKHRvdGFsVG9rZW5zLCBfZXhhY3RXb2xrKTsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZUFkZChiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX2V4YWN0V29sayk7CiAgICAgICAgICAgICAgICByZXNlcnZlQmFsYW5jZSA9IHNhZmVBZGQocmVzZXJ2ZUJhbGFuY2UsIHNhZmVTdWIobXNnLnZhbHVlLCBldGhSZWZ1bmRhYmxlKSk7CiAgICAgICAgICAgICAgICBXb2xrQ3JlYXRlZChtc2cuc2VuZGVyLCBfZXhhY3RXb2xrKTsKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoUmVmdW5kYWJsZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXRoUmVmdW5kYWJsZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ=='.
	

]
