Class {
	#name : #SRTded97837303f375c7568f55360bd3b951b8195ab,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTded97837303f375c7568f55360bd3b951b8195ab >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8qCiAqIFRva2VuIC0gaXMgYSBzbWFydCBjb250cmFjdCBpbnRlcmZhY2UgCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiAKICogYSB0b2tlbi4KICoKICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBUb2tlbkludGVyZmFjZSB7CgogICAgICAgIAogICAgLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludCB0b3RhbFN1cHBseVZhcjsKCiAgICAKICAgIC8qKgogICAgICoKICAgICAqIGJhbGFuY2VPZigpIC0gY29uc3RhbnQgZnVuY3Rpb24gY2hlY2sgY29uY3JldGUgdG9rZW5zIGJhbGFuY2UgIAogICAgICoKICAgICAqICBAcGFyYW0gb3duZXIgLSBhY2NvdW50IG93bmVyCiAgICAgKiAgCiAgICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZSAKICAgICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKgogICAgICogYXBwcm92ZSgpIC0gZnVuY3Rpb24gYXBwcm92ZXMgdG8gYSBwZXJzb24gdG8gc3BlbmQgc29tZSB0b2tlbnMgZnJvbSAKICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiAKICAgICAqCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLgogICAgICogCiAgICAgKiAgQHJldHVybiB0cnVlIGluIGNhc2Ugb2Ygc3VjY2VzLCBvdGhlcndpc2UgZmFpbHVyZQogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICoKICAgICAqIGFsbG93YW5jZSgpIC0gY29uc3RhbnQgZnVuY3Rpb24gdG8gY2hlY2sgaG93IG11Y2ggaXMgCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQogICAgICoKICAgICAqICBAcGFyYW0gb3duZXIgICAtIG93bmVyIG9mIHRoZSBiYWxhbmNlCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIAogICAgICogIAogICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsgICAgCiAgICB9CgogICAgLy8gZXZlbnRzIG5vdGlmaWNhdGlvbnMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjI7CgovKgogKiBTdGFuZGFyZFRva2VuIC0gaXMgYSBzbWFydCBjb250cmFjdCAgCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiAKICogYSB0b2tlbi4KICoKICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiAKICogICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuSW50ZXJmYWNlIHsKCgogICAgLy8gdG9rZW4gb3duZXJzaGlwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIC8vIHNwZW5kaW5nIHBlcm1pc2lvbiBtYW5hZ2VtZW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBTdGFuZGFyZFRva2VuKCl7CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiB0cmFuc2ZlcigpIC0gdHJhbnNmZXIgdG9rZW5zIGZyb20gbXNnLnNlbmRlciBiYWxhbmNlIAogICAgICogICAgICAgICAgICAgIHRvIHJlcXVlc3RlZCBhY2NvdW50CiAgICAgKgogICAgICogIEBwYXJhbSB0byAgICAtIHRhcmdldCBhZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VucwogICAgICogIEBwYXJhbSB2YWx1ZSAtIGFtbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKgogICAgICogIEByZXR1cm4gLSBzdWNjZXNzIC8gZmFpbHVyZSBvZiB0aGUgdHJhbnNhY3Rpb24KICAgICAqLyAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIAogICAgICAgIAogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSB2YWx1ZSAmJiB2YWx1ZSA+IDApIHsKCiAgICAgICAgICAgIC8vIGRvIGFjdHVhbCB0b2tlbnMgdHJhbnNmZXIgICAgICAgCiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IHZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1t0b10gICAgICAgICArPSB2YWx1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJpc2UgdGhlIFRyYW5zZmVyIGV2ZW50CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7IAogICAgICAgIH0KICAgIH0KICAgIAogICAgCgogICAgCiAgICAvKioKICAgICAqIHRyYW5zZmVyRnJvbSgpIC0gdXNlZCB0byBtb3ZlIGFsbG93ZWQgZnVuZHMgZnJvbSBvdGhlciBvd25lcgogICAgICogICAgICAgICAgICAgICAgICBhY2NvdW50IAogICAgICoKICAgICAqICBAcGFyYW0gZnJvbSAgLSBtb3ZlIGZ1bmRzIGZyb20gYWNjb3VudAogICAgICogIEBwYXJhbSB0byAgICAtIG1vdmUgZnVuZHMgdG8gYWNjb3VudAogICAgICogIEBwYXJhbSB2YWx1ZSAtIG1vdmUgdGhlIHZhbHVlIAogICAgICoKICAgICAqICBAcmV0dXJuIC0gcmV0dXJuIHRydWUgb24gc3VjY2VzcyBmYWxzZSBvdGhlcndpc2UgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgCiAgICAgICAgaWYgKCBiYWxhbmNlc1tmcm9tXSA+PSB2YWx1ZSAmJiAKICAgICAgICAgICAgIGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gPj0gdmFsdWUgJiYgCiAgICAgICAgICAgICB2YWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgLy8gZG8gdGhlIGFjdHVhbCB0cmFuc2ZlcgogICAgICAgICAgICBiYWxhbmNlc1tmcm9tXSAtPSB2YWx1ZTsgICAgCiAgICAgICAgICAgIGJhbGFuY2VzW3RvXSAgICs9IHZhbHVlOyAgICAgICAgICAgIAogICAgICAgICAgICAKCiAgICAgICAgICAgIC8vIGFkZGp1c3QgdGhlIHBlcm1pc2lvbiwgYWZ0ZXIgcGFydCBvZiAKICAgICAgICAgICAgLy8gcGVybWl0ZWQgdG8gc3BlbmQgdmFsdWUgd2FzIHVzZWQKICAgICAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSAtPSB2YWx1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJpc2UgdGhlIFRyYW5zZmVyIGV2ZW50CiAgICAgICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAKICAgICAgICB9CiAgICB9CgogICAgCgogICAgCiAgICAvKioKICAgICAqCiAgICAgKiBiYWxhbmNlT2YoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIGNoZWNrIGNvbmNyZXRlIHRva2VucyBiYWxhbmNlICAKICAgICAqCiAgICAgKiAgQHBhcmFtIG93bmVyIC0gYWNjb3VudCBvd25lcgogICAgICogIAogICAgICogIEByZXR1cm4gdGhlIHZhbHVlIG9mIGJhbGFuY2UgCiAgICAgKi8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBvd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW293bmVyXTsKICAgIH0KCiAgICAKICAgIAogICAgLyoqCiAgICAgKgogICAgICogYXBwcm92ZSgpIC0gZnVuY3Rpb24gYXBwcm92ZXMgdG8gYSBwZXJzb24gdG8gc3BlbmQgc29tZSB0b2tlbnMgZnJvbSAKICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiAKICAgICAqCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLgogICAgICogCiAgICAgKiAgQHJldHVybiB0cnVlIGluIGNhc2Ugb2Ygc3VjY2VzLCBvdGhlcndpc2UgZmFpbHVyZQogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBub3cgc3BlbmRlciBjYW4gdXNlIGJhbGFuY2UgaW4gCiAgICAgICAgLy8gYW1tb3VudCBvZiB2YWx1ZSBmcm9tIG93bmVyIGJhbGFuY2UKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdmFsdWU7CiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudCBhYm91dCB0aGUgdHJhbnNhY3Rpb24KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKCiAgICAvKioKICAgICAqCiAgICAgKiBhbGxvd2FuY2UoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIHRvIGNoZWNrIGhvdyBtb3VjaCBpcyAKICAgICAqICAgICAgICAgICAgICAgcGVybWl0ZWQgdG8gc3BlbmQgdG8gM3JkIHBlcnNvbiBmcm9tIG93bmVyIGJhbGFuY2UKICAgICAqCiAgICAgKiAgQHBhcmFtIG93bmVyICAgLSBvd25lciBvZiB0aGUgYmFsYW5jZQogICAgICogIEBwYXJhbSBzcGVuZGVyIC0gcGVybWl0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIAogICAgICogIAogICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbb3duZXJdW3NwZW5kZXJdOwogICAgfQoKfQoKCnByYWdtYSBzb2xpZGl0eSBeMC40LjY7CgovKioKICogCiAqIEV2ZW50SW5mbyAtIGltdXRhYmxlIGNsYXNzIHRoYXQgZGVub3RlcwogKiB0aGUgdGltZSBvZiB0aGUgdmlydHVhbCBhY2NlbGVyYXRvciBoYWNrCiAqIGV2ZW50CiAqIAogKi8KY29udHJhY3QgRXZlbnRJbmZvewogICAgCiAgICAKICAgIHVpbnQgY29uc3RhbnQgSEFDS0FUSE9OXzVfV0VFS1MgPSA2MCAqIDYwICogMjQgKiA3ICogNTsKICAgIHVpbnQgY29uc3RhbnQgVF8xX1dFRUsgPSA2MCAqIDYwICogMjQgKiA3OwoKICAgIHVpbnQgZXZlbnRTdGFydCA9IDE0NzkzOTEyMDA7IC8vIFRodSwgMTcgTm92IDIwMTYgMTQ6MDA6MDAgR01UCiAgICB1aW50IGV2ZW50RW5kID0gZXZlbnRTdGFydCArIEhBQ0tBVEhPTl81X1dFRUtTOwogICAgCiAgICAKICAgIC8qKgogICAgICogZ2V0RXZlbnRTdGFydCAtIHJldHVybiB0aGUgc3RhcnQgb2YgdGhlIGV2ZW50IHRpbWUKICAgICAqLyAKICAgIGZ1bmN0aW9uIGdldEV2ZW50U3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICAKICAgICAgIHJldHVybiBldmVudFN0YXJ0OwogICAgfSAKICAgIAogICAgLyoqCiAgICAgKiBnZXRFdmVudEVuZCAtIHJldHVybiB0aGUgZW5kIG9mIHRoZSBldmVudCB0aW1lCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRFdmVudEVuZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsgICAgICAgIAogICAgICAgcmV0dXJuIGV2ZW50RW5kOwogICAgfSAKICAgIAogICAgCiAgICAvKioKICAgICAqIGdldFZvdGluZ1N0YXJ0IC0gdGhlIHZvdGluZyBzdGFydHMgMSB3ZWVrIGFmdGVyIHRoZSAKICAgICAqICAgICAgICAgICAgICAgICAgZXZlbnQgc3RhcnRzCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRWb3RpbmdTdGFydCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXZlbnRTdGFydCsgVF8xX1dFRUs7CiAgICB9CgogICAgLyoqCiAgICAgKiBnZXRUcmFkaW5nU3RhcnQgLSB0aGUgRFNUIHRva2VucyB0cmFkaW5nIHN0YXJ0cyAxIHdlZWsgCiAgICAgKiAgICAgICAgICAgICAgICAgICBhZnRlciB0aGUgZXZlbnQgc3RhcnRzCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRUcmFkaW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGV2ZW50U3RhcnQrIFRfMV9XRUVLOwogICAgfQoKICAgIC8qKgogICAgICogZ2V0Tm93IC0gaGVscGVyIGNsYXNzIHRvIGNoZWNrIHdoYXQgdGltZSB0aGUgY29udHJhY3Qgc2VlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5vdygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsgICAgICAgIAogICAgICAgcmV0dXJuIG5vdzsKICAgIH0gCiAgICAKfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8qKgogKgogKiBAdGl0bGUgSGFja2VyIEdvbGQKICogCiAqIFRoZSBvZmZpY2lhbCB0b2tlbiBwb3dlcmluZyB0aGUgaGFjay5ldGhlci5jYW1wIHZpcnR1YWwgYWNjZWxlcmF0b3IuCiAqIFRoaXMgaXMgdGhlIG9ubHkgd2F5IHRvIGFjcXVpcmUgdG9rZW5zIGZyb20gc3RhcnR1cHMgZHVyaW5nIHRoZSBldmVudC4KICoKICogV2hpdGVwYXBlciBodHRwczovL2hhY2suZXRoZXIuY2FtcC93aGl0ZXBhcGVyCiAqCiAqLwpjb250cmFjdCBIYWNrZXJHb2xkIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8vIE5hbWUgb2YgdGhlIHRva2VuICAgIAogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkhhY2tlckdvbGQiOwoKICAgIC8vIERlY2ltYWwgcGxhY2VzCiAgICB1aW50OCAgcHVibGljIGRlY2ltYWxzID0gMzsKICAgIC8vIFRva2VuIGFiYnJldmlhdGlvbiAgICAgICAgCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJIS0ciOwogICAgCiAgICAvLyAxIGV0aGVyID0gMjAwIGhrZwogICAgdWludCBCQVNFX1BSSUNFID0gMjAwOwogICAgLy8gMSBldGhlciA9IDE1MCBoa2cKICAgIHVpbnQgTUlEX1BSSUNFID0gMTUwOwogICAgLy8gMSBldGhlciA9IDEwMCBoa2cKICAgIHVpbnQgRklOX1BSSUNFID0gMTAwOwogICAgLy8gU2FmZXR5IGNhcAogICAgdWludCBTQUZFVFlfTElNSVQgPSA0MDAwMDAwIGV0aGVyOwogICAgLy8gWmVyb3MgYWZ0ZXIgdGhlIHBvaW50CiAgICB1aW50IERFQ0lNQUxfWkVST1MgPSAxMDAwOwogICAgCiAgICAvLyBUb3RhbCB2YWx1ZSBpbiB3ZWkKICAgIHVpbnQgdG90YWxWYWx1ZTsKICAgIAogICAgLy8gQWRkcmVzcyBvZiBtdWx0aXNpZyB3YWxsZXQgaG9sZGluZyBldGhlciBmcm9tIHNhbGUKICAgIGFkZHJlc3Mgd2FsbGV0OwoKICAgIC8vIFN0cnVjdHVyZSBvZiBzYWxlIGluY3JlYXNlIG1pbGVzdG9uZXMKICAgIHN0cnVjdCBtaWxlc3RvbmVzX3N0cnVjdCB7CiAgICAgIHVpbnQgcDE7CiAgICAgIHVpbnQgcDI7IAogICAgICB1aW50IHAzOwogICAgICB1aW50IHA0OwogICAgICB1aW50IHA1OwogICAgICB1aW50IHA2OwogICAgfQogICAgLy8gTWlsZXN0b25lcyBpbnN0YW5jZQogICAgbWlsZXN0b25lc19zdHJ1Y3QgbWlsZXN0b25lczsKICAgIAogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBvZiB0aGUgY29udHJhY3QuCiAgICAgKiAKICAgICAqIFBhc3NlcyBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGhvbGRpbmcgdGhlIHZhbHVlLgogICAgICogSGFja2VyR29sZCBjb250cmFjdCBpdHNlbGYgZG9lcyBub3QgaG9sZCBhbnkgdmFsdWUKICAgICAqIAogICAgICogQHBhcmFtIG11bHRpc2lnIGFkZHJlc3Mgb2YgTXVsdGlTaWcgd2FsbGV0IHdoaWNoIHdpbGwgaG9sZCB0aGUgdmFsdWUKICAgICAqLwogICAgZnVuY3Rpb24gSGFja2VyR29sZChhZGRyZXNzIG11bHRpc2lnKSB7CiAgICAgICAgCiAgICAgICAgd2FsbGV0ID0gbXVsdGlzaWc7CgogICAgICAgIC8vIHNldCB0aW1lIHBlcmlvZHMgZm9yIHNhbGUKICAgICAgICBtaWxlc3RvbmVzID0gbWlsZXN0b25lc19zdHJ1Y3QoCiAgICAgICAgCiAgICAgICAgICAxNDc2OTcyMDAwLCAgLy8gUDE6IEdNVDogMjAtT2N0LTIwMTYgMTQ6MDAgID0+IFRoZSBTYWxlIFN0YXJ0cwogICAgICAgICAgMTQ3ODE4MTYwMCwgIC8vIFAyOiBHTVQ6IDAzLU5vdi0yMDE2IDE0OjAwICA9PiAxc3QgUHJpY2UgTGFkZGVyIAogICAgICAgICAgMTQ3OTM5MTIwMCwgIC8vIFAzOiBHTVQ6IDE3LU5vdi0yMDE2IDE0OjAwICA9PiBQcmljZSBTdGFibGUsIAogICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYWNrYXRob24gU3RhcnRzCiAgICAgICAgICAxNDgwNjAwODAwLCAgLy8gUDQ6IEdNVDogMDEtRGVjLTIwMTYgMTQ6MDAgID0+IDJuZCBQcmljZSBMYWRkZXIKICAgICAgICAgIDE0ODE4MTA0MDAsICAvLyBQNTogR01UOiAxNS1EZWMtMjAxNiAxNDowMCAgPT4gUHJpY2UgU3RhYmxlCiAgICAgICAgICAxNDgyNDE1MjAwICAgLy8gUDY6IEdNVDogMjItRGVjLTIwMTYgMTQ6MDAgID0+IFNhbGUgRW5kcywgSGFja2F0aG9uIEVuZHMKICAgICAgICApOwogICAgICAgIAogICAgICAgIC8vIGFzc2lnbiByZWNvdmVyeSBiYWxhbmNlCiAgICAgICAgdG90YWxTdXBwbHlWYXIgICA9IDE2MTEwODkzMDAwOwogICAgICAgIGJhbGFuY2VzWzB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2N10gPSAxNjExMDg5MzAwMDsKICAgICAgICB0b3RhbFZhbHVlICAgID0gODUzNjIgZXRoZXI7ICAgICAgICAKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIEZhbGxiYWNrIGZ1bmN0aW9uOiBjYWxsZWQgb24gZXRoZXIgc2VudC4KICAgICAqIAogICAgICogSXQgY2FsbHMgdG8gY3JlYXRlSEtHIGZ1bmN0aW9uIHdpdGggbXNnLnNlbmRlciAKICAgICAqIGFzIGEgdmFsdWUgZm9yIGhvbGRlciBhcmd1bWVudAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBjcmVhdGVIS0cobXNnLnNlbmRlcik7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlcyBIS0cgdG9rZW5zLgogICAgICogCiAgICAgKiBSdW5zIHNhbml0eSBjaGVja3MgaW5jbHVkaW5nIHNhZmV0eSBjYXAKICAgICAqIFRoZW4gY2FsY3VsYXRlcyBjdXJyZW50IHByaWNlIGJ5IGdldFByaWNlKCkgZnVuY3Rpb24sIGNyZWF0ZXMgSEtHIHRva2VucwogICAgICogRmluYWxseSBzZW5kcyBhIHZhbHVlIG9mIHRyYW5zYWN0aW9uIHRvIHRoZSB3YWxsZXQKICAgICAqIAogICAgICogTm90ZTogZHVlIHRvIGxhY2sgb2YgZmxvYXRpbmcgcG9pbnQgdHlwZXMgaW4gU29saWRpdHksCiAgICAgKiBjb250cmFjdCBhc3N1bWVzIHRoYXQgbGFzdCAzIGRpZ2l0cyBpbiB0b2tlbnMgYW1vdW50IGFyZSBzdG9vZCBhZnRlciB0aGUgcG9pbnQuCiAgICAgKiBJdCBtZWFucyB0aGF0IGlmIHN0b3JlZCBIS0cgYmFsYW5jZSBpcyAxMDAwMDAsIHRoZW4gaXRzIHJlYWwgdmFsdWUgaXMgMTAwIEhLRwogICAgICogCiAgICAgKiBAcGFyYW0gaG9sZGVyIHRva2VuIGhvbGRlcgogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVIS0coYWRkcmVzcyBob2xkZXIpIHBheWFibGUgewogICAgICAgIAogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmVzLnAxKSB0aHJvdzsKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDYpIHRocm93OwogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICAKICAgICAgICAvLyBzYWZldHkgY2FwCiAgICAgICAgaWYgKGdldFRvdGFsVmFsdWUoKSArIG1zZy52YWx1ZSA+IFNBRkVUWV9MSU1JVCkgdGhyb3c7IAogICAgCiAgICAgICAgdWludCB0b2tlbnMgPSBtc2cudmFsdWUgKiBnZXRQcmljZSgpICogREVDSU1BTF9aRVJPUyAvIDEgZXRoZXI7CgogICAgICAgIHRvdGFsU3VwcGx5VmFyICs9IHRva2VuczsKICAgICAgICBiYWxhbmNlc1tob2xkZXJdICs9IHRva2VuczsKICAgICAgICB0b3RhbFZhbHVlICs9IG1zZy52YWx1ZTsKICAgICAgICAKICAgICAgICBpZiAoIXdhbGxldC5zZW5kKG1zZy52YWx1ZSkpIHRocm93OwogICAgfQogICAgCiAgICAvKioKICAgICAqIERlbm90ZXMgY29tcGxldGUgcHJpY2Ugc3RydWN0dXJlIGR1cmluZyB0aGUgc2FsZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIEhLRyBhbW91bnQgcGVyIDEgRVRIIGZvciB0aGUgY3VycmVudCBtb21lbnQgaW4gdGltZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA8IG1pbGVzdG9uZXMucDEpIHJldHVybiAwOwogICAgICAgIAogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wMSAmJiBub3cgPCBtaWxlc3RvbmVzLnAyKSB7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBCQVNFX1BSSUNFOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDIgJiYgbm93IDwgbWlsZXN0b25lcy5wMykgewogICAgICAgICAgICAKICAgICAgICAgICAgdWludCBkYXlzX2luID0gMSArIChub3cgLSBtaWxlc3RvbmVzLnAyKSAvIDEgZGF5czsgCiAgICAgICAgICAgIHJldHVybiBCQVNFX1BSSUNFIC0gZGF5c19pbiAqIDI1IC8gNzsgIC8vIGRhaWx5IGRlY3JlYXNlIDMuNQogICAgICAgIH0KCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnAzICYmIG5vdyA8IG1pbGVzdG9uZXMucDQpIHsKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIE1JRF9QUklDRTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA0ICYmIG5vdyA8IG1pbGVzdG9uZXMucDUpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGRheXNfaW4gPSAxICsgKG5vdyAtIG1pbGVzdG9uZXMucDQpIC8gMSBkYXlzOyAKICAgICAgICAgICAgcmV0dXJuIE1JRF9QUklDRSAtIGRheXNfaW4gKiAyNSAvIDc7ICAvLyBkYWlseSBkZWNyZWFzZSAzLjUKICAgICAgICB9CgogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNSAmJiBub3cgPCBtaWxlc3RvbmVzLnA2KSB7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGSU5fUFJJQ0U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNil7CgogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRvdGFsIHN0b3JlZCBIS0cgYW1vdW50LgogICAgICogCiAgICAgKiBDb250cmFjdCBhc3N1bWVzIHRoYXQgbGFzdCAzIGRpZ2l0cyBvZiB0aGlzIHZhbHVlIGFyZSBiZWhpbmQgdGhlIGRlY2ltYWwgcGxhY2UuIGkuZS4gMTAwMDEgaXMgMTAuMDAxCiAgICAgKiBUaHVzLCByZXN1bHQgb2YgdGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgZGl2aWRlZCBieSAxMDAwIHRvIGdldCBIS0cgdmFsdWUKICAgICAqIAogICAgICogQHJldHVybiByZXN1bHQgc3RvcmVkIEhLRyBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsKICAgIH0gCgogICAgLyoqCiAgICAgKiBJdCBpcyB1c2VkIGZvciB0ZXN0IHB1cnBvc2VzLgogICAgICogCiAgICAgKiBSZXR1cm5zIHRoZSByZXN1bHQgb2YgJ25vdycgc3RhdGVtZW50IG9mIFNvbGlkaXR5IGxhbmd1YWdlCiAgICAgKiAKICAgICAqIEByZXR1cm4gdW5peCB0aW1lc3RhbXAgZm9yIGN1cnJlbnQgbW9tZW50IGluIHRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Tm93KCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0b3RhbCB2YWx1ZSBwYXNzZWQgdGhyb3VnaCB0aGUgY29udHJhY3QKICAgICAqIAogICAgICogQHJldHVybiByZXN1bHQgdG90YWwgdmFsdWUgaW4gd2VpCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvdGFsVmFsdWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIHJldHVybiB0b3RhbFZhbHVlOyAgCiAgICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjY7CgovKgogKiBEU1RDb250cmFjdCAtIERTVCBzdGFuZHMgZm9yIGRlY2VudHJhbGl6ZWQgc3RhcnR1cCB0ZWFtLgogKiAgICAgICAgICAgICAgIHRoZSBjb250cmFjdCBlbnN1cmVzIGZ1bmRpbmcgZm9yIGEgZGVjZW50cmFsaXplZAogKiAgICAgICAgICAgICAgIHRlYW0gaW4gMiBwaGFzZXM6IAogKgogKiAgICAgICAgICAgICAgICArLiBGdW5kaW5nIGJ5IEhLRyBkdXJpbmcgdGhlIGhhY2thdGhvbiBldmVudC4gCiAqICAgICAgICAgICAgICAgICsuIEZ1bmRpbmcgYnkgRXRoZXIgYWZ0ZXIgdGhlIGV2ZW50IGlzIG92ZXIuIAogKgogKiAgICAgICAgICAgICAgIEFmdGVyIHRoZSBmdW5kcyBiZWVuIGNvbGxlY3RlZCB0aGVyZSBpcyBhIGdvdmVybmVuY2UKICogICAgICAgICAgICAgICBtZWNoYW5pc20gbWFuYWdlZCBieSBwcm9wb3NpdGlvbiB0byB3aXRoZHJhdyBmdW5kcwogKiAgICAgICAgICAgICAgIGZvciBkZXZlbG9wbWVudCB1c2FnZS4gCiAqCiAqICAgICAgICAgICAgICAgVGhlIERTVCBlbnN1cmVzIHRoYXQgYmFja2VycyBvZiB0aGUgcHJvamVjdHMga2VlcHMKICogICAgICAgICAgICAgICBzb21lIGluZmx1ZW5jZSBvbiB0aGUgcHJvamVjdCBieSBhYmlsaXR5IHRvIHJlamVjdAogKiAgICAgICAgICAgICAgIHByb3Bvc2l0aW9ucyB0aGV5IGZpbmQgYXMgbm9uIGVmZmVjdGl2ZS4gCiAqCiAqICAgICAgICAgICAgICAgSW4gdmVyeSByYWRpY2FsIG9jY2FzaW9ucyB0aGUgYmFja2VycyBtYXkgbG9vc2UgCiAqICAgICAgICAgICAgICAgdGhlIHRydXN0IGluIHRoZSB0ZWFtIGNvbXBsZXRlbGx5LCBpbiB0aGF0IGNhc2UgCiAqICAgICAgICAgICAgICAgdGhlcmUgaXMgYW4gb3B0aW9uIHRvIHByb3Bvc2UgaW1wZWFjaG1lbnQgcHJvY2VzcwogKiAgICAgICAgICAgICAgIGNvbXBsZXRlbGx5IHJlbW92aW5nIHRoZSBleGVjdXRlIGFuZCBhc3NpZ25pbmcgbmV3CiAqICAgICAgICAgICAgICAgcGVyc29uIHRvIG1hbmFnZSB0aGUgZnVuZHMuIAogKgogKi8KY29udHJhY3QgRFNUQ29udHJhY3QgaXMgU3RhbmRhcmRUb2tlbnsKCiAgICAvLyBaZXJvcyBhZnRlciB0aGUgcG9pbnQKICAgIHVpbnQgREVDSU1BTF9aRVJPUyA9IDEwMDA7CiAgICAvLyBQcm9wb3NhbCBsaWZldGltZQogICAgdWludCBQUk9QT1NBTF9MSUZFVElNRSA9IDEwIGRheXM7CiAgICAvLyBQcm9wb3NhbCBmdW5kcyB0aHJlc2hvbGQsIGluIHBlcmNlbnRzCiAgICB1aW50IFBST1BPU0FMX0ZVTkRTX1RIID0gMjA7CgogICAgYWRkcmVzcyAgIGV4ZWN1dGl2ZTsgCiAgICAgICAgCiAgICBFdmVudEluZm8gZXZlbnRJbmZvOwogICAgCiAgICAvLyBJbmRpY2F0ZWQgd2hlcmUgdGhlIERTVCBpcyB0cmFkZWQKICAgIGFkZHJlc3MgdmlydHVhbEV4Y2hhbmdlQWRkcmVzczsKICAgIAogICAgSGFja2VyR29sZCBoYWNrZXJHb2xkOwogICAgICAgIAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSB2b3RpbmdSaWdodHM7CgoKICAgIC8vIDEgLSBIS0cgPT4gRFNUIHF0eTsgdG9rZW5zIGZvciAxIEhLRwogICAgdWludCBoa2dQcmljZTsKICAgIAogICAgLy8gMSAtIEV0aGVyID0+IERTVCBxdHk7IHRva2VucyBmb3IgMSBFdGhlcgogICAgdWludCBldGhlclByaWNlOwogICAgCiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiLi4uIjsgICAgICAgICAgICAgICAgICAgCiAgICB1aW50OCAgcHVibGljIGRlY2ltYWxzID0gMzsgICAgICAgICAgICAgICAgIAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiLi4uIjsKICAgIAogICAgYm9vbCBhYmxlVG9Jc3N1ZVRva2VucyA9IHRydWU7IAogICAgCiAgICB1aW50IHByZWZlcmVkUXR5U29sZDsKCiAgICB1aW50IGNvbGxlY3RlZEhLRzsgCiAgICB1aW50IGNvbGxlY3RlZEV0aGVyOyAgICAKICAgIAogICAgLy8gUHJvcG9zYWwgb2YgdGhlIGZ1bmRzIHNwZW5kaW5nCiAgICBtYXBwaW5nIChieXRlczMyID0+IFByb3Bvc2FsKSBwcm9wb3NhbHM7CgogICAgZW51bSBQcm9wb3NhbEN1cnJlbmN5IHsgSEtHLCBFVEhFUiB9CiAgICBQcm9wb3NhbEN1cnJlbmN5IGVudW1EZWNsYXJhdGlvbjsKICAgICAgICAgICAgICAgICAgCiAgICAgICAKICAgIHN0cnVjdCBQcm9wb3NhbHsKICAgICAgICAKICAgICAgICBieXRlczMyIGlkOwogICAgICAgIHVpbnQgdmFsdWU7CgogICAgICAgIHN0cmluZyB1cmxEZXRhaWxzOwoKICAgICAgICB1aW50IHZvdGluZEVuZFRTOwogICAgICAgICAgICAgICAgCiAgICAgICAgdWludCB2b3Rlc09iamVjdGluZzsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHN1Ym1pdHRlcjsKICAgICAgICBib29sIHJlZGVlbWVkOwoKICAgICAgICBQcm9wb3NhbEN1cnJlbmN5IHByb3Bvc2FsQ3VycmVuY3k7CiAgICAgICAgCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSB2b3RlZDsKICAgIH0KICAgIHVpbnQgY291bnRlclByb3Bvc2FsczsKICAgIHVpbnQgdGltZU9mTGFzdFByb3Bvc2FsOwogICAgCiAgICBQcm9wb3NhbFtdIGxpc3RQcm9wb3NhbHM7CiAgICAKCiAgICAvKioKICAgICAqIEltcGVhY2htZW50IHByb2Nlc3MgcHJvcG9zYWxzCiAgICAgKi8gICAgCiAgICBzdHJ1Y3QgSW1wZWFjaG1lbnRQcm9wb3NhbHsKICAgICAgICAKICAgICAgICBzdHJpbmcgdXJsRGV0YWlsczsKICAgICAgICAKICAgICAgICBhZGRyZXNzIG5ld0V4ZWN1dGl2ZTsKCiAgICAgICAgdWludCB2b3RpbmRFbmRUUzsgICAgICAgIAogICAgICAgIHVpbnQgdm90ZXNTdXBwb3J0aW5nOwogICAgICAgIAogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgdm90ZWQ7ICAgICAgICAKICAgIH0KICAgIEltcGVhY2htZW50UHJvcG9zYWwgbGFzdEltcGVhY2htZW50UHJvcG9zYWw7CgogICAgICAgIAogICAgLyoqCiAgICAgKiAKICAgICAqICBEU1RDb250cmFjdDogY3RvciBmb3IgRFNUIHRva2VuIGFuZCBnb3Zlcm5lbmNlIGNvbnRyYWN0CiAgICAgKgogICAgICogIEBwYXJhbSBldmVudEluZm9BZGRyIEV2ZW50SW5mbzogYWRkcmVzcyBvZiBvYmplY3QgZGVub3RlcyBldmVudHMgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWxlc3RvbmVzICAgICAgCiAgICAgKiAgQHBhcmFtIGhhY2tlckdvbGRBZGRyIEhhY2tlckdvbGQ6IGFkZHJlc3Mgb2YgSGFja2VyR29sZCB0b2tlbgogICAgICoKICAgICAqICBAcGFyYW0gZHN0TmFtZSBzdHJpbmc6IGRzdE5hbWU6IHJlYWwgbmFtZSBvZiB0aGUgdGVhbQogICAgICoKICAgICAqICBAcGFyYW0gZHN0U3ltYm9sIHN0cmluZzogMyBsZXR0ZXIgc3ltYm9sZCBvZiB0aGUgdGVhbQogICAgICoKICAgICAqLyAKICAgIGZ1bmN0aW9uIERTVENvbnRyYWN0KEV2ZW50SW5mbyBldmVudEluZm9BZGRyLCBIYWNrZXJHb2xkIGhhY2tlckdvbGRBZGRyLCBzdHJpbmcgZHN0TmFtZSwgc3RyaW5nIGRzdFN5bWJvbCl7CiAgICAKICAgICAgZXhlY3V0aXZlICAgPSBtc2cuc2VuZGVyOyAgCiAgICAgIG5hbWUgICAgICAgID0gZHN0TmFtZTsKICAgICAgc3ltYm9sICAgICAgPSBkc3RTeW1ib2w7CgogICAgICBoYWNrZXJHb2xkID0gSGFja2VyR29sZChoYWNrZXJHb2xkQWRkcik7CiAgICAgIGV2ZW50SW5mbyAgPSBFdmVudEluZm8oZXZlbnRJbmZvQWRkcik7CiAgICB9CiAgICAKCiAgICBmdW5jdGlvbigpIHBheWFibGUKICAgICAgICAgICAgICAgb25seUFmdGVyRW5kIHsKICAgICAgICAKICAgICAgICAvLyB0aGVyZSBpcyB0b2tlbnMgbGVmdCBmcm9tIGhhY2thdGhvbiAKICAgICAgICBpZiAoZXRoZXJQcmljZSA9PSAwKSB0aHJvdzsKICAgICAgICAKICAgICAgICB1aW50IHRva2VucyA9IG1zZy52YWx1ZSAqIGV0aGVyUHJpY2UgKiBERUNJTUFMX1pFUk9TIC8gKDEgZXRoZXIpOwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGlmIGRlbWFuZCBvZiB0b2tlbnMgaXMgCiAgICAgICAgLy8gb3ZlcmZsb3cgdGhlIHN1cHBseSAKICAgICAgICB1aW50IHJldEV0aGVyID0gMDsKICAgICAgICBpZiAoYmFsYW5jZXNbdGhpc10gPCB0b2tlbnMpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRva2VucyA9IGJhbGFuY2VzW3RoaXNdOwogICAgICAgICAgICByZXRFdGhlciA9IG1zZy52YWx1ZSAtIHRva2VucyAvIGV0aGVyUHJpY2UgKiAoMSBmaW5uZXkpOwogICAgICAgIAogICAgICAgICAgICAvLyByZXR1cm4gbGVmdCBldGhlciAKICAgICAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQocmV0RXRoZXIpKSB0aHJvdzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gZG8gdHJhbnNmZXIKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSB0b2tlbnM7CiAgICAgICAgYmFsYW5jZXNbdGhpc10gLT0gdG9rZW5zOwogICAgICAgIAogICAgICAgIC8vIGNvdW50IGNvbGxlY3RlZCBldGhlciAKICAgICAgICBjb2xsZWN0ZWRFdGhlciArPSBtc2cudmFsdWUgLSByZXRFdGhlcjsgCiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudAogICAgICAgIEJ1eUZvckV0aGVyVHJhbnNhY3Rpb24obXNnLnNlbmRlciwgY29sbGVjdGVkRXRoZXIsIHRvdGFsU3VwcGx5VmFyLCBldGhlclByaWNlLCB0b2tlbnMpOwogICAgICAgIAogICAgfQoKICAgIAogICAgCiAgICAvKioKICAgICAqIHNldEhLR1ByaWNlIC0gc2V0IHByaWNlOiAxSEtHID0+IERTVCB0b2tlbnMgcXR5CiAgICAgKgogICAgICogIEBwYXJhbSBxdHlGb3JPbmVIS0cgdWludDogRFNUIHRva2VucyBmb3IgMSBIS0cKICAgICAqIAogICAgICovICAgIAogICAgIGZ1bmN0aW9uIHNldEhLR1ByaWNlKHVpbnQgcXR5Rm9yT25lSEtHKSBvbmx5RXhlY3V0aXZlICB7CiAgICAgICAgIAogICAgICAgICBoa2dQcmljZSA9IHF0eUZvck9uZUhLRzsKICAgICAgICAgUHJpY2VIS0dDaGFuZ2UocXR5Rm9yT25lSEtHLCBwcmVmZXJlZFF0eVNvbGQsIHRvdGFsU3VwcGx5VmFyKTsKICAgICB9CiAgICAgCiAgICAgCiAgICAKICAgIC8qKgogICAgICogCiAgICAgKiBpc3N1ZVByZWZlcmVkVG9rZW5zIC0gcHJlZmVyZWQgdG9rZW5zIGlzc3VlZCBvbiB0aGUgaGFja2F0aG9uIGV2ZW50CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgZ3JhbnQgc3BlY2lhbCByaWdodHMKICAgICAqCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUhLRyB1aW50OiBwcmljZSBEU1QgdG9rZW5zIGZvciBvbmUgMSBIS0cKICAgICAqICBAcGFyYW0gcXR5VG9FbWl0IHVpbnQ6IG5ldyBzdXBwbHkgb2YgdG9rZW5zIAogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlUHJlZmVyZWRUb2tlbnModWludCBxdHlGb3JPbmVIS0csIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IHF0eVRvRW1pdCkgb25seUV4ZWN1dGl2ZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlJZkFibGVUb0lzc3VlVG9rZW5zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5QmVmb3JlRW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5QWZ0ZXJUcmFkaW5nU3RhcnQgewogICAgICAgICAgICAgICAgCiAgICAgICAgLy8gbm8gaXNzdWVuY2UgaXMgYWxsb3dlZCBiZWZvcmUgZW5saXN0ZWQgb24gdGhlCiAgICAgICAgLy8gZXhjaGFuZ2UgCiAgICAgICAgaWYgKHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MgPT0gMHgwKSB0aHJvdzsKICAgICAgICAgICAgCiAgICAgICAgdG90YWxTdXBwbHlWYXIgKz0gcXR5VG9FbWl0OwogICAgICAgIGJhbGFuY2VzW3RoaXNdICs9IHF0eVRvRW1pdDsKICAgICAgICBoa2dQcmljZSA9IHF0eUZvck9uZUhLRzsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBub3cgc3BlbmRlciBjYW4gdXNlIGJhbGFuY2UgaW4gCiAgICAgICAgLy8gYW1vdW50IG9mIHZhbHVlIGZyb20gb3duZXIgYmFsYW5jZQogICAgICAgIGFsbG93ZWRbdGhpc11bdmlydHVhbEV4Y2hhbmdlQWRkcmVzc10gKz0gcXR5VG9FbWl0OwogICAgICAgIAogICAgICAgIC8vIHJpc2UgZXZlbnQgYWJvdXQgdGhlIHRyYW5zYWN0aW9uCiAgICAgICAgQXBwcm92YWwodGhpcywgdmlydHVhbEV4Y2hhbmdlQWRkcmVzcywgcXR5VG9FbWl0KTsKICAgICAgICAKICAgICAgICAvLyByaXNlIGV2ZW50IAogICAgICAgIERzdFRva2Vuc0lzc3VlZChoa2dQcmljZSwgcHJlZmVyZWRRdHlTb2xkLCB0b3RhbFN1cHBseVZhciwgcXR5VG9FbWl0KTsKICAgIH0KCiAgICAKICAgIAogICAgCiAgICAvKioKICAgICAqIAogICAgICogYnV5Rm9ySGFja2VyR29sZCAtIG9uIHRoZSBoYWNrIGV2ZW50IHRoaXMgZnVuY3Rpb24gaXMgYXZhaWxhYmxlIAogICAgICogICAgICAgICAgICAgICAgICAgIHRoZSBidXllciBmb3IgaGFja2VyIGdvbGQgd2lsbCBnYWluIHZvdGVzIHRvIAogICAgICogICAgICAgICAgICAgICAgICAgIGluZmx1ZW5jZSBmdXR1cmUgcHJvcG9zYWxzIG9uIHRoZSBEU1QKICAgICAqICAgIAogICAgICogIEBwYXJhbSBoa2dWYWx1ZSAtIHF0eSBvZiB0aGlzIERTVCB0b2tlbnMgZm9yIDEgSEtHICAgICAKICAgICAqIAogICAgICovCiAgICBmdW5jdGlvbiBidXlGb3JIYWNrZXJHb2xkKHVpbnQgaGtnVmFsdWUpIG9ubHlCZWZvcmVFbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgCiAgICAgIC8vIHZhbGlkYXRlIHRoYXQgdGhlIGNhbGxlciBpcyBvZmZpY2lhbCBhY2NlbGVyYXRvciBIS0cgRXhjaGFuZ2UKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdmlydHVhbEV4Y2hhbmdlQWRkcmVzcykgdGhyb3c7CiAgICAgIAogICAgICAKICAgICAgLy8gdHJhbnNmZXIgdG9rZW4gCiAgICAgIGFkZHJlc3Mgc2VuZGVyID0gdHgub3JpZ2luOwogICAgICB1aW50IHRva2Vuc1F0eSA9IGhrZ1ZhbHVlICogaGtnUHJpY2U7CgogICAgICAvLyBnYWluIHZvdGluZyByaWdodHMKICAgICAgdm90aW5nUmlnaHRzW3NlbmRlcl0gKz10b2tlbnNRdHk7CiAgICAgIHByZWZlcmVkUXR5U29sZCArPSB0b2tlbnNRdHk7CiAgICAgIGNvbGxlY3RlZEhLRyArPSBoa2dWYWx1ZTsKCiAgICAgIC8vIGRvIGFjdHVhbCB0cmFuc2ZlcgogICAgICB0cmFuc2ZlckZyb20odGhpcywgCiAgICAgICAgICAgICAgICAgICB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzLCB0b2tlbnNRdHkpOwogICAgICB0cmFuc2ZlcihzZW5kZXIsIHRva2Vuc1F0eSk7ICAgICAgICAKICAgICAgICAgICAgCiAgICAgIC8vIHJpc2UgZXZlbnQgICAgICAgCiAgICAgIEJ1eUZvckhLR1RyYW5zYWN0aW9uKHNlbmRlciwgcHJlZmVyZWRRdHlTb2xkLCB0b3RhbFN1cHBseVZhciwgaGtnUHJpY2UsIHRva2Vuc1F0eSk7CiAgICAgICAgCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgICAgIAogICAgCiAgICAvKioKICAgICAqIAogICAgICogaXNzdWVUb2tlbnMgLSBmdW5jdGlvbiB3aWxsIGlzc3VlIHRva2VucyBhZnRlciB0aGUgCiAgICAgKiAgICAgICAgICAgICAgIGV2ZW50LCBhYmxlIHRvIHNlbGwgZm9yIDEgZXRoZXIgCiAgICAgKiAKICAgICAqICBAcGFyYW0gcXR5Rm9yT25lRXRoZXIgdWludDogRFNUIHRva2VucyBmb3IgMSBFVEgKICAgICAqICBAcGFyYW0gcXR5VG9FbWl0IHVpbnQ6IG5ldyB0b2tlbnMgc3VwcGx5CiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVRva2Vucyh1aW50IHF0eUZvck9uZUV0aGVyLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgcXR5VG9FbWl0KSBvbmx5QWZ0ZXJFbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlJZkFibGVUb0lzc3VlVG9rZW5zIHsKICAgICAgICAgCiAgICAgICAgIGJhbGFuY2VzW3RoaXNdICs9IHF0eVRvRW1pdDsKICAgICAgICAgZXRoZXJQcmljZSA9IHF0eUZvck9uZUV0aGVyOwogICAgICAgICB0b3RhbFN1cHBseVZhciAgICArPSBxdHlUb0VtaXQ7CiAgICAgICAgIAogICAgICAgICAvLyByaXNlIGV2ZW50ICAKICAgICAgICAgRHN0VG9rZW5zSXNzdWVkKHF0eUZvck9uZUV0aGVyLCB0b3RhbFN1cHBseVZhciwgdG90YWxTdXBwbHlWYXIsIHF0eVRvRW1pdCk7CiAgICB9CiAgICAgCiAgICAKICAgIC8qKgogICAgICogc2V0RXRoZXJQcmljZSAtIGNoYW5nZSB0aGUgdG9rZW4gcHJpY2UKICAgICAqCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUV0aGVyIHVpbnQ6IG5ldyBwcmljZSAtIERTVCB0b2tlbnMgZm9yIDEgRVRICiAgICAgKi8gICAgIAogICAgZnVuY3Rpb24gc2V0RXRoZXJQcmljZSh1aW50IHF0eUZvck9uZUV0aGVyKSBvbmx5QWZ0ZXJFbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZSB7CiAgICAgICAgIGV0aGVyUHJpY2UgPSBxdHlGb3JPbmVFdGhlcjsgCgogICAgICAgICAvLyByaXNlIGV2ZW50IGZvciB0aGlzCiAgICAgICAgIE5ld0V0aGVyUHJpY2UocXR5Rm9yT25lRXRoZXIpOwogICAgfSAgICAKICAgIAoKICAgIC8qKgogICAgICogIGRpc2FibGVUb2tlbklzc3VhbmNlIC0gZnVuY3Rpb24gd2lsbCBkaXNhYmxlIGFueSAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbiBmb3IgZnV0dXJlIHRva2VuIAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWVuY2UKICAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuSXNzdWFuY2UoKSBvbmx5RXhlY3V0aXZlIHsKICAgICAgICBhYmxlVG9Jc3N1ZVRva2VucyA9IGZhbHNlOwogICAgICAgIAogICAgICAgIERpc2FibGVUb2tlbklzc3VhbmNlKCk7CiAgICB9CgogICAgCiAgICAvKioKICAgICAqICBidXJuUmVtYWluVG9rZW4gLSAgZWxpbWluYXRlZCBhbGwgYXZhaWxhYmxlIGZvciBzYWxlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHRva2Vucy4gCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm5SZW1haW5Ub2tlbigpIG9ubHlFeGVjdXRpdmUgewogICAgCiAgICAgICAgdG90YWxTdXBwbHlWYXIgLT0gYmFsYW5jZXNbdGhpc107CiAgICAgICAgYmFsYW5jZXNbdGhpc10gPSAwOwogICAgICAgIAogICAgICAgIC8vIHJpc2UgZXZlbnQgZm9yIHRoaXMKICAgICAgICBCdXJuZWRBbGxSZW1haW5lZFRva2VucygpOwogICAgfQogICAgCiAgICAvKioKICAgICAqICBzdWJtaXRFdGhlclByb3Bvc2FsOiBzdWJtaXQgcHJvcG9zYWwgdG8gdXNlIHBhcnQgb2YgdGhlIAogICAgICogICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3RlZCBldGhlciBmdW5kcwogICAgICoKICAgICAqICAgQHBhcmFtIHJlcXVlc3RWYWx1ZSB1aW50OiB2YWx1ZSBpbiB3ZWkgCiAgICAgKiAgIEBwYXJhbSB1cmwgc3RyaW5nOiBkZXRhaWxzIG9mIHRoZSBwcm9wb3NhbCAKICAgICAqLyAKICAgIGZ1bmN0aW9uIHN1Ym1pdEV0aGVyUHJvcG9zYWwodWludCByZXF1ZXN0VmFsdWUsIHN0cmluZyB1cmwpIG9ubHlBZnRlckVuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlFeGVjdXRpdmUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHRJZCwgYm9vbCByZXN1bHRTdWNjZXMpIHsgICAgICAgCiAgICAKICAgICAgICAvLyBlbnN1cmUgdGhlcmUgaXMgbm8gbW9yZSBpc3N1ZW5jZSBhdmFpbGFibGUgCiAgICAgICAgaWYgKGFibGVUb0lzc3VlVG9rZW5zKSB0aHJvdzsKICAgICAgICAgICAgCiAgICAgICAgLy8gZW5zdXJlIHRoZXJlIGlzIG5vIG1vcmUgdG9rZW5zIGF2YWlsYWJsZSAKICAgICAgICBpZiAoYmFsYW5jZU9mKHRoaXMpID4gMCkgdGhyb3c7CgogICAgICAgIC8vIFBvc3NpYmxlIHRvIHN1Ym1pdCBhIHByb3Bvc2FsIG9uY2UgMiB3ZWVrcyAKICAgICAgICBpZiAobm93IDwgKHRpbWVPZkxhc3RQcm9wb3NhbCArIDIgd2Vla3MpKSB0aHJvdzsKICAgICAgICAgICAgCiAgICAgICAgdWludCBwZXJjZW50ID0gY29sbGVjdGVkRXRoZXIgLyAxMDA7CiAgICAgICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0VmFsdWUgPiBQUk9QT1NBTF9GVU5EU19USCAqIHBlcmNlbnQpIHRocm93OwoKICAgICAgICAvLyBpZiByZW1haW5lZCB2YWx1ZSBpcyBsZXNzIHRoYW4gcmVxdWVzdGVkIGdhaW4gYWxsLgogICAgICAgIGlmIChyZXF1ZXN0VmFsdWUgPiB0aGlzLmJhbGFuY2UpIAogICAgICAgICAgICByZXF1ZXN0VmFsdWUgPSB0aGlzLmJhbGFuY2U7ICAgIAogICAgICAgICAgICAKICAgICAgICAvLyBzZXQgaWQgb2YgdGhlIHByb3Bvc2FsCiAgICAgICAgLy8gc3VibWl0IHByb3Bvc2FsIHRvIHRoZSBtYXAKICAgICAgICBieXRlczMyIGlkID0gc2hhMyhtc2cuZGF0YSwgbm93KTsKICAgICAgICB1aW50IHRpbWVFbmRzID0gbm93ICsgUFJPUE9TQUxfTElGRVRJTUU7IAogICAgICAgICAgICAKICAgICAgICBQcm9wb3NhbCBtZW1vcnkgbmV3UHJvcG9zYWwgPSBQcm9wb3NhbChpZCwgcmVxdWVzdFZhbHVlLCB1cmwsIHRpbWVFbmRzLCAwLCBtc2cuc2VuZGVyLCBmYWxzZSwgUHJvcG9zYWxDdXJyZW5jeS5FVEhFUik7CiAgICAgICAgcHJvcG9zYWxzW2lkXSA9IG5ld1Byb3Bvc2FsOwogICAgICAgIGxpc3RQcm9wb3NhbHMucHVzaChuZXdQcm9wb3NhbCk7CiAgICAgICAgICAgIAogICAgICAgIHRpbWVPZkxhc3RQcm9wb3NhbCA9IG5vdzsgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBQcm9wb3NhbFJlcXVlc3RTdWJtaXR0ZWQoaWQsIHJlcXVlc3RWYWx1ZSwgdGltZUVuZHMsIHVybCwgbXNnLnNlbmRlcik7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChpZCwgdHJ1ZSk7CiAgICB9CiAgICAKICAgIAogICAgIAogICAgLyoqCiAgICAgKiAKICAgICAqIHN1Ym1pdEhLR1Byb3Bvc2FsIC0gc3VibWl0IHByb3Bvc2FsIHRvIHJlcXVlc3QgZm9yIAogICAgICogICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsIEhLRyBmdW5kcyBjb2xsZWN0ZWQgCiAgICAgKiAKICAgICAqICBAcGFyYW0gcmVxdWVzdFZhbHVlIHVpbnQ6IHZhbHVlIGluIEhLRyB0byByZXF1ZXN0LiAKICAgICAqICBAcGFyYW0gdXJsIHN0cmluZzogdXJsIHdpdGggZGV0YWlscyBvbiB0aGUgcHJvcG9zaXRpb24gCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN1Ym1pdEhLR1Byb3Bvc2FsKHVpbnQgcmVxdWVzdFZhbHVlLCBzdHJpbmcgdXJsKSBvbmx5QWZ0ZXJFbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlIHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0SWQsIGJvb2wgcmVzdWx0U3VjY2VzKXsKICAgICAgICAKCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gMiBtb250aHMgb3ZlciBzaW5jZSB0aGUgbGFzdCBldmVudC4KICAgICAgICAvLyBUaGVyZSBpcyBubyBwb3NpYmxlIHRvIGdldCBhbnkgSEtHLiBBZnRlciAyIG1vbnRocwogICAgICAgIC8vIGFsbCB0aGUgSEtHIGlzIGF2YWlsYWJsZS4gCiAgICAgICAgaWYgKG5vdyA8IChldmVudEluZm8uZ2V0RXZlbnRFbmQoKSArIDggd2Vla3MpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgLy8gUG9zc2libGUgdG8gc3VibWl0IGEgcHJvcG9zYWwgb25jZSAyIHdlZWtzIAogICAgICAgIGlmIChub3cgPCAodGltZU9mTGFzdFByb3Bvc2FsICsgMiB3ZWVrcykpIHRocm93OwoKICAgICAgICB1aW50IHBlcmNlbnQgPSBwcmVmZXJlZFF0eVNvbGQgLyAxMDA7CiAgICAgICAgCiAgICAgICAgLy8gdmFsaWRhdGUgdGhlIGFtb3VudCBpcyBsZWdpdAogICAgICAgIC8vIGZpcnN0IDUgcHJvcG9zYWxzIHNob3VsZCBiZSBsZXNzIHRoYW4gMjAlIAogICAgICAgIGlmIChjb3VudGVyUHJvcG9zYWxzIDw9IDUgJiYgCiAgICAgICAgICAgIHJlcXVlc3RWYWx1ZSAgICAgPiAgUFJPUE9TQUxfRlVORFNfVEggKiBwZXJjZW50KSB0aHJvdzsKICAgICAgICAgICAgICAgIAogICAgICAgIC8vIGlmIHJlbWFpbmVkIHZhbHVlIGlzIGxlc3MgdGhhbiByZXF1ZXN0ZWQgCiAgICAgICAgLy8gZ2FpbiBhbGwuCiAgICAgICAgaWYgKHJlcXVlc3RWYWx1ZSA+IGdldEhLR093bmVkKCkpIAogICAgICAgICAgICByZXF1ZXN0VmFsdWUgPSBnZXRIS0dPd25lZCgpOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIHNldCBpZCBvZiB0aGUgcHJvcG9zYWwKICAgICAgICAvLyBzdWJtaXQgcHJvcG9zYWwgdG8gdGhlIG1hcAogICAgICAgIGJ5dGVzMzIgaWQgPSBzaGEzKG1zZy5kYXRhLCBub3cpOwogICAgICAgIHVpbnQgdGltZUVuZHMgPSBub3cgKyBQUk9QT1NBTF9MSUZFVElNRTsgCiAgICAgICAgCiAgICAgICAgUHJvcG9zYWwgbWVtb3J5IG5ld1Byb3Bvc2FsID0gUHJvcG9zYWwoaWQsIHJlcXVlc3RWYWx1ZSwgdXJsLCB0aW1lRW5kcywgMCwgbXNnLnNlbmRlciwgZmFsc2UsIFByb3Bvc2FsQ3VycmVuY3kuSEtHKTsKICAgICAgICBwcm9wb3NhbHNbaWRdID0gbmV3UHJvcG9zYWw7CiAgICAgICAgbGlzdFByb3Bvc2Fscy5wdXNoKG5ld1Byb3Bvc2FsKTsKICAgICAgICAKICAgICAgICArK2NvdW50ZXJQcm9wb3NhbHM7CiAgICAgICAgdGltZU9mTGFzdFByb3Bvc2FsID0gbm93OyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgIFByb3Bvc2FsUmVxdWVzdFN1Ym1pdHRlZChpZCwgcmVxdWVzdFZhbHVlLCB0aW1lRW5kcywgdXJsLCBtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKGlkLCB0cnVlKTsgICAgICAgIAogICAgfSAgCiAgICAKICAgIAogICAgCiAgICAvKioKICAgICAqIG9iamVjdFByb3Bvc2FsIC0gb2JqZWN0IHByZXZpb3VzbHkgc3VibWl0dGVkIHByb3Bvc2FsLCAKICAgICAqICAgICAgICAgICAgICAgICAgdGhlIG9iamVjdGlvbiByaWdodCBpcyBvYnRhaW5lZCBieSAKICAgICAqICAgICAgICAgICAgICAgICAgcHVyY2hhc2luZyBwcmVmZXJlZCB0b2tlbnMgb24gdGltZSBvZiAKICAgICAqICAgICAgICAgICAgICAgICAgdGhlIGhhY2thdGhvbi4KICAgICAqIAogICAgICogIEBwYXJhbSBpZCBieXRlczMyIDogdGhlIGlkIG9mIHRoZSBwcm9wb3NsYSB0byByZWRlZW0KICAgICAqLwogICAgIGZ1bmN0aW9uIG9iamVjdFByb3Bvc2FsKGJ5dGVzMzIgaWQpewogICAgICAgICAKICAgICAgICBQcm9wb3NhbCBtZW1vcnkgcHJvcG9zYWwgPSBwcm9wb3NhbHNbaWRdOwogICAgICAgICAKICAgICAgICAvLyBjaGVjayBwcm9wb3NhbCBleGlzdCAKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5pZCA9PSAwKSB0aHJvdzsKCiAgICAgICAgLy8gY2hlY2sgYWxyZWFkeSByZWRlZW1lZAogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnJlZGVlbWVkKSB0aHJvdzsKICAgICAgICAgCiAgICAgICAgLy8gZW5zdXJlIG9iamVjdGlvbiB0aW1lCiAgICAgICAgaWYgKG5vdyA+PSBwcm9wb3NhbHNbaWRdLnZvdGluZEVuZFRTKSB0aHJvdzsKICAgICAgICAgCiAgICAgICAgLy8gZW5zdXJlIG5vdCB2b3RlZCAgCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0udm90ZWRbbXNnLnNlbmRlcl0pIHRocm93OwogICAgICAgICAKICAgICAgICAgLy8gc3VibWl0IHZvdGVzCiAgICAgICAgIHVpbnQgdm90ZXMgPSB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl07CiAgICAgICAgIHByb3Bvc2Fsc1tpZF0udm90ZXNPYmplY3RpbmcgKz0gdm90ZXM7CiAgICAgICAgIAogICAgICAgICAvLyBtYXJrIHZvdGVkIAogICAgICAgICBwcm9wb3NhbHNbaWRdLnZvdGVkW21zZy5zZW5kZXJdID0gdHJ1ZTsgCiAgICAgICAgIAogICAgICAgICB1aW50IGlkeCA9IGdldEluZGV4QnlQcm9wb3NhbElkKGlkKTsKICAgICAgICAgbGlzdFByb3Bvc2Fsc1tpZHhdID0gcHJvcG9zYWxzW2lkXTsgICAKCiAgICAgICAgIE9iamVjdGVkVm90ZShpZCwgbXNnLnNlbmRlciwgdm90ZXMpOyAgICAgICAgIAogICAgIH0KICAgICAKICAgICAKICAgICBmdW5jdGlvbiBnZXRJbmRleEJ5UHJvcG9zYWxJZChieXRlczMyIGlkKSByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgIAogICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsaXN0UHJvcG9zYWxzLmxlbmd0aDsgKytpKXsKICAgICAgICAgICAgIGlmIChpZCA9PSBsaXN0UHJvcG9zYWxzW2ldLmlkKSByZXR1cm4gaTsKICAgICAgICAgfQogICAgIH0KICAgIAogICAgCiAgIAogICAgLyoqCiAgICAgKiByZWRlZW1Qcm9wb3NhbEZ1bmRzIC0gcmVkZWVtIGZ1bmRzIHJlcXVlc3RlZCBieSBwcmlvciAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXR0ZWQgcHJvcG9zYWwgICAgIAogICAgICogCiAgICAgKiBAcGFyYW0gaWQgYnl0ZXMzMjogdGhlIGlkIG9mIHRoZSBwcm9wb3NhbCB0byByZWRlZW0KICAgICAqLwogICAgZnVuY3Rpb24gcmVkZWVtUHJvcG9zYWxGdW5kcyhieXRlczMyIGlkKSBvbmx5RXhlY3V0aXZlIHsKCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0uaWQgPT0gMCkgdGhyb3c7CiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyICE9IG1zZy5zZW5kZXIpIHRocm93OwoKICAgICAgICAvLyBlbnN1cmUgb2JqZWN0aW9uIHRpbWUKICAgICAgICBpZiAobm93IDwgcHJvcG9zYWxzW2lkXS52b3RpbmRFbmRUUykgdGhyb3c7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGFscmVhZHkgcmVkZWVtZWQKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5yZWRlZW1lZCkgdGhyb3c7CgogICAgICAgIC8vIGNoZWNrIHZvdGVzIG9iamVjdGlvbiA9PiA1NSUgb2YgdG90YWwgdm90ZXMKICAgICAgICB1aW50IG9iamVjdGlvblRocmVzaG9sZCA9IHByZWZlcmVkUXR5U29sZCAvIDEwMCAqIDU1OwogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnZvdGVzT2JqZWN0aW5nICA+IG9iamVjdGlvblRocmVzaG9sZCkgdGhyb3c7CiAgICAKICAgIAogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnByb3Bvc2FsQ3VycmVuY3kgPT0gUHJvcG9zYWxDdXJyZW5jeS5IS0cpewogICAgICAgICAgICAKICAgICAgICAgICAgLy8gc2VuZCBoYWNrZXIgZ29sZCAKICAgICAgICAgICAgaGFja2VyR29sZC50cmFuc2Zlcihwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlciwgcHJvcG9zYWxzW2lkXS52YWx1ZSk7ICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgIC8vIHNlbmQgZXRoZXIgICAgICAgICAgICAgIAogICAgICAgICAgIGJvb2wgc3VjY2VzcyA9IHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyLnNlbmQocHJvcG9zYWxzW2lkXS52YWx1ZSk7IAoKICAgICAgICAgICAvLyByaXNlIGV2ZW50CiAgICAgICAgICAgRXRoZXJSZWRlZW1BY2NlcHRlZChwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlciwgcHJvcG9zYWxzW2lkXS52YWx1ZSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGV4ZWN1dGUgdGhlIHByb3Bvc2FsIAogICAgICAgIHByb3Bvc2Fsc1tpZF0ucmVkZWVtZWQgPSB0cnVlOyAKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqICBnZXRBbGxUaGVGdW5kcyAtIHRvIGVuc3VyZSB0aGVyZSBpcyBubyBkZWFkbG9jayBjYW4gCiAgICAgKiAgICAgICAgICAgICAgICAgICBjYW4gaGFwcGVuLCBhbmQgbm8gY2FzZSB0aGF0IHZvdGluZyAKICAgICAqICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZSB3aWxsIGZyZWV6ZSB0aGUgZnVuZHMgZm9yZXZlcgogICAgICogICAgICAgICAgICAgICAgICAgdGhlIHN0YXJ0dXAgd2lsbCBiZSBhYmxlIHRvIGdldCBhbGwgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICBmdW5kcyB3aXRob3V0IGEgcHJvcG9zYWwgcmVxdWlyZWQgYWZ0ZXIKICAgICAqICAgICAgICAgICAgICAgICAgIDYgbW9udGhzLgogICAgICogCiAgICAgKiAKICAgICAqLyAgICAgICAgICAgICAKICAgIGZ1bmN0aW9uIGdldEFsbFRoZUZ1bmRzKCkgb25seUV4ZWN1dGl2ZSB7CiAgICAgICAgCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBkZWFkbG9jayBpbiB2b3RpbmcgcGFydGljaXBhdGVzCiAgICAgICAgLy8gdGhlIGZ1bmRzIGNhbiBiZSByZWRlZW1lZCBjb21wbGV0ZWxseSBpbiA2IG1vbnRocwogICAgICAgIGlmIChub3cgPCAoZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkgKyAyNCB3ZWVrcykpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfSAgCiAgICAgICAgCiAgICAgICAgLy8gYWxsIHRoZSBFdGhlcgogICAgICAgIGJvb2wgc3VjY2VzcyA9IG1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpOyAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gYWxsIHRoZSBIS0cKICAgICAgICBoYWNrZXJHb2xkLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGdldEhLR093bmVkKCkpOyAgICAgICAgICAgICAgCiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBzdWJtaXRJbXBlYWNobWVudFByb3Bvc2FsIC0gc3VibWl0IHJlcXVlc3QgdG8gc3dpdGNoIAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dGl2ZS4KICAgICAqIAogICAgICogIEBwYXJhbSB1cmxEZXRhaWxzICAtIGRldGFpbHMgb2YgdGhlIGltcGVhY2htZW50IHByb3Bvc2FsIAogICAgICogIEBwYXJhbSBuZXdFeGVjdXRpdmUgLSBhZGRyZXNzIG9mIHRoZSBuZXcgZXhlY3V0aXZlIAogICAgICogCiAgICAgKi8gICAgICAgICAgICAgCiAgICAgZnVuY3Rpb24gc3VibWl0SW1wZWFjaG1lbnRQcm9wb3NhbChzdHJpbmcgdXJsRGV0YWlscywgYWRkcmVzcyBuZXdFeGVjdXRpdmUpewogICAgICAgICAKICAgICAgICAvLyB0byBvZmZlciBpbXBlYWNobWVudCB5b3Ugc2hvdWxkIGhhdmUgCiAgICAgICAgLy8gdm90aW5nIHJpZ2h0cwogICAgICAgIGlmICh2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl0gPT0gMCkgdGhyb3c7CiAgICAgICAgIAogICAgICAgIC8vIHRoZSBzdWJtaXNzaW9uIG9mIHRoZSBmaXJzdCBpbXBlYWNobWVudCAKICAgICAgICAvLyBwcm9wb3NhbCBpcyBwb3NzaWJsZSBvbmx5IGFmdGVyIDMgbW9udGhzCiAgICAgICAgLy8gc2luY2UgdGhlIGhhY2thdGhvbiBpcyBvdmVyCiAgICAgICAgaWYgKG5vdyA8IChldmVudEluZm8uZ2V0RXZlbnRFbmQoKSArIDEyIHdlZWtzKSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAvLyBjaGVjayB0aGVyZSBpcyAxIG1vbnRocyBvdmVyIHNpbmNlIGxhc3Qgb25lCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGluZEVuZFRTICE9IDAgJiYgCiAgICAgICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGluZEVuZFRTICsgIDIgd2Vla3MgPiBub3cpIHRocm93OwoKCiAgICAgICAgLy8gc3VibWl0IGltcGVhY2htZW50IHByb3Bvc2FsCiAgICAgICAgLy8gYWRkIHRoZSB2b3RlcyBvZiB0aGUgc3VibWl0dGVyIAogICAgICAgIC8vIHRvIHRoZSBwcm9wb3NhbCByaWdodCBhd2F5CiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwgPSBJbXBlYWNobWVudFByb3Bvc2FsKHVybERldGFpbHMsIG5ld0V4ZWN1dGl2ZSwgbm93ICsgMiB3ZWVrcywgdm90aW5nUmlnaHRzW21zZy5zZW5kZXJdKTsKICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RlZFttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgIAogICAgICAgIC8vIHJpc2UgZXZlbnQKICAgICAgICBJbXBlYWNobWVudFByb3Bvc2VkKG1zZy5zZW5kZXIsIHVybERldGFpbHMsIG5vdyArIDIgd2Vla3MsIG5ld0V4ZWN1dGl2ZSk7CiAgICAgfQogICAgCiAgICAKICAgIC8qKgogICAgICogc3VwcG9ydEltcGVhY2htZW50IC0gdm90ZSBmb3IgaW1wZWFjaG1lbnQgcHJvcG9zYWwgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICB0aGF0IGlzIGN1cnJlbnRseSBpbiBwcm9ncmVzcwogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gc3VwcG9ydEltcGVhY2htZW50KCl7CgogICAgICAgIC8vIGVuc3VyZSB0aGF0IHN1cHBvcnQgaXMgZm9yIGV4aXN0IHByb3Bvc2FsIAogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC5uZXdFeGVjdXRpdmUgPT0gMHgwKSB0aHJvdzsKICAgIAogICAgICAgIC8vIHRvIG9mZmVyIGltcGVhY2htZW50IHlvdSBzaG91bGQgaGF2ZSAKICAgICAgICAvLyB2b3RpbmcgcmlnaHRzCiAgICAgICAgaWYgKHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSA9PSAwKSB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBjaGVjayBpZiBub3Qgdm90ZWQgYWxyZWFkeSAKICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZWRbbXNnLnNlbmRlcl0pIHRocm93OwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGlmIG5vdCBmaW5pc2hlZCB0aGUgMiB3ZWVrcyBvZiB2b3RpbmcgCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGluZEVuZFRTICsgMiB3ZWVrcyA8PSBub3cpIHRocm93OwogICAgICAgICAgICAgICAgCiAgICAgICAgLy8gc3VwcG9ydCB0aGUgaW1wZWFjaG1lbnQKICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RlZFttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZXNTdXBwb3J0aW5nICs9IHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXTsKCiAgICAgICAgLy8gcmlzZSBpbXBlYWNobWVudCBzdXBwcG9ydGluZyBldmVudAogICAgICAgIEltcGVhY2htZW50U3VwcG9ydChtc2cuc2VuZGVyLCB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl0pOwogICAgICAgIAogICAgICAgIC8vIGlmIHRoZSB2b3RlIGlzIG92ZXIgNzAlIGV4ZWN1dGUgdGhlIHN3aXRjaCAKICAgICAgICB1aW50IHBlcmNlbnQgPSBwcmVmZXJlZFF0eVNvbGQgLyAxMDA7IAogICAgICAgIAogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3Rlc1N1cHBvcnRpbmcgPj0gNzAgKiBwZXJjZW50KXsKICAgICAgICAgICAgZXhlY3V0aXZlID0gbGFzdEltcGVhY2htZW50UHJvcG9zYWwubmV3RXhlY3V0aXZlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gaW1wZWFjaG1lbnQgZXZlbnQKICAgICAgICAgICAgSW1wZWFjaG1lbnRBY2NlcHRlZChleGVjdXRpdmUpOwogICAgICAgIH0KICAgICAgICAKICAgIH0gCiAgICAKICAgICAgCiAgICAKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKiogLy8KICAgIC8vICogICAgIENvbnN0YW50IEdldHRlcnMgICAgICogLy8KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKiogLy8KICAgIAogICAgZnVuY3Rpb24gdm90aW5nUmlnaHRzT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVzdWx0KSB7CiAgICAgICAgcmVzdWx0ID0gdm90aW5nUmlnaHRzW19vd25lcl07CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFByZWZlcmVkUXR5U29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gcHJlZmVyZWRRdHlTb2xkOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRWaXJ0dWFsRXhjaGFuZ2UoYWRkcmVzcyB2aXJ0dWFsRXhjaGFuZ2VBZGRyKXsKICAgICAgICBpZiAodmlydHVhbEV4Y2hhbmdlQWRkcmVzcyAhPSAweDApIHRocm93OwogICAgICAgIHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MgPSB2aXJ0dWFsRXhjaGFuZ2VBZGRyOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEhLR093bmVkKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiBoYWNrZXJHb2xkLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0RXRoZXJWYWx1ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRFeGVjdXRpdmUoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGl2ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0SEtHUHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGhrZ1ByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV0aGVyUHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGV0aGVyUHJpY2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldERTVE5hbWUoKSBjb25zdGFudCByZXR1cm5zKHN0cmluZyByZXN1bHQpewogICAgICAgIHJldHVybiBuYW1lOwogICAgfSAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0RFNUTmFtZUJ5dGVzKCkgY29uc3RhbnQgcmV0dXJucyhieXRlczMyIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGNvbnZlcnQobmFtZSk7CiAgICB9ICAgIAoKICAgIGZ1bmN0aW9uIGdldERTVFN5bWJvbCgpIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIHN5bWJvbDsKICAgIH0gICAgCiAgICAKICAgIGZ1bmN0aW9uIGdldERTVFN5bWJvbEJ5dGVzKCkgY29uc3RhbnQgcmV0dXJucyhieXRlczMyIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGNvbnZlcnQoc3ltYm9sKTsKICAgIH0gICAgCgogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlWYXI7CiAgICB9IAogICAgICAgIAogICAgZnVuY3Rpb24gZ2V0Q29sbGVjdGVkRXRoZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdHMpIHsgICAgICAgIAogICAgICAgIHJldHVybiBjb2xsZWN0ZWRFdGhlcjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0Q291bnRlclByb3Bvc2FscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gY291bnRlclByb3Bvc2FsczsKICAgIH0KICAgICAgICAKICAgIGZ1bmN0aW9uIGdldFByb3Bvc2FsSWRCeUluZGV4KHVpbnQgaSkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpewogICAgICAgIHJldHVybiBsaXN0UHJvcG9zYWxzW2ldLmlkOwogICAgfSAgICAKCiAgICBmdW5jdGlvbiBnZXRQcm9wb3NhbE9iamVjdGlvbkJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGxpc3RQcm9wb3NhbHNbaV0udm90ZXNPYmplY3Rpbmc7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxWYWx1ZUJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGxpc3RQcm9wb3NhbHNbaV0udmFsdWU7CiAgICB9ICAgICAgICAgICAgICAgICAgCiAgICAKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRJbXBlYWNobWVudFVybERldGFpbHMoKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGFzdEltcGVhY2htZW50UHJvcG9zYWwudXJsRGV0YWlsczsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50SW1wZWFjaG1lbnRWb3Rlc1N1cHBvcnRpbmcoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVzU3VwcG9ydGluZzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY29udmVydChzdHJpbmcga2V5KSByZXR1cm5zIChieXRlczMyIHJldCkgewogICAgICAgICAgICBpZiAoYnl0ZXMoa2V5KS5sZW5ndGggPiAzMikgewogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgIH0gICAgICAKCiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIHJldCA6PSBtbG9hZChhZGQoa2V5LCAzMikpCiAgICAgICAgICAgIH0KICAgIH0gICAgCiAgICAKICAgIC8vIEVtZXJnZW5jeSBGaXggbGltaXRlZCBieSB0aW1lIGZ1bmN0aW9ucwogICAgZnVuY3Rpb24gc2V0Vm90ZVJpZ2h0KGFkZHJlc3Mgdm90ZXIsIHVpbnQgYW1tb3VudCl7CiAgICAgICAgCiAgICAgICAgLy8gbGltaXRlZCBieSBbMjQgSmFuIDIwMTcgMDA6MDA6MDAgR01UXQogICAgICAgIGlmIChub3cgPiAxNDg1MjE2MDAwKSB0aHJvdzsKCiAgICAgICAgLy8gbGltaXRlZCBieSBvbmUgYWNjb3VudCB0byBmaXggCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gMHgzNDJlNjI3MzJiNzY4NzVkYTkzMDUwODNlYThhZTYzMTI1YTRlNjY3KSB0aHJvdzsKCiAgICAgICAgdm90aW5nUmlnaHRzW3ZvdGVyXSA9IGFtbW91bnQ7CiAgICB9CiAgICAKICAgIC8vIEVtZXJnZW5jeSBGaXggbGltaXRlZCBieSB0aW1lIGZ1bmN0aW9ucwogICAgZnVuY3Rpb24gc2V0QmFsYW5jZShhZGRyZXNzIG93bmVyLCB1aW50IGFtbW91bnQpewoKICAgICAgICAvLyBsaW1pdGVkIGJ5IFsyNCBKYW4gMjAxNyAwMDowMDowMCBHTVRdCiAgICAgICAgaWYgKG5vdyA+IDE0ODUyMTYwMDApIHRocm93OwogICAgICAgIAogICAgICAgIC8vIGxpbWl0ZWQgYnkgb25lIGFjY291bnQgdG8gZml4IAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IDB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2NykgdGhyb3c7CiAgICAgICAgCiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gYW1tb3VudDsKICAgIH0KICAgIAogICAgLy8gRW1lcmdlbmN5IEZpeCBsaW1pdGVkIGJ5IHRpbWUgZnVuY3Rpb25zCiAgICBmdW5jdGlvbiBzZXRJbnRlcm5hbEluZm8oYWRkcmVzcyBmaXhFeGVjdXRpdmUsIHVpbnQgZml4VG90YWxTdXBwbHksIHVpbnQyNTYgZml4UHJlZmVyZWRRdHlTb2xkLCAKICAgICAgICAgICAgdWludDI1NiBmaXhDb2xsZWN0ZWRIS0csIHVpbnQgZml4Q29sbGVjdGVkRXRoZXIpewoKICAgICAgICAvLyBsaW1pdGVkIGJ5IFsyNCBKYW4gMjAxNyAwMDowMDowMCBHTVRdCiAgICAgICAgaWYgKG5vdyA+IDE0ODUyMTYwMDApIHRocm93OwogICAgICAgIAogICAgICAgIC8vIGxpbWl0ZWQgYnkgb25lIGFjY291bnQgdG8gZml4IAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IDB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2NykgdGhyb3c7CiAgICAgICAgCiAgICAgICAgZXhlY3V0aXZlID0gZml4RXhlY3V0aXZlOwogICAgICAgIHRvdGFsU3VwcGx5VmFyID0gZml4VG90YWxTdXBwbHk7CiAgICAgICAgcHJlZmVyZWRRdHlTb2xkID0gZml4UHJlZmVyZWRRdHlTb2xkOwogICAgICAgIGNvbGxlY3RlZEhLRyA9IGZpeENvbGxlY3RlZEhLRzsKICAgICAgICBjb2xsZWN0ZWRFdGhlciA9IGZpeENvbGxlY3RlZEV0aGVyOwogICAgfQogICAgCiAgICAKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgTW9kaWZpZXJzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKiogLy8gICAgCiAKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVFbmQoKSB7IGlmIChub3cgID49ICBldmVudEluZm8uZ2V0RXZlbnRFbmQoKSkgdGhyb3c7IF87IH0KICAgIG1vZGlmaWVyIG9ubHlBZnRlckVuZCgpICB7IGlmIChub3cgIDwgICBldmVudEluZm8uZ2V0RXZlbnRFbmQoKSkgdGhyb3c7IF87IH0KICAgIAogICAgbW9kaWZpZXIgb25seUFmdGVyVHJhZGluZ1N0YXJ0KCkgIHsgaWYgKG5vdyAgPCBldmVudEluZm8uZ2V0VHJhZGluZ1N0YXJ0KCkpIHRocm93OyBfOyB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlFeGVjdXRpdmUoKSAgICAgeyBpZiAobXNnLnNlbmRlciAhPSBleGVjdXRpdmUpIHRocm93OyBfOyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgbW9kaWZpZXIgb25seUlmQWJsZVRvSXNzdWVUb2tlbnMoKSAgeyBpZiAoIWFibGVUb0lzc3VlVG9rZW5zKSB0aHJvdzsgXzsgfSAKICAgIAoKICAgIC8vICoqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgRXZlbnRzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKiogLy8gICAgICAgIAoKICAgIAogICAgZXZlbnQgUHJpY2VIS0dDaGFuZ2UodWludCBpbmRleGVkIHF0eUZvck9uZUhLRywgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSk7CiAgICBldmVudCBCdXlGb3JIS0dUcmFuc2FjdGlvbihhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQgaW5kZXhlZCB0b2tlbnNTb2xkLCB1aW50IGluZGV4ZWQgdG90YWxTdXBwbHksIHVpbnQgcXR5Rm9yT25lSEtHLCB1aW50IHRva2Vuc0Ftb3VudCk7CiAgICBldmVudCBCdXlGb3JFdGhlclRyYW5zYWN0aW9uKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSwgdWludCBxdHlGb3JPbmVFdGhlciwgdWludCB0b2tlbnNBbW91bnQpOwoKICAgIGV2ZW50IERzdFRva2Vuc0lzc3VlZCh1aW50IGluZGV4ZWQgcXR5Rm9yT25lSEtHLCB1aW50IGluZGV4ZWQgdG9rZW5zU29sZCwgdWludCBpbmRleGVkIHRvdGFsU3VwcGx5LCB1aW50IHF0eVRvRW1pdCk7CiAgICAKICAgIGV2ZW50IFByb3Bvc2FsUmVxdWVzdFN1Ym1pdHRlZChieXRlczMyIGlkLCB1aW50IHZhbHVlLCB1aW50IHRpbWVFbmRzLCBzdHJpbmcgdXJsLCBhZGRyZXNzIHNlbmRlcik7CiAgICAKICAgIGV2ZW50IEV0aGVyUmVkZWVtQWNjZXB0ZWQoYWRkcmVzcyBzZW5kZXIsIHVpbnQgdmFsdWUpOwogICAgCiAgICBldmVudCBPYmplY3RlZFZvdGUoYnl0ZXMzMiBpZCwgYWRkcmVzcyB2b3RlciwgdWludCB2b3Rlcyk7CiAgICAKICAgIGV2ZW50IEltcGVhY2htZW50UHJvcG9zZWQoYWRkcmVzcyBzdWJtaXR0ZXIsIHN0cmluZyB1cmxEZXRhaWxzLCB1aW50IHZvdGluZEVuZFRTLCBhZGRyZXNzIG5ld0V4ZWN1dGl2ZSk7CiAgICBldmVudCBJbXBlYWNobWVudFN1cHBvcnQoYWRkcmVzcyBzdXBwb3J0dGVyLCB1aW50IHZvdGVzKTsKICAgIAogICAgZXZlbnQgSW1wZWFjaG1lbnRBY2NlcHRlZChhZGRyZXNzIG5ld0V4ZWN1dGl2ZSk7CgogICAgZXZlbnQgTmV3RXRoZXJQcmljZSh1aW50IG5ld1F0eUZvck9uZUV0aGVyKTsKICAgIGV2ZW50IERpc2FibGVUb2tlbklzc3VhbmNlKCk7CiAgICAKICAgIGV2ZW50IEJ1cm5lZEFsbFJlbWFpbmVkVG9rZW5zKCk7CiAgICAKfQ=='.
	

]
