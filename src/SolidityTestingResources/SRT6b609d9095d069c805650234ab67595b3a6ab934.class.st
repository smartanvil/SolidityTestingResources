Class {
	#name : #SRT6b609d9095d069c805650234ab67595b3a6ab934,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6b609d9095d069c805650234ab67595b3a6ab934 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogSVBhdXNhYmxlCiAqCiAqIFNpbXBsZSBpbnRlcmZhY2UgdG8gcGF1c2UgYW5kIHJlc3VtZSAKICoKICogI2NyZWF0ZWQgMTEvMTAvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElQYXVzYWJsZSB7CgoKICAgIC8qKgogICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBpbXBsZW1lbnRpbmcgY29udHJhY3QgaXMgCiAgICAgKiBjdXJyZW50bHkgcGF1c2VkIG9yIG5vdAogICAgICoKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgcGF1c2VkIHN0YXRlIGlzIGFjdGl2ZQogICAgICovCiAgICBmdW5jdGlvbiBpc1BhdXNlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIENoYW5nZSB0aGUgc3RhdGUgdG8gcGF1c2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljOwoKCiAgICAvKioKICAgICAqIENoYW5nZSB0aGUgc3RhdGUgdG8gcmVzdW1lLCB1bmRvIHRoZSBlZmZlY3RzIAogICAgICogb2YgY2FsbGluZyBwYXVzZQogICAgICovCiAgICBmdW5jdGlvbiByZXN1bWUoKSBwdWJsaWM7Cn0KCgovKioKICogSU93bmVyc2hpcAogKgogKiBQZXJtaW5lbnQgb3duZXJzaGlwCiAqCiAqICNjcmVhdGVkIDAxLzEwLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJT3duZXJzaGlwIHsKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBgX2FjY291bnRgIGlzIHRoZSBjdXJyZW50IG93bmVyCiAgICAgKgogICAgICogQHBhcmFtIF9hY2NvdW50IFRoZSBhZGRyZXNzIHRvIHRlc3QgYWdhaW5zdAogICAgICovCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIEdldHMgdGhlIGN1cnJlbnQgb3duZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIGFkZHJlc3MgVGhlIGN1cnJlbnQgb3duZXIKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0T3duZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKfQoKCi8qKgogKiBPd25lcnNoaXAKICoKICogUGVybWluZW50IG93bmVyc2hpcAogKgogKiAjY3JlYXRlZCAwMS8xMC8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBPd25lcnNoaXAgaXMgSU93bmVyc2hpcCB7CgogICAgLy8gT3duZXIKICAgIGFkZHJlc3MgaW50ZXJuYWwgb3duZXI7CgoKICAgIC8qKgogICAgICogQWNjZXNzIGlzIHJlc3RyaWN0ZWQgdG8gdGhlIGN1cnJlbnQgb3duZXIKICAgICAqLwogICAgbW9kaWZpZXIgb25seV9vd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogVGhlIHB1Ymxpc2hlciBpcyB0aGUgaW5pdGFsIG93bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBgX2FjY291bnRgIGlzIHRoZSBjdXJyZW50IG93bmVyCiAgICAgKgogICAgICogQHBhcmFtIF9hY2NvdW50IFRoZSBhZGRyZXNzIHRvIHRlc3QgYWdhaW5zdAogICAgICovCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gX2FjY291bnQgPT0gb3duZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogR2V0cyB0aGUgY3VycmVudCBvd25lcgogICAgICoKICAgICAqIEByZXR1cm4gYWRkcmVzcyBUaGUgY3VycmVudCBvd25lcgogICAgICovCiAgICBmdW5jdGlvbiBnZXRPd25lcigpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gb3duZXI7CiAgICB9Cn0KCgovKioKICogRVJDMjAgY29tcGF0aWJsZSB0b2tlbiBpbnRlcmZhY2UKICoKICogLSBJbXBsZW1lbnRzIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAogKiAtIEltcGxlbWVudHMgc2hvcnQgYWRkcmVzcyBhdHRhY2sgZml4CiAqCiAqICNjcmVhdGVkIDI5LzA5LzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJVG9rZW4geyAKCiAgICAvKiogCiAgICAgKiBHZXQgdGhlIHRvdGFsIHN1cHBseSBvZiB0b2tlbnMKICAgICAqIAogICAgICogQHJldHVybiBUaGUgdG90YWwgc3VwcGx5CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgoKICAgIC8qKiAKICAgICAqIEdldCBiYWxhbmNlIG9mIGBfb3duZXJgIAogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCgogICAgLyoqIAogICAgICogU2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgICogCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKiAKICAgICAqIFNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgICogCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCgogICAgLyoqIAogICAgICogYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zCiAgICAgKiAKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKiAKICAgICAqIEdldCB0aGUgYW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgdGhhdCBgX3NwZW5kZXJgIGlzIGFsbG93ZWQgdG8gc3BlbmQgZnJvbSBgX293bmVyYAogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwp9CgoKLyoqCiAqIElNYW5hZ2VkVG9rZW4KICoKICogQWRkcyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uYWxpdHkgdG8gdGhlIGJhc2ljIEVSQzIwIHRva2VuCiAqIC0gTG9ja2luZwogKiAtIElzc3VpbmcKICogLSBCdXJuaW5nIAogKgogKiAjY3JlYXRlZCAyOS8wOS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwppbnRlcmZhY2UgSU1hbmFnZWRUb2tlbiB7IAoKICAgIC8qKiAKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdG9rZW4gaXMgbG9ja2VkCiAgICAgKiAKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdG9rZW4gaXMgbG9ja2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzTG9ja2VkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogTG9ja3MgdGhlIHRva2VuIHNvIHRoYXQgdGhlIHRyYW5zZmVyaW5nIG9mIHZhbHVlIGlzIGRpc2FibGVkIAogICAgICoKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdW5sb2NraW5nIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBsb2NrKCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIFVubG9ja3MgdGhlIHRva2VuIHNvIHRoYXQgdGhlIHRyYW5zZmVyaW5nIG9mIHZhbHVlIGlzIGVuYWJsZWQgCiAgICAgKgogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSB1bmxvY2tpbmcgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIHVubG9jaygpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBJc3N1ZXMgYF92YWx1ZWAgbmV3IHRva2VucyB0byBgX3RvYAogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGlzc3VlZAogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIG5ldyB0b2tlbnMgdG8gaXNzdWUKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdG9rZW5zIHdoZXJlIHN1Y2Vzc2Z1bGx5IGlzc3VlZCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogQnVybnMgYF92YWx1ZWAgdG9rZW5zIG9mIGBfZnJvbWAKICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSB0b2tlbnMgdG8gYmUgYnVybmVkCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGJ1cm5lZAogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSB0b2tlbnMgd2hlcmUgc3VjZXNzZnVsbHkgYnVybmVkIG9yIG5vdCAKICAgICAqLwogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgoKLyoqCiAqIElUb2tlblJldHJpZXZlcgogKgogKiBBbGxvd3MgdG9rZW5zIHRvIGJlIHJldHJpZXZlZCBmcm9tIGEgY29udHJhY3QKICoKICogI2NyZWF0ZWQgMjkvMDkvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElUb2tlblJldHJpZXZlciB7CgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyaWV2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KSBwdWJsaWM7Cn0KCgovKioKICogVG9rZW5SZXRyaWV2ZXIKICoKICogQWxsb3dzIHRva2VucyB0byBiZSByZXRyaWV2ZWQgZnJvbSBhIGNvbnRyYWN0CiAqCiAqICNjcmVhdGVkIDE4LzEwLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IFRva2VuUmV0cmlldmVyIGlzIElUb2tlblJldHJpZXZlciB7CgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyaWV2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIElUb2tlbiB0b2tlbkluc3RhbmNlID0gSVRva2VuKF90b2tlbkNvbnRyYWN0KTsKICAgICAgICB1aW50IHRva2VuQmFsYW5jZSA9IHRva2VuSW5zdGFuY2UuYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGlmICh0b2tlbkJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIHRva2VuSW5zdGFuY2UudHJhbnNmZXIobXNnLnNlbmRlciwgdG9rZW5CYWxhbmNlKTsKICAgICAgICB9CiAgICB9Cn0KCgovKioKICogSUF1dGhlbnRpY2F0b3IgCiAqCiAqIEF1dGhlbnRpY2F0b3IgaW50ZXJmYWNlCiAqCiAqICNjcmVhdGVkIDE1LzEwLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJQXV0aGVudGljYXRvciB7CiAgICAKCiAgICAvKioKICAgICAqIEF1dGhlbnRpY2F0ZSAKICAgICAqCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgYF9hY2NvdW50YCBpcyBhdXRoZW50aWNhdGVkIG9yIG5vdAogICAgICoKICAgICAqIEBwYXJhbSBfYWNjb3VudCBUaGUgYWNjb3VudCB0byBhdXRoZW50aWNhdGUKICAgICAqIEByZXR1cm4gd2hldGhlciBgX2FjY291bnRgIGlzIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZShhZGRyZXNzIF9hY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKCi8qKgogKiBJQXV0aGVudGljYXRpb25NYW5hZ2VyIAogKgogKiBBbGxvd3MgdGhlIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MgdG8gYmUgZW5hYmxlZCBhbmQgZGlzYWJsZWQKICoKICogI2NyZWF0ZWQgMTUvMTAvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElBdXRoZW50aWNhdGlvbk1hbmFnZXIgewogICAgCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYXV0aGVudGljYXRpb24gaXMgZW5hYmxlZCBhbmQgZmFsc2UgCiAgICAgKiBvdGhlcndpc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIGNvbnZlcnRlciBpcyBjdXJyZW50bHkgYXV0aGVudGljYXRpbmcgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRpbmcoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBFbmFibGUgYXV0aGVudGljYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlQXV0aGVudGljYXRpb24oKSBwdWJsaWM7CgoKICAgIC8qKgogICAgICogRGlzYWJsZSBhdXRoZW50aWNhdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQXV0aGVudGljYXRpb24oKSBwdWJsaWM7Cn0KCgovKioKICogSVdpbmdzQWRhcHRlcgogKiAKICogV0lOR1MgREFPIFByaWNlIERpc2NvdmVyeSAmIFByb21vdGlvbiBQcmUtQmV0YSBodHRwczovL3d3dy53aW5ncy5haQogKgogKiAjY3JlYXRlZCAwNC8xMC8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwppbnRlcmZhY2UgSVdpbmdzQWRhcHRlciB7CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRvdGFsIHJhaXNlZCBhbW91bnQgb2YgRXRoZXIKICAgICAqCiAgICAgKiBDYW4gb25seSBpbmNyZWFzZSwgbWVhbmluZyBpZiB5b3Ugd2l0aGRyYXcgRVRIIGZyb20gdGhlIHdhbGxldCwgaXQgc2hvdWxkIGJlIG5vdCBtb2RpZmllZCAoeW91IGNhbiB1c2UgdHdvIGZpZWxkcyAKICAgICAqIHRvIGtlZXAgb25lIHdpdGggYSB0b3RhbCBhY2N1bXVsYXRlZCBhbW91bnQpIGFtb3VudCBvZiBFVEggaW4gY29udHJhY3QgYW5kIHRvdGFsQ29sbGVjdGVkIGZvciB0b3RhbCBhbW91bnQgb2YgRVRIIGNvbGxlY3RlZAogICAgICoKICAgICAqIEByZXR1cm4gVG90YWwgcmFpc2VkIEV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbENvbGxlY3RlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwp9CgoKLyoqCiAqIElQZXJzb25hbENyb3dkc2FsZVByb3h5CiAqCiAqICNjcmVhdGVkIDIyLzExLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJUGVyc29uYWxDcm93ZHNhbGVQcm94eSB7CgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyB0aGF0IG1zZy5zZW5kZXIgaXMgbm90IGEgY29udHJhY3QuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSBpdCdzIAogICAgICogbm90IHBvc3NpYmxlIGZvciBhIGNvbnRyYWN0IHRvIHNwZWNpZnkgYSBnYXMgYW1vdW50IHdoZW4gY2FsbGluZyB0aGUgKGludGVybmFsKSBzZW5kKCkgCiAgICAgKiBmdW5jdGlvbi4gU29saWRpdHkgaW1wb3NlcyBhIG1heGltdW0gYW1vdW50IG9mIGdhcyAoMjMwMCBnYXMgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZykKICAgICAqIAogICAgICogQ29udHJhY3RzIGNhbiBjYWxsIHRoZSBjb250cmlidXRlKCkgZnVuY3Rpb24gaW5zdGVhZAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZTsKfQoKCi8qKgogKiBQZXJzb25hbENyb3dkc2FsZVByb3h5CiAqCiAqICNjcmVhdGVkIDIyLzExLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IFBlcnNvbmFsQ3Jvd2RzYWxlUHJveHkgaXMgSVBlcnNvbmFsQ3Jvd2RzYWxlUHJveHkgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgSUNyb3dkc2FsZSBwdWJsaWMgdGFyZ2V0OwogICAgCgogICAgLyoqCiAgICAgKiBEZXBsb3kgcHJveHkKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIE93bmVyIG9mIHRoZSBwcm94eQogICAgICogQHBhcmFtIF90YXJnZXQgVGFyZ2V0IGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBQZXJzb25hbENyb3dkc2FsZVByb3h5KGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF90YXJnZXQpIHB1YmxpYyB7CiAgICAgICAgdGFyZ2V0ID0gSUNyb3dkc2FsZShfdGFyZ2V0KTsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGNvbnRyaWJ1dGlvbiBhbmQgZm9yd2FyZCB0byB0aGUgdGFyZ2V0IGNyb3dkc2FsZQogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgdGFyZ2V0LmNvbnRyaWJ1dGVGb3IudmFsdWUobXNnLnZhbHVlKShvd25lcik7CiAgICB9Cn0KCgovKioKICogSUNyb3dkc2FsZVByb3h5CiAqCiAqICNjcmVhdGVkIDIzLzExLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJQ3Jvd2RzYWxlUHJveHkgewoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIHRoZSBzZW5kZXIKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyB0aGF0IG1zZy5zZW5kZXIgaXMgbm90IGEgY29udHJhY3QuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSBpdCdzIAogICAgICogbm90IHBvc3NpYmxlIGZvciBhIGNvbnRyYWN0IHRvIHNwZWNpZnkgYSBnYXMgYW1vdW50IHdoZW4gY2FsbGluZyB0aGUgKGludGVybmFsKSBzZW5kKCkgCiAgICAgKiBmdW5jdGlvbi4gU29saWRpdHkgaW1wb3NlcyBhIG1heGltdW0gYW1vdW50IG9mIGdhcyAoMjMwMCBnYXMgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZykKICAgICAqIAogICAgICogQ29udHJhY3RzIGNhbiBjYWxsIHRoZSBjb250cmlidXRlKCkgZnVuY3Rpb24gaW5zdGVhZAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICoKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIGBfYmVuZWZpY2lhcnlgCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0aGF0IHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlRm9yKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KTsKfQoKCi8qKgogKiBDcm93ZHNhbGVQcm94eQogKgogKiAjY3JlYXRlZCAyMi8xMS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBDcm93ZHNhbGVQcm94eSBpcyBJQ3Jvd2RzYWxlUHJveHkgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgSUNyb3dkc2FsZSBwdWJsaWMgdGFyZ2V0OwogICAgCgogICAgLyoqCiAgICAgKiBEZXBsb3kgcHJveHkKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIE93bmVyIG9mIHRoZSBwcm94eQogICAgICogQHBhcmFtIF90YXJnZXQgVGFyZ2V0IGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBDcm93ZHNhbGVQcm94eShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfdGFyZ2V0KSBwdWJsaWMgewogICAgICAgIHRhcmdldCA9IElDcm93ZHNhbGUoX3RhcmdldCk7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBjb250cmlidXRpb24gYW5kIGZvcndhcmQgdG8gdGhlIGNyb3dkc2FsZQogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgdGFyZ2V0LmNvbnRyaWJ1dGVGb3IudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICoKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCkgewogICAgICAgIHRhcmdldC5jb250cmlidXRlRm9yLnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIGBfYmVuZWZpY2lhcnlgCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0aGF0IHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlRm9yKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdGFyZ2V0LmNvbnRyaWJ1dGVGb3IudmFsdWUobXNnLnZhbHVlKShfYmVuZWZpY2lhcnkpOwogICAgfQp9CgoKLyoqCiAqIElDcm93ZHNhbGUKICoKICogQmFzZSBjcm93ZHNhbGUgaW50ZXJmYWNlIHRvIG1hbmFnZSB0aGUgc2FsZSBvZiAKICogYW4gRVJDMjAgdG9rZW4KICoKICogI2NyZWF0ZWQgMDkvMDkvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElDcm93ZHNhbGUgewoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250cmFjdCBpcyBjdXJyZW50bHkgaW4gdGhlIHByZXNhbGUgcGhhc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgaW4gcHJlc2FsZSBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0luUHJlc2FsZVBoYXNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250cmFjdCBpcyBjdXJyZW50bHkgaW4gdGhlIGVuZGVkIHN0YWdlCiAgICAgKgogICAgICogQHJldHVybiBUcnVlIGlmIGVuZGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYF9iZW5lZmljaWFyeWAgaGFzIGEgYmFsYW5jZSBhbGxvY2F0ZWQKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgdGhlIGJhbGFuY2UgaXMgYWxsb2NhdGVkIGZvcgogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgYmFsYW5jZSBjYW4gYmUgd2l0aGRyYXduCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlcmUgaXMgYSBiYWxhbmNlIHRoYXQgYmVsb25ncyB0byBgX2JlbmVmaWNpYXJ5YAogICAgICovCiAgICBmdW5jdGlvbiBoYXNCYWxhbmNlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWxlYXNlRGF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKiAKICAgICAqIEdldCB0aGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCgogICAgLyoqIAogICAgICogR2V0IHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGFsbG9jYXRlZCBldGggYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBldGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwoKCiAgICAvKiogCiAgICAgKiBHZXQgaW52ZXN0ZWQgYW5kIHJlZnVuZGFibGUgYmFsYW5jZSBvZiBgX293bmVyYCAob25seSBjb250cmlidXRpb25zIGR1cmluZyB0aGUgSUNPIHBoYXNlIGFyZSByZWdpc3RlcmVkKQogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIHJlZnVuZGFibGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgaW52ZXN0ZWQgcmVmdW5kYWJsZSBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZGFibGVFdGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwoKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHJhdGUgYW5kIGJvbnVzIHJlbGVhc2UgZGF0ZQogICAgICoKICAgICAqIEBwYXJhbSBfcGhhc2UgVGhlIHBoYXNlIHRvIHVzZSB3aGlsZSBkZXRlcm1pbmluZyB0aGUgcmF0ZQogICAgICogQHBhcmFtIF92b2x1bWUgVGhlIGFtb3VudCB3ZWkgdXNlZCB0byBkZXRlcm1pbmUgd2hhdCB2b2x1bWUgbXVsdGlwbGllciB0byB1c2UKICAgICAqIEByZXR1cm4gVGhlIHJhdGUgdXNlZCBpbiBgX3BoYXNlYCBtdWx0aXBsaWVkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZvbHVtZSBtdWx0aXBsaWVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUodWludCBfcGhhc2UsIHVpbnQgX3ZvbHVtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogQ29udmVydCBgX3dlaWAgdG8gYW4gYW1vdW50IGluIHRva2VucyB1c2luZyAKICAgICAqIHRoZSBgX3JhdGVgCiAgICAgKgogICAgICogQHBhcmFtIF93ZWkgYW1vdW50IG9mIHdlaSB0byBjb252ZXJ0CiAgICAgKiBAcGFyYW0gX3JhdGUgcmF0ZSB0byB1c2UgZm9yIHRoZSBjb252ZXJzaW9uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gdG9Ub2tlbnModWludCBfd2VpLCB1aW50IF9yYXRlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICogCiAgICAgKiBDb250cmFjdHMgY2FuIGNhbGwgdGhlIGNvbnRyaWJ1dGUoKSBmdW5jdGlvbiBpbnN0ZWFkCiAgICAgKi8KICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlOwoKCiAgICAvKioKICAgICAqIFJlY2VpdmUgZXRoZXIgYW5kIGlzc3VlIHRva2VucyB0byB0aGUgc2VuZGVyCiAgICAgKgogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGUoKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gYF9iZW5lZmljaWFyeWAKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgcmVjZWl2ZXMgdGhlIHRva2VucwogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGVGb3IoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQpOwoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSBwdWJsaWM7CgoKICAgIC8qKgogICAgICogV2l0aGRyYXcgYWxsb2NhdGVkIGV0aGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoZXIoKSBwdWJsaWM7CgoKICAgIC8qKgogICAgICogUmVmdW5kIGluIHRoZSBjYXNlIG9mIGFuIHVuc3VjY2Vzc2Z1bCBjcm93ZHNhbGUuIFRoZSAKICAgICAqIGNyb3dkc2FsZSBpcyBjb25zaWRlcmVkIHVuc3VjY2Vzc2Z1bCBpZiBtaW5BbW91bnQgd2FzIAogICAgICogbm90IHJhaXNlZCBiZWZvcmUgZW5kIG9mIHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljOwp9CgoKLyoqCiAqIENyb3dkc2FsZQogKgogKiBBYnN0cmFjdCBiYXNlIGNyb3dkc2FsZSBjb250cmFjdCB0aGF0IG1hbmFnZXMgdGhlIHNhbGUgb2YgCiAqIGFuIEVSQzIwIHRva2VuCiAqCiAqICNjcmVhdGVkIDI5LzA5LzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBJQ3Jvd2RzYWxlLCBPd25lcnNoaXAgewoKICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBEZXBsb3lpbmcsCiAgICAgICAgRGVwbG95ZWQsCiAgICAgICAgSW5Qcm9ncmVzcywKICAgICAgICBFbmRlZAogICAgfQoKICAgIHN0cnVjdCBCYWxhbmNlIHsKICAgICAgICB1aW50IGV0aDsKICAgICAgICB1aW50IHRva2VuczsKICAgICAgICB1aW50IGluZGV4OwogICAgfQoKICAgIHN0cnVjdCBQZXJjZW50YWdlIHsKICAgICAgICB1aW50IGV0aDsKICAgICAgICB1aW50IHRva2VuczsKICAgICAgICBib29sIG92ZXJ3cml0ZVJlbGVhc2VEYXRlOwogICAgICAgIHVpbnQgZml4ZWRSZWxlYXNlRGF0ZTsKICAgICAgICB1aW50IGluZGV4OyAKICAgIH0KCiAgICBzdHJ1Y3QgUGF5b3V0IHsKICAgICAgICB1aW50IHBlcmNlbnRhZ2U7CiAgICAgICAgdWludCB2ZXN0aW5nUGVyaW9kOwogICAgfQoKICAgIHN0cnVjdCBQaGFzZSB7CiAgICAgICAgdWludCByYXRlOwogICAgICAgIHVpbnQgZW5kOwogICAgICAgIHVpbnQgYm9udXNSZWxlYXNlRGF0ZTsKICAgICAgICBib29sIHVzZVZvbHVtZU11bHRpcGxpZXI7CiAgICB9CgogICAgc3RydWN0IFZvbHVtZU11bHRpcGxpZXIgewogICAgICAgIHVpbnQgcmF0ZU11bHRpcGxpZXI7CiAgICAgICAgdWludCBib251c1JlbGVhc2VEYXRlTXVsdGlwbGllcjsKICAgIH0KCiAgICAvLyBDcm93ZHNhbGUgZGV0YWlscwogICAgdWludCBwdWJsaWMgYmFzZVJhdGU7CiAgICB1aW50IHB1YmxpYyBtaW5BbW91bnQ7IAogICAgdWludCBwdWJsaWMgbWF4QW1vdW50OyAKICAgIHVpbnQgcHVibGljIG1pbkFjY2VwdGVkQW1vdW50OwogICAgdWludCBwdWJsaWMgbWluQW1vdW50UHJlc2FsZTsgCiAgICB1aW50IHB1YmxpYyBtYXhBbW91bnRQcmVzYWxlOwogICAgdWludCBwdWJsaWMgbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlOwoKICAgIC8vIENvbXBhbnkgYWRkcmVzcwogICAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7IAoKICAgIC8vIERlbm9taW5hdG9ycwogICAgdWludCBpbnRlcm5hbCBwZXJjZW50YWdlRGVub21pbmF0b3I7CiAgICB1aW50IGludGVybmFsIHRva2VuRGVub21pbmF0b3I7CgogICAgLy8gQ3Jvd2RzYWxlIHN0YXRlCiAgICB1aW50IHB1YmxpYyBzdGFydDsKICAgIHVpbnQgcHVibGljIHByZXNhbGVFbmQ7CiAgICB1aW50IHB1YmxpYyBjcm93ZHNhbGVFbmQ7CiAgICB1aW50IHB1YmxpYyByYWlzZWQ7CiAgICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRFdGg7CiAgICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRUb2tlbnM7CiAgICBTdGFnZXMgcHVibGljIHN0YWdlOwoKICAgIC8vIFRva2VuIGNvbnRyYWN0CiAgICBJTWFuYWdlZFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICAvLyBJbnZlc3RlZCBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwcml2YXRlIGJhbGFuY2VzOwoKICAgIC8vIEFsb2NhdGVkIGJhbGFuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcodWludCA9PiBCYWxhbmNlKSkgcHJpdmF0ZSBhbGxvY2F0ZWQ7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludFtdKSBwcml2YXRlIGFsbG9jYXRlZEluZGV4OwoKICAgIC8vIFN0YWtlaG9sZGVycwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBQZXJjZW50YWdlKSBwcml2YXRlIHN0YWtlaG9sZGVyUGVyY2VudGFnZXM7CiAgICBhZGRyZXNzW10gcHJpdmF0ZSBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXg7CiAgICBQYXlvdXRbXSBwcml2YXRlIHN0YWtlaG9sZGVyc1BheW91dHM7CgogICAgLy8gQ3Jvd2RzYWxlIHBoYXNlcwogICAgUGhhc2VbXSBwcml2YXRlIHBoYXNlczsKCiAgICAvLyBWb2x1bWUgbXVsdGlwbGllcnMKICAgIG1hcHBpbmcgKHVpbnQgPT4gVm9sdW1lTXVsdGlwbGllcikgcHJpdmF0ZSB2b2x1bWVNdWx0aXBsaWVyczsKICAgIHVpbnRbXSBwcml2YXRlIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzOwoKICAgIAogICAgLyoqCiAgICAgKiBUaHJvdyBpZiBhdCBzdGFnZSBvdGhlciB0aGFuIGN1cnJlbnQgc3RhZ2UKICAgICAqIAogICAgICogQHBhcmFtIF9zdGFnZSBleHBlY3RlZCBzdGFnZSB0byB0ZXN0IGZvcgogICAgICovCiAgICBtb2RpZmllciBhdF9zdGFnZShTdGFnZXMgX3N0YWdlKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBfc3RhZ2UpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogT25seSBhZnRlciBjcm93ZHNhbGVFbmQgcGx1cyBgX3RpbWVgCiAgICAgKiAKICAgICAqIEBwYXJhbSBfdGltZSBUaW1lIHRvIHBhc3MKICAgICAqLwogICAgbW9kaWZpZXIgb25seV9hZnRlcih1aW50IF90aW1lKSB7CiAgICAgICAgcmVxdWlyZShub3cgPiBjcm93ZHNhbGVFbmQgKyBfdGltZSk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBPbmx5IGFmdGVyIGNyb3dkc2FsZQogICAgICovCiAgICBtb2RpZmllciBvbmx5X2FmdGVyX2Nyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGNyb3dkc2FsZUVuZCk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBUaHJvdyBpZiBzZW5kZXIgaXMgbm90IGJlbmVmaWNpYXJ5CiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlfYmVuZWZpY2lhcnkoKSB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvKioKICAgICAqIFN0YXJ0IGluIHRoZSBkZXBsb3lpbmcgc3RhZ2UKICAgICAqLwogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKCkgcHVibGljIHsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5EZXBsb3lpbmc7CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNyb3dkc2FsZQogICAgICoKICAgICAqIEBwYXJhbSBfc3RhcnQgVGhlIHRpbWVzdGFtcCBvZiB0aGUgc3RhcnQgZGF0ZQogICAgICogQHBhcmFtIF90b2tlbiBUaGUgdG9rZW4gdGhhdCBpcyBzb2xkCiAgICAgKiBAcGFyYW0gX3Rva2VuRGVub21pbmF0b3IgVGhlIHRva2VuIGFtb3VudCBvZiBkZWNpbWFscyB0aGF0IHRoZSB0b2tlbiB1c2VzCiAgICAgKiBAcGFyYW0gX3BlcmNlbnRhZ2VEZW5vbWluYXRvciBUaGUgcGVyY2lzaW9uIG9mIHBlcmNlbnRhZ2VzCiAgICAgKiBAcGFyYW0gX21pbkFtb3VudFByZXNhbGUgVGhlIG1pbiBjYXAgZm9yIHRoZSBwcmVzYWxlCiAgICAgKiBAcGFyYW0gX21heEFtb3VudFByZXNhbGUgVGhlIG1heCBjYXAgZm9yIHRoZSBwcmVzYWxlCiAgICAgKiBAcGFyYW0gX21pbkFjY2VwdGVkQW1vdW50UHJlc2FsZSBUaGUgbG93ZXN0IGFjY2VwdGVkIGFtb3VudCBkdXJpbmcgdGhlIHByZXNhbGUgcGhhc2UKICAgICAqIEBwYXJhbSBfbWluQW1vdW50IFRoZSBtaW4gY2FwIGZvciB0aGUgSUNPCiAgICAgKiBAcGFyYW0gX21heEFtb3VudCBUaGUgbWF4IGNhcCBmb3IgdGhlIElDTwogICAgICogQHBhcmFtIF9taW5BY2NlcHRlZEFtb3VudCBUaGUgbG93ZXN0IGFjY2VwdGVkIGFtb3VudCBkdXJpbmcgdGhlIElDTyBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cCh1aW50IF9zdGFydCwgYWRkcmVzcyBfdG9rZW4sIHVpbnQgX3Rva2VuRGVub21pbmF0b3IsIHVpbnQgX3BlcmNlbnRhZ2VEZW5vbWluYXRvciwgdWludCBfbWluQW1vdW50UHJlc2FsZSwgdWludCBfbWF4QW1vdW50UHJlc2FsZSwgdWludCBfbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlLCB1aW50IF9taW5BbW91bnQsIHVpbnQgX21heEFtb3VudCwgdWludCBfbWluQWNjZXB0ZWRBbW91bnQpIHB1YmxpYyBvbmx5X293bmVyIGF0X3N0YWdlKFN0YWdlcy5EZXBsb3lpbmcpIHsKICAgICAgICB0b2tlbiA9IElNYW5hZ2VkVG9rZW4oX3Rva2VuKTsKICAgICAgICB0b2tlbkRlbm9taW5hdG9yID0gX3Rva2VuRGVub21pbmF0b3I7CiAgICAgICAgcGVyY2VudGFnZURlbm9taW5hdG9yID0gX3BlcmNlbnRhZ2VEZW5vbWluYXRvcjsKICAgICAgICBzdGFydCA9IF9zdGFydDsKICAgICAgICBtaW5BbW91bnRQcmVzYWxlID0gX21pbkFtb3VudFByZXNhbGU7CiAgICAgICAgbWF4QW1vdW50UHJlc2FsZSA9IF9tYXhBbW91bnRQcmVzYWxlOwogICAgICAgIG1pbkFjY2VwdGVkQW1vdW50UHJlc2FsZSA9IF9taW5BY2NlcHRlZEFtb3VudFByZXNhbGU7CiAgICAgICAgbWluQW1vdW50ID0gX21pbkFtb3VudDsKICAgICAgICBtYXhBbW91bnQgPSBfbWF4QW1vdW50OwogICAgICAgIG1pbkFjY2VwdGVkQW1vdW50ID0gX21pbkFjY2VwdGVkQW1vdW50OwogICAgfQoKCiAgICAvKioKICAgICAqIFNldHVwIHJhdGVzIGFuZCBwaGFzZXMKICAgICAqCiAgICAgKiBAcGFyYW0gX2Jhc2VSYXRlIFRoZSByYXRlIHdpdGhvdXQgYm9udXMKICAgICAqIEBwYXJhbSBfcGhhc2VSYXRlcyBUaGUgcmF0ZXMgZm9yIGVhY2ggcGhhc2UKICAgICAqIEBwYXJhbSBfcGhhc2VQZXJpb2RzIFRoZSBwZXJpb2RzIHRoYXQgZWFjaCBwaGFzZSBsYXN0cyAoZmlyc3QgcGhhc2UgaXMgdGhlIHByZXNhbGUgcGhhc2UpCiAgICAgKiBAcGFyYW0gX3BoYXNlQm9udXNMb2NrdXBQZXJpb2RzIFRoZSBsb2NrdXAgcGVyaW9kIHRoYXQgZWFjaCBwaGFzZSBsYXN0cwogICAgICogQHBhcmFtIF9waGFzZVVzZXNWb2x1bWVNdWx0aXBsaWVyIFdoZXRlciBvciBub3Qgdm9sdW1lIGJvbnVzc2VzIGFyZSB1c2VkIGluIHRoZSByZXNwZWN0aXZlIHBoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwUGhhc2VzKHVpbnQgX2Jhc2VSYXRlLCB1aW50W10gX3BoYXNlUmF0ZXMsIHVpbnRbXSBfcGhhc2VQZXJpb2RzLCB1aW50W10gX3BoYXNlQm9udXNMb2NrdXBQZXJpb2RzLCBib29sW10gX3BoYXNlVXNlc1ZvbHVtZU11bHRpcGxpZXIpIHB1YmxpYyBvbmx5X293bmVyIGF0X3N0YWdlKFN0YWdlcy5EZXBsb3lpbmcpIHsKICAgICAgICBiYXNlUmF0ZSA9IF9iYXNlUmF0ZTsKICAgICAgICBwcmVzYWxlRW5kID0gc3RhcnQgKyBfcGhhc2VQZXJpb2RzWzBdOyAvLyBGaXJzdCBwaGFzZSBpcyBleHBlY3RlZCB0byBiZSB0aGUgcHJlc2FsZSBwaGFzZQogICAgICAgIGNyb3dkc2FsZUVuZCA9IHN0YXJ0OyAvLyBQbHVzIHRoZSBzdW0gb2YgdGhlIHJhdGUgcGhhc2VzCgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9waGFzZVJhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNyb3dkc2FsZUVuZCArPSBfcGhhc2VQZXJpb2RzW2ldOwogICAgICAgICAgICBwaGFzZXMucHVzaChQaGFzZShfcGhhc2VSYXRlc1tpXSwgY3Jvd2RzYWxlRW5kLCAwLCBfcGhhc2VVc2VzVm9sdW1lTXVsdGlwbGllcltpXSkpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh1aW50IGlpID0gMDsgaWkgPCBfcGhhc2VSYXRlcy5sZW5ndGg7IGlpKyspIHsKICAgICAgICAgICAgaWYgKF9waGFzZUJvbnVzTG9ja3VwUGVyaW9kc1tpaV0gPiAwKSB7CiAgICAgICAgICAgICAgICBwaGFzZXNbaWldLmJvbnVzUmVsZWFzZURhdGUgPSBjcm93ZHNhbGVFbmQgKyBfcGhhc2VCb251c0xvY2t1cFBlcmlvZHNbaWldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFNldHVwIHN0YWtlaG9sZGVycwogICAgICoKICAgICAqIEBwYXJhbSBfc3Rha2Vob2xkZXJzIFRoZSBhZGRyZXNzZXMgb2YgdGhlIHN0YWtlaG9sZGVycyAoZmlyc3Qgc3Rha2Vob2xkZXIgaXMgdGhlIGJlbmVmaWNpYXJ5KQogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlckV0aFBlcmNlbnRhZ2VzIFRoZSBldGggcGVyY2VudGFnZXMgb2YgdGhlIHN0YWtlaG9sZGVycwogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlclRva2VuUGVyY2VudGFnZXMgVGhlIHRva2VuIHBlcmNlbnRhZ2VzIG9mIHRoZSBzdGFrZWhvbGRlcnMKICAgICAqIEBwYXJhbSBfc3Rha2Vob2xkZXJUb2tlblBheW91dE92ZXJ3cml0ZVJlbGVhc2VEYXRlcyBXaGV0ZXIgdGhlIHZlc3RpbmcgcGVyaW9kIGlzIG92ZXJ3cml0dGVuIGZvciB0aGUgcmVzcGVjdGl2ZSBzdGFrZWhvbGRlcgogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0Rml4ZWRSZWxlYXNlRGF0ZXMgVGhlIHZlc3RpbmcgcGVyaW9kIGFmdGVyIHdoaWNoIHRoZSB3aG9sZSBwZXJjZW50YWdlIG9mIHRoZSB0b2tlbnMgaXMgcmVsZWFzZWQgdG8gdGhlIHJlc3BlY3RpdmUgc3Rha2Vob2xkZXIKICAgICAqIEBwYXJhbSBfc3Rha2Vob2xkZXJUb2tlblBheW91dFBlcmNlbnRhZ2VzIFRoZSBwZXJjZW50YWdlIG9mIHRoZSB0b2tlbnMgdGhhdCBpcyByZWxlYXNlZCBhdCB0aGUgcmVzcGVjdGl2ZSBkYXRlCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRWZXN0aW5nUGVyaW9kcyBUaGUgdmVzdGluZyBwZXJpb2QgYWZ0ZXIgd2hpY2ggdGhlIHJlc3BlY3RpdmUgcGVyY2VudGFnZSBvZiB0aGUgdG9rZW5zIGlzIHJlbGVhc2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwU3Rha2Vob2xkZXJzKGFkZHJlc3NbXSBfc3Rha2Vob2xkZXJzLCB1aW50W10gX3N0YWtlaG9sZGVyRXRoUGVyY2VudGFnZXMsIHVpbnRbXSBfc3Rha2Vob2xkZXJUb2tlblBlcmNlbnRhZ2VzLCBib29sW10gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRPdmVyd3JpdGVSZWxlYXNlRGF0ZXMsIHVpbnRbXSBfc3Rha2Vob2xkZXJUb2tlblBheW91dEZpeGVkUmVsZWFzZURhdGVzLCB1aW50W10gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRQZXJjZW50YWdlcywgdWludFtdIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0VmVzdGluZ1BlcmlvZHMpIHB1YmxpYyBvbmx5X293bmVyIGF0X3N0YWdlKFN0YWdlcy5EZXBsb3lpbmcpIHsKICAgICAgICBiZW5lZmljaWFyeSA9IF9zdGFrZWhvbGRlcnNbMF07IC8vIEZpcnN0IHN0YWtlaG9sZGVyIGlzIGV4cGVjdGVkIHRvIGJlIHRoZSBiZW5lZmljaWFyeQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9zdGFrZWhvbGRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4LnB1c2goX3N0YWtlaG9sZGVyc1tpXSk7CiAgICAgICAgICAgIHN0YWtlaG9sZGVyUGVyY2VudGFnZXNbX3N0YWtlaG9sZGVyc1tpXV0gPSBQZXJjZW50YWdlKAogICAgICAgICAgICAgICAgX3N0YWtlaG9sZGVyRXRoUGVyY2VudGFnZXNbaV0sIAogICAgICAgICAgICAgICAgX3N0YWtlaG9sZGVyVG9rZW5QZXJjZW50YWdlc1tpXSwgCiAgICAgICAgICAgICAgICBfc3Rha2Vob2xkZXJUb2tlblBheW91dE92ZXJ3cml0ZVJlbGVhc2VEYXRlc1tpXSwKICAgICAgICAgICAgICAgIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0Rml4ZWRSZWxlYXNlRGF0ZXNbaV0sIGkpOwogICAgICAgIH0KCiAgICAgICAgLy8gUGVyY2VudGFnZXMgYWRkIHVwIHRvIDEwMAogICAgICAgIGZvciAodWludCBpaSA9IDA7IGlpIDwgX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRQZXJjZW50YWdlcy5sZW5ndGg7IGlpKyspIHsKICAgICAgICAgICAgc3Rha2Vob2xkZXJzUGF5b3V0cy5wdXNoKFBheW91dChfc3Rha2Vob2xkZXJUb2tlblBheW91dFBlcmNlbnRhZ2VzW2lpXSwgX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRWZXN0aW5nUGVyaW9kc1tpaV0pKTsKICAgICAgICB9CiAgICB9CgogICAgCiAgICAvKioKICAgICAqIFNldHVwIHZvbHVtZSBtdWx0aXBsaWVycwogICAgICoKICAgICAqIEBwYXJhbSBfdm9sdW1lTXVsdGlwbGllclJhdGVzIFRoZSByYXRlcyB3aWxsIGJlIG11bHRpcGxpZWQgYnkgdGhpcyB2YWx1ZSAoZGVub21pbmF0ZWQgYnkgNCkKICAgICAqIEBwYXJhbSBfdm9sdW1lTXVsdGlwbGllckxvY2t1cFBlcmlvZHMgVGhlIGxvY2t1cCBwZXJpb2RzIHdpbGwgYmUgbXVsdGlwbGllZCBieSB0aGlzIHZhbHVlIChkZW5vbWluYXRlZCBieSA0KQogICAgICogQHBhcmFtIF92b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcyBUaGUgdm9sdW1lIHRocmVzaG9sZHMgZm9yIGVhY2ggcmVzcGVjdGl2ZSBtdWx0aXBsaWVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwVm9sdW1lTXVsdGlwbGllcnModWludFtdIF92b2x1bWVNdWx0aXBsaWVyUmF0ZXMsIHVpbnRbXSBfdm9sdW1lTXVsdGlwbGllckxvY2t1cFBlcmlvZHMsIHVpbnRbXSBfdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHMpIHB1YmxpYyBvbmx5X293bmVyIGF0X3N0YWdlKFN0YWdlcy5EZXBsb3lpbmcpIHsKICAgICAgICByZXF1aXJlKHBoYXNlcy5sZW5ndGggPiAwKTsKICAgICAgICB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcyA9IF92b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkczsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2b2x1bWVNdWx0aXBsaWVyc1t2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpXV0gPSBWb2x1bWVNdWx0aXBsaWVyKF92b2x1bWVNdWx0aXBsaWVyUmF0ZXNbaV0sIF92b2x1bWVNdWx0aXBsaWVyTG9ja3VwUGVyaW9kc1tpXSk7CiAgICAgICAgfQogICAgfQogICAgCgogICAgLyoqCiAgICAgKiBBZnRlciBjYWxsaW5nIHRoZSBkZXBsb3kgZnVuY3Rpb24gdGhlIGNyb3dkc2FsZQogICAgICogcnVsZXMgYmVjb21lIGltbXV0YWJsZSAKICAgICAqLwogICAgZnVuY3Rpb24gZGVwbG95KCkgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIHJlcXVpcmUocGhhc2VzLmxlbmd0aCA+IDApOwogICAgICAgIHJlcXVpcmUoc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4Lmxlbmd0aCA+IDApOwogICAgICAgIHN0YWdlID0gU3RhZ2VzLkRlcGxveWVkOwogICAgfQoKCiAgICAvKioKICAgICAqIFByb3ZlIHRoYXQgYmVuZWZpY2lhcnkgaXMgYWJsZSB0byBzaWduIHRyYW5zYWN0aW9ucyAKICAgICAqIGFuZCBzdGFydCB0aGUgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbmZpcm1CZW5lZmljaWFyeSgpIHB1YmxpYyBvbmx5X2JlbmVmaWNpYXJ5IGF0X3N0YWdlKFN0YWdlcy5EZXBsb3llZCkgewogICAgICAgIHN0YWdlID0gU3RhZ2VzLkluUHJvZ3Jlc3M7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250cmFjdCBpcyBjdXJyZW50bHkgaW4gdGhlIHByZXNhbGUgcGhhc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgaW4gcHJlc2FsZSBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0luUHJlc2FsZVBoYXNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdGFnZSA9PSBTdGFnZXMuSW5Qcm9ncmVzcyAmJiBub3cgPj0gc3RhcnQgJiYgbm93IDw9IHByZXNhbGVFbmQ7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250cmFjdCBpcyBjdXJyZW50bHkgaW4gdGhlIGVuZGVkIHN0YWdlCiAgICAgKgogICAgICogQHJldHVybiBUcnVlIGlmIGVuZGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN0YWdlID09IFN0YWdlcy5FbmRlZDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYF9iZW5lZmljaWFyeWAgaGFzIGEgYmFsYW5jZSBhbGxvY2F0ZWQKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgdGhlIGJhbGFuY2UgaXMgYWxsb2NhdGVkIGZvcgogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgYmFsYW5jZSBjYW4gYmUgd2l0aGRyYXduCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlcmUgaXMgYSBiYWxhbmNlIHRoYXQgYmVsb25ncyB0byBgX2JlbmVmaWNpYXJ5YAogICAgICovCiAgICBmdW5jdGlvbiBoYXNCYWxhbmNlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWxlYXNlRGF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhbGxvY2F0ZWRJbmRleFtfYmVuZWZpY2lhcnldLmxlbmd0aCA+IDAgJiYgX3JlbGVhc2VEYXRlID09IGFsbG9jYXRlZEluZGV4W19iZW5lZmljaWFyeV1bYWxsb2NhdGVkW19iZW5lZmljaWFyeV1bX3JlbGVhc2VEYXRlXS5pbmRleF07CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEdldCB0aGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBzdW0gPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsbG9jYXRlZEluZGV4W19vd25lcl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3VtICs9IGFsbG9jYXRlZFtfb3duZXJdW2FsbG9jYXRlZEluZGV4W19vd25lcl1baV1dLnRva2VuczsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdW07CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEdldCB0aGUgYWxsb2NhdGVkIGV0aCBiYWxhbmNlIG9mIGBfb3duZXJgCiAgICAgKiAKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYWxsb2NhdGVkIGV0aCBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAgKiBAcmV0dXJuIFRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gZXRoQmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBzdW0gPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsbG9jYXRlZEluZGV4W19vd25lcl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3VtICs9IGFsbG9jYXRlZFtfb3duZXJdW2FsbG9jYXRlZEluZGV4W19vd25lcl1baV1dLmV0aDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdW07CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEdldCBpbnZlc3RlZCBhbmQgcmVmdW5kYWJsZSBiYWxhbmNlIG9mIGBfb3duZXJgIChvbmx5IGNvbnRyaWJ1dGlvbnMgZHVyaW5nIHRoZSBJQ08gcGhhc2UgYXJlIHJlZ2lzdGVyZWQpCiAgICAgKiAKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgcmVmdW5kYWJsZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAgKiBAcmV0dXJuIFRoZSBpbnZlc3RlZCByZWZ1bmRhYmxlIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gcmVmdW5kYWJsZUV0aEJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBub3cgPiBjcm93ZHNhbGVFbmQgJiYgcmFpc2VkIDwgbWluQW1vdW50ID8gYmFsYW5jZXNbX293bmVyXSA6IDA7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY3VycmVudCBwaGFzZSBiYXNlZCBvbiB0aGUgY3VycmVudCB0aW1lCiAgICAgKgogICAgICogQHJldHVybiBUaGUgaW5kZXggb2YgdGhlIGN1cnJlbnQgcGhhc2UKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFBoYXNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobm93IDw9IHBoYXNlc1tpXS5lbmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB1aW50KC0xKTsgLy8gRG9lcyBub3QgZXhpc3QgKHVuZGVyZmxvdykKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSByYXRlIGFuZCBib251cyByZWxlYXNlIGRhdGUKICAgICAqCiAgICAgKiBAcGFyYW0gX3BoYXNlIFRoZSBwaGFzZSB0byB1c2Ugd2hpbGUgZGV0ZXJtaW5pbmcgdGhlIHJhdGUKICAgICAqIEBwYXJhbSBfdm9sdW1lIFRoZSBhbW91bnQgd2VpIHVzZWQgdG8gZGV0ZXJtaW4gd2hhdCB2b2x1bWUgbXVsdGlwbGllciB0byB1c2UKICAgICAqIEByZXR1cm4gVGhlIHJhdGUgdXNlZCBpbiBgX3BoYXNlYCBtdWx0aXBsaWVkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZvbHVtZSBtdWx0aXBsaWVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUodWludCBfcGhhc2UsIHVpbnQgX3ZvbHVtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcmF0ZSA9IDA7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5JblByb2dyZXNzICYmIG5vdyA+PSBzdGFydCkgewogICAgICAgICAgICBQaGFzZSBzdG9yYWdlIHBoYXNlID0gcGhhc2VzW19waGFzZV07CiAgICAgICAgICAgIHJhdGUgPSBwaGFzZS5yYXRlOwoKICAgICAgICAgICAgLy8gRmluZCB2b2x1bWUgbXVsdGlwbGllcgogICAgICAgICAgICBpZiAocGhhc2UudXNlVm9sdW1lTXVsdGlwbGllciAmJiB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcy5sZW5ndGggPiAwICYmIF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbMF0pIHsKICAgICAgICAgICAgICAgIGZvciAodWludCBpID0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHMubGVuZ3RoOyBpID4gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFZvbHVtZU11bHRpcGxpZXIgc3RvcmFnZSBtdWx0aXBsaWVyID0gdm9sdW1lTXVsdGlwbGllcnNbdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZSArPSBwaGFzZS5yYXRlICogbXVsdGlwbGllci5yYXRlTXVsdGlwbGllciAvIHBlcmNlbnRhZ2VEZW5vbWluYXRvcjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByYXRlOwogICAgfQoKCiAgICAvKioKICAgICAqIEdldCBkaXN0cmlidXRpb24gZGF0YSBiYXNlZCBvbiB0aGUgY3VycmVudCBwaGFzZSBhbmQgCiAgICAgKiB0aGUgdm9sdW1lIGluIHdlaSB0aGF0IGlzIGJlaW5nIGRpc3RyaWJ1dGVkCiAgICAgKiAKICAgICAqIEBwYXJhbSBfcGhhc2UgVGhlIGN1cnJlbnQgY3Jvd2RzYWxlIHBoYXNlCiAgICAgKiBAcGFyYW0gX3ZvbHVtZSBUaGUgYW1vdW50IHdlaSB1c2VkIHRvIGRldGVybWluZSB3aGF0IHZvbHVtZSBtdWx0aXBsaWVyIHRvIHVzZQogICAgICogQHJldHVybiBWb2x1bWVzIGFuZCBjb3JyZXNwb25kaW5nIHJlbGVhc2UgZGF0ZXMKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0RGlzdHJpYnV0aW9uRGF0YSh1aW50IF9waGFzZSwgdWludCBfdm9sdW1lKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnRbXSwgdWludFtdKSB7CiAgICAgICAgUGhhc2Ugc3RvcmFnZSBwaGFzZSA9IHBoYXNlc1tfcGhhc2VdOwogICAgICAgIHVpbnQgcmVtYWluaW5nVm9sdW1lID0gX3ZvbHVtZTsKCiAgICAgICAgYm9vbCB1c2luZ011bHRpcGxpZXIgPSBmYWxzZTsKICAgICAgICB1aW50W10gbWVtb3J5IHZvbHVtZXMgPSBuZXcgdWludFtdKDEpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgcmVsZWFzZURhdGVzID0gbmV3IHVpbnRbXSgxKTsKCiAgICAgICAgLy8gRmluZCB2b2x1bWUgbXVsdGlwbGllcnMKICAgICAgICBpZiAocGhhc2UudXNlVm9sdW1lTXVsdGlwbGllciAmJiB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcy5sZW5ndGggPiAwICYmIF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbMF0pIHsKICAgICAgICAgICAgdWludCBwaGFzZVJlbGVhc2VQZXJpb2QgPSBwaGFzZS5ib251c1JlbGVhc2VEYXRlIC0gY3Jvd2RzYWxlRW5kOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzLmxlbmd0aDsgaSA+IDA7IGktLSkgewogICAgICAgICAgICAgICAgaWYgKF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2luZ011bHRpcGxpZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lcyA9IG5ldyB1aW50W10oaSArIDEpOwogICAgICAgICAgICAgICAgICAgICAgICByZWxlYXNlRGF0ZXMgPSBuZXcgdWludFtdKGkgKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmdNdWx0aXBsaWVyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIFZvbHVtZU11bHRpcGxpZXIgc3RvcmFnZSBtdWx0aXBsaWVyID0gdm9sdW1lTXVsdGlwbGllcnNbdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdXTsKICAgICAgICAgICAgICAgICAgICB1aW50IHJlbGVhc2VEYXRlID0gcGhhc2UuYm9udXNSZWxlYXNlRGF0ZSArIHBoYXNlUmVsZWFzZVBlcmlvZCAqIG11bHRpcGxpZXIuYm9udXNSZWxlYXNlRGF0ZU11bHRpcGxpZXIgLyBwZXJjZW50YWdlRGVub21pbmF0b3I7CiAgICAgICAgICAgICAgICAgICAgdWludCB2b2x1bWUgPSByZW1haW5pbmdWb2x1bWUgLSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpIC0gMV07CgogICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIGluY3JlbWVudAogICAgICAgICAgICAgICAgICAgIHZvbHVtZXNbaV0gPSB2b2x1bWU7CiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZURhdGVzW2ldID0gcmVsZWFzZURhdGU7CgogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ1ZvbHVtZSAtPSB2b2x1bWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFN0b3JlIGluY3JlbWVudAogICAgICAgIHZvbHVtZXNbMF0gPSByZW1haW5pbmdWb2x1bWU7CiAgICAgICAgcmVsZWFzZURhdGVzWzBdID0gcGhhc2UuYm9udXNSZWxlYXNlRGF0ZTsKCiAgICAgICAgcmV0dXJuICh2b2x1bWVzLCByZWxlYXNlRGF0ZXMpOwogICAgfQoKCiAgICAvKioKICAgICAqIENvbnZlcnQgYF93ZWlgIHRvIGFuIGFtb3VudCBpbiB0b2tlbnMgdXNpbmcgCiAgICAgKiB0aGUgYF9yYXRlYAogICAgICoKICAgICAqIEBwYXJhbSBfd2VpIGFtb3VudCBvZiB3ZWkgdG8gY29udmVydAogICAgICogQHBhcmFtIF9yYXRlIHJhdGUgdG8gdXNlIGZvciB0aGUgY29udmVyc2lvbgogICAgICogQHJldHVybiBBbW91bnQgaW4gdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvVG9rZW5zKHVpbnQgX3dlaSwgdWludCBfcmF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfd2VpICogX3JhdGUgKiB0b2tlbkRlbm9taW5hdG9yIC8gMSBldGhlcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIEV0aCBhbmQgaXNzdWUgdG9rZW5zIHRvIHRoZSBzZW5kZXIKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyB0aGF0IG1zZy5zZW5kZXIgaXMgbm90IGEgY29udHJhY3QuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSBpdCdzIAogICAgICogbm90IHBvc3NpYmxlIGZvciBhIGNvbnRyYWN0IHRvIHNwZWNpZnkgYSBnYXMgYW1vdW50IHdoZW4gY2FsbGluZyB0aGUgKGludGVybmFsKSBzZW5kKCkgCiAgICAgKiBmdW5jdGlvbi4gU29saWRpdHkgaW1wb3NlcyBhIG1heGltdW0gYW1vdW50IG9mIGdhcyAoMjMwMCBnYXMgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZykKICAgICAqIAogICAgICogQ29udHJhY3RzIGNhbiBjYWxsIHRoZSBjb250cmlidXRlKCkgZnVuY3Rpb24gaW5zdGVhZAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHR4Lm9yaWdpbik7CiAgICAgICAgX2hhbmRsZVRyYW5zYWN0aW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIHRoZSBzZW5kZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIFRoZSBhY2NlcHRlZCBldGhlciBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gY29udHJpYnV0ZSgpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX2hhbmRsZVRyYW5zYWN0aW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIGBfYmVuZWZpY2lhcnlgCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0aGF0IHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlRm9yKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9oYW5kbGVUcmFuc2FjdGlvbihfYmVuZWZpY2lhcnksIG1zZy52YWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdG8gZW5kIHRoZSBjcm93ZHNhbGUgYnkgc2V0dGluZyAKICAgICAqIHRoZSBzdGFnZSB0byBFbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBlbmRDcm93ZHNhbGUoKSBwdWJsaWMgYXRfc3RhZ2UoU3RhZ2VzLkluUHJvZ3Jlc3MpIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGNyb3dkc2FsZUVuZCB8fCByYWlzZWQgPj0gbWF4QW1vdW50KTsKICAgICAgICByZXF1aXJlKHJhaXNlZCA+PSBtaW5BbW91bnQpOwogICAgICAgIHN0YWdlID0gU3RhZ2VzLkVuZGVkOwoKICAgICAgICAvLyBVbmxvY2sgdG9rZW4KICAgICAgICBpZiAoIXRva2VuLnVubG9jaygpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gQWxsb2NhdGUgdG9rZW5zIChubyBhbGxvY2F0aW9uIGNhbiBiZSBkb25lIGFmdGVyIHRoaXMgcGVyaW9kKQogICAgICAgIHVpbnQgdG90YWxUb2tlblN1cHBseSA9IElUb2tlbih0b2tlbikudG90YWxTdXBwbHkoKSArIGFsbG9jYXRlZFRva2VuczsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzdGFrZWhvbGRlcnNQYXlvdXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFBheW91dCBzdG9yYWdlIHAgPSBzdGFrZWhvbGRlcnNQYXlvdXRzW2ldOwogICAgICAgICAgICBfYWxsb2NhdGVTdGFrZWhvbGRlcnNUb2tlbnModG90YWxUb2tlblN1cHBseSAqIHAucGVyY2VudGFnZSAvIHBlcmNlbnRhZ2VEZW5vbWluYXRvciwgbm93ICsgcC52ZXN0aW5nUGVyaW9kKTsKICAgICAgICB9CgogICAgICAgIC8vIEFsbG9jYXRlIHJlbWFpbmluZyBFVEgKICAgICAgICBfYWxsb2NhdGVTdGFrZWhvbGRlcnNFdGgodGhpcy5iYWxhbmNlIC0gYWxsb2NhdGVkRXRoLCAwKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBXaXRoZHJhdyBhbGxvY2F0ZWQgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKCkgcHVibGljIHsKICAgICAgICB3aXRoZHJhd1Rva2Vuc1RvKG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCB0b2tlbnMKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IEFkZHJlc3MgdG8gc2VuZCB0bwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2Vuc1RvKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgewogICAgICAgIHVpbnQgdG9rZW5zVG9TZW5kID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbGxvY2F0ZWRJbmRleFttc2cuc2VuZGVyXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50IHJlbGVhc2VEYXRlID0gYWxsb2NhdGVkSW5kZXhbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgIGlmIChyZWxlYXNlRGF0ZSA8PSBub3cpIHsKICAgICAgICAgICAgICAgIEJhbGFuY2Ugc3RvcmFnZSBiID0gYWxsb2NhdGVkW21zZy5zZW5kZXJdW3JlbGVhc2VEYXRlXTsKICAgICAgICAgICAgICAgIHRva2Vuc1RvU2VuZCArPSBiLnRva2VuczsKICAgICAgICAgICAgICAgIGIudG9rZW5zID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRva2Vuc1RvU2VuZCA+IDApIHsKICAgICAgICAgICAgYWxsb2NhdGVkVG9rZW5zIC09IHRva2Vuc1RvU2VuZDsKICAgICAgICAgICAgaWYgKCF0b2tlbi5pc3N1ZShfYmVuZWZpY2lhcnksIHRva2Vuc1RvU2VuZCkpIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCBldGhlcgogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKCkgcHVibGljIHsKICAgICAgICB3aXRoZHJhd0V0aGVyVG8obXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8qKgogICAgICogV2l0aGRyYXcgYWxsb2NhdGVkIGV0aGVyCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBBZGRyZXNzIHRvIHNlbmQgdG8KICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlclRvKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgewogICAgICAgIHVpbnQgZXRoVG9TZW5kID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbGxvY2F0ZWRJbmRleFttc2cuc2VuZGVyXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50IHJlbGVhc2VEYXRlID0gYWxsb2NhdGVkSW5kZXhbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgIGlmIChyZWxlYXNlRGF0ZSA8PSBub3cpIHsKICAgICAgICAgICAgICAgIEJhbGFuY2Ugc3RvcmFnZSBiID0gYWxsb2NhdGVkW21zZy5zZW5kZXJdW3JlbGVhc2VEYXRlXTsKICAgICAgICAgICAgICAgIGV0aFRvU2VuZCArPSBiLmV0aDsKICAgICAgICAgICAgICAgIGIuZXRoID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGV0aFRvU2VuZCA+IDApIHsKICAgICAgICAgICAgYWxsb2NhdGVkRXRoIC09IGV0aFRvU2VuZDsKICAgICAgICAgICAgaWYgKCFfYmVuZWZpY2lhcnkuc2VuZChldGhUb1NlbmQpKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWZ1bmQgaW4gdGhlIGNhc2Ugb2YgYW4gdW5zdWNjZXNzZnVsIGNyb3dkc2FsZS4gVGhlIAogICAgICogY3Jvd2RzYWxlIGlzIGNvbnNpZGVyZWQgdW5zdWNjZXNzZnVsIGlmIG1pbkFtb3VudCB3YXMgCiAgICAgKiBub3QgcmFpc2VkIGJlZm9yZSBlbmQgb2YgdGhlIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgb25seV9hZnRlcl9jcm93ZHNhbGUgYXRfc3RhZ2UoU3RhZ2VzLkluUHJvZ3Jlc3MpIHsKICAgICAgICByZWZ1bmRUbyhtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWZ1bmQgaW4gdGhlIGNhc2Ugb2YgYW4gdW5zdWNjZXNzZnVsIGNyb3dkc2FsZS4gVGhlIAogICAgICogY3Jvd2RzYWxlIGlzIGNvbnNpZGVyZWQgdW5zdWNjZXNzZnVsIGlmIG1pbkFtb3VudCB3YXMgCiAgICAgKiBub3QgcmFpc2VkIGJlZm9yZSBlbmQgb2YgdGhlIGNyb3dkc2FsZQogICAgICoKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgQWRkcmVzcyB0byBzZW5kIHRvCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZFRvKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgb25seV9hZnRlcl9jcm93ZHNhbGUgYXRfc3RhZ2UoU3RhZ2VzLkluUHJvZ3Jlc3MpIHsKICAgICAgICByZXF1aXJlKHJhaXNlZCA8IG1pbkFtb3VudCk7CgogICAgICAgIHVpbnQgcmVjZWl2ZWRBbW91bnQgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7CgogICAgICAgIGlmIChyZWNlaXZlZEFtb3VudCA+IDAgJiYgIV9iZW5lZmljaWFyeS5zZW5kKHJlY2VpdmVkQW1vdW50KSkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHJlY2VpdmVkQW1vdW50OwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBGYWlsc2FmZSBhbmQgY2xlYW4tdXAgbWVjaGFuaXNtCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSBwdWJsaWMgb25seV9iZW5lZmljaWFyeSBvbmx5X2FmdGVyKDIgeWVhcnMpIHsKICAgICAgICBzZWxmZGVzdHJ1Y3QoYmVuZWZpY2lhcnkpOwogICAgfQoKCiAgICAvKioKICAgICAqIEhhbmRsZSBpbmNvbWluZyB0cmFuc2FjdGlvbgogICAgICogCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRva2VucyBhcmUgaXNzdWVkIHRvIHRoaXMgYWNjb3VudAogICAgICogQHBhcmFtIF9yZWNlaXZlZCBUaGUgYW1vdW50IHRoYXQgd2FzIHJlY2VpdmVkCiAgICAgKiBAcmV0dXJuIFRoZSBhY2NlcHRlZCBldGhlciBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gX2hhbmRsZVRyYW5zYWN0aW9uKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWNlaXZlZCkgaW50ZXJuYWwgYXRfc3RhZ2UoU3RhZ2VzLkluUHJvZ3Jlc3MpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXF1aXJlKG5vdyA+PSBzdGFydCAmJiBub3cgPD0gY3Jvd2RzYWxlRW5kKTsKICAgICAgICByZXF1aXJlKGlzQWNjZXB0aW5nQ29udHJpYnV0aW9ucygpKTsKICAgICAgICByZXF1aXJlKGlzQWNjZXB0ZWRDb250cmlidXRvcihfYmVuZWZpY2lhcnkpKTsKCiAgICAgICAgaWYgKGlzSW5QcmVzYWxlUGhhc2UoKSkgewogICAgICAgICAgICByZXR1cm4gX2hhbmRsZVByZXNhbGVUcmFuc2FjdGlvbigKICAgICAgICAgICAgICAgIF9iZW5lZmljaWFyeSwgX3JlY2VpdmVkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gX2hhbmRsZVB1YmxpY3NhbGVUcmFuc2FjdGlvbigKICAgICAgICAgICAgICAgIF9iZW5lZmljaWFyeSwgX3JlY2VpdmVkKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogSGFuZGxlIGluY29taW5nIHRyYW5zYWN0aW9uIGR1cmluZyB0aGUgcHJlc2FsZSBwaGFzZQogICAgICogCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRva2VucyBhcmUgaXNzdWVkIHRvIHRoaXMgYWNjb3VudAogICAgICogQHBhcmFtIF9yZWNlaXZlZCBUaGUgYW1vdW50IHRoYXQgd2FzIHJlY2VpdmVkCiAgICAgKiBAcmV0dXJuIFRoZSBhY2NlcHRlZCBldGhlciBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gX2hhbmRsZVByZXNhbGVUcmFuc2FjdGlvbihhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfcmVjZWl2ZWQpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoX3JlY2VpdmVkID49IG1pbkFjY2VwdGVkQW1vdW50UHJlc2FsZSk7CiAgICAgICAgcmVxdWlyZShyYWlzZWQgPCBtYXhBbW91bnRQcmVzYWxlKTsKCiAgICAgICAgdWludCBhY2NlcHRlZEFtb3VudDsKICAgICAgICBpZiAocmFpc2VkICsgX3JlY2VpdmVkID4gbWF4QW1vdW50UHJlc2FsZSkgewogICAgICAgICAgICBhY2NlcHRlZEFtb3VudCA9IG1heEFtb3VudFByZXNhbGUgLSByYWlzZWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWNjZXB0ZWRBbW91bnQgPSBfcmVjZWl2ZWQ7CiAgICAgICAgfQoKICAgICAgICByYWlzZWQgKz0gYWNjZXB0ZWRBbW91bnQ7CgogICAgICAgIC8vIER1cmluZyB0aGUgcHJlc2FsZSBwaGFzZSAtIE5vbiByZWZ1bmRhYmxlCiAgICAgICAgX2FsbG9jYXRlU3Rha2Vob2xkZXJzRXRoKGFjY2VwdGVkQW1vdW50LCAwKTsgCgogICAgICAgIC8vIElzc3VlIHRva2VucwogICAgICAgIF9kaXN0cmlidXRlVG9rZW5zKF9iZW5lZmljaWFyeSwgX3JlY2VpdmVkLCBhY2NlcHRlZEFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFjY2VwdGVkQW1vdW50OwogICAgfQoKCiAgICAvKioKICAgICAqIEhhbmRsZSBpbmNvbWluZyB0cmFuc2FjdGlvbiBkdXJpbmcgdGhlIHB1YmxpY3NhbGUgcGhhc2UKICAgICAqIAogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUb2tlbnMgYXJlIGlzc3VlZCB0byB0aGlzIGFjY291bnQKICAgICAqIEBwYXJhbSBfcmVjZWl2ZWQgVGhlIGFtb3VudCB0aGF0IHdhcyByZWNlaXZlZAogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIF9oYW5kbGVQdWJsaWNzYWxlVHJhbnNhY3Rpb24oYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3JlY2VpdmVkKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXF1aXJlKF9yZWNlaXZlZCA+PSBtaW5BY2NlcHRlZEFtb3VudCk7CiAgICAgICAgcmVxdWlyZShyYWlzZWQgPj0gbWluQW1vdW50UHJlc2FsZSk7CiAgICAgICAgcmVxdWlyZShyYWlzZWQgPCBtYXhBbW91bnQpOwoKICAgICAgICB1aW50IGFjY2VwdGVkQW1vdW50OwogICAgICAgIGlmIChyYWlzZWQgKyBfcmVjZWl2ZWQgPiBtYXhBbW91bnQpIHsKICAgICAgICAgICAgYWNjZXB0ZWRBbW91bnQgPSBtYXhBbW91bnQgLSByYWlzZWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWNjZXB0ZWRBbW91bnQgPSBfcmVjZWl2ZWQ7CiAgICAgICAgfQoKICAgICAgICByYWlzZWQgKz0gYWNjZXB0ZWRBbW91bnQ7CiAgICAgICAgCiAgICAgICAgLy8gRHVyaW5nIHRoZSBJQ08gcGhhc2UgLSAxMDAlIHJlZnVuZGFibGUKICAgICAgICBiYWxhbmNlc1tfYmVuZWZpY2lhcnldICs9IGFjY2VwdGVkQW1vdW50OyAKCiAgICAgICAgLy8gSXNzdWUgdG9rZW5zCiAgICAgICAgX2Rpc3RyaWJ1dGVUb2tlbnMoX2JlbmVmaWNpYXJ5LCBfcmVjZWl2ZWQsIGFjY2VwdGVkQW1vdW50KTsKICAgICAgICByZXR1cm4gYWNjZXB0ZWRBbW91bnQ7CiAgICB9CgoKICAgIC8qKgogICAgICogRGlzdHJpYnV0ZSB0b2tlbnMgCiAgICAgKgogICAgICogVG9rZW5zIGNhbiBiZSBpc3N1ZWQgYnkgaW5zdHJ1Y3RpbmcgdGhlIHRva2VuIGNvbnRyYWN0IHRvIGNyZWF0ZSBuZXcgdG9rZW5zIG9yIGJ5IAogICAgICogYWxsb2NhdGluZyB0b2tlbnMgYW5kIGluc3RydWN0aW5nIHRoZSB0b2tlbiBjb250cmFjdCB0byBjcmVhdGUgdGhlIHRva2VucyBsYXRlcgogICAgICogCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRva2VucyBhcmUgaXNzdWVkIHRvIHRoaXMgYWNjb3VudAogICAgICogQHBhcmFtIF9yZWNlaXZlZCBUaGUgYW1vdW50IHRoYXQgd2FzIHJlY2VpdmVkCiAgICAgKiBAcGFyYW0gX2FjY2VwdGVkQW1vdW50IFRoZSBhbW91bnQgdGhhdCB3YXMgYWNjZXB0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gX2Rpc3RyaWJ1dGVUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3JlY2VpdmVkLCB1aW50IF9hY2NlcHRlZEFtb3VudCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCB0b2tlbnNUb0lzc3VlID0gMDsKICAgICAgICB1aW50IHBoYXNlID0gZ2V0Q3VycmVudFBoYXNlKCk7CiAgICAgICAgdmFyIHJhdGUgPSBnZXRSYXRlKHBoYXNlLCBfYWNjZXB0ZWRBbW91bnQpOwogICAgICAgIGlmIChyYXRlID09IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vIFBhdXNlZCBwaGFzZQogICAgICAgIH0KCiAgICAgICAgLy8gVm9sdW1lIG11bHRpcGxpZXJzCiAgICAgICAgdmFyICh2b2x1bWVzLCByZWxlYXNlRGF0ZXMpID0gZ2V0RGlzdHJpYnV0aW9uRGF0YSgKICAgICAgICAgICAgcGhhc2UsIF9hY2NlcHRlZEFtb3VudCk7CiAgICAgICAgCiAgICAgICAgLy8gQWxsb2NhdGUgdG9rZW5zCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdm9sdW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgdG9rZW5zQXRDdXJyZW50UmF0ZSA9IHRvVG9rZW5zKHZvbHVtZXNbaV0sIHJhdGUpOwogICAgICAgICAgICBpZiAocmF0ZSA+IGJhc2VSYXRlICYmIHJlbGVhc2VEYXRlc1tpXSA+IG5vdykgewogICAgICAgICAgICAgICAgdWludCBib251c1Rva2VucyA9IHRva2Vuc0F0Q3VycmVudFJhdGUgKiAocmF0ZSAtIGJhc2VSYXRlKSAvIHJhdGU7CiAgICAgICAgICAgICAgICBfYWxsb2NhdGVUb2tlbnMoX2JlbmVmaWNpYXJ5LCBib251c1Rva2VucywgcmVsZWFzZURhdGVzW2ldKTsKCiAgICAgICAgICAgICAgICB0b2tlbnNUb0lzc3VlICs9IHRva2Vuc0F0Q3VycmVudFJhdGUgLSBib251c1Rva2VuczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRva2Vuc1RvSXNzdWUgKz0gdG9rZW5zQXRDdXJyZW50UmF0ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gSXNzdWUgdG9rZW5zCiAgICAgICAgaWYgKHRva2Vuc1RvSXNzdWUgPiAwICYmICF0b2tlbi5pc3N1ZShfYmVuZWZpY2lhcnksIHRva2Vuc1RvSXNzdWUpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmVmdW5kIGR1ZSB0byBtYXggY2FwIGhpdAogICAgICAgIGlmIChfcmVjZWl2ZWQgLSBfYWNjZXB0ZWRBbW91bnQgPiAwICYmICFfYmVuZWZpY2lhcnkuc2VuZChfcmVjZWl2ZWQgLSBfYWNjZXB0ZWRBbW91bnQpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvY2F0ZSBFVEgKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRvIGFsb2NhdGUgdGhlIGV0aCBmb3IKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgRVRIIHRvIGFsbG9jYXRlCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSBldGggY2FuIGJlIHdpdGhkcmF3bgogICAgICovICAgIAogICAgZnVuY3Rpb24gX2FsbG9jYXRlRXRoKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGhhc0JhbGFuY2UoX2JlbmVmaWNpYXJ5LCBfcmVsZWFzZURhdGUpKSB7CiAgICAgICAgICAgIGFsbG9jYXRlZFtfYmVuZWZpY2lhcnldW19yZWxlYXNlRGF0ZV0uZXRoICs9IF9hbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb2NhdGVkW19iZW5lZmljaWFyeV1bX3JlbGVhc2VEYXRlXSA9IEJhbGFuY2UoCiAgICAgICAgICAgICAgICBfYW1vdW50LCAwLCBhbGxvY2F0ZWRJbmRleFtfYmVuZWZpY2lhcnldLnB1c2goX3JlbGVhc2VEYXRlKSAtIDEpOwogICAgICAgIH0KCiAgICAgICAgYWxsb2NhdGVkRXRoICs9IF9hbW91bnQ7CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsb2NhdGUgVG9rZW5zCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0byBhbGxvY2F0ZSB0aGUgdG9rZW5zIGZvcgogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYWxsb2NhdGUKICAgICAqIEBwYXJhbSBfcmVsZWFzZURhdGUgVGhlIGRhdGUgYWZ0ZXIgd2hpY2ggdGhlIHRva2VucyBjYW4gYmUgd2l0aGRyYXduCiAgICAgKi8gICAgCiAgICBmdW5jdGlvbiBfYWxsb2NhdGVUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX2Ftb3VudCwgdWludCBfcmVsZWFzZURhdGUpIGludGVybmFsIHsKICAgICAgICBpZiAoaGFzQmFsYW5jZShfYmVuZWZpY2lhcnksIF9yZWxlYXNlRGF0ZSkpIHsKICAgICAgICAgICAgYWxsb2NhdGVkW19iZW5lZmljaWFyeV1bX3JlbGVhc2VEYXRlXS50b2tlbnMgKz0gX2Ftb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvY2F0ZWRbX2JlbmVmaWNpYXJ5XVtfcmVsZWFzZURhdGVdID0gQmFsYW5jZSgKICAgICAgICAgICAgICAgIDAsIF9hbW91bnQsIGFsbG9jYXRlZEluZGV4W19iZW5lZmljaWFyeV0ucHVzaChfcmVsZWFzZURhdGUpIC0gMSk7CiAgICAgICAgfQoKICAgICAgICBhbGxvY2F0ZWRUb2tlbnMgKz0gX2Ftb3VudDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvY2F0ZSBFVEggZm9yIHN0YWtlaG9sZGVycwogICAgICoKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgRVRIIHRvIGFsbG9jYXRlCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSBldGggY2FuIGJlIHdpdGhkcmF3bgogICAgICovICAgIAogICAgZnVuY3Rpb24gX2FsbG9jYXRlU3Rha2Vob2xkZXJzRXRoKHVpbnQgX2Ftb3VudCwgdWludCBfcmVsZWFzZURhdGUpIGludGVybmFsIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXgubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgUGVyY2VudGFnZSBzdG9yYWdlIHAgPSBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzW3N0YWtlaG9sZGVyUGVyY2VudGFnZXNJbmRleFtpXV07CiAgICAgICAgICAgIGlmIChwLmV0aCA+IDApIHsKICAgICAgICAgICAgICAgIF9hbGxvY2F0ZUV0aChzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXhbaV0sIF9hbW91bnQgKiBwLmV0aCAvIHBlcmNlbnRhZ2VEZW5vbWluYXRvciwgX3JlbGVhc2VEYXRlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvY2F0ZSBUb2tlbnMgZm9yIHN0YWtlaG9sZGVycwogICAgICoKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBfcmVsZWFzZURhdGUgVGhlIGRhdGUgYWZ0ZXIgd2hpY2ggdGhlIHRva2VucyBjYW4gYmUgd2l0aGRyYXduICh1bmxlc3Mgb3ZlcndpdHRlbikKICAgICAqLyAgICAKICAgIGZ1bmN0aW9uIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc1Rva2Vucyh1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBpbnRlcm5hbCB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFBlcmNlbnRhZ2Ugc3RvcmFnZSBwID0gc3Rha2Vob2xkZXJQZXJjZW50YWdlc1tzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXhbaV1dOwogICAgICAgICAgICBpZiAocC50b2tlbnMgPiAwKSB7CiAgICAgICAgICAgICAgICBfYWxsb2NhdGVUb2tlbnMoCiAgICAgICAgICAgICAgICAgICAgc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4W2ldLCAKICAgICAgICAgICAgICAgICAgICBfYW1vdW50ICogcC50b2tlbnMgLyBwZXJjZW50YWdlRGVub21pbmF0b3IsIAogICAgICAgICAgICAgICAgICAgIHAub3ZlcndyaXRlUmVsZWFzZURhdGUgPyBwLmZpeGVkUmVsZWFzZURhdGUgOiBfcmVsZWFzZURhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIEFsbG93cyB0aGUgaW1wbGVtZW50aW5nIGNvbnRyYWN0IHRvIHZhbGlkYXRlIGEgCiAgICAgKiBjb250cmlidXRpbmcgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfY29udHJpYnV0b3IgQWRkcmVzcyB0aGF0IGlzIGJlaW5nIHZhbGlkYXRlZAogICAgICogQHJldHVybiBXaGV0ZXIgdGhlIGNvbnRyaWJ1dG9yIGlzIGFjY2VwdGVkIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBpc0FjY2VwdGVkQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogQWxsb3dzIHRoZSBpbXBsZW1lbnRpbmcgY29udHJhY3QgdG8gcHJldmVudCB0aGUgYWNjZXB0aW5nIAogICAgICogb2YgY29udHJpYnV0aW9ucwogICAgICoKICAgICAqIEByZXR1cm4gV2hldGVyIGNvbnRyaWJ1dGlvbnMgYXJlIGFjY2VwdGVkIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBpc0FjY2VwdGluZ0NvbnRyaWJ1dGlvbnMoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgoKLyoqCiAqIE1veHlPbmUgQ3Jvd2RzYWxlCiAqCiAqIEFkdmFuY2luZyB0aGUgYmxvY2tjaGFpbiBpbmR1c3RyeSBieSBjcmVhdGluZyBzZWFtbGVzcyBhbmQgc2VjdXJlIGRlYml0IGNhcmQgCiAqIGFuZCBwYXltZW50IGluZnJhc3RydWN0dXJlIGZvciBldmVyeSBjb21wYW55LCBwcm9qZWN0IGFuZCBJQ08gdGhhdCBpc3N1ZXMgY3J5cHRvY3VycmVuY3kgdG9rZW5zLiAKICoKICogI2NyZWF0ZWQgMDYvMDEvMjAxOAogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KY29udHJhY3QgTW94eU9uZUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIFRva2VuUmV0cmlldmVyLCBJUGF1c2FibGUsIElBdXRoZW50aWNhdGlvbk1hbmFnZXIsIElXaW5nc0FkYXB0ZXIgewoKICAgIC8vIFN0YXRlCiAgICBib29sIHByaXZhdGUgcGF1c2VkOwoKICAgIC8vIEF1dGhlbnRpY2F0aW9uCiAgICBJQXV0aGVudGljYXRvciBwcml2YXRlIGF1dGhlbnRpY2F0b3I7CiAgICBib29sIHByaXZhdGUgcmVxdWlyZUF1dGhlbnRpY2F0aW9uOwoKCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgaW1wbGVtZW50aW5nIGNvbnRyYWN0IGlzIAogICAgICogY3VycmVudGx5IHBhdXNlZCBvciBub3QKICAgICAqCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIHBhdXNlZCBzdGF0ZSBpcyBhY3RpdmUKICAgICAqLwogICAgZnVuY3Rpb24gaXNQYXVzZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHBhdXNlZDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHN0YXRlIHRvIHBhdXNlZAogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIHB1YmxpYyBvbmx5X293bmVyIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICAqIENoYW5nZSB0aGUgc3RhdGUgdG8gcmVzdW1lLCB1bmRvIHRoZSBlZmZlY3RzIAogICAgICogb2YgY2FsbGluZyBwYXVzZQogICAgICovCiAgICBmdW5jdGlvbiByZXN1bWUoKSBwdWJsaWMgb25seV9vd25lciB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgYXV0aGVudGljYXRpb24KICAgICAqCiAgICAgKiBAcGFyYW0gX2F1dGhlbnRpY2F0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIGF1dGhlbnRpY2F0b3IgKHdoaXRlbGlzdCkKICAgICAqIEBwYXJhbSBfcmVxdWlyZUF1dGhlbnRpY2F0aW9uIFdldGhlciB0aGUgY3Jvd2RhbGUgcmVxdWlyZXMgY29udHJpYnV0b3JzIHRvIGJlIGF1dGhlbnRpY2F0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBBdXRoZW50aWNhdGlvbihhZGRyZXNzIF9hdXRoZW50aWNhdG9yLCBib29sIF9yZXF1aXJlQXV0aGVudGljYXRpb24pIHB1YmxpYyBvbmx5X293bmVyIGF0X3N0YWdlKFN0YWdlcy5EZXBsb3lpbmcpIHsKICAgICAgICBhdXRoZW50aWNhdG9yID0gSUF1dGhlbnRpY2F0b3IoX2F1dGhlbnRpY2F0b3IpOwogICAgICAgIHJlcXVpcmVBdXRoZW50aWNhdGlvbiA9IF9yZXF1aXJlQXV0aGVudGljYXRpb247CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIGF1dGhlbnRpY2F0aW9uIGlzIGVuYWJsZWQgYW5kIGZhbHNlIAogICAgICogb3RoZXJ3aXNlCiAgICAgKgogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSBjb252ZXJ0ZXIgaXMgY3VycmVudGx5IGF1dGhlbnRpY2F0aW5nIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0aW5nKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiByZXF1aXJlQXV0aGVudGljYXRpb247CiAgICB9CgoKICAgIC8qKgogICAgICogRW5hYmxlIGF1dGhlbnRpY2F0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVuYWJsZUF1dGhlbnRpY2F0aW9uKCkgcHVibGljIG9ubHlfb3duZXIgewogICAgICAgIHJlcXVpcmVBdXRoZW50aWNhdGlvbiA9IHRydWU7CiAgICB9CgoKICAgIC8qKgogICAgICogRGlzYWJsZSBhdXRoZW50aWNhdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQXV0aGVudGljYXRpb24oKSBwdWJsaWMgb25seV9vd25lciB7CiAgICAgICAgcmVxdWlyZUF1dGhlbnRpY2F0aW9uID0gZmFsc2U7CiAgICB9CgoKICAgIC8qKgogICAgICogVmFsaWRhdGUgYSBjb250cmlidXRpbmcgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfY29udHJpYnV0b3IgQWRkcmVzcyB0aGF0IGlzIGJlaW5nIHZhbGlkYXRlZAogICAgICogQHJldHVybiBXaGV0ZXIgdGhlIGNvbnRyaWJ1dG9yIGlzIGFjY2VwdGVkIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBpc0FjY2VwdGVkQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAhcmVxdWlyZUF1dGhlbnRpY2F0aW9uIHx8IGF1dGhlbnRpY2F0b3IuYXV0aGVudGljYXRlKF9jb250cmlidXRvcik7CiAgICB9CgoKICAgIC8qKgogICAgICogSW5kaWNhdGUgaWYgY29udHJpYnV0aW9ucyBhcmUgY3VycmVudGx5IGFjY2VwdGVkCiAgICAgKgogICAgICogQHJldHVybiBXaGV0ZXIgY29udHJpYnV0aW9ucyBhcmUgYWNjZXB0ZWQgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzQWNjZXB0aW5nQ29udHJpYnV0aW9ucygpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAhcGF1c2VkOwogICAgfQoKCiAgICAvKioKICAgICAqIFdpbmdzIGludGVncmF0aW9uIC0gR2V0IHRoZSB0b3RhbCByYWlzZWQgYW1vdW50IG9mIEV0aGVyCiAgICAgKgogICAgICogQ2FuIG9ubHkgaW5jcmVhc2VkLCBtZWFucyBpZiB5b3Ugd2l0aGRyYXcgRVRIIGZyb20gdGhlIHdhbGxldCwgc2hvdWxkIGJlIG5vdCBtb2RpZmllZCAoeW91IGNhbiB1c2UgdHdvIGZpZWxkcyAKICAgICAqIHRvIGtlZXAgb25lIHdpdGggYSB0b3RhbCBhY2N1bXVsYXRlZCBhbW91bnQpIGFtb3VudCBvZiBFVEggaW4gY29udHJhY3QgYW5kIHRvdGFsQ29sbGVjdGVkIGZvciB0b3RhbCBhbW91bnQgb2YgRVRIIGNvbGxlY3RlZAogICAgICoKICAgICAqIEByZXR1cm4gVG90YWwgcmFpc2VkIEV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbENvbGxlY3RlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcmFpc2VkOwogICAgfQoKCiAgICAvKioKICAgICAqIEZhaWxzYWZlIG1lY2hhbmlzbQogICAgICogCiAgICAgKiBBbGxvd3MgdGhlIG93bmVyIHRvIHJldHJpZXZlIHRva2VucyBmcm9tIHRoZSBjb250cmFjdCB0aGF0IAogICAgICogbWlnaHQgaGF2ZSBiZWVuIHNlbmQgdGhlcmUgYnkgYWNjaWRlbnQKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyaWV2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KSBwdWJsaWMgb25seV9vd25lciB7CiAgICAgICAgc3VwZXIucmV0cmlldmVUb2tlbnMoX3Rva2VuQ29udHJhY3QpOwoKICAgICAgICAvLyBSZXRyaWV2ZSB0b2tlbnMgZnJvbSBvdXIgdG9rZW4gY29udHJhY3QKICAgICAgICBJVG9rZW5SZXRyaWV2ZXIodG9rZW4pLnJldHJpZXZlVG9rZW5zKF90b2tlbkNvbnRyYWN0KTsKICAgIH0KfQ=='.
	

]
