Class {
	#name : #SRTd4160356a4e81f008b86f9867e71d1e1404c5292,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd4160356a4e81f008b86f9867e71d1e1404c5292 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8vIDxPUkFDTElaRV9BUEk+Ci8qCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTApDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFRECgoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKCgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7Ly9wbGVhc2UgaW1wb3J0IG9yYWNsaXplQVBJX3ByZTAuNC5zb2wgd2hlbiBzb2xpZGl0eSA8IDAuNC4wCgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gdXNlQ291cG9uKHN0cmluZyBfY291cG9uKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOwogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7CiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSk7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKICAgIAogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKGFkZHJlc3MoT0FSKT09MCkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzYjI2MzhhN2NjOWYyY2IzZDI5OGEzZGE3YTkwYjY3ZTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM2EyNjE1ZDVlZmFmNWY0OWY2MGI3YmI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNhMjYxNWQ1ZWZhZjVmNDlmNjBiN2JiNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRQcm9vZlR5cGUocHJvb2ZQKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfSAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gcGFyc2VBZGRyKHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsKICAgICAgICB1aW50MTYwIGIxOwogICAgICAgIHVpbnQxNjAgYjI7CiAgICAgICAgZm9yICh1aW50IGk9MjsgaTwyKzIqMjA7IGkrPTIpewogICAgICAgICAgICBpYWRkciAqPSAyNTY7CiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOwogICAgICAgICAgICBiMiA9IHVpbnQxNjAodG1wW2krMV0pOwogICAgICAgICAgICBpZiAoKGIxID49IDk3KSYmKGIxIDw9IDEwMikpIGIxIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgfSAKCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpCiAgICB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGggPSBieXRlcyhfaGF5c3RhY2spOwogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7CiAgICAgICAgaWYoaC5sZW5ndGggPCAxIHx8IG4ubGVuZ3RoIDwgMSB8fCAobi5sZW5ndGggPiBoLmxlbmd0aCkpIAogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfSAgIAogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9ICAgCiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOwogICAgICAgIHVpbnQgaiA9IGk7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgd2hpbGUgKGogIT0gMCl7CiAgICAgICAgICAgIGxlbisrOwogICAgICAgICAgICBqIC89IDEwOwogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOwogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7CiAgICAgICAgd2hpbGUgKGkgIT0gMCl7CiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOwogICAgICAgICAgICBpIC89IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOwogICAgfQogICAgCiAgICAKCn0KLy8gPC9PUkFDTElaRV9BUEk+Cgpjb250cmFjdCBEaWNlIGlzIHVzaW5nT3JhY2xpemUgewoKICAgIHVpbnQgY29uc3RhbnQgcHdpbiA9IDc1MDA7IC8vcHJvYmFiaWxpdHkgb2Ygd2lubmluZyAoMTAwMDAgPSAxMDAlKQogICAgdWludCBjb25zdGFudCBlZGdlID0gMTkwOyAvL2VkZ2UgcGVyY2VudGFnZSAoMTAwMDAgPSAxMDAlKQogICAgdWludCBjb25zdGFudCBtYXhXaW4gPSAxMDA7IC8vbWF4IHdpbiAoYmVmb3JlIGVkZ2UgaXMgdGFrZW4pIGFzIHBlcmNlbnRhZ2Ugb2YgYmFua3JvbGwgKDEwMDAwID0gMTAwJSkKICAgIHVpbnQgY29uc3RhbnQgbWluQmV0ID0gMjAwIGZpbm5leTsKICAgIHVpbnQgY29uc3RhbnQgbWF4SW52ZXN0b3JzID0gMTA7IC8vbWF4aW11bSBudW1iZXIgb2YgaW52ZXN0b3JzCiAgICB1aW50IGNvbnN0YW50IGhvdXNlRWRnZSA9IDI1OyAvL2VkZ2UgcGVyY2VudGFnZSAoMTAwMDAgPSAxMDAlKQogICAgdWludCBjb25zdGFudCBkaXZlc3RGZWUgPSA1MDsgLy9kaXZlc3QgZmVlIHBlcmNlbnRhZ2UgKDEwMDAwID0gMTAwJSkKICAgIHVpbnQgY29uc3RhbnQgZW1lcmdlbmN5V2l0aGRyYXdhbFJhdGlvID0gMTA7IC8vcmF0aW8gcGVyY2VudGFnZSAoMTAwID0gMTAwJSkKCiAgICB1aW50IHNhZmVHYXMgPSAyMzAwOwogICAgdWludCBjb25zdGFudCBPUkFDTElaRV9HQVNfTElNSVQgPSAxNzUwMDA7CiAgICB1aW50IGNvbnN0YW50IElOVkFMSURfQkVUX01BUktFUiA9IDk5OTk5OwogICAgdWludCBjb25zdGFudCBFTUVSR0VOQ1lfVElNRU9VVCA9IDMgZGF5czsKCiAgICBzdHJ1Y3QgSW52ZXN0b3IgewogICAgICAgIGFkZHJlc3MgaW52ZXN0b3JBZGRyZXNzOwogICAgICAgIHVpbnQgYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgYm9vbCB2b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWw7CiAgICB9CgogICAgc3RydWN0IEJldCB7CiAgICAgICAgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzOwogICAgICAgIHVpbnQgYW1vdW50QmV0OwogICAgICAgIHVpbnQgbnVtYmVyUm9sbGVkOwogICAgfQoKICAgIHN0cnVjdCBXaXRoZHJhd2FsUHJvcG9zYWwgewogICAgICAgIGFkZHJlc3MgdG9BZGRyZXNzOwogICAgICAgIHVpbnQgYXRUaW1lOwogICAgfQoKICAgIC8vU3RhcnRpbmcgYXQgMQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RvcklEczsKICAgIG1hcHBpbmcodWludCA9PiBJbnZlc3RvcikgcHVibGljIGludmVzdG9yczsKICAgIHVpbnQgcHVibGljIG51bUludmVzdG9ycyA9IDA7CgogICAgdWludCBwdWJsaWMgaW52ZXN0ZWQgPSAwOwoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgaG91c2VBZGRyZXNzOwogICAgYm9vbCBwdWJsaWMgaXNTdG9wcGVkOwoKICAgIFdpdGhkcmF3YWxQcm9wb3NhbCBwdWJsaWMgcHJvcG9zZWRXaXRoZHJhd2FsOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gQmV0KSBwdWJsaWMgYmV0czsKICAgIGJ5dGVzMzJbXSBwdWJsaWMgYmV0c0tleXM7CgogICAgdWludCBwdWJsaWMgaW52ZXN0b3JzUHJvZml0ID0gMDsKICAgIHVpbnQgcHVibGljIGludmVzdG9yc0xvc3NlcyA9IDA7CiAgICBib29sIHByb2ZpdERpc3RyaWJ1dGVkOwoKICAgIGV2ZW50IExPR19OZXdCZXQoYWRkcmVzcyBwbGF5ZXJBZGRyZXNzLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfQmV0V29uKGFkZHJlc3MgcGxheWVyQWRkcmVzcywgdWludCBudW1iZXJSb2xsZWQsIHVpbnQgYW1vdW50V29uKTsKICAgIGV2ZW50IExPR19CZXRMb3N0KGFkZHJlc3MgcGxheWVyQWRkcmVzcywgdWludCBudW1iZXJSb2xsZWQpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxQcm9wb3NlZCgpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxGYWlsZWQoYWRkcmVzcyB3aXRoZHJhd2FsQWRkcmVzcyk7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFN1Y2NlZWRlZChhZGRyZXNzIHdpdGhkcmF3YWxBZGRyZXNzLCB1aW50IGFtb3VudFdpdGhkcmF3bik7CiAgICBldmVudCBMT0dfRmFpbGVkU2VuZChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfWmVyb1NlbmQoKTsKICAgIGV2ZW50IExPR19JbnZlc3RvckVudHJhbmNlKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExPR19JbnZlc3RvckNhcGl0YWxVcGRhdGUoYWRkcmVzcyBpbnZlc3RvciwgaW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfSW52ZXN0b3JFeGl0KGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExPR19Db250cmFjdFN0b3BwZWQoKTsKICAgIGV2ZW50IExPR19Db250cmFjdFJlc3VtZWQoKTsKICAgIGV2ZW50IExPR19Pd25lckFkZHJlc3NDaGFuZ2VkKGFkZHJlc3Mgb2xkQWRkciwgYWRkcmVzcyBuZXdPd25lckFkZHJlc3MpOwogICAgZXZlbnQgTE9HX0hvdXNlQWRkcmVzc0NoYW5nZWQoYWRkcmVzcyBvbGRBZGRyLCBhZGRyZXNzIG5ld0hvdXNlQWRkcmVzcyk7CiAgICBldmVudCBMT0dfR2FzTGltaXRDaGFuZ2VkKHVpbnQgb2xkR2FzTGltaXQsIHVpbnQgbmV3R2FzTGltaXQpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeUF1dG9TdG9wKCk7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFZvdGUoYWRkcmVzcyBpbnZlc3RvciwgYm9vbCB2b3RlKTsKICAgIGV2ZW50IExPR19WYWx1ZUlzVG9vQmlnKCk7CiAgICBldmVudCBMT0dfU3VjY2Vzc2Z1bFNlbmQoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCk7CgogICAgZnVuY3Rpb24gRGljZSgpIHsKICAgICAgICBvcmFjbGl6ZV9zZXRQcm9vZihwcm9vZlR5cGVfVExTTm90YXJ5IHwgcHJvb2ZTdG9yYWdlX0lQRlMpOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBob3VzZUFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vU0VDVElPTiBJOiBNT0RJRklFUlMgQU5EIEhFTFBFUiBGVU5DVElPTlMKCiAgICAvL01PRElGSUVSUwoKICAgIG1vZGlmaWVyIG9ubHlJZk5vdFN0b3BwZWQgewogICAgICAgIGlmIChpc1N0b3BwZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmU3RvcHBlZCB7CiAgICAgICAgaWYgKCFpc1N0b3BwZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUludmVzdG9ycyB7CiAgICAgICAgaWYgKGludmVzdG9ySURzW21zZy5zZW5kZXJdID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU5vdEludmVzdG9ycyB7CiAgICAgICAgaWYgKGludmVzdG9ySURzW21zZy5zZW5kZXJdICE9IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICBpZiAob3duZXIgIT0gbXNnLnNlbmRlcikgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3JhY2xpemUgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG9yYWNsaXplX2NiQWRkcmVzcygpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlNb3JlVGhhbk1pbkludmVzdG1lbnQgewogICAgICAgIGlmIChtc2cudmFsdWUgPD0gZ2V0TWluSW52ZXN0bWVudCgpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlNb3JlVGhhblplcm8gewogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZCZXRFeGlzdChieXRlczMyIG15aWQpIHsKICAgICAgICBpZihiZXRzW215aWRdLnBsYXllckFkZHJlc3MgPT0gYWRkcmVzcygweDApKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZkJldFNpemVJc1N0aWxsQ29ycmVjdChieXRlczMyIG15aWQpIHsKICAgICAgICBpZiAoKCgoYmV0c1tteWlkXS5hbW91bnRCZXQgKiAoKDEwMDAwIC0gZWRnZSkgLSBwd2luKSkgLyBwd2luICkgPD0gKG1heFdpbiAqIGdldEJhbmtyb2xsKCkpIC8gMTAwMDApICAmJiAoYmV0c1tteWlkXS5hbW91bnRCZXQgPj0gbWluQmV0KSkgewogICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGJldHNbbXlpZF0ubnVtYmVyUm9sbGVkID0gSU5WQUxJRF9CRVRfTUFSS0VSOwogICAgICAgICAgICBzYWZlU2VuZChiZXRzW215aWRdLnBsYXllckFkZHJlc3MsIGJldHNbbXlpZF0uYW1vdW50QmV0KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZWYWxpZFJvbGwoYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgdWludCBudW1iZXJSb2xsZWQgPSBwYXJzZUludChyZXN1bHQpOwogICAgICAgIGlmICgobnVtYmVyUm9sbGVkIDwgMSB8fCBudW1iZXJSb2xsZWQgPiAxMDAwMCkgJiYgYmV0c1tteWlkXS5udW1iZXJSb2xsZWQgPT0gMCkgewogICAgICAgICAgICBiZXRzW215aWRdLm51bWJlclJvbGxlZCA9IElOVkFMSURfQkVUX01BUktFUjsKICAgICAgICAgICAgc2FmZVNlbmQoYmV0c1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBiZXRzW215aWRdLmFtb3VudEJldCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2lubmluZ0JldHModWludCBudW1iZXJSb2xsZWQpIHsKICAgICAgICBpZiAobnVtYmVyUm9sbGVkIC0gMSA8IHB3aW4pIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgbW9kaWZpZXIgb25seUxvc2luZ0JldHModWludCBudW1iZXJSb2xsZWQpIHsKICAgICAgICBpZiAobnVtYmVyUm9sbGVkIC0gMSA+PSBwd2luKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBZnRlclByb3Bvc2VkIHsKICAgICAgICBpZiAocHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcyA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZlByb2ZpdE5vdERpc3RyaWJ1dGVkIHsKICAgICAgICBpZiAoIXByb2ZpdERpc3RyaWJ1dGVkKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZlZhbGlkR2FzKHVpbnQgbmV3R2FzTGltaXQpIHsKICAgICAgICBpZiAoT1JBQ0xJWkVfR0FTX0xJTUlUICsgbmV3R2FzTGltaXQgPCBPUkFDTElaRV9HQVNfTElNSVQpIHRocm93OwogICAgICAgIGlmIChuZXdHYXNMaW1pdCA8IDI1MDAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZk5vdFByb2Nlc3NlZChieXRlczMyIG15aWQpIHsKICAgICAgICBpZiAoYmV0c1tteWlkXS5udW1iZXJSb2xsZWQgPiAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZkVtZXJnZW5jeVRpbWVPdXRIYXNQYXNzZWQgewogICAgICAgIGlmIChwcm9wb3NlZFdpdGhkcmF3YWwuYXRUaW1lICsgRU1FUkdFTkNZX1RJTUVPVVQgPiBub3cpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaW52ZXN0b3JzSW52YXJpYW50IHsKICAgICAgICBfOwogICAgICAgIGlmIChudW1JbnZlc3RvcnMgPiBtYXhJbnZlc3RvcnMpIHRocm93OwogICAgfQoKICAgIC8vQ09OU1RBTlQgSEVMUEVSIEZVTkNUSU9OUwoKICAgIGZ1bmN0aW9uIGdldEJhbmtyb2xsKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICBpZiAoKGludmVzdGVkIDwgaW52ZXN0b3JzUHJvZml0KSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBpbnZlc3RvcnNQcm9maXQgPCBpbnZlc3RlZCkgfHwKICAgICAgICAgICAgKGludmVzdGVkICsgaW52ZXN0b3JzUHJvZml0IDwgaW52ZXN0b3JzTG9zc2VzKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbnZlc3RlZCArIGludmVzdG9yc1Byb2ZpdCAtIGludmVzdG9yc0xvc3NlczsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWluSW52ZXN0bWVudCgpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgaWYgKG51bUludmVzdG9ycyA9PSBtYXhJbnZlc3RvcnMpIHsKICAgICAgICAgICAgdWludCBpbnZlc3RvcklEID0gc2VhcmNoU21hbGxlc3RJbnZlc3RvcigpOwogICAgICAgICAgICByZXR1cm4gZ2V0QmFsYW5jZShpbnZlc3RvcnNbaW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRTdGF0dXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50KSB7CgogICAgICAgIHVpbnQgYmFua3JvbGwgPSBnZXRCYW5rcm9sbCgpOwogICAgICAgIHVpbnQgbWluSW52ZXN0bWVudCA9IGdldE1pbkludmVzdG1lbnQoKTsKICAgICAgICByZXR1cm4gKGJhbmtyb2xsLCBwd2luLCBlZGdlLCBtYXhXaW4sIG1pbkJldCwgKGludmVzdG9yc1Byb2ZpdCAtIGludmVzdG9yc0xvc3NlcyksIG1pbkludmVzdG1lbnQsIGJldHNLZXlzLmxlbmd0aCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QmV0KHVpbnQgaWQpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKGFkZHJlc3MsIHVpbnQsIHVpbnQpIHsKCiAgICAgICAgaWYgKGlkIDwgYmV0c0tleXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGJ5dGVzMzIgYmV0S2V5ID0gYmV0c0tleXNbaWRdOwogICAgICAgICAgICByZXR1cm4gKGJldHNbYmV0S2V5XS5wbGF5ZXJBZGRyZXNzLCBiZXRzW2JldEtleV0uYW1vdW50QmV0LCBiZXRzW2JldEtleV0ubnVtYmVyUm9sbGVkKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbnVtQmV0cygpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIGJldHNLZXlzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNaW5CZXRBbW91bnQoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIHVpbnQgb3JhY2xpemVGZWUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSkuZ2V0UHJpY2UoIlVSTCIsIE9SQUNMSVpFX0dBU19MSU1JVCArIHNhZmVHYXMpOwogICAgICAgIHJldHVybiBvcmFjbGl6ZUZlZSArIG1pbkJldDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNYXhCZXRBbW91bnQoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIHVpbnQgb3JhY2xpemVGZWUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSkuZ2V0UHJpY2UoIlVSTCIsIE9SQUNMSVpFX0dBU19MSU1JVCArIHNhZmVHYXMpOwogICAgICAgIHVpbnQgYmV0VmFsdWUgPSAgKG1heFdpbiAqIGdldEJhbmtyb2xsKCkpICogcHdpbiAvICgxMDAwMCAqICgxMDAwMCAtIGVkZ2UgLSBwd2luKSk7CiAgICAgICAgcmV0dXJuIGJldFZhbHVlICsgb3JhY2xpemVGZWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TG9zc2VzU2hhcmUoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHJldHVybiBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXV0uYW1vdW50SW52ZXN0ZWQgKiAoaW52ZXN0b3JzTG9zc2VzKSAvIGludmVzdGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFByb2ZpdFNoYXJlKGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICByZXR1cm4gaW52ZXN0b3JzW2ludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl1dLmFtb3VudEludmVzdGVkICogKGludmVzdG9yc1Byb2ZpdCkgLyBpbnZlc3RlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICB1aW50IGludmVzdGVkID0gaW52ZXN0b3JzW2ludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl1dLmFtb3VudEludmVzdGVkOwogICAgICAgIHVpbnQgcHJvZml0ID0gZ2V0UHJvZml0U2hhcmUoY3VycmVudEludmVzdG9yKTsKICAgICAgICB1aW50IGxvc3NlcyA9IGdldExvc3Nlc1NoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CgogICAgICAgIGlmICgoaW52ZXN0ZWQgKyBwcm9maXQgPCBwcm9maXQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIHByb2ZpdCA8IGludmVzdGVkKSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBwcm9maXQgPCBsb3NzZXMpKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBpbnZlc3RlZCArIHByb2ZpdCAtIGxvc3NlczsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWFyY2hTbWFsbGVzdEludmVzdG9yKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICB1aW50IGludmVzdG9ySUQgPSAxOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBpZiAoZ2V0QmFsYW5jZShpbnZlc3RvcnNbaV0uaW52ZXN0b3JBZGRyZXNzKSA8IGdldEJhbGFuY2UoaW52ZXN0b3JzW2ludmVzdG9ySURdLmludmVzdG9yQWRkcmVzcykpIHsKICAgICAgICAgICAgICAgIGludmVzdG9ySUQgPSBpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaW52ZXN0b3JJRDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPcmFjbGl6ZVByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgaWYgKF9wcm9vZlR5cGUgPT0gMHgwMCkgdGhyb3c7CiAgICAgICAgb3JhY2xpemVfc2V0UHJvb2YoIF9wcm9vZlR5cGUgfCAgcHJvb2ZTdG9yYWdlX0lQRlMgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPcmFjbGl6ZUNvbmZpZyhieXRlczMyIF9jb25maWcpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgb3JhY2xpemVfc2V0Q29uZmlnKF9jb25maWcpOwogICAgfQoKICAgIC8vIFBSSVZBVEUgSEVMUEVSUyBGVU5DVElPTgoKICAgIGZ1bmN0aW9uIHNhZmVTZW5kKGFkZHJlc3MgYWRkciwgdWludCB2YWx1ZSkKICAgICAgICBwcml2YXRlIHsKCiAgICAgICAgaWYgKHZhbHVlID09IDApIHsKICAgICAgICAgICAgTE9HX1plcm9TZW5kKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPCB2YWx1ZSkgewogICAgICAgICAgICBMT0dfVmFsdWVJc1Rvb0JpZygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIShhZGRyLmNhbGwuZ2FzKHNhZmVHYXMpLnZhbHVlKHZhbHVlKSgpKSkgewogICAgICAgICAgICBMT0dfRmFpbGVkU2VuZChhZGRyLCB2YWx1ZSk7CiAgICAgICAgICAgIGlmIChhZGRyICE9IGhvdXNlQWRkcmVzcykgewogICAgICAgICAgICAgICAgLy9Gb3J3YXJkIHRvIGhvdXNlIGFkZHJlc3MgYWxsIGNoYW5nZQogICAgICAgICAgICAgICAgaWYgKCEoaG91c2VBZGRyZXNzLmNhbGwuZ2FzKHNhZmVHYXMpLnZhbHVlKHZhbHVlKSgpKSkgTE9HX0ZhaWxlZFNlbmQoaG91c2VBZGRyZXNzLCB2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIExPR19TdWNjZXNzZnVsU2VuZChhZGRyLHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRJbnZlc3RvckF0SUQodWludCBpZCkKICAgICAgICBwcml2YXRlIHsKCiAgICAgICAgaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl0gPSBpZDsKICAgICAgICBpbnZlc3RvcnNbaWRdLmludmVzdG9yQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgaW52ZXN0b3JzW2lkXS5hbW91bnRJbnZlc3RlZCA9IG1zZy52YWx1ZTsKICAgICAgICBpbnZlc3RlZCArPSBtc2cudmFsdWU7CgogICAgICAgIExPR19JbnZlc3RvckVudHJhbmNlKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvZml0RGlzdHJpYnV0aW9uKCkKICAgICAgICBwcml2YXRlCiAgICAgICAgb25seUlmUHJvZml0Tm90RGlzdHJpYnV0ZWQgewoKICAgICAgICB1aW50IGNvcHlJbnZlc3RlZDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgY3VycmVudEludmVzdG9yID0gaW52ZXN0b3JzW2ldLmludmVzdG9yQWRkcmVzczsKICAgICAgICAgICAgdWludCBwcm9maXRPZkludmVzdG9yID0gZ2V0UHJvZml0U2hhcmUoY3VycmVudEludmVzdG9yKTsKICAgICAgICAgICAgdWludCBsb3NzZXNPZkludmVzdG9yID0gZ2V0TG9zc2VzU2hhcmUoY3VycmVudEludmVzdG9yKTsKICAgICAgICAgICAgLy9DaGVjayBmb3Igb3ZlcmZsb3cgYW5kIHVuZGVyZmxvdwogICAgICAgICAgICBpZiAoKGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCArIHByb2ZpdE9mSW52ZXN0b3IgPj0gaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkKSAmJgogICAgICAgICAgICAgICAgKGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCArIHByb2ZpdE9mSW52ZXN0b3IgPj0gbG9zc2VzT2ZJbnZlc3RvcikpICB7CiAgICAgICAgICAgICAgICBpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQgKz0gcHJvZml0T2ZJbnZlc3RvciAtIGxvc3Nlc09mSW52ZXN0b3I7CiAgICAgICAgICAgICAgICBMT0dfSW52ZXN0b3JDYXBpdGFsVXBkYXRlKGN1cnJlbnRJbnZlc3RvciwgKGludCkgKHByb2ZpdE9mSW52ZXN0b3IgLSBsb3NzZXNPZkludmVzdG9yKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgTE9HX0VtZXJnZW5jeUF1dG9TdG9wKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb3B5SW52ZXN0ZWQgKyBpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQgPj0gY29weUludmVzdGVkKQogICAgICAgICAgICAgICAgY29weUludmVzdGVkICs9IGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZDsKICAgICAgICB9CgogICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNQcm9maXQ7CiAgICAgICAgZGVsZXRlIGludmVzdG9yc0xvc3NlczsKICAgICAgICBpbnZlc3RlZCA9IGNvcHlJbnZlc3RlZDsKCiAgICAgICAgcHJvZml0RGlzdHJpYnV0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIFNFQ1RJT04gSUk6IEJFVCAmIEJFVCBQUk9DRVNTSU5HCgogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUgewoKICAgICAgICBiZXQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBiZXQoKQogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5SWZOb3RTdG9wcGVkIHsKCiAgICAgICAgdWludCBvcmFjbGl6ZUZlZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKS5nZXRQcmljZSgiVVJMIiwgT1JBQ0xJWkVfR0FTX0xJTUlUICsgc2FmZUdhcyk7CiAgICAgICAgaWYgKG9yYWNsaXplRmVlID49IG1zZy52YWx1ZSkgdGhyb3c7CiAgICAgICAgdWludCBiZXRWYWx1ZSA9IG1zZy52YWx1ZSAtIG9yYWNsaXplRmVlOwogICAgICAgIGlmICgoKChiZXRWYWx1ZSAqICgoMTAwMDAgLSBlZGdlKSAtIHB3aW4pKSAvIHB3aW4gKSA8PSAobWF4V2luICogZ2V0QmFua3JvbGwoKSkgLyAxMDAwMCkgJiYgKGJldFZhbHVlID49IG1pbkJldCkpIHsKICAgICAgICAgICAgTE9HX05ld0JldChtc2cuc2VuZGVyLCBiZXRWYWx1ZSk7CiAgICAgICAgICAgIGJ5dGVzMzIgbXlpZCA9CiAgICAgICAgICAgICAgICBvcmFjbGl6ZV9xdWVyeSgKICAgICAgICAgICAgICAgICAgICAibmVzdGVkIiwKICAgICAgICAgICAgICAgICAgICAiW1VSTF0gWydqc29uKGh0dHBzOi8vYXBpLnJhbmRvbS5vcmcvanNvbi1ycGMvMS9pbnZva2UpLnJlc3VsdC5yYW5kb20uZGF0YS4wJywgJ1xcbntcImpzb25ycGNcIjpcIjIuMFwiLFwibWV0aG9kXCI6XCJnZW5lcmF0ZVNpZ25lZEludGVnZXJzXCIsXCJwYXJhbXNcIjp7XCJhcGlLZXlcIjoke1tkZWNyeXB0XSBCTGVESGpkY1lNbm5ka0xxNTlzRjBZRG03bU1zamNYRWZNNWZsRWQvNUNqVjdxV0IrSmlIUzhvT0h2NFlacngwc25zYnFwQVZNNzBNTW84aUUyMWRyTHZKN1dhQlpJTDNnT0JxUEVQR0h1U2ZiaVQ1WndrMFBsNFdOS2RpTHdlNFJrQjlWazQvUlR2em1SeHdjMUhNcCtmWlREUy8wM2s9fSxcIm5cIjoxLFwibWluXCI6MSxcIm1heFwiOjEwMDAwJHtbaWRlbnRpdHldIFwifVwifSxcImlkXCI6MSR7W2lkZW50aXR5XSBcIn1cIn0nXSIsCiAgICAgICAgICAgICAgICAgICAgT1JBQ0xJWkVfR0FTX0xJTUlUICsgc2FmZUdhcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgYmV0c1tteWlkXSA9IEJldChtc2cuc2VuZGVyLCBiZXRWYWx1ZSwgMCk7CiAgICAgICAgICAgIGJldHNLZXlzLnB1c2gobXlpZCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKQogICAgICAgIG9ubHlPcmFjbGl6ZQogICAgICAgIG9ubHlJZkJldEV4aXN0KG15aWQpCiAgICAgICAgb25seUlmTm90UHJvY2Vzc2VkKG15aWQpCiAgICAgICAgb25seUlmVmFsaWRSb2xsKG15aWQsIHJlc3VsdCkKICAgICAgICBvbmx5SWZCZXRTaXplSXNTdGlsbENvcnJlY3QobXlpZCkgIHsKCiAgICAgICAgdWludCBudW1iZXJSb2xsZWQgPSBwYXJzZUludChyZXN1bHQpOwogICAgICAgIGJldHNbbXlpZF0ubnVtYmVyUm9sbGVkID0gbnVtYmVyUm9sbGVkOwogICAgICAgIGlzV2lubmluZ0JldChiZXRzW215aWRdLCBudW1iZXJSb2xsZWQpOwogICAgICAgIGlzTG9zaW5nQmV0KGJldHNbbXlpZF0sIG51bWJlclJvbGxlZCk7CiAgICAgICAgZGVsZXRlIHByb2ZpdERpc3RyaWJ1dGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzV2lubmluZ0JldChCZXQgdGhpc0JldCwgdWludCBudW1iZXJSb2xsZWQpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG9ubHlXaW5uaW5nQmV0cyhudW1iZXJSb2xsZWQpIHsKCiAgICAgICAgdWludCB3aW5BbW91bnQgPSAodGhpc0JldC5hbW91bnRCZXQgKiAoMTAwMDAgLSBlZGdlKSkgLyBwd2luOwogICAgICAgIExPR19CZXRXb24odGhpc0JldC5wbGF5ZXJBZGRyZXNzLCBudW1iZXJSb2xsZWQsIHdpbkFtb3VudCk7CiAgICAgICAgc2FmZVNlbmQodGhpc0JldC5wbGF5ZXJBZGRyZXNzLCB3aW5BbW91bnQpOwoKICAgICAgICAvL0NoZWNrIGZvciBvdmVyZmxvdyBhbmQgdW5kZXJmbG93CiAgICAgICAgaWYgKChpbnZlc3RvcnNMb3NzZXMgKyB3aW5BbW91bnQgPCBpbnZlc3RvcnNMb3NzZXMpIHx8CiAgICAgICAgICAgIChpbnZlc3RvcnNMb3NzZXMgKyB3aW5BbW91bnQgPCB0aGlzQmV0LmFtb3VudEJldCkpIHsKICAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgICB9CgogICAgICAgIGludmVzdG9yc0xvc3NlcyArPSB3aW5BbW91bnQgLSB0aGlzQmV0LmFtb3VudEJldDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0xvc2luZ0JldChCZXQgdGhpc0JldCwgdWludCBudW1iZXJSb2xsZWQpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG9ubHlMb3NpbmdCZXRzKG51bWJlclJvbGxlZCkgewoKICAgICAgICBMT0dfQmV0TG9zdCh0aGlzQmV0LnBsYXllckFkZHJlc3MsIG51bWJlclJvbGxlZCk7CiAgICAgICAgc2FmZVNlbmQodGhpc0JldC5wbGF5ZXJBZGRyZXNzLCAxKTsKCiAgICAgICAgLy9DaGVjayBmb3Igb3ZlcmZsb3cgYW5kIHVuZGVyZmxvdwogICAgICAgIGlmICgoaW52ZXN0b3JzUHJvZml0ICsgdGhpc0JldC5hbW91bnRCZXQgPCBpbnZlc3RvcnNQcm9maXQpIHx8CiAgICAgICAgICAgIChpbnZlc3RvcnNQcm9maXQgKyB0aGlzQmV0LmFtb3VudEJldCA8IHRoaXNCZXQuYW1vdW50QmV0KSB8fAogICAgICAgICAgICAodGhpc0JldC5hbW91bnRCZXQgPT0gMSkpIHsKICAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgICB9CgogICAgICAgIHVpbnQgdG90YWxQcm9maXQgPSBpbnZlc3RvcnNQcm9maXQgKyAodGhpc0JldC5hbW91bnRCZXQgLSAxKTsgLy9hZGRlZCBiYXNlZCBvbiBhdWRpdCBmZWVkYmFjawogICAgICAgIGludmVzdG9yc1Byb2ZpdCArPSAodGhpc0JldC5hbW91bnRCZXQgLSAxKSooMTAwMDAgLSBob3VzZUVkZ2UpLzEwMDAwOwogICAgICAgIHVpbnQgaG91c2VQcm9maXQgPSB0b3RhbFByb2ZpdCAtIGludmVzdG9yc1Byb2ZpdDsgLy9jaGFuZ2VkIGJhc2VkIG9uIGF1ZGl0IGZlZWRiYWNrCiAgICAgICAgc2FmZVNlbmQoaG91c2VBZGRyZXNzLCBob3VzZVByb2ZpdCk7CiAgICB9CgogICAgLy9TRUNUSU9OIElJSTogSU5WRVNUICYgRElWRVNUCgogICAgZnVuY3Rpb24gaW5jcmVhc2VJbnZlc3RtZW50KCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgb25seUlmTm90U3RvcHBlZAogICAgICAgIG9ubHlNb3JlVGhhblplcm8KICAgICAgICBvbmx5SW52ZXN0b3JzICB7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbigpOwogICAgICAgIGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0uYW1vdW50SW52ZXN0ZWQgKz0gbXNnLnZhbHVlOwogICAgICAgIGludmVzdGVkICs9IG1zZy52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBuZXdJbnZlc3RvcigpCiAgICAgICAgcGF5YWJsZQogICAgICAgIG9ubHlJZk5vdFN0b3BwZWQKICAgICAgICBvbmx5TW9yZVRoYW5aZXJvCiAgICAgICAgb25seU5vdEludmVzdG9ycwogICAgICAgIG9ubHlNb3JlVGhhbk1pbkludmVzdG1lbnQKICAgICAgICBpbnZlc3RvcnNJbnZhcmlhbnQgewoKICAgICAgICBwcm9maXREaXN0cmlidXRpb24oKTsKCiAgICAgICAgaWYgKG51bUludmVzdG9ycyA9PSBtYXhJbnZlc3RvcnMpIHsKICAgICAgICAgICAgdWludCBzbWFsbGVzdEludmVzdG9ySUQgPSBzZWFyY2hTbWFsbGVzdEludmVzdG9yKCk7CiAgICAgICAgICAgIGRpdmVzdChpbnZlc3RvcnNbc21hbGxlc3RJbnZlc3RvcklEXS5pbnZlc3RvckFkZHJlc3MpOwogICAgICAgIH0KCiAgICAgICAgbnVtSW52ZXN0b3JzKys7CiAgICAgICAgYWRkSW52ZXN0b3JBdElEKG51bUludmVzdG9ycyk7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2ZXN0KCkKICAgICAgICBvbmx5SW52ZXN0b3JzIHsKCiAgICAgICAgZGl2ZXN0KG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICBmdW5jdGlvbiBkaXZlc3QoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIGludmVzdG9yc0ludmFyaWFudCB7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbigpOwogICAgICAgIHVpbnQgY3VycmVudElEID0gaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXTsKICAgICAgICB1aW50IGFtb3VudFRvUmV0dXJuID0gZ2V0QmFsYW5jZShjdXJyZW50SW52ZXN0b3IpOwoKICAgICAgICBpZiAoKGludmVzdGVkID49IGludmVzdG9yc1tjdXJyZW50SURdLmFtb3VudEludmVzdGVkKSkgewogICAgICAgICAgICBpbnZlc3RlZCAtPSBpbnZlc3RvcnNbY3VycmVudElEXS5hbW91bnRJbnZlc3RlZDsKICAgICAgICAgICAgdWludCBkaXZlc3RGZWVBbW91bnQgPSAgKGFtb3VudFRvUmV0dXJuKmRpdmVzdEZlZSkvMTAwMDA7CiAgICAgICAgICAgIGFtb3VudFRvUmV0dXJuIC09IGRpdmVzdEZlZUFtb3VudDsKCiAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbY3VycmVudElEXTsKICAgICAgICAgICAgZGVsZXRlIGludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl07CgogICAgICAgICAgICAvL1Jlb3JkZXIgaW52ZXN0b3JzCiAgICAgICAgICAgIGlmIChjdXJyZW50SUQgIT0gbnVtSW52ZXN0b3JzKSB7CiAgICAgICAgICAgICAgICAvLyBHZXQgbGFzdCBpbnZlc3RvcgogICAgICAgICAgICAgICAgSW52ZXN0b3IgbGFzdEludmVzdG9yID0gaW52ZXN0b3JzW251bUludmVzdG9yc107CiAgICAgICAgICAgICAgICAvL1NldCBsYXN0IGludmVzdG9yIElEIHRvIGludmVzdG9ySUQgb2YgZGl2ZXN0aW5nIGFjY291bnQKICAgICAgICAgICAgICAgIGludmVzdG9ySURzW2xhc3RJbnZlc3Rvci5pbnZlc3RvckFkZHJlc3NdID0gY3VycmVudElEOwogICAgICAgICAgICAgICAgLy9Db3B5IGludmVzdG9yIGF0IHRoZSBuZXcgcG9zaXRpb24gaW4gdGhlIG1hcHBpbmcKICAgICAgICAgICAgICAgIGludmVzdG9yc1tjdXJyZW50SURdID0gbGFzdEludmVzdG9yOwogICAgICAgICAgICAgICAgLy9EZWxldGUgb2xkIHBvc2l0aW9uIGluIHRoZSBtYXBwcGluZwogICAgICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tudW1JbnZlc3RvcnNdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBudW1JbnZlc3RvcnMtLTsKICAgICAgICAgICAgc2FmZVNlbmQoY3VycmVudEludmVzdG9yLCBhbW91bnRUb1JldHVybik7CiAgICAgICAgICAgIHNhZmVTZW5kKGhvdXNlQWRkcmVzcywgZGl2ZXN0RmVlQW1vdW50KTsKICAgICAgICAgICAgTE9HX0ludmVzdG9yRXhpdChjdXJyZW50SW52ZXN0b3IsIGFtb3VudFRvUmV0dXJuKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlOwogICAgICAgICAgICBMT0dfRW1lcmdlbmN5QXV0b1N0b3AoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZm9yY2VEaXZlc3RPZkFsbEludmVzdG9ycygpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgdWludCBjb3B5TnVtSW52ZXN0b3JzID0gbnVtSW52ZXN0b3JzOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBjb3B5TnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgZGl2ZXN0KGludmVzdG9yc1sxXS5pbnZlc3RvckFkZHJlc3MpOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgVGhlIG93bmVyIGNhbiB1c2UgdGhpcyBmdW5jdGlvbiB0byBmb3JjZSB0aGUgZXhpdCBvZiBhbiBpbnZlc3RvciBmcm9tIHRoZQogICAgY29udHJhY3QgZHVyaW5nIGFuIGVtZXJnZW5jeSB3aXRoZHJhd2FsIGluIHRoZSBmb2xsb3dpbmcgc2l0dWF0aW9uczoKICAgICAgICAtIFVucmVzcG9uc2l2ZSBpbnZlc3RvcgogICAgICAgIC0gSW52ZXN0b3IgZGVtYW5kaW5nIHRvIGJlIHBhaWQgaW4gb3RoZXIgdG8gdm90ZSwgdGhlIGZhY3RvLWJsYWNrbWFpbGluZwogICAgICAgIG90aGVyIGludmVzdG9ycwogICAgKi8KICAgIGZ1bmN0aW9uIGZvcmNlRGl2ZXN0T2ZPbmVJbnZlc3RvcihhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5SWZTdG9wcGVkIHsKCiAgICAgICAgZGl2ZXN0KGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgLy9SZXNldHMgZW1lcmdlbmN5IHdpdGhkcmF3YWwgcHJvcG9zYWwuIEludmVzdG9ycyBtdXN0IHZvdGUgYWdhaW4KICAgICAgICBkZWxldGUgcHJvcG9zZWRXaXRoZHJhd2FsOwogICAgfQoKICAgIC8vU0VDVElPTiBJVjogQ09OVFJBQ1QgTUFOQUdFTUVOVAoKICAgIGZ1bmN0aW9uIHN0b3BDb250cmFjdCgpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgaXNTdG9wcGVkID0gdHJ1ZTsKICAgICAgICBMT0dfQ29udHJhY3RTdG9wcGVkKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVzdW1lQ29udHJhY3QoKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIGlzU3RvcHBlZCA9IGZhbHNlOwogICAgICAgIExPR19Db250cmFjdFJlc3VtZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VIb3VzZUFkZHJlc3MoYWRkcmVzcyBuZXdIb3VzZSkKICAgICAgICBvbmx5T3duZXIgewoKICAgICAgICBpZiAobmV3SG91c2UgPT0gYWRkcmVzcygweDApKSB0aHJvdzsgLy9jaGFuZ2VkIGJhc2VkIG9uIGF1ZGl0IGZlZWRiYWNrCiAgICAgICAgaG91c2VBZGRyZXNzID0gbmV3SG91c2U7CiAgICAgICAgTE9HX0hvdXNlQWRkcmVzc0NoYW5nZWQoaG91c2VBZGRyZXNzLCBuZXdIb3VzZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlT3duZXJBZGRyZXNzKGFkZHJlc3MgbmV3T3duZXIpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgaWYgKG5ld093bmVyID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICBMT0dfT3duZXJBZGRyZXNzQ2hhbmdlZChvd25lciwgbmV3T3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZUdhc0xpbWl0T2ZTYWZlU2VuZCh1aW50IG5ld0dhc0xpbWl0KQogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlJZlZhbGlkR2FzKG5ld0dhc0xpbWl0KSB7CgogICAgICAgIHNhZmVHYXMgPSBuZXdHYXNMaW1pdDsKICAgICAgICBMT0dfR2FzTGltaXRDaGFuZ2VkKHNhZmVHYXMsIG5ld0dhc0xpbWl0KTsKICAgIH0KCiAgICAvL1NFQ1RJT04gVjogRU1FUkdFTkNZIFdJVEhEUkFXQUwKCiAgICBmdW5jdGlvbiB2b3RlRW1lcmdlbmN5V2l0aGRyYXdhbChib29sIHZvdGUpCiAgICAgICAgb25seUludmVzdG9ycwogICAgICAgIG9ubHlBZnRlclByb3Bvc2VkCiAgICAgICAgb25seUlmU3RvcHBlZCB7CgogICAgICAgIGludmVzdG9yc1tpbnZlc3RvcklEc1ttc2cuc2VuZGVyXV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsID0gdm90ZTsKICAgICAgICBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFZvdGUobXNnLnNlbmRlciwgdm90ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvcG9zZUVtZXJnZW5jeVdpdGhkcmF3YWwoYWRkcmVzcyB3aXRoZHJhd2FsQWRkcmVzcykKICAgICAgICBvbmx5SWZTdG9wcGVkCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgLy9SZXNldHMgcHJldmlvdXMgdm90ZXMKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gbnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tpXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWw7CiAgICAgICAgfQoKICAgICAgICBwcm9wb3NlZFdpdGhkcmF3YWwgPSBXaXRoZHJhd2FsUHJvcG9zYWwod2l0aGRyYXdhbEFkZHJlc3MsIG5vdyk7CiAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxQcm9wb3NlZCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4ZWN1dGVFbWVyZ2VuY3lXaXRoZHJhd2FsKCkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5QWZ0ZXJQcm9wb3NlZAogICAgICAgIG9ubHlJZlN0b3BwZWQKICAgICAgICBvbmx5SWZFbWVyZ2VuY3lUaW1lT3V0SGFzUGFzc2VkIHsKCiAgICAgICAgdWludCBudW1PZlZvdGVzSW5GYXZvdXI7CiAgICAgICAgdWludCBhbW91bnRUb1dpdGhkcmF3ID0gdGhpcy5iYWxhbmNlOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gbnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGludmVzdG9yc1tpXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWwgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgbnVtT2ZWb3Rlc0luRmF2b3VyKys7CiAgICAgICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JzW2ldLnZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG51bU9mVm90ZXNJbkZhdm91ciA+PSBlbWVyZ2VuY3lXaXRoZHJhd2FsUmF0aW8gKiBudW1JbnZlc3RvcnMgLyAxMDApIHsKICAgICAgICAgICAgaWYgKCFwcm9wb3NlZFdpdGhkcmF3YWwudG9BZGRyZXNzLnNlbmQoYW1vdW50VG9XaXRoZHJhdykpIHsKICAgICAgICAgICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsRmFpbGVkKHByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxTdWNjZWVkZWQocHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcywgYW1vdW50VG9XaXRoZHJhdyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgIH0KCn0='.
	

]
