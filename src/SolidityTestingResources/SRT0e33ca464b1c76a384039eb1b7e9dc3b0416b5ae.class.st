Class {
	#name : #SRT0e33ca464b1c76a384039eb1b7e9dc3b0416b5ae,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0e33ca464b1c76a384039eb1b7e9dc3b0416b5ae >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgovLyBFUkMyMCB0b2tlbiBpbnRlcmZhY2UgaXMgaW1wbGVtZW50ZWQgb25seSBwYXJ0aWFsbHkuCmludGVyZmFjZSB0b2tlblJlY2lwaWVudCB7IGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsgfQoKY29udHJhY3QgTmFtaVBvb2wgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIGZ1bmN0aW9uIE5hbWlQb29sKGFkZHJlc3MgX2VzY3JvdywgYWRkcmVzcyBfbmFtaU11bHRpU2lnV2FsbGV0LCBhZGRyZXNzIF9uYW1pQWRkcmVzcykgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9uYW1pTXVsdGlTaWdXYWxsZXQgIT0gMHgwKTsKICAgICAgICBlc2Nyb3cgPSBfZXNjcm93OwogICAgICAgIG5hbWlNdWx0aVNpZ1dhbGxldCA9IF9uYW1pTXVsdGlTaWdXYWxsZXQ7CiAgICAgICAgTmFtaUFkZHIgPSBfbmFtaUFkZHJlc3M7CiAgICB9CiAgICAKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJOYW1pIFBvb2wiOwogICAgCiAgICAvLyBlc2Nyb3cgaGFzIGV4Y2x1c2l2ZSBwcml2ZWxlZ2VzIHRvIGNhbGwgYWRtaW5pc3RyYXRpdmUKICAgIC8vIGZ1bmN0aW9ucyBvbiB0aGlzIGNvbnRyYWN0LgogICAgYWRkcmVzcyBwdWJsaWMgZXNjcm93OwoKICAgIC8vIEdhdGhlcmVkIGZ1bmRzIGNhbiBiZSB3aXRoZHJhdyBvbmx5IHRvIG5hbWltdWx0aXNpZ3dhbGxldCdzIGFkZHJlc3MuCiAgICBhZGRyZXNzIHB1YmxpYyBuYW1pTXVsdGlTaWdXYWxsZXQ7CiAgICAKICAgIC8vLyBhZGRyZXNzIG9mIE5hbWkgdG9rZW4KICAgIGFkZHJlc3MgcHVibGljIE5hbWlBZGRyOwogICAgCiAgICBtb2RpZmllciBvbmx5RXNjcm93KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBlc2Nyb3cpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlOYW1pIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gTmFtaUFkZHIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlOYW1pTXVsdGlzaWcgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuYW1pTXVsdGlTaWdXYWxsZXQpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIHVpbnQgcHVibGljIGN1cnJlbnRSb3VuZCA9IDE7CiAgICAKICAgIHN0cnVjdCBTaGFyZUhvbGRlciB7CiAgICAgICAgdWludCBzdGFrZTsKICAgICAgICBib29sIGlzQWN0aXZlOwogICAgICAgIGJvb2wgaXNXaXRoZHJhd247CiAgICB9CiAgICAKICAgIHN0cnVjdCBSb3VuZCB7CiAgICAgICAgYm9vbCBpc09wZW47CiAgICAgICAgdWludCBjdXJyZW50TkFDOwogICAgICAgIHVpbnQgZmluYWxOQUM7CiAgICAgICAgdWludCBldGhCYWxhbmNlOwogICAgICAgIGJvb2wgd2l0aGRyYXdhYmxlOyAvL2ZvciB1c2VyIG5vdCBpbiB0b3AKICAgICAgICBib29sIHRvcFdpdGhkcmF3YWJsZTsKICAgICAgICBib29sIGlzQ29tcGxldGVBY3RpdmU7CiAgICAgICAgYm9vbCBpc0Nsb3NlRXRoUG9vbDsKICAgIH0KICAgIAogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nIChhZGRyZXNzID0+IFNoYXJlSG9sZGVyKSkgcHVibGljIG5hbWlQb29sOwogICAgbWFwcGluZyAodWludCA9PiBSb3VuZCkgcHVibGljIHJvdW5kOwogICAgCiAgICAKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVXBkYXRlU2hhcmVIb2xkZXIoYWRkcmVzcyBpbmRleGVkIFNoYXJlSG9sZGVyQWRkcmVzcywgdWludCBpbmRleGVkIFJvdW5kSW5kZXgsIHVpbnQgU3Rha2UsIHVpbnQgVGltZSk7CiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3Mgc2VuZGVyLHVpbnQgaW5kZXhlZCBSb3VuZEluZGV4LCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IFdpdGhkcmF3UG9vbCh1aW50IEFtb3VudCwgdWludCBUaW1lV2l0aGRyYXcpOwogICAgZXZlbnQgVXBkYXRlQWN0aXZlKGFkZHJlc3MgaW5kZXhlZCBTaGFyZUhvbGRlckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBSb3VuZEluZGV4LCBib29sIFN0YXR1cywgdWludCBUaW1lKTsKICAgIGV2ZW50IFdpdGhkcmF3KGFkZHJlc3MgaW5kZXhlZCBTaGFyZUhvbGRlckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBSb3VuZEluZGV4LCB1aW50IEV0aGVyLCB1aW50IE5hYywgdWludCBUaW1lV2l0aGRyYXcpOwogICAgZXZlbnQgQWN0aXZhdGVSb3VuZCh1aW50IFJvdW5kSW5kZXgsIHVpbnQgVGltZUFjdGl2ZSk7CiAgICAKICAgIAogICAgZnVuY3Rpb24gY2hhbmdlRXNjcm93KGFkZHJlc3MgX2VzY3JvdykKICAgICAgICBvbmx5TmFtaU11bHRpc2lnCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShfZXNjcm93ICE9IDB4MCk7CiAgICAgICAgZXNjcm93ID0gX2VzY3JvdzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcih1aW50IF9hbW91bnQpIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKG5hbWlNdWx0aVNpZ1dhbGxldCAhPSAweDApOwogICAgICAgIC8vIAogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIG5hbWlNdWx0aVNpZ1dhbGxldC50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3TkFDKHVpbnQgX2Ftb3VudCkgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUobmFtaU11bHRpU2lnV2FsbGV0ICE9IDB4MCAmJiBfYW1vdW50ICE9IDApOwogICAgICAgIE5hbWlDcm93ZFNhbGUgbmFtaVRva2VuID0gTmFtaUNyb3dkU2FsZShOYW1pQWRkcik7CiAgICAgICAgaWYgKG5hbWlUb2tlbi5iYWxhbmNlT2YodGhpcykgPiAwKSB7CiAgICAgICAgICAgIG5hbWlUb2tlbi50cmFuc2ZlcihuYW1pTXVsdGlTaWdXYWxsZXQsIF9hbW91bnQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgCiAgICAvKi8KICAgICAqICBBZG1pbiBmdW5jdGlvbgogICAgLyovCiAgICAKICAgIC8qLyBwcm9jZXNzIG9mIG9uZSByb3VuZAogICAgICogc3RlcCAxOiBhZG1pbiBvcGVuIG9uZSByb3VuZCBieSBleGVjdXRlIGFjdGl2YXRlUm91bmQgZnVuY3Rpb24KICAgICAqIHN0ZXAgMjogbm93IGludmVzdG9yIGNhbiBpbnZlc3QgTmFjIHRvIE5hYyBQb29sIHVudGlsIHJvdW5kIGNsb3NlZAogICAgICogc3RlcCAzOiBhZG1pbiBjbG9zZSByb3VuZCwgbm93IGludmVzdG9yIGNhbm4ndCBpbnZlc3QgTkFDIHRvIFBvb2wKICAgICAqIHN0ZXAgNDogYWRtaW4gYWN0aXZhdGUgdG9wIGludmVzdG9yCiAgICAgKiBzdGVwIDU6IGFsbCB0b3AgaW52ZXN0b3Igd2FzIGFjdGl2YXRlZCwgYWRtaW4gZXhlY3V0ZSBjbG9zZUFjdGl2ZSBmdW5jdGlvbiB0byBjbG9zZSBhY3RpdmUgcGhyYXNlCiAgICAgKiBzdGVwIDY6IGFkbWluIG9wZW4gd2l0aGRyYXdhYmxlIGZvciBpbnZlc3RvciBub3QgaW4gdG9wIHRvIHdpdGhkcmF3IE5BQwogICAgICogc3RlcCA3OiBhZG1pbiBkZXBvc2l0IGV0aCB0byBldGggcG9vbAogICAgICogc3RlcCA4OiBjbG9zZSBkZXBvc2l0IGV0aCB0byBldGggcG9vbAogICAgICogc3RlcCA5OiBhZG1pbiBvcGVuIHdpdGhkcmF3YWJsZSB0byBpbnZlc3RvciBpbiB0b3AKICAgICAqIHN0ZXAgMTA6IGludmVzdG9yIGluIHRvcCBub3cgY2FuIHdpdGhkcmF3IE5BQyBhbmQgRVRIIGZvciB0aGlzIHJvdW5kCiAgICAvKi8KICAgIAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIAogICAgLyoKICAgICogQWRtaW4gZnVuY3Rpb24KICAgICogT3BlbiBhbmQgQ2xvc2UgUm91bmQKICAgICoKICAgICovCiAgICBmdW5jdGlvbiBhY3RpdmF0ZVJvdW5kKHVpbnQgX3JvdW5kSW5kZXgpIAogICAgICAgIG9ubHlFc2Nyb3cKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UgJiYgcm91bmRbX3JvdW5kSW5kZXhdLmlzQ2xvc2VFdGhQb29sID09IGZhbHNlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc0NvbXBsZXRlQWN0aXZlID09IGZhbHNlKTsKICAgICAgICByb3VuZFtfcm91bmRJbmRleF0uaXNPcGVuID0gdHJ1ZTsKICAgICAgICBjdXJyZW50Um91bmQgPSBfcm91bmRJbmRleDsKICAgICAgICBBY3RpdmF0ZVJvdW5kKF9yb3VuZEluZGV4LCBub3cpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBkZWFjdGl2YXRlUm91bmQodWludCBfcm91bmRJbmRleCkKICAgICAgICBvbmx5RXNjcm93CiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJbmRleF0uaXNPcGVuID09IHRydWUpOwogICAgICAgIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPSBmYWxzZTsKICAgIH0KICAgIAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIAogICAgLy8gdGhpcyBmdW5jdGlvbiBhZGQgc3Rha2Ugb2YgU2hhcmVIb2xkZXIKICAgIC8vIGludmVzdG9yIGNhbiBleGVjdXRlIHRoaXMgZnVuY3Rpb24gZHVyaW5nIHJvdW5kIG9wZW4KICAgIC8vCiAgICAKICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2tFeGNoYW5nZShhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgdWludCBfcHJpY2UpIG9ubHlOYW1pIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBvbmx5IG9uIGN1cnJlbnRSb3VuZCBhbmQgYWN0aXZlIHVzZXIgY2FuIGFkZCBzdGFrZQogICAgICAgIHJlcXVpcmUocm91bmRbX3ByaWNlXS5pc09wZW4gPT0gdHJ1ZSAmJiBfdmFsdWUgPiAwKTsKICAgICAgICAvLyBhZGQgc3Rha2UKICAgICAgICBuYW1pUG9vbFtfcHJpY2VdW19mcm9tXS5zdGFrZSA9IG5hbWlQb29sW19wcmljZV1bX2Zyb21dLnN0YWtlLmFkZChfdmFsdWUpOwogICAgICAgIHJvdW5kW19wcmljZV0uY3VycmVudE5BQyA9IHJvdW5kW19wcmljZV0uY3VycmVudE5BQy5hZGQoX3ZhbHVlKTsKICAgICAgICBVcGRhdGVTaGFyZUhvbGRlcihfZnJvbSwgX3ByaWNlLCBuYW1pUG9vbFtfcHJpY2VdW19mcm9tXS5zdGFrZSwgbm93KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgCiAgICAvKgogICAgKgogICAgKiBBY3RpdmF0ZSBhbmQgZGVhY3RpdmF0ZSB1c2VyCiAgICAqIGFkZCBvciBzdWIgZmluYWwgTmFjIHRvIGNvbXB1dGUgc3Rha2UgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiBhY3RpdmF0ZVVzZXIoYWRkcmVzcyBfc2hhcmVBZGRyZXNzLCB1aW50IF9yb3VuZElkKQogICAgICAgIG9ubHlFc2Nyb3cKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKG5hbWlQb29sW19yb3VuZElkXVtfc2hhcmVBZGRyZXNzXS5pc0FjdGl2ZSA9PSBmYWxzZSAmJiBuYW1pUG9vbFtfcm91bmRJZF1bX3NoYXJlQWRkcmVzc10uc3Rha2UgPiAwKTsKICAgICAgICByZXF1aXJlKHJvdW5kW19yb3VuZElkXS5pc0NvbXBsZXRlQWN0aXZlID09IGZhbHNlICYmIHJvdW5kW19yb3VuZElkXS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIG5hbWlQb29sW19yb3VuZElkXVtfc2hhcmVBZGRyZXNzXS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgICAgcm91bmRbX3JvdW5kSWRdLmZpbmFsTkFDID0gcm91bmRbX3JvdW5kSWRdLmZpbmFsTkFDLmFkZChuYW1pUG9vbFtfcm91bmRJZF1bX3NoYXJlQWRkcmVzc10uc3Rha2UpOwogICAgICAgIFVwZGF0ZUFjdGl2ZShfc2hhcmVBZGRyZXNzLCBfcm91bmRJZCAsbmFtaVBvb2xbX3JvdW5kSWRdW19zaGFyZUFkZHJlc3NdLmlzQWN0aXZlLCBub3cpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBkZWFjdGl2YXRlVXNlcihhZGRyZXNzIF9zaGFyZUFkZHJlc3MsIHVpbnQgX3JvdW5kSWQpCiAgICAgICAgb25seUVzY3JvdwogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUobmFtaVBvb2xbX3JvdW5kSWRdW19zaGFyZUFkZHJlc3NdLmlzQWN0aXZlID09IHRydWUgJiYgbmFtaVBvb2xbX3JvdW5kSWRdW19zaGFyZUFkZHJlc3NdLnN0YWtlID4gMCk7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJZF0uaXNDb21wbGV0ZUFjdGl2ZSA9PSBmYWxzZSAmJiByb3VuZFtfcm91bmRJZF0uaXNPcGVuID09IGZhbHNlKTsKICAgICAgICBuYW1pUG9vbFtfcm91bmRJZF1bX3NoYXJlQWRkcmVzc10uaXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICByb3VuZFtfcm91bmRJZF0uZmluYWxOQUMgPSByb3VuZFtfcm91bmRJZF0uZmluYWxOQUMuc3ViKG5hbWlQb29sW19yb3VuZElkXVtfc2hhcmVBZGRyZXNzXS5zdGFrZSk7CiAgICAgICAgVXBkYXRlQWN0aXZlKF9zaGFyZUFkZHJlc3MsIF9yb3VuZElkICxuYW1pUG9vbFtfcm91bmRJZF1bX3NoYXJlQWRkcmVzc10uaXNBY3RpdmUsIG5vdyk7CiAgICB9CiAgICAKICAgIAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIAogICAgLy8gYWRtaW4gY2xvc2UgYWN0aXZhdGUgcGhyYXNlIHRvIAogICAgLy8gCiAgICAvLwogICAgZnVuY3Rpb24gY2xvc2VBY3RpdmUodWludCBfcm91bmRJZCkKICAgICAgICBvbmx5RXNjcm93CiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJZF0uaXNDb21wbGV0ZUFjdGl2ZSA9PSBmYWxzZSAmJiByb3VuZFtfcm91bmRJZF0uaXNPcGVuID09IGZhbHNlKTsKICAgICAgICByb3VuZFtfcm91bmRJZF0uaXNDb21wbGV0ZUFjdGl2ZSA9IHRydWU7CiAgICB9CiAgICAvLwogICAgLy8KICAgIC8vIGNoYW5nZSBXaXRoZHJhd2FibGUgZm9yIG9uZSByb3VuZCBhZnRlciBldmVyeSBtb250aAogICAgLy8gZm9yIGludmVzdG9yIG5vdCBpbiB0b3AKICAgIC8vCiAgICBmdW5jdGlvbiBjaGFuZ2VXaXRoZHJhd2FibGUodWludCBfcm91bmRJbmRleCkKICAgICAgICBvbmx5RXNjcm93CiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJbmRleF0uaXNDb21wbGV0ZUFjdGl2ZSA9PSB0cnVlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIHJvdW5kW19yb3VuZEluZGV4XS53aXRoZHJhd2FibGUgPSAhcm91bmRbX3JvdW5kSW5kZXhdLndpdGhkcmF3YWJsZTsKICAgIH0KICAgIAogICAgCiAgICAKICAgIC8vCiAgICAvLwogICAgLy8gY2hhbmdlIFdpdGhkcmF3YWJsZSBmb3Igb25lIHJvdW5kIGFmdGVyIGV2ZXJ5IG1vbnRoCiAgICAvLyBmb3IgaW52ZXN0b3IgaW4gdG9wCiAgICAvLwogICAgZnVuY3Rpb24gY2hhbmdlVG9wV2l0aGRyYXdhYmxlKHVpbnQgX3JvdW5kSW5kZXgpCiAgICAgICAgb25seUVzY3JvdwogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUocm91bmRbX3JvdW5kSW5kZXhdLmlzQ29tcGxldGVBY3RpdmUgPT0gdHJ1ZSAmJiByb3VuZFtfcm91bmRJbmRleF0uaXNPcGVuID09IGZhbHNlKTsKICAgICAgICByb3VuZFtfcm91bmRJbmRleF0udG9wV2l0aGRyYXdhYmxlID0gIXJvdW5kW19yb3VuZEluZGV4XS50b3BXaXRoZHJhd2FibGU7CiAgICB9CiAgICAKICAgIAogICAgLy8KICAgIC8vCiAgICAvLyBhZnRlciBtb250aCBhZG1pbiBkZXBvc2l0IEVUSCB0byBFVEggUG9vbAogICAgLy8gCiAgICAvLwogICAgZnVuY3Rpb24gZGVwb3NpdEV0aFBvb2wodWludCBfcm91bmRJbmRleCkKICAgICAgICBwYXlhYmxlIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDAgJiYgcm91bmRbX3JvdW5kSW5kZXhdLmlzQ2xvc2VFdGhQb29sID09IGZhbHNlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHJvdW5kW19yb3VuZEluZGV4XS5ldGhCYWxhbmNlID0gcm91bmRbX3JvdW5kSW5kZXhdLmV0aEJhbGFuY2UuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgX3JvdW5kSW5kZXgsIG1zZy52YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLwogICAgLy8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoUG9vbCh1aW50IF9yb3VuZEluZGV4LCB1aW50IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUocm91bmRbX3JvdW5kSW5kZXhdLmlzQ2xvc2VFdGhQb29sID09IGZhbHNlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUobmFtaU11bHRpU2lnV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgLy8gCiAgICAgICAgaWYgKF9hbW91bnQgPiAwKSB7CiAgICAgICAgICAgIG5hbWlNdWx0aVNpZ1dhbGxldC50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICAgICAgcm91bmRbX3JvdW5kSW5kZXhdLmV0aEJhbGFuY2UgPSByb3VuZFtfcm91bmRJbmRleF0uZXRoQmFsYW5jZS5zdWIoX2Ftb3VudCk7CiAgICAgICAgICAgIFdpdGhkcmF3UG9vbChfYW1vdW50LCBub3cpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8KICAgIC8vIGNsb3NlIHBocmFzZSBkZXBvc2l0IEVUSCB0byBQb29sCiAgICAvLyAKICAgIGZ1bmN0aW9uIGNsb3NlRXRoUG9vbCh1aW50IF9yb3VuZEluZGV4KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKHJvdW5kW19yb3VuZEluZGV4XS5pc0Nsb3NlRXRoUG9vbCA9PSBmYWxzZSAmJiByb3VuZFtfcm91bmRJbmRleF0uaXNDb21wbGV0ZUFjdGl2ZSA9PSB0cnVlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIHJvdW5kW19yb3VuZEluZGV4XS5pc0Nsb3NlRXRoUG9vbCA9IHRydWU7CiAgICB9CiAgICAKICAgIC8vCiAgICAvLwogICAgLy8gd2l0aGRyYXcgTkFDIGZvciBpbnZlc3RvcgogICAgLy8gaW50ZXJuYWwgZnVuY3Rpb24gb25seSBjYW4gcnVuIGJ5IHRoaXMgc21hcnRjb250cmFjdAogICAgLy8gCiAgICAvLwogICAgZnVuY3Rpb24gX3dpdGhkcmF3TkFDKGFkZHJlc3MgX3NoYXJlQWRkcmVzcywgdWludCBfcm91bmRJbmRleCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUobmFtaVBvb2xbX3JvdW5kSW5kZXhdW19zaGFyZUFkZHJlc3NdLnN0YWtlID4gMCk7CiAgICAgICAgTmFtaUNyb3dkU2FsZSBuYW1pVG9rZW4gPSBOYW1pQ3Jvd2RTYWxlKE5hbWlBZGRyKTsKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZXMgPSBuYW1pVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIG5hbWlUb2tlbi50cmFuc2Zlcihfc2hhcmVBZGRyZXNzLCBuYW1pUG9vbFtfcm91bmRJbmRleF1bX3NoYXJlQWRkcmVzc10uc3Rha2UpOwogICAgICAgIC8vIHVwZGF0ZSBjdXJyZW50IE5hYyBwb29sIGJhbGFuY2UKICAgICAgICByb3VuZFtfcm91bmRJbmRleF0uY3VycmVudE5BQyA9IHJvdW5kW19yb3VuZEluZGV4XS5jdXJyZW50TkFDLnN1YihuYW1pUG9vbFtfcm91bmRJbmRleF1bX3NoYXJlQWRkcmVzc10uc3Rha2UpOwogICAgICAgIAogICAgICAgIG5hbWlQb29sW19yb3VuZEluZGV4XVtfc2hhcmVBZGRyZXNzXS5zdGFrZSA9IDA7CiAgICAgICAgYXNzZXJ0KHByZXZpb3VzQmFsYW5jZXMgPiBuYW1pVG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKICAgIH0KICAgIAogICAgCiAgICAvLwogICAgLy8KICAgIC8vIHdpdGhkcmF3IE5BQyBhbmQgRVRIIGZvciB0b3AgaW52ZXN0b3IKICAgIC8vIAogICAgLy8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9wRm9yVGVhbShhZGRyZXNzIF9zaGFyZUFkZHJlc3MsIHVpbnQgX3JvdW5kSW5kZXgpCiAgICAgICAgb25seUVzY3JvdwogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUocm91bmRbX3JvdW5kSW5kZXhdLmlzQ29tcGxldGVBY3RpdmUgPT0gdHJ1ZSAmJiByb3VuZFtfcm91bmRJbmRleF0uaXNDbG9zZUV0aFBvb2wgPT0gdHJ1ZSAmJiByb3VuZFtfcm91bmRJbmRleF0uaXNPcGVuID09IGZhbHNlKTsKICAgICAgICByZXF1aXJlKHJvdW5kW19yb3VuZEluZGV4XS50b3BXaXRoZHJhd2FibGUpOwogICAgICAgIGlmKG5hbWlQb29sW19yb3VuZEluZGV4XVtfc2hhcmVBZGRyZXNzXS5pc0FjdGl2ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgIHJlcXVpcmUobmFtaVBvb2xbX3JvdW5kSW5kZXhdW19zaGFyZUFkZHJlc3NdLmlzV2l0aGRyYXduID09IGZhbHNlKTsKICAgICAgICAgICAgYXNzZXJ0KHJvdW5kW19yb3VuZEluZGV4XS5maW5hbE5BQyA+IG5hbWlQb29sW19yb3VuZEluZGV4XVtfc2hhcmVBZGRyZXNzXS5zdGFrZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjb21wdXRlIGV0aCBmb3IgaW52ZXN0ZXIKICAgICAgICAgICAgdWludCBldGhSZXR1cm4gPSAocm91bmRbX3JvdW5kSW5kZXhdLmV0aEJhbGFuY2UubXVsKG5hbWlQb29sW19yb3VuZEluZGV4XVtfc2hhcmVBZGRyZXNzXS5zdGFrZSkpLmRpdihyb3VuZFtfcm91bmRJbmRleF0uZmluYWxOQUMpOwogICAgICAgICAgICBfc2hhcmVBZGRyZXNzLnRyYW5zZmVyKGV0aFJldHVybik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBzZXQgdXNlciB3aXRoZHJhdwogICAgICAgICAgICBuYW1pUG9vbFtfcm91bmRJbmRleF1bX3NoYXJlQWRkcmVzc10uaXNXaXRoZHJhd24gPSB0cnVlOwogICAgICAgICAgICBXaXRoZHJhdyhfc2hhcmVBZGRyZXNzLCBfcm91bmRJbmRleCwgZXRoUmV0dXJuLCBuYW1pUG9vbFtfcm91bmRJbmRleF1bX3NoYXJlQWRkcmVzc10uc3Rha2UsIG5vdyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyB3aXRoZHJhdyBOQUMKICAgICAgICAgICAgX3dpdGhkcmF3TkFDKF9zaGFyZUFkZHJlc3MsIF9yb3VuZEluZGV4KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIAogICAgCiAgICAKICAgIC8vCiAgICAvLwogICAgLy8gd2l0aGRyYXcgTkFDIGFuZCBFVEggZm9yIG5vbiB0b3AgaW52ZXN0b3IKICAgIC8vIGV4ZWN1dGUgYnkgYWRtaW4gb25seQogICAgLy8gCiAgICAvLwogICAgZnVuY3Rpb24gd2l0aGRyYXdOb25Ub3BGb3JUZWFtKGFkZHJlc3MgX3NoYXJlQWRkcmVzcywgdWludCBfcm91bmRJbmRleCkKICAgICAgICBvbmx5RXNjcm93CiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJbmRleF0uaXNDb21wbGV0ZUFjdGl2ZSA9PSB0cnVlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUocm91bmRbX3JvdW5kSW5kZXhdLndpdGhkcmF3YWJsZSk7CiAgICAgICAgaWYobmFtaVBvb2xbX3JvdW5kSW5kZXhdW19zaGFyZUFkZHJlc3NdLmlzQWN0aXZlID09IGZhbHNlKSB7CiAgICAgICAgICAgIHJlcXVpcmUobmFtaVBvb2xbX3JvdW5kSW5kZXhdW19zaGFyZUFkZHJlc3NdLmlzV2l0aGRyYXduID09IGZhbHNlKTsKICAgICAgICAgICAgLy8gc2V0IHN0YXRlIHVzZXIgd2l0aGRyYXcKICAgICAgICAgICAgbmFtaVBvb2xbX3JvdW5kSW5kZXhdW19zaGFyZUFkZHJlc3NdLmlzV2l0aGRyYXduID0gdHJ1ZTsKICAgICAgICAgICAgV2l0aGRyYXcoX3NoYXJlQWRkcmVzcywgX3JvdW5kSW5kZXgsIDAsIG5hbWlQb29sW19yb3VuZEluZGV4XVtfc2hhcmVBZGRyZXNzXS5zdGFrZSwgbm93KTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgX3dpdGhkcmF3TkFDKF9zaGFyZUFkZHJlc3MsIF9yb3VuZEluZGV4KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIAogICAgCiAgICAvLwogICAgLy8KICAgIC8vIHdpdGhkcmF3IE5BQyBhbmQgRVRIIGZvciB0b3AgaW52ZXN0b3IKICAgIC8vIGV4ZWN1dGUgYnkgaW52ZXN0b3IKICAgIC8vIAogICAgLy8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9wKHVpbnQgX3JvdW5kSW5kZXgpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJbmRleF0uaXNDb21wbGV0ZUFjdGl2ZSA9PSB0cnVlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc0Nsb3NlRXRoUG9vbCA9PSB0cnVlICYmIHJvdW5kW19yb3VuZEluZGV4XS5pc09wZW4gPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUocm91bmRbX3JvdW5kSW5kZXhdLnRvcFdpdGhkcmF3YWJsZSk7CiAgICAgICAgaWYobmFtaVBvb2xbX3JvdW5kSW5kZXhdW21zZy5zZW5kZXJdLmlzQWN0aXZlID09IHRydWUpIHsKICAgICAgICAgICAgcmVxdWlyZShuYW1pUG9vbFtfcm91bmRJbmRleF1bbXNnLnNlbmRlcl0uaXNXaXRoZHJhd24gPT0gZmFsc2UpOwogICAgICAgICAgICB1aW50IGV0aFJldHVybiA9IChyb3VuZFtfcm91bmRJbmRleF0uZXRoQmFsYW5jZS5tdWwobmFtaVBvb2xbX3JvdW5kSW5kZXhdW21zZy5zZW5kZXJdLnN0YWtlKSkuZGl2KHJvdW5kW19yb3VuZEluZGV4XS5maW5hbE5BQyk7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoUmV0dXJuKTsKICAgICAgICAgICAgLy8gc2V0IHVzZXIgd2l0aGRyYXcKICAgICAgICAgICAgbmFtaVBvb2xbX3JvdW5kSW5kZXhdW21zZy5zZW5kZXJdLmlzV2l0aGRyYXduID0gdHJ1ZTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgV2l0aGRyYXcobXNnLnNlbmRlciwgX3JvdW5kSW5kZXgsIGV0aFJldHVybiwgbmFtaVBvb2xbX3JvdW5kSW5kZXhdW21zZy5zZW5kZXJdLnN0YWtlLCBub3cpOwogICAgICAgICAgICBfd2l0aGRyYXdOQUMobXNnLnNlbmRlciwgX3JvdW5kSW5kZXgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8KICAgIC8vCiAgICAvLyB3aXRoZHJhdyBOQUMgYW5kIEVUSCBmb3Igbm9uIHRvcCBpbnZlc3RvcgogICAgLy8gZXhlY3V0ZSBieSBpbnZlc3RvcgogICAgLy8gCiAgICAvLwogICAgZnVuY3Rpb24gd2l0aGRyYXdOb25Ub3AodWludCBfcm91bmRJbmRleCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKHJvdW5kW19yb3VuZEluZGV4XS5pc0NvbXBsZXRlQWN0aXZlID09IHRydWUgJiYgcm91bmRbX3JvdW5kSW5kZXhdLmlzT3BlbiA9PSBmYWxzZSk7CiAgICAgICAgcmVxdWlyZShyb3VuZFtfcm91bmRJbmRleF0ud2l0aGRyYXdhYmxlKTsKICAgICAgICBpZihuYW1pUG9vbFtfcm91bmRJbmRleF1bbXNnLnNlbmRlcl0uaXNBY3RpdmUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgcmVxdWlyZShuYW1pUG9vbFtfcm91bmRJbmRleF1bbXNnLnNlbmRlcl0uaXNXaXRoZHJhd24gPT0gZmFsc2UpOwogICAgICAgICAgICBuYW1pUG9vbFtfcm91bmRJbmRleF1bbXNnLnNlbmRlcl0uaXNXaXRoZHJhd24gPSB0cnVlOwogICAgICAgICAgICAvLwogICAgICAgICAgICBXaXRoZHJhdyhtc2cuc2VuZGVyLCBfcm91bmRJbmRleCwgMCwgbmFtaVBvb2xbX3JvdW5kSW5kZXhdW21zZy5zZW5kZXJdLnN0YWtlLCBub3cpOwogICAgICAgICAgICBfd2l0aGRyYXdOQUMobXNnLnNlbmRlciwgX3JvdW5kSW5kZXgpOwogICAgICAgIH0KICAgIH0KICAgIAp9Cgpjb250cmFjdCBOYW1pQ3Jvd2RTYWxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vLyBOQUMgQnJva2VyIFByZXNhbGUgVG9rZW4KICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBOYW1pQ3Jvd2RTYWxlKGFkZHJlc3MgX2VzY3JvdywgYWRkcmVzcyBfbmFtaU11bHRpU2lnV2FsbGV0LCBhZGRyZXNzIF9uYW1pUHJlc2FsZSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9uYW1pTXVsdGlTaWdXYWxsZXQgIT0gMHgwKTsKICAgICAgICBlc2Nyb3cgPSBfZXNjcm93OwogICAgICAgIG5hbWlNdWx0aVNpZ1dhbGxldCA9IF9uYW1pTXVsdGlTaWdXYWxsZXQ7CiAgICAgICAgbmFtaVByZXNhbGUgPSBfbmFtaVByZXNhbGU7CiAgICB9CgoKICAgIC8qLwogICAgICogIENvbnN0YW50cwogICAgLyovCgogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIk5hbWkgSUNPIjsKICAgIHN0cmluZyBwdWJsaWMgIHN5bWJvbCA9ICJOQUMiOwogICAgdWludCAgIHB1YmxpYyBkZWNpbWFscyA9IDE4OwoKICAgIGJvb2wgcHVibGljIFRSQU5TRkVSQUJMRSA9IGZhbHNlOyAvLyBkZWZhdWx0IG5vdCB0cmFuc2ZlcmFibGUKCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TVVBQTFlfTElNSVQgPSAxMDAwMDAwMDAwICogKDEgZXRoZXIgLyAxIHdlaSk7CiAgICAKICAgIHVpbnQgcHVibGljIGJpbmFyeSA9IDA7CgogICAgLyovCiAgICAgKiAgVG9rZW4gc3RhdGUKICAgIC8qLwoKICAgIGVudW0gUGhhc2UgewogICAgICAgIENyZWF0ZWQsCiAgICAgICAgUnVubmluZywKICAgICAgICBQYXVzZWQsCiAgICAgICAgTWlncmF0aW5nLAogICAgICAgIE1pZ3JhdGVkCiAgICB9CgogICAgUGhhc2UgcHVibGljIGN1cnJlbnRQaGFzZSA9IFBoYXNlLkNyZWF0ZWQ7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseSA9IDA7IC8vIGFtb3VudCBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkCgogICAgLy8gZXNjcm93IGhhcyBleGNsdXNpdmUgcHJpdmVsZWdlcyB0byBjYWxsIGFkbWluaXN0cmF0aXZlCiAgICAvLyBmdW5jdGlvbnMgb24gdGhpcyBjb250cmFjdC4KICAgIGFkZHJlc3MgcHVibGljIGVzY3JvdzsKCiAgICAvLyBHYXRoZXJlZCBmdW5kcyBjYW4gYmUgd2l0aGRyYXcgb25seSB0byBuYW1pbXVsdGlzaWd3YWxsZXQncyBhZGRyZXNzLgogICAgYWRkcmVzcyBwdWJsaWMgbmFtaU11bHRpU2lnV2FsbGV0OwoKICAgIC8vIG5hbWkgcHJlc2FsZSBjb250cmFjdAogICAgYWRkcmVzcyBwdWJsaWMgbmFtaVByZXNhbGU7CgogICAgLy8gQ3Jvd2RzYWxlIG1hbmFnZXIgaGFzIGV4Y2x1c2l2ZSBwcml2ZWxlZ2VzIHRvIGJ1cm4gcHJlc2FsZSB0b2tlbnMuCiAgICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGVNYW5hZ2VyOwogICAgCiAgICAvLyBiaW5hcnkgb3B0aW9uIGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIGJpbmFyeUFkZHJlc3M7CiAgICAKICAgIC8vIFRoaXMgY3JlYXRlcyBhbiBhcnJheSB3aXRoIGFsbCBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZU9mOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgYWxsb3dhbmNlOwoKICAgIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGVNYW5hZ2VyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcm93ZHNhbGVNYW5hZ2VyKTsgCiAgICAgICAgXzsgCiAgICB9CgogICAgbW9kaWZpZXIgb25seUVzY3JvdygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZXNjcm93KTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5VHJhbmZlcmFibGUoKSB7CiAgICAgICAgcmVxdWlyZShUUkFOU0ZFUkFCTEUpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlOYW1pTXVsdGlzaWcoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5hbWlNdWx0aVNpZ1dhbGxldCk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLyovCiAgICAgKiAgRXZlbnRzCiAgICAvKi8KCiAgICBldmVudCBMb2dCdXkoYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IExvZ0J1cm4oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IExvZ1BoYXNlU3dpdGNoKFBoYXNlIG5ld1BoYXNlKTsKICAgIC8vIExvZyBtaWdyYXRlIHRva2VuCiAgICBldmVudCBMb2dNaWdyYXRlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IGFtb3VudCk7CiAgICAvLyBUaGlzIGdlbmVyYXRlcyBhIHB1YmxpYyBldmVudCBvbiB0aGUgYmxvY2tjaGFpbiB0aGF0IHdpbGwgbm90aWZ5IGNsaWVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwoKICAgIC8qLwogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8qLwoKICAgIC8qKgogICAgICogSW50ZXJuYWwgdHJhbnNmZXIsIG9ubHkgY2FuIGJlIGNhbGxlZCBieSB0aGlzIGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGludGVybmFsIHsKICAgICAgICAvLyBQcmV2ZW50IHRyYW5zZmVyIHRvIDB4MCBhZGRyZXNzLiBVc2UgYnVybigpIGluc3RlYWQKICAgICAgICByZXF1aXJlKF90byAhPSAweDApOwogICAgICAgIC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgIC8vIENoZWNrIGZvciBvdmVyZmxvd3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZltfdG9dICsgX3ZhbHVlID4gYmFsYW5jZU9mW190b10pOwogICAgICAgIC8vIFNhdmUgdGhpcyBmb3IgYW4gYXNzZXJ0aW9uIGluIHRoZSBmdXR1cmUKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZXMgPSBiYWxhbmNlT2ZbX2Zyb21dICsgYmFsYW5jZU9mW190b107CiAgICAgICAgLy8gU3VidHJhY3QgZnJvbSB0aGUgc2VuZGVyCiAgICAgICAgYmFsYW5jZU9mW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKICAgICAgICBiYWxhbmNlT2ZbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAvLyBBc3NlcnRzIGFyZSB1c2VkIHRvIHVzZSBzdGF0aWMgYW5hbHlzaXMgdG8gZmluZCBidWdzIGluIHlvdXIgY29kZS4gVGhleSBzaG91bGQgbmV2ZXIgZmFpbAogICAgICAgIGFzc2VydChiYWxhbmNlT2ZbX2Zyb21dICsgYmFsYW5jZU9mW190b10gPT0gcHJldmlvdXNCYWxhbmNlcyk7CiAgICB9CgogICAgLy8gVHJhbnNmZXIgdGhlIGJhbGFuY2UgZnJvbSBvd25lcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50CiAgICAvLyBvbmx5IGVzY3JvdyBjYW4gc2VuZCB0b2tlbiAodG8gc2VuZCB0b2tlbiBwcml2YXRlIHNhbGUpCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZvclRlYW0oYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBUcmFuc2ZlciB0b2tlbnMKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIHlvdXIgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IHRvIHNlbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMKICAgICAgICBvbmx5VHJhbmZlcmFibGUKICAgIHsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQogICAgCiAgICAgICAvKioKICAgICAqIFRyYW5zZmVyIHRva2VucyBmcm9tIG90aGVyIGFkZHJlc3MKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBpbiBiZWhhbGYgb2YgYF9mcm9tYAogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgdGhlIGFtb3VudCB0byBzZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIAogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlUcmFuZmVyYWJsZQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdKTsgICAgIC8vIENoZWNrIGFsbG93YW5jZQogICAgICAgIGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFsbG93YW5jZSBmb3Igb3RoZXIgYWRkcmVzcwogICAgICoKICAgICAqIEFsbG93cyBgX3NwZW5kZXJgIHRvIHNwZW5kIG5vIG1vcmUgdGhhbiBgX3ZhbHVlYCB0b2tlbnMgaW4geW91ciBiZWhhbGYKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgbWF4IGFtb3VudCB0aGV5IGNhbiBzcGVuZAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMKICAgICAgICBvbmx5VHJhbmZlcmFibGUKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIAogICAgewogICAgICAgIGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYWxsb3dhbmNlIGZvciBvdGhlciBhZGRyZXNzIGFuZCBub3RpZnkKICAgICAqCiAgICAgKiBBbGxvd3MgYF9zcGVuZGVyYCB0byBzcGVuZCBubyBtb3JlIHRoYW4gYF92YWx1ZWAgdG9rZW5zIGluIHlvdXIgYmVoYWxmLCBhbmQgdGhlbiBwaW5nIHRoZSBjb250cmFjdCBhYm91dCBpdAogICAgICoKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBhdXRob3JpemVkIHRvIHNwZW5kCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBtYXggYW1vdW50IHRoZXkgY2FuIHNwZW5kCiAgICAgKiBAcGFyYW0gX2V4dHJhRGF0YSBzb21lIGV4dHJhIGluZm9ybWF0aW9uIHRvIHNlbmQgdG8gdGhlIGFwcHJvdmVkIGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlUcmFuZmVyYWJsZQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgCiAgICB7CiAgICAgICAgdG9rZW5SZWNpcGllbnQgc3BlbmRlciA9IHRva2VuUmVjaXBpZW50KF9zcGVuZGVyKTsKICAgICAgICBpZiAoYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKSkgewogICAgICAgICAgICBzcGVuZGVyLnJlY2VpdmVBcHByb3ZhbChtc2cuc2VuZGVyLCBfdmFsdWUsIHRoaXMsIF9leHRyYURhdGEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gYWxsb3dzIHRyYW5zZmVyIHRva2VuCiAgICBmdW5jdGlvbiBjaGFuZ2VUcmFuc2ZlcmFibGUgKCkgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIFRSQU5TRkVSQUJMRSA9ICFUUkFOU0ZFUkFCTEU7CiAgICB9CiAgICAKICAgIC8vIGNoYW5nZSBlc2Nyb3cKICAgIGZ1bmN0aW9uIGNoYW5nZUVzY3JvdyhhZGRyZXNzIF9lc2Nyb3cpIHB1YmxpYwogICAgICAgIG9ubHlOYW1pTXVsdGlzaWcKICAgIHsKICAgICAgICByZXF1aXJlKF9lc2Nyb3cgIT0gMHgwKTsKICAgICAgICBlc2Nyb3cgPSBfZXNjcm93OwogICAgfQogICAgCiAgICAvLyBjaGFuZ2UgYmluYXJ5IHZhbHVlCiAgICBmdW5jdGlvbiBjaGFuZ2VCaW5hcnkodWludCBfYmluYXJ5KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICBiaW5hcnkgPSBfYmluYXJ5OwogICAgfQogICAgCiAgICAvLyBjaGFuZ2UgYmluYXJ5IGFkZHJlc3MKICAgIGZ1bmN0aW9uIGNoYW5nZUJpbmFyeUFkZHJlc3MoYWRkcmVzcyBfYmluYXJ5QWRkcmVzcykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZShfYmluYXJ5QWRkcmVzcyAhPSAweDApOwogICAgICAgIGJpbmFyeUFkZHJlc3MgPSBfYmluYXJ5QWRkcmVzczsKICAgIH0KICAgIAogICAgLyoKICAgICogcHJpY2UgaW4gSUNPOgogICAgKiBmaXJzdCB3ZWVrOiAxIEVUSCA9IDI0MDAgTkFDCiAgICAqIHNlY29uZCB3ZWVrOiAxIEVUSCA9IDIzMDAwIE5BQwogICAgKiAzcmQgd2VlazogMSBFVEggPSAyMjAwIE5BQwogICAgKiA0dGggd2VlazogMSBFVEggPSAyMTAwIE5BQwogICAgKiA1dGggd2VlazogMSBFVEggPSAyMDAwIE5BQwogICAgKiA2dGggd2VlazogMSBFVEggPSAxOTAwIE5BQwogICAgKiA3dGggd2VlazogMSBFVEggPSAxODAwIE5BQwogICAgKiA4dGggd2VlazogMSBFVEggPSAxNzAwIG5hYwogICAgKiB0aW1lOiAKICAgICogMTUxNzQ0MzIwMDogVGh1cnNkYXksIEZlYnJ1YXJ5IDEsIDIwMTggMTI6MDA6MDAgQU0KICAgICogMTUxODA0ODAwMDogVGh1cnNkYXksIEZlYnJ1YXJ5IDgsIDIwMTggMTI6MDA6MDAgQU0KICAgICogMTUxODY1MjgwMDogVGh1cnNkYXksIEZlYnJ1YXJ5IDE1LCAyMDE4IDEyOjAwOjAwIEFNCiAgICAqIDE1MTkyNTc2MDA6IFRodXJzZGF5LCBGZWJydWFyeSAyMiwgMjAxOCAxMjowMDowMCBBTQogICAgKiAxNTE5ODYyNDAwOiBUaHVyc2RheSwgTWFyY2ggMSwgMjAxOCAxMjowMDowMCBBTQogICAgKiAxNTIwNDY3MjAwOiBUaHVyc2RheSwgTWFyY2ggOCwgMjAxOCAxMjowMDowMCBBTQogICAgKiAxNTIxMDcyMDAwOiBUaHVyc2RheSwgTWFyY2ggMTUsIDIwMTggMTI6MDA6MDAgQU0KICAgICogMTUyMTY3NjgwMDogVGh1cnNkYXksIE1hcmNoIDIyLCAyMDE4IDEyOjAwOjAwIEFNCiAgICAqIDE1MjIyODE2MDA6IFRodXJzZGF5LCBNYXJjaCAyOSwgMjAxOCAxMjowMDowMCBBTQogICAgKi8KICAgIGZ1bmN0aW9uIGdldFByaWNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBwcmljZSkgewogICAgICAgIGlmIChub3cgPCAxNTE3NDQzMjAwKSB7CiAgICAgICAgICAgIC8vIHByZXNhbGUKICAgICAgICAgICAgcmV0dXJuIDM0NTA7CiAgICAgICAgfSBlbHNlIGlmICgxNTE3NDQzMjAwIDwgbm93ICYmIG5vdyA8PSAxNTE4MDQ4MDAwKSB7CiAgICAgICAgICAgIC8vIDFzdCB3ZWVrCiAgICAgICAgICAgIHJldHVybiAyNDAwOwogICAgICAgIH0gZWxzZSBpZiAoMTUxODA0ODAwMCA8IG5vdyAmJiBub3cgPD0gMTUxODY1MjgwMCkgewogICAgICAgICAgICAvLyAybmQgd2VlawogICAgICAgICAgICByZXR1cm4gMjMwMDsKICAgICAgICB9IGVsc2UgaWYgKDE1MTg2NTI4MDAgPCBub3cgJiYgbm93IDw9IDE1MTkyNTc2MDApIHsKICAgICAgICAgICAgLy8gM3JkIHdlZWsKICAgICAgICAgICAgcmV0dXJuIDIyMDA7CiAgICAgICAgfSBlbHNlIGlmICgxNTE5MjU3NjAwIDwgbm93ICYmIG5vdyA8PSAxNTE5ODYyNDAwKSB7CiAgICAgICAgICAgIC8vIDR0aCB3ZWVrCiAgICAgICAgICAgIHJldHVybiAyMTAwOwogICAgICAgIH0gZWxzZSBpZiAoMTUxOTg2MjQwMCA8IG5vdyAmJiBub3cgPD0gMTUyMDQ2NzIwMCkgewogICAgICAgICAgICAvLyA1dGggd2VlawogICAgICAgICAgICByZXR1cm4gMjAwMDsKICAgICAgICB9IGVsc2UgaWYgKDE1MjA0NjcyMDAgPCBub3cgJiYgbm93IDw9IDE1MjEwNzIwMDApIHsKICAgICAgICAgICAgLy8gNnRoIHdlZWsKICAgICAgICAgICAgcmV0dXJuIDE5MDA7CiAgICAgICAgfSBlbHNlIGlmICgxNTIxMDcyMDAwIDwgbm93ICYmIG5vdyA8PSAxNTIxNjc2ODAwKSB7CiAgICAgICAgICAgIC8vIDd0aCB3ZWVrCiAgICAgICAgICAgIHJldHVybiAxODAwOwogICAgICAgIH0gZWxzZSBpZiAoMTUyMTY3NjgwMCA8IG5vdyAmJiBub3cgPD0gMTUyMjI4MTYwMCkgewogICAgICAgICAgICAvLyA4dGggd2VlawogICAgICAgICAgICByZXR1cm4gMTcwMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYmluYXJ5OwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgYnV5KG1zZy5zZW5kZXIpOwogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIGJ1eShhZGRyZXNzIF9idXllcikgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIC8vIEF2YWlsYWJsZSBvbmx5IGlmIHByZXNhbGUgaXMgcnVubmluZy4KICAgICAgICByZXF1aXJlKGN1cnJlbnRQaGFzZSA9PSBQaGFzZS5SdW5uaW5nKTsKICAgICAgICAvLyByZXF1aXJlIElDTyB0aW1lIG9yIGJpbmFyeSBvcHRpb24KICAgICAgICByZXF1aXJlKG5vdyA8PSAxNTIyMjgxNjAwIHx8IG1zZy5zZW5kZXIgPT0gYmluYXJ5QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgIT0gMCk7CiAgICAgICAgdWludCBuZXdUb2tlbnMgPSBtc2cudmFsdWUgKiBnZXRQcmljZSgpOwogICAgICAgIHJlcXVpcmUgKHRvdGFsU3VwcGx5ICsgbmV3VG9rZW5zIDwgVE9LRU5fU1VQUExZX0xJTUlUKTsKICAgICAgICAvLyBhZGQgbmV3IHRva2VuIHRvIGJ1eWVyCiAgICAgICAgYmFsYW5jZU9mW19idXllcl0gPSBiYWxhbmNlT2ZbX2J1eWVyXS5hZGQobmV3VG9rZW5zKTsKICAgICAgICAvLyBhZGQgbmV3IHRva2VuIHRvIHRvdGFsU3VwcGx5CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQobmV3VG9rZW5zKTsKICAgICAgICBMb2dCdXkoX2J1eWVyLG5ld1Rva2Vucyk7CiAgICAgICAgVHJhbnNmZXIodGhpcyxfYnV5ZXIsbmV3VG9rZW5zKTsKICAgIH0KICAgIAoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIHRva2VucyBvd25lZCBieSBnaXZlbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBfb3duZXIpIHB1YmxpYwogICAgICAgIG9ubHlDcm93ZHNhbGVNYW5hZ2VyCiAgICB7CiAgICAgICAgLy8gQXZhaWxhYmxlIG9ubHkgZHVyaW5nIG1pZ3JhdGlvbiBwaGFzZQogICAgICAgIHJlcXVpcmUoY3VycmVudFBoYXNlID09IFBoYXNlLk1pZ3JhdGluZyk7CgogICAgICAgIHVpbnQgdG9rZW5zID0gYmFsYW5jZU9mW19vd25lcl07CiAgICAgICAgcmVxdWlyZSh0b2tlbnMgIT0gMCk7CiAgICAgICAgYmFsYW5jZU9mW19vd25lcl0gPSAwOwogICAgICAgIHRvdGFsU3VwcGx5IC09IHRva2VuczsKICAgICAgICBMb2dCdXJuKF9vd25lciwgdG9rZW5zKTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIGNyb3dkc2FsZU1hbmFnZXIsIHRva2Vucyk7CgogICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgc3dpdGNoIHBoYXNlIHdoZW4gbWlncmF0aW9uIGlzIGRvbmUuCiAgICAgICAgaWYgKHRvdGFsU3VwcGx5ID09IDApIHsKICAgICAgICAgICAgY3VycmVudFBoYXNlID0gUGhhc2UuTWlncmF0ZWQ7CiAgICAgICAgICAgIExvZ1BoYXNlU3dpdGNoKFBoYXNlLk1pZ3JhdGVkKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qLwogICAgICogIEFkbWluaXN0cmF0aXZlIGZ1bmN0aW9ucwogICAgLyovCiAgICBmdW5jdGlvbiBzZXRQcmVzYWxlUGhhc2UoUGhhc2UgX25leHRQaGFzZSkgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIGJvb2wgY2FuU3dpdGNoUGhhc2UKICAgICAgICAgICAgPSAgKGN1cnJlbnRQaGFzZSA9PSBQaGFzZS5DcmVhdGVkICYmIF9uZXh0UGhhc2UgPT0gUGhhc2UuUnVubmluZykKICAgICAgICAgICAgfHwgKGN1cnJlbnRQaGFzZSA9PSBQaGFzZS5SdW5uaW5nICYmIF9uZXh0UGhhc2UgPT0gUGhhc2UuUGF1c2VkKQogICAgICAgICAgICAgICAgLy8gc3dpdGNoIHRvIG1pZ3JhdGlvbiBwaGFzZSBvbmx5IGlmIGNyb3dkc2FsZSBtYW5hZ2VyIGlzIHNldAogICAgICAgICAgICB8fCAoKGN1cnJlbnRQaGFzZSA9PSBQaGFzZS5SdW5uaW5nIHx8IGN1cnJlbnRQaGFzZSA9PSBQaGFzZS5QYXVzZWQpCiAgICAgICAgICAgICAgICAmJiBfbmV4dFBoYXNlID09IFBoYXNlLk1pZ3JhdGluZwogICAgICAgICAgICAgICAgJiYgY3Jvd2RzYWxlTWFuYWdlciAhPSAweDApCiAgICAgICAgICAgIHx8IChjdXJyZW50UGhhc2UgPT0gUGhhc2UuUGF1c2VkICYmIF9uZXh0UGhhc2UgPT0gUGhhc2UuUnVubmluZykKICAgICAgICAgICAgICAgIC8vIHN3aXRjaCB0byBtaWdyYXRlZCBvbmx5IGlmIGV2ZXJ5dGluZyBpcyBtaWdyYXRlZAogICAgICAgICAgICB8fCAoY3VycmVudFBoYXNlID09IFBoYXNlLk1pZ3JhdGluZyAmJiBfbmV4dFBoYXNlID09IFBoYXNlLk1pZ3JhdGVkCiAgICAgICAgICAgICAgICAmJiB0b3RhbFN1cHBseSA9PSAwKTsKCiAgICAgICAgcmVxdWlyZShjYW5Td2l0Y2hQaGFzZSk7CiAgICAgICAgY3VycmVudFBoYXNlID0gX25leHRQaGFzZTsKICAgICAgICBMb2dQaGFzZVN3aXRjaChfbmV4dFBoYXNlKTsKICAgIH0KCgogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcih1aW50IF9hbW91bnQpIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKG5hbWlNdWx0aVNpZ1dhbGxldCAhPSAweDApOwogICAgICAgIC8vIEF2YWlsYWJsZSBhdCBhbnkgcGhhc2UuCiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA+IDApIHsKICAgICAgICAgICAgbmFtaU11bHRpU2lnV2FsbGV0LnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2FmZVdpdGhkcmF3KGFkZHJlc3MgX3dpdGhkcmF3LCB1aW50IF9hbW91bnQpIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICBOYW1pTXVsdGlTaWdXYWxsZXQgbmFtaVdhbGxldCA9IE5hbWlNdWx0aVNpZ1dhbGxldChuYW1pTXVsdGlTaWdXYWxsZXQpOwogICAgICAgIGlmIChuYW1pV2FsbGV0LmlzT3duZXIoX3dpdGhkcmF3KSkgewogICAgICAgICAgICBfd2l0aGRyYXcudHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVNYW5hZ2VyKGFkZHJlc3MgX21ncikgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIC8vIFlvdSBjYW4ndCBjaGFuZ2UgY3Jvd2RzYWxlIGNvbnRyYWN0IHdoZW4gbWlncmF0aW9uIGlzIGluIHByb2dyZXNzLgogICAgICAgIHJlcXVpcmUoY3VycmVudFBoYXNlICE9IFBoYXNlLk1pZ3JhdGluZyk7CiAgICAgICAgY3Jvd2RzYWxlTWFuYWdlciA9IF9tZ3I7CiAgICB9CgogICAgLy8gaW50ZXJuYWwgbWlncmF0ZSBtaWdyYXRpb24gdG9rZW5zCiAgICBmdW5jdGlvbiBfbWlncmF0ZVRva2VuKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgUHJlc2FsZVRva2VuIHByZXNhbGUgPSBQcmVzYWxlVG9rZW4obmFtaVByZXNhbGUpOwogICAgICAgIHVpbnQyNTYgbmV3VG9rZW4gPSBwcmVzYWxlLmJhbGFuY2VPZihfZnJvbSk7CiAgICAgICAgcmVxdWlyZShuZXdUb2tlbiA+IDApOwogICAgICAgIC8vIGJ1cm4gb2xkIHRva2VuCiAgICAgICAgcHJlc2FsZS5idXJuVG9rZW5zKF9mcm9tKTsKICAgICAgICAvLyBhZGQgbmV3IHRva2VuIHRvIF90bwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gYmFsYW5jZU9mW190b10uYWRkKG5ld1Rva2VuKTsKICAgICAgICAvLyBhZGQgbmV3IHRva2VuIHRvIHRvdGFsU3VwcGx5CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQobmV3VG9rZW4pOwogICAgICAgIExvZ01pZ3JhdGUoX2Zyb20sIF90bywgbmV3VG9rZW4pOwogICAgICAgIFRyYW5zZmVyKHRoaXMsX3RvLG5ld1Rva2VuKTsKICAgIH0KCiAgICAvLyBtaWdhdGUgdG9rZW4gZnVuY3Rpb24gZm9yIE5hbWkgVGVhbQogICAgZnVuY3Rpb24gbWlncmF0ZVRva2VuKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgX21pZ3JhdGVUb2tlbihfZnJvbSwgX3RvKTsKICAgIH0KCiAgICAvLyBtaWdyYXRlIHRva2VuIGZvciBpbnZlc3RvcgogICAgZnVuY3Rpb24gbWlncmF0ZUZvckludmVzdG9yKCkgcHVibGljIHsKICAgICAgICBfbWlncmF0ZVRva2VuKG1zZy5zZW5kZXIsIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIE5hbWkgaW50ZXJuYWwgZXhjaGFuZ2UKICAgIAogICAgLy8gZXZlbnQgZm9yIE5hbWkgZXhjaGFuZ2UKICAgIGV2ZW50IFRyYW5zZmVyVG9CdXllcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgX3NlbGxlcik7CiAgICBldmVudCBUcmFuc2ZlclRvRXhjaGFuZ2UoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSwgdWludCBfcHJpY2UpOwogICAgCiAgICAKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlciB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIE5hbWlFeGNoYW5nZSBhZGRyZXNzLgogICAgICogICAgICBJbnZva2VzIHRoZSBgdG9rZW5GYWxsYmFja0V4Y2hhbmdlYCBmdW5jdGlvbi4KICAgICAqICAgICAgVGhlIHRva2VuIHRyYW5zZmVyIGZhaWxzIGlmIHRoZSByZWNpcGllbnQgaXMgYSBjb250cmFjdAogICAgICogICAgICBidXQgZG9lcyBub3QgaW1wbGVtZW50IHRoZSBgdG9rZW5GYWxsYmFja0V4Y2hhbmdlYCBmdW5jdGlvbgogICAgICogICAgICBvciB0aGUgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcmVjZWl2ZSBmdW5kcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvICAgIFJlY2VpdmVyIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkLgogICAgICogQHBhcmFtIF9wcmljZSBwcmljZSB0byBzZWxsIHRva2VuLgogICAgICovCiAgICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvRXhjaGFuZ2UoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IF9wcmljZSkgcHVibGljIHsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CiAgICAgICAgCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBjb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKF90bykKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gYmFsYW5jZU9mW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gYmFsYW5jZU9mW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlcixfdG8sX3ZhbHVlKTsKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrRXhjaGFuZ2UobXNnLnNlbmRlciwgX3ZhbHVlLCBfcHJpY2UpOwogICAgICAgICAgICBUcmFuc2ZlclRvRXhjaGFuZ2UobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9wcmljZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBOYW1pRXhjaGFuZ2UgYWRkcmVzcy4KICAgICAqICAgICAgSW52b2tlcyB0aGUgYHRva2VuRmFsbGJhY2tCdXllcmAgZnVuY3Rpb24uCiAgICAgKiAgICAgIFRoZSB0b2tlbiB0cmFuc2ZlciBmYWlscyBpZiB0aGUgcmVjaXBpZW50IGlzIGEgY29udHJhY3QKICAgICAqICAgICAgYnV0IGRvZXMgbm90IGltcGxlbWVudCB0aGUgYHRva2VuRmFsbGJhY2tCdXllcmAgZnVuY3Rpb24KICAgICAqICAgICAgb3IgdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHJlY2VpdmUgZnVuZHMuCiAgICAgKgogICAgICogQHBhcmFtIF90byAgICBSZWNlaXZlciBhZGRyZXNzLgogICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcnJlZC4KICAgICAqIEBwYXJhbSBfYnV5ZXIgYWRkcmVzcyBvZiBzZWxsZXIuCiAgICAgKi8KICAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9CdXllcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgX2J1eWVyKSBwdWJsaWMgewogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKICAgICAgICAKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KICAgICAgICAKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZU9mW190b10gPSBiYWxhbmNlT2ZbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLF90byxfdmFsdWUpOwogICAgICAgIGlmIChjb2RlTGVuZ3RoID4gMCkgewogICAgICAgICAgICBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0KF90byk7CiAgICAgICAgICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2tCdXllcihtc2cuc2VuZGVyLCBfdmFsdWUsIF9idXllcik7CiAgICAgICAgICAgIFRyYW5zZmVyVG9CdXllcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2J1eWVyKTsKICAgICAgICB9CiAgICB9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp9CgoKLyoKKiBCaW5hcnkgb3B0aW9uIHNtYXJ0IGNvbnRyYWN0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoqLwpjb250cmFjdCBCaW5hcnlPcHRpb24gewogICAgLyoKICAgICAqIGJpbmFyeSBvcHRpb24gY29udHJvbGVkIGJ5IGVzY3JvdyB0byBidXkgTkFDIHdpdGggZ29vZCBwcmljZQogICAgICovCiAgICAvLyBOYW1pQ3Jvd2RTYWxlIGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIG5hbWlDcm93ZFNhbGVBZGRyOwogICAgYWRkcmVzcyBwdWJsaWMgZXNjcm93OwogICAgCiAgICAvLyBuYW1pTXVsdGlTaWdXYWxsZXQKICAgIGFkZHJlc3MgcHVibGljIG5hbWlNdWx0aVNpZ1dhbGxldDsKICAgIAogICAgU2Vzc2lvbiBwdWJsaWMgc2Vzc2lvbjsKICAgIHVpbnQgcHVibGljIHRpbWVJbnZlc3RJbk1pbnV0ZSA9IDE1OwogICAgdWludCBwdWJsaWMgdGltZU9uZVNlc3Npb24gPSAyMDsKICAgIHVpbnQgcHVibGljIHNlc3Npb25JZCA9IDE7CiAgICB1aW50IHB1YmxpYyByYXRlV2luID0gMTAwOwogICAgdWludCBwdWJsaWMgcmF0ZUxvc3MgPSAyMDsKICAgIHVpbnQgcHVibGljIHJhdGVGZWUgPSA1OwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX0lOVkVTVE9SID0gMjA7CiAgICB1aW50IHB1YmxpYyBtaW5pbXVuRXRoID0gMTAwMDAwMDAwMDAwMDAwMDA7IC8vIG1pbmltdW5FdGggPSAwLjAxIGV0aAogICAgLyoqCiAgICAgKiBFdmVudHMgZm9yIGJpbmFueSBvcHRpb24gc3lzdGVtCiAgICAgKi8KICAgIGV2ZW50IFNlc3Npb25PcGVuKHVpbnQgdGltZU9wZW4sIHVpbnQgaW5kZXhlZCBzZXNzaW9uSWQpOwogICAgZXZlbnQgSW52ZXN0Q2xvc2UodWludCB0aW1lSW52ZXN0Q2xvc2UsIHVpbnQgcHJpY2VPcGVuLCB1aW50IGluZGV4ZWQgc2Vzc2lvbklkKTsKICAgIGV2ZW50IEludmVzdChhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIGJvb2wgY2hvb3NlLCB1aW50IGFtb3VudCwgdWludCB0aW1lSW52ZXN0LCB1aW50IGluZGV4ZWQgc2Vzc2lvbklkKTsKICAgIGV2ZW50IFNlc3Npb25DbG9zZSh1aW50IHRpbWVDbG9zZSwgdWludCBpbmRleGVkIHNlc3Npb25JZCwgdWludCBwcmljZUNsb3NlLCB1aW50IG5hY1ByaWNlLCB1aW50IHJhdGVXaW4sIHVpbnQgcmF0ZUxvc3MsIHVpbnQgcmF0ZUZlZSk7CgogICAgZXZlbnQgRGVwb3NpdChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IHZhbHVlKTsKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIGFsbG93cyB0byBkZXBvc2l0IGV0aGVyLgogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IDApCiAgICAgICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KICAgIC8vIHRoZXJlIGlzIG9ubHkgb25lIHNlc3Npb24gYXZhaWxhYmxlIGF0IG9uZSB0aW1lT3BlbgogICAgLy8gcHJpY2VPcGVuIGlzIHByaWNlIG9mIEVUSCBpbiBVU0QKICAgIC8vIHByaWNlQ2xvc2UgaXMgcHJpY2Ugb2YgRVRIIGluIFVTRAogICAgLy8gcHJvY2VzcyBvZiBvbmUgU2Vzc2lvbgogICAgLy8gMXN0OiBlc2Nyb3cgcmVzZXQgc2Vzc2lvbiBieSBydW4gcmVzZXRTZXNzaW9uKCkKICAgIC8vIDJuZDogZXNjcm93IG9wZW4gc2Vzc2lvbiBieSBydW4gb3BlblNlc3Npb24oKSA9PiBzYXZlIHRpbWVPcGVuIGF0IHRoaXMgdGltZQogICAgLy8gM3JkOiBhbGwgaW52ZXN0b3IgY2FuIGludmVzdCBieSBydW4gaW52ZXN0KCksIHNlbmQgbWluaW11bSAwLjEgRVRICiAgICAvLyA0dGg6IGVzY3JvdyBjbG9zZSBpbnZlc3QgYW5kIGluc2VydCBwcmljZSBvcGVuIGZvciB0aGlzIFNlc3Npb24KICAgIC8vIDV0aDogZXNjcm93IGNsb3NlIHNlc3Npb24gYW5kIHNlbmQgTkFDIGZvciBpbnZlc3RvcgogICAgc3RydWN0IFNlc3Npb24gewogICAgICAgIHVpbnQgcHJpY2VPcGVuOwogICAgICAgIHVpbnQgcHJpY2VDbG9zZTsKICAgICAgICB1aW50IHRpbWVPcGVuOwogICAgICAgIGJvb2wgaXNSZXNldDsKICAgICAgICBib29sIGlzT3BlbjsKICAgICAgICBib29sIGludmVzdE9wZW47CiAgICAgICAgdWludCBpbnZlc3RvckNvdW50OwogICAgICAgIG1hcHBpbmcodWludCA9PiBhZGRyZXNzKSBpbnZlc3RvcjsKICAgICAgICBtYXBwaW5nKHVpbnQgPT4gYm9vbCkgd2luOwogICAgICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBhbW91bnRJbnZlc3Q7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEJpbmFyeU9wdGlvbihhZGRyZXNzIF9uYW1pQ3Jvd2RTYWxlLCBhZGRyZXNzIF9lc2Nyb3csIGFkZHJlc3MgX25hbWlNdWx0aVNpZ1dhbGxldCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9uYW1pQ3Jvd2RTYWxlICE9IDB4MCAmJiBfZXNjcm93ICE9IDB4MCk7CiAgICAgICAgbmFtaUNyb3dkU2FsZUFkZHIgPSBfbmFtaUNyb3dkU2FsZTsKICAgICAgICBlc2Nyb3cgPSBfZXNjcm93OwogICAgICAgIG5hbWlNdWx0aVNpZ1dhbGxldCA9IF9uYW1pTXVsdGlTaWdXYWxsZXQ7CiAgICB9CiAgICAKICAgIAogICAgbW9kaWZpZXIgb25seUVzY3JvdygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PWVzY3Jvdyk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgICAgIAogICAgbW9kaWZpZXIgb25seU5hbWlNdWx0aXNpZygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmFtaU11bHRpU2lnV2FsbGV0KTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLyBjaGFuZ2UgZXNjcm93CiAgICBmdW5jdGlvbiBjaGFuZ2VFc2Nyb3coYWRkcmVzcyBfZXNjcm93KSBwdWJsaWMKICAgICAgICBvbmx5TmFtaU11bHRpc2lnCiAgICB7CiAgICAgICAgcmVxdWlyZShfZXNjcm93ICE9IDB4MCk7CiAgICAgICAgZXNjcm93ID0gX2VzY3JvdzsKICAgIH0KICAgIAogICAgLy8gY2hhZ25lIG1pbmltdW5FdGgKICAgIGZ1bmN0aW9uIGNoYW5nZU1pbkV0aCh1aW50IF9taW5pbXVuRXRoKSBwdWJsaWMgCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUoX21pbmltdW5FdGggIT0gMCk7CiAgICAgICAgbWluaW11bkV0aCA9IF9taW5pbXVuRXRoOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDaGFuZ2UgdGltZSBmb3IgaW52ZXN0b3IgY2FuIGludmVzdCBpbiBvbmUgc2Vzc2lvbiwgY2FuIG9ubHkgY2hhbmdlIGF0IHRpbWUgbm90IGluIHNlc3Npb24KICAgIC8vLyBAcGFyYW0gX3RpbWVJbnZlc3QgdGltZSBpbnZlc3QgaW4gbWludXRlcwogICAgLy8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tY2hhbmdlIHRpbWUgZnVuY3Rpb24tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGNoYW5nZVRpbWVJbnZlc3QodWludCBfdGltZUludmVzdCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZSghc2Vzc2lvbi5pc09wZW4gJiYgX3RpbWVJbnZlc3QgPCB0aW1lT25lU2Vzc2lvbik7CiAgICAgICAgdGltZUludmVzdEluTWludXRlID0gX3RpbWVJbnZlc3Q7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlVGltZU9uZVNlc3Npb24odWludCBfdGltZU9uZVNlc3Npb24pIAogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKCFzZXNzaW9uLmlzT3BlbiAmJiBfdGltZU9uZVNlc3Npb24gPiB0aW1lSW52ZXN0SW5NaW51dGUpOwogICAgICAgIHRpbWVPbmVTZXNzaW9uID0gX3RpbWVPbmVTZXNzaW9uOwogICAgfQoKICAgIC8vLy8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tY2hhbmdlIHJhdGUgZnVuY3Rpb24tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAKICAgIGZ1bmN0aW9uIGNoYW5nZVJhdGVXaW4odWludCBfcmF0ZVdpbikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZSghc2Vzc2lvbi5pc09wZW4pOwogICAgICAgIHJhdGVXaW4gPSBfcmF0ZVdpbjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2hhbmdlUmF0ZUxvc3ModWludCBfcmF0ZUxvc3MpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUoIXNlc3Npb24uaXNPcGVuKTsKICAgICAgICByYXRlTG9zcyA9IF9yYXRlTG9zczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2hhbmdlUmF0ZUZlZSh1aW50IF9yYXRlRmVlKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKCFzZXNzaW9uLmlzT3Blbik7CiAgICAgICAgcmF0ZUZlZSA9IF9yYXRlRmVlOwogICAgfQogICAgCiAgICAKICAgIC8vLyBAZGV2IHdpdGhkcmF3IGV0aGVyIHRvIG5hbWkgbXVsdGlzaWduYXR1cmUgd2FsbGV0LCBvbmx5IGVzY3JvdyBjYW4gY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IHZhbHVlIGV0aGVyIGluIHdlaSB0byB3aXRoZHJhdwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcih1aW50IF9hbW91bnQpIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKG5hbWlNdWx0aVNpZ1dhbGxldCAhPSAweDApOwogICAgICAgIC8vIEF2YWlsYWJsZSBhdCBhbnkgcGhhc2UuCiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA+IDApIHsKICAgICAgICAgICAgbmFtaU11bHRpU2lnV2FsbGV0LnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgc2FmZSB3aXRoZHJhdyBFdGhlciB0byBvbmUgb2Ygb3duZXIgb2YgbmFtaSBtdWx0aXNpZ25hdHVyZSB3YWxsZXQKICAgIC8vLyBAcGFyYW0gX3dpdGhkcmF3IGFkZHJlc3MgdG8gd2l0aGRyYXcKICAgIGZ1bmN0aW9uIHNhZmVXaXRoZHJhdyhhZGRyZXNzIF93aXRoZHJhdywgdWludCBfYW1vdW50KSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgTmFtaU11bHRpU2lnV2FsbGV0IG5hbWlXYWxsZXQgPSBOYW1pTXVsdGlTaWdXYWxsZXQobmFtaU11bHRpU2lnV2FsbGV0KTsKICAgICAgICBpZiAobmFtaVdhbGxldC5pc093bmVyKF93aXRoZHJhdykpIHsKICAgICAgICAgICAgX3dpdGhkcmF3LnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2Ygb3duZXJzLgogICAgLy8gQHJldHVybiBMaXN0IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIC8vIE1BWF9JTlZFU1RPUiA9IDIwCiAgICBmdW5jdGlvbiBnZXRJbnZlc3RvcnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzWzIwXSkKICAgIHsKICAgICAgICBhZGRyZXNzWzIwXSBtZW1vcnkgbGlzdEludmVzdG9yOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IE1BWF9JTlZFU1RPUjsgaSsrKSB7CiAgICAgICAgICAgIGxpc3RJbnZlc3RvcltpXSA9IHNlc3Npb24uaW52ZXN0b3JbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBsaXN0SW52ZXN0b3I7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldENob29zZXMoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sWzIwXSkKICAgIHsKICAgICAgICBib29sWzIwXSBtZW1vcnkgbGlzdENob29zZXM7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgTUFYX0lOVkVTVE9SOyBpKyspIHsKICAgICAgICAgICAgbGlzdENob29zZXNbaV0gPSBzZXNzaW9uLndpbltpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxpc3RDaG9vc2VzOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRBbW91bnQoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50WzIwXSkKICAgIHsKICAgICAgICB1aW50WzIwXSBtZW1vcnkgbGlzdEFtb3VudDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBNQVhfSU5WRVNUT1I7IGkrKykgewogICAgICAgICAgICBsaXN0QW1vdW50W2ldID0gc2Vzc2lvbi5hbW91bnRJbnZlc3RbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBsaXN0QW1vdW50OwogICAgfQogICAgCiAgICAvLy8gQGRldiByZXNldCBhbGwgZGF0YSBvZiBwcmV2aW91cyBzZXNzaW9uLCBtdXN0IHJ1biBiZWZvcmUgb3BlbiBuZXcgc2Vzc2lvbgogICAgLy8gb25seSBlc2Nyb3cgY2FuIGNhbGwKICAgIGZ1bmN0aW9uIHJlc2V0U2Vzc2lvbigpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUoIXNlc3Npb24uaXNSZXNldCAmJiAhc2Vzc2lvbi5pc09wZW4pOwogICAgICAgIHNlc3Npb24ucHJpY2VPcGVuID0gMDsKICAgICAgICBzZXNzaW9uLnByaWNlQ2xvc2UgPSAwOwogICAgICAgIHNlc3Npb24uaXNSZXNldCA9IHRydWU7CiAgICAgICAgc2Vzc2lvbi5pc09wZW4gPSBmYWxzZTsKICAgICAgICBzZXNzaW9uLmludmVzdE9wZW4gPSBmYWxzZTsKICAgICAgICBzZXNzaW9uLmludmVzdG9yQ291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IE1BWF9JTlZFU1RPUjsgaSsrKSB7CiAgICAgICAgICAgIHNlc3Npb24uaW52ZXN0b3JbaV0gPSAweDA7CiAgICAgICAgICAgIHNlc3Npb24ud2luW2ldID0gZmFsc2U7CiAgICAgICAgICAgIHNlc3Npb24uYW1vdW50SW52ZXN0W2ldID0gMDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IE9wZW4gbmV3IHNlc3Npb24sIG9ubHkgZXNjcm93IGNhbiBjYWxsCiAgICBmdW5jdGlvbiBvcGVuU2Vzc2lvbiAoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKHNlc3Npb24uaXNSZXNldCAmJiAhc2Vzc2lvbi5pc09wZW4pOwogICAgICAgIHNlc3Npb24uaXNSZXNldCA9IGZhbHNlOwogICAgICAgIC8vIG9wZW4gaW52ZXN0CiAgICAgICAgc2Vzc2lvbi5pbnZlc3RPcGVuID0gdHJ1ZTsKICAgICAgICBzZXNzaW9uLnRpbWVPcGVuID0gbm93OwogICAgICAgIHNlc3Npb24uaXNPcGVuID0gdHJ1ZTsKICAgICAgICBTZXNzaW9uT3Blbihub3csIHNlc3Npb25JZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEZ1Y3Rpb24gZm9yIGludmVzdG9yLCBtaW5pbXVuIGV0aGVyIHNlbmQgaXMgMC4xLCBvbmUgYWRkcmVzcyBjYW4gY2FsbCBvbmUgdGltZSBpbiBvbmUgc2Vzc2lvbgogICAgLy8vIEBwYXJhbSBfY2hvb3NlIGNob2lzZSBvZiBpbnZlc3RvciwgdHJ1ZSBpcyBjYWxsLCBmYWxzZSBpcyBwdXQKICAgIGZ1bmN0aW9uIGludmVzdCAoYm9vbCBfY2hvb3NlKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5pbXVuRXRoICYmIHNlc3Npb24uaW52ZXN0T3Blbik7IC8vIG1zZy52YWx1ZSA+PSAwLjEgZXRoZXIKICAgICAgICByZXF1aXJlKG5vdyA8IChzZXNzaW9uLnRpbWVPcGVuICsgdGltZUludmVzdEluTWludXRlICogMSBtaW51dGVzKSk7CiAgICAgICAgcmVxdWlyZShzZXNzaW9uLmludmVzdG9yQ291bnQgPCBNQVhfSU5WRVNUT1IpOwogICAgICAgIHNlc3Npb24uaW52ZXN0b3Jbc2Vzc2lvbi5pbnZlc3RvckNvdW50XSA9IG1zZy5zZW5kZXI7CiAgICAgICAgc2Vzc2lvbi53aW5bc2Vzc2lvbi5pbnZlc3RvckNvdW50XSA9IF9jaG9vc2U7CiAgICAgICAgc2Vzc2lvbi5hbW91bnRJbnZlc3Rbc2Vzc2lvbi5pbnZlc3RvckNvdW50XSA9IG1zZy52YWx1ZTsKICAgICAgICBzZXNzaW9uLmludmVzdG9yQ291bnQgKz0gMTsKICAgICAgICBJbnZlc3QobXNnLnNlbmRlciwgX2Nob29zZSwgbXNnLnZhbHVlLCBub3csIHNlc3Npb25JZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IGNsb3NlIGludmVzdCBmb3IgZXNjcm93CiAgICAvLy8gQHBhcmFtIF9wcmljZU9wZW4gcHJpY2UgRVRIIGluIFVTRAogICAgZnVuY3Rpb24gY2xvc2VJbnZlc3QgKHVpbnQgX3ByaWNlT3BlbikgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUoX3ByaWNlT3BlbiAhPSAwICYmIHNlc3Npb24uaW52ZXN0T3Blbik7CiAgICAgICAgcmVxdWlyZShub3cgPiAoc2Vzc2lvbi50aW1lT3BlbiArIHRpbWVJbnZlc3RJbk1pbnV0ZSAqIDEgbWludXRlcykpOwogICAgICAgIHNlc3Npb24uaW52ZXN0T3BlbiA9IGZhbHNlOwogICAgICAgIHNlc3Npb24ucHJpY2VPcGVuID0gX3ByaWNlT3BlbjsKICAgICAgICBJbnZlc3RDbG9zZShub3csIF9wcmljZU9wZW4sIHNlc3Npb25JZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IGdldCBhbW91bnQgb2YgZXRoZXIgdG8gYnV5IE5BQyBmb3IgaW52ZXN0b3IKICAgIC8vLyBAcGFyYW0gX2V0aGVyIGFtb3VudCBldGhlciB3aGljaCBpbnZlc3RvciBpbnZlc3QKICAgIC8vLyBAcGFyYW0gX3N0YXR1cyB0cnVlIGZvciBpbnZlc3RvciB3aW4gYW5kIGZhbHNlIGZvciBpbnZlc3RvciBsb3NzCiAgICBmdW5jdGlvbiBnZXRFdGhlclRvQnV5ICh1aW50IF9ldGhlciwgYm9vbCBfc3RhdHVzKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIGlmIChfc3RhdHVzKSB7CiAgICAgICAgICAgIHJldHVybiBfZXRoZXIgKiByYXRlV2luIC8gMTAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBfZXRoZXIgKiByYXRlTG9zcyAvIDEwMDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgY2xvc2Ugc2Vzc2lvbiwgb25seSBlc2Nyb3cgY2FuIGNhbGwKICAgIC8vLyBAcGFyYW0gX3ByaWNlQ2xvc2UgcHJpY2Ugb2YgRVRIIGluIFVTRAogICAgZnVuY3Rpb24gY2xvc2VTZXNzaW9uICh1aW50IF9wcmljZUNsb3NlKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKF9wcmljZUNsb3NlICE9IDAgJiYgbm93ID4gKHNlc3Npb24udGltZU9wZW4gKyB0aW1lT25lU2Vzc2lvbiAqIDEgbWludXRlcykpOwogICAgICAgIHJlcXVpcmUoIXNlc3Npb24uaW52ZXN0T3BlbiAmJiBzZXNzaW9uLmlzT3Blbik7CiAgICAgICAgc2Vzc2lvbi5wcmljZUNsb3NlID0gX3ByaWNlQ2xvc2U7CiAgICAgICAgYm9vbCByZXN1bHQgPSAoX3ByaWNlQ2xvc2U+c2Vzc2lvbi5wcmljZU9wZW4pP3RydWU6ZmFsc2U7CiAgICAgICAgdWludCBldGhlclRvQnV5OwogICAgICAgIE5hbWlDcm93ZFNhbGUgbmFtaUNvbnRyYWN0ID0gTmFtaUNyb3dkU2FsZShuYW1pQ3Jvd2RTYWxlQWRkcik7CiAgICAgICAgdWludCBwcmljZSA9IG5hbWlDb250cmFjdC5nZXRQcmljZSgpOwogICAgICAgIHJlcXVpcmUocHJpY2UgIT0gMCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc2Vzc2lvbi5pbnZlc3RvckNvdW50OyBpKyspIHsKICAgICAgICAgICAgaWYgKHNlc3Npb24ud2luW2ldPT1yZXN1bHQpIHsKICAgICAgICAgICAgICAgIGV0aGVyVG9CdXkgPSAoc2Vzc2lvbi5hbW91bnRJbnZlc3RbaV0gLSBzZXNzaW9uLmFtb3VudEludmVzdFtpXSAqIHJhdGVGZWUgLyAxMDApICogcmF0ZVdpbiAvIDEwMDsKICAgICAgICAgICAgICAgIHVpbnQgZXRoZXJSZXR1cm4gPSBzZXNzaW9uLmFtb3VudEludmVzdFtpXSAtIHNlc3Npb24uYW1vdW50SW52ZXN0W2ldICogcmF0ZUZlZSAvIDEwMDsKICAgICAgICAgICAgICAgIChzZXNzaW9uLmludmVzdG9yW2ldKS50cmFuc2ZlcihldGhlclJldHVybik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBldGhlclRvQnV5ID0gKHNlc3Npb24uYW1vdW50SW52ZXN0W2ldIC0gc2Vzc2lvbi5hbW91bnRJbnZlc3RbaV0gKiByYXRlRmVlIC8gMTAwKSAqIHJhdGVMb3NzIC8gMTAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5hbWlDb250cmFjdC5idXkudmFsdWUoZXRoZXJUb0J1eSkoc2Vzc2lvbi5pbnZlc3RvcltpXSk7CiAgICAgICAgICAgIC8vIHJlc2V0IGludmVzdG9yCiAgICAgICAgICAgIHNlc3Npb24uaW52ZXN0b3JbaV0gPSAweDA7CiAgICAgICAgICAgIHNlc3Npb24ud2luW2ldID0gZmFsc2U7CiAgICAgICAgICAgIHNlc3Npb24uYW1vdW50SW52ZXN0W2ldID0gMDsKICAgICAgICB9CiAgICAgICAgc2Vzc2lvbi5pc09wZW4gPSBmYWxzZTsKICAgICAgICBTZXNzaW9uQ2xvc2Uobm93LCBzZXNzaW9uSWQsIF9wcmljZUNsb3NlLCBwcmljZSwgcmF0ZVdpbiwgcmF0ZUxvc3MsIHJhdGVGZWUpOwogICAgICAgIHNlc3Npb25JZCArPSAxOwogICAgICAgIAogICAgICAgIC8vIHJlcXVpcmUoIXNlc3Npb24uaXNSZXNldCAmJiAhc2Vzc2lvbi5pc09wZW4pOwogICAgICAgIC8vIHJlc2V0IHN0YXRlIHNlc3Npb24KICAgICAgICBzZXNzaW9uLnByaWNlT3BlbiA9IDA7CiAgICAgICAgc2Vzc2lvbi5wcmljZUNsb3NlID0gMDsKICAgICAgICBzZXNzaW9uLmlzUmVzZXQgPSB0cnVlOwogICAgICAgIHNlc3Npb24uaW52ZXN0T3BlbiA9IGZhbHNlOwogICAgICAgIHNlc3Npb24uaW52ZXN0b3JDb3VudCA9IDA7CiAgICB9Cn0KCgpjb250cmFjdCBQcmVzYWxlVG9rZW4gewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZU9mOwogICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF9vd25lcikgcHVibGljOwp9CgogLyoKICogQ29udHJhY3QgdGhhdCBpcyB3b3JraW5nIHdpdGggRVJDMjIzIHRva2VucwogKi8KIAogLyoqCiAqIEB0aXRsZSBDb250cmFjdCB0aGF0IHdpbGwgd29yayB3aXRoIEVSQzIyMyB0b2tlbnMuCiAqLwogCmNvbnRyYWN0IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHsKLyoqCiAqIEBkZXYgU3RhbmRhcmQgRVJDMjIzIGZ1bmN0aW9uIHRoYXQgd2lsbCBoYW5kbGUgaW5jb21pbmcgdG9rZW4gdHJhbnNmZXJzLgogKgogKiBAcGFyYW0gX2Zyb20gIFRva2VuIHNlbmRlciBhZGRyZXNzLgogKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMuCiAqIEBwYXJhbSBfZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAqLwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFja0J1eWVyKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIF9idXllcikgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrRXhjaGFuZ2UoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIHVpbnQgX3ByaWNlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKCiAvKgogKiBOYW1pIEludGVybmFsIEV4Y2hhbmdlIHNtYXJ0Y29udHJhY3QtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKgogKi8KCmNvbnRyYWN0IE5hbWlFeGNoYW5nZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKICAgIAogICAgZnVuY3Rpb24gTmFtaUV4Y2hhbmdlKGFkZHJlc3MgX25hbWlBZGRyZXNzKSBwdWJsaWMgewogICAgICAgIE5hbWlBZGRyID0gX25hbWlBZGRyZXNzOwogICAgfQoKICAgIGV2ZW50IFVwZGF0ZUJpZChhZGRyZXNzIG93bmVyLCB1aW50IHByaWNlLCB1aW50IGJhbGFuY2UpOwogICAgZXZlbnQgVXBkYXRlQXNrKGFkZHJlc3Mgb3duZXIsIHVpbnQgcHJpY2UsIHVpbnQgdm9sdW1lKTsKICAgIGV2ZW50IEJ1eUhpc3RvcnkoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50IHByaWNlLCB1aW50IHZvbHVtZSwgdWludCB0aW1lKTsKICAgIGV2ZW50IFNlbGxIaXN0b3J5KGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBwcmljZSwgdWludCB2b2x1bWUsIHVpbnQgdGltZSk7CgogICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gT3JkZXJCaWQpIHB1YmxpYyBiaWQ7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gT3JkZXJBc2spIHB1YmxpYyBhc2s7CiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiTmFjRXhjaGFuZ2UiOwogICAgCiAgICAvLy8gYWRkcmVzcyBvZiBOYW1pIHRva2VuCiAgICBhZGRyZXNzIHB1YmxpYyBOYW1pQWRkcjsKICAgIAogICAgLy8vIHByaWNlIG9mIE5hYyA9IEVUSC9OQUMKICAgIHVpbnQgcHVibGljIHByaWNlID0gMTsKICAgIC8vIHN0cnVjdCBzdG9yZSBvcmRlciBvZiB1c2VyCiAgICBzdHJ1Y3QgT3JkZXJCaWQgewogICAgICAgIHVpbnQgcHJpY2U7CiAgICAgICAgdWludCBldGg7CiAgICB9CiAgICAKICAgIHN0cnVjdCBPcmRlckFzayB7CiAgICAgICAgdWludCBwcmljZTsKICAgICAgICB1aW50IHZvbHVtZTsKICAgIH0KICAgIAogICAgICAgIAogICAgLy8gcHJldmVudCBsb3N0IGV0aGVyCiAgICBmdW5jdGlvbigpIHBheWFibGUgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCAhPSAwKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seU5hbWkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBOYW1pQWRkcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tZnVuY3Rpb24gYWJvdXQgYmlkIE9yZGVyLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIAogICAgZnVuY3Rpb24gcGxhY2VCdXlPcmRlcih1aW50IF9wcmljZSkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3ByaWNlID4gMCAmJiBtc2cudmFsdWUgPiAwICYmIGJpZFttc2cuc2VuZGVyXS5ldGggPT0gMCk7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmlkW21zZy5zZW5kZXJdLmV0aCA9IChiaWRbbXNnLnNlbmRlcl0uZXRoKS5hZGQobXNnLnZhbHVlKTsKICAgICAgICAgICAgYmlkW21zZy5zZW5kZXJdLnByaWNlID0gX3ByaWNlOwogICAgICAgICAgICBVcGRhdGVCaWQobXNnLnNlbmRlciwgX3ByaWNlLCBiaWRbbXNnLnNlbmRlcl0uZXRoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNlbGxOYWModWludCBfdmFsdWUsIGFkZHJlc3MgX2J1eWVyLCB1aW50IF9wcmljZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3ByaWNlID09IGJpZFtfYnV5ZXJdLnByaWNlICYmIF9idXllciAhPSBtc2cuc2VuZGVyKTsKICAgICAgICBOYW1pQ3Jvd2RTYWxlIG5hbWlUb2tlbiA9IE5hbWlDcm93ZFNhbGUoTmFtaUFkZHIpOwogICAgICAgIHVpbnQgZXRoT2ZCdXllciA9IGJpZFtfYnV5ZXJdLmV0aDsKICAgICAgICB1aW50IG1heFRva2VuID0gZXRoT2ZCdXllci5tdWwoYmlkW19idXllcl0ucHJpY2UpOwogICAgICAgIHJlcXVpcmUobmFtaVRva2VuLmFsbG93YW5jZShtc2cuc2VuZGVyLCB0aGlzKSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCAmJiBldGhPZkJ1eWVyICE9IDAgJiYgX2J1eWVyICE9IDB4MCk7CiAgICAgICAgaWYgKF92YWx1ZSA+IG1heFRva2VuKSB7CiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQoZXRoT2ZCdXllcikgJiYgbmFtaVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLF9idXllcixtYXhUb2tlbikpIHsKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBvcmRlcgogICAgICAgICAgICAgICAgYmlkW19idXllcl0uZXRoID0gMDsKICAgICAgICAgICAgICAgIFVwZGF0ZUJpZChfYnV5ZXIsIGJpZFtfYnV5ZXJdLnByaWNlLCBiaWRbX2J1eWVyXS5ldGgpOwogICAgICAgICAgICAgICAgQnV5SGlzdG9yeShfYnV5ZXIsIG1zZy5zZW5kZXIsIGJpZFtfYnV5ZXJdLnByaWNlLCBtYXhUb2tlbiwgbm93KTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcmV2ZXJ0IGFueXRoaW5nCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQgZXRoID0gX3ZhbHVlLmRpdihiaWRbX2J1eWVyXS5wcmljZSk7CiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQoZXRoKSAmJiBuYW1pVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsX2J1eWVyLF92YWx1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBvcmRlcgogICAgICAgICAgICAgICAgYmlkW19idXllcl0uZXRoID0gKGJpZFtfYnV5ZXJdLmV0aCkuc3ViKGV0aCk7CiAgICAgICAgICAgICAgICBVcGRhdGVCaWQoX2J1eWVyLCBiaWRbX2J1eWVyXS5wcmljZSwgYmlkW19idXllcl0uZXRoKTsKICAgICAgICAgICAgICAgIEJ1eUhpc3RvcnkoX2J1eWVyLCBtc2cuc2VuZGVyLCBiaWRbX2J1eWVyXS5wcmljZSwgX3ZhbHVlLCBub3cpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyByZXZlcnQgYW55dGhpbmcKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBjbG9zZUJpZE9yZGVyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGJpZFttc2cuc2VuZGVyXS5ldGggPiAwICYmIGJpZFttc2cuc2VuZGVyXS5wcmljZSA+IDApOwogICAgICAgIC8vIHRyYW5zZmVyIEVUSAogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkW21zZy5zZW5kZXJdLmV0aCk7CiAgICAgICAgLy8gdXBkYXRlIG9yZGVyCiAgICAgICAgYmlkW21zZy5zZW5kZXJdLmV0aCA9IDA7CiAgICAgICAgVXBkYXRlQmlkKG1zZy5zZW5kZXIsIGJpZFttc2cuc2VuZGVyXS5wcmljZSwgYmlkW21zZy5zZW5kZXJdLmV0aCk7CiAgICB9CiAgICAKCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLWZ1bmN0aW9uIGFib3V0IGFzayBPcmRlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAKICAgIC8vIHBsYWNlIGFzayBvcmRlciBieSBzZW5kIE5BQyB0byBOYW1pIEV4Y2hhbmdlIGNvbnRyYWN0CiAgICAvLyB0aGlzIGZ1bmN0aW9uIHBsYWNlIHNlbGwgb3JkZXIKICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2tFeGNoYW5nZShhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgdWludCBfcHJpY2UpIG9ubHlOYW1pIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF9wcmljZSA+IDAgJiYgX3ZhbHVlID4gMCAmJiBhc2tbX2Zyb21dLnZvbHVtZSA9PSAwKTsKICAgICAgICBpZiAoX3ZhbHVlID4gMCkgewogICAgICAgICAgICBhc2tbX2Zyb21dLnZvbHVtZSA9IChhc2tbX2Zyb21dLnZvbHVtZSkuYWRkKF92YWx1ZSk7CiAgICAgICAgICAgIGFza1tfZnJvbV0ucHJpY2UgPSBfcHJpY2U7CiAgICAgICAgICAgIFVwZGF0ZUFzayhfZnJvbSwgX3ByaWNlLCBhc2tbX2Zyb21dLnZvbHVtZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjbG9zZUFza09yZGVyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGFza1ttc2cuc2VuZGVyXS52b2x1bWUgPiAwICYmIGFza1ttc2cuc2VuZGVyXS5wcmljZSA+IDApOwogICAgICAgIE5hbWlDcm93ZFNhbGUgbmFtaVRva2VuID0gTmFtaUNyb3dkU2FsZShOYW1pQWRkcik7CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VzID0gbmFtaVRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKTsKICAgICAgICAvLyB0cmFuc2ZlciB0b2tlbgogICAgICAgIG5hbWlUb2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBhc2tbbXNnLnNlbmRlcl0udm9sdW1lKTsKICAgICAgICAvLyB1cGRhdGUgb3JkZXIKICAgICAgICBhc2tbbXNnLnNlbmRlcl0udm9sdW1lID0gMDsKICAgICAgICBVcGRhdGVBc2sobXNnLnNlbmRlciwgYXNrW21zZy5zZW5kZXJdLnByaWNlLCAwKTsKICAgICAgICAvLyBjaGVjayBiYWxhbmNlCiAgICAgICAgYXNzZXJ0KHByZXZpb3VzQmFsYW5jZXMgPCBuYW1pVG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5TmFjKGFkZHJlc3MgX3NlbGxlciwgdWludCBfcHJpY2UpIHBheWFibGUgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCAmJiBhc2tbX3NlbGxlcl0udm9sdW1lID4gMCAmJiBhc2tbX3NlbGxlcl0ucHJpY2UgPiAwKTsKICAgICAgICByZXF1aXJlKF9wcmljZSA9PSBhc2tbX3NlbGxlcl0ucHJpY2UgJiYgX3NlbGxlciAhPSBtc2cuc2VuZGVyKTsKICAgICAgICBOYW1pQ3Jvd2RTYWxlIG5hbWlUb2tlbiA9IE5hbWlDcm93ZFNhbGUoTmFtaUFkZHIpOwogICAgICAgIHVpbnQgbWF4RXRoID0gKGFza1tfc2VsbGVyXS52b2x1bWUpLmRpdihhc2tbX3NlbGxlcl0ucHJpY2UpOwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlcyA9IG5hbWlUb2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IG1heEV0aCkgewogICAgICAgICAgICBpZiAoX3NlbGxlci5zZW5kKG1heEV0aCkgJiYgbXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZS5zdWIobWF4RXRoKSkpIHsKICAgICAgICAgICAgICAgIC8vIHRyYW5zZmVyIHRva2VuCiAgICAgICAgICAgICAgICBuYW1pVG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgYXNrW19zZWxsZXJdLnZvbHVtZSk7CiAgICAgICAgICAgICAgICBTZWxsSGlzdG9yeShfc2VsbGVyLCBtc2cuc2VuZGVyLCBhc2tbX3NlbGxlcl0ucHJpY2UsIGFza1tfc2VsbGVyXS52b2x1bWUsIG5vdyk7CiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgb3JkZXIKICAgICAgICAgICAgICAgIGFza1tfc2VsbGVyXS52b2x1bWUgPSAwOwogICAgICAgICAgICAgICAgVXBkYXRlQXNrKF9zZWxsZXIsIGFza1tfc2VsbGVyXS5wcmljZSwgMCk7CiAgICAgICAgICAgICAgICBhc3NlcnQocHJldmlvdXNCYWxhbmNlcyA8IG5hbWlUb2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcikpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyByZXZlcnQgYW55dGhpbmcKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludCBuYWMgPSAobXNnLnZhbHVlKS5tdWwoYXNrW19zZWxsZXJdLnByaWNlKTsKICAgICAgICAgICAgaWYgKF9zZWxsZXIuc2VuZChtc2cudmFsdWUpKSB7CiAgICAgICAgICAgICAgICAvLyB0cmFuc2ZlciB0b2tlbgogICAgICAgICAgICAgICAgbmFtaVRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG5hYyk7CiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgb3JkZXIKICAgICAgICAgICAgICAgIGFza1tfc2VsbGVyXS52b2x1bWUgPSAoYXNrW19zZWxsZXJdLnZvbHVtZSkuc3ViKG5hYyk7CiAgICAgICAgICAgICAgICBVcGRhdGVBc2soX3NlbGxlciwgYXNrW19zZWxsZXJdLnByaWNlLCBhc2tbX3NlbGxlcl0udm9sdW1lKTsKICAgICAgICAgICAgICAgIFNlbGxIaXN0b3J5KF9zZWxsZXIsIG1zZy5zZW5kZXIsIGFza1tfc2VsbGVyXS5wcmljZSwgbmFjLCBub3cpOwogICAgICAgICAgICAgICAgYXNzZXJ0KHByZXZpb3VzQmFsYW5jZXMgPCBuYW1pVG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcmV2ZXJ0IGFueXRoaW5nCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgRVJDMjMgewogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9CgoKCi8qCiogTmFtaU11bHRpU2lnV2FsbGV0IHNtYXJ0IGNvbnRyYWN0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoqLwovLy8gQHRpdGxlIE11bHRpc2lnbmF0dXJlIHdhbGxldCAtIEFsbG93cyBtdWx0aXBsZSBwYXJ0aWVzIHRvIGFncmVlIG9uIHRyYW5zYWN0aW9ucyBiZWZvcmUgZXhlY3V0aW9uLgpjb250cmFjdCBOYW1pTXVsdGlTaWdXYWxsZXQgewoKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIE1BWF9PV05FUl9DT1VOVCA9IDUwOwoKICAgIGV2ZW50IENvbmZpcm1hdGlvbihhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IFN1Ym1pc3Npb24odWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRXhlY3V0aW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IEV4ZWN1dGlvbkZhaWx1cmUodWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRGVwb3NpdChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IE93bmVyQWRkaXRpb24oYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IE93bmVyUmVtb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2UodWludCByZXF1aXJlZCk7CgogICAgbWFwcGluZyAodWludCA9PiBUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIGNvbmZpcm1hdGlvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc093bmVyOwogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lcnM7CiAgICB1aW50IHB1YmxpYyByZXF1aXJlZDsKICAgIHVpbnQgcHVibGljIHRyYW5zYWN0aW9uQ291bnQ7CgogICAgc3RydWN0IFRyYW5zYWN0aW9uIHsKICAgICAgICBhZGRyZXNzIGRlc3RpbmF0aW9uOwogICAgICAgIHVpbnQgdmFsdWU7CiAgICAgICAgYnl0ZXMgZGF0YTsKICAgICAgICBib29sIGV4ZWN1dGVkOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlXYWxsZXQoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJEb2VzTm90RXhpc3QoYWRkcmVzcyBvd25lcikgewogICAgICAgIHJlcXVpcmUoIWlzT3duZXJbb3duZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXJbb3duZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHRyYW5zYWN0aW9uRXhpc3RzKHVpbnQgdHJhbnNhY3Rpb25JZCkgewogICAgICAgIHJlcXVpcmUodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmRlc3RpbmF0aW9uICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIHJlcXVpcmUoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90Q29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIHJlcXVpcmUoIWNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdEV4ZWN1dGVkKHVpbnQgdHJhbnNhY3Rpb25JZCkgewogICAgICAgIHJlcXVpcmUoIXRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5leGVjdXRlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3ROdWxsKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRSZXF1aXJlbWVudCh1aW50IG93bmVyQ291bnQsIHVpbnQgX3JlcXVpcmVkKSB7CiAgICAgICAgcmVxdWlyZSghKG93bmVyQ291bnQgPiBNQVhfT1dORVJfQ09VTlQKICAgICAgICAgICAgfHwgX3JlcXVpcmVkID4gb3duZXJDb3VudAogICAgICAgICAgICB8fCBfcmVxdWlyZWQgPT0gMAogICAgICAgICAgICB8fCBvd25lckNvdW50ID09IDApKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIGFsbG93cyB0byBkZXBvc2l0IGV0aGVyLgogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IDApCiAgICAgICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBzZXRzIGluaXRpYWwgb3duZXJzIGFuZCByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucy4KICAgIC8vLyBAcGFyYW0gX293bmVycyBMaXN0IG9mIGluaXRpYWwgb3duZXJzLgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBOYW1pTXVsdGlTaWdXYWxsZXQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkUmVxdWlyZW1lbnQoX293bmVycy5sZW5ndGgsIF9yZXF1aXJlZCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfb3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoIShpc093bmVyW19vd25lcnNbaV1dIHx8IF9vd25lcnNbaV0gPT0gMCkpOwogICAgICAgICAgICBpc093bmVyW19vd25lcnNbaV1dID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgb3duZXJzID0gX293bmVyczsKICAgICAgICByZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gYWRkIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBvd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgb3duZXJEb2VzTm90RXhpc3Qob3duZXIpCiAgICAgICAgbm90TnVsbChvd25lcikKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggKyAxLCByZXF1aXJlZCkKICAgIHsKICAgICAgICBpc093bmVyW293bmVyXSA9IHRydWU7CiAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24ob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byByZW1vdmUgYW4gb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgICAgIG93bmVyc1tpXSA9IG93bmVyc1tvd25lcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvd25lcnMubGVuZ3RoIC09IDE7CiAgICAgICAgaWYgKHJlcXVpcmVkID4gb3duZXJzLmxlbmd0aCkKICAgICAgICAgICAgY2hhbmdlUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCk7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVwbGFjZSBhbiBvd25lciB3aXRoIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIgdG8gYmUgcmVwbGFjZWQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gcmVwbGFjZU93bmVyKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KG5ld093bmVyKQogICAgewogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgICAgIG93bmVyc1tpXSA9IG5ld093bmVyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaXNPd25lcltvd25lcl0gPSBmYWxzZTsKICAgICAgICBpc093bmVyW25ld093bmVyXSA9IHRydWU7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgICAgICBPd25lckFkZGl0aW9uKG5ld093bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gY2hhbmdlIHRoZSBudW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgdmFsaWRSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2UoX3JlcXVpcmVkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gc3VibWl0IGFuZCBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IGFkZFRyYW5zYWN0aW9uKGRlc3RpbmF0aW9uLCB2YWx1ZSwgZGF0YSk7CiAgICAgICAgY29uZmlybVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICAgICAgdHJhbnNhY3Rpb25FeGlzdHModHJhbnNhY3Rpb25JZCkKICAgICAgICBub3RDb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICAgICAgZXhlY3V0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byByZXZva2UgYSBjb25maXJtYXRpb24gZm9yIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiByZXZva2VDb25maXJtYXRpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICAgICAgY29uZmlybWVkKHRyYW5zYWN0aW9uSWQsIG1zZy5zZW5kZXIpCiAgICAgICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gZmFsc2U7CiAgICAgICAgUmV2b2NhdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW55b25lIHRvIGV4ZWN1dGUgYSBjb25maXJtZWQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBleGVjdXRlVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgaWYgKGlzQ29uZmlybWVkKHRyYW5zYWN0aW9uSWQpKSB7CiAgICAgICAgICAgIC8vIFRyYW5zYWN0aW9uIHR4ID0gdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdOwogICAgICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgICAgICAvLyB0eC5leGVjdXRlZCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZGVzdGluYXRpb24uY2FsbC52YWx1ZSh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0udmFsdWUpKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5kYXRhKSkgewogICAgICAgICAgICAgICAgRXhlY3V0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgRXhlY3V0aW9uRmFpbHVyZSh0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5leGVjdXRlZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIENvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICBmdW5jdGlvbiBpc0NvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgaWYgKGNvdW50ID09IHJlcXVpcmVkKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQWRkcyBhIG5ldyB0cmFuc2FjdGlvbiB0byB0aGUgdHJhbnNhY3Rpb24gbWFwcGluZywgaWYgdHJhbnNhY3Rpb24gZG9lcyBub3QgZXhpc3QgeWV0LgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGFkZFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBub3ROdWxsKGRlc3RpbmF0aW9uKQogICAgICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICB0cmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25Db3VudDsKICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0gPSBUcmFuc2FjdGlvbih7CiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbiwgCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgZXhlY3V0ZWQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgdHJhbnNhY3Rpb25Db3VudCArPSAxOwogICAgICAgIFN1Ym1pc3Npb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLyoKICAgICAqIFdlYjMgY2FsbCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBvZiBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBnZXRDb25maXJtYXRpb25Db3VudCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IGNvdW50KQogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0b3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbGVycyBhcmUgYXBwbGllZC4KICAgIC8vLyBAcGFyYW0gcGVuZGluZyBJbmNsdWRlIHBlbmRpbmcgdHJhbnNhY3Rpb25zLgogICAgLy8vIEBwYXJhbSBleGVjdXRlZCBJbmNsdWRlIGV4ZWN1dGVkIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcmV0dXJuIFRvdGFsIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgYWZ0ZXIgZmlsdGVycyBhcmUgYXBwbGllZC4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQ291bnQoYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0cmFuc2FjdGlvbkNvdW50OyBpKyspIHsKICAgICAgICAgICAgaWYgKHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCB8fCBleGVjdXRlZCAmJiB0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2Ygb3duZXJzLgogICAgLy8vIEByZXR1cm4gTGlzdCBvZiBvd25lciBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdKQogICAgewogICAgICAgIHJldHVybiBvd25lcnM7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBhcnJheSB3aXRoIG93bmVyIGFkZHJlc3Nlcywgd2hpY2ggY29uZmlybWVkIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiBvd25lciBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRDb25maXJtYXRpb25zKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSBfY29uZmlybWF0aW9ucykKICAgIHsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IGNvbmZpcm1hdGlvbnNUZW1wID0gbmV3IGFkZHJlc3NbXShvd25lcnMubGVuZ3RoKTsKICAgICAgICB1aW50IGNvdW50ID0gMDsKICAgICAgICB1aW50IGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKSB7CiAgICAgICAgICAgICAgICBjb25maXJtYXRpb25zVGVtcFtjb3VudF0gPSBvd25lcnNbaV07CiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9jb25maXJtYXRpb25zID0gbmV3IGFkZHJlc3NbXShjb3VudCk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgX2NvbmZpcm1hdGlvbnNbaV0gPSBjb25maXJtYXRpb25zVGVtcFtpXTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIHRyYW5zYWN0aW9uIElEcyBpbiBkZWZpbmVkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBmcm9tIEluZGV4IHN0YXJ0IHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSB0byBJbmRleCBlbmQgcG9zaXRpb24gb2YgdHJhbnNhY3Rpb24gYXJyYXkuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIHRyYW5zYWN0aW9uIElEcy4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uSWRzKHVpbnQgZnJvbSwgdWludCB0bywgYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludFtdIF90cmFuc2FjdGlvbklkcykKICAgIHsKICAgICAgICB1aW50W10gbWVtb3J5IHRyYW5zYWN0aW9uSWRzVGVtcCA9IG5ldyB1aW50W10odHJhbnNhY3Rpb25Db3VudCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0cmFuc2FjdGlvbkNvdW50OyBpKyspIHsKICAgICAgICAgICAgaWYgKHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCB8fCBleGVjdXRlZCAmJiB0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpIHsKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSWRzVGVtcFtjb3VudF0gPSBpOwogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfdHJhbnNhY3Rpb25JZHMgPSBuZXcgdWludFtdKHRvIC0gZnJvbSk7CiAgICAgICAgZm9yIChpID0gZnJvbTsgaSA8IHRvOyBpKyspIHsKICAgICAgICAgICAgX3RyYW5zYWN0aW9uSWRzW2kgLSBmcm9tXSA9IHRyYW5zYWN0aW9uSWRzVGVtcFtpXTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
