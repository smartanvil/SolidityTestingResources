Class {
	#name : #SRTb033d7796effc334c0d5e30210ebc1a336422fa5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb033d7796effc334c0d5e30210ebc1a336422fa5 >> base64 [
	^ 'Y29udHJhY3QgRUlQMjBJbnRlcmZhY2UgewogICAgLyogVGhpcyBpcyBhIHNsaWdodCBjaGFuZ2UgdG8gdGhlIEVSQzIwIGJhc2Ugc3RhbmRhcmQuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKICAgIGlzIHJlcGxhY2VkIHdpdGg6CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIFRoaXMgYXV0b21hdGljYWxseSBjcmVhdGVzIGEgZ2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgdG90YWxTdXBwbHkuCiAgICBUaGlzIGlzIG1vdmVkIHRvIHRoZSBiYXNlIGNvbnRyYWN0IHNpbmNlIHB1YmxpYyBnZXR0ZXIgZnVuY3Rpb25zIGFyZSBub3QKICAgIGN1cnJlbnRseSByZWNvZ25pc2VkIGFzIGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBtYXRjaGluZyBhYnN0cmFjdAogICAgZnVuY3Rpb24gYnkgdGhlIGNvbXBpbGVyLgogICAgKi8KICAgIC8vLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCmNvbnRyYWN0IEVJUDIwIGlzIEVJUDIwSW50ZXJmYWNlIHsKCiAgICB1aW50MjU2IGNvbnN0YW50IE1BWF9VSU5UMjU2ID0gMioqMjU2IC0gMTsKCiAgICAvKgogICAgTk9URToKICAgIFRoZSBmb2xsb3dpbmcgdmFyaWFibGVzIGFyZSBPUFRJT05BTCB2YW5pdGllcy4gT25lIGRvZXMgbm90IGhhdmUgdG8gaW5jbHVkZSB0aGVtLgogICAgVGhleSBhbGxvdyBvbmUgdG8gY3VzdG9taXNlIHRoZSB0b2tlbiBjb250cmFjdCAmIGluIG5vIHdheSBpbmZsdWVuY2VzIHRoZSBjb3JlIGZ1bmN0aW9uYWxpdHkuCiAgICBTb21lIHdhbGxldHMvaW50ZXJmYWNlcyBtaWdodCBub3QgZXZlbiBib3RoZXIgdG8gbG9vayBhdCB0aGlzIGluZm9ybWF0aW9uLgogICAgKi8KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgICAgLy9mYW5jeSBuYW1lOiBlZyBTaW1vbiBCdWNrcwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAgICAvL0hvdyBtYW55IGRlY2ltYWxzIHRvIHNob3cuCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZWcgU0JYCgogICAgIGZ1bmN0aW9uIEVJUDIwKAogICAgICAgIHVpbnQyNTYgX2luaXRpYWxBbW91bnQsCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sCiAgICAgICAgKSBwdWJsaWMgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gX2luaXRpYWxBbW91bnQ7ICAgICAgICAgICAgICAgLy8gR2l2ZSB0aGUgY3JlYXRvciBhbGwgaW5pdGlhbCB0b2tlbnMKICAgICAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsQW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzdXBwbHkKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vRGVmYXVsdCBhc3N1bWVzIHRvdGFsU3VwcGx5IGNhbid0IGJlIG92ZXIgbWF4ICgyXjI1NiAtIDEpLgogICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuCiAgICAgICAgLy9SZXBsYWNlIHRoZSBpZiB3aXRoIHRoaXMgb25lIGluc3RlYWQuCiAgICAgICAgLy9yZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4KICAgICAgICAvL3JlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pOwogICAgICAgIHVpbnQyNTYgYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93YW5jZSA+PSBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgaWYgKGFsbG93YW5jZSA8IE1BWF9VSU5UMjU2KSB7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICB9CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpCiAgICB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwp9CgpsaWJyYXJ5IERMTCB7CgogIHVpbnQgY29uc3RhbnQgTlVMTF9OT0RFX0lEID0gMDsKCiAgc3RydWN0IE5vZGUgewogICAgdWludCBuZXh0OwogICAgdWludCBwcmV2OwogIH0KCiAgc3RydWN0IERhdGEgewogICAgbWFwcGluZyh1aW50ID0+IE5vZGUpIGRsbDsKICB9CgogIGZ1bmN0aW9uIGlzRW1wdHkoRGF0YSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBnZXRTdGFydChzZWxmKSA9PSBOVUxMX05PREVfSUQ7CiAgfQoKICBmdW5jdGlvbiBjb250YWlucyhEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCBfY3VycikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKGlzRW1wdHkoc2VsZikgfHwgX2N1cnIgPT0gTlVMTF9OT0RFX0lEKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0gCgogICAgYm9vbCBpc1NpbmdsZU5vZGUgPSAoZ2V0U3RhcnQoc2VsZikgPT0gX2N1cnIpICYmIChnZXRFbmQoc2VsZikgPT0gX2N1cnIpOwogICAgYm9vbCBpc051bGxOb2RlID0gKGdldE5leHQoc2VsZiwgX2N1cnIpID09IE5VTExfTk9ERV9JRCkgJiYgKGdldFByZXYoc2VsZiwgX2N1cnIpID09IE5VTExfTk9ERV9JRCk7CiAgICByZXR1cm4gaXNTaW5nbGVOb2RlIHx8ICFpc051bGxOb2RlOwogIH0KCiAgZnVuY3Rpb24gZ2V0TmV4dChEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCBfY3VycikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHNlbGYuZGxsW19jdXJyXS5uZXh0OwogIH0KCiAgZnVuY3Rpb24gZ2V0UHJldihEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCBfY3VycikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHNlbGYuZGxsW19jdXJyXS5wcmV2OwogIH0KCiAgZnVuY3Rpb24gZ2V0U3RhcnQoRGF0YSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBnZXROZXh0KHNlbGYsIE5VTExfTk9ERV9JRCk7CiAgfQoKICBmdW5jdGlvbiBnZXRFbmQoRGF0YSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBnZXRQcmV2KHNlbGYsIE5VTExfTk9ERV9JRCk7CiAgfQoKICAvKioKICBAZGV2IEluc2VydHMgYSBuZXcgbm9kZSBiZXR3ZWVuIF9wcmV2IGFuZCBfbmV4dC4gV2hlbiBpbnNlcnRpbmcgYSBub2RlIGFscmVhZHkgZXhpc3RpbmcgaW4gCiAgdGhlIGxpc3QgaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgZnJvbSB0aGUgb2xkIHBvc2l0aW9uLgogIEBwYXJhbSBfcHJldiB0aGUgbm9kZSB3aGljaCBfbmV3IHdpbGwgYmUgaW5zZXJ0ZWQgYWZ0ZXIKICBAcGFyYW0gX2N1cnIgdGhlIGlkIG9mIHRoZSBuZXcgbm9kZSBiZWluZyBpbnNlcnRlZAogIEBwYXJhbSBfbmV4dCB0aGUgbm9kZSB3aGljaCBfbmV3IHdpbGwgYmUgaW5zZXJ0ZWQgYmVmb3JlCiAgKi8KICBmdW5jdGlvbiBpbnNlcnQoRGF0YSBzdG9yYWdlIHNlbGYsIHVpbnQgX3ByZXYsIHVpbnQgX2N1cnIsIHVpbnQgX25leHQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF9jdXJyICE9IE5VTExfTk9ERV9JRCk7CiAgICByZXF1aXJlKF9wcmV2ID09IE5VTExfTk9ERV9JRCB8fCBjb250YWlucyhzZWxmLCBfcHJldikpOwoKICAgIHJlbW92ZShzZWxmLCBfY3Vycik7CgogICAgcmVxdWlyZShnZXROZXh0KHNlbGYsIF9wcmV2KSA9PSBfbmV4dCk7CgogICAgc2VsZi5kbGxbX2N1cnJdLnByZXYgPSBfcHJldjsKICAgIHNlbGYuZGxsW19jdXJyXS5uZXh0ID0gX25leHQ7CgogICAgc2VsZi5kbGxbX3ByZXZdLm5leHQgPSBfY3VycjsKICAgIHNlbGYuZGxsW19uZXh0XS5wcmV2ID0gX2N1cnI7CiAgfQoKICBmdW5jdGlvbiByZW1vdmUoRGF0YSBzdG9yYWdlIHNlbGYsIHVpbnQgX2N1cnIpIHB1YmxpYyB7CiAgICBpZiAoIWNvbnRhaW5zKHNlbGYsIF9jdXJyKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdWludCBuZXh0ID0gZ2V0TmV4dChzZWxmLCBfY3Vycik7CiAgICB1aW50IHByZXYgPSBnZXRQcmV2KHNlbGYsIF9jdXJyKTsKCiAgICBzZWxmLmRsbFtuZXh0XS5wcmV2ID0gcHJldjsKICAgIHNlbGYuZGxsW3ByZXZdLm5leHQgPSBuZXh0OwoKICAgIGRlbGV0ZSBzZWxmLmRsbFtfY3Vycl07CiAgfQp9CgpsaWJyYXJ5IEF0dHJpYnV0ZVN0b3JlIHsKICAgIHN0cnVjdCBEYXRhIHsKICAgICAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gdWludCkgc3RvcmU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXR0cmlidXRlKERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9VVUlELCBzdHJpbmcgX2F0dHJOYW1lKQogICAgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzMzIga2V5ID0ga2VjY2FrMjU2KF9VVUlELCBfYXR0ck5hbWUpOwogICAgICAgIHJldHVybiBzZWxmLnN0b3JlW2tleV07CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QXR0cmlidXRlKERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9VVUlELCBzdHJpbmcgX2F0dHJOYW1lLCB1aW50IF9hdHRyVmFsKQogICAgcHVibGljIHsKICAgICAgICBieXRlczMyIGtleSA9IGtlY2NhazI1NihfVVVJRCwgX2F0dHJOYW1lKTsKICAgICAgICBzZWxmLnN0b3JlW2tleV0gPSBfYXR0clZhbDsKICAgIH0KfQoKY29udHJhY3QgUExDUlZvdGluZyB7CgogICAgLy8gPT09PT09PT09PT09CiAgICAvLyBFVkVOVFM6CiAgICAvLyA9PT09PT09PT09PT0KCiAgICBldmVudCBWb3RlQ29tbWl0dGVkKGFkZHJlc3Mgdm90ZXIsIHVpbnQgcG9sbElELCB1aW50IG51bVRva2Vucyk7CiAgICBldmVudCBWb3RlUmV2ZWFsZWQoYWRkcmVzcyB2b3RlciwgdWludCBwb2xsSUQsIHVpbnQgbnVtVG9rZW5zLCB1aW50IGNob2ljZSk7CiAgICBldmVudCBQb2xsQ3JlYXRlZCh1aW50IHZvdGVRdW9ydW0sIHVpbnQgY29tbWl0RHVyYXRpb24sIHVpbnQgcmV2ZWFsRHVyYXRpb24sIHVpbnQgcG9sbElEKTsKICAgIGV2ZW50IFZvdGluZ1JpZ2h0c0dyYW50ZWQoYWRkcmVzcyB2b3RlciwgdWludCBudW1Ub2tlbnMpOwogICAgZXZlbnQgVm90aW5nUmlnaHRzV2l0aGRyYXduKGFkZHJlc3Mgdm90ZXIsIHVpbnQgbnVtVG9rZW5zKTsKCiAgICAvLyA9PT09PT09PT09PT0KICAgIC8vIERBVEEgU1RSVUNUVVJFUzoKICAgIC8vID09PT09PT09PT09PQoKICAgIHVzaW5nIEF0dHJpYnV0ZVN0b3JlIGZvciBBdHRyaWJ1dGVTdG9yZS5EYXRhOwogICAgdXNpbmcgRExMIGZvciBETEwuRGF0YTsKCiAgICBzdHJ1Y3QgUG9sbCB7CiAgICAgICAgdWludCBjb21taXRFbmREYXRlOyAgICAgLy8vIGV4cGlyYXRpb24gZGF0ZSBvZiBjb21taXQgcGVyaW9kIGZvciBwb2xsCiAgICAgICAgdWludCByZXZlYWxFbmREYXRlOyAgICAgLy8vIGV4cGlyYXRpb24gZGF0ZSBvZiByZXZlYWwgcGVyaW9kIGZvciBwb2xsCiAgICAgICAgdWludCB2b3RlUXVvcnVtOwkgICAgLy8vIG51bWJlciBvZiB2b3RlcyByZXF1aXJlZCBmb3IgYSBwcm9wb3NhbCB0byBwYXNzCiAgICAgICAgdWludCB2b3Rlc0ZvcjsJCSAgICAvLy8gdGFsbHkgb2Ygdm90ZXMgc3VwcG9ydGluZyBwcm9wb3NhbAogICAgICAgIHVpbnQgdm90ZXNBZ2FpbnN0OyAgICAgIC8vLyB0YWxseSBvZiB2b3RlcyBjb3VudGVyaW5nIHByb3Bvc2FsCiAgICB9CiAgICAKICAgIC8vID09PT09PT09PT09PQogICAgLy8gU1RBVEUgVkFSSUFCTEVTOgogICAgLy8gPT09PT09PT09PT09CgogICAgdWludCBjb25zdGFudCBwdWJsaWMgSU5JVElBTF9QT0xMX05PTkNFID0gMDsKICAgIHVpbnQgcHVibGljIHBvbGxOb25jZTsKCiAgICBtYXBwaW5nKHVpbnQgPT4gUG9sbCkgcHVibGljIHBvbGxNYXA7IC8vIG1hcHMgcG9sbElEIHRvIFBvbGwgc3RydWN0CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHZvdGVUb2tlbkJhbGFuY2U7IC8vIG1hcHMgdXNlcidzIGFkZHJlc3MgdG8gdm90ZVRva2VuIGJhbGFuY2UKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gRExMLkRhdGEpIGRsbE1hcDsKICAgIEF0dHJpYnV0ZVN0b3JlLkRhdGEgc3RvcmU7CgogICAgRUlQMjAgcHVibGljIHRva2VuOwoKICAgIC8vID09PT09PT09PT09PQogICAgLy8gQ09OU1RSVUNUT1I6CiAgICAvLyA9PT09PT09PT09PT0KCiAgICAvKioKICAgIEBkZXYgSW5pdGlhbGl6ZXMgdm90ZVF1b3J1bSwgY29tbWl0RHVyYXRpb24sIHJldmVhbER1cmF0aW9uLCBhbmQgcG9sbE5vbmNlIGluIGFkZGl0aW9uIHRvIHRva2VuIGNvbnRyYWN0IGFuZCB0cnVzdGVkIG1hcHBpbmcKICAgIEBwYXJhbSBfdG9rZW5BZGRyIFRoZSBhZGRyZXNzIHdoZXJlIHRoZSBFUkMyMCB0b2tlbiBjb250cmFjdCBpcyBkZXBsb3llZAogICAgKi8KICAgIGZ1bmN0aW9uIFBMQ1JWb3RpbmcoYWRkcmVzcyBfdG9rZW5BZGRyKSBwdWJsaWMgewogICAgICAgIHRva2VuID0gRUlQMjAoX3Rva2VuQWRkcik7CiAgICAgICAgcG9sbE5vbmNlID0gSU5JVElBTF9QT0xMX05PTkNFOwogICAgfQoKICAgIC8vID09PT09PT09PT09PT09PT0KICAgIC8vIFRPS0VOIElOVEVSRkFDRToKICAgIC8vID09PT09PT09PT09PT09PT0KCiAgICAvKiogICAgCiAgICBAbm90aWNlIExvYWRzIF9udW1Ub2tlbnMgRVJDMjAgdG9rZW5zIGludG8gdGhlIHZvdGluZyBjb250cmFjdCBmb3Igb25lLXRvLW9uZSB2b3RpbmcgcmlnaHRzCiAgICBAZGV2IEFzc3VtZXMgdGhhdCBtc2cuc2VuZGVyIGhhcyBhcHByb3ZlZCB2b3RpbmcgY29udHJhY3QgdG8gc3BlbmQgb24gdGhlaXIgYmVoYWxmCiAgICBAcGFyYW0gX251bVRva2VucyBUaGUgbnVtYmVyIG9mIHZvdGluZ1Rva2VucyBkZXNpcmVkIGluIGV4Y2hhbmdlIGZvciBFUkMyMCB0b2tlbnMKICAgICovCiAgICBmdW5jdGlvbiByZXF1ZXN0Vm90aW5nUmlnaHRzKHVpbnQgX251bVRva2VucykgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUodG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IF9udW1Ub2tlbnMpOwogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9udW1Ub2tlbnMpKTsKICAgICAgICB2b3RlVG9rZW5CYWxhbmNlW21zZy5zZW5kZXJdICs9IF9udW1Ub2tlbnM7CiAgICAgICAgVm90aW5nUmlnaHRzR3JhbnRlZChtc2cuc2VuZGVyLCBfbnVtVG9rZW5zKTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgV2l0aGRyYXcgX251bVRva2VucyBFUkMyMCB0b2tlbnMgZnJvbSB0aGUgdm90aW5nIGNvbnRyYWN0LCByZXZva2luZyB0aGVzZSB2b3RpbmcgcmlnaHRzCiAgICBAcGFyYW0gX251bVRva2VucyBUaGUgbnVtYmVyIG9mIEVSQzIwIHRva2VucyBkZXNpcmVkIGluIGV4Y2hhbmdlIGZvciB2b3RpbmcgcmlnaHRzCiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdWb3RpbmdSaWdodHModWludCBfbnVtVG9rZW5zKSBleHRlcm5hbCB7CiAgICAgICAgdWludCBhdmFpbGFibGVUb2tlbnMgPSB2b3RlVG9rZW5CYWxhbmNlW21zZy5zZW5kZXJdIC0gZ2V0TG9ja2VkVG9rZW5zKG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoYXZhaWxhYmxlVG9rZW5zID49IF9udW1Ub2tlbnMpOwogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgX251bVRva2VucykpOwogICAgICAgIHZvdGVUb2tlbkJhbGFuY2VbbXNnLnNlbmRlcl0gLT0gX251bVRva2VuczsKICAgICAgICBWb3RpbmdSaWdodHNXaXRoZHJhd24obXNnLnNlbmRlciwgX251bVRva2Vucyk7CiAgICB9CgogICAgLyoqCiAgICBAZGV2IFVubG9ja3MgdG9rZW5zIGxvY2tlZCBpbiB1bnJldmVhbGVkIHZvdGUgd2hlcmUgcG9sbCBoYXMgZW5kZWQKICAgIEBwYXJhbSBfcG9sbElEIEludGVnZXIgaWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGhlIHRhcmdldCBwb2xsCiAgICAqLwogICAgZnVuY3Rpb24gcmVzY3VlVG9rZW5zKHVpbnQgX3BvbGxJRCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUocG9sbEVuZGVkKF9wb2xsSUQpKTsKICAgICAgICByZXF1aXJlKCFoYXNCZWVuUmV2ZWFsZWQobXNnLnNlbmRlciwgX3BvbGxJRCkpOwoKICAgICAgICBkbGxNYXBbbXNnLnNlbmRlcl0ucmVtb3ZlKF9wb2xsSUQpOwogICAgfQoKICAgIC8vID09PT09PT09PT09PT09PT09CiAgICAvLyBWT1RJTkcgSU5URVJGQUNFOgogICAgLy8gPT09PT09PT09PT09PT09PT0KCiAgICAvKioKICAgIEBub3RpY2UgQ29tbWl0cyB2b3RlIHVzaW5nIGhhc2ggb2YgY2hvaWNlIGFuZCBzZWNyZXQgc2FsdCB0byBjb25jZWFsIHZvdGUgdW50aWwgcmV2ZWFsCiAgICBAcGFyYW0gX3BvbGxJRCBJbnRlZ2VyIGlkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRhcmdldCBwb2xsCiAgICBAcGFyYW0gX3NlY3JldEhhc2ggQ29tbWl0IGtlY2NhazI1NiBoYXNoIG9mIHZvdGVyJ3MgY2hvaWNlIGFuZCBzYWx0ICh0aWdodGx5IHBhY2tlZCBpbiB0aGlzIG9yZGVyKQogICAgQHBhcmFtIF9udW1Ub2tlbnMgVGhlIG51bWJlciBvZiB0b2tlbnMgdG8gYmUgY29tbWl0dGVkIHRvd2FyZHMgdGhlIHRhcmdldCBwb2xsCiAgICBAcGFyYW0gX3ByZXZQb2xsSUQgVGhlIElEIG9mIHRoZSBwb2xsIHRoYXQgdGhlIHVzZXIgaGFzIHZvdGVkIHRoZSBtYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgaW4gd2hpY2ggaXMgc3RpbGwgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIG51bVRva2VucyAKICAgICovCiAgICBmdW5jdGlvbiBjb21taXRWb3RlKHVpbnQgX3BvbGxJRCwgYnl0ZXMzMiBfc2VjcmV0SGFzaCwgdWludCBfbnVtVG9rZW5zLCB1aW50IF9wcmV2UG9sbElEKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShjb21taXRQZXJpb2RBY3RpdmUoX3BvbGxJRCkpOwogICAgICAgIHJlcXVpcmUodm90ZVRva2VuQmFsYW5jZVttc2cuc2VuZGVyXSA+PSBfbnVtVG9rZW5zKTsgLy8gcHJldmVudCB1c2VyIGZyb20gb3ZlcnNwZW5kaW5nCiAgICAgICAgcmVxdWlyZShfcG9sbElEICE9IDApOyAgICAgICAgICAgICAgICAvLyBwcmV2ZW50IHVzZXIgZnJvbSBjb21taXR0aW5nIHRvIHplcm8gbm9kZSBwbGFjZWhvbGRlcgoKICAgICAgICAvLyBUT0RPOiBNb3ZlIGFsbCBpbnNlcnQgdmFsaWRhdGlvbiBpbnRvIHRoZSBETEwgbGliCiAgICAgICAgLy8gQ2hlY2sgaWYgX3ByZXZQb2xsSUQgZXhpc3RzCiAgICAgICAgcmVxdWlyZShfcHJldlBvbGxJRCA9PSAwIHx8IGdldENvbW1pdEhhc2gobXNnLnNlbmRlciwgX3ByZXZQb2xsSUQpICE9IDApOwoKICAgICAgICB1aW50IG5leHRQb2xsSUQgPSBkbGxNYXBbbXNnLnNlbmRlcl0uZ2V0TmV4dChfcHJldlBvbGxJRCk7CgogICAgICAgIC8vIGlmIG5leHRQb2xsSUQgaXMgZXF1YWwgdG8gX3BvbGxJRCwgX3BvbGxJRCBpcyBiZWluZyB1cGRhdGVkLAogICAgICAgIG5leHRQb2xsSUQgPSAobmV4dFBvbGxJRCA9PSBfcG9sbElEKSA/IGRsbE1hcFttc2cuc2VuZGVyXS5nZXROZXh0KF9wb2xsSUQpIDogbmV4dFBvbGxJRDsKCiAgICAgICAgcmVxdWlyZSh2YWxpZFBvc2l0aW9uKF9wcmV2UG9sbElELCBuZXh0UG9sbElELCBtc2cuc2VuZGVyLCBfbnVtVG9rZW5zKSk7CiAgICAgICAgZGxsTWFwW21zZy5zZW5kZXJdLmluc2VydChfcHJldlBvbGxJRCwgX3BvbGxJRCwgbmV4dFBvbGxJRCk7CgogICAgICAgIGJ5dGVzMzIgVVVJRCA9IGF0dHJVVUlEKG1zZy5zZW5kZXIsIF9wb2xsSUQpOwoKICAgICAgICBzdG9yZS5zZXRBdHRyaWJ1dGUoVVVJRCwgIm51bVRva2VucyIsIF9udW1Ub2tlbnMpOwogICAgICAgIHN0b3JlLnNldEF0dHJpYnV0ZShVVUlELCAiY29tbWl0SGFzaCIsIHVpbnQoX3NlY3JldEhhc2gpKTsKCiAgICAgICAgVm90ZUNvbW1pdHRlZChtc2cuc2VuZGVyLCBfcG9sbElELCBfbnVtVG9rZW5zKTsKICAgIH0KCiAgICAvKioKICAgIEBkZXYgQ29tcGFyZXMgcHJldmlvdXMgYW5kIG5leHQgcG9sbCdzIGNvbW1pdHRlZCB0b2tlbnMgZm9yIHNvcnRpbmcgcHVycG9zZXMKICAgIEBwYXJhbSBfcHJldklEIEludGVnZXIgaWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggcHJldmlvdXMgcG9sbCBpbiBzb3J0ZWQgb3JkZXIKICAgIEBwYXJhbSBfbmV4dElEIEludGVnZXIgaWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggbmV4dCBwb2xsIGluIHNvcnRlZCBvcmRlcgogICAgQHBhcmFtIF92b3RlciBBZGRyZXNzIG9mIHVzZXIgdG8gY2hlY2sgRExMIHBvc2l0aW9uIGZvcgogICAgQHBhcmFtIF9udW1Ub2tlbnMgVGhlIG51bWJlciBvZiB0b2tlbnMgdG8gYmUgY29tbWl0dGVkIHRvd2FyZHMgdGhlIHBvbGwgKHVzZWQgZm9yIHNvcnRpbmcpCiAgICBAcmV0dXJuIHZhbGlkIEJvb2xlYW4gaW5kaWNhdGlvbiBvZiBpZiB0aGUgc3BlY2lmaWVkIHBvc2l0aW9uIG1haW50YWlucyB0aGUgc29ydAogICAgKi8KICAgIGZ1bmN0aW9uIHZhbGlkUG9zaXRpb24odWludCBfcHJldklELCB1aW50IF9uZXh0SUQsIGFkZHJlc3MgX3ZvdGVyLCB1aW50IF9udW1Ub2tlbnMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHZhbGlkKSB7CiAgICAgICAgYm9vbCBwcmV2VmFsaWQgPSAoX251bVRva2VucyA+PSBnZXROdW1Ub2tlbnMoX3ZvdGVyLCBfcHJldklEKSk7CiAgICAgICAgLy8gaWYgbmV4dCBpcyB6ZXJvIG5vZGUsIF9udW1Ub2tlbnMgZG9lcyBub3QgbmVlZCB0byBiZSBncmVhdGVyCiAgICAgICAgYm9vbCBuZXh0VmFsaWQgPSAoX251bVRva2VucyA8PSBnZXROdW1Ub2tlbnMoX3ZvdGVyLCBfbmV4dElEKSB8fCBfbmV4dElEID09IDApOyAKICAgICAgICByZXR1cm4gcHJldlZhbGlkICYmIG5leHRWYWxpZDsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgUmV2ZWFscyB2b3RlIHdpdGggY2hvaWNlIGFuZCBzZWNyZXQgc2FsdCB1c2VkIGluIGdlbmVyYXRpbmcgY29tbWl0SGFzaCB0byBhdHRyaWJ1dGUgY29tbWl0dGVkIHRva2VucwogICAgQHBhcmFtIF9wb2xsSUQgSW50ZWdlciBpZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0YXJnZXQgcG9sbAogICAgQHBhcmFtIF92b3RlT3B0aW9uIFZvdGUgY2hvaWNlIHVzZWQgdG8gZ2VuZXJhdGUgY29tbWl0SGFzaCBmb3IgYXNzb2NpYXRlZCBwb2xsCiAgICBAcGFyYW0gX3NhbHQgU2VjcmV0IG51bWJlciB1c2VkIHRvIGdlbmVyYXRlIGNvbW1pdEhhc2ggZm9yIGFzc29jaWF0ZWQgcG9sbAogICAgKi8KICAgIGZ1bmN0aW9uIHJldmVhbFZvdGUodWludCBfcG9sbElELCB1aW50IF92b3RlT3B0aW9uLCB1aW50IF9zYWx0KSBleHRlcm5hbCB7CiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSByZXZlYWwgcGVyaW9kIGlzIGFjdGl2ZQogICAgICAgIHJlcXVpcmUocmV2ZWFsUGVyaW9kQWN0aXZlKF9wb2xsSUQpKTsKICAgICAgICByZXF1aXJlKCFoYXNCZWVuUmV2ZWFsZWQobXNnLnNlbmRlciwgX3BvbGxJRCkpOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgdXNlciBmcm9tIHJldmVhbGluZyBtdWx0aXBsZSB0aW1lcwogICAgICAgIHJlcXVpcmUoa2VjY2FrMjU2KF92b3RlT3B0aW9uLCBfc2FsdCkgPT0gZ2V0Q29tbWl0SGFzaChtc2cuc2VuZGVyLCBfcG9sbElEKSk7IC8vIGNvbXBhcmUgcmVzdWx0YW50IGhhc2ggZnJvbSBpbnB1dHMgdG8gb3JpZ2luYWwgY29tbWl0SGFzaAoKICAgICAgICB1aW50IG51bVRva2VucyA9IGdldE51bVRva2Vucyhtc2cuc2VuZGVyLCBfcG9sbElEKTsgCgogICAgICAgIGlmIChfdm90ZU9wdGlvbiA9PSAxKSAvLyBhcHBseSBudW1Ub2tlbnMgdG8gYXBwcm9wcmlhdGUgcG9sbCBjaG9pY2UKICAgICAgICAgICAgcG9sbE1hcFtfcG9sbElEXS52b3Rlc0ZvciArPSBudW1Ub2tlbnM7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwb2xsTWFwW19wb2xsSURdLnZvdGVzQWdhaW5zdCArPSBudW1Ub2tlbnM7CiAgICAgICAgCiAgICAgICAgZGxsTWFwW21zZy5zZW5kZXJdLnJlbW92ZShfcG9sbElEKTsgLy8gcmVtb3ZlIHRoZSBub2RlIHJlZmVycmluZyB0byB0aGlzIHZvdGUgdXBvbiByZXZlYWwKCiAgICAgICAgVm90ZVJldmVhbGVkKG1zZy5zZW5kZXIsIF9wb2xsSUQsIG51bVRva2VucywgX3ZvdGVPcHRpb24pOwogICAgfQoKICAgIC8qKgogICAgQHBhcmFtIF9wb2xsSUQgSW50ZWdlciBpZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0YXJnZXQgcG9sbAogICAgQHBhcmFtIF9zYWx0IEFyYml0cmFyaWx5IGNob3NlbiBpbnRlZ2VyIHVzZWQgdG8gZ2VuZXJhdGUgc2VjcmV0SGFzaAogICAgQHJldHVybiBjb3JyZWN0Vm90ZXMgTnVtYmVyIG9mIHRva2VucyB2b3RlZCBmb3Igd2lubmluZyBvcHRpb24KICAgICovCiAgICBmdW5jdGlvbiBnZXROdW1QYXNzaW5nVG9rZW5zKGFkZHJlc3MgX3ZvdGVyLCB1aW50IF9wb2xsSUQsIHVpbnQgX3NhbHQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGNvcnJlY3RWb3RlcykgewogICAgICAgIHJlcXVpcmUocG9sbEVuZGVkKF9wb2xsSUQpKTsKICAgICAgICByZXF1aXJlKGhhc0JlZW5SZXZlYWxlZChfdm90ZXIsIF9wb2xsSUQpKTsKCiAgICAgICAgdWludCB3aW5uaW5nQ2hvaWNlID0gaXNQYXNzZWQoX3BvbGxJRCkgPyAxIDogMDsKICAgICAgICBieXRlczMyIHdpbm5lckhhc2ggPSBrZWNjYWsyNTYod2lubmluZ0Nob2ljZSwgX3NhbHQpOwogICAgICAgIGJ5dGVzMzIgY29tbWl0SGFzaCA9IGdldENvbW1pdEhhc2goX3ZvdGVyLCBfcG9sbElEKTsKCiAgICAgICAgcmVxdWlyZSh3aW5uZXJIYXNoID09IGNvbW1pdEhhc2gpOwoKICAgICAgICByZXR1cm4gZ2V0TnVtVG9rZW5zKF92b3RlciwgX3BvbGxJRCk7CiAgICB9CgogICAgLy8gPT09PT09PT09PT09PT09PT09CiAgICAvLyBQT0xMSU5HIElOVEVSRkFDRToKICAgIC8vID09PT09PT09PT09PT09PT09PSAKCiAgICAvKioKICAgIEBkZXYgSW5pdGlhdGVzIGEgcG9sbCB3aXRoIGNhbm9uaWNhbCBjb25maWd1cmVkIHBhcmFtZXRlcnMgYXQgcG9sbElEIGVtaXR0ZWQgYnkgUG9sbENyZWF0ZWQgZXZlbnQKICAgIEBwYXJhbSBfdm90ZVF1b3J1bSBUeXBlIG9mIG1ham9yaXR5IChvdXQgb2YgMTAwKSB0aGF0IGlzIG5lY2Vzc2FyeSBmb3IgcG9sbCB0byBiZSBzdWNjZXNzZnVsCiAgICBAcGFyYW0gX2NvbW1pdER1cmF0aW9uIExlbmd0aCBvZiBkZXNpcmVkIGNvbW1pdCBwZXJpb2QgaW4gc2Vjb25kcwogICAgQHBhcmFtIF9yZXZlYWxEdXJhdGlvbiBMZW5ndGggb2YgZGVzaXJlZCByZXZlYWwgcGVyaW9kIGluIHNlY29uZHMKICAgICovCiAgICBmdW5jdGlvbiBzdGFydFBvbGwodWludCBfdm90ZVF1b3J1bSwgdWludCBfY29tbWl0RHVyYXRpb24sIHVpbnQgX3JldmVhbER1cmF0aW9uKSBwdWJsaWMgcmV0dXJucyAodWludCBwb2xsSUQpIHsKICAgICAgICBwb2xsTm9uY2UgPSBwb2xsTm9uY2UgKyAxOwoKICAgICAgICBwb2xsTWFwW3BvbGxOb25jZV0gPSBQb2xsKHsKICAgICAgICAgICAgdm90ZVF1b3J1bTogX3ZvdGVRdW9ydW0sCiAgICAgICAgICAgIGNvbW1pdEVuZERhdGU6IGJsb2NrLnRpbWVzdGFtcCArIF9jb21taXREdXJhdGlvbiwKICAgICAgICAgICAgcmV2ZWFsRW5kRGF0ZTogYmxvY2sudGltZXN0YW1wICsgX2NvbW1pdER1cmF0aW9uICsgX3JldmVhbER1cmF0aW9uLAogICAgICAgICAgICB2b3Rlc0ZvcjogMCwKICAgICAgICAgICAgdm90ZXNBZ2FpbnN0OiAwCiAgICAgICAgfSk7CgogICAgICAgIFBvbGxDcmVhdGVkKF92b3RlUXVvcnVtLCBfY29tbWl0RHVyYXRpb24sIF9yZXZlYWxEdXJhdGlvbiwgcG9sbE5vbmNlKTsKICAgICAgICByZXR1cm4gcG9sbE5vbmNlOwogICAgfQogCiAgICAvKioKICAgIEBub3RpY2UgRGV0ZXJtaW5lcyBpZiBwcm9wb3NhbCBoYXMgcGFzc2VkCiAgICBAZGV2IENoZWNrIGlmIHZvdGVzRm9yIG91dCBvZiB0b3RhbFZvdGVzIGV4Y2VlZHMgdm90ZXNRdW9ydW0gKHJlcXVpcmVzIHBvbGxFbmRlZCkKICAgIEBwYXJhbSBfcG9sbElEIEludGVnZXIgaWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGFyZ2V0IHBvbGwKICAgICovCiAgICBmdW5jdGlvbiBpc1Bhc3NlZCh1aW50IF9wb2xsSUQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIHBhc3NlZCkgewogICAgICAgIHJlcXVpcmUocG9sbEVuZGVkKF9wb2xsSUQpKTsKCiAgICAgICAgUG9sbCBtZW1vcnkgcG9sbCA9IHBvbGxNYXBbX3BvbGxJRF07CiAgICAgICAgcmV0dXJuICgxMDAgKiBwb2xsLnZvdGVzRm9yKSA+IChwb2xsLnZvdGVRdW9ydW0gKiAocG9sbC52b3Rlc0ZvciArIHBvbGwudm90ZXNBZ2FpbnN0KSk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gUE9MTElORyBIRUxQRVJTOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8qKgogICAgQGRldiBHZXRzIHRoZSB0b3RhbCB3aW5uaW5nIHZvdGVzIGZvciByZXdhcmQgZGlzdHJpYnV0aW9uIHB1cnBvc2VzCiAgICBAcGFyYW0gX3BvbGxJRCBJbnRlZ2VyIGlkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRhcmdldCBwb2xsCiAgICBAcmV0dXJuIFRvdGFsIG51bWJlciBvZiB2b3RlcyBjb21taXR0ZWQgdG8gdGhlIHdpbm5pbmcgb3B0aW9uIGZvciBzcGVjaWZpZWQgcG9sbAogICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvdGFsTnVtYmVyT2ZUb2tlbnNGb3JXaW5uaW5nT3B0aW9uKHVpbnQgX3BvbGxJRCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgbnVtVG9rZW5zKSB7CiAgICAgICAgcmVxdWlyZShwb2xsRW5kZWQoX3BvbGxJRCkpOwoKICAgICAgICBpZiAoaXNQYXNzZWQoX3BvbGxJRCkpCiAgICAgICAgICAgIHJldHVybiBwb2xsTWFwW19wb2xsSURdLnZvdGVzRm9yOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHBvbGxNYXBbX3BvbGxJRF0udm90ZXNBZ2FpbnN0OwogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBEZXRlcm1pbmVzIGlmIHBvbGwgaXMgb3ZlcgogICAgQGRldiBDaGVja3MgaXNFeHBpcmVkIGZvciBzcGVjaWZpZWQgcG9sbCdzIHJldmVhbEVuZERhdGUKICAgIEByZXR1cm4gQm9vbGVhbiBpbmRpY2F0aW9uIG9mIHdoZXRoZXIgcG9sbGluZyBwZXJpb2QgaXMgb3ZlcgogICAgKi8KICAgIGZ1bmN0aW9uIHBvbGxFbmRlZCh1aW50IF9wb2xsSUQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIGVuZGVkKSB7CiAgICAgICAgcmVxdWlyZShwb2xsRXhpc3RzKF9wb2xsSUQpKTsKCiAgICAgICAgcmV0dXJuIGlzRXhwaXJlZChwb2xsTWFwW19wb2xsSURdLnJldmVhbEVuZERhdGUpOwogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBDaGVja3MgaWYgdGhlIGNvbW1pdCBwZXJpb2QgaXMgc3RpbGwgYWN0aXZlIGZvciB0aGUgc3BlY2lmaWVkIHBvbGwKICAgIEBkZXYgQ2hlY2tzIGlzRXhwaXJlZCBmb3IgdGhlIHNwZWNpZmllZCBwb2xsJ3MgY29tbWl0RW5kRGF0ZQogICAgQHBhcmFtIF9wb2xsSUQgSW50ZWdlciBpZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0YXJnZXQgcG9sbAogICAgQHJldHVybiBCb29sZWFuIGluZGljYXRpb24gb2YgaXNDb21taXRQZXJpb2RBY3RpdmUgZm9yIHRhcmdldCBwb2xsCiAgICAqLwogICAgZnVuY3Rpb24gY29tbWl0UGVyaW9kQWN0aXZlKHVpbnQgX3BvbGxJRCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wgYWN0aXZlKSB7CiAgICAgICAgcmVxdWlyZShwb2xsRXhpc3RzKF9wb2xsSUQpKTsKCiAgICAgICAgcmV0dXJuICFpc0V4cGlyZWQocG9sbE1hcFtfcG9sbElEXS5jb21taXRFbmREYXRlKTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgQ2hlY2tzIGlmIHRoZSByZXZlYWwgcGVyaW9kIGlzIHN0aWxsIGFjdGl2ZSBmb3IgdGhlIHNwZWNpZmllZCBwb2xsCiAgICBAZGV2IENoZWNrcyBpc0V4cGlyZWQgZm9yIHRoZSBzcGVjaWZpZWQgcG9sbCdzIHJldmVhbEVuZERhdGUKICAgIEBwYXJhbSBfcG9sbElEIEludGVnZXIgaWRlbnRpZmllciBhc3NvY2lhdGVkIHdpdGggdGFyZ2V0IHBvbGwKICAgICovCiAgICBmdW5jdGlvbiByZXZlYWxQZXJpb2RBY3RpdmUodWludCBfcG9sbElEKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCBhY3RpdmUpIHsKICAgICAgICByZXF1aXJlKHBvbGxFeGlzdHMoX3BvbGxJRCkpOwoKICAgICAgICByZXR1cm4gIWlzRXhwaXJlZChwb2xsTWFwW19wb2xsSURdLnJldmVhbEVuZERhdGUpICYmICFjb21taXRQZXJpb2RBY3RpdmUoX3BvbGxJRCk7CiAgICB9CgogICAgLyoqCiAgICBAZGV2IENoZWNrcyBpZiB1c2VyIGhhcyBhbHJlYWR5IHJldmVhbGVkIGZvciBzcGVjaWZpZWQgcG9sbAogICAgQHBhcmFtIF92b3RlciBBZGRyZXNzIG9mIHVzZXIgdG8gY2hlY2sgYWdhaW5zdAogICAgQHBhcmFtIF9wb2xsSUQgSW50ZWdlciBpZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0YXJnZXQgcG9sbAogICAgQHJldHVybiBCb29sZWFuIGluZGljYXRpb24gb2Ygd2hldGhlciB1c2VyIGhhcyBhbHJlYWR5IHJldmVhbGVkCiAgICAqLwogICAgZnVuY3Rpb24gaGFzQmVlblJldmVhbGVkKGFkZHJlc3MgX3ZvdGVyLCB1aW50IF9wb2xsSUQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIHJldmVhbGVkKSB7CiAgICAgICAgcmVxdWlyZShwb2xsRXhpc3RzKF9wb2xsSUQpKTsKCiAgICAgICAgcmV0dXJuICFkbGxNYXBbX3ZvdGVyXS5jb250YWlucyhfcG9sbElEKTsKICAgIH0KCiAgICAvKioKICAgIEBkZXYgQ2hlY2tzIGlmIGEgcG9sbCBleGlzdHMsIHRocm93cyBpZiB0aGUgcHJvdmlkZWQgcG9sbCBpcyBpbiBhbiBpbXBvc3NpYmxlIHN0YXRlCiAgICBAcGFyYW0gX3BvbGxJRCBUaGUgcG9sbElEIHdob3NlIGV4aXN0YW5jZSBpcyB0byBiZSBldmFsdWF0ZWQuCiAgICBAcmV0dXJuIEJvb2xlYW4gSW5kaWNhdGVzIHdoZXRoZXIgYSBwb2xsIGV4aXN0cyBmb3IgdGhlIHByb3ZpZGVkIHBvbGxJRAogICAgKi8KICAgIGZ1bmN0aW9uIHBvbGxFeGlzdHModWludCBfcG9sbElEKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCBleGlzdHMpIHsKICAgICAgICB1aW50IGNvbW1pdEVuZERhdGUgPSBwb2xsTWFwW19wb2xsSURdLmNvbW1pdEVuZERhdGU7CiAgICAgICAgdWludCByZXZlYWxFbmREYXRlID0gcG9sbE1hcFtfcG9sbElEXS5yZXZlYWxFbmREYXRlOwoKICAgICAgICBhc3NlcnQoIShjb21taXRFbmREYXRlID09IDAgJiYgcmV2ZWFsRW5kRGF0ZSAhPSAwKSk7CiAgICAgICAgYXNzZXJ0KCEoY29tbWl0RW5kRGF0ZSAhPSAwICYmIHJldmVhbEVuZERhdGUgPT0gMCkpOwoKICAgICAgICBpZihjb21taXRFbmREYXRlID09IDAgfHwgcmV2ZWFsRW5kRGF0ZSA9PSAwKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRE9VQkxFLUxJTktFRC1MSVNUIEhFTFBFUlM6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgIEBkZXYgR2V0cyB0aGUgYnl0ZXMzMiBjb21taXRIYXNoIHByb3BlcnR5IG9mIHRhcmdldCBwb2xsCiAgICBAcGFyYW0gX3ZvdGVyIEFkZHJlc3Mgb2YgdXNlciB0byBjaGVjayBhZ2FpbnN0CiAgICBAcGFyYW0gX3BvbGxJRCBJbnRlZ2VyIGlkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRhcmdldCBwb2xsCiAgICBAcmV0dXJuIEJ5dGVzMzIgaGFzaCBwcm9wZXJ0eSBhdHRhY2hlZCB0byB0YXJnZXQgcG9sbCAKICAgICovCiAgICBmdW5jdGlvbiBnZXRDb21taXRIYXNoKGFkZHJlc3MgX3ZvdGVyLCB1aW50IF9wb2xsSUQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChieXRlczMyIGNvbW1pdEhhc2gpIHsgCiAgICAgICAgcmV0dXJuIGJ5dGVzMzIoc3RvcmUuZ2V0QXR0cmlidXRlKGF0dHJVVUlEKF92b3RlciwgX3BvbGxJRCksICJjb21taXRIYXNoIikpOyAgICAKICAgIH0gCgogICAgLyoqCiAgICBAZGV2IFdyYXBwZXIgZm9yIGdldEF0dHJpYnV0ZSB3aXRoIGF0dHJOYW1lPSJudW1Ub2tlbnMiCiAgICBAcGFyYW0gX3ZvdGVyIEFkZHJlc3Mgb2YgdXNlciB0byBjaGVjayBhZ2FpbnN0CiAgICBAcGFyYW0gX3BvbGxJRCBJbnRlZ2VyIGlkZW50aWZpZXIgYXNzb2NpYXRlZCB3aXRoIHRhcmdldCBwb2xsCiAgICBAcmV0dXJuIE51bWJlciBvZiB0b2tlbnMgY29tbWl0dGVkIHRvIHBvbGwgaW4gc29ydGVkIHBvbGwtbGlua2VkLWxpc3QKICAgICovCiAgICBmdW5jdGlvbiBnZXROdW1Ub2tlbnMoYWRkcmVzcyBfdm90ZXIsIHVpbnQgX3BvbGxJRCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgbnVtVG9rZW5zKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlLmdldEF0dHJpYnV0ZShhdHRyVVVJRChfdm90ZXIsIF9wb2xsSUQpLCAibnVtVG9rZW5zIik7CiAgICB9CgogICAgLyoqCiAgICBAZGV2IEdldHMgdG9wIGVsZW1lbnQgb2Ygc29ydGVkIHBvbGwtbGlua2VkLWxpc3QKICAgIEBwYXJhbSBfdm90ZXIgQWRkcmVzcyBvZiB1c2VyIHRvIGNoZWNrIGFnYWluc3QKICAgIEByZXR1cm4gSW50ZWdlciBpZGVudGlmaWVyIHRvIHBvbGwgd2l0aCBtYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgY29tbWl0dGVkIHRvIGl0CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0TGFzdE5vZGUoYWRkcmVzcyBfdm90ZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IHBvbGxJRCkgewogICAgICAgIHJldHVybiBkbGxNYXBbX3ZvdGVyXS5nZXRQcmV2KDApOwogICAgfQoKICAgIC8qKgogICAgQGRldiBHZXRzIHRoZSBudW1Ub2tlbnMgcHJvcGVydHkgb2YgZ2V0TGFzdE5vZGUKICAgIEBwYXJhbSBfdm90ZXIgQWRkcmVzcyBvZiB1c2VyIHRvIGNoZWNrIGFnYWluc3QKICAgIEByZXR1cm4gTWF4aW11bSBudW1iZXIgb2YgdG9rZW5zIGNvbW1pdHRlZCBpbiBwb2xsIHNwZWNpZmllZCAKICAgICovCiAgICBmdW5jdGlvbiBnZXRMb2NrZWRUb2tlbnMoYWRkcmVzcyBfdm90ZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IG51bVRva2VucykgewogICAgICAgIHJldHVybiBnZXROdW1Ub2tlbnMoX3ZvdGVyLCBnZXRMYXN0Tm9kZShfdm90ZXIpKTsKICAgIH0KCiAgICAvKioKICAgIEBkZXYgR2V0cyB0aGUgcHJldk5vZGUgYSBuZXcgbm9kZSBzaG91bGQgYmUgaW5zZXJ0ZWQgYWZ0ZXIgZ2l2ZW4gdGhlIHNvcnQgZmFjdG9yCiAgICBAcGFyYW0gX3ZvdGVyIFRoZSB2b3RlciB3aG9zZSBETEwgd2lsbCBiZSBzZWFyY2hlZAogICAgQHBhcmFtIF9udW1Ub2tlbnMgVGhlIHZhbHVlIGZvciB0aGUgbnVtVG9rZW5zIGF0dHJpYnV0ZSBpbiB0aGUgbm9kZSB0byBiZSBpbnNlcnRlZAogICAgQHJldHVybiB0aGUgbm9kZSB3aGljaCB0aGUgcHJvcG9kZWQgbm9kZSBzaG91bGQgYmUgaW5zZXJ0ZWQgYWZ0ZXIKICAgICovCiAgICBmdW5jdGlvbiBnZXRJbnNlcnRQb2ludEZvck51bVRva2VucyhhZGRyZXNzIF92b3RlciwgdWludCBfbnVtVG9rZW5zKQogICAgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgcHJldk5vZGUpIHsKICAgICAgdWludCBub2RlSUQgPSBnZXRMYXN0Tm9kZShfdm90ZXIpOwogICAgICB1aW50IHRva2Vuc0luTm9kZSA9IGdldE51bVRva2Vucyhfdm90ZXIsIG5vZGVJRCk7CgogICAgICB3aGlsZSh0b2tlbnNJbk5vZGUgIT0gMCkgewogICAgICAgIHRva2Vuc0luTm9kZSA9IGdldE51bVRva2Vucyhfdm90ZXIsIG5vZGVJRCk7CiAgICAgICAgaWYodG9rZW5zSW5Ob2RlIDwgX251bVRva2VucykgewogICAgICAgICAgcmV0dXJuIG5vZGVJRDsKICAgICAgICB9CiAgICAgICAgbm9kZUlEID0gZGxsTWFwW192b3Rlcl0uZ2V0UHJldihub2RlSUQpOwogICAgICB9CgogICAgICByZXR1cm4gbm9kZUlEOwogICAgfQogCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBHRU5FUkFMIEhFTFBFUlM6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tCgogICAgLyoqCiAgICBAZGV2IENoZWNrcyBpZiBhbiBleHBpcmF0aW9uIGRhdGUgaGFzIGJlZW4gcmVhY2hlZAogICAgQHBhcmFtIF90ZXJtaW5hdGlvbkRhdGUgSW50ZWdlciB0aW1lc3RhbXAgb2YgZGF0ZSB0byBjb21wYXJlIGN1cnJlbnQgdGltZXN0YW1wIHdpdGgKICAgIEByZXR1cm4gZXhwaXJlZCBCb29sZWFuIGluZGljYXRpb24gb2Ygd2hldGhlciB0aGUgdGVybWluYXRpb25EYXRlIGhhcyBwYXNzZWQKICAgICovCiAgICBmdW5jdGlvbiBpc0V4cGlyZWQodWludCBfdGVybWluYXRpb25EYXRlKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCBleHBpcmVkKSB7CiAgICAgICAgcmV0dXJuIChibG9jay50aW1lc3RhbXAgPiBfdGVybWluYXRpb25EYXRlKTsKICAgIH0KCiAgICAvKioKICAgIEBkZXYgR2VuZXJhdGVzIGFuIGlkZW50aWZpZXIgd2hpY2ggYXNzb2NpYXRlcyBhIHVzZXIgYW5kIGEgcG9sbCB0b2dldGhlcgogICAgQHBhcmFtIF9wb2xsSUQgSW50ZWdlciBpZGVudGlmaWVyIGFzc29jaWF0ZWQgd2l0aCB0YXJnZXQgcG9sbAogICAgQHJldHVybiBVVUlEIEhhc2ggd2hpY2ggaXMgZGV0ZXJtaW5pc3RpYyBmcm9tIF91c2VyIGFuZCBfcG9sbElECiAgICAqLwogICAgZnVuY3Rpb24gYXR0clVVSUQoYWRkcmVzcyBfdXNlciwgdWludCBfcG9sbElEKSBwdWJsaWMgcHVyZSByZXR1cm5zIChieXRlczMyIFVVSUQpIHsKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KF91c2VyLCBfcG9sbElEKTsKICAgIH0KfQ=='.
	

]
