Class {
	#name : #SRT0356a7871e3ab819a5183bd367ea6187f6e3acc8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0356a7871e3ab819a5183bd367ea6187f6e3acc8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cn0KLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Ci8qKgogKiBAdGl0bGUgU2FmZUVSQzIwCiAqIEBkZXYgV3JhcHBlcnMgYXJvdW5kIEVSQzIwIG9wZXJhdGlvbnMgdGhhdCB0aHJvdyBvbiBmYWlsdXJlLgogKiBUbyB1c2UgdGhpcyBsaWJyYXJ5IHlvdSBjYW4gYWRkIGEgYHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjA7YCBzdGF0ZW1lbnQgdG8geW91ciBjb250cmFjdCwKICogd2hpY2ggYWxsb3dzIHlvdSB0byBjYWxsIHRoZSBzYWZlIG9wZXJhdGlvbnMgYXMgYHRva2VuLnNhZmVUcmFuc2ZlciguLi4pYCwgZXRjLgogKi8KbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KY29udHJhY3QgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9Ci8qKgogKiBAdGl0bGUgS1lDCiAqIEBkZXYgS1lDIGNvbnRyYWN0IGhhbmRsZXMgdGhlIHdoaXRlIGxpc3QgZm9yIEFTVENyb3dkc2FsZSBjb250cmFjdAogKiBPbmx5IGFjY291bnRzIHJlZ2lzdGVyZWQgaW4gS1lDIGNvbnRyYWN0IGNhbiBidXkgQVNUIHRva2VuLgogKiBBZG1pbnMgY2FuIHJlZ2lzdGVyIGFjY291bnQsIGFuZCB0aGUgcmVhc29uIHdoeQogKi8KY29udHJhY3QgS1lDIGlzIE93bmFibGUgewogIC8vIGNoZWNrIHRoZSBhZGRyZXNzIGlzIHJlZ2lzdGVyZWQgZm9yIHRva2VuIHNhbGUKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyByZWdpc3RlcmVkQWRkcmVzczsKICAvLyBjaGVjayB0aGUgYWRkcmVzcyBpcyBhZG1pbiBvZiBreWMgY29udHJhY3QKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBhZG1pbjsKICBldmVudCBSZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBfYWRkcik7CiAgZXZlbnQgVW5yZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBfYWRkcik7CiAgZXZlbnQgTmV3QWRtaW4oYWRkcmVzcyBpbmRleGVkIF9hZGRyKTsKICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIG93bmVyLCB1aW50MjU2IGJhbGFuY2UpOwogIC8qKgogICAqIEBkZXYgY2hlY2sgd2hldGhlciB0aGUgYWRkcmVzcyBpcyByZWdpc3RlcmVkIGZvciB0b2tlbiBzYWxlIG9yIG5vdC4KICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcwogICAqLwogIG1vZGlmaWVyIG9ubHlSZWdpc3RlcmVkKGFkZHJlc3MgX2FkZHIpIHsKICAgIHJlcXVpcmUocmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJdKTsKICAgIF87CiAgfQogIC8qKgogICAqIEBkZXYgY2hlY2sgd2hldGhlciB0aGUgbXNnLnNlbmRlciBpcyBhZG1pbiBvciBub3QKICAgKi8KICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICByZXF1aXJlKGFkbWluW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQogIGZ1bmN0aW9uIEtZQygpIHsKICAgIGFkbWluW21zZy5zZW5kZXJdID0gdHJ1ZTsKICB9CiAgLyoqCiAgICogQGRldiBzZXQgbmV3IGFkbWluIGFzIGFkbWluIG9mIEtZQyBjb250cmFjdAogICAqIEBwYXJhbSBfYWRkciBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHNldCBhcyBhZG1pbiBvZiBLWUMgY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiBzZXRBZG1pbihhZGRyZXNzIF9hZGRyKQogICAgcHVibGljCiAgICBvbmx5T3duZXIKICB7CiAgICByZXF1aXJlKF9hZGRyICE9IGFkZHJlc3MoMCkgJiYgYWRtaW5bX2FkZHJdID09IGZhbHNlKTsKICAgIGFkbWluW19hZGRyXSA9IHRydWU7CiAgICBOZXdBZG1pbihfYWRkcik7CiAgfQogIC8qKgogICAqIEBkZXYgcmVnaXN0ZXIgdGhlIGFkZHJlc3MgZm9yIHRva2VuIHNhbGUKICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byByZWdpc3RlciBmb3IgdG9rZW4gc2FsZQogICAqLwogIGZ1bmN0aW9uIHJlZ2lzdGVyKGFkZHJlc3MgX2FkZHIpCiAgICBwdWJsaWMKICAgIG9ubHlBZG1pbgogIHsKICAgIHJlcXVpcmUoX2FkZHIgIT0gYWRkcmVzcygwKSAmJiByZWdpc3RlcmVkQWRkcmVzc1tfYWRkcl0gPT0gZmFsc2UpOwogICAgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJdID0gdHJ1ZTsKICAgIFJlZ2lzdGVyZWQoX2FkZHIpOwogIH0KICAvKioKICAgKiBAZGV2IHJlZ2lzdGVyIHRoZSBhZGRyZXNzZXMgZm9yIHRva2VuIHNhbGUKICAgKiBAcGFyYW0gX2FkZHJzIGFkZHJlc3NbXSBUaGUgYWRkcmVzc2VzIHRvIHJlZ2lzdGVyIGZvciB0b2tlbiBzYWxlCiAgICovCiAgZnVuY3Rpb24gcmVnaXN0ZXJCeUxpc3QoYWRkcmVzc1tdIF9hZGRycykKICAgIHB1YmxpYwogICAgb25seUFkbWluCiAgewogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBfYWRkcnMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVxdWlyZShfYWRkcnNbaV0gIT0gYWRkcmVzcygwKSAmJiByZWdpc3RlcmVkQWRkcmVzc1tfYWRkcnNbaV1dID09IGZhbHNlKTsKICAgICAgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJzW2ldXSA9IHRydWU7CiAgICAgIFJlZ2lzdGVyZWQoX2FkZHJzW2ldKTsKICAgIH0KICB9CiAgLyoqCiAgICogQGRldiB1bnJlZ2lzdGVyIHRoZSByZWdpc3RlcmVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB1bnJlZ2lzdGVyIGZvciB0b2tlbiBzYWxlCiAgICovCiAgZnVuY3Rpb24gdW5yZWdpc3RlcihhZGRyZXNzIF9hZGRyKQogICAgcHVibGljCiAgICBvbmx5QWRtaW4KICAgIG9ubHlSZWdpc3RlcmVkKF9hZGRyKQogIHsKICAgIHJlZ2lzdGVyZWRBZGRyZXNzW19hZGRyXSA9IGZhbHNlOwogICAgVW5yZWdpc3RlcmVkKF9hZGRyKTsKICB9CiAgLyoqCiAgICogQGRldiB1bnJlZ2lzdGVyIHRoZSByZWdpc3RlcmVkIGFkZHJlc3NlcwogICAqIEBwYXJhbSBfYWRkcnMgYWRkcmVzc1tdIFRoZSBhZGRyZXNzZXMgdG8gdW5yZWdpc3RlciBmb3IgdG9rZW4gc2FsZQogICAqLwogIGZ1bmN0aW9uIHVucmVnaXN0ZXJCeUxpc3QoYWRkcmVzc1tdIF9hZGRycykKICAgIHB1YmxpYwogICAgb25seUFkbWluCiAgewogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBfYWRkcnMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVxdWlyZShyZWdpc3RlcmVkQWRkcmVzc1tfYWRkcnNbaV1dKTsKICAgICAgcmVnaXN0ZXJlZEFkZHJlc3NbX2FkZHJzW2ldXSA9IGZhbHNlOwogICAgICBVbnJlZ2lzdGVyZWQoX2FkZHJzW2ldKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIEVSQzIwQmFzaWMgdG9rZW4gPSBFUkMyMEJhc2ljKF90b2tlbik7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOwogIH0KfQovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KLy8vIEB0aXRsZSBNaW5pTWVUb2tlbiBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgdG9rZW4gY29udHJhY3QncyBnb2FsIGlzIHRvIG1ha2UgaXQgZWFzeSBmb3IgYW55b25lIHRvIGNsb25lIHRoaXMKLy8vICB0b2tlbiB1c2luZyB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGF0IGEgZ2l2ZW4gYmxvY2ssIHRoaXMgd2lsbCBhbGxvdyBEQU8ncwovLy8gIGFuZCBEQXBwcyB0byB1cGdyYWRlIHRoZWlyIGZlYXR1cmVzIGluIGEgZGVjZW50cmFsaXplZCBtYW5uZXIgd2l0aG91dAovLy8gIGFmZmVjdGluZyB0aGUgb3JpZ2luYWwgdG9rZW4KLy8vIEBkZXYgSXQgaXMgRVJDMjAgY29tcGxpYW50LCBidXQgc3RpbGwgbmVlZHMgdG8gdW5kZXIgZ28gZnVydGhlciB0ZXN0aW5nLgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgcHVibGljIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQogICAgLy8vIEBub3RpY2UgQ2hhbmdlcyB0aGUgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGNvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsKICAgIH0KfQovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMKY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsKICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2VucwogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cwogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMoYm9vbCk7CiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYwogICAgICAgIHJldHVybnMoYm9vbCk7Cn0KY29udHJhY3QgQXBwcm92ZUFuZENhbGxGYWxsQmFjayB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBmcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSkgcHVibGljOwp9Ci8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXIKLy8vICB0aGF0IGRlcGxveXMgdGhlIGNvbnRyYWN0LCBzbyB1c3VhbGx5IHRoaXMgdG9rZW4gd2lsbCBiZSBkZXBsb3llZCBieSBhCi8vLyAgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCwgd2hpY2ggR2l2ZXRoIHdpbGwgY2FsbCBhICJDYW1wYWlnbiIKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7CiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjInOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewogICAgICAgIC8vIGBmcm9tQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBmcm9tCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzCiAgICAvLyAgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBDbG9uZSBUb2tlbgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zCiAgICBNaW5pTWVUb2tlbkZhY3RvcnkgcHVibGljIHRva2VuRmFjdG9yeTsKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgcHVibGljIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBFUkMyMCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgIH0KICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CiAgICAgICAgICAgcmVxdWlyZShwYXJlbnRTbmFwU2hvdEJsb2NrIDwgYmxvY2subnVtYmVyKTsKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICByZXF1aXJlKChfdG8gIT0gMCkgJiYgKF90byAhPSBhZGRyZXNzKHRoaXMpKSk7CiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICB9CiAgICAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSB0cmFuc2ZlcgogICAgICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpOwogICAgICAgICAgIH0KICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZU9mQXQoX293bmVyLCBibG9jay5udW1iZXIpOwogICAgfQogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpOwogICAgICAgIH0KICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCkpOwogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUF0KGJsb2NrLm51bWJlcik7CiAgICB9Ci8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgYmFsYW5jZSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBwdWJsaWMgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZgogICAgICAgIC8vICB0aGlzIHRva2VuCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBIYXMgbm8gcGFyZW50CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQovLy8vLy8vLy8vLy8vLy8vCi8vIENsb25lIFRva2VuIE1ldGhvZAovLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcHVibGljIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBNaW5pTWVUb2tlbiBjbG9uZVRva2VuID0gdG9rZW5GYWN0b3J5LmNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRva2VuIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgIE5ld0Nsb25lVG9rZW4oYWRkcmVzcyhjbG9uZVRva2VuKSwgX3NuYXBzaG90QmxvY2spOwogICAgICAgIHJldHVybiBhZGRyZXNzKGNsb25lVG9rZW4pOwogICAgfQovLy8vLy8vLy8vLy8vLy8vCi8vIEdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2VucwovLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSA+PSBfYW1vdW50KTsKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZUZyb20gPj0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcgogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiB2YWx1ZXMgYmVpbmcgcXVlcmllZAogICAgLy8vIEBwYXJhbSBfYmxvY2sgVGhlIGJsb2NrIG51bWJlciB0byByZXRyaWV2ZSB0aGUgdmFsdWUgYXQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQKICAgIGZ1bmN0aW9uIGdldFZhbHVlQXQoQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX2Jsb2NrCiAgICApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOwogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQogICAgLy8vICBgdG90YWxTdXBwbHlIaXN0b3J5YAogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiBkYXRhIGJlaW5nIHVwZGF0ZWQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfdmFsdWUKICAgICkgaW50ZXJuYWwgIHsKICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLTFdLmZyb21CbG9jayA8IGJsb2NrLm51bWJlcikpIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBvbGRDaGVja1BvaW50ID0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdOwogICAgICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0KICAgIH0KICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZT4wOwogICAgfQogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KICAgIC8vLyBAbm90aWNlIFRoZSBmYWxsYmFjayBmdW5jdGlvbjogSWYgdGhlIGNvbnRyYWN0J3MgY29udHJvbGxlciBoYXMgbm90IGJlZW4KICAgIC8vLyAgc2V0IHRvIDAsIHRoZW4gdGhlIGBwcm94eVBheW1lbnRgIG1ldGhvZCBpcyBjYWxsZWQgd2hpY2ggcmVsYXlzIHRoZQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKTsKICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSk7CiAgICB9Ci8vLy8vLy8vLy8KLy8gU2FmZXR5IE1ldGhvZHMKLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBNaW5pTWVUb2tlbiB0b2tlbiA9IE1pbmlNZVRva2VuKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgIH0KLy8vLy8vLy8vLy8vLy8vLwovLyBFdmVudHMKLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7CiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICAgICApOwp9Ci8vLy8vLy8vLy8vLy8vLy8KLy8gTWluaU1lVG9rZW5GYWN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CiAgICAvLy8gQG5vdGljZSBVcGRhdGUgdGhlIERBcHAgYnkgY3JlYXRpbmcgYSBuZXcgdG9rZW4gd2l0aCBuZXcgZnVuY3Rpb25hbGl0aWVzCiAgICAvLy8gIHRoZSBtc2cuc2VuZGVyIGJlY29tZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgdG9rZW4gYmVpbmcgY2xvbmVkCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgcHVibGljIHJldHVybnMgKE1pbmlNZVRva2VuKSB7CiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF90b2tlbk5hbWUsCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQpjb250cmFjdCBBVEMgaXMgTWluaU1lVG9rZW4gewogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGJsYWNrbGlzdGVkOwogIGJvb2wgcHVibGljIGdlbmVyYXRlRmluaXNoZWQ7CiAgLy8gQGRldiBBVEMgY29uc3RydWN0b3IganVzdCBwYXJhbWV0cml6ZXMgdGhlIE1pbmlNZVRva2VuIGNvbnN0cnVjdG9yCiAgZnVuY3Rpb24gQVRDKGFkZHJlc3MgX3Rva2VuRmFjdG9yeSkKICAgICAgICAgIE1pbmlNZVRva2VuKAogICAgICAgICAgICAgIF90b2tlbkZhY3RvcnksCiAgICAgICAgICAgICAgMHgwLCAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHBhcmVudCB0b2tlbgogICAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBzbmFwc2hvdCBibG9jayBudW1iZXIgZnJvbSBwYXJlbnQKICAgICAgICAgICAgICAiQXN0b24gVG9rZW4iLCAgLy8gVG9rZW4gbmFtZQogICAgICAgICAgICAgIDE4LCAgICAgICAgICAgICAgICAgICAgICAvLyBEZWNpbWFscwogICAgICAgICAgICAgICJBVEMiLCAgICAgICAgICAgICAgICAgICAvLyBTeW1ib2wKICAgICAgICAgICAgICBmYWxzZSAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMKICAgICAgICAgICkge30KICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICAgICkgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGdlbmVyYXRlRmluaXNoZWQgPT0gZmFsc2UpOwogICAgICAgIC8vY2hlY2sgbXNnLnNlbmRlciAoY29udHJvbGxlciA/PykKICAgICAgICByZXR1cm4gc3VwZXIuZ2VuZXJhdGVUb2tlbnMoX293bmVyLCBfYW1vdW50KTsKICAgICAgfQogIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUoYmxhY2tsaXN0ZWRbX2Zyb21dID09IGZhbHNlKTsKICAgICAgICByZXR1cm4gc3VwZXIuZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgICAgfQogIGZ1bmN0aW9uIGZpbmlzaEdlbmVyYXRpbmcoKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBnZW5lcmF0ZUZpbmlzaGVkID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiBibGFja2xpc3RBY2NvdW50KGFkZHJlc3MgdG9rZW5Pd25lcikgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYmxhY2tsaXN0ZWRbdG9rZW5Pd25lcl0gPSB0cnVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIHVuQmxhY2tsaXN0QWNjb3VudChhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGJsYWNrbGlzdGVkW3Rva2VuT3duZXJdID0gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBSZWZ1bmRWYXVsdAogKiBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCBmb3Igc3RvcmluZyBmdW5kcyB3aGlsZSBhIGNyb3dkc2FsZQogKiBpcyBpbiBwcm9ncmVzcy4gU3VwcG9ydHMgcmVmdW5kaW5nIHRoZSBtb25leSBpZiBjcm93ZHNhbGUgZmFpbHMsCiAqIGFuZCBmb3J3YXJkaW5nIGl0IGlmIGNyb3dkc2FsZSBpcyBzdWNjZXNzZnVsLgogKi8KY29udHJhY3QgUmVmdW5kVmF1bHQgaXMgT3duYWJsZSwgU2FmZU1hdGh7CiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGRlcG9zaXRlZDsKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyByZWZ1bmRlZDsKICBTdGF0ZSBwdWJsaWMgc3RhdGU7CiAgYWRkcmVzc1tdIHB1YmxpYyByZXNlcnZlV2FsbGV0OwogIGV2ZW50IENsb3NlZCgpOwogIGV2ZW50IFJlZnVuZHNFbmFibGVkKCk7CiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCk7CiAgLyoqCiAgICogQGRldiBUaGlzIGNvbnN0cnVjdG9yIHNldHMgdGhlIGFkZHJlc3NlcyBvZgogICAqIDEwIHJlc2VydmUgd2FsbGV0cy4KICAgKiBhbmQgZm9yd2FyZGluZyBpdCBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bC4KICAgKiBAcGFyYW0gX3Jlc2VydmVXYWxsZXQgYWRkcmVzc1s1XSBUaGUgYWRkcmVzc2VzIG9mIHJlc2VydmUgd2FsbGV0LgogICAqLwogIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KGFkZHJlc3NbXSBfcmVzZXJ2ZVdhbGxldCkgewogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgICByZXNlcnZlV2FsbGV0ID0gX3Jlc2VydmVXYWxsZXQ7CiAgfQogIC8qKgogICAqIEBkZXYgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiB1c2VyIGJ1eSB0b2tlbnMuIE9ubHkgUmVmdW5kVmF1bHQKICAgKiBjb250cmFjdCBzdG9yZXMgdGhlIEV0aGVyIHVzZXIgc2VudCB3aGljaCBmb3J3YXJkZWQgZnJvbSBjcm93ZHNhbGUKICAgKiBjb250cmFjdC4KICAgKiBAcGFyYW0gaW52ZXN0b3IgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aG8gYnV5IHRoZSB0b2tlbiBmcm9tIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgaW52ZXN0b3IpIG9ubHlPd25lciBwYXlhYmxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBhZGQoZGVwb3NpdGVkW2ludmVzdG9yXSwgbXNnLnZhbHVlKTsKICB9CiAgZXZlbnQgVHJhbnNmZXJyZWQoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKTsKICAvKioKICAgKiBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWxseSBmaW5hbGl6ZWQuCiAgICovCiAgZnVuY3Rpb24gY2xvc2UoKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICB1aW50MjU2IHJlc2VydmVBbW91bnRGb3JFYWNoID0gZGl2KGJhbGFuY2UsIHJlc2VydmVXYWxsZXQubGVuZ3RoKTsKICAgIGZvcih1aW50OCBpID0gMDsgaSA8IHJlc2VydmVXYWxsZXQubGVuZ3RoOyBpKyspewogICAgICByZXNlcnZlV2FsbGV0W2ldLnRyYW5zZmVyKHJlc2VydmVBbW91bnRGb3JFYWNoKTsKICAgICAgVHJhbnNmZXJyZWQocmVzZXJ2ZVdhbGxldFtpXSwgcmVzZXJ2ZUFtb3VudEZvckVhY2gpOwogICAgfQogICAgQ2xvc2VkKCk7CiAgfQogIC8qKgogICAqIEBkZXYgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsbHkgZmluYWxpemVkCiAgICogYW5kIHJlZnVuZCBpcyByZXF1aXJlZC4KICAgKi8KICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CiAgLyoqCiAgICogQGRldiBUaGlzIGZ1bmN0aW9uIGFsbG93cyBmb3IgdXNlciB0byByZWZ1bmQgRXRoZXIuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKICAgIGlmIChyZWZ1bmRlZFtpbnZlc3Rvcl0gPiAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICByZWZ1bmRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRWYWx1ZTsKICAgIGludmVzdG9yLnRyYW5zZmVyKGRlcG9zaXRlZFZhbHVlKTsKICAgIFJlZnVuZGVkKGludmVzdG9yLCBkZXBvc2l0ZWRWYWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KfQovKioKICogQHRpdGxlIFRva2VuVGltZWxvY2sKICogQGRldiBUb2tlblRpbWVsb2NrIGlzIGEgdG9rZW4gaG9sZGVyIGNvbnRyYWN0IHRoYXQgd2lsbCBhbGxvdyBhCiAqIGJlbmVmaWNpYXJ5IHRvIGV4dHJhY3QgdGhlIHRva2VucyBhZnRlciBhIGdpdmVuIHJlbGVhc2UgdGltZQogKi8KY29udHJhY3QgUmVzZXJ2ZUxvY2tlciBpcyBTYWZlTWF0aHsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CiAgRVJDMjBCYXNpYyBwdWJsaWMgdG9rZW47CiAgQVRDQ3Jvd2RTYWxlIHB1YmxpYyBjcm93ZHNhbGU7CiAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CiAgZnVuY3Rpb24gUmVzZXJ2ZUxvY2tlcihhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfY3Jvd2RzYWxlLCBhZGRyZXNzIF9iZW5lZmljaWFyeSkgewogICAgcmVxdWlyZShfdG9rZW4gIT0gMHgwMCk7CiAgICByZXF1aXJlKF9jcm93ZHNhbGUgIT0gMHgwMCk7CiAgICByZXF1aXJlKF9iZW5lZmljaWFyeSAhPSAweDAwKTsKICAgIHRva2VuID0gRVJDMjBCYXNpYyhfdG9rZW4pOwogICAgY3Jvd2RzYWxlID0gQVRDQ3Jvd2RTYWxlKF9jcm93ZHNhbGUpOwogICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgfQogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHRva2VucyBoZWxkIGJ5IHRpbWVsb2NrIHRvIGJlbmVmaWNpYXJ5LgogICAqLwogICBmdW5jdGlvbiByZWxlYXNlKCkgcHVibGljIHsKICAgICB1aW50MjU2IGZpbmFsaXplZFRpbWUgPSBjcm93ZHNhbGUuZmluYWxpemVkVGltZSgpOwogICAgIHJlcXVpcmUoZmluYWxpemVkVGltZSA+IDAgJiYgbm93ID4gYWRkKGZpbmFsaXplZFRpbWUsIDIgeWVhcnMpKTsKICAgICB1aW50MjU2IGFtb3VudCA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICByZXF1aXJlKGFtb3VudCA+IDApOwogICAgIHRva2VuLnNhZmVUcmFuc2ZlcihiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgfQogIGZ1bmN0aW9uIHNldFRva2VuKGFkZHJlc3MgbmV3VG9rZW4pIHB1YmxpYyB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYmVuZWZpY2lhcnkpOwogICAgcmVxdWlyZShuZXdUb2tlbiAhPSAweDAwKTsKICAgIHRva2VuID0gRVJDMjBCYXNpYyhuZXdUb2tlbik7CiAgfQp9Ci8qKgogKiBAdGl0bGUgVG9rZW5UaW1lbG9jawogKiBAZGV2IFRva2VuVGltZWxvY2sgaXMgYSB0b2tlbiBob2xkZXIgY29udHJhY3QgdGhhdCB3aWxsIGFsbG93IGEKICogYmVuZWZpY2lhcnkgdG8gZXh0cmFjdCB0aGUgdG9rZW5zIGFmdGVyIGEgZ2l2ZW4gcmVsZWFzZSB0aW1lCiAqLwpjb250cmFjdCBUZWFtTG9ja2VyIGlzIFNhZmVNYXRoewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKICBFUkMyMEJhc2ljIHB1YmxpYyB0b2tlbjsKICBBVENDcm93ZFNhbGUgcHVibGljIGNyb3dkc2FsZTsKICBhZGRyZXNzW10gcHVibGljIGJlbmVmaWNpYXJpZXM7CiAgdWludDI1NiBwdWJsaWMgY29sbGVjdGVkVG9rZW5zOwogIGZ1bmN0aW9uIFRlYW1Mb2NrZXIoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2Nyb3dkc2FsZSwgYWRkcmVzc1tdIF9iZW5lZmljaWFyaWVzKSB7CiAgICByZXF1aXJlKF90b2tlbiAhPSAweDAwKTsKICAgIHJlcXVpcmUoX2Nyb3dkc2FsZSAhPSAweDAwKTsKICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJpZXNbaV0gIT0gMHgwMCk7CiAgICB9CiAgICB0b2tlbiA9IEVSQzIwQmFzaWMoX3Rva2VuKTsKICAgIGNyb3dkc2FsZSA9IEFUQ0Nyb3dkU2FsZShfY3Jvd2RzYWxlKTsKICAgIGJlbmVmaWNpYXJpZXMgPSBfYmVuZWZpY2lhcmllczsKICB9CiAgLyoqCiAgICogQG5vdGljZSBUcmFuc2ZlcnMgdG9rZW5zIGhlbGQgYnkgdGltZWxvY2sgdG8gYmVuZWZpY2lhcnkuCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZSgpIHB1YmxpYyB7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICB1aW50MjU2IHRvdGFsID0gYWRkKGJhbGFuY2UsIGNvbGxlY3RlZFRva2Vucyk7CiAgICB1aW50MjU2IGZpbmFsaXplZFRpbWUgPSBjcm93ZHNhbGUuZmluYWxpemVkVGltZSgpOwogICAgcmVxdWlyZShmaW5hbGl6ZWRUaW1lID4gMCk7CiAgICB1aW50MjU2IGxvY2tUaW1lMSA9IGFkZChmaW5hbGl6ZWRUaW1lLCAxODMgZGF5cyk7IC8vIDYgbW9udGhzCiAgICB1aW50MjU2IGxvY2tUaW1lMiA9IGFkZChmaW5hbGl6ZWRUaW1lLCAxIHllYXJzKTsgLy8gMSB5ZWFyCiAgICB1aW50MjU2IGN1cnJlbnRSYXRpbyA9IDIwOwogICAgaWYgKG5vdyA+PSBsb2NrVGltZTEpIHsKICAgICAgY3VycmVudFJhdGlvID0gNTA7CiAgICB9CiAgICBpZiAobm93ID49IGxvY2tUaW1lMikgewogICAgICBjdXJyZW50UmF0aW8gPSAxMDA7CiAgICB9CiAgICB1aW50MjU2IHJlbGVhc2VkQW1vdW50ID0gZGl2KG11bCh0b3RhbCwgY3VycmVudFJhdGlvKSwgMTAwKTsKICAgIHVpbnQyNTYgZ3JhbnRBbW91bnQgPSBzdWIocmVsZWFzZWRBbW91bnQsIGNvbGxlY3RlZFRva2Vucyk7CiAgICByZXF1aXJlKGdyYW50QW1vdW50ID4gMCk7CiAgICBjb2xsZWN0ZWRUb2tlbnMgPSBhZGQoY29sbGVjdGVkVG9rZW5zLCBncmFudEFtb3VudCk7CiAgICB1aW50MjU2IGdyYW50QW1vdW50Rm9yRWFjaCA9IGRpdihncmFudEFtb3VudCwgMyk7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBiZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdG9rZW4uc2FmZVRyYW5zZmVyKGJlbmVmaWNpYXJpZXNbaV0sIGdyYW50QW1vdW50Rm9yRWFjaCk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNldFRva2VuKGFkZHJlc3MgbmV3VG9rZW4pIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld1Rva2VuICE9IDB4MDApOwogICAgYm9vbCBpc0JlbmVmaWNpYXJ5OwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAobXNnLnNlbmRlciA9PSBiZW5lZmljaWFyaWVzW2ldKSB7CiAgICAgICAgaXNCZW5lZmljaWFyeSA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJlcXVpcmUoaXNCZW5lZmljaWFyeSk7CiAgICB0b2tlbiA9IEVSQzIwQmFzaWMobmV3VG9rZW4pOwogIH0KfQpjb250cmFjdCBBVENDcm93ZFNhbGUgaXMgT3duYWJsZSwgU2FmZU1hdGgsIFBhdXNhYmxlIHsKICBLWUMgcHVibGljIGt5YzsKICBBVEMgcHVibGljIHRva2VuOwogIFJlZnVuZFZhdWx0IHB1YmxpYyB2YXVsdDsKICBhZGRyZXNzIHB1YmxpYyBwcmVzYWxlOwogIGFkZHJlc3MgcHVibGljIGJvdW50eUFkZHJlc3M7IC8vNSUgZm9yIGJvdW50eQogIGFkZHJlc3MgcHVibGljIHBhcnRuZXJzQWRkcmVzczsgLy8xNSUgZm9yIGNvbW11bml0eSBncm91cHMgJiBwYXJ0bmVycwogIGFkZHJlc3MgcHVibGljIEFUQ1Jlc2VydmVMb2NrZXI7IC8vMTUlIHdpdGggMiB5ZWFycyBsb2NrCiAgYWRkcmVzcyBwdWJsaWMgdGVhbUxvY2tlcjsgLy8gMTUlIHdpdGggMiB5ZWFycyB2ZXN0aW5nCiAgc3RydWN0IFBlcmlvZCB7CiAgICB1aW50MjU2IHN0YXJ0VGltZTsKICAgIHVpbnQyNTYgZW5kVGltZTsKICAgIHVpbnQyNTYgYm9udXM7IC8vIHVzZWQgdG8gY2FsY3VsYXRlIHJhdGUgd2l0aCBib251cy4gcmFnbmUgMCB+IDE1ICgwJSB+IDE1JSkKICB9CiAgdWludDI1NiBwdWJsaWMgYmFzZVJhdGU7IC8vIDEgRVRIID0gMTUwMCBBVEMKICB1aW50MjU2W10gcHVibGljIGFkZGl0aW9uYWxCb251c0Ftb3VudHM7CiAgUGVyaW9kW10gcHVibGljIHBlcmlvZHM7CiAgdWludDggY29uc3RhbnQgcHVibGljIE1BWF9QRVJJT0RfQ09VTlQgPSA4OwogIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKICB1aW50MjU2IHB1YmxpYyBtYXhFdGhlckNhcDsKICB1aW50MjU2IHB1YmxpYyBtaW5FdGhlckNhcDsKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiZW5lZmljaWFyeUZ1bmRlZDsKICBhZGRyZXNzW10gaW52ZXN0b3JMaXN0OwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgaW5JbnZlc3Rvckxpc3Q7CiAgYWRkcmVzcyBwdWJsaWMgQVRDQ29udHJvbGxlcjsKICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZDsKICB1aW50MjU2IHB1YmxpYyByZWZ1bmRDb21wbGV0ZWQ7CiAgYm9vbCBwdWJsaWMgcHJlc2FsZUZhbGxCYWNrQ2FsbGVkOwogIHVpbnQyNTYgcHVibGljIGZpbmFsaXplZFRpbWU7CiAgYm9vbCBwdWJsaWMgaW5pdGlhbGl6ZWQ7CiAgZXZlbnQgQ3Jvd2RTYWxlVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgX2ludmVzdG9yLCBhZGRyZXNzIGluZGV4ZWQgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF90b0Z1bmQsIHVpbnQyNTYgX3Rva2Vucyk7CiAgZXZlbnQgU3RhcnRQZXJpb2QodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lLCB1aW50MjU2IF9ib251cyk7CiAgZXZlbnQgRmluYWxpemVkKCk7CiAgZXZlbnQgUHJlc2FsZUZhbGxCYWNrKHVpbnQyNTYgX3ByZXNhbGVXZWlSYWlzZWQpOwogIGV2ZW50IFB1c2hJbnZlc3Rvckxpc3QoYWRkcmVzcyBfaW52ZXN0b3IpOwogIGV2ZW50IFJlZnVuZEFsbCh1aW50MjU2IF9udW1Ub1JlZnVuZCk7CiAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIF9jbGFpbVRva2VuLCBhZGRyZXNzIG93bmVyLCB1aW50MjU2IGJhbGFuY2UpOwogIGV2ZW50IEluaXRpYWxpemUoKTsKICBmdW5jdGlvbiBpbml0aWFsaXplICgKICAgIGFkZHJlc3MgX2t5YywKICAgIGFkZHJlc3MgX3Rva2VuLAogICAgYWRkcmVzcyBfdmF1bHQsCiAgICBhZGRyZXNzIF9wcmVzYWxlLAogICAgYWRkcmVzcyBfYm91bnR5QWRkcmVzcywKICAgIGFkZHJlc3MgX3BhcnRuZXJzQWRkcmVzcywKICAgIGFkZHJlc3MgX0FUQ1Jlc2VydmVMb2NrZXIsCiAgICBhZGRyZXNzIF90ZWFtTG9ja2VyLAogICAgYWRkcmVzcyBfdG9rZW5Db250cm9sbGVyLAogICAgdWludDI1NiBfbWF4RXRoZXJDYXAsCiAgICB1aW50MjU2IF9taW5FdGhlckNhcCwKICAgIHVpbnQyNTYgX2Jhc2VSYXRlLAogICAgdWludDI1NltdIF9hZGRpdGlvbmFsQm9udXNBbW91bnRzCiAgICApIG9ubHlPd25lciB7CiAgICAgIHJlcXVpcmUoIWluaXRpYWxpemVkKTsKICAgICAgcmVxdWlyZShfa3ljICE9IDB4MDAgJiYgX3Rva2VuICE9IDB4MDAgJiYgX3ZhdWx0ICE9IDB4MDAgJiYgX3ByZXNhbGUgIT0gMHgwMCk7CiAgICAgIHJlcXVpcmUoX2JvdW50eUFkZHJlc3MgIT0gMHgwMCAmJiBfcGFydG5lcnNBZGRyZXNzICE9IDB4MDApOwogICAgICByZXF1aXJlKF9BVENSZXNlcnZlTG9ja2VyICE9IDB4MDAgJiYgX3RlYW1Mb2NrZXIgIT0gMHgwMCk7CiAgICAgIHJlcXVpcmUoX3Rva2VuQ29udHJvbGxlciAhPSAweDAwKTsKICAgICAgcmVxdWlyZSgwIDwgX21pbkV0aGVyQ2FwICYmIF9taW5FdGhlckNhcCA8IF9tYXhFdGhlckNhcCk7CiAgICAgIHJlcXVpcmUoX2Jhc2VSYXRlID4gMCk7CiAgICAgIHJlcXVpcmUoX2FkZGl0aW9uYWxCb251c0Ftb3VudHNbMF0gPiAwKTsKICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2FkZGl0aW9uYWxCb251c0Ftb3VudHMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgcmVxdWlyZShfYWRkaXRpb25hbEJvbnVzQW1vdW50c1tpXSA8IF9hZGRpdGlvbmFsQm9udXNBbW91bnRzW2kgKyAxXSk7CiAgICAgIH0KICAgICAga3ljID0gS1lDKF9reWMpOwogICAgICB0b2tlbiA9IEFUQyhfdG9rZW4pOwogICAgICB2YXVsdCA9IFJlZnVuZFZhdWx0KF92YXVsdCk7CiAgICAgIHByZXNhbGUgPSBfcHJlc2FsZTsKICAgICAgYm91bnR5QWRkcmVzcyA9IF9ib3VudHlBZGRyZXNzOwogICAgICBwYXJ0bmVyc0FkZHJlc3MgPSBfcGFydG5lcnNBZGRyZXNzOwogICAgICBBVENSZXNlcnZlTG9ja2VyID0gX0FUQ1Jlc2VydmVMb2NrZXI7CiAgICAgIHRlYW1Mb2NrZXIgPSBfdGVhbUxvY2tlcjsKICAgICAgQVRDQ29udHJvbGxlciA9IF90b2tlbkNvbnRyb2xsZXI7CiAgICAgIG1heEV0aGVyQ2FwID0gX21heEV0aGVyQ2FwOwogICAgICBtaW5FdGhlckNhcCA9IF9taW5FdGhlckNhcDsKICAgICAgYmFzZVJhdGUgPSBfYmFzZVJhdGU7CiAgICAgIGFkZGl0aW9uYWxCb251c0Ftb3VudHMgPSBfYWRkaXRpb25hbEJvbnVzQW1vdW50czsKICAgICAgaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICBJbml0aWFsaXplKCk7CiAgICB9CiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgYnV5KG1zZy5zZW5kZXIpOwogIH0KICBmdW5jdGlvbiBwcmVzYWxlRmFsbEJhY2sodWludDI1NiBfcHJlc2FsZVdlaVJhaXNlZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoIXByZXNhbGVGYWxsQmFja0NhbGxlZCk7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcHJlc2FsZSk7CiAgICB3ZWlSYWlzZWQgPSBfcHJlc2FsZVdlaVJhaXNlZDsKICAgIHByZXNhbGVGYWxsQmFja0NhbGxlZCA9IHRydWU7CiAgICBQcmVzYWxlRmFsbEJhY2soX3ByZXNhbGVXZWlSYWlzZWQpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIGJ1eShhZGRyZXNzIGJlbmVmaWNpYXJ5KQogICAgcHVibGljCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgICAvLyBjaGVjayB2YWxpZGl0eQogICAgICByZXF1aXJlKHByZXNhbGVGYWxsQmFja0NhbGxlZCk7CiAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gMHgwMCk7CiAgICAgIHJlcXVpcmUoa3ljLnJlZ2lzdGVyZWRBZGRyZXNzKGJlbmVmaWNpYXJ5KSk7CiAgICAgIHJlcXVpcmUob25TYWxlKCkpOwogICAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CiAgICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgICAgLy8gY2FsY3VsYXRlIGV0aCBhbW91bnQKICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAgIHVpbnQyNTYgdG9GdW5kOwogICAgICB1aW50MjU2IHBvc3RXZWlSYWlzZWQgPSBhZGQod2VpUmFpc2VkLCB3ZWlBbW91bnQpOwogICAgICBpZiAocG9zdFdlaVJhaXNlZCA+IG1heEV0aGVyQ2FwKSB7CiAgICAgICAgdG9GdW5kID0gc3ViKG1heEV0aGVyQ2FwLCB3ZWlSYWlzZWQpOwogICAgICB9IGVsc2UgewogICAgICAgIHRvRnVuZCA9IHdlaUFtb3VudDsKICAgICAgfQogICAgICByZXF1aXJlKHRvRnVuZCA+IDApOwogICAgICByZXF1aXJlKHdlaUFtb3VudCA+PSB0b0Z1bmQpOwogICAgICB1aW50MjU2IHJhdGUgPSBjYWxjdWxhdGVSYXRlKHRvRnVuZCk7CiAgICAgIHVpbnQyNTYgdG9rZW5zID0gbXVsKHRvRnVuZCwgcmF0ZSk7CiAgICAgIHVpbnQyNTYgdG9SZXR1cm4gPSBzdWIod2VpQW1vdW50LCB0b0Z1bmQpOwogICAgICBwdXNoSW52ZXN0b3JMaXN0KG1zZy5zZW5kZXIpOwogICAgICB3ZWlSYWlzZWQgPSBhZGQod2VpUmFpc2VkLCB0b0Z1bmQpOwogICAgICBiZW5lZmljaWFyeUZ1bmRlZFtiZW5lZmljaWFyeV0gPSBhZGQoYmVuZWZpY2lhcnlGdW5kZWRbYmVuZWZpY2lhcnldLCB0b0Z1bmQpOwogICAgICB0b2tlbi5nZW5lcmF0ZVRva2VucyhiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgICAgaWYgKHRvUmV0dXJuID4gMCkgewogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG9SZXR1cm4pOwogICAgICB9CiAgICAgIGZvcndhcmRGdW5kcyh0b0Z1bmQpOwogICAgICBDcm93ZFNhbGVUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB0b0Z1bmQsIHRva2Vucyk7CiAgfQogIGZ1bmN0aW9uIHB1c2hJbnZlc3Rvckxpc3QoYWRkcmVzcyBpbnZlc3RvcikgaW50ZXJuYWwgewogICAgaWYgKCFpbkludmVzdG9yTGlzdFtpbnZlc3Rvcl0pIHsKICAgICAgaW5JbnZlc3Rvckxpc3RbaW52ZXN0b3JdID0gdHJ1ZTsKICAgICAgaW52ZXN0b3JMaXN0LnB1c2goaW52ZXN0b3IpOwogICAgICBQdXNoSW52ZXN0b3JMaXN0KGludmVzdG9yKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgIHJldHVybiBub25aZXJvUHVyY2hhc2UgJiYgIW1heFJlYWNoZWQoKTsKICB9CiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKHVpbnQyNTYgdG9GdW5kKSBpbnRlcm5hbCB7CiAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKHRvRnVuZCkobXNnLnNlbmRlcik7CiAgfQogIC8qKgogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgbWluRXRoZXJDYXAgaXMgcmVhY2hlZAogICAqIEByZXR1cm4gdHJ1ZSBpZiBtaW4gZXRoZXIgY2FwIGlzIHJlYWNlZAogICAqLwogIGZ1bmN0aW9uIG1pblJlYWNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbkV0aGVyQ2FwOwogIH0KICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIG1heEV0aGVyQ2FwIGlzIHJlYWNoZWQKICAgKiBAcmV0dXJuIHRydWUgaWYgbWF4IGV0aGVyIGNhcCBpcyByZWFjZWQKICAgKi8KICBmdW5jdGlvbiBtYXhSZWFjaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA9PSBtYXhFdGhlckNhcDsKICB9CiAgZnVuY3Rpb24gZ2V0UGVyaW9kQm9udXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICBib29sIG5vd09uU2FsZTsKICAgIHVpbnQyNTYgY3VycmVudFBlcmlvZDsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHBlcmlvZHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHBlcmlvZHNbaV0uc3RhcnRUaW1lIDw9IG5vdyAmJiBub3cgPD0gcGVyaW9kc1tpXS5lbmRUaW1lKSB7CiAgICAgICAgbm93T25TYWxlID0gdHJ1ZTsKICAgICAgICBjdXJyZW50UGVyaW9kID0gaTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmVxdWlyZShub3dPblNhbGUpOwogICAgcmV0dXJuIHBlcmlvZHNbY3VycmVudFBlcmlvZF0uYm9udXM7CiAgfQogIC8qKgogICAqIEBkZXYgcmF0ZSA9IGJhc2VSYXRlICogKDEwMCArIGJvbnVzKSAvIDEwMAogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVJhdGUodWludDI1NiB0b0Z1bmQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpICB7CiAgICB1aW50IGJvbnVzID0gZ2V0UGVyaW9kQm9udXMoKTsKICAgIC8vIGJvbnVzIGZvciBldGggYW1vdW50CiAgICBpZiAoYWRkaXRpb25hbEJvbnVzQW1vdW50c1swXSA8PSB0b0Z1bmQpIHsKICAgICAgYm9udXMgPSBhZGQoYm9udXMsIDUpOyAvLyA1JSBhbW91bnQgYm9udXMgZm9yIG1vcmUgdGhhbiAzMDAgRVRICiAgICB9CiAgICBpZiAoYWRkaXRpb25hbEJvbnVzQW1vdW50c1sxXSA8PSB0b0Z1bmQpIHsKICAgICAgYm9udXMgPSBhZGQoYm9udXMsIDUpOyAvLyAxMCUgYW1vdW50IGJvbnVzIGZvciBtb3JlIHRoYW4gNjAwMCBFVEgKICAgIH0KICAgIGlmIChhZGRpdGlvbmFsQm9udXNBbW91bnRzWzJdIDw9IHRvRnVuZCkgewogICAgICBib251cyA9IDI1OyAvLyBmaW5hbCAyNSUgYW1vdW50IGJvbnVzIGZvciBtb3JlIHRoYW4gODAwMCBFVEgKICAgIH0KICAgIGlmIChhZGRpdGlvbmFsQm9udXNBbW91bnRzWzNdIDw9IHRvRnVuZCkgewogICAgICBib251cyA9IDMwOyAvLyBmaW5hbCAzMCUgYW1vdW50IGJvbnVzIGZvciBtb3JlIHRoYW4gMTAwMDAgRVRICiAgICB9CiAgICByZXR1cm4gZGl2KG11bChiYXNlUmF0ZSwgYWRkKGJvbnVzLCAxMDApKSwgMTAwKTsKICB9CiAgZnVuY3Rpb24gc3RhcnRQZXJpb2QodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUocGVyaW9kcy5sZW5ndGggPCBNQVhfUEVSSU9EX0NPVU5UKTsKICAgIHJlcXVpcmUobm93IDwgX3N0YXJ0VGltZSAmJiBfc3RhcnRUaW1lIDwgX2VuZFRpbWUpOwogICAgaWYgKHBlcmlvZHMubGVuZ3RoICE9IDApIHsKICAgICAgcmVxdWlyZShzdWIoX2VuZFRpbWUsIF9zdGFydFRpbWUpIDw9IDcgZGF5cyk7CiAgICAgIHJlcXVpcmUocGVyaW9kc1twZXJpb2RzLmxlbmd0aCAtIDFdLmVuZFRpbWUgPCBfc3RhcnRUaW1lKTsKICAgIH0KICAgIC8vIDE1JSAtPiAxMCUgLT4gNSUgLT4gMCUKICAgIFBlcmlvZCBtZW1vcnkgbmV3UGVyaW9kOwogICAgbmV3UGVyaW9kLnN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICBuZXdQZXJpb2QuZW5kVGltZSA9IF9lbmRUaW1lOwogICAgaWYocGVyaW9kcy5sZW5ndGggPCAzKSB7CiAgICAgIG5ld1BlcmlvZC5ib251cyA9IHN1YigxNSwgbXVsKDUsIHBlcmlvZHMubGVuZ3RoKSk7CiAgICB9IGVsc2UgewogICAgICBuZXdQZXJpb2QuYm9udXMgPSAwOwogICAgfQogICAgcGVyaW9kcy5wdXNoKG5ld1BlcmlvZCk7CiAgICBTdGFydFBlcmlvZChfc3RhcnRUaW1lLCBfZW5kVGltZSwgbmV3UGVyaW9kLmJvbnVzKTsKICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiBvblNhbGUoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBub3dPblNhbGU7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwZXJpb2RzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChwZXJpb2RzW2ldLnN0YXJ0VGltZSA8PSBub3cgJiYgbm93IDw9IHBlcmlvZHNbaV0uZW5kVGltZSkgewogICAgICAgIG5vd09uU2FsZSA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBub3dPblNhbGU7CiAgfQogIC8qKgogICAqIEBkZXYgc2hvdWxkIGJlIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZW5kcywgdG8gZG8KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKCFvblNhbGUoKSB8fCBtYXhSZWFjaGVkKCkpOwogICAgZmluYWxpemVkVGltZSA9IG5vdzsKICAgIGZpbmFsaXphdGlvbigpOwogICAgRmluYWxpemVkKCk7CiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgfQogIC8qKgogICAqIEBkZXYgZW5kIHRva2VuIG1pbnRpbmcgb24gZmluYWxpemF0aW9uLCBtaW50IHRva2VucyBmb3IgZGV2IHRlYW0gYW5kIHJlc2VydmUgd2FsbGV0cwogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgIGlmIChtaW5SZWFjaGVkKCkpIHsKICAgICAgdmF1bHQuY2xvc2UoKTsKICAgICAgdWludDI1NiB0b3RhbFRva2VuID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgLy8gdG9rZW4gZGlzdHJpYnV0aW9uIDogNTAlIGZvciBzYWxlLCA1JSBmb3IgYm91bnR5LCAxNSUgZm9yIHBhcnRuZXJzLCAxNSUgZm9yIHJlc2VydmUsIDE1JSBmb3IgdGVhbQogICAgICB1aW50MjU2IGJvdW50eUFtb3VudCA9IGRpdihtdWwodG90YWxUb2tlbiwgNSksIDUwKTsKICAgICAgdWludDI1NiBwYXJ0bmVyc0Ftb3VudCA9IGRpdihtdWwodG90YWxUb2tlbiwgMTUpLCA1MCk7CiAgICAgIHVpbnQyNTYgcmVzZXJ2ZUFtb3VudCA9IGRpdihtdWwodG90YWxUb2tlbiwgMTUpLCA1MCk7CiAgICAgIHVpbnQyNTYgdGVhbUFtb3VudCA9IGRpdihtdWwodG90YWxUb2tlbiwgMTUpLCA1MCk7CiAgICAgIGRpc3RyaWJ1dGVUb2tlbihib3VudHlBbW91bnQsIHBhcnRuZXJzQW1vdW50LCByZXNlcnZlQW1vdW50LCB0ZWFtQW1vdW50KTsKICAgICAgdG9rZW4uZW5hYmxlVHJhbnNmZXJzKHRydWUpOwogICAgfSBlbHNlIHsKICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgfQogICAgdG9rZW4uZmluaXNoR2VuZXJhdGluZygpOwogICAgdG9rZW4uY2hhbmdlQ29udHJvbGxlcihBVENDb250cm9sbGVyKTsKICB9CiAgZnVuY3Rpb24gZGlzdHJpYnV0ZVRva2VuKHVpbnQyNTYgYm91bnR5QW1vdW50LCB1aW50MjU2IHBhcnRuZXJzQW1vdW50LCB1aW50MjU2IHJlc2VydmVBbW91bnQsIHVpbnQyNTYgdGVhbUFtb3VudCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShib3VudHlBZGRyZXNzICE9IDB4MDAgJiYgcGFydG5lcnNBZGRyZXNzICE9IDB4MDApOwogICAgcmVxdWlyZShBVENSZXNlcnZlTG9ja2VyICE9IDB4MDAgJiYgdGVhbUxvY2tlciAhPSAweDAwKTsKICAgIHRva2VuLmdlbmVyYXRlVG9rZW5zKGJvdW50eUFkZHJlc3MsIGJvdW50eUFtb3VudCk7CiAgICB0b2tlbi5nZW5lcmF0ZVRva2VucyhwYXJ0bmVyc0FkZHJlc3MsIHBhcnRuZXJzQW1vdW50KTsKICAgIHRva2VuLmdlbmVyYXRlVG9rZW5zKEFUQ1Jlc2VydmVMb2NrZXIsIHJlc2VydmVBbW91bnQpOwogICAgdG9rZW4uZ2VuZXJhdGVUb2tlbnModGVhbUxvY2tlciwgdGVhbUFtb3VudCk7CiAgfQogIC8qKgogICAqIEBkZXYgcmVmdW5kIGEgbG90IG9mIGludmVzdG9ycyBhdCBhIHRpbWUgY2hlY2tpbmcgb25seU93bmVyCiAgICogQHBhcmFtIG51bVRvUmVmdW5kIHVpbnQyNTYgVGhlIG51bWJlciBvZiBpbnZlc3RvcnMgdG8gcmVmdW5kCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kQWxsKHVpbnQyNTYgbnVtVG9SZWZ1bmQpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoIW1pblJlYWNoZWQoKSk7CiAgICByZXF1aXJlKG51bVRvUmVmdW5kID4gMCk7CiAgICB1aW50MjU2IGxpbWl0ID0gcmVmdW5kQ29tcGxldGVkICsgbnVtVG9SZWZ1bmQ7CiAgICBpZiAobGltaXQgPiBpbnZlc3Rvckxpc3QubGVuZ3RoKSB7CiAgICAgIGxpbWl0ID0gaW52ZXN0b3JMaXN0Lmxlbmd0aDsKICAgIH0KICAgIGZvcih1aW50MjU2IGkgPSByZWZ1bmRDb21wbGV0ZWQ7IGkgPCBsaW1pdDsgaSsrKSB7CiAgICAgIHZhdWx0LnJlZnVuZChpbnZlc3Rvckxpc3RbaV0pOwogICAgfQogICAgcmVmdW5kQ29tcGxldGVkID0gbGltaXQ7CiAgICBSZWZ1bmRBbGwobnVtVG9SZWZ1bmQpOwogIH0KICAvKioKICAgKiBAZGV2IGlmIGNyb3dkc2FsZSBpcyB1bnN1Y2Nlc3NmdWwsIGludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kcyBoZXJlCiAgICogQHBhcmFtIGludmVzdG9yIGFkZHJlc3MgVGhlIGFjY291bnQgdG8gYmUgcmVmdW5kZWQKICAgKi8KICBmdW5jdGlvbiBjbGFpbVJlZnVuZChhZGRyZXNzIGludmVzdG9yKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoIW1pblJlYWNoZWQoKSk7CiAgICByZXR1cm4gdmF1bHQucmVmdW5kKGludmVzdG9yKTsKICB9CiAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfY2xhaW1Ub2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICBpZiAodG9rZW4uY29udHJvbGxlcigpID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgdG9rZW4uY2xhaW1Ub2tlbnMoX2NsYWltVG9rZW4pOwogICAgfQogICAgaWYgKF9jbGFpbVRva2VuID09IDB4MCkgewogICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgRVJDMjBCYXNpYyBjbGFpbVRva2VuID0gRVJDMjBCYXNpYyhfY2xhaW1Ub2tlbik7CiAgICB1aW50MjU2IGJhbGFuY2UgPSBjbGFpbVRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIGNsYWltVG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogICAgQ2xhaW1lZFRva2VucyhfY2xhaW1Ub2tlbiwgb3duZXIsIGJhbGFuY2UpOwogIH0KfQ=='.
	

]
