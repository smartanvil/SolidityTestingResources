Class {
	#name : #SRT11D635bbba3f9B8f7C9b91cA9f315a2207cb5AD5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT11D635bbba3f9B8f7C9b91cA9f315a2207cb5AD5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqIExpYnJhcnkgZWFzaWx5IGhhbmRsZXMgdGhlIGNhc2VzIG9mIG92ZXJmbG93IGFzIHdlbGwgYXMgdW5kZXJmbG93LiAKICogQWxzbyBlbnN1cmVzIHRoYXQgYmFsYW5jZSBkb2VzIG50byBnZXQgbmFlZ2F0aXZlCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCS8vIG11bHRpcGxpZXMgdHdvIHZhbHVlcyBzYWZlbHkgYW5kIHJldHVybnMgcmVzdWx0CglmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCWlmIChhID09IDApIHsKCQkJcmV0dXJuIDA7CgkJfQoJCXVpbnQyNTYgYyA9IGEgKiBiOwoJCWFzc2VydChjIC8gYSA9PSBiKTsKCQlyZXR1cm4gYzsKCX0KCgkvLyBkZXZpZGVzIHR3byB2YWx1ZXMgc2FmZWx5IGFuZCByZXR1cm5zIHJlc3VsdAoJZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQkvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKCQl1aW50MjU2IGMgPSBhIC8gYjsKCQkvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAoJCXJldHVybiBjOwoJfQoKCS8vIHN1YnRyYWN0cyB0d28gdmFsdWVzIHNhZmVseSBhbmQgcmV0dXJucyByZXN1bHQKCWZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CgkJYXNzZXJ0KGIgPD0gYSk7CgkJcmV0dXJuIGEgLSBiOwoJfQoKCS8vIGFkZHMgdHdvIHZhbHVlcyBzYWZlbHkgYW5kIHJldHVybnMgcmVzdWx0CglmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCXVpbnQyNTYgYyA9IGEgKyBiOwoJCWFzc2VydChjID49IGEpOwoJCXJldHVybiBjOwoJfQp9CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewoJYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoJLy8gRXZlbnQgdG8gbG9nIHdoZW5ldmVyIHRoZSBvd25lcnNoaXAgaXMgdHJhbmZlcnJlZAoJZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKCS8qKgoJICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCgkgKiBhY2NvdW50LgoJICovCglmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKCQlvd25lciA9IG1zZy5zZW5kZXI7Cgl9CgoKCS8qKgoJICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgoJICovCgltb2RpZmllciBvbmx5T3duZXIoKSB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKCQlfOwoJfQoKCgkvKioKCSAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCgkgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgoJICovCglmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKCQlyZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwoJCU93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CgkJb3duZXIgPSBuZXdPd25lcjsKCX0KCn0KCi8qKgogKiBAdGl0bGUgVGltZXN0YW1wZWQKICogQGRldiBUaGUgVGltZXN0YW1wZWQgY29udHJhY3QgaGFzIHNldHMgZHVtbXkgdGltZXN0YW1wIGZvciBtZXRob2QgY2FsbHMKICovCmNvbnRyYWN0IFRpbWVzdGFtcGVkIGlzIE93bmFibGUgewoJdWludDI1NiBwdWJsaWMgdHMgPSAwOwoJdWludDI1NiBwdWJsaWMgcGx1cyA9IDA7CgoJZnVuY3Rpb24gZ2V0QmxvY2tUaW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCWlmKHRzID4gMCkgewoJCQlyZXR1cm4gdHMgKyBwbHVzOwoJCX0gZWxzZSB7CgkJCXJldHVybiBibG9jay50aW1lc3RhbXAgKyBwbHVzOyAKCQl9Cgl9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7Cgl1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CglldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCBieXRlcyBkYXRhKTsKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CglldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCW1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCgkvKioKCSogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwoJKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgoJKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCgkqLwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCXJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCgkJLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgoJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CgkJYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgoJCWJ5dGVzIG1lbW9yeSBlbXB0eTsKCQlUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgZW1wdHkpOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgoJKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KCSogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KCSovCglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewoJCXJldHVybiBiYWxhbmNlc1tfb3duZXJdOwoJfQoKfQoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCgkvLyB0cmFja3MgdGhlIGFsbG93YW5jZSBvZiBhZGRyZXNzLiAKCW1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgoJLyoqCgkgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKCSAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KCSAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwoJICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCgkgKi8KCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgkJcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKCQlyZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgoJCWJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKCQliYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKCQlhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwoKCQlieXRlcyBtZW1vcnkgZW1wdHk7CgkJVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlLCBlbXB0eSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KCSAqCgkgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCgkgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCgkgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CgkgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQoJICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgoJICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KCSAqLwoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKCQlBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KCSAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KCSAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgoJICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgoJICovCglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKCX0KCgkvKioKCSAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KCSAqCgkgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKCSAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCgkgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCgkgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAoJICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgoJICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCgkgKi8KCWZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CgkJQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KCSAqCgkgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKCSAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCgkgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCgkgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAoJICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgoJICogQHBhcmFtIF9zdWJ0cmFjdGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gZGVjcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KCSAqLwoJZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CgkJdWludDI1NiBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwoJCWlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKCQkJYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwoJCX0gZWxzZSB7CgkJCWFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwoJCX0KCQlBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwoJCXJldHVybiB0cnVlOwoJfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyM1JlY2VpdmVyIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjIzCiAqLwpjb250cmFjdCBFUkMyMjNSZWNlaXZlciB7CgkgCglzdHJ1Y3QgVEtOIHsKCQlhZGRyZXNzIHNlbmRlcjsKCQl1aW50MjU2IHZhbHVlOwoJCWJ5dGVzIGRhdGE7CgkJYnl0ZXM0IHNpZzsKCX0KCQoJLyoqCgkgKiBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uLiBPdXIgSUNPIGNvbnRyYWN0IHNob3VsZCBpbXBsZW1lbnQgdGhpcyBjb250cmFjdCB0byByZWNldmUgRVJDMjMgY29tcGF0aWJsZSB0b2tlbnMuCgkgKiBFUkMyMyBwcm90b2NvbCBjaGVja3MgaWYgY29udHJhY3QgaGFzIGltcGxlbWVudGVkIHRoaXMgZmFsbGJhY2sgbWV0aG9kIG9yIG5vdC4gCgkgKiBJZiB0aGlzIG1ldGhvZCBpcyBub3QgaW1wbGVtZW50ZWQgdGhlbiB0b2tlbnMgYXJlIG5vdCBzZW50LgoJICogVGhpcyBtZXRob2QgaXMgaW50cm9kdWNlZCB0byBhdm9pZCBsb3NzIG9mIHRva2VucyAKCSAqCgkgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCB0cmFuc2ZlciB0aGUgdG9rZW5zLgoJICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHJlY2VpdmVkLgoJICogQHBhcmFtIF9kYXRhIERhdGEgc2VudCBhbG9uZyB3aXRoIHRyYW5zZmVyIHJlcXVlc3QuCgkgKi8KCWZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcHVyZSB7CgkJVEtOIG1lbW9yeSB0a247CgkJdGtuLnNlbmRlciA9IF9mcm9tOwoJCXRrbi52YWx1ZSA9IF92YWx1ZTsKCQl0a24uZGF0YSA9IF9kYXRhOwoJCS8vIHVpbnQzMiB1ID0gdWludDMyKF9kYXRhWzNdKSArICh1aW50MzIoX2RhdGFbMl0pIDw8IDgpICsgKHVpbnQzMihfZGF0YVsxXSkgPDwgMTYpICsgKHVpbnQzMihfZGF0YVswXSkgPDwgMjQpOwoJCS8vIHRrbi5zaWcgPSBieXRlczQodSk7CgkgIAoJCS8qIHRrbiB2YXJpYWJsZSBpcyBhbmFsb2d1ZSBvZiBtc2cgdmFyaWFibGUgb2YgRXRoZXIgdHJhbnNhY3Rpb24KCQkqICB0a24uc2VuZGVyIGlzIHBlcnNvbiB3aG8gaW5pdGlhdGVkIHRoaXMgdG9rZW4gdHJhbnNhY3Rpb24gICAoYW5hbG9ndWUgb2YgbXNnLnNlbmRlcikKCQkqICB0a24udmFsdWUgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCB3ZXJlIHNlbnQgICAoYW5hbG9ndWUgb2YgbXNnLnZhbHVlKQoJCSogIHRrbi5kYXRhIGlzIGRhdGEgb2YgdG9rZW4gdHJhbnNhY3Rpb24gICAoYW5hbG9ndWUgb2YgbXNnLmRhdGEpCgkJKiAgdGtuLnNpZyBpcyA0IGJ5dGVzIHNpZ25hdHVyZSBvZiBmdW5jdGlvbgoJCSogIGlmIGRhdGEgb2YgdG9rZW4gdHJhbnNhY3Rpb24gaXMgYSBmdW5jdGlvbiBleGVjdXRpb24KCQkqLwoJfQp9CgovKioKICogQHRpdGxlIEVSQzIzIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjIzCiAqLwpjb250cmFjdCBFUkMyMjMgewoJdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSwgYnl0ZXMgZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpOwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSwgYnl0ZXMgZGF0YSwgc3RyaW5nIGN1c3RvbV9mYWxsYmFjaykgcHVibGljIHJldHVybnMgKGJvb2wpOwoJZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgYnl0ZXMgaW5kZXhlZCBkYXRhKTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMjNUb2tlbiB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBFUkMyMyB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjIzCiAqLwoKY29udHJhY3QgRVJDMjIzVG9rZW4gaXMgRVJDMjIzLCBTdGFuZGFyZFRva2VuIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCS8qKgoJICogQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBhbm90aGVyIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzIC4KCSAqIFRoaXMgaXMgbWV0aG9kIHdoZXJlIHlvdSBjYW4gc3VwcGx5IGZhbGxiYWNrIGZ1bmN0aW9uIG5hbWUgYW5kIHRoYXQgZnVuY3Rpb24gd2lsbCBiZSB0cmlnZ2VyZWQuCgkgKiBUaGlzIG1ldGhvZCBpcyBhZGRlZCBhcyBwYXJ0IG9mIEVSQzIzIHN0YW5kYXJkCgkgKgoJICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KCSAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucyByZWNlaXZlZC4KCSAqIEBwYXJhbSBfZGF0YSBEYXRhIHNlbnQgYWxvbmcgd2l0aCB0cmFuc2ZlciByZXF1ZXN0LgoJICogQHBhcmFtIF9jdXN0b21fZmFsbGJhY2sgTmFtZSBvZiB0aGUgbWV0aG9kIHdoaWNoIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgdHJhbnNmZXIgaGFwcGVucy4gSWYgdGhpcyBtZXRob2QgZG9lcyBub3QgZXhpc3RzIG9uIGNvbnRyYWN0IHRoZW4gdHJhbnNhY3Rpb24gd2lsbCBmYWlsCgkgKi8KCWZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEsIHN0cmluZyBfY3VzdG9tX2ZhbGxiYWNrKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJLy8gY2hlY2sgaWYgcmVjZWl2aW5nIGlzIGNvbnRyYWN0CgkJaWYoaXNDb250cmFjdChfdG8pKSB7CgkJCS8vIHZhbGlkYXRlIHRoZSBhZGRyZXNzIGFuZCBiYWxhbmNlCgkJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCQlyZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgoJCQkvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCgkJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CgkJCWJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoJCgkJCS8vIGludm9rZSBjdXN0b20gZmFsbGJhY2sgZnVuY3Rpb24JCQkKCQkJYXNzZXJ0KF90by5jYWxsLnZhbHVlKDApKGJ5dGVzNChrZWNjYWsyNTYoX2N1c3RvbV9mYWxsYmFjaykpLCBtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKSk7CgkJCVRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CgkJCXJldHVybiB0cnVlOwoJCX0KCQllbHNlIHsKCQkJLy8gcmVjZWl2ZXIgaXMgbm90IGEgY29udHJhY3Qgc28gcGVyZm9ybSBub3JtYWwgdHJhbnNmZXIgdG8gYWRkcmVzcwoJCQlyZXR1cm4gdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIF9kYXRhKTsKCQl9Cgl9CiAgCgoJLyoqCgkgKiBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMgLgoJICogWW91IGNhbiBwYXNzIGV4dHJhIGRhdGEgd2hpY2ggY2FuIGJlIHRyYWNrZWQgaW4gZXZlbnQuCgkgKiBUaGlzIG1ldGhvZCBpcyBhZGRlZCBhcyBwYXJ0IG9mIEVSQzIzIHN0YW5kYXJkCgkgKgoJICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KCSAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucyByZWNlaXZlZC4KCSAqIEBwYXJhbSBfZGF0YSBEYXRhIHNlbnQgYWxvbmcgd2l0aCB0cmFuc2ZlciByZXF1ZXN0LgoJICovCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJLy8gY2hlY2sgaWYgcmVjZWl2ZXIgaXMgY29udHJhY3QgYWRkcmVzcwoJCWlmKGlzQ29udHJhY3QoX3RvKSkgewoJCQkvLyBpbnZva2UgdHJhbnNmZXIgcmVxdWVzdCB0byBjb250cmFjdAoJCQlyZXR1cm4gdHJhbnNmZXJUb0NvbnRyYWN0KF90bywgX3ZhbHVlLCBfZGF0YSk7CgkJfQoJCWVsc2UgewoJCQkvLyBpbnZva2UgdHJhbnNmZXIgcmVxdWVzdCB0byBub3JtYWwgdXNlciB3YWxsZXQgYWRkcmVzcwoJCQlyZXR1cm4gdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIF9kYXRhKTsKCQl9Cgl9CiAgCgkvKioKCSAqIEBkZXYgU3RhbmRhcmQgZnVuY3Rpb24gdHJhbnNmZXIgc2ltaWxhciB0byBFUkMyMCB0cmFuc2ZlciB3aXRoIG5vIF9kYXRhIC4KCSAqIEFkZGVkIGR1ZSB0byBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSByZWFzb25zIC4KCSAqCgkgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgcmVjZWl2ZSB0aGUgdG9rZW5zLgoJICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHJlY2VpdmVkLgoJICovCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQkvL3N0YW5kYXJkIGZ1bmN0aW9uIHRyYW5zZmVyIHNpbWlsYXIgdG8gRVJDMjAgdHJhbnNmZXIgd2l0aCBubyBfZGF0YQoJCS8vYWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMKCQlieXRlcyBtZW1vcnkgZW1wdHk7CgoJCS8vIGNoZWNrIGlmIHJlY2VpdmVyIGlzIGNvbnRyYWN0IGFkZHJlc3MKCQlpZihpc0NvbnRyYWN0KF90bykpIHsKCQkJLy8gaW52b2tlIHRyYW5zZmVyIHJlcXVlc3QgdG8gY29udHJhY3QKCQkJcmV0dXJuIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgZW1wdHkpOwoJCX0KCQllbHNlIHsKCQkJLy8gaW52b2tlIHRyYW5zZmVyIHJlcXVlc3QgdG8gbm9ybWFsIHVzZXIgd2FsbGV0IGFkZHJlc3MKCQkJcmV0dXJuIHRyYW5zZmVyVG9BZGRyZXNzKF90bywgX3ZhbHVlLCBlbXB0eSk7CgkJfQoJfQoKCS8qKgoJICogQGRldiBhc3NlbWJsZSB0aGUgZ2l2ZW4gYWRkcmVzcyBieXRlY29kZS4gSWYgYnl0ZWNvZGUgZXhpc3RzIHRoZW4gdGhlIF9hZGRyIGlzIGEgY29udHJhY3QuCgkgKgoJICogQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIHdoaWNoIG5lZWQgdG8gYmUgY2hlY2tlZCBpZiBjb250cmFjdCBhZGRyZXNzIG9yIHdhbGxldCBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wgaXNfY29udHJhY3QpIHsKCQl1aW50MjU2IGxlbmd0aDsKCQlhc3NlbWJseSB7CgkJCS8vcmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkKCQkJbGVuZ3RoIDo9IGV4dGNvZGVzaXplKF9hZGRyKQoJCX0KCQlyZXR1cm4gKGxlbmd0aCA+IDApOwoJfQoKCS8qKgoJICogQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRyYW5zYWN0aW9uIHRhcmdldCBpcyBhbiBhZGRyZXNzLiBUaGlzIGlzIHByaXZhdGUgbWV0aG9kLgoJICoKCSAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCgkgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgcmVjZWl2ZWQuCgkgKiBAcGFyYW0gX2RhdGEgRGF0YSBzZW50IGFsb25nIHdpdGggdHJhbnNmZXIgcmVxdWVzdC4KCSAqLwoJZnVuY3Rpb24gdHJhbnNmZXJUb0FkZHJlc3MoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQkvLyB2YWxpZGF0ZSB0aGUgYWRkcmVzcyBhbmQgYmFsYW5jZQoJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCXJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCgkJLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgoJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CgkJYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgoJCS8vIExvZyB0aGUgdHJhbnNmZXIgZXZlbnQKCQlUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwoJCXJldHVybiB0cnVlOwoJfQogIAoJLyoqCgkgKiBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdHJhbnNhY3Rpb24gdGFyZ2V0IGlzIGEgY29udHJhY3QuIFRoaXMgaXMgcHJpdmF0ZSBtZXRob2QuCgkgKgoJICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KCSAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucyByZWNlaXZlZC4KCSAqIEBwYXJhbSBfZGF0YSBEYXRhIHNlbnQgYWxvbmcgd2l0aCB0cmFuc2ZlciByZXF1ZXN0LgoJICovCglmdW5jdGlvbiB0cmFuc2ZlclRvQ29udHJhY3QoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQkvLyB2YWxpZGF0ZSB0aGUgYWRkcmVzcyBhbmQgYmFsYW5jZQoJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCXJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCgkJLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgoJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CgkJYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgoJCS8vIGNhbGwgZmFsbGJhY2sgZnVuY3Rpb24gb2YgY29udHJhY3QKCQlFUkMyMjNSZWNlaXZlciByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmVyKF90byk7CgkJcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKTsKCQkKCQkvLyBMb2cgdGhlIHRyYW5zZmVyIGV2ZW50CgkJVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KfQoKLyoqCiogQHRpdGxlIGRIZWFsdGhUb2tlbgoqIEBkZXYgVmVyeSBzaW1wbGUgRVJDMjMgVG9rZW4gZXhhbXBsZSwgd2hlcmUgYWxsIHRva2VucyBhcmUgcHJlLWFzc2lnbmVkIHRvIHRoZSBjcmVhdG9yLgoqLwpjb250cmFjdCBkSGVhbHRoVG9rZW4gaXMgRVJDMjIzVG9rZW4sIE93bmFibGUgewoKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJkSGVhbHRoIjsKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gImRIdCI7Cgl1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKCXVpbnQyNTYgY29uc3RhbnQgSU5JVElBTF9TVVBQTFkgPSA1MDAwMDAwMDAgKiAxRTE4OwoJCgkvKioKCSogQGRldiBDb25zdHJ1Y3RvciB0aGF0IGdpdmVzIG1zZy5zZW5kZXIgYWxsIG9mIGV4aXN0aW5nIHRva2Vucy4KCSovCglmdW5jdGlvbiBkSGVhbHRoVG9rZW4oKSBwdWJsaWMgewoJCXRvdGFsU3VwcGx5ID0gSU5JVElBTF9TVVBQTFk7CgkJYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBJTklUSUFMX1NVUFBMWTsKCX0KCgkvKioKCSogQGRldiBpZiBldGhlciBpcyBzZW50IHRvIHRoaXMgYWRkcmVzcywgc2VuZCBpdCBiYWNrLgoJKi8KCWZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewoJCXJldmVydCgpOwoJfQp9CgovKioKICogQHRpdGxlIGRIZWFsdGhUb2tlbkRpc3RyaWJ1dG9yCiAqIEBkZXYgVGhlIERpc3RyaWJ1dG9yIGNvbnRyYWN0IGhhcyBhbiBsaXN0IG9mIHRlYW0gbWVtYmVyIGFkZHJlc3NlcyBhbmQgdGhlaXIgc2hhcmUsIAogKiBhbmQgcHJvdmlkZXMgbWV0aG9kIHdoaWNoIGNhbiBiZSBjYWxsZWQgdG8gZGlzdHJpYnV0ZSBhdmFpbGFibGUgc21hcnQgY29udHJhY3QgYmFsYW5jZSBhY3Jvc3MgdXNlcnMuCiAqLwpjb250cmFjdCBkSGVhbHRoVG9rZW5EaXN0cmlidXRvciBpcyBPd25hYmxlLCBUaW1lc3RhbXBlZCB7Cgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCgkvLyBUaGUgdG9rZW4gYmVpbmcgc29sZCwgdGhpcyBob2xkcyByZWZlcmVuY2UgdG8gbWFpbiB0b2tlbiBjb250cmFjdAoJZEhlYWx0aFRva2VuIHB1YmxpYyB0b2tlbjsKCgkvLyB0b2tlbiB2ZXN0aW5nIGNvbnRyYWN0IGFkZHJlc3NlcwoJYWRkcmVzcyBwdWJsaWMgY29tbXVuaXR5Q29udHJhY3Q7CglhZGRyZXNzIHB1YmxpYyBmb3VuZGVyc0NvbnRyYWN0OwoJYWRkcmVzcyBwdWJsaWMgdGVjaG5pY2FsQ29udHJhY3Q7CglhZGRyZXNzIHB1YmxpYyBtYW5hZ2VtZW50Q29udHJhY3Q7CgoJLy8gdG9rZW4gdmVzdGluZyBjb250cmFjdCBhbW91bnRzCgl1aW50MjU2IHB1YmxpYyBjb21tdW5pdHlBbW91bnQ7Cgl1aW50MjU2IHB1YmxpYyBmb3VuZGVyc0Ftb3VudDsKCXVpbnQyNTYgcHVibGljIHRlY2huaWNhbEFtb3VudDsKCXVpbnQyNTYgcHVibGljIG1hbmFnZW1lbnRBbW91bnQ7CgoJLyoqCgkqIEBkZXYgQ29uc3RydWN0b3IgdGhhdCBpbml0aWFsaXplcyB0ZWFtIGFuZCBzaGFyZQoJKi8KCWZ1bmN0aW9uIGRIZWFsdGhUb2tlbkRpc3RyaWJ1dG9yKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9jb21tdW5pdHlDb250cmFjdCwgYWRkcmVzcyBfZm91bmRlcnNDb250cmFjdCwgYWRkcmVzcyBfdGVjaG5pY2FsQ29udHJhY3QsIGFkZHJlc3MgX21hbmFnZW1lbnRDb250cmFjdCkgcHVibGljIHsKCQkvLyBzZXQgdG9rZW4KCQl0b2tlbiA9IGRIZWFsdGhUb2tlbihfdG9rZW4pOwoKCQkvLyBpbml0aWFsaXplIGNvbnRyYWN0IGFkZHJlc3NlcwoJCWNvbW11bml0eUNvbnRyYWN0ID0gX2NvbW11bml0eUNvbnRyYWN0OwoJCWZvdW5kZXJzQ29udHJhY3QgPSBfZm91bmRlcnNDb250cmFjdDsKCQl0ZWNobmljYWxDb250cmFjdCA9IF90ZWNobmljYWxDb250cmFjdDsKCQltYW5hZ2VtZW50Q29udHJhY3QgPSBfbWFuYWdlbWVudENvbnRyYWN0OwoKCQkvLyBpbml0aWFsaXplIHByZWNlbnRhZ2Ugc2hhcmUKCQljb21tdW5pdHlBbW91bnQgPSAxMDAwMDAwMCAqIDFFMTg7CgkJZm91bmRlcnNBbW91bnQgPSAxNTAwMDAwMCAqIDFFMTg7CgkJdGVjaG5pY2FsQW1vdW50ID0gNTUwMDAwMDAgKiAxRTE4OwoJCW1hbmFnZW1lbnRBbW91bnQgPSA2MDAwMDAwMCAqIDFFMTg7Cgl9CgoJLyoqCgkqIEBkZXYgZGlzdHJpYnV0ZSBmdW5kcy4KCSovCQoJZnVuY3Rpb24gZGlzdHJpYnV0ZSgpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CgkJYnl0ZXMgbWVtb3J5IGVtcHR5OwoKCQkvLyBkaXN0cmlidXRlIGZ1bmRzIHRvIGNvbW11bml0eSAJCQoJCXRva2VuLnRyYW5zZmVyKGNvbW11bml0eUNvbnRyYWN0LCBjb21tdW5pdHlBbW91bnQsIGVtcHR5KTsKCgkJLy8gZGlzdHJpYnV0ZSBmdW5kcyB0byBmb3VuZGVycyAJCQoJCXRva2VuLnRyYW5zZmVyKGZvdW5kZXJzQ29udHJhY3QsIGZvdW5kZXJzQW1vdW50LCBlbXB0eSk7CgoJCS8vIGRpc3RyaWJ1dGUgZnVuZHMgdG8gdGVjaG5pY2FsIAkJCgkJdG9rZW4udHJhbnNmZXIodGVjaG5pY2FsQ29udHJhY3QsIHRlY2huaWNhbEFtb3VudCwgZW1wdHkpOwoKCQkvLyBkaXN0cmlidXRlIGZ1bmRzIHRvIG1hbmFnZW1lbnQgCQkKCQl0b2tlbi50cmFuc2ZlcihtYW5hZ2VtZW50Q29udHJhY3QsIG1hbmFnZW1lbnRBbW91bnQsIGVtcHR5KTsKCX0KfQoKLyoqCiAqIEB0aXRsZSBkSGVhbHRoRXRoZXJEaXN0cmlidXRvcgogKiBAZGV2IFRoZSBEaXN0cmlidXRvciBjb250cmFjdCBoYXMgYW4gbGlzdCBvZiB0ZWFtIG1lbWJlciBhZGRyZXNzZXMgYW5kIHRoZWlyIHNoYXJlLCAKICogYW5kIHByb3ZpZGVzIG1ldGhvZCB3aGljaCBjYW4gYmUgY2FsbGVkIHRvIGRpc3RyaWJ1dGUgYXZhaWxhYmxlIHNtYXJ0IGNvbnRyYWN0IGJhbGFuY2UgYWNyb3NzIHVzZXJzLgogKi8KY29udHJhY3QgZEhlYWx0aEV0aGVyRGlzdHJpYnV0b3IgaXMgT3duYWJsZSwgVGltZXN0YW1wZWQgewoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJYWRkcmVzcyBwdWJsaWMgcHJvamVjdENvbnRyYWN0OwkKCWFkZHJlc3MgcHVibGljIHRlY2hub2xvZ3lDb250cmFjdDsJCglhZGRyZXNzIHB1YmxpYyBmb3VuZGVyQ29udHJhY3Q7CQoKCXVpbnQyNTYgcHVibGljIHByb2plY3RTaGFyZTsKCXVpbnQyNTYgcHVibGljIHRlY2hub2xvZ3lTaGFyZTsKCXVpbnQyNTYgcHVibGljIGZvdW5kZXJTaGFyZTsKCgkvKioKCSogQGRldiBDb25zdHJ1Y3RvciB0aGF0IGluaXRpYWxpemVzIHRlYW0gYW5kIHNoYXJlCgkqLwoJZnVuY3Rpb24gZEhlYWx0aEV0aGVyRGlzdHJpYnV0b3IoYWRkcmVzcyBfcHJvamVjdENvbnRyYWN0LCBhZGRyZXNzIF90ZWNobm9sb2d5Q29udHJhY3QsIGFkZHJlc3MgX2ZvdW5kZXJDb250cmFjdCkgcHVibGljIHsKCgkJLy8gaW5pdGlhbGl6ZSBjb250cmFjdCBhZGRyZXNzZXMKCQlwcm9qZWN0Q29udHJhY3QgPSBfcHJvamVjdENvbnRyYWN0OwkKCQl0ZWNobm9sb2d5Q29udHJhY3QgPSBfdGVjaG5vbG9neUNvbnRyYWN0OwkKCQlmb3VuZGVyQ29udHJhY3QgPSBfZm91bmRlckNvbnRyYWN0OwkKCgkJLy8gaW5pdGlhbGl6ZSBwcmVjZW50YWdlIHNoYXJlCgkJcHJvamVjdFNoYXJlID0gNzI7CgkJdGVjaG5vbG9neVNoYXJlID0gMTg7CgkJZm91bmRlclNoYXJlID0gMTA7Cgl9CgoJLyoqCgkqIEBkZXYgZGlzdHJpYnV0ZSBmdW5kcy4KCSovCQoJZnVuY3Rpb24gZGlzdHJpYnV0ZSgpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CgkJdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwoJCQoJCS8vIGRpc3RyaWJ1dGUgZnVuZHMgdG8gZm91bmRlcnMgCQkKCQl1aW50MjU2IGZvdW5kZXJQYXJ0ID0gYmFsYW5jZS5tdWwoZm91bmRlclNoYXJlKS5kaXYoMTAwKTsKCQlpZihmb3VuZGVyUGFydCA+IDApIHsKCQkJZm91bmRlckNvbnRyYWN0LnRyYW5zZmVyKGZvdW5kZXJQYXJ0KTsKCQl9CgoJCS8vIGRpc3RyaWJ1dGUgZnVuZHMgdG8gdGVjaG5vbG9neSAJCQoJCXVpbnQyNTYgdGVjaG5vbG9neVBhcnQgPSBiYWxhbmNlLm11bCh0ZWNobm9sb2d5U2hhcmUpLmRpdigxMDApOwoJCWlmKHRlY2hub2xvZ3lQYXJ0ID4gMCkgewoJCQl0ZWNobm9sb2d5Q29udHJhY3QudHJhbnNmZXIodGVjaG5vbG9neVBhcnQpOwoJCX0KCgkJLy8gZGlzdHJpYnV0ZSBsZWZ0IGJhbGFuY2UgdG8gcHJvamVjdAoJCXVpbnQyNTYgcHJvamVjdFBhcnQgPSB0aGlzLmJhbGFuY2U7CgkJaWYocHJvamVjdFBhcnQgPiAwKSB7CgkJCXByb2plY3RDb250cmFjdC50cmFuc2Zlcihwcm9qZWN0UGFydCk7CgkJfQoJfQp9CgovKioKKiBAdGl0bGUgZEhlYWx0aFRva2VuSW5jZW50aXZlCiogQGRldiBUaGlzIGlzIHRva2VuIGluY2VudGl2ZSBjb250cmFjdCBpdCByZWNlaXZlcyB0b2tlbnMgYW5kIGhvbGRzIGl0IGZvciBjZXJ0YWluIHBlcmlvZCBvZiB0aW1lCiovCmNvbnRyYWN0IGRIZWFsdGhUb2tlbkluY2VudGl2ZSBpcyBkSGVhbHRoVG9rZW5EaXN0cmlidXRvciwgRVJDMjIzUmVjZWl2ZXIgewoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQsIHRoaXMgaG9sZHMgcmVmZXJlbmNlIHRvIG1haW4gdG9rZW4gY29udHJhY3QKCWRIZWFsdGhUb2tlbiBwdWJsaWMgdG9rZW47CgoJLy8gYW1vdW50IG9mIHRva2VuIG9uIGhvbGQKCXVpbnQyNTYgcHVibGljIG1heFRva2VuRm9ySG9sZCA9IDE0MDAwMDAwMCAqIDFFMTg7CgoJLy8gY29udHJhY3QgdGltZW91dCAKCXVpbnQyNTYgcHVibGljIGNvbnRyYWN0VGltZW91dCA9IDE1NTUyODY0MDA7IC8vIE1vbmRheSwgMTUgQXByaWwgMjAxOSAwMDowMDowMAoKCS8qKgoJKiBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdmVzdGluZyBjb250cmFjdCB3aXRoIGNvbnRyYWN0IGFkZHJlc3NlcyBpbiBwYXJhbWV0ZXIKCSovCglmdW5jdGlvbiBkSGVhbHRoVG9rZW5JbmNlbnRpdmUoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2NvbW11bml0eUNvbnRyYWN0LCBhZGRyZXNzIF9mb3VuZGVyc0NvbnRyYWN0LCBhZGRyZXNzIF90ZWNobmljYWxDb250cmFjdCwgYWRkcmVzcyBfbWFuYWdlbWVudENvbnRyYWN0KSAKCQlkSGVhbHRoVG9rZW5EaXN0cmlidXRvcihfdG9rZW4sIF9jb21tdW5pdHlDb250cmFjdCwgX2ZvdW5kZXJzQ29udHJhY3QsIF90ZWNobmljYWxDb250cmFjdCwgX21hbmFnZW1lbnRDb250cmFjdCkKCQlwdWJsaWMgewoJCS8vIHNldCB0b2tlbgoJCXRva2VuID0gZEhlYWx0aFRva2VuKF90b2tlbik7Cgl9CgoJLyoqCgkqIEBkZXYgTWV0aG9kIGNhbGxlZCBieSBvd25lciBvZiBjb250cmFjdCB0byB3aXRoZHJhdyBhbGwgdG9rZW5zIGFmdGVyIHRpbWVvdXQgaGFzIHJlYWNoZWQKCSovCglmdW5jdGlvbiB3aXRoZHJhdygpIG9ubHlPd25lciBwdWJsaWMgewoJCXJlcXVpcmUoY29udHJhY3RUaW1lb3V0IDw9IGdldEJsb2NrVGltZSgpKTsKCQkKCQkvLyBzZW5kIHJlbWFpbmluZyB0b2tlbnMgYmFjayB0byBvd25lci4KCQl1aW50MjU2IHRva2VucyA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsgCgkJYnl0ZXMgbWVtb3J5IGVtcHR5OwoJCXRva2VuLnRyYW5zZmVyKG93bmVyLCB0b2tlbnMsIGVtcHR5KTsKCX0KfQoKLyoqCiogQHRpdGxlIGRIZWFsdGhUb2tlbkdyb3d0aAoqIEBkZXYgVGhpcyBpcyB0b2tlbiBncm93dGggY29udHJhY3QgaXQgcmVjZWl2ZXMgdG9rZW5zIGFuZCBob2xkcyBpdCBmb3IgY2VydGFpbiBwZXJpb2Qgb2YgdGltZQoqLwpjb250cmFjdCBkSGVhbHRoVG9rZW5Hcm93dGggaXMgT3duYWJsZSwgRVJDMjIzUmVjZWl2ZXIsIFRpbWVzdGFtcGVkIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCS8vIFRoZSB0b2tlbiBiZWluZyBzb2xkLCB0aGlzIGhvbGRzIHJlZmVyZW5jZSB0byBtYWluIHRva2VuIGNvbnRyYWN0CglkSGVhbHRoVG9rZW4gcHVibGljIHRva2VuOwoKCS8vIGFtb3VudCBvZiB0b2tlbiBvbiBob2xkCgl1aW50MjU2IHB1YmxpYyBtYXhUb2tlbkZvckhvbGQgPSAxODAwMDAwMDAgKiAxRTE4OwoKCS8vIGV4Y2hhbmdlcyB3YWxsZXQgYWRkcmVzcwoJYWRkcmVzcyBwdWJsaWMgZXhjaGFuZ2VzV2FsbGV0OwoJdWludDI1NiBwdWJsaWMgZXhjaGFuZ2VzVG9rZW5zID0gNDUwMDAwMDAgKiAxRTE4OwoJdWludDI1NiBwdWJsaWMgZXhjaGFuZ2VzTG9ja0VuZGluZ0F0ID0gMTUyMzc1MDQwMDsgLy8gU3VuZGF5LCAxNSBBcHJpbCAyMDE4IDAwOjAwOjAwCglib29sIHB1YmxpYyBleGNoYW5nZXNTdGF0dXMgPSBmYWxzZTsKCgkvLyBjb3VudHJpZXMgd2FsbGV0IGFkZHJlc3MKCWFkZHJlc3MgcHVibGljIGNvdW50cmllc1dhbGxldDsKCXVpbnQyNTYgcHVibGljIGNvdW50cmllc1Rva2VucyA9IDQ1MDAwMDAwICogMUUxODsKCXVpbnQyNTYgcHVibGljIGNvdW50cmllc0xvY2tFbmRpbmdBdCA9IDE1MjUxMzI4MDA7IC8vIFR1ZXNkYXksIDEgTWF5IDIwMTggMDA6MDA6MDAKCWJvb2wgcHVibGljIGNvdW50cmllc1N0YXR1cyA9IGZhbHNlOwoKCS8vIGFjcXVpc2l0aW9ucyB3YWxsZXQgYWRkcmVzcwoJYWRkcmVzcyBwdWJsaWMgYWNxdWlzaXRpb25zV2FsbGV0OwoJdWludDI1NiBwdWJsaWMgYWNxdWlzaXRpb25zVG9rZW5zID0gNDUwMDAwMDAgKiAxRTE4OwoJdWludDI1NiBwdWJsaWMgYWNxdWlzaXRpb25zTG9ja0VuZGluZ0F0ID0gMTUyNjM0MjQwMDsgLy8gVHVlc2RheSwgMTUgTWF5IDIwMTggMDA6MDA6MDAKCWJvb2wgcHVibGljIGFjcXVpc2l0aW9uc1N0YXR1cyA9IGZhbHNlOwoKCS8vIGNvaW5kcm9wcyB3YWxsZXQgYWRkcmVzcwoJYWRkcmVzcyBwdWJsaWMgY29pbmRyb3BzV2FsbGV0OwoJdWludDI1NiBwdWJsaWMgY29pbmRyb3BzVG9rZW5zID0gNDUwMDAwMDAgKiAxRTE4OwoJdWludDI1NiBwdWJsaWMgY29pbmRyb3BzTG9ja0VuZGluZ0F0ID0gMTUyNzgxMTIwMDsgLy8gRnJpZGF5LCAxIEp1bmUgMjAxOCAwMDowMDowMAoJYm9vbCBwdWJsaWMgY29pbmRyb3BzU3RhdHVzID0gZmFsc2U7CgoJLy8gY29udHJhY3QgdGltZW91dCAKCXVpbnQyNTYgcHVibGljIGNvbnRyYWN0VGltZW91dCA9IDE1NTUyODY0MDA7IC8vIE1vbmRheSwgMTUgQXByaWwgMjAxOSAwMDowMDowMAoKCS8qKgoJKiBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdmVzdGluZyBjb250cmFjdCB3aXRoIGNvbnRyYWN0IGFkZHJlc3NlcyBpbiBwYXJhbWV0ZXIKCSovCglmdW5jdGlvbiBkSGVhbHRoVG9rZW5Hcm93dGgoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2V4Y2hhbmdlc1dhbGxldCwgYWRkcmVzcyBfY291bnRyaWVzV2FsbGV0LCBhZGRyZXNzIF9hY3F1aXNpdGlvbnNXYWxsZXQsIGFkZHJlc3MgX2NvaW5kcm9wc1dhbGxldCkgcHVibGljIHsKCQkvLyBzZXQgdG9rZW4KCQl0b2tlbiA9IGRIZWFsdGhUb2tlbihfdG9rZW4pOwoKCQkvLyBzZXR1cCB3YWxsZXQgYWRkcmVzc2VzCgkJZXhjaGFuZ2VzV2FsbGV0ID0gX2V4Y2hhbmdlc1dhbGxldDsKCQljb3VudHJpZXNXYWxsZXQgPSBfY291bnRyaWVzV2FsbGV0OwoJCWFjcXVpc2l0aW9uc1dhbGxldCA9IF9hY3F1aXNpdGlvbnNXYWxsZXQ7CgkJY29pbmRyb3BzV2FsbGV0ID0gX2NvaW5kcm9wc1dhbGxldDsKCX0KCgkvKioKCSogQGRldiBNZXRob2QgY2FsbGVkIGJ5IGFueW9uZSB0byB3aXRoZHJhdyBmdW5kcyB0byBleGNoYW5nZXMgd2FsbGV0IGFmdGVyIGxvY2tpbmcgcGVyaW9kCgkqLwoJZnVuY3Rpb24gd2l0aGRyYXdFeGNoYW5nZXNUb2tlbigpIHB1YmxpYyB7CgkJLy8gY2hlY2sgaWYgdGltZSBoYXMgcmVhY2hlZAoJCXJlcXVpcmUoZXhjaGFuZ2VzTG9ja0VuZGluZ0F0IDw9IGdldEJsb2NrVGltZSgpKTsKCQkvLyBlbnN1cmUgdGhhdCB0b2tlbnMgYXJlIG5vdCBhbHJlYWR5IHRyYW5zZmVycmVkCgkJcmVxdWlyZShleGNoYW5nZXNTdGF0dXMgPT0gZmFsc2UpOwoJCQoJCS8vIHRyYW5zZmVyIHRva2VucyB0byB3YWxsZXQgYW5kIGNoYW5nZSBzdGF0dXMgdG8gcHJldmVudCBkb3VibGUgdHJhbnNmZXIJCQoJCWJ5dGVzIG1lbW9yeSBlbXB0eTsKCQl0b2tlbi50cmFuc2ZlcihleGNoYW5nZXNXYWxsZXQsIGV4Y2hhbmdlc1Rva2VucywgZW1wdHkpOwoJCWV4Y2hhbmdlc1N0YXR1cyA9IHRydWU7Cgl9CgoJLyoqCgkqIEBkZXYgTWV0aG9kIGNhbGxlZCBieSBhbnlvbmUgdG8gd2l0aGRyYXcgZnVuZHMgdG8gY291bnRyaWVzIHdhbGxldCBhZnRlciBsb2NraW5nIHBlcmlvZAoJKi8KCWZ1bmN0aW9uIHdpdGhkcmF3Q291bnRyaWVzVG9rZW4oKSBwdWJsaWMgewoJCS8vIGNoZWNrIGlmIHRpbWUgaGFzIHJlYWNoZWQKCQlyZXF1aXJlKGNvdW50cmllc0xvY2tFbmRpbmdBdCA8PSBnZXRCbG9ja1RpbWUoKSk7CgkJLy8gZW5zdXJlIHRoYXQgdG9rZW5zIGFyZSBub3QgYWxyZWFkeSB0cmFuc2ZlcnJlZAoJCXJlcXVpcmUoY291bnRyaWVzU3RhdHVzID09IGZhbHNlKTsKCQkKCQkvLyB0cmFuc2ZlciB0b2tlbnMgdG8gd2FsbGV0IGFuZCBjaGFuZ2Ugc3RhdHVzIHRvIHByZXZlbnQgZG91YmxlIHRyYW5zZmVyCQkKCQlieXRlcyBtZW1vcnkgZW1wdHk7CgkJdG9rZW4udHJhbnNmZXIoY291bnRyaWVzV2FsbGV0LCBjb3VudHJpZXNUb2tlbnMsIGVtcHR5KTsKCQljb3VudHJpZXNTdGF0dXMgPSB0cnVlOwoJfQoKCS8qKgoJKiBAZGV2IE1ldGhvZCBjYWxsZWQgYnkgYW55b25lIHRvIHdpdGhkcmF3IGZ1bmRzIHRvIGFjcXVpc2l0aW9ucyB3YWxsZXQgYWZ0ZXIgbG9ja2luZyBwZXJpb2QKCSovCglmdW5jdGlvbiB3aXRoZHJhd0FjcXVpc2l0aW9uc1Rva2VuKCkgcHVibGljIHsKCQkvLyBjaGVjayBpZiB0aW1lIGhhcyByZWFjaGVkCgkJcmVxdWlyZShhY3F1aXNpdGlvbnNMb2NrRW5kaW5nQXQgPD0gZ2V0QmxvY2tUaW1lKCkpOwoJCS8vIGVuc3VyZSB0aGF0IHRva2VucyBhcmUgbm90IGFscmVhZHkgdHJhbnNmZXJyZWQKCQlyZXF1aXJlKGFjcXVpc2l0aW9uc1N0YXR1cyA9PSBmYWxzZSk7CgkJCgkJLy8gdHJhbnNmZXIgdG9rZW5zIHRvIHdhbGxldCBhbmQgY2hhbmdlIHN0YXR1cyB0byBwcmV2ZW50IGRvdWJsZSB0cmFuc2ZlcgkJCgkJYnl0ZXMgbWVtb3J5IGVtcHR5OwoJCXRva2VuLnRyYW5zZmVyKGFjcXVpc2l0aW9uc1dhbGxldCwgYWNxdWlzaXRpb25zVG9rZW5zLCBlbXB0eSk7CgkJYWNxdWlzaXRpb25zU3RhdHVzID0gdHJ1ZTsKCX0KCgkvKioKCSogQGRldiBNZXRob2QgY2FsbGVkIGJ5IGFueW9uZSB0byB3aXRoZHJhdyBmdW5kcyB0byBjb2luZHJvcHMgd2FsbGV0IGFmdGVyIGxvY2tpbmcgcGVyaW9kCgkqLwoJZnVuY3Rpb24gd2l0aGRyYXdDb2luZHJvcHNUb2tlbigpIHB1YmxpYyB7CgkJLy8gY2hlY2sgaWYgdGltZSBoYXMgcmVhY2hlZAoJCXJlcXVpcmUoY29pbmRyb3BzTG9ja0VuZGluZ0F0IDw9IGdldEJsb2NrVGltZSgpKTsKCQkvLyBlbnN1cmUgdGhhdCB0b2tlbnMgYXJlIG5vdCBhbHJlYWR5IHRyYW5zZmVycmVkCgkJcmVxdWlyZShjb2luZHJvcHNTdGF0dXMgPT0gZmFsc2UpOwoJCQoJCS8vIHRyYW5zZmVyIHRva2VucyB0byB3YWxsZXQgYW5kIGNoYW5nZSBzdGF0dXMgdG8gcHJldmVudCBkb3VibGUgdHJhbnNmZXIJCQoJCWJ5dGVzIG1lbW9yeSBlbXB0eTsKCQl0b2tlbi50cmFuc2Zlcihjb2luZHJvcHNXYWxsZXQsIGNvaW5kcm9wc1Rva2VucywgZW1wdHkpOwoJCWNvaW5kcm9wc1N0YXR1cyA9IHRydWU7Cgl9CgoJLyoqCgkqIEBkZXYgTWV0aG9kIGNhbGxlZCBieSBvd25lciBvZiBjb250cmFjdCB0byB3aXRoZHJhdyBhbGwgdG9rZW5zIGFmdGVyIHRpbWVvdXQgaGFzIHJlYWNoZWQKCSovCglmdW5jdGlvbiB3aXRoZHJhdygpIG9ubHlPd25lciBwdWJsaWMgewoJCXJlcXVpcmUoY29udHJhY3RUaW1lb3V0IDw9IGdldEJsb2NrVGltZSgpKTsKCQkKCQkvLyBzZW5kIHJlbWFpbmluZyB0b2tlbnMgYmFjayB0byBvd25lci4KCQl1aW50MjU2IHRva2VucyA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsgCgkJYnl0ZXMgbWVtb3J5IGVtcHR5OwoJCXRva2VuLnRyYW5zZmVyKG93bmVyLCB0b2tlbnMsIGVtcHR5KTsKCX0KfQoKCi8qKgoqIEB0aXRsZSBkSGVhbHRoVG9rZW5TYWxlCiogQGRldiBUaGlzIGlzIElDTyBDb250cmFjdC4gCiogVGhpcyBjbGFzcyBhY2NlcHRzIHRoZSB0b2tlbiBhZGRyZXNzIGFzIGFyZ3VtZW50IHRvIHRhbGsgd2l0aCBjb250cmFjdC4KKiBPbmNlIGNvbnRyYWN0IGlzIGRlcGxveWVkLCBmdW5kcyBhcmUgdHJhbnNmZXJyZWQgdG8gSUNPIHNtYXJ0IGNvbnRyYWN0IGFkZHJlc3MgYW5kIHRoZW4gZGlzdHJpYnV0ZWQgd2l0aCBpbnZlc3Rvci4KKiBTZW5kaW5nIGZ1bmRzIHRvIHRoaXMgZW5zdXJlcyB0aGF0IG5vIG1vcmUgdGhhbiBkZXNpcmVkIHRva2VucyBhcmUgc29sZC4KKi8KY29udHJhY3QgZEhlYWx0aFRva2VuU2FsZSBpcyBkSGVhbHRoRXRoZXJEaXN0cmlidXRvciwgRVJDMjIzUmVjZWl2ZXIgewoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQsIHRoaXMgaG9sZHMgcmVmZXJlbmNlIHRvIG1haW4gdG9rZW4gY29udHJhY3QKCWRIZWFsdGhUb2tlbiBwdWJsaWMgdG9rZW47CgoJLy8gYW1vdW50IG9mIHRva2VuIHRvIGJlIHNvbGQgb24gc2FsZQoJdWludDI1NiBwdWJsaWMgbWF4VG9rZW5Gb3JTYWxlID0gMTgwMDAwMDAwICogMUUxODsKCgkvLyB0aW1lc3RhbXAgd2hlbiBwaGFzZSAxIHN0YXJ0cwoJdWludDI1NiBwdWJsaWMgcGhhc2UxU3RhcnRpbmdBdCA9IDE1MTY5MjQ4MDA7IC8vIEZyaWRheSwgMjYgSmFudWFyeSAyMDE4IDAwOjAwOjAwCgl1aW50MjU2IHB1YmxpYyBwaGFzZTFFbmRpbmdBdCA9IDE1MTgxMzQzOTk7IC8vIFRodXJzZGF5LCA4IEZlYnJ1YXJ5IDIwMTggMjM6NTk6NTkKCXVpbnQyNTYgcHVibGljIHBoYXNlMU1heFRva2VuRm9yU2FsZSA9IG1heFRva2VuRm9yU2FsZSAqIDEgLyAzOwoJdWludDI1NiBwdWJsaWMgcGhhc2UxVG9rZW5QcmljZUluRXRoID0gMC4wMDA1IGV0aGVyOwoJdWludDI1NiBwdWJsaWMgcGhhc2UxVG9rZW5Tb2xkID0gMDsKCgkvLyB0aW1lc3RhbXAgd2hlbiBwaGFzZSAyIHN0YXJ0cwoJdWludDI1NiBwdWJsaWMgcGhhc2UyU3RhcnRpbmdBdCA9IDE1MTgxMzQ0MDA7IC8vIEZyaWRheSwgOSBGZWJydWFyeSAyMDE4IDAwOjAwOjAwCgl1aW50MjU2IHB1YmxpYyBwaGFzZTJFbmRpbmdBdCA9IDE1MTkzNDM5OTk7IC8vIFRodXJzZGF5LCAyMiBGZWJydWFyeSAyMDE4IDIzOjU5OjU5Cgl1aW50MjU2IHB1YmxpYyBwaGFzZTJNYXhUb2tlbkZvclNhbGUgPSBtYXhUb2tlbkZvclNhbGUgKiAyIC8gMzsKCXVpbnQyNTYgcHVibGljIHBoYXNlMlRva2VuUHJpY2VJbkV0aCA9IDAuMDAwNjA2MDYwNjA2IGV0aGVyOwoJdWludDI1NiBwdWJsaWMgcGhhc2UyVG9rZW5Tb2xkID0gMDsKCgkvLyB0aW1lc3RhbXAgd2hlbiBwaGFzZSAzIHN0YXJ0cwoJdWludDI1NiBwdWJsaWMgcGhhc2UzU3RhcnRpbmdBdCA9IDE1MTkzNDQwMDA7IC8vIEZyaWRheSwgMjMgRmVicnVhcnkgMjAxOCAwMDowMDowMAoJdWludDI1NiBwdWJsaWMgcGhhc2UzRW5kaW5nQXQgPSAxNTIwNTUzNTk5OyAvLyBUaHVyc2RheSwgOCBNYXJjaCAyMDE4IDIzOjU5OjU5Cgl1aW50MjU2IHB1YmxpYyBwaGFzZTNNYXhUb2tlbkZvclNhbGUgPSBtYXhUb2tlbkZvclNhbGU7Cgl1aW50MjU2IHB1YmxpYyBwaGFzZTNUb2tlblByaWNlSW5FdGggPSAwLjAwMDc2OTIzMDc2OSBldGhlcjsKCXVpbnQyNTYgcHVibGljIHBoYXNlM1Rva2VuU29sZCA9IDA7CgoJLy8gY29udHJhY3QgdGltZW91dCB0byBpbml0aWF0ZSBsZWZ0IGZ1bmRzIGFuZCB0b2tlbiB0cmFuc2ZlcgoJdWludDI1NiBwdWJsaWMgY29udHJhY3RUaW1lb3V0ID0gMTUyMDU1MzYwMDsgLy8gRnJpZGF5LCA5IE1hcmNoIDIwMTggMDA6MDA6MDAKCgkvLyBncm93dGggY29udHJhY3QgYWRkcmVzcwoJYWRkcmVzcyBwdWJsaWMgZ3Jvd3RoQ29udHJhY3Q7CgoJLy8gbWF4aW11bSBldGhlciBpbnZlc3RlZCBwZXIgdHJhbnNhY3Rpb24KCXVpbnQyNTYgcHVibGljIG1heEV0aFBlclRyYW5zYWN0aW9uID0gMTAwMCBldGhlcjsKCgkvLyBtaW5pbXVtIGV0aGVyIGludmVzdGVkIHBlciB0cmFuc2FjdGlvbgoJdWludDI1NiBwdWJsaWMgbWluRXRoUGVyVHJhbnNhY3Rpb24gPSAwLjAxIGV0aGVyOwoKCS8vIGFtb3VudCBvZiB0b2tlbiBzb2xkIHNvIGZhcgoJdWludDI1NiBwdWJsaWMgdG90YWxUb2tlblNvbGQ7CgoJLy8gYW1vdW50IG9mIGV0aGVyIHJhaXNlZCBpbiBzYWxlCgl1aW50MjU2IHB1YmxpYyB0b3RhbEV0aGVyUmFpc2VkOwoKCS8vIGV0aGVyIHJhaXNlZCBwZXIgd2FsbGV0CgltYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGV0aGVyUmFpc2VkUGVyV2FsbGV0OwoKCS8vIGlzIGNvbnRyYWN0IGNsb3NlIGFuZCBlbmRlZAoJYm9vbCBwdWJsaWMgaXNDbG9zZSA9IGZhbHNlOwoKCS8vIGlzIGNvbnRyYWN0IHBhdXNlZAoJYm9vbCBwdWJsaWMgaXNQYXVzZWQgPSBmYWxzZTsKCgkvLyB0b2tlbiBwdXJjaHNhZSBldmVudAoJZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgX3B1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdGltZXN0YW1wKTsKCgkvLyBtYW51YWwgdHJhbnNmZXIgYnkgYWRtaW4gZm9yIGV4dGVybmFsIHB1cmNoYXNlCglldmVudCBUcmFuc2Zlck1hbnVhbChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBzdHJpbmcgX21lc3NhZ2UpOwoKCS8qKgoJKiBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdG9rZW4gY29udHJhY3Qgd2l0aCB0b2tlbiBhZGRyZXNzIGluIHBhcmFtZXRlcgoJKi8KCWZ1bmN0aW9uIGRIZWFsdGhUb2tlblNhbGUoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX3Byb2plY3RDb250cmFjdCwgYWRkcmVzcyBfdGVjaG5vbG9neUNvbnRyYWN0LCBhZGRyZXNzIF9mb3VuZGVyQ29udHJhY3QsIGFkZHJlc3MgX2dyb3d0aENvbnRyYWN0KQoJCWRIZWFsdGhFdGhlckRpc3RyaWJ1dG9yKF9wcm9qZWN0Q29udHJhY3QsIF90ZWNobm9sb2d5Q29udHJhY3QsIF9mb3VuZGVyQ29udHJhY3QpCgkJcHVibGljIHsKCQkvLyBzZXQgdG9rZW4KCQl0b2tlbiA9IGRIZWFsdGhUb2tlbihfdG9rZW4pOwoKCQkvLyBzZXQgZ3Jvd3RoIGNvbnRyYWN0IGFkZHJlc3MKCQlncm93dGhDb250cmFjdCA9IF9ncm93dGhDb250cmFjdDsKCX0KCgkvKioKCSAqIEBkZXYgRnVuY3Rpb24gdGhhdCB2YWxpZGF0ZXMgaWYgdGhlIHB1cmNoYXNlIGlzIHZhbGlkIGJ5IHZlcmlmeWluZyB0aGUgcGFyYW1ldGVycwoJICoKCSAqIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgZXRoZXJzIHNlbnQKCSAqIEBwYXJhbSBhbW91bnQgVG90YWwgbnVtYmVyIG9mIHRva2VucyB1c2VyIGlzIHRyeWluZyB0byBidXkuCgkgKgoJICogQHJldHVybiBjaGVja3MgdmFyaW91cyBjb25kaXRpb25zIGFuZCByZXR1cm5zIHRoZSBib29sIHJlc3VsdCBpbmRpY2F0aW5nIHZhbGlkaXR5LgoJICovCglmdW5jdGlvbiB2YWxpZGF0ZSh1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewoJCS8vIGNoZWNrIGlmIHRpbWVzdGFtcCBhbmQgYW1vdW50IGlzIGZhbGxpbmcgaW4gdGhlIHJhbmdlCgkJYm9vbCB2YWxpZFRpbWVzdGFtcCA9IGZhbHNlOwoJCWJvb2wgdmFsaWRBbW91bnQgPSBmYWxzZTsKCgkJLy8gY2hlY2sgaWYgcGhhc2UgMSBpcyBydW5uaW5nCQoJCWlmKHBoYXNlMVN0YXJ0aW5nQXQgPD0gZ2V0QmxvY2tUaW1lKCkgJiYgZ2V0QmxvY2tUaW1lKCkgPD0gcGhhc2UxRW5kaW5nQXQpIHsKCQkJLy8gY2hlY2sgaWYgdG9rZW5zIGlzIGZhbGxpbmcgaW4gdGltZXJhbmdlCgkJCXZhbGlkVGltZXN0YW1wID0gdHJ1ZTsKCgkJCS8vIGNoZWNrIGlmIHRva2VuIGFtb3VudCBpcyBmYWxsaW5nIGluIGxpbWl0CgkJCXZhbGlkQW1vdW50ID0gcGhhc2UxTWF4VG9rZW5Gb3JTYWxlLnN1Yih0b3RhbFRva2VuU29sZCkgPj0gYW1vdW50OwoJCX0KCgkJLy8gY2hlY2sgaWYgcGhhc2UgMiBpcyBydW5uaW5nCQoJCWlmKHBoYXNlMlN0YXJ0aW5nQXQgPD0gZ2V0QmxvY2tUaW1lKCkgJiYgZ2V0QmxvY2tUaW1lKCkgPD0gcGhhc2UyRW5kaW5nQXQpIHsKCQkJLy8gY2hlY2sgaWYgdG9rZW5zIGlzIGZhbGxpbmcgaW4gdGltZXJhbmdlCgkJCXZhbGlkVGltZXN0YW1wID0gdHJ1ZTsKCgkJCS8vIGNoZWNrIGlmIHRva2VuIGFtb3VudCBpcyBmYWxsaW5nIGluIGxpbWl0CgkJCXZhbGlkQW1vdW50ID0gcGhhc2UyTWF4VG9rZW5Gb3JTYWxlLnN1Yih0b3RhbFRva2VuU29sZCkgPj0gYW1vdW50OwoJCX0KCgkJLy8gY2hlY2sgaWYgcGhhc2UgMyBpcyBydW5uaW5nCQoJCWlmKHBoYXNlM1N0YXJ0aW5nQXQgPD0gZ2V0QmxvY2tUaW1lKCkgJiYgZ2V0QmxvY2tUaW1lKCkgPD0gcGhhc2UzRW5kaW5nQXQpIHsKCQkJLy8gY2hlY2sgaWYgdG9rZW5zIGlzIGZhbGxpbmcgaW4gdGltZXJhbmdlCgkJCXZhbGlkVGltZXN0YW1wID0gdHJ1ZTsKCgkJCS8vIGNoZWNrIGlmIHRva2VuIGFtb3VudCBpcyBmYWxsaW5nIGluIGxpbWl0CgkJCXZhbGlkQW1vdW50ID0gcGhhc2UzTWF4VG9rZW5Gb3JTYWxlLnN1Yih0b3RhbFRva2VuU29sZCkgPj0gYW1vdW50OwoJCX0KCgkJLy8gY2hlY2sgaWYgdmFsdWUgb2YgdGhlIGV0aGVyIGlzIHZhbGlkCgkJYm9vbCB2YWxpZFZhbHVlID0gdmFsdWUgIT0gMDsKCgkJLy8gY2hlY2sgaWYgdGhlIHRva2VucyBhdmFpbGFibGUgaW4gY29udHJhY3QgZm9yIHNhbGUKCQlib29sIHZhbGlkVG9rZW4gPSBhbW91bnQgIT0gMDsKCgkJLy8gdmFsaWRhdGUgaWYgYWxsIGNvbmRpdGlvbnMgYXJlIG1ldAoJCXJldHVybiB2YWxpZFRpbWVzdGFtcCAmJiB2YWxpZEFtb3VudCAmJiB2YWxpZFZhbHVlICYmIHZhbGlkVG9rZW4gJiYgIWlzQ2xvc2UgJiYgIWlzUGF1c2VkOwoJfQoKCWZ1bmN0aW9uIGNhbGN1bGF0ZSh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CgkJdWludDI1NiBhbW91bnQgPSAwOwoJCQkKCQkvLyBjaGVjayBpZiBwaGFzZSAxIGlzIHJ1bm5pbmcJCgkJaWYocGhhc2UxU3RhcnRpbmdBdCA8PSBnZXRCbG9ja1RpbWUoKSAmJiBnZXRCbG9ja1RpbWUoKSA8PSBwaGFzZTFFbmRpbmdBdCkgewoJCQkvLyBjYWxjdWxhdGUgdGhlIGFtb3VudCBvZiB0b2tlbnMKCQkJYW1vdW50ID0gdmFsdWUubXVsKDFFMTgpLmRpdihwaGFzZTFUb2tlblByaWNlSW5FdGgpOwoJCX0KCgkJLy8gY2hlY2sgaWYgcGhhc2UgMiBpcyBydW5uaW5nCQoJCWlmKHBoYXNlMlN0YXJ0aW5nQXQgPD0gZ2V0QmxvY2tUaW1lKCkgJiYgZ2V0QmxvY2tUaW1lKCkgPD0gcGhhc2UyRW5kaW5nQXQpIHsKCQkJLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgdG9rZW5zCgkJCWFtb3VudCA9IHZhbHVlLm11bCgxRTE4KS5kaXYocGhhc2UyVG9rZW5QcmljZUluRXRoKTsKCQl9CgoJCS8vIGNoZWNrIGlmIHBoYXNlIDMgaXMgcnVubmluZwkKCQlpZihwaGFzZTNTdGFydGluZ0F0IDw9IGdldEJsb2NrVGltZSgpICYmIGdldEJsb2NrVGltZSgpIDw9IHBoYXNlM0VuZGluZ0F0KSB7CgkJCS8vIGNhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIHRva2VucwoJCQlhbW91bnQgPSB2YWx1ZS5tdWwoMUUxOCkuZGl2KHBoYXNlM1Rva2VuUHJpY2VJbkV0aCk7CgkJfQoKCQlyZXR1cm4gYW1vdW50OwoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSh1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewoKCQkvLyB1cGRhdGUgdGhlIHN0YXRlIHRvIGxvZyB0aGUgc29sZCB0b2tlbnMgYW5kIHJhaXNlZCBldGhlcnMuCgkJdG90YWxUb2tlblNvbGQgPSB0b3RhbFRva2VuU29sZC5hZGQoYW1vdW50KTsKCQl0b3RhbEV0aGVyUmFpc2VkID0gdG90YWxFdGhlclJhaXNlZC5hZGQodmFsdWUpOwoJCWV0aGVyUmFpc2VkUGVyV2FsbGV0W21zZy5zZW5kZXJdID0gZXRoZXJSYWlzZWRQZXJXYWxsZXRbbXNnLnNlbmRlcl0uYWRkKHZhbHVlKTsKCgkJLy8gY2hlY2sgaWYgcGhhc2UgMSBpcyBydW5uaW5nCQoJCWlmKHBoYXNlMVN0YXJ0aW5nQXQgPD0gZ2V0QmxvY2tUaW1lKCkgJiYgZ2V0QmxvY2tUaW1lKCkgPD0gcGhhc2UxRW5kaW5nQXQpIHsKCQkJLy8gYWRkIHRva2VucyB0byBwaGFzZTEgY291bnRzCgkJCXBoYXNlMVRva2VuU29sZCA9IHBoYXNlMVRva2VuU29sZC5hZGQoYW1vdW50KTsKCQl9CgoJCS8vIGNoZWNrIGlmIHBoYXNlIDIgaXMgcnVubmluZwkKCQlpZihwaGFzZTJTdGFydGluZ0F0IDw9IGdldEJsb2NrVGltZSgpICYmIGdldEJsb2NrVGltZSgpIDw9IHBoYXNlMkVuZGluZ0F0KSB7CgkJCS8vIGFkZCB0b2tlbnMgdG8gcGhhc2UyIGNvdW50cwoJCQlwaGFzZTJUb2tlblNvbGQgPSBwaGFzZTJUb2tlblNvbGQuYWRkKGFtb3VudCk7CgkJfQoKCQkvLyBjaGVjayBpZiBwaGFzZSAzIGlzIHJ1bm5pbmcJCgkJaWYocGhhc2UzU3RhcnRpbmdBdCA8PSBnZXRCbG9ja1RpbWUoKSAmJiBnZXRCbG9ja1RpbWUoKSA8PSBwaGFzZTNFbmRpbmdBdCkgewoJCQkvLyBhZGQgdG9rZW5zIHRvIHBoYXNlMyBjb3VudHMKCQkJcGhhc2UzVG9rZW5Tb2xkID0gcGhhc2UzVG9rZW5Tb2xkLmFkZChhbW91bnQpOwoJCX0KCX0KCgkvKioKCSAqIEBkZXYgRGVmYXVsdCBmYWxsYmFjayBtZXRob2Qgd2hpY2ggd2lsbCBiZSBjYWxsZWQgd2hlbiBhbnkgZXRoZXJzIGFyZSBzZW50IHRvIGNvbnRyYWN0CgkgKi8KCWZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewoJCWJ1eShtc2cuc2VuZGVyKTsKCX0KCgkvKioKCSAqIEBkZXYgRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgZWl0aGVyIGV4dGVybmFsbHkgb3IgYnkgZGVmYXVsdCBwYXlhYmxlIG1ldGhvZAoJICoKCSAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gc2hvdWxkIHJlY2VpdmUgdG9rZW5zCgkgKi8KCWZ1bmN0aW9uIGJ1eShhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CgkJcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKCgkJLy8gYW1vdW50IG9mIGV0aGVycyBzZW50CgkJdWludDI1NiB2YWx1ZSA9IG1zZy52YWx1ZTsKCgkJLy8gdGhyb3cgZXJyb3IgaWYgbm90IGVub3VnaCBldGhlcnMgc2VudAoJCXJlcXVpcmUodmFsdWUgPj0gbWluRXRoUGVyVHJhbnNhY3Rpb24pOwoKCQkvLyByZWZ1bmQgdGhlIGV4dHJhIGV0aGVycyBpZiBzZW50IG1vcmUgdGhhbiBhbGxvd2VkCgkJaWYodmFsdWUgPiBtYXhFdGhQZXJUcmFuc2FjdGlvbikgewoJCQkvLyBtb3JlIGV0aGVycyBhcmUgc2VudCBzbyByZWZ1bmQgZXh0cmEKCQkJbXNnLnNlbmRlci50cmFuc2Zlcih2YWx1ZS5zdWIobWF4RXRoUGVyVHJhbnNhY3Rpb24pKTsKCQkJdmFsdWUgPSBtYXhFdGhQZXJUcmFuc2FjdGlvbjsKCQl9CgkJCgkJLy8gY2FsY3VsYXRlIHRva2VucwoJCXVpbnQyNTYgdG9rZW5zID0gY2FsY3VsYXRlKHZhbHVlKTsKCgkJLy8gdmFsaWRhdGUgdGhlIHB1cmNoYXNlCgkJcmVxdWlyZSh2YWxpZGF0ZSh2YWx1ZSAsIHRva2VucykpOwoKCQkvLyB1cGRhdGUgY3VycmVudCBzdGF0ZSAKCQl1cGRhdGUodmFsdWUgLCB0b2tlbnMpOwoJCQoJCS8vIHRyYW5zZmVyIHRva2VucyBmcm9tIGNvbnRyYWN0IGJhbGFuY2UgdG8gYmVuZWZpY2lhcnkgYWNjb3VudC4gY2FsbGluZyBFUkMyMjMgbWV0aG9kCgkJYnl0ZXMgbWVtb3J5IGVtcHR5OwoJCXRva2VuLnRyYW5zZmVyKGJlbmVmaWNpYXJ5LCB0b2tlbnMsIGVtcHR5KTsKCQkKCQkvLyBsb2cgZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlCgkJVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgdmFsdWUsIHRva2Vucywgbm93KTsKCX0KCgkvKioKCSogQGRldiB0cmFuc21pdCB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcy4gCgkqIFRoaXMgaXMgb3duZXIgb25seSBtZXRob2QgYW5kIHNob3VsZCBiZSBjYWxsZWQgdXNpbmcgd2ViMy5qcyBpZiBzb21lb25lIGlzIHRyeWluZyB0byBidXkgdG9rZW4gdXNpbmcgYml0Y29pbiBvciBhbnkgb3RoZXIgYWx0Y29pbi4KCSogCgkqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNtaXQgdG8uCgkqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KCSogQHBhcmFtIF9tZXNzYWdlIG1lc3NhZ2UgdG8gbG9nIGFmdGVyIHRyYW5zZmVyLgoJKi8KCWZ1bmN0aW9uIHRyYW5zZmVyTWFudWFsKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgc3RyaW5nIF9tZXNzYWdlKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlyZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCgkJLy8gdHJhbnNmZXIgdG9rZW5zIG1hbnVhbGx5IGZyb20gY29udHJhY3QgYmFsYW5jZQoJCXRva2VuLnRyYW5zZmVyKF90byAsIF92YWx1ZSk7CgkJVHJhbnNmZXJNYW51YWwobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9tZXNzYWdlKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSogQGRldiBzZW5kVG9Hcm93dGhDb250cmFjdCAgCgkqIFRoaXMgd2lsbCBzZW5kIHJlbWFpbmluZyB0b2tlbnMgdG8gZ3Jvd3RoIGNvbnRyYWN0CgkqLwkKCWZ1bmN0aW9uIHNlbmRUb0dyb3d0aENvbnRyYWN0KCkgb25seU93bmVyIHB1YmxpYyB7CgkJcmVxdWlyZShjb250cmFjdFRpbWVvdXQgPD0gZ2V0QmxvY2tUaW1lKCkpOwoKCQkvLyBzZW5kIHJlbWFpbmluZyB0b2tlbnMgdG8gZ3Jvd3RoIGNvbnRyYWN0LgoJCXVpbnQyNTYgdG9rZW5zID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOyAKCQlieXRlcyBtZW1vcnkgZW1wdHk7CgkJdG9rZW4udHJhbnNmZXIoZ3Jvd3RoQ29udHJhY3QsIHRva2VucywgZW1wdHkpOwoJfQoKCS8qKgoJKiBAZGV2IHNlbmRUb1Zlc3RpbmdDb250cmFjdCAgCgkqIFRoaXMgd2lsbCB0cmFuc2ZlciBhbnkgYXZhaWxhYmxlIGV0aGVycyB0byB2ZXN0aW5nIGNvbnRyYWN0cwoJKi8JCglmdW5jdGlvbiBzZW5kVG9WZXN0aW5nQ29udHJhY3QoKSBvbmx5T3duZXIgcHVibGljIHsKCQkvLyBkaXN0cmlidXRlIGZ1bmRzIAoJCWRpc3RyaWJ1dGUoKTsKCX0KCgkvKioKCSogQGRldiB3aXRoZHJhdyBmdW5kcyBhbmQgdG9rZW5zIAoJKiBUaGlzIHdpbGwgc2VuZCByZW1haW5pbmcgdG9rZW4gYmFsYW5jZSB0byBncm93dGggY29udHJhY3QKCSogVGhpcyB3aWxsIGRpc3RyaWJ1dGUgYXZhaWxhYmxlIGZ1bmRzIGFjcm9zcyB0ZWFtIG1lbWJlcnMKCSovCQoJZnVuY3Rpb24gd2l0aGRyYXcoKSBvbmx5T3duZXIgcHVibGljIHsKCQlyZXF1aXJlKGNvbnRyYWN0VGltZW91dCA8PSBnZXRCbG9ja1RpbWUoKSk7CgoJCS8vIHNlbmQgcmVtYWluaW5nIHRva2VucyB0byBncm93dGggY29udHJhY3QuCgkJdWludDI1NiB0b2tlbnMgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7IAoJCWJ5dGVzIG1lbW9yeSBlbXB0eTsKCQl0b2tlbi50cmFuc2Zlcihncm93dGhDb250cmFjdCwgdG9rZW5zLCBlbXB0eSk7CgoJCS8vIGRpc3RyaWJ1dGUgZnVuZHMgCgkJZGlzdHJpYnV0ZSgpOwoJfQoKCS8qKgoJKiBAZGV2IGNsb3NlIGNvbnRyYWN0IAoJKiBUaGlzIHdpbGwgbWFyayBjb250cmFjdCBhcyBjbG9zZWQKCSovCQoJZnVuY3Rpb24gY2xvc2UoKSBvbmx5T3duZXIgcHVibGljIHsKCQkvLyBtYXJrIHRoZSBmbGFnIHRvIGluZGljYXRlIGNsb3N1cmUgb2YgdGhlIGNvbnRyYWN0CgkJaXNDbG9zZSA9IHRydWU7Cgl9CgoJLyoqCgkqIEBkZXYgcGF1c2UgY29udHJhY3QgCgkqIFRoaXMgd2lsbCBtYXJrIGNvbnRyYWN0IGFzIHBhdXNlZAoJKi8JCglmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciBwdWJsaWMgewoJCS8vIG1hcmsgdGhlIGZsYWcgdG8gaW5kaWNhdGUgcGF1c2Ugb2YgdGhlIGNvbnRyYWN0CgkJaXNQYXVzZWQgPSB0cnVlOwoJfQoKCS8qKgoJKiBAZGV2IHJlc3VtZSBjb250cmFjdCAKCSogVGhpcyB3aWxsIG1hcmsgY29udHJhY3QgYXMgcmVzdW1lZAoJKi8JCglmdW5jdGlvbiByZXN1bWUoKSBvbmx5T3duZXIgcHVibGljIHsKCQkvLyBtYXJrIHRoZSBmbGFnIHRvIGluZGljYXRlIHJlc3VtZSBvZiB0aGUgY29udHJhY3QKCQlpc1BhdXNlZCA9IGZhbHNlOwoJfQp9CgovKioKKiBAdGl0bGUgZEhlYWx0aEV0aGVyVmVzdGluZwoqIEBkZXYgVGhpcyBpcyB2ZXN0aW5nIGNvbnRyYWN0IGl0IHJlY2VpdmVzIGZ1bmRzIGFuZCB0aG9zZSBhcmUgdXNlZCB0byByZWxlYXNlIGZ1bmRzIHRvIGZpeGVkIGFkZHJlc3MKKi8KY29udHJhY3QgZEhlYWx0aEV0aGVyVmVzdGluZyBpcyBPd25hYmxlLCBUaW1lc3RhbXBlZCB7Cgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCgkvLyB3YWxsZXQgYWRkcmVzcyB3aGljaCB3aWxsIHJlY2VpdmUgZnVuZHMgb24gcGF5CglhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgoJLy8gdGltZXN0YW1wIHdoZW4gdmVzdGluZyBjb250cmFjdCBzdGFydHMsIHRoaXMgdGltZXN0YW1wIG1hdGNoZXMgd2l0aCBzYWxlIGNvbnRyYWN0Cgl1aW50MjU2IHB1YmxpYyBzdGFydGluZ0F0ID0gMTUxNjkyNDgwMDsgLy8gRnJpZGF5LCAyNiBKYW51YXJ5IDIwMTggMDA6MDA6MDAKCgkvLyB0aW1lc3RhbXAgd2hlbiB2ZXN0aW5nIGVuZHMKCXVpbnQyNTYgcHVibGljIGVuZGluZ0F0ID0gc3RhcnRpbmdBdCArIDU0MCBkYXlzOwoKCS8vIGhvdyBtYW55ICUgb2YgZXRoZXJzIHRvIHZlc3Qgb24gZWFjaCBjYWxsCgl1aW50MjU2IHB1YmxpYyB2ZXN0aW5nQW1vdW50ID0gMjA7CgoJLy8gdGltZXN0YW1wIHdoZW4gdmVzdGluZyBzdGFydHMKCXVpbnQyNTYgcHVibGljIHZlc3RpbmdQZXJpb2RMZW5ndGggPSAzMCBkYXlzOwoKCS8vIHRpbWUgYWZ0ZXIgd2hpY2ggb3duZXIgY2FuIHdpdGhkcmF3IGFsbCBhdmFpbGFibGUgZnVuZHMKCXVpbnQyNTYgcHVibGljIGNvbnRyYWN0VGltZW91dCA9IHN0YXJ0aW5nQXQgKyAyIHllYXJzOwoKCS8vIG1hcHBpbmcgdGhhdCBkZWZpbmVzIHZlc3Rpbmcgc3RydWN0dXJlCglzdHJ1Y3QgVmVzdGluZ1N0cnVjdCB7CgkJdWludDI1NiBwZXJpb2Q7IAoJCWJvb2wgc3RhdHVzOwoJCWFkZHJlc3Mgd2FsbGV0OwoJCXVpbnQyNTYgYW1vdW50OwoJCXVpbnQyNTYgdGltZXN0YW1wOwoJfQoKCS8vIHZlc3RpbmcgdGhhdCB0cmFja3MgdmVzdGluZ3MgZG9uZSBhZ2FpbnN0IHRoZSBwZXJpb2QuCgltYXBwaW5nICh1aW50MjU2ID0+IFZlc3RpbmdTdHJ1Y3QpIHB1YmxpYyB2ZXN0aW5nczsKCgkvLyBFdmVudCB0byBsb2cgd2hlbmV2ZXIgdGhlIHBheW1lbnQgaXMgZG9uZQoJZXZlbnQgUGF5b3V0cyh1aW50MjU2IGluZGV4ZWQgcGVyaW9kLCBib29sIHN0YXR1cywgYWRkcmVzcyB3YWxsZXQsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHRpbWVzdGFtcCk7CgoJLyoqCgkqIEBkZXYgQ29uc3RydWN0b3IgdGhhdCBkb2VzIG5vdGhpbmcgCgkqLwoJZnVuY3Rpb24gZEhlYWx0aEV0aGVyVmVzdGluZyhhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyB7CgkJd2FsbGV0ID0gX3dhbGxldDsKCX0KCgkvKioKCSogQGRldiBkZWZhdWx0IHBheWFibGUgbWV0aG9kIHRvIHJlY2VpdmUgZnVuZHMKCSovCglmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKCQkKCX0KCgkvKioKCSogQGRldiBNZXRob2QgY2FsbGVkIGJ5IG93bmVyIG9mIGNvbnRyYWN0IHRvIHdpdGhkcmF3IGZ1bmRzCgkqLwoJZnVuY3Rpb24gcGF5KHVpbnQyNTYgcGVyY2VudGFnZSkgcHVibGljIHBheWFibGUgewoJCS8vIHJlcXVlc3RlZCBhbW91bnQgc2hvdWxkIGFsd2F5cyBiZSBsZXNzIHRoYW4gdmVzdGluZ0Ftb3VudCB2YXJpYWJsZQoJCXBlcmNlbnRhZ2UgPSBwZXJjZW50YWdlIDw9IHZlc3RpbmdBbW91bnQgPyBwZXJjZW50YWdlIDogdmVzdGluZ0Ftb3VudDsKCgkJLy8gY2FsY3VsYXRlIGFtb3VudCBhbGxvd2VkCgkJdmFyIChwZXJpb2QsIGFtb3VudCkgPSBjYWxjdWxhdGUoZ2V0QmxvY2tUaW1lKCkgLCB0aGlzLmJhbGFuY2UgLCBwZXJjZW50YWdlKTsKCgkJLy8gcGF5bWVudCBzaG91bGQgbm90IGJlIGRvbmUgaWYgcGVyaW9kIGlzIHplcm8KCQlyZXF1aXJlKHBlcmlvZCA+IDApOwoJCS8vIHBheW1lbnQgc2hvdWxkIG5vdCBiZSBkb25lIGFscmVhZHkKCQlyZXF1aXJlKHZlc3RpbmdzW3BlcmlvZF0uc3RhdHVzID09IGZhbHNlKTsKCQkvLyB3YWxsZXQgc2hvdWxkIG5vdCBiZSBzZXQgYWxyZWFkeS4KCQlyZXF1aXJlKHZlc3RpbmdzW3BlcmlvZF0ud2FsbGV0ID09IGFkZHJlc3MoMCkpOwoJCS8vIHRoZXJlIHNob3VsZCBiZSBhbW91bnQgdG8gcGF5CgkJcmVxdWlyZShhbW91bnQgPiAwKTsKCgkJLy8gc2V0IHBlcmlvZCBmb3Igc3RvcmFnZQoJCXZlc3RpbmdzW3BlcmlvZF0ucGVyaW9kID0gcGVyaW9kOwoJCS8vIHNldCBzdGF0dXMgdG8gYXZvaWQgZG91YmxlIHBheW1lbnQKCQl2ZXN0aW5nc1twZXJpb2RdLnN0YXR1cyA9IHRydWU7CgkJLy8gc2V0IHdhbGxldCB0byB0cmFjayB3aGVyZSBwYXltZW50IHdhcyBzZW50CgkJdmVzdGluZ3NbcGVyaW9kXS53YWxsZXQgPSB3YWxsZXQ7CgkJLy8gc2V0IHdhbGxldCB0byB0cmFjayBob3cgbXVjaCBhbW91bnQgc2VudAoJCXZlc3RpbmdzW3BlcmlvZF0uYW1vdW50ID0gYW1vdW50OwoJCS8vIHNldCB0aW1lc3RhbXAgb2YgcGF5bWVudAoJCXZlc3RpbmdzW3BlcmlvZF0udGltZXN0YW1wID0gZ2V0QmxvY2tUaW1lKCk7CgoJCS8vIHRyYW5zZmVyIGFtb3VudCB0byB3YWxsZXQgYWRkcmVzcwoJCXdhbGxldC50cmFuc2ZlcihhbW91bnQpOwoKCQkvLyBsb2cgZXZlbnQKCQlQYXlvdXRzKHBlcmlvZCwgdmVzdGluZ3NbcGVyaW9kXS5zdGF0dXMsIHZlc3RpbmdzW3BlcmlvZF0ud2FsbGV0LCB2ZXN0aW5nc1twZXJpb2RdLmFtb3VudCwgdmVzdGluZ3NbcGVyaW9kXS50aW1lc3RhbXApOwoJfQoKCS8qKgoJKiBAZGV2IEludGVybmFsIG1ldGhvZCBjYWxsZWQgdG8gY3VycmVudCB2ZXN0aW5nIHBlcmlvZAoJKi8KCWZ1bmN0aW9uIGdldFBlcmlvZCh1aW50MjU2IHRpbWVzdGFtcCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCWZvcih1aW50MjU2IGkgPSAxIDsgaSA8PSAxOCA7IGkgKyspIHsKCQkJLy8gY2FsY3VsYXRlIHRpbWVzdGFtcCByYW5nZQoJCQl1aW50MjU2IHN0YXJ0VGltZSA9IHN0YXJ0aW5nQXQgKyAodmVzdGluZ1BlcmlvZExlbmd0aCAqIChpIC0gMSkpOwoJCQl1aW50MjU2IGVuZFRpbWUgPSBzdGFydGluZ0F0ICsgKHZlc3RpbmdQZXJpb2RMZW5ndGggKiAoaSkpOwoKCQkJaWYoc3RhcnRUaW1lIDw9IHRpbWVzdGFtcCAmJiB0aW1lc3RhbXAgPCBlbmRUaW1lKSB7CgkJCQlyZXR1cm4gaTsKCQkJfQoJCX0KCgkJLy8gY2FsY3VsYXRlIHRpbWVzdGFtcCBvZiBsYXN0IHBlcmlvZAoJCXVpbnQyNTYgbGFzdEVuZFRpbWUgPSBzdGFydGluZ0F0ICsgKHZlc3RpbmdQZXJpb2RMZW5ndGggKiAoMTgpKTsKCQlpZihsYXN0RW5kVGltZSA8PSB0aW1lc3RhbXApIHsKCQkJcmV0dXJuIDE4OwoJCX0KCgkJcmV0dXJuIDA7Cgl9CgoJLyoqCgkqIEBkZXYgSW50ZXJuYWwgbWV0aG9kIGNhbGxlZCB0byBjdXJyZW50IHZlc3RpbmcgcGVyaW9kIHJhbmdlCgkqLwoJZnVuY3Rpb24gZ2V0UGVyaW9kUmFuZ2UodWludDI1NiB0aW1lc3RhbXApIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgLCB1aW50MjU2KSB7CgkJZm9yKHVpbnQyNTYgaSA9IDEgOyBpIDw9IDE4IDsgaSArKykgewoJCQkvLyBjYWxjdWxhdGUgdGltZXN0YW1wIHJhbmdlCgkJCXVpbnQyNTYgc3RhcnRUaW1lID0gc3RhcnRpbmdBdCArICh2ZXN0aW5nUGVyaW9kTGVuZ3RoICogKGkgLSAxKSk7CgkJCXVpbnQyNTYgZW5kVGltZSA9IHN0YXJ0aW5nQXQgKyAodmVzdGluZ1BlcmlvZExlbmd0aCAqIChpKSk7CgoJCQlpZihzdGFydFRpbWUgPD0gdGltZXN0YW1wICYmIHRpbWVzdGFtcCA8IGVuZFRpbWUpIHsKCQkJCXJldHVybiAoc3RhcnRUaW1lICwgZW5kVGltZSk7CgkJCX0KCQl9CgoJCS8vIGNhbGN1bGF0ZSB0aW1lc3RhbXAgb2YgbGFzdCBwZXJpb2QKCQl1aW50MjU2IGxhc3RTdGFydFRpbWUgPSBzdGFydGluZ0F0ICsgKHZlc3RpbmdQZXJpb2RMZW5ndGggKiAoMTcpKTsKCQl1aW50MjU2IGxhc3RFbmRUaW1lID0gc3RhcnRpbmdBdCArICh2ZXN0aW5nUGVyaW9kTGVuZ3RoICogKDE4KSk7CgkJaWYobGFzdEVuZFRpbWUgPD0gdGltZXN0YW1wKSB7CgkJCXJldHVybiAobGFzdFN0YXJ0VGltZSAsIGxhc3RFbmRUaW1lKTsKCQl9CgoJCXJldHVybiAoMCAsIDApOwoJfQoKCS8qKgoJKiBAZGV2IEludGVybmFsIG1ldGhvZCBjYWxsZWQgdG8gY2FsY3VsYXRlIHdpdGhkcmF3YWwgYW1vdW50CgkqLwoJZnVuY3Rpb24gY2FsY3VsYXRlKHVpbnQyNTYgdGltZXN0YW1wLCB1aW50MjU2IGJhbGFuY2UgLCB1aW50MjU2IHBlcmNlbnRhZ2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgLCB1aW50MjU2KSB7CgkJLy8gZmluZCBvdXQgY3VycmVudCB2ZXN0aW5nIHBlcmlvZAoJCXVpbnQyNTYgcGVyaW9kID0gZ2V0UGVyaW9kKHRpbWVzdGFtcCk7CgkJaWYocGVyaW9kID09IDApIHsKCQkJLy8gaWYgcGVyaW9kIGlzIG5vdCBmb3VuZCB0aGVuIHJldHVybiB6ZXJvOwoJCQlyZXR1cm4gKDAgLCAwKTsKCQl9CgoJCS8vIGdldCB2ZXN0aW5nIG9iamVjdCBmb3IgcGVyaW9kCgkJVmVzdGluZ1N0cnVjdCBtZW1vcnkgdmVzdGluZyA9IHZlc3RpbmdzW3BlcmlvZF07CQoJCQoJCS8vIGNoZWNrIGlmIHBheW1lbnQgaXMgYWxyZWFkeSBkb25lCgkJaWYodmVzdGluZy5zdGF0dXMgPT0gZmFsc2UpIHsKCQkJLy8gcGF5bWVudCBpcyBub3QgZG9uZSB5ZXQKCQkJdWludDI1NiBhbW91bnQ7CgoJCQkvLyBpZiBpdCBpcyBsYXN0IG1vbnRoIHRoZW4gc2VuZCBhbGwgcmVtYWluaW5nIGJhbGFuY2UKCQkJaWYocGVyaW9kID09IDE4KSB7CgkJCQkvLyBzZW5kIGFsbAoJCQkJYW1vdW50ID0gYmFsYW5jZTsKCQkJfSBlbHNlIHsKCQkJCS8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGFuZCBzZW5kCgkJCQlhbW91bnQgPSBiYWxhbmNlLm11bChwZXJjZW50YWdlKS5kaXYoMTAwKTsKCQkJfQoJCQkKCQkJcmV0dXJuIChwZXJpb2QsIGFtb3VudCk7CgkJfSBlbHNlIHsKCQkJLy8gcGF5bWVudCBpcyBhbHJlYWR5IGRvbmUgCgkJCXJldHVybiAocGVyaW9kLCAwKTsKCQl9CQkKCX0KCgkvKioKCSogQGRldiBNZXRob2QgY2FsbGVkIGJ5IG93bmVyIHRvIGNoYW5nZSB0aGUgd2FsbGV0IGFkZHJlc3MKCSovCglmdW5jdGlvbiBzZXRXYWxsZXQoYWRkcmVzcyBfd2FsbGV0KSBvbmx5T3duZXIgcHVibGljIHsKCQl3YWxsZXQgPSBfd2FsbGV0OwoJfQoKCS8qKgoJKiBAZGV2IE1ldGhvZCBjYWxsZWQgYnkgb3duZXIgb2YgY29udHJhY3QgdG8gd2l0aGRyYXcgZnVuZHMgYWZ0ZXIgdGltZW91dCBoYXMgcmVhY2hlZAoJKi8KCWZ1bmN0aW9uIHdpdGhkcmF3KCkgb25seU93bmVyIHB1YmxpYyBwYXlhYmxlIHsKCQlyZXF1aXJlKGNvbnRyYWN0VGltZW91dCA8PSBnZXRCbG9ja1RpbWUoKSk7CgkJb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCX0JCn0KCgovKioKKiBAdGl0bGUgZEhlYWx0aFRva2VuVmVzdGluZwoqIEBkZXYgVGhpcyBpcyB2ZXN0aW5nIGNvbnRyYWN0IGl0IHJlY2VpdmVzIHRva2VucyBhbmQgdGhvc2UgYXJlIHVzZWQgdG8gcmVsZWFzZSB0b2tlbnMgdG8gZml4ZWQgYWRkcmVzcwoqLwpjb250cmFjdCBkSGVhbHRoVG9rZW5WZXN0aW5nIGlzIE93bmFibGUsIFRpbWVzdGFtcGVkIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCS8vIFRoZSB0b2tlbiBiZWluZyBzb2xkLCB0aGlzIGhvbGRzIHJlZmVyZW5jZSB0byBtYWluIHRva2VuIGNvbnRyYWN0CglkSGVhbHRoVG9rZW4gcHVibGljIHRva2VuOwoKCS8vIHdhbGxldCBhZGRyZXNzIHdoaWNoIHdpbGwgcmVjZWl2ZSB0b2tlbnMgb24gcGF5CglhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgoJLy8gYW1vdW50IG9mIHRva2VuIHRvIGJlIGhvbGQKCXVpbnQyNTYgcHVibGljIG1heFRva2VuRm9ySG9sZDsKCgkvLyB0aW1lc3RhbXAgd2hlbiB2ZXN0aW5nIGNvbnRyYWN0IHN0YXJ0cywgdGhpcyB0aW1lc3RhbXAgbWF0Y2hlcyB3aXRoIHNhbGUgY29udHJhY3QKCXVpbnQyNTYgcHVibGljIHN0YXJ0aW5nQXQgPSAxNTIyMjgxNjAwOyAvLyBUaHVyc2RheSwgMjkgTWFyY2ggMjAxOCAwMDowMDowMAoKCS8vIHRpbWVzdGFtcCB3aGVuIHZlc3RpbmcgZW5kcwoJdWludDI1NiBwdWJsaWMgZW5kaW5nQXQgPSBzdGFydGluZ0F0ICsgNTQwIGRheXM7CgoJLy8gaG93IG1hbnkgJSBvZiBldGhlcnMgdG8gdmVzdCBvbiBlYWNoIGNhbGwKCXVpbnQyNTYgcHVibGljIHZlc3RpbmdBbW91bnQgPSAyMDsKCgkvLyB0aW1lc3RhbXAgd2hlbiB2ZXN0aW5nIHN0YXJ0cwoJdWludDI1NiBwdWJsaWMgdmVzdGluZ1BlcmlvZExlbmd0aCA9IDMwIGRheXM7CgoJLy8gdGltZSBhZnRlciB3aGljaCBvd25lciBjYW4gd2l0aGRyYXcgYWxsIGF2YWlsYWJsZSBmdW5kcwoJdWludDI1NiBwdWJsaWMgY29udHJhY3RUaW1lb3V0ID0gc3RhcnRpbmdBdCArIDIgeWVhcnM7CgoJLy8gbWFwcGluZyB0aGF0IGRlZmluZXMgdmVzdGluZyBzdHJ1Y3R1cmUKCXN0cnVjdCBWZXN0aW5nU3RydWN0IHsKCQl1aW50MjU2IHBlcmlvZDsgCgkJYm9vbCBzdGF0dXM7CgkJYWRkcmVzcyB3YWxsZXQ7CgkJdWludDI1NiBhbW91bnQ7CgkJdWludDI1NiB0aW1lc3RhbXA7Cgl9CgoJLy8gdmVzdGluZyB0aGF0IHRyYWNrcyB2ZXN0aW5ncyBkb25lIGFnYWluc3QgdGhlIHBlcmlvZC4KCW1hcHBpbmcgKHVpbnQyNTYgPT4gVmVzdGluZ1N0cnVjdCkgcHVibGljIHZlc3RpbmdzOwoKCS8vIEV2ZW50IHRvIGxvZyB3aGVuZXZlciB0aGUgcGF5bWVudCBpcyBkb25lCglldmVudCBQYXlvdXRzKHVpbnQyNTYgaW5kZXhlZCBwZXJpb2QsIGJvb2wgc3RhdHVzLCBhZGRyZXNzIHdhbGxldCwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgdGltZXN0YW1wKTsKCgkvKioKCSogQGRldiBDb25zdHJ1Y3RvciB0aGF0IGluaXRpYWxpemVzIHRva2VuIGNvbnRyYWN0IHdpdGggdG9rZW4gYWRkcmVzcyBpbiBwYXJhbWV0ZXIKCSovCglmdW5jdGlvbiBkSGVhbHRoVG9rZW5WZXN0aW5nKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF93YWxsZXQsIHVpbnQyNTYgX21heFRva2VuRm9ySG9sZCwgdWludDI1NiBfc3RhcnRpbmdBdCkgcHVibGljIHsKCQkvLyBzZXQgdG9rZW4KCQl0b2tlbiA9IGRIZWFsdGhUb2tlbihfdG9rZW4pOwoKCQkvLyBzZXQgd2FsbGV0IGFkZHJlc3MKCQl3YWxsZXQgPSBfd2FsbGV0OwoKCQkvLyBzZXQgcGFyYW1ldGVyIHNwZWNpZmljIHRvIGNvbnRyYWN0CgkJbWF4VG9rZW5Gb3JIb2xkID0gX21heFRva2VuRm9ySG9sZDsJCgkJCgkJLy8gc2V0dXAgdGltZXN0YW1wCgkJc3RhcnRpbmdBdCA9IF9zdGFydGluZ0F0OwoJCWVuZGluZ0F0ID0gc3RhcnRpbmdBdCArIDU0MCBkYXlzOwoJfQoKCS8qKgoJKiBAZGV2IGRlZmF1bHQgcGF5YWJsZSBtZXRob2QgdG8gcmVjZWl2ZSBmdW5kcwoJKi8KCWZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewoJCQoJfQoKCS8qKgoJKiBAZGV2IE1ldGhvZCBjYWxsZWQgYnkgb3duZXIgb2YgY29udHJhY3QgdG8gd2l0aGRyYXcgZnVuZHMKCSovCglmdW5jdGlvbiBwYXkodWludDI1NiBwZXJjZW50YWdlKSBwdWJsaWMgewoJCS8vIHJlcXVlc3RlZCBhbW91bnQgc2hvdWxkIGFsd2F5cyBiZSBsZXNzIHRoYW4gdmVzdGluZ0Ftb3VudCB2YXJpYWJsZQoJCXBlcmNlbnRhZ2UgPSBwZXJjZW50YWdlIDw9IHZlc3RpbmdBbW91bnQgPyBwZXJjZW50YWdlIDogdmVzdGluZ0Ftb3VudDsKCgkJLy8gZ2V0IGN1cnJlbnQgdG9rZW4gYmFsYW5jZQoJCXVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsgCgkJCgkJLy8gY2FsY3VsYXRlIGFtb3VudCBhbGxvd2VkCgkJdmFyIChwZXJpb2QsIGFtb3VudCkgPSBjYWxjdWxhdGUoZ2V0QmxvY2tUaW1lKCkgLCBiYWxhbmNlICwgcGVyY2VudGFnZSk7CgoJCS8vIHBheW1lbnQgc2hvdWxkIG5vdCBiZSBkb25lIGlmIHBlcmlvZCBpcyB6ZXJvCgkJcmVxdWlyZShwZXJpb2QgPiAwKTsKCQkvLyBwYXltZW50IHNob3VsZCBub3QgYmUgZG9uZSBhbHJlYWR5CgkJcmVxdWlyZSh2ZXN0aW5nc1twZXJpb2RdLnN0YXR1cyA9PSBmYWxzZSk7CgkJLy8gd2FsbGV0IHNob3VsZCBub3QgYmUgc2V0IGFscmVhZHkuCgkJcmVxdWlyZSh2ZXN0aW5nc1twZXJpb2RdLndhbGxldCA9PSBhZGRyZXNzKDApKTsKCQkvLyB0aGVyZSBzaG91bGQgYmUgYW1vdW50IHRvIHBheQoJCXJlcXVpcmUoYW1vdW50ID4gMCk7CgoJCS8vIHNldCBwZXJpb2QgZm9yIHN0b3JhZ2UKCQl2ZXN0aW5nc1twZXJpb2RdLnBlcmlvZCA9IHBlcmlvZDsKCQkvLyBzZXQgc3RhdHVzIHRvIGF2b2lkIGRvdWJsZSBwYXltZW50CgkJdmVzdGluZ3NbcGVyaW9kXS5zdGF0dXMgPSB0cnVlOwoJCS8vIHNldCB3YWxsZXQgdG8gdHJhY2sgd2hlcmUgcGF5bWVudCB3YXMgc2VudAoJCXZlc3RpbmdzW3BlcmlvZF0ud2FsbGV0ID0gd2FsbGV0OwoJCS8vIHNldCB3YWxsZXQgdG8gdHJhY2sgaG93IG11Y2ggYW1vdW50IHNlbnQKCQl2ZXN0aW5nc1twZXJpb2RdLmFtb3VudCA9IGFtb3VudDsKCQkvLyBzZXQgdGltZXN0YW1wIG9mIHBheW1lbnQKCQl2ZXN0aW5nc1twZXJpb2RdLnRpbWVzdGFtcCA9IGdldEJsb2NrVGltZSgpOwoKCQkvLyB0cmFuc2ZlciBhbW91bnQgdG8gd2FsbGV0IGFkZHJlc3MKCQlieXRlcyBtZW1vcnkgZW1wdHk7CgkJdG9rZW4udHJhbnNmZXIod2FsbGV0LCBhbW91bnQsIGVtcHR5KTsKCgkJLy8gbG9nIGV2ZW50CgkJUGF5b3V0cyhwZXJpb2QsIHZlc3RpbmdzW3BlcmlvZF0uc3RhdHVzLCB2ZXN0aW5nc1twZXJpb2RdLndhbGxldCwgdmVzdGluZ3NbcGVyaW9kXS5hbW91bnQsIHZlc3RpbmdzW3BlcmlvZF0udGltZXN0YW1wKTsKCX0KCgkvKioKCSogQGRldiBJbnRlcm5hbCBtZXRob2QgY2FsbGVkIHRvIGN1cnJlbnQgdmVzdGluZyBwZXJpb2QKCSovCglmdW5jdGlvbiBnZXRQZXJpb2QodWludDI1NiB0aW1lc3RhbXApIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKCQlmb3IodWludDI1NiBpID0gMSA7IGkgPD0gMTggOyBpICsrKSB7CgkJCS8vIGNhbGN1bGF0ZSB0aW1lc3RhbXAgcmFuZ2UKCQkJdWludDI1NiBzdGFydFRpbWUgPSBzdGFydGluZ0F0ICsgKHZlc3RpbmdQZXJpb2RMZW5ndGggKiAoaSAtIDEpKTsKCQkJdWludDI1NiBlbmRUaW1lID0gc3RhcnRpbmdBdCArICh2ZXN0aW5nUGVyaW9kTGVuZ3RoICogKGkpKTsKCgkJCWlmKHN0YXJ0VGltZSA8PSB0aW1lc3RhbXAgJiYgdGltZXN0YW1wIDwgZW5kVGltZSkgewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgoJCS8vIGNhbGN1bGF0ZSB0aW1lc3RhbXAgb2YgbGFzdCBwZXJpb2QKCQl1aW50MjU2IGxhc3RFbmRUaW1lID0gc3RhcnRpbmdBdCArICh2ZXN0aW5nUGVyaW9kTGVuZ3RoICogKDE4KSk7CgkJaWYobGFzdEVuZFRpbWUgPD0gdGltZXN0YW1wKSB7CgkJCXJldHVybiAxODsKCQl9CgoJCXJldHVybiAwOwoJfQoKCS8qKgoJKiBAZGV2IEludGVybmFsIG1ldGhvZCBjYWxsZWQgdG8gY3VycmVudCB2ZXN0aW5nIHBlcmlvZCByYW5nZQoJKi8KCWZ1bmN0aW9uIGdldFBlcmlvZFJhbmdlKHVpbnQyNTYgdGltZXN0YW1wKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2ICwgdWludDI1NikgewoJCWZvcih1aW50MjU2IGkgPSAxIDsgaSA8PSAxOCA7IGkgKyspIHsKCQkJLy8gY2FsY3VsYXRlIHRpbWVzdGFtcCByYW5nZQoJCQl1aW50MjU2IHN0YXJ0VGltZSA9IHN0YXJ0aW5nQXQgKyAodmVzdGluZ1BlcmlvZExlbmd0aCAqIChpIC0gMSkpOwoJCQl1aW50MjU2IGVuZFRpbWUgPSBzdGFydGluZ0F0ICsgKHZlc3RpbmdQZXJpb2RMZW5ndGggKiAoaSkpOwoKCQkJaWYoc3RhcnRUaW1lIDw9IHRpbWVzdGFtcCAmJiB0aW1lc3RhbXAgPCBlbmRUaW1lKSB7CgkJCQlyZXR1cm4gKHN0YXJ0VGltZSAsIGVuZFRpbWUpOwoJCQl9CgkJfQoKCQkvLyBjYWxjdWxhdGUgdGltZXN0YW1wIG9mIGxhc3QgcGVyaW9kCgkJdWludDI1NiBsYXN0U3RhcnRUaW1lID0gc3RhcnRpbmdBdCArICh2ZXN0aW5nUGVyaW9kTGVuZ3RoICogKDE3KSk7CgkJdWludDI1NiBsYXN0RW5kVGltZSA9IHN0YXJ0aW5nQXQgKyAodmVzdGluZ1BlcmlvZExlbmd0aCAqICgxOCkpOwoJCWlmKGxhc3RFbmRUaW1lIDw9IHRpbWVzdGFtcCkgewoJCQlyZXR1cm4gKGxhc3RTdGFydFRpbWUgLCBsYXN0RW5kVGltZSk7CgkJfQoKCQlyZXR1cm4gKDAgLCAwKTsKCX0KCgkvKioKCSogQGRldiBJbnRlcm5hbCBtZXRob2QgY2FsbGVkIHRvIGNhbGN1bGF0ZSB3aXRoZHJhd2FsIGFtb3VudAoJKi8KCWZ1bmN0aW9uIGNhbGN1bGF0ZSh1aW50MjU2IHRpbWVzdGFtcCwgdWludDI1NiBiYWxhbmNlICwgdWludDI1NiBwZXJjZW50YWdlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2ICwgdWludDI1NikgewoJCS8vIGZpbmQgb3V0IGN1cnJlbnQgdmVzdGluZyBwZXJpb2QKCQl1aW50MjU2IHBlcmlvZCA9IGdldFBlcmlvZCh0aW1lc3RhbXApOwoJCWlmKHBlcmlvZCA9PSAwKSB7CgkJCS8vIGlmIHBlcmlvZCBpcyBub3QgZm91bmQgdGhlbiByZXR1cm4gemVybzsKCQkJcmV0dXJuICgwICwgMCk7CgkJfQoKCQkvLyBnZXQgdmVzdGluZyBvYmplY3QgZm9yIHBlcmlvZAoJCVZlc3RpbmdTdHJ1Y3QgbWVtb3J5IHZlc3RpbmcgPSB2ZXN0aW5nc1twZXJpb2RdOwkKCQkKCQkvLyBjaGVjayBpZiBwYXltZW50IGlzIGFscmVhZHkgZG9uZQoJCWlmKHZlc3Rpbmcuc3RhdHVzID09IGZhbHNlKSB7CgkJCS8vIHBheW1lbnQgaXMgbm90IGRvbmUgeWV0CgkJCXVpbnQyNTYgYW1vdW50OwoKCQkJLy8gaWYgaXQgaXMgbGFzdCBtb250aCB0aGVuIHNlbmQgYWxsIHJlbWFpbmluZyBiYWxhbmNlCgkJCWlmKHBlcmlvZCA9PSAxOCkgewoJCQkJLy8gc2VuZCBhbGwKCQkJCWFtb3VudCA9IGJhbGFuY2U7CgkJCX0gZWxzZSB7CgkJCQkvLyBjYWxjdWxhdGUgcGVyY2VudGFnZSBhbmQgc2VuZAoJCQkJYW1vdW50ID0gYmFsYW5jZS5tdWwocGVyY2VudGFnZSkuZGl2KDEwMCk7CgkJCX0KCQkJCgkJCXJldHVybiAocGVyaW9kLCBhbW91bnQpOwoJCX0gZWxzZSB7CgkJCS8vIHBheW1lbnQgaXMgYWxyZWFkeSBkb25lIAoJCQlyZXR1cm4gKHBlcmlvZCwgMCk7CgkJfQkJCgl9CgoJLyoqCgkqIEBkZXYgTWV0aG9kIGNhbGxlZCBieSBvd25lciB0byBjaGFuZ2UgdGhlIHdhbGxldCBhZGRyZXNzCgkqLwoJZnVuY3Rpb24gc2V0V2FsbGV0KGFkZHJlc3MgX3dhbGxldCkgb25seU93bmVyIHB1YmxpYyB7CgkJd2FsbGV0ID0gX3dhbGxldDsKCX0KCgkvKioKCSogQGRldiBNZXRob2QgY2FsbGVkIGJ5IG93bmVyIG9mIGNvbnRyYWN0IHRvIHdpdGhkcmF3IGZ1bmRzIGFmdGVyIHRpbWVvdXQgaGFzIHJlYWNoZWQKCSovCglmdW5jdGlvbiB3aXRoZHJhdygpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CgkJcmVxdWlyZShjb250cmFjdFRpbWVvdXQgPD0gZ2V0QmxvY2tUaW1lKCkpOwoJCQoJCS8vIHNlbmQgcmVtYWluaW5nIHRva2VucyBiYWNrIHRvIG93bmVyLgoJCXVpbnQyNTYgdG9rZW5zID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOyAKCQlieXRlcyBtZW1vcnkgZW1wdHk7CgkJdG9rZW4udHJhbnNmZXIob3duZXIsIHRva2VucywgZW1wdHkpOwoJfQkKfQ=='.
	

]
