Class {
	#name : #SRT0b2232cf1d4ade3b83092dc231bcf4cbc1b6be49,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0b2232cf1d4ade3b83092dc231bcf4cbc1b6be49 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIENvbnRyb2xsZWQKICogQGRldiBSZXN0cmljdHMgZXhlY3V0aW9uIG9mIG1vZGlmaWVkIGZ1bmN0aW9ucyB0byB0aGUgY29udHJhY3QgY29udHJvbGxlciBhbG9uZQogKi8KY29udHJhY3QgQ29udHJvbGxlZCB7CiAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgZnVuY3Rpb24gQ29udHJvbGxlZCgpIHB1YmxpYyB7CiAgICBjb250cm9sbGVyID0gbXNnLnNlbmRlcjsKICB9CgogIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb250cm9sbGVyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckNvbnRyb2woYWRkcmVzcyBuZXdDb250cm9sbGVyKSBwdWJsaWMgb25seUNvbnRyb2xsZXJ7CiAgICBjb250cm9sbGVyID0gbmV3Q29udHJvbGxlcjsKICB9Cn0gCgoKCgoKLy8vIEB0aXRsZSBNaW5pTWVUb2tlbiBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgdG9rZW4gY29udHJhY3QncyBnb2FsIGlzIHRvIG1ha2UgaXQgZWFzeSBmb3IgYW55b25lIHRvIGNsb25lIHRoaXMKLy8vICB0b2tlbiB1c2luZyB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGF0IGEgZ2l2ZW4gYmxvY2ssIHRoaXMgd2lsbCBhbGxvdyBEQU8ncwovLy8gIGFuZCBEQXBwcyB0byB1cGdyYWRlIHRoZWlyIGZlYXR1cmVzIGluIGEgZGVjZW50cmFsaXplZCBtYW5uZXIgd2l0aG91dAovLy8gIGFmZmVjdGluZyB0aGUgb3JpZ2luYWwgdG9rZW4KLy8vIEBkZXYgSXQgaXMgRVJDMjAgY29tcGxpYW50LCBidXQgc3RpbGwgbmVlZHMgdG8gdW5kZXIgZ28gZnVydGhlciB0ZXN0aW5nLgoKCi8vaW1wb3J0ICIuL1Rva2VuQ29udHJvbGxlci5zb2wiOwoKY29udHJhY3QgQXBwcm92ZUFuZENhbGxGYWxsQmFjayB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBmcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSkgcHVibGljOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsKCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CgogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKCiAgICAvLyBgcGFyZW50U25hcFNob3RCbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRoZSBQYXJlbnQgVG9rZW4gdGhhdCB3YXMKICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOwoKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICAvLyBgYWxsb3dlZGAgdHJhY2tzIGFueSBleHRyYSB0cmFuc2ZlciByaWdodHMgYXMgaW4gYWxsIEVSQzIwIHRva2VucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CgogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIC8vIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIG5ldyBjbG9uZSB0b2tlbnMKICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyB7CiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOwogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGVjaW1hbHMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbAogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsKICAgICAgICBwYXJlbnRTbmFwU2hvdEJsb2NrID0gX3BhcmVudFNuYXBTaG90QmxvY2s7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBFUkMyMCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdAogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIHJlcXVpcmUocGFyZW50U25hcFNob3RCbG9jayA8IGJsb2NrLm51bWJlcik7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIHJlcXVpcmUoKF90byAhPSBhZGRyZXNzKDB4MCkpICYmIChfdG8gIT0gYWRkcmVzcyh0aGlzKSkpOwoKICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsKICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSB0cmFuc2ZlcgogICAgICAgICAgIC8vIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgICAgIC8vIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpOwogICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2VucwogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZkF0KF90bywgYmxvY2subnVtYmVyKTsKICAgICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX3RvXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CgogICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlKChfYW1vdW50ID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgYXBwcm92ZSBmdW5jdGlvbiBjYWxsCiAgICAgICAgLy8gaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgLy8gcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25BcHByb3ZlKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KSk7CiAgICAgICAgLy8gfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc2VuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzCiAgICAvLy8gIGJlaW5nIGFwcHJvdmVkLCBgX3NwZW5kZXJgLiBUaGlzIGFsbG93cyB1c2VycyB0byB1c2UgdGhlaXIgdG9rZW5zIHRvCiAgICAvLy8gIGludGVyYWN0IHdpdGggY29udHJhY3RzIGluIG9uZSBmdW5jdGlvbiBjYWxsIGluc3RlYWQgb2YgdHdvCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGZ1bmN0aW9uIGNhbGwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSk7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIHB1YmxpYyBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZgogICAgICAgIC8vICB0aGlzIHRva2VuCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBIYXMgbm8gcGFyZW50CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYC4KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludCBfYmxvY2tOdW1iZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcHVibGljIHJldHVybnMoYWRkcmVzcykgeyAgICAgICAgICAgIAogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBNaW5pTWVUb2tlbiBjbG9uZVRva2VuID0gdG9rZW5GYWN0b3J5LmNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICAgICAgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIGNsb25lVG9rZW4udHJhbnNmZXJDb250cm9sKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMHgwKSwgX293bmVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgPj0gX2Ftb3VudCk7CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VGcm9tID49IF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgYWRkcmVzcygweDApLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIHZhbHVlcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdAogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZAogICAgZnVuY3Rpb24gZ2V0VmFsdWVBdChDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfYmxvY2sKICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwoKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlCiAgICAvLy8gIGB0b3RhbFN1cHBseUhpc3RvcnlgCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZUF0Tm93KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF92YWx1ZQogICAgKSBpbnRlcm5hbCAgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtMV0uZnJvbUJsb2NrIDwgYmxvY2subnVtYmVyKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2UgbmV3Q2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzWyBjaGVja3BvaW50cy5sZW5ndGgrKyBdOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9ICB1aW50MTI4KGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07CiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSBhZGRyZXNzKDB4MCkpIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgLy8gZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIC8vIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgLy8gcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgLy8gfQoKLy8vLy8vLy8vLwovLyBTYWZldHkgTWV0aG9kcwovLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gYWRkcmVzcygweDApKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLnRyYW5zZmVyQ29udHJvbChtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gbmV3VG9rZW47CiAgICB9Cn0KCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHRoYXQgYXJlIHNhZmUgZm9yIHVpbnQyNTYgYWdhaW5zdCBvdmVyZmxvdyBhbmQgbmVnYXRpdmUgdmFsdWVzCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9ibG9iL21hc3Rlci9jb250cmFjdHMvbWF0aC9TYWZlTWF0aC5zb2wKICovCgoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCgoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgQ29udHJvbGxlZCB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5Q29udHJvbGxlciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5Q29udHJvbGxlciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IENyb3dkU2FsZSBpcyBQYXVzYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgdWludDI1NiBwdWJsaWMgc3RhcnRGdW5kaW5nVGltZSA9IDE1MTc5OTA0NjA7IC8vIEZlYiA3LCAyMDE4IEAgMDhoMDEgVVRDID09IDAwaDAxIFBEVCAgICAgICAgCiAgICB1aW50MjU2IHB1YmxpYyBlbmRGdW5kaW5nVGltZSA9IDE1MjM3NzkyMDA7ICAgLy8gQXByIDE1LCAyMDE4IEAgMDhoMDAgVVRDID09IDA4aDAwIFBEVAogICAgICAgIAogICAgdWludDI1NiBwdWJsaWMgdG90YWxFdGhlckNvbGxlY3RlZDsgICAgICAgICAgIC8vIEluIHdlaQogICAgdWludDI1NiBwdWJsaWMgdG90YWxUb2tlbnNTb2xkOyAgICAgICAgICAgICAgIC8vIEtJU1NFUyB0b2tlbnMgc29sZAogICAgCiAgICB1aW50MjU2IHB1YmxpYyBldGhlclRvVVNEcmF0ZSA9IDgwMDsgICAgICAgICAgLy8gRGVmYXVsdCBleGNoYW5nZSByYXRlIAogICAgCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgdG9rZW5Db250cmFjdDsgICAgICAgICAgICAgLy8gVGhlICB0b2tlbiBmb3IgdGhpcyBDcm93ZFNhbGUKICAgIAogICAgYWRkcmVzcyBwdWJsaWMgZXRoZXJWYXVsdCA9IDB4Njc0NTUyMTY5ZWMxNjgzQWEyNmFhNzQwNjMzN0ZBYzY3QkYzMUVENTsgLy8gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgRXRoZXIgcmVjZWl2ZWQKICAgIGFkZHJlc3MgcHVibGljIHVuc29sZFRva2Vuc1ZhdWx0ID0gMHg1MzE2ZTBBNzAzYTU4NEVDYTJlOTVCNzNCNEU2ZEI4RTk4RTA4OWUwOyAvLyBUaGUgYWRkcmVzcyB3aGVyZSBhbGwgdW5zb2xkIHRva2VucyB3aWxsIGJlIHNlbnQgdG8KIAogICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5WYXVsdDsgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIEtJU1NFUyB0b2tlbnMgZm9yIHNhbGUKICAgIAogICAgLy8gTG9ncyBwdXJjaGFzZXIgYWRkcmVzcyBhbmQgaW52ZXN0bWVudCBhbW91bnQgLSB0byBiZSB1c2VkIHRvIHRyYWNrIHRvcCAxMDAgaW52ZXN0b3JzCiAgICBldmVudCBQdXJjaGFzZShhZGRyZXNzIGludmVzdG9yLCB1aW50MjU2IHdlaVJlY2VpdmVkLCB1aW50MjU2IHRva2Vuc1NvbGQpOwogICAgCiAgICAvLyBDb25zdHJ1Y3RvciAtIHRha2VzIGFkZHJlc3Mgb2YgdG9rZW4gY29udHJhY3QgYXMgcGFyYW1ldGVyCiAgICAvLyBBc3N1bWVzIG1zZy5zZW5kZXIgaXMgYWRkcmVzcyBvZiB0aGUgdG9rZW5WYXVsdCA8PT0+IG1zZy5zZW5kZXIgYWxzbyBkZXBsb3llZCB0b2tlbkNvbnRyYWN0CiAgICBmdW5jdGlvbiBDcm93ZFNhbGUoYWRkcmVzcyBfdG9rZW5BZGRyZXNzKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUgKF90b2tlbkFkZHJlc3MgIT0gYWRkcmVzcygwKSk7ICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgdG9rZW5Db250cmFjdCA9IE1pbmlNZVRva2VuKF90b2tlbkFkZHJlc3MpOyAgICAgCgogICAgICAgIHRva2VuVmF1bHQgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAvLyBGYWxsYmFjayBmdW5jdGlvbiBpbnZva2VzIGludGVybmFsIGRvUGF5bWVudCBtZXRob2QKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHBheWFibGUgewogICAgICAgIGRvUGF5bWVudChtc2cuc2VuZGVyKTsKICAgIH0KICAgIAogICAgLy8gSW50ZXJuYWwgbG9naWMgdGhhdCBwcm9jZXNzZXMgcGF5bWVudHMKICAgIGZ1bmN0aW9uIGRvUGF5bWVudChhZGRyZXNzIF9vd25lcikgaW50ZXJuYWwgewoKICAgICAgICAvLyBGaXJzdCBjaGVjayB0aGF0IHRoZSBDYW1wYWlnbiBpcyBhbGxvd2VkIHRvIHJlY2VpdmUgdGhpcyBkb25hdGlvbgogICAgICAgIHJlcXVpcmUgKChub3cgPj0gc3RhcnRGdW5kaW5nVGltZSkgJiYgKG5vdyA8PSBlbmRGdW5kaW5nVGltZSkgJiYgKG1zZy52YWx1ZSAhPSAwKSk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgdG9rZW5zIHB1cmNoYXNlZCBhbmQgdGhlIGRvbGxhciBhbW91bnQgdGhlcmVvZgogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gY2FsY3VsYXRlVG9rZW5zKG1zZy52YWx1ZSk7CiAgICAgICAgICAgCiAgICAgICAgLy8gVHJhY2sgaG93IG11Y2ggRXRoZXIgdGhlIGNhbXBhaWduIGhhcyBjb2xsZWN0ZWQKICAgICAgICB0b3RhbEV0aGVyQ29sbGVjdGVkID0gdG90YWxFdGhlckNvbGxlY3RlZC5hZGQobXNnLnZhbHVlKTsKICAgICAgICAvLyBUcmFjayBob3cgbWFueSBLSVNTRVMgdG9rZW5zIHRoZSBjYW1wYWlnbiBoYXMgc29sZAogICAgICAgIHRvdGFsVG9rZW5zU29sZCA9IHRvdGFsVG9rZW5zU29sZC5hZGQodG9rZW5zKTsgICAgICAgIAoKICAgICAgICAvLyBTZW5kIHRoZSBldGhlciB0byB0aGUgZXRoZXJWYXVsdAogICAgICAgIHJlcXVpcmUgKGV0aGVyVmF1bHQuc2VuZChtc2cudmFsdWUpKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgdG9rZW5zIGZyb20gdG9rZW5WYXVsdCB0byB0aGUgX293bmVyIGFkZHJlc3MKICAgICAgICAvLyBXaWxsIHRocm93IGlmIHRva2VucyBleGNlZWRzIGJhbGFuY2UgaW4gcmVtYWluaW5nIGluIHRva2VuVmF1bHQKICAgICAgICByZXF1aXJlICh0b2tlbkNvbnRyYWN0LnRyYW5zZmVyRnJvbSh0b2tlblZhdWx0LCBfb3duZXIsIHRva2VucykpOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgdGhlIFB1cmNoYXNlIGV2ZW50IAogICAgICAgIFB1cmNoYXNlKF9vd25lciwgbXNnLnZhbHVlLCB0b2tlbnMpOwogICAgICAgIAogICAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8gSGFuZGxlcyB0aGUgYm9udXMgbG9naWMgJiBjb252ZXJzaW9uIGZyb20gRXRoZXIncyAxOCBkZWNpbWFsIHBsYWNlcyB0byA1IGRlY2ltYWxzIGZvciB0aGUgS0lTU0VTIHRva2VuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbnModWludDI1NiBfd2VpKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKIAogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gX3dlaTsKICAgICAgICB1aW50MjU2IFVTRGFtb3VudCA9ICh3ZWlBbW91bnQubXVsKGV0aGVyVG9VU0RyYXRlKSkuZGl2KDEwKioxNCk7IC8vIHByZXNlcnZlcyA0IGRlY2ltYWwgcGxhY2VzCgogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VBbW91bnQ7IAogICAgICAgIHVpbnQyNTYgd2l0aEJvbnVzOwogCiAgICAgICAgLy8gaWYgcHVyY2hhc2UgbWFkZSBiZXR3ZWVuIDA3ICYgMTQgRmVicnVhcnkgMjAxOAogICAgICAgIGlmKG5vdyA8IDE1MTg1OTUyMDApIHsKICAgICAgICAgICAgcHVyY2hhc2VBbW91bnQgPSBVU0RhbW91bnQ7IC8vIDEgVG9rZW4gPT0gMSBVU0QKICAgICAgICAgICAgLy8gbWluaW11bSBwdXJjaGFzZSBvZiBvbmUgdG9rZW4sIG1heGltdW0gb2YgdGhyZWUgaHVuZHJlZCBhbmQgZmlmdHkgdGhvdXNhbmQKICAgICAgICAgICAgaWYocHVyY2hhc2VBbW91bnQgPCAxMDAwMCB8fCBwdXJjaGFzZUFtb3VudCA+IDM1MDAwMDAwMDApIHsKICAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTkpOyAvLyA5MCUgYm9udXMgZm9yIHRoZSB3aG9sZSB3ZWVrCiAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsKICAgICAgICAgICAgfSAgIAogICAgICAgIH0KIAogICAgICAgIC8vIGlmIHB1cmNoYXNlIG1hZGUgYmV0d2VlbiAxNCAmIDE1IEZlYnJ1YXJ5IDIwMTgKICAgICAgICBlbHNlIGlmKG5vdyA+PSAxNTE4NTk1MjAwICYmIG5vdyA8IDE1MTg2ODE2MDApIHsKICAgICAgICAgICAgcHVyY2hhc2VBbW91bnQgPSBVU0RhbW91bnQ7IC8vIDEgVG9rZW4gPT0gMSBVU0QKICAgICAgICAgICAgLy8gbWluaW11bSBwdXJjaGFzZSBvZiBvbmUgdG9rZW4sIG1heGltdW0gb2YgdGhyZWUgaHVuZHJlZCBhbmQgZmlmdHkgdGhvdXNhbmQKICAgICAgICAgICAgaWYocHVyY2hhc2VBbW91bnQgPCAxMDAwMCB8fCBwdXJjaGFzZUFtb3VudCA+IDM1MDAwMDAwMDApIHsKICAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTgpOyAvLyA4MCUgYm9udXMgZm9yIHRoZSB3aG9sZSBvZiBWYWxlbnRpbmUncyBEYXkKICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOwogICAgICAgICAgICB9ICAgCiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwdXJjaGFzZSBtYWRlIGJldHdlZW4gMTUgRmVicnVhcnkgYW5kIDIxIEZlYnJ1YXJ5CiAgICAgICAgZWxzZSBpZihub3cgPj0gMTUxODY4MTYwMCAmJiBub3cgPCAxNTE5Mjg2NDAwKSB7CiAgICAgICAgICAgIHB1cmNoYXNlQW1vdW50ID0gVVNEYW1vdW50OyAvLyAxIFRva2VuID09IDEgVVNECiAgICAgICAgICAgIC8vIG1pbmltdW0gcHVyY2hhc2Ugb2Ygb25lIHRva2VuLCBtYXhpbXVtIG9mIHRocmVlIGh1bmRyZWQgYW5kIGZpZnR5IHRob3VzYW5kCiAgICAgICAgICAgIGlmKHB1cmNoYXNlQW1vdW50IDwgMTAwMDAgfHwgcHVyY2hhc2VBbW91bnQgPiAzNTAwMDAwMDAwKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfSAgICAgCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYod2VpQW1vdW50ID49IDUwMCBmaW5uZXkgJiYgd2VpQW1vdW50IDwgMSBldGhlcikgewogICAgICAgICAgICAgICAgICAgIHdpdGhCb251cyA9IHB1cmNoYXNlQW1vdW50Lm11bCgxMSk7IC8vIDEwJSBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmKHdlaUFtb3VudCA+PSAxIGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDE2KTsgLy8gNjAlIGJvbnVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTApOyAvLyBubyBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIHB1cmNoYXNlIG1hZGUgYmV0d2VlbiAyMiBGZWJydWFyeSBhbmQgMjggRmVicnVhcnkKICAgICAgICBlbHNlIGlmKG5vdyA+PSAxNTE5Mjg2NDAwICYmIG5vdyA8IDE1MTk4OTEyMDApIHsKICAgICAgICAgICAgcHVyY2hhc2VBbW91bnQgPSBVU0RhbW91bnQ7IC8vIDEgVG9rZW4gPT0gMSBVU0QKICAgICAgICAgICAgLy8gbWluaW11bSBwdXJjaGFzZSBvZiBvbmUgdG9rZW4sIG1heGltdW0gb2YgdGhyZWUgaHVuZHJlZCBhbmQgZmlmdHkgdGhvdXNhbmQKICAgICAgICAgICAgaWYocHVyY2hhc2VBbW91bnQgPCAxMDAwMCB8fCBwdXJjaGFzZUFtb3VudCA+IDM1MDAwMDAwMDApIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYod2VpQW1vdW50ID49IDUwMCBmaW5uZXkgJiYgd2VpQW1vdW50IDwgMSBldGhlcikgewogICAgICAgICAgICAgICAgICAgIHdpdGhCb251cyA9IHB1cmNoYXNlQW1vdW50Lm11bCgxMSk7IC8vIDEwJSBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmKHdlaUFtb3VudCA+PSAxIGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDE1KTsgLy8gNTAlIGJvbnVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTApOyAvLyBubyBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIHB1cmNoYXNlIG1hZGUgYmV0d2VlbiAxIE1hcmNoIGFuZCAxNCBNYXJjaAogICAgICAgIGVsc2UgaWYobm93ID49IDE1MTk4OTEyMDAgJiYgbm93IDwgMTUyMTEwMDgwMCkgewogICAgICAgICAgICBwdXJjaGFzZUFtb3VudCA9IChVU0RhbW91bnQubXVsKDEwKSkuZGl2KDE0KTsgLy8gMSBLSVNTRVMgPSAxLjQgVVNECiAgICAgICAgICAgIGlmKHB1cmNoYXNlQW1vdW50IDwgMTAwMDAgfHwgcHVyY2hhc2VBbW91bnQgPiAzNTAwMDAwMDAwKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKHdlaUFtb3VudCA+PSA1MDAgZmlubmV5ICYmIHdlaUFtb3VudCA8IDEgZXRoZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTEpOyAvLyAxMCUgYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZih3ZWlBbW91bnQgPj0gMSBldGhlciAmJiB3ZWlBbW91bnQgPCA1IGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDEzKTsgLy8gMzAlIGJvbnVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYod2VpQW1vdW50ID49IDUgZXRoZXIgJiYgd2VpQW1vdW50IDwgOCBldGhlcikgewogICAgICAgICAgICAgICAgICAgIHdpdGhCb251cyA9IHB1cmNoYXNlQW1vdW50Lm11bCgxNCk7IC8vIDQwJSBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7CiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsc2UgaWYod2VpQW1vdW50ID49IDggZXRoZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTUpOyAvLyA1MCUgYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDEwKTsgLy8gbm8gYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOwogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9ICAKCiAgICAgICAgLy8gaWYgcHVyY2hhc2UgbWFkZSBiZXR3ZWVuIDE1IE1hcmNoIGFuZCAzMSBNYXJjaAogICAgICAgIGVsc2UgaWYobm93ID49IDE1MjExMDA4MDAgJiYgbm93IDwgMTUyMjU2OTYwMCkgewogICAgICAgICAgICBwdXJjaGFzZUFtb3VudCA9IChVU0RhbW91bnQubXVsKDEwKSkuZGl2KDE5KTsgLy8gMSBLSVNTRVMgPSAxLjkgVVNECiAgICAgICAgICAgIC8vIG1pbmltdW0gcHVyY2hhc2Ugb2Ygb25lIHRva2VuLCBtYXhpbXVtIG9mIHRocmVlIGh1bmRyZWQgYW5kIGZpZnR5IHRob3VzYW5kCiAgICAgICAgICAgIGlmKHB1cmNoYXNlQW1vdW50IDwgMTAwMDAgfHwgcHVyY2hhc2VBbW91bnQgPiAzNTAwMDAwMDAwKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKHdlaUFtb3VudCA+PSA1MDAgZmlubmV5ICYmIHdlaUFtb3VudCA8IDEgZXRoZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTEpOyAvLyAxMCUgYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOwogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIGVsc2UgaWYod2VpQW1vdW50ID49IDEgZXRoZXIgJiYgd2VpQW1vdW50IDwgNSBldGhlcikgewogICAgICAgICAgICAgICAgICAgIHdpdGhCb251cyA9IHB1cmNoYXNlQW1vdW50Lm11bCgxMyk7IC8vIDMwJSBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmKHdlaUFtb3VudCA+PSA1IGV0aGVyICYmIHdlaUFtb3VudCA8IDggZXRoZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTQpOyAvLyA0MCUgYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOyAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlIGlmKHdlaUFtb3VudCA+PSA4IGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDE1KTsgLy8gNTAlIGJvbnVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDEwKTsgLy8gbm8gYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOyAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwdXJjaGFzZSBtYWRlIGJldHdlZW4gMSBBcHJpbCBhbmQgMTQgQXByaWwKICAgICAgICBlbHNlIGlmKG5vdyA+IDE1MjI1Njk2MDAgJiYgbm93IDw9IGVuZEZ1bmRpbmdUaW1lKSB7CiAgICAgICAgICAgIHB1cmNoYXNlQW1vdW50ID0gKFVTRGFtb3VudC5tdWwoMTApKS5kaXYoMjcpOyAvLyAxIEtJU1NFUyA9IDIuNyBVU0QKICAgICAgICAgICAgLy8gbWluaW11bSBwdXJjaGFzZSBvZiBvbmUgdG9rZW4sIG1heGltdW0gb2YgdGhyZWUgaHVuZHJlZCBhbmQgZmlmdHkgdGhvdXNhbmQKICAgICAgICAgICAgaWYocHVyY2hhc2VBbW91bnQgPCAxMDAwMCB8fCBwdXJjaGFzZUFtb3VudCA+IDM1MDAwMDAwMDApIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBpZih3ZWlBbW91bnQgPj0gNTAwIGZpbm5leSAmJiB3ZWlBbW91bnQgPCAxIGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDExKTsgLy8gMTAlIGJvbnVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYod2VpQW1vdW50ID49IDEgZXRoZXIgJiYgd2VpQW1vdW50IDwgNSBldGhlcikgewogICAgICAgICAgICAgICAgICAgIHdpdGhCb251cyA9IHB1cmNoYXNlQW1vdW50Lm11bCgxMyk7IC8vIDMwJSBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7ICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmKHdlaUFtb3VudCA+PSA1IGV0aGVyICYmIHdlaUFtb3VudCA8IDggZXRoZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTQpOyAvLyA0MCUgYm9udXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2l0aEJvbnVzOyAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlIGlmKHdlaUFtb3VudCA+PSA4IGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgd2l0aEJvbnVzID0gcHVyY2hhc2VBbW91bnQubXVsKDE1KTsgLy8gNTAlIGJvbnVzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpdGhCb251czsgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB3aXRoQm9udXMgPSBwdXJjaGFzZUFtb3VudC5tdWwoMTApOyAvLyBubyBib251cwogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aXRoQm9udXM7ICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIE1ldGhvZCB0byBjaGFuZ2UgdGhlIGV0aGVyVmF1bHQgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0VmF1bHQoYWRkcmVzcyBfbmV3VmF1bHRBZGRyZXNzKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgd2hlblBhdXNlZCB7CiAgICAgICAgZXRoZXJWYXVsdCA9IF9uZXdWYXVsdEFkZHJlc3M7CiAgICB9CiAgICAKICAgIC8vIE1ldGhvZCB0byBjaGFuZ2UgdGhlIEV0aGVyIHRvIERvbGxhciBleGNoYW5nZSByYXRlIAogICAgZnVuY3Rpb24gc2V0RXRoVG9VU0RSYXRlKHVpbnQyNTYgX3JhdGUpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB3aGVuUGF1c2VkIHsKICAgICAgICBldGhlclRvVVNEcmF0ZSA9IF9yYXRlOwogICAgfSAgICAKICAgICAgICAKICAgIC8vIFdyYXAgdXAgQ3Jvd2RTYWxlIGFuZCBkaXJlY3QgYW55IGV0aGVyIHN0b3JlZCBpbiB0aGlzIGNvbnRyYWN0IHRvIGV0aGVyVmF1bHQKICAgIGZ1bmN0aW9uIGZpbmFsaXplRnVuZGluZygpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgcmVxdWlyZShub3cgPj0gZW5kRnVuZGluZ1RpbWUpOwogICAgICAgIHVpbnQyNTYgdW5zb2xkVG9rZW5zID0gdG9rZW5Db250cmFjdC5hbGxvd2FuY2UodG9rZW5WYXVsdCwgYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgaWYodW5zb2xkVG9rZW5zID4gMCkgewogICAgICAgICAgICByZXF1aXJlICh0b2tlbkNvbnRyYWN0LnRyYW5zZmVyRnJvbSh0b2tlblZhdWx0LCB1bnNvbGRUb2tlbnNWYXVsdCwgdW5zb2xkVG9rZW5zKSk7CiAgICAgICAgfQogICAgICAgIHNlbGZkZXN0cnVjdChldGhlclZhdWx0KTsKICAgIH0KICAgIAp9'.
	

]
