Class {
	#name : #SRT801aa94f6b13ddf90447827eb905d7591b12ec79,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT801aa94f6b13ddf90447827eb905d7591b12ec79 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuOTsKCmNvbnRyYWN0IFBlZXJCZXQgewogICAgZW51bSBHYW1lU3RhdHVzIHsgT3BlbiwgTG9ja2VkLCBTY29yZWQsIFZlcmlmaWVkIH0KICAgIC8vIEJvb2tUeXBlLk5vbmUgZXhpc3RzIGJlY2F1c2UgcGFyc2luZyBhIGxvZyBpbmRleCBmb3IgYSB2YWx1ZSBvZiAwIAogICAgLy8gcmV0dXJucyBhbGwgdmFsdWVzLiBJdCBzaG91bGQgbm90IGJlIHVzZWQuCiAgICBlbnVtIEJvb2tUeXBlIHsgTm9uZSwgU3ByZWFkLCBNb25leUxpbmUsIE92ZXJVbmRlciB9CiAgICBlbnVtIEJldFN0YXR1cyB7IE9wZW4sIFBhaWQgfQoKICAgIC8vIGluZGV4aW5nIG9uIGEgc3RyaW5nIGNhdXNlcyBpc3N1ZXMgd2l0aCB3ZWIzLCBzbyBjYXRlZ29yeSBoYXMgdG8gYmUgYW4gaW50CiAgICBldmVudCBHYW1lQ3JlYXRlZChieXRlczMyIGluZGV4ZWQgaWQsIGFkZHJlc3MgaW5kZXhlZCBjcmVhdG9yLCBzdHJpbmcgaG9tZSwgCiAgICAgICAgc3RyaW5nIGF3YXksIHVpbnQxNiBpbmRleGVkIGNhdGVnb3J5LCB1aW50NjQgbG9ja3RpbWUpOwogICAgZXZlbnQgQmlkUGxhY2VkKGJ5dGVzMzIgaW5kZXhlZCBnYW1lX2lkLCBCb29rVHlwZSBib29rLCAKICAgICAgICBhZGRyZXNzIGJpZGRlciwgdWludCBhbW91bnQsIGJvb2wgaG9tZSwgaW50MzIgbGluZSk7CiAgICBldmVudCBCZXRQbGFjZWQoYnl0ZXMzMiBpbmRleGVkIGdhbWVfaWQsIEJvb2tUeXBlIGluZGV4ZWQgYm9vaywgCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsIGJvb2wgaG9tZSwgdWludCBhbW91bnQsIGludDMyIGxpbmUpOwogICAgZXZlbnQgR2FtZVNjb3JlZChieXRlczMyIGluZGV4ZWQgZ2FtZV9pZCwgaW50IGhvbWVTY29yZSwgaW50IGF3YXlTY29yZSwgdWludCB0aW1lc3RhbXApOwogICAgZXZlbnQgR2FtZVZlcmlmaWVkKGJ5dGVzMzIgaW5kZXhlZCBnYW1lX2lkKTsKICAgIGV2ZW50IFdpdGhkcmF3YWwoYWRkcmVzcyBpbmRleGVkIHVzZXIsIHVpbnQgYW1vdW50LCB1aW50IHRpbWVzdGFtcCk7CgogICAgc3RydWN0IEJpZCB7CiAgICAgICAgYWRkcmVzcyBiaWRkZXI7CiAgICAgICAgdWludCBhbW91bnQ7IC8qIGluIHdlaSAqLwogICAgICAgIGJvb2wgaG9tZTsgLyogdHJ1ZT1ob21lLCBmYWxzZT1hd2F5ICovCiAgICAgICAgaW50MzIgbGluZTsKICAgIH0KCiAgICBzdHJ1Y3QgQmV0IHsKICAgICAgICBhZGRyZXNzIGhvbWU7CiAgICAgICAgYWRkcmVzcyBhd2F5OwogICAgICAgIHVpbnQgYW1vdW50OyAvKiBpbiB3ZWkgKi8KICAgICAgICBpbnQzMiBsaW5lOwogICAgICAgIEJldFN0YXR1cyBzdGF0dXM7CiAgICB9CgogICAgc3RydWN0IEJvb2sgewogICAgICAgIEJpZFtdIGhvbWVCaWRzOwogICAgICAgIEJpZFtdIGF3YXlCaWRzOwogICAgICAgIEJldFtdIGJldHM7CiAgICB9CgogICAgc3RydWN0IEdhbWVSZXN1bHQgewogICAgICAgIGludCBob21lOwogICAgICAgIGludCBhd2F5OwogICAgICAgIHVpbnQgdGltZXN0YW1wOyAvLyB3aGVuIHRoZSBnYW1lIHdhcyBzY29yZWQKICAgIH0KCiAgICBzdHJ1Y3QgR2FtZSB7CiAgICAgICAgYnl0ZXMzMiBpZDsKICAgICAgICBhZGRyZXNzIGNyZWF0b3I7CiAgICAgICAgc3RyaW5nIGhvbWU7CiAgICAgICAgc3RyaW5nIGF3YXk7CiAgICAgICAgdWludDE2IGNhdGVnb3J5OwogICAgICAgIHVpbnQ2NCBsb2NrdGltZTsKICAgICAgICBHYW1lU3RhdHVzIHN0YXR1czsKICAgICAgICBtYXBwaW5nKHVpbnQgPT4gQm9vaykgYm9va3M7CiAgICAgICAgR2FtZVJlc3VsdCByZXN1bHQ7CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBHYW1lW10gZ2FtZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJhbGFuY2VzOwoKICAgIGZ1bmN0aW9uIFBlZXJCZXQoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCWZ1bmN0aW9uIGNyZWF0ZUdhbWUgKHN0cmluZyBob21lLCBzdHJpbmcgYXdheSwgdWludDE2IGNhdGVnb3J5LCB1aW50NjQgbG9ja3RpbWUpIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzMzIgaWQgPSBnZXRHYW1lSWQobXNnLnNlbmRlciwgaG9tZSwgYXdheSwgY2F0ZWdvcnksIGxvY2t0aW1lKTsKICAgICAgICBHYW1lIG1lbW9yeSBnYW1lID0gR2FtZShpZCwgbXNnLnNlbmRlciwgaG9tZSwgYXdheSwgY2F0ZWdvcnksIGxvY2t0aW1lLCBHYW1lU3RhdHVzLk9wZW4sIEdhbWVSZXN1bHQoMCwwLDApKTsKICAgICAgICBnYW1lcy5wdXNoKGdhbWUpOwogICAgICAgIEdhbWVDcmVhdGVkKGlkLCBnYW1lLmNyZWF0b3IsIGhvbWUsIGF3YXksIGNhdGVnb3J5LCBsb2NrdGltZSk7CiAgICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjYW5jZWxPcGVuQmlkcyhCb29rIHN0b3JhZ2UgYm9vaykgcHJpdmF0ZSByZXR1cm5zIChpbnQpIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgYm9vay5ob21lQmlkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBCaWQgYmlkID0gYm9vay5ob21lQmlkc1tpXTsKICAgICAgICAgICAgaWYgKGJpZC5hbW91bnQgPT0gMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBiYWxhbmNlc1tiaWQuYmlkZGVyXSArPSBiaWQuYW1vdW50OwogICAgICAgIH0KICAgICAgICBkZWxldGUgYm9vay5ob21lQmlkczsKICAgICAgICBmb3IgKGk9MDsgaSA8IGJvb2suYXdheUJpZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYmlkID0gYm9vay5hd2F5Qmlkc1tpXTsKICAgICAgICAgICAgaWYgKGJpZC5hbW91bnQgPT0gMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBiYWxhbmNlc1tiaWQuYmlkZGVyXSArPSBiaWQuYW1vdW50OwogICAgICAgIH0KICAgICAgICBkZWxldGUgYm9vay5hd2F5QmlkczsKCiAgICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbmNlbEJldHMoQm9vayBzdG9yYWdlIGJvb2ssIEJvb2tUeXBlIGJvb2tfdHlwZSkgcHJpdmF0ZSByZXR1cm5zIChpbnQpIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgYm9vay5iZXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIEJldCBiZXQgPSBib29rLmJldHNbaV07CiAgICAgICAgICAgIGlmIChiZXQuc3RhdHVzID09IEJldFN0YXR1cy5QYWlkKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIHVpbnQgYXdheUJldEFtb3VudDsKICAgICAgICAgICAgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5Nb25leUxpbmUpIHsKICAgICAgICAgICAgICAgIGlmIChiZXQubGluZSA8IDApCiAgICAgICAgICAgICAgICAgICAgYXdheUJldEFtb3VudCA9IGJldC5hbW91bnQgKiAxMDAgLyB1aW50KGJldC5saW5lKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBhd2F5QmV0QW1vdW50ID0gYmV0LmFtb3VudCAqIHVpbnQoYmV0LmxpbmUpIC8gMTAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGF3YXlCZXRBbW91bnQgPSBiZXQuYW1vdW50OwogICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gYmV0LmFtb3VudDsKICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmF3YXldICs9IGF3YXlCZXRBbW91bnQ7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBib29rLmJldHM7CgogICAgICAgIHJldHVybiAtMTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWxldGVHYW1lKGJ5dGVzMzIgZ2FtZV9pZCkgcmV0dXJucyAoaW50KSB7CiAgICAgICAgR2FtZSBnYW1lID0gZ2V0R2FtZUJ5SWQoZ2FtZV9pZCk7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZ2FtZS5jcmVhdG9yICYmIChnYW1lLmxvY2t0aW1lICsgODY0MDAqNCkgPiBub3cpIHJldHVybiAxOwoKICAgICAgICBmb3IgKHVpbnQgaT0xOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIEJvb2sgYm9vayA9IGdhbWUuYm9va3NbaV07CiAgICAgICAgICAgIGNhbmNlbE9wZW5CaWRzKGJvb2spOwogICAgICAgICAgICBjYW5jZWxCZXRzKGJvb2ssIEJvb2tUeXBlKGkpKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpPTA7IGkgPCBnYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZ2FtZXNbaV0uaWQgPT0gZ2FtZV9pZCkgewogICAgICAgICAgICAgICAgZ2FtZXNbaV0gPSBnYW1lc1tnYW1lcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGdhbWVzLmxlbmd0aCAtPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIGZ1bmN0aW9uIHBheUJldHMoYnl0ZXMzMiBnYW1lX2lkKSBwcml2YXRlIHJldHVybnMgKGludCkgewogICAgICAgIEdhbWUgZ2FtZSA9IGdldEdhbWVCeUlkKGdhbWVfaWQpOwoKICAgICAgICBCZXRbXSBzcHJlYWRCZXRzID0gZ2FtZS5ib29rc1t1aW50KEJvb2tUeXBlLlNwcmVhZCldLmJldHM7CiAgICAgICAgQmV0W10gbW9uZXlMaW5lQmV0cyA9IGdhbWUuYm9va3NbdWludChCb29rVHlwZS5Nb25leUxpbmUpXS5iZXRzOwogICAgICAgIEJldFtdIG92ZXJVbmRlckJldHMgPSBnYW1lLmJvb2tzW3VpbnQoQm9va1R5cGUuT3ZlclVuZGVyKV0uYmV0czsKCiAgICAgICAgLy8gU3ByZWFkCiAgICAgICAgaW50IHJlc3VsdFNwcmVhZCA9IGdhbWUucmVzdWx0LmF3YXkgLSBnYW1lLnJlc3VsdC5ob21lOwogICAgICAgIHJlc3VsdFNwcmVhZCAqPSAxMDsgLy8gYmVjYXVzZSBiZXQubGluZSBpcyAxMHggdGhlIGFjdHVhbCBsaW5lCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc3ByZWFkQmV0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBCZXQgYmV0ID0gc3ByZWFkQmV0c1tpXTsKICAgICAgICAgICAgaWYgKGJldC5zdGF0dXMgPT0gQmV0U3RhdHVzLlBhaWQpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHJlc3VsdFNwcmVhZCA+IGJldC5saW5lKSAKICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5hd2F5XSArPSBiZXQuYW1vdW50ICogMjsKICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0U3ByZWFkIDwgYmV0LmxpbmUpCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gYmV0LmFtb3VudCAqIDI7CiAgICAgICAgICAgIGVsc2UgeyAvLyBkcmF3CiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuYXdheV0gKz0gYmV0LmFtb3VudDsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5ob21lXSArPSBiZXQuYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJldC5zdGF0dXMgPSBCZXRTdGF0dXMuUGFpZDsKICAgICAgICB9CgogICAgICAgIC8vIE1vbmV5TGluZQogICAgICAgIGJvb2wgdGllID0gZ2FtZS5yZXN1bHQuaG9tZSA9PSBnYW1lLnJlc3VsdC5hd2F5OwogICAgICAgIGJvb2wgaG9tZVdpbiA9IGdhbWUucmVzdWx0LmhvbWUgPiBnYW1lLnJlc3VsdC5hd2F5OwogICAgICAgIGZvciAoaT0wOyBpIDwgbW9uZXlMaW5lQmV0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBiZXQgPSBtb25leUxpbmVCZXRzW2ldOwogICAgICAgICAgICBpZiAoYmV0LnN0YXR1cyA9PSBCZXRTdGF0dXMuUGFpZCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB1aW50IGF3YXlBbW91bnQ7CiAgICAgICAgICAgIGlmIChiZXQubGluZSA8IDApCiAgICAgICAgICAgICAgICBhd2F5QW1vdW50ID0gYmV0LmFtb3VudCAqIDEwMCAvIHVpbnQoLWJldC5saW5lKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYXdheUFtb3VudCA9IGJldC5hbW91bnQgKiB1aW50KGJldC5saW5lKSAvIDEwMDsKICAgICAgICAgICAgaWYgKHRpZSkgewogICAgICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmhvbWVdICs9IGJldC5hbW91bnQ7CiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuYXdheV0gKz0gYXdheUFtb3VudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChob21lV2luKQogICAgICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmhvbWVdICs9IChiZXQuYW1vdW50ICsgYXdheUFtb3VudCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JldC5hd2F5XSArPSAoYmV0LmFtb3VudCArIGF3YXlBbW91bnQpOwogICAgICAgICAgICBiZXQuc3RhdHVzID0gQmV0U3RhdHVzLlBhaWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBPdmVyVW5kZXIgLSBiZXQubGluZSBpcyAxMHggdGhlIGFjdHVhbCBsaW5lIHRvIGFsbG93IGhhbGYtcG9pbnQgc3ByZWFkcwogICAgICAgIGludCB0b3RhbFBvaW50cyA9IChnYW1lLnJlc3VsdC5ob21lICsgZ2FtZS5yZXN1bHQuYXdheSkgKiAxMDsKICAgICAgICBmb3IgKGk9MDsgaSA8IG92ZXJVbmRlckJldHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYmV0ID0gb3ZlclVuZGVyQmV0c1tpXTsKICAgICAgICAgICAgaWYgKGJldC5zdGF0dXMgPT0gQmV0U3RhdHVzLlBhaWQpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHRvdGFsUG9pbnRzID4gYmV0LmxpbmUpCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gYmV0LmFtb3VudCAqIDI7CiAgICAgICAgICAgIGVsc2UgaWYgKHRvdGFsUG9pbnRzIDwgYmV0LmxpbmUpCiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuYXdheV0gKz0gYmV0LmFtb3VudCAqIDI7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYmFsYW5jZXNbYmV0LmF3YXldICs9IGJldC5hbW91bnQ7CiAgICAgICAgICAgICAgICBiYWxhbmNlc1tiZXQuaG9tZV0gKz0gYmV0LmFtb3VudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBiZXQuc3RhdHVzID0gQmV0U3RhdHVzLlBhaWQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgZnVuY3Rpb24gdmVyaWZ5R2FtZVJlc3VsdChieXRlczMyIGdhbWVfaWQpIHJldHVybnMgKGludCkgewogICAgICAgIEdhbWUgZ2FtZSA9IGdldEdhbWVCeUlkKGdhbWVfaWQpOwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGdhbWUuY3JlYXRvcikgcmV0dXJuIDE7CiAgICAgICAgaWYgKGdhbWUuc3RhdHVzICE9IEdhbWVTdGF0dXMuU2NvcmVkKSByZXR1cm4gMjsKICAgICAgICBpZiAobm93IDwgZ2FtZS5yZXN1bHQudGltZXN0YW1wICsgMTIqMzYwMCkgcmV0dXJuIDM7IC8vIG11c3Qgd2FpdCAxMiBob3VycyB0byB2ZXJpZnkgCgogICAgICAgIHBheUJldHMoZ2FtZV9pZCk7CiAgICAgICAgZ2FtZS5zdGF0dXMgPSBHYW1lU3RhdHVzLlZlcmlmaWVkOwogICAgICAgIEdhbWVWZXJpZmllZChnYW1lX2lkKTsKCiAgICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEdhbWVSZXN1bHQoYnl0ZXMzMiBnYW1lX2lkLCBpbnQgaG9tZVNjb3JlLCBpbnQgYXdheVNjb3JlKSByZXR1cm5zIChpbnQpIHsKICAgICAgICBHYW1lIGdhbWUgPSBnZXRHYW1lQnlJZChnYW1lX2lkKTsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBnYW1lLmNyZWF0b3IpIHJldHVybiAxOwogICAgICAgIGlmIChnYW1lLmxvY2t0aW1lID4gbm93KSByZXR1cm4gMjsKICAgICAgICBpZiAoZ2FtZS5zdGF0dXMgPT0gR2FtZVN0YXR1cy5WZXJpZmllZCkgcmV0dXJuIDM7CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IDQ7IGkrKykKICAgICAgICAgICAgY2FuY2VsT3BlbkJpZHMoZ2FtZS5ib29rc1tpXSk7CgogICAgICAgIGdhbWUucmVzdWx0LmhvbWUgPSBob21lU2NvcmU7CiAgICAgICAgZ2FtZS5yZXN1bHQuYXdheSA9IGF3YXlTY29yZTsKICAgICAgICBnYW1lLnJlc3VsdC50aW1lc3RhbXAgPSBub3c7CiAgICAgICAgZ2FtZS5zdGF0dXMgPSBHYW1lU3RhdHVzLlNjb3JlZDsKICAgICAgICBHYW1lU2NvcmVkKGdhbWVfaWQsIGhvbWVTY29yZSwgYXdheVNjb3JlLCBub3cpOwoKICAgICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgLy8gbGluZSBpcyBhY3R1YWxseSAxMHggdGhlIGxpbmUgdG8gYWxsb3cgZm9yIGhhbGYtcG9pbnQgc3ByZWFkcwogICAgZnVuY3Rpb24gYmlkKGJ5dGVzMzIgZ2FtZV9pZCwgQm9va1R5cGUgYm9va190eXBlLCBib29sIGhvbWUsIGludDMyIGxpbmUpIHBheWFibGUgcmV0dXJucyAoaW50KSB7CiAgICAgICAgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5Ob25lKQogICAgICAgICAgICByZXR1cm4gNTsKCiAgICAgICAgR2FtZSBnYW1lID0gZ2V0R2FtZUJ5SWQoZ2FtZV9pZCk7CiAgICAgICAgQm9vayBib29rID0gZ2FtZS5ib29rc1t1aW50KGJvb2tfdHlwZSldOwogICAgICAgIEJpZCBtZW1vcnkgYmlkID0gQmlkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgaG9tZSwgbGluZSk7CgogICAgICAgIC8vIHZhbGlkYXRlIGlucHV0czogZ2FtZSBzdGF0dXMsIGdhbWV0aW1lLCBsaW5lIGFtb3VudAogICAgICAgIGlmIChnYW1lLnN0YXR1cyAhPSBHYW1lU3RhdHVzLk9wZW4pCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChub3cgPiBnYW1lLmxvY2t0aW1lKSB7CiAgICAgICAgICAgIGdhbWUuc3RhdHVzID0gR2FtZVN0YXR1cy5Mb2NrZWQ7ICAgIAogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCA0OyBpKyspCiAgICAgICAgICAgICAgICBjYW5jZWxPcGVuQmlkcyhnYW1lLmJvb2tzW2ldKTsKICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgfQogICAgICAgIGlmICgoYm9va190eXBlID09IEJvb2tUeXBlLlNwcmVhZCB8fCBib29rX3R5cGUgPT0gQm9va1R5cGUuT3ZlclVuZGVyKQogICAgICAgICAgICAmJiBsaW5lICUgNSAhPSAwKQogICAgICAgICAgICByZXR1cm4gMzsKICAgICAgICBlbHNlIGlmIChib29rX3R5cGUgPT0gQm9va1R5cGUuTW9uZXlMaW5lICYmIGxpbmUgPCAxMDAgJiYgbGluZSA+PSAtMTAwKQogICAgICAgICAgICByZXR1cm4gNDsKCiAgICAgICAgQmlkIG1lbW9yeSByZW1haW5pbmdCaWQgPSBtYXRjaEV4aXN0aW5nQmlkcyhiaWQsIGdhbWVfaWQsIGJvb2tfdHlwZSk7CgogICAgICAgIC8vIFVzZSBsZWZ0b3ZlciBmdW5kcyB0byBwbGFjZSBvcGVuIGJpZHMgKG1ha2VyKQogICAgICAgIGlmIChiaWQuYW1vdW50ID4gMCkgewogICAgICAgICAgICBCaWRbXSBiaWRTdGFjayA9IGhvbWUgPyBib29rLmhvbWVCaWRzIDogYm9vay5hd2F5QmlkczsKICAgICAgICAgICAgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5PdmVyVW5kZXIgJiYgaG9tZSkKICAgICAgICAgICAgICAgIGFkZEJpZFRvU3RhY2socmVtYWluaW5nQmlkLCBiaWRTdGFjaywgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFkZEJpZFRvU3RhY2socmVtYWluaW5nQmlkLCBiaWRTdGFjaywgZmFsc2UpOwogICAgICAgICAgICBCaWRQbGFjZWQoZ2FtZV9pZCwgYm9va190eXBlLCByZW1haW5pbmdCaWQuYmlkZGVyLCByZW1haW5pbmdCaWQuYW1vdW50LCBob21lLCBsaW5lKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAtMTsKICAgIH0KCiAgICAvLyByZXR1cm5pbmcgYW4gYXJyYXkgb2Ygc3RydWN0cyBpcyBub3QgYWxsb3dlZCwgc28gaXRzIHRpbWUgZm9yIGEgaGFja2pvYgogICAgLy8gdGhhdCByZXR1cm5zIGEgcmF3IGJ5dGVzIGR1bXAgb2YgdGhlIGNvbWJpbmVkIGhvbWUgYW5kIGF3YXkgYmlkcwogICAgLy8gY2xpZW50cyB3aWxsIGhhdmUgdG8gcGFyc2UgdGhlIGhleCBkdW1wIHRvIGdldCB0aGUgYmlkcyBvdXQKICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgZm9yIERFQlVHR0lORyBQVVJQT1NFUyBPTkxZLiBVc2luZyBpdCBpbiBhIHByb2R1Y3Rpb24KICAgIC8vIHNldHRpbmcgd2lsbCByZXR1cm4gdmVyeSBsYXJnZSBieXRlIGFycmF5cyB0aGF0IHdpbGwgY29uc3VtZSB5b3VyIGJhbmR3aWR0aAogICAgLy8gaWYgeW91IGFyZSBub3QgcnVubmluZyBhIGZ1bGwgbm9kZSAgCiAgICBmdW5jdGlvbiBnZXRPcGVuQmlkcyhieXRlczMyIGdhbWVfaWQsIEJvb2tUeXBlIGJvb2tfdHlwZSkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICBHYW1lIGdhbWUgPSBnZXRHYW1lQnlJZChnYW1lX2lkKTsKICAgICAgICBCb29rIGJvb2sgPSBnYW1lLmJvb2tzW3VpbnQoYm9va190eXBlKV07CiAgICAgICAgdWludCBuQmlkcyA9IGJvb2suaG9tZUJpZHMubGVuZ3RoICsgYm9vay5hd2F5Qmlkcy5sZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHMgPSBuZXcgYnl0ZXMoNTcgKiBuQmlkcyk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgbkJpZHM7IGkrKykgewogICAgICAgICAgICBpZiAoaSA8IGJvb2suaG9tZUJpZHMubGVuZ3RoKQogICAgICAgICAgICAgICAgQmlkIGJpZCA9IGJvb2suaG9tZUJpZHNbaV07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJpZCA9IGJvb2suYXdheUJpZHNbaSAtIGJvb2suaG9tZUJpZHMubGVuZ3RoXTsKICAgICAgICAgICAgYnl0ZXMyMCBiaWRkZXIgPSBieXRlczIwKGJpZC5iaWRkZXIpOwogICAgICAgICAgICBieXRlczMyIGFtb3VudCA9IGJ5dGVzMzIoYmlkLmFtb3VudCk7CiAgICAgICAgICAgIGJ5dGUgaG9tZSA9IGJpZC5ob21lID8gYnl0ZSgxKSA6IGJ5dGUoMCk7CiAgICAgICAgICAgIGJ5dGVzNCBsaW5lID0gYnl0ZXM0KGJpZC5saW5lKTsKCiAgICAgICAgICAgIGZvciAodWludCBqPTA7IGogPCAyMDsgaisrKSB7IHNba10gPSBiaWRkZXJbal07IGsrKzsgfQogICAgICAgICAgICBmb3IgKGo9MDsgaiA8IDMyOyBqKyspIHsgc1trXSA9IGFtb3VudFtqXTsgaysrOyB9CiAgICAgICAgICAgIHNba10gPSBob21lOyBrKys7CiAgICAgICAgICAgIGZvciAoaj0wOyBqIDwgNDsgaisrKSB7IHNba10gPSBsaW5lW2pdOyBrKys7IH0KCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gczsKICAgIH0KCiAgICAvLyBmb3IgZnVuY3Rpb25zIHRocm93aW5nIGEgc3RhY2sgdG9vIGRlZXAgZXJyb3IsIHRoaXMgaGVscGVyIHdpbGwgZnJlZSB1cCAyIGxvY2FsIHZhcmlhYmxlIHNwb3RzCiAgICBmdW5jdGlvbiBnZXRCb29rKGJ5dGVzMzIgZ2FtZV9pZCwgQm9va1R5cGUgYm9va190eXBlKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKEJvb2sgc3RvcmFnZSkgewogICAgICAgIEdhbWUgZ2FtZSA9IGdldEdhbWVCeUlkKGdhbWVfaWQpOwogICAgICAgIEJvb2sgYm9vayA9IGdhbWUuYm9va3NbdWludChib29rX3R5cGUpXTsKICAgICAgICByZXR1cm4gYm9vazsKICAgIH0KCiAgICAKICAgIC8vIGZvciBvdmVyL3VuZGVyIGJpZHMsIHRoZSBob21lIGJvb2xlYW4gaXMgZXF1aXZhbGVudCB0byB0aGUgb3ZlcgogICAgZnVuY3Rpb24gbWF0Y2hFeGlzdGluZ0JpZHMoQmlkIGJpZCwgYnl0ZXMzMiBnYW1lX2lkLCBCb29rVHlwZSBib29rX3R5cGUpIHByaXZhdGUgcmV0dXJucyAoQmlkKSB7CiAgICAgICAgQm9vayBib29rID0gZ2V0Qm9vayhnYW1lX2lkLCBib29rX3R5cGUpOwogICAgICAgIGJvb2wgaG9tZSA9IGJpZC5ob21lOwogICAgICAgIEJpZFtdIG1hdGNoU3RhY2sgPSBob21lID8gIGJvb2suYXdheUJpZHMgOiBib29rLmhvbWVCaWRzOwogICAgICAgIGludCBpID0gaW50KG1hdGNoU3RhY2subGVuZ3RoKSAtIDE7CiAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBiaWQuYW1vdW50ID4gMCkgewogICAgICAgICAgICB1aW50IGogPSB1aW50KGkpOwogICAgICAgICAgICBpZiAobWF0Y2hTdGFja1tqXS5hbW91bnQgPT0gMCkgeyAvLyBkZWxldGVkIGJpZHMKICAgICAgICAgICAgICAgIGktLTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChib29rX3R5cGUgPT0gQm9va1R5cGUuT3ZlclVuZGVyKSB7CiAgICAgICAgICAgICAgICBpZiAoaG9tZSAmJiBiaWQubGluZSA8IG1hdGNoU3RhY2tbal0ubGluZSAKICAgICAgICAgICAgICAgIHx8ICFob21lICYmIGJpZC5saW5lID4gbWF0Y2hTdGFja1tqXS5saW5lKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoLWJpZC5saW5lIDwgbWF0Y2hTdGFja1tqXS5saW5lKQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBkZXRlcm1pbmVkIHJlcXVpcmVkIGJldCBhbW91bnQgdG8gbWF0Y2ggc3RhY2sgYmlkCiAgICAgICAgICAgIHVpbnQgcmVxdWlyZWRCZXQ7CiAgICAgICAgICAgIGlmIChib29rX3R5cGUgPT0gQm9va1R5cGUuU3ByZWFkIHx8IGJvb2tfdHlwZSA9PSBCb29rVHlwZS5PdmVyVW5kZXIpCiAgICAgICAgICAgICAgICByZXF1aXJlZEJldCA9IG1hdGNoU3RhY2tbal0uYW1vdW50OwogICAgICAgICAgICBlbHNlIGlmIChtYXRjaFN0YWNrW2pdLmxpbmUgPiAwKSB7IC8vIGltcGxpZWQgTW9uZXlMaW5lCiAgICAgICAgICAgICAgICByZXF1aXJlZEJldCA9IG1hdGNoU3RhY2tbal0uYW1vdW50ICogdWludChtYXRjaFN0YWNrW2pdLmxpbmUpIC8gMTAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyAvLyBpbXBsaWVkIE1vbmV5TGluZSBhbmQgbmVnYXRpdmUgbGluZQogICAgICAgICAgICAgICAgcmVxdWlyZWRCZXQgPSBtYXRjaFN0YWNrW2pdLmFtb3VudCAqIDEwMCAvIHVpbnQoLW1hdGNoU3RhY2tbal0ubGluZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRldGVybWluZSBiZXQgYW1vdW50cyBvbiBib3RoIHNpZGVzCiAgICAgICAgICAgIHVpbnQgYmV0QW1vdW50OwogICAgICAgICAgICB1aW50IG9wcG9zaW5nQmV0QW1vdW50OwogICAgICAgICAgICBpZiAoYmlkLmFtb3VudCA8IHJlcXVpcmVkQmV0KSB7CiAgICAgICAgICAgICAgICBiZXRBbW91bnQgPSBiaWQuYW1vdW50OwogICAgICAgICAgICAgICAgaWYgKGJvb2tfdHlwZSA9PSBCb29rVHlwZS5TcHJlYWQgfHwgYm9va190eXBlID09IEJvb2tUeXBlLk92ZXJVbmRlcikKICAgICAgICAgICAgICAgICAgICBvcHBvc2luZ0JldEFtb3VudCA9IGJpZC5hbW91bnQ7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtYXRjaFN0YWNrW2pdLmxpbmUgPiAwKQogICAgICAgICAgICAgICAgICAgIG9wcG9zaW5nQmV0QW1vdW50ID0gYmV0QW1vdW50ICogMTAwIC8gdWludChtYXRjaFN0YWNrW2pdLmxpbmUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIG9wcG9zaW5nQmV0QW1vdW50ID0gYmlkLmFtb3VudCAqIHVpbnQoLW1hdGNoU3RhY2tbal0ubGluZSkgLyAxMDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBiZXRBbW91bnQgPSByZXF1aXJlZEJldDsKICAgICAgICAgICAgICAgIG9wcG9zaW5nQmV0QW1vdW50ID0gbWF0Y2hTdGFja1tqXS5hbW91bnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmlkLmFtb3VudCAtPSBiZXRBbW91bnQ7CiAgICAgICAgICAgIG1hdGNoU3RhY2tbal0uYW1vdW50IC09IG9wcG9zaW5nQmV0QW1vdW50OwoKICAgICAgICAgICAgaW50MzIgbXlMaW5lOwogICAgICAgICAgICBpZiAoYm9va190eXBlID09IEJvb2tUeXBlLk92ZXJVbmRlcikKICAgICAgICAgICAgICAgIG15TGluZSA9IG1hdGNoU3RhY2tbal0ubGluZTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbXlMaW5lID0gLW1hdGNoU3RhY2tbal0ubGluZTsKICAgICAgICAgICAgQmV0IG1lbW9yeSBiZXQgPSBCZXQoCiAgICAgICAgICAgICAgICBob21lID8gYmlkLmJpZGRlciA6IG1hdGNoU3RhY2tbal0uYmlkZGVyLAogICAgICAgICAgICAgICAgaG9tZSA/IG1hdGNoU3RhY2tbal0uYmlkZGVyIDogYmlkLmJpZGRlciwKICAgICAgICAgICAgICAgIGhvbWUgPyBiZXRBbW91bnQgOiBvcHBvc2luZ0JldEFtb3VudCwKICAgICAgICAgICAgICAgIGhvbWUgPyBteUxpbmUgOiBtYXRjaFN0YWNrW2pdLmxpbmUsCiAgICAgICAgICAgICAgICBCZXRTdGF0dXMuT3BlbgogICAgICAgICAgICApOwogICAgICAgICAgICBib29rLmJldHMucHVzaChiZXQpOwogICAgICAgICAgICBCZXRQbGFjZWQoZ2FtZV9pZCwgYm9va190eXBlLCBiaWQuYmlkZGVyLCBob21lLCBiZXRBbW91bnQsIG15TGluZSk7CiAgICAgICAgICAgIEJldFBsYWNlZChnYW1lX2lkLCBib29rX3R5cGUsIG1hdGNoU3RhY2tbal0uYmlkZGVyLCAKICAgICAgICAgICAgICAgICFob21lLCBvcHBvc2luZ0JldEFtb3VudCwgbWF0Y2hTdGFja1tqXS5saW5lKTsKICAgICAgICAgICAgaS0tOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYmlkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbmNlbEJpZChieXRlczMyIGdhbWVfaWQsIEJvb2tUeXBlIGJvb2tfdHlwZSwgaW50MzIgbGluZSwgYm9vbCBob21lKSByZXR1cm5zIChpbnQpIHsKICAgICAgICBCb29rIGJvb2sgPSBnZXRCb29rKGdhbWVfaWQsIGJvb2tfdHlwZSk7CiAgICAgICAgQmlkW10gc3RhY2sgPSBob21lID8gYm9vay5ob21lQmlkcyA6IGJvb2suYXdheUJpZHM7CiAgICAgICAgYWRkcmVzcyBiaWRkZXIgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyBEZWxldGUgYmlkIGluIHN0YWNrLCByZWZ1bmQgYW1vdW50IHRvIHVzZXIKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgc3RhY2subGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHN0YWNrW2ldLmFtb3VudCA+IDAgJiYgc3RhY2tbaV0uYmlkZGVyID09IGJpZGRlciAmJiBzdGFja1tpXS5saW5lID09IGxpbmUpIHsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW2JpZGRlcl0gKz0gc3RhY2tbaV0uYW1vdW50OwogICAgICAgICAgICAgICAgZGVsZXRlIHN0YWNrW2ldOwogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgIGZ1bmN0aW9uIGtpbGwgKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG93bmVyKSBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEdhbWVJZCAoYWRkcmVzcyBjcmVhdG9yLCBzdHJpbmcgaG9tZSwgc3RyaW5nIGF3YXksIHVpbnQxNiBjYXRlZ29yeSwgdWludDY0IGxvY2t0aW1lKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgdWludCBpID0gMDsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKGhvbWUpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoYXdheSk7CiAgICAgICAgYnl0ZXMyIGMgPSBieXRlczIoY2F0ZWdvcnkpOwogICAgICAgIGJ5dGVzOCBkID0gYnl0ZXM4KGxvY2t0aW1lKTsKICAgICAgICBieXRlczIwIGUgPSBieXRlczIwKGNyZWF0b3IpOwoKICAgICAgICB1aW50IGxlbmd0aCA9IGEubGVuZ3RoICsgYi5sZW5ndGggKyBjLmxlbmd0aCArIGQubGVuZ3RoICsgZS5sZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvSGFzaCA9IG5ldyBieXRlcyhsZW5ndGgpOwogICAgICAgIHVpbnQgayA9IDA7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gYVtpXTsgaysrOyB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gYltpXTsgaysrOyB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGMubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gY1tpXTsgaysrOyB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGQubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gZFtpXTsgaysrOyB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGUubGVuZ3RoOyBpKyspIHsgdG9IYXNoW2tdID0gZVtpXTsgaysrOyB9CiAgICAgICAgcmV0dXJuIHNoYTModG9IYXNoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0QWN0aXZlR2FtZXMgKCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMltdKSB7CiAgICAgICAgYnl0ZXMzMltdIG1lbW9yeSBnYW1lX2lkcyA9IG5ldyBieXRlczMyW10oZ2FtZXMubGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpIDwgZ2FtZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ2FtZV9pZHNbaV0gPSAoZ2FtZXNbaV0uaWQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2FtZV9pZHM7CiAgICB9CiAgICAgICAgCiAgICBmdW5jdGlvbiBhZGRCaWRUb1N0YWNrKEJpZCBiaWQsIEJpZFtdIHN0b3JhZ2Ugc3RhY2ssIGJvb2wgcmV2ZXJzZSkgcHJpdmF0ZSByZXR1cm5zIChpbnQpIHsKICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09IDApIHsKICAgICAgICAgICAgc3RhY2sucHVzaChiaWQpOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGRldGVybWluZSBwb3NpdGlvbiBvZiBuZXcgYmlkIGluIHN0YWNrCiAgICAgICAgdWludCBpbnNlcnRJbmRleCA9IHN0YWNrLmxlbmd0aDsKICAgICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgICAgICB3aGlsZSAoaW5zZXJ0SW5kZXggPiAwICYmIGJpZC5saW5lIDw9IHN0YWNrW2luc2VydEluZGV4LTFdLmxpbmUpCiAgICAgICAgICAgICAgICBpbnNlcnRJbmRleC0tOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgd2hpbGUgKGluc2VydEluZGV4ID4gMCAmJiBiaWQubGluZSA+PSBzdGFja1tpbnNlcnRJbmRleC0xXS5saW5lKQogICAgICAgICAgICAgICAgaW5zZXJ0SW5kZXgtLTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gdHJ5IHRvIGZpbmQgZGVsZXRlZCBzbG90IHRvIGZpbGwKICAgICAgICBpZiAoaW5zZXJ0SW5kZXggPiAwICYmIHN0YWNrW2luc2VydEluZGV4IC0gMV0uYW1vdW50ID09IDApIHsKICAgICAgICAgICAgc3RhY2tbaW5zZXJ0SW5kZXggLSAxXSA9IGJpZDsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICB1aW50IHNoaWZ0RW5kSW5kZXggPSBpbnNlcnRJbmRleDsKICAgICAgICB3aGlsZSAoc2hpZnRFbmRJbmRleCA8IHN0YWNrLmxlbmd0aCAmJiBzdGFja1tzaGlmdEVuZEluZGV4XS5hbW91bnQgPiAwKSB7CiAgICAgICAgICAgIHNoaWZ0RW5kSW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gc2hpZnQgYmlkcyBkb3duICh1cCB0byBkZWxldGVkIGluZGV4IGlmIG9uZSBleGlzdHMpCiAgICAgICAgaWYgKHNoaWZ0RW5kSW5kZXggPT0gc3RhY2subGVuZ3RoKQogICAgICAgICAgICBzdGFjay5sZW5ndGggKz0gMTsKICAgICAgICBmb3IgKHVpbnQgaSA9IHNoaWZ0RW5kSW5kZXg7IGkgPiBpbnNlcnRJbmRleDsgaS0tKSB7CiAgICAgICAgICAgIHN0YWNrW2ldID0gc3RhY2tbaS0xXTsKICAgICAgICB9IAoKICAgICAgICBzdGFja1tpbnNlcnRJbmRleF0gPSBiaWQ7CiAgICAgICAgCgogICAgICAgIHJldHVybiAtMTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRHYW1lQnlJZChieXRlczMyIGdhbWVfaWQpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAoR2FtZSBzdG9yYWdlKSB7CiAgICAgICAgYm9vbCBnYW1lX2V4aXN0cyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGdhbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChnYW1lc1tpXS5pZCA9PSBnYW1lX2lkKSB7CiAgICAgICAgICAgICAgICBHYW1lIGdhbWUgPSBnYW1lc1tpXTsKICAgICAgICAgICAgICAgIGdhbWVfZXhpc3RzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZ2FtZV9leGlzdHMpCiAgICAgICAgICAgIHRocm93OwogICAgICAgIHJldHVybiBnYW1lOwogICAgfQoKCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHJldHVybnMgKGludCkgewogICAgICAgIHZhciBiYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKGJhbGFuY2UpKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZTsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIFdpdGhkcmF3YWwobXNnLnNlbmRlciwgYmFsYW5jZSwgbm93KTsKICAgICAgICByZXR1cm4gLTE7CiAgICB9Cgp9'.
	

]
