Class {
	#name : #SRTba5a17c1af87193b1c2bb1d8e28b1f9ca80332fc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTba5a17c1af87193b1c2bb1d8e28b1f9ca80332fc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBFbmdpbmUgewogICAgdWludDI1NiBwdWJsaWMgVkVSU0lPTjsKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTl9OQU1FOwoKICAgIGVudW0gU3RhdHVzIHsgaW5pdGlhbCwgbGVudCwgcGFpZCwgZGVzdHJveWVkIH0KICAgIHN0cnVjdCBBcHByb2JhdGlvbiB7CiAgICAgICAgYm9vbCBhcHByb3ZlZDsKICAgICAgICBieXRlcyBkYXRhOwogICAgICAgIGJ5dGVzMzIgY2hlY2tzdW07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG90YWxMb2FucygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0T3JhY2xlKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKE9yYWNsZSk7CiAgICBmdW5jdGlvbiBnZXRCb3Jyb3dlcih1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldENvc2lnbmVyKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGdldENyZWF0b3IodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRBbW91bnQodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRQYWlkKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0RHVlVGltZSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldEFwcHJvYmF0aW9uKHVpbnQgaW5kZXgsIGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0U3RhdHVzKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cyk7CiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UGVuZGluZ0Ftb3VudCh1aW50IGluZGV4KSBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRDdXJyZW5jeSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGNvc2lnbih1aW50IGluZGV4LCB1aW50MjU2IGNvc3QpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZUxvYW4odWludCBpbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBpbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB3aXRoZHJhd2FsKHVpbnQgaW5kZXgsIGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCi8qKgogICAgQGRldiBEZWZpbmVzIHRoZSBpbnRlcmZhY2Ugb2YgYSBzdGFuZGFyZCBSQ04gY29zaWduZXIuCgogICAgVGhlIGNvc2lnbmVyIGlzIGFuIGFnZW50IHRoYXQgZ2l2ZXMgYW4gaW5zdXJhbmNlIHRvIHRoZSBsZW5kZXIgaW4gdGhlIGV2ZW50IG9mIGEgZGVmYXVsdGVkIGxvYW4sIHRoZSBjb25maXRpb25zCiAgICBvZiB0aGUgaW5zdXJhbmNlIGFuZCB0aGUgY29zdCBvZiB0aGUgZ2l2ZW4gYXJlIGRlZmluZWQgYnkgdGhlIGNvc2lnbmVyLiAKCiAgICBUaGUgbGVuZGVyIHdpbGwgZGVjaWRlIHdoYXQgY29zaWduZXIgdG8gdXNlLCBpZiBhbnk7IHRoZSBhZGRyZXNzIG9mIHRoZSBjb3NpZ25lciBhbmQgdGhlIHZhbGlkIGRhdGEgcHJvdmlkZWQgYnkgdGhlCiAgICBhZ2VudCBzaG91bGQgYmUgcGFzc2VkIGFzIHBhcmFtcyB3aGVuIHRoZSBsZW5kZXIgY2FsbHMgdGhlICJsZW5kIiBtZXRob2Qgb24gdGhlIGVuZ2luZS4KICAgIAogICAgV2hlbiB0aGUgZGVmYXVsdCBjb25kaXRpb25zIGRlZmluZWQgYnkgdGhlIGNvc2lnbmVyIGFsaWducyB3aXRoIHRoZSBzdGF0dXMgb2YgdGhlIGxvYW4sIHRoZSBsZW5kZXIgb2YgdGhlIGVuZ2luZQogICAgc2hvdWxkIGJlIGFibGUgdG8gY2FsbCB0aGUgImNsYWltIiBtZXRob2QgdG8gcmVjZWl2ZSB0aGUgYmVuZWZpdDsgdGhlIGNvc2lnbmVyIGNhbiBkZWZpbmUgYWRpdGlvbmFsIHJlcXVpcmVtZW50cyB0bwogICAgY2FsbCB0aGlzIG1ldGhvZCwgbGlrZSB0aGUgdHJhbnNmZXIgb2YgdGhlIG93bmVyc2hpcCBvZiB0aGUgbG9hbi4KKi8KY29udHJhY3QgQ29zaWduZXIgewogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVkVSU0lPTiA9IDI7CiAgICAKICAgIC8qKgogICAgICAgIEByZXR1cm4gdGhlIHVybCBvZiB0aGUgZW5kcG9pbnQgdGhhdCBleHBvc2VzIHRoZSBpbnN1cmFuY2Ugb2ZmZXJzLgogICAgKi8KICAgIGZ1bmN0aW9uIHVybCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICAKICAgIC8qKgogICAgICAgIEBkZXYgUmV0cmlldmVzIHRoZSBjb3N0IG9mIGEgZ2l2ZW4gaW5zdXJhbmNlLCB0aGlzIGFtb3VudCBzaG91bGQgYmUgZXhhY3QuCgogICAgICAgIEByZXR1cm4gdGhlIGNvc3Qgb2YgdGhlIGNvc2lnbiwgaW4gUkNOIHdlaQogICAgKi8KICAgIGZ1bmN0aW9uIGNvc3QoYWRkcmVzcyBlbmdpbmUsIHVpbnQyNTYgaW5kZXgsIGJ5dGVzIGRhdGEsIGJ5dGVzIG9yYWNsZURhdGEpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgCiAgICAvKioKICAgICAgICBAZGV2IFRoZSBlbmdpbmUgY2FsbHMgdGhpcyBtZXRob2QgZm9yIGNvbmZpcm1hdGlvbiBvZiB0aGUgY29uZGl0aW9ucywgaWYgdGhlIGNvc2lnbmVyIGFjY2VwdHMgdGhlIGxpYWJpbGl0eSBvZgogICAgICAgIHRoZSBpbnN1cmFuY2UgaXQgbXVzdCBjYWxsIHRoZSBtZXRob2QgImNvc2lnbiIgb2YgdGhlIGVuZ2luZS4gSWYgdGhlIGNvc2lnbmVyIGRvZXMgbm90IGNhbGwgdGhhdCBtZXRob2QsIG9yCiAgICAgICAgZG9lcyBub3QgcmV0dXJuIHRydWUgdG8gdGhpcyBtZXRob2QsIHRoZSBvcGVyYXRpb24gZmFpbHMuCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY29zaWduZXIgYWNjZXB0cyB0aGUgbGlhYmlsaXR5CiAgICAqLwogICAgZnVuY3Rpb24gcmVxdWVzdENvc2lnbihFbmdpbmUgZW5naW5lLCB1aW50MjU2IGluZGV4LCBieXRlcyBkYXRhLCBieXRlcyBvcmFjbGVEYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICAKICAgIC8qKgogICAgICAgIEBkZXYgQ2xhaW1zIHRoZSBiZW5lZml0IG9mIHRoZSBpbnN1cmFuY2UgaWYgdGhlIGxvYW4gaXMgZGVmYXVsdGVkLCB0aGlzIG1ldGhvZCBzaG91bGQgYmUgb25seSBjYWxsZWFibGUgYnkgdGhlCiAgICAgICAgY3VycmVudCBsZW5kZXIgb2YgdGhlIGxvYW4uCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY2xhaW0gd2FzIGRvbmUgY29ycmVjdGx5LgogICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltKGFkZHJlc3MgZW5naW5lLCB1aW50MjU2IGluZGV4LCBieXRlcyBvcmFjbGVEYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IEVSQzcyMSB7CiAgIC8vIEVSQzIwIGNvbXBhdGlibGUgZnVuY3Rpb25zCiAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX25hbWUpOwogICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCk7CiAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfdG90YWxTdXBwbHkpOwogICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgX2JhbGFuY2UpOwogICAvLyBGdW5jdGlvbnMgdGhhdCBkZWZpbmUgb3duZXJzaGlwCiAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NikgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpOwogICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpOwogICBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgZnVuY3Rpb24gZ2V0QXBwcm92ZWQodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgIGZ1bmN0aW9uIGlzQXBwcm92ZWRGb3JBbGwoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX29wZXJhdG9yKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgLy8gVG9rZW4gbWV0YWRhdGEKICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mbyk7CiAgIC8vIEV2ZW50cwogICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX2FwcHJvdmVkLCB1aW50MjU2IF90b2tlbklkKTsKICAgZXZlbnQgQXBwcm92YWxGb3JBbGwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpOwp9Cgpjb250cmFjdCBUb2tlbiB7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7Cn0KCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7IAogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgVHJhbnNmZXJzIHRoZSBvd25lcnNoaXAgb2YgdGhlIGNvbnRyYWN0LgoKICAgICAgICBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdGhlIG5ldyBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG8oYWRkcmVzcyBfdG8pIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG93bmVyID0gX3RvOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSAKfSAKCi8qKgogICAgQGRldiBEZWZpbmVzIHRoZSBpbnRlcmZhY2Ugb2YgYSBzdGFuZGFyZCBSQ04gb3JhY2xlLgoKICAgIFRoZSBvcmFjbGUgaXMgYW4gYWdlbnQgaW4gdGhlIFJDTiBuZXR3b3JrIHRoYXQgc3VwcGxpZXMgYSBjb252ZXJ0aW9uIHJhdGUgYmV0d2VlbiBSQ04gYW5kIGFueSBvdGhlciBjdXJyZW5jeSwKICAgIGl0J3MgcHJpbWFyaWx5IHVzZWQgYnkgdGhlIGV4Y2hhbmdlIGJ1dCBjb3VsZCBiZSB1c2VkIGJ5IGFueSBvdGhlciBhZ2VudC4KKi8KY29udHJhY3QgT3JhY2xlIGlzIE93bmFibGUgewogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVkVSU0lPTiA9IDM7CgogICAgZXZlbnQgTmV3U3ltYm9sKGJ5dGVzMzIgX2N1cnJlbmN5LCBzdHJpbmcgX3RpY2tlcik7CiAgICAKICAgIHN0cnVjdCBTeW1ib2wgewogICAgICAgIHN0cmluZyB0aWNrZXI7CiAgICAgICAgYm9vbCBzdXBwb3J0ZWQ7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyID0+IFN5bWJvbCkgcHVibGljIGN1cnJlbmNpZXM7CgogICAgLyoqCiAgICAgICAgQGRldiBSZXR1cm5zIHRoZSB1cmwgd2hlcmUgdGhlIG9yYWNsZSBleHBvc2VzIGEgdmFsaWQgIm9yYWNsZURhdGEiIGlmIG5lZWRlZAogICAgKi8KICAgIGZ1bmN0aW9uIHVybCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyk7CgogICAgLyoqCiAgICAgICAgQGRldiBSZXR1cm5zIGEgdmFsaWQgY29udmVydGlvbiByYXRlIGZyb20gdGhlIGN1cnJlbmN5IGdpdmVuIHRvIFJDTgoKICAgICAgICBAcGFyYW0gc3ltYm9sIFN5bWJvbCBvZiB0aGUgY3VycmVuY3kKICAgICAgICBAcGFyYW0gZGF0YSBHZW5lcmljIGRhdGEgZmllbGQsIGNvdWxkIGJlIHVzZWQgZm9yIG9mZi1jaGFpbiBzaWduaW5nCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmF0ZShieXRlczMyIHN5bWJvbCwgYnl0ZXMgZGF0YSkgcHVibGljIHJldHVybnMgKHVpbnQyNTYgcmF0ZSwgdWludDI1NiBkZWNpbWFscyk7CgogICAgLyoqCiAgICAgICAgQGRldiBBZGRzIGEgY3VycmVuY3kgdG8gdGhlIG9yYWNsZSwgb25jZSBhZGRlZCBpdCBjYW5ub3QgYmUgcmVtb3ZlZAoKICAgICAgICBAcGFyYW0gdGlja2VyIFN5bWJvbCBvZiB0aGUgY3VycmVuY3kKCiAgICAgICAgQHJldHVybiB0aGUgaGFzaCBvZiB0aGUgY3VycmVuY3ksIGNhbGN1bGF0ZWQga2VjY2FrMjU2KHRpY2tlcikKICAgICovCiAgICBmdW5jdGlvbiBhZGRDdXJyZW5jeShzdHJpbmcgdGlja2VyKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBOZXdTeW1ib2woY3VycmVuY3ksIHRpY2tlcik7CiAgICAgICAgYnl0ZXMzMiBjdXJyZW5jeSA9IGtlY2NhazI1Nih0aWNrZXIpOwogICAgICAgIGN1cnJlbmNpZXNbY3VycmVuY3ldID0gU3ltYm9sKHRpY2tlciwgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIGN1cnJlbmN5OwogICAgfQoKICAgIC8qKgogICAgICAgIEByZXR1cm4gdHJ1ZSBJZiB0aGUgY3VycmVuY3kgaXMgc3VwcG9ydGVkCiAgICAqLwogICAgZnVuY3Rpb24gc3VwcG9ydGVkKGJ5dGVzMzIgc3ltYm9sKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGN1cnJlbmNpZXNbc3ltYm9sXS5zdXBwb3J0ZWQ7CiAgICB9Cn0KCmNvbnRyYWN0IFJwU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCArIHk7CiAgICAgIHJlcXVpcmUoKHogPj0geCkgJiYgKHogPj0geSkpOwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3VidHJhY3QodWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHJlcXVpcmUoeCA+PSB5KTsKICAgICAgdWludDI1NiB6ID0geCAtIHk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVNdWx0KHVpbnQyNTYgeCwgdWludDI1NiB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICB1aW50MjU2IHogPSB4ICogeTsKICAgICAgcmVxdWlyZSgoeCA9PSAwKXx8KHoveCA9PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICBpZiAoYSA8IGIpIHsgCiAgICAgICAgICByZXR1cm4gYTsKICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgIHJldHVybiBiOyAKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG1heCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICBpZiAoYSA+IGIpIHsgCiAgICAgICAgICByZXR1cm4gYTsKICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgIHJldHVybiBiOyAKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuTG9ja2FibGUgaXMgUnBTYWZlTWF0aCwgT3duYWJsZSB7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGxvY2tlZFRva2VuczsKCiAgICAvKioKICAgICAgICBAZGV2IExvY2tlZCB0b2tlbnMgY2Fubm90IGJlIHdpdGhkcmF3biB1c2luZyB0aGUgd2l0aGRyYXdUb2tlbnMgZnVuY3Rpb24uCiAgICAqLwogICAgZnVuY3Rpb24gbG9ja1Rva2VucyhhZGRyZXNzIHRva2VuLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIGxvY2tlZFRva2Vuc1t0b2tlbl0gPSBzYWZlQWRkKGxvY2tlZFRva2Vuc1t0b2tlbl0sIGFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBVbmxvY2tzIHByZXZpdXNseSBsb2NrZWQgdG9rZW5zLgogICAgKi8KICAgIGZ1bmN0aW9uIHVubG9ja1Rva2VucyhhZGRyZXNzIHRva2VuLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIGxvY2tlZFRva2Vuc1t0b2tlbl0gPSBzYWZlU3VidHJhY3QobG9ja2VkVG9rZW5zW3Rva2VuXSwgYW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IFdpdGhkcmF3cyB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QuCgogICAgICAgIEBwYXJhbSB0b2tlbiBUb2tlbiB0byB3aXRoZHJhdwogICAgICAgIEBwYXJhbSB0byBEZXN0aW5hdGlvbiBvZiB0aGUgdG9rZW5zCiAgICAgICAgQHBhcmFtIGFtb3VudCBBbW91bnQgdG8gd2l0aGRyYXcgCiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoVG9rZW4gdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKHNhZmVTdWJ0cmFjdCh0b2tlbi5iYWxhbmNlT2YodGhpcyksIGxvY2tlZFRva2Vuc1t0b2tlbl0pID49IGFtb3VudCk7CiAgICAgICAgcmVxdWlyZSh0byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXR1cm4gdG9rZW4udHJhbnNmZXIodG8sIGFtb3VudCk7CiAgICB9Cn0KCmNvbnRyYWN0IE5hbm9Mb2FuRW5naW5lIGlzIEVSQzcyMSwgRW5naW5lLCBPd25hYmxlLCBUb2tlbkxvY2thYmxlIHsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgUFJFQ0lTSU9OID0gKDEwKioxOCk7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFJDTl9ERUNJTUFMUyA9IDE4OwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFZFUlNJT04gPSAyMTE7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFZFUlNJT05fTkFNRSA9ICJCYXNhbHQiOwoKICAgIHVpbnQyNTYgcHJpdmF0ZSBhY3RpdmVMb2FucyA9IDA7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHJpdmF0ZSBsZW5kZXJzQmFsYW5jZTsKCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIF9uYW1lKSB7CiAgICAgICAgX25hbWUgPSAiUkNOIC0gTmFubyBsb2FuIGVuZ2luZSAtIEJhc2FsdCAyMTEiOwogICAgfQoKICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBfc3ltYm9sKSB7CiAgICAgICAgX3N5bWJvbCA9ICJSQ04tTkxFLTIxMSI7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYWN0aXZlIGxvYW5zIGluIHRvdGFsLCBhY3RpdmUgbG9hbnMgYXJlIHRoZSBsb2FucyB3aXRoICJsZW50IiBzdGF0dXMuCiAgICAgICAgQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCgogICAgICAgIEByZXR1cm4gX3RvdGFsU3VwcGx5IFRvdGFsIGFtb3VudCBvZiBsb2FucwogICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBfdG90YWxTdXBwbHkpIHsKICAgICAgICBfdG90YWxTdXBwbHkgPSBhY3RpdmVMb2FuczsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBhY3RpdmUgbG9hbnMgdGhhdCBhIGxlbmRlciBwb3NzZXNzOyBhY3RpdmUgbG9hbnMgYXJlIHRoZSBsb2FucyB3aXRoICJsZW50IiBzdGF0dXMuCiAgICAgICAgQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCgogICAgICAgIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gc2VhcmNoCiAgICAgICAgCiAgICAgICAgQHJldHVybiBfYmFsYW5jZSBBbW91bnQgb2YgbG9hbnMgIAogICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBfYmFsYW5jZSkgewogICAgICAgIF9iYWxhbmNlID0gbGVuZGVyc0JhbGFuY2VbX293bmVyXTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIE1hcHMgdGhlIGluZGljZXMgb2YgbGVuZGVycyBsb2FucyB0byB0b2tlbnMgaWRzCiAgICAgICAgQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLCBUaGlzIG1ldGhvZCBNVVNUIE5FVkVSIGJlIGNhbGxlZCBieSBzbWFydCBjb250cmFjdCBjb2RlLgogICAgICAgICAgICBpdCB3YWxrcyB0aGUgZW50aXJlIGxvYW5zIGFycmF5LCBhbmQgd2lsbCBwcm9iYWJseSBjcmVhdGUgYSB0cmFuc2FjdGlvbiBiaWdnZXIgdGhhbiB0aGUgZ2FzIGxpbWl0LgoKICAgICAgICBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9pbmRleCBMb2FuIGluZGV4IGZvciB0aGUgb3duZXIKCiAgICAgICAgQHJldHVybiB0b2tlbklkIFJlYWwgdG9rZW4gaWQKICAgICovCiAgICBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHRva2VuSWQpIHsKICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICAgICAgaWYgKHRva2VuQ291bnQgPT0gMCB8fCBfaW5kZXggPj0gdG9rZW5Db3VudCkgewogICAgICAgICAgICAvLyBGYWlsIHRyYW5zYWN0aW9uCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxMb2FucyA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwoKICAgICAgICAgICAgdWludDI1NiBsb2FuSWQ7CgogICAgICAgICAgICBmb3IgKGxvYW5JZCA9IDA7IGxvYW5JZCA8PSB0b3RhbExvYW5zOyBsb2FuSWQrKykgewogICAgICAgICAgICAgICAgaWYgKGxvYW5zW2xvYW5JZF0ubGVuZGVyID09IF9vd25lciAmJiBsb2Fuc1tsb2FuSWRdLnN0YXR1cyA9PSBTdGF0dXMubGVudCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRJbmRleCA9PSBfaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYW5JZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIGxvYW5zIHRoYXQgYSBsZW5kZXIgcG9zc2VzcwogICAgICAgIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZTsgCiAgICAgICAgICAgIGl0IHdhbGtzIHRoZSBlbnRpcmUgbG9hbnMgYXJyYXksIGFuZCB3aWxsIHByb2JhYmx5IGNyZWF0ZSBhIHRyYW5zYWN0aW9uIGJpZ2dlciB0aGFuIHRoZSBnYXMgbGltaXQuCgogICAgICAgIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MKCiAgICAgICAgQHJldHVybiBvd25lclRva2VucyBMaXN0IG9mIGFsbCB0aGUgbG9hbnMgb2YgdGhlIF9vd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICAgICAgaWYgKHRva2VuQ291bnQgPT0gMCkgewogICAgICAgICAgICAvLyBSZXR1cm4gYW4gZW1wdHkgYXJyYXkKICAgICAgICAgICAgcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwogICAgICAgICAgICB1aW50MjU2IHRvdGFsTG9hbnMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIHVpbnQyNTYgbG9hbklkOwoKICAgICAgICAgICAgZm9yIChsb2FuSWQgPSAwOyBsb2FuSWQgPD0gdG90YWxMb2FuczsgbG9hbklkKyspIHsKICAgICAgICAgICAgICAgIGlmIChsb2Fuc1tsb2FuSWRdLmxlbmRlciA9PSBfb3duZXIgJiYgbG9hbnNbbG9hbklkXS5zdGF0dXMgPT0gU3RhdHVzLmxlbnQpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gbG9hbklkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgUmV0dXJucyB0cnVlIGlmIHRoZSBfb3BlcmF0b3IgY2FuIHRyYW5zZmVyIHRoZSBsb2FucyBvZiB0aGUgX293bmVyCgogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZSAKICAgICovCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yQWxsKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9vcGVyYXRvcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBvcGVyYXRvcnNbX293bmVyXVtfb3BlcmF0b3JdOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgUmV0dXJucyB0aGUgbG9hbiBtZXRhZGF0YSwgdGhpcyBmaWVsZCBjYW4gYmUgc2V0IGJ5IHRoZSBjcmVhdG9yIG9mIHRoZSBsb2FuIHdpdGggaGlzIG93biBjcml0ZXJpYS4KCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCgogICAgICAgIEByZXR1cm4gVGhlIHN0cmluZyB3aXRoIHRoZSBtZXRhZGF0YQogICAgKi8KICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIGxvYW5zW2luZGV4XS5tZXRhZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFJldHVybnMgdGhlIGxvYW4gbWV0YWRhdGEsIGhhc2hlZCB3aXRoIGtlY2NhazI1Ni4KICAgICAgICBAZGV2IFRoaXMgZW10aG9kIGlzIHVzZWZ1bCB0byBldmFsdWF0ZSBtZXRhZGF0YSBmcm9tIGEgc21hcnQgY29udHJhY3QuCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIFRoZSBtZXRhZGF0YSBoYXNoZWQgd2l0aCBrZWNjYWsyNTYKICAgICovCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhSGFzaCh1aW50MjU2IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIGtlY2NhazI1Nihsb2Fuc1tpbmRleF0ubWV0YWRhdGEpOwogICAgfQoKICAgIFRva2VuIHB1YmxpYyByY247CiAgICBib29sIHB1YmxpYyBkZXByZWNhdGVkOwoKICAgIGV2ZW50IENyZWF0ZWRMb2FuKHVpbnQgX2luZGV4LCBhZGRyZXNzIF9ib3Jyb3dlciwgYWRkcmVzcyBfY3JlYXRvcik7CiAgICBldmVudCBBcHByb3ZlZEJ5KHVpbnQgX2luZGV4LCBhZGRyZXNzIF9hZGRyZXNzKTsKICAgIGV2ZW50IExlbnQodWludCBfaW5kZXgsIGFkZHJlc3MgX2xlbmRlciwgYWRkcmVzcyBfY29zaWduZXIpOwogICAgZXZlbnQgRGVzdHJveWVkQnkodWludCBfaW5kZXgsIGFkZHJlc3MgX2FkZHJlc3MpOwogICAgZXZlbnQgUGFydGlhbFBheW1lbnQodWludCBfaW5kZXgsIGFkZHJlc3MgX3NlbmRlciwgYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IFRvdGFsUGF5bWVudCh1aW50IF9pbmRleCk7CgogICAgZnVuY3Rpb24gTmFub0xvYW5FbmdpbmUoVG9rZW4gX3JjbikgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgcmNuID0gX3JjbjsKICAgIH0KCiAgICBzdHJ1Y3QgTG9hbiB7CiAgICAgICAgU3RhdHVzIHN0YXR1czsKICAgICAgICBPcmFjbGUgb3JhY2xlOwoKICAgICAgICBhZGRyZXNzIGJvcnJvd2VyOwogICAgICAgIGFkZHJlc3MgbGVuZGVyOwogICAgICAgIGFkZHJlc3MgY3JlYXRvcjsKICAgICAgICBhZGRyZXNzIGNvc2lnbmVyOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3Q7CiAgICAgICAgdWludDI1NiBwdW5pdG9yeUludGVyZXN0OwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RUaW1lc3RhbXA7CiAgICAgICAgdWludDI1NiBwYWlkOwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RSYXRlOwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RSYXRlUHVuaXRvcnk7CiAgICAgICAgdWludDI1NiBkdWVUaW1lOwogICAgICAgIHVpbnQyNTYgZHVlc0luOwoKICAgICAgICBieXRlczMyIGN1cnJlbmN5OwogICAgICAgIHVpbnQyNTYgY2FuY2VsYWJsZUF0OwogICAgICAgIHVpbnQyNTYgbGVuZGVyQmFsYW5jZTsKCiAgICAgICAgYWRkcmVzcyBhcHByb3ZlZFRyYW5zZmVyOwogICAgICAgIHVpbnQyNTYgZXhwaXJhdGlvblJlcXVlc3Q7CgogICAgICAgIHN0cmluZyBtZXRhZGF0YTsKICAgICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgYXBwcm9iYXRpb25zOwogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkpIHByaXZhdGUgb3BlcmF0b3JzOwogICAgTG9hbltdIHByaXZhdGUgbG9hbnM7CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBDcmVhdGVzIGEgbG9hbiByZXF1ZXN0LCB0aGUgbG9hbiBjYW4gYmUgZ2VuZXJhdGVkIHdpdGggYW55IGJvcnJvd2VyIGFuZCBjb25kaXRpb25zOyBpZiB0aGUgYm9ycm93ZXIgYWdyZWVzCiAgICAgICAgaXQgbXVzdCBjYWxsIHRoZSAiYXBwcm92ZSIgZnVuY3Rpb24uIElmIHRoZSBjcmVhdG9yIG9mIHRoZSBsb2FuIGlzIHRoZSBib3Jyb3dlciB0aGUgYXBwcm92ZSBpcyBkb25lIGF1dG9tYXRpY2FsbHkuCgogICAgICAgIEBkZXYgVGhlIGNyZWF0b3Igb2YgdGhlIGxvYW4gaXMgdGhlIGNhbGxlciBvZiB0aGlzIGZ1bmN0aW9uOyB0aGlzIGlzIHVzZWZ1bCB0byB0cmFjayB3aGljaCB3YWxsZXQgY3JlYXRlZCB0aGUgbG9hbi4KCiAgICAgICAgQHBhcmFtIF9vcmFjbGVDb250cmFjdCBBZGRyZXNzIG9mIHRoZSBPcmFjbGUgY29udHJhY3QsIGlmIHRoZSBsb2FuIGRvZXMgbm90IHVzZSBhbnkgb3JhY2xlLCB0aGlzIGZpZWxkIHNob3VsZCBiZSAweDAuCiAgICAgICAgQHBhcmFtIF9ib3Jyb3dlciBBZGRyZXNzIG9mIHRoZSBib3Jyb3dlcgogICAgICAgIEBwYXJhbSBfY3VycmVuY3kgVGhlIGN1cnJlbmN5IHRvIHVzZSB3aXRoIHRoZSBvcmFjbGUsIHRoZSBjdXJyZW5jeSBjb2RlIGlzIGdlbmVyYXRlZCB3aXRoIHRoZSBmb2xsb3dpbmcgZm9ybXVsYSwKICAgICAgICAgICAga2VjY2FrMjU2KHRpY2tlciksIGlzIGFsd2F5cyBzdG9yZWQgYXMgdGhlIG1pbmltdW0gZGl2aXNpYmxlIGFtb3VudC4gKEVqOiBFVEggV2VpLCBVU0QgQ2VudHMpCiAgICAgICAgQHBhcmFtIF9hbW91bnQgVGhlIHJlcXVlc3RlZCBhbW91bnQ7IGN1cnJlbmN5IGFuZCB1bml0IGFyZSBkZWZpbmVkIGJ5IHRoZSBPcmFjbGUsIGlmIHRoZXJlIGlzIG5vIE9yYWNsZSBwcmVzZW50CiAgICAgICAgICAgIHRoZSBjdXJyZW5jeSBpcyBSQ04sIGFuZCB0aGUgdW5pdCBpcyB3ZWkuCiAgICAgICAgQHBhcmFtIF9pbnRlcmVzdFJhdGUgVGhlIG5vbi1wdW5pdG9yeSBpbnRlcmVzdCByYXRlIGJ5IHNlY29uZCwgZGVmaW5lZCBhcyBhIGRlbm9taW5hdG9yIG9mIDEwIDAwMCAwMDAuCiAgICAgICAgQHBhcmFtIF9pbnRlcmVzdFJhdGVQdW5pdG9yeSBUaGUgcHVuaXRvcnkgaW50ZXJlc3QgcmF0ZSBieSBzZWNvbmQsIGRlZmluZWQgYXMgYSBkZW5vbWluYXRvciBvZiAxMCAwMDAgMDAwLgogICAgICAgICAgICBFajogaW50ZXJlc3RSYXRlIDExMTA4NTcxNDI4NTcxID0gMjglIEFudWFsIGludGVyZXN0CiAgICAgICAgQHBhcmFtIF9kdWVzSW4gVGhlIHRpbWUgaW4gc2Vjb25kcyB0aGF0IHRoZSBib3Jyb3dlciBoYXMgaW4gb3JkZXIgdG8gcGF5IHRoZSBkZWJ0IGFmdGVyIHRoZSBsZW5kZXIgbGVuZHMgdGhlIG1vbmV5LgogICAgICAgIEBwYXJhbSBfY2FuY2VsYWJsZUF0IERlbHRhIGluIHNlY29uZHMgc3BlY2lmeWluZyBob3cgbXVjaCBpbnRlcmVzdCBzaG91bGQgYmUgYWRkZWQgaW4gYWR2YW5jZSwgaWYgdGhlIGJvcnJvd2VyIHBheXMgCiAgICAgICAgZW50aXJlbHkgb3IgcGFydGlhbGx5IHRoZSBsb2FuIGJlZm9yZSB0aGlzIHRlcm0sIG5vIGV4dHJhIGludGVyZXN0IHdpbGwgYmUgZGVkdWN0ZWQuCiAgICAgICAgQHBhcmFtIF9leHBpcmF0aW9uUmVxdWVzdCBUaW1lc3RhbXAgb2Ygd2hlbiB0aGUgbG9hbiByZXF1ZXN0IGV4cGlyZXMsIGlmIHRoZSBsb2FuIGlzIG5vdCBmaWxsZWQgYmVmb3JlIHRoaXMgZGF0ZSwgCiAgICAgICAgICAgIHRoZSByZXF1ZXN0IGlzIG5vIGxvbmdlciB2YWxpZC4KICAgICAgICBAcGFyYW0gX21ldGFkYXRhIFN0cmluZyB3aXRoIGxvYW4gbWV0YWRhdGEuCiAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlTG9hbihPcmFjbGUgX29yYWNsZUNvbnRyYWN0LCBhZGRyZXNzIF9ib3Jyb3dlciwgYnl0ZXMzMiBfY3VycmVuY3ksIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfaW50ZXJlc3RSYXRlLAogICAgICAgIHVpbnQyNTYgX2ludGVyZXN0UmF0ZVB1bml0b3J5LCB1aW50MjU2IF9kdWVzSW4sIHVpbnQyNTYgX2NhbmNlbGFibGVBdCwgdWludDI1NiBfZXhwaXJhdGlvblJlcXVlc3QsIHN0cmluZyBfbWV0YWRhdGEpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgogICAgICAgIHJlcXVpcmUoIWRlcHJlY2F0ZWQpOwogICAgICAgIHJlcXVpcmUoX2NhbmNlbGFibGVBdCA8PSBfZHVlc0luKTsKICAgICAgICByZXF1aXJlKF9vcmFjbGVDb250cmFjdCAhPSBhZGRyZXNzKDApIHx8IF9jdXJyZW5jeSA9PSAweDApOwogICAgICAgIHJlcXVpcmUoX2JvcnJvd2VyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2Ftb3VudCAhPSAwKTsKICAgICAgICByZXF1aXJlKF9pbnRlcmVzdFJhdGVQdW5pdG9yeSAhPSAwKTsKICAgICAgICByZXF1aXJlKF9pbnRlcmVzdFJhdGUgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfZXhwaXJhdGlvblJlcXVlc3QgPiBibG9jay50aW1lc3RhbXApOwoKICAgICAgICB2YXIgbG9hbiA9IExvYW4oU3RhdHVzLmluaXRpYWwsIF9vcmFjbGVDb250cmFjdCwgX2JvcnJvd2VyLCAweDAsIG1zZy5zZW5kZXIsIDB4MCwgX2Ftb3VudCwgMCwgMCwgMCwgMCwgX2ludGVyZXN0UmF0ZSwKICAgICAgICAgICAgX2ludGVyZXN0UmF0ZVB1bml0b3J5LCAwLCBfZHVlc0luLCBfY3VycmVuY3ksIF9jYW5jZWxhYmxlQXQsIDAsIDB4MCwgX2V4cGlyYXRpb25SZXF1ZXN0LCBfbWV0YWRhdGEpOwogICAgICAgIHVpbnQgaW5kZXggPSBsb2Fucy5wdXNoKGxvYW4pIC0gMTsKICAgICAgICBDcmVhdGVkTG9hbihpbmRleCwgX2JvcnJvd2VyLCBtc2cuc2VuZGVyKTsKCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX2JvcnJvd2VyKSB7CiAgICAgICAgICAgIGFwcHJvdmVMb2FuKGluZGV4KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpbmRleDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKSB7IG93bmVyID0gbG9hbnNbaW5kZXhdLmxlbmRlcjsgfQogICAgZnVuY3Rpb24gZ2V0VG90YWxMb2FucygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zLmxlbmd0aDsgfQogICAgZnVuY3Rpb24gZ2V0T3JhY2xlKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKE9yYWNsZSkgeyByZXR1cm4gbG9hbnNbaW5kZXhdLm9yYWNsZTsgfQogICAgZnVuY3Rpb24gZ2V0Qm9ycm93ZXIodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmJvcnJvd2VyOyB9CiAgICBmdW5jdGlvbiBnZXRDb3NpZ25lcih1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBsb2Fuc1tpbmRleF0uY29zaWduZXI7IH0KICAgIGZ1bmN0aW9uIGdldENyZWF0b3IodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmNyZWF0b3I7IH0KICAgIGZ1bmN0aW9uIGdldEFtb3VudCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uYW1vdW50OyB9CiAgICBmdW5jdGlvbiBnZXRQdW5pdG9yeUludGVyZXN0KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5wdW5pdG9yeUludGVyZXN0OyB9CiAgICBmdW5jdGlvbiBnZXRJbnRlcmVzdFRpbWVzdGFtcCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uaW50ZXJlc3RUaW1lc3RhbXA7IH0KICAgIGZ1bmN0aW9uIGdldFBhaWQodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLnBhaWQ7IH0KICAgIGZ1bmN0aW9uIGdldEludGVyZXN0UmF0ZSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uaW50ZXJlc3RSYXRlOyB9CiAgICBmdW5jdGlvbiBnZXRJbnRlcmVzdFJhdGVQdW5pdG9yeSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uaW50ZXJlc3RSYXRlUHVuaXRvcnk7IH0KICAgIGZ1bmN0aW9uIGdldER1ZVRpbWUodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmR1ZVRpbWU7IH0KICAgIGZ1bmN0aW9uIGdldER1ZXNJbih1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uZHVlc0luOyB9CiAgICBmdW5jdGlvbiBnZXRDYW5jZWxhYmxlQXQodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmNhbmNlbGFibGVBdDsgfQogICAgZnVuY3Rpb24gZ2V0QXBwcm9iYXRpb24odWludCBpbmRleCwgYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmFwcHJvYmF0aW9uc1tfYWRkcmVzc107IH0KICAgIGZ1bmN0aW9uIGdldFN0YXR1cyh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChTdGF0dXMpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5zdGF0dXM7IH0KICAgIGZ1bmN0aW9uIGdldExlbmRlckJhbGFuY2UodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmxlbmRlckJhbGFuY2U7IH0KICAgIGZ1bmN0aW9uIGdldEFwcHJvdmVkKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHtyZXR1cm4gbG9hbnNbaW5kZXhdLmFwcHJvdmVkVHJhbnNmZXI7IH0KICAgIGZ1bmN0aW9uIGdldEN1cnJlbmN5KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5jdXJyZW5jeTsgfQogICAgZnVuY3Rpb24gZ2V0RXhwaXJhdGlvblJlcXVlc3QodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmV4cGlyYXRpb25SZXF1ZXN0OyB9CiAgICBmdW5jdGlvbiBnZXRJbnRlcmVzdCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uaW50ZXJlc3Q7IH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFVzZWQgdG8ga25vdyBpZiBhIGxvYW4gaXMgcmVhZHkgdG8gbGVuZAoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSBsb2FuIGhhcyBiZWVuIGFwcHJvdmVkIGJ5IHRoZSBib3Jyb3dlciBhbmQgY29zaWduZXIuCiAgICAqLwogICAgZnVuY3Rpb24gaXNBcHByb3ZlZCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CiAgICAgICAgcmV0dXJuIGxvYW4uYXBwcm9iYXRpb25zW2xvYW4uYm9ycm93ZXJdOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgQ2FsbGVkIGJ5IHRoZSBtZW1iZXJzIG9mIHRoZSBsb2FuIHRvIHNob3cgdGhhdCB0aGV5IGFncmVlIHdpdGggdGhlIHRlcm1zIG9mIHRoZSBsb2FuOyB0aGUgYm9ycm93ZXIKICAgICAgICBtdXN0IGNhbGwgdGhpcyBtZXRob2QgYmVmb3JlIGFueSBsZW5kZXIgY291bGQgY2FsbCB0aGUgbWV0aG9kICJsZW5kIi4KICAgICAgICAgICAgCiAgICAgICAgQGRldiBBbnkgYWRkcmVzcyBjYW4gY2FsbCB0aGlzIG1ldGhvZCB0byBiZSBhZGRlZCB0byB0aGUgImFwcHJvYmF0aW9ucyIgbWFwcGluZy4KCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgYXBwcm92ZSB3YXMgZG9uZSBzdWNjZXNzZnVsbHkKICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlTG9hbih1aW50IGluZGV4KSBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CiAgICAgICAgcmVxdWlyZShsb2FuLnN0YXR1cyA9PSBTdGF0dXMuaW5pdGlhbCk7CiAgICAgICAgbG9hbi5hcHByb2JhdGlvbnNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIEFwcHJvdmVkQnkoaW5kZXgsIG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgUGVyZm9ybXMgdGhlIGxlbmQgb2YgdGhlIFJDTiBlcXVpdmFsZW50IHRvIHRoZSByZXF1ZXN0ZWQgYW1vdW50LCBhbmQgdHJhbnNmb3JtcyB0aGUgbXNnLnNlbmRlciBpbiB0aGUgbmV3IGxlbmRlci4KCiAgICAgICAgQGRldiBUaGUgbG9hbiBtdXN0IGJlIHByZXZpb3VzbHkgYXBwcm92ZWQgYnkgdGhlIGJvcnJvd2VyOyBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uLCB0aGUgbGVuZGVyIGNhbmRpZGF0ZSBtdXN0IAogICAgICAgIGNhbGwgdGhlICJhcHByb3ZlIiBmdW5jdGlvbiBvbiB0aGUgUkNOIFRva2VuLCBzcGVjaWZ5aW5nIGFuIGFtb3VudCBzdWZmaWNpZW50IGVub3VnaCB0byBwYXkgdGhlIGVxdWl2YWxlbnQgb2YKICAgICAgICB0aGUgcmVxdWVzdGVkIGFtb3VudCwgYW5kIHRoZSBjb3NpZ25lciBmZWUuCiAgICAgICAgCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCiAgICAgICAgQHBhcmFtIG9yYWNsZURhdGEgRGF0YSByZXF1aXJlZCBieSB0aGUgb3JhY2xlIHRvIHJldHVybiB0aGUgcmF0ZSwgdGhlIGNvbnRlbnQgb2YgdGhpcyBmaWVsZCBtdXN0IGJlIHByb3ZpZGVkCiAgICAgICAgICAgIGJ5IHRoZSB1cmwgZXhwb3NlZCBpbiB0aGUgdXJsKCkgbWV0aG9kIG9mIHRoZSBvcmFjbGUuCiAgICAgICAgQHBhcmFtIGNvc2lnbmVyIEFkZHJlc3Mgb2YgdGhlIGNvc2lnbmVyLCAweDAgZm9yIGxlbmRpbmcgd2l0aG91dCBjb3NpZ25lci4KICAgICAgICBAcGFyYW0gY29zaWduZXJEYXRhIERhdGEgcmVxdWlyZWQgYnkgdGhlIGNvc2lnbmVyIHRvIHByb2Nlc3MgdGhlIHJlcXVlc3QuCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgbGVuZCB3YXMgZG9uZSBzdWNjZXNzZnVsbHkKICAgICovCiAgICBmdW5jdGlvbiBsZW5kKHVpbnQgaW5kZXgsIGJ5dGVzIG9yYWNsZURhdGEsIENvc2lnbmVyIGNvc2lnbmVyLCBieXRlcyBjb3NpZ25lckRhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CgogICAgICAgIHJlcXVpcmUobG9hbi5zdGF0dXMgPT0gU3RhdHVzLmluaXRpYWwpOwogICAgICAgIHJlcXVpcmUoaXNBcHByb3ZlZChpbmRleCkpOwogICAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDw9IGxvYW4uZXhwaXJhdGlvblJlcXVlc3QpOwoKICAgICAgICBsb2FuLmxlbmRlciA9IG1zZy5zZW5kZXI7CiAgICAgICAgbG9hbi5kdWVUaW1lID0gc2FmZUFkZChibG9jay50aW1lc3RhbXAsIGxvYW4uZHVlc0luKTsKICAgICAgICBsb2FuLmludGVyZXN0VGltZXN0YW1wID0gYmxvY2sudGltZXN0YW1wOwogICAgICAgIGxvYW4uc3RhdHVzID0gU3RhdHVzLmxlbnQ7CgogICAgICAgIC8vIEVSQzcyMSwgY3JlYXRlIG5ldyBsb2FuIGFuZCB0cmFuc2ZlciBpdCB0byB0aGUgbGVuZGVyCiAgICAgICAgVHJhbnNmZXIoMHgwLCBsb2FuLmxlbmRlciwgaW5kZXgpOwogICAgICAgIGFjdGl2ZUxvYW5zICs9IDE7CiAgICAgICAgbGVuZGVyc0JhbGFuY2VbbG9hbi5sZW5kZXJdICs9IDE7CiAgICAgICAgCiAgICAgICAgaWYgKGxvYW4uY2FuY2VsYWJsZUF0ID4gMCkKICAgICAgICAgICAgaW50ZXJuYWxBZGRJbnRlcmVzdChsb2FuLCBzYWZlQWRkKGJsb2NrLnRpbWVzdGFtcCwgbG9hbi5jYW5jZWxhYmxlQXQpKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIG1vbmV5IHRvIHRoZSBib3Jyb3dlciBiZWZvcmUgaGFuZGxpbmcgdGhlIGNvc2lnbmVyCiAgICAgICAgLy8gc28gdGhlIGNvc2lnbmVyIGNvdWxkIHJlcXVpcmUgYSBzcGVjaWZpYyB1c2FnZSBmb3IgdGhhdCBtb25leS4KICAgICAgICB1aW50MjU2IHRyYW5zZmVyVmFsdWUgPSBjb252ZXJ0UmF0ZShsb2FuLm9yYWNsZSwgbG9hbi5jdXJyZW5jeSwgb3JhY2xlRGF0YSwgbG9hbi5hbW91bnQpOwogICAgICAgIHJlcXVpcmUocmNuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBsb2FuLmJvcnJvd2VyLCB0cmFuc2ZlclZhbHVlKSk7CiAgICAgICAgCiAgICAgICAgaWYgKGNvc2lnbmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgLy8gVGhlIGNvc2lnbmVyIGl0J3MgdGVtcG9yYXJ5IHNldCB0byB0aGUgbmV4dCBhZGRyZXNzIChjb3NpZ25lciArIDIpLCBpdCdzIGV4cGVjdGVkIHRoYXQgdGhlIGNvc2lnbmVyIHdpbGwKICAgICAgICAgICAgLy8gY2FsbCB0aGUgbWV0aG9kICJjb3NpZ24iIHRvIGFjY2VwdCB0aGUgY29uZGl0aW9uczsgdGhhdCBtZXRob2QgYWxzbyBzZXRzIHRoZSBjb3NpZ25lciB0byB0aGUgcmlnaHQKICAgICAgICAgICAgLy8gYWRkcmVzcy4gSWYgdGhhdCBkb2VzIG5vdCBoYXBwZW4sIHRoZSB0cmFuc2FjdGlvbiBmYWlscy4KICAgICAgICAgICAgbG9hbi5jb3NpZ25lciA9IGFkZHJlc3ModWludDI1Nihjb3NpZ25lcikgKyAyKTsKICAgICAgICAgICAgcmVxdWlyZShjb3NpZ25lci5yZXF1ZXN0Q29zaWduKHRoaXMsIGluZGV4LCBjb3NpZ25lckRhdGEsIG9yYWNsZURhdGEpKTsKICAgICAgICAgICAgcmVxdWlyZShsb2FuLmNvc2lnbmVyID09IGFkZHJlc3MoY29zaWduZXIpKTsKICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICBMZW50KGluZGV4LCBsb2FuLmxlbmRlciwgY29zaWduZXIpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFRoZSBjb3NpZ25lciBtdXN0IGNhbGwgdGhpcyBtZXRob2QgdG8gYWNjZXB0IHRoZSBjb25kaXRpb25zIG9mIGEgbG9hbiwgdGhpcyBtZXRob2QgcGF5cyB0aGUgY29zaWduZXIgaGlzIGZlZS4KICAgICAgICAKICAgICAgICBAZGV2IElmIHRoZSBjb3NpZ25lciBkb2VzIG5vdCBjYWxsIHRoaXMgbWV0aG9kIHRoZSB3aG9sZSAibGVuZCIgY2FsbCBmYWlscy4KCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCiAgICAgICAgQHBhcmFtIGNvc3QgRmVlIHNldCBieSB0aGUgY29zaWduZXIKCiAgICAgICAgQHJldHVybiB0cnVlIElmIHRoZSBjb3NpZ24gd2FzIHN1Y2Nlc3NmdWxsCiAgICAqLwogICAgZnVuY3Rpb24gY29zaWduKHVpbnQgaW5kZXgsIHVpbnQyNTYgY29zdCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIHJlcXVpcmUobG9hbi5zdGF0dXMgPT0gU3RhdHVzLmxlbnQgJiYgKGxvYW4uZHVlVGltZSAtIGxvYW4uZHVlc0luKSA9PSBibG9jay50aW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUobG9hbi5jb3NpZ25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGxvYW4uY29zaWduZXIgPT0gYWRkcmVzcyh1aW50MjU2KG1zZy5zZW5kZXIpICsgMikpOwogICAgICAgIGxvYW4uY29zaWduZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUocmNuLnRyYW5zZmVyRnJvbShsb2FuLmxlbmRlciwgbXNnLnNlbmRlciwgY29zdCkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgRGVzdHJveXMgYSBsb2FuLCB0aGUgYm9ycm93ZXIgY291bGQgY2FsbCB0aGlzIG1ldGhvZCBpZiB0aGV5IHBlcmZvcm1lZCBhbiBhY2NpZGVudGFsIG9yIHJlZ3JldHRlZCAKICAgICAgICAiYXBwcm92ZSIgb2YgdGhlIGxvYW4sIHRoaXMgbWV0aG9kIG9ubHkgd29ya3MgZm9yIHRoZW0gaWYgdGhlIGxvYW4gaXMgaW4gInBlbmRpbmciIHN0YXR1cy4KCiAgICAgICAgVGhlIGxlbmRlciBjYW4gY2FsbCB0aGlzIG1ldGhvZCBhdCBhbnkgbW9tZW50LCBpbiBjYXNlIG9mIGEgbG9hbiB3aXRoIHN0YXR1cyAibGVudCIgdGhlIGxlbmRlciBpcyBwYXJkb25pbmcgCiAgICAgICAgdGhlIGRlYnQuIAoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSBkZXN0cm95IHdhcyBkb25lIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGRlc3Ryb3kodWludCBpbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2luZGV4XTsKICAgICAgICByZXF1aXJlKGxvYW4uc3RhdHVzICE9IFN0YXR1cy5kZXN0cm95ZWQpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBsb2FuLmxlbmRlciB8fCAobXNnLnNlbmRlciA9PSBsb2FuLmJvcnJvd2VyICYmIGxvYW4uc3RhdHVzID09IFN0YXR1cy5pbml0aWFsKSk7CiAgICAgICAgRGVzdHJveWVkQnkoaW5kZXgsIG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBFUkM3MjEsIHJlbW92ZSBsb2FuIGZyb20gY2lyY3VsYXRpb24KICAgICAgICBpZiAobG9hbi5zdGF0dXMgIT0gU3RhdHVzLmluaXRpYWwpIHsKICAgICAgICAgICAgbGVuZGVyc0JhbGFuY2VbbG9hbi5sZW5kZXJdIC09IDE7CiAgICAgICAgICAgIGFjdGl2ZUxvYW5zIC09IDE7CiAgICAgICAgICAgIFRyYW5zZmVyKGxvYW4ubGVuZGVyLCAweDAsIGluZGV4KTsKICAgICAgICB9CgogICAgICAgIGxvYW4uc3RhdHVzID0gU3RhdHVzLmRlc3Ryb3llZDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFRyYW5zZmVycyBhIGxvYW4gdG8gYSBkaWZmZXJlbnQgbGVuZGVyLCB0aGUgY2FsbGVyIG11c3QgYmUgdGhlIGN1cnJlbnQgbGVuZGVyIG9yIHByZXZpb3VzbHkgYmVpbmcKICAgICAgICBhcHByb3ZlZCB3aXRoIHRoZSBtZXRob2QgImFwcHJvdmVUcmFuc2ZlciI7IG9ubHkgbG9hbnMgd2l0aCB0aGUgU3RhdHVzLmxlbnQgc3RhdHVzIGNhbiBiZSB0cmFuc2ZlcmVkLgoKICAgICAgICBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCiAgICAgICAgQHBhcmFtIHRvIE5ldyBsZW5kZXIKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgZG9uZSBzdWNjZXNzZnVsbHkKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIAogICAgICAgIHJlcXVpcmUobG9hbi5zdGF0dXMgIT0gU3RhdHVzLmRlc3Ryb3llZCAmJiBsb2FuLnN0YXR1cyAhPSBTdGF0dXMucGFpZCk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGxvYW4ubGVuZGVyIHx8IG1zZy5zZW5kZXIgPT0gbG9hbi5hcHByb3ZlZFRyYW5zZmVyIHx8IG9wZXJhdG9yc1tsb2FuLmxlbmRlcl1bbXNnLnNlbmRlcl0pOwogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgbG9hbi5sZW5kZXIgPSB0bzsKICAgICAgICBsb2FuLmFwcHJvdmVkVHJhbnNmZXIgPSBhZGRyZXNzKDApOwoKICAgICAgICAvLyBFUkM3MjEsIHRyYW5zZmVyIGxvYW4gdG8gYW5vdGhlciBhZGRyZXNzCiAgICAgICAgbGVuZGVyc0JhbGFuY2VbbXNnLnNlbmRlcl0gLT0gMTsKICAgICAgICBsZW5kZXJzQmFsYW5jZVt0b10gKz0gMTsKICAgICAgICBUcmFuc2Zlcihsb2FuLmxlbmRlciwgdG8sIGluZGV4KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBUcmFuc2ZlcnMgdGhlIGxvYW4gdG8gdGhlIG1zZy5zZW5kZXIsIHRoZSBtc2cuc2VuZGVyIG11c3QgYmUgYXBwcm92ZWQgdXNpbmcgdGhlICJhcHByb3ZlIiBtZXRob2QuCgogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQoKICAgICAgICBAcGFyYW0gX2luZGV4IEluZGV4IG9mIHRoZSBsb2FuCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWxsCiAgICAqLwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF9pbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXIobXNnLnNlbmRlciwgX2luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFRyYW5zZmVycyB0aGUgbG9hbiB0byBhbiBhZGRyZXNzLCBvbmx5IGlmIHRoZSBjdXJyZW50IG93bmVyIGlzIHRoZSAiZnJvbSIgYWRkcmVzcwoKICAgICAgICBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKCiAgICAgICAgQHBhcmFtIGZyb20gQ3VycmVudCBvd25lciBvZiB0aGUgbG9hbgogICAgICAgIEBwYXJhbSB0byBOZXcgb3duZXIgb2YgdGhlIGxvYW4KICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bGwKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobG9hbnNbaW5kZXhdLmxlbmRlciA9PSBmcm9tKTsKICAgICAgICByZXR1cm4gdHJhbnNmZXIodG8sIGluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIEFwcHJvdmVzIHRoZSB0cmFuc2ZlciBvZiBhIGdpdmVuIGxvYW4gaW4gdGhlIG5hbWUgb2YgdGhlIGxlbmRlciwgdGhlIGJlaGF2aW9yIG9mIHRoaXMgZnVuY3Rpb24gaXMgc2ltaWxhciB0bwogICAgICAgICJhcHByb3ZlIiBpbiB0aGUgRVJDMjAgc3RhbmRhcmQsIGJ1dCBvbmx5IG9uZSBhcHByb3ZlZCBhZGRyZXNzIGlzIGFsbG93ZWQgYXQgYSB0aW1lLgoKICAgICAgICBUaGUgc2FtZSBtZXRob2QgY2FuIGJlIGNhbGxlZCBwYXNzaW5nIDB4MCBhcyBwYXJhbWV0ZXIgInRvIiB0byBlcmFzZSBhIHByZXZpb3VzbHkgYXBwcm92ZWQgYWRkcmVzcy4KCiAgICAgICAgQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCgogICAgICAgIEBwYXJhbSB0byBBZGRyZXNzIGFsbG93ZWQgdG8gdHJhbnNmZXIgdGhlIGxvYW4gb3IgMHgwIHRvIGRlbGV0ZQogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGFwcHJvdmUgd2FzIGRvbmUgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHRvLCB1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBsb2FuLmxlbmRlcik7CiAgICAgICAgbG9hbi5hcHByb3ZlZFRyYW5zZmVyID0gdG87CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgdG8sIGluZGV4KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIEVuYWJsZSBvciBkaXNhYmxlIGFwcHJvdmFsIGZvciBhIHRoaXJkIHBhcnR5ICgib3BlcmF0b3IiKSB0byBtYW5hZ2UKCiAgICAgICAgQHBhcmFtIF9hcHByb3ZlZCBUcnVlIGlmIHRoZSBvcGVyYXRvciBpcyBhcHByb3ZlZCwgZmFsc2UgdG8gcmV2b2tlIGFwcHJvdmFsCiAgICAgICAgQHBhcmFtIF9vcGVyYXRvciBBZGRyZXNzIHRvIGFkZCB0byB0aGUgc2V0IG9mIGF1dGhvcml6ZWQgb3BlcmF0b3JzLgogICAgKi8KICAgIGZ1bmN0aW9uIHNldEFwcHJvdmFsRm9yQWxsKGFkZHJlc3MgX29wZXJhdG9yLCBib29sIF9hcHByb3ZlZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBvcGVyYXRvcnNbbXNnLnNlbmRlcl1bX29wZXJhdG9yXSA9IF9hcHByb3ZlZDsKICAgICAgICBBcHByb3ZhbEZvckFsbChtc2cuc2VuZGVyLCBfb3BlcmF0b3IsIF9hcHByb3ZlZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBSZXR1cm5zIHRoZSBwZW5kaW5nIGFtb3VudCB0byBjb21wbGV0ZSBkZSBwYXltZW50IG9mIHRoZSBsb2FuLCBrZWVwIGluIG1pbmQgdGhhdCB0aGlzIG51bWJlciBpbmNyZWFzZXMgCiAgICAgICAgZXZlcnkgc2Vjb25kLgoKICAgICAgICBAZGV2IFRoaXMgbWV0aG9kIGFsc28gY29tcHV0ZXMgdGhlIGludGVyZXN0IGFuZCB1cGRhdGVzIHRoZSBsb2FuCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIEFwcm94IHBlbmRpbmcgcGF5bWVudCBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRQZW5kaW5nQW1vdW50KHVpbnQgaW5kZXgpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYWRkSW50ZXJlc3QoaW5kZXgpOwogICAgICAgIHJldHVybiBnZXRSYXdQZW5kaW5nQW1vdW50KGluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFJldHVybnMgdGhlIHBlbmRpbmcgYW1vdW50IHVwIHRvIHRoZSBsYXN0IHRpbWUgb2YgdGhlIGludGVyZXN0IHVwZGF0ZS4gVGhpcyBpcyBub3QgdGhlIHJlYWwgcGVuZGluZyBhbW91bnQKCiAgICAgICAgQGRldiBUaGlzIG1ldGhvZCBpcyBleGFjdCBvbmx5IGlmICJhZGRJbnRlcmVzdChsb2FuKSIgd2FzIGJlZm9yZSBhbmQgaW4gdGhlIHNhbWUgYmxvY2suCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIFRoZSBwYXN0IHBlbmRpbmcgYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmF3UGVuZGluZ0Ftb3VudCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgTG9hbiBtZW1vcnkgbG9hbiA9IGxvYW5zW2luZGV4XTsKICAgICAgICByZXR1cm4gc2FmZVN1YnRyYWN0KHNhZmVBZGQoc2FmZUFkZChsb2FuLmFtb3VudCwgbG9hbi5pbnRlcmVzdCksIGxvYW4ucHVuaXRvcnlJbnRlcmVzdCksIGxvYW4ucGFpZCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBpbnRlcmVzdCBvZiBhIGdpdmVuIGFtb3VudCwgaW50ZXJlc3QgcmF0ZSBhbmQgZGVsdGEgdGltZS4KCiAgICAgICAgQHBhcmFtIHRpbWVEZWx0YSBFbGFwc2VkIHRpbWUKICAgICAgICBAcGFyYW0gaW50ZXJlc3RSYXRlIEludGVyZXN0IHJhdGUgZXhwcmVzc2VkIGFzIHRoZSBkZW5vbWluYXRvciBvZiAxMCAwMDAgMDAwLgogICAgICAgIEBwYXJhbSBhbW91bnQgQW1vdW50IHRvIGFwcGx5IGludGVyZXN0CgogICAgICAgIEByZXR1cm4gcmVhbERlbHRhIFRoZSByZWFsIHRpbWVEZWx0YSBhcHBsaWVkCiAgICAgICAgQHJldHVybiBpbnRlcmVzdCBUaGUgaW50ZXJlc3QgZ2FpbmVkIGluIHRoZSByZWFsRGVsdGEgdGltZQogICAgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUludGVyZXN0KHVpbnQyNTYgdGltZURlbHRhLCB1aW50MjU2IGludGVyZXN0UmF0ZSwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NiByZWFsRGVsdGEsIHVpbnQyNTYgaW50ZXJlc3QpIHsKICAgICAgICBpZiAoYW1vdW50ID09IDApIHsKICAgICAgICAgICAgaW50ZXJlc3QgPSAwOwogICAgICAgICAgICByZWFsRGVsdGEgPSB0aW1lRGVsdGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW50ZXJlc3QgPSBzYWZlTXVsdChzYWZlTXVsdCgxMDAwMDAsIGFtb3VudCksIHRpbWVEZWx0YSkgLyBpbnRlcmVzdFJhdGU7CiAgICAgICAgICAgIHJlYWxEZWx0YSA9IHNhZmVNdWx0KGludGVyZXN0LCBpbnRlcmVzdFJhdGUpIC8gKGFtb3VudCAqIDEwMDAwMCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgQ29tcHV0ZXMgbG9hbiBpbnRlcmVzdAoKICAgICAgICBDb21wdXRlcyB0aGUgcHVuaXRvcnkgYW5kIG5vbi1wdW5pdG9yeSBpbnRlcmVzdCBvZiBhIGdpdmVuIGxvYW4gYW5kIG9ubHkgYXBwbGllcyB0aGUgY2hhbmdlLgogICAgICAgIAogICAgICAgIEBwYXJhbSBsb2FuIExvYW4gdG8gY29tcHV0ZSBpbnRlcmVzdAogICAgICAgIEBwYXJhbSB0aW1lc3RhbXAgVGFyZ2V0IGFic29sdXRlIHVuaXggdGltZSB0byBjYWxjdWxhdGUgaW50ZXJlc3QuCiAgICAqLwogICAgZnVuY3Rpb24gaW50ZXJuYWxBZGRJbnRlcmVzdChMb2FuIHN0b3JhZ2UgbG9hbiwgdWludDI1NiB0aW1lc3RhbXApIGludGVybmFsIHsKICAgICAgICBpZiAodGltZXN0YW1wID4gbG9hbi5pbnRlcmVzdFRpbWVzdGFtcCkgewogICAgICAgICAgICB1aW50MjU2IG5ld0ludGVyZXN0ID0gbG9hbi5pbnRlcmVzdDsKICAgICAgICAgICAgdWludDI1NiBuZXdQdW5pdG9yeUludGVyZXN0ID0gbG9hbi5wdW5pdG9yeUludGVyZXN0OwoKICAgICAgICAgICAgdWludDI1NiBuZXdUaW1lc3RhbXA7CiAgICAgICAgICAgIHVpbnQyNTYgcmVhbERlbHRhOwogICAgICAgICAgICB1aW50MjU2IGNhbGN1bGF0ZWRJbnRlcmVzdDsKCiAgICAgICAgICAgIHVpbnQyNTYgZGVsdGFUaW1lOwogICAgICAgICAgICB1aW50MjU2IHBlbmRpbmc7CgogICAgICAgICAgICB1aW50MjU2IGVuZE5vblB1bml0b3J5ID0gbWluKHRpbWVzdGFtcCwgbG9hbi5kdWVUaW1lKTsKICAgICAgICAgICAgaWYgKGVuZE5vblB1bml0b3J5ID4gbG9hbi5pbnRlcmVzdFRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgZGVsdGFUaW1lID0gZW5kTm9uUHVuaXRvcnkgLSBsb2FuLmludGVyZXN0VGltZXN0YW1wOwoKICAgICAgICAgICAgICAgIGlmIChsb2FuLnBhaWQgPCBsb2FuLmFtb3VudCkgewogICAgICAgICAgICAgICAgICAgIHBlbmRpbmcgPSBsb2FuLmFtb3VudCAtIGxvYW4ucGFpZDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcGVuZGluZyA9IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgKHJlYWxEZWx0YSwgY2FsY3VsYXRlZEludGVyZXN0KSA9IGNhbGN1bGF0ZUludGVyZXN0KGRlbHRhVGltZSwgbG9hbi5pbnRlcmVzdFJhdGUsIHBlbmRpbmcpOwogICAgICAgICAgICAgICAgbmV3SW50ZXJlc3QgPSBzYWZlQWRkKGNhbGN1bGF0ZWRJbnRlcmVzdCwgbmV3SW50ZXJlc3QpOwogICAgICAgICAgICAgICAgbmV3VGltZXN0YW1wID0gbG9hbi5pbnRlcmVzdFRpbWVzdGFtcCArIHJlYWxEZWx0YTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRpbWVzdGFtcCA+IGxvYW4uZHVlVGltZSkgewogICAgICAgICAgICAgICAgdWludDI1NiBzdGFydFB1bml0b3J5ID0gbWF4KGxvYW4uZHVlVGltZSwgbG9hbi5pbnRlcmVzdFRpbWVzdGFtcCk7CiAgICAgICAgICAgICAgICBkZWx0YVRpbWUgPSB0aW1lc3RhbXAgLSBzdGFydFB1bml0b3J5OwoKICAgICAgICAgICAgICAgIHVpbnQyNTYgZGVidCA9IHNhZmVBZGQobG9hbi5hbW91bnQsIG5ld0ludGVyZXN0KTsKICAgICAgICAgICAgICAgIHBlbmRpbmcgPSBtaW4oZGVidCwgc2FmZVN1YnRyYWN0KHNhZmVBZGQoZGVidCwgbmV3UHVuaXRvcnlJbnRlcmVzdCksIGxvYW4ucGFpZCkpOwoKICAgICAgICAgICAgICAgIChyZWFsRGVsdGEsIGNhbGN1bGF0ZWRJbnRlcmVzdCkgPSBjYWxjdWxhdGVJbnRlcmVzdChkZWx0YVRpbWUsIGxvYW4uaW50ZXJlc3RSYXRlUHVuaXRvcnksIHBlbmRpbmcpOwogICAgICAgICAgICAgICAgbmV3UHVuaXRvcnlJbnRlcmVzdCA9IHNhZmVBZGQobmV3UHVuaXRvcnlJbnRlcmVzdCwgY2FsY3VsYXRlZEludGVyZXN0KTsKICAgICAgICAgICAgICAgIG5ld1RpbWVzdGFtcCA9IHN0YXJ0UHVuaXRvcnkgKyByZWFsRGVsdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChuZXdJbnRlcmVzdCAhPSBsb2FuLmludGVyZXN0IHx8IG5ld1B1bml0b3J5SW50ZXJlc3QgIT0gbG9hbi5wdW5pdG9yeUludGVyZXN0KSB7CiAgICAgICAgICAgICAgICBsb2FuLmludGVyZXN0VGltZXN0YW1wID0gbmV3VGltZXN0YW1wOwogICAgICAgICAgICAgICAgbG9hbi5pbnRlcmVzdCA9IG5ld0ludGVyZXN0OwogICAgICAgICAgICAgICAgbG9hbi5wdW5pdG9yeUludGVyZXN0ID0gbmV3UHVuaXRvcnlJbnRlcmVzdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFVwZGF0ZXMgdGhlIGxvYW4gYWNjdW11bGF0ZWQgaW50ZXJlc3RzIHVwIHRvIHRoZSBjdXJyZW50IFVuaXggdGltZS4KICAgICAgICAKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KICAgIAogICAgICAgIEByZXR1cm4gdHJ1ZSBJZiB0aGUgaW50ZXJlc3Qgd2FzIHVwZGF0ZWQKICAgICovCiAgICBmdW5jdGlvbiBhZGRJbnRlcmVzdCh1aW50IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIHJlcXVpcmUobG9hbi5zdGF0dXMgPT0gU3RhdHVzLmxlbnQpOwogICAgICAgIGludGVybmFsQWRkSW50ZXJlc3QobG9hbiwgYmxvY2sudGltZXN0YW1wKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgICAgQG5vdGljZSBQYXkgbG9hbgoKICAgICAgICBEb2VzIGEgcGF5bWVudCBvZiBhIGdpdmVuIExvYW4sIGJlZm9yZSBwZXJmb3JtaW5nIHRoZSBwYXltZW50IHRoZSBhY2N1bXVsYXRlZAogICAgICAgIGludGVyZXN0IGlzIGNvbXB1dGVkIGFuZCBhZGRlZCB0byB0aGUgdG90YWwgcGVuZGluZyBhbW91bnQuCgogICAgICAgIEJlZm9yZSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24sIHRoZSBtc2cuc2VuZGVyIG11c3QgY2FsbCB0aGUgImFwcHJvdmUiIGZ1bmN0aW9uIG9uIHRoZSBSQ04gVG9rZW4sIHNwZWNpZnlpbmcgYW4gYW1vdW50CiAgICAgICAgc3VmZmljaWVudCBlbm91Z2ggdG8gcGF5IHRoZSBlcXVpdmFsZW50IG9mIHRoZSBkZXNpcmVkIHBheW1lbnQgYW5kIHRoZSBvcmFjbGUgZmVlLgoKICAgICAgICBJZiB0aGUgcGFpZCBwZW5kaW5nIGFtb3VudCBlcXVhbHMgemVybywgdGhlIGxvYW4gY2hhbmdlcyBzdGF0dXMgdG8gInBhaWQiIGFuZCBpdCBpcyBjb25zaWRlcmVkIGNsb3NlZC4KCiAgICAgICAgQGRldiBCZWNhdXNlIGl0IGlzIGRpZmZpY3VsdCBvciBldmVuIGltcG9zc2libGUgdG8ga25vdyBpbiBhZHZhbmNlIGhvdyBtdWNoIFJDTiBhcmUgZ29pbmcgdG8gYmUgc3BlbnQgb24gdGhlCiAgICAgICAgdHJhbnNhY3Rpb24qLCB3ZSByZWNvbW1lbmQgcGVyZm9ybWluZyB0aGUgImFwcHJvdmUiIHVzaW5nIGFuIGFtb3VudCA1JSBzdXBlcmlvciB0byB0aGUgd2FsbGV0IGVzdGltYXRlZAogICAgICAgIHNwZW5kaW5nLiBJZiB0aGUgUkNOIHNwZW50IHJlc3VsdHMgdG8gYmUgbGVzcywgdGhlIGV4dHJhIHRva2VucyBhcmUgbmV2ZXIgZGViaXRlZCBmcm9tIHRoZSBtc2cuc2VuZGVyLgoKICAgICAgICAqIFRoZSBSQ04gcmF0ZSBjYW4gZmx1Y3R1YXRlIG9uIHRoZSBzYW1lIGJsb2NrLCBhbmQgaXQgaXMgaW1wb3NzaWJsZSB0byBrbm93IGluIGFkdmFuY2UgdGhlIGV4YWN0IHRpbWUgb2YgdGhlCiAgICAgICAgY29uZmlybWF0aW9uIG9mIHRoZSB0cmFuc2FjdGlvbi4gCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgogICAgICAgIEBwYXJhbSBfYW1vdW50IEFtb3VudCB0byBwYXksIHNwZWNpZmllZCBpbiB0aGUgbG9hbiBjdXJyZW5jeTsgb3IgaW4gUkNOIGlmIHRoZSBsb2FuIGhhcyBubyBvcmFjbGUKICAgICAgICBAcGFyYW0gX2Zyb20gVGhlIGlkZW50aXR5IG9mIHRoZSBwYXllcgogICAgICAgIEBwYXJhbSBvcmFjbGVEYXRhIERhdGEgcmVxdWlyZWQgYnkgdGhlIG9yYWNsZSB0byByZXR1cm4gdGhlIHJhdGUsIHRoZSBjb250ZW50IG9mIHRoaXMgZmllbGQgbXVzdCBiZSBwcm92aWRlZAogICAgICAgICAgICBieSB0aGUgdXJsIGV4cG9zZWQgaW4gdGhlIHVybCgpIG1ldGhvZCBvZiB0aGUgb3JhY2xlLgogICAgICAgICAgICAKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHBheW1lbnQgd2FzIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIHBheSh1aW50IGluZGV4LCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX2Zyb20sIGJ5dGVzIG9yYWNsZURhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CgogICAgICAgIHJlcXVpcmUobG9hbi5zdGF0dXMgPT0gU3RhdHVzLmxlbnQpOwogICAgICAgIGFkZEludGVyZXN0KGluZGV4KTsKICAgICAgICB1aW50MjU2IHRvUGF5ID0gbWluKGdldFBlbmRpbmdBbW91bnQoaW5kZXgpLCBfYW1vdW50KTsKICAgICAgICBQYXJ0aWFsUGF5bWVudChpbmRleCwgbXNnLnNlbmRlciwgX2Zyb20sIHRvUGF5KTsKCiAgICAgICAgbG9hbi5wYWlkID0gc2FmZUFkZChsb2FuLnBhaWQsIHRvUGF5KTsKCiAgICAgICAgaWYgKGdldFJhd1BlbmRpbmdBbW91bnQoaW5kZXgpID09IDApIHsKICAgICAgICAgICAgVG90YWxQYXltZW50KGluZGV4KTsKICAgICAgICAgICAgbG9hbi5zdGF0dXMgPSBTdGF0dXMucGFpZDsKCiAgICAgICAgICAgIC8vIEVSQzcyMSwgcmVtb3ZlIGxvYW4gZnJvbSBjaXJjdWxhdGlvbgogICAgICAgICAgICBsZW5kZXJzQmFsYW5jZVtsb2FuLmxlbmRlcl0gLT0gMTsKICAgICAgICAgICAgYWN0aXZlTG9hbnMgLT0gMTsKICAgICAgICAgICAgVHJhbnNmZXIobG9hbi5sZW5kZXIsIDB4MCwgaW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiB0cmFuc2ZlclZhbHVlID0gY29udmVydFJhdGUobG9hbi5vcmFjbGUsIGxvYW4uY3VycmVuY3ksIG9yYWNsZURhdGEsIHRvUGF5KTsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyVmFsdWUgPiAwIHx8IHRvUGF5IDwgX2Ftb3VudCk7CgogICAgICAgIGxvY2tUb2tlbnMocmNuLCB0cmFuc2ZlclZhbHVlKTsKICAgICAgICByZXF1aXJlKHJjbi50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgdHJhbnNmZXJWYWx1ZSkpOwogICAgICAgIGxvYW4ubGVuZGVyQmFsYW5jZSA9IHNhZmVBZGQodHJhbnNmZXJWYWx1ZSwgbG9hbi5sZW5kZXJCYWxhbmNlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBDb252ZXJ0cyBhbiBhbW91bnQgdG8gUkNOIHVzaW5nIHRoZSBsb2FuIG9yYWNsZS4KICAgICAgICAKICAgICAgICBAZGV2IElmIHRoZSBsb2FuIGhhcyBubyBvcmFjbGUgdGhlIGN1cnJlbmN5IG11c3QgYmUgUkNOIHNvIHRoZSByYXRlIGlzIDEKCiAgICAgICAgQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb252ZXJ0aW9uCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydFJhdGUoT3JhY2xlIG9yYWNsZSwgYnl0ZXMzMiBjdXJyZW5jeSwgYnl0ZXMgZGF0YSwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKG9yYWNsZSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHJldHVybiBhbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NiByYXRlOwogICAgICAgICAgICB1aW50MjU2IGRlY2ltYWxzOwogICAgICAgICAgICAKICAgICAgICAgICAgKHJhdGUsIGRlY2ltYWxzKSA9IG9yYWNsZS5nZXRSYXRlKGN1cnJlbmN5LCBkYXRhKTsKCiAgICAgICAgICAgIHJlcXVpcmUoZGVjaW1hbHMgPD0gUkNOX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzYWZlTXVsdChzYWZlTXVsdChhbW91bnQsIHJhdGUpLCAoMTAqKihSQ05fREVDSU1BTFMtZGVjaW1hbHMpKSkpIC8gUFJFQ0lTSU9OOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFdpdGhkcmF3IGxlbmRlciBmdW5kcwoKICAgICAgICBXaGVuIGEgbG9hbiBpcyBwYWlkLCB0aGUgZnVuZHMgYXJlIG5vdCB0cmFuc2ZlcnJlZCBhdXRvbWF0aWNhbGx5IHRvIHRoZSBsZW5kZXIsIHRoZSBmdW5kcyBhcmUgc3RvcmVkIG9uIHRoZQogICAgICAgIGVuZ2luZSBjb250cmFjdCwgYW5kIHRoZSBsZW5kZXIgbXVzdCBjYWxsIHRoaXMgZnVuY3Rpb24gc3BlY2lmeWluZyB0aGUgYW1vdW50IGRlc2lyZWQgdG8gdHJhbnNmZXIgYW5kIHRoZSAKICAgICAgICBkZXN0aW5hdGlvbi4KCiAgICAgICAgQGRldiBUaGlzIGJlaGF2aW9yIGlzIGRlZmluZWQgdG8gYWxsb3cgdGhlIHRlbXBvcmFyeSB0cmFuc2ZlciBvZiB0aGUgbG9hbiB0byBhIHNtYXJ0IGNvbnRyYWN0LCB3aXRob3V0IHdvcnJ5aW5nIHRoYXQKICAgICAgICB0aGUgY29udHJhY3Qgd2lsbCByZWNlaXZlIHRva2VucyB0aGF0IGFyZSBub3QgdHJhY2VhYmxlOyBhbmQgaXQgYWxsb3dzIHRoZSBkZXZlbG9wbWVudCBvZiBkZWNlbnRyYWxpemVkIAogICAgICAgIGF1dG9ub21vdXMgb3JnYW5pemF0aW9ucy4KCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCiAgICAgICAgQHBhcmFtIHRvIERlc3RpbmF0aW9uIG9mIHRoZSB3aXd0aGRyYXcgZnVuZHMKICAgICAgICBAcGFyYW0gYW1vdW50IEFtb3VudCB0byB3aXRoZHJhdywgaW4gUkNOCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgd2l0aGRyYXcgd2FzIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3YWwodWludCBpbmRleCwgYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGxvYW4ubGVuZGVyKTsKICAgICAgICBsb2FuLmxlbmRlckJhbGFuY2UgPSBzYWZlU3VidHJhY3QobG9hbi5sZW5kZXJCYWxhbmNlLCBhbW91bnQpOwogICAgICAgIHJlcXVpcmUocmNuLnRyYW5zZmVyKHRvLCBhbW91bnQpKTsKICAgICAgICB1bmxvY2tUb2tlbnMocmNuLCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgV2l0aGRyYXcgbGVuZGVyIGZ1bmRzIGluIGJhdGNoLCBpdCB3YWxrcyBieSBhbGwgdGhlIGxvYW5zIGJldHdlZW4gdGhlIHR3byBpbmRleCwgYW5kIHdpdGhkcmF3cyBhbGwKICAgICAgICB0aGUgZnVuZHMgc3RvcmVkIG9uIHRoYXQgbG9hbnMuCgogICAgICAgIEBkZXYgVGhpcyBiYXRjaCB3aXRoZHJhdyBtZXRob2QgY2FuIGJlIGV4cGVuc2l2ZSBpbiBnYXMsIGl0IG11c3QgYmUgdXNlZCB3aXRoIGNhcmUuCgogICAgICAgIEBwYXJhbSBmcm9tSW5kZXggU3RhcnQgaW5kZXggb2YgdGhlIHNlYXJjaAogICAgICAgIEBwYXJhbSB0b0luZGV4IEVuZCBpbmRleCBvZiB0aGUgc2VhcmNoCiAgICAgICAgQHBhcmFtIHRvIERlc3RpbmF0aW9uIG9mIHRoZSB0b2tlbnMKCiAgICAgICAgQHJldHVybiB0aGUgdG90YWwgd2l0aGRyYXdlZCAKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd2FsUmFuZ2UodWludDI1NiBmcm9tSW5kZXgsIHVpbnQyNTYgdG9JbmRleCwgYWRkcmVzcyB0bykgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGxvYW5JZDsKICAgICAgICB1aW50MjU2IHRvdGFsV2l0aGRyYXcgPSAwOwoKICAgICAgICBmb3IgKGxvYW5JZCA9IGZyb21JbmRleDsgbG9hbklkIDw9IHRvSW5kZXg7IGxvYW5JZCsrKSB7CiAgICAgICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbbG9hbklkXTsKICAgICAgICAgICAgaWYgKGxvYW4ubGVuZGVyID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgIHRvdGFsV2l0aGRyYXcgKz0gbG9hbi5sZW5kZXJCYWxhbmNlOwogICAgICAgICAgICAgICAgbG9hbi5sZW5kZXJCYWxhbmNlID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShyY24udHJhbnNmZXIodG8sIHRvdGFsV2l0aGRyYXcpKTsKICAgICAgICB1bmxvY2tUb2tlbnMocmNuLCB0b3RhbFdpdGhkcmF3KTsKICAgICAgICAKICAgICAgICByZXR1cm4gdG90YWxXaXRoZHJhdzsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFdpdGhkcmF3IGxlbmRlciBmdW5kcyBpbiBiYXRjaCwgaXQgd2Fsa3MgYnkgYWxsIHRoZSBsb2FucyBwYXNzZWQgdG8gdGhlIGZ1bmN0aW9uIGFuZCB3aXRoZHJhd3MgYWxsCiAgICAgICAgdGhlIGZ1bmRzIHN0b3JlZCBvbiB0aGF0IGxvYW5zLgoKICAgICAgICBAZGV2IFRoaXMgYmF0Y2ggd2l0aGRyYXcgbWV0aG9kIGNhbiBiZSBleHBlbnNpdmUgaW4gZ2FzLCBpdCBtdXN0IGJlIHVzZWQgd2l0aCBjYXJlLgoKICAgICAgICBAcGFyYW0gbG9hbklkcyBBcnJheSBvZiB0aGUgbG9hbnMgdG8gd2l0aGRyYXcKICAgICAgICBAcGFyYW0gdG8gRGVzdGluYXRpb24gb2YgdGhlIHRva2VucwoKICAgICAgICBAcmV0dXJuIHRoZSB0b3RhbCB3aXRoZHJhd2VkIAogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3YWxMaXN0KHVpbnQyNTZbXSBtZW1vcnkgbG9hbklkcywgYWRkcmVzcyB0bykgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGlucHV0SWQ7CiAgICAgICAgdWludDI1NiB0b3RhbFdpdGhkcmF3ID0gMDsKCiAgICAgICAgZm9yIChpbnB1dElkID0gMDsgaW5wdXRJZCA8IGxvYW5JZHMubGVuZ3RoOyBpbnB1dElkKyspIHsKICAgICAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tsb2FuSWRzW2lucHV0SWRdXTsKICAgICAgICAgICAgaWYgKGxvYW4ubGVuZGVyID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgIHRvdGFsV2l0aGRyYXcgKz0gbG9hbi5sZW5kZXJCYWxhbmNlOwogICAgICAgICAgICAgICAgbG9hbi5sZW5kZXJCYWxhbmNlID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShyY24udHJhbnNmZXIodG8sIHRvdGFsV2l0aGRyYXcpKTsKICAgICAgICB1bmxvY2tUb2tlbnMocmNuLCB0b3RhbFdpdGhkcmF3KTsKCiAgICAgICAgcmV0dXJuIHRvdGFsV2l0aGRyYXc7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBEZXByZWNhdGVzIHRoZSBlbmdpbmUsIGxvY2tzIHRoZSBjcmVhdGlvbiBvZiBuZXcgbG9hbnMuCiAgICAqLwogICAgZnVuY3Rpb24gc2V0RGVwcmVjYXRlZChib29sIF9kZXByZWNhdGVkKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBkZXByZWNhdGVkID0gX2RlcHJlY2F0ZWQ7CiAgICB9Cn0='.
	

]
