Class {
	#name : #SRTaa3e80a42e7bac1072bee7ee5ac72123969b8400,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTaa3e80a42e7bac1072bee7ee5ac72123969b8400 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBAdGl0bGUgTXVsdGlPd25hYmxlCiAqIGFsbG93cyBjcmVhdGluZyBjb250cmFjdHMgd2l0aCB1cCB0byAxNiBvd25lcnMgd2l0aCB0aGVpciBzaGFyZXMKICovCmNvbnRyYWN0IE11bHRpT3duYWJsZSB7CiAgICAvKiogYSBzaW5nbGUgb3duZXIgcmVjb3JkICovCiAgICBzdHJ1Y3QgT3duZXIgewogICAgICAgIGFkZHJlc3MgcmVjaXBpZW50OwogICAgICAgIHVpbnQgc2hhcmU7CiAgICB9CgogICAgLyoqIGNvbnRyYWN0IG93bmVycyAqLwogICAgT3duZXJbXSBwdWJsaWMgb3duZXJzOwoKICAgIC8qKgogICAgICogUmV0dXJucyB0b3RhbCBvd25lcnMgY291bnQKICAgICAqIEByZXR1cm4gY291bnQgLSBvd25lcnMgY291bnQKICAgICAqLwogICAgZnVuY3Rpb24gb3duZXJzQ291bnQgKCkgICBjb25zdGFudCAgIHJldHVybnMgKHVpbnQgY291bnQpIHsgIAogICAgICAgIHJldHVybiBvd25lcnMubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBvd25lcidzIGluZm8KICAgICAqIEBwYXJhbSAgaWR4IC0gaW5kZXggb2YgdGhlIG93bmVyCiAgICAgKiBAcmV0dXJuIG93bmVyIC0gb3duZXIncyBpbmZvCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyICh1aW50IGlkeCkgICBjb25zdGFudCAgIHJldHVybnMgKGFkZHJlc3Mgb3duZXJfZG90X3JlY2lwaWVudCwgdWludCBvd25lcl9kb3Rfc2hhcmUpIHsgIApPd25lciBtZW1vcnkgb3duZXI7CgogICAgICAgIG93bmVyID0gb3duZXJzW2lkeF07CiAgICBvd25lcl9kb3RfcmVjaXBpZW50ID0gYWRkcmVzcyhvd25lci5yZWNpcGllbnQpOwpvd25lcl9kb3Rfc2hhcmUgPSB1aW50KG93bmVyLnNoYXJlKTt9CgogICAgLyoqIHJldmVyc2UgbG9va3VwIGhlbHBlciAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBvd25lcnNJZHg7CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBjb250cmFjdCB3aXRoIHVwIHRvIDE2IG93bmVycwogICAgICogc2hhcmVzIG11c3QgYmUgPiAwCiAgICAgKi8KICAgIGZ1bmN0aW9uIE11bHRpT3duYWJsZSAoYWRkcmVzc1sxNl0gX293bmVyc19kb3RfcmVjaXBpZW50LCB1aW50WzE2XSBfb3duZXJzX2RvdF9zaGFyZSkgICB7ICAKT3duZXJbMTZdIG1lbW9yeSBfb3duZXJzOwoKZm9yKHVpbnQgX19yZWNpcGllbnRfaXRlcmF0b3JfXyA9IDA7IF9fcmVjaXBpZW50X2l0ZXJhdG9yX18gPCBfb3duZXJzX2RvdF9yZWNpcGllbnQubGVuZ3RoO19fcmVjaXBpZW50X2l0ZXJhdG9yX18rKykKICBfb3duZXJzW19fcmVjaXBpZW50X2l0ZXJhdG9yX19dLnJlY2lwaWVudCA9IGFkZHJlc3MoX293bmVyc19kb3RfcmVjaXBpZW50W19fcmVjaXBpZW50X2l0ZXJhdG9yX19dKTsKZm9yKHVpbnQgX19zaGFyZV9pdGVyYXRvcl9fID0gMDsgX19zaGFyZV9pdGVyYXRvcl9fIDwgX293bmVyc19kb3Rfc2hhcmUubGVuZ3RoO19fc2hhcmVfaXRlcmF0b3JfXysrKQogIF9vd25lcnNbX19zaGFyZV9pdGVyYXRvcl9fXS5zaGFyZSA9IHVpbnQoX293bmVyc19kb3Rfc2hhcmVbX19zaGFyZV9pdGVyYXRvcl9fXSk7CiAgICAgICAgZm9yKHZhciBpZHggPSAwOyBpZHggPCBfb3duZXJzX2RvdF9yZWNpcGllbnQubGVuZ3RoOyBpZHgrKykgewogICAgICAgICAgICBpZihfb3duZXJzW2lkeF0ucmVjaXBpZW50ICE9IDApIHsKICAgICAgICAgICAgICAgIG93bmVycy5wdXNoKF9vd25lcnNbaWR4XSk7CiAgICAgICAgICAgICAgICBhc3NlcnQob3duZXJzW2lkeF0uc2hhcmUgPiAwKTsKICAgICAgICAgICAgICAgIG93bmVyc0lkeFtfb3duZXJzW2lkeF0ucmVjaXBpZW50XSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIgY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IG9uZSBvZiBvd25lcnMKICAgICAqLwogICAgbW9kaWZpZXIgb25seU9uZU9mT3duZXJzKCkgewogICAgICAgIHJlcXVpcmUob3duZXJzSWR4W21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKCn0KCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwoKLyoqCiAqIEJhc2ljIGludGVyZmFjZSBmb3IgY29udHJhY3RzLCBmb2xsb3dpbmcgRVJDMjAgc3RhbmRhcmQKICovCmNvbnRyYWN0IEVSQzIwVG9rZW4gewogICAgCgogICAgLyoqCiAgICAgKiBUcmlnZ2VyZWQgd2hlbiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkLgogICAgICogQHBhcmFtIGZyb20gLSBhZGRyZXNzIHRva2VucyB3ZXJlIHRyYW5zZmVyZWQgZnJvbQogICAgICogQHBhcmFtIHRvIC0gYWRkcmVzcyB0b2tlbnMgd2VyZSB0cmFuc2ZlcmVkIHRvCiAgICAgKiBAcGFyYW0gdmFsdWUgLSBhbW91bnQgb2YgdG9rZW5zIHRyYW5zZmVyZWQKICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CgogICAgLyoqCiAgICAgKiBUcmlnZ2VyZWQgd2hlbmV2ZXIgYWxsb3dhbmNlIHN0YXR1cyBjaGFuZ2VzCiAgICAgKiBAcGFyYW0gb3duZXIgLSB0b2tlbnMgb3duZXIsIGFsbG93YW5jZSBjaGFuZ2VkIGZvcgogICAgICogQHBhcmFtIHNwZW5kZXIgLSB0b2tlbnMgc3BlbmRlciwgYWxsb3dhbmNlIGNoYW5nZWQgZm9yCiAgICAgKiBAcGFyYW0gdmFsdWUgLSBuZXcgYWxsb3dhbmNlIHZhbHVlIChvdmVyd3JpdGluZyB0aGUgb2xkIHZhbHVlKQogICAgICovCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvKioKICAgICAqIFJldHVybnMgdG90YWwgc3VwcGx5IG9mIHRva2VucyBldmVyIGVtaXR0ZWQKICAgICAqIEByZXR1cm4gdG90YWxTdXBwbHkgLSB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zIGV2ZXIgZW1pdHRlZAogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpOwoKICAgIC8qKgogICAgICogUmV0dXJucyBgb3duZXJgIGJhbGFuY2Ugb2YgdG9rZW5zCiAgICAgKiBAcGFyYW0gb3duZXIgYWRkcmVzcyB0byByZXF1ZXN0IGJhbGFuY2UgZm9yCiAgICAgKiBAcmV0dXJuIGJhbGFuY2UgLSB0b2tlbiBiYWxhbmNlIG9mIGBvd25lcmAKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYGFtb3VudGAgb2YgdG9rZW5zIHRvIGB0b2AgYWRkcmVzcwogICAgICogQHBhcmFtICB0byAtIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8KICAgICAqIEBwYXJhbSAgdmFsdWUgLSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MgLSBgdHJ1ZWAgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNmdWwsIGBmYWxzZWAgb3RoZXJ3aXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYHZhbHVlYCB0b2tlbnMgZnJvbSBgZnJvbWAgYWRkcmVzcyB0byBgdG9gCiAgICAgKiB0aGUgc2VuZGVyIG5lZWRzIHRvIGhhdmUgYWxsb3dhbmNlIGZvciB0aGlzIG9wZXJhdGlvbgogICAgICogQHBhcmFtICBmcm9tIC0gYWRkcmVzcyB0byB0YWtlIHRva2VucyBmcm9tCiAgICAgKiBAcGFyYW0gIHRvIC0gYWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogICAgICogQHBhcmFtICB2YWx1ZSAtIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZAogICAgICogQHJldHVybiBzdWNjZXNzIC0gYHRydWVgIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2VzZnVsLCBgZmFsc2VgIG90aGVyd2lzZQogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQWxsb3cgc3BlbmRlciB0byB3aXRoZHJhdyBmcm9tIHlvdXIgYWNjb3VudCwgbXVsdGlwbGUgdGltZXMsIHVwIHRvIHRoZSB2YWx1ZSBhbW91bnQuCiAgICAgKiBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIGB2YWx1ZWAuCiAgICAgKiB0aGlzIGZ1bmN0aW9uIGlzIHJlcXVpcmVkIGZvciBzb21lIERFWCBmdW5jdGlvbmFsaXR5CiAgICAgKiBAcGFyYW0gc3BlbmRlciAtIGFkZHJlc3MgdG8gZ2l2ZSBhbGxvd2FuY2UgdG8KICAgICAqIEBwYXJhbSB2YWx1ZSAtIHRoZSBtYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgYWxsb3dlZCBmb3Igc3BlbmRpbmcKICAgICAqIEByZXR1cm4gc3VjY2VzcyAtIGB0cnVlYCBpZiB0aGUgYWxsb3dhbmNlIHdhcyBnaXZlbiwgYGZhbHNlYCBvdGhlcndpc2UKICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBhbW91bnQgd2hpY2ggYHNwZW5kZXJgIGlzIHN0aWxsIGFsbG93ZWQgdG8gd2l0aGRyYXcgZnJvbSBgb3duZXJgCiAgICAgKiBAcGFyYW0gIG93bmVyIC0gdG9rZW5zIG93bmVyCiAgICAgKiBAcGFyYW0gIHNwZW5kZXIgLSBhZGRyZXMgdG8gcmVxdWVzdCBhbGxvd2FuY2UgZm9yCiAgICAgKiBAcmV0dXJuIHJlbWFpbmluZyAtIHJlbWFpbmluZyBhbGxvd2FuY2UgKHRva2VuIGNvdW50KQogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7Cn0KCgovKioKICogQHRpdGxlIEJsaW5kIENyb3VwaWVyIFRva2VuCiAqIFdJTiBmaXhlZCBzdXBwbHkgVG9rZW4sIHVzZWQgZm9yIEJsaW5kIENyb3VwaWVyIFRva2VuRGlzdHJpYnV0aW9uCiAqLwogY29udHJhY3QgV0lOIGlzIEVSQzIwVG9rZW4gewogICAgCgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiV0lOIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJXSU4iOwoKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDc7CiAgICB1aW50MjU2IGNvbnN0YW50IFRPS0VOID0gMTAqKjc7CiAgICB1aW50MjU2IGNvbnN0YW50IE1JTExJT04gPSAxMCoqNjsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVG9rZW5TdXBwbHkgPSA1MDAgKiBNSUxMSU9OICogVE9LRU47CgogICAgLyoqIGJhbGFuY2VzIG9mIGVhY2ggYWNjb3VudHMgKi8KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICAvKiogYW1vdW50IG9mIHRva2VucyBhcHByb3ZlZCBmb3IgdHJhbnNmZXIgKi8KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8qKiBUcmlnZ2VyZWQgd2hlbiBgb3duZXJgIGRlc3Ryb3lzIGBhbW91bnRgIHRva2VucyAqLwogICAgZXZlbnQgRGVzdHJveWVkKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiBhbW91bnQpOwoKICAgIC8qKgogICAgICogQ29uc3R1Y3RzIHRoZSB0b2tlbiwgYW5kIHN1cHBsaWVzIHRoZSBjcmVhdG9yIHdpdGggYHRvdGFsVG9rZW5TdXBwbHlgIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBXSU4gKCkgICB7IAogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gdG90YWxUb2tlblN1cHBseTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdG90YWwgc3VwcGx5IG9mIHRva2VucyBldmVyIGVtaXR0ZWQKICAgICAqIEByZXR1cm4gcmVzdWx0IC0gdG90YWwgc3VwcGx5IG9mIHRva2VucyBldmVyIGVtaXR0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkgKCkgIGNvbnN0YW50ICByZXR1cm5zICh1aW50MjU2IHJlc3VsdCkgeyAKICAgICAgICByZXN1bHQgPSB0b3RhbFRva2VuU3VwcGx5OwogICAgfQoKICAgIC8qKgogICAgKiBSZXR1cm5zIGBvd25lcmAgYmFsYW5jZSBvZiB0b2tlbnMKICAgICogQHBhcmFtIG93bmVyIGFkZHJlc3MgdG8gcmVxdWVzdCBiYWxhbmNlIGZvcgogICAgKiBAcmV0dXJuIGJhbGFuY2UgLSB0b2tlbiBiYWxhbmNlIG9mIGBvd25lcmAKICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YgKGFkZHJlc3Mgb3duZXIpICBjb25zdGFudCAgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7IAogICAgICAgIHJldHVybiBiYWxhbmNlc1tvd25lcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYGFtb3VudGAgb2YgdG9rZW5zIHRvIGB0b2AgYWRkcmVzcwogICAgICogQHBhcmFtICB0byAtIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8KICAgICAqIEBwYXJhbSAgYW1vdW50IC0gYW1vdW50IG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHJldHVybiBzdWNjZXNzIC0gYHRydWVgIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2VzZnVsLCBgZmFsc2VgIG90aGVyd2lzZQogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlciAoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7IAogICAgICAgIGlmKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgYW1vdW50KQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmKGFtb3VudCA8PSAwKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmKGJhbGFuY2VzW3RvXSArIGFtb3VudCA8PSBiYWxhbmNlc1t0b10pCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gYW1vdW50OwogICAgICAgIGJhbGFuY2VzW3RvXSArPSBhbW91bnQ7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYGFtb3VudGAgdG9rZW5zIGZyb20gYGZyb21gIGFkZHJlc3MgdG8gYHRvYAogICAgICogdGhlIHNlbmRlciBuZWVkcyB0byBoYXZlIGFsbG93YW5jZSBmb3IgdGhpcyBvcGVyYXRpb24KICAgICAqIEBwYXJhbSAgZnJvbSAtIGFkZHJlc3MgdG8gdGFrZSB0b2tlbnMgZnJvbQogICAgICogQHBhcmFtICB0byAtIGFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgICAqIEBwYXJhbSAgYW1vdW50IC0gYW1vdW50IG9mIHRva2VucyB0byBzZW5kCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MgLSBgdHJ1ZWAgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNmdWwsIGBmYWxzZWAgb3RoZXJ3aXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSAoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsgCiAgICAgICAgaWYgKGJhbGFuY2VzW2Zyb21dIDwgYW1vdW50KQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmKGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gPCBhbW91bnQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYoYW1vdW50ID09IDApCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYoYmFsYW5jZXNbdG9dICsgYW1vdW50IDw9IGJhbGFuY2VzW3RvXSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBiYWxhbmNlc1tmcm9tXSAtPSBhbW91bnQ7CiAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSAtPSBhbW91bnQ7CiAgICAgICAgYmFsYW5jZXNbdG9dICs9IGFtb3VudDsKICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHNwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB5b3VyIGFjY291bnQsIG11bHRpcGxlIHRpbWVzLCB1cCB0byB0aGUgYW1vdW50IGFtb3VudC4KICAgICAqIElmIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGFnYWluIGl0IG92ZXJ3cml0ZXMgdGhlIGN1cnJlbnQgYWxsb3dhbmNlIHdpdGggYGFtb3VudGAuCiAgICAgKiB0aGlzIGZ1bmN0aW9uIGlzIHJlcXVpcmVkIGZvciBzb21lIERFWCBmdW5jdGlvbmFsaXR5CiAgICAgKiBAcGFyYW0gc3BlbmRlciAtIGFkZHJlc3MgdG8gZ2l2ZSBhbGxvd2FuY2UgdG8KICAgICAqIEBwYXJhbSBhbW91bnQgLSB0aGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIGFsbG93ZWQgZm9yIHNwZW5kaW5nCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MgLSBgdHJ1ZWAgaWYgdGhlIGFsbG93YW5jZSB3YXMgZ2l2ZW4sIGBmYWxzZWAgb3RoZXJ3aXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUgKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQpICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7IAogICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IGFtb3VudDsKICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIGFtb3VudCk7CiAgICAgICByZXR1cm4gdHJ1ZTsKICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgYW1vdW50IHdoaWNoIGBzcGVuZGVyYCBpcyBzdGlsbCBhbGxvd2VkIHRvIHdpdGhkcmF3IGZyb20gYG93bmVyYAogICAgICogQHBhcmFtICBvd25lciAtIHRva2VucyBvd25lcgogICAgICogQHBhcmFtICBzcGVuZGVyIC0gYWRkcmVzIHRvIHJlcXVlc3QgYWxsb3dhbmNlIGZvcgogICAgICogQHJldHVybiByZW1haW5pbmcgLSByZW1haW5pbmcgYWxsb3dhbmNlICh0b2tlbiBjb3VudCkKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlIChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpICBjb25zdGFudCAgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsgCiAgICAgICAgcmV0dXJuIGFsbG93ZWRbb3duZXJdW3NwZW5kZXJdOwogICAgfQoKICAgICAvKioKICAgICAgKiBEZXN0cm95cyBgYW1vdW50YCBvZiB0b2tlbnMgcGVybWFuZW50bHksIHRoZXkgY2Fubm90IGJlIHJlc3RvcmVkCiAgICAgICogQHJldHVybiBzdWNjZXNzIC0gYHRydWVgIGlmIGBhbW91bnRgIG9mIHRva2VucyB3ZXJlIGRlc3Ryb3llZCwgYGZhbHNlYCBvdGhlcndpc2UKICAgICAgKi8KICAgIGZ1bmN0aW9uIGRlc3Ryb3kgKHVpbnQyNTYgYW1vdW50KSAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgeyAKICAgICAgICBpZihhbW91bnQgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgYW1vdW50KSByZXR1cm4gZmFsc2U7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gYW1vdW50OwogICAgICAgIHRvdGFsVG9rZW5TdXBwbHkgLT0gYW1vdW50OwogICAgICAgIERlc3Ryb3llZChtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBAdGl0bGUgVmFyaW91cyBNYXRoIHV0aWxpdGllcwogKi8KbGlicmFyeSBNYXRoIHsKICAgICAvKiogMS8xMDAwLCAxMDAwIHVpbnQgPSAxICovCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGBwcm9taWxsZWAgcHJvbWlsbGUgb2YgYHZhbHVlYAogICAgICogZS5nLiBgdGFrZVByb21pbGxlKDUwMDAsIDEpID09IDVgCiAgICAgKiBAcGFyYW0gdmFsdWUgLSB1aW50IHRvIHRha2UgcHJvbWlsbGUgdmFsdWUKICAgICAqIEBwYXJhbSBwcm9taWxsZSAtIHByb21pbGxlIHZhbHVlCiAgICAgKiBAcmV0dXJuIHJlc3VsdCAtIGB2YWx1ZSAqIHByb21pbGxlIC8gMTAwMGAKICAgICAqLwogICAgZnVuY3Rpb24gdGFrZVByb21pbGxlICh1aW50IHZhbHVlLCB1aW50IHByb21pbGxlKSAgY29uc3RhbnQgIHJldHVybnMgKHVpbnQgcmVzdWx0KSB7IAogICAgICAgIHJlc3VsdCA9IHZhbHVlICogcHJvbWlsbGUgLyAxMDAwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBgdmFsdWVgIHdpdGggYWRkZWQgYHByb21pbGxlYCBwcm9taWxsZQogICAgICogQHBhcmFtIHZhbHVlIC0gdWludCB0byBhZGQgcHJvbWlsbGUgdG8KICAgICAqIEBwYXJhbSBwcm9taWxsZSAtIHByb21pbGxlIHZhbHVlIHRvIGFkZAogICAgICogQHJldHVybiByZXN1bHQgLSBgdmFsdWUgKyB2YWx1ZSAqIHByb21pbGxlIC8gMTAwMGAKICAgICAqLwogICAgZnVuY3Rpb24gYWRkUHJvbWlsbGUgKHVpbnQgdmFsdWUsIHVpbnQgcHJvbWlsbGUpICBjb25zdGFudCAgcmV0dXJucyAodWludCByZXN1bHQpIHsgCiAgICAgICAgcmVzdWx0ID0gdmFsdWUgKyB0YWtlUHJvbWlsbGUodmFsdWUsIHByb21pbGxlKTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgQmxpbmQgQ3JvdXBpZXIgVG9rZW5EaXN0cmlidXRpb24KICogSXQgcG9zc2Vzc2VzIHNvbWUgYFdJTmAgdG9rZW5zLgogKiBUaGUgZGlzdHJpYnV0aW9uIGlzIGRpdmlkZWQgaW50byBtYW55ICdwZXJpb2RzJy4KICogVGhlIHplcm8gb25lIGlzIGBQcmVzYWxlYCB3aXRoIGBUT0tFTlNfRk9SX1BSRVNBTEVgIHRva2VucwogKiBJdCdzIGVuZGVkIHdoZW4gYWxsIHRva2VucyBhcmUgc29sZCBvciBtYW51YWxseSB3aXRoIGBlbmRQcmVzYWxlKClgIGZ1bmN0aW9uCiAqIFRoZSBsZW5ndGggb2YgZmlyc3QgcGVyaW9kIGlzIGBGSVJTVF9QRVJJT0RfRFVSQVRJT05gLgogKiBUaGUgbGVuZ3RoIG9mIG90aGVyIHBlcmlvZHMgaXMgYFBFUklPRF9EVVJBVElPTmAuCiAqIER1cmluZyBlYWNoIHBlcmlvZCwgYFRPS0VOU19QRVJfUEVSSU9EYCBhcmUgb2ZmZXJlZCBmb3Igc2FsZSAoYFRPS0VOU19QRVJfRklSU1RfUEVSSU9EYCBmb3IgdGhlIGZpcnN0IG9uZSkKICogSW52ZXN0b3JzIHNlbmQgdGhlaXIgbW9uZXkgdG8gdGhlIGNvbnRyYWN0CiAqIGFuZCBjYWxsIGBjbGFpbUFsbFRva2VucygpYCBmdW5jdGlvbiB0byBnZXQgYFdJTmAgdG9rZW5zLgogKiBQZXJpb2QgMCBUb2tlbiBwcmljZSBpcyBgUFJFU0FMRV9UT0tFTl9QUklDRWAKICogUGVyaW9kIDEgVG9rZW4gcHJpY2UgaXMgYFNBTEVfSU5JVElBTF9UT0tFTl9QUklDRWAKICogUGVyaW9kIDIrIHByaWNlIGlzIGRldGVybWluZWQgYnkgdGhlIGZvbGxvd2luZyBydWxlczoKICogSWYgbW9yZSB0aGFuIGBUT0tFTlNfVE9fSU5DUkVBU0VfTkVYVF9QUklDRSAqIFRPS0VOU19QRVJfUEVSSU9EIC8gMTAwMGAKICogd2VyZSBzb2xkIGR1cmluZyB0aGUgcGVyaW9kLCB0aGUgcHJpY2Ugb2YgdGhlIFRva2VucyBmb3IgdGhlIG5leHQgcGVyaW9kCiAqIGlzIGluY3JlYXNlZCBieSBgUEVSSU9EX1BSSUNFX0lOQ1JFQVNFYCBwcm9taWxsZSwKICogaWYgQUxMIHRva2VucyB3ZXJlIHNvbGQsIHByaWNlIGlzIGluY3JlYXNlZCBieSBgRlVMTFlfU09MRF9QUklDRV9JTkNSRUFTRWAgcHJvbWlsbGUKICogT3RoZXJ3aXNlLCB0aGUgcHJpY2UgcmVtYWlucyB0aGUgc2FtZS4KICovCmNvbnRyYWN0IEJsaW5kQ3JvdXBpZXJUb2tlbkRpc3RyaWJ1dGlvbiBpcyBNdWx0aU93bmFibGUgewogICAgCiAgICAKICAgIAogICAgCiAgICAKICAgIAoKICAgIHVpbnQyNTYgY29uc3RhbnQgVE9LRU4gPSAxMCoqNzsKICAgIHVpbnQyNTYgY29uc3RhbnQgTUlMTElPTiA9IDEwKio2OwoKICAgIHVpbnQyNTYgY29uc3RhbnQgTUlOSU1VTV9ERVBPU0lUID0gMTAwIGZpbm5leTsgLyoqIG1pbmltdW0gZGVwb3NpdCBhY2NlcHRlZCB0byBiYW5rICovCiAgICB1aW50MjU2IGNvbnN0YW50IFBSRVNBTEVfVE9LRU5fUFJJQ0UgPSAwLjAwMDM1IGV0aGVyIC8gVE9LRU47CiAgICB1aW50MjU2IGNvbnN0YW50IFNBTEVfSU5JVElBTF9UT0tFTl9QUklDRSA9IDAuMDAwNSBldGhlciAvIFRPS0VOOwoKICAgIHVpbnQyNTYgY29uc3RhbnQgVE9LRU5TX0ZPUl9QUkVTQUxFID0gNSAqIE1JTExJT04gKiBUT0tFTjsgLyoqIDVNIHRva2VucyAqLwogICAgdWludDI1NiBjb25zdGFudCBUT0tFTlNfUEVSX0ZJUlNUX1BFUklPRCA9IDE1ICogTUlMTElPTiAqIFRPS0VOOyAvKiogMTVNIHRva2VucyAqLwogICAgdWludDI1NiBjb25zdGFudCBUT0tFTlNfUEVSX1BFUklPRCA9IDEgKiBNSUxMSU9OICogVE9LRU47IC8qKiAxTSB0b2tlbnMgKi8KICAgIHVpbnQyNTYgY29uc3RhbnQgRklSU1RfUEVSSU9EX0RVUkFUSU9OID0gMTYxIGhvdXJzOyAvKiogZHVyYXRpb24gb2YgMXN0IHNhbGUgcGVyaW9kICovCiAgICB1aW50MjU2IGNvbnN0YW50IFBFUklPRF9EVVJBVElPTiA9IDIzIGhvdXJzOyAvKiogZHVyYXRpb24gb2YgYWxsIG90aGVyIHNhbGUgcGVyaW9kcyAqLwogICAgdWludDI1NiBjb25zdGFudCBQRVJJT0RfUFJJQ0VfSU5DUkVBU0UgPSA1OyAvKiogYG5leHRfdG9rZW5fcHJpY2UgPSBvbGRfdG9rZW5fcHJpY2UgKyBvbGRfdG9rZW5fcHJpY2UgKiBQRVJJT0RfUFJJQ0VfSU5DUkVBU0UgLyAxMDAwYCAqLwogICAgdWludDI1NiBjb25zdGFudCBGVUxMWV9TT0xEX1BSSUNFX0lOQ1JFQVNFID0gMTA7IC8qKiB0byBpbmNyZWFzZSBwcmljZSBpZiBBTEwgdG9rZW5zIHNvbGQgKi8KICAgIHVpbnQyNTYgY29uc3RhbnQgVE9LRU5TX1RPX0lOQ1JFQVNFX05FWFRfUFJJQ0UgPSA4MDA7IC8qKiB0aGUgcHJpY2UgaXMgaW5jcmVhc2VkIGlmIGBzb2xkX3Rva2VucyA+IHBlcmlvZF90b2tlbnMgKiBUT0tFTlNfVE9fSU5DUkVBU0VfTkVYVF9QUklDRSAvIDEwMDBgICovCgogICAgdWludDI1NiBjb25zdGFudCBORVZFUiA9IDA7CiAgICB1aW50MTYgY29uc3RhbnQgVU5LTk9XTl9DT1VOVFJZID0gMDsKCiAgICAvKioKICAgICAqIFN0YXRlIG9mIEJsaW5kIENyb3VwaWVyIGNyb3dkc2FsZQogICAgICovCiAgICBlbnVtIFN0YXRlIHsKICAgICAgICBOb3RTdGFydGVkLAogICAgICAgIFByZXNhbGUsCiAgICAgICAgU2FsZQogICAgfQoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVW5jbGFpbWVkVG9rZW5zOyAvKiogdG90YWwgYW1vdW50IG9mIHRva2VucywgVG9rZW5EaXN0cmlidXRpb24gb3ducyB0byBpbnZlc3RvcnMgKi8KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVG9rZW5zU29sZDsgLyoqIHRvdGFsIGFtb3VudCBvZiBUb2tlbnMgc29sZCBkdXJpbmcgdGhlIFRva2VuRGlzdHJpYnV0aW9uICovCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFRva2Vuc0Rlc3Ryb3llZDsgLyoqIHRvdGFsIGFtb3VudCBvZiBUb2tlbnMgZGVzdHJveWVkIGJ5IHRoaXMgY29udHJhY3QgKi8KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHVuY2xhaW1lZFRva2Vuc0ZvckludmVzdG9yOyAvKiogdW5jbGFpbWVkIHRva2VucyBmb3IgZWFjaCBpbnZlc3RvciAqLwoKICAgIC8qKgogICAgICogT25lIHRva2VuIHNhbGUgcGVyaW9kIGluZm9ybWF0aW9uCiAgICAgKi8KICAgIHN0cnVjdCBQZXJpb2QgewogICAgICAgIHVpbnQyNTYgc3RhcnRUaW1lOwogICAgICAgIHVpbnQyNTYgZW5kVGltZTsKICAgICAgICB1aW50MjU2IHRva2VuUHJpY2U7CiAgICAgICAgdWludDI1NiB0b2tlbnNTb2xkOwogICAgfQoKICAgIC8qKgogICAgICogRW1pdGVkIHdoZW4gYGludmVzdG9yYCBzZW5kcyBgYW1vdW50YCBvZiBtb25leSB0byB0aGUgQmFuawogICAgICogQHBhcmFtIGludmVzdG9yIC0gYWRkcmVzcywgc2VuZGluZyB0aGUgbW9uZXkKICAgICAqIEBwYXJhbSBhbW91bnQgLSBXZWkgc2VudAogICAgICovCiAgICBldmVudCBEZXBvc2l0ZWQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiB0b2tlbkNvdW50KTsKCiAgICAvKioKICAgICAqIEVtaXRlZCB3aGVuIGEgbmV3IHBlcmlvZCBpcyBvcGVuZWQKICAgICAqIEBwYXJhbSBwZXJpb2RJbmRleCAtIGluZGV4IG9mIG5ldyBwZXJpb2QKICAgICAqIEBwYXJhbSB0b2tlblByaWNlIC0gcHJpY2Ugb2YgV0lOIFRva2VuIGluIG5ldyBwZXJpb2QKICAgICAqLwogICAgZXZlbnQgUGVyaW9kU3RhcnRlZCh1aW50IHBlcmlvZEluZGV4LCB1aW50MjU2IHRva2VuUHJpY2UsIHVpbnQyNTYgdG9rZW5zVG9TYWxlLCB1aW50MjU2IHN0YXJ0VGltZSwgdWludDI1NiBlbmRUaW1lLCB1aW50MjU2IG5vdyk7CgogICAgLyoqCiAgICAgKiBFbWl0ZWQgd2hlbiBgaW52ZXN0b3JgIGNsYWltcyBgY2xhaW1lZGAgdG9rZW5zCiAgICAgKiBAcGFyYW0gaW52ZXN0b3IgLSBhZGRyZXNzIGdldHRpbmcgdGhlIFRva2VucwogICAgICogQHBhcmFtIGNsYWltZWQgLSBhbW91bnQgb2YgVG9rZW5zIGNsYWltZWQKICAgICAqLwogICAgZXZlbnQgVG9rZW5zQ2xhaW1lZChhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIHVpbnQyNTYgY2xhaW1lZCk7CgogICAgLyoqIGN1cnJlbnQgVG9rZW4gc2FsZSBwZXJpb2QgKi8KICAgIHVpbnQgcHVibGljIGN1cnJlbnRQZXJpb2QgPSAwOwoKICAgIC8qKiBpbmZvcm1hdGlvbiBhYm91dCBwYXN0IGFuZCBjdXJyZW50IHBlcmlvZHMsIGJ5IHBlcmlvZHMgaW5kZXgsIHN0YXJ0aW5nIGZyb20gYDBgICovCiAgICBtYXBwaW5nKHVpbnQgPT4gUGVyaW9kKSBwZXJpb2RzOwoKICAgIC8qKiBXSU4gdG9rZW5zIGNvbnRyYWN0ICAqLwogICAgV0lOIHB1YmxpYyB3aW47CgogICAgLyoqIFRoZSBzdGF0ZSBvZiB0aGUgY3Jvd2RzYWxlIC0gYE5vdFN0YXJ0ZWRgLCBgUHJlc2FsZWAsIGBTYWxlYCAqLwogICAgU3RhdGUgcHVibGljIHN0YXRlOwoKICAgIC8qKiB0aGUgY291bnRlciBvZiBpbnZlc3RtZW50IGJ5IGEgY291bnRyeSBjb2RlICgzLWRpZ2l0IElTTyAzMTY2IGNvZGUpICovCiAgICBtYXBwaW5nKHVpbnQxNiA9PiB1aW50MjU2KSBpbnZlc3RtZW50c0J5Q291bnRyaWVzOwoKICAgIC8qKgogICAgICogUmV0dXJucyBhbW91bnQgb2YgV2VpIGludmVzdGVkIGJ5IHRoZSBzcGVjaWZpZWQgY291bnRyeQogICAgICogQHBhcmFtIGNvdW50cnkgLSAzLWRpZ2l0IGNvdW50cnkgY29kZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRJbnZlc3RtZW50c0J5Q291bnRyeSAodWludDE2IGNvdW50cnkpICAgY29uc3RhbnQgICByZXR1cm5zICh1aW50MjU2IGludmVzdG1lbnQpIHsgIAogICAgICAgIGludmVzdG1lbnQgPSBpbnZlc3RtZW50c0J5Q291bnRyaWVzW2NvdW50cnldOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgVG9rZW4gcHJpY2UgaW4gdGhlIGN1cnJlbnQgcGVyaW9kCiAgICAgKiBAcmV0dXJuIHRva2VuUHJpY2UgLSBjdXJyZW50IFRva2VuIHByaWNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRva2VuUHJpY2UgKCkgICBjb25zdGFudCAgIHJldHVybnMgKHVpbnQyNTYgdG9rZW5QcmljZSkgeyAgCiAgICAgICAgdG9rZW5QcmljZSA9IHBlcmlvZHNbY3VycmVudFBlcmlvZF0udG9rZW5QcmljZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIFRva2VuIHByaWNlIGZvciB0aGUgcGVyaW9kIHJlcXVlc3RlZAogICAgICogQHBhcmFtIHBlcmlvZEluZGV4IC0gdGhlIHBlcmlvZCBpbmRleAogICAgICogQHJldHVybiB0b2tlblByaWNlIC0gVG9rZW4gcHJpY2UgZm9yIHRoZSBwZXJpb2QKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW5QcmljZUZvclBlcmlvZCAodWludCBwZXJpb2RJbmRleCkgICBjb25zdGFudCAgIHJldHVybnMgKHVpbnQyNTYgdG9rZW5QcmljZSkgeyAgCiAgICAgICAgdG9rZW5QcmljZSA9IHBlcmlvZHNbcGVyaW9kSW5kZXhdLnRva2VuUHJpY2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBhbW91bnQgb2YgVG9rZW5zIHNvbGQKICAgICAqIEBwYXJhbSBwZXJpb2QgLSBwZXJpb2QgaW5kZXggdG8gZ2V0IHRva2VucyBmb3IKICAgICAqIEByZXR1cm4gdG9rZW5zU29sZCAtIGFtb3VudCBvZiB0b2tlbnMgc29sZAogICAgICovCiAgICBmdW5jdGlvbiBnZXRUb2tlbnNTb2xkICh1aW50IHBlcmlvZCkgICBjb25zdGFudCAgIHJldHVybnMgKHVpbnQyNTYgdG9rZW5zU29sZCkgeyAgCiAgICAgICAgcmV0dXJuIHBlcmlvZHNbcGVyaW9kXS50b2tlbnNTb2xkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBgdHJ1ZWAgaWYgVG9rZW5EaXN0cmlidXRpb24gaGFzIGVub3VnaCB0b2tlbnMgZm9yIHRoZSBjdXJyZW50IHBlcmlvZAogICAgICogYW5kIHRodXMgZ29pbmcgb24KICAgICAqIEByZXR1cm4gYWN0aXZlIC0gYHRydWVgIGlmIFRva2VuRGlzdHJpYnV0aW9uIGlzIGdvaW5nIG9uLCBgZmFsc2VgIG90aGVyd2lzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0FjdGl2ZSAoKSAgIGNvbnN0YW50ICAgcmV0dXJucyAoYm9vbCBhY3RpdmUpIHsgIAogICAgICAgIHJldHVybiB3aW4uYmFsYW5jZU9mKHRoaXMpID49IHRvdGFsVW5jbGFpbWVkVG9rZW5zICsgdG9rZW5zRm9yUGVyaW9kKGN1cnJlbnRQZXJpb2QpIC0gcGVyaW9kc1tjdXJyZW50UGVyaW9kXS50b2tlbnNTb2xkOwogICAgfQoKICAgIC8qKgogICAgICogQWNjZXB0cyBtb25leSBkZXBvc2l0IGFuZCBtYWtlcyByZWNvcmQKICAgICAqIG1pbmltdW0gZGVwb3NpdCBpcyBNSU5JTVVNX0RFUE9TSVQKICAgICAqIEBwYXJhbSBiZW5lZmljaWFyIC0gdGhlIGFkZHJlc3MgdG8gcmVjZWl2ZSBUb2tlbnMKICAgICAqIEBwYXJhbSBjb3VudHJ5Q29kZSAtIDMtZGlnaXQgY291bnRyeSBjb2RlCiAgICAgKiBAZGV2IGlmIGBtc2cudmFsdWUgPCBNSU5JTVVNX0RFUE9TSVRgIHRocm93cwogICAgICovCiAgICBmdW5jdGlvbiBkZXBvc2l0IChhZGRyZXNzIGJlbmVmaWNpYXIsIHVpbnQxNiBjb3VudHJ5Q29kZSkgICBwYXlhYmxlICB7ICAKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBNSU5JTVVNX0RFUE9TSVQpOwogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuU2FsZSB8fCBzdGF0ZSA9PSBTdGF0ZS5QcmVzYWxlKTsKCiAgICAgICAgLyogdGhpcyBzaG91bGQgZW5kIGFueSBmaW5pc2hlZCBwZXJpb2QgYmVmb3JlIHN0YXJ0aW5nIGFueSBvcGVyYXRpb25zICovCiAgICAgICAgdGljaygpOwoKICAgICAgICAvKiBjaGVjayBpZiBoYXZlIGVub3VnaCB0b2tlbnMgZm9yIHRoZSBjdXJyZW50IHBlcmlvZAogICAgICAgICAqIGlmIG5vdCwgdGhlIGNhbGwgZmFpbHMgdW50aWwgdG9rZW5zIGFyZSBkZXBvc2l0ZWQgdG8gdGhlIGNvbnRyYWN0CiAgICAgICAgICovCiAgICAgICAgcmVxdWlyZShpc0FjdGl2ZSgpKTsKCiAgICAgICAgdWludDI1NiB0b2tlbnNCb3VnaHQgPSBtc2cudmFsdWUgLyBnZXRUb2tlblByaWNlKCk7CgogICAgICAgIGlmKHBlcmlvZHNbY3VycmVudFBlcmlvZF0udG9rZW5zU29sZCArIHRva2Vuc0JvdWdodCA+PSB0b2tlbnNGb3JQZXJpb2QoY3VycmVudFBlcmlvZCkpIHsKICAgICAgICAgICAgdG9rZW5zQm91Z2h0ID0gdG9rZW5zRm9yUGVyaW9kKGN1cnJlbnRQZXJpb2QpIC0gcGVyaW9kc1tjdXJyZW50UGVyaW9kXS50b2tlbnNTb2xkOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBtb25leVNwZW50ID0gZ2V0VG9rZW5QcmljZSgpICogdG9rZW5zQm91Z2h0OwoKICAgICAgICBpbnZlc3RtZW50c0J5Q291bnRyaWVzW2NvdW50cnlDb2RlXSArPSBtb25leVNwZW50OwoKICAgICAgICBpZih0b2tlbnNCb3VnaHQgPiAwKSB7CiAgICAgICAgICAgIGFzc2VydChtb25leVNwZW50IDw9IG1zZy52YWx1ZSk7CgogICAgICAgICAgICAvKiByZXR1cm4gdGhlIHJlc3QgKi8KICAgICAgICAgICAgaWYobXNnLnZhbHVlID4gbW9uZXlTcGVudCkgewogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUgLSBtb25leVNwZW50KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGVyaW9kc1tjdXJyZW50UGVyaW9kXS50b2tlbnNTb2xkICs9IHRva2Vuc0JvdWdodDsKICAgICAgICAgICAgdW5jbGFpbWVkVG9rZW5zRm9ySW52ZXN0b3JbYmVuZWZpY2lhcl0gKz0gdG9rZW5zQm91Z2h0OwogICAgICAgICAgICB0b3RhbFVuY2xhaW1lZFRva2VucyArPSB0b2tlbnNCb3VnaHQ7CiAgICAgICAgICAgIHRvdGFsVG9rZW5zU29sZCArPSB0b2tlbnNCb3VnaHQ7CiAgICAgICAgICAgIERlcG9zaXRlZChtc2cuc2VuZGVyLCBtb25leVNwZW50LCB0b2tlbnNCb3VnaHQpOwogICAgICAgIH0KCiAgICAgICAgLyogaWYgYWxsIHRva2VucyBhcmUgc29sZCwgZ2V0IHRvIHRoZSBuZXh0IHBlcmlvZCAqLwogICAgICAgIHRpY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlZSBgZGVwb3NpdGAgZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICBkZXBvc2l0KG1zZy5zZW5kZXIsIFVOS05PV05fQ09VTlRSWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBjb250cmFjdCBhbmQgc2V0cyB0aGUgb3duZXJzCiAgICAgKiBAcGFyYW0gb3duZXJzX2RvdF9yZWNpcGllbnQgLSBhcnJheSBvZiAxNiBvd25lciByZWNvcmRzICAoTXVsdGlPd25hYmxlLk93bmVyLnJlY2lwaWVudCBmaWVsZHMpCiogQHBhcmFtIG93bmVyc19kb3Rfc2hhcmUgLSBhcnJheSBvZiAxNiBvd25lciByZWNvcmRzICAoTXVsdGlPd25hYmxlLk93bmVyLnNoYXJlIGZpZWxkcykKICAgICAqLwogICAgZnVuY3Rpb24gQmxpbmRDcm91cGllclRva2VuRGlzdHJpYnV0aW9uIChhZGRyZXNzWzE2XSBvd25lcnNfZG90X3JlY2lwaWVudCwgdWludFsxNl0gb3duZXJzX2RvdF9zaGFyZSkgICBNdWx0aU93bmFibGUob3duZXJzX2RvdF9yZWNpcGllbnQsIG93bmVyc19kb3Rfc2hhcmUpICB7ICAKTXVsdGlPd25hYmxlLk93bmVyWzE2XSBtZW1vcnkgb3duZXJzOwoKZm9yKHVpbnQgX19yZWNpcGllbnRfaXRlcmF0b3JfXyA9IDA7IF9fcmVjaXBpZW50X2l0ZXJhdG9yX18gPCBvd25lcnNfZG90X3JlY2lwaWVudC5sZW5ndGg7X19yZWNpcGllbnRfaXRlcmF0b3JfXysrKQogIG93bmVyc1tfX3JlY2lwaWVudF9pdGVyYXRvcl9fXS5yZWNpcGllbnQgPSBhZGRyZXNzKG93bmVyc19kb3RfcmVjaXBpZW50W19fcmVjaXBpZW50X2l0ZXJhdG9yX19dKTsKZm9yKHVpbnQgX19zaGFyZV9pdGVyYXRvcl9fID0gMDsgX19zaGFyZV9pdGVyYXRvcl9fIDwgb3duZXJzX2RvdF9zaGFyZS5sZW5ndGg7X19zaGFyZV9pdGVyYXRvcl9fKyspCiAgb3duZXJzW19fc2hhcmVfaXRlcmF0b3JfX10uc2hhcmUgPSB1aW50KG93bmVyc19kb3Rfc2hhcmVbX19zaGFyZV9pdGVyYXRvcl9fXSk7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5Ob3RTdGFydGVkOwogICAgfQoKICAgIC8qKgogICAgICogQmVnaW5zIHRoZSBjcm93ZHNhbGUgKHByZXNhbGUgcGVyaW9kKQogICAgICogQHBhcmFtIHRva2VuQ29udHJhY3RBZGRyZXNzIC0gYWRkcmVzcyBvZiB0aGUgYFdJTmAgY29udHJhY3QgKHRva2VuIGhvbGRlcikKICAgICAqIEBkZXYgbXVzdCBiZSBjYWxsZWQgYnkgb25lIG9mIG93bmVycwogICAgICovCiAgICBmdW5jdGlvbiBzdGFydFByZXNhbGUgKGFkZHJlc3MgdG9rZW5Db250cmFjdEFkZHJlc3MpICAgb25seU9uZU9mT3duZXJzICB7ICAKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLk5vdFN0YXJ0ZWQpOwoKICAgICAgICB3aW4gPSBXSU4odG9rZW5Db250cmFjdEFkZHJlc3MpOwoKICAgICAgICBhc3NlcnQod2luLmJhbGFuY2VPZih0aGlzKSA+PSB0b2tlbnNGb3JQZXJpb2QoMCkpOwoKICAgICAgICBwZXJpb2RzWzBdID0gUGVyaW9kKG5vdywgTkVWRVIsIFBSRVNBTEVfVE9LRU5fUFJJQ0UsIDApOwogICAgICAgIFBlcmlvZFN0YXJ0ZWQoMCwKICAgICAgICAgICAgUFJFU0FMRV9UT0tFTl9QUklDRSwKICAgICAgICAgICAgdG9rZW5zRm9yUGVyaW9kKGN1cnJlbnRQZXJpb2QpLAogICAgICAgICAgICBub3csCiAgICAgICAgICAgIE5FVkVSLAogICAgICAgICAgICBub3cpOwogICAgICAgIHN0YXRlID0gU3RhdGUuUHJlc2FsZTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZHMgdGhlIHByZXNhbGUgYW5kIGJlZ2lucyBwZXJpb2QgMSBvZiB0aGUgY3Jvd2RzYWxlCiAgICAgKiBAZGV2IG11c3QgYmUgY2FsbGVkIGJ5IG9uZSBvZiBvd25lcnMKICAgICAqLwogICAgZnVuY3Rpb24gZW5kUHJlc2FsZSAoKSAgIG9ubHlPbmVPZk93bmVycyAgeyAgCiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5QcmVzYWxlKTsKICAgICAgICBzdGF0ZSA9IFN0YXRlLlNhbGU7CiAgICAgICAgbmV4dFBlcmlvZCgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHRpbWUgaW50ZXJ2YWwgZm9yIGEgc3BlY2lmaWMgYHBlcmlvZGAKICAgICAqIEBwYXJhbSAgcGVyaW9kIC0gcGVyaW9kIGluZGV4IHRvIGNvdW50IGludGVydmFsIGZvcgogICAgICogQHJldHVybiBzdGFydFRpbWUgLSB0aW1lc3RhbXAgb2YgcGVyaW9kIHN0YXJ0IHRpbWUgKElOQ0xVU0lWRSkKICAgICAqIEByZXR1cm4gZW5kVGltZSAtIHRpbWVzdGFtcCBvZiBwZXJpb2QgZW5kIHRpbWUgKElOQ0xVU0lWRSkKICAgICAqLwogICAgZnVuY3Rpb24gcGVyaW9kVGltZUZyYW1lICh1aW50IHBlcmlvZCkgICBjb25zdGFudCAgIHJldHVybnMgKHVpbnQyNTYgc3RhcnRUaW1lLCB1aW50MjU2IGVuZFRpbWUpIHsgIAogICAgICAgIHJlcXVpcmUocGVyaW9kIDw9IGN1cnJlbnRQZXJpb2QpOwoKICAgICAgICBzdGFydFRpbWUgPSBwZXJpb2RzW3BlcmlvZF0uc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBwZXJpb2RzW3BlcmlvZF0uZW5kVGltZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYHRydWVgIGlmIHRoZSB0aW1lIGZvciB0aGUgYHBlcmlvZGAgaGFzIGFscmVhZHkgcGFzc2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzUGVyaW9kVGltZVBhc3NlZCAodWludCBwZXJpb2QpICAgY29uc3RhbnQgICByZXR1cm5zIChib29sIGZpbmlzaGVkKSB7ICAKICAgICAgICByZXF1aXJlKHBlcmlvZHNbcGVyaW9kXS5zdGFydFRpbWUgPiAwKTsKCiAgICAgICAgdWludDI1NiBlbmRUaW1lID0gcGVyaW9kc1twZXJpb2RdLmVuZFRpbWU7CgogICAgICAgIGlmKGVuZFRpbWUgPT0gTkVWRVIpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChlbmRUaW1lIDwgbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYHRydWVgIGlmIGBwZXJpb2RgIGhhcyBhbHJlYWR5IGZpbmlzaGVkICh0aW1lIHBhc3NlZCBvciB0b2tlbnMgc29sZCkKICAgICAqLwogICAgZnVuY3Rpb24gaXNQZXJpb2RDbG9zZWQgKHVpbnQgcGVyaW9kKSAgIGNvbnN0YW50ICAgcmV0dXJucyAoYm9vbCBmaW5pc2hlZCkgeyAgCiAgICAgICAgcmV0dXJuIHBlcmlvZCA8IGN1cnJlbnRQZXJpb2Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGB0cnVlYCBpZiBhbGwgdG9rZW5zIGZvciB0aGUgYHBlcmlvZGAgaGFzIGJlZW4gc29sZAogICAgICovCiAgICBmdW5jdGlvbiBpc1BlcmlvZEFsbFRva2Vuc1NvbGQgKHVpbnQgcGVyaW9kKSAgIGNvbnN0YW50ICAgcmV0dXJucyAoYm9vbCBmaW5pc2hlZCkgeyAgCiAgICAgICAgcmV0dXJuIHBlcmlvZHNbcGVyaW9kXS50b2tlbnNTb2xkID09IHRva2Vuc0ZvclBlcmlvZChwZXJpb2QpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB1bmNsYWltZWQgVG9rZW5zIGNvdW50IGZvciB0aGUgY2FsbGVyCiAgICAgKiBAcmV0dXJuIHRva2VucyAtIGFtb3VudCBvZiB1bmNsYWltZWQgVG9rZW5zIGZvciB0aGUgY2FsbGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVuY2xhaW1lZFRva2VucyAoKSAgIGNvbnN0YW50ICAgcmV0dXJucyAodWludDI1NiB0b2tlbnMpIHsgIAogICAgICAgIHJldHVybiB1bmNsYWltZWRUb2tlbnNGb3JJbnZlc3Rvclttc2cuc2VuZGVyXTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZmVycyBhbGwgdGhlIHRva2VucyBzdG9yZWQgZm9yIHRoaXMgYGludmVzdG9yYCB0byBoaXMgYWRkcmVzcwogICAgICogQHBhcmFtIGludmVzdG9yIC0gaW52ZXN0b3IgdG8gY2xhaW0gdG9rZW5zIGZvcgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbUFsbFRva2Vuc0ZvckludmVzdG9yIChhZGRyZXNzIGludmVzdG9yKSAgIHsgIAogICAgICAgIGFzc2VydCh0b3RhbFVuY2xhaW1lZFRva2VucyA+PSB1bmNsYWltZWRUb2tlbnNGb3JJbnZlc3RvcltpbnZlc3Rvcl0pOwogICAgICAgIHRvdGFsVW5jbGFpbWVkVG9rZW5zIC09IHVuY2xhaW1lZFRva2Vuc0ZvckludmVzdG9yW2ludmVzdG9yXTsKICAgICAgICB3aW4udHJhbnNmZXIoaW52ZXN0b3IsIHVuY2xhaW1lZFRva2Vuc0ZvckludmVzdG9yW2ludmVzdG9yXSk7CiAgICAgICAgVG9rZW5zQ2xhaW1lZChpbnZlc3RvciwgdW5jbGFpbWVkVG9rZW5zRm9ySW52ZXN0b3JbaW52ZXN0b3JdKTsKICAgICAgICB1bmNsYWltZWRUb2tlbnNGb3JJbnZlc3RvcltpbnZlc3Rvcl0gPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQ2xhaW1zIGFsbCB0aGUgdG9rZW5zIGZvciB0aGUgc2VuZGVyCiAgICAgKiBAZGV2IGVmZmljaWVudGx5IGNhbGxpbmcgYGNsYWltQWxsRm9ySW52ZXN0b3IobXNnLnNlbmRlcilgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltQWxsVG9rZW5zICgpICAgeyAgCiAgICAgICAgY2xhaW1BbGxUb2tlbnNGb3JJbnZlc3Rvcihtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHRvdGFsIHRva2VuIGNvdW50IGZvciB0aGUgcGVyaW9kIHNwZWNpZmllZAogICAgICogQHBhcmFtICBwZXJpb2QgLSBwZXJpb2QgbnVtYmVyCiAgICAgKiBAcmV0dXJuIHRva2VucyAtIHRvdGFsIHRva2VucyBjb3VudAogICAgICovCiAgICBmdW5jdGlvbiB0b2tlbnNGb3JQZXJpb2QgKHVpbnQgcGVyaW9kKSAgIGNvbnN0YW50ICAgcmV0dXJucyAodWludDI1NiB0b2tlbnMpIHsgIAogICAgICAgIGlmKHBlcmlvZCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBUT0tFTlNfRk9SX1BSRVNBTEU7CiAgICAgICAgfSBlbHNlIGlmKHBlcmlvZCA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBUT0tFTlNfUEVSX0ZJUlNUX1BFUklPRDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gVE9LRU5TX1BFUl9QRVJJT0Q7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZHVyYXRpb24gb2YgdGhlIHNhbGUgKG5vdCBwcmVzYWxlKSBwZXJpb2QKICAgICAqIEBwYXJhbSAgcGVyaW9kIC0gdGhlIHBlcmlvZCBudW1iZXIKICAgICAqIEByZXR1cm4gZHVyYXRpb24gLSBkdXJhdGlvbiBpbiBzZWNvbmRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBlcmlvZER1cmF0aW9uICh1aW50IHBlcmlvZCkgICBjb25zdGFudCAgIHJldHVybnMgKHVpbnQyNTYgZHVyYXRpb24pIHsgIAogICAgICAgIHJlcXVpcmUocGVyaW9kID4gMCk7CgogICAgICAgIGlmKHBlcmlvZCA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBGSVJTVF9QRVJJT0RfRFVSQVRJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFBFUklPRF9EVVJBVElPTjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5pc2hlcyB0aGUgY3VycmVudCBwZXJpb2QgYW5kIHN0YXJ0cyBhIG5ldyBvbmUKICAgICAqLwogICAgZnVuY3Rpb24gbmV4dFBlcmlvZCgpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IG9sZFByaWNlID0gcGVyaW9kc1tjdXJyZW50UGVyaW9kXS50b2tlblByaWNlOwogICAgICAgIHVpbnQyNTYgbmV3UHJpY2U7CiAgICAgICAgaWYoY3VycmVudFBlcmlvZCA9PSAwKSB7CiAgICAgICAgICAgIG5ld1ByaWNlID0gU0FMRV9JTklUSUFMX1RPS0VOX1BSSUNFOwogICAgICAgIH0gZWxzZSBpZihwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLnRva2Vuc1NvbGQgID09IHRva2Vuc0ZvclBlcmlvZChjdXJyZW50UGVyaW9kKSkgewogICAgICAgICAgICBuZXdQcmljZSA9IE1hdGguYWRkUHJvbWlsbGUob2xkUHJpY2UsIEZVTExZX1NPTERfUFJJQ0VfSU5DUkVBU0UpOwogICAgICAgIH0gZWxzZSBpZihwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLnRva2Vuc1NvbGQgPj0gTWF0aC50YWtlUHJvbWlsbGUodG9rZW5zRm9yUGVyaW9kKGN1cnJlbnRQZXJpb2QpLCBUT0tFTlNfVE9fSU5DUkVBU0VfTkVYVF9QUklDRSkpIHsKICAgICAgICAgICAgbmV3UHJpY2UgPSBNYXRoLmFkZFByb21pbGxlKG9sZFByaWNlLCBQRVJJT0RfUFJJQ0VfSU5DUkVBU0UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld1ByaWNlID0gb2xkUHJpY2U7CiAgICAgICAgfQoKICAgICAgICAvKiBkZXN0cm95IHVuc29sZCB0b2tlbnMgKi8KICAgICAgICBpZihwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLnRva2Vuc1NvbGQgPCB0b2tlbnNGb3JQZXJpb2QoY3VycmVudFBlcmlvZCkpIHsKICAgICAgICAgICAgdWludDI1NiB0b0Rlc3Ryb3kgPSB0b2tlbnNGb3JQZXJpb2QoY3VycmVudFBlcmlvZCkgLSBwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLnRva2Vuc1NvbGQ7CiAgICAgICAgICAgIC8qIGRvIG5vdCBkZXN0cm95IGlmIHdlIGRvbid0IGhhdmUgZW5vdWdoIHRvIHBheSBpbnZlc3RvcnMgKi8KICAgICAgICAgICAgdWludDI1NiBiYWxhbmNlID0gd2luLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICAgICAgaWYoYmFsYW5jZSA8IHRvRGVzdHJveSArIHRvdGFsVW5jbGFpbWVkVG9rZW5zKSB7CiAgICAgICAgICAgICAgICB0b0Rlc3Ryb3kgPSAoYmFsYW5jZSAtIHRvdGFsVW5jbGFpbWVkVG9rZW5zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aW4uZGVzdHJveSh0b0Rlc3Ryb3kpOwogICAgICAgICAgICB0b3RhbFRva2Vuc0Rlc3Ryb3llZCArPSB0b0Rlc3Ryb3k7CiAgICAgICAgfQoKICAgICAgICAvKiBpZiB3ZSBhcmUgZm9yY2UgZW5kaW5nIHRoZSBwZXJpb2Qgc2V0IGluIHRoZSBmdXR1cmUgb3Igd2l0aG91dCBlbmQgdGltZSwKICAgICAgICAgKiBzZXQgZW5kIHRpbWUgdG8gbm93CiAgICAgICAgICovCiAgICAgICAgaWYocGVyaW9kc1tjdXJyZW50UGVyaW9kXS5lbmRUaW1lID4gbm93IHx8CiAgICAgICAgICAgIHBlcmlvZHNbY3VycmVudFBlcmlvZF0uZW5kVGltZSA9PSBORVZFUikgewogICAgICAgICAgICBwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLmVuZFRpbWUgPSBub3c7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGR1cmF0aW9uID0gcGVyaW9kRHVyYXRpb24oY3VycmVudFBlcmlvZCArIDEpOwoKICAgICAgICBwZXJpb2RzW2N1cnJlbnRQZXJpb2QgKyAxXSA9IFBlcmlvZCgKICAgICAgICAgICAgcGVyaW9kc1tjdXJyZW50UGVyaW9kXS5lbmRUaW1lLAogICAgICAgICAgICBwZXJpb2RzW2N1cnJlbnRQZXJpb2RdLmVuZFRpbWUgKyBkdXJhdGlvbiwKICAgICAgICAgICAgbmV3UHJpY2UsCiAgICAgICAgICAgIDApOwoKICAgICAgICBjdXJyZW50UGVyaW9kKys7CgogICAgICAgIFBlcmlvZFN0YXJ0ZWQoY3VycmVudFBlcmlvZCwKICAgICAgICAgICAgbmV3UHJpY2UsCiAgICAgICAgICAgIHRva2Vuc0ZvclBlcmlvZChjdXJyZW50UGVyaW9kKSwKICAgICAgICAgICAgcGVyaW9kc1tjdXJyZW50UGVyaW9kXS5zdGFydFRpbWUsCiAgICAgICAgICAgIHBlcmlvZHNbY3VycmVudFBlcmlvZF0uZW5kVGltZSwKICAgICAgICAgICAgbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRvIGJlIGNhbGxlZCBhcyBmcmVxdWVudGx5IGFzIHJlcXVpcmVkIGJ5IGFueSBleHRlcm5hbCBwYXJ0eQogICAgICogV2lsbCBjaGVjayBpZiAxIG9yIG1vcmUgcGVyaW9kcyBoYXZlIGZpbmlzaGVkIGFuZCBtb3ZlIG9uIHRvIHRoZSBuZXh0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRpY2sgKCkgICB7ICAKICAgICAgICBpZighaXNBY3RpdmUoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB3aGlsZShzdGF0ZSA9PSBTdGF0ZS5TYWxlICYmCiAgICAgICAgICAgIChpc1BlcmlvZFRpbWVQYXNzZWQoY3VycmVudFBlcmlvZCkgfHwKICAgICAgICAgICAgaXNQZXJpb2RBbGxUb2tlbnNTb2xkKGN1cnJlbnRQZXJpb2QpKSkgewogICAgICAgICAgICBuZXh0UGVyaW9kKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2l0aGRyYXdzIHRoZSBtb25leSB0byBiZSBzcGVudCB0byBCbGluZCBDcm91cGllciBQcm9qZWN0IG5lZWRzCiAgICAgKiBAcGFyYW0gIGFtb3VudCAtIGFtb3VudCBvZiBXZWkgdG8gd2l0aGRyYXcgKHRvdGFsKQogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhdyAodWludDI1NiBhbW91bnQpICAgb25seU9uZU9mT3duZXJzICB7ICAKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+PSBhbW91bnQpOwoKICAgICAgICB1aW50IHRvdGFsU2hhcmVzID0gMDsKICAgICAgICBmb3IodmFyIGlkeCA9IDA7IGlkeCA8IG93bmVycy5sZW5ndGg7IGlkeCsrKSB7CiAgICAgICAgICAgIHRvdGFsU2hhcmVzICs9IG93bmVyc1tpZHhdLnNoYXJlOwogICAgICAgIH0KCiAgICAgICAgZm9yKGlkeCA9IDA7IGlkeCA8IG93bmVycy5sZW5ndGg7IGlkeCsrKSB7CiAgICAgICAgICAgIG93bmVyc1tpZHhdLnJlY2lwaWVudC50cmFuc2ZlcihhbW91bnQgKiBvd25lcnNbaWR4XS5zaGFyZSAvIHRvdGFsU2hhcmVzKTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
