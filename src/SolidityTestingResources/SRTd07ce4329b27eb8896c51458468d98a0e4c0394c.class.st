Class {
	#name : #SRTd07ce4329b27eb8896c51458468d98a0e4c0394c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd07ce4329b27eb8896c51458468d98a0e4c0394c >> base64 [
	^ 'Ly8gR3JvdmUgdjAuMgoKCi8vLyBAdGl0bGUgR3JvdmVMaWIgLSBMaWJyYXJ5IGZvciBxdWVyaWFibGUgaW5kZXhlZCBvcmRlcmVkIGRhdGEuCi8vLyBAYXV0aG9yIFBpcGVyTWVycmlhbSAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMGQ3ZDY0N2Q2ODdmNjA2ODdmN2Y2NDZjNjA0ZDZhNjA2YzY0NjEyMzZlNjI2MCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CmxpYnJhcnkgR3JvdmVMaWIgewogICAgICAgIC8qCiAgICAgICAgICogIEluZGV4ZXMgZm9yIG9yZGVyZWQgZGF0YQogICAgICAgICAqCiAgICAgICAgICogIEFkZHJlc3M6IDB4ZDA3Y2U0MzI5YjI3ZWI4ODk2YzUxNDU4NDY4ZDk4YTBlNGMwMzk0YwogICAgICAgICAqLwogICAgICAgIHN0cnVjdCBJbmRleCB7CiAgICAgICAgICAgICAgICBieXRlczMyIGlkOwogICAgICAgICAgICAgICAgYnl0ZXMzMiBuYW1lOwogICAgICAgICAgICAgICAgYnl0ZXMzMiByb290OwogICAgICAgICAgICAgICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBOb2RlKSBub2RlczsKICAgICAgICB9CgogICAgICAgIHN0cnVjdCBOb2RlIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgbm9kZUlkOwogICAgICAgICAgICAgICAgYnl0ZXMzMiBpbmRleElkOwogICAgICAgICAgICAgICAgYnl0ZXMzMiBpZDsKICAgICAgICAgICAgICAgIGludCB2YWx1ZTsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcGFyZW50OwogICAgICAgICAgICAgICAgYnl0ZXMzMiBsZWZ0OwogICAgICAgICAgICAgICAgYnl0ZXMzMiByaWdodDsKICAgICAgICAgICAgICAgIHVpbnQgaGVpZ2h0OwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgVGhpcyBpcyBtZXJlbHkgYSBzaG9ydGN1dCBmb3IgYHNoYTMob3duZXIsIGluZGV4TmFtZSlgCiAgICAgICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgdGhpcyBpbmRleC4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4TmFtZSBUaGUgaHVtYW4gcmVhZGFibGUgbmFtZSBmb3IgdGhpcyBpbmRleC4KICAgICAgICBmdW5jdGlvbiBjb21wdXRlSW5kZXhJZChhZGRyZXNzIG93bmVyLCBieXRlczMyIGluZGV4TmFtZSkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICAgICAgcmV0dXJuIHNoYTMob3duZXIsIGluZGV4TmFtZSk7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBUaGlzIGlzIG1lcmVseSBhIHNob3J0Y3V0IGZvciBgc2hhMyhpbmRleElkLCBpZClgCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleElkIFRoZSBpZCBmb3IgdGhlIGluZGV4IHRoZSBub2RlIGJlbG9uZ3MgdG8uCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSBkYXRhIHRoaXMgbm9kZSByZXByZXNlbnRzLgogICAgICAgIGZ1bmN0aW9uIGNvbXB1dGVOb2RlSWQoYnl0ZXMzMiBpbmRleElkLCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2hhMyhpbmRleElkLCBpZCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgICAgaWYgKGEgPj0gYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAqICBOb2RlIGdldHRlcnMKICAgICAgICAgKi8KICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSWQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0uaWQ7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgaW5kZXggaWQgZm9yIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSW5kZXhJZChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbbm9kZUlkXS5pbmRleElkOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHZhbHVlIGZvciB0aGUgbm9kZS4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVZhbHVlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChpbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0udmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgaGVpZ2h0IG9mIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSGVpZ2h0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tub2RlSWRdLmhlaWdodDsKICAgICAgICB9CgogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBwYXJlbnQgaWQgb2YgdGhlIG5vZGUuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLgogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVQYXJlbnQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0ucGFyZW50OwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIGxlZnQgY2hpbGQgaWQgb2YgdGhlIG5vZGUuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLgogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVMZWZ0Q2hpbGQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0ubGVmdDsKICAgICAgICB9CgogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSByaWdodCBjaGlsZCBpZCBvZiB0aGUgbm9kZS4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVJpZ2h0Q2hpbGQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4Lm5vZGVzW25vZGVJZF0ucmlnaHQ7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgbm9kZSBpZCBvZiB0aGUgbmV4dCBub2RlIGluIHRoZSB0cmVlLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXRQcmV2aW91c05vZGUoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5ub2RlSWQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBVbmtub3duIG5vZGUsIGp1c3QgcmV0dXJuIDB4MDsKICAgICAgICAgICAgICAgIHJldHVybiAweDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE5vZGUgbWVtb3J5IGNoaWxkOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBUcmFjZSBsZWZ0IHRvIGxhdGVzdCBjaGlsZCBpbiBsZWZ0IHRyZWUuCiAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOwoKICAgICAgICAgICAgICAgIHdoaWxlIChjaGlsZC5yaWdodCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tjaGlsZC5yaWdodF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQubm9kZUlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucGFyZW50ICE9IDB4MCkgewogICAgICAgICAgICAgICAgLy8gTm93IHdlIHRyYWNlIGJhY2sgdXAgdGhyb3VnaCBwYXJlbnQgcmVsYXRpb25zaGlwcywgbG9va2luZwogICAgICAgICAgICAgICAgLy8gZm9yIGEgbGluayB3aGVyZSB0aGUgY2hpbGQgaXMgdGhlIHJpZ2h0IGNoaWxkIG9mIGl0J3MKICAgICAgICAgICAgICAgIC8vIHBhcmVudC4KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5wYXJlbnRdOwogICAgICAgICAgICAgICAgY2hpbGQgPSBjdXJyZW50Tm9kZTsKCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucmlnaHQgPT0gY2hpbGQubm9kZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQubm9kZUlkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHBhcmVudDsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBpbmRleC5ub2Rlc1twYXJlbnQucGFyZW50XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmlyc3Qgbm9kZSwgYW5kIGhhcyBubyBwcmV2aW91cyBub2RlLgogICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIG5vZGUgaWQgb2YgdGhlIHByZXZpb3VzIG5vZGUgaW4gdGhlIHRyZWUuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLgogICAgICAgIGZ1bmN0aW9uIGdldE5leHROb2RlKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubm9kZUlkID09IDB4MCkgewogICAgICAgICAgICAgICAgLy8gVW5rbm93biBub2RlLCBqdXN0IHJldHVybiAweDA7CiAgICAgICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBOb2RlIG1lbW9yeSBjaGlsZDsKCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIFRyYWNlIHJpZ2h0IHRvIGVhcmxpZXN0IGNoaWxkIGluIHJpZ2h0IHRyZWUuCiAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsKCiAgICAgICAgICAgICAgICB3aGlsZSAoY2hpbGQubGVmdCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tjaGlsZC5sZWZ0XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZC5ub2RlSWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5wYXJlbnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbm9kZSBpcyB0aGUgbGVmdCBjaGlsZCBvZiBpdCdzIHBhcmVudCwgdGhlbiB0aGUKICAgICAgICAgICAgICAgIC8vIHBhcmVudCBpcyB0aGUgbmV4dCBvbmUuCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsKICAgICAgICAgICAgICAgIGNoaWxkID0gY3VycmVudE5vZGU7CgogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gY2hpbGQubm9kZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQubm9kZUlkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHBhcmVudDsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBpbmRleC5ub2Rlc1twYXJlbnQucGFyZW50XTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBOb3cgd2UgbmVlZCB0byB0cmFjZSBhbGwgdGhlIHdheSB1cCBjaGVja2luZyB0byBzZWUgaWYgYW55IHBhcmVudCBpcyB0aGUgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZpbmFsIG5vZGUuCiAgICAgICAgICAgIHJldHVybiAweDA7CiAgICAgICAgfQoKCiAgICAgICAgLy8vIEBkZXYgVXBkYXRlcyBvciBJbnNlcnRzIHRoZSBpZCBpbnRvIHRoZSBpbmRleCBhdCBpdHMgYXBwcm9wcmlhdGUgbG9jYXRpb24gYmFzZWQgb24gdGhlIHZhbHVlIHByb3ZpZGVkLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRoZSBpbmRleCBub2RlIHdpbGwgcmVwcmVzZW50LgogICAgICAgIC8vLyBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBkYXRhIGVsZW1lbnQgdGhhdCByZXByZXNlbnRzIGl0J3MgdG90YWwgb3JkZXJpbmcgd2l0aCByZXNwZWN0IHRvIG90aGVyIGVsZW1lbnRlcy4KICAgICAgICBmdW5jdGlvbiBpbnNlcnQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCwgaW50IHZhbHVlKSBwdWJsaWMgewogICAgICAgICAgICAgICAgYnl0ZXMzMiBub2RlSWQgPSBjb21wdXRlTm9kZUlkKGluZGV4LmlkLCBpZCk7CgogICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5vZGVzW25vZGVJZF0ubm9kZUlkID09IG5vZGVJZCkgewogICAgICAgICAgICAgICAgICAgIC8vIEEgbm9kZSB3aXRoIHRoaXMgaWQgYWxyZWFkeSBleGlzdHMuICBJZiB0aGUgdmFsdWUgaXMKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2FtZSwgdGhlbiBqdXN0IHJldHVybiBlYXJseSwgb3RoZXJ3aXNlLCByZW1vdmUgaXQKICAgICAgICAgICAgICAgICAgICAvLyBhbmQgcmVpbnNlcnQgaXQuCiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5vZGVzW25vZGVJZF0udmFsdWUgPT0gdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZW1vdmUoaW5kZXgsIGlkKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB1aW50IGxlZnRIZWlnaHQ7CiAgICAgICAgICAgICAgICB1aW50IHJpZ2h0SGVpZ2h0OwoKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcHJldmlvdXNOb2RlSWQgPSAweDA7CgogICAgICAgICAgICAgICAgYnl0ZXMzMiByb290Tm9kZUlkID0gaW5kZXgucm9vdDsKCiAgICAgICAgICAgICAgICBpZiAocm9vdE5vZGVJZCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICByb290Tm9kZUlkID0gbm9kZUlkOwogICAgICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSBub2RlSWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tyb290Tm9kZUlkXTsKCiAgICAgICAgICAgICAgICAvLyBEbyBpbnNlcnRpb24KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmluZGV4SWQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBuZXcgdW5wb3B1bGF0ZWQgbm9kZS4KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUubm9kZUlkID0gbm9kZUlkOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5wYXJlbnQgPSBwcmV2aW91c05vZGVJZDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUuaW5kZXhJZCA9IGluZGV4LmlkOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5pZCA9IGlkOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgcHJldmlvdXMgbm9kZSBpZC4KICAgICAgICAgICAgICAgICAgICBwcmV2aW91c05vZGVJZCA9IGN1cnJlbnROb2RlLm5vZGVJZDsKCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG5ldyBub2RlIGJlbG9uZ3MgaW4gdGhlIHJpZ2h0IHN1YnRyZWUKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gY3VycmVudE5vZGUudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUucmlnaHQgPSBub2RlSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG5ldyBub2RlIGJlbG9uZ3MgaW4gdGhlIGxlZnQgc3VidHJlZS4KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUubGVmdCA9IG5vZGVJZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBSZWJhbGFuY2UgdGhlIHRyZWUKICAgICAgICAgICAgICAgIF9yZWJhbGFuY2VUcmVlKGluZGV4LCBjdXJyZW50Tm9kZS5ub2RlSWQpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgQ2hlY2tzIHdoZXRoZXIgYSBub2RlIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGlkZW50aWZpZXIgZXhpc3RzIHdpdGhpbiB0aGUgZ2l2ZW4gaW5kZXguCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCBzaG91bGQgYmUgc2VhcmNoZWQKICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRvIGNoZWNrIGZvci4KICAgICAgICBmdW5jdGlvbiBleGlzdHMoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICBieXRlczMyIG5vZGVJZCA9IGNvbXB1dGVOb2RlSWQoaW5kZXguaWQsIGlkKTsKICAgICAgICAgICAgcmV0dXJuIChpbmRleC5ub2Rlc1tub2RlSWRdLm5vZGVJZCA9PSBub2RlSWQpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmVtb3ZlIHRoZSBub2RlIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGlkZW50aWZpZXIgZnJvbSB0aGUgaW5kZXguCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCBzaG91bGQgYmUgcmVtb3ZlZAogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIGVsZW1lbnQgdG8gcmVtb3ZlLgogICAgICAgIGZ1bmN0aW9uIHJlbW92ZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBwdWJsaWMgewogICAgICAgICAgICBieXRlczMyIG5vZGVJZCA9IGNvbXB1dGVOb2RlSWQoaW5kZXguaWQsIGlkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSByZXBsYWNlbWVudE5vZGU7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQ7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjaGlsZDsKICAgICAgICAgICAgYnl0ZXMzMiByZWJhbGFuY2VPcmlnaW47CgogICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugbm9kZVRvRGVsZXRlID0gaW5kZXgubm9kZXNbbm9kZUlkXTsKCiAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUuaWQgIT0gaWQpIHsKICAgICAgICAgICAgICAgIC8vIFRoZSBpZCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgdHJlZS4KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5sZWZ0ICE9IDB4MCB8fCBub2RlVG9EZWxldGUucmlnaHQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgbm90IGEgbGVhZiBub2RlIGFuZCB0aHVzIG11c3QgcmVwbGFjZSBpdHNlbGYgaW4KICAgICAgICAgICAgICAgIC8vIGl0J3MgdHJlZSBieSBlaXRoZXIgdGhlIHByZXZpb3VzIG9yIG5leHQgbm9kZS4KICAgICAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUubGVmdCAhPSAweDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZ3VhcmFudGVlZCB0byBub3QgaGF2ZSBhIHJpZ2h0IGNoaWxkLgogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2dldFByZXZpb3VzTm9kZShpbmRleCwgbm9kZVRvRGVsZXRlLm5vZGVJZCldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGd1YXJhbnRlZWQgdG8gbm90IGhhdmUgYSBsZWZ0IGNoaWxkLgogICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2dldE5leHROb2RlKGluZGV4LCBub2RlVG9EZWxldGUubm9kZUlkKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBUaGUgcmVwbGFjZW1lbnROb2RlIGlzIGd1YXJhbnRlZWQgdG8gaGF2ZSBhIHBhcmVudC4KICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW3JlcGxhY2VtZW50Tm9kZS5wYXJlbnRdOwoKICAgICAgICAgICAgICAgIC8vIEtlZXAgbm90ZSBvZiB0aGUgbG9jYXRpb24gdGhhdCBvdXIgdHJlZSByZWJhbGFuY2luZyBzaG91bGQKICAgICAgICAgICAgICAgIC8vIHN0YXJ0IGF0LgogICAgICAgICAgICAgICAgcmViYWxhbmNlT3JpZ2luID0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZDsKCiAgICAgICAgICAgICAgICAvLyBKb2luIHRoZSBwYXJlbnQgb2YgdGhlIHJlcGxhY2VtZW50IG5vZGUgd2l0aCBhbnkgc3VidHJlZSBvZgogICAgICAgICAgICAgICAgLy8gdGhlIHJlcGxhY2VtZW50IG5vZGUuICBXZSBjYW4gZ3VhcmFudGVlIHRoYXQgdGhlIHJlcGxhY2VtZW50CiAgICAgICAgICAgICAgICAvLyBub2RlIGhhcyBhdCBtb3N0IG9uZSBzdWJ0cmVlIGJlY2F1c2Ugb2YgaG93IGdldE5leHROb2RlIGFuZAogICAgICAgICAgICAgICAgLy8gZ2V0UHJldmlvdXNOb2RlIGFyZSB1c2VkLgogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IHJlcGxhY2VtZW50Tm9kZS5ub2RlSWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IHJlcGxhY2VtZW50Tm9kZS5yaWdodDsKICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnROb2RlLnJpZ2h0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW3JlcGxhY2VtZW50Tm9kZS5yaWdodF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IHBhcmVudC5ub2RlSWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSByZXBsYWNlbWVudE5vZGUubm9kZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gcmVwbGFjZW1lbnROb2RlLmxlZnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VtZW50Tm9kZS5sZWZ0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW3JlcGxhY2VtZW50Tm9kZS5sZWZ0XTsKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gcGFyZW50Lm5vZGVJZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTm93IHdlIHJlcGxhY2UgdGhlIG5vZGVUb0RlbGV0ZSB3aXRoIHRoZSByZXBsYWNlbWVudE5vZGUuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGluY2x1ZGVzIHBhcmVudC9jaGlsZCByZWxhdGlvbnNoaXBzIGZvciBhbGwgb2YgdGhlCiAgICAgICAgICAgICAgICAvLyBwYXJlbnQsIHRoZSBsZWZ0IGNoaWxkLCBhbmQgdGhlIHJpZ2h0IGNoaWxkLgogICAgICAgICAgICAgICAgcmVwbGFjZW1lbnROb2RlLnBhcmVudCA9IG5vZGVUb0RlbGV0ZS5wYXJlbnQ7CiAgICAgICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLnBhcmVudCAhPSAweDApIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUucGFyZW50XTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gbm9kZVRvRGVsZXRlLm5vZGVJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IHJlcGxhY2VtZW50Tm9kZS5ub2RlSWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucmlnaHQgPT0gbm9kZVRvRGVsZXRlLm5vZGVJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSByZXBsYWNlbWVudE5vZGUubm9kZUlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBub2RlIHdlIGFyZSBkZWxldGluZyBpcyB0aGUgcm9vdCBub2RlIHNvIHVwZGF0ZQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpbmRleElkIHRvIHJvb3Qgbm9kZSBtYXBwaW5nLgogICAgICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSByZXBsYWNlbWVudE5vZGUubm9kZUlkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZS5sZWZ0ID0gbm9kZVRvRGVsZXRlLmxlZnQ7CiAgICAgICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLmxlZnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUubGVmdF07CiAgICAgICAgICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gcmVwbGFjZW1lbnROb2RlLm5vZGVJZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXBsYWNlbWVudE5vZGUucmlnaHQgPSBub2RlVG9EZWxldGUucmlnaHQ7CiAgICAgICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLnJpZ2h0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbbm9kZVRvRGVsZXRlLnJpZ2h0XTsKICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSByZXBsYWNlbWVudE5vZGUubm9kZUlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUb0RlbGV0ZS5wYXJlbnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBUaGUgbm9kZSBiZWluZyBkZWxldGVkIGlzIGEgbGVhZiBub2RlIHNvIHdlIG9ubHkgZXJhc2UgaXQncwogICAgICAgICAgICAgICAgLy8gcGFyZW50IGxpbmthZ2UuCiAgICAgICAgICAgICAgICBwYXJlbnQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUucGFyZW50XTsKCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gbm9kZVRvRGVsZXRlLm5vZGVJZCkgewogICAgICAgICAgICAgICAgICAgIHBhcmVudC5sZWZ0ID0gMHgwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBub2RlVG9EZWxldGUubm9kZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gMHgwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGtlZXAgbm90ZSBvZiB3aGVyZSB0aGUgcmViYWxhbmNpbmcgc2hvdWxkIGJlZ2luLgogICAgICAgICAgICAgICAgcmViYWxhbmNlT3JpZ2luID0gcGFyZW50Lm5vZGVJZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYm90aCBhIGxlYWYgbm9kZSBhbmQgdGhlIHJvb3Qgbm9kZSwgc28gd2UgbmVlZCB0bwogICAgICAgICAgICAgICAgLy8gdW5zZXQgdGhlIHJvb3Qgbm9kZSBwb2ludGVyLgogICAgICAgICAgICAgICAgaW5kZXgucm9vdCA9IDB4MDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTm93IHdlIHplcm8gb3V0IGFsbCBvZiB0aGUgZmllbGRzIG9uIHRoZSBub2RlVG9EZWxldGUuCiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5pZCA9IDB4MDsKICAgICAgICAgICAgbm9kZVRvRGVsZXRlLm5vZGVJZCA9IDB4MDsKICAgICAgICAgICAgbm9kZVRvRGVsZXRlLmluZGV4SWQgPSAweDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS52YWx1ZSA9IDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5wYXJlbnQgPSAweDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5sZWZ0ID0gMHgwOwogICAgICAgICAgICBub2RlVG9EZWxldGUucmlnaHQgPSAweDA7CgogICAgICAgICAgICAvLyBXYWxrIGJhY2sgdXAgdGhlIHRyZWUgcmViYWxhbmNpbmcKICAgICAgICAgICAgaWYgKHJlYmFsYW5jZU9yaWdpbiAhPSAweDApIHsKICAgICAgICAgICAgICAgIF9yZWJhbGFuY2VUcmVlKGluZGV4LCByZWJhbGFuY2VPcmlnaW4pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBieXRlczIgY29uc3RhbnQgR1QgPSAiPiI7CiAgICAgICAgYnl0ZXMyIGNvbnN0YW50IExUID0gIjwiOwogICAgICAgIGJ5dGVzMiBjb25zdGFudCBHVEUgPSAiPj0iOwogICAgICAgIGJ5dGVzMiBjb25zdGFudCBMVEUgPSAiPD0iOwogICAgICAgIGJ5dGVzMiBjb25zdGFudCBFUSA9ICI9PSI7CgogICAgICAgIGZ1bmN0aW9uIF9jb21wYXJlKGludCBsZWZ0LCBieXRlczIgb3BlcmF0b3IsIGludCByaWdodCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gR1QpIHsKICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA+IHJpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gTFQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8IHJpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gR1RFKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPj0gcmlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBMVEUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8PSByaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09IEVRKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPT0gcmlnaHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJbnZhbGlkIG9wZXJhdG9yLgogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9nZXRNYXhpbXVtKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfZ2V0TWluaW11bShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tub2RlSWRdOwoKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvKiogQGRldiBRdWVyeSB0aGUgaW5kZXggZm9yIHRoZSBlZGdlLW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUKICAgICAgICAgKiAgZ2l2ZW4gcXVlcnkuICBGb3IgPiwgPj0sIGFuZCA9PSwgdGhpcyB3aWxsIGJlIHRoZSBsZWZ0LW1vc3Qgbm9kZQogICAgICAgICAqICB0aGF0IHNhdGlzZmllcyB0aGUgY29tcGFyaXNvbi4gIEZvciA8IGFuZCA8PSB0aGlzIHdpbGwgYmUgdGhlCiAgICAgICAgICogIHJpZ2h0LW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUgY29tcGFyaXNvbi4KICAgICAgICAgKi8KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHNob3VsZCBiZSBxdWVyaWVkCiAgICAgICAgLyoqIEBwYXJhbSBvcGVyYXRvciBPbmUgb2YgJz4nLCAnPj0nLCAnPCcsICc8PScsICc9PScgdG8gc3BlY2lmeSB3aGF0CiAgICAgICAgICogIHR5cGUgb2YgY29tcGFyaXNvbiBvcGVyYXRvciBzaG91bGQgYmUgdXNlZC4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBxdWVyeShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczIgb3BlcmF0b3IsIGludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcm9vdE5vZGVJZCA9IGluZGV4LnJvb3Q7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChyb290Tm9kZUlkID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IHRyZWUuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tyb290Tm9kZUlkXTsKCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfY29tcGFyZShjdXJyZW50Tm9kZS52YWx1ZSwgb3BlcmF0b3IsIHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIGZvdW5kIGEgbWF0Y2ggYnV0IGl0IG1pZ2h0IG5vdCBiZSB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gKmNvcnJlY3QqIG1hdGNoLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wZXJhdG9yID09IExUKSB8fCAob3BlcmF0b3IgPT0gTFRFKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmVlZCB0byBrZWVwIHRyYXZlcnNpbmcgcmlnaHQgdW50aWwgdGhpcyBpcyBubwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9uZ2VyIHRydWUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLm5vZGVJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfY29tcGFyZShfZ2V0TWluaW11bShpbmRleCwgY3VycmVudE5vZGUucmlnaHQpLCBvcGVyYXRvciwgdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgYXJlIHN0aWxsIG5vZGVzIHRvIHRoZSByaWdodCB0aGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2guCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUubm9kZUlkOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wZXJhdG9yID09IEdUKSB8fCAob3BlcmF0b3IgPT0gR1RFKSB8fCAob3BlcmF0b3IgPT0gRVEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGtlZXAgdHJhdmVyc2luZyBsZWZ0IHVudGlsIHRoaXMgaXMgbm8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvbmdlciB0cnVlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLm5vZGVJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfY29tcGFyZShfZ2V0TWF4aW11bShpbmRleCwgY3VycmVudE5vZGUubGVmdCksIG9wZXJhdG9yLCB2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLm5vZGVJZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKChvcGVyYXRvciA9PSBMVCkgfHwgKG9wZXJhdG9yID09IExURSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gbm9kZXMgdGhhdCBhcmUgbGVzcyB0aGFuIHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gcmV0dXJuIG51bGwuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKChvcGVyYXRvciA9PSBHVCkgfHwgKG9wZXJhdG9yID09IEdURSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgYXJlIG5vIG5vZGVzIHRoYXQgYXJlIGdyZWF0ZXIgdGhhbiB0aGUgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHJldHVybiBudWxsLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gRVEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnZhbHVlIDwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnZhbHVlID4gdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAweDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfcmViYWxhbmNlVHJlZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgewogICAgICAgICAgICAvLyBUcmFjZSBiYWNrIHVwIHJlYmFsYW5jaW5nIHRoZSB0cmVlIGFuZCB1cGRhdGluZyBoZWlnaHRzIGFzCiAgICAgICAgICAgIC8vIG5lZWRlZC4uCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgaW50IGJhbGFuY2VGYWN0b3IgPSBfZ2V0QmFsYW5jZUZhY3RvcihpbmRleCwgY3VycmVudE5vZGUubm9kZUlkKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFsYW5jZUZhY3RvciA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmlnaHQgcm90YXRpb24gKHRyZWUgaXMgaGVhdnkgb24gdGhlIGxlZnQpCiAgICAgICAgICAgICAgICAgICAgaWYgKF9nZXRCYWxhbmNlRmFjdG9yKGluZGV4LCBjdXJyZW50Tm9kZS5sZWZ0KSA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgc3VidHJlZSBpcyBsZWFuaW5nIHJpZ2h0IHNvIGl0IG5lZWQgdG8gYmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcm90YXRlZCBsZWZ0IGJlZm9yZSB0aGUgY3VycmVudCBub2RlIGlzIHJvdGF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmlnaHQuCiAgICAgICAgICAgICAgICAgICAgICAgIF9yb3RhdGVMZWZ0KGluZGV4LCBjdXJyZW50Tm9kZS5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZVJpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5ub2RlSWQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlRmFjdG9yID09IC0yKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTGVmdCByb3RhdGlvbiAodHJlZSBpcyBoZWF2eSBvbiB0aGUgcmlnaHQpCiAgICAgICAgICAgICAgICAgICAgaWYgKF9nZXRCYWxhbmNlRmFjdG9yKGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCkgPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgc3VidHJlZSBpcyBsZWFuaW5nIGxlZnQgc28gaXQgbmVlZCB0byBiZQogICAgICAgICAgICAgICAgICAgICAgICAvLyByb3RhdGVkIHJpZ2h0IGJlZm9yZSB0aGUgY3VycmVudCBub2RlIGlzIHJvdGF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGVmdC4KICAgICAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZVJpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9yb3RhdGVMZWZ0KGluZGV4LCBjdXJyZW50Tm9kZS5ub2RlSWQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgoLTEgPD0gYmFsYW5jZUZhY3RvcikgJiYgKGJhbGFuY2VGYWN0b3IgPD0gMSkpIHsKICAgICAgICAgICAgICAgICAgICBfdXBkYXRlTm9kZUhlaWdodChpbmRleCwgY3VycmVudE5vZGUubm9kZUlkKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucGFyZW50ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlYWNoZWQgdGhlIHJvb3Qgd2hpY2ggbWF5IGJlIG5ldyBkdWUgdG8gdHJlZQogICAgICAgICAgICAgICAgICAgIC8vIHJvdGF0aW9uLCBzbyBzZXQgaXQgYXMgdGhlIHJvb3QgYW5kIHRoZW4gYnJlYWsuCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5wYXJlbnRdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfZ2V0QmFsYW5jZUZhY3RvcihJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIG5vZGVJZCkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugbm9kZSA9IGluZGV4Lm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICAgICAgcmV0dXJuIGludChpbmRleC5ub2Rlc1tub2RlLmxlZnRdLmhlaWdodCkgLSBpbnQoaW5kZXgubm9kZXNbbm9kZS5yaWdodF0uaGVpZ2h0KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF91cGRhdGVOb2RlSGVpZ2h0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBpbnRlcm5hbCB7CiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugbm9kZSA9IGluZGV4Lm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICAgICAgbm9kZS5oZWlnaHQgPSBtYXgoaW5kZXgubm9kZXNbbm9kZS5sZWZ0XS5oZWlnaHQsIGluZGV4Lm5vZGVzW25vZGUucmlnaHRdLmhlaWdodCkgKyAxOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX3JvdGF0ZUxlZnQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBub2RlSWQpIGludGVybmFsIHsKICAgICAgICAgICAgTm9kZSBzdG9yYWdlIG9yaWdpbmFsUm9vdCA9IGluZGV4Lm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnJpZ2h0ID09IDB4MCkgewogICAgICAgICAgICAgICAgLy8gQ2Fubm90IHJvdGF0ZSBsZWZ0IGlmIHRoZXJlIGlzIG5vIHJpZ2h0IG9yaWdpbmFsUm9vdCB0byByb3RhdGUgaW50bwogICAgICAgICAgICAgICAgLy8gcGxhY2UuCiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVGhlIHJpZ2h0IGNoaWxkIGlzIHRoZSBuZXcgcm9vdCwgc28gaXQgZ2V0cyB0aGUgb3JpZ2luYWwKICAgICAgICAgICAgLy8gYG9yaWdpbmFsUm9vdC5wYXJlbnRgIGFzIGl0J3MgcGFyZW50LgogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgbmV3Um9vdCA9IGluZGV4Lm5vZGVzW29yaWdpbmFsUm9vdC5yaWdodF07CiAgICAgICAgICAgIG5ld1Jvb3QucGFyZW50ID0gb3JpZ2luYWxSb290LnBhcmVudDsKCiAgICAgICAgICAgIC8vIFRoZSBvcmlnaW5hbCByb290IG5lZWRzIHRvIGhhdmUgaXQncyByaWdodCBjaGlsZCBudWxsZWQgb3V0LgogICAgICAgICAgICBvcmlnaW5hbFJvb3QucmlnaHQgPSAweDA7CgogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnBhcmVudCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgcGFyZW50IG5vZGUsIGl0IG5lZWRzIHRvIG5vdyBwb2ludCBkb3dud2FyZCBhdAogICAgICAgICAgICAgICAgLy8gdGhlIG5ld1Jvb3Qgd2hpY2ggaXMgcm90YXRpbmcgaW50byB0aGUgcGxhY2Ugd2hlcmUgYG5vZGVgIHdhcy4KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQgPSBpbmRleC5ub2Rlc1tvcmlnaW5hbFJvb3QucGFyZW50XTsKCiAgICAgICAgICAgICAgICAvLyBmaWd1cmUgb3V0IGlmIHdlJ3JlIGEgbGVmdCBvciByaWdodCBjaGlsZCBhbmQgaGF2ZSB0aGUKICAgICAgICAgICAgICAgIC8vIHBhcmVudCBwb2ludCB0byB0aGUgbmV3IG5vZGUuCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gb3JpZ2luYWxSb290Lm5vZGVJZCkgewogICAgICAgICAgICAgICAgICAgIHBhcmVudC5sZWZ0ID0gbmV3Um9vdC5ub2RlSWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocGFyZW50LnJpZ2h0ID09IG9yaWdpbmFsUm9vdC5ub2RlSWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSBuZXdSb290Lm5vZGVJZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIGlmIChuZXdSb290LmxlZnQgIT0gMCkgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5ldyByb290IGhhZCBhIGxlZnQgY2hpbGQsIHRoYXQgbW92ZXMgdG8gYmUgdGhlCiAgICAgICAgICAgICAgICAvLyBuZXcgcmlnaHQgY2hpbGQgb2YgdGhlIG9yaWdpbmFsIHJvb3Qgbm9kZQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGxlZnRDaGlsZCA9IGluZGV4Lm5vZGVzW25ld1Jvb3QubGVmdF07CiAgICAgICAgICAgICAgICBvcmlnaW5hbFJvb3QucmlnaHQgPSBsZWZ0Q2hpbGQubm9kZUlkOwogICAgICAgICAgICAgICAgbGVmdENoaWxkLnBhcmVudCA9IG9yaWdpbmFsUm9vdC5ub2RlSWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbmV3Um9vdCdzIGxlZnQgbm9kZSB0byBwb2ludCBhdCB0aGUgb3JpZ2luYWwgbm9kZS4KICAgICAgICAgICAgb3JpZ2luYWxSb290LnBhcmVudCA9IG5ld1Jvb3Qubm9kZUlkOwogICAgICAgICAgICBuZXdSb290LmxlZnQgPSBvcmlnaW5hbFJvb3Qubm9kZUlkOwoKICAgICAgICAgICAgaWYgKG5ld1Jvb3QucGFyZW50ID09IDB4MCkgewogICAgICAgICAgICAgICAgaW5kZXgucm9vdCA9IG5ld1Jvb3Qubm9kZUlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUT0RPOiBhcmUgYm90aCBvZiB0aGVzZSB1cGRhdGVzIG5lY2Vzc2FyeT8KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG9yaWdpbmFsUm9vdC5ub2RlSWQpOwogICAgICAgICAgICBfdXBkYXRlTm9kZUhlaWdodChpbmRleCwgbmV3Um9vdC5ub2RlSWQpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX3JvdGF0ZVJpZ2h0KEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgbm9kZUlkKSBpbnRlcm5hbCB7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBvcmlnaW5hbFJvb3QgPSBpbmRleC5ub2Rlc1tub2RlSWRdOwoKICAgICAgICAgICAgaWYgKG9yaWdpbmFsUm9vdC5sZWZ0ID09IDB4MCkgewogICAgICAgICAgICAgICAgLy8gQ2Fubm90IHJvdGF0ZSByaWdodCBpZiB0aGVyZSBpcyBubyBsZWZ0IG5vZGUgdG8gcm90YXRlIGludG8KICAgICAgICAgICAgICAgIC8vIHBsYWNlLgogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRoZSBsZWZ0IGNoaWxkIGlzIHRha2luZyB0aGUgcGxhY2Ugb2Ygbm9kZSwgc28gd2UgdXBkYXRlIGl0J3MKICAgICAgICAgICAgLy8gcGFyZW50IHRvIGJlIHRoZSBvcmlnaW5hbCBwYXJlbnQgb2YgdGhlIG5vZGUuCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBuZXdSb290ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LmxlZnRdOwogICAgICAgICAgICBuZXdSb290LnBhcmVudCA9IG9yaWdpbmFsUm9vdC5wYXJlbnQ7CgogICAgICAgICAgICAvLyBOdWxsIG91dCB0aGUgb3JpZ2luYWxSb290LmxlZnQKICAgICAgICAgICAgb3JpZ2luYWxSb290LmxlZnQgPSAweDA7CgogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnBhcmVudCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBub2RlIGhhcyBhIHBhcmVudCwgdXBkYXRlIHRoZSBjb3JyZWN0IGNoaWxkIHRvIHBvaW50CiAgICAgICAgICAgICAgICAvLyBhdCB0aGUgbmV3Um9vdCBub3cuCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbb3JpZ2luYWxSb290LnBhcmVudF07CgogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IG9yaWdpbmFsUm9vdC5ub2RlSWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IG5ld1Jvb3Qubm9kZUlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBvcmlnaW5hbFJvb3Qubm9kZUlkKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gbmV3Um9vdC5ub2RlSWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuZXdSb290LnJpZ2h0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHJpZ2h0Q2hpbGQgPSBpbmRleC5ub2Rlc1tuZXdSb290LnJpZ2h0XTsKICAgICAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5sZWZ0ID0gbmV3Um9vdC5yaWdodDsKICAgICAgICAgICAgICAgIHJpZ2h0Q2hpbGQucGFyZW50ID0gb3JpZ2luYWxSb290Lm5vZGVJZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBuZXcgcm9vdCdzIHJpZ2h0IG5vZGUgdG8gcG9pbnQgdG8gdGhlIG9yaWdpbmFsIG5vZGUuCiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5wYXJlbnQgPSBuZXdSb290Lm5vZGVJZDsKICAgICAgICAgICAgbmV3Um9vdC5yaWdodCA9IG9yaWdpbmFsUm9vdC5ub2RlSWQ7CgogICAgICAgICAgICBpZiAobmV3Um9vdC5wYXJlbnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gbmV3Um9vdC5ub2RlSWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFJlY29tcHV0ZSBoZWlnaHRzLgogICAgICAgICAgICBfdXBkYXRlTm9kZUhlaWdodChpbmRleCwgb3JpZ2luYWxSb290Lm5vZGVJZCk7CiAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBuZXdSb290Lm5vZGVJZCk7CiAgICAgICAgfQp9CgoKLy8vIEB0aXRsZSBHcm92ZSAtIHF1ZXJ5YWJsZSBpbmRleGVzIGZvciBvcmRlcmVkIGRhdGEuCi8vLyBAYXV0aG9yIFBpcGVyIE1lcnJpYW0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIxZjZmNzY2ZjdhNmQ3MjdhNmQ2ZDc2N2U3MjVmNzg3MjdlNzY3MzMxN2M3MDcyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgR3JvdmUgewogICAgICAgIC8qCiAgICAgICAgICogIEluZGV4ZXMgZm9yIG9yZGVyZWQgZGF0YQogICAgICAgICAqCiAgICAgICAgICogIEFkZHJlc3M6IDB4ODAxN2YyNGE0N2M4ODliMWVlODA1MDFmZjg0YmViM2MwMTdlZGYwYgogICAgICAgICAqLwogICAgICAgIC8vIE1hcCBpbmRleF9pZCB0byBpbmRleAogICAgICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gR3JvdmVMaWIuSW5kZXgpIGluZGV4X2xvb2t1cDsKCiAgICAgICAgLy8gTWFwIG5vZGVfaWQgdG8gaW5kZXhfaWQuCiAgICAgICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBub2RlX3RvX2luZGV4OwoKICAgICAgICAvLy8gQG5vdGljZSBDb21wdXRlcyB0aGUgaWQgZm9yIGEgR3JvdmUgaW5kZXggd2hpY2ggaXMgc2hhMyhvd25lciwgaW5kZXhOYW1lKQogICAgICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGluZGV4IG93bmVyLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhOYW1lIFRoZSBuYW1lIG9mIHRoZSBpbmRleC4KICAgICAgICBmdW5jdGlvbiBjb21wdXRlSW5kZXhJZChhZGRyZXNzIG93bmVyLCBieXRlczMyIGluZGV4TmFtZSkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmNvbXB1dGVJbmRleElkKG93bmVyLCBpbmRleE5hbWUpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBub3RpY2UgQ29tcHV0ZXMgdGhlIGlkIGZvciBhIG5vZGUgaW4gYSBnaXZlbiBHcm92ZSBpbmRleCB3aGljaCBpcyBzaGEzKGluZGV4SWQsIGlkKQogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhJZCBUaGUgaWQgZm9yIHRoZSBpbmRleCB0aGUgbm9kZSBiZWxvbmdzIHRvLgogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgZGF0YSB0aGlzIG5vZGUgcmVwcmVzZW50cy4KICAgICAgICBmdW5jdGlvbiBjb21wdXRlTm9kZUlkKGJ5dGVzMzIgaW5kZXhJZCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmNvbXB1dGVOb2RlSWQoaW5kZXhJZCwgaWQpOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAgKiAgTm9kZSBnZXR0ZXJzCiAgICAgICAgICovCiAgICAgICAgLy8vIEBub3RpY2UgUmV0cmlldmVzIHRoZSBuYW1lIG9mIGFuIGluZGV4LgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhJZCBUaGUgaWQgb2YgdGhlIGluZGV4LgogICAgICAgIGZ1bmN0aW9uIGdldEluZGV4TmFtZShieXRlczMyIGluZGV4SWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4X2xvb2t1cFtpbmRleElkXS5uYW1lOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBub3RpY2UgUmV0cmlldmVzIHRoZSBpZCBvZiB0aGUgcm9vdCBub2RlIGZvciB0aGlzIGluZGV4LgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXhJZCBUaGUgaWQgb2YgdGhlIGluZGV4LgogICAgICAgIGZ1bmN0aW9uIGdldEluZGV4Um9vdChieXRlczMyIGluZGV4SWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4X2xvb2t1cFtpbmRleElkXS5yb290OwogICAgICAgIH0KCgogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSB1bmlxdWUgaWRlbnRpZmllciB0aGlzIG5vZGUgcmVwcmVzZW50cy4KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUlkKGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIHJldHVybiBHcm92ZUxpYi5nZXROb2RlSWQoaW5kZXhfbG9va3VwW25vZGVfdG9faW5kZXhbbm9kZUlkXV0sIG5vZGVJZCk7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgaW5kZXggaWQgZm9yIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUKICAgICAgICBmdW5jdGlvbiBnZXROb2RlSW5kZXhJZChieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZUluZGV4SWQoaW5kZXhfbG9va3VwW25vZGVfdG9faW5kZXhbbm9kZUlkXV0sIG5vZGVJZCk7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgdmFsdWUgb2YgdGhlIG5vZGUuCiAgICAgICAgLy8vIEBwYXJhbSBub2RlSWQgVGhlIGlkIGZvciB0aGUgbm9kZQogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVWYWx1ZShieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoaW50KSB7CiAgICAgICAgICAgIHJldHVybiBHcm92ZUxpYi5nZXROb2RlVmFsdWUoaW5kZXhfbG9va3VwW25vZGVfdG9faW5kZXhbbm9kZUlkXV0sIG5vZGVJZCk7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgaGVpZ2h0IG9mIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUKICAgICAgICBmdW5jdGlvbiBnZXROb2RlSGVpZ2h0KGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICAgIHJldHVybiBHcm92ZUxpYi5nZXROb2RlSGVpZ2h0KGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHBhcmVudCBpZCBvZiB0aGUgbm9kZS4KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVBhcmVudChieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZVBhcmVudChpbmRleF9sb29rdXBbbm9kZV90b19pbmRleFtub2RlSWRdXSwgbm9kZUlkKTsKICAgICAgICB9CgogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBsZWZ0IGNoaWxkIGlkIG9mIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUKICAgICAgICBmdW5jdGlvbiBnZXROb2RlTGVmdENoaWxkKGJ5dGVzMzIgbm9kZUlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIHJldHVybiBHcm92ZUxpYi5nZXROb2RlTGVmdENoaWxkKGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHJpZ2h0IGNoaWxkIGlkIG9mIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUKICAgICAgICBmdW5jdGlvbiBnZXROb2RlUmlnaHRDaGlsZChieXRlczMyIG5vZGVJZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZ2V0Tm9kZVJpZ2h0Q2hpbGQoaW5kZXhfbG9va3VwW25vZGVfdG9faW5kZXhbbm9kZUlkXV0sIG5vZGVJZCk7CiAgICAgICAgfQoKICAgICAgICAvKiogQGRldiBSZXRyaWV2ZSB0aGUgaWQgb2YgdGhlIG5vZGUgdGhhdCBjb21lcyBpbW1lZGlhdGVseSBiZWZvcmUgdGhpcwogICAgICAgICAqICBvbmUuICBSZXR1cm5zIDB4MCBpZiB0aGVyZSBpcyBubyBwcmV2aW91cyBub2RlLgogICAgICAgICAqLwogICAgICAgIC8vLyBAcGFyYW0gbm9kZUlkIFRoZSBpZCBmb3IgdGhlIG5vZGUKICAgICAgICBmdW5jdGlvbiBnZXRQcmV2aW91c05vZGUoYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmdldFByZXZpb3VzTm9kZShpbmRleF9sb29rdXBbbm9kZV90b19pbmRleFtub2RlSWRdXSwgbm9kZUlkKTsKICAgICAgICB9CgogICAgICAgIC8qKiBAZGV2IFJldHJpZXZlIHRoZSBpZCBvZiB0aGUgbm9kZSB0aGF0IGNvbWVzIGltbWVkaWF0ZWx5IGFmdGVyIHRoaXMKICAgICAgICAgKiAgb25lLiAgUmV0dXJucyAweDAgaWYgdGhlcmUgaXMgbm8gcHJldmlvdXMgbm9kZS4KICAgICAgICAgKi8KICAgICAgICAvLy8gQHBhcmFtIG5vZGVJZCBUaGUgaWQgZm9yIHRoZSBub2RlCiAgICAgICAgZnVuY3Rpb24gZ2V0TmV4dE5vZGUoYnl0ZXMzMiBub2RlSWQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLmdldE5leHROb2RlKGluZGV4X2xvb2t1cFtub2RlX3RvX2luZGV4W25vZGVJZF1dLCBub2RlSWQpOwogICAgICAgIH0KCiAgICAgICAgLyoqIEBkZXYgVXBkYXRlIG9yIEluc2VydCBhIGRhdGEgZWxlbWVudCByZXByZXNlbnRlZCBieSB0aGUgdW5pcXVlCiAgICAgICAgICogIGlkZW50aWZpZXIgYGlkYCBpbnRvIHRoZSBpbmRleC4KICAgICAgICAgKi8KICAgICAgICAvLy8gQHBhcmFtIGluZGV4TmFtZSBUaGUgaHVtYW4gcmVhZGFibGUgbmFtZSBmb3IgdGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgc2hvdWxkIGJlIHVwc2VydGVkIGludG8uCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgdW5pcXVlIGlkZW50aWZpZXIgdGhhdCB0aGUgaW5kZXggbm9kZSByZXByZXNlbnRzLgogICAgICAgIC8vLyBAcGFyYW0gdmFsdWUgVGhlIG51bWJlciB3aGljaCByZXByZXNlbnRzIHRoaXMgZGF0YSBlbGVtZW50cyB0b3RhbCBvcmRlcmluZy4KICAgICAgICBmdW5jdGlvbiBpbnNlcnQoYnl0ZXMzMiBpbmRleE5hbWUsIGJ5dGVzMzIgaWQsIGludCB2YWx1ZSkgcHVibGljIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgaW5kZXhJZCA9IGNvbXB1dGVJbmRleElkKG1zZy5zZW5kZXIsIGluZGV4TmFtZSk7CiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBpbmRleF9sb29rdXBbaW5kZXhJZF07CgogICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5hbWUgIT0gaW5kZXhOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBuZXcgaW5kZXgsIHN0b3JlIGl0J3MgbmFtZSBhbmQgaWQKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgubmFtZSA9IGluZGV4TmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXguaWQgPSBpbmRleElkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBtYXBwaW5nIGZyb20gbm9kZUlkIHRvIHRoZSBpbmRleElkCiAgICAgICAgICAgICAgICBub2RlX3RvX2luZGV4W2NvbXB1dGVOb2RlSWQoaW5kZXhJZCwgaWQpXSA9IGluZGV4SWQ7CgogICAgICAgICAgICAgICAgR3JvdmVMaWIuaW5zZXJ0KGluZGV4LCBpZCwgdmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUXVlcnkgd2hldGhlciBhIG5vZGUgZXhpc3RzIHdpdGhpbiB0aGUgc3BlY2lmaWVkIGluZGV4IGZvciB0aGUgdW5pcXVlIGlkZW50aWZpZXIuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleElkIFRoZSBpZCBmb3IgdGhlIGluZGV4LgogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIGVsZW1lbnQuCiAgICAgICAgZnVuY3Rpb24gZXhpc3RzKGJ5dGVzMzIgaW5kZXhJZCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICByZXR1cm4gR3JvdmVMaWIuZXhpc3RzKGluZGV4X2xvb2t1cFtpbmRleElkXSwgaWQpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmVtb3ZlIHRoZSBpbmRleCBub2RlIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGlkZW50aWZpZXIuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleE5hbWUgVGhlIG5hbWUgb2YgdGhlIGluZGV4LgogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIGVsZW1lbnQuCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGJ5dGVzMzIgaW5kZXhOYW1lLCBieXRlczMyIGlkKSBwdWJsaWMgewogICAgICAgICAgICBHcm92ZUxpYi5yZW1vdmUoaW5kZXhfbG9va3VwW2NvbXB1dGVJbmRleElkKG1zZy5zZW5kZXIsIGluZGV4TmFtZSldLCBpZCk7CiAgICAgICAgfQoKICAgICAgICAvKiogQGRldiBRdWVyeSB0aGUgaW5kZXggZm9yIHRoZSBlZGdlLW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUKICAgICAgICAgKiBnaXZlbiBxdWVyeS4gIEZvciA+LCA+PSwgYW5kID09LCB0aGlzIHdpbGwgYmUgdGhlIGxlZnQtbW9zdCBub2RlCiAgICAgICAgICogdGhhdCBzYXRpc2ZpZXMgdGhlIGNvbXBhcmlzb24uICBGb3IgPCBhbmQgPD0gdGhpcyB3aWxsIGJlIHRoZQogICAgICAgICAqIHJpZ2h0LW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUgY29tcGFyaXNvbi4KICAgICAgICAgKi8KICAgICAgICAvLy8gQHBhcmFtIGluZGV4SWQgVGhlIGlkIG9mIHRoZSBpbmRleCB0aGF0IHNob3VsZCBiZSBxdWVyaWVkCiAgICAgICAgLyoqIEBwYXJhbSBvcGVyYXRvciBPbmUgb2YgJz4nLCAnPj0nLCAnPCcsICc8PScsICc9PScgdG8gc3BlY2lmeSB3aGF0CiAgICAgICAgICogIHR5cGUgb2YgY29tcGFyaXNvbiBvcGVyYXRvciBzaG91bGQgYmUgdXNlZC4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBxdWVyeShieXRlczMyIGluZGV4SWQsIGJ5dGVzMiBvcGVyYXRvciwgaW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICAgICAgcmV0dXJuIEdyb3ZlTGliLnF1ZXJ5KGluZGV4X2xvb2t1cFtpbmRleElkXSwgb3BlcmF0b3IsIHZhbHVlKTsKICAgICAgICB9Cn0='.
	

]
