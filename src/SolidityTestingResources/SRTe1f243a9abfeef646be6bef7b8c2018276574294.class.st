Class {
	#name : #SRTe1f243a9abfeef646be6bef7b8c2018276574294,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe1f243a9abfeef646be6bef7b8c2018276574294 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKCgovKioKICogQHRpdGxlIE1hbmFnZWFibGUKICogQGRldiBDb250cmFjdCB0aGF0IGFsbG93cyB0byBncmFudCBwZXJtaXNzaW9ucyB0byBhbnkgYWRkcmVzcwogKiBAZGV2IEluIHJlYWwgbGlmZSB3ZSBhcmUgbm8gYWJsZSB0byBwZXJmb3JtIGFsbCBhY3Rpb25zIHdpdGgganVzdCBvbmUgRXRoZXJldW0gYWRkcmVzcwogKiBAZGV2IGJlY2F1c2Ugcmlza3MgYXJlIHRvbyBoaWdoLgogKiBAZGV2IEluc3RlYWQgb3duZXIgZGVsZWdhdGVzIHJpZ2h0cyB0byBtYW5hZ2UgYW4gY29udHJhY3QgdG8gdGhlIGRpZmZlcmVudCBhZGRyZXNzZXMgYW5kCiAqIEBkZXYgc3RheSBhYmxlIHRvIHJldm9rZSBwZXJtaXNzaW9ucyBhdCBhbnkgdGltZS4KICovCmNvbnRyYWN0IE1hbmFnZWFibGUgaXMgT3duYWJsZSB7CgogIC8qIFN0b3JhZ2UgKi8KCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBtYW5hZ2VyRW5hYmxlZDsgIC8vIGhhcmQgc3dpdGNoIGZvciBhIG1hbmFnZXIgLSBvbi9vZmYKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKHN0cmluZyA9PiBib29sKSkgbWFuYWdlclBlcm1pc3Npb25zOyAgLy8gZGV0YWlsZWQgaW5mbyBhYm91dCBtYW5hZ2VyYHMgcGVybWlzc2lvbnMKCgogIC8qIEV2ZW50cyAqLwoKICBldmVudCBNYW5hZ2VyRW5hYmxlZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBtYW5hZ2VyKTsKICBldmVudCBNYW5hZ2VyRGlzYWJsZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgbWFuYWdlcik7CiAgZXZlbnQgTWFuYWdlclBlcm1pc3Npb25HcmFudGVkRXZlbnQoYWRkcmVzcyBpbmRleGVkIG1hbmFnZXIsIHN0cmluZyBwZXJtaXNzaW9uKTsKICBldmVudCBNYW5hZ2VyUGVybWlzc2lvblJldm9rZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgbWFuYWdlciwgc3RyaW5nIHBlcm1pc3Npb24pOwoKCiAgLyogQ29uZmlndXJlIGNvbnRyYWN0ICovCgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gYWRkIG5ldyBtYW5hZ2VyCiAgICogQHBhcmFtIF9tYW5hZ2VyIGFkZHJlc3MgTmV3IG1hbmFnZXIKICAgKi8KICBmdW5jdGlvbiBlbmFibGVNYW5hZ2VyKGFkZHJlc3MgX21hbmFnZXIpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSB7CiAgICByZXF1aXJlKG1hbmFnZXJFbmFibGVkW19tYW5hZ2VyXSA9PSBmYWxzZSk7CgogICAgbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdID0gdHJ1ZTsKICAgIE1hbmFnZXJFbmFibGVkRXZlbnQoX21hbmFnZXIpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byByZW1vdmUgZXhpc3RpbmcgbWFuYWdlcgogICAqIEBwYXJhbSBfbWFuYWdlciBhZGRyZXNzIEV4aXN0aW5nIG1hbmFnZXIKICAgKi8KICBmdW5jdGlvbiBkaXNhYmxlTWFuYWdlcihhZGRyZXNzIF9tYW5hZ2VyKSBleHRlcm5hbCBvbmx5T3duZXIgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikgewogICAgcmVxdWlyZShtYW5hZ2VyRW5hYmxlZFtfbWFuYWdlcl0gPT0gdHJ1ZSk7CgogICAgbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdID0gZmFsc2U7CiAgICBNYW5hZ2VyRGlzYWJsZWRFdmVudChfbWFuYWdlcik7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGdyYW50IG5ldyBwZXJtaXNzaW9uIHRvIHRoZSBtYW5hZ2VyCiAgICogQHBhcmFtIF9tYW5hZ2VyICAgICAgICBhZGRyZXNzIEV4aXN0aW5nIG1hbmFnZXIKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgR3JhbnRlZCBwZXJtaXNzaW9uIG5hbWUKICAgKi8KICBmdW5jdGlvbiBncmFudE1hbmFnZXJQZXJtaXNzaW9uKAogICAgYWRkcmVzcyBfbWFuYWdlciwgc3RyaW5nIF9wZXJtaXNzaW9uTmFtZQogICkKICAgIGV4dGVybmFsCiAgICBvbmx5T3duZXIKICAgIG9ubHlWYWxpZEFkZHJlc3MoX21hbmFnZXIpCiAgICBvbmx5VmFsaWRQZXJtaXNzaW9uTmFtZShfcGVybWlzc2lvbk5hbWUpCiAgewogICAgcmVxdWlyZShtYW5hZ2VyUGVybWlzc2lvbnNbX21hbmFnZXJdW19wZXJtaXNzaW9uTmFtZV0gPT0gZmFsc2UpOwoKICAgIG1hbmFnZXJQZXJtaXNzaW9uc1tfbWFuYWdlcl1bX3Blcm1pc3Npb25OYW1lXSA9IHRydWU7CiAgICBNYW5hZ2VyUGVybWlzc2lvbkdyYW50ZWRFdmVudChfbWFuYWdlciwgX3Blcm1pc3Npb25OYW1lKTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gcmV2b2tlIHBlcm1pc3Npb24gb2YgdGhlIG1hbmFnZXIKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgRXhpc3RpbmcgbWFuYWdlcgogICAqIEBwYXJhbSBfcGVybWlzc2lvbk5hbWUgc3RyaW5nICBSZXZva2VkIHBlcm1pc3Npb24gbmFtZQogICAqLwogIGZ1bmN0aW9uIHJldm9rZU1hbmFnZXJQZXJtaXNzaW9uKAogICAgYWRkcmVzcyBfbWFuYWdlciwgc3RyaW5nIF9wZXJtaXNzaW9uTmFtZQogICkKICAgIGV4dGVybmFsCiAgICBvbmx5T3duZXIKICAgIG9ubHlWYWxpZEFkZHJlc3MoX21hbmFnZXIpCiAgICBvbmx5VmFsaWRQZXJtaXNzaW9uTmFtZShfcGVybWlzc2lvbk5hbWUpCiAgewogICAgcmVxdWlyZShtYW5hZ2VyUGVybWlzc2lvbnNbX21hbmFnZXJdW19wZXJtaXNzaW9uTmFtZV0gPT0gdHJ1ZSk7CgogICAgbWFuYWdlclBlcm1pc3Npb25zW19tYW5hZ2VyXVtfcGVybWlzc2lvbk5hbWVdID0gZmFsc2U7CiAgICBNYW5hZ2VyUGVybWlzc2lvblJldm9rZWRFdmVudChfbWFuYWdlciwgX3Blcm1pc3Npb25OYW1lKTsKICB9CgoKICAvKiBHZXR0ZXJzICovCgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgbWFuYWdlciBzdGF0dXMKICAgKiBAcGFyYW0gX21hbmFnZXIgYWRkcmVzcyBNYW5hZ2VyYHMgYWRkcmVzcwogICAqIEByZXR1cm4gVHJ1ZSBpZiBtYW5hZ2VyIGlzIGVuYWJsZWQKICAgKi8KICBmdW5jdGlvbiBpc01hbmFnZXJFbmFibGVkKGFkZHJlc3MgX21hbmFnZXIpIHB1YmxpYyBjb25zdGFudCBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayBwZXJtaXNzaW9ucyBvZiBhIG1hbmFnZXIKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgTWFuYWdlcmBzIGFkZHJlc3MKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgUGVybWlzc2lvbiBuYW1lCiAgICogQHJldHVybiBUcnVlIGlmIG1hbmFnZXIgaGFzIGJlZW4gZ3JhbnRlZCBuZWVkZWQgcGVybWlzc2lvbgogICAqLwogIGZ1bmN0aW9uIGlzUGVybWlzc2lvbkdyYW50ZWQoCiAgICBhZGRyZXNzIF9tYW5hZ2VyLCBzdHJpbmcgX3Blcm1pc3Npb25OYW1lCiAgKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikKICAgIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKF9wZXJtaXNzaW9uTmFtZSkKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIG1hbmFnZXJQZXJtaXNzaW9uc1tfbWFuYWdlcl1bX3Blcm1pc3Npb25OYW1lXTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIG1hbmFnZXIgY2FuIHBlcmZvcm0gdGhlIGFjdGlvbiBvciBub3QKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgTWFuYWdlcmBzIGFkZHJlc3MKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgUGVybWlzc2lvbiBuYW1lCiAgICogQHJldHVybiBUcnVlIGlmIG1hbmFnZXIgaXMgZW5hYmxlZCBhbmQgaGFzIGJlZW4gZ3JhbnRlZCBuZWVkZWQgcGVybWlzc2lvbgogICAqLwogIGZ1bmN0aW9uIGlzTWFuYWdlckFsbG93ZWQoCiAgICBhZGRyZXNzIF9tYW5hZ2VyLCBzdHJpbmcgX3Blcm1pc3Npb25OYW1lCiAgKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikKICAgIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKF9wZXJtaXNzaW9uTmFtZSkKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIChtYW5hZ2VyRW5hYmxlZFtfbWFuYWdlcl0gJiYgbWFuYWdlclBlcm1pc3Npb25zW19tYW5hZ2VyXVtfcGVybWlzc2lvbk5hbWVdKTsKICB9CgoKICAvKiBIZWxwZXJzICovCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gY2hlY2sgbWFuYWdlciBhZGRyZXNzCiAgICovCiAgbW9kaWZpZXIgb25seVZhbGlkQWRkcmVzcyhhZGRyZXNzIF9tYW5hZ2VyKSB7CiAgICByZXF1aXJlKF9tYW5hZ2VyICE9IGFkZHJlc3MoMHgwKSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBjaGVjayBuYW1lIG9mIG1hbmFnZXIgcGVybWlzc2lvbgogICAqLwogIG1vZGlmaWVyIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKHN0cmluZyBfcGVybWlzc2lvbk5hbWUpIHsKICAgIHJlcXVpcmUoYnl0ZXMoX3Blcm1pc3Npb25OYW1lKS5sZW5ndGggIT0gMCk7CiAgICBfOwogIH0KCgogIC8qIE91dGNvbWUgKi8KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byB1c2UgaW4gZGVyaXZlZCBjb250cmFjdHMKICAgKi8KICBtb2RpZmllciBvbmx5QWxsb3dlZE1hbmFnZXIoc3RyaW5nIF9wZXJtaXNzaW9uTmFtZSkgewogICAgcmVxdWlyZShpc01hbmFnZXJBbGxvd2VkKG1zZy5zZW5kZXIsIF9wZXJtaXNzaW9uTmFtZSkgPT0gdHJ1ZSk7CiAgICBfOwogIH0KfQoKCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICogQGRldiBCYXNlZCBvbiB6ZXBwZWxpbidzIFBhdXNhYmxlLCBidXQgaW50ZWdyYXRlZCB3aXRoIE1hbmFnZWFibGUKICogQGRldiBDb250cmFjdCBpcyBpbiBwYXVzZWQgc3RhdGUgYnkgZGVmYXVsdCBhbmQgc2hvdWxkIGJlIGV4cGxpY2l0bHkgdW5sb2NrZWQKICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE1hbmFnZWFibGUgewoKICAvKioKICAgKiBFdmVudHMKICAgKi8KCiAgZXZlbnQgUGF1c2VFdmVudCgpOwogIGV2ZW50IFVucGF1c2VFdmVudCgpOwoKCiAgLyoqCiAgICogU3RvcmFnZQogICAqLwoKICBib29sIHBhdXNlZCA9IHRydWU7CgoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuQ29udHJhY3ROb3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCA9PSBmYWxzZSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Db250cmFjdFBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCA9PSB0cnVlKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgbWFuYWdlciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlQ29udHJhY3QoKSBleHRlcm5hbCBvbmx5QWxsb3dlZE1hbmFnZXIoJ3BhdXNlX2NvbnRyYWN0Jykgd2hlbkNvbnRyYWN0Tm90UGF1c2VkIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZUV2ZW50KCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgbWFuYWdlciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2VDb250cmFjdCgpIGV4dGVybmFsIG9ubHlBbGxvd2VkTWFuYWdlcigndW5wYXVzZV9jb250cmFjdCcpIHdoZW5Db250cmFjdFBhdXNlZCB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2VFdmVudCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBUaGUgZ2V0dGVyIGZvciAicGF1c2VkIiBjb250cmFjdCB2YXJpYWJsZQogICAqLwogIGZ1bmN0aW9uIGdldFBhdXNlZCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBwYXVzZWQ7CiAgfQp9CgoKCi8qKgogKiBAdGl0bGUgTmFtZWRUb2tlbgogKi8KY29udHJhY3QgTmFtZWRUb2tlbiB7CiAgc3RyaW5nIHB1YmxpYyBuYW1lOwogIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgZnVuY3Rpb24gTmFtZWRUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpIHB1YmxpYyB7CiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBoYXNoIG9mIHRoZSB0b2tlbmBzIG5hbWUuCiAgICogQGRldiBGdW5jdGlvbiBuZWVkZWQgYmVjYXVzZSB3ZSBjYW4gbm90IGp1c3QgcmV0dXJuIG5hbWUgb2YgdGhlIHRva2VuIHRvIGFub3RoZXIgY29udHJhY3QgLSBzdHJpbmdzIGhhdmUgdmFyaWFibGUgbGVuZ3RoCiAgICogQHJldHVybiBIYXNoIG9mIHRoZSB0b2tlbmBzIG5hbWUKICAgKi8KICBmdW5jdGlvbiBnZXROYW1lSGFzaCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0KXsKICAgIHJldHVybiBrZWNjYWsyNTYobmFtZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBoYXNoIG9mIHRoZSB0b2tlbmBzIHN5bWJvbC4KICAgKiBAZGV2IEZ1bmN0aW9uIG5lZWRlZCBiZWNhdXNlIHdlIGNhbiBub3QganVzdCByZXR1cm4gc3ltYm9sIG9mIHRoZSB0b2tlbiB0byBhbm90aGVyIGNvbnRyYWN0IC0gc3RyaW5ncyBoYXZlIHZhcmlhYmxlIGxlbmd0aAogICAqIEByZXR1cm4gSGFzaCBvZiB0aGUgdG9rZW5gcyBzeW1ib2wKICAgKi8KICBmdW5jdGlvbiBnZXRTeW1ib2xIYXNoKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpewogICAgcmV0dXJuIGtlY2NhazI1NihzeW1ib2wpOwogIH0KfQoKCgovKioKICogQHRpdGxlIEFuZ2VsVG9rZW4KICovCmNvbnRyYWN0IEFuZ2VsVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgTmFtZWRUb2tlbiwgUGF1c2FibGUgewoKICAvKiBFdmVudHMgKi8KCiAgZXZlbnQgTWludEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBhY2NvdW50LCB1aW50IHZhbHVlKTsKICBldmVudCBCdXJuRXZlbnQoYWRkcmVzcyBpbmRleGVkIGFjY291bnQsIHVpbnQgdmFsdWUpOwogIGV2ZW50IFNwZW5kaW5nQmxvY2tlZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBhY2NvdW50KTsKICBldmVudCBTcGVuZGluZ1VuYmxvY2tlZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBhY2NvdW50KTsKCgogIC8qIFN0b3JhZ2UgKi8KCiAgYWRkcmVzcyBwdWJsaWMgY2VudHJhbEJhbmtBZGRyZXNzID0gMHgwOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgc3BlbmRpbmdCbG9ja3NOdW1iZXI7CgoKICAvKiBDb25zdHJ1Y3RvciAqLwoKICBmdW5jdGlvbiBBbmdlbFRva2VuKCkgcHVibGljIE5hbWVkVG9rZW4oJ0FuZ2VsIFRva2VuJywgJ0FOR0wnLCAxOCkgewogICAgY2VudHJhbEJhbmtBZGRyZXNzID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKiBNZXRob2RzICovCgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChfdG8gIT0gY2VudHJhbEJhbmtBZGRyZXNzKSB7CiAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICB9CiAgICByZXF1aXJlKHNwZW5kaW5nQmxvY2tzTnVtYmVyW21zZy5zZW5kZXJdID09IDApOwoKICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgaWYgKHJlc3VsdCA9PSB0cnVlICYmIF90byA9PSBjZW50cmFsQmFua0FkZHJlc3MpIHsKICAgICAgQW5nZWxDZW50cmFsQmFuayhjZW50cmFsQmFua0FkZHJlc3MpLmFuZ2VsQnVybihtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyB3aGVuQ29udHJhY3ROb3RQYXVzZWQgcmV0dXJucyAoYm9vbCl7CiAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyB3aGVuQ29udHJhY3ROb3RQYXVzZWQgcmV0dXJucyAoYm9vbCl7CiAgICByZXF1aXJlKHNwZW5kaW5nQmxvY2tzTnVtYmVyW19mcm9tXSA9PSAwKTsKCiAgICBib29sIHJlc3VsdCA9IHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgaWYgKHJlc3VsdCA9PSB0cnVlICYmIF90byA9PSBjZW50cmFsQmFua0FkZHJlc3MpIHsKICAgICAgQW5nZWxDZW50cmFsQmFuayhjZW50cmFsQmFua0FkZHJlc3MpLmFuZ2VsQnVybihfZnJvbSwgX3ZhbHVlKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9hY2NvdW50LCB1aW50IF92YWx1ZSkgZXh0ZXJuYWwgb25seUFsbG93ZWRNYW5hZ2VyKCdtaW50X3Rva2VucycpIHsKICAgIGJhbGFuY2VzW19hY2NvdW50XSA9IGJhbGFuY2VzW19hY2NvdW50XS5hZGQoX3ZhbHVlKTsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF92YWx1ZSk7CiAgICBNaW50RXZlbnQoX2FjY291bnQsIF92YWx1ZSk7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDB4MCksIF9hY2NvdW50LCBfdmFsdWUpOyAvLyByZXF1aXJlZCBmb3IgYmxvY2tleHBsb3JlcnMKICB9CgogIGZ1bmN0aW9uIGJ1cm4odWludCBfdmFsdWUpIGV4dGVybmFsIG9ubHlBbGxvd2VkTWFuYWdlcignYnVybl90b2tlbnMnKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlKTsKICAgIEJ1cm5FdmVudChtc2cuc2VuZGVyLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYmxvY2tTcGVuZGluZyhhZGRyZXNzIF9hY2NvdW50KSBleHRlcm5hbCBvbmx5QWxsb3dlZE1hbmFnZXIoJ2Jsb2NrX3NwZW5kaW5nJykgewogICAgc3BlbmRpbmdCbG9ja3NOdW1iZXJbX2FjY291bnRdID0gc3BlbmRpbmdCbG9ja3NOdW1iZXJbX2FjY291bnRdLmFkZCgxKTsKICAgIFNwZW5kaW5nQmxvY2tlZEV2ZW50KF9hY2NvdW50KTsKICB9CgogIGZ1bmN0aW9uIHVuYmxvY2tTcGVuZGluZyhhZGRyZXNzIF9hY2NvdW50KSBleHRlcm5hbCBvbmx5QWxsb3dlZE1hbmFnZXIoJ3VuYmxvY2tfc3BlbmRpbmcnKSB7CiAgICBzcGVuZGluZ0Jsb2Nrc051bWJlcltfYWNjb3VudF0gPSBzcGVuZGluZ0Jsb2Nrc051bWJlcltfYWNjb3VudF0uc3ViKDEpOwogICAgU3BlbmRpbmdVbmJsb2NrZWRFdmVudChfYWNjb3VudCk7CiAgfQp9CgoKCi8qKgogKiBAdGl0bGUgQW5nZWxDZW50cmFsQmFuawogKgogKiBAZGV2IENyb3dkc2FsZSBhbmQgZXNjcm93IGNvbnRyYWN0CiAqLwpjb250cmFjdCBBbmdlbENlbnRyYWxCYW5rIHsKCiAgLyogRGF0YSBzdHJ1Y3R1cmVzICovCgogIHN0cnVjdCBJbnZlc3RtZW50UmVjb3JkIHsKICAgIHVpbnQgdG9rZW5zU29sZEJlZm9yZVdlaTsKICAgIHVpbnQgaW52ZXN0ZWRFdGhXZWk7CiAgICB1aW50IHB1cmNoYXNlZFRva2Vuc1dlaTsKICAgIHVpbnQgcmVmdW5kZWRFdGhXZWk7CiAgICB1aW50IHJldHVybmVkVG9rZW5zV2VpOwogIH0KCgogIC8qIFN0b3JhZ2UgLSBjb25maWcgKi8KCiAgdWludCBwdWJsaWMgY29uc3RhbnQgaWNvQ2FwID0gNzAwMDAwMDAgKiAoMTAgKiogMTgpOwoKICB1aW50IHB1YmxpYyBpbml0aWFsVG9rZW5QcmljZSA9IDEgKiAoMTAgKiogMTgpIC8gKDEwICoqIDQpOyAvLyBtZWFucyAwLjAwMDEgRVRIIGZvciBvbmUgdG9rZW4KCiAgdWludCBwdWJsaWMgY29uc3RhbnQgbGFuZG1hcmtTaXplID0gMTAwMDAwMCAqICgxMCAqKiAxOCk7CiAgdWludCBwdWJsaWMgY29uc3RhbnQgbGFuZG1hcmtQcmljZVN0ZXBOdW1lcmF0b3IgPSAxMDsKICB1aW50IHB1YmxpYyBjb25zdGFudCBsYW5kbWFya1ByaWNlU3RlcERlbm9taW5hdG9yID0gMTAwOwoKICB1aW50IHB1YmxpYyBjb25zdGFudCBmaXJzdFJlZnVuZFJvdW5kUmF0ZU51bWVyYXRvciA9IDgwOwogIHVpbnQgcHVibGljIGNvbnN0YW50IGZpcnN0UmVmdW5kUm91bmRSYXRlRGVub21pbmF0b3IgPSAxMDA7CiAgdWludCBwdWJsaWMgY29uc3RhbnQgc2Vjb25kUmVmdW5kUm91bmRSYXRlTnVtZXJhdG9yID0gNDA7CiAgdWludCBwdWJsaWMgY29uc3RhbnQgc2Vjb25kUmVmdW5kUm91bmRSYXRlRGVub21pbmF0b3IgPSAxMDA7CgogIHVpbnQgcHVibGljIGNvbnN0YW50IGluaXRpYWxGdW5kc1JlbGVhc2VOdW1lcmF0b3IgPSAyMDsgLy8gcGFydCBvZiBpbnZlc3RtZW50CiAgdWludCBwdWJsaWMgY29uc3RhbnQgaW5pdGlhbEZ1bmRzUmVsZWFzZURlbm9taW5hdG9yID0gMTAwOwogIHVpbnQgcHVibGljIGNvbnN0YW50IGFmdGVyRmlyc3RSZWZ1bmRSb3VuZEZ1bmRzUmVsZWFzZU51bWVyYXRvciA9IDUwOyAvLyBwYXJ0IG9mIHJlbWFpbmluZyBmdW5kcwogIHVpbnQgcHVibGljIGNvbnN0YW50IGFmdGVyRmlyc3RSZWZ1bmRSb3VuZEZ1bmRzUmVsZWFzZURlbm9taW5hdG9yID0gMTAwOwoKICB1aW50IHB1YmxpYyBjb25zdGFudCBhbmdlbEZvdW5kYXRpb25TaGFyZU51bWVyYXRvciA9IDMwOwogIHVpbnQgcHVibGljIGNvbnN0YW50IGFuZ2VsRm91bmRhdGlvblNoYXJlRGVub21pbmF0b3IgPSAxMDA7CgogIC8qIFN0b3JhZ2UgLSBzdGF0ZSAqLwoKICBhZGRyZXNzIHB1YmxpYyBhbmdlbEZvdW5kYXRpb25BZGRyZXNzID0gYWRkcmVzcygweDJiMDU1NmE2Mjk4ZUEzRDM1RTkwRjFkZjMyY2MxMjZiMzFGNTk3NzApOwogIHVpbnQgcHVibGljIGljb0xhdW5jaFRpbWVzdGFtcCA9IDE1MTE3ODQwMDA7ICAvLyBOb3ZlbWJlciAyN3RoIDEyOjAwIEdNVAogIHVpbnQgcHVibGljIGljb0ZpbmlzaFRpbWVzdGFtcCA9IDE1MTM3Mjc5OTk7ICAvLyBEZWNlbWJlciAxOXRoIDIzOjU5OjU5IEdNVAogIHVpbnQgcHVibGljIGZpcnN0UmVmdW5kUm91bmRGaW5pc2hUaW1lc3RhbXAgPSAxNTIwNDI0MDAwOyAgLy8gTWFyY2ggN3RoIDIwMTggMTI6MDAgR01UCiAgdWludCBwdWJsaWMgc2Vjb25kUmVmdW5kUm91bmRGaW5pc2hUaW1lc3RhbXAgPSAxNTI0NzQ0MDAwOyAgLy8gQXByaWwgMjZ0aCAyMDE4IDEyOjAwIEdNVAoKCiAgQW5nZWxUb2tlbiBwdWJsaWMgYW5nZWxUb2tlbjsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBJbnZlc3RtZW50UmVjb3JkW10pIHB1YmxpYyBpbnZlc3RtZW50czsgLy8gaW52ZXN0b3JBZGRyZXNzID0+IGxpc3Qgb2YgaW52ZXN0bWVudHMKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpbnZlc3RvcnM7CiAgdWludCBwdWJsaWMgdG90YWxJbnZlc3RvcnMgPSAwOwogIHVpbnQgcHVibGljIHRvdGFsVG9rZW5zU29sZCA9IDA7CgogIGJvb2wgaXNJY29GaW5pc2hlZCA9IGZhbHNlOwogIGJvb2wgZmlyc3RSZWZ1bmRSb3VuZEZ1bmRzV2l0aGRyYXdhbCA9IGZhbHNlOwoKCiAgLyogRXZlbnRzICovCgogIGV2ZW50IEludmVzdG1lbnRFdmVudChhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIHVpbnQgZXRoLCB1aW50IGFuZ2VsKTsKICBldmVudCBSZWZ1bmRFdmVudChhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIHVpbnQgZXRoLCB1aW50IGFuZ2VsKTsKCgogIC8qIENvbnN0cnVjdG9yIGFuZCBjb25maWcgKi8KCiAgZnVuY3Rpb24gQW5nZWxDZW50cmFsQmFuaygpIHB1YmxpYyB7CiAgICBhbmdlbFRva2VuID0gbmV3IEFuZ2VsVG9rZW4oKTsKICAgIGFuZ2VsVG9rZW4uZW5hYmxlTWFuYWdlcihhZGRyZXNzKHRoaXMpKTsKICAgIGFuZ2VsVG9rZW4uZ3JhbnRNYW5hZ2VyUGVybWlzc2lvbihhZGRyZXNzKHRoaXMpLCAnbWludF90b2tlbnMnKTsKICAgIGFuZ2VsVG9rZW4uZ3JhbnRNYW5hZ2VyUGVybWlzc2lvbihhZGRyZXNzKHRoaXMpLCAnYnVybl90b2tlbnMnKTsKICAgIGFuZ2VsVG9rZW4uZ3JhbnRNYW5hZ2VyUGVybWlzc2lvbihhZGRyZXNzKHRoaXMpLCAndW5wYXVzZV9jb250cmFjdCcpOwogICAgYW5nZWxUb2tlbi50cmFuc2Zlck93bmVyc2hpcChhbmdlbEZvdW5kYXRpb25BZGRyZXNzKTsKICB9CgogIC8qIEludmVzdG1lbnRzICovCgogIC8qKgogICAqIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gcmVjZWl2ZXMgRVRIIGFuZCBzZW5kcyB0b2tlbnMgYmFjawogICAqLwogIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGFuZ2VsUmFpc2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJvY2VzcyBuZXcgRVRIIGludmVzdG1lbnQgYW5kIHNlbmRzIHRva2VucyBiYWNrCiAgICovCiAgZnVuY3Rpb24gYW5nZWxSYWlzZSgpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICByZXF1aXJlKG5vdyA+PSBpY29MYXVuY2hUaW1lc3RhbXAgJiYgbm93IDwgaWNvRmluaXNoVGltZXN0YW1wKTsKCiAgICAvLyBjYWxjdWxhdGUgYW1vdW50IG9mIHRva2VucyBmb3IgcmVjZWl2ZWQgRVRICiAgICB1aW50IF9wdXJjaGFzZWRUb2tlbnNXZWkgPSAwOwogICAgdWludCBfbm90UHJvY2Vzc2VkRXRoV2VpID0gMDsKICAgIChfcHVyY2hhc2VkVG9rZW5zV2VpLCBfbm90UHJvY2Vzc2VkRXRoV2VpKSA9IGNhbGN1bGF0ZVB1cmNoYXNlZFRva2Vucyh0b3RhbFRva2Vuc1NvbGQsIG1zZy52YWx1ZSk7CiAgICB1aW50IF9hY3R1YWxJbnZlc3RtZW50ID0gKG1zZy52YWx1ZSAtIF9ub3RQcm9jZXNzZWRFdGhXZWkpOwoKICAgIC8vIGNyZWF0ZSByZWNvcmQgZm9yIHRoZSBpbnZlc3RtZW50CiAgICB1aW50IF9uZXdSZWNvcmRJbmRleCA9IGludmVzdG1lbnRzW21zZy5zZW5kZXJdLmxlbmd0aDsKICAgIGludmVzdG1lbnRzW21zZy5zZW5kZXJdLmxlbmd0aCArPSAxOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS50b2tlbnNTb2xkQmVmb3JlV2VpID0gdG90YWxUb2tlbnNTb2xkOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS5pbnZlc3RlZEV0aFdlaSA9IF9hY3R1YWxJbnZlc3RtZW50OwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS5wdXJjaGFzZWRUb2tlbnNXZWkgPSBfcHVyY2hhc2VkVG9rZW5zV2VpOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS5yZWZ1bmRlZEV0aFdlaSA9IDA7CiAgICBpbnZlc3RtZW50c1ttc2cuc2VuZGVyXVtfbmV3UmVjb3JkSW5kZXhdLnJldHVybmVkVG9rZW5zV2VpID0gMDsKCiAgICAvLyBjYWxjdWxhdGUgc3RhdHMKICAgIGlmIChpbnZlc3RvcnNbbXNnLnNlbmRlcl0gPT0gZmFsc2UpIHsKICAgICAgdG90YWxJbnZlc3RvcnMgKz0gMTsKICAgIH0KICAgIGludmVzdG9yc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICB0b3RhbFRva2Vuc1NvbGQgKz0gX3B1cmNoYXNlZFRva2Vuc1dlaTsKCiAgICAvLyB0cmFuc2ZlciB0b2tlbnMgYW5kIEVUSAogICAgYW5nZWxUb2tlbi5taW50KG1zZy5zZW5kZXIsIF9wdXJjaGFzZWRUb2tlbnNXZWkpOwogICAgYW5nZWxUb2tlbi5taW50KGFuZ2VsRm91bmRhdGlvbkFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgX3B1cmNoYXNlZFRva2Vuc1dlaSAqIGFuZ2VsRm91bmRhdGlvblNoYXJlTnVtZXJhdG9yIC8gKGFuZ2VsRm91bmRhdGlvblNoYXJlRGVub21pbmF0b3IgLSBhbmdlbEZvdW5kYXRpb25TaGFyZU51bWVyYXRvcikpOwogICAgYW5nZWxGb3VuZGF0aW9uQWRkcmVzcy50cmFuc2ZlcihfYWN0dWFsSW52ZXN0bWVudCAqIGluaXRpYWxGdW5kc1JlbGVhc2VOdW1lcmF0b3IgLyBpbml0aWFsRnVuZHNSZWxlYXNlRGVub21pbmF0b3IpOwogICAgaWYgKF9ub3RQcm9jZXNzZWRFdGhXZWkgPiAwKSB7CiAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX25vdFByb2Nlc3NlZEV0aFdlaSk7CiAgICB9CgogICAgLy8gZmluaXNoIElDTyBpZiBjYXAgcmVhY2hlZAogICAgaWYgKHRvdGFsVG9rZW5zU29sZCA+PSBpY29DYXApIHsKICAgICAgaWNvRmluaXNoVGltZXN0YW1wID0gbm93OwoKICAgICAgZmluaXNoSWNvKCk7CiAgICB9CgogICAgLy8gZmlyZSBldmVudAogICAgSW52ZXN0bWVudEV2ZW50KG1zZy5zZW5kZXIsIF9hY3R1YWxJbnZlc3RtZW50LCBfcHVyY2hhc2VkVG9rZW5zV2VpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB0b2tlbnMgZm9yIHJlY2VpdmVkIEVUSAogICAqIEBwYXJhbSBfdG90YWxUb2tlbnNTb2xkQmVmb3JlIHVpbnQgQW1vdW50IG9mIHRva2VucyBzb2xkIGJlZm9yZSB0aGlzIGludmVzdG1lbnQgW3Rva2VuIHdlaV0KICAgKiBAcGFyYW0gX2ludmVzdGVkRXRoV2VpICAgICAgICB1aW50IEludmVzdG1lbnQgYW1vdW50IFtFVEggd2VpXQogICAqIEByZXR1cm4gUHVyY2hhc2VkIGFtb3VudCBvZiB0b2tlbnMgW3Rva2VuIHdlaV0KICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQdXJjaGFzZWRUb2tlbnMoCiAgICB1aW50IF90b3RhbFRva2Vuc1NvbGRCZWZvcmUsCiAgICB1aW50IF9pbnZlc3RlZEV0aFdlaSkKICAgIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IF9wdXJjaGFzZWRUb2tlbnNXZWksIHVpbnQgX25vdFByb2Nlc3NlZEV0aFdlaSkKICB7CiAgICBfcHVyY2hhc2VkVG9rZW5zV2VpID0gMDsKICAgIF9ub3RQcm9jZXNzZWRFdGhXZWkgPSBfaW52ZXN0ZWRFdGhXZWk7CgogICAgdWludCBfbGFuZG1hcmtQcmljZTsKICAgIHVpbnQgX21heExhbmRtYXJrVG9rZW5zV2VpOwogICAgdWludCBfbWF4TGFuZG1hcmtFdGhXZWk7CiAgICBib29sIF9pc0NhcFJlYWNoZWQgPSBmYWxzZTsKICAgIGRvIHsKICAgICAgLy8gZ2V0IGxhbmRtYXJrIHZhbHVlcwogICAgICBfbGFuZG1hcmtQcmljZSA9IGNhbGN1bGF0ZUxhbmRtYXJrUHJpY2UoX3RvdGFsVG9rZW5zU29sZEJlZm9yZSArIF9wdXJjaGFzZWRUb2tlbnNXZWkpOwogICAgICBfbWF4TGFuZG1hcmtUb2tlbnNXZWkgPSBsYW5kbWFya1NpemUgLSAoKF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgKyBfcHVyY2hhc2VkVG9rZW5zV2VpKSAlIGxhbmRtYXJrU2l6ZSk7CiAgICAgIGlmIChfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3B1cmNoYXNlZFRva2Vuc1dlaSArIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA+PSBpY29DYXApIHsKICAgICAgICBfbWF4TGFuZG1hcmtUb2tlbnNXZWkgPSBpY29DYXAgLSBfdG90YWxUb2tlbnNTb2xkQmVmb3JlIC0gX3B1cmNoYXNlZFRva2Vuc1dlaTsKICAgICAgICBfaXNDYXBSZWFjaGVkID0gdHJ1ZTsKICAgICAgfQogICAgICBfbWF4TGFuZG1hcmtFdGhXZWkgPSBfbWF4TGFuZG1hcmtUb2tlbnNXZWkgKiBfbGFuZG1hcmtQcmljZSAvICgxMCAqKiAxOCk7CgogICAgICAvLyBjaGVjayBpbnZlc3RtZW50IGFnYWluc3QgbGFuZG1hcmsgdmFsdWVzCiAgICAgIGlmIChfbm90UHJvY2Vzc2VkRXRoV2VpID49IF9tYXhMYW5kbWFya0V0aFdlaSkgewogICAgICAgIF9wdXJjaGFzZWRUb2tlbnNXZWkgKz0gX21heExhbmRtYXJrVG9rZW5zV2VpOwogICAgICAgIF9ub3RQcm9jZXNzZWRFdGhXZWkgLT0gX21heExhbmRtYXJrRXRoV2VpOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIF9wdXJjaGFzZWRUb2tlbnNXZWkgKz0gX25vdFByb2Nlc3NlZEV0aFdlaSAqICgxMCAqKiAxOCkgLyBfbGFuZG1hcmtQcmljZTsKICAgICAgICBfbm90UHJvY2Vzc2VkRXRoV2VpID0gMDsKICAgICAgfQogICAgfQogICAgd2hpbGUgKChfbm90UHJvY2Vzc2VkRXRoV2VpID4gMCkgJiYgKF9pc0NhcFJlYWNoZWQgPT0gZmFsc2UpKTsKCiAgICBhc3NlcnQoX3B1cmNoYXNlZFRva2Vuc1dlaSA+IDApOwoKICAgIHJldHVybiAoX3B1cmNoYXNlZFRva2Vuc1dlaSwgX25vdFByb2Nlc3NlZEV0aFdlaSk7CiAgfQoKCiAgLyogUmVmdW5kcyAqLwoKICBmdW5jdGlvbiBhbmdlbEJ1cm4oCiAgICBhZGRyZXNzIF9pbnZlc3RvciwKICAgIHVpbnQgX3JldHVybmVkVG9rZW5zV2VpCiAgKQogICAgZXh0ZXJuYWwgcmV0dXJucyAodWludCkKICB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhhbmdlbFRva2VuKSk7CiAgICByZXF1aXJlKG5vdyA+PSBpY29MYXVuY2hUaW1lc3RhbXAgJiYgbm93IDwgc2Vjb25kUmVmdW5kUm91bmRGaW5pc2hUaW1lc3RhbXApOwoKICAgIHVpbnQgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA9IF9yZXR1cm5lZFRva2Vuc1dlaTsKICAgIHVpbnQgX3JlZnVuZGVkRXRoV2VpID0gMDsKCiAgICB1aW50IF9hbGxSZWNvcmRzTnVtYmVyID0gaW52ZXN0bWVudHNbX2ludmVzdG9yXS5sZW5ndGg7CiAgICB1aW50IF9yZWNvcmRNYXhSZXR1cm5lZFRva2Vuc1dlaSA9IDA7CiAgICB1aW50IF9yZWNvcmRUb2tlbnNXZWlUb1Byb2Nlc3MgPSAwOwogICAgdWludCBfdG9rZW5zU29sZFdlaSA9IDA7CiAgICB1aW50IF9yZWNvcmRSZWZ1bmRlZEV0aFdlaSA9IDA7CiAgICB1aW50IF9yZWNvcmROb3RQcm9jZXNzZWRUb2tlbnNXZWkgPSAwOwogICAgZm9yICh1aW50IF9yZWNvcmRJRCA9IDA7IF9yZWNvcmRJRCA8IF9hbGxSZWNvcmRzTnVtYmVyOyBfcmVjb3JkSUQgKz0gMSkgewogICAgICBpZiAoaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnB1cmNoYXNlZFRva2Vuc1dlaSA8PSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmV0dXJuZWRUb2tlbnNXZWkgfHwKICAgICAgICAgIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5pbnZlc3RlZEV0aFdlaSA8PSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmVmdW5kZWRFdGhXZWkpIHsKICAgICAgICAvLyB0b2tlbnMgYWxyZWFkeSByZWZ1bmRlZAogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICAvLyBjYWxjdWxhdGUgYW1vdW50IG9mIHRva2VucyB0byByZWZ1bmQgd2l0aCB0aGlzIHJlY29yZAogICAgICBfcmVjb3JkTWF4UmV0dXJuZWRUb2tlbnNXZWkgPSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucHVyY2hhc2VkVG9rZW5zV2VpIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJldHVybmVkVG9rZW5zV2VpOwogICAgICBfcmVjb3JkVG9rZW5zV2VpVG9Qcm9jZXNzID0gKF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPCBfcmVjb3JkTWF4UmV0dXJuZWRUb2tlbnNXZWkpID8gX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVjb3JkTWF4UmV0dXJuZWRUb2tlbnNXZWk7CiAgICAgIGFzc2VydChfcmVjb3JkVG9rZW5zV2VpVG9Qcm9jZXNzID4gMCk7CgogICAgICAvLyBjYWxjdWxhdGUgYW1vdW50IG9mIEVUSCB0byBzZW5kIGJhY2sKICAgICAgX3Rva2Vuc1NvbGRXZWkgPSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0udG9rZW5zU29sZEJlZm9yZVdlaSArIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZXR1cm5lZFRva2Vuc1dlaTsKICAgICAgKF9yZWNvcmRSZWZ1bmRlZEV0aFdlaSwgX3JlY29yZE5vdFByb2Nlc3NlZFRva2Vuc1dlaSkgPSBjYWxjdWxhdGVSZWZ1bmRlZEV0aChfdG9rZW5zU29sZFdlaSwgX3JlY29yZFRva2Vuc1dlaVRvUHJvY2Vzcyk7CiAgICAgIGlmIChfcmVjb3JkUmVmdW5kZWRFdGhXZWkgPiAoaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLmludmVzdGVkRXRoV2VpIC0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJlZnVuZGVkRXRoV2VpKSkgewogICAgICAgIC8vIHRoaXMgY2FuIGhhcHBlbiBkdWUgdG8gcm91bmRpbmcgZXJyb3IKICAgICAgICBfcmVjb3JkUmVmdW5kZWRFdGhXZWkgPSAoaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLmludmVzdGVkRXRoV2VpIC0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJlZnVuZGVkRXRoV2VpKTsKICAgICAgfQogICAgICBhc3NlcnQoX3JlY29yZFJlZnVuZGVkRXRoV2VpID4gMCk7CiAgICAgIGFzc2VydChfcmVjb3JkTm90UHJvY2Vzc2VkVG9rZW5zV2VpID09IDApOwoKICAgICAgLy8gcGVyc2lzdCBjaGFuZ2VzIHRvIHRoZSBzdG9yYWdlCiAgICAgIF9yZWZ1bmRlZEV0aFdlaSArPSBfcmVjb3JkUmVmdW5kZWRFdGhXZWk7CiAgICAgIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgLT0gX3JlY29yZFRva2Vuc1dlaVRvUHJvY2VzczsKCiAgICAgIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZWZ1bmRlZEV0aFdlaSArPSBfcmVjb3JkUmVmdW5kZWRFdGhXZWk7CiAgICAgIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZXR1cm5lZFRva2Vuc1dlaSArPSBfcmVjb3JkVG9rZW5zV2VpVG9Qcm9jZXNzOwogICAgICBhc3NlcnQoaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJlZnVuZGVkRXRoV2VpIDw9IGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5pbnZlc3RlZEV0aFdlaSk7CiAgICAgIGFzc2VydChpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmV0dXJuZWRUb2tlbnNXZWkgPD0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnB1cmNoYXNlZFRva2Vuc1dlaSk7CgogICAgICAvLyBzdG9wIGlmIHdlIGFscmVhZHkgcmVmdW5kZWQgYWxsIHRva2VucwogICAgICBpZiAoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA9PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICAvLyB0aHJvdyBpZiB3ZSBkbyBub3QgaGF2ZSB0b2tlbnMgdG8gcmVmdW5kCiAgICByZXF1aXJlKF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPCBfcmV0dXJuZWRUb2tlbnNXZWkpOwogICAgcmVxdWlyZShfcmVmdW5kZWRFdGhXZWkgPiAwKTsKCiAgICAvLyBjYWxjdWxhdGUgcmVmdW5kIGRpc2NvdW50CiAgICB1aW50IF9yZWZ1bmRlZEV0aFdlaVdpdGhEaXNjb3VudCA9IGNhbGN1bGF0ZVJlZnVuZGVkRXRoV2l0aERpc2NvdW50KF9yZWZ1bmRlZEV0aFdlaSk7CgogICAgLy8gdHJhbnNmZXIgRVRIIGFuZCByZW1haW5pbmcgdG9rZW5zCiAgICBhbmdlbFRva2VuLmJ1cm4oX3JldHVybmVkVG9rZW5zV2VpIC0gX25vdFByb2Nlc3NlZFRva2Vuc1dlaSk7CiAgICBpZiAoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA+IDApIHsKICAgICAgYW5nZWxUb2tlbi50cmFuc2ZlcihfaW52ZXN0b3IsIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkpOwogICAgfQogICAgX2ludmVzdG9yLnRyYW5zZmVyKF9yZWZ1bmRlZEV0aFdlaVdpdGhEaXNjb3VudCk7CgogICAgLy8gZmlyZSBldmVudAogICAgUmVmdW5kRXZlbnQoX2ludmVzdG9yLCBfcmVmdW5kZWRFdGhXZWlXaXRoRGlzY291bnQsIF9yZXR1cm5lZFRva2Vuc1dlaSAtIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgZGlzY291bnRlZCBhbW91bnQgb2YgRVRIIGZvciByZWZ1bmRlZCB0b2tlbnMKICAgKiBAcGFyYW0gX3JlZnVuZGVkRXRoV2VpIHVpbnQgQ2FsY3VsYXRlZCBhbW91bnQgb2YgRVRIIHRvIHJlZnVuZCBbRVRIIHdlaV0KICAgKiBAcmV0dXJuIERpc2NvdW50ZWQgYW1vdW50IG9mIEVUSCBmb3IgcmVmdW5kZWQgW0VUSCB3ZWldCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlUmVmdW5kZWRFdGhXaXRoRGlzY291bnQoCiAgICB1aW50IF9yZWZ1bmRlZEV0aFdlaQogICkKICAgIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KQogIHsKICAgIGlmIChub3cgPD0gZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCkgewogICAgICByZXR1cm4gKF9yZWZ1bmRlZEV0aFdlaSAqIGZpcnN0UmVmdW5kUm91bmRSYXRlTnVtZXJhdG9yIC8gZmlyc3RSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvcik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgcmV0dXJuIChfcmVmdW5kZWRFdGhXZWkgKiBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVOdW1lcmF0b3IgLyBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvcik7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgRVRIIGZvciByZWZ1bmRlZCB0b2tlbnMuIEp1c3QgYWJzdHJhY3QgcHJpY2UgbGFkZGVyCiAgICogQHBhcmFtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgICAgIHVpbnQgQW1vdW50IG9mIHRva2VucyB0aGF0IGhhdmUgYmVlbiBzb2xkIChzdGFydGluZyBwb2ludCkgW3Rva2VuIHdlaV0KICAgKiBAcGFyYW0gX3JldHVybmVkVG9rZW5zV2VpIHVpbnQgQW1vdW50IG9mIHRva2VucyB0byByZWZ1bmQgW3Rva2VuIHdlaV0KICAgKiBAcmV0dXJuIFJlZnVuZGVkIGFtb3VudCBvZiBFVEggW0VUSCB3ZWldICh3aXRob3V0IGRpc2NvdW50cykKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVSZWZ1bmRlZEV0aCgKICAgIHVpbnQgX3RvdGFsVG9rZW5zU29sZEJlZm9yZSwKICAgIHVpbnQgX3JldHVybmVkVG9rZW5zV2VpCiAgKQogICAgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgX3JlZnVuZGVkRXRoV2VpLCB1aW50IF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkpCiAgewogICAgX3JlZnVuZGVkRXRoV2VpID0gMDsKICAgIHVpbnQgX3JlZnVuZGVkVG9rZW5zV2VpID0gMDsKICAgIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPSBfcmV0dXJuZWRUb2tlbnNXZWk7CgogICAgdWludCBfbGFuZG1hcmtQcmljZSA9IDA7CiAgICB1aW50IF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA9IDA7CiAgICB1aW50IF9tYXhMYW5kbWFya0V0aFdlaSA9IDA7CiAgICBib29sIF9pc0NhcFJlYWNoZWQgPSBmYWxzZTsKICAgIGRvIHsKICAgICAgLy8gZ2V0IGxhbmRtYXJrIHZhbHVlcwogICAgICBfbGFuZG1hcmtQcmljZSA9IGNhbGN1bGF0ZUxhbmRtYXJrUHJpY2UoX3RvdGFsVG9rZW5zU29sZEJlZm9yZSArIF9yZWZ1bmRlZFRva2Vuc1dlaSk7CiAgICAgIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA9IGxhbmRtYXJrU2l6ZSAtICgoX3RvdGFsVG9rZW5zU29sZEJlZm9yZSArIF9yZWZ1bmRlZFRva2Vuc1dlaSkgJSBsYW5kbWFya1NpemUpOwogICAgICBpZiAoX3RvdGFsVG9rZW5zU29sZEJlZm9yZSArIF9yZWZ1bmRlZFRva2Vuc1dlaSArIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA+PSBpY29DYXApIHsKICAgICAgICBfbWF4TGFuZG1hcmtUb2tlbnNXZWkgPSBpY29DYXAgLSBfdG90YWxUb2tlbnNTb2xkQmVmb3JlIC0gX3JlZnVuZGVkVG9rZW5zV2VpOwogICAgICAgIF9pc0NhcFJlYWNoZWQgPSB0cnVlOwogICAgICB9CiAgICAgIF9tYXhMYW5kbWFya0V0aFdlaSA9IF9tYXhMYW5kbWFya1Rva2Vuc1dlaSAqIF9sYW5kbWFya1ByaWNlIC8gKDEwICoqIDE4KTsKCiAgICAgIC8vIGNoZWNrIGludmVzdG1lbnQgYWdhaW5zdCBsYW5kbWFyayB2YWx1ZXMKICAgICAgaWYgKF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPiBfbWF4TGFuZG1hcmtUb2tlbnNXZWkpIHsKICAgICAgICBfcmVmdW5kZWRFdGhXZWkgKz0gX21heExhbmRtYXJrRXRoV2VpOwogICAgICAgIF9yZWZ1bmRlZFRva2Vuc1dlaSArPSBfbWF4TGFuZG1hcmtUb2tlbnNXZWk7CiAgICAgICAgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSAtPSBfbWF4TGFuZG1hcmtUb2tlbnNXZWk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgX3JlZnVuZGVkRXRoV2VpICs9IF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgKiBfbGFuZG1hcmtQcmljZSAvICgxMCAqKiAxOCk7CiAgICAgICAgX3JlZnVuZGVkVG9rZW5zV2VpICs9IF9ub3RQcm9jZXNzZWRUb2tlbnNXZWk7CiAgICAgICAgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA9IDA7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlICgoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA+IDApICYmIChfaXNDYXBSZWFjaGVkID09IGZhbHNlKSk7CgogICAgYXNzZXJ0KF9yZWZ1bmRlZEV0aFdlaSA+IDApOwoKICAgIHJldHVybiAoX3JlZnVuZGVkRXRoV2VpLCBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpKTsKICB9CgoKICAvKiBDYWxjdWxhdGlvbiBvZiB0aGUgcHJpY2UgKi8KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgcHJpY2UgZm9yIHRva2VucwogICAqIEBwYXJhbSBfdG90YWxUb2tlbnNTb2xkQmVmb3JlIHVpbnQgQW1vdW50IG9mIHRva2VucyBzb2xkIGJlZm9yZSBbdG9rZW4gd2VpXQogICAqIEByZXR1cm4gQ2FsY3VsYXRlZCBwcmljZQogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZUxhbmRtYXJrUHJpY2UodWludCBfdG90YWxUb2tlbnNTb2xkQmVmb3JlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGluaXRpYWxUb2tlblByaWNlICsgaW5pdGlhbFRva2VuUHJpY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbGFuZG1hcmtQcmljZVN0ZXBOdW1lcmF0b3IgLyBsYW5kbWFya1ByaWNlU3RlcERlbm9taW5hdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIChfdG90YWxUb2tlbnNTb2xkQmVmb3JlIC8gbGFuZG1hcmtTaXplKTsKICB9CgoKICAvKiBMaWZlY3ljbGUgKi8KCiAgZnVuY3Rpb24gZmluaXNoSWNvKCkgcHVibGljIHsKICAgIHJlcXVpcmUobm93ID49IGljb0ZpbmlzaFRpbWVzdGFtcCk7CiAgICByZXF1aXJlKGlzSWNvRmluaXNoZWQgPT0gZmFsc2UpOwoKICAgIGlzSWNvRmluaXNoZWQgPSB0cnVlOwoKICAgIGFuZ2VsVG9rZW4udW5wYXVzZUNvbnRyYWN0KCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0ZvdW5kYXRpb25GdW5kcygpIGV4dGVybmFsIHsKICAgIHJlcXVpcmUobm93ID4gZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCk7CgogICAgaWYgKG5vdyA+IGZpcnN0UmVmdW5kUm91bmRGaW5pc2hUaW1lc3RhbXAgJiYgbm93IDw9IHNlY29uZFJlZnVuZFJvdW5kRmluaXNoVGltZXN0YW1wKSB7CiAgICAgIHJlcXVpcmUoZmlyc3RSZWZ1bmRSb3VuZEZ1bmRzV2l0aGRyYXdhbCA9PSBmYWxzZSk7CgogICAgICBmaXJzdFJlZnVuZFJvdW5kRnVuZHNXaXRoZHJhd2FsID0gdHJ1ZTsKICAgICAgYW5nZWxGb3VuZGF0aW9uQWRkcmVzcy50cmFuc2Zlcih0aGlzLmJhbGFuY2UgKiBhZnRlckZpcnN0UmVmdW5kUm91bmRGdW5kc1JlbGVhc2VOdW1lcmF0b3IgLyBhZnRlckZpcnN0UmVmdW5kUm91bmRGdW5kc1JlbGVhc2VEZW5vbWluYXRvcik7CiAgICB9IGVsc2UgewogICAgICBhbmdlbEZvdW5kYXRpb25BZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CiAgfQp9'.
	

]
