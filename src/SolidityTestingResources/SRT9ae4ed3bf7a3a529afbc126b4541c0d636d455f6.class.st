Class {
	#name : #SRT9ae4ed3bf7a3a529afbc126b4541c0d636d455f6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9ae4ed3bf7a3a529afbc126b4541c0d636d455f6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKgoKICBDb3B5cmlnaHQgMjAxOCBFYXN5VHJhZGUuCgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKKi8KCmNvbnRyYWN0IFRva2VuIHsKICAgIAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7fQogICAgCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30KCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9hZGRyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHdlaSB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30KICAgIAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHt9Cn0KCmxpYnJhcnkgU2FmZU1hdGggewogICAgCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludCBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludCBjID0gYSAvIGI7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyVG9rZW4gaXMgVG9rZW4gewoKICAgIC8vLyBAZGV2IEJ1eXMgdG9rZW5zIHdpdGggRXRoZXIsIGV4Y2hhbmdpbmcgdGhlbSAxOjEuCiAgICBmdW5jdGlvbiBkZXBvc2l0KCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7fQoKICAgIC8vLyBAZGV2IFNlbGxzIHRva2VucyBpbiBleGNoYW5nZSBmb3IgRXRoZXIsIGV4Y2hhbmdpbmcgdGhlbSAxOjEuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIHNlbGwuCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IGFtb3VudCkKICAgICAgICBwdWJsaWMKICAgIHt9Cn0KCmNvbnRyYWN0IEV4Y2hhbmdlIHsKCiAgICAvLy8gQGRldiBGaWxscyB0aGUgaW5wdXQgb3JkZXIuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsLgogICAgLy8vIEBwYXJhbSBzaG91bGRUaHJvd09uSW5zdWZmaWNpZW50QmFsYW5jZU9yQWxsb3dhbmNlIFRlc3QgaWYgdHJhbnNmZXIgd2lsbCBmYWlsIGJlZm9yZSBhdHRlbXB0aW5nLgogICAgLy8vIEBwYXJhbSB2IEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyByLgogICAgLy8vIEBwYXJhbSBzIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgdGFrZXJUb2tlbiBmaWxsZWQgaW4gdHJhZGUuCiAgICBmdW5jdGlvbiBmaWxsT3JkZXIoCiAgICAgICAgICBhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLAogICAgICAgICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgICAgICAgIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgICBib29sIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UsCiAgICAgICAgICB1aW50OCB2LAogICAgICAgICAgYnl0ZXMzMiByLAogICAgICAgICAgYnl0ZXMzMiBzKQogICAgICAgICAgcHVibGljCiAgICAgICAgICByZXR1cm5zICh1aW50IGZpbGxlZFRha2VyVG9rZW5BbW91bnQpCiAgICB7fQoKICAgIC8qCiAgICAqIENvbnN0YW50IHB1YmxpYyBmdW5jdGlvbnMKICAgICovCiAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgS2VjY2FrLTI1NiBoYXNoIG9mIG9yZGVyIHdpdGggc3BlY2lmaWVkIHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcmV0dXJuIEtlY2Nhay0yNTYgaGFzaCBvZiBvcmRlci4KICAgIGZ1bmN0aW9uIGdldE9yZGVySGFzaChhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLCB1aW50WzZdIG9yZGVyVmFsdWVzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHt9CiAgICAKICAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIHN1bSBvZiB2YWx1ZXMgYWxyZWFkeSBmaWxsZWQgYW5kIGNhbmNlbGxlZCBmb3IgYSBnaXZlbiBvcmRlci4KICAgIC8vLyBAcGFyYW0gb3JkZXJIYXNoIFRoZSBLZWNjYWstMjU2IGhhc2ggb2YgdGhlIGdpdmVuIG9yZGVyLgogICAgLy8vIEByZXR1cm4gU3VtIG9mIHZhbHVlcyBhbHJlYWR5IGZpbGxlZCBhbmQgY2FuY2VsbGVkLgogICAgZnVuY3Rpb24gZ2V0VW5hdmFpbGFibGVUYWtlclRva2VuQW1vdW50KGJ5dGVzMzIgb3JkZXJIYXNoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHt9Cn0KCmNvbnRyYWN0IEV0aGVyRGVsdGEgewogIGFkZHJlc3MgcHVibGljIGZlZUFjY291bnQ7IC8vdGhlIGFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgZmVlcwogIHVpbnQgcHVibGljIGZlZVRha2U7IC8vcGVyY2VudGFnZSB0aW1lcyAoMSBldGhlcikKICAKICBmdW5jdGlvbiBkZXBvc2l0KCkgcHVibGljIHBheWFibGUge30KCiAgZnVuY3Rpb24gd2l0aGRyYXcodWludCBhbW91bnQpIHB1YmxpYyB7fQoKICBmdW5jdGlvbiBkZXBvc2l0VG9rZW4oYWRkcmVzcyB0b2tlbiwgdWludCBhbW91bnQpIHB1YmxpYyB7fQoKICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKGFkZHJlc3MgdG9rZW4sIHVpbnQgYW1vdW50KSBwdWJsaWMge30KCiAgZnVuY3Rpb24gdHJhZGUoYWRkcmVzcyB0b2tlbkdldCwgdWludCBhbW91bnRHZXQsIGFkZHJlc3MgdG9rZW5HaXZlLCB1aW50IGFtb3VudEdpdmUsIHVpbnQgZXhwaXJlcywgdWludCBub25jZSwgYWRkcmVzcyB1c2VyLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcywgdWludCBhbW91bnQpIHB1YmxpYyB7fQoKICBmdW5jdGlvbiBhdmFpbGFibGVWb2x1bWUoYWRkcmVzcyB0b2tlbkdldCwgdWludCBhbW91bnRHZXQsIGFkZHJlc3MgdG9rZW5HaXZlLCB1aW50IGFtb3VudEdpdmUsIHVpbnQgZXhwaXJlcywgdWludCBub25jZSwgYWRkcmVzcyB1c2VyLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7fQp9CgpsaWJyYXJ5IEV0aGVyRGVsdGFUcmFkZXIgewoKICBhZGRyZXNzIGNvbnN0YW50IHB1YmxpYyBFVEhFUkRFTFRBX0FERFIgPSAweDhkMTJhMTk3Y2IwMGQ0NzQ3YTFmZTAzMzk1MDk1Y2UyYTVjYzY4MTk7IC8vIEV0aGVyRGVsdGEgY29udHJhY3QgYWRkcmVzcwogIAogIC8vLyBAZGV2IEdldHMgdGhlIGFkZHJlc3Mgb2YgRXRoZXJEZWx0YSBjb250cmFjdAogIC8vLyBAcmV0dXJuIEFkZHJlc3Mgb2YgRXRoZXJEZWx0YSBDb250cmFjdC4KICBmdW5jdGlvbiBnZXRFdGhlckRlbHRhQWRkcmVzc3MoKSBpbnRlcm5hbCByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgcmV0dXJuIEVUSEVSREVMVEFfQUREUjsKICB9CiAgIAogIC8vLyBAZGV2IEZpbGxzIGEgc2VsbCBvcmRlciBpbiBFdGhlckRlbHRhLgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbi4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgZXhwaXJlcyBhbmQgbm9uY2UuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZSBGZWUgcGVyY2VudGFnZSBvZiB0aGUgZXhjaGFuZ2UuCiAgLy8vIEBwYXJhbSBmaWxsVGFrZXJUb2tlbkFtb3VudCBEZXNpcmVkIGFtb3VudCBvZiB0YWtlclRva2VuIHRvIGZpbGwuCiAgLy8vIEBwYXJhbSB2IEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAvLy8gQHBhcmFtIHIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAvLy8gQHBhcmFtIHMgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgcy4KICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgdGFrZXJUb2tlbiBmaWxsZWQgaW4gdHJhZGUKICBmdW5jdGlvbiBmaWxsU2VsbE9yZGVyKAogICAgYWRkcmVzc1s1XSBvcmRlckFkZHJlc3NlcywKICAgIHVpbnRbNl0gb3JkZXJWYWx1ZXMsCiAgICB1aW50IGV4Y2hhbmdlRmVlLAogICAgdWludCBmaWxsVGFrZXJUb2tlbkFtb3VudCwKICAgIHVpbnQ4IHYsCiAgICBieXRlczMyIHIsCiAgICBieXRlczMyIHMKICApIGludGVybmFsIHJldHVybnModWludCkgewogICAgCiAgICAvL0RlcG9zaXQgZXRoZXJzIGluIEV0aGVyRGVsdGEKICAgIGRlcG9zaXQoZmlsbFRha2VyVG9rZW5BbW91bnQpOwogICAgCiAgICB1aW50IGFtb3VudFRvVHJhZGU7CiAgICB1aW50IGZlZTsKICAgICAgCiAgICAvL1N1YnN0cmFjdCBFdGhlckRlbHRhIGZlZQogICAgKGFtb3VudFRvVHJhZGUsIGZlZSkgPSBzdWJzdHJhY3RGZWUoZXhjaGFuZ2VGZWUsIGZpbGxUYWtlclRva2VuQW1vdW50KTsKICAgIAogICAgLy9GaWxsIEV0aGVyRGVsdGEgT3JkZXIKICAgIHRyYWRlKAogICAgICBvcmRlckFkZHJlc3NlcywKICAgICAgb3JkZXJWYWx1ZXMsIAogICAgICBhbW91bnRUb1RyYWRlLAogICAgICB2LCAKICAgICAgciwgCiAgICAgIHMKICAgICk7CiAgICAKICAgIC8vV2l0aGRyYXcgdG9rZW4gZnJvbSBFdGhlckRlbHRhCiAgICB3aXRoZHJhd1Rva2VuKG9yZGVyQWRkcmVzc2VzWzFdLCBnZXRQYXJ0aWFsQW1vdW50KG9yZGVyVmFsdWVzWzBdLCBvcmRlclZhbHVlc1sxXSwgYW1vdW50VG9UcmFkZSkpOwogICAgCiAgICAvL1JldHVybnMgdGhlIGFtb3VudCBvZiB0b2tlbiBvYnRhaW5lZAogICAgcmV0dXJuIGdldFBhcnRpYWxBbW91bnQob3JkZXJWYWx1ZXNbMF0sIG9yZGVyVmFsdWVzWzFdLCBhbW91bnRUb1RyYWRlKTsKIAogIH0KICAKICAvLy8gQGRldiBGaWxscyBhIGJ1eSBvcmRlciBpbiBFdGhlckRlbHRhLgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbi4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgZXhwaXJlcyBhbmQgbm9uY2UuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZSBGZWUgcGVyY2VudGFnZSBvZiB0aGUgZXhjaGFuZ2UuCiAgLy8vIEBwYXJhbSBmaWxsVGFrZXJUb2tlbkFtb3VudCBEZXNpcmVkIGFtb3VudCBvZiB0YWtlclRva2VuIHRvIGZpbGwuCiAgLy8vIEBwYXJhbSB2IEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAvLy8gQHBhcmFtIHIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAvLy8gQHBhcmFtIHMgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgcy4KICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgZXRoZXJzIGZpbGxlZCBpbiB0cmFkZQogIGZ1bmN0aW9uIGZpbGxCdXlPcmRlcigKICAgIGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsCiAgICB1aW50WzZdIG9yZGVyVmFsdWVzLAogICAgdWludCBleGNoYW5nZUZlZSwKICAgIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICB1aW50OCB2LAogICAgYnl0ZXMzMiByLAogICAgYnl0ZXMzMiBzCiAgKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgIAogICAgLy9EZXBvc2l0IHRva2VucyBpbiBFdGhlckRlbHRhCiAgICBkZXBvc2l0VG9rZW4ob3JkZXJBZGRyZXNzZXNbMl0sIGZpbGxUYWtlclRva2VuQW1vdW50KTsKICAgIAogICAgdWludCBhbW91bnRUb1RyYWRlOwogICAgdWludCBmZWU7CiAgICAgIAogICAgLy9TdWJzdHJhY3QgRXRoZXJEZWx0YSBmZWUKICAgIChhbW91bnRUb1RyYWRlLCBmZWUpID0gc3Vic3RyYWN0RmVlKGV4Y2hhbmdlRmVlLCBmaWxsVGFrZXJUb2tlbkFtb3VudCk7CgogICAgLy9GaWxsIEV0aGVyRGVsdGEgT3JkZXIKICAgIHRyYWRlKAogICAgICBvcmRlckFkZHJlc3NlcywKICAgICAgb3JkZXJWYWx1ZXMsIAogICAgICBhbW91bnRUb1RyYWRlLAogICAgICB2LCAKICAgICAgciwgCiAgICAgIHMKICAgICk7CiAgICAKICAgIC8vV2l0aGRyYXcgZXRoZXJzIG9idGFpbmVkIGZyb20gRXRoZXJEZWx0YQogICAgd2l0aGRyYXcoZ2V0UGFydGlhbEFtb3VudChvcmRlclZhbHVlc1swXSwgb3JkZXJWYWx1ZXNbMV0sIGFtb3VudFRvVHJhZGUpKTsKICAgIAogICAgLy9SZXR1cm5zIHRoZSBhbW91bnQgb2YgZXRoZXJzIG9idGFpbmVkCiAgICByZXR1cm4gZ2V0UGFydGlhbEFtb3VudChvcmRlclZhbHVlc1swXSwgb3JkZXJWYWx1ZXNbMV0sIGFtb3VudFRvVHJhZGUpOwogIH0KICAKICAvLy8gQGRldiBUcmFkZSBhbiBFdGhlckRlbHRhIG9yZGVyLgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbi4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgZXhwaXJlcyBhbmQgbm9uY2UuCiAgLy8vIEBwYXJhbSBhbW91bnRUb1RyYWRlIERlc2lyZWQgYW1vdW50IG9mIHRha2VyVG9rZW4gdG8gZmlsbC4KICAvLy8gQHBhcmFtIHYgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogIC8vLyBAcGFyYW0gciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyByLgogIC8vLyBAcGFyYW0gcyBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogIGZ1bmN0aW9uIHRyYWRlKAogICAgYWRkcmVzc1s1XSBvcmRlckFkZHJlc3NlcywKICAgIHVpbnRbNl0gb3JkZXJWYWx1ZXMsCiAgICB1aW50IGFtb3VudFRvVHJhZGUsCiAgICB1aW50OCB2LAogICAgYnl0ZXMzMiByLAogICAgYnl0ZXMzMiBzCiAgKSBpbnRlcm5hbCB7CiAgICAgIAogICAgIC8vRmlsbCBFdGhlckRlbHRhIE9yZGVyCiAgICAgRXRoZXJEZWx0YShFVEhFUkRFTFRBX0FERFIpLnRyYWRlKAogICAgICBvcmRlckFkZHJlc3Nlc1syXSwgCiAgICAgIG9yZGVyVmFsdWVzWzFdLCAKICAgICAgb3JkZXJBZGRyZXNzZXNbMV0sIAogICAgICBvcmRlclZhbHVlc1swXSwgCiAgICAgIG9yZGVyVmFsdWVzWzJdLCAKICAgICAgb3JkZXJWYWx1ZXNbM10sIAogICAgICBvcmRlckFkZHJlc3Nlc1swXSwgCiAgICAgIHYsIAogICAgICByLCAKICAgICAgcywgCiAgICAgIGFtb3VudFRvVHJhZGUKICAgICk7CiAgfQogIAogIC8vLyBAZGV2IEdldCB0aGUgYXZhaWxhYmxlIGFtb3VudCBvZiBhbiBFdGhlckRlbHRhIG9yZGVyLgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZSBGZWUgcGVyY2VudGFnZSBvZiB0aGUgZXhjaGFuZ2UuCiAgLy8vIEBwYXJhbSB2IEFycmF5IEVDRFNBIHNpZ25hdHVyZSB2IHBhcmFtZXRlcnMuCiAgLy8vIEBwYXJhbSByIEFycmF5IG9mIEVDRFNBIHNpZ25hdHVyZSByIHBhcmFtZXRlcnMuCiAgLy8vIEBwYXJhbSBzIEFycmF5IG9mIEVDRFNBIHNpZ25hdHVyZSBzIHBhcmFtZXRlcnMuCiAgLy8vIEByZXR1cm4gQXZhaWxhYmxlIGFtb3VudCBvZiB0aGUgb3JkZXIuCiAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlQW1vdW50KAogICAgYWRkcmVzc1s1XSBvcmRlckFkZHJlc3NlcywKICAgIHVpbnRbNl0gb3JkZXJWYWx1ZXMsCiAgICB1aW50IGV4Y2hhbmdlRmVlLAogICAgdWludDggdiwKICAgIGJ5dGVzMzIgciwKICAgIGJ5dGVzMzIgcwogICkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgIAogICAgLy9JZiBleHBpcmVkIHJldHVybiAwIAogICAgaWYoYmxvY2subnVtYmVyID4gb3JkZXJWYWx1ZXNbMl0pCiAgICAgIHJldHVybiAwOwogICAgICAKICAgIC8vRmlsbCBFdGhlckRlbHRhIE9yZGVyCiAgICB1aW50IGF2YWlsYWJsZVZvbHVtZSA9IEV0aGVyRGVsdGEoRVRIRVJERUxUQV9BRERSKS5hdmFpbGFibGVWb2x1bWUoCiAgICAgIG9yZGVyQWRkcmVzc2VzWzJdLCAKICAgICAgb3JkZXJWYWx1ZXNbMV0sIAogICAgICBvcmRlckFkZHJlc3Nlc1sxXSwgCiAgICAgIG9yZGVyVmFsdWVzWzBdLCAKICAgICAgb3JkZXJWYWx1ZXNbMl0sIAogICAgICBvcmRlclZhbHVlc1szXSwgCiAgICAgIG9yZGVyQWRkcmVzc2VzWzBdLCAKICAgICAgdiwgCiAgICAgIHIsIAogICAgICBzCiAgICApOwogICAgCiAgICAvL0F2YWlsYWJsZVZvbHVtZSBhZGRzIHRoZSBmZWUgcGVyY2VudGFnZSAoWCAtIFggKiBmZWUpCiAgICByZXR1cm4gZ2V0UGFydGlhbEFtb3VudChhdmFpbGFibGVWb2x1bWUsIFNhZmVNYXRoLnNhZmVTdWIoMSBldGhlciwgZXhjaGFuZ2VGZWUpLCAxIGV0aGVyKTsKICB9CiAgCiAgLy8vIEBkZXYgU3Vic3RyYWN0cyB0aGUgdGFrZSBmZWUgZnJvbSBFdGhlckRlbHRhLgogIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCB0byBzdWJzdHJhY3QgRXRoZXJEZWx0YSBmZWUKICAvLy8gQHJldHVybiBBbW91bnQgbWludXMgdGhlIEV0aGVyRGVsdGEgZmVlLgogIGZ1bmN0aW9uIHN1YnN0cmFjdEZlZSh1aW50IGZlZVBlcmNlbnRhZ2UsIHVpbnQgYW1vdW50KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQsIHVpbnQpIHsKICAgIHVpbnQgZmVlID0gZ2V0UGFydGlhbEFtb3VudChhbW91bnQsIDEgZXRoZXIsIGZlZVBlcmNlbnRhZ2UpOwogICAgcmV0dXJuIChTYWZlTWF0aC5zYWZlU3ViKGFtb3VudCwgZmVlKSwgZmVlKTsKICB9CiAgCiAgLy8vIEBkZXYgRGVwb3NpdCBldGhlcnMgdG8gRXRoZXJEZWx0YS4KICAvLy8gQHBhcmFtIGFtb3VudCBBbW91bnQgb2YgZXRoZXJzIHRvIGRlcG9zaXQgaW4gRXRoZXJEZWx0YQogIGZ1bmN0aW9uIGRlcG9zaXQodWludCBhbW91bnQpIGludGVybmFsIHsKICAgIEV0aGVyRGVsdGEoRVRIRVJERUxUQV9BRERSKS5kZXBvc2l0LnZhbHVlKGFtb3VudCkoKTsKICB9CiAgCiAgLy8vIEBkZXYgRGVwb3NpdCB0b2tlbnMgdG8gRXRoZXJEZWx0YS4KICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4gdG8gZGVwb3NpdCBpbiBFdGhlckRlbHRhCiAgLy8vIEBwYXJhbSBhbW91bnQgQW1vdW50IG9mIHRva2VucyB0byBkZXBvc2l0IGluIEV0aGVyRGVsdGEKICBmdW5jdGlvbiBkZXBvc2l0VG9rZW4oYWRkcmVzcyB0b2tlbiwgdWludCBhbW91bnQpIGludGVybmFsIHsKICAgIFRva2VuKHRva2VuKS5hcHByb3ZlKEVUSEVSREVMVEFfQUREUiwgYW1vdW50KTsKICAgIEV0aGVyRGVsdGEoRVRIRVJERUxUQV9BRERSKS5kZXBvc2l0VG9rZW4odG9rZW4sIGFtb3VudCk7CiAgfQogIAogIC8vLyBAZGV2IFdpdGhkcmF3IGV0aGVycyBmcm9tIEV0aGVyRGVsdGEKICAvLy8gQHBhcmFtIGFtb3VudCBBbW91bnQgb2YgZXRoZXJzIHRvIHdpdGhkcmF3IGZyb20gRXRoZXJEZWx0YQogIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7IAogICAgRXRoZXJEZWx0YShFVEhFUkRFTFRBX0FERFIpLndpdGhkcmF3KGFtb3VudCk7CiAgfQogICAKICAvLy8gQGRldiBXaXRoZHJhdyB0b2tlbnMgZnJvbSBFdGhlckRlbHRhLgogIC8vLyBAcGFyYW0gdG9rZW4gQWRkcmVzcyBvZiB0b2tlbiB0byB3aXRoZHJhdyBmcm9tIEV0aGVyRGVsdGEKICAvLy8gQHBhcmFtIGFtb3VudCBBbW91bnQgb2YgdG9rZW5zIHRvIHdpdGhkcmF3IGZyb20gRXRoZXJEZWx0YQogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW4oYWRkcmVzcyB0b2tlbiwgdWludCBhbW91bnQpIGludGVybmFsIHsgCiAgICBFdGhlckRlbHRhKEVUSEVSREVMVEFfQUREUikud2l0aGRyYXdUb2tlbih0b2tlbiwgYW1vdW50KTsKICB9CiAgCiAgCiAgLy8vIEBkZXYgQ2FsY3VsYXRlcyBwYXJ0aWFsIHZhbHVlIGdpdmVuIGEgbnVtZXJhdG9yIGFuZCBkZW5vbWluYXRvci4KICAvLy8gQHBhcmFtIG51bWVyYXRvciBOdW1lcmF0b3IuCiAgLy8vIEBwYXJhbSBkZW5vbWluYXRvciBEZW5vbWluYXRvci4KICAvLy8gQHBhcmFtIHRhcmdldCBWYWx1ZSB0byBjYWxjdWxhdGUgcGFydGlhbCBvZi4KICAvLy8gQHJldHVybiBQYXJ0aWFsIHZhbHVlIG9mIHRhcmdldC4KICBmdW5jdGlvbiBnZXRQYXJ0aWFsQW1vdW50KHVpbnQgbnVtZXJhdG9yLCB1aW50IGRlbm9taW5hdG9yLCB1aW50IHRhcmdldCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnQpCiAgewogICAgcmV0dXJuIFNhZmVNYXRoLnNhZmVEaXYoU2FmZU1hdGguc2FmZU11bChudW1lcmF0b3IsIHRhcmdldCksIGRlbm9taW5hdG9yKTsKICB9Cgp9CgpsaWJyYXJ5IFpyeFRyYWRlciB7CiAgICAKICB1aW50MTYgY29uc3RhbnQgcHVibGljIEVYVEVSTkFMX1FVRVJZX0dBU19MSU1JVCA9IDQ5OTk7ICAgIC8vIENoYW5nZXMgdG8gc3RhdGUgcmVxdWlyZSBhdCBsZWFzdCA1MDAwIGdhcwoKICBhZGRyZXNzIGNvbnN0YW50IHB1YmxpYyBaUlhfRVhDSEFOR0VfQUREUiA9IDB4MTI0NTljOTUxMTI3ZTBjMzc0ZmY5MTA1ZGRhMDk3NjYyYTAyNzA5MzsgLy8gMHggRXhjaGFuZ2UgY29udHJhY3QgYWRkcmVzcwogIGFkZHJlc3MgY29uc3RhbnQgcHVibGljIFRPS0VOX1RSQU5TRkVSX1BST1hZX0FERFIgPSAweDhkYTBkODBmNTAwN2VmMWU0MzFkZDIxMjcxNzhkMjI0ZTMyYzJlZjQ7IC8vIFRva2VuVHJhbnNmZXJQcm94eSBjb250cmFjdCBhZGRyZXNzCiAgYWRkcmVzcyBjb25zdGFudCBwdWJsaWMgV0VUSF9BRERSID0gMHhjMDJhYWEzOWIyMjNmZThkMGEwZTVjNGYyN2VhZDkwODNjNzU2Y2MyOyAvLyBXcmFwcGVkIGV0aGVyIGFkZHJlc3MgKFdFVEgpCiAgYWRkcmVzcyBjb25zdGFudCBwdWJsaWMgWlJYX1RPS0VOX0FERFIgPSAweGU0MWQyNDg5NTcxZDMyMjE4OTI0NmRhZmE1ZWJkZTFmNDY5OWY0OTg7CiAgCiAgLy8vIEBkZXYgR2V0cyB0aGUgYWRkcmVzcyBvZiB0aGUgV3JhcHBlZCBFdGhlciBjb250cmFjdAogIC8vLyBAcmV0dXJuIEFkZHJlc3Mgb2YgV2V0aCBDb250cmFjdC4KICBmdW5jdGlvbiBnZXRXZXRoQWRkcmVzcygpIGludGVybmFsIHJldHVybnMoYWRkcmVzcykgewogICAgICByZXR1cm4gV0VUSF9BRERSOwogIH0KICAKICAvLy8gQGRldiBGaWxscyBhIHNlbGwgb3JkZXIgaW4gMHguCiAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyLCB0YWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbiwgYW5kIGZlZVJlY2lwaWVudC4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgbWFrZXJGZWUsIHRha2VyRmVlLCBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWMsIGFuZCBzYWx0LgogIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsLgogIC8vLyBAcGFyYW0gdiBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgLy8vIEBwYXJhbSByIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgLy8vIEBwYXJhbSBzIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgLy8vIEByZXR1cm4gVG90YWwgYW1vdW50IG9mIHRha2VyVG9rZW4gZmlsbGVkIGluIHRyYWRlLgogIGZ1bmN0aW9uIGZpbGxTZWxsT3JkZXIoCiAgICBhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLAogICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICB1aW50OCB2LAogICAgYnl0ZXMzMiByLAogICAgYnl0ZXMzMiBzCiAgKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIAogIHsKICAgICAKICAgIC8vIFdyYXAgRVRIIHRvIFdFVEgKICAgIGRlcG9zaXRXZXRoKGZpbGxUYWtlclRva2VuQW1vdW50KTsKICAgIAogICAgLy8gQWxsb3cgMHggVHJhbnNmZXIgVG9rZW4gUHJveHkgdG8gdHJhbnNmZXIgV0VUSAogICAgYXByb3ZlVG9rZW4oV0VUSF9BRERSLCBmaWxsVGFrZXJUb2tlbkFtb3VudCk7CiAgICAKICAgIC8vQWxsb3cgWlJYIFRyYW5zZmVyIFRva2VuIFByb3h5IHRvIHRyYW5zZmVyIHRoZSB0b2tlbiBmb3IgZmVlcwogICAgYXByb3ZlVG9rZW4oWlJYX1RPS0VOX0FERFIsIGdldFBhcnRpYWxBbW91bnQoZmlsbFRha2VyVG9rZW5BbW91bnQsIG9yZGVyVmFsdWVzWzFdLCBvcmRlclZhbHVlc1szXSkpOwogICAgCiAgICB1aW50IGV0aGVyc1NwZW50ID0gRXhjaGFuZ2UoWlJYX0VYQ0hBTkdFX0FERFIpLmZpbGxPcmRlcigKICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgIG9yZGVyVmFsdWVzLAogICAgICBmaWxsVGFrZXJUb2tlbkFtb3VudCwKICAgICAgdHJ1ZSwKICAgICAgdiwKICAgICAgciwKICAgICAgcwogICAgKTsKICAgIAogICAgLy8gRmlsbCAweCBvcmRlcgogICAgcmV0dXJuIGdldFBhcnRpYWxBbW91bnQob3JkZXJWYWx1ZXNbMF0sIG9yZGVyVmFsdWVzWzFdLCBldGhlcnNTcGVudCk7CiAgICAKICB9CiAgCiAgLy8vIEBkZXYgRmlsbHMgYSBidXkgb3JkZXIgaW4gMHguCiAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyLCB0YWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbiwgYW5kIGZlZVJlY2lwaWVudC4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgbWFrZXJGZWUsIHRha2VyRmVlLCBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWMsIGFuZCBzYWx0LgogIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsLgogIC8vLyBAcGFyYW0gdiBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgLy8vIEBwYXJhbSByIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgLy8vIEBwYXJhbSBzIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgLy8vIEByZXR1cm4gVG90YWwgYW1vdW50IG9mIHRha2VyVG9rZW4gZmlsbGVkIGluIHRyYWRlLgogIGZ1bmN0aW9uIGZpbGxCdXlPcmRlcigKICAgIGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsCiAgICB1aW50WzZdIG9yZGVyVmFsdWVzLAogICAgdWludCBmaWxsVGFrZXJUb2tlbkFtb3VudCwKICAgIHVpbnQ4IHYsCiAgICBieXRlczMyIHIsCiAgICBieXRlczMyIHMKICApIGludGVybmFsIHJldHVybnModWludCkgCiAgewogICAgCiAgICAvL0FsbG93IDB4IFRyYW5zZmVyIFRva2VuIFByb3h5IHRvIHRyYW5zZmVyIHRoZSB0b2tlbgogICAgYXByb3ZlVG9rZW4ob3JkZXJBZGRyZXNzZXNbM10sIGZpbGxUYWtlclRva2VuQW1vdW50KTsKICAgIAogICAgLy9BbGxvdyBaUlggVHJhbnNmZXIgVG9rZW4gUHJveHkgdG8gdHJhbnNmZXIgdGhlIHRva2VuIGZvciBmZWVzCiAgICBhcHJvdmVUb2tlbihaUlhfVE9LRU5fQUREUiwgZ2V0UGFydGlhbEFtb3VudChmaWxsVGFrZXJUb2tlbkFtb3VudCwgb3JkZXJWYWx1ZXNbMV0sIG9yZGVyVmFsdWVzWzNdKSk7CiAgICAKICAgIC8vIEZpbGwgMHggb3JkZXIKICAgIHVpbnQgdG9rZW5zU29sZCA9IEV4Y2hhbmdlKFpSWF9FWENIQU5HRV9BRERSKS5maWxsT3JkZXIoCiAgICAgIG9yZGVyQWRkcmVzc2VzLAogICAgICBvcmRlclZhbHVlcywKICAgICAgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICAgIHRydWUsCiAgICAgIHYsCiAgICAgIHIsCiAgICAgIHMKICAgICk7CiAgICAKICAgIHVpbnQgZXRoZXJzT2J0YWluZWQgPSBnZXRQYXJ0aWFsQW1vdW50KG9yZGVyVmFsdWVzWzBdLCBvcmRlclZhbHVlc1sxXSwgdG9rZW5zU29sZCk7CiAgICAKICAgIC8vIFVud3JhcCBXRVRIIHRvIEVUSAogICAgd2l0aGRyYXdXZXRoKGV0aGVyc09idGFpbmVkKTsKICAgIAogICAgcmV0dXJuIGV0aGVyc09idGFpbmVkOwogIH0KICAKICAvLy8gQGRldiBHZXQgdGhlIGF2YWlsYWJsZSBhbW91bnQgb2YgYSAweCBvcmRlci4KICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3MgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciBhZGRyZXNzZXMuCiAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiB1aW50IGFycmF5cyBjb250YWluaW5nIGluZGl2aWR1YWwgb3JkZXIgdmFsdWVzLgogIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogIC8vLyBAcmV0dXJuIEF2YWlsYWJsZSBhbW91bnQgb2YgYSAweCBvcmRlci4KICBmdW5jdGlvbiBnZXRBdmFpbGFibGVBbW91bnQoCiAgICBhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLAogICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgIHVpbnQ4IHYsCiAgICBieXRlczMyIHIsCiAgICBieXRlczMyIHMKICApIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAKICAgICAgLy9JZiBleHBpcmVkIHJldHVybiAwIAogICAgICBpZihibG9jay50aW1lc3RhbXAgPj0gb3JkZXJWYWx1ZXNbNF0pCiAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAKICAgICAgYnl0ZXMzMiBvcmRlckhhc2ggPSBFeGNoYW5nZShaUlhfRVhDSEFOR0VfQUREUikuZ2V0T3JkZXJIYXNoKG9yZGVyQWRkcmVzc2VzLCBvcmRlclZhbHVlcyk7CiAgICAgIAogICAgICB1aW50IHVuQXZhaWxhYmxlID0gRXhjaGFuZ2UoWlJYX0VYQ0hBTkdFX0FERFIpLmdldFVuYXZhaWxhYmxlVGFrZXJUb2tlbkFtb3VudChvcmRlckhhc2gpOwogIAogICAgICAvL0dldHMgdGhlIGF2YWlsYWJsZSBhbW91bnQgYWNvb3JkaW5nIHRvIDB4IGNvbnRyYWN0IHN1YnN0cmFjdGluZyB0YWtlclRva2VuQW1vdW50IHdpdGggdW5hdmFpbGFibGUgdGFrZXJUb2tlbkFtb3VudAogICAgICB1aW50IGF2YWlsYWJsZUJ5Q29udHJhY3QgPSBTYWZlTWF0aC5zYWZlU3ViKG9yZGVyVmFsdWVzWzFdLCB1bkF2YWlsYWJsZSk7CiAgICAgIAogICAgICAvL0dldHMgdGhlIGF2YWlsYWJsZSBhbW91bnQgYWNjb3JkaW5nIG9mIHRoZSBtYWtlciB0b2tlbiBiYWxhbmNlCiAgICAgIHVpbnQgYXZhaWxhYmxlQnlCYWxhbmNlID0gIGdldFBhcnRpYWxBbW91bnQoZ2V0QmFsYW5jZShvcmRlckFkZHJlc3Nlc1syXSwgb3JkZXJBZGRyZXNzZXNbMF0pLCBvcmRlclZhbHVlc1swXSwgb3JkZXJWYWx1ZXNbMV0pOwogICAgICAKICAgICAgLy9HZXRzIHRoZSBhdmFpbGFibGUgYW1vdW50IGFjY29yZGluZyBob3cgbXVjaCBhbGxvd2FuY2Ugb2YgdGhlIHRva2VuIHRoZSBtYWtlciBoYXMKICAgICAgdWludCBhdmFpbGFibGVCeUFsbG93YW5jZSA9IGdldFBhcnRpYWxBbW91bnQoZ2V0QWxsb3dhbmNlKG9yZGVyQWRkcmVzc2VzWzJdLCBvcmRlckFkZHJlc3Nlc1swXSksIG9yZGVyVmFsdWVzWzBdLCBvcmRlclZhbHVlc1sxXSk7CiAgICAKICAgICAgLy9HZXQgdGhlIGF2YWlsYWJsZSBhbW91bnQgYWNjb3JkaW5nIHRvIGhvdyBtdWNoIFpSWCBmZWUgdGhlIG1ha2VyIGNhbiBwYXkgCiAgICAgIHVpbnQgenJ4QW1vdW50ID0gZ2V0QWxsb3dhbmNlKFpSWF9UT0tFTl9BRERSLCBvcmRlckFkZHJlc3Nlc1swXSk7CiAgICAgIHVpbnQgYXZhaWxhYmxlQnlaUlggPSBnZXRQYXJ0aWFsQW1vdW50KHpyeEFtb3VudCwgb3JkZXJWYWx1ZXNbMl0sIG9yZGVyVmFsdWVzWzFdKTsKICAgICAgCiAgICAgIC8vUmV0dXJucyB0aGUgbWluIHZhbHVlIG9mIGFsbCBhdmFpbGFibGUgcmVzdWx0cwogICAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KFNhZmVNYXRoLm1pbjI1NihTYWZlTWF0aC5taW4yNTYoYXZhaWxhYmxlQnlDb250cmFjdCwgYXZhaWxhYmxlQnlCYWxhbmNlKSwgYXZhaWxhYmxlQnlBbGxvd2FuY2UpLCBhdmFpbGFibGVCeVpSWCk7CiAgfQogICAgCiAgLy8vIEBkZXYgRGVwb3NpdCBXRVRICiAgLy8vIEBwYXJhbSBhbW91bnQgQW1vdW50IG9mIGV0aGVyIHRvIHdyYXAuCiAgZnVuY3Rpb24gZGVwb3NpdFdldGgodWludCBhbW91bnQpIGludGVybmFsIHsKICAgIEV0aGVyVG9rZW4oV0VUSF9BRERSKS5kZXBvc2l0LnZhbHVlKGFtb3VudCkoKTsKICB9CiAgCiAgLy8vIEBkZXYgQXBwcm92ZSB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZCBieSAweCBUb2tlbiBUcmFuc2ZlciBQcm94eQogIC8vLyBAcGFyYW0gdG9rZW4gQWRkcmVzcyBvZiB0b2tlbiB0byBhcHByb3ZlLgogIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgdG8gYXBwcm92ZS4KICBmdW5jdGlvbiBhcHJvdmVUb2tlbihhZGRyZXNzIHRva2VuLCB1aW50IGFtb3VudCkgaW50ZXJuYWwgewogICAgVG9rZW4odG9rZW4pLmFwcHJvdmUoVE9LRU5fVFJBTlNGRVJfUFJPWFlfQUREUiwgYW1vdW50KTsKICB9CiAgCiAgLy8vIEBkZXYgV2l0aGRyYXcgV0VUSAogIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCBvZiBldGhlciB0byB1bndyYXAuCiAgZnVuY3Rpb24gd2l0aGRyYXdXZXRoKHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7IAogICAgRXRoZXJUb2tlbihXRVRIX0FERFIpLndpdGhkcmF3KGFtb3VudCk7CiAgfQogIAogIC8vLyBAZGV2IENhbGN1bGF0ZXMgcGFydGlhbCB2YWx1ZSBnaXZlbiBhIG51bWVyYXRvciBhbmQgZGVub21pbmF0b3IuCiAgLy8vIEBwYXJhbSBudW1lcmF0b3IgTnVtZXJhdG9yLgogIC8vLyBAcGFyYW0gZGVub21pbmF0b3IgRGVub21pbmF0b3IuCiAgLy8vIEBwYXJhbSB0YXJnZXQgVmFsdWUgdG8gY2FsY3VsYXRlIHBhcnRpYWwgb2YuCiAgLy8vIEByZXR1cm4gUGFydGlhbCB2YWx1ZSBvZiB0YXJnZXQuCiAgZnVuY3Rpb24gZ2V0UGFydGlhbEFtb3VudCh1aW50IG51bWVyYXRvciwgdWludCBkZW5vbWluYXRvciwgdWludCB0YXJnZXQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpCiAgewogICAgcmV0dXJuIFNhZmVNYXRoLnNhZmVEaXYoU2FmZU1hdGguc2FmZU11bChudW1lcmF0b3IsIHRhcmdldCksIGRlbm9taW5hdG9yKTsKICB9CgogIC8vLyBAZGV2IEdldCB0b2tlbiBiYWxhbmNlIG9mIGFuIGFkZHJlc3MuCiAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRva2VuLgogIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAvLy8gQHJldHVybiBUb2tlbiBiYWxhbmNlIG9mIG93bmVyLgogIGZ1bmN0aW9uIGdldEJhbGFuY2UoYWRkcmVzcyB0b2tlbiwgYWRkcmVzcyBvd25lcikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkKICB7CiAgICByZXR1cm4gVG9rZW4odG9rZW4pLmJhbGFuY2VPZi5nYXMoRVhURVJOQUxfUVVFUllfR0FTX0xJTUlUKShvd25lcik7IC8vIExpbWl0IGdhcyB0byBwcmV2ZW50IHJlZW50cmFuY3kKICB9CgogIC8vLyBAZGV2IEdldCBhbGxvd2FuY2Ugb2YgdG9rZW4gZ2l2ZW4gdG8gVG9rZW5UcmFuc2ZlclByb3h5IGJ5IGFuIGFkZHJlc3MuCiAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRva2VuLgogIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAvLy8gQHJldHVybiBBbGxvd2FuY2Ugb2YgdG9rZW4gZ2l2ZW4gdG8gVG9rZW5UcmFuc2ZlclByb3h5IGJ5IG93bmVyLgogIGZ1bmN0aW9uIGdldEFsbG93YW5jZShhZGRyZXNzIHRva2VuLCBhZGRyZXNzIG93bmVyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KQogIHsKICAgIHJldHVybiBUb2tlbih0b2tlbikuYWxsb3dhbmNlLmdhcyhFWFRFUk5BTF9RVUVSWV9HQVNfTElNSVQpKG93bmVyLCBUT0tFTl9UUkFOU0ZFUl9QUk9YWV9BRERSKTsgLy8gTGltaXQgZ2FzIHRvIHByZXZlbnQgcmVlbnRyYW5jeQogIH0KICAKIAp9Cgpjb250cmFjdCBFYXN5VHJhZGUgewogICAgCiAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBWRVJTSU9OID0gIjEuMC4wIjsKICBhZGRyZXNzIGNvbnN0YW50IHB1YmxpYyBaUlhfVE9LRU5fQUREUiA9IDB4ZTQxZDI0ODk1NzFkMzIyMTg5MjQ2ZGFmYTVlYmRlMWY0Njk5ZjQ5ODsKICAKICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsgLy8gQWRtaW4gYWRkcmVzcwogIGFkZHJlc3MgcHVibGljIGZlZUFjY291bnQ7IC8vIEFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGZlZQogIHVpbnQgcHVibGljIHNlcnZpY2VGZWU7IC8vIFBlcmNlbnRhZ2UgdGltZXMgKDEgZXRoZXIpCiAgdWludCBwdWJsaWMgY29sbGVjdGVkRmVlID0gMDsgLy8gVG90YWwgb2YgZmVlcyBhY2N1bXVsYXRlZAogCiAgZXZlbnQgRmlsbFNlbGxPcmRlcihhZGRyZXNzIGFjY291bnQsIGFkZHJlc3MgdG9rZW4sIHVpbnQgdG9rZW5zLCB1aW50IGV0aGVycywgdWludCB0b2tlbnNTb2xkLCB1aW50IGV0aGVyc09idGFpbmVkLCB1aW50IHRva2Vuc1JlZnVuZGVkKTsKICBldmVudCBGaWxsQnV5T3JkZXIoYWRkcmVzcyBhY2NvdW50LCBhZGRyZXNzIHRva2VuLCB1aW50IHRva2VucywgdWludCBldGhlcnMsIHVpbnQgdG9rZW5zT2J0YWluZWQsIHVpbnQgZXRoZXJzU3BlbnQsIHVpbnQgZXRoZXJzUmVmdW5kZWQpOwogIAogIG1vZGlmaWVyIG9ubHlBZG1pbigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZG1pbik7CiAgICBfOwogIH0KICAKICBtb2RpZmllciBvbmx5RmVlQWNjb3VudCgpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBmZWVBY2NvdW50KTsKICAgIF87CiAgfQogCiAgZnVuY3Rpb24gRWFzeVRyYWRlKAogICAgYWRkcmVzcyBhZG1pbl8sCiAgICBhZGRyZXNzIGZlZUFjY291bnRfLAogICAgdWludCBzZXJ2aWNlRmVlXykgCiAgewogICAgYWRtaW4gPSBhZG1pbl87CiAgICBmZWVBY2NvdW50ID0gZmVlQWNjb3VudF87CiAgICBzZXJ2aWNlRmVlID0gc2VydmljZUZlZV87CiAgfSAKICAgIAogIC8vLyBAZGV2IEZvciBleGNoYW5nZSBjb250cmFjdHMgdGhhdCBzZW5kIGV0aGVycyBiYWNrLgogIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgeyAKICAgICAgLy9Pbmx5IGFjY2VwdHMgcGF5bWVudHMgZnJvbSAweCBXcmFwcGVkIEV0aGVyIG9yIEV0aGVyRGVsdGEKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IFpyeFRyYWRlci5nZXRXZXRoQWRkcmVzcygpIHx8IG1zZy5zZW5kZXIgPT0gRXRoZXJEZWx0YVRyYWRlci5nZXRFdGhlckRlbHRhQWRkcmVzc3MoKSk7CiAgfQoKICAvLy8gQGRldiBTZXQgdGhlIG5ldyBhZG1pbi4gT25seSBhZG1pbiBjYW4gc2V0IHRoZSBuZXcgYWRtaW4uCiAgLy8vIEBwYXJhbSBhZG1pbl8gQWRkcmVzcyBvZiB0aGUgbmV3IGFkbWluLgogIGZ1bmN0aW9uIGNoYW5nZUFkbWluKGFkZHJlc3MgYWRtaW5fKSBwdWJsaWMgb25seUFkbWluIHsKICAgIGFkbWluID0gYWRtaW5fOwogIH0KICAKICAvLy8gQGRldiBTZXQgdGhlIG5ldyBmZWUgYWNjb3VudC4gT25seSBhZG1pbiBjYW4gc2V0IHRoZSBuZXcgZmVlIGFjY291bnQuCiAgLy8vIEBwYXJhbSBmZWVBY2NvdW50XyBBZGRyZXNzIG9mIHRoZSBuZXcgZmVlIGFjY291bnQuCiAgZnVuY3Rpb24gY2hhbmdlRmVlQWNjb3VudChhZGRyZXNzIGZlZUFjY291bnRfKSBwdWJsaWMgb25seUFkbWluIHsKICAgIGZlZUFjY291bnQgPSBmZWVBY2NvdW50XzsKICB9CgogIC8vLyBAZGV2IFNldCB0aGUgc2VydmljZSBmZWUuIE9ubHkgYWRtaW4gY2FuIHNldCB0aGUgbmV3IGZlZS4gU2VydmljZSBmZWUgY2FuIG9ubHkgYmUgcmVkdWNlZCwgbmV2ZXIgaW5jcmVhc2VkCiAgLy8vIEBwYXJhbSBzZXJ2aWNlRmVlXyBQZXJjZW50YWdlIHRpbWVzICgxIGV0aGVyKS4KICBmdW5jdGlvbiBjaGFuZ2VGZWVQZXJjZW50YWdlKHVpbnQgc2VydmljZUZlZV8pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgcmVxdWlyZShzZXJ2aWNlRmVlXyA8IHNlcnZpY2VGZWUpOwogICAgc2VydmljZUZlZSA9IHNlcnZpY2VGZWVfOwogIH0KICAKICAvLy8gQGRldiBDcmVhdGVzIGFuIG9yZGVyIHRvIHNlbGwgYSB0b2tlbi4gCiAgLy8vIEBub3RpY2UgTmVlZHMgZmlyc3QgdG8gY2FsbCBUb2tlbih0b2tlbmRfYWRkcmVzcykuYXBwcm92ZSh0aGlzLCB0b2tlbnNfKSBzbyB0aGUgY29udHJhY3QgY2FuIHRyYWRlIHRoZSB0b2tlbnMuCiAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRoZSB0b2tlbiB0byBzZWxsLgogIC8vLyBAcGFyYW0gdG9rZW5zVG90YWwgQW1vdW50IG9mIHRoZSB0b2tlbiB0byBzZWxsLgogIC8vLyBAcGFyYW0gZXRoZXJzVG90YWwgQW1vdW50IG9mIGV0aGVycyB0byBnZXQuCiAgLy8vIEBwYXJhbSBleGNoYW5nZXMgRXhjaGFuZ2VzIG9mIGVhY2ggb3JkZXIgKDA6IEV0aGVyRGVsdGEgMTogMHgpLgogIC8vLyBAcGFyYW0gZXRoZXJzVG90YWwgQW1vdW50IG9mIGV0aGVycyB0byBnZXQuCiAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBhZGRyZXNzIGFycmF5cyBjb250YWluaW5nIGluZGl2aWR1YWwgb3JkZXIgYWRkcmVzc2VzLgogIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2YgdWludCBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIHZhbHVlcy4KICAvLy8gQHBhcmFtIGV4Y2hhbmdlRmVlcyBBcnJheSBvZiBleGNoYW5nZSBmZWVzIHRvIGZpbGwgaW4gb3JkZXJzLgogIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogIGZ1bmN0aW9uIGNyZWF0ZVNlbGxPcmRlcigKICAgIGFkZHJlc3MgdG9rZW4sIAogICAgdWludCB0b2tlbnNUb3RhbCwgCiAgICB1aW50IGV0aGVyc1RvdGFsLAogICAgdWludDhbXSBleGNoYW5nZXMsCiAgICBhZGRyZXNzWzVdW10gb3JkZXJBZGRyZXNzZXMsCiAgICB1aW50WzZdW10gb3JkZXJWYWx1ZXMsCiAgICB1aW50W10gZXhjaGFuZ2VGZWVzLAogICAgdWludDhbXSB2LAogICAgYnl0ZXMzMltdIHIsCiAgICBieXRlczMyW10gcwogICkgcHVibGljCiAgewogICAgCiAgICAvL1RyYW5zZmVyIHRva2VucyB0byBjb250cmFjdCBzbyBpdCBjYW4gc2VsbCB0aGVtLgogICAgcmVxdWlyZShUb2tlbih0b2tlbikudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIHRva2Vuc1RvdGFsKSk7CiAgICAKICAgIHVpbnQgZXRoZXJzT2J0YWluZWQ7CiAgICB1aW50IHRva2Vuc1NvbGQ7CiAgICB1aW50IHRva2Vuc1JlZnVuZGVkID0gdG9rZW5zVG90YWw7CiAgICAKICAgIChldGhlcnNPYnRhaW5lZCwgdG9rZW5zU29sZCkgPSBmaWxsT3JkZXJzRm9yU2VsbFJlcXVlc3QoCiAgICAgIHRva2Vuc1RvdGFsLAogICAgICBleGNoYW5nZXMsCiAgICAgIG9yZGVyQWRkcmVzc2VzLAogICAgICBvcmRlclZhbHVlcywKICAgICAgZXhjaGFuZ2VGZWVzLAogICAgICB2LAogICAgICByLAogICAgICBzCiAgICApOwogICAgCiAgICAvL1dlIG1ha2Ugc3VyZSB0aGF0IGF0IGxlYXN0IG9uZSBvcmRlciBoYWQgc29tZSBhbW91bnQgZmlsbGVkCiAgICByZXF1aXJlKGV0aGVyc09idGFpbmVkID4gMCAmJiB0b2tlbnNTb2xkID4wKTsKICAgIAogICAgLy9DaGVjayB0aGF0IHRoZSBwcmljZSBvZiB3aGF0IHdhcyBzb2xkIGlzIG5vdCBzbWFsbGVyIHRoYW4gdGhlIG1pbiBhZ3JlZWQKICAgIHJlcXVpcmUoU2FmZU1hdGguc2FmZURpdihldGhlcnNUb3RhbCwgdG9rZW5zVG90YWwpIDw9IFNhZmVNYXRoLnNhZmVEaXYoZXRoZXJzT2J0YWluZWQsIHRva2Vuc1NvbGQpKTsKICAgIAogICAgLy9TdWJzdHJhY3RzIHRoZSB0b2tlbnMgc29sZAogICAgdG9rZW5zUmVmdW5kZWQgPSBTYWZlTWF0aC5zYWZlU3ViKHRva2Vuc1RvdGFsLCB0b2tlbnNTb2xkKTsKICAgIAogICAgLy9SZXR1cm4gdG9rZW5zIG5vdCBzb2xkIAogICAgaWYodG9rZW5zUmVmdW5kZWQgPiAwKSAKICAgICByZXF1aXJlKFRva2VuKHRva2VuKS50cmFuc2Zlcihtc2cuc2VuZGVyLCB0b2tlbnNSZWZ1bmRlZCkpOwogICAgCiAgICAvL1NlbmQgdGhlIGV0aGVyc09idGFpbmVkCiAgICB0cmFuc2Zlcihtc2cuc2VuZGVyLCBldGhlcnNPYnRhaW5lZCk7CiAgICAKICAgIEZpbGxTZWxsT3JkZXIobXNnLnNlbmRlciwgdG9rZW4sIHRva2Vuc1RvdGFsLCBldGhlcnNUb3RhbCwgdG9rZW5zU29sZCwgZXRoZXJzT2J0YWluZWQsIHRva2Vuc1JlZnVuZGVkKTsKICB9CiAgCiAgLy8vIEBkZXYgRmlsbHMgYSBzZWxsIG9yZGVyIGJ5IHN5bmNocm9ub3VzbHkgZXhlY3V0aW5nIGV4Y2hhbmdlIGJ1eSBvcmRlcnMuCiAgLy8vIEBwYXJhbSB0b2tlbnNUb3RhbCBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbGwuCiAgLy8vIEBwYXJhbSBleGNoYW5nZXMgRXhjaGFuZ2VzIG9mIGVhY2ggb3JkZXIgKDA6IEV0aGVyRGVsdGEgMTogMHgpLgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZXMgQXJyYXkgb2YgZXhjaGFuZ2UgZmVlcyB0byBmaWxsIGluIG9yZGVycy4KICAvLy8gQHBhcmFtIHYgQXJyYXkgRUNEU0Egc2lnbmF0dXJlIHYgcGFyYW1ldGVycy4KICAvLy8gQHBhcmFtIHIgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHIgcGFyYW1ldGVycy4KICAvLy8gQHBhcmFtIHMgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHMgcGFyYW1ldGVycy4KICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgZXRoZXJzIG9idGFpbmVkIGFuZCB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQuCiAgZnVuY3Rpb24gZmlsbE9yZGVyc0ZvclNlbGxSZXF1ZXN0KAogICAgdWludCB0b2tlbnNUb3RhbCwKICAgIHVpbnQ4W10gZXhjaGFuZ2VzLAogICAgYWRkcmVzc1s1XVtdIG9yZGVyQWRkcmVzc2VzLAogICAgdWludFs2XVtdIG9yZGVyVmFsdWVzLAogICAgdWludFtdIGV4Y2hhbmdlRmVlcywKICAgIHVpbnQ4W10gdiwKICAgIGJ5dGVzMzJbXSByLAogICAgYnl0ZXMzMltdIHMKICApIGludGVybmFsIHJldHVybnModWludCwgdWludCkKICB7CiAgICB1aW50IHRvdGFsRXRoZXJzT2J0YWluZWQgPSAwOwogICAgdWludCB0b2tlbnNSZW1haW5pbmcgPSB0b2tlbnNUb3RhbDsKICAgIAogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3JkZXJBZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgCiAgICAgICh0b3RhbEV0aGVyc09idGFpbmVkLCB0b2tlbnNSZW1haW5pbmcpID0gZmlsbE9yZGVyRm9yU2VsbFJlcXVlc3QoCiAgICAgICAgIHRvdGFsRXRoZXJzT2J0YWluZWQsCiAgICAgICAgIHRva2Vuc1JlbWFpbmluZywKICAgICAgICAgZXhjaGFuZ2VzW2ldLAogICAgICAgICBvcmRlckFkZHJlc3Nlc1tpXSwKICAgICAgICAgb3JkZXJWYWx1ZXNbaV0sCiAgICAgICAgIGV4Y2hhbmdlRmVlc1tpXSwKICAgICAgICAgdltpXSwKICAgICAgICAgcltpXSwKICAgICAgICAgc1tpXQogICAgICApOwoKICAgIH0KICAgIAogICAgLy9TdWJzdHJhY3RzIHNlcnZpY2UgZmVlCiAgICBpZih0b3RhbEV0aGVyc09idGFpbmVkID4gMCkgewogICAgICB1aW50IGZlZSA9ICBTYWZlTWF0aC5zYWZlTXVsKHRvdGFsRXRoZXJzT2J0YWluZWQsIHNlcnZpY2VGZWUpIC8gKDEgZXRoZXIpOwogICAgICB0b3RhbEV0aGVyc09idGFpbmVkID0gY29sbGVjdFNlcnZpY2VGZWUoU2FmZU1hdGgubWluMjU2KGZlZSwgdG90YWxFdGhlcnNPYnRhaW5lZCksIHRvdGFsRXRoZXJzT2J0YWluZWQpOwogICAgfQogICAgCiAgICAvL1JldHVybnMgZXRoZXJzIG9idGFpbmVkCiAgICByZXR1cm4gKHRvdGFsRXRoZXJzT2J0YWluZWQsIFNhZmVNYXRoLnNhZmVTdWIodG9rZW5zVG90YWwsIHRva2Vuc1JlbWFpbmluZykpOwogIH0KICAKICAvLy8gQGRldiBGaWxscyBhIHNlbGwgb3JkZXIgd2l0aCBhIGJ1eSBvcmRlci4KICAvLy8gQHBhcmFtIHRvdGFsRXRoZXJzT2J0YWluZWQgVG90YWwgYW1vdW50IG9mIGV0aGVycyBvYnRhaW5lZCBzbyBmYXIuCiAgLy8vIEBwYXJhbSBpbml0aWFsVG9rZW5zUmVtYWluaW5nIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgcmVtYWluaW5nIHRvIHNlbGwuCiAgLy8vIEBwYXJhbSBleGNoYW5nZSAwOiBFdGhlckRlbHRhIDE6IDB4LgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZSBFeGNoYW5nZSBmZWVzIHRvIGZpbGwgdGhlIG9yZGVyLgogIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogIC8vLyBAcmV0dXJuIFRvdGFsIGFtb3VudCBvZiBldGhlcnMgb2J0YWluZWQgYW5kIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgcmVtYWluaW50IHRvIHNlbGwuCiAgZnVuY3Rpb24gZmlsbE9yZGVyRm9yU2VsbFJlcXVlc3QoCiAgICB1aW50IHRvdGFsRXRoZXJzT2J0YWluZWQsCiAgICB1aW50IGluaXRpYWxUb2tlbnNSZW1haW5pbmcsCiAgICB1aW50OCBleGNoYW5nZSwKICAgIGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsCiAgICB1aW50WzZdIG9yZGVyVmFsdWVzLAogICAgdWludCBleGNoYW5nZUZlZSwKICAgIHVpbnQ4IHYsCiAgICBieXRlczMyIHIsCiAgICBieXRlczMyIHMKICAgICkgaW50ZXJuYWwgcmV0dXJucyh1aW50LCB1aW50KQogIHsKICAgIHVpbnQgZXRoZXJzT2J0YWluZWQgPSAwOwogICAgdWludCB0b2tlbnNSZW1haW5pbmcgPSBpbml0aWFsVG9rZW5zUmVtYWluaW5nOwogICAgCiAgICAvL0V4Y2hhbmdlIGZlZXMgc2hvdWxkIG5vdCBiZSBoaWdoZXIgdGhhbiAxJSAoaW4gV2VpKQogICAgcmVxdWlyZShleGNoYW5nZUZlZSA8IDEwMDAwMDAwMDAwMDAwMDAwKTsKICAgIAogICAgLy9DaGVja3MgdGhhdCB0aGVyZSBpcyBlbm91Z2hoIGFtb3VudCB0byBleGVjdXRlIHRoZSB0cmFkZQogICAgdWludCBmaWxsQW1vdW50ID0gZ2V0RmlsbEFtb3VudCgKICAgICAgdG9rZW5zUmVtYWluaW5nLAogICAgICBleGNoYW5nZSwKICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgIG9yZGVyVmFsdWVzLAogICAgICBleGNoYW5nZUZlZSwKICAgICAgdiwKICAgICAgciwKICAgICAgcwogICAgKTsKICAgIAogICAgaWYoZmlsbEFtb3VudCA+IDApIHsKICAgICAgICAgIAogICAgICAvL1N1YnN0cmFjdHMgdGhlIGFtb3VudCB0byBleGVjdXRlCiAgICAgIHRva2Vuc1JlbWFpbmluZyA9IFNhZmVNYXRoLnNhZmVTdWIodG9rZW5zUmVtYWluaW5nLCBmaWxsQW1vdW50KTsKICAgIAogICAgICBpZihleGNoYW5nZSA9PSAwKSB7CiAgICAgICAgLy9FeGVjdXRlcyBFdGhlckRlbHRhIGJ1eSBvcmRlciBhbmQgcmV0dXJucyB0aGUgYW1vdW50IG9mIGV0aGVycyBvYnRhaW5lZCwgZnVsbGZpbGwgYWxsIG9yIHJldHVybnMgemVybwogICAgICAgIGV0aGVyc09idGFpbmVkID0gRXRoZXJEZWx0YVRyYWRlci5maWxsQnV5T3JkZXIoCiAgICAgICAgICBvcmRlckFkZHJlc3NlcywKICAgICAgICAgIG9yZGVyVmFsdWVzLAogICAgICAgICAgZXhjaGFuZ2VGZWUsCiAgICAgICAgICBmaWxsQW1vdW50LAogICAgICAgICAgdiwKICAgICAgICAgIHIsCiAgICAgICAgICBzCiAgICAgICAgKTsgICAgCiAgICAgIH0gCiAgICAgIGVsc2UgewogICAgICAgIC8vRXhlY3V0ZXMgMHggYnV5IG9yZGVyIGFuZCByZXR1cm5zIHRoZSBhbW91bnQgb2YgZXRoZXJzIG9idGFpbmVkLCBmdWxsZmlsbCBhbGwgb3IgcmV0dXJucyB6ZXJvCiAgICAgICAgZXRoZXJzT2J0YWluZWQgPSBacnhUcmFkZXIuZmlsbEJ1eU9yZGVyKAogICAgICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgICBvcmRlclZhbHVlcywKICAgICAgICAgIGZpbGxBbW91bnQsCiAgICAgICAgICB2LAogICAgICAgICAgciwKICAgICAgICAgIHMKICAgICAgICApOwogICAgICAgIAogICAgICAgIC8vSWYgMHgsIGV4Y2hhbmdlRmVlIGlzIGNvbGxlY3RlZCBieSB0aGUgY29udHJhY3QgdG8gYnV5IGV4dGVybmFsbHkgWnJ4VHJhZGVyCiAgICAgICAgdWludCBmZWUgPSBTYWZlTWF0aC5zYWZlTXVsKGV0aGVyc09idGFpbmVkLCBleGNoYW5nZUZlZSkgLyAoMSBldGhlcik7CiAgICAgICAgZXRoZXJzT2J0YWluZWQgPSBjb2xsZWN0U2VydmljZUZlZShmZWUsIGV0aGVyc09idGFpbmVkKTsKICAgIAogICAgICB9CiAgICB9CiAgICAgICAgIAogICAgLy9BZGRzIHRoZSBhbW91bnQgb2YgZXRoZXJzIG9idGFpbmVkIGFuZCB0b2tlbnMgcmVtYWluaW5nCiAgICByZXR1cm4gKFNhZmVNYXRoLnNhZmVBZGQodG90YWxFdGhlcnNPYnRhaW5lZCwgZXRoZXJzT2J0YWluZWQpLCBldGhlcnNPYnRhaW5lZD09MD8gaW5pdGlhbFRva2Vuc1JlbWFpbmluZzogdG9rZW5zUmVtYWluaW5nKTsKICAgCiAgfQogIAogIC8vLyBAZGV2IENyZWF0ZXMgYW4gb3JkZXIgdG8gYnV5IGEgdG9rZW4uIAogIC8vLyBAcGFyYW0gdG9rZW4gQWRkcmVzcyBvZiB0aGUgdG9rZW4gdG8gc2VsbC4KICAvLy8gQHBhcmFtIHRva2Vuc1RvdGFsIEFtb3VudCBvZiB0aGUgdG9rZW4gdG8gc2VsbC4KICAvLy8gQHBhcmFtIGV4Y2hhbmdlcyBFeGNoYW5nZXMgb2YgZWFjaCBvcmRlciAoMDogRXRoZXJEZWx0YSAxOiAweCkuCiAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBhZGRyZXNzIGFycmF5cyBjb250YWluaW5nIGluZGl2aWR1YWwgb3JkZXIgYWRkcmVzc2VzLgogIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2YgdWludCBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIHZhbHVlcy4KICAvLy8gQHBhcmFtIGV4Y2hhbmdlRmVlcyBBcnJheSBvZiBleGNoYW5nZSBmZWVzIHRvIGZpbGwgaW4gb3JkZXJzLgogIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogIGZ1bmN0aW9uIGNyZWF0ZUJ1eU9yZGVyKAogICAgYWRkcmVzcyB0b2tlbiwgCiAgICB1aW50IHRva2Vuc1RvdGFsLAogICAgdWludDhbXSBleGNoYW5nZXMsCiAgICBhZGRyZXNzWzVdW10gb3JkZXJBZGRyZXNzZXMsCiAgICB1aW50WzZdW10gb3JkZXJWYWx1ZXMsCiAgICB1aW50W10gZXhjaGFuZ2VGZWVzLAogICAgdWludDhbXSB2LAogICAgYnl0ZXMzMltdIHIsCiAgICBieXRlczMyW10gcwogICkgcHVibGljIHBheWFibGUgCiAgewogICAgCiAgICAKICAgIHVpbnQgZXRoZXJzVG90YWwgPSBtc2cudmFsdWU7CiAgICB1aW50IHRva2Vuc09idGFpbmVkOwogICAgdWludCBldGhlcnNTcGVudDsKICAgIHVpbnQgZXRoZXJzUmVmdW5kZWQgPSBldGhlcnNUb3RhbDsKICAgICAKICAgIHJlcXVpcmUodG9rZW5zVG90YWwgPiAwICYmIG1zZy52YWx1ZSA+IDApOwogICAgCiAgICAodG9rZW5zT2J0YWluZWQsIGV0aGVyc1NwZW50KSA9IGZpbGxPcmRlcnNGb3JCdXlSZXF1ZXN0KAogICAgICBldGhlcnNUb3RhbCwKICAgICAgZXhjaGFuZ2VzLAogICAgICBvcmRlckFkZHJlc3NlcywKICAgICAgb3JkZXJWYWx1ZXMsCiAgICAgIGV4Y2hhbmdlRmVlcywKICAgICAgdiwKICAgICAgciwKICAgICAgcwogICAgKTsKICAgIAogICAgLy9XZSBtYWtlIHN1cmUgdGhhdCBhdCBsZWFzdCBvbmUgb3JkZXIgaGFkIHNvbWUgYW1vdW50IGZpbGxlZAogICAgcmVxdWlyZShldGhlcnNTcGVudCA+IDAgJiYgdG9rZW5zT2J0YWluZWQgPjApOwogICAgCiAgICAvL0NoZWNrIHRoYXQgdGhlIHByaWNlIG9mIHdoYXQgd2FzIGJvdWdodCBpcyBub3QgZ3JlYXRlciB0aGFuIHRoZSBtYXggYWdyZWVkCiAgICByZXF1aXJlKFNhZmVNYXRoLnNhZmVEaXYoZXRoZXJzVG90YWwsIHRva2Vuc1RvdGFsKSA+PSBTYWZlTWF0aC5zYWZlRGl2KGV0aGVyc1NwZW50LCB0b2tlbnNPYnRhaW5lZCkpOwoKICAgIC8vU3Vic3RyYWN0cyB0aGUgZXRoZXJzIHNwZW50CiAgICBldGhlcnNSZWZ1bmRlZCA9IFNhZmVNYXRoLnNhZmVTdWIoZXRoZXJzVG90YWwsIGV0aGVyc1NwZW50KTsKICAgIAogICAgLy9SZXR1cm4gZXRoZXJzIG5vdCBzcGVudCAKICAgIGlmKGV0aGVyc1JlZnVuZGVkID4gMCkKICAgICByZXF1aXJlKG1zZy5zZW5kZXIuY2FsbC52YWx1ZShldGhlcnNSZWZ1bmRlZCkoKSk7CiAgIAogICAgLy9TZW5kIHRoZSB0b2tlbnMKICAgIHRyYW5zZmVyVG9rZW4odG9rZW4sIG1zZy5zZW5kZXIsIHRva2Vuc09idGFpbmVkKTsKICAgIAogICAgRmlsbEJ1eU9yZGVyKG1zZy5zZW5kZXIsIHRva2VuLCB0b2tlbnNUb3RhbCwgZXRoZXJzVG90YWwsIHRva2Vuc09idGFpbmVkLCBldGhlcnNTcGVudCwgZXRoZXJzUmVmdW5kZWQpOwogIH0KICAKICAvLy8gQGRldiBGaWxscyBhIGJ1eSBvcmRlciBieSBzeW5jaHJvbm91c2x5IGV4ZWN1dGluZyBleGNoYW5nZSBzZWxsIG9yZGVycy4KICAvLy8gQHBhcmFtIGV0aGVyc1RvdGFsIFRvdGFsIGFtb3VudCBvZiBldGhlcnMgdG8gc3BlbmQuCiAgLy8vIEBwYXJhbSBleGNoYW5nZXMgRXhjaGFuZ2VzIG9mIGVhY2ggb3JkZXIgKDA6IEV0aGVyRGVsdGEgMTogMHgpLgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZXMgQXJyYXkgb2YgZXhjaGFuZ2UgZmVlcyB0byBmaWxsIGluIG9yZGVycy4KICAvLy8gQHBhcmFtIHYgQXJyYXkgRUNEU0Egc2lnbmF0dXJlIHYgcGFyYW1ldGVycy4KICAvLy8gQHBhcmFtIHIgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHIgcGFyYW1ldGVycy4KICAvLy8gQHBhcmFtIHMgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHMgcGFyYW1ldGVycy4KICAvLy8gQHJldHVybiBUb3RhbCBvZiB0b2tlbnMgb2J0YWluZWQuCiAgLy8vIEByZXR1cm4gVG90YWwgYW1vdW50IG9mIHRva2VucyBvYnRhaW5lZCBhbmQgdG90YWwgYW1vdW50IG9mIGV0aGVycyBzcGVudC4KICBmdW5jdGlvbiBmaWxsT3JkZXJzRm9yQnV5UmVxdWVzdCgKICAgIHVpbnQgZXRoZXJzVG90YWwsCiAgICB1aW50OFtdIGV4Y2hhbmdlcywKICAgIGFkZHJlc3NbNV1bXSBvcmRlckFkZHJlc3NlcywKICAgIHVpbnRbNl1bXSBvcmRlclZhbHVlcywKICAgIHVpbnRbXSBleGNoYW5nZUZlZXMsCiAgICB1aW50OFtdIHYsCiAgICBieXRlczMyW10gciwKICAgIGJ5dGVzMzJbXSBzCiAgKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQsIHVpbnQpCiAgewogICAgdWludCB0b3RhbFRva2Vuc09idGFpbmVkID0gMDsKICAgIHVpbnQgZXRoZXJzUmVtYWluaW5nID0gZXRoZXJzVG90YWw7CiAgICAKICAgIGZvciAodWludCBpID0gMDsgaSA8IG9yZGVyQWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAKICAgICAgaWYoZXRoZXJzUmVtYWluaW5nID4gMCkgewogICAgICAgICh0b3RhbFRva2Vuc09idGFpbmVkLCBldGhlcnNSZW1haW5pbmcpID0gZmlsbE9yZGVyRm9yQnV5UmVxdWVzdCgKICAgICAgICAgIHRvdGFsVG9rZW5zT2J0YWluZWQsCiAgICAgICAgICBldGhlcnNSZW1haW5pbmcsCiAgICAgICAgICBleGNoYW5nZXNbaV0sCiAgICAgICAgICBvcmRlckFkZHJlc3Nlc1tpXSwKICAgICAgICAgIG9yZGVyVmFsdWVzW2ldLAogICAgICAgICAgZXhjaGFuZ2VGZWVzW2ldLAogICAgICAgICAgdltpXSwKICAgICAgICAgIHJbaV0sCiAgICAgICAgICBzW2ldCiAgICAgICAgKTsKICAgICAgfQogICAgCiAgICB9CiAgICAKICAgIC8vUmV0dXJucyB0b3RhbCBvZiB0b2tlbnMgb2J0YWluZWQKICAgIHJldHVybiAodG90YWxUb2tlbnNPYnRhaW5lZCwgU2FmZU1hdGguc2FmZVN1YihldGhlcnNUb3RhbCwgZXRoZXJzUmVtYWluaW5nKSk7CiAgfQogIAogIC8vLyBAZGV2IEZpbGxzIGEgYnV5IG9yZGVyIHd0aWggYSBzZWxsIG9yZGVyLgogIC8vLyBAcGFyYW0gdG90YWxUb2tlbnNPYnRhaW5lZCBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIG9idGFpbmVkIHNvIGZhci4KICAvLy8gQHBhcmFtIGluaXRpYWxFdGhlcnNSZW1haW5pbmcgVG90YWwgYW1vdW50IG9mIGV0aGVycyByZW1haW5pbnQgdG8gc3BlbmQuCiAgLy8vIEBwYXJhbSBleGNoYW5nZSAwOiBFdGhlckRlbHRhIDE6IDB4LgogIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgLy8vIEBwYXJhbSBleGNoYW5nZUZlZSBFeGNoYW5nZSBmZWVzIHRvIGZpbGwgdGhlIG9yZGVyLgogIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogIC8vLyBAcmV0dXJuIFRvdGFsIG9mIHRva2VucyBvYnRhaW5lZC4KICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIG9idGFpbmVkIGFuZCB0b3RhbCBhbW91bnQgb2YgZXRoZXJzIHJlbWFpbmludCB0byBzcGVuZC4KICBmdW5jdGlvbiBmaWxsT3JkZXJGb3JCdXlSZXF1ZXN0KAogICAgdWludCB0b3RhbFRva2Vuc09idGFpbmVkLAogICAgdWludCBpbml0aWFsRXRoZXJzUmVtYWluaW5nLAogICAgdWludDggZXhjaGFuZ2UsCiAgICBhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLAogICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgIHVpbnQgZXhjaGFuZ2VGZWUsCiAgICB1aW50OCB2LAogICAgYnl0ZXMzMiByLAogICAgYnl0ZXMzMiBzCiAgKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQsIHVpbnQpCiAgewogICAgdWludCB0b2tlbnNPYnRhaW5lZCA9IDA7CiAgICB1aW50IGV0aGVyc1JlbWFpbmluZyA9IGluaXRpYWxFdGhlcnNSZW1haW5pbmc7CiAgICAgICAKICAgIC8vRXhjaGFuZ2UgZmVlcyBzaG91bGQgbm90IGJlIGhpZ2hlciB0aGFuIDElIChpbiBXZWkpCiAgICByZXF1aXJlKGV4Y2hhbmdlRmVlIDwgMTAwMDAwMDAwMDAwMDAwMDApOwogICAgIAogICAgLy9DaGVja3MgdGhhdCB0aGVyZSBpcyBlbm91Z2hoIGFtb3VudCB0byBleGVjdXRlIHRoZSB0cmFkZQogICAgdWludCBmaWxsQW1vdW50ID0gZ2V0RmlsbEFtb3VudCgKICAgICAgZXRoZXJzUmVtYWluaW5nLAogICAgICBleGNoYW5nZSwKICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgIG9yZGVyVmFsdWVzLAogICAgICBleGNoYW5nZUZlZSwKICAgICAgdiwKICAgICAgciwKICAgICAgcwogICAgKTsKICAgCiAgICBpZihmaWxsQW1vdW50ID4gMCkgewogICAgIAogICAgICAvL1N1YnN0cmFjdHMgdGhlIGFtb3VudCB0byBleGVjdXRlCiAgICAgIGV0aGVyc1JlbWFpbmluZyA9IFNhZmVNYXRoLnNhZmVTdWIoZXRoZXJzUmVtYWluaW5nLCBmaWxsQW1vdW50KTsKICAgICAgCiAgICAgIC8vU3Vic3RyYWN0IHNlcnZpY2UgZmVlCiAgICAgIChmaWxsQW1vdW50LCBldGhlcnNSZW1haW5pbmcpID0gc3Vic3RyYWN0RmVlKHNlcnZpY2VGZWUsIGZpbGxBbW91bnQsIGV0aGVyc1JlbWFpbmluZyk7CiAgICAgICAgIAogICAgICBpZihleGNoYW5nZSA9PSAwKSB7CiAgICAgICAgLy9FeGVjdXRlcyBFdGhlckRlbHRhIG9yZGVyLCBmZWUgaXMgcGFpZCBkaXJlY3RseSB0byBFdGhlckRlbHRhLCBmdWxsZmlsbCBhbGwgb3IgcmV0dXJucyB6ZXJvCiAgICAgICAgdG9rZW5zT2J0YWluZWQgPSBFdGhlckRlbHRhVHJhZGVyLmZpbGxTZWxsT3JkZXIoCiAgICAgICAgICBvcmRlckFkZHJlc3NlcywKICAgICAgICAgIG9yZGVyVmFsdWVzLAogICAgICAgICAgZXhjaGFuZ2VGZWUsCiAgICAgICAgICBmaWxsQW1vdW50LAogICAgICAgICAgdiwKICAgICAgICAgIHIsCiAgICAgICAgICBzCiAgICAgICAgKTsKICAgICAgCiAgICAgIH0gCiAgICAgIGVsc2UgewogICAgICAgICAgCiAgICAgICAgLy9JZiAweCwgZXhjaGFuZ2VGZWUgaXMgY29sbGVjdGVkIGJ5IHRoZSBjb250cmFjdCB0byBidXkgZXh0ZXJuYWxseSBacnhUcmFkZXIsIGZ1bGxmaWxsIGFsbCBvciByZXR1cm5zIHplcm8KICAgICAgICAoZmlsbEFtb3VudCwgZXRoZXJzUmVtYWluaW5nKSA9IHN1YnN0cmFjdEZlZShleGNoYW5nZUZlZSwgZmlsbEFtb3VudCwgZXRoZXJzUmVtYWluaW5nKTsKICAgICAgICAKICAgICAgICAvL0V4ZWN1dGVzIDB4IG9yZGVyCiAgICAgICAgdG9rZW5zT2J0YWluZWQgPSBacnhUcmFkZXIuZmlsbFNlbGxPcmRlcigKICAgICAgICAgIG9yZGVyQWRkcmVzc2VzLAogICAgICAgICAgb3JkZXJWYWx1ZXMsCiAgICAgICAgICBmaWxsQW1vdW50LAogICAgICAgICAgdiwKICAgICAgICAgIHIsCiAgICAgICAgICBzCiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgICAgIAogICAgLy9SZXR1cm5zIHRvdGFsIG9mIHRva2VucyBvYnRhaW5lZCBhbmQgZXRoZXJzIHJlbWFpbmluZwogICAgcmV0dXJuIChTYWZlTWF0aC5zYWZlQWRkKHRvdGFsVG9rZW5zT2J0YWluZWQsIHRva2Vuc09idGFpbmVkKSwgdG9rZW5zT2J0YWluZWQ9PTA/IGluaXRpYWxFdGhlcnNSZW1haW5pbmc6IGV0aGVyc1JlbWFpbmluZyk7CiAgfQogIAogIAogIC8vLyBAZGV2IEdldCB0aGUgYW1vdW50IHRvIGZpbGwgaW4gdGhlIG9yZGVyLgogIC8vLyBAcGFyYW0gYW1vdW50IFJlbWFpbmluZyBhbW91bnQgb2YgdGhlIG9yZGVyLgogIC8vLyBAcGFyYW0gZXhjaGFuZ2UgMDogRXRoZXJEZWx0YSAxOiAweC4KICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3MgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciBhZGRyZXNzZXMuCiAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiB1aW50IGFycmF5cyBjb250YWluaW5nIGluZGl2aWR1YWwgb3JkZXIgdmFsdWVzLgogIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogIC8vLyBAcmV0dXJuIE1pbiBhbW91bnQgYmV0d2VlbiB0aGUgcmVtYWluaW5nIGFuZCB0aGUgb3JkZXIgYXZhaWxhYmxlLgogIGZ1bmN0aW9uIGdldEZpbGxBbW91bnQoCiAgICB1aW50IGFtb3VudCwKICAgIHVpbnQ4IGV4Y2hhbmdlLAogICAgYWRkcmVzc1s1XSBvcmRlckFkZHJlc3NlcywKICAgIHVpbnRbNl0gb3JkZXJWYWx1ZXMsCiAgICB1aW50IGV4Y2hhbmdlRmVlLAogICAgdWludDggdiwKICAgIGJ5dGVzMzIgciwKICAgIGJ5dGVzMzIgcwogICkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSAKICB7CiAgICB1aW50IGF2YWlsYWJsZUFtb3VudDsKICAgIGlmKGV4Y2hhbmdlID09IDApIHsKICAgICAgYXZhaWxhYmxlQW1vdW50ID0gRXRoZXJEZWx0YVRyYWRlci5nZXRBdmFpbGFibGVBbW91bnQoCiAgICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgb3JkZXJWYWx1ZXMsCiAgICAgICAgZXhjaGFuZ2VGZWUsCiAgICAgICAgdiwKICAgICAgICByLAogICAgICAgIHMKICAgICAgKTsgICAgCiAgICB9IAogICAgZWxzZSB7CiAgICAgIGF2YWlsYWJsZUFtb3VudCA9IFpyeFRyYWRlci5nZXRBdmFpbGFibGVBbW91bnQoCiAgICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgb3JkZXJWYWx1ZXMsCiAgICAgICAgdiwKICAgICAgICByLAogICAgICAgIHMKICAgICAgKTsKICAgIH0KICAgICAKICAgIHJldHVybiBTYWZlTWF0aC5taW4yNTYoYW1vdW50LCBhdmFpbGFibGVBbW91bnQpOwogIH0KICAKICAvLy8gQGRldiBTdWJzdHJhY3RzIHRoZSBzZXJ2aWNlIGZyb20gdGhlIHJlbWFpbmluZyBhbW91bnQgaWYgZW5vdWdoLCBpZiBub3QgZnJvbSB0aGUgYW1vdW50IHRvIGZpbGwgdGhlIG9yZGVyLgogIC8vLyBAcGFyYW0gZmVlUGVyY2VudGFnZSBGZWUgUGVyY2VudGFnZQogIC8vLyBAcGFyYW0gZmlsbEFtb3VudCBBbW91bnQgdG8gZmlsbCB0aGUgb3JkZXIKICAvLy8gQHBhcmFtIGV0aGVyc1JlbWFpbmluZyBSZW1haW5pbmcgYW1vdW50IG9mIGV0aGVycyBmb3Igb3RoZXIgb3JkZXJzCiAgLy8vIEByZXR1cm4gQW1vdW50IHRvIGZpbGwgdGhlIG9yZGVyIGFuZCByZW1haW5pbmcgYW1vdW50CiAgZnVuY3Rpb24gc3Vic3RyYWN0RmVlKAogICAgdWludCBmZWVQZXJjZW50YWdlLAogICAgdWludCBmaWxsQW1vdW50LAogICAgdWludCBldGhlcnNSZW1haW5pbmcKICApIGludGVybmFsIHJldHVybnModWludCwgdWludCkgCiAgeyAgICAgICAKICAgICAgdWludCBmZWUgPSBTYWZlTWF0aC5zYWZlTXVsKGZpbGxBbW91bnQsIGZlZVBlcmNlbnRhZ2UpIC8gKDEgZXRoZXIpOwogICAgICAvL0lmIHRoZXJlIGlzIGVub3VnaCByZW1haW5pbmcgdG8gcGF5IGZlZSwgaXQgc3Vic3RyYWN0cyB0aGUgZmVlIGZyb20gdGhlIHJlbWFpbmluZwogICAgICBpZihldGhlcnNSZW1haW5pbmcgPj0gZmVlKQogICAgICAgICBldGhlcnNSZW1haW5pbmcgPSBjb2xsZWN0U2VydmljZUZlZShmZWUsIGV0aGVyc1JlbWFpbmluZyk7CiAgICAgIGVsc2UgewogICAgICAgICBmaWxsQW1vdW50ID0gY29sbGVjdFNlcnZpY2VGZWUoZmVlLCBTYWZlTWF0aC5zYWZlQWRkKGZpbGxBbW91bnQsIGV0aGVyc1JlbWFpbmluZykpOwogICAgICAgICBldGhlcnNSZW1haW5pbmcgPSAwOwogICAgICB9CiAgICAgIHJldHVybiAoZmlsbEFtb3VudCwgZXRoZXJzUmVtYWluaW5nKTsKICB9CiAgCiAgLy8vIEBkZXYgU3Vic3RyYWN0cyB0aGUgc2VydmljZSBmZWUgaW4gZXRoZXJzLgogIC8vLyBAcGFyYW0gZmVlIFNlcnZpY2UgZmVlIGluIGV0aGVycwogIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCB0byBzdWJzdHJhY3Qgc2VydmljZSBmZWUKICAvLy8gQHJldHVybiBBbW91bnQgbWludXMgc2VydmljZSBmZWUuCiAgZnVuY3Rpb24gY29sbGVjdFNlcnZpY2VGZWUodWludCBmZWUsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgIGNvbGxlY3RlZEZlZSA9IFNhZmVNYXRoLnNhZmVBZGQoY29sbGVjdGVkRmVlLCBmZWUpOwogICAgcmV0dXJuIFNhZmVNYXRoLnNhZmVTdWIoYW1vdW50LCBmZWUpOwogIH0KICAKICAvLy8gQGRldiBUcmFuc2ZlciBldGhlcnMgdG8gdXNlciBhY2NvdW50LgogIC8vLyBAcGFyYW0gYWNjb3VudCBVc2VyIGFkZHJlc3Mgd2hlcmUgdG8gc2VuZCBldGhlcnMuCiAgLy8vIEBwYXJhbSBhbW91bnQgQW1vdW50IG9mIGV0aGVycyB0byBzZW5kLgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgYWNjb3VudCwgdWludCBhbW91bnQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWNjb3VudC5zZW5kKGFtb3VudCkpOwogIH0KICAgIAogIC8vLyBAZGV2IFRyYW5zZmVyIHRva2VuIHRvIHVzZXIgYWNjb3VudC4KICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgLy8vIEBwYXJhbSBhY2NvdW50IFVzZXIgYWRkcmVzcyB3aGVyZSB0byB0cmFuc2ZlciB0b2tlbnMuCiAgLy8vIEBwYXJhbSBhbW91bnQgQW1vdW50IG9mIHRva2VucyB0byB0cmFuc2Zlci4KICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuKGFkZHJlc3MgdG9rZW4sIGFkZHJlc3MgYWNjb3VudCwgdWludCBhbW91bnQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoVG9rZW4odG9rZW4pLnRyYW5zZmVyKGFjY291bnQsIGFtb3VudCkpOwogIH0KICAgCiAgLy8vIEBkZXYgV2l0aGRyYXcgY29sbGVjdGVkIHNlcnZpY2UgZmVlcy4gT25seSBieSBmZWUgYWNjb3VudC4KICAvLy8gQHBhcmFtIGFtb3VudCBBbW91bnQgdG8gd2l0aGRyYXcKICBmdW5jdGlvbiB3aXRoZHJhd0ZlZXModWludCBhbW91bnQpIHB1YmxpYyBvbmx5RmVlQWNjb3VudCB7CiAgICByZXF1aXJlKGNvbGxlY3RlZEZlZSA+PSBhbW91bnQpOwogICAgY29sbGVjdGVkRmVlID0gU2FmZU1hdGguc2FmZVN1Yihjb2xsZWN0ZWRGZWUsIGFtb3VudCk7CiAgICByZXF1aXJlKGZlZUFjY291bnQuc2VuZChhbW91bnQpKTsKICB9CiAgCiAgIAogIC8vLyBAZGV2IFdpdGhkcmF3IGNvbnRyYWN0IFpSWCBpbiBjYXNlIG5ldyB2ZXJzaW9uIGlzIGRlcGxveWVkLiBPbmx5IGJ5IGFkbWluLgogIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCB0byB3aXRoZHJhdwogIGZ1bmN0aW9uIHdpdGhkcmF3WlJYKHVpbnQgYW1vdW50KSBwdWJsaWMgb25seUFkbWluIHsKICAgIHJlcXVpcmUoVG9rZW4oWlJYX1RPS0VOX0FERFIpLnRyYW5zZmVyKGFkbWluLCBhbW91bnQpKTsKICB9Cn0='.
	

]
