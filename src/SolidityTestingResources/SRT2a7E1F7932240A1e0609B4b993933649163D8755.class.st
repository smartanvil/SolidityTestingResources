Class {
	#name : #SRT2a7E1F7932240A1e0609B4b993933649163D8755,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2a7E1F7932240A1e0609B4b993933649163D8755 >> base64 [
	^ 'Ly9qdXN0IHVwZGF0ZWQgdGhlIGVuY3J5cHRlZCBhcGkga2V5Ci8vdXBkYXRlZCBjb250cmFjdEJhbGFuY2UgLT0gNTcyNDU5MDE2MzkzNDQ7CgpwcmFnbWEgc29saWRpdHkgXjAuNC4yOwoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpewogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik+MCl7IC8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIAogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOwogICAgICAgIHVpbnQxNjAgYjE7CiAgICAgICAgdWludDE2MCBiMjsKICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7CiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsKICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7CiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7CiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkmJihiMSA8PSA3MCkpIGIxIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSYmKGIyIDw9IDcwKSkgYjIgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKXsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGogLz0gMTA7CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgICAgdWludCBrID0gbGVuIC0gMTsKICAgICAgICB3aGlsZSAoaSAhPSAwKXsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KfQovLyA8L09SQUNMSVpFX0FQST4KCi8qCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4KICogQGF1dGhvciBOaWNrIEpvaG5zb24gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0ODI5M2EyOTJiMjAyNjIxMmMwODI2MjczYzJjMjczYzY2MjYyZDNjIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICoKICogQGRldiBGdW5jdGlvbmFsaXR5IGluIHRoaXMgbGlicmFyeSBpcyBsYXJnZWx5IGltcGxlbWVudGVkIHVzaW5nIGFuCiAqICAgICAgYWJzdHJhY3Rpb24gY2FsbGVkIGEgJ3NsaWNlJy4gQSBzbGljZSByZXByZXNlbnRzIGEgcGFydCBvZiBhIHN0cmluZyAtCiAqICAgICAgYW55dGhpbmcgZnJvbSB0aGUgZW50aXJlIHN0cmluZyB0byBhIHNpbmdsZSBjaGFyYWN0ZXIsIG9yIGV2ZW4gbm8KICogICAgICBjaGFyYWN0ZXJzIGF0IGFsbCAoYSAwLWxlbmd0aCBzbGljZSkuIFNpbmNlIGEgc2xpY2Ugb25seSBoYXMgdG8gc3BlY2lmeQogKiAgICAgIGFuIG9mZnNldCBhbmQgYSBsZW5ndGgsIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyBzbGljZXMgaXMgYSBsb3QgbGVzcwogKiAgICAgIGV4cGVuc2l2ZSB0aGFuIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyB0aGUgc3RyaW5ncyB0aGV5IHJlZmVyZW5jZS4KICoKICogICAgICBUbyBmdXJ0aGVyIHJlZHVjZSBnYXMgY29zdHMsIG1vc3QgZnVuY3Rpb25zIG9uIHNsaWNlIHRoYXQgbmVlZCB0byByZXR1cm4KICogICAgICBhIHNsaWNlIG1vZGlmeSB0aGUgb3JpZ2luYWwgb25lIGluc3RlYWQgb2YgYWxsb2NhdGluZyBhIG5ldyBvbmU7IGZvcgogKiAgICAgIGluc3RhbmNlLCBgcy5zcGxpdCgiLiIpYCB3aWxsIHJldHVybiB0aGUgdGV4dCB1cCB0byB0aGUgZmlyc3QgJy4nLAogKiAgICAgIG1vZGlmeWluZyBzIHRvIG9ubHkgY29udGFpbiB0aGUgcmVtYWluZGVyIG9mIHRoZSBzdHJpbmcgYWZ0ZXIgdGhlICcuJy4KICogICAgICBJbiBzaXR1YXRpb25zIHdoZXJlIHlvdSBkbyBub3Qgd2FudCB0byBtb2RpZnkgdGhlIG9yaWdpbmFsIHNsaWNlLCB5b3UKICogICAgICBjYW4gbWFrZSBhIGNvcHkgZmlyc3Qgd2l0aCBgLmNvcHkoKWAsIGZvciBleGFtcGxlOgogKiAgICAgIGBzLmNvcHkoKS5zcGxpdCgiLiIpYC4gVHJ5IGFuZCBhdm9pZCB1c2luZyB0aGlzIGlkaW9tIGluIGxvb3BzOyBzaW5jZQogKiAgICAgIFNvbGlkaXR5IGhhcyBubyBtZW1vcnkgbWFuYWdlbWVudCwgaXQgd2lsbCByZXN1bHQgaW4gYWxsb2NhdGluZyBtYW55CiAqICAgICAgc2hvcnQtbGl2ZWQgc2xpY2VzIHRoYXQgYXJlIGxhdGVyIGRpc2NhcmRlZC4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCByZXR1cm4gdHdvIHNsaWNlcyBjb21lIGluIHR3byB2ZXJzaW9uczogYSBub24tYWxsb2NhdGluZwogKiAgICAgIHZlcnNpb24gdGhhdCB0YWtlcyB0aGUgc2Vjb25kIHNsaWNlIGFzIGFuIGFyZ3VtZW50LCBtb2RpZnlpbmcgaXQgaW4KICogICAgICBwbGFjZSwgYW5kIGFuIGFsbG9jYXRpbmcgdmVyc2lvbiB0aGF0IGFsbG9jYXRlcyBhbmQgcmV0dXJucyB0aGUgc2Vjb25kCiAqICAgICAgc2xpY2U7IHNlZSBgbmV4dFJ1bmVgIGZvciBleGFtcGxlLgogKgogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IGhhdmUgdG8gY29weSBzdHJpbmcgZGF0YSB3aWxsIHJldHVybiBzdHJpbmdzIHJhdGhlciB0aGFuCiAqICAgICAgc2xpY2VzOyB0aGVzZSBjYW4gYmUgY2FzdCBiYWNrIHRvIHNsaWNlcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nIGlmCiAqICAgICAgcmVxdWlyZWQuCiAqCiAqICAgICAgRm9yIGNvbnZlbmllbmNlLCBzb21lIGZ1bmN0aW9ucyBhcmUgcHJvdmlkZWQgd2l0aCBub24tbW9kaWZ5aW5nCiAqICAgICAgdmFyaWFudHMgdGhhdCBjcmVhdGUgYSBuZXcgc2xpY2UgYW5kIHJldHVybiBib3RoOyBmb3IgaW5zdGFuY2UsCiAqICAgICAgYHMuc3BsaXROZXcoJy4nKWAgbGVhdmVzIHMgdW5tb2RpZmllZCwgYW5kIHJldHVybnMgdHdvIHZhbHVlcwogKiAgICAgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxlZnQgYW5kIHJpZ2h0IHBhcnRzIG9mIHRoZSBzdHJpbmcuCiAqLwpsaWJyYXJ5IHN0cmluZ3MgewogICAgc3RydWN0IHNsaWNlIHsKICAgICAgICB1aW50IF9sZW47CiAgICAgICAgdWludCBfcHRyOwogICAgfQoKICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBsZW4gPj0gMzI7IGxlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0ICs9IDMyOwogICAgICAgICAgICBzcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQgbWFzayA9IDI1NiAqKiAoMzIgLSBsZW4pIC0gMTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpCiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcmV0OwogICAgICAgIGlmIChzZWxmID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxNjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gODsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gNDsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDMyIC0gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgYnl0ZXMzMiwgaW50ZXJwcmV0ZWQgYXMgYQogICAgICogICAgICBudWxsLXRlcm1pbnRhZWQgdXRmLTggc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLgogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYXJndW1lbnQgdXAgdG8gdGhlCiAgICAgKiAgICAgICAgIGZpcnN0IG51bGwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2VCMzIoYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICAvLyBBbGxvY2F0ZSBzcGFjZSBmb3IgYHNlbGZgIGluIG1lbW9yeSwgY29weSBpdCB0aGVyZSwgYW5kIHBvaW50IHJldCBhdCBpdAogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHB0ciA6PSBtbG9hZCgweDQwKQogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKHB0ciwgMHgyMCkpCiAgICAgICAgICAgIG1zdG9yZShwdHIsIHNlbGYpCiAgICAgICAgICAgIG1zdG9yZShhZGQocmV0LCAweDIwKSwgcHRyKQogICAgICAgIH0KICAgICAgICByZXQuX2xlbiA9IGxlbihzZWxmKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24KICAgICAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0CiAgICAgKiAgICAgIGluIGxvb3BzLCBhbmQgY2FsbCBgc2xpY2UuZW1wdHkoKWAgaWYgeW91IG9ubHkgbmVlZCB0byBrbm93IHdoZXRoZXIKICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzbGljZSBpbiBydW5lcy4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBTdGFydGluZyBhdCBwdHItMzEgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQKICAgICAgICB2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7CiAgICAgICAgdmFyIGVuZCA9IHB0ciArIHNlbGYuX2xlbjsKICAgICAgICBmb3IgKHVpbnQgbGVuID0gMDsgcHRyIDwgZW5kOyBsZW4rKykgewogICAgICAgICAgICB1aW50OCBiOwogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0KICAgICAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMjsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEY4KSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHB0ciArPSA2OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBsZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSAoaGFzIGEgbGVuZ3RoIG9mIDApLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5LCBGYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVtcHR5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc2VsZi5fbGVuID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogICAgICovCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICB1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOwogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7CiAgICAgICAgZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsKICAgICAgICAgICAgdWludCBhOwogICAgICAgICAgICB1aW50IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikKICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEgIT0gYikgewogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICAgICAgICAgIHVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsKICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7CiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoZGlmZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsKICAgICAgICAgICAgb3RoZXJwdHIgKz0gMzI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHR3byBzbGljZXMgY29udGFpbiB0aGUgc2FtZSB0ZXh0LgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZXF1YWxzKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhcmUoc2VsZiwgb3RoZXIpID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgRXh0cmFjdHMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlIGludG8gYHJ1bmVgLCBhZHZhbmNpbmcgdGhlCiAgICAgKiAgICAgIHNsaWNlIHRvIHBvaW50IHRvIHRoZSBuZXh0IHJ1bmUgYW5kIHJldHVybmluZyBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBydW5lIFRoZSBzbGljZSB0aGF0IHdpbGwgY29udGFpbiB0aGUgZmlyc3QgcnVuZS4KICAgICAqIEByZXR1cm4gYHJ1bmVgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmLCBzbGljZSBydW5lKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsKCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgdWludCBsZW47CiAgICAgICAgdWludCBiOwogICAgICAgIC8vIExvYWQgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIHJ1bmUgaW50byB0aGUgTFNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChzdWIobWxvYWQoYWRkKHNlbGYsIDMyKSksIDMxKSksIDB4RkYpIH0KICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgbGVuID0gMTsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgbGVuID0gMjsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgbGVuID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZW4gPSA0OwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgewogICAgICAgICAgICBydW5lLl9sZW4gPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5fcHRyICs9IGxlbjsKICAgICAgICBzZWxmLl9sZW4gLT0gbGVuOwogICAgICAgIHJ1bmUuX2xlbiA9IGxlbjsKICAgICAgICByZXR1cm4gcnVuZTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludAogICAgICogICAgICB0byB0aGUgbmV4dCBydW5lLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogICAgICovCiAgICBmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IHdvcmQ7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgdWludCBkaXYgPSAyICoqIDI0ODsKCiAgICAgICAgLy8gTG9hZCB0aGUgcnVuZSBpbnRvIHRoZSBNU0JzIG9mIGIKICAgICAgICBhc3NlbWJseSB7IHdvcmQ6PSBtbG9hZChtbG9hZChhZGQoc2VsZiwgMzIpKSkgfQogICAgICAgIHZhciBiID0gd29yZCAvIGRpdjsKICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgcmV0ID0gYjsKICAgICAgICAgICAgbGVuID0gMTsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgcmV0ID0gYiAmIDB4MUY7CiAgICAgICAgICAgIGxlbiA9IDI7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDBGOwogICAgICAgICAgICBsZW4gPSAzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDA3OwogICAgICAgICAgICBsZW4gPSA0OwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGRpdiA9IGRpdiAvIDI1NjsKICAgICAgICAgICAgYiA9ICh3b3JkIC8gZGl2KSAmIDB4RkY7CiAgICAgICAgICAgIGlmIChiICYgMHhDMCAhPSAweDgwKSB7CiAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIFVURi04IHNlcXVlbmNlCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXQgPSAocmV0ICogNjQpIHwgKGIgJiAweDNGKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUga2VjY2FrLTI1NiBoYXNoIG9mIHRoZSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBoYXNoLgogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgc2xpY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGtlY2NhayhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIHJldCkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmV0IDo9IHNoYTMobWxvYWQoYWRkKHNlbGYsIDMyKSksIG1sb2FkKHNlbGYpKQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5fcHRyID09IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbDsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgfQogICAgICAgIHJldHVybiBlcXVhbDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7CiAgICAgICAgaWYgKHNlbGYuX3B0ciAhPSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkKICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgKz0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGVuZHMgd2l0aCBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZW5kc1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47CgogICAgICAgIGlmIChzZWxmcHRyID09IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbDsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICB1aW50IGlkeDsKCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsKICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyCiAgICAgICAgICAgICAgICAgICAgbG9vcDoKICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0cjsKICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsKICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgYWRkcmVzcyBvZiBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY5IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkocmV0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzdWIocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGp1bXAoZXhpdCkKICAgICAgICAgICAgICAgICAgICByZXQ6CiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIG5lZWRsZWxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsKICAgICAgICAgICAgICAgIHdoaWxlIChwdHIgPj0gc2VsZnB0cikgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHIgKyBuZWVkbGVsZW47CiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHI7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mCiAgICAgKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQogICAgICogICAgICBpZiBgbmVlZGxlYCBpcyBub3QgZm91bmQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHNlbGYuX2xlbiAtPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgc2VsZi5fcHRyID0gcHRyOwogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIHRoZSBwYXJ0IG9mIHRoZSBzdHJpbmcgZnJvbSB0aGUgc3RhcnQgb2YKICAgICAqICAgICAgYHNlbGZgIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAuIElmIGBuZWVkbGVgCiAgICAgKiAgICAgIGlzIG5vdCBmb3VuZCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gcmZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgc2VsZi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsKICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewogICAgICAgIHNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLgogICAgICogQHJldHVybiBgdG9rZW5gLgogICAgICovCiAgICBmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHRva2VuLl9wdHIgPSBwdHI7CiAgICAgICAgdG9rZW4uX2xlbiA9IHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICByc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3VudChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHVpbnQgY291bnQpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewogICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBUcnVlIGlmIGBzZWxmYCBjb250YWlucyBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUcnVlIGlmIGBuZWVkbGVgIGlzIGZvdW5kIGluIGBzZWxmYCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBjb250YWlucyhzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YKICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4KICAgICAqLwogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQogICAgICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLAogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gIiI7CgogICAgICAgIHVpbnQgbGVuID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGxlbiArPSBwYXJ0c1tpXS5fbGVuOwoKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhsZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIGZvcihpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOwogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsKICAgICAgICAgICAgaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQp9CgoKY29udHJhY3QgRFNTYWZlQWRkU3ViIHsKICAgIGZ1bmN0aW9uIHNhZmVUb0FkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoYSArIGIgPj0gYSk7CiAgICB9CiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKCFzYWZlVG9BZGQoYSwgYikpIHRocm93OwogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlVG9TdWJ0cmFjdCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoYiA8PSBhKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKCFzYWZlVG9TdWJ0cmFjdChhLCBiKSkgdGhyb3c7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfSAKfQoKCgpjb250cmFjdCBFdGhlcm9sbCBpcyB1c2luZ09yYWNsaXplLCBEU1NhZmVBZGRTdWIgewogICAgCiAgICAgdXNpbmcgc3RyaW5ncyBmb3IgKjsKCiAgICAvKgogICAgICogY2hlY2tzIHBsYXllciBwcm9maXQsIGJldCBzaXplIGFuZCBwbGF5ZXIgbnVtYmVyIGlzIHdpdGhpbiByYW5nZQogICAgKi8KICAgIG1vZGlmaWVyIGJldElzVmFsaWQodWludCBfYmV0U2l6ZSwgdWludCBfcGxheWVyTnVtYmVyKSB7ICAgICAgCiAgICAgICAgaWYoKCgoKF9iZXRTaXplICogKDEwMC0oc2FmZVN1YihfcGxheWVyTnVtYmVyLDEpKSkpIC8gKHNhZmVTdWIoX3BsYXllck51bWJlciwxKSkrX2JldFNpemUpKSpob3VzZUVkZ2UvaG91c2VFZGdlRGl2aXNvciktX2JldFNpemUgPiBtYXhQcm9maXQgfHwgX2JldFNpemUgPCBtaW5CZXQgfHwgX3BsYXllck51bWJlciA8IG1pbk51bWJlciB8fCBfcGxheWVyTnVtYmVyID4gbWF4TnVtYmVyKSB0aHJvdzsgICAgICAgIAoJCV87CiAgICB9CgogICAgLyoKICAgICAqIGNoZWNrcyBnYW1lIGlzIGN1cnJlbnRseSBhY3RpdmUKICAgICovCiAgICBtb2RpZmllciBnYW1lSXNBY3RpdmUgewogICAgICAgIGlmKGdhbWVQYXVzZWQgPT0gdHJ1ZSkgdGhyb3c7CgkJXzsKICAgIH0gICAgCgogICAgLyoKICAgICAqIGNoZWNrcyBwYXlvdXRzIGFyZSBjdXJyZW50bHkgYWN0aXZlCiAgICAqLwogICAgbW9kaWZpZXIgcGF5b3V0c0FyZUFjdGl2ZSB7CiAgICAgICAgaWYocGF5b3V0c1BhdXNlZCA9PSB0cnVlKSB0aHJvdzsKCQlfOwogICAgfSAgICAKCiAgICAvKgogICAgICogY2hlY2tzIG9ubHkgT3JhY2xpemUgYWRkcmVzcyBpcyBjYWxsaW5nCiAgICAqLwogICAgbW9kaWZpZXIgb25seU9yYWNsaXplIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogY2hlY2tzIG9ubHkgb3duZXIgYWRkcmVzcyBpcyBjYWxsaW5nCiAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiBjaGVja3Mgb25seSB0cmVhc3VyeSBhZGRyZXNzIGlzIGNhbGxpbmcKICAgICovCiAgICBtb2RpZmllciBvbmx5VHJlYXN1cnkgewogICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0cmVhc3VyeSkgdGhyb3c7CiAgICAgICAgIF87CiAgICB9ICAgIAoKICAgIC8qCiAgICAgKiBnYW1lIHZhcnMKICAgICovIAogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWF4UHJvZml0RGl2aXNvciA9IDEwMDAwMDA7CiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBob3VzZUVkZ2VEaXZpc29yID0gMTAwMDsgICAgCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBtYXhOdW1iZXIgPSA5OTsgCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBtaW5OdW1iZXIgPSAyOwoJYm9vbCBwdWJsaWMgZ2FtZVBhdXNlZDsKICAgIHVpbnQzMiBwdWJsaWMgZ2FzRm9yT3JhY2xpemU7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGJvb2wgcHVibGljIHBheW91dHNQYXVzZWQ7IAogICAgYWRkcmVzcyBwdWJsaWMgdHJlYXN1cnk7CiAgICB1aW50IHB1YmxpYyBjb250cmFjdEJhbGFuY2U7CiAgICB1aW50IHB1YmxpYyBob3VzZUVkZ2U7ICAgICAKICAgIHVpbnQgcHVibGljIG1heFByb2ZpdDsgICAKICAgIHVpbnQgcHVibGljIG1heFByb2ZpdEFzUGVyY2VudE9mSG91c2U7ICAgICAgICAgICAgICAgICAgICAKICAgIHVpbnQgcHVibGljIG1pbkJldDsgICAgICAgCiAgICBpbnQgcHVibGljIHRvdGFsQmV0czsKICAgIHVpbnQgcHVibGljIG1heFBlbmRpbmdQYXlvdXRzOwogICAgdWludCBwdWJsaWMgY29zdFRvQ2FsbE9yYWNsaXplSW5XZWk7CiAgICB1aW50IHB1YmxpYyB0b3RhbFdlaVdvbjsKICAgIHVpbnQgcHVibGljIHRvdGFsV2VpV2FnZXJlZDsgICAgCgogICAgLyoKICAgICAqIHBsYXllciB2YXJzCiAgICAqLwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBhZGRyZXNzKSBwbGF5ZXJBZGRyZXNzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBhZGRyZXNzKSBwbGF5ZXJUZW1wQWRkcmVzczsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgcGxheWVyQmV0SWQ7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllckJldFZhbHVlOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wQmV0VmFsdWU7ICAKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyUmFuZG9tUmVzdWx0OyAgICAgCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllckRpZVJlc3VsdDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyTnVtYmVyOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHM7ICAgICAgCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllclByb2ZpdDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyVGVtcFJld2FyZDsgICAgCiAgICAgICAgCgogICAgLyoKICAgICAqIGV2ZW50cwogICAgKi8KICAgIC8qIGxvZyBiZXRzICsgb3V0cHV0IHRvIHdlYjMgZm9yIHByZWNpc2UgJ3BheW91dCBvbiB3aW4nIGZpZWxkIGluIFVJICovCiAgICBldmVudCBMb2dCZXQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJld2FyZFZhbHVlLCB1aW50IFByb2ZpdFZhbHVlLCB1aW50IEJldFZhbHVlLCB1aW50IFBsYXllck51bWJlcik7ICAgICAgCiAgICAvKiBvdXRwdXQgdG8gd2ViMyBVSSBvbiBiZXQgcmVzdWx0Ki8KICAgIC8qIFN0YXR1czogMD1sb3NlLCAxPXdpbiwgMj13aW4gKyBmYWlsZWQgc2VuZCwgMz1yZWZ1bmQsIDQ9cmVmdW5kICsgZmFpbGVkIHNlbmQqLwoJZXZlbnQgTG9nUmVzdWx0KHVpbnQgaW5kZXhlZCBSZXN1bHRTZXJpYWxOdW1iZXIsIGJ5dGVzMzIgaW5kZXhlZCBCZXRJRCwgYWRkcmVzcyBpbmRleGVkIFBsYXllckFkZHJlc3MsIHVpbnQgUGxheWVyTnVtYmVyLCB1aW50IERpY2VSZXN1bHQsIHVpbnQgVmFsdWUsIGludCBTdGF0dXMsIGJ5dGVzIFByb29mKTsgICAKICAgIC8qIGxvZyBtYW51YWwgcmVmdW5kcyAqLwogICAgZXZlbnQgTG9nUmVmdW5kKGJ5dGVzMzIgaW5kZXhlZCBCZXRJRCwgYWRkcmVzcyBpbmRleGVkIFBsYXllckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBSZWZ1bmRWYWx1ZSk7CiAgICAvKiBsb2cgb3duZXIgdHJhbnNmZXJzICovCiAgICBldmVudCBMb2dPd25lclRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBTZW50VG9BZGRyZXNzLCB1aW50IGluZGV4ZWQgQW1vdW50VHJhbnNmZXJyZWQpOyAgICAgICAgICAgICAgIAoKCiAgICAvKgogICAgICogaW5pdAogICAgKi8KICAgIGZ1bmN0aW9uIEV0aGVyb2xsKCkgewoKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgdHJlYXN1cnkgPSBtc2cuc2VuZGVyOwogICAgICAgIAogICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOyAgICAgICAgCiAgICAgICAgLyogdXNlIFRMU05vdGFyeSBmb3Igb3JhY2xpemUgY2FsbCAqLwoJCW9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9UTFNOb3RhcnkgfCBwcm9vZlN0b3JhZ2VfSVBGUyk7CiAgICAgICAgLyogaW5pdCA5OTAgPSA5OSUgKDElIGhvdXNlRWRnZSkqLwogICAgICAgIG93bmVyU2V0SG91c2VFZGdlKDk5MCk7CiAgICAgICAgLyogaW5pdCAxMCwwMDAgPSAxJSAgKi8KICAgICAgICBvd25lclNldE1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UoMTAwMDApOwogICAgICAgIC8qIGluaXQgbWluIGJldCAoMC4xIGV0aGVyKSAqLwogICAgICAgIG93bmVyU2V0TWluQmV0KDEwMDAwMDAwMDAwMDAwMDAwMCk7ICAgICAgICAKICAgICAgICAvKiBpbml0IGdhcyBmb3Igb3JhY2xpemUgKi8gICAgICAgIAogICAgICAgIGdhc0Zvck9yYWNsaXplID0gMjUwMDAwOyAgICAgICAgCgogICAgfQoKICAgIC8qCiAgICAgKiBwdWJsaWMgZnVuY3Rpb24KICAgICAqIHBsYXllciBzdWJtaXQgYmV0CiAgICAgKiBvbmx5IGlmIGdhbWUgaXMgYWN0aXZlICYgYmV0IGlzIHZhbGlkIGNhbiBxdWVyeSBvcmFjbGl6ZSBhbmQgc2V0IHBsYXllciB2YXJzICAgICAKICAgICovCiAgICBmdW5jdGlvbiBwbGF5ZXJSb2xsRGljZSh1aW50IHJvbGxVbmRlcikgcHVibGljIAogICAgICAgIHBheWFibGUKICAgICAgICBnYW1lSXNBY3RpdmUKICAgICAgICBiZXRJc1ZhbGlkKG1zZy52YWx1ZSwgcm9sbFVuZGVyKQoJeyAgICAgICAgCiAgICAgICAgCiAgICAgICAgLyogc2FmZWx5IHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHRvIGFjY291bnQgZm9yIGNvc3QgdG8gY2FsbCBvcmFjbGl6ZSovCiAgICAgICAgLy90b2RvIC0gdXBkYXRlIGluIGxpdmUgY29udHJhY3QKICAgICAgICBjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgb3JhY2xpemVfZ2V0UHJpY2UoIlVSTCIsIDIzNTAwMCkpOwoKICAgICAgICAvKiB0b3RhbCBudW1iZXIgb2YgYmV0cyAqLwogICAgICAgIC8vdG9kbyAtIHVwZGF0ZSBpbiBsaXZlIGNvbnRyYWN0CiAgICAgICAgdG90YWxCZXRzICs9IDE7CgogICAgICAgIC8qIHRvdGFsIHdhZ2VyZWQgKi8KICAgICAgICAvL3RvZG8gLSB1cGRhdGUgaW4gbGl2ZSBjb250cmFjdAogICAgICAgIHRvdGFsV2VpV2FnZXJlZCArPSBtc2cudmFsdWU7ICAgICAgICAKCiAgICAgICAgLyoKICAgICAgICAqIGFzc2lnbiBwYXJ0aWFsbHkgZW5jcnlwdGVkIHF1ZXJ5IHRvIG9yYWNsaXplCiAgICAgICAgKiBvbmx5IHRoZSBhcGlLZXkgaXMgZW5jcnlwdGVkIAogICAgICAgICogaW50ZWdlciBxdWVyeSBpcyBpbiBwbGFpbiB0ZXh0CiAgICAgICAgKi8KICAgICAgICBieXRlczMyIHJuZ0lkID0gb3JhY2xpemVfcXVlcnkoIm5lc3RlZCIsICJbVVJMXSBbJ2pzb24oaHR0cHM6Ly9hcGkucmFuZG9tLm9yZy9qc29uLXJwYy8xL2ludm9rZSkucmVzdWx0LnJhbmRvbVtcInNlcmlhbE51bWJlclwiLFwiZGF0YVwiXScsICdcXG57XCJqc29ucnBjXCI6XCIyLjBcIixcIm1ldGhvZFwiOlwiZ2VuZXJhdGVTaWduZWRJbnRlZ2Vyc1wiLFwicGFyYW1zXCI6e1wiYXBpS2V5XCI6JHtbZGVjcnlwdF0gQkcwaDJFcTUya1FHSHBpekJraHFGYTVlT2l5UVlibHJ4Vzg2KzdQdlorYW95WkFuTm4xMHFUUEVkbDA4NTlObU5DUjRUMTU2QW5tYk5pUVZ6Z2VrKzVoQm9kN0pLMUpCRHh5V2JXUXpCbFpuUnNPTUpiVlBXdndweTkyc2MzejYyeGVwSThEcC9wSG5ZT1IvYUVSK1oyMUE5Qyt2eEFFPX0sXCJuXCI6MSxcIm1pblwiOjEsXCJtYXhcIjoxMDAsXCJyZXBsYWNlbWVudFwiOnRydWUsXCJiYXNlXCI6MTAke1tpZGVudGl0eV0gXCJ9XCJ9LFwiaWRcIjoxJHtbaWRlbnRpdHldIFwifVwifSddIiwgZ2FzRm9yT3JhY2xpemUpOwogICAgICAgIAkgICAgICAgIAogICAgICAgIC8qIG1hcCBiZXQgaWQgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLwoJCXBsYXllckJldElkW3JuZ0lkXSA9IHJuZ0lkOwogICAgICAgIC8qIG1hcCBwbGF5ZXIgbHVja3kgbnVtYmVyIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8KCQlwbGF5ZXJOdW1iZXJbcm5nSWRdID0gcm9sbFVuZGVyOwogICAgICAgIC8qIG1hcCB2YWx1ZSBvZiB3YWdlciB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCiAgICAgICAgcGxheWVyQmV0VmFsdWVbcm5nSWRdID0gbXNnLnZhbHVlOwogICAgICAgIC8qIG1hcCBwbGF5ZXIgYWRkcmVzcyB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCiAgICAgICAgcGxheWVyQWRkcmVzc1tybmdJZF0gPSBtc2cuc2VuZGVyOwogICAgICAgIC8qIHNhZmVseSBtYXAgcGxheWVyIHByb2ZpdCB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgcGxheWVyUHJvZml0W3JuZ0lkXSA9ICgoKChtc2cudmFsdWUgKiAoMTAwLShzYWZlU3ViKHJvbGxVbmRlciwxKSkpKSAvIChzYWZlU3ViKHJvbGxVbmRlciwxKSkrbXNnLnZhbHVlKSkqaG91c2VFZGdlL2hvdXNlRWRnZURpdmlzb3IpLW1zZy52YWx1ZTsgICAgICAgIAogICAgICAgIC8qIHNhZmVseSBpbmNyZWFzZSBtYXhQZW5kaW5nUGF5b3V0cyBsaWFiaWxpdHkgLSBjYWxjIGFsbCBwZW5kaW5nIHBheW91dHMgdW5kZXIgYXNzdW1wdGlvbiB0aGV5IHdpbiAqLwogICAgICAgIG1heFBlbmRpbmdQYXlvdXRzID0gc2FmZUFkZChtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyUHJvZml0W3JuZ0lkXSk7CiAgICAgICAgLyogY2hlY2sgY29udHJhY3QgY2FuIHBheW91dCBvbiB3aW4gKi8KICAgICAgICBpZihtYXhQZW5kaW5nUGF5b3V0cyA+PSBjb250cmFjdEJhbGFuY2UpIHRocm93OwogICAgICAgIC8qIHByb3ZpZGVzIGFjY3VyYXRlIG51bWJlcnMgZm9yIHdlYjMgYW5kIGFsbG93cyBmb3IgbWFudWFsIHJlZnVuZHMgaW4gY2FzZSBvZiBubyBvcmFjbGl6ZSBfX2NhbGxiYWNrICovCiAgICAgICAgTG9nQmV0KHBsYXllckJldElkW3JuZ0lkXSwgcGxheWVyQWRkcmVzc1tybmdJZF0sIHNhZmVBZGQocGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJQcm9maXRbcm5nSWRdKSwgcGxheWVyUHJvZml0W3JuZ0lkXSwgcGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJOdW1iZXJbcm5nSWRdKTsgICAgICAgICAgCgogICAgfSAgIAogICAgICAgICAgICAgCgogICAgLyoKICAgICogc2VtaS1wdWJsaWMgZnVuY3Rpb24gLSBvbmx5IG9yYWNsaXplIGNhbiBjYWxsCiAgICAqLwogICAgLypUTFNOb3RhcnkgZm9yIG9yYWNsaXplIGNhbGwgKi8KCWZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljICAgCgkJb25seU9yYWNsaXplCgkJcGF5b3V0c0FyZUFjdGl2ZQoJeyAgCgogICAgICAgIC8qIHBsYXllciBhZGRyZXNzIG1hcHBlZCB0byBxdWVyeSBpZCBkb2VzIG5vdCBleGlzdCAqLwogICAgICAgIGlmIChwbGF5ZXJBZGRyZXNzW215aWRdPT0weDApIHRocm93OwoKICAgICAgICAvKiB0b3RhbCBudW1iZXIgb2YgYmV0cyAqLwogICAgICAgIC8vdG9kbyAtIHVwZGF0ZSBpbiBsaXZlIGNvbnRyYWN0CiAgICAgICAgLy90b3RhbEJldHMgKz0gMTsKCiAgICAgICAgLyogdG90YWwgd2FnZXJlZCAqLwogICAgICAgIC8vdG9kbyAtIHVwZGF0ZSBpbiBsaXZlIGNvbnRyYWN0CiAgICAgICAgLy90b3RhbFdlaVdhZ2VyZWQgKz0gcGxheWVyQmV0VmFsdWVbbXlpZF07ICAgIAogICAgICAgIAogICAgICAgIC8qIGtlZXAgb3JhY2xpemUgaG9uZXN0IGJ5IHJldHJpZXZpbmcgdGhlIHNlcmlhbE51bWJlciBmcm9tIHJhbmRvbS5vcmcgcmVzdWx0ICovCiAgICAgICAgdmFyIHNsX3Jlc3VsdCA9IHJlc3VsdC50b1NsaWNlKCk7CiAgICAgICAgc2xfcmVzdWx0LmJleW9uZCgiWyIudG9TbGljZSgpKS51bnRpbCgiXSIudG9TbGljZSgpKTsKICAgICAgICB1aW50IHNlcmlhbE51bWJlck9mUmVzdWx0ID0gcGFyc2VJbnQoc2xfcmVzdWx0LnNwbGl0KCcsICcudG9TbGljZSgpKS50b1N0cmluZygpKTsgICAgICAgICAgCgoJICAgIC8qIG1hcCByZXN1bHQgdG8gcGxheWVyICovCiAgICAgICAgcGxheWVyUmFuZG9tUmVzdWx0W215aWRdID0gcGFyc2VJbnQoc2xfcmVzdWx0LmJleW9uZCgiWyIudG9TbGljZSgpKS51bnRpbCgiXSIudG9TbGljZSgpKS50b1N0cmluZygpKTsKICAgICAgICAKICAgICAgICAvKiBwcm9kdWNlIGludGVnZXIgYm91bmRlZCB0byAxLTEwMCBpbmNsdXNpdmUKICAgICAgICAqICB2aWEgc2hhMyByZXN1bHQgZnJvbSByYW5kb20ub3JnIGFuZCBwcm9vZiAoSVBGUyBhZGRyZXNzIG9mIFRMU05vdGFyeSBwcm9vZikKICAgICAgICAqLwogICAgICAgIHBsYXllckRpZVJlc3VsdFtteWlkXSA9IHVpbnQoc2hhMyhwbGF5ZXJSYW5kb21SZXN1bHRbbXlpZF0sIHByb29mKSkgJSAxMDAgKyAxOwogICAgICAgIAogICAgICAgIC8qIGdldCB0aGUgcGxheWVyQWRkcmVzcyBmb3IgdGhpcyBxdWVyeSBpZCAqLwogICAgICAgIHBsYXllclRlbXBBZGRyZXNzW215aWRdID0gcGxheWVyQWRkcmVzc1tteWlkXTsKICAgICAgICAvKiBkZWxldGUgcGxheWVyQWRkcmVzcyBmb3IgdGhpcyBxdWVyeSBpZCAqLwogICAgICAgIGRlbGV0ZSBwbGF5ZXJBZGRyZXNzW215aWRdOwoKICAgICAgICAvKiBtYXAgdGhlIHBsYXllclByb2ZpdCBmb3IgdGhpcyBxdWVyeSBpZCAqLwogICAgICAgIHBsYXllclRlbXBSZXdhcmRbbXlpZF0gPSBwbGF5ZXJQcm9maXRbbXlpZF07CiAgICAgICAgLyogc2V0ICBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgdG8gMCAqLwogICAgICAgIHBsYXllclByb2ZpdFtteWlkXSA9IDA7IAoKICAgICAgICAvKiBzYWZlbHkgcmVkdWNlIG1heFBlbmRpbmdQYXlvdXRzIGxpYWJpbGl0eSAqLwogICAgICAgIG1heFBlbmRpbmdQYXlvdXRzID0gc2FmZVN1YihtYXhQZW5kaW5nUGF5b3V0cywgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7ICAgICAgICAgCgogICAgICAgIC8qIG1hcCB0aGUgcGxheWVyQmV0VmFsdWUgZm9yIHRoaXMgcXVlcnkgaWQgKi8KICAgICAgICBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0gPSBwbGF5ZXJCZXRWYWx1ZVtteWlkXTsKICAgICAgICAvKiBzZXQgIHBsYXllckJldFZhbHVlIGZvciB0aGlzIHF1ZXJ5IGlkIHRvIDAgKi8KICAgICAgICBwbGF5ZXJCZXRWYWx1ZVtteWlkXSA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgIC8qCiAgICAgICAgKiByZWZ1bmQKICAgICAgICAqIGlmIHJlc3VsdCBmcm9tIG9yYWNsaXplIGlzIDAgcmVmdW5kIG9ubHkgdGhlIG9yaWdpbmFsIGJldCB2YWx1ZQogICAgICAgICogaWYgcmVmdW5kIGZhaWxzIHNhdmUgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2FscwogICAgICAgICovCiAgICAgICAgaWYocGxheWVyRGllUmVzdWx0W215aWRdPT0wKXsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgIExvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCAzLCBwcm9vZik7ICAgICAgICAgICAgCgogICAgICAgICAgICAvKgogICAgICAgICAgICAqIHNlbmQgcmVmdW5kIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QKICAgICAgICAgICAgKiBpZiBzZW5kIGZhaWxzIG1hcCByZWZ1bmQgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW2FkZHJlc3NdCiAgICAgICAgICAgICogZm9yIHdpdGhkcmF3YWwgbGF0ZXIgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucwogICAgICAgICAgICAqLwogICAgICAgICAgICBpZighcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0uc2VuZChwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0pKXsKICAgICAgICAgICAgICAgIExvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCA0LCBwcm9vZik7ICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLwogICAgICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSA9IHNhZmVBZGQocGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdKTsgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAqIHBheSB3aW5uZXIKICAgICAgICAqIHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHRvIGNhbGN1bGF0ZSBuZXcgbWF4IGJldAogICAgICAgICogc2VuZCByZXdhcmQKICAgICAgICAqIGlmIHNlbmQgb2YgcmV3YXJkIGZhaWxzIHNhdmUgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzICAgICAgICAKICAgICAgICAqLwogICAgICAgIGlmKHBsYXllckRpZVJlc3VsdFtteWlkXSA8IHBsYXllck51bWJlcltteWlkXSl7IAoKICAgICAgICAgICAgLyogc2FmZWx5IHJlZHVjZSBjb250cmFjdCBiYWxhbmNlIGJ5IHBsYXllciBwcm9maXQgKi8KICAgICAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOyAKCiAgICAgICAgICAgIC8qIHVwZGF0ZSB0b3RhbCB3ZWkgd29uICovCiAgICAgICAgICAgIHRvdGFsV2VpV29uID0gc2FmZUFkZCh0b3RhbFdlaVdvbiwgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7ICAgICAgICAgICAgICAKCiAgICAgICAgICAgIC8qIHNhZmVseSBjYWxjdWxhdGUgcGF5b3V0IHZpYSBwcm9maXQgcGx1cyBvcmlnaW5hbCB3YWdlciAqLwogICAgICAgICAgICBwbGF5ZXJUZW1wUmV3YXJkW215aWRdID0gc2FmZUFkZChwbGF5ZXJUZW1wUmV3YXJkW215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0pOyAKCiAgICAgICAgICAgIExvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSwgMSwgcHJvb2YpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgIC8qIHVwZGF0ZSBtYXhpbXVtIHByb2ZpdCAqLwogICAgICAgICAgICBzZXRNYXhQcm9maXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICogc2VuZCB3aW4gLSBleHRlcm5hbCBjYWxsIHRvIGFuIHVudHJ1c3RlZCBjb250cmFjdAogICAgICAgICAgICAqIGlmIHNlbmQgZmFpbHMgbWFwIHJld2FyZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc10KICAgICAgICAgICAgKiBmb3Igd2l0aGRyYXdhbCBsYXRlciB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zCiAgICAgICAgICAgICovCiAgICAgICAgICAgIGlmKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBSZXdhcmRbbXlpZF0pKXsKICAgICAgICAgICAgICAgIExvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSwgMiwgcHJvb2YpOyAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLwogICAgICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSA9IHNhZmVBZGQocGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSwgcGxheWVyVGVtcFJld2FyZFtteWlkXSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CgogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAqIG5vIHdpbgogICAgICAgICogc2VuZCAxIHdlaSB0byBhIGxvc2luZyBiZXQKICAgICAgICAqIHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlIHRvIGNhbGN1bGF0ZSBuZXcgbWF4IGJldAogICAgICAgICovCiAgICAgICAgaWYocGxheWVyRGllUmVzdWx0W215aWRdID49IHBsYXllck51bWJlcltteWlkXSl7CgogICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMCwgcHJvb2YpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAvKiAgCiAgICAgICAgICAgICogIHNhZmUgYWRqdXN0IGNvbnRyYWN0QmFsYW5jZQogICAgICAgICAgICAqICBzZXRNYXhQcm9maXQKICAgICAgICAgICAgKiAgc2VuZCAxIHdlaSB0byBsb3NpbmcgYmV0CiAgICAgICAgICAgICovCiAgICAgICAgICAgIGNvbnRyYWN0QmFsYW5jZSA9IHNhZmVBZGQoY29udHJhY3RCYWxhbmNlLCAocGxheWVyVGVtcEJldFZhbHVlW215aWRdLTEpKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAvKiB1cGRhdGUgbWF4aW11bSBwcm9maXQgKi8KICAgICAgICAgICAgc2V0TWF4UHJvZml0KCk7IAoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgKiBzZW5kIDEgd2VpIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgKi8KICAgICAgICAgICAgaWYoIXBsYXllclRlbXBBZGRyZXNzW215aWRdLnNlbmQoMSkpewogICAgICAgICAgICAgICAgLyogaWYgc2VuZCBmYWlsZWQgbGV0IHBsYXllciB3aXRoZHJhdyB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zICovICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCAxKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgfQoKICAgIH0KICAgIAogICAgLyoKICAgICogcHVibGljIGZ1bmN0aW9uCiAgICAqIGluIGNhc2Ugb2YgYSBmYWlsZWQgcmVmdW5kIG9yIHdpbiBzZW5kCiAgICAqLwogICAgZnVuY3Rpb24gcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zKCkgcHVibGljIAogICAgICAgIHBheW91dHNBcmVBY3RpdmUKICAgICAgICByZXR1cm5zIChib29sKQogICAgIHsKICAgICAgICB1aW50IHdpdGhkcmF3QW1vdW50ID0gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdOwogICAgICAgIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgLyogZXh0ZXJuYWwgY2FsbCB0byB1bnRydXN0ZWQgY29udHJhY3QgKi8KICAgICAgICBpZiAobXNnLnNlbmRlci5jYWxsLnZhbHVlKHdpdGhkcmF3QW1vdW50KSgpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIHJldmVydCBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOyAqLwogICAgICAgICAgICAvKiBwbGF5ZXIgY2FuIHRyeSB0byB3aXRoZHJhdyBhZ2FpbiBsYXRlciAqLwogICAgICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSB3aXRoZHJhd0Ftb3VudDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKiBjaGVjayBmb3IgcGVuZGluZyB3aXRoZHJhd2FscyAgKi8KICAgIGZ1bmN0aW9uIHBsYXllckdldFBlbmRpbmdUeEJ5QWRkcmVzcyhhZGRyZXNzIGFkZHJlc3NUb0NoZWNrKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbYWRkcmVzc1RvQ2hlY2tdOwogICAgfQoKICAgIC8qCiAgICAqIGludGVybmFsIGZ1bmN0aW9uCiAgICAqIHNldHMgbWF4IHByb2ZpdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldE1heFByb2ZpdCgpIGludGVybmFsIHsKICAgICAgICBtYXhQcm9maXQgPSAoY29udHJhY3RCYWxhbmNlKm1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UpL21heFByb2ZpdERpdmlzb3I7ICAKICAgIH0gICAKCiAgICAvKgogICAgKiBvd25lci90cmVhc3VyeSBhZGRyZXNzIG9ubHkgZnVuY3Rpb25zCiAgICAqLwogICAgZnVuY3Rpb24gKCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgb25seVRyZWFzdXJ5CiAgICB7CiAgICAgICAgLyogc2FmZWx5IHVwZGF0ZSBjb250cmFjdCBiYWxhbmNlICovCiAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZUFkZChjb250cmFjdEJhbGFuY2UsIG1zZy52YWx1ZSk7ICAgICAgICAKICAgICAgICAvKiB1cGRhdGUgdGhlIG1heGltdW0gcHJvZml0ICovCiAgICAgICAgc2V0TWF4UHJvZml0KCk7CiAgICB9IAoKICAgIC8qIHNldCBnYXMgZm9yIG9yYWNsaXplIHF1ZXJ5ICovCiAgICBmdW5jdGlvbiBvd25lclNldE9yYWNsaXplU2FmZUdhcyh1aW50MzIgbmV3U2FmZUdhc1RvT3JhY2xpemUpIHB1YmxpYyAKCQlvbmx5T3duZXIKCXsKICAgIAlnYXNGb3JPcmFjbGl6ZSA9IG5ld1NhZmVHYXNUb09yYWNsaXplOwogICAgfQoKICAgIC8qIG9ubHkgb3duZXIgYWRqdXN0IGNvbnRyYWN0IGJhbGFuY2UgdmFyaWFibGUgKG9ubHkgdXNlZCBmb3IgbWF4IHByb2ZpdCBjYWxjKSAqLwogICAgZnVuY3Rpb24gb3duZXJVcGRhdGVDb250cmFjdEJhbGFuY2UodWludCBuZXdDb250cmFjdEJhbGFuY2VJbldlaSkgcHVibGljIAoJCW9ubHlPd25lcgogICAgeyAgICAgICAgCiAgICAgICBjb250cmFjdEJhbGFuY2UgPSBuZXdDb250cmFjdEJhbGFuY2VJbldlaTsKICAgIH0gICAgIAoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGhvdXNlRWRnZSAqLwogICAgZnVuY3Rpb24gb3duZXJTZXRIb3VzZUVkZ2UodWludCBuZXdIb3VzZUVkZ2UpIHB1YmxpYyAKCQlvbmx5T3duZXIKICAgIHsKICAgICAgICBob3VzZUVkZ2UgPSBuZXdIb3VzZUVkZ2U7CiAgICB9CgogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSAqLwogICAgZnVuY3Rpb24gb3duZXJTZXRNYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKHVpbnQgbmV3TWF4UHJvZml0QXNQZXJjZW50KSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7CiAgICAgICAgLyogcmVzdHJpY3QgZWFjaCBiZXQgdG8gYSBtYXhpbXVtIHByb2ZpdCBvZiAxJSBjb250cmFjdEJhbGFuY2UgKi8KICAgICAgICBpZihuZXdNYXhQcm9maXRBc1BlcmNlbnQgPiAxMDAwMCkgdGhyb3c7CiAgICAgICAgbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSA9IG5ld01heFByb2ZpdEFzUGVyY2VudDsKICAgICAgICBzZXRNYXhQcm9maXQoKTsKICAgIH0KCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBtaW5CZXQgKi8KICAgIGZ1bmN0aW9uIG93bmVyU2V0TWluQmV0KHVpbnQgbmV3TWluaW11bUJldCkgcHVibGljIAoJCW9ubHlPd25lcgogICAgewogICAgICAgIG1pbkJldCA9IG5ld01pbmltdW1CZXQ7CiAgICB9ICAgICAgIAoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gdHJhbnNmZXIgZXRoZXIgKi8KICAgIGZ1bmN0aW9uIG93bmVyVHJhbnNmZXJFdGhlcihhZGRyZXNzIHNlbmRUbywgdWludCBhbW91bnQpIHB1YmxpYyAKCQlvbmx5T3duZXIKICAgIHsgICAgICAgIAogICAgICAgIC8qIHNhZmVseSB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB3aGVuIHNlbmRpbmcgb3V0IGZ1bmRzKi8KICAgICAgICBjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgYW1vdW50KTsJCQogICAgICAgIC8qIHVwZGF0ZSBtYXggcHJvZml0ICovCiAgICAgICAgc2V0TWF4UHJvZml0KCk7CiAgICAgICAgaWYoIXNlbmRUby5zZW5kKGFtb3VudCkpIHRocm93OwogICAgICAgIExvZ093bmVyVHJhbnNmZXIoc2VuZFRvLCBhbW91bnQpOyAKICAgIH0KCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIGRvIG1hbnVhbCByZWZ1bmQKICAgICogdXNlZCBvbmx5IGlmIGJldCBwbGFjZWQgKyBvcmFjbGl6ZSBmYWlsZWQgdG8gX19jYWxsYmFjawogICAgKiBmaWx0ZXIgTG9nQmV0IGJ5IGFkZHJlc3MgYW5kL29yIHBsYXllckJldElkOgogICAgKiBMb2dCZXQocGxheWVyQmV0SWRbcm5nSWRdLCBwbGF5ZXJBZGRyZXNzW3JuZ0lkXSwgc2FmZUFkZChwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllclByb2ZpdFtybmdJZF0pLCBwbGF5ZXJQcm9maXRbcm5nSWRdLCBwbGF5ZXJCZXRWYWx1ZVtybmdJZF0sIHBsYXllck51bWJlcltybmdJZF0pOwogICAgKiBjaGVjayB0aGUgZm9sbG93aW5nIGxvZ3MgZG8gbm90IGV4aXN0IGZvciBwbGF5ZXJCZXRJZCBhbmQvb3IgcGxheWVyQWRkcmVzc1tybmdJZF0gYmVmb3JlIHJlZnVuZGluZzoKICAgICogTG9nUmVzdWx0IG9yIExvZ1JlZnVuZAogICAgKiBpZiBMb2dSZXN1bHQgZXhpc3RzIHBsYXllciBzaG91bGQgdXNlIHRoZSB3aXRoZHJhdyBwYXR0ZXJuIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAKICAgICovCiAgICBmdW5jdGlvbiBvd25lclJlZnVuZFBsYXllcihieXRlczMyIG9yaWdpbmFsUGxheWVyQmV0SWQsIGFkZHJlc3Mgc2VuZFRvLCB1aW50IG9yaWdpbmFsUGxheWVyUHJvZml0LCB1aW50IG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpIHB1YmxpYyAKCQlvbmx5T3duZXIKICAgIHsgICAgICAgIAogICAgICAgIC8qIHNhZmVseSByZWR1Y2UgcGVuZGluZ1BheW91dHMgYnkgcGxheWVyUHJvZml0W3JuZ0lkXSAqLwogICAgICAgIG1heFBlbmRpbmdQYXlvdXRzID0gc2FmZVN1YihtYXhQZW5kaW5nUGF5b3V0cywgb3JpZ2luYWxQbGF5ZXJQcm9maXQpOwogICAgICAgIC8qIHNlbmQgcmVmdW5kICovCiAgICAgICAgaWYoIXNlbmRUby5zZW5kKG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpKSB0aHJvdzsKICAgICAgICAvKiBsb2cgcmVmdW5kcyAqLwogICAgICAgIExvZ1JlZnVuZChvcmlnaW5hbFBsYXllckJldElkLCBzZW5kVG8sIG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpOyAgICAgICAgCiAgICB9ICAgIAoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGVtZXJnZW5jeSBwYXVzZSAjMSAqLwogICAgZnVuY3Rpb24gb3duZXJQYXVzZUdhbWUoYm9vbCBuZXdTdGF0dXMpIHB1YmxpYyAKCQlvbmx5T3duZXIKICAgIHsKCQlnYW1lUGF1c2VkID0gbmV3U3RhdHVzOwogICAgfQoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGVtZXJnZW5jeSBwYXVzZSAjMiAqLwogICAgZnVuY3Rpb24gb3duZXJQYXVzZVBheW91dHMoYm9vbCBuZXdQYXlvdXRTdGF0dXMpIHB1YmxpYyAKCQlvbmx5T3duZXIKICAgIHsKCQlwYXlvdXRzUGF1c2VkID0gbmV3UGF5b3V0U3RhdHVzOwogICAgfSAKCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCB0cmVhc3VyeSBhZGRyZXNzICovCiAgICBmdW5jdGlvbiBvd25lclNldFRyZWFzdXJ5KGFkZHJlc3MgbmV3VHJlYXN1cnkpIHB1YmxpYyAKCQlvbmx5T3duZXIKCXsKICAgICAgICB0cmVhc3VyeSA9IG5ld1RyZWFzdXJ5OwogICAgfSAgICAgICAgIAoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IG93bmVyIGFkZHJlc3MgKi8KICAgIGZ1bmN0aW9uIG93bmVyQ2hhbmdlT3duZXIoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIAoJCW9ubHlPd25lcgoJewogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CgogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzdWljaWRlIC0gZW1lcmdlbmN5ICovCiAgICBmdW5jdGlvbiBvd25lcmtpbGwoKSBwdWJsaWMgCgkJb25seU93bmVyCgl7CgkJc3VpY2lkZShvd25lcik7Cgl9ICAKICAgICAgCgoKfQ=='.
	

]
