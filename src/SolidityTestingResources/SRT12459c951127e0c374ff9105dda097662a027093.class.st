Class {
	#name : #SRT12459c951127e0c374ff9105dda097662a027093,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT12459c951127e0c374ff9105dda097662a027093 >> base64 [
	^ 'LyoKCiAgQ29weXJpZ2h0IDIwMTcgWmVyb0V4IEludGwuCgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE0OwoKLyoKICogT3duYWJsZQogKgogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgVG9rZW4gewoKICAgIC8vLyBAcmV0dXJuIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCBzdXBwbHkpIHt9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7fQoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX2FkZHJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHt9CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKfQoKLy8vIEB0aXRsZSBUb2tlblRyYW5zZmVyUHJveHkgLSBUcmFuc2ZlcnMgdG9rZW5zIG9uIGJlaGFsZiBvZiBjb250cmFjdHMgdGhhdCBoYXZlIGJlZW4gYXBwcm92ZWQgdmlhIGRlY2VudHJhbGl6ZWQgZ292ZXJuYW5jZS4KLy8vIEBhdXRob3IgQW1pciBCYW5kZWFsaSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImI1ZDRkOGRjYzdmNTg1Y2RlNWM3ZGFkZmQwZDZjMTliZDZkYWQ4Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4sIFdpbGwgV2FycmVuIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMjQ1MzRkNDg0ODY0MTQ1Yzc0NTY0YjRlNDE0NzUwMGE0NzRiNDkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBUb2tlblRyYW5zZmVyUHJveHkgaXMgT3duYWJsZSB7CgogICAgLy8vIEBkZXYgT25seSBhdXRob3JpemVkIGFkZHJlc3NlcyBjYW4gaW52b2tlIGZ1bmN0aW9ucyB3aXRoIHRoaXMgbW9kaWZpZXIuCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCB7CiAgICAgICAgcmVxdWlyZShhdXRob3JpemVkW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHRhcmdldEF1dGhvcml6ZWQoYWRkcmVzcyB0YXJnZXQpIHsKICAgICAgICByZXF1aXJlKGF1dGhvcml6ZWRbdGFyZ2V0XSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0YXJnZXROb3RBdXRob3JpemVkKGFkZHJlc3MgdGFyZ2V0KSB7CiAgICAgICAgcmVxdWlyZSghYXV0aG9yaXplZFt0YXJnZXRdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGF1dGhvcml6ZWQ7CiAgICBhZGRyZXNzW10gcHVibGljIGF1dGhvcml0aWVzOwoKICAgIGV2ZW50IExvZ0F1dGhvcml6ZWRBZGRyZXNzQWRkZWQoYWRkcmVzcyBpbmRleGVkIHRhcmdldCwgYWRkcmVzcyBpbmRleGVkIGNhbGxlcik7CiAgICBldmVudCBMb2dBdXRob3JpemVkQWRkcmVzc1JlbW92ZWQoYWRkcmVzcyBpbmRleGVkIHRhcmdldCwgYWRkcmVzcyBpbmRleGVkIGNhbGxlcik7CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEF1dGhvcml6ZXMgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdGFyZ2V0IEFkZHJlc3MgdG8gYXV0aG9yaXplLgogICAgZnVuY3Rpb24gYWRkQXV0aG9yaXplZEFkZHJlc3MoYWRkcmVzcyB0YXJnZXQpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgdGFyZ2V0Tm90QXV0aG9yaXplZCh0YXJnZXQpCiAgICB7CiAgICAgICAgYXV0aG9yaXplZFt0YXJnZXRdID0gdHJ1ZTsKICAgICAgICBhdXRob3JpdGllcy5wdXNoKHRhcmdldCk7CiAgICAgICAgTG9nQXV0aG9yaXplZEFkZHJlc3NBZGRlZCh0YXJnZXQsIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlbW92ZXMgYXV0aG9yaXppb24gb2YgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdGFyZ2V0IEFkZHJlc3MgdG8gcmVtb3ZlIGF1dGhvcml6YXRpb24gZnJvbS4KICAgIGZ1bmN0aW9uIHJlbW92ZUF1dGhvcml6ZWRBZGRyZXNzKGFkZHJlc3MgdGFyZ2V0KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgICAgIHRhcmdldEF1dGhvcml6ZWQodGFyZ2V0KQogICAgewogICAgICAgIGRlbGV0ZSBhdXRob3JpemVkW3RhcmdldF07CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXV0aG9yaXRpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGF1dGhvcml0aWVzW2ldID09IHRhcmdldCkgewogICAgICAgICAgICAgICAgYXV0aG9yaXRpZXNbaV0gPSBhdXRob3JpdGllc1thdXRob3JpdGllcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGF1dGhvcml0aWVzLmxlbmd0aCAtPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgTG9nQXV0aG9yaXplZEFkZHJlc3NSZW1vdmVkKHRhcmdldCwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbHMgaW50byBFUkMyMCBUb2tlbiBjb250cmFjdCwgaW52b2tpbmcgdHJhbnNmZXJGcm9tLgogICAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBmcm9tIEFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW4gZnJvbS4KICAgIC8vLyBAcGFyYW0gdG8gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbiB0by4KICAgIC8vLyBAcGFyYW0gdmFsdWUgQW1vdW50IG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgLy8vIEByZXR1cm4gU3VjY2VzcyBvZiB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIHRva2VuLAogICAgICAgIGFkZHJlc3MgZnJvbSwKICAgICAgICBhZGRyZXNzIHRvLAogICAgICAgIHVpbnQgdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUF1dGhvcml6ZWQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBUb2tlbih0b2tlbikudHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgICB9CgogICAgLyoKICAgICAqIFB1YmxpYyBjb25zdGFudCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEdldHMgYWxsIGF1dGhvcml6ZWQgYWRkcmVzc2VzLgogICAgLy8vIEByZXR1cm4gQXJyYXkgb2YgYXV0aG9yaXplZCBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRBdXRob3JpemVkQWRkcmVzc2VzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gYXV0aG9yaXRpZXM7CiAgICB9Cn0KCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGMgPSBhIC8gYjsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KfQoKLy8vIEB0aXRsZSBFeGNoYW5nZSAtIEZhY2lsaXRhdGVzIGV4Y2hhbmdlIG9mIEVSQzIwIHRva2Vucy4KLy8vIEBhdXRob3IgQW1pciBCYW5kZWFsaSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjM4NTk1NTUxNGE3ODA4NDA2ODRhNTc1MjVkNWI0YzE2NWI1NzU1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4sIFdpbGwgV2FycmVuIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iN2MwYjE1MTAxMDNjNGMwNDJjMGUxMzE2MTkxZjA4NTIxZjEzMTEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBFeGNoYW5nZSBpcyBTYWZlTWF0aCB7CgogICAgLy8gRXJyb3IgQ29kZXMKICAgIGVudW0gRXJyb3JzIHsKICAgICAgICBPUkRFUl9FWFBJUkVELCAgICAgICAgICAgICAgICAgICAgLy8gT3JkZXIgaGFzIGFscmVhZHkgZXhwaXJlZAogICAgICAgIE9SREVSX0ZVTExZX0ZJTExFRF9PUl9DQU5DRUxMRUQsICAvLyBPcmRlciBoYXMgYWxyZWFkeSBiZWVuIGZ1bGx5IGZpbGxlZCBvciBjYW5jZWxsZWQKICAgICAgICBST1VORElOR19FUlJPUl9UT09fTEFSR0UsICAgICAgICAgLy8gUm91bmRpbmcgZXJyb3IgdG9vIGxhcmdlCiAgICAgICAgSU5TVUZGSUNJRU5UX0JBTEFOQ0VfT1JfQUxMT1dBTkNFIC8vIEluc3VmZmljaWVudCBiYWxhbmNlIG9yIGFsbG93YW5jZSBmb3IgdG9rZW4gdHJhbnNmZXIKICAgIH0KCiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIFZFUlNJT04gPSAiMS4wLjAiOwogICAgdWludDE2IGNvbnN0YW50IHB1YmxpYyBFWFRFUk5BTF9RVUVSWV9HQVNfTElNSVQgPSA0OTk5OyAgICAvLyBDaGFuZ2VzIHRvIHN0YXRlIHJlcXVpcmUgYXQgbGVhc3QgNTAwMCBnYXMKCiAgICBhZGRyZXNzIHB1YmxpYyBaUlhfVE9LRU5fQ09OVFJBQ1Q7CiAgICBhZGRyZXNzIHB1YmxpYyBUT0tFTl9UUkFOU0ZFUl9QUk9YWV9DT05UUkFDVDsKCiAgICAvLyBNYXBwaW5ncyBvZiBvcmRlckhhc2ggPT4gYW1vdW50cyBvZiB0YWtlclRva2VuQW1vdW50IGZpbGxlZCBvciBjYW5jZWxsZWQuCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHB1YmxpYyBmaWxsZWQ7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHB1YmxpYyBjYW5jZWxsZWQ7CgogICAgZXZlbnQgTG9nRmlsbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgbWFrZXIsCiAgICAgICAgYWRkcmVzcyB0YWtlciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgZmVlUmVjaXBpZW50LAogICAgICAgIGFkZHJlc3MgbWFrZXJUb2tlbiwKICAgICAgICBhZGRyZXNzIHRha2VyVG9rZW4sCiAgICAgICAgdWludCBmaWxsZWRNYWtlclRva2VuQW1vdW50LAogICAgICAgIHVpbnQgZmlsbGVkVGFrZXJUb2tlbkFtb3VudCwKICAgICAgICB1aW50IHBhaWRNYWtlckZlZSwKICAgICAgICB1aW50IHBhaWRUYWtlckZlZSwKICAgICAgICBieXRlczMyIGluZGV4ZWQgdG9rZW5zLCAvLyBrZWNjYWsyNTYobWFrZXJUb2tlbiwgdGFrZXJUb2tlbiksIGFsbG93cyBzdWJzY3JpYmluZyB0byBhIHRva2VuIHBhaXIKICAgICAgICBieXRlczMyIG9yZGVySGFzaAogICAgKTsKCiAgICBldmVudCBMb2dDYW5jZWwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIG1ha2VyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBmZWVSZWNpcGllbnQsCiAgICAgICAgYWRkcmVzcyBtYWtlclRva2VuLAogICAgICAgIGFkZHJlc3MgdGFrZXJUb2tlbiwKICAgICAgICB1aW50IGNhbmNlbGxlZE1ha2VyVG9rZW5BbW91bnQsCiAgICAgICAgdWludCBjYW5jZWxsZWRUYWtlclRva2VuQW1vdW50LAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCB0b2tlbnMsCiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2gKICAgICk7CgogICAgZXZlbnQgTG9nRXJyb3IodWludDggaW5kZXhlZCBlcnJvcklkLCBieXRlczMyIGluZGV4ZWQgb3JkZXJIYXNoKTsKCiAgICBzdHJ1Y3QgT3JkZXIgewogICAgICAgIGFkZHJlc3MgbWFrZXI7CiAgICAgICAgYWRkcmVzcyB0YWtlcjsKICAgICAgICBhZGRyZXNzIG1ha2VyVG9rZW47CiAgICAgICAgYWRkcmVzcyB0YWtlclRva2VuOwogICAgICAgIGFkZHJlc3MgZmVlUmVjaXBpZW50OwogICAgICAgIHVpbnQgbWFrZXJUb2tlbkFtb3VudDsKICAgICAgICB1aW50IHRha2VyVG9rZW5BbW91bnQ7CiAgICAgICAgdWludCBtYWtlckZlZTsKICAgICAgICB1aW50IHRha2VyRmVlOwogICAgICAgIHVpbnQgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjOwogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoOwogICAgfQoKICAgIGZ1bmN0aW9uIEV4Y2hhbmdlKGFkZHJlc3MgX3pyeFRva2VuLCBhZGRyZXNzIF90b2tlblRyYW5zZmVyUHJveHkpIHsKICAgICAgICBaUlhfVE9LRU5fQ09OVFJBQ1QgPSBfenJ4VG9rZW47CiAgICAgICAgVE9LRU5fVFJBTlNGRVJfUFJPWFlfQ09OVFJBQ1QgPSBfdG9rZW5UcmFuc2ZlclByb3h5OwogICAgfQoKICAgIC8qCiAgICAqIENvcmUgZXhjaGFuZ2UgZnVuY3Rpb25zCiAgICAqLwoKICAgIC8vLyBAZGV2IEZpbGxzIHRoZSBpbnB1dCBvcmRlci4KICAgIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlciwgdGFrZXIsIG1ha2VyVG9rZW4sIHRha2VyVG9rZW4sIGFuZCBmZWVSZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgbWFrZXJGZWUsIHRha2VyRmVlLCBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWMsIGFuZCBzYWx0LgogICAgLy8vIEBwYXJhbSBmaWxsVGFrZXJUb2tlbkFtb3VudCBEZXNpcmVkIGFtb3VudCBvZiB0YWtlclRva2VuIHRvIGZpbGwuCiAgICAvLy8gQHBhcmFtIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UgVGVzdCBpZiB0cmFuc2ZlciB3aWxsIGZhaWwgYmVmb3JlIGF0dGVtcHRpbmcuCiAgICAvLy8gQHBhcmFtIHYgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgcy4KICAgIC8vLyBAcmV0dXJuIFRvdGFsIGFtb3VudCBvZiB0YWtlclRva2VuIGZpbGxlZCBpbiB0cmFkZS4KICAgIGZ1bmN0aW9uIGZpbGxPcmRlcigKICAgICAgICAgIGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgICB1aW50WzZdIG9yZGVyVmFsdWVzLAogICAgICAgICAgdWludCBmaWxsVGFrZXJUb2tlbkFtb3VudCwKICAgICAgICAgIGJvb2wgc2hvdWxkVGhyb3dPbkluc3VmZmljaWVudEJhbGFuY2VPckFsbG93YW5jZSwKICAgICAgICAgIHVpbnQ4IHYsCiAgICAgICAgICBieXRlczMyIHIsCiAgICAgICAgICBieXRlczMyIHMpCiAgICAgICAgICBwdWJsaWMKICAgICAgICAgIHJldHVybnMgKHVpbnQgZmlsbGVkVGFrZXJUb2tlbkFtb3VudCkKICAgIHsKICAgICAgICBPcmRlciBtZW1vcnkgb3JkZXIgPSBPcmRlcih7CiAgICAgICAgICAgIG1ha2VyOiBvcmRlckFkZHJlc3Nlc1swXSwKICAgICAgICAgICAgdGFrZXI6IG9yZGVyQWRkcmVzc2VzWzFdLAogICAgICAgICAgICBtYWtlclRva2VuOiBvcmRlckFkZHJlc3Nlc1syXSwKICAgICAgICAgICAgdGFrZXJUb2tlbjogb3JkZXJBZGRyZXNzZXNbM10sCiAgICAgICAgICAgIGZlZVJlY2lwaWVudDogb3JkZXJBZGRyZXNzZXNbNF0sCiAgICAgICAgICAgIG1ha2VyVG9rZW5BbW91bnQ6IG9yZGVyVmFsdWVzWzBdLAogICAgICAgICAgICB0YWtlclRva2VuQW1vdW50OiBvcmRlclZhbHVlc1sxXSwKICAgICAgICAgICAgbWFrZXJGZWU6IG9yZGVyVmFsdWVzWzJdLAogICAgICAgICAgICB0YWtlckZlZTogb3JkZXJWYWx1ZXNbM10sCiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lc3RhbXBJblNlYzogb3JkZXJWYWx1ZXNbNF0sCiAgICAgICAgICAgIG9yZGVySGFzaDogZ2V0T3JkZXJIYXNoKG9yZGVyQWRkcmVzc2VzLCBvcmRlclZhbHVlcykKICAgICAgICB9KTsKCiAgICAgICAgcmVxdWlyZShvcmRlci50YWtlciA9PSBhZGRyZXNzKDApIHx8IG9yZGVyLnRha2VyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUob3JkZXIubWFrZXJUb2tlbkFtb3VudCA+IDAgJiYgb3JkZXIudGFrZXJUb2tlbkFtb3VudCA+IDAgJiYgZmlsbFRha2VyVG9rZW5BbW91bnQgPiAwKTsKICAgICAgICByZXF1aXJlKGlzVmFsaWRTaWduYXR1cmUoCiAgICAgICAgICAgIG9yZGVyLm1ha2VyLAogICAgICAgICAgICBvcmRlci5vcmRlckhhc2gsCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMKICAgICAgICApKTsKCiAgICAgICAgaWYgKGJsb2NrLnRpbWVzdGFtcCA+PSBvcmRlci5leHBpcmF0aW9uVGltZXN0YW1wSW5TZWMpIHsKICAgICAgICAgICAgTG9nRXJyb3IodWludDgoRXJyb3JzLk9SREVSX0VYUElSRUQpLCBvcmRlci5vcmRlckhhc2gpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHVpbnQgcmVtYWluaW5nVGFrZXJUb2tlbkFtb3VudCA9IHNhZmVTdWIob3JkZXIudGFrZXJUb2tlbkFtb3VudCwgZ2V0VW5hdmFpbGFibGVUYWtlclRva2VuQW1vdW50KG9yZGVyLm9yZGVySGFzaCkpOwogICAgICAgIGZpbGxlZFRha2VyVG9rZW5BbW91bnQgPSBtaW4yNTYoZmlsbFRha2VyVG9rZW5BbW91bnQsIHJlbWFpbmluZ1Rha2VyVG9rZW5BbW91bnQpOwogICAgICAgIGlmIChmaWxsZWRUYWtlclRva2VuQW1vdW50ID09IDApIHsKICAgICAgICAgICAgTG9nRXJyb3IodWludDgoRXJyb3JzLk9SREVSX0ZVTExZX0ZJTExFRF9PUl9DQU5DRUxMRUQpLCBvcmRlci5vcmRlckhhc2gpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmIChpc1JvdW5kaW5nRXJyb3IoZmlsbGVkVGFrZXJUb2tlbkFtb3VudCwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCwgb3JkZXIubWFrZXJUb2tlbkFtb3VudCkpIHsKICAgICAgICAgICAgTG9nRXJyb3IodWludDgoRXJyb3JzLlJPVU5ESU5HX0VSUk9SX1RPT19MQVJHRSksIG9yZGVyLm9yZGVySGFzaCk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzaG91bGRUaHJvd09uSW5zdWZmaWNpZW50QmFsYW5jZU9yQWxsb3dhbmNlICYmICFpc1RyYW5zZmVyYWJsZShvcmRlciwgZmlsbGVkVGFrZXJUb2tlbkFtb3VudCkpIHsKICAgICAgICAgICAgTG9nRXJyb3IodWludDgoRXJyb3JzLklOU1VGRklDSUVOVF9CQUxBTkNFX09SX0FMTE9XQU5DRSksIG9yZGVyLm9yZGVySGFzaCk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludCBmaWxsZWRNYWtlclRva2VuQW1vdW50ID0gZ2V0UGFydGlhbEFtb3VudChmaWxsZWRUYWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlclRva2VuQW1vdW50LCBvcmRlci5tYWtlclRva2VuQW1vdW50KTsKICAgICAgICB1aW50IHBhaWRNYWtlckZlZTsKICAgICAgICB1aW50IHBhaWRUYWtlckZlZTsKICAgICAgICBmaWxsZWRbb3JkZXIub3JkZXJIYXNoXSA9IHNhZmVBZGQoZmlsbGVkW29yZGVyLm9yZGVySGFzaF0sIGZpbGxlZFRha2VyVG9rZW5BbW91bnQpOwogICAgICAgIHJlcXVpcmUodHJhbnNmZXJWaWFUb2tlblRyYW5zZmVyUHJveHkoCiAgICAgICAgICAgIG9yZGVyLm1ha2VyVG9rZW4sCiAgICAgICAgICAgIG9yZGVyLm1ha2VyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBmaWxsZWRNYWtlclRva2VuQW1vdW50CiAgICAgICAgKSk7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlclZpYVRva2VuVHJhbnNmZXJQcm94eSgKICAgICAgICAgICAgb3JkZXIudGFrZXJUb2tlbiwKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgb3JkZXIubWFrZXIsCiAgICAgICAgICAgIGZpbGxlZFRha2VyVG9rZW5BbW91bnQKICAgICAgICApKTsKICAgICAgICBpZiAob3JkZXIuZmVlUmVjaXBpZW50ICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgaWYgKG9yZGVyLm1ha2VyRmVlID4gMCkgewogICAgICAgICAgICAgICAgcGFpZE1ha2VyRmVlID0gZ2V0UGFydGlhbEFtb3VudChmaWxsZWRUYWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlclRva2VuQW1vdW50LCBvcmRlci5tYWtlckZlZSk7CiAgICAgICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyVmlhVG9rZW5UcmFuc2ZlclByb3h5KAogICAgICAgICAgICAgICAgICAgIFpSWF9UT0tFTl9DT05UUkFDVCwKICAgICAgICAgICAgICAgICAgICBvcmRlci5tYWtlciwKICAgICAgICAgICAgICAgICAgICBvcmRlci5mZWVSZWNpcGllbnQsCiAgICAgICAgICAgICAgICAgICAgcGFpZE1ha2VyRmVlCiAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3JkZXIudGFrZXJGZWUgPiAwKSB7CiAgICAgICAgICAgICAgICBwYWlkVGFrZXJGZWUgPSBnZXRQYXJ0aWFsQW1vdW50KGZpbGxlZFRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyRmVlKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJWaWFUb2tlblRyYW5zZmVyUHJveHkoCiAgICAgICAgICAgICAgICAgICAgWlJYX1RPS0VOX0NPTlRSQUNULAogICAgICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgb3JkZXIuZmVlUmVjaXBpZW50LAogICAgICAgICAgICAgICAgICAgIHBhaWRUYWtlckZlZQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIExvZ0ZpbGwoCiAgICAgICAgICAgIG9yZGVyLm1ha2VyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBvcmRlci5mZWVSZWNpcGllbnQsCiAgICAgICAgICAgIG9yZGVyLm1ha2VyVG9rZW4sCiAgICAgICAgICAgIG9yZGVyLnRha2VyVG9rZW4sCiAgICAgICAgICAgIGZpbGxlZE1ha2VyVG9rZW5BbW91bnQsCiAgICAgICAgICAgIGZpbGxlZFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgICAgIHBhaWRNYWtlckZlZSwKICAgICAgICAgICAgcGFpZFRha2VyRmVlLAogICAgICAgICAgICBrZWNjYWsyNTYob3JkZXIubWFrZXJUb2tlbiwgb3JkZXIudGFrZXJUb2tlbiksCiAgICAgICAgICAgIG9yZGVyLm9yZGVySGFzaAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGZpbGxlZFRha2VyVG9rZW5BbW91bnQ7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyB0aGUgaW5wdXQgb3JkZXIuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcGFyYW0gY2FuY2VsVGFrZXJUb2tlbkFtb3VudCBEZXNpcmVkIGFtb3VudCBvZiB0YWtlclRva2VuIHRvIGNhbmNlbCBpbiBvcmRlci4KICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiB0YWtlclRva2VuIGNhbmNlbGxlZC4KICAgIGZ1bmN0aW9uIGNhbmNlbE9yZGVyKAogICAgICAgIGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgICAgICB1aW50IGNhbmNlbFRha2VyVG9rZW5BbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICBPcmRlciBtZW1vcnkgb3JkZXIgPSBPcmRlcih7CiAgICAgICAgICAgIG1ha2VyOiBvcmRlckFkZHJlc3Nlc1swXSwKICAgICAgICAgICAgdGFrZXI6IG9yZGVyQWRkcmVzc2VzWzFdLAogICAgICAgICAgICBtYWtlclRva2VuOiBvcmRlckFkZHJlc3Nlc1syXSwKICAgICAgICAgICAgdGFrZXJUb2tlbjogb3JkZXJBZGRyZXNzZXNbM10sCiAgICAgICAgICAgIGZlZVJlY2lwaWVudDogb3JkZXJBZGRyZXNzZXNbNF0sCiAgICAgICAgICAgIG1ha2VyVG9rZW5BbW91bnQ6IG9yZGVyVmFsdWVzWzBdLAogICAgICAgICAgICB0YWtlclRva2VuQW1vdW50OiBvcmRlclZhbHVlc1sxXSwKICAgICAgICAgICAgbWFrZXJGZWU6IG9yZGVyVmFsdWVzWzJdLAogICAgICAgICAgICB0YWtlckZlZTogb3JkZXJWYWx1ZXNbM10sCiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lc3RhbXBJblNlYzogb3JkZXJWYWx1ZXNbNF0sCiAgICAgICAgICAgIG9yZGVySGFzaDogZ2V0T3JkZXJIYXNoKG9yZGVyQWRkcmVzc2VzLCBvcmRlclZhbHVlcykKICAgICAgICB9KTsKCiAgICAgICAgcmVxdWlyZShvcmRlci5tYWtlciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKG9yZGVyLm1ha2VyVG9rZW5BbW91bnQgPiAwICYmIG9yZGVyLnRha2VyVG9rZW5BbW91bnQgPiAwICYmIGNhbmNlbFRha2VyVG9rZW5BbW91bnQgPiAwKTsKCiAgICAgICAgaWYgKGJsb2NrLnRpbWVzdGFtcCA+PSBvcmRlci5leHBpcmF0aW9uVGltZXN0YW1wSW5TZWMpIHsKICAgICAgICAgICAgTG9nRXJyb3IodWludDgoRXJyb3JzLk9SREVSX0VYUElSRUQpLCBvcmRlci5vcmRlckhhc2gpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHVpbnQgcmVtYWluaW5nVGFrZXJUb2tlbkFtb3VudCA9IHNhZmVTdWIob3JkZXIudGFrZXJUb2tlbkFtb3VudCwgZ2V0VW5hdmFpbGFibGVUYWtlclRva2VuQW1vdW50KG9yZGVyLm9yZGVySGFzaCkpOwogICAgICAgIHVpbnQgY2FuY2VsbGVkVGFrZXJUb2tlbkFtb3VudCA9IG1pbjI1NihjYW5jZWxUYWtlclRva2VuQW1vdW50LCByZW1haW5pbmdUYWtlclRva2VuQW1vdW50KTsKICAgICAgICBpZiAoY2FuY2VsbGVkVGFrZXJUb2tlbkFtb3VudCA9PSAwKSB7CiAgICAgICAgICAgIExvZ0Vycm9yKHVpbnQ4KEVycm9ycy5PUkRFUl9GVUxMWV9GSUxMRURfT1JfQ0FOQ0VMTEVEKSwgb3JkZXIub3JkZXJIYXNoKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBjYW5jZWxsZWRbb3JkZXIub3JkZXJIYXNoXSA9IHNhZmVBZGQoY2FuY2VsbGVkW29yZGVyLm9yZGVySGFzaF0sIGNhbmNlbGxlZFRha2VyVG9rZW5BbW91bnQpOwoKICAgICAgICBMb2dDYW5jZWwoCiAgICAgICAgICAgIG9yZGVyLm1ha2VyLAogICAgICAgICAgICBvcmRlci5mZWVSZWNpcGllbnQsCiAgICAgICAgICAgIG9yZGVyLm1ha2VyVG9rZW4sCiAgICAgICAgICAgIG9yZGVyLnRha2VyVG9rZW4sCiAgICAgICAgICAgIGdldFBhcnRpYWxBbW91bnQoY2FuY2VsbGVkVGFrZXJUb2tlbkFtb3VudCwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCwgb3JkZXIubWFrZXJUb2tlbkFtb3VudCksCiAgICAgICAgICAgIGNhbmNlbGxlZFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgICAgIGtlY2NhazI1NihvcmRlci5tYWtlclRva2VuLCBvcmRlci50YWtlclRva2VuKSwKICAgICAgICAgICAgb3JkZXIub3JkZXJIYXNoCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gY2FuY2VsbGVkVGFrZXJUb2tlbkFtb3VudDsKICAgIH0KCiAgICAvKgogICAgKiBXcmFwcGVyIGZ1bmN0aW9ucwogICAgKi8KCiAgICAvLy8gQGRldiBGaWxscyBhbiBvcmRlciB3aXRoIHNwZWNpZmllZCBwYXJhbWV0ZXJzIGFuZCBFQ0RTQSBzaWduYXR1cmUsIHRocm93cyBpZiBzcGVjaWZpZWQgYW1vdW50IG5vdCBmaWxsZWQgZW50aXJlbHkuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsLgogICAgLy8vIEBwYXJhbSB2IEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyByLgogICAgLy8vIEBwYXJhbSBzIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBmdW5jdGlvbiBmaWxsT3JLaWxsT3JkZXIoCiAgICAgICAgYWRkcmVzc1s1XSBvcmRlckFkZHJlc3NlcywKICAgICAgICB1aW50WzZdIG9yZGVyVmFsdWVzLAogICAgICAgIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgdWludDggdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoZmlsbE9yZGVyKAogICAgICAgICAgICBvcmRlckFkZHJlc3NlcywKICAgICAgICAgICAgb3JkZXJWYWx1ZXMsCiAgICAgICAgICAgIGZpbGxUYWtlclRva2VuQW1vdW50LAogICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICkgPT0gZmlsbFRha2VyVG9rZW5BbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFN5bmNocm9ub3VzbHkgZXhlY3V0ZXMgbXVsdGlwbGUgZmlsbCBvcmRlcnMgaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3MgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciBhZGRyZXNzZXMuCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgICAvLy8gQHBhcmFtIGZpbGxUYWtlclRva2VuQW1vdW50cyBBcnJheSBvZiBkZXNpcmVkIGFtb3VudHMgb2YgdGFrZXJUb2tlbiB0byBmaWxsIGluIG9yZGVycy4KICAgIC8vLyBAcGFyYW0gc2hvdWxkVGhyb3dPbkluc3VmZmljaWVudEJhbGFuY2VPckFsbG93YW5jZSBUZXN0IGlmIHRyYW5zZmVycyB3aWxsIGZhaWwgYmVmb3JlIGF0dGVtcHRpbmcuCiAgICAvLy8gQHBhcmFtIHYgQXJyYXkgRUNEU0Egc2lnbmF0dXJlIHYgcGFyYW1ldGVycy4KICAgIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogICAgLy8vIEBwYXJhbSBzIEFycmF5IG9mIEVDRFNBIHNpZ25hdHVyZSBzIHBhcmFtZXRlcnMuCiAgICBmdW5jdGlvbiBiYXRjaEZpbGxPcmRlcnMoCiAgICAgICAgYWRkcmVzc1s1XVtdIG9yZGVyQWRkcmVzc2VzLAogICAgICAgIHVpbnRbNl1bXSBvcmRlclZhbHVlcywKICAgICAgICB1aW50W10gZmlsbFRha2VyVG9rZW5BbW91bnRzLAogICAgICAgIGJvb2wgc2hvdWxkVGhyb3dPbkluc3VmZmljaWVudEJhbGFuY2VPckFsbG93YW5jZSwKICAgICAgICB1aW50OFtdIHYsCiAgICAgICAgYnl0ZXMzMltdIHIsCiAgICAgICAgYnl0ZXMzMltdIHMpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3JkZXJBZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmlsbE9yZGVyKAogICAgICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbaV0sCiAgICAgICAgICAgICAgICBvcmRlclZhbHVlc1tpXSwKICAgICAgICAgICAgICAgIGZpbGxUYWtlclRva2VuQW1vdW50c1tpXSwKICAgICAgICAgICAgICAgIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UsCiAgICAgICAgICAgICAgICB2W2ldLAogICAgICAgICAgICAgICAgcltpXSwKICAgICAgICAgICAgICAgIHNbaV0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgU3luY2hyb25vdXNseSBleGVjdXRlcyBtdWx0aXBsZSBmaWxsT3JLaWxsIG9yZGVycyBpbiBhIHNpbmdsZSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2YgdWludCBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIHZhbHVlcy4KICAgIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnRzIEFycmF5IG9mIGRlc2lyZWQgYW1vdW50cyBvZiB0YWtlclRva2VuIHRvIGZpbGwgaW4gb3JkZXJzLgogICAgLy8vIEBwYXJhbSB2IEFycmF5IEVDRFNBIHNpZ25hdHVyZSB2IHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIHIgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHIgcGFyYW1ldGVycy4KICAgIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogICAgZnVuY3Rpb24gYmF0Y2hGaWxsT3JLaWxsT3JkZXJzKAogICAgICAgIGFkZHJlc3NbNV1bXSBvcmRlckFkZHJlc3NlcywKICAgICAgICB1aW50WzZdW10gb3JkZXJWYWx1ZXMsCiAgICAgICAgdWludFtdIGZpbGxUYWtlclRva2VuQW1vdW50cywKICAgICAgICB1aW50OFtdIHYsCiAgICAgICAgYnl0ZXMzMltdIHIsCiAgICAgICAgYnl0ZXMzMltdIHMpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3JkZXJBZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmlsbE9yS2lsbE9yZGVyKAogICAgICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbaV0sCiAgICAgICAgICAgICAgICBvcmRlclZhbHVlc1tpXSwKICAgICAgICAgICAgICAgIGZpbGxUYWtlclRva2VuQW1vdW50c1tpXSwKICAgICAgICAgICAgICAgIHZbaV0sCiAgICAgICAgICAgICAgICByW2ldLAogICAgICAgICAgICAgICAgc1tpXQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBTeW5jaHJvbm91c2x5IGV4ZWN1dGVzIG11bHRpcGxlIGZpbGwgb3JkZXJzIGluIGEgc2luZ2xlIHRyYW5zYWN0aW9uIHVudGlsIHRvdGFsIGZpbGxUYWtlclRva2VuQW1vdW50IGZpbGxlZC4KICAgIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2YgdWludCBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIHZhbHVlcy4KICAgIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCB0b3RhbCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsIGluIG9yZGVycy4KICAgIC8vLyBAcGFyYW0gc2hvdWxkVGhyb3dPbkluc3VmZmljaWVudEJhbGFuY2VPckFsbG93YW5jZSBUZXN0IGlmIHRyYW5zZmVycyB3aWxsIGZhaWwgYmVmb3JlIGF0dGVtcHRpbmcuCiAgICAvLy8gQHBhcmFtIHYgQXJyYXkgRUNEU0Egc2lnbmF0dXJlIHYgcGFyYW1ldGVycy4KICAgIC8vLyBAcGFyYW0gciBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgciBwYXJhbWV0ZXJzLgogICAgLy8vIEBwYXJhbSBzIEFycmF5IG9mIEVDRFNBIHNpZ25hdHVyZSBzIHBhcmFtZXRlcnMuCiAgICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgZmlsbFRha2VyVG9rZW5BbW91bnQgZmlsbGVkIGluIG9yZGVycy4KICAgIGZ1bmN0aW9uIGZpbGxPcmRlcnNVcFRvKAogICAgICAgIGFkZHJlc3NbNV1bXSBvcmRlckFkZHJlc3NlcywKICAgICAgICB1aW50WzZdW10gb3JkZXJWYWx1ZXMsCiAgICAgICAgdWludCBmaWxsVGFrZXJUb2tlbkFtb3VudCwKICAgICAgICBib29sIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UsCiAgICAgICAgdWludDhbXSB2LAogICAgICAgIGJ5dGVzMzJbXSByLAogICAgICAgIGJ5dGVzMzJbXSBzKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdWludCBmaWxsZWRUYWtlclRva2VuQW1vdW50ID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvcmRlckFkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKG9yZGVyQWRkcmVzc2VzW2ldWzNdID09IG9yZGVyQWRkcmVzc2VzWzBdWzNdKTsgLy8gdGFrZXJUb2tlbiBtdXN0IGJlIHRoZSBzYW1lIGZvciBlYWNoIG9yZGVyCiAgICAgICAgICAgIGZpbGxlZFRha2VyVG9rZW5BbW91bnQgPSBzYWZlQWRkKGZpbGxlZFRha2VyVG9rZW5BbW91bnQsIGZpbGxPcmRlcigKICAgICAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzW2ldLAogICAgICAgICAgICAgICAgb3JkZXJWYWx1ZXNbaV0sCiAgICAgICAgICAgICAgICBzYWZlU3ViKGZpbGxUYWtlclRva2VuQW1vdW50LCBmaWxsZWRUYWtlclRva2VuQW1vdW50KSwKICAgICAgICAgICAgICAgIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UsCiAgICAgICAgICAgICAgICB2W2ldLAogICAgICAgICAgICAgICAgcltpXSwKICAgICAgICAgICAgICAgIHNbaV0KICAgICAgICAgICAgKSk7CiAgICAgICAgICAgIGlmIChmaWxsZWRUYWtlclRva2VuQW1vdW50ID09IGZpbGxUYWtlclRva2VuQW1vdW50KSBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpbGxlZFRha2VyVG9rZW5BbW91bnQ7CiAgICB9CgogICAgLy8vIEBkZXYgU3luY2hyb25vdXNseSBjYW5jZWxzIG11bHRpcGxlIG9yZGVycyBpbiBhIHNpbmdsZSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzcyBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIGFkZHJlc3Nlcy4KICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2YgdWludCBhcnJheXMgY29udGFpbmluZyBpbmRpdmlkdWFsIG9yZGVyIHZhbHVlcy4KICAgIC8vLyBAcGFyYW0gY2FuY2VsVGFrZXJUb2tlbkFtb3VudHMgQXJyYXkgb2YgZGVzaXJlZCBhbW91bnRzIG9mIHRha2VyVG9rZW4gdG8gY2FuY2VsIGluIG9yZGVycy4KICAgIGZ1bmN0aW9uIGJhdGNoQ2FuY2VsT3JkZXJzKAogICAgICAgIGFkZHJlc3NbNV1bXSBvcmRlckFkZHJlc3NlcywKICAgICAgICB1aW50WzZdW10gb3JkZXJWYWx1ZXMsCiAgICAgICAgdWludFtdIGNhbmNlbFRha2VyVG9rZW5BbW91bnRzKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG9yZGVyQWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNhbmNlbE9yZGVyKAogICAgICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbaV0sCiAgICAgICAgICAgICAgICBvcmRlclZhbHVlc1tpXSwKICAgICAgICAgICAgICAgIGNhbmNlbFRha2VyVG9rZW5BbW91bnRzW2ldCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAqIENvbnN0YW50IHB1YmxpYyBmdW5jdGlvbnMKICAgICovCgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyBLZWNjYWstMjU2IGhhc2ggb2Ygb3JkZXIgd2l0aCBzcGVjaWZpZWQgcGFyYW1ldGVycy4KICAgIC8vLyBAcGFyYW0gb3JkZXJBZGRyZXNzZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlciwgdGFrZXIsIG1ha2VyVG9rZW4sIHRha2VyVG9rZW4sIGFuZCBmZWVSZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXJUb2tlbkFtb3VudCwgdGFrZXJUb2tlbkFtb3VudCwgbWFrZXJGZWUsIHRha2VyRmVlLCBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWMsIGFuZCBzYWx0LgogICAgLy8vIEByZXR1cm4gS2VjY2FrLTI1NiBoYXNoIG9mIG9yZGVyLgogICAgZnVuY3Rpb24gZ2V0T3JkZXJIYXNoKGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsIHVpbnRbNl0gb3JkZXJWYWx1ZXMpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoCiAgICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzWzBdLCAvLyBtYWtlcgogICAgICAgICAgICBvcmRlckFkZHJlc3Nlc1sxXSwgLy8gdGFrZXIKICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbMl0sIC8vIG1ha2VyVG9rZW4KICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbM10sIC8vIHRha2VyVG9rZW4KICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbNF0sIC8vIGZlZVJlY2lwaWVudAogICAgICAgICAgICBvcmRlclZhbHVlc1swXSwgICAgLy8gbWFrZXJUb2tlbkFtb3VudAogICAgICAgICAgICBvcmRlclZhbHVlc1sxXSwgICAgLy8gdGFrZXJUb2tlbkFtb3VudAogICAgICAgICAgICBvcmRlclZhbHVlc1syXSwgICAgLy8gbWFrZXJGZWUKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbM10sICAgIC8vIHRha2VyRmVlCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzRdLCAgICAvLyBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWMKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbNV0gICAgIC8vIHNhbHQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IFZlcmlmaWVzIHRoYXQgYW4gb3JkZXIgc2lnbmF0dXJlIGlzIHZhbGlkLgogICAgLy8vIEBwYXJhbSBzaWduZXIgYWRkcmVzcyBvZiBzaWduZXIuCiAgICAvLy8gQHBhcmFtIGhhc2ggU2lnbmVkIEtlY2Nhay0yNTYgaGFzaC4KICAgIC8vLyBAcGFyYW0gdiBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgICAvLy8gQHBhcmFtIHIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgLy8vIEByZXR1cm4gVmFsaWRpdHkgb2Ygb3JkZXIgc2lnbmF0dXJlLgogICAgZnVuY3Rpb24gaXNWYWxpZFNpZ25hdHVyZSgKICAgICAgICBhZGRyZXNzIHNpZ25lciwKICAgICAgICBieXRlczMyIGhhc2gsCiAgICAgICAgdWludDggdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gc2lnbmVyID09IGVjcmVjb3ZlcigKICAgICAgICAgICAga2VjY2FrMjU2KCJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiIsIGhhc2gpLAogICAgICAgICAgICB2LAogICAgICAgICAgICByLAogICAgICAgICAgICBzCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgcm91bmRpbmcgZXJyb3IgPiAwLjElLgogICAgLy8vIEBwYXJhbSBudW1lcmF0b3IgTnVtZXJhdG9yLgogICAgLy8vIEBwYXJhbSBkZW5vbWluYXRvciBEZW5vbWluYXRvci4KICAgIC8vLyBAcGFyYW0gdGFyZ2V0IFZhbHVlIHRvIG11bHRpcGx5IHdpdGggbnVtZXJhdG9yL2Rlbm9taW5hdG9yLgogICAgLy8vIEByZXR1cm4gUm91bmRpbmcgZXJyb3IgaXMgcHJlc2VudC4KICAgIGZ1bmN0aW9uIGlzUm91bmRpbmdFcnJvcih1aW50IG51bWVyYXRvciwgdWludCBkZW5vbWluYXRvciwgdWludCB0YXJnZXQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgcmVtYWluZGVyID0gbXVsbW9kKHRhcmdldCwgbnVtZXJhdG9yLCBkZW5vbWluYXRvcik7CiAgICAgICAgaWYgKHJlbWFpbmRlciA9PSAwKSByZXR1cm4gZmFsc2U7IC8vIE5vIHJvdW5kaW5nIGVycm9yLgoKICAgICAgICB1aW50IGVyclBlcmNlbnRhZ2VUaW1lczEwMDAwMDAgPSBzYWZlRGl2KAogICAgICAgICAgICBzYWZlTXVsKHJlbWFpbmRlciwgMTAwMDAwMCksCiAgICAgICAgICAgIHNhZmVNdWwobnVtZXJhdG9yLCB0YXJnZXQpCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gZXJyUGVyY2VudGFnZVRpbWVzMTAwMDAwMCA+IDEwMDA7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyBwYXJ0aWFsIHZhbHVlIGdpdmVuIGEgbnVtZXJhdG9yIGFuZCBkZW5vbWluYXRvci4KICAgIC8vLyBAcGFyYW0gbnVtZXJhdG9yIE51bWVyYXRvci4KICAgIC8vLyBAcGFyYW0gZGVub21pbmF0b3IgRGVub21pbmF0b3IuCiAgICAvLy8gQHBhcmFtIHRhcmdldCBWYWx1ZSB0byBjYWxjdWxhdGUgcGFydGlhbCBvZi4KICAgIC8vLyBAcmV0dXJuIFBhcnRpYWwgdmFsdWUgb2YgdGFyZ2V0LgogICAgZnVuY3Rpb24gZ2V0UGFydGlhbEFtb3VudCh1aW50IG51bWVyYXRvciwgdWludCBkZW5vbWluYXRvciwgdWludCB0YXJnZXQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBzYWZlRGl2KHNhZmVNdWwobnVtZXJhdG9yLCB0YXJnZXQpLCBkZW5vbWluYXRvcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgc3VtIG9mIHZhbHVlcyBhbHJlYWR5IGZpbGxlZCBhbmQgY2FuY2VsbGVkIGZvciBhIGdpdmVuIG9yZGVyLgogICAgLy8vIEBwYXJhbSBvcmRlckhhc2ggVGhlIEtlY2Nhay0yNTYgaGFzaCBvZiB0aGUgZ2l2ZW4gb3JkZXIuCiAgICAvLy8gQHJldHVybiBTdW0gb2YgdmFsdWVzIGFscmVhZHkgZmlsbGVkIGFuZCBjYW5jZWxsZWQuCiAgICBmdW5jdGlvbiBnZXRVbmF2YWlsYWJsZVRha2VyVG9rZW5BbW91bnQoYnl0ZXMzMiBvcmRlckhhc2gpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBzYWZlQWRkKGZpbGxlZFtvcmRlckhhc2hdLCBjYW5jZWxsZWRbb3JkZXJIYXNoXSk7CiAgICB9CgoKICAgIC8qCiAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgKi8KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYSB0b2tlbiB1c2luZyBUb2tlblRyYW5zZmVyUHJveHkgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uLgogICAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRva2VuIHRvIHRyYW5zZmVyRnJvbS4KICAgIC8vLyBAcGFyYW0gZnJvbSBBZGRyZXNzIHRyYW5zZmVyaW5nIHRva2VuLgogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIHJlY2VpdmluZyB0b2tlbi4KICAgIC8vLyBAcGFyYW0gdmFsdWUgQW1vdW50IG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgLy8vIEByZXR1cm4gU3VjY2VzcyBvZiB0b2tlbiB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVmlhVG9rZW5UcmFuc2ZlclByb3h5KAogICAgICAgIGFkZHJlc3MgdG9rZW4sCiAgICAgICAgYWRkcmVzcyBmcm9tLAogICAgICAgIGFkZHJlc3MgdG8sCiAgICAgICAgdWludCB2YWx1ZSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIFRva2VuVHJhbnNmZXJQcm94eShUT0tFTl9UUkFOU0ZFUl9QUk9YWV9DT05UUkFDVCkudHJhbnNmZXJGcm9tKHRva2VuLCBmcm9tLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhbnkgb3JkZXIgdHJhbnNmZXJzIHdpbGwgZmFpbC4KICAgIC8vLyBAcGFyYW0gb3JkZXIgT3JkZXIgc3RydWN0IG9mIHBhcmFtcyB0aGF0IHdpbGwgYmUgY2hlY2tlZC4KICAgIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsLgogICAgLy8vIEByZXR1cm4gUHJlZGljdGVkIHJlc3VsdCBvZiB0cmFuc2ZlcnMuCiAgICBmdW5jdGlvbiBpc1RyYW5zZmVyYWJsZShPcmRlciBvcmRlciwgdWludCBmaWxsVGFrZXJUb2tlbkFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50ICAvLyBUaGUgY2FsbGVkIHRva2VuIGNvbnRyYWN0cyBtYXkgYXR0ZW1wdCB0byBjaGFuZ2Ugc3RhdGUsIGJ1dCB3aWxsIG5vdCBiZSBhYmxlIHRvIGR1ZSB0byBnYXMgbGltaXRzIG9uIGdldEJhbGFuY2UgYW5kIGdldEFsbG93YW5jZS4KICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFkZHJlc3MgdGFrZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQgZmlsbE1ha2VyVG9rZW5BbW91bnQgPSBnZXRQYXJ0aWFsQW1vdW50KGZpbGxUYWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlclRva2VuQW1vdW50LCBvcmRlci5tYWtlclRva2VuQW1vdW50KTsKCiAgICAgICAgaWYgKG9yZGVyLmZlZVJlY2lwaWVudCAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGJvb2wgaXNNYWtlclRva2VuWlJYID0gb3JkZXIubWFrZXJUb2tlbiA9PSBaUlhfVE9LRU5fQ09OVFJBQ1Q7CiAgICAgICAgICAgIGJvb2wgaXNUYWtlclRva2VuWlJYID0gb3JkZXIudGFrZXJUb2tlbiA9PSBaUlhfVE9LRU5fQ09OVFJBQ1Q7CiAgICAgICAgICAgIHVpbnQgcGFpZE1ha2VyRmVlID0gZ2V0UGFydGlhbEFtb3VudChmaWxsVGFrZXJUb2tlbkFtb3VudCwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCwgb3JkZXIubWFrZXJGZWUpOwogICAgICAgICAgICB1aW50IHBhaWRUYWtlckZlZSA9IGdldFBhcnRpYWxBbW91bnQoZmlsbFRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyRmVlKTsKICAgICAgICAgICAgdWludCByZXF1aXJlZE1ha2VyWlJYID0gaXNNYWtlclRva2VuWlJYID8gc2FmZUFkZChmaWxsTWFrZXJUb2tlbkFtb3VudCwgcGFpZE1ha2VyRmVlKSA6IHBhaWRNYWtlckZlZTsKICAgICAgICAgICAgdWludCByZXF1aXJlZFRha2VyWlJYID0gaXNUYWtlclRva2VuWlJYID8gc2FmZUFkZChmaWxsVGFrZXJUb2tlbkFtb3VudCwgcGFpZFRha2VyRmVlKSA6IHBhaWRUYWtlckZlZTsKCiAgICAgICAgICAgIGlmICggICBnZXRCYWxhbmNlKFpSWF9UT0tFTl9DT05UUkFDVCwgb3JkZXIubWFrZXIpIDwgcmVxdWlyZWRNYWtlclpSWAogICAgICAgICAgICAgICAgfHwgZ2V0QWxsb3dhbmNlKFpSWF9UT0tFTl9DT05UUkFDVCwgb3JkZXIubWFrZXIpIDwgcmVxdWlyZWRNYWtlclpSWAogICAgICAgICAgICAgICAgfHwgZ2V0QmFsYW5jZShaUlhfVE9LRU5fQ09OVFJBQ1QsIHRha2VyKSA8IHJlcXVpcmVkVGFrZXJaUlgKICAgICAgICAgICAgICAgIHx8IGdldEFsbG93YW5jZShaUlhfVE9LRU5fQ09OVFJBQ1QsIHRha2VyKSA8IHJlcXVpcmVkVGFrZXJaUlgKICAgICAgICAgICAgKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICBpZiAoIWlzTWFrZXJUb2tlblpSWCAmJiAoICAgZ2V0QmFsYW5jZShvcmRlci5tYWtlclRva2VuLCBvcmRlci5tYWtlcikgPCBmaWxsTWFrZXJUb2tlbkFtb3VudCAvLyBEb24ndCBkb3VibGUgY2hlY2sgbWFrZXJUb2tlbiBpZiBaUlgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IGdldEFsbG93YW5jZShvcmRlci5tYWtlclRva2VuLCBvcmRlci5tYWtlcikgPCBmaWxsTWFrZXJUb2tlbkFtb3VudCkKICAgICAgICAgICAgKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghaXNUYWtlclRva2VuWlJYICYmICggICBnZXRCYWxhbmNlKG9yZGVyLnRha2VyVG9rZW4sIHRha2VyKSA8IGZpbGxUYWtlclRva2VuQW1vdW50IC8vIERvbid0IGRvdWJsZSBjaGVjayB0YWtlclRva2VuIGlmIFpSWAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgZ2V0QWxsb3dhbmNlKG9yZGVyLnRha2VyVG9rZW4sIHRha2VyKSA8IGZpbGxUYWtlclRva2VuQW1vdW50KQogICAgICAgICAgICApIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKCAgIGdldEJhbGFuY2Uob3JkZXIubWFrZXJUb2tlbiwgb3JkZXIubWFrZXIpIDwgZmlsbE1ha2VyVG9rZW5BbW91bnQKICAgICAgICAgICAgICAgICAgIHx8IGdldEFsbG93YW5jZShvcmRlci5tYWtlclRva2VuLCBvcmRlci5tYWtlcikgPCBmaWxsTWFrZXJUb2tlbkFtb3VudAogICAgICAgICAgICAgICAgICAgfHwgZ2V0QmFsYW5jZShvcmRlci50YWtlclRva2VuLCB0YWtlcikgPCBmaWxsVGFrZXJUb2tlbkFtb3VudAogICAgICAgICAgICAgICAgICAgfHwgZ2V0QWxsb3dhbmNlKG9yZGVyLnRha2VyVG9rZW4sIHRha2VyKSA8IGZpbGxUYWtlclRva2VuQW1vdW50CiAgICAgICAgKSByZXR1cm4gZmFsc2U7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEdldCB0b2tlbiBiYWxhbmNlIG9mIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4uCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIuCiAgICAvLy8gQHJldHVybiBUb2tlbiBiYWxhbmNlIG9mIG93bmVyLgogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZShhZGRyZXNzIHRva2VuLCBhZGRyZXNzIG93bmVyKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQgIC8vIFRoZSBjYWxsZWQgdG9rZW4gY29udHJhY3QgbWF5IGF0dGVtcHQgdG8gY2hhbmdlIHN0YXRlLCBidXQgd2lsbCBub3QgYmUgYWJsZSB0byBkdWUgdG8gYW4gYWRkZWQgZ2FzIGxpbWl0LgogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIFRva2VuKHRva2VuKS5iYWxhbmNlT2YuZ2FzKEVYVEVSTkFMX1FVRVJZX0dBU19MSU1JVCkob3duZXIpOyAvLyBMaW1pdCBnYXMgdG8gcHJldmVudCByZWVudHJhbmN5CiAgICB9CgogICAgLy8vIEBkZXYgR2V0IGFsbG93YW5jZSBvZiB0b2tlbiBnaXZlbiB0byBUb2tlblRyYW5zZmVyUHJveHkgYnkgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdG9rZW4gQWRkcmVzcyBvZiB0b2tlbi4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAgIC8vLyBAcmV0dXJuIEFsbG93YW5jZSBvZiB0b2tlbiBnaXZlbiB0byBUb2tlblRyYW5zZmVyUHJveHkgYnkgb3duZXIuCiAgICBmdW5jdGlvbiBnZXRBbGxvd2FuY2UoYWRkcmVzcyB0b2tlbiwgYWRkcmVzcyBvd25lcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50ICAvLyBUaGUgY2FsbGVkIHRva2VuIGNvbnRyYWN0IG1heSBhdHRlbXB0IHRvIGNoYW5nZSBzdGF0ZSwgYnV0IHdpbGwgbm90IGJlIGFibGUgdG8gZHVlIHRvIGFuIGFkZGVkIGdhcyBsaW1pdC4KICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBUb2tlbih0b2tlbikuYWxsb3dhbmNlLmdhcyhFWFRFUk5BTF9RVUVSWV9HQVNfTElNSVQpKG93bmVyLCBUT0tFTl9UUkFOU0ZFUl9QUk9YWV9DT05UUkFDVCk7IC8vIExpbWl0IGdhcyB0byBwcmV2ZW50IHJlZW50cmFuY3kKICAgIH0KfQ=='.
	

]
