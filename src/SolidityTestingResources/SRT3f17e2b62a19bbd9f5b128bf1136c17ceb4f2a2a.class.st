Class {
	#name : #SRT3f17e2b62a19bbd9f5b128bf1136c17ceb4f2a2a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3f17e2b62a19bbd9f5b128bf1136c17ceb4f2a2a >> base64 [
	^ 'LyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKLyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYiB7CgogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEpOwogICAgcmV0dXJuIGM7CiAgfQoKfQoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCi8qKgogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLgogKi8KY29udHJhY3QgUHJpY2luZ1N0cmF0ZWd5IHsKCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8KICBmdW5jdGlvbiBpc1ByaWNpbmdTdHJhdGVneSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0LgogICAqCiAgICogQ2hlY2tzIHRoYXQgcHJpY2luZyBzdHJhdGVneSBtYXRjaGVzIGNyb3dkc2FsZSBwYXJhbWV0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBQcmljaW5nIHRlbGxzIGlmIHRoaXMgaXMgYSBwcmVzYWxlIHB1cmNoYXNlIG9yIG5vdC4KICAgICBAcGFyYW0gcHVyY2hhc2VyIEFkZHJlc3Mgb2YgdGhlIHB1cmNoYXNlcgogICAgIEByZXR1cm4gRmFsc2UgYnkgZGVmYXVsdCwgdHJ1ZSBpZiBhIHByZXNhbGUgcHVyY2hhc2VyCiAgICovCiAgZnVuY3Rpb24gaXNQcmVzYWxlUHVyY2hhc2UoYWRkcmVzcyBwdXJjaGFzZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0LgogICAqCiAgICoKICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkKICAgKiBAcGFyYW0gdG9rZW5zU29sZCAtIGhvdyBtdWNoIHRva2VucyBoYXZlIGJlZW4gc29sZCB0aGlzIGZhcgogICAqIEBwYXJhbSB3ZWlSYWlzZWQgLSBob3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgdGhpcyBmYXIgaW4gdGhlIG1haW4gdG9rZW4gc2FsZSAtIHRoaXMgbnVtYmVyIGV4Y2x1ZGVzIHByZXNhbGUKICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIGRlY2ltYWxzIC0gaG93IG1hbnkgZGVjaW1hbCB1bml0cyB0aGUgdG9rZW4gaGFzCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgd2VpUmFpc2VkLCB1aW50IHRva2Vuc1NvbGQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCB0b2tlbkFtb3VudCk7CgogIGZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuY2hlVm9sdW1lKHVpbnQgdG9rZW5zU29sZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKLyoqCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuCiAqCiAqIC0gQWxsb2NhdGUgdG9rZW5zIGZvciBmb3VuZGVycywgYm91bnRpZXMgYW5kIGNvbW11bml0eQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQogKiAtIGV0Yy4KICovCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgewoKICBmdW5jdGlvbiBpc0ZpbmFsaXplQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuCiAgICoKICAgKiBUaGlzIGlzIGEgc2FmZXR5IGNoZWNrIGZ1bmN0aW9uIHRoYXQgZG9lc24ndCBhbGxvdyBjcm93ZHNhbGUgdG8gYmVnaW4KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKTsKCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuCiAqLwpjb250cmFjdCBGcmFjdGlvbmFsRVJDMjAgaXMgRVJDMjAgewoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsgICAgICAKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qCiAqIEhhbHRhYmxlCiAqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICovCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgewogIGJvb2wgcHVibGljIGhhbHRlZDsKCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIHN0b3BOb25Pd25lcnNJbkVtZXJnZW5jeSB7CiAgICBpZiAoaGFsdGVkICYmIG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICB9Cgp9CgoKCgoKCgovKioKICogQ3Jvd2RzYWxlIHN0YXRlIG1hY2hpbmUgd2l0aG91dCBidXkgZnVuY3Rpb25hbGl0eS4KICoKICogSW1wbGVtZW50cyBiYXNpYyBzdGF0ZSBtYWNoaW5lIGxvZ2ljLCBidXQgbGVhdmVzIG91dCBhbGwgYnV5IGZ1bmN0aW9ucywKICogc28gdGhhdCBzdWJjbGFzc2VzIGNhbiBpbXBsZW1lbnQgdGhlaXIgb3duIGJ1eWluZyBsb2dpYy4KICoKICoKICogRm9yIHRoZSBkZWZhdWx0IGJ1eSgpIGltcGxlbWVudGF0aW9uIHNlZSBDcm93ZHNhbGUuc29sLgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlQmFzZSBpcyBIYWx0YWJsZSB7CgogIC8qIE1heCBpbnZlc3RtZW50IGNvdW50IHdoZW4gd2UgYXJlIHN0aWxsIGFsbG93ZWQgdG8gY2hhbmdlIHRoZSBtdWx0aXNpZyBhZGRyZXNzICovCiAgdWludCBwdWJsaWMgTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UgPSA1OwoKICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsKCiAgLyogVGhlIHRva2VuIHdlIGFyZSBzZWxsaW5nICovCiAgRnJhY3Rpb25hbEVSQzIwIHB1YmxpYyB0b2tlbjsKCiAgLyogSG93IHdlIGFyZSBnb2luZyB0byBwcmljZSBvdXIgb2ZmZXJpbmcgKi8KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsKCiAgLyogUG9zdC1zdWNjZXNzIGNhbGxiYWNrICovCiAgRmluYWxpemVBZ2VudCBwdWJsaWMgZmluYWxpemVBZ2VudDsKCiAgLyogdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJlZCBmcm9tIHRoaXMgYWRkcmVzcyAqLwogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0OwoKICAvKiBpZiB0aGUgZnVuZGluZyBnb2FsIGlzIG5vdCByZWFjaGVkLCBpbnZlc3RvcnMgbWF5IHdpdGhkcmF3IHRoZWlyIGZ1bmRzICovCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOwoKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgc3RhcnQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7CgogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBlbmQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwoKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAvKiBDYWxjdWxhdGUgaW5jb21pbmcgZnVuZHMgZnJvbSBwcmVzYWxlIGNvbnRyYWN0cyBhbmQgYWRkcmVzc2VzICovCiAgdWludCBwdWJsaWMgcHJlc2FsZVdlaVJhaXNlZCA9IDA7CgogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOwoKICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLwogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwoKICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gcGFydGljaXBhdGUgYXQgYW55IHN0YWdlICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNLeWNXaGl0ZWxpc3Q7CgogIC8qKiBBZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBjYWxsIGF1dG9tYXRlZCBtYW5hZ2VtZW50IGZ1bmN0aW9ucyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzTWFuYWdlbWVudDsKCiAgLyoqIE1pbmltdW0gbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBpbiBhIHRyYW5jaGUgKHByb3RlY3RzIGFnYWluc3QgbGFyZ2UgcHVyY2hhc2VzIGJyZWFraW5nIHRyYW5jaGUgYmFycmllcnMgYnkgdG9vIG11Y2ggKi8KICB1aW50IHB1YmxpYyB0cmFuY2hlTWluVHggPSAwOwoKICAvKiogTWF4aW11bSB0aGF0IGFueSBzaW5nbGUgYWRkcmVzcyBjYW4gcHVyY2hhc2UgKDEgLyBtYXggKiB0b3RhbFN1cHBseSkgKi8KICB1aW50IHB1YmxpYyBtYXhpbXVtUHVyY2hhc2VGcmFjdGlvbiA9IDA7CgogIC8qKiBUaGlzIGlzIGZvciBtYW51bCB0ZXN0aW5nIGZvciB0aGUgaW50ZXJhY3Rpb24gZnJvbSBvd25lciB3YWxsZXQuIFlvdSBjYW4gc2V0IGl0IHRvIGFueSB2YWx1ZSBhbmQgaW5zcGVjdCB0aGlzIGluIGJsb2NrY2hhaW4gZXhwbG9yZXIgdG8gc2VlIHRoYXQgY3Jvd2RzYWxlIGludGVyYWN0aW9uIHdvcmtzLiAqLwogIHVpbnQgcHVibGljIG93bmVyVGVzdFZhbHVlOwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldAogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcGFzc2VkIHN0YXJ0IHRpbWUgeWV0CiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkCiAgICogLSBGYWlsdXJlOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBub3QgcmVhY2hlZCBiZWZvcmUgZW5kaW5nIHRpbWUKICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplZCBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVwYXJpbmcsIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmUsIEZpbmFsaXplZCwgUmVmdW5kaW5nfQoKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CgogIC8vIFJlZnVuZCB3YXMgcHJvY2Vzc2VkIGZvciBhIGNvbnRyaWJ1dG9yCiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsKCiAgLy8gVGhlIHJ1bGVzIHdlcmUgY2hhbmdlZCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0CiAgZXZlbnQgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQoYm9vbCBuZXdSZXF1aXJlQ3VzdG9tZXJJZCwgYm9vbCBuZXdSZXF1aXJlZFNpZ25lZEFkZHJlc3MsIGFkZHJlc3MgbmV3U2lnbmVyQWRkcmVzcyk7CgogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKICBldmVudCBLeWNXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKICBldmVudCBNYW5hZ2VtZW50V2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IG5ld0VuZHNBdCk7CgogIFN0YXRlIHB1YmxpYyB0ZXN0U3RhdGU7CgogIG1vZGlmaWVyIG9ubHlXaGl0ZWxpc3QoKSB7CiAgICByZXF1aXJlKGlzS3ljV2hpdGVsaXN0W21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQogIG1vZGlmaWVyIG9ubHlNYW5hZ2VtZW50KCkgewogICAgcmVxdWlyZShpc01hbmFnZW1lbnRbbXNnLnNlbmRlcl0pOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIENyb3dkc2FsZUJhc2UoYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSB7CgogICAgb3duZXIgPSBtc2cuc2VuZGVyOwoKICAgIHRva2VuID0gRnJhY3Rpb25hbEVSQzIwKF90b2tlbik7CgogICAgc2V0UHJpY2luZ1N0cmF0ZWd5KF9wcmljaW5nU3RyYXRlZ3kpOwoKICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0OwogICAgaWYobXVsdGlzaWdXYWxsZXQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIGlmKF9zdGFydCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgc3RhcnRzQXQgPSBfc3RhcnQ7CgogICAgaWYoX2VuZCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgZW5kc0F0ID0gX2VuZDsKCiAgICAvLyBEb24ndCBtZXNzIHRoZSBkYXRlcwogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgY2FuIGJlIHplcm8KICAgIG1pbmltdW1GdW5kaW5nR29hbCA9IF9taW5pbXVtRnVuZGluZ0dvYWw7CiAgfQoKICAvKioKICAgKiBEb24ndCBleHBlY3QgdG8ganVzdCBzZW5kIGluIG1vbmV5IGFuZCBnZXQgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICB0aHJvdzsKICB9CgogIC8qKgogICAqIFdoaXRlbGlzdCBtYW5lZ2VtZW50CiAgICovCiAgZnVuY3Rpb24gc2V0S3ljV2hpdGVsaXN0KGFkZHJlc3MgX2FkZHJlc3MsIGJvb2wgX3N0YXRlKSBwdWJsaWMgb25seU1hbmFnZW1lbnQgewogICAgaXNLeWNXaGl0ZWxpc3RbX2FkZHJlc3NdID0gX3N0YXRlOwogICAgS3ljV2hpdGVsaXN0ZWQoX2FkZHJlc3MsIF9zdGF0ZSk7CiAgfQogIC8qKgogICAqIE1hbmFnZW1lbnQgbGlzdCBtYW5lZ2VtZW50CiAgICovCiAgZnVuY3Rpb24gc2V0TWFuYWdlbWVudChhZGRyZXNzIF9hZGRyZXNzLCBib29sIF9zdGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICBpc01hbmFnZW1lbnRbX2FkZHJlc3NdID0gX3N0YXRlOwogICAgTWFuYWdlbWVudFdoaXRlbGlzdGVkKF9hZGRyZXNzLCBfc3RhdGUpOwogIH0KCiAgLyoqCiAgICogVHJhbmNoZSBUWCBtaW5pbXVtcwogICAqLwogIGZ1bmN0aW9uIHNldFRyYW5jaGVNaW5UeCh1aW50IF9taW5pbXVtKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHRyYW5jaGVNaW5UeCA9IF9taW5pbXVtOwogIH0KCiAgLyoqCiAgICogVG90YWwgYWxsb3dhYmxlIHB1cmNoYXNlIG9mIHRva2VucyBwZXIgYWRkcmVzcwogICAqLwogIGZ1bmN0aW9uIHNldE1heGltdW1QdXJjaGFzZUZyYWN0aW9uKHVpbnQgX21heGltdW0pIHB1YmxpYyBvbmx5T3duZXIgewogICAgbWF4aW11bVB1cmNoYXNlRnJhY3Rpb24gPSBfbWF4aW11bTsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIENyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuCiAgICoKICAgKiBAcGFyYW0gcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlJwogICAqCiAgICogQHJldHVybiB0b2tlbkFtb3VudCBIb3cgbW9ueSB0b2tlbnMgd2VyZSBib3VnaHQKICAgKi8KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBvbmx5V2hpdGVsaXN0IGludGVybmFsIHJldHVybnModWludCB0b2tlbnNCb3VnaHQpIHsKCiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgaWYoIWVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbcmVjZWl2ZXJdKSB7CiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgIH0gZWxzZSBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpIHsKICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nCiAgICAgIC8vIHBhc3MKICAgIH0gZWxzZSB7CiAgICAgIC8vIFVud2FudGVkIHN0YXRlCiAgICAgIHRocm93OwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgIC8vIEFjY291bnQgcHJlc2FsZSBzYWxlcyBzZXBhcmF0ZWx5LCBzbyB0aGF0IHRoZXkgZG8gbm90IGNvdW50IGFnYWluc3QgcHJpY2luZyB0cmFuY2hlcwogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCAtIHByZXNhbGVXZWlSYWlzZWQsIHRva2Vuc1NvbGQsIG1zZy5zZW5kZXIsIHRva2VuLmRlY2ltYWxzKCkpOwoKICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CgogICAgLy8gQ2hlY2sgdGhhdCB0aGUgdHggaXMgYSByZWFzb25hYmxlIHZvbHVtZSBmb3IgdGhlIHRyYW5jaGUKICAgIGlmICh0cmFuY2hlTWluVHggPiAwKSB7CiAgICAgIHVpbnQgdHJhbmNoZVZvbHVtZSA9IHByaWNpbmdTdHJhdGVneS5nZXRDdXJyZW50VHJhbmNoZVZvbHVtZSh0b2tlbnNTb2xkKTsKICAgICAgdWludCBtYXhWb2x1bWUgPSB0cmFuY2hlVm9sdW1lIC8gdHJhbmNoZU1pblR4OwogICAgICByZXF1aXJlKHRva2VuQW1vdW50IDw9IG1heFZvbHVtZSk7CiAgICB9CgogICAgaWYobWF4aW11bVB1cmNoYXNlRnJhY3Rpb24gPiAwKSB7CiAgICAgIHVpbnQyNTYgbWF4aW11bVB1cmNoYXNlID0gdG9rZW4udG90YWxTdXBwbHkoKSAvIG1heGltdW1QdXJjaGFzZUZyYWN0aW9uOwogICAgICB1aW50MjU2IHdpbGxIYXZlVG9rZW5zID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gKyB0b2tlbkFtb3VudDsKICAgICAgcmVxdWlyZSh3aWxsSGF2ZVRva2VucyA8PSBtYXhpbXVtUHVyY2hhc2UpOwogICAgfQoKICAgIGlmKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsKICAgICAgIC8vIEEgbmV3IGludmVzdG9yCiAgICAgICBpbnZlc3RvckNvdW50Kys7CiAgICB9CgogICAgLy8gVXBkYXRlIGludmVzdG9yCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7CgogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwoKICAgIGlmKHByaWNpbmdTdHJhdGVneS5pc1ByZXNhbGVQdXJjaGFzZShyZWNlaXZlcikpIHsKICAgICAgICBwcmVzYWxlV2VpUmFpc2VkID0gcHJlc2FsZVdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7CiAgICB9CgogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgcmVxdWlyZSghaXNCcmVha2luZ0NhcCh3ZWlBbW91bnQsIHRva2VuQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKTsKCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5LCBvciBmYWlsIHRoZSBjcm93ZHNhbGUgaWYgd2UgZm9yIHNvbWUgcmVhc29uIGNhbm5vdCBzZW5kIHRoZSBtb25leSB0byBvdXIgbXVsdGlzaWcKICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93OwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CgogICAgcmV0dXJuIHRva2VuQW1vdW50OwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewoKICAgIC8vIEFscmVhZHkgZmluYWxpemVkCiAgICBpZihmaW5hbGl6ZWQpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuCiAgICBpZihhZGRyZXNzKGZpbmFsaXplQWdlbnQpICE9IDApIHsKICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOwogICAgfQoKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50LgogICAqCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIG9ubHlPd25lciB7CiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoKICAgKiAtIGFmdGVyIFggYW1vdW50IGlzIHJlYWNoZWQgZGV0ZXJtaW5lIG1hbnVhbCBjbG9zaW5nCiAgICoKICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLAogICAqIGJ1dCB3ZSB0cnVzdCBvd25lcnMga25vdyB3aGF0IHRoZXkgYXJlIGRvaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsKCiAgICBpZihub3cgPiB0aW1lKSB7CiAgICAgIHRocm93OyAvLyBEb24ndCBjaGFuZ2UgcGFzdAogICAgfQoKICAgIGlmKHN0YXJ0c0F0ID4gdGltZSkgewogICAgICB0aHJvdzsgLy8gUHJldmVudCBodW1hbiBtaXN0YWtlcwogICAgfQoKICAgIGVuZHNBdCA9IHRpbWU7CiAgICBFbmRzQXRDaGFuZ2VkKGVuZHNBdCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgewogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIXByaWNpbmdTdHJhdGVneS5pc1ByaWNpbmdTdHJhdGVneSgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gY2hhbmdlIHRoZSB0ZWFtIG11bHRpc2lnIGFkZHJlc3MgaW4gdGhlIGNhc2Ugb2YgZW1lcmdlbmN5LgogICAqCiAgICogVGhpcyBhbGxvd3MgdG8gc2F2ZSBhIGRlcGxveWVkIGNyb3dkc2FsZSB3YWxsZXQgaW4gdGhlIGNhc2UgdGhlIGNyb3dkc2FsZSBoYXMgbm90IHlldCBiZWd1bgogICAqICh3ZSBoYXZlIGRvbmUgb25seSBmZXcgdGVzdCB0cmFuc2FjdGlvbnMpLiBBZnRlciB0aGUgY3Jvd2RzYWxlIGlzIGdvaW5nCiAgICogdGhlbiBtdWx0aXNpZyBhZGRyZXNzIHN0YXlzIGxvY2tlZCBmb3IgdGhlIHNhZmV0eSByZWFzb25zLgogICAqLwogIGZ1bmN0aW9uIHNldE11bHRpc2lnKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlPd25lciB7CgogICAgLy8gQ2hhbmdlCiAgICBpZihpbnZlc3RvckNvdW50ID4gTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLgogICAqCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uCiAgICovCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgewogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93OwogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsKICB9CgogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqCiAgICogTm90ZSB0aGF0IGFueSByZWZ1bmRzIGZyb20gcHJveHkgYnV5ZXJzIHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHksCiAgICogYW5kIG5vdCB0aHJvdWdoIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsKICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsKICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOwogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsKICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7CiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93OwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGlzTWluaW11bUdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmVhY2hlZCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5pbXVtRnVuZGluZ0dvYWw7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZXJTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgewogICAgcmV0dXJuIGZpbmFsaXplQWdlbnQuaXNTYW5lKCk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOwogIH0KCiAgLyoqCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4KICAgKgogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsKICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIHdlaVJhaXNlZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IHdlaVJhaXNlZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7CiAgfQoKICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgbXVsdGlzaWcgd2FsbGV0IGludGVyYWN0aW9uICovCiAgZnVuY3Rpb24gc2V0T3duZXJUZXN0VmFsdWUodWludCB2YWwpIG9ubHlPd25lciB7CiAgICBvd25lclRlc3RWYWx1ZSA9IHZhbDsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqCiAgICogVE9ETzogRml4IHNwZWxsaW5nIGVycm9yIGluIHRoZSBuYW1lCiAgICovCiAgZnVuY3Rpb24gc2V0RWFybHlQYXJpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIG9ubHlPd25lciB7CiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOwogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsKICB9CgoKICAvKiogSW50ZXJmYWNlIG1hcmtlci4gKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93OwogICAgXzsKICB9CgoKICAvLwogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucwogIC8vCgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLgogICAqCiAgICoKICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLgogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkKICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4KICAgKgogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgb3IgdHJhbnNmZXIgaXNzdWVkIHRva2VucyB0byB0aGUgaW52ZXN0b3IgZGVwZW5kaW5nIG9uIHRoZSBjYXAgbW9kZWwuCiAgICovCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIGludGVybmFsOwp9CgoKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcyB3aXRoIHRoZSBkZWZhdWx0IGJ1eSBlbnRyeSBwb2ludHMuCiAqCiAqIEhhbmRsZQogKiAtIHN0YXJ0IGFuZCBlbmQgZGF0ZXMKICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMKICogLSBtaW5pbXVtIGZ1bmRpbmcgZ29hbCBhbmQgcmVmdW5kCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcwogKiAtIGRpZmZlcmVudCBpbnZlc3RtZW50IHBvbGljaWVzIChyZXF1aXJlIHNlcnZlciBzaWRlIGN1c3RvbWVyIGlkLCBhbGxvdyBvbmx5IHdoaXRlbGlzdGVkIGFkZHJlc3NlcykKICoKICogRG9lcyBub3QgSGFuZGxlCiAqCiAqIC0gVG9rZW4gYWxsb2NhdGlvbiAobWludGluZyB2cy4gdHJhbnNmZXIpCiAqIC0gQ2FwIHJ1bGVzCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlQmFzZSB7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsKCiAgLyoqCiAgICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGF2ZSBhY2NlcHRlZCB0ZXJtcyBvbiBzYWxlIChvbiB0aGUgd2ViKS4KICAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzOwoKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSBDcm93ZHNhbGVCYXNlKF90b2tlbiwgX3ByaWNpbmdTdHJhdGVneSwgX211bHRpc2lnV2FsbGV0LCBfc3RhcnQsIF9lbmQsIF9taW5pbXVtRnVuZGluZ0dvYWwpIHsKICB9CgogIC8qKgogICAqIFByZWFsbG9jYXRlIHRva2VucyBmb3IgdGhlIGVhcmx5IGludmVzdG9ycy4KICAgKgogICAqIFByZWFsbG9jYXRlZCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgYmVmb3JlIHRoZSBhY3R1YWwgY3Jvd2RzYWxlIG9wZW5zLgogICAqIFRoaXMgZnVuY3Rpb24gbWludHMgdGhlIHRva2VucyBhbmQgbW92ZXMgdGhlIGNyb3dkc2FsZSBuZWVkbGUuCiAgICoKICAgKiBJbnZlc3RvciBjb3VudCBpcyBub3QgaGFuZGxlZDsgaXQgaXMgYXNzdW1lZCB0aGlzIGdvZXMgZm9yIG11bHRpcGxlIGludmVzdG9ycwogICAqIGFuZCB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGhhcHBlbnMgb3V0c2lkZSB0aGUgc21hcnQgY29udHJhY3QgZmxvdy4KICAgKgogICAqIE5vIG1vbmV5IGlzIGV4Y2hhbmdlZCwgYXMgdGhlIGNyb3dkc2FsZSB0ZWFtIGFscmVhZHkgaGF2ZSByZWNlaXZlZCB0aGUgcGF5bWVudC4KICAgKgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFkZGVkIGludGVybmFsbHkKICAgKiBAcGFyYW0gd2VpUHJpY2UgUHJpY2Ugb2YgYSBzaW5nbGUgZnVsbCB0b2tlbiBpbiB3ZWkKICAgKgogICAqLwogIGZ1bmN0aW9uIHByZWFsbG9jYXRlKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgZnVsbFRva2VucywgdWludCB3ZWlQcmljZSkgcHVibGljIG9ubHlPd25lciB7CgogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMgKiAxMCoqdG9rZW4uZGVjaW1hbHMoKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UgKiBmdWxsVG9rZW5zOyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsKCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7CgogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CgogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCAwKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsKICAgICBpZiAoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpICE9IHNpZ25lckFkZHJlc3MpIHRocm93OwogICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aWNpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbAogICAgaWYocmVxdWlyZWRTaWduZWRBZGRyZXNzKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIGFsbG93cyBvbmx5IHNlcnZlci1zaWRlIHNpZ25lZCBwYXJ0aWNpcGFudHMKICAgIGludmVzdEludGVybmFsKGFkZHIsIDApOwogIH0KCiAgLyoqCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllciBhbmQgY2xlYXIgaGlzIGFkZHJlc3MuCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoU2lnbmVkQWRkcmVzcyh1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsKICB9CgogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZFdpdGhDaGVja3N1bSh1aW50MTI4IGN1c3RvbWVySWQsIGJ5dGVzMSBjaGVja3N1bSkgcHVibGljIHBheWFibGUgewogICAgLy8gc2VlIGN1c3RvbWVyaWQucHkKICAgIGlmIChieXRlczEoc2hhMyhjdXN0b21lcklkKSkgIT0gY2hlY2tzdW0pIHRocm93OwogICAgaW52ZXN0V2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBMZWdhY3kgQVBJIHNpZ25hdHVyZS4KICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSBzZW5kZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3QobXNnLnNlbmRlcik7CiAgfQogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICBidXkoKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgb25seU93bmVyIHsKICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBfc2lnbmVyQWRkcmVzczsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCgoKLyoqCiAqIERlZmluZSBpbnRlcmZhY2UgZm9yIHJlbGVhc2luZyB0aGUgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICovCmNvbnRyYWN0IFJlbGVhc2FibGVUb2tlbiBpcyBFUkMyMCwgT3duYWJsZSB7CgogIC8qIFRoZSBmaW5hbGl6ZXIgY29udHJhY3QgdGhhdCBhbGxvd3MgdW5saWZ0IHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLwogIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKCiAgLyoqIEEgY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiByZWxlYXNlIHVzIHRvIHRoZSB3aWxkIGlmIElDTyBzdWNjZXNzLiBJZiBmYWxzZSB3ZSBhcmUgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLiovCiAgYm9vbCBwdWJsaWMgcmVsZWFzZWQgPSBmYWxzZTsKCiAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB0cmFuc2ZlckFnZW50czsKCiAgLyoqCiAgICogTGltaXQgdG9rZW4gdHJhbnNmZXIgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAqCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyKSB7CgogICAgaWYoIXJlbGVhc2VkKSB7CiAgICAgICAgaWYoIXRyYW5zZmVyQWdlbnRzW19zZW5kZXJdKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgIH0KCiAgICBfOwogIH0KCiAgLyoqCiAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgKgogICAqIERlc2lnbiBjaG9pY2UuIEFsbG93IHJlc2V0IHRoZSByZWxlYXNlIGFnZW50IHRvIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLgogICAqLwogIGZ1bmN0aW9uIHNldFJlbGVhc2VBZ2VudChhZGRyZXNzIGFkZHIpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKCiAgICAvLyBXZSBkb24ndCBkbyBpbnRlcmZhY2UgY2hlY2sgaGVyZSBhcyB3ZSBtaWdodCB3YW50IHRvIGEgbm9ybWFsIHdhbGxldCBhZGRyZXNzIHRvIGFjdCBhcyBhIHJlbGVhc2UgYWdlbnQKICAgIHJlbGVhc2VBZ2VudCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGEgY3Jvd2RzYWxlIGNvbnRyYWN0KSB0byB0cmFuc2ZlciB0b2tlbnMgZGVzcGl0ZSB0aGUgbG9jayB1cCBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKICAgIHRyYW5zZmVyQWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgfQoKICAvKioKICAgKiBPbmUgd2F5IGZ1bmN0aW9uIHRvIHJlbGVhc2UgdGhlIHRva2VucyB0byB0aGUgd2lsZC4KICAgKgogICAqIENhbiBiZSBjYWxsZWQgb25seSBmcm9tIHRoZSByZWxlYXNlIGFnZW50IHRoYXQgaXMgdGhlIGZpbmFsIElDTyBjb250cmFjdC4gSXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBzdWNjZXNzIChmaXJzdCBtaWxlc3RvbmUgcmVhY2hlZCkuCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICByZWxlYXNlZCA9IHRydWU7CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHRva2VucyBoYXZlIGJlZW4gcmVsZWFzZXNkICovCiAgbW9kaWZpZXIgaW5SZWxlYXNlU3RhdGUoYm9vbCByZWxlYXNlU3RhdGUpIHsKICAgIGlmKHJlbGVhc2VTdGF0ZSAhPSByZWxlYXNlZCkgewogICAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGEgd2hpdGVsaXN0ZWQgcmVsZWFzZSBhZ2VudC4gKi8KICBtb2RpZmllciBvbmx5UmVsZWFzZUFnZW50KCkgewogICAgaWYobXNnLnNlbmRlciAhPSByZWxlYXNlQWdlbnQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKF9mcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlckZvcm0oKQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCn0KCgovKioKICogVGhlIGRlZmF1bHQgYmVoYXZpb3IgZm9yIHRoZSBjcm93ZHNhbGUgZW5kLgogKgogKiBVbmxvY2sgdG9rZW5zLgogKi8KY29udHJhY3QgRGVmYXVsdEZpbmFsaXplQWdlbnQgaXMgRmluYWxpemVBZ2VudCB7CgogIFJlbGVhc2FibGVUb2tlbiBwdWJsaWMgdG9rZW47CiAgQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGU7CgogIGZ1bmN0aW9uIERlZmF1bHRGaW5hbGl6ZUFnZW50KFJlbGVhc2FibGVUb2tlbiBfdG9rZW4sIENyb3dkc2FsZSBfY3Jvd2RzYWxlKSB7CiAgICB0b2tlbiA9IF90b2tlbjsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgfQoKICAvKiogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVsZWFzZSB0aGUgdG9rZW4gKi8KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuICh0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICB9CgogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHB1YmxpYyB7CiAgICBpZihtc2cuc2VuZGVyICE9IGFkZHJlc3MoY3Jvd2RzYWxlKSkgewogICAgICB0aHJvdzsKICAgIH0KICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKfQ=='.
	

]
