Class {
	#name : #SRT635a47a32f02c6ddf6fc623132429eeebd70a2a8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT635a47a32f02c6ddf6fc623132429eeebd70a2a8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCmNvbnRyYWN0IEVJUDgyMEltcGxlbWVudGVySW50ZXJmYWNlIHsKICAgIC8vLyBAbm90aWNlIENvbnRyYWN0cyB0aGF0IGltcGxlbWVudCBhbiBpbnRlcmZlcmNlIGluIGJlaGFsZiBvZiBhbm90aGVyIGNvbnRyYWN0IG11c3QgcmV0dXJuIHRydWUKICAgIC8vLyBAcGFyYW0gYWRkciBBZGRyZXNzIHRoYXQgdGhlIGNvbnRyYWN0IHdvbGwgaW1wbGVtZW50IHRoZSBpbnRlcmZhY2UgaW4gYmVoYWxmIG9mCiAgICAvLy8gQHBhcmFtIGludGVyZmFjZUhhc2gga2VjY2FrMjU2IG9mIHRoZSBuYW1lIG9mIHRoZSBpbnRlcmZhY2UKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIGNvbnRyYWN0IGNhbiBpbXBsZW1lbnQgdGhlIGludGVyZmFjZSByZXByZXNlbnRlZCBieQogICAgLy8vICBgJiMyMzY7bnRlcmZhY2VIYXNoYCBpbiBiZWhhbGYgb2YgYGFkZHJgCiAgICBmdW5jdGlvbiBjYW5JbXBsZW1lbnRJbnRlcmZhY2VGb3JBZGRyZXNzKGFkZHJlc3MgYWRkciwgYnl0ZXMzMiBpbnRlcmZhY2VIYXNoKSB2aWV3IHB1YmxpYyByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBFSVA4MjBSZWdpc3RyeSB7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nKGJ5dGVzMzIgPT4gYWRkcmVzcykpIGludGVyZmFjZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGFkZHJlc3MpIG1hbmFnZXJzOwoKICAgIG1vZGlmaWVyIGNhbk1hbmFnZShhZGRyZXNzIGFkZHIpIHsKICAgICAgICByZXF1aXJlKGdldE1hbmFnZXIoYWRkcikgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBRdWVyeSB0aGUgaGFzaCBvZiBhbiBpbnRlcmZhY2UgZ2l2ZW4gYSBuYW1lCiAgICAvLy8gQHBhcmFtIGludGVyZmFjZU5hbWUgTmFtZSBvZiB0aGUgaW50ZXJmY2UKICAgIGZ1bmN0aW9uIGludGVyZmFjZUhhc2goc3RyaW5nIGludGVyZmFjZU5hbWUpIHB1YmxpYyBwdXJlIHJldHVybnMoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoaW50ZXJmYWNlTmFtZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0TWFuYWdlcgogICAgZnVuY3Rpb24gZ2V0TWFuYWdlcihhZGRyZXNzIGFkZHIpIHB1YmxpYyB2aWV3IHJldHVybnMoYWRkcmVzcykgewogICAgICAgIC8vIEJ5IGRlZmF1bHQgdGhlIG1hbmFnZXIgb2YgYW4gYWRkcmVzcyBpcyB0aGUgc2FtZSBhZGRyZXNzCiAgICAgICAgaWYgKG1hbmFnZXJzW2FkZHJdID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGFkZHI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG1hbmFnZXJzW2FkZHJdOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXRzIGFuIGV4dGVybmFsIGBtYW5hZ2VyYCB0aGF0IHdpbGwgYmUgYWJsZSB0byBjYWxsIGBzZXRJbnRlcmZhY2VJbXBsZW1lbnRlcigpYAogICAgLy8vICBvbiBiZWhhbGYgb2YgdGhlIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIGFkZHIgQWRkcmVzcyB0aGF0IHlvdSBhcmUgZGVmaW5pbmcgdGhlIG1hbmFnZXIgZm9yLgogICAgLy8vIEBwYXJhbSBuZXdNYW5hZ2VyIFRoZSBhZGRyZXNzIG9mIHRoZSBtYW5hZ2VyIGZvciB0aGUgYGFkZHJgIHRoYXQgd2lsbCByZXBsYWNlCiAgICAvLy8gIHRoZSBvbGQgb25lLiAgU2V0IHRvIDB4MCBpZiB5b3Ugd2FudCB0byByZW1vdmUgdGhlIG1hbmFnZXIuCiAgICBmdW5jdGlvbiBzZXRNYW5hZ2VyKGFkZHJlc3MgYWRkciwgYWRkcmVzcyBuZXdNYW5hZ2VyKSBwdWJsaWMgY2FuTWFuYWdlKGFkZHIpIHsKICAgICAgICBtYW5hZ2Vyc1thZGRyXSA9IG5ld01hbmFnZXIgPT0gYWRkciA/IDAgOiBuZXdNYW5hZ2VyOwogICAgICAgIE1hbmFnZXJDaGFuZ2VkKGFkZHIsIG5ld01hbmFnZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFF1ZXJ5IGlmIGFuIGFkZHJlc3MgaW1wbGVtZW50cyBhbiBpbnRlcmZhY2UgYW5kIHRocnUgd2hpY2ggY29udHJhY3QKICAgIC8vLyBAcGFyYW0gYWRkciBBZGRyZXNzIHRoYXQgaXMgYmVpbmcgcXVlcmllZCBmb3IgdGhlIGltcGxlbWVudGF0aW9uIG9mIGFuIGludGVyZmFjZQogICAgLy8vIEBwYXJhbSBpSGFzaCBTSEEzIG9mIHRoZSBuYW1lIG9mIHRoZSBpbnRlcmZhY2UgYXMgYSBzdHJpbmcKICAgIC8vLyAgRXhhbXBsZSBgd2ViMy51dGlscy5zaGEzKCdJZXJjNzc3YCcpYAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRoYXQgaW1wbGVtZW50cyBhIHNwZWZpY2ljIGludGVyZmFjZQogICAgLy8vICBvciAweDAgaWYgYGFkZHJgIGRvZXMgbm90IGltcGxlbWVudCB0aGlzIGludGVyZmFjZQogICAgZnVuY3Rpb24gZ2V0SW50ZXJmYWNlSW1wbGVtZW50ZXIoYWRkcmVzcyBhZGRyLCBieXRlczMyIGlIYXNoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBpbnRlcmZhY2VzW2FkZHJdW2lIYXNoXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXRzIHRoZSBjb250cmFjdCB0aGF0IHdpbGwgaGFuZGxlIGEgc3BlY2lmaWMgaW50ZXJmYWNlOyBvbmx5CiAgICAvLy8gIHRoZSBhZGRyZXNzIGl0c2VsZiBvciBhIGBtYW5hZ2VyYCBkZWZpbmVkIGZvciB0aGF0IGFkZHJlc3MgY2FuIHNldCBpdAogICAgLy8vIEBwYXJhbSBhZGRyIEFkZHJlc3MgdGhhdCB5b3Ugd2FudCB0byBkZWZpbmUgdGhlIGludGVyZmFjZSBmb3IKICAgIC8vLyBAcGFyYW0gaUhhc2ggU0hBMyBvZiB0aGUgbmFtZSBvZiB0aGUgaW50ZXJmYWNlIGFzIGEgc3RyaW5nCiAgICAvLy8gIEZvciBleGFtcGxlIGB3ZWIzLnV0aWxzLnNoYTMoJ0llcmM3NzcnKWAgZm9yIHRoZSBJZXJjNzc3CiAgICBmdW5jdGlvbiBzZXRJbnRlcmZhY2VJbXBsZW1lbnRlcihhZGRyZXNzIGFkZHIsIGJ5dGVzMzIgaUhhc2gsIGFkZHJlc3MgaW1wbGVtZW50ZXIpIHB1YmxpYyBjYW5NYW5hZ2UoYWRkcikgIHsKICAgICAgICBpZiAoKGltcGxlbWVudGVyICE9IDApICYmIChpbXBsZW1lbnRlciE9bXNnLnNlbmRlcikpIHsKICAgICAgICAgICAgcmVxdWlyZShFSVA4MjBJbXBsZW1lbnRlckludGVyZmFjZShpbXBsZW1lbnRlcikuY2FuSW1wbGVtZW50SW50ZXJmYWNlRm9yQWRkcmVzcyhhZGRyLCBpSGFzaCkpOwogICAgICAgIH0KICAgICAgICBpbnRlcmZhY2VzW2FkZHJdW2lIYXNoXSA9IGltcGxlbWVudGVyOwogICAgICAgIEludGVyZmFjZUltcGxlbWVudGVyU2V0KGFkZHIsIGlIYXNoLCBpbXBsZW1lbnRlcik7CiAgICB9CgogICAgZXZlbnQgSW50ZXJmYWNlSW1wbGVtZW50ZXJTZXQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIGJ5dGVzMzIgaW5kZXhlZCBpbnRlcmZhY2VIYXNoLCBhZGRyZXNzIGluZGV4ZWQgaW1wbGVtZW50ZXIpOwogICAgZXZlbnQgTWFuYWdlckNoYW5nZWQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIGFkZHJlc3MgaW5kZXhlZCBuZXdNYW5hZ2VyKTsKfQoKY29udHJhY3QgRUlQODIwSW1wbGVtZW50ZXIgewogICAgRUlQODIwUmVnaXN0cnkgZWlwODIwUmVnaXN0cnkgPSBFSVA4MjBSZWdpc3RyeSgweDlhQTUxM2YxMjk0YzhmMUIyNTRiQTExODg5OTFCNGNjMkVGRTFEM0IpOwoKICAgIGZ1bmN0aW9uIHNldEludGVyZmFjZUltcGxlbWVudGF0aW9uKHN0cmluZyBpZmFjZUxhYmVsLCBhZGRyZXNzIGltcGwpIGludGVybmFsIHsKICAgICAgICBieXRlczMyIGlmYWNlSGFzaCA9IGtlY2NhazI1NihpZmFjZUxhYmVsKTsKICAgICAgICBlaXA4MjBSZWdpc3RyeS5zZXRJbnRlcmZhY2VJbXBsZW1lbnRlcih0aGlzLCBpZmFjZUhhc2gsIGltcGwpOwogICAgfQoKICAgIGZ1bmN0aW9uIGludGVyZmFjZUFkZHIoYWRkcmVzcyBhZGRyLCBzdHJpbmcgaWZhY2VMYWJlbCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiBpZmFjZUhhc2ggPSBrZWNjYWsyNTYoaWZhY2VMYWJlbCk7CiAgICAgICAgcmV0dXJuIGVpcDgyMFJlZ2lzdHJ5LmdldEludGVyZmFjZUltcGxlbWVudGVyKGFkZHIsIGlmYWNlSGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsZWdhdGVNYW5hZ2VtZW50KGFkZHJlc3MgbmV3TWFuYWdlcikgaW50ZXJuYWwgewogICAgICAgIGVpcDgyMFJlZ2lzdHJ5LnNldE1hbmFnZXIodGhpcywgbmV3TWFuYWdlcik7CiAgICB9Cgp9CgoKCmNvbnRyYWN0IEFzc2V0UmVnaXN0cnlTdG9yYWdlIHsKCiAgc3RyaW5nIGludGVybmFsIF9uYW1lOwogIHN0cmluZyBpbnRlcm5hbCBfc3ltYm9sOwogIHN0cmluZyBpbnRlcm5hbCBfZGVzY3JpcHRpb247CgogIC8qKgogICAqIFN0b3JlcyB0aGUgdG90YWwgY291bnQgb2YgYXNzZXRzIG1hbmFnZWQgYnkgdGhpcyByZWdpc3RyeQogICAqLwogIHVpbnQyNTYgaW50ZXJuYWwgX2NvdW50OwoKICAvKioKICAgKiBTdG9yZXMgYW4gYXJyYXkgb2YgYXNzZXRzIG93bmVkIGJ5IGEgZ2l2ZW4gYWNjb3VudAogICAqLwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2W10pIGludGVybmFsIF9hc3NldHNPZjsKCiAgLyoqCiAgICogU3RvcmVzIHRoZSBjdXJyZW50IGhvbGRlciBvZiBhbiBhc3NldAogICAqLwogIG1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBpbnRlcm5hbCBfaG9sZGVyT2Y7CgogIC8qKgogICAqIFN0b3JlcyB0aGUgaW5kZXggb2YgYW4gYXNzZXQgaW4gdGhlIGBfYXNzZXRzT2ZgIGFycmF5IG9mIGl0cyBob2xkZXIKICAgKi8KICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgaW50ZXJuYWwgX2luZGV4T2ZBc3NldDsKCiAgLyoqCiAgICogU3RvcmVzIHRoZSBkYXRhIGFzc29jaWF0ZWQgd2l0aCBhbiBhc3NldAogICAqLwogIG1hcHBpbmcodWludDI1NiA9PiBzdHJpbmcpIGludGVybmFsIF9hc3NldERhdGE7CgogIC8qKgogICAqIEZvciBhIGdpdmVuIGFjY291bnQsIGZvciBhIGdpdmVuIG9wZXJhdG9yLCBzdG9yZSB3aGV0aGVyIHRoYXQgb3BlcmF0b3IgaXMKICAgKiBhbGxvd2VkIHRvIHRyYW5zZmVyIGFuZCBtb2RpZnkgYXNzZXRzIG9uIGJlaGFsZiBvZiB0aGVtLgogICAqLwogIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkpIGludGVybmFsIF9vcGVyYXRvcnM7CgogIC8qKgogICAqIFNpbXBsZSByZWVudHJhbmN5IGxvY2sKICAgKi8KICBib29sIGludGVybmFsIF9yZWVudHJhbmN5OwoKICAvKioKICAgKiBDb21wbGV4IHJlZW50cmFuY3kgbG9jawogICAqLwogIHVpbnQyNTYgaW50ZXJuYWwgX3JlZW50cmFuY3lDb3VudDsKCiAgLyoqCiAgICogQXBwcm92YWwgYXJyYXkKICAgKi8KICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgaW50ZXJuYWwgX2FwcHJvdmFsOwp9CgoKaW50ZXJmYWNlIElBc3NldEhvbGRlciB7CiAgZnVuY3Rpb24gb25Bc3NldFJlY2VpdmVkKAogICAgLyogYWRkcmVzcyBfYXNzZXRSZWdpc3RyeSA9PSBtc2cuc2VuZGVyICovCiAgICB1aW50MjU2IF9hc3NldElkLAogICAgYWRkcmVzcyBfcHJldmlvdXNIb2xkZXIsCiAgICBhZGRyZXNzIF9jdXJyZW50SG9sZGVyLAogICAgYnl0ZXMgICBfdXNlckRhdGEsCiAgICBhZGRyZXNzIF9vcGVyYXRvciwKICAgIGJ5dGVzICAgX29wZXJhdG9yRGF0YQogICkgcHVibGljOwp9CgoKaW50ZXJmYWNlIElBc3NldFJlZ2lzdHJ5IHsKCiAgLyoqCiAgICogR2xvYmFsIFJlZ2lzdHJ5IGdldHRlciBmdW5jdGlvbnMKICAgKi8KICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpOwogIGZ1bmN0aW9uIGRlc2NyaXB0aW9uKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CgogIGZ1bmN0aW9uIGlzRVJDODIxKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogIC8qKgogICAqIEFzc2V0LWNlbnRyaWMgZ2V0dGVyIGZ1bmN0aW9ucwogICAqLwogIGZ1bmN0aW9uIGV4aXN0cyh1aW50MjU2IGFzc2V0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKICBmdW5jdGlvbiBob2xkZXJPZih1aW50MjU2IGFzc2V0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBhc3NldElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKCiAgZnVuY3Rpb24gc2FmZUhvbGRlck9mKHVpbnQyNTYgYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgZnVuY3Rpb24gc2FmZU93bmVyT2YodWludDI1NiBhc3NldElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKCiAgZnVuY3Rpb24gYXNzZXREYXRhKHVpbnQyNTYgYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICBmdW5jdGlvbiBzYWZlQXNzZXREYXRhKHVpbnQyNTYgYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKCiAgLyoqCiAgICogSG9sZGVyLWNlbnRyaWMgZ2V0dGVyIGZ1bmN0aW9ucwogICAqLwogIGZ1bmN0aW9uIGFzc2V0Q291bnQoYWRkcmVzcyBob2xkZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGhvbGRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CgogIGZ1bmN0aW9uIGFzc2V0QnlJbmRleChhZGRyZXNzIGhvbGRlciwgdWludDI1NiBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYXNzZXRzT2YoYWRkcmVzcyBob2xkZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdKTsKCiAgLyoqCiAgICogVHJhbnNmZXIgT3BlcmF0aW9ucwogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgYXNzZXRJZCkgcHVibGljOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgYXNzZXRJZCwgYnl0ZXMgdXNlckRhdGEpIHB1YmxpYzsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGFzc2V0SWQsIGJ5dGVzIHVzZXJEYXRhLCBieXRlcyBvcGVyYXRvckRhdGEpIHB1YmxpYzsKCiAgLyoqCiAgICogQXV0aG9yaXphdGlvbiBvcGVyYXRpb25zCiAgICovCiAgZnVuY3Rpb24gYXV0aG9yaXplT3BlcmF0b3IoYWRkcmVzcyBvcGVyYXRvciwgYm9vbCBhdXRob3JpemVkKSBwdWJsaWM7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIG9wZXJhdG9yLCB1aW50MjU2IGFzc2V0SWQpIHB1YmxpYzsKCiAgLyoqCiAgICogQXV0aG9yaXphdGlvbiBnZXR0ZXJzCiAgICovCiAgZnVuY3Rpb24gaXNPcGVyYXRvckF1dGhvcml6ZWRCeShhZGRyZXNzIG9wZXJhdG9yLCBhZGRyZXNzIGFzc2V0SG9sZGVyKQogICAgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogIGZ1bmN0aW9uIGFwcHJvdmVkRm9yKHVpbnQyNTYgYXNzZXRJZCkKICAgIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yKGFkZHJlc3Mgb3BlcmF0b3IsIHVpbnQyNTYgYXNzZXRJZCkKICAgIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKICAvKioKICAgKiBFdmVudHMKICAgKi8KICBldmVudCBUcmFuc2ZlcigKICAgIGFkZHJlc3MgaW5kZXhlZCBmcm9tLAogICAgYWRkcmVzcyBpbmRleGVkIHRvLAogICAgdWludDI1NiBpbmRleGVkIGFzc2V0SWQsCiAgICBhZGRyZXNzIG9wZXJhdG9yLAogICAgYnl0ZXMgdXNlckRhdGEsCiAgICBieXRlcyBvcGVyYXRvckRhdGEKICApOwogIGV2ZW50IFVwZGF0ZSgKICAgIHVpbnQyNTYgaW5kZXhlZCBhc3NldElkLAogICAgYWRkcmVzcyBpbmRleGVkIGhvbGRlciwKICAgIGFkZHJlc3MgaW5kZXhlZCBvcGVyYXRvciwKICAgIHN0cmluZyBkYXRhCiAgKTsKICBldmVudCBBdXRob3JpemVPcGVyYXRvcigKICAgIGFkZHJlc3MgaW5kZXhlZCBvcGVyYXRvciwKICAgIGFkZHJlc3MgaW5kZXhlZCBob2xkZXIsCiAgICBib29sIGF1dGhvcml6ZWQKICApOwogIGV2ZW50IEFwcHJvdmUoCiAgICBhZGRyZXNzIGluZGV4ZWQgb3duZXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgb3BlcmF0b3IsCiAgICB1aW50MjU2IGluZGV4ZWQgYXNzZXRJZAogICk7Cn0KCgpjb250cmFjdCBTdGFuZGFyZEFzc2V0UmVnaXN0cnkgaXMgQXNzZXRSZWdpc3RyeVN0b3JhZ2UsIElBc3NldFJlZ2lzdHJ5LCBFSVA4MjBJbXBsZW1lbnRlciB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vCiAgLy8gR2xvYmFsIEdldHRlcnMKICAvLwoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gX25hbWU7CiAgfQoKICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiBfc3ltYm9sOwogIH0KCiAgZnVuY3Rpb24gZGVzY3JpcHRpb24oKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiBfZGVzY3JpcHRpb247CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBfY291bnQ7CiAgfQoKICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiAwOwogIH0KCiAgZnVuY3Rpb24gaXNFUkM4MjEoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vCiAgLy8gQXNzZXQtY2VudHJpYyBnZXR0ZXIgZnVuY3Rpb25zCiAgLy8KCiAgZnVuY3Rpb24gZXhpc3RzKHVpbnQyNTYgYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIF9ob2xkZXJPZlthc3NldElkXSAhPSAwOwogIH0KCiAgZnVuY3Rpb24gaG9sZGVyT2YodWludDI1NiBhc3NldElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gX2hvbGRlck9mW2Fzc2V0SWRdOwogIH0KCiAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IGFzc2V0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIC8vIEl0J3MgT0sgdG8gYmUgaW5lZmZpY2llbnQgaGVyZSwgYXMgdGhpcyBtZXRob2QgaXMgZm9yIGNvbXBhdGliaWxpdHkuCiAgICAvLyBVc2VycyBzaG91bGQgY2FsbCBgaG9sZGVyT2ZgCiAgICByZXR1cm4gaG9sZGVyT2YoYXNzZXRJZCk7CiAgfQoKICBmdW5jdGlvbiBzYWZlSG9sZGVyT2YodWludDI1NiBhc3NldElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICBhZGRyZXNzIGhvbGRlciA9IF9ob2xkZXJPZlthc3NldElkXTsKICAgIHJlcXVpcmUoaG9sZGVyICE9IDApOwogICAgcmV0dXJuIGhvbGRlcjsKICB9CgogIGZ1bmN0aW9uIHNhZmVPd25lck9mKHVpbnQyNTYgYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgcmV0dXJuIHNhZmVIb2xkZXJPZihhc3NldElkKTsKICB9CgogIGZ1bmN0aW9uIGFzc2V0RGF0YSh1aW50MjU2IGFzc2V0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIF9hc3NldERhdGFbYXNzZXRJZF07CiAgfQoKICBmdW5jdGlvbiBzYWZlQXNzZXREYXRhKHVpbnQyNTYgYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXF1aXJlKF9ob2xkZXJPZlthc3NldElkXSAhPSAwKTsKICAgIHJldHVybiBfYXNzZXREYXRhW2Fzc2V0SWRdOwogIH0KCiAgLy8KICAvLyBIb2xkZXItY2VudHJpYyBnZXR0ZXIgZnVuY3Rpb25zCiAgLy8KCiAgZnVuY3Rpb24gYXNzZXRDb3VudChhZGRyZXNzIGhvbGRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIF9hc3NldHNPZltob2xkZXJdLmxlbmd0aDsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGhvbGRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFzc2V0Q291bnQoaG9sZGVyKTsKICB9CgogIGZ1bmN0aW9uIGFzc2V0QnlJbmRleChhZGRyZXNzIGhvbGRlciwgdWludDI1NiBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmVxdWlyZShpbmRleCA8IF9hc3NldHNPZltob2xkZXJdLmxlbmd0aCk7CiAgICByZXF1aXJlKGluZGV4IDwgKDE8PDEyNykpOwogICAgcmV0dXJuIF9hc3NldHNPZltob2xkZXJdW2luZGV4XTsKICB9CgogIGZ1bmN0aW9uIGFzc2V0c09mKGFkZHJlc3MgaG9sZGVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSkgewogICAgcmV0dXJuIF9hc3NldHNPZltob2xkZXJdOwogIH0KCiAgLy8KICAvLyBBdXRob3JpemF0aW9uIGdldHRlcnMKICAvLwoKICBmdW5jdGlvbiBpc09wZXJhdG9yQXV0aG9yaXplZEJ5KGFkZHJlc3Mgb3BlcmF0b3IsIGFkZHJlc3MgYXNzZXRIb2xkZXIpCiAgICBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiBfb3BlcmF0b3JzW2Fzc2V0SG9sZGVyXVtvcGVyYXRvcl07CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlZEZvcih1aW50MjU2IGFzc2V0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBfYXBwcm92YWxbYXNzZXRJZF07CiAgfQoKICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yKGFkZHJlc3Mgb3BlcmF0b3IsIHVpbnQyNTYgYXNzZXRJZCkKICAgIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShvcGVyYXRvciAhPSAwKTsKICAgIGlmIChvcGVyYXRvciA9PSBob2xkZXJPZihhc3NldElkKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBfYXBwcm92YWxbYXNzZXRJZF0gPT0gb3BlcmF0b3I7CiAgfQoKICAvLwogIC8vIEF1dGhvcml6YXRpb24KICAvLwoKICBmdW5jdGlvbiBhdXRob3JpemVPcGVyYXRvcihhZGRyZXNzIG9wZXJhdG9yLCBib29sIGF1dGhvcml6ZWQpIHB1YmxpYyB7CiAgICBpZiAoYXV0aG9yaXplZCkgewogICAgICByZXF1aXJlKCFpc09wZXJhdG9yQXV0aG9yaXplZEJ5KG9wZXJhdG9yLCBtc2cuc2VuZGVyKSk7CiAgICAgIF9hZGRBdXRob3JpemF0aW9uKG9wZXJhdG9yLCBtc2cuc2VuZGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlcXVpcmUoaXNPcGVyYXRvckF1dGhvcml6ZWRCeShvcGVyYXRvciwgbXNnLnNlbmRlcikpOwogICAgICBfY2xlYXJBdXRob3JpemF0aW9uKG9wZXJhdG9yLCBtc2cuc2VuZGVyKTsKICAgIH0KICAgIEF1dGhvcml6ZU9wZXJhdG9yKG9wZXJhdG9yLCBtc2cuc2VuZGVyLCBhdXRob3JpemVkKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBvcGVyYXRvciwgdWludDI1NiBhc3NldElkKSBwdWJsaWMgewogICAgYWRkcmVzcyBob2xkZXIgPSBob2xkZXJPZihhc3NldElkKTsKICAgIHJlcXVpcmUob3BlcmF0b3IgIT0gaG9sZGVyKTsKICAgIGlmIChhcHByb3ZlZEZvcihhc3NldElkKSAhPSBvcGVyYXRvcikgewogICAgICBfYXBwcm92YWxbYXNzZXRJZF0gPSBvcGVyYXRvcjsKICAgICAgQXBwcm92ZShob2xkZXIsIG9wZXJhdG9yLCBhc3NldElkKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9hZGRBdXRob3JpemF0aW9uKGFkZHJlc3Mgb3BlcmF0b3IsIGFkZHJlc3MgaG9sZGVyKSBwcml2YXRlIHsKICAgIF9vcGVyYXRvcnNbaG9sZGVyXVtvcGVyYXRvcl0gPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gX2NsZWFyQXV0aG9yaXphdGlvbihhZGRyZXNzIG9wZXJhdG9yLCBhZGRyZXNzIGhvbGRlcikgcHJpdmF0ZSB7CiAgICBfb3BlcmF0b3JzW2hvbGRlcl1bb3BlcmF0b3JdID0gZmFsc2U7CiAgfQoKICAvLwogIC8vIEludGVybmFsIE9wZXJhdGlvbnMKICAvLwoKICBmdW5jdGlvbiBfYWRkQXNzZXRUbyhhZGRyZXNzIHRvLCB1aW50MjU2IGFzc2V0SWQpIGludGVybmFsIHsKICAgIF9ob2xkZXJPZlthc3NldElkXSA9IHRvOwoKICAgIHVpbnQyNTYgbGVuZ3RoID0gYXNzZXRDb3VudCh0byk7CgogICAgX2Fzc2V0c09mW3RvXS5wdXNoKGFzc2V0SWQpOwoKICAgIF9pbmRleE9mQXNzZXRbYXNzZXRJZF0gPSBsZW5ndGg7CgogICAgX2NvdW50ID0gX2NvdW50LmFkZCgxKTsKICB9CgogIGZ1bmN0aW9uIF9hZGRBc3NldFRvKGFkZHJlc3MgdG8sIHVpbnQyNTYgYXNzZXRJZCwgc3RyaW5nIGRhdGEpIGludGVybmFsIHsKICAgIF9hZGRBc3NldFRvKHRvLCBhc3NldElkKTsKCiAgICBfYXNzZXREYXRhW2Fzc2V0SWRdID0gZGF0YTsKICB9CgogIGZ1bmN0aW9uIF9yZW1vdmVBc3NldEZyb20oYWRkcmVzcyBmcm9tLCB1aW50MjU2IGFzc2V0SWQpIGludGVybmFsIHsKICAgIHVpbnQyNTYgYXNzZXRJbmRleCA9IF9pbmRleE9mQXNzZXRbYXNzZXRJZF07CiAgICB1aW50MjU2IGxhc3RBc3NldEluZGV4ID0gYXNzZXRDb3VudChmcm9tKS5zdWIoMSk7CiAgICB1aW50MjU2IGxhc3RBc3NldElkID0gX2Fzc2V0c09mW2Zyb21dW2xhc3RBc3NldEluZGV4XTsKCiAgICBfaG9sZGVyT2ZbYXNzZXRJZF0gPSAwOwoKICAgIC8vIEluc2VydCB0aGUgbGFzdCBhc3NldCBpbnRvIHRoZSBwb3NpdGlvbiBwcmV2aW91c2x5IG9jY3VwaWVkIGJ5IHRoZSBhc3NldCB0byBiZSByZW1vdmVkCiAgICBfYXNzZXRzT2ZbZnJvbV1bYXNzZXRJbmRleF0gPSBsYXN0QXNzZXRJZDsKCiAgICAvLyBSZXNpemUgdGhlIGFycmF5CiAgICBfYXNzZXRzT2ZbZnJvbV1bbGFzdEFzc2V0SW5kZXhdID0gMDsKICAgIF9hc3NldHNPZltmcm9tXS5sZW5ndGgtLTsKCiAgICAvLyBSZW1vdmUgdGhlIGFycmF5IGlmIG5vIG1vcmUgYXNzZXRzIGFyZSBvd25lZCB0byBwcmV2ZW50IHBvbGx1dGlvbgogICAgaWYgKF9hc3NldHNPZltmcm9tXS5sZW5ndGggPT0gMCkgewogICAgICBkZWxldGUgX2Fzc2V0c09mW2Zyb21dOwogICAgfQoKICAgIC8vIFVwZGF0ZSB0aGUgaW5kZXggb2YgcG9zaXRpb25zIGZvciB0aGUgYXNzZXQKICAgIF9pbmRleE9mQXNzZXRbYXNzZXRJZF0gPSAwOwogICAgX2luZGV4T2ZBc3NldFtsYXN0QXNzZXRJZF0gPSBhc3NldEluZGV4OwoKICAgIF9jb3VudCA9IF9jb3VudC5zdWIoMSk7CiAgfQoKICBmdW5jdGlvbiBfY2xlYXJBcHByb3ZhbChhZGRyZXNzIGhvbGRlciwgdWludDI1NiBhc3NldElkKSBpbnRlcm5hbCB7CiAgICBpZiAoaG9sZGVyT2YoYXNzZXRJZCkgPT0gaG9sZGVyICYmIF9hcHByb3ZhbFthc3NldElkXSAhPSAwKSB7CiAgICAgIF9hcHByb3ZhbFthc3NldElkXSA9IDA7CiAgICAgIEFwcHJvdmUoaG9sZGVyLCAwLCBhc3NldElkKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9yZW1vdmVBc3NldERhdGEodWludDI1NiBhc3NldElkKSBpbnRlcm5hbCB7CiAgICBfYXNzZXREYXRhW2Fzc2V0SWRdID0gJyc7CiAgfQoKICAvLwogIC8vIFN1cHBseS1hbHRlcmluZyBmdW5jdGlvbnMKICAvLwoKICBmdW5jdGlvbiBfZ2VuZXJhdGUodWludDI1NiBhc3NldElkLCBhZGRyZXNzIGJlbmVmaWNpYXJ5LCBzdHJpbmcgZGF0YSkgaW50ZXJuYWwgewogICAgcmVxdWlyZShfaG9sZGVyT2ZbYXNzZXRJZF0gPT0gMCk7CgogICAgX2FkZEFzc2V0VG8oYmVuZWZpY2lhcnksIGFzc2V0SWQsIGRhdGEpOwoKICAgIFRyYW5zZmVyKDAsIGJlbmVmaWNpYXJ5LCBhc3NldElkLCBtc2cuc2VuZGVyLCBieXRlcyhkYXRhKSwgJycpOwogIH0KCiAgZnVuY3Rpb24gX2Rlc3Ryb3kodWludDI1NiBhc3NldElkKSBpbnRlcm5hbCB7CiAgICBhZGRyZXNzIGhvbGRlciA9IF9ob2xkZXJPZlthc3NldElkXTsKICAgIHJlcXVpcmUoaG9sZGVyICE9IDApOwoKICAgIF9yZW1vdmVBc3NldEZyb20oaG9sZGVyLCBhc3NldElkKTsKICAgIF9yZW1vdmVBc3NldERhdGEoYXNzZXRJZCk7CgogICAgVHJhbnNmZXIoaG9sZGVyLCAwLCBhc3NldElkLCBtc2cuc2VuZGVyLCAnJywgJycpOwogIH0KCiAgLy8KICAvLyBUcmFuc2FjdGlvbiByZWxhdGVkIG9wZXJhdGlvbnMKICAvLwoKICBtb2RpZmllciBvbmx5SG9sZGVyKHVpbnQyNTYgYXNzZXRJZCkgewogICAgcmVxdWlyZShfaG9sZGVyT2ZbYXNzZXRJZF0gPT0gbXNnLnNlbmRlcik7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seU9wZXJhdG9yT3JIb2xkZXIodWludDI1NiBhc3NldElkKSB7CiAgICByZXF1aXJlKAogICAgICBfaG9sZGVyT2ZbYXNzZXRJZF0gPT0gbXNnLnNlbmRlcgogICAgICB8fCBpc09wZXJhdG9yQXV0aG9yaXplZEJ5KG1zZy5zZW5kZXIsIF9ob2xkZXJPZlthc3NldElkXSkKICAgICAgfHwgaXNBcHByb3ZlZEZvcihtc2cuc2VuZGVyLCBhc3NldElkKQogICAgKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBpc0Rlc3RpbmF0YXJ5RGVmaW5lZChhZGRyZXNzIGRlc3RpbmF0YXJ5KSB7CiAgICByZXF1aXJlKGRlc3RpbmF0YXJ5ICE9IDApOwogICAgXzsKICB9CgogIG1vZGlmaWVyIGRlc3RpbmF0YXJ5SXNOb3RIb2xkZXIodWludDI1NiBhc3NldElkLCBhZGRyZXNzIHRvKSB7CiAgICByZXF1aXJlKF9ob2xkZXJPZlthc3NldElkXSAhPSB0byk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBhc3NldElkKSBwdWJsaWMgewogICAgcmV0dXJuIF9kb1RyYW5zZmVyKHRvLCBhc3NldElkLCAnJywgMCwgJycpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBhc3NldElkLCBieXRlcyB1c2VyRGF0YSkgcHVibGljIHsKICAgIHJldHVybiBfZG9UcmFuc2Zlcih0bywgYXNzZXRJZCwgdXNlckRhdGEsIDAsICcnKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgYXNzZXRJZCwgYnl0ZXMgdXNlckRhdGEsIGJ5dGVzIG9wZXJhdG9yRGF0YSkgcHVibGljIHsKICAgIHJldHVybiBfZG9UcmFuc2Zlcih0bywgYXNzZXRJZCwgdXNlckRhdGEsIG1zZy5zZW5kZXIsIG9wZXJhdG9yRGF0YSk7CiAgfQoKICBmdW5jdGlvbiBfZG9UcmFuc2ZlcigKICAgIGFkZHJlc3MgdG8sIHVpbnQyNTYgYXNzZXRJZCwgYnl0ZXMgdXNlckRhdGEsIGFkZHJlc3Mgb3BlcmF0b3IsIGJ5dGVzIG9wZXJhdG9yRGF0YQogICkKICAgIGlzRGVzdGluYXRhcnlEZWZpbmVkKHRvKQogICAgZGVzdGluYXRhcnlJc05vdEhvbGRlcihhc3NldElkLCB0bykKICAgIG9ubHlPcGVyYXRvck9ySG9sZGVyKGFzc2V0SWQpCiAgICBpbnRlcm5hbAogIHsKICAgIHJldHVybiBfZG9TZW5kKHRvLCBhc3NldElkLCB1c2VyRGF0YSwgb3BlcmF0b3IsIG9wZXJhdG9yRGF0YSk7CiAgfQoKCiAgZnVuY3Rpb24gX2RvU2VuZCgKICAgIGFkZHJlc3MgdG8sIHVpbnQyNTYgYXNzZXRJZCwgYnl0ZXMgdXNlckRhdGEsIGFkZHJlc3Mgb3BlcmF0b3IsIGJ5dGVzIG9wZXJhdG9yRGF0YQogICkKICAgIGludGVybmFsCiAgewogICAgYWRkcmVzcyBob2xkZXIgPSBfaG9sZGVyT2ZbYXNzZXRJZF07CiAgICBfcmVtb3ZlQXNzZXRGcm9tKGhvbGRlciwgYXNzZXRJZCk7CiAgICBfY2xlYXJBcHByb3ZhbChob2xkZXIsIGFzc2V0SWQpOwogICAgX2FkZEFzc2V0VG8odG8sIGFzc2V0SWQpOwoKICAgIGlmIChfaXNDb250cmFjdCh0bykpIHsKICAgICAgcmVxdWlyZSghX3JlZW50cmFuY3kpOwogICAgICBfcmVlbnRyYW5jeSA9IHRydWU7CgogICAgICBhZGRyZXNzIHJlY2lwaWVudCA9IGludGVyZmFjZUFkZHIodG8sICdJQXNzZXRIb2xkZXInKTsKICAgICAgcmVxdWlyZShyZWNpcGllbnQgIT0gMCk7CgogICAgICBJQXNzZXRIb2xkZXIocmVjaXBpZW50KS5vbkFzc2V0UmVjZWl2ZWQoYXNzZXRJZCwgaG9sZGVyLCB0bywgdXNlckRhdGEsIG9wZXJhdG9yLCBvcGVyYXRvckRhdGEpOwoKICAgICAgX3JlZW50cmFuY3kgPSBmYWxzZTsKICAgIH0KCiAgICBUcmFuc2Zlcihob2xkZXIsIHRvLCBhc3NldElkLCBvcGVyYXRvciwgdXNlckRhdGEsIG9wZXJhdG9yRGF0YSk7CiAgfQoKICAvLwogIC8vIFVwZGF0ZSByZWxhdGVkIGZ1bmN0aW9ucwogIC8vCgogIGZ1bmN0aW9uIF91cGRhdGUodWludDI1NiBhc3NldElkLCBzdHJpbmcgZGF0YSkgaW50ZXJuYWwgewogICAgcmVxdWlyZShleGlzdHMoYXNzZXRJZCkpOwogICAgX2Fzc2V0RGF0YVthc3NldElkXSA9IGRhdGE7CiAgICBVcGRhdGUoYXNzZXRJZCwgX2hvbGRlck9mW2Fzc2V0SWRdLCBtc2cuc2VuZGVyLCBkYXRhKTsKICB9CgogIC8vCiAgLy8gVXRpbGl0aWVzCiAgLy8KCiAgZnVuY3Rpb24gX2lzQ29udHJhY3QoYWRkcmVzcyBhZGRyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgc2l6ZTsKICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShhZGRyKSB9CiAgICByZXR1cm4gc2l6ZSA+IDA7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBSb2xlcwogKiBAYXV0aG9yIEZyYW5jaXNjbyBHaW9yZGFubyAoQGZyYW5naW8pCiAqIEBkZXYgTGlicmFyeSBmb3IgbWFuYWdpbmcgYWRkcmVzc2VzIGFzc2lnbmVkIHRvIGEgUm9sZS4KICogICAgICBTZWUgUkJBQy5zb2wgZm9yIGV4YW1wbGUgdXNhZ2UuCiAqLwpsaWJyYXJ5IFJvbGVzIHsKICBzdHJ1Y3QgUm9sZSB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGJlYXJlcjsKICB9CgogIC8qKgogICAqIEBkZXYgZ2l2ZSBhbiBhZGRyZXNzIGFjY2VzcyB0byB0aGlzIHJvbGUKICAgKi8KICBmdW5jdGlvbiBhZGQoUm9sZSBzdG9yYWdlIHJvbGUsIGFkZHJlc3MgYWRkcikKICAgIGludGVybmFsCiAgewogICAgcm9sZS5iZWFyZXJbYWRkcl0gPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiByZW1vdmUgYW4gYWRkcmVzcycgYWNjZXNzIHRvIHRoaXMgcm9sZQogICAqLwogIGZ1bmN0aW9uIHJlbW92ZShSb2xlIHN0b3JhZ2Ugcm9sZSwgYWRkcmVzcyBhZGRyKQogICAgaW50ZXJuYWwKICB7CiAgICByb2xlLmJlYXJlclthZGRyXSA9IGZhbHNlOwogIH0KCiAgLyoqCiAgICogQGRldiBjaGVjayBpZiBhbiBhZGRyZXNzIGhhcyB0aGlzIHJvbGUKICAgKiAvLyByZXZlcnRzCiAgICovCiAgZnVuY3Rpb24gY2hlY2soUm9sZSBzdG9yYWdlIHJvbGUsIGFkZHJlc3MgYWRkcikKICAgIHZpZXcKICAgIGludGVybmFsCiAgewogICAgcmVxdWlyZShoYXMocm9sZSwgYWRkcikpOwogIH0KCiAgLyoqCiAgICogQGRldiBjaGVjayBpZiBhbiBhZGRyZXNzIGhhcyB0aGlzIHJvbGUKICAgKiBAcmV0dXJuIGJvb2wKICAgKi8KICBmdW5jdGlvbiBoYXMoUm9sZSBzdG9yYWdlIHJvbGUsIGFkZHJlc3MgYWRkcikKICAgIHZpZXcKICAgIGludGVybmFsCiAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiByb2xlLmJlYXJlclthZGRyXTsKICB9Cn0KCgoKLyoqCiAqIEB0aXRsZSBSQkFDIChSb2xlLUJhc2VkIEFjY2VzcyBDb250cm9sKQogKiBAYXV0aG9yIE1hdHQgQ29uZG9uIChAU2hydWdzKQogKiBAZGV2IFN0b3JlcyBhbmQgcHJvdmlkZXMgc2V0dGVycyBhbmQgZ2V0dGVycyBmb3Igcm9sZXMgYW5kIGFkZHJlc3Nlcy4KICogICAgICBTdXBwb3J0cyB1bmxpbWl0ZWQgbnVtYmVycyBvZiByb2xlcyBhbmQgYWRkcmVzc2VzLgogKiAgICAgIFNlZSAvL2NvbnRyYWN0cy9tb2Nrcy9SQkFDTW9jay5zb2wgZm9yIGFuIGV4YW1wbGUgb2YgdXNhZ2UuCiAqIFRoaXMgUkJBQyBtZXRob2QgdXNlcyBzdHJpbmdzIHRvIGtleSByb2xlcy4gSXQgbWF5IGJlIGJlbmVmaWNpYWwKICogIGZvciB5b3UgdG8gd3JpdGUgeW91ciBvd24gaW1wbGVtZW50YXRpb24gb2YgdGhpcyBpbnRlcmZhY2UgdXNpbmcgRW51bXMgb3Igc2ltaWxhci4KICogSXQncyBhbHNvIHJlY29tbWVuZGVkIHRoYXQgeW91IGRlZmluZSBjb25zdGFudHMgaW4gdGhlIGNvbnRyYWN0LCBsaWtlIFJPTEVfQURNSU4gYmVsb3csCiAqICB0byBhdm9pZCB0eXBvcy4KICovCmNvbnRyYWN0IFJCQUMgewogIHVzaW5nIFJvbGVzIGZvciBSb2xlcy5Sb2xlOwoKICBtYXBwaW5nIChzdHJpbmcgPT4gUm9sZXMuUm9sZSkgcHJpdmF0ZSByb2xlczsKCiAgZXZlbnQgUm9sZUFkZGVkKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKTsKICBldmVudCBSb2xlUmVtb3ZlZChhZGRyZXNzIGFkZHIsIHN0cmluZyByb2xlTmFtZSk7CgogIC8qKgogICAqIEEgY29uc3RhbnQgcm9sZSBuYW1lIGZvciBpbmRpY2F0aW5nIGFkbWlucy4KICAgKi8KICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFJPTEVfQURNSU4gPSAiYWRtaW4iOwoKICAvKioKICAgKiBAZGV2IGNvbnN0cnVjdG9yLiBTZXRzIG1zZy5zZW5kZXIgYXMgYWRtaW4gYnkgZGVmYXVsdAogICAqLwogIGZ1bmN0aW9uIFJCQUMoKQogICAgcHVibGljCiAgewogICAgYWRkUm9sZShtc2cuc2VuZGVyLCBST0xFX0FETUlOKTsKICB9CgogIC8qKgogICAqIEBkZXYgcmV2ZXJ0cyBpZiBhZGRyIGRvZXMgbm90IGhhdmUgcm9sZQogICAqIEBwYXJhbSBhZGRyIGFkZHJlc3MKICAgKiBAcGFyYW0gcm9sZU5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvbGUKICAgKiAvLyByZXZlcnRzCiAgICovCiAgZnVuY3Rpb24gY2hlY2tSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgdmlldwogICAgcHVibGljCiAgewogICAgcm9sZXNbcm9sZU5hbWVdLmNoZWNrKGFkZHIpOwogIH0KCiAgLyoqCiAgICogQGRldiBkZXRlcm1pbmUgaWYgYWRkciBoYXMgcm9sZQogICAqIEBwYXJhbSBhZGRyIGFkZHJlc3MKICAgKiBAcGFyYW0gcm9sZU5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvbGUKICAgKiBAcmV0dXJuIGJvb2wKICAgKi8KICBmdW5jdGlvbiBoYXNSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgdmlldwogICAgcHVibGljCiAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiByb2xlc1tyb2xlTmFtZV0uaGFzKGFkZHIpOwogIH0KCiAgLyoqCiAgICogQGRldiBhZGQgYSByb2xlIHRvIGFuIGFkZHJlc3MKICAgKiBAcGFyYW0gYWRkciBhZGRyZXNzCiAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICovCiAgZnVuY3Rpb24gYWRtaW5BZGRSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgb25seUFkbWluCiAgICBwdWJsaWMKICB7CiAgICBhZGRSb2xlKGFkZHIsIHJvbGVOYW1lKTsKICB9CgogIC8qKgogICAqIEBkZXYgcmVtb3ZlIGEgcm9sZSBmcm9tIGFuIGFkZHJlc3MKICAgKiBAcGFyYW0gYWRkciBhZGRyZXNzCiAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICovCiAgZnVuY3Rpb24gYWRtaW5SZW1vdmVSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgb25seUFkbWluCiAgICBwdWJsaWMKICB7CiAgICByZW1vdmVSb2xlKGFkZHIsIHJvbGVOYW1lKTsKICB9CgogIC8qKgogICAqIEBkZXYgYWRkIGEgcm9sZSB0byBhbiBhZGRyZXNzCiAgICogQHBhcmFtIGFkZHIgYWRkcmVzcwogICAqIEBwYXJhbSByb2xlTmFtZSB0aGUgbmFtZSBvZiB0aGUgcm9sZQogICAqLwogIGZ1bmN0aW9uIGFkZFJvbGUoYWRkcmVzcyBhZGRyLCBzdHJpbmcgcm9sZU5hbWUpCiAgICBpbnRlcm5hbAogIHsKICAgIHJvbGVzW3JvbGVOYW1lXS5hZGQoYWRkcik7CiAgICBSb2xlQWRkZWQoYWRkciwgcm9sZU5hbWUpOwogIH0KCiAgLyoqCiAgICogQGRldiByZW1vdmUgYSByb2xlIGZyb20gYW4gYWRkcmVzcwogICAqIEBwYXJhbSBhZGRyIGFkZHJlc3MKICAgKiBAcGFyYW0gcm9sZU5hbWUgdGhlIG5hbWUgb2YgdGhlIHJvbGUKICAgKi8KICBmdW5jdGlvbiByZW1vdmVSb2xlKGFkZHJlc3MgYWRkciwgc3RyaW5nIHJvbGVOYW1lKQogICAgaW50ZXJuYWwKICB7CiAgICByb2xlc1tyb2xlTmFtZV0ucmVtb3ZlKGFkZHIpOwogICAgUm9sZVJlbW92ZWQoYWRkciwgcm9sZU5hbWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBzY29wZSBhY2Nlc3MgdG8gYSBzaW5nbGUgcm9sZSAodXNlcyBtc2cuc2VuZGVyIGFzIGFkZHIpCiAgICogQHBhcmFtIHJvbGVOYW1lIHRoZSBuYW1lIG9mIHRoZSByb2xlCiAgICogLy8gcmV2ZXJ0cwogICAqLwogIG1vZGlmaWVyIG9ubHlSb2xlKHN0cmluZyByb2xlTmFtZSkKICB7CiAgICBjaGVja1JvbGUobXNnLnNlbmRlciwgcm9sZU5hbWUpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gc2NvcGUgYWNjZXNzIHRvIGFkbWlucwogICAqIC8vIHJldmVydHMKICAgKi8KICBtb2RpZmllciBvbmx5QWRtaW4oKQogIHsKICAgIGNoZWNrUm9sZShtc2cuc2VuZGVyLCBST0xFX0FETUlOKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIHNjb3BlIGFjY2VzcyB0byBhIHNldCBvZiByb2xlcyAodXNlcyBtc2cuc2VuZGVyIGFzIGFkZHIpCiAgICogQHBhcmFtIHJvbGVOYW1lcyB0aGUgbmFtZXMgb2YgdGhlIHJvbGVzIHRvIHNjb3BlIGFjY2VzcyB0bwogICAqIC8vIHJldmVydHMKICAgKgogICAqIEBUT0RPIC0gd2hlbiBzb2xpZGl0eSBzdXBwb3J0cyBkeW5hbWljIGFycmF5cyBhcyBhcmd1bWVudHMgdG8gbW9kaWZpZXJzLCBwcm92aWRlIHRoaXMKICAgKiAgc2VlOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vc29saWRpdHkvaXNzdWVzLzI0NjcKICAgKi8KICAvLyBtb2RpZmllciBvbmx5Um9sZXMoc3RyaW5nW10gcm9sZU5hbWVzKSB7CiAgLy8gICAgIGJvb2wgaGFzQW55Um9sZSA9IGZhbHNlOwogIC8vICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgcm9sZU5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgLy8gICAgICAgICBpZiAoaGFzUm9sZShtc2cuc2VuZGVyLCByb2xlTmFtZXNbaV0pKSB7CiAgLy8gICAgICAgICAgICAgaGFzQW55Um9sZSA9IHRydWU7CiAgLy8gICAgICAgICAgICAgYnJlYWs7CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0KCiAgLy8gICAgIHJlcXVpcmUoaGFzQW55Um9sZSk7CgogIC8vICAgICBfOwogIC8vIH0KfQoKCmNvbnRyYWN0IE1pbnRhYmxlODIxIGlzIFN0YW5kYXJkQXNzZXRSZWdpc3RyeSwgUkJBQyB7CiAgZXZlbnQgTWludCh1aW50MjU2IGFzc2V0SWQsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgc3RyaW5nIGRhdGEpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICB1aW50MjU2IHB1YmxpYyBuZXh0QXNzZXRJZCA9IDA7CgogIHN0cmluZyBjb25zdGFudCBST0xFX01JTlRFUiA9ICJtaW50ZXIiOwogIGJvb2wgcHVibGljIG1pbnRpbmc7CgogIG1vZGlmaWVyIG9ubHlNaW50ZXIoKSB7CiAgICByZXF1aXJlKAogICAgICBoYXNSb2xlKG1zZy5zZW5kZXIsIFJPTEVfTUlOVEVSKQogICAgKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZShtaW50aW5nKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBNaW50YWJsZTgyMShhZGRyZXNzIG1pbnRlcikgcHVibGljIHsKICAgIF9uYW1lID0gIk1pbnRhYmxlODIxIjsKICAgIF9zeW1ib2wgPSAiTUlOVCI7CiAgICBfZGVzY3JpcHRpb24gPSAiRVJDIDgyMSBtaW50aW5nIGNvbnRyYWN0IjsKCiAgICByZW1vdmVSb2xlKG1zZy5zZW5kZXIsIFJPTEVfQURNSU4pOwogICAgYWRkUm9sZShtaW50ZXIsIFJPTEVfTUlOVEVSKTsKCiAgICBtaW50aW5nID0gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGlzQ29udHJhY3RQcm94eShhZGRyZXNzIGFkZHIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBfaXNDb250cmFjdChhZGRyKTsKICB9CgogIGZ1bmN0aW9uIGdlbmVyYXRlKGFkZHJlc3MgYmVuZWZpY2lhcnksIHN0cmluZyBkYXRhKQogICAgb25seU1pbnRlcgogICAgY2FuTWludAogICAgcHVibGljCiAgewogICAgdWludDI1NiBhc3NldElkID0gbmV4dEFzc2V0SWQ7CiAgICBfZ2VuZXJhdGUoYXNzZXRJZCwgYmVuZWZpY2lhcnksIGRhdGEpOwogICAgTWludChhc3NldElkLCBiZW5lZmljaWFyeSwgZGF0YSk7CiAgICBuZXh0QXNzZXRJZCA9IG5leHRBc3NldElkICsgMTsKICB9CgogIC8vIGZ1bmN0aW9uIHVwZGF0ZSh1aW50MjU2IGFzc2V0SWQsIHN0cmluZyBkYXRhKQogIC8vICAgb25seU1pbnRlcgogIC8vICAgcHVibGljCiAgLy8gewogIC8vICAgX3VwZGF0ZShhc3NldElkLCBkYXRhKTsKICAvLyB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyVG8oCiAgICBhZGRyZXNzIHRvLCB1aW50MjU2IGFzc2V0SWQsIGJ5dGVzIHVzZXJEYXRhLCBieXRlcyBvcGVyYXRvckRhdGEKICApCiAgICBwdWJsaWMKICB7CiAgICByZXR1cm4gdHJhbnNmZXIodG8sIGFzc2V0SWQsIHVzZXJEYXRhLCBvcGVyYXRvckRhdGEpOwogIH0KCiAgZnVuY3Rpb24gZW5kTWludGluZygpCiAgICBvbmx5TWludGVyCiAgICBjYW5NaW50CiAgICBwdWJsaWMKICB7CiAgICBtaW50aW5nID0gZmFsc2U7CiAgICBNaW50RmluaXNoZWQoKTsKICB9Cn0KCgpjb250cmFjdCBYTE5UUGVvcGxlIGlzIE1pbnRhYmxlODIxIHsKICBmdW5jdGlvbiBYTE5UUGVvcGxlKCkKICAgIE1pbnRhYmxlODIxKG1zZy5zZW5kZXIpCiAgICBwdWJsaWMKICB7CiAgICBfbmFtZSA9ICJYTE5UUGVvcGxlIjsKICAgIF9zeW1ib2wgPSAiWExOVFBQTCI7CiAgICBfZGVzY3JpcHRpb24gPSAiSSBmb3VuZCB0aGlzIFhMTlQgUGVyc29uISI7CiAgfQp9'.
	

]
