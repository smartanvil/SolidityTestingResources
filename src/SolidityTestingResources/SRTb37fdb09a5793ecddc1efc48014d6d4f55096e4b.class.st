Class {
	#name : #SRTb37fdb09a5793ecddc1efc48014d6d4f55096e4b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb37fdb09a5793ecddc1efc48014d6d4f55096e4b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBUb2tlbiB7CiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgaXMgcmVwbGFjZWQgd2l0aDoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAqLwogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgc2FsZTsKICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0FsbG93ZWQ7CiAgICAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbiB7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkVHJhbnNmZXIKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIAogICAgewogICAgICAgIC8vRGVmYXVsdCBhc3N1bWVzIHRvdGFsU3VwcGx5IGNhbid0IGJlIG92ZXIgbWF4ICgyXjI1NiAtIDEpLgogICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuCiAgICAgICAgLy9SZXBsYWNlIHRoZSBpZiB3aXRoIHRoaXMgb25lIGluc3RlYWQuCiAgICAgICAgLy9yZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gU2FmZU1hdGguc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbX3RvXSxfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkVHJhbnNmZXIKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICAgIHsKICAgICAgICAvL3NhbWUgYXMgYWJvdmUuIFJlcGxhY2UgdGhpcyBsaW5lIHdpdGggdGhlIGZvbGxvd2luZyBpZiB5b3Ugd2FudCB0byBwcm90ZWN0IGFnYWluc3Qgd3JhcHBpbmcgdWludHMuCiAgICAgICAgLy9yZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gU2FmZU1hdGguYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gU2FmZU1hdGguc3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLnN1YihhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICBtb2RpZmllciB2YWxpZFRyYW5zZmVyKCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2FsZSB8fCB0cmFuc2ZlcnNBbGxvd2VkKTsKICAgICAgICBfOwogICAgfSAgIAp9CgoKY29udHJhY3QgSHVtYW5TdGFuZGFyZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8qIFB1YmxpYyB2YXJpYWJsZXMgb2YgdGhlIHRva2VuICovCgogICAgLyoKICAgIE5PVEU6CiAgICBUaGUgZm9sbG93aW5nIHZhcmlhYmxlcyBhcmUgT1BUSU9OQUwgdmFuaXRpZXMuIE9uZSBkb2VzIG5vdCBoYXZlIHRvIGluY2x1ZGUgdGhlbS4KICAgIFRoZXkgYWxsb3cgb25lIHRvIGN1c3RvbWlzZSB0aGUgdG9rZW4gY29udHJhY3QgJiBpbiBubyB3YXkgaW5mbHVlbmNlcyB0aGUgY29yZSBmdW5jdGlvbmFsaXR5LgogICAgU29tZSB3YWxsZXRzL2ludGVyZmFjZXMgbWlnaHQgbm90IGV2ZW4gYm90aGVyIHRvIGxvb2sgYXQgdGhpcyBpbmZvcm1hdGlvbi4KICAgICovCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgICAgIC8vZmFuY3kgbmFtZTogZWcgU2ltb24gQnVja3MKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgICAgLy9Ib3cgbWFueSBkZWNpbWFscyB0byBzaG93LiBpZS4gVGhlcmUgY291bGQgMTAwMCBiYXNlIHVuaXRzIHdpdGggMyBkZWNpbWFscy4gTWVhbmluZyAwLjk4MCBTQlggPSA5ODAgYmFzZSB1bml0cy4gSXQncyBsaWtlIGNvbXBhcmluZyAxIHdlaSB0byAxIGV0aGVyLgogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGVnIFNCWAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ0gwLjEnOyAgICAgICAvL2h1bWFuIDAuMSBzdGFuZGFyZC4gSnVzdCBhbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUuCgogICAgZnVuY3Rpb24gSHVtYW5TdGFuZGFyZFRva2VuKAogICAgICAgIHVpbnQyNTYgX2luaXRpYWxBbW91bnQsCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGFkZHJlc3MgX3NhbGUpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBfaW5pdGlhbEFtb3VudDsgICAgICAgICAgICAgICAvLyBHaXZlIHRoZSBjcmVhdG9yIGFsbCBpbml0aWFsIHRva2VucwogICAgICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxBbW91bnQ7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRvdGFsIHN1cHBseQogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbW91bnQgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc2FsZSA9IF9zYWxlOwogICAgICAgIHRyYW5zZmVyc0FsbG93ZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvKiBBcHByb3ZlcyBhbmQgdGhlbiBjYWxscyB0aGUgcmVjZWl2aW5nIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgICAgICAvL2NhbGwgdGhlIHJlY2VpdmVBcHByb3ZhbCBmdW5jdGlvbiBvbiB0aGUgY29udHJhY3QgeW91IHdhbnQgdG8gYmUgbm90aWZpZWQuIFRoaXMgY3JhZnRzIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgbWFudWFsbHkgc28gb25lIGRvZXNuJ3QgaGF2ZSB0byBpbmNsdWRlIGEgY29udHJhY3QgaW4gaGVyZSBqdXN0IGZvciB0aGlzLgogICAgICAgIC8vcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlLCBhZGRyZXNzIF90b2tlbkNvbnRyYWN0LCBieXRlcyBfZXh0cmFEYXRhKQogICAgICAgIC8vaXQgaXMgYXNzdW1lZCB0aGF0IHdoZW4gZG9lcyB0aGlzIHRoYXQgdGhlIGNhbGwgKnNob3VsZCogc3VjY2VlZCwgb3RoZXJ3aXNlIG9uZSB3b3VsZCB1c2UgdmFuaWxsYSBhcHByb3ZlIGluc3RlYWQuCiAgICAgICAgcmVxdWlyZShfc3BlbmRlci5jYWxsKGJ5dGVzNChieXRlczMyKGtlY2NhazI1NigicmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MsdWludDI1NixhZGRyZXNzLGJ5dGVzKSIpKSksIG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJldmVyc2VQdXJjaGFzZShhZGRyZXNzIF90b2tlbkhvbGRlcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5U2FsZQogICAgewogICAgICAgIHJlcXVpcmUoIXRyYW5zZmVyc0FsbG93ZWQpOwogICAgICAgIHVpbnQgdmFsdWUgPSBiYWxhbmNlc1tfdG9rZW5Ib2xkZXJdOwogICAgICAgIGJhbGFuY2VzW190b2tlbkhvbGRlcl0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbX3Rva2VuSG9sZGVyXSwgdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW3NhbGVdID0gU2FmZU1hdGguYWRkKGJhbGFuY2VzW3NhbGVdLCB2YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX3Rva2VuSG9sZGVyLCBzYWxlLCB2YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlVHJhbnNmZXJMb2NrKCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5U2FsZQogICAgewogICAgICAgIHRyYW5zZmVyc0FsbG93ZWQgPSB0cnVlOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlTYWxlKCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2FsZSk7CiAgICAgICAgXzsKICAgIH0KfQoKCmNvbnRyYWN0IERpc2J1cnNlbWVudCB7CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgcmVjZWl2ZXI7CiAgICB1aW50IHB1YmxpYyBkaXNidXJzZW1lbnRQZXJpb2Q7CiAgICB1aW50IHB1YmxpYyBzdGFydERhdGU7CiAgICB1aW50IHB1YmxpYyB3aXRoZHJhd25Ub2tlbnM7CiAgICBUb2tlbiBwdWJsaWMgdG9rZW47CgogICAgLyoKICAgICAqICBNb2RpZmllcnMKICAgICAqLwogICAgbW9kaWZpZXIgaXNPd25lcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikKICAgICAgICAgICAgLy8gT25seSBvd25lciBpcyBhbGxvd2VkIHRvIHByb2NlZWQKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1JlY2VpdmVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHJlY2VpdmVyKQogICAgICAgICAgICAvLyBPbmx5IHJlY2VpdmVyIGlzIGFsbG93ZWQgdG8gcHJvY2VlZAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzU2V0VXAoKSB7CiAgICAgICAgaWYgKGFkZHJlc3ModG9rZW4pID09IDApCiAgICAgICAgICAgIC8vIENvbnRyYWN0IGlzIG5vdCBzZXQgdXAKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBjb250cmFjdCBvd25lcgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXIgUmVjZWl2ZXIgb2YgdmVzdGVkIHRva2VucwogICAgLy8vIEBwYXJhbSBfZGlzYnVyc2VtZW50UGVyaW9kIFZlc3RpbmcgcGVyaW9kIGluIHNlY29uZHMKICAgIC8vLyBAcGFyYW0gX3N0YXJ0RGF0ZSBTdGFydCBkYXRlIG9mIGRpc2J1cnNlbWVudCBwZXJpb2QgKGNsaWZmKQogICAgZnVuY3Rpb24gRGlzYnVyc2VtZW50KGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50IF9kaXNidXJzZW1lbnRQZXJpb2QsIHVpbnQgX3N0YXJ0RGF0ZSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBpZiAoX3JlY2VpdmVyID09IDAgfHwgX2Rpc2J1cnNlbWVudFBlcmlvZCA9PSAwKQogICAgICAgICAgICAvLyBBcmd1bWVudHMgYXJlIG51bGwKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlY2VpdmVyID0gX3JlY2VpdmVyOwogICAgICAgIGRpc2J1cnNlbWVudFBlcmlvZCA9IF9kaXNidXJzZW1lbnRQZXJpb2Q7CiAgICAgICAgc3RhcnREYXRlID0gX3N0YXJ0RGF0ZTsKICAgICAgICBpZiAoc3RhcnREYXRlID09IDApCiAgICAgICAgICAgIHN0YXJ0RGF0ZSA9IG5vdzsKICAgIH0KCiAgICAvLy8gQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0cycgYWRkcmVzc2VzCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXR1cChUb2tlbiBfdG9rZW4pCiAgICAgICAgcHVibGljCiAgICAgICAgaXNPd25lcgogICAgewogICAgICAgIGlmIChhZGRyZXNzKHRva2VuKSAhPSAwIHx8IGFkZHJlc3MoX3Rva2VuKSA9PSAwKQogICAgICAgICAgICAvLyBTZXR1cCB3YXMgZXhlY3V0ZWQgYWxyZWFkeSBvciBhZGRyZXNzIGlzIG51bGwKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICBpc1JlY2VpdmVyCiAgICAgICAgaXNTZXRVcAogICAgewogICAgICAgIHVpbnQgbWF4VG9rZW5zID0gY2FsY01heFdpdGhkcmF3KCk7CiAgICAgICAgaWYgKF92YWx1ZSA+IG1heFRva2VucykKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgd2l0aGRyYXduVG9rZW5zID0gU2FmZU1hdGguYWRkKHdpdGhkcmF3blRva2VucywgX3ZhbHVlKTsKICAgICAgICB0b2tlbi50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgbWF4aW11bSBhbW91bnQgb2YgdmVzdGVkIHRva2VucwogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIHZlc3RlZCB0b2tlbnMgdG8gd2l0aGRyYXcKICAgIGZ1bmN0aW9uIGNhbGNNYXhXaXRoZHJhdygpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHVpbnQgbWF4VG9rZW5zID0gU2FmZU1hdGgubXVsKFNhZmVNYXRoLmFkZCh0b2tlbi5iYWxhbmNlT2YodGhpcyksIHdpdGhkcmF3blRva2VucyksIFNhZmVNYXRoLnN1Yihub3csc3RhcnREYXRlKSkgLyBkaXNidXJzZW1lbnRQZXJpb2Q7CiAgICAgICAgLy91aW50IG1heFRva2VucyA9ICh0b2tlbi5iYWxhbmNlT2YodGhpcykgKyB3aXRoZHJhd25Ub2tlbnMpICogKG5vdyAtIHN0YXJ0RGF0ZSkgLyBkaXNidXJzZW1lbnRQZXJpb2Q7CiAgICAgICAgaWYgKHdpdGhkcmF3blRva2VucyA+PSBtYXhUb2tlbnMgfHwgc3RhcnREYXRlID4gbm93KQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoU2FmZU1hdGguc3ViKG1heFRva2Vucywgd2l0aGRyYXduVG9rZW5zKSA+IHRva2VuLnRvdGFsU3VwcGx5KCkpCiAgICAgICAgICAgIHJldHVybiB0b2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIHJldHVybiBTYWZlTWF0aC5zdWIobWF4VG9rZW5zLCB3aXRoZHJhd25Ub2tlbnMpOwogICAgfQp9CgoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdXJlIGludGVybmFsICByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVyZSBpbnRlcm5hbCAgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVyZSBpbnRlcm5hbCAgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIHB1cmUgaW50ZXJuYWwgIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgpjb250cmFjdCBTYWxlIHsKCiAgICAvLyBFVkVOVFMKICAgIGV2ZW50IFRyYW5zZmVycmVkVGltZWxvY2tlZFRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5LCBhZGRyZXNzIGRpc2J1cnNlbWVudCx1aW50IGJlbmVmaWNpYXJ5VG9rZW5zKTsKICAgIGV2ZW50IFB1cmNoYXNlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMb2NrZWRVbnNvbGRUb2tlbnModWludCBudW1Ub2tlbnNMb2NrZWQsIGFkZHJlc3MgZGlzYnVyc2VyKTsKCiAgICAvLyBTVE9SQUdFCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUT1RBTF9TVVBQTFkgPSAxMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX1BSSVZBVEUgPSA3NTAwMDAwMDAwMDAwMDAwMDA7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgREVDSU1BTFMgPSA5OwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBOQU1FID0gIkxldmVyaiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFNZTUJPTCA9ICJMRVYiOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyB3aGl0ZWxpc3RBZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKICAgIEh1bWFuU3RhbmRhcmRUb2tlbiBwdWJsaWMgdG9rZW47CiAgICB1aW50IHB1YmxpYyBmcmVlemVCbG9jazsKICAgIHVpbnQgcHVibGljIHN0YXJ0QmxvY2s7CiAgICB1aW50IHB1YmxpYyBlbmRCbG9jazsKICAgIHVpbnQgcHVibGljIHByaWNlX2luX3dlaSA9IDMzMzMzMzsgLy93ZWkgcGVyIDEwKiotOSBvZiBhIExFViEKICAgIHVpbnQgcHVibGljIHByaXZhdGVBbGxvY2F0ZWQgPSAwOwogICAgYm9vbCBwdWJsaWMgc2V0dXBDb21wbGV0ZUZsYWcgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIGVtZXJnZW5jeUZsYWcgPSBmYWxzZTsKICAgIGFkZHJlc3NbXSBwdWJsaWMgZGlzYnVyc2VtZW50czsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgd2hpdGVsaXN0UmVnaXN0cmFudHM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdFJlZ2lzdHJhbnRzRmxhZzsKICAgIGJvb2wgcHVibGljIHB1YmxpY1NhbGUgPSBmYWxzZTsKCiAgICAvLyBQVUJMSUMgRlVOQ1RJT05TCiAgICBmdW5jdGlvbiBTYWxlKAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQgX2ZyZWV6ZUJsb2NrLAogICAgICAgIHVpbnQgX3N0YXJ0QmxvY2ssCiAgICAgICAgdWludCBfZW5kQmxvY2ssCiAgICAgICAgYWRkcmVzcyBfd2hpdGVsaXN0QWRtaW4pCiAgICAgICAgcHVibGljIAogICAgICAgIGNoZWNrQmxvY2tOdW1iZXJJbnB1dHMoX2ZyZWV6ZUJsb2NrLCBfc3RhcnRCbG9jaywgX2VuZEJsb2NrKQogICAgewogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIHdoaXRlbGlzdEFkbWluID0gX3doaXRlbGlzdEFkbWluOwogICAgICAgIHRva2VuID0gbmV3IEh1bWFuU3RhbmRhcmRUb2tlbihUT1RBTF9TVVBQTFksIE5BTUUsIERFQ0lNQUxTLCBTWU1CT0wsIGFkZHJlc3ModGhpcykpOwogICAgICAgIGZyZWV6ZUJsb2NrID0gX2ZyZWV6ZUJsb2NrOwogICAgICAgIHN0YXJ0QmxvY2sgPSBfc3RhcnRCbG9jazsKICAgICAgICBlbmRCbG9jayA9IF9lbmRCbG9jazsKICAgICAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodGhpcywgdG9rZW4udG90YWxTdXBwbHkoKSkpOwogICAgICAgIGFzc2VydCh0b2tlbi5iYWxhbmNlT2YodGhpcykgPT0gdG9rZW4udG90YWxTdXBwbHkoKSk7CiAgICAgICAgYXNzZXJ0KHRva2VuLmJhbGFuY2VPZih0aGlzKSA9PSBUT1RBTF9TVVBQTFkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1cmNoYXNlVG9rZW5zKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgc2V0dXBDb21wbGV0ZQogICAgICAgIG5vdEluRW1lcmdlbmN5CiAgICAgICAgc2FsZUluUHJvZ3Jlc3MKICAgIHsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFJlZ2lzdHJhbnRzRmxhZ1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICAvKiBDYWxjdWxhdGUgd2hldGhlciBhbnkgb2YgdGhlIG1zZy52YWx1ZSBuZWVkcyB0byBiZSByZXR1cm5lZCB0bwogICAgICAgICAgIHRoZSBzZW5kZXIuIFRoZSBwdXJjaGFzZUFtb3VudCBpcyB0aGUgYWN0dWFsIG51bWJlciBvZiB0b2tlbnMgd2hpY2gKICAgICAgICAgICB3aWxsIGJlIHB1cmNoYXNlZC4gKi8KICAgICAgICB1aW50IHB1cmNoYXNlQW1vdW50ID0gbXNnLnZhbHVlIC8gcHJpY2VfaW5fd2VpOyAKICAgICAgICB1aW50IGV4Y2Vzc0Ftb3VudCA9IG1zZy52YWx1ZSAlIHByaWNlX2luX3dlaTsKCiAgICAgICAgaWYgKCFwdWJsaWNTYWxlKXsKICAgICAgICAgICAgcmVxdWlyZSh3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXSA+IDAgKTsKICAgICAgICAgICAgdWludCB0ZW1wV2hpdGVsaXN0QW1vdW50ID0gd2hpdGVsaXN0UmVnaXN0cmFudHNbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGlmIChwdXJjaGFzZUFtb3VudCA+IHdoaXRlbGlzdFJlZ2lzdHJhbnRzW21zZy5zZW5kZXJdKXsKICAgICAgICAgICAgICAgIHVpbnQgZXh0cmEgPSBTYWZlTWF0aC5zdWIocHVyY2hhc2VBbW91bnQsd2hpdGVsaXN0UmVnaXN0cmFudHNbbXNnLnNlbmRlcl0pOwogICAgICAgICAgICAgICAgcHVyY2hhc2VBbW91bnQgPSB3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXTsKICAgICAgICAgICAgICAgIGV4Y2Vzc0Ftb3VudCA9IFNhZmVNYXRoLmFkZChleGNlc3NBbW91bnQsZXh0cmEqcHJpY2VfaW5fd2VpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLnN1Yih3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXSwgcHVyY2hhc2VBbW91bnQpOwogICAgICAgICAgICBhc3NlcnQod2hpdGVsaXN0UmVnaXN0cmFudHNbbXNnLnNlbmRlcl0gPCB0ZW1wV2hpdGVsaXN0QW1vdW50KTsKICAgICAgICB9ICAKCiAgICAgICAgLy8gQ2Fubm90IHB1cmNoYXNlIG1vcmUgdG9rZW5zIHRoYW4gdGhpcyBjb250cmFjdCBoYXMgYXZhaWxhYmxlIHRvIHNlbGwKICAgICAgICByZXF1aXJlKHB1cmNoYXNlQW1vdW50IDw9IHRva2VuLmJhbGFuY2VPZih0aGlzKSk7CiAgICAgICAgLy8gUmV0dXJuIGFueSBleGNlc3MgbXNnLnZhbHVlCiAgICAgICAgaWYgKGV4Y2Vzc0Ftb3VudCA+IDApewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV4Y2Vzc0Ftb3VudCk7CiAgICAgICAgfQogICAgICAgIC8vIEZvcndhcmQgcmVjZWl2ZWQgZXRoZXIgbWludXMgYW55IGV4Y2Vzc0Ftb3VudCB0byB0aGUgd2FsbGV0CiAgICAgICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHN1bSBvZiB0b2tlbnMgdG9rZW5QdXJjaGFzZSB0byB0aGUgbXNnLnNlbmRlcgogICAgICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBwdXJjaGFzZUFtb3VudCkpOwogICAgICAgIFB1cmNoYXNlZFRva2Vucyhtc2cuc2VuZGVyLCBwdXJjaGFzZUFtb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gbG9ja1Vuc29sZFRva2VucyhhZGRyZXNzIF91bnNvbGRUb2tlbnNXYWxsZXQpCiAgICAgICAgcHVibGljCiAgICAgICAgc2FsZUVuZGVkCiAgICAgICAgc2V0dXBDb21wbGV0ZQogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIERpc2J1cnNlbWVudCBkaXNidXJzZW1lbnQgPSBuZXcgRGlzYnVyc2VtZW50KAogICAgICAgICAgICBfdW5zb2xkVG9rZW5zV2FsbGV0LAogICAgICAgICAgICAxKjM2NSoyNCo2MCo2MCwKICAgICAgICAgICAgYmxvY2sudGltZXN0YW1wCiAgICAgICAgKTsKICAgICAgICBkaXNidXJzZW1lbnQuc2V0dXAodG9rZW4pOwogICAgICAgIHVpbnQgYW1vdW50VG9Mb2NrID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGRpc2J1cnNlbWVudHMucHVzaChkaXNidXJzZW1lbnQpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGRpc2J1cnNlbWVudCwgYW1vdW50VG9Mb2NrKTsKICAgICAgICBMb2NrZWRVbnNvbGRUb2tlbnMoYW1vdW50VG9Mb2NrLCBkaXNidXJzZW1lbnQpOwogICAgfQoKICAgIC8vIE9XTkVSLU9OTFkgRlVOQ1RJT05TCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygKICAgICAgICBhZGRyZXNzW10gX2JlbmVmaWNpYXJpZXMsCiAgICAgICAgdWludFtdIF9iZW5lZmljaWFyaWVzVG9rZW5zLAogICAgICAgIHVpbnRbXSBfdGltZWxvY2tTdGFydHMsCiAgICAgICAgdWludFtdIF9wZXJpb2RzCiAgICApIAogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgICAgIHNhbGVOb3RFbmRlZAogICAgeyAKICAgICAgICBhc3NlcnQoIXNldHVwQ29tcGxldGVGbGFnKTsKICAgICAgICBhc3NlcnQoX2JlbmVmaWNpYXJpZXNUb2tlbnMubGVuZ3RoIDwgMTEpOwogICAgICAgIGFzc2VydChfYmVuZWZpY2lhcmllcy5sZW5ndGggPT0gX2JlbmVmaWNpYXJpZXNUb2tlbnMubGVuZ3RoKTsKICAgICAgICBhc3NlcnQoX2JlbmVmaWNpYXJpZXNUb2tlbnMubGVuZ3RoID09IF90aW1lbG9ja1N0YXJ0cy5sZW5ndGgpOwogICAgICAgIGFzc2VydChfdGltZWxvY2tTdGFydHMubGVuZ3RoID09IF9wZXJpb2RzLmxlbmd0aCk7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBfYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKHByaXZhdGVBbGxvY2F0ZWQgKyBfYmVuZWZpY2lhcmllc1Rva2Vuc1tpXSA8PSBNQVhfUFJJVkFURSk7CiAgICAgICAgICAgIHByaXZhdGVBbGxvY2F0ZWQgPSBTYWZlTWF0aC5hZGQocHJpdmF0ZUFsbG9jYXRlZCwgX2JlbmVmaWNpYXJpZXNUb2tlbnNbaV0pOwogICAgICAgICAgICBhZGRyZXNzIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJpZXNbaV07CiAgICAgICAgICAgIHVpbnQgYmVuZWZpY2lhcnlUb2tlbnMgPSBfYmVuZWZpY2lhcmllc1Rva2Vuc1tpXTsKICAgICAgICAgICAgRGlzYnVyc2VtZW50IGRpc2J1cnNlbWVudCA9IG5ldyBEaXNidXJzZW1lbnQoCiAgICAgICAgICAgICAgICBiZW5lZmljaWFyeSwKICAgICAgICAgICAgICAgIF9wZXJpb2RzW2ldLAogICAgICAgICAgICAgICAgX3RpbWVsb2NrU3RhcnRzW2ldCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGRpc2J1cnNlbWVudC5zZXR1cCh0b2tlbik7CiAgICAgICAgICAgIHRva2VuLnRyYW5zZmVyKGRpc2J1cnNlbWVudCwgYmVuZWZpY2lhcnlUb2tlbnMpOwogICAgICAgICAgICBkaXNidXJzZW1lbnRzLnB1c2goZGlzYnVyc2VtZW50KTsKICAgICAgICAgICAgVHJhbnNmZXJyZWRUaW1lbG9ja2VkVG9rZW5zKGJlbmVmaWNpYXJ5LCBkaXNidXJzZW1lbnQsIGJlbmVmaWNpYXJ5VG9rZW5zKTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0KHRva2VuLmJhbGFuY2VPZih0aGlzKSA+PSAoU2FmZU1hdGguc3ViKFRPVEFMX1NVUFBMWSwgTUFYX1BSSVZBVEUpKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByZXNhbGVUb2tlbnMoYWRkcmVzc1tdIF9idXllcnMsIHVpbnRbXSBfYW1vdW50cykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgICAgICBzYWxlTm90RW5kZWQKICAgIHsKICAgICAgICBhc3NlcnQoIXNldHVwQ29tcGxldGVGbGFnKTsKICAgICAgICByZXF1aXJlKF9idXllcnMubGVuZ3RoIDwgMTEpOwogICAgICAgIHJlcXVpcmUoX2J1eWVycy5sZW5ndGggPT0gX2Ftb3VudHMubGVuZ3RoKTsKICAgICAgICBmb3IodWludCBpPTA7IGkgPCBfYnV5ZXJzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgcmVxdWlyZShTYWZlTWF0aC5hZGQocHJpdmF0ZUFsbG9jYXRlZCwgX2Ftb3VudHNbaV0pIDw9IE1BWF9QUklWQVRFKTsKICAgICAgICAgICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKF9idXllcnNbaV0sIF9hbW91bnRzW2ldKSk7CiAgICAgICAgICAgIHByaXZhdGVBbGxvY2F0ZWQgPSBTYWZlTWF0aC5hZGQocHJpdmF0ZUFsbG9jYXRlZCwgX2Ftb3VudHNbaV0pOwogICAgICAgICAgICBQdXJjaGFzZWRUb2tlbnMoX2J1eWVyc1tpXSwgX2Ftb3VudHNbaV0pOwogICAgICAgIH0KICAgICAgICBhc3NlcnQodG9rZW4uYmFsYW5jZU9mKHRoaXMpID49IChTYWZlTWF0aC5zdWIoVE9UQUxfU1VQUExZLCBNQVhfUFJJVkFURSkpKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVUcmFuc2ZlckxvY2soKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHRva2VuLnJlbW92ZVRyYW5zZmVyTG9jaygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJldmVyc2VQdXJjaGFzZShhZGRyZXNzIF90b2tlbkhvbGRlcikKICAgICAgICBwYXlhYmxlCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgdWludCByZWZ1bmQgPSBTYWZlTWF0aC5tdWwodG9rZW4uYmFsYW5jZU9mKF90b2tlbkhvbGRlcikscHJpY2VfaW5fd2VpKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSByZWZ1bmQpOwogICAgICAgIHVpbnQgZXhjZXNzQW1vdW50ID0gU2FmZU1hdGguc3ViKG1zZy52YWx1ZSwgcmVmdW5kKTsKICAgICAgICBpZiAoZXhjZXNzQW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV4Y2Vzc0Ftb3VudCk7CiAgICAgICAgfQoKICAgICAgICBfdG9rZW5Ib2xkZXIudHJhbnNmZXIocmVmdW5kKTsKICAgICAgICB0b2tlbi5yZXZlcnNlUHVyY2hhc2UoX3Rva2VuSG9sZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRTZXR1cENvbXBsZXRlKCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKHdhbGxldCE9MCk7CiAgICAgICAgcmVxdWlyZShwcml2YXRlQWxsb2NhdGVkIT0wKTsgIAogICAgICAgIHNldHVwQ29tcGxldGVGbGFnID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb25maWd1cmVXYWxsZXQoYWRkcmVzcyBfd2FsbGV0KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShfbmV3T3duZXIgIT0gMCk7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlV2hpdGVsaXN0QWRtaW4oYWRkcmVzcyBfbmV3QWRtaW4pCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShfbmV3QWRtaW4gIT0gMCk7CiAgICAgICAgd2hpdGVsaXN0QWRtaW4gPSBfbmV3QWRtaW47CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlUHJpY2UodWludCBfbmV3UHJpY2UpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgbm90RnJvemVuCiAgICAgICAgdmFsaWRQcmljZShfbmV3UHJpY2UpCiAgICB7CiAgICAgICAgcHJpY2VfaW5fd2VpID0gX25ld1ByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVN0YXJ0QmxvY2sodWludCBfbmV3QmxvY2spCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgbm90RnJvemVuCiAgICB7CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPD0gX25ld0Jsb2NrICYmIF9uZXdCbG9jayA8IHN0YXJ0QmxvY2spOwogICAgICAgIGZyZWV6ZUJsb2NrID0gU2FmZU1hdGguc3ViKF9uZXdCbG9jayAsIFNhZmVNYXRoLnN1YihzdGFydEJsb2NrLCBmcmVlemVCbG9jaykpOwogICAgICAgIHN0YXJ0QmxvY2sgPSBfbmV3QmxvY2s7CiAgICB9CgogICAgZnVuY3Rpb24gZW1lcmdlbmN5VG9nZ2xlKCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBlbWVyZ2VuY3lGbGFnID0gIWVtZXJnZW5jeUZsYWc7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkZFdoaXRlbGlzdChhZGRyZXNzW10gX3B1cmNoYXNlciwgdWludFtdIF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdoaXRlbGlzdEFkbWluCiAgICAgICAgc2FsZU5vdEVuZGVkCiAgICB7CiAgICAgICAgYXNzZXJ0KF9wdXJjaGFzZXIubGVuZ3RoIDwgMTEgKTsKICAgICAgICBhc3NlcnQoX3B1cmNoYXNlci5sZW5ndGggPT0gX2Ftb3VudC5sZW5ndGgpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgX3B1cmNoYXNlci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB3aGl0ZWxpc3RSZWdpc3RyYW50c1tfcHVyY2hhc2VyW2ldXSA9IF9hbW91bnRbaV07CiAgICAgICAgICAgIHdoaXRlbGlzdFJlZ2lzdHJhbnRzRmxhZ1tfcHVyY2hhc2VyW2ldXSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXJ0UHVibGljU2FsZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgaWYgKCFwdWJsaWNTYWxlKXsKICAgICAgICAgICAgcHVibGljU2FsZSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8vIE1PRElGSUVSUwogICAgbW9kaWZpZXIgc2FsZUVuZGVkIHsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+PSBlbmRCbG9jayk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHNhbGVOb3RFbmRlZCB7CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPCBlbmRCbG9jayk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgb25seVdoaXRlbGlzdEFkbWluIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSB3aGl0ZWxpc3RBZG1pbik7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIG5vdEZyb3plbiB7CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPCBmcmVlemVCbG9jayk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHNhbGVJblByb2dyZXNzIHsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+PSBzdGFydEJsb2NrICYmIGJsb2NrLm51bWJlciA8IGVuZEJsb2NrKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgc2V0dXBDb21wbGV0ZSB7CiAgICAgICAgYXNzZXJ0KHNldHVwQ29tcGxldGVGbGFnKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgbm90SW5FbWVyZ2VuY3kgewogICAgICAgIGFzc2VydChlbWVyZ2VuY3lGbGFnID09IGZhbHNlKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY2hlY2tCbG9ja051bWJlcklucHV0cyh1aW50IF9mcmVlemUsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQpIHsKICAgICAgICByZXF1aXJlKF9mcmVlemUgPj0gYmxvY2subnVtYmVyCiAgICAgICAgJiYgX3N0YXJ0ID49IF9mcmVlemUKICAgICAgICAmJiBfZW5kID49IF9zdGFydCk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHZhbGlkUHJpY2UodWludCBfcHJpY2UpewogICAgICAgIHJlcXVpcmUoX3ByaWNlID4gMCk7CiAgICAgICAgXzsKICAgIH0KfQ=='.
	

]
