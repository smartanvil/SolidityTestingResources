Class {
	#name : #SRT198cf24375eccdf599c624d10f0c6fb9b75ec215,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT198cf24375eccdf599c624d10f0c6fb9b75ec215 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qCiAqIE1hbmFnZXIgdGhhdCBzdG9yZXMgcGVybWl0dGVkIGFkZHJlc3NlcyAKICovCmNvbnRyYWN0IFBlcm1pc3Npb25NYW5hZ2VyIGlzIE93bmFibGUgewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwZXJtaXR0ZWRBZGRyZXNzZXM7CgogICAgZnVuY3Rpb24gYWRkQWRkcmVzcyhhZGRyZXNzIG5ld0FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHBlcm1pdHRlZEFkZHJlc3Nlc1tuZXdBZGRyZXNzXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlQWRkcmVzcyhhZGRyZXNzIHJlbUFkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHBlcm1pdHRlZEFkZHJlc3Nlc1tyZW1BZGRyZXNzXSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzUGVybWl0dGVkKGFkZHJlc3MgcEFkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIGlmIChwZXJtaXR0ZWRBZGRyZXNzZXNbcEFkZHJlc3NdKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IFJlZ2lzdHJ5IGlzIE93bmFibGUgewoKICBzdHJ1Y3QgQ29udHJpYnV0b3JEYXRhIHsKICAgIGJvb2wgaXNBY3RpdmU7CiAgICB1aW50IGNvbnRyaWJ1dGlvbkVUSDsKICAgIHVpbnQgY29udHJpYnV0aW9uVVNEOwogICAgdWludCB0b2tlbnNJc3N1ZWQ7CiAgICB1aW50IHF1b3RlVVNEOwogICAgdWludCBjb250cmlidXRpb25STlRCOwogIH0KICBtYXBwaW5nKGFkZHJlc3MgPT4gQ29udHJpYnV0b3JEYXRhKSBwdWJsaWMgY29udHJpYnV0b3JMaXN0OwogIG1hcHBpbmcodWludCA9PiBhZGRyZXNzKSBwcml2YXRlIGNvbnRyaWJ1dG9ySW5kZXhlczsKCiAgdWludCBwcml2YXRlIG5leHRDb250cmlidXRvckluZGV4OwoKICAvKiBQZXJtaXNzaW9uIG1hbmFnZXIgY29udHJhY3QgKi8KICBQZXJtaXNzaW9uTWFuYWdlciBwdWJsaWMgcGVybWlzc2lvbk1hbmFnZXI7CgogIGJvb2wgcHVibGljIGNvbXBsZXRlZDsKCiAgbW9kaWZpZXIgb25seVBlcm1pdHRlZCgpIHsKICAgIHJlcXVpcmUocGVybWlzc2lvbk1hbmFnZXIuaXNQZXJtaXR0ZWQobXNnLnNlbmRlcikpOwogICAgXzsKICB9CgogIGV2ZW50IENvbnRyaWJ1dGlvbkFkZGVkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IG92ZXJhbGxFdGgsIHVpbnQgb3ZlcmFsbFVTRCwgdWludCBvdmVyYWxsVG9rZW4sIHVpbnQgcXVvdGUpOwogIGV2ZW50IENvbnRyaWJ1dGlvbkVkaXRlZChhZGRyZXNzIF9jb250cmlidXRvciwgdWludCBvdmVyYWxsRXRoLCB1aW50IG92ZXJhbGxVU0QsICB1aW50IG92ZXJhbGxUb2tlbiwgdWludCBxdW90ZSk7CiAgZnVuY3Rpb24gUmVnaXN0cnkoYWRkcmVzcyBwTWFuYWdlcikgcHVibGljIHsKICAgIHBlcm1pc3Npb25NYW5hZ2VyID0gUGVybWlzc2lvbk1hbmFnZXIocE1hbmFnZXIpOyAKICAgIGNvbXBsZXRlZCA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gc2V0UGVybWlzc2lvbk1hbmFnZXIoYWRkcmVzcyBfcGVybWFkcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKF9wZXJtYWRyICE9IDB4MCk7CiAgICBwZXJtaXNzaW9uTWFuYWdlciA9IFBlcm1pc3Npb25NYW5hZ2VyKF9wZXJtYWRyKTsKICB9CgogIGZ1bmN0aW9uIGlzQWN0aXZlQ29udHJpYnV0b3IoYWRkcmVzcyBjb250cmlidXRvcikgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gY29udHJpYnV0b3JMaXN0W2NvbnRyaWJ1dG9yXS5pc0FjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZUNvbnRyaWJ1dGlvbihhZGRyZXNzIGNvbnRyaWJ1dG9yKSBwdWJsaWMgb25seVBlcm1pdHRlZCB7CiAgICBjb250cmlidXRvckxpc3RbY29udHJpYnV0b3JdLmlzQWN0aXZlID0gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBzZXRDb21wbGV0ZWQoYm9vbCBjb21wbCkgcHVibGljIG9ubHlQZXJtaXR0ZWQgewogICAgY29tcGxldGVkID0gY29tcGw7CiAgfQoKICBmdW5jdGlvbiBhZGRDb250cmlidXRpb24oYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCwgdWludCBfYW11c2QsIHVpbnQgX3Rva2VucywgdWludCBfcXVvdGUgKSBwdWJsaWMgb25seVBlcm1pdHRlZCB7CiAgICAKICAgIGlmIChjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5pc0FjdGl2ZSA9PSBmYWxzZSkgewogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25FVEggPSBfYW1vdW50OwogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblVTRCA9IF9hbXVzZDsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS50b2tlbnNJc3N1ZWQgPSBfdG9rZW5zOwogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnF1b3RlVVNEID0gX3F1b3RlOwoKICAgICAgICBjb250cmlidXRvckluZGV4ZXNbbmV4dENvbnRyaWJ1dG9ySW5kZXhdID0gX2NvbnRyaWJ1dG9yOwogICAgICAgIG5leHRDb250cmlidXRvckluZGV4Kys7CiAgICB9IGVsc2UgewogICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25FVEggKz0gX2Ftb3VudDsKICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uVVNEICs9IF9hbXVzZDsKICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0udG9rZW5zSXNzdWVkICs9IF90b2tlbnM7CiAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnF1b3RlVVNEID0gX3F1b3RlOwogICAgfQogICAgQ29udHJpYnV0aW9uQWRkZWQoX2NvbnRyaWJ1dG9yLCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25FVEgsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblVTRCwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0udG9rZW5zSXNzdWVkLCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5xdW90ZVVTRCk7CiAgfQoKICBmdW5jdGlvbiBlZGl0Q29udHJpYnV0aW9uKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9hbW91bnQsIHVpbnQgX2FtdXNkLCB1aW50IF90b2tlbnMsIHVpbnQgX3F1b3RlKSBwdWJsaWMgb25seVBlcm1pdHRlZCB7CiAgICBpZiAoY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uaXNBY3RpdmUgPT0gdHJ1ZSkgewogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvbkVUSCA9IF9hbW91bnQ7CiAgICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uVVNEID0gX2FtdXNkOwogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnRva2Vuc0lzc3VlZCA9IF90b2tlbnM7CiAgICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0ucXVvdGVVU0QgPSBfcXVvdGU7CiAgICB9CiAgICAgQ29udHJpYnV0aW9uRWRpdGVkKF9jb250cmlidXRvciwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uRVRILCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25VU0QsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnRva2Vuc0lzc3VlZCwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0ucXVvdGVVU0QpOwogIH0KCiAgZnVuY3Rpb24gYWRkQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCwgdWludCBfYW11c2QsIHVpbnQgX3Rva2VucywgdWludCBfcXVvdGUpIHB1YmxpYyBvbmx5UGVybWl0dGVkIHsKICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmlzQWN0aXZlID0gdHJ1ZTsKICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvbkVUSCA9IF9hbW91bnQ7CiAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25VU0QgPSBfYW11c2Q7CiAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS50b2tlbnNJc3N1ZWQgPSBfdG9rZW5zOwogICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0ucXVvdGVVU0QgPSBfcXVvdGU7CiAgICBjb250cmlidXRvckluZGV4ZXNbbmV4dENvbnRyaWJ1dG9ySW5kZXhdID0gX2NvbnRyaWJ1dG9yOwogICAgbmV4dENvbnRyaWJ1dG9ySW5kZXgrKzsKICAgIENvbnRyaWJ1dGlvbkFkZGVkKF9jb250cmlidXRvciwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uRVRILCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25VU0QsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnRva2Vuc0lzc3VlZCwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0ucXVvdGVVU0QpOwogCiAgfQoKICBmdW5jdGlvbiBnZXRDb250cmlidXRpb25FVEgoYWRkcmVzcyBfY29udHJpYnV0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvbkVUSDsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRyaWJ1dGlvblVTRChhZGRyZXNzIF9jb250cmlidXRvcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICByZXR1cm4gY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uVVNEOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uUk5UQihhZGRyZXNzIF9jb250cmlidXRvcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICByZXR1cm4gY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uUk5UQjsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRyaWJ1dGlvblRva2VucyhhZGRyZXNzIF9jb250cmlidXRvcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICByZXR1cm4gY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0udG9rZW5zSXNzdWVkOwogIH0KCiAgZnVuY3Rpb24gYWRkUk5UQkNvbnRyaWJ1dGlvbihhZGRyZXNzIF9jb250cmlidXRvciwgdWludCBfYW1vdW50KSBwdWJsaWMgb25seVBlcm1pdHRlZCB7CiAgICBpZiAoY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uaXNBY3RpdmUgPT0gZmFsc2UpIHsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uUk5UQiA9IF9hbW91bnQ7CiAgICAgICAgY29udHJpYnV0b3JJbmRleGVzW25leHRDb250cmlidXRvckluZGV4XSA9IF9jb250cmlidXRvcjsKICAgICAgICBuZXh0Q29udHJpYnV0b3JJbmRleCsrOwogICAgfSBlbHNlIHsKICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uRVRIICs9IF9hbW91bnQ7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRDb250cmlidXRvckJ5SW5kZXgodWludCBpbmRleCkgcHVibGljIHZpZXcgIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9ySW5kZXhlc1tpbmRleF07CiAgfQoKICBmdW5jdGlvbiBnZXRDb250cmlidXRvckFtb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gbmV4dENvbnRyaWJ1dG9ySW5kZXg7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8qKgogKiBAdGl0bGUgQ29udHJhY3QgdGhhdCB3aWxsIHdvcmsgd2l0aCBFUkMyMjMgdG9rZW5zLgogKi8KIApjb250cmFjdCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CgogIHN0cnVjdCBUS04gewogICAgYWRkcmVzcyBzZW5kZXI7CiAgICB1aW50IHZhbHVlOwogICAgYnl0ZXMgZGF0YTsKICAgIGJ5dGVzNCBzaWc7CiAgfQoKICAvKioKICAgKiBAZGV2IFN0YW5kYXJkIEVSQzIyMyBmdW5jdGlvbiB0aGF0IHdpbGwgaGFuZGxlIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KICAgKgogICAqIEBwYXJhbSBfZnJvbSAgVG9rZW4gc2VuZGVyIGFkZHJlc3MuCiAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zLgogICAqIEBwYXJhbSBfZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyBwdXJlIHsKICAgIFRLTiBtZW1vcnkgdGtuOwogICAgdGtuLnNlbmRlciA9IF9mcm9tOwogICAgdGtuLnZhbHVlID0gX3ZhbHVlOwogICAgdGtuLmRhdGEgPSBfZGF0YTsKICAgIGlmKF9kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgdWludDMyIHUgPSB1aW50MzIoX2RhdGFbM10pICsgKHVpbnQzMihfZGF0YVsyXSkgPDwgOCkgKyAodWludDMyKF9kYXRhWzFdKSA8PCAxNikgKyAodWludDMyKF9kYXRhWzBdKSA8PCAyNCk7CiAgICAgIHRrbi5zaWcgPSBieXRlczQodSk7CiAgICB9CgogICAgLyogdGtuIHZhcmlhYmxlIGlzIGFuYWxvZ3VlIG9mIG1zZyB2YXJpYWJsZSBvZiBFdGhlciB0cmFuc2FjdGlvbgogICAgKiAgdGtuLnNlbmRlciBpcyBwZXJzb24gd2hvIGluaXRpYXRlZCB0aGlzIHRva2VuIHRyYW5zYWN0aW9uICAgKGFuYWxvZ3VlIG9mIG1zZy5zZW5kZXIpCiAgICAqICB0a24udmFsdWUgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCB3ZXJlIHNlbnQgICAoYW5hbG9ndWUgb2YgbXNnLnZhbHVlKQogICAgKiAgdGtuLmRhdGEgaXMgZGF0YSBvZiB0b2tlbiB0cmFuc2FjdGlvbiAgIChhbmFsb2d1ZSBvZiBtc2cuZGF0YSkKICAgICogIHRrbi5zaWcgaXMgNCBieXRlcyBzaWduYXR1cmUgb2YgZnVuY3Rpb24KICAgICogIGlmIGRhdGEgb2YgdG9rZW4gdHJhbnNhY3Rpb24gaXMgYSBmdW5jdGlvbiBleGVjdXRpb24KICAgICovCiAgfQoKfQoKY29udHJhY3QgRVJDMjIzSW50ZXJmYWNlIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIGFsbG93ZWRBZGRyZXNzZXNPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhLCBzdHJpbmcgY3VzdG9tX2ZhbGxiYWNrKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvayk7CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpOwogIGV2ZW50IFRyYW5zZmVyQ29udHJhY3QoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSk7Cn0KCi8qKgogKiBAdGl0bGUgVW5pdHkgVG9rZW4gaXMgRVJDMjIzIHRva2VuLgogKiBAYXV0aG9yIFZsYWRpbWlyIEtvdmFsY2h1awogKi8KCmNvbnRyYWN0IFVuaXR5VG9rZW4gaXMgRVJDMjIzSW50ZXJmYWNlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlVuaXR5IFRva2VuIjsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJVTlQiOwogIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKCiAgLyogVGhlIHN1cHBseSBpcyBpbml0aWFsbHkgMTAwVU5UIHRvIHRoZSBwcmVjaXNpb24gb2YgMTggZGVjaW1hbHMgKi8KICB1aW50IHB1YmxpYyBjb25zdGFudCBJTklUSUFMX1NVUFBMWSA9IDEwMDAwMCAqICgxMCAqKiB1aW50KGRlY2ltYWxzKSk7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsgLy8gTGlzdCBvZiB1c2VyIGJhbGFuY2VzLgogIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBhbGxvd2VkQWRkcmVzc2VzOwoKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIGFkZEFsbG93ZWQoYWRkcmVzcyBuZXdBZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGFsbG93ZWRBZGRyZXNzZXNbbmV3QWRkcmVzc10gPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQWxsb3dlZChhZGRyZXNzIHJlbUFkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgYWxsb3dlZEFkZHJlc3Nlc1tyZW1BZGRyZXNzXSA9IGZhbHNlOwogIH0KCgogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAvKiBDb25zdHJ1Y3RvciBpbml0aWFsaXplcyB0aGUgb3duZXIncyBiYWxhbmNlIGFuZCB0aGUgc3VwcGx5ICAqLwogIGZ1bmN0aW9uIFVuaXR5VG9rZW4oKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgdG90YWxTdXBwbHkgPSBJTklUSUFMX1NVUFBMWTsKICAgIGJhbGFuY2VzW293bmVyXSA9IElOSVRJQUxfU1VQUExZOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG90YWxTdXBwbHk7CiAgfQoKICAvLyBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBhbm90aGVyIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzIC4KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhLCBzdHJpbmcgX2N1c3RvbV9mYWxsYmFjaykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgaWYgKGlzQ29udHJhY3QoX3RvKSkgewogICAgICByZXF1aXJlKGFsbG93ZWRBZGRyZXNzZXNbX3RvXSk7CiAgICAgIGlmIChiYWxhbmNlT2YobXNnLnNlbmRlcikgPCBfdmFsdWUpCiAgICAgICAgcmV2ZXJ0KCk7CgogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgYXNzZXJ0KF90by5jYWxsLnZhbHVlKDApKGJ5dGVzNChrZWNjYWsyNTYoX2N1c3RvbV9mYWxsYmFjaykpLCBtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKSk7CiAgICAgIFRyYW5zZmVyQ29udHJhY3QobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBlbHNlIHsKICAgICAgcmV0dXJuIHRyYW5zZmVyVG9BZGRyZXNzKF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICB9CiAgfQoKCiAgLy8gRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIHVzZXIgb3IgYW5vdGhlciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcyAuCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIGlmIChpc0NvbnRyYWN0KF90bykpIHsKICAgICAgcmV0dXJuIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRyYW5zZmVyVG9BZGRyZXNzKF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICB9CiAgfQoKICAvLyBTdGFuZGFyZCBmdW5jdGlvbiB0cmFuc2ZlciBzaW1pbGFyIHRvIEVSQzIwIHRyYW5zZmVyIHdpdGggbm8gX2RhdGEgLgogIC8vIEFkZGVkIGR1ZSB0byBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSByZWFzb25zIC4KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vc3RhbmRhcmQgZnVuY3Rpb24gdHJhbnNmZXIgc2ltaWxhciB0byBFUkMyMCB0cmFuc2ZlciB3aXRoIG5vIF9kYXRhCiAgICAvL2FkZGVkIGR1ZSB0byBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSByZWFzb25zCiAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICBpZiAoaXNDb250cmFjdChfdG8pKSB7CiAgICAgIHJldHVybiB0cmFuc2ZlclRvQ29udHJhY3QoX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgIH0KICAgIGVsc2UgewogICAgICByZXR1cm4gdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgIH0KICB9CgogIC8vYXNzZW1ibGUgdGhlIGdpdmVuIGFkZHJlc3MgYnl0ZWNvZGUuIElmIGJ5dGVjb2RlIGV4aXN0cyB0aGVuIHRoZSBfYWRkciBpcyBhIGNvbnRyYWN0LgogIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wgaXNfY29udHJhY3QpIHsKICAgIHVpbnQgbGVuZ3RoOwogICAgYXNzZW1ibHkgewogICAgLy9yZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICBsZW5ndGggOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICB9CiAgICByZXR1cm4gKGxlbmd0aCA+IDApOwogIH0KCiAgLy9mdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRyYW5zYWN0aW9uIHRhcmdldCBpcyBhbiBhZGRyZXNzCiAgZnVuY3Rpb24gdHJhbnNmZXJUb0FkZHJlc3MoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGlmIChiYWxhbmNlT2YobXNnLnNlbmRlcikgPCBfdmFsdWUpCiAgICAgIHJldmVydCgpOwogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy9mdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRyYW5zYWN0aW9uIHRhcmdldCBpcyBhIGNvbnRyYWN0CiAgZnVuY3Rpb24gdHJhbnNmZXJUb0NvbnRyYWN0KGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXF1aXJlKGFsbG93ZWRBZGRyZXNzZXNbX3RvXSk7CiAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKQogICAgICByZXZlcnQoKTsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2sobXNnLnNlbmRlciwgX3ZhbHVlLCBfZGF0YSk7CiAgICBUcmFuc2ZlckNvbnRyYWN0KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKICBmdW5jdGlvbiBhbGxvd2VkQWRkcmVzc2VzT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgYWxsb3dlZCkgewogICAgcmV0dXJuIGFsbG93ZWRBZGRyZXNzZXNbX293bmVyXTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgSG9sZCAgY29udHJhY3QuCiAqIEBhdXRob3IgVmxhZGltaXIgS292YWxjaHVrCiAqLwpjb250cmFjdCBIb2xkIGlzIE93bmFibGUgewoKICAgIHVpbnQ4IHN0YWdlcyA9IDU7CiAgICB1aW50OCBwdWJsaWMgcGVyY2VudGFnZTsKICAgIHVpbnQ4IHB1YmxpYyBjdXJyZW50U3RhZ2U7CiAgICB1aW50IHB1YmxpYyBpbml0aWFsQmFsYW5jZTsKICAgIHVpbnQgcHVibGljIHdpdGhkcmF3ZWQ7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnOwogICAgUmVnaXN0cnkgcmVnaXN0cnk7CgogICAgUGVybWlzc2lvbk1hbmFnZXIgcHVibGljIHBlcm1pc3Npb25NYW5hZ2VyOwogICAgdWludCBuZXh0Q29udHJpYnV0b3JUb1RyYW5zZmVyRXRoOwogICAgYWRkcmVzcyBwdWJsaWMgb2JzZXJ2ZXI7CiAgICB1aW50IGRhdGVEZXBsb3llZDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIGhhc1dpdGhkcmF3ZWRFdGg7CgogICAgZXZlbnQgSW5pdGlhbEJhbGFuY2VDaGFuZ2VkKHVpbnQgYmFsYW5jZSk7CiAgICBldmVudCBFdGhSZWxlYXNlZCh1aW50IGV0aHJlbGVhc2VkKTsKICAgIGV2ZW50IEV0aFJlZnVuZGVkKGFkZHJlc3MgY29udHJpYnV0b3IsIHVpbnQgZXRocmVmdW5kZWQpOwogICAgZXZlbnQgU3RhZ2VDaGFuZ2VkKHVpbnQ4IG5ld1N0YWdlKTsKICAgIGV2ZW50IEV0aFJldHVybmVkVG9Pd25lcihhZGRyZXNzIG93bmVyLCB1aW50IGJhbGFuY2UpOwoKICAgIG1vZGlmaWVyIG9ubHlQZXJtaXR0ZWQoKSB7CiAgICAgICAgcmVxdWlyZShwZXJtaXNzaW9uTWFuYWdlci5pc1Blcm1pdHRlZChtc2cuc2VuZGVyKSB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPYnNlcnZlcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb2JzZXJ2ZXIgfHwgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBIb2xkKGFkZHJlc3MgX211bHRpc2lnLCB1aW50IGNhcCwgYWRkcmVzcyBwbSwgYWRkcmVzcyByZWdpc3RyeUFkZHJlc3MsIGFkZHJlc3Mgb2JzZXJ2ZXJBZGRyKSBwdWJsaWMgewogICAgICAgIHBlcmNlbnRhZ2UgPSAxMDAgLyBzdGFnZXM7CiAgICAgICAgY3VycmVudFN0YWdlID0gMDsKICAgICAgICBtdWx0aXNpZyA9IF9tdWx0aXNpZzsKICAgICAgICBpbml0aWFsQmFsYW5jZSA9IGNhcDsKICAgICAgICBkYXRlRGVwbG95ZWQgPSBub3c7CiAgICAgICAgcGVybWlzc2lvbk1hbmFnZXIgPSBQZXJtaXNzaW9uTWFuYWdlcihwbSk7CiAgICAgICAgcmVnaXN0cnkgPSBSZWdpc3RyeShyZWdpc3RyeUFkZHJlc3MpOwogICAgICAgIG9ic2VydmVyID0gb2JzZXJ2ZXJBZGRyOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFBlcm1pc3Npb25NYW5hZ2VyKGFkZHJlc3MgX3Blcm1hZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3Blcm1hZHIgIT0gMHgwKTsKICAgICAgICBwZXJtaXNzaW9uTWFuYWdlciA9IFBlcm1pc3Npb25NYW5hZ2VyKF9wZXJtYWRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRPYnNlcnZlcihhZGRyZXNzIG9ic2VydmVyQWRkcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShvYnNlcnZlckFkZHIgIT0gMHgwKTsKICAgICAgICBvYnNlcnZlciA9IG9ic2VydmVyQWRkcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRJbml0aWFsQmFsYW5jZSh1aW50IGluQmFsKSBwdWJsaWMgewogICAgICAgIGluaXRpYWxCYWxhbmNlID0gaW5CYWw7CiAgICAgICAgSW5pdGlhbEJhbGFuY2VDaGFuZ2VkKGluQmFsKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWxlYXNlQWxsRVRIKCkgb25seVBlcm1pdHRlZCBwdWJsaWMgewogICAgICAgIHVpbnQgYmFsUmVsZWFzZWQgPSBnZXRCYWxhbmNlUmVsZWFzZWQoKTsKICAgICAgICByZXF1aXJlKGJhbFJlbGVhc2VkID4gMCk7CiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gYmFsUmVsZWFzZWQpOwogICAgICAgIG11bHRpc2lnLnRyYW5zZmVyKGJhbFJlbGVhc2VkKTsKICAgICAgICB3aXRoZHJhd2VkICs9IGJhbFJlbGVhc2VkOwogICAgICAgIEV0aFJlbGVhc2VkKGJhbFJlbGVhc2VkKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWxlYXNlRVRIKHVpbnQgbikgb25seVBlcm1pdHRlZCBwdWJsaWMgewogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IG4pOwogICAgICAgIHJlcXVpcmUoZ2V0QmFsYW5jZVJlbGVhc2VkKCkgPj0gbik7CiAgICAgICAgbXVsdGlzaWcudHJhbnNmZXIobik7CiAgICAgICAgd2l0aGRyYXdlZCArPSBuOwogICAgICAgIEV0aFJlbGVhc2VkKG4pOwogICAgfSAKCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlU3RhZ2VBbmRSZWxlYXNlRVRIKCkgcHVibGljIG9ubHlPYnNlcnZlciB7CiAgICAgICAgdWludDggbmV3U3RhZ2UgPSBjdXJyZW50U3RhZ2UgKyAxOwogICAgICAgIHJlcXVpcmUobmV3U3RhZ2UgPD0gc3RhZ2VzKTsKICAgICAgICBjdXJyZW50U3RhZ2UgPSBuZXdTdGFnZTsKICAgICAgICBTdGFnZUNoYW5nZWQobmV3U3RhZ2UpOwogICAgICAgIHJlbGVhc2VBbGxFVEgoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VTdGFnZSgpIHB1YmxpYyBvbmx5T2JzZXJ2ZXIgewogICAgICAgIHVpbnQ4IG5ld1N0YWdlID0gY3VycmVudFN0YWdlICsgMTsKICAgICAgICByZXF1aXJlKG5ld1N0YWdlIDw9IHN0YWdlcyk7CiAgICAgICAgY3VycmVudFN0YWdlID0gbmV3U3RhZ2U7CiAgICAgICAgU3RhZ2VDaGFuZ2VkKG5ld1N0YWdlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlUmVsZWFzZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGluaXRpYWxCYWxhbmNlICogcGVyY2VudGFnZSAqIGN1cnJlbnRTdGFnZSAvIDEwMCAtIHdpdGhkcmF3ZWQgOwogICAgfQoKICAgIGZ1bmN0aW9uIHJldHVybkVUSEJ5T3duZXIoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGRhdGVEZXBsb3llZCArIDE4MyBkYXlzKTsKICAgICAgICB1aW50IGJhbGFuY2UgPSBnZXRCYWxhbmNlKCk7CiAgICAgICAgb3duZXIudHJhbnNmZXIoZ2V0QmFsYW5jZSgpKTsKICAgICAgICBFdGhSZXR1cm5lZFRvT3duZXIob3duZXIsIGJhbGFuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlZnVuZCh1aW50IF9udW1iZXJPZlJldHVybnMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX251bWJlck9mUmV0dXJucyA+IDApOwogICAgICAgIGFkZHJlc3MgY3VycmVudFBhcnRpY2lwYW50QWRkcmVzczsKCiAgICAgICAgZm9yICh1aW50IGNudCA9IDA7IGNudCA8IF9udW1iZXJPZlJldHVybnM7IGNudCsrKSB7CiAgICAgICAgICAgIGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3MgPSByZWdpc3RyeS5nZXRDb250cmlidXRvckJ5SW5kZXgobmV4dENvbnRyaWJ1dG9yVG9UcmFuc2ZlckV0aCk7CiAgICAgICAgICAgIGlmIChjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzID09IDB4MCkgCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoIWhhc1dpdGhkcmF3ZWRFdGhbY3VycmVudFBhcnRpY2lwYW50QWRkcmVzc10pIHsKICAgICAgICAgICAgICAgIHVpbnQgRXRoQW1vdW50ID0gcmVnaXN0cnkuZ2V0Q29udHJpYnV0aW9uRVRIKGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3MpOwogICAgICAgICAgICAgICAgRXRoQW1vdW50IC09ICBFdGhBbW91bnQgKiAocGVyY2VudGFnZSAvIDEwMCAqIGN1cnJlbnRTdGFnZSk7CgogICAgICAgICAgICAgICAgY3VycmVudFBhcnRpY2lwYW50QWRkcmVzcy50cmFuc2ZlcihFdGhBbW91bnQpOwogICAgICAgICAgICAgICAgRXRoUmVmdW5kZWQoY3VycmVudFBhcnRpY2lwYW50QWRkcmVzcywgRXRoQW1vdW50KTsKICAgICAgICAgICAgICAgIGhhc1dpdGhkcmF3ZWRFdGhbY3VycmVudFBhcnRpY2lwYW50QWRkcmVzc10gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHRDb250cmlidXRvclRvVHJhbnNmZXJFdGggKz0gMTsKICAgICAgICB9CiAgICAgICAgCiAgICB9ICAKCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKCiAgICB9CgogIGZ1bmN0aW9uIGdldFdpdGhkcmF3ZWQoYWRkcmVzcyBjb250cmliKSBwdWJsaWMgb25seVBlcm1pdHRlZCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBoYXNXaXRoZHJhd2VkRXRoW2NvbnRyaWJdOwogIH0KfQ=='.
	

]
