Class {
	#name : #SRT43c264a5df8717fa5a185006429266ef15193edc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT43c264a5df8717fa5a185006429266ef15193edc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KIAovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICAgIAogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogCiAgCiAKfQoKCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewogCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KCiAKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwogCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CiAKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogICAgCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQogCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KICAKICAKCiAKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsgICAgICAKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQogIAoKIAp9CiAKIAogCiAKCiAKCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CiAgCiAgCiAgIGZ1bmN0aW9uIHBvdyh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgaWYoYj09MCkgcmV0dXJuIDE7CiAgICBhc3NlcnQoYj49MCk7CiAgICB1aW50MjU2IGMgPSBhICoqIGI7CiAgICBhc3NlcnQoYz49YSApOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CiAgCgoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KICAKZnVuY3Rpb24gY29tcG91bmRJbnRlcmVzdCh1aW50MjU2IGRlcG8sIHVpbnQyNTYgc3RhZ2UyLCB1aW50MjU2IHN0YXJ0LCB1aW50MjU2IGN1cnJlbnQpICBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpICB7CiAgICAgICAgICAgIGlmKGN1cnJlbnQ8c3RhcnQgfHwgc3RhcnQ8c3RhZ2UyIHx8IGN1cnJlbnQ8c3RhZ2UyKSByZXR1cm4gZGVwbzsKCiAgICAgICAgICAgIHVpbnQyNTYgcmV0PWRlcG87IHVpbnQyNTYgZzsgdWludDI1NiBkOwogICAgICAgICAgICBzdGFnZTI9c3RhZ2UyLzEgZGF5czsKICAgICAgICAgICAgc3RhcnQ9c3RhcnQvMSBkYXlzOwogICAgICAgICAgICBjdXJyZW50PWN1cnJlbnQvMSBkYXlzOwogICAgCgkJCXVpbnQyNTYgZHBlcmNlbnQ9MTAwOwoJCQl1aW50MjU2IGk9c3RhcnQ7CgkJCQoJCQlpZihpLXN0YWdlMj4zNjUpIGRwZXJjZW50PTIwMDsKCQkJaWYoaS1zdGFnZTI+NzMwKSBkcGVyY2VudD0xMDAwOwkJCQoJCQkKCQkJd2hpbGUoaTxjdXJyZW50KQoJCQl7CgoJCQkJZz1pLXN0YWdlMjsJCQkKCQkJCWlmKGc+MjY1ICYmIGc8PTM2NSkgCgkJCQl7CQkKCQkJCSAgICBkPTM2NS1nOwoJCQkJCWlmKGQ+PShjdXJyZW50LXN0YXJ0KSkgIGQ9KGN1cnJlbnQtc3RhcnQpOwoJCQkJCXJldD1mcmFjRXhwKHJldCwgZHBlcmNlbnQsIGQsIDgpOwoJCQkJICAgIGkrPWQ7CgkJCQkJZHBlcmNlbnQ9MjAwOwoJCQkJfQoJCQkJaWYoZz42MzAgJiYgZzw9NzMwKSAKCQkJCXsJCQkJCgkJCQkJZD03MzAtZzsJCgkJCQkJaWYoZD49KGN1cnJlbnQtc3RhcnQpKSAgZD0oY3VycmVudC1zdGFydCk7CQkJCQkKCQkJCQlyZXQ9ZnJhY0V4cChyZXQsIGRwZXJjZW50LCBkLCA4KTsKCQkJCQlpKz1kOwoJCQkJCWRwZXJjZW50PTEwMDA7CQkJCQkKCQkJCX0KCQkJCWVsc2UgaWYoZz43MzApIGRwZXJjZW50PTEwMDA7CQkJCQoJCQkJZWxzZSBpZihnPjM2NSkgZHBlcmNlbnQ9MjAwOwoJCQkJCgkJCQlpZihpKzEwMDxjdXJyZW50KSByZXQ9ZnJhY0V4cChyZXQsIGRwZXJjZW50LCAxMDAsIDgpOwoJCQkJZWxzZSByZXR1cm4gZnJhY0V4cChyZXQsIGRwZXJjZW50LCBjdXJyZW50LWksIDgpOwoJCQkJaSs9MTAwOwoJCQkJCgkJCX0KCgkJCXJldHVybiByZXQ7CgkJCQoJCQkKICAgIAogICAgCgl9CgoKZnVuY3Rpb24gZnJhY0V4cCh1aW50MjU2IGRlcG8sIHVpbnQyNTYgcGVyY2VudCwgdWludDI1NiBwZXJpb2QsIHVpbnQyNTYgcCkgIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogIHVpbnQyNTYgcyA9IDA7CiAgdWludDI1NiBOID0gMTsKICB1aW50MjU2IEIgPSAxOwogIAoKICAKICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBwOyArK2kpewogICAgcyArPSBkZXBvICogTiAvIEIgLyAocGVyY2VudCoqaSk7CiAgICBOICA9IE4gKiAocGVyaW9kLWkpOwogICAgQiAgPSBCICogKGkrMSk7CiAgfQogIHJldHVybiBzOwp9CgoKCgoKCgp9CgoKCmNvbnRyYWN0IE1NTVRva2VuQ29pbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiTWFrZSBNb3JlIE1vbmV5IjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIk1NTSI7CiAgICB1aW50MzIgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMjsKICAgIAoJCgkvLyBEYXRlcwoJdWludDI1NiBwdWJsaWMgc3RhZ2UyU3RhcnRUaW1lOwkJCQkJLy8gdGltZXN0YW1wIHdoZW4gY29tcG91bmQgaW50ZXJlc3Qgd2lsbCBiZWdpbgogICAgdWludDI1NiBnbG9iYWxJbnRlcmVzdERhdGU7ICAgICAgICAgICAgIC8vIGxhc3QgZGF0ZSB3aGVuIGFtb3VudCBvZiB0b2tlbnMgd2l0aCBpbnRlcmVzdCB3YXMgY2hhbmdlZAogICAgdWludDI1NiBnbG9iYWxJbnRlcmVzdEFtb3VudDsgICAgICAgICAgIC8vIGFtb3VudCBvZiB0b2tlbnMgd2l0aCBpbnRlcmVzdAoJbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGRhdGVPZlN0YXJ0OyAgICAgLy8gdGltZXN0YW1wIG9mIGxhc3Qgb3BlcmF0aW9uLCBmcm9tIHdoaWNoIGludGVyZXN0IGNhbGMgd2lsbCBiZSBzdGFydGVkCgl1aW50MjU2IHB1YmxpYyBjdXJyZW50RGF0ZTsJCQkJCQkvLyBjdXJyZW50IGRhdGUgdGltZXN0YW1wCgl1aW50MjU2IHB1YmxpYyBkZWJ1Z05vdz0wOwoKCgogICAgLy8gQ3Jvd2RzYWxlIAogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk9OTk5MDAwMDAwMDA7CQkJCiB1aW50MjU2IHB1YmxpYyAgc29mdGNhcDsKICAgIHVpbnQyNTYgcHVibGljICBzdGVwMFJhdGU9MTAwMDAwOyAgICAgICAvLyByYXRlIG9mIG91ciB0b2tlbnMuIDEgZXRoID0gMTAwMCBNTU0gY29pbnMgPSAxMDAwMDAgdG9rZW5zIChzZWVuIGFzIDEwMDAsMDAgYmVjYXVzZSBvZiBkZWNpbWFscykKICAgIHVpbnQyNTYgcHVibGljICBjdXJyZW50UmF0ZT0xMDAwMDA7ICAgCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlbnNGb3JPd25lcj0yMDAwMDAwMDAwOyAgIC8vIHRva2VucyBmb3Igb3duZXIgd29uJ3QgZGVhbHQgd2l0aCBjb21wb3VuZCBpbnRlcmVzdAogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRnJvbUV0aGVyPTA7CiAgICB1aW50IHB1YmxpYyBzYWxlU3RhdHVzPTA7ICAgICAgLy8gMCAtIHNhbGUgaXMgcnVubmluZywgMSAtIHNhbGUgZmFpbGVkLCAyIC0gc2FsZSBzdWNjZXNzZnVsCiAgICBhZGRyZXNzIG11bHRpc2lnPTB4ODIxNkE1OTU4ZjA1YWQ2MTg5OGUzQTZGOTdhZTUxMThDMGU0YjFBNjsKICAgIC8vIGNvdW50ZXJzIG9mIHRva2VucyBmb3IgZnV0aGVyIHJlZnVuZAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJvdWdodFdpdGhFdGhlcjsgICAgICAgICAgICAgICAgLy8gdG9rZW5zLCBib3VnaHQgd2l0aCBldGhlci4gY2FuIGJlIHJlZnVuZGVkIHRvIGV0aGVyCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYm91Z2h0V2l0aE90aGVyOyAgICAJCQkvLyB0b2tlbnMsIGJvdWdodCB3aXRoIG90aGVyIHBheW1lbnQgc3lzdGVtcy4gY2FuIGJlIHJlZnVuZGVkIHRvIG90aGVyIHBheW1lbnQgc3lzdGVtcywgdXNpbmcgc2l0ZQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJvdW50eUFuZFJlZnNXaXRoRXRoZXI7ICAJCS8vIGJvdW50eSB0b2tlbnMsIGdpdmVuIHRvIHNvbWUgcGVvcGxlLiBjYW4gYmUgY29udmVydGVkIHRvIGV0aGVyLCBpZiBpY28gaXMgc3VjY2VlZAogIAogICAgCgoJCQoJCQogICAgLy8gZXZlbnRzCiAgICBldmVudCBSZWZ1bmRFdGhlcihhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdG9rZW5zLCB1aW50MjU2IGV0aCk7IAogICAgZXZlbnQgRGF0ZVVwZGF0ZWQodWludDI1NiBjZGF0ZSk7ICAgIAogICAgZXZlbnQgRGVidWdMb2coc3RyaW5nIHdoYXQsIHVpbnQyNTYgcGFyYW0pOwogICAgZXZlbnQgU2FsZShhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFN0ZXAwRmluaXNoZWQoKTsKICAgIGV2ZW50IFJhdGVTZXQodWludDI1NiBuZXdSYXRlKTsJCiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCB3aG8sIHVpbnQyNTYgYW1vdW50KTsKICAgLy8gREVCVUcKCiAgICBib29sIGJEYmdFbmFibGVkPWZhbHNlOwoJCgkKCQogICAgZnVuY3Rpb24gTU1NVG9rZW5Db2luKCkgcHVibGljICAgeyAgCiAgICAgICAgLy8gQ3Jvd2RzYWxlICAgICAKICAgICAgICBjdXJyZW50RGF0ZT0oZ2V0Tm93KCkvMSBkYXlzKSoxIGRheXM7CiAgICAgICAgc3RhZ2UyU3RhcnRUaW1lPWdldE5vdygpKzYxIGRheXM7CiAgICAgICAgCiAgICAgICAgYmFsYW5jZXNbb3duZXJdPXRva2Vuc0Zvck93bmVyOwogICAgICAgIGdsb2JhbEludGVyZXN0QW1vdW50PTA7CiAgICAgICAgCiAgICAgICAgaWYoYkRiZ0VuYWJsZWQpIHNvZnRjYXA9MjAwMDA7CiAgICAgICAgZWxzZSAgc29mdGNhcD01MDAwMDAwMDsKICAgIH0KCQoJCglmdW5jdGlvbiBkZWJ1Z1NldE5vdyh1aW50MjU2IG4pIHB1YmxpYwoJewoJICAgIHJlcXVpcmUoYkRiZ0VuYWJsZWQpOwoJCWRlYnVnTm93PW47Cgl9CgkKCQoJIC8qKgogICAgICogQGRldiBSZXR1cm5zIGN1cnJlbnQgdGltZXN0YW1wLiBJbiBjYXNlIG9mIGRlYnVnZ2luZywgdGhpcyBmdW5jdGlvbiBjYW4gcmV0dXJuIHRpbWVzdGFtcCByZXByZXNlbnRpbmcgYW55IG90aGVyIHRpbWUKICAgICAqLwogICAgIAogICAgIAoJZnVuY3Rpb24gZ2V0Tm93KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikKCXsKCSAgICAKCSAgICBpZighYkRiZ0VuYWJsZWQpIHJldHVybiBub3c7CgkgICAgCgkgICAgaWYoZGVidWdOb3c9PTApIHJldHVybiBub3c7CgkJZWxzZSByZXR1cm4gZGVidWdOb3c7Ci8vCQlyZXR1cm4gbm93OwoJfQogICAKICAgIC8qKgogICAgICogQGRldiBTZXRzIGRhdGUgZnJvbSB3aGljaCBpbnRlcmVzdCB3aWxsIGJlIGNhbGN1bGF0ZWQgZm9yIHNwZWNpZmllZCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX293bmVyIC0gYWRkcmVzcyBvZiBiYWxhbmNlIG93bmVyCiAgICAgKi8KICAgCiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZURhdGUoYWRkcmVzcyBfb3duZXIpIHByaXZhdGUgewogICAgICAgIGlmKGN1cnJlbnREYXRlPHN0YWdlMlN0YXJ0VGltZSkgZGF0ZU9mU3RhcnRbX293bmVyXT1zdGFnZTJTdGFydFRpbWU7CiAgICAgICAgZWxzZSBkYXRlT2ZTdGFydFtfb3duZXJdPWN1cnJlbnREYXRlOwogICAgfQogICAgCgoJCiAgICAvKioKICAgICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIAogICAgKiBAcmV0dXJuIEFuIHVpbnQyNTY2NCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSAKICAgIHsgCiAgICAgICAgCiAgICAgICAgIHJldHVybiBiYWxhbmNlV2l0aEludGVyZXN0KF9vd25lcik7CiAgICB9ICAgCiAgIAoJCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBiYWxhbmNlIGluY2x1ZGluZyBpbnRlcmVzdCBmb3Igc3BlY2lmaWVkIGFkZHJlc3MKICAgCSAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAgICAqLwoJCQoJCQogICAgZnVuY3Rpb24gYmFsYW5jZVdpdGhJbnRlcmVzdChhZGRyZXNzIF9vd25lcikgIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZXQpCiAgICB7CiAgICAgICAgaWYoIF9vd25lcj09b3duZXIgfHwgc2FsZVN0YXR1cyE9MikgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07IAogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdLmNvbXBvdW5kSW50ZXJlc3Qoc3RhZ2UyU3RhcnRUaW1lLCBkYXRlT2ZTdGFydFtfb3duZXJdLCBjdXJyZW50RGF0ZSk7CiAgICB9CiAgICAKICAgIAogICAgCiAgICAKICAgIAoKCiAgICAvKioKICAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAqLwoJCSAKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpICBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgaWYobXNnLnNlbmRlcj09b3duZXIpIHsKICAgIAkvLyBpZiBvd25lciBzZW5kcyB0b2tlbnMgYmVmb3JlIHNhbGUgZmluaXNoLCBjb25zaWRlciB0aGVuIGFzIGV0aGVyLXJlZnVuZGFibGUgYm9udXMKICAgIAkvLyBlbHNlIGFzIHNpbXBsZSB0cmFuc2ZlcgogICAgICAgIGlmKHNhbGVTdGF0dXM9PTApIHsKICAgICAgICAgICAgCXRyYW5zZmVyRnJvbU93bmVyKF90bywgX3ZhbHVlLDEpOwogICAgICAgICAgICAJdG9rZW5zRnJvbUV0aGVyPXRva2Vuc0Zyb21FdGhlci5hZGQoX3ZhbHVlKTsKCQkJCWJvdW50eUFuZFJlZnNXaXRoRXRoZXJbX3RvXT1ib3VudHlBbmRSZWZzV2l0aEV0aGVyW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgCX0KICAgICAgICAJZWxzZSB0cmFuc2ZlckZyb21Pd25lcihfdG8sIF92YWx1ZSwwKTsKICAgICAgICAJCiAgICAgICAgCWluY3JlYXNlR2xvYmFsSW50ZXJlc3RBbW91bnQoX3ZhbHVlKTsKICAgICAgICAJcmV0dXJuIHRydWU7ICAgCiAgICB9CiAgICAKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZVdpdGhJbnRlcmVzdChtc2cuc2VuZGVyKS5zdWIoX3ZhbHVlKTsKCiAgICBlbWl0IFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIGlmKF90bz09YWRkcmVzcyh0aGlzKSkgewoJCS8vIG1ha2UgcmVmdW5kIGlmIHRva2VucyBzZW50IHRvIGNvbnRyYWN0CiAgICAgICAgdWludDI1NiBsZWZ0OyBsZWZ0PXByb2Nlc3NSZWZ1bmRFdGhlcihtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdPWJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChsZWZ0KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlV2l0aEludGVyZXN0KF90bykuYWRkKF92YWx1ZSk7CiAgICAgICAgdXBkYXRlRGF0ZShfdG8pOwogICAgfQogICAgCiAgICBpZihfdG89PW93bmVyKSAKICAgIHsKICAgIAkvLyBiZWZvcmUgc2FsZSBmaW5pc2gsIHRva2VucyBjYW4ndCBiZSBzZW50IHRvIG93bmVyCiAgICAgICAgcmVxdWlyZShzYWxlU3RhdHVzIT0wKTsKICAgICAgICBkZWNyZWFzZUdsb2JhbEludGVyZXN0QW1vdW50KF92YWx1ZSk7CiAgICB9CiAgICAKICAgIHVwZGF0ZURhdGUobXNnLnNlbmRlcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCiAgCiAgLyoqCiAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAgKi8KCSAgCiAgCiAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgcmVxdWlyZShfdG8hPW93bmVyKTsKICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CgogICAgaWYoX2Zyb209PW93bmVyKSB7CiAgICAgICAgaWYoc2FsZVN0YXR1cz09MCkgewogICAgICAgICAgICB0cmFuc2ZlckZyb21Pd25lcihfdG8sIF92YWx1ZSwxKTsKICAgICAgICAgICAgdG9rZW5zRnJvbUV0aGVyPXRva2Vuc0Zyb21FdGhlci5hZGQoX3ZhbHVlKTsKCQkJYm91bnR5QW5kUmVmc1dpdGhFdGhlcltfdG9dPWJvdW50eUFuZFJlZnNXaXRoRXRoZXJbX3RvXS5hZGQoX3ZhbHVlKTsJCQkKICAgICAgICB9CiAgICAgICAgZWxzZSB0cmFuc2ZlckZyb21Pd25lcihfdG8sIF92YWx1ZSwwKTsKICAgICAgCiAgICAgICAgaW5jcmVhc2VHbG9iYWxJbnRlcmVzdEFtb3VudChfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgIAogICAgIAogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZVdpdGhJbnRlcmVzdChfZnJvbSkuc3ViKF92YWx1ZSk7CgogICAgIGVtaXQgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCiAgICBpZihfdG89PWFkZHJlc3ModGhpcykpIHsKCQkvLyBtYWtlIHJlZnVuZCBpZiB0b2tlbnMgc2VudCB0byBjb250cmFjdAkJICAgCiAgICAgICAgdWludDI1NiBsZWZ0OyBsZWZ0PXByb2Nlc3NSZWZ1bmRFdGhlcihfZnJvbSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV09YmFsYW5jZXNbX2Zyb21dLmFkZChsZWZ0KTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlV2l0aEludGVyZXN0KF90bykuYWRkKF92YWx1ZSk7CiAgICAgICAgdXBkYXRlRGF0ZShfdG8pOwogICAgfQogICAgCiAgICBpZihfdG89PW93bmVyKSAKICAgIHsKICAgICAgICByZXF1aXJlKHNhbGVTdGF0dXMhPTApOwogICAgICAgIGRlY3JlYXNlR2xvYmFsSW50ZXJlc3RBbW91bnQoX3ZhbHVlKTsKICAgIH0KCiAgICB1cGRhdGVEYXRlKF9mcm9tKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCiAgCiAgCiAgICAvKioKICAgICogQGRldiBCdXJucyB0b2tlbnMKICAgICogQHBhcmFtIF9hbW91bnQgYW1vdW50IG9mIHRva2VucyB0byBidXJuCiAgICAqLwoJICAKCSAgCgkgIAogIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfYW1vdW50KSBwdWJsaWMgCiAgewoJICAJcmVxdWlyZShfYW1vdW50PjApOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdPWJhbGFuY2VPZihtc2cuc2VuZGVyKS5zdWIoX2Ftb3VudCk7CgkJZGVjcmVhc2VHbG9iYWxJbnRlcmVzdEFtb3VudChfYW1vdW50KTsKICAgICAgICBlbWl0IEJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgfQogICAKICAgLy8vLyBTQUxFIC8vLy8KICAgCiAgICAvKioKICAgICAqIEBkZXYgdXBkYXRlcyByYXRlIHdpdGggd2hpYyB0b2tlbnMgYXJlIGJlaW5nIHNvbGQKICAgICAqLwoKIAlmdW5jdGlvbiBzZXRSYXRlKHVpbnQyNTYgcikgcHVibGljIHsKCQlyZXF1aXJlKHNhbGVTdGF0dXMhPTApOwoJCWN1cnJlbnRSYXRlPXI7CgkJZW1pdCBSYXRlU2V0KGN1cnJlbnRSYXRlKTsKCX0KCiAgICAvKioKICAgICAqIEBkZXYgdXBkYXRlcyBjdXJyZW50IGRhdGUgdmFsdWUuIEZvciBjb21wb3VuZCBpbnRlcmVzdCBjYWxjdWxhdGlvbgogICAgICovCiAgICAKICAgIGZ1bmN0aW9uIG5ld0RheSgpIHB1YmxpYyAgIHJldHVybnMgKGJvb2wgYikKICAgIHsKICAgICAgICAKICAgICAgIHVpbnQyNTYgZzsgdWludDI1NiBuZXdEYXRlOwogICAgICAgcmVxdWlyZShnZXROb3coKT49c3RhZ2UyU3RhcnRUaW1lKTsKICAgICAgIHJlcXVpcmUoZ2V0Tm93KCk+PWN1cnJlbnREYXRlKTsKICAgICAgIG5ld0RhdGU9KGdldE5vdygpLzEgZGF5cykqMSBkYXlzOwogICAgICAgIGlmKGdldE5vdygpPj1zdGFnZTJTdGFydFRpbWUgJiYgc2FsZVN0YXR1cz09MCkKICAgICAgICB7CiAgICAgICAgICAgIGlmKHRva2Vuc0Zvck93bmVyLnN1YihiYWxhbmNlc1tvd25lcl0pPj1zb2Z0Y2FwKSBzYWxlU3RhdHVzPTI7CiAgICAgICAgICAgIGVsc2Ugc2FsZVN0YXR1cz0xOwogICAgICAgICAKICAgICAgICAgICAgZW1pdCBTdGVwMEZpbmlzaGVkKCk7CiAgICAgICAgfQogICAgICAKCSAgIC8vIGNoZWNrIGlmIG92ZXJhbGwgY29tcG91bmQgaW50ZXJlc3Qgb2YgdG9rZW5zIHdpbGwgYmUgbGVzcyB0aGFuIHRvdGFsIHN1cHBseQoJICAKICAgICAgIGc9Z2xvYmFsSW50ZXJlc3RBbW91bnQuY29tcG91bmRJbnRlcmVzdChzdGFnZTJTdGFydFRpbWUsIGdsb2JhbEludGVyZXN0RGF0ZSwgbmV3RGF0ZSk7CiAgICAgICBpZihnPD10b3RhbFN1cHBseSAmJiBzYWxlU3RhdHVzPT0yKSB7CiAgICAgICAgICAgICBjdXJyZW50RGF0ZT0oZ2V0Tm93KCkvMSBkYXlzKSoxIGRheXM7IAogICAgICAgICAgICAgZ2xvYmFsSW50ZXJlc3RBbW91bnQ9ZzsKICAgICAgICAgICAgIGdsb2JhbEludGVyZXN0RGF0ZT1jdXJyZW50RGF0ZTsKICAgICAgICAgICAgIGVtaXQgRGF0ZVVwZGF0ZWQoY3VycmVudERhdGUpOwogICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICB9CiAgICAgICBlbHNlIGlmKHNhbGVTdGF0dXM9PTEpIGN1cnJlbnREYXRlPShnZXROb3coKS8xIGRheXMpKjEgZGF5czsgCiAgICAgICAKICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2VuZHMgY29sbGVjdGVkIGV0aGVyIHRvIG93bmVyLiBJZiBzYWxlIGlzIG5vdCBzdWNjZXNzLCBjb250cmFjdCB3aWxsIGhvbGQgZXRoZXIgZm9yIGhhbGYgeWVhciwgYW5kIGFmdGVyLCBldGhlciBjYW4gYmUgc2VudCB0byBvd25lcgogICAgICogQHJldHVybiBhbW91bnQgb2Ygb3duZXIncyBldGhlcgogICAgICovCiAgICAgCiAgICBmdW5jdGlvbiBzZW5kRXRoZXJUb011bHRpc2lnKCkgcHVibGljICByZXR1cm5zKHVpbnQyNTYgZSkgewogICAgICAgIHVpbnQyNTYgcmVxOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09b3duZXIgfHwgbXNnLnNlbmRlcj09bXVsdGlzaWcpOwogICAgICAgIHJlcXVpcmUoc2FsZVN0YXR1cyE9MCk7CgogICAgICAgIGlmKHNhbGVTdGF0dXM9PTIpIHsKICAgICAgICAJLy8gY2FsY3VsYXRlIGV0aGVyIGZvciByZWZ1bmRzCiAgICAgICAgCXJlcT10b2tlbnNGcm9tRXRoZXIubXVsKDEgZXRoZXIpLmRpdihzdGVwMFJhdGUpLmRpdigyKTsKCiAgICAgICAgCWlmKGJEYmdFbmFibGVkKSBlbWl0IERlYnVnTG9nKCJUaGlzIGJhbGFuY2UgaXMiLCB0aGlzLmJhbGFuY2UpOwogICAgICAgIAlpZihyZXE+PXRoaXMuYmFsYW5jZSkgcmV0dXJuIDA7CiAgICAJfQogICAgCWVsc2UgaWYoc2FsZVN0YXR1cz09MSkgewogICAgCQlyZXF1aXJlKGdldE5vdygpLXN0YWdlMlN0YXJ0VGltZT4xNTc2ODAwMCk7CiAgICAJCXJlcT0wOyAKICAgIAl9CiAgICAgICAgdWludDI1NiBhbW91bnQ7CiAgICAgICAgYW1vdW50PXRoaXMuYmFsYW5jZS5zdWIocmVxKTsKICAgICAgICBtdWx0aXNpZy50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICAgICAgCiAgICB9CiAgICAKCQoKCgkKCQoJLyoqCgkJUmVmdW5kIGZ1bmN0aW9ucy4gCgkJSWYgaWNvIGlzIHN1Y2Nlc3MsIGFueW9uZSBjYW4gZ2V0IDAuMDAwMDA1IGV0aCBmb3IgMSB0b2tlbiwgIGVsc2UgMDAwMDEgZXRoCgkJCgkqLwoJCiAgICAvKioKICAgICAqIEBkZXYgUmVmdW5kcyBldGhlciB0byBzZW5kZXIgaWYgaGUgdHJhc25mZXJlZCB0b2tlbnMgdG8gY29udHJhY3QgYWRkcmVzcy4gQ2FsY3VsYXRlcyBtYXggcG9zc2libGUgYW1vdW50IG9mIHJlZnVuZC4gSWYgc2VudCB0b2tlbnM+cmVmdW5kIGFtb3VuZCwgdG9rZW5zIHdpbGwgYmUgcmV0dXJuZWQgdG8gc2VuZGVyLgogICAgICogQHBhcmFtIF90byBBZGRyZXNzIG9mIHJlZnVuZCByZWNlaXZlcgogICAgICogQHBhcmFtIF92YWx1ZSBUb2tlbnMgcmVxdWVzdGVkIGZvciByZWZ1bmQKICAgICAqLwoJCiAgICBmdW5jdGlvbiBwcm9jZXNzUmVmdW5kRXRoZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYgbGVmdCkKICAgIHsKICAgICAgICByZXF1aXJlKHNhbGVTdGF0dXMhPTApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlPjApOwogICAgICAgIHVpbnQyNTYgRXRoZXI9MDsgdWludDI1NiBib3VudHk9MDsgIHVpbnQyNTYgdG90YWw9MDsKCiAgICAgICAgdWludDI1NiByYXRlMj1zYWxlU3RhdHVzOwoKICAgICAgICAKICAgICAgICBpZihfdmFsdWU+PWJvdWdodFdpdGhFdGhlcltfdG9dKSB7RXRoZXI9RXRoZXIuYWRkKGJvdWdodFdpdGhFdGhlcltfdG9dKTsgX3ZhbHVlPV92YWx1ZS5zdWIoYm91Z2h0V2l0aEV0aGVyW190b10pOyB9CiAgICAgICAgZWxzZSB7RXRoZXI9RXRoZXIuYWRkKF92YWx1ZSk7IF92YWx1ZT1fdmFsdWUuc3ViKEV0aGVyKTt9CiAgICAgICAgYm91Z2h0V2l0aEV0aGVyW190b109Ym91Z2h0V2l0aEV0aGVyW190b10uc3ViKEV0aGVyKTsKICAgICAgICAKICAgICAgICBpZihyYXRlMj09MikgeyAgICAgICAgCiAgICAgICAgICAgIGlmKF92YWx1ZT49Ym91bnR5QW5kUmVmc1dpdGhFdGhlcltfdG9dKSB7Ym91bnR5PWJvdW50eS5hZGQoYm91bnR5QW5kUmVmc1dpdGhFdGhlcltfdG9dKTsgX3ZhbHVlPV92YWx1ZS5zdWIoYm91bnR5QW5kUmVmc1dpdGhFdGhlcltfdG9dKTsgfQogICAgICAgICAgICBlbHNlIHsgYm91bnR5PWJvdW50eS5hZGQoX3ZhbHVlKTsgX3ZhbHVlPV92YWx1ZS5zdWIoYm91bnR5KTsgfQogICAgICAgICAgICBib3VudHlBbmRSZWZzV2l0aEV0aGVyW190b109Ym91bnR5QW5kUmVmc1dpdGhFdGhlcltfdG9dLnN1Yihib3VudHkpOwogICAgICAgIH0KICAgICAgICB0b3RhbD1FdGhlci5hZGQoYm91bnR5KTsKICAgICAvLyAgIGlmKF92YWx1ZT50b3RhbCkgX3ZhbHVlPV92YWx1ZS5zdWIodG90YWwpOwogICAgICAgIHRva2Vuc0Zyb21FdGhlcj10b2tlbnNGcm9tRXRoZXIuc3ViKHRvdGFsKTsKICAgICAgIHVpbnQyNTYgZXRoPXRvdGFsLm11bCgxIGV0aGVyKS5kaXYoc3RlcDBSYXRlKS5kaXYocmF0ZTIpOwogICAgICAgICBfdG8udHJhbnNmZXIoZXRoKTsKICAgICAgICBpZihiRGJnRW5hYmxlZCkgZW1pdCBEZWJ1Z0xvZygiV2lsbCByZWZ1bmQgIiwgZXRoKTsKCiAgICAgICAgZW1pdCBSZWZ1bmRFdGhlcihfdG8sIHRvdGFsLCBldGgpOwogICAgICAgIGRlY3JlYXNlR2xvYmFsSW50ZXJlc3RBbW91bnQodG90YWwpOwogICAgICAgIHJldHVybiBfdmFsdWU7CiAgICB9CiAgICAKICAgIAoJCgoJICAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBpbmZvIGFib3V0IHJlZnVuZGFibGUgdG9rZW5zLSBib3VnaHQgd2l0aCBldGhlciwgcGF5bWVudCBzeXN0ZW1zLCBhbmQgYm9udXMgdG9rZW5zIGNvbnZlcnRhYmxlIHRvIGV0aGVyCiAgICAgKi8KCQoJZnVuY3Rpb24gZ2V0UmVmdW5kSW5mbyhhZGRyZXNzIF90bykgcHVibGljIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYpCgl7CgkgICAgcmV0dXJuICAoIGJvdWdodFdpdGhFdGhlcltfdG9dLCAgYm91Z2h0V2l0aE90aGVyW190b10sICBib3VudHlBbmRSZWZzV2l0aEV0aGVyW190b10pOwoJICAgIAoJfQoJCiAgICAKICAgIC8qKgogICAgICogQGRldiBXaXRoZHJhdyB0b2tlbnMgIHJlZnVuZGVkIHRvIG90aGVyIHBheW1lbnQgc3lzdGVtcy4KICAgICAqIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiByZWZ1bmQgcmVjZWl2ZXIKICAgICAqLwogICAgCiAgICBmdW5jdGlvbiByZWZ1bmRUb090aGVyUHJvY2VzcyhhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAodWludDI1NiBvKSB7CiAgICAgICAgcmVxdWlyZShzYWxlU3RhdHVzIT0wKTsKICAgICAgICAvL3VpbnQyNTYgbWF4VmFsdWU9cmVmdW5kVG9PdGhlckdldChfdG8pOwogICAgICAgIHVpbnQyNTYgbWF4VmFsdWU9MDsKICAgICAgICByZXF1aXJlKF92YWx1ZTw9bWF4VmFsdWUpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgT3RoZXI9MDsgdWludDI1NiBib3VudHk9MDsgCgoKCiAgICAgICAgCiAgICAgICAgaWYoX3ZhbHVlPj1ib3VnaHRXaXRoT3RoZXJbX3RvXSkge090aGVyPU90aGVyLmFkZChib3VnaHRXaXRoT3RoZXJbX3RvXSk7IF92YWx1ZT1fdmFsdWUuc3ViKGJvdWdodFdpdGhPdGhlcltfdG9dKTsgfQogICAgICAgIGVsc2Uge090aGVyPU90aGVyLmFkZChfdmFsdWUpOyBfdmFsdWU9X3ZhbHVlLnN1YihPdGhlcik7fQogICAgICAgIGJvdWdodFdpdGhPdGhlcltfdG9dPWJvdWdodFdpdGhPdGhlcltfdG9dLnN1YihPdGhlcik7CgogICAgICAgCiAgICAgICAgYmFsYW5jZXNbX3RvXT1iYWxhbmNlT2YoX3RvKS5zdWIoT3RoZXIpLnN1Yihib3VudHkpOwogICAgICAgIHVwZGF0ZURhdGUoX3RvKTsKICAgICAgICBkZWNyZWFzZUdsb2JhbEludGVyZXN0QW1vdW50KE90aGVyLmFkZChib3VudHkpKTsKICAgICAgICByZXR1cm4gX3ZhbHVlOwogICAgICAgIAogICAgICAgIAogICAgfQogICAgCiAKICAgIC8qKgogICAgICogQGRldiBDb252ZXJ0cyBldGhlciB0byBvdXIgdG9rZW5zIAogICAgICovCgkJICAKICAgIAogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5zRnJvbUV0aGVyKCkgIHByaXZhdGUgICB7CiAgICAgICAgICAgICAgIAogICAgICAgIGFzc2VydChtc2cudmFsdWUgPj0gMSBldGhlciAvIDEwMDApOwogICAgICAgCiAgICAgICAgIHVpbnQyNTYgdG9rZW5zID0gY3VycmVudFJhdGUubXVsKG1zZy52YWx1ZSkuZGl2KDEgZXRoZXIpOwoKCiAgICAgICAgdHJhbnNmZXJGcm9tT3duZXIobXNnLnNlbmRlciwgdG9rZW5zLDIpOwogICAgICAKICAgICAgIGlmKHNhbGVTdGF0dXM9PTApIHsKICAgICAgICAgICBib3VnaHRXaXRoRXRoZXJbbXNnLnNlbmRlcl09Ym91Z2h0V2l0aEV0aGVyW21zZy5zZW5kZXJdLmFkZCh0b2tlbnMpOwogICAgICAgICAgICB0b2tlbnNGcm9tRXRoZXI9dG9rZW5zRnJvbUV0aGVyLmFkZCh0b2tlbnMpOwogICAgICAgfQogICAgICAKICAgIH0KCQoJCiAgICAvKioKICAgICAqIEBkZXYgQ29udmVydHMgb3RoZXIgcGF5bWVudHMgc3lzdGVtIHBheW1lbnQgdG8gIHRva2Vucy4gTWFpbiBsb2dpYyBpcyBvbiBzaXRlCiAgICAgKi8KICAgIAogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5zRnJvbU90aGVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IGhvd011Y2gsIGFkZHJlc3MgcmVmZXJlcikgcHVibGljICBvbmx5T3duZXIgICB7IAogICAgICAKICAgICAgICByZXF1aXJlKF90byE9YWRkcmVzcyh0aGlzKSk7CiAgICAgICAgIHRyYW5zZmVyRnJvbU93bmVyKF90bywgaG93TXVjaCwyKTsKICAgICAgICAgaWYocmVmZXJlciE9MCAmJiByZWZlcmVyIT1hZGRyZXNzKHRoaXMpICYmIHJlZmVyZXIhPTB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCAmJiBob3dNdWNoLmRpdigxMCk+MCkgewogICAgICAgICAgICAgdHJhbnNmZXJGcm9tT3duZXIocmVmZXJlciwgaG93TXVjaC5kaXYoMTApLDEpOwoJICAgICAgICAgaWYoc2FsZVN0YXR1cz09MCkgewoJICAgICAgICAgICAgIAl0b2tlbnNGcm9tRXRoZXI9dG9rZW5zRnJvbUV0aGVyLmFkZCggaG93TXVjaC5kaXYoMTApKTsKCSAJCQkJYm91bnR5QW5kUmVmc1dpdGhFdGhlcltfdG9dPWJvdW50eUFuZFJlZnNXaXRoRXRoZXJbX3RvXS5hZGQoIGhvd011Y2guZGl2KDEwKSk7CgkgICAgICAgICAJfQogICAgICAgICB9CiAgICAgICAgIGlmKHNhbGVTdGF0dXM9PTApIGJvdWdodFdpdGhPdGhlcltfdG9dPSBib3VnaHRXaXRoT3RoZXJbX3RvXS5hZGQoaG93TXVjaCk7CiAgICB9CgoJICAgLyoqCiAgICAgKiBAZGV2IEdpdmVzIHJlZnMgdG9rZW5zIHRocm91Z2ggcGF5bWVudCBvbiBzaXRlLiBNYWluIGxvZ2ljIGlzIG9uIHNpdGUKICAgICAqIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiAgcmVjZWl2ZXIKICAgICAqIEBwYXJhbSBfYW1vdW50IEFtb3VudCBvZiB0b2tlbnMJCQoJICogQHBhcmFtIHQgdHlwZSBvZiB0cmFuc2Zlci4gMCBpcyB0cmFuc2ZlciwgMSBib251cyB0b2tlbnMsIDIgLSBzYWxlCiAgICAgKi8KCQoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tT3duZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCwgdWludCB0KSBwcml2YXRlIHsKCSAgIHJlcXVpcmUoX3RvIT1hZGRyZXNzKHRoaXMpICYmIF90byE9YWRkcmVzcyhvd25lcikgKTsKICAgICAgICBiYWxhbmNlc1tvd25lcl09YmFsYW5jZXNbb3duZXJdLnN1YihfYW1vdW50KTsgCiAgICAgICAgYmFsYW5jZXNbX3RvXT1iYWxhbmNlT2YoX3RvKS5hZGQoX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlRGF0ZShfdG8pOwoKICAgICAgICBpbmNyZWFzZUdsb2JhbEludGVyZXN0QW1vdW50KF9hbW91bnQpOwoJICAgIAoJICAgCgkgICAgIGlmKHQ9PTIpIGVtaXQgU2FsZShfdG8sIF9hbW91bnQpOwogICAgICAgIGVtaXQgVHJhbnNmZXIob3duZXIsIF90bywgX2Ftb3VudCk7CSAgICAgCgl9CgkKCiAgICBmdW5jdGlvbiBpbmNyZWFzZUdsb2JhbEludGVyZXN0QW1vdW50KHVpbnQyNTYgYykgcHJpdmF0ZSAKICAgIHsKICAgICAgICBnbG9iYWxJbnRlcmVzdEFtb3VudD1nbG9iYWxJbnRlcmVzdEFtb3VudC5hZGQoYyk7CgkJCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRlY3JlYXNlR2xvYmFsSW50ZXJlc3RBbW91bnQodWludDI1NiBjKSBwcml2YXRlCiAgICB7CiAgICAgICAgaWYoYzxnbG9iYWxJbnRlcmVzdEFtb3VudCkgewogICAgICAgICAgICBnbG9iYWxJbnRlcmVzdEFtb3VudD1nbG9iYWxJbnRlcmVzdEFtb3VudC5zdWIoYyk7CiAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBjcmVhdGVUb2tlbnNGcm9tRXRoZXIoKTsKICAgIH0KCiAgICAKfQ=='.
	

]
