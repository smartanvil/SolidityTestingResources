Class {
	#name : #SRTbc145bc6bfc6af7370bba5baf6a70dcf4789a3c6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbc145bc6bfc6af7370bba5baf6a70dcf4789a3c6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKgpUaGlzIGlzIHRoZSBtYWluIGNvbnRyYWN0IGZvciBNeUV0aGVyQ2l0eS4gSm9pbiB1cyBhdCBodHRwczovL215ZXRoZXJjaXR5LmNvbS8gIApHYW1lIE5hbWU6IE15RXRoZXJDaXR5IChUaGUgZmlyc3QgY2l0eS1idWlsZGluZyBnYW1lIGJ1aWx0IG9uIHRvcCBvZiB0aGUgRXRoZXJldW0gQmxvY2tjaGFpbikKR2FtZSBMaW5rOiBodHRwczovL215ZXRoZXJjaXR5LmNvbS8KKi8KCmNvbnRyYWN0IE15RXRoZXJDaXR5R2FtZSB7CgogICAgYWRkcmVzcyBjZW9BZGRyZXNzID0gMHg2OTlkRTU0MTI1M2YyNTNhNGVGZjBEM2MwMDZENzBjNDNGMkUyRGFFOwogICAgYWRkcmVzcyBJbml0aWF0ZUxhbmRzQWRkcmVzcyA9IDB4YTkzYTEzNWUzYzczYWI3N2VhMDBlMTk0YmQwODA5MThlNjUxNDljMzsKICAgIAogICAgbW9kaWZpZXIgb25seUNlbygpIHsKICAgICAgICByZXF1aXJlICgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBJbml0aWF0ZUxhbmRzQWRkcmVzcwogICAgICAgICAgICApOwogICAgICAgIF87CiAgICB9CgogICAgdWludDI1NiBwcmljZU1ldGFsID0gNTAwMDAwMDAwMDAwMDAwMDsgICAgIC8vIFRoZSBkZXZlbG9wZXIgY2FuIHVwZGF0ZSB0aGUgcHJpY2Ugb2YgbWV0YWsgdG8gcmVndWxhdGUgdGhlIG1hcmtldAoKICAgIHN0cnVjdCBMYW5kIHsKICAgICAgICBhZGRyZXNzIG93bmVyQWRkcmVzczsKICAgICAgICB1aW50MjU2IGxhbmRQcmljZTsKICAgICAgICBib29sIGxhbmRGb3JTYWxlOwogICAgICAgIGJvb2wgbGFuZEZvclJlbnQ7CiAgICAgICAgdWludCBsYW5kT3duZXJDb21taXNzaW9uOwogICAgICAgIGJvb2wgaXNPY2N1cGllZDsKICAgICAgICB1aW50IGNpdHlSZW50aW5nSWQ7CiAgICB9CiAgICBMYW5kW10gbGFuZHM7CgogICAgc3RydWN0IENpdHkgewogICAgICAgIHVpbnQgbGFuZElkOwogICAgICAgIGFkZHJlc3Mgb3duZXJBZGRyZXNzOwogICAgICAgIHVpbnQyNTYgY2l0eVByaWNlOwogICAgICAgIHVpbnQyNTYgY2l0eUdkcDsgCiAgICAgICAgYm9vbCBjaXR5Rm9yU2FsZTsKICAgICAgICB1aW50IHNxdWFyZXNPY2N1cGllZDsgLy8gRXF1YWxzIDAgd2hlbiB3ZSBjcmVhdGUgdGhlIGNpdHkKICAgICAgICB1aW50IG1ldGFsU3RvY2s7CiAgICB9CiAgICBDaXR5W10gY2l0aWVzOwoKICAgIHN0cnVjdCBCdXNpbmVzcyB7CiAgICAgICAgdWludCBpdGVtVG9Qcm9kdWNlOwogICAgICAgIHVpbnQyNTYgaXRlbVByaWNlOwogICAgICAgIHVpbnQgY2l0eUlkOwogICAgICAgIHVpbnQzMiByZWFkeVRpbWU7CiAgICB9CiAgICBCdXNpbmVzc1tdIGJ1c2luZXNzZXM7CgogICAgLyoKICAgIEJ1aWxkaW5nIHR5cGU6CiAgICAwID0gaG91c2UgPT4gQ2FuIGhvdXNlIDUgY2l0aXplbnMKICAgIDEgPSBzY2hvb2wgPT4gQ2FuIGVkdWNhdGUgMzAgY2l0aXplbnMKICAgIDIgPSBjbGVhbiBlbmVyZ3kgPT4gQ2FuIGVuZXJnaXplIDIwIGNpdGl6ZW5zCiAgICAzID0gZm9zc2lsIGVuZXJneSA9PiBDYW4gZW5lcmdpemUgMzAgY2l0aXplbnMKICAgIDQgPSBob3NwaXRhbCA9PiBDYW4gaGVhbCAzMCBjaXRpemVucwogICAgNSA9IGFtdXNlbWVudCA9PiBDYW4gYW11c2UgMzUgY2l0aXplbnMKICAgIDYgPSBidXNpbmVzc2VzCiAgICAqLwoKICAgIHN0cnVjdCBCdWlsZGluZyB7CiAgICAgICAgdWludCBidWlsZGluZ1R5cGU7CiAgICAgICAgdWludCBjaXR5SWQ7CiAgICAgICAgdWludDMyIHJlYWR5VGltZTsKICAgIH0KICAgIEJ1aWxkaW5nW10gYnVpbGRpbmdzOwoKICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAgICAgdWludCBidXllcklkOwogICAgICAgIHVpbnQgc2VsbGVySWQ7CiAgICAgICAgdWludDI1NiB0cmFuc2FjdGlvblZhbHVlOwogICAgICAgIHVpbnQgaXRlbUlkOwogICAgICAgIHVpbnQgYmxvY2tJZDsKICAgIH0KICAgIFRyYW5zYWN0aW9uW10gdHJhbnNhY3Rpb25zOwoKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgcHVibGljIENpdHlCdWlsZGluZ3NDb3VudDsgICAgICAgIC8vIFRoZSBhbW91bnQgb2YgYnVpbGRpbmdzIG93bmVkIGJ5IHRoaXMgYWRkcmVzcwogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBwdWJsaWMgQnVpbGRpbmdUeXBlTWV0YWxOZWVkZWQ7ICAgLy8gVGhlIGFtb3VudCBvZiBtZXRhbCBuZWVkZWQgdG8gYnVpbGQgYWxsIHRoZSBidWlsZGluZ3MKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgcHVibGljIEJ1aWxkaW5nVHlwZVNxdWFyZXNPY2N1cGllZDsgIC8vIFRoZSBsYW5kIG9jY3VwaWVkIGJ5IGVhY2ggYnVpbGRpbmcKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgcHVibGljIENvdW50QnVzaW5lc3Nlc1BlclR5cGU7ICAgICAgIC8vIFdlIGtlZXAgdHJhY2sgb2YgdGhlIGFtb3VudCBvZiBidXNpbmVzc2VzIGNyZWF0ZWQgcGVyIHR5cGUKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgcHVibGljIENpdHlCdXNpbmVzc0NvdW50OyAgICAgICAgICAgIC8vIFdlIGtlZXAgdHJhY2sgb2YgdGhlIGFtb3VudCBvZiBidXNpbmVzc2VzIG93bmVkIGJ5IGEgY2l0eQogICAgbWFwcGluZyAodWludCA9PiB1aW50KSBwdWJsaWMgQ2l0eVNhbGVzVHJhbnNhY3Rpb25zQ291bnQ7ICAgIC8vIFdlIGtlZXAgdHJhY2sgb2YgdGhlIHNhbGVzIGdlbmVyYXRlZCBieSBhIGNpdHkKCiAgICAvLy8KICAgIC8vLyBHRVQKICAgIC8vLwoKICAgIC8vIFRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gdGhlIGRldGFpbHMgZm9yIGEgbGFuZAogICAgZnVuY3Rpb24gZ2V0TGFuZCh1aW50IF9sYW5kSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3Mgb3duZXJBZGRyZXNzLAogICAgICAgIHVpbnQyNTYgbGFuZFByaWNlLAogICAgICAgIGJvb2wgbGFuZEZvclNhbGUsCiAgICAgICAgYm9vbCBsYW5kRm9yUmVudCwKICAgICAgICB1aW50IGxhbmRPd25lckNvbW1pc3Npb24sCiAgICAgICAgYm9vbCBpc09jY3VwaWVkLAogICAgICAgIHVpbnQgY2l0eVJlbnRpbmdJZAogICAgKSB7CiAgICAgICAgTGFuZCBzdG9yYWdlIF9sYW5kID0gbGFuZHNbX2xhbmRJZF07CgogICAgICAgIG93bmVyQWRkcmVzcyA9IF9sYW5kLm93bmVyQWRkcmVzczsKICAgICAgICBsYW5kUHJpY2UgPSBfbGFuZC5sYW5kUHJpY2U7CiAgICAgICAgbGFuZEZvclNhbGUgPSBfbGFuZC5sYW5kRm9yU2FsZTsKICAgICAgICBsYW5kRm9yUmVudCA9IF9sYW5kLmxhbmRGb3JSZW50OwogICAgICAgIGxhbmRPd25lckNvbW1pc3Npb24gPSBfbGFuZC5sYW5kT3duZXJDb21taXNzaW9uOwogICAgICAgIGlzT2NjdXBpZWQgPSBfbGFuZC5pc09jY3VwaWVkOwogICAgICAgIGNpdHlSZW50aW5nSWQgPSBfbGFuZC5jaXR5UmVudGluZ0lkOwogICAgfQoKICAgIC8vIFRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gdGhlIGRldGFpbHMgZm9yIGEgY2l0eQogICAgZnVuY3Rpb24gZ2V0Q2l0eSh1aW50IF9jaXR5SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIHVpbnQgbGFuZElkLAogICAgICAgIGFkZHJlc3MgbGFuZE93bmVyLAogICAgICAgIGFkZHJlc3MgY2l0eU93bmVyLAogICAgICAgIHVpbnQyNTYgY2l0eVByaWNlLAogICAgICAgIHVpbnQyNTYgY2l0eUdkcCwKICAgICAgICBib29sIGNpdHlGb3JTYWxlLAogICAgICAgIHVpbnQgc3F1YXJlc09jY3VwaWVkLAogICAgICAgIHVpbnQgbWV0YWxTdG9jaywKICAgICAgICB1aW50IGNpdHlQb3B1bGF0aW9uLAogICAgICAgIHVpbnQgaGVhbHRoQ2l0aXplbnMsCiAgICAgICAgdWludCBlZHVjYXRpb25DaXRpemVucywKICAgICAgICB1aW50IGhhcHBpbmVzc0NpdGl6ZW5zLAogICAgICAgIHVpbnQgcHJvZHVjdGl2aXR5Q2l0aXplbnMKICAgICkgewogICAgICAgIENpdHkgc3RvcmFnZSBfY2l0eSA9IGNpdGllc1tfY2l0eUlkXTsKCiAgICAgICAgbGFuZElkID0gX2NpdHkubGFuZElkOwogICAgICAgIGxhbmRPd25lciA9IGxhbmRzW19jaXR5LmxhbmRJZF0ub3duZXJBZGRyZXNzOwogICAgICAgIGNpdHlPd25lciA9IF9jaXR5Lm93bmVyQWRkcmVzczsKICAgICAgICBjaXR5UHJpY2UgPSBfY2l0eS5jaXR5UHJpY2U7CiAgICAgICAgY2l0eUdkcCA9IF9jaXR5LmNpdHlHZHA7CiAgICAgICAgY2l0eUZvclNhbGUgPSBfY2l0eS5jaXR5Rm9yU2FsZTsKICAgICAgICBzcXVhcmVzT2NjdXBpZWQgPSBfY2l0eS5zcXVhcmVzT2NjdXBpZWQ7CiAgICAgICAgbWV0YWxTdG9jayA9IF9jaXR5Lm1ldGFsU3RvY2s7CiAgICAgICAgY2l0eVBvcHVsYXRpb24gPSBnZXRDaXR5UG9wdWxhdGlvbihfY2l0eUlkKTsKICAgICAgICBoZWFsdGhDaXRpemVucyA9IGdldEhlYWx0aENpdGl6ZW5zKF9jaXR5SWQpOwogICAgICAgIGVkdWNhdGlvbkNpdGl6ZW5zID0gZ2V0RWR1Y2F0aW9uQ2l0aXplbnMoX2NpdHlJZCk7CiAgICAgICAgaGFwcGluZXNzQ2l0aXplbnMgPSBnZXRIYXBwaW5lc3NDaXRpemVucyhfY2l0eUlkKTsKICAgICAgICBwcm9kdWN0aXZpdHlDaXRpemVucyA9IGdldFByb2R1Y3Rpdml0eUNpdGl6ZW5zKF9jaXR5SWQpOwogICAgfQoKICAgIC8vIFRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gdGhlIGRldGFpbHMgZm9yIGEgYnVzaW5lc3MKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzKHVpbnQgX2J1c2luZXNzSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIHVpbnQgaXRlbVRvUHJvZHVjZSwKICAgICAgICB1aW50MjU2IGl0ZW1QcmljZSwKICAgICAgICB1aW50IGNpdHlJZCwKICAgICAgICB1aW50IGNpdHlNZXRhbFN0b2NrLAogICAgICAgIHVpbnQgcmVhZHlUaW1lLAogICAgICAgIHVpbnQgcHJvZHVjdGlvblRpbWUsCiAgICAgICAgdWludCBjaXR5TGFuZElkLAogICAgICAgIGFkZHJlc3MgY2l0eU93bmVyCiAgICApIHsKICAgICAgICBCdXNpbmVzcyBzdG9yYWdlIF9idXNpbmVzcyA9IGJ1c2luZXNzZXNbX2J1c2luZXNzSWRdOwoKICAgICAgICBpdGVtVG9Qcm9kdWNlID0gX2J1c2luZXNzLml0ZW1Ub1Byb2R1Y2U7CiAgICAgICAgaXRlbVByaWNlID0gX2J1c2luZXNzLml0ZW1QcmljZTsKICAgICAgICBjaXR5SWQgPSBfYnVzaW5lc3MuY2l0eUlkOwogICAgICAgIGNpdHlNZXRhbFN0b2NrID0gY2l0aWVzW19idXNpbmVzcy5jaXR5SWRdLm1ldGFsU3RvY2s7CiAgICAgICAgcmVhZHlUaW1lID0gX2J1c2luZXNzLnJlYWR5VGltZTsKICAgICAgICBwcm9kdWN0aW9uVGltZSA9IGdldFByb2R1Y3Rpb25UaW1lQnVzaW5lc3MoX2J1c2luZXNzSWQpOwogICAgICAgIGNpdHlMYW5kSWQgPSBjaXRpZXNbX2J1c2luZXNzLmNpdHlJZF0ubGFuZElkOwogICAgICAgIGNpdHlPd25lciA9IGNpdGllc1tfYnVzaW5lc3MuY2l0eUlkXS5vd25lckFkZHJlc3M7CiAgICAgICAgCiAgICB9CgogICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiB0aGUgZGV0YWlscyBmb3IgYSBidWlsZGluZwogICAgZnVuY3Rpb24gZ2V0QnVpbGRpbmcodWludCBfYnVpbGRpbmdJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgdWludCBidWlsZGluZ1R5cGUsCiAgICAgICAgdWludCBjaXR5SWQsCiAgICAgICAgdWludDMyIHJlYWR5VGltZQogICAgKSB7CiAgICAgICAgQnVpbGRpbmcgc3RvcmFnZSBfYnVpbGRpbmcgPSBidWlsZGluZ3NbX2J1aWxkaW5nSWRdOwoKICAgICAgICBidWlsZGluZ1R5cGUgPSBfYnVpbGRpbmcuYnVpbGRpbmdUeXBlOwogICAgICAgIGNpdHlJZCA9IF9idWlsZGluZy5jaXR5SWQ7CiAgICAgICAgcmVhZHlUaW1lID0gX2J1aWxkaW5nLnJlYWR5VGltZTsKICAgIH0KCiAgICAvLyBUaGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHRoZSBkZXRhaWxzIGZvciBhIHRyYW5zYWN0aW9uCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbih1aW50IF90cmFuc2FjdGlvbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50IGJ1eWVySWQsCiAgICAgICAgdWludCBzZWxsZXJJZCwKICAgICAgICB1aW50MjU2IHRyYW5zYWN0aW9uVmFsdWUsCiAgICAgICAgdWludCBpdGVtSWQsCiAgICAgICAgdWludCBibG9ja0lkCiAgICApIHsKICAgICAgICBUcmFuc2FjdGlvbiBzdG9yYWdlIF90cmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uc1tfdHJhbnNhY3Rpb25JZF07CgogICAgICAgIGJ1eWVySWQgPSBfdHJhbnNhY3Rpb24uYnV5ZXJJZDsKICAgICAgICBzZWxsZXJJZCA9IF90cmFuc2FjdGlvbi5zZWxsZXJJZDsKICAgICAgICB0cmFuc2FjdGlvblZhbHVlID0gX3RyYW5zYWN0aW9uLnRyYW5zYWN0aW9uVmFsdWU7CiAgICAgICAgaXRlbUlkID0gX3RyYW5zYWN0aW9uLml0ZW1JZDsKICAgICAgICBibG9ja0lkID0gX3RyYW5zYWN0aW9uLmJsb2NrSWQ7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgY291bnQgb2YgYnVpbGRpbmdzIGZvciBhIGNpdHkgCiAgICBmdW5jdGlvbiBnZXRDaXR5QnVpbGRpbmdzKHVpbnQgX2NpdHlJZCwgYm9vbCBfYWN0aXZlKSBwdWJsaWMgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50IGNvdW50QnVpbGRpbmdzLAogICAgICAgIHVpbnQgY291bnRIb3VzZXMsCiAgICAgICAgdWludCBjb3VudFNjaG9vbHMsCiAgICAgICAgdWludCBjb3VudEhvc3BpdGFsLAogICAgICAgIHVpbnQgY291bnRBbXVzZW1lbnQKICAgICkgewogICAgICAgIGNvdW50QnVpbGRpbmdzID0gZ2V0Q291bnRBbGxCdWlsZGluZ3MoX2NpdHlJZCwgX2FjdGl2ZSk7CiAgICAgICAgY291bnRIb3VzZXMgPSBnZXRDb3VudEJ1aWxkaW5ncyhfY2l0eUlkLCAwLCBfYWN0aXZlKTsKICAgICAgICBjb3VudFNjaG9vbHMgPSBnZXRDb3VudEJ1aWxkaW5ncyhfY2l0eUlkLCAxLCBfYWN0aXZlKTsKICAgICAgICBjb3VudEhvc3BpdGFsID0gZ2V0Q291bnRCdWlsZGluZ3MoX2NpdHlJZCwgMiwgX2FjdGl2ZSk7CiAgICAgICAgY291bnRBbXVzZW1lbnQgPSBnZXRDb3VudEJ1aWxkaW5ncyhfY2l0eUlkLCAzLCBfYWN0aXZlKTsKICAgIH0KICAgICAgICAKICAgIC8vIEdldCBhbGwgdGhlIGxhbmRzIG93bmVkIGJ5IGEgY2l0eQogICAgZnVuY3Rpb24gZ2V0U2VuZGVyTGFuZHMoYWRkcmVzcyBfc2VuZGVyQWRkcmVzcykgcHVibGljIHZpZXcgcmV0dXJucyh1aW50W10pIHsKICAgICAgICB1aW50W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50W10oZ2V0Q291bnRTZW5kZXJMYW5kcyhfc2VuZGVyQWRkcmVzcykpOwogICAgICAgIHVpbnQgY291bnRlciA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGFuZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChsYW5kc1tpXS5vd25lckFkZHJlc3MgPT0gX3NlbmRlckFkZHJlc3MpIHsKICAgICAgICAgICAgcmVzdWx0W2NvdW50ZXJdID0gaTsKICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDb3VudFNlbmRlckxhbmRzKGFkZHJlc3MgX3NlbmRlckFkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgY291bnRlciA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGFuZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChsYW5kc1tpXS5vd25lckFkZHJlc3MgPT0gX3NlbmRlckFkZHJlc3MpIHsKICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4oY291bnRlcik7CiAgICB9CiAgICAKICAgICAvLyBHZXQgYWxsIHRoZSBsYW5kcyBvd25lZCBieSBhIGNpdHkKICAgIGZ1bmN0aW9uIGdldFNlbmRlckNpdGllcyhhZGRyZXNzIF9zZW5kZXJBZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnRbXSkgewogICAgICAgIHVpbnRbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnRbXShnZXRDb3VudFNlbmRlckNpdGllcyhfc2VuZGVyQWRkcmVzcykpOwogICAgICAgIHVpbnQgY291bnRlciA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgY2l0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoY2l0aWVzW2ldLm93bmVyQWRkcmVzcyA9PSBfc2VuZGVyQWRkcmVzcykgewogICAgICAgICAgICByZXN1bHRbY291bnRlcl0gPSBpOwogICAgICAgICAgICBjb3VudGVyKys7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldENvdW50U2VuZGVyQ2l0aWVzKGFkZHJlc3MgX3NlbmRlckFkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgY291bnRlciA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgY2l0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoY2l0aWVzW2ldLm93bmVyQWRkcmVzcyA9PSBfc2VuZGVyQWRkcmVzcykgewogICAgICAgICAgICBjb3VudGVyKys7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybihjb3VudGVyKTsKICAgIH0KCiAgICAvLyBXZSB1c2UgdGhpcyBmdW5jdGlvbiB0byByZXR1cm4gdGhlIHBvcHVsYXRpb24gb2YgYSBjaXR5CiAgICBmdW5jdGlvbiBnZXRDaXR5UG9wdWxhdGlvbih1aW50IF9jaXR5SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBXZSBtdWx0aXBseSB0aGUgbnVtYmVyIG9mIGhvdXNlcyBwZXIgNSB0byBnZXQgdGhlIHBvcHVsYXRpb24gb2YgYSBjaXR5CiAgICAgICAgdWludCBfY2l0eUFjdGl2ZUJ1aWxkaW5ncyA9IGdldENvdW50QnVpbGRpbmdzKF9jaXR5SWQsIDAsIHRydWUpOwogICAgICAgIHJldHVybihfY2l0eUFjdGl2ZUJ1aWxkaW5ncyAqIDUpOwogICAgfQoKICAgIC8vIENvdW50IHRoZSBudW1iZXIgb2YgYWN0aXZlIG9yIHBlbmRpbmcgYnVpbGRpbmdzCiAgICBmdW5jdGlvbiBnZXRDb3VudEFsbEJ1aWxkaW5ncyh1aW50IF9jaXR5SWQsIGJvb2wgX2FjdGl2ZSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBjb3VudGVyID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBidWlsZGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYoX2FjdGl2ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBhY3RpdmUgPT0gdHJ1ZSB3ZSBsb29wIHRocm91Z2ggdGhlIGFjdGl2ZSBidWlsZGluZ3MKICAgICAgICAgICAgICAgIGlmKGJ1aWxkaW5nc1tpXS5jaXR5SWQgPT0gX2NpdHlJZCAmJiBidWlsZGluZ3NbaV0ucmVhZHlUaW1lIDwgbm93KSB7CiAgICAgICAgICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSWYgYWN0aXZlID09IGZhbHNlIHdlIGxvb3AgdGhyb3VnaCB0aGUgcGVuZGluZyBidWlsZGluZ3MKICAgICAgICAgICAgICAgIGlmKGJ1aWxkaW5nc1tpXS5jaXR5SWQgPT0gX2NpdHlJZCAmJiBidWlsZGluZ3NbaV0ucmVhZHlUaW1lID49IG5vdykgewogICAgICAgICAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvdW50ZXI7CiAgICB9CiAgICAKICAgIC8vIENvdW50IHRoZSBudW1iZXIgb2YgYWN0aXZlIG9yIHBlbmRpbmcgYnVpbGRpbmdzCiAgICBmdW5jdGlvbiBnZXRDb3VudEJ1aWxkaW5ncyh1aW50IF9jaXR5SWQsIHVpbnQgX2J1aWxkaW5nVHlwZSwgYm9vbCBfYWN0aXZlKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IGNvdW50ZXIgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGJ1aWxkaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZihfYWN0aXZlID09IHRydWUpIHsKICAgICAgICAgICAgICAgIC8vIElmIGFjdGl2ZSA9PSB0cnVlIHdlIGxvb3AgdGhyb3VnaCB0aGUgYWN0aXZlIGJ1aWxkaW5ncwogICAgICAgICAgICAgICAgaWYoYnVpbGRpbmdzW2ldLmJ1aWxkaW5nVHlwZSA9PSBfYnVpbGRpbmdUeXBlICYmIGJ1aWxkaW5nc1tpXS5jaXR5SWQgPT0gX2NpdHlJZCAmJiBidWlsZGluZ3NbaV0ucmVhZHlUaW1lIDwgbm93KSB7CiAgICAgICAgICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSWYgYWN0aXZlID09IGZhbHNlIHdlIGxvb3AgdGhyb3VnaCB0aGUgcGVuZGluZyBidWlsZGluZ3MKICAgICAgICAgICAgICAgIGlmKGJ1aWxkaW5nc1tpXS5idWlsZGluZ1R5cGUgPT0gX2J1aWxkaW5nVHlwZSAmJiBidWlsZGluZ3NbaV0uY2l0eUlkID09IF9jaXR5SWQgJiYgYnVpbGRpbmdzW2ldLnJlYWR5VGltZSA+PSBub3cpIHsKICAgICAgICAgICAgICAgICAgICBjb3VudGVyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvdW50ZXI7CiAgICB9CgogICAgLy8gR2V0IHRoZSBhY3RpdmUgYnVpbGRpbmdzIChieSB0eXBlKSBvd25lZCBieSBhIHNwZWNpZmljIGNpdHkKICAgIGZ1bmN0aW9uIGdldENpdHlBY3RpdmVCdWlsZGluZ3ModWludCBfY2l0eUlkLCB1aW50IF9idWlsZGluZ1R5cGUpIHB1YmxpYyB2aWV3IHJldHVybnModWludFtdKSB7CiAgICAgICAgdWludFtdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludFtdKGdldENvdW50QnVpbGRpbmdzKF9jaXR5SWQsIF9idWlsZGluZ1R5cGUsIHRydWUpKTsKICAgICAgICB1aW50IGNvdW50ZXIgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGJ1aWxkaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBXZSBhZGQgdGhlIHJlYWR5IGJ1aWxkaW5nIG93bmVkIGJ5IHRoaXMgdXNlcgogICAgICAgICAgICBpZiAoYnVpbGRpbmdzW2ldLmJ1aWxkaW5nVHlwZSA9PSBfYnVpbGRpbmdUeXBlICYmIGJ1aWxkaW5nc1tpXS5jaXR5SWQgPT0gX2NpdHlJZCAmJiBidWlsZGluZ3NbaV0ucmVhZHlUaW1lIDwgbm93KSB7CiAgICAgICAgICAgICAgICByZXN1bHRbY291bnRlcl0gPSBpOwogICAgICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gR2V0IHRoZSBwZW5kaW5nIGJ1aWxkaW5ncyAoYnkgdHlwZSkgb3duZWQgYnkgYSBzcGVjaWZpYyBjaXR5CiAgICBmdW5jdGlvbiBnZXRDaXR5UGVuZGluZ0J1aWxkaW5ncyh1aW50IF9jaXR5SWQsIHVpbnQgX2J1aWxkaW5nVHlwZSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50W10pIHsKICAgICAgICB1aW50W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50W10oZ2V0Q291bnRCdWlsZGluZ3MoX2NpdHlJZCwgX2J1aWxkaW5nVHlwZSwgZmFsc2UpKTsKICAgICAgICB1aW50IGNvdW50ZXIgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGJ1aWxkaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBXZSBhZGQgdGhlIHBlbmRpbmcgYnVpbGRpbmcgb3duZWQgYnkgdGhpcyB1c2VyCiAgICAgICAgICAgIGlmIChidWlsZGluZ3NbaV0uYnVpbGRpbmdUeXBlID09IF9idWlsZGluZ1R5cGUgJiYgYnVpbGRpbmdzW2ldLmNpdHlJZCA9PSBfY2l0eUlkICYmIGJ1aWxkaW5nc1tpXS5yZWFkeVRpbWUgPj0gbm93KSB7CiAgICAgICAgICAgICAgICByZXN1bHRbY291bnRlcl0gPSBpOwogICAgICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gR2V0IEJ1c2luZXNzZXMgcGVyIHR5cGUKICAgIGZ1bmN0aW9uIGdldEFjdGl2ZUJ1c2luZXNzZXNQZXJUeXBlKHVpbnQgX2J1c2luZXNzVHlwZSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50W10pIHsKICAgICAgICB1aW50W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50W10oQ291bnRCdXNpbmVzc2VzUGVyVHlwZVtfYnVzaW5lc3NUeXBlXSk7CiAgICAgICAgdWludCBjb3VudGVyID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBidXNpbmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIFdlIGFkZCB0aGUgcGVuZGluZyBidWlsZGluZyBvd25lZCBieSB0aGlzIHVzZXIKICAgICAgICAgICAgaWYgKGJ1c2luZXNzZXNbaV0uaXRlbVRvUHJvZHVjZSA9PSBfYnVzaW5lc3NUeXBlKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbY291bnRlcl0gPSBpOwogICAgICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIHJldHVybnMgYW4gYXJyYXkgb2YgaWQgZm9yIHRoZSBhY3RpdmUgYnVzaW5lc3NlcwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gR2V0IEJ1c2luZXNzZXMgcGVyIGNpdHkKICAgIGZ1bmN0aW9uIGdldEFjdGl2ZUJ1c2luZXNzZXNQZXJDaXR5KHVpbnQgX2NpdHlJZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50W10pIHsKICAgICAgICB1aW50W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50W10oQ2l0eUJ1c2luZXNzQ291bnRbX2NpdHlJZF0pOwogICAgICAgIHVpbnQgY291bnRlciA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYnVzaW5lc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBXZSBhZGQgdGhlIHBlbmRpbmcgYnVpbGRpbmcgb3duZWQgYnkgdGhpcyB1c2VyCiAgICAgICAgICAgIGlmIChidXNpbmVzc2VzW2ldLmNpdHlJZCA9PSBfY2l0eUlkKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbY291bnRlcl0gPSBpOwogICAgICAgICAgICAgICAgY291bnRlcisrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIHJldHVybnMgYW4gYXJyYXkgb2YgaWQgZm9yIHRoZSBhY3RpdmUgYnVzaW5lc3NlcwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIC8vIEdldCB0aGUgc2FsZXMgZ2VuZXJhdGVkIGJ5IGEgY2l0eQogICAgZnVuY3Rpb24gZ2V0U2FsZXNDaXR5KHVpbnQgX2NpdHlJZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50W10pIHsKICAgICAgICB1aW50W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50W10oQ2l0eVNhbGVzVHJhbnNhY3Rpb25zQ291bnRbX2NpdHlJZF0pOwogICAgICAgIHVpbnQgY291bnRlciA9IDA7CiAgICAgICAgdWludCBzdGFydElkID0gdHJhbnNhY3Rpb25zLmxlbmd0aCAtIDE7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdHJhbnNhY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgX3RJZCA9IHN0YXJ0SWQgLSBpOwogICAgICAgICAgICAvLyBXZSBhZGQgdGhlIHBlbmRpbmcgYnVpbGRpbmcgb3duZWQgYnkgdGhpcyB1c2VyCiAgICAgICAgICAgIGlmICh0cmFuc2FjdGlvbnNbX3RJZF0uc2VsbGVySWQgPT0gX2NpdHlJZCkgewogICAgICAgICAgICAgICAgcmVzdWx0W2NvdW50ZXJdID0gX3RJZDsKICAgICAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyByZXR1cm5zIGFuIGFycmF5IG9mIGlkIGZvciB0aGUgc2FsZXMgZ2VuZXJhdGVkIGJ5IHRoZSBjaXR5ICh0aGUgbW9zdCByZWNlbnQgc2FsZXMgY29tZXMgaW4gZmlyc3QpCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLyBSZXR1cm4gdGhlIGhlYWx0aCBvZiB0aGUgY2l0aXplbnMgb2YgYSBjaXR5CiAgICBmdW5jdGlvbiBnZXRIZWFsdGhDaXRpemVucyh1aW50IF9jaXR5SWQpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgX2hvc3BpdGFsc0NvdW50ID0gZ2V0Q291bnRCdWlsZGluZ3MoX2NpdHlJZCwgMiwgdHJ1ZSk7CiAgICAgICAgdWludCBwb2ludHNIZWFsdGggPSAoX2hvc3BpdGFsc0NvdW50ICogNTAwKSArIDUwOwogICAgICAgIHVpbnQgX3BvcHVsYXRpb24gPSBnZXRDaXR5UG9wdWxhdGlvbihfY2l0eUlkKTsKICAgICAgICB1aW50MjU2IF9oZWFsdGhQb3B1bGF0aW9uID0gMTA7CiAgICAgICAgCiAgICAgICAgaWYoX3BvcHVsYXRpb24gPiAwKSB7CiAgICAgICAgICAgIF9oZWFsdGhQb3B1bGF0aW9uID0gKHBvaW50c0hlYWx0aCAvIHVpbnQyNTYoX3BvcHVsYXRpb24pKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfaGVhbHRoUG9wdWxhdGlvbiA9IDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFRoZSBpbmRpY2F0b3IgY2FuJ3QgYmUgbW9yZSB0aGFuIDEwCiAgICAgICAgaWYoX2hlYWx0aFBvcHVsYXRpb24gPiAxMCkgewogICAgICAgICAgICBfaGVhbHRoUG9wdWxhdGlvbiA9IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4oX2hlYWx0aFBvcHVsYXRpb24pOwogICAgfQoKICAgIC8vIFJldHVybiB0aGUgZWR1Y2F0aW9uIG9mIHRoZSBjaXRpemVucyBvZiBhIGNpdHkKICAgIGZ1bmN0aW9uIGdldEVkdWNhdGlvbkNpdGl6ZW5zKHVpbnQgX2NpdHlJZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBfc2Nob29sc0NvdW50ID0gZ2V0Q291bnRCdWlsZGluZ3MoX2NpdHlJZCwgMSwgdHJ1ZSk7CiAgICAgICAgdWludCBwb2ludHNFZHVjYXRpb24gPSAoX3NjaG9vbHNDb3VudCAqIDI1MCkgKyAyNTsKICAgICAgICB1aW50IF9wb3B1bGF0aW9uID0gZ2V0Q2l0eVBvcHVsYXRpb24oX2NpdHlJZCk7CiAgICAgICAgdWludDI1NiBfZWR1Y2F0aW9uUG9wdWxhdGlvbiA9IDEwOwoKICAgICAgICBpZihfcG9wdWxhdGlvbiA+IDApIHsKICAgICAgICAgICAgX2VkdWNhdGlvblBvcHVsYXRpb24gPSAocG9pbnRzRWR1Y2F0aW9uIC8gdWludDI1NihfcG9wdWxhdGlvbikpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9lZHVjYXRpb25Qb3B1bGF0aW9uID0gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYoX2VkdWNhdGlvblBvcHVsYXRpb24gPiAxMCkgewogICAgICAgICAgICBfZWR1Y2F0aW9uUG9wdWxhdGlvbiA9IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4oX2VkdWNhdGlvblBvcHVsYXRpb24pOwogICAgfQoKICAgIC8vIFJldHVybiB0aGUgaGFwcGluZXNzIG9mIHRoZSBjaXRpemVucyBvZiBhIGNpdHkKICAgIGZ1bmN0aW9uIGdldEhhcHBpbmVzc0NpdGl6ZW5zKHVpbnQgX2NpdHlJZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBfYW11c2VtZW50Q291bnQgPSBnZXRDb3VudEJ1aWxkaW5ncyhfY2l0eUlkLCAzLCB0cnVlKTsKICAgICAgICB1aW50IHBvaW50c0FtdXNlbWVudCA9IChfYW11c2VtZW50Q291bnQgKiAzNTApICsgMzU7CiAgICAgICAgdWludCBfcG9wdWxhdGlvbiA9IGdldENpdHlQb3B1bGF0aW9uKF9jaXR5SWQpOwogICAgICAgIHVpbnQyNTYgX2FtdXNlbWVudFBvcHVsYXRpb24gPSAxMDsKICAgICAgICAKICAgICAgICBpZihfcG9wdWxhdGlvbiA+IDApIHsKICAgICAgICAgICAgX2FtdXNlbWVudFBvcHVsYXRpb24gPSAocG9pbnRzQW11c2VtZW50IC8gdWludDI1NihfcG9wdWxhdGlvbikpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9hbXVzZW1lbnRQb3B1bGF0aW9uID0gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGluZGljYXRvciBjYW4ndCBiZSBtb3JlIHRoYW4gMTAKICAgICAgICBpZihfYW11c2VtZW50UG9wdWxhdGlvbiA+IDEwKSB7CiAgICAgICAgICAgIF9hbXVzZW1lbnRQb3B1bGF0aW9uID0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybihfYW11c2VtZW50UG9wdWxhdGlvbik7CiAgICB9CgogICAgLy8gUmV0dXJuIHRoZSBwcm9kdWN0aXZpdHkgb2YgdGhlIGNpdGl6ZW5zIG9mIGEgY2l0eQogICAgZnVuY3Rpb24gZ2V0UHJvZHVjdGl2aXR5Q2l0aXplbnModWludCBfY2l0eUlkKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4oKGdldEVkdWNhdGlvbkNpdGl6ZW5zKF9jaXR5SWQpICsgZ2V0SGVhbHRoQ2l0aXplbnMoX2NpdHlJZCkgKyBnZXRIYXBwaW5lc3NDaXRpemVucyhfY2l0eUlkKSkgLyAzKTsKICAgIH0KCiAgICAvLyBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhlIG1heGltdW0gYnVzaW5lc3NlcyBhIGNpdHkgY2FuIGJ1aWxkIChhY2NvcmRpbmcgdG8gaXRzIHBvcHVsYXRpb24pCiAgICBmdW5jdGlvbiBnZXRNYXhCdXNpbmVzc2VzUGVyQ2l0eSh1aW50IF9jaXR5SWQpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgX2NpdGl6ZW5zID0gZ2V0Q2l0eVBvcHVsYXRpb24oX2NpdHlJZCk7CiAgICAgICAgdWludCBfbWF4QnVzaW5lc3NlczsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBtYXggYW1vdW50IG9mIGJ1c2luZXNzZXMgYXZhaWxhYmxlIHBlciBjaXR5CiAgICAgICAgaWYoX2NpdGl6ZW5zID49IDc1KSB7CiAgICAgICAgICAgIF9tYXhCdXNpbmVzc2VzID0gNDsKICAgICAgICB9IGVsc2UgaWYoX2NpdGl6ZW5zID49IDUwKSB7CiAgICAgICAgICAgIF9tYXhCdXNpbmVzc2VzID0gMzsKICAgICAgICB9IGVsc2UgaWYoX2NpdGl6ZW5zID49IDI1KSB7CiAgICAgICAgICAgIF9tYXhCdXNpbmVzc2VzID0gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfbWF4QnVzaW5lc3NlcyA9IDE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4oX21heEJ1c2luZXNzZXMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDb3VudENpdGllcygpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybihjaXRpZXMubGVuZ3RoKTsKICAgIH0KCiAgICAvLy8KICAgIC8vLyBBQ1RJT05TCiAgICAvLy8KICAgIAogICAgLy8gTGFuZCBvd25lciBjYW4gdXNlIHRoaXMgZnVuY3Rpb24gdG8gcmVtb3ZlIGEgY2l0eSBmcm9tIHRoZWlyIGxhbmQgCiAgICBmdW5jdGlvbiByZW1vdmVUZW5hbnQodWludCBfbGFuZElkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobGFuZHNbX2xhbmRJZF0ub3duZXJBZGRyZXNzID09IG1zZy5zZW5kZXIpOwogICAgICAgIGxhbmRzW19sYW5kSWRdLmxhbmRGb3JSZW50ID0gZmFsc2U7CiAgICAgICAgbGFuZHNbX2xhbmRJZF0uaXNPY2N1cGllZCA9IGZhbHNlOwogICAgICAgIGNpdGllc1tsYW5kc1tfbGFuZElkXS5jaXR5UmVudGluZ0lkXS5sYW5kSWQgPSAwOwogICAgICAgIGxhbmRzW19sYW5kSWRdLmNpdHlSZW50aW5nSWQgPSAwOwogICAgfQoKICAgIC8vIFdlIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIHB1cmNoYXNlIGEgYnVzaW5lc3MKICAgIC8vIEJ1c2luZXNzZXMgYXJlIGZyZWUgdG8gY3JlYXRlIGJ1dCBlYWNoIGNpdHkgY2FuIHJ1biBvbmx5IG9uZSBidXNpbmVzcy4KICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1c2luZXNzKHVpbnQgX2l0ZW1JZCwgdWludDI1NiBfaXRlbVByaWNlLCB1aW50IF9jaXR5SWQpIHB1YmxpYyB7CiAgICAgICAgLy8gV2UgY2hlY2sgaWYgdGhlIHByaWNlIG9mIHRoZSBpdGVtIHNvbGQgaXMgZW5vdWdoIHJlZ2FyZGluZyB0aGUgY3VycmVudCBwcmljZSBvZiB0aGUgbWV0YWwKICAgICAgICByZXF1aXJlKF9pdGVtUHJpY2UgPj0gQnVpbGRpbmdUeXBlTWV0YWxOZWVkZWRbX2l0ZW1JZF0gKiBwcmljZU1ldGFsKTsKCiAgICAgICAgLy8gV2UgdmVyaWZpeSB0aGF0IHRoZSBzZW5kZXIgaXMgdGhlIG93bmVyIG9mIHRoZSBjaXR5CiAgICAgICAgcmVxdWlyZShjaXRpZXNbX2NpdHlJZF0ub3duZXJBZGRyZXNzID09IG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBXZSBjaGVjayB0aGF0IHRoZSBjaXR5IGhhcyBlbm91Z2ggc3F1YXJlcyB0byBob3N0IHRoaXMgbmV3IGJ1aWxkaW5nCiAgICAgICAgcmVxdWlyZSgoY2l0aWVzW19jaXR5SWRdLnNxdWFyZXNPY2N1cGllZCArIEJ1aWxkaW5nVHlwZVNxdWFyZXNPY2N1cGllZFs0XSkgPD0gMTAwKTsKICAgICAgICAKICAgICAgICAvLyBXZSBjaGVjayBpZiB0aGUgY2l0eSBoYXMgZW5vdWdoIHBvcHVsYXRpb24gdG8gY3JlYXRlIHRoaXMgYnVzaW5lc3MgKDEgYnVpbGRpbmcgLyAyNSBjaXRpemVucykKICAgICAgICByZXF1aXJlKENpdHlCdXNpbmVzc0NvdW50W19jaXR5SWRdIDwgZ2V0TWF4QnVzaW5lc3Nlc1BlckNpdHkoX2NpdHlJZCkpOwoKICAgICAgICAvLyBXZSBjcmVhdGUgdGhlIGJ1c2luZXNzCiAgICAgICAgYnVzaW5lc3Nlcy5wdXNoKEJ1c2luZXNzKF9pdGVtSWQsIF9pdGVtUHJpY2UsIF9jaXR5SWQsIDApKTsKCiAgICAgICAgLy8gV2UgaW5jcmVtZW50IHRoZSBidXNpbmVzc2VzIGNvdW50IGZvciB0aGlzIHR5cGUgYW5kIGNpdHkKICAgICAgICBDb3VudEJ1c2luZXNzZXNQZXJUeXBlW19pdGVtSWRdKys7CgogICAgICAgIC8vIFdlIGluY3JlbWVudCB0aGUgY291bnQgb2YgYnVzaW5lc3NlcyBmb3IgdGhpcyBjaXR5CiAgICAgICAgQ2l0eUJ1c2luZXNzQ291bnRbX2NpdHlJZF0rKzsKCiAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBzcXVhcmVzIHVzZWQgaW4gdGhpcyBsYW5kCiAgICAgICAgY2l0aWVzW19jaXR5SWRdLnNxdWFyZXNPY2N1cGllZCA9IGNpdGllc1tfY2l0eUlkXS5zcXVhcmVzT2NjdXBpZWQgKyBCdWlsZGluZ1R5cGVTcXVhcmVzT2NjdXBpZWRbNF07CiAgICB9CgogICAgLy8gVGhpcyBmdW5jdGlvbiBjYW4gbGV0IGJ1c2luZXNzIG93bmVyIHVwZGF0ZSB0aGUgcHJpY2Ugb2YgdGhlIGJ1aWxkaW5nIHRoZXkgYXJlIHNlbGxpbmcKICAgIGZ1bmN0aW9uIHVwZGF0ZUJ1c2luZXNzKHVpbnQgX2J1c2luZXNzSWQsIHVpbnQyNTYgX2l0ZW1QcmljZSkgcHVibGljIHsKICAgICAgICAvLyBXZSBjaGVjayBpZiB0aGUgdXNlciBpcyB0aGUgb3duZXIgb2YgdGhlIGJ1c2luZXNzCiAgICAgICAgcmVxdWlyZShjaXRpZXNbYnVzaW5lc3Nlc1tfYnVzaW5lc3NJZF0uY2l0eUlkXS5vd25lckFkZHJlc3MgPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIFdlIGNoZWNrIGlmIHRoZSBwcmljZSBvZiB0aGUgaXRlbSBzb2xkIGlzIGVub3VnaCByZWdhcmRpbmcgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgdGhlIG1ldGFsCiAgICAgICAgcmVxdWlyZShfaXRlbVByaWNlID49IEJ1aWxkaW5nVHlwZU1ldGFsTmVlZGVkW2J1c2luZXNzZXNbX2J1c2luZXNzSWRdLml0ZW1Ub1Byb2R1Y2VdICogcHJpY2VNZXRhbCk7CgogICAgICAgIGJ1c2luZXNzZXNbX2J1c2luZXNzSWRdLml0ZW1QcmljZSA9IF9pdGVtUHJpY2U7CiAgICB9CgogICAgLy8gV2UgdXNlIHRoaXMgZnVuY3Rpb24gdG8gcHVyY2hhc2UgbWV0YWwKICAgIGZ1bmN0aW9uIHB1cmNoYXNlTWV0YWwodWludCBfY2l0eUlkLCB1aW50IF9hbW91bnQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAvLyBXZSBjaGVjayB0aGF0IHRoZSB1c2VyIGlzIHBheWluZyB0aGUgY29ycmVjdCBwcmljZSAKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBfYW1vdW50ICogcHJpY2VNZXRhbCk7CgogICAgICAgIC8vIFdlIHZlcmlmaXkgdGhhdCB0aGUgc2VuZGVyIGlzIHRoZSBvd25lciBvZiB0aGUgY2l0eQogICAgICAgIHJlcXVpcmUoY2l0aWVzW19jaXR5SWRdLm93bmVyQWRkcmVzcyA9PSBtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIGFtb3VudCBwYWlkIHRvIHRoZSBjZW8KICAgICAgICBjZW9BZGRyZXNzLnRyYW5zZmVyKG1zZy52YWx1ZSk7CgogICAgICAgIC8vIEFkZCB0aGUgbWV0YWwgdG8gdGhlIGNpdHkgc3RvY2sKICAgICAgICBjaXRpZXNbX2NpdHlJZF0ubWV0YWxTdG9jayA9IGNpdGllc1tfY2l0eUlkXS5tZXRhbFN0b2NrICsgX2Ftb3VudDsKICAgIH0KICAgIAogICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiB0aGUgcHJvZHVjdGlvbiB0aW1lIGZvciBhIHNwZWNpZmljIGJ1c2luZXNzCiAgICBmdW5jdGlvbiBnZXRQcm9kdWN0aW9uVGltZUJ1c2luZXNzKHVpbnQgX2J1c2luZXNzSWQpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQgX3Byb2R1Y3Rpdml0eUluZGljYXRvciA9IGdldFByb2R1Y3Rpdml0eUNpdGl6ZW5zKGJ1c2luZXNzZXNbX2J1c2luZXNzSWRdLmNpdHlJZCk7CiAgICAgICAgdWludCBfY291bnRDaXRpemVucyA9IGdldENpdHlQb3B1bGF0aW9uKGJ1c2luZXNzZXNbX2J1c2luZXNzSWRdLmNpdHlJZCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBwcm9kdWN0aXZpdHlGaW5hbDsKICAgICAgICAKICAgICAgICBpZihfY291bnRDaXRpemVucyA9PSAwKSB7CiAgICAgICAgICAgIC8vIFRoZSBtaW4gcHJvZHVjdGlvbiB0aW1lIHdpdGggMCBjaXRpemVucyBzaG91bGQgYmUgNzAwMAogICAgICAgICAgICBwcm9kdWN0aW9uVGltZSA9IDcwMDA7IAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFdlIGNhbGN1bGF0IHRoZSBwcm9kdWN0aW9uIHRpbWUKICAgICAgICAgICAgaWYoX3Byb2R1Y3Rpdml0eUluZGljYXRvciA8PSAxKSB7CiAgICAgICAgICAgIHByb2R1Y3Rpdml0eUZpbmFsID0gX2NvdW50Q2l0aXplbnM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcm9kdWN0aXZpdHlGaW5hbCA9IF9jb3VudENpdGl6ZW5zICogKF9wcm9kdWN0aXZpdHlJbmRpY2F0b3IgLyAyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdWludDI1NiBwcm9kdWN0aW9uVGltZSA9IDYwMDAwIC8gdWludDI1Nihwcm9kdWN0aXZpdHlGaW5hbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybihwcm9kdWN0aW9uVGltZSk7CiAgICB9CgogICAgLy8gV2UgdXNlIHRoaXMgZnVuY3Rpb24gdG8gcHVyY2hhc2UgYSBidWlsZGluZyBmcm9tIGEgYnVzaW5lc3MKICAgIGZ1bmN0aW9uIHB1cmNoYXNlQnVpbGRpbmcodWludCBfaXRlbUlkLCB1aW50IF9idXNpbmVzc0lkLCB1aW50IF9jaXR5SWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAvLyBXZSB2ZXJpZnkgdGhhdCB0aGUgdXNlciBpcyBwYXlpbmcgdGhlIGNvcnJlY3QgcHJpY2UKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBidXNpbmVzc2VzW19idXNpbmVzc0lkXS5pdGVtUHJpY2UpOwoKICAgICAgICAvLyBXZSB2ZXJpZml5IHRoYXQgdGhlIHNlbmRlciBpcyB0aGUgb3duZXIgb2YgdGhlIGNpdHkKICAgICAgICByZXF1aXJlKGNpdGllc1tfY2l0eUlkXS5vd25lckFkZHJlc3MgPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIFdlIGNoZWNrIGlmIHRoaXMgYnVzaW5lc3MgaXMgYXV0aG9yaXplZCB0byBwcm9kdWNlIHRoaXMgYnVpbGRpbmcKICAgICAgICByZXF1aXJlKF9pdGVtSWQgPT0gYnVzaW5lc3Nlc1tfYnVzaW5lc3NJZF0uaXRlbVRvUHJvZHVjZSk7CgogICAgICAgIC8vIFdlIGNoZWNrIGlmIHRoZSBjaXR5IHdoZXJlIHRoZSBidXNpbmVzcyBpcyBsb2NhdGVkIGFzIGVub3VnaCBNZXRhbCBpbiBTdG9jawogICAgICAgIHJlcXVpcmUoY2l0aWVzW2J1c2luZXNzZXNbX2J1c2luZXNzSWRdLmNpdHlJZF0ubWV0YWxTdG9jayA+PSBCdWlsZGluZ1R5cGVNZXRhbE5lZWRlZFtfaXRlbUlkXSk7CgogICAgICAgIC8vIFdlIGNoZWNrIHRoYXQgdGhlIGNpdHkgaGFzIGVub3VnaCBzcXVhcmVzIHRvIGhvc3QgdGhpcyBuZXcgYnVpbGRpbmcKICAgICAgICByZXF1aXJlKChjaXRpZXNbX2NpdHlJZF0uc3F1YXJlc09jY3VwaWVkICsgQnVpbGRpbmdUeXBlU3F1YXJlc09jY3VwaWVkW19pdGVtSWRdKSA8PSAxMDApOwoKICAgICAgICAvLyBXZSBjaGVjayBpZiB0aGUgYnVzaW5lc3MgaXMgcmVhZHkgdG8gcHJvZHVjZSBhbm90aGVyIGJ1aWxkaW5nCiAgICAgICAgcmVxdWlyZShidXNpbmVzc2VzW19idXNpbmVzc0lkXS5yZWFkeVRpbWUgPCBub3cpOwoKICAgICAgICB1aW50MjU2IG9uZVBlcmNlbnQgPSBtc2cudmFsdWUgLyAxMDA7CgogICAgICAgIC8vIFNlbmQgY29tbWlzc2lvbiBvZiB0aGUgYW1vdW50IHBhaWQgdG8gbGFuZCBvd25lciBvZiB3aGVyZSB0aGUgYnVzaW5lc3MgaXMgbG9jYXRlZAogICAgICAgIHVpbnQgX2xhbmRJZCA9IGNpdGllc1tidXNpbmVzc2VzW19idXNpbmVzc0lkXS5jaXR5SWRdLmxhbmRJZDsKICAgICAgICBhZGRyZXNzIGxhbmRPd25lciA9IGxhbmRzW19sYW5kSWRdLm93bmVyQWRkcmVzczsKICAgICAgICB1aW50MjU2IGxhbmRPd25lckNvbW1pc3Npb24gPSBvbmVQZXJjZW50ICogbGFuZHNbY2l0aWVzW2J1c2luZXNzZXNbX2J1c2luZXNzSWRdLmNpdHlJZF0ubGFuZElkXS5sYW5kT3duZXJDb21taXNzaW9uOwogICAgICAgIGxhbmRPd25lci50cmFuc2ZlcihsYW5kT3duZXJDb21taXNzaW9uKTsKCiAgICAgICAgLy8gU2VuZCB0aGUgcmVzdCB0byB0aGUgYnVzaW5lc3Mgb3duZXIKICAgICAgICBjaXRpZXNbYnVzaW5lc3Nlc1tfYnVzaW5lc3NJZF0uY2l0eUlkXS5vd25lckFkZHJlc3MudHJhbnNmZXIobXNnLnZhbHVlIC0gbGFuZE93bmVyQ29tbWlzc2lvbik7CgogICAgICAgIC8vIFJlZHVjZSB0aGUgbWV0YWwgc3RvY2sgb2YgdGhlIGNpdHkgd2hlcmUgdGhlIGJ1c2luZXNzIGlzIGxvY2F0ZWQKICAgICAgICBjaXRpZXNbYnVzaW5lc3Nlc1tfYnVzaW5lc3NJZF0uY2l0eUlkXS5tZXRhbFN0b2NrID0gY2l0aWVzW2J1c2luZXNzZXNbX2J1c2luZXNzSWRdLmNpdHlJZF0ubWV0YWxTdG9jayAtIEJ1aWxkaW5nVHlwZU1ldGFsTmVlZGVkW19pdGVtSWRdOwoKICAgICAgICAvLyBDYWxjdWxhdGUgcHJvZHVjdGlvbiB0aW1lCiAgICAgICAgdWludCBwcm9kdWN0aW9uVGltZSA9IGdldFByb2R1Y3Rpb25UaW1lQnVzaW5lc3MoX2J1c2luZXNzSWQpOwogICAgICAgIHVpbnQzMiBfYnVpbGRpbmdSZWFkeVRpbWUgPSB1aW50MzIobm93ICsgcHJvZHVjdGlvblRpbWUpOwoKICAgICAgICAvLyBVcGRhdGUgcHJvZHVjdGlvbiB0aW1lIGZvciB0aGUgYnVzaW5lc3MKICAgICAgICBidXNpbmVzc2VzW19idXNpbmVzc0lkXS5yZWFkeVRpbWUgPSB1aW50MzIobm93ICsgcHJvZHVjdGlvblRpbWUpOwoKICAgICAgICAvLyBDcmVhdGUgdGhlIGJ1aWxkaW5nCiAgICAgICAgYnVpbGRpbmdzLnB1c2goQnVpbGRpbmcoX2l0ZW1JZCwgX2NpdHlJZCwgX2J1aWxkaW5nUmVhZHlUaW1lKSk7CgogICAgICAgIC8vIEluY3JlbWVudCB0aGUgc3F1YXJlcyB1c2VkIGluIHRoaXMgbGFuZAogICAgICAgIGNpdGllc1tfY2l0eUlkXS5zcXVhcmVzT2NjdXBpZWQgPSBjaXRpZXNbX2NpdHlJZF0uc3F1YXJlc09jY3VwaWVkICsgQnVpbGRpbmdUeXBlU3F1YXJlc09jY3VwaWVkW19pdGVtSWRdOwoKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIEdEUCBnZW5lcmF0ZWQgYnkgdGhpcyBjaXR5CiAgICAgICAgY2l0aWVzW19jaXR5SWRdLmNpdHlHZHAgPSBjaXRpZXNbX2NpdHlJZF0uY2l0eUdkcCArIG1zZy52YWx1ZTsKCiAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBidWlsZGluZ3MgY291bnQgaW4gdGhpcyBjaXR5CiAgICAgICAgQ2l0eUJ1aWxkaW5nc0NvdW50W19jaXR5SWRdKys7CgogICAgICAgIC8vIFNhdmUgdHJhbnNhY3Rpb24gaW4gc21hcnQgY29udHJhY3QKICAgICAgICB0cmFuc2FjdGlvbnMucHVzaChUcmFuc2FjdGlvbihfY2l0eUlkLCBidXNpbmVzc2VzW19idXNpbmVzc0lkXS5jaXR5SWQsIG1zZy52YWx1ZSwgX2l0ZW1JZCwgYmxvY2subnVtYmVyKSk7CiAgICAgICAgQ2l0eVNhbGVzVHJhbnNhY3Rpb25zQ291bnRbYnVzaW5lc3Nlc1tfYnVzaW5lc3NJZF0uY2l0eUlkXSsrOwogICAgfQoKICAgIC8vIFdlIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGxldCB0aGUgbGFuZCBvd25lciB1cGRhdGUgaXRzIGxhbmQKICAgIGZ1bmN0aW9uIHVwZGF0ZUxhbmQodWludCBfbGFuZElkLCB1aW50MjU2IF9sYW5kUHJpY2UsIHVpbnQgX3R5cGVVcGRhdGUsIHVpbnQgX2NvbW1pc3Npb24pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShsYW5kc1tfbGFuZElkXS5vd25lckFkZHJlc3MgPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vLyBUeXBlcyB1cGRhdGU6CiAgICAgICAgLy8vIDA6IFNlbGwgbGFuZAogICAgICAgIC8vLyAxOiBQdXQgdGhlIGxhbmQgZm9yIHJlbnQKCiAgICAgICAgaWYoX3R5cGVVcGRhdGUgPT0gMCkgewoKICAgICAgICAgICAgLy8gTGFuZCBpcyBmb3Igc2FsZQogICAgICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kRm9yU2FsZSA9IHRydWU7CiAgICAgICAgICAgIGxhbmRzW19sYW5kSWRdLmxhbmRGb3JSZW50ID0gZmFsc2U7CiAgICAgICAgICAgIGxhbmRzW19sYW5kSWRdLmxhbmRQcmljZSA9IF9sYW5kUHJpY2U7CiAgICAgICAgICAgIAogICAgICAgIH0gZWxzZSBpZihfdHlwZVVwZGF0ZSA9PSAxKSB7CiAgICAgICAgICAgIC8vIFRoZSBvd25lciBjYW4ndCBjaGFuZ2UgdGhlIGNvbW1pc3Npb24gaWYgdGhlIGxhbmQgaXMgb2NjdXBpZWQKICAgICAgICAgICAgcmVxdWlyZShsYW5kc1tfbGFuZElkXS5pc09jY3VwaWVkID09IGZhbHNlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIExhbmQgaXMgZm9yIHJlbnQKICAgICAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclJlbnQgPSB0cnVlOwogICAgICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kRm9yU2FsZSA9IGZhbHNlOwogICAgICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kT3duZXJDb21taXNzaW9uID0gX2NvbW1pc3Npb247CgogICAgICAgIH0gZWxzZSBpZihfdHlwZVVwZGF0ZSA9PSAyKSB7CiAgICAgICAgICAgIC8vIFRoZSBvd25lciBjYW5jZWwgdGhlIHNhbGUgb2YgaXRzIGxhbmQKICAgICAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclNhbGUgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcHVyY2hhc2VMYW5kKHVpbnQgX2xhbmRJZCwgdWludCBfdHlwZVB1cmNoYXNlLCB1aW50IF9jb21taXNzaW9uKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShsYW5kc1tfbGFuZElkXS5sYW5kRm9yU2FsZSA9PSB0cnVlKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBsYW5kc1tfbGFuZElkXS5sYW5kUHJpY2UpOwoKICAgICAgICAvLyBUcmFuc2ZlciB0aGUgYW1vdW50IHBhaWQgdG8gdGhlIHByZXZpb3VzIGxhbmQgb3duZXIKICAgICAgICBsYW5kc1tfbGFuZElkXS5vd25lckFkZHJlc3MudHJhbnNmZXIobXNnLnZhbHVlKTsKCiAgICAgICAgLy8gVXBkYXRlIHRoZSBsYW5kCiAgICAgICAgbGFuZHNbX2xhbmRJZF0ub3duZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kRm9yU2FsZSA9IGZhbHNlOwoKICAgICAgICAvLy8gX3R5cGVQdXJjaGFzZToKICAgICAgICAvLy8gMDogQ3JlYXRlIGNpdHkKICAgICAgICAvLy8gMTogUmVudCB0aGUgbGFuZAogICAgICAgIC8vLyAyOiBDYW5jZWwgc2FsZQogICAgICAgIAogICAgICAgIGlmKF90eXBlUHVyY2hhc2UgPT0gMCkgewogICAgICAgICAgICAvLyBUaGUgdXNlciBpbiBwdXJjaGFzaW5nIHRoZSBsYW5kIHRvIGJ1aWxkIHRoZSBjaXR5IG9uIHRvcCBvZiBpdCB3ZSBjcmVhdGUgdGhlIGNpdHkgZGlyZWN0bHkKICAgICAgICAgICAgY3JlYXRlQ2l0eShfbGFuZElkKTsKICAgICAgICB9IGVsc2UgaWYoX3R5cGVQdXJjaGFzZSA9PSAxKSB7CiAgICAgICAgICAgIC8vIFRoZSB1c2VyIGlzIHB1cmNoYXNpbmcgdGhlIGxhbmQgdG8gcmVudCBpdCB0byBhbm90aGVyIHVzZXIKICAgICAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclJlbnQgPSB0cnVlOwogICAgICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kRm9yU2FsZSA9IGZhbHNlOwogICAgICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kT3duZXJDb21taXNzaW9uID0gX2NvbW1pc3Npb247CiAgICAgICAgfSAKICAgIH0KICAgIAogICAgLy8gV2UgdXNlIHRoaXMgZnVuY3Rpb24gdG8gbGV0IHVzZXJzIHJlbnQgbGFuZHMuCiAgICBmdW5jdGlvbiByZW50TGFuZCh1aW50IF9sYW5kSWQsIGJvb2wgX2NyZWF0ZUNpdHksIHVpbnQgX2NpdHlJZCkgcHVibGljIHsKICAgICAgICAvLyBUaGUgb3duZXIgY2FuIHJlbnQgdGhlIGxhbmQgZXZlbiBpZiBpdCdzIG5vdCBtYXJrZWQgZm9yUmVudAogICAgICAgIGlmKGxhbmRzW19sYW5kSWRdLm93bmVyQWRkcmVzcyAhPSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUobGFuZHNbX2xhbmRJZF0ubGFuZEZvclJlbnQgPT0gdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBDaXRpZXMgY2FuJ3QgcmVudCBhIGxhbmQgaWYgaXQncyBhbHJlYWR5IG9jY3VwaWVkCiAgICAgICAgcmVxdWlyZShsYW5kc1tfbGFuZElkXS5pc09jY3VwaWVkID09IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBpZihfY3JlYXRlQ2l0eSA9PSB0cnVlKSB7CiAgICAgICAgICAgIC8vIFdlIGNyZWF0ZSB0aGUgY2l0eSBpZiB0aGUgdXNlciBpcyByZW50aW5nIHRoaXMgbGFuZCBmb3IgYSBuZXcgY2l0eQogICAgICAgICAgICBjcmVhdGVDaXR5KF9sYW5kSWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIENpdGllcyBjYW4ndCByZW50IGEgbGFuZCBpZiB0aGV5IGFyZSBhbHJlYWR5IGxhbmRpbmcgb25lCiAgICAgICAgICAgIHJlcXVpcmUoY2l0aWVzW19jaXR5SWRdLmxhbmRJZCA9PSAwKTsKICAgICAgICAKICAgICAgICAgICAgLy8gV2UgdXBkYXRlIHRoZSBsYW5kIGFuZCBjaXR5IGlmIHRoZSB1c2VyIGlzIHJlbnRpbmcgdGhlIGxhbmQgZm9yIGFuIGV4aXN0aW5nIGNpdHkKICAgICAgICAgICAgY2l0aWVzW19jaXR5SWRdLmxhbmRJZCA9IF9sYW5kSWQ7CiAgICAgICAgICAgIGxhbmRzW19sYW5kSWRdLmNpdHlSZW50aW5nSWQgPSBfY2l0eUlkOwogICAgICAgICAgICBsYW5kc1tfbGFuZElkXS5sYW5kRm9yU2FsZSA9PSBmYWxzZTsKICAgICAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclJlbnQgPT0gdHJ1ZTsKICAgICAgICAgICAgbGFuZHNbX2xhbmRJZF0uaXNPY2N1cGllZCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUNpdHkodWludCBfbGFuZElkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobGFuZHNbX2xhbmRJZF0uaXNPY2N1cGllZCA9PSBmYWxzZSk7CgogICAgICAgIC8vIENyZWF0ZSB0aGUgY2l0eQogICAgICAgIHVpbnQgY2l0eUlkID0gY2l0aWVzLnB1c2goQ2l0eShfbGFuZElkLCBtc2cuc2VuZGVyLCAwLCAwLCBmYWxzZSwgMCwgMCkpIC0gMTsKCiAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclNhbGUgPT0gZmFsc2U7CiAgICAgICAgbGFuZHNbX2xhbmRJZF0ubGFuZEZvclJlbnQgPT0gZmFsc2U7CiAgICAgICAgbGFuZHNbX2xhbmRJZF0uY2l0eVJlbnRpbmdJZCA9IGNpdHlJZDsKICAgICAgICBsYW5kc1tfbGFuZElkXS5pc09jY3VwaWVkID0gdHJ1ZTsKICAgIH0KICAgIAogICAgLy8gVGhlIGRldiBjYW4gdXNlIHRoaXMgZnVuY3Rpb24gdG8gY3JlYXRlIGFuIGlubm9jdXBpZWQgbGFuZAogICAgZnVuY3Rpb24gQ3JlYXRlTGFuZCh1aW50MjU2IF9sYW5kUHJpY2UsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgb25seUNlbyB7CiAgICAgICAgLy8gV2UgY2FuJ3QgY3JlYXRlIG1vcmUgdGhhbiAzMDAgbGFuZHMuCiAgICAgICAgaWYobGFuZHMubGVuZ3RoIDwgMzAwKSB7CiAgICAgICAgICAgIGxhbmRzLnB1c2goTGFuZChfb3duZXIsIF9sYW5kUHJpY2UsIGZhbHNlLCBmYWxzZSwgMCwgZmFsc2UsIDApKTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFVwZGF0ZUluaXRpYXRlQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX25ld0FkZHJlc3MpIHB1YmxpYyBvbmx5Q2VvIHsgCiAgICAgICAgSW5pdGlhdGVMYW5kc0FkZHJlc3MgPSBfbmV3QWRkcmVzczsKICAgIH0KICAgIAogICAgLy8gV2UgaW5pdGlhbGl6ZSBzb21lIGRhdGFzIHdpdGggdGhpcyBmdW5jdGlvbgogICAgZnVuY3Rpb24gSW5pdGlhbGl6ZSgpIHB1YmxpYyBvbmx5Q2VvIHsKICAgICAgICAvLyBUbyBiZSBhYmxlIHRvIHVzZSB0aGUgbGFuZCBpZCBpbiB0aGUgY2l0eSBzdHJ1Y3QKICAgICAgICBsYW5kcy5wdXNoKExhbmQoY2VvQWRkcmVzcywgMCwgZmFsc2UsIGZhbHNlLCA1LCB0cnVlLCAwKSk7IC8vIEZha2UgTGFuZCAjMCBpcyBjcmVhdGVkIGhlcmUKCiAgICAgICAgLy8gU2F2ZSB0aGUgYW1vdW50IG9mIG1ldGFsIG5lZWRlZCB0byBwcm9kdWNlIHRoZSBidWlsZGluZ3MKICAgICAgICBCdWlsZGluZ1R5cGVNZXRhbE5lZWRlZFswXSA9IDM7CiAgICAgICAgQnVpbGRpbmdUeXBlTWV0YWxOZWVkZWRbMV0gPSA0OwogICAgICAgIEJ1aWxkaW5nVHlwZU1ldGFsTmVlZGVkWzJdID0gNTsKICAgICAgICBCdWlsZGluZ1R5cGVNZXRhbE5lZWRlZFszXSA9IDQ7CgogICAgICAgIC8vIFNhdmUgdGhlIHNxdWFyZXMgdXNlZCBieSBidWlsZGluZ3MKICAgICAgICBCdWlsZGluZ1R5cGVTcXVhcmVzT2NjdXBpZWRbMF0gPSAyOwogICAgICAgIEJ1aWxkaW5nVHlwZVNxdWFyZXNPY2N1cGllZFsxXSA9IDQ7CiAgICAgICAgQnVpbGRpbmdUeXBlU3F1YXJlc09jY3VwaWVkWzJdID0gNjsKICAgICAgICBCdWlsZGluZ1R5cGVTcXVhcmVzT2NjdXBpZWRbM10gPSA0OwogICAgICAgIEJ1aWxkaW5nVHlwZVNxdWFyZXNPY2N1cGllZFs0XSA9IDU7IC8vIEJ1c2luZXNzZXMKICAgIH0KfQ=='.
	

]
