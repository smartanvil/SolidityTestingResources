Class {
	#name : #SRTb3e5b75d085085d1b5c572f34c9beafd7f67129c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb3e5b75d085085d1b5c572f34c9beafd7f67129c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKgoqICAgQ3Jvd2RTYWxlIERhcENhciAoREFQWCkKKiAgIENyZWF0ZWQgYnkgU3RhcmxhZyBMYWJzICh3d3cuc3RhcmxhZy5jb20pCiogICBDb3B5cmlnaHQgJiMxNjk7IERhcENhci5pbyAyMDE4LiBBbGwgcmlnaHRzIHJlc2VydmVkLgoqICAgaHR0cHM6Ly93d3cuZGFwY2FyLmlvCiovCgpsaWJyYXJ5IE1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSAKICAgIGludGVybmFsIAogICAgcHVyZSAKICAgIHJldHVybnMgKHVpbnQyNTYpIAogICAgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIAogICAgaW50ZXJuYWwgCiAgICBwdXJlIAogICAgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSAKICAgIGludGVybmFsIAogICAgcHVyZSAKICAgIHJldHVybnMgKHVpbnQyNTYpIAogICAgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIAogICAgaW50ZXJuYWwgCiAgICBwdXJlIAogICAgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCmNvbnRyYWN0IFV0aWxzIHsKICAgIGZ1bmN0aW9uIFV0aWxzKCkgcHVibGljIHt9CgogICAgbW9kaWZpZXIgZ3JlYXRlclRoYW5aZXJvKHVpbnQyNTYgX3ZhbHVlKSAKICAgIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRVaW50KHVpbnQyNTYgX3ZhbHVlKSAKICAgIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSAKICAgIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90VGhpcyhhZGRyZXNzIF9hZGRyZXNzKSAKICAgIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzQW5kTm90VGhpcyhhZGRyZXNzIF9hZGRyZXNzKSAKICAgIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkgJiYgX2FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RFbXB0eShzdHJpbmcgX2RhdGEpCiAgICB7CiAgICAgICAgcmVxdWlyZShieXRlcyhfZGF0YSkubGVuZ3RoID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBzdHJpbmdMZW5ndGgoc3RyaW5nIF9kYXRhLCB1aW50MjU2IF9sZW5ndGgpCiAgICB7CiAgICAgICAgcmVxdWlyZShieXRlcyhfZGF0YSkubGVuZ3RoID09IF9sZW5ndGgpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIHZhbGlkQnl0ZXMzMihieXRlczMyIF9ieXRlcykKICAgIHsKICAgICAgICByZXF1aXJlKF9ieXRlcyAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkVWludDY0KHVpbnQ2NCBfdmFsdWUpIAogICAgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID49IDAgJiYgX3ZhbHVlIDwgNDI5NDk2NzI5Nik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZFVpbnQ4KHVpbnQ4IF92YWx1ZSkgCiAgICB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPj0gMCAmJiBfdmFsdWUgPCAyNTYpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRCYWxhbmNlVGhpcyh1aW50MjU2IF92YWx1ZSkKICAgIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhZGRyZXNzKHRoaXMpLmJhbGFuY2UpOwogICAgICAgIF87CiAgICB9Cn0KCmNvbnRyYWN0IEF1dGhvcml6YWJsZSBpcyBVdGlscyB7CiAgICB1c2luZyBNYXRoIGZvciB1aW50MjU2OwoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IExldmVsKSBhdXRob3JpemVkczsKICAgIHVpbnQyNTYgcHVibGljIGF1dGhvcml6ZWRDb3VudDsKCiAgICAvKiAgCiAgICAqICAgWkVSTyAwIC0gYnVnIGZvciBudWxsIG9iamVjdAogICAgKiAgIE9XTkVSIDEKICAgICogICBBRE1JTiAyCiAgICAqICAgREFQUCAzCiAgICAqLyAgCiAgICBlbnVtIExldmVsIHtaRVJPLE9XTkVSLEFETUlOLERBUFB9CgogICAgZXZlbnQgT3duZXJUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX3ByZXZPd25lciwgYWRkcmVzcyBpbmRleGVkIF9uZXdPd25lcik7CiAgICBldmVudCBBdXRob3JpemVkKGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgTGV2ZWwgX2xldmVsKTsKICAgIGV2ZW50IFVuQXV0aG9yaXplZChhZGRyZXNzIGluZGV4ZWQgX2FkZHJlc3MpOwoKICAgIGZ1bmN0aW9uIEF1dGhvcml6YWJsZSgpIAogICAgcHVibGljIAogICAgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBhdXRob3JpemVkc1ttc2cuc2VuZGVyXSA9IExldmVsLk9XTkVSOwogICAgICAgIGF1dGhvcml6ZWRDb3VudCA9IGF1dGhvcml6ZWRDb3VudC5hZGQoMSk7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKGF1dGhvcml6ZWRzW21zZy5zZW5kZXJdID09IExldmVsLk9XTkVSKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lck9yVGhpcyB7CiAgICAgICAgcmVxdWlyZShhdXRob3JpemVkc1ttc2cuc2VuZGVyXSA9PSBMZXZlbC5PV05FUiB8fCBtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90T3duZXIoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoYXV0aG9yaXplZHNbX2FkZHJlc3NdICE9IExldmVsLk9XTkVSKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGF1dGhMZXZlbChMZXZlbCBfbGV2ZWwpIHsKICAgICAgICByZXF1aXJlKChhdXRob3JpemVkc1ttc2cuc2VuZGVyXSA+IExldmVsLlpFUk8pICYmIChhdXRob3JpemVkc1ttc2cuc2VuZGVyXSA8PSBfbGV2ZWwpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGF1dGhMZXZlbE9ubHkoTGV2ZWwgX2xldmVsKSB7CiAgICAgICAgcmVxdWlyZShhdXRob3JpemVkc1ttc2cuc2VuZGVyXSA9PSBfbGV2ZWwpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG5vdFNlbmRlcihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IF9hZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzU2VuZGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gX2FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2hlY2tMZXZlbChMZXZlbCBfbGV2ZWwpIHsKICAgICAgICByZXF1aXJlKChfbGV2ZWwgPiBMZXZlbC5aRVJPKSAmJiAoTGV2ZWwuREFQUCA+PSBfbGV2ZWwpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSAKICAgIHB1YmxpYyAKICAgIHsKICAgICAgICBfdHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIAogICAgb25seU93bmVyIAogICAgdmFsaWRBZGRyZXNzKF9uZXdPd25lcikKICAgIG5vdFRoaXMoX25ld093bmVyKQogICAgaW50ZXJuYWwgCiAgICB7CiAgICAgICAgcmVxdWlyZShfbmV3T3duZXIgIT0gb3duZXIpOwogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIAogICAgdmFsaWRBZGRyZXNzKG5ld093bmVyKQogICAgaXNTZW5kZXIobmV3T3duZXIpCiAgICBwdWJsaWMgCiAgICB7CiAgICAgICAgT3duZXJUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIGlmIChhdXRob3JpemVkc1tvd25lcl0gPT0gTGV2ZWwuT1dORVIpIHsKICAgICAgICAgICAgZGVsZXRlIGF1dGhvcml6ZWRzW293bmVyXTsKICAgICAgICB9CiAgICAgICAgaWYgKGF1dGhvcml6ZWRzW25ld093bmVyXSA+IExldmVsLlpFUk8pIHsKICAgICAgICAgICAgYXV0aG9yaXplZENvdW50ID0gYXV0aG9yaXplZENvdW50LnN1YigxKTsKICAgICAgICB9CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICBuZXdPd25lciA9IGFkZHJlc3MoMCk7CiAgICAgICAgYXV0aG9yaXplZHNbb3duZXJdID0gTGV2ZWwuT1dORVI7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsT3duZXJzaGlwKCkgCiAgICBvbmx5T3duZXIKICAgIHB1YmxpYyAKICAgIHsKICAgICAgICBuZXdPd25lciA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZnVuY3Rpb24gYXV0aG9yaXplZChhZGRyZXNzIF9hZGRyZXNzLCBMZXZlbCBfbGV2ZWwpIAogICAgcHVibGljICAKICAgIHsKICAgICAgICBfYXV0aG9yaXplZChfYWRkcmVzcywgX2xldmVsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfYXV0aG9yaXplZChhZGRyZXNzIF9hZGRyZXNzLCBMZXZlbCBfbGV2ZWwpIAogICAgb25seU93bmVyCiAgICB2YWxpZEFkZHJlc3MoX2FkZHJlc3MpCiAgICBub3RPd25lcihfYWRkcmVzcykKICAgIG5vdFRoaXMoX2FkZHJlc3MpCiAgICBjaGVja0xldmVsKF9sZXZlbCkKICAgIGludGVybmFsICAKICAgIHsKICAgICAgICBpZiAoYXV0aG9yaXplZHNbX2FkZHJlc3NdID09IExldmVsLlpFUk8pIHsKICAgICAgICAgICAgYXV0aG9yaXplZENvdW50ID0gYXV0aG9yaXplZENvdW50LmFkZCgxKTsKICAgICAgICB9CiAgICAgICAgYXV0aG9yaXplZHNbX2FkZHJlc3NdID0gX2xldmVsOwogICAgICAgIEF1dGhvcml6ZWQoX2FkZHJlc3MsIF9sZXZlbCk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5BdXRob3JpemVkKGFkZHJlc3MgX2FkZHJlc3MpIAogICAgb25seU93bmVyCiAgICB2YWxpZEFkZHJlc3MoX2FkZHJlc3MpCiAgICBub3RPd25lcihfYWRkcmVzcykKICAgIG5vdFRoaXMoX2FkZHJlc3MpCiAgICBwdWJsaWMgIAogICAgewogICAgICAgIGlmIChhdXRob3JpemVkc1tfYWRkcmVzc10gPiBMZXZlbC5aRVJPKSB7CiAgICAgICAgICAgIGF1dGhvcml6ZWRDb3VudCA9IGF1dGhvcml6ZWRDb3VudC5zdWIoMSk7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBhdXRob3JpemVkc1tfYWRkcmVzc107CiAgICAgICAgVW5BdXRob3JpemVkKF9hZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQoYWRkcmVzcyBfYWRkcmVzcykgCiAgICB2YWxpZEFkZHJlc3MoX2FkZHJlc3MpCiAgICBub3RUaGlzKF9hZGRyZXNzKQogICAgcHVibGljIAogICAgY29uc3RhbnQgCiAgICByZXR1cm5zIChMZXZlbCkgCiAgICB7CiAgICAgICAgcmV0dXJuIGF1dGhvcml6ZWRzW19hZGRyZXNzXTsKICAgIH0KfQoKY29udHJhY3QgSUVSQzIwIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IElUb2tlblJlY2lwaWVudCB7IGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsgfQoKY29udHJhY3QgSUNvdXBvblRva2VuIHsKICAgIGZ1bmN0aW9uIHVwZENvdXBvbkNvbnN1bWVkKHN0cmluZyBfY29kZSwgYm9vbCBfY29uc3VtZWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0Q291cG9uKHN0cmluZyBfY29kZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBib251cywgCiAgICAgICAgYm9vbCBkaXNwb3NhYmxlLCBib29sIGNvbnN1bWVkLCBib29sIGVuYWJsZWQpOwp9Cgpjb250cmFjdCBJRGFwQ2FyVG9rZW4gewogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKTsKfQoKY29udHJhY3QgSUFpckRyb3BUb2tlbiB7CiAgICBmdW5jdGlvbiBidXJuQWlyRHJvcChhZGRyZXNzW10gX2FkZHJlc3MpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7Cn0KCmNvbnRyYWN0IENyb3dkU2FsZURhcENhciBpcyBBdXRob3JpemFibGUgewogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIjAuMSI7CiAgICBzdHJpbmcgcHVibGljIHB1Ymxpc2hlciA9ICJodHRwczovL3d3dy5kYXBjYXIuaW8iOwogICAgc3RyaW5nIHB1YmxpYyBkZXNjcmlwdGlvbiA9ICJUaGlzIGlzIGFuIG9mZmljaWFsIENyb3dkU2FsZSBEYXBDYXIgKERBUFgpIjsKCiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXRXaXRoZHJhdzsKICAgIElEYXBDYXJUb2tlbiBwdWJsaWMgZGFwQ2FyVG9rZW47CiAgICBJQWlyRHJvcFRva2VuIHB1YmxpYyBhaXJEcm9wVG9rZW47CiAgICBJQ291cG9uVG9rZW4gcHVibGljIGNvdXBvblRva2VuOwoKICAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyBzb2xkVG9rZW4gPSAwOwogICAgdWludDI1NiBwdWJsaWMgZnVuZFRva2VuID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHdlaURvbmF0ZWQgPSAwOwogICAgdWludDI1NiBwdWJsaWMgbWluUHVyY2hhc2VMaW1pdCA9IDEwIGZpbm5leTsKCiAgICBib29sIHB1YmxpYyBjcm93ZFNhbGVFbmFibGVkID0gdHJ1ZTsKICAgIGJvb2wgcHVibGljIGNyb3dkU2FsZUZpbmFsaXplZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgY3Jvd2RTYWxlSW5pdGlhbGl6ZWQgPSBmYWxzZTsKCiAgICBib29sIHB1YmxpYyBhaXJEcm9wVG9rZW5FbmFibGVkID0gdHJ1ZTsKICAgIGJvb2wgcHVibGljIGFpckRyb3BUb2tlbkRlc3Ryb3kgPSB0cnVlOwogICAgYm9vbCBwdWJsaWMgYW1vdW50Qm9udXNFbmFibGVkID0gdHJ1ZTsKICAgIGJvb2wgcHVibGljIGNvdXBvbkJvbnVzRW5hYmxlZCA9IHRydWU7CgogICAgbWFwcGluZyAodWludDggPT4gUmF0ZSkgcmF0ZXM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBJbnZlc3RvcikgaW52ZXN0b3JzOwogICAgdWludDI1NiBwdWJsaWMgaW52ZXN0b3JDb3VudDsKCiAgICAvKiAgCiAgICAqICAgWkVSTyAwIC0gYnVnIGZvciBudWxsIG9iamVjdAogICAgKiAgIFBSRVNBTEUgMQogICAgKiAgIFBSRUlDTyAyCiAgICAqICAgSUNPIDMKICAgICogICBQUkVSRUxFQVNFIDQKICAgICovIAogICAgZW51bSBQZXJpb2Qge1pFUk8sUFJFU0FMRSxQUkVJQ08sSUNPLFBSRVJFTEVBU0V9CgogICAgc3RydWN0IFJhdGUgewogICAgICAgIFBlcmlvZCBwZXJpb2Q7CiAgICAgICAgdWludDI1NiByYXRlOwogICAgICAgIHVpbnQyNTYgYm9udXNBaXJEcm9wOwogICAgICAgIHVpbnQ2NCBzdGFydDsKICAgICAgICB1aW50NjQgc3RvcDsKICAgICAgICB1aW50NjQgdXBkYXRlZDsKICAgICAgICBib29sIGVuYWJsZWQ7CiAgICAgICAgYm9vbCBpbml0aWFsaXplZDsKICAgIH0KCiAgICBzdHJ1Y3QgSW52ZXN0b3IgewogICAgICAgIGFkZHJlc3Mgd2FsbGV0OwogICAgICAgIHVpbnQyNTYgYm9udXM7CiAgICAgICAgdWludDY0IHVwZGF0ZWQ7CiAgICAgICAgYm9vbCBwcmVTYWxlRW5hYmxlZDsKICAgICAgICBib29sIGVuYWJsZWQ7CiAgICAgICAgYm9vbCBpbml0aWFsaXplZDsKICAgIH0KCgogICAgZXZlbnQgRG9uYXRlKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgV2FsbGV0V2l0aGRyYXdDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCBvbGRXYWxsZXQsIGFkZHJlc3MgaW5kZXhlZCBuZXdXYWxsZXQpOwogICAgZXZlbnQgV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgYWRkcmVzcyBpbmRleGVkIHdhbGxldCwgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgV2l0aGRyYXdUb2tlbnMoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgYWRkcmVzcyBpbmRleGVkIHdhbGxldCwgYWRkcmVzcyBpbmRleGVkIHRva2VuLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBSZWNlaXZlVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCBhZGRyZXNzIGluZGV4ZWQgdG9rZW4sIHVpbnQyNTYgdmFsdWUsIGJ5dGVzIGV4dHJhRGF0YSk7CiAgICBldmVudCBSYXRlUHJvcHNDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQ4IHBlcmlvZCwgc3RyaW5nIHByb3BzLCBib29sIHZhbHVlKTsKICAgIGV2ZW50IFJhdGVDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQ4IHBlcmlvZCwgdWludDI1NiBvbGRCb251cywgdWludDI1NiBuZXdCb251cyk7CiAgICBldmVudCBSYXRlQm9udXNDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQ4IHBlcmlvZCwgdWludDI1NiBvbGRCb251cywgdWludDI1NiBuZXdCb251cyk7CiAgICBldmVudCBSYXRlVGltZUNoYW5nZWQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludDggcGVyaW9kLCB1aW50NjQgb2xkU3RhcnQsIHVpbnQ2NCBvbGRTdG9wLCAKICAgICAgICB1aW50NjQgbmV3U3RhcnQsIHVpbnQ2NCBuZXdTdG9wKTsKICAgIGV2ZW50IEludmVzdG9yRGVsZXRlZChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCBhZGRyZXNzIGluZGV4ZWQgd2FsbGV0KTsKICAgIGV2ZW50IEludmVzdG9yUHJvcHNDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCB3YWxsZXQsIHN0cmluZyBwcm9wcywgYm9vbCB2YWx1ZSk7CiAgICBldmVudCBJbnZlc3RvckJvbnVzQ2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCBhZGRyZXNzIGluZGV4ZWQgd2FsbGV0LCB1aW50MjU2IG9sZEJvbnVzLCB1aW50MjU2IG5ld0JvbnVzKTsKICAgIGV2ZW50IEludmVzdG9yQ3JlYXRlZChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCBhZGRyZXNzIGluZGV4ZWQgd2FsbGV0LCB1aW50MjU2IGJvbnVzKTsKICAgIGV2ZW50IFB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQyNTYgYW1vdW50V2VpLCB1aW50MjU2IGFtb3VudFRva2VuLCB1aW50MjU2IHRvdGFsQm9udXMpOwogICAgZXZlbnQgUHJvcHNDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHN0cmluZyBwcm9wcywgYm9vbCBvbGRWYWx1ZSwgYm9vbCBuZXdWYWx1ZSk7CiAgICBldmVudCBNaW5QdXJjaGFzZUxpbWl0Q2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50MjU2IG9sZFZhbHUsIHVpbnQyNTYgbmV3VmFsdWUpOwogICAgZXZlbnQgRmluYWxpemVkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQ2NCB0aW1lLCB1aW50MjU2IHdlaVJhaXNlZCwgdWludDI1NiBzb2xkVG9rZW4sIAogICAgICAgIHVpbnQyNTYgZnVuZFRva2VuLCB1aW50MjU2IHdlaURvbmF0ZWQpOwoKICAgIG1vZGlmaWVyIHZhbGlkUGVyaW9kKFBlcmlvZCBfcGVyaW9kKSAKICAgIHsKICAgICAgICByZXF1aXJlKF9wZXJpb2QgPiBQZXJpb2QuWkVSTyAmJiBfcGVyaW9kIDw9IFBlcmlvZC5QUkVSRUxFQVNFKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIENyb3dkU2FsZURhcENhcigpIHB1YmxpYyB7CiAgICAgICAgY3Jvd2RTYWxlUGVyaW9kSW5pdCgpOwogICAgfQoKICAgIC8qCiAgICAqICAgUFJFU0FMRTogMSBEQVBYID0gMSQKICAgICogICBNb25kYXksIDUgTWFyY2ggMjAxOCwgMDA6MDA6MDAgR01UIC0gU3VuZGF5LCAyNSBNYXJjaCAyMDE4LCAyMzo1OTo1OSBHTVQKICAgICogICBQUkVJQ086IDEgREFQWCA9IDIkCiAgICAqICAgTW9uZGF5LCA5IEFwcmlsIDIwMTgsIDAwOjAwOjAwIEdNVCAtIFN1bmRheSwgMjkgQXByaWwgMjAxOCwgMjM6NTk6NTkgR01UCiAgICAqICAgSUNPOiAxIERBUFggPSA1JAogICAgKiAgIE1vbmRheSwgNyBNYXkgMjAxOCwgMDA6MDA6MDAgR01UIC0gU3VuZGF5LCAxNyBKdW5lIDIwMTgsIDIzOjU5OjU5IEdNVAogICAgKiAgIFBSRVJFTEVBU0U6IDEgREFQWCA9IDEwJAogICAgKiAgIE1vbmRheSwgMTggSnVuZSAyMDE4LCAwMDowMDowMCBHTVQgLSBTdW5kYXksIDEgSnVseSAyMDE4LCAyMzo1OTo1OSBHTVQKICAgICogICBSRUxFQVNFIEdBTUU6IDEgREFQWCA9IDEgREFQQk9YID49IDE1JAogICAgKi8KICAgIAogICAgZnVuY3Rpb24gY3Jvd2RTYWxlUGVyaW9kSW5pdCgpCiAgICBvbmx5T3duZXJPclRoaXMKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGlmICghY3Jvd2RTYWxlSW5pdGlhbGl6ZWQpIHsKICAgICAgICAgICAgUmF0ZSBtZW1vcnkgcmF0ZVByZVNhbGUgPSBSYXRlKHsKICAgICAgICAgICAgICAgIHBlcmlvZDogUGVyaW9kLlBSRVNBTEUsCiAgICAgICAgICAgICAgICByYXRlOiA3NDAsCiAgICAgICAgICAgICAgICBib251c0FpckRyb3A6IDAsCiAgICAgICAgICAgICAgICBzdGFydDogMTUyMDIwODAwMCwKICAgICAgICAgICAgICAgIHN0b3A6IDE1MjIwMjIzOTksCiAgICAgICAgICAgICAgICB1cGRhdGVkOiAwLAogICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGluaXRpYWxpemVkOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByYXRlc1t1aW50OChQZXJpb2QuUFJFU0FMRSldID0gcmF0ZVByZVNhbGU7CgogICAgICAgICAgICBSYXRlIG1lbW9yeSByYXRlUHJlSWNvID0gUmF0ZSh7CiAgICAgICAgICAgICAgICBwZXJpb2Q6IFBlcmlvZC5QUkVJQ08sCiAgICAgICAgICAgICAgICByYXRlOiAzNzAsCiAgICAgICAgICAgICAgICBib251c0FpckRyb3A6IDEwLAogICAgICAgICAgICAgICAgc3RhcnQ6IDE1MjMyMzIwMDAsCiAgICAgICAgICAgICAgICBzdG9wOiAxNTI1MDQ2Mzk5LAogICAgICAgICAgICAgICAgdXBkYXRlZDogMCwKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmF0ZXNbdWludDgoUGVyaW9kLlBSRUlDTyldID0gcmF0ZVByZUljbzsKCiAgICAgICAgICAgIFJhdGUgbWVtb3J5IHJhdGVJY28gPSBSYXRlKHsKICAgICAgICAgICAgICAgIHBlcmlvZDogUGVyaW9kLklDTywKICAgICAgICAgICAgICAgIHJhdGU6IDE0OCwKICAgICAgICAgICAgICAgIGJvbnVzQWlyRHJvcDogNSwKICAgICAgICAgICAgICAgIHN0YXJ0OiAxNTI1NjUxMjAwLAogICAgICAgICAgICAgICAgc3RvcDogMTUyOTI3OTk5OSwKICAgICAgICAgICAgICAgIHVwZGF0ZWQ6IDAsCiAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLAogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJhdGVzW3VpbnQ4KFBlcmlvZC5JQ08pXSA9IHJhdGVJY287CgogICAgICAgICAgICBSYXRlIG1lbW9yeSByYXRlUHJlUmVsZWFzZSA9IFJhdGUoewogICAgICAgICAgICAgICAgcGVyaW9kOiBQZXJpb2QuUFJFUkVMRUFTRSwKICAgICAgICAgICAgICAgIHJhdGU6IDc0LAogICAgICAgICAgICAgICAgYm9udXNBaXJEcm9wOiAwLAogICAgICAgICAgICAgICAgc3RhcnQ6IDE1MjkyODAwMDAsCiAgICAgICAgICAgICAgICBzdG9wOiAxNTMwNDg5NTk5LAogICAgICAgICAgICAgICAgdXBkYXRlZDogMCwKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmF0ZXNbdWludDgoUGVyaW9kLlBSRVJFTEVBU0UpXSA9IHJhdGVQcmVSZWxlYXNlOwogICAgICAgIAogICAgICAgICAgICBjcm93ZFNhbGVJbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbm93UGVyaW9kKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKFBlcmlvZCkKICAgIHsKICAgICAgICB1aW50NjQgbm93NjQgPSB1aW50NjQobm93KTsKICAgICAgICBQZXJpb2QgcGVyaW9kID0gUGVyaW9kLlpFUk87CiAgICAgICAgZm9yICh1aW50OCBpID0gMTsgaSA8PSB1aW50OChQZXJpb2QuUFJFUkVMRUFTRSk7IGkrKykgewogICAgICAgICAgICBSYXRlIG1lbW9yeSByYXRlID0gcmF0ZXNbaV07CiAgICAgICAgICAgIGlmICghcmF0ZS5pbml0aWFsaXplZCB8fCAhcmF0ZS5lbmFibGVkKSB7IAogICAgICAgICAgICAgICAgY29udGludWU7IAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyYXRlLnN0YXJ0ID09IDAgfHwgcmF0ZS5zdG9wID09IDAgfHwgcmF0ZS5yYXRlID09IDApIHsgCiAgICAgICAgICAgICAgICBjb250aW51ZTsgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChub3c2NCA+PSByYXRlLnN0YXJ0ICYmIG5vdzY0IDwgcmF0ZS5zdG9wKSB7CiAgICAgICAgICAgICAgICBwZXJpb2QgPSByYXRlLnBlcmlvZDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcGVyaW9kOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZENyb3dkU2FsZUVuYWJsZWQoYm9vbCBfdmFsdWUpCiAgICBhdXRoTGV2ZWwoTGV2ZWwuQURNSU4pCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBQcm9wc0NoYW5nZWQobXNnLnNlbmRlciwgImNyb3dkU2FsZUVuYWJsZWQiLCBjcm93ZFNhbGVFbmFibGVkLCBfdmFsdWUpOwogICAgICAgIGNyb3dkU2FsZUVuYWJsZWQgPSBfdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkQWlyRHJvcFRva2VuRW5hYmxlZChib29sIF92YWx1ZSkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIFByb3BzQ2hhbmdlZChtc2cuc2VuZGVyLCAiYWlyRHJvcFRva2VuRW5hYmxlZCIsIGFpckRyb3BUb2tlbkVuYWJsZWQsIF92YWx1ZSk7CiAgICAgICAgYWlyRHJvcFRva2VuRW5hYmxlZCA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRBaXJEcm9wVG9rZW5EZXN0cm95KGJvb2wgX3ZhbHVlKQogICAgYXV0aExldmVsKExldmVsLkFETUlOKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgUHJvcHNDaGFuZ2VkKG1zZy5zZW5kZXIsICJhaXJEcm9wVG9rZW5EZXN0cm95IiwgYWlyRHJvcFRva2VuRGVzdHJveSwgX3ZhbHVlKTsKICAgICAgICBhaXJEcm9wVG9rZW5EZXN0cm95ID0gX3ZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZEFtb3VudEJvbnVzRW5hYmxlZChib29sIF92YWx1ZSkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIFByb3BzQ2hhbmdlZChtc2cuc2VuZGVyLCAiYW1vdW50Qm9udXNFbmFibGVkIiwgYW1vdW50Qm9udXNFbmFibGVkLCBfdmFsdWUpOwogICAgICAgIGFtb3VudEJvbnVzRW5hYmxlZCA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRDb3Vwb25Cb251c0VuYWJsZWQoYm9vbCBfdmFsdWUpCiAgICBhdXRoTGV2ZWwoTGV2ZWwuQURNSU4pCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBQcm9wc0NoYW5nZWQobXNnLnNlbmRlciwgImNvdXBvbkJvbnVzRW5hYmxlZCIsIGNvdXBvbkJvbnVzRW5hYmxlZCwgX3ZhbHVlKTsKICAgICAgICBjb3Vwb25Cb251c0VuYWJsZWQgPSBfdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkTWluUHVyY2hhc2VMaW1pdCh1aW50MjU2IF9saW1pdCkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkVWludChfbGltaXQpCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBNaW5QdXJjaGFzZUxpbWl0Q2hhbmdlZChtc2cuc2VuZGVyLCBtaW5QdXJjaGFzZUxpbWl0LCBfbGltaXQpOwogICAgICAgIG1pblB1cmNoYXNlTGltaXQgPSBfbGltaXQ7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFJhdGUoUGVyaW9kIF9wZXJpb2QpCiAgICB2YWxpZFBlcmlvZChfcGVyaW9kKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludDI1NiByYXRlVmFsdWUsIHVpbnQyNTYgYm9udXNBaXJEcm9wLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBzdG9wLCB1aW50NjQgdXBkYXRlZCwgYm9vbCBlbmFibGVkKQogICAgewogICAgICAgIHVpbnQ4IHBlcmlvZCA9IHVpbnQ4KF9wZXJpb2QpOwogICAgICAgIFJhdGUgbWVtb3J5IHJhdGUgPSByYXRlc1twZXJpb2RdOwogICAgICAgIHJlcXVpcmUocmF0ZS5pbml0aWFsaXplZCk7CgogICAgICAgIHJldHVybiAocmF0ZS5yYXRlLCByYXRlLmJvbnVzQWlyRHJvcCwgcmF0ZS5zdGFydCwgcmF0ZS5zdG9wLCByYXRlLnVwZGF0ZWQsIHJhdGUuZW5hYmxlZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkUmF0ZShQZXJpb2QgX3BlcmlvZCwgdWludDI1NiBfcmF0ZSkKICAgIGF1dGhMZXZlbChMZXZlbC5EQVBQKQogICAgdmFsaWRQZXJpb2QoX3BlcmlvZCkKICAgIGdyZWF0ZXJUaGFuWmVybyhfcmF0ZSkKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHVpbnQ4IHBlcmlvZCA9IHVpbnQ4KF9wZXJpb2QpOwogICAgICAgIHJlcXVpcmUocmF0ZXNbcGVyaW9kXS5pbml0aWFsaXplZCk7CgogICAgICAgIFJhdGVDaGFuZ2VkKG1zZy5zZW5kZXIsIHBlcmlvZCwgcmF0ZXNbcGVyaW9kXS5yYXRlLCBfcmF0ZSk7CiAgICAgICAgcmF0ZXNbcGVyaW9kXS5yYXRlID0gX3JhdGU7CiAgICAgICAgcmF0ZXNbcGVyaW9kXS51cGRhdGVkID0gdWludDY0KG5vdyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkUmF0ZUJvbnVzQWlyRHJvcChQZXJpb2QgX3BlcmlvZCwgdWludDI1NiBfYm9udXNBaXJEcm9wKQogICAgYXV0aExldmVsKExldmVsLkRBUFApCiAgICB2YWxpZFBlcmlvZChfcGVyaW9kKQogICAgdmFsaWRVaW50KF9ib251c0FpckRyb3ApCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICB1aW50OCBwZXJpb2QgPSB1aW50OChfcGVyaW9kKTsKICAgICAgICByZXF1aXJlKHJhdGVzW3BlcmlvZF0uaW5pdGlhbGl6ZWQpOwoKICAgICAgICBSYXRlQm9udXNDaGFuZ2VkKG1zZy5zZW5kZXIsIHBlcmlvZCwgcmF0ZXNbcGVyaW9kXS5ib251c0FpckRyb3AsIF9ib251c0FpckRyb3ApOwogICAgICAgIHJhdGVzW3BlcmlvZF0uYm9udXNBaXJEcm9wID0gX2JvbnVzQWlyRHJvcDsKICAgICAgICByYXRlc1twZXJpb2RdLnVwZGF0ZWQgPSB1aW50NjQobm93KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRSYXRlVGltZXMoUGVyaW9kIF9wZXJpb2QsIHVpbnQ2NCBfc3RhcnQsIHVpbnQ2NCBfc3RvcCkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkUGVyaW9kKF9wZXJpb2QpCiAgICB2YWxpZFVpbnQ2NChfc3RhcnQpCiAgICB2YWxpZFVpbnQ2NChfc3RvcCkKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoX3N0YXJ0IDwgX3N0b3ApOwogICAgICAgIHVpbnQ4IHBlcmlvZCA9IHVpbnQ4KF9wZXJpb2QpOwogICAgICAgIHJlcXVpcmUocmF0ZXNbcGVyaW9kXS5pbml0aWFsaXplZCk7CgogICAgICAgIFJhdGVUaW1lQ2hhbmdlZChtc2cuc2VuZGVyLCBwZXJpb2QsIHJhdGVzW3BlcmlvZF0uc3RhcnQsIHJhdGVzW3BlcmlvZF0uc3RvcCwgX3N0YXJ0LCBfc3RvcCk7CiAgICAgICAgcmF0ZXNbcGVyaW9kXS5zdGFydCA9IF9zdGFydDsKICAgICAgICByYXRlc1twZXJpb2RdLnN0b3AgPSBfc3RvcDsKICAgICAgICByYXRlc1twZXJpb2RdLnVwZGF0ZWQgPSB1aW50NjQobm93KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRSYXRlRW5hYmxlZChQZXJpb2QgX3BlcmlvZCwgYm9vbCBfZW5hYmxlZCkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkUGVyaW9kKF9wZXJpb2QpCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICB1aW50OCBwZXJpb2QgPSB1aW50OChfcGVyaW9kKTsKICAgICAgICByZXF1aXJlKHJhdGVzW3BlcmlvZF0uaW5pdGlhbGl6ZWQpOwoKICAgICAgICByYXRlc1twZXJpb2RdLmVuYWJsZWQgPSBfZW5hYmxlZDsKICAgICAgICByYXRlc1twZXJpb2RdLnVwZGF0ZWQgPSB1aW50NjQobm93KTsKICAgICAgICBSYXRlUHJvcHNDaGFuZ2VkKG1zZy5zZW5kZXIsIHBlcmlvZCwgImVuYWJsZWQiLCBfZW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW52ZXN0b3IoYWRkcmVzcyBfd2FsbGV0LCB1aW50MjU2IF9ib251cykKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkQWRkcmVzcyhfd2FsbGV0KQogICAgbm90VGhpcyhfd2FsbGV0KQogICAgdmFsaWRVaW50KF9ib251cykKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHVpbnQ2NCBub3c2NCA9IHVpbnQ2NChub3cpOwogICAgICAgIGlmIChpbnZlc3RvcnNbX3dhbGxldF0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICAgICAgSW52ZXN0b3JCb251c0NoYW5nZWQobXNnLnNlbmRlciwgX3dhbGxldCwgaW52ZXN0b3JzW193YWxsZXRdLmJvbnVzLCBfYm9udXMpOwogICAgICAgICAgICBpbnZlc3RvcnNbX3dhbGxldF0uYm9udXMgPSBfYm9udXM7CiAgICAgICAgICAgIGludmVzdG9yc1tfd2FsbGV0XS51cGRhdGVkID0gbm93NjQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSW52ZXN0b3IgbWVtb3J5IGludmVzdG9yID0gSW52ZXN0b3IoewogICAgICAgICAgICAgICAgd2FsbGV0OiBfd2FsbGV0LAogICAgICAgICAgICAgICAgYm9udXM6IF9ib251cywKICAgICAgICAgICAgICAgIHVwZGF0ZWQ6IG5vdzY0LAogICAgICAgICAgICAgICAgcHJlU2FsZUVuYWJsZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGluaXRpYWxpemVkOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpbnZlc3RvcnNbX3dhbGxldF0gPSBpbnZlc3RvcjsKICAgICAgICAgICAgaW52ZXN0b3JDb3VudCA9IGludmVzdG9yQ291bnQuYWRkKDEpOwogICAgICAgICAgICBJbnZlc3RvckNyZWF0ZWQobXNnLnNlbmRlciwgX3dhbGxldCwgX2JvbnVzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZEludmVzdG9yRW5hYmxlZChhZGRyZXNzIF93YWxsZXQsIGJvb2wgX2VuYWJsZWQpCiAgICBhdXRoTGV2ZWwoTGV2ZWwuQURNSU4pCiAgICB2YWxpZEFkZHJlc3MoX3dhbGxldCkKICAgIG5vdFRoaXMoX3dhbGxldCkKICAgIHB1YmxpYwogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoaW52ZXN0b3JzW193YWxsZXRdLmluaXRpYWxpemVkKTsKCiAgICAgICAgaW52ZXN0b3JzW193YWxsZXRdLmVuYWJsZWQgPSBfZW5hYmxlZDsKICAgICAgICBpbnZlc3RvcnNbX3dhbGxldF0udXBkYXRlZCA9IHVpbnQ2NChub3cpOwogICAgICAgIEludmVzdG9yUHJvcHNDaGFuZ2VkKG1zZy5zZW5kZXIsIF93YWxsZXQsICJlbmFibGVkIiwgX2VuYWJsZWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZEludmVzdG9yUHJlU2FsZUVuYWJsZWQoYWRkcmVzcyBfd2FsbGV0LCBib29sIF9wcmVTYWxlRW5hYmxlZCkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkQWRkcmVzcyhfd2FsbGV0KQogICAgbm90VGhpcyhfd2FsbGV0KQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RvcnNbX3dhbGxldF0uaW5pdGlhbGl6ZWQpOwoKICAgICAgICBpbnZlc3RvcnNbX3dhbGxldF0ucHJlU2FsZUVuYWJsZWQgPSBfcHJlU2FsZUVuYWJsZWQ7CiAgICAgICAgaW52ZXN0b3JzW193YWxsZXRdLnVwZGF0ZWQgPSB1aW50NjQobm93KTsKICAgICAgICBJbnZlc3RvclByb3BzQ2hhbmdlZChtc2cuc2VuZGVyLCBfd2FsbGV0LCAicHJlU2FsZUVuYWJsZWQiLCBfcHJlU2FsZUVuYWJsZWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbEludmVzdG9yKGFkZHJlc3MgX3dhbGxldCkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkQWRkcmVzcyhfd2FsbGV0KQogICAgbm90VGhpcyhfd2FsbGV0KQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RvcnNbX3dhbGxldF0uaW5pdGlhbGl6ZWQpOwoKICAgICAgICBkZWxldGUgaW52ZXN0b3JzW193YWxsZXRdOwogICAgICAgIGludmVzdG9yQ291bnQgPSBpbnZlc3RvckNvdW50LnN1YigxKTsKICAgICAgICBJbnZlc3RvckRlbGV0ZWQobXNnLnNlbmRlciwgX3dhbGxldCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW52ZXN0b3IoYWRkcmVzcyBfd2FsbGV0KQogICAgdmFsaWRBZGRyZXNzKF93YWxsZXQpCiAgICBub3RUaGlzKF93YWxsZXQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50MjU2IGJvbnVzLCB1aW50NjQgdXBkYXRlZCwgYm9vbCBwcmVTYWxlRW5hYmxlZCwgYm9vbCBlbmFibGVkKQogICAgewogICAgICAgIEludmVzdG9yIG1lbW9yeSBpbnZlc3RvciA9IGludmVzdG9yc1tfd2FsbGV0XTsKICAgICAgICByZXF1aXJlKGludmVzdG9yLmluaXRpYWxpemVkKTsKCiAgICAgICAgcmV0dXJuIChpbnZlc3Rvci5ib251cywKICAgICAgICAgICAgaW52ZXN0b3IudXBkYXRlZCwKICAgICAgICAgICAgaW52ZXN0b3IucHJlU2FsZUVuYWJsZWQsCiAgICAgICAgICAgIGludmVzdG9yLmVuYWJsZWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFdhbGxldFdpdGhkcmF3KGFkZHJlc3MgX3dhbGxldCkKICAgIG9ubHlPd25lcgogICAgbm90VGhpcyhfd2FsbGV0KQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgV2FsbGV0V2l0aGRyYXdDaGFuZ2VkKG1zZy5zZW5kZXIsIHdhbGxldFdpdGhkcmF3LCBfd2FsbGV0KTsKICAgICAgICB3YWxsZXRXaXRoZHJhdyA9IF93YWxsZXQ7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0RGFwQ2FyVG9rZW4oYWRkcmVzcyBfdG9rZW4pCiAgICBhdXRoTGV2ZWwoTGV2ZWwuQURNSU4pCiAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgbm90VGhpcyhfdG9rZW4pCiAgICBub3RPd25lcihfdG9rZW4pCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBkYXBDYXJUb2tlbiA9IElEYXBDYXJUb2tlbihfdG9rZW4pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvdXBvblRva2VuKGFkZHJlc3MgX3Rva2VuKQogICAgYXV0aExldmVsKExldmVsLkFETUlOKQogICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgIG5vdFRoaXMoX3Rva2VuKQogICAgbm90T3duZXIoX3Rva2VuKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgY291cG9uVG9rZW4gPSBJQ291cG9uVG9rZW4oX3Rva2VuKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBaXJEcm9wVG9rZW4oYWRkcmVzcyBfdG9rZW4pCiAgICBhdXRoTGV2ZWwoTGV2ZWwuQURNSU4pCiAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgbm90VGhpcyhfdG9rZW4pCiAgICBub3RPd25lcihfdG9rZW4pCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBhaXJEcm9wVG9rZW4gPSBJQWlyRHJvcFRva2VuKF90b2tlbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZUFpckRyb3BUb2tlbihhZGRyZXNzIF9hZGRyZXNzKQogICAgdmFsaWRBZGRyZXNzKF9hZGRyZXNzKQogICAgbm90T3duZXIoX2FkZHJlc3MpCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkKICAgIHsKICAgICAgICBpZiAoYWRkcmVzcyhhaXJEcm9wVG9rZW4pICE9IDApIHsKICAgICAgICAgICAgcmV0dXJuIGFpckRyb3BUb2tlbi5iYWxhbmNlT2YoX2FkZHJlc3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkb25hdGUoKSAKICAgIGludGVybmFsIAogICAgewogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHdlaURvbmF0ZWQgPSB3ZWlEb25hdGVkLmFkZChtc2cudmFsdWUpOwogICAgICAgICAgICBEb25hdGUobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgICAgICAgICAgaWYgKHdhbGxldFdpdGhkcmF3ICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgICAgIHdhbGxldFdpdGhkcmF3LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgl9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoYWRkcmVzcyBfdG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikKICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICBub3RPd25lcihfdG9rZW4pCiAgICBub3RUaGlzKF90b2tlbikKICAgIGdyZWF0ZXJUaGFuWmVybyhfYW1vdW50KQogICAgcHVibGljIAogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAKICAgIHsKICAgICAgICBhZGRyZXNzIHdhbGxldCA9IHdhbGxldFdpdGhkcmF3OwogICAgICAgIGlmICh3YWxsZXQgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICB3YWxsZXQgPSBtc2cuc2VuZGVyOwogICAgICAgIH0KCiAgICAgICAgYm9vbCByZXN1bHQgPSBJRVJDMjAoX3Rva2VuKS50cmFuc2Zlcih3YWxsZXQsIF9hbW91bnQpOwogICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgV2l0aGRyYXdUb2tlbnMobXNnLnNlbmRlciwgd2FsbGV0LCBfdG9rZW4sIF9hbW91bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgCiAgICBwdWJsaWMgCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmV0dXJuIHdpdGhkcmF3QW1vdW50KGFkZHJlc3ModGhpcykuYmFsYW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdBbW91bnQodWludDI1NiBfYW1vdW50KSAKICAgIGF1dGhMZXZlbChMZXZlbC5BRE1JTikgCiAgICBncmVhdGVyVGhhblplcm8oYWRkcmVzcyh0aGlzKS5iYWxhbmNlKQogICAgZ3JlYXRlclRoYW5aZXJvKF9hbW91bnQpCiAgICB2YWxpZEJhbGFuY2VUaGlzKF9hbW91bnQpCiAgICBwdWJsaWMgCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgYWRkcmVzcyB3YWxsZXQgPSB3YWxsZXRXaXRoZHJhdzsKICAgICAgICBpZiAod2FsbGV0ID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgd2FsbGV0ID0gbXNnLnNlbmRlcjsKICAgICAgICB9CgogICAgICAgIFdpdGhkcmF3KG1zZy5zZW5kZXIsIHdhbGxldCwgX2Ftb3VudCk7CiAgICAgICAgd2FsbGV0LnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VUb2tlbihhZGRyZXNzIF90b2tlbikKICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICBub3RPd25lcihfdG9rZW4pCiAgICBub3RUaGlzKF90b2tlbikKICAgIHB1YmxpYyAKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkgCiAgICB7CiAgICAgICAgcmV0dXJuIElFUkMyMChfdG9rZW4pLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb3Vwb25Cb251cyhzdHJpbmcgX2NvZGUpCiAgICBpbnRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgdWludCBib251cyA9IDA7CiAgICAgICAgaWYgKGNvdXBvblRva2VuID09IGFkZHJlc3MoMCkgfHwgYnl0ZXMoX2NvZGUpLmxlbmd0aCAhPSA4KSB7CiAgICAgICAgICAgIHJldHVybiBib251czsKICAgICAgICB9CgogICAgICAgIGJvb2wgZGlzcG9zYWJsZTsKICAgICAgICBib29sIGNvbnN1bWVkOwogICAgICAgIGJvb2wgZW5hYmxlZDsKICAgICAgICAoYm9udXMsIGRpc3Bvc2FibGUsIGNvbnN1bWVkLCBlbmFibGVkKSA9IGNvdXBvblRva2VuLmdldENvdXBvbihfY29kZSk7CgogICAgICAgIGlmIChlbmFibGVkICYmICghZGlzcG9zYWJsZSB8fCAoZGlzcG9zYWJsZSAmJiAhY29uc3VtZWQpKSkgeyAKICAgICAgICAgICAgcmV0dXJuIGJvbnVzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB1cGRDb3Vwb25Cb251c0NvbnN1bWVkKHN0cmluZyBfY29kZSwgYm9vbCBfY29uc3VtZWQpCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAKICAgIHsKICAgICAgICBpZiAoY291cG9uVG9rZW4gPT0gYWRkcmVzcygwKSB8fCBieXRlcyhfY29kZSkubGVuZ3RoICE9IDgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY291cG9uVG9rZW4udXBkQ291cG9uQ29uc3VtZWQoX2NvZGUsIF9jb25zdW1lZCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHVyY2hhc2UoKQogICAgbm90VGhpcyhtc2cuc2VuZGVyKQogICAgZ3JlYXRlclRoYW5aZXJvKG1zZy52YWx1ZSkKICAgIGludGVybmFsCiAgICB7CiAgICAgICAgUGVyaW9kIHBlcmlvZCA9IG5vd1BlcmlvZCgpOwogICAgICAgIGlmIChjcm93ZFNhbGVGaW5hbGl6ZWQgfHwgIWNyb3dkU2FsZUVuYWJsZWQgfHwgcGVyaW9kID09IFBlcmlvZC5aRVJPIHx8IG1zZy52YWx1ZSA8PSBtaW5QdXJjaGFzZUxpbWl0KSB7CiAgICAgICAgICAgIGRvbmF0ZSgpOwogICAgICAgIH0gZWxzZSBpZiAoZGFwQ2FyVG9rZW4gPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBkb25hdGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBSYXRlIG1lbW9yeSByYXRlID0gcmF0ZXNbdWludDgocGVyaW9kKV07CiAgICAgICAgICAgIEludmVzdG9yIG1lbW9yeSBpbnZlc3RvciA9IGludmVzdG9yc1ttc2cuc2VuZGVyXTsKICAgICAgICAgICAgdWludDI1NiBib251cyA9IDA7CiAgICAgICAgICAgIGlmIChwZXJpb2QgPT0gUGVyaW9kLlBSRVNBTEUpIHsKICAgICAgICAgICAgICAgIGlmICghaW52ZXN0b3IucHJlU2FsZUVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICBkb25hdGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpbnZlc3Rvci5lbmFibGVkKSB7CiAgICAgICAgICAgICAgICBpZiAoaW52ZXN0b3IuYm9udXMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5hZGQoaW52ZXN0b3IuYm9udXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtc2cuZGF0YS5sZW5ndGggPT0gOCkgewogICAgICAgICAgICAgICAgdWludDI1NiBib251c0NvdXBvbiA9IGdldENvdXBvbkJvbnVzKHN0cmluZyhtc2cuZGF0YSkpOwogICAgICAgICAgICAgICAgaWYgKGJvbnVzQ291cG9uID4gMCAmJiB1cGRDb3Vwb25Cb251c0NvbnN1bWVkKHN0cmluZyhtc2cuZGF0YSksIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5hZGQoYm9udXNDb3Vwb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhaXJEcm9wVG9rZW5FbmFibGVkKSB7CiAgICAgICAgICAgICAgICBpZiAoYmFsYW5jZUFpckRyb3BUb2tlbihtc2cuc2VuZGVyKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBib251cyA9IGJvbnVzLmFkZChyYXRlLmJvbnVzQWlyRHJvcCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFpckRyb3BUb2tlbkRlc3Ryb3kgJiYgYWRkcmVzcyhhaXJEcm9wVG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBzZW5kZXJzID0gbmV3IGFkZHJlc3NbXSgxKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyc1swXSA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGFpckRyb3BUb2tlbi5idXJuQWlyRHJvcChzZW5kZXJzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFtb3VudEJvbnVzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgaWYgKG1zZy52YWx1ZSA+PSA1IGV0aGVyICYmIG1zZy52YWx1ZSA8IDEwIGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5hZGQoNSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1zZy52YWx1ZSA+PSAxMCBldGhlciAmJiBtc2cudmFsdWUgPCA1MCBldGhlcikgewogICAgICAgICAgICAgICAgICAgIGJvbnVzID0gYm9udXMuYWRkKDEwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnLnZhbHVlID49IDUwIGV0aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgYm9udXMgPSBib251cy5hZGQoMTUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50MjU2IHB1cmNoYXNlVG9rZW4gPSByYXRlLnJhdGUubXVsKDEgZXRoZXIpLm11bChtc2cudmFsdWUpLmRpdigxIGV0aGVyKS5kaXYoMSBldGhlcik7CiAgICAgICAgICAgIGlmIChib251cyA+IDApIHsKICAgICAgICAgICAgICAgIHB1cmNoYXNlVG9rZW4gPSBwdXJjaGFzZVRva2VuLmFkZChwdXJjaGFzZVRva2VuLm11bChib251cykuZGl2KDEwMCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAod2FsbGV0V2l0aGRyYXcgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgd2FsbGV0V2l0aGRyYXcudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGFwQ2FyVG9rZW4ubWludChtc2cuc2VuZGVyLCBwdXJjaGFzZVRva2VuKTsKICAgICAgICAgICAgUHVyY2hhc2UobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBwdXJjaGFzZVRva2VuLCBib251cyk7CgogICAgICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIHNvbGRUb2tlbiA9IHNvbGRUb2tlbi5hZGQocHVyY2hhc2VUb2tlbik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uICgpIAogICAgbm90VGhpcyhtc2cuc2VuZGVyKQogICAgZ3JlYXRlclRoYW5aZXJvKG1zZy52YWx1ZSkKICAgIGV4dGVybmFsIAogICAgcGF5YWJsZSAKICAgIHsKICAgICAgICBwdXJjaGFzZSgpOwoJfQoKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpCiAgICB2YWxpZEFkZHJlc3MoX3NwZW5kZXIpCiAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgZ3JlYXRlclRoYW5aZXJvKF92YWx1ZSkKICAgIHB1YmxpYyAKICAgIHsKICAgICAgICBJRVJDMjAgdG9rZW4gPSBJRVJDMjAoX3Rva2VuKTsKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyRnJvbShfc3BlbmRlciwgYWRkcmVzcyh0aGlzKSwgX3ZhbHVlKSk7CiAgICAgICAgUmVjZWl2ZVRva2Vucyhfc3BlbmRlciwgX3Rva2VuLCBfdmFsdWUsIF9leHRyYURhdGEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkKICAgIG9ubHlPd25lcgogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmV0dXJuIGZpbmFsaXphdGlvbigpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGlmIChhZGRyZXNzKHRoaXMpLmJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIGFkZHJlc3Mgd2FsbGV0ID0gd2FsbGV0V2l0aGRyYXc7CiAgICAgICAgICAgIGlmICh3YWxsZXQgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgd2FsbGV0ID0gb3duZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFdpdGhkcmF3KG1zZy5zZW5kZXIsIHdhbGxldCwgYWRkcmVzcyh0aGlzKS5iYWxhbmNlKTsKICAgICAgICAgICAgd2FsbGV0LnRyYW5zZmVyKGFkZHJlc3ModGhpcykuYmFsYW5jZSk7CiAgICAgICAgfQoKICAgICAgICAvLzQyJSBmb3IgVGVhbSwgQWR2aXNvciwgQm91bnR5LCBSZXNlcnZlIGFuZCBDaGFyaXR5IGZ1bmRzLgogICAgICAgIGZ1bmRUb2tlbiA9IHNvbGRUb2tlbi5tdWwoNDIpLmRpdigxMDApOwogICAgICAgIGRhcENhclRva2VuLm1pbnQod2FsbGV0V2l0aGRyYXcsIGZ1bmRUb2tlbik7CgogICAgICAgIEZpbmFsaXplZChtc2cuc2VuZGVyLCB1aW50NjQobm93KSwgd2VpUmFpc2VkLCBzb2xkVG9rZW4sIGZ1bmRUb2tlbiwgd2VpRG9uYXRlZCk7CiAgICAgICAgY3Jvd2RTYWxlRmluYWxpemVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBraWxsKCkgCiAgICBvbmx5T3duZXIgCiAgICBwdWJsaWMgCiAgICB7IAogICAgICAgIGlmIChjcm93ZFNhbGVGaW5hbGl6ZWQpIHsKICAgICAgICAgICAgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgICAgICB9CiAgICB9Cgp9'.
	

]
