Class {
	#name : #SRTfbbc46458c53154c0d1b45c801c28a99f95fa709,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTfbbc46458c53154c0d1b45c801c28a99f95fa709 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyBQcm9qZWN0OiBIaWdoIFJld2FyZCBDb2luCi8vIHY0LCAyMDE3LTEyLTMxCi8vIFRoaXMgY29kZSBpcyB0aGUgcHJvcGVydHkgb2YgQ3J5cHRvQjJCLmlvCi8vIENvcHlpbmcgaW4gd2hvbGUgb3IgaW4gcGFydCBpcyBwcm9oaWJpdGVkLgovLyBBdXRob3JzOiBJdmFuIEZlZG9yb3YgYW5kIERtaXRyeSBCb3JvZGluCi8vIERvIHlvdSB3YW50IHRoZSBzYW1lIElDTyBwbGF0Zm9ybT8gd3d3LmNyeXB0b2IyYi5pbwoKCi8vIChBMSkKLy8gVGhlIG1haW4gY29udHJhY3QgZm9yIHRoZSBzYWxlIGFuZCBtYW5hZ2VtZW50IG9mIHJvdW5kcy4KY29udHJhY3QgQ3Jvd2RzYWxlQkx7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBlbnVtIElDT1R5cGUge3JvdW5kMSwgcm91bmQyfQogICAgZW51bSBSb2xlcyB7YmVuZWZpY2lhcnksIGFjY291bnRhbnQsIG1hbmFnZXIsIG9ic2VydmVyLCBib3VudHksIHRlYW0sIGNvbXBhbnl9CgogICAgVG9rZW4gcHVibGljIHRva2VuOwoKICAgIGJvb2wgcHVibGljIGlzRmluYWxpemVkOwogICAgYm9vbCBwdWJsaWMgaXNJbml0aWFsaXplZDsKICAgIGJvb2wgcHVibGljIGlzUGF1c2VkQ3Jvd2RzYWxlOwoKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IGFkZHJlc3MpIHB1YmxpYyB3YWxsZXRzOwogICAKCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWUgPSAxNTE2NDM1MjAwOyAgICAvLyAyMC4wMS4yMDE4IDA4OjAwOjAwCiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lID0gMTUxOTE3MTE5OTsgICAgICAvLyAyMC4wMi4yMDE4IDIzOjU5OjU5CgogICAgLy8gSG93IG1hbnkgdG9rZW5zIChleGNsdWRpbmcgdGhlIGJvbnVzKSBhcmUgdHJhbnNmZXJyZWQgdG8gdGhlIGludmVzdG9yIGluIGV4Y2hhbmdlIGZvciAxIEVUSAogICAgLy8gKipUSE9VU0FORFMqKiAxMF4zIGZvciBodW1hbiwgMSoxMCoqMyBmb3IgU29saWRpdHksIDFlMyBmb3IgTXlFdGhlcldhbGxldCAoTUVXKS4KICAgIC8vIEV4YW1wbGU6IGlmIDFFVEggPSA0MC41IFRva2VuID09PiB1c2UgNDA1MDAKICAgIHVpbnQyNTYgcHVibGljIHJhdGUgPSA0MDAwMDA7IC8vIFRva2VucwoKICAgIC8vIElmIHRoZSByb3VuZCBkb2VzIG5vdCBhdHRhaW4gdGhpcyB2YWx1ZSBiZWZvcmUgdGhlIGNsb3NpbmcgZGF0ZSwgdGhlIHJvdW5kIGlzIHJlY29nbml6ZWQgYXMgYQogICAgLy8gZmFpbHVyZSBhbmQgaW52ZXN0b3JzIHRha2UgdGhlIG1vbmV5IGJhY2sgKHRoZSBmb3VuZGVycyB3aWxsIG5vdCBpbnRlcmZlcmUgaW4gYW55IHdheSkuCiAgICAvLyAqKlFVSU5USUxMSU9OUyoqIDEwXjE4IC8gMSoxMCoqMTggLyAxZTE4LiBFeGFtcGxlOiBzb2Z0Y2FwPTE1RVRIID09PiB1c2UgMTUqMTAqKjE4IChTb2xpZGl0eSkgb3IgMTVlMTggKE1FVykKICAgIHVpbnQyNTYgcHVibGljIHNvZnRDYXAgPSAxMjQwMDAwKjEwKioxODsgLy8gMSwyNE0gVG9rZW5zICh+ICQxIDAwMCAwMDApCgogICAgLy8gVGhlIG1heGltdW0gcG9zc2libGUgYW1vdW50IG9mIGluY29tZQogICAgLy8gKipRVUlOVElMTElPTlMqKiAxMF4xOCAvIDEqMTAqKjE4IC8gMWUxOC4gRXhhbXBsZTogaGFyZGNhcD0xMjMuNDVFVEggPT0+IHVzZSAxMjM0NTAqMTAqKjE1IChTb2xpZGl0eSkgb3IgMTIzNDVlMTUgKE1FVykKICAgIHVpbnQyNTYgcHVibGljIGhhcmRDYXAgPSA5MjQwMDAwKjEwKioxODsgLy8gOSwyNE0gVG9rZW5zICh+ICQxMiA3MDAgMDApCgogICAgLy8gSWYgdGhlIGxhc3QgcGF5bWVudCBpcyBzbGlnaHRseSBoaWdoZXIgdGhhbiB0aGUgaGFyZGNhcCwgdGhlbiB0aGUgdXN1YWwgY29udHJhY3RzIGRvCiAgICAvLyBub3QgYWNjZXB0IGl0LCBiZWNhdXNlIGl0IGdvZXMgYmV5b25kIHRoZSBoYXJkY2FwLiBIb3dldmVyIGl0IGlzIG1vcmUgcmVhc29uYWJsZSB0byBhY2NlcHQgdGhlCiAgICAvLyBsYXN0IHBheW1lbnQsIHZlcnkgc2xpZ2h0bHkgcmFpc2luZyB0aGUgaGFyZGNhcC4gVGhlIHZhbHVlIGluZGljYXRlcyBieSBob3cgbWFueSBUb2tlbiBlbWl0dGVkIHRoZQogICAgLy8gbGFzdCBwYXltZW50IGNhbiBleGNlZWQgdGhlIGhhcmRjYXAgdG8gYWxsb3cgaXQgdG8gYmUgcGFpZC4gSW1tZWRpYXRlbHkgYWZ0ZXIgdGhpcyBidXksIHRoZQogICAgLy8gcm91bmQgY2xvc2VzLiBUaGUgZnVuZGVycyBzaG91bGQgd3JpdGUgaGVyZSBhIHNtYWxsIG51bWJlciwgbm90IG1vcmUgdGhhbiAxJSBvZiB0aGUgQ0FQLgogICAgLy8gQ2FuIGJlIGVxdWFsIHRvIHplcm8sIHRvIGNhbmNlbC4KICAgIC8vICoqUVVJTlRJTExJT05TKiogMTBeMTggLyAxKjEwKioxOCAvIDFlMTgKICAgIHVpbnQyNTYgcHVibGljIG92ZXJMaW1pdCA9IDIwMDAwKjEwKioxODsgLy8gVG9rZW5zICh+JDIwMDAwKQoKICAgIC8vIFRoZSBtaW5pbXVtIHBvc3NpYmxlIHBheW1lbnQgZnJvbSBhbiBpbnZlc3RvciBpbiBFVEguIFBheW1lbnRzIGJlbG93IHRoaXMgdmFsdWUgd2lsbCBiZSByZWplY3RlZC4KICAgIC8vICoqUVVJTlRJTExJT05TKiogMTBeMTggLyAxKjEwKioxOCAvIDFlMTguIEV4YW1wbGU6IG1pblBheT0wLjFFVEggPT0+IHVzZSAxMDAqMTAqKjE1IChTb2xpZGl0eSkgb3IgMTAwZTE1IChNRVcpCiAgICB1aW50MjU2IHB1YmxpYyBtaW5QYXkgPSAzNioxMCoqMTU7IC8vIDAsMDM2IEVUSCAofiQyNSkKCiAgICB1aW50MjU2IHB1YmxpYyBldGhXZWlSYWlzZWQ7CiAgICB1aW50MjU2IHB1YmxpYyBub25FdGhXZWlSYWlzZWQ7CiAgICB1aW50MjU2IHdlaVJvdW5kMTsKICAgIHVpbnQyNTYgcHVibGljIHRva2VuUmVzZXJ2ZWQ7CgogICAgUmVmdW5kVmF1bHQgcHVibGljIHZhdWx0OwogICAgU1ZUQWxsb2NhdGlvbiBwdWJsaWMgbG9ja2VkQWxsb2NhdGlvbjsKICAgIAogICAgCiAgICBzdHJ1Y3QgQm9udXNCbG9jayB7dWludDI1NiBhbW91bnQ7IHVpbnQyNTYgcHJvY2VudDt9CiAgICBCb251c0Jsb2NrW10gcHVibGljIGJvbnVzUGF0dGVybjsKCiAgICBJQ09UeXBlIElDTyA9IElDT1R5cGUucm91bmQyOyAvLyBvbmx5IElDTyByb3VuZCAjMiAobm8gcHJlLUlDTykKCiAgICB1aW50MjU2IGFsbFRva2VuOwoKICAgIGJvb2wgcHVibGljIGJvdW50eTsKICAgIGJvb2wgcHVibGljIHRlYW07CiAgICBib29sIHB1YmxpYyBjb21wYW55OwogICAgYm9vbCBwdWJsaWMgcGFydG5lcnM7CgogICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCiAgICBldmVudCBGaW5hbGl6ZWQoKTsKICAgIGV2ZW50IEluaXRpYWxpemVkKCk7CgogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlQkwoVG9rZW4gX3Rva2VuLCB1aW50MjU2IGZpcnN0TWludCkgcHVibGljCiAgICB7CiAgICAgICAgLy8gSW5pdGlhbGx5LCBhbGwgbmV4dCA3IHJvbGVzL3dhbGxldHMgYXJlIGdpdmVuIHRvIHRoZSBNYW5hZ2VyLiBUaGUgTWFuYWdlciBpcyBhbiBlbXBsb3llZSBvZiB0aGUgY29tcGFueQogICAgICAgIC8vIHdpdGgga25vd2xlZGdlIG9mIElULCB3aG8gcHVibGlzaGVzIHRoZSBjb250cmFjdCBhbmQgc2V0cyBpdCB1cC4gSG93ZXZlciwgbW9uZXkgYW5kIHRva2VucyByZXF1aXJlCiAgICAgICAgLy8gYSBCZW5lZmljaWFyeSBhbmQgb3RoZXIgcm9sZXMgKEFjY291bnRhbnQsIFRlYW0sIGV0Yy4pLiBUaGUgTWFuYWdlciB3aWxsIG5vdCBoYXZlIHRoZSByaWdodAogICAgICAgIC8vIHRvIHJlY2VpdmUgdGhlbS4gVG8gZW5hYmxlIHRoaXMsIHRoZSBNYW5hZ2VyIG11c3QgZWl0aGVyIGVudGVyIHNwZWNpZmljIHdhbGxldHMgaGVyZSwgb3IgcGVyZm9ybQogICAgICAgIC8vIHRoaXMgdmlhIG1ldGhvZCBjaGFuZ2VXYWxsZXQuIEluIHRoZSBmaW5hbGl6YXRpb24gbWV0aG9kcyBpdCBpcyB3cml0dGVuIHdoaWNoIHdhbGxldCBhbmQKICAgICAgICAvLyB3aGF0IHBlcmNlbnRhZ2Ugb2YgdG9rZW5zIGFyZSByZWNlaXZlZC4KCiAgICAgICAgLy8gUmVjZWl2ZXMgYWxsIHRoZSBtb25leSAod2hlbiBmaW5hbGl6aW5nIHByZS1JQ08gJiBJQ08pCiAgICAgICAgd2FsbGV0c1t1aW50OChSb2xlcy5iZW5lZmljaWFyeSldID0gMHhlMDZiRDcxM0IyZTMzQzIxOEZERDU2Mjk1QWY3NGQ0NWNFOGM5RDk4OyAvL21zZy5zZW5kZXI7CgogICAgICAgIC8vIFJlY2VpdmVzIGFsbCB0aGUgdG9rZW5zIGZvciBub24tRVRIIGludmVzdG9ycyAod2hlbiBmaW5hbGl6aW5nIHByZS1JQ08gJiBJQ08pCiAgICAgICAgd2FsbGV0c1t1aW50OChSb2xlcy5hY2NvdW50YW50KV0gPSAweGRkQzk4ZDdkOUNkRDgyMTcyZGFENzQ2N2M4RTM0MWNmQkViMDc3REQ7IC8vbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gQWxsIHJpZ2h0cyBleGNlcHQgdGhlIHJpZ2h0cyB0byByZWNlaXZlIHRva2VucyBvciBtb25leS4gSGFzIHRoZSByaWdodCB0byBjaGFuZ2UgYW55IG90aGVyCiAgICAgICAgLy8gd2FsbGV0cyAoQmVuZWZpY2lhcnksIEFjY291bnRhbnQsIC4uLiksIGJ1dCBvbmx5IGlmIHRoZSByb3VuZCBoYXMgbm90IHN0YXJ0ZWQuIE9uY2UgdGhlCiAgICAgICAgLy8gcm91bmQgaXMgaW5pdGlhbGl6ZWQsIHRoZSBNYW5hZ2VyIGhhcyBsb3N0IGFsbCByaWdodHMgdG8gY2hhbmdlIHRoZSB3YWxsZXRzLgogICAgICAgIC8vIElmIHRoZSBJQ08gaXMgY29uZHVjdGVkIGJ5IG9uZSBwZXJzb24sIHRoZW4gbm90aGluZyBuZWVkcyB0byBiZSBjaGFuZ2VkLiBQZXJtaXQgYWxsIDcgcm9sZXMKICAgICAgICAvLyBwb2ludCB0byBhIHNpbmdsZSB3YWxsZXQuCiAgICAgICAgd2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyBIYXMgb25seSB0aGUgcmlnaHQgdG8gY2FsbCBwYXltZW50c0luT3RoZXJDdXJyZW5jeSAocGxlYXNlIHJlYWQgdGhlIGRvY3VtZW50KQogICAgICAgIHdhbGxldHNbdWludDgoUm9sZXMub2JzZXJ2ZXIpXSA9IDB4NzZkNzM3RjIxMjk2Y2QxRUQ2OTM4RGJDQTIxNzYxNTY4MWIwNjMzNjsgLy9tc2cuc2VuZGVyOwoKCiAgICAgICAgd2FsbGV0c1t1aW50OChSb2xlcy5ib3VudHkpXSA9IDB4NDkxOGZjNzk3NGQ3RWU2RjI2NmY5MjU2RGZjQTYxMEZENzM1QmYyNzsgLy9tc2cuc2VuZGVyOwoKICAgICAgICAvLyBXaGVuIHRoZSByb3VuZCBpcyBmaW5hbGl6ZWQsIGFsbCB0ZWFtIHRva2VucyBhcmUgdHJhbnNmZXJyZWQgdG8gYSBzcGVjaWFsIGZyZWV6aW5nCiAgICAgICAgLy8gY29udHJhY3QuIEFzIHNvb24gYXMgZGVmcm9zdGluZyBpcyBvdmVyLCBvbmx5IHRoZSBUZWFtIHdhbGxldCB3aWxsIGJlIGFibGUgdG8KICAgICAgICAvLyBjb2xsZWN0IGFsbCB0aGUgdG9rZW5zLiBJdCBkb2VzIG5vdCBzdG9yZSB0aGUgYWRkcmVzcyBvZiB0aGUgZnJlZXppbmcgY29udHJhY3QsCiAgICAgICAgLy8gYnV0IHRoZSBmaW5hbCB3YWxsZXQgb2YgdGhlIHByb2plY3QgdGVhbS4KICAgICAgICB3YWxsZXRzW3VpbnQ4KFJvbGVzLnRlYW0pXSA9IDB4YzU5NDAzMDI2Njg1RjU1M2Y4YTY5MzdDNTM0NTJiOWQxREU0YzcwNzsgLy8gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gc3RhcnRUaW1lLCBlbmREaXNjb3VudFRpbWUsIGVuZFRpbWUgKHRoZW4geW91IGNhbiBjaGFuZ2UgaXQgaW4gdGhlIHNldHVwKQogICAgICAgIC8vY2hhbmdlUGVyaW9kKG5vdyArIDUgbWludXRlcywgbm93ICsgNSArIDEwIG1pbnV0ZXMsIG5vdyArIDUgKyAxMiBtaW51dGVzKTsKCiAgICAgICAgd2FsbGV0c1t1aW50OChSb2xlcy5jb21wYW55KV0gPSAweGM1OTQwMzAyNjY4NUY1NTNmOGE2OTM3QzUzNDUyYjlkMURFNGM3MDc7IC8vbXNnLnNlbmRlcjsKICAgICAgICAKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgICAgICB0b2tlbi5zZXRPd25lcigpOwoKICAgICAgICB0b2tlbi5wYXVzZSgpOyAvLyBibG9jayBleGNoYW5nZSB0b2tlbnMKCiAgICAgICAgdG9rZW4uYWRkVW5wYXVzZWRXYWxsZXQobXNnLnNlbmRlcik7CiAgICAgICAgdG9rZW4uYWRkVW5wYXVzZWRXYWxsZXQod2FsbGV0c1t1aW50OChSb2xlcy5jb21wYW55KV0pOwogICAgICAgIHRva2VuLmFkZFVucGF1c2VkV2FsbGV0KHdhbGxldHNbdWludDgoUm9sZXMuYm91bnR5KV0pOwogICAgICAgIHRva2VuLmFkZFVucGF1c2VkV2FsbGV0KHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldKTsKCiAgICAgICAgaWYgKGZpcnN0TWludCA+IDApewogICAgICAgICAgICB0b2tlbi5taW50KG1zZy5zZW5kZXIsZmlyc3RNaW50KTsKICAgICAgICB9CgogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG5hbWUgb2YgdGhlIGN1cnJlbnQgcm91bmQgaW4gcGxhaW4gdGV4dC4gQ29uc3RhbnQuCiAgICBmdW5jdGlvbiBJQ09TYWxlVHlwZSgpICBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpewogICAgICAgIHJldHVybiAoSUNPID09IElDT1R5cGUucm91bmQxKT8ncm91bmQxJzoncm91bmQyJzsKICAgIH0KCiAgICAvLyBUcmFuc2ZlcnMgdGhlIGZ1bmRzIG9mIHRoZSBpbnZlc3RvciB0byB0aGUgY29udHJhY3Qgb2YgcmV0dXJuIG9mIGZ1bmRzLiBJbnRlcm5hbC4KICAgIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgICAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gQ2hlY2sgZm9yIHRoZSBwb3NzaWJpbGl0eSBvZiBidXlpbmcgdG9rZW5zLiBJbnNpZGUuIENvbnN0YW50LgogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgLy8gVGhlIHJvdW5kIHN0YXJ0ZWQgYW5kIGRpZCBub3QgZW5kCiAgICAgICAgYm9vbCB3aXRoaW5QZXJpb2QgPSAobm93ID4gc3RhcnRUaW1lICYmIG5vdyA8IGVuZFRpbWUpOwoKICAgICAgICAvLyBSYXRlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgbWluaW11bQogICAgICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlID49IG1pblBheTsKCiAgICAgICAgLy8gcm91bmQgaXMgaW5pdGlhbGl6ZWQgYW5kIG5vICJQYXVzZSBvZiB0cmFkaW5nIiBpcyBzZXQKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZSAmJiBpc0luaXRpYWxpemVkICYmICFpc1BhdXNlZENyb3dkc2FsZTsKICAgIH0KCiAgICAvLyBDaGVjayBmb3IgdGhlIGFiaWxpdHkgdG8gZmluYWxpemUgdGhlIHJvdW5kLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgYm9vbCB0aW1lUmVhY2hlZCA9IG5vdyA+IGVuZFRpbWU7CgogICAgICAgIGJvb2wgY2FwUmVhY2hlZCA9IHRva2VuLnRvdGFsU3VwcGx5KCkuYWRkKHRva2VuUmVzZXJ2ZWQpID49IGhhcmRDYXA7CgogICAgICAgIHJldHVybiAodGltZVJlYWNoZWQgfHwgY2FwUmVhY2hlZCkgJiYgaXNJbml0aWFsaXplZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZmluYWxpemVBbGwoKSBleHRlcm5hbCB7CiAgICAgICAgZmluYWxpemUoKTsKICAgICAgICBmaW5hbGl6ZTEoKTsKICAgICAgICBmaW5hbGl6ZTIoKTsKICAgICAgICBmaW5hbGl6ZTMoKTsKICAgICAgICBmaW5hbGl6ZTQoKTsKICAgIH0KCiAgICAvLyBGaW5hbGl6ZS4gT25seSBhdmFpbGFibGUgdG8gdGhlIE1hbmFnZXIgYW5kIHRoZSBCZW5lZmljaWFyeS4gSWYgdGhlIHJvdW5kIGZhaWxlZCwgdGhlbgogICAgLy8gYW55b25lIGNhbiBjYWxsIHRoZSBmaW5hbGl6YXRpb24gdG8gdW5sb2NrIHRoZSByZXR1cm4gb2YgZnVuZHMgdG8gaW52ZXN0b3JzCiAgICAvLyBZb3UgbXVzdCBjYWxsIGEgZnVuY3Rpb24gdG8gZmluYWxpemUgZWFjaCByb3VuZCAoYWZ0ZXIgdGhlIHByZS1JQ08gJiBhZnRlciB0aGUgSUNPKQogICAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgewoKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIgfHwgd2FsbGV0c1t1aW50OChSb2xlcy5iZW5lZmljaWFyeSldID09IG1zZy5zZW5kZXJ8fCAhZ29hbFJlYWNoZWQoKSk7CiAgICAgICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CgogICAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICAgICAgICBmaW5hbGl6YXRpb24oKTsKICAgICAgICBGaW5hbGl6ZWQoKTsKICAgIH0KCiAgICAvLyBUaGUgbG9naWMgb2YgZmluYWxpemF0aW9uLiBJbnRlcm5hbAogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewoKICAgICAgICAvLyBJZiB0aGUgZ29hbCBvZiB0aGUgYWNoaWV2ZW1lbnQKICAgICAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewoKICAgICAgICAgICAgLy8gU2VuZCBldGhlciB0byBCZW5lZmljaWFyeQogICAgICAgICAgICB2YXVsdC5jbG9zZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLmJlbmVmaWNpYXJ5KV0pOwoKICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW55dGhpbmcgdG8gZ2l2ZQogICAgICAgICAgICBpZiAodG9rZW5SZXNlcnZlZCA+IDApIHsKCiAgICAgICAgICAgICAgICAvLyBJc3N1ZSB0b2tlbnMgb2Ygbm9uLWV0aCBpbnZlc3RvcnMgdG8gQWNjb3VudGFudCBhY2NvdW50CiAgICAgICAgICAgICAgICB0b2tlbi5taW50KHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldLHRva2VuUmVzZXJ2ZWQpOwoKICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBjb3VudGVyCiAgICAgICAgICAgICAgICB0b2tlblJlc2VydmVkID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIGZpbmFsaXphdGlvbiBpcyBSb3VuZCAxIHByZS1JQ08KICAgICAgICAgICAgaWYgKElDTyA9PSBJQ09UeXBlLnJvdW5kMSkgewoKICAgICAgICAgICAgICAgIC8vIFJlc2V0IHNldHRpbmdzCiAgICAgICAgICAgICAgICBpc0luaXRpYWxpemVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpc0ZpbmFsaXplZCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIFN3aXRjaCB0byB0aGUgc2Vjb25kIHJvdW5kICh0byBJQ08pCiAgICAgICAgICAgICAgICBJQ08gPSBJQ09UeXBlLnJvdW5kMjsKCiAgICAgICAgICAgICAgICAvLyBSZXNldCB0aGUgY29sbGVjdGlvbiBjb3VudGVyCiAgICAgICAgICAgICAgICB3ZWlSb3VuZDEgPSB3ZWlSYWlzZWQoKTsKICAgICAgICAgICAgICAgIGV0aFdlaVJhaXNlZCA9IDA7CiAgICAgICAgICAgICAgICBub25FdGhXZWlSYWlzZWQgPSAwOwoKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIC8vIElmIHRoZSBzZWNvbmQgcm91bmQgaXMgZmluYWxpemVkCiAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgaXNzdWVkCiAgICAgICAgICAgICAgICBhbGxUb2tlbiA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CgogICAgICAgICAgICAgICAgLy8gUGVybWlzc2lvbiB0byBjb2xsZWN0IHRva2VucyB0byB0aG9zZSB3aG8gY2FuIHBpY2sgdGhlbSB1cAogICAgICAgICAgICAgICAgYm91bnR5ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRlYW0gPSB0cnVlOwogICAgICAgICAgICAgICAgY29tcGFueSA9IHRydWU7CiAgICAgICAgICAgICAgICBwYXJ0bmVycyA9IHRydWU7CgogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICBlbHNlIC8vIElmIHRoZXkgZmFpbGVkIHJvdW5kCiAgICAgICAgewogICAgICAgICAgICAvLyBBbGxvdyBpbnZlc3RvcnMgdG8gd2l0aGRyYXcgdGhlaXIgZnVuZHMKICAgICAgICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUaGUgTWFuYWdlciBmcmVlemVzIHRoZSB0b2tlbnMgZm9yIHRoZSBUZWFtLgogICAgLy8gWW91IG11c3QgY2FsbCBhIGZ1bmN0aW9uIHRvIGZpbmFsaXplIFJvdW5kIDIgKG9ubHkgYWZ0ZXIgdGhlIElDTykKICAgIGZ1bmN0aW9uIGZpbmFsaXplMSgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9PSBtc2cuc2VuZGVyIHx8IHdhbGxldHNbdWludDgoUm9sZXMuYmVuZWZpY2lhcnkpXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHRlYW0pOwogICAgICAgIHRlYW0gPSBmYWxzZTsKICAgICAgICBsb2NrZWRBbGxvY2F0aW9uID0gbmV3IFNWVEFsbG9jYXRpb24odG9rZW4sIHdhbGxldHNbdWludDgoUm9sZXMudGVhbSldKTsKICAgICAgICB0b2tlbi5hZGRVbnBhdXNlZFdhbGxldChsb2NrZWRBbGxvY2F0aW9uKTsKICAgICAgICAvLyA2JSAtIHRva2VucyB0byBUZWFtIHdhbGxldCBhZnRlciBmcmVlemUgKDc3JSBmb3IgaW52ZXN0b3JzKQogICAgICAgIC8vICoqKiBDSEVDSyBUSEVTRSBOVU1CRVJTICoqKgogICAgICAgIHRva2VuLm1pbnQobG9ja2VkQWxsb2NhdGlvbiwgYWxsVG9rZW4ubXVsKDYpLmRpdig3NykpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXplMigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9PSBtc2cuc2VuZGVyIHx8IHdhbGxldHNbdWludDgoUm9sZXMuYmVuZWZpY2lhcnkpXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKGJvdW50eSk7CiAgICAgICAgYm91bnR5ID0gZmFsc2U7CiAgICAgICAgLy8gMiUgLSB0b2tlbnMgdG8gYm91bnR5IHdhbGxldCAoNzclIGZvciBpbnZlc3RvcnMpCiAgICAgICAgLy8gKioqIENIRUNLIFRIRVNFIE5VTUJFUlMgKioqCiAgICAgICAgdG9rZW4ubWludCh3YWxsZXRzW3VpbnQ4KFJvbGVzLmJvdW50eSldLCBhbGxUb2tlbi5tdWwoMikuZGl2KDc3KSk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluYWxpemUzKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIgfHwgd2FsbGV0c1t1aW50OChSb2xlcy5iZW5lZmljaWFyeSldID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoY29tcGFueSk7CiAgICAgICAgY29tcGFueSA9IGZhbHNlOwogICAgICAgIC8vIDIlIC0gdG9rZW5zIHRvIGNvbXBhbnkgd2FsbGV0ICg3NyUgZm9yIGludmVzdG9ycykKICAgICAgICAvLyAqKiogQ0hFQ0sgVEhFU0UgTlVNQkVSUyAqKioKICAgICAgICB0b2tlbi5taW50KHdhbGxldHNbdWludDgoUm9sZXMuY29tcGFueSldLGFsbFRva2VuLm11bCgyKS5kaXYoNzcpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5hbGl6ZTQoKSAgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIgfHwgd2FsbGV0c1t1aW50OChSb2xlcy5iZW5lZmljaWFyeSldID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUocGFydG5lcnMpOwogICAgICAgIHBhcnRuZXJzID0gZmFsc2U7CiAgICAgICAgLy8gMTMlIC0gdG9rZW5zIHRvIHBhcnRuZXJzK3JlZmVycmFsIHdhbGxldCAoNzclIGZvciBpbnZlc3RvcnMpCiAgICAgICAgLy8gKioqIENIRUNLIFRIRVNFIE5VTUJFUlMgKioqCiAgICAgICAgdG9rZW4ubWludCh3YWxsZXRzW3VpbnQ4KFJvbGVzLmFjY291bnRhbnQpXSxhbGxUb2tlbi5tdWwoMTMpLmRpdig3NykpOwogICAgfQoKCiAgICAvLyBJbml0aWFsaXppbmcgdGhlIHJvdW5kLiBBdmFpbGFibGUgdG8gdGhlIG1hbmFnZXIuIEFmdGVyIGNhbGxpbmcgdGhlIGZ1bmN0aW9uLAogICAgLy8gdGhlIE1hbmFnZXIgbG9zZXMgYWxsIHJpZ2h0czogTWFuYWdlciBjYW4gbm90IGNoYW5nZSB0aGUgc2V0dGluZ3MgKHNldHVwKSwgY2hhbmdlCiAgICAvLyB3YWxsZXRzLCBwcmV2ZW50IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJvdW5kLCBldGMuIFlvdSBtdXN0IGNhbGwgYSBmdW5jdGlvbiBhZnRlciBzZXR1cAogICAgLy8gZm9yIHRoZSBpbml0aWFsIHJvdW5kIChiZWZvcmUgdGhlIFByZS1JQ08gYW5kIGJlZm9yZSB0aGUgSUNPKQogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHB1YmxpY3sKCiAgICAgICAgLy8gT25seSB0aGUgTWFuYWdlcgogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIElmIG5vdCB5ZXQgaW5pdGlhbGl6ZWQKICAgICAgICByZXF1aXJlKCFpc0luaXRpYWxpemVkKTsKCiAgICAgICAgLy8gQW5kIHRoZSBzcGVjaWZpZWQgc3RhcnQgdGltZSBoYXMgbm90IHlldCBjb21lCiAgICAgICAgLy8gSWYgaW5pdGlhbGl6YXRpb24gcmV0dXJuIGFuIGVycm9yLCBjaGVjayB0aGUgc3RhcnQgZGF0ZSEKICAgICAgICByZXF1aXJlKG5vdyA8PSBzdGFydFRpbWUpOwoKICAgICAgICBpbml0aWFsaXphdGlvbigpOwoKICAgICAgICBJbml0aWFsaXplZCgpOwoKICAgICAgICBpc0luaXRpYWxpemVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0aWFsaXphdGlvbigpIGludGVybmFsIHsKCSAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdCgpOwogICAgfQoKICAgIC8vIEF0IHRoZSByZXF1ZXN0IG9mIHRoZSBpbnZlc3Rvciwgd2UgcmFpc2UgdGhlIGZ1bmRzIChpZiB0aGUgcm91bmQgaGFzIGZhaWxlZCBiZWNhdXNlIG9mIHRoZSBoYXJkY2FwKQogICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWN7CiAgICAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIFdlIGNoZWNrIHdoZXRoZXIgd2UgY29sbGVjdGVkIHRoZSBuZWNlc3NhcnkgbWluaW11bSBmdW5kcy4gQ29uc3RhbnQuCiAgICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRva2VuLnRvdGFsU3VwcGx5KCkuYWRkKHRva2VuUmVzZXJ2ZWQpID49IHNvZnRDYXA7CiAgICB9CgogICAgLy8gQ3VzdG9taXplLiBUaGUgYXJndW1lbnRzIGFyZSBkZXNjcmliZWQgaW4gdGhlIGNvbnN0cnVjdG9yIGFib3ZlLgogICAgZnVuY3Rpb24gc2V0dXAodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lLCB1aW50MjU2IF9zb2Z0Q2FwLCB1aW50MjU2IF9oYXJkQ2FwLCB1aW50MjU2IF9yYXRlLCB1aW50MjU2IF9vdmVyTGltaXQsIHVpbnQyNTYgX21pblBheSwgdWludDI1NltdIF9hbW91bnQsIHVpbnQyNTZbXSBfcHJvY2VudCkgcHVibGljewogICAgICAgICAgICBjaGFuZ2VQZXJpb2QoX3N0YXJ0VGltZSwgX2VuZFRpbWUpOwogICAgICAgICAgICBjaGFuZ2VSYXRlKF9yYXRlLCBfbWluUGF5KTsKICAgICAgICAgICAgY2hhbmdlQ2FwKF9zb2Z0Q2FwLCBfaGFyZENhcCwgX292ZXJMaW1pdCk7CiAgICAgICAgICAgIGlmKF9hbW91bnQubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHNldEJvbnVzUGF0dGVybihfYW1vdW50LF9wcm9jZW50KTsKICAgIH0KCgkvLyBDaGFuZ2UgdGhlIGRhdGUgYW5kIHRpbWU6IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJvdW5kLCB0aGUgZW5kIG9mIHRoZSBib251cywgdGhlIGVuZCBvZiB0aGUgcm91bmQuIEF2YWlsYWJsZSB0byBNYW5hZ2VyCiAgICAvLyBEZXNjcmlwdGlvbiBpbiB0aGUgQ3Jvd2RzYWxlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBjaGFuZ2VQZXJpb2QodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lKSBwdWJsaWN7CgogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CgogICAgICAgIHJlcXVpcmUoIWlzSW5pdGlhbGl6ZWQpOwoKICAgICAgICAvLyBEYXRlIGFuZCB0aW1lIGFyZSBjb3JyZWN0CiAgICAgICAgcmVxdWlyZShub3cgPD0gX3N0YXJ0VGltZSk7CiAgICAgICAgcmVxdWlyZShfc3RhcnRUaW1lIDwgX2VuZFRpbWUpOwoKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIH0KICAgIAoKICAgIC8vIENoYW5nZSB0aGUgcHJpY2UgKHRoZSBudW1iZXIgb2YgdG9rZW5zIHBlciAxIGV0aCksIHRoZSBtYXhpbXVtIGhhcmRDYXAgZm9yIHRoZSBsYXN0IGJldCwKICAgIC8vIHRoZSBtaW5pbXVtIGJldC4gQXZhaWxhYmxlIHRvIHRoZSBNYW5hZ2VyLgogICAgLy8gRGVzY3JpcHRpb24gaW4gdGhlIENyb3dkc2FsZSBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gY2hhbmdlUmF0ZSh1aW50MjU2IF9yYXRlLCB1aW50MjU2IF9taW5QYXkpIHB1YmxpYyB7CgogICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIgfHwgd2FsbGV0c1t1aW50OChSb2xlcy5vYnNlcnZlcildID09IG1zZy5zZW5kZXIpOwoKICAgICAgICAgcmVxdWlyZShfcmF0ZSA+IDApOwoKICAgICAgICAgcmF0ZSA9IF9yYXRlOwogICAgICAgICBtaW5QYXkgPSBfbWluUGF5OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjaGFuZ2VDYXAodWludDI1NiBfc29mdENhcCwgdWludDI1NiBfaGFyZENhcCwgdWludDI1NiBfb3ZlckxpbWl0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSghaXNJbml0aWFsaXplZCk7CiAgICAgICAgcmVxdWlyZShfaGFyZENhcCA+IF9zb2Z0Q2FwKTsKICAgICAgICBzb2Z0Q2FwID0gX3NvZnRDYXA7CiAgICAgICAgaGFyZENhcCA9IF9oYXJkQ2FwOwogICAgICAgIG92ZXJMaW1pdCA9IF9vdmVyTGltaXQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldEJvbnVzUGF0dGVybih1aW50MjU2W10gX2Ftb3VudCwgdWludDI1NltdIF9wcm9jZW50KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSghaXNJbml0aWFsaXplZCk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50Lmxlbmd0aCA9PSBfcHJvY2VudC5sZW5ndGgpOwogICAgICAgIGJvbnVzUGF0dGVybi5sZW5ndGggPSBfYW1vdW50Lmxlbmd0aDsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9hbW91bnQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBib251c1BhdHRlcm5baV0gPSBCb251c0Jsb2NrKF9hbW91bnRbaV0sX3Byb2NlbnRbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDb2xsZWN0ZWQgZnVuZHMgZm9yIHRoZSBjdXJyZW50IHJvdW5kLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIHdlaVJhaXNlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiBldGhXZWlSYWlzZWQuYWRkKG5vbkV0aFdlaVJhaXNlZCk7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgYW1vdW50IG9mIGZlZXMgZm9yIGJvdGggcGhhc2VzLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIHdlaVRvdGFsUmFpc2VkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIHdlaVJvdW5kMS5hZGQod2VpUmFpc2VkKCkpOwogICAgfQoKCiAgICAvLyBUaGUgYWJpbGl0eSB0byBxdWlja2x5IGNoZWNrIHByZS1JQ08gKG9ubHkgZm9yIFJvdW5kIDEsIG9ubHkgMSB0aW1lKS4gQ29tcGxldGVzIHRoZSBwcmUtSUNPIGJ5CiAgICAvLyB0cmFuc2ZlcnJpbmcgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgdG9rZW5zIHRvIHRoZSBBY2NvdW50YW50J3Mgd2FsbGV0LiBBdmFpbGFibGUgdG8gdGhlIE1hbmFnZXIuCiAgICAvLyBVc2Ugb25seSBpZiB0aGlzIGlzIHByb3ZpZGVkIGJ5IHRoZSBzY3JpcHQgYW5kIHdoaXRlIHBhcGVyLiBJbiB0aGUgbm9ybWFsIHNjZW5hcmlvLCBpdAogICAgLy8gZG9lcyBub3QgY2FsbCBhbmQgdGhlIGZ1bmRzIGFyZSByYWlzZWQgbm9ybWFsbHkuIFdlIHJlY29tbWVuZCB0aGF0IHlvdSBkZWxldGUgdGhpcwogICAgLy8gZnVuY3Rpb24gZW50aXJlbHksIHNvIGFzIG5vdCB0byBjb25mdXNlIHRoZSBhdWRpdG9ycy4gSW5pdGlhbGl6ZSAmIEZpbmFsaXplIG5vdCBuZWVkZWQuCiAgICAvLyAqKiBRVUlOVElMSU9OUyAqKiAgMTBeMTggLyAxKjEwKioxOCAvIDFlMTgKLy8gICAgZnVuY3Rpb24gZmFzdElDTyh1aW50MjU2IF90b3RhbFN1cHBseSkgcHVibGljIHsKLy8gICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIpOwovLyAgICAgIHJlcXVpcmUoSUNPID09IElDT1R5cGUucm91bmQxICYmICFpc0luaXRpYWxpemVkKTsKLy8gICAgICB0b2tlbi5taW50KHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldLCBfdG90YWxTdXBwbHkpOwovLyAgICAgIElDTyA9IElDT1R5cGUucm91bmQyOwovLyAgICB9CgogICAgLy8gUmVtb3ZlIHRoZSAiUGF1c2Ugb2YgZXhjaGFuZ2UiLiBBdmFpbGFibGUgdG8gdGhlIG1hbmFnZXIgYXQgYW55IHRpbWUuIElmIHRoZQogICAgLy8gbWFuYWdlciByZWZ1c2VzIHRvIHJlbW92ZSB0aGUgcGF1c2UsIHRoZW4gMzAgZGF5cyBhZnRlciB0aGUgc3VjY2Vzc2Z1bAogICAgLy8gY29tcGxldGlvbiBvZiB0aGUgSUNPLCBhbnlvbmUgY2FuIHJlbW92ZSBhIHBhdXNlIGFuZCBhbGxvdyB0aGUgZXhjaGFuZ2UgdG8gY29udGludWUuCiAgICAvLyBUaGUgbWFuYWdlciBkb2VzIG5vdCBpbnRlcmZlcmUgYW5kIHdpbGwgbm90IGJlIGFibGUgdG8gZGVsYXkgdGhlIHRlcm0uCiAgICAvLyBIZSBjYW4gb25seSBjYW5jZWwgdGhlIHBhdXNlIGJlZm9yZSB0aGUgYXBwb2ludGVkIHRpbWUuCiAgICBmdW5jdGlvbiB0b2tlblVucGF1c2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcgogICAgICAgIAl8fCAobm93ID4gZW5kVGltZSArIDMwIGRheXMgJiYgSUNPID09IElDT1R5cGUucm91bmQyICYmIGlzRmluYWxpemVkICYmIGdvYWxSZWFjaGVkKCkpKTsKICAgICAgICB0b2tlbi51bnBhdXNlKCk7CiAgICB9CgogICAgLy8gRW5hYmxlIHRoZSAiUGF1c2Ugb2YgZXhjaGFuZ2UiLiBBdmFpbGFibGUgdG8gdGhlIG1hbmFnZXIgdW50aWwgdGhlIElDTyBpcyBjb21wbGV0ZWQuCiAgICAvLyBUaGUgbWFuYWdlciBjYW5ub3QgdHVybiBvbiB0aGUgcGF1c2UsIGZvciBleGFtcGxlLCAzIHllYXJzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIElDTy4KICAgIGZ1bmN0aW9uIHRva2VuUGF1c2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlciAmJiAhaXNGaW5hbGl6ZWQpOwogICAgICAgIHRva2VuLnBhdXNlKCk7CiAgICB9CgogICAgLy8gUGF1c2Ugb2Ygc2FsZS4gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyLgogICAgZnVuY3Rpb24gY3Jvd2RzYWxlUGF1c2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShpc1BhdXNlZENyb3dkc2FsZSA9PSBmYWxzZSk7CiAgICAgICAgaXNQYXVzZWRDcm93ZHNhbGUgPSB0cnVlOwogICAgfQoKICAgIC8vIFdpdGhkcmF3YWwgZnJvbSB0aGUgcGF1c2Ugb2Ygc2FsZS4gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyLgogICAgZnVuY3Rpb24gY3Jvd2RzYWxlVW5wYXVzZSgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKGlzUGF1c2VkQ3Jvd2RzYWxlID09IHRydWUpOwogICAgICAgIGlzUGF1c2VkQ3Jvd2RzYWxlID0gZmFsc2U7CiAgICB9CgogICAgLy8gQ2hlY2tpbmcgd2hldGhlciB0aGUgcmlnaHRzIHRvIGFkZHJlc3MgaWdub3JlIHRoZSAiUGF1c2Ugb2YgZXhjaGFuZ2UiLiBJZiB0aGUKICAgIC8vIHdhbGxldCBpcyBpbmNsdWRlZCBpbiB0aGlzIGxpc3QsIGl0IGNhbiB0cmFuc2xhdGUgdG9rZW5zLCBpZ25vcmluZyB0aGUgcGF1c2UuIEJ5IGRlZmF1bHQsCiAgICAvLyBvbmx5IHRoZSBmb2xsb3dpbmcgd2FsbGV0cyBhcmUgaW5jbHVkZWQ6CiAgICAvLyAgICAtIEFjY291bnRhbnQgd2FsbGV0IChoZSBzaG91bGQgaW1tZWRpYXRlbHkgdHJhbnNmZXIgdG9rZW5zLCBidXQgbm90IHRvIG5vbi1FVEggaW52ZXN0b3JzKQogICAgLy8gICAgLSBDb250cmFjdCBmb3IgZnJlZXppbmcgdGhlIHRva2VucyBmb3IgdGhlIFRlYW0gKGJ1dCBUZWFtIHdhbGxldCBub3QgaW5jbHVkZWQpCiAgICAvLyBJbnNpZGUuIENvbnN0YW50LgogICAgZnVuY3Rpb24gdW5wYXVzZWRXYWxsZXQoYWRkcmVzcyBfd2FsbGV0KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICBib29sIF9hY2NvdW50YW50ID0gd2FsbGV0c1t1aW50OChSb2xlcy5hY2NvdW50YW50KV0gPT0gX3dhbGxldDsKICAgICAgICBib29sIF9tYW5hZ2VyID0gd2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gX3dhbGxldDsKICAgICAgICBib29sIF9ib3VudHkgPSB3YWxsZXRzW3VpbnQ4KFJvbGVzLmJvdW50eSldID09IF93YWxsZXQ7CiAgICAgICAgYm9vbCBfY29tcGFueSA9IHdhbGxldHNbdWludDgoUm9sZXMuY29tcGFueSldID09IF93YWxsZXQ7CiAgICAgICAgcmV0dXJuIF9hY2NvdW50YW50IHx8IF9tYW5hZ2VyIHx8IF9ib3VudHkgfHwgX2NvbXBhbnk7CiAgICB9CgogICAgLy8gRm9yIGV4YW1wbGUgLSBBZnRlciA1IHllYXJzIG9mIHRoZSBwcm9qZWN0J3MgZXhpc3RlbmNlLCBhbGwgb2YgdXMgc3VkZGVubHkgZGVjaWRlZCBjb2xsZWN0aXZlbHkKICAgIC8vIChjb21wYW55ICsgaW52ZXN0b3JzKSB0aGF0IGl0IHdvdWxkIGJlIG1vcmUgcHJvZml0YWJsZSBmb3IgZXZlcnlvbmUgdG8gc3dpdGNoIHRvIGFub3RoZXIgc21hcnQKICAgIC8vIGNvbnRyYWN0IHJlc3BvbnNpYmxlIGZvciB0b2tlbnMuIFRoZSBjb21wYW55IHRoZW4gcHJlcGFyZXMgYSBuZXcgdG9rZW4sIGludmVzdG9ycwogICAgLy8gZGlzYXNzZW1ibGUsIHN0dWR5LCBkaXNjdXNzLCBldGMuIEFmdGVyIGEgZ2VuZXJhbCBhZ3JlZW1lbnQsIHRoZSBtYW5hZ2VyIGFsbG93cyBhbnkgaW52ZXN0b3I6CgkvLyAgICAgIC0gdG8gYnVybiB0aGUgdG9rZW5zIG9mIHRoZSBwcmV2aW91cyBjb250cmFjdAoJLy8gICAgICAtIGdlbmVyYXRlIG5ldyB0b2tlbnMgZm9yIGEgbmV3IGNvbnRyYWN0CgkvLyBJdCBpcyB1bmRlcnN0b29kIHRoYXQgYWZ0ZXIgYSBnZW5lcmFsIHNvbHV0aW9uIHRocm91Z2ggdGhpcyBmdW5jdGlvbiBhbGwgaW52ZXN0b3JzCgkvLyB3aWxsIGNvbGxlY3RpdmVseSAoYW5kIHZvbHVudGFyaWx5KSBtb3ZlIHRvIGEgbmV3IHRva2VuLgogICAgZnVuY3Rpb24gbW92ZVRva2VucyhhZGRyZXNzIF9taWdyYXRpb25BZ2VudCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIpOwogICAgICAgIHRva2VuLnNldE1pZ3JhdGlvbkFnZW50KF9taWdyYXRpb25BZ2VudCk7CiAgICB9CgoJLy8gQ2hhbmdlIHRoZSBhZGRyZXNzIGZvciB0aGUgc3BlY2lmaWVkIHJvbGUuCgkvLyBBdmFpbGFibGUgdG8gYW55IHdhbGxldCBvd25lciBleGNlcHQgdGhlIG9ic2VydmVyLgoJLy8gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyIHVudGlsIHRoZSByb3VuZCBpcyBpbml0aWFsaXplZC4KCS8vIFRoZSBPYnNlcnZlcidzIHdhbGxldCBvciBoaXMgb3duIG1hbmFnZXIgY2FuIGNoYW5nZSBhdCBhbnkgdGltZS4KICAgIGZ1bmN0aW9uIGNoYW5nZVdhbGxldChSb2xlcyBfcm9sZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKAogICAgICAgIAkJKG1zZy5zZW5kZXIgPT0gd2FsbGV0c1t1aW50OChfcm9sZSldICYmIF9yb2xlICE9IFJvbGVzLm9ic2VydmVyKQogICAgICAJCXx8CiAgICAgIAkJCShtc2cuc2VuZGVyID09IHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildICYmICghaXNJbml0aWFsaXplZCB8fCBfcm9sZSA9PSBSb2xlcy5vYnNlcnZlcikpCiAgICAgIAkpOwogICAgICAgIGFkZHJlc3Mgb2xkV2FsbGV0ID0gd2FsbGV0c1t1aW50OChfcm9sZSldOwogICAgICAgIHdhbGxldHNbdWludDgoX3JvbGUpXSA9IF93YWxsZXQ7CiAgICAgICAgaWYoIXVucGF1c2VkV2FsbGV0KG9sZFdhbGxldCkpCiAgICAgICAgICAgIHRva2VuLmRlbFVucGF1c2VkV2FsbGV0KG9sZFdhbGxldCk7CiAgICAgICAgaWYodW5wYXVzZWRXYWxsZXQoX3dhbGxldCkpCiAgICAgICAgICAgIHRva2VuLmFkZFVucGF1c2VkV2FsbGV0KF93YWxsZXQpOwogICAgfQoKICAgIC8vIElmIGEgbGl0dGxlIG1vcmUgdGhhbiBhIHllYXIgaGFzIGVsYXBzZWQgKElDTyBzdGFydCBkYXRlICsgNDAwIGRheXMpLCBhIHNtYXJ0IGNvbnRyYWN0CiAgICAvLyB3aWxsIGFsbG93IHlvdSB0byBzZW5kIGFsbCB0aGUgbW9uZXkgdG8gdGhlIEJlbmVmaWNpYXJ5LCBpZiBhbnkgbW9uZXkgaXMgcHJlc2VudC4gVGhpcyBpcwogICAgLy8gcG9zc2libGUgaWYgeW91IG1pc3Rha2VubHkgbGF1bmNoIHRoZSBJQ08gZm9yIDMwIHllYXJzIChub3QgMzAgZGF5cyksIGludmVzdG9ycyB3aWxsIHRyYW5zZmVyCiAgICAvLyBtb25leSB0aGVyZSBhbmQgeW91IHdpbGwgbm90IGJlIGFibGUgdG8gcGljayB0aGVtIHVwIHdpdGhpbiBhIHJlYXNvbmFibGUgdGltZS4gSXQgaXMgYWxzbwogICAgLy8gcG9zc2libGUgdGhhdCBpbiBvdXIgY2hlY2tlZCBzY3JpcHQgc29tZW9uZSB3aWxsIG1ha2UgdW5mb3Jlc2VlbiBtaXN0YWtlcywgc3BvaWxpbmcgdGhlCiAgICAvLyBmaW5hbGl6YXRpb24uIFdpdGhvdXQgZmluYWxpemF0aW9uLCBtb25leSBjYW5ub3QgYmUgcmV0dXJuZWQuIFRoaXMgaXMgYSByZXNjdWUgb3B0aW9uIHRvCiAgICAvLyBnZXQgYXJvdW5kIHRoaXMgcHJvYmxlbSwgYnV0IGF2YWlsYWJsZSBvbmx5IGFmdGVyIGEgeWVhciAoNDAwIGRheXMpLgoKCS8vIEFub3RoZXIgcmVhc29uIC0gdGhlIElDTyB3YXMgYSBmYWlsdXJlLCBidXQgbm90IGFsbCBFVEggaW52ZXN0b3JzIHRvb2sgdGhlaXIgbW9uZXkgZHVyaW5nIHRoZSB5ZWFyIGFmdGVyLgoJLy8gU29tZSBpbnZlc3RvcnMgbWF5IGhhdmUgbG9zdCBhIHdhbGxldCBrZXksIGZvciBleGFtcGxlLgoKCS8vIFRoZSBtZXRob2Qgd29ya3MgZXF1YWxseSB3aXRoIHRoZSBwcmUtSUNPIGFuZCBJQ08uIFdoZW4gdGhlIHByZS1JQ08gc3RhcnRzLCB0aGUgdGltZSBmb3IgdW5sb2NraW5nCgkvLyB0aGUgZGlzdHJ1Y3RWYXVsdCBiZWdpbnMuIElmIHRoZSBJQ08gaXMgdGhlbiBzdGFydGVkLCB0aGVuIHRoZSB0ZXJtIHN0YXJ0cyBhbmV3IGZyb20gdGhlIGZpcnN0IGRheSBvZiB0aGUgSUNPLgoKCS8vIE5leHQsIGFjdCBpbmRlcGVuZGVudGx5LCBpbiBhY2NvcmRhbmNlIHdpdGggb2JsaWdhdGlvbnMgdG8gaW52ZXN0b3JzLgoKCS8vIFdpdGhpbiA0MDAgZGF5cyBvZiB0aGUgc3RhcnQgb2YgdGhlIFJvdW5kLCBpZiBpdCBmYWlscyBvbmx5IGludmVzdG9ycyBjYW4gdGFrZSBtb25leS4gQWZ0ZXIKCS8vIHRoZSBkZWFkbGluZSB0aGlzIGNhbiBhbHNvIGluY2x1ZGUgdGhlIGNvbXBhbnkgYXMgd2VsbCBhcyBpbnZlc3RvcnMsIGRlcGVuZGluZyBvbiB3aG8gaXMgdGhlIGZpcnN0IHRvIHVzZSB0aGUgbWV0aG9kLgogICAgZnVuY3Rpb24gZGlzdHJ1Y3RWYXVsdCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLmJlbmVmaWNpYXJ5KV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShub3cgPiBzdGFydFRpbWUgKyA0MDAgZGF5cyk7CiAgICAgICAgdmF1bHQuZGVsKHdhbGxldHNbdWludDgoUm9sZXMuYmVuZWZpY2lhcnkpXSk7CiAgICB9CiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXRCb251cyh1aW50MjU2IF90b2tlblZhbHVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB2YWx1ZSkgewogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbiA9IHRva2VuUmVzZXJ2ZWQuYWRkKHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgICAgIHVpbnQyNTYgdG9rZW5WYWx1ZSA9IF90b2tlblZhbHVlOwogICAgICAgIHVpbnQyNTYgY3VycmVudEJvbnVzOwogICAgICAgIHVpbnQyNTYgY2FsY3VsYXRlQm9udXMgPSAwOwogICAgICAgIHVpbnQxNiBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBib251c1BhdHRlcm4ubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZih0b3RhbFRva2VuID49IGJvbnVzUGF0dGVybltpXS5hbW91bnQpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY3VycmVudEJvbnVzID0gdG9rZW5WYWx1ZS5tdWwoYm9udXNQYXR0ZXJuW2ldLnByb2NlbnQuYWRkKDEwMDAwMCkpLmRpdigxMDAwMDApOwogICAgICAgICAgICBpZih0b3RhbFRva2VuLmFkZChjYWxjdWxhdGVCb251cykuYWRkKGN1cnJlbnRCb251cykgPCBib251c1BhdHRlcm5baV0uYW1vdW50KSB7CiAgICAgICAgICAgICAgICBjYWxjdWxhdGVCb251cyA9IGNhbGN1bGF0ZUJvbnVzLmFkZChjdXJyZW50Qm9udXMpOwogICAgICAgICAgICAgICAgdG9rZW5WYWx1ZSA9IDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdXJyZW50Qm9udXMgPSBib251c1BhdHRlcm5baV0uYW1vdW50LnN1Yih0b3RhbFRva2VuLmFkZChjYWxjdWxhdGVCb251cykpOwogICAgICAgICAgICB0b2tlblZhbHVlID0gdG9rZW5WYWx1ZS5zdWIoY3VycmVudEJvbnVzLm11bCgxMDAwMDApLmRpdihib251c1BhdHRlcm5baV0ucHJvY2VudC5hZGQoMTAwMDAwKSkpOwogICAgICAgICAgICBjYWxjdWxhdGVCb251cyA9IGNhbGN1bGF0ZUJvbnVzICsgY3VycmVudEJvbnVzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsY3VsYXRlQm9udXMuYWRkKHRva2VuVmFsdWUpOwogICAgfQoKCgkvLyBXZSBhY2NlcHQgcGF5bWVudHMgb3RoZXIgdGhhbiBFdGhlcmV1bSAoRVRIKSBhbmQgb3RoZXIgY3VycmVuY2llcywgZm9yIGV4YW1wbGUsIEJpdGNvaW4gKEJUQykuCgkvLyBQZXJoYXBzIG90aGVyIHR5cGVzIG9mIGNyeXB0b2N1cnJlbmN5IC0gc2VlIHRoZSBvcmlnaW5hbCB0ZXJtcyBpbiB0aGUgd2hpdGUgcGFwZXIgYW5kIG9uIHRoZSBJQ08gd2Vic2l0ZS4KCgkvLyBXZSByZWxlYXNlIHRva2VucyBvbiBFdGhlcmV1bS4gRHVyaW5nIHRoZSBwcmUtSUNPIGFuZCBJQ08gd2l0aCBhIHNtYXJ0IGNvbnRyYWN0LCB5b3UgZGlyZWN0bHkgdHJhbnNmZXIKCS8vIHRoZSB0b2tlbnMgdGhlcmUgYW5kIGltbWVkaWF0ZWx5LCB3aXRoIHRoZSBzYW1lIHRyYW5zYWN0aW9uLCByZWNlaXZlIHRva2VucyBpbiB5b3VyIHdhbGxldC4KCgkvLyBXaGVuIHBheWluZyBpbiBhbnkgb3RoZXIgY3VycmVuY3ksIGZvciBleGFtcGxlIGluIEJUQywgd2UgYWNjZXB0IHlvdXIgbW9uZXkgdmlhIG9uZSBjb21tb24gd2FsbGV0LgoJLy8gT3VyIG1hbmFnZXIgZml4ZXMgdGhlIGFtb3VudCByZWNlaXZlZCBmb3IgdGhlIGJpdGNvaW4gd2FsbGV0IGFuZCBjYWxscyB0aGUgbWV0aG9kIG9mIHRoZSBzbWFydAogICAgLy8gY29udHJhY3QgcGF5bWVudHNJbk90aGVyQ3VycmVuY3kgdG8gaW5mb3JtIGhpbSBob3cgbXVjaCBmb3JlaWduIGN1cnJlbmN5IGhhcyBiZWVuIHJlY2VpdmVkIC0gb24gYSBkYWlseSBiYXNpcy4KICAgIC8vIFRoZSBzbWFydCBjb250cmFjdCBwaW5zIHRoZSBudW1iZXIgb2YgYWNjZXB0ZWQgRVRIIGRpcmVjdGx5IGFuZCB0aGUgbnVtYmVyIG9mIEJUQy4gU21hcnQgY29udHJhY3QKICAgIC8vIG1vbml0b3JzIHNvZnRjYXAgYW5kIGhhcmRjYXAsIHNvIGFzIG5vdCB0byBnbyBiZXlvbmQgdGhpcyBmcmFtZXdvcmsuCgoJLy8gSW4gdGhlb3J5LCBpdCBpcyBwb3NzaWJsZSB0aGF0IHdoZW4gYXBwcm9hY2hpbmcgaGFyZGNhcCwgd2Ugd2lsbCByZWNlaXZlIGEgdHJhbnNmZXIgKG9uZSBvciBzZXZlcmFsCgkvLyB0cmFuc2ZlcnMpIHRvIHRoZSB3YWxsZXQgb2YgQlRDLCB0aGF0IHRvZ2V0aGVyIHdpdGggcHJldmlvdXNseSByZWNlaXZlZCBtb25leSB3aWxsIGV4Y2VlZCB0aGUgaGFyZGNhcCBpbiB0b3RhbC4KCS8vIEluIHRoaXMgY2FzZSwgd2Ugd2lsbCByZWZ1bmQgYWxsIHRoZSBhbW91bnRzIGFib3ZlLCBpbiBvcmRlciBub3QgdG8gZXhjZWVkIHRoZSBoYXJkY2FwLgoKCS8vIENvbGxlY3Rpb24gb2YgbW9uZXkgaW4gQlRDIHdpbGwgYmUgY2FycmllZCBvdXQgdmlhIG9uZSBjb21tb24gd2FsbGV0LiBUaGUgd2FsbGV0J3MgYWRkcmVzcyB3aWxsIGJlIHB1Ymxpc2hlZAoJLy8gZXZlcnl3aGVyZSAoaW4gYSB3aGl0ZSBwYXBlciwgb24gdGhlIElDTyB3ZWJzaXRlLCBvbiBUZWxlZ3JhbSwgb24gQml0Y29pbnRhbGssIGluIHRoaXMgY29kZSwgZXRjLikKCS8vIEFueW9uZSBpbnRlcmVzdGVkIGNhbiBjaGVjayB0aGF0IHRoZSBhZG1pbmlzdHJhdG9yIG9mIHRoZSBzbWFydCBjb250cmFjdCB3cml0ZXMgZG93biBleGFjdGx5IHRoZSBhbW91bnQKCS8vIGluIEVUSCAoaW4gZXF1aXZhbGVudCBmb3IgQlRDKSB0aGVyZS4gSW4gdGhlb3J5LCB0aGUgYWJpbGl0eSB0byBieXBhc3MgYSBzbWFydCBjb250cmFjdCB0byBhY2NlcHQgbW9uZXkgaW4KCS8vIEJUQyBhbmQgbm90IHJlZ2lzdGVyIHRoZW0gaW4gRVRIIGNyZWF0ZXMgYSBwb3NzaWJpbGl0eSBmb3IgbWFuaXB1bGF0aW9uIGJ5IHRoZSBjb21wYW55LiBUaGFua3MgdG8KCS8vIHBheW1lbnRzSW5PdGhlckN1cnJlbmN5IGhvd2V2ZXIsIHRoaXMgdGhyZWF0IGlzIGxldmVsZWQuCgoJLy8gQW55IHVzZXIgY2FuIGNoZWNrIHRoZSBhbW91bnRzIGluIEJUQyBhbmQgdGhlIHZhcmlhYmxlIG9mIHRoZSBzbWFydCBjb250cmFjdCB0aGF0IGFjY291bnRzIGZvciB0aGlzCgkvLyAocGF5bWVudHNJbk90aGVyQ3VycmVuY3kgbWV0aG9kKS4gQW55IHVzZXIgY2FuIGVhc2lseSBjaGVjayB0aGUgaW5jb21pbmcgdHJhbnNhY3Rpb25zIGluIGEgc21hcnQgY29udHJhY3QKCS8vIG9uIGEgZGFpbHkgYmFzaXMuIEFueSBoeXBvdGhldGljYWwgdHJpY2tzIG9uIHRoZSBwYXJ0IG9mIHRoZSBjb21wYW55IGNhbiBiZSBleHBvc2VkIGFuZCBwYW5pYyBkdXJpbmcgdGhlIElDTywKCS8vIHNpbXBseSBwb2ludGluZyBvdXQgdGhlIGluY29tcGF0aWJpbGl0eSBvZiBwYXltZW50c0luT3RoZXJDdXJyZW5jeSAoaWUsIHRoZSBhbW91bnQgb2YgRVRIICsgQlRDIGNvbGxlY3Rpb24pCgkvLyBhbmQgdGhlIGFjdHVhbCB0cmFuc2FjdGlvbnMgaW4gQlRDLiBUaGUgY29tcGFueSBzdHJpY3RseSBhZGhlcmVzIHRvIHRoZSBkZXNjcmliZWQgcHJpbmNpcGxlcyBvZiBvcGVubmVzcy4KCgkvLyBUaGUgY29tcGFueSBhZG1pbmlzdHJhdG9yIGlzIHJlcXVpcmVkIHRvIHN5bmNocm9uaXplIHBheW1lbnRzSW5PdGhlckN1cnJlbmN5IGV2ZXJ5IHdvcmtpbmcgZGF5IChidXQgeW91CgkvLyBjYW5ub3Qgc3luY2hyb25pemUgaWYgdGhlcmUgYXJlIG5vIG5ldyBCVEMgcGF5bWVudHMpLiBJbiB0aGUgY2FzZSBvZiB1bmZvcmVzZWVuIHByb2JsZW1zLCBzdWNoIGFzCgkvLyBicmFrZXMgb24gdGhlIEV0aGVyZXVtIG5ldHdvcmssIHRoaXMgb3BlcmF0aW9uIG1heSBiZSBkaWZmaWN1bHQuIFlvdSBzaG91bGQgb25seSB3b3JyeSBpZiB0aGUKCS8vIGFkbWluaXN0cmF0b3IgZG9lcyBub3Qgc3luY2hyb25pemUgdGhlIGFtb3VudCBmb3IgbW9yZSB0aGFuIDk2IGhvdXJzIGluIGEgcm93LCBhbmQgdGhlIEJUQyB3YWxsZXQKCS8vIHJlY2VpdmVzIHNpZ25pZmljYW50IGFtb3VudHMuCgoJLy8gVGhpcyBzY2VuYXJpbyBlbnN1cmVzIHRoYXQgZm9yIHRoZSBzdW0gb2YgYWxsIGZlZXMgaW4gYWxsIGN1cnJlbmNpZXMgdGhpcyB2YWx1ZSBkb2VzIG5vdCBleGNlZWQgaGFyZGNhcC4KCiAgICAvLyBDb21tb24gQlRDIHdhbGxldDogMTJzRW9pWFBzOGE2c0piQzJxa2JaRGptSHNTQnY3Y0d3QwoKICAgIC8vICoqIFFVSU5USUxMSU9OUyAqKiAxMF4xOCAvIDEqKjE4IC8gMWUxOAogICAgZnVuY3Rpb24gcGF5bWVudHNJbk90aGVyQ3VycmVuY3kodWludDI1NiBfdG9rZW4sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5vYnNlcnZlcildID09IG1zZy5zZW5kZXIpOwogICAgICAgIGJvb2wgd2l0aGluUGVyaW9kID0gKG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWUpOwoKICAgICAgICBib29sIHdpdGhpbkNhcCA9IHRva2VuLnRvdGFsU3VwcGx5KCkuYWRkKF90b2tlbikgPD0gaGFyZENhcC5hZGQob3ZlckxpbWl0KTsKICAgICAgICByZXF1aXJlKHdpdGhpblBlcmlvZCAmJiB3aXRoaW5DYXAgJiYgaXNJbml0aWFsaXplZCk7CgogICAgICAgIG5vbkV0aFdlaVJhaXNlZCA9IF92YWx1ZTsKICAgICAgICB0b2tlblJlc2VydmVkID0gX3Rva2VuOwoKICAgIH0KCgogICAgLy8gVGhlIGZ1bmN0aW9uIGZvciBvYnRhaW5pbmcgc21hcnQgY29udHJhY3QgZnVuZHMgaW4gRVRILiBJZiBhbGwgdGhlIGNoZWNrcyBhcmUgdHJ1ZSwgdGhlIHRva2VuIGlzCiAgICAvLyB0cmFuc2ZlcnJlZCB0byB0aGUgYnV5ZXIsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIGN1cnJlbnQgYm9udXMuCiAgICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CgogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgICAgICB1aW50MjU2IHRva2VucyA9IGdldEJvbnVzKHdlaUFtb3VudCpyYXRlLzEwMDApOwogICAgICAgIAogICAgICAgIC8vIGhhcmRDYXAgaXMgbm90IHJlYWNoZWQsIGFuZCBpbiB0aGUgZXZlbnQgb2YgYSB0cmFuc2FjdGlvbiwgaXQgd2lsbCBub3QgYmUgZXhjZWVkZWQgYnkgbW9yZSB0aGFuIE92ZXJMaW1pdAogICAgICAgIGJvb2wgd2l0aGluQ2FwID0gdG9rZW5zIDw9IGhhcmRDYXAuc3ViKHRva2VuLnRvdGFsU3VwcGx5KCkuYWRkKHRva2VuUmVzZXJ2ZWQpKS5hZGQob3ZlckxpbWl0KTsKICAgICAgICAKICAgICAgICByZXF1aXJlKHdpdGhpbkNhcCk7CgogICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgIGV0aFdlaVJhaXNlZCA9IGV0aFdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICAgICAgdG9rZW4ubWludChiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CgogICAgICAgIGZvcndhcmRGdW5kcygpOwogICAgfQoKICAgIC8vIGJ1eVRva2VucyBhbGlhcwogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0KCn0KCi8vIChCKQovLyBUaGUgY29udHJhY3QgZm9yIGZyZWV6aW5nIHRva2VucyBmb3IgdGhlIHRlYW0uLgpjb250cmFjdCBTVlRBbGxvY2F0aW9uIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIFRva2VuIHB1YmxpYyB0b2tlbjsKCglhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICB1aW50MjU2IHB1YmxpYyB1bmxvY2tlZEF0OwoKICAgIHVpbnQyNTYgdG9rZW5zQ3JlYXRlZCA9IDA7CgogICAgLy8gVGhlIGNvbnRyYWN0IHRha2VzIHRoZSBFUkMyMCBjb2luIGFkZHJlc3MgZnJvbSB3aGljaCB0aGlzIGNvbnRyYWN0IHdpbGwgd29yayBhbmQgZnJvbSB0aGUKICAgIC8vIG93bmVyIChUZWFtIHdhbGxldCkgd2hvIG93bnMgdGhlIGZ1bmRzLgogICAgZnVuY3Rpb24gU1ZUQWxsb2NhdGlvbihUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX293bmVyKSBwdWJsaWN7CgogICAgCS8vIEhvdyBtYW55IGRheXMgdG8gZnJlZXplIGZyb20gdGhlIG1vbWVudCBvZiBmaW5hbGl6aW5nIElDTwogICAgICAgIHVubG9ja2VkQXQgPSBub3cgKyAxIHllYXJzOwogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgICAgIG93bmVyID0gX293bmVyOwogICAgfQoKICAgIC8vIElmIHRoZSB0aW1lIG9mIGZyZWV6aW5nIGV4cGlyZWQgd2lsbCByZXR1cm4gdGhlIGZ1bmRzIHRvIHRoZSBvd25lci4KICAgIGZ1bmN0aW9uIHVubG9jaygpIHB1YmxpY3sKICAgICAgICByZXF1aXJlKG5vdyA+PSB1bmxvY2tlZEF0KTsKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKG93bmVyLHRva2VuLmJhbGFuY2VPZih0aGlzKSkpOwogICAgfQp9CgoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIAl1aW50MjU2IGMgPSBhICogYjsKICAgIAlhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgCXJldHVybiBjOwoJfQoKICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2VzIG5vdCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKCQlyZXR1cm4gYzsKICAgIH0KfQoKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgICogYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWN7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIGV2ZW50IFBhdXNlKCk7CiAgICBldmVudCBVbnBhdXNlKCk7CgogICAgYm9vbCBfcGF1c2VkID0gZmFsc2U7CgogICAgZnVuY3Rpb24gcGF1c2VkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gX3BhdXNlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgICovCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSghX3BhdXNlZCk7CiAgICAgICAgX3BhdXNlZCA9IHRydWU7CiAgICAgICAgUGF1c2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfcGF1c2VkKTsKICAgICAgICBfcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgfQp9CgoKLy8gQ29udHJhY3QgaW50ZXJmYWNlIGZvciB0cmFuc2ZlcnJpbmcgY3VycmVudCB0b2tlbnMgdG8gYW5vdGhlcgpjb250cmFjdCBNaWdyYXRpb25BZ2VudAp7CiAgICBmdW5jdGlvbiBtaWdyYXRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwp9CgoKCi8vIChBMikKLy8gQ29udHJhY3QgdG9rZW4KY29udHJhY3QgVG9rZW4gaXMgUGF1c2FibGV7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiSGlnaCBSZXdhcmQgQ29pbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJIUkMiOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHVucGF1c2VkV2FsbGV0OwoKICAgIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsTWlncmF0ZWQ7CiAgICBhZGRyZXNzIHB1YmxpYyBtaWdyYXRpb25BZ2VudDsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgICBldmVudCBNaWdyYXRlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwoKICAgIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICAgICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgICAgICBfOwogICAgfQoKICAgICBmdW5jdGlvbiBUb2tlbigpIHB1YmxpYyB7CiAgICAgICAgIG93bmVyID0gMHgwOwogICAgIH0KCiAgICAgZnVuY3Rpb24gc2V0T3duZXIoKSBwdWJsaWN7CiAgICAgICAgIHJlcXVpcmUob3duZXIgPT0gMHgwKTsKICAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgIH0KCiAgICAvLyBCYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLy8gVHJhbnNmZXIgb2YgdG9rZW5zIGZyb20gb25lIGFjY291bnQgdG8gYW5vdGhlcgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSAoX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRva2VucyB0aGF0IF9vd25lciB0cnVzdGVkIHRvIHNwZW5kIGZyb20gaGlzIGFjY291bnQgX3NwZW5kZXIKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8gVHJ1c3QgX3NlbmRlciBhbmQgc3BlbmQgX3ZhbHVlIHRva2VucyBmcm9tIHlvdXIgYWNjb3VudAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3NlcwogICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFRyYW5zZmVyIG9mIHRva2VucyBmcm9tIHRoZSB0cnVzdGVkIGFkZHJlc3MgX2Zyb20gdG8gdGhlIGFkZHJlc3MgX3RvIGluIHRoZSBudW1iZXIgX3ZhbHVlCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAgICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAgICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgICAgICByZXF1aXJlIChfdmFsdWUgPiAwKTsKCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIElzc3VlIG5ldyB0b2tlbnMgdG8gdGhlIGFkZHJlc3MgX3RvIGluIHRoZSBhbW91bnQgX2Ftb3VudC4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgKGNvbnRyYWN0IENyb3dkc2FsZSkKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlPd25lciBjYW5NaW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgTWludChfdG8sIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBTdG9wIHRoZSByZWxlYXNlIG9mIHRva2Vucy4gVGhpcyBpcyBub3QgcG9zc2libGUgdG8gY2FuY2VsLiBBdmFpbGFibGUgdG8gdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdC4KLy8gICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewovLyAgICAgICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKLy8gICAgICAgIE1pbnRGaW5pc2hlZCgpOwovLyAgICAgICAgcmV0dXJuIHRydWU7Ci8vICAgIH0KCiAgICAvLyBSZWRlZmluaXRpb24gb2YgdGhlIG1ldGhvZCBvZiB0aGUgcmV0dXJuaW5nIHN0YXR1cyBvZiB0aGUgIkV4Y2hhbmdlIHBhdXNlIi4KICAgIC8vIE5ldmVyIGZvciB0aGUgb3duZXIgb2YgYW4gdW5wYXVzZWQgd2FsbGV0LgogICAgZnVuY3Rpb24gcGF1c2VkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci5wYXVzZWQoKSAmJiAhdW5wYXVzZWRXYWxsZXRbbXNnLnNlbmRlcl07CiAgICB9CgoKICAgIC8vIEFkZCBhIHdhbGxldCBpZ25vcmluZyB0aGUgIkV4Y2hhbmdlIHBhdXNlIi4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBhZGRVbnBhdXNlZFdhbGxldChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHVucGF1c2VkV2FsbGV0W193YWxsZXRdID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBSZW1vdmUgdGhlIHdhbGxldCBpZ25vcmluZyB0aGUgIkV4Y2hhbmdlIHBhdXNlIi4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBkZWxVbnBhdXNlZFdhbGxldChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgICB1bnBhdXNlZFdhbGxldFtfd2FsbGV0XSA9IGZhbHNlOwogICAgfQoKICAgIC8vIEVuYWJsZSB0aGUgdHJhbnNmZXIgb2YgY3VycmVudCB0b2tlbnMgdG8gb3RoZXJzLiBPbmx5IDEgdGltZS4gRGlzYWJsaW5nIHRoaXMgaXMgbm90IHBvc3NpYmxlLgogICAgLy8gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRNaWdyYXRpb25BZ2VudChhZGRyZXNzIF9taWdyYXRpb25BZ2VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtaWdyYXRpb25BZ2VudCA9PSAweDApOwogICAgICAgIG1pZ3JhdGlvbkFnZW50ID0gX21pZ3JhdGlvbkFnZW50OwogICAgfQoKICAgIC8vIFJlaXNzdWUgeW91ciB0b2tlbnMuCiAgICBmdW5jdGlvbiBtaWdyYXRlKCkgcHVibGljCiAgICB7CiAgICAgICAgdWludDI1NiB2YWx1ZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUodmFsdWUgPiAwKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIodmFsdWUpOwogICAgICAgIHRvdGFsTWlncmF0ZWQgPSB0b3RhbE1pZ3JhdGVkLmFkZCh2YWx1ZSk7CiAgICAgICAgTWlncmF0aW9uQWdlbnQobWlncmF0aW9uQWdlbnQpLm1pZ3JhdGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgICBNaWdyYXRlKG1zZy5zZW5kZXIsbWlncmF0aW9uQWdlbnQsdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgIH0KfQoKLy8gKEEzKQovLyBDb250cmFjdCBmb3IgZnJlZXppbmcgb2YgaW52ZXN0b3JzJyBmdW5kcy4gSGVuY2UsIGludmVzdG9ycyB3aWxsIGJlIGFibGUgdG8gd2l0aGRyYXcgbW9uZXkgaWYgdGhlCi8vIHJvdW5kIGRvZXMgbm90IGF0dGFpbiB0aGUgc29mdGNhcC4gRnJvbSBoZXJlIHRoZSB3YWxsZXQgb2YgdGhlIGJlbmVmaWNpYXJ5IHdpbGwgcmVjZWl2ZSBhbGwgdGhlCi8vIG1vbmV5IChuYW1lbHksIHRoZSBiZW5lZmljaWFyeSwgbm90IHRoZSBtYW5hZ2VyJ3Mgd2FsbGV0KS4KY29udHJhY3QgUmVmdW5kVmF1bHQgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkOwogICAgU3RhdGUgcHVibGljIHN0YXRlOwoKICAgIGV2ZW50IENsb3NlZCgpOwogICAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICAgIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwogICAgZXZlbnQgRGVwb3NpdGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwoKICAgIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KCkgcHVibGljIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICAgIH0KCiAgICAvLyBEZXBvc2l0aW5nIGZ1bmRzIG9uIGJlaGFsZiBvZiBhbiBJQ08gaW52ZXN0b3IuIEF2YWlsYWJsZSB0byB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IChDcm93ZHNhbGUgQ29udHJhY3QpLgogICAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBvbmx5T3duZXIgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgICAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkW2ludmVzdG9yXS5hZGQobXNnLnZhbHVlKTsKICAgICAgICBEZXBvc2l0ZWQoaW52ZXN0b3IsbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBNb3ZlIHRoZSBjb2xsZWN0ZWQgZnVuZHMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcy4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBjbG9zZShhZGRyZXNzIF93YWxsZXQpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgICAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgICAgICBDbG9zZWQoKTsKICAgICAgICBfd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8gQWxsb3cgcmVmdW5kIHRvIGludmVzdG9ycy4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgICB9CgogICAgLy8gUmV0dXJuIHRoZSBmdW5kcyB0byBhIHNwZWNpZmllZCBpbnZlc3Rvci4gSW4gY2FzZSBvZiBmYWlsdXJlIG9mIHRoZSByb3VuZCwgdGhlIGludmVzdG9yCiAgICAvLyBzaG91bGQgY2FsbCB0aGlzIG1ldGhvZCBvZiB0aGlzIGNvbnRyYWN0IChSZWZ1bmRWYXVsdCkgb3IgY2FsbCB0aGUgbWV0aG9kIGNsYWltUmVmdW5kIG9mIENyb3dkc2FsZQogICAgLy8gY29udHJhY3QuIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBlaXRoZXIgYnkgdGhlIGludmVzdG9yIGhpbXNlbGYsIG9yIHRoZSBjb21wYW55CiAgICAvLyAob3IgYW55b25lKSBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIGluIHRoZSBsb29wIHRvIHJldHVybiBmdW5kcyB0byBhbGwgaW52ZXN0b3JzIGVuIG1hc3NlLgogICAgZnVuY3Rpb24gcmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5SZWZ1bmRpbmcpOwogICAgICAgIHJlcXVpcmUoZGVwb3NpdGVkW2ludmVzdG9yXSA+IDApOwogICAgICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgICAgIGludmVzdG9yLnRyYW5zZmVyKGRlcG9zaXRlZFZhbHVlKTsKICAgICAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogICAgfQoKICAgIC8vIERlc3RydWN0aW9uIG9mIHRoZSBjb250cmFjdCB3aXRoIHJldHVybiBvZiBmdW5kcyB0byB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuIEF2YWlsYWJsZSB0bwogICAgLy8gdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGRlbChhZGRyZXNzIF93YWxsZXQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc2VsZmRlc3RydWN0KF93YWxsZXQpOwogICAgfQp9'.
	

]
