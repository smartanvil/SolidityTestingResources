Class {
	#name : #SRT50b1a3cb5a38d52fd43fbf0c96277fe534d81632,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT50b1a3cb5a38d52fd43fbf0c96277fe534d81632 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBPd25hYmxlIHsKCWFkZHJlc3Mgb3duZXI7CglhZGRyZXNzIHBvdGVudGlhbE93bmVyOwoJCgltb2RpZmllciBvbmx5T3duZXIoKSB7CgkJcmVxdWlyZShvd25lciA9PSBtc2cuc2VuZGVyKTsKCQlfOwoJfQoKCWZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewoJCW93bmVyID0gbXNnLnNlbmRlcjsKCX0KCgkvKgoJICogUFVCTElDCgkgKiBDaGVjayB3aGV0aGVyIHlvdSBgb3duYCB0aGlzIExvdHRlcnkKCSAqLwoJZnVuY3Rpb24gYW1JT3duZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CgkJcmV0dXJuIG1zZy5zZW5kZXIgPT0gb3duZXI7Cgl9CgoJLyoKCSAqIFJFU1RSSUNURUQKCSAqIFRyYW5zZmVyIG93bmVyc2hpcCB0byBhbm90aGVyIGFkZHJlc3MgKGdvZXMgaW50byBlZmZlY3Qgd2hlbiBvdGhlciBhZGRyZXNzIGFjY2VwdHMpCgkgKi8KCWZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKCQlwb3RlbnRpYWxPd25lciA9IF9uZXdPd25lcjsKCX0KCgkvKgoJICogUkVTVFJJQ1RFRAoJICogQWNjZXB0IG93bmVyc2hpcCBvZiB0aGUgTG90dGVyeSAoaWYgYSB0cmFuc2ZlciBoYXMgYmVlbiBpbml0aWF0ZWQgd2l0aCB5b3VyIGFkZHJlc3MpCgkgKi8KCWZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYyB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IHBvdGVudGlhbE93bmVyKTsKCQlvd25lciA9IG1zZy5zZW5kZXI7CgkJcG90ZW50aWFsT3duZXIgPSBhZGRyZXNzKDApOwoJfQp9Cgpjb250cmFjdCBMaW5rYWJsZSBpcyBPd25hYmxlIHsKCWFkZHJlc3NbXSBsaW5rZWQ7CgoJbW9kaWZpZXIgb25seUxpbmtlZCgpIHsKCQlyZXF1aXJlKGNoZWNrUGVybWlzc2lvbnMoKSA9PSB0cnVlKTsKCQlfOwoJfQoJCgkvKgoJICogUkVTVFJJQ1RFRAoJICogTGluayBhbiBhZGRyZXNzIHRvIHRoaXMgY29udHJhY3QuIFRoaXMgYWRkcmVzcyBoYXMgYWNjZXNzIHRvCgkgKiBhbnkgYG9ubHlMaW5rZWRgIGZ1bmN0aW9uCgkgKi8KCWZ1bmN0aW9uIGxpbmsoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CgkJbGlua2VkLnB1c2goX2FkZHJlc3MpOwoJfQoKCS8qIAoJICogUFVCTElDCgkgKiBDaGVjayBpZiB5b3UgaGF2ZSBiZWVuIGxpbmtlZCB0byB0aGlzIGNvbnRyYWN0CgkgKi8KCWZ1bmN0aW9uIGNoZWNrUGVybWlzc2lvbnMoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CgkJZm9yICh1aW50IGkgPSAwOyBpIDwgbGlua2VkLmxlbmd0aDsgaSsrKQoJCQlpZiAobGlua2VkW2ldID09IG1zZy5zZW5kZXIpIHJldHVybiB0cnVlOwoJCXJldHVybiBmYWxzZTsKCX0KfQoKY29udHJhY3QgQWN0aXZpdHkgaXMgT3duYWJsZSwgTGlua2FibGUgewogIAogIHN0cnVjdCBFdmVudCB7CiAgICB1aW50IGlkOwogICAgdWludCBnYW1lSWQ7CiAgICBhZGRyZXNzIHNvdXJjZTsKICAgIGFkZHJlc3NbXSB3aW5uZXJzOwogICAgdWludCB3aW5uaW5nTnVtYmVyOwogICAgdWludCBhbW91bnQ7CiAgICB1aW50IHRpbWVzdGFtcDsKICB9CgogIC8qCiAgICogR2V0IGFuIGV2ZW50IGJ5IGl0J3MgaWQgKGluZGV4KQogICAqLwogIEV2ZW50W10gcHVibGljIGV2ZW50czsKCiAgLyoKICAgKiBBZGQgYSBuZXcgZXZlbnQKICAgKi8KICBmdW5jdGlvbiBuZXdFdmVudCh1aW50IF9nYW1lSWQsIGFkZHJlc3NbXSBfd2lubmVycywgdWludCBfd2lubmluZ051bWJlciwgdWludCBfYW1vdW50KSBwdWJsaWMgb25seUxpbmtlZCB7CiAgICByZXF1aXJlKF9nYW1lSWQgPiAwKTsKICAgIGV2ZW50cy5wdXNoKEV2ZW50KGV2ZW50cy5sZW5ndGgsIF9nYW1lSWQsIG1zZy5zZW5kZXIsIF93aW5uZXJzLCBfd2lubmluZ051bWJlciwgX2Ftb3VudCwgbm93KSk7CiAgfQoKICAvKgogICAqIEdldCB0aGUgYWN0aXZpdHkgZmVlZCBmb3IgYWxsIGdhbWVzCiAgICoKICAgKiBOT1RFOiBzZXQgZ2FtZUlkIHRvIDAgZm9yIGEgZmVlZCBvZiBhbGwgZ2FtZXMKICAgKgogICAqIFJFVFVSTlM6CiAgICogKGlkc1tdLCBnYW1lSWRzW10sIHNvdXJjZXNbXSwgd2lubmVyc1tdIChpbmRleCAwIE9SIG1zZy5zZW5kZXIgaWYgdGhleSB3b24pLCBudW1XaW5uZXJzW10sIHdpbm5pbmdOdW1zW10sIGphY2twb3RzW10sIHRpbWVzdGFtcHNbXSkKICAgKi8KICBmdW5jdGlvbiBnZXRGZWVkKHVpbnQgX2dhbWVJZCwgdWludCBfcGFnZSwgdWludCBfcGFnZVNpemUpIHB1YmxpYyB2aWV3CiAgICByZXR1cm5zICh1aW50W10sIHVpbnRbXSwgYWRkcmVzc1tdLCB1aW50W10sIHVpbnRbXSwgdWludFtdLCB1aW50W10pIHsKICAgIAogICAgcmV0dXJuIGNvbnN0cnVjdFJlc3BvbnNlKGdldEZpbHRlcmVkKF9nYW1lSWQsIF9wYWdlIC0gMSwgX3BhZ2VTaXplKSk7CiAgfQoKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBQcml2YXRlIEhlbHBlcnMKCiAgZnVuY3Rpb24gY29uc3RydWN0UmVzcG9uc2UoRXZlbnRbXSBfZXZlbnRzKSBwcml2YXRlIHZpZXcKICAgIHJldHVybnMgKHVpbnRbXSwgdWludFtdLCBhZGRyZXNzW10sIHVpbnRbXSwgdWludFtdLCB1aW50W10sIHVpbnRbXSkgewogICAgCiAgICB1aW50W10gbWVtb3J5IF9pZHMgPSBuZXcgdWludFtdKF9ldmVudHMubGVuZ3RoKTsKICAgIHVpbnRbXSBtZW1vcnkgX2dhbWVJZHMgPSBuZXcgdWludFtdKF9ldmVudHMubGVuZ3RoKTsKICAgIHVpbnRbXSBtZW1vcnkgX2Ftb3VudHMgPSBuZXcgdWludFtdKF9ldmVudHMubGVuZ3RoKTsKICAgIHVpbnRbXSBtZW1vcnkgX3RpbWVzdGFtcHMgPSBuZXcgdWludFtdKF9ldmVudHMubGVuZ3RoKTsKCiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfZXZlbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIF9pZHNbaV0gPSBfZXZlbnRzW2ldLmlkOwogICAgICBfZ2FtZUlkc1tpXSA9IF9ldmVudHNbaV0uZ2FtZUlkOwogICAgICBfYW1vdW50c1tpXSA9IF9ldmVudHNbaV0uYW1vdW50OwogICAgICBfdGltZXN0YW1wc1tpXSA9IF9ldmVudHNbaV0udGltZXN0YW1wOwogICAgfQoKICAgIFdpbkRhdGEgbWVtb3J5IF93aW4gPSBjb250cnVjdFdpbkRhdGEoX2V2ZW50cyk7CgogICAgcmV0dXJuIChfaWRzLCBfZ2FtZUlkcywgX3dpbi53aW5uZXJzLCBfd2luLm51bVdpbm5lcnMsIF93aW4ud2lubmluZ051bWJlcnMsIF9hbW91bnRzLCBfdGltZXN0YW1wcyk7CiAgfQoKICBzdHJ1Y3QgV2luRGF0YSB7CiAgICBhZGRyZXNzW10gd2lubmVyczsKICAgIHVpbnRbXSBudW1XaW5uZXJzOwogICAgdWludFtdIHdpbm5pbmdOdW1iZXJzOwogIH0KCiAgZnVuY3Rpb24gY29udHJ1Y3RXaW5EYXRhKEV2ZW50W10gX2V2ZW50cykgcHJpdmF0ZSB2aWV3IHJldHVybnMgKFdpbkRhdGEpIHsKICAgIGFkZHJlc3NbXSBtZW1vcnkgX3dpbm5lcnMgPSBuZXcgYWRkcmVzc1tdKF9ldmVudHMubGVuZ3RoKTsKICAgIHVpbnRbXSBtZW1vcnkgX251bVdpbm5lcnMgPSBuZXcgdWludFtdKF9ldmVudHMubGVuZ3RoKTsKICAgIHVpbnRbXSBtZW1vcnkgX3dpbm5pbmdOdW1iZXJzID0gbmV3IHVpbnRbXShfZXZlbnRzLmxlbmd0aCk7CgogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2V2ZW50cy5sZW5ndGg7IGkrKykgewogICAgICBfd2lubmVyc1tpXSA9IGNob29zZVdpbm5lclRvRGlzcGxheShfZXZlbnRzW2ldLndpbm5lcnMsIG1zZy5zZW5kZXIpOwogICAgICBfbnVtV2lubmVyc1tpXSA9IF9ldmVudHNbaV0ud2lubmVycy5sZW5ndGg7CiAgICAgIF93aW5uaW5nTnVtYmVyc1tpXSA9IF9ldmVudHNbaV0ud2lubmluZ051bWJlcjsKICAgIH0KCiAgICByZXR1cm4gV2luRGF0YShfd2lubmVycywgX251bVdpbm5lcnMsIF93aW5uaW5nTnVtYmVycyk7CiAgfQoKICBmdW5jdGlvbiBjaG9vc2VXaW5uZXJUb0Rpc3BsYXkoYWRkcmVzc1tdIF93aW5uZXJzLCBhZGRyZXNzIF91c2VyKSBwcml2YXRlIHB1cmUgcmV0dXJucyAoYWRkcmVzcykgewogICAgaWYgKF93aW5uZXJzLmxlbmd0aCA8IDEpIHJldHVybiBhZGRyZXNzKDApOwogICAgYWRkcmVzcyBfcGlja2VkID0gX3dpbm5lcnNbMF07CiAgICBpZiAoX3dpbm5lcnMubGVuZ3RoID09IDEpIHJldHVybiBfcGlja2VkOwogICAgZm9yICh1aW50IGkgPSAxOyBpIDwgX3dpbm5lcnMubGVuZ3RoOyBpKyspCiAgICAgIGlmIChfd2lubmVyc1tpXSA9PSBfdXNlcikgX3BpY2tlZCA9IF91c2VyOwogICAgcmV0dXJuIF9waWNrZWQ7CiAgfQoKICBmdW5jdGlvbiBnZXRGaWx0ZXJlZCh1aW50IF9nYW1lSWQsIHVpbnQgX3BhZ2UsIHVpbnQgX3BhZ2VTaXplKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoRXZlbnRbXSkgewogICAgRXZlbnRbXSBtZW1vcnkgX2ZpbHRlcmVkID0gbmV3IEV2ZW50W10oX3BhZ2VTaXplKTsKICAgIHVpbnQgX2ZpbHRlcmVkSW5kZXg7CiAgICB1aW50IF9taW5JbmRleCA9IF9wYWdlICogX3BhZ2VTaXplOwogICAgdWludCBfbWF4SW5kZXggPSBfbWluSW5kZXggKyBfcGFnZVNpemU7CiAgICB1aW50IF9jb3VudDsKCiAgICBmb3IgKHVpbnQgaSA9IGV2ZW50cy5sZW5ndGg7IGkgPiAwOyBpLS0pIHsKICAgICAgaWYgKF9nYW1lSWQgPT0gMCB8fCBldmVudHNbaSAtIDFdLmdhbWVJZCA9PSBfZ2FtZUlkKSB7CiAgICAgICAgaWYgKF9maWx0ZXJlZEluZGV4ID49IF9taW5JbmRleCAmJiBfZmlsdGVyZWRJbmRleCA8IF9tYXhJbmRleCkgewogICAgICAgICAgX2ZpbHRlcmVkW19jb3VudF0gPSBldmVudHNbaSAtIDFdOwogICAgICAgICAgX2NvdW50Kys7CiAgICAgICAgfQogICAgICAgIF9maWx0ZXJlZEluZGV4Kys7CiAgICAgIH0KICAgIH0KCiAgICBFdmVudFtdIG1lbW9yeSBfZXZlbnRzID0gbmV3IEV2ZW50W10oX2NvdW50KTsKICAgIGZvciAodWludCBiID0gMDsgYiA8IF9jb3VudDsgYisrKQogICAgICBfZXZlbnRzW2JdID0gX2ZpbHRlcmVkW2JdOwoKICAgIHJldHVybiBfZXZlbnRzOwogIH0KCn0KCmNvbnRyYWN0IEFmZmlsaWF0ZXMgaXMgT3duYWJsZSwgTGlua2FibGUgewoJYm9vbCBvcGVuID0gdHJ1ZTsKCWJvb2wgcHJvbW90ZWQgPSB0cnVlOwoKCS8qCgkgKiBPcGVuL0Nsb3NlIHJlZ2lzdHJhdGlvbiBvZiBuZXcgYWZmaWxpYXRlcwoJICovCglmdW5jdGlvbiBzZXRSZWdpc3RyYXRpb25PcGVuKGJvb2wgX29wZW4pIHB1YmxpYyBvbmx5T3duZXIgewoJCW9wZW4gPSBfb3BlbjsKCX0KCglmdW5jdGlvbiBpc1JlZ2lzdHJhdGlvbk9wZW4oKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CgkJcmV0dXJuIG9wZW47Cgl9CgoJLyoKCSAqIFNob3VsZCBwcm9tb3RlIHJlZ2lzdHJhdGlvbiBvZiBuZXcgYWZmaWxpYXRlcwoJICovCglmdW5jdGlvbiBzZXRQcm9tb3RlZChib29sIF9wcm9tb3RlZCkgcHVibGljIG9ubHlPd25lciB7CgkJcHJvbW90ZWQgPSBfcHJvbW90ZWQ7Cgl9CgoJZnVuY3Rpb24gaXNQcm9tb3RlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gcHJvbW90ZWQ7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgltYXBwaW5nKHVpbnQgPT4gdWludCkgYmFsYW5jZXM7IC8vIChhZmZpbGlhdGVDb2RlID0+IGJhbGFuY2UpCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgbGlua3M7IC8vIChidXllciA9PiBhZmZpbGlhdGVDb2RlKQoJbWFwcGluZyh1aW50ID0+IGJvb2wpIGxpdmluZzsgLy8gd2hldGhlciBhIGNvZGUgaGFzIGJlZW4gdXNlZCBiZWZvcmUgKHVzZWQgZm9yIG9wZW4vY2xvc2luZyBvZiBwcm9ncmFtKQoJCgkvKgoJICogUFVCTElDCgkgKiBHZXQgdGhlIGNvZGUgZm9yIGFuIGFmZmlsaWF0ZQoJICovCglmdW5jdGlvbiBnZXRDb2RlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewoJCXJldHVybiBjb2RlKG1zZy5zZW5kZXIpOwoJfQoKCS8vIENvbnZlcnQgYW4gYWZmaWxpYXRlJ3MgYWRkcmVzcyBpbnRvIGEgY29kZQoJZnVuY3Rpb24gY29kZShhZGRyZXNzIF9hZmZpbGlhdGUpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50KSB7CgkJdWludCBudW0gPSB1aW50KHVpbnQyNTYoa2VjY2FrMjU2KF9hZmZpbGlhdGUpKSk7CgkJcmV0dXJuIG51bSAvIDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwoJfQoKCS8qCgkgKiBQVUJMSUMKCSAqIEdldCB0aGUgYWRkcmVzcyB3aG8gb3JpZ2luYWxseSByZWZlcnJlZCB0aGUgZ2l2ZW4gdXNlci4gUmV0dXJucyAwIGlmIG5vdCByZWZlcnJlZAoJICovCglmdW5jdGlvbiBnZXRBZmZpbGlhdGlvbihhZGRyZXNzIF91c2VyKSBwdWJsaWMgdmlldyBvbmx5TGlua2VkIHJldHVybnMgKHVpbnQpIHsKCQlyZXR1cm4gbGlua3NbX3VzZXJdOwoJfQoKCS8qCgkgKiBQVUJMSUMKCSAqIFNldCB0aGUgYWZmaWxpYXRpb24gb2YgYSB1c2VyIHRvIGEgZ2l2ZW4gY29kZS4gUmV0dXJucyB0aGUgYWRkcmVzcyBvZiB0aGUgcmVmZXJyZXIKCSAqIGxpbmtlZCB0byB0aGF0IGNvZGUgT1IsIGlmIGEgdXNlciBoYXMgYWxyZWFkeSBiZWVuIGxpbmtlZCB0byBhIHJlZmVyZXIsIHJldHVybnMgdGhlCgkgKiBhZGRyZXNzIG9mIHRoZWlyIG9yaWdpbmFsIHJlZmVyZXIKCSAqLwoJZnVuY3Rpb24gc2V0QWZmaWxpYXRpb24oYWRkcmVzcyBfdXNlciwgdWludCBfY29kZSkgcHVibGljIG9ubHlMaW5rZWQgcmV0dXJucyAodWludCkgewoJCXVpbnQgX2FmZmlsaWF0ZUNvZGUgPSBsaW5rc1tfdXNlcl07CgkJaWYgKF9hZmZpbGlhdGVDb2RlICE9IDApIHJldHVybiBfYWZmaWxpYXRlQ29kZTsKCQlsaW5rc1tfdXNlcl0gPSBfY29kZTsKCQlyZXR1cm4gX2NvZGU7Cgl9CgoJLyoKCSAqIFJFU1RSSUNURUQKCSAqIEFkZCBXZWkgdG8gbXVsdGlwbGUgYWZmaWxpYXRlcywgYmUgc3VyZSB0byBzZW5kIGFuIGFtb3VudCBvZiBldGhlciAKCSAqIGVxdWl2YWxlbnQgdG8gdGhlIHN1bSBvZiB0aGUgX2Ftb3VudHMgYXJyYXkKCSAqLwoJZnVuY3Rpb24gZGVwb3NpdCh1aW50W10gX2FmZmlsaWF0ZUNvZGVzLCB1aW50W10gX2Ftb3VudHMpIHB1YmxpYyBwYXlhYmxlIG9ubHlMaW5rZWQgewoJCXJlcXVpcmUoX2FmZmlsaWF0ZUNvZGVzLmxlbmd0aCA9PSBfYW1vdW50cy5sZW5ndGggJiYgX2FmZmlsaWF0ZUNvZGVzLmxlbmd0aCA+IDApOwoKCQl1aW50IF90b3RhbDsKCQlmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYWZmaWxpYXRlQ29kZXMubGVuZ3RoOyBpKyspIHsKCQkJYmFsYW5jZXNbX2FmZmlsaWF0ZUNvZGVzW2ldXSArPSBfYW1vdW50c1tpXTsKCQkJX3RvdGFsICs9IF9hbW91bnRzW2ldOwoJCX0KCgkJcmVxdWlyZShfdG90YWwgPT0gbXNnLnZhbHVlICYmIF90b3RhbCA+IDApOwoJfQoKCWV2ZW50IFdpdGhkcmF3bihhZGRyZXNzIGFmZmlsaWF0ZSwgdWludCBhbW91bnQpOwoKCS8qIAoJICogUFVCTElDCgkgKiBXaXRoZHJhdyBXZWkgaW50byB5b3VyIHdhbGxldCAod2lsbCByZXZlcnQgaWYgeW91IGhhdmUgbm8gYmFsYW5jZSkKCSAqLwoJZnVuY3Rpb24gd2l0aGRyYXcoKSBwdWJsaWMgcmV0dXJucyAodWludCkgewoJCXVpbnQgX2NvZGUgPSBjb2RlKG1zZy5zZW5kZXIpOwoJCXVpbnQgX2Ftb3VudCA9IGJhbGFuY2VzW19jb2RlXTsKCQlyZXF1aXJlKF9hbW91bnQgPiAwKTsKCQliYWxhbmNlc1tfY29kZV0gPSAwOwoJCW1zZy5zZW5kZXIudHJhbnNmZXIoX2Ftb3VudCk7CQoJCVdpdGhkcmF3bihtc2cuc2VuZGVyLCBfYW1vdW50KTsKCQlyZXR1cm4gX2Ftb3VudDsJCgl9CgoJLyogCgkgKiBQVUJMSUMKCSAqIEdldCB0aGUgYW1vdW50IG9mIFdlaSB5b3UgY2FuIHdpdGhkcmF3CgkgKi8KCWZ1bmN0aW9uIGdldEJhbGFuY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CgkJcmV0dXJuIGJhbGFuY2VzW2NvZGUobXNnLnNlbmRlcildOwoJfQp9Cgpjb250cmFjdCBMb3R0ZXJ5IGlzIE93bmFibGUgewoJZnVuY3Rpb24gTG90dGVyeSgpIHB1YmxpYyB7CgkJb3duZXIgPSBtc2cuc2VuZGVyOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTG90dGVyeSBJZGVudGlmaWNhdGlvbiAtIG1haW5seSB1c2VkIGZvciBBY3Rpdml0eSBldmVudHMKCQoJdWludCBpZDsKCglmdW5jdGlvbiBzZXRJZCh1aW50IF9pZCkgcHVibGljIG9ubHlPd25lciB7CgkJcmVxdWlyZShfaWQgPiAwKTsKCQlpZCA9IF9pZDsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIExpbmtpbmcKCgkvKgoJICogaWQ6IGEgdW5pcXVlIG5vbi16ZXJvIGlkIGZvciB0aGlzIGluc3RhbmNlLiBVc2VkIGZvciBBY3Rpdml0eSBldmVudHMKCSAqIGFjdGl2aXR5OiBhZGRyZXNzIHBvaW50aW5nIHRvIHRoZSBBY3Rpdml0eSBpbnN0YW5jZQoJICovCglmdW5jdGlvbiBsaW5rKHVpbnQgX2lkLCBhZGRyZXNzIF9hY3Rpdml0eSwgYWRkcmVzcyBfYWZmaWxpYXRlcykgcHVibGljIG9ubHlPd25lciB7CgkJcmVxdWlyZShfaWQgPiAwKTsKCQlpZCA9IF9pZDsKCQlsaW5rQWN0aXZpdHkoX2FjdGl2aXR5KTsKCQlsaW5rQWZmaWxpYXRlcyhfYWZmaWxpYXRlcyk7CgkJaW5pdGlhbGl6ZWQoKTsKCX0KCgkvLyBJbXBsZW1lbnQgdGhpcwoJZnVuY3Rpb24gaW5pdGlhbGl6ZWQoKSBpbnRlcm5hbDsKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIEFjdGl2aXR5IEludGVncmF0aW9uCgoJYWRkcmVzcyBwdWJsaWMgYWN0aXZpdHlBZGRyZXNzOwoJQWN0aXZpdHkgYWN0aXZpdHk7CgoJZnVuY3Rpb24gbGlua0FjdGl2aXR5KGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIG9ubHlPd25lciB7CgkJYWN0aXZpdHkgPSBBY3Rpdml0eShfYWRkcmVzcyk7CgkJcmVxdWlyZShhY3Rpdml0eS5jaGVja1Blcm1pc3Npb25zKCkgPT0gdHJ1ZSk7CgkJYWN0aXZpdHlBZGRyZXNzID0gX2FkZHJlc3M7Cgl9CgoJZnVuY3Rpb24gcG9zdEV2ZW50KGFkZHJlc3NbXSBfd2lubmVycywgdWludCBfd2lubmluZ051bWJlciwgdWludCBfamFja3BvdCkgaW50ZXJuYWwgewoJCWFjdGl2aXR5Lm5ld0V2ZW50KGlkLCBfd2lubmVycywgX3dpbm5pbmdOdW1iZXIsIF9qYWNrcG90KTsKCX0KCglmdW5jdGlvbiBwb3N0RXZlbnQoYWRkcmVzcyBfd2lubmVyLCB1aW50IF93aW5uaW5nTnVtYmVyLCB1aW50IF9qYWNrcG90KSBpbnRlcm5hbCB7CgkJYWRkcmVzc1tdIG1lbW9yeSBfd2lubmVycyA9IG5ldyBhZGRyZXNzW10oMSk7CgkJX3dpbm5lcnNbMF0gPSBfd2lubmVyOwoJCXBvc3RFdmVudChfd2lubmVycywgX3dpbm5pbmdOdW1iZXIsIF9qYWNrcG90KTsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIFBheW1lbnQgdHJhbnNmZXJzCgoJYWRkcmVzcyBwdWJsaWMgYWZmaWxpYXRlc0FkZHJlc3M7CglBZmZpbGlhdGVzIGFmZmlsaWF0ZXM7CgoJZnVuY3Rpb24gbGlua0FmZmlsaWF0ZXMoYWRkcmVzcyBfYWRkcmVzcykgaW50ZXJuYWwgb25seU93bmVyIHsKCQlyZXF1aXJlKGFmZmlsaWF0ZXNBZGRyZXNzID09IGFkZHJlc3MoMCkpOwoJCWFmZmlsaWF0ZXMgPSBBZmZpbGlhdGVzKF9hZGRyZXNzKTsKCQlyZXF1aXJlKGFmZmlsaWF0ZXMuY2hlY2tQZXJtaXNzaW9ucygpID09IHRydWUpOwoJCWFmZmlsaWF0ZXNBZGRyZXNzID0gX2FkZHJlc3M7Cgl9CgoJZnVuY3Rpb24gc2V0VXNlckFmZmlsaWF0ZSh1aW50IF9jb2RlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CgkJcmV0dXJuIGFmZmlsaWF0ZXMuc2V0QWZmaWxpYXRpb24obXNnLnNlbmRlciwgX2NvZGUpOwoJfQoKCWZ1bmN0aW9uIHVzZXJBZmZpbGlhdGUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKCQlyZXR1cm4gYWZmaWxpYXRlcy5nZXRBZmZpbGlhdGlvbihtc2cuc2VuZGVyKTsKCX0KCglmdW5jdGlvbiBwYXlvdXRUb0FmZmlsaWF0ZXModWludFtdIF9hZGRyZXNzZXMsIHVpbnRbXSBfYW1vdW50cywgdWludCBfdG90YWwpIGludGVybmFsIHsKCQlhZmZpbGlhdGVzLmRlcG9zaXQudmFsdWUoX3RvdGFsKShfYWRkcmVzc2VzLCBfYW1vdW50cyk7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBSYW5kb21uZXNzCgoJZnVuY3Rpb24gZ2V0UmFuZG9tTnVtYmVyKHVpbnQgX21heCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewoJCXJldHVybiB1aW50KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSkpICUgX21heCArIDE7Cgl9Cn0KCgpjb250cmFjdCBTbG90TG90dGVyeSBpcyBMb3R0ZXJ5IHsKCQoJZnVuY3Rpb24gU2xvdExvdHRlcnkoKSBMb3R0ZXJ5KCkgcHVibGljIHsKCQlzdGF0ZSA9IFN0YXRlLlVuaW5pdGlhbGl6ZWQ7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBMaW5raW5nCgoJZnVuY3Rpb24gaW5pdGlhbGl6ZWQoKSBpbnRlcm5hbCB7CgkJc3RhdGUgPSBTdGF0ZS5Ob3RSdW5uaW5nOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gU3RhdGUKCglTdGF0ZSBzdGF0ZTsKCgllbnVtIFN0YXRlIHsgVW5pbml0aWFsaXplZCwgUnVubmluZywgUGVuZGluZywgR2FtZU92ZXIsIE5vdFJ1bm5pbmcgfQoKCW1vZGlmaWVyIG9ubHkoU3RhdGUgX3N0YXRlKSB7CgkJcmVxdWlyZShzdGF0ZSA9PSBfc3RhdGUpOwoJCV87Cgl9CgoJbW9kaWZpZXIgbm90KFN0YXRlIF9zdGF0ZSkgewoJCXJlcXVpcmUoc3RhdGUgIT0gX3N0YXRlKTsKCQlfOwoJfQoKCW1vZGlmaWVyIG9uZU9mKFN0YXRlWzJdIG1lbW9yeSBfc3RhdGVzKSB7CgkJYm9vbCBfdmFsaWQgPSBmYWxzZTsKCQlmb3IgKHVpbnQgaSA9IDA7IGkgPCBfc3RhdGVzLmxlbmd0aDsgaSsrKQoJCQlpZiAoc3RhdGUgPT0gX3N0YXRlc1tpXSkgX3ZhbGlkID0gdHJ1ZTsKCQlyZXF1aXJlKF92YWxpZCk7CgkJXzsKCX0KCgkvKgoJICogUFVCTElDCgkgKiBHZXQgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIExvdHRlcnkKCSAqLwoJZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChTdGF0ZSkgewoJCXJldHVybiBzdGF0ZTsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIEFkbWluaXN0cmF0aXZlCgoJLyoKCSAqIFJFU1RSSUNURUQKCSAqIFN0YXJ0IHVwIGEgbmV3IGdhbWUgd2l0aCB0aGUgZ2l2ZW4gZ2FtZSBydWxlcwoJICovCglmdW5jdGlvbiBzdGFydEdhbWUodWludCBfamFja3BvdCwgdWludCBfc2xvdHMsIHVpbnQgX3ByaWNlLCB1aW50IF9tYXgpIHB1YmxpYyBvbmx5KFN0YXRlLk5vdFJ1bm5pbmcpIG9ubHlPd25lciB7CgkJcmVxdWlyZShfcHJpY2UgKiBfc2xvdHMgPiBfamFja3BvdCk7CgkJbmV4dEdhbWUodmVyaWZpZWRHYW1lUnVsZXMoX2phY2twb3QsIF9zbG90cywgX3ByaWNlLCBfbWF4KSk7Cgl9CgoJLyoKCSAqIFJFU1RSSUNURUQKCSAqIFdoZW4gdGhlIGN1cnJlbnRseSBydW5uaW5nIGdhbWUgZW5kcywgYSBuZXcgZ2FtZSB3b24ndCBiZSBhdXRvbWF0aWNhbGx5IHN0YXJ0ZWQKCSAqLwoJZnVuY3Rpb24gc3VzcGVuZEdhbWUoKSBwdWJsaWMgb25seU93bmVyIHsKCQlnYW1lLmxvb3AgPSBmYWxzZTsKCX0KCgkvKgoJICogUkVTVFJJQ1RFRAoJICogV2hlbiB0aGUgY3VycmVudGx5IHJ1bm5pbmcgZ2FtZSBlbmRzLCBhIG5ldyBnYW1lIHdpbGwgYmUgYXV0b21hdGljYWxseSBzdGFydGVkICh0aGlzIGlzIHRoZSBkZWZhdWx0IGJlaGF2aW9yKQoJICovCglmdW5jdGlvbiBnYW1lU2hvdWxkUmVzdGFydCgpIHB1YmxpYyBvbmx5T3duZXIgewoJCWdhbWUubG9vcCA9IHRydWU7Cgl9CgoJLyoKCSAqIFJFU1RSSUNURUQKCSAqIEluIHRoZSBldmVudCB0aGF0IHNvbWUgZXJyb3Igb2NjdXJzIGFuZCB0aGUgY29udHJhY3QgbmV2ZXIgZ2V0cyB0aGUgcmFuZG9tIGNhbGxiYWNrCgkgKiB0aGUgb3duZXIgb2YgdGhlIExvdHRlcnkgY2FuIHRyaWdnZXIgYW5vdGhlciByYW5kb20gbnVtYmVyIHRvIGJlIHJldHJpZXZlZAoJICovCglmdW5jdGlvbiB0cmlnZ2VyRmluZFdpbm5lcigpIHB1YmxpYyBvbmx5KFN0YXRlLlBlbmRpbmcpIHBheWFibGUgb25seU93bmVyIHsKCQlzdGF0ZSA9IFN0YXRlLlJ1bm5pbmc7CgkJZmluZFdpbm5lcigpOwoJfQoKCS8qCgkgKiBSRVNUUklDVEVECgkgKiBTZXQgbmV3IHJ1bGVzIGZvciB0aGUgbmV4dCBnYW1lCgkgKi8KCWZ1bmN0aW9uIHNldE5leHRSdWxlcyh1aW50IF9qYWNrcG90LCB1aW50IF9zbG90cywgdWludCBfcHJpY2UsIHVpbnQgX21heCkgcHVibGljIG5vdChTdGF0ZS5Ob3RSdW5uaW5nKSBvbmx5T3duZXIgewoJCXJlcXVpcmUoZ2FtZS5sb29wID09IHRydWUpOwoJCWdhbWUubmV4dEdhbWVSdWxlcyA9IHZlcmlmaWVkR2FtZVJ1bGVzKF9qYWNrcG90LCBfc2xvdHMsIF9wcmljZSwgX21heCk7Cgl9CgoJLyoKCSAqIFJFU1RSSUNURUQKCSAqIEdldCB0aGUgcnVsZXMgZm9yIHRoZSB1cGNvbWluZyBnYW1lIChpZiB0aGVyZSBldmVuIGlzIG9uZSkKCSAqIChqYWNrcG90LCBudW1iZXJPZlRpY2tldHMsIHRpY2tldFByaWNlLCBtYXhUaWNrZXRzUGVyLCB3aWxsU3RhcnROZXdHYW1lVXBvbkNvbXBsZXRpb24pCgkgKi8KCWZ1bmN0aW9uIGdldE5leHRSdWxlcygpIHB1YmxpYyB2aWV3IG9ubHlPd25lciByZXR1cm5zICh1aW50LCB1aW50LCB1aW50LCB1aW50LCBib29sKSB7CgkJcmV0dXJuIChnYW1lLm5leHRHYW1lUnVsZXMuamFja3BvdCwgZ2FtZS5uZXh0R2FtZVJ1bGVzLnNsb3RzLCBnYW1lLm5leHRHYW1lUnVsZXMudGlja2V0UHJpY2UsIGdhbWUubmV4dEdhbWVSdWxlcy5tYXhUaWNrZXRzUGVyLCBnYW1lLmxvb3ApOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTGlmZWN5Y2xlCgoJZnVuY3Rpb24gbmV4dEdhbWUoR2FtZVJ1bGVzIF9ydWxlcykgaW50ZXJuYWwgb25lT2YoW1N0YXRlLkdhbWVPdmVyLCBTdGF0ZS5Ob3RSdW5uaW5nXSkgewoJCXVpbnQgX25ld0lkID0gbGFzdEdhbWUuaWQgKyAxOwoJCWdhbWUgPSBHYW1lKHsKCQkJaWQ6IF9uZXdJZCwgcnVsZXM6IF9ydWxlcywgbmV4dEdhbWVSdWxlczogX3J1bGVzLCBsb29wOiB0cnVlLCBzdGFydGVkQXQ6IGJsb2NrLnRpbWVzdGFtcCwgCgkJCXRpY2tldHNTb2xkOiAwLCB3aW5uZXI6IGFkZHJlc3MoMCksIHdpbm5pbmdOdW1iZXI6IDAsIGZpbmlzaGVkQXQ6IDAKCQl9KTsKCQlmb3IodWludCBpID0gMTsgaSA8PSBnYW1lLnJ1bGVzLnNsb3RzOyBpKyspCgkJCWdhbWUudGlja2V0c1tpXSA9IGFkZHJlc3MoMCk7CgkJc3RhdGUgPSBTdGF0ZS5SdW5uaW5nOwoJfQoKCWZ1bmN0aW9uIGZpbmRXaW5uZXIoKSBpbnRlcm5hbCBvbmx5KFN0YXRlLlJ1bm5pbmcpIHsKCQlyZXF1aXJlKGdhbWUudGlja2V0c1NvbGQgPj0gZ2FtZS5ydWxlcy5zbG90cyk7CgkJcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gZ2FtZS5ydWxlcy5qYWNrcG90KTsKCgkJc3RhdGUgPSBTdGF0ZS5QZW5kaW5nOwoJCXVpbnQgX3dpbm5pbmdOdW1iZXIgPSBnZXRSYW5kb21OdW1iZXIoZ2FtZS5ydWxlcy5zbG90cyk7CgkJd2lubmVyQ2hvc2VuKF93aW5uaW5nTnVtYmVyKTsKCX0KCglmdW5jdGlvbiB3aW5uZXJDaG9zZW4odWludCBfd2lubmluZ051bWJlcikgaW50ZXJuYWwgb25seShTdGF0ZS5QZW5kaW5nKSB7CgkJc3RhdGUgPSBTdGF0ZS5HYW1lT3ZlcjsKCgkJYWRkcmVzcyBfd2lubmVyID0gZ2FtZS50aWNrZXRzW193aW5uaW5nTnVtYmVyXTsKCQlib29sIF9zdGFydE5ldyA9IGdhbWUubG9vcDsKCQlHYW1lUnVsZXMgbWVtb3J5IF9uZXh0UnVsZXMgPSBnYW1lLm5leHRHYW1lUnVsZXM7CgoJCWdhbWUuZmluaXNoZWRBdCA9IGJsb2NrLnRpbWVzdGFtcDsKCQlnYW1lLndpbm5lciA9IF93aW5uZXI7CgkJZ2FtZS53aW5uaW5nTnVtYmVyID0gX3dpbm5pbmdOdW1iZXI7CgkJbGFzdEdhbWUgPSBnYW1lOwoKCQkvLyBQYXkgd2lubmVyLCBhZmZpbGlhdGVzLCBhbmQgb3duZXIKCQlfd2lubmVyLnRyYW5zZmVyKGdhbWUucnVsZXMuamFja3BvdCk7CgkJcGF5QWZmaWxpYXRlcygpOwoJCW93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CgoJCS8vIFBvc3QgbmV3IGV2ZW50IHRvIEFjdGl2aXR5IGNvbnRyYWN0CgkJcG9zdEV2ZW50KF93aW5uZXIsIF93aW5uaW5nTnVtYmVyLCBnYW1lLnJ1bGVzLmphY2twb3QpOwoKCQlpZiAoIV9zdGFydE5ldykgewoJCQlzdGF0ZSA9IFN0YXRlLk5vdFJ1bm5pbmc7CgkJCXJldHVybjsKCQl9CgoJCW5leHRHYW1lKF9uZXh0UnVsZXMpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTG90dGVyeQoKCUdhbWUgZ2FtZTsKCUdhbWUgbGFzdEdhbWU7CQoKCWVudW0gUHVyY2hhc2VFcnJvciB7IEludmFsaWRUaWNrZXQsIE91dE9mVGlja2V0cywgTm90RW5vdWdoRnVuZHMsIExvdHRlcnlDbG9zZWQsIFRvb01hbnlUaWNrZXRzLCBUaWNrZXRVbmF2YWlsYWJsZSwgVW5rbm93biB9CglldmVudCBUaWNrZXRzUHVyY2hhc2VkKGFkZHJlc3MgYnV5ZXIsIHVpbnRbXSB0aWNrZXRzLCB1aW50W10gZmFpbGVkVGlja2V0cywgUHVyY2hhc2VFcnJvcltdIGVycm9ycyk7CglldmVudCBQdXJjaGFzZUZhaWxlZChhZGRyZXNzIGJ1eWVyLCBQdXJjaGFzZUVycm9yIGVycm9yKTsKCgkvKgoJICogUFVCTElDCgkgKiBCdXkgdGlja2V0cyBmb3IgdGhlIExvdHRlcnkgYnkgcGFzc2luZyBpbiBhbiBhcnJheSBvZiB0aWNrZXQgbnVtYmVycyAoc3RhcnRpbmcgYXQgMSBub3QgMCkKCSAqIFRoaXMgZnVuY3Rpb24gZG9lc24ndCByZXZlcnQgd2hlbiB0aWNrZXRzIGZhaWwgdG8gYmUgcHVyY2hhc2VkLCBpdCB0cmlnZ2VycyBldmVudHMgYW5kCgkgKiByZWZ1bmRzIHlvdSBmb3IgdGhlIHRpY2tldHMgdGhhdCBmYWlsZWQgdG8gYmUgcHVyY2hhc2VkLgoJICoKCSAqIEV2ZW50czoKCSAqIFRpY2tldHNQdXJjaGFzZWQ6IE9uZSBvciBtb3JlIHRpY2tldHMgd2VyZSBzdWNjZXNzZnVsbHkgcHVyY2hhc2VkCgkgKiBQdXJjaGFzZUZhaWxlZDogRmFpbGVkIHRvIHB1cmNoYXNlIGFsbCBvZiB0aGUgdGlja2V0cwoJICovCglmdW5jdGlvbiBwdXJjaGFzZVRpY2tldHModWludFtdIF90aWNrZXRzKSBwdWJsaWMgcGF5YWJsZSB7CgkJcHVyY2hhc2VUaWNrZXRzV2l0aFJlZmVycmFsKF90aWNrZXRzLCAwKTsKCX0KCgkvKgoJICogUFVCTElDCgkgKiBCdXkgdGlja2V0cyB3aXRoIGEgcmVmZXJyYWwgY29kZQoJICovCglmdW5jdGlvbiBwdXJjaGFzZVRpY2tldHNXaXRoUmVmZXJyYWwodWludFtdIF90aWNrZXRzLCB1aW50IF9hZmZpbGlhdGVDb2RlKSBwdWJsaWMgcGF5YWJsZSB7CgkJCgkJLy8gQ2hlY2sgZ2FtZSBzdGF0ZQoJCWlmIChzdGF0ZSAhPSBTdGF0ZS5SdW5uaW5nKSB7CgkJCWlmIChzdGF0ZSA9PSBTdGF0ZS5Ob3RSdW5uaW5nKSByZXR1cm4gZmFpbFB1cmNoYXNlKFB1cmNoYXNlRXJyb3IuTG90dGVyeUNsb3NlZCk7CgkJCXJldHVybiBmYWlsUHVyY2hhc2UoUHVyY2hhc2VFcnJvci5PdXRPZlRpY2tldHMpOwoJCX0KCgkJLy8gQ2hlY2sgc2VudCBmdW5kcwoJCWlmIChtc2cudmFsdWUgPCBfdGlja2V0cy5sZW5ndGggKiBnYW1lLnJ1bGVzLnRpY2tldFByaWNlKSAKCQkJcmV0dXJuIGZhaWxQdXJjaGFzZShQdXJjaGFzZUVycm9yLk5vdEVub3VnaEZ1bmRzKTsKCgkJdWludFtdIG1lbW9yeSBfdXNlclRpY2tldHMgPSBnZXRNeVRpY2tldHMoKTsKCgkJLy8gQ2hlY2sgbWF4IHRpY2tldHMgKGNoZWNrZWQgYWdhaW4gaW4gdGhlIGxvb3AgYmVsb3cpCgkJaWYgKF91c2VyVGlja2V0cy5sZW5ndGggPj0gZ2FtZS5ydWxlcy5tYXhUaWNrZXRzUGVyKQoJCQlyZXR1cm4gZmFpbFB1cmNoYXNlKFB1cmNoYXNlRXJyb3IuVG9vTWFueVRpY2tldHMpOwoKCQkvLyBTb21lIHRpY2tldHMgbWF5IGZhaWwgd2hpbGUgb3RoZXJzIHN1Y2NlZWQsIGxldHMga2VlcCB0cmFjayBvZiBhbGwgb2YgdGhhdCBzbyBpdAoJCS8vIGNhbiBiZSByZXR1cm5lZCB0byB0aGUgZnJvbnRlbmQgdXNlcgoJCXVpbnRbXSBtZW1vcnkgX3N1Y2Nlc3NmdWwgPSBuZXcgdWludFtdKF90aWNrZXRzLmxlbmd0aCk7CgkJdWludFtdIG1lbW9yeSBfZmFpbGVkID0gbmV3IHVpbnRbXShfdGlja2V0cy5sZW5ndGgpOwoJCVB1cmNoYXNlRXJyb3JbXSBtZW1vcnkgX2Vycm9ycyA9IG5ldyBQdXJjaGFzZUVycm9yW10oX3RpY2tldHMubGVuZ3RoKTsKCQl1aW50IF9zdWNjZXNzQ291bnQ7CgkJdWludCBfZXJyb3JDb3VudDsKCgkJZm9yKHVpbnQgaSA9IDA7IGkgPCBfdGlja2V0cy5sZW5ndGg7IGkrKykgewoJCQl1aW50IF90aWNrZXQgPSBfdGlja2V0c1tpXTsKCgkJCS8vIENoZWNrIHRoYXQgdGhlIHRpY2tldCBpcyBhIHZhbGlkIG51bWJlcgoJCQlpZiAoX3RpY2tldCA8PSAwIHx8IF90aWNrZXQgPiBnYW1lLnJ1bGVzLnNsb3RzKSB7CgkJCQlfZmFpbGVkW19lcnJvckNvdW50XSA9IF90aWNrZXQ7CgkJCQlfZXJyb3JzW19lcnJvckNvdW50XSA9IFB1cmNoYXNlRXJyb3IuSW52YWxpZFRpY2tldDsKCQkJCV9lcnJvckNvdW50Kys7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJLy8gQ2hlY2sgdGhhdCB0aGUgdGlja2V0IGlzIGF2YWlsYWJsZSBmb3IgcHVyY2hhc2UKCQkJaWYgKGdhbWUudGlja2V0c1tfdGlja2V0XSAhPSBhZGRyZXNzKDApKSB7CgkJCQlfZmFpbGVkW19lcnJvckNvdW50XSA9IF90aWNrZXQ7CgkJCQlfZXJyb3JzW19lcnJvckNvdW50XSA9IFB1cmNoYXNlRXJyb3IuVGlja2V0VW5hdmFpbGFibGU7CgkJCQlfZXJyb3JDb3VudCsrOwoJCQkJY29udGludWU7CgkJCX0KCgkJCS8vIENoZWNrIHRoYXQgdGhlIHVzZXIgaGFzbid0IHJlYWNoZWQgdGhlaXIgbWF4IHRpY2tldHMKCQkJaWYgKF91c2VyVGlja2V0cy5sZW5ndGggKyBfc3VjY2Vzc0NvdW50ID49IGdhbWUucnVsZXMubWF4VGlja2V0c1BlcikgewoJCQkJX2ZhaWxlZFtfZXJyb3JDb3VudF0gPSBfdGlja2V0OwoJCQkJX2Vycm9yc1tfZXJyb3JDb3VudF0gPSBQdXJjaGFzZUVycm9yLlRvb01hbnlUaWNrZXRzOwoJCQkJX2Vycm9yQ291bnQrKzsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQlnYW1lLnRpY2tldHNbX3RpY2tldF0gPSBtc2cuc2VuZGVyOwoJCQlnYW1lLnRpY2tldHNTb2xkKys7CgoJCQlfc3VjY2Vzc2Z1bFtfc3VjY2Vzc0NvdW50XSA9IF90aWNrZXQ7CgkJCV9zdWNjZXNzQ291bnQrKzsKCQl9CgoJCS8vIFJlZnVuZCBmb3IgZmFpbGVkIHRpY2tldHMKCQkvLyBDYW5ub3QgcmVmdW5kIG1vcmUgdGhhbiByZWNlaXZlZCwgd2lsbCBzZW5kIHdoYXQgd2FzIGdpdmVuIGlmIHJlZnVuZGluZyB0aGUgZnJlZSB0aWNrZXQKCQlpZiAoX2Vycm9yQ291bnQgPiAwKSByZWZ1bmQoX2Vycm9yQ291bnQgKiBnYW1lLnJ1bGVzLnRpY2tldFByaWNlKTsKCQkKCQkvLyBBZmZpbGlhdGVzCgkJdWludCBfdXNlckFmZmlsaWF0ZUNvZGUgPSB1c2VyQWZmaWxpYXRlKCk7CgkJaWYgKF9hZmZpbGlhdGVDb2RlICE9IDAgJiYgX3VzZXJBZmZpbGlhdGVDb2RlID09IDApCgkJCV91c2VyQWZmaWxpYXRlQ29kZSA9IHNldFVzZXJBZmZpbGlhdGUoX2FmZmlsaWF0ZUNvZGUpOwoJCWlmIChfdXNlckFmZmlsaWF0ZUNvZGUgIT0gMCkgYWRkQWZmaWxpYXRlKF91c2VyQWZmaWxpYXRlQ29kZSwgX3N1Y2Nlc3NDb3VudCk7CgoJCS8vIFRpY2tldHNQdXJjaGFzZWQobXNnLnNlbmRlciwgX25vcm1hbGl6ZWRTdWNjZXNzZnVsLCBfbm9ybWFsaXplZEZhaWx1cmVzLCBfbm9ybWFsaXplZEVycm9ycyk7CgkJVGlja2V0c1B1cmNoYXNlZChtc2cuc2VuZGVyLCBfc3VjY2Vzc2Z1bCwgX2ZhaWxlZCwgX2Vycm9ycyk7CgoJCS8vIElmIHRoZSBsYXN0IHRpY2tldCB3YXMgc29sZCwgc2lnbmFsIHRvIGZpbmQgYSB3aW5uZXIKCQlpZiAoZ2FtZS50aWNrZXRzU29sZCA+PSBnYW1lLnJ1bGVzLnNsb3RzKSBmaW5kV2lubmVyKCk7Cgl9CgoJLyoKCSAqIFBVQkxJQwoJICogR2V0IHRoZSB0aWNrZXRzIHlvdSBoYXZlIHB1cmNoYXNlZCBmb3IgdGhlIGN1cnJlbnQgZ2FtZQoJICovCglmdW5jdGlvbiBnZXRNeVRpY2tldHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50W10pIHsKCQl1aW50IF91c2VyVGlja2V0Q291bnQ7CgkJZm9yKHVpbnQgaSA9IDA7IGkgPCBnYW1lLnJ1bGVzLnNsb3RzOyBpKyspCgkJCWlmIChnYW1lLnRpY2tldHNbaSArIDFdID09IG1zZy5zZW5kZXIpIF91c2VyVGlja2V0Q291bnQgKz0gMTsKCgkJdWludFtdIG1lbW9yeSBfdGlja2V0cyA9IG5ldyB1aW50W10oX3VzZXJUaWNrZXRDb3VudCk7CgkJdWludCBfaW5kZXg7CgkJZm9yKHVpbnQgYiA9IDA7IGIgPCBnYW1lLnJ1bGVzLnNsb3RzOyBiKyspIHsKCQkJaWYgKGdhbWUudGlja2V0c1tiICsgMV0gPT0gbXNnLnNlbmRlcikgewoJCQkJX3RpY2tldHNbX2luZGV4XSA9IGIgKyAxOwoJCQkJX2luZGV4Kys7CgkJCX0KCQl9CgoJCXJldHVybiBfdGlja2V0czsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIEdhbWUKCglzdHJ1Y3QgR2FtZVJ1bGVzIHsKCQl1aW50IGphY2twb3Q7CgkJdWludCBzbG90czsKCQl1aW50IHRpY2tldFByaWNlOwoJCXVpbnQgbWF4VGlja2V0c1BlcjsKCX0KCglmdW5jdGlvbiB2ZXJpZmllZEdhbWVSdWxlcyh1aW50IF9qYWNrcG90LCB1aW50IF9zbG90cywgdWludCBfcHJpY2UsIHVpbnQgX21heCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChHYW1lUnVsZXMpIHsKCQlyZXF1aXJlKChfcHJpY2UgKiBfc2xvdHMpIC0gX2phY2twb3QgPiAxMDAwMDAwMDAwMDAwMDAwMDApOyAvLyBtYXJnaW4gaXMgZ3JlYXRlciB0aGFuIDAuMSBFVEggKGZvciBjYWxsYmFjayBmZWVzKQoJCXJlcXVpcmUoX21heCA8PSBfc2xvdHMpOwoJCXJldHVybiBHYW1lUnVsZXMoX2phY2twb3QsIF9zbG90cywgX3ByaWNlLCBfbWF4KTsKCX0KCglzdHJ1Y3QgR2FtZSB7CgkJdWludCBpZDsKCQlHYW1lUnVsZXMgcnVsZXM7CgkJbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIHRpY2tldHM7IC8vICh0aWNrZXROdW1iZXIgPT4gYnV5ZXJBZGRyZXNzKQoJCXVpbnQgdGlja2V0c1NvbGQ7CgkJR2FtZVJ1bGVzIG5leHRHYW1lUnVsZXM7IC8vIFRoZXNlIHJ1bGVzIHdpbGwgYmUgdXNlZCBpZiB0aGUgZ2FtZSByZWNyZWF0ZXMgaXRzZWxmCgkJYWRkcmVzcyB3aW5uZXI7CgkJdWludCB3aW5uaW5nTnVtYmVyOwoJCWJvb2wgbG9vcDsKCQl1aW50IHN0YXJ0ZWRBdDsKCQl1aW50IGZpbmlzaGVkQXQ7Cgl9CgoJLyoKCSAqIFBVQkxJQwoJICogR2V0IGluZm9ybWF0aW9uIHBlcnRhaW5pbmcgdG8gdGhlIGN1cnJlbnQgZ2FtZQoJICoKCSAqIHJldHVybnM6IChpZCwgamFja3BvdCwgdG90YWxUaWNrZXRzLCB0aWNrZXRzUmVtYWluaW5nLCB0aWNrZXRQcmljZSwgbWF4VGlja2V0cywgc3RhdGUsCgkgCQkJCQkJdGlja2V0c1tdLCB5b3VyVGlja2V0c1tdKQoJICogTk9URTogdGlja2V0c1tdIGlzIGFuIGFycmF5IG9mIGJvb2xlYW5zLCB0cnVlID0gYXZhaWxhYmxlIGFuZCBmYWxzZSA9IHNvbGQKCSAqLwoJZnVuY3Rpb24gZ2V0Q3VycmVudEdhbWUoKSBwdWJsaWMgdmlldyAKCQlyZXR1cm5zICh1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCBTdGF0ZSwgYm9vbFtdLCB1aW50W10pIHsKCQkKCQl1aW50IF9yZW1haW5pbmdUaWNrZXRzID0gZ2FtZS5ydWxlcy5zbG90cyAtIGdhbWUudGlja2V0c1NvbGQ7CgkJYm9vbFtdIG1lbW9yeSBfdGlja2V0cyA9IG5ldyBib29sW10oZ2FtZS5ydWxlcy5zbG90cyk7CgkJdWludFtdIG1lbW9yeSBfdXNlclRpY2tldHMgPSBnZXRNeVRpY2tldHMoKTsKCgkJZm9yICh1aW50IGkgPSAwOyBpIDwgZ2FtZS5ydWxlcy5zbG90czsgaSsrKQoJCQlfdGlja2V0c1tpXSA9IGdhbWUudGlja2V0c1tpICsgMV0gPT0gYWRkcmVzcygwKTsKCgkJcmV0dXJuIChnYW1lLmlkLCBnYW1lLnJ1bGVzLmphY2twb3QsIGdhbWUucnVsZXMuc2xvdHMsIF9yZW1haW5pbmdUaWNrZXRzLCAKCQkJZ2FtZS5ydWxlcy50aWNrZXRQcmljZSwgZ2FtZS5ydWxlcy5tYXhUaWNrZXRzUGVyLCBzdGF0ZSwgX3RpY2tldHMsIF91c2VyVGlja2V0cyk7Cgl9CgoJLyoKCSAqIFBVQkxJQwoJICogR2V0IGluZm9ybWF0aW9uIHBlcnRhaW5pbmcgdG8gdGhlIGxhc3QgZ2FtZQoJICoKCSAqIHJldHVybnM6IChpZCwgamFja3BvdCwgdG90YWxUaWNrZXRzLCB0aWNrZXRQcmljZSwgd2lubmVyLCBmaW5pc2hlZEF0KQoJICogTk9URTogdGlja2V0c1tdIGlzIGFuIGFycmF5IG9mIGJvb2xlYW5zLCB0cnVlID0gYXZhaWxhYmxlIGFuZCBmYWxzZSA9IHNvbGQKCSAqLwoJZnVuY3Rpb24gZ2V0TGFzdEdhbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQsIHVpbnQsIHVpbnQsIGFkZHJlc3MsIHVpbnQpIHsKCQlyZXR1cm4gKGxhc3RHYW1lLmlkLCBsYXN0R2FtZS5ydWxlcy5qYWNrcG90LCBsYXN0R2FtZS5ydWxlcy5zbG90cywgCgkJCWxhc3RHYW1lLnJ1bGVzLnRpY2tldFByaWNlLCBsYXN0R2FtZS53aW5uZXIsIGxhc3RHYW1lLmZpbmlzaGVkQXQpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gQWZmaWxpYXRlcwoKCXVpbnRbXSBjdXJyZW50R2FtZUFmZmlsaWF0ZXM7Cgl1aW50IG51bUFmZmlsaWF0ZXM7Cgl1aW50IGFmZmlsaWF0ZUN1dCA9IDI7IC8vIEV4YW1wbGU6IDIgPSAxLzIgKDUwJSksIDMgPSAxLzMgKDMzJSksIGV0Yy4KCglmdW5jdGlvbiBhZGRBZmZpbGlhdGUodWludCBfYWZmaWxpYXRlLCB1aW50IF90aWNrZXRDb3VudCkgaW50ZXJuYWwgewoJCWZvciAodWludCBpID0gMDsgaSA8IF90aWNrZXRDb3VudDsgaSsrKSB7CgkJCWlmIChudW1BZmZpbGlhdGVzID49IGN1cnJlbnRHYW1lQWZmaWxpYXRlcy5sZW5ndGgpIGN1cnJlbnRHYW1lQWZmaWxpYXRlcy5sZW5ndGggKz0gMTsKCQkJY3VycmVudEdhbWVBZmZpbGlhdGVzW251bUFmZmlsaWF0ZXMrK10gPSBfYWZmaWxpYXRlOwoJCX0KCX0KCglmdW5jdGlvbiBwYXlBZmZpbGlhdGVzKCkgaW50ZXJuYWwgewoJCXVpbnQgcHJvZml0ID0gKGdhbWUucnVsZXMuc2xvdHMgKiBnYW1lLnJ1bGVzLnRpY2tldFByaWNlKSAtIGdhbWUucnVsZXMuamFja3BvdDsKCQlpZiAocHJvZml0ID4gdGhpcy5iYWxhbmNlKSBwcm9maXQgPSB0aGlzLmJhbGFuY2U7CgoJCXVpbnQgX3BheW1lbnQgPSAocHJvZml0IC8gZ2FtZS5ydWxlcy5zbG90cykgLyBhZmZpbGlhdGVDdXQ7CgkJdWludCBfcG9vbCA9IF9wYXltZW50ICogbnVtQWZmaWxpYXRlczsKCQkKCQl1aW50W10gbWVtb3J5IF9hZmZpbGlhdGVzID0gbmV3IHVpbnRbXShudW1BZmZpbGlhdGVzKTsKCQl1aW50W10gbWVtb3J5IF9hbW91bnRzID0gbmV3IHVpbnRbXShudW1BZmZpbGlhdGVzKTsKCgkJZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtQWZmaWxpYXRlczsgaSsrKSB7CgkJCV9hZmZpbGlhdGVzW2ldID0gY3VycmVudEdhbWVBZmZpbGlhdGVzW2ldOwoJCQlfYW1vdW50c1tpXSA9IF9wYXltZW50OwoJCX0KCgkJLy8gcGF5b3V0IHRvIGdpdmVuIGFmZmlsaWF0ZXMgd2l0aCBnaXZlbiBhbW91bnRzCgkJaWYgKG51bUFmZmlsaWF0ZXMgPiAwKQoJCQlwYXlvdXRUb0FmZmlsaWF0ZXMoX2FmZmlsaWF0ZXMsIF9hbW91bnRzLCBfcG9vbCk7CgoJCS8vIENsZWFyIHRoZSBhZmZpbGlhdGVzCgkJbnVtQWZmaWxpYXRlcyA9IDA7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBVdGlsaXRpZXMKCglmdW5jdGlvbiByYW5kb21OdW1iZXJGb3VuZCh1aW50IF9udW1iZXIsIHVpbnQgX3NlY3JldCkgaW50ZXJuYWwgewoJCXJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUGVuZGluZyk7CgkJcmVxdWlyZShnYW1lLmlkID09IF9zZWNyZXQpOwoJCXJlcXVpcmUoX251bWJlciA+PSAxICYmIF9udW1iZXIgPD0gZ2FtZS5ydWxlcy5zbG90cyk7CgkJd2lubmVyQ2hvc2VuKF9udW1iZXIpOwoJfQoKCWZ1bmN0aW9uIGZhaWxQdXJjaGFzZShQdXJjaGFzZUVycm9yIF9lcnJvcikgaW50ZXJuYWwgewoJCVB1cmNoYXNlRmFpbGVkKG1zZy5zZW5kZXIsIF9lcnJvcik7CgkJcmVmdW5kKG1zZy52YWx1ZSk7Cgl9CgoJZnVuY3Rpb24gcmVmdW5kKHVpbnQgX2Ftb3VudCkgaW50ZXJuYWwgewoJCWlmIChfYW1vdW50ID4gMCAmJiBfYW1vdW50IDw9IG1zZy52YWx1ZSkgewoJCQltc2cuc2VuZGVyLnRyYW5zZmVyKF9hbW91bnQpOwoJCX0gZWxzZSBpZiAoX2Ftb3VudCA+IG1zZy52YWx1ZSkgewoJCQltc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CgkJfQoJfQp9'.
	

]
