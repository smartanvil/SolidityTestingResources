Class {
	#name : #SRTafe4eb0f65f94e1bae3c31b0f1dca72bc10b36aa,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTafe4eb0f65f94e1bae3c31b0f1dca72bc10b36aa >> base64 [
	^ 'LyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgovKioKICogSW50ZXJmYWNlIGZvciBkZWZpbmluZyBjcm93ZHNhbGUgcHJpY2luZy4KICovCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7CgogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogU2VsZiBjaGVjayBpZiBhbGwgcmVmZXJlbmNlcyBhcmUgY29ycmVjdGx5IHNldC4KICAgKgogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4KICAgKi8KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJpY2luZyB0ZWxscyBpZiB0aGlzIGlzIGEgcHJlc2FsZSBwdXJjaGFzZSBvciBub3QuCiAgICAgQHBhcmFtIHB1cmNoYXNlciBBZGRyZXNzIG9mIHRoZSBwdXJjaGFzZXIKICAgICBAcmV0dXJuIEZhbHNlIGJ5IGRlZmF1bHQsIHRydWUgaWYgYSBwcmVzYWxlIHB1cmNoYXNlcgogICAqLwogIGZ1bmN0aW9uIGlzUHJlc2FsZVB1cmNoYXNlKGFkZHJlc3MgcHVyY2hhc2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyIGluIHRoZSBtYWluIHRva2VuIHNhbGUgLSB0aGlzIG51bWJlciBleGNsdWRlcyBwcmVzYWxlCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCi8qKgogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4KICoKICogaHR0cHM6Ly9ibG9nLmFyYWdvbi5vbmUvbGlicmFyeS1kcml2ZW4tZGV2ZWxvcG1lbnQtaW4tc29saWRpdHktMmJlYmNhZjg4NzM2Iy43NTBnd3R3bGkKICoKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9BcmFnb25PbmUvemVwcGVsaW4tc29saWRpdHkvbWFzdGVyL2NvbnRyYWN0cy9TYWZlTWF0aExpYi5zb2wKICoKICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4KICoKICovCmxpYnJhcnkgU2FmZU1hdGhMaWIgewoKICBmdW5jdGlvbiB0aW1lcyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtaW51cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBwbHVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjPj1hKTsKICAgIHJldHVybiBjOwogIH0KCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qCiAqIEhhbHRhYmxlCiAqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICovCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgewogIGJvb2wgcHVibGljIGhhbHRlZDsKCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIHN0b3BOb25Pd25lcnNJbkVtZXJnZW5jeSB7CiAgICBpZiAoaGFsdGVkICYmIG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICB9Cgp9CgoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCi8qKgogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIHN1Y2Nlc2VmdWwgY3Jvd2RzYWxlLgogKgogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkKICogLSBNYWtlIHRva2VucyB0cmFuc2ZlcmFibGUKICogLSBldGMuCiAqLwpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsKCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7Cgp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuCiAqLwpjb250cmFjdCBGcmFjdGlvbmFsRVJDMjAgaXMgRVJDMjAgewoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCn0KCgoKLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGUKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZAogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgewoKICAvKiBNYXggaW52ZXN0bWVudCBjb3VudCB3aGVuIHdlIGFyZSBzdGlsbCBhbGxvd2VkIHRvIGNoYW5nZSB0aGUgbXVsdGlzaWcgYWRkcmVzcyAqLwogIHVpbnQgcHVibGljIE1BWF9JTlZFU1RNRU5UU19CRUZPUkVfTVVMVElTSUdfQ0hBTkdFID0gNTsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMCBwdWJsaWMgdG9rZW47CgogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovCiAgUHJpY2luZ1N0cmF0ZWd5IHB1YmxpYyBwcmljaW5nU3RyYXRlZ3k7CgogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLwogIEZpbmFsaXplQWdlbnQgcHVibGljIGZpbmFsaXplQWdlbnQ7CgogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLwogIHVpbnQgcHVibGljIG1pbmltdW1GdW5kaW5nR29hbDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogQ2FsY3VsYXRlIGluY29taW5nIGZ1bmRzIGZyb20gcHJlc2FsZSBjb250cmFjdHMgYW5kIGFkZHJlc3NlcyAqLwogIHVpbnQgcHVibGljIHByZXNhbGVXZWlSYWlzZWQgPSAwOwoKICAvKiBIb3cgbWFueSBkaXN0aW5jdCBhZGRyZXNzZXMgaGF2ZSBpbnZlc3RlZCAqLwogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOwoKICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSByZXR1cm5lZCBiYWNrIHRvIHRoZSBjb250cmFjdCBhZnRlciBhIGZhaWxlZCBjcm93ZGZ1bmQuICovCiAgdWludCBwdWJsaWMgbG9hZGVkUmVmdW5kID0gMDsKCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgZ2l2ZW4gYmFjayB0byBpbnZlc3RvcnMuKi8KICB1aW50IHB1YmxpYyB3ZWlSZWZ1bmRlZCA9IDA7CgogIC8qIEhhcyB0aGlzIGNyb3dkc2FsZSBiZWVuIGZpbmFsaXplZCAqLwogIGJvb2wgcHVibGljIGZpbmFsaXplZDsKCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIHVuaXF1ZSBjb250cmlidXRvciBpZCBmb3IgZWFjaCBjdXN0b21lciAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVDdXN0b21lcklkOwoKICAvKioKICAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLgogICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYXZlIGFjY2VwdGVkIHRlcm1zIG9uIHNhbGUgKG9uIHRoZSB3ZWIpLgogICAgKi8KICBib29sIHB1YmxpYyByZXF1aXJlZFNpZ25lZEFkZHJlc3M7CgogIC8qIFNlcnZlciBzaWRlIGFkZHJlc3MgdGhhdCBzaWduZWQgYWxsb3dlZCBjb250cmlidXRvcnMgKEV0aGVyZXVtIGFkZHJlc3NlcykgdGhhdCBjYW4gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSAqLwogIGFkZHJlc3MgcHVibGljIHNpZ25lckFkZHJlc3M7CgogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CgogIC8qKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwoKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2FsIG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7CgogIC8qKiBUaGlzIGlzIGZvciBtYW51bCB0ZXN0aW5nIGZvciB0aGUgaW50ZXJhY3Rpb24gZnJvbSBvd25lciB3YWxsZXQuIFlvdSBjYW4gc2V0IGl0IHRvIGFueSB2YWx1ZSBhbmQgaW5zcGVjdCB0aGlzIGluIGJsb2NrY2hhaW4gZXhwbG9yZXIgdG8gc2VlIHRoYXQgY3Jvd2RzYWxlIGludGVyYWN0aW9uIHdvcmtzLiAqLwogIHVpbnQgcHVibGljIG93bmVyVGVzdFZhbHVlOwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldAogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcGFzc2VkIHN0YXJ0IHRpbWUgeWV0CiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkCiAgICogLSBGYWlsdXJlOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBub3QgcmVhY2hlZCBiZWZvcmUgZW5kaW5nIHRpbWUKICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplZCBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVwYXJpbmcsIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmUsIEZpbmFsaXplZCwgUmVmdW5kaW5nfQoKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CgogIC8vIFJlZnVuZCB3YXMgcHJvY2Vzc2VkIGZvciBhIGNvbnRyaWJ1dG9yCiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsKCiAgLy8gVGhlIHJ1bGVzIHdlcmUgY2hhbmdlZCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0CiAgZXZlbnQgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQoYm9vbCBuZXdSZXF1aXJlQ3VzdG9tZXJJZCwgYm9vbCBuZXdSZXF1aXJlZFNpZ25lZEFkZHJlc3MsIGFkZHJlc3MgbmV3U2lnbmVyQWRkcmVzcyk7CgogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKCiAgLy8gQ3Jvd2RzYWxlIGVuZCB0aW1lIGhhcyBiZWVuIGNoYW5nZWQKICBldmVudCBFbmRzQXRDaGFuZ2VkKHVpbnQgbmV3RW5kc0F0KTsKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQsIHVpbnQgX21pbmltdW1GdW5kaW5nR29hbCkgewoKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICB0b2tlbiA9IEZyYWN0aW9uYWxFUkMyMChfdG9rZW4pOwoKICAgIHNldFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5KTsKCiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsKICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBpZihfc3RhcnQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIHN0YXJ0c0F0ID0gX3N0YXJ0OwoKICAgIGlmKF9lbmQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIGVuZHNBdCA9IF9lbmQ7CgogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMKICAgIGlmKHN0YXJ0c0F0ID49IGVuZHNBdCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIC8vIE1pbmltdW0gZnVuZGluZyBnb2FsIGNhbiBiZSB6ZXJvCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOwogIH0KCiAgLyoqCiAgICogRG9uJ3QgZXhwZWN0IHRvIGp1c3Qgc2VuZCBpbiBtb25leSBhbmQgZ2V0IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbigpIHBheWFibGUgewogICAgdGhyb3c7CiAgfQoKICAvKioKICAgKiBNYWtlIGFuIGludmVzdG1lbnQuCiAgICoKICAgKiBDcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgcHJpdmF0ZSB7CgogICAgLy8gRGV0ZXJtaW5lIGlmIGl0J3MgYSBnb29kIHRpbWUgdG8gYWNjZXB0IGludmVzdG1lbnQgZnJvbSB0aGlzIHBhcnRpY2lwYW50CiAgICBpZihnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0CiAgICAgIGlmKCFlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXSkgewogICAgICAgIHRocm93OwogICAgICB9CiAgICB9IGVsc2UgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5GdW5kaW5nKSB7CiAgICAgIC8vIFJldGFpbCBwYXJ0aWNpcGFudHMgY2FuIG9ubHkgY29tZSBpbiB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgcnVubmluZwogICAgICAvLyBwYXNzCiAgICB9IGVsc2UgewogICAgICAvLyBVbndhbnRlZCBzdGF0ZQogICAgICB0aHJvdzsKICAgIH0KCiAgICB1aW50IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBBY2NvdW50IHByZXNhbGUgc2FsZXMgc2VwYXJhdGVseSwgc28gdGhhdCB0aGV5IGRvIG5vdCBjb3VudCBhZ2FpbnN0IHByaWNpbmcgdHJhbmNoZXMKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBwcmljaW5nU3RyYXRlZ3kuY2FsY3VsYXRlUHJpY2Uod2VpQW1vdW50LCB3ZWlSYWlzZWQgLSBwcmVzYWxlV2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7CiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgaWYocHJpY2luZ1N0cmF0ZWd5LmlzUHJlc2FsZVB1cmNoYXNlKHJlY2VpdmVyKSkgewogICAgICAgIHByZXNhbGVXZWlSYWlzZWQgPSBwcmVzYWxlV2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIH0KCiAgICAvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwCiAgICBpZihpc0JyZWFraW5nQ2FwKHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCkpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CgogICAgLy8gUG9ja2V0IHRoZSBtb25leQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7CgogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFByZWFsbG9jYXRlIHRva2VucyBmb3IgdGhlIGVhcmx5IGludmVzdG9ycy4KICAgKgogICAqIFByZWFsbG9jYXRlZCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgYmVmb3JlIHRoZSBhY3R1YWwgY3Jvd2RzYWxlIG9wZW5zLgogICAqIFRoaXMgZnVuY3Rpb24gbWludHMgdGhlIHRva2VucyBhbmQgbW92ZXMgdGhlIGNyb3dkc2FsZSBuZWVkbGUuCiAgICoKICAgKiBJbnZlc3RvciBjb3VudCBpcyBub3QgaGFuZGxlZDsgaXQgaXMgYXNzdW1lZCB0aGlzIGdvZXMgZm9yIG11bHRpcGxlIGludmVzdG9ycwogICAqIGFuZCB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGhhcHBlbnMgb3V0c2lkZSB0aGUgc21hcnQgY29udHJhY3QgZmxvdy4KICAgKgogICAqIE5vIG1vbmV5IGlzIGV4Y2hhbmdlZCwgYXMgdGhlIGNyb3dkc2FsZSB0ZWFtIGFscmVhZHkgaGF2ZSByZWNlaXZlZCB0aGUgcGF5bWVudC4KICAgKgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFkZGVkIGludGVybmFsbHkKICAgKiBAcGFyYW0gd2VpUHJpY2UgUHJpY2Ugb2YgYSBzaW5nbGUgZnVsbCB0b2tlbiBpbiB3ZWkKICAgKgogICAqLwogIGZ1bmN0aW9uIHByZWFsbG9jYXRlKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgZnVsbFRva2VucywgdWludCB3ZWlQcmljZSkgcHVibGljIG9ubHlPd25lciB7CgogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMgKiAxMCoqdG9rZW4uZGVjaW1hbHMoKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UgKiBmdWxsVG9rZW5zOyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsKCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7CgogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CgogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCAwKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsKICAgICBpZiAoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpICE9IHNpZ25lckFkZHJlc3MpIHRocm93OwogICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aWNpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbAogICAgaWYocmVxdWlyZWRTaWduZWRBZGRyZXNzKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIGFsbG93cyBvbmx5IHNlcnZlci1zaWRlIHNpZ25lZCBwYXJ0aWNpcGFudHMKICAgIGludmVzdEludGVybmFsKGFkZHIsIDApOwogIH0KCiAgLyoqCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllciBhbmQgY2xlYXIgaGlzIGFkZHJlc3MuCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoU2lnbmVkQWRkcmVzcyh1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsKICB9CgogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSBzZW5kZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3QobXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLgogICAqCiAgICogVGhlIG93bmVyIGNhbiB0cmlnZ3JlIGEgY2FsbCB0aGUgY29udHJhY3QgdGhhdCBwcm92aWRlcyBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CgogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQKICAgIGlmKGZpbmFsaXplZCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBGaW5hbGl6aW5nIGlzIG9wdGlvbmFsLiBXZSBvbmx5IGNhbGwgaXQgaWYgd2UgYXJlIGdpdmVuIGEgZmluYWxpemluZyBhZ2VudC4KICAgIGlmKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgIT0gMCkgewogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7CiAgICB9CgogICAgZmluYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgZmluYWxpemUgYWdlbnQuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsKICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOwoKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighZmluYWxpemVBZ2VudC5pc0ZpbmFsaXplQWdlbnQoKSkgewogICAgICB0aHJvdzsKICAgIH0KICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgb25seU93bmVyIHsKICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBfc2lnbmVyQWRkcmVzczsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYWRkcmVzc2VzIHRvIGRvIGVhcmx5IHBhcnRpY2lwYXRpb24uCiAgICoKICAgKiBUT0RPOiBGaXggc3BlbGxpbmcgZXJyb3IgaW4gdGhlIG5hbWUKICAgKi8KICBmdW5jdGlvbiBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgb25seU93bmVyIHsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBzdGF0dXM7CiAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgY3Jvd2RzYWxlIG93bmVyIHRvIGNsb3NlIGVhcmx5IG9yIGV4dGVuZCB0aGUgY3Jvd2RzYWxlLgogICAqCiAgICogVGhpcyBpcyB1c2VmdWwgZS5nLiBmb3IgYSBtYW51YWwgc29mdCBjYXAgaW1wbGVtZW50YXRpb246CiAgICogLSBhZnRlciBYIGFtb3VudCBpcyByZWFjaGVkIGRldGVybWluZSBtYW51YWwgY2xvc2luZwogICAqCiAgICogVGhpcyBtYXkgcHV0IHRoZSBjcm93ZHNhbGUgdG8gYW4gaW52YWxpZCBzdGF0ZSwKICAgKiBidXQgd2UgdHJ1c3Qgb3duZXJzIGtub3cgd2hhdCB0aGV5IGFyZSBkb2luZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7CgogICAgaWYobm93ID4gdGltZSkgewogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QKICAgIH0KCiAgICBlbmRzQXQgPSB0aW1lOwogICAgRW5kc0F0Q2hhbmdlZChlbmRzQXQpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gKHJlKXNldCBwcmljaW5nIHN0cmF0ZWd5LgogICAqCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHRoZSBzZXQsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLgogICAqLwogIGZ1bmN0aW9uIHNldFByaWNpbmdTdHJhdGVneShQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSkgb25seU93bmVyIHsKICAgIHByaWNpbmdTdHJhdGVneSA9IF9wcmljaW5nU3RyYXRlZ3k7CgogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQKICAgIGlmKCFwcmljaW5nU3RyYXRlZ3kuaXNQcmljaW5nU3RyYXRlZ3koKSkgewogICAgICB0aHJvdzsKICAgIH0KICB9CgogIC8qKgogICAqIEFsbG93IHRvIGNoYW5nZSB0aGUgdGVhbSBtdWx0aXNpZyBhZGRyZXNzIGluIHRoZSBjYXNlIG9mIGVtZXJnZW5jeS4KICAgKgogICAqIFRoaXMgYWxsb3dzIHRvIHNhdmUgYSBkZXBsb3llZCBjcm93ZHNhbGUgd2FsbGV0IGluIHRoZSBjYXNlIHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgYmVndW4KICAgKiAod2UgaGF2ZSBkb25lIG9ubHkgZmV3IHRlc3QgdHJhbnNhY3Rpb25zKS4gQWZ0ZXIgdGhlIGNyb3dkc2FsZSBpcyBnb2luZwogICAqIHRoZW4gbXVsdGlzaWcgYWRkcmVzcyBzdGF5cyBsb2NrZWQgZm9yIHRoZSBzYWZldHkgcmVhc29ucy4KICAgKi8KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgIC8vIENoYW5nZQogICAgaWYoaW52ZXN0b3JDb3VudCA+IE1BWF9JTlZFU1RNRU5UU19CRUZPUkVfTVVMVElTSUdfQ0hBTkdFKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIG11bHRpc2lnV2FsbGV0ID0gYWRkcjsKICB9CgogIC8qKgogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4KICAgKgogICAqIFRoZSB0ZWFtIGNhbiB0cmFuc2ZlciB0aGUgZnVuZHMgYmFjayBvbiB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIGNhc2UgdGhlIG1pbmltdW0gZ29hbCB3YXMgbm90IHJlYWNoZWQuLgogICAqLwogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSBpblN0YXRlKFN0YXRlLkZhaWx1cmUpIHsKICAgIGlmKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsKICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5wbHVzKG1zZy52YWx1ZSk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZC4KICAgKgogICAqIE5vdGUgdGhhdCBhbnkgcmVmdW5kcyBmcm9tIHByb3h5IGJ1eWVycyBzaG91bGQgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5LAogICAqIGFuZCBub3QgdGhyb3VnaCB0aGlzIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgewogICAgdWludDI1NiB3ZWlWYWx1ZSA9IGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl07CiAgICBpZiAod2VpVmFsdWUgPT0gMCkgdGhyb3c7CiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsKICAgIHdlaVJlZnVuZGVkID0gd2VpUmVmdW5kZWQucGx1cyh3ZWlWYWx1ZSk7CiAgICBSZWZ1bmQobXNnLnNlbmRlciwgd2VpVmFsdWUpOwogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyByYWlzZWQgZW5vdWdoIG1vbmV5IHRvIGJlIGEgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBpc01pbmltdW1Hb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHJlYWNoZWQpIHsKICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gbWluaW11bUZ1bmRpbmdHb2FsOwogIH0KCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLgogICAqLwogIGZ1bmN0aW9uIGlzRmluYWxpemVyU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBmaW5hbGl6ZUFnZW50LmlzU2FuZSgpOwogIH0KCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLgogICAqLwogIGZ1bmN0aW9uIGlzUHJpY2luZ1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7CiAgICByZXR1cm4gcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKTsKICB9CgogIC8qKgogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICoKICAgKiBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlLCBzbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLgogICAqLwogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7CiAgICBpZihmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKGZpbmFsaXplQWdlbnQpID09IDApIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghZmluYWxpemVBZ2VudC5pc1NhbmUoKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKCFwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOwogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDw9IGVuZHNBdCAmJiAhaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5GdW5kaW5nOwogICAgZWxzZSBpZiAoaXNNaW5pbXVtR29hbFJlYWNoZWQoKSkgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgICBlbHNlIGlmICghaXNNaW5pbXVtR29hbFJlYWNoZWQoKSAmJiB3ZWlSYWlzZWQgPiAwICYmIGxvYWRlZFJlZnVuZCA+PSB3ZWlSYWlzZWQpIHJldHVybiBTdGF0ZS5SZWZ1bmRpbmc7CiAgICBlbHNlIHJldHVybiBTdGF0ZS5GYWlsdXJlOwogIH0KCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLwogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgewogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7CiAgfQoKICAvKiogSW50ZXJmYWNlIG1hcmtlci4gKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93OwogICAgXzsKICB9CgoKICAvLwogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucwogIC8vCgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLgogICAqCiAgICoKICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLgogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkKICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4KICAgKgogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgb3IgdHJhbnNmZXIgaXNzdWVkIHRva2VucyB0byB0aGUgaW52ZXN0b3IgZGVwZW5kaW5nIG9uIHRoZSBjYXAgbW9kZWwuCiAgICovCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGU7Cn0KCgoKCgovLy8gQGRldiBUaW1lIG1pbGVzdG9uZSBiYXNlZCBwcmljaW5nIHdpdGggc3BlY2lhbCBzdXBwb3J0IGZvciBwcmUtaWNvIGRlYWxzLgpjb250cmFjdCBNaWxlc3RvbmVQcmljaW5nIGlzIFByaWNpbmdTdHJhdGVneSwgT3duYWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50OwoKICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfTUlMRVNUT05FID0gMTA7CgogIC8vIFRoaXMgY29udGFpbnMgYWxsIHByZS1JQ08gYWRkcmVzc2VzLCBhbmQgdGhlaXIgcHJpY2VzICh3ZWlzIHBlciB0b2tlbikKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwcmVpY29BZGRyZXNzZXM7CgogIC8qKgogICogRGVmaW5lIHByaWNpbmcgc2NoZWR1bGUgdXNpbmcgbWlsZXN0b25lcy4KICAqLwogIHN0cnVjdCBNaWxlc3RvbmUgewoKICAgICAgLy8gVU5JWCB0aW1lc3RhbXAgd2hlbiB0aGlzIG1pbGVzdG9uZSBraWNrcyBpbgogICAgICB1aW50IHRpbWU7CgogICAgICAvLyBIb3cgbWFueSB0b2tlbnMgcGVyIHNhdG9zaGkgeW91IHdpbGwgZ2V0IGFmdGVyIHRoaXMgbWlsZXN0b25lIGhhcyBiZWVuIHBhc3NlZAogICAgICB1aW50IHByaWNlOwogIH0KCiAgLy8gU3RvcmUgbWlsZXN0b25lcyBpbiBhIGZpeGVkIGFycmF5LCBzbyB0aGF0IGl0IGNhbiBiZSBzZWVuIGluIGEgYmxvY2tjaGFpbiBleHBsb3JlcgogIC8vIE1pbGVzdG9uZSAwIGlzIGFsd2F5cyAoMCwgMCkKICAvLyAoVE9ETzogY2hhbmdlIHRoaXMgd2hlbiB3ZSBjb25maXJtIGR5bmFtaWMgYXJyYXlzIGFyZSBleHBsb3JhYmxlKQogIE1pbGVzdG9uZVsxMF0gcHVibGljIG1pbGVzdG9uZXM7CgogIC8vIEhvdyBtYW55IGFjdGl2ZSBtaWxlc3RvbmVzIHdlIGhhdmUKICB1aW50IHB1YmxpYyBtaWxlc3RvbmVDb3VudDsKCiAgLy8vIEBkZXYgQ29udHJ1Y3Rpb24sIGNyZWF0aW5nIGEgbGlzdCBvZiBtaWxlc3RvbmVzCiAgLy8vIEBwYXJhbSBfbWlsZXN0b25lcyB1aW50W10gbWlsZXN0b25lcyBQYWlycyBvZiAodGltZSwgcHJpY2UpCiAgZnVuY3Rpb24gTWlsZXN0b25lUHJpY2luZyh1aW50W10gX21pbGVzdG9uZXMpIHsKICAgIC8vIE5lZWQgdG8gaGF2ZSB0dXBsZXMsIGxlbmd0aCBjaGVjawogICAgaWYoX21pbGVzdG9uZXMubGVuZ3RoICUgMiA9PSAxIHx8IF9taWxlc3RvbmVzLmxlbmd0aCA+PSBNQVhfTUlMRVNUT05FKjIpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgbWlsZXN0b25lQ291bnQgPSBfbWlsZXN0b25lcy5sZW5ndGggLyAyOwoKICAgIHVpbnQgbGFzdFRpbWVzdGFtcCA9IDA7CgogICAgZm9yKHVpbnQgaT0wOyBpPF9taWxlc3RvbmVzLmxlbmd0aC8yOyBpKyspIHsKICAgICAgbWlsZXN0b25lc1tpXS50aW1lID0gX21pbGVzdG9uZXNbaSoyXTsKICAgICAgbWlsZXN0b25lc1tpXS5wcmljZSA9IF9taWxlc3RvbmVzW2kqMisxXTsKCiAgICAgIC8vIE5vIGludmFsaWQgc3RlcHMKICAgICAgaWYoKGxhc3RUaW1lc3RhbXAgIT0gMCkgJiYgKG1pbGVzdG9uZXNbaV0udGltZSA8PSBsYXN0VGltZXN0YW1wKSkgewogICAgICAgIHRocm93OwogICAgICB9CgogICAgICBsYXN0VGltZXN0YW1wID0gbWlsZXN0b25lc1tpXS50aW1lOwogICAgfQoKICAgIC8vIExhc3QgbWlsZXN0b25lIHByaWNlIG11c3QgYmUgemVybywgdGVybWluYXRpbmcgdGhlIGNyb3dkYWxlCiAgICBpZihtaWxlc3RvbmVzW21pbGVzdG9uZUNvdW50LTFdLnByaWNlICE9IDApIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvLy8gQGRldiBUaGlzIGlzIGludm9rZWQgb25jZSBmb3IgZXZlcnkgcHJlLUlDTyBhZGRyZXNzLCBzZXQgcHJpY2VQZXJUb2tlbgogIC8vLyAgICAgIHRvIDAgdG8gZGlzYWJsZQogIC8vLyBAcGFyYW0gcHJlaWNvQWRkcmVzcyBQcmVzYWxlRnVuZENvbGxlY3RvciBhZGRyZXNzCiAgLy8vIEBwYXJhbSBwcmljZVBlclRva2VuIEhvdyBtYW55IHdlaXMgb25lIHRva2VuIGNvc3QgZm9yIHByZS1pY28gaW52ZXN0b3JzCiAgZnVuY3Rpb24gc2V0UHJlaWNvQWRkcmVzcyhhZGRyZXNzIHByZWljb0FkZHJlc3MsIHVpbnQgcHJpY2VQZXJUb2tlbikKICAgIHB1YmxpYwogICAgb25seU93bmVyCiAgewogICAgcHJlaWNvQWRkcmVzc2VzW3ByZWljb0FkZHJlc3NdID0gcHJpY2VQZXJUb2tlbjsKICB9CgogIC8vLyBAZGV2IEl0ZXJhdGUgdGhyb3VnaCBtaWxlc3RvbmVzLiBZb3UgcmVhY2ggZW5kIG9mIG1pbGVzdG9uZXMgd2hlbiBwcmljZSA9IDAKICAvLy8gQHJldHVybiB0dXBsZSAodGltZSwgcHJpY2UpCiAgZnVuY3Rpb24gZ2V0TWlsZXN0b25lKHVpbnQgbikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQsIHVpbnQpIHsKICAgIHJldHVybiAobWlsZXN0b25lc1tuXS50aW1lLCBtaWxlc3RvbmVzW25dLnByaWNlKTsKICB9CgogIGZ1bmN0aW9uIGdldEZpcnN0TWlsZXN0b25lKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChNaWxlc3RvbmUpIHsKICAgIHJldHVybiBtaWxlc3RvbmVzWzBdOwogIH0KCiAgZnVuY3Rpb24gZ2V0TGFzdE1pbGVzdG9uZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoTWlsZXN0b25lKSB7CiAgICByZXR1cm4gbWlsZXN0b25lc1ttaWxlc3RvbmVDb3VudC0xXTsKICB9CgogIGZ1bmN0aW9uIGdldFByaWNpbmdTdGFydHNBdCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZ2V0Rmlyc3RNaWxlc3RvbmUoKS50aW1lOwogIH0KCiAgZnVuY3Rpb24gZ2V0UHJpY2luZ0VuZHNBdCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZ2V0TGFzdE1pbGVzdG9uZSgpLnRpbWU7CiAgfQoKICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBfY3Jvd2RzYWxlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICBDcm93ZHNhbGUgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlKF9jcm93ZHNhbGUpOwogICAgcmV0dXJuIGNyb3dkc2FsZS5zdGFydHNBdCgpID09IGdldFByaWNpbmdTdGFydHNBdCgpICYmIGNyb3dkc2FsZS5lbmRzQXQoKSA9PSBnZXRQcmljaW5nRW5kc0F0KCk7CiAgfQoKICAvLy8gQGRldiBHZXQgdGhlIGN1cnJlbnQgbWlsZXN0b25lIG9yIGJhaWwgb3V0IGlmIHdlIGFyZSBub3QgaW4gdGhlIG1pbGVzdG9uZSBwZXJpb2RzLgogIC8vLyBAcmV0dXJuIHtbdHlwZV19IFtkZXNjcmlwdGlvbl0KICBmdW5jdGlvbiBnZXRDdXJyZW50TWlsZXN0b25lKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChNaWxlc3RvbmUpIHsKICAgIHVpbnQgaTsKCiAgICBmb3IoaT0wOyBpPG1pbGVzdG9uZXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYobm93IDwgbWlsZXN0b25lc1tpXS50aW1lKSB7CiAgICAgICAgcmV0dXJuIG1pbGVzdG9uZXNbaS0xXTsKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHByaWNlLgogIC8vLyBAcmV0dXJuIFRoZSBjdXJyZW50IHByaWNlIG9yIDAgaWYgd2UgYXJlIG91dHNpZGUgbWlsZXN0b25lIHBlcmlvZAogIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgcmV0dXJuIGdldEN1cnJlbnRNaWxlc3RvbmUoKS5wcmljZTsKICB9CgogIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgY3VycmVudCBwcmljZSBmb3IgYnV5IGluIGFtb3VudC4KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKCiAgICB1aW50IG11bHRpcGxpZXIgPSAxMCAqKiBkZWNpbWFsczsKCiAgICAvLyBUaGlzIGludmVzdG9yIGlzIGNvbWluZyB0aHJvdWdoIHByZS1pY28KICAgIGlmKHByZWljb0FkZHJlc3Nlc1ttc2dTZW5kZXJdID4gMCkgewogICAgICByZXR1cm4gdmFsdWUudGltZXMobXVsdGlwbGllcikgLyBwcmVpY29BZGRyZXNzZXNbbXNnU2VuZGVyXTsKICAgIH0KCiAgICB1aW50IHByaWNlID0gZ2V0Q3VycmVudFByaWNlKCk7CiAgICByZXR1cm4gdmFsdWUudGltZXMobXVsdGlwbGllcikgLyBwcmljZTsKICB9CgogIGZ1bmN0aW9uIGlzUHJlc2FsZVB1cmNoYXNlKGFkZHJlc3MgcHVyY2hhc2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgaWYocHJlaWNvQWRkcmVzc2VzW3B1cmNoYXNlcl0gPiAwKQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGVsc2UKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OyAvLyBObyBtb25leSBvbiB0aGlzIGNvbnRyYWN0CiAgfQoKfQ=='.
	

]
