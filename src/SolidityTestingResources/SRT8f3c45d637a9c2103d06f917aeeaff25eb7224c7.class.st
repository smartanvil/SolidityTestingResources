Class {
	#name : #SRT8f3c45d637a9c2103d06f917aeeaff25eb7224c7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT8f3c45d637a9c2103d06f917aeeaff25eb7224c7 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gVG9rZW5UcmFkZXJGYWN0b3J5Ci8vCi8vIERlY2VudHJhbGlzZWQgdHJ1c3RsZXNzIEVSQzIwLWNvbXBsaWFudCB0b2tlbiB0byBFVEggZXhjaGFuZ2UgY29udHJhY3QKLy8gb24gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4uCi8vCi8vIE5vdGUgdGhhdCB0aGlzIFRva2VuVHJhZGVyIGNhbm5vdCBiZSB1c2VkIHdpdGggdGhlIEdvbGVtIE5ldHdvcmsgVG9rZW4KLy8gZGlyZWN0bHkgYXMgdGhlIHRva2VuIGRvZXMgbm90IGltcGxlbWVudCB0aGUgRVJDMjAKLy8gdHJhbnNmZXJGcm9tKC4uLiksIGFwcHJvdmUoLi4uKSBhbmQgYWxsb3dhbmNlKC4uLikgbWV0aG9kcwovLwovLyBIaXN0b3J5OgovLyAgIEphbiAyNSAyMDE3IC0gQlBCIEFkZGVkIG1ha2VyVHJhbnNmZXJBc3NldCguLi4pIGFuZAovLyAgICAgICAgICAgICAgICAgICAgIG1ha2VyVHJhbnNmZXJFdGhlciguLi4pCi8vICAgRmViIDA1IDIwMTcgLSBCUEIgQnVnIGZpeCBpbiB0aGUgY2hhbmdlIGNhbGN1bGF0aW9uIGZvciB0aGUgVW5pY29ybgovLyAgICAgICAgICAgICAgICAgICAgIHRva2VuIHdpdGggbmF0dXJhbCBudW1iZXIgMQovLyAgIEZlYiAwOCAyMDE3IC0gQlBCL0pMIFJlbmFtZWQgZXRoZXJWYWx1ZU9mVG9rZW5zVG9TZWxsIHRvCi8vICAgICAgICAgICAgICAgICAgICAgYW1vdW50T2ZUb2tlbnNUb1NlbGwgaW4gdGFrZXJTZWxsQXNzZXQoLi4uKSB0bwovLyAgICAgICAgICAgICAgICAgICAgIGJldHRlciBkZXNjcmliZSB0aGUgcGFyYW1ldGVyCi8vICAgICAgICAgICAgICAgICAgICAgQWRkZWQgY2hlY2sgaW4gY3JlYXRlVHJhZGVDb250cmFjdCguLi4pIHRvIHByZXZlbnQKLy8gICAgICAgICAgICAgICAgICAgICBHTlRzIGZyb20gYmVpbmcgdXNlZCB3aXRoIHRoaXMgY29udHJhY3QuIFRoZSBhc3NldAovLyAgICAgICAgICAgICAgICAgICAgIHRva2VuIHdpbGwgbmVlZCB0byBoYXZlIGFuIGFsbG93YW5jZSguLi4pIGZ1bmN0aW9uLgovLwovLyBFbmpveS4gKGMpIEpvbm55TGF0dGUgJiBCb2treVBvb0JhaCAyMDE3LiBUaGUgTUlUIGxpY2VuY2UuCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCmNvbnRyYWN0IEVSQzIwIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCB0b3RhbFN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKfQoKY29udHJhY3QgT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lck9yVG9rZW5UcmFkZXJXaXRoU2FtZU93bmVyIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBUb2tlblRyYWRlcihtc2cuc2VuZGVyKS5vd25lcigpICE9IG93bmVyKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQp9CgovLyBjb250cmFjdCBjYW4gYnV5IG9yIHNlbGwgdG9rZW5zIGZvciBFVEgKLy8gcHJpY2VzIGFyZSBpbiBhbW91bnQgb2Ygd2VpIHBlciBiYXRjaCBvZiB0b2tlbiB1bml0cwoKY29udHJhY3QgVG9rZW5UcmFkZXIgaXMgT3duZWQgewoKICAgIGFkZHJlc3MgcHVibGljIGFzc2V0OyAgICAgICAvLyBhZGRyZXNzIG9mIHRva2VuCiAgICB1aW50MjU2IHB1YmxpYyBidXlQcmljZTsgICAgLy8gY29udHJhY3QgYnV5cyBsb3RzIG9mIHRva2VuIGF0IHRoaXMgcHJpY2UKICAgIHVpbnQyNTYgcHVibGljIHNlbGxQcmljZTsgICAvLyBjb250cmFjdCBzZWxscyBsb3RzIGF0IHRoaXMgcHJpY2UKICAgIHVpbnQyNTYgcHVibGljIHVuaXRzOyAgICAgICAvLyBsb3Qgc2l6ZSAodG9rZW4td2VpKQoKICAgIGJvb2wgcHVibGljIGJ1eXNUb2tlbnM7ICAgICAvLyBpcyBjb250cmFjdCBidXlpbmcKICAgIGJvb2wgcHVibGljIHNlbGxzVG9rZW5zOyAgICAvLyBpcyBjb250cmFjdCBzZWxsaW5nCgogICAgZXZlbnQgQWN0aXZhdGVkRXZlbnQoYm9vbCBidXlzLCBib29sIHNlbGxzKTsKICAgIGV2ZW50IE1ha2VyRGVwb3NpdGVkRXRoZXIodWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWFrZXJXaXRoZHJld0Fzc2V0KHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IE1ha2VyVHJhbnNmZXJyZWRBc3NldChhZGRyZXNzIHRvVG9rZW5UcmFkZXIsIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IE1ha2VyV2l0aGRyZXdFUkMyMFRva2VuKGFkZHJlc3MgdG9rZW5BZGRyZXNzLCB1aW50MjU2IHRva2Vucyk7CiAgICBldmVudCBNYWtlcldpdGhkcmV3RXRoZXIodWludDI1NiBldGhlcnMpOwogICAgZXZlbnQgTWFrZXJUcmFuc2ZlcnJlZEV0aGVyKGFkZHJlc3MgdG9Ub2tlblRyYWRlciwgdWludDI1NiBldGhlcnMpOwogICAgZXZlbnQgVGFrZXJCb3VnaHRBc3NldChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgZXRoZXJzU2VudCwKICAgICAgICB1aW50MjU2IGV0aGVyc1JldHVybmVkLCB1aW50MjU2IHRva2Vuc0JvdWdodCk7CiAgICBldmVudCBUYWtlclNvbGRBc3NldChhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50MjU2IGFtb3VudE9mVG9rZW5zVG9TZWxsLAogICAgICAgIHVpbnQyNTYgdG9rZW5zU29sZCwgdWludDI1NiBldGhlclZhbHVlT2ZUb2tlbnNTb2xkKTsKCiAgICAvLyBDb25zdHJ1Y3RvciAtIG9ubHkgdG8gYmUgY2FsbGVkIGJ5IHRoZSBUb2tlblRyYWRlckZhY3RvcnkgY29udHJhY3QKICAgIGZ1bmN0aW9uIFRva2VuVHJhZGVyICgKICAgICAgICBhZGRyZXNzIF9hc3NldCwKICAgICAgICB1aW50MjU2IF9idXlQcmljZSwKICAgICAgICB1aW50MjU2IF9zZWxsUHJpY2UsCiAgICAgICAgdWludDI1NiBfdW5pdHMsCiAgICAgICAgYm9vbCAgICBfYnV5c1Rva2VucywKICAgICAgICBib29sICAgIF9zZWxsc1Rva2VucwogICAgKSB7CiAgICAgICAgYXNzZXQgICAgICAgPSBfYXNzZXQ7CiAgICAgICAgYnV5UHJpY2UgICAgPSBfYnV5UHJpY2U7CiAgICAgICAgc2VsbFByaWNlICAgPSBfc2VsbFByaWNlOwogICAgICAgIHVuaXRzICAgICAgID0gX3VuaXRzOwogICAgICAgIGJ1eXNUb2tlbnMgID0gX2J1eXNUb2tlbnM7CiAgICAgICAgc2VsbHNUb2tlbnMgPSBfc2VsbHNUb2tlbnM7CiAgICAgICAgQWN0aXZhdGVkRXZlbnQoYnV5c1Rva2Vucywgc2VsbHNUb2tlbnMpOwogICAgfQoKICAgIC8vIE1ha2VyIGNhbiBhY3RpdmF0ZSBvciBkZWFjdGl2YXRlIHRoaXMgY29udHJhY3QncyBidXlpbmcgYW5kCiAgICAvLyBzZWxsaW5nIHN0YXR1cwogICAgLy8KICAgIC8vIFRoZSBBY3RpdmF0ZWRFdmVudCgpIGV2ZW50IGlzIGxvZ2dlZCB3aXRoIHRoZSBmb2xsb3dpbmcKICAgIC8vIHBhcmFtZXRlcjoKICAgIC8vICAgYnV5c1Rva2VucyAgIHRoaXMgY29udHJhY3QgY2FuIGJ1eSBhc3NldCB0b2tlbnMKICAgIC8vICAgc2VsbHNUb2tlbnMgIHRoaXMgY29udHJhY3QgY2FuIHNlbGwgYXNzZXQgdG9rZW5zCiAgICAvLwogICAgZnVuY3Rpb24gYWN0aXZhdGUgKAogICAgICAgIGJvb2wgX2J1eXNUb2tlbnMsCiAgICAgICAgYm9vbCBfc2VsbHNUb2tlbnMKICAgICkgb25seU93bmVyIHsKICAgICAgICBidXlzVG9rZW5zICA9IF9idXlzVG9rZW5zOwogICAgICAgIHNlbGxzVG9rZW5zID0gX3NlbGxzVG9rZW5zOwogICAgICAgIEFjdGl2YXRlZEV2ZW50KGJ1eXNUb2tlbnMsIHNlbGxzVG9rZW5zKTsKICAgIH0KCiAgICAvLyBNYWtlciBjYW4gZGVwb3NpdCBldGhlcnMgdG8gdGhpcyBjb250cmFjdCBzbyB0aGlzIGNvbnRyYWN0CiAgICAvLyBjYW4gYnV5IGFzc2V0IHRva2Vucy4KICAgIC8vCiAgICAvLyBNYWtlciBkZXBvc2l0cyBhc3NldCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdCBieSBjYWxsaW5nIHRoZQogICAgLy8gYXNzZXQncyB0cmFuc2ZlcigpIG1ldGhvZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycwogICAgLy8gICBfdG8gICAgIGlzIHRoZSBhZGRyZXNzIG9mIFRISVMgY29udHJhY3QKICAgIC8vICAgX3ZhbHVlICBpcyB0aGUgbnVtYmVyIG9mIGFzc2V0IHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8KICAgIC8vIFRha2VyIE1VU1QgTk9UIHNlbmQgdG9rZW5zIGRpcmVjdGx5IHRvIHRoaXMgY29udHJhY3QuIFRha2VycwogICAgLy8gTVVTVCB1c2UgdGhlIHRha2VyU2VsbEFzc2V0KCkgbWV0aG9kIHRvIHNlbGwgYXNzZXQgdG9rZW5zCiAgICAvLyB0byB0aGlzIGNvbnRyYWN0CiAgICAvLwogICAgLy8gTWFrZXIgY2FuIGFsc28gdHJhbnNmZXIgZXRoZXJzIGZyb20gb25lIFRva2VuVHJhZGVyIGNvbnRyYWN0CiAgICAvLyB0byBhbm90aGVyIFRva2VuVHJhZGVyIGNvbnRyYWN0LCBib3RoIG93bmVkIGJ5IHRoZSBNYWtlcgogICAgLy8KICAgIC8vIFRoZSBNYWtlckRlcG9zaXRlZEV0aGVyKCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZwogICAgLy8gcGFyYW1ldGVyOgogICAgLy8gICBldGhlcnMgIGlzIHRoZSBudW1iZXIgb2YgZXRoZXJzIGRlcG9zaXRlZCBieSB0aGUgbWFrZXIKICAgIC8vCiAgICAvLyBUaGlzIG1ldGhvZCB3YXMgY2FsbGVkIGRlcG9zaXQoKSBpbiB0aGUgb2xkIHZlcnNpb24KICAgIC8vCiAgICBmdW5jdGlvbiBtYWtlckRlcG9zaXRFdGhlcigpIHBheWFibGUgb25seU93bmVyT3JUb2tlblRyYWRlcldpdGhTYW1lT3duZXIgewogICAgICAgIE1ha2VyRGVwb3NpdGVkRXRoZXIobXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBNYWtlciBjYW4gd2l0aGRyYXcgYXNzZXQgdG9rZW5zIGZyb20gdGhpcyBjb250cmFjdCwgd2l0aCB0aGUKICAgIC8vIGZvbGxvd2luZyBwYXJhbWV0ZXI6CiAgICAvLyAgIHRva2VucyAgaXMgdGhlIG51bWJlciBvZiBhc3NldCB0b2tlbnMgdG8gYmUgd2l0aGRyYXduCiAgICAvLwogICAgLy8gVGhlIE1ha2VyV2l0aGRyZXdBc3NldCgpIGV2ZW50IGlzIGxvZ2dlZCB3aXRoIHRoZSBmb2xsb3dpbmcKICAgIC8vIHBhcmFtZXRlcjoKICAgIC8vICAgdG9rZW5zICBpcyB0aGUgbnVtYmVyIG9mIHRva2VucyB3aXRoZHJhd24gYnkgdGhlIG1ha2VyCiAgICAvLwogICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB3aXRoZHJhd0Fzc2V0KCkgaW4gdGhlIG9sZCB2ZXJzaW9uCiAgICAvLwogICAgZnVuY3Rpb24gbWFrZXJXaXRoZHJhd0Fzc2V0KHVpbnQyNTYgdG9rZW5zKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIE1ha2VyV2l0aGRyZXdBc3NldCh0b2tlbnMpOwogICAgICAgIHJldHVybiBFUkMyMChhc3NldCkudHJhbnNmZXIob3duZXIsIHRva2Vucyk7CiAgICB9CgogICAgLy8gTWFrZXIgY2FuIHRyYW5zZmVyIGFzc2V0IHRva2VucyBmcm9tIHRoaXMgY29udHJhY3QgdG8gYW5vdGhlcgogICAgLy8gVG9rZW5UcmFkZXIgY29udHJhY3QsIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXI6CiAgICAvLyAgIHRvVG9rZW5UcmFkZXIgIEFub3RoZXIgVG9rZW5UcmFkZXIgY29udHJhY3Qgb3duZWQgYnkgdGhlCiAgICAvLyAgICAgICAgICAgICAgICAgIHNhbWUgb3duZXIgYW5kIHdpdGggdGhlIHNhbWUgYXNzZXQKICAgIC8vICAgdG9rZW5zICAgICAgICAgaXMgdGhlIG51bWJlciBvZiBhc3NldCB0b2tlbnMgdG8gYmUgbW92ZWQKICAgIC8vCiAgICAvLyBUaGUgTWFrZXJUcmFuc2ZlcnJlZEFzc2V0KCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZwogICAgLy8gcGFyYW1ldGVyczoKICAgIC8vICAgdG9Ub2tlblRyYWRlciAgVGhlIG90aGVyIFRva2VuVHJhZGVyIGNvbnRyYWN0IG93bmVkIGJ5CiAgICAvLyAgICAgICAgICAgICAgICAgIHRoZSBzYW1lIG93bmVyIGFuZCB3aXRoIHRoZSBzYW1lIGFzc2V0CiAgICAvLyAgIHRva2VucyAgICAgICAgIGlzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRyYW5zZmVycmVkCiAgICAvLwogICAgLy8gVGhlIGFzc2V0IFRyYW5zZmVyKCkgZXZlbnQgaXMgYWxzbyBsb2dnZWQgZnJvbSB0aGlzIGNvbnRyYWN0CiAgICAvLyB0byB0aGUgb3RoZXIgY29udHJhY3QKICAgIC8vCiAgICBmdW5jdGlvbiBtYWtlclRyYW5zZmVyQXNzZXQoCiAgICAgICAgVG9rZW5UcmFkZXIgdG9Ub2tlblRyYWRlciwKICAgICAgICB1aW50MjU2IHRva2VucwogICAgKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIGlmIChvd25lciAhPSB0b1Rva2VuVHJhZGVyLm93bmVyKCkgfHwgYXNzZXQgIT0gdG9Ub2tlblRyYWRlci5hc3NldCgpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBNYWtlclRyYW5zZmVycmVkQXNzZXQodG9Ub2tlblRyYWRlciwgdG9rZW5zKTsKICAgICAgICByZXR1cm4gRVJDMjAoYXNzZXQpLnRyYW5zZmVyKHRvVG9rZW5UcmFkZXIsIHRva2Vucyk7CiAgICB9CgogICAgLy8gTWFrZXIgY2FuIHdpdGhkcmF3IGFueSBFUkMyMCBhc3NldCB0b2tlbnMgZnJvbSB0aGlzIGNvbnRyYWN0CiAgICAvLwogICAgLy8gVGhpcyBtZXRob2QgaXMgaW5jbHVkZWQgaW4gdGhlIGNhc2Ugd2hlcmUgdGhpcyBjb250cmFjdCByZWNlaXZlcwogICAgLy8gdGhlIHdyb25nIHRva2VucwogICAgLy8KICAgIC8vIFRoZSBNYWtlcldpdGhkcmV3RVJDMjBUb2tlbigpIGV2ZW50IGlzIGxvZ2dlZCB3aXRoIHRoZSBmb2xsb3dpbmcKICAgIC8vIHBhcmFtZXRlcjoKICAgIC8vICAgdG9rZW5BZGRyZXNzICBpcyB0aGUgYWRkcmVzcyBvZiB0aGUgdG9rZW5zIHdpdGhkcmF3biBieSB0aGUgbWFrZXIKICAgIC8vICAgdG9rZW5zICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIHRva2VucyB3aXRoZHJhd24gYnkgdGhlIG1ha2VyCiAgICAvLwogICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB3aXRoZHJhd1Rva2VuKCkgaW4gdGhlIG9sZCB2ZXJzaW9uCiAgICAvLwogICAgZnVuY3Rpb24gbWFrZXJXaXRoZHJhd0VSQzIwVG9rZW4oCiAgICAgICAgYWRkcmVzcyB0b2tlbkFkZHJlc3MsCiAgICAgICAgdWludDI1NiB0b2tlbnMKICAgICkgb25seU93bmVyIHJldHVybnMgKGJvb2wgb2spIHsKICAgICAgICBNYWtlcldpdGhkcmV3RVJDMjBUb2tlbih0b2tlbkFkZHJlc3MsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIEVSQzIwKHRva2VuQWRkcmVzcykudHJhbnNmZXIob3duZXIsIHRva2Vucyk7CiAgICB9CgogICAgLy8gTWFrZXIgY2FuIHdpdGhkcmF3IGV0aGVycyBmcm9tIHRoaXMgY29udHJhY3QKICAgIC8vCiAgICAvLyBUaGUgTWFrZXJXaXRoZHJld0V0aGVyKCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXIKICAgIC8vICAgZXRoZXJzICBpcyB0aGUgbnVtYmVyIG9mIGV0aGVycyB3aXRoZHJhd24gYnkgdGhlIG1ha2VyCiAgICAvLwogICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB3aXRoZHJhdygpIGluIHRoZSBvbGQgdmVyc2lvbgogICAgLy8KICAgIGZ1bmN0aW9uIG1ha2VyV2l0aGRyYXdFdGhlcih1aW50MjU2IGV0aGVycykgb25seU93bmVyIHJldHVybnMgKGJvb2wgb2spIHsKICAgICAgICBpZiAodGhpcy5iYWxhbmNlID49IGV0aGVycykgewogICAgICAgICAgICBNYWtlcldpdGhkcmV3RXRoZXIoZXRoZXJzKTsKICAgICAgICAgICAgcmV0dXJuIG93bmVyLnNlbmQoZXRoZXJzKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gTWFrZXIgY2FuIHRyYW5zZmVyIGV0aGVycyBmcm9tIHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBUb2tlblRyYWRlcgogICAgLy8gY29udHJhY3QsIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgogICAgLy8gICB0b1Rva2VuVHJhZGVyICBBbm90aGVyIFRva2VuVHJhZGVyIGNvbnRyYWN0IG93bmVkIGJ5IHRoZQogICAgLy8gICAgICAgICAgICAgICAgICBzYW1lIG93bmVyIGFuZCB3aXRoIHRoZSBzYW1lIGFzc2V0CiAgICAvLyAgIGV0aGVycyAgICAgICAgIGlzIHRoZSBudW1iZXIgb2YgZXRoZXJzIHRvIGJlIG1vdmVkCiAgICAvLwogICAgLy8gVGhlIE1ha2VyVHJhbnNmZXJyZWRFdGhlcigpIGV2ZW50IGlzIGxvZ2dlZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyCiAgICAvLyAgIHRvVG9rZW5UcmFkZXIgIFRoZSBvdGhlciBUb2tlblRyYWRlciBjb250cmFjdCBvd25lZCBieSB0aGUKICAgIC8vICAgICAgICAgICAgICAgICAgc2FtZSBvd25lciBhbmQgd2l0aCB0aGUgc2FtZSBhc3NldAogICAgLy8gICBldGhlcnMgICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIGV0aGVycyB0cmFuc2ZlcnJlZAogICAgLy8KICAgIC8vIFRoZSBNYWtlckRlcG9zaXRlZEV0aGVyKCkgZXZlbnQgaXMgbG9nZ2VkIG9uIHRoZSBvdGhlcgogICAgLy8gY29udHJhY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcjoKICAgIC8vICAgZXRoZXJzICBpcyB0aGUgbnVtYmVyIG9mIGV0aGVycyBkZXBvc2l0ZWQgYnkgdGhlIG1ha2VyCiAgICAvLwogICAgZnVuY3Rpb24gbWFrZXJUcmFuc2ZlckV0aGVyKAogICAgICAgIFRva2VuVHJhZGVyIHRvVG9rZW5UcmFkZXIsCiAgICAgICAgdWludDI1NiBldGhlcnMKICAgICkgb25seU93bmVyIHJldHVybnMgKGJvb2wgb2spIHsKICAgICAgICBpZiAob3duZXIgIT0gdG9Ub2tlblRyYWRlci5vd25lcigpIHx8IGFzc2V0ICE9IHRvVG9rZW5UcmFkZXIuYXNzZXQoKSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA+PSBldGhlcnMpIHsKICAgICAgICAgICAgTWFrZXJUcmFuc2ZlcnJlZEV0aGVyKHRvVG9rZW5UcmFkZXIsIGV0aGVycyk7CiAgICAgICAgICAgIHRvVG9rZW5UcmFkZXIubWFrZXJEZXBvc2l0RXRoZXIudmFsdWUoZXRoZXJzKSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUYWtlciBidXlzIGFzc2V0IHRva2VucyBieSBzZW5kaW5nIGV0aGVycwogICAgLy8KICAgIC8vIFRoZSBUYWtlckJvdWdodEFzc2V0KCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzCiAgICAvLyAgIGJ1eWVyICAgICAgICAgICBpcyB0aGUgYnV5ZXIncyBhZGRyZXNzCiAgICAvLyAgIGV0aGVyc1NlbnQgICAgICBpcyB0aGUgbnVtYmVyIG9mIGV0aGVycyBzZW50IGJ5IHRoZSBidXllcgogICAgLy8gICBldGhlcnNSZXR1cm5lZCAgaXMgdGhlIG51bWJlciBvZiBldGhlcnMgc2VudCBiYWNrIHRvIHRoZSBidXllciBhcwogICAgLy8gICAgICAgICAgICAgICAgICAgY2hhbmdlCiAgICAvLyAgIHRva2Vuc0JvdWdodCAgICBpcyB0aGUgbnVtYmVyIG9mIGFzc2V0IHRva2VucyBzZW50IHRvIHRoZSBidXllcgogICAgLy8KICAgIC8vIFRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgYnV5KCkgaW4gdGhlIG9sZCB2ZXJzaW9uCiAgICAvLwogICAgZnVuY3Rpb24gdGFrZXJCdXlBc3NldCgpIHBheWFibGUgewogICAgICAgIGlmIChzZWxsc1Rva2VucyB8fCBtc2cuc2VuZGVyID09IG93bmVyKSB7CiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBzZWxsUHJpY2UgaGFzIGFscmVhZHkgYmVlbiB2YWxpZGF0ZWQgYXMgPiAwCiAgICAgICAgICAgIHVpbnQgb3JkZXIgICAgPSBtc2cudmFsdWUgLyBzZWxsUHJpY2U7CiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB1bml0cyBoYXMgYWxyZWFkeSBiZWVuIHZhbGlkYXRlZCBhcyA+IDAKICAgICAgICAgICAgdWludCBjYW5fc2VsbCA9IEVSQzIwKGFzc2V0KS5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkgLyB1bml0czsKICAgICAgICAgICAgdWludDI1NiBjaGFuZ2UgPSAwOwogICAgICAgICAgICBpZiAobXNnLnZhbHVlID4gKGNhbl9zZWxsICogc2VsbFByaWNlKSkgewogICAgICAgICAgICAgICAgY2hhbmdlICA9IG1zZy52YWx1ZSAtIChjYW5fc2VsbCAqIHNlbGxQcmljZSk7CiAgICAgICAgICAgICAgICBvcmRlciA9IGNhbl9zZWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGFuZ2UgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChjaGFuZ2UpKSB0aHJvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3JkZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoIUVSQzIwKGFzc2V0KS50cmFuc2Zlcihtc2cuc2VuZGVyLCBvcmRlciAqIHVuaXRzKSkgdGhyb3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGFrZXJCb3VnaHRBc3NldChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGNoYW5nZSwgb3JkZXIgKiB1bml0cyk7CiAgICAgICAgfQogICAgICAgIC8vIFJldHVybiB1c2VyIGZ1bmRzIGlmIHRoZSBjb250cmFjdCBpcyBub3Qgc2VsbGluZwogICAgICAgIGVsc2UgaWYgKCFtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSkgdGhyb3c7CiAgICB9CgogICAgLy8gVGFrZXIgc2VsbHMgYXNzZXQgdG9rZW5zIGZvciBldGhlcnMgYnk6CiAgICAvLyAxLiBDYWxsaW5nIHRoZSBhc3NldCdzIGFwcHJvdmUoKSBtZXRob2Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnMKICAgIC8vICAgIF9zcGVuZGVyICAgICAgICAgICAgaXMgdGhlIGFkZHJlc3Mgb2YgdGhpcyBjb250cmFjdAogICAgLy8gICAgX3ZhbHVlICAgICAgICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIHRva2VucyB0byBiZSBzb2xkCiAgICAvLyAyLiBDYWxsaW5nIHRoaXMgdGFrZXJTZWxsQXNzZXQoKSBtZXRob2Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcgogICAgLy8gICAgZXRoZXJWYWx1ZU9mVG9rZW5zICBpcyB0aGUgZXRoZXIgdmFsdWUgb2YgdGhlIGFzc2V0IHRva2VucyB0byBiZSBzb2xkCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIGJ5IHRoZSB0YWtlcgogICAgLy8KICAgIC8vIFRoZSBUYWtlclNvbGRBc3NldCgpIGV2ZW50IGlzIGxvZ2dlZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycwogICAgLy8gICBzZWxsZXIgICAgICAgICAgICAgICAgICBpcyB0aGUgc2VsbGVyJ3MgYWRkcmVzcwogICAgLy8gICBhbW91bnRPZlRva2Vuc1RvU2VsbCAgICBpcyB0aGUgYW1vdW50IG9mIHRoZSBhc3NldCB0b2tlbnMgYmVpbmcKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sZCBieSB0aGUgdGFrZXIKICAgIC8vICAgdG9rZW5zU29sZCAgICAgICAgICAgICAgaXMgdGhlIG51bWJlciBvZiB0aGUgYXNzZXQgdG9rZW5zIHNvbGQKICAgIC8vICAgZXRoZXJWYWx1ZU9mVG9rZW5zU29sZCAgaXMgdGhlIGV0aGVyIHZhbHVlIG9mIHRoZSBhc3NldCB0b2tlbnMgc29sZAogICAgLy8KICAgIC8vIFRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgc2VsbCgpIGluIHRoZSBvbGQgdmVyc2lvbgogICAgLy8KICAgIGZ1bmN0aW9uIHRha2VyU2VsbEFzc2V0KHVpbnQyNTYgYW1vdW50T2ZUb2tlbnNUb1NlbGwpIHsKICAgICAgICBpZiAoYnV5c1Rva2VucyB8fCBtc2cuc2VuZGVyID09IG93bmVyKSB7CiAgICAgICAgICAgIC8vIE1heGltdW0gbnVtYmVyIG9mIHRva2VuIHRoZSBjb250cmFjdCBjYW4gYnV5CiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBidXlQcmljZSBoYXMgYWxyZWFkeSBiZWVuIHZhbGlkYXRlZCBhcyA+IDAKICAgICAgICAgICAgdWludDI1NiBjYW5fYnV5ID0gdGhpcy5iYWxhbmNlIC8gYnV5UHJpY2U7CiAgICAgICAgICAgIC8vIFRva2VuIGxvdHMgYXZhaWxhYmxlCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB1bml0cyBoYXMgYWxyZWFkeSBiZWVuIHZhbGlkYXRlZCBhcyA+IDAKICAgICAgICAgICAgdWludDI1NiBvcmRlciA9IGFtb3VudE9mVG9rZW5zVG9TZWxsIC8gdW5pdHM7CiAgICAgICAgICAgIC8vIEFkanVzdCBvcmRlciBmb3IgZnVuZHMgYXZhaWxhYmxlCiAgICAgICAgICAgIGlmIChvcmRlciA+IGNhbl9idXkpIG9yZGVyID0gY2FuX2J1eTsKICAgICAgICAgICAgaWYgKG9yZGVyID4gMCkgewogICAgICAgICAgICAgICAgLy8gRXh0cmFjdCB1c2VyIHRva2VucwogICAgICAgICAgICAgICAgaWYgKCFFUkMyMChhc3NldCkudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3ModGhpcyksIG9yZGVyICogdW5pdHMpKSB0aHJvdzsKICAgICAgICAgICAgICAgIC8vIFBheSB1c2VyCiAgICAgICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChvcmRlciAqIGJ1eVByaWNlKSkgdGhyb3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGFrZXJTb2xkQXNzZXQobXNnLnNlbmRlciwgYW1vdW50T2ZUb2tlbnNUb1NlbGwsIG9yZGVyICogdW5pdHMsIG9yZGVyICogYnV5UHJpY2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUYWtlciBidXlzIHRva2VucyBieSBzZW5kaW5nIGV0aGVycwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgdGFrZXJCdXlBc3NldCgpOwogICAgfQp9CgovLyBUaGlzIGNvbnRyYWN0IGRlcGxveXMgVG9rZW5UcmFkZXIgY29udHJhY3RzIGFuZCBsb2dzIHRoZSBldmVudApjb250cmFjdCBUb2tlblRyYWRlckZhY3RvcnkgaXMgT3duZWQgewoKICAgIGV2ZW50IFRyYWRlTGlzdGluZyhhZGRyZXNzIGluZGV4ZWQgb3duZXJBZGRyZXNzLCBhZGRyZXNzIGluZGV4ZWQgdG9rZW5UcmFkZXJBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBhc3NldCwgdWludDI1NiBidXlQcmljZSwgdWludDI1NiBzZWxsUHJpY2UsIHVpbnQyNTYgdW5pdHMsCiAgICAgICAgYm9vbCBidXlzVG9rZW5zLCBib29sIHNlbGxzVG9rZW5zKTsKICAgIGV2ZW50IE93bmVyV2l0aGRyZXdFUkMyMFRva2VuKGFkZHJlc3MgaW5kZXhlZCB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgdG9rZW5zKTsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgX3ZlcmlmeTsKCiAgICAvLyBBbnlvbmUgY2FuIGNhbGwgdGhpcyBtZXRob2QgdG8gdmVyaWZ5IHRoZSBzZXR0aW5ncyBvZiBhCiAgICAvLyBUb2tlblRyYWRlciBjb250cmFjdC4gVGhlIHBhcmFtZXRlcnMgYXJlOgogICAgLy8gICB0cmFkZUNvbnRyYWN0ICBpcyB0aGUgYWRkcmVzcyBvZiBhIFRva2VuVHJhZGVyIGNvbnRyYWN0CiAgICAvLwogICAgLy8gUmV0dXJuIHZhbHVlczoKICAgIC8vICAgdmFsaWQgICAgICAgIGRpZCB0aGlzIFRva2VuVHJhZGVyRmFjdG9yeSBjcmVhdGUgdGhlIFRva2VuVHJhZGVyIGNvbnRyYWN0PwogICAgLy8gICBvd25lciAgICAgICAgaXMgdGhlIG93bmVyIG9mIHRoZSBUb2tlblRyYWRlciBjb250cmFjdAogICAgLy8gICBhc3NldCAgICAgICAgaXMgdGhlIEVSQzIwIGFzc2V0IGFkZHJlc3MKICAgIC8vICAgYnV5UHJpY2UgICAgIGlzIHRoZSBidXkgcHJpY2UgaW4gZXRoZXJzIHBlciBgdW5pdHNgIG9mIGFzc2V0IHRva2VucwogICAgLy8gICBzZWxsUHJpY2UgICAgaXMgdGhlIHNlbGwgcHJpY2UgaW4gZXRoZXJzIHBlciBgdW5pdHNgIG9mIGFzc2V0IHRva2VucwogICAgLy8gICB1bml0cyAgICAgICAgaXMgdGhlIG51bWJlciBvZiB1bml0cyBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgYnV5c1Rva2VucyAgIGlzIHRoZSBUb2tlblRyYWRlciBjb250cmFjdCBidXlpbmcgdG9rZW5zPwogICAgLy8gICBzZWxsc1Rva2VucyAgaXMgdGhlIFRva2VuVHJhZGVyIGNvbnRyYWN0IHNlbGxpbmcgdG9rZW5zPwogICAgLy8KICAgIGZ1bmN0aW9uIHZlcmlmeShhZGRyZXNzIHRyYWRlQ29udHJhY3QpIGNvbnN0YW50IHJldHVybnMgKAogICAgICAgIGJvb2wgICAgdmFsaWQsCiAgICAgICAgYWRkcmVzcyBvd25lciwKICAgICAgICBhZGRyZXNzIGFzc2V0LAogICAgICAgIHVpbnQyNTYgYnV5UHJpY2UsCiAgICAgICAgdWludDI1NiBzZWxsUHJpY2UsCiAgICAgICAgdWludDI1NiB1bml0cywKICAgICAgICBib29sICAgIGJ1eXNUb2tlbnMsCiAgICAgICAgYm9vbCAgICBzZWxsc1Rva2VucwogICAgKSB7CiAgICAgICAgdmFsaWQgPSBfdmVyaWZ5W3RyYWRlQ29udHJhY3RdOwogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICBUb2tlblRyYWRlciB0ID0gVG9rZW5UcmFkZXIodHJhZGVDb250cmFjdCk7CiAgICAgICAgICAgIG93bmVyICAgICAgICAgPSB0Lm93bmVyKCk7CiAgICAgICAgICAgIGFzc2V0ICAgICAgICAgPSB0LmFzc2V0KCk7CiAgICAgICAgICAgIGJ1eVByaWNlICAgICAgPSB0LmJ1eVByaWNlKCk7CiAgICAgICAgICAgIHNlbGxQcmljZSAgICAgPSB0LnNlbGxQcmljZSgpOwogICAgICAgICAgICB1bml0cyAgICAgICAgID0gdC51bml0cygpOwogICAgICAgICAgICBidXlzVG9rZW5zICAgID0gdC5idXlzVG9rZW5zKCk7CiAgICAgICAgICAgIHNlbGxzVG9rZW5zICAgPSB0LnNlbGxzVG9rZW5zKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIE1ha2VyIGNhbiBjYWxsIHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSBhIG5ldyBUb2tlblRyYWRlciBjb250cmFjdAogICAgLy8gd2l0aCB0aGUgbWFrZXIgYmVpbmcgdGhlIG93bmVyIG9mIHRoaXMgbmV3IGNvbnRyYWN0CiAgICAvLwogICAgLy8gUGFyYW1ldGVyczoKICAgIC8vICAgYXNzZXQgICAgICAgIGlzIHRoZSBFUkMyMCBhc3NldCBhZGRyZXNzCiAgICAvLyAgIGJ1eVByaWNlICAgICBpcyB0aGUgYnV5IHByaWNlIGluIGV0aGVycyBwZXIgYHVuaXRzYCBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgc2VsbFByaWNlICAgIGlzIHRoZSBzZWxsIHByaWNlIGluIGV0aGVycyBwZXIgYHVuaXRzYCBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgdW5pdHMgICAgICAgIGlzIHRoZSBudW1iZXIgb2YgdW5pdHMgb2YgYXNzZXQgdG9rZW5zCiAgICAvLyAgIGJ1eXNUb2tlbnMgICBpcyB0aGUgVG9rZW5UcmFkZXIgY29udHJhY3QgYnV5aW5nIHRva2Vucz8KICAgIC8vICAgc2VsbHNUb2tlbnMgIGlzIHRoZSBUb2tlblRyYWRlciBjb250cmFjdCBzZWxsaW5nIHRva2Vucz8KICAgIC8vCiAgICAvLyBGb3IgZXhhbXBsZSwgbGlzdGluZyBhIFRva2VuVHJhZGVyIGNvbnRyYWN0IG9uIHRoZSBSRVAgQXVndXIgdG9rZW4gd2hlcmUKICAgIC8vIHRoZSBjb250cmFjdCB3aWxsIGJ1eSBSRVAgdG9rZW5zIGF0IGEgcmF0ZSBvZiAzOTAwMC8xMDAwMDAgPSAwLjM5IEVUSAogICAgLy8gcGVyIFJFUCB0b2tlbiBhbmQgc2VsbCBSRVAgdG9rZW5zIGF0IGEgcmF0ZSBvZiA0MTAwMC8xMDAwMDAgPSAwLjQxIEVUSAogICAgLy8gcGVyIFJFUCB0b2tlbjoKICAgIC8vICAgYXNzZXQgICAgICAgIDB4NDhjODBmMWY0ZDUzZDU5NTFlNWQ1NDM4YjU0Y2JhODRmMjlmMzJhNQogICAgLy8gICBidXlQcmljZSAgICAgMzkwMDAKICAgIC8vICAgc2VsbFByaWNlICAgIDQxMDAwCiAgICAvLyAgIHVuaXRzICAgICAgICAxMDAwMDAKICAgIC8vICAgYnV5c1Rva2VucyAgIHRydWUKICAgIC8vICAgc2VsbHNUb2tlbnMgIHRydWUKICAgIC8vCiAgICAvLyBUaGUgVHJhZGVMaXN0aW5nKCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzCiAgICAvLyAgIG93bmVyQWRkcmVzcyAgICAgICAgaXMgdGhlIE1ha2VyJ3MgYWRkcmVzcwogICAgLy8gICB0b2tlblRyYWRlckFkZHJlc3MgIGlzIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXdseSBjcmVhdGVkIFRva2VuVHJhZGVyIGNvbnRyYWN0CiAgICAvLyAgIGFzc2V0ICAgICAgICAgICAgICAgaXMgdGhlIEVSQzIwIGFzc2V0IGFkZHJlc3MKICAgIC8vICAgYnV5UHJpY2UgICAgICAgICAgICBpcyB0aGUgYnV5IHByaWNlIGluIGV0aGVycyBwZXIgYHVuaXRzYCBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgc2VsbFByaWNlICAgICAgICAgICBpcyB0aGUgc2VsbCBwcmljZSBpbiBldGhlcnMgcGVyIGB1bml0c2Agb2YgYXNzZXQgdG9rZW5zCiAgICAvLyAgIHVuaXQgICAgICAgICAgICAgICAgaXMgdGhlIG51bWJlciBvZiB1bml0cyBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgYnV5c1Rva2VucyAgICAgICAgICBpcyB0aGUgVG9rZW5UcmFkZXIgY29udHJhY3QgYnV5aW5nIHRva2Vucz8KICAgIC8vICAgc2VsbHNUb2tlbnMgICAgICAgICBpcyB0aGUgVG9rZW5UcmFkZXIgY29udHJhY3Qgc2VsbGluZyB0b2tlbnM/CiAgICAvLwogICAgZnVuY3Rpb24gY3JlYXRlVHJhZGVDb250cmFjdCgKICAgICAgICBhZGRyZXNzIGFzc2V0LAogICAgICAgIHVpbnQyNTYgYnV5UHJpY2UsCiAgICAgICAgdWludDI1NiBzZWxsUHJpY2UsCiAgICAgICAgdWludDI1NiB1bml0cywKICAgICAgICBib29sICAgIGJ1eXNUb2tlbnMsCiAgICAgICAgYm9vbCAgICBzZWxsc1Rva2VucwogICAgKSByZXR1cm5zIChhZGRyZXNzIHRyYWRlcikgewogICAgICAgIC8vIENhbm5vdCBoYXZlIGludmFsaWQgYXNzZXQKICAgICAgICBpZiAoYXNzZXQgPT0gMHgwKSB0aHJvdzsKICAgICAgICAvLyBDaGVjayBmb3IgRVJDMjAgYWxsb3dhbmNlIGZ1bmN0aW9uCiAgICAgICAgLy8gVGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHRoZSBhbGxvd2FuY2UgZnVuY3Rpb24KICAgICAgICAvLyBpcyB1bmRlZmluZWQgdG8gcHJldmVudCBHTlRzIGZyb20gYmVpbmcgdXNlZAogICAgICAgIC8vIHdpdGggdGhpcyBmYWN0b3J5CiAgICAgICAgdWludDI1NiBhbGxvd2FuY2UgPSBFUkMyMChhc3NldCkuYWxsb3dhbmNlKG1zZy5zZW5kZXIsIHRoaXMpOwogICAgICAgIC8vIENhbm5vdCBzZXQgemVybyBvciBuZWdhdGl2ZSBwcmljZQogICAgICAgIGlmIChidXlQcmljZSA8PSAwIHx8IHNlbGxQcmljZSA8PSAwKSB0aHJvdzsKICAgICAgICAvLyBNdXN0IG1ha2UgcHJvZml0IG9uIHNwcmVhZAogICAgICAgIGlmIChidXlQcmljZSA+PSBzZWxsUHJpY2UpIHRocm93OwogICAgICAgIC8vIENhbm5vdCBidXkgb3Igc2VsbCB6ZXJvIG9yIG5lZ2F0aXZlIHVuaXRzCiAgICAgICAgaWYgKHVuaXRzIDw9IDApIHRocm93OwoKICAgICAgICB0cmFkZXIgPSBuZXcgVG9rZW5UcmFkZXIoCiAgICAgICAgICAgIGFzc2V0LAogICAgICAgICAgICBidXlQcmljZSwKICAgICAgICAgICAgc2VsbFByaWNlLAogICAgICAgICAgICB1bml0cywKICAgICAgICAgICAgYnV5c1Rva2VucywKICAgICAgICAgICAgc2VsbHNUb2tlbnMpOwogICAgICAgIC8vIFJlY29yZCB0aGF0IHRoaXMgZmFjdG9yeSBjcmVhdGVkIHRoZSB0cmFkZXIKICAgICAgICBfdmVyaWZ5W3RyYWRlcl0gPSB0cnVlOwogICAgICAgIC8vIFNldCB0aGUgb3duZXIgdG8gd2hvZXZlciBjYWxsZWQgdGhlIGZ1bmN0aW9uCiAgICAgICAgVG9rZW5UcmFkZXIodHJhZGVyKS50cmFuc2Zlck93bmVyc2hpcChtc2cuc2VuZGVyKTsKICAgICAgICBUcmFkZUxpc3RpbmcobXNnLnNlbmRlciwgdHJhZGVyLCBhc3NldCwgYnV5UHJpY2UsIHNlbGxQcmljZSwgdW5pdHMsIGJ1eXNUb2tlbnMsIHNlbGxzVG9rZW5zKTsKICAgIH0KCiAgICAvLyBGYWN0b3J5IG93bmVyIGNhbiB3aXRoZHJhdyBhbnkgRVJDMjAgYXNzZXQgdG9rZW5zIGZyb20gdGhpcyBjb250cmFjdAogICAgLy8KICAgIC8vIFRoaXMgbWV0aG9kIGlzIGluY2x1ZGVkIGluIHRoZSBjYXNlIHdoZXJlIHRoaXMgY29udHJhY3QgcmVjZWl2ZXMKICAgIC8vIHRoZSB3cm9uZyB0b2tlbnMKICAgIC8vCiAgICAvLyBUaGUgT3duZXJXaXRoZHJld0VSQzIwVG9rZW4oKSBldmVudCBpcyBsb2dnZWQgd2l0aCB0aGUgZm9sbG93aW5nCiAgICAvLyBwYXJhbWV0ZXI6CiAgICAvLyAgIHRva2VuQWRkcmVzcyAgaXMgdGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VucyB3aXRoZHJhd24gYnkgdGhlIG1ha2VyCiAgICAvLyAgIHRva2VucyAgICAgICAgaXMgdGhlIG51bWJlciBvZiB0b2tlbnMgd2l0aGRyYXduIGJ5IHRoZSBtYWtlcgogICAgLy8KICAgIGZ1bmN0aW9uIG93bmVyV2l0aGRyYXdFUkMyMFRva2VuKGFkZHJlc3MgdG9rZW5BZGRyZXNzLCB1aW50MjU2IHRva2Vucykgb25seU93bmVyIHJldHVybnMgKGJvb2wgb2spIHsKICAgICAgICBPd25lcldpdGhkcmV3RVJDMjBUb2tlbih0b2tlbkFkZHJlc3MsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIEVSQzIwKHRva2VuQWRkcmVzcykudHJhbnNmZXIob3duZXIsIHRva2Vucyk7CiAgICB9CgogICAgLy8gUHJldmVudHMgYWNjaWRlbnRhbCBzZW5kaW5nIG9mIGV0aGVyIHRvIHRoZSBmYWN0b3J5CiAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3c7CiAgICB9Cn0KCmNvbnRyYWN0IEZpeGVkU3VwcGx5VG9rZW4gaXMgRVJDMjAgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50MjU2IF90b3RhbFN1cHBseTsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgICAvLyBCYWxhbmNlcyBmb3IgZWFjaCBhY2NvdW50CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgLy8gT3duZXIgb2YgYWNjb3VudCBhcHByb3ZlcyB0aGUgdHJhbnNmZXIgb2YgYW4gYW1vdW50IHRvIGFub3RoZXIgYWNjb3VudAogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEZpeGVkU3VwcGx5VG9rZW4oCiAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgIHVpbnQyNTYgX3N1cHBseSwKICAgICAgdWludDggX2RlY2ltYWxzCiAgICApIHsKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICBfdG90YWxTdXBwbHkgPSBfc3VwcGx5OwogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gX3RvdGFsU3VwcGx5OwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b3RhbFN1cHBseSkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gX3RvdGFsU3VwcGx5OwogICAgfQoKICAgIC8vIFdoYXQgaXMgdGhlIGJhbGFuY2Ugb2YgYSBwYXJ0aWN1bGFyIGFjY291bnQ/CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8vIFRyYW5zZmVyIHRoZSBiYWxhbmNlIGZyb20gb3duZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF9hbW91bnQKICAgICAgICAgICAgJiYgX2Ftb3VudCA+IDAKICAgICAgICAgICAgJiYgYmFsYW5jZXNbX3RvXSArIF9hbW91bnQgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX2Ftb3VudDsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBTZW5kIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgLy8gVGhlIHRyYW5zZmVyRnJvbSBtZXRob2QgaXMgdXNlZCBmb3IgYSB3aXRoZHJhdyB3b3JrZmxvdywgYWxsb3dpbmcgY29udHJhY3RzIHRvIHNlbmQKICAgIC8vIHRva2VucyBvbiB5b3VyIGJlaGFsZiwgZm9yIGV4YW1wbGUgdG8gImRlcG9zaXQiIHRvIGEgY29udHJhY3QgYWRkcmVzcyBhbmQvb3IgdG8gY2hhcmdlCiAgICAvLyBmZWVzIGluIHN1Yi1jdXJyZW5jaWVzOyB0aGUgY29tbWFuZCBzaG91bGQgZmFpbCB1bmxlc3MgdGhlIF9mcm9tIGFjY291bnQgaGFzCiAgICAvLyBkZWxpYmVyYXRlbHkgYXV0aG9yaXplZCB0aGUgc2VuZGVyIG9mIHRoZSBtZXNzYWdlIHZpYSBzb21lIG1lY2hhbmlzbTsgd2UgcHJvcG9zZQogICAgLy8gdGhlc2Ugc3RhbmRhcmRpemVkIEFQSXMgZm9yIGFwcHJvdmFsOgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX2Ftb3VudAogICAgICAgICAgICAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfYW1vdW50CiAgICAgICAgICAgICYmIF9hbW91bnQgPiAwCiAgICAgICAgICAgICYmIGJhbGFuY2VzW190b10gKyBfYW1vdW50ID4gYmFsYW5jZXNbX3RvXSkgewogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX2Ftb3VudDsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfYW1vdW50OwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBBbGxvdyBfc3BlbmRlciB0byB3aXRoZHJhdyBmcm9tIHlvdXIgYWNjb3VudCwgbXVsdGlwbGUgdGltZXMsIHVwIHRvIHRoZSBfdmFsdWUgYW1vdW50LgogICAgLy8gSWYgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYWdhaW4gaXQgb3ZlcndyaXRlcyB0aGUgY3VycmVudCBhbGxvd2FuY2Ugd2l0aCBfdmFsdWUuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuVG9rZW4gaXMgRml4ZWRTdXBwbHlUb2tlbnsKICBUb2tlblRyYWRlcltdIHB1YmxpYyB0b2tlbkV4Y2hhbmdlczsKICB1aW50MjU2W10gcHVibGljIHRva2VuUmF0aW9zOyAvLyBNZWFzdXJlZCBpbiBwZXIgMWUxOCwgZS5nLmcgNWUxNyA9IDUwJQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRva2VuUmF0aW9zIE1VU1QgQUREIFRPIDEgKDFlMTgpCiAgdWludDI1NiB0b2tlbnNCb3VnaHQgPSAwOwoKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwoKICAvKiBUaGlzIGdlbmVyYXRlcyBhIHB1YmxpYyBldmVudCBvbiB0aGUgYmxvY2tjaGFpbiB0aGF0IHdpbGwgbm90aWZ5IGNsaWVudHMgKi8KICAvL2V2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwoKICAvKiBJbml0aWFsaXplcyBjb250cmFjdCB3aXRoIGluaXRpYWwgc3VwcGx5IHRva2VucyB0byB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgKi8KCiAgZnVuY3Rpb24gVG9rZW5Ub2tlbigKICAgIHN0cmluZyBfbmFtZSwKICAgIHN0cmluZyBfc3ltYm9sLAogICAgdWludDI1NiBfc3VwcGx5LAogICAgdWludDggX2RlY2ltYWxzLAogICAgVG9rZW5UcmFkZXJbXSBpbml0aWFsVG9rZW5FeGNoYW5nZXMsCiAgICB1aW50MjU2W10gaW5pdGlhbFRva2VuUmF0aW9zCiAgICApIEZpeGVkU3VwcGx5VG9rZW4oCiAgICAgIF9uYW1lLAogICAgICBfc3ltYm9sLAogICAgICBfc3VwcGx5LAogICAgICBfZGVjaW1hbHMKICAgICkgewogICAgdG9rZW5FeGNoYW5nZXMgPSBpbml0aWFsVG9rZW5FeGNoYW5nZXM7CiAgICB0b2tlblJhdGlvcyA9IGluaXRpYWxUb2tlblJhdGlvczsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsKICAgICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKICBmdW5jdGlvbiBzZXRQdXJjaGFzZVJhdGlvcyAoCiAgICBUb2tlblRyYWRlcltdIG5ld1Rva2VuRXhjaGFuZ2VzLAogICAgdWludDI1NltdIG5ld1Rva2VuUmF0aW9zCiAgKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgIC8vIFNob3VsZCBoYXZlIGEgbG90IG9mIGFzc2VydGlvbnMKICAgICAgLy8gVE9ETzogQXNzZXJ0IG5ld1Rva2VuUmF0aW9zLmxlbmd0aCA9PSB0b2tlblJhdGlvcy5sZW5ndGgKICAgICAgLy8gVE9ETzogQXNzZXJ0IG5ld1Rva2VuUmF0aW9zIGFkZCB0byAxCiAgICAgIHRva2VuRXhjaGFuZ2VzID0gbmV3VG9rZW5FeGNoYW5nZXM7CiAgICAgIHRva2VuUmF0aW9zID0gbmV3VG9rZW5SYXRpb3M7CiAgICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYnV5UHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRvdGFsUHJpY2UpIHsKICAgIHRvdGFsUHJpY2UgPSAwOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdG9rZW5FeGNoYW5nZXMubGVuZ3RoOyArK2kpIHsKICAgICAgdG90YWxQcmljZSArPSB0b2tlbkV4Y2hhbmdlc1tpXS5idXlQcmljZSgpICogdG9rZW5SYXRpb3NbaV0gLyAxZTE4OwogICAgfQogICAgcmV0dXJuIHRvdGFsUHJpY2U7CiAgfQoKICBmdW5jdGlvbiBzZWxsUHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRvdGFsUHJpY2UpIHsKICAgIHRvdGFsUHJpY2UgPSAwOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdG9rZW5FeGNoYW5nZXMubGVuZ3RoOyArK2kpIHsKICAgICAgdG90YWxQcmljZSArPSB0b2tlbkV4Y2hhbmdlc1tpXS5zZWxsUHJpY2UoKSAqIHRva2VuUmF0aW9zW2ldIC8gMWUxODsKICAgIH0KICAgIHJldHVybiB0b3RhbFByaWNlOwogIH0KCiAgZnVuY3Rpb24gKCkgeyAvLyBTZW5kaW5nIGV0aGVyIHRvIGl0IGJ1eXMgY29pbnMgYXV0b21hdGljYWxseQogICAgYnV5KCk7CiAgfQogIGZ1bmN0aW9uIGJ1eSgpIHBheWFibGUgcmV0dXJucyAodWludDI1NiBhbW91bnQpeyAgICAgICAgLy8gQnV5IGluIEVUSAoKICAgIGFtb3VudCA9IG1zZy52YWx1ZSAvIGJ1eVByaWNlKCk7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgewogICAgICBUb2tlblRyYWRlciB0b2tlbkV4Y2hhbmdlID0gdG9rZW5FeGNoYW5nZXNbaV07CiAgICAgIHRva2VuRXhjaGFuZ2UudHJhbnNmZXIobXNnLnZhbHVlICogdG9rZW5SYXRpb3NbaV0gLyAxZTE4KTsKICAgIH0KICAgIHRva2Vuc0JvdWdodCArPSBhbW91bnQ7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSBhbW91bnQ7ICAgICAgICAgICAgICAgICAgIC8vIGFkZHMgdGhlIGFtb3VudCB0byBidXllcidzIGJhbGFuY2UKICAgIGJhbGFuY2VzW3RoaXNdIC09IGFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3VidHJhY3RzIGFtb3VudCBmcm9tIHNlbGxlcidzIGJhbGFuY2UKICAgIFRyYW5zZmVyKHRoaXMsIG1zZy5zZW5kZXIsIGFtb3VudCk7ICAgICAgICAgICAgICAgIC8vIGV4ZWN1dGUgYW4gZXZlbnQgcmVmbGVjdGluZyB0aGUgY2hhbmdlCiAgICByZXR1cm4gYW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmRzIGZ1bmN0aW9uIGFuZCByZXR1cm5zCiAgfQoKICBmdW5jdGlvbiBzZWxsKHVpbnQgYW1vdW50KSByZXR1cm5zICh1aW50MjU2IHJldmVudWUpeyAgIC8vIFNlbGwgaW4gdG9rZW5zCiAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCBhbW91bnQgKSB0aHJvdzsgICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2ggdG8gc2VsbAogICAgYmFsYW5jZXNbdGhpc10gKz0gYW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRzIHRoZSBhbW91bnQgdG8gb3duZXIncyBiYWxhbmNlCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBhbW91bnQ7ICAgICAgICAgICAgICAgICAgIC8vIHN1YnRyYWN0cyB0aGUgYW1vdW50IGZyb20gc2VsbGVyJ3MgYmFsYW5jZQoKICAgIHVpbnQyNTYgc3ViVG9rZW5zVG9TZWxsID0gMDsKICAgIHJldmVudWUgPSAwOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdG9rZW5FeGNoYW5nZXMubGVuZ3RoOyArK2kpIHsgLy8gVW5zYWZlIGNvZGU6IHdoYXQgaWYgdGhlIGxvb3AgZXJyb3JzIGhhbGZ3YXk/CiAgICAgIFRva2VuVHJhZGVyIHRva2VuRXhjaGFuZ2UgPSB0b2tlbkV4Y2hhbmdlc1tpXTsKICAgICAgc3ViVG9rZW5zVG9TZWxsID0gRVJDMjAodG9rZW5FeGNoYW5nZS5hc3NldCgpKS5iYWxhbmNlT2YodGhpcykqYW1vdW50L3Rva2Vuc0JvdWdodDsKCiAgICAgIHJldmVudWUgKz0gc3ViVG9rZW5zVG9TZWxsICogdG9rZW5FeGNoYW5nZS5zZWxsUHJpY2UoKTsKICAgICAgRVJDMjAodG9rZW5FeGNoYW5nZS5hc3NldCgpKS5hcHByb3ZlKGFkZHJlc3ModG9rZW5FeGNoYW5nZSksIHN1YlRva2Vuc1RvU2VsbCk7IC8vIEFwcHJvdmUgc2FsZQogICAgICB0b2tlbkV4Y2hhbmdlLnRha2VyU2VsbEFzc2V0KHN1YlRva2Vuc1RvU2VsbCk7IC8vIE1ha2UgU2FsZQogICAgfQoKICAgIHRva2Vuc0JvdWdodCAtPSBhbW91bnQ7CiAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJldmVudWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdGhpcywgYW1vdW50KTsgICAgICAgICAgICAvLyBleGVjdXRlcyBhbiBldmVudCByZWZsZWN0aW5nIG9uIHRoZSBjaGFuZ2UKICAgIHJldHVybiByZXZlbnVlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5kcyBmdW5jdGlvbiBhbmQgcmV0dXJucwogIH0KCiAgZnVuY3Rpb24gYnJlYWtkb3duKHVpbnQyNTYgYW1vdW50KSB7ICAgLy8gQnJlYWtkb3duIGluIHRva2VucwogICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgYW1vdW50ICkgdGhyb3c7ICAgICAgICAvLyBjaGVja3MgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoIHRvIHNlbGwKICAgIGJhbGFuY2VzW3RoaXNdICs9IGFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkcyB0aGUgYW1vdW50IHRvIG93bmVyJ3MgYmFsYW5jZQogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gYW1vdW50OyAgICAgICAgICAgICAgICAgICAvLyBzdWJ0cmFjdHMgdGhlIGFtb3VudCBmcm9tIHNlbGxlcidzIGJhbGFuY2UKCiAgICB1aW50MjU2IHN1YlRva2Vuc1RvU2VsbCA9IDA7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgeyAvLyBVbnNhZmUgY29kZTogd2hhdCBpZiB0aGUgbG9vcCBlcnJvcnMgaGFsZndheT8KICAgICAgVG9rZW5UcmFkZXIgdG9rZW5FeGNoYW5nZSA9IHRva2VuRXhjaGFuZ2VzW2ldOwogICAgICBzdWJUb2tlbnNUb1NlbGwgPSBFUkMyMCh0b2tlbkV4Y2hhbmdlLmFzc2V0KCkpLmJhbGFuY2VPZih0aGlzKSphbW91bnQvdG9rZW5zQm91Z2h0OwogICAgICBFUkMyMCh0b2tlbkV4Y2hhbmdlLmFzc2V0KCkpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHN1YlRva2Vuc1RvU2VsbCk7CiAgICB9CgogICAgdG9rZW5zQm91Z2h0IC09IGFtb3VudDsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRoaXMsIGFtb3VudCk7ICAgICAgICAgICAgLy8gZXhlY3V0ZXMgYW4gZXZlbnQgcmVmbGVjdGluZyBvbiB0aGUgY2hhbmdlCiAgfQoKICBmdW5jdGlvbiByZWJhbGFuY2UoVG9rZW5UcmFkZXIgZnJvbUV4Y2hhbmdlLCBUb2tlblRyYWRlciB0b0V4Y2hhbmdlLCB1aW50MjU2IGZyb21QZXJjZW50KSBvbmx5T3duZXIgewogICAgdWludDI1NiBzdWJUb2tlbnNUb1NlbGwgPSBFUkMyMChmcm9tRXhjaGFuZ2UuYXNzZXQoKSkuYmFsYW5jZU9mKHRoaXMpICogZnJvbVBlcmNlbnQgLyAxZTE4OwoKICAgIHVpbnQyNTYgcmV2ZW51ZSA9IHN1YlRva2Vuc1RvU2VsbCAqIGZyb21FeGNoYW5nZS5zZWxsUHJpY2UoKTsKICAgIEVSQzIwKGZyb21FeGNoYW5nZS5hc3NldCgpKS5hcHByb3ZlKGFkZHJlc3MoZnJvbUV4Y2hhbmdlKSwgc3ViVG9rZW5zVG9TZWxsKTsgLy8gQXBwcm92ZSBzYWxlCiAgICBmcm9tRXhjaGFuZ2UudGFrZXJTZWxsQXNzZXQoc3ViVG9rZW5zVG9TZWxsKTsgLy8gTWFrZSBzYWxlCgogICAgdG9FeGNoYW5nZS50cmFuc2ZlcihyZXZlbnVlKTsgLy8gTWFrZSBwdXJjaGFzZSB3aXRoIG5ldyBjb250cmFjdC4KICB9CgogIGZ1bmN0aW9uIGtpbGwoKSB7IGlmIChtc2cuc2VuZGVyID09IG93bmVyKSBzZWxmZGVzdHJ1Y3Qob3duZXIpOyB9Cn0='.
	

]
