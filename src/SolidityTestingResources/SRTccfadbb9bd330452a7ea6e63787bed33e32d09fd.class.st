Class {
	#name : #SRTccfadbb9bd330452a7ea6e63787bed33e32d09fd,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTccfadbb9bd330452a7ea6e63787bed33e32d09fd >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgQ2xhaW1hYmxlCiAqIEBkZXYgRXh0ZW5zaW9uIGZvciB0aGUgT3duYWJsZSBjb250cmFjdCwgd2hlcmUgdGhlIG93bmVyc2hpcCBuZWVkcyB0byBiZSBjbGFpbWVkLgogKiBUaGlzIGFsbG93cyB0aGUgbmV3IG93bmVyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIuCiAqLwpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgcGVuZGluZ093bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlQZW5kaW5nT3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcyB0byBmaW5hbGl6ZSB0aGUgdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAoKSBvbmx5UGVuZGluZ093bmVyIHB1YmxpYyB7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgcGVuZGluZ093bmVyID0gYWRkcmVzcygwKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgYmUgYWJsZSB0byByZWNvdmVyIHRva2VucwogKiBAYXV0aG9yIFN5bFRpCiAqIEBkZXYgVGhpcyBhbGxvdyBhIGNvbnRyYWN0IHRvIHJlY292ZXIgYW55IEVSQzIwIHRva2VuIHJlY2VpdmVkIGluIGEgY29udHJhY3QgYnkgdHJhbnNmZXJyaW5nIHRoZSBiYWxhbmNlIHRvIHRoZSBjb250cmFjdCBvd25lci4KICogVGhpcyB3aWxsIHByZXZlbnQgYW55IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBDYW5SZWNsYWltVG9rZW4gaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMEJhc2ljOwoKICAvKioKICAgKiBAZGV2IFJlY2xhaW0gYWxsIEVSQzIwQmFzaWMgY29tcGF0aWJsZSB0b2tlbnMKICAgKiBAcGFyYW0gdG9rZW4gRVJDMjBCYXNpYyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiByZWNsYWltVG9rZW4oRVJDMjBCYXNpYyB0b2tlbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHRva2VuLnNhZmVUcmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgfQoKfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIERXb3JsZCBjb250cmFjdC4KY29udHJhY3QgQnVybnVwR2FtZUFjY2Vzc0NvbnRyb2wgaXMgQ2xhaW1hYmxlLCBQYXVzYWJsZSwgQ2FuUmVjbGFpbVRva2VuIHsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGNmbzsKICAgIAogICAgZnVuY3Rpb24gQnVybnVwR2FtZUFjY2Vzc0NvbnRyb2woKSBwdWJsaWMgewogICAgICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyBhIENGTy4KICAgICAgICBjZm9bbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkuCiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUoY2ZvW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3IgcmVtb3ZlcyBhbiBhZGRyZXNzIHRvIGFjdCBhcyBhIENGTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgY29udHJhY3Qgb3duZXIuCiAgICAvLy8gQHBhcmFtIGFkZHIgVGhlIGFkZHJlc3MgdG8gc2V0IG9yIHVuc2V0IGFzIENGTy4KICAgIC8vLyBAcGFyYW0gc2V0IFdoZXRoZXIgdG8gc2V0IG9yIHVuc2V0IHRoZSBhZGRyZXNzIGFzIENGTy4KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIGFkZHIsIGJvb2wgc2V0KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgaWYgKCFzZXQpIHsKICAgICAgICAgICAgZGVsZXRlIGNmb1thZGRyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjZm9bYWRkcl0gPSB0cnVlOwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAZGV2IERlZmluZXMgYmFzZSBkYXRhIHN0cnVjdHVyZXMgZm9yIERXb3JsZC4KY29udHJhY3QgQnVybnVwR2FtZUJhc2UgaXMgQnVybnVwR2FtZUFjY2Vzc0NvbnRyb2wgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIGV2ZW50IEFjdGl2ZVRpbWVzKHVpbnQyNTZbXSBmcm9tLCB1aW50MjU2W10gdG8pOwogICAgZXZlbnQgQWxsb3dTdGFydChib29sIGFsbG93U3RhcnQpOwogICAgZXZlbnQgTmV4dEdhbWUoCiAgICAgICAgdWludDI1NiByb3dzLAogICAgICAgIHVpbnQyNTYgY29scywKICAgICAgICB1aW50MjU2IGluaXRpYWxBY3Rpdml0eVRpbWVyLAogICAgICAgIHVpbnQyNTYgZmluYWxBY3Rpdml0eVRpbWVyLAogICAgICAgIHVpbnQyNTYgbnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyLAogICAgICAgIHVpbnQyNTYgdGltZW91dEJvbnVzVGltZSwKICAgICAgICB1aW50MjU2IHVuY2xhaW1lZFRpbGVQcmljZSwKICAgICAgICB1aW50MjU2IGJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLAogICAgICAgIHVpbnQyNTYgZmlyc3RCdXlvdXRQcml6ZVBvb2xQZXJjZW50YWdlLAogICAgICAgIHVpbnQyNTYgYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSwKICAgICAgICB1aW50MjU2IGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSwKICAgICAgICB1aW50MjU2IGJ1eW91dEZlZVBlcmNlbnRhZ2UsCiAgICAgICAgdWludDI1NiBidXlvdXRQcmljZUluY3JlYXNlUGVyY2VudGFnZQogICAgKTsKICAgIGV2ZW50IFN0YXJ0KAogICAgICAgIHVpbnQyNTYgaW5kZXhlZCBnYW1lSW5kZXgsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHN0YXJ0ZXIsCiAgICAgICAgdWludDI1NiB0aW1lc3RhbXAsCiAgICAgICAgdWludDI1NiBwcml6ZVBvb2wKICAgICk7CiAgICBldmVudCBFbmQodWludDI1NiBpbmRleGVkIGdhbWVJbmRleCwgYWRkcmVzcyBpbmRleGVkIHdpbm5lciwgdWludDI1NiBpbmRleGVkIGlkZW50aWZpZXIsIHVpbnQyNTYgeCwgdWludDI1NiB5LCB1aW50MjU2IHRpbWVzdGFtcCwgdWludDI1NiBwcml6ZSk7CiAgICBldmVudCBCdXlvdXQoCiAgICAgICAgdWludDI1NiBpbmRleGVkIGdhbWVJbmRleCwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgcGxheWVyLAogICAgICAgIHVpbnQyNTYgaW5kZXhlZCBpZGVudGlmaWVyLAogICAgICAgIHVpbnQyNTYgeCwKICAgICAgICB1aW50MjU2IHksCiAgICAgICAgdWludDI1NiB0aW1lc3RhbXAsCiAgICAgICAgdWludDI1NiB0aW1lb3V0VGltZXN0YW1wLAogICAgICAgIHVpbnQyNTYgbmV3UHJpY2UsCiAgICAgICAgdWludDI1NiBuZXdQcml6ZVBvb2wKICAgICk7CiAgICBldmVudCBMYXN0VGlsZSgKICAgICAgICB1aW50MjU2IGluZGV4ZWQgZ2FtZUluZGV4LAogICAgICAgIHVpbnQyNTYgaW5kZXhlZCBpZGVudGlmaWVyLAogICAgICAgIHVpbnQyNTYgeCwKICAgICAgICB1aW50MjU2IHkKICAgICk7CiAgICBldmVudCBQZW51bHRpbWF0ZVRpbGVUaW1lb3V0KAogICAgICAgIHVpbnQyNTYgaW5kZXhlZCBnYW1lSW5kZXgsCiAgICAgICAgdWludDI1NiB0aW1lb3V0VGltZXN0YW1wCiAgICApOwogICAgZXZlbnQgU3BpY2VVcFByaXplUG9vbCh1aW50MjU2IGluZGV4ZWQgZ2FtZUluZGV4LCBhZGRyZXNzIGluZGV4ZWQgc3BpY2VyLCB1aW50MjU2IHNwaWNlQWRkZWQsIHN0cmluZyBtZXNzYWdlLCB1aW50MjU2IG5ld1ByaXplUG9vbCk7CiAgICAKICAgIC8vLyBAZGV2IFN0cnVjdCB0byBob2xkIGdhbWUgc2V0dGluZ3MuCiAgICBzdHJ1Y3QgR2FtZVNldHRpbmdzIHsKICAgICAgICB1aW50MjU2IHJvd3M7IC8vIDUKICAgICAgICB1aW50MjU2IGNvbHM7IC8vIDgKICAgICAgICAKICAgICAgICAvLy8gQGRldiBJbml0aWFsIHRpbWUgYWZ0ZXIgbGFzdCB0cmFkZSBhZnRlciB3aGljaCB0aWxlcyBiZWNvbWUgaW5hY3RpdmUuCiAgICAgICAgdWludDI1NiBpbml0aWFsQWN0aXZpdHlUaW1lcjsgLy8gNjAwCiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgRmluYWwgdGltZSBhZnRlciBsYXN0IHRyYWRlIGFmdGVyIHdoaWNoIHRpbGVzIGJlY29tZSBpbmFjdGl2ZS4KICAgICAgICB1aW50MjU2IGZpbmFsQWN0aXZpdHlUaW1lcjsgLy8gMzAwCiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgTnVtYmVyIG9mIGZsaXBzIGZvciB0aGUgYWN0aXZpdHkgdGltZXIgdG8gbW92ZSBmcm9tIHRoZSBpbml0aWFsCiAgICAgICAgLy8vIGFjdGl2aXR5IHRpbWVyIHRvIHRoZSBmaW5hbCBhY3Rpdml0eSB0aW1lci4KICAgICAgICB1aW50MjU2IG51bWJlck9mRmxpcHNUb0ZpbmFsQWN0aXZpdHlUaW1lcjsgLy8gODAKICAgICAgICAKICAgICAgICAvLy8gQGRldiBUaGUgdGltZW91dCBib251cyB0aW1lIGluIHNlY29uZHMgcGVyIHRpbGUgb3duZWQgYnkgdGhlIHBsYXllci4KICAgICAgICB1aW50MjU2IHRpbWVvdXRCb251c1RpbWU7IC8vIDMwCiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgQmFzZSBwcmljZSBmb3IgdW5jbGFpbWVkIHRpbGVzLgogICAgICAgIHVpbnQyNTYgdW5jbGFpbWVkVGlsZVByaWNlOyAvLyAwLjAxIGV0aGVyCiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgUGVyY2VudGFnZSBvZiB0aGUgYnV5b3V0IHByaWNlIHRoYXQgZ29lcyB0b3dhcmRzIHRoZSByZWZlcnJhbAogICAgICAgIC8vLyBib251cy4gSW4gMS8xMDAwdGggb2YgYSBwZXJjZW50YWdlLgogICAgICAgIHVpbnQyNTYgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2U7IC8vIDc1MAogICAgICAgIAogICAgICAgIC8vLyBAZGV2IEZvciB0aGUgaW5pdGlhbCBidXlvdXQgb2YgYSB0aWxlOiBwZXJjZW50YWdlIG9mIHRoZSBidXlvdXQgcHJpY2UKICAgICAgICAvLy8gdGhhdCBnb2VzIHRvd2FyZHMgdGhlIHByaXplIHBvb2wuIEluIDEvMTAwMHRoIG9mIGEgcGVyY2VudGFnZS4KICAgICAgICB1aW50MjU2IGZpcnN0QnV5b3V0UHJpemVQb29sUGVyY2VudGFnZTsgLy8gNDAwMDAKICAgICAgICAKICAgICAgICAvLy8gQGRldiBQZXJjZW50YWdlIG9mIHRoZSBidXlvdXQgcHJpY2UgdGhhdCBnb2VzIHRvd2FyZHMgdGhlIHByaXplCiAgICAgICAgLy8vIHBvb2wuIEluIDEvMTAwMHRoIG9mIGEgcGVyY2VudGFnZS4KICAgICAgICB1aW50MjU2IGJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2U7IC8vIDEwMDAwCiAgICAKICAgICAgICAvLy8gQGRldiBQZXJjZW50YWdlIG9mIHRoZSBidXlvdXQgcHJpY2UgdGhhdCBnb2VzIHRvd2FyZHMgZGl2aWRlbmRzCiAgICAgICAgLy8vIHN1cnJvdW5kaW5nIHRoZSB0aWxlIHRoYXQgaXMgYm91Z2h0IG91dC4gSW4gaW4gMS8xMDAwdGggb2YKICAgICAgICAvLy8gYSBwZXJjZW50YWdlLgogICAgICAgIHVpbnQyNTYgYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlOyAvLyA1MDAwCiAgICAKICAgICAgICAvLy8gQGRldiBCdXlvdXQgZmVlIGluIDEvMTAwMHRoIG9mIGEgcGVyY2VudGFnZS4KICAgICAgICB1aW50MjU2IGJ1eW91dEZlZVBlcmNlbnRhZ2U7IC8vIDI1MDAKICAgICAgICAKICAgICAgICAvLy8gQGRldiBCdXlvdXQgcHJpY2UgaW5jcmVhc2UgaW4gMS8xMDAwdGggb2YgYSBwZXJjZW50YWdlLiAKICAgICAgICB1aW50MjU2IGJ1eW91dFByaWNlSW5jcmVhc2VQZXJjZW50YWdlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBTdHJ1Y3QgdG8gaG9sZCBnYW1lIHN0YXRlLgogICAgc3RydWN0IEdhbWVTdGF0ZSB7CiAgICAgICAgLy8vIEBkZXYgQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGdhbWUgaXMgbGl2ZS4KICAgICAgICBib29sIGdhbWVTdGFydGVkOwogICAgCiAgICAgICAgLy8vIEBkZXYgVGltZSBhdCB3aGljaCB0aGUgZ2FtZSBzdGFydGVkLgogICAgICAgIHVpbnQyNTYgZ2FtZVN0YXJ0VGltZXN0YW1wOwogICAgCiAgICAgICAgLy8vIEBkZXYgS2VlcCB0cmFjayBvZiB0aWxlIG93bmVyc2hpcC4KICAgICAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGlkZW50aWZpZXJUb093bmVyOwogICAgICAgIAogICAgICAgIC8vLyBAZGV2IEtlZXAgdHJhY2sgb2YgdGhlIHRpbWVzdGFtcCBhdCB3aGljaCBhIHRpbGUgd2FzIGZsaXBwZWQgbGFzdC4KICAgICAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIGlkZW50aWZpZXJUb1RpbWVvdXRUaW1lc3RhbXA7CiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgQ3VycmVudCB0aWxlIHByaWNlLgogICAgICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgaWRlbnRpZmllclRvQnV5b3V0UHJpY2U7CiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgVGhlIG51bWJlciBvZiB0aWxlcyBvd25lZCBieSBhbiBhZGRyZXNzLgogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYWRkcmVzc1RvTnVtYmVyT2ZUaWxlczsKICAgICAgICAKICAgICAgICAvLy8gQGRldiBUaGUgbnVtYmVyIG9mIHRpbGUgZmxpcHMgcGVyZm9ybWVkLgogICAgICAgIHVpbnQyNTYgbnVtYmVyT2ZUaWxlRmxpcHM7CiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgS2VlcCB0cmFjayBvZiB0aGUgdGlsZSB0aGF0IHdpbGwgYmVjb21lIGluYWN0aXZlIGxhc3QuCiAgICAgICAgdWludDI1NiBsYXN0VGlsZTsKICAgICAgICAKICAgICAgICAvLy8gQGRldiBLZWVwIHRyYWNrIG9mIHRoZSB0aW1lb3V0IG9mIHRoZSBwZW51bHRpbWF0ZSB0aWxlLgogICAgICAgIHVpbnQyNTYgcGVudWx0aW1hdGVUaWxlVGltZW91dDsKICAgICAgICAKICAgICAgICAvLy8gQGRldiBUaGUgcHJpemUgcG9vbC4KICAgICAgICB1aW50MjU2IHByaXplUG9vbDsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgTWFwcGluZyBmcm9tIGdhbWUgaW5kaWNlcyB0byBnYW1lIHN0YXRlcy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gR2FtZVN0YXRlKSBwdWJsaWMgZ2FtZVN0YXRlczsKICAgIAogICAgLy8vIEBub3RpY2UgVGhlIGluZGV4IG9mIHRoZSBjdXJyZW50IGdhbWUuCiAgICB1aW50MjU2IHB1YmxpYyBnYW1lSW5kZXggPSAwOwogICAgCiAgICAvLy8gQG5vdGljZSBDdXJyZW50IGdhbWUgc2V0dGluZ3MuCiAgICBHYW1lU2V0dGluZ3MgcHVibGljIGdhbWVTZXR0aW5nczsKICAgIAogICAgLy8vIEBkZXYgU2V0dGluZ3MgZm9yIHRoZSBuZXh0IGdhbWUKICAgIEdhbWVTZXR0aW5ncyBwdWJsaWMgbmV4dEdhbWVTZXR0aW5nczsKICAgIAogICAgLy8vIEBub3RpY2UgVGltZSB3aW5kb3dzIGluIHNlY29uZHMgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHdlZWsKICAgIC8vLyB3aGVuIG5ldyBnYW1lcyBjYW4gYmUgc3RhcnRlZC4KICAgIHVpbnQyNTZbXSBwdWJsaWMgYWN0aXZlVGltZXNGcm9tOwogICAgdWludDI1NltdIHB1YmxpYyBhY3RpdmVUaW1lc1RvOwogICAgCiAgICAvLy8gQG5vdGljZSBXaGV0aGVyIHRoZSBnYW1lIGNhbiBzdGFydCBvbmNlIG91dHNpZGUgb2YgYWN0aXZlIHRpbWVzLgogICAgYm9vbCBwdWJsaWMgYWxsb3dTdGFydDsKICAgIAogICAgZnVuY3Rpb24gQnVybnVwR2FtZUJhc2UoKSBwdWJsaWMgewogICAgICAgIC8vIEluaXRpYWwgc2V0dGluZ3MuCiAgICAgICAgc2V0TmV4dEdhbWVTZXR0aW5ncygKICAgICAgICAgICAgNCwgLy8gcm93cwogICAgICAgICAgICA1LCAvLyBjb2xzCiAgICAgICAgICAgIDMwMCwgLy8gaW5pdGlhbEFjdGl2aXR5VGltZXIgLy8gdG9kbyBzZXQgdG8gNjAwCiAgICAgICAgICAgIDE1MCwgLy8gZmluYWxBY3Rpdml0eVRpbWVyIC8vIHRvZG8gc2V0IHRvIDE1MAogICAgICAgICAgICA1LCAvLyBudW1iZXJPZkZsaXBzVG9GaW5hbEFjdGl2aXR5VGltZXIgLy8gdG9kbyBzZXQgdG8gODAKICAgICAgICAgICAgMzAsIC8vIHRpbWVvdXRCb251c1RpbWUKICAgICAgICAgICAgMC4wMSBldGhlciwgLy8gdW5jbGFpbWVkVGlsZVByaWNlCiAgICAgICAgICAgIDc1MCwgLy8gYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UKICAgICAgICAgICAgNDAwMDAsIC8vIGZpcnN0QnV5b3V0UHJpemVQb29sUGVyY2VudGFnZQogICAgICAgICAgICAxMDAwMCwgLy8gYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZQogICAgICAgICAgICA1MDAwLCAvLyBidXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UKICAgICAgICAgICAgMjUwMCwgLy8gYnV5b3V0RmVlUGVyY2VudGFnZQogICAgICAgICAgICAxNTAwMDAgLy8gYnV5b3V0UHJpY2VJbmNyZWFzZVBlcmNlbnRhZ2UKICAgICAgICApOwogICAgfQogICAgCiAgICAvLy8gQGRldiBUZXN0IHdoZXRoZXIgdGhlIGNvb3JkaW5hdGUgaXMgdmFsaWQuCiAgICAvLy8gQHBhcmFtIHggVGhlIHgtcGFydCBvZiB0aGUgY29vcmRpbmF0ZSB0byB0ZXN0LgogICAgLy8vIEBwYXJhbSB5IFRoZSB5LXBhcnQgb2YgdGhlIGNvb3JkaW5hdGUgdG8gdGVzdC4KICAgIGZ1bmN0aW9uIHZhbGlkQ29vcmRpbmF0ZSh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHggPCBnYW1lU2V0dGluZ3MuY29scyAmJiB5IDwgZ2FtZVNldHRpbmdzLnJvd3M7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFJlcHJlc2VudCBhIDJEIGNvb3JkaW5hdGUgYXMgYSBzaW5nbGUgdWludC4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1jb29yZGluYXRlLgogICAgLy8vIEBwYXJhbSB5IFRoZSB5LWNvb3JkaW5hdGUuCiAgICBmdW5jdGlvbiBjb29yZGluYXRlVG9JZGVudGlmaWVyKHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKHZhbGlkQ29vcmRpbmF0ZSh4LCB5KSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuICh5ICogZ2FtZVNldHRpbmdzLmNvbHMpICsgeCArIDE7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFR1cm4gYSBzaW5nbGUgdWludCByZXByZXNlbnRhdGlvbiBvZiBhIGNvb3JkaW5hdGUgaW50byBpdHMgeCBhbmQgeSBwYXJ0cy4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgdWludCByZXByZXNlbnRhdGlvbiBvZiBhIGNvb3JkaW5hdGUuCiAgICAvLy8gQXNzdW1lcyB0aGUgaWRlbnRpZmllciBpcyB2YWxpZC4KICAgIGZ1bmN0aW9uIGlkZW50aWZpZXJUb0Nvb3JkaW5hdGUodWludDI1NiBpZGVudGlmaWVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYgeCwgdWludDI1NiB5KSB7CiAgICAgICAgeSA9IChpZGVudGlmaWVyIC0gMSkgLyBnYW1lU2V0dGluZ3MuY29sczsKICAgICAgICB4ID0gKGlkZW50aWZpZXIgLSAxKSAtICh5ICogZ2FtZVNldHRpbmdzLmNvbHMpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXRzIHRoZSBzZXR0aW5ncyBmb3IgdGhlIG5leHQgZ2FtZS4KICAgIGZ1bmN0aW9uIHNldE5leHRHYW1lU2V0dGluZ3MoCiAgICAgICAgdWludDI1NiByb3dzLAogICAgICAgIHVpbnQyNTYgY29scywKICAgICAgICB1aW50MjU2IGluaXRpYWxBY3Rpdml0eVRpbWVyLAogICAgICAgIHVpbnQyNTYgZmluYWxBY3Rpdml0eVRpbWVyLAogICAgICAgIHVpbnQyNTYgbnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyLAogICAgICAgIHVpbnQyNTYgdGltZW91dEJvbnVzVGltZSwKICAgICAgICB1aW50MjU2IHVuY2xhaW1lZFRpbGVQcmljZSwKICAgICAgICB1aW50MjU2IGJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLAogICAgICAgIHVpbnQyNTYgZmlyc3RCdXlvdXRQcml6ZVBvb2xQZXJjZW50YWdlLAogICAgICAgIHVpbnQyNTYgYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSwKICAgICAgICB1aW50MjU2IGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSwKICAgICAgICB1aW50MjU2IGJ1eW91dEZlZVBlcmNlbnRhZ2UsCiAgICAgICAgdWludDI1NiBidXlvdXRQcmljZUluY3JlYXNlUGVyY2VudGFnZQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlDRk8KICAgIHsKICAgICAgICAvLyBCdXlvdXQgZGl2aWRlbmQgbXVzdCBiZSAyJSBhdCB0aGUgbGVhc3QuCiAgICAgICAgLy8gQnV5b3V0IGRpdmlkZW5kIHBlcmNlbnRhZ2UgbWF5IGJlIDEyLjUlIGF0IHRoZSBtb3N0LgogICAgICAgIHJlcXVpcmUoMjAwMCA8PSBidXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UgJiYgYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlIDw9IDEyNTAwKTsKICAgICAgICAKICAgICAgICAvLyBCdXlvdXQgZmVlIG1heSBiZSA1JSBhdCB0aGUgbW9zdC4KICAgICAgICByZXF1aXJlKGJ1eW91dEZlZVBlcmNlbnRhZ2UgPD0gNTAwMCk7CiAgICAgICAgCiAgICAgICAgaWYgKG51bWJlck9mRmxpcHNUb0ZpbmFsQWN0aXZpdHlUaW1lciA9PSAwKSB7CiAgICAgICAgICAgIHJlcXVpcmUoaW5pdGlhbEFjdGl2aXR5VGltZXIgPT0gZmluYWxBY3Rpdml0eVRpbWVyKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbmV4dEdhbWVTZXR0aW5ncyA9IEdhbWVTZXR0aW5ncyh7CiAgICAgICAgICAgIHJvd3M6IHJvd3MsCiAgICAgICAgICAgIGNvbHM6IGNvbHMsCiAgICAgICAgICAgIGluaXRpYWxBY3Rpdml0eVRpbWVyOiBpbml0aWFsQWN0aXZpdHlUaW1lciwKICAgICAgICAgICAgZmluYWxBY3Rpdml0eVRpbWVyOiBmaW5hbEFjdGl2aXR5VGltZXIsCiAgICAgICAgICAgIG51bWJlck9mRmxpcHNUb0ZpbmFsQWN0aXZpdHlUaW1lcjogbnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyLAogICAgICAgICAgICB0aW1lb3V0Qm9udXNUaW1lOiB0aW1lb3V0Qm9udXNUaW1lLAogICAgICAgICAgICB1bmNsYWltZWRUaWxlUHJpY2U6IHVuY2xhaW1lZFRpbGVQcmljZSwKICAgICAgICAgICAgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2U6IGJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLAogICAgICAgICAgICBmaXJzdEJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2U6IGZpcnN0QnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSwKICAgICAgICAgICAgYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZTogYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSwKICAgICAgICAgICAgYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlOiBidXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UsCiAgICAgICAgICAgIGJ1eW91dEZlZVBlcmNlbnRhZ2U6IGJ1eW91dEZlZVBlcmNlbnRhZ2UsCiAgICAgICAgICAgIGJ1eW91dFByaWNlSW5jcmVhc2VQZXJjZW50YWdlOiBidXlvdXRQcmljZUluY3JlYXNlUGVyY2VudGFnZQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIE5leHRHYW1lKAogICAgICAgICAgICByb3dzLAogICAgICAgICAgICBjb2xzLAogICAgICAgICAgICBpbml0aWFsQWN0aXZpdHlUaW1lciwKICAgICAgICAgICAgZmluYWxBY3Rpdml0eVRpbWVyLAogICAgICAgICAgICBudW1iZXJPZkZsaXBzVG9GaW5hbEFjdGl2aXR5VGltZXIsCiAgICAgICAgICAgIHRpbWVvdXRCb251c1RpbWUsCiAgICAgICAgICAgIHVuY2xhaW1lZFRpbGVQcmljZSwKICAgICAgICAgICAgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UsIAogICAgICAgICAgICBmaXJzdEJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UsCiAgICAgICAgICAgIGJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UsCiAgICAgICAgICAgIGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSwKICAgICAgICAgICAgYnV5b3V0RmVlUGVyY2VudGFnZSwKICAgICAgICAgICAgYnV5b3V0UHJpY2VJbmNyZWFzZVBlcmNlbnRhZ2UKICAgICAgICApOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIGFjdGl2ZSB0aW1lcy4KICAgIGZ1bmN0aW9uIHNldEFjdGl2ZVRpbWVzKHVpbnQyNTZbXSBfZnJvbSwgdWludDI1NltdIF90bykgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgcmVxdWlyZShfZnJvbS5sZW5ndGggPT0gX3RvLmxlbmd0aCk7CiAgICAKICAgICAgICBhY3RpdmVUaW1lc0Zyb20gPSBfZnJvbTsKICAgICAgICBhY3RpdmVUaW1lc1RvID0gX3RvOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgQWN0aXZlVGltZXMoX2Zyb20sIF90byk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFsbG93IHRoZSBnYW1lIHRvIHN0YXJ0IG9uY2Ugb3V0c2lkZSBvZiBhY3RpdmUgdGltZXMuCiAgICBmdW5jdGlvbiBzZXRBbGxvd1N0YXJ0KGJvb2wgX2FsbG93U3RhcnQpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIGFsbG93U3RhcnQgPSBfYWxsb3dTdGFydDsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGV2ZW50LgogICAgICAgIEFsbG93U3RhcnQoX2FsbG93U3RhcnQpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIGEgbmV3IGdhbWUgY2FuIHN0YXJ0LAogICAgLy8vIGJhc2VkIG9uIHRoZSBhY3RpdmUgdGltZXMuCiAgICBmdW5jdGlvbiBjYW5TdGFydCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBHZXQgdGhlIHRpbWUgb2YgdGhlIHdlZWsgaW4gc2Vjb25kcy4KICAgICAgICAvLyBUaGVyZSBhcmUgNyAqIDI0ICogNjAgKiA2MCA9IDYwNDgwMCBzZWNvbmRzIGluIGEgd2VlaywKICAgICAgICAvLyBhbmQgdW5peCB0aW1lc3RhbXBzIHN0YXJ0ZWQgY291bnRpbmcgZnJvbSBhIFRodXJzZGF5LAogICAgICAgIC8vIHNvIHN1YnRyYWN0IDQgKiAyNCAqIDYwICogNjAgPSAzNDU2MDAgc2Vjb25kcywgYXMKICAgICAgICAvLyAoMCAtIDM0NTYwMCkgJSA2MDQ4MDAgPSAyNTkyMDAsIGkuZS4gdGhlIG51bWJlciBvZgogICAgICAgIC8vIHNlY29uZHMgaW4gYSB3ZWVrIHVudGlsIFRodXJzZGF5IDAwOjAwOjAwLgogICAgICAgIHVpbnQyNTYgdGltZU9mV2VlayA9IChibG9jay50aW1lc3RhbXAgLSAzNDU2MDApICUgNjA0ODAwOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgd2luZG93cyA9IGFjdGl2ZVRpbWVzRnJvbS5sZW5ndGg7CiAgICAgICAgCiAgICAgICAgaWYgKHdpbmRvd3MgPT0gMCkgewogICAgICAgICAgICAvLyBObyBzdGFydCB0aW1lcyBjb25maWd1cmVkLCBhbnkgdGltZSBpcyBhbGxvd2VkLgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgd2luZG93czsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aW1lT2ZXZWVrID49IGFjdGl2ZVRpbWVzRnJvbVtpXSAmJiB0aW1lT2ZXZWVrIDw9IGFjdGl2ZVRpbWVzVG9baV0pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlIHRoZSBjdXJyZW50IGdhbWUncyBiYXNlIHRpbWVvdXQuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVCYXNlVGltZW91dCgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgX251bWJlck9mVGlsZUZsaXBzID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLm51bWJlck9mVGlsZUZsaXBzOwogICAgCiAgICAgICAgaWYgKF9udW1iZXJPZlRpbGVGbGlwcyA+PSBnYW1lU2V0dGluZ3MubnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyIHx8IGdhbWVTZXR0aW5ncy5udW1iZXJPZkZsaXBzVG9GaW5hbEFjdGl2aXR5VGltZXIgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZ2FtZVNldHRpbmdzLmZpbmFsQWN0aXZpdHlUaW1lcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZ2FtZVNldHRpbmdzLmZpbmFsQWN0aXZpdHlUaW1lciA8PSBnYW1lU2V0dGluZ3MuaW5pdGlhbEFjdGl2aXR5VGltZXIpIHsKICAgICAgICAgICAgICAgIC8vIFRoZSBhY3Rpdml0eSB0aW1lciBkZWNyZWFzZXMgb3ZlciB0aW1lLgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRoaXMgY2Fubm90IHVuZGVyZmxvdywgYXMgaW5pdGlhbEFjdGl2aXR5VGltZXIgaXMgZ3VhcmFudGVlZCB0byBiZQogICAgICAgICAgICAgICAgLy8gZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGZpbmFsQWN0aXZpdHlUaW1lci4KICAgICAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IGdhbWVTZXR0aW5ncy5pbml0aWFsQWN0aXZpdHlUaW1lciAtIGdhbWVTZXR0aW5ncy5maW5hbEFjdGl2aXR5VGltZXI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGVjcmVhc2UgaW4gYWN0aXZpdHkgdGltZXIsIGJhc2VkIG9uIHRoZSBudW1iZXIgb2Ygd2FnZXJzIHBlcmZvcm1lZC4KICAgICAgICAgICAgICAgIHVpbnQyNTYgZGVjcmVhc2UgPSBkaWZmZXJlbmNlLm11bChfbnVtYmVyT2ZUaWxlRmxpcHMpLmRpdihnYW1lU2V0dGluZ3MubnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGhpcyBzdWJ0cmFjdGlvbiBjYW5ub3QgdW5kZXJmbG93LCBhcyBkZWNyZWFzZSBpcyBndWFyYW50ZWVkIHRvIGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byBpbml0aWFsQWN0aXZpdHlUaW1lci4gICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiAoZ2FtZVNldHRpbmdzLmluaXRpYWxBY3Rpdml0eVRpbWVyIC0gZGVjcmVhc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gVGhlIGFjdGl2aXR5IHRpbWVyIGluY3JlYXNlcyBvdmVyIHRpbWUuCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGhpcyBjYW5ub3QgdW5kZXJmbG93LCBhcyBpbml0aWFsQWN0aXZpdHlUaW1lciBpcyBndWFyYW50ZWVkIHRvIGJlCiAgICAgICAgICAgICAgICAvLyBzbWFsbGVyIHRoYW4gZmluYWxBY3Rpdml0eVRpbWVyLgogICAgICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGdhbWVTZXR0aW5ncy5maW5hbEFjdGl2aXR5VGltZXIgLSBnYW1lU2V0dGluZ3MuaW5pdGlhbEFjdGl2aXR5VGltZXI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgaW5jcmVhc2UgaW4gYWN0aXZpdHkgdGltZXIsIGJhc2VkIG9uIHRoZSBudW1iZXIgb2Ygd2FnZXJzIHBlcmZvcm1lZC4KICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5jcmVhc2UgPSBkaWZmZXJlbmNlLm11bChfbnVtYmVyT2ZUaWxlRmxpcHMpLmRpdihnYW1lU2V0dGluZ3MubnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGhpcyBhZGRpdGlvbiBjYW5ub3Qgb3ZlcmZsb3csIGFzIGluaXRpYWxBY3Rpdml0eVRpbWVyICsgaW5jcmVhc2UgaXMgZ3VhcmFudGVlZCB0byBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gZmluYWxBY3Rpdml0eVRpbWVyLgogICAgICAgICAgICAgICAgcmV0dXJuIChnYW1lU2V0dGluZ3MuaW5pdGlhbEFjdGl2aXR5VGltZXIgKyBpbmNyZWFzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgbmV3IHRpbWVvdXQgdGltZXN0YW1wIGZvciBhIHRpbGUuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIgb2YgdGhlIHRpbGUgYmVpbmcgZmxpcHBlZC4KICAgIC8vLyBAcGFyYW0gcGxheWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIgZmxpcHBpbmcgdGhlIHRpbGUuCiAgICBmdW5jdGlvbiB0aWxlVGltZW91dFRpbWVzdGFtcCh1aW50MjU2IGlkZW50aWZpZXIsIGFkZHJlc3MgcGxheWVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBib251c1RpbWUgPSBnYW1lU2V0dGluZ3MudGltZW91dEJvbnVzVGltZS5tdWwoZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmFkZHJlc3NUb051bWJlck9mVGlsZXNbcGxheWVyXSk7CiAgICAgICAgdWludDI1NiB0aW1lb3V0VGltZXN0YW1wID0gYmxvY2sudGltZXN0YW1wLmFkZChjYWxjdWxhdGVCYXNlVGltZW91dCgpKS5hZGQoYm9udXNUaW1lKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGN1cnJlbnRUaW1lb3V0VGltZXN0YW1wID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb1RpbWVvdXRUaW1lc3RhbXBbaWRlbnRpZmllcl07CiAgICAgICAgaWYgKGN1cnJlbnRUaW1lb3V0VGltZXN0YW1wID09IDApIHsKICAgICAgICAgICAgLy8gVGlsZSBoYXMgbmV2ZXIgYmVlbiBmbGlwcGVkIGJlZm9yZS4KICAgICAgICAgICAgY3VycmVudFRpbWVvdXRUaW1lc3RhbXAgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uZ2FtZVN0YXJ0VGltZXN0YW1wLmFkZChnYW1lU2V0dGluZ3MuaW5pdGlhbEFjdGl2aXR5VGltZXIpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodGltZW91dFRpbWVzdGFtcCA+PSBjdXJyZW50VGltZW91dFRpbWVzdGFtcCkgewogICAgICAgICAgICByZXR1cm4gdGltZW91dFRpbWVzdGFtcDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gY3VycmVudFRpbWVvdXRUaW1lc3RhbXA7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBTZXQgdGhlIGN1cnJlbnQgZ2FtZSBzZXR0aW5ncy4KICAgIGZ1bmN0aW9uIF9zZXRHYW1lU2V0dGluZ3MoKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGdhbWVTZXR0aW5ncy5yb3dzICE9IG5leHRHYW1lU2V0dGluZ3Mucm93cykgewogICAgICAgICAgICBnYW1lU2V0dGluZ3Mucm93cyA9IG5leHRHYW1lU2V0dGluZ3Mucm93czsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGdhbWVTZXR0aW5ncy5jb2xzICE9IG5leHRHYW1lU2V0dGluZ3MuY29scykgewogICAgICAgICAgICBnYW1lU2V0dGluZ3MuY29scyA9IG5leHRHYW1lU2V0dGluZ3MuY29sczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGdhbWVTZXR0aW5ncy5pbml0aWFsQWN0aXZpdHlUaW1lciAhPSBuZXh0R2FtZVNldHRpbmdzLmluaXRpYWxBY3Rpdml0eVRpbWVyKSB7CiAgICAgICAgICAgIGdhbWVTZXR0aW5ncy5pbml0aWFsQWN0aXZpdHlUaW1lciA9IG5leHRHYW1lU2V0dGluZ3MuaW5pdGlhbEFjdGl2aXR5VGltZXI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChnYW1lU2V0dGluZ3MuZmluYWxBY3Rpdml0eVRpbWVyICE9IG5leHRHYW1lU2V0dGluZ3MuZmluYWxBY3Rpdml0eVRpbWVyKSB7CiAgICAgICAgICAgIGdhbWVTZXR0aW5ncy5maW5hbEFjdGl2aXR5VGltZXIgPSBuZXh0R2FtZVNldHRpbmdzLmZpbmFsQWN0aXZpdHlUaW1lcjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGdhbWVTZXR0aW5ncy5udW1iZXJPZkZsaXBzVG9GaW5hbEFjdGl2aXR5VGltZXIgIT0gbmV4dEdhbWVTZXR0aW5ncy5udW1iZXJPZkZsaXBzVG9GaW5hbEFjdGl2aXR5VGltZXIpIHsKICAgICAgICAgICAgZ2FtZVNldHRpbmdzLm51bWJlck9mRmxpcHNUb0ZpbmFsQWN0aXZpdHlUaW1lciA9IG5leHRHYW1lU2V0dGluZ3MubnVtYmVyT2ZGbGlwc1RvRmluYWxBY3Rpdml0eVRpbWVyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoZ2FtZVNldHRpbmdzLnRpbWVvdXRCb251c1RpbWUgIT0gbmV4dEdhbWVTZXR0aW5ncy50aW1lb3V0Qm9udXNUaW1lKSB7CiAgICAgICAgICAgIGdhbWVTZXR0aW5ncy50aW1lb3V0Qm9udXNUaW1lID0gbmV4dEdhbWVTZXR0aW5ncy50aW1lb3V0Qm9udXNUaW1lOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoZ2FtZVNldHRpbmdzLnVuY2xhaW1lZFRpbGVQcmljZSAhPSBuZXh0R2FtZVNldHRpbmdzLnVuY2xhaW1lZFRpbGVQcmljZSkgewogICAgICAgICAgICBnYW1lU2V0dGluZ3MudW5jbGFpbWVkVGlsZVByaWNlID0gbmV4dEdhbWVTZXR0aW5ncy51bmNsYWltZWRUaWxlUHJpY2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChnYW1lU2V0dGluZ3MuYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UgIT0gbmV4dEdhbWVTZXR0aW5ncy5idXlvdXRSZWZlcnJhbEJvbnVzUGVyY2VudGFnZSkgewogICAgICAgICAgICBnYW1lU2V0dGluZ3MuYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UgPSBuZXh0R2FtZVNldHRpbmdzLmJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoZ2FtZVNldHRpbmdzLmZpcnN0QnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSAhPSBuZXh0R2FtZVNldHRpbmdzLmZpcnN0QnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSkgewogICAgICAgICAgICBnYW1lU2V0dGluZ3MuZmlyc3RCdXlvdXRQcml6ZVBvb2xQZXJjZW50YWdlID0gbmV4dEdhbWVTZXR0aW5ncy5maXJzdEJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChnYW1lU2V0dGluZ3MuYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSAhPSBuZXh0R2FtZVNldHRpbmdzLmJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UpIHsKICAgICAgICAgICAgZ2FtZVNldHRpbmdzLmJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UgPSBuZXh0R2FtZVNldHRpbmdzLmJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChnYW1lU2V0dGluZ3MuYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlICE9IG5leHRHYW1lU2V0dGluZ3MuYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlKSB7CiAgICAgICAgICAgIGdhbWVTZXR0aW5ncy5idXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UgPSBuZXh0R2FtZVNldHRpbmdzLmJ1eW91dERpdmlkZW5kUGVyY2VudGFnZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGdhbWVTZXR0aW5ncy5idXlvdXRGZWVQZXJjZW50YWdlICE9IG5leHRHYW1lU2V0dGluZ3MuYnV5b3V0RmVlUGVyY2VudGFnZSkgewogICAgICAgICAgICBnYW1lU2V0dGluZ3MuYnV5b3V0RmVlUGVyY2VudGFnZSA9IG5leHRHYW1lU2V0dGluZ3MuYnV5b3V0RmVlUGVyY2VudGFnZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGdhbWVTZXR0aW5ncy5idXlvdXRQcmljZUluY3JlYXNlUGVyY2VudGFnZSAhPSBuZXh0R2FtZVNldHRpbmdzLmJ1eW91dFByaWNlSW5jcmVhc2VQZXJjZW50YWdlKSB7CiAgICAgICAgICAgIGdhbWVTZXR0aW5ncy5idXlvdXRQcmljZUluY3JlYXNlUGVyY2VudGFnZSA9IG5leHRHYW1lU2V0dGluZ3MuYnV5b3V0UHJpY2VJbmNyZWFzZVBlcmNlbnRhZ2U7CiAgICAgICAgfQogICAgfQp9CgoKLy8vIEBkZXYgSG9sZHMgb3duZXJzaGlwIGZ1bmN0aW9uYWxpdHkgc3VjaCBhcyB0cmFuc2ZlcnJpbmcuCmNvbnRyYWN0IEJ1cm51cEdhbWVPd25lcnNoaXAgaXMgQnVybnVwR2FtZUJhc2UgewogICAgCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgZGVlZElkKTsKICAgIAogICAgLy8vIEBub3RpY2UgTmFtZSBvZiB0aGUgY29sbGVjdGlvbiBvZiBkZWVkcyAobm9uLWZ1bmdpYmxlIHRva2VuKSwgYXMgZGVmaW5lZCBpbiBFUkM3MjFNZXRhZGF0YS4KICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWROYW1lKSB7CiAgICAgICAgX2RlZWROYW1lID0gIkJ1cm51cCBUaWxlcyI7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFN5bWJvbCBvZiB0aGUgY29sbGVjdGlvbiBvZiBkZWVkcyAobm9uLWZ1bmdpYmxlIHRva2VuKSwgYXMgZGVmaW5lZCBpbiBFUkM3MjFNZXRhZGF0YS4KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZFN5bWJvbCkgewogICAgICAgIF9kZWVkU3ltYm9sID0gIkJVUk4iOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIG93bnMgYSBwYXJ0aWN1bGFyIHRpbGUuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgdG8gY2hlY2sgZm9yLgogICAgLy8vIEBwYXJhbSBfaWRlbnRpZmllciBUaGUgdGlsZSBpZGVudGlmaWVyIHRvIGNoZWNrIGZvci4KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pZGVudGlmaWVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb093bmVyW19pZGVudGlmaWVyXSA9PSBfb3duZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgZGVlZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdGhlIGRlZWQgdG8uCiAgICAvLy8gQHBhcmFtIF9pZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9pZGVudGlmaWVyKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwLgogICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9Pd25lcltfaWRlbnRpZmllcl0gPSBfdG87CiAgICAgICAgCiAgICAgICAgaWYgKF9mcm9tICE9IDB4MCkgewogICAgICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0uYWRkcmVzc1RvTnVtYmVyT2ZUaWxlc1tfZnJvbV0gPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uYWRkcmVzc1RvTnVtYmVyT2ZUaWxlc1tfZnJvbV0uc3ViKDEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0uYWRkcmVzc1RvTnVtYmVyT2ZUaWxlc1tfdG9dID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmFkZHJlc3NUb051bWJlck9mVGlsZXNbX3RvXS5hZGQoMSk7CiAgICAgICAgCiAgICAgICAgLy8gRW1pdCB0aGUgdHJhbnNmZXIgZXZlbnQuCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2lkZW50aWZpZXIpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBhZGRyZXNzIGN1cnJlbnRseSBhc3NpZ25lZCBvd25lcnNoaXAgb2YgYSBnaXZlbiBkZWVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfaWRlbnRpZmllcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIF9vd25lcikgewogICAgICAgIF9vd25lciA9IGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9Pd25lcltfaWRlbnRpZmllcl07CgogICAgICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIGRlZWQgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vIGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxLCBvciB5b3VyCiAgICAvLy8gZGVlZCBtYXkgYmUgbG9zdCBmb3JldmVyLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2lkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gdHJhbnNmZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2lkZW50aWZpZXIpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIE9uZSBjYW4gb25seSB0cmFuc2ZlciB0aGVpciBvd24gZGVlZHMuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfaWRlbnRpZmllcikpOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9pZGVudGlmaWVyKTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgUHVsbFBheW1lbnQKICogQGRldiBCYXNlIGNvbnRyYWN0IHN1cHBvcnRpbmcgYXN5bmMgc2VuZCBmb3IgcHVsbCBwYXltZW50cy4gSW5oZXJpdCBmcm9tIHRoaXMKICogY29udHJhY3QgYW5kIHVzZSBhc3luY1NlbmQgaW5zdGVhZCBvZiBzZW5kLgogKi8KY29udHJhY3QgUHVsbFBheW1lbnQgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHBheW1lbnRzOwogIHVpbnQyNTYgcHVibGljIHRvdGFsUGF5bWVudHM7CgogIC8qKgogICogQGRldiB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUuCiAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkgcHVibGljIHsKICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOwoKICAgIHJlcXVpcmUocGF5bWVudCAhPSAwKTsKICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHBheW1lbnQpOwoKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLnN1YihwYXltZW50KTsKICAgIHBheW1lbnRzW3BheWVlXSA9IDA7CgogICAgYXNzZXJ0KHBheWVlLnNlbmQocGF5bWVudCkpOwogIH0KCiAgLyoqCiAgKiBAZGV2IENhbGxlZCBieSB0aGUgcGF5ZXIgdG8gc3RvcmUgdGhlIHNlbnQgYW1vdW50IGFzIGNyZWRpdCB0byBiZSBwdWxsZWQuCiAgKiBAcGFyYW0gZGVzdCBUaGUgZGVzdGluYXRpb24gYWRkcmVzcyBvZiB0aGUgZnVuZHMuCiAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgKi8KICBmdW5jdGlvbiBhc3luY1NlbmQoYWRkcmVzcyBkZXN0LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgcGF5bWVudHNbZGVzdF0gPSBwYXltZW50c1tkZXN0XS5hZGQoYW1vdW50KTsKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLmFkZChhbW91bnQpOwogIH0KfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIEJ1cm5VcCB3YWxsZXQuCmNvbnRyYWN0IEJ1cm51cEhvbGRpbmdBY2Nlc3NDb250cm9sIGlzIENsYWltYWJsZSwgUGF1c2FibGUsIENhblJlY2xhaW1Ub2tlbiB7CiAgICBhZGRyZXNzIHB1YmxpYyBjZm9BZGRyZXNzOwogICAgCiAgICAvLy8gQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgYW4gYWRkcmVzcyBpcyBhIEJ1cm5VcCBHYW1lIGNvbnRyYWN0LgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBidXJudXBHYW1lOwoKICAgIGZ1bmN0aW9uIEJ1cm51cEhvbGRpbmdBY2Nlc3NDb250cm9sKCkgcHVibGljIHsKICAgICAgICAvLyBUaGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0ZPLgogICAgICAgIGNmb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkuCiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIGZ1bmN0aW9uYWxpdHkgdGhhdCBtYXkgb25seSBiZSBjYWxsZWQgYnkgYSBCdXJuVXAgZ2FtZS4KICAgIG1vZGlmaWVyIG9ubHlCdXJudXBHYW1lKCkgewogICAgICAgIC8vIFRoZSBzZW5kZXIgbXVzdCBiZSBhIHJlY29nbml6ZWQgQnVyblVwIGdhbWUgYWRkcmVzcy4KICAgICAgICByZXF1aXJlKGJ1cm51cEdhbWVbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0ZPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBjb250cmFjdCBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld0NGTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENGTy4KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfbmV3Q0ZPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjZm9BZGRyZXNzID0gX25ld0NGTzsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQWRkIGEgQnVybnVwIGdhbWUgY29udHJhY3QgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgQnVybnVwIGdhbWUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBhZGRCdXJudXBHYW1lKGFkZHJlc3MgYWRkcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBidXJudXBHYW1lW2FkZHJdID0gdHJ1ZTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmVtb3ZlIGEgQnVybnVwIGdhbWUgY29udHJhY3QgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgQnVybnVwIGdhbWUgY29udHJhY3QuCiAgICBmdW5jdGlvbiByZW1vdmVCdXJudXBHYW1lKGFkZHJlc3MgYWRkcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBkZWxldGUgYnVybnVwR2FtZVthZGRyXTsKICAgIH0KfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgdGhlIEJ1cm5VcCB3YWxsZXQuCmNvbnRyYWN0IEJ1cm51cEhvbGRpbmdSZWZlcnJhbCBpcyBCdXJudXBIb2xkaW5nQWNjZXNzQ29udHJvbCB7CgogICAgZXZlbnQgU2V0UmVmZXJyZXIoYWRkcmVzcyBpbmRleGVkIHJlZmVycmFsLCBhZGRyZXNzIGluZGV4ZWQgcmVmZXJyZXIpOwoKICAgIC8vLyBSZWZlcnJlciBvZiBwbGF5ZXIuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGFkZHJlc3MpIGFkZHJlc3NUb1JlZmVycmVyQWRkcmVzczsKICAgIAogICAgLy8vIEdldCB0aGUgcmVmZXJyZXIgb2YgYSBwbGF5ZXIuCiAgICAvLy8gQHBhcmFtIHBsYXllciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyIHRvIGdldCB0aGUgcmVmZXJyZXIgb2YuCiAgICBmdW5jdGlvbiByZWZlcnJlck9mKGFkZHJlc3MgcGxheWVyKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGFkZHJlc3NUb1JlZmVycmVyQWRkcmVzc1twbGF5ZXJdOwogICAgfQogICAgCiAgICAvLy8gU2V0IHRoZSByZWZlcnJlciBmb3IgYSBwbGF5ZXIuCiAgICAvLy8gQHBhcmFtIHBsYXllckFkZHIgVGhlIGFkZHJlc3Mgb2YgdGhlIHBsYXllciB0byBzZXQgdGhlIHJlZmVycmVyIGZvci4KICAgIC8vLyBAcGFyYW0gcmVmZXJyZXJBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSByZWZlcnJlciB0byBzZXQuCiAgICBmdW5jdGlvbiBfc2V0UmVmZXJyZXIoYWRkcmVzcyBwbGF5ZXJBZGRyLCBhZGRyZXNzIHJlZmVycmVyQWRkcikgaW50ZXJuYWwgewogICAgICAgIGFkZHJlc3NUb1JlZmVycmVyQWRkcmVzc1twbGF5ZXJBZGRyXSA9IHJlZmVycmVyQWRkcjsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGV2ZW50LgogICAgICAgIFNldFJlZmVycmVyKHBsYXllckFkZHIsIHJlZmVycmVyQWRkcik7CiAgICB9Cn0KCgovLy8gQGRldiBJbXBsZW1lbnRzIHRoZSBCdXJuVXAgd2FsbGV0Lgpjb250cmFjdCBCdXJudXBIb2xkaW5nQ29yZSBpcyBCdXJudXBIb2xkaW5nUmVmZXJyYWwsIFB1bGxQYXltZW50IHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTE7CiAgICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTI7CiAgICAKICAgIGZ1bmN0aW9uIEJ1cm51cEhvbGRpbmdDb3JlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5MSwgYWRkcmVzcyBfYmVuZWZpY2lhcnkyKSBwdWJsaWMgewogICAgICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRk8uCiAgICAgICAgY2ZvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoZSB0d28gYmVuZWZpY2lhcmllcy4KICAgICAgICBiZW5lZmljaWFyeTEgPSBfYmVuZWZpY2lhcnkxOwogICAgICAgIGJlbmVmaWNpYXJ5MiA9IF9iZW5lZmljaWFyeTI7CiAgICB9CiAgICAKICAgIC8vLyBQYXkgdGhlIHR3byBiZW5lZmljaWFyaWVzLiBTZW5kcyBib3RoIGJlbmVmaWNpYXJpZXMKICAgIC8vLyBhIGhhbHZlIG9mIHRoZSBwYXltZW50LgogICAgZnVuY3Rpb24gcGF5QmVuZWZpY2lhcmllcygpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIHVpbnQyNTYgcGF5bWVudEhhbHZlID0gbXNnLnZhbHVlLmRpdigyKTsKICAgICAgICAKICAgICAgICAvLyBXZSBkbyBub3Qgd2FudCBhIHNpbmdsZSB3ZWkgdG8gZ2V0IHN0dWNrLgogICAgICAgIHVpbnQyNTYgb3RoZXJQYXltZW50SGFsdmUgPSBtc2cudmFsdWUuc3ViKHBheW1lbnRIYWx2ZSk7CiAgICAgICAgCiAgICAgICAgLy8gU2VuZCBwYXltZW50IGZvciBtYW51YWwgd2l0aGRyYXdhbC4KICAgICAgICBhc3luY1NlbmQoYmVuZWZpY2lhcnkxLCBwYXltZW50SGFsdmUpOwogICAgICAgIGFzeW5jU2VuZChiZW5lZmljaWFyeTIsIG90aGVyUGF5bWVudEhhbHZlKTsKICAgIH0KICAgIAogICAgLy8vIFNldHMgYSBuZXcgYWRkcmVzcyBmb3IgQmVuZWZpY2lhcnkgb25lLgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBuZXcgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHNldEJlbmVmaWNpYXJ5MShhZGRyZXNzIGFkZHIpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIGJlbmVmaWNpYXJ5MSA9IGFkZHI7CiAgICB9CiAgICAKICAgIC8vLyBTZXRzIGEgbmV3IGFkZHJlc3MgZm9yIEJlbmVmaWNpYXJ5IHR3by4KICAgIC8vLyBAcGFyYW0gYWRkciBUaGUgbmV3IGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzZXRCZW5lZmljaWFyeTIoYWRkcmVzcyBhZGRyKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICBiZW5lZmljaWFyeTIgPSBhZGRyOwogICAgfQogICAgCiAgICAvLy8gU2V0IGEgcmVmZXJyZXIuCiAgICAvLy8gQHBhcmFtIHBsYXllckFkZHIgVGhlIGFkZHJlc3MgdG8gc2V0IHRoZSByZWZlcnJlciBmb3IuCiAgICAvLy8gQHBhcmFtIHJlZmVycmVyQWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgcmVmZXJyZXIgdG8gc2V0LgogICAgZnVuY3Rpb24gc2V0UmVmZXJyZXIoYWRkcmVzcyBwbGF5ZXJBZGRyLCBhZGRyZXNzIHJlZmVycmVyQWRkcikgZXh0ZXJuYWwgb25seUJ1cm51cEdhbWUgd2hlbk5vdFBhdXNlZCByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAocmVmZXJyZXJPZihwbGF5ZXJBZGRyKSA9PSBhZGRyZXNzKDB4MCkgJiYgcGxheWVyQWRkciAhPSByZWZlcnJlckFkZHIpIHsKICAgICAgICAgICAgLy8gU2V0IHRoZSByZWZlcnJlciwgaWYgbm8gcmVmZXJyZXIgaGFzIGJlZW4gc2V0IHlldCwgYW5kIHRoZSBwbGF5ZXIKICAgICAgICAgICAgLy8gYW5kIHJlZmVycmVyIGFyZSBub3QgdGhlIHNhbWUgYWRkcmVzcy4KICAgICAgICAgICAgX3NldFJlZmVycmVyKHBsYXllckFkZHIsIHJlZmVycmVyQWRkcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJbmRpY2F0ZSBzdWNjZXNzLgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gSW5kaWNhdGUgZmFpbHVyZS4KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCgovLy8gQGRldiBIb2xkcyBmdW5jdGlvbmFsaXR5IGZvciBmaW5hbmNlIHJlbGF0ZWQgdG8gdGlsZXMuCmNvbnRyYWN0IEJ1cm51cEdhbWVGaW5hbmNlIGlzIEJ1cm51cEdhbWVPd25lcnNoaXAsIFB1bGxQYXltZW50IHsKICAgIC8vLyBBZGRyZXNzIG9mIEJ1cm51cCB3YWxsZXQKICAgIEJ1cm51cEhvbGRpbmdDb3JlIGJ1cm51cEhvbGRpbmc7CiAgICAKICAgIGZ1bmN0aW9uIEJ1cm51cEdhbWVGaW5hbmNlKGFkZHJlc3MgYnVybnVwSG9sZGluZ0FkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgYnVybnVwSG9sZGluZyA9IEJ1cm51cEhvbGRpbmdDb3JlKGJ1cm51cEhvbGRpbmdBZGRyZXNzKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgRmluZCB0aGUgX2NsYWltZWRfIHRpbGVzIHN1cnJvdW5kaW5nIGEgdGlsZS4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgdGlsZSB0byBnZXQgdGhlIHN1cnJvdW5kaW5nIHRpbGVzIGZvci4KICAgIGZ1bmN0aW9uIF9jbGFpbWVkU3Vycm91bmRpbmdUaWxlcyh1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIG1lbW9yeSkgewogICAgICAgIHZhciAoeCwgeSkgPSBpZGVudGlmaWVyVG9Db29yZGluYXRlKF9kZWVkSWQpOwogICAgICAgIAogICAgICAgIC8vIEZpbmQgYWxsIGNsYWltZWQgc3Vycm91bmRpbmcgdGlsZXMuCiAgICAgICAgdWludDI1NiBjbGFpbWVkID0gMDsKICAgICAgICAKICAgICAgICAvLyBDcmVhdGUgbWVtb3J5IGJ1ZmZlciBjYXBhYmxlIG9mIGhvbGRpbmcgYWxsIHRpbGVzLgogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX3RpbGVzID0gbmV3IHVpbnQyNTZbXSg4KTsKICAgICAgICAKICAgICAgICAvLyBMb29wIHRocm91Z2ggYWxsIG5laWdoYm9ycy4KICAgICAgICBmb3IgKGludDI1NiBkeCA9IC0xOyBkeCA8PSAxOyBkeCsrKSB7CiAgICAgICAgICAgIGZvciAoaW50MjU2IGR5ID0gLTE7IGR5IDw9IDE7IGR5KyspIHsKICAgICAgICAgICAgICAgIGlmIChkeCA9PSAwICYmIGR5ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIHRoZSBjZW50ZXIgKGkuZS4sIHRoZSB0aWxlIGl0c2VsZikuCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVpbnQyNTYgbnggPSB1aW50MjU2KGludDI1Nih4KSArIGR4KTsKICAgICAgICAgICAgICAgIHVpbnQyNTYgbnkgPSB1aW50MjU2KGludDI1Nih5KSArIGR5KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG54ID49IGdhbWVTZXR0aW5ncy5jb2xzIHx8IG55ID49IGdhbWVTZXR0aW5ncy5yb3dzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBjb29yZGluYXRlIGlzIG91dHNpZGUgdGhlIGdhbWUgYm91bmRzLgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGNvb3JkaW5hdGVzIG9mIHRoaXMgbmVpZ2hib3JpbmcgaWRlbnRpZmllci4KICAgICAgICAgICAgICAgIHVpbnQyNTYgbmVpZ2hib3JJZGVudGlmaWVyID0gY29vcmRpbmF0ZVRvSWRlbnRpZmllcigKICAgICAgICAgICAgICAgICAgICBueCwKICAgICAgICAgICAgICAgICAgICBueQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9Pd25lcltuZWlnaGJvcklkZW50aWZpZXJdICE9IGFkZHJlc3MoMHgwKSkgewogICAgICAgICAgICAgICAgICAgIF90aWxlc1tjbGFpbWVkXSA9IG5laWdoYm9ySWRlbnRpZmllcjsKICAgICAgICAgICAgICAgICAgICBjbGFpbWVkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTWVtb3J5IGFycmF5cyBjYW5ub3QgYmUgcmVzaXplZCwgc28gY29weSBhbGwKICAgICAgICAvLyB0aWxlcyBmcm9tIHRoZSBidWZmZXIgdG8gdGhlIHRpbGUgYXJyYXkuCiAgICAgICAgdWludDI1NltdIG1lbW9yeSB0aWxlcyA9IG5ldyB1aW50MjU2W10oY2xhaW1lZCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgY2xhaW1lZDsgaSsrKSB7CiAgICAgICAgICAgIHRpbGVzW2ldID0gX3RpbGVzW2ldOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gdGlsZXM7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgbmV4dCBidXlvdXQgcHJpY2UgZ2l2ZW4gdGhlIGN1cnJlbnQgdG90YWwgYnV5b3V0IGNvc3QuCiAgICAvLy8gQHBhcmFtIHByaWNlIFRoZSBjdXJyZW50IGJ1eW91dCBwcmljZS4KICAgIGZ1bmN0aW9uIG5leHRCdXlvdXRQcmljZSh1aW50MjU2IHByaWNlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKHByaWNlIDwgMC4wMiBldGhlcikgewogICAgICAgICAgICByZXR1cm4gcHJpY2UubXVsKDIwMCkuZGl2KDEwMCk7IC8vICogMi4wCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHByaWNlLm11bChnYW1lU2V0dGluZ3MuYnV5b3V0UHJpY2VJbmNyZWFzZVBlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXNzaWduIHRoZSBwcm9jZWVkcyBvZiB0aGUgYnV5b3V0LgogICAgZnVuY3Rpb24gX2Fzc2lnbkJ1eW91dFByb2NlZWRzKAogICAgICAgIGFkZHJlc3MgY3VycmVudE93bmVyLAogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMsCiAgICAgICAgdWludDI1NiBmZWUsCiAgICAgICAgdWludDI1NiBjdXJyZW50T3duZXJXaW5uaW5ncywKICAgICAgICB1aW50MjU2IHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSwKICAgICAgICB1aW50MjU2IHJlZmVycmFsQm9udXMsCiAgICAgICAgdWludDI1NiBwcml6ZVBvb2xGdW5kcwogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAKICAgICAgICBpZiAoY3VycmVudE93bmVyICE9IDB4MCkgewogICAgICAgICAgICAvLyBTZW5kIHRoZSBjdXJyZW50IG93bmVyJ3Mgd2lubmluZ3MuCiAgICAgICAgICAgIF9zZW5kRnVuZHMoY3VycmVudE93bmVyLCBjdXJyZW50T3duZXJXaW5uaW5ncyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gY3VycmVudCBvd25lci4gU3BsaXQgdGhlIHdpbm5pbmdzIHRvIHRoZSBwcml6ZSBwb29sIGFuZCBmZWVzLgogICAgICAgICAgICB1aW50MjU2IHByaXplUG9vbFBhcnQgPSBjdXJyZW50T3duZXJXaW5uaW5ncy5tdWwoZ2FtZVNldHRpbmdzLmZpcnN0QnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwcml6ZVBvb2xGdW5kcyA9IHByaXplUG9vbEZ1bmRzLmFkZChwcml6ZVBvb2xQYXJ0KTsKICAgICAgICAgICAgZmVlID0gZmVlLmFkZChjdXJyZW50T3duZXJXaW5uaW5ncy5zdWIocHJpemVQb29sUGFydCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBBc3NpZ24gZGl2aWRlbmRzIHRvIG93bmVycyBvZiBzdXJyb3VuZGluZyB0aWxlcy4KICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBjbGFpbWVkU3Vycm91bmRpbmdUaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGJlbmVmaWNpYXJ5ID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb093bmVyW2NsYWltZWRTdXJyb3VuZGluZ1RpbGVzW2ldXTsKICAgICAgICAgICAgX3NlbmRGdW5kcyhiZW5lZmljaWFyeSwgdG90YWxEaXZpZGVuZFBlckJlbmVmaWNpYXJ5KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8vIERpc3RyaWJ1dGUgdGhlIHJlZmVycmFsIGJvbnVzZXMgKGlmIGFueSkgZm9yIGFuIGFkZHJlc3MuCiAgICAgICAgYWRkcmVzcyByZWZlcnJlcjEgPSBidXJudXBIb2xkaW5nLnJlZmVycmVyT2YobXNnLnNlbmRlcik7CiAgICAgICAgaWYgKHJlZmVycmVyMSAhPSAweDApIHsKICAgICAgICAgICAgX3NlbmRGdW5kcyhyZWZlcnJlcjEsIHJlZmVycmFsQm9udXMpOwogICAgICAgIAogICAgICAgICAgICBhZGRyZXNzIHJlZmVycmVyMiA9IGJ1cm51cEhvbGRpbmcucmVmZXJyZXJPZihyZWZlcnJlcjEpOwogICAgICAgICAgICBpZiAocmVmZXJyZXIyICE9IDB4MCkgewogICAgICAgICAgICAgICAgX3NlbmRGdW5kcyhyZWZlcnJlcjIsIHJlZmVycmFsQm9udXMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gc2Vjb25kLWxldmVsIHJlZmVycmVyLgogICAgICAgICAgICAgICAgZmVlID0gZmVlLmFkZChyZWZlcnJhbEJvbnVzKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBubyBmaXJzdCBhbmQgc2Vjb25kLWxldmVsIHJlZmVycmVycy4KICAgICAgICAgICAgZmVlID0gZmVlLmFkZChyZWZlcnJhbEJvbnVzLm11bCgyKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFNlbmQgdGhlIGZlZSB0byB0aGUgaG9sZGluZyBjb250cmFjdC4KICAgICAgICBidXJudXBIb2xkaW5nLnBheUJlbmVmaWNpYXJpZXMudmFsdWUoZmVlKSgpOwogICAgICAgIAogICAgICAgIC8vIEluY3JlYXNlIHRoZSBwcml6ZSBwb29sLgogICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wcml6ZVBvb2wgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sLmFkZChwcml6ZVBvb2xGdW5kcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgcHJpY2UgZm9yIHRoZSBnaXZlbiB0aWxlLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSB0aWxlIHRvIGdldCB0aGUgcHJpY2UgZm9yLgogICAgZnVuY3Rpb24gY3VycmVudFByaWNlKHVpbnQyNTYgX2RlZWRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBwcmljZSkgewogICAgICAgIGFkZHJlc3MgY3VycmVudE93bmVyID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdOwogICAgCiAgICAgICAgaWYgKGN1cnJlbnRPd25lciA9PSAweDApIHsKICAgICAgICAgICAgcHJpY2UgPSBnYW1lU2V0dGluZ3MudW5jbGFpbWVkVGlsZVByaWNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaWNlID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb0J1eW91dFByaWNlW19kZWVkSWRdOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGFuZCBhc3NpZ24gdGhlIHByb2NlZWRzIGZyb20gdGhlIGJ1eW91dC4KICAgIC8vLyBAcGFyYW0gY3VycmVudE93bmVyIFRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSB0aWxlIHRoYXQgaXMgYmVpbmcgYm91Z2h0IG91dC4KICAgIC8vLyBAcGFyYW0gcHJpY2UgVGhlIHByaWNlIG9mIHRoZSB0aWxlIHRoYXQgaXMgYmVpbmcgYm91Z2h0IG91dC4KICAgIC8vLyBAcGFyYW0gY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMgVGhlIHN1cnJvdW5kaW5nIHRpbGVzIHRoYXQgaGF2ZSBiZWVuIGNsYWltZWQuCiAgICBmdW5jdGlvbiBfY2FsY3VsYXRlQW5kQXNzaWduQnV5b3V0UHJvY2VlZHMoYWRkcmVzcyBjdXJyZW50T3duZXIsIHVpbnQyNTYgcHJpY2UsIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHZhcmlhYmxlIGRpdmlkZW5kcyBiYXNlZCBvbiB0aGUgYnV5b3V0IHByaWNlCiAgICAgICAgLy8gKG9ubHkgdG8gYmUgcGFpZCBpZiB0aGVyZSBhcmUgc3Vycm91bmRpbmcgdGlsZXMpLgogICAgICAgIHVpbnQyNTYgdmFyaWFibGVEaXZpZGVuZHMgPSBwcmljZS5tdWwoZ2FtZVNldHRpbmdzLmJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGZlZXMsIHJlZmVycmFsIGJvbnVzLCBhbmQgcHJpemUgcG9vbCBmdW5kcy4KICAgICAgICB1aW50MjU2IGZlZSAgICAgICAgICAgID0gcHJpY2UubXVsKGdhbWVTZXR0aW5ncy5idXlvdXRGZWVQZXJjZW50YWdlKS5kaXYoMTAwMDAwKTsKICAgICAgICB1aW50MjU2IHJlZmVycmFsQm9udXMgID0gcHJpY2UubXVsKGdhbWVTZXR0aW5ncy5idXlvdXRSZWZlcnJhbEJvbnVzUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgdWludDI1NiBwcml6ZVBvb2xGdW5kcyA9IHByaWNlLm11bChnYW1lU2V0dGluZ3MuYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFuZCBhc3NpZ24gYnV5b3V0IHByb2NlZWRzLgogICAgICAgIHVpbnQyNTYgY3VycmVudE93bmVyV2lubmluZ3MgPSBwcmljZS5zdWIoZmVlKS5zdWIocmVmZXJyYWxCb251cy5tdWwoMikpLnN1Yihwcml6ZVBvb2xGdW5kcyk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnk7CiAgICAgICAgaWYgKGNsYWltZWRTdXJyb3VuZGluZ1RpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIHN1cnJvdW5kaW5nIHRpbGVzLCB2YXJpYWJsZSBkaXZpZGVuZCBpcyB0byBiZSBwYWlkCiAgICAgICAgICAgIC8vIGJhc2VkIG9uIHRoZSBidXlvdXQgcHJpY2UuCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGl2aWRlbmQgcGVyIHN1cnJvdW5kaW5nIHRpbGUuCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSA9IHZhcmlhYmxlRGl2aWRlbmRzIC8gY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMubGVuZ3RoOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY3VycmVudE93bmVyV2lubmluZ3MgPSBjdXJyZW50T3duZXJXaW5uaW5ncy5zdWIodmFyaWFibGVEaXZpZGVuZHMpOwogICAgICAgICAgICBjdXJyZW50T3duZXJXaW5uaW5ncyA9IGN1cnJlbnRPd25lcldpbm5pbmdzLnN1Yih0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnkgKiBjbGFpbWVkU3Vycm91bmRpbmdUaWxlcy5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBfYXNzaWduQnV5b3V0UHJvY2VlZHMoCiAgICAgICAgICAgIGN1cnJlbnRPd25lciwKICAgICAgICAgICAgY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMsCiAgICAgICAgICAgIGZlZSwKICAgICAgICAgICAgY3VycmVudE93bmVyV2lubmluZ3MsCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSwKICAgICAgICAgICAgcmVmZXJyYWxCb251cywKICAgICAgICAgICAgcHJpemVQb29sRnVuZHMKICAgICAgICApOwogICAgfQogICAgCiAgICAvLy8gQGRldiBTZW5kIGZ1bmRzIHRvIGEgYmVuZWZpY2lhcnkuIElmIHNlbmRpbmcgZmFpbHMsIGFzc2lnbgogICAgLy8vIGZ1bmRzIHRvIHRoZSBiZW5lZmljaWFyeSdzIGJhbGFuY2UgZm9yIG1hbnVhbCB3aXRoZHJhd2FsLgogICAgLy8vIEBwYXJhbSBiZW5lZmljaWFyeSBUaGUgYmVuZWZpY2lhcnkncyBhZGRyZXNzIHRvIHNlbmQgZnVuZHMgdG8KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gc2VuZC4KICAgIGZ1bmN0aW9uIF9zZW5kRnVuZHMoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBpZiAoIWJlbmVmaWNpYXJ5LnNlbmQoYW1vdW50KSkgewogICAgICAgICAgICAvLyBGYWlsZWQgdG8gc2VuZCBmdW5kcy4gVGhpcyBjYW4gaGFwcGVuIGR1ZSB0byBhIGZhaWx1cmUgaW4KICAgICAgICAgICAgLy8gZmFsbGJhY2sgY29kZSBvZiB0aGUgYmVuZWZpY2lhcnksIG9yIGJlY2F1c2Ugb2YgY2FsbHN0YWNrCiAgICAgICAgICAgIC8vIGRlcHRoLgogICAgICAgICAgICAvLyBTZW5kIGZ1bmRzIGFzeW5jaHJvbm91c2x5IGZvciBtYW51YWwgd2l0aGRyYXdhbCBieSB0aGUKICAgICAgICAgICAgLy8gYmVuZWZpY2lhcnkuCiAgICAgICAgICAgIGFzeW5jU2VuZChiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgICAgICB9CiAgICB9Cn0KCi8vLyBAZGV2IEhvbGRzIGNvcmUgZ2FtZSBmdW5jdGlvbmFsaXR5Lgpjb250cmFjdCBCdXJudXBHYW1lQ29yZSBpcyBCdXJudXBHYW1lRmluYW5jZSB7CiAgICAKICAgIGZ1bmN0aW9uIEJ1cm51cEdhbWVDb3JlKGFkZHJlc3MgYnVybnVwSG9sZGluZ0FkZHJlc3MpIHB1YmxpYyBCdXJudXBHYW1lRmluYW5jZShidXJudXBIb2xkaW5nQWRkcmVzcykge30KICAgIAogICAgLy8vIEBub3RpY2UgQnV5IHRoZSBjdXJyZW50IG93bmVyIG91dCBvZiB0aGUgdGlsZS4KICAgIC8vLyBAcGFyYW0gX2dhbWVJbmRleCBUaGUgaW5kZXggb2YgdGhlIGdhbWUgdG8gcGxheSBvbi4KICAgIC8vLyBAcGFyYW0gc3RhcnROZXdHYW1lSWZJZGxlIFN0YXJ0IGEgbmV3IGdhbWUgaWYgdGhlIGN1cnJlbnQgZ2FtZSBpcyBpZGxlLgogICAgLy8vIEBwYXJhbSB4IFRoZSB4LWNvb3JkaW5hdGUgb2YgdGhlIHRpbGUgdG8gYnV5LgogICAgLy8vIEBwYXJhbSB5IFRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHRpbGUgdG8gYnV5LgogICAgZnVuY3Rpb24gYnV5b3V0KHVpbnQyNTYgX2dhbWVJbmRleCwgYm9vbCBzdGFydE5ld0dhbWVJZklkbGUsIHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBnYW1lIHNob3VsZCBlbmQuIFByb2Nlc3MgcGF5bWVudC4KICAgICAgICBfcHJvY2Vzc0dhbWVFbmQoKTsKICAgICAgICAKICAgICAgICBpZiAoIWdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5nYW1lU3RhcnRlZCkgewogICAgICAgICAgICAvLyBJZiB0aGUgZ2FtZSBpcyBub3Qgc3RhcnRlZCwgdGhlIGNvbnRyYWN0IG11c3Qgbm90IGJlIHBhdXNlZC4KICAgICAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhbGxvd1N0YXJ0KSB7CiAgICAgICAgICAgICAgICAvLyBXZSdyZSBhbGxvd2VkIHRvIHN0YXJ0IG9uY2Ugb3V0c2lkZSBvZiBhY3RpdmUgdGltZXMuCiAgICAgICAgICAgICAgICBhbGxvd1N0YXJ0ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIG11c3QgYmUgYW4gYWN0aXZlIHRpbWUuCiAgICAgICAgICAgICAgICByZXF1aXJlKGNhblN0YXJ0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiB0aGUgZ2FtZSBpcyBub3Qgc3RhcnRlZCwgdGhlIHBsYXllciBtdXN0IGJlIHdpbGxpbmcgdG8gc3RhcnQKICAgICAgICAgICAgLy8gYSBuZXcgZ2FtZS4KICAgICAgICAgICAgcmVxdWlyZShzdGFydE5ld0dhbWVJZklkbGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgX3NldEdhbWVTZXR0aW5ncygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhcnQgdGhlIGdhbWUuCiAgICAgICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5nYW1lU3RhcnRlZCA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgZ2FtZSBzdGFydGVkIHRpbWVzdGFtcC4KICAgICAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmdhbWVTdGFydFRpbWVzdGFtcCA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldCB0aGUgaW5pdGlhbCBnYW1lIGJvYXJkIHRpbWVvdXQuCiAgICAgICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wZW51bHRpbWF0ZVRpbGVUaW1lb3V0ID0gYmxvY2sudGltZXN0YW1wICsgZ2FtZVNldHRpbmdzLmluaXRpYWxBY3Rpdml0eVRpbWVyOwogICAgICAgICAgICAKICAgICAgICAgICAgU3RhcnQoCiAgICAgICAgICAgICAgICBnYW1lSW5kZXgsCiAgICAgICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICAgICAgYmxvY2sudGltZXN0YW1wLAogICAgICAgICAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbAogICAgICAgICAgICApOwogICAgICAgICAgICAKICAgICAgICAgICAgUGVudWx0aW1hdGVUaWxlVGltZW91dChnYW1lSW5kZXgsIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wZW51bHRpbWF0ZVRpbGVUaW1lb3V0KTsKICAgICAgICB9CiAgICAKICAgICAgICAvLyBDaGVjayB0aGUgZ2FtZSBpbmRleC4KICAgICAgICBpZiAoc3RhcnROZXdHYW1lSWZJZGxlKSB7CiAgICAgICAgICAgIC8vIFRoZSBnaXZlbiBnYW1lIGluZGV4IG11c3QgYmUgdGhlIGN1cnJlbnQgZ2FtZSBpbmRleCwgb3IgdGhlIHByZXZpb3VzCiAgICAgICAgICAgIC8vIGdhbWUgaW5kZXguCiAgICAgICAgICAgIHJlcXVpcmUoX2dhbWVJbmRleCA9PSBnYW1lSW5kZXggfHwgX2dhbWVJbmRleC5hZGQoMSkgPT0gZ2FtZUluZGV4KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBPbmx5IHBsYXkgb24gdGhlIGdhbWUgaW5kaWNhdGVkIGJ5IHRoZSBwbGF5ZXIuCiAgICAgICAgICAgIHJlcXVpcmUoX2dhbWVJbmRleCA9PSBnYW1lSW5kZXgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50MjU2IGlkZW50aWZpZXIgPSBjb29yZGluYXRlVG9JZGVudGlmaWVyKHgsIHkpOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgY3VycmVudE93bmVyID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdOwogICAgICAgIAogICAgICAgIC8vIFRpbGUgbXVzdCBiZSB1bm93bmVkLCBvciBhY3RpdmUuCiAgICAgICAgaWYgKGN1cnJlbnRPd25lciA9PSBhZGRyZXNzKDB4MCkpIHsKICAgICAgICAgICAgLy8gVGlsZSBtdXN0IHN0aWxsIGJlIGZsaXBwYWJsZS4KICAgICAgICAgICAgcmVxdWlyZShnYW1lU3RhdGVzW2dhbWVJbmRleF0uZ2FtZVN0YXJ0VGltZXN0YW1wLmFkZChnYW1lU2V0dGluZ3MuaW5pdGlhbEFjdGl2aXR5VGltZXIpID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVGlsZSBtdXN0IGJlIGFjdGl2ZS4KICAgICAgICAgICAgcmVxdWlyZShnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvVGltZW91dFRpbWVzdGFtcFtpZGVudGlmaWVyXSA+PSBibG9jay50aW1lc3RhbXApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFbm91Z2ggRXRoZXIgbXVzdCBiZSBzdXBwbGllZC4KICAgICAgICB1aW50MjU2IHByaWNlID0gY3VycmVudFByaWNlKGlkZW50aWZpZXIpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHByaWNlKTsKICAgICAgICAKICAgICAgICAvLyBHZXQgZXhpc3Rpbmcgc3Vycm91bmRpbmcgdGlsZXMuCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBjbGFpbWVkU3Vycm91bmRpbmdUaWxlcyA9IF9jbGFpbWVkU3Vycm91bmRpbmdUaWxlcyhpZGVudGlmaWVyKTsKICAgICAgICAKICAgICAgICAvLyBBc3NpZ24gdGhlIGJ1eW91dCBwcm9jZWVkcyBhbmQgcmV0cmlldmUgdGhlIHRvdGFsIGNvc3QuCiAgICAgICAgX2NhbGN1bGF0ZUFuZEFzc2lnbkJ1eW91dFByb2NlZWRzKGN1cnJlbnRPd25lciwgcHJpY2UsIGNsYWltZWRTdXJyb3VuZGluZ1RpbGVzKTsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIHRpbWVvdXQgdGltZXN0YW1wLgogICAgICAgIHVpbnQyNTYgdGltZW91dCA9IHRpbGVUaW1lb3V0VGltZXN0YW1wKGlkZW50aWZpZXIsIG1zZy5zZW5kZXIpOwogICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9UaW1lb3V0VGltZXN0YW1wW2lkZW50aWZpZXJdID0gdGltZW91dDsKICAgICAgICAKICAgICAgICAvLyBLZWVwIHRyYWNrIG9mIHRoZSBsYXN0IGFuZCBwZW51bHRpbWF0ZSB0aWxlcy4KICAgICAgICBpZiAoZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmxhc3RUaWxlID09IDAgfHwgdGltZW91dCA+PSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvVGltZW91dFRpbWVzdGFtcFtnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdFRpbGVdKSB7CiAgICAgICAgICAgIGlmIChnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdFRpbGUgIT0gaWRlbnRpZmllcikgewogICAgICAgICAgICAgICAgaWYgKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5sYXN0VGlsZSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUHJldmlvdXMgbGFzdCB0aWxlIHRvIGJlY29tZSBpbmFjdGl2ZSBpcyBub3cgdGhlIHBlbnVsdGltYXRlIHRpbGUuCiAgICAgICAgICAgICAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnBlbnVsdGltYXRlVGlsZVRpbWVvdXQgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvVGltZW91dFRpbWVzdGFtcFtnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdFRpbGVdOwogICAgICAgICAgICAgICAgICAgIFBlbnVsdGltYXRlVGlsZVRpbWVvdXQoZ2FtZUluZGV4LCBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucGVudWx0aW1hdGVUaWxlVGltZW91dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmxhc3RUaWxlID0gaWRlbnRpZmllcjsKICAgICAgICAgICAgICAgIExhc3RUaWxlKGdhbWVJbmRleCwgaWRlbnRpZmllciwgeCwgeSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRpbWVvdXQgPiBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucGVudWx0aW1hdGVUaWxlVGltZW91dCkgewogICAgICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucGVudWx0aW1hdGVUaWxlVGltZW91dCA9IHRpbWVvdXQ7CiAgICAgICAgICAgIAogICAgICAgICAgICBQZW51bHRpbWF0ZVRpbGVUaW1lb3V0KGdhbWVJbmRleCwgdGltZW91dCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIHRoZSB0aWxlLgogICAgICAgIF90cmFuc2ZlcihjdXJyZW50T3duZXIsIG1zZy5zZW5kZXIsIGlkZW50aWZpZXIpOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSBhbmQgc2V0IHRoZSBuZXcgdGlsZSBwcmljZS4KICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvQnV5b3V0UHJpY2VbaWRlbnRpZmllcl0gPSBuZXh0QnV5b3V0UHJpY2UocHJpY2UpOwogICAgICAgIAogICAgICAgIC8vIEluY3JlbWVudCB0aGUgbnVtYmVyIG9mIHRpbGUgZmxpcHMuCiAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLm51bWJlck9mVGlsZUZsaXBzKys7CiAgICAgICAgCiAgICAgICAgLy8gRW1pdCBldmVudAogICAgICAgIEJ1eW91dChnYW1lSW5kZXgsIG1zZy5zZW5kZXIsIGlkZW50aWZpZXIsIHgsIHksIGJsb2NrLnRpbWVzdGFtcCwgdGltZW91dCwgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb0J1eW91dFByaWNlW2lkZW50aWZpZXJdLCBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGV4Y2VzcyBFdGhlciBzZW50LgogICAgICAgIC8vIG1zZy52YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gcHJpY2UsCiAgICAgICAgLy8gc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgZXhjZXNzID0gbXNnLnZhbHVlIC0gcHJpY2U7CiAgICAgICAgCiAgICAgICAgaWYgKGV4Y2VzcyA+IDApIHsKICAgICAgICAgICAgLy8gUmVmdW5kIGFueSBleGNlc3MgRXRoZXIgKG5vdCBzdXNjZXB0aWJsZSB0byByZS1lbnRyeSBhdHRhY2ssIGFzCiAgICAgICAgICAgIC8vIHRoZSBvd25lciBpcyBhc3NpZ25lZCBiZWZvcmUgdGhlIHRyYW5zZmVyIHRha2VzIHBsYWNlKS4KICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3MpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQnV5IHRoZSBjdXJyZW50IG93bmVyIG91dCBvZiB0aGUgdGlsZS4gU2V0IHRoZSBwbGF5ZXIncyByZWZlcnJlci4KICAgIC8vLyBAcGFyYW0gX2dhbWVJbmRleCBUaGUgaW5kZXggb2YgdGhlIGdhbWUgdG8gcGxheSBvbi4KICAgIC8vLyBAcGFyYW0gc3RhcnROZXdHYW1lSWZJZGxlIFN0YXJ0IGEgbmV3IGdhbWUgaWYgdGhlIGN1cnJlbnQgZ2FtZSBpcyBpZGxlLgogICAgLy8vIEBwYXJhbSB4IFRoZSB4LWNvb3JkaW5hdGUgb2YgdGhlIHRpbGUgdG8gYnV5LgogICAgLy8vIEBwYXJhbSB5IFRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHRpbGUgdG8gYnV5LgogICAgZnVuY3Rpb24gYnV5b3V0QW5kU2V0UmVmZXJyZXIodWludDI1NiBfZ2FtZUluZGV4LCBib29sIHN0YXJ0TmV3R2FtZUlmSWRsZSwgdWludDI1NiB4LCB1aW50MjU2IHksIGFkZHJlc3MgcmVmZXJyZXJBZGRyZXNzKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAvLyBTZXQgdGhlIHJlZmVycmVyLgogICAgICAgIGJ1cm51cEhvbGRpbmcuc2V0UmVmZXJyZXIobXNnLnNlbmRlciwgcmVmZXJyZXJBZGRyZXNzKTsKICAgIAogICAgICAgIC8vIFBsYXkuCiAgICAgICAgYnV5b3V0KF9nYW1lSW5kZXgsIHN0YXJ0TmV3R2FtZUlmSWRsZSwgeCwgeSk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNwaWNlIHVwIHRoZSBwcml6ZSBwb29sLgogICAgLy8vIEBwYXJhbSBfZ2FtZUluZGV4IFRoZSBpbmRleCBvZiB0aGUgZ2FtZSB0byBhZGQgc3BpY2UgdG8uCiAgICAvLy8gQHBhcmFtIG1lc3NhZ2UgQW4gb3B0aW9uYWwgbWVzc2FnZSB0byBiZSBzZW50IGFsb25nIHdpdGggdGhlIHNwaWNlLgogICAgZnVuY3Rpb24gc3BpY2VVcCh1aW50MjU2IF9nYW1lSW5kZXgsIHN0cmluZyBtZXNzYWdlKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGdhbWUgc2hvdWxkIGVuZC4gUHJvY2VzcyBwYXltZW50LgogICAgICAgIF9wcm9jZXNzR2FtZUVuZCgpOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIHRoZSBnYW1lIGluZGV4LgogICAgICAgIHJlcXVpcmUoX2dhbWVJbmRleCA9PSBnYW1lSW5kZXgpOwogICAgCiAgICAgICAgLy8gR2FtZSBtdXN0IGJlIGxpdmUgb3IgdW5wYXVzZWQuCiAgICAgICAgcmVxdWlyZShnYW1lU3RhdGVzW2dhbWVJbmRleF0uZ2FtZVN0YXJ0ZWQgfHwgIXBhdXNlZCk7CiAgICAgICAgCiAgICAgICAgLy8gRnVuZHMgbXVzdCBiZSBzZW50LgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIGZ1bmRzIHRvIHRoZSBwcml6ZSBwb29sLgogICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wcml6ZVBvb2wgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sLmFkZChtc2cudmFsdWUpOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgU3BpY2VVcFByaXplUG9vbChnYW1lSW5kZXgsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgbWVzc2FnZSwgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEVuZCB0aGUgZ2FtZS4gUGF5IHByaXplLgogICAgZnVuY3Rpb24gZW5kR2FtZSgpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKF9wcm9jZXNzR2FtZUVuZCgpKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgRW5kIHRoZSBnYW1lLiBQYXkgcHJpemUuCiAgICBmdW5jdGlvbiBfcHJvY2Vzc0dhbWVFbmQoKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICAvLyBUaGUgZ2FtZSBtdXN0IGJlIHN0YXJ0ZWQuCiAgICAgICAgaWYgKCFnYW1lU3RhdGVzW2dhbWVJbmRleF0uZ2FtZVN0YXJ0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhZGRyZXNzIGN1cnJlbnRPd25lciA9IGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9Pd25lcltnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdFRpbGVdOwogICAgCiAgICAgICAgLy8gVGhlIGxhc3QgZmxpcHBlZCB0aWxlIG11c3QgYmUgb3duZWQgKGkuZS4gdGhlcmUgaGFzIGJlZW4gYXQKICAgICAgICAvLyBsZWFzdCBvbmUgZmxpcCkuCiAgICAgICAgaWYgKGN1cnJlbnRPd25lciA9PSBhZGRyZXNzKDB4MCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBUaGUgcGVudWx0aW1hdGUgdGlsZSBtdXN0IGhhdmUgYmVjb21lIGluYWN0aXZlLgogICAgICAgIGlmIChnYW1lU3RhdGVzW2dhbWVJbmRleF0ucGVudWx0aW1hdGVUaWxlVGltZW91dCA+PSBibG9jay50aW1lc3RhbXApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBBc3NpZ24gcHJpemUgcG9vbCB0byB0aGUgb3duZXIgb2YgdGhlIGxhc3QtZmxpcHBlZCB0aWxlLgogICAgICAgIGlmIChnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sID4gMCkgewogICAgICAgICAgICBfc2VuZEZ1bmRzKGN1cnJlbnRPd25lciwgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEdldCBjb29yZGluYXRlcyBvZiBsYXN0IGZsaXBwZWQgdGlsZS4KICAgICAgICB2YXIgKHgsIHkpID0gaWRlbnRpZmllclRvQ29vcmRpbmF0ZShnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdFRpbGUpOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgRW5kKGdhbWVJbmRleCwgY3VycmVudE93bmVyLCBnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdFRpbGUsIHgsIHksIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9UaW1lb3V0VGltZXN0YW1wW2dhbWVTdGF0ZXNbZ2FtZUluZGV4XS5sYXN0VGlsZV0sIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wcml6ZVBvb2wpOwogICAgICAgIAogICAgICAgIC8vIEluY3JlbWVudCB0aGUgZ2FtZSBpbmRleC4gVGhpcyB3b24ndCBvdmVyZmxvdyBiZWZvcmUgdGhlIGhlYXQgZGVhdGggb2YgdGhlIHVuaXZlcnNlLgogICAgICAgIGdhbWVJbmRleCsrOwogICAgICAgIAogICAgICAgIC8vIEluZGljYXRlIGVuZGluZyB0aGUgZ2FtZSB3YXMgc3VjY2Vzc2Z1bC4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
