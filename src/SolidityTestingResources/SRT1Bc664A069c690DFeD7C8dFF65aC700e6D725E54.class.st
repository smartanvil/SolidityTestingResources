Class {
	#name : #SRT1Bc664A069c690DFeD7C8dFF65aC700e6D725E54,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1Bc664A069c690DFeD7C8dFF65aC700e6D725E54 >> base64 [
	^ 'Ly8gQ3JlYXRlZCB1c2luZyBUb2tlbiBXaXphcmQgaHR0cHM6Ly9naXRodWIuY29tL3BvYW5ldHdvcmsvdG9rZW4td2l6YXJkIGJ5IFBPQSBOZXR3b3JrIApwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQovLyBUZW1wb3JhcmlseSBoYXZlIFNhZmVNYXRoIGhlcmUgdW50aWwgYWxsIGNvbnRyYWN0cyBoYXZlIGJlZW4gbWlncmF0ZWQgdG8gU2FmZU1hdGhMaWIgdmVyc2lvbiBmcm9tIE9wZW5aZXBwZWxpbgoKCgoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiID4gMCk7CiAgICB1aW50IGMgPSBhIC8gYjsKICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKfQoKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCi8qKgogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4KICoKICogaHR0cHM6Ly9ibG9nLmFyYWdvbi5vbmUvbGlicmFyeS1kcml2ZW4tZGV2ZWxvcG1lbnQtaW4tc29saWRpdHktMmJlYmNhZjg4NzM2Iy43NTBnd3R3bGkKICoKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9BcmFnb25PbmUvemVwcGVsaW4tc29saWRpdHkvbWFzdGVyL2NvbnRyYWN0cy9TYWZlTWF0aExpYi5zb2wKICoKICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4KICoKICovCmxpYnJhcnkgU2FmZU1hdGhMaWJFeHQgewoKICBmdW5jdGlvbiB0aW1lcyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXZpZGVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWludXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSk7CiAgICByZXR1cm4gYzsKICB9Cgp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgoKLyoKICogSGFsdGFibGUKICoKICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuCiAqIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4gRGlmZmVycyBmcm9tIFBhdXNhYmxlIGJ5IGNhdXNpbmcgYSB0aHJvdyB3aGVuIGluIGhhbHQgbW9kZS4KICoKICoKICogT3JpZ2luYWxseSBlbnZpc2lvbmVkIGluIEZpcnN0Qmxvb2QgSUNPIGNvbnRyYWN0LgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgc3RvcE5vbk93bmVyc0luRW1lcmdlbmN5IHsKICAgIGlmIChoYWx0ZWQgJiYgbXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGlmICghaGFsdGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgaGFsdGVkID0gdHJ1ZTsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGhhbHRlZCA9IGZhbHNlOwogIH0KCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKLyoqCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuCiAqLwpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgewoKICBhZGRyZXNzIHB1YmxpYyB0aWVyOwoKICAvKiogSW50ZXJmYWNlIGRlY2xhcmF0aW9uLiAqLwogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuCiAgICoKICAgKiBDaGVja3MgdGhhdCBwcmljaW5nIHN0cmF0ZWd5IG1hdGNoZXMgY3Jvd2RzYWxlIHBhcmFtZXRlcnMuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKGFkZHJlc3MgY3Jvd2RzYWxlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IFByaWNpbmcgdGVsbHMgaWYgdGhpcyBpcyBhIHByZXNhbGUgcHVyY2hhc2Ugb3Igbm90LgogICAgIEBwYXJhbSBwdXJjaGFzZXIgQWRkcmVzcyBvZiB0aGUgcHVyY2hhc2VyCiAgICAgQHJldHVybiBGYWxzZSBieSBkZWZhdWx0LCB0cnVlIGlmIGEgcHJlc2FsZSBwdXJjaGFzZXIKICAgKi8KICBmdW5jdGlvbiBpc1ByZXNhbGVQdXJjaGFzZShhZGRyZXNzIHB1cmNoYXNlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qIEhvdyBtYW55IHdlaXMgb25lIHRva2VuIGNvc3RzICovCiAgZnVuY3Rpb24gdXBkYXRlUmF0ZSh1aW50IG5ld09uZVRva2VuSW5XZWkpIHB1YmxpYzsKCiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyIGluIHRoZSBtYWluIHRva2VuIHNhbGUgLSB0aGlzIG51bWJlciBleGNsdWRlcyBwcmVzYWxlCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCi8qKgogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIHN1Y2Nlc2VmdWwgY3Jvd2RzYWxlLgogKgogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkKICogLSBNYWtlIHRva2VucyB0cmFuc2ZlcmFibGUKICogLSBldGMuCiAqLwpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsKCiAgYm9vbCBwdWJsaWMgcmVzZXJ2ZWRUb2tlbnNBcmVEaXN0cmlidXRlZCA9IGZhbHNlOwoKICBmdW5jdGlvbiBpc0ZpbmFsaXplQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuCiAgICoKICAgKiBUaGlzIGlzIGEgc2FmZXR5IGNoZWNrIGZ1bmN0aW9uIHRoYXQgZG9lc24ndCBhbGxvdyBjcm93ZHNhbGUgdG8gYmVnaW4KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICBmdW5jdGlvbiBkaXN0cmlidXRlUmVzZXJ2ZWRUb2tlbnModWludCByZXNlcnZlZFRva2Vuc0Rpc3RyaWJ1dGlvbkJhdGNoKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7Cgp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4KICovCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMEV4dCBpcyBFUkMyMCB7CgogIHVpbnQgcHVibGljIGRlY2ltYWxzOwogIHVpbnQgcHVibGljIG1pbkNhcDsKCn0KCgoKLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGUKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZAogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVFeHQgaXMgSGFsdGFibGUgewoKICAvKiBNYXggaW52ZXN0bWVudCBjb3VudCB3aGVuIHdlIGFyZSBzdGlsbCBhbGxvd2VkIHRvIGNoYW5nZSB0aGUgbXVsdGlzaWcgYWRkcmVzcyAqLwogIHVpbnQgcHVibGljIE1BWF9JTlZFU1RNRU5UU19CRUZPUkVfTVVMVElTSUdfQ0hBTkdFID0gNTsKCiAgdXNpbmcgU2FmZU1hdGhMaWJFeHQgZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMEV4dCBwdWJsaWMgdG9rZW47CgogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovCiAgUHJpY2luZ1N0cmF0ZWd5IHB1YmxpYyBwcmljaW5nU3RyYXRlZ3k7CgogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLwogIEZpbmFsaXplQWdlbnQgcHVibGljIGZpbmFsaXplQWdlbnQ7CgogIC8qIG5hbWUgb2YgdGhlIGNyb3dkc2FsZSB0aWVyICovCiAgc3RyaW5nIHB1YmxpYyBuYW1lOwoKICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7CgogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBlbmRzQXQ7CgogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwoKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CgogIC8qIEhhcyB0aGlzIGNyb3dkc2FsZSBiZWVuIGZpbmFsaXplZCAqLwogIGJvb2wgcHVibGljIGZpbmFsaXplZDsKCiAgYm9vbCBwdWJsaWMgaXNXaGl0ZUxpc3RlZDsKCiAgYWRkcmVzc1tdIHB1YmxpYyBqb2luZWRDcm93ZHNhbGVzOwogIHVpbnQ4IHB1YmxpYyBqb2luZWRDcm93ZHNhbGVzTGVuID0gMDsKICB1aW50OCBwdWJsaWMgam9pbmVkQ3Jvd2RzYWxlc0xlbk1heCA9IDUwOwogIHN0cnVjdCBKb2luZWRDcm93ZHNhbGVTdGF0dXMgewogICAgYm9vbCBpc0pvaW5lZDsKICAgIHVpbnQ4IHBvc2l0aW9uOwogIH0KICBtYXBwaW5nIChhZGRyZXNzID0+IEpvaW5lZENyb3dkc2FsZVN0YXR1cykgam9pbmVkQ3Jvd2RzYWxlU3RhdGU7CgogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CgogIC8qKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwoKICBzdHJ1Y3QgV2hpdGVMaXN0RGF0YSB7CiAgICBib29sIHN0YXR1czsKICAgIHVpbnQgbWluQ2FwOwogICAgdWludCBtYXhDYXA7CiAgfQoKICAvL2lzIGNyb3dkc2FsZSB1cGRhdGFibGUKICBib29sIHB1YmxpYyBpc1VwZGF0YWJsZTsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IFdoaXRlTGlzdERhdGEpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogTGlzdCBvZiB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMgKi8KICBhZGRyZXNzW10gcHVibGljIHdoaXRlbGlzdGVkUGFydGljaXBhbnRzOwoKICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8KICB1aW50IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsKCiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWR9CgogIC8vIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUKICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsKCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZAogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMsIHVpbnQgbWluQ2FwLCB1aW50IG1heENhcCk7CiAgZXZlbnQgV2hpdGVsaXN0SXRlbUNoYW5nZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cywgdWludCBtaW5DYXAsIHVpbnQgbWF4Q2FwKTsKCiAgLy8gQ3Jvd2RzYWxlIHN0YXJ0IHRpbWUgaGFzIGJlZW4gY2hhbmdlZAogIGV2ZW50IFN0YXJ0c0F0Q2hhbmdlZCh1aW50IG5ld1N0YXJ0c0F0KTsKCiAgLy8gQ3Jvd2RzYWxlIGVuZCB0aW1lIGhhcyBiZWVuIGNoYW5nZWQKICBldmVudCBFbmRzQXRDaGFuZ2VkKHVpbnQgbmV3RW5kc0F0KTsKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlRXh0KHN0cmluZyBfbmFtZSwgYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsLCBib29sIF9pc1VwZGF0YWJsZSwgYm9vbCBfaXNXaGl0ZUxpc3RlZCkgewoKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICBuYW1lID0gX25hbWU7CgogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjBFeHQoX3Rva2VuKTsKCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CgogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7CiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoX3N0YXJ0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBzdGFydHNBdCA9IF9zdGFydDsKCiAgICBpZihfZW5kID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBlbmRzQXQgPSBfZW5kOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybwogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsKCiAgICBpc1VwZGF0YWJsZSA9IF9pc1VwZGF0YWJsZTsKCiAgICBpc1doaXRlTGlzdGVkID0gX2lzV2hpdGVMaXN0ZWQ7CiAgfQoKICAvKioKICAgKiBEb24ndCBleHBlY3QgdG8ganVzdCBzZW5kIGluIG1vbmV5IGFuZCBnZXQgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICB0aHJvdzsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIENyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuCiAgICoKICAgKiBAcGFyYW0gcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlCiAgICoKICAgKi8KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBwcml2YXRlIHsKCiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgdGhyb3c7CiAgICB9IGVsc2UgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5GdW5kaW5nKSB7CiAgICAgIC8vIFJldGFpbCBwYXJ0aWNpcGFudHMgY2FuIG9ubHkgY29tZSBpbiB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgcnVubmluZwogICAgICAvLyBwYXNzCiAgICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0uc3RhdHVzKSB7CiAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIFVud2FudGVkIHN0YXRlCiAgICAgIHRocm93OwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgIC8vIEFjY291bnQgcHJlc2FsZSBzYWxlcyBzZXBhcmF0ZWx5LCBzbyB0aGF0IHRoZXkgZG8gbm90IGNvdW50IGFnYWluc3QgcHJpY2luZyB0cmFuY2hlcwogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCwgbXNnLnNlbmRlciwgdG9rZW4uZGVjaW1hbHMoKSk7CgogICAgaWYodG9rZW5BbW91bnQgPT0gMCkgewogICAgICAvLyBEdXN0IHRyYW5zYWN0aW9uCiAgICAgIHRocm93OwogICAgfQoKICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgaWYodG9rZW5BbW91bnQgPCBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXS5taW5DYXAgJiYgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgIC8vIHRva2VuQW1vdW50IDwgbWluQ2FwIGZvciBpbnZlc3RvcgogICAgICAgIHRocm93OwogICAgICB9CgogICAgICAvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgaW52ZXN0b3IncyBjYXAKICAgICAgaWYgKGlzQnJlYWtpbmdJbnZlc3RvckNhcChyZWNlaXZlciwgdG9rZW5BbW91bnQpKSB7CiAgICAgICAgdGhyb3c7CiAgICAgIH0KCiAgICAgIHVwZGF0ZUluaGVyaXRlZEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmKHRva2VuQW1vdW50IDwgdG9rZW4ubWluQ2FwKCkgJiYgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgIHRocm93OwogICAgICB9CiAgICB9CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgaWYoaXNCcmVha2luZ0NhcCh3ZWlBbW91bnQsIHRva2VuQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXkKICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93OwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCAwKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0KG1zZy5zZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gZGlzdHJpYnV0ZVJlc2VydmVkVG9rZW5zKHVpbnQgcmVzZXJ2ZWRUb2tlbnNEaXN0cmlidXRpb25CYXRjaCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZAogICAgaWYoZmluYWxpemVkKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSBhZGRyZXNzKDApKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZGlzdHJpYnV0ZVJlc2VydmVkVG9rZW5zKHJlc2VydmVkVG9rZW5zRGlzdHJpYnV0aW9uQmF0Y2gpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYXJlUmVzZXJ2ZWRUb2tlbnNEaXN0cmlidXRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gZmluYWxpemVBZ2VudC5yZXNlcnZlZFRva2Vuc0FyZURpc3RyaWJ1dGVkKCk7CiAgfQoKICBmdW5jdGlvbiBjYW5EaXN0cmlidXRlUmVzZXJ2ZWRUb2tlbnMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICBDcm93ZHNhbGVFeHQgbGFzdFRpZXJDbnRyY3QgPSBDcm93ZHNhbGVFeHQoZ2V0TGFzdFRpZXIoKSk7CiAgICBpZiAoKGxhc3RUaWVyQ250cmN0LmdldFN0YXRlKCkgPT0gU3RhdGUuU3VjY2VzcykgJiYgIWxhc3RUaWVyQ250cmN0LmhhbHRlZCgpICYmICFsYXN0VGllckNudHJjdC5maW5hbGl6ZWQoKSAmJiAhbGFzdFRpZXJDbnRyY3QuYXJlUmVzZXJ2ZWRUb2tlbnNEaXN0cmlidXRlZCgpKSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGUgb3duZXIgY2FuIHRyaWdncmUgYSBjYWxsIHRoZSBjb250cmFjdCB0aGF0IHByb3ZpZGVzIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZAogICAgaWYoZmluYWxpemVkKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSBhZGRyZXNzKDApKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsKICAgIH0KCiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gKHJlKXNldCBmaW5hbGl6ZSBhZ2VudC4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiBzZXR0aW5nIHRoaXMsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLgogICAqLwogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGFzc2VydChhZGRyZXNzKGFkZHIpICE9IGFkZHJlc3MoMCkpOwogICAgYXNzZXJ0KGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gYWRkcmVzcygwKSk7CiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKi8KICBmdW5jdGlvbiBzZXRFYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMsIHVpbnQgbWluQ2FwLCB1aW50IG1heENhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICBpZiAoIWlzV2hpdGVMaXN0ZWQpIHRocm93OwogICAgYXNzZXJ0KGFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICBhc3NlcnQobWF4Q2FwID4gMCk7CiAgICBhc3NlcnQobWluQ2FwIDw9IG1heENhcCk7CiAgICBhc3NlcnQobm93IDw9IGVuZHNBdCk7CgogICAgaWYgKCFpc0FkZHJlc3NXaGl0ZWxpc3RlZChhZGRyKSkgewogICAgICB3aGl0ZWxpc3RlZFBhcnRpY2lwYW50cy5wdXNoKGFkZHIpOwogICAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMsIG1pbkNhcCwgbWF4Q2FwKTsKICAgIH0gZWxzZSB7CiAgICAgIFdoaXRlbGlzdEl0ZW1DaGFuZ2VkKGFkZHIsIHN0YXR1cywgbWluQ2FwLCBtYXhDYXApOwogICAgfQoKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBXaGl0ZUxpc3REYXRhKHtzdGF0dXM6c3RhdHVzLCBtaW5DYXA6bWluQ2FwLCBtYXhDYXA6bWF4Q2FwfSk7CiAgfQoKICBmdW5jdGlvbiBzZXRFYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0TXVsdGlwbGUoYWRkcmVzc1tdIGFkZHJzLCBib29sW10gc3RhdHVzZXMsIHVpbnRbXSBtaW5DYXBzLCB1aW50W10gbWF4Q2FwcykgcHVibGljIG9ubHlPd25lciB7CiAgICBpZiAoIWlzV2hpdGVMaXN0ZWQpIHRocm93OwogICAgYXNzZXJ0KG5vdyA8PSBlbmRzQXQpOwogICAgYXNzZXJ0KGFkZHJzLmxlbmd0aCA9PSBzdGF0dXNlcy5sZW5ndGgpOwogICAgYXNzZXJ0KHN0YXR1c2VzLmxlbmd0aCA9PSBtaW5DYXBzLmxlbmd0aCk7CiAgICBhc3NlcnQobWluQ2Fwcy5sZW5ndGggPT0gbWF4Q2Fwcy5sZW5ndGgpOwogICAgZm9yICh1aW50IGl0ZXJhdG9yID0gMDsgaXRlcmF0b3IgPCBhZGRycy5sZW5ndGg7IGl0ZXJhdG9yKyspIHsKICAgICAgc2V0RWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdChhZGRyc1tpdGVyYXRvcl0sIHN0YXR1c2VzW2l0ZXJhdG9yXSwgbWluQ2Fwc1tpdGVyYXRvcl0sIG1heENhcHNbaXRlcmF0b3JdKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUluaGVyaXRlZEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyByZWNpZXZlciwgdWludCB0b2tlbnNCb3VnaHQpIHByaXZhdGUgewogICAgaWYgKCFpc1doaXRlTGlzdGVkKSB0aHJvdzsKICAgIGlmICh0b2tlbnNCb3VnaHQgPCBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2lldmVyXS5taW5DYXAgJiYgdG9rZW5BbW91bnRPZltyZWNpZXZlcl0gPT0gMCkgdGhyb3c7CgogICAgdWludDggdGllclBvc2l0aW9uID0gZ2V0VGllclBvc2l0aW9uKHRoaXMpOwoKICAgIGZvciAodWludDggaiA9IHRpZXJQb3NpdGlvbiArIDE7IGogPCBqb2luZWRDcm93ZHNhbGVzTGVuOyBqKyspIHsKICAgICAgQ3Jvd2RzYWxlRXh0IGNyb3dkc2FsZSA9IENyb3dkc2FsZUV4dChqb2luZWRDcm93ZHNhbGVzW2pdKTsKICAgICAgY3Jvd2RzYWxlLnVwZGF0ZUVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QocmVjaWV2ZXIsIHRva2Vuc0JvdWdodCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgdWludCB0b2tlbnNCb3VnaHQpIHB1YmxpYyB7CiAgICBpZiAoIWlzV2hpdGVMaXN0ZWQpIHRocm93OwogICAgYXNzZXJ0KGFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICBhc3NlcnQobm93IDw9IGVuZHNBdCk7CiAgICBhc3NlcnQoaXNUaWVySm9pbmVkKG1zZy5zZW5kZXIpKTsKICAgIGlmICh0b2tlbnNCb3VnaHQgPCBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdLm1pbkNhcCAmJiB0b2tlbkFtb3VudE9mW2FkZHJdID09IDApIHRocm93OwogICAgLy9pZiAoYWRkciAhPSBtc2cuc2VuZGVyICYmIGNvbnRyYWN0QWRkciAhPSBtc2cuc2VuZGVyKSB0aHJvdzsKICAgIHVpbnQgbmV3TWF4Q2FwID0gZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5tYXhDYXA7CiAgICBuZXdNYXhDYXAgPSBuZXdNYXhDYXAubWludXModG9rZW5zQm91Z2h0KTsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBXaGl0ZUxpc3REYXRhKHtzdGF0dXM6ZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5zdGF0dXMsIG1pbkNhcDowLCBtYXhDYXA6bmV3TWF4Q2FwfSk7CiAgfQoKICBmdW5jdGlvbiBpc0FkZHJlc3NXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHdoaXRlbGlzdGVkUGFydGljaXBhbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh3aGl0ZWxpc3RlZFBhcnRpY2lwYW50c1tpXSA9PSBhZGRyKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiB3aGl0ZWxpc3RlZFBhcnRpY2lwYW50c0xlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gd2hpdGVsaXN0ZWRQYXJ0aWNpcGFudHMubGVuZ3RoOwogIH0KCiAgZnVuY3Rpb24gaXNUaWVySm9pbmVkKGFkZHJlc3MgYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIGpvaW5lZENyb3dkc2FsZVN0YXRlW2FkZHJdLmlzSm9pbmVkOwogIH0KCiAgZnVuY3Rpb24gZ2V0VGllclBvc2l0aW9uKGFkZHJlc3MgYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDgpIHsKICAgIHJldHVybiBqb2luZWRDcm93ZHNhbGVTdGF0ZVthZGRyXS5wb3NpdGlvbjsKICB9CgogIGZ1bmN0aW9uIGdldExhc3RUaWVyKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcykgewogICAgaWYgKGpvaW5lZENyb3dkc2FsZXNMZW4gPiAwKQogICAgICByZXR1cm4gam9pbmVkQ3Jvd2RzYWxlc1tqb2luZWRDcm93ZHNhbGVzTGVuIC0gMV07CiAgICBlbHNlCiAgICAgIHJldHVybiBhZGRyZXNzKDApOwogIH0KCiAgZnVuY3Rpb24gc2V0Sm9pbmVkQ3Jvd2RzYWxlcyhhZGRyZXNzIGFkZHIpIHByaXZhdGUgb25seU93bmVyIHsKICAgIGFzc2VydChhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgYXNzZXJ0KGpvaW5lZENyb3dkc2FsZXNMZW4gPD0gam9pbmVkQ3Jvd2RzYWxlc0xlbk1heCk7CiAgICBhc3NlcnQoIWlzVGllckpvaW5lZChhZGRyKSk7CiAgICBqb2luZWRDcm93ZHNhbGVzLnB1c2goYWRkcik7CiAgICBqb2luZWRDcm93ZHNhbGVTdGF0ZVthZGRyXSA9IEpvaW5lZENyb3dkc2FsZVN0YXR1cyh7CiAgICAgIGlzSm9pbmVkOiB0cnVlLAogICAgICBwb3NpdGlvbjogam9pbmVkQ3Jvd2RzYWxlc0xlbgogICAgfSk7CiAgICBqb2luZWRDcm93ZHNhbGVzTGVuKys7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVKb2luZWRDcm93ZHNhbGVzTXVsdGlwbGUoYWRkcmVzc1tdIGFkZHJzKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGFzc2VydChhZGRycy5sZW5ndGggPiAwKTsKICAgIGFzc2VydChqb2luZWRDcm93ZHNhbGVzTGVuID09IDApOwogICAgYXNzZXJ0KGFkZHJzLmxlbmd0aCA8PSBqb2luZWRDcm93ZHNhbGVzTGVuTWF4KTsKICAgIGZvciAodWludDggaXRlciA9IDA7IGl0ZXIgPCBhZGRycy5sZW5ndGg7IGl0ZXIrKykgewogICAgICBzZXRKb2luZWRDcm93ZHNhbGVzKGFkZHJzW2l0ZXJdKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNldFN0YXJ0c0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsKICAgIGFzc2VydCghZmluYWxpemVkKTsKICAgIGFzc2VydChpc1VwZGF0YWJsZSk7CiAgICBhc3NlcnQobm93IDw9IHRpbWUpOyAvLyBEb24ndCBjaGFuZ2UgcGFzdAogICAgYXNzZXJ0KHRpbWUgPD0gZW5kc0F0KTsKICAgIGFzc2VydChub3cgPD0gc3RhcnRzQXQpOwoKICAgIENyb3dkc2FsZUV4dCBsYXN0VGllckNudHJjdCA9IENyb3dkc2FsZUV4dChnZXRMYXN0VGllcigpKTsKICAgIGlmIChsYXN0VGllckNudHJjdC5maW5hbGl6ZWQoKSkgdGhyb3c7CgogICAgdWludDggdGllclBvc2l0aW9uID0gZ2V0VGllclBvc2l0aW9uKHRoaXMpOwoKICAgIC8vc3RhcnQgdGltZSBzaG91bGQgYmUgZ3JlYXRlciB0aGVuIGVuZCB0aW1lIG9mIHByZXZpb3VzIHRpZXJzCiAgICBmb3IgKHVpbnQ4IGogPSAwOyBqIDwgdGllclBvc2l0aW9uOyBqKyspIHsKICAgICAgQ3Jvd2RzYWxlRXh0IGNyb3dkc2FsZSA9IENyb3dkc2FsZUV4dChqb2luZWRDcm93ZHNhbGVzW2pdKTsKICAgICAgYXNzZXJ0KHRpbWUgPj0gY3Jvd2RzYWxlLmVuZHNBdCgpKTsKICAgIH0KCiAgICBzdGFydHNBdCA9IHRpbWU7CiAgICBTdGFydHNBdENoYW5nZWQoc3RhcnRzQXQpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgY3Jvd2RzYWxlIG93bmVyIHRvIGNsb3NlIGVhcmx5IG9yIGV4dGVuZCB0aGUgY3Jvd2RzYWxlLgogICAqCiAgICogVGhpcyBpcyB1c2VmdWwgZS5nLiBmb3IgYSBtYW51YWwgc29mdCBjYXAgaW1wbGVtZW50YXRpb246CiAgICogLSBhZnRlciBYIGFtb3VudCBpcyByZWFjaGVkIGRldGVybWluZSBtYW51YWwgY2xvc2luZwogICAqCiAgICogVGhpcyBtYXkgcHV0IHRoZSBjcm93ZHNhbGUgdG8gYW4gaW52YWxpZCBzdGF0ZSwKICAgKiBidXQgd2UgdHJ1c3Qgb3duZXJzIGtub3cgd2hhdCB0aGV5IGFyZSBkb2luZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldEVuZHNBdCh1aW50IHRpbWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgYXNzZXJ0KCFmaW5hbGl6ZWQpOwogICAgYXNzZXJ0KGlzVXBkYXRhYmxlKTsKICAgIGFzc2VydChub3cgPD0gdGltZSk7Ly8gRG9uJ3QgY2hhbmdlIHBhc3QKICAgIGFzc2VydChzdGFydHNBdCA8PSB0aW1lKTsKICAgIGFzc2VydChub3cgPD0gZW5kc0F0KTsKCiAgICBDcm93ZHNhbGVFeHQgbGFzdFRpZXJDbnRyY3QgPSBDcm93ZHNhbGVFeHQoZ2V0TGFzdFRpZXIoKSk7CiAgICBpZiAobGFzdFRpZXJDbnRyY3QuZmluYWxpemVkKCkpIHRocm93OwoKCiAgICB1aW50OCB0aWVyUG9zaXRpb24gPSBnZXRUaWVyUG9zaXRpb24odGhpcyk7CgogICAgZm9yICh1aW50OCBqID0gdGllclBvc2l0aW9uICsgMTsgaiA8IGpvaW5lZENyb3dkc2FsZXNMZW47IGorKykgewogICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICBhc3NlcnQodGltZSA8PSBjcm93ZHNhbGUuc3RhcnRzQXQoKSk7CiAgICB9CgogICAgZW5kc0F0ID0gdGltZTsKICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcmljaW5nU3RyYXRlZ3koUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3kpIHB1YmxpYyBvbmx5T3duZXIgewogICAgYXNzZXJ0KGFkZHJlc3MoX3ByaWNpbmdTdHJhdGVneSkgIT0gYWRkcmVzcygwKSk7CiAgICBhc3NlcnQoYWRkcmVzcyhwcmljaW5nU3RyYXRlZ3kpID09IGFkZHJlc3MoMCkpOwogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIXByaWNpbmdTdHJhdGVneS5pc1ByaWNpbmdTdHJhdGVneSgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gY2hhbmdlIHRoZSB0ZWFtIG11bHRpc2lnIGFkZHJlc3MgaW4gdGhlIGNhc2Ugb2YgZW1lcmdlbmN5LgogICAqCiAgICogVGhpcyBhbGxvd3MgdG8gc2F2ZSBhIGRlcGxveWVkIGNyb3dkc2FsZSB3YWxsZXQgaW4gdGhlIGNhc2UgdGhlIGNyb3dkc2FsZSBoYXMgbm90IHlldCBiZWd1bgogICAqICh3ZSBoYXZlIGRvbmUgb25seSBmZXcgdGVzdCB0cmFuc2FjdGlvbnMpLiBBZnRlciB0aGUgY3Jvd2RzYWxlIGlzIGdvaW5nCiAgICogdGhlbiBtdWx0aXNpZyBhZGRyZXNzIHN0YXlzIGxvY2tlZCBmb3IgdGhlIHNhZmV0eSByZWFzb25zLgogICAqLwogIGZ1bmN0aW9uIHNldE11bHRpc2lnKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlPd25lciB7CgogICAgLy8gQ2hhbmdlCiAgICBpZihpbnZlc3RvckNvdW50ID4gTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGlzTWluaW11bUdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmVhY2hlZCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5pbXVtRnVuZGluZ0dvYWw7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZXJTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgewogICAgcmV0dXJuIGZpbmFsaXplQWdlbnQuaXNTYW5lKCk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOwogIH0KCiAgLyoqCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4KICAgKgogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7CiAgfQoKICAvKiogSW50ZXJmYWNlIG1hcmtlci4gKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93OwogICAgXzsKICB9CgoKICAvLwogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucwogIC8vCgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLgogICAqCiAgICoKICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLgogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkKICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4KICAgKgogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CgogIGZ1bmN0aW9uIGlzQnJlYWtpbmdJbnZlc3RvckNhcChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGNyb3dkc2FsZSBpcyBmdWxsIGFuZCB3ZSBjYW4gbm8gbG9uZ2VyIHNlbGwgYW55IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgogIC8qKgogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLgogICAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOwp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCgoKCgovKioKICogU3RhbmRhcmQgRVJDMjAgdG9rZW4gd2l0aCBTaG9ydCBIYW5kIEF0dGFjayBhbmQgYXBwcm92ZSgpIHJhY2UgY29uZGl0aW9uIG1pdGlnYXRpb24uCiAqCiAqIEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDoKICogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7CgogIC8qIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwoKICAvKiBBY3R1YWwgYmFsYW5jZXMgb2YgdG9rZW4gaG9sZGVycyAqLwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgLyogYXBwcm92ZSgpIGFsbG93YW5jZXMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIC8qIEludGVyZmFjZSBkZWNsYXJhdGlvbiAqLwogIGZ1bmN0aW9uIGlzVG9rZW4oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB3ZUFyZSkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7CgogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCgoKCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLgogKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogIC8qKiBJbnRlcmZhY2UgbWFya2VyICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKfQoKCi8qKgogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucyB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4KICoKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAvKiogQ29udHJhY3QgLyBwZXJzb24gd2hvIGNhbiBzZXQgdGhlIHVwZ3JhZGUgcGF0aC4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgYXMgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIGFzIHdoYXQgaXQgaXMgd2l0aCBpdHMgZGVmYXVsdCB2YWx1ZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB1cGdyYWRlTWFzdGVyOwoKICAvKiogVGhlIG5leHQgY29udHJhY3Qgd2hlcmUgdGhlIHRva2VucyB3aWxsIGJlIG1pZ3JhdGVkLiAqLwogIFVwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50OwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdXBncmFkZWQgYnkgbm93LiAqLwogIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldAogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMKICAgKgogICAqLwogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9CgogIC8qKgogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICovCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKCiAgLyoqCiAgICogTmV3IHVwZ3JhZGUgYWdlbnQgYXZhaWxhYmxlLgogICAqLwogIGV2ZW50IFVwZ3JhZGVBZ2VudFNldChhZGRyZXNzIGFnZW50KTsKCiAgLyoqCiAgICogRG8gbm90IGFsbG93IGNvbnN0cnVjdGlvbiB3aXRob3V0IHVwZ3JhZGUgbWFzdGVyIHNldC4KICAgKi8KICBmdW5jdGlvbiBVcGdyYWRlYWJsZVRva2VuKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIHsKICAgIHVwZ3JhZGVNYXN0ZXIgPSBfdXBncmFkZU1hc3RlcjsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIHB1YmxpYyB7CgogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgaWYoIShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykpIHsKICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgICAgICB0aHJvdzsKICAgICAgfQoKICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgIGlmICh2YWx1ZSA9PSAwKSB0aHJvdzsKCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdmFsdWUpOwoKICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7CiAgICAgIHRvdGFsVXBncmFkZWQgPSBzYWZlQWRkKHRvdGFsVXBncmFkZWQsIHZhbHVlKTsKCiAgICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgICB1cGdyYWRlQWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwogICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIGV4dGVybmFsIHsKCiAgICAgIGlmKCFjYW5VcGdyYWRlKCkpIHsKICAgICAgICAvLyBUaGUgdG9rZW4gaXMgbm90IHlldCBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgdXBncmFkaW5nCiAgICAgICAgdGhyb3c7CiAgICAgIH0KCiAgICAgIGlmIChhZ2VudCA9PSAweDApIHRocm93OwogICAgICAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgYWdlbnQKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7CiAgICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICAgIGlmIChnZXRVcGdyYWRlU3RhdGUoKSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSB0aHJvdzsKCiAgICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICAgIGlmKCF1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgdGhyb3c7CiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7CgogICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7CiAgICBpZighY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYodG90YWxVcGdyYWRlZCA9PSAwKSByZXR1cm4gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlOwogICAgZWxzZSByZXR1cm4gVXBncmFkZVN0YXRlLlVwZ3JhZGluZzsKICB9CgogIC8qKgogICAqIENoYW5nZSB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICoKICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBwdWJsaWMgewogICAgICBpZiAobWFzdGVyID09IDB4MCkgdGhyb3c7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OwogICAgICB1cGdyYWRlTWFzdGVyID0gbWFzdGVyOwogIH0KCiAgLyoqCiAgICogQ2hpbGQgY29udHJhY3QgY2FuIGVuYWJsZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gd2hlbiB0aGUgdXBncmFkZSBjYW4gYmVndW4uCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgoKCgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIEVSQzIwLCBPd25hYmxlIHsKCiAgLyogVGhlIGZpbmFsaXplciBjb250cmFjdCB0aGF0IGFsbG93cyB1bmxpZnQgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAvKioKICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIuCiAgICoKICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIpIHsKCiAgICBpZighcmVsZWFzZWQpIHsKICAgICAgICBpZighdHJhbnNmZXJBZ2VudHNbX3NlbmRlcl0pIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQoKICAgIF87CiAgfQoKICAvKioKICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqCiAgICogRGVzaWduIGNob2ljZS4gQWxsb3cgcmVzZXQgdGhlIHJlbGVhc2UgYWdlbnQgdG8gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewoKICAgIC8vIFdlIGRvbid0IGRvIGludGVyZmFjZSBjaGVjayBoZXJlIGFzIHdlIG1pZ2h0IHdhbnQgdG8gYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudAogICAgcmVsZWFzZUFnZW50ID0gYWRkcjsKICB9CgogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIHBhcnRpY3VsYXIgYWRkcmVzcyAoYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIHRvIHRoZSB3aWxkLgogICAqCiAgICogQ2FuIGJlIGNhbGxlZCBvbmx5IGZyb20gdGhlIHJlbGVhc2UgYWdlbnQgdGhhdCBpcyB0aGUgZmluYWwgSUNPIGNvbnRyYWN0LiBJdCBpcyBvbmx5IGNhbGxlZCBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBiZWVuIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJlZm9yZSBvciBhZnRlciB0aGUgdG9rZW5zIGhhdmUgYmVlbiByZWxlYXNlc2QgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgaWYocmVsZWFzZVN0YXRlICE9IHJlbGVhc2VkKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYSB3aGl0ZWxpc3RlZCByZWxlYXNlIGFnZW50LiAqLwogIG1vZGlmaWVyIG9ubHlSZWxlYXNlQWdlbnQoKSB7CiAgICBpZihtc2cuc2VuZGVyICE9IHJlbGVhc2VBZ2VudCkgewogICAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20pIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKfQoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCgoKCgoKCi8qKgogKiBBIHRva2VuIHRoYXQgY2FuIGluY3JlYXNlIGl0cyBzdXBwbHkgYnkgYW5vdGhlciBjb250cmFjdC4KICoKICogVGhpcyBhbGxvd3MgdW5jYXBwZWQgY3Jvd2RzYWxlIGJ5IGR5bmFtaWNhbGx5IGluY3JlYXNpbmcgdGhlIHN1cHBseSB3aGVuIG1vbmV5IHBvdXJzIGluLgogKiBPbmx5IG1pbnQgYWdlbnRzLCBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgb3duZXIsIGNhbiBtaW50IG5ldyB0b2tlbnMuCiAqCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuRXh0IGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aExpYkV4dCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUgICk7CgogIC8qKiBpblBlcmNlbnRhZ2VVbml0IGlzIHBlcmNlbnRzIG9mIHRva2VucyBtdWx0aXBsaWVkIHRvIDEwIHVwIHRvIHBlcmNlbnRzIGRlY2ltYWxzLgogICogRm9yIGV4YW1wbGUsIGZvciByZXNlcnZlZCB0b2tlbnMgaW4gcGVyY2VudHMgMi41NCUKICAqIGluUGVyY2VudGFnZVVuaXQgPSAyNTQKICAqIGluUGVyY2VudGFnZURlY2ltYWxzID0gMgogICovCiAgc3RydWN0IFJlc2VydmVkVG9rZW5zRGF0YSB7CiAgICB1aW50IGluVG9rZW5zOwogICAgdWludCBpblBlcmNlbnRhZ2VVbml0OwogICAgdWludCBpblBlcmNlbnRhZ2VEZWNpbWFsczsKICAgIGJvb2wgaXNSZXNlcnZlZDsKICAgIGJvb2wgaXNEaXN0cmlidXRlZDsKICB9CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gUmVzZXJ2ZWRUb2tlbnNEYXRhKSBwdWJsaWMgcmVzZXJ2ZWRUb2tlbnNMaXN0OwogIGFkZHJlc3NbXSBwdWJsaWMgcmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnM7CiAgdWludCBwdWJsaWMgcmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4gPSAwOwogIGJvb2wgcmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNBcmVTZXQgPSBmYWxzZTsKCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsKICAgIC8vIE9ubHkgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhcmUgYWxsb3dlZCB0byBtaW50IG5ldyB0b2tlbnMKICAgIGlmKCFtaW50QWdlbnRzW21zZy5zZW5kZXJdKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IGRvbmUgeWV0LiAqLwogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICBpZihtaW50aW5nRmluaXNoZWQpIHRocm93OwogICAgXzsKICB9CgogIGZ1bmN0aW9uIGZpbmFsaXplUmVzZXJ2ZWRBZGRyZXNzKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlNaW50QWdlbnQgY2FuTWludCB7CiAgICBSZXNlcnZlZFRva2Vuc0RhdGEgc3RvcmFnZSByZXNlcnZlZFRva2Vuc0RhdGEgPSByZXNlcnZlZFRva2Vuc0xpc3RbYWRkcl07CiAgICByZXNlcnZlZFRva2Vuc0RhdGEuaXNEaXN0cmlidXRlZCA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiBpc0FkZHJlc3NSZXNlcnZlZChhZGRyZXNzIGFkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGlzUmVzZXJ2ZWQpIHsKICAgIHJldHVybiByZXNlcnZlZFRva2Vuc0xpc3RbYWRkcl0uaXNSZXNlcnZlZDsKICB9CgogIGZ1bmN0aW9uIGFyZVRva2Vuc0Rpc3RyaWJ1dGVkRm9yQWRkcmVzcyhhZGRyZXNzIGFkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGlzRGlzdHJpYnV0ZWQpIHsKICAgIHJldHVybiByZXNlcnZlZFRva2Vuc0xpc3RbYWRkcl0uaXNEaXN0cmlidXRlZDsKICB9CgogIGZ1bmN0aW9uIGdldFJlc2VydmVkVG9rZW5zKGFkZHJlc3MgYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5Ub2tlbnMpIHsKICAgIHJldHVybiByZXNlcnZlZFRva2Vuc0xpc3RbYWRkcl0uaW5Ub2tlbnM7CiAgfQoKICBmdW5jdGlvbiBnZXRSZXNlcnZlZFBlcmNlbnRhZ2VVbml0KGFkZHJlc3MgYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5QZXJjZW50YWdlVW5pdCkgewogICAgcmV0dXJuIHJlc2VydmVkVG9rZW5zTGlzdFthZGRyXS5pblBlcmNlbnRhZ2VVbml0OwogIH0KCiAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZWRQZXJjZW50YWdlRGVjaW1hbHMoYWRkcmVzcyBhZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBpblBlcmNlbnRhZ2VEZWNpbWFscykgewogICAgcmV0dXJuIHJlc2VydmVkVG9rZW5zTGlzdFthZGRyXS5pblBlcmNlbnRhZ2VEZWNpbWFsczsKICB9CgogIGZ1bmN0aW9uIHNldFJlc2VydmVkVG9rZW5zTGlzdE11bHRpcGxlKAogICAgYWRkcmVzc1tdIGFkZHJzLCAKICAgIHVpbnRbXSBpblRva2VucywgCiAgICB1aW50W10gaW5QZXJjZW50YWdlVW5pdCwgCiAgICB1aW50W10gaW5QZXJjZW50YWdlRGVjaW1hbHMKICApIHB1YmxpYyBjYW5NaW50IG9ubHlPd25lciB7CiAgICBhc3NlcnQoIXJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zQXJlU2V0KTsKICAgIGFzc2VydChhZGRycy5sZW5ndGggPT0gaW5Ub2tlbnMubGVuZ3RoKTsKICAgIGFzc2VydChpblRva2Vucy5sZW5ndGggPT0gaW5QZXJjZW50YWdlVW5pdC5sZW5ndGgpOwogICAgYXNzZXJ0KGluUGVyY2VudGFnZVVuaXQubGVuZ3RoID09IGluUGVyY2VudGFnZURlY2ltYWxzLmxlbmd0aCk7CiAgICBmb3IgKHVpbnQgaXRlcmF0b3IgPSAwOyBpdGVyYXRvciA8IGFkZHJzLmxlbmd0aDsgaXRlcmF0b3IrKykgewogICAgICBpZiAoYWRkcnNbaXRlcmF0b3JdICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICBzZXRSZXNlcnZlZFRva2Vuc0xpc3QoYWRkcnNbaXRlcmF0b3JdLCBpblRva2Vuc1tpdGVyYXRvcl0sIGluUGVyY2VudGFnZVVuaXRbaXRlcmF0b3JdLCBpblBlcmNlbnRhZ2VEZWNpbWFsc1tpdGVyYXRvcl0pOwogICAgICB9CiAgICB9CiAgICByZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0FyZVNldCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLi4KICAgKgogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwoKICAgIC8vIFRoaXMgd2lsbCBtYWtlIHRoZSBtaW50IHRyYW5zYWN0aW9uIGFwcGVyIGluIEV0aGVyU2Nhbi5pbwogICAgLy8gV2UgY2FuIHJlbW92ZSB0aGlzIGFmdGVyIHRoZXJlIGlzIGEgc3RhbmRhcmRpemVkIG1pbnRpbmcgZXZlbnQKICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBzZXRNaW50QWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgewogICAgbWludEFnZW50c1thZGRyXSA9IHN0YXRlOwogICAgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyLCBzdGF0ZSk7CiAgfQoKICBmdW5jdGlvbiBzZXRSZXNlcnZlZFRva2Vuc0xpc3QoYWRkcmVzcyBhZGRyLCB1aW50IGluVG9rZW5zLCB1aW50IGluUGVyY2VudGFnZVVuaXQsIHVpbnQgaW5QZXJjZW50YWdlRGVjaW1hbHMpIHByaXZhdGUgY2FuTWludCBvbmx5T3duZXIgewogICAgYXNzZXJ0KGFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICBpZiAoIWlzQWRkcmVzc1Jlc2VydmVkKGFkZHIpKSB7CiAgICAgIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zLnB1c2goYWRkcik7CiAgICAgIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zTGVuKys7CiAgICB9CgogICAgcmVzZXJ2ZWRUb2tlbnNMaXN0W2FkZHJdID0gUmVzZXJ2ZWRUb2tlbnNEYXRhKHsKICAgICAgaW5Ub2tlbnM6IGluVG9rZW5zLCAKICAgICAgaW5QZXJjZW50YWdlVW5pdDogaW5QZXJjZW50YWdlVW5pdCwgCiAgICAgIGluUGVyY2VudGFnZURlY2ltYWxzOiBpblBlcmNlbnRhZ2VEZWNpbWFscywKICAgICAgaXNSZXNlcnZlZDogdHJ1ZSwKICAgICAgaXNEaXN0cmlidXRlZDogZmFsc2UKICAgIH0pOwogIH0KfQoKCi8qKgogKiBBIGNyb3dkc2FsZWQgdG9rZW4uCiAqCiAqIEFuIEVSQy0yMCB0b2tlbiBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIGNyb3dkc2FsZXMgd2l0aCBpbnZlc3RvciBwcm90ZWN0aW9uIGFuZCBmdXJ0aGVyIGRldmVsb3BtZW50IHBhdGguCiAqCiAqIC0gVGhlIHRva2VuIHRyYW5zZmVyKCkgaXMgZGlzYWJsZWQgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyCiAqIC0gVGhlIHRva2VuIGNvbnRyYWN0IGdpdmVzIGFuIG9wdC1pbiB1cGdyYWRlIHBhdGggdG8gYSBuZXcgY29udHJhY3QKICogLSBUaGUgc2FtZSB0b2tlbiBjYW4gYmUgcGFydCBvZiBzZXZlcmFsIGNyb3dkc2FsZXMgdGhyb3VnaCBhcHByb3ZlKCkgbWVjaGFuaXNtCiAqIC0gVGhlIHRva2VuIGNhbiBiZSBjYXBwZWQgKHN1cHBseSBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yKSBvciB1bmNhcHBlZCAoY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiBtaW50IG5ldyB0b2tlbnMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVUb2tlbkV4dCBpcyBSZWxlYXNhYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW5FeHQsIFVwZ3JhZGVhYmxlVG9rZW4gewoKICAvKiogTmFtZSBhbmQgc3ltYm9sIHdlcmUgdXBkYXRlZC4gKi8KICBldmVudCBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihzdHJpbmcgbmV3TmFtZSwgc3RyaW5nIG5ld1N5bWJvbCk7CgogIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOwoKICBzdHJpbmcgcHVibGljIG5hbWU7CgogIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCiAgLyogTWluaW11bSBhbW1vdW50IG9mIHRva2VucyBldmVyeSBidXllciBjYW4gYnV5LiAqLwogIHVpbnQgcHVibGljIG1pbkNhcDsKCiAgLyoqCiAgICogQ29uc3RydWN0IHRoZSB0b2tlbi4KICAgKgogICAqIFRoaXMgdG9rZW4gbXVzdCBiZSBjcmVhdGVkIHRocm91Z2ggYSB0ZWFtIG11bHRpc2lnIHdhbGxldCwgc28gdGhhdCBpdCBpcyBvd25lZCBieSB0aGF0IHdhbGxldC4KICAgKgogICAqIEBwYXJhbSBfbmFtZSBUb2tlbiBuYW1lCiAgICogQHBhcmFtIF9zeW1ib2wgVG9rZW4gc3ltYm9sIC0gc2hvdWxkIGJlIGFsbCBjYXBzCiAgICogQHBhcmFtIF9pbml0aWFsU3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoCiAgICogQHBhcmFtIF9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgKiBAcGFyYW0gX21pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbkV4dChzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscywgYm9vbCBfbWludGFibGUsIHVpbnQgX2dsb2JhbE1pbkNhcCkKICAgIFVwZ3JhZGVhYmxlVG9rZW4obXNnLnNlbmRlcikgewoKICAgIC8vIENyZWF0ZSBhbnkgYWRkcmVzcywgY2FuIGJlIHRyYW5zZmVycmVkCiAgICAvLyB0byB0ZWFtIG11bHRpc2lnIHZpYSBjaGFuZ2VPd25lcigpLAogICAgLy8gYWxzbyByZW1lbWJlciB0byBjYWxsIHNldFVwZ3JhZGVNYXN0ZXIoKQogICAgb3duZXIgPSBtc2cuc2VuZGVyOwoKICAgIG5hbWUgPSBfbmFtZTsKICAgIHN5bWJvbCA9IF9zeW1ib2w7CgogICAgdG90YWxTdXBwbHkgPSBfaW5pdGlhbFN1cHBseTsKCiAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsKCiAgICBtaW5DYXAgPSBfZ2xvYmFsTWluQ2FwOwoKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGJhbGFuY2VzW293bmVyXSA9IHRvdGFsU3VwcGx5OwoKICAgIGlmKHRvdGFsU3VwcGx5ID4gMCkgewogICAgICBNaW50ZWQob3duZXIsIHRvdGFsU3VwcGx5KTsKICAgIH0KCiAgICAvLyBObyBtb3JlIG5ldyBzdXBwbHkgYWxsb3dlZCBhZnRlciB0aGUgdG9rZW4gY3JlYXRpb24KICAgIGlmKCFfbWludGFibGUpIHsKICAgICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgICAgaWYodG90YWxTdXBwbHkgPT0gMCkgewogICAgICAgIHRocm93OyAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIGVuZm9yY2Ugbm8gbmV3IHRva2VucyBjYW4gYmUgY3JlYXRlZC4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdXBncmFkZSBhZ2VudCBmdW5jdGlvbmFsaXR5IGtpY2sgaW4gb25seSBpZiB0aGUgY3Jvd2RzYWxlIHdhcyBzdWNjZXNzLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gcmVsZWFzZWQgJiYgc3VwZXIuY2FuVXBncmFkZSgpOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIHVwZGF0ZSB0b2tlbiBpbmZvcm1hdGlvbiBoZXJlLgogICAqCiAgICogSXQgaXMgb2Z0ZW4gdXNlZnVsIHRvIGNvbmNlYWwgdGhlIGFjdHVhbCB0b2tlbiBhc3NvY2lhdGlvbiwgdW50aWwKICAgKiB0aGUgdG9rZW4gb3BlcmF0aW9ucywgbGlrZSBjZW50cmFsIGlzc3VhbmNlIG9yIHJlaXNzdWFuY2UgaGF2ZSBiZWVuIGNvbXBsZXRlZC4KICAgKgogICAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHRoZSB0b2tlbiBvd25lciB0byByZW5hbWUgdGhlIHRva2VuIGFmdGVyIHRoZSBvcGVyYXRpb25zCiAgICogaGF2ZSBiZWVuIGNvbXBsZXRlZCBhbmQgdGhlbiBwb2ludCB0aGUgYXVkaWVuY2UgdG8gdXNlIHRoZSB0b2tlbiBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIG9ubHlPd25lciB7CiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgIFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKG5hbWUsIHN5bWJvbCk7CiAgfQoKICAvKioKICAgKiBDbGFpbSB0b2tlbnMgdGhhdCB3ZXJlIGFjY2lkZW50YWxseSBzZW50IHRvIHRoaXMgY29udHJhY3QuCiAgICoKICAgKiBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSk7CgogICAgRVJDMjAgdG9rZW4gPSBFUkMyMChfdG9rZW4pOwogICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwoKICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBvd25lciwgYmFsYW5jZSk7CiAgfQoKfQoKCi8qKgogKiBUaGUgZGVmYXVsdCBiZWhhdmlvciBmb3IgdGhlIGNyb3dkc2FsZSBlbmQuCiAqCiAqIFVubG9jayB0b2tlbnMuCiAqLwpjb250cmFjdCBSZXNlcnZlZFRva2Vuc0ZpbmFsaXplQWdlbnQgaXMgRmluYWxpemVBZ2VudCB7CiAgdXNpbmcgU2FmZU1hdGhMaWJFeHQgZm9yIHVpbnQ7CiAgQ3Jvd2RzYWxlVG9rZW5FeHQgcHVibGljIHRva2VuOwogIENyb3dkc2FsZUV4dCBwdWJsaWMgY3Jvd2RzYWxlOwoKICB1aW50IHB1YmxpYyBkaXN0cmlidXRlZFJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zTGVuID0gMDsKCiAgZnVuY3Rpb24gUmVzZXJ2ZWRUb2tlbnNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZVRva2VuRXh0IF90b2tlbiwgQ3Jvd2RzYWxlRXh0IF9jcm93ZHNhbGUpIHB1YmxpYyB7CiAgICB0b2tlbiA9IF90b2tlbjsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgfQoKICAvKiogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVsZWFzZSB0aGUgdG9rZW4gKi8KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuICh0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICB9CgogIC8vZGlzdHJpYnV0ZXMgcmVzZXJ2ZWQgdG9rZW5zLiBTaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBmaW5hbGl6YXRpb24KICBmdW5jdGlvbiBkaXN0cmlidXRlUmVzZXJ2ZWRUb2tlbnModWludCByZXNlcnZlZFRva2Vuc0Rpc3RyaWJ1dGlvbkJhdGNoKSBwdWJsaWMgewogICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhjcm93ZHNhbGUpKTsKCiAgICBhc3NlcnQocmVzZXJ2ZWRUb2tlbnNEaXN0cmlidXRpb25CYXRjaCA+IDApOwogICAgYXNzZXJ0KCFyZXNlcnZlZFRva2Vuc0FyZURpc3RyaWJ1dGVkKTsKICAgIGFzc2VydChkaXN0cmlidXRlZFJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zTGVuIDwgdG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4oKSk7CgogICAgLy8gSG93IG1hbnkgJSBvZiB0b2tlbnMgdGhlIGZvdW5kZXJzIGFuZCBvdGhlcnMgZ2V0CiAgICB1aW50IHRva2Vuc1NvbGQgPSBjcm93ZHNhbGUudG9rZW5zU29sZCgpOwoKICAgIHVpbnQgc3RhcnRMb29waW5nID0gZGlzdHJpYnV0ZWRSZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0xlbjsKICAgIHVpbnQgYmF0Y2ggPSB0b2tlbi5yZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0xlbigpLm1pbnVzKGRpc3RyaWJ1dGVkUmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4pOwogICAgaWYgKGJhdGNoID49IHJlc2VydmVkVG9rZW5zRGlzdHJpYnV0aW9uQmF0Y2gpIHsKICAgICAgYmF0Y2ggPSByZXNlcnZlZFRva2Vuc0Rpc3RyaWJ1dGlvbkJhdGNoOwogICAgfQogICAgdWludCBlbmRMb29waW5nID0gc3RhcnRMb29waW5nICsgYmF0Y2g7CgogICAgLy8gbW92ZSByZXNlcnZlZCB0b2tlbnMKICAgIGZvciAodWludCBqID0gc3RhcnRMb29waW5nOyBqIDwgZW5kTG9vcGluZzsgaisrKSB7CiAgICAgIGFkZHJlc3MgcmVzZXJ2ZWRBZGRyID0gdG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnMoaik7CiAgICAgIGlmICghdG9rZW4uYXJlVG9rZW5zRGlzdHJpYnV0ZWRGb3JBZGRyZXNzKHJlc2VydmVkQWRkcikpIHsKICAgICAgICB1aW50IGFsbG9jYXRlZEJvbnVzSW5QZXJjZW50YWdlOwogICAgICAgIHVpbnQgYWxsb2NhdGVkQm9udXNJblRva2VucyA9IHRva2VuLmdldFJlc2VydmVkVG9rZW5zKHJlc2VydmVkQWRkcik7CiAgICAgICAgdWludCBwZXJjZW50c09mVG9rZW5zVW5pdCA9IHRva2VuLmdldFJlc2VydmVkUGVyY2VudGFnZVVuaXQocmVzZXJ2ZWRBZGRyKTsKICAgICAgICB1aW50IHBlcmNlbnRzT2ZUb2tlbnNEZWNpbWFscyA9IHRva2VuLmdldFJlc2VydmVkUGVyY2VudGFnZURlY2ltYWxzKHJlc2VydmVkQWRkcik7CgogICAgICAgIGlmIChwZXJjZW50c09mVG9rZW5zVW5pdCA+IDApIHsKICAgICAgICAgIGFsbG9jYXRlZEJvbnVzSW5QZXJjZW50YWdlID0gdG9rZW5zU29sZCAqIHBlcmNlbnRzT2ZUb2tlbnNVbml0IC8gMTAqKnBlcmNlbnRzT2ZUb2tlbnNEZWNpbWFscyAvIDEwMDsKICAgICAgICAgIHRva2VuLm1pbnQocmVzZXJ2ZWRBZGRyLCBhbGxvY2F0ZWRCb251c0luUGVyY2VudGFnZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYWxsb2NhdGVkQm9udXNJblRva2VucyA+IDApIHsKICAgICAgICAgIHRva2VuLm1pbnQocmVzZXJ2ZWRBZGRyLCBhbGxvY2F0ZWRCb251c0luVG9rZW5zKTsKICAgICAgICB9CgogICAgICAgIHRva2VuLmZpbmFsaXplUmVzZXJ2ZWRBZGRyZXNzKHJlc2VydmVkQWRkcik7CiAgICAgICAgZGlzdHJpYnV0ZWRSZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0xlbisrOwogICAgICB9CiAgICB9CgogICAgaWYgKGRpc3RyaWJ1dGVkUmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4gPT0gdG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4oKSkgewogICAgICByZXNlcnZlZFRva2Vuc0FyZURpc3RyaWJ1dGVkID0gdHJ1ZTsKICAgIH0KICB9CgogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHB1YmxpYyB7CiAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBhZGRyZXNzKGNyb3dkc2FsZSkpOwoKICAgIGlmICh0b2tlbi5yZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0xlbigpID4gMCkgewogICAgICBhc3NlcnQocmVzZXJ2ZWRUb2tlbnNBcmVEaXN0cmlidXRlZCk7CiAgICB9CgogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICB9Cgp9'.
	

]
