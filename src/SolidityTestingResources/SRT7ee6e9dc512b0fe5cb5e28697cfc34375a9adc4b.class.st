Class {
	#name : #SRT7ee6e9dc512b0fe5cb5e28697cfc34375a9adc4b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7ee6e9dc512b0fe5cb5e28697cfc34375a9adc4b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLy8vIEB0aXRsZSBNYXRoIGxpYnJhcnkgLSBBbGxvd3MgY2FsY3VsYXRpb24gb2YgbG9nYXJpdGhtaWMgYW5kIGV4cG9uZW50aWFsIGZ1bmN0aW9ucwovLy8gQGF1dGhvciBBbGFuIEx1IC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNjAwMTBjMDEwZTRlMGMxNTIwMDcwZTBmMTMwOTEzNGUxMDBkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImI2YzVjMmQzZDBkN2Q4ZjZkMWQ4ZDljNWRmYzU5OGM2ZGIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgpsaWJyYXJ5IE1hdGggewoKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIC8vIFRoaXMgaXMgZXF1YWwgdG8gMSBpbiBvdXIgY2FsY3VsYXRpb25zCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBPTkUgPSAgMHgxMDAwMDAwMDAwMDAwMDAwMDsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IExOMiA9IDB4YjE3MjE3ZjdkMWNmNzlhYzsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IExPRzJfRSA9IDB4MTcxNTQ3NjUyYjgyZmUxNzc7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbmF0dXJhbCBleHBvbmVudGlhbCBmdW5jdGlvbiB2YWx1ZSBvZiBnaXZlbiB4CiAgICAvLy8gQHBhcmFtIHggeAogICAgLy8vIEByZXR1cm4gZSoqeAogICAgZnVuY3Rpb24gZXhwKGludCB4KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICAvLyByZXZlcnQgaWYgeCBpcyA+IE1BWF9QT1dFUiwgd2hlcmUKICAgICAgICAvLyBNQVhfUE9XRVIgPSBpbnQobXAuZmxvb3IobXAubG9nKG1wZigyKioyNTYgLSAxKSAvIE9ORSkgKiBPTkUpKQogICAgICAgIHJlcXVpcmUoeCA8PSAyNDU0OTcxMjU5ODc4OTA5ODg2Njc5KTsKICAgICAgICAvLyByZXR1cm4gMCBpZiBleHAoeCkgaXMgdGlueSwgdXNpbmcKICAgICAgICAvLyBNSU5fUE9XRVIgPSBpbnQobXAuZmxvb3IobXAubG9nKG1wZigxKSAvIE9ORSkgKiBPTkUpKQogICAgICAgIGlmICh4IDwgLTgxODMyMzc1MzI5Mjk2OTk2MjIyNykKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgLy8gVHJhbnNmb3JtIHNvIHRoYXQgZV54IC0+IDJeeAogICAgICAgIHggPSB4ICogaW50KE9ORSkgLyBpbnQoTE4yKTsKICAgICAgICAvLyAyXnggPSAyXndob2xlKHgpICogMl5mcmFjKHgpCiAgICAgICAgLy8gICAgICAgXl5eXl5eXl5eXiBpcyBhIGJpdCBzaGlmdAogICAgICAgIC8vIHNvIFRheWxvciBleHBhbmQgb24geiA9IGZyYWMoeCkKICAgICAgICBpbnQgc2hpZnQ7CiAgICAgICAgdWludCB6OwogICAgICAgIGlmICh4ID49IDApIHsKICAgICAgICAgICAgc2hpZnQgPSB4IC8gaW50KE9ORSk7CiAgICAgICAgICAgIHogPSB1aW50KHggJSBpbnQoT05FKSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzaGlmdCA9IHggLyBpbnQoT05FKSAtIDE7CiAgICAgICAgICAgIHogPSBPTkUgLSB1aW50KC14ICUgaW50KE9ORSkpOwogICAgICAgIH0KICAgICAgICAvLyAyXnggPSAxICsgKGxuIDIpIHggKyAobG4gMileMi8yISB4XjIgKyAuLi4KICAgICAgICAvLwogICAgICAgIC8vIENhbiBnZW5lcmF0ZSB0aGUgeiBjb2VmZmljaWVudHMgdXNpbmcgbXBtYXRoIGFuZCB0aGUgZm9sbG93aW5nIGxpbmVzCiAgICAgICAgLy8gPj4+IGZyb20gbXBtYXRoIGltcG9ydCBtcAogICAgICAgIC8vID4+PiBtcC5kcHMgPSAxMDAKICAgICAgICAvLyA+Pj4gT05FID0gIDB4MTAwMDAwMDAwMDAwMDAwMDAKICAgICAgICAvLyA+Pj4gcHJpbnQoJ1xuJy5qb2luKGhleChpbnQobXAubG9nKDIpKippIC8gbXAuZmFjdG9yaWFsKGkpICogT05FKSkgZm9yIGkgaW4gcmFuZ2UoMSwgNykpKQogICAgICAgIC8vIDB4YjE3MjE3ZjdkMWNmNzlhYgogICAgICAgIC8vIDB4M2Q3ZjdiZmYwNThiMWQ1MAogICAgICAgIC8vIDB4ZTM1ODQ2YjgyNTA1ZmM1CiAgICAgICAgLy8gMHgyNzY1NTZkZjc0OWNlZTUKICAgICAgICAvLyAweDU3NjFmZjllMjk5Y2M0CiAgICAgICAgLy8gMHhhMTg0ODk3YzM2M2MzCiAgICAgICAgdWludCB6cG93ID0gejsKICAgICAgICB1aW50IHJlc3VsdCA9IE9ORTsKICAgICAgICByZXN1bHQgKz0gMHhiMTcyMTdmN2QxY2Y3OWFiICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4M2Q3ZjdiZmYwNThiMWQ1MCAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweGUzNTg0NmI4MjUwNWZjNSAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDI3NjU1NmRmNzQ5Y2VlNSAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDU3NjFmZjllMjk5Y2M0ICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4YTE4NDg5N2MzNjNjMyAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweGZmZTVmZTJjNDU4NiAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDE2MmMwMjIzYTVjOCAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDFiNTI1M2QzOTVlICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4MWU0Y2Y1MTU4YiAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDFlOGNhYzczNSAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDFjM2JkNjUwICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4MTgxNjE5MyAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDEzMTQ5NiAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweGUxYjcgKiB6cG93IC8gT05FOwogICAgICAgIHpwb3cgPSB6cG93ICogeiAvIE9ORTsKICAgICAgICByZXN1bHQgKz0gMHg5YzcgKiB6cG93IC8gT05FOwogICAgICAgIGlmIChzaGlmdCA+PSAwKSB7CiAgICAgICAgICAgIGlmIChyZXN1bHQgPj4gKDI1Ni1zaGlmdCkgPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuICgyKioyNTYtMSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQgPDwgc2hpZnQ7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA+PiAoLXNoaWZ0KTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG5hdHVyYWwgbG9nYXJpdGhtIHZhbHVlIG9mIGdpdmVuIHgKICAgIC8vLyBAcGFyYW0geCB4CiAgICAvLy8gQHJldHVybiBsbih4KQogICAgZnVuY3Rpb24gbG4odWludCB4KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIHJlcXVpcmUoeCA+IDApOwogICAgICAgIC8vIGJpbmFyeSBzZWFyY2ggZm9yIGZsb29yKGxvZzIoeCkpCiAgICAgICAgaW50IGlsb2cyID0gZmxvb3JMb2cyKHgpOwogICAgICAgIGludCB6OwogICAgICAgIGlmIChpbG9nMiA8IDApCiAgICAgICAgICAgIHogPSBpbnQoeCA8PCB1aW50KC1pbG9nMikpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgeiA9IGludCh4ID4+IHVpbnQoaWxvZzIpKTsKICAgICAgICAvLyB6ID0geCAqIDJeLeKMimxvZ+KCgnjijIsKICAgICAgICAvLyBzbyAxIDw9IHogPCAyCiAgICAgICAgLy8gYW5kIGxuIHogPSBsbiB4IC0g4oyKbG9n4oKCeOKMiy9sb2figoJlCiAgICAgICAgLy8gc28ganVzdCBjb21wdXRlIGxuIHogdXNpbmcgYXJ0YW5oIHNlcmllcwogICAgICAgIC8vIGFuZCBjYWxjdWxhdGUgbG4geCBmcm9tIHRoYXQKICAgICAgICBpbnQgdGVybSA9ICh6IC0gaW50KE9ORSkpICogaW50KE9ORSkgLyAoeiArIGludChPTkUpKTsKICAgICAgICBpbnQgaGFsZmxueiA9IHRlcm07CiAgICAgICAgaW50IHRlcm1wb3cgPSB0ZXJtICogdGVybSAvIGludChPTkUpICogdGVybSAvIGludChPTkUpOwogICAgICAgIGhhbGZsbnogKz0gdGVybXBvdyAvIDM7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gNTsKICAgICAgICB0ZXJtcG93ID0gdGVybXBvdyAqIHRlcm0gLyBpbnQoT05FKSAqIHRlcm0gLyBpbnQoT05FKTsKICAgICAgICBoYWxmbG56ICs9IHRlcm1wb3cgLyA3OwogICAgICAgIHRlcm1wb3cgPSB0ZXJtcG93ICogdGVybSAvIGludChPTkUpICogdGVybSAvIGludChPTkUpOwogICAgICAgIGhhbGZsbnogKz0gdGVybXBvdyAvIDk7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTE7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTM7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTU7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTc7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTk7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMjE7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMjM7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMjU7CiAgICAgICAgcmV0dXJuIChpbG9nMiAqIGludChPTkUpKSAqIGludChPTkUpIC8gaW50KExPRzJfRSkgKyAyICogaGFsZmxuejsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGJhc2UgMiBsb2dhcml0aG0gdmFsdWUgb2YgZ2l2ZW4geAogICAgLy8vIEBwYXJhbSB4IHgKICAgIC8vLyBAcmV0dXJuIGxvZ2FyaXRobWljIHZhbHVlCiAgICBmdW5jdGlvbiBmbG9vckxvZzIodWludCB4KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50IGxvKQogICAgewogICAgICAgIGxvID0gLTY0OwogICAgICAgIGludCBoaSA9IDE5MzsKICAgICAgICAvLyBJIHVzZSBhIHNoaWZ0IGhlcmUgaW5zdGVhZCBvZiAvIDIgYmVjYXVzZSBpdCBmbG9vcnMgaW5zdGVhZCBvZiByb3VuZGluZyB0b3dhcmRzIDAKICAgICAgICBpbnQgbWlkID0gKGhpICsgbG8pID4+IDE7CiAgICAgICAgd2hpbGUoKGxvICsgMSkgPCBoaSkgewogICAgICAgICAgICBpZiAobWlkIDwgMCAmJiB4IDw8IHVpbnQoLW1pZCkgPCBPTkUgfHwgbWlkID49IDAgJiYgeCA+PiB1aW50KG1pZCkgPCBPTkUpCiAgICAgICAgICAgICAgICBoaSA9IG1pZDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG8gPSBtaWQ7CiAgICAgICAgICAgIG1pZCA9IChoaSArIGxvKSA+PiAxOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG1heGltdW0gb2YgYW4gYXJyYXkKICAgIC8vLyBAcGFyYW0gbnVtcyBOdW1iZXJzIHRvIGxvb2sgdGhyb3VnaAogICAgLy8vIEByZXR1cm4gTWF4aW11bSBudW1iZXIKICAgIGZ1bmN0aW9uIG1heChpbnRbXSBudW1zKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50IG1heCkKICAgIHsKICAgICAgICByZXF1aXJlKG51bXMubGVuZ3RoID4gMCk7CiAgICAgICAgbWF4ID0gLTIqKjI1NTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBudW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAobnVtc1tpXSA+IG1heCkKICAgICAgICAgICAgICAgIG1heCA9IG51bXNbaV07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB3aGV0aGVyIGFuIGFkZCBvcGVyYXRpb24gY2F1c2VzIGFuIG92ZXJmbG93CiAgICAvLy8gQHBhcmFtIGEgRmlyc3QgYWRkZW5kCiAgICAvLy8gQHBhcmFtIGIgU2Vjb25kIGFkZGVuZAogICAgLy8vIEByZXR1cm4gRGlkIG5vIG92ZXJmbG93IG9jY3VyPwogICAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYSArIGIgPj0gYTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgYSBzdWJ0cmFjdGlvbiBvcGVyYXRpb24gY2F1c2VzIGFuIHVuZGVyZmxvdwogICAgLy8vIEBwYXJhbSBhIE1pbnVlbmQKICAgIC8vLyBAcGFyYW0gYiBTdWJ0cmFoZW5kCiAgICAvLy8gQHJldHVybiBEaWQgbm8gdW5kZXJmbG93IG9jY3VyPwogICAgZnVuY3Rpb24gc2FmZVRvU3ViKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYSA+PSBiOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgd2hldGhlciBhIG11bHRpcGx5IG9wZXJhdGlvbiBjYXVzZXMgYW4gb3ZlcmZsb3cKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBmYWN0b3IKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgZmFjdG9yCiAgICAvLy8gQHJldHVybiBEaWQgbm8gb3ZlcmZsb3cgb2NjdXI/CiAgICBmdW5jdGlvbiBzYWZlVG9NdWwodWludCBhLCB1aW50IGIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBiID09IDAgfHwgYSAqIGIgLyBiID09IGE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBzdW0gaWYgbm8gb3ZlcmZsb3cgb2NjdXJyZWQKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBhZGRlbmQKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgYWRkZW5kCiAgICAvLy8gQHJldHVybiBTdW0KICAgIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShzYWZlVG9BZGQoYSwgYikpOwogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGRpZmZlcmVuY2UgaWYgbm8gb3ZlcmZsb3cgb2NjdXJyZWQKICAgIC8vLyBAcGFyYW0gYSBNaW51ZW5kCiAgICAvLy8gQHBhcmFtIGIgU3VidHJhaGVuZAogICAgLy8vIEByZXR1cm4gRGlmZmVyZW5jZQogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKHNhZmVUb1N1YihhLCBiKSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgcHJvZHVjdCBpZiBubyBvdmVyZmxvdyBvY2N1cnJlZAogICAgLy8vIEBwYXJhbSBhIEZpcnN0IGZhY3RvcgogICAgLy8vIEBwYXJhbSBiIFNlY29uZCBmYWN0b3IKICAgIC8vLyBAcmV0dXJuIFByb2R1Y3QKICAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShzYWZlVG9NdWwoYSwgYikpOwogICAgICAgIHJldHVybiBhICogYjsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgYW4gYWRkIG9wZXJhdGlvbiBjYXVzZXMgYW4gb3ZlcmZsb3cKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBhZGRlbmQKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgYWRkZW5kCiAgICAvLy8gQHJldHVybiBEaWQgbm8gb3ZlcmZsb3cgb2NjdXI/CiAgICBmdW5jdGlvbiBzYWZlVG9BZGQoaW50IGEsIGludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gKGIgPj0gMCAmJiBhICsgYiA+PSBhKSB8fCAoYiA8IDAgJiYgYSArIGIgPCBhKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgYSBzdWJ0cmFjdGlvbiBvcGVyYXRpb24gY2F1c2VzIGFuIHVuZGVyZmxvdwogICAgLy8vIEBwYXJhbSBhIE1pbnVlbmQKICAgIC8vLyBAcGFyYW0gYiBTdWJ0cmFoZW5kCiAgICAvLy8gQHJldHVybiBEaWQgbm8gdW5kZXJmbG93IG9jY3VyPwogICAgZnVuY3Rpb24gc2FmZVRvU3ViKGludCBhLCBpbnQgYikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIChiID49IDAgJiYgYSAtIGIgPD0gYSkgfHwgKGIgPCAwICYmIGEgLSBiID4gYSk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB3aGV0aGVyIGEgbXVsdGlwbHkgb3BlcmF0aW9uIGNhdXNlcyBhbiBvdmVyZmxvdwogICAgLy8vIEBwYXJhbSBhIEZpcnN0IGZhY3RvcgogICAgLy8vIEBwYXJhbSBiIFNlY29uZCBmYWN0b3IKICAgIC8vLyBAcmV0dXJuIERpZCBubyBvdmVyZmxvdyBvY2N1cj8KICAgIGZ1bmN0aW9uIHNhZmVUb011bChpbnQgYSwgaW50IGIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoYiA9PSAwKSB8fCAoYSAqIGIgLyBiID09IGEpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgc3VtIGlmIG5vIG92ZXJmbG93IG9jY3VycmVkCiAgICAvLy8gQHBhcmFtIGEgRmlyc3QgYWRkZW5kCiAgICAvLy8gQHBhcmFtIGIgU2Vjb25kIGFkZGVuZAogICAgLy8vIEByZXR1cm4gU3VtCiAgICBmdW5jdGlvbiBhZGQoaW50IGEsIGludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIHJlcXVpcmUoc2FmZVRvQWRkKGEsIGIpKTsKICAgICAgICByZXR1cm4gYSArIGI7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBkaWZmZXJlbmNlIGlmIG5vIG92ZXJmbG93IG9jY3VycmVkCiAgICAvLy8gQHBhcmFtIGEgTWludWVuZAogICAgLy8vIEBwYXJhbSBiIFN1YnRyYWhlbmQKICAgIC8vLyBAcmV0dXJuIERpZmZlcmVuY2UKICAgIGZ1bmN0aW9uIHN1YihpbnQgYSwgaW50IGIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShzYWZlVG9TdWIoYSwgYikpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHByb2R1Y3QgaWYgbm8gb3ZlcmZsb3cgb2NjdXJyZWQKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBmYWN0b3IKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgZmFjdG9yCiAgICAvLy8gQHJldHVybiBQcm9kdWN0CiAgICBmdW5jdGlvbiBtdWwoaW50IGEsIGludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIHJlcXVpcmUoc2FmZVRvTXVsKGEsIGIpKTsKICAgICAgICByZXR1cm4gYSAqIGI7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBBYnN0cmFjdCB0b2tlbiBjb250cmFjdCAtIEZ1bmN0aW9ucyB0byBiZSBpbXBsZW1lbnRlZCBieSB0b2tlbiBjb250cmFjdHMKY29udHJhY3QgVG9rZW4gewoKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBvd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7Cn0KCgoKLy8vIEB0aXRsZSBTdGFuZGFyZCB0b2tlbiBjb250cmFjdCB3aXRoIG92ZXJmbG93IHByb3RlY3Rpb24KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbiB7CiAgICB1c2luZyBNYXRoIGZvciAqOwoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2FuY2VzOwogICAgdWludCB0b3RhbFRva2VuczsKCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHNlbmRlcidzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MuIFJldHVybnMgc3VjY2VzcwogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAvLy8gQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdhcyB0cmFuc2ZlciBzdWNjZXNzZnVsPwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmICggICAhYmFsYW5jZXNbbXNnLnNlbmRlcl0uc2FmZVRvU3ViKHZhbHVlKQogICAgICAgICAgICB8fCAhYmFsYW5jZXNbdG9dLnNhZmVUb0FkZCh2YWx1ZSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSB2YWx1ZTsKICAgICAgICBiYWxhbmNlc1t0b10gKz0gdmFsdWU7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIHZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYWxsb3dlZCB0aGlyZCBwYXJ0eSB0byB0cmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyLiBSZXR1cm5zIHN1Y2Nlc3MKICAgIC8vLyBAcGFyYW0gZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGFyZSB3aXRoZHJhd24KICAgIC8vLyBAcGFyYW0gdG8gQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIHNlbnQKICAgIC8vLyBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2FzIHRyYW5zZmVyIHN1Y2Nlc3NmdWw/CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKCAgICFiYWxhbmNlc1tmcm9tXS5zYWZlVG9TdWIodmFsdWUpCiAgICAgICAgICAgIHx8ICFhbGxvd2FuY2VzW2Zyb21dW21zZy5zZW5kZXJdLnNhZmVUb1N1Yih2YWx1ZSkKICAgICAgICAgICAgfHwgIWJhbGFuY2VzW3RvXS5zYWZlVG9BZGQodmFsdWUpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gLT0gdmFsdWU7CiAgICAgICAgYWxsb3dhbmNlc1tmcm9tXVttc2cuc2VuZGVyXSAtPSB2YWx1ZTsKICAgICAgICBiYWxhbmNlc1t0b10gKz0gdmFsdWU7CiAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXRzIGFwcHJvdmVkIGFtb3VudCBvZiB0b2tlbnMgZm9yIHNwZW5kZXIuIFJldHVybnMgc3VjY2VzcwogICAgLy8vIEBwYXJhbSBzcGVuZGVyIEFkZHJlc3Mgb2YgYWxsb3dlZCBhY2NvdW50CiAgICAvLy8gQHBhcmFtIHZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFdhcyBhcHByb3ZhbCBzdWNjZXNzZnVsPwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhbGxvd2FuY2VzW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIGZvciBnaXZlbiBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIKICAgIC8vLyBAcGFyYW0gc3BlbmRlciBBZGRyZXNzIG9mIHRva2VuIHNwZW5kZXIKICAgIC8vLyBAcmV0dXJuIFJlbWFpbmluZyBhbGxvd2FuY2UgZm9yIHNwZW5kZXIKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBhbGxvd2FuY2VzW293bmVyXVtzcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgZ2l2ZW4gYWRkcmVzcwogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyCiAgICAvLy8gQHJldHVybiBCYWxhbmNlIG9mIG93bmVyCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBvd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW293bmVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRvdGFsIHN1cHBseSBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRvdGFsIHN1cHBseQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gdG90YWxUb2tlbnM7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBPdXRjb21lIHRva2VuIGNvbnRyYWN0IC0gSXNzdWluZyBhbmQgcmV2b2tpbmcgb3V0Y29tZSB0b2tlbnMKLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjBmN2M3YjZhNjk2ZTYxNGY2ODYxNjA3YzY2N2MyMTdmNjIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBPdXRjb21lVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CiAgICB1c2luZyBNYXRoIGZvciAqOwoKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IElzc3VhbmNlKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgUmV2b2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgZXZlbnRDb250cmFjdDsKCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBpc0V2ZW50Q29udHJhY3QgKCkgewogICAgICAgIC8vIE9ubHkgZXZlbnQgY29udHJhY3QgaXMgYWxsb3dlZCB0byBwcm9jZWVkCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGV2ZW50Q29udHJhY3QpOwogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHNldHMgZXZlbnRzIGNvbnRyYWN0IGFkZHJlc3MKICAgIGZ1bmN0aW9uIE91dGNvbWVUb2tlbigpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgZXZlbnRDb250cmFjdCA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEV2ZW50cyBjb250cmFjdCBpc3N1ZXMgbmV3IHRva2VucyBmb3IgYWRkcmVzcy4gUmV0dXJucyBzdWNjZXNzCiAgICAvLy8gQHBhcmFtIF9mb3IgQWRkcmVzcyBvZiByZWNlaXZlcgogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5Db3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIGlzc3VlCiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF9mb3IsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgaXNFdmVudENvbnRyYWN0CiAgICB7CiAgICAgICAgYmFsYW5jZXNbX2Zvcl0gPSBiYWxhbmNlc1tfZm9yXS5hZGQob3V0Y29tZVRva2VuQ291bnQpOwogICAgICAgIHRvdGFsVG9rZW5zID0gdG90YWxUb2tlbnMuYWRkKG91dGNvbWVUb2tlbkNvdW50KTsKICAgICAgICBJc3N1YW5jZShfZm9yLCBvdXRjb21lVG9rZW5Db3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRXZlbnRzIGNvbnRyYWN0IHJldm9rZXMgdG9rZW5zIGZvciBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MKICAgIC8vLyBAcGFyYW0gX2ZvciBBZGRyZXNzIG9mIHRva2VuIGhvbGRlcgogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5Db3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIHJldm9rZQogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX2ZvciwgdWludCBvdXRjb21lVG9rZW5Db3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBpc0V2ZW50Q29udHJhY3QKICAgIHsKICAgICAgICBiYWxhbmNlc1tfZm9yXSA9IGJhbGFuY2VzW19mb3JdLnN1YihvdXRjb21lVG9rZW5Db3VudCk7CiAgICAgICAgdG90YWxUb2tlbnMgPSB0b3RhbFRva2Vucy5zdWIob3V0Y29tZVRva2VuQ291bnQpOwogICAgICAgIFJldm9jYXRpb24oX2Zvciwgb3V0Y29tZVRva2VuQ291bnQpOwogICAgfQp9CgoKCi8vLyBAdGl0bGUgQWJzdHJhY3Qgb3JhY2xlIGNvbnRyYWN0IC0gRnVuY3Rpb25zIHRvIGJlIGltcGxlbWVudGVkIGJ5IG9yYWNsZXMKY29udHJhY3QgT3JhY2xlIHsKCiAgICBmdW5jdGlvbiBpc091dGNvbWVTZXQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRPdXRjb21lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGludCk7Cn0KCgoKLy8vIEB0aXRsZSBFdmVudCBjb250cmFjdCAtIFByb3ZpZGUgYmFzaWMgZnVuY3Rpb25hbGl0eSByZXF1aXJlZCBieSBkaWZmZXJlbnQgZXZlbnQgdHlwZXMKLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjI1NTY1MTQwNDM0NDRiNjU0MjRiNGE1NjRjNTYwYjU1NDgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBFdmVudCB7CgogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgT3V0Y29tZVRva2VuQ3JlYXRpb24oT3V0Y29tZVRva2VuIG91dGNvbWVUb2tlbiwgdWludDggaW5kZXgpOwogICAgZXZlbnQgT3V0Y29tZVRva2VuU2V0SXNzdWFuY2UoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50IGNvbGxhdGVyYWxUb2tlbkNvdW50KTsKICAgIGV2ZW50IE91dGNvbWVUb2tlblNldFJldm9jYXRpb24oYWRkcmVzcyBpbmRleGVkIHNlbGxlciwgdWludCBvdXRjb21lVG9rZW5Db3VudCk7CiAgICBldmVudCBPdXRjb21lQXNzaWdubWVudChpbnQgb3V0Y29tZSk7CiAgICBldmVudCBXaW5uaW5nc1JlZGVtcHRpb24oYWRkcmVzcyBpbmRleGVkIHJlY2VpdmVyLCB1aW50IHdpbm5pbmdzKTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgVG9rZW4gcHVibGljIGNvbGxhdGVyYWxUb2tlbjsKICAgIE9yYWNsZSBwdWJsaWMgb3JhY2xlOwogICAgYm9vbCBwdWJsaWMgaXNPdXRjb21lU2V0OwogICAgaW50IHB1YmxpYyBvdXRjb21lOwogICAgT3V0Y29tZVRva2VuW10gcHVibGljIG91dGNvbWVUb2tlbnM7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIHZhbGlkYXRlcyBhbmQgc2V0cyBiYXNpYyBldmVudCBwcm9wZXJ0aWVzCiAgICAvLy8gQHBhcmFtIF9jb2xsYXRlcmFsVG9rZW4gVG9rZW5zIHVzZWQgYXMgY29sbGF0ZXJhbCBpbiBleGNoYW5nZSBmb3Igb3V0Y29tZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX29yYWNsZSBPcmFjbGUgY29udHJhY3QgdXNlZCB0byByZXNvbHZlIHRoZSBldmVudAogICAgLy8vIEBwYXJhbSBvdXRjb21lQ291bnQgTnVtYmVyIG9mIGV2ZW50IG91dGNvbWVzCiAgICBmdW5jdGlvbiBFdmVudChUb2tlbiBfY29sbGF0ZXJhbFRva2VuLCBPcmFjbGUgX29yYWNsZSwgdWludDggb3V0Y29tZUNvdW50KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIFZhbGlkYXRlIGlucHV0CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKF9jb2xsYXRlcmFsVG9rZW4pICE9IDAgJiYgYWRkcmVzcyhfb3JhY2xlKSAhPSAwICYmIG91dGNvbWVDb3VudCA+PSAyKTsKICAgICAgICBjb2xsYXRlcmFsVG9rZW4gPSBfY29sbGF0ZXJhbFRva2VuOwogICAgICAgIG9yYWNsZSA9IF9vcmFjbGU7CiAgICAgICAgLy8gQ3JlYXRlIGFuIG91dGNvbWUgdG9rZW4gZm9yIGVhY2ggb3V0Y29tZQogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBvdXRjb21lQ291bnQ7IGkrKykgewogICAgICAgICAgICBPdXRjb21lVG9rZW4gb3V0Y29tZVRva2VuID0gbmV3IE91dGNvbWVUb2tlbigpOwogICAgICAgICAgICBvdXRjb21lVG9rZW5zLnB1c2gob3V0Y29tZVRva2VuKTsKICAgICAgICAgICAgT3V0Y29tZVRva2VuQ3JlYXRpb24ob3V0Y29tZVRva2VuLCBpKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQnV5cyBlcXVhbCBudW1iZXIgb2YgdG9rZW5zIG9mIGFsbCBvdXRjb21lcywgZXhjaGFuZ2luZyBjb2xsYXRlcmFsIHRva2VucyBhbmQgc2V0cyBvZiBvdXRjb21lIHRva2VucyAxOjEKICAgIC8vLyBAcGFyYW0gY29sbGF0ZXJhbFRva2VuQ291bnQgTnVtYmVyIG9mIGNvbGxhdGVyYWwgdG9rZW5zCiAgICBmdW5jdGlvbiBidXlBbGxPdXRjb21lcyh1aW50IGNvbGxhdGVyYWxUb2tlbkNvdW50KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIFRyYW5zZmVyIGNvbGxhdGVyYWwgdG9rZW5zIHRvIGV2ZW50cyBjb250cmFjdAogICAgICAgIHJlcXVpcmUoY29sbGF0ZXJhbFRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBjb2xsYXRlcmFsVG9rZW5Db3VudCkpOwogICAgICAgIC8vIElzc3VlIG5ldyBvdXRjb21lIHRva2VucyB0byBzZW5kZXIKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgb3V0Y29tZVRva2Vucy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0Y29tZVRva2Vuc1tpXS5pc3N1ZShtc2cuc2VuZGVyLCBjb2xsYXRlcmFsVG9rZW5Db3VudCk7CiAgICAgICAgT3V0Y29tZVRva2VuU2V0SXNzdWFuY2UobXNnLnNlbmRlciwgY29sbGF0ZXJhbFRva2VuQ291bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFNlbGxzIGVxdWFsIG51bWJlciBvZiB0b2tlbnMgb2YgYWxsIG91dGNvbWVzLCBleGNoYW5naW5nIGNvbGxhdGVyYWwgdG9rZW5zIGFuZCBzZXRzIG9mIG91dGNvbWUgdG9rZW5zIDE6MQogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5Db3VudCBOdW1iZXIgb2Ygb3V0Y29tZSB0b2tlbnMKICAgIGZ1bmN0aW9uIHNlbGxBbGxPdXRjb21lcyh1aW50IG91dGNvbWVUb2tlbkNvdW50KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIFJldm9rZSBzZW5kZXIncyBvdXRjb21lIHRva2VucyBvZiBhbGwgb3V0Y29tZXMKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgb3V0Y29tZVRva2Vucy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0Y29tZVRva2Vuc1tpXS5yZXZva2UobXNnLnNlbmRlciwgb3V0Y29tZVRva2VuQ291bnQpOwogICAgICAgIC8vIFRyYW5zZmVyIGNvbGxhdGVyYWwgdG9rZW5zIHRvIHNlbmRlcgogICAgICAgIHJlcXVpcmUoY29sbGF0ZXJhbFRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG91dGNvbWVUb2tlbkNvdW50KSk7CiAgICAgICAgT3V0Y29tZVRva2VuU2V0UmV2b2NhdGlvbihtc2cuc2VuZGVyLCBvdXRjb21lVG9rZW5Db3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyB3aW5uaW5nIGV2ZW50IG91dGNvbWUKICAgIGZ1bmN0aW9uIHNldE91dGNvbWUoKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIFdpbm5pbmcgb3V0Y29tZSBpcyBub3Qgc2V0IHlldCBpbiBldmVudCBjb250cmFjdCBidXQgaW4gb3JhY2xlIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZSghaXNPdXRjb21lU2V0ICYmIG9yYWNsZS5pc091dGNvbWVTZXQoKSk7CiAgICAgICAgLy8gU2V0IHdpbm5pbmcgb3V0Y29tZQogICAgICAgIG91dGNvbWUgPSBvcmFjbGUuZ2V0T3V0Y29tZSgpOwogICAgICAgIGlzT3V0Y29tZVNldCA9IHRydWU7CiAgICAgICAgT3V0Y29tZUFzc2lnbm1lbnQob3V0Y29tZSk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBvdXRjb21lIGNvdW50CiAgICAvLy8gQHJldHVybiBPdXRjb21lIGNvdW50CiAgICBmdW5jdGlvbiBnZXRPdXRjb21lQ291bnQoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDgpCiAgICB7CiAgICAgICAgcmV0dXJuIHVpbnQ4KG91dGNvbWVUb2tlbnMubGVuZ3RoKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG91dGNvbWUgdG9rZW5zIGFycmF5CiAgICAvLy8gQHJldHVybiBPdXRjb21lIHRva2VucwogICAgZnVuY3Rpb24gZ2V0T3V0Y29tZVRva2VucygpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChPdXRjb21lVG9rZW5bXSkKICAgIHsKICAgICAgICByZXR1cm4gb3V0Y29tZVRva2VuczsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBhbW91bnQgb2Ygb3V0Y29tZSB0b2tlbnMgaGVsZCBieSBvd25lcgogICAgLy8vIEByZXR1cm4gT3V0Y29tZSB0b2tlbiBkaXN0cmlidXRpb24KICAgIGZ1bmN0aW9uIGdldE91dGNvbWVUb2tlbkRpc3RyaWJ1dGlvbihhZGRyZXNzIG93bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludFtdIG91dGNvbWVUb2tlbkRpc3RyaWJ1dGlvbikKICAgIHsKICAgICAgICBvdXRjb21lVG9rZW5EaXN0cmlidXRpb24gPSBuZXcgdWludFtdKG91dGNvbWVUb2tlbnMubGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgb3V0Y29tZVRva2VuRGlzdHJpYnV0aW9uLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBvdXRjb21lVG9rZW5EaXN0cmlidXRpb25baV0gPSBvdXRjb21lVG9rZW5zW2ldLmJhbGFuY2VPZihvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyBhbmQgcmV0dXJucyBldmVudCBoYXNoCiAgICAvLy8gQHJldHVybiBFdmVudCBoYXNoCiAgICBmdW5jdGlvbiBnZXRFdmVudEhhc2goKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMik7CgogICAgLy8vIEBkZXYgRXhjaGFuZ2VzIHNlbmRlcidzIHdpbm5pbmcgb3V0Y29tZSB0b2tlbnMgZm9yIGNvbGxhdGVyYWwgdG9rZW5zCiAgICAvLy8gQHJldHVybiBTZW5kZXIncyB3aW5uaW5ncwogICAgZnVuY3Rpb24gcmVkZWVtV2lubmluZ3MoKSBwdWJsaWMgcmV0dXJucyAodWludCk7Cn0KCgoKLy8vIEB0aXRsZSBBYnN0cmFjdCBtYXJrZXQgY29udHJhY3QgLSBGdW5jdGlvbnMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgbWFya2V0IGNvbnRyYWN0cwpjb250cmFjdCBNYXJrZXQgewoKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IE1hcmtldEZ1bmRpbmcodWludCBmdW5kaW5nKTsKICAgIGV2ZW50IE1hcmtldENsb3NpbmcoKTsKICAgIGV2ZW50IEZlZVdpdGhkcmF3YWwodWludCBmZWVzKTsKICAgIGV2ZW50IE91dGNvbWVUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDggb3V0Y29tZVRva2VuSW5kZXgsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQsIHVpbnQgb3V0Y29tZVRva2VuQ29zdCwgdWludCBtYXJrZXRGZWVzKTsKICAgIGV2ZW50IE91dGNvbWVUb2tlblNhbGUoYWRkcmVzcyBpbmRleGVkIHNlbGxlciwgdWludDggb3V0Y29tZVRva2VuSW5kZXgsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQsIHVpbnQgb3V0Y29tZVRva2VuUHJvZml0LCB1aW50IG1hcmtldEZlZXMpOwogICAgZXZlbnQgT3V0Y29tZVRva2VuU2hvcnRTYWxlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDggb3V0Y29tZVRva2VuSW5kZXgsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQsIHVpbnQgY29zdCk7CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3I7CiAgICB1aW50IHB1YmxpYyBjcmVhdGVkQXRCbG9jazsKICAgIEV2ZW50IHB1YmxpYyBldmVudENvbnRyYWN0OwogICAgTWFya2V0TWFrZXIgcHVibGljIG1hcmtldE1ha2VyOwogICAgdWludDI0IHB1YmxpYyBmZWU7CiAgICB1aW50IHB1YmxpYyBmdW5kaW5nOwogICAgaW50W10gcHVibGljIG5ldE91dGNvbWVUb2tlbnNTb2xkOwogICAgU3RhZ2VzIHB1YmxpYyBzdGFnZTsKCiAgICBlbnVtIFN0YWdlcyB7CiAgICAgICAgTWFya2V0Q3JlYXRlZCwKICAgICAgICBNYXJrZXRGdW5kZWQsCiAgICAgICAgTWFya2V0Q2xvc2VkCiAgICB9CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZ1bmQodWludCBfZnVuZGluZykgcHVibGljOwogICAgZnVuY3Rpb24gY2xvc2UoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZlZXMoKSBwdWJsaWMgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBidXkodWludDggb3V0Y29tZVRva2VuSW5kZXgsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQsIHVpbnQgbWF4Q29zdCkgcHVibGljIHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gc2VsbCh1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBtaW5Qcm9maXQpIHB1YmxpYyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHNob3J0U2VsbCh1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBtaW5Qcm9maXQpIHB1YmxpYyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGNhbGNNYXJrZXRGZWUodWludCBvdXRjb21lVG9rZW5Db3N0KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7Cn0KCgoKLy8vIEB0aXRsZSBBYnN0cmFjdCBtYXJrZXQgbWFrZXIgY29udHJhY3QgLSBGdW5jdGlvbnMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgbWFya2V0IG1ha2VyIGNvbnRyYWN0cwpjb250cmFjdCBNYXJrZXRNYWtlciB7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbGNDb3N0KE1hcmtldCBtYXJrZXQsIHVpbnQ4IG91dGNvbWVUb2tlbkluZGV4LCB1aW50IG91dGNvbWVUb2tlbkNvdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBjYWxjUHJvZml0KE1hcmtldCBtYXJrZXQsIHVpbnQ4IG91dGNvbWVUb2tlbkluZGV4LCB1aW50IG91dGNvbWVUb2tlbkNvdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBjYWxjTWFyZ2luYWxQcmljZShNYXJrZXQgbWFya2V0LCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwp9CgoKCi8vLyBAdGl0bGUgTE1TUiBtYXJrZXQgbWFrZXIgY29udHJhY3QgLSBDYWxjdWxhdGVzIHNoYXJlIHByaWNlcyBiYXNlZCBvbiBzaGFyZSBkaXN0cmlidXRpb24gYW5kIGluaXRpYWwgZnVuZGluZwovLy8gQGF1dGhvciBBbGFuIEx1IC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYjZkN2RhZDdkODk4ZGFjM2Y2ZDFkOGQ5YzVkZmM1OThjNmRiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgTE1TUk1hcmtldE1ha2VyIGlzIE1hcmtldE1ha2VyIHsKICAgIHVzaW5nIE1hdGggZm9yICo7CgogICAgLyoKICAgICAqICBDb25zdGFudHMKICAgICAqLwogICAgdWludCBjb25zdGFudCBPTkUgPSAweDEwMDAwMDAwMDAwMDAwMDAwOwogICAgaW50IGNvbnN0YW50IEVYUF9MSU1JVCA9IDIzNTI2ODA3OTA3MTcyODg2NDE0MDE7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgY29zdCB0byBidXkgZ2l2ZW4gbnVtYmVyIG9mIG91dGNvbWUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIG1hcmtldCBNYXJrZXQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuSW5kZXggSW5kZXggb2Ygb3V0Y29tZSB0byBidXkKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuQ291bnQgTnVtYmVyIG9mIG91dGNvbWUgdG9rZW5zIHRvIGJ1eQogICAgLy8vIEByZXR1cm4gQ29zdAogICAgZnVuY3Rpb24gY2FsY0Nvc3QoTWFya2V0IG1hcmtldCwgdWludDggb3V0Y29tZVRva2VuSW5kZXgsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IGNvc3QpCiAgICB7CiAgICAgICAgcmVxdWlyZShtYXJrZXQuZXZlbnRDb250cmFjdCgpLmdldE91dGNvbWVDb3VudCgpID4gMSk7CiAgICAgICAgaW50W10gbWVtb3J5IG5ldE91dGNvbWVUb2tlbnNTb2xkID0gZ2V0TmV0T3V0Y29tZVRva2Vuc1NvbGQobWFya2V0KTsKICAgICAgICAvLyBDYWxjdWxhdGUgY29zdCBsZXZlbCBiYXNlZCBvbiBuZXQgb3V0Y29tZSB0b2tlbiBiYWxhbmNlcwogICAgICAgIGludCBsb2dOID0gTWF0aC5sbihuZXRPdXRjb21lVG9rZW5zU29sZC5sZW5ndGggKiBPTkUpOwogICAgICAgIHVpbnQgZnVuZGluZyA9IG1hcmtldC5mdW5kaW5nKCk7CiAgICAgICAgaW50IGNvc3RMZXZlbEJlZm9yZSA9IGNhbGNDb3N0TGV2ZWwobG9nTiwgbmV0T3V0Y29tZVRva2Vuc1NvbGQsIGZ1bmRpbmcpOwogICAgICAgIC8vIEFkZCBvdXRjb21lIHRva2VuIGNvdW50IHRvIG5ldCBvdXRjb21lIHRva2VuIGJhbGFuY2UKICAgICAgICByZXF1aXJlKGludChvdXRjb21lVG9rZW5Db3VudCkgPj0gMCk7CiAgICAgICAgbmV0T3V0Y29tZVRva2Vuc1NvbGRbb3V0Y29tZVRva2VuSW5kZXhdID0gbmV0T3V0Y29tZVRva2Vuc1NvbGRbb3V0Y29tZVRva2VuSW5kZXhdLmFkZChpbnQob3V0Y29tZVRva2VuQ291bnQpKTsKICAgICAgICAvLyBDYWxjdWxhdGUgY29zdCBsZXZlbCBhZnRlciBiYWxhbmNlIHdhcyB1cGRhdGVkCiAgICAgICAgaW50IGNvc3RMZXZlbEFmdGVyID0gY2FsY0Nvc3RMZXZlbChsb2dOLCBuZXRPdXRjb21lVG9rZW5zU29sZCwgZnVuZGluZyk7CiAgICAgICAgLy8gQ2FsY3VsYXRlIGNvc3QgYXMgY29zdCBsZXZlbCBkaWZmZXJlbmNlCiAgICAgICAgcmVxdWlyZShjb3N0TGV2ZWxBZnRlciA+PSBjb3N0TGV2ZWxCZWZvcmUpOwogICAgICAgIGNvc3QgPSB1aW50KGNvc3RMZXZlbEFmdGVyIC0gY29zdExldmVsQmVmb3JlKTsKICAgICAgICAvLyBUYWtlIHRoZSBjZWlsaW5nIHRvIGFjY291bnQgZm9yIHJvdW5kaW5nCiAgICAgICAgaWYgKGNvc3QgLyBPTkUgKiBPTkUgPT0gY29zdCkKICAgICAgICAgICAgY29zdCAvPSBPTkU7CiAgICAgICAgZWxzZQogICAgICAgICAgICAvLyBJbnRlZ2VyIGRpdmlzaW9uIGJ5IE9ORSBlbnN1cmVzIHRoZXJlIGlzIHJvb20gdG8gKCsgMSkKICAgICAgICAgICAgY29zdCA9IGNvc3QgLyBPTkUgKyAxOwogICAgICAgIC8vIE1ha2Ugc3VyZSBjb3N0IGlzIG5vdCBiaWdnZXIgdGhhbiAxIHBlciBzaGFyZQogICAgICAgIGlmIChjb3N0ID4gb3V0Y29tZVRva2VuQ291bnQpCiAgICAgICAgICAgIGNvc3QgPSBvdXRjb21lVG9rZW5Db3VudDsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHByb2ZpdCBmb3Igc2VsbGluZyBnaXZlbiBudW1iZXIgb2Ygb3V0Y29tZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gbWFya2V0IE1hcmtldCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5JbmRleCBJbmRleCBvZiBvdXRjb21lIHRvIHNlbGwKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuQ291bnQgTnVtYmVyIG9mIG91dGNvbWUgdG9rZW5zIHRvIHNlbGwKICAgIC8vLyBAcmV0dXJuIFByb2ZpdAogICAgZnVuY3Rpb24gY2FsY1Byb2ZpdChNYXJrZXQgbWFya2V0LCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgcHJvZml0KQogICAgewogICAgICAgIHJlcXVpcmUobWFya2V0LmV2ZW50Q29udHJhY3QoKS5nZXRPdXRjb21lQ291bnQoKSA+IDEpOwogICAgICAgIGludFtdIG1lbW9yeSBuZXRPdXRjb21lVG9rZW5zU29sZCA9IGdldE5ldE91dGNvbWVUb2tlbnNTb2xkKG1hcmtldCk7CiAgICAgICAgLy8gQ2FsY3VsYXRlIGNvc3QgbGV2ZWwgYmFzZWQgb24gbmV0IG91dGNvbWUgdG9rZW4gYmFsYW5jZXMKICAgICAgICBpbnQgbG9nTiA9IE1hdGgubG4obmV0T3V0Y29tZVRva2Vuc1NvbGQubGVuZ3RoICogT05FKTsKICAgICAgICB1aW50IGZ1bmRpbmcgPSBtYXJrZXQuZnVuZGluZygpOwogICAgICAgIGludCBjb3N0TGV2ZWxCZWZvcmUgPSBjYWxjQ29zdExldmVsKGxvZ04sIG5ldE91dGNvbWVUb2tlbnNTb2xkLCBmdW5kaW5nKTsKICAgICAgICAvLyBTdWJ0cmFjdCBvdXRjb21lIHRva2VuIGNvdW50IGZyb20gdGhlIG5ldCBvdXRjb21lIHRva2VuIGJhbGFuY2UKICAgICAgICByZXF1aXJlKGludChvdXRjb21lVG9rZW5Db3VudCkgPj0gMCk7CiAgICAgICAgbmV0T3V0Y29tZVRva2Vuc1NvbGRbb3V0Y29tZVRva2VuSW5kZXhdID0gbmV0T3V0Y29tZVRva2Vuc1NvbGRbb3V0Y29tZVRva2VuSW5kZXhdLnN1YihpbnQob3V0Y29tZVRva2VuQ291bnQpKTsKICAgICAgICAvLyBDYWxjdWxhdGUgY29zdCBsZXZlbCBhZnRlciBiYWxhbmNlIHdhcyB1cGRhdGVkCiAgICAgICAgaW50IGNvc3RMZXZlbEFmdGVyID0gY2FsY0Nvc3RMZXZlbChsb2dOLCBuZXRPdXRjb21lVG9rZW5zU29sZCwgZnVuZGluZyk7CiAgICAgICAgLy8gQ2FsY3VsYXRlIHByb2ZpdCBhcyBjb3N0IGxldmVsIGRpZmZlcmVuY2UKICAgICAgICByZXF1aXJlKGNvc3RMZXZlbEJlZm9yZSA+PSBjb3N0TGV2ZWxBZnRlcik7CiAgICAgICAgLy8gVGFrZSB0aGUgZmxvb3IKICAgICAgICBwcm9maXQgPSB1aW50KGNvc3RMZXZlbEJlZm9yZSAtIGNvc3RMZXZlbEFmdGVyKSAvIE9ORTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG1hcmdpbmFsIHByaWNlIG9mIGFuIG91dGNvbWUKICAgIC8vLyBAcGFyYW0gbWFya2V0IE1hcmtldCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5JbmRleCBJbmRleCBvZiBvdXRjb21lIHRvIGRldGVybWluZSBtYXJnaW5hbCBwcmljZSBvZgogICAgLy8vIEByZXR1cm4gTWFyZ2luYWwgcHJpY2Ugb2YgYW4gb3V0Y29tZSBhcyBhIGZpeGVkIHBvaW50IG51bWJlcgogICAgZnVuY3Rpb24gY2FsY01hcmdpbmFsUHJpY2UoTWFya2V0IG1hcmtldCwgdWludDggb3V0Y29tZVRva2VuSW5kZXgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IHByaWNlKQogICAgewogICAgICAgIHJlcXVpcmUobWFya2V0LmV2ZW50Q29udHJhY3QoKS5nZXRPdXRjb21lQ291bnQoKSA+IDEpOwogICAgICAgIGludFtdIG1lbW9yeSBuZXRPdXRjb21lVG9rZW5zU29sZCA9IGdldE5ldE91dGNvbWVUb2tlbnNTb2xkKG1hcmtldCk7CiAgICAgICAgaW50IGxvZ04gPSBNYXRoLmxuKG5ldE91dGNvbWVUb2tlbnNTb2xkLmxlbmd0aCAqIE9ORSk7CiAgICAgICAgdWludCBmdW5kaW5nID0gbWFya2V0LmZ1bmRpbmcoKTsKICAgICAgICAvLyBUaGUgcHJpY2UgZnVuY3Rpb24gaXMgZXhwKHF1YW50aXRpZXNbaV0vYikgLyBzdW0oZXhwKHEvYikgZm9yIHEgaW4gcXVhbnRpdGllcykKICAgICAgICAvLyBUbyBhdm9pZCBvdmVyZmxvdywgY2FsY3VsYXRlIHdpdGgKICAgICAgICAvLyBleHAocXVhbnRpdGllc1tpXS9iIC0gb2Zmc2V0KSAvIHN1bShleHAocS9iIC0gb2Zmc2V0KSBmb3IgcSBpbiBxdWFudGl0aWVzKQogICAgICAgIHZhciAoc3VtLCAsIG91dGNvbWVFeHBUZXJtKSA9IHN1bUV4cE9mZnNldChsb2dOLCBuZXRPdXRjb21lVG9rZW5zU29sZCwgZnVuZGluZywgb3V0Y29tZVRva2VuSW5kZXgpOwogICAgICAgIHJldHVybiBvdXRjb21lRXhwVGVybSAvIChzdW0gLyBPTkUpOwogICAgfQoKICAgIC8qCiAgICAgKiAgUHJpdmF0ZSBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgcmVzdWx0IG9mIHRoZSBMTVNSIGNvc3QgZnVuY3Rpb24gd2hpY2ggaXMgdXNlZCB0bwogICAgLy8vICAgICAgZGVyaXZlIHByaWNlcyBmcm9tIHRoZSBtYXJrZXQgc3RhdGUKICAgIC8vLyBAcGFyYW0gbG9nTiBMb2dhcml0aG0gb2YgdGhlIG51bWJlciBvZiBvdXRjb21lcwogICAgLy8vIEBwYXJhbSBuZXRPdXRjb21lVG9rZW5zU29sZCBOZXQgb3V0Y29tZSB0b2tlbnMgc29sZCBieSBtYXJrZXQKICAgIC8vLyBAcGFyYW0gZnVuZGluZyBJbml0aWFsIGZ1bmRpbmcgZm9yIG1hcmtldAogICAgLy8vIEByZXR1cm4gQ29zdCBsZXZlbAogICAgZnVuY3Rpb24gY2FsY0Nvc3RMZXZlbChpbnQgbG9nTiwgaW50W10gbmV0T3V0Y29tZVRva2Vuc1NvbGQsIHVpbnQgZnVuZGluZykKICAgICAgICBwcml2YXRlCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKGludCBjb3N0TGV2ZWwpCiAgICB7CiAgICAgICAgLy8gVGhlIGNvc3QgZnVuY3Rpb24gaXMgQyA9IGIgKiBsb2coc3VtKGV4cChxL2IpIGZvciBxIGluIHF1YW50aXRpZXMpKS4KICAgICAgICAvLyBUbyBhdm9pZCBvdmVyZmxvdywgd2UgbmVlZCB0byBjYWxjIHdpdGggYW4gZXhwb25lbnQgb2Zmc2V0OgogICAgICAgIC8vIEMgPSBiICogKG9mZnNldCArIGxvZyhzdW0oZXhwKHEvYiAtIG9mZnNldCkgZm9yIHEgaW4gcXVhbnRpdGllcykpKQogICAgICAgIHZhciAoc3VtLCBvZmZzZXQsICkgPSBzdW1FeHBPZmZzZXQobG9nTiwgbmV0T3V0Y29tZVRva2Vuc1NvbGQsIGZ1bmRpbmcsIDApOwogICAgICAgIGNvc3RMZXZlbCA9IE1hdGgubG4oc3VtKTsKICAgICAgICBjb3N0TGV2ZWwgPSBjb3N0TGV2ZWwuYWRkKG9mZnNldCk7CiAgICAgICAgY29zdExldmVsID0gKGNvc3RMZXZlbC5tdWwoaW50KE9ORSkpIC8gbG9nTikubXVsKGludChmdW5kaW5nKSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyBzdW0oZXhwKHEvYiAtIG9mZnNldCkgZm9yIHEgaW4gcXVhbnRpdGllcyksIHdoZXJlIG9mZnNldCBpcyBzZXQKICAgIC8vLyAgICAgIHNvIHRoYXQgdGhlIHN1bSBmaXRzIGluIDI0OC0yNTYgYml0cwogICAgLy8vIEBwYXJhbSBsb2dOIExvZ2FyaXRobSBvZiB0aGUgbnVtYmVyIG9mIG91dGNvbWVzCiAgICAvLy8gQHBhcmFtIG5ldE91dGNvbWVUb2tlbnNTb2xkIE5ldCBvdXRjb21lIHRva2VucyBzb2xkIGJ5IG1hcmtldAogICAgLy8vIEBwYXJhbSBmdW5kaW5nIEluaXRpYWwgZnVuZGluZyBmb3IgbWFya2V0CiAgICAvLy8gQHBhcmFtIG91dGNvbWVJbmRleCBJbmRleCBvZiBleHBvbmVudGlhbCB0ZXJtIHRvIGV4dHJhY3QgKGZvciB1c2UgYnkgbWFyZ2luYWwgcHJpY2UgZnVuY3Rpb24pCiAgICAvLy8gQHJldHVybiBBIHJlc3VsdCBzdHJ1Y3R1cmUgY29tcG9zZWQgb2YgdGhlIHN1bSwgdGhlIG9mZnNldCB1c2VkLCBhbmQgdGhlIHN1bW1hbmQgYXNzb2NpYXRlZCB3aXRoIHRoZSBzdXBwbGllZCBpbmRleAogICAgZnVuY3Rpb24gc3VtRXhwT2Zmc2V0KGludCBsb2dOLCBpbnRbXSBuZXRPdXRjb21lVG9rZW5zU29sZCwgdWludCBmdW5kaW5nLCB1aW50OCBvdXRjb21lSW5kZXgpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCBzdW0sIGludCBvZmZzZXQsIHVpbnQgb3V0Y29tZUV4cFRlcm0pCiAgICB7CiAgICAgICAgLy8gTmFpdmUgY2FsY3VsYXRpb24gb2YgdGhpcyBjYXVzZXMgYW4gb3ZlcmZsb3cKICAgICAgICAvLyBzaW5jZSBhbnl0aGluZyBhYm92ZSBhIGJpdCBvdmVyIDEzMypPTkUgc3VwcGxpZWQgdG8gZXhwIHdpbGwgZXhwbG9kZQogICAgICAgIC8vIGFzIGV4cCgxMzMpIGp1c3QgYWJvdXQgZml0cyBpbnRvIDE5MiBiaXRzIG9mIHdob2xlIG51bWJlciBkYXRhLgoKICAgICAgICAvLyBUaGUgY2hvaWNlIG9mIHRoaXMgb2Zmc2V0IGlzIHN1YmplY3QgdG8gYW5vdGhlciBsaW1pdDoKICAgICAgICAvLyBjb21wdXRpbmcgdGhlIGlubmVyIHN1bSBzdWNjZXNzZnVsbHkuCiAgICAgICAgLy8gU2luY2UgdGhlIGluZGV4IGlzIDggYml0cywgdGhlcmUgaGFzIHRvIGJlIDggYml0cyBvZiBoZWFkcm9vbSBmb3IKICAgICAgICAvLyBlYWNoIHN1bW1hbmQsIG1lYW5pbmcgcS9iIC0gb2Zmc2V0IDw9IGV4cG9uZW50aWFsX2xpbWl0LAogICAgICAgIC8vIHdoZXJlIHRoYXQgbGltaXQgY2FuIGJlIGZvdW5kIHdpdGggYG1wLmZsb29yKG1wLmxvZygoMioqMjQ4IC0gMSkgLyBPTkUpICogT05FKWAKICAgICAgICAvLyBUaGF0IGlzIHdoYXQgRVhQX0xJTUlUIGlzIHNldCB0bzogaXQgaXMgYWJvdXQgMTI3LjUKCiAgICAgICAgLy8gZmluYWxseSwgaWYgdGhlIGRpc3RyaWJ1dGlvbiBsb29rcyBsaWtlIFtCSUcsIHRpbnksIHRpbnkuLi5dLCB1c2luZyBhCiAgICAgICAgLy8gQklHIG9mZnNldCB3aWxsIGNhdXNlIHRoZSB0aW55IHF1YW50aXRpZXMgdG8gZ28gcmVhbGx5IG5lZ2F0aXZlCiAgICAgICAgLy8gY2F1c2luZyB0aGUgYXNzb2NpYXRlZCBleHBvbmVudGlhbHMgdG8gdmFuaXNoLgoKICAgICAgICBpbnQgbWF4UXVhbnRpdHkgPSBNYXRoLm1heChuZXRPdXRjb21lVG9rZW5zU29sZCk7CiAgICAgICAgcmVxdWlyZShsb2dOID49IDAgJiYgaW50KGZ1bmRpbmcpID49IDApOwogICAgICAgIG9mZnNldCA9IG1heFF1YW50aXR5Lm11bChsb2dOKSAvIGludChmdW5kaW5nKTsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQuc3ViKEVYUF9MSU1JVCk7CiAgICAgICAgdWludCB0ZXJtOwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBuZXRPdXRjb21lVG9rZW5zU29sZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0ZXJtID0gTWF0aC5leHAoKG5ldE91dGNvbWVUb2tlbnNTb2xkW2ldLm11bChsb2dOKSAvIGludChmdW5kaW5nKSkuc3ViKG9mZnNldCkpOwogICAgICAgICAgICBpZiAoaSA9PSBvdXRjb21lSW5kZXgpCiAgICAgICAgICAgICAgICBvdXRjb21lRXhwVGVybSA9IHRlcm07CiAgICAgICAgICAgIHN1bSA9IHN1bS5hZGQodGVybSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEdldHMgbmV0IG91dGNvbWUgdG9rZW5zIHNvbGQgYnkgbWFya2V0LiBTaW5jZSBhbGwgc2V0cyBvZiBvdXRjb21lIHRva2VucyBhcmUgYmFja2VkIGJ5CiAgICAvLy8gICAgICBjb3JyZXNwb25kaW5nIGNvbGxhdGVyYWwgdG9rZW5zLCB0aGUgbmV0IHF1YW50aXR5IG9mIGEgdG9rZW4gc29sZCBieSB0aGUgbWFya2V0IGlzIHRoZQogICAgLy8vICAgICAgbnVtYmVyIG9mIGNvbGxhdGVyYWwgdG9rZW5zICh3aGljaCBpcyB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIG91dGNvbWUgdG9rZW5zIHRoZQogICAgLy8vICAgICAgbWFya2V0IGNyZWF0ZWQpIHN1YnRyYWN0ZWQgYnkgdGhlIHF1YW50aXR5IG9mIHRoYXQgdG9rZW4gaGVsZCBieSB0aGUgbWFya2V0LgogICAgLy8vIEBwYXJhbSBtYXJrZXQgTWFya2V0IGNvbnRyYWN0CiAgICAvLy8gQHJldHVybiBOZXQgb3V0Y29tZSB0b2tlbnMgc29sZCBieSBtYXJrZXQKICAgIGZ1bmN0aW9uIGdldE5ldE91dGNvbWVUb2tlbnNTb2xkKE1hcmtldCBtYXJrZXQpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50W10gcXVhbnRpdGllcykKICAgIHsKICAgICAgICBxdWFudGl0aWVzID0gbmV3IGludFtdKG1hcmtldC5ldmVudENvbnRyYWN0KCkuZ2V0T3V0Y29tZUNvdW50KCkpOwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBxdWFudGl0aWVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBxdWFudGl0aWVzW2ldID0gbWFya2V0Lm5ldE91dGNvbWVUb2tlbnNTb2xkKGkpOwogICAgfQp9'.
	

]
