Class {
	#name : #SRT9311f7ee5f48a807d598cdd68f43cd4e73ffa747,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9311f7ee5f48a807d598cdd68f43cd4e73ffa747 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEdUTyBUb2tlbiBieSBHVE8gTGltaXRlZC4KLy8gQW4gRVJDMjAgc3RhbmRhcmQKLy8KLy8gYXV0aG9yOiBHVE8gVGVhbQovLyBDb250YWN0OiA8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjgwZTRlMWY0ZjdlOGVlZTdmNWY5ZTVlZWMwZTdlZGUxZTllY2FlZTNlZmVkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPgoKY29udHJhY3QgRVJDMjBJbnRlcmZhY2UgewogICAgLy8gR2V0IHRoZSB0b3RhbCB0b2tlbiBzdXBwbHkKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX3RvdGFsU3VwcGx5KTsKIAogICAgLy8gR2V0IHRoZSBhY2NvdW50IGJhbGFuY2Ugb2YgYW5vdGhlciBhY2NvdW50IHdpdGggYWRkcmVzcyBfb3duZXIKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAKICAgIC8vIFNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gYWRkcmVzcyBfdG8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICAKICAgIC8vIHRyYW5zZmVyIF92YWx1ZSBhbW91bnQgb2YgdG9rZW4gYXBwcm92ZWQgYnkgYWRkcmVzcyBfZnJvbQogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8gYXBwcm92ZSBhbiBhZGRyZXNzIHdpdGggX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vIGdldCByZW1haW5pbmcgdG9rZW4gYXBwcm92ZWQgYnkgX293bmVyIHRvIF9zcGVuZGVyCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkLgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAKICAgIC8vIFRyaWdnZXJlZCB3aGVuZXZlciBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBpcyBjYWxsZWQuCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQogCmNvbnRyYWN0IEdUTyBpcyBFUkMyMEludGVyZmFjZSB7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSA1OwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkdUTyI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiR1RPIjsKCiAgICBib29sIHB1YmxpYyBfc2VsbGluZyA9IGZhbHNlOy8vaW5pdGlhbCBub3Qgc2VsbGluZwogICAgdWludDI1NiBwdWJsaWMgX3RvdGFsU3VwcGx5ID0gMTAgKiogMTQ7IC8vIHRvdGFsIHN1cHBseSBpcyAxMF4xNCB1bml0LCBlcXVpdmFsZW50IHRvIDEwXjkgR1RPCiAgICB1aW50MjU2IHB1YmxpYyBfb3JpZ2luYWxCdXlQcmljZSA9IDQ1ICogMTAqKjc7IC8vIG9yaWdpbmFsIGJ1eSAxRVRIID0gNDUwMCBHVE8gPSA0NSAqIDEwKio3IHVuaXQKCiAgICAvLyBPd25lciBvZiB0aGlzIGNvbnRyYWN0CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKIAogICAgLy8gQmFsYW5jZXMgR1RPIGZvciBlYWNoIGFjY291bnQKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwcml2YXRlIGJhbGFuY2VzOwogICAgCiAgICAvLyBPd25lciBvZiBhY2NvdW50IGFwcHJvdmVzIHRoZSB0cmFuc2ZlciBvZiBhbiBhbW91bnQgdG8gYW5vdGhlciBhY2NvdW50CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHJpdmF0ZSBhbGxvd2VkOwoKICAgIC8vIExpc3Qgb2YgYXBwcm92ZWQgaW52ZXN0b3JzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHJpdmF0ZSBhcHByb3ZlZEludmVzdG9yTGlzdDsKICAgIAogICAgLy8gbWFwcGluZyBEZXBvc2l0CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHJpdmF0ZSBkZXBvc2l0OwogICAgCiAgICAvLyBidXllcnMgYnV5IHRva2VuIGRlcG9zaXQKICAgIGFkZHJlc3NbXSBwcml2YXRlIGJ1eWVyczsKICAgIAogICAgLy8gaWNvUGVyY2VudAogICAgdWludDggcHVibGljIF9pY29QZXJjZW50ID0gMTA7CiAgICAKICAgIC8vIF9pY29TdXBwbHkgaXMgdGhlIGF2YWxhYmxlIHVuaXQuIEluaXRpYWxseSwgaXQgaXMgX3RvdGFsU3VwcGx5CiAgICB1aW50MjU2IHB1YmxpYyBfaWNvU3VwcGx5ID0gX3RvdGFsU3VwcGx5ICogX2ljb1BlcmNlbnQgLyAxMDA7CiAgICAKICAgIC8vIG1pbmltdW0gYnV5IDAuMyBFVEgKICAgIHVpbnQyNTYgcHVibGljIF9taW5pbXVtQnV5ID0gMyAqIDEwICoqIDE3OwogICAgCiAgICAvLyBtYXhpbXVtIGJ1eSAzMCBFVEgKICAgIHVpbnQyNTYgcHVibGljIF9tYXhpbXVtQnV5ID0gMzAgKiAxMCAqKiAxODsKICAgIAogICAgLyoqCiAgICAgKiBGdW5jdGlvbnMgd2l0aCB0aGlzIG1vZGlmaWVyIGNhbiBvbmx5IGJlIGV4ZWN1dGVkIGJ5IHRoZSBvd25lcgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb25zIHdpdGggdGhpcyBtb2RpZmllciBjaGVjayBvbiBzYWxlIHN0YXR1cwogICAgICogT25seSBhbGxvdyBzYWxlIGlmIF9zZWxsaW5nIGlzIG9uCiAgICAgKi8KICAgIG1vZGlmaWVyIG9uU2FsZSgpIHsKICAgICAgICByZXF1aXJlKF9zZWxsaW5nICYmIChfaWNvU3VwcGx5ID4gMCkgKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEZ1bmN0aW9ucyB3aXRoIHRoaXMgbW9kaWZpZXIgY2hlY2sgdGhlIHZhbGlkaXR5IG9mIGFkZHJlc3MgaXMgaW52ZXN0b3IKICAgICAqLwogICAgbW9kaWZpZXIgdmFsaWRJbnZlc3RvcigpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmVkSW52ZXN0b3JMaXN0W21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEZ1bmN0aW9ucyB3aXRoIHRoaXMgbW9kaWZpZXIgY2hlY2sgdGhlIHZhbGlkaXR5IG9mIG1zZyB2YWx1ZQogICAgICogdmFsdWUgbXVzdCBncmVhdGVyIHRoYW4gZXF1YWwgbWluaW11bUJ1eVByaWNlCiAgICAgKiB0b3RhbCBkZXBvc2l0IG11c3QgbGVzcyB0aGFuIGVxdWFsIG1heGltdW1CdXlQcmljZQogICAgICovCiAgICBtb2RpZmllciB2YWxpZFZhbHVlKCl7CiAgICAgICAgLy8gcmVxdWlyZSB2YWx1ZSA+PSBfbWluaW11bUJ1eSBBTkQgdG90YWwgZGVwb3NpdCBvZiBtc2cuc2VuZGVyIDw9IG1heGltdW1CdXlQcmljZQogICAgICAgIHJlcXVpcmUgKCAobXNnLnZhbHVlID49IF9taW5pbXVtQnV5KSAmJgogICAgICAgICAgICAgICAgKCAoZGVwb3NpdFttc2cuc2VuZGVyXSArIG1zZy52YWx1ZSkgPD0gX21heGltdW1CdXkpICk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBGdW5jdGlvbnMgd2l0aCB0aGlzIG1vZGlmaWVyIGNoZWNrIHRoZSB2YWxpZGl0eSBvZiByYW5nZSBbYSwgYl0gPD0gWzAsIGJ1eWVycy5sZW5ndGgtMV0KICAgICAqLwogICAgbW9kaWZpZXIgdmFsaWRSYW5nZSh1aW50MjU2IGEsIHVpbnQyNTYgYil7CiAgICAgICAgcmVxdWlyZSAoIChhPj0wICYmIGE8PWIpICYmCiAgICAgICAgICAgICAgICAgIChiPGJ1eWVycy5sZW5ndGgpICk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbGxvd3MgdG8gYnV5IGV0aGVyLgogICAgZnVuY3Rpb24oKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUgewogICAgICAgIGJ1eUdpZnRvKCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IGJ1eSBmdW5jdGlvbiBhbGxvd3MgdG8gYnV5IGV0aGVyLiBmb3IgdXNpbmcgb3B0aW9uYWwgZGF0YQogICAgZnVuY3Rpb24gYnV5R2lmdG8oKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICBvblNhbGUKICAgICAgICB2YWxpZFZhbHVlCiAgICAgICAgdmFsaWRJbnZlc3RvciB7CiAgICAgICAgLy8gY2hlY2sgdGhlIGZpcnN0IGJ1eSA9PiBwdXNoIHRvIEFycmF5CiAgICAgICAgaWYgKGRlcG9zaXRbbXNnLnNlbmRlcl0gPT0gMCl7CiAgICAgICAgICAgIC8vIGFkZCBuZXcgYnV5ZXIgdG8gTGlzdAogICAgICAgICAgICBidXllcnMucHVzaChtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICAgICAgLy8gaW5jcmVhc2UgYW1vdW50IGRlcG9zaXQgb2YgYnV5ZXIKICAgICAgICBkZXBvc2l0W21zZy5zZW5kZXJdICs9IG1zZy52YWx1ZTsKICAgICAgICAvLyB0cmFuc2ZlciB2YWx1ZSBkaXJlY3RseSBmb3Igb3duZXIKICAgICAgICBvd25lci50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBHVE8oKSAKICAgICAgICBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICAvLyBidXllcnMgPSBuZXcgYWRkcmVzc1tdKDEpOwogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IF90b3RhbFN1cHBseTsKICAgICAgICBUcmFuc2ZlcigweDAsIG93bmVyLCBfdG90YWxTdXBwbHkpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBHZXRzIHRvdGFsU3VwcGx5CiAgICAvLy8gQHJldHVybiBUb3RhbCBzdXBwbHkKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkKICAgICAgICBwdWJsaWMgCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfdG90YWxTdXBwbHk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEVuYWJsZXMgc2FsZSAKICAgIGZ1bmN0aW9uIHR1cm5PblNhbGUoKSBvbmx5T3duZXIgCiAgICAgICAgcHVibGljIHsKICAgICAgICBfc2VsbGluZyA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgRGlzYWJsZXMgc2FsZQogICAgZnVuY3Rpb24gdHVybk9mZlNhbGUoKSBvbmx5T3duZXIgCiAgICAgICAgcHVibGljIHsKICAgICAgICBfc2VsbGluZyA9IGZhbHNlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBzZXQgbmV3IGljb1BlcmNlbnQKICAgIC8vLyBAcGFyYW0gbmV3SWNvUGVyY2VudCBuZXcgdmFsdWUgb2YgaWNvUGVyY2VudAogICAgZnVuY3Rpb24gc2V0SWNvUGVyY2VudCh1aW50OCBuZXdJY29QZXJjZW50KQogICAgICAgIHB1YmxpYyAKICAgICAgICBvbmx5T3duZXIgewogICAgICAgIF9pY29QZXJjZW50ID0gbmV3SWNvUGVyY2VudDsKICAgICAgICBfaWNvU3VwcGx5ID0gX3RvdGFsU3VwcGx5ICogX2ljb1BlcmNlbnQgLyAxMDA7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IHNldCBuZXcgX21heGltdW1CdXkKICAgIC8vLyBAcGFyYW0gbmV3TWF4aW11bUJ1eSBuZXcgdmFsdWUgb2YgX21heGltdW1CdXkKICAgIGZ1bmN0aW9uIHNldE1heGltdW1CdXkodWludDI1NiBuZXdNYXhpbXVtQnV5KQogICAgICAgIHB1YmxpYyAKICAgICAgICBvbmx5T3duZXIgewogICAgICAgIF9tYXhpbXVtQnV5ID0gbmV3TWF4aW11bUJ1eTsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIGJ1eSBwcmljZSAob3duZXIgT05MWSkKICAgIC8vLyBAcGFyYW0gbmV3QnV5UHJpY2UgTmV3IGJ1eSBwcmljZSAoaW4gdW5pdCkKICAgIGZ1bmN0aW9uIHNldEJ1eVByaWNlKHVpbnQyNTYgbmV3QnV5UHJpY2UpIAogICAgICAgIG9ubHlPd25lciAKICAgICAgICBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3QnV5UHJpY2U+MCk7CiAgICAgICAgX29yaWdpbmFsQnV5UHJpY2UgPSBuZXdCdXlQcmljZTsgLy8gMzAwMCBHVE8gPSAzMDAwIDAwMDAwIHVuaXQKICAgICAgICAvLyBjb250cm9sIF9tYXhpbXVtQnV5X1VTRCA9IDEwLDAwMCBVU0QsIEdUTyBwcmljZSBpcyAwLjFVU0QKICAgICAgICAvLyBtYXhpbXVtQnV5X0dpZnRvID0gMTAwLDAwMCBHVE8gPSAxMDAsMDAwLDAwMDAwIHVuaXQKICAgICAgICAvLyAzMDAwIEdUTyA9IDFFVEggPT4gbWF4aW11bUVUSCA9IDEwMCwwMDAsMDAwMDAgLyBfb3JpZ2luYWxCdXlQcmljZQogICAgICAgIC8vIDEwMCwwMDAsMDAwMDAvMzAwMCAwMDAwIH4gMzNFVEggPT4gY2hhbmdlIHRvIHdlaQogICAgICAgIF9tYXhpbXVtQnV5ID0gMTAqKjE4ICogMTAwMDAwMDAwMDAgL19vcmlnaW5hbEJ1eVByaWNlOwogICAgfQogICAgICAgIAogICAgLy8vIEBkZXYgR2V0cyBhY2NvdW50J3MgYmFsYW5jZQogICAgLy8vIEBwYXJhbSBfYWRkciBBZGRyZXNzIG9mIHRoZSBhY2NvdW50CiAgICAvLy8gQHJldHVybiBBY2NvdW50IGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9hZGRyKSAKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudCAKICAgICAgICByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19hZGRyXTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgY2hlY2sgYWRkcmVzcyBpcyBhcHByb3ZlZCBpbnZlc3RvcgogICAgLy8vIEBwYXJhbSBfYWRkciBhZGRyZXNzCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkSW52ZXN0b3IoYWRkcmVzcyBfYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXBwcm92ZWRJbnZlc3Rvckxpc3RbX2FkZHJdOwogICAgfQogICAgCiAgICAvLy8gQGRldiBnZXQgaW52ZXN0b3JzIGRlcG9zaXRlZAogICAgZnVuY3Rpb24gZ2V0QnV5ZXJzKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMoYWRkcmVzc1tdKXsKICAgICAgICByZXR1cm4gYnV5ZXJzOwogICAgfQogICAgCiAgICAvLy8gQGRldiBnZXQgRVRIIGRlcG9zaXQKICAgIC8vLyBAcGFyYW0gX2FkZHIgYWRkcmVzcyBnZXQgZGVwb3NpdAogICAgLy8vIEByZXR1cm4gYW1vdW50IGRlcG9zaXQgb2YgYW4gYnV5ZXIKICAgIGZ1bmN0aW9uIGdldERlcG9zaXQoYWRkcmVzcyBfYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIGRlcG9zaXRbX2FkZHJdOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBZGRzIGxpc3Qgb2YgbmV3IGludmVzdG9ycyB0byB0aGUgaW52ZXN0b3JzIGxpc3QgYW5kIGFwcHJvdmUgYWxsCiAgICAvLy8gQHBhcmFtIG5ld0ludmVzdG9yTGlzdCBBcnJheSBvZiBuZXcgaW52ZXN0b3JzIGFkZHJlc3NlcyB0byBiZSBhZGRlZAogICAgZnVuY3Rpb24gYWRkSW52ZXN0b3JMaXN0KGFkZHJlc3NbXSBuZXdJbnZlc3Rvckxpc3QpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcHVibGljIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBuZXdJbnZlc3Rvckxpc3QubGVuZ3RoOyBpKyspewogICAgICAgICAgICBhcHByb3ZlZEludmVzdG9yTGlzdFtuZXdJbnZlc3Rvckxpc3RbaV1dID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlcyBsaXN0IG9mIGludmVzdG9ycyBmcm9tIGxpc3QKICAgIC8vLyBAcGFyYW0gaW52ZXN0b3JMaXN0IEFycmF5IG9mIGFkZHJlc3NlcyBvZiBpbnZlc3RvcnMgdG8gYmUgcmVtb3ZlZAogICAgZnVuY3Rpb24gcmVtb3ZlSW52ZXN0b3JMaXN0KGFkZHJlc3NbXSBpbnZlc3Rvckxpc3QpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcHVibGljIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBpbnZlc3Rvckxpc3QubGVuZ3RoOyBpKyspewogICAgICAgICAgICBhcHByb3ZlZEludmVzdG9yTGlzdFtpbnZlc3Rvckxpc3RbaV1dID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBkZWxpdmVyeSB0b2tlbiBmb3IgYnV5ZXIKICAgIC8vLyBAcGFyYW0gYSBzdGFydCBwb2ludAogICAgLy8vIEBwYXJhbSBiIGVuZCBwb2ludAogICAgZnVuY3Rpb24gZGVsaXZlcnlUb2tlbih1aW50MjU2IGEsIHVpbnQyNTYgYikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgICAgICB2YWxpZFJhbmdlKGEsIGIpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgYmFsYW5jZXMgb3duZXIgZ3JlYXRlciB0aGFuIF9pY29TdXBwbHkKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW293bmVyXSA+PSBfaWNvU3VwcGx5KTsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IGE7IGkgPD0gYjsgaSsrKXsKICAgICAgICAgICAgaWYoYXBwcm92ZWRJbnZlc3Rvckxpc3RbYnV5ZXJzW2ldXSl7CiAgICAgICAgICAgICAgICAvLyBjb21wdXRlIGFtb3VudCB0b2tlbiBvZiBlYWNoIGJ1eWVyCiAgICAgICAgICAgICAgICB1aW50MjU2IHJlcXVlc3RlZFVuaXRzID0gKGRlcG9zaXRbYnV5ZXJzW2ldXSAqIF9vcmlnaW5hbEJ1eVByaWNlKSAvIDEwKioxODsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy9jaGVjayByZXF1ZXN0ZWRVbml0cyA+IF9pY29TdXBwbHkKICAgICAgICAgICAgICAgIGlmKHJlcXVlc3RlZFVuaXRzIDw9IF9pY29TdXBwbHkgJiYgcmVxdWVzdGVkVW5pdHMgPiAwICl7CiAgICAgICAgICAgICAgICAgICAgLy8gcHJlcGFyZSB0cmFuc2ZlciBkYXRhCiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZXNbb3duZXJdIC09IHJlcXVlc3RlZFVuaXRzOwogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VzW2J1eWVyc1tpXV0gKz0gcmVxdWVzdGVkVW5pdHM7CiAgICAgICAgICAgICAgICAgICAgX2ljb1N1cHBseSAtPSByZXF1ZXN0ZWRVbml0czsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBzdWJtaXQgdHJhbnNmZXIKICAgICAgICAgICAgICAgICAgICBUcmFuc2Zlcihvd25lciwgYnV5ZXJzW2ldLCByZXF1ZXN0ZWRVbml0cyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgZGVwb3NpdCBvZiBidXllcgogICAgICAgICAgICAgICAgICAgIGRlcG9zaXRbYnV5ZXJzW2ldXSA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0aGUgYmFsYW5jZSBmcm9tIE11bHRpc2lnIHdhbGxldCB0byBhbiBhY2NvdW50CiAgICAvLy8gQHBhcmFtIF90byBSZWNpcGllbnQgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRyYW5zZmVyZWQgYW1vdW50IGluIHVuaXQKICAgIC8vLyBAcmV0dXJuIFRyYW5zZmVyIHN0YXR1cwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMgCiAgICAgICAgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIGlmIHNlbmRlcidzIGJhbGFuY2UgaGFzIGVub3VnaCB1bml0IGFuZCBhbW91bnQgPj0gMCwgCiAgICAgICAgLy8gICAgICBhbmQgdGhlIHN1bSBpcyBub3Qgb3ZlcmZsb3csCiAgICAgICAgLy8gdGhlbiBkbyB0cmFuc2ZlciAKICAgICAgICBpZiAoIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfYW1vdW50KSAmJgogICAgICAgICAgICAgKF9hbW91bnQgPj0gMCkgJiYgCiAgICAgICAgICAgICAoYmFsYW5jZXNbX3RvXSArIF9hbW91bnQgPiBiYWxhbmNlc1tfdG9dKSApIHsgIAoKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfYW1vdW50OwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgIAogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8KICAgIC8vIFRoZSB0cmFuc2ZlckZyb20gbWV0aG9kIGlzIHVzZWQgZm9yIGEgd2l0aGRyYXcgd29ya2Zsb3csIGFsbG93aW5nIGNvbnRyYWN0cyB0byBzZW5kCiAgICAvLyB0b2tlbnMgb24geW91ciBiZWhhbGYsIGZvciBleGFtcGxlIHRvICJkZXBvc2l0IiB0byBhIGNvbnRyYWN0IGFkZHJlc3MgYW5kL29yIHRvIGNoYXJnZQogICAgLy8gZmVlcyBpbiBzdWItY3VycmVuY2llczsgdGhlIGNvbW1hbmQgc2hvdWxkIGZhaWwgdW5sZXNzIHRoZSBfZnJvbSBhY2NvdW50IGhhcwogICAgLy8gZGVsaWJlcmF0ZWx5IGF1dGhvcml6ZWQgdGhlIHNlbmRlciBvZiB0aGUgbWVzc2FnZSB2aWEgc29tZSBtZWNoYW5pc207IHdlIHByb3Bvc2UKICAgIC8vIHRoZXNlIHN0YW5kYXJkaXplZCBBUElzIGZvciBhcHByb3ZhbDoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF9hbW91bnQKICAgICAgICAgICAgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX2Ftb3VudAogICAgICAgICAgICAmJiBfYW1vdW50ID4gMAogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX2Ftb3VudCA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF9hbW91bnQ7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX2Ftb3VudDsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIEFsbG93IF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20geW91ciBhY2NvdW50LCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQuCiAgICAvLyBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSAKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvLyBnZXQgYWxsb3dhbmNlCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIAogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50IAogICAgICAgIHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFdpdGhkcmF3cyBFdGhlciBpbiBjb250cmFjdCAoT3duZXIgb25seSkKICAgIC8vLyBAcmV0dXJuIFN0YXR1cyBvZiB3aXRoZHJhd2FsCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIG9ubHlPd25lciAKICAgICAgICBwdWJsaWMgCiAgICAgICAgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBvd25lci5zZW5kKHRoaXMuYmFsYW5jZSk7CiAgICB9Cn0KCi8vLyBAdGl0bGUgTXVsdGlzaWduYXR1cmUgd2FsbGV0IC0gQWxsb3dzIG11bHRpcGxlIHBhcnRpZXMgdG8gYWdyZWUgb24gdHJhbnNhY3Rpb25zIGJlZm9yZSBleGVjdXRpb24uCi8vLyBAYXV0aG9yIFN0ZWZhbiBHZW9yZ2UgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlMDkzOTQ4NTg2ODE4ZWNlODc4NThmOTI4Nzg1YTA4MzhmOGU5Mzg1OGU5Mzk5OTNjZThlODU5NCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CmNvbnRyYWN0IE11bHRpU2lnV2FsbGV0IHsKCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBNQVhfT1dORVJfQ09VTlQgPSA1MDsKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgUmV2b2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBTdWJtaXNzaW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IEV4ZWN1dGlvbih1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBFeGVjdXRpb25GYWlsdXJlKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IERlcG9zaXQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCB2YWx1ZSk7CiAgICBldmVudCBPd25lckFkZGl0aW9uKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7CiAgICBldmVudCBPd25lclJlbW92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlKHVpbnQgcmVxdWlyZWQpOwogICAgZXZlbnQgQ29pbkNyZWF0aW9uKGFkZHJlc3MgY29pbik7CgogICAgbWFwcGluZyAodWludCA9PiBUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIGNvbmZpcm1hdGlvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc093bmVyOwogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lcnM7CiAgICB1aW50IHB1YmxpYyByZXF1aXJlZDsKICAgIHVpbnQgcHVibGljIHRyYW5zYWN0aW9uQ291bnQ7CiAgICBib29sIGZsYWcgPSB0cnVlOwoKICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBkZXN0aW5hdGlvbjsKICAgICAgICB1aW50IHZhbHVlOwogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgYm9vbCBleGVjdXRlZDsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJEb2VzTm90RXhpc3QoYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmIChpc093bmVyW293bmVyXSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckV4aXN0cyhhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgaWYgKCFpc093bmVyW293bmVyXSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0cmFuc2FjdGlvbkV4aXN0cyh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmRlc3RpbmF0aW9uID09IDApCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmICghY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90Q29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyXSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RFeGVjdXRlZCh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmV4ZWN1dGVkKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdE51bGwoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIGlmIChfYWRkcmVzcyA9PSAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkUmVxdWlyZW1lbnQodWludCBvd25lckNvdW50LCB1aW50IF9yZXF1aXJlZCkgewogICAgICAgIGlmICggICBvd25lckNvdW50ID4gTUFYX09XTkVSX0NPVU5UCiAgICAgICAgICAgIHx8IF9yZXF1aXJlZCA+IG93bmVyQ291bnQKICAgICAgICAgICAgfHwgX3JlcXVpcmVkID09IDAKICAgICAgICAgICAgfHwgb3duZXJDb3VudCA9PSAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIGFsbG93cyB0byBkZXBvc2l0IGV0aGVyLgogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkKICAgICAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIC8qCiAgICAgKiBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIHNldHMgaW5pdGlhbCBvd25lcnMgYW5kIHJlcXVpcmVkIG51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgLy8vIEBwYXJhbSBfb3duZXJzIExpc3Qgb2YgaW5pdGlhbCBvd25lcnMuCiAgICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIE11bHRpU2lnV2FsbGV0KGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxfb3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc093bmVyW19vd25lcnNbaV1dIHx8IF9vd25lcnNbaV0gPT0gMCkKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICBpc093bmVyW19vd25lcnNbaV1dID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgb3duZXJzID0gX293bmVyczsKICAgICAgICByZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gYWRkIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBvd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgb3duZXJEb2VzTm90RXhpc3Qob3duZXIpCiAgICAgICAgbm90TnVsbChvd25lcikKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggKyAxLCByZXF1aXJlZCkKICAgIHsKICAgICAgICBpc093bmVyW293bmVyXSA9IHRydWU7CiAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24ob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byByZW1vdmUgYW4gb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoIC0gMTsgaSsrKQogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBvd25lcnNbb3duZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBvd25lcnMubGVuZ3RoIC09IDE7CiAgICAgICAgaWYgKHJlcXVpcmVkID4gb3duZXJzLmxlbmd0aCkKICAgICAgICAgICAgY2hhbmdlUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCk7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVwbGFjZSBhbiBvd25lciB3aXRoIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIgdG8gYmUgcmVwbGFjZWQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gcmVwbGFjZU93bmVyKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KG5ld093bmVyKQogICAgewogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBuZXdPd25lcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgaXNPd25lcltvd25lcl0gPSBmYWxzZTsKICAgICAgICBpc093bmVyW25ld093bmVyXSA9IHRydWU7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgICAgICBPd25lckFkZGl0aW9uKG5ld093bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gY2hhbmdlIHRoZSBudW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgdmFsaWRSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2UoX3JlcXVpcmVkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gc3VibWl0IGFuZCBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IGFkZFRyYW5zYWN0aW9uKGRlc3RpbmF0aW9uLCB2YWx1ZSwgZGF0YSk7CiAgICAgICAgY29uZmlybVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICAgICAgdHJhbnNhY3Rpb25FeGlzdHModHJhbnNhY3Rpb25JZCkKICAgICAgICBub3RDb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICAgICAgZXhlY3V0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byByZXZva2UgYSBjb25maXJtYXRpb24gZm9yIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiByZXZva2VDb25maXJtYXRpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICAgICAgY29uZmlybWVkKHRyYW5zYWN0aW9uSWQsIG1zZy5zZW5kZXIpCiAgICAgICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gZmFsc2U7CiAgICAgICAgUmV2b2NhdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW55b25lIHRvIGV4ZWN1dGUgYSBjb25maXJtZWQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBleGVjdXRlVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgaWYgKGlzQ29uZmlybWVkKHRyYW5zYWN0aW9uSWQpKSB7CiAgICAgICAgICAgIFRyYW5zYWN0aW9uIHR4ID0gdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdOwogICAgICAgICAgICB0eC5leGVjdXRlZCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0eC5kZXN0aW5hdGlvbi5jYWxsLnZhbHVlKHR4LnZhbHVlKSh0eC5kYXRhKSkKICAgICAgICAgICAgICAgIEV4ZWN1dGlvbih0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBFeGVjdXRpb25GYWlsdXJlKHRyYW5zYWN0aW9uSWQpOwogICAgICAgICAgICAgICAgdHguZXhlY3V0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjb25maXJtYXRpb24gc3RhdHVzIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBDb25maXJtYXRpb24gc3RhdHVzLgogICAgZnVuY3Rpb24gaXNDb25maXJtZWQodWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB1aW50IGNvdW50ID0gMDsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgaWYgKGNvdW50ID09IHJlcXVpcmVkKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQWRkcyBhIG5ldyB0cmFuc2FjdGlvbiB0byB0aGUgdHJhbnNhY3Rpb24gbWFwcGluZywgaWYgdHJhbnNhY3Rpb24gZG9lcyBub3QgZXhpc3QgeWV0LgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGFkZFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBub3ROdWxsKGRlc3RpbmF0aW9uKQogICAgICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICB0cmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25Db3VudDsKICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0gPSBUcmFuc2FjdGlvbih7CiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICBleGVjdXRlZDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICB0cmFuc2FjdGlvbkNvdW50ICs9IDE7CiAgICAgICAgU3VibWlzc2lvbih0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvKgogICAgICogV2ViMyBjYWxsIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBjb25maXJtYXRpb25zIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBOdW1iZXIgb2YgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbkNvdW50KHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgY291bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWxlcnMgYXJlIGFwcGxpZWQuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBUb3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbHRlcnMgYXJlIGFwcGxpZWQuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkNvdW50KGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgY291bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTx0cmFuc2FjdGlvbkNvdW50OyBpKyspCiAgICAgICAgICAgIGlmICggICBwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQKICAgICAgICAgICAgICAgIHx8IGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIG93bmVycy4KICAgIC8vLyBAcmV0dXJuIExpc3Qgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gb3duZXJzOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXJyYXkgd2l0aCBvd25lciBhZGRyZXNzZXMsIHdoaWNoIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9ucyh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10gX2NvbmZpcm1hdGlvbnMpCiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBjb25maXJtYXRpb25zVGVtcCA9IG5ldyBhZGRyZXNzW10ob3duZXJzLmxlbmd0aCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkgewogICAgICAgICAgICAgICAgY29uZmlybWF0aW9uc1RlbXBbY291bnRdID0gb3duZXJzW2ldOwogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIF9jb25maXJtYXRpb25zID0gbmV3IGFkZHJlc3NbXShjb3VudCk7CiAgICAgICAgZm9yIChpPTA7IGk8Y291bnQ7IGkrKykKICAgICAgICAgICAgX2NvbmZpcm1hdGlvbnNbaV0gPSBjb25maXJtYXRpb25zVGVtcFtpXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2YgdHJhbnNhY3Rpb24gSURzIGluIGRlZmluZWQgcmFuZ2UuCiAgICAvLy8gQHBhcmFtIGZyb20gSW5kZXggc3RhcnQgcG9zaXRpb24gb2YgdHJhbnNhY3Rpb24gYXJyYXkuCiAgICAvLy8gQHBhcmFtIHRvIEluZGV4IGVuZCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4KICAgIC8vLyBAcGFyYW0gcGVuZGluZyBJbmNsdWRlIHBlbmRpbmcgdHJhbnNhY3Rpb25zLgogICAgLy8vIEBwYXJhbSBleGVjdXRlZCBJbmNsdWRlIGV4ZWN1dGVkIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2YgdHJhbnNhY3Rpb24gSURzLgogICAgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25JZHModWludCBmcm9tLCB1aW50IHRvLCBib29sIHBlbmRpbmcsIGJvb2wgZXhlY3V0ZWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50W10gX3RyYW5zYWN0aW9uSWRzKQogICAgewogICAgICAgIHVpbnRbXSBtZW1vcnkgdHJhbnNhY3Rpb25JZHNUZW1wID0gbmV3IHVpbnRbXSh0cmFuc2FjdGlvbkNvdW50KTsKICAgICAgICB1aW50IGNvdW50ID0gMDsKICAgICAgICB1aW50IGk7CiAgICAgICAgZm9yIChpPTA7IGk8dHJhbnNhY3Rpb25Db3VudDsgaSsrKQogICAgICAgICAgICBpZiAoICAgcGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkCiAgICAgICAgICAgICAgICB8fCBleGVjdXRlZCAmJiB0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSWRzVGVtcFtjb3VudF0gPSBpOwogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIF90cmFuc2FjdGlvbklkcyA9IG5ldyB1aW50W10odG8gLSBmcm9tKTsKICAgICAgICBmb3IgKGk9ZnJvbTsgaTx0bzsgaSsrKQogICAgICAgICAgICBfdHJhbnNhY3Rpb25JZHNbaSAtIGZyb21dID0gdHJhbnNhY3Rpb25JZHNUZW1wW2ldOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDcmVhdGUgbmV3IGNvaW4uCiAgICBmdW5jdGlvbiBjcmVhdGVDb2luKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlXYWxsZXQKICAgIHsKICAgICAgICByZXF1aXJlKGZsYWcgPT0gdHJ1ZSk7CiAgICAgICAgQ29pbkNyZWF0aW9uKG5ldyBHVE8oKSk7CiAgICAgICAgZmxhZyA9IGZhbHNlOwogICAgfQp9'.
	

]
