Class {
	#name : #SRT567b27ae0d0ea4fca292f447d819aa1b366375c4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT567b27ae0d0ea4fca292f447d819aa1b366375c4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKCi8qKioqKgoqIEB0aXRsZSBUaGUgREFESSBNYXhDYXAgQ29udHJhY3QKKi8KY29udHJhY3QgRGFkaU1heENhcFNhbGUgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBTdGFuZGFyZFRva2VuIHB1YmxpYyB0b2tlbjsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIERBREkgRVJDMjAgdG9rZW4gKi8KICAgIGFkZHJlc3NbXSBwdWJsaWMgc2FsZVdhbGxldHM7CgogICAgc3RydWN0IFdoaXRlbGlzdFVzZXIgewogICAgICB1aW50IGluZGV4OwogICAgfQoKICAgIHN0cnVjdCBJbnZlc3RvciB7CiAgICAgIHVpbnQyNTYgdG9rZW5zOwogICAgICB1aW50MjU2IGNvbnRyaWJ1dGlvbjsKICAgICAgYm9vbCBkaXN0cmlidXRlZDsKICAgICAgdWludCBpbmRleDsKICAgIH0KCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlblN1cHBseTsKICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1B1cmNoYXNlZCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyBpbmRpdmlkdWFsQ2FwID0gNTAwMCAqIDEwMDA7ICAgICAgICAgLy8gVVNEJDUsMDAwCiAgICB1aW50MjU2IHB1YmxpYyBzYWxlVG9rZW5QcmljZSA9IDUwMDsgICAgICAgICAgICAgICAgLy8gVVNEJDAuNTAKICAgIHVpbnQyNTYgcHVibGljIGV0aFJhdGUgPSAxMTcyNTYwOyAgICAgICAgICAgICAgICAgICAvLyBPcmlnaW5hbCBFVEggcmF0ZS4gMSBFVEggPSAxMTcyLjU2IFVTRAogCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gV2hpdGVsaXN0VXNlcikgcHJpdmF0ZSB3aGl0ZWxpc3RlZDsKICAgIGFkZHJlc3NbXSBwcml2YXRlIHdoaXRlbGlzdGVkSW5kZXg7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gSW52ZXN0b3IpIHByaXZhdGUgaW52ZXN0b3JzOwogICAgYWRkcmVzc1tdIHByaXZhdGUgaW52ZXN0b3JJbmRleDsKCiAgICAvKioqKioKICAgICogU3RhdGUgZm9yIFNhbGUgTW9kZXMKICAgICogIDAgLSBQcmVwYXJpbmc6ICAgICAgICAgICAgQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzCiAgICAqICAxIC0gU2FsZTogICAgICAgICAgICAgICAgIENvbnRyYWN0IGlzIGluIHRoZSBzYWxlIHBlcmlvZAogICAgKiAgMiAtIFNhbGVGaW5hbGl6ZWQgICAgICAgICBTYWxlIHBlcmlvZCBpcyBmaW5hbGl6ZWQsIG5vIG1vcmUgcGF5bWVudHMgYXJlIGFsbG93ZWQKICAgICogIDMgLSBTdWNjZXNzOiAgICAgICAgICAgICAgU2FsZSBTdWNjZXNzZnVsCiAgICAqICA0IC0gVG9rZW5EaXN0cmlidXRpb246ICAgIFNhbGUgZmluaXNoZWQsIHRva2VucyBjYW4gYmUgZGlzdHJpYnV0ZWQKICAgICogIDUgLSBDbG9zZWQ6ICAgICAgICAgICAgICAgU2FsZSBjbG9zZWQsIG5vIHRva2VucyBtb3JlIGNhbiBiZSBkaXN0cmlidXRlZAogICAgKi8KICAgIGVudW0gU2FsZVN0YXRlIHsgUHJlcGFyaW5nLCBTYWxlLCBTYWxlRmluYWxpemVkLCBTdWNjZXNzLCBUb2tlbkRpc3RyaWJ1dGlvbiwgQ2xvc2VkIH0KICAgIFNhbGVTdGF0ZSBwdWJsaWMgc3RhdGUgPSBTYWxlU3RhdGUuUHJlcGFyaW5nOwoKICAgIGV2ZW50IExvZ1Rva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHRva2Vucyk7CiAgICBldmVudCBMb2dUb2tlbkRpc3RyaWJ1dGlvbihhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiB0b2tlbnMpOwogICAgZXZlbnQgTG9nUmVkaXN0cmlidXRlVG9rZW5zKGFkZHJlc3MgcmVjaXBpZW50LCBTYWxlU3RhdGUgX3N0YXRlLCB1aW50MjU2IHRva2Vucyk7CiAgICBldmVudCBMb2dGdW5kVHJhbnNmZXIoYWRkcmVzcyB3YWxsZXQsIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgTG9nUmVmdW5kKGFkZHJlc3Mgd2FsbGV0LCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IExvZ1N0YXRlQ2hhbmdlKFNhbGVTdGF0ZSBfc3RhdGUpOwogICAgZXZlbnQgTG9nTmV3V2hpdGVsaXN0VXNlcihhZGRyZXNzIGluZGV4ZWQgdXNlckFkZHJlc3MsIHVpbnQgaW5kZXgpOwoKICAgIC8qKioqKgogICAgKiBAZGV2IE1vZGlmaWVyIHRvIGNoZWNrIHRoYXQgYW1vdW50IHRyYW5zZmVycmVkIGlzIG5vdCAwCiAgICAqLwogICAgbW9kaWZpZXIgbm9uWmVybygpIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiB0byBpbml0aWFsaXplIHRoZSBQcmVzYWxlCiAgICAqIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyAgIHRoZSBhZGRyZXNzIG9mIHRoZSBFUkMyMCB0b2tlbiBmb3IgdGhlIHNhbGUKICAgICogQHBhcmFtIF90b2tlblN1cHBseSAgICAgICAgICAgICAgICAgICB1aW50MjU2ICAgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXZhaWxhYmxlCiAgICAqLwogICAgZnVuY3Rpb24gRGFkaU1heENhcFNhbGUgKFN0YW5kYXJkVG9rZW4gX3Rva2VuLHVpbnQyNTYgX3Rva2VuU3VwcGx5KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3Rva2VuU3VwcGx5ICE9IDApOwoKICAgICAgICB0b2tlbiA9IFN0YW5kYXJkVG9rZW4oX3Rva2VuKTsKICAgICAgICB0b2tlblN1cHBseSA9IF90b2tlblN1cHBseSAqICh1aW50MjU2KDEwKSAqKiAxOCk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgRmFsbGJhY2sgRnVuY3Rpb24gdG8gYnV5IHRoZSB0b2tlbnMKICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgbm9uWmVybyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5TYWxlKTsKICAgICAgICBidXlUb2tlbnMobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBBbGxvd3MgdGhlIGNvbnRyYWN0IG93bmVyIHRvIGFkZCBhIG5ldyBTYWxlIHdhbGxldCwgdXNlZCB0byBob2xkIGZ1bmRzIHNhZmVseQogICAgKiBAcGFyYW0gX3dhbGxldCAgICAgICAgYWRkcmVzcyAgICAgVGhlIGFkZHJlc3Mgb2YgdGhlIHdhbGxldAogICAgKiBAcmV0dXJuIHN1Y2Nlc3MgICAgICAgYm9vbCAgICAgICAgUmV0dXJucyB0cnVlIGlmIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGFkZFNhbGVXYWxsZXQgKGFkZHJlc3MgX3dhbGxldCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHNhbGVXYWxsZXRzLnB1c2goX3dhbGxldCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQWxsb3dzIHRoZSBjb250cmFjdCBvd25lciB0byBhZGQgbXVsdGlwbGUgd2hpdGVsaXN0IHVzZXJzLCBlYWNoIHdpdGggYSB3YWxsZXQgYWRkcmVzcwogICAgKiBAcGFyYW0gdXNlckFkZHJlc3NlcyAgIGFkZHJlc3NbXSAgICAgVGhlIGFycmF5IG9mIHdoaXRlbGlzdCB3YWxsZXQgYWRkcmVzc2VzCiAgICAqLwogICAgZnVuY3Rpb24gYWRkV2hpdGVsaXN0VXNlcnMoYWRkcmVzc1tdIHVzZXJBZGRyZXNzZXMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHVzZXJBZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYWRkV2hpdGVsaXN0VXNlcih1c2VyQWRkcmVzc2VzW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQWxsb3dzIHRoZSBjb250cmFjdCBvd25lciB0byBhIHNpbmdsZSB3aGl0ZWxpc3QgdXNlcgogICAgKiBAcGFyYW0gdXNlckFkZHJlc3MgICAgIGFkZHJlc3MgICAgICBUaGUgd2FsbGV0IGFkZHJlc3MgdG8gd2hpdGVsaXN0CiAgICAqLwogICAgZnVuY3Rpb24gYWRkV2hpdGVsaXN0VXNlcihhZGRyZXNzIHVzZXJBZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBpZiAoIWlzV2hpdGVsaXN0ZWQodXNlckFkZHJlc3MpKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdGVkW3VzZXJBZGRyZXNzXS5pbmRleCA9IHdoaXRlbGlzdGVkSW5kZXgucHVzaCh1c2VyQWRkcmVzcykgLSAxOwogICAgICAgICAgCiAgICAgICAgICAgIExvZ05ld1doaXRlbGlzdFVzZXIodXNlckFkZHJlc3MsIHdoaXRlbGlzdGVkW3VzZXJBZGRyZXNzXS5pbmRleCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENhbGN1bGF0ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCBjYW4gYmUgYm91Z2h0IGZvciB0aGUgYW1vdW50IG9mIFdlaSB0cmFuc2ZlcnJlZAogICAgKiBAcGFyYW0gX2Ftb3VudCAgICB1aW50MjU2ICAgICBUaGUgYW1vdW50IG9mIG1vbmV5IGludmVzdGVkIGJ5IHRoZSBpbnZlc3RvcgogICAgKiBAcmV0dXJuIHRva2VucyAgICB1aW50MjU2ICAgICBUaGUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZWQgZm9yIHRoZSBhbW91bnQgaW52ZXN0ZWQKICAgICovCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbnMgKHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG9rZW5zKSB7CiAgICAgICAgdG9rZW5zID0gX2Ftb3VudCAqIGV0aFJhdGUgLyBzYWxlVG9rZW5QcmljZTsKICAgICAgICByZXR1cm4gdG9rZW5zOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENhbGxlZCBieSB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IHRvIG1vZGlmeSB0aGUgc2FsZSBzdGF0ZQogICAgKi8KICAgIGZ1bmN0aW9uIHNldFN0YXRlICh1aW50MjU2IF9zdGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RhdGUgPSBTYWxlU3RhdGUodWludChfc3RhdGUpKTsKICAgICAgICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gc3RhcnQgdGhlIHNhbGUKICAgICovCiAgICBmdW5jdGlvbiBzdGFydFNhbGUgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RhdGUgPSBTYWxlU3RhdGUuU2FsZTsKICAgICAgICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gZmluYWxpemUgdGhlIElDTwogICAgKiAgICAgIGFuZCByZWRpc3RyaWJ1dGUgZnVuZHMgKGlmIGFueSkKICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6ZVNhbGUgKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RhdGUgPSBTYWxlU3RhdGUuU3VjY2VzczsKICAgICAgICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CgogICAgICAgIC8vIFRyYW5zZmVyIGFueSBFVEggdG8gb25lIG9mIHRoZSBQcmVzYWxlIHdhbGxldHMKICAgICAgICBpZiAodGhpcy5iYWxhbmNlID4gMCkgewogICAgICAgICAgICBmb3J3YXJkRnVuZHModGhpcy5iYWxhbmNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gY2xvc2UgdGhlIFNhbGUgYW5kIHJlZGlzdHJpYnV0ZSBhbnkgY3J1bWJzLgogICAgKiBAcGFyYW0gcmVjaXBpZW50ICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50IG9mIHRoZSB0b2tlbnMKICAgICovCiAgICBmdW5jdGlvbiBjbG9zZVNhbGUgKGFkZHJlc3MgcmVjaXBpZW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzdGF0ZSA9IFNhbGVTdGF0ZS5DbG9zZWQ7CiAgICAgICAgTG9nU3RhdGVDaGFuZ2Uoc3RhdGUpOwoKICAgICAgICAvLyByZWRpc3RyaWJ1dGUgdW5zb2xkIHRva2VucyB0byBEQURJIGVjb3N5c3RlbQogICAgICAgIHVpbnQyNTYgcmVtYWluaW5nID0gZ2V0VG9rZW5zQXZhaWxhYmxlKCk7CiAgICAgICAgdXBkYXRlU2FsZVBhcmFtZXRlcnMocmVtYWluaW5nKTsKCiAgICAgICAgaWYgKHJlbWFpbmluZyA+IDApIHsKICAgICAgICAgICAgdG9rZW4udHJhbnNmZXIocmVjaXBpZW50LCByZW1haW5pbmcpOwogICAgICAgICAgICBMb2dSZWRpc3RyaWJ1dGVUb2tlbnMocmVjaXBpZW50LCBzdGF0ZSwgcmVtYWluaW5nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gYWxsb3cgdG9rZW5zIHRvIGJlIGRpc3RyaWJ1dGVkCiAgICAqLwogICAgZnVuY3Rpb24gc2V0VG9rZW5EaXN0cmlidXRpb24gKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RhdGUgPSBTYWxlU3RhdGUuVG9rZW5EaXN0cmlidXRpb247CiAgICAgICAgTG9nU3RhdGVDaGFuZ2Uoc3RhdGUpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENhbGxlZCBieSB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IHRvIGRpc3RyaWJ1dGUgdG9rZW5zIHRvIGludmVzdG9ycwogICAgKiBAcGFyYW0gX2FkZHJlc3MgICAgICAgYWRkcmVzcyAgICAgVGhlIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yIGZvciB3aGljaCB0byBkaXN0cmlidXRlIHRva2VucwogICAgKiBAcmV0dXJuIHN1Y2Nlc3MgICAgICAgYm9vbCAgICAgICAgUmV0dXJucyB0cnVlIGlmIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVUb2tlbnMgKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLlRva2VuRGlzdHJpYnV0aW9uKTsKICAgICAgICAKICAgICAgICAvLyBnZXQgdGhlIHRva2VucyBhdmFpbGFibGUgZm9yIHRoZSBpbnZlc3RvcgogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gaW52ZXN0b3JzW19hZGRyZXNzXS50b2tlbnM7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKCiAgICAgICAgcmVxdWlyZShpbnZlc3RvcnNbX2FkZHJlc3NdLmRpc3RyaWJ1dGVkID09IGZhbHNlKTsKCiAgICAgICAgaW52ZXN0b3JzW19hZGRyZXNzXS5kaXN0cmlidXRlZCA9IHRydWU7CgogICAgICAgIHRva2VuLnRyYW5zZmVyKF9hZGRyZXNzLCB0b2tlbnMpOwogICAgICAKICAgICAgICBMb2dUb2tlbkRpc3RyaWJ1dGlvbihfYWRkcmVzcywgdG9rZW5zKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCB0byBkaXN0cmlidXRlIHRva2VucyB0byBpbnZlc3RvcnMgd2hvIHVzZWQgYSBub24tRVJDMjAgd2FsbGV0IGFkZHJlc3MKICAgICogQHBhcmFtIF9wdXJjaGFzZUFkZHJlc3MgICAgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIHRoZSBpbnZlc3RvciB1c2VkIHRvIGJ1eSB0b2tlbnMKICAgICogQHBhcmFtIF90b2tlbkFkZHJlc3MgICAgICAgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIHRvIHNlbmQgdGhlIHRva2VucyB0bwogICAgKiBAcmV0dXJuIHN1Y2Nlc3MgICAgICAgICAgICAgICAgYm9vbCAgICAgICAgUmV0dXJucyB0cnVlIGlmIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVUb0FsdGVybmF0ZUFkZHJlc3MgKGFkZHJlc3MgX3B1cmNoYXNlQWRkcmVzcywgYWRkcmVzcyBfdG9rZW5BZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5Ub2tlbkRpc3RyaWJ1dGlvbik7CiAgICAgICAgCiAgICAgICAgLy8gZ2V0IHRoZSB0b2tlbnMgYXZhaWxhYmxlIGZvciB0aGUgaW52ZXN0b3IKICAgICAgICB1aW50MjU2IHRva2VucyA9IGludmVzdG9yc1tfcHVyY2hhc2VBZGRyZXNzXS50b2tlbnM7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKCiAgICAgICAgcmVxdWlyZShpbnZlc3RvcnNbX3B1cmNoYXNlQWRkcmVzc10uZGlzdHJpYnV0ZWQgPT0gZmFsc2UpOwogICAgICAgIGludmVzdG9yc1tfcHVyY2hhc2VBZGRyZXNzXS5kaXN0cmlidXRlZCA9IHRydWU7CgogICAgICAgIHRva2VuLnRyYW5zZmVyKF90b2tlbkFkZHJlc3MsIHRva2Vucyk7CiAgICAgIAogICAgICAgIExvZ1Rva2VuRGlzdHJpYnV0aW9uKF90b2tlbkFkZHJlc3MsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gcmVkaXN0cmlidXRlIHRva2VucyBpZiBhbiBpbnZlc3RvciBoYXMgYmVlbiByZWZ1bmRlZCBvZmZsaW5lCiAgICAqIEBwYXJhbSBpbnZlc3RvckFkZHJlc3MgICAgICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyB0aGUgaW52ZXN0b3IgdXNlZCB0byBidXkgdG9rZW5zCiAgICAqIEBwYXJhbSByZWNpcGllbnQgICAgICAgICAgICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyB0byBzZW5kIHRoZSB0b2tlbnMgdG8KICAgICovCiAgICBmdW5jdGlvbiByZWRpc3RyaWJ1dGVUb2tlbnMgKGFkZHJlc3MgaW52ZXN0b3JBZGRyZXNzLCBhZGRyZXNzIHJlY2lwaWVudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBpbnZlc3RvcnNbaW52ZXN0b3JBZGRyZXNzXS50b2tlbnM7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKICAgICAgICAKICAgICAgICAvLyByZW1vdmUgdG9rZW5zLCBzbyB0aGV5IGNhbid0IGJlIHJlZGlzdHJpYnV0ZWQKICAgICAgICByZXF1aXJlKGludmVzdG9yc1tpbnZlc3RvckFkZHJlc3NdLmRpc3RyaWJ1dGVkID09IGZhbHNlKTsKCiAgICAgICAgaW52ZXN0b3JzW2ludmVzdG9yQWRkcmVzc10uZGlzdHJpYnV0ZWQgPSB0cnVlOwoKICAgICAgICB0b2tlbi50cmFuc2ZlcihyZWNpcGllbnQsIHRva2Vucyk7CgogICAgICAgIExvZ1JlZGlzdHJpYnV0ZVRva2VucyhyZWNpcGllbnQsIHN0YXRlLCB0b2tlbnMpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCB0aGUgYW1vdW50IG9mIFByZVNhbGUgdG9rZW5zIGxlZnQgZm9yIHB1cmNoYXNlCiAgICAqIEByZXR1cm4gdWludDI1NiB0aGUgY291bnQgb2YgdG9rZW5zIGF2YWlsYWJsZQogICAgKi8KICAgIGZ1bmN0aW9uIGdldFRva2Vuc0F2YWlsYWJsZSAoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b2tlblN1cHBseSAtIHRva2Vuc1B1cmNoYXNlZDsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBHZXQgdGhlIHRvdGFsIGNvdW50IG9mIHRva2VucyBwdXJjaGFzZWQgaW4gYWxsIHRoZSBTYWxlIHBlcmlvZHMKICAgICogQHJldHVybiB1aW50MjU2IHRoZSBjb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW5zUHVyY2hhc2VkICgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc1B1cmNoYXNlZDsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDb252ZXJ0cyBhbiBhbW91bnQgc2VudCBpbiBXZWkgdG8gdGhlIGVxdWl2YWxlbnQgaW4gVVNECiAgICAqIEBwYXJhbSBfYW1vdW50ICAgICAgdWludDI1NiAgICAgICB0aGUgYW1vdW50IHNlbnQgdG8gdGhlIGNvbnRyYWN0LCBpbiBXZWkKICAgICogQHJldHVybiB1aW50MjU2ICB0aGUgYW1vdW50IHNlbnQgdG8gdGhpcyBjb250cmFjdCwgaW4gVVNECiAgICAqLwogICAgZnVuY3Rpb24gZXRoVG9Vc2QgKHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKF9hbW91bnQgKiBldGhSYXRlKSAvICh1aW50MjU2KDEwKSAqKiAxOCk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgR2V0IHRoZSBvdmVyYWxsIHN1Y2Nlc3Mgc3RhdGUgb2YgdGhlIElDTwogICAgKiBAcmV0dXJuIGJvb2wgd2hldGhlciB0aGUgc3RhdGUgaXMgc3VjY2Vzc2Z1bCwgb3Igbm90CiAgICAqLwogICAgZnVuY3Rpb24gaXNTdWNjZXNzZnVsICgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlID09IFNhbGVTdGF0ZS5TdWNjZXNzOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCBhIHdoaXRlbGlzdGVkIHVzZXIKICAgICogQHBhcmFtIHVzZXJBZGRyZXNzICAgICAgYWRkcmVzcyAgICAgICB0aGUgd2FsbGV0IGFkZHJlc3Mgb2YgdGhlIHVzZXIKICAgICogQHJldHVybiB1aW50ICAgICB0aGUgaW5kZXggb2YgdGhlIHVzZXIKICAgICovCiAgICBmdW5jdGlvbiBnZXRXaGl0ZWxpc3RVc2VyIChhZGRyZXNzIHVzZXJBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBpbmRleCkgewogICAgICAgIHJlcXVpcmUoaXNXaGl0ZWxpc3RlZCh1c2VyQWRkcmVzcykpOwogICAgICAgIHJldHVybiB3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10uaW5kZXg7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgR2V0IGNvdW50IG9mIGNvbnRyaWJ1dG9ycwogICAgKiBAcmV0dXJuIHVpbnQgICAgIHRoZSBudW1iZXIgb2YgdW5pcXVlIGNvbnRyaWJ1dG9ycwogICAgKi8KICAgIGZ1bmN0aW9uIGdldEludmVzdG9yQ291bnQgKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgY291bnQpIHsKICAgICAgICByZXR1cm4gaW52ZXN0b3JJbmRleC5sZW5ndGg7CiAgICB9CgoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCBhbiBpbnZlc3RvcgogICAgKiBAcGFyYW0gX2FkZHJlc3MgICAgICBhZGRyZXNzICAgICAgIHRoZSB3YWxsZXQgYWRkcmVzcyBvZiB0aGUgaW52ZXN0b3IKICAgICogQHJldHVybiB1aW50MjU2ICB0aGUgYW1vdW50IGNvbnRyaWJ1dGVkIGJ5IHRoZSB1c2VyCiAgICAqIEByZXR1cm4gdWludDI1NiAgdGhlIG51bWJlciBvZiB0b2tlbnMgYXNzaWduZWQgdG8gdGhlIHVzZXIKICAgICogQHJldHVybiBib29sICAgICB3aGV0aGVyIHRoZSB0b2tlbnMgaGF2ZSBhbHJlYWR5IGJlZW4gZGlzdHJpYnV0ZWQKICAgICogQHJldHVybiB1aW50ICAgICB0aGUgaW5kZXggb2YgdGhlIHVzZXIKICAgICovCiAgICBmdW5jdGlvbiBnZXRJbnZlc3RvciAoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgY29udHJpYnV0aW9uLCB1aW50MjU2IHRva2VucywgYm9vbCBkaXN0cmlidXRlZCwgdWludCBpbmRleCkgewogICAgICAgIHJlcXVpcmUoaXNJbnZlc3RlZChfYWRkcmVzcykpOwogICAgICAgIHJldHVybihpbnZlc3RvcnNbX2FkZHJlc3NdLmNvbnRyaWJ1dGlvbiwgaW52ZXN0b3JzW19hZGRyZXNzXS50b2tlbnMsIGludmVzdG9yc1tfYWRkcmVzc10uZGlzdHJpYnV0ZWQsIGludmVzdG9yc1tfYWRkcmVzc10uaW5kZXgpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCBhIHVzZXIncyB3aGl0ZWxpc3RlZCBzdGF0ZQogICAgKiBAcGFyYW0gdXNlckFkZHJlc3MgICAgICBhZGRyZXNzICAgICAgIHRoZSB3YWxsZXQgYWRkcmVzcyBvZiB0aGUgdXNlcgogICAgKiBAcmV0dXJuIGJvb2wgIHRydWUgaWYgdGhlIHVzZXIgaXMgaW4gdGhlIHdoaXRlbGlzdAogICAgKi8KICAgIGZ1bmN0aW9uIGlzV2hpdGVsaXN0ZWQgKGFkZHJlc3MgdXNlckFkZHJlc3MpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgaXNJbmRlZWQpIHsKICAgICAgICBpZiAod2hpdGVsaXN0ZWRJbmRleC5sZW5ndGggPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiAod2hpdGVsaXN0ZWRJbmRleFt3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10uaW5kZXhdID09IHVzZXJBZGRyZXNzKTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBHZXQgYSB1c2VyJ3MgaW52ZXN0ZWQgc3RhdGUKICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgYWRkcmVzcyAgICAgICB0aGUgd2FsbGV0IGFkZHJlc3Mgb2YgdGhlIHVzZXIKICAgICogQHJldHVybiBib29sICB0cnVlIGlmIHRoZSB1c2VyIGhhcyBhbHJlYWR5IGNvbnRyaWJ1dGVkCiAgICAqLwogICAgZnVuY3Rpb24gaXNJbnZlc3RlZCAoYWRkcmVzcyBfYWRkcmVzcykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBpc0luZGVlZCkgewogICAgICAgIGlmIChpbnZlc3RvckluZGV4Lmxlbmd0aCA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIChpbnZlc3RvckluZGV4W2ludmVzdG9yc1tfYWRkcmVzc10uaW5kZXhdID09IF9hZGRyZXNzKTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBVcGRhdGUgYSB1c2VyJ3MgaW52ZXN0ZWQgc3RhdGUKICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgYWRkcmVzcyAgICAgICB0aGUgd2FsbGV0IGFkZHJlc3Mgb2YgdGhlIHVzZXIKICAgICogQHBhcmFtIF92YWx1ZSAgICAgICAgdWludDI1NiAgICAgICB0aGUgYW1vdW50IGNvbnRyaWJ1dGVkIGluIHRoaXMgdHJhbnNhY3Rpb24KICAgICogQHBhcmFtIF90b2tlbnMgICAgICAgdWludDI1NiAgICAgICB0aGUgbnVtYmVyIG9mIHRva2VucyBhc3NpZ25lZCBpbiB0aGlzIHRyYW5zYWN0aW9uCiAgICAqLwogICAgZnVuY3Rpb24gYWRkVG9JbnZlc3RvcihhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfdG9rZW5zKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gYWRkIHRoZSB1c2VyIHRvIHRoZSBpbnZlc3RvckluZGV4IGlmIHRoaXMgaXMgdGhlaXIgZmlyc3QgY29udHJpYnV0aW9uCiAgICAgICAgaWYgKCFpc0ludmVzdGVkKF9hZGRyZXNzKSkgewogICAgICAgICAgICBpbnZlc3RvcnNbX2FkZHJlc3NdLmluZGV4ID0gaW52ZXN0b3JJbmRleC5wdXNoKF9hZGRyZXNzKSAtIDE7CiAgICAgICAgfQogICAgICAKICAgICAgICBpbnZlc3RvcnNbX2FkZHJlc3NdLnRva2VucyA9IGludmVzdG9yc1tfYWRkcmVzc10udG9rZW5zLmFkZChfdG9rZW5zKTsKICAgICAgICBpbnZlc3RvcnNbX2FkZHJlc3NdLmNvbnRyaWJ1dGlvbiA9IGludmVzdG9yc1tfYWRkcmVzc10uY29udHJpYnV0aW9uLmFkZChfdmFsdWUpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IFNlbmQgZXRoZXIgdG8gdGhlIHByZXNhbGUgY29sbGVjdGlvbiB3YWxsZXRzCiAgICAqLwogICAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzICh1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgYWNjb3VudE51bWJlcjsKICAgICAgICBhZGRyZXNzIGFjY291bnQ7CgogICAgICAgIC8vIG1vdmUgZnVuZHMgdG8gYSByYW5kb20gcHJlU2FsZVdhbGxldAogICAgICAgIGlmIChzYWxlV2FsbGV0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGFjY291bnROdW1iZXIgPSBnZXRSYW5kb20oc2FsZVdhbGxldHMubGVuZ3RoKSAtIDE7CiAgICAgICAgICAgIGFjY291bnQgPSBzYWxlV2FsbGV0c1thY2NvdW50TnVtYmVyXTsKICAgICAgICAgICAgYWNjb3VudC50cmFuc2ZlcihfdmFsdWUpOwogICAgICAgICAgICBMb2dGdW5kVHJhbnNmZXIoYWNjb3VudCwgX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYXNzaWduIHRva2VucyB0byB0aGUgY29udHJpYnV0b3IKICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmlidXRpbmcgaW52ZXN0b3IKICAgICogQHBhcmFtIF92YWx1ZSAgICAgICAgIHVpbnQyNTYgICAgIFRoZSBhbW91bnQgaW52ZXN0ZWQgCiAgICAqIEByZXR1cm4gc3VjY2VzcyAgICAgICBib29sICAgICAgICBSZXR1cm5zIHRydWUgaWYgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gYnV5VG9rZW5zIChhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoaXNWYWxpZENvbnRyaWJ1dGlvbihfYWRkcmVzcywgX3ZhbHVlKSk7CgogICAgICAgIHVpbnQyNTYgYm91Z2h0VG9rZW5zID0gY2FsY3VsYXRlVG9rZW5zKF92YWx1ZSk7CiAgICAgICAgcmVxdWlyZShib3VnaHRUb2tlbnMgIT0gMCk7CgogICAgICAgIC8vIGlmIHRoZSBudW1iZXIgb2YgdG9rZW5zIGNhbGN1bGF0ZWQgZm9yIHRoZSBnaXZlbiB2YWx1ZSBpcyAKICAgICAgICAvLyBncmVhdGVyIHRoYW4gdGhlIHRva2VucyBhdmFpbGFibGUsIHJlamVjdCB0aGUgcGF5bWVudAogICAgICAgIGlmIChib3VnaHRUb2tlbnMgPj0gZ2V0VG9rZW5zQXZhaWxhYmxlKCkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyB1cGRhdGUgaW52ZXN0b3Igc3RhdGUKICAgICAgICBhZGRUb0ludmVzdG9yKF9hZGRyZXNzLCBfdmFsdWUsIGJvdWdodFRva2Vucyk7CgogICAgICAgIExvZ1Rva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgX2FkZHJlc3MsIF92YWx1ZSwgYm91Z2h0VG9rZW5zKTsKCiAgICAgICAgZm9yd2FyZEZ1bmRzKF92YWx1ZSk7CgogICAgICAgIHVwZGF0ZVNhbGVQYXJhbWV0ZXJzKGJvdWdodFRva2Vucyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENoZWNrIHRoYXQgdGhlIHVzZXIgaXMgd2hpdGVsaXN0ZWQgYW5kIHRoZSBhbW91bnQgc2VudCBpbiB0aGUgdHJhbnNhY3Rpb24gaXMgYmVsb3cgb3IgZXF1YWwgdG8gdGhlIGluZGl2aWR1YWwgY2FwLgogICAgKiBGYWN0b3JzIGluIHByZXZpb3VzIHRyYW5zYWN0aW9uIGJ5IHRoZSBzYW1lIHVzZXIKICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgICAgYWRkcmVzcyAgICAgVGhlIGFkZHJlc3Mgb2YgdGhlIHVzZXIgbWFraW5nIHRoZSB0cmFuc2FjdGlvbgogICAgKiBAcGFyYW0gX2Ftb3VudCAgICAgICAgICB1aW50MjU2ICAgICBUaGUgYW1vdW50IHNlbnQgaW4gdGhlIHRyYW5zYWN0aW9uCiAgICAqIEByZXR1cm4gICAgICAgIGJvb2wgICAgICAgIFJldHVybnMgdHJ1ZSBpZiB0aGUgYW1vdW50IGlzIHZhbGlkCiAgICAqLwogICAgZnVuY3Rpb24gaXNWYWxpZENvbnRyaWJ1dGlvbiAoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIHZhbGlkKSB7CiAgICAgICAgcmVxdWlyZShpc1doaXRlbGlzdGVkKF9hZGRyZXNzKSk7CgogICAgICAgIHJldHVybiBpc0VxdWFsT3JCZWxvd0NhcChfYW1vdW50ICsgaW52ZXN0b3JzW19hZGRyZXNzXS5jb250cmlidXRpb24pOyAKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDaGVjayB0aGF0IHRoZSBhbW91bnQgc2VudCBpbiB0aGUgdHJhbnNhY3Rpb24gaXMgZXF1YWwgdG8gb3IgYmVsb3cgdGhlIGluZGl2aWR1YWwgY2FwCiAgICAqIEBwYXJhbSBfYW1vdW50ICAgICAgICAgdWludDI1NiAgICAgVGhlIGFtb3VudCBzZW50IGluIHRoZSB0cmFuc2FjdGlvbgogICAgKiBAcmV0dXJuICAgICAgICBib29sICAgICAgICBSZXR1cm5zIHRydWUgaWYgdGhlIGFtb3VudCBpcyBlcXVhbCB0byBvciBiZWxvdyB0aGUgaW5kaXZpZHVhbCBjYXAKICAgICovCiAgICBmdW5jdGlvbiBpc0VxdWFsT3JCZWxvd0NhcCAodWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGV0aFRvVXNkKF9hbW91bnQpIDw9IGluZGl2aWR1YWxDYXA7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgR2VuZXJhdGVzIGEgcmFuZG9tIG51bWJlciBmcm9tIDEgdG8gbWF4IGJhc2VkIG9uIHRoZSBsYXN0IGJsb2NrIGhhc2gKICAgICogQHBhcmFtIG1heCAgICAgdWludCAgdGhlIG1heGltdW0gdmFsdWUgCiAgICAqIEByZXR1cm4gYSByYW5kb20gbnVtYmVyCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmFuZG9tKHVpbnQgbWF4KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IHJhbmRvbU51bWJlcikgewogICAgICAgIHJldHVybiAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciAtIDEpKSkgJSBtYXgpICsgMTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBtb2RpZnkgcGFyYW1ldGVycyBiYXNlZCBvbiB0b2tlbnMgYm91Z2h0CiAgICAqIEBwYXJhbSBfdG9rZW5zICAgICAgICB1aW50MjU2ICAgICBUaGUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZWQKICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVTYWxlUGFyYW1ldGVycyAodWludDI1NiBfdG9rZW5zKSBpbnRlcm5hbCB7CiAgICAgICAgdG9rZW5zUHVyY2hhc2VkID0gdG9rZW5zUHVyY2hhc2VkLmFkZChfdG9rZW5zKTsKICAgIH0KfQ=='.
	

]
