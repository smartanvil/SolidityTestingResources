Class {
	#name : #SRT49b84450a9a56081ce570920aa578c35e0b2461f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT49b84450a9a56081ce570920aa578c35e0b2461f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNDsKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBUb2tlblRyYWRlckZhY3RvcnkKLy8KLy8gRGVjZW50cmFsaXNlZCB0cnVzdGxlc3MgRVJDMjAtY29tcGxpYW50IHRva2VuIHRvIEVUSCBleGNoYW5nZSBjb250cmFjdAovLyBvbiB0aGUgRXRoZXJldW0gYmxvY2tjaGFpbi4KLy8KLy8gTm90ZSB0aGF0IHRoaXMgVG9rZW5UcmFkZXIgY2Fubm90IGJlIHVzZWQgd2l0aCB0aGUgR29sZW0gTmV0d29yayBUb2tlbgovLyBkaXJlY3RseSBhcyB0aGUgdG9rZW4gZG9lcyBub3QgaW1wbGVtZW50IHRoZSBFUkMyMAovLyB0cmFuc2ZlckZyb20oLi4uKSwgYXBwcm92ZSguLi4pIGFuZCBhbGxvd2FuY2UoLi4uKSBtZXRob2RzCi8vCi8vIEhpc3Rvcnk6Ci8vICAgSmFuIDI1IDIwMTcgLSBCUEIgQWRkZWQgbWFrZXJUcmFuc2ZlckFzc2V0KC4uLikgYW5kCi8vICAgICAgICAgICAgICAgICAgICAgbWFrZXJUcmFuc2ZlckV0aGVyKC4uLikKLy8gICBGZWIgMDUgMjAxNyAtIEJQQiBCdWcgZml4IGluIHRoZSBjaGFuZ2UgY2FsY3VsYXRpb24gZm9yIHRoZSBVbmljb3JuCi8vICAgICAgICAgICAgICAgICAgICAgdG9rZW4gd2l0aCBuYXR1cmFsIG51bWJlciAxCi8vICAgRmViIDA4IDIwMTcgLSBCUEIvSkwgUmVuYW1lZCBldGhlclZhbHVlT2ZUb2tlbnNUb1NlbGwgdG8KLy8gICAgICAgICAgICAgICAgICAgICBhbW91bnRPZlRva2Vuc1RvU2VsbCBpbiB0YWtlclNlbGxBc3NldCguLi4pIHRvCi8vICAgICAgICAgICAgICAgICAgICAgYmV0dGVyIGRlc2NyaWJlIHRoZSBwYXJhbWV0ZXIKLy8gICAgICAgICAgICAgICAgICAgICBBZGRlZCBjaGVjayBpbiBjcmVhdGVUcmFkZUNvbnRyYWN0KC4uLikgdG8gcHJldmVudAovLyAgICAgICAgICAgICAgICAgICAgIEdOVHMgZnJvbSBiZWluZyB1c2VkIHdpdGggdGhpcyBjb250cmFjdC4gVGhlIGFzc2V0Ci8vICAgICAgICAgICAgICAgICAgICAgdG9rZW4gd2lsbCBuZWVkIHRvIGhhdmUgYW4gYWxsb3dhbmNlKC4uLikgZnVuY3Rpb24uCi8vCi8vIEVuam95LiAoYykgSm9ubnlMYXR0ZSAmIEJva2t5UG9vQmFoIDIwMTcuIFRoZSBNSVQgbGljZW5jZS4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKY29udHJhY3QgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRvdGFsU3VwcGx5KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9Cgpjb250cmFjdCBPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7CgogICAgZnVuY3Rpb24gT3duZWQoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyT3JUb2tlblRyYWRlcldpdGhTYW1lT3duZXIgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyICYmIFRva2VuVHJhZGVyKG1zZy5zZW5kZXIpLm93bmVyKCkgIT0gb3duZXIpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cn0KCi8vIGNvbnRyYWN0IGNhbiBidXkgb3Igc2VsbCB0b2tlbnMgZm9yIEVUSAovLyBwcmljZXMgYXJlIGluIGFtb3VudCBvZiB3ZWkgcGVyIGJhdGNoIG9mIHRva2VuIHVuaXRzCgpjb250cmFjdCBUb2tlblRyYWRlciBpcyBPd25lZCB7CgogICAgYWRkcmVzcyBwdWJsaWMgYXNzZXQ7ICAgICAgIC8vIGFkZHJlc3Mgb2YgdG9rZW4KICAgIHVpbnQyNTYgcHVibGljIGJ1eVByaWNlOyAgICAvLyBjb250cmFjdCBidXlzIGxvdHMgb2YgdG9rZW4gYXQgdGhpcyBwcmljZQogICAgdWludDI1NiBwdWJsaWMgc2VsbFByaWNlOyAgIC8vIGNvbnRyYWN0IHNlbGxzIGxvdHMgYXQgdGhpcyBwcmljZQogICAgdWludDI1NiBwdWJsaWMgdW5pdHM7ICAgICAgIC8vIGxvdCBzaXplICh0b2tlbi13ZWkpCgogICAgYm9vbCBwdWJsaWMgYnV5c1Rva2VuczsgICAgIC8vIGlzIGNvbnRyYWN0IGJ1eWluZwogICAgYm9vbCBwdWJsaWMgc2VsbHNUb2tlbnM7ICAgIC8vIGlzIGNvbnRyYWN0IHNlbGxpbmcKCiAgICBldmVudCBBY3RpdmF0ZWRFdmVudChib29sIGJ1eXMsIGJvb2wgc2VsbHMpOwogICAgZXZlbnQgTWFrZXJEZXBvc2l0ZWRFdGhlcih1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYWtlcldpdGhkcmV3QXNzZXQodWludDI1NiB0b2tlbnMpOwogICAgZXZlbnQgTWFrZXJUcmFuc2ZlcnJlZEFzc2V0KGFkZHJlc3MgdG9Ub2tlblRyYWRlciwgdWludDI1NiB0b2tlbnMpOwogICAgZXZlbnQgTWFrZXJXaXRoZHJld0VSQzIwVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IE1ha2VyV2l0aGRyZXdFdGhlcih1aW50MjU2IGV0aGVycyk7CiAgICBldmVudCBNYWtlclRyYW5zZmVycmVkRXRoZXIoYWRkcmVzcyB0b1Rva2VuVHJhZGVyLCB1aW50MjU2IGV0aGVycyk7CiAgICBldmVudCBUYWtlckJvdWdodEFzc2V0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBldGhlcnNTZW50LAogICAgICAgIHVpbnQyNTYgZXRoZXJzUmV0dXJuZWQsIHVpbnQyNTYgdG9rZW5zQm91Z2h0KTsKICAgIGV2ZW50IFRha2VyU29sZEFzc2V0KGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIHVpbnQyNTYgYW1vdW50T2ZUb2tlbnNUb1NlbGwsCiAgICAgICAgdWludDI1NiB0b2tlbnNTb2xkLCB1aW50MjU2IGV0aGVyVmFsdWVPZlRva2Vuc1NvbGQpOwoKICAgIC8vIENvbnN0cnVjdG9yIC0gb25seSB0byBiZSBjYWxsZWQgYnkgdGhlIFRva2VuVHJhZGVyRmFjdG9yeSBjb250cmFjdAogICAgZnVuY3Rpb24gVG9rZW5UcmFkZXIgKAogICAgICAgIGFkZHJlc3MgX2Fzc2V0LAogICAgICAgIHVpbnQyNTYgX2J1eVByaWNlLAogICAgICAgIHVpbnQyNTYgX3NlbGxQcmljZSwKICAgICAgICB1aW50MjU2IF91bml0cywKICAgICAgICBib29sICAgIF9idXlzVG9rZW5zLAogICAgICAgIGJvb2wgICAgX3NlbGxzVG9rZW5zCiAgICApIHsKICAgICAgICBhc3NldCAgICAgICA9IF9hc3NldDsKICAgICAgICBidXlQcmljZSAgICA9IF9idXlQcmljZTsKICAgICAgICBzZWxsUHJpY2UgICA9IF9zZWxsUHJpY2U7CiAgICAgICAgdW5pdHMgICAgICAgPSBfdW5pdHM7CiAgICAgICAgYnV5c1Rva2VucyAgPSBfYnV5c1Rva2VuczsKICAgICAgICBzZWxsc1Rva2VucyA9IF9zZWxsc1Rva2VuczsKICAgICAgICBBY3RpdmF0ZWRFdmVudChidXlzVG9rZW5zLCBzZWxsc1Rva2Vucyk7CiAgICB9CgogICAgLy8gTWFrZXIgY2FuIGFjdGl2YXRlIG9yIGRlYWN0aXZhdGUgdGhpcyBjb250cmFjdCdzIGJ1eWluZyBhbmQKICAgIC8vIHNlbGxpbmcgc3RhdHVzCiAgICAvLwogICAgLy8gVGhlIEFjdGl2YXRlZEV2ZW50KCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZwogICAgLy8gcGFyYW1ldGVyOgogICAgLy8gICBidXlzVG9rZW5zICAgdGhpcyBjb250cmFjdCBjYW4gYnV5IGFzc2V0IHRva2VucwogICAgLy8gICBzZWxsc1Rva2VucyAgdGhpcyBjb250cmFjdCBjYW4gc2VsbCBhc3NldCB0b2tlbnMKICAgIC8vCiAgICBmdW5jdGlvbiBhY3RpdmF0ZSAoCiAgICAgICAgYm9vbCBfYnV5c1Rva2VucywKICAgICAgICBib29sIF9zZWxsc1Rva2VucwogICAgKSBvbmx5T3duZXIgewogICAgICAgIGJ1eXNUb2tlbnMgID0gX2J1eXNUb2tlbnM7CiAgICAgICAgc2VsbHNUb2tlbnMgPSBfc2VsbHNUb2tlbnM7CiAgICAgICAgQWN0aXZhdGVkRXZlbnQoYnV5c1Rva2Vucywgc2VsbHNUb2tlbnMpOwogICAgfQoKICAgIC8vIE1ha2VyIGNhbiBkZXBvc2l0IGV0aGVycyB0byB0aGlzIGNvbnRyYWN0IHNvIHRoaXMgY29udHJhY3QKICAgIC8vIGNhbiBidXkgYXNzZXQgdG9rZW5zLgogICAgLy8KICAgIC8vIE1ha2VyIGRlcG9zaXRzIGFzc2V0IHRva2VucyB0byB0aGlzIGNvbnRyYWN0IGJ5IGNhbGxpbmcgdGhlCiAgICAvLyBhc3NldCdzIHRyYW5zZmVyKCkgbWV0aG9kIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzCiAgICAvLyAgIF90byAgICAgaXMgdGhlIGFkZHJlc3Mgb2YgVEhJUyBjb250cmFjdAogICAgLy8gICBfdmFsdWUgIGlzIHRoZSBudW1iZXIgb2YgYXNzZXQgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLwogICAgLy8gVGFrZXIgTVVTVCBOT1Qgc2VuZCB0b2tlbnMgZGlyZWN0bHkgdG8gdGhpcyBjb250cmFjdC4gVGFrZXJzCiAgICAvLyBNVVNUIHVzZSB0aGUgdGFrZXJTZWxsQXNzZXQoKSBtZXRob2QgdG8gc2VsbCBhc3NldCB0b2tlbnMKICAgIC8vIHRvIHRoaXMgY29udHJhY3QKICAgIC8vCiAgICAvLyBNYWtlciBjYW4gYWxzbyB0cmFuc2ZlciBldGhlcnMgZnJvbSBvbmUgVG9rZW5UcmFkZXIgY29udHJhY3QKICAgIC8vIHRvIGFub3RoZXIgVG9rZW5UcmFkZXIgY29udHJhY3QsIGJvdGggb3duZWQgYnkgdGhlIE1ha2VyCiAgICAvLwogICAgLy8gVGhlIE1ha2VyRGVwb3NpdGVkRXRoZXIoKSBldmVudCBpcyBsb2dnZWQgd2l0aCB0aGUgZm9sbG93aW5nCiAgICAvLyBwYXJhbWV0ZXI6CiAgICAvLyAgIGV0aGVycyAgaXMgdGhlIG51bWJlciBvZiBldGhlcnMgZGVwb3NpdGVkIGJ5IHRoZSBtYWtlcgogICAgLy8KICAgIC8vIFRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgZGVwb3NpdCgpIGluIHRoZSBvbGQgdmVyc2lvbgogICAgLy8KICAgIGZ1bmN0aW9uIG1ha2VyRGVwb3NpdEV0aGVyKCkgcGF5YWJsZSBvbmx5T3duZXJPclRva2VuVHJhZGVyV2l0aFNhbWVPd25lciB7CiAgICAgICAgTWFrZXJEZXBvc2l0ZWRFdGhlcihtc2cudmFsdWUpOwogICAgfQoKICAgIC8vIE1ha2VyIGNhbiB3aXRoZHJhdyBhc3NldCB0b2tlbnMgZnJvbSB0aGlzIGNvbnRyYWN0LCB3aXRoIHRoZQogICAgLy8gZm9sbG93aW5nIHBhcmFtZXRlcjoKICAgIC8vICAgdG9rZW5zICBpcyB0aGUgbnVtYmVyIG9mIGFzc2V0IHRva2VucyB0byBiZSB3aXRoZHJhd24KICAgIC8vCiAgICAvLyBUaGUgTWFrZXJXaXRoZHJld0Fzc2V0KCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZwogICAgLy8gcGFyYW1ldGVyOgogICAgLy8gICB0b2tlbnMgIGlzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHdpdGhkcmF3biBieSB0aGUgbWFrZXIKICAgIC8vCiAgICAvLyBUaGlzIG1ldGhvZCB3YXMgY2FsbGVkIHdpdGhkcmF3QXNzZXQoKSBpbiB0aGUgb2xkIHZlcnNpb24KICAgIC8vCiAgICBmdW5jdGlvbiBtYWtlcldpdGhkcmF3QXNzZXQodWludDI1NiB0b2tlbnMpIG9ubHlPd25lciByZXR1cm5zIChib29sIG9rKSB7CiAgICAgICAgTWFrZXJXaXRoZHJld0Fzc2V0KHRva2Vucyk7CiAgICAgICAgcmV0dXJuIEVSQzIwKGFzc2V0KS50cmFuc2Zlcihvd25lciwgdG9rZW5zKTsKICAgIH0KCiAgICAvLyBNYWtlciBjYW4gdHJhbnNmZXIgYXNzZXQgdG9rZW5zIGZyb20gdGhpcyBjb250cmFjdCB0byBhbm90aGVyCiAgICAvLyBUb2tlblRyYWRlciBjb250cmFjdCwgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcjoKICAgIC8vICAgdG9Ub2tlblRyYWRlciAgQW5vdGhlciBUb2tlblRyYWRlciBjb250cmFjdCBvd25lZCBieSB0aGUKICAgIC8vICAgICAgICAgICAgICAgICAgc2FtZSBvd25lciBhbmQgd2l0aCB0aGUgc2FtZSBhc3NldAogICAgLy8gICB0b2tlbnMgICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIGFzc2V0IHRva2VucyB0byBiZSBtb3ZlZAogICAgLy8KICAgIC8vIFRoZSBNYWtlclRyYW5zZmVycmVkQXNzZXQoKSBldmVudCBpcyBsb2dnZWQgd2l0aCB0aGUgZm9sbG93aW5nCiAgICAvLyBwYXJhbWV0ZXJzOgogICAgLy8gICB0b1Rva2VuVHJhZGVyICBUaGUgb3RoZXIgVG9rZW5UcmFkZXIgY29udHJhY3Qgb3duZWQgYnkKICAgIC8vICAgICAgICAgICAgICAgICAgdGhlIHNhbWUgb3duZXIgYW5kIHdpdGggdGhlIHNhbWUgYXNzZXQKICAgIC8vICAgdG9rZW5zICAgICAgICAgaXMgdGhlIG51bWJlciBvZiB0b2tlbnMgdHJhbnNmZXJyZWQKICAgIC8vCiAgICAvLyBUaGUgYXNzZXQgVHJhbnNmZXIoKSBldmVudCBpcyBhbHNvIGxvZ2dlZCBmcm9tIHRoaXMgY29udHJhY3QKICAgIC8vIHRvIHRoZSBvdGhlciBjb250cmFjdAogICAgLy8KICAgIGZ1bmN0aW9uIG1ha2VyVHJhbnNmZXJBc3NldCgKICAgICAgICBUb2tlblRyYWRlciB0b1Rva2VuVHJhZGVyLAogICAgICAgIHVpbnQyNTYgdG9rZW5zCiAgICApIG9ubHlPd25lciByZXR1cm5zIChib29sIG9rKSB7CiAgICAgICAgaWYgKG93bmVyICE9IHRvVG9rZW5UcmFkZXIub3duZXIoKSB8fCBhc3NldCAhPSB0b1Rva2VuVHJhZGVyLmFzc2V0KCkpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIE1ha2VyVHJhbnNmZXJyZWRBc3NldCh0b1Rva2VuVHJhZGVyLCB0b2tlbnMpOwogICAgICAgIHJldHVybiBFUkMyMChhc3NldCkudHJhbnNmZXIodG9Ub2tlblRyYWRlciwgdG9rZW5zKTsKICAgIH0KCiAgICAvLyBNYWtlciBjYW4gd2l0aGRyYXcgYW55IEVSQzIwIGFzc2V0IHRva2VucyBmcm9tIHRoaXMgY29udHJhY3QKICAgIC8vCiAgICAvLyBUaGlzIG1ldGhvZCBpcyBpbmNsdWRlZCBpbiB0aGUgY2FzZSB3aGVyZSB0aGlzIGNvbnRyYWN0IHJlY2VpdmVzCiAgICAvLyB0aGUgd3JvbmcgdG9rZW5zCiAgICAvLwogICAgLy8gVGhlIE1ha2VyV2l0aGRyZXdFUkMyMFRva2VuKCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZwogICAgLy8gcGFyYW1ldGVyOgogICAgLy8gICB0b2tlbkFkZHJlc3MgIGlzIHRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbnMgd2l0aGRyYXduIGJ5IHRoZSBtYWtlcgogICAgLy8gICB0b2tlbnMgICAgICAgIGlzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHdpdGhkcmF3biBieSB0aGUgbWFrZXIKICAgIC8vCiAgICAvLyBUaGlzIG1ldGhvZCB3YXMgY2FsbGVkIHdpdGhkcmF3VG9rZW4oKSBpbiB0aGUgb2xkIHZlcnNpb24KICAgIC8vCiAgICBmdW5jdGlvbiBtYWtlcldpdGhkcmF3RVJDMjBUb2tlbigKICAgICAgICBhZGRyZXNzIHRva2VuQWRkcmVzcywKICAgICAgICB1aW50MjU2IHRva2VucwogICAgKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIE1ha2VyV2l0aGRyZXdFUkMyMFRva2VuKHRva2VuQWRkcmVzcywgdG9rZW5zKTsKICAgICAgICByZXR1cm4gRVJDMjAodG9rZW5BZGRyZXNzKS50cmFuc2Zlcihvd25lciwgdG9rZW5zKTsKICAgIH0KCiAgICAvLyBNYWtlciBjYW4gd2l0aGRyYXcgZXRoZXJzIGZyb20gdGhpcyBjb250cmFjdAogICAgLy8KICAgIC8vIFRoZSBNYWtlcldpdGhkcmV3RXRoZXIoKSBldmVudCBpcyBsb2dnZWQgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcgogICAgLy8gICBldGhlcnMgIGlzIHRoZSBudW1iZXIgb2YgZXRoZXJzIHdpdGhkcmF3biBieSB0aGUgbWFrZXIKICAgIC8vCiAgICAvLyBUaGlzIG1ldGhvZCB3YXMgY2FsbGVkIHdpdGhkcmF3KCkgaW4gdGhlIG9sZCB2ZXJzaW9uCiAgICAvLwogICAgZnVuY3Rpb24gbWFrZXJXaXRoZHJhd0V0aGVyKHVpbnQyNTYgZXRoZXJzKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPj0gZXRoZXJzKSB7CiAgICAgICAgICAgIE1ha2VyV2l0aGRyZXdFdGhlcihldGhlcnMpOwogICAgICAgICAgICByZXR1cm4gb3duZXIuc2VuZChldGhlcnMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBNYWtlciBjYW4gdHJhbnNmZXIgZXRoZXJzIGZyb20gdGhpcyBjb250cmFjdCB0byBhbm90aGVyIFRva2VuVHJhZGVyCiAgICAvLyBjb250cmFjdCwgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAgICAvLyAgIHRvVG9rZW5UcmFkZXIgIEFub3RoZXIgVG9rZW5UcmFkZXIgY29udHJhY3Qgb3duZWQgYnkgdGhlCiAgICAvLyAgICAgICAgICAgICAgICAgIHNhbWUgb3duZXIgYW5kIHdpdGggdGhlIHNhbWUgYXNzZXQKICAgIC8vICAgZXRoZXJzICAgICAgICAgaXMgdGhlIG51bWJlciBvZiBldGhlcnMgdG8gYmUgbW92ZWQKICAgIC8vCiAgICAvLyBUaGUgTWFrZXJUcmFuc2ZlcnJlZEV0aGVyKCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXIKICAgIC8vICAgdG9Ub2tlblRyYWRlciAgVGhlIG90aGVyIFRva2VuVHJhZGVyIGNvbnRyYWN0IG93bmVkIGJ5IHRoZQogICAgLy8gICAgICAgICAgICAgICAgICBzYW1lIG93bmVyIGFuZCB3aXRoIHRoZSBzYW1lIGFzc2V0CiAgICAvLyAgIGV0aGVycyAgICAgICAgIGlzIHRoZSBudW1iZXIgb2YgZXRoZXJzIHRyYW5zZmVycmVkCiAgICAvLwogICAgLy8gVGhlIE1ha2VyRGVwb3NpdGVkRXRoZXIoKSBldmVudCBpcyBsb2dnZWQgb24gdGhlIG90aGVyCiAgICAvLyBjb250cmFjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyOgogICAgLy8gICBldGhlcnMgIGlzIHRoZSBudW1iZXIgb2YgZXRoZXJzIGRlcG9zaXRlZCBieSB0aGUgbWFrZXIKICAgIC8vCiAgICBmdW5jdGlvbiBtYWtlclRyYW5zZmVyRXRoZXIoCiAgICAgICAgVG9rZW5UcmFkZXIgdG9Ub2tlblRyYWRlciwKICAgICAgICB1aW50MjU2IGV0aGVycwogICAgKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIGlmIChvd25lciAhPSB0b1Rva2VuVHJhZGVyLm93bmVyKCkgfHwgYXNzZXQgIT0gdG9Ub2tlblRyYWRlci5hc3NldCgpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5iYWxhbmNlID49IGV0aGVycykgewogICAgICAgICAgICBNYWtlclRyYW5zZmVycmVkRXRoZXIodG9Ub2tlblRyYWRlciwgZXRoZXJzKTsKICAgICAgICAgICAgdG9Ub2tlblRyYWRlci5tYWtlckRlcG9zaXRFdGhlci52YWx1ZShldGhlcnMpKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRha2VyIGJ1eXMgYXNzZXQgdG9rZW5zIGJ5IHNlbmRpbmcgZXRoZXJzCiAgICAvLwogICAgLy8gVGhlIFRha2VyQm91Z2h0QXNzZXQoKSBldmVudCBpcyBsb2dnZWQgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnMKICAgIC8vICAgYnV5ZXIgICAgICAgICAgIGlzIHRoZSBidXllcidzIGFkZHJlc3MKICAgIC8vICAgZXRoZXJzU2VudCAgICAgIGlzIHRoZSBudW1iZXIgb2YgZXRoZXJzIHNlbnQgYnkgdGhlIGJ1eWVyCiAgICAvLyAgIGV0aGVyc1JldHVybmVkICBpcyB0aGUgbnVtYmVyIG9mIGV0aGVycyBzZW50IGJhY2sgdG8gdGhlIGJ1eWVyIGFzCiAgICAvLyAgICAgICAgICAgICAgICAgICBjaGFuZ2UKICAgIC8vICAgdG9rZW5zQm91Z2h0ICAgIGlzIHRoZSBudW1iZXIgb2YgYXNzZXQgdG9rZW5zIHNlbnQgdG8gdGhlIGJ1eWVyCiAgICAvLwogICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCBidXkoKSBpbiB0aGUgb2xkIHZlcnNpb24KICAgIC8vCiAgICBmdW5jdGlvbiB0YWtlckJ1eUFzc2V0KCkgcGF5YWJsZSB7CiAgICAgICAgaWYgKHNlbGxzVG9rZW5zIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpIHsKICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHNlbGxQcmljZSBoYXMgYWxyZWFkeSBiZWVuIHZhbGlkYXRlZCBhcyA+IDAKICAgICAgICAgICAgdWludCBvcmRlciAgICA9IG1zZy52YWx1ZSAvIHNlbGxQcmljZTsKICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHVuaXRzIGhhcyBhbHJlYWR5IGJlZW4gdmFsaWRhdGVkIGFzID4gMAogICAgICAgICAgICB1aW50IGNhbl9zZWxsID0gRVJDMjAoYXNzZXQpLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSAvIHVuaXRzOwogICAgICAgICAgICB1aW50MjU2IGNoYW5nZSA9IDA7CiAgICAgICAgICAgIGlmIChtc2cudmFsdWUgPiAoY2FuX3NlbGwgKiBzZWxsUHJpY2UpKSB7CiAgICAgICAgICAgICAgICBjaGFuZ2UgID0gbXNnLnZhbHVlIC0gKGNhbl9zZWxsICogc2VsbFByaWNlKTsKICAgICAgICAgICAgICAgIG9yZGVyID0gY2FuX3NlbGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNoYW5nZSA+IDApIHsKICAgICAgICAgICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKGNoYW5nZSkpIHRocm93OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcmRlciA+IDApIHsKICAgICAgICAgICAgICAgIGlmICghRVJDMjAoYXNzZXQpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG9yZGVyICogdW5pdHMpKSB0aHJvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICBUYWtlckJvdWdodEFzc2V0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgY2hhbmdlLCBvcmRlciAqIHVuaXRzKTsKICAgICAgICB9CiAgICAgICAgLy8gUmV0dXJuIHVzZXIgZnVuZHMgaWYgdGhlIGNvbnRyYWN0IGlzIG5vdCBzZWxsaW5nCiAgICAgICAgZWxzZSBpZiAoIW1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpKSB0aHJvdzsKICAgIH0KCiAgICAvLyBUYWtlciBzZWxscyBhc3NldCB0b2tlbnMgZm9yIGV0aGVycyBieToKICAgIC8vIDEuIENhbGxpbmcgdGhlIGFzc2V0J3MgYXBwcm92ZSgpIG1ldGhvZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycwogICAgLy8gICAgX3NwZW5kZXIgICAgICAgICAgICBpcyB0aGUgYWRkcmVzcyBvZiB0aGlzIGNvbnRyYWN0CiAgICAvLyAgICBfdmFsdWUgICAgICAgICAgICAgIGlzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIGJlIHNvbGQKICAgIC8vIDIuIENhbGxpbmcgdGhpcyB0YWtlclNlbGxBc3NldCgpIG1ldGhvZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyCiAgICAvLyAgICBldGhlclZhbHVlT2ZUb2tlbnMgIGlzIHRoZSBldGhlciB2YWx1ZSBvZiB0aGUgYXNzZXQgdG9rZW5zIHRvIGJlIHNvbGQKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgYnkgdGhlIHRha2VyCiAgICAvLwogICAgLy8gVGhlIFRha2VyU29sZEFzc2V0KCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzCiAgICAvLyAgIHNlbGxlciAgICAgICAgICAgICAgICAgIGlzIHRoZSBzZWxsZXIncyBhZGRyZXNzCiAgICAvLyAgIGFtb3VudE9mVG9rZW5zVG9TZWxsICAgIGlzIHRoZSBhbW91bnQgb2YgdGhlIGFzc2V0IHRva2VucyBiZWluZwogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBzb2xkIGJ5IHRoZSB0YWtlcgogICAgLy8gICB0b2tlbnNTb2xkICAgICAgICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIHRoZSBhc3NldCB0b2tlbnMgc29sZAogICAgLy8gICBldGhlclZhbHVlT2ZUb2tlbnNTb2xkICBpcyB0aGUgZXRoZXIgdmFsdWUgb2YgdGhlIGFzc2V0IHRva2VucyBzb2xkCiAgICAvLwogICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCBzZWxsKCkgaW4gdGhlIG9sZCB2ZXJzaW9uCiAgICAvLwogICAgZnVuY3Rpb24gdGFrZXJTZWxsQXNzZXQodWludDI1NiBhbW91bnRPZlRva2Vuc1RvU2VsbCkgewogICAgICAgIGlmIChidXlzVG9rZW5zIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpIHsKICAgICAgICAgICAgLy8gTWF4aW11bSBudW1iZXIgb2YgdG9rZW4gdGhlIGNvbnRyYWN0IGNhbiBidXkKICAgICAgICAgICAgLy8gTm90ZSB0aGF0IGJ1eVByaWNlIGhhcyBhbHJlYWR5IGJlZW4gdmFsaWRhdGVkIGFzID4gMAogICAgICAgICAgICB1aW50MjU2IGNhbl9idXkgPSB0aGlzLmJhbGFuY2UgLyBidXlQcmljZTsKICAgICAgICAgICAgLy8gVG9rZW4gbG90cyBhdmFpbGFibGUKICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHVuaXRzIGhhcyBhbHJlYWR5IGJlZW4gdmFsaWRhdGVkIGFzID4gMAogICAgICAgICAgICB1aW50MjU2IG9yZGVyID0gYW1vdW50T2ZUb2tlbnNUb1NlbGwgLyB1bml0czsKICAgICAgICAgICAgLy8gQWRqdXN0IG9yZGVyIGZvciBmdW5kcyBhdmFpbGFibGUKICAgICAgICAgICAgaWYgKG9yZGVyID4gY2FuX2J1eSkgb3JkZXIgPSBjYW5fYnV5OwogICAgICAgICAgICBpZiAob3JkZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBFeHRyYWN0IHVzZXIgdG9rZW5zCiAgICAgICAgICAgICAgICBpZiAoIUVSQzIwKGFzc2V0KS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgYWRkcmVzcyh0aGlzKSwgb3JkZXIgKiB1bml0cykpIHRocm93OwogICAgICAgICAgICAgICAgLy8gUGF5IHVzZXIKICAgICAgICAgICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKG9yZGVyICogYnV5UHJpY2UpKSB0aHJvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICBUYWtlclNvbGRBc3NldChtc2cuc2VuZGVyLCBhbW91bnRPZlRva2Vuc1RvU2VsbCwgb3JkZXIgKiB1bml0cywgb3JkZXIgKiBidXlQcmljZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRha2VyIGJ1eXMgdG9rZW5zIGJ5IHNlbmRpbmcgZXRoZXJzCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICB0YWtlckJ1eUFzc2V0KCk7CiAgICB9Cn0KCi8vIFRoaXMgY29udHJhY3QgZGVwbG95cyBUb2tlblRyYWRlciBjb250cmFjdHMgYW5kIGxvZ3MgdGhlIGV2ZW50CmNvbnRyYWN0IFRva2VuVHJhZGVyRmFjdG9yeSBpcyBPd25lZCB7CgogICAgZXZlbnQgVHJhZGVMaXN0aW5nKGFkZHJlc3MgaW5kZXhlZCBvd25lckFkZHJlc3MsIGFkZHJlc3MgaW5kZXhlZCB0b2tlblRyYWRlckFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIGFzc2V0LCB1aW50MjU2IGJ1eVByaWNlLCB1aW50MjU2IHNlbGxQcmljZSwgdWludDI1NiB1bml0cywKICAgICAgICBib29sIGJ1eXNUb2tlbnMsIGJvb2wgc2VsbHNUb2tlbnMpOwogICAgZXZlbnQgT3duZXJXaXRoZHJld0VSQzIwVG9rZW4oYWRkcmVzcyBpbmRleGVkIHRva2VuQWRkcmVzcywgdWludDI1NiB0b2tlbnMpOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBfdmVyaWZ5OwoKICAgIC8vIEFueW9uZSBjYW4gY2FsbCB0aGlzIG1ldGhvZCB0byB2ZXJpZnkgdGhlIHNldHRpbmdzIG9mIGEKICAgIC8vIFRva2VuVHJhZGVyIGNvbnRyYWN0LiBUaGUgcGFyYW1ldGVycyBhcmU6CiAgICAvLyAgIHRyYWRlQ29udHJhY3QgIGlzIHRoZSBhZGRyZXNzIG9mIGEgVG9rZW5UcmFkZXIgY29udHJhY3QKICAgIC8vCiAgICAvLyBSZXR1cm4gdmFsdWVzOgogICAgLy8gICB2YWxpZCAgICAgICAgZGlkIHRoaXMgVG9rZW5UcmFkZXJGYWN0b3J5IGNyZWF0ZSB0aGUgVG9rZW5UcmFkZXIgY29udHJhY3Q/CiAgICAvLyAgIG93bmVyICAgICAgICBpcyB0aGUgb3duZXIgb2YgdGhlIFRva2VuVHJhZGVyIGNvbnRyYWN0CiAgICAvLyAgIGFzc2V0ICAgICAgICBpcyB0aGUgRVJDMjAgYXNzZXQgYWRkcmVzcwogICAgLy8gICBidXlQcmljZSAgICAgaXMgdGhlIGJ1eSBwcmljZSBpbiBldGhlcnMgcGVyIGB1bml0c2Agb2YgYXNzZXQgdG9rZW5zCiAgICAvLyAgIHNlbGxQcmljZSAgICBpcyB0aGUgc2VsbCBwcmljZSBpbiBldGhlcnMgcGVyIGB1bml0c2Agb2YgYXNzZXQgdG9rZW5zCiAgICAvLyAgIHVuaXRzICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIHVuaXRzIG9mIGFzc2V0IHRva2VucwogICAgLy8gICBidXlzVG9rZW5zICAgaXMgdGhlIFRva2VuVHJhZGVyIGNvbnRyYWN0IGJ1eWluZyB0b2tlbnM/CiAgICAvLyAgIHNlbGxzVG9rZW5zICBpcyB0aGUgVG9rZW5UcmFkZXIgY29udHJhY3Qgc2VsbGluZyB0b2tlbnM/CiAgICAvLwogICAgZnVuY3Rpb24gdmVyaWZ5KGFkZHJlc3MgdHJhZGVDb250cmFjdCkgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgYm9vbCAgICB2YWxpZCwKICAgICAgICBhZGRyZXNzIG93bmVyLAogICAgICAgIGFkZHJlc3MgYXNzZXQsCiAgICAgICAgdWludDI1NiBidXlQcmljZSwKICAgICAgICB1aW50MjU2IHNlbGxQcmljZSwKICAgICAgICB1aW50MjU2IHVuaXRzLAogICAgICAgIGJvb2wgICAgYnV5c1Rva2VucywKICAgICAgICBib29sICAgIHNlbGxzVG9rZW5zCiAgICApIHsKICAgICAgICB2YWxpZCA9IF92ZXJpZnlbdHJhZGVDb250cmFjdF07CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgIFRva2VuVHJhZGVyIHQgPSBUb2tlblRyYWRlcih0cmFkZUNvbnRyYWN0KTsKICAgICAgICAgICAgb3duZXIgICAgICAgICA9IHQub3duZXIoKTsKICAgICAgICAgICAgYXNzZXQgICAgICAgICA9IHQuYXNzZXQoKTsKICAgICAgICAgICAgYnV5UHJpY2UgICAgICA9IHQuYnV5UHJpY2UoKTsKICAgICAgICAgICAgc2VsbFByaWNlICAgICA9IHQuc2VsbFByaWNlKCk7CiAgICAgICAgICAgIHVuaXRzICAgICAgICAgPSB0LnVuaXRzKCk7CiAgICAgICAgICAgIGJ1eXNUb2tlbnMgICAgPSB0LmJ1eXNUb2tlbnMoKTsKICAgICAgICAgICAgc2VsbHNUb2tlbnMgICA9IHQuc2VsbHNUb2tlbnMoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gTWFrZXIgY2FuIGNhbGwgdGhpcyBtZXRob2QgdG8gY3JlYXRlIGEgbmV3IFRva2VuVHJhZGVyIGNvbnRyYWN0CiAgICAvLyB3aXRoIHRoZSBtYWtlciBiZWluZyB0aGUgb3duZXIgb2YgdGhpcyBuZXcgY29udHJhY3QKICAgIC8vCiAgICAvLyBQYXJhbWV0ZXJzOgogICAgLy8gICBhc3NldCAgICAgICAgaXMgdGhlIEVSQzIwIGFzc2V0IGFkZHJlc3MKICAgIC8vICAgYnV5UHJpY2UgICAgIGlzIHRoZSBidXkgcHJpY2UgaW4gZXRoZXJzIHBlciBgdW5pdHNgIG9mIGFzc2V0IHRva2VucwogICAgLy8gICBzZWxsUHJpY2UgICAgaXMgdGhlIHNlbGwgcHJpY2UgaW4gZXRoZXJzIHBlciBgdW5pdHNgIG9mIGFzc2V0IHRva2VucwogICAgLy8gICB1bml0cyAgICAgICAgaXMgdGhlIG51bWJlciBvZiB1bml0cyBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgYnV5c1Rva2VucyAgIGlzIHRoZSBUb2tlblRyYWRlciBjb250cmFjdCBidXlpbmcgdG9rZW5zPwogICAgLy8gICBzZWxsc1Rva2VucyAgaXMgdGhlIFRva2VuVHJhZGVyIGNvbnRyYWN0IHNlbGxpbmcgdG9rZW5zPwogICAgLy8KICAgIC8vIEZvciBleGFtcGxlLCBsaXN0aW5nIGEgVG9rZW5UcmFkZXIgY29udHJhY3Qgb24gdGhlIFJFUCBBdWd1ciB0b2tlbiB3aGVyZQogICAgLy8gdGhlIGNvbnRyYWN0IHdpbGwgYnV5IFJFUCB0b2tlbnMgYXQgYSByYXRlIG9mIDM5MDAwLzEwMDAwMCA9IDAuMzkgRVRICiAgICAvLyBwZXIgUkVQIHRva2VuIGFuZCBzZWxsIFJFUCB0b2tlbnMgYXQgYSByYXRlIG9mIDQxMDAwLzEwMDAwMCA9IDAuNDEgRVRICiAgICAvLyBwZXIgUkVQIHRva2VuOgogICAgLy8gICBhc3NldCAgICAgICAgMHg0OGM4MGYxZjRkNTNkNTk1MWU1ZDU0MzhiNTRjYmE4NGYyOWYzMmE1CiAgICAvLyAgIGJ1eVByaWNlICAgICAzOTAwMAogICAgLy8gICBzZWxsUHJpY2UgICAgNDEwMDAKICAgIC8vICAgdW5pdHMgICAgICAgIDEwMDAwMAogICAgLy8gICBidXlzVG9rZW5zICAgdHJ1ZQogICAgLy8gICBzZWxsc1Rva2VucyAgdHJ1ZQogICAgLy8KICAgIC8vIFRoZSBUcmFkZUxpc3RpbmcoKSBldmVudCBpcyBsb2dnZWQgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnMKICAgIC8vICAgb3duZXJBZGRyZXNzICAgICAgICBpcyB0aGUgTWFrZXIncyBhZGRyZXNzCiAgICAvLyAgIHRva2VuVHJhZGVyQWRkcmVzcyAgaXMgdGhlIGFkZHJlc3Mgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgVG9rZW5UcmFkZXIgY29udHJhY3QKICAgIC8vICAgYXNzZXQgICAgICAgICAgICAgICBpcyB0aGUgRVJDMjAgYXNzZXQgYWRkcmVzcwogICAgLy8gICBidXlQcmljZSAgICAgICAgICAgIGlzIHRoZSBidXkgcHJpY2UgaW4gZXRoZXJzIHBlciBgdW5pdHNgIG9mIGFzc2V0IHRva2VucwogICAgLy8gICBzZWxsUHJpY2UgICAgICAgICAgIGlzIHRoZSBzZWxsIHByaWNlIGluIGV0aGVycyBwZXIgYHVuaXRzYCBvZiBhc3NldCB0b2tlbnMKICAgIC8vICAgdW5pdCAgICAgICAgICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIHVuaXRzIG9mIGFzc2V0IHRva2VucwogICAgLy8gICBidXlzVG9rZW5zICAgICAgICAgIGlzIHRoZSBUb2tlblRyYWRlciBjb250cmFjdCBidXlpbmcgdG9rZW5zPwogICAgLy8gICBzZWxsc1Rva2VucyAgICAgICAgIGlzIHRoZSBUb2tlblRyYWRlciBjb250cmFjdCBzZWxsaW5nIHRva2Vucz8KICAgIC8vCiAgICBmdW5jdGlvbiBjcmVhdGVUcmFkZUNvbnRyYWN0KAogICAgICAgIGFkZHJlc3MgYXNzZXQsCiAgICAgICAgdWludDI1NiBidXlQcmljZSwKICAgICAgICB1aW50MjU2IHNlbGxQcmljZSwKICAgICAgICB1aW50MjU2IHVuaXRzLAogICAgICAgIGJvb2wgICAgYnV5c1Rva2VucywKICAgICAgICBib29sICAgIHNlbGxzVG9rZW5zCiAgICApIHJldHVybnMgKGFkZHJlc3MgdHJhZGVyKSB7CiAgICAgICAgLy8gQ2Fubm90IGhhdmUgaW52YWxpZCBhc3NldAogICAgICAgIGlmIChhc3NldCA9PSAweDApIHRocm93OwogICAgICAgIC8vIENoZWNrIGZvciBFUkMyMCBhbGxvd2FuY2UgZnVuY3Rpb24KICAgICAgICAvLyBUaGlzIHdpbGwgdGhyb3cgYW4gZXJyb3IgaWYgdGhlIGFsbG93YW5jZSBmdW5jdGlvbgogICAgICAgIC8vIGlzIHVuZGVmaW5lZCB0byBwcmV2ZW50IEdOVHMgZnJvbSBiZWluZyB1c2VkCiAgICAgICAgLy8gd2l0aCB0aGlzIGZhY3RvcnkKICAgICAgICB1aW50MjU2IGFsbG93YW5jZSA9IEVSQzIwKGFzc2V0KS5hbGxvd2FuY2UobXNnLnNlbmRlciwgdGhpcyk7CiAgICAgICAgLy8gQ2Fubm90IHNldCB6ZXJvIG9yIG5lZ2F0aXZlIHByaWNlCiAgICAgICAgaWYgKGJ1eVByaWNlIDw9IDAgfHwgc2VsbFByaWNlIDw9IDApIHRocm93OwogICAgICAgIC8vIE11c3QgbWFrZSBwcm9maXQgb24gc3ByZWFkCiAgICAgICAgaWYgKGJ1eVByaWNlID49IHNlbGxQcmljZSkgdGhyb3c7CiAgICAgICAgLy8gQ2Fubm90IGJ1eSBvciBzZWxsIHplcm8gb3IgbmVnYXRpdmUgdW5pdHMKICAgICAgICBpZiAodW5pdHMgPD0gMCkgdGhyb3c7CgogICAgICAgIHRyYWRlciA9IG5ldyBUb2tlblRyYWRlcigKICAgICAgICAgICAgYXNzZXQsCiAgICAgICAgICAgIGJ1eVByaWNlLAogICAgICAgICAgICBzZWxsUHJpY2UsCiAgICAgICAgICAgIHVuaXRzLAogICAgICAgICAgICBidXlzVG9rZW5zLAogICAgICAgICAgICBzZWxsc1Rva2Vucyk7CiAgICAgICAgLy8gUmVjb3JkIHRoYXQgdGhpcyBmYWN0b3J5IGNyZWF0ZWQgdGhlIHRyYWRlcgogICAgICAgIF92ZXJpZnlbdHJhZGVyXSA9IHRydWU7CiAgICAgICAgLy8gU2V0IHRoZSBvd25lciB0byB3aG9ldmVyIGNhbGxlZCB0aGUgZnVuY3Rpb24KICAgICAgICBUb2tlblRyYWRlcih0cmFkZXIpLnRyYW5zZmVyT3duZXJzaGlwKG1zZy5zZW5kZXIpOwogICAgICAgIFRyYWRlTGlzdGluZyhtc2cuc2VuZGVyLCB0cmFkZXIsIGFzc2V0LCBidXlQcmljZSwgc2VsbFByaWNlLCB1bml0cywgYnV5c1Rva2Vucywgc2VsbHNUb2tlbnMpOwogICAgfQoKICAgIC8vIEZhY3Rvcnkgb3duZXIgY2FuIHdpdGhkcmF3IGFueSBFUkMyMCBhc3NldCB0b2tlbnMgZnJvbSB0aGlzIGNvbnRyYWN0CiAgICAvLwogICAgLy8gVGhpcyBtZXRob2QgaXMgaW5jbHVkZWQgaW4gdGhlIGNhc2Ugd2hlcmUgdGhpcyBjb250cmFjdCByZWNlaXZlcwogICAgLy8gdGhlIHdyb25nIHRva2VucwogICAgLy8KICAgIC8vIFRoZSBPd25lcldpdGhkcmV3RVJDMjBUb2tlbigpIGV2ZW50IGlzIGxvZ2dlZCB3aXRoIHRoZSBmb2xsb3dpbmcKICAgIC8vIHBhcmFtZXRlcjoKICAgIC8vICAgdG9rZW5BZGRyZXNzICBpcyB0aGUgYWRkcmVzcyBvZiB0aGUgdG9rZW5zIHdpdGhkcmF3biBieSB0aGUgbWFrZXIKICAgIC8vICAgdG9rZW5zICAgICAgICBpcyB0aGUgbnVtYmVyIG9mIHRva2VucyB3aXRoZHJhd24gYnkgdGhlIG1ha2VyCiAgICAvLwogICAgZnVuY3Rpb24gb3duZXJXaXRoZHJhd0VSQzIwVG9rZW4oYWRkcmVzcyB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgdG9rZW5zKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIE93bmVyV2l0aGRyZXdFUkMyMFRva2VuKHRva2VuQWRkcmVzcywgdG9rZW5zKTsKICAgICAgICByZXR1cm4gRVJDMjAodG9rZW5BZGRyZXNzKS50cmFuc2Zlcihvd25lciwgdG9rZW5zKTsKICAgIH0KCiAgICAvLyBQcmV2ZW50cyBhY2NpZGVudGFsIHNlbmRpbmcgb2YgZXRoZXIgdG8gdGhlIGZhY3RvcnkKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdzsKICAgIH0KfQoKY29udHJhY3QgRml4ZWRTdXBwbHlUb2tlbiBpcyBFUkMyMCB7CiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5OwogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIC8vIEJhbGFuY2VzIGZvciBlYWNoIGFjY291bnQKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICAvLyBPd25lciBvZiBhY2NvdW50IGFwcHJvdmVzIHRoZSB0cmFuc2ZlciBvZiBhbiBhbW91bnQgdG8gYW5vdGhlciBhY2NvdW50CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gRml4ZWRTdXBwbHlUb2tlbigKICAgICAgc3RyaW5nIF9uYW1lLAogICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgdWludDI1NiBfc3VwcGx5LAogICAgICB1aW50OCBfZGVjaW1hbHMKICAgICkgewogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgICAgIF90b3RhbFN1cHBseSA9IF9zdXBwbHk7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBfdG90YWxTdXBwbHk7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRvdGFsU3VwcGx5KSB7CiAgICAgICAgdG90YWxTdXBwbHkgPSBfdG90YWxTdXBwbHk7CiAgICB9CgogICAgLy8gV2hhdCBpcyB0aGUgYmFsYW5jZSBvZiBhIHBhcnRpY3VsYXIgYWNjb3VudD8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLy8gVHJhbnNmZXIgdGhlIGJhbGFuY2UgZnJvbSBvd25lcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX2Ftb3VudAogICAgICAgICAgICAmJiBfYW1vdW50ID4gMAogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX2Ftb3VudCA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfYW1vdW50OwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBhZGRyZXNzIF9mcm9tIHRvIGFkZHJlc3MgX3RvCiAgICAvLyBUaGUgdHJhbnNmZXJGcm9tIG1ldGhvZCBpcyB1c2VkIGZvciBhIHdpdGhkcmF3IHdvcmtmbG93LCBhbGxvd2luZyBjb250cmFjdHMgdG8gc2VuZAogICAgLy8gdG9rZW5zIG9uIHlvdXIgYmVoYWxmLCBmb3IgZXhhbXBsZSB0byAiZGVwb3NpdCIgdG8gYSBjb250cmFjdCBhZGRyZXNzIGFuZC9vciB0byBjaGFyZ2UKICAgIC8vIGZlZXMgaW4gc3ViLWN1cnJlbmNpZXM7IHRoZSBjb21tYW5kIHNob3VsZCBmYWlsIHVubGVzcyB0aGUgX2Zyb20gYWNjb3VudCBoYXMKICAgIC8vIGRlbGliZXJhdGVseSBhdXRob3JpemVkIHRoZSBzZW5kZXIgb2YgdGhlIG1lc3NhZ2UgdmlhIHNvbWUgbWVjaGFuaXNtOyB3ZSBwcm9wb3NlCiAgICAvLyB0aGVzZSBzdGFuZGFyZGl6ZWQgQVBJcyBmb3IgYXBwcm92YWw6CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfYW1vdW50CiAgICAgICAgICAgICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF9hbW91bnQKICAgICAgICAgICAgJiYgX2Ftb3VudCA+IDAKICAgICAgICAgICAgJiYgYmFsYW5jZXNbX3RvXSArIF9hbW91bnQgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfYW1vdW50OwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF9hbW91bnQ7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEFsbG93IF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20geW91ciBhY2NvdW50LCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQuCiAgICAvLyBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5Ub2tlbiBpcyBGaXhlZFN1cHBseVRva2VuewogIFRva2VuVHJhZGVyW10gcHVibGljIHRva2VuRXhjaGFuZ2VzOwogIHVpbnQyNTZbXSBwdWJsaWMgdG9rZW5SYXRpb3M7IC8vIE1lYXN1cmVkIGluIHBlciAxZTE4LCBlLmcuZyA1ZTE3ID0gNTAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVG9rZW5SYXRpb3MgTVVTVCBBREQgVE8gMSAoMWUxOCkKICB1aW50MjU2IHRva2Vuc0JvdWdodCA9IDA7CgogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7CgogIC8qIFRoaXMgZ2VuZXJhdGVzIGEgcHVibGljIGV2ZW50IG9uIHRoZSBibG9ja2NoYWluIHRoYXQgd2lsbCBub3RpZnkgY2xpZW50cyAqLwogIC8vZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CgogIC8qIEluaXRpYWxpemVzIGNvbnRyYWN0IHdpdGggaW5pdGlhbCBzdXBwbHkgdG9rZW5zIHRvIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCAqLwoKICBmdW5jdGlvbiBUb2tlblRva2VuKAogICAgc3RyaW5nIF9uYW1lLAogICAgc3RyaW5nIF9zeW1ib2wsCiAgICB1aW50MjU2IF9zdXBwbHksCiAgICB1aW50OCBfZGVjaW1hbHMsCiAgICBUb2tlblRyYWRlcltdIGluaXRpYWxUb2tlbkV4Y2hhbmdlcywKICAgIHVpbnQyNTZbXSBpbml0aWFsVG9rZW5SYXRpb3MKICAgICkgRml4ZWRTdXBwbHlUb2tlbigKICAgICAgX25hbWUsCiAgICAgIF9zeW1ib2wsCiAgICAgIF9zdXBwbHksCiAgICAgIF9kZWNpbWFscwogICAgKSB7CiAgICB0b2tlbkV4Y2hhbmdlcyA9IGluaXRpYWxUb2tlbkV4Y2hhbmdlczsKICAgIHRva2VuUmF0aW9zID0gaW5pdGlhbFRva2VuUmF0aW9zOwogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICB9CgogIGZ1bmN0aW9uIHNldFB1cmNoYXNlUmF0aW9zICgKICAgIFRva2VuVHJhZGVyW10gbmV3VG9rZW5FeGNoYW5nZXMsCiAgICB1aW50MjU2W10gbmV3VG9rZW5SYXRpb3MKICApIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgLy8gU2hvdWxkIGhhdmUgYSBsb3Qgb2YgYXNzZXJ0aW9ucwogICAgICAvLyBUT0RPOiBBc3NlcnQgbmV3VG9rZW5SYXRpb3MubGVuZ3RoID09IHRva2VuUmF0aW9zLmxlbmd0aAogICAgICAvLyBUT0RPOiBBc3NlcnQgbmV3VG9rZW5SYXRpb3MgYWRkIHRvIDEKICAgICAgdG9rZW5FeGNoYW5nZXMgPSBuZXdUb2tlbkV4Y2hhbmdlczsKICAgICAgdG9rZW5SYXRpb3MgPSBuZXdUb2tlblJhdGlvczsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBidXlQcmljZSgpIHJldHVybnMgKHVpbnQgdG90YWxQcmljZSkgewogICAgdG90YWxQcmljZSA9IDA7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgewogICAgICB0b3RhbFByaWNlICs9IHRva2VuRXhjaGFuZ2VzW2ldLmJ1eVByaWNlKCkgKiB0b2tlblJhdGlvc1tpXSAvIDFlMTg7CiAgICB9CiAgICByZXR1cm4gdG90YWxQcmljZTsKICB9CgogIGZ1bmN0aW9uIHNlbGxQcmljZSgpIHJldHVybnMgKHVpbnQgdG90YWxQcmljZSkgewogICAgdG90YWxQcmljZSA9IDA7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgewogICAgICB0b3RhbFByaWNlICs9IHRva2VuRXhjaGFuZ2VzW2ldLnNlbGxQcmljZSgpICogdG9rZW5SYXRpb3NbaV0gLyAxZTE4OwogICAgfQogICAgcmV0dXJuIHRvdGFsUHJpY2U7CiAgfQoKICBmdW5jdGlvbiAoKSB7IC8vIFNlbmRpbmcgZXRoZXIgdG8gaXQgYnV5cyBjb2lucyBhdXRvbWF0aWNhbGx5CiAgICBidXkoKTsKICB9CiAgZnVuY3Rpb24gYnV5KCkgcGF5YWJsZSByZXR1cm5zICh1aW50IGFtb3VudCl7ICAgICAgICAvLyBCdXkgaW4gRVRICgogICAgYW1vdW50ID0gbXNnLnZhbHVlIC8gYnV5UHJpY2UoKTsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHRva2VuRXhjaGFuZ2VzLmxlbmd0aDsgKytpKSB7CiAgICAgIFRva2VuVHJhZGVyIHRva2VuRXhjaGFuZ2UgPSB0b2tlbkV4Y2hhbmdlc1tpXTsKICAgICAgdG9rZW5FeGNoYW5nZS50cmFuc2Zlcihtc2cudmFsdWUgKiB0b2tlblJhdGlvc1tpXSAvIDFlMTgpOwogICAgfQogICAgdG9rZW5zQm91Z2h0ICs9IGFtb3VudDsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IGFtb3VudDsgICAgICAgICAgICAgICAgICAgLy8gYWRkcyB0aGUgYW1vdW50IHRvIGJ1eWVyJ3MgYmFsYW5jZQogICAgYmFsYW5jZXNbdGhpc10gLT0gYW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWJ0cmFjdHMgYW1vdW50IGZyb20gc2VsbGVyJ3MgYmFsYW5jZQogICAgVHJhbnNmZXIodGhpcywgbXNnLnNlbmRlciwgYW1vdW50KTsgICAgICAgICAgICAgICAgLy8gZXhlY3V0ZSBhbiBldmVudCByZWZsZWN0aW5nIHRoZSBjaGFuZ2UKICAgIHJldHVybiBhbW91bnQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuZHMgZnVuY3Rpb24gYW5kIHJldHVybnMKICB9CgogIGZ1bmN0aW9uIHNlbGwodWludCBhbW91bnQpIHJldHVybnMgKHVpbnQgcmV2ZW51ZSl7ICAgLy8gU2VsbCBpbiB0b2tlbnMKICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA8IGFtb3VudCApIHRocm93OyAgICAgICAgLy8gY2hlY2tzIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaCB0byBzZWxsCiAgICBiYWxhbmNlc1t0aGlzXSArPSBhbW91bnQ7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZHMgdGhlIGFtb3VudCB0byBvd25lcidzIGJhbGFuY2UKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IGFtb3VudDsgICAgICAgICAgICAgICAgICAgLy8gc3VidHJhY3RzIHRoZSBhbW91bnQgZnJvbSBzZWxsZXIncyBiYWxhbmNlCgogICAgdWludDI1NiBzdWJUb2tlbnNUb1NlbGwgPSAwOwogICAgcmV2ZW51ZSA9IDA7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgeyAvLyBVbnNhZmUgY29kZTogd2hhdCBpZiB0aGUgbG9vcCBlcnJvcnMgaGFsZndheT8KICAgICAgVG9rZW5UcmFkZXIgdG9rZW5FeGNoYW5nZSA9IHRva2VuRXhjaGFuZ2VzW2ldOwogICAgICBzdWJUb2tlbnNUb1NlbGwgPSBFUkMyMCh0b2tlbkV4Y2hhbmdlLmFzc2V0KCkpLmJhbGFuY2VPZih0aGlzKSphbW91bnQvdG9rZW5zQm91Z2h0OwoKICAgICAgcmV2ZW51ZSArPSBzdWJUb2tlbnNUb1NlbGwgKiB0b2tlbkV4Y2hhbmdlLnNlbGxQcmljZSgpOwogICAgICBFUkMyMCh0b2tlbkV4Y2hhbmdlLmFzc2V0KCkpLmFwcHJvdmUoYWRkcmVzcyh0b2tlbkV4Y2hhbmdlKSwgc3ViVG9rZW5zVG9TZWxsKTsgLy8gQXBwcm92ZSBzYWxlCiAgICAgIHRva2VuRXhjaGFuZ2UudGFrZXJTZWxsQXNzZXQoc3ViVG9rZW5zVG9TZWxsKTsgLy8gTWFrZSBTYWxlCiAgICB9CgogICAgdG9rZW5zQm91Z2h0IC09IGFtb3VudDsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmV2ZW51ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0aGlzLCBhbW91bnQpOyAgICAgICAgICAgIC8vIGV4ZWN1dGVzIGFuIGV2ZW50IHJlZmxlY3Rpbmcgb24gdGhlIGNoYW5nZQogICAgcmV0dXJuIHJldmVudWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmRzIGZ1bmN0aW9uIGFuZCByZXR1cm5zCiAgfQoKICBmdW5jdGlvbiBicmVha2Rvd24odWludCBhbW91bnQpIHsgICAvLyBCcmVha2Rvd24gaW4gdG9rZW5zCiAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCBhbW91bnQgKSB0aHJvdzsgICAgICAgIC8vIGNoZWNrcyBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2ggdG8gc2VsbAogICAgYmFsYW5jZXNbdGhpc10gKz0gYW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRzIHRoZSBhbW91bnQgdG8gb3duZXIncyBiYWxhbmNlCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBhbW91bnQ7ICAgICAgICAgICAgICAgICAgIC8vIHN1YnRyYWN0cyB0aGUgYW1vdW50IGZyb20gc2VsbGVyJ3MgYmFsYW5jZQoKICAgIHVpbnQyNTYgc3ViVG9rZW5zVG9TZWxsID0gMDsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHRva2VuRXhjaGFuZ2VzLmxlbmd0aDsgKytpKSB7IC8vIFVuc2FmZSBjb2RlOiB3aGF0IGlmIHRoZSBsb29wIGVycm9ycyBoYWxmd2F5PwogICAgICBUb2tlblRyYWRlciB0b2tlbkV4Y2hhbmdlID0gdG9rZW5FeGNoYW5nZXNbaV07CiAgICAgIHN1YlRva2Vuc1RvU2VsbCA9IEVSQzIwKHRva2VuRXhjaGFuZ2UuYXNzZXQoKSkuYmFsYW5jZU9mKHRoaXMpKmFtb3VudC90b2tlbnNCb3VnaHQ7CiAgICAgIEVSQzIwKHRva2VuRXhjaGFuZ2UuYXNzZXQoKSkudHJhbnNmZXIobXNnLnNlbmRlciwgc3ViVG9rZW5zVG9TZWxsKTsKICAgIH0KCiAgICB0b2tlbnNCb3VnaHQgLT0gYW1vdW50OwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdGhpcywgYW1vdW50KTsgICAgICAgICAgICAvLyBleGVjdXRlcyBhbiBldmVudCByZWZsZWN0aW5nIG9uIHRoZSBjaGFuZ2UKICB9CgogIGZ1bmN0aW9uIHJlYmFsYW5jZShUb2tlblRyYWRlciBmcm9tRXhjaGFuZ2UsIFRva2VuVHJhZGVyIHRvRXhjaGFuZ2UsIHVpbnQyNTYgZnJvbVBlcmNlbnQpIG9ubHlPd25lciB7CiAgICB1aW50MjU2IHN1YlRva2Vuc1RvU2VsbCA9IEVSQzIwKGZyb21FeGNoYW5nZS5hc3NldCgpKS5iYWxhbmNlT2YodGhpcykgKiBmcm9tUGVyY2VudCAvIDFlMTg7CgogICAgdWludDI1NiByZXZlbnVlID0gc3ViVG9rZW5zVG9TZWxsICogZnJvbUV4Y2hhbmdlLnNlbGxQcmljZSgpOwogICAgRVJDMjAoZnJvbUV4Y2hhbmdlLmFzc2V0KCkpLmFwcHJvdmUoYWRkcmVzcyhmcm9tRXhjaGFuZ2UpLCBzdWJUb2tlbnNUb1NlbGwpOyAvLyBBcHByb3ZlIHNhbGUKICAgIGZyb21FeGNoYW5nZS50YWtlclNlbGxBc3NldChzdWJUb2tlbnNUb1NlbGwpOyAvLyBNYWtlIHNhbGUKCiAgICB0b0V4Y2hhbmdlLnRyYW5zZmVyKHJldmVudWUpOyAvLyBNYWtlIHB1cmNoYXNlIHdpdGggbmV3IGNvbnRyYWN0LgogIH0KCiAgZnVuY3Rpb24ga2lsbCgpIHsgaWYgKG1zZy5zZW5kZXIgPT0gb3duZXIpIHNlbGZkZXN0cnVjdChvd25lcik7IH0KfQ=='.
	

]
