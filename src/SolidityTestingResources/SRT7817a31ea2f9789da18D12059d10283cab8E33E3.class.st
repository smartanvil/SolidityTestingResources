Class {
	#name : #SRT7817a31ea2f9789da18D12059d10283cab8E33E3,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7817a31ea2f9789da18D12059d10283cab8E33E3 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7IC8vIHNvbGhpbnQtZGlzYWJsZS1saW5lCgpsaWJyYXJ5IEZpZm9MaWIgewoKICAgIHVpbnQgY29uc3RhbnQgSEVBRCA9IDA7CiAgICAKICAgIHN0cnVjdCBMaW5rZWRMaXN0IHsKICAgICAgICBtYXBwaW5nICh1aW50ID0+IHVpbnQpIGxpc3Q7CiAgICAgICAgdWludCB0YWlsOwogICAgICAgIHVpbnQgc2l6ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzaXplKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmKQogICAgICAgIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCByKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuc2l6ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBuZXh0KExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmLCB1aW50IG4pCiAgICAgICAgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHNlbGYubGlzdFtuXTsKICAgIH0KCiAgICAvLyBpbnNlcnQgbiBhZnRlciBwcmV2CiAgICBmdW5jdGlvbiBpbnNlcnQoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQgcHJldiwgdWludCBuKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShuICE9IEhFQUQgJiYgc2VsZi5saXN0W25dID09IEhFQUQgJiYgbiAhPSBzZWxmLnRhaWwpOwogICAgICAgIHNlbGYubGlzdFtuXSA9IHNlbGYubGlzdFtwcmV2XTsKICAgICAgICBzZWxmLmxpc3RbcHJldl0gPSBuOwogICAgICAgIHNlbGYuc2l6ZSsrOwogICAgICAgIGlmIChzZWxmLnRhaWwgPT0gcHJldikgewogICAgICAgICAgICBzZWxmLnRhaWwgPSBuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbjsKICAgIH0KICAgIAogICAgLy8gUmVtb3ZlIG5vZGUgbiBwcmVjZWRlZCBieSBwcmV2CiAgICBmdW5jdGlvbiByZW1vdmUoTGlua2VkTGlzdCBzdG9yYWdlIHNlbGYsIHVpbnQgcHJldiwgdWludCBuKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShuICE9IEhFQUQgJiYgc2VsZi5saXN0W3ByZXZdID09IG4pOwogICAgICAgIHNlbGYubGlzdFtwcmV2XSA9IHNlbGYubGlzdFtuXTsKICAgICAgICBkZWxldGUgc2VsZi5saXN0W25dOwogICAgICAgIHNlbGYuc2l6ZS0tOwogICAgICAgIGlmIChzZWxmLnRhaWwgPT0gbikgewogICAgICAgICAgICBzZWxmLnRhaWwgPSBwcmV2OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbjsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoVGFpbChMaW5rZWRMaXN0IHN0b3JhZ2Ugc2VsZiwgdWludCBuKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGluc2VydChzZWxmLCBzZWxmLnRhaWwsIG4pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBwb3BIZWFkKExpbmtlZExpc3Qgc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShzZWxmLnNpemUgPiAwKTsKICAgICAgICByZXR1cm4gcmVtb3ZlKHNlbGYsIEhFQUQsIHNlbGYubGlzdFtIRUFEXSk7CiAgICB9Cn0KCmNvbnRyYWN0IENvbXBhbnlUb2tlbiB7CiAgICBldmVudCBGb3VuZGVkKHVpbnQyNTYgdG9rZW5JZCwgc3RyaW5nIG5hbWUsIGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgcHJpY2UpOwogICAgZXZlbnQgU2hhcmVzU29sZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgc2hhcmVzLCB1aW50MjU2IHByaWNlLCBhZGRyZXNzIHByZXZPd25lciwgYWRkcmVzcyBuZXdPbndlciwgc3RyaW5nIG5hbWUpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgc2hhcmVzKTsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IE5BTUUgPSAiQ3J5cHRvQ29tcGFuaWVzIjsgLy8gc29saGludC1kaXNhYmxlLWxpbmUKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgU1lNQk9MID0gIkNvbXBhbnlUb2tlbiI7IC8vIHNvbGhpbnQtZGlzYWJsZS1saW5lCgogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IEhFQUQgPSAwOwoKICAgIHVpbnQyNTYgcHJpdmF0ZSBzdGFydGluZ1ByaWNlID0gMC4wMDEgZXRoZXI7CiAgICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgUFJPTU9fQ1JFQVRJT05fTElNSVQgPSA1MDAwOwogICAgdWludDI1NiBwcml2YXRlIGZpcnN0U3RlcExpbWl0ID0gIDAuMDUgZXRoZXI7CiAgICB1aW50MjU2IHByaXZhdGUgc2Vjb25kU3RlcExpbWl0ID0gMC41IGV0aGVyOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbW1pc3Npb25Qb2ludHMgPSA1OwoKICAgIC8vIEBkZXYgbWF4IG51bWJlciBvZiBzaGFyZXMgcGVyIGNvbXBhbnkKICAgIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBUT1RBTF9TSEFSRVMgPSAxMDA7CgogICAgLy8gQGRldiBjb21wYW55SW5kZXggPT4gKG93bmVyQWRkcmVzcyA9PiBudW1iZXJPZlNoYXJlcykKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGNvbXBhbnlJbmRleFRvT3duZXJzOwoKICAgIHN0cnVjdCBIb2xkaW5nIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIHVpbnQyNTYgc2hhcmVzOwogICAgfQoKICAgIC8vIHRva2VuSWQgPT4gaG9sZGluZyBmaWZvCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IEZpZm9MaWIuTGlua2VkTGlzdCkgcHJpdmF0ZSBmaWZvOwogICAgLy8gdG9rZW5JZCA9PiBtYXAoZmlmb0luZGV4ID0+IGhvbGRpbmcpCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IG1hcHBpbmcgKHVpbnQyNTYgPT4gSG9sZGluZykpIHByaXZhdGUgZmlmb1N0b3JhZ2U7CgogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwcml2YXRlIGZpZm9TdG9yYWdlS2V5OwoKICAgIC8vIG51bWJlciBvZiBzaGFyZXMgdHJhZGVkCiAgICAvLyB0b2tlbklkID0+IGNpcmN1bGF0YXRpb25Db3VudAogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwcml2YXRlIGNpcmN1bGF0aW9uQ291bnRlcnM7CgogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBDb21wYW55SURzIHRvIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4uCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIHByaXZhdGUgY29tcGFueUluZGV4VG9QcmljZTsKCiAgICAvLyBAZGV2IE93bmVyIHdobyBoYXMgbW9zdCBzaGFyZXMgCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHByaXZhdGUgY29tcGFueUluZGV4VG9DaGFpcm1hbjsKCiAgICAvLyBAZGV2IFdoZXRoZXIgYnV5aW5nIHNoYXJlcyBpcyBhbGxvd2VkLiBpZiBmYWxzZSwgb25seSB3aG9sZSBwdXJjaGFzZSBpcyBhbGxvd2VkLgogICAgbWFwcGluZyAodWludDI1NiA9PiBib29sKSBwcml2YXRlIHNoYXJlVHJhZGluZ0VuYWJsZWQ7CgoKICAgIC8vIFRoZSBhZGRyZXNzZXMgb2YgdGhlIGFjY291bnRzIChvciBjb250cmFjdHMpIHRoYXQgY2FuIGV4ZWN1dGUgYWN0aW9ucyB3aXRoaW4gZWFjaCByb2xlcy4KICAgIGFkZHJlc3MgcHVibGljIGNlb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwoKICAgIHVpbnQyNTYgcHVibGljIHByb21vQ3JlYXRlZENvdW50OwoKICAgIHN0cnVjdCBDb21wYW55IHsKICAgICAgICBzdHJpbmcgbmFtZTsKICAgIH0KCiAgICBDb21wYW55W10gcHJpdmF0ZSBjb21wYW5pZXM7CgogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q09PKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb29BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBDb21wYW55VG9rZW4oKSBwdWJsaWMgewogICAgICAgIGNlb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21vQ29tcGFueShhZGRyZXNzIF9vd25lciwgc3RyaW5nIF9uYW1lLCB1aW50MjU2IF9wcmljZSkgcHVibGljIG9ubHlDT08gewogICAgICAgIHJlcXVpcmUocHJvbW9DcmVhdGVkQ291bnQgPCBQUk9NT19DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIGFkZHJlc3MgY29tcGFueU93bmVyID0gX293bmVyOwogICAgICAgIGlmIChjb21wYW55T3duZXIgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBjb21wYW55T3duZXIgPSBjb29BZGRyZXNzOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9wcmljZSA8PSAwKSB7CiAgICAgICAgICAgIF9wcmljZSA9IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgfQoKICAgICAgICBwcm9tb0NyZWF0ZWRDb3VudCsrOwogICAgICAgIF9jcmVhdGVDb21wYW55KF9uYW1lLCBjb21wYW55T3duZXIsIF9wcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ29udHJhY3RDb21wYW55KHN0cmluZyBfbmFtZSkgcHVibGljIG9ubHlDT08gewogICAgICAgIF9jcmVhdGVDb21wYW55KF9uYW1lLCBhZGRyZXNzKHRoaXMpLCBzdGFydGluZ1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRTaGFyZVRyYWRpbmdFbmFibGVkKHVpbnQyNTYgX3Rva2VuSWQsIGJvb2wgX2VuYWJsZWQpIHB1YmxpYyBvbmx5Q09PIHsKICAgICAgICBzaGFyZVRyYWRpbmdFbmFibGVkW190b2tlbklkXSA9IF9lbmFibGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvbW1pc3Npb25Qb2ludHModWludDI1NiBfcG9pbnQpIHB1YmxpYyBvbmx5Q09PIHsKICAgICAgICByZXF1aXJlKF9wb2ludCA+PSAwICYmIF9wb2ludCA8PSAxMCk7CiAgICAgICAgY29tbWlzc2lvblBvaW50cyA9IF9wb2ludDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb21wYW55KHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIHN0cmluZyBjb21wYW55TmFtZSwKICAgICAgICBib29sIGlzU2hhcmVUcmFkaW5nRW5hYmxlZCwKICAgICAgICB1aW50MjU2IHByaWNlLAogICAgICAgIHVpbnQyNTYgX25leHRQcmljZSwKICAgICAgICBhZGRyZXNzIGNoYWlybWFuLAogICAgICAgIHVpbnQyNTYgY2lyY3VsYXRpb25zCiAgICApIHsKICAgICAgICBDb21wYW55IHN0b3JhZ2UgY29tcGFueSA9IGNvbXBhbmllc1tfdG9rZW5JZF07CiAgICAgICAgY29tcGFueU5hbWUgPSBjb21wYW55Lm5hbWU7CiAgICAgICAgaXNTaGFyZVRyYWRpbmdFbmFibGVkID0gc2hhcmVUcmFkaW5nRW5hYmxlZFtfdG9rZW5JZF07CiAgICAgICAgcHJpY2UgPSBjb21wYW55SW5kZXhUb1ByaWNlW190b2tlbklkXTsKICAgICAgICBfbmV4dFByaWNlID0gbmV4dFByaWNlKF90b2tlbklkLCBwcmljZSk7CiAgICAgICAgY2hhaXJtYW4gPSBjb21wYW55SW5kZXhUb0NoYWlybWFuW190b2tlbklkXTsKICAgICAgICBjaXJjdWxhdGlvbnMgPSBjaXJjdWxhdGlvbkNvdW50ZXJzW190b2tlbklkXTsKICAgIH0KCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIE5BTUU7CiAgICB9CgogICAgZnVuY3Rpb24gc2hhcmVIb2xkZXJzT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzc1tdIG1lbW9yeSBhZGRycywgdWludDI1NltdIG1lbW9yeSBzaGFyZXMpIHsKICAgICAgICBhZGRycyA9IG5ldyBhZGRyZXNzW10oZmlmb1tfdG9rZW5JZF0uc2l6ZSk7CiAgICAgICAgc2hhcmVzID0gbmV3IHVpbnQyNTZbXShmaWZvW190b2tlbklkXS5zaXplKTsKCiAgICAgICAgdWludDI1NiBmaWZvS2V5ID0gRmlmb0xpYi5uZXh0KGZpZm9bX3Rva2VuSWRdLCBIRUFEKTsKICAgICAgICB1aW50MjU2IGk7CiAgICAgICAgd2hpbGUgKGZpZm9LZXkgIT0gSEVBRCkgewogICAgICAgICAgICBhZGRyc1tpXSA9IGZpZm9TdG9yYWdlW190b2tlbklkXVtmaWZvS2V5XS5vd25lcjsKICAgICAgICAgICAgc2hhcmVzW2ldID0gZmlmb1N0b3JhZ2VbX3Rva2VuSWRdW2ZpZm9LZXldLnNoYXJlczsKICAgICAgICAgICAgZmlmb0tleSA9IEZpZm9MaWIubmV4dChmaWZvW190b2tlbklkXSwgZmlmb0tleSk7CiAgICAgICAgICAgIGkrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChhZGRycywgc2hhcmVzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFpcm1hbk9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3MgY2hhaXJtYW4pCiAgICB7CiAgICAgICAgY2hhaXJtYW4gPSBjb21wYW55SW5kZXhUb0NoYWlybWFuW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKGNoYWlybWFuICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNoYXJlc093bmVkKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHNoYXJlcykgewogICAgICAgIHJldHVybiBjb21wYW55SW5kZXhUb093bmVyc1tfdG9rZW5JZF1bX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXlvdXQoYWRkcmVzcyBfdG8pIHB1YmxpYyBvbmx5Q0xldmVsIHsKICAgICAgICBfcGF5b3V0KF90byk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJpY2VPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHByaWNlKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhbnlJbmRleFRvUHJpY2VbX3Rva2VuSWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIHB1YmxpYyBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNlb0FkZHJlc3MgPSBfbmV3Q0VPOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIHB1YmxpYyBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNvb0FkZHJlc3MgPSBfbmV3Q09POwogICAgfQoKICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBTWU1CT0w7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxDb21wYW5pZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhbmllcy5sZW5ndGg7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9hZGRyZXNzTm90TnVsbChhZGRyZXNzIF90bykgcHJpdmF0ZSBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gX3RvICE9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgLy8vIEZvciBjcmVhdGluZyBDb21wYW55CiAgICBmdW5jdGlvbiBfY3JlYXRlQ29tcGFueShzdHJpbmcgX25hbWUsIGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9wcmljZSkgcHJpdmF0ZSB7CiAgICAgICAgcmVxdWlyZShfcHJpY2UgJSAxMDAgPT0gMCk7CgogICAgICAgIENvbXBhbnkgbWVtb3J5IF9jb21wYW55ID0gQ29tcGFueSh7CiAgICAgICAgICAgIG5hbWU6IF9uYW1lCiAgICAgICAgfSk7CiAgICAgICAgdWludDI1NiBuZXdDb21wYW55SWQgPSBjb21wYW5pZXMucHVzaChfY29tcGFueSkgLSAxOwoKICAgICAgICAvLyBJdCdzIHByb2JhYmx5IG5ldmVyIGdvaW5nIHRvIGhhcHBlbiwgNCBiaWxsaW9uIHRva2VucyBhcmUgQSBMT1QsIGJ1dAogICAgICAgIC8vIGxldCdzIGp1c3QgYmUgMTAwJSBzdXJlIHdlIG5ldmVyIGxldCB0aGlzIGhhcHBlbi4KICAgICAgICByZXF1aXJlKG5ld0NvbXBhbnlJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdDb21wYW55SWQpKSk7CgogICAgICAgIEZvdW5kZWQobmV3Q29tcGFueUlkLCBfbmFtZSwgX293bmVyLCBfcHJpY2UpOwoKICAgICAgICBjb21wYW55SW5kZXhUb1ByaWNlW25ld0NvbXBhbnlJZF0gPSBfcHJpY2U7CgogICAgICAgIF90cmFuc2ZlcihhZGRyZXNzKDApLCBfb3duZXIsIG5ld0NvbXBhbnlJZCwgVE9UQUxfU0hBUkVTKTsKICAgIH0KCiAgICAvLy8gQ2hlY2sgZm9yIHRva2VuIG93bmVyc2hpcAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBjbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfc2hhcmVzKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjb21wYW55SW5kZXhUb093bmVyc1tfdG9rZW5JZF1bY2xhaW1hbnRdID49IF9zaGFyZXM7CiAgICB9CgogICAgLy8vIEZvciBwYXlpbmcgb3V0IGJhbGFuY2Ugb24gY29udHJhY3QKICAgIGZ1bmN0aW9uIF9wYXlvdXQoYWRkcmVzcyBfdG8pIHByaXZhdGUgewogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBjZW9BZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9wdXJjaGFzZVByb2Nlc3NGaWZvSXRlbSh1aW50MjU2IF90b2tlbklkLCBIb2xkaW5nIHN0b3JhZ2UgX2hvbGRpbmcsIHVpbnQyNTYgX3NoYXJlc1RvRnVsZmlsbCkKICAgICAgICBwcml2YXRlCiAgICAgICAgcmV0dXJucyAodWludDI1NiBzaGFyZXNGdWxmaWxsZWQsIHVpbnQyNTYgcGF5bWVudCkgewoKICAgICAgICBzaGFyZXNGdWxmaWxsZWQgPSBNYXRoLm1pbihfaG9sZGluZy5zaGFyZXMsIF9zaGFyZXNUb0Z1bGZpbGwpOwoKICAgICAgICAvLyB1bmRlcmZsb3cgaXMgbm90IHBvc3NpYmxlIGJlY2F1c2UgZGVjdXRpb24gaXMgdGhlIG1pbmltdW4gb2YgdGhlIHR3bwogICAgICAgIF9ob2xkaW5nLnNoYXJlcyAtPSBzaGFyZXNGdWxmaWxsZWQ7CgogICAgICAgIGNvbXBhbnlJbmRleFRvT3duZXJzW190b2tlbklkXVtfaG9sZGluZy5vd25lcl0gPSBTYWZlTWF0aC5zdWIoY29tcGFueUluZGV4VG9Pd25lcnNbX3Rva2VuSWRdW19ob2xkaW5nLm93bmVyXSwgc2hhcmVzRnVsZmlsbGVkKTsKCiAgICAgICAgdWludDI1NiBjdXJyZW50VGllckxlZnQgPSBTYWZlTWF0aC5zdWIoVE9UQUxfU0hBUkVTLCBjaXJjdWxhdGlvbkNvdW50ZXJzW190b2tlbklkXSAlIFRPVEFMX1NIQVJFUyk7CiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2VTaGFyZXMgPSBNYXRoLm1pbihjdXJyZW50VGllckxlZnQsIHNoYXJlc0Z1bGZpbGxlZCk7CiAgICAgICAgcGF5bWVudCA9IFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoY29tcGFueUluZGV4VG9QcmljZVtfdG9rZW5JZF0sIGN1cnJlbnRQcmljZVNoYXJlcyksIFRPVEFMX1NIQVJFUyk7CgogICAgICAgIFNoYXJlc1NvbGQoX3Rva2VuSWQsIGN1cnJlbnRQcmljZVNoYXJlcywgY29tcGFueUluZGV4VG9QcmljZVtfdG9rZW5JZF0sIF9ob2xkaW5nLm93bmVyLCBtc2cuc2VuZGVyLCBjb21wYW5pZXNbX3Rva2VuSWRdLm5hbWUpOwoKICAgICAgICBpZiAoc2hhcmVzRnVsZmlsbGVkID49IGN1cnJlbnRUaWVyTGVmdCkgewogICAgICAgICAgICB1aW50MjU2IG5ld1ByaWNlID0gbmV4dFByaWNlKF90b2tlbklkLCBjb21wYW55SW5kZXhUb1ByaWNlW190b2tlbklkXSk7CiAgICAgICAgICAgIGNvbXBhbnlJbmRleFRvUHJpY2VbX3Rva2VuSWRdID0gbmV3UHJpY2U7CgogICAgICAgICAgICBpZiAoc2hhcmVzRnVsZmlsbGVkID4gY3VycmVudFRpZXJMZWZ0KSB7CiAgICAgICAgICAgICAgICB1aW50MjU2IG5ld1ByaWNlU2hhcmVzID0gc2hhcmVzRnVsZmlsbGVkIC0gY3VycmVudFRpZXJMZWZ0OwogICAgICAgICAgICAgICAgcGF5bWVudCArPSBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKG5ld1ByaWNlLCBuZXdQcmljZVNoYXJlcyksIFRPVEFMX1NIQVJFUyk7CiAgICAgICAgICAgICAgICBTaGFyZXNTb2xkKF90b2tlbklkLCBuZXdQcmljZVNoYXJlcywgbmV3UHJpY2UsIF9ob2xkaW5nLm93bmVyLCBtc2cuc2VuZGVyLCBjb21wYW5pZXNbX3Rva2VuSWRdLm5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjaXJjdWxhdGlvbkNvdW50ZXJzW190b2tlbklkXSA9IFNhZmVNYXRoLmFkZChjaXJjdWxhdGlvbkNvdW50ZXJzW190b2tlbklkXSwgc2hhcmVzRnVsZmlsbGVkKTsKCiAgICAgICAgLy8gbm8gbmVlZCB0byB0cmFuc2ZlciBpZiBzZWxsZXIgaXMgdGhlIGNvbnRyYWN0CiAgICAgICAgaWYgKF9ob2xkaW5nLm93bmVyICE9IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgX2hvbGRpbmcub3duZXIudHJhbnNmZXIoU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChwYXltZW50LCAxMDAgLSBjb21taXNzaW9uUG9pbnRzKSwgMTAwKSk7CiAgICAgICAgfQoKICAgICAgICBUcmFuc2ZlcihfaG9sZGluZy5vd25lciwgbXNnLnNlbmRlciwgX3Rva2VuSWQsIHNoYXJlc0Z1bGZpbGxlZCk7CiAgICB9CgogICAgZnVuY3Rpb24gX3B1cmNoYXNlTG9vcEZpZm8odWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfc2hhcmVzVG9GdWxmaWxsKQogICAgICAgIHByaXZhdGUKICAgICAgICByZXR1cm5zICh1aW50MjU2IHNoYXJlc0Z1bGZpbGxlZCwgdWludDI1NiB0b3RhbFBheW1lbnQpIHsKICAgICAgICB1aW50MjU2IHByZXZGaWZvS2V5ID0gSEVBRDsKICAgICAgICB1aW50MjU2IGZpZm9LZXkgPSBGaWZvTGliLm5leHQoZmlmb1tfdG9rZW5JZF0sIEhFQUQpOwogICAgICAgIHdoaWxlIChmaWZvS2V5ICE9IEhFQUQpIHsKICAgICAgICAgICAgSG9sZGluZyBzdG9yYWdlIGhvbGRpbmcgPSBmaWZvU3RvcmFnZVtfdG9rZW5JZF1bZmlmb0tleV07CgogICAgICAgICAgICBhc3NlcnQoaG9sZGluZy5zaGFyZXMgPiAwKTsKCiAgICAgICAgICAgIGlmIChob2xkaW5nLm93bmVyICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaXRlbVNoYXJlc0Z1bGZpbGxlZDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaXRlbVBheW1lbnQ7CiAgICAgICAgICAgICAgICAoaXRlbVNoYXJlc0Z1bGZpbGxlZCwgaXRlbVBheW1lbnQpID0gX3B1cmNoYXNlUHJvY2Vzc0ZpZm9JdGVtKF90b2tlbklkLCBob2xkaW5nLCBTYWZlTWF0aC5zdWIoX3NoYXJlc1RvRnVsZmlsbCwgc2hhcmVzRnVsZmlsbGVkKSk7CgogICAgICAgICAgICAgICAgc2hhcmVzRnVsZmlsbGVkICs9IGl0ZW1TaGFyZXNGdWxmaWxsZWQ7CiAgICAgICAgICAgICAgICB0b3RhbFBheW1lbnQgKz0gaXRlbVBheW1lbnQ7CgogICAgICAgICAgICAgICAgaWYgKGhvbGRpbmcuc2hhcmVzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgdGhlIHJlY29yZCBmcm9tIGZpZm8KICAgICAgICAgICAgICAgICAgICBGaWZvTGliLnJlbW92ZShmaWZvW190b2tlbklkXSwgcHJldkZpZm9LZXksIGZpZm9LZXkpOwogICAgICAgICAgICAgICAgICAgIGZpZm9LZXkgPSBwcmV2Rmlmb0tleTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNoYXJlc0Z1bGZpbGxlZCA9PSBfc2hhcmVzVG9GdWxmaWxsKSBicmVhazsKCiAgICAgICAgICAgIHByZXZGaWZvS2V5ID0gZmlmb0tleTsKICAgICAgICAgICAgZmlmb0tleSA9IEZpZm9MaWIubmV4dChmaWZvW190b2tlbklkXSwgZmlmb0tleSk7CiAgICAgICAgfSAgCiAgICB9CgogICAgZnVuY3Rpb24gcHVyY2hhc2UodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfc2hhcmVzKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShfc2hhcmVzVmFsaWQoX3Rva2VuSWQsIF9zaGFyZXMpKTsKICAgICAgICByZXF1aXJlKGNvbXBhbnlJbmRleFRvT3duZXJzW190b2tlbklkXVttc2cuc2VuZGVyXSArIF9zaGFyZXMgPD0gVE9UQUxfU0hBUkVTKTsKCiAgICAgICAgdWludDI1NiBlc3RpbWF0ZWRQYXltZW50ID0gZXN0aW1hdGVQdXJjaGFzZVBheW1lbnQoX3Rva2VuSWQsIF9zaGFyZXMpOwoKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBlc3RpbWF0ZWRQYXltZW50KTsKCiAgICAgICAgdWludDI1NiBzaGFyZXNGdWxmaWxsZWQ7CiAgICAgICAgdWludDI1NiB0b3RhbFBheW1lbnQ7CiAgICAgICAgKHNoYXJlc0Z1bGZpbGxlZCwgdG90YWxQYXltZW50KSA9IF9wdXJjaGFzZUxvb3BGaWZvKF90b2tlbklkLCBfc2hhcmVzKTsKCiAgICAgICAgYXNzZXJ0KHNoYXJlc0Z1bGZpbGxlZCA9PSBfc2hhcmVzKTsKICAgICAgICBhc3NlcnQodG90YWxQYXltZW50ID09IGVzdGltYXRlZFBheW1lbnQpOwoKICAgICAgICB1aW50MjU2IHB1cmNoYXNlRXhlc3MgPSBTYWZlTWF0aC5zdWIobXNnLnZhbHVlLCB0b3RhbFBheW1lbnQpOwogICAgICAgIGFzc2VydChwdXJjaGFzZUV4ZXNzID49IDApOwoKICAgICAgICBpZiAocHVyY2hhc2VFeGVzcyA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihwdXJjaGFzZUV4ZXNzKTsKICAgICAgICB9CgogICAgICAgIGZpZm9TdG9yYWdlW190b2tlbklkXVtGaWZvTGliLnB1c2hUYWlsKGZpZm9bX3Rva2VuSWRdLCBfbmV4dEZpZm9TdG9yYWdlS2V5KF90b2tlbklkKSldID0gSG9sZGluZyh7b3duZXI6IG1zZy5zZW5kZXIsIHNoYXJlczogX3NoYXJlc30pOwoKICAgICAgICBjb21wYW55SW5kZXhUb093bmVyc1tfdG9rZW5JZF1bbXNnLnNlbmRlcl0gKz0gX3NoYXJlczsKCiAgICAgICAgaWYgKGNvbXBhbnlJbmRleFRvT3duZXJzW190b2tlbklkXVttc2cuc2VuZGVyXSA+IGNvbXBhbnlJbmRleFRvT3duZXJzW190b2tlbklkXVtjb21wYW55SW5kZXhUb0NoYWlybWFuW190b2tlbklkXV0pIHsKICAgICAgICAgICAgY29tcGFueUluZGV4VG9DaGFpcm1hbltfdG9rZW5JZF0gPSBtc2cuc2VuZGVyOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBlc3RpbWF0ZVB1cmNoYXNlUGF5bWVudCh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF9zaGFyZXMpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9zaGFyZXMgPD0gVE9UQUxfU0hBUkVTKTsKCiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2UgPSBjb21wYW55SW5kZXhUb1ByaWNlW190b2tlbklkXTsKCiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2VTaGFyZXMgPSBNYXRoLm1pbihfc2hhcmVzLCBUT1RBTF9TSEFSRVMgLSBjaXJjdWxhdGlvbkNvdW50ZXJzW190b2tlbklkXSAlIFRPVEFMX1NIQVJFUyk7CiAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmFkZCgKICAgICAgICAgICAgU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChjdXJyZW50UHJpY2UsIGN1cnJlbnRQcmljZVNoYXJlcyksIFRPVEFMX1NIQVJFUyksCiAgICAgICAgICAgIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwobmV4dFByaWNlKF90b2tlbklkLCBjdXJyZW50UHJpY2UpLCBfc2hhcmVzIC0gY3VycmVudFByaWNlU2hhcmVzKSwgVE9UQUxfU0hBUkVTKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gbmV4dFByaWNlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2N1cnJlbnRQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgcHJpY2U7CiAgICAgICAgaWYgKF9jdXJyZW50UHJpY2UgPCBmaXJzdFN0ZXBMaW1pdCkgewogICAgICAgICAgLy8gZmlyc3Qgc3RhZ2UKICAgICAgICAgIHByaWNlID0gU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChfY3VycmVudFByaWNlLCAyMDApLCAxMDApOwogICAgICAgIH0gZWxzZSBpZiAoX2N1cnJlbnRQcmljZSA8IHNlY29uZFN0ZXBMaW1pdCkgewogICAgICAgICAgLy8gc2Vjb25kIHN0YWdlCiAgICAgICAgICBwcmljZSA9IFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoX2N1cnJlbnRQcmljZSwgMTIwKSwgMTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gdGhpcmQgc3RhZ2UKICAgICAgICAgIHByaWNlID0gU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChfY3VycmVudFByaWNlLCAxMTUpLCAxMDApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHByaWNlIC0gcHJpY2UgJSAxMDA7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zaGFyZXMKICAgICkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChfdG8pKTsKICAgICAgICByZXF1aXJlKF9zaGFyZXNWYWxpZChfdG9rZW5JZCwgX3NoYXJlcykpOwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQsIF9zaGFyZXMpKTsKCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQsIF9zaGFyZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUNvbnRyYWN0KAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc2hhcmVzCiAgICApIHB1YmxpYyBvbmx5Q09PIHsKICAgICAgICBhZGRyZXNzIGZyb20gPSBhZGRyZXNzKHRoaXMpOwogICAgICAgIHJlcXVpcmUoX2FkZHJlc3NOb3ROdWxsKF90bykpOwogICAgICAgIHJlcXVpcmUoX3NoYXJlc1ZhbGlkKF90b2tlbklkLCBfc2hhcmVzKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhmcm9tLCBfdG9rZW5JZCwgX3NoYXJlcykpOwoKICAgICAgICBfdHJhbnNmZXIoZnJvbSwgX3RvLCBfdG9rZW5JZCwgX3NoYXJlcyk7CiAgICB9CgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF9zaGFyZXMpIHByaXZhdGUgewogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHVpbnQyNTYgc2hhcmVzVG9GdWxmaWxsID0gX3NoYXJlczsKCiAgICAgICAgICAgIHVpbnQyNTYgZmlmb0tleSA9IEZpZm9MaWIubmV4dChmaWZvW190b2tlbklkXSwgSEVBRCk7CiAgICAgICAgICAgIHdoaWxlIChmaWZvS2V5ICE9IEhFQUQpIHsKICAgICAgICAgICAgICAgIEhvbGRpbmcgc3RvcmFnZSBob2xkaW5nID0gZmlmb1N0b3JhZ2VbX3Rva2VuSWRdW2ZpZm9LZXldOwoKICAgICAgICAgICAgICAgIGFzc2VydChob2xkaW5nLnNoYXJlcyA+IDApOwoKICAgICAgICAgICAgICAgIGlmIChob2xkaW5nLm93bmVyID09IF9mcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgdWludDI1NiBmdWxmaWxsZWQgPSBNYXRoLm1pbihob2xkaW5nLnNoYXJlcywgc2hhcmVzVG9GdWxmaWxsKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGhvbGRpbmcuc2hhcmVzID09IGZ1bGZpbGxlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBhbGwgc2hhcmVzIGFyZSB0YWtlbiwganVzdCBtb2RpZnkgdGhlIG93bmVyIGFkZHJlc3MgaW4gcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgaG9sZGluZy5vd25lciA9IF90bzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB1bmRlcmZsb3cgaXMgbm90IHBvc3NpYmxlIGJlY2F1c2UgZGVkdWN0aW9uIGlzIHRoZSBtaW5pbXVuIG9mIHRoZSB0d28KICAgICAgICAgICAgICAgICAgICAgICAgaG9sZGluZy5zaGFyZXMgLT0gZnVsZmlsbGVkOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IGEgbmV3IGhvbGRpbmcgcmVjb3JkCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZm9TdG9yYWdlW190b2tlbklkXVtGaWZvTGliLmluc2VydChmaWZvW190b2tlbklkXSwgZmlmb0tleSwgX25leHRGaWZvU3RvcmFnZUtleShfdG9rZW5JZCkpXSA9IEhvbGRpbmcoe293bmVyOiBfdG8sIHNoYXJlczogZnVsZmlsbGVkfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBmaWZvS2V5ID0gRmlmb0xpYi5uZXh0KGZpZm9bX3Rva2VuSWRdLCBmaWZvS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm93IGZpZm9LZXkgcG9pbnRzIHRvIHRoZSBuZXdseSBpbnNlcnRlZCBvbmUgCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB1bmRlcmZsb3cgaXMgbm90IHBvc3NpYmxlIGJlY2F1c2UgZGVkdWN0aW9uIGlzIHRoZSBtaW5pbXVuIG9mIHRoZSB0d28KICAgICAgICAgICAgICAgICAgICBzaGFyZXNUb0Z1bGZpbGwgLT0gZnVsZmlsbGVkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzaGFyZXNUb0Z1bGZpbGwgPT0gMCkgYnJlYWs7CgogICAgICAgICAgICAgICAgZmlmb0tleSA9IEZpZm9MaWIubmV4dChmaWZvW190b2tlbklkXSwgZmlmb0tleSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlcXVpcmUoc2hhcmVzVG9GdWxmaWxsID09IDApOwoKICAgICAgICAgICAgY29tcGFueUluZGV4VG9Pd25lcnNbX3Rva2VuSWRdW19mcm9tXSAtPSBfc2hhcmVzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGdlbmVzaXMgdHJhbnNmZXIKICAgICAgICAgICAgZmlmb1N0b3JhZ2VbX3Rva2VuSWRdW0ZpZm9MaWIucHVzaFRhaWwoZmlmb1tfdG9rZW5JZF0sIF9uZXh0Rmlmb1N0b3JhZ2VLZXkoX3Rva2VuSWQpKV0gPSBIb2xkaW5nKHtvd25lcjogX3RvLCBzaGFyZXM6IF9zaGFyZXN9KTsKICAgICAgICB9CgogICAgICAgIGNvbXBhbnlJbmRleFRvT3duZXJzW190b2tlbklkXVtfdG9dICs9IF9zaGFyZXM7CgogICAgICAgIGlmIChjb21wYW55SW5kZXhUb093bmVyc1tfdG9rZW5JZF1bX3RvXSA+IGNvbXBhbnlJbmRleFRvT3duZXJzW190b2tlbklkXVtjb21wYW55SW5kZXhUb0NoYWlybWFuW190b2tlbklkXV0pIHsKICAgICAgICAgICAgY29tcGFueUluZGV4VG9DaGFpcm1hbltfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgfQoKICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCwgX3NoYXJlcyk7CiAgICB9CgogICAgZnVuY3Rpb24gX3NoYXJlc1ZhbGlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3NoYXJlcykgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9zaGFyZXMgPiAwICYmIF9zaGFyZXMgPD0gVE9UQUxfU0hBUkVTKSAmJgogICAgICAgICAgICAoc2hhcmVUcmFkaW5nRW5hYmxlZFtfdG9rZW5JZF0gfHwgX3NoYXJlcyA9PSBUT1RBTF9TSEFSRVMpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9uZXh0Rmlmb1N0b3JhZ2VLZXkodWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuICsrZmlmb1N0b3JhZ2VLZXlbX3Rva2VuSWRdOwogICAgfQp9CgoKbGlicmFyeSBTYWZlTWF0aCB7CgogICAgLyoqCiAgICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICAgKi8KICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICAgKi8KICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgICAqLwogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICAgKi8KICAgIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCmxpYnJhcnkgTWF0aCB7CiAgICBmdW5jdGlvbiBtYXgodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID4gYikgcmV0dXJuIGE7CiAgICAgICAgZWxzZSByZXR1cm4gYjsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPCBiKSByZXR1cm4gYTsKICAgICAgICBlbHNlIHJldHVybiBiOwogICAgfQp9'.
	

]
