Class {
	#name : #SRT6fff3806bbac52a20e0d79bc538d527f6a22c96b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6fff3806bbac52a20e0d79bc538d527f6a22c96b >> base64 [
	^ 'Ly8vIGF1dGguc29sIC0tIHdpZGVseS11c2VkIGFjY2VzcyBjb250cm9sIHBhdHRlcm4gZm9yIEV0aGVyZXVtCgovLyBDb3B5cmlnaHQgKEMpIDIwMTUsIDIwMTYsIDIwMTcgIERhcHBIdWIsIExMQwoKLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIikuCi8vIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQgKGV4cHJlc3Mgb3IgaW1wbGllZCkuCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsKCmNvbnRyYWN0IEF1dGhvcml0eSB7CiAgICBmdW5jdGlvbiBjYW5DYWxsKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgYnl0ZXM0IHNpZykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IEF1dGhFdmVudHMgewogICAgZXZlbnQgTG9nU2V0QXV0aG9yaXR5IChhZGRyZXNzIGluZGV4ZWQgYXV0aG9yaXR5KTsKICAgIGV2ZW50IExvZ1NldE93bmVyICAgICAoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IFVuYXV0aG9yaXplZEFjY2VzcyAoYWRkcmVzcyBjYWxsZXIsIGJ5dGVzNCBzaWcpOwp9Cgpjb250cmFjdCBBdXRoIGlzIEF1dGhFdmVudHMgewogICAgQXV0aG9yaXR5ICBwdWJsaWMgIGF1dGhvcml0eTsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGZ1bmN0aW9uIEF1dGgoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIExvZ1NldE93bmVyKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE93bmVyKGFkZHJlc3Mgb3duZXJfKSBhdXRoIHsKICAgICAgICBvd25lciA9IG93bmVyXzsKICAgICAgICBMb2dTZXRPd25lcihvd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QXV0aG9yaXR5KEF1dGhvcml0eSBhdXRob3JpdHlfKSBhdXRoIHsKICAgICAgICBhdXRob3JpdHkgPSBhdXRob3JpdHlfOwogICAgICAgIExvZ1NldEF1dGhvcml0eShhdXRob3JpdHkpOwogICAgfQoKICAgIG1vZGlmaWVyIGF1dGggewogICAgICAgIHJlcXVpcmUoaXNBdXRob3JpemVkKG1zZy5zZW5kZXIsIG1zZy5zaWcpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQXV0aG9yaXplZChhZGRyZXNzIHNyYywgYnl0ZXM0IHNpZykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzcmMgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNyYyA9PSBvd25lciAmJiBhdXRob3JpdHkgPT0gQXV0aG9yaXR5KDApKSB7CiAgICAgICAgICAgIC8qdGhlIG93bmVyIGhhcyBwcml2aWxlZ2VzIG9ubHkgYXMgbG9uZyBhcyBubyBBdXRob3JpdHkgaGFzIGJlZW4gZGVmaW5lZCovCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoYXV0aG9yaXR5ID09IEF1dGhvcml0eSgwKSkgewogICAgICAgICAgICBVbmF1dGhvcml6ZWRBY2Nlc3Moc3JjLCBzaWcpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eS5jYW5DYWxsKHNyYywgdGhpcywgc2lnKTsKICAgICAgICB9CiAgICB9Cn0KLyoKICAgQ29weXJpZ2h0IDIwMTcgRGFwcEh1YiwgTExDCgogICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCiAgICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCiAgIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCgovLyBUb2tlbiBzdGFuZGFyZCBBUEkKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCgpjb250cmFjdCBFUkMyMEV2ZW50cyB7CiAgICBldmVudCBUcmFuc2ZlciggYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbCggYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwRXZlbnRzewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoIGFkZHJlc3Mgd2hvICkgY29uc3RhbnQgcmV0dXJucyAodWludCB2YWx1ZSk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoIGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlciApIGNvbnN0YW50IHJldHVybnMgKHVpbnQgX2FsbG93YW5jZSk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogICAgZnVuY3Rpb24gYXBwcm92ZSggYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlICkgcmV0dXJucyAoYm9vbCBvayk7Cgp9Ci8vLyBtYXRoLnNvbCAtLSBtaXhpbiBmb3IgaW5saW5lIG51bWVyaWNhbCB3aXphcmRyeQoKLy8gQ29weXJpZ2h0IChDKSAyMDE1LCAyMDE2LCAyMDE3ICBEYXBwSHViLCBMTEMKCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpLgovLyBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5EIChleHByZXNzIG9yIGltcGxpZWQpLgoKY29udHJhY3QgTWF0aCB7CiAgICAKICAgIC8qCiAgICBzdGFuZGFyZCB1aW50MjU2IGZ1bmN0aW9ucwogICAgICovCgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCArIHkpID49IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHogPSB4ICogeTsKICAgICAgICByZXF1aXJlKHogPT0gMCB8fCB6ID49ICh4ID4geSA/IHggOiB5KSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICByZXF1aXJlKHkgPiAwKTsKICAgICAgICB6ID0geCAvIHk7CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBtYXgodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KCiAgICAvKgogICAgdWludDEyOCBmdW5jdGlvbnMgKGggaXMgZm9yIGhhbGYpCiAgICAgKi8KCgogICAgZnVuY3Rpb24gaGFkZCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoc3ViKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHJlcXVpcmUoKHogPSB4ICogeSkgPj0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gaGRpdih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgcmVxdWlyZSh5ID4gMCk7CiAgICAgICAgeiA9IHggLyB5OwogICAgfQoKICAgIGZ1bmN0aW9uIGhtaW4odWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGhtYXgodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KCgogICAgLyoKICAgIGludDI1NiBmdW5jdGlvbnMKICAgICAqLwoKICAgIGZ1bmN0aW9uIGltaW4oaW50MjU2IHgsIGludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChpbnQyNTYgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltYXgoaW50MjU2IHgsIGludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChpbnQyNTYgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KCiAgICAvKgogICAgV0FEIG1hdGgKICAgICAqLwoKICAgIHVpbnQxMjggY29uc3RhbnQgV0FEID0gMTAgKiogMTg7CgogICAgZnVuY3Rpb24gd2FkZCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBoYWRkKHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdzdWIodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaHN1Yih4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiB3bXVsKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0gY2FzdCgodWludDI1Nih4KSAqIHkgKyBXQUQgLyAyKSAvIFdBRCk7CiAgICB9CgogICAgZnVuY3Rpb24gd2Rpdih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgeiA9IGNhc3QoKHVpbnQyNTYoeCkgKiBXQUQgKyB5IC8gMikgLyB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiB3bWluKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhtaW4oeCwgeSk7CiAgICB9CiAgICBmdW5jdGlvbiB3bWF4KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhtYXgoeCwgeSk7CiAgICB9CgogICAgLyoKICAgIFJBWSBtYXRoCiAgICAgKi8KCiAgICB1aW50MTI4IGNvbnN0YW50IFJBWSA9IDEwICoqIDI3OwoKICAgIGZ1bmN0aW9uIHJhZGQodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaGFkZCh4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiByc3ViKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhzdWIoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gcm11bCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgeiA9IGNhc3QoKHVpbnQyNTYoeCkgKiB5ICsgUkFZIC8gMikgLyBSQVkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJkaXYodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSBjYXN0KCh1aW50MjU2KHgpICogUkFZICsgeSAvIDIpIC8geSk7CiAgICB9CgogICAgZnVuY3Rpb24gcnBvdyh1aW50MTI4IHgsIHVpbnQ2NCBuKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICAvLyBUaGlzIGZhbW91cyBhbGdvcml0aG0gaXMgY2FsbGVkICJleHBvbmVudGlhdGlvbiBieSBzcXVhcmluZyIKICAgICAgICAvLyBhbmQgY2FsY3VsYXRlcyB4Xm4gd2l0aCB4IGFzIGZpeGVkLXBvaW50IGFuZCBuIGFzIHJlZ3VsYXIgdW5zaWduZWQuCiAgICAgICAgLy8KICAgICAgICAvLyBJdCdzIE8obG9nIG4pLCBpbnN0ZWFkIG9mIE8obikgZm9yIG5haXZlIHJlcGVhdGVkIG11bHRpcGxpY2F0aW9uLgogICAgICAgIC8vCiAgICAgICAgLy8gVGhlc2UgZmFjdHMgYXJlIHdoeSBpdCB3b3JrczoKICAgICAgICAvLwogICAgICAgIC8vICBJZiBuIGlzIGV2ZW4sIHRoZW4geF5uID0gKHheMileKG4vMikuCiAgICAgICAgLy8gIElmIG4gaXMgb2RkLCAgdGhlbiB4Xm4gPSB4ICogeF4obi0xKSwKICAgICAgICAvLyAgIGFuZCBhcHBseWluZyB0aGUgZXF1YXRpb24gZm9yIGV2ZW4geCBnaXZlcwogICAgICAgIC8vICAgIHhebiA9IHggKiAoeF4yKV4oKG4tMSkgLyAyKS4KICAgICAgICAvLwogICAgICAgIC8vICBBbHNvLCBFVk0gZGl2aXNpb24gaXMgZmxvb3JpbmcgYW5kCiAgICAgICAgLy8gICAgZmxvb3JbKG4tMSkgLyAyXSA9IGZsb29yW24gLyAyXS4KCiAgICAgICAgeiA9IG4gJSAyICE9IDAgPyB4IDogUkFZOwoKICAgICAgICBmb3IgKG4gLz0gMjsgbiAhPSAwOyBuIC89IDIpIHsKICAgICAgICAgICAgeCA9IHJtdWwoeCwgeCk7CgogICAgICAgICAgICBpZiAobiAlIDIgIT0gMCkgewogICAgICAgICAgICAgICAgeiA9IHJtdWwoeiwgeCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcm1pbih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBobWluKHgsIHkpOwogICAgfQogICAgZnVuY3Rpb24gcm1heCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBobWF4KHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhc3QodWludDI1NiB4KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0gdWludDEyOCh4KSkgPT0geCk7CiAgICB9Cgp9Cgpjb250cmFjdCBNaWdyYXRpb25zIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICB1aW50IHB1YmxpYyBsYXN0X2NvbXBsZXRlZF9taWdyYXRpb247CgogIG1vZGlmaWVyIHJlc3RyaWN0ZWQoKSB7CiAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgXzsKICB9CgogIGZ1bmN0aW9uIE1pZ3JhdGlvbnMoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBmdW5jdGlvbiBzZXRDb21wbGV0ZWQodWludCBjb21wbGV0ZWQpIHJlc3RyaWN0ZWQgewogICAgbGFzdF9jb21wbGV0ZWRfbWlncmF0aW9uID0gY29tcGxldGVkOwogIH0KCiAgZnVuY3Rpb24gdXBncmFkZShhZGRyZXNzIG5ld19hZGRyZXNzKSByZXN0cmljdGVkIHsKICAgIE1pZ3JhdGlvbnMgdXBncmFkZWQgPSBNaWdyYXRpb25zKG5ld19hZGRyZXNzKTsKICAgIHVwZ3JhZGVkLnNldENvbXBsZXRlZChsYXN0X2NvbXBsZXRlZF9taWdyYXRpb24pOwogIH0KfQovLy8gbm90ZS5zb2wgLS0gdGhlIGBub3RlJyBtb2RpZmllciwgZm9yIGxvZ2dpbmcgY2FsbHMgYXMgZXZlbnRzCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhcHBIdWIsIExMQwovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4KLy8gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLwovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5EIChleHByZXNzIG9yIGltcGxpZWQpLgoKCmNvbnRyYWN0IE5vdGUgewogICAgZXZlbnQgTG9nTm90ZSgKICAgICAgICBieXRlczQgICBpbmRleGVkIHNpZywKICAgICAgICBhZGRyZXNzICBpbmRleGVkIGd1eSwKICAgICAgICBieXRlczMyICBpbmRleGVkIGZvbywKICAgICAgICBieXRlczMyICBpbmRleGVkIGJhciwKICAgICAgICB1aW50IHdhZCwKICAgICAgICBieXRlcyBmYXgKICAgICkgYW5vbnltb3VzOwoKICAgIG1vZGlmaWVyIG5vdGUgewogICAgICAgIGJ5dGVzMzIgZm9vOwogICAgICAgIGJ5dGVzMzIgYmFyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgZm9vIDo9IGNhbGxkYXRhbG9hZCg0KQogICAgICAgIGJhciA6PSBjYWxsZGF0YWxvYWQoMzYpCiAgICAgICAgfQoKICAgICAgICBMb2dOb3RlKG1zZy5zaWcsIG1zZy5zZW5kZXIsIGZvbywgYmFyLCBtc2cudmFsdWUsIG1zZy5kYXRhKTsKCiAgICAgICAgXzsKICAgIH0KfQovLy8gc3RvcC5zb2wgLS0gbWl4aW4gZm9yIGVuYWJsZS9kaXNhYmxlIGZ1bmN0aW9uYWxpdHkKCi8vIENvcHlyaWdodCAoQykgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4KLy8gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCAoZXhwcmVzcyBvciBpbXBsaWVkKS4KCgpjb250cmFjdCBTdG9wcGFibGUgaXMgQXV0aCwgTm90ZSB7CgogICAgYm9vbCBwdWJsaWMgc3RvcHBlZDsKCiAgICBtb2RpZmllciBzdG9wcGFibGUgewogICAgICAgIHJlcXVpcmUgKCFzdG9wcGVkKTsKICAgICAgICBfOwogICAgfQogICAgZnVuY3Rpb24gc3RvcCgpIGF1dGggbm90ZSB7CiAgICAgICAgc3RvcHBlZCA9IHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBzdGFydCgpIGF1dGggbm90ZSB7CiAgICAgICAgc3RvcHBlZCA9IGZhbHNlOwogICAgfQoKfS8vIHRva2VuLnNvbCAtLSBFUkMyMCBpbXBsZW1lbnRhdGlvbiB3aXRoIG1pbnRpbmcgYW5kIGJ1cm5pbmcKCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4KLy8gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCAoZXhwcmVzcyBvciBpbXBsaWVkKS4KCgpjb250cmFjdCBUb2tlbiBpcyBFUkMyMCwgU3RvcHBhYmxlIHsKCiAgICBieXRlczMyIHB1YmxpYyBzeW1ib2w7ICAgIAogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAvLyBPcHRpb25hbCB0b2tlbiBuYW1lCiAgICB1aW50MjU2IHB1YmxpYyBkZWNpbWFscyA9IDE4OyAvLyBzdGFuZGFyZCB0b2tlbiBwcmVjaXNpb24uIG92ZXJyaWRlIHRvIGN1c3RvbWl6ZQogICAgVG9rZW5Mb2dpYyBwdWJsaWMgbG9naWM7CgogICAgZnVuY3Rpb24gVG9rZW4oc3RyaW5nIG5hbWVfLCBieXRlczMyIHN5bWJvbF8pIHsKICAgICAgICBuYW1lID0gbmFtZV87CiAgICAgICAgc3ltYm9sID0gc3ltYm9sXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRMb2dpYyhUb2tlbkxvZ2ljIGxvZ2ljXykgYXV0aCBub3RlIHJldHVybnMoYm9vbCl7CiAgICAgICAgbG9naWMgPSBsb2dpY187CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pIGF1dGggewogICAgICAgIHVpbnQgd2FkID0gYmFsYW5jZU9mKG93bmVyKTsKICAgICAgICBsb2dpYy50cmFuc2Zlcihvd25lciwgb3duZXJfLCB3YWQpOwogICAgICAgIFRyYW5zZmVyKG93bmVyLCBvd25lcl8sIHdhZCk7CiAgICAgICAgbG9naWMuc2V0T3duZXIob3duZXJfKTsKICAgICAgICBzdXBlci5zZXRPd25lcihvd25lcl8pOwogICAgfQoKCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJldHVybiBsb2dpYy50b3RhbFN1cHBseSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBjb25zdGFudCByZXR1cm5zICh1aW50IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIGxvZ2ljLmJhbGFuY2VPZih3aG8pOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZSggYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyICkgY29uc3RhbnQgcmV0dXJucyAodWludCBfYWxsb3dhbmNlKSB7CiAgICAgICAgcmV0dXJuIGxvZ2ljLmFsbG93YW5jZShvd25lciwgc3BlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBzdG9wcGFibGUgbm90ZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCByZXRWYWwgPSBsb2dpYy50cmFuc2Zlcihtc2cuc2VuZGVyLCBkc3QsIHdhZCk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgZHN0LCB3YWQpOwogICAgICAgIHJldHVybiByZXRWYWw7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBzdG9wcGFibGUgbm90ZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCByZXRWYWwgPSBsb2dpYy50cmFuc2ZlckZyb20oc3JjLCBkc3QsIHdhZCk7CiAgICAgICAgVHJhbnNmZXIoc3JjLCBkc3QsIHdhZCk7CiAgICAgICAgcmV0dXJuIHJldFZhbDsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgZ3V5LCB1aW50IHdhZCkgc3RvcHBhYmxlIG5vdGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBsb2dpYy5hcHByb3ZlKG1zZy5zZW5kZXIsIGd1eSwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoKGFkZHJlc3MgZHN0LCB1aW50MTI4IHdhZCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cmFuc2Zlcihkc3QsIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHVsbChhZGRyZXNzIHNyYywgdWludDEyOCB3YWQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJGcm9tKHNyYywgbXNnLnNlbmRlciwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50KHVpbnQxMjggd2FkKSBhdXRoIHN0b3BwYWJsZSBub3RlIHsKICAgICAgICBsb2dpYy5taW50KHdhZCk7CiAgICAgICAgVHJhbnNmZXIodGhpcywgbXNnLnNlbmRlciwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXJuKHVpbnQxMjggd2FkKSBhdXRoIHN0b3BwYWJsZSBub3RlIHsKICAgICAgICBsb2dpYy5idXJuKG1zZy5zZW5kZXIsIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TmFtZShzdHJpbmcgbmFtZV8pIGF1dGggewogICAgICAgIG5hbWUgPSBuYW1lXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRTeW1ib2woYnl0ZXMzMiBzeW1ib2xfKSBhdXRoIHsKICAgICAgICBzeW1ib2wgPSBzeW1ib2xfOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgdWludCB3YWQgPSBsb2dpYy5oYW5kbGVQYXltZW50KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIodGhpcywgbXNnLnNlbmRlciwgd2FkKTsKICAgIH0KCi8qc3BlY2lhbCBmdW5jdGlvbnMgZm9yIElDTyovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckV0aChhZGRyZXNzIGRzdCwgdWludCB3YWQpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhsb2dpYykpOwogICAgICAgIHJlcXVpcmUod2FkIDwgdGhpcy5iYWxhbmNlKTsKICAgICAgICBkc3QudHJhbnNmZXIod2FkKTsKICAgIH0KCi8qdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZnJvbSBsb2dpYyB0byB0cmlnZ2VyIHRoZSBjb3JyZWN0IGV2ZW50IHVwb24gcmVjZWl2aW5nIEVUSCovCiAgICBmdW5jdGlvbiB0cmlnZ2VyVGFuc2ZlckV2ZW50KGFkZHJlc3Mgc3JjLCAgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MobG9naWMpKTsKICAgICAgICBUcmFuc2ZlcihzcmMsIGRzdCwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXlvdXQoYWRkcmVzcyBkc3QpIGF1dGggewogICAgICAgIHJlcXVpcmUoZHN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGRzdC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKfQoKY29udHJhY3QgVG9rZW5EYXRhIGlzIEF1dGggewogICAgdWludDI1NiBwdWJsaWMgc3VwcGx5OwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhcHByb3ZhbHM7CiAgICBhZGRyZXNzIHRva2VuOwoKICAgIG1vZGlmaWVyIHRva2VuT25seSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gdG9rZW4pOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gVG9rZW5EYXRhKGFkZHJlc3MgdG9rZW5fLCB1aW50IHN1cHBseV8sIGFkZHJlc3Mgb3duZXJfKSB7CiAgICAgICAgdG9rZW4gPSB0b2tlbl87CiAgICAgICAgc3VwcGx5ID0gc3VwcGx5XzsKICAgICAgICBvd25lciA9IG93bmVyXzsKICAgICAgICBiYWxhbmNlc1tvd25lcl0gPSBzdXBwbHk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pIHRva2VuT25seSB7CiAgICAgICAgb3duZXIgPSBvd25lcl87CiAgICAgICAgTG9nU2V0T3duZXIob3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuKGFkZHJlc3MgdG9rZW5fKSBhdXRoIHsKICAgICAgICB0b2tlbiA9IHRva2VuXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRTdXBwbHkodWludCBzdXBwbHlfKSB0b2tlbk9ubHkgewogICAgICAgIHN1cHBseSA9IHN1cHBseV87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QmFsYW5jZXMoYWRkcmVzcyBndXksIHVpbnQgYmFsYW5jZSkgdG9rZW5Pbmx5IHsKICAgICAgICBiYWxhbmNlc1tndXldID0gYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBcHByb3ZhbHMoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZ3V5LCB1aW50IHdhZCkgdG9rZW5Pbmx5IHsKICAgICAgICBhcHByb3ZhbHNbc3JjXVtndXldID0gd2FkOwogICAgfQoKfS8vLyBiYXNlLnNvbCAtLSBiYXNpYyBFUkMyMCBpbXBsZW1lbnRhdGlvbgoKLy8gQ29weXJpZ2h0IChDKSAyMDE1LCAyMDE2LCAyMDE3ICBEYXBwSHViLCBMTEMKCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpLgovLyBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5EIChleHByZXNzIG9yIGltcGxpZWQpLgoKY29udHJhY3QgVG9rZW5Mb2dpYyBpcyBFUkMyMEV2ZW50cywgTWF0aCwgU3RvcHBhYmxlIHsKCiAgICBUb2tlbkRhdGEgcHVibGljIGRhdGE7CiAgICBUb2tlbiBwdWJsaWMgdG9rZW47CiAgICB1aW50IHB1YmxpYyB0b2tlbnNQZXJXZWk9MzAwOwogICAgdWludCBwdWJsaWMgaWNvU3RhcnQ9MTUwMzc1NjAwMDsgLy8gPSBBdWcgMjYgMjAxNyAycG0gR01UCiAgICB1aW50IHB1YmxpYyBpY29FbmQ7ICAgLy8xNTA0MTg4MDAwID0gQXVnIDMxIDIwMTcgMnBtIEdNVAogICAgdWludCBwdWJsaWMgaWNvU2FsZTsgLy90aGUgbnVtYmVyIG9mIHRva2VucyBzb2xkIGR1cmluZyB0aGUgSUNPCiAgICB1aW50IHB1YmxpYyBtYXhJY28gPSA5MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsgLy8gdGhlIG1heGltdW0gbnVtYmVyIG9mIHRva2VucyBzb2xkIGR1cmluZyBJQ08KCiAgICBhZGRyZXNzW10gY29udHJpYnV0b3JzOwoKICAgIGZ1bmN0aW9uIFRva2VuTG9naWMoVG9rZW4gdG9rZW5fLCBUb2tlbkRhdGEgZGF0YV8sIHVpbnQgaWNvU3RhcnRfLCB1aW50IGljb0hvdXJzXykgewogICAgICAgIHJlcXVpcmUodG9rZW5fICE9IFRva2VuKDB4MCkpOwoKICAgICAgICBpZihkYXRhXyA9PSBhZGRyZXNzKDB4MCkpIHsKICAgICAgICAgICAgZGF0YSA9IG5ldyBUb2tlbkRhdGEodGhpcywgMTIwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwLCBtc2cuc2VuZGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhID0gZGF0YV87CiAgICAgICAgfQogICAgICAgIHRva2VuID0gdG9rZW5fOwogICAgICAgIGljb1N0YXJ0ID0gaWNvU3RhcnRfOwogICAgICAgIGljb0VuZCA9IGljb1N0YXJ0ICsgaWNvSG91cnNfICogMzYwMDsKICAgIH0KCiAgICBtb2RpZmllciB0b2tlbk9ubHkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IGFkZHJlc3ModG9rZW4pIHx8IG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBjb250cmlidXRvckNvdW50KCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9ycy5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pIHRva2VuT25seSB7CiAgICAgICAgb3duZXIgPSBvd25lcl87CiAgICAgICAgTG9nU2V0T3duZXIob3duZXIpOwogICAgICAgIGRhdGEuc2V0T3duZXIob3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuKFRva2VuIHRva2VuXykgYXV0aCB7CiAgICAgICAgdG9rZW4gPSB0b2tlbl87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SWNvU3RhcnQodWludCBpY29TdGFydF8sIHVpbnQgaWNvSG91cnNfKSBhdXRoIHsKICAgICAgICBpY29TdGFydCA9IGljb1N0YXJ0XzsKICAgICAgICBpY29FbmQgPSBpY29TdGFydCArIGljb0hvdXJzXyAqIDM2MDA7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5zUGVyV2VpKHVpbnQgdG9rZW5zUGVyV2VpXykgYXV0aCB7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNQZXJXZWlfID4gMCk7CiAgICAgICAgdG9rZW5zUGVyV2VpID0gdG9rZW5zUGVyV2VpXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZGF0YS5zdXBwbHkoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBzcmMpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZGF0YS5iYWxhbmNlcyhzcmMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIHNyYywgYWRkcmVzcyBndXkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZGF0YS5hcHByb3ZhbHMoc3JjLCBndXkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSB0b2tlbk9ubHkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mKHNyYykgPj0gd2FkKTsKICAgICAgICAKICAgICAgICBkYXRhLnNldEJhbGFuY2VzKHNyYywgc3ViKGRhdGEuYmFsYW5jZXMoc3JjKSwgd2FkKSk7CiAgICAgICAgZGF0YS5zZXRCYWxhbmNlcyhkc3QsIGFkZChkYXRhLmJhbGFuY2VzKGRzdCksIHdhZCkpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCB1aW50IHdhZCkgdG9rZW5Pbmx5IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGRhdGEuYmFsYW5jZXMoc3JjKSA+PSB3YWQpOwogICAgICAgIHJlcXVpcmUoZGF0YS5hcHByb3ZhbHMoc3JjLCBkc3QpID49IHdhZCk7CiAgICAgICAgCiAgICAgICAgZGF0YS5zZXRBcHByb3ZhbHMoc3JjLCBkc3QsIHN1YihkYXRhLmFwcHJvdmFscyhzcmMsIGRzdCksIHdhZCkpOwogICAgICAgIGRhdGEuc2V0QmFsYW5jZXMoc3JjLCBzdWIoZGF0YS5iYWxhbmNlcyhzcmMpLCB3YWQpKTsKICAgICAgICBkYXRhLnNldEJhbGFuY2VzKGRzdCwgYWRkKGRhdGEuYmFsYW5jZXMoZHN0KSwgd2FkKSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZ3V5LCB1aW50MjU2IHdhZCkgdG9rZW5Pbmx5IHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgZGF0YS5zZXRBcHByb3ZhbHMoc3JjLCBndXksIHdhZCk7CiAgICAgICAgCiAgICAgICAgQXBwcm92YWwoc3JjLCBndXksIHdhZCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gbWludCh1aW50MTI4IHdhZCkgdG9rZW5Pbmx5IHsKICAgICAgICBkYXRhLnNldEJhbGFuY2VzKGRhdGEub3duZXIoKSwgYWRkKGRhdGEuYmFsYW5jZXMoZGF0YS5vd25lcigpKSwgd2FkKSk7CiAgICAgICAgZGF0YS5zZXRTdXBwbHkoYWRkKGRhdGEuc3VwcGx5KCksIHdhZCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1cm4oYWRkcmVzcyBzcmMsIHVpbnQxMjggd2FkKSB0b2tlbk9ubHkgewogICAgICAgIGRhdGEuc2V0QmFsYW5jZXMoc3JjLCBzdWIoZGF0YS5iYWxhbmNlcyhzcmMpLCB3YWQpKTsKICAgICAgICBkYXRhLnNldFN1cHBseShzdWIoZGF0YS5zdXBwbHkoKSwgd2FkKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmV0dXJuSWNvSW52ZXN0bWVudHModWludCBjb250cmlidXRvckluZGV4KSBhdXRoIHsKICAgICAgICAvKnRoaXMgY2FuIG9ubHkgYmUgZG9uZSBhZnRlciB0aGUgSUNPIGNsb3NlIGRhdGUgYW5kIGlmIGxlc3MgdGhhbiAyMG1pbyB0b2tlbnMgd2VyZSBzb2xkKi8KICAgICAgICByZXF1aXJlKG5vdyA+IGljb0VuZCAmJiBpY29TYWxlIDwgMjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwoKICAgICAgICBhZGRyZXNzIHNyYyA9IGNvbnRyaWJ1dG9yc1tjb250cmlidXRvckluZGV4XTsKICAgICAgICByZXF1aXJlKHNyYyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludCBzcmNCYWxhbmNlID0gYmFsYW5jZU9mKHNyYyk7CgogICAgICAgIC8qdHJhbnNmZXIgdGhlIHNlbnQgRVRIIGFtb3VudCBtaW51cyBhIDUgZmlubmV5ICgwLjAwNSBFVEggfiAxVVNEKSB0YXggdG8gcGF5IGZvciBHYXMqLwogICAgICAgIHRva2VuLnRyYW5zZmVyRXRoKHNyYywgc3ViKGRpdihzcmNCYWxhbmNlLCB0b2tlbnNQZXJXZWkpLCA1IGZpbm5leSkpOwoKICAgICAgICAvKmdpdmUgYmFjayB0aGUgdG9rZW5zKi8KICAgICAgICBkYXRhLnNldEJhbGFuY2VzKHNyYywgc3ViKGRhdGEuYmFsYW5jZXMoc3JjKSwgc3JjQmFsYW5jZSkpOwogICAgICAgIGRhdGEuc2V0QmFsYW5jZXMob3duZXIsIGFkZChkYXRhLmJhbGFuY2VzKG93bmVyKSwgc3JjQmFsYW5jZSkpOwogICAgICAgIHRva2VuLnRyaWdnZXJUYW5zZmVyRXZlbnQoc3JjLCBvd25lciwgc3JjQmFsYW5jZSk7CgogICAgICAgIC8qcmVzZXQgdGhlIGFkZHJlc3MgYWZ0ZXIgdGhlIHRyYW5zZmVyIHRvIGF2b2lkIGVycm9ycyovCiAgICAgICAgY29udHJpYnV0b3JzW2NvbnRyaWJ1dG9ySW5kZXhdID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVQYXltZW50KGFkZHJlc3Mgc3JjLCB1aW50IGV0aCkgdG9rZW5Pbmx5IHJldHVybnMgKHVpbnQpewogICAgICAgIHJlcXVpcmUoZXRoID4gMCk7CiAgICAgICAgLyp0aGUgdGltZSBzdGFtcCBoYXMgdG8gYmUgYmV0d2VlbiB0aGUgc3RhcnQgYW5kIGVuZCB0aW1lcyBvZiB0aGUgSUNPKi8KICAgICAgICByZXF1aXJlKG5vdyA+PSBpY29TdGFydCAmJiBub3cgPD0gaWNvRW5kKTsKICAgICAgICAvKm5vIG1vcmUgdGhhbiA5MCBtaW8gdG9rZW5zIHNoYWxsIGJlIHNvbGQgaW4gdGhlIElDTyovCiAgICAgICAgcmVxdWlyZShpY29TYWxlIDwgbWF4SWNvKTsKCiAgICAgICAgdWludCB0b2tlbkFtb3VudCA9IG11bCh0b2tlbnNQZXJXZWksIGV0aCk7Ci8vZmlyc3QgMTAgaG91cnMKICAgICAgICBpZihub3cgPCBpY29TdGFydCArICgxMCAqIDM2MDApKSB7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQgKiAxMjUgLyAxMDA7CiAgICAgICAgfQovLzEwIHRvIDM0IGhvdXJzCiAgICAgICAgZWxzZSBpZihub3cgPCBpY29TdGFydCArICgzNCAqIDM2MDApKSB7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQgKiAxMTUgLyAxMDA7CiAgICAgICAgfQovLzM0IHRvIDU4IGhvdXJzCiAgICAgICAgZWxzZSBpZihub3cgPCBpY29TdGFydCArICg1OCAqIDM2MDApKSB7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQgKiAxMDUgLyAxMDA7CiAgICAgICAgfQoKICAgICAgICBpY29TYWxlICs9IHRva2VuQW1vdW50OwogICAgICAgIGlmKGljb1NhbGUgPiBtYXhJY28pIHsKICAgICAgICAgICAgdWludCBleGNlc3MgPSBzdWIoaWNvU2FsZSwgbWF4SWNvKTsKICAgICAgICAgICAgdG9rZW5BbW91bnQgPSBzdWIodG9rZW5BbW91bnQsIGV4Y2Vzcyk7CiAgICAgICAgICAgIHRva2VuLnRyYW5zZmVyRXRoKHNyYywgZGl2KGV4Y2VzcywgdG9rZW5zUGVyV2VpKSk7CiAgICAgICAgICAgIGljb1NhbGUgPSBtYXhJY287CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZihvd25lcikgPj0gdG9rZW5BbW91bnQpOwoKICAgICAgICBkYXRhLnNldEJhbGFuY2VzKG93bmVyLCBzdWIoZGF0YS5iYWxhbmNlcyhvd25lciksIHRva2VuQW1vdW50KSk7CiAgICAgICAgZGF0YS5zZXRCYWxhbmNlcyhzcmMsIGFkZChkYXRhLmJhbGFuY2VzKHNyYyksIHRva2VuQW1vdW50KSk7CiAgICAgICAgY29udHJpYnV0b3JzLnB1c2goc3JjKTsKCiAgICAgICAgdG9rZW4udHJpZ2dlclRhbnNmZXJFdmVudChvd25lciwgc3JjLCB0b2tlbkFtb3VudCk7CgogICAgICAgIHJldHVybiB0b2tlbkFtb3VudDsKICAgIH0KfQ=='.
	

]
