Class {
	#name : #SRT6b7470bfa67566df5275365933f5984530f54a7a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6b7470bfa67566df5275365933f5984530f54a7a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIENyb3dkc2FsZQogKiBAZGV2IENyb3dkc2FsZSBpcyBhIGJhc2UgY29udHJhY3QgZm9yIG1hbmFnaW5nIGEgdG9rZW4gY3Jvd2RzYWxlLgogKiBDcm93ZHNhbGVzIGhhdmUgYSBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMsIHdoZXJlIGludmVzdG9ycyBjYW4gbWFrZQogKiB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKICogb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0CiAqIGFzIHRoZXkgYXJyaXZlLgogKi8KIAogCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjBTdGFuZGFyZAogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBJbnRlcmZhY2UgewogICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHRva2VucykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB0b2tlbnMpOwogICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCB0b2tlbk93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB0b2tlbnMpOwp9CmNvbnRyYWN0IEV0aGVlcmFUb2tlbiBpcyBFUkMyMEludGVyZmFjZSxPd25hYmxlIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgdG9rZW5CYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJFVEhFRVJBIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkVUQSI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSU5JVElBTF9TVVBQTFkgPSA3NTAwMDAwMDAwMDsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSh0b2tlbkJhbGFuY2VzW21zZy5zZW5kZXJdPj1fdmFsdWUpOwogICAgdG9rZW5CYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRva2VuQmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICB0b2tlbkJhbGFuY2VzW190b10gPSB0b2tlbkJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIHRva2VuQmFsYW5jZXNbX293bmVyXTsKICB9CiAgCiAgCiAgICAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IHRva2VuQmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICB0b2tlbkJhbGFuY2VzW19mcm9tXSA9IHRva2VuQmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgdG9rZW5CYWxhbmNlc1tfdG9dID0gdG9rZW5CYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCiAgICAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAvLyBUb3RhbCBzdXBwbHkKICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgIHJldHVybiB0b3RhbFN1cHBseSAgLSB0b2tlbkJhbGFuY2VzW2FkZHJlc3MoMCldOwogICAgIH0KICAgICAKICAgIAogICAgIAogICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIC8vIFJldHVybnMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXBwcm92ZWQgYnkgdGhlIG93bmVyIHRoYXQgY2FuIGJlCiAgICAgLy8gdHJhbnNmZXJyZWQgdG8gdGhlIHNwZW5kZXIncyBhY2NvdW50CiAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgICAgICAgcmV0dXJuIGFsbG93ZWRbdG9rZW5Pd25lcl1bc3BlbmRlcl07CiAgICAgfQogICAgIAogICAgIC8qKgogICAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfYWRkZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBpbmNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgICAgCiAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgLy8gRG9uJ3QgYWNjZXB0IEVUSAogICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgfSAgIAoKCiAgCiAgIGV2ZW50IERlYnVnKHN0cmluZyBtZXNzYWdlLCBhZGRyZXNzIGFkZHIsIHVpbnQyNTYgbnVtYmVyKTsKICAgLyoqCiAgICogQGRldiBDb250cnVjdG9yIHRoYXQgZ2l2ZXMgbXNnLnNlbmRlciBhbGwgb2YgZXhpc3RpbmcgdG9rZW5zLgogICAqLwogICAgZnVuY3Rpb24gRXRoZWVyYVRva2VuKGFkZHJlc3Mgd2FsbGV0KSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB0b3RhbFN1cHBseSA9IElOSVRJQUxfU1VQUExZICogMTAgKiogMTg7CiAgICAgICAgdG9rZW5CYWxhbmNlc1t3YWxsZXRdID0gdG90YWxTdXBwbHk7ICAgLy9TaW5jZSB3ZSBkaXZpZGVkIHRoZSB0b2tlbiBpbnRvIDEwXjE4IHBhcnRzCiAgICB9CgogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIHdhbGxldCwgYWRkcmVzcyBidXllciwgdWludDI1NiB0b2tlbkFtb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIHJlcXVpcmUodG9rZW5CYWxhbmNlc1t3YWxsZXRdID49IHRva2VuQW1vdW50KTsgICAgICAgICAgICAgICAvLyBjaGVja3MgaWYgaXQgaGFzIGVub3VnaCB0byBzZWxsCiAgICAgIHRva2VuQmFsYW5jZXNbYnV5ZXJdID0gdG9rZW5CYWxhbmNlc1tidXllcl0uYWRkKHRva2VuQW1vdW50KTsgICAgICAgICAgICAgICAgICAvLyBhZGRzIHRoZSBhbW91bnQgdG8gYnV5ZXIncyBiYWxhbmNlCiAgICAgIHRva2VuQmFsYW5jZXNbd2FsbGV0XSA9IHRva2VuQmFsYW5jZXNbd2FsbGV0XS5zdWIodG9rZW5BbW91bnQpOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YnRyYWN0cyBhbW91bnQgZnJvbSBzZWxsZXIncyBiYWxhbmNlCiAgICAgIFRyYW5zZmVyKHdhbGxldCwgYnV5ZXIsIHRva2VuQW1vdW50KTsgCiAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKHRva2VuQW1vdW50KTsgCiAgICB9CiAgICAKICAgCn0KY29udHJhY3QgRXRoZWVyYUNyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogIEV0aGVlcmFUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcyB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZCAoYm90aCBpbmNsdXNpdmUpCiAgdWludCBwdWJsaWMgc3RhcnRUaW1lOwogIHVpbnQgcHVibGljIGVuZFRpbWU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogIC8vIGFkZHJlc3Mgd2hlcmUgdG9rZW5zIGFyZSBkZXBvc2l0ZWQgYW5kIGZyb20gd2hlcmUgd2Ugc2VuZCB0b2tlbnMgdG8gYnV5ZXJzCiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogIHVpbnQyNTYgcHVibGljIHJhdGVQZXJXZWkgPSA1MDAwMDA7CgogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwoKICAvLyBmbGFncyB0byBzaG93IHdoZXRoZXIgc29mdCBjYXAgLyBoYXJkIGNhcCBpcyByZWFjaGVkCiAgYm9vbCBwdWJsaWMgaXNTb2Z0Q2FwUmVhY2hlZCA9IGZhbHNlOwogIGJvb2wgcHVibGljIGlzSGFyZENhcFJlYWNoZWQgPSBmYWxzZTsKICAgIAogIC8vdGhpcyBmbGFnIGlzIHNldCB0byB0cnVlIHdoZW4gSUNPIGR1cmF0aW9uIGlzIG92ZXIgYW5kIHNvZnQgY2FwIGlzIG5vdCByZWFjaGVkICAKICBib29sIHB1YmxpYyByZWZ1bmRUb0J1eWVycyA9IGZhbHNlOwogICAgCiAgLy8gU29mdCBjYXAgb2YgdGhlIElDTyBpbiBldGhlcnMgIAogIHVpbnQyNTYgcHVibGljIHNvZnRDYXAgPSA2MDAwOwogICAgCiAgLy9IYXJkIGNhcCBvZiB0aGUgSUNPIGluIGV0aGVycwogIHVpbnQyNTYgcHVibGljIGhhcmRDYXAgPSAxMDUwMDA7CiAgCiAgLy90b3RhbCB0b2tlbnMgdGhhdCBoYXZlIGJlZW4gc29sZCAgCiAgdWludDI1NiBwdWJsaWMgdG9rZW5zX3NvbGQgPSAwOwoKICAvL3RvdGFsIHRva2VucyB0aGF0IGFyZSB0byBiZSBzb2xkIC0gdGhpcyBpcyA3MCUgb2YgdGhlIHRvdGFsIHN1cHBseSBpLmUuIDUyNTAwMDAwMDAwCiAgdWludCBtYXhUb2tlbnNGb3JTYWxlID0gNTI1MDAwMDAwMDA7CiAgCiAgLy90b2tlbnMgdGhhdCBhcmUgcmVzZXJ2ZWQgZm9yIHRoZSBldGhlZXJhIHRlYW0gLSB0aGlzIGlzIDMwJSBvZiB0aGUgdG90YWwgc3VwcGx5ICAKICB1aW50MjU2IHB1YmxpYyB0b2tlbnNGb3JSZXNlcnZlZEZ1bmQgPSAwOwogIHVpbnQyNTYgcHVibGljIHRva2Vuc0ZvckFkdmlzb3JzID0gMDsKICB1aW50MjU2IHB1YmxpYyB0b2tlbnNGb3JGb3VuZGVyc0FuZFRlYW0gPSAwOwogIHVpbnQyNTYgcHVibGljIHRva2Vuc0Zvck1hcmtldGluZyA9IDA7CiAgdWludDI1NiBwdWJsaWMgdG9rZW5zRm9yVG91cm5hbWVudCA9IDA7CgogIGJvb2wgZXRoZXJzU2VudEZvclJlZnVuZCA9IGZhbHNlOwoKICAvLyB0aGUgYnV5ZXJzIG9mIHRva2VucyBhbmQgdGhlIGFtb3VudCBvZiBldGhlcnMgdGhleSBzZW50IGluCiAgbWFwcGluZyhhZGRyZXNzPT51aW50MjU2KSB1c2Vyc1RoYXRCb3VnaHRFVEE7CiAKICAvKioKICAgKiBldmVudCBmb3IgdG9rZW4gcHVyY2hhc2UgbG9nZ2luZwogICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICogQHBhcmFtIHZhbHVlIHdlaXMgcGFpZCBmb3IgcHVyY2hhc2UKICAgKiBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICovCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBJQ09TdGFydGVkKHVpbnQyNTYgc3RhcnRUaW1lLCB1aW50MjU2IGVuZFRpbWUpOwogIGZ1bmN0aW9uIEV0aGVlcmFDcm93ZHNhbGUodWludDI1NiBfc3RhcnRUaW1lLCBhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyB7CgogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBzdGFydFRpbWUuYWRkKDc5IGRheXMpOwoKICAgIHJlcXVpcmUoZW5kVGltZSA+PSBzdGFydFRpbWUpOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CgogICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCh3YWxsZXQpOwogICAgCiAgICBJQ09TdGFydGVkKHN0YXJ0VGltZSxlbmRUaW1lKTsKCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KGFkZHJlc3Mgd2FsbCkgaW50ZXJuYWwgcmV0dXJucyAoRXRoZWVyYVRva2VuKSB7CiAgICByZXR1cm4gbmV3IEV0aGVlcmFUb2tlbih3YWxsKTsKICB9CgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvL2RldGVybWluZSB0aGUgYm9udXMgd2l0aCByZXNwZWN0IHRvIHRpbWUgZWxhcHNlZAogIGZ1bmN0aW9uIGRldGVybWluZUJvbnVzKHVpbnQgdG9rZW5zKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgYm9udXMpIHsKICAgIAogICAgdWludDI1NiB0aW1lRWxhcHNlZCA9IG5vdyAtIHN0YXJ0VGltZTsKICAgIHVpbnQyNTYgdGltZUVsYXBzZWRJbkRheXMgPSB0aW1lRWxhcHNlZC5kaXYoMSBkYXlzKTsKICAgICAKICAgIGlmICh0aW1lRWxhcHNlZEluRGF5cyA8PTM1KQogICAgewogICAgICAgIC8vZWFybHkgc2FsZQogICAgICAgIC8vdmFsaWQgZm9yIDEwLTAyLTIwMTggdG8gMTYtMDMtMjAxOCBpLmUuIDAgdG8gMzV0aCBkYXlzCiAgICAgICAgLy80MCUgQk9OVVMKICAgICAgICBib251cyA9IHRva2Vucy5tdWwoNDApOwogICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAKICAgIH0KICAgIGVsc2UgaWYgKHRpbWVFbGFwc2VkSW5EYXlzPjM1ICYmIHRpbWVFbGFwc2VkSW5EYXlzIDw9NTApCiAgICB7CiAgICAgICAgLy9zYWxlCiAgICAgICAgLy9mcm9tIDE3LjAzLjIwMTggLSAzMS4wMy4yMDE4IGkuZS4gMzV0aCB0byA1MHRoIGRheXMKICAgICAgIAogICAgICAgIC8vMjAlIGJvbnVzCiAgICAgICAgYm9udXMgPSB0b2tlbnMubXVsKDIwKTsKICAgICAgICBib251cyA9IGJvbnVzLmRpdigxMDApOwogICAgICAgIAogICAgICAgCiAgICB9CiAgICBlbHNlIGlmICh0aW1lRWxhcHNlZEluRGF5cz41MCAmJiB0aW1lRWxhcHNlZEluRGF5cyA8PTY0KQogICAgewogICAgICAgIC8vc2FsZQogICAgICAgIC8vZnJvbSAwMS4wNC4yMDE4IC0gMTQuMDQuMjAxOCAgaS5lLiA1MHRoIHRvIDY0dGggZGF5cwogICAgICAgCiAgICAgICAgLy8xMCUgYm9udXMKICAgICAgICBib251cyA9IHRva2Vucy5tdWwoMTApOwogICAgICAgIGJvbnVzID0gYm9udXMuZGl2KDEwMCk7CiAgICAgICAgCiAgICAgICAKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICAvL25vIGJvbnVzZXMgMTUuMDQuMjAxOCAtIDMwLjA0LjIwMTggCiAgICAgICAgYm9udXMgPSAwOwogICAgfQogICAKICB9CgogIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIC8vIE1pbmltdW0gcHVyY2hhc2UgY2FuIGJlIG9mIDc1IEVUQSB0b2tlbnMKICAKICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgCiAgLy90b2tlbnMgbm90IHRvIGJlIHNlbnQgdG8gMHgwCiAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDApOwoKICBpZihoYXNFbmRlZCgpICYmICFpc0hhcmRDYXBSZWFjaGVkKQogIHsKICAgICAgaWYgKCFpc1NvZnRDYXBSZWFjaGVkKQogICAgICAgIHJlZnVuZFRvQnV5ZXJzID0gdHJ1ZTsKICAgICAgYnVyblJlbWFpbmluZ1Rva2VucygpOwogICAgICBiZW5lZmljaWFyeS50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KICAKICBlbHNlCiAgewogICAgLy90aGUgcHVyY2hhc2Ugc2hvdWxkIGJlIHdpdGhpbiBkdXJhdGlvbiBhbmQgbm9uIHplcm8KICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKICAgIAogICAgLy8gYW1vdW50IHNlbnQgYnkgdGhlIHVzZXIKICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwogICAgCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIHNvbGQKICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlUGVyV2VpKTsKICAKICAgIHJlcXVpcmUgKHRva2Vucz49NzUgKiAxMCAqKiAxOCk7CiAgICAKICAgIC8vRGV0ZXJtaW5lIGJvbnVzCiAgICB1aW50IGJvbnVzID0gZGV0ZXJtaW5lQm9udXModG9rZW5zKTsKICAgIHRva2VucyA9IHRva2Vucy5hZGQoYm9udXMpOwogIAogICAgLy9jYW4ndCBzYWxlIHRva2VucyBtb3JlIHRoYW4gNTI1MDAwMDAwMDAgdG9rZW5zCiAgICByZXF1aXJlKHRva2Vuc19zb2xkICsgdG9rZW5zIDw9IG1heFRva2Vuc0ZvclNhbGUgKiAxMCAqKiAxOCk7CiAgCiAgICAvLzMwJSBvZiB0aGUgdG9rZW5zIGJlaW5nIHNvbGQgYXJlIGJlaW5nIGFjY3VtdWxhdGVkIGZvciB0aGUgZXRoZWVyYSB0ZWFtCiAgICB1cGRhdGVUb2tlbnNGb3JFdGhlZXJhVGVhbSh0b2tlbnMpOwoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKICAgIAogICAgCiAgICBpZiAod2VpUmFpc2VkID49IHNvZnRDYXAgKiAxMCAqKiAxOCAmJiAhaXNTb2Z0Q2FwUmVhY2hlZCkKICAgIHsKICAgICAgaXNTb2Z0Q2FwUmVhY2hlZCA9IHRydWU7CiAgICB9CiAgCiAgICBpZiAod2VpUmFpc2VkID49IGhhcmRDYXAgKiAxMCAqKiAxOCAmJiAhaXNIYXJkQ2FwUmVhY2hlZCkKICAgICAgaXNIYXJkQ2FwUmVhY2hlZCA9IHRydWU7CiAgICAKICAgIHRva2VuLm1pbnQod2FsbGV0LCBiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgIAogICAgdWludCBvbGRlckFtb3VudCA9IHVzZXJzVGhhdEJvdWdodEVUQVtiZW5lZmljaWFyeV07CiAgICB1c2Vyc1RoYXRCb3VnaHRFVEFbYmVuZWZpY2lhcnldID0gd2VpQW1vdW50ICsgb2xkZXJBbW91bnQ7CiAgICAKICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgdG9rZW5zKTsKICAgIAogICAgdG9rZW5zX3NvbGQgPSB0b2tlbnNfc29sZC5hZGQodG9rZW5zKTsKICAgIGZvcndhcmRGdW5kcygpOwogIH0KIH0KCiAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2U7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmRUaW1lOwogIH0KICAgIAogICAgZnVuY3Rpb24gYnVyblJlbWFpbmluZ1Rva2VucygpIGludGVybmFsCiAgICB7CiAgICAgICAgLy9idXJuIGFsbCB0aGUgdW5zb2xkIHRva2VucyBhcyBzb29uIGFzIHRoZSBJQ08gaXMgZW5kZWQKICAgICAgICB1aW50IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2Yod2FsbGV0KTsKICAgICAgICByZXF1aXJlKGJhbGFuY2U+MCk7CiAgICAgICAgdWludCB0b2tlbnNGb3JUZWFtID0gdG9rZW5zRm9yUmVzZXJ2ZWRGdW5kICsgdG9rZW5zRm9yRm91bmRlcnNBbmRUZWFtICsgdG9rZW5zRm9yQWR2aXNvcnMgK3Rva2Vuc0Zvck1hcmtldGluZyArIHRva2Vuc0ZvclRvdXJuYW1lbnQ7CiAgICAgICAgdWludCB0b2tlbnNUb0J1cm4gPSBiYWxhbmNlLnN1Yih0b2tlbnNGb3JUZWFtKTsKICAgICAgICByZXF1aXJlIChiYWxhbmNlID49dG9rZW5zVG9CdXJuKTsKICAgICAgICBhZGRyZXNzIGJ1cm5BZGRyZXNzID0gMHgwOwogICAgICAgIHRva2VuLm1pbnQod2FsbGV0LGJ1cm5BZGRyZXNzLHRva2Vuc1RvQnVybik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFJlZnVuZCgpIHB1YmxpYyAKICAgIHsKICAgICAgICByZXF1aXJlKGV0aGVyc1NlbnRGb3JSZWZ1bmQgJiYgdXNlcnNUaGF0Qm91Z2h0RVRBW21zZy5zZW5kZXJdPjApOwogICAgICAgIHVpbnQyNTYgZXRoZXJzU2VudCA9IHVzZXJzVGhhdEJvdWdodEVUQVttc2cuc2VuZGVyXTsKICAgICAgICByZXF1aXJlICh3YWxsZXQuYmFsYW5jZSA+PSBldGhlcnNTZW50KTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV0aGVyc1NlbnQpOwogICAgICAgIHVpbnQyNTYgdG9rZW5zSUhhdmUgPSB0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgdG9rZW4ubWludChtc2cuc2VuZGVyLDB4MCx0b2tlbnNJSGF2ZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRlYml0QW1vdW50VG9SZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSAKICAgIHsKICAgICAgICByZXF1aXJlKGhhc0VuZGVkKCkgJiYgbXNnLnNlbmRlciA9PSB3YWxsZXQgJiYgIWlzU29mdENhcFJlYWNoZWQgJiYgIWV0aGVyc1NlbnRGb3JSZWZ1bmQpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49d2VpUmFpc2VkKTsKICAgICAgICBldGhlcnNTZW50Rm9yUmVmdW5kID0gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdXBkYXRlVG9rZW5zRm9yRXRoZWVyYVRlYW0odWludDI1NiB0b2tlbnMpIGludGVybmFsIAogICAgewogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZWRGdW5kVG9rZW5zOwogICAgICAgIHVpbnQyNTYgZm91bmRlcnNBbmRUZWFtVG9rZW5zOwogICAgICAgIHVpbnQyNTYgYWR2aXNvcnNUb2tlbnM7CiAgICAgICAgdWludDI1NiBtYXJrZXRpbmdUb2tlbnM7CiAgICAgICAgdWludDI1NiB0b3VybmFtZW50VG9rZW5zOwogICAgICAgIAogICAgICAgIC8vMTAlIG9mIHRva2VucyBmb3IgcmVzZXJ2ZWQgZnVuZAogICAgICAgIHJlc2VydmVkRnVuZFRva2VucyA9IHRva2Vucy5tdWwoMTApOwogICAgICAgIHJlc2VydmVkRnVuZFRva2VucyA9IHJlc2VydmVkRnVuZFRva2Vucy5kaXYoMTAwKTsKICAgICAgICB0b2tlbnNGb3JSZXNlcnZlZEZ1bmQgPSB0b2tlbnNGb3JSZXNlcnZlZEZ1bmQuYWRkKHJlc2VydmVkRnVuZFRva2Vucyk7CiAgICAKICAgICAgICAvLzE1JSBvZiB0b2tlbnMgZm9yIGZvdW5kZXJzIGFuZCB0ZWFtICAgIAogICAgICAgIGZvdW5kZXJzQW5kVGVhbVRva2Vucz10b2tlbnMubXVsKDE1KTsKICAgICAgICBmb3VuZGVyc0FuZFRlYW1Ub2tlbnM9IGZvdW5kZXJzQW5kVGVhbVRva2Vucy5kaXYoMTAwKTsKICAgICAgICB0b2tlbnNGb3JGb3VuZGVyc0FuZFRlYW0gPSB0b2tlbnNGb3JGb3VuZGVyc0FuZFRlYW0uYWRkKGZvdW5kZXJzQW5kVGVhbVRva2Vucyk7CiAgICAKICAgICAgICAvLzMlIG9mIHRva2VucyBmb3IgYWR2aXNvcnMKICAgICAgICBhZHZpc29yc1Rva2Vucz10b2tlbnMubXVsKDMpOwogICAgICAgIGFkdmlzb3JzVG9rZW5zPSBhZHZpc29yc1Rva2Vucy5kaXYoMTAwKTsKICAgICAgICB0b2tlbnNGb3JBZHZpc29ycz0gdG9rZW5zRm9yQWR2aXNvcnMuYWRkKGFkdmlzb3JzVG9rZW5zKTsKICAgIAogICAgICAgIC8vMSUgb2YgdG9rZW5zIGZvciBtYXJrZXRpbmcKICAgICAgICBtYXJrZXRpbmdUb2tlbnMgPSB0b2tlbnMubXVsKDEpOwogICAgICAgIG1hcmtldGluZ1Rva2Vucz0gbWFya2V0aW5nVG9rZW5zLmRpdigxMDApOwogICAgICAgIHRva2Vuc0Zvck1hcmtldGluZz0gdG9rZW5zRm9yTWFya2V0aW5nLmFkZChtYXJrZXRpbmdUb2tlbnMpOwogICAgICAgIAogICAgICAgIC8vMSUgb2YgdG9rZW5zIGZvciB0b3VybmFtZW50IAogICAgICAgIHRvdXJuYW1lbnRUb2tlbnM9dG9rZW5zLm11bCgxKTsKICAgICAgICB0b3VybmFtZW50VG9rZW5zPSB0b3VybmFtZW50VG9rZW5zLmRpdigxMDApOwogICAgICAgIHRva2Vuc0ZvclRvdXJuYW1lbnQ9IHRva2Vuc0ZvclRvdXJuYW1lbnQuYWRkKHRvdXJuYW1lbnRUb2tlbnMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2Vuc0ZvckV0aGVlcmFUZWFtKHVpbnQyNTYgd2hvc2VUb2tlbnNUb1dpdGhkcmF3LGFkZHJlc3NbXSB3aGVyZVRvU2VuZFRva2VucykgcHVibGljIHsKICAgICAgICAvLzEgcmVzZXJ2ZWQgZnVuZCwgMiBmb3IgZm91bmRlcnMgYW5kIHRlYW0sIDMgZm9yIGFkdmlzb3JzLCA0IGZvciBtYXJrZXRpbmcsIDUgZm9yIHRvdXJuYW1lbnQKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gd2FsbGV0ICYmIG5vdz49ZW5kVGltZSk7CiAgICAgICAgdWludDI1NiBsb2NrUGVyaW9kID0gMDsKICAgICAgICB1aW50MjU2IHRpbWVQYXNzZWQgPSBub3cgLSBlbmRUaW1lOwogICAgICAgIHVpbnQyNTYgdG9rZW5zVG9TZW5kID0gMDsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIGlmICh3aG9zZVRva2Vuc1RvV2l0aGRyYXcgPT0gMSkKICAgICAgICB7CiAgICAgICAgICAvLzE1IG1vbnRocyBsb2NrdXAgcGVyaW9kCiAgICAgICAgICBsb2NrUGVyaW9kID0gMTUgZGF5cyAqIDMwOwogICAgICAgICAgcmVxdWlyZSh0aW1lUGFzc2VkID49IGxvY2tQZXJpb2QpOwogICAgICAgICAgcmVxdWlyZSAodG9rZW5zRm9yUmVzZXJ2ZWRGdW5kID4wKTsKICAgICAgICAgIC8vYWxsb3cgd2l0aGRyYXdhbAogICAgICAgICAgdG9rZW5zVG9TZW5kID0gdG9rZW5zRm9yUmVzZXJ2ZWRGdW5kLmRpdih3aGVyZVRvU2VuZFRva2Vucy5sZW5ndGgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICBmb3IgKGk9MDtpPHdoZXJlVG9TZW5kVG9rZW5zLmxlbmd0aDtpKyspCiAgICAgICAgICB7CiAgICAgICAgICAgIHRva2VuLm1pbnQod2FsbGV0LHdoZXJlVG9TZW5kVG9rZW5zW2ldLHRva2Vuc1RvU2VuZCk7CiAgICAgICAgICB9CiAgICAgICAgICB0b2tlbnNGb3JSZXNlcnZlZEZ1bmQgPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh3aG9zZVRva2Vuc1RvV2l0aGRyYXcgPT0gMikKICAgICAgICB7CiAgICAgICAgICAvLzEwIG1vbnRocyBsb2NrdXAgcGVyaW9kCiAgICAgICAgICBsb2NrUGVyaW9kID0gMTAgZGF5cyAqIDMwOwogICAgICAgICAgcmVxdWlyZSh0aW1lUGFzc2VkID49IGxvY2tQZXJpb2QpOwogICAgICAgICAgcmVxdWlyZSh0b2tlbnNGb3JGb3VuZGVyc0FuZFRlYW0gPiAwKTsKICAgICAgICAgIC8vYWxsb3cgd2l0aGRyYXdhbAogICAgICAgICAgdG9rZW5zVG9TZW5kID0gdG9rZW5zRm9yRm91bmRlcnNBbmRUZWFtLmRpdih3aGVyZVRvU2VuZFRva2Vucy5sZW5ndGgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICBmb3IgKGk9MDtpPHdoZXJlVG9TZW5kVG9rZW5zLmxlbmd0aDtpKyspCiAgICAgICAgICB7CiAgICAgICAgICAgIHRva2VuLm1pbnQod2FsbGV0LHdoZXJlVG9TZW5kVG9rZW5zW2ldLHRva2Vuc1RvU2VuZCk7CiAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgICB0b2tlbnNGb3JGb3VuZGVyc0FuZFRlYW0gPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh3aG9zZVRva2Vuc1RvV2l0aGRyYXcgPT0gMykKICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmUgKHRva2Vuc0ZvckFkdmlzb3JzID4gMCk7CiAgICAgICAgICAvL2FsbG93IHdpdGhkcmF3YWwKICAgICAgICAgIHRva2Vuc1RvU2VuZCA9IHRva2Vuc0ZvckFkdmlzb3JzLmRpdih3aGVyZVRvU2VuZFRva2Vucy5sZW5ndGgpOyAgICAgICAgCiAgICAgICAgICBmb3IgKGk9MDtpPHdoZXJlVG9TZW5kVG9rZW5zLmxlbmd0aDtpKyspCiAgICAgICAgICB7CiAgICAgICAgICAgIHRva2VuLm1pbnQod2FsbGV0LHdoZXJlVG9TZW5kVG9rZW5zW2ldLHRva2Vuc1RvU2VuZCk7CiAgICAgICAgICB9CiAgICAgICAgICB0b2tlbnNGb3JBZHZpc29ycyA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHdob3NlVG9rZW5zVG9XaXRoZHJhdyA9PSA0KQogICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZSAodG9rZW5zRm9yTWFya2V0aW5nID4gMCk7CiAgICAgICAgICAvL2FsbG93IHdpdGhkcmF3YWwKICAgICAgICAgIHRva2Vuc1RvU2VuZCA9IHRva2Vuc0Zvck1hcmtldGluZy5kaXYod2hlcmVUb1NlbmRUb2tlbnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgZm9yIChpPTA7aTx3aGVyZVRvU2VuZFRva2Vucy5sZW5ndGg7aSsrKQogICAgICAgICAgewogICAgICAgICAgICB0b2tlbi5taW50KHdhbGxldCx3aGVyZVRvU2VuZFRva2Vuc1tpXSx0b2tlbnNUb1NlbmQpOwogICAgICAgICAgfQogICAgICAgICAgdG9rZW5zRm9yTWFya2V0aW5nID0gMDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAod2hvc2VUb2tlbnNUb1dpdGhkcmF3ID09IDUpCiAgICAgICAgewogICAgICAgICAgICByZXF1aXJlICh0b2tlbnNGb3JUb3VybmFtZW50ID4gMCk7CiAgICAgICAgICAvL2FsbG93IHdpdGhkcmF3YWwKICAgICAgICAgIHRva2Vuc1RvU2VuZCA9IHRva2Vuc0ZvclRvdXJuYW1lbnQuZGl2KHdoZXJlVG9TZW5kVG9rZW5zLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgIGZvciAoaT0wO2k8d2hlcmVUb1NlbmRUb2tlbnMubGVuZ3RoO2krKykKICAgICAgICAgIHsKICAgICAgICAgICAgdG9rZW4ubWludCh3YWxsZXQsd2hlcmVUb1NlbmRUb2tlbnNbaV0sdG9rZW5zVG9TZW5kKTsKICAgICAgICAgIH0KICAgICAgICAgIHRva2Vuc0ZvclRvdXJuYW1lbnQgPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlIAogICAgICAgIHsKICAgICAgICAgIC8vd3JvbmcgaW5wdXQKICAgICAgICAgIHJlcXVpcmUgKDEhPTEpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
