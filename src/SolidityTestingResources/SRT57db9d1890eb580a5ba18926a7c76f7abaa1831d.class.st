Class {
	#name : #SRT57db9d1890eb580a5ba18926a7c76f7abaa1831d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT57db9d1890eb580a5ba18926a7c76f7abaa1831d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBCZHBCYXNlRGF0YSB7CgoJYWRkcmVzcyBwdWJsaWMgb3duZXJBZGRyZXNzOwoKCWFkZHJlc3MgcHVibGljIG1hbmFnZXJBZGRyZXNzOwoKCWFkZHJlc3NbMTZdIHB1YmxpYyBjb250cmFjdHM7CgoJYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoJYm9vbCBwdWJsaWMgc2V0dXBDb21wbGV0ZSA9IGZhbHNlOwoKCWJ5dGVzOCBwdWJsaWMgdmVyc2lvbjsKCn0KbGlicmFyeSBCZHBDb250cmFjdHMgewoKCWZ1bmN0aW9uIGdldEJkcEVudHJ5UG9pbnQoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbMF07Cgl9CgoJZnVuY3Rpb24gZ2V0QmRwQ29udHJvbGxlcihhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1sxXTsKCX0KCglmdW5jdGlvbiBnZXRCZHBDb250cm9sbGVySGVscGVyKGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBfY29udHJhY3RzWzNdOwoJfQoKCWZ1bmN0aW9uIGdldEJkcERhdGFTdG9yYWdlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBfY29udHJhY3RzWzRdOwoJfQoKCWZ1bmN0aW9uIGdldEJkcEltYWdlU3RvcmFnZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1s1XTsKCX0KCglmdW5jdGlvbiBnZXRCZHBPd25lcnNoaXBTdG9yYWdlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBfY29udHJhY3RzWzZdOwoJfQoKCWZ1bmN0aW9uIGdldEJkcFByaWNlU3RvcmFnZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1s3XTsKCX0KCn0KCmNvbnRyYWN0IEJkcEJhc2UgaXMgQmRwQmFzZURhdGEgewoKCW1vZGlmaWVyIG9ubHlPd25lcigpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJBZGRyZXNzKTsKCQlfOwoJfQoKCW1vZGlmaWVyIG9ubHlBdXRob3JpemVkKCkgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lckFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBtYW5hZ2VyQWRkcmVzcyk7CgkJXzsKCX0KCgltb2RpZmllciB3aGVuQ29udHJhY3RBY3RpdmUoKSB7CgkJcmVxdWlyZSghcGF1c2VkICYmIHNldHVwQ29tcGxldGUpOwoJCV87Cgl9CgoJbW9kaWZpZXIgc3RvcmFnZUFjY2Vzc0NvbnRyb2woKSB7CgkJcmVxdWlyZSgKCQkJKCEgc2V0dXBDb21wbGV0ZSAmJiAobXNnLnNlbmRlciA9PSBvd25lckFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBtYW5hZ2VyQWRkcmVzcykpCgkJCXx8IChzZXR1cENvbXBsZXRlICYmICFwYXVzZWQgJiYgKG1zZy5zZW5kZXIgPT0gQmRwQ29udHJhY3RzLmdldEJkcEVudHJ5UG9pbnQoY29udHJhY3RzKSkpCgkJKTsKCQlfOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVyKGFkZHJlc3MgX25ld093bmVyKSBleHRlcm5hbCBvbmx5T3duZXIgewoJCXJlcXVpcmUoX25ld093bmVyICE9IGFkZHJlc3MoMCkpOwoJCW93bmVyQWRkcmVzcyA9IF9uZXdPd25lcjsKCX0KCglmdW5jdGlvbiBzZXRNYW5hZ2VyKGFkZHJlc3MgX25ld01hbmFnZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CgkJcmVxdWlyZShfbmV3TWFuYWdlciAhPSBhZGRyZXNzKDApKTsKCQltYW5hZ2VyQWRkcmVzcyA9IF9uZXdNYW5hZ2VyOwoJfQoKCWZ1bmN0aW9uIHNldENvbnRyYWN0cyhhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBleHRlcm5hbCBvbmx5T3duZXIgewoJCWNvbnRyYWN0cyA9IF9jb250cmFjdHM7Cgl9CgoJZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5QXV0aG9yaXplZCB7CgkJcGF1c2VkID0gdHJ1ZTsKCX0KCglmdW5jdGlvbiB1bnBhdXNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKCQlwYXVzZWQgPSBmYWxzZTsKCX0KCglmdW5jdGlvbiBzZXRTZXR1cENvbXBsZXRlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKCQlzZXR1cENvbXBsZXRlID0gdHJ1ZTsKCX0KCglmdW5jdGlvbiBraWxsKCkgcHVibGljIG9ubHlPd25lciB7CgkJc2VsZmRlc3RydWN0KG93bmVyQWRkcmVzcyk7Cgl9Cgp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgQmRwRGF0YVN0b3JhZ2UgaXMgQmRwQmFzZSB7CgoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJc3RydWN0IFJlZ2lvbiB7CgkJdWludDI1NiB4MTsKCQl1aW50MjU2IHkxOwoJCXVpbnQyNTYgeDI7CgkJdWludDI1NiB5MjsKCQl1aW50MjU2IGN1cnJlbnRJbWFnZUlkOwoJCXVpbnQyNTYgbmV4dEltYWdlSWQ7CgkJdWludDhbMTI4XSB1cmw7CgkJdWludDI1NiBjdXJyZW50UGl4ZWxQcmljZTsKCQl1aW50MjU2IGJsb2NrVXBkYXRlZEF0OwoJCXVpbnQyNTYgdXBkYXRlZEF0OwoJCXVpbnQyNTYgcHVyY2hhc2VkQXQ7CgkJdWludDI1NiBwdXJjaGFzZWRQaXhlbFByaWNlOwoJfQoKCXVpbnQyNTYgcHVibGljIGxhc3RSZWdpb25JZCA9IDA7CgoJbWFwcGluZyAodWludDI1NiA9PiBSZWdpb24pIHB1YmxpYyBkYXRhOwoKCglmdW5jdGlvbiBnZXRMYXN0UmVnaW9uSWQoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGxhc3RSZWdpb25JZDsKCX0KCglmdW5jdGlvbiBnZXROZXh0UmVnaW9uSWQoKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCWxhc3RSZWdpb25JZCA9IGxhc3RSZWdpb25JZC5hZGQoMSk7CgkJcmV0dXJuIGxhc3RSZWdpb25JZDsKCX0KCglmdW5jdGlvbiBkZWxldGVSZWdpb25EYXRhKHVpbnQyNTYgX2lkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRlbGV0ZSBkYXRhW19pZF07Cgl9CgoJZnVuY3Rpb24gZ2V0UmVnaW9uQ29vcmRpbmF0ZXModWludDI1NiBfaWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYpIHsKCQlyZXR1cm4gKGRhdGFbX2lkXS54MSwgZGF0YVtfaWRdLnkxLCBkYXRhW19pZF0ueDIsIGRhdGFbX2lkXS55Mik7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uQ29vcmRpbmF0ZXModWludDI1NiBfaWQsIHVpbnQyNTYgX3gxLCB1aW50MjU2IF95MSwgdWludDI1NiBfeDIsIHVpbnQyNTYgX3kyKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS54MSA9IF94MTsKCQlkYXRhW19pZF0ueTEgPSBfeTE7CgkJZGF0YVtfaWRdLngyID0gX3gyOwoJCWRhdGFbX2lkXS55MiA9IF95MjsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25DdXJyZW50SW1hZ2VJZCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0uY3VycmVudEltYWdlSWQ7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uQ3VycmVudEltYWdlSWQodWludDI1NiBfaWQsIHVpbnQyNTYgX2N1cnJlbnRJbWFnZUlkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5jdXJyZW50SW1hZ2VJZCA9IF9jdXJyZW50SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25OZXh0SW1hZ2VJZCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0ubmV4dEltYWdlSWQ7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uTmV4dEltYWdlSWQodWludDI1NiBfaWQsIHVpbnQyNTYgX25leHRJbWFnZUlkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5uZXh0SW1hZ2VJZCA9IF9uZXh0SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25VcmwodWludDI1NiBfaWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQ4WzEyOF0pIHsKCQlyZXR1cm4gZGF0YVtfaWRdLnVybDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25VcmwodWludDI1NiBfaWQsIHVpbnQ4WzEyOF0gX3VybCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlkYXRhW19pZF0udXJsID0gX3VybDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25DdXJyZW50UGl4ZWxQcmljZSh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0uY3VycmVudFBpeGVsUHJpY2U7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uQ3VycmVudFBpeGVsUHJpY2UodWludDI1NiBfaWQsIHVpbnQyNTYgX2N1cnJlbnRQaXhlbFByaWNlKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5jdXJyZW50UGl4ZWxQcmljZSA9IF9jdXJyZW50UGl4ZWxQcmljZTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25CbG9ja1VwZGF0ZWRBdCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0uYmxvY2tVcGRhdGVkQXQ7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uQmxvY2tVcGRhdGVkQXQodWludDI1NiBfaWQsIHVpbnQyNTYgX2Jsb2NrVXBkYXRlZEF0KSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5ibG9ja1VwZGF0ZWRBdCA9IF9ibG9ja1VwZGF0ZWRBdDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25VcGRhdGVkQXQodWludDI1NiBfaWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gZGF0YVtfaWRdLnVwZGF0ZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25VcGRhdGVkQXQodWludDI1NiBfaWQsIHVpbnQyNTYgX3VwZGF0ZWRBdCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlkYXRhW19pZF0udXBkYXRlZEF0ID0gX3VwZGF0ZWRBdDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25QdXJjaGFzZWRBdCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0ucHVyY2hhc2VkQXQ7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uUHVyY2hhc2VkQXQodWludDI1NiBfaWQsIHVpbnQyNTYgX3B1cmNoYXNlZEF0KSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5wdXJjaGFzZWRBdCA9IF9wdXJjaGFzZWRBdDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25VcGRhdGVkQXRQdXJjaGFzZWRBdCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfdXBkYXRlZEF0LCB1aW50MjU2IF9wdXJjaGFzZWRBdCkgewoJCXJldHVybiAoZGF0YVtfaWRdLnVwZGF0ZWRBdCwgZGF0YVtfaWRdLnB1cmNoYXNlZEF0KTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25QdXJjaGFzZVBpeGVsUHJpY2UodWludDI1NiBfaWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gZGF0YVtfaWRdLnB1cmNoYXNlZFBpeGVsUHJpY2U7Cgl9CgoJZnVuY3Rpb24gc2V0UmVnaW9uUHVyY2hhc2VkUGl4ZWxQcmljZSh1aW50MjU2IF9pZCwgdWludDI1NiBfcHVyY2hhc2VkUGl4ZWxQcmljZSkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlkYXRhW19pZF0ucHVyY2hhc2VkUGl4ZWxQcmljZSA9IF9wdXJjaGFzZWRQaXhlbFByaWNlOwoJfQoKCWZ1bmN0aW9uIEJkcERhdGFTdG9yYWdlKGJ5dGVzOCBfdmVyc2lvbikgcHVibGljIHsKCQlvd25lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCW1hbmFnZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKCQl2ZXJzaW9uID0gX3ZlcnNpb247Cgl9Cgp9Cgpjb250cmFjdCBCZHBQcmljZVN0b3JhZ2UgaXMgQmRwQmFzZSB7CgoJdWludDY0WzEwMDFdIHB1YmxpYyBwcmljZVBvaW50czsKCgl1aW50MjU2IHB1YmxpYyBwcmljZVBvaW50c0xlbmd0aCA9IDA7CgoJYWRkcmVzcyBwdWJsaWMgZm9yd2FyZFB1cmNoYXNlRmVlc1RvID0gYWRkcmVzcygwKTsKCglhZGRyZXNzIHB1YmxpYyBmb3J3YXJkVXBkYXRlRmVlc1RvID0gYWRkcmVzcygwKTsKCgoJZnVuY3Rpb24gZ2V0UHJpY2VQb2ludHNMZW5ndGgoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIHByaWNlUG9pbnRzTGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGdldFByaWNlUG9pbnQodWludDI1NiBfaSkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBwcmljZVBvaW50c1tfaV07Cgl9CgoJZnVuY3Rpb24gc2V0UHJpY2VQb2ludHModWludDY0W10gX3ByaWNlUG9pbnRzKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXByaWNlUG9pbnRzTGVuZ3RoID0gMDsKCQlhcHBlbmRQcmljZVBvaW50cyhfcHJpY2VQb2ludHMpOwoJfQoKCWZ1bmN0aW9uIGFwcGVuZFByaWNlUG9pbnRzKHVpbnQ2NFtdIF9wcmljZVBvaW50cykgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlmb3IgKHVpbnQgaSA9IDA7IGkgPCBfcHJpY2VQb2ludHMubGVuZ3RoOyBpKyspIHsKCQkJcHJpY2VQb2ludHNbcHJpY2VQb2ludHNMZW5ndGgrK10gPSBfcHJpY2VQb2ludHNbaV07CgkJfQoJfQoKCWZ1bmN0aW9uIGdldEZvcndhcmRQdXJjaGFzZUZlZXNUbygpIHZpZXcgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gZm9yd2FyZFB1cmNoYXNlRmVlc1RvOwoJfQoKCWZ1bmN0aW9uIHNldEZvcndhcmRQdXJjaGFzZUZlZXNUbyhhZGRyZXNzIF9mb3J3YXJkUHVyY2hhc2VGZWVzVG8pIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZm9yd2FyZFB1cmNoYXNlRmVlc1RvID0gX2ZvcndhcmRQdXJjaGFzZUZlZXNUbzsKCX0KCglmdW5jdGlvbiBnZXRGb3J3YXJkVXBkYXRlRmVlc1RvKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBmb3J3YXJkVXBkYXRlRmVlc1RvOwoJfQoKCWZ1bmN0aW9uIHNldEZvcndhcmRVcGRhdGVGZWVzVG8oYWRkcmVzcyBfZm9yd2FyZFVwZGF0ZUZlZXNUbykgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlmb3J3YXJkVXBkYXRlRmVlc1RvID0gX2ZvcndhcmRVcGRhdGVGZWVzVG87Cgl9CgoJZnVuY3Rpb24gQmRwUHJpY2VTdG9yYWdlKGJ5dGVzOCBfdmVyc2lvbikgcHVibGljIHsKCQlvd25lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCW1hbmFnZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKCQl2ZXJzaW9uID0gX3ZlcnNpb247Cgl9Cgp9CgpsaWJyYXJ5IEJkcENhbGN1bGF0b3IgewoKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCWZ1bmN0aW9uIGNhbGN1bGF0ZUFyZWEoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYgX2FyZWEsIHVpbnQyNTYgX3dpZHRoLCB1aW50MjU2IF9oZWlnaHQpIHsKCQl2YXIgKHgxLCB5MSwgeDIsIHkyKSA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0UmVnaW9uQ29vcmRpbmF0ZXMoX3JlZ2lvbklkKTsKCQlfd2lkdGggPSB4MiAtIHgxICsgMTsKCQlfaGVpZ2h0ID0geTIgLSB5MSArIDE7CgkJX2FyZWEgPSBfd2lkdGggKiBfaGVpZ2h0OwoJfQoKCWZ1bmN0aW9uIGNvdW50UHVyY2hhc2VkUGl4ZWxzKGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYgX2NvdW50KSB7CgkJdmFyIGxhc3RSZWdpb25JZCA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0TGFzdFJlZ2lvbklkKCk7CgkJZm9yICh1aW50MjU2IGkgPSAwOyBpIDw9IGxhc3RSZWdpb25JZDsgaSsrKSB7CgkJCWlmKEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0UmVnaW9uUHVyY2hhc2VkQXQoaSkgPiAwKSB7IC8vIHJlZ2lvbiBpcyBwdXJjaGFzZWQKCQkJCXZhciAoYXJlYSwsKSA9IGNhbGN1bGF0ZUFyZWEoX2NvbnRyYWN0cywgaSk7CgkJCQlfY291bnQgKz0gYXJlYTsKCQkJfQoJCX0KCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVDdXJyZW50TWFya2V0UGl4ZWxQcmljZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSB2aWV3IHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKCQlyZXR1cm4gY2FsY3VsYXRlTWFya2V0UGl4ZWxQcmljZShfY29udHJhY3RzLCBjb3VudFB1cmNoYXNlZFBpeGVscyhfY29udHJhY3RzKSk7Cgl9CgoJZnVuY3Rpb24gY2FsY3VsYXRlTWFya2V0UGl4ZWxQcmljZShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50IF9waXhlbHNTb2xkKSB2aWV3IHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKCQl2YXIgcHJpY2VQb2ludHNMZW5ndGggPSBCZHBQcmljZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcFByaWNlU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0UHJpY2VQb2ludHNMZW5ndGgoKTsKCQl1aW50IG1vZCA9IF9waXhlbHNTb2xkICUgKDEwMDAwMDAgLyAocHJpY2VQb2ludHNMZW5ndGggLSAxKSk7CgkJdWludCBkaXYgPSBfcGl4ZWxzU29sZCAqIChwcmljZVBvaW50c0xlbmd0aCAtIDEpIC8gMTAwMDAwMDsKCQl2YXIgZGl2UG9pbnQgPSBCZHBQcmljZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcFByaWNlU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0UHJpY2VQb2ludChkaXYpOwoJCWlmKG1vZCA9PSAwKSByZXR1cm4gZGl2UG9pbnQ7CgkJcmV0dXJuIGRpdlBvaW50ICsgbW9kICogKEJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRQcmljZVBvaW50KGRpdisxKSAtIGRpdlBvaW50KSAqIChwcmljZVBvaW50c0xlbmd0aCAtIDEpIC8gMTAwMDAwMDsKCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVBdmVyYWdlUGl4ZWxQcmljZShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50IF9hLCB1aW50IF9iKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IF9wcmljZSkgewoJCV9wcmljZSA9IChjYWxjdWxhdGVNYXJrZXRQaXhlbFByaWNlKF9jb250cmFjdHMsIF9hKSArIGNhbGN1bGF0ZU1hcmtldFBpeGVsUHJpY2UoX2NvbnRyYWN0cywgX2IpKSAvIDI7Cgl9CgoJLyoqIEN1cnJlbnQgbWFya2V0IHByaWNlIHBlciBwaXhlbCBmb3IgdGhpcyByZWdpb24gaWYgaXQgaXMgdGhlIGZpcnN0IHNhbGUgb2YgdGhpcyByZWdpb24KCSAgKi8KCWZ1bmN0aW9uIGNhbGN1bGF0ZVJlZ2lvbkluaXRpYWxTYWxlUGl4ZWxQcmljZShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJlcXVpcmUoQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRSZWdpb25VcGRhdGVkQXQoX3JlZ2lvbklkKSA+IDApOyAvLyByZWdpb24gZXhpc3RzCgkJdmFyIHB1cmNoYXNlZFBpeGVscyA9IGNvdW50UHVyY2hhc2VkUGl4ZWxzKF9jb250cmFjdHMpOwoJCXZhciAoYXJlYSwsKSA9IGNhbGN1bGF0ZUFyZWEoX2NvbnRyYWN0cywgX3JlZ2lvbklkKTsKCQlyZXR1cm4gY2FsY3VsYXRlQXZlcmFnZVBpeGVsUHJpY2UoX2NvbnRyYWN0cywgcHVyY2hhc2VkUGl4ZWxzLCBwdXJjaGFzZWRQaXhlbHMgKyBhcmVhKTsKCX0KCgkvKiogQ3VycmVudCBtYXJrZXQgcHJpY2Ugb3IgKEN1cnJlbnQgbWFya2V0IHByaWNlKSozIGlmIHRoZSByZWdpb24gd2FzIHNvbGQKCSAgKi8KCWZ1bmN0aW9uIGNhbGN1bGF0ZVJlZ2lvblNhbGVQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJdmFyIHBpeGVsUHJpY2UgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlKF9yZWdpb25JZCk7CgkJaWYocGl4ZWxQcmljZSA+IDApIHsKCQkJcmV0dXJuIHBpeGVsUHJpY2UgKiAzOwoJCX0gZWxzZSB7CgkJCXJldHVybiBjYWxjdWxhdGVSZWdpb25Jbml0aWFsU2FsZVBpeGVsUHJpY2UoX2NvbnRyYWN0cywgX3JlZ2lvbklkKTsKCQl9Cgl9CgoJLyoqIFNldHVwIGlzIGFsbG93ZWQgb25lIHdoaXRoaW4gb25lIGRheSBhZnRlciBwdXJjaGFzZQoJICAqLwoJZnVuY3Rpb24gY2FsY3VsYXRlU2V0dXBBbGxvd2VkVW50aWwoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQl2YXIgKHVwZGF0ZWRBdCwgcHVyY2hhc2VkQXQpID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRSZWdpb25VcGRhdGVkQXRQdXJjaGFzZWRBdChfcmVnaW9uSWQpOwoJCWlmKHVwZGF0ZWRBdCAhPSBwdXJjaGFzZWRBdCkgewoJCQlyZXR1cm4gMDsKCQl9IGVsc2UgewoJCQlyZXR1cm4gcHVyY2hhc2VkQXQgKyAxIGRheXM7CgkJfQoJfQoKfQoKY29udHJhY3QgQmRwT3duZXJzaGlwU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCgkvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gb3duZXIKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuT3duZXI7CgoJLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGFwcHJvdmVkIGFkZHJlc3MKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuQXBwcm92YWxzOwoKCS8vIE1hcHBpbmcgZnJvbSBvd25lciB0byB0aGUgc3VtIG9mIG93bmVkIGFyZWEKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG93bmVkQXJlYTsKCgkvLyBNYXBwaW5nIGZyb20gb3duZXIgdG8gbGlzdCBvZiBvd25lZCB0b2tlbiBJRHMKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NltdKSBwdWJsaWMgb3duZWRUb2tlbnM7CgoJLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGluZGV4IG9mIHRoZSBvd25lciB0b2tlbnMgbGlzdAoJbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBvd25lZFRva2Vuc0luZGV4OwoKCS8vIEFsbCB0b2tlbnMgbGlzdCB0b2tlbnMgaWRzCgl1aW50MjU2W10gcHVibGljIHRva2VuSWRzOwoKCS8vIE1hcHBpbmcgZnJvbSB0b2tlbklkIHRvIGluZGV4IG9mIHRoZSB0b2tlbnMgbGlzdAoJbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5JZHNJbmRleDsKCgoJZnVuY3Rpb24gZ2V0VG9rZW5Pd25lcih1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIHRva2VuT3duZXJbX3Rva2VuSWRdOwoJfQoKCWZ1bmN0aW9uIHNldFRva2VuT3duZXIodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJdG9rZW5Pd25lcltfdG9rZW5JZF0gPSBfb3duZXI7Cgl9CgoJZnVuY3Rpb24gZ2V0VG9rZW5BcHByb3ZhbCh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIHRva2VuQXBwcm92YWxzW190b2tlbklkXTsKCX0KCglmdW5jdGlvbiBzZXRUb2tlbkFwcHJvdmFsKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3RvKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IF90bzsKCX0KCglmdW5jdGlvbiBnZXRPd25lZEFyZWEoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gc2V0T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkQXJlYVtfb3duZXJdID0gX2FyZWE7Cgl9CgoJZnVuY3Rpb24gaW5jcmVtZW50T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkQXJlYVtfb3duZXJdID0gb3duZWRBcmVhW19vd25lcl0uYWRkKF9hcmVhKTsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gZGVjcmVtZW50T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkQXJlYVtfb3duZXJdID0gb3duZWRBcmVhW19vd25lcl0uc3ViKF9hcmVhKTsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbnNMZW5ndGgoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXS5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbihhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXVtfaW5kZXhdOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVkVG9rZW4oYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4LCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkVG9rZW5zW19vd25lcl1bX2luZGV4XSA9IF90b2tlbklkOwoJfQoKCWZ1bmN0aW9uIHB1c2hPd25lZFRva2VuKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkVG9rZW5zW19vd25lcl0ucHVzaChfdG9rZW5JZCk7CgkJcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGRlY3JlbWVudE93bmVkVG9rZW5zTGVuZ3RoKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoLS07Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbnNJbmRleCh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIG93bmVkVG9rZW5zSW5kZXhbX3Rva2VuSWRdOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVkVG9rZW5zSW5kZXgodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfdG9rZW5JbmRleCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlvd25lZFRva2Vuc0luZGV4W190b2tlbklkXSA9IF90b2tlbkluZGV4OwoJfQoKCWZ1bmN0aW9uIGdldFRva2VuSWRzTGVuZ3RoKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiB0b2tlbklkcy5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0VG9rZW5JZEJ5SW5kZXgodWludDI1NiBfaW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gdG9rZW5JZHNbX2luZGV4XTsKCX0KCglmdW5jdGlvbiBzZXRUb2tlbklkQnlJbmRleCh1aW50MjU2IF9pbmRleCwgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQl0b2tlbklkc1tfaW5kZXhdID0gX3Rva2VuSWQ7Cgl9CgoJZnVuY3Rpb24gcHVzaFRva2VuSWQodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHJldHVybnMgKHVpbnQyNTYpIHsKCQl0b2tlbklkcy5wdXNoKF90b2tlbklkKTsKCQlyZXR1cm4gdG9rZW5JZHMubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGRlY3JlbWVudFRva2VuSWRzTGVuZ3RoKCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQl0b2tlbklkcy5sZW5ndGgtLTsKCX0KCglmdW5jdGlvbiBnZXRUb2tlbklkc0luZGV4KHVpbnQyNTYgX3Rva2VuSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gdG9rZW5JZHNJbmRleFtfdG9rZW5JZF07Cgl9CgoJZnVuY3Rpb24gc2V0VG9rZW5JZHNJbmRleCh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF90b2tlbklkSW5kZXgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJdG9rZW5JZHNJbmRleFtfdG9rZW5JZF0gPSBfdG9rZW5JZEluZGV4OwoJfQoKCWZ1bmN0aW9uIEJkcE93bmVyc2hpcFN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCmxpYnJhcnkgQmRwT3duZXJzaGlwIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCglldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CgoJZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKCglmdW5jdGlvbiBvd25lck9mKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKCQl2YXIgb3duZXIgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRUb2tlbk93bmVyKF90b2tlbklkKTsKCQlyZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwoJCXJldHVybiBvd25lcjsKCX0KCglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0T3duZWRUb2tlbnNMZW5ndGgoX293bmVyKTsKCX0KCglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewoJCXZhciBvd25TdG9yYWdlID0gQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCWFkZHJlc3Mgb3duZXIgPSBvd25lck9mKF9jb250cmFjdHMsIF90b2tlbklkKTsKCQlyZXF1aXJlKF90byAhPSBvd25lcik7CgkJaWYgKG93blN0b3JhZ2UuZ2V0VG9rZW5BcHByb3ZhbChfdG9rZW5JZCkgIT0gMCB8fCBfdG8gIT0gMCkgewoJCQlvd25TdG9yYWdlLnNldFRva2VuQXBwcm92YWwoX3Rva2VuSWQsIF90byk7CgkJCUFwcHJvdmFsKG93bmVyLCBfdG8sIF90b2tlbklkKTsKCQl9Cgl9CgoJLyoqCgkgKiBAZGV2IENsZWFyIGN1cnJlbnQgYXBwcm92YWwgb2YgYSBnaXZlbiB0b2tlbiBJRAoJICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCgkgKi8KCWZ1bmN0aW9uIGNsZWFyQXBwcm92YWwoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJdmFyIG93blN0b3JhZ2UgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKTsKCgkJcmVxdWlyZShvd25lck9mKF9jb250cmFjdHMsIF90b2tlbklkKSA9PSBfb3duZXIpOwoJCWlmIChvd25TdG9yYWdlLmdldFRva2VuQXBwcm92YWwoX3Rva2VuSWQpICE9IDApIHsKCQkJQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSkuc2V0VG9rZW5BcHByb3ZhbChfdG9rZW5JZCwgMCk7CgkJCUFwcHJvdmFsKF9vd25lciwgMCwgX3Rva2VuSWQpOwoJCX0KCX0KCgkvKioKCSAqIEBkZXYgQ2xlYXIgY3VycmVudCBhcHByb3ZhbCBhbmQgdHJhbnNmZXIgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECgkgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCgkgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdGhlIHRva2VuIHRvCgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCSAqLwoJZnVuY3Rpb24gY2xlYXJBcHByb3ZhbEFuZFRyYW5zZmVyKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewoJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCXJlcXVpcmUoX3RvICE9IG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpKTsKCQlyZXF1aXJlKG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpID09IF9mcm9tKTsKCgkJY2xlYXJBcHByb3ZhbChfY29udHJhY3RzLCBfZnJvbSwgX3Rva2VuSWQpOwoJCXJlbW92ZVRva2VuKF9jb250cmFjdHMsIF9mcm9tLCBfdG9rZW5JZCk7CgkJYWRkVG9rZW4oX2NvbnRyYWN0cywgX3RvLCBfdG9rZW5JZCk7CgkJVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwoJfQoKCS8qKgoJICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBhZGQgYSB0b2tlbiBJRCB0byB0aGUgbGlzdCBvZiBhIGdpdmVuIGFkZHJlc3MKCSAqIEBwYXJhbSBfdG8gYWRkcmVzcyByZXByZXNlbnRpbmcgdGhlIG5ldyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSBhZGRlZCB0byB0aGUgdG9rZW5zIGxpc3Qgb2YgdGhlIGdpdmVuIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gYWRkVG9rZW4oYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewoJCXZhciBvd25TdG9yYWdlID0gQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCXJlcXVpcmUob3duU3RvcmFnZS5nZXRUb2tlbk93bmVyKF90b2tlbklkKSA9PSBhZGRyZXNzKDApKTsKCgkJLy8gU2V0IHRva2VuIG93bmVyCgkJb3duU3RvcmFnZS5zZXRUb2tlbk93bmVyKF90b2tlbklkLCBfdG8pOwoKCQkvLyBBZGQgdG9rZW4gdG8gdG9rZW5JZHMgbGlzdAoJCXZhciB0b2tlbklkc0xlbmd0aCA9IG93blN0b3JhZ2UucHVzaFRva2VuSWQoX3Rva2VuSWQpOwoJCW93blN0b3JhZ2Uuc2V0VG9rZW5JZHNJbmRleChfdG9rZW5JZCwgdG9rZW5JZHNMZW5ndGguc3ViKDEpKTsKCgkJdWludDI1NiBvd25lZFRva2Vuc0xlbmd0aCA9IG93blN0b3JhZ2UuZ2V0T3duZWRUb2tlbnNMZW5ndGgoX3RvKTsKCgkJLy8gQWRkIHRva2VuIHRvIG93bmVkVG9rZW5zIGxpc3QKCQlvd25TdG9yYWdlLnB1c2hPd25lZFRva2VuKF90bywgX3Rva2VuSWQpOwoJCW93blN0b3JhZ2Uuc2V0T3duZWRUb2tlbnNJbmRleChfdG9rZW5JZCwgb3duZWRUb2tlbnNMZW5ndGgpOwoKCQkvLyBJbmNyZW1lbnQgdG90YWwgb3duZWQgYXJlYQoJCXZhciAoYXJlYSwsKSA9IEJkcENhbGN1bGF0b3IuY2FsY3VsYXRlQXJlYShfY29udHJhY3RzLCBfdG9rZW5JZCk7CgkJb3duU3RvcmFnZS5pbmNyZW1lbnRPd25lZEFyZWEoX3RvLCBhcmVhKTsKCX0KCgkvKioKCSAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gcmVtb3ZlIGEgdG9rZW4gSUQgZnJvbSB0aGUgbGlzdCBvZiBhIGdpdmVuIGFkZHJlc3MKCSAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIHJlcHJlc2VudGluZyB0aGUgcHJldmlvdXMgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSB0b2tlbnMgbGlzdCBvZiB0aGUgZ2l2ZW4gYWRkcmVzcwoJICovCglmdW5jdGlvbiByZW1vdmVUb2tlbihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKCQl2YXIgb3duU3RvcmFnZSA9IEJkcE93bmVyc2hpcFN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcE93bmVyc2hpcFN0b3JhZ2UoX2NvbnRyYWN0cykpOwoKCQlyZXF1aXJlKG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpID09IF9mcm9tKTsKCgkJLy8gQ2xlYXIgdG9rZW4gb3duZXIKCQlvd25TdG9yYWdlLnNldFRva2VuT3duZXIoX3Rva2VuSWQsIDApOwoKCQlyZW1vdmVGcm9tVG9rZW5JZHMob3duU3RvcmFnZSwgX3Rva2VuSWQpOwoJCXJlbW92ZUZyb21Pd25lZFRva2VuKG93blN0b3JhZ2UsIF9mcm9tLCBfdG9rZW5JZCk7CgoJCS8vIERlY3JlbWVudCB0b3RhbCBvd25lZCBhcmVhCgkJdmFyIChhcmVhLCwpID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBcmVhKF9jb250cmFjdHMsIF90b2tlbklkKTsKCQlvd25TdG9yYWdlLmRlY3JlbWVudE93bmVkQXJlYShfZnJvbSwgYXJlYSk7Cgl9CgoJLyoqCgkgKiBAZGV2IFJlbW92ZSB0b2tlbiBmcm9tIG93bmVkVG9rZW5zIGxpc3QKCSAqIE5vdGUgdGhhdCB0aGlzIHdpbGwgaGFuZGxlIHNpbmdsZS1lbGVtZW50IGFycmF5cy4gSW4gdGhhdCBjYXNlLCBib3RoIG93bmVkVG9rZW5JbmRleCBhbmQgbGFzdE93bmVkVG9rZW5JbmRleCBhcmUgZ29pbmcgdG8KCSAqIGJlIHplcm8uIFRoZW4gd2UgY2FuIG1ha2Ugc3VyZSB0aGF0IHdlIHdpbGwgcmVtb3ZlIF90b2tlbklkIGZyb20gdGhlIG93bmVkVG9rZW5zIGxpc3Qgc2luY2Ugd2UgYXJlIGZpcnN0IHN3YXBwaW5nCgkgKiB0aGUgbGFzdE93bmVkVG9rZW4gdG8gdGhlIGZpcnN0IHBvc2l0aW9uLCBhbmQgdGhlbiBkcm9wcGluZyB0aGUgZWxlbWVudCBwbGFjZWQgaW4gdGhlIGxhc3QgcG9zaXRpb24gb2YgdGhlIGxpc3QKCSAqLwoJZnVuY3Rpb24gcmVtb3ZlRnJvbU93bmVkVG9rZW4oQmRwT3duZXJzaGlwU3RvcmFnZSBfb3duU3RvcmFnZSwgYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB7CgkJdmFyIG93bmVkVG9rZW5JbmRleCA9IF9vd25TdG9yYWdlLmdldE93bmVkVG9rZW5zSW5kZXgoX3Rva2VuSWQpOwoJCXZhciBsYXN0T3duZWRUb2tlbkluZGV4ID0gX293blN0b3JhZ2UuZ2V0T3duZWRUb2tlbnNMZW5ndGgoX2Zyb20pLnN1YigxKTsKCQl2YXIgbGFzdE93bmVkVG9rZW4gPSBfb3duU3RvcmFnZS5nZXRPd25lZFRva2VuKF9mcm9tLCBsYXN0T3duZWRUb2tlbkluZGV4KTsKCQlfb3duU3RvcmFnZS5zZXRPd25lZFRva2VuKF9mcm9tLCBvd25lZFRva2VuSW5kZXgsIGxhc3RPd25lZFRva2VuKTsKCQlfb3duU3RvcmFnZS5zZXRPd25lZFRva2VuKF9mcm9tLCBsYXN0T3duZWRUb2tlbkluZGV4LCAwKTsKCQlfb3duU3RvcmFnZS5kZWNyZW1lbnRPd25lZFRva2Vuc0xlbmd0aChfZnJvbSk7CgkJX293blN0b3JhZ2Uuc2V0T3duZWRUb2tlbnNJbmRleChfdG9rZW5JZCwgMCk7CgkJX293blN0b3JhZ2Uuc2V0T3duZWRUb2tlbnNJbmRleChsYXN0T3duZWRUb2tlbiwgb3duZWRUb2tlbkluZGV4KTsKCX0KCgkvKioKCSAqIEBkZXYgUmVtb3ZlIHRva2VuIGZyb20gdG9rZW5JZHMgbGlzdAoJICovCglmdW5jdGlvbiByZW1vdmVGcm9tVG9rZW5JZHMoQmRwT3duZXJzaGlwU3RvcmFnZSBfb3duU3RvcmFnZSwgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB7CgkJdmFyIHRva2VuSW5kZXggPSBfb3duU3RvcmFnZS5nZXRUb2tlbklkc0luZGV4KF90b2tlbklkKTsKCQl2YXIgbGFzdFRva2VuSWRJbmRleCA9IF9vd25TdG9yYWdlLmdldFRva2VuSWRzTGVuZ3RoKCkuc3ViKDEpOwoJCXZhciBsYXN0VG9rZW5JZCA9IF9vd25TdG9yYWdlLmdldFRva2VuSWRCeUluZGV4KGxhc3RUb2tlbklkSW5kZXgpOwoJCV9vd25TdG9yYWdlLnNldFRva2VuSWRCeUluZGV4KHRva2VuSW5kZXgsIGxhc3RUb2tlbklkKTsKCQlfb3duU3RvcmFnZS5zZXRUb2tlbklkQnlJbmRleChsYXN0VG9rZW5JZEluZGV4LCAwKTsKCQlfb3duU3RvcmFnZS5kZWNyZW1lbnRUb2tlbklkc0xlbmd0aCgpOwoJCV9vd25TdG9yYWdlLnNldFRva2VuSWRzSW5kZXgoX3Rva2VuSWQsIDApOwoJCV9vd25TdG9yYWdlLnNldFRva2VuSWRzSW5kZXgobGFzdFRva2VuSWQsIHRva2VuSW5kZXgpOwoJfQoKCS8qKgoJICogQGRldiBNaW50IHRva2VuIGZ1bmN0aW9uCgkgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBvd24gdGhlIG1pbnRlZCB0b2tlbgoJICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIG1pbnRlZCBieSB0aGUgbXNnLnNlbmRlcgoJICovCglmdW5jdGlvbiBtaW50KGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewoJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCWFkZFRva2VuKF9jb250cmFjdHMsIF90bywgX3Rva2VuSWQpOwoJCVRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX3Rva2VuSWQpOwoJfQoKCS8qKgoJICogQGRldiBCdXJucyBhIHNwZWNpZmljIHRva2VuCgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gYmVpbmcgYnVybmVkCgkgKi8KCWZ1bmN0aW9uIGJ1cm4oYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHsKCQlhZGRyZXNzIG93bmVyID0gQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0VG9rZW5Pd25lcihfdG9rZW5JZCk7CgkJY2xlYXJBcHByb3ZhbChfY29udHJhY3RzLCBvd25lciwgX3Rva2VuSWQpOwoJCXJlbW92ZVRva2VuKF9jb250cmFjdHMsIG93bmVyLCBfdG9rZW5JZCk7CgkJVHJhbnNmZXIob3duZXIsIGFkZHJlc3MoMCksIF90b2tlbklkKTsKCX0KCn0KCmNvbnRyYWN0IEJkcEltYWdlU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCglzdHJ1Y3QgSW1hZ2UgewoJCWFkZHJlc3Mgb3duZXI7CgkJdWludDI1NiByZWdpb25JZDsKCQl1aW50MjU2IGN1cnJlbnRSZWdpb25JZDsKCQltYXBwaW5nKHVpbnQxNiA9PiB1aW50MjU2WzEwMDBdKSBkYXRhOwoJCW1hcHBpbmcodWludDE2ID0+IHVpbnQxNikgZGF0YUxlbmd0aDsKCQl1aW50MTYgcGFydHNDb3VudDsKCQl1aW50MTYgd2lkdGg7CgkJdWludDE2IGhlaWdodDsKCQl1aW50MTYgaW1hZ2VEZXNjcmlwdG9yOwoJCXVpbnQyNTYgYmx1cnJlZEF0OwoJfQoKCXVpbnQyNTYgcHVibGljIGxhc3RJbWFnZUlkID0gMDsKCgltYXBwaW5nKHVpbnQyNTYgPT4gSW1hZ2UpIHB1YmxpYyBpbWFnZXM7CgoKCWZ1bmN0aW9uIGdldExhc3RJbWFnZUlkKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBsYXN0SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBnZXROZXh0SW1hZ2VJZCgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCByZXR1cm5zICh1aW50MjU2KSB7CgkJbGFzdEltYWdlSWQgPSBsYXN0SW1hZ2VJZC5hZGQoMSk7CgkJcmV0dXJuIGxhc3RJbWFnZUlkOwoJfQoKCWZ1bmN0aW9uIGNyZWF0ZUltYWdlKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDE2IF93aWR0aCwgdWludDE2IF9oZWlnaHQsIHVpbnQxNiBfcGFydHNDb3VudCwgdWludDE2IF9pbWFnZURlc2NyaXB0b3IpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCByZXR1cm5zICh1aW50MjU2KSB7CgkJcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSAmJiBfd2lkdGggPiAwICYmIF9oZWlnaHQgPiAwICYmIF9wYXJ0c0NvdW50ID4gMCAmJiBfaW1hZ2VEZXNjcmlwdG9yID4gMCk7CgkJdWludDI1NiBpZCA9IGdldE5leHRJbWFnZUlkKCk7CgkJaW1hZ2VzW2lkXS5vd25lciA9IF9vd25lcjsKCQlpbWFnZXNbaWRdLnJlZ2lvbklkID0gX3JlZ2lvbklkOwoJCWltYWdlc1tpZF0ud2lkdGggPSBfd2lkdGg7CgkJaW1hZ2VzW2lkXS5oZWlnaHQgPSBfaGVpZ2h0OwoJCWltYWdlc1tpZF0ucGFydHNDb3VudCA9IF9wYXJ0c0NvdW50OwoJCWltYWdlc1tpZF0uaW1hZ2VEZXNjcmlwdG9yID0gX2ltYWdlRGVzY3JpcHRvcjsKCQlyZXR1cm4gaWQ7Cgl9CgoJZnVuY3Rpb24gaW1hZ2VFeGlzdHModWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJldHVybiBfaW1hZ2VJZCA+IDAgJiYgaW1hZ2VzW19pbWFnZUlkXS5vd25lciAhPSBhZGRyZXNzKDApOwoJfQoKCWZ1bmN0aW9uIGRlbGV0ZUltYWdlKHVpbnQyNTYgX2ltYWdlSWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJcmVxdWlyZShpbWFnZUV4aXN0cyhfaW1hZ2VJZCkpOwoJCWRlbGV0ZSBpbWFnZXNbX2ltYWdlSWRdOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlT3duZXIodWludDI1NiBfaW1hZ2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5vd25lcjsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZU93bmVyKHVpbnQyNTYgX2ltYWdlSWQsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLm93bmVyID0gX293bmVyOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlUmVnaW9uSWQodWludDI1NiBfaW1hZ2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5yZWdpb25JZDsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZVJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQyNTYgX3JlZ2lvbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLnJlZ2lvbklkID0gX3JlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlQ3VycmVudFJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uY3VycmVudFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlQ3VycmVudFJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQyNTYgX2N1cnJlbnRSZWdpb25JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJaW1hZ2VzW19pbWFnZUlkXS5jdXJyZW50UmVnaW9uSWQgPSBfY3VycmVudFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlRGF0YSh1aW50MjU2IF9pbWFnZUlkLCB1aW50MTYgX3BhcnQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTZbMTAwMF0pIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uZGF0YVtfcGFydF07Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VEYXRhKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfcGFydCwgdWludDI1NltdIF9kYXRhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmRhdGFMZW5ndGhbX3BhcnRdID0gdWludDE2KF9kYXRhLmxlbmd0aCk7CgkJZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RhdGEubGVuZ3RoOyBpKyspIHsKCQkJaW1hZ2VzW19pbWFnZUlkXS5kYXRhW19wYXJ0XVtpXSA9IF9kYXRhW2ldOwoJCX0KCX0KCglmdW5jdGlvbiBnZXRJbWFnZURhdGFMZW5ndGgodWludDI1NiBfaW1hZ2VJZCwgdWludDE2IF9wYXJ0KSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uZGF0YUxlbmd0aFtfcGFydF07Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VEYXRhTGVuZ3RoKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfcGFydCwgdWludDE2IF9kYXRhTGVuZ3RoKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmRhdGFMZW5ndGhbX3BhcnRdID0gX2RhdGFMZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VQYXJ0c0NvdW50KHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQxNikgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5wYXJ0c0NvdW50OwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlUGFydHNDb3VudCh1aW50MjU2IF9pbWFnZUlkLCB1aW50MTYgX3BhcnRzQ291bnQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJcmVxdWlyZShpbWFnZUV4aXN0cyhfaW1hZ2VJZCkpOwoJCWltYWdlc1tfaW1hZ2VJZF0ucGFydHNDb3VudCA9IF9wYXJ0c0NvdW50OwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlV2lkdGgodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDE2KSB7CgkJcmVxdWlyZShpbWFnZUV4aXN0cyhfaW1hZ2VJZCkpOwoJCXJldHVybiBpbWFnZXNbX2ltYWdlSWRdLndpZHRoOwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlV2lkdGgodWludDI1NiBfaW1hZ2VJZCwgdWludDE2IF93aWR0aCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJaW1hZ2VzW19pbWFnZUlkXS53aWR0aCA9IF93aWR0aDsKCX0KCglmdW5jdGlvbiBnZXRJbWFnZUhlaWdodCh1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uaGVpZ2h0OwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlSGVpZ2h0KHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfaGVpZ2h0KSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmhlaWdodCA9IF9oZWlnaHQ7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VEZXNjcmlwdG9yKHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQxNikgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5pbWFnZURlc2NyaXB0b3I7Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VEZXNjcmlwdG9yKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfaW1hZ2VEZXNjcmlwdG9yKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmltYWdlRGVzY3JpcHRvciA9IF9pbWFnZURlc2NyaXB0b3I7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VCbHVycmVkQXQodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBpbWFnZXNbX2ltYWdlSWRdLmJsdXJyZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZUJsdXJyZWRBdCh1aW50MjU2IF9pbWFnZUlkLCB1aW50MjU2IF9ibHVycmVkQXQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJaW1hZ2VzW19pbWFnZUlkXS5ibHVycmVkQXQgPSBfYmx1cnJlZEF0OwoJfQoKCWZ1bmN0aW9uIGltYWdlVXBsb2FkQ29tcGxldGUodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlmb3IgKHVpbnQxNiBpID0gMTsgaSA8PSBpbWFnZXNbX2ltYWdlSWRdLnBhcnRzQ291bnQ7IGkrKykgewoJCQlpZihpbWFnZXNbX2ltYWdlSWRdLmRhdGFbaV0ubGVuZ3RoID09IDApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0KCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBCZHBJbWFnZVN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCmxpYnJhcnkgQmRwSW1hZ2UgewoKCWZ1bmN0aW9uIGNoZWNrSW1hZ2VJbnB1dChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDI1NiBfaW1hZ2VJZCwgdWludDI1NltdIF9pbWFnZURhdGEsIGJvb2wgX3N3YXBJbWFnZXMsIGJvb2wgX2NsZWFySW1hZ2UpIHZpZXcgcHVibGljIHsKCQl2YXIgZGF0YVN0b3JhZ2UgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXZhciBpbWFnZVN0b3JhZ2UgPSBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCXJlcXVpcmUoIChfaW1hZ2VJZCA9PSAwICYmIF9pbWFnZURhdGEubGVuZ3RoID09IDAgJiYgIV9zd2FwSW1hZ2VzICYmICFfY2xlYXJJbWFnZSkgLy8gT25seSBvbmUgd2F5IHRvIGNoYW5nZSBpbWFnZSBjYW4gYmUgc3BlY2lmaWVkCgkJCXx8IChfaW1hZ2VJZCAhPSAwICYmIF9pbWFnZURhdGEubGVuZ3RoID09IDAgJiYgIV9zd2FwSW1hZ2VzICYmICFfY2xlYXJJbWFnZSkgLy8gSWYgaW1hZ2UgaGFzIHRvIGJlIGNoYW5nZWQKCQkJfHwgKF9pbWFnZUlkID09IDAgJiYgX2ltYWdlRGF0YS5sZW5ndGggIT0gMCAmJiAhX3N3YXBJbWFnZXMgJiYgIV9jbGVhckltYWdlKQoJCQl8fCAoX2ltYWdlSWQgPT0gMCAmJiBfaW1hZ2VEYXRhLmxlbmd0aCA9PSAwICYmIF9zd2FwSW1hZ2VzICYmICFfY2xlYXJJbWFnZSkKCQkJfHwgKF9pbWFnZUlkID09IDAgJiYgX2ltYWdlRGF0YS5sZW5ndGggPT0gMCAmJiAhX3N3YXBJbWFnZXMgJiYgX2NsZWFySW1hZ2UpICk7CgoJCXJlcXVpcmUoX2ltYWdlSWQgPT0gMCB8fCAvLyBDYW4gdXNlIG9ubHkgb3duIGltYWdlcyBub3QgdXNlZCBieSBvdGhlciByZWdpb25zCgkJCSggKG1zZy5zZW5kZXIgPT0gaW1hZ2VTdG9yYWdlLmdldEltYWdlT3duZXIoX2ltYWdlSWQpKSAmJiAoaW1hZ2VTdG9yYWdlLmdldEltYWdlQ3VycmVudFJlZ2lvbklkKF9pbWFnZUlkKSA9PSAwKSApICk7CgoJCXZhciBuZXh0SW1hZ2VJZCA9IGRhdGFTdG9yYWdlLmdldFJlZ2lvbk5leHRJbWFnZUlkKF9yZWdpb25JZCk7CgkJcmVxdWlyZSghX3N3YXBJbWFnZXMgfHwgaW1hZ2VTdG9yYWdlLmltYWdlVXBsb2FkQ29tcGxldGUobmV4dEltYWdlSWQpKTsgLy8gQ2FuIHN3YXAgaW1hZ2VzIGlmIG5leHQgaW1hZ2UgdXBsb2FkIGlzIGNvbXBsZXRlCgl9CgoJZnVuY3Rpb24gc2V0TmV4dEltYWdlUGFydChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDE2IF9wYXJ0LCB1aW50MTYgX3BhcnRzQ291bnQsIHVpbnQxNiBfaW1hZ2VEZXNjcmlwdG9yLCB1aW50MjU2W10gX2ltYWdlRGF0YSkgcHVibGljIHsKCQl2YXIgZGF0YVN0b3JhZ2UgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXZhciBpbWFnZVN0b3JhZ2UgPSBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCXJlcXVpcmUoQmRwT3duZXJzaGlwLm93bmVyT2YoX2NvbnRyYWN0cywgX3JlZ2lvbklkKSA9PSBtc2cuc2VuZGVyKTsKCQlyZXF1aXJlKF9pbWFnZURhdGEubGVuZ3RoICE9IDApOwoJCXJlcXVpcmUoX3BhcnQgPiAwKTsKCQlyZXF1aXJlKF9wYXJ0IDw9IF9wYXJ0c0NvdW50KTsKCgkJdmFyIG5leHRJbWFnZUlkID0gZGF0YVN0b3JhZ2UuZ2V0UmVnaW9uTmV4dEltYWdlSWQoX3JlZ2lvbklkKTsKCQlpZihuZXh0SW1hZ2VJZCA9PSAwIHx8IF9pbWFnZURlc2NyaXB0b3IgIT0gaW1hZ2VTdG9yYWdlLmdldEltYWdlRGVzY3JpcHRvcihuZXh0SW1hZ2VJZCkpIHsKCQkJdmFyICgsIHdpZHRoLCBoZWlnaHQpID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBcmVhKF9jb250cmFjdHMsIF9yZWdpb25JZCk7CgkJCW5leHRJbWFnZUlkID0gaW1hZ2VTdG9yYWdlLmNyZWF0ZUltYWdlKG1zZy5zZW5kZXIsIF9yZWdpb25JZCwgdWludDE2KHdpZHRoKSwgdWludDE2KGhlaWdodCksIF9wYXJ0c0NvdW50LCBfaW1hZ2VEZXNjcmlwdG9yKTsKCQkJZGF0YVN0b3JhZ2Uuc2V0UmVnaW9uTmV4dEltYWdlSWQoX3JlZ2lvbklkLCBuZXh0SW1hZ2VJZCk7CgkJfQoKCQlpbWFnZVN0b3JhZ2Uuc2V0SW1hZ2VEYXRhKG5leHRJbWFnZUlkLCBfcGFydCwgX2ltYWdlRGF0YSk7Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VPd25lcihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9pbWFnZUlkLCBhZGRyZXNzIF9vd25lcikgcHVibGljIHsKCQl2YXIgaW1hZ2VTdG9yYWdlID0gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXJlcXVpcmUoaW1hZ2VTdG9yYWdlLmdldEltYWdlT3duZXIoX2ltYWdlSWQpID09IG1zZy5zZW5kZXIpOwoJCXJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwoKCQlpbWFnZVN0b3JhZ2Uuc2V0SW1hZ2VPd25lcihfaW1hZ2VJZCwgX293bmVyKTsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZURhdGEoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfaW1hZ2VJZCwgdWludDE2IF9wYXJ0LCB1aW50MjU2W10gX2ltYWdlRGF0YSkgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIHsKCQl2YXIgaW1hZ2VTdG9yYWdlID0gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXJlcXVpcmUoaW1hZ2VTdG9yYWdlLmdldEltYWdlT3duZXIoX2ltYWdlSWQpID09IG1zZy5zZW5kZXIpOwoJCXJlcXVpcmUoaW1hZ2VTdG9yYWdlLmdldEltYWdlQ3VycmVudFJlZ2lvbklkKF9pbWFnZUlkKSA9PSAwKTsKCQlyZXF1aXJlKF9pbWFnZURhdGEubGVuZ3RoICE9IDApOwoJCXJlcXVpcmUoX3BhcnQgPiAwKTsKCQlyZXF1aXJlKF9wYXJ0IDw9IGltYWdlU3RvcmFnZS5nZXRJbWFnZVBhcnRzQ291bnQoX2ltYWdlSWQpKTsKCgkJaW1hZ2VTdG9yYWdlLnNldEltYWdlRGF0YShfaW1hZ2VJZCwgX3BhcnQsIF9pbWFnZURhdGEpOwoJfQoKfQoKY29udHJhY3QgQmRwQ29udHJvbGxlckhlbHBlciBpcyBCZHBCYXNlIHsKCgkvLyBCZHBDYWxjdWxhdG9yCgoJZnVuY3Rpb24gY2FsY3VsYXRlQXJlYSh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfYXJlYSwgdWludDI1NiBfd2lkdGgsIHVpbnQyNTYgX2hlaWdodCkgewoJCXJldHVybiBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZUFyZWEoY29udHJhY3RzLCBfcmVnaW9uSWQpOwoJfQoKCWZ1bmN0aW9uIGNvdW50UHVyY2hhc2VkUGl4ZWxzKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfY291bnQpIHsKCQlyZXR1cm4gQmRwQ2FsY3VsYXRvci5jb3VudFB1cmNoYXNlZFBpeGVscyhjb250cmFjdHMpOwoJfQoKCWZ1bmN0aW9uIGNhbGN1bGF0ZUN1cnJlbnRNYXJrZXRQaXhlbFByaWNlKCkgdmlldyBwdWJsaWMgcmV0dXJucyh1aW50KSB7CgkJcmV0dXJuIEJkcENhbGN1bGF0b3IuY2FsY3VsYXRlQ3VycmVudE1hcmtldFBpeGVsUHJpY2UoY29udHJhY3RzKTsKCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVNYXJrZXRQaXhlbFByaWNlKHVpbnQgX3BpeGVsc1NvbGQpIHZpZXcgcHVibGljIHJldHVybnModWludCkgewoJCXJldHVybiBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZU1hcmtldFBpeGVsUHJpY2UoY29udHJhY3RzLCBfcGl4ZWxzU29sZCk7Cgl9CgoJZnVuY3Rpb24gY2FsY3VsYXRlQXZlcmFnZVBpeGVsUHJpY2UodWludCBfYSwgdWludCBfYikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCBfcHJpY2UpIHsKCQlyZXR1cm4gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBdmVyYWdlUGl4ZWxQcmljZShjb250cmFjdHMsIF9hLCBfYik7Cgl9CgoJZnVuY3Rpb24gY2FsY3VsYXRlUmVnaW9uSW5pdGlhbFNhbGVQaXhlbFByaWNlKHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcENhbGN1bGF0b3IuY2FsY3VsYXRlUmVnaW9uSW5pdGlhbFNhbGVQaXhlbFByaWNlKGNvbnRyYWN0cywgX3JlZ2lvbklkKTsKCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVSZWdpb25TYWxlUGl4ZWxQcmljZSh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZVJlZ2lvblNhbGVQaXhlbFByaWNlKGNvbnRyYWN0cywgX3JlZ2lvbklkKTsKCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVTZXR1cEFsbG93ZWRVbnRpbCh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZVNldHVwQWxsb3dlZFVudGlsKGNvbnRyYWN0cywgX3JlZ2lvbklkKTsKCX0KCgoJLy8gQmRwRGF0YVN0b3JhZ2UKCglmdW5jdGlvbiBnZXRMYXN0UmVnaW9uSWQoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShjb250cmFjdHMpKS5nZXRMYXN0UmVnaW9uSWQoKTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25Db29yZGluYXRlcyh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NikgewoJCXJldHVybiBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0UmVnaW9uQ29vcmRpbmF0ZXMoX3JlZ2lvbklkKTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25DdXJyZW50SW1hZ2VJZCh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0UmVnaW9uQ3VycmVudEltYWdlSWQoX3JlZ2lvbklkKTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25OZXh0SW1hZ2VJZCh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0UmVnaW9uTmV4dEltYWdlSWQoX3JlZ2lvbklkKTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25VcmwodWludDI1NiBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQ4WzEyOF0pIHsKCQlyZXR1cm4gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKGNvbnRyYWN0cykpLmdldFJlZ2lvblVybChfcmVnaW9uSWQpOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlKHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShjb250cmFjdHMpKS5nZXRSZWdpb25DdXJyZW50UGl4ZWxQcmljZShfcmVnaW9uSWQpOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkJsb2NrVXBkYXRlZEF0KHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShjb250cmFjdHMpKS5nZXRSZWdpb25CbG9ja1VwZGF0ZWRBdChfcmVnaW9uSWQpOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVwZGF0ZWRBdCh1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0UmVnaW9uVXBkYXRlZEF0KF9yZWdpb25JZCk7Cgl9CgoJZnVuY3Rpb24gZ2V0UmVnaW9uUHVyY2hhc2VkQXQodWludDI1NiBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKGNvbnRyYWN0cykpLmdldFJlZ2lvblB1cmNoYXNlZEF0KF9yZWdpb25JZCk7Cgl9CgoJZnVuY3Rpb24gZ2V0UmVnaW9uUHVyY2hhc2VQaXhlbFByaWNlKHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShjb250cmFjdHMpKS5nZXRSZWdpb25QdXJjaGFzZVBpeGVsUHJpY2UoX3JlZ2lvbklkKTsKCX0KCglmdW5jdGlvbiByZWdpb25FeGlzdHModWludCBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKGNvbnRyYWN0cykpLmdldFJlZ2lvblVwZGF0ZWRBdChfcmVnaW9uSWQpID4gMDsKCX0KCglmdW5jdGlvbiByZWdpb25zSXNQdXJjaGFzZWQodWludCBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKGNvbnRyYWN0cykpLmdldFJlZ2lvblB1cmNoYXNlZEF0KF9yZWdpb25JZCkgPiAwOwoJfQoKCgkvLyBCZHBJbWFnZVN0b3JhZ2UKCglmdW5jdGlvbiBjcmVhdGVJbWFnZShhZGRyZXNzIF9vd25lciwgdWludDI1NiBfcmVnaW9uSWQsIHVpbnQxNiBfd2lkdGgsIHVpbnQxNiBfaGVpZ2h0LCB1aW50MTYgX3BhcnRzQ291bnQsIHVpbnQxNiBfaW1hZ2VEZXNjcmlwdG9yKSBwdWJsaWMgb25seUF1dGhvcml6ZWQgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShjb250cmFjdHMpKS5jcmVhdGVJbWFnZShfb3duZXIsIF9yZWdpb25JZCwgX3dpZHRoLCBfaGVpZ2h0LCBfcGFydHNDb3VudCwgX2ltYWdlRGVzY3JpcHRvcik7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VSZWdpb25JZCh1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKGNvbnRyYWN0cykpLmdldEltYWdlUmVnaW9uSWQoX2ltYWdlSWQpOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlQ3VycmVudFJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0SW1hZ2VDdXJyZW50UmVnaW9uSWQoX2ltYWdlSWQpOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlT3duZXIodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShjb250cmFjdHMpKS5nZXRJbWFnZU93bmVyKF9pbWFnZUlkKTsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZU93bmVyKHVpbnQyNTYgX2ltYWdlSWQsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgewoJCUJkcEltYWdlLnNldEltYWdlT3duZXIoY29udHJhY3RzLCBfaW1hZ2VJZCwgX293bmVyKTsKCX0KCglmdW5jdGlvbiBnZXRJbWFnZURhdGEodWludDI1NiBfaW1hZ2VJZCwgdWludDE2IF9wYXJ0KSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2WzEwMDBdKSB7CgkJcmV0dXJuIEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKGNvbnRyYWN0cykpLmdldEltYWdlRGF0YShfaW1hZ2VJZCwgX3BhcnQpOwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlRGF0YSh1aW50MjU2IF9pbWFnZUlkLCB1aW50MTYgX3BhcnQsIHVpbnQyNTZbXSBfaW1hZ2VEYXRhKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewoJCUJkcEltYWdlLnNldEltYWdlRGF0YShjb250cmFjdHMsIF9pbWFnZUlkLCBfcGFydCwgX2ltYWdlRGF0YSk7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VEYXRhTGVuZ3RoKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfcGFydCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDE2KSB7CgkJcmV0dXJuIEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKGNvbnRyYWN0cykpLmdldEltYWdlRGF0YUxlbmd0aChfaW1hZ2VJZCwgX3BhcnQpOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlUGFydHNDb3VudCh1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXR1cm4gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0SW1hZ2VQYXJ0c0NvdW50KF9pbWFnZUlkKTsKCX0KCglmdW5jdGlvbiBnZXRJbWFnZVdpZHRoKHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQxNikgewoJCXJldHVybiBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShjb250cmFjdHMpKS5nZXRJbWFnZVdpZHRoKF9pbWFnZUlkKTsKCX0KCglmdW5jdGlvbiBnZXRJbWFnZUhlaWdodCh1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXR1cm4gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0SW1hZ2VIZWlnaHQoX2ltYWdlSWQpOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlRGVzY3JpcHRvcih1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXR1cm4gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0SW1hZ2VEZXNjcmlwdG9yKF9pbWFnZUlkKTsKCX0KCglmdW5jdGlvbiBnZXRJbWFnZUJsdXJyZWRBdCh1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKGNvbnRyYWN0cykpLmdldEltYWdlQmx1cnJlZEF0KF9pbWFnZUlkKTsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZUJsdXJyZWRBdCh1aW50MjU2IF9pbWFnZUlkLCB1aW50MjU2IF9ibHVycmVkQXQpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCB7CgkJcmV0dXJuIEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKGNvbnRyYWN0cykpLnNldEltYWdlQmx1cnJlZEF0KF9pbWFnZUlkLCBfYmx1cnJlZEF0KTsKCX0KCglmdW5jdGlvbiBpbWFnZVVwbG9hZENvbXBsZXRlKHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoY29udHJhY3RzKSkuaW1hZ2VVcGxvYWRDb21wbGV0ZShfaW1hZ2VJZCk7Cgl9CgoKCS8vIEJkcFByaWNlU3RvcmFnZQoKCWZ1bmN0aW9uIGdldEZvcndhcmRQdXJjaGFzZUZlZXNUbygpIHZpZXcgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gQmRwUHJpY2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBQcmljZVN0b3JhZ2UoY29udHJhY3RzKSkuZ2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKCk7Cgl9CgoJZnVuY3Rpb24gc2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKGFkZHJlc3MgX2ZvcndhcmRQdXJjaGFzZUZlZXNUbykgcHVibGljIG9ubHlPd25lciB7CgkJQmRwUHJpY2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBQcmljZVN0b3JhZ2UoY29udHJhY3RzKSkuc2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKF9mb3J3YXJkUHVyY2hhc2VGZWVzVG8pOwoJfQoKCWZ1bmN0aW9uIGdldEZvcndhcmRVcGRhdGVGZWVzVG8oKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIEJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKGNvbnRyYWN0cykpLmdldEZvcndhcmRVcGRhdGVGZWVzVG8oKTsKCX0KCglmdW5jdGlvbiBzZXRGb3J3YXJkVXBkYXRlRmVlc1RvKGFkZHJlc3MgX2ZvcndhcmRVcGRhdGVGZWVzVG8pIHB1YmxpYyBvbmx5T3duZXIgewoJCUJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKGNvbnRyYWN0cykpLnNldEZvcndhcmRVcGRhdGVGZWVzVG8oX2ZvcndhcmRVcGRhdGVGZWVzVG8pOwoJfQoKCWZ1bmN0aW9uIEJkcENvbnRyb2xsZXJIZWxwZXIoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0='.
	

]
