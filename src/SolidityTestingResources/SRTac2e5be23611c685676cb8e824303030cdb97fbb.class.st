Class {
	#name : #SRTac2e5be23611c685676cb8e824303030cdb97fbb,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTac2e5be23611c685676cb8e824303030cdb97fbb >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7CiAgICBpZiAoIWFzc2VydGlvbikgewogICAgICB0aHJvdzsKICAgIH0KICB9Cn0KCgovKioKICogQHRpdGxlIFNoYXJlYWJsZQogKiBAZGV2IGluaGVyaXRhYmxlICJwcm9wZXJ0eSIgY29udHJhY3QgdGhhdCBlbmFibGVzIG1ldGhvZHMgdG8gYmUgcHJvdGVjdGVkIGJ5IHJlcXVpcmluZyB0aGUKICogYWNxdWllc2NlbmNlIG9mIGVpdGhlciBhIHNpbmdsZSwgb3IsIGNydWNpYWxseSwgZWFjaCBvZiBhIG51bWJlciBvZiwgZGVzaWduYXRlZCBvd25lcnMuCiAqIEBkZXYgVXNhZ2U6IHVzZSBtb2RpZmllcnMgb25seW93bmVyIChqdXN0IG93biBvd25lZCkgb3Igb25seW1hbnlvd25lcnMoaGFzaCksIHdoZXJlYnkgdGhlIHNhbWUgaGFzaCBtdXN0IGJlIHByb3ZpZGVkIGJ5IHNvbWUgbnVtYmVyIChzcGVjaWZpZWQgaW4gY29uc3RydWN0b3IpIG9mIHRoZSBzZXQgb2Ygb3duZXJzIChzcGVjaWZpZWQgaW4gdGhlIGNvbnN0cnVjdG9yKSBiZWZvcmUgdGhlIGludGVyaW9yIGlzIGV4ZWN1dGVkLgogKi8KY29udHJhY3QgU2hhcmVhYmxlIHsKCiAgLy8gc3RydWN0IGZvciB0aGUgc3RhdHVzIG9mIGEgcGVuZGluZyBvcGVyYXRpb24uCiAgc3RydWN0IFBlbmRpbmdTdGF0ZSB7CiAgICB1aW50IHlldE5lZWRlZDsKICAgIHVpbnQgb3duZXJzRG9uZTsKICAgIHVpbnQgaW5kZXg7CiAgfQoKICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICB1aW50IHB1YmxpYyByZXF1aXJlZDsKCiAgLy8gbGlzdCBvZiBvd25lcnMKICBhZGRyZXNzWzI1Nl0gb3duZXJzOwogIC8vIGluZGV4IG9uIHRoZSBsaXN0IG9mIG93bmVycyB0byBhbGxvdyByZXZlcnNlIGxvb2t1cAogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBvd25lckluZGV4OwogIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgbWFwcGluZyhieXRlczMyID0+IFBlbmRpbmdTdGF0ZSkgcGVuZGluZ3M7CiAgYnl0ZXMzMltdIHBlbmRpbmdzSW5kZXg7CgoKICAvLyB0aGlzIGNvbnRyYWN0IG9ubHkgaGFzIHNpeCB0eXBlcyBvZiBldmVudHM6IGl0IGNhbiBhY2NlcHQgYSBjb25maXJtYXRpb24sIGluIHdoaWNoIGNhc2UKICAvLyB3ZSByZWNvcmQgb3duZXIgYW5kIG9wZXJhdGlvbiAoaGFzaCkgYWxvbmdzaWRlIGl0LgogIGV2ZW50IENvbmZpcm1hdGlvbihhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CiAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKCgogIC8vIHNpbXBsZSBzaW5nbGUtc2lnIGZ1bmN0aW9uIG1vZGlmaWVyLgogIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICBpZiAoIWlzT3duZXIobXNnLnNlbmRlcikpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciBmb3IgbXVsdGlzaWcgZnVuY3Rpb25zLgogICAqIEBwYXJhbSBfb3BlcmF0aW9uIFRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyIHRoYXQgbGF0ZXIgYXR0ZW1wdHMgY2FuIGJlCiAgICogcmVhbGlzZWQgYXMgdGhlIHNhbWUgdW5kZXJseWluZyBvcGVyYXRpb24gYW5kIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgKi8KICBtb2RpZmllciBvbmx5bWFueW93bmVycyhieXRlczMyIF9vcGVyYXRpb24pIHsKICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpIHsKICAgICAgXzsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgQ29uc3RydWN0b3IgaXMgZ2l2ZW4gdGhlIG51bWJlciBvZiBzaWdzIHJlcXVpcmVkIHRvIGRvIHByb3RlY3RlZCAib25seW1hbnlvd25lcnMiCiAgICogdHJhbnNhY3Rpb25zIGFzIHdlbGwgYXMgdGhlIHNlbGVjdGlvbiBvZiBhZGRyZXNzZXMgY2FwYWJsZSBvZiBjb25maXJtaW5nIHRoZW0uCiAgICogQHBhcmFtIF9vd25lcnMgQSBsaXN0IG9mIG93bmVycy4KICAgKiBAcGFyYW0gX3JlcXVpcmVkIFRoZSBhbW91bnQgcmVxdWlyZWQgZm9yIGEgdHJhbnNhY3Rpb24gdG8gYmUgYXBwcm92ZWQuCiAgICovCiAgZnVuY3Rpb24gU2hhcmVhYmxlKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkgewogICAgb3duZXJzWzFdID0gbXNnLnNlbmRlcjsKICAgIG93bmVySW5kZXhbbXNnLnNlbmRlcl0gPSAxOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7ICsraSkgewogICAgICBvd25lcnNbMiArIGldID0gX293bmVyc1tpXTsKICAgICAgb3duZXJJbmRleFtfb3duZXJzW2ldXSA9IDIgKyBpOwogICAgfQogICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICBpZiAocmVxdWlyZWQgPiBvd25lcnMubGVuZ3RoKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiBSZXZva2VzIGEgcHJpb3IgY29uZmlybWF0aW9uIG9mIHRoZSBnaXZlbiBvcGVyYXRpb24uCiAgICogQHBhcmFtIF9vcGVyYXRpb24gQSBzdHJpbmcgaWRlbnRpZnlpbmcgdGhlIG9wZXJhdGlvbi4KICAgKi8KICBmdW5jdGlvbiByZXZva2UoYnl0ZXMzMiBfb3BlcmF0aW9uKSBleHRlcm5hbCB7CiAgICB1aW50IGluZGV4ID0gb3duZXJJbmRleFttc2cuc2VuZGVyXTsKICAgIC8vIG1ha2Ugc3VyZSB0aGV5J3JlIGFuIG93bmVyCiAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKippbmRleDsKICAgIHZhciBwZW5kaW5nID0gcGVuZGluZ3NbX29wZXJhdGlvbl07CiAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA+IDApIHsKICAgICAgcGVuZGluZy55ZXROZWVkZWQrKzsKICAgICAgcGVuZGluZy5vd25lcnNEb25lIC09IG93bmVySW5kZXhCaXQ7CiAgICAgIFJldm9rZShtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyBhbiBvd25lciBieSAwLWluZGV4ZWQgcG9zaXRpb24gKHVzaW5nIG51bU93bmVycyBhcyB0aGUgY291bnQpCiAgICogQHBhcmFtIG93bmVySW5kZXggVWludCBUaGUgaW5kZXggb2YgdGhlIG93bmVyCiAgICogQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIKICAgKi8KICBmdW5jdGlvbiBnZXRPd25lcih1aW50IG93bmVySW5kZXgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBhZGRyZXNzKG93bmVyc1tvd25lckluZGV4ICsgMV0pOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVja3MgaWYgZ2l2ZW4gYWRkcmVzcyBpcyBhbiBvd25lci4KICAgKiBAcGFyYW0gX2FkZHIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBjaGVjay4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIGFkZHJlc3MgaXMgYW4gb3duZXIgYW5kIGZhc2Ugb3RoZXJ3aXNlLgogICAqLwogIGZ1bmN0aW9uIGlzT3duZXIoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG93bmVySW5kZXhbX2FkZHJdID4gMDsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgaXMgc3BlY2lmaWMgb3duZXIgaGFzIGFscmVhZHkgY29uZmlybWUgdGhlIG9wZXJhdGlvbi4KICAgKiBAcGFyYW0gX29wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIGlkZW50aWZpZXIuCiAgICogQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG93bmVyIGhhcyBjb25maXJtZWQgYW5kIGZhbHNlIG90aGVyd2lzZS4KICAgKi8KICBmdW5jdGlvbiBoYXNDb25maXJtZWQoYnl0ZXMzMiBfb3BlcmF0aW9uLCBhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIHBlbmRpbmcgPSBwZW5kaW5nc1tfb3BlcmF0aW9uXTsKICAgIHVpbnQgaW5kZXggPSBvd25lckluZGV4W19vd25lcl07CgogICAgLy8gbWFrZSBzdXJlIHRoZXkncmUgYW4gb3duZXIKICAgIGlmIChpbmRleCA9PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKippbmRleDsKICAgIHJldHVybiAhKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPT0gMCk7CiAgfQoKICAvKioKICAgKiBAZGV2IENvbmZpcm0gYW5kIG9wZXJhdGlvbiBhbmQgY2hlY2tzIGlmIGl0J3MgYWxyZWFkeSBleGVjdXRhYmxlLgogICAqIEBwYXJhbSBfb3BlcmF0aW9uIFRoZSBvcGVyYXRpb24gaWRlbnRpZmllci4KICAgKiBAcmV0dXJuIFJldHVybnMgdHJ1ZSB3aGVuIG9wZXJhdGlvbiBjYW4gYmUgZXhlY3V0ZWQuCiAgICovCiAgZnVuY3Rpb24gY29uZmlybUFuZENoZWNrKGJ5dGVzMzIgX29wZXJhdGlvbikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgLy8gZGV0ZXJtaW5lIHdoYXQgaW5kZXggdGhlIHByZXNlbnQgc2VuZGVyIGlzOgogICAgdWludCBpbmRleCA9IG93bmVySW5kZXhbbXNnLnNlbmRlcl07CiAgICAvLyBtYWtlIHN1cmUgdGhleSdyZSBhbiBvd25lcgogICAgaWYgKGluZGV4ID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgdmFyIHBlbmRpbmcgPSBwZW5kaW5nc1tfb3BlcmF0aW9uXTsKICAgIC8vIGlmIHdlJ3JlIG5vdCB5ZXQgd29ya2luZyBvbiB0aGlzIG9wZXJhdGlvbiwgc3dpdGNoIG92ZXIgYW5kIHJlc2V0IHRoZSBjb25maXJtYXRpb24gc3RhdHVzLgogICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkID09IDApIHsKICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuCiAgICAgIHBlbmRpbmcueWV0TmVlZGVkID0gcmVxdWlyZWQ7CiAgICAgIC8vIHJlc2V0IHdoaWNoIG93bmVycyBoYXZlIGNvbmZpcm1lZCAobm9uZSkgLSBzZXQgb3VyIGJpdG1hcCB0byAwLgogICAgICBwZW5kaW5nLm93bmVyc0RvbmUgPSAwOwogICAgICBwZW5kaW5nLmluZGV4ID0gcGVuZGluZ3NJbmRleC5sZW5ndGgrKzsKICAgICAgcGVuZGluZ3NJbmRleFtwZW5kaW5nLmluZGV4XSA9IF9vcGVyYXRpb247CiAgICB9CiAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKippbmRleDsKICAgIC8vIG1ha2Ugc3VyZSB3ZSAodGhlIG1lc3NhZ2Ugc2VuZGVyKSBoYXZlbid0IGNvbmZpcm1lZCB0aGlzIG9wZXJhdGlvbiBwcmV2aW91c2x5LgogICAgaWYgKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPT0gMCkgewogICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgIC8vIG9rIC0gY2hlY2sgaWYgY291bnQgaXMgZW5vdWdoIHRvIGdvIGFoZWFkLgogICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPD0gMSkgewogICAgICAgIC8vIGVub3VnaCBjb25maXJtYXRpb25zOiByZXNldCBhbmQgcnVuIGludGVyaW9yLgogICAgICAgIGRlbGV0ZSBwZW5kaW5nc0luZGV4W3BlbmRpbmdzW19vcGVyYXRpb25dLmluZGV4XTsKICAgICAgICBkZWxldGUgcGVuZGluZ3NbX29wZXJhdGlvbl07CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4KICAgICAgICBwZW5kaW5nLnlldE5lZWRlZC0tOwogICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSB8PSBvd25lckluZGV4Qml0OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKCiAgLyoqCiAgICogQGRldiBDbGVhciB0aGUgcGVuZGluZyBsaXN0LgogICAqLwogIGZ1bmN0aW9uIGNsZWFyUGVuZGluZygpIGludGVybmFsIHsKICAgIHVpbnQgbGVuZ3RoID0gcGVuZGluZ3NJbmRleC5sZW5ndGg7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICBpZiAocGVuZGluZ3NJbmRleFtpXSAhPSAwKSB7CiAgICAgICAgZGVsZXRlIHBlbmRpbmdzW3BlbmRpbmdzSW5kZXhbaV1dOwogICAgICB9CiAgICB9CiAgICBkZWxldGUgcGVuZGluZ3NJbmRleDsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CgogIC8qKgogICAqIEBkZXYgRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2suCiAgICovCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGlmKG1zZy5kYXRhLmxlbmd0aCA8IHNpemUgKyA0KSB7CiAgICAgICB0aHJvdzsKICAgICB9CiAgICAgXzsKICB9CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1hbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcnQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyBpZiAoX3ZhbHVlID4gX2FsbG93YW5jZSkgdGhyb3c7CgogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWFobGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBCVEgKICogQG5vdGljZSBCVEMgKyBFVEggPSBCVEgKICovCgpjb250cmFjdCBCVEggaXMgU3RhbmRhcmRUb2tlbiwgU2hhcmVhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLyoKICAgKiBDb25zdGFudHMKICAgKi8KICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQmV0aGVyIjsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJCVEgiOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CiAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gIjEuMCI7CgogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElOSVRJQUxfU1VCU0lEWSA9IDUwICogMTAqKmRlY2ltYWxzOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEhBU0hfUkFURV9NVUxUSVBMSUVSID0gMTsKCiAgLyoKICAgKiBFdmVudHMKICAgKi8KICBldmVudCBMb2dDb250cmlidXRpb24oYWRkcmVzcyBpbmRleGVkIF9taW5lciwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2hhc2hSYXRlLCB1aW50MjU2IF9ibG9jaywgdWludDI1NiBfaGFsdmluZyk7CiAgZXZlbnQgTG9nQ2xhaW1IYWx2aW5nU3Vic2lkeShhZGRyZXNzIGluZGV4ZWQgX21pbmVyLCB1aW50MjU2IF9ibG9jaywgdWludDI1NiBfaGFsdmluZywgdWludDI1NiBfdmFsdWUpOwogIGV2ZW50IExvZ1JlbWFpbmluZ0hhbHZpbmdTdWJzaWR5KHVpbnQyNTYgX2hhbHZpbmcsIHVpbnQyNTYgX3ZhbHVlKTsKICBldmVudCBMb2dQYXVzZShieXRlczMyIGluZGV4ZWQgX2hhc2gpOwogIGV2ZW50IExvZ1VuUGF1c2UoYnl0ZXMzMiBpbmRleGVkIF9oYXNoKTsKICBldmVudCBMb2dCVEhGb3VuZGF0aW9uV2FsbGV0Q2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgX3dhbGxldCk7CiAgZXZlbnQgTG9nUG9sbENyZWF0ZWQoYnl0ZXMzMiBpbmRleGVkIF9oYXNoKTsKICBldmVudCBMb2dQb2xsRGVsZXRlZChieXRlczMyIGluZGV4ZWQgX2hhc2gpOwogIGV2ZW50IExvZ1BvbGxWb3RlZChieXRlczMyIGluZGV4ZWQgX2hhc2gsIGFkZHJlc3MgaW5kZXhlZCBfbWluZXIsIHVpbnQyNTYgX2hhc2hSYXRlKTsKICBldmVudCBMb2dQb2xsQXBwcm92ZWQoYnl0ZXMzMiBpbmRleGVkIF9oYXNoKTsKCiAgLyoKICAgKiBTdG9yYWdlIHZhcnMKICAgKi8KICBtYXBwaW5nICh1aW50MjU2ID0+IEhhbHZpbmdIYXNoUmF0ZSkgaGFsdmluZ3NIYXNoUmF0ZTsgLy8gSG9sZHMgdGhlIGFjY3VtdWxhdGVkIGhhc2ggcmF0ZSBwZXIgaGFsdmluZwogIG1hcHBpbmcgKHVpbnQyNTYgPT4gU3Vic2lkeSkgaGFsdmluZ3NTdWJzaWRpZXM7IC8vIFN0b3JlcyB0aGUgcmVtYWluaW5nIHN1YnNpZHkgcGVyIGhhbHZpbmcKICBtYXBwaW5nIChhZGRyZXNzID0+IE1pbmVyKSBtaW5lcnM7IC8vIE1pbmVycyBkYXRhCiAgbWFwcGluZyAoYnl0ZXMzMiA9PiBQb2xsKSBwb2xsczsgLy8gQ29udHJhY3QgcG9sbHMKCiAgYWRkcmVzcyBwdWJsaWMgYnRoRm91bmRhdGlvbldhbGxldDsKICB1aW50MjU2IHB1YmxpYyBzdWJzaWR5SGFsdmluZ0ludGVydmFsOwogIHVpbnQyNTYgcHVibGljIG1heEhhbHZpbmdzOwogIHVpbnQyNTYgcHVibGljIGdlbmVzaXM7CiAgdWludDI1NiBwdWJsaWMgdG90YWxIYXNoUmF0ZTsKICBib29sIHB1YmxpYyBwYXVzZWQ7CgogIHN0cnVjdCBIYWx2aW5nSGFzaFJhdGUgewogICAgYm9vbCBjYXJyaWVkOyAvLyBJbmRpY2F0ZXMgdGhhdCB0aGUgcHJldmlvdXMgaGFzaCByYXRlIGhhdmUgYmVlbiBhZGRlZCB0byB0aGUgaGFsdmluZwogICAgdWludDI1NiByYXRlOyAvLyBIYXNoIHJhdGUgb2YgdGhlIGhhbHZpbmcKICB9CgogIHN0cnVjdCBNaW5lciB7CiAgICB1aW50MjU2IGJsb2NrOyAvLyBNaW5lciBibG9jaywgdXNlZCB0byBjYWxjdWxhdGUgaW4gd2hpY2ggaGFsdmluZyBpcyB0aGUgbWluZXIKICAgIHVpbnQyNTYgdG90YWxIYXNoUmF0ZTsgLy8gQWNjdW11bGF0ZWQgbWluZXIgaGFzaCByYXRlCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IE1pbmVySGFzaFJhdGUpIGhhc2hSYXRlOwogIH0KCiAgc3RydWN0IE1pbmVySGFzaFJhdGUgewogICAgYm9vbCBjYXJyaWVkOwogICAgdWludDI1NiByYXRlOwogIH0KCiAgc3RydWN0IFN1YnNpZHkgewogICAgYm9vbCBjbGFpbWVkOyAgLy8gRmxhZyB0aGF0IGluZGljYXRlcyB0aGF0IHRoZSBzdWJzaWR5IGhhcyBiZWVuIGNsYWltZWQgYXQgbGVhc3Qgb25lIHRpbWUsIGp1c3QgdG8KICAgICAgICAgICAgICAgICAgIC8vIGNvbXB1dGUgdGhlIGluaXRpYWwgaGFsdmluZyBzdWJzaWR5IHZhbHVlCiAgICB1aW50MjU2IHZhbHVlOyAvLyBSZW1haW5pbmcgc3Vic2lkeSBvZiBhIGhhbHZpbmcKICB9CgogIHN0cnVjdCBQb2xsIHsKICAgIGJvb2wgZXhpc3RzOyAgLy8gSW5kaWNhdGVzIHRoYXQgdGhlIHBvbGwgaXMgY3JlYXRlZAogICAgc3RyaW5nIHRpdGxlOyAvLyBUaXRsZSBvZiB0aGUgcG9sbCwgaXQncyB0aGUgcG9sbCBpbmRlbnRpZmllciBzbyBpdCBtdXN0IGJlIHVuaXF1ZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSB2b3RlczsgLy8gQ29udHJvbCB3aG8gaGF2ZSB2b3RlZAogICAgdWludDggcGVyY2VudGFnZTsgLy8gUGVyY2VudGFnZSB3aGljaCBkZXRlcm1pbmVzIGlmIHRoZSBwb2xsIGhhcyBiZWVuIGFwcHJvdmVkCiAgICB1aW50MjU2IGhhc2hSYXRlOyAvLyBTdW1tZWQgaGFzaCByYXRlIG9mIGFsbCB0aGUgdm90ZXJzCiAgICBib29sIGFwcHJvdmVkOyAvLyBUcnVlIGlmIHRoZSBwb2xsIGhhcyBiZWVuIGFwcHJvdmVkCiAgICB1aW50MjU2IGFwcHJvdmFsQmxvY2s7IC8vIEJsb2NrIGluIHdoaWNoIHRoZSBwb2xsIHdhcyBhcHByb3ZlZAogICAgdWludDI1NiBhcHByb3ZhbEhhc2hSYXRlOyAvLyBIYXNoIHJhdGUgdGhhdCBjYXVzZWQgdGhlIHBvbGwgYXBwcm92YWwKICAgIHVpbnQyNTYgYXBwcm92YWxUb3RhbEhhc2hSYXRlOyAvLyBUb3RhbCBoYXMgcmF0ZSBpbiB3aGVuIHRoZSBwb2xsIHdhcyBhcHByb3ZlZAogIH0KCiAgLyoKICAgKiBNb2RpZmllcnMKICAgKi8KICBtb2RpZmllciBub3RCZWZvcmVHZW5lc2lzKCkgewogICAgcmVxdWlyZShibG9jay5udW1iZXIgPj0gZ2VuZXNpcyk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgbm9uWmVybyh1aW50MjU2IF92YWx1ZSkgewogICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBub25aZXJvQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG5vblplcm9WYWx1ZWQoKSB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSAhPSAwKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBub25aZXJvTGVuZ3RoKGFkZHJlc3NbXSBhcnJheSkgewogICAgcmVxdWlyZShhcnJheS5sZW5ndGggIT0gMCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgbm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBub3RHcmVhdGVyVGhhbkN1cnJlbnRCbG9jayh1aW50MjU2IF9ibG9jaykgewogICAgcmVxdWlyZShfYmxvY2sgPD0gY3VycmVudEJsb2NrKCkpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIGlzTWluZXIoYWRkcmVzcyBfYWRkcmVzcykgewogICAgcmVxdWlyZShtaW5lcnNbX2FkZHJlc3NdLmJsb2NrICE9IDApOwogICAgXzsKICB9CgogIG1vZGlmaWVyIHBvbGxBcHByb3ZlZChieXRlczMyIF9oYXNoKSB7CiAgICByZXF1aXJlKHBvbGxzW19oYXNoXS5hcHByb3ZlZCk7CiAgICBfOwogIH0KCiAgLyoKICAgKiBQdWJsaWMgZnVuY3Rpb25zCiAgICovCgogIC8qKgogICAgQG5vdGljZSBDb250cmFjdCBjb25zdHJ1Y3RvcgogICAgQHBhcmFtIF9idGhGb3VuZGF0aW9uTWVtYmVycyBhcmUgdGhlIGFkZHJlc3NlcyB0aGF0IGNvbnRyb2wgdGhlIEJUSCBjb250cmFjdAogICAgQHBhcmFtIF9yZXF1aXJlZCBudW1iZXIgb2YgbWVtZXJzIG5lZWRlZCB0byBleGVjdXRlIG1hbmFnZW1lbnQgZnVuY3Rpb25zIG9mIHRoZSBjb250cmFjdAogICAgQHBhcmFtIF9idGhGb3VuZGF0aW9uV2FsbGV0IHdhbGxldCB0aGF0IGhvbGRzIGFsbCB0aGUgY29udHJhY3QgY29udHJpYnV0aW9ucwogICAgQHBhcmFtIF9nZW5lc2lzIGJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgQlRIIGNvbnRyYWN0IHdpbGwgYmUgYWN0aXZlCiAgICBAcGFyYW0gX3N1YnNpZHlIYWx2aW5nSW50ZXJ2YWwgbnVtYmVyIG9mIGJsb2NrcyB3aGljaCBjb21wcmlzZXMgYSBoYWx2aW5nCiAgICBAcGFyYW0gX21heEhhbHZpbmdzIG51bWJlciBvZiBoYWx2aW5ncyB0aGF0IHdpbGwgZ2VuZXJhdGUgQlRICiAgKiovCiAgZnVuY3Rpb24gQlRIKAogICAgYWRkcmVzc1tdIF9idGhGb3VuZGF0aW9uTWVtYmVycywKICAgIHVpbnQyNTYgX3JlcXVpcmVkLAogICAgYWRkcmVzcyBfYnRoRm91bmRhdGlvbldhbGxldCwKICAgIHVpbnQyNTYgX2dlbmVzaXMsCiAgICB1aW50MjU2IF9zdWJzaWR5SGFsdmluZ0ludGVydmFsLAogICAgdWludDI1NiBfbWF4SGFsdmluZ3MKICApIFNoYXJlYWJsZSggX2J0aEZvdW5kYXRpb25NZW1iZXJzLCBfcmVxdWlyZWQpCiAgICBub25aZXJvTGVuZ3RoKF9idGhGb3VuZGF0aW9uTWVtYmVycykKICAgIG5vblplcm8oX3JlcXVpcmVkKQogICAgbm9uWmVyb0FkZHJlc3MoX2J0aEZvdW5kYXRpb25XYWxsZXQpCiAgICBub25aZXJvKF9nZW5lc2lzKQogICAgbm9uWmVybyhfc3Vic2lkeUhhbHZpbmdJbnRlcnZhbCkKICAgIG5vblplcm8oX21heEhhbHZpbmdzKQogIHsKICAgIC8vIEdlbmVzaXMgYmxvY2sgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRoYW4gdGhlIGN1cnJlbnQgYmxvY2sKICAgIGlmIChfZ2VuZXNpcyA8IGJsb2NrLm51bWJlcikgdGhyb3c7CgogICAgYnRoRm91bmRhdGlvbldhbGxldCA9IF9idGhGb3VuZGF0aW9uV2FsbGV0OwogICAgc3Vic2lkeUhhbHZpbmdJbnRlcnZhbCA9IF9zdWJzaWR5SGFsdmluZ0ludGVydmFsOwogICAgbWF4SGFsdmluZ3MgPSBfbWF4SGFsdmluZ3M7CgogICAgZ2VuZXNpcyA9IF9nZW5lc2lzOwogICAgdG90YWxTdXBwbHkgPSAwOwogICAgdG90YWxIYXNoUmF0ZSA9IDA7CiAgICBwYXVzZWQgPSBmYWxzZTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb250cmFjdCBkZXNjdHJ1Y3Rpb24gZnVuY3Rpb24KICAgIEBwYXJhbSBfaGFzaCBwb2xsIGhhc2ggdGhhdCBhdXRob3JpemVzIHRoZSBmdW5jdGlvbiBjYWxsCiAgKiovCiAgZnVuY3Rpb24ga2lsbChieXRlczMyIF9oYXNoKQogICAgZXh0ZXJuYWwKICAgIHBvbGxBcHByb3ZlZChfaGFzaCkKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogIHsKICAgIHNlbGZkZXN0cnVjdChidGhGb3VuZGF0aW9uV2FsbGV0KTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb250cmFjdCBkZXNjdHJ1Y3Rpb24gZnVuY3Rpb24gd2l0aCBldGhlcnMgcmVkaXJlY3Rpb24KICAgIEBwYXJhbSBfaGFzaCBwb2xsIGhhc2ggdGhhdCBhdXRob3JpemVzIHRoZSBmdW5jdGlvbiBjYWxsCiAgKiovCiAgZnVuY3Rpb24ga2lsbFRvKGFkZHJlc3MgX3RvLCBieXRlczMyIF9oYXNoKQogICAgZXh0ZXJuYWwKICAgIG5vblplcm9BZGRyZXNzKF90bykKICAgIHBvbGxBcHByb3ZlZChfaGFzaCkKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogIHsKICAgIHNlbGZkZXN0cnVjdChfdG8pOwogIH0KCiAgLyoqCiAgICBAbm90aWNlIFBhdXNlIHRoZSBjb250cmFjdCBvcGVyYXRpb25zCiAgICBAcGFyYW0gX2hhc2ggcG9sbCBoYXNoIHRoYXQgYXV0aG9yaXplcyB0aGUgcGF1c2UKICAqKi8KICBmdW5jdGlvbiBwYXVzZShieXRlczMyIF9oYXNoKQogICAgZXh0ZXJuYWwKICAgIHBvbGxBcHByb3ZlZChfaGFzaCkKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgbm90QmVmb3JlR2VuZXNpcwogIHsKICAgIGlmICghcGF1c2VkKSB7CiAgICAgIHBhdXNlZCA9IHRydWU7CiAgICAgIExvZ1BhdXNlKF9oYXNoKTsKICAgIH0KICB9CgogIC8qKgogICAgQG5vdGljZSBVbnBhdXNlIHRoZSBjb250cmFjdCBvcGVyYXRpb25zCiAgICBAcGFyYW0gX2hhc2ggcG9sbCBoYXNoIHRoYXQgYXV0aG9yaXplcyB0aGUgdW5wYXVzZQogICoqLwogIGZ1bmN0aW9uIHVuUGF1c2UoYnl0ZXMzMiBfaGFzaCkKICAgIGV4dGVybmFsCiAgICBwb2xsQXBwcm92ZWQoX2hhc2gpCiAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIG5vdEJlZm9yZUdlbmVzaXMKICB7CiAgICBpZiAocGF1c2VkKSB7CiAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICBMb2dVblBhdXNlKF9oYXNoKTsKICAgIH0KICB9CgogIC8qKgogICAgQG5vdGljZSBTZXQgdGhlIGJ0aEZvdW5kYXRpb24gd2FsbGV0CiAgICBAcGFyYW0gX3dhbGxldCBuZXcgd2FsbGV0IGFkZHJlc3MKICAqKi8KICBmdW5jdGlvbiBzZXRCVEhGb3VuZGF0aW9uV2FsbGV0KGFkZHJlc3MgX3dhbGxldCkKICAgIGV4dGVybmFsCiAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIG5vblplcm9BZGRyZXNzKF93YWxsZXQpCiAgewogICAgYnRoRm91bmRhdGlvbldhbGxldCA9IF93YWxsZXQ7CiAgICBMb2dCVEhGb3VuZGF0aW9uV2FsbGV0Q2hhbmdlZChfd2FsbGV0KTsKICB9CgogIC8qKgogICAgQG5vdGljZSBSZXR1cm5zIHRoZSBjdXJyZW50IEJUSCBibG9jawogICAgQHJldHVybiBjdXJyZW50IGJ0aCBibG9jayBudW1iZXIKICAqKi8KICBmdW5jdGlvbiBjdXJyZW50QmxvY2soKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgbm90QmVmb3JlR2VuZXNpcwogICAgcmV0dXJucyh1aW50MjU2KQogIHsKICAgIHJldHVybiBibG9jay5udW1iZXIuc3ViKGdlbmVzaXMpOwogIH0KCiAgIC8qKgogICAgQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBoYWx2aW5nIG51bWJlciBvZiBhIGdpdmVuIGJsb2NrCiAgICBAcGFyYW0gX2Jsb2NrIGJsb2NrIG51bWJlcgogICAgQHJldHVybiB0aGUgaGFsdmluZyBvZiB0aGUgYmxvY2sKICAqKi8KICBmdW5jdGlvbiBibG9ja0hhbHZpbmcodWludDI1NiBfYmxvY2spCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIF9ibG9jay5kaXYoc3Vic2lkeUhhbHZpbmdJbnRlcnZhbCk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ2FsY3VsYXRlIHRoZSBvZmZzZXQgb2YgYSBnaXZlbiBibG9jawogICAgQHJldHVybiB0aGUgb2Zmc2V0IG9mIHRoZSBibG9jayBpbiBhIGhhbHZpbmcKICAqKi8KICBmdW5jdGlvbiBibG9ja09mZnNldCh1aW50MjU2IF9ibG9jaykKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIG5vdEJlZm9yZUdlbmVzaXMKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gX2Jsb2NrICUgc3Vic2lkeUhhbHZpbmdJbnRlcnZhbDsKICB9CgogIC8qKgogICAgQG5vdGljZSBEZXRlcm1pbmUgdGhlIGN1cnJlbnQgaGFsdmluZyBudW1iZXIKICAgIEByZXR1cm4gdGhlIGN1cnJlbnQgaGFsdmluZwogICoqLwogIGZ1bmN0aW9uIGN1cnJlbnRIYWx2aW5nKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIG5vdEJlZm9yZUdlbmVzaXMKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gYmxvY2tIYWx2aW5nKGN1cnJlbnRCbG9jaygpKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb21wdXRlIHRoZSBzdGFydGluZyBibG9jayBvZiBhIGhhbHZpbmcKICAgIEByZXR1cm4gdGhlIGluaXRpYWwgaGFsdmluZyBibG9jawogICoqLwogIGZ1bmN0aW9uIGhhbHZpbmdTdGFydEJsb2NrKHVpbnQyNTYgX2hhbHZpbmcpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIF9oYWx2aW5nLm11bChzdWJzaWR5SGFsdmluZ0ludGVydmFsKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDYWxjdWxhdGUgdGhlIHRvdGFsIHN1YnNpZHkgb2YgYSBibG9jawogICAgQHBhcmFtIF9ibG9jayBibG9jayBudW1iZXIKICAgIEByZXR1cm4gdGhlIHRvdGFsIGFtb3VudCB0aGF0IHdpbGwgYmUgc2hhcmVkIHdpdGggdGhlIG1pbmVycwogICoqLwogIGZ1bmN0aW9uIGJsb2NrU3Vic2lkeSh1aW50MjU2IF9ibG9jaykKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIG5vdEJlZm9yZUdlbmVzaXMKICAgIHJldHVybnModWludDI1NikKICB7CiAgICB1aW50MjU2IGhhbHZpbmdzID0gX2Jsb2NrLmRpdihzdWJzaWR5SGFsdmluZ0ludGVydmFsKTsKCiAgICBpZiAoaGFsdmluZ3MgPj0gbWF4SGFsdmluZ3MpIHJldHVybiAwOwoKICAgIHVpbnQyNTYgc3Vic2lkeSA9IElOSVRJQUxfU1VCU0lEWSA+PiBoYWx2aW5nczsKCiAgICByZXR1cm4gc3Vic2lkeTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb21wdXRlcyB0aGUgc3Vic2lkeSBvZiBhIGZ1bGwgaGFsdmluZwogICAgQHBhcmFtIF9oYWx2aW5nIGhhbHZpbmcKICAgIEByZXR1cm4gdGhlIHRvdGFsIGFtb3VudCB0aGF0IHdpbGwgYmUgc2hhcmVkIHdpdGggdGhlIG1pbmVycyBpbiB0aGlzIGhhbHZpbmcKICAqKi8KICBmdW5jdGlvbiBoYWx2aW5nU3Vic2lkeSh1aW50MjU2IF9oYWx2aW5nKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgbm90QmVmb3JlR2VuZXNpcwogICAgcmV0dXJucyh1aW50MjU2KQogIHsKICAgIHVpbnQyNTYgc3RhcnRCbG9jayA9IGhhbHZpbmdTdGFydEJsb2NrKF9oYWx2aW5nKTsKCiAgICByZXR1cm4gYmxvY2tTdWJzaWR5KHN0YXJ0QmxvY2spLm11bChzdWJzaWR5SGFsdmluZ0ludGVydmFsKTsKICB9CgogIC8vLyBAbm90aWNlIEZhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIGltcGxlbWVudHMgaG93IG1pbmVycyBwYXJ0aWNpcGF0ZSBpbiBCVEgKICBmdW5jdGlvbigpCiAgICBwYXlhYmxlCiAgewogICAgY29udHJpYnV0ZShtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb250cmlidXRlIHRvIHRoZSBtaW5pbmcgb2YgQlRIIG9uIGJlaGFsZiBvZiBhbm90aGVyIG1pbmVyCiAgICBAcGFyYW0gX21pbmVyIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHN1YnNpZGllcwogICAgQHJldHVybiB0cnVlIGlmIHN1Y2Nlc3MKICAqKi8KICBmdW5jdGlvbiBwcm94aWVkQ29udHJpYnV0aW9uKGFkZHJlc3MgX21pbmVyKQogICAgcHVibGljCiAgICBwYXlhYmxlCiAgICByZXR1cm5zIChib29sKQogIHsKICAgIGlmIChfbWluZXIgPT0gYWRkcmVzcygwKSkgewogICAgICAvLyBJbiBjYXNlIHRoZSBfbWluZXIgcGFyYW1ldGVyIGlzIGludmFsaWQsIHJlZGlyZWN0IHRoZSBhc2lnbm1lbnQKICAgICAgLy8gdG8gdGhlIHRyYW5zYWN0aW9uIHNlbmRlcgogICAgICByZXR1cm4gY29udHJpYnV0ZShtc2cuc2VuZGVyKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBjb250cmlidXRlKF9taW5lcik7CiAgICB9CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ29udHJpYnV0ZSB0byB0aGUgbWluaW5nIG9mIEJUSAogICAgQHBhcmFtIF9taW5lciBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBzdWJzaWRpZXMKICAgIEByZXR1cm4gdHJ1ZSBpZiBzdWNjZXNzCiAgKiovCiAgZnVuY3Rpb24gY29udHJpYnV0ZShhZGRyZXNzIF9taW5lcikKICAgIGludGVybmFsCiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICBub25aZXJvVmFsdWVkCiAgICBub3RQYXVzZWQKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgdWludDI1NiBibG9jayA9IGN1cnJlbnRCbG9jaygpOwogICAgdWludDI1NiBoYWx2aW5nID0gY3VycmVudEhhbHZpbmcoKTsKICAgIHVpbnQyNTYgaGFzaFJhdGUgPSBIQVNIX1JBVEVfTVVMVElQTElFUi5tdWwobXNnLnZhbHVlKTsKICAgIE1pbmVyIG1pbmVyID0gbWluZXJzW19taW5lcl07CgogICAgLy8gRmlyc3Qgb2YgYWxsIHVzZSB0aGUgY29udHJpYnV0ZSB0byBzeW5jaHJvbml6ZSB0aGUgaGFzaCByYXRlIG9mIHRoZSBwcmV2aW91cyBoYWx2aW5ncwogICAgaWYgKGhhbHZpbmcgIT0gMCAmJiBoYWx2aW5nIDwgbWF4SGFsdmluZ3MpIHsKICAgICAgdWludDI1NiBJOwogICAgICB1aW50MjU2IG4gPSAwOwogICAgICBmb3IgKEkgPSBoYWx2aW5nIC0gMTsgSSA+IDA7IEktLSkgewogICAgICAgIGlmICghaGFsdmluZ3NIYXNoUmF0ZVtJXS5jYXJyaWVkKSB7CiAgICAgICAgICBuID0gbi5hZGQoMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChJID0gaGFsdmluZyAtIG47IEkgPCBoYWx2aW5nOyBJKyspIHsKICAgICAgICBpZiAoIWhhbHZpbmdzSGFzaFJhdGVbSV0uY2FycmllZCkgewogICAgICAgICAgaGFsdmluZ3NIYXNoUmF0ZVtJXS5jYXJyaWVkID0gdHJ1ZTsKICAgICAgICAgIGhhbHZpbmdzSGFzaFJhdGVbSV0ucmF0ZSA9IGhhbHZpbmdzSGFzaFJhdGVbSV0ucmF0ZS5hZGQoaGFsdmluZ3NIYXNoUmF0ZVtJIC0gMV0ucmF0ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gSW5jcmVhc2UgdGhlIGhhbHZpbmcgaGFzaCByYXRlIGFjY29yZGluZ2x5LCBhZnRlciBtYXhIYWx2aW5ncyB0aGUgaGFsdmluZ3MgaGFzaCByYXRlIGFyZSBub3QgbmVlZGVkIGFuZCB0aGVyZWZvcmUgbm90IHVwZGF0ZWQKICAgIGlmIChoYWx2aW5nIDwgbWF4SGFsdmluZ3MpIHsKICAgICAgaGFsdmluZ3NIYXNoUmF0ZVtoYWx2aW5nXS5yYXRlID0gaGFsdmluZ3NIYXNoUmF0ZVtoYWx2aW5nXS5yYXRlLmFkZChoYXNoUmF0ZSk7CiAgICB9CgogICAgLy8gQWZ0ZXIgdXBkYXRpbmcgdGhlIGhhbHZpbmcgaGFzaCByYXRlLCBkbyB0aGUgbWluZXIgY29udHJpYnV0aW9uCgogICAgLy8gSWYgaXQncyB0aGUgdmVyeSBmaXJzdCB0aW1lIHRoZSBtaW5lciBwYXJ0aWNpcGF0ZXMgaW4gdGhlIEJUSCB0b2tlbiwgYXNzaWduIGFuIGluaXRpYWwgYmxvY2sKICAgIC8vIFRoaXMgYmxvY2sgaXMgdXNlZCB3aXRoIHR3byBwb3Jwb3VzZXM6CiAgICAvLyAgICAtIFRvIGFjY291bnQgaW4gd2hpY2ggaGFsdmluZyB0aGUgbWluZXIgaXMKICAgIC8vICAgIC0gVG8ga25vdyB0aGUgb2Zmc2V0IGluc2lkZSB0aGUgaGFsdmluZyBhbmQgYWxsb3cgb25seSBjbGFpbWluZ3MgYWZ0ZXIgdGhlIG1pbmVyIG9mZnNldAogICAgaWYgKG1pbmVyLmJsb2NrID09IDApIHsKICAgICAgbWluZXIuYmxvY2sgPSBibG9jazsKICAgIH0KCiAgICAvLyBBZGQgdGhpcyBoYXNoIHJhdGUgdG8gdGhlIG1pbmVyIGF0IHRoZSBjdXJyZW50IGhhbHZpbmcKICAgIG1pbmVyLmhhc2hSYXRlW2hhbHZpbmddLnJhdGUgPSBtaW5lci5oYXNoUmF0ZVtoYWx2aW5nXS5yYXRlLmFkZChoYXNoUmF0ZSk7CiAgICBtaW5lci50b3RhbEhhc2hSYXRlID0gbWluZXIudG90YWxIYXNoUmF0ZS5hZGQoaGFzaFJhdGUpOwoKICAgIC8vIEluY3JlYXNlIHRoZSB0b3RhbCBoYXNoIHJhdGUKICAgIHRvdGFsSGFzaFJhdGUgPSB0b3RhbEhhc2hSYXRlLmFkZChoYXNoUmF0ZSk7CgogICAgLy8gU2VuZCBjb250cmlidXRpb24gdG8gdGhlIEJUSCBmb3VuZGF0aW9uIG11bHRpc2lnIHdhbGxldAogICAgaWYgKCFidGhGb3VuZGF0aW9uV2FsbGV0LnNlbmQobXNnLnZhbHVlKSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBMb2cgdGhlIGNvbnRyaWJ1dGUgY2FsbAogICAgTG9nQ29udHJpYnV0aW9uKF9taW5lciwgbXNnLnZhbHVlLCBoYXNoUmF0ZSwgYmxvY2ssIGhhbHZpbmcpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICBAbm90aWNlIE1pbmVycyBzdWJzaWRpZXMgbXVzdCBiZSBjbGFpbWVkIGJ5IHRoZSBtaW5lcnMgY2FsbGluZyBjbGFpbUhhbHZpbmdzU3Vic2lkaWVzKF9uKQogICAgQHBhcmFtIF9uIG51bWJlciBvZiBoYWx2aW5ncyB0byBjbGFpbQogICAgQHJldHVybiB0aGUgdG90YWwgYW1vdW50IGNsYWltZWQgYW5kIHN1Y2Nlc3NmdWxseSBhc3NpZ25lZCBhcyBCVEggdG8gdGhlIG1pbmVyCiAgKiovCiAgZnVuY3Rpb24gY2xhaW1IYWx2aW5nc1N1YnNpZGllcyh1aW50MjU2IF9uKQogICAgcHVibGljCiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICBub3RQYXVzZWQKICAgIGlzTWluZXIobXNnLnNlbmRlcikKICAgIHJldHVybnModWludDI1NikKICB7CiAgICBNaW5lciBtaW5lciA9IG1pbmVyc1ttc2cuc2VuZGVyXTsKICAgIHVpbnQyNTYgc3RhcnQgPSBibG9ja0hhbHZpbmcobWluZXIuYmxvY2spOwogICAgdWludDI1NiBlbmQgPSBzdGFydC5hZGQoX24pOwoKICAgIGlmIChlbmQgPiBjdXJyZW50SGFsdmluZygpKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVpbnQyNTYgc3Vic2lkeSA9IDA7CiAgICB1aW50MjU2IHRvdGFsU3Vic2lkeSA9IDA7CiAgICB1aW50MjU2IHVuY2xhaW1lZCA9IDA7CiAgICB1aW50MjU2IGhhc2hSYXRlID0gMDsKICAgIHVpbnQyNTYgSzsKCiAgICAvLyBDbGFpbSBlYWNoIHVuY2xhaW1lZCBoYWx2aW5nIHN1YnNpZHkKICAgIGZvcihLID0gc3RhcnQ7IEsgPCBlbmQgJiYgSyA8IG1heEhhbHZpbmdzOyBLKyspIHsKICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvdGFsIGhhc2ggcmF0ZSBoYXMgYmVlbiBjYXJyaWVkLCBvdGhlcndpc2UgdGhlIGN1cnJlbnQgaGFsdmluZwogICAgICAvLyBoYXNoIHJhdGUgbmVlZHMgdG8gYmUgdXBkYXRlZCBjYXJyeWluZyB0aGUgdG90YWwgZnJvbSB0aGUgbGFzdCBjYXJyaWVkCiAgICAgIEhhbHZpbmdIYXNoUmF0ZSBoYWx2aW5nSGFzaFJhdGUgPSBoYWx2aW5nc0hhc2hSYXRlW0tdOwoKICAgICAgaWYgKCFoYWx2aW5nSGFzaFJhdGUuY2FycmllZCkgewogICAgICAgIGhhbHZpbmdIYXNoUmF0ZS5jYXJyaWVkID0gdHJ1ZTsKICAgICAgICBoYWx2aW5nSGFzaFJhdGUucmF0ZSA9IGhhbHZpbmdIYXNoUmF0ZS5yYXRlLmFkZChoYWx2aW5nc0hhc2hSYXRlW0stMV0ucmF0ZSk7CiAgICAgIH0KCiAgICAgIC8vIEFjY3VtdWxhdGUgdGhlIG1pbmVyIGhhc2ggcmF0ZSBhcyBhbGwgdGhlIGNvbnRyaWJ1dGlvbnMgYXJlIGFjY291bnRlZCBpbiB0aGUgY29udHJpYnV0aW9uCiAgICAgIC8vIGFuZCBuZWVkcyB0byBiZSBzdW1tZWQgdXAgdG8gcmVmbGVjdCB0aGUgYWNjdW11bGF0ZWQgdmFsdWUKICAgICAgTWluZXJIYXNoUmF0ZSBtaW5lckhhc2hSYXRlID0gbWluZXIuaGFzaFJhdGVbS107CiAgICAgIGlmICghbWluZXJIYXNoUmF0ZS5jYXJyaWVkKSB7CiAgICAgICAgbWluZXJIYXNoUmF0ZS5jYXJyaWVkID0gdHJ1ZTsKICAgICAgICBtaW5lckhhc2hSYXRlLnJhdGUgPSBtaW5lckhhc2hSYXRlLnJhdGUuYWRkKG1pbmVyLmhhc2hSYXRlW0stMV0ucmF0ZSk7CiAgICAgIH0KCiAgICAgIGhhc2hSYXRlID0gbWluZXJIYXNoUmF0ZS5yYXRlOwoKICAgICAgaWYgKGhhc2hSYXRlICE9IDApewogICAgICAgIC8vIElmIHRoZSBoYWx2aW5nIHRvIGNsYWltIGlzIHRoZSBsYXN0IGNsYWltYWJsZSwgY2hlY2sgdGhlIG9mZnNldHMKICAgICAgICBpZiAoSyA9PSBjdXJyZW50SGFsdmluZygpLnN1YigxKSkgewogICAgICAgICAgaWYgKGN1cnJlbnRCbG9jaygpICUgc3Vic2lkeUhhbHZpbmdJbnRlcnZhbCA8IG1pbmVyLmJsb2NrICUgc3Vic2lkeUhhbHZpbmdJbnRlcnZhbCkgewogICAgICAgICAgICAvLyBGaW5pc2ggdGhlIGxvb3AKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBTdWJzaWR5IHN1YiA9IGhhbHZpbmdzU3Vic2lkaWVzW0tdOwoKICAgICAgICBpZiAoIXN1Yi5jbGFpbWVkKSB7CiAgICAgICAgICBzdWIuY2xhaW1lZCA9IHRydWU7CiAgICAgICAgICBzdWIudmFsdWUgPSBoYWx2aW5nU3Vic2lkeShLKTsKICAgICAgICB9CgogICAgICAgIHVuY2xhaW1lZCA9IHN1Yi52YWx1ZTsKICAgICAgICBzdWJzaWR5ID0gaGFsdmluZ1N1YnNpZHkoSykubXVsKGhhc2hSYXRlKS5kaXYoaGFsdmluZ0hhc2hSYXRlLnJhdGUpOwoKICAgICAgICBpZiAoc3Vic2lkeSA+IHVuY2xhaW1lZCkgewogICAgICAgICAgc3Vic2lkeSA9IHVuY2xhaW1lZDsKICAgICAgICB9CgogICAgICAgIHRvdGFsU3Vic2lkeSA9IHRvdGFsU3Vic2lkeS5hZGQoc3Vic2lkeSk7CiAgICAgICAgc3ViLnZhbHVlID0gc3ViLnZhbHVlLnN1YihzdWJzaWR5KTsKCiAgICAgICAgTG9nQ2xhaW1IYWx2aW5nU3Vic2lkeShtc2cuc2VuZGVyLCBtaW5lci5ibG9jaywgSywgc3Vic2lkeSk7CiAgICAgICAgTG9nUmVtYWluaW5nSGFsdmluZ1N1YnNpZHkoSywgc3ViLnZhbHVlKTsKICAgICAgfQoKICAgICAgLy8gTW92ZSB0aGUgbWluZXIgdG8gdGhlIG5leHQgaGFsdmluZwogICAgICBtaW5lci5ibG9jayA9IG1pbmVyLmJsb2NrLmFkZChzdWJzaWR5SGFsdmluZ0ludGVydmFsKTsKICAgIH0KCiAgICAvLyBJZiBLIGlzIGxlc3MgdGhhbiBlbmQsIHRoZSBsb29wIGV4aXRlZCBiZWNhdXNlIEsgPCBtYXhIYWx2aW5ncywgc28KICAgIC8vIG1vdmUgdGhlIG1pbmVyIGVuZCAtIEsgaGFsdmluZ3MKICAgIGlmIChLIDwgZW5kKSB7CiAgICAgIG1pbmVyLmJsb2NrID0gbWluZXIuYmxvY2suYWRkKHN1YnNpZHlIYWx2aW5nSW50ZXJ2YWwubXVsKGVuZC5zdWIoSykpKTsKICAgIH0KCiAgICBpZiAodG90YWxTdWJzaWR5ICE9IDApewogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZCh0b3RhbFN1YnNpZHkpOwogICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZCh0b3RhbFN1YnNpZHkpOwogICAgfQoKICAgIHJldHVybiB0b3RhbFN1YnNpZHk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ29tcHV0ZSB0aGUgbnVtYmVyIG9mIGhhbHZpbmdzIGNsYWltYWJsZSBieSB0aGUgbWluZXIgY2FsbGVyCiAgICBAcmV0dXJuIG51bWJlciBvZiBoYWx2aW5ncyB0aGF0IGEgbWluZXIgaXMgYWxsb3dlZCB0byBjbGFpbQogICoqLwogIGZ1bmN0aW9uIGNsYWltYWJsZUhhbHZpbmdzKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gY2xhaW1hYmxlSGFsdmluZ3NPZihtc2cuc2VuZGVyKTsKICB9CgoKICAvKioKICAgIEBub3RpY2UgQ29tcHV0ZXMgdGhlIG51bWJlciBvZiBoYWx2aW5ncyBjbGFpbWFibGUgYnkgdGhlIG1pbmVyCiAgICBAcmV0dXJuIG51bWJlciBvZiBoYWx2aW5ncyB0aGF0IGEgbWluZXIgaXMgZW50aXRsZWQgY2xhaW0KICAqKi8KICBmdW5jdGlvbiBjbGFpbWFibGVIYWx2aW5nc09mKGFkZHJlc3MgX21pbmVyKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgbm90QmVmb3JlR2VuZXNpcwogICAgaXNNaW5lcihfbWluZXIpCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgTWluZXIgbWluZXIgPSBtaW5lcnNbX21pbmVyXTsKICAgIHVpbnQyNTYgaGFsdmluZyA9IGN1cnJlbnRIYWx2aW5nKCk7CiAgICB1aW50MjU2IG1pbmVySGFsdmluZyA9IGJsb2NrSGFsdmluZyhtaW5lci5ibG9jayk7CgogICAgLy8gSGFsdmluZ3MgY2FuIGJlIGNsYWltZWQgd2hlbiB0aGV5IGFyZSBmaW5pc2hlZAogICAgaWYgKG1pbmVySGFsdmluZyA9PSBoYWx2aW5nKSB7CiAgICAgIHJldHVybiAwOwogICAgfSBlbHNlIHsKICAgICAgLy8gQ2hlY2sgdGhlIG1pbmVyIG9mZnNldAogICAgICBpZiAoY3VycmVudEJsb2NrKCkgJSBzdWJzaWR5SGFsdmluZ0ludGVydmFsIDwgbWluZXIuYmxvY2sgJSBzdWJzaWR5SGFsdmluZ0ludGVydmFsKSB7CiAgICAgICAgLy8gSW4gdGhpcyBjYXNlIHRoZSBtaW5lciBvZmZzZXQgaXMgYmVoaW5kIHRoZSBjdXJyZW50IGJsb2NrIG9mZnNldCwgc28gaXQgbXVzdCB3YWl0CiAgICAgICAgLy8gdGlsbCB0aGUgYmxvY2sgb2Zmc2V0IGlzIGdyZWF0ZXIgb3IgZXF1YWwgdGhhbiBoaXMgb2Zmc2V0CiAgICAgICAgcmV0dXJuIGhhbHZpbmcuc3ViKG1pbmVySGFsdmluZykuc3ViKDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBoYWx2aW5nLnN1YihtaW5lckhhbHZpbmcpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ2xhaW0gYWxsIHRoZSB1bmNsYWltZWQgaGFsdmluZyBzdWJzaWRpZXMgb2YgYSBtaW5lcgogICAgQHJldHVybiB0b3RhbCBhbW91bnQgb2YgQlRIIGFzc2lnbmVkIHRvIHRoZSBtaW5lcgogICoqLwogIGZ1bmN0aW9uIGNsYWltKCkKICAgIHB1YmxpYwogICAgbm90QmVmb3JlR2VuZXNpcwogICAgbm90UGF1c2VkCiAgICBpc01pbmVyKG1zZy5zZW5kZXIpCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIGNsYWltSGFsdmluZ3NTdWJzaWRpZXMoY2xhaW1hYmxlSGFsdmluZ3MoKSk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgRVJDMjAgdHJhbnNmZXIgZnVuY3Rpb24gb3ZlcnJpZGRlbiB0byBkaXNhYmxlIHRyYW5zZmVycyB3aGVuIHBhdXNlZAogICoqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgIHB1YmxpYwogICAgbm90UGF1c2VkCiAgewogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICBAbm90aWNlIEVSQzIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbiBvdmVycmlkZGVuIHRvIGRpc2FibGUgdHJhbnNmZXJzIHdoZW4gcGF1c2VkCiAgKiovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgIHB1YmxpYwogICAgbm90UGF1c2VkCiAgewogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvLyBQb2xsIGZ1bmN0aW9ucwoKICAvKioKICAgIEBub3RpY2UgQ3JlYXRlIGEgbmV3IHBvbGwKICAgIEBwYXJhbSBfdGl0bGUgcG9sbCB0aXRsZQogICAgQHBhcmFtIF9wZXJjZW50YWdlIHBlcmNlbnRhZ2Ugb2YgaGFzaCByYXRlIHRoYXQgbXVzdCB2b3RlIHRvIGFwcHJvdmUgdGhlIHBvbGwKICAqKi8KICBmdW5jdGlvbiBjcmVhdGVQb2xsKHN0cmluZyBfdGl0bGUsIHVpbnQ4IF9wZXJjZW50YWdlKQogICAgZXh0ZXJuYWwKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogIHsKICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTMoX3RpdGxlKTsKICAgIFBvbGwgcG9sbCA9IHBvbGxzW2hhc2hdOwoKICAgIGlmIChwb2xsLmV4aXN0cykgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBpZiAoX3BlcmNlbnRhZ2UgPCAxIHx8IF9wZXJjZW50YWdlID4gMTAwKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIHBvbGwuZXhpc3RzID0gdHJ1ZTsKICAgIHBvbGwudGl0bGUgPSBfdGl0bGU7CiAgICBwb2xsLnBlcmNlbnRhZ2UgPSBfcGVyY2VudGFnZTsKICAgIHBvbGwuaGFzaFJhdGUgPSAwOwogICAgcG9sbC5hcHByb3ZlZCA9IGZhbHNlOwogICAgcG9sbC5hcHByb3ZhbEJsb2NrID0gMDsKICAgIHBvbGwuYXBwcm92YWxIYXNoUmF0ZSA9IDA7CiAgICBwb2xsLmFwcHJvdmFsVG90YWxIYXNoUmF0ZSA9IDA7CgogICAgTG9nUG9sbENyZWF0ZWQoaGFzaCk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgRGVsZXRlIGEgcG9sbAogICAgQHBhcmFtIF9oYXNoIHNoYTMgb2YgdGhlIHBvbGwgdGl0bGUsIGFsc28gYXJnIG9mIExvZ1BvbGxDcmVhdGVkIGV2ZW50CiAgKiovCiAgZnVuY3Rpb24gZGVsZXRlUG9sbChieXRlczMyIF9oYXNoKQogICAgZXh0ZXJuYWwKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogIHsKICAgIFBvbGwgcG9sbCA9IHBvbGxzW19oYXNoXTsKCiAgICBpZiAocG9sbC5leGlzdHMpIHsKICAgICAgZGVsZXRlIHBvbGxzW19oYXNoXTsKCiAgICAgIExvZ1BvbGxEZWxldGVkKF9oYXNoKTsKICAgIH0KICB9CgogIC8qKgogICAgQG5vdGljZSBSZXRyZWl2ZSB0aGUgcG9sbCBkYXRhCiAgICBAcGFyYW0gX2hhc2ggc2hhMyBvZiB0aGUgcG9sbCB0aXRsZSwgYWxzbyBhcmcgb2YgTG9nUG9sbENyZWF0ZWQgZXZlbnQKICAgIEByZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgcG9sbCBkYXRhCiAgKiovCiAgZnVuY3Rpb24gZ2V0UG9sbChieXRlczMyIF9oYXNoKQogICAgZXh0ZXJuYWwKICAgIGNvbnN0YW50CiAgICByZXR1cm5zKGJvb2wsIHN0cmluZywgdWludDgsIHVpbnQyNTYsIHVpbnQyNTYsIGJvb2wsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYpCiAgewogICAgUG9sbCBwb2xsID0gcG9sbHNbX2hhc2hdOwoKICAgIHJldHVybiAocG9sbC5leGlzdHMsIHBvbGwudGl0bGUsIHBvbGwucGVyY2VudGFnZSwgcG9sbC5oYXNoUmF0ZSwgdG90YWxIYXNoUmF0ZSwKICAgICAgcG9sbC5hcHByb3ZlZCwgcG9sbC5hcHByb3ZhbEJsb2NrLCBwb2xsLmFwcHJvdmFsSGFzaFJhdGUsIHBvbGwuYXBwcm92YWxUb3RhbEhhc2hSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHZvdGUoYnl0ZXMzMiBfaGFzaCkKICAgIGV4dGVybmFsCiAgICBpc01pbmVyKG1zZy5zZW5kZXIpCiAgewogICAgUG9sbCBwb2xsID0gcG9sbHNbX2hhc2hdOwoKICAgIGlmIChwb2xsLmV4aXN0cykgewogICAgICBpZiAoIXBvbGwudm90ZXNbbXNnLnNlbmRlcl0pIHsKICAgICAgICAvLyBtc2cuc2VuZGVyIGhhcyBub3QgeWV0IHZvdGVkCiAgICAgICAgTWluZXIgbWluZXIgPSBtaW5lcnNbbXNnLnNlbmRlcl07CgogICAgICAgIHBvbGwudm90ZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIHBvbGwuaGFzaFJhdGUgPSBwb2xsLmhhc2hSYXRlLmFkZChtaW5lci50b3RhbEhhc2hSYXRlKTsKCiAgICAgICAgLy8gTG9nIHRoZSB2b3RlCiAgICAgICAgTG9nUG9sbFZvdGVkKF9oYXNoLCBtc2cuc2VuZGVyLCBtaW5lci50b3RhbEhhc2hSYXRlKTsKCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBvbGwgaGFzIHN1Y2NlZWRlZAogICAgICAgIGlmICghcG9sbC5hcHByb3ZlZCkgewogICAgICAgICAgaWYgKHBvbGwuaGFzaFJhdGUubXVsKDEwMCkuZGl2KHRvdGFsSGFzaFJhdGUpID49IHBvbGwucGVyY2VudGFnZSkgewogICAgICAgICAgICBwb2xsLmFwcHJvdmVkID0gdHJ1ZTsKCiAgICAgICAgICAgIHBvbGwuYXBwcm92YWxCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICAgICAgcG9sbC5hcHByb3ZhbEhhc2hSYXRlID0gcG9sbC5oYXNoUmF0ZTsKICAgICAgICAgICAgcG9sbC5hcHByb3ZhbFRvdGFsSGFzaFJhdGUgPSB0b3RhbEhhc2hSYXRlOwoKICAgICAgICAgICAgTG9nUG9sbEFwcHJvdmVkKF9oYXNoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qCiAgICogSW50ZXJuYWwgZnVuY3Rpb25zCiAgICovCgoKICAvKgogICAqIFdlYjMgY2FsbCBmdW5jdGlvbnMKICAgKi8KCiAgLyoqCiAgICBAbm90aWNlIFJldHVybiB0aGUgYmxvY2tzIHBlciBoYWx2aW5nCiAgICBAcmV0dXJuIGJsb2NrcyBwZXIgaGFsdmluZwogICoqLwogIGZ1bmN0aW9uIGdldEhhbHZpbmdCbG9ja3MoKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgbm90QmVmb3JlR2VuZXNpcwogICAgcmV0dXJucyh1aW50MjU2KQogIHsKICAgIHJldHVybiBzdWJzaWR5SGFsdmluZ0ludGVydmFsOwogIH0KCiAgLyoqCiAgICBAbm90aWNlIFJldHVybiB0aGUgYmxvY2sgaW4gd2hpY2ggdGhlIG1pbmVyIGlzCiAgICBAcmV0dXJuIHRoZSBsYXN0IGJsb2NrIG51bWJlciBtaW5lZCBieSB0aGUgbWluZXIKICAqKi8KICBmdW5jdGlvbiBnZXRNaW5lckJsb2NrKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gZ2V0QmxvY2tPZihtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBSZXR1cm4gdGhlIGJsb2NrIGluIHdoaWNoIHRoZSBtaW5lciBpcwogICAgQHJldHVybiB0aGUgbGFzdCBibG9jayBudW1iZXIgbWluZWQgYnkgdGhlIG1pbmVyCiAgKiovCiAgZnVuY3Rpb24gZ2V0QmxvY2tPZihhZGRyZXNzIF9taW5lcikKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIG5vdEJlZm9yZUdlbmVzaXMKICAgIGlzTWluZXIoX21pbmVyKQogICAgcmV0dXJucyh1aW50MjU2KQogIHsKICAgIHJldHVybiBtaW5lcnNbX21pbmVyXS5ibG9jazsKICB9CgogIC8qKgogICAgQG5vdGljZSBSZXR1cm4gdGhlIG1pbmVyIGhhbHZpbmcgKHN0YXJ0aW5nIGhhbHZpbmcgb3IgbGFzdCBjbGFpbWVkKQogICAgQHJldHVybiBsYXN0IGNsYWltZWQgb3Igc3RhcnRpbmcgaGFsdmluZyBvZiB0aGUgbWluZXIKICAqKi8KICBmdW5jdGlvbiBnZXRIYWx2aW5nT2YoYWRkcmVzcyBfbWluZXIpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICBpc01pbmVyKF9taW5lcikKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gYmxvY2tIYWx2aW5nKG1pbmVyc1tfbWluZXJdLmJsb2NrKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBSZXR1cm4gdGhlIG1pbmVyIGhhbHZpbmcgKHN0YXJ0aW5nIGhhbHZpbmcgb3IgbGFzdCBjbGFpbWVkKQogICAgQHJldHVybiBsYXN0IGNsYWltZWQgb3Igc3RhcnRpbmcgaGFsdmluZyBvZiB0aGUgbWluZXIKICAqKi8KICBmdW5jdGlvbiBnZXRNaW5lckhhbHZpbmcoKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyh1aW50MjU2KQogIHsKICAgIHJldHVybiBnZXRIYWx2aW5nT2YobXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgIEBub3RpY2UgVG90YWwgaGFzaCByYXRlIG9mIGEgbWluZXIgaW4gYSBoYWx2aW5nCiAgICBAcGFyYW0gX21pbmVyIGFkZHJlc3Mgb2YgdGhlIG1pbmVyCiAgICBAcmV0dXJuIG1pbmVyIHRvdGFsIGFjY3VtdWxhdGVkIGhhc2ggcmF0ZQogICoqLwogIGZ1bmN0aW9uIGdldE1pbmVySGFsdmluZ0hhc2hSYXRlT2YoYWRkcmVzcyBfbWluZXIpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICBpc01pbmVyKF9taW5lcikKICAgIHJldHVybnModWludDI1NikKICB7CiAgICBNaW5lciBtaW5lciA9IG1pbmVyc1tfbWluZXJdOwogICAgdWludDI1NiBoYWx2aW5nID0gZ2V0TWluZXJIYWx2aW5nKCk7CiAgICBNaW5lckhhc2hSYXRlIGhhc2hSYXRlID0gbWluZXIuaGFzaFJhdGVbaGFsdmluZ107CgogICAgaWYgKGhhbHZpbmcgPT0gMCkgewogICAgICByZXR1cm4gIGhhc2hSYXRlLnJhdGU7CiAgICB9IGVsc2UgewogICAgICBpZiAoIWhhc2hSYXRlLmNhcnJpZWQpIHsKICAgICAgICByZXR1cm4gaGFzaFJhdGUucmF0ZS5hZGQobWluZXIuaGFzaFJhdGVbaGFsdmluZyAtIDFdLnJhdGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBoYXNoUmF0ZS5yYXRlOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgIEBub3RpY2UgVG90YWwgaGFzaCByYXRlIG9mIGEgbWluZXIgaW4gYSBoYWx2aW5nCiAgICBAcmV0dXJuIG1pbmVyIHRvdGFsIGFjY3VtdWxhdGVkIGhhc2ggcmF0ZQogICoqLwogIGZ1bmN0aW9uIGdldE1pbmVySGFsdmluZ0hhc2hSYXRlKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gZ2V0TWluZXJIYWx2aW5nSGFzaFJhdGVPZihtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb21wdXRlIHRoZSBtaW5lciBoYWx2aW5ncyBvZmZzZXQKICAgIEBwYXJhbSBfbWluZXIgYWRkcmVzcyBvZiB0aGUgbWluZXIKICAgIEByZXR1cm4gbWluZXIgaGFsdmluZyBvZmZzZXQKICAqKi8KICBmdW5jdGlvbiBnZXRNaW5lck9mZnNldE9mKGFkZHJlc3MgX21pbmVyKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgbm90QmVmb3JlR2VuZXNpcwogICAgaXNNaW5lcihfbWluZXIpCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIGJsb2NrT2Zmc2V0KG1pbmVyc1tfbWluZXJdLmJsb2NrKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb21wdXRlIHRoZSBtaW5lciBoYWx2aW5ncyBvZmZzZXQKICAgIEByZXR1cm4gbWluZXIgaGFsdmluZyBvZmZzZXQKICAqKi8KICBmdW5jdGlvbiBnZXRNaW5lck9mZnNldCgpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIGdldE1pbmVyT2Zmc2V0T2YobXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ2FsY3VsYXRlIHRoZSBoYXNoIHJhdGUgb2YgYSBtaW5lciBpbiBhIGhhbHZpbmcKICAgIEBkZXYgVGFrZSBpbnRvIGFjY291bnQgdGhhdCB0aGUgcmF0ZSBjYW4gYmUgdW5jYXJyaWVkCiAgICBAcGFyYW0gX2hhbHZpbmcgbnVtYmVyIG9mIGhhbHZpbmcKICAgIEByZXR1cm4gKGNhcnJpZWQsIHJhdGUpIGEgdHVwbGUgd2l0aCB0aGUgcmF0ZSBhbmQgaWYgdGhlIHZhbHVlIGhhcyBiZWVuIGNhcnJpZWQgZnJvbSBwcmV2aW91cyBoYWx2aW5ncwogICoqLwogIGZ1bmN0aW9uIGdldEhhc2hSYXRlT2YoYWRkcmVzcyBfbWluZXIsIHVpbnQyNTYgX2hhbHZpbmcpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICBub3RCZWZvcmVHZW5lc2lzCiAgICBpc01pbmVyKF9taW5lcikKICAgIHJldHVybnMoYm9vbCwgdWludDI1NikKICB7CiAgICByZXF1aXJlKF9oYWx2aW5nIDw9IGN1cnJlbnRIYWx2aW5nKCkpOwoKICAgIE1pbmVyIG1pbmVyID0gbWluZXJzW19taW5lcl07CiAgICBNaW5lckhhc2hSYXRlIGhhc2hSYXRlID0gbWluZXIuaGFzaFJhdGVbX2hhbHZpbmddOwoKICAgIHJldHVybiAoaGFzaFJhdGUuY2FycmllZCwgaGFzaFJhdGUucmF0ZSk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ2FsY3VsYXRlIHRoZSBoYWx2aW5nIGhhc2ggcmF0ZSBvZiBhIG1pbmVyCiAgICBAZGV2IFRha2UgaW50byBhY2NvdW50IHRoYXQgdGhlIHJhdGUgY2FuIGJlIHVuY2FycmllZAogICAgQHBhcmFtIF9taW5lciBhZGRyZXNzIG9mIHRoZSBtaW5lcgogICAgQHJldHVybiAoY2FycmllZCwgcmF0ZSkgYSB0dXBsZSB3aXRoIHRoZSByYXRlIGFuZCBpZiB0aGUgdmFsdWUgaGFzIGJlZW4gY2FycmllZCBmcm9tIHByZXZpb3VzIGhhbHZpbmdzCiAgKiovCiAgZnVuY3Rpb24gZ2V0SGFzaFJhdGVPZkN1cnJlbnRIYWx2aW5nKGFkZHJlc3MgX21pbmVyKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyhib29sLCB1aW50MjU2KQogIHsKICAgIHJldHVybiBnZXRIYXNoUmF0ZU9mKF9taW5lciwgY3VycmVudEhhbHZpbmcoKSk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgQ2FsY3VsYXRlIHRoZSBoYWx2aW5nIGhhc2ggcmF0ZSBvZiBhIG1pbmVyCiAgICBAZGV2IFRha2UgaW50byBhY2NvdW50IHRoYXQgdGhlIHJhdGUgY2FuIGJlIHVuY2FycmllZAogICAgQHBhcmFtIF9oYWx2aW5nIG51bWVyIG9mIHRoZSBtaW5lciBoYWx2aW5nCiAgICBAcmV0dXJuIChjYXJyaWVkLCByYXRlKSBhIHR1cGxlIHdpdGggdGhlIHJhdGUgYW5kIGlmIHRoZSB2YWx1ZSBoYXMgYmVlbiBjYXJyaWVkIGZyb20gcHJldmlvdXMgaGFsdmluZ3MKICAqKi8KICBmdW5jdGlvbiBnZXRNaW5lckhhc2hSYXRlKHVpbnQyNTYgX2hhbHZpbmcpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zKGJvb2wsIHVpbnQyNTYpCiAgewogICAgcmV0dXJuIGdldEhhc2hSYXRlT2YobXNnLnNlbmRlciwgX2hhbHZpbmcpOwogIH0KCiAgLyoqCiAgICBAbm90aWNlIENhbGN1bGF0ZSB0aGUgaGFsdmluZyBoYXNoIHJhdGUgb2YgYSBtaW5lcgogICAgQGRldiBUYWtlIGludG8gYWNjb3VudCB0aGF0IHRoZSByYXRlIGNhbiBiZSB1bmNhcnJpZWQKICAgIEByZXR1cm4gKGNhcnJpZWQsIHJhdGUpIGEgdHVwbGUgd2l0aCB0aGUgcmF0ZSBhbmQgaWYgdGhlIHZhbHVlIGhhcyBiZWVuIGNhcnJpZWQgZnJvbSBwcmV2aW91cyBoYWx2aW5ncwogICoqLwogIGZ1bmN0aW9uIGdldE1pbmVySGFzaFJhdGVDdXJyZW50SGFsdmluZygpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zKGJvb2wsIHVpbnQyNTYpCiAgewogICAgcmV0dXJuIGdldEhhc2hSYXRlT2YobXNnLnNlbmRlciwgY3VycmVudEhhbHZpbmcoKSk7CiAgfQoKICAvKioKICAgIEBub3RpY2UgVG90YWwgaGFzaCByYXRlIG9mIGEgbWluZXIKICAgIEByZXR1cm4gbWluZXIgdG90YWwgYWNjdW11bGF0ZWQgaGFzaCByYXRlCiAgKiovCiAgZnVuY3Rpb24gZ2V0VG90YWxIYXNoUmF0ZU9mKGFkZHJlc3MgX21pbmVyKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgbm90QmVmb3JlR2VuZXNpcwogICAgaXNNaW5lcihfbWluZXIpCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIG1pbmVyc1tfbWluZXJdLnRvdGFsSGFzaFJhdGU7CiAgfQoKICAvKioKICAgIEBub3RpY2UgVG90YWwgaGFzaCByYXRlIG9mIGEgbWluZXIKICAgIEByZXR1cm4gbWluZXIgdG90YWwgYWNjdW11bGF0ZWQgaGFzaCByYXRlCiAgKiovCiAgZnVuY3Rpb24gZ2V0VG90YWxIYXNoUmF0ZSgpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIGdldFRvdGFsSGFzaFJhdGVPZihtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAgQG5vdGljZSBDb21wdXRlcyB0aGUgcmVtYWluaW5nIHN1YnNpZHkgcGVuZGluZyBvZiBiZWluZyBjbGFpbWVkIGZvciBhIGdpdmVuIGhhbHZpbmcKICAgIEBwYXJhbSBfaGFsdmluZyBudW1iZXIgb2YgaGFsdmluZwogICAgQHJldHVybiB0aGUgcmVtYWluaW5nIHN1YnNpZHkgb2YgYSBoYWx2aW5nCiAgKiovCiAgZnVuY3Rpb24gZ2V0VW5jbGFpbWVkSGFsdmluZ1N1YnNpZHkodWludDI1NiBfaGFsdmluZykKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIG5vdEJlZm9yZUdlbmVzaXMKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXF1aXJlKF9oYWx2aW5nIDwgY3VycmVudEhhbHZpbmcoKSk7CgogICAgaWYgKCFoYWx2aW5nc1N1YnNpZGllc1tfaGFsdmluZ10uY2xhaW1lZCkgewogICAgICAvLyBJbiB0aGUgY2FzZSB0aGF0IHRoZSBoYWx2aW5nIHN1YnNpZHkgaGFzbid0IGJlZW4gaW5zdGFudGlhdGVkCiAgICAgIC8vICguY2xhaW1lZCBpcyBmYWxzZSkgcmV0dXJuIHRoZSBmdWxsIGhhbHZpbmcgc3Vic2lkeQogICAgICByZXR1cm4gaGFsdmluZ1N1YnNpZHkoX2hhbHZpbmcpOwogICAgfSBlbHNlIHsKICAgICAgLy8gT3RoZXJ3aXNlIHJldHVybiB0aGUgcmVtYWluaW5nIGhhbHZpbmcgc3Vic2lkeQogICAgICBoYWx2aW5nc1N1YnNpZGllc1tfaGFsdmluZ10udmFsdWU7CiAgICB9CiAgfQp9'.
	

]
