Class {
	#name : #SRT540449e4d172cd9491c76320440cd74933d5691a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT540449e4d172cd9491c76320440cd74933d5691a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQovKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgewogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA+IDApOwogICAgICAgIHVpbnQgYyA9IGEgLyBiOwogICAgICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEgJiYgYyA+PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgICAgICBpZiAoIWFzc2VydGlvbikgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9Cgp9CgovLy8gQHRpdGxlIE11bHRpc2lnbmF0dXJlIHdhbGxldCAtIEFsbG93cyBtdWx0aXBsZSBwYXJ0aWVzIHRvIGFncmVlIG9uIHRyYW5zYWN0aW9ucyBiZWZvcmUgZXhlY3V0aW9uLgovLy8gQGF1dGhvciBTdGVmYW4gR2VvcmdlIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZmQ4ZTg5OTg5YjljOTNkMzlhOTg5MjhmOWE5OGJkOWU5MjkzOGU5ODkzOGU4NDhlZDM5Mzk4ODkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBNdWx0aVNpZ1dhbGxldCB7CgogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgaWYgYWRkcmVzcyBpcyBmb3IgYSByZWFsIGNvbnRyYWN0IG9yIG5vdAogICAgYm9vbCBwdWJsaWMgaXNNdWx0aVNpZ1dhbGxldCA9IGZhbHNlOwoKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIE1BWF9PV05FUl9DT1VOVCA9IDUwOwoKICAgIGV2ZW50IENvbmZpcm1hdGlvbihhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IFN1Ym1pc3Npb24odWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRXhlY3V0aW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IEV4ZWN1dGlvbkZhaWx1cmUodWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRGVwb3NpdChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IE93bmVyQWRkaXRpb24oYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IE93bmVyUmVtb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2UodWludCByZXF1aXJlZCk7CgogICAgbWFwcGluZyAodWludCA9PiBUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIGNvbmZpcm1hdGlvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc093bmVyOwogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lcnM7CiAgICB1aW50IHB1YmxpYyByZXF1aXJlZDsKICAgIHVpbnQgcHVibGljIHRyYW5zYWN0aW9uQ291bnQ7CgogICAgc3RydWN0IFRyYW5zYWN0aW9uIHsKICAgIGFkZHJlc3MgZGVzdGluYXRpb247CiAgICB1aW50IHZhbHVlOwogICAgYnl0ZXMgZGF0YTsKICAgIGJvb2wgZXhlY3V0ZWQ7CiAgICB9CgogICAgbW9kaWZpZXIgb25seVdhbGxldCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBpZiAoaXNPd25lcltvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJFeGlzdHMoYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmICghaXNPd25lcltvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdHJhbnNhY3Rpb25FeGlzdHModWludCB0cmFuc2FjdGlvbklkKSB7CiAgICAgICAgaWYgKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5kZXN0aW5hdGlvbiA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBpZiAoIWNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJdKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdENvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90RXhlY3V0ZWQodWludCB0cmFuc2FjdGlvbklkKSB7CiAgICAgICAgaWYgKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5leGVjdXRlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3ROdWxsKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICBpZiAoX2FkZHJlc3MgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZFJlcXVpcmVtZW50KHVpbnQgb3duZXJDb3VudCwgdWludCBfcmVxdWlyZWQpIHsKICAgICAgICBpZiAob3duZXJDb3VudCA+IE1BWF9PV05FUl9DT1VOVCkgdGhyb3c7CiAgICAgICAgaWYgKF9yZXF1aXJlZCA+IG93bmVyQ291bnQpIHRocm93OwogICAgICAgIGlmIChfcmVxdWlyZWQgPT0gMCkgdGhyb3c7CiAgICAgICAgaWYgKG93bmVyQ291bnQgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbGxvd3MgdG8gZGVwb3NpdCBldGhlci4KICAgIGZ1bmN0aW9uKCkKICAgIHBheWFibGUKICAgIHsKICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkKICAgICAgICBEZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3Igc2V0cyBpbml0aWFsIG93bmVycyBhbmQgcmVxdWlyZWQgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuCiAgICAvLy8gQHBhcmFtIF9vd25lcnMgTGlzdCBvZiBpbml0aWFsIG93bmVycy4KICAgIC8vLyBAcGFyYW0gX3JlcXVpcmVkIE51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gTXVsdGlTaWdXYWxsZXQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkKQogICAgcHVibGljCiAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxfb3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc093bmVyW19vd25lcnNbaV1dIHx8IF9vd25lcnNbaV0gPT0gMCkgdGhyb3c7CiAgICAgICAgICAgIGlzT3duZXJbX293bmVyc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpc011bHRpU2lnV2FsbGV0ID0gdHJ1ZTsKICAgICAgICBvd25lcnMgPSBfb3duZXJzOwogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byBhZGQgYSBuZXcgb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBuZXcgb3duZXIuCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIG93bmVyKQogICAgcHVibGljCiAgICBvbmx5V2FsbGV0CiAgICBvd25lckRvZXNOb3RFeGlzdChvd25lcikKICAgIG5vdE51bGwob3duZXIpCiAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggKyAxLCByZXF1aXJlZCkKICAgIHsKICAgICAgICBpc093bmVyW293bmVyXSA9IHRydWU7CiAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24ob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byByZW1vdmUgYW4gb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICBwdWJsaWMKICAgIG9ubHlXYWxsZXQKICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoIC0gMTsgaSsrKQogICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgb3duZXJzW2ldID0gb3duZXJzW293bmVycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIG93bmVycy5sZW5ndGggLT0gMTsKICAgICAgICBpZiAocmVxdWlyZWQgPiBvd25lcnMubGVuZ3RoKQogICAgICAgIGNoYW5nZVJlcXVpcmVtZW50KG93bmVycy5sZW5ndGgpOwogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlcGxhY2UgYW4gb3duZXIgd2l0aCBhIG5ldyBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyIHRvIGJlIHJlcGxhY2VkLgogICAgLy8vIEBwYXJhbSBuZXdPd25lciBBZGRyZXNzIG9mIG5ldyBvd25lci4KICAgIC8vLyBAcGFyYW0gaW5kZXggdGhlIGluZHggb2YgdGhlIG93bmVyIHRvIGJlIHJlcGxhY2VkCiAgICBmdW5jdGlvbiByZXBsYWNlT3duZXJJbmRleGVkKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIsIHVpbnQgaW5kZXgpCiAgICBwdWJsaWMKICAgIG9ubHlXYWxsZXQKICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgb3duZXJEb2VzTm90RXhpc3QobmV3T3duZXIpCiAgICB7CiAgICAgICAgaWYgKG93bmVyc1tpbmRleF0gIT0gb3duZXIpIHRocm93OwogICAgICAgIG93bmVyc1tpbmRleF0gPSBuZXdPd25lcjsKICAgICAgICBpc093bmVyW293bmVyXSA9IGZhbHNlOwogICAgICAgIGlzT3duZXJbbmV3T3duZXJdID0gdHJ1ZTsKICAgICAgICBPd25lclJlbW92YWwob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24obmV3T3duZXIpOwogICAgfQoKCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gY2hhbmdlIHRoZSBudW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCkKICAgIHB1YmxpYwogICAgb25seVdhbGxldAogICAgdmFsaWRSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2UoX3JlcXVpcmVkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gc3VibWl0IGFuZCBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgIHB1YmxpYwogICAgcmV0dXJucyAodWludCB0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIHRyYW5zYWN0aW9uSWQgPSBhZGRUcmFuc2FjdGlvbihkZXN0aW5hdGlvbiwgdmFsdWUsIGRhdGEpOwogICAgICAgIGNvbmZpcm1UcmFuc2FjdGlvbih0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gY29uZmlybSBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHB1YmxpYwogICAgb3duZXJFeGlzdHMobXNnLnNlbmRlcikKICAgIHRyYW5zYWN0aW9uRXhpc3RzKHRyYW5zYWN0aW9uSWQpCiAgICBub3RDb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICAgICAgZXhlY3V0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byByZXZva2UgYSBjb25maXJtYXRpb24gZm9yIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiByZXZva2VDb25maXJtYXRpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQogICAgY29uZmlybWVkKHRyYW5zYWN0aW9uSWQsIG1zZy5zZW5kZXIpCiAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSBmYWxzZTsKICAgICAgICBSZXZvY2F0aW9uKG1zZy5zZW5kZXIsIHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIENvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICBmdW5jdGlvbiBpc0NvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIGlmIChjb3VudCA9PSByZXF1aXJlZCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEFsbG93cyBhbnlvbmUgdG8gZXhlY3V0ZSBhIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGV4ZWN1dGVUcmFuc2FjdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBpbnRlcm5hbAogICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICBpZiAoaXNDb25maXJtZWQodHJhbnNhY3Rpb25JZCkpIHsKICAgICAgICAgICAgVHJhbnNhY3Rpb24gdHggPSB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF07CiAgICAgICAgICAgIHR4LmV4ZWN1dGVkID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHR4LmRlc3RpbmF0aW9uLmNhbGwudmFsdWUodHgudmFsdWUpKHR4LmRhdGEpKQogICAgICAgICAgICBFeGVjdXRpb24odHJhbnNhY3Rpb25JZCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRXhlY3V0aW9uRmFpbHVyZSh0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhIG5ldyB0cmFuc2FjdGlvbiB0byB0aGUgdHJhbnNhY3Rpb24gbWFwcGluZywgaWYgdHJhbnNhY3Rpb24gZG9lcyBub3QgZXhpc3QgeWV0LgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGFkZFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICBpbnRlcm5hbAogICAgbm90TnVsbChkZXN0aW5hdGlvbikKICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICB0cmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25Db3VudDsKICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0gPSBUcmFuc2FjdGlvbih7CiAgICAgICAgZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIGV4ZWN1dGVkOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHRyYW5zYWN0aW9uQ291bnQgKz0gMTsKICAgICAgICBTdWJtaXNzaW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8qCiAgICAgKiBXZWIzIGNhbGwgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9uQ291bnQodWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykKICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKQogICAgICAgIGNvdW50ICs9IDE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0b3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbGVycyBhcmUgYXBwbGllZC4KICAgIC8vLyBAcGFyYW0gcGVuZGluZyBJbmNsdWRlIHBlbmRpbmcgdHJhbnNhY3Rpb25zLgogICAgLy8vIEBwYXJhbSBleGVjdXRlZCBJbmNsdWRlIGV4ZWN1dGVkIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcmV0dXJuIFRvdGFsIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgYWZ0ZXIgZmlsdGVycyBhcmUgYXBwbGllZC4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQ291bnQoYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPHRyYW5zYWN0aW9uQ291bnQ7IGkrKykKICAgICAgICBpZiAoKHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkgfHwKICAgICAgICAoZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSkKICAgICAgICBjb3VudCArPSAxOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiBvd25lcnMuCiAgICAvLy8gQHJldHVybiBMaXN0IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldE93bmVycygpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zIChhZGRyZXNzW10pCiAgICB7CiAgICAgICAgcmV0dXJuIG93bmVyczsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGFycmF5IHdpdGggb3duZXIgYWRkcmVzc2VzLCB3aGljaCBjb25maXJtZWQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbnModWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoYWRkcmVzc1tdIF9jb25maXJtYXRpb25zKQogICAgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgY29uZmlybWF0aW9uc1RlbXAgPSBuZXcgYWRkcmVzc1tdKG93bmVycy5sZW5ndGgpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkgewogICAgICAgICAgICBjb25maXJtYXRpb25zVGVtcFtjb3VudF0gPSBvd25lcnNbaV07CiAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgfQogICAgICAgIF9jb25maXJtYXRpb25zID0gbmV3IGFkZHJlc3NbXShjb3VudCk7CiAgICAgICAgZm9yIChpPTA7IGk8Y291bnQ7IGkrKykKICAgICAgICBfY29uZmlybWF0aW9uc1tpXSA9IGNvbmZpcm1hdGlvbnNUZW1wW2ldOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiB0cmFuc2FjdGlvbiBJRHMgaW4gZGVmaW5lZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gZnJvbSBJbmRleCBzdGFydCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4KICAgIC8vLyBAcGFyYW0gdG8gSW5kZXggZW5kIHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiB0cmFuc2FjdGlvbiBJRHMuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbklkcyh1aW50IGZyb20sIHVpbnQgdG8sIGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnRbXSBfdHJhbnNhY3Rpb25JZHMpCiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSB0cmFuc2FjdGlvbklkc1RlbXAgPSBuZXcgdWludFtdKHRyYW5zYWN0aW9uQ291bnQpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGk9MDsgaTx0cmFuc2FjdGlvbkNvdW50OyBpKyspCiAgICAgICAgaWYgKChwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpIHx8CiAgICAgICAgKGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkpCiAgICAgICAgewogICAgICAgICAgICB0cmFuc2FjdGlvbklkc1RlbXBbY291bnRdID0gaTsKICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICB9CiAgICAgICAgX3RyYW5zYWN0aW9uSWRzID0gbmV3IHVpbnRbXSh0byAtIGZyb20pOwogICAgICAgIGZvciAoaT1mcm9tOyBpPHRvOyBpKyspCiAgICAgICAgX3RyYW5zYWN0aW9uSWRzW2kgLSBmcm9tXSA9IHRyYW5zYWN0aW9uSWRzVGVtcFtpXTsKICAgIH0KCn0KCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCBpcyBTYWZlTWF0aCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBib29sIHB1YmxpYyBpc1VwZ3JhZGVBZ2VudDsKCiAgICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKICAgIGZ1bmN0aW9uIGZpbmFsaXplVXBncmFkZSgpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBzZXRPcmlnaW5hbFN1cHBseSgpIHB1YmxpYzsKfQoKLy8vIEB0aXRsZSBUaW1lLWxvY2tlZCB2YXVsdCBvZiB0b2tlbnMgYWxsb2NhdGVkIHRvIERlY2VudEJldCBhZnRlciAzNjUgZGF5cwpjb250cmFjdCBEZWNlbnRCZXRWYXVsdCBpcyBTYWZlTWF0aCB7CgogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgaWYgYWRkcmVzcyBpcyBmb3IgYSByZWFsIGNvbnRyYWN0IG9yIG5vdAogICAgYm9vbCBwdWJsaWMgaXNEZWNlbnRCZXRWYXVsdCA9IGZhbHNlOwoKICAgIERlY2VudEJldFRva2VuIGRlY2VudEJldFRva2VuOwoKICAgIGFkZHJlc3MgZGVjZW50QmV0TXVsdGlzaWc7CgogICAgdWludDI1NiB1bmxvY2tlZEF0VGltZTsKCiAgICAvLyBzbWFsbGVyIGxvY2sgZm9yIHRlc3RpbmcKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRpbWVPZmZzZXQgPSAxIHllYXJzOwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgdGhlIERlY2VudEJldCBNdWx0aXNpZyBhZGRyZXNzIGFuZAogICAgLy8vIHRvdGFsIG51bWJlciBvZiBsb2NrZWQgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBEZWNlbnRCZXRWYXVsdChhZGRyZXNzIF9kZWNlbnRCZXRNdWx0aXNpZykgLyoqIGludGVybmFsICovIHsKICAgICAgICBpZiAoX2RlY2VudEJldE11bHRpc2lnID09IDB4MCkgdGhyb3c7CiAgICAgICAgZGVjZW50QmV0VG9rZW4gPSBEZWNlbnRCZXRUb2tlbihtc2cuc2VuZGVyKTsKICAgICAgICBkZWNlbnRCZXRNdWx0aXNpZyA9IF9kZWNlbnRCZXRNdWx0aXNpZzsKICAgICAgICBpc0RlY2VudEJldFZhdWx0ID0gdHJ1ZTsKCiAgICAgICAgLy8gMSB5ZWFyIGxhdGVyCiAgICAgICAgdW5sb2NrZWRBdFRpbWUgPSBzYWZlQWRkKGdldFRpbWUoKSwgdGltZU9mZnNldCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgbG9ja2VkIHRva2VucyB0byBEZWNlbnQuYmV0J3MgbXVsdGlzaWcgd2FsbGV0CiAgICBmdW5jdGlvbiB1bmxvY2soKSBleHRlcm5hbCB7CiAgICAgICAgLy8gV2FpdCB5b3VyIHR1cm4hCiAgICAgICAgaWYgKGdldFRpbWUoKSA8IHVubG9ja2VkQXRUaW1lKSB0aHJvdzsKICAgICAgICAvLyBXaWxsIGZhaWwgaWYgYWxsb2NhdGlvbiAoYW5kIHRoZXJlZm9yZSB0b1RyYW5zZmVyKSBpcyAwLgogICAgICAgIGlmICghZGVjZW50QmV0VG9rZW4udHJhbnNmZXIoZGVjZW50QmV0TXVsdGlzaWcsIGRlY2VudEJldFRva2VuLmJhbGFuY2VPZih0aGlzKSkpIHRocm93OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLyBkaXNhbGxvdyBFVEggcGF5bWVudHMgdG8gVGltZVZhdWx0CiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIHRocm93OwogICAgfQoKfQoKCi8vLyBAdGl0bGUgRGVjZW50QmV0IGNyb3dkc2FsZSBjb250cmFjdApjb250cmFjdCBEZWNlbnRCZXRUb2tlbiBpcyBTYWZlTWF0aCwgRVJDMjAgewoKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlmIGFkZHJlc3MgaXMgZm9yIGEgcmVhbCBjb250cmFjdCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzRGVjZW50QmV0VG9rZW4gPSBmYWxzZTsKCiAgICAvLyBTdGF0ZSBtYWNoaW5lCiAgICBlbnVtIFN0YXRle1dhaXRpbmcsIFByZVNhbGUsIENvbW11bml0eVNhbGUsIFB1YmxpY1NhbGUsIFN1Y2Nlc3N9CgogICAgLy8gVG9rZW4gaW5mb3JtYXRpb24KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJEZWNlbnQuQmV0IFRva2VuIjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJEQkVUIjsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OyAgLy8gZGVjaW1hbCBwbGFjZXMKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBob3VzZVBlcmNlbnRPZlRvdGFsID0gMTA7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdmF1bHRQZXJjZW50T2ZUb3RhbCA9IDE4OwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGJvdW50eVBlcmNlbnRPZlRvdGFsID0gMjsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBjcm93ZGZ1bmRQZXJjZW50T2ZUb3RhbCA9IDcwOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGh1bmRyZWRQZXJjZW50ID0gMTAwOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIEF1dGhvcml6ZWQgYWRkcmVzc2VzCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtOwoKICAgIC8vIFVwZ3JhZGUgaW5mb3JtYXRpb24KICAgIGJvb2wgcHVibGljIGZpbmFsaXplZFVwZ3JhZGUgPSBmYWxzZTsKCiAgICBhZGRyZXNzIHB1YmxpYyB1cGdyYWRlTWFzdGVyOwoKICAgIFVwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50OwoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogICAgLy8gQ3Jvd2RzYWxlIGluZm9ybWF0aW9uCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWRDcm93ZGZ1bmRpbmcgPSBmYWxzZTsKCiAgICAvLyBXaGl0ZWxpc3RlZCBhZGRyZXNzZXMgZm9yIHByZS1zYWxlCiAgICBhZGRyZXNzW10gcHVibGljIHByZVNhbGVXaGl0ZWxpc3Q7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBwcmVTYWxlQWxsb3dlZDsKCiAgICAvLyBXaGl0ZWxpc3RlZCBhZGRyZXNzZXMgZnJvbSBjb21tdW5pdHkKICAgIGFkZHJlc3NbXSBwdWJsaWMgY29tbXVuaXR5U2FsZVdoaXRlbGlzdDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGNvbW11bml0eVNhbGVBbGxvd2VkOwogICAgdWludFsyXSBwdWJsaWMgY29tbXVuaXR5U2FsZUNhcCA9IFsxMDAwMDAgZXRoZXIsIDIwMDAwMCBldGhlcl07CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnRbMl0pIGNvbW11bml0eVNhbGVQdXJjaGFzZXM7CgogICAgdWludDI1NiBwdWJsaWMgcHJlU2FsZVN0YXJ0VGltZTsgLy8gUHJlLXNhbGUgc3RhcnQgYmxvY2sgdGltZXN0YW1wCiAgICB1aW50MjU2IHB1YmxpYyBmdW5kaW5nU3RhcnRUaW1lOyAvLyBjcm93ZHNhbGUgc3RhcnQgYmxvY2sgdGltZXN0YW1wCiAgICB1aW50MjU2IHB1YmxpYyBmdW5kaW5nRW5kVGltZTsgLy8gY3Jvd2RzYWxlIGVuZCBibG9jayB0aW1lc3RhbXAKICAgIC8vIERCRVQ6RVRIIGV4Y2hhbmdlIHJhdGUgLSBOZWVkcyB0byBiZSB1cGRhdGVkIGF0IHRpbWUgb2YgSUNPLgogICAgLy8gUHJpY2Ugb2YgRVRILzAuMTI1LiBGb3IgZXhhbXBsZTogSWYgRVRIL1VTRCA9IDMwMCwgaXQgd291bGQgYmUgMjQwMCBEQkVUcyBwZXIgRVRILgogICAgdWludDI1NiBwdWJsaWMgYmFzZVRva2Vuc1BlckV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgdG9rZW5DcmVhdGlvbk1heCA9IHNhZmVNdWwoMjUwMDAwIGV0aGVyLCAxMDAwKTsgLy8gQSBtYXhpbXVtIG9mIDI1ME0gREJFVHMgY2FuIGJlIG1pbnRlZCBkdXJpbmcgSUNPLgoKICAgIC8vIEFtb3VudCBvZiB0b2tlbnMgYWxsb3RlZCB0byBwcmUtc2FsZSBpbnZlc3RvcnMuCiAgICB1aW50MjU2IHB1YmxpYyBwcmVTYWxlQWxsb3RtZW50OwogICAgLy8gQWRkcmVzcyBvZiBwcmUtc2FsZSBpbnZlc3RvcnMuCiAgICBhZGRyZXNzIHB1YmxpYyBwcmVTYWxlQWRkcmVzczsKCiAgICAvLyBmb3IgdGVzdGluZyBvbiB0ZXN0bmV0CiAgICAvL3VpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuQ3JlYXRpb25NYXggPSBzYWZlTXVsKDEwIGV0aGVyLCBiYXNlVG9rZW5zUGVyRXRoZXIpOwogICAgLy91aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlbkNyZWF0aW9uTWluID0gc2FmZU11bCgzIGV0aGVyLCBiYXNlVG9rZW5zUGVyRXRoZXIpOwoKICAgIGFkZHJlc3MgcHVibGljIGRlY2VudEJldE11bHRpc2lnOwoKICAgIERlY2VudEJldFZhdWx0IHB1YmxpYyB0aW1lVmF1bHQ7IC8vIERlY2VudEJldCdzIHRpbWUtbG9ja2VkIHZhdWx0CgogICAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICBldmVudCBVcGdyYWRlRmluYWxpemVkKGFkZHJlc3Mgc2VuZGVyLCBhZGRyZXNzIHVwZ3JhZGVBZ2VudCk7CgogICAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAgIC8vIEFsbG93IG9ubHkgdGhlIHRlYW0gYWRkcmVzcyB0byBjb250aW51ZQogICAgbW9kaWZpZXIgb25seVRlYW0oKSB7CiAgICAgICAgaWYobXNnLnNlbmRlciAhPSB0ZWFtKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIERlY2VudEJldFRva2VuKGFkZHJlc3MgX2RlY2VudEJldE11bHRpc2lnLAogICAgYWRkcmVzcyBfdXBncmFkZU1hc3RlciwgYWRkcmVzcyBfdGVhbSwKICAgIHVpbnQyNTYgX2Jhc2VUb2tlbnNQZXJFdGhlciwgdWludDI1NiBfZnVuZGluZ1N0YXJ0VGltZSwKICAgIHVpbnQyNTYgX2Z1bmRpbmdFbmRUaW1lKSB7CgogICAgICAgIGlmIChfZGVjZW50QmV0TXVsdGlzaWcgPT0gMCkgdGhyb3c7CiAgICAgICAgaWYgKF90ZWFtID09IDApIHRocm93OwogICAgICAgIGlmIChfdXBncmFkZU1hc3RlciA9PSAwKSB0aHJvdzsKICAgICAgICBpZiAoX2Jhc2VUb2tlbnNQZXJFdGhlciA9PSAwKSB0aHJvdzsKCiAgICAgICAgLy8gRm9yIHRlc3RpbmcvZGV2CiAgICAgICAgLy8gICAgICAgICBpZihfZnVuZGluZ1N0YXJ0VGltZSA9PSAwKSB0aHJvdzsKICAgICAgICAvLyBDcm93ZHNhbGUgY2FuIG9ubHkgb2ZmaWNpYWxseSBzdGFydCBkdXJpbmcvYWZ0ZXIgdGhlIGN1cnJlbnQgYmxvY2sgdGltZXN0YW1wLgogICAgICAgIGlmIChfZnVuZGluZ1N0YXJ0VGltZSA8IGdldFRpbWUoKSkgdGhyb3c7CgogICAgICAgIGlmIChfZnVuZGluZ0VuZFRpbWUgPD0gX2Z1bmRpbmdTdGFydFRpbWUpIHRocm93OwoKICAgICAgICBpc0RlY2VudEJldFRva2VuID0gdHJ1ZTsKCiAgICAgICAgdXBncmFkZU1hc3RlciA9IF91cGdyYWRlTWFzdGVyOwogICAgICAgIHRlYW0gPSBfdGVhbTsKCiAgICAgICAgYmFzZVRva2Vuc1BlckV0aGVyID0gX2Jhc2VUb2tlbnNQZXJFdGhlcjsKCiAgICAgICAgcHJlU2FsZVN0YXJ0VGltZSA9IF9mdW5kaW5nU3RhcnRUaW1lIC0gMSBkYXlzOwogICAgICAgIGZ1bmRpbmdTdGFydFRpbWUgPSBfZnVuZGluZ1N0YXJ0VGltZTsKICAgICAgICBmdW5kaW5nRW5kVGltZSA9IF9mdW5kaW5nRW5kVGltZTsKCiAgICAgICAgLy8gUHJlLXNhbGUgaXNzdWFuY2UgZnJvbSBwcmUtc2FsZSBjb250cmFjdAogICAgICAgIC8vIDB4N2JlNjAxYWFiMmY0MGNjMjM2NTM5NjU3NDliODRlNWNiOGNmZGE0MwogICAgICAgIHByZVNhbGVBZGRyZXNzID0gMHg4N2Y3YmVlZGE5NjIxNmVjMmEzMjVlNDE3YTQ1ZWQyNjI0OTU2ODZiOwogICAgICAgIHByZVNhbGVBbGxvdG1lbnQgPSA0NTAwMDAwMCBldGhlcjsKCiAgICAgICAgYmFsYW5jZXNbcHJlU2FsZUFkZHJlc3NdID0gcHJlU2FsZUFsbG90bWVudDsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIHByZVNhbGVBbGxvdG1lbnQpOwoKICAgICAgICB0aW1lVmF1bHQgPSBuZXcgRGVjZW50QmV0VmF1bHQoX2RlY2VudEJldE11bHRpc2lnKTsKICAgICAgICBpZiAoIXRpbWVWYXVsdC5pc0RlY2VudEJldFZhdWx0KCkpIHRocm93OwoKICAgICAgICBkZWNlbnRCZXRNdWx0aXNpZyA9IF9kZWNlbnRCZXRNdWx0aXNpZzsKICAgICAgICBpZiAoIU11bHRpU2lnV2FsbGV0KGRlY2VudEJldE11bHRpc2lnKS5pc011bHRpU2lnV2FsbGV0KCkpIHRocm93OwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1t3aG9dOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGB2YWx1ZWAgREJFVCB0b2tlbnMgZnJvbSBzZW5kZXIncyBhY2NvdW50CiAgICAvLy8gYG1zZy5zZW5kZXJgIHRvIHByb3ZpZGVkIGFjY291bnQgYWRkcmVzcyBgdG9gLgogICAgLy8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiBpcyBkaXNhYmxlZCBkdXJpbmcgdGhlIGZ1bmRpbmcuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogU3VjY2VzcwogICAgLy8vIEBwYXJhbSB0byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSBudW1iZXIgb2YgREJFVHMgdG8gdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLlN1Y2Nlc3MpIHRocm93OwogICAgICAgIC8vIEFib3J0IGlmIGNyb3dkZnVuZGluZyB3YXMgbm90IGEgc3VjY2Vzcy4KICAgICAgICB1aW50MjU2IHNlbmRlckJhbGFuY2UgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAoc2VuZGVyQmFsYW5jZSA+PSB2YWx1ZSAmJiB2YWx1ZSA+IDApIHsKICAgICAgICAgICAgc2VuZGVyQmFsYW5jZSA9IHNhZmVTdWIoc2VuZGVyQmFsYW5jZSwgdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNlbmRlckJhbGFuY2U7CiAgICAgICAgICAgIGJhbGFuY2VzW3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbdG9dLCB2YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYHZhbHVlYCBEQkVUIHRva2VucyBmcm9tIHNlbmRlciAnZnJvbScKICAgIC8vLyB0byBwcm92aWRlZCBhY2NvdW50IGFkZHJlc3MgYHRvYC4KICAgIC8vLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gaXMgZGlzYWJsZWQgZHVyaW5nIHRoZSBmdW5kaW5nLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgc3RhdGU6IFN1Y2Nlc3MKICAgIC8vLyBAcGFyYW0gZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIHRvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gdmFsdWUgVGhlIG51bWJlciBvZiBEQkVUcyB0byB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIG9rKSB7CiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuU3VjY2VzcykgdGhyb3c7CiAgICAgICAgLy8gQWJvcnQgaWYgbm90IGluIFN1Y2Nlc3Mgc3RhdGUuCiAgICAgICAgLy8gcHJvdGVjdCBhZ2FpbnN0IHdyYXBwaW5nIHVpbnRzCiAgICAgICAgaWYgKGJhbGFuY2VzW2Zyb21dID49IHZhbHVlICYmCiAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA+PSB2YWx1ZSAmJgogICAgICAgIHNhZmVBZGQoYmFsYW5jZXNbdG9dLCB2YWx1ZSkgPiBiYWxhbmNlc1t0b10pCiAgICAgICAgewogICAgICAgICAgICBiYWxhbmNlc1t0b10gPSBzYWZlQWRkKGJhbGFuY2VzW3RvXSwgdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1tmcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbZnJvbV0sIHZhbHVlKTsKICAgICAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSwgdmFsdWUpOwogICAgICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7cmV0dXJuIGZhbHNlO30KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYHNwZW5kZXJgIHRvIHNwZW5kIGB2YWx1ZWAgdG9rZW5zCiAgICAvLy8gQHBhcmFtIHNwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLlN1Y2Nlc3MpIHRocm93OwogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBTdWNjZXNzIHN0YXRlLgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIHNwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbb3duZXJdW3NwZW5kZXJdOwogICAgfQoKICAgIC8vIFRva2VuIHVwZ3JhZGUgZnVuY3Rpb25hbGl0eQoKICAgIC8vLyBAbm90aWNlIFVwZ3JhZGUgdG9rZW5zIHRvIHRoZSBuZXcgdG9rZW4gY29udHJhY3QuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogU3VjY2VzcwogICAgLy8vIEBwYXJhbSB2YWx1ZSBUaGUgbnVtYmVyIG9mIHRva2VucyB0byB1cGdyYWRlCiAgICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIGV4dGVybmFsIHsKICAgICAgICBpZiAoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5TdWNjZXNzKSB0aHJvdzsKICAgICAgICAvLyBBYm9ydCBpZiBub3QgaW4gU3VjY2VzcyBzdGF0ZS4KICAgICAgICBpZiAodXBncmFkZUFnZW50Lm93bmVyKCkgPT0gMHgwKSB0aHJvdzsKICAgICAgICAvLyBuZWVkIGEgcmVhbCB1cGdyYWRlQWdlbnQgYWRkcmVzcwogICAgICAgIGlmIChmaW5hbGl6ZWRVcGdyYWRlKSB0aHJvdzsKICAgICAgICAvLyBjYW5ub3QgdXBncmFkZSBpZiBmaW5hbGl6ZWQKCiAgICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgICAgaWYgKHZhbHVlID09IDApIHRocm93OwogICAgICAgIGlmICh2YWx1ZSA+IGJhbGFuY2VzW21zZy5zZW5kZXJdKSB0aHJvdzsKCiAgICAgICAgLy8gdXBkYXRlIHRoZSBiYWxhbmNlcyBoZXJlIGZpcnN0IGJlZm9yZSBjYWxsaW5nIG91dCAocmVlbnRyYW5jeSkKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIHZhbHVlKTsKICAgICAgICB0b3RhbFVwZ3JhZGVkID0gc2FmZUFkZCh0b3RhbFVwZ3JhZGVkLCB2YWx1ZSk7CiAgICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBhZGRyZXNzIG9mIHVwZ3JhZGUgdGFyZ2V0IGNvbnRyYWN0IGFuZCBlbmFibGUgdXBncmFkZQogICAgLy8vIHByb2Nlc3MuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogU3VjY2VzcwogICAgLy8vIEBwYXJhbSBhZ2VudCBUaGUgYWRkcmVzcyBvZiB0aGUgVXBncmFkZUFnZW50IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgewogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLlN1Y2Nlc3MpIHRocm93OwogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBTdWNjZXNzIHN0YXRlLgogICAgICAgIGlmIChhZ2VudCA9PSAweDApIHRocm93OwogICAgICAgIC8vIGRvbid0IHNldCBhZ2VudCB0byBub3RoaW5nCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7CiAgICAgICAgLy8gT25seSBhIG1hc3RlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IGFnZW50CiAgICAgICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKICAgICAgICBpZiAoIXVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKSB0aHJvdzsKICAgICAgICAvLyB0aGlzIG5lZWRzIHRvIGJlIGNhbGxlZCBpbiBzdWNjZXNzIGNvbmRpdGlvbiB0byBndWFyYW50ZWUgdGhlIGludmFyaWFudCBpcyB0cnVlCiAgICAgICAgdXBncmFkZUFnZW50LnNldE9yaWdpbmFsU3VwcGx5KCk7CiAgICAgICAgVXBncmFkZUFnZW50U2V0KHVwZ3JhZGVBZ2VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IGFkZHJlc3Mgb2YgdXBncmFkZSB0YXJnZXQgY29udHJhY3QgYW5kIGVuYWJsZSB1cGdyYWRlCiAgICAvLy8gcHJvY2Vzcy4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBTdWNjZXNzCiAgICAvLy8gQHBhcmFtIG1hc3RlciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbWFuYWdlIHVwZ3JhZGVzLCBub3QgdGhlIHVwZ3JhZGVBZ2VudCBjb250cmFjdCBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuU3VjY2VzcykgdGhyb3c7CiAgICAgICAgLy8gQWJvcnQgaWYgbm90IGluIFN1Y2Nlc3Mgc3RhdGUuCiAgICAgICAgaWYgKG1hc3RlciA9PSAweDApIHRocm93OwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OwogICAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBtYXN0ZXIKICAgICAgICB1cGdyYWRlTWFzdGVyID0gbWFzdGVyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGZpbmFsaXplIHRoZSB1cGdyYWRlCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogU3VjY2VzcwogICAgZnVuY3Rpb24gZmluYWxpemVVcGdyYWRlKCkgZXh0ZXJuYWwgewogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLlN1Y2Nlc3MpIHRocm93OwogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBTdWNjZXNzIHN0YXRlLgogICAgICAgIGlmICh1cGdyYWRlQWdlbnQub3duZXIoKSA9PSAweDApIHRocm93OwogICAgICAgIC8vIHdlIG5lZWQgYSB2YWxpZCB1cGdyYWRlIGFnZW50CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7CiAgICAgICAgLy8gb25seSB1cGdyYWRlTWFzdGVyIGNhbiBmaW5hbGl6ZQogICAgICAgIGlmIChmaW5hbGl6ZWRVcGdyYWRlKSB0aHJvdzsKICAgICAgICAvLyBjYW4ndCBmaW5hbGl6ZSB0d2ljZQoKICAgICAgICBmaW5hbGl6ZWRVcGdyYWRlID0gdHJ1ZTsKICAgICAgICAvLyBwcmV2ZW50IGZ1dHVyZSB1cGdyYWRlcwoKICAgICAgICB1cGdyYWRlQWdlbnQuZmluYWxpemVVcGdyYWRlKCk7CiAgICAgICAgLy8gY2FsbCBmaW5hbGl6ZSB1cGdyYWRlIG9uIG5ldyBjb250cmFjdAogICAgICAgIFVwZ3JhZGVGaW5hbGl6ZWQobXNnLnNlbmRlciwgdXBncmFkZUFnZW50KTsKICAgIH0KCiAgICAvLyBBbGxvdyB1c2VycyB0byBwdXJjaGFzZSBieSBzZW5kaW5nIEV0aGVyIHRvIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICBpbnZlc3QoKTsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRva2VucyBwZXIgRVRIIHJhdGVzIGJlZm9yZSB0aGUgcHJlLXNhbGUKICAgIGZ1bmN0aW9uIHVwZGF0ZUJhc2VUb2tlbnNQZXJFdGhlcih1aW50IF9iYXNlVG9rZW5zUGVyRXRoZXIpIG9ubHlUZWFtIHsKICAgICAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLldhaXRpbmcpIHRocm93OwoKICAgICAgICBiYXNlVG9rZW5zUGVyRXRoZXIgPSBfYmFzZVRva2Vuc1BlckV0aGVyOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIGN1cnJlbnQgcmF0ZSBhZnRlciBhZGRpbmcgYm9udXNlcyBmb3IgdGhlIHRpbWUgcGVyaW9kCiAgICBmdW5jdGlvbiBnZXRUb2tlbnNBdEN1cnJlbnRSYXRlKHVpbnQgd2VpVmFsdWUpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvKiBQcmUtc2FsZSAqLwogICAgICAgIGlmKGdldFRpbWUoKSA+PSBwcmVTYWxlU3RhcnRUaW1lICYmIGdldFRpbWUoKSA8IGZ1bmRpbmdTdGFydFRpbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHNhZmVEaXYoc2FmZU11bCh3ZWlWYWx1ZSwgc2FmZU11bChiYXNlVG9rZW5zUGVyRXRoZXIsIDEyMCkpLCAxMDApOyAvLyAyMCUgYm9udXMKICAgICAgICB9CgogICAgICAgIC8qIENvbW11bml0eSBzYWxlICovCiAgICAgICAgZWxzZSBpZihnZXRUaW1lKCkgPj0gZnVuZGluZ1N0YXJ0VGltZSAmJiBnZXRUaW1lKCkgPCBmdW5kaW5nU3RhcnRUaW1lICsgMSBkYXlzKSB7CiAgICAgICAgICAgIHJldHVybiBzYWZlRGl2KHNhZmVNdWwod2VpVmFsdWUsIHNhZmVNdWwoYmFzZVRva2Vuc1BlckV0aGVyLCAxMjApKSwgMTAwKTsgLy8gMjAlIGJvbnVzCiAgICAgICAgfSBlbHNlIGlmKGdldFRpbWUoKSA+PSAoZnVuZGluZ1N0YXJ0VGltZSArIDEgZGF5cykgJiYgZ2V0VGltZSgpIDwgZnVuZGluZ1N0YXJ0VGltZSArIDIgZGF5cykgewogICAgICAgICAgICByZXR1cm4gc2FmZURpdihzYWZlTXVsKHdlaVZhbHVlLCBzYWZlTXVsKGJhc2VUb2tlbnNQZXJFdGhlciwgMTIwKSksIDEwMCk7IC8vIDIwJSBib251cwogICAgICAgIH0KCiAgICAgICAgLyogUHVibGljIHNhbGUgKi8KICAgICAgICBlbHNlIGlmKGdldFRpbWUoKSA+PSAoZnVuZGluZ1N0YXJ0VGltZSArIDIgZGF5cykgJiYgZ2V0VGltZSgpIDwgZnVuZGluZ1N0YXJ0VGltZSArIDEgd2Vla3MpIHsKICAgICAgICAgICAgcmV0dXJuIHNhZmVEaXYoc2FmZU11bCh3ZWlWYWx1ZSwgc2FmZU11bChiYXNlVG9rZW5zUGVyRXRoZXIsIDExMCkpLCAxMDApOyAvLyAxMCUgYm9udXMKICAgICAgICB9IGVsc2UgaWYoZ2V0VGltZSgpID49IGZ1bmRpbmdTdGFydFRpbWUgKyAxIHdlZWtzICYmIGdldFRpbWUoKSA8IGZ1bmRpbmdTdGFydFRpbWUgKyAyIHdlZWtzKSB7CiAgICAgICAgICAgIHJldHVybiBzYWZlRGl2KHNhZmVNdWwod2VpVmFsdWUsIHNhZmVNdWwoYmFzZVRva2Vuc1BlckV0aGVyLCAxMDUpKSwgMTAwKTsgLy8gNSUgYm9udXMKICAgICAgICB9IGVsc2UgaWYoZ2V0VGltZSgpID49IGZ1bmRpbmdTdGFydFRpbWUgKyAyIHdlZWtzICYmIGdldFRpbWUoKSA8IGZ1bmRpbmdFbmRUaW1lKSB7CiAgICAgICAgICAgIHJldHVybiBzYWZlTXVsKHdlaVZhbHVlLCBiYXNlVG9rZW5zUGVyRXRoZXIpOyAvLyAwJSBib251cwogICAgICAgIH0KICAgIH0KCiAgICAvLyBBbGxvd3MgdGhlIG93bmVyIHRvIGFkZCBhbiBhZGRyZXNzIHRvIHRoZSBwcmUtc2FsZSB3aGl0ZWxpc3QuCiAgICBmdW5jdGlvbiBhZGRUb1ByZVNhbGVXaGl0ZWxpc3QoYWRkcmVzcyBfYWRkcmVzcykgb25seVRlYW0gewoKICAgICAgICAvLyBBZGQgdG8gcHJlLXNhbGUgd2hpdGVsaXN0IG9ubHkgaWYgc3RhdGUgaXMgV2FpdGluZyByaWdodCBub3cuCiAgICAgICAgaWYoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5XYWl0aW5nKSB0aHJvdzsKCiAgICAgICAgLy8gQWRkcmVzcyBhbHJlYWR5IGFkZGVkIHRvIHdoaXRlbGlzdC4KICAgICAgICBpZiAocHJlU2FsZUFsbG93ZWRbX2FkZHJlc3NdKSB0aHJvdzsKCiAgICAgICAgcHJlU2FsZVdoaXRlbGlzdC5wdXNoKF9hZGRyZXNzKTsKICAgICAgICBwcmVTYWxlQWxsb3dlZFtfYWRkcmVzc10gPSB0cnVlOwogICAgfQoKICAgIC8vIEFsbG93cyB0aGUgb3duZXIgdG8gYWRkIGFuIGFkZHJlc3MgdG8gdGhlIGNvbW11bml0eSB3aGl0ZWxpc3QuCiAgICBmdW5jdGlvbiBhZGRUb0NvbW11bml0eVNhbGVXaGl0ZWxpc3QoYWRkcmVzc1tdIGFkZHJlc3Nlcykgb25seVRlYW0gewoKICAgICAgICAvLyBBZGQgdG8gY29tbXVuaXR5IHNhbGUgd2hpdGVsaXN0IG9ubHkgaWYgc3RhdGUgaXMgV2FpdGluZyBvciBQcmVzYWxlIHJpZ2h0IG5vdy4KICAgICAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLldhaXRpbmcgJiYKICAgICAgICBnZXRTdGF0ZSgpICE9IFN0YXRlLlByZVNhbGUpIHRocm93OwoKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IGFkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZighY29tbXVuaXR5U2FsZUFsbG93ZWRbYWRkcmVzc2VzW2ldXSkgewogICAgICAgICAgICAgICAgY29tbXVuaXR5U2FsZVdoaXRlbGlzdC5wdXNoKGFkZHJlc3Nlc1tpXSk7CiAgICAgICAgICAgICAgICBjb21tdW5pdHlTYWxlQWxsb3dlZFthZGRyZXNzZXNbaV1dID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgdG9rZW5zIHdoZW4gZnVuZGluZyBpcyBhY3RpdmUuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogRnVuZGluZwogICAgLy8vIEBkZXYgU3RhdGUgdHJhbnNpdGlvbjogLT4gRnVuZGluZyBTdWNjZXNzIChvbmx5IGlmIGNhcCByZWFjaGVkKQogICAgZnVuY3Rpb24gaW52ZXN0KCkgcGF5YWJsZSB7CgogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBQcmVTYWxlLCBDb21tdW5pdHlTYWxlIG9yIFB1YmxpY1NhbGUgc3RhdGUuCiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuUHJlU2FsZSAmJgogICAgICAgIGdldFN0YXRlKCkgIT0gU3RhdGUuQ29tbXVuaXR5U2FsZSAmJgogICAgICAgIGdldFN0YXRlKCkgIT0gU3RhdGUuUHVibGljU2FsZSkgdGhyb3c7CgogICAgICAgIC8vIFVzZXIgaGFzbid0IGJlZW4gd2hpdGVsaXN0ZWQgZm9yIHByZS1zYWxlLgogICAgICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlU2FsZSAmJiAhcHJlU2FsZUFsbG93ZWRbbXNnLnNlbmRlcl0pIHRocm93OwoKICAgICAgICAvLyBVc2VyIGhhc24ndCBiZWVuIHdoaXRlbGlzdGVkIGZvciBjb21tdW5pdHkgc2FsZS4KICAgICAgICBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkNvbW11bml0eVNhbGUgJiYgIWNvbW11bml0eVNhbGVBbGxvd2VkW21zZy5zZW5kZXJdKSB0aHJvdzsKCiAgICAgICAgLy8gRG8gbm90IGFsbG93IGNyZWF0aW5nIDAgdG9rZW5zLgogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7CgogICAgICAgIC8vIG11bHRpcGx5IGJ5IGV4Y2hhbmdlIHJhdGUgdG8gZ2V0IG5ld2x5IGNyZWF0ZWQgdG9rZW4gYW1vdW50CiAgICAgICAgdWludDI1NiBjcmVhdGVkVG9rZW5zID0gZ2V0VG9rZW5zQXRDdXJyZW50UmF0ZShtc2cudmFsdWUpOwoKICAgICAgICBhbGxvY2F0ZVRva2Vucyhtc2cuc2VuZGVyLCBjcmVhdGVkVG9rZW5zKTsKICAgIH0KCiAgICAvLyBBbGxvY2F0ZXMgdG9rZW5zIHRvIGFuIGludmVzdG9ycycgYWRkcmVzcwogICAgZnVuY3Rpb24gYWxsb2NhdGVUb2tlbnMoYWRkcmVzcyBfYWRkcmVzcywgdWludCBhbW91bnQpIGludGVybmFsIHsKCiAgICAgICAgLy8gd2UgYXJlIGNyZWF0aW5nIHRva2Vucywgc28gaW5jcmVhc2UgdGhlIHRvdGFsU3VwcGx5LgogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgYW1vdW50KTsKCiAgICAgICAgLy8gZG9uJ3QgZ28gb3ZlciB0aGUgbGltaXQhCiAgICAgICAgaWYgKHRvdGFsU3VwcGx5ID4gdG9rZW5DcmVhdGlvbk1heCkgdGhyb3c7CgogICAgICAgIC8vIERvbid0IGFsbG93IGNvbW11bml0eSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMgdG8gcHVyY2hhc2UgbW9yZSB0aGFuIHRoZWlyIGNhcC4KICAgICAgICBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkNvbW11bml0eVNhbGUpIHsKICAgICAgICAgICAgLy8gQ29tbXVuaXR5IHNhbGUgZGF5IDEuCiAgICAgICAgICAgIC8vIFdoaXRlbGlzdGVkIGFkZHJlc3NlcyBjYW4gcHVyY2hhc2UgYSBtYXhpbXVtIG9mIDEwMGsgREJFVHMgKDEwayBVU0QpLgogICAgICAgICAgICBpZihnZXRUaW1lKCkgPj0gZnVuZGluZ1N0YXJ0VGltZSAmJgogICAgICAgICAgICBnZXRUaW1lKCkgPCBmdW5kaW5nU3RhcnRUaW1lICsgMSBkYXlzKSB7CiAgICAgICAgICAgICAgICBpZihzYWZlQWRkKGNvbW11bml0eVNhbGVQdXJjaGFzZXNbbXNnLnNlbmRlcl1bMF0sIGFtb3VudCkgPiBjb21tdW5pdHlTYWxlQ2FwWzBdKQogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb21tdW5pdHlTYWxlUHVyY2hhc2VzW21zZy5zZW5kZXJdWzBdID0KICAgICAgICAgICAgICAgIHNhZmVBZGQoY29tbXVuaXR5U2FsZVB1cmNoYXNlc1ttc2cuc2VuZGVyXVswXSwgYW1vdW50KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ29tbXVuaXR5IHNhbGUgZGF5IDIuCiAgICAgICAgICAgIC8vIFdoaXRlbGlzdGVkIGFkZHJlc3NlcyBjYW4gcHVyY2hhc2UgYSBtYXhpbXVtIG9mIDIwMGsgREJFVHMgKDIwayBVU0QpLgogICAgICAgICAgICBlbHNlIGlmKGdldFRpbWUoKSA+PSAoZnVuZGluZ1N0YXJ0VGltZSArIDEgZGF5cykgJiYKICAgICAgICAgICAgZ2V0VGltZSgpIDwgZnVuZGluZ1N0YXJ0VGltZSArIDIgZGF5cykgewogICAgICAgICAgICAgICAgaWYoc2FmZUFkZChjb21tdW5pdHlTYWxlUHVyY2hhc2VzW21zZy5zZW5kZXJdWzFdLCBhbW91bnQpID4gY29tbXVuaXR5U2FsZUNhcFsxXSkKICAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY29tbXVuaXR5U2FsZVB1cmNoYXNlc1ttc2cuc2VuZGVyXVsxXSA9CiAgICAgICAgICAgICAgICBzYWZlQWRkKGNvbW11bml0eVNhbGVQdXJjaGFzZXNbbXNnLnNlbmRlcl1bMV0sIGFtb3VudCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEFzc2lnbiBuZXcgdG9rZW5zIHRvIHRoZSBzZW5kZXIuCiAgICAgICAgYmFsYW5jZXNbX2FkZHJlc3NdID0gc2FmZUFkZChiYWxhbmNlc1tfYWRkcmVzc10sIGFtb3VudCk7CgogICAgICAgIC8vIExvZyB0b2tlbiBjcmVhdGlvbiBldmVudAogICAgICAgIFRyYW5zZmVyKDAsIF9hZGRyZXNzLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEZpbmFsaXplIGNyb3dkZnVuZGluZwogICAgLy8vIEBkZXYgSWYgY2FwIHdhcyByZWFjaGVkIG9yIGNyb3dkZnVuZGluZyBoYXMgZW5kZWQgdGhlbjoKICAgIC8vLyBjcmVhdGUgREJFVCBmb3IgdGhlIERlY2VudEJldCBNdWx0aXNpZyBhbmQgdGVhbSwKICAgIC8vLyB0cmFuc2ZlciBFVEggdG8gdGhlIERlY2VudEJldCBNdWx0aXNpZyBhZGRyZXNzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgc3RhdGU6IFN1Y2Nlc3MKICAgIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RmdW5kaW5nKCkgZXh0ZXJuYWwgewogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBGdW5kaW5nIFN1Y2Nlc3Mgc3RhdGUuCiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuU3VjY2VzcykgdGhyb3c7CiAgICAgICAgLy8gZG9uJ3QgZmluYWxpemUgdW5sZXNzIHdlIHdvbgogICAgICAgIGlmIChmaW5hbGl6ZWRDcm93ZGZ1bmRpbmcpIHRocm93OwogICAgICAgIC8vIGNhbid0IGZpbmFsaXplIHR3aWNlIChzbyBzbmVha3khKQoKICAgICAgICAvLyBwcmV2ZW50IG1vcmUgY3JlYXRpb24gb2YgdG9rZW5zCiAgICAgICAgZmluYWxpemVkQ3Jvd2RmdW5kaW5nID0gdHJ1ZTsKCiAgICAgICAgLy8gRm91bmRlcidzIHN1cHBseSA6IDE4JSBvZiB0b3RhbCBnb2VzIHRvIHZhdWx0LCB0aW1lIGxvY2tlZCBmb3IgNiBtb250aHMKICAgICAgICB1aW50MjU2IHZhdWx0VG9rZW5zID0gc2FmZURpdihzYWZlTXVsKHRvdGFsU3VwcGx5LCB2YXVsdFBlcmNlbnRPZlRvdGFsKSwgY3Jvd2RmdW5kUGVyY2VudE9mVG90YWwpOwogICAgICAgIGJhbGFuY2VzW3RpbWVWYXVsdF0gPSBzYWZlQWRkKGJhbGFuY2VzW3RpbWVWYXVsdF0sIHZhdWx0VG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcigwLCB0aW1lVmF1bHQsIHZhdWx0VG9rZW5zKTsKCiAgICAgICAgLy8gSG91c2U6IDEwJSBvZiB0b3RhbCBnb2VzIHRvIERlY2VudC5iZXQgZm9yIGluaXRpYWwgaG91c2Ugc2V0dXAKICAgICAgICB1aW50MjU2IGhvdXNlVG9rZW5zID0gc2FmZURpdihzYWZlTXVsKHRvdGFsU3VwcGx5LCBob3VzZVBlcmNlbnRPZlRvdGFsKSwgY3Jvd2RmdW5kUGVyY2VudE9mVG90YWwpOwogICAgICAgIGJhbGFuY2VzW3RpbWVWYXVsdF0gPSBzYWZlQWRkKGJhbGFuY2VzW2RlY2VudEJldE11bHRpc2lnXSwgaG91c2VUb2tlbnMpOwogICAgICAgIFRyYW5zZmVyKDAsIGRlY2VudEJldE11bHRpc2lnLCBob3VzZVRva2Vucyk7CgogICAgICAgIC8vIEJvdW50aWVzOiAyJSBvZiB0b3RhbCBnb2VzIHRvIERlY2VudCBiZXQgZm9yIGJvdW50aWVzCiAgICAgICAgdWludDI1NiBib3VudHlUb2tlbnMgPSBzYWZlRGl2KHNhZmVNdWwodG90YWxTdXBwbHksIGJvdW50eVBlcmNlbnRPZlRvdGFsKSwgY3Jvd2RmdW5kUGVyY2VudE9mVG90YWwpOwogICAgICAgIGJhbGFuY2VzW2RlY2VudEJldE11bHRpc2lnXSA9IHNhZmVBZGQoYmFsYW5jZXNbZGVjZW50QmV0TXVsdGlzaWddLCBib3VudHlUb2tlbnMpOwogICAgICAgIFRyYW5zZmVyKDAsIGRlY2VudEJldE11bHRpc2lnLCBib3VudHlUb2tlbnMpOwoKICAgICAgICAvLyBUcmFuc2ZlciBFVEggdG8gdGhlIERCRVQgTXVsdGlzaWcgYWRkcmVzcy4KICAgICAgICBpZiAoIWRlY2VudEJldE11bHRpc2lnLnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7CiAgICB9CgogICAgLy8gSW50ZXJmYWNlIG1hcmtlcgogICAgZnVuY3Rpb24gaXNEZWNlbnRCZXRDcm93ZHNhbGUoKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWFuYWdlcyB0aGUgY3Jvd2RmdW5kaW5nIHN0YXRlIG1hY2hpbmUKICAgIC8vLyBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlCiAgICAvLy8gU28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZQogICAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpewogICAgICAgIC8qIFN1Y2Nlc3NmdWwgaWYgY3Jvd2RzYWxlIHdhcyBmaW5hbGl6ZWQgKi8KICAgICAgICBpZihmaW5hbGl6ZWRDcm93ZGZ1bmRpbmcpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwoKICAgICAgICAvKiBQcmUtc2FsZSBub3Qgc3RhcnRlZCAqLwogICAgICAgIGVsc2UgaWYgKGdldFRpbWUoKSA8IHByZVNhbGVTdGFydFRpbWUpIHJldHVybiBTdGF0ZS5XYWl0aW5nOwoKICAgICAgICAvKiBQcmUtc2FsZSAqLwogICAgICAgIGVsc2UgaWYgKGdldFRpbWUoKSA+PSBwcmVTYWxlU3RhcnRUaW1lICYmCiAgICAgICAgZ2V0VGltZSgpIDwgZnVuZGluZ1N0YXJ0VGltZSAmJgogICAgICAgIHRvdGFsU3VwcGx5IDwgdG9rZW5DcmVhdGlvbk1heCkgcmV0dXJuIFN0YXRlLlByZVNhbGU7CgogICAgICAgIC8qIENvbW11bml0eSBzYWxlICovCiAgICAgICAgZWxzZSBpZiAoZ2V0VGltZSgpID49IGZ1bmRpbmdTdGFydFRpbWUgJiYKICAgICAgICBnZXRUaW1lKCkgPCBmdW5kaW5nU3RhcnRUaW1lICsgMiBkYXlzICYmCiAgICAgICAgdG90YWxTdXBwbHkgPCB0b2tlbkNyZWF0aW9uTWF4KSByZXR1cm4gU3RhdGUuQ29tbXVuaXR5U2FsZTsKCiAgICAgICAgLyogUHVibGljIHNhbGUgKi8KICAgICAgICBlbHNlIGlmIChnZXRUaW1lKCkgPj0gKGZ1bmRpbmdTdGFydFRpbWUgKyAyIGRheXMpICYmCiAgICAgICAgZ2V0VGltZSgpIDwgZnVuZGluZ0VuZFRpbWUgJiYKICAgICAgICB0b3RhbFN1cHBseSA8IHRva2VuQ3JlYXRpb25NYXgpIHJldHVybiBTdGF0ZS5QdWJsaWNTYWxlOwoKICAgICAgICAvKiBTdWNjZXNzICovCiAgICAgICAgZWxzZSBpZiAoZ2V0VGltZSgpID49IGZ1bmRpbmdFbmRUaW1lIHx8CiAgICAgICAgdG90YWxTdXBwbHkgPT0gdG9rZW5DcmVhdGlvbk1heCkgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgICB9Cgp9'.
	

]
