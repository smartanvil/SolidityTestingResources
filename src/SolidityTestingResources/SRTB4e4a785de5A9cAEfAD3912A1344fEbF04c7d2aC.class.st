Class {
	#name : #SRTB4e4a785de5A9cAEfAD3912A1344fEbF04c7d2aC,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTB4e4a785de5A9cAEfAD3912A1344fEbF04c7d2aC >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIENvbnRyb2xsZXIKICovCmNvbnRyYWN0IENvbnRyb2xsZXIgewoKICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7CgogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7CgogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKTsKfQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgewogICAgaWYgKCFhc3NlcnRpb24pIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CgogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gVG9rZW5zCiAqIEBkZXYgVGhpcyBibG9ja3MgaW5jb21pbmcgRVJDMjMgdG9rZW5zIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBsb3NzIG9mIHRva2Vucy4KICogU2hvdWxkIHRva2VucyAoYW55IEVSQzIwQmFzaWMgY29tcGF0aWJsZSkgZW5kIHVwIGluIHRoZSBjb250cmFjdCwgaXQgYWxsb3dzIHRoZQogKiBvd25lciB0byByZWNsYWltIHRoZSB0b2tlbnMuCiAqLwpjb250cmFjdCBIYXNOb1Rva2VucyBpcyBPd25hYmxlIHsKCiAvKioKICAqIEBkZXYgUmVqZWN0IGFsbCBFUkMyMyBjb21wYXRpYmxlIHRva2VucwogICogQHBhcmFtIGZyb21fIGFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCBpcyB0cmFuc2ZlcnJpbmcgdGhlIHRva2VucwogICogQHBhcmFtIHZhbHVlXyBVaW50IHRoZSBhbW91bnQgb2YgdGhlIHNwZWNpZmllZCB0b2tlbgogICogQHBhcmFtIGRhdGFfIEJ5dGVzIFRoZSBkYXRhIHBhc3NlZCBmcm9tIHRoZSBjYWxsZXIuCiAgKi8KICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgZnJvbV8sIHVpbnQgdmFsdWVfLCBieXRlcyBkYXRhXykgZXh0ZXJuYWwgewogICAgdGhyb3c7CiAgfQoKICAvKioKICAgKiBAZGV2IFJlY2xhaW0gYWxsIEVSQzIwQmFzaWMgY29tcGF0aWJsZSB0b2tlbnMKICAgKiBAcGFyYW0gdG9rZW5BZGRyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbVRva2VuKGFkZHJlc3MgdG9rZW5BZGRyKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgRVJDMjBCYXNpYyB0b2tlbkluc3QgPSBFUkMyMEJhc2ljKHRva2VuQWRkcik7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbkluc3QuYmFsYW5jZU9mKHRoaXMpOwogICAgdG9rZW5JbnN0LnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICB9Cn0KCi8vIEBkZXYgQ29udHJhY3QgdG8gaG9sZCBFVEggcmFpc2VkIGR1cmluZyBhIHRva2VuIHNhbGUuCi8vIFByZXZlbnRzIGF0dGFjayBpbiB3aGljaCB0aGUgTXVsdGlzaWcgc2VuZHMgcmFpc2VkIGV0aGVyIHRvIHRoZQovLyBzYWxlIGNvbnRyYWN0IHRvIG1pbnQgdG9rZW5zIHRvIGl0c2VsZiwgYW5kIGdldHRpbmcgdGhlCi8vIGZ1bmRzIGJhY2sgaW1tZWRpYXRlbHkuCmNvbnRyYWN0IEFic3RyYWN0U2FsZSB7CiAgZnVuY3Rpb24gc2FsZUZpbmFsaXplZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBFc2Nyb3cgaXMgSGFzTm9Ub2tlbnMgewoKICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKICB1aW50IHB1YmxpYyBmaW5hbEJsb2NrOwogIEFic3RyYWN0U2FsZSBwdWJsaWMgdG9rZW5TYWxlOwoKICAvLyBAZGV2IENvbnN0cnVjdG9yIGluaXRpYWxpemVzIHB1YmxpYyB2YXJpYWJsZXMKICAvLyBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhZGRyZXNzIG9mIHRoZSBtdWx0aXNpZyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgZnVuZHMKICAvLyBAcGFyYW0gX2ZpbmFsQmxvY2sgQmxvY2sgYWZ0ZXIgd2hpY2ggdGhlIGJlbmVmaWNpYXJ5IGNhbiByZXF1ZXN0IHRoZSBmdW5kcwogIGZ1bmN0aW9uIEVzY3JvdyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfZmluYWxCbG9jaywgYWRkcmVzcyBfdG9rZW5TYWxlKSB7CiAgICBiZW5lZmljaWFyeSA9IF9iZW5lZmljaWFyeTsKICAgIGZpbmFsQmxvY2sgPSBfZmluYWxCbG9jazsKICAgIHRva2VuU2FsZSA9IEFic3RyYWN0U2FsZShfdG9rZW5TYWxlKTsKICB9CgogIC8vIEBkZXYgUmVjZWl2ZSBhbGwgc2VudCBmdW5kcyB3aXRob3V0IGFueSBmdXJ0aGVyIGxvZ2ljCiAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7fQoKICAvLyBAZGV2IFdpdGhkcmF3IGZ1bmN0aW9uIHNlbmRzIGFsbCB0aGUgZnVuZHMgdG8gdGhlIHdhbGxldCBpZiBjb25kaXRpb25zIGFyZSBjb3JyZWN0CiAgZnVuY3Rpb24gd2l0aGRyYXcoKSBwdWJsaWMgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gYmVuZWZpY2lhcnkpIHRocm93OwogICAgaWYgKGJsb2NrLm51bWJlciA+IGZpbmFsQmxvY2spIHJldHVybiBkb1dpdGhkcmF3KCk7CiAgICBpZiAodG9rZW5TYWxlLnNhbGVGaW5hbGl6ZWQoKSkgcmV0dXJuIGRvV2l0aGRyYXcoKTsKICB9CgogIGZ1bmN0aW9uIGRvV2l0aGRyYXcoKSBpbnRlcm5hbCB7CiAgICBpZiAoIWJlbmVmaWNpYXJ5LnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7CiAgfQp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwoKICAvKioKICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgewogICAgICAgdGhyb3c7CiAgICAgfQogICAgIF87CiAgfQoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtYW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJ0IHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEJhc2ljVG9rZW4sIEVSQzIwIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlYWhsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHsKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQp9CgovKioKICogQ29udHJvbGxlZAogKi8KY29udHJhY3QgQ29udHJvbGxlZCB7CgogIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CgogIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7CiAgICBjb250cm9sbGVyID0gbXNnLnNlbmRlcjsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogIH0KCiAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7CiAgICBfOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIENvbnRyb2xsZWQgewoKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsKCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgb25seUNvbnRyb2xsZXIgY2FuTWludCByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgaWYgKG1pbnRpbmdGaW5pc2hlZCkgdGhyb3c7CiAgICBfOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBMaW1pdGVkVHJhbnNmZXJUb2tlbgogKiBAZGV2IExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4KICogdHJhbnNmZXJhYmlsaXR5IGZvciBkaWZmZXJlbnQgZXZlbnRzLiBJdCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGFzIGEgYmFzZSBjbGFzcyBmb3Igb3RoZXIgdG9rZW4KICogY29udHJhY3RzLgogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsCiAqIHRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHJlY3Vyc2l2ZWx5IGNhbGxpbmcgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKCkgdW50aWwgdGhlIGJhc2UgY2xhc3MgaXMKICogaGl0LiBGb3IgZXhhbXBsZToKICogICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAqICAgICAgIHJldHVybiBtaW4yNTYodW5sb2NrZWRUb2tlbnMsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICogICAgIH0KICogQSB3b3JraW5nIGV4YW1wbGUgaXMgVmVzdGVkVG9rZW4uc29sOgogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy90b2tlbi9WZXN0ZWRUb2tlbi5zb2wKICovCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsKCiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cy4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CiAgIGlmIChfdmFsdWUgPiB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKSB0aHJvdzsKICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSB7CiAgICBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgewogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IERlZmF1bHQgdHJhbnNmZXJhYmxlIHRva2VucyBmdW5jdGlvbiByZXR1cm5zIGFsbCB0b2tlbnMgZm9yIGEgaG9sZGVyIChubyBsaW1pdCkuCiAgICogQGRldiBPdmVyd3JpdGluZyB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBpcyB0aGUgd2F5IHRvIHByb3ZpZGUgdGhlCiAgICogc3BlY2lmaWMgbG9naWMgZm9yIGxpbWl0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7CiAgfQp9CgovKioKICogQHRpdGxlIFZlc3RlZCB0b2tlbgogKiBAZGV2IFRva2VucyB0aGF0IGNhbiBiZSB2ZXN0ZWQgZm9yIGEgZ3JvdXAgb2YgYWRkcmVzc2VzLgogKi8KY29udHJhY3QgVmVzdGVkVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgTGltaXRlZFRyYW5zZmVyVG9rZW4gewoKICB1aW50MjU2IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MgPSAyMDsKCiAgc3RydWN0IFRva2VuR3JhbnQgewogICAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMKICAgIHVpbnQyNTYgdmFsdWU7ICAgICAgIC8vIDMyIGJ5dGVzCiAgICB1aW50NjQgY2xpZmY7CiAgICB1aW50NjQgdmVzdGluZzsKICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIC8vIDMgKiA4ID0gMjQgYnl0ZXMKICAgIGJvb2wgcmV2b2thYmxlOwogICAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/CiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpCgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOwoKICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7CgogIC8qKgogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICogQHBhcmFtIF9yZXZva2FibGUgYm9vbCBJZiB0aGUgZ3JhbnQgaXMgcmV2b2thYmxlLgogICAqIEBwYXJhbSBfYnVybnNPblJldm9rZSBib29sIFdoZW4gdHJ1ZSwgdGhlIHRva2VucyBhcmUgYnVybmVkIGlmIHJldm9rZWQuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcsCiAgICBib29sIF9yZXZva2FibGUsCiAgICBib29sIF9idXJuc09uUmV2b2tlCiAgKSBwdWJsaWMgewoKICAgIC8vIENoZWNrIGZvciBkYXRlIGluY29uc2lzdGVuY2llcyB0aGF0IG1heSBjYXVzZSB1bmV4cGVjdGVkIGJlaGF2aW9yCiAgICBpZiAoX2NsaWZmIDwgX3N0YXJ0IHx8IF92ZXN0aW5nIDwgX2NsaWZmKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGlmICh0b2tlbkdyYW50c0NvdW50KF90bykgPiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKSB0aHJvdzsgIC8vIFRvIHByZXZlbnQgYSB1c2VyIGJlaW5nIHNwYW1tZWQgYW5kIGhhdmUgaGlzIGJhbGFuY2UgbG9ja2VkIChvdXQgb2YgZ2FzIGF0dGFjayB3aGVuIGNhbGN1bGF0aW5nIHZlc3RpbmcpLgoKICAgIHVpbnQgY291bnQgPSBncmFudHNbX3RvXS5wdXNoKAogICAgICAgICAgICAgICAgVG9rZW5HcmFudCgKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLCAgLy8gYXZvaWQgc3RvcmluZyBhbiBleHRyYSAyMCBieXRlcyB3aGVuIGl0IGlzIG5vbi1yZXZva2FibGUKICAgICAgICAgICAgICAgICAgX3ZhbHVlLAogICAgICAgICAgICAgICAgICBfY2xpZmYsCiAgICAgICAgICAgICAgICAgIF92ZXN0aW5nLAogICAgICAgICAgICAgICAgICBfc3RhcnQsCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsCiAgICAgICAgICAgICAgICAgIF9idXJuc09uUmV2b2tlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKTsKICAgIHRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIE5ld1Rva2VuR3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGNvdW50IC0gMSk7CiAgfQoKICAvKioKICAgKiBAZGV2IFJldm9rZSB0aGUgZ3JhbnQgb2YgdG9rZW5zIG9mIGEgc3BlY2lmZWQgYWRkcmVzcy4KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLgogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50LgogICAqLwogIGZ1bmN0aW9uIHJldm9rZVRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBwdWJsaWMgewogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CgogICAgaWYgKCFncmFudC5yZXZva2FibGUpIHsgLy8gQ2hlY2sgaWYgZ3JhbnQgd2FzIHJldm9rYWJsZQogICAgICB0aHJvdzsKICAgIH0KCiAgICBpZiAoZ3JhbnQuZ3JhbnRlciAhPSBtc2cuc2VuZGVyKSB7IC8vIE9ubHkgZ3JhbnRlciBjYW4gcmV2b2tlIGl0CiAgICAgIHRocm93OwogICAgfQoKICAgIGFkZHJlc3MgcmVjZWl2ZXIgPSBncmFudC5idXJuc09uUmV2b2tlID8gMHhkZWFkIDogbXNnLnNlbmRlcjsKICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gbm9uVmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7CgogICAgLy8gcmVtb3ZlIGdyYW50IGZyb20gYXJyYXkKICAgIGRlbGV0ZSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtncmFudHNbX2hvbGRlcl0ubGVuZ3RoLnN1YigxKV07CiAgICBncmFudHNbX2hvbGRlcl0ubGVuZ3RoIC09IDE7CgogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChub25WZXN0ZWQpOwogICAgYmFsYW5jZXNbX2hvbGRlcl0gPSBiYWxhbmNlc1tfaG9sZGVyXS5zdWIobm9uVmVzdGVkKTsKCiAgICBUcmFuc2ZlcihfaG9sZGVyLCByZWNlaXZlciwgbm9uVmVzdGVkKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKICAgIGlmIChncmFudEluZGV4ID09IDApIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsgLy8gc2hvcnRjdXQgZm9yIGhvbGRlciB3aXRob3V0IGdyYW50cwoKICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIGdyYW50cyB0aGUgaG9sZGVyIGhhcywgYW5kIGFkZCBhbGwgbm9uLXZlc3RlZCB0b2tlbnMKICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gMDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBub25WZXN0ZWQgPSBub25WZXN0ZWQuYWRkKG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQoKICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUKICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gYmFsYW5jZU9mKGhvbGRlcikuc3ViKG5vblZlc3RlZCk7CgogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlCiAgICAvLyBpbiBjYXNlIHRoZXJlIGFyZSBvdGhlciBsaW1pdGluZyB0cmFuc2ZlcmFiaWxpdHkgZmFjdG9ycyAoZGVmYXVsdCBpcyBiYWxhbmNlT2YpCiAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBob2xkZXIgb2YgdGhlIGdyYW50cy4KICAgKiBAcmV0dXJuIEEgdWludCByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5kZXgpIHsKICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuCiAgICogQHBhcmFtIHRva2VucyB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIGdyYW50dGVkLgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbmluZyBvZiB0aGUgZ3JhbnQKICAgKiBAcGFyYW0gY2xpZmYgdWludDY0IFRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2Vuc29mIGEgc3BlY2lmIGdyYW50LgogICAqICB0cmFuc2ZlcmFibGVUb2tlbnMKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0CiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAvCiAgICogICB8ICAgICAgICAgICAgICAufAogICAqICAgfCAgICAgICAgICAgIC4gIHwKICAgKiAgIHwgICAgICAgICAgLiAgICB8CiAgICogICB8ICAgICAgICAuICAgICAgfAogICAqICAgfCAgICAgIC4gICAgICAgIHwoZ3JhbnRzW19ob2xkZXJdID09IGFkZHJlc3MoMCkpIHJldHVybiAwOwogICAqICAgfCAgICAuICAgICAgICAgIHwKICAgKiAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKICAgKiAgICAgIFN0YXJ0ICAgICAgIENsaWZ0ICAgIFZlc3RpbmcKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICB1aW50MjU2IHRva2VucywKICAgIHVpbnQyNTYgdGltZSwKICAgIHVpbnQyNTYgc3RhcnQsCiAgICB1aW50MjU2IGNsaWZmLAogICAgdWludDI1NiB2ZXN0aW5nKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAvLyBTaG9ydGN1dHMgZm9yIGJlZm9yZSBjbGlmZiBhbmQgYWZ0ZXIgdmVzdGluZyBjYXNlcy4KICAgICAgaWYgKHRpbWUgPCBjbGlmZikgcmV0dXJuIDA7CiAgICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7CgogICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2Vucy4KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQogICAgICAvLyBpbiB0aGUgdmVzdGluZyByZWN0IChhcyBzaG93biBpbiBhYm92ZSdzIGZpZ3VyZSkKCiAgICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkKICAgICAgdWludDI1NiB2ZXN0ZWRUb2tlbnMgPSB0b2tlbnMubXVsKHRpbWUuc3ViKHN0YXJ0KSkuZGl2KHZlc3Rpbmcuc3ViKHN0YXJ0KSk7CiAgICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldCBhbGwgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZjIGdyYW50LgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGdyYW50ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmVzdGVkLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcsIGJvb2wgcmV2b2thYmxlLCBib29sIGJ1cm5zT25SZXZva2UpIHsKICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7CiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsKCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgICBncmFudC52YWx1ZSwKICAgICAgdWludDI1Nih0aW1lKSwKICAgICAgdWludDI1NihncmFudC5zdGFydCksCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLAogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpCiAgICApOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZjIGdyYW50IG9uIHRoZQogICAqIHBhc3NlZCB0aW1lIGZyYW1lLgogICAqLwogIGZ1bmN0aW9uIG5vblZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gZ3JhbnQudmFsdWUuc3ViKHZlc3RlZFRva2VucyhncmFudCwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGRhdGUgd2hlbiB0aGUgaG9sZGVyIGNhbiB0cmFzZmVyIGFsbCBpdHMgdG9rZW5zCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBkYXRlIG9mIHRoZSBsYXN0IHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0IGRhdGUpIHsKICAgIGRhdGUgPSB1aW50NjQobm93KTsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IGdyYW50c1tob2xkZXJdLmxlbmd0aDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBkYXRlID0gU2FmZU1hdGgubWF4NjQoZ3JhbnRzW2hvbGRlcl1baV0udmVzdGluZywgZGF0ZSk7CiAgICB9CiAgfQp9CgovLy8gQHRpdGxlIEFydGNvaW4gKEFSVCkgLSBkZW1vY3JhdGl6aW5nIGN1bHR1cmUuCmNvbnRyYWN0IEFydGNvaW4gaXMgTWludGFibGVUb2tlbiwgVmVzdGVkVG9rZW4gewoKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAnQXJ0Y29pbic7CiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnQVJUJzsKICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgIGlmICghQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICB9IGVsc2UgewogICAgICB0aHJvdzsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICB1aW50IHNpemU7CiAgICBpZiAoX2FkZHIgPT0gYWRkcmVzcygwKSkgcmV0dXJuIGZhbHNlOwogICAgYXNzZW1ibHkgewogICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgfQogICAgcmV0dXJuIHNpemUgPiAwOwogIH0KfQoKLy8vIEB0aXRsZSBBcnRjb2luIFBsYWNlaG9sZGVyIC0gZGVtb2NyYXRpemluZyBjdWx0dXJlLgpjb250cmFjdCBBcnRjb2luUGxhY2Vob2xkZXIgaXMgQ29udHJvbGxlciB7CgogIEFydGNvaW4gcHVibGljIHRva2VuOwogIGFkZHJlc3MgcHVibGljIHRva2VuU2FsZTsKCiAgZnVuY3Rpb24gQXJ0Y29pblBsYWNlaG9sZGVyKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF90b2tlblNhbGUpIHsKICAgIHRva2VuID0gQXJ0Y29pbihfdG9rZW4pOwogICAgdG9rZW5TYWxlID0gX3Rva2VuU2FsZTsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBjb25zb3J0aXVtKSBwdWJsaWMgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gdG9rZW5TYWxlKSB0aHJvdzsKICAgIHRva2VuLmNoYW5nZUNvbnRyb2xsZXIoY29uc29ydGl1bSk7CiAgICBzdWljaWRlKGNvbnNvcnRpdW0pOwogIH0KCiAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0aHJvdzsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8vLyBAdGl0bGUgQVJUIFNhbGUgLSBkZW1vY3JhdGl6aW5nIGN1bHR1cmUuCmNvbnRyYWN0IEFydFNhbGUgaXMgQ29udHJvbGxlciB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CiAgYWRkcmVzcyBwdWJsaWMgb3BlcmF0aW9uczsKICBBcnRjb2luUGxhY2Vob2xkZXIgcHVibGljIGNvbnNvcnRpdW1QbGFjZWhvbGRlcjsKCiAgQXJ0Y29pbiBwdWJsaWMgdG9rZW47CiAgRXNjcm93IHB1YmxpYyBlc2Nyb3c7CgogIHVpbnQgcHVibGljIGluaXRpYWxCbG9jazsgIC8vIGJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgc2FsZSBzdGFydHMsIGluY2x1c2l2ZS4gc2FsZSB3aWxsIGJlIG9wZW5lZCBhdCBpbml0aWFsIGJsb2NrLgogIHVpbnQgcHVibGljIGZpbmFsQmxvY2s7ICAvLyBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIHNhbGUgZW5kcywgZXhjbHVzaXZlLCBzYWxlIHdpbGwgYmUgY2xvc2VkIGF0IGVuZHMgYmxvY2suCiAgdWludCBwdWJsaWMgaW5pdGlhbFByaWNlOyAgLy8gbnVtYmVyIG9mIHdlaS1BcnRjb2luIHRva2VucyBmb3IgMSB3ZWksIGF0IHRoZSBzdGFydCBvZiB0aGUgc2FsZSAoMTggZGVjaW1hbHMpCiAgdWludCBwdWJsaWMgZmluYWxQcmljZTsgIC8vIG51bWJlciBvZiB3ZWktQXJ0Y29pbiB0b2tlbnMgZm9yIDEgd2VpLCBhdCB0aGUgZW5kIG9mIHRoZSBzYWxlCiAgdWludCBwdWJsaWMgcHJpY2VTdGFnZXM7ICAvLyBudW1iZXIgb2YgZGlmZmVyZW50IHByaWNlIHN0YWdlcyBmb3IgaW50ZXJwb2xhdGluZyBiZXR3ZWVuIGluaXRpYWxQcmljZSBhbmQgZmluYWxQcmljZQoKICB1aW50IHB1YmxpYyBtYXhpbXVtU3Vic2NyaXB0aW9uOyAgLy8gbWF4aW11bSBzdWJzY3JpcHRpb25zLCBpbiB3ZWkKICB1aW50IHB1YmxpYyB0b3RhbFN1YnNjcmlwdGlvbiA9IDA7ICAvLyB0b3RhbCBzdWJzY3JpcHRpb25zLCBpbiB3ZWkKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgYWN0aXZhdGlvbnM7ICAvLyBjb25maXJtYXRpb25zIHRvIGFjdGl2YXRlIHRoZSBzYWxlCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgc3Vic2NyaXB0aW9uczsgIC8vIHN1YnNjcmlwdGlvbnMKCiAgdWludCBjb25zdGFudCBwdWJsaWMgZHVzdCA9IDEgZmlubmV5OyAgLy8gbWluaW11bSBpbnZlc3RtZW50CgogIGJvb2wgcHVibGljIHNhbGVTdG9wcGVkID0gZmFsc2U7CiAgYm9vbCBwdWJsaWMgc2FsZUZpbmFsaXplZCA9IGZhbHNlOwoKICBldmVudCBOZXdQcmVzYWxlQWxsb2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgTmV3U3Vic2NyaXB0aW9uKGFkZHJlc3MgaW5kZXhlZCBob2xkZXIsIHVpbnQgYW1vdW50LCB1aW50IGV0aGVyQW1vdW50KTsKCiAgZnVuY3Rpb24gQXJ0U2FsZShhZGRyZXNzIF9tYW5hZ2VyLAogICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfb3BlcmF0aW9ucywKICAgICAgICAgICAgICAgICAgIHVpbnQgX2luaXRpYWxCbG9jaywKICAgICAgICAgICAgICAgICAgIHVpbnQgX2ZpbmFsQmxvY2ssCiAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9pbml0aWFsUHJpY2UsCiAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9maW5hbFByaWNlLAogICAgICAgICAgICAgICAgICAgdWludDggX3ByaWNlU3RhZ2VzLAogICAgICAgICAgICAgICAgICAgdWludCBfbWF4aW11bVN1YnNjcmlwdGlvbikKICAgICAgICAgICAgICAgICAgIG5vblplcm9BZGRyZXNzKF9vcGVyYXRpb25zKSB7CiAgICBpZiAoX2luaXRpYWxCbG9jayA8IGdldEJsb2NrTnVtYmVyKCkpIHRocm93OwogICAgaWYgKF9pbml0aWFsQmxvY2sgPj0gX2ZpbmFsQmxvY2spIHRocm93OwogICAgaWYgKF9pbml0aWFsUHJpY2UgPD0gX2ZpbmFsUHJpY2UpIHRocm93OwogICAgaWYgKF9wcmljZVN0YWdlcyA8IDIpIHRocm93OwogICAgaWYgKF9wcmljZVN0YWdlcyA+IF9pbml0aWFsUHJpY2UgLSBfZmluYWxQcmljZSkgdGhyb3c7CgogICAgbWFuYWdlciA9IF9tYW5hZ2VyOwogICAgb3BlcmF0aW9ucyA9IF9vcGVyYXRpb25zOwogICAgbWF4aW11bVN1YnNjcmlwdGlvbiA9IF9tYXhpbXVtU3Vic2NyaXB0aW9uOwogICAgaW5pdGlhbEJsb2NrID0gX2luaXRpYWxCbG9jazsKICAgIGZpbmFsQmxvY2sgPSBfZmluYWxCbG9jazsKICAgIGluaXRpYWxQcmljZSA9IF9pbml0aWFsUHJpY2U7CiAgICBmaW5hbFByaWNlID0gX2ZpbmFsUHJpY2U7CiAgICBwcmljZVN0YWdlcyA9IF9wcmljZVN0YWdlczsKICB9CgogIC8vIEBub3RpY2UgU2V0IEFydGNvaW4gdG9rZW4gYW5kIGVzY3JvdyBhZGRyZXNzLgogIC8vIEBwYXJhbSBfdG9rZW46IEFkZHJlc3Mgb2YgYW4gaW5zdGFuY2Ugb2YgdGhlIEFydGNvaW4gdG9rZW4KICAvLyBAcGFyYW0gX2NvbnNvcnRpdW1QbGFjZWhvbGRlcjogQWRkcmVzcyBvZiB0aGUgY29uc29ydGl1bSBwbGFjZWhvbGRlcgogIC8vIEBwYXJhbSBfZXNjcm93OiBBZGRyZXNzIG9mIHRoZSB3YWxsZXQgcmVjZWl2aW5nIHRoZSBmdW5kcyBvZiB0aGUgc2FsZQogIGZ1bmN0aW9uIHNldEFydGNvaW4oYWRkcmVzcyBfdG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9jb25zb3J0aXVtUGxhY2Vob2xkZXIsCiAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9lc2Nyb3cpCiAgICAgICAgICAgICAgICAgICAgICBub25aZXJvQWRkcmVzcyhfdG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICBub25aZXJvQWRkcmVzcyhfY29uc29ydGl1bVBsYWNlaG9sZGVyKQogICAgICAgICAgICAgICAgICAgICAgbm9uWmVyb0FkZHJlc3MoX2VzY3JvdykKICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB7CiAgICBpZiAoYWN0aXZhdGlvbnNbdGhpc10pIHRocm93OwoKICAgIHRva2VuID0gQXJ0Y29pbihfdG9rZW4pOwogICAgY29uc29ydGl1bVBsYWNlaG9sZGVyID0gQXJ0Y29pblBsYWNlaG9sZGVyKF9jb25zb3J0aXVtUGxhY2Vob2xkZXIpOwogICAgZXNjcm93ID0gRXNjcm93KF9lc2Nyb3cpOwoKICAgIGlmICh0b2tlbi5jb250cm9sbGVyKCkgIT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7ICAvLyBzYWxlIGlzIHRva2VuIGNvbnRyb2xsZXIKICAgIGlmICh0b2tlbi50b3RhbFN1cHBseSgpID4gMCkgdGhyb3c7ICAvLyB0b2tlbiBpcyBlbXB0eQogICAgaWYgKGNvbnNvcnRpdW1QbGFjZWhvbGRlci50b2tlblNhbGUoKSAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsgIC8vIHBsYWNlaG9sZGVyIGhhcyByZWZlcmVuY2UgdG8gc2FsZQogICAgaWYgKGNvbnNvcnRpdW1QbGFjZWhvbGRlci50b2tlbigpICE9IGFkZHJlc3ModG9rZW4pKSB0aHJvdzsgLy8gcGxhY2Vob2xkZXIgaGFzIHJlZmVyZW5jZSB0byBBUlQKICAgIGlmIChlc2Nyb3cuZmluYWxCbG9jaygpICE9IGZpbmFsQmxvY2spIHRocm93OyAgLy8gZmluYWwgYmxvY2tzIG11c3QgbWF0Y2gKICAgIGlmIChlc2Nyb3cuYmVuZWZpY2lhcnkoKSAhPSBvcGVyYXRpb25zKSB0aHJvdzsgIC8vIHJlY2VpdmluZyB3YWxsZXQgbXVzdCBtYXRjaAogICAgaWYgKGVzY3Jvdy50b2tlblNhbGUoKSAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsgIC8vIHdhdGNoZWQgdG9rZW4gc2FsZSBtdXN0IGJlIHNlbGYKCiAgICBkb0FjdGl2YXRlU2FsZSh0aGlzKTsKICB9CgogIC8vIEBub3RpY2UgQ2VydGFpbiBhZGRyZXNzZXMgbmVlZCB0byBjYWxsIHRoZSBhY3RpdmF0ZSBmdW5jdGlvbiBwcmlvciB0byB0aGUgc2FsZSBvcGVuaW5nIGJsb2NrLgogIC8vIFRoaXMgcHJvdmVzIHRoYXQgdGhleSBoYXZlIGNoZWNrZWQgdGhlIHNhbGUgY29udHJhY3QgaXMgbGVnaXQsIGFzIHdlbGwgYXMgcHJvdmluZwogIC8vIHRoZSBjYXBhYmlsaXR5IGZvciB0aG9zZSBhZGRyZXNzZXMgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgY29udHJhY3QuCiAgZnVuY3Rpb24gYWN0aXZhdGVTYWxlKCkgcHVibGljIHsKICAgIGRvQWN0aXZhdGVTYWxlKG1zZy5zZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gZG9BY3RpdmF0ZVNhbGUoYWRkcmVzcyBfZW50aXR5KSBub25aZXJvQWRkcmVzcyh0b2tlbikgb25seUJlZm9yZVNhbGUgcHJpdmF0ZSB7CiAgICBhY3RpdmF0aW9uc1tfZW50aXR5XSA9IHRydWU7CiAgfQoKICAvLyBAbm90aWNlIFdoZXRoZXIgdGhlIG5lZWRlZCBhY2NvdW50cyBoYXZlIGFjdGl2YXRlZCB0aGUgc2FsZS4KICAvLyBAcmV0dXJuIElzIHNhbGUgYWN0aXZhdGVkCiAgZnVuY3Rpb24gaXNBY3RpdmF0ZWQoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGFjdGl2YXRpb25zW3RoaXNdICYmIGFjdGl2YXRpb25zW29wZXJhdGlvbnNdOwogIH0KCiAgLy8gQG5vdGljZSBHZXQgdGhlIHByaWNlIGZvciBhIEFydGNvaW4gdG9rZW4gYXQgYW55IGdpdmVuIGJsb2NrIG51bWJlcgogIC8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgdGhlIGJsb2NrIGZvciB3aGljaCB0aGUgcHJpY2UgaXMgcmVxdWVzdGVkCiAgLy8gQHJldHVybiBOdW1iZXIgb2Ygd2VpLUFydGNvaW4gZm9yIDEgd2VpCiAgLy8gSWYgc2FsZSBpc24ndCBvbmdvaW5nIGZvciB0aGF0IGJsb2NrLCByZXR1cm5zIDAuCiAgZnVuY3Rpb24gZ2V0UHJpY2UodWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICBpZiAoX2Jsb2NrTnVtYmVyIDwgaW5pdGlhbEJsb2NrIHx8IF9ibG9ja051bWJlciA+PSBmaW5hbEJsb2NrKSByZXR1cm4gMDsKICAgIHJldHVybiBwcmljZUZvclN0YWdlKHN0YWdlRm9yQmxvY2soX2Jsb2NrTnVtYmVyKSk7CiAgfQoKICAvLyBAbm90aWNlIEdldCB3aGF0IHRoZSBzdGFnZSBpcyBmb3IgYSBnaXZlbiBibG9ja051bWJlcgogIC8vIEBwYXJhbSBfYmxvY2tOdW1iZXI6IEJsb2NrIG51bWJlcgogIC8vIEByZXR1cm4gVGhlIHNhbGUgc3RhZ2UgZm9yIHRoYXQgYmxvY2suIFN0YWdlIGlzIGJldHdlZW4gMCBhbmQgKHByaWNlU3RhZ2VzIC0gMSkKICBmdW5jdGlvbiBzdGFnZUZvckJsb2NrKHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGJsb2NrTiA9IF9ibG9ja051bWJlci5zdWIoaW5pdGlhbEJsb2NrKTsKICAgIHVpbnQgdG90YWxCbG9ja3MgPSBmaW5hbEJsb2NrLnN1Yihpbml0aWFsQmxvY2spOwogICAgcmV0dXJuIHByaWNlU3RhZ2VzLm11bChibG9ja04pLmRpdih0b3RhbEJsb2Nrcyk7CiAgfQoKICAvLyBAbm90aWNlIEdldCB3aGF0IHRoZSBwcmljZSBpcyBmb3IgYSBnaXZlbiBzdGFnZQogIC8vIEBwYXJhbSBfc3RhZ2U6IFN0YWdlIG51bWJlcgogIC8vIEByZXR1cm4gUHJpY2UgaW4gd2VpIGZvciB0aGF0IHN0YWdlLgogIC8vIElmIHNhbGUgc3RhZ2UgZG9lc24ndCBleGlzdCwgcmV0dXJucyAwLgogIGZ1bmN0aW9uIHByaWNlRm9yU3RhZ2UodWludCBfc3RhZ2UpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGlmIChfc3RhZ2UgPj0gcHJpY2VTdGFnZXMpIHJldHVybiAwOwogICAgdWludCBwcmljZURpZmZlcmVuY2UgPSBpbml0aWFsUHJpY2Uuc3ViKGZpbmFsUHJpY2UpOwogICAgdWludCBzdGFnZURlbHRhID0gcHJpY2VEaWZmZXJlbmNlLmRpdih1aW50KHByaWNlU3RhZ2VzIC0gMSkpOwogICAgcmV0dXJuIGluaXRpYWxQcmljZS5zdWIodWludChfc3RhZ2UpLm11bChzdGFnZURlbHRhKSk7CiAgfQoKICAvLyBAbm90aWNlIEFydGNvaW4gbmVlZHMgdG8gbWFrZSBpbml0aWFsIHRva2VuIGFsbG9jYXRpb25zIGZvciBwcmVzYWxlIHBhcnRuZXJzCiAgLy8gVGhpcyBhbGxvY2F0aW9uIGhhcyB0byBiZSBtYWRlIGJlZm9yZSB0aGUgc2FsZSBpcyBhY3RpdmF0ZWQuIEFjdGl2YXRpbmcgdGhlCiAgLy8gc2FsZSBtZWFucyBubyBtb3JlIGFyYml0cmFyeSBhbGxvY2F0aW9ucyBhcmUgcG9zc2libGUgYW5kIGV4cHJlc3NlcyBjb25mb3JtaXR5LgogIC8vIEBwYXJhbSBfcmVjaXBpZW50OiBUaGUgcmVjZWl2ZXIgb2YgdGhlIHRva2VucwogIC8vIEBwYXJhbSBfYW1vdW50OiBBbW91bnQgb2YgdG9rZW5zIGFsbG9jYXRlZCBmb3IgcmVjZWl2ZXIuCiAgZnVuY3Rpb24gYWxsb2NhdGVQcmVzYWxlVG9rZW5zKGFkZHJlc3MgX3JlY2lwaWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjQgY2xpZmZEYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjQgdmVzdGluZ0RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgcmV2b2thYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGJ1cm5PblJldm9jYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlCZWZvcmVTYWxlQWN0aXZhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5QmVmb3JlU2FsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub25aZXJvQWRkcmVzcyhfcmVjaXBpZW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5KG9wZXJhdGlvbnMpIHB1YmxpYyB7CiAgICB0b2tlbi5ncmFudFZlc3RlZFRva2VucyhfcmVjaXBpZW50LCBfYW1vdW50LCB1aW50NjQobm93KSwgY2xpZmZEYXRlLCB2ZXN0aW5nRGF0ZSwgcmV2b2thYmxlLCBidXJuT25SZXZvY2F0aW9uKTsKICAgIE5ld1ByZXNhbGVBbGxvY2F0aW9uKF9yZWNpcGllbnQsIF9hbW91bnQpOwogIH0KCiAgLy8vIEBkZXYgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGV0aGVyIGlzIHNlbnQgdG8gdGhlIGNvbnRyYWN0LCBpdAogIC8vLyBzaW1wbHkgY2FsbHMgYGRvUGF5bWVudCgpYCB3aXRoIHRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgYXMgdGhlCiAgLy8vIGBfc3Vic2NyaWJlcmAuIFBheWFibGUgaXMgYSByZXF1aXJlZCBzb2xpZGl0eSBtb2RpZmllciBmb3IgZnVuY3Rpb25zIHRvIHJlY2VpdmUKICAvLy8gZXRoZXIsIHdpdGhvdXQgdGhpcyBtb2RpZmllciBmdW5jdGlvbnMgd2lsbCB0aHJvdyBpZiBldGhlciBpcyBzZW50IHRvIHRoZW0KICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJldHVybiBkb1BheW1lbnQobXNnLnNlbmRlcik7CiAgfQoKICAvLy8gQGRldiBgZG9QYXltZW50KClgIGlzIGFuIGludGVybmFsIGZ1bmN0aW9uIHRoYXQgc2VuZHMgdGhlIGV0aGVyIHRoYXQgdGhpcwogIC8vLyBjb250cmFjdCByZWNlaXZlcyB0byBlc2Nyb3cgYW5kIGNyZWF0ZXMgdG9rZW5zIGluIHRoZSBhZGRyZXNzIG9mIHRoZQogIC8vLyBAcGFyYW0gX3N1YnNjcmliZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zCiAgZnVuY3Rpb24gZG9QYXltZW50KGFkZHJlc3MgX3N1YnNjcmliZXIpCiAgICAgICAgICAgb25seUR1cmluZ1NhbGVQZXJpb2QKICAgICAgICAgICBvbmx5U2FsZU5vdFN0b3BwZWQKICAgICAgICAgICBvbmx5U2FsZUFjdGl2YXRlZAogICAgICAgICAgIG5vblplcm9BZGRyZXNzKF9zdWJzY3JpYmVyKQogICAgICAgICAgIG1pbmltdW1WYWx1ZShkdXN0KSBpbnRlcm5hbCB7CiAgICBpZiAodG90YWxTdWJzY3JpcHRpb24gKyBtc2cudmFsdWUgPiBtYXhpbXVtU3Vic2NyaXB0aW9uKSB0aHJvdzsgIC8vIHRocm93IGlmIG1heGltdW0gc3Vic2NyaXB0aW9uIGV4Y2VlZGVkCiAgICB1aW50IHB1cmNoYXNlZFRva2VucyA9IG1zZy52YWx1ZS5tdWwoZ2V0UHJpY2UoZ2V0QmxvY2tOdW1iZXIoKSkpOyAgLy8gbnVtYmVyIG9mIHB1cmNoYXNlZCB0b2tlbnMKCiAgICBpZiAoIWVzY3Jvdy5zZW5kKG1zZy52YWx1ZSkpIHRocm93OyAgLy8gZXNjcm93IGZ1bmRzCiAgICBpZiAoIXRva2VuLm1pbnQoX3N1YnNjcmliZXIsIHB1cmNoYXNlZFRva2VucykpIHRocm93OyAgLy8gZGVsaXZlciB0b2tlbnMKCiAgICBzdWJzY3JpcHRpb25zW19zdWJzY3JpYmVyXSA9IHN1YnNjcmlwdGlvbnNbX3N1YnNjcmliZXJdLmFkZChtc2cudmFsdWUpOwogICAgdG90YWxTdWJzY3JpcHRpb24gPSB0b3RhbFN1YnNjcmlwdGlvbi5hZGQobXNnLnZhbHVlKTsKICAgIE5ld1N1YnNjcmlwdGlvbihfc3Vic2NyaWJlciwgcHVyY2hhc2VkVG9rZW5zLCBtc2cudmFsdWUpOwogIH0KCiAgLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzdG9wIHNhbGUgYmVmb3JlIHRoZSBzYWxlIHBlcmlvZCBlbmRzCiAgLy8gQGRldiBPbmx5IG9wZXJhdGlvbnMgaXMgYXV0aG9yaXplZCB0byBjYWxsIHRoaXMgbWV0aG9kCiAgZnVuY3Rpb24gc3RvcFNhbGUoKSBvbmx5U2FsZUFjdGl2YXRlZCBvbmx5U2FsZU5vdFN0b3BwZWQgb25seShvcGVyYXRpb25zKSBwdWJsaWMgewogICAgc2FsZVN0b3BwZWQgPSB0cnVlOwogIH0KCiAgLy8gQG5vdGljZSBGdW5jdGlvbiB0byByZXN0YXJ0IHN0b3BwZWQgc2FsZQogIC8vIEBkZXYgT25seSBvcGVyYXRpb25zIGlzIGF1dGhvcml6ZWQgdG8gY2FsbCB0aGlzIG1ldGhvZAogIGZ1bmN0aW9uIHJlc3RhcnRTYWxlKCkgb25seUR1cmluZ1NhbGVQZXJpb2Qgb25seVNhbGVTdG9wcGVkIG9ubHkob3BlcmF0aW9ucykgcHVibGljIHsKICAgIHNhbGVTdG9wcGVkID0gZmFsc2U7CiAgfQoKICAvLyBAbm90aWNlIEZpbmFsaXplcyBzYWxlIGFuZCBkaXN0cmlidXRlcyBBcnRjb2luIHRvIHB1cmNoYXNlcnMgYW5kIHJlbGVhc2VzIHBheW1lbnRzCiAgLy8gQGRldiBUcmFuc2ZlcnMgdGhlIHRva2VuIGNvbnRyb2xsZXIgcG93ZXIgdG8gdGhlIGNvbnNvcnRpdW0uCiAgZnVuY3Rpb24gZmluYWxpemVTYWxlKCkgb25seUFmdGVyU2FsZSBvbmx5KG9wZXJhdGlvbnMpIHB1YmxpYyB7CiAgICBkb0ZpbmFsaXplU2FsZSgpOwogIH0KCiAgZnVuY3Rpb24gZG9GaW5hbGl6ZVNhbGUoKSBpbnRlcm5hbCB7CiAgICB1aW50IHB1cmNoYXNlZFRva2VucyA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CgogICAgdWludCBhZHZpc29yVG9rZW5zID0gcHVyY2hhc2VkVG9rZW5zICogNSAvIDEwMDsgIC8vIG1pbnQgNSUgb2YgcHVyY2hhc2VkIGZvciBhZHZpc29ycwogICAgaWYgKCF0b2tlbi5taW50KG9wZXJhdGlvbnMsIGFkdmlzb3JUb2tlbnMpKSB0aHJvdzsKCiAgICB1aW50IG1hbmFnZXJUb2tlbnMgPSBwdXJjaGFzZWRUb2tlbnMgKiAyNSAvIDEwMDsgIC8vIG1pbnQgMjUlIG9mIHB1cmNoYXNlZCBmb3IgbWFuYWdlcgogICAgaWYgKCF0b2tlbi5taW50KG1hbmFnZXIsIG1hbmFnZXJUb2tlbnMpKSB0aHJvdzsKCiAgICB0b2tlbi5jaGFuZ2VDb250cm9sbGVyKGNvbnNvcnRpdW1QbGFjZWhvbGRlcik7CgogICAgc2FsZUZpbmFsaXplZCA9IHRydWU7CiAgICBzYWxlU3RvcHBlZCA9IHRydWU7CiAgfQoKICAvLyBAbm90aWNlIERlcGxveSBBcnRjb2luIENvbnNvcnRpdW0gY29udHJhY3QKICAvLyBAcGFyYW0gY29uc29ydGl1bTogVGhlIGFkZHJlc3MgdGhlIGNvbnNvcnRpdW0gd2FzIGRlcGxveWVkIGF0LgogIGZ1bmN0aW9uIGRlcGxveUNvbnNvcnRpdW0oYWRkcmVzcyBjb25zb3J0aXVtKSBvbmx5RmluYWxpemVkU2FsZSBub25aZXJvQWRkcmVzcyhjb25zb3J0aXVtKSBvbmx5KG9wZXJhdGlvbnMpIHB1YmxpYyB7CiAgICBjb25zb3J0aXVtUGxhY2Vob2xkZXIuY2hhbmdlQ29udHJvbGxlcihjb25zb3J0aXVtKTsKICB9CgogIGZ1bmN0aW9uIHNldE9wZXJhdGlvbnMoYWRkcmVzcyBfb3BlcmF0aW9ucykgbm9uWmVyb0FkZHJlc3MoX29wZXJhdGlvbnMpIG9ubHkob3BlcmF0aW9ucykgcHVibGljIHsKICAgIG9wZXJhdGlvbnMgPSBfb3BlcmF0aW9uczsKICB9CgogIGZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGJsb2NrLm51bWJlcjsKICB9CgogIGZ1bmN0aW9uIHNhbGVGaW5hbGl6ZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZUZpbmFsaXplZDsKICB9CgogIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgZG9QYXltZW50KF9vd25lcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdHJhbnNmZXIKICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAvLyBVbnRpbCB0aGUgc2FsZSBpcyBmaW5hbGl6ZWQsIG9ubHkgYWxsb3dzIHRyYW5zZmVycyBvcmlnaW5hdGVkIGJ5IHRoZSBzYWxlIGNvbnRyYWN0LgogICAgLy8gV2hlbiBmaW5hbGl6ZVNhbGUgaXMgY2FsbGVkLCB0aGlzIGZ1bmN0aW9uIHdpbGwgc3RvcCBiZWluZyBjYWxsZWQgYW5kIHdpbGwgYWx3YXlzIGJlIHRydWUuCiAgICByZXR1cm4gX2Zyb20gPT0gYWRkcmVzcyh0aGlzKTsKICB9CgogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsCiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyB4KSB7CiAgICBpZiAobXNnLnNlbmRlciAhPSB4KSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5QmVmb3JlU2FsZSB7CiAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA+PSBpbml0aWFsQmxvY2spIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlEdXJpbmdTYWxlUGVyaW9kIHsKICAgIGlmIChnZXRCbG9ja051bWJlcigpIDwgaW5pdGlhbEJsb2NrKSB0aHJvdzsKICAgIGlmIChnZXRCbG9ja051bWJlcigpID49IGZpbmFsQmxvY2spIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlBZnRlclNhbGUgewogICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPCBmaW5hbEJsb2NrKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5U2FsZVN0b3BwZWQgewogICAgaWYgKCFzYWxlU3RvcHBlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seVNhbGVOb3RTdG9wcGVkIHsKICAgIGlmIChzYWxlU3RvcHBlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUJlZm9yZVNhbGVBY3RpdmF0aW9uIHsKICAgIGlmIChpc0FjdGl2YXRlZCgpKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5U2FsZUFjdGl2YXRlZCB7CiAgICBpZiAoIWlzQWN0aXZhdGVkKCkpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlGaW5hbGl6ZWRTYWxlIHsKICAgIGlmIChnZXRCbG9ja051bWJlcigpIDwgZmluYWxCbG9jaykgdGhyb3c7CiAgICBpZiAoIXNhbGVGaW5hbGl6ZWQpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG5vblplcm9BZGRyZXNzKGFkZHJlc3MgeCkgewogICAgaWYgKHggPT0gMCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgbWluaW11bVZhbHVlKHVpbnQyNTYgeCkgewogICAgaWYgKG1zZy52YWx1ZSA8IHgpIHRocm93OwogICAgXzsKICB9Cn0='.
	

]
