Class {
	#name : #SRT1fdedef5c2da1ed9db44d80003a9592dfa18163c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1fdedef5c2da1ed9db44d80003a9592dfa18163c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKLy8gSGVkZ2VseSAtIHYyCi8vIDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYjhjYWQ5ZGNkOWQ1ZDdjYmRiZDBmOGRmZDVkOWQxZDQ5NmRiZDdkNSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgoKCi8qKgogKiBAdGl0bGUgU3luZGljYXRlCiAqIEBkZXYgU3luZGljYXRlZCBwcm9maXQgc2hhcmluZyAtIGZvciBlYXJseSBhZG9wdGVycwogKiBTaGFyZXMgYXJlIG5vdCB0cmFuc2ZlcmFibGUgLQogKi8KY29udHJhY3QgU3luZGljYXRlIGlzIE93bmFibGV7CgogICAgdWludDI1NiBwdWJsaWMgbnVtYmVyU3luZGljYXRlTWVtYmVyczsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3luZGljYXRlU2hhcmVzID0gMjAwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBwbGF5ZXJzU2hhcmVBbGxvY2F0aW9uID0gNTAwMDsgLy8gMjUlCiAgICB1aW50MjU2IHB1YmxpYyBhdmFpbGFibGVCdXlJblNoYXJlcyA9IDUwMDA7IC8vIDI1JQogICAgdWludDI1NiBwdWJsaWMgbWluaW11bUJ1eUluID0gMTA7CiAgICB1aW50MjU2IHB1YmxpYyBidXlJblNoYXJlUHJpY2UgPSAxMDAwMDAwMDAwMDAwMDAwOyAvLyB3ZWkgPSAwLjAwMSBldGhlcgogICAgdWludDI1NiBwdWJsaWMgc2hhcmVDeWNsZVNlc3Npb25TaXplID0gMTAwMDsgLy8gbnVtYmVyIG9mIHNlc3Npb25zIGluIGEgc2hhcmUgY3ljbGUKICAgIHVpbnQyNTYgcHVibGljIHNoYXJlQ3ljbGVJbmRleCA9IDA7IC8vIGN1cnJlbnQgcG9zaXRpb24gaW4gc2hhcmUgY3ljbGUKICAgIHVpbnQyNTYgcHVibGljIHNoYXJlQ3ljbGUgPSAxOwogICAgdWludDI1NiBwdWJsaWMgY3VycmVudFN5bmRpY2F0ZVZhbHVlID0gMDsgLy8gdG90YWwgdmFsdWUgb2Ygc3luZGljYXRlIHRvIGJlIGRpdmlkZWQgYW1vbmcgbWVtYmVycwogICAgdWludDI1NiBwdWJsaWMgcHJlY2lzaW9uID0gMTAwMDAwMDAwMDAwMDAwMDsKCiAgICAvLyBsaW1pdCBwbGF5ZXJzL2N5Y2xlIHRvIHByb3RlY3QgY29udHJhY3QgZnJvbSBtdWx0aS1hZGRyZXMgRE9TIGdhcyBhdHRhY2sgKGZpcnN0IDEwMCBwbGF5ZXJzIG9uIGJvYXJkIGNvdW50ZWQpCiAgICAvLyB3aWxsIG1vbml0b3IgdGhpcyBhdCBzaGFyZSBkaXN0cmlidXRpb24gZXhlY3V0aW9uIGFuZCBhZGp1c3QgaWYgdGhlcmUgYXJlIGdhcyBwcm9ibGVtcyBkdWUgdG8gaGlnaCBudW1iZXJzIG9mIHBsYXllcnMuCiAgICB1aW50MjU2IHB1YmxpYyBtYXhDeWNsZVBsYXllcnNDb25zaWRlcmVkID0gMTAwOwoKICAgIGFkZHJlc3NbXSBwdWJsaWMgY3ljbGVQbGF5ZXJzOyAvLyB0aGUgcGxheWVycyB0aGF0IGhhdmUgcGxheWVkIHRoaXMgY3ljbGUKICAgIHVpbnQyNTYgcHVibGljIG51bWJlck9mQ3ljbGVQbGF5ZXJzID0gMDsKCiAgICBzdHJ1Y3Qgc29tZVBsYXllciB7CiAgICAgICAgdWludDI1NiBwbGF5Q291bnQ7CiAgICAgICAgdWludDI1NiBwcm9maXRTaGFyZTsgLy8gY3VycmVudGx5IGNsYWltYWJsZSBwcm9maXQKICAgICAgICB1aW50MjU2IHNoYXJlQ3ljbGU7IC8vIHJlcHJlc2VudHMgdGhlIHNoYXJlIGN5Y2xlIHRoaXMgcGxheWVyIGhhcyBsYXN0IHBsYXllZAogICAgICAgIHVpbnQyNTYgd2lubmluZ3M7IC8vIGN1cnJlbnQgYXZhaWxhYmxlIHdpbm5pbmdzIChmb3Igd2l0aGRyYXdhbCkKICAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHNvbWVQbGF5ZXIgKSBwcml2YXRlIGFsbFBsYXllcnM7IC8vIGFsbCBvZiB0aGUgcGxheWVycwoKICAgIHN0cnVjdCBtZW1iZXIgewogICAgICAgIHVpbnQyNTYgbnVtU2hhcmVzOwogICAgICAgIHVpbnQyNTYgcHJvZml0U2hhcmU7CiAgICAgfQoKICAgIGFkZHJlc3NbXSBwcml2YXRlIHN5bmRpY2F0ZU1lbWJlcnM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWVtYmVyICkgcHJpdmF0ZSBtZW1iZXJzOwoKICAgIGV2ZW50IFByb2ZpdFNoYXJlKAogICAgICAgICAgdWludDI1NiBfY3VycmVudFN5bmRpY2F0ZVZhbHVlLAogICAgICAgICAgdWludDI1NiBfbnVtYmVyU3luZGljYXRlTWVtYmVycywKICAgICAgICAgIHVpbnQyNTYgX3RvdGFsT3duZWRTaGFyZXMsCiAgICAgICAgICB1aW50MjU2IF9wcm9maXRQZXJTaGFyZQogICAgKTsKCiAgICBmdW5jdGlvbiBTeW5kaWNhdGUoKSBwdWJsaWMgewogICAgICAgIG1lbWJlcnNbbXNnLnNlbmRlcl0ubnVtU2hhcmVzID0gMTAwMDA7IC8vIG93bmVyIHBvcnRpb24KICAgICAgICBtZW1iZXJzW21zZy5zZW5kZXJdLnByb2ZpdFNoYXJlID0gMDsKICAgICAgICBudW1iZXJTeW5kaWNhdGVNZW1iZXJzID0gMTsKICAgICAgICBzeW5kaWNhdGVNZW1iZXJzLnB1c2gobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gc2hhcmVob2xkZXIgcHJvZml0IGNsYWltCiAgICBmdW5jdGlvbiBjbGFpbVByb2ZpdCgpIHB1YmxpYyB7CiAgICAgIGlmIChtZW1iZXJzW21zZy5zZW5kZXJdLm51bVNoYXJlcz09MCkgcmV2ZXJ0KCk7CiAgICAgIHVpbnQyNTYgcHJvZml0U2hhcmUgPSBtZW1iZXJzW21zZy5zZW5kZXJdLnByb2ZpdFNoYXJlOwogICAgICBpZiAocHJvZml0U2hhcmU+MCl7CiAgICAgICAgbWVtYmVyc1ttc2cuc2VuZGVyXS5wcm9maXRTaGFyZSA9IDA7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihwcm9maXRTaGFyZSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBwbGF5ZXIgcHJvZml0IGNsYWltCiAgICBmdW5jdGlvbiBjbGFpbVBsYXllclByb2ZpdCgpIHB1YmxpYyB7CiAgICAgIGlmIChhbGxQbGF5ZXJzW21zZy5zZW5kZXJdLnByb2ZpdFNoYXJlPT0wKSByZXZlcnQoKTsKICAgICAgdWludDI1NiBwcm9maXRTaGFyZSA9IGFsbFBsYXllcnNbbXNnLnNlbmRlcl0ucHJvZml0U2hhcmU7CiAgICAgIGlmIChwcm9maXRTaGFyZT4wKXsKICAgICAgICBhbGxQbGF5ZXJzW21zZy5zZW5kZXJdLnByb2ZpdFNoYXJlID0gMDsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHByb2ZpdFNoYXJlKTsKICAgICAgfQogICAgfQoKICAgIC8vIHBsYXllciB3aW5uaW5ncyBjbGFpbQogICAgZnVuY3Rpb24gY2xhaW1QbGF5ZXJXaW5uaW5ncygpIHB1YmxpYyB7CiAgICAgIGlmIChhbGxQbGF5ZXJzW21zZy5zZW5kZXJdLndpbm5pbmdzPT0wKSByZXZlcnQoKTsKICAgICAgdWludDI1NiB3aW5uaW5ncyA9IGFsbFBsYXllcnNbbXNnLnNlbmRlcl0ud2lubmluZ3M7CiAgICAgIGlmICh3aW5uaW5ncz4wKXsKICAgICAgICBhbGxQbGF5ZXJzW21zZy5zZW5kZXJdLndpbm5pbmdzID0gMDsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHdpbm5pbmdzKTsKICAgICAgfQogICAgfQoKICAgIC8vIGFsbG9jYXRlIHBsYXllciB3aW5uaW5ncwogICAgZnVuY3Rpb24gYWxsb2NhdGVXaW5uaW5ncyhhZGRyZXNzIF9wbGF5ZXJBZGRyZXNzLCB1aW50MjU2IHdpbm5pbmdzKSBpbnRlcm5hbCB7CiAgICAgIGFsbFBsYXllcnNbX3BsYXllckFkZHJlc3NdLndpbm5pbmdzKz13aW5uaW5nczsKICAgIH0KCiAgICAvLyB1dGlsaXR5IHRvIHJvdW5kIHRvIHRoZSBnYW1lIHByZWNpc2lvbgogICAgZnVuY3Rpb24gcm91bmRJdCh1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyByb3VuZCBkb3duIHRvIGNvcnJlY3QgcHJlaWNpc2lvbgogICAgICAgIHVpbnQyNTYgcmVzdWx0ID0gKGFtb3VudC9wcmVjaXNpb24pKnByZWNpc2lvbjsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8vIGRpc3RyaWJ1dGUgcHJvZml0IGFtb25nIHNoYXJlaG9sZGVycyBhbmQgcGxheWVycyBpbiB0b3AgMTAKICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVQcm9maXQoKSBpbnRlcm5hbCB7CgogICAgICB1aW50MjU2IHRvdGFsT3duZWRTaGFyZXMgPSB0b3RhbFN5bmRpY2F0ZVNoYXJlcy0ocGxheWVyc1NoYXJlQWxsb2NhdGlvbithdmFpbGFibGVCdXlJblNoYXJlcyk7CiAgICAgIHVpbnQyNTYgcHJvZml0UGVyU2hhcmUgPSByb3VuZEl0KFNhZmVNYXRoLmRpdihjdXJyZW50U3luZGljYXRlVmFsdWUsdG90YWxPd25lZFNoYXJlcykpOwoKICAgICAgaWYgKHByb2ZpdFBlclNoYXJlPjApewogICAgICAgICAgLy8gZm9yZWFjaCBtZW1iZXIgLCBjYWxjdWxhdGUgdGhlaXIgcHJvZml0c2hhcmUKICAgICAgICAgIGZvcih1aW50IGkgPSAwOyBpPCBudW1iZXJTeW5kaWNhdGVNZW1iZXJzOyBpKyspCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIGRvICs9IHNvIHRoYXQgYWNydWVzIGFjcm9zcyBzaGFyZSBjeWNsZXMuCiAgICAgICAgICAgIG1lbWJlcnNbc3luZGljYXRlTWVtYmVyc1tpXV0ucHJvZml0U2hhcmUrPVNhZmVNYXRoLm11bChtZW1iZXJzW3N5bmRpY2F0ZU1lbWJlcnNbaV1dLm51bVNoYXJlcyxwcm9maXRQZXJTaGFyZSk7CiAgICAgICAgICB9CiAgICAgIH0gLy8gZW5kIGlmIHByb2ZpdCBmb3Igc2hhcmUKCiAgICAgIHVpbnQyNTYgdG9wUGxheWVyRGlzdHJpYnV0YWJsZVByb2ZpdCA9ICBTYWZlTWF0aC5kaXYoY3VycmVudFN5bmRpY2F0ZVZhbHVlLDQpOyAvLyAyNSAlCiAgICAgIC8vIHBsYXllciBwcm9maXQgY2FsY3VsYXRpb24KICAgICAgdWludDI1NiBudW1iZXJPZlJlY2lwaWVudHMgPSBtaW4obnVtYmVyT2ZDeWNsZVBsYXllcnMsMTApOyAvLyBldmVuIHNwbGl0IGFtb25nIHRvcCBwbGF5ZXJzIGV2ZW4gaWYgPDEwCiAgICAgIHVpbnQyNTYgcHJvZml0UGVyVG9wUGxheWVyID0gcm91bmRJdChTYWZlTWF0aC5kaXYodG9wUGxheWVyRGlzdHJpYnV0YWJsZVByb2ZpdCxudW1iZXJPZlJlY2lwaWVudHMpKTsKCiAgICAgIGlmIChwcm9maXRQZXJUb3BQbGF5ZXI+MCl7CgogICAgICAgICAgLy8gYmVnaW4gc29ydGluZyB0aGUgY3ljbGUgcGxheWVycwogICAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBhcnIgPSBuZXcgYWRkcmVzc1tdKG51bWJlck9mQ3ljbGVQbGF5ZXJzKTsKCiAgICAgICAgICAvLyBjb3B5IHRoZSBhcnJheSB0byBpbiBtZW1vcnkgLSBkb24ndCBzb3J0IHRoZSBnbG9iYWwgdG9vIGV4cGVuc2l2ZQogICAgICAgICAgZm9yKGk9MDsgaTxudW1iZXJPZkN5Y2xlUGxheWVycyAmJiBpPG1heEN5Y2xlUGxheWVyc0NvbnNpZGVyZWQ7IGkrKykgewogICAgICAgICAgICBhcnJbaV0gPSBjeWNsZVBsYXllcnNbaV07CiAgICAgICAgICB9CiAgICAgICAgICBhZGRyZXNzIGtleTsKICAgICAgICAgIHVpbnQgajsKICAgICAgICAgIGZvcihpID0gMTsgaSA8IGFyci5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAga2V5ID0gYXJyW2ldOwoKICAgICAgICAgICAgZm9yKGogPSBpOyBqID4gMCAmJiBhbGxQbGF5ZXJzW2FycltqLTFdXS5wbGF5Q291bnQgPiBhbGxQbGF5ZXJzW2tleV0ucGxheUNvdW50OyBqLS0gKSB7CiAgICAgICAgICAgICAgYXJyW2pdID0gYXJyW2otMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJyW2pdID0ga2V5OwogICAgICAgICAgfSAgLy8gZW5kIHNvcnRpbmcgY3ljbGUgcGxheWVycwoKICAgICAgICAgIC8vYXJyIG5vdyBjb250YWlucyB0aGUgc29ydGVkIHNldCBvZiBhZGRyZXNzZXMgZm9yIGRpc3RyaWJ1dGlvbgoKICAgICAgICAgIC8vIGZvciBlYWNoIG9mIHRoZSB0b3AgMTAgcGxheWVycyBkaXN0cmlidXRlIHRoZWlyIHByb2ZpdC4KICAgICAgICAgIGZvcihpID0gMDsgaTwgbnVtYmVyT2ZSZWNpcGllbnRzOyBpKyspCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIGRvICs9IHNvIHRoYXQgYWNydWVzIGFjcm9zcyBzaGFyZSBjeWNsZXMgLSBpbiBjYXNlIHBsYXllciBwcm9maXQgaXMgbm90IGNsYWltZWQuCiAgICAgICAgICAgIGlmIChhcnJbaV0hPTApIHsgLy8gY2hlY2sgbm8gbnVsbCBhZGRyZXNzZXMKICAgICAgICAgICAgICBhbGxQbGF5ZXJzW2FycltpXV0ucHJvZml0U2hhcmUrPXByb2ZpdFBlclRvcFBsYXllcjsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBlbmQgZm9yIHJlY2VpcGllbnRzCgogICAgICB9IC8vIGVuZCBpZiBwcm9maXQgZm9yIHBsYXllcnMKCgogICAgICAvLyBlbWl0IGEgcHJvZml0IHNoYXJlIGV2ZW50CiAgICAgIFByb2ZpdFNoYXJlKGN1cnJlbnRTeW5kaWNhdGVWYWx1ZSwgbnVtYmVyU3luZGljYXRlTWVtYmVycywgdG90YWxPd25lZFNoYXJlcyAsIHByb2ZpdFBlclNoYXJlKTsKCiAgICAgIC8vIHJlc2V0IHRoZSBjeWNsZSB2YXJpYWJsZXMKICAgICAgbnVtYmVyT2ZDeWNsZVBsYXllcnM9MDsKICAgICAgY3VycmVudFN5bmRpY2F0ZVZhbHVlPTA7CiAgICAgIHNoYXJlQ3ljbGVJbmRleCA9IDE7CiAgICAgIHNoYXJlQ3ljbGUrKzsKICAgIH0KCiAgICAvLyB1cGRhdGVzIHRoZSBjb3VudCBmb3IgdGhpcyBwbGF5ZXIKICAgIGZ1bmN0aW9uIHVwZGF0ZVBsYXlDb3VudCgpIGludGVybmFsewogICAgICAvLyBmaXJzdCB0aW1lIHBsYXlpbmcgdGhpcyBzaGFyZSBjeWNsZT8KICAgICAgaWYoYWxsUGxheWVyc1ttc2cuc2VuZGVyXS5zaGFyZUN5Y2xlIT1zaGFyZUN5Y2xlKXsKICAgICAgICAgIGFsbFBsYXllcnNbbXNnLnNlbmRlcl0ucGxheUNvdW50PTA7CiAgICAgICAgICBhbGxQbGF5ZXJzW21zZy5zZW5kZXJdLnNoYXJlQ3ljbGU9c2hhcmVDeWNsZTsKICAgICAgICAgIGluc2VydEN5Y2xlUGxheWVyKCk7CiAgICAgIH0KICAgICAgICBhbGxQbGF5ZXJzW21zZy5zZW5kZXJdLnBsYXlDb3VudCsrOwogICAgICAgIC8vIG5vdGUgd2UgZG9uJ3QgdG91Y2ggcHJvZml0U2hhcmUgb3Igd2lubmluZ3MgYmVjYXVzZSB0aGV5IG5lZWQgdG8gcm9sbCBvdmVyIGN5Y2xlcyBpZiB1bmNsYWltZWQKICAgIH0KCiAgICAvLyBjb252ZW5pZW5jZSB0byBtYW5hZ2UgYSBncm93aW5nIGFycmF5CiAgICBmdW5jdGlvbiBpbnNlcnRDeWNsZVBsYXllcigpIGludGVybmFsIHsKICAgICAgICBpZihudW1iZXJPZkN5Y2xlUGxheWVycyA9PSBjeWNsZVBsYXllcnMubGVuZ3RoKSB7CiAgICAgICAgICAgIGN5Y2xlUGxheWVycy5sZW5ndGggKz0gMTsKICAgICAgICB9CiAgICAgICAgY3ljbGVQbGF5ZXJzW251bWJlck9mQ3ljbGVQbGF5ZXJzKytdID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLyBhZGQgbmV3IG1lbWJlciBvZiBzeW5kaWNhdGUKICAgIGZ1bmN0aW9uIGFkZE1lbWJlcihhZGRyZXNzIF9tZW1iZXJBZGRyZXNzKSBpbnRlcm5hbCB7CiAgICAgICBpZiAobWVtYmVyc1tfbWVtYmVyQWRkcmVzc10ubnVtU2hhcmVzID09IDApewogICAgICAgICAgICAgIHN5bmRpY2F0ZU1lbWJlcnMucHVzaChfbWVtYmVyQWRkcmVzcyk7CiAgICAgICAgICAgICAgbnVtYmVyU3luZGljYXRlTWVtYmVycysrOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBidXkgaW50byBzeW5kaWNhdGUKICAgIGZ1bmN0aW9uIGJ1eUludG9TeW5kaWNhdGUoKSBwdWJsaWMgcGF5YWJsZSAgewogICAgICAgIGlmKG1zZy52YWx1ZT09MCB8fCBhdmFpbGFibGVCdXlJblNoYXJlcz09MCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYobXNnLnZhbHVlIDwgbWluaW11bUJ1eUluKmJ1eUluU2hhcmVQcmljZSkgcmV2ZXJ0KCk7CgogICAgICAgIHVpbnQyNTYgdmFsdWUgPSAobXNnLnZhbHVlL3ByZWNpc2lvbikqcHJlY2lzaW9uOyAvLyBlbnN1cmUgcHJlY2lzaW9uCiAgICAgICAgdWludDI1NiBhbGxvY2F0aW9uID0gdmFsdWUvYnV5SW5TaGFyZVByaWNlOwoKICAgICAgICBpZiAoYWxsb2NhdGlvbiA+PSBhdmFpbGFibGVCdXlJblNoYXJlcyl7CiAgICAgICAgICAgIGFsbG9jYXRpb24gPSBhdmFpbGFibGVCdXlJblNoYXJlczsgLy8gbGltaXQgaGl0CiAgICAgICAgfQogICAgICAgIGF2YWlsYWJsZUJ1eUluU2hhcmVzLT1hbGxvY2F0aW9uOwogICAgICAgIGFkZE1lbWJlcihtc2cuc2VuZGVyKTsgLy8gcG9zc2libHkgYWRkIHRoaXMgbWVtYmVyIHRvIHRoZSBzeW5kaWNhdGUKICAgICAgICBtZW1iZXJzW21zZy5zZW5kZXJdLm51bVNoYXJlcys9YWxsb2NhdGlvbjsKICAgIH0KCiAgICAvLyBob3cgbWFueSBzaGFyZXM/CiAgICBmdW5jdGlvbiBtZW1iZXJTaGFyZUNvdW50KCkgcHVibGljICB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbWVtYmVyc1ttc2cuc2VuZGVyXS5udW1TaGFyZXM7CiAgICB9CgogICAgLy8gaG93IG11Y2ggcHJvZml0PwogICAgZnVuY3Rpb24gbWVtYmVyUHJvZml0U2hhcmUoKSBwdWJsaWMgIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBtZW1iZXJzW21zZy5zZW5kZXJdLnByb2ZpdFNoYXJlOwogICAgfQoKICAgIC8vIEZvciBwcmV2aW91cyBjb250cmlidXRvcnMgdG8gaGVkZ2VseSB2MC4xCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVNoYXJlcyh1aW50MjU2IGFsbG9jYXRpb24sIGFkZHJlc3Mgc3Rha2Vob2xkZXJBZGRyZXNzKSAgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGFsbG9jYXRpb24gPiBhdmFpbGFibGVCdXlJblNoYXJlcykgcmV2ZXJ0KCk7CiAgICAgICAgYXZhaWxhYmxlQnV5SW5TaGFyZXMtPWFsbG9jYXRpb247CiAgICAgICAgYWRkTWVtYmVyKHN0YWtlaG9sZGVyQWRkcmVzcyk7IC8vIHBvc3NpYmx5IGFkZCB0aGlzIG1lbWJlciB0byB0aGUgc3luZGljYXRlCiAgICAgICAgbWVtYmVyc1tzdGFrZWhvbGRlckFkZHJlc3NdLm51bVNoYXJlcys9YWxsb2NhdGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRTaGFyZUN5Y2xlU2Vzc2lvblNpemUgKHVpbnQyNTYgc2l6ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc2hhcmVDeWNsZVNlc3Npb25TaXplID0gc2l6ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRNYXhDeWNsZVBsYXllcnNDb25zaWRlcmVkICh1aW50MjU2IG51bVBsYXllcnNDb25zaWRlcmVkKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBtYXhDeWNsZVBsYXllcnNDb25zaWRlcmVkID0gbnVtUGxheWVyc0NvbnNpZGVyZWQ7CiAgICB9CgogICAgLy8gcmV0dXJucyB0aGUgc3RhdHVzIG9mIHRoZSBwbGF5ZXIKICAgIC8vIG5vdGUgaWYgdGhlIHBsYXllciBzaGFyZSBjeWNsZSE9c2hhcmVDeWNsZSwgdGhlbiB0aGUgcGxheUNvdW50IGlzIHN0YWxlIC0gc28gcmV0dXJuIHplcm8gd2l0aG91dCBzZXR0aW5nIGl0CiAgICBmdW5jdGlvbiBwbGF5ZXJTdGF0dXMoYWRkcmVzcyBfcGxheWVyQWRkcmVzcykgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NikgewogICAgICAgICB1aW50MjU2IHBsYXlDb3VudCA9IGFsbFBsYXllcnNbX3BsYXllckFkZHJlc3NdLnBsYXlDb3VudDsKICAgICAgICAgaWYgKGFsbFBsYXllcnNbX3BsYXllckFkZHJlc3NdLnNoYXJlQ3ljbGUhPXNoYXJlQ3ljbGUpe3BsYXlDb3VudD0wO30KICAgICAgICByZXR1cm4gKHBsYXlDb3VudCwgYWxsUGxheWVyc1tfcGxheWVyQWRkcmVzc10uc2hhcmVDeWNsZSwgYWxsUGxheWVyc1tfcGxheWVyQWRkcmVzc10ucHJvZml0U2hhcmUgLCBhbGxQbGF5ZXJzW19wbGF5ZXJBZGRyZXNzXS53aW5uaW5ncyk7CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBwcml2YXRlIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKfQoKCi8qKgogKiBDb3JlIEhlZGdlbHkgQ29udHJhY3QKICovCmNvbnRyYWN0IEhlZGdlbHkgaXMgT3duYWJsZSwgU3luZGljYXRlIHsKCiAgIC8vIEFycmF5IG9mIHBsYXllcnMKICAgYWRkcmVzc1tdIHByaXZhdGUgcGxheWVyczsKICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgYWN0aXZlUGxheWVyczsKICAgdWludDI1NiBudW1QbGF5ZXJzID0gMDsKCiAgIC8vIG1hcCBlYWNoIHBsYXllciBhZGRyZXNzIHRvIHRoZWlyIHBvcnRmb2xpbyBvZiBpbnZlc3RtZW50cwogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NiBbMTBdICkgcHJpdmF0ZSBwbGF5ZXJQb3J0Zm9saW87CgogICB1aW50MjU2WzEwXSBwcml2YXRlIG1hcmtldE9wdGlvbnM7CgogICAvLyBUaGUgdG90YWwgYW1vdW50IG9mIEV0aGVyIGJldCBmb3IgdGhpcyBjdXJyZW50IG1hcmtldAogICB1aW50MjU2IHB1YmxpYyB0b3RhbEludmVzdGVkOwogICAvLyBUaGUgYW1vdW50IG9mIEV0aGVyIHVzZWQgdG8gc2VlIHRoZSBtYXJrZXQKICAgdWludDI1NiBwcml2YXRlIHNlZWRJbnZlc3RtZW50OwoKICAgLy8gVGhlIHRvdGFsIG51bWJlciBvZiBpbnZlc3RtZW50cyB0aGUgdXNlcnMgaGF2ZSBtYWRlCiAgIHVpbnQyNTYgcHVibGljIG51bWJlck9mSW52ZXN0bWVudHM7CgogICAvLyBUaGUgbnVtYmVyIHRoYXQgd29uIHRoZSBsYXN0IGdhbWUKICAgdWludDI1NiBwdWJsaWMgbnVtYmVyV2lubmVyOwoKICAgLy8gY3VycmVudCBzZXNzaW9uIGluZm9ybWF0aW9uCiAgIHVpbnQyNTYgcHVibGljIHN0YXJ0aW5nQmxvY2s7CiAgIHVpbnQyNTYgcHVibGljIGVuZGluZ0Jsb2NrOwogICB1aW50MjU2IHB1YmxpYyBzZXNzaW9uQmxvY2tTaXplOwogICB1aW50MjU2IHB1YmxpYyBzZXNzaW9uTnVtYmVyOwogICB1aW50MjU2IHB1YmxpYyBjdXJyZW50TG93ZXN0OwogICB1aW50MjU2IHB1YmxpYyBjdXJyZW50TG93ZXN0Q291bnQ7IC8vIHNob3VsZCBjb3VudCB0aGUgbnVtYmVyIG9mIGN1cnJlbnRMb3dlc3QgdG8gcHJldmVudCBhIHRpZQoKICAgdWludDI1NiBwdWJsaWMgcHJlY2lzaW9uID0gMTAwMDAwMDAwMDAwMDAwMDsgLy8gcm91bmRpbmcgdG8gdGhpcyB3aWxsIGtlZXAgaXQgdG8gMSBmaW5uZXkgcmVzb2x1dGlvbgogICB1aW50MjU2IHB1YmxpYyBtaW5pbXVtU3Rha2UgPSAxIGZpbm5leTsKCiAgIHVpbnQyNTYgcHVibGljIHdpbm5pbmdNdWx0aXBsaWVyOyAvLyB3aGF0IHRoaXMgc2Vzc2lvbiB3aWxsIHlpZWxkIDV4IC0gOHgKCgogICAgIGV2ZW50IEludmVzdCgKICAgICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgICAgIHVpbnQyNTYgX29wdGlvbiwKICAgICAgICAgICB1aW50MjU2IF92YWx1ZSwKICAgICAgICAgICB1aW50MjU2WzEwXSBfbWFya2V0T3B0aW9ucywKICAgICAgICAgICB1aW50IF9ibG9ja051bWJlcgogICAgICk7CgogICAgIGV2ZW50IFdpbm5pbmcoCiAgICAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgICAgdWludDI1NiBfYW1vdW50LAogICAgICAgICAgIHVpbnQyNTYgX3Nlc3Npb24sCiAgICAgICAgICAgdWludDI1NiBfd2lubmluZ09wdGlvbiwKICAgICAgICAgICB1aW50IF9ibG9ja051bWJlcgogICAgICk7CgogICAgIGV2ZW50IEVuZFNlc3Npb24oCiAgICAgICAgICAgYWRkcmVzcyBfc2Vzc2lvbkVuZGVyLAogICAgICAgICAgIHVpbnQyNTYgX3Nlc3Npb25OdW1iZXIsCiAgICAgICAgICAgdWludDI1NiBfd2lubmluZ09wdGlvbiwKICAgICAgICAgICB1aW50MjU2WzEwXSBfbWFya2V0T3B0aW9ucywKICAgICAgICAgICB1aW50MjU2IF9ibG9ja051bWJlcgogICAgICk7CgogICAgIGV2ZW50IFN0YXJ0U2Vzc2lvbigKICAgICAgICAgICB1aW50MjU2IF9zZXNzaW9uTnVtYmVyLAogICAgICAgICAgIHVpbnQyNTYgX3Nlc3Npb25CbG9ja1NpemUsCiAgICAgICAgICAgdWludDI1NlsxMF0gX21hcmtldE9wdGlvbnMsCiAgICAgICAgICAgdWludDI1NiBfYmxvY2tOdW1iZXIKICAgICApOwoKCiAgIGZ1bmN0aW9uIEhlZGdlbHkoKSBwdWJsaWMgewogICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICBzZXNzaW9uQmxvY2tTaXplID0gMTAwOwogICAgIHNlc3Npb25OdW1iZXIgPSAwOwogICAgIG51bVBsYXllcnMgPSAwOwogICAgIHJlc2V0TWFya2V0KCk7CiAgIH0KCiAgICAvLyB0aGUgZnVsbCBhbW91bnQgaW52ZXN0ZWQgaW4gZWFjaCBvcHRpb24KICAgZnVuY3Rpb24gZ2V0TWFya2V0T3B0aW9ucygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2WzEwXSkKICAgIHsKICAgICAgICByZXR1cm4gbWFya2V0T3B0aW9uczsKICAgIH0KCiAgICAvLyBlYWNoIHBsYXllciBjYW4gZ2V0IHRoZWlyIG93biBwb3J0Zm9saW8KICAgZnVuY3Rpb24gZ2V0UGxheWVyUG9ydGZvbGlvKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbMTBdKQogICAgewogICAgICAgIHJldHVybiBwbGF5ZXJQb3J0Zm9saW9bbXNnLnNlbmRlcl07CiAgICB9CgogICAgLy8gdGhlIG51bWJlciBvZiBpbnZlc3RvcnMgdGhpcyBzZXNzaW9uCiAgICBmdW5jdGlvbiBudW1iZXJPZkludmVzdG9ycygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgY291bnQpIHsKICAgICAgICByZXR1cm4gbnVtUGxheWVyczsKICAgIH0KCgogICAgLy8gcHNldWRvIHJhbmRvbSAtIGJ1dCBkb2VzIHRoYXQgbWF0dGVyPwogICAgdWludDY0IF9zZWVkID0gMDsKICAgIGZ1bmN0aW9uIHJhbmRvbSh1aW50NjQgdXBwZXIpIHByaXZhdGUgcmV0dXJucyAodWludDY0IHJhbmRvbU51bWJlcikgewogICAgICAgX3NlZWQgPSB1aW50NjQoa2VjY2FrMjU2KGtlY2NhazI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyKSwgX3NlZWQpLCBub3cpKTsKICAgICAgIHJldHVybiBfc2VlZCAlIHVwcGVyOwogICAgIH0KCiAgICAvLyByZXNldHMgdGhlIG1hcmtldCBjb25kaXRpb25zCiAgIGZ1bmN0aW9uIHJlc2V0TWFya2V0KCkgaW50ZXJuYWwgewoKICAgICAvLyBjaGVjayBpZiBzaGFyZSBjeWNsZSBpcyBjb21wbGV0ZSBhbmQgaWYgcmVxdWlyZWQgZGlzdHJpYnV0ZSBwcm9maXRzCiAgICAgc2hhcmVDeWNsZUluZGV4Kz0xOwogICAgIGlmIChzaGFyZUN5Y2xlSW5kZXggPiBzaGFyZUN5Y2xlU2Vzc2lvblNpemUpewogICAgICAgZGlzdHJpYnV0ZVByb2ZpdCgpOwogICAgIH0KCiAgICBzZXNzaW9uTnVtYmVyICsrOwogICAgd2lubmluZ011bHRpcGxpZXIgPSByYW5kb20oMykrNjsgLy8gcmFuZG9tIGJldHdlZW4gNi04IGIpIFByb3Bvc2FsIGNoYW5nZQogICAgc3RhcnRpbmdCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIGVuZGluZ0Jsb2NrID0gc3RhcnRpbmdCbG9jayArIHNlc3Npb25CbG9ja1NpemU7IC8vIGFwcHJveGltYXRlbHkgZXZlcnkgNSBtaW51dGVzIC0gY2FuIHBsYXkgd2l0aCB0aGlzCiAgICBudW1QbGF5ZXJzID0gMDsKCiAgICAvLyByYW5kb21pemUgdGhlIGluaXRpYWwgbWFya2V0IHZhbHVlcwogICAgdWludDI1NiBzdW1JbnZlc3RlZCA9IDA7CiAgICB1aW50MjU2WzEwXSBtZW1vcnkgc3RhcnRpbmdPcHRpb25zOwoKICAgIC8vIHBsYXllciB2cyBwbGF5ZXIgb3B0aW1pemVkIHNlZWRzCiAgICAvLyBhbnRlIHVwIHNsb3RzCiAgICBzdGFydGluZ09wdGlvbnNbMF09MDsKICAgIHN0YXJ0aW5nT3B0aW9uc1sxXT0wOwogICAgc3RhcnRpbmdPcHRpb25zWzJdPTA7CiAgICBzdGFydGluZ09wdGlvbnNbM109cHJlY2lzaW9uKihyYW5kb20oMikpOyAvLyBiZXR3ZWVuIDAgYW5kIDEKICAgIHN0YXJ0aW5nT3B0aW9uc1s0XT1wcmVjaXNpb24qKHJhbmRvbSgzKSk7IC8vIGJldHdlZW4gMCBhbmQgMgogICAgc3RhcnRpbmdPcHRpb25zWzVdPXByZWNpc2lvbioocmFuZG9tKDMpKzEpOyAvLyBiZXR3ZWVuIDEgYW5kIDMKICAgIHN0YXJ0aW5nT3B0aW9uc1s2XT1wcmVjaXNpb24qKHJhbmRvbSgyKSszKTsgLy8gYmV0d2VlbiAzIGFuZCA0CiAgICBzdGFydGluZ09wdGlvbnNbN109cHJlY2lzaW9uKihyYW5kb20oMikrMyk7IC8vIGJldHdlZW4gMyBhbmQgNAogICAgc3RhcnRpbmdPcHRpb25zWzhdPXByZWNpc2lvbioocmFuZG9tKDQpKzUpOyAvLyBiZXR3ZWVuIDUgYW5kIDgKICAgIHN0YXJ0aW5nT3B0aW9uc1s5XT1wcmVjaXNpb24qKHJhbmRvbSg0KSs1KTsgLy8gYmV0d2VlbiA1IGFuZCA4CgogICAgLy8gc2h1ZmZsZSB0aGUgZGVjawoKICAgICAgdWludDY0IGN1cnJlbnRJbmRleCA9IHVpbnQ2NChtYXJrZXRPcHRpb25zLmxlbmd0aCk7CiAgICAgIHVpbnQyNTYgdGVtcG9yYXJ5VmFsdWU7CiAgICAgIHVpbnQ2NCByYW5kb21JbmRleDsKCiAgICAgIC8vIFdoaWxlIHRoZXJlIHJlbWFpbiBlbGVtZW50cyB0byBzaHVmZmxlLi4uCiAgICAgIHdoaWxlICgwICE9IGN1cnJlbnRJbmRleCkgewoKICAgICAgICAvLyBQaWNrIGEgcmVtYWluaW5nIGVsZW1lbnQuLi4KICAgICAgICByYW5kb21JbmRleCA9IHJhbmRvbShjdXJyZW50SW5kZXgpOwogICAgICAgIGN1cnJlbnRJbmRleCAtPSAxOwoKICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuCiAgICAgICAgdGVtcG9yYXJ5VmFsdWUgPSBzdGFydGluZ09wdGlvbnNbY3VycmVudEluZGV4XTsKICAgICAgICBzdGFydGluZ09wdGlvbnNbY3VycmVudEluZGV4XSA9IHN0YXJ0aW5nT3B0aW9uc1tyYW5kb21JbmRleF07CiAgICAgICAgc3RhcnRpbmdPcHRpb25zW3JhbmRvbUluZGV4XSA9IHRlbXBvcmFyeVZhbHVlOwogICAgICB9CgogICAgIG1hcmtldE9wdGlvbnMgPSBzdGFydGluZ09wdGlvbnM7CiAgICAgcGxheWVyUG9ydGZvbGlvW3RoaXNdID0gbWFya2V0T3B0aW9uczsKICAgICB0b3RhbEludmVzdGVkID0gIHN1bUludmVzdGVkOwogICAgIHNlZWRJbnZlc3RtZW50ID0gc3VtSW52ZXN0ZWQ7CiAgICAgaW5zZXJ0UGxheWVyKHRoaXMpOwogICAgIG51bVBsYXllcnM9MTsKICAgICBudW1iZXJPZkludmVzdG1lbnRzID0gMTA7CgogICAgIGN1cnJlbnRMb3dlc3QgPSBmaW5kQ3VycmVudExvd2VzdCgpOwogICAgIFN0YXJ0U2Vzc2lvbihzZXNzaW9uTnVtYmVyLCBzZXNzaW9uQmxvY2tTaXplLCBtYXJrZXRPcHRpb25zICwgc3RhcnRpbmdCbG9jayk7CgogICB9CgoKICAgIC8vIG1haW4gZW50cnkgcG9pbnQgZm9yIGludmVzdG9ycy9wbGF5ZXJzCiAgICBmdW5jdGlvbiBpbnZlc3QodWludDI1NiBvcHRpb25OdW1iZXIpIHB1YmxpYyBwYXlhYmxlIHsKCiAgICAgIC8vIENoZWNrIHRoYXQgdGhlIG51bWJlciBpcyB3aXRoaW4gdGhlIHJhbmdlICh1aW50cyBhcmUgYWx3YXlzPj0wIGFueXdheSkKICAgICAgYXNzZXJ0KG9wdGlvbk51bWJlciA8PSA5KTsKICAgICAgdWludDI1NiBhbW91bnQgPSByb3VuZEl0KG1zZy52YWx1ZSk7IC8vIHJvdW5kIHRvIHByZWNpc2lvbgogICAgICBhc3NlcnQoYW1vdW50ID49IG1pbmltdW1TdGFrZSk7CgogICAgICAgLy8gY2hlY2sgZm9yIHplcm8gdGllLWJyZWFrZXIgdHJhbnNhY3Rpb24KICAgICAgIC8vIGluIHRoaXMgY2FzZSBub2JvZHkgd2lucyBhbmQgaW52ZXN0bWVudCBnb2VzIGludG8gbmV4dCBzZXNzaW9uLgogICAgICBpZiAoYmxvY2subnVtYmVyID49IGVuZGluZ0Jsb2NrICYmIGN1cnJlbnRMb3dlc3RDb3VudD4xICYmIG1hcmtldE9wdGlvbnNbY3VycmVudExvd2VzdF09PTApewogICAgICAgIGVuZFNlc3Npb24oKTsKICAgICAgICAvLyBhdXRvIGludmVzdCB0aGVtIGluIHRoZSBsb3dlc3QgbWFya2V0IG9wdGlvbiAgLSByZXdhcmQgZm9yCiAgICAgICAgb3B0aW9uTnVtYmVyID0gY3VycmVudExvd2VzdDsKICAgICAgfQoKICAgICAgdWludDI1NiBob2xkaW5nID0gcGxheWVyUG9ydGZvbGlvW21zZy5zZW5kZXJdW29wdGlvbk51bWJlcl07CiAgICAgIGhvbGRpbmcgPSBTYWZlTWF0aC5hZGQoaG9sZGluZywgYW1vdW50KTsKICAgICAgcGxheWVyUG9ydGZvbGlvW21zZy5zZW5kZXJdW29wdGlvbk51bWJlcl0gPSBob2xkaW5nOwoKICAgICAgbWFya2V0T3B0aW9uc1tvcHRpb25OdW1iZXJdID0gU2FmZU1hdGguYWRkKG1hcmtldE9wdGlvbnNbb3B0aW9uTnVtYmVyXSxhbW91bnQpOwoKICAgICAgbnVtYmVyT2ZJbnZlc3RtZW50cyArPSAxOwogICAgICB0b3RhbEludmVzdGVkICs9IGFtb3VudDsKICAgICAgaWYgKCFhY3RpdmVQbGF5ZXJzW21zZy5zZW5kZXJdKXsKICAgICAgICAgICAgICAgICAgICBpbnNlcnRQbGF5ZXIobXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICAgICAgYWN0aXZlUGxheWVyc1ttc2cuc2VuZGVyXT10cnVlOwogICAgICAgfQoKICAgICAgSW52ZXN0KG1zZy5zZW5kZXIsIG9wdGlvbk51bWJlciwgYW1vdW50LCBtYXJrZXRPcHRpb25zLCBibG9jay5udW1iZXIpOwogICAgICB1cGRhdGVQbGF5Q291bnQoKTsgLy8gcmFuayB0aGUgcGxheWVyIGluIGxlYWRlcmJvYXJkCiAgICAgIGN1cnJlbnRMb3dlc3QgPSBmaW5kQ3VycmVudExvd2VzdCgpOwoKICAgICAgLy8gb3ZlcnRpbWUgYW5kIHRoZXJlJ3MgYSB3aW5uZXIKICAgICAgaWYgKGJsb2NrLm51bWJlciA+PSBlbmRpbmdCbG9jayAmJiBjdXJyZW50TG93ZXN0Q291bnQ9PTEpewogICAgICAgICAgLy8gc29tZWJvZHkgd2lucyBoZXJlLgogICAgICAgICAgZW5kU2Vzc2lvbigpOwogICAgICB9CgogICAgfSAvLyBlbmQgaW52ZXN0CgoKICAgIC8vIGZpbmQgbG93ZXN0IG9wdGlvbiBzZXRzIGN1cnJlbnRMb3dlc3RDb3VudD4xIGlmIHRoZXJlIGFyZSBtb3JlIHRoYW4gMSBsb3dlc3QKICAgIGZ1bmN0aW9uIGZpbmRDdXJyZW50TG93ZXN0KCkgaW50ZXJuYWwgcmV0dXJucyAodWludCBsb3dlc3RPcHRpb24pIHsKCiAgICAgIHVpbnQgd2lubmVyID0gMDsKICAgICAgdWludCBsb3dlc3RUb3RhbCA9IG1hcmtldE9wdGlvbnNbMF07CiAgICAgIGN1cnJlbnRMb3dlc3RDb3VudCA9IDA7CiAgICAgIGZvcih1aW50IGk9MDtpPDEwO2krKykKICAgICAgewogICAgICAgICAgaWYgKG1hcmtldE9wdGlvbnMgW2ldPGxvd2VzdFRvdGFsKXsKICAgICAgICAgICAgICB3aW5uZXIgPSBpOwogICAgICAgICAgICAgIGxvd2VzdFRvdGFsID0gbWFya2V0T3B0aW9ucyBbaV07CiAgICAgICAgICAgICAgY3VycmVudExvd2VzdENvdW50ID0gMDsKICAgICAgICAgIH0KICAgICAgICAgaWYgKG1hcmtldE9wdGlvbnMgW2ldPT1sb3dlc3RUb3RhbCl7Y3VycmVudExvd2VzdENvdW50Kz0xO30KICAgICAgfQogICAgICByZXR1cm4gd2lubmVyOwogICAgfQoKICAgIC8vIGRpc3RyaWJ1dGUgd2lubmluZ3MgYXQgdGhlIGVuZCBvZiBhIHNlc3Npb24KICAgIGZ1bmN0aW9uIGVuZFNlc3Npb24oKSBpbnRlcm5hbCB7CgogICAgICB1aW50MjU2IHNlc3Npb25XaW5uaW5ncyA9IDA7CiAgICAgIGlmIChjdXJyZW50TG93ZXN0Q291bnQ+MSl7CiAgICAgICAgbnVtYmVyV2lubmVyID0gMTA7IC8vIG5vIHdpbm5lcgogICAgICB9ZWxzZXsKICAgICAgICBudW1iZXJXaW5uZXIgPSBjdXJyZW50TG93ZXN0OwogICAgICB9CgogICAgICAvLyByZWNvcmQgdGhlIGVuZCBvZiBzZXNzaW9uCiAgICAgIGZvcih1aW50IGo9MTtqPG51bVBsYXllcnM7aisrKQogICAgICB7CiAgICAgICAgaWYgKG51bWJlcldpbm5lcjwxMCAmJiBwbGF5ZXJQb3J0Zm9saW9bcGxheWVyc1tqXV1bbnVtYmVyV2lubmVyXT4wKXsKICAgICAgICAgIHVpbnQyNTYgd2lubmluZ0Ftb3VudCA9ICBwbGF5ZXJQb3J0Zm9saW9bcGxheWVyc1tqXV1bbnVtYmVyV2lubmVyXTsKICAgICAgICAgIHVpbnQyNTYgd2lubmluZ3MgPSBTYWZlTWF0aC5tdWwod2lubmluZ011bHRpcGxpZXIsd2lubmluZ0Ftb3VudCk7IC8vIG4gdGltZXMgdGhlIGludmVzdGVkIGFtb3VudC4KICAgICAgICAgIHNlc3Npb25XaW5uaW5ncys9d2lubmluZ3M7CgogICAgICAgICAgYWxsb2NhdGVXaW5uaW5ncyhwbGF5ZXJzW2pdLHdpbm5pbmdzKTsgLy8gYWxsb2NhdGUgd2lubmluZ3MKCiAgICAgICAgICBXaW5uaW5nKHBsYXllcnNbal0sIHdpbm5pbmdzLCBzZXNzaW9uTnVtYmVyLCBudW1iZXJXaW5uZXIsYmxvY2subnVtYmVyKTsgLy8gd2UgY2FuIHBpY2sgdGhpcyB1cCBvbiBndWkKICAgICAgICB9CiAgICAgICAgcGxheWVyUG9ydGZvbGlvW3BsYXllcnNbal1dID0gWzAsMCwwLDAsMCwwLDAsMCwwLDBdOwogICAgICAgIGFjdGl2ZVBsYXllcnNbcGxheWVyc1tqXV09ZmFsc2U7CiAgICAgIH0KCiAgICAgIEVuZFNlc3Npb24obXNnLnNlbmRlciwgc2Vzc2lvbk51bWJlciwgbnVtYmVyV2lubmVyLCBtYXJrZXRPcHRpb25zICwgYmxvY2subnVtYmVyKTsKCiAgICAgIHVpbnQyNTYgcGxheWVySW52ZXN0bWVudHMgPSB0b3RhbEludmVzdGVkLXNlZWRJbnZlc3RtZW50OwoKICAgICAgaWYgKHNlc3Npb25XaW5uaW5ncz5wbGF5ZXJJbnZlc3RtZW50cyl7CiAgICAgICAgdWludDI1NiBsb3NzID0gc2Vzc2lvbldpbm5pbmdzLXBsYXllckludmVzdG1lbnRzOyAvLyB0aGlzIGlzIGEgbG9zcwogICAgICAgIGlmIChjdXJyZW50U3luZGljYXRlVmFsdWU+PWxvc3MpewogICAgICAgICAgY3VycmVudFN5bmRpY2F0ZVZhbHVlLT1sb3NzOwogICAgICAgIH1lbHNlewogICAgICAgICAgY3VycmVudFN5bmRpY2F0ZVZhbHVlID0gMDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChwbGF5ZXJJbnZlc3RtZW50cz5zZXNzaW9uV2lubmluZ3MpewogICAgICAgIGN1cnJlbnRTeW5kaWNhdGVWYWx1ZSs9cGxheWVySW52ZXN0bWVudHMtc2Vzc2lvbldpbm5pbmdzOyAvLyB0aGlzIGlzIGEgZ2FpbgogICAgICB9CiAgICAgIHJlc2V0TWFya2V0KCk7CiAgICB9IC8vIGVuZCBzZXNzaW9uCgoKICAgIC8vIGNvbnZlbmllbmNlIHRvIG1hbmFnZSBhIGdyb3dpbmcgYXJyYXkKICAgIGZ1bmN0aW9uIGluc2VydFBsYXllcihhZGRyZXNzIHZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgaWYobnVtUGxheWVycyA9PSBwbGF5ZXJzLmxlbmd0aCkgewogICAgICAgICAgICBwbGF5ZXJzLmxlbmd0aCArPSAxOwogICAgICAgIH0KICAgICAgICBwbGF5ZXJzW251bVBsYXllcnMrK10gPSB2YWx1ZTsKICAgIH0KCgogICAgLy8gLS0tLS0gYWRtaW4gZnVuY3Rpb25zIGluIGV2ZW50IG9mIGFuIGlzc3VlIC0tCiAgICBmdW5jdGlvbiBzZXRTZXNzaW9uQmxvY2tTaXplICh1aW50MjU2IGJsb2NrQ291bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHNlc3Npb25CbG9ja1NpemUgPSBibG9ja0NvdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKGFtb3VudDw9dGhpcy5iYWxhbmNlKTsKICAgICAgICBpZiAoYW1vdW50PT0wKXsKICAgICAgICAgICAgYW1vdW50PXRoaXMuYmFsYW5jZTsKICAgICAgICB9CiAgICAgICAgb3duZXIudHJhbnNmZXIoYW1vdW50KTsKICAgIH0KCiAgIC8vIEluIHRoZSBldmVudCBvZiBjYXRhc3Ryb3BoZQogICAgZnVuY3Rpb24ga2lsbCgpICBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICAgaWYobXNnLnNlbmRlciA9PSBvd25lcikKICAgICAgICAgICAgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgIH0KCiAgICAvLyBkb25hdGlvbnMsIGZ1bmRpbmcsIHJlcGxlbmlzaAogICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUge30KCn0KCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9'.
	

]
