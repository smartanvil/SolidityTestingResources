Class {
	#name : #SRT17e2c574cf092950ef89fb4939c97db2086e796f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT17e2c574cf092950ef89fb4939c97db2086e796f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICoKICogQHRpdGxlIE1jRmx5LmFlcm8gLSBtYWluIGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE4IE1jRmx5LmFlcm8KICogQGF1dGhvciBEbWl0cml5IEtoaXpoaW5za2l5CiAqIEBhdXRob3IgIk1JVCIKICoKICovIAoKLyoqCiAqIEB0aXRsZSBFUkMyMCBCYXNpYyBzbWFydCBjb250cmFjdAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogQGF1dGhvciAiTWFudWVsIEFyYW96IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijk3ZmFmNmY5ZTJmMmZiZjZlNWY2ZjhlZGQ3ZjBmYWY2ZmVmYmI5ZjRmOGZhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4iCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqIEBkZXYgbGljZW5zZTogIk1JVCIsIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBAYXV0aG9yIG1vZGlmaWNhdGlvbjogRG1pdHJpeSBLaGl6aGluc2tpeSBATWNGbHkuYWVybwogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIE93bmFibGUgc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTYgU21hcnQgQ29udHJhY3QgU29sdXRpb25zLCBJbmMuCiAqIEBhdXRob3IgIk1hbnVlbCBBcmFveiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmZjkyOWU5MThhOWE5MzllOGQ5ZTkwODViZjk4OTI5ZTk2OTNkMTljOTA5MiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+IgogKiBAZGV2IGxpY2Vuc2U6ICJNSVQiLCBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogQGF1dGhvciBtb2RpZmljYXRpb246IERtaXRyaXkgS2hpemhpbnNraXkgQE1jRmx5LmFlcm8KICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIGNhbmRpZGF0ZTsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgICAvKioKICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAqIGFjY291bnQuCiAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBfcmVxdWVzdF8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICovCiAgICBmdW5jdGlvbiByZXF1ZXN0T3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY2FuZGlkYXRlID0gbmV3T3duZXI7CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgX05FV18gY2FuZGlkYXRlIHRvIGNvbXBsZXRlIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGhpbS4KICAgICovCiAgICBmdW5jdGlvbiBjb25maXJtT3duZXJzaGlwKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBvd25lciA9IGNhbmRpZGF0ZTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgY2FuZGlkYXRlKTsgICAgICAgIAogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBNdWx0aU93bmVycyBzbWFydCBjb250cmFjdAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxOCBNY0ZseS5hZXJvCiAqIEBhdXRob3IgRG1pdHJpeSBLaGl6aGluc2tpeQogKiBAYXV0aG9yICJNSVQiCiAqLwpjb250cmFjdCBNdWx0aU93bmVycyB7CgogICAgZXZlbnQgQWNjZXNzR3JhbnQoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IEFjY2Vzc1Jldm9rZShhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgb3duZXJzOwogICAgYWRkcmVzcyBwdWJsaWMgcHVibGlzaGVyOwoKCiAgICBmdW5jdGlvbiBNdWx0aU93bmVycygpIHB1YmxpYyB7CiAgICAgICAgb3duZXJzW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBwdWJsaXNoZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7IAogICAgICAgIHJlcXVpcmUob3duZXJzW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87IAogICAgfQoKCiAgICBmdW5jdGlvbiBpc093bmVyKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gb3duZXJzW21zZy5zZW5kZXJdID8gdHJ1ZSA6IGZhbHNlOwogICAgfQoKCiAgICBmdW5jdGlvbiBjaGVja093bmVyKGFkZHJlc3MgbWF5YmVfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG93bmVyc1ttYXliZV9vd25lcl0gPyB0cnVlIDogZmFsc2U7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGdyYW50KGFkZHJlc3MgX293bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBvd25lcnNbX293bmVyXSA9IHRydWU7CiAgICAgICAgQWNjZXNzR3JhbnQoX293bmVyKTsKICAgIH0KCgogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX293bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9vd25lciAhPSBwdWJsaXNoZXIpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBfb3duZXIpOwoKICAgICAgICBvd25lcnNbX293bmVyXSA9IGZhbHNlOwogICAgICAgIEFjY2Vzc1Jldm9rZShfb3duZXIpOwogICAgfQp9CgoKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNjQwOTA1MGExMTAxMDgwNTE2MDUwYjFlMjQwMzA5MDUwZDA4NGEwNzBiMDkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCgogICAgLyoqCiAgICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgICAqLwogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgICAqLwogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKCgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBCYXNpY1Rva2VuIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYTZjYmM3YzhkM2MzY2FjN2Q0YzdjOWRjZTZjMWNiYzdjZmNhODhjNWM5Y2IiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqLwoKCgoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgdWludDI1NiB0b3RhbFN1cHBseV87CgogICAgLyoqCiAgICAqIEBkZXYgdG90YWwgbnVtYmVyIG9mIHRva2VucyBpbiBleGlzdGVuY2UKICAgICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCn0KCgovKioKICogQHRpdGxlIEVSQzIwIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iOGJlNmVhZTVmZWVlZTdlYWY5ZWFlNGYxY2JlY2U2ZWFlMmU3YTVlOGU0ZTYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqLwoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iN2YxMjFlMTEwYTFhMTMxZTBkMWUxMDA1M2YxODEyMWUxNjEzNTExYzEwMTIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CiAgCiAgICAvKiogCiAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICAqCiAgICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICAqCiAgICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgKgogICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAqLwogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgovKioKICogQHRpdGxlIE1pbnRhYmxlIHRva2VuIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYjZkYmQ3ZDhjM2QzZGFkN2M0ZDdkOWNjZjZkMWRiZDdkZmRhOThkNWQ5ZGIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqIEBkZXYgU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggbWludGFibGUgdG9rZW4gY3JlYXRpb24KICogQGRldiBJc3N1ZTogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2lzc3Vlcy8xMjAKICogQmFzZWQgb24gY29kZSBieSBUb2tlbk1hcmtldE5ldDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9jb250cmFjdHMvTWludGFibGVUb2tlbi5zb2wKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogICAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogICAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgICAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAqLwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHRvdGFsU3VwcGx5XyA9IHRvdGFsU3VwcGx5Xy5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAqLwogICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICBNaW50RmluaXNoZWQoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgTWNGbHkgdG9rZW4gc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTggTWNGbHkuYWVybwogKiBAYXV0aG9yIERtaXRyaXkgS2hpemhpbnNraXkKICogQGF1dGhvciAiTUlUIgogKi8KY29udHJhY3QgTWNGbHlUb2tlbiBpcyBNaW50YWJsZVRva2VuIHsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJNY0ZseVRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIk1jRkxZIjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIC8vLyBAZGV2IG1hcHBpbmcgZm9yIHdoaXRlbGlzdAogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSB3aGl0ZWxpc3Q7CgogICAgLy8vIEBkZXYgZXZlbnQgdGhyb3cgd2hlbiBhbGxvd2VkIHRvIHRyYW5zZmVyIGFkZHJlc3MgYWRkZWQgdG8gd2hpdGVsaXN0CiAgICAvLy8gQHBhcmFtIGZyb20gYWRkcmVzcwogICAgZXZlbnQgQWxsb3dUcmFuc2ZlcihhZGRyZXNzIGZyb20pOwoKICAgIC8vLyBAZGV2IGNoZWNrIGZvciBhbGxvd2VuY2Ugb2YgdHJhbnNmZXIKICAgIG1vZGlmaWVyIGNhblRyYW5zZmVyKCkgewogICAgICAgIHJlcXVpcmUobWludGluZ0ZpbmlzaGVkIHx8IHdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsgICAgICAgIAogICAgfQoKICAgIC8vLyBAZGV2IGFkZCBhZGRyZXNzIHRvIHdoaXRlbGlzdAogICAgLy8vIEBwYXJhbSBmcm9tIGFkZHJlc3MgdG8gYWRkCiAgICBmdW5jdGlvbiBhbGxvd1RyYW5zZmVyKGFkZHJlc3MgZnJvbSkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgd2hpdGVsaXN0W2Zyb21dID0gdHJ1ZTsKICAgICAgICBBbGxvd1RyYW5zZmVyKGZyb20pOwogICAgfQoKICAgIC8vLyBAZGV2IERvIHRoZSB0cmFuc2ZlciBmcm9tIGFkZHJlc3MgdG8gYWRkcmVzcyB2YWx1ZQogICAgLy8vIEBwYXJhbSBmcm9tIGFkZHJlc3MgZnJvbQogICAgLy8vIEBwYXJhbSB0byBhZGRyZXNzIHRvCiAgICAvLy8gQHBhcmFtIHZhbHVlIHVpbnQyNTYKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGNhblRyYW5zZmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IERvIHRoZSB0cmFuc2ZlciBmcm9tIHRva2VuIGFkZHJlc3MgdG8gInRvIiBhZGRyZXNzIHZhbHVlCiAgICAvLy8gQHBhcmFtIHRvIGFkZHJlc3MgdG8KICAgIC8vLyBAcGFyYW0gdmFsdWUgdWludDI1NiB2YWx1ZQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgY2FuVHJhbnNmZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICAgIH0KfQoKCgoKCgoKLyoqCiAqIEB0aXRsZSBIYWx0YWJsZSBzbWFydCBjb250cmFjdCAtIGNvbnRyb2xzIG93bmVyIGFjY2VzcwogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxOCBNY0ZseS5hZXJvCiAqIEBhdXRob3IgRG1pdHJpeSBLaGl6aGluc2tpeQogKiBAYXV0aG9yICJNSVQiCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBNdWx0aU93bmVycyB7CiAgICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogICAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgICAgICByZXF1aXJlKCFoYWx0ZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICAgICAgcmVxdWlyZShoYWx0ZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vLyBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYWx0ZWQgPSB0cnVlOwogICAgfQoKCiAgICAvLy8gQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgICAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIH0KCn0KCgoKLyoqCiAqIEB0aXRsZSBNY0ZseSBjcm93ZHNhbGUgc21hcnQgY29udHJhY3QgCiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE4IE1jRmx5LmFlcm8KICogQGF1dGhvciBEbWl0cml5IEtoaXpoaW5za2l5CiAqIEBhdXRob3IgIk1JVCIKICogQGRldiBpbmhlcml0ZWQgZnJvbSBNdWx0aU93bmVycyAmIEhhbHRhYmxlCiAqLwpjb250cmFjdCBNY0ZseUNyb3dkIGlzIE11bHRpT3duZXJzLCBIYWx0YWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLy8gQGRldiBUb3RhbCBFVEggcmVjZWl2ZWQgZHVyaW5nIFdBVkVTLCBUTFAxLjIgJiB3aW5kb3dbMS01XQogICAgdWludDI1NiBwdWJsaWMgY291bnRlcl9pbjsgLy8gdGxwMgogICAgCiAgICAvLy8gQGRldiBtaW5pbXVtIEVUSCB0byBwYXJ0aXNpcGF0ZSBpbiB3aW5kb3cgMS01CiAgICB1aW50MjU2IHB1YmxpYyBtaW5FVEhpbiA9IDFlMTg7IC8vIDEgRVRICgogICAgLy8vIEBkZXYgVG9rZW4KICAgIE1jRmx5VG9rZW4gcHVibGljIHRva2VuOwoKICAgIC8vLyBAZGV2IFdpdGhkcmF3IHdhbGxldAogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAgIC8vLyBAZGV2IHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wIGZvciBUTFAgMS4yLCBvdGhlciB2YWx1ZXMgY2FsbGN1bGF0ZWQKICAgIHVpbnQyNTYgcHVibGljIHNUMjsgLy8gc3RhcnRUaW1lVExQMgogICAgdWludDI1NiBjb25zdGFudCBkVExQMiA9IDExOCBkYXlzOyAvLyBkYXlzIG9mIFRMUDIKICAgIHVpbnQyNTYgY29uc3RhbnQgZEJ0ID0gNjAgZGF5czsgLy8gZGF5cyBiZXR3ZWVuIFdpbmRvd3MKICAgIHVpbnQyNTYgY29uc3RhbnQgZFcgPSAxMiBkYXlzOyAvLyAxMiBkYXlzIGZvciAzLDQsNSw2LDcgd2luZG93czsKCiAgICAvLy8gQGRldiBDYXAgbWF4aW11bSBwb3NzaWJsZSB0b2tlbnMgZm9yIG1pbnRpbmcKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGhhcmRDYXBJblRva2VucyA9IDE4MDBlMjQ7IC8vIDEsODAwLDAwMCwwMDAgTUZMCgogICAgLy8vIEBkZXYgbWF4aW11bSBwb3NzaWJsZSB0b2tlbnMgZm9yIHNlbGwgCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtaW50Q2FwSW5Ub2tlbnMgPSAxMjYwZTI0OyAvLyAxLDI2MCwwMDAsMDAwIE1GTAoKICAgIC8vLyBAZGV2IHRva2VucyBjcm93ZCB3aXRoaW4gVExQMgogICAgdWludDI1NiBwdWJsaWMgY3Jvd2RUb2tlbnNUTFAyOwoKICAgIHVpbnQyNTYgcHVibGljIF9wcmVNY0ZseTsKCiAgICAvLy8gQGRldiBtYXhpbXVtIHBvc3NpYmxlIHRva2VucyBmb3IgZnVuZCBtaW50aW5nCiAgICB1aW50MjU2IGNvbnN0YW50IGZ1bmRUb2tlbnMgPSAyNzBlMjQ7IC8vIDI3MCwwMDAsMDAwIE1GTAogICAgdWludDI1NiBwdWJsaWMgZnVuZFRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgZnVuZE1pbnRpbmdBZ2VudDsKCiAgICAvLy8gQGRldiBtYXhpbXVtIHBvc3NpYmxlIHRva2VucyB0byBjb252ZXJ0IGZyb20gV0FWRVMKICAgIHVpbnQyNTYgY29uc3RhbnQgd2F2ZXNUb2tlbnMgPSAxMDBlMjQ7IC8vIDEwMCwwMDAsMDAwIE1GTAogICAgYWRkcmVzcyBwdWJsaWMgd2F2ZXNBZ2VudDsKICAgIGFkZHJlc3MgcHVibGljIHdhdmVzR1c7CgogICAgLy8vIEBkZXYgVmVzdGluZyBwYXJhbSBmb3IgdGVhbSwgYWR2aXNvcnksIHJlc2VydmUuCiAgICB1aW50MjU2IGNvbnN0YW50IFZlc3RpbmdQZXJpb2RJblNlY29uZHMgPSAzMCBkYXlzOyAvLyAyNCBtb250aAogICAgdWludDI1NiBjb25zdGFudCBWZXN0aW5nUGVyaW9kc0NvdW50ID0gMjQ7CgogICAgLy8vIEBkZXYgVGVhbSAxMCUKICAgIHVpbnQyNTYgY29uc3RhbnQgX3RlYW1Ub2tlbnMgPSAxODBlMjQ7CiAgICB1aW50MjU2IHB1YmxpYyB0ZWFtVG90YWxTdXBwbHk7CiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtV2FsbGV0OwoKICAgIC8vLyBAZGV2IEJvdW50eSA1JSAoMiUgKyAzJSkKICAgIC8vLyBAZGV2IEJvdW50eSBvbmxpbmUgMiUKICAgIHVpbnQyNTYgY29uc3RhbnQgX2JvdW50eU9ubGluZVRva2VucyA9IDM2ZTI0OwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5T25saW5lV2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5T25saW5lR1c7CgogICAgLy8vIEBkZXYgQm91bnR5IG9mZmxpbmUgMyUKICAgIHVpbnQyNTYgY29uc3RhbnQgX2JvdW50eU9mZmxpbmVUb2tlbnMgPSA1NGUyNDsKICAgIGFkZHJlc3MgcHVibGljIGJvdW50eU9mZmxpbmVXYWxsZXQ7CgogICAgLy8vIEBkZXYgQWR2aXNvcnkgNSUKICAgIHVpbnQyNTYgY29uc3RhbnQgX2Fkdmlzb3J5VG9rZW5zID0gOTBlMjQ7CiAgICB1aW50MjU2IHB1YmxpYyBhZHZpc29yeVRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgYWR2aXNvcnlXYWxsZXQ7CgogICAgLy8vIEBkZXYgUmVzZXJ2ZWQgZm9yIGZ1dHVyZSA5JQogICAgdWludDI1NiBjb25zdGFudCBfcmVzZXJ2ZWRUb2tlbnMgPSAxNjJlMjQ7CiAgICB1aW50MjU2IHB1YmxpYyByZXNlcnZlZFRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgcmVzZXJ2ZWRXYWxsZXQ7CgogICAgLy8vIEBkZXYgQWlyRHJvcCAxJQogICAgdWludDI1NiBjb25zdGFudCBfYWlyZHJvcFRva2VucyA9IDE4ZTI0OwogICAgYWRkcmVzcyBwdWJsaWMgYWlyZHJvcFdhbGxldDsKICAgIGFkZHJlc3MgcHVibGljIGFpcmRyb3BHVzsKCiAgICAvLy8gQGRldiBQcmVNY0ZseSB3YWxsZXQgKE1GTCkKICAgIGFkZHJlc3MgcHVibGljIHByZU1jRmx5V2FsbGV0OwoKICAgIC8vLyBAZGV2IFBwbCBzdHJ1Y3R1cmUgZm9yIFdpbjEtNQogICAgc3RydWN0IFBwbCB7CiAgICAgICAgYWRkcmVzcyBhZGRyOwogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgfQogICAgbWFwcGluZyAodWludDMyID0+IFBwbCkgcHVibGljIHBwbHM7CgogICAgLy8vIEBkZXYgV2luZG93IHN0cnVjdHVyZSBmb3IgV2luMS01CiAgICBzdHJ1Y3QgV2luZG93IHsKICAgICAgICBib29sIGFjdGl2ZTsKICAgICAgICB1aW50MjU2IHRvdGFsRXRoSW5XaW5kb3c7CiAgICAgICAgdWludDMyIHRvdGFsVHJhbnNDbnQ7CiAgICAgICAgdWludDMyIHJlZnVuZEluZGV4OwogICAgICAgIHVpbnQyNTYgdG9rZW5QZXJXaW5kb3c7CiAgICB9IAogICAgbWFwcGluZyAodWludDggPT4gV2luZG93KSBwdWJsaWMgd3c7CgoKICAgIC8vLyBAZGV2IEV2ZW50cwogICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFRva2VuUHVyY2hhc2VJbldpbmRvdyhhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQ4IHdpbm51bSwgdWludDMyIHRvdGFsY250LCB1aW50MjU2IHRvdGFsZXRoMSk7CiAgICBldmVudCBUcmFuc2Zlck9kZEV0aGVyKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBGdW5kTWludGluZyhhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgV2l0aGRyYXdWZXN0aW5nKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiBwZXJpb2QsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmFsdWVUb3RhbCk7CiAgICBldmVudCBUb2tlbldpdGhkcmF3QXRXaW5kb3coYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IFNldEZ1bmRNaW50aW5nQWdlbnQoYWRkcmVzcyBuZXdBZ2VudCk7CiAgICBldmVudCBTZXRUZWFtV2FsbGV0KGFkZHJlc3MgbmV3VGVhbVdhbGxldCk7CiAgICBldmVudCBTZXRBZHZpc29yeVdhbGxldChhZGRyZXNzIG5ld0Fkdmlzb3J5V2FsbGV0KTsKICAgIGV2ZW50IFNldFJlc2VydmVkV2FsbGV0KGFkZHJlc3MgbmV3UmVzZXJ2ZWRXYWxsZXQpOwogICAgZXZlbnQgU2V0U3RhcnRUaW1lVExQMih1aW50MjU2IG5ld1N0YXJ0VGltZVRMUDIpOwogICAgZXZlbnQgU2V0TWluRVRIaW5jb21lKHVpbnQyNTYgbmV3TWluRVRIaW4pOwogICAgZXZlbnQgTmV3V2luZG93KHVpbnQ4IHdpbk51bSwgdWludDI1NiBhbW91bnRUb2tlbnNQZXJXaW4pOwogICAgZXZlbnQgVG9rZW5FVEgodWludDI1NiB0b3RhbEV0aCwgdWludDMyIHRvdGFsQ250KTsKCgogICAgLy8vIEBkZXYgY2hlY2sgZm9yIE5vbiB6ZXJvIHZhbHVlCiAgICBtb2RpZmllciB2YWxpZFB1cmNoYXNlKCkgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlICE9IDApOwogICAgICAgIF87ICAgICAgICAKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNvbmN0cnVjdG9yIG9mIGNvbnRyYWN0LCBzZXQgbWFpbiBwYXJhbXMsIGNyZWF0ZSBuZXcgdG9rZW4sIGRvIG1pbnRpbmcgZm9yIHNvbWUgd2FsbGV0cwogICAgICogQHBhcmFtIF9zdGFydFRpbWVUTFAyIC0gc2V0IGRhdGUgdGltZSBvZiBzdGFydGluZyBvZiBUTFAyIChtYWluIGRhdGUhKQogICAgICogQHBhcmFtIF9wcmVNY0ZseVRvdGFsU3VwcGx5IC0gc2V0IGFtb3VudCBpbiB3ZWkgdG90YWwgc3VwcGx5IG9mIHByZXZpb3VzZSBjb250cmFjdCAoTUZMKQogICAgICogQHBhcmFtIF93YWxsZXQgLSB3YWxsZXQgZm9yIHRyYW5zZmVyIEVUSCB0byBpdAogICAgICogQHBhcmFtIF93YXZlc0FnZW50IC0gd2FsbGV0IGZvciBXQVZFUyBndwogICAgICogQHBhcmFtIF93YXZlc0dXICAgIC0gd2FsbGV0IGZvciBXQVZFUyBndwogICAgICogQHBhcmFtIF9mdW5kTWludGluZ0FnZW50IC0gd2FsbGV0IHdobyBhbGxvd2VkIHRvIG1pbnQgYmVmb3JlIFRMUDIKICAgICAqIEBwYXJhbSBfdGVhbVdhbGxldCAtIHdhbGxldCBmb3IgdGVhbSB2ZXN0aW5nCiAgICAgKiBAcGFyYW0gX2JvdW50eU9ubGluZVdhbGxldCAtIHdhbGxldCBmb3Igb25saW5lIGJvdW50eQogICAgICogQHBhcmFtIF9ib3VudHlPbmxpbmVHVyAtIHdhbGxldCBmb3Igb25saW5lIGJvdW50eSBHVwogICAgICogQHBhcmFtIF9ib3VudHlPZmZsaW5lV2FsbGV0IC0gd2FsbGV0IGZvciBvZmZsaW5lIGJvdW50eQogICAgICogQHBhcmFtIF9hZHZpc29yeVdhbGxldCAtIHdhbGxldCBmb3IgYWR2aXNvcnkgdmVzdGluZwogICAgICogQHBhcmFtIF9yZXNlcnZlZFdhbGxldCAtIHdhbGxldCBmb3IgcmVzZXJ2ZWQgdmVzdGluZwogICAgICogQHBhcmFtIF9haXJkcm9wV2FsbGV0IC0gd2FsbGV0IGZvciBhaXJkcm9wCiAgICAgKiBAcGFyYW0gX2FpcmRyb3BHVyAtIHdhbGxldCBmb3IgYWlyZHJvcCBHVwogICAgICogQHBhcmFtIF9wcmVNY0ZseVdhbGxldCAtIHdhbGxldCBmb3IgdHJhbnNmZXIgb2xkIE1GTC0+TWNGbHkgKG9uY2UpCiAgICAgKi8KICAgIGZ1bmN0aW9uIE1jRmx5Q3Jvd2QoCiAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lVExQMiwKICAgICAgICB1aW50MjU2IF9wcmVNY0ZseVRvdGFsU3VwcGx5LAogICAgICAgIGFkZHJlc3MgX3dhbGxldCwKICAgICAgICBhZGRyZXNzIF93YXZlc0FnZW50LAogICAgICAgIGFkZHJlc3MgX3dhdmVzR1csCiAgICAgICAgYWRkcmVzcyBfZnVuZE1pbnRpbmdBZ2VudCwKICAgICAgICBhZGRyZXNzIF90ZWFtV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2JvdW50eU9ubGluZVdhbGxldCwKICAgICAgICBhZGRyZXNzIF9ib3VudHlPbmxpbmVHVywKICAgICAgICBhZGRyZXNzIF9ib3VudHlPZmZsaW5lV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2Fkdmlzb3J5V2FsbGV0LAogICAgICAgIGFkZHJlc3MgX3Jlc2VydmVkV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2FpcmRyb3BXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfYWlyZHJvcEdXLAogICAgICAgIGFkZHJlc3MgX3ByZU1jRmx5V2FsbGV0CiAgICApIHB1YmxpYyAKICAgIHsgICAKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWVUTFAyID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgcmVxdWlyZShfcHJlTWNGbHlUb3RhbFN1cHBseSA+IDApOwogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3dhdmVzQWdlbnQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF93YXZlc0dXICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfZnVuZE1pbnRpbmdBZ2VudCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RlYW1XYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9ib3VudHlPbmxpbmVXYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9ib3VudHlPbmxpbmVHVyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2JvdW50eU9mZmxpbmVXYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9hZHZpc29yeVdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3Jlc2VydmVkV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfYWlyZHJvcFdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2FpcmRyb3BHVyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3ByZU1jRmx5V2FsbGV0ICE9IDB4MCk7CgogICAgICAgIHRva2VuID0gbmV3IE1jRmx5VG9rZW4oKTsKCiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKCiAgICAgICAgc1QyID0gX3N0YXJ0VGltZVRMUDI7CgogICAgICAgIHdhdmVzQWdlbnQgPSBfd2F2ZXNBZ2VudDsKICAgICAgICB3YXZlc0dXID0gX3dhdmVzR1c7CgogICAgICAgIGZ1bmRNaW50aW5nQWdlbnQgPSBfZnVuZE1pbnRpbmdBZ2VudDsKCiAgICAgICAgdGVhbVdhbGxldCA9IF90ZWFtV2FsbGV0OwogICAgICAgIGJvdW50eU9ubGluZVdhbGxldCA9IF9ib3VudHlPbmxpbmVXYWxsZXQ7CiAgICAgICAgYm91bnR5T25saW5lR1cgPSBfYm91bnR5T25saW5lR1c7CiAgICAgICAgYm91bnR5T2ZmbGluZVdhbGxldCA9IF9ib3VudHlPZmZsaW5lV2FsbGV0OwogICAgICAgIGFkdmlzb3J5V2FsbGV0ID0gX2Fkdmlzb3J5V2FsbGV0OwogICAgICAgIHJlc2VydmVkV2FsbGV0ID0gX3Jlc2VydmVkV2FsbGV0OwogICAgICAgIGFpcmRyb3BXYWxsZXQgPSBfYWlyZHJvcFdhbGxldDsKICAgICAgICBhaXJkcm9wR1cgPSBfYWlyZHJvcEdXOwogICAgICAgIHByZU1jRmx5V2FsbGV0ID0gX3ByZU1jRmx5V2FsbGV0OwoKICAgICAgICAvLy8gQGRldiBNaW50IGFsbCB0b2tlbnMgYW5kIHRoYW4gY29udHJvbCBpdCBieSB2ZXN0aW5nCiAgICAgICAgX3ByZU1jRmx5ID0gX3ByZU1jRmx5VG90YWxTdXBwbHk7CiAgICAgICAgdG9rZW4ubWludChwcmVNY0ZseVdhbGxldCwgX3ByZU1jRmx5KTsgLy8gTWNGbHkgZm9yIHRoYW5zZmVyIHRvIG9sZCBNRkwgb3duZXJzCiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2ZlcihwcmVNY0ZseVdhbGxldCk7CiAgICAgICAgY3Jvd2RUb2tlbnNUTFAyID0gY3Jvd2RUb2tlbnNUTFAyLmFkZChfcHJlTWNGbHkpOwoKICAgICAgICB0b2tlbi5taW50KHdhdmVzQWdlbnQsIHdhdmVzVG9rZW5zKTsgLy8gMTAwLDAwMCwwMDAgTUZMCiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2Zlcih3YXZlc0FnZW50KTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKHdhdmVzR1cpOwogICAgICAgIGNyb3dkVG9rZW5zVExQMiA9IGNyb3dkVG9rZW5zVExQMi5hZGQod2F2ZXNUb2tlbnMpOwoKICAgICAgICB0b2tlbi5taW50KHRoaXMsIF90ZWFtVG9rZW5zKTsgLy8gbWludCB0byBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIHRva2VuLm1pbnQoYm91bnR5T25saW5lV2FsbGV0LCBfYm91bnR5T25saW5lVG9rZW5zKTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKGJvdW50eU9ubGluZVdhbGxldCk7CiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2Zlcihib3VudHlPbmxpbmVHVyk7CgogICAgICAgIHRva2VuLm1pbnQoYm91bnR5T2ZmbGluZVdhbGxldCwgX2JvdW50eU9mZmxpbmVUb2tlbnMpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIoYm91bnR5T2ZmbGluZVdhbGxldCk7CgogICAgICAgIHRva2VuLm1pbnQodGhpcywgX2Fkdmlzb3J5VG9rZW5zKTsKCiAgICAgICAgdG9rZW4ubWludCh0aGlzLCBfcmVzZXJ2ZWRUb2tlbnMpOwoKICAgICAgICB0b2tlbi5taW50KGFpcmRyb3BXYWxsZXQsIF9haXJkcm9wVG9rZW5zKTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKGFpcmRyb3BXYWxsZXQpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIoYWlyZHJvcEdXKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNoZWNrIGlzIFRMUDIgaXMgYWN0aXZlPwogICAgICogQHJldHVybiBmYWxzZSBpZiBjcm93ZCBUTFAyIGV2ZW50IHdhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoaW5QZXJpb2QoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm93ID49IHNUMiAmJiBub3cgPD0gKHNUMitkVExQMikpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgY2hlY2sgaXMgVExQMiBpcyBhY3RpdmUgYW5kIG1pbnRpbmcgTm90IGZpbmlzaGVkCiAgICAgKiBAcmV0dXJuIGZhbHNlIGlmIGNyb3dkIGV2ZW50IHdhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBydW5uaW5nKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kKCkgJiYgIXRva2VuLm1pbnRpbmdGaW5pc2hlZCgpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgY2hlY2sgY3VycmVudCBzdGFnZSBuYW1lCiAgICAgKiBAcmV0dXJuIHVpbnQ4IHN0YWdlIG51bWJlcgogICAgICovCiAgICBmdW5jdGlvbiBzdGFnZU5hbWUoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50MjU2IGVUMiA9IHNUMitkVExQMjsKCiAgICAgICAgaWYgKG5vdyA8IHNUMikge3JldHVybiAxMDE7fSAvLyBub3Qgc3RhcnRlZAogICAgICAgIGlmIChub3cgPj0gc1QyICYmIG5vdyA8PSBlVDIpIHtyZXR1cm4gKDEwMik7fSAvLyBUTFAxLjIKCiAgICAgICAgaWYgKG5vdyA+IGVUMiAmJiBub3cgPCBlVDIrZEJ0KSB7cmV0dXJuICgxMDMpO30gLy8gcHJlVExQMS4zCiAgICAgICAgaWYgKG5vdyA+PSAoZVQyK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXKSkge3JldHVybiAoMCk7fSAvLyBUTFAxLjMKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcpICYmIG5vdyA8IChlVDIrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNCk7fSAvLyBwcmVUTFAxLjQKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVykpIHtyZXR1cm4gKDEpO30gLy8gVExQMS40CiAgICAgICAgaWYgKG5vdyA+IChlVDIrZEJ0K2RXK2RCdCtkVykgJiYgbm93IDwgKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNSk7fSAvLyBwcmVUTFAxLjUKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQpICYmIG5vdyA8PSAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXKSkge3JldHVybiAoMik7fSAvLyBUTFAxLjUKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVykgJiYgbm93IDwgKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQpKSB7cmV0dXJuICgxMDYpO30gLy8gcHJlVExQMS42CiAgICAgICAgaWYgKG5vdyA+PSAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXKSkge3JldHVybiAoMyk7fSAvLyBUTFAxLjYKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcpICYmIG5vdyA8IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNyk7fSAvLyBwcmVUTFAxLjcKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCtkVykpIHtyZXR1cm4gKDQpO30gLy8gVExQMS43IgogICAgICAgIGlmIChub3cgPiAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcpKSB7cmV0dXJuICgyMDApO30gLy8gRmluaXNoZWQKICAgICAgICByZXR1cm4gKDIwMSk7IC8vIHVua25vd24KICAgIH0KCgogICAgLyoqIAogICAgICogQGRldiBjaGFuZ2UgYWdlbnQgZm9yIG1pbnRpbmcKICAgICAqIEBwYXJhbSBhZ2VudCAtIG5ldyBhZ2VudCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEZ1bmRNaW50aW5nQWdlbnQoYWRkcmVzcyBhZ2VudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgZnVuZE1pbnRpbmdBZ2VudCA9IGFnZW50OwogICAgICAgIFNldEZ1bmRNaW50aW5nQWdlbnQoYWdlbnQpOwogICAgfQoKCiAgICAvKiogCiAgICAgKiBAZGV2IGNoYW5nZSB3YWxsZXQgZm9yIHRlYW0gdmVzdGluZyAodGhpcyBtYWtlIHBvc3NpYmxlIHRvIHNldCBzbWFydC1jb250cmFjdCBhZGRyZXNzIGxhdGVyKQogICAgICogQHBhcmFtIF9uZXdUZWFtV2FsbGV0IC0gbmV3IHdhbGxldCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFRlYW1XYWxsZXQoYWRkcmVzcyBfbmV3VGVhbVdhbGxldCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgdGVhbVdhbGxldCA9IF9uZXdUZWFtV2FsbGV0OwogICAgICAgIFNldFRlYW1XYWxsZXQoX25ld1RlYW1XYWxsZXQpOwogICAgfQoKCiAgICAvKiogCiAgICAgKiBAZGV2IGNoYW5nZSB3YWxsZXQgZm9yIGFkdmlzb3J5IHZlc3RpbmcgKHRoaXMgbWFrZSBwb3NzaWJsZSB0byBzZXQgc21hcnQtY29udHJhY3QgYWRkcmVzcyBsYXRlcikKICAgICAqIEBwYXJhbSBfbmV3QWR2aXNvcnlXYWxsZXQgLSBuZXcgd2FsbGV0IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2V0QWR2aXNvcnlXYWxsZXQoYWRkcmVzcyBfbmV3QWR2aXNvcnlXYWxsZXQpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGFkdmlzb3J5V2FsbGV0ID0gX25ld0Fkdmlzb3J5V2FsbGV0OwogICAgICAgIFNldEFkdmlzb3J5V2FsbGV0KF9uZXdBZHZpc29yeVdhbGxldCk7CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEBkZXYgY2hhbmdlIHdhbGxldCBmb3IgcmVzZXJ2ZWQgdmVzdGluZyAodGhpcyBtYWtlIHBvc3NpYmxlIHRvIHNldCBzbWFydC1jb250cmFjdCBhZGRyZXNzIGxhdGVyKQogICAgICogQHBhcmFtIF9uZXdSZXNlcnZlZFdhbGxldCAtIG5ldyB3YWxsZXQgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXRSZXNlcnZlZFdhbGxldChhZGRyZXNzIF9uZXdSZXNlcnZlZFdhbGxldCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVzZXJ2ZWRXYWxsZXQgPSBfbmV3UmVzZXJ2ZWRXYWxsZXQ7CiAgICAgICAgU2V0UmVzZXJ2ZWRXYWxsZXQoX25ld1Jlc2VydmVkV2FsbGV0KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNoYW5nZSBtaW4gRVRIIGluY29tZSBkdXJpbmcgV2luZG93MS01CiAgICAgKiBAcGFyYW0gX21pbkVUSGluIC0gbmV3IGxpbWl0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldE1pbkVUSGluKHVpbnQyNTYgX21pbkVUSGluKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBtaW5FVEhpbiA9IF9taW5FVEhpbjsKICAgICAgICBTZXRNaW5FVEhpbmNvbWUoX21pbkVUSGluKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHNldCBUTFAxLlggKDItNykgc3RhcnQgJiBlbmQgZGF0ZXMKICAgICAqIEBwYXJhbSBfYXQgLSBuZXcgb3Igb2xkIHN0YXJ0IGRhdGUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0U3RhcnRFbmRUaW1lVExQKHVpbnQyNTYgX2F0KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHNUMik7IC8vIGZvcmJpZCBjaGFuZ2UgdGltZSB3aGVuIFRMUDEuMiBpcyBhY3RpdmUKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IF9hdCk7IC8vIHNob3VsZCBiZSBncmVhdCB0aGFuIGN1cnJlbnQgYmxvY2sgdGltZXN0YW1wCgogICAgICAgIHNUMiA9IF9hdDsKICAgICAgICBTZXRTdGFydFRpbWVUTFAyKF9hdCk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBMYXJnZSBUb2tlbiBIb2xkZXIgbWludGluZyAKICAgICAqIEBwYXJhbSB0byAtIG1pbnQgdG8gYWRkcmVzcwogICAgICogQHBhcmFtIGFtb3VudCAtIGhvdyBtdWNoIG1pbnQKICAgICAqLwogICAgZnVuY3Rpb24gZnVuZE1pbnRpbmcoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpIHN0b3BJbkVtZXJnZW5jeSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBmdW5kTWludGluZ0FnZW50IHx8IGlzT3duZXIoKSk7CiAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzVDIpOwogICAgICAgIHJlcXVpcmUoZnVuZFRvdGFsU3VwcGx5LmFkZChhbW91bnQpIDw9IGZ1bmRUb2tlbnMpOwogICAgICAgIHJlcXVpcmUodG9rZW4udG90YWxTdXBwbHkoKS5hZGQoYW1vdW50KSA8PSBoYXJkQ2FwSW5Ub2tlbnMpOwoKICAgICAgICBmdW5kVG90YWxTdXBwbHkgPSBmdW5kVG90YWxTdXBwbHkuYWRkKGFtb3VudCk7CiAgICAgICAgdG9rZW4ubWludCh0bywgYW1vdW50KTsKICAgICAgICBGdW5kTWludGluZyh0bywgYW1vdW50KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGN1bGF0ZSBhbW91bnQKICAgICAqIEBwYXJhbSAgYW1vdW50IC0gZXRoZXIgdG8gYmUgY29udmVydGVkIHRvIHRva2VucwogICAgICogQHBhcmFtICBhdCAtIGN1cnJlbnQgdGltZQogICAgICogQHBhcmFtICBfdG90YWxTdXBwbHkgLSB0b3RhbCBzdXBwbGllZCB0b2tlbnMKICAgICAqIEByZXR1cm4gdG9rZW5zIGFtb3VudCB0aGF0IHdlIHNob3VsZCBzZW5kIHRvIG91ciBkZWFyIHBwbAogICAgICogQHJldHVybiBvZGQgZXRoZXJzIGFtb3VudCwgd2hpY2ggY29udHJhY3Qgc2hvdWxkIHNlbmQgYmFjawogICAgICovCiAgICBmdW5jdGlvbiBjYWxjQW1vdW50QXQoCiAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgdWludDI1NiBhdCwKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseQogICAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDI1NikgCiAgICB7CiAgICAgICAgdWludDI1NiBlc3RpbWF0ZTsKICAgICAgICB1aW50MjU2IHByaWNlOwogICAgICAgIAogICAgICAgIGlmIChhdCA+PSBzVDIgJiYgYXQgPD0gKHNUMitkVExQMikpIHsKICAgICAgICAgICAgaWYgKGF0IDw9IHNUMiArIDE1IGRheXMpIHtwcmljZSA9IDEyZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgMzAgZGF5cykgewogICAgICAgICAgICAgICAgcHJpY2UgPSAxNGUxMzt9IGVsc2UgaWYgKGF0IDw9IHNUMiArIDQ1IGRheXMpIHsKICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDE2ZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgNjAgZGF5cykgewogICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDE4ZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgNzUgZGF5cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSAyMGUxMzt9IGVsc2UgaWYgKGF0IDw9IHNUMiArIDkwIGRheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDIyZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgMTA1IGRheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSAyNGUxMzt9IGVsc2UgaWYgKGF0IDw9IHNUMiArIDExOCBkYXlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDI2ZTEzO30gZWxzZSB7cmV2ZXJ0KCk7fQogICAgICAgIH0gZWxzZSB7cmV2ZXJ0KCk7fQoKICAgICAgICBlc3RpbWF0ZSA9IF90b3RhbFN1cHBseS5hZGQoYW1vdW50Lm11bCgxZTE4KS5kaXYocHJpY2UpKTsKCiAgICAgICAgaWYgKGVzdGltYXRlID4gaGFyZENhcEluVG9rZW5zKSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBoYXJkQ2FwSW5Ub2tlbnMuc3ViKF90b3RhbFN1cHBseSksCiAgICAgICAgICAgICAgICBlc3RpbWF0ZS5zdWIoaGFyZENhcEluVG9rZW5zKS5tdWwocHJpY2UpLmRpdigxZTE4KQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGVzdGltYXRlLnN1YihfdG90YWxTdXBwbHkpLCAwKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGZhbGxiYWNrIGZvciBwcm9jZXNzaW5nIGV0aGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmV0dXJuIGdldFRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHNlbGwgdG9rZW4gYW5kIHNlbmQgdG8gY29udHJpYnV0b3IgYWRkcmVzcwogICAgICogQHBhcmFtIGNvbnRyaWJ1dG9yIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW5zKGFkZHJlc3MgY29udHJpYnV0b3IpIHBheWFibGUgc3RvcEluRW1lcmdlbmN5IHZhbGlkUHVyY2hhc2UgcHVibGljIHsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50MjU2IG9kZEV0aGVyczsKICAgICAgICB1aW50MjU2IGV0aGVyczsKICAgICAgICB1aW50MjU2IF9hdDsKICAgICAgICB1aW50OCBfd2luTnVtOwoKICAgICAgICBfYXQgPSBibG9jay50aW1lc3RhbXA7CgogICAgICAgIHJlcXVpcmUoY29udHJpYnV0b3IgIT0gMHgwKTsKICAgICAgIAogICAgICAgIGlmICh3aXRoaW5QZXJpb2QoKSkgewogICAgICAgIAogICAgICAgICAgICAoYW1vdW50LCBvZGRFdGhlcnMpID0gY2FsY0Ftb3VudEF0KG1zZy52YWx1ZSwgX2F0LCB0b2tlbi50b3RhbFN1cHBseSgpKTsKICAKICAgICAgICAgICAgcmVxdWlyZShhbW91bnQuYWRkKHRva2VuLnRvdGFsU3VwcGx5KCkpIDw9IGhhcmRDYXBJblRva2Vucyk7CgogICAgICAgICAgICBldGhlcnMgPSBtc2cudmFsdWUuc3ViKG9kZEV0aGVycyk7CgogICAgICAgICAgICB0b2tlbi5taW50KGNvbnRyaWJ1dG9yLCBhbW91bnQpOyAvLyBmYWlsIGlmIG1pbnRpbmcgaXMgZmluaXNoZWQKICAgICAgICAgICAgVG9rZW5QdXJjaGFzZShjb250cmlidXRvciwgZXRoZXJzLCBhbW91bnQpOwogICAgICAgICAgICBjb3VudGVyX2luID0gY291bnRlcl9pbi5hZGQoZXRoZXJzKTsKICAgICAgICAgICAgY3Jvd2RUb2tlbnNUTFAyID0gY3Jvd2RUb2tlbnNUTFAyLmFkZChhbW91bnQpOwoKICAgICAgICAgICAgaWYgKG9kZEV0aGVycyA+IDApIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUob2RkRXRoZXJzIDwgbXNnLnZhbHVlKTsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dG9yLnRyYW5zZmVyKG9kZEV0aGVycyk7CiAgICAgICAgICAgICAgICBUcmFuc2Zlck9kZEV0aGVyKGNvbnRyaWJ1dG9yLCBvZGRFdGhlcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3YWxsZXQudHJhbnNmZXIoZXRoZXJzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5FVEhpbik7IC8vIGNoZWNrcyBtaW4gRVRIIGluY29tZQogICAgICAgICAgICBfd2luTnVtID0gc3RhZ2VOYW1lKCk7CiAgICAgICAgICAgIHJlcXVpcmUoX3dpbk51bSA+PSAwICYmIF93aW5OdW0gPCA1KTsKICAgICAgICAgICAgV2luZG93IHN0b3JhZ2UgdyA9IHd3W193aW5OdW1dOwoKICAgICAgICAgICAgcmVxdWlyZSh3LnRva2VuUGVyV2luZG93ID4gMCk7IC8vIGNoZWNrIHRoYXQgd2UgaGF2ZSB0b2tlbnMhCgogICAgICAgICAgICB3LnRvdGFsRXRoSW5XaW5kb3cgPSB3LnRvdGFsRXRoSW5XaW5kb3cuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIHBwbHNbdy50b3RhbFRyYW5zQ250XS5hZGRyID0gY29udHJpYnV0b3I7CiAgICAgICAgICAgIHBwbHNbdy50b3RhbFRyYW5zQ250XS5hbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgICAgIHcudG90YWxUcmFuc0NudCsrOwogICAgICAgICAgICBUb2tlblB1cmNoYXNlSW5XaW5kb3coY29udHJpYnV0b3IsIG1zZy52YWx1ZSwgX3dpbk51bSwgdy50b3RhbFRyYW5zQ250LCB3LnRvdGFsRXRoSW5XaW5kb3cpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNsb3NlIFdpbmRvdyBhbmQgdHJhbnNmZXIgRXRoIHRvIHdhbGxldCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3dpbk51bSAtIG51bWJlciBvZiB3aW5kb3cgMC00IHRvIGNsb3NlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlV2luZG93KHVpbnQ4IF93aW5OdW0pIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgcHVibGljIHsKICAgICAgICByZXF1aXJlKHd3W193aW5OdW1dLmFjdGl2ZSk7CiAgICAgICAgd3dbX3dpbk51bV0uYWN0aXZlID0gZmFsc2U7CgogICAgICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgdHJhbnNmZXIgdG9rZW5zIHRvIHBwbCBhY2N0cyAod2luZG93MS01KQogICAgICogQHBhcmFtIF93aW5OdW0gLSBudW1iZXIgb2Ygd2luZG93IDAtNCB0byBjbG9zZQogICAgICovCiAgICBmdW5jdGlvbiBzZW5kVG9rZW5zV2luZG93KHVpbnQ4IF93aW5OdW0pIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgcHVibGljIHsKICAgICAgICB1aW50MjU2IF90b2tlblBlckVUSDsKICAgICAgICB1aW50MjU2IF90b2tlblRvU2VuZCA9IDA7CiAgICAgICAgYWRkcmVzcyBfdGVtcEFkZHI7CiAgICAgICAgdWludDMyIGluZGV4ID0gd3dbX3dpbk51bV0ucmVmdW5kSW5kZXg7CgogICAgICAgIFRva2VuRVRIKHd3W193aW5OdW1dLnRvdGFsRXRoSW5XaW5kb3csIHd3W193aW5OdW1dLnRvdGFsVHJhbnNDbnQpOwoKICAgICAgICByZXF1aXJlKHd3W193aW5OdW1dLmFjdGl2ZSk7CiAgICAgICAgcmVxdWlyZSh3d1tfd2luTnVtXS50b3RhbEV0aEluV2luZG93ID4gMCk7CiAgICAgICAgcmVxdWlyZSh3d1tfd2luTnVtXS50b3RhbFRyYW5zQ250ID4gMCk7CgogICAgICAgIF90b2tlblBlckVUSCA9IHd3W193aW5OdW1dLnRva2VuUGVyV2luZG93LmRpdih3d1tfd2luTnVtXS50b3RhbEV0aEluV2luZG93KTsgLy8gbWF4IE1jRmx5IGluIHdpbmRvdyAvIGV0aEluV2luZG93CgogICAgICAgIHdoaWxlIChpbmRleCA8IHd3W193aW5OdW1dLnRvdGFsVHJhbnNDbnQgJiYgbXNnLmdhcyA+IDEwMDAwMCkgewogICAgICAgICAgICBfdG9rZW5Ub1NlbmQgPSBfdG9rZW5QZXJFVEgubXVsKHBwbHNbaW5kZXhdLmFtb3VudCk7CiAgICAgICAgICAgIHBwbHNbaW5kZXhdLmFtb3VudCA9IDA7CiAgICAgICAgICAgIF90ZW1wQWRkciA9IHBwbHNbaW5kZXhdLmFkZHI7CiAgICAgICAgICAgIHBwbHNbaW5kZXhdLmFkZHIgPSAwOwogICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICB0b2tlbi50cmFuc2ZlcihfdGVtcEFkZHIsIF90b2tlblRvU2VuZCk7CiAgICAgICAgICAgIFRva2VuV2l0aGRyYXdBdFdpbmRvdyhfdGVtcEFkZHIsIF90b2tlblRvU2VuZCk7CiAgICAgICAgfQogICAgICAgIHd3W193aW5OdW1dLnJlZnVuZEluZGV4ID0gaW5kZXg7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBvcGVuIG5ldyB3aW5kb3cgMC01IGFuZCB3cml0ZSB0b3RsIHRva2VuIHBlciB3aW5kb3cgaW4gc3RydWN0dXJlCiAgICAgKiBAcGFyYW0gX3dpbk51bSAtIG51bWJlciBvZiB3aW5kb3cgMC00IHRvIGNsb3NlCiAgICAgKiBAcGFyYW0gX3Rva2VuUGVyV2luZG93IC0gdG90YWwgdG9rZW4gZm9yIHdpbmRvdyAwLTQKICAgICAqLwogICAgZnVuY3Rpb24gbmV3V2luZG93KHVpbnQ4IF93aW5OdW0sIHVpbnQyNTYgX3Rva2VuUGVyV2luZG93KSBwcml2YXRlIHsKICAgICAgICB3d1tfd2luTnVtXSA9IFdpbmRvdyh0cnVlLCAwLCAwLCAwLCBfdG9rZW5QZXJXaW5kb3cpOwogICAgICAgIE5ld1dpbmRvdyhfd2luTnVtLCBfdG9rZW5QZXJXaW5kb3cpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgRmluaXNoIGNyb3dkc2FsZSBUTFAxLjIgcGVyaW9kIGFuZCBvcGVuIHdpbmRvdzEtNSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gZmluaXNoQ3Jvd2QoKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICB1aW50MjU2IF90b2tlblBlcldpbmRvdzsKICAgICAgICByZXF1aXJlKG5vdyA+IChzVDIuYWRkKGRUTFAyKSkgfHwgaGFyZENhcEluVG9rZW5zID09IHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgICAgIHJlcXVpcmUoIXRva2VuLm1pbnRpbmdGaW5pc2hlZCgpKTsKCiAgICAgICAgX3Rva2VuUGVyV2luZG93ID0gKG1pbnRDYXBJblRva2Vucy5zdWIoY3Jvd2RUb2tlbnNUTFAyKS5zdWIoZnVuZFRvdGFsU3VwcGx5KSkuZGl2KDUpOwogICAgICAgIHRva2VuLm1pbnQodGhpcywgX3Rva2VuUGVyV2luZG93Lm11bCg1KSk7IC8vIG1pbnQgdG8gY29udHJhY3QgYWRkcmVzcwogICAgICAgIC8vIHNob3VkIGJlIE1BWCB0b2tlbnMgbWludGVkISEhIDEsODAwLDAwMCwwMDAKICAgICAgICBmb3IgKHVpbnQ4IHkgPSAwOyB5IDwgNTsgeSsrKSB7CiAgICAgICAgICAgIG5ld1dpbmRvdyh5LCBfdG9rZW5QZXJXaW5kb3cpOwogICAgICAgIH0KCiAgICAgICAgdG9rZW4uZmluaXNoTWludGluZygpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgd2l0aGRyYXcgdG9rZW5zIGFtb3VudCB3aXRoaW4gdmVzdGluZyBydWxlcyBmb3IgdGVhbSwgYWR2aXNvcnkgYW5kIHJlc2VydmVkCiAgICAgKiBAcGFyYW0gd2l0aGRyYXdXYWxsZXQgLSB3YWxsZXQgdG8gdHJhbnNmZXIgdG9rZW5zCiAgICAgKiBAcGFyYW0gd2l0aGRyYXdUb2tlbnMgLSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyIHRvCiAgICAgKiBAcGFyYW0gd2l0aGRyYXdUb3RhbFN1cHBseSAtIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgdHJhbnNmZXJlZCB0byBhY2NvdW50CiAgICAgKiBAcmV0dXJuIHVuaXQyNTYgdG90YWwgYW1vdW50IG9mIHRva2VucyBhZnRlciB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiB2ZXN0aW5nV2l0aGRyYXcoYWRkcmVzcyB3aXRoZHJhd1dhbGxldCwgdWludDI1NiB3aXRoZHJhd1Rva2VucywgdWludDI1NiB3aXRoZHJhd1RvdGFsU3VwcGx5KSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKHRva2VuLm1pbnRpbmdGaW5pc2hlZCgpKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gd2l0aGRyYXdXYWxsZXQgfHwgaXNPd25lcigpKTsKCiAgICAgICAgdWludDI1NiBjdXJyZW50UGVyaW9kID0gKGJsb2NrLnRpbWVzdGFtcC5zdWIoc1QyLmFkZChkVExQMikpKS5kaXYoVmVzdGluZ1BlcmlvZEluU2Vjb25kcyk7CiAgICAgICAgaWYgKGN1cnJlbnRQZXJpb2QgPiBWZXN0aW5nUGVyaW9kc0NvdW50KSB7CiAgICAgICAgICAgIGN1cnJlbnRQZXJpb2QgPSBWZXN0aW5nUGVyaW9kc0NvdW50OwogICAgICAgIH0KICAgICAgICB1aW50MjU2IHRva2VuQXZhaWxhYmxlID0gd2l0aGRyYXdUb2tlbnMubXVsKGN1cnJlbnRQZXJpb2QpLmRpdihWZXN0aW5nUGVyaW9kc0NvdW50KS5zdWIod2l0aGRyYXdUb3RhbFN1cHBseSk7ICAvLyBSRUNIRUNLISEhISEKCiAgICAgICAgcmVxdWlyZSgod2l0aGRyYXdUb3RhbFN1cHBseS5hZGQodG9rZW5BdmFpbGFibGUpKSA8PSB3aXRoZHJhd1Rva2Vucyk7CgogICAgICAgIHVpbnQyNTYgX3dpdGhkcmF3VG90YWxTdXBwbHkgPSB3aXRoZHJhd1RvdGFsU3VwcGx5LmFkZCh0b2tlbkF2YWlsYWJsZSk7CgogICAgICAgIHRva2VuLnRyYW5zZmVyKHdpdGhkcmF3V2FsbGV0LCB0b2tlbkF2YWlsYWJsZSk7CiAgICAgICAgV2l0aGRyYXdWZXN0aW5nKHdpdGhkcmF3V2FsbGV0LCBjdXJyZW50UGVyaW9kLCB0b2tlbkF2YWlsYWJsZSwgX3dpdGhkcmF3VG90YWxTdXBwbHkpOwoKICAgICAgICByZXR1cm4gX3dpdGhkcmF3VG90YWxTdXBwbHk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiB3aXRoZHJhdyB0b2tlbnMgYW1vdW50IHdpdGhpbiB2ZXN0aW5nIHJ1bGVzIGZvciB0ZWFtCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRlYW1XaXRoZHJhdygpIHB1YmxpYyB7CiAgICAgICAgdGVhbVRvdGFsU3VwcGx5ID0gdmVzdGluZ1dpdGhkcmF3KHRlYW1XYWxsZXQsIF90ZWFtVG9rZW5zLCB0ZWFtVG90YWxTdXBwbHkpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgd2l0aGRyYXcgdG9rZW5zIGFtb3VudCB3aXRoaW4gdmVzdGluZyBydWxlcyBmb3IgYWR2aXNvcnkKICAgICAqLwogICAgZnVuY3Rpb24gYWR2aXNvcnlXaXRoZHJhdygpIHB1YmxpYyB7CiAgICAgICAgYWR2aXNvcnlUb3RhbFN1cHBseSA9IHZlc3RpbmdXaXRoZHJhdyhhZHZpc29yeVdhbGxldCwgX2Fkdmlzb3J5VG9rZW5zLCBhZHZpc29yeVRvdGFsU3VwcGx5KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHdpdGhkcmF3IHRva2VucyBhbW91bnQgd2l0aGluIHZlc3RpbmcgcnVsZXMgZm9yIHJlc2VydmVkIHdhbGxldAogICAgICovCiAgICBmdW5jdGlvbiByZXNlcnZlZFdpdGhkcmF3KCkgcHVibGljIHsKICAgICAgICByZXNlcnZlZFRvdGFsU3VwcGx5ID0gdmVzdGluZ1dpdGhkcmF3KHJlc2VydmVkV2FsbGV0LCBfcmVzZXJ2ZWRUb2tlbnMsIHJlc2VydmVkVG90YWxTdXBwbHkpOwogICAgfQp9'.
	

]
