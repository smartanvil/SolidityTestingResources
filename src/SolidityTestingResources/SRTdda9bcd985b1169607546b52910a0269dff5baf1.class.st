Class {
	#name : #SRTdda9bcd985b1169607546b52910a0269dff5baf1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdda9bcd985b1169607546b52910a0269dff5baf1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCmludGVyZmFjZSBFUkMyMCB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHRva2Vucyk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgdG9rZW5Pd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdG9rZW5zKTsKfQoKLy8gR09PIC0gQ3J5cHRvIElkbGUgR2FtZQovLyBodHRwczovL2V0aGVyZ29vLmlvCgpjb250cmFjdCBHb28gaXMgRVJDMjAgewogICAgCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgID0gIklkbGVFdGgiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiR29vIjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDA7CiAgICB1aW50MjU2IHByaXZhdGUgcm91Z2hTdXBwbHk7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEdvb1Byb2R1Y3Rpb247CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy8gTWlub3IgbWFuYWdlbWVudCBvZiBnYW1lCiAgICBib29sIHB1YmxpYyBnYW1lU3RhcnRlZDsKICAgIAogICAgdWludDI1NiBwdWJsaWMgdG90YWxFdGhlckdvb1Jlc2VhcmNoUG9vbDsgLy8gRXRoIGRpdmlkZW5kcyB0byBiZSBzcGxpdCBiZXR3ZWVuIHBsYXllcnMnIGdvbyBwcm9kdWN0aW9uCiAgICB1aW50MjU2W10gcHVibGljIHRvdGFsR29vUHJvZHVjdGlvblNuYXBzaG90czsgLy8gVGhlIHRvdGFsIGdvbyBwcm9kdWN0aW9uIGZvciBlYWNoIHByaW9yIGRheSBwYXN0CiAgICB1aW50MjU2W10gcHVibGljIGFsbG9jYXRlZEdvb1Jlc2VhcmNoU25hcHNob3RzOyAvLyBUaGUgcmVzZWFyY2ggZXRoIGFsbG9jYXRlZCB0byBlYWNoIHByaW9yIGRheSBwYXN0CiAgICB1aW50MjU2IHB1YmxpYyBuZXh0U25hcHNob3RUaW1lOwogICAgCiAgICB1aW50MjU2IHByaXZhdGUgTUFYX1BST0RVQ1RJT05fVU5JVFMgPSA5OTk7IC8vIFBlciB0eXBlIChtYWtlcyBiYWxhbmNpbmcgc2xpZ2h0bHkgZWFzaWVyKQogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IFJBRkZMRV9USUNLRVRfQkFTRV9HT09fUFJJQ0UgPSAxMDAwOwogICAgCiAgICAvLyBCYWxhbmNlcyBmb3IgZWFjaCBwbGF5ZXIKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwcml2YXRlIGV0aEJhbGFuY2U7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHJpdmF0ZSBnb29CYWxhbmNlOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSkgcHJpdmF0ZSBnb29Qcm9kdWN0aW9uU25hcHNob3RzOyAvLyBTdG9yZSBwbGF5ZXIncyBnb28gcHJvZHVjdGlvbiBmb3IgZ2l2ZW4gZGF5IChzbmFwc2hvdCkKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gYm9vbCkpIHByaXZhdGUgZ29vUHJvZHVjdGlvblplcm9lZFNuYXBzaG90czsgLy8gVGhpcyBpc24ndCBncmVhdCBidXQgd2UgbmVlZCBrbm93IGRpZmZlcmVuY2UgYmV0d2VlbiAwIHByb2R1Y3Rpb24gYW5kIGFuIHVudXNlZC9pbmFjdGl2ZSBkYXkuCiAgICAKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwcml2YXRlIGxhc3RHb29TYXZlVGltZTsgLy8gU2Vjb25kcyAobGFzdCB0aW1lIHBsYXllciBjbGFpbWVkIHRoZWlyIHByb2R1Y2VkIGdvbykKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbGFzdEdvb1Byb2R1Y3Rpb25VcGRhdGU7IC8vIERheXMgKGxhc3Qgc25hcHNob3QgcGxheWVyIHVwZGF0ZWQgdGhlaXIgcHJvZHVjdGlvbikKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwcml2YXRlIGxhc3RHb29SZXNlYXJjaEZ1bmRDbGFpbTsgLy8gRGF5cyAoc25hcHNob3QgbnVtYmVyKQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgYmF0dGxlQ29vbGRvd247IC8vIElmIHVzZXIgYXR0YWNrcyB0aGV5IGNhbm5vdCBhdHRhY2sgYWdhaW4gZm9yIHNob3J0IHRpbWUKICAgIAogICAgLy8gU3R1ZmYgb3duZWQgYnkgZWFjaCBwbGF5ZXIKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikpIHByaXZhdGUgdW5pdHNPd25lZDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gYm9vbCkpIHByaXZhdGUgdXBncmFkZXNPd25lZDsKICAgIG1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBwcml2YXRlIHJhcmVJdGVtT3duZXI7CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgcHJpdmF0ZSByYXJlSXRlbVByaWNlOwogICAgCiAgICAvLyBSYXJlcyAmIFVwZ3JhZGVzIChJbmNyZWFzZSB1bml0J3MgcHJvZHVjdGlvbiAvIGF0dGFjayBldGMuKQogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSkgcHJpdmF0ZSB1bml0R29vUHJvZHVjdGlvbkluY3JlYXNlczsgLy8gQWRkcyB0byB0aGUgZ29vIHBlciBzZWNvbmQKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikpIHByaXZhdGUgdW5pdEdvb1Byb2R1Y3Rpb25NdWx0aXBsaWVyOyAvLyBNdWx0aXBsaWVzIHRoZSBnb28gcGVyIHNlY29uZAogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSkgcHJpdmF0ZSB1bml0QXR0YWNrSW5jcmVhc2VzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSkgcHJpdmF0ZSB1bml0QXR0YWNrTXVsdGlwbGllcjsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikpIHByaXZhdGUgdW5pdERlZmVuc2VJbmNyZWFzZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpKSBwcml2YXRlIHVuaXREZWZlbnNlTXVsdGlwbGllcjsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikpIHByaXZhdGUgdW5pdEdvb1N0ZWFsaW5nSW5jcmVhc2VzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSkgcHJpdmF0ZSB1bml0R29vU3RlYWxpbmdNdWx0aXBsaWVyOwogICAgCiAgICAvLyBNYXBwaW5nIG9mIGFwcHJvdmVkIEVSQzIwIHRyYW5zZmVycyAoYnkgcGxheWVyKQogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHJpdmF0ZSBhbGxvd2VkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgcHJvdGVjdGVkQWRkcmVzc2VzOyAvLyBGb3IgbnBjIGV4Y2hhbmdlcyAocmVxdWlyZXMgMCBnb28gcHJvZHVjdGlvbikKICAgIAogICAgLy8gUmFmZmxlIHN0cnVjdHVyZXMKICAgIHN0cnVjdCBUaWNrZXRQdXJjaGFzZXMgewogICAgICAgIFRpY2tldFB1cmNoYXNlW10gdGlja2V0c0JvdWdodDsKICAgICAgICB1aW50MjU2IG51bVB1cmNoYXNlczsgLy8gQWxsb3dzIHVzIHRvIHJlc2V0IHdpdGhvdXQgY2xlYXJpbmcgVGlja2V0UHVyY2hhc2VbXSAoYXZvaWRzIHBvdGVudGlhbCBmb3IgZ2FzIGxpbWl0KQogICAgICAgIHVpbnQyNTYgcmFmZmxlUmFyZUlkOwogICAgfQogICAgCiAgICAvLyBBbGxvd3MgdXMgdG8gcXVlcnkgd2lubmVyIHdpdGhvdXQgbG9vcGluZyAoYXZvaWRpbmcgcG90ZW50aWFsIGZvciBnYXMgbGltaXQpCiAgICBzdHJ1Y3QgVGlja2V0UHVyY2hhc2UgewogICAgICAgIHVpbnQyNTYgc3RhcnRJZDsKICAgICAgICB1aW50MjU2IGVuZElkOwogICAgfQogICAgCiAgICAvLyBSYWZmbGUgdGlja2V0cwogICAgbWFwcGluZyhhZGRyZXNzID0+IFRpY2tldFB1cmNoYXNlcykgcHJpdmF0ZSB0aWNrZXRzQm91Z2h0QnlQbGF5ZXI7CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzc1tdKSBwcml2YXRlIHJhZmZsZVBsYXllcnM7IC8vIEtlZXBpbmcgYSBzZXBlcmF0ZSBsaXN0IGZvciBlYWNoIHJhZmZsZSBoYXMgaXQncyBiZW5lZml0cy4KCiAgICAvLyBDdXJyZW50IHJhZmZsZSBpbmZvCiAgICB1aW50MjU2IHByaXZhdGUgcmFmZmxlRW5kVGltZTsKICAgIHVpbnQyNTYgcHJpdmF0ZSByYWZmbGVSYXJlSWQ7CiAgICB1aW50MjU2IHByaXZhdGUgcmFmZmxlVGlja2V0c0JvdWdodDsKICAgIGFkZHJlc3MgcHJpdmF0ZSByYWZmbGVXaW5uZXI7IC8vIEFkZHJlc3Mgb2Ygd2lubmVyCiAgICBib29sIHByaXZhdGUgcmFmZmxlV2lubmluZ1RpY2tldFNlbGVjdGVkOwogICAgdWludDI1NiBwcml2YXRlIHJhZmZsZVRpY2tldFRoYXRXb247CiAgICAKICAgIC8vIE1pbm9yIGdhbWUgZXZlbnRzCiAgICBldmVudCBVbml0Qm91Z2h0KGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHVuaXRJZCwgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgVW5pdFNvbGQoYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgdW5pdElkLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBQbGF5ZXJBdHRhY2tlZChhZGRyZXNzIGF0dGFja2VyLCBhZGRyZXNzIHRhcmdldCwgYm9vbCBzdWNjZXNzLCB1aW50MjU2IGdvb1N0b2xlbik7CiAgICAKICAgIEdvb0dhbWVDb25maWcgc2NoZW1hOwogICAgCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gR29vKCkgcHVibGljIHBheWFibGUgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBzY2hlbWEgPSBHb29HYW1lQ29uZmlnKDB4MjE5MTJlODFkN2VmZjhiZmY4OTUzMDJiNDVkYTc2ZjdmMDcwZTNiOSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7IH0KICAgIAogICAgZnVuY3Rpb24gYmVnaW5HYW1lKHVpbnQyNTYgZmlyc3REaXZzVGltZSkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICByZXF1aXJlKCFnYW1lU3RhcnRlZCk7CiAgICAgICAgCiAgICAgICAgZ2FtZVN0YXJ0ZWQgPSB0cnVlOyAvLyBHTy1PT09PIQogICAgICAgIG5leHRTbmFwc2hvdFRpbWUgPSBmaXJzdERpdnNUaW1lOwogICAgICAgIHRvdGFsRXRoZXJHb29SZXNlYXJjaFBvb2wgPSBtc2cudmFsdWU7IC8vIFNlZWQgcG90CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiByb3VnaFN1cHBseTsgLy8gU3RvcmVkIGdvbyAocm91Z2ggc3VwcGx5IGFzIGl0IGlnbm9yZXMgZWFybmVkL3VuY2xhaW1lZCBnb28pCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHBsYXllcikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBnb29CYWxhbmNlW3BsYXllcl0gKyBiYWxhbmNlT2ZVbmNsYWltZWRHb28ocGxheWVyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmFsYW5jZU9mVW5jbGFpbWVkR29vKGFkZHJlc3MgcGxheWVyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGxhc3RHb29TYXZlVGltZVtwbGF5ZXJdID4gMCAmJiBsYXN0R29vU2F2ZVRpbWVbcGxheWVyXSA8IGJsb2NrLnRpbWVzdGFtcCkgewogICAgICAgICAgICByZXR1cm4gKGdldEdvb1Byb2R1Y3Rpb24ocGxheWVyKSAqIChibG9jay50aW1lc3RhbXAgLSBsYXN0R29vU2F2ZVRpbWVbcGxheWVyXSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZXRoZXJCYWxhbmNlT2YoYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZXRoQmFsYW5jZVtwbGF5ZXJdOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdXBkYXRlUGxheWVyc0dvbyhtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKGFtb3VudCA8PSBnb29CYWxhbmNlW21zZy5zZW5kZXJdKTsKICAgICAgICAKICAgICAgICBnb29CYWxhbmNlW21zZy5zZW5kZXJdIC09IGFtb3VudDsKICAgICAgICBnb29CYWxhbmNlW3JlY2lwaWVudF0gKz0gYW1vdW50OwogICAgICAgIAogICAgICAgIGVtaXQgVHJhbnNmZXIobXNnLnNlbmRlciwgcmVjaXBpZW50LCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBwbGF5ZXIsIGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IGFtb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1cGRhdGVQbGF5ZXJzR29vKHBsYXllcik7CiAgICAgICAgcmVxdWlyZShhbW91bnQgPD0gYWxsb3dlZFtwbGF5ZXJdW21zZy5zZW5kZXJdICYmIGFtb3VudCA8PSBnb29CYWxhbmNlW21zZy5zZW5kZXJdKTsKICAgICAgICAKICAgICAgICBnb29CYWxhbmNlW3BsYXllcl0gLT0gYW1vdW50OwogICAgICAgIGdvb0JhbGFuY2VbcmVjaXBpZW50XSArPSBhbW91bnQ7CiAgICAgICAgYWxsb3dlZFtwbGF5ZXJdW21zZy5zZW5kZXJdIC09IGFtb3VudDsKICAgICAgICAKICAgICAgICBlbWl0IFRyYW5zZmVyKHBsYXllciwgcmVjaXBpZW50LCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgYXBwcm92ZWUsIHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVthcHByb3ZlZV0gPSBhbW91bnQ7CiAgICAgICAgZW1pdCBBcHByb3ZhbChtc2cuc2VuZGVyLCBhcHByb3ZlZSwgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgcGxheWVyLCBhZGRyZXNzIGFwcHJvdmVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gYWxsb3dlZFtwbGF5ZXJdW2FwcHJvdmVlXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0R29vUHJvZHVjdGlvbihhZGRyZXNzIHBsYXllcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJldHVybiBnb29Qcm9kdWN0aW9uU25hcHNob3RzW3BsYXllcl1bbGFzdEdvb1Byb2R1Y3Rpb25VcGRhdGVbcGxheWVyXV07CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZVBsYXllcnNHb28oYWRkcmVzcyBwbGF5ZXIpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IGdvb0dhaW4gPSBiYWxhbmNlT2ZVbmNsYWltZWRHb28ocGxheWVyKTsKICAgICAgICBsYXN0R29vU2F2ZVRpbWVbcGxheWVyXSA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICByb3VnaFN1cHBseSArPSBnb29HYWluOwogICAgICAgIGdvb0JhbGFuY2VbcGxheWVyXSArPSBnb29HYWluOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVQbGF5ZXJzR29vRnJvbVB1cmNoYXNlKGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHB1cmNoYXNlQ29zdCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgdW5jbGFpbWVkR29vID0gYmFsYW5jZU9mVW5jbGFpbWVkR29vKHBsYXllcik7CiAgICAgICAgCiAgICAgICAgaWYgKHB1cmNoYXNlQ29zdCA+IHVuY2xhaW1lZEdvbykgewogICAgICAgICAgICB1aW50MjU2IGdvb0RlY3JlYXNlID0gcHVyY2hhc2VDb3N0IC0gdW5jbGFpbWVkR29vOwogICAgICAgICAgICByb3VnaFN1cHBseSAtPSBnb29EZWNyZWFzZTsKICAgICAgICAgICAgZ29vQmFsYW5jZVtwbGF5ZXJdIC09IGdvb0RlY3JlYXNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTYgZ29vR2FpbiA9IHVuY2xhaW1lZEdvbyAtIHB1cmNoYXNlQ29zdDsKICAgICAgICAgICAgcm91Z2hTdXBwbHkgKz0gZ29vR2FpbjsKICAgICAgICAgICAgZ29vQmFsYW5jZVtwbGF5ZXJdICs9IGdvb0dhaW47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxhc3RHb29TYXZlVGltZVtwbGF5ZXJdID0gYmxvY2sudGltZXN0YW1wOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBpbmNyZWFzZVBsYXllcnNHb29Qcm9kdWN0aW9uKHVpbnQyNTYgaW5jcmVhc2UpIGludGVybmFsIHsKICAgICAgICBnb29Qcm9kdWN0aW9uU25hcHNob3RzW21zZy5zZW5kZXJdW2FsbG9jYXRlZEdvb1Jlc2VhcmNoU25hcHNob3RzLmxlbmd0aF0gPSBnZXRHb29Qcm9kdWN0aW9uKG1zZy5zZW5kZXIpICsgaW5jcmVhc2U7CiAgICAgICAgbGFzdEdvb1Byb2R1Y3Rpb25VcGRhdGVbbXNnLnNlbmRlcl0gPSBhbGxvY2F0ZWRHb29SZXNlYXJjaFNuYXBzaG90cy5sZW5ndGg7CiAgICAgICAgdG90YWxHb29Qcm9kdWN0aW9uICs9IGluY3JlYXNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZWR1Y2VQbGF5ZXJzR29vUHJvZHVjdGlvbihhZGRyZXNzIHBsYXllciwgdWludDI1NiBkZWNyZWFzZSkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgcHJldmlvdXNQcm9kdWN0aW9uID0gZ2V0R29vUHJvZHVjdGlvbihwbGF5ZXIpOwogICAgICAgIHVpbnQyNTYgbmV3UHJvZHVjdGlvbiA9IFNhZmVNYXRoLnN1YihwcmV2aW91c1Byb2R1Y3Rpb24sIGRlY3JlYXNlKTsKICAgICAgICAKICAgICAgICBpZiAobmV3UHJvZHVjdGlvbiA9PSAwKSB7IC8vIFNwZWNpYWwgY2FzZSB3aGljaCB0YW5nbGVzIHdpdGggImluYWN0aXZlIGRheSIgc25hcHNob3RzIChjbGFpbWluZyBkaXZzKQogICAgICAgICAgICBnb29Qcm9kdWN0aW9uWmVyb2VkU25hcHNob3RzW3BsYXllcl1bYWxsb2NhdGVkR29vUmVzZWFyY2hTbmFwc2hvdHMubGVuZ3RoXSA9IHRydWU7CiAgICAgICAgICAgIGRlbGV0ZSBnb29Qcm9kdWN0aW9uU25hcHNob3RzW3BsYXllcl1bYWxsb2NhdGVkR29vUmVzZWFyY2hTbmFwc2hvdHMubGVuZ3RoXTsgLy8gMAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdvb1Byb2R1Y3Rpb25TbmFwc2hvdHNbcGxheWVyXVthbGxvY2F0ZWRHb29SZXNlYXJjaFNuYXBzaG90cy5sZW5ndGhdID0gbmV3UHJvZHVjdGlvbjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGFzdEdvb1Byb2R1Y3Rpb25VcGRhdGVbcGxheWVyXSA9IGFsbG9jYXRlZEdvb1Jlc2VhcmNoU25hcHNob3RzLmxlbmd0aDsKICAgICAgICB0b3RhbEdvb1Byb2R1Y3Rpb24gLT0gZGVjcmVhc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJ1eUJhc2ljVW5pdCh1aW50MjU2IHVuaXRJZCwgdWludDI1NiBhbW91bnQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGdhbWVTdGFydGVkKTsKICAgICAgICByZXF1aXJlKHNjaGVtYS52YWxpZFVuaXRJZCh1bml0SWQpKTsKICAgICAgICByZXF1aXJlKHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSArIGFtb3VudCA8PSBNQVhfUFJPRFVDVElPTl9VTklUUyk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB1bml0Q29zdCA9IHNjaGVtYS5nZXRHb29Db3N0Rm9yVW5pdCh1bml0SWQsIHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSwgYW1vdW50KTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA+PSB1bml0Q29zdCk7CiAgICAgICAgcmVxdWlyZShzY2hlbWEudW5pdEV0aENvc3QodW5pdElkKSA9PSAwKTsgLy8gRnJlZSB1bml0CiAgICAgICAgCiAgICAgICAgLy8gVXBkYXRlIHBsYXllcnMgZ29vCiAgICAgICAgdXBkYXRlUGxheWVyc0dvb0Zyb21QdXJjaGFzZShtc2cuc2VuZGVyLCB1bml0Q29zdCk7CiAgICAgICAgCiAgICAgICAgaWYgKHNjaGVtYS51bml0R29vUHJvZHVjdGlvbih1bml0SWQpID4gMCkgewogICAgICAgICAgICBpbmNyZWFzZVBsYXllcnNHb29Qcm9kdWN0aW9uKGdldFVuaXRzUHJvZHVjdGlvbihtc2cuc2VuZGVyLCB1bml0SWQsIGFtb3VudCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1bml0c093bmVkW21zZy5zZW5kZXJdW3VuaXRJZF0gKz0gYW1vdW50OwogICAgICAgIGVtaXQgVW5pdEJvdWdodChtc2cuc2VuZGVyLCB1bml0SWQsIGFtb3VudCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJ1eUV0aFVuaXQodWludDI1NiB1bml0SWQsIHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGdhbWVTdGFydGVkKTsKICAgICAgICByZXF1aXJlKHNjaGVtYS52YWxpZFVuaXRJZCh1bml0SWQpKTsKICAgICAgICByZXF1aXJlKHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSArIGFtb3VudCA8PSBNQVhfUFJPRFVDVElPTl9VTklUUyk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB1bml0Q29zdCA9IHNjaGVtYS5nZXRHb29Db3N0Rm9yVW5pdCh1bml0SWQsIHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSwgYW1vdW50KTsKICAgICAgICB1aW50MjU2IGV0aENvc3QgPSBTYWZlTWF0aC5tdWwoc2NoZW1hLnVuaXRFdGhDb3N0KHVuaXRJZCksIGFtb3VudCk7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2YobXNnLnNlbmRlcikgPj0gdW5pdENvc3QpOwogICAgICAgIHJlcXVpcmUoZXRoQmFsYW5jZVttc2cuc2VuZGVyXSArIG1zZy52YWx1ZSA+PSBldGhDb3N0KTsKICAgICAgICAKICAgICAgICAvLyBVcGRhdGUgcGxheWVycyBnb28KICAgICAgICB1cGRhdGVQbGF5ZXJzR29vRnJvbVB1cmNoYXNlKG1zZy5zZW5kZXIsIHVuaXRDb3N0KTsKCiAgICAgICAgaWYgKGV0aENvc3QgPiBtc2cudmFsdWUpIHsKICAgICAgICAgICAgZXRoQmFsYW5jZVttc2cuc2VuZGVyXSAtPSAoZXRoQ29zdCAtIG1zZy52YWx1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQyNTYgZGV2RnVuZCA9IGV0aENvc3QgLyA1MDsgLy8gMiUgZmVlIG9uIHB1cmNoYXNlcyAobWFya2V0aW5nLCBnYW1lcGxheSAmIG1haW50ZW5hbmNlKQogICAgICAgIHVpbnQyNTYgZGl2aWRlbmRzID0gKGV0aENvc3QgLSBkZXZGdW5kKSAvIDQ7IC8vIDI1JSBnb2VzIHRvIHBvb2wgKDc1JSByZXRhaW5lZCBmb3Igc2FsZSB2YWx1ZSkKICAgICAgICB0b3RhbEV0aGVyR29vUmVzZWFyY2hQb29sICs9IGRpdmlkZW5kczsKICAgICAgICBldGhCYWxhbmNlW293bmVyXSArPSBkZXZGdW5kOwogICAgICAgIAogICAgICAgIGlmIChzY2hlbWEudW5pdEdvb1Byb2R1Y3Rpb24odW5pdElkKSA+IDApIHsKICAgICAgICAgICAgaW5jcmVhc2VQbGF5ZXJzR29vUHJvZHVjdGlvbihnZXRVbml0c1Byb2R1Y3Rpb24obXNnLnNlbmRlciwgdW5pdElkLCBhbW91bnQpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdW5pdHNPd25lZFttc2cuc2VuZGVyXVt1bml0SWRdICs9IGFtb3VudDsKICAgICAgICBlbWl0IFVuaXRCb3VnaHQobXNnLnNlbmRlciwgdW5pdElkLCBhbW91bnQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZWxsVW5pdCh1aW50MjU2IHVuaXRJZCwgdWludDI1NiBhbW91bnQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSA+PSBhbW91bnQpOwogICAgICAgIHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSAtPSBhbW91bnQ7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB1bml0U2FsZVByaWNlID0gKHNjaGVtYS5nZXRHb29Db3N0Rm9yVW5pdCh1bml0SWQsIHVuaXRzT3duZWRbbXNnLnNlbmRlcl1bdW5pdElkXSwgYW1vdW50KSAqIDMpIC8gNDsgLy8gNzUlCiAgICAgICAgdWludDI1NiBnb29DaGFuZ2UgPSBiYWxhbmNlT2ZVbmNsYWltZWRHb28obXNnLnNlbmRlcikgKyB1bml0U2FsZVByaWNlOyAvLyBDbGFpbSB1bnNhdmVkIGdvbyB3aGlsc3QgaGVyZQogICAgICAgIGxhc3RHb29TYXZlVGltZVttc2cuc2VuZGVyXSA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICByb3VnaFN1cHBseSArPSBnb29DaGFuZ2U7CiAgICAgICAgZ29vQmFsYW5jZVttc2cuc2VuZGVyXSArPSBnb29DaGFuZ2U7CiAgICAgICAgCiAgICAgICAgaWYgKHNjaGVtYS51bml0R29vUHJvZHVjdGlvbih1bml0SWQpID4gMCkgewogICAgICAgICAgICByZWR1Y2VQbGF5ZXJzR29vUHJvZHVjdGlvbihtc2cuc2VuZGVyLCBnZXRVbml0c1Byb2R1Y3Rpb24obXNnLnNlbmRlciwgdW5pdElkLCBhbW91bnQpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHNjaGVtYS51bml0RXRoQ29zdCh1bml0SWQpID4gMCkgeyAvLyBQcmVtaXVtIHVuaXRzIHNlbGwgZm9yIDc1JSBvZiBidXkgY29zdAogICAgICAgICAgICBldGhCYWxhbmNlW21zZy5zZW5kZXJdICs9ICgoc2NoZW1hLnVuaXRFdGhDb3N0KHVuaXRJZCkgKiBhbW91bnQpICogMykgLyA0OwogICAgICAgIH0KICAgICAgICBlbWl0IFVuaXRTb2xkKG1zZy5zZW5kZXIsIHVuaXRJZCwgYW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5VXBncmFkZSh1aW50MjU2IHVwZ3JhZGVJZCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShnYW1lU3RhcnRlZCk7CiAgICAgICAgcmVxdWlyZShzY2hlbWEudmFsaWRVcGdyYWRlSWQodXBncmFkZUlkKSk7IC8vIFZhbGlkIHVwZ3JhZGUKICAgICAgICByZXF1aXJlKCF1cGdyYWRlc093bmVkW21zZy5zZW5kZXJdW3VwZ3JhZGVJZF0pOyAvLyBIYXZlbid0IGFscmVhZHkgcHVyY2hhc2VkCiAgICAgICAgCiAgICAgICAgdWludDI1NiBnb29Db3N0OwogICAgICAgIHVpbnQyNTYgZXRoQ29zdDsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVDbGFzczsKICAgICAgICB1aW50MjU2IHVuaXRJZDsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVWYWx1ZTsKICAgICAgICAoZ29vQ29zdCwgZXRoQ29zdCwgdXBncmFkZUNsYXNzLCB1bml0SWQsIHVwZ3JhZGVWYWx1ZSkgPSBzY2hlbWEuZ2V0VXBncmFkZUluZm8odXBncmFkZUlkKTsKICAgICAgICAKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA+PSBnb29Db3N0KTsKICAgICAgICAKICAgICAgICBpZiAoZXRoQ29zdCA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShldGhCYWxhbmNlW21zZy5zZW5kZXJdICsgbXNnLnZhbHVlID49IGV0aENvc3QpOwogICAgICAgICAgICAgaWYgKGV0aENvc3QgPiBtc2cudmFsdWUpIHsgLy8gVGhleSBjYW4gdXNlIHRoZWlyIGJhbGFuY2UgaW5zdGVhZAogICAgICAgICAgICAgICAgZXRoQmFsYW5jZVttc2cuc2VuZGVyXSAtPSAoZXRoQ29zdCAtIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgdWludDI1NiBkZXZGdW5kID0gZXRoQ29zdCAvIDUwOyAvLyAyJSBmZWUgb24gcHVyY2hhc2VzIChtYXJrZXRpbmcsIGdhbWVwbGF5ICYgbWFpbnRlbmFuY2UpCiAgICAgICAgICAgIHRvdGFsRXRoZXJHb29SZXNlYXJjaFBvb2wgKz0gKGV0aENvc3QgLSBkZXZGdW5kKTsgLy8gUmVzdCBnb2VzIHRvIGRpdiBwb29sIChDYW4ndCBzZWxsIHVwZ3JhZGVzKQogICAgICAgICAgICBldGhCYWxhbmNlW293bmVyXSArPSBkZXZGdW5kOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBVcGRhdGUgcGxheWVycyBnb28KICAgICAgICB1cGRhdGVQbGF5ZXJzR29vRnJvbVB1cmNoYXNlKG1zZy5zZW5kZXIsIGdvb0Nvc3QpOwoKICAgICAgICB1cGdyYWRlVW5pdE11bHRpcGxpZXJzKG1zZy5zZW5kZXIsIHVwZ3JhZGVDbGFzcywgdW5pdElkLCB1cGdyYWRlVmFsdWUpOwogICAgICAgIHVwZ3JhZGVzT3duZWRbbXNnLnNlbmRlcl1bdXBncmFkZUlkXSA9IHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVwZ3JhZGVVbml0TXVsdGlwbGllcnMoYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgdXBncmFkZUNsYXNzLCB1aW50MjU2IHVuaXRJZCwgdWludDI1NiB1cGdyYWRlVmFsdWUpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IHByb2R1Y3Rpb25HYWluOwogICAgICAgIGlmICh1cGdyYWRlQ2xhc3MgPT0gMCkgewogICAgICAgICAgICB1bml0R29vUHJvZHVjdGlvbkluY3JlYXNlc1twbGF5ZXJdW3VuaXRJZF0gKz0gdXBncmFkZVZhbHVlOwogICAgICAgICAgICBwcm9kdWN0aW9uR2FpbiA9ICh1bml0c093bmVkW3BsYXllcl1bdW5pdElkXSAqIHVwZ3JhZGVWYWx1ZSAqICgxMCArIHVuaXRHb29Qcm9kdWN0aW9uTXVsdGlwbGllcltwbGF5ZXJdW3VuaXRJZF0pKSAvIDEwOwogICAgICAgICAgICBpbmNyZWFzZVBsYXllcnNHb29Qcm9kdWN0aW9uKHByb2R1Y3Rpb25HYWluKTsKICAgICAgICB9IGVsc2UgaWYgKHVwZ3JhZGVDbGFzcyA9PSAxKSB7CiAgICAgICAgICAgIHVuaXRHb29Qcm9kdWN0aW9uTXVsdGlwbGllcltwbGF5ZXJdW3VuaXRJZF0gKz0gdXBncmFkZVZhbHVlOwogICAgICAgICAgICBwcm9kdWN0aW9uR2FpbiA9ICh1bml0c093bmVkW3BsYXllcl1bdW5pdElkXSAqIHVwZ3JhZGVWYWx1ZSAqIChzY2hlbWEudW5pdEdvb1Byb2R1Y3Rpb24odW5pdElkKSArIHVuaXRHb29Qcm9kdWN0aW9uSW5jcmVhc2VzW3BsYXllcl1bdW5pdElkXSkpIC8gMTA7CiAgICAgICAgICAgIGluY3JlYXNlUGxheWVyc0dvb1Byb2R1Y3Rpb24ocHJvZHVjdGlvbkdhaW4pOwogICAgICAgIH0gZWxzZSBpZiAodXBncmFkZUNsYXNzID09IDIpIHsKICAgICAgICAgICAgdW5pdEF0dGFja0luY3JlYXNlc1twbGF5ZXJdW3VuaXRJZF0gKz0gdXBncmFkZVZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodXBncmFkZUNsYXNzID09IDMpIHsKICAgICAgICAgICAgdW5pdEF0dGFja011bHRpcGxpZXJbcGxheWVyXVt1bml0SWRdICs9IHVwZ3JhZGVWYWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKHVwZ3JhZGVDbGFzcyA9PSA0KSB7CiAgICAgICAgICAgIHVuaXREZWZlbnNlSW5jcmVhc2VzW3BsYXllcl1bdW5pdElkXSArPSB1cGdyYWRlVmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh1cGdyYWRlQ2xhc3MgPT0gNSkgewogICAgICAgICAgICB1bml0RGVmZW5zZU11bHRpcGxpZXJbcGxheWVyXVt1bml0SWRdICs9IHVwZ3JhZGVWYWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKHVwZ3JhZGVDbGFzcyA9PSA2KSB7CiAgICAgICAgICAgIHVuaXRHb29TdGVhbGluZ0luY3JlYXNlc1twbGF5ZXJdW3VuaXRJZF0gKz0gdXBncmFkZVZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodXBncmFkZUNsYXNzID09IDcpIHsKICAgICAgICAgICAgdW5pdEdvb1N0ZWFsaW5nTXVsdGlwbGllcltwbGF5ZXJdW3VuaXRJZF0gKz0gdXBncmFkZVZhbHVlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlVW5pdE11bHRpcGxpZXJzKGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHVwZ3JhZGVDbGFzcywgdWludDI1NiB1bml0SWQsIHVpbnQyNTYgdXBncmFkZVZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBwcm9kdWN0aW9uTG9zczsKICAgICAgICBpZiAodXBncmFkZUNsYXNzID09IDApIHsKICAgICAgICAgICAgdW5pdEdvb1Byb2R1Y3Rpb25JbmNyZWFzZXNbcGxheWVyXVt1bml0SWRdIC09IHVwZ3JhZGVWYWx1ZTsKICAgICAgICAgICAgcHJvZHVjdGlvbkxvc3MgPSAodW5pdHNPd25lZFtwbGF5ZXJdW3VuaXRJZF0gKiB1cGdyYWRlVmFsdWUgKiAoMTAgKyB1bml0R29vUHJvZHVjdGlvbk11bHRpcGxpZXJbcGxheWVyXVt1bml0SWRdKSkgLyAxMDsKICAgICAgICAgICAgcmVkdWNlUGxheWVyc0dvb1Byb2R1Y3Rpb24ocGxheWVyLCBwcm9kdWN0aW9uTG9zcyk7CiAgICAgICAgfSBlbHNlIGlmICh1cGdyYWRlQ2xhc3MgPT0gMSkgewogICAgICAgICAgICB1bml0R29vUHJvZHVjdGlvbk11bHRpcGxpZXJbcGxheWVyXVt1bml0SWRdIC09IHVwZ3JhZGVWYWx1ZTsKICAgICAgICAgICAgcHJvZHVjdGlvbkxvc3MgPSAodW5pdHNPd25lZFtwbGF5ZXJdW3VuaXRJZF0gKiB1cGdyYWRlVmFsdWUgKiAoc2NoZW1hLnVuaXRHb29Qcm9kdWN0aW9uKHVuaXRJZCkgKyB1bml0R29vUHJvZHVjdGlvbkluY3JlYXNlc1twbGF5ZXJdW3VuaXRJZF0pKSAvIDEwOwogICAgICAgICAgICByZWR1Y2VQbGF5ZXJzR29vUHJvZHVjdGlvbihwbGF5ZXIsIHByb2R1Y3Rpb25Mb3NzKTsKICAgICAgICB9IGVsc2UgaWYgKHVwZ3JhZGVDbGFzcyA9PSAyKSB7CiAgICAgICAgICAgIHVuaXRBdHRhY2tJbmNyZWFzZXNbcGxheWVyXVt1bml0SWRdIC09IHVwZ3JhZGVWYWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKHVwZ3JhZGVDbGFzcyA9PSAzKSB7CiAgICAgICAgICAgIHVuaXRBdHRhY2tNdWx0aXBsaWVyW3BsYXllcl1bdW5pdElkXSAtPSB1cGdyYWRlVmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh1cGdyYWRlQ2xhc3MgPT0gNCkgewogICAgICAgICAgICB1bml0RGVmZW5zZUluY3JlYXNlc1twbGF5ZXJdW3VuaXRJZF0gLT0gdXBncmFkZVZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodXBncmFkZUNsYXNzID09IDUpIHsKICAgICAgICAgICAgdW5pdERlZmVuc2VNdWx0aXBsaWVyW3BsYXllcl1bdW5pdElkXSAtPSB1cGdyYWRlVmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh1cGdyYWRlQ2xhc3MgPT0gNikgewogICAgICAgICAgICB1bml0R29vU3RlYWxpbmdJbmNyZWFzZXNbcGxheWVyXVt1bml0SWRdIC09IHVwZ3JhZGVWYWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKHVwZ3JhZGVDbGFzcyA9PSA3KSB7CiAgICAgICAgICAgIHVuaXRHb29TdGVhbGluZ011bHRpcGxpZXJbcGxheWVyXVt1bml0SWRdIC09IHVwZ3JhZGVWYWx1ZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJ1eVJhcmVJdGVtKHVpbnQyNTYgcmFyZUlkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKHNjaGVtYS52YWxpZFJhcmVJZChyYXJlSWQpKTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHByZXZpb3VzT3duZXIgPSByYXJlSXRlbU93bmVyW3JhcmVJZF07CiAgICAgICAgcmVxdWlyZShwcmV2aW91c093bmVyICE9IDApOwoKICAgICAgICB1aW50MjU2IGV0aENvc3QgPSByYXJlSXRlbVByaWNlW3JhcmVJZF07CiAgICAgICAgcmVxdWlyZShldGhCYWxhbmNlW21zZy5zZW5kZXJdICsgbXNnLnZhbHVlID49IGV0aENvc3QpOwogICAgICAgIAogICAgICAgIC8vIFdlIGhhdmUgdG8gY2xhaW0gYnV5ZXIncyBnb28gYmVmb3JlIHVwZGF0aW5nIHRoZWlyIHByb2R1Y3Rpb24gdmFsdWVzCiAgICAgICAgdXBkYXRlUGxheWVyc0dvbyhtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHVwZ3JhZGVDbGFzczsKICAgICAgICB1aW50MjU2IHVuaXRJZDsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVWYWx1ZTsKICAgICAgICAodXBncmFkZUNsYXNzLCB1bml0SWQsIHVwZ3JhZGVWYWx1ZSkgPSBzY2hlbWEuZ2V0UmFyZUluZm8ocmFyZUlkKTsKICAgICAgICB1cGdyYWRlVW5pdE11bHRpcGxpZXJzKG1zZy5zZW5kZXIsIHVwZ3JhZGVDbGFzcywgdW5pdElkLCB1cGdyYWRlVmFsdWUpOwogICAgICAgIAogICAgICAgIC8vIFdlIGhhdmUgdG8gY2xhaW0gc2VsbGVyJ3MgZ29vIGJlZm9yZSByZWR1Y2luZyB0aGVpciBwcm9kdWN0aW9uIHZhbHVlcwogICAgICAgIHVwZGF0ZVBsYXllcnNHb28ocHJldmlvdXNPd25lcik7CiAgICAgICAgcmVtb3ZlVW5pdE11bHRpcGxpZXJzKHByZXZpb3VzT3duZXIsIHVwZ3JhZGVDbGFzcywgdW5pdElkLCB1cGdyYWRlVmFsdWUpOwogICAgICAgIAogICAgICAgIC8vIFNwbGl0YmlkL092ZXJiaWQKICAgICAgICBpZiAoZXRoQ29zdCA+IG1zZy52YWx1ZSkgewogICAgICAgICAgICAvLyBFYXJsaWVyIHJlcXVpcmUoKSBzYWlkIHRoZXkgY2FuIHN0aWxsIGFmZm9yZCBpdCAoc28gdXNlIHRoZWlyIGluZ2FtZSBiYWxhbmNlKQogICAgICAgICAgICBldGhCYWxhbmNlW21zZy5zZW5kZXJdIC09IChldGhDb3N0IC0gbXNnLnZhbHVlKTsKICAgICAgICB9IGVsc2UgaWYgKG1zZy52YWx1ZSA+IGV0aENvc3QpIHsKICAgICAgICAgICAgLy8gU3RvcmUgb3ZlcmJpZCBpbiB0aGVpciBiYWxhbmNlCiAgICAgICAgICAgIGV0aEJhbGFuY2VbbXNnLnNlbmRlcl0gKz0gbXNnLnZhbHVlIC0gZXRoQ29zdDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRGlzdHJpYnV0ZSBldGhDb3N0CiAgICAgICAgdWludDI1NiBkZXZGdW5kID0gZXRoQ29zdCAvIDUwOyAvLyAyJSBmZWUgb24gcHVyY2hhc2VzIChtYXJrZXRpbmcsIGdhbWVwbGF5ICYgbWFpbnRlbmFuY2UpCiAgICAgICAgdWludDI1NiBkaXZpZGVuZHMgPSBldGhDb3N0IC8gMjA7IC8vIDUlIGdvZXMgdG8gcG9vbCAofjkzJSBnb2VzIHRvIHBsYXllcikKICAgICAgICB0b3RhbEV0aGVyR29vUmVzZWFyY2hQb29sICs9IGRpdmlkZW5kczsKICAgICAgICBldGhCYWxhbmNlW293bmVyXSArPSBkZXZGdW5kOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIC8gdXBkYXRlIHJhcmUgaXRlbQogICAgICAgIHJhcmVJdGVtT3duZXJbcmFyZUlkXSA9IG1zZy5zZW5kZXI7CiAgICAgICAgcmFyZUl0ZW1QcmljZVtyYXJlSWRdID0gKGV0aENvc3QgKiA1KSAvIDQ7IC8vIDI1JSBwcmljZSBmbGlwIGluY3JlYXNlCiAgICAgICAgZXRoQmFsYW5jZVtwcmV2aW91c093bmVyXSArPSBldGhDb3N0IC0gKGRpdmlkZW5kcyArIGRldkZ1bmQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhbW91bnQgPD0gZXRoQmFsYW5jZVttc2cuc2VuZGVyXSk7CiAgICAgICAgZXRoQmFsYW5jZVttc2cuc2VuZGVyXSAtPSBhbW91bnQ7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjbGFpbVJlc2VhcmNoRGl2aWRlbmRzKGFkZHJlc3MgcmVmZXJlciwgdWludDI1NiBzdGFydFNuYXBzaG90LCB1aW50MjU2IGVuZFNuYXBTaG90KSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShzdGFydFNuYXBzaG90IDw9IGVuZFNuYXBTaG90KTsKICAgICAgICByZXF1aXJlKHN0YXJ0U25hcHNob3QgPj0gbGFzdEdvb1Jlc2VhcmNoRnVuZENsYWltW21zZy5zZW5kZXJdKTsKICAgICAgICByZXF1aXJlKGVuZFNuYXBTaG90IDwgYWxsb2NhdGVkR29vUmVzZWFyY2hTbmFwc2hvdHMubGVuZ3RoKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHJlc2VhcmNoU2hhcmU7CiAgICAgICAgdWludDI1NiBwcmV2aW91c1Byb2R1Y3Rpb24gPSBnb29Qcm9kdWN0aW9uU25hcHNob3RzW21zZy5zZW5kZXJdW2xhc3RHb29SZXNlYXJjaEZ1bmRDbGFpbVttc2cuc2VuZGVyXSAtIDFdOyAvLyBVbmRlcmZsb3cgd29uJ3QgYmUgYSBwcm9ibGVtIGFzIGdvb1Byb2R1Y3Rpb25TbmFwc2hvdHNbXVsweGZmZmZmZmZmZmZdID0gMDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IHN0YXJ0U25hcHNob3Q7IGkgPD0gZW5kU25hcFNob3Q7IGkrKykgewogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2xpZ2h0bHkgY29tcGxleCB0aGluZ3MgYnkgYWNjb3VudGluZyBmb3IgZGF5cy9zbmFwc2hvdHMgd2hlbiB1c2VyIG1hZGUgbm8gdHgncwogICAgICAgICAgICB1aW50MjU2IHByb2R1Y3Rpb25EdXJpbmdTbmFwc2hvdCA9IGdvb1Byb2R1Y3Rpb25TbmFwc2hvdHNbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgIGJvb2wgc29sZEFsbFByb2R1Y3Rpb24gPSBnb29Qcm9kdWN0aW9uWmVyb2VkU25hcHNob3RzW21zZy5zZW5kZXJdW2ldOwogICAgICAgICAgICBpZiAocHJvZHVjdGlvbkR1cmluZ1NuYXBzaG90ID09IDAgJiYgIXNvbGRBbGxQcm9kdWN0aW9uKSB7CiAgICAgICAgICAgICAgICBwcm9kdWN0aW9uRHVyaW5nU25hcHNob3QgPSBwcmV2aW91c1Byb2R1Y3Rpb247CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIHByZXZpb3VzUHJvZHVjdGlvbiA9IHByb2R1Y3Rpb25EdXJpbmdTbmFwc2hvdDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzZWFyY2hTaGFyZSArPSAoYWxsb2NhdGVkR29vUmVzZWFyY2hTbmFwc2hvdHNbaV0gKiBwcm9kdWN0aW9uRHVyaW5nU25hcHNob3QpIC8gdG90YWxHb29Qcm9kdWN0aW9uU25hcHNob3RzW2ldOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAoZ29vUHJvZHVjdGlvblNuYXBzaG90c1ttc2cuc2VuZGVyXVtlbmRTbmFwU2hvdF0gPT0gMCAmJiAhZ29vUHJvZHVjdGlvblplcm9lZFNuYXBzaG90c1ttc2cuc2VuZGVyXVtpXSAmJiBwcmV2aW91c1Byb2R1Y3Rpb24gPiAwKSB7CiAgICAgICAgICAgIGdvb1Byb2R1Y3Rpb25TbmFwc2hvdHNbbXNnLnNlbmRlcl1bZW5kU25hcFNob3RdID0gcHJldmlvdXNQcm9kdWN0aW9uOyAvLyBDaGVja3BvaW50IGZvciBuZXh0IGNsYWltCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxhc3RHb29SZXNlYXJjaEZ1bmRDbGFpbVttc2cuc2VuZGVyXSA9IGVuZFNuYXBTaG90ICsgMTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHJlZmVyYWxEaXZzOwogICAgICAgIGlmIChyZWZlcmVyICE9IGFkZHJlc3MoMCkgJiYgcmVmZXJlciAhPSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIHJlZmVyYWxEaXZzID0gcmVzZWFyY2hTaGFyZSAvIDEwMDsgLy8gMSUKICAgICAgICAgICAgZXRoQmFsYW5jZVtyZWZlcmVyXSArPSByZWZlcmFsRGl2czsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZXRoQmFsYW5jZVttc2cuc2VuZGVyXSArPSByZXNlYXJjaFNoYXJlIC0gcmVmZXJhbERpdnM7CiAgICB9CiAgICAKICAgIC8vIEFsbG9jYXRlIGRpdnMgZm9yIHRoZSBkYXkgKGNyb24gam9iKQogICAgZnVuY3Rpb24gc25hcHNob3REYWlseUdvb1Jlc2VhcmNoRnVuZGluZygpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIC8vcmVxdWlyZShibG9jay50aW1lc3RhbXAgPj0gKG5leHRTbmFwc2hvdFRpbWUgLSAzMCBtaW51dGVzKSk7IC8vIFNtYWxsIGJpdCBvZiBsZWV3YXkgZm9yIGNyb24gLyBuZXR3b3JrCiAgICAgICAgCiAgICAgICAgdWludDI1NiB0b2RheXNFdGhlclJlc2VhcmNoRnVuZCA9ICh0b3RhbEV0aGVyR29vUmVzZWFyY2hQb29sIC8gMTApOyAvLyAxMCUgb2YgcG9vbCBkYWlseQogICAgICAgIHRvdGFsRXRoZXJHb29SZXNlYXJjaFBvb2wgLT0gdG9kYXlzRXRoZXJSZXNlYXJjaEZ1bmQ7CiAgICAgICAgCiAgICAgICAgdG90YWxHb29Qcm9kdWN0aW9uU25hcHNob3RzLnB1c2godG90YWxHb29Qcm9kdWN0aW9uKTsKICAgICAgICBhbGxvY2F0ZWRHb29SZXNlYXJjaFNuYXBzaG90cy5wdXNoKHRvZGF5c0V0aGVyUmVzZWFyY2hGdW5kKTsKICAgICAgICBuZXh0U25hcHNob3RUaW1lID0gYmxvY2sudGltZXN0YW1wICsgMjQgaG91cnM7CiAgICB9CiAgICAKICAgIAogICAgCiAgICAvLyBSYWZmbGUgZm9yIHJhcmUgaXRlbXMKICAgIGZ1bmN0aW9uIGJ1eVJhZmZsZVRpY2tldCh1aW50MjU2IGFtb3VudCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUocmFmZmxlRW5kVGltZSA+PSBibG9jay50aW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUoYW1vdW50ID4gMCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB0aWNrZXRzQ29zdCA9IFNhZmVNYXRoLm11bChSQUZGTEVfVElDS0VUX0JBU0VfR09PX1BSSUNFLCBhbW91bnQpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IHRpY2tldHNDb3N0KTsKICAgICAgICAKICAgICAgICAvLyBVcGRhdGUgcGxheWVycyBnb28KICAgICAgICB1cGRhdGVQbGF5ZXJzR29vRnJvbVB1cmNoYXNlKG1zZy5zZW5kZXIsIHRpY2tldHNDb3N0KTsKICAgICAgICAKICAgICAgICAvLyBIYW5kbGUgbmV3IHRpY2tldHMKICAgICAgICBUaWNrZXRQdXJjaGFzZXMgc3RvcmFnZSBwdXJjaGFzZXMgPSB0aWNrZXRzQm91Z2h0QnlQbGF5ZXJbbXNnLnNlbmRlcl07CiAgICAgICAgCiAgICAgICAgLy8gSWYgd2UgbmVlZCB0byByZXNldCB0aWNrZXRzIGZyb20gYSBwcmV2aW91cyByYWZmbGUKICAgICAgICBpZiAocHVyY2hhc2VzLnJhZmZsZVJhcmVJZCAhPSByYWZmbGVSYXJlSWQpIHsKICAgICAgICAgICAgcHVyY2hhc2VzLm51bVB1cmNoYXNlcyA9IDA7CiAgICAgICAgICAgIHB1cmNoYXNlcy5yYWZmbGVSYXJlSWQgPSByYWZmbGVSYXJlSWQ7CiAgICAgICAgICAgIHJhZmZsZVBsYXllcnNbcmFmZmxlUmFyZUlkXS5wdXNoKG1zZy5zZW5kZXIpOyAvLyBBZGQgdXNlciB0byByYWZmbGUKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gU3RvcmUgbmV3IHRpY2tldCBwdXJjaGFzZSAKICAgICAgICBpZiAocHVyY2hhc2VzLm51bVB1cmNoYXNlcyA9PSBwdXJjaGFzZXMudGlja2V0c0JvdWdodC5sZW5ndGgpIHsKICAgICAgICAgICAgcHVyY2hhc2VzLnRpY2tldHNCb3VnaHQubGVuZ3RoICs9IDE7CiAgICAgICAgfQogICAgICAgIHB1cmNoYXNlcy50aWNrZXRzQm91Z2h0W3B1cmNoYXNlcy5udW1QdXJjaGFzZXMrK10gPSBUaWNrZXRQdXJjaGFzZShyYWZmbGVUaWNrZXRzQm91Z2h0LCByYWZmbGVUaWNrZXRzQm91Z2h0ICsgKGFtb3VudCAtIDEpKTsgLy8gKGVnOiBidXkgMTAsIGdldCBpZCdzIDAtOSkKICAgICAgICAKICAgICAgICAvLyBGaW5hbGx5IHVwZGF0ZSB0aWNrZXQgdG90YWwKICAgICAgICByYWZmbGVUaWNrZXRzQm91Z2h0ICs9IGFtb3VudDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RhcnRSYXJlUmFmZmxlKHVpbnQyNTYgZW5kVGltZSwgdWludDI1NiByYXJlSWQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHJlcXVpcmUoc2NoZW1hLnZhbGlkUmFyZUlkKHJhcmVJZCkpOwogICAgICAgIHJlcXVpcmUocmFyZUl0ZW1Pd25lcltyYXJlSWRdID09IDApOwogICAgICAgIAogICAgICAgIC8vIFJlc2V0IHByZXZpb3VzIHJhZmZsZSBpbmZvCiAgICAgICAgcmFmZmxlV2lubmluZ1RpY2tldFNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgcmFmZmxlVGlja2V0VGhhdFdvbiA9IDA7CiAgICAgICAgcmFmZmxlV2lubmVyID0gMDsKICAgICAgICByYWZmbGVUaWNrZXRzQm91Z2h0ID0gMDsKICAgICAgICAKICAgICAgICAvLyBTZXQgY3VycmVudCByYWZmbGUgaW5mbwogICAgICAgIHJhZmZsZUVuZFRpbWUgPSBlbmRUaW1lOwogICAgICAgIHJhZmZsZVJhcmVJZCA9IHJhcmVJZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYXdhcmRSYWZmbGVQcml6ZShhZGRyZXNzIGNoZWNrV2lubmVyLCB1aW50MjU2IGNoZWNrSW5kZXgpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKHJhZmZsZUVuZFRpbWUgPCBibG9jay50aW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUocmFmZmxlV2lubmVyID09IDApOwogICAgICAgIHJlcXVpcmUocmFyZUl0ZW1Pd25lcltyYWZmbGVSYXJlSWRdID09IDApOwogICAgICAgIAogICAgICAgIGlmICghcmFmZmxlV2lubmluZ1RpY2tldFNlbGVjdGVkKSB7CiAgICAgICAgICAgIGRyYXdSYW5kb21XaW5uZXIoKTsgLy8gSWRlYWxseSBkbyBpdCBpbiBvbmUgY2FsbCAoZ2FzIGxpbWl0IGNhdXRpb3VzKQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBSZWR1Y2UgZ2FzIGJ5IChvcHRpb25hbGx5KSBvZmZlcmluZyBhbiBhZGRyZXNzIHRvIF9jaGVja18gZm9yIHdpbm5lcgogICAgICAgIGlmIChjaGVja1dpbm5lciAhPSAwKSB7CiAgICAgICAgICAgIFRpY2tldFB1cmNoYXNlcyBzdG9yYWdlIHRpY2tldHMgPSB0aWNrZXRzQm91Z2h0QnlQbGF5ZXJbY2hlY2tXaW5uZXJdOwogICAgICAgICAgICBpZiAodGlja2V0cy5udW1QdXJjaGFzZXMgPiAwICYmIGNoZWNrSW5kZXggPCB0aWNrZXRzLm51bVB1cmNoYXNlcyAmJiB0aWNrZXRzLnJhZmZsZVJhcmVJZCA9PSByYWZmbGVSYXJlSWQpIHsKICAgICAgICAgICAgICAgIFRpY2tldFB1cmNoYXNlIHN0b3JhZ2UgY2hlY2tUaWNrZXQgPSB0aWNrZXRzLnRpY2tldHNCb3VnaHRbY2hlY2tJbmRleF07CiAgICAgICAgICAgICAgICBpZiAocmFmZmxlVGlja2V0VGhhdFdvbiA+PSBjaGVja1RpY2tldC5zdGFydElkICYmIHJhZmZsZVRpY2tldFRoYXRXb24gPD0gY2hlY2tUaWNrZXQuZW5kSWQpIHsKICAgICAgICAgICAgICAgICAgICBhc3NpZ25SYWZmbGVQcml6ZShjaGVja1dpbm5lcik7IC8vIFdJTk5FUiEKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gT3RoZXJ3aXNlIGp1c3QgbmFpdmVseSB0cnkgdG8gZmluZCB0aGUgd2lubmVyICh3aWxsIHdvcmsgdW50aWwgbWFzcyBhbW91bnRzIG9mIHBsYXllcnMpCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgcmFmZmxlUGxheWVyc1tyYWZmbGVSYXJlSWRdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgcGxheWVyID0gcmFmZmxlUGxheWVyc1tyYWZmbGVSYXJlSWRdW2ldOwogICAgICAgICAgICBUaWNrZXRQdXJjaGFzZXMgc3RvcmFnZSBwbGF5ZXJzVGlja2V0cyA9IHRpY2tldHNCb3VnaHRCeVBsYXllcltwbGF5ZXJdOwogICAgICAgICAgICAKICAgICAgICAgICAgdWludDI1NiBlbmRJbmRleCA9IHBsYXllcnNUaWNrZXRzLm51bVB1cmNoYXNlcyAtIDE7CiAgICAgICAgICAgIC8vIE1pbm9yIG9wdGltaXphdGlvbiB0byBhdm9pZCBjaGVja2luZyBldmVyeSBzaW5nbGUgcGxheWVyCiAgICAgICAgICAgIGlmIChyYWZmbGVUaWNrZXRUaGF0V29uID49IHBsYXllcnNUaWNrZXRzLnRpY2tldHNCb3VnaHRbMF0uc3RhcnRJZCAmJiByYWZmbGVUaWNrZXRUaGF0V29uIDw9IHBsYXllcnNUaWNrZXRzLnRpY2tldHNCb3VnaHRbZW5kSW5kZXhdLmVuZElkKSB7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQyNTYgaiA9IDA7IGogPCBwbGF5ZXJzVGlja2V0cy5udW1QdXJjaGFzZXM7IGorKykgewogICAgICAgICAgICAgICAgICAgIFRpY2tldFB1cmNoYXNlIHN0b3JhZ2UgcGxheWVyVGlja2V0ID0gcGxheWVyc1RpY2tldHMudGlja2V0c0JvdWdodFtqXTsKICAgICAgICAgICAgICAgICAgICBpZiAocmFmZmxlVGlja2V0VGhhdFdvbiA+PSBwbGF5ZXJUaWNrZXQuc3RhcnRJZCAmJiByYWZmbGVUaWNrZXRUaGF0V29uIDw9IHBsYXllclRpY2tldC5lbmRJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25SYWZmbGVQcml6ZShwbGF5ZXIpOyAvLyBXSU5ORVIhCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFzc2lnblJhZmZsZVByaXplKGFkZHJlc3Mgd2lubmVyKSBpbnRlcm5hbCB7CiAgICAgICAgcmFmZmxlV2lubmVyID0gd2lubmVyOwogICAgICAgIHJhcmVJdGVtT3duZXJbcmFmZmxlUmFyZUlkXSA9IHdpbm5lcjsKICAgICAgICByYXJlSXRlbVByaWNlW3JhZmZsZVJhcmVJZF0gPSAoc2NoZW1hLnJhcmVTdGFydFByaWNlKHJhZmZsZVJhcmVJZCkgKiAyMSkgLyAyMDsgLy8gQnV5IHByaWNlIHNsaWdodGx5IGhpZ2hlciAoRGl2IHBvb2wgY3V0KQogICAgICAgIAogICAgICAgIHVwZGF0ZVBsYXllcnNHb28od2lubmVyKTsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVDbGFzczsKICAgICAgICB1aW50MjU2IHVuaXRJZDsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVWYWx1ZTsKICAgICAgICAodXBncmFkZUNsYXNzLCB1bml0SWQsIHVwZ3JhZGVWYWx1ZSkgPSBzY2hlbWEuZ2V0UmFyZUluZm8ocmFmZmxlUmFyZUlkKTsKICAgICAgICB1cGdyYWRlVW5pdE11bHRpcGxpZXJzKHdpbm5lciwgdXBncmFkZUNsYXNzLCB1bml0SWQsIHVwZ3JhZGVWYWx1ZSk7CiAgICB9CiAgICAKICAgIC8vIFJhbmRvbSBlbm91Z2ggZm9yIHNtYWxsIGNvbnRlc3RzIChPd25lciBvbmx5IHRvIHByZXZlbnQgdHJpYWwgJiBlcnJvciBleGVjdXRpb24pCiAgICBmdW5jdGlvbiBkcmF3UmFuZG9tV2lubmVyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHJlcXVpcmUocmFmZmxlRW5kVGltZSA8IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgcmVxdWlyZSghcmFmZmxlV2lubmluZ1RpY2tldFNlbGVjdGVkKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHNlZWQgPSByYWZmbGVUaWNrZXRzQm91Z2h0ICsgYmxvY2sudGltZXN0YW1wOwogICAgICAgIHJhZmZsZVRpY2tldFRoYXRXb24gPSBhZGRtb2QodWludDI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSwgc2VlZCwgcmFmZmxlVGlja2V0c0JvdWdodCk7CiAgICAgICAgcmFmZmxlV2lubmluZ1RpY2tldFNlbGVjdGVkID0gdHJ1ZTsKICAgIH0KICAgIAogICAgCiAgICAKICAgIGZ1bmN0aW9uIHByb3RlY3RBZGRyZXNzKGFkZHJlc3MgZXhjaGFuZ2UsIGJvb2wgaXNQcm90ZWN0ZWQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHJlcXVpcmUoZ2V0R29vUHJvZHVjdGlvbihleGNoYW5nZSkgPT0gMCk7IC8vIENhbid0IHByb3RlY3QgYWN0dWFsIHBsYXllcnMKICAgICAgICBwcm90ZWN0ZWRBZGRyZXNzZXNbZXhjaGFuZ2VdID0gaXNQcm90ZWN0ZWQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGF0dGFja1BsYXllcihhZGRyZXNzIHRhcmdldCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYmF0dGxlQ29vbGRvd25bbXNnLnNlbmRlcl0gPCBibG9jay50aW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUodGFyZ2V0ICE9IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoIXByb3RlY3RlZEFkZHJlc3Nlc1t0YXJnZXRdKTsgLy90YXJnZXQgbm90IHdoaXRlbGlzdGVkIChpLmUuIGV4Y2hhbmdlIHdhbGxldHMpCiAgICAgICAgCiAgICAgICAgdWludDI1NiBhdHRhY2tpbmdQb3dlcjsKICAgICAgICB1aW50MjU2IGRlZmVuZGluZ1Bvd2VyOwogICAgICAgIHVpbnQyNTYgc3RlYWxpbmdQb3dlcjsKICAgICAgICAoYXR0YWNraW5nUG93ZXIsIGRlZmVuZGluZ1Bvd2VyLCBzdGVhbGluZ1Bvd2VyKSA9IGdldFBsYXllcnNCYXR0bGVQb3dlcihtc2cuc2VuZGVyLCB0YXJnZXQpOwogICAgICAgIAogICAgICAgIGlmIChiYXR0bGVDb29sZG93blt0YXJnZXRdID4gYmxvY2sudGltZXN0YW1wKSB7IC8vIFdoZW4gb24gYmF0dGxlIGNvb2xkb3duIHlvdSdyZSB2dWxuZXJhYmxlIChzdGFydGluZyB2YWx1ZSBpcyA1MCUgbm9ybWFsIHBvd2VyKQogICAgICAgICAgICBkZWZlbmRpbmdQb3dlciA9IHNjaGVtYS5nZXRXZWFrZW5lZERlZmVuc2VQb3dlcihkZWZlbmRpbmdQb3dlcik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChhdHRhY2tpbmdQb3dlciA+IGRlZmVuZGluZ1Bvd2VyKSB7CiAgICAgICAgICAgIGJhdHRsZUNvb2xkb3duW21zZy5zZW5kZXJdID0gYmxvY2sudGltZXN0YW1wICsgMzAgbWludXRlczsKICAgICAgICAgICAgaWYgKGJhbGFuY2VPZih0YXJnZXQpID4gc3RlYWxpbmdQb3dlcikgewogICAgICAgICAgICAgICAgLy8gU2F2ZSBhbGwgdGhlaXIgdW5jbGFpbWVkIGdvbywgdGhlbiBzdGVhbCBhdHRhY2tlcidzIG1heCBjYXBhY2l0eSAoYXQgc2FtZSB0aW1lKQogICAgICAgICAgICAgICAgdWludDI1NiB1bmNsYWltZWRHb28gPSBiYWxhbmNlT2ZVbmNsYWltZWRHb28odGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmIChzdGVhbGluZ1Bvd2VyID4gdW5jbGFpbWVkR29vKSB7CiAgICAgICAgICAgICAgICAgICAgdWludDI1NiBnb29EZWNyZWFzZSA9IHN0ZWFsaW5nUG93ZXIgLSB1bmNsYWltZWRHb287CiAgICAgICAgICAgICAgICAgICAgZ29vQmFsYW5jZVt0YXJnZXRdIC09IGdvb0RlY3JlYXNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGdvb0dhaW4gPSB1bmNsYWltZWRHb28gLSBzdGVhbGluZ1Bvd2VyOwogICAgICAgICAgICAgICAgICAgIGdvb0JhbGFuY2VbdGFyZ2V0XSArPSBnb29HYWluOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZ29vQmFsYW5jZVttc2cuc2VuZGVyXSArPSBzdGVhbGluZ1Bvd2VyOwogICAgICAgICAgICAgICAgZW1pdCBQbGF5ZXJBdHRhY2tlZChtc2cuc2VuZGVyLCB0YXJnZXQsIHRydWUsIHN0ZWFsaW5nUG93ZXIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZW1pdCBQbGF5ZXJBdHRhY2tlZChtc2cuc2VuZGVyLCB0YXJnZXQsIHRydWUsIGJhbGFuY2VPZih0YXJnZXQpKTsKICAgICAgICAgICAgICAgIGdvb0JhbGFuY2VbbXNnLnNlbmRlcl0gKz0gYmFsYW5jZU9mKHRhcmdldCk7CiAgICAgICAgICAgICAgICBnb29CYWxhbmNlW3RhcmdldF0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBsYXN0R29vU2F2ZVRpbWVbdGFyZ2V0XSA9IGJsb2NrLnRpbWVzdGFtcDsgCiAgICAgICAgICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gY2xhaW0vc2F2ZSBtc2cuc2VuZGVyJ3MgZ29vIChhcyBwcm9kdWN0aW9uIGRlbHRhIGlzIHVuY2hhbmdlZCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiYXR0bGVDb29sZG93blttc2cuc2VuZGVyXSA9IGJsb2NrLnRpbWVzdGFtcCArIDEwIG1pbnV0ZXM7CiAgICAgICAgICAgIGVtaXQgUGxheWVyQXR0YWNrZWQobXNnLnNlbmRlciwgdGFyZ2V0LCBmYWxzZSwgMCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRQbGF5ZXJzQmF0dGxlUG93ZXIoYWRkcmVzcyBhdHRhY2tlciwgYWRkcmVzcyBkZWZlbmRlcikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NikgewogICAgICAgIHVpbnQyNTYgc3RhcnRJZDsKICAgICAgICB1aW50MjU2IGVuZElkOwogICAgICAgIChzdGFydElkLCBlbmRJZCkgPSBzY2hlbWEuYmF0dGxlVW5pdElkUmFuZ2UoKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGF0dGFja2luZ1Bvd2VyOwogICAgICAgIHVpbnQyNTYgZGVmZW5kaW5nUG93ZXI7CiAgICAgICAgdWludDI1NiBzdGVhbGluZ1Bvd2VyOwoKICAgICAgICAvLyBOb3QgaWRlYWwgYnV0IHdpbGwgb25seSBiZSBhIHNtYWxsIG51bWJlciBvZiB1bml0cyAoYW5kIHNhdmVzIGdhcyB3aGVuIGJ1eWluZyB1bml0cykKICAgICAgICB3aGlsZSAoc3RhcnRJZCA8PSBlbmRJZCkgewogICAgICAgICAgICBhdHRhY2tpbmdQb3dlciArPSBnZXRVbml0c0F0dGFjayhhdHRhY2tlciwgc3RhcnRJZCwgdW5pdHNPd25lZFthdHRhY2tlcl1bc3RhcnRJZF0pOwogICAgICAgICAgICBzdGVhbGluZ1Bvd2VyICs9IGdldFVuaXRzU3RlYWxpbmdDYXBhY2l0eShhdHRhY2tlciwgc3RhcnRJZCwgdW5pdHNPd25lZFthdHRhY2tlcl1bc3RhcnRJZF0pOwogICAgICAgICAgICAKICAgICAgICAgICAgZGVmZW5kaW5nUG93ZXIgKz0gZ2V0VW5pdHNEZWZlbnNlKGRlZmVuZGVyLCBzdGFydElkLCB1bml0c093bmVkW2RlZmVuZGVyXVtzdGFydElkXSk7CiAgICAgICAgICAgIHN0YXJ0SWQrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChhdHRhY2tpbmdQb3dlciwgZGVmZW5kaW5nUG93ZXIsIHN0ZWFsaW5nUG93ZXIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRQbGF5ZXJzQmF0dGxlU3RhdHMoYWRkcmVzcyBwbGF5ZXIpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHN0YXJ0SWQ7CiAgICAgICAgdWludDI1NiBlbmRJZDsKICAgICAgICAoc3RhcnRJZCwgZW5kSWQpID0gc2NoZW1hLmJhdHRsZVVuaXRJZFJhbmdlKCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBhdHRhY2tpbmdQb3dlcjsKICAgICAgICB1aW50MjU2IGRlZmVuZGluZ1Bvd2VyOwogICAgICAgIHVpbnQyNTYgc3RlYWxpbmdQb3dlcjsKCiAgICAgICAgLy8gTm90IGlkZWFsIGJ1dCB3aWxsIG9ubHkgYmUgYSBzbWFsbCBudW1iZXIgb2YgdW5pdHMgKGFuZCBzYXZlcyBnYXMgd2hlbiBidXlpbmcgdW5pdHMpCiAgICAgICAgd2hpbGUgKHN0YXJ0SWQgPD0gZW5kSWQpIHsKICAgICAgICAgICAgYXR0YWNraW5nUG93ZXIgKz0gZ2V0VW5pdHNBdHRhY2socGxheWVyLCBzdGFydElkLCB1bml0c093bmVkW3BsYXllcl1bc3RhcnRJZF0pOwogICAgICAgICAgICBzdGVhbGluZ1Bvd2VyICs9IGdldFVuaXRzU3RlYWxpbmdDYXBhY2l0eShwbGF5ZXIsIHN0YXJ0SWQsIHVuaXRzT3duZWRbcGxheWVyXVtzdGFydElkXSk7CiAgICAgICAgICAgIGRlZmVuZGluZ1Bvd2VyICs9IGdldFVuaXRzRGVmZW5zZShwbGF5ZXIsIHN0YXJ0SWQsIHVuaXRzT3duZWRbcGxheWVyXVtzdGFydElkXSk7CiAgICAgICAgICAgIHN0YXJ0SWQrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChhdHRhY2tpbmdQb3dlciwgZGVmZW5kaW5nUG93ZXIsIHN0ZWFsaW5nUG93ZXIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRVbml0c1Byb2R1Y3Rpb24oYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgdW5pdElkLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiAoYW1vdW50ICogKHNjaGVtYS51bml0R29vUHJvZHVjdGlvbih1bml0SWQpICsgdW5pdEdvb1Byb2R1Y3Rpb25JbmNyZWFzZXNbcGxheWVyXVt1bml0SWRdKSAqICgxMCArIHVuaXRHb29Qcm9kdWN0aW9uTXVsdGlwbGllcltwbGF5ZXJdW3VuaXRJZF0pKSAvIDEwOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRVbml0c0F0dGFjayhhZGRyZXNzIHBsYXllciwgdWludDI1NiB1bml0SWQsIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIChhbW91bnQgKiAoc2NoZW1hLnVuaXRBdHRhY2sodW5pdElkKSArIHVuaXRBdHRhY2tJbmNyZWFzZXNbcGxheWVyXVt1bml0SWRdKSAqICgxMCArIHVuaXRBdHRhY2tNdWx0aXBsaWVyW3BsYXllcl1bdW5pdElkXSkpIC8gMTA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFVuaXRzRGVmZW5zZShhZGRyZXNzIHBsYXllciwgdWludDI1NiB1bml0SWQsIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIChhbW91bnQgKiAoc2NoZW1hLnVuaXREZWZlbnNlKHVuaXRJZCkgKyB1bml0RGVmZW5zZUluY3JlYXNlc1twbGF5ZXJdW3VuaXRJZF0pICogKDEwICsgdW5pdERlZmVuc2VNdWx0aXBsaWVyW3BsYXllcl1bdW5pdElkXSkpIC8gMTA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFVuaXRzU3RlYWxpbmdDYXBhY2l0eShhZGRyZXNzIHBsYXllciwgdWludDI1NiB1bml0SWQsIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIChhbW91bnQgKiAoc2NoZW1hLnVuaXRTdGVhbGluZ0NhcGFjaXR5KHVuaXRJZCkgKyB1bml0R29vU3RlYWxpbmdJbmNyZWFzZXNbcGxheWVyXVt1bml0SWRdKSAqICgxMCArIHVuaXRHb29TdGVhbGluZ011bHRpcGxpZXJbcGxheWVyXVt1bml0SWRdKSkgLyAxMDsKICAgIH0KICAgIAogICAgCiAgICAvLyBUbyBkaXNwbGF5IG9uIHdlYnNpdGUKICAgIGZ1bmN0aW9uIGdldEdhbWVJbmZvKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NltdLCBib29sW10pewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgdW5pdHMgPSBuZXcgdWludDI1NltdKHNjaGVtYS5jdXJyZW50TnVtYmVyT2ZVbml0cygpKTsKICAgICAgICBib29sW10gbWVtb3J5IHVwZ3JhZGVzID0gbmV3IGJvb2xbXShzY2hlbWEuY3VycmVudE51bWJlck9mVXBncmFkZXMoKSk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBzdGFydElkOwogICAgICAgIHVpbnQyNTYgZW5kSWQ7CiAgICAgICAgKHN0YXJ0SWQsIGVuZElkKSA9IHNjaGVtYS5wcm9kdWN0aW9uVW5pdElkUmFuZ2UoKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGk7CiAgICAgICAgd2hpbGUgKHN0YXJ0SWQgPD0gZW5kSWQpIHsKICAgICAgICAgICAgdW5pdHNbaV0gPSB1bml0c093bmVkW21zZy5zZW5kZXJdW3N0YXJ0SWRdOwogICAgICAgICAgICBpKys7CiAgICAgICAgICAgIHN0YXJ0SWQrKzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgKHN0YXJ0SWQsIGVuZElkKSA9IHNjaGVtYS5iYXR0bGVVbml0SWRSYW5nZSgpOwogICAgICAgIHdoaWxlIChzdGFydElkIDw9IGVuZElkKSB7CiAgICAgICAgICAgIHVuaXRzW2ldID0gdW5pdHNPd25lZFttc2cuc2VuZGVyXVtzdGFydElkXTsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgICBzdGFydElkKys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFJlc2V0IGZvciB1cGdyYWRlcwogICAgICAgIGkgPSAwOwogICAgICAgIChzdGFydElkLCBlbmRJZCkgPSBzY2hlbWEudXBncmFkZUlkUmFuZ2UoKTsKICAgICAgICB3aGlsZSAoc3RhcnRJZCA8PSBlbmRJZCkgewogICAgICAgICAgICB1cGdyYWRlc1tpXSA9IHVwZ3JhZGVzT3duZWRbbXNnLnNlbmRlcl1bc3RhcnRJZF07CiAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgc3RhcnRJZCsrOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKGJsb2NrLnRpbWVzdGFtcCwgdG90YWxFdGhlckdvb1Jlc2VhcmNoUG9vbCwgdG90YWxHb29Qcm9kdWN0aW9uLCBuZXh0U25hcHNob3RUaW1lLCBiYWxhbmNlT2YobXNnLnNlbmRlciksIGV0aEJhbGFuY2VbbXNnLnNlbmRlcl0sIGdldEdvb1Byb2R1Y3Rpb24obXNnLnNlbmRlciksIHVuaXRzLCB1cGdyYWRlcyk7CiAgICB9CiAgICAKICAgIC8vIFRvIGRpc3BsYXkgb24gd2Vic2l0ZQogICAgZnVuY3Rpb24gZ2V0UmFyZUl0ZW1JbmZvKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdLCB1aW50MjU2W10pIHsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IGl0ZW1Pd25lcnMgPSBuZXcgYWRkcmVzc1tdKHNjaGVtYS5jdXJyZW50TnVtYmVyT2ZSYXJlcygpKTsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IGl0ZW1QcmljZXMgPSBuZXcgdWludDI1NltdKHNjaGVtYS5jdXJyZW50TnVtYmVyT2ZSYXJlcygpKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHN0YXJ0SWQ7CiAgICAgICAgdWludDI1NiBlbmRJZDsKICAgICAgICAoc3RhcnRJZCwgZW5kSWQpID0gc2NoZW1hLnJhcmVJZFJhbmdlKCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBpOwogICAgICAgIHdoaWxlIChzdGFydElkIDw9IGVuZElkKSB7CiAgICAgICAgICAgIGl0ZW1Pd25lcnNbaV0gPSByYXJlSXRlbU93bmVyW3N0YXJ0SWRdOwogICAgICAgICAgICBpdGVtUHJpY2VzW2ldID0gcmFyZUl0ZW1QcmljZVtzdGFydElkXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgc3RhcnRJZCsrOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKGl0ZW1Pd25lcnMsIGl0ZW1QcmljZXMpOwogICAgfQogICAgCiAgICAvLyBUbyBkaXNwbGF5IG9uIHdlYnNpdGUKICAgICBmdW5jdGlvbiB2aWV3VW5jbGFpbWVkUmVzZWFyY2hEaXZpZGVuZHMoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBzdGFydFNuYXBzaG90ID0gbGFzdEdvb1Jlc2VhcmNoRnVuZENsYWltW21zZy5zZW5kZXJdOwogICAgICAgIHVpbnQyNTYgbGF0ZXN0U25hcHNob3QgPSBhbGxvY2F0ZWRHb29SZXNlYXJjaFNuYXBzaG90cy5sZW5ndGggLSAxOyAvLyBObyBzbmFwc2hvdHMgdG8gYmVnaW4gd2l0aAogICAgICAgIAogICAgICAgIHVpbnQyNTYgcmVzZWFyY2hTaGFyZTsKICAgICAgICB1aW50MjU2IHByZXZpb3VzUHJvZHVjdGlvbiA9IGdvb1Byb2R1Y3Rpb25TbmFwc2hvdHNbbXNnLnNlbmRlcl1bbGFzdEdvb1Jlc2VhcmNoRnVuZENsYWltW21zZy5zZW5kZXJdIC0gMV07IC8vIFVuZGVyZmxvdyB3b24ndCBiZSBhIHByb2JsZW0gYXMgZ29vUHJvZHVjdGlvblNuYXBzaG90c1tdWzB4ZmZmZmZmZmZmZmZmZl0gPSAwOwogICAgICAgIGZvciAodWludDI1NiBpID0gc3RhcnRTbmFwc2hvdDsgaSA8PSBsYXRlc3RTbmFwc2hvdDsgaSsrKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTbGlnaHRseSBjb21wbGV4IHRoaW5ncyBieSBhY2NvdW50aW5nIGZvciBkYXlzL3NuYXBzaG90cyB3aGVuIHVzZXIgbWFkZSBubyB0eCdzCiAgICAgICAgICAgIHVpbnQyNTYgcHJvZHVjdGlvbkR1cmluZ1NuYXBzaG90ID0gZ29vUHJvZHVjdGlvblNuYXBzaG90c1ttc2cuc2VuZGVyXVtpXTsKICAgICAgICAgICAgYm9vbCBzb2xkQWxsUHJvZHVjdGlvbiA9IGdvb1Byb2R1Y3Rpb25aZXJvZWRTbmFwc2hvdHNbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgIGlmIChwcm9kdWN0aW9uRHVyaW5nU25hcHNob3QgPT0gMCAmJiAhc29sZEFsbFByb2R1Y3Rpb24pIHsKICAgICAgICAgICAgICAgIHByb2R1Y3Rpb25EdXJpbmdTbmFwc2hvdCA9IHByZXZpb3VzUHJvZHVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgcHJldmlvdXNQcm9kdWN0aW9uID0gcHJvZHVjdGlvbkR1cmluZ1NuYXBzaG90OwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXNlYXJjaFNoYXJlICs9IChhbGxvY2F0ZWRHb29SZXNlYXJjaFNuYXBzaG90c1tpXSAqIHByb2R1Y3Rpb25EdXJpbmdTbmFwc2hvdCkgLyB0b3RhbEdvb1Byb2R1Y3Rpb25TbmFwc2hvdHNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiAocmVzZWFyY2hTaGFyZSwgc3RhcnRTbmFwc2hvdCwgbGF0ZXN0U25hcHNob3QpOwogICAgfQogICAgCiAgICAKICAgIC8vIFRvIGFsbG93IGNsaWVudHMgdG8gdmVyaWZ5IGNvbnRlc3RhbnRzCiAgICBmdW5jdGlvbiBnZXRSYWZmbGVQbGF5ZXJzKHVpbnQyNTYgcmFmZmxlSWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3NbXSkgewogICAgICAgIHJldHVybiAocmFmZmxlUGxheWVyc1tyYWZmbGVJZF0pOwogICAgfQogICAgCiAgICAvLyBUbyBhbGxvdyBjbGllbnRzIHRvIHZlcmlmeSBjb250ZXN0YW50cwogICAgZnVuY3Rpb24gZ2V0UGxheWVyc1RpY2tldHMoYWRkcmVzcyBwbGF5ZXIpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbXSwgdWludDI1NltdKSB7CiAgICAgICAgVGlja2V0UHVyY2hhc2VzIHN0b3JhZ2UgcGxheWVyc1RpY2tldHMgPSB0aWNrZXRzQm91Z2h0QnlQbGF5ZXJbcGxheWVyXTsKICAgICAgICAKICAgICAgICBpZiAocGxheWVyc1RpY2tldHMucmFmZmxlUmFyZUlkID09IHJhZmZsZVJhcmVJZCkgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHN0YXJ0SWRzID0gbmV3IHVpbnQyNTZbXShwbGF5ZXJzVGlja2V0cy5udW1QdXJjaGFzZXMpOwogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IGVuZElkcyA9IG5ldyB1aW50MjU2W10ocGxheWVyc1RpY2tldHMubnVtUHVyY2hhc2VzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IHBsYXllcnNUaWNrZXRzLm51bVB1cmNoYXNlczsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdGFydElkc1tpXSA9IHBsYXllcnNUaWNrZXRzLnRpY2tldHNCb3VnaHRbaV0uc3RhcnRJZDsKICAgICAgICAgICAgICAgIGVuZElkc1tpXSA9IHBsYXllcnNUaWNrZXRzLnRpY2tldHNCb3VnaHRbaV0uZW5kSWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChzdGFydElkcywgZW5kSWRzKTsKICAgIH0KICAgIAogICAgLy8gVG8gZGlzcGxheSBvbiB3ZWJzaXRlCiAgICBmdW5jdGlvbiBnZXRMYXRlc3RSYWZmbGVJbmZvKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NiwgYWRkcmVzcywgdWludDI1NikgewogICAgICAgIHJldHVybiAocmFmZmxlRW5kVGltZSwgcmFmZmxlUmFyZUlkLCByYWZmbGVUaWNrZXRzQm91Z2h0LCByYWZmbGVXaW5uZXIsIHJhZmZsZVRpY2tldFRoYXRXb24pOwogICAgfQogICAgCiAgICAKICAgIC8vIE5ldyB1bml0cyBtYXkgYmUgYWRkZWQgaW4gZnV0dXJlLCBidXQgY2hlY2sgaXQgbWF0Y2hlcyBleGlzdGluZyBzY2hlbWEgc28gbm8tb25lIGNhbiBhYnVzZSBzZWxsaW5nLgogICAgZnVuY3Rpb24gdXBkYXRlR29vQ29uZmlnKGFkZHJlc3MgbmV3U2NoZW1hQWRkcmVzcykgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgCiAgICAgICAgR29vR2FtZUNvbmZpZyBuZXdTY2hlbWEgPSBHb29HYW1lQ29uZmlnKG5ld1NjaGVtYUFkZHJlc3MpOwogICAgICAgIHJlcXVpcmVFeGlzdGluZ1VuaXRzU2FtZShuZXdTY2hlbWEpOwogICAgICAgIHJlcXVpcmVFeGlzdGluZ1VwZ3JhZGVzU2FtZShuZXdTY2hlbWEpOwogICAgICAgIAogICAgICAgIC8vIEZpbmFsbHkgdXBkYXRlIGNvbmZpZwogICAgICAgIHNjaGVtYSA9IEdvb0dhbWVDb25maWcobmV3U2NoZW1hKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVxdWlyZUV4aXN0aW5nVW5pdHNTYW1lKEdvb0dhbWVDb25maWcgbmV3U2NoZW1hKSBpbnRlcm5hbCBjb25zdGFudCB7CiAgICAgICAgLy8gUmVxdWlyZXMgdW5pdHMgZXRoIGNvc3RzIG1hdGNoIHVwIG9yIGZhaWwgZXhlY3V0aW9uCiAgICAgICAgCiAgICAgICAgdWludDI1NiBzdGFydElkOwogICAgICAgIHVpbnQyNTYgZW5kSWQ7CiAgICAgICAgKHN0YXJ0SWQsIGVuZElkKSA9IHNjaGVtYS5wcm9kdWN0aW9uVW5pdElkUmFuZ2UoKTsKICAgICAgICB3aGlsZSAoc3RhcnRJZCA8PSBlbmRJZCkgewogICAgICAgICAgICByZXF1aXJlKHNjaGVtYS51bml0RXRoQ29zdChzdGFydElkKSA9PSBuZXdTY2hlbWEudW5pdEV0aENvc3Qoc3RhcnRJZCkpOwogICAgICAgICAgICByZXF1aXJlKHNjaGVtYS51bml0R29vUHJvZHVjdGlvbihzdGFydElkKSA9PSBuZXdTY2hlbWEudW5pdEdvb1Byb2R1Y3Rpb24oc3RhcnRJZCkpOwogICAgICAgICAgICBzdGFydElkKys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIChzdGFydElkLCBlbmRJZCkgPSBzY2hlbWEuYmF0dGxlVW5pdElkUmFuZ2UoKTsKICAgICAgICB3aGlsZSAoc3RhcnRJZCA8PSBlbmRJZCkgewogICAgICAgICAgICByZXF1aXJlKHNjaGVtYS51bml0RXRoQ29zdChzdGFydElkKSA9PSBuZXdTY2hlbWEudW5pdEV0aENvc3Qoc3RhcnRJZCkpOwogICAgICAgICAgICByZXF1aXJlKHNjaGVtYS51bml0QXR0YWNrKHN0YXJ0SWQpID09IG5ld1NjaGVtYS51bml0QXR0YWNrKHN0YXJ0SWQpKTsKICAgICAgICAgICAgcmVxdWlyZShzY2hlbWEudW5pdERlZmVuc2Uoc3RhcnRJZCkgPT0gbmV3U2NoZW1hLnVuaXREZWZlbnNlKHN0YXJ0SWQpKTsKICAgICAgICAgICAgcmVxdWlyZShzY2hlbWEudW5pdFN0ZWFsaW5nQ2FwYWNpdHkoc3RhcnRJZCkgPT0gbmV3U2NoZW1hLnVuaXRTdGVhbGluZ0NhcGFjaXR5KHN0YXJ0SWQpKTsKICAgICAgICAgICAgc3RhcnRJZCsrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVxdWlyZUV4aXN0aW5nVXBncmFkZXNTYW1lKEdvb0dhbWVDb25maWcgbmV3U2NoZW1hKSBpbnRlcm5hbCBjb25zdGFudCB7CiAgICAgICAgdWludDI1NiBzdGFydElkOwogICAgICAgIHVpbnQyNTYgZW5kSWQ7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBvbGRDbGFzczsKICAgICAgICB1aW50MjU2IG9sZFVuaXRJZDsKICAgICAgICB1aW50MjU2IG9sZFZhbHVlOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgbmV3Q2xhc3M7CiAgICAgICAgdWludDI1NiBuZXdVbml0SWQ7CiAgICAgICAgdWludDI1NiBuZXdWYWx1ZTsKICAgICAgICAKICAgICAgICAvLyBSZXF1aXJlcyBBTEwgdXBncmFkZSBzdGF0cyBtYXRjaCB1cCBvciBmYWlsIGV4ZWN1dGlvbgogICAgICAgIChzdGFydElkLCBlbmRJZCkgPSBzY2hlbWEucmFyZUlkUmFuZ2UoKTsKICAgICAgICB3aGlsZSAoc3RhcnRJZCA8PSBlbmRJZCkgewogICAgICAgICAgICB1aW50MjU2IG9sZEdvb0Nvc3Q7CiAgICAgICAgICAgIHVpbnQyNTYgb2xkRXRoQ29zdDsKICAgICAgICAgICAgKG9sZEdvb0Nvc3QsIG9sZEV0aENvc3QsIG9sZENsYXNzLCBvbGRVbml0SWQsIG9sZFZhbHVlKSA9IHNjaGVtYS5nZXRVcGdyYWRlSW5mbyhzdGFydElkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQyNTYgbmV3R29vQ29zdDsKICAgICAgICAgICAgdWludDI1NiBuZXdFdGhDb3N0OwogICAgICAgICAgICAobmV3R29vQ29zdCwgbmV3RXRoQ29zdCwgbmV3Q2xhc3MsIG5ld1VuaXRJZCwgbmV3VmFsdWUpID0gbmV3U2NoZW1hLmdldFVwZ3JhZGVJbmZvKHN0YXJ0SWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgcmVxdWlyZShvbGRHb29Db3N0ID09IG5ld0dvb0Nvc3QpOwogICAgICAgICAgICByZXF1aXJlKG9sZEV0aENvc3QgPT0gb2xkRXRoQ29zdCk7CiAgICAgICAgICAgIHJlcXVpcmUob2xkQ2xhc3MgPT0gb2xkQ2xhc3MpOwogICAgICAgICAgICByZXF1aXJlKG9sZFVuaXRJZCA9PSBuZXdVbml0SWQpOwogICAgICAgICAgICByZXF1aXJlKG9sZFZhbHVlID09IG5ld1ZhbHVlKTsKICAgICAgICAgICAgc3RhcnRJZCsrOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBSZXF1aXJlcyBBTEwgcmFyZSBzdGF0cyBtYXRjaCB1cCBvciBmYWlsIGV4ZWN1dGlvbgogICAgICAgIChzdGFydElkLCBlbmRJZCkgPSBzY2hlbWEucmFyZUlkUmFuZ2UoKTsKICAgICAgICB3aGlsZSAoc3RhcnRJZCA8PSBlbmRJZCkgewogICAgICAgICAgICAob2xkQ2xhc3MsIG9sZFVuaXRJZCwgb2xkVmFsdWUpID0gc2NoZW1hLmdldFJhcmVJbmZvKHN0YXJ0SWQpOwogICAgICAgICAgICAobmV3Q2xhc3MsIG5ld1VuaXRJZCwgbmV3VmFsdWUpID0gbmV3U2NoZW1hLmdldFJhcmVJbmZvKHN0YXJ0SWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgcmVxdWlyZShvbGRDbGFzcyA9PSBuZXdDbGFzcyk7CiAgICAgICAgICAgIHJlcXVpcmUob2xkVW5pdElkID09IG5ld1VuaXRJZCk7CiAgICAgICAgICAgIHJlcXVpcmUob2xkVmFsdWUgPT0gbmV3VmFsdWUpOwogICAgICAgICAgICBzdGFydElkKys7CiAgICAgICAgfQogICAgfQp9CgoKY29udHJhY3QgR29vR2FtZUNvbmZpZyB7CiAgICAKICAgIG1hcHBpbmcodWludDI1NiA9PiBVbml0KSBwcml2YXRlIHVuaXRJbmZvOwogICAgbWFwcGluZyh1aW50MjU2ID0+IFVwZ3JhZGUpIHByaXZhdGUgdXBncmFkZUluZm87CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gUmFyZSkgcHJpdmF0ZSByYXJlSW5mbzsKICAgIAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgY3VycmVudE51bWJlck9mVW5pdHMgPSAxNDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGN1cnJlbnROdW1iZXJPZlVwZ3JhZGVzID0gNDI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBjdXJyZW50TnVtYmVyT2ZSYXJlcyA9IDI7CiAgICAKICAgIHN0cnVjdCBVbml0IHsKICAgICAgICB1aW50MjU2IHVuaXRJZDsKICAgICAgICB1aW50MjU2IGJhc2VHb29Db3N0OwogICAgICAgIHVpbnQyNTYgZ29vQ29zdEluY3JlYXNlSGFsZjsgLy8gSGFsZmVkIHRvIG1ha2UgbWF0aHMgc2xpZ2h0bHkgbGVzcyAoY2FuY2VscyBhIDIgb3V0KQogICAgICAgIHVpbnQyNTYgZXRoQ29zdDsKICAgICAgICB1aW50MjU2IGJhc2VHb29Qcm9kdWN0aW9uOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgYXR0YWNrVmFsdWU7CiAgICAgICAgdWludDI1NiBkZWZlbnNlVmFsdWU7CiAgICAgICAgdWludDI1NiBnb29TdGVhbGluZ0NhcGFjaXR5OwogICAgfQogICAgCiAgICBzdHJ1Y3QgVXBncmFkZSB7CiAgICAgICAgdWludDI1NiB1cGdyYWRlSWQ7CiAgICAgICAgdWludDI1NiBnb29Db3N0OwogICAgICAgIHVpbnQyNTYgZXRoQ29zdDsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVDbGFzczsKICAgICAgICB1aW50MjU2IHVuaXRJZDsKICAgICAgICB1aW50MjU2IHVwZ3JhZGVWYWx1ZTsKICAgIH0KICAgIAogICAgIHN0cnVjdCBSYXJlIHsKICAgICAgICB1aW50MjU2IHJhcmVJZDsKICAgICAgICB1aW50MjU2IGV0aENvc3Q7CiAgICAgICAgdWludDI1NiByYXJlQ2xhc3M7CiAgICAgICAgdWludDI1NiB1bml0SWQ7CiAgICAgICAgdWludDI1NiByYXJlVmFsdWU7CiAgICB9CiAgICAKICAgIC8vIENvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBHb29HYW1lQ29uZmlnKCkgcHVibGljIHsKICAgICAgICAKICAgICAgICB1bml0SW5mb1sxXSA9IFVuaXQoMSwgMCwgMTAsIDAsIDEsIDAsIDAsIDApOwogICAgICAgIHVuaXRJbmZvWzJdID0gVW5pdCgyLCAxMDAsIDUwLCAwLCAyLCAwLCAwLCAwKTsKICAgICAgICB1bml0SW5mb1szXSA9IFVuaXQoMywgMCwgMCwgMC4wMSBldGhlciwgMTIsIDAsIDAsIDApOwogICAgICAgIHVuaXRJbmZvWzRdID0gVW5pdCg0LCA1MDAsIDI1MCwgMCwgNCwgMCwgMCwgMCk7CiAgICAgICAgdW5pdEluZm9bNV0gPSBVbml0KDUsIDI1MDAsIDEyNTAsIDAsIDYsIDAsIDAsIDApOwogICAgICAgIHVuaXRJbmZvWzZdID0gVW5pdCg2LCAxMDAwMCwgNTAwMCwgMCwgOCwgMCwgMCwgMCk7CiAgICAgICAgdW5pdEluZm9bN10gPSBVbml0KDcsIDAsIDEwMDAsIDAuMDUgZXRoZXIsIDYwLCAwLCAwLCAwKTsKICAgICAgICB1bml0SW5mb1s4XSA9IFVuaXQoOCwgMjUwMDAsIDEyNTAwLCAwLCAxMCwgMCwgMCwgMCk7CiAgICAgICAgCiAgICAgICAgdW5pdEluZm9bNDBdID0gVW5pdCg0MCwgMTAwLCA1MCwgMCwgMCwgMTAsIDEwLCAyMCk7CiAgICAgICAgdW5pdEluZm9bNDFdID0gVW5pdCg0MSwgMjUwLCAxMjUsIDAsIDAsIDEsIDI1LCAxKTsKICAgICAgICB1bml0SW5mb1s0Ml0gPSBVbml0KDQyLCAwLCA1MCwgMC4wMSBldGhlciwgMCwgMTAwLCAxMCwgNSk7CiAgICAgICAgdW5pdEluZm9bNDNdID0gVW5pdCg0MywgMTAwMCwgNTAwLCAwLCAwLCAyNSwgMSwgNTApOwogICAgICAgIHVuaXRJbmZvWzQ0XSA9IFVuaXQoNDQsIDI1MDAsIDEyNTAsIDAsIDAsIDIwLCA0MCwgMTAwKTsKICAgICAgICB1bml0SW5mb1s0NV0gPSBVbml0KDQ1LCAwLCA1MDAsIDAuMDIgZXRoZXIsIDAsIDAsIDAsIDEwMDApOwogICAgICAgIAogICAgICAgIHVwZ3JhZGVJbmZvWzFdID0gVXBncmFkZSgxLCA1MDAsIDAsIDAsIDEsIDEpOyAvLyArMQogICAgICAgIHVwZ3JhZGVJbmZvWzJdID0gVXBncmFkZSgyLCAwLCAwLjEgZXRoZXIsIDEsIDEsIDEwKTsgLy8gMTAgPSArMTAwJQogICAgICAgIHVwZ3JhZGVJbmZvWzNdID0gVXBncmFkZSgzLCAxMDAwMCwgMCwgMSwgMSwgNSk7IC8vIDUgPSArNTAlCiAgICAgICAgCiAgICAgICAgdXBncmFkZUluZm9bNF0gPSBVcGdyYWRlKDQsIDAsIDAuMSBldGhlciwgMCwgMiwgMik7IC8vICsxCiAgICAgICAgdXBncmFkZUluZm9bNV0gPSBVcGdyYWRlKDUsIDIwMDAsIDAsIDEsIDIsIDUpOyAvLyAxMCA9ICs1MCUKICAgICAgICB1cGdyYWRlSW5mb1s2XSA9IFVwZ3JhZGUoNiwgMCwgMC4yIGV0aGVyLCAwLCAyLCAyKTsgLy8gKzIKICAgICAgICAKICAgICAgICB1cGdyYWRlSW5mb1s3XSA9IFVwZ3JhZGUoNywgMjUwMCwgMCwgMCwgMywgMik7IC8vICsyCiAgICAgICAgdXBncmFkZUluZm9bOF0gPSBVcGdyYWRlKDgsIDAsIDAuNSBldGhlciwgMSwgMywgMTApOyAvLyAxMCA9ICsxMDAlCiAgICAgICAgdXBncmFkZUluZm9bOV0gPSBVcGdyYWRlKDksIDI1MDAwLCAwLCAxLCAzLCA1KTsgLy8gNSA9ICs1MCUKICAgICAgICAKICAgICAgICB1cGdyYWRlSW5mb1sxMF0gPSBVcGdyYWRlKDEwLCAwLCAwLjEgZXRoZXIsIDAsIDQsIDEpOyAvLyArMQogICAgICAgIHVwZ3JhZGVJbmZvWzExXSA9IFVwZ3JhZGUoMTEsIDUwMDAsIDAsIDEsIDQsIDUpOyAvLyAxMCA9ICs1MCUKICAgICAgICB1cGdyYWRlSW5mb1sxMl0gPSBVcGdyYWRlKDEyLCAwLCAwLjIgZXRoZXIsIDAsIDQsIDIpOyAvLyArMgogICAgICAgIAogICAgICAgIHVwZ3JhZGVJbmZvWzEzXSA9IFVwZ3JhZGUoMTMsIDEwMDAwLCAwLCAwLCA1LCAyKTsgLy8gKzIKICAgICAgICB1cGdyYWRlSW5mb1sxNF0gPSBVcGdyYWRlKDE0LCAwLCAwLjUgZXRoZXIsIDEsIDUsIDEwKTsgLy8gMTAgPSArMTAwJQogICAgICAgIHVwZ3JhZGVJbmZvWzE1XSA9IFVwZ3JhZGUoMTUsIDI1MDAwLCAwLCAxLCA1LCA1KTsgLy8gNSA9ICs1MCUKICAgICAgICAKICAgICAgICB1cGdyYWRlSW5mb1sxNl0gPSBVcGdyYWRlKDE2LCAwLCAwLjEgZXRoZXIsIDAsIDYsIDEpOyAvLyArMQogICAgICAgIHVwZ3JhZGVJbmZvWzE3XSA9IFVwZ3JhZGUoMTcsIDI1MDAwLCAwLCAxLCA2LCA1KTsgLy8gMTAgPSArNTAlCiAgICAgICAgdXBncmFkZUluZm9bMThdID0gVXBncmFkZSgxOCwgMCwgMC4yIGV0aGVyLCAwLCA2LCAyKTsgLy8gKzIKICAgICAgICAKICAgICAgICB1cGdyYWRlSW5mb1sxOV0gPSBVcGdyYWRlKDEzLCA1MDAwMCwgMCwgMCwgNywgMik7IC8vICsyCiAgICAgICAgdXBncmFkZUluZm9bMjBdID0gVXBncmFkZSgyMCwgMCwgMC4yIGV0aGVyLCAxLCA3LCA1KTsgLy8gNSA9ICs1MCUKICAgICAgICB1cGdyYWRlSW5mb1syMV0gPSBVcGdyYWRlKDIxLCAxMDAwMDAsIDAsIDEsIDcsIDUpOyAvLyA1ID0gKzUwJQogICAgICAgIAogICAgICAgIHVwZ3JhZGVJbmZvWzIyXSA9IFVwZ3JhZGUoMjIsIDAsIDAuMSBldGhlciwgMCwgOCwgMik7IC8vICsxCiAgICAgICAgdXBncmFkZUluZm9bMjNdID0gVXBncmFkZSgyMywgMjUwMDAsIDAsIDEsIDgsIDUpOyAvLyAxMCA9ICs1MCUKICAgICAgICB1cGdyYWRlSW5mb1syNF0gPSBVcGdyYWRlKDI0LCAwLCAwLjIgZXRoZXIsIDAsIDgsIDQpOyAvLyArMgogICAgICAgIAogICAgICAgIAogICAgICAgIAogICAgICAgIHVwZ3JhZGVJbmZvWzI1XSA9IFVwZ3JhZGUoMjUsIDUwMCwgMCwgMiwgNDAsIDEwKTsgLy8gKzEwCiAgICAgICAgdXBncmFkZUluZm9bMjZdID0gVXBncmFkZSgyNiwgMCwgMC4xIGV0aGVyLCA0LCA0MCwgMTApOyAvLyArMTAKICAgICAgICB1cGdyYWRlSW5mb1syN10gPSBVcGdyYWRlKDI3LCAxMDAwMCwgMCwgNiwgNDAsIDEwKTsgLy8gKzEwCiAgICAgICAgCiAgICAgICAgdXBncmFkZUluZm9bMjhdID0gVXBncmFkZSgyOCwgMCwgMC4yIGV0aGVyLCAzLCA0MSwgNSk7IC8vICs1MCAlCiAgICAgICAgdXBncmFkZUluZm9bMjldID0gVXBncmFkZSgyOSwgNTAwMCwgMCwgNCwgNDEsIDEwKTsgLy8gKzEwCiAgICAgICAgdXBncmFkZUluZm9bMzBdID0gVXBncmFkZSgzMCwgMCwgMC41IGV0aGVyLCA2LCA0MSwgNCk7IC8vICs0CiAgICAgICAgCiAgICAgICAgdXBncmFkZUluZm9bMzFdID0gVXBncmFkZSgzMSwgMjUwMCwgMCwgNSwgNDIsIDUpOyAvLyArNTAgJQogICAgICAgIHVwZ3JhZGVJbmZvWzMyXSA9IFVwZ3JhZGUoMzIsIDAsIDAuMiBldGhlciwgNiwgNDIsIDEwKTsgLy8gKzEwCiAgICAgICAgdXBncmFkZUluZm9bMzNdID0gVXBncmFkZSgzMywgMjAwMDAsIDAsIDcsIDQyLCA1KTsgLy8gKzUwICUKICAgICAgICAKICAgICAgICB1cGdyYWRlSW5mb1szNF0gPSBVcGdyYWRlKDM0LCAwLCAwLjEgZXRoZXIsIDIsIDQzLCA1KTsgLy8gKzUKICAgICAgICB1cGdyYWRlSW5mb1szNV0gPSBVcGdyYWRlKDM1LCAxMDAwMCwgMCwgNCwgNDMsIDUpOyAvLyArNQogICAgICAgIHVwZ3JhZGVJbmZvWzM2XSA9IFVwZ3JhZGUoMzYsIDAsIDAuMiBldGhlciwgNSwgNDMsIDUpOyAvLyArNTAlCiAgICAgICAgCiAgICAgICAgdXBncmFkZUluZm9bMzddID0gVXBncmFkZSgzNywgMCwgMC4xIGV0aGVyLCAyLCA0NCwgMTUpOyAvLyArMTUKICAgICAgICB1cGdyYWRlSW5mb1szOF0gPSBVcGdyYWRlKDM4LCAyNTAwMCwgMCwgMywgNDQsIDUpOyAvLyArNTAlCiAgICAgICAgdXBncmFkZUluZm9bMzldID0gVXBncmFkZSgzOSwgMCwgMC4yIGV0aGVyLCA0LCA0NCwgMTUpOyAvLyArMTUKICAgICAgICAKICAgICAgICB1cGdyYWRlSW5mb1s0MF0gPSBVcGdyYWRlKDQwLCA1MDAwMCwgMCwgNiwgNDUsIDUwMCk7IC8vICs1MDAKICAgICAgICB1cGdyYWRlSW5mb1s0MV0gPSBVcGdyYWRlKDQxLCAwLCAwLjUgZXRoZXIsIDcsIDQ1LCAxMCk7IC8vICsxMDAgJQogICAgICAgIHVwZ3JhZGVJbmZvWzQyXSA9IFVwZ3JhZGUoNDIsIDI1MDAwMCwgMCwgNywgNDUsIDUpOyAvLyArNTAgJQogICAgCiAgICAgICAgCiAgICAgICAgcmFyZUluZm9bMV0gPSBSYXJlKDEsIDAuNSBldGhlciwgMSwgMSwgMzApOyAvLyAzMCA9ICszMDAlCiAgICAgICAgcmFyZUluZm9bMl0gPSBSYXJlKDIsIDAuNSBldGhlciwgMCwgMiwgNCk7IC8vICs0CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEdvb0Nvc3RGb3JVbml0KHVpbnQyNTYgdW5pdElkLCB1aW50MjU2IGV4aXN0aW5nLCB1aW50MjU2IGFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoYW1vdW50ID09IDEpIHsgLy8gMQogICAgICAgICAgICBpZiAoZXhpc3RpbmcgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuaXRJbmZvW3VuaXRJZF0uYmFzZUdvb0Nvc3Q7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5pdEluZm9bdW5pdElkXS5iYXNlR29vQ29zdCArIChleGlzdGluZyAqIHVuaXRJbmZvW3VuaXRJZF0uZ29vQ29zdEluY3JlYXNlSGFsZiAqIDIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhbW91bnQgPiAxKSB7CiAgICAgICAgICAgIHVpbnQyNTYgZXhpc3RpbmdDb3N0OwogICAgICAgICAgICBpZiAoZXhpc3RpbmcgPiAwKSB7CiAgICAgICAgICAgICAgICBleGlzdGluZ0Nvc3QgPSAodW5pdEluZm9bdW5pdElkXS5iYXNlR29vQ29zdCAqIGV4aXN0aW5nKSArIChleGlzdGluZyAqIChleGlzdGluZyAtIDEpICogdW5pdEluZm9bdW5pdElkXS5nb29Db3N0SW5jcmVhc2VIYWxmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZXhpc3RpbmcgKz0gYW1vdW50OwogICAgICAgICAgICB1aW50MjU2IG5ld0Nvc3QgPSBTYWZlTWF0aC5hZGQoU2FmZU1hdGgubXVsKHVuaXRJbmZvW3VuaXRJZF0uYmFzZUdvb0Nvc3QsIGV4aXN0aW5nKSwgU2FmZU1hdGgubXVsKFNhZmVNYXRoLm11bChleGlzdGluZywgKGV4aXN0aW5nIC0gMSkpLCB1bml0SW5mb1t1bml0SWRdLmdvb0Nvc3RJbmNyZWFzZUhhbGYpKTsKICAgICAgICAgICAgcmV0dXJuIG5ld0Nvc3QgLSBleGlzdGluZ0Nvc3Q7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRXZWFrZW5lZERlZmVuc2VQb3dlcih1aW50MjU2IGRlZmVuZGluZ1Bvd2VyKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGRlZmVuZGluZ1Bvd2VyIC8gMjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdmFsaWRVbml0SWQodWludDI1NiB1bml0SWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKCh1bml0SWQgPiAwICYmIHVuaXRJZCA8IDkpIHx8ICh1bml0SWQgPiAzOSAmJiB1bml0SWQgPCA0NikpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB2YWxpZFVwZ3JhZGVJZCh1aW50MjU2IHVwZ3JhZGVJZCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAodXBncmFkZUlkID4gMCAmJiB1cGdyYWRlSWQgPCA0Myk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHZhbGlkUmFyZUlkKHVpbnQyNTYgcmFyZUlkKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChyYXJlSWQgPiAwICYmIHJhcmVJZCA8IDMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1bml0RXRoQ29zdCh1aW50MjU2IHVuaXRJZCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB1bml0SW5mb1t1bml0SWRdLmV0aENvc3Q7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVuaXRHb29Qcm9kdWN0aW9uKHVpbnQyNTYgdW5pdElkKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHVuaXRJbmZvW3VuaXRJZF0uYmFzZUdvb1Byb2R1Y3Rpb247CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVuaXRBdHRhY2sodWludDI1NiB1bml0SWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdW5pdEluZm9bdW5pdElkXS5hdHRhY2tWYWx1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdW5pdERlZmVuc2UodWludDI1NiB1bml0SWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdW5pdEluZm9bdW5pdElkXS5kZWZlbnNlVmFsdWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVuaXRTdGVhbGluZ0NhcGFjaXR5KHVpbnQyNTYgdW5pdElkKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHVuaXRJbmZvW3VuaXRJZF0uZ29vU3RlYWxpbmdDYXBhY2l0eTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmFyZVN0YXJ0UHJpY2UodWludDI1NiByYXJlSWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gcmFyZUluZm9bcmFyZUlkXS5ldGhDb3N0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBwcm9kdWN0aW9uVW5pdElkUmFuZ2UoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuICgxLCA4KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmF0dGxlVW5pdElkUmFuZ2UoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuICg0MCwgNDUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGdyYWRlSWRSYW5nZSgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKDEsIDQyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmFyZUlkUmFuZ2UoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuICgxLCAyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0VXBncmFkZUluZm8odWludDI1NiB1cGdyYWRlSWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKHVwZ3JhZGVJbmZvW3VwZ3JhZGVJZF0uZ29vQ29zdCwgdXBncmFkZUluZm9bdXBncmFkZUlkXS5ldGhDb3N0LCB1cGdyYWRlSW5mb1t1cGdyYWRlSWRdLnVwZ3JhZGVDbGFzcywKICAgICAgICB1cGdyYWRlSW5mb1t1cGdyYWRlSWRdLnVuaXRJZCwgdXBncmFkZUluZm9bdXBncmFkZUlkXS51cGdyYWRlVmFsdWUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRSYXJlSW5mbyh1aW50MjU2IHJhcmVJZCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NikgewogICAgICAgIHJldHVybiAocmFyZUluZm9bcmFyZUlkXS5yYXJlQ2xhc3MsIHJhcmVJbmZvW3JhcmVJZF0udW5pdElkLCByYXJlSW5mb1tyYXJlSWRdLnJhcmVWYWx1ZSk7CiAgICB9CiAgICAKfQoKbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0='.
	

]
