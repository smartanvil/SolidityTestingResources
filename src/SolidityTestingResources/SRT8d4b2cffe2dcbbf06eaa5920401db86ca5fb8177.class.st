Class {
	#name : #SRT8d4b2cffe2dcbbf06eaa5920401db86ca5fb8177,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT8d4b2cffe2dcbbf06eaa5920401db86ca5fb8177 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCgoKCgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFNhZmVFUkMyMAogKiBAZGV2IFdyYXBwZXJzIGFyb3VuZCBFUkMyMCBvcGVyYXRpb25zIHRoYXQgdGhyb3cgb24gZmFpbHVyZS4KICogVG8gdXNlIHRoaXMgbGlicmFyeSB5b3UgY2FuIGFkZCBhIGB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwO2Agc3RhdGVtZW50IHRvIHlvdXIgY29udHJhY3QsCiAqIHdoaWNoIGFsbG93cyB5b3UgdG8gY2FsbCB0aGUgc2FmZSBvcGVyYXRpb25zIGFzIGB0b2tlbi5zYWZlVHJhbnNmZXIoLi4uKWAsIGV0Yy4KICovCmxpYnJhcnkgU2FmZUVSQzIwIHsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXIoRVJDMjBCYXNpYyB0b2tlbiwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShFUkMyMCB0b2tlbiwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KCgoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGVDb25maWcKICogQGRldiBIb2xkcyBhbGwgY29uc3RhbnRzIGZvciBTZWxmS2V5Q3Jvd2RzYWxlIGNvbnRyYWN0CiovCmNvbnRyYWN0IENyb3dkc2FsZUNvbmZpZyB7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9ERUNJTUFMUyA9IDE4OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUlOX1RPS0VOX1VOSVQgPSAxMCAqKiB1aW50MjU2KFRPS0VOX0RFQ0lNQUxTKTsKCiAgICAvLyBJbml0aWFsIGRpc3RyaWJ1dGlvbiBhbW91bnRzCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT1RBTF9TVVBQTFlfQ0FQID0gNjAwMDAwMDAwMCAqIE1JTl9UT0tFTl9VTklUOwoKICAgIC8vIDMzJSBvZiB0aGUgdG90YWwgc3VwcGx5IGNhcAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgU0FMRV9DQVAgPSAxOTgwMDAwMDAwICogTUlOX1RPS0VOX1VOSVQ7CgogICAgLy8gTWluaW11bSBjYXAgcGVyIHB1cmNoYXNlciBvbiBwdWJsaWMgc2FsZSA9ICQxMDAgaW4gS0VZIChhdCAkMC4wMTUpCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQVVJDSEFTRVJfTUlOX1RPS0VOX0NBUCA9IDY2NjYgKiBNSU5fVE9LRU5fVU5JVDsKCiAgICAvLyBNYXhpbXVtIGNhcCBwZXIgcHVyY2hhc2VyIG9uIGZpcnN0IGRheSBvZiBwdWJsaWMgc2FsZSA9ICQzLDAwMCBpbiBLRVkgKGF0ICQwLjAxNSkKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFUl9NQVhfVE9LRU5fQ0FQX0RBWTEgPSAyMDAwMDAgKiBNSU5fVE9LRU5fVU5JVDsKCiAgICAvLyBNYXhpbXVtIGNhcCBwZXIgcHVyY2hhc2VyIG9uIHB1YmxpYyBzYWxlID0gJDE4LDAwMCBpbiBLRVkgKGF0ICQwLjAxNSkKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFUl9NQVhfVE9LRU5fQ0FQID0gMTIwMDAwMCAqIE1JTl9UT0tFTl9VTklUOwoKICAgIC8vIDE2LjUlCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBGT1VOREFUSU9OX1BPT0xfVE9LRU5TID0gODc2NjY2NjY2ICogTUlOX1RPS0VOX1VOSVQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBGT1VOREFUSU9OX1BPT0xfVE9LRU5TX1ZFU1RFRCA9IDExMzMzMzMzNCAqIE1JTl9UT0tFTl9VTklUOwoKICAgIC8vIEFwcHJveCAzMyUKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENPTU1VTklUWV9QT09MX1RPS0VOUyA9IDE5ODAwMDAwMDAgKiBNSU5fVE9LRU5fVU5JVDsKCiAgICAvLyBGb3VuZGVycycgZGlzdHJpYnV0aW9uLiBUb3RhbCA9IDE2LjUlCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBGT1VOREVSU19UT0tFTlMgPSAzMzAwMDAwMDAgKiBNSU5fVE9LRU5fVU5JVDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEZPVU5ERVJTX1RPS0VOU19WRVNURURfMSA9IDMzMDAwMDAwMCAqIE1JTl9UT0tFTl9VTklUOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRk9VTkRFUlNfVE9LRU5TX1ZFU1RFRF8yID0gMzMwMDAwMDAwICogTUlOX1RPS0VOX1VOSVQ7CgogICAgLy8gMSUgZm9yIGxlZ2FsIGFkdmlzb3JzCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBMRUdBTF9FWFBFTlNFU18xX1RPS0VOUyA9IDU0MDAwMDAwICogTUlOX1RPS0VOX1VOSVQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBMRUdBTF9FWFBFTlNFU18yX1RPS0VOUyA9IDYwMDAwMDAgKiBNSU5fVE9LRU5fVU5JVDsKCiAgICAvLyBLRVkgcHJpY2UgaW4gVVNEICh0aG91c2FuZHRocykKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1BSSUNFX1RIT1VTQU5EVEggPSAxNTsgIC8vICQwLjAxNSBwZXIgS0VZCgogICAgLy8gQ29udHJhY3Qgd2FsbGV0IGFkZHJlc3NlcyBmb3IgaW5pdGlhbCBhbGxvY2F0aW9uCiAgICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBDUk9XRFNBTEVfV0FMTEVUX0FERFIgPSAweEUwODMxYjE2ODdjOWZhRDM0NDdhNTE3RjkzNzFFNjY2NzI1MDVkQjA7CiAgICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBGT1VOREFUSU9OX1BPT0xfQUREUiA9IDB4RDY4OTQ3ODkyRWY0RDk0Q2RlZjcxNjViMTA5Q2Y2Q2QzZjU4QThlODsKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IEZPVU5EQVRJT05fUE9PTF9BRERSX1ZFU1QgPSAweGQwQzI0QmI4MmU3MUE0NGVBNzcwZTg0QTNjNzk5NzlGOTIzMzMwOEQ7CiAgICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBDT01NVU5JVFlfUE9PTF9BRERSID0gMHgwNTA2YzU0ODVBRTU0YUIxNEM1OThFZjE2QzQ1OTQwOUU1ZDhGYzAzOwogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgRk9VTkRFUlNfUE9PTF9BRERSID0gMHg0NDUyZDY0NTRlNzc3NzQzYTVFZTIzM2ZiZTg3MzA1NTAwOGZGNTI4OwogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgTEVHQUxfRVhQRU5TRVNfQUREUl8xID0gMHhiNTc5MTEzODBGMTNBMGE5YTZCYTY1NjIyNDg2NzRCNWY1NkQ3QkZFOwogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgTEVHQUxfRVhQRU5TRVNfQUREUl8yID0gMHg5YmUyODFDZGNGMzRCM0EwMTQ2OEFkMTAwODEzOTQxMEJhNUJCMmZCOwoKICAgIC8vIDYgbW9udGhzIHBlcmlvZCwgaW4gc2Vjb25kcywgZm9yIHByZS1jb21taXRtZW50IGhhbGYtdmVzdGluZwogICAgdWludDY0IHB1YmxpYyBjb25zdGFudCBQUkVDT01NSVRNRU5UX1ZFU1RJTkdfU0VDT05EUyA9IDE1NTUyMDAwOwp9CgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgoKCgoKCgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQGRldiBJbmNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gZGVjcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zdWJ0cmFjdGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gZGVjcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKCgoKCi8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKiBAZGV2IElzc3VlOiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvaXNzdWVzLzEyMAogKiBCYXNlZCBvbiBjb2RlIGJ5IFRva2VuTWFya2V0TmV0OiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAogKi8KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9CgovKiBzb2xoaW50LWRpc2FibGUgbm90LXJlbHktb24tdGltZSAqLwoKCgoKCgoKCgovKioKICogQHRpdGxlIFNlbGZLZXlUb2tlbgogKiBAZGV2IFNlbGZLZXkgVG9rZW4gaW1wbGVtZW50YXRpb24uCiAqLwpjb250cmFjdCBTZWxmS2V5VG9rZW4gaXMgTWludGFibGVUb2tlbiB7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAnU2VsZktleSc7IC8vc29saGludC1kaXNhYmxlLWxpbmUgY29uc3QtbmFtZS1zbmFrZWNhc2UKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ0tFWSc7IC8vc29saGludC1kaXNhYmxlLWxpbmUgY29uc3QtbmFtZS1zbmFrZWNhc2UKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7IC8vc29saGludC1kaXNhYmxlLWxpbmUgY29uc3QtbmFtZS1zbmFrZWNhc2UKCiAgICB1aW50MjU2IHB1YmxpYyBjYXA7CiAgICBib29sIHByaXZhdGUgdHJhbnNmZXJzRW5hYmxlZCA9IGZhbHNlOwoKICAgIGV2ZW50IEJ1cm5lZChhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvKioKICAgICAqIEBkZXYgT25seSB0aGUgY29udHJhY3Qgb3duZXIgY2FuIHRyYW5zZmVyIHdpdGhvdXQgcmVzdHJpY3Rpb25zLgogICAgICogICAgICBSZWd1bGFyIGhvbGRlcnMgbmVlZCB0byB3YWl0IHVudGlsIHNhbGUgaXMgZmluYWxpemVkLgogICAgICogQHBhcmFtIF9zZW5kZXIg4oCUIFRoZSBhZGRyZXNzIHNlbmRpbmcgdGhlIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZSDigJQgVGhlIG51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogICAgICovCiAgICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkIHx8IF9zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnN0cnVjdG9yIHRoYXQgc2V0cyBhIG1heGltdW0gc3VwcGx5IGNhcC4KICAgICAqIEBwYXJhbSBfY2FwIOKAlCBUaGUgbWF4aW11bSBzdXBwbHkgY2FwLgogICAgICovCiAgICBmdW5jdGlvbiBTZWxmS2V5VG9rZW4odWludDI1NiBfY2FwKSBwdWJsaWMgewogICAgICAgIGNhcCA9IF9jYXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE92ZXJyaWRlcyBNaW50YWJsZVRva2VuLm1pbnQoKSBmb3IgcmVzdHJpY3Rpbmcgc3VwcGx5IHVuZGVyIGNhcAogICAgICogQHBhcmFtIF90byDigJQgVGhlIGFkZHJlc3MgdG8gcmVjZWl2ZSBtaW50ZWQgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIOKAlCBUaGUgbnVtYmVyIG9mIHRva2VucyB0byBtaW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seU93bmVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkuYWRkKF92YWx1ZSkgPD0gY2FwKTsKICAgICAgICByZXR1cm4gc3VwZXIubWludChfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgICAqIEBwYXJhbSBfdG8g4oCUIFRoZSBhZGRyZXNzIHRvIHJlY2VpdmUgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIOKAlCBUaGUgbnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgICAqIEBwYXJhbSBfZnJvbSDigJQgVGhlIGFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAgICogQHBhcmFtIF90byDigJQgVGhlIGFkZHJlc3MgdG8gcmVjZWl2ZSB0b2tlbnMKICAgICAqIEBwYXJhbSBfdmFsdWUg4oCUIFRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEVuYWJsZXMgdG9rZW4gdHJhbnNmZXJzLgogICAgICogICAgICBDYWxsZWQgd2hlbiB0aGUgdG9rZW4gc2FsZSBpcyBzdWNjZXNzZnVsbHkgZmluYWxpemVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycygpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgbnVtYmVyIG9mIHRva2Vucy4KICAgICogQHBhcmFtIF92YWx1ZSDigJQgVGhlIG51bWJlciBvZiB0b2tlbnMgdG8gYmUgYnVybmVkLgogICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBiYWxhbmNlc1tidXJuZXJdID0gYmFsYW5jZXNbYnVybmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIEJ1cm5lZChidXJuZXIsIF92YWx1ZSk7CiAgICB9Cn0KCgoKCgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBUb2tlblRpbWVsb2NrCiAqIEBkZXYgVG9rZW5UaW1lbG9jayBpcyBhIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IHdpbGwgYWxsb3cgYQogKiBiZW5lZmljaWFyeSB0byBleHRyYWN0IHRoZSB0b2tlbnMgYWZ0ZXIgYSBnaXZlbiByZWxlYXNlIHRpbWUKICovCmNvbnRyYWN0IFRva2VuVGltZWxvY2sgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLy8gRVJDMjAgYmFzaWMgdG9rZW4gY29udHJhY3QgYmVpbmcgaGVsZAogIEVSQzIwQmFzaWMgcHVibGljIHRva2VuOwoKICAvLyBiZW5lZmljaWFyeSBvZiB0b2tlbnMgYWZ0ZXIgdGhleSBhcmUgcmVsZWFzZWQKICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKCiAgLy8gdGltZXN0YW1wIHdoZW4gdG9rZW4gcmVsZWFzZSBpcyBlbmFibGVkCiAgdWludDI1NiBwdWJsaWMgcmVsZWFzZVRpbWU7CgogIGZ1bmN0aW9uIFRva2VuVGltZWxvY2soRVJDMjBCYXNpYyBfdG9rZW4sIGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9yZWxlYXNlVGltZSkgcHVibGljIHsKICAgIHJlcXVpcmUoX3JlbGVhc2VUaW1lID4gbm93KTsKICAgIHRva2VuID0gX3Rva2VuOwogICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICByZWxlYXNlVGltZSA9IF9yZWxlYXNlVGltZTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHRva2VucyBoZWxkIGJ5IHRpbWVsb2NrIHRvIGJlbmVmaWNpYXJ5LgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoKSBwdWJsaWMgewogICAgcmVxdWlyZShub3cgPj0gcmVsZWFzZVRpbWUpOwoKICAgIHVpbnQyNTYgYW1vdW50ID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgcmVxdWlyZShhbW91bnQgPiAwKTsKCiAgICB0b2tlbi5zYWZlVHJhbnNmZXIoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgfQp9CgoKCgoKCi8qKgogKiBAdGl0bGUgUmVmdW5kVmF1bHQKICogQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgZm9yIHN0b3JpbmcgZnVuZHMgd2hpbGUgYSBjcm93ZHNhbGUKICogaXMgaW4gcHJvZ3Jlc3MuIFN1cHBvcnRzIHJlZnVuZGluZyB0aGUgbW9uZXkgaWYgY3Jvd2RzYWxlIGZhaWxzLAogKiBhbmQgZm9yd2FyZGluZyBpdCBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bC4KICovCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGRlcG9zaXRlZDsKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CiAgU3RhdGUgcHVibGljIHN0YXRlOwoKICBldmVudCBDbG9zZWQoKTsKICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwoKICBmdW5jdGlvbiBSZWZ1bmRWYXVsdChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgfQoKICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgaW52ZXN0b3IpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkW2ludmVzdG9yXS5hZGQobXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogIH0KfQoKCgovKioKICogQHRpdGxlIFNlbGZLZXlDcm93ZHNhbGUKICogQGRldiBTZWxmS2V5IFRva2VuIENyb3dkc2FsZSBpbXBsZW1lbnRhdGlvbi4KICovCi8vIHNvbGhpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXN0YXRlcy1jb3VudApjb250cmFjdCBTZWxmS2V5Q3Jvd2RzYWxlIGlzIE93bmFibGUsIENyb3dkc2FsZUNvbmZpZyB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIHVzaW5nIFNhZmVFUkMyMCBmb3IgU2VsZktleVRva2VuOwoKICAgIC8vIHdoaXRlbGlzdCBvZiBhZGRyZXNzZXMgdGhhdCBjYW4gcGVyZm9ybSBwcmVjb21taXRtZW50cyBhbmQgS1lDIHZlcmlmaWNhdGlvbnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNWZXJpZmllcjsKCiAgICAvLyBUb2tlbiBjb250cmFjdAogICAgU2VsZktleVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICB1aW50NjQgcHVibGljIHN0YXJ0VGltZTsKICAgIHVpbnQ2NCBwdWJsaWMgZW5kVGltZTsKCiAgICAvLyBNaW5pbXVtIHRva2VucyBleHBlY3RlZCB0byBzZWxsCiAgICB1aW50MjU2IHB1YmxpYyBnb2FsOwoKICAgIC8vIEhvdyBtYW55IHRva2VucyBhIGJ1eWVyIGdldHMgcGVyIEVUSAogICAgdWludDI1NiBwdWJsaWMgcmF0ZSA9IDUxODAwOwoKICAgIC8vIEVUSCBwcmljZSBpbiBVU0QsIGNhbiBiZSBsYXRlciB1cGRhdGVkIHVudGlsIHN0YXJ0IGRhdGUKICAgIHVpbnQyNTYgcHVibGljIGV0aFByaWNlID0gNzc3OwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkLCBpbmNsdWRpbmcgcHJlLXNhbGUKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsUHVyY2hhc2VkID0gMDsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGt5Y1ZlcmlmaWVkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbnNQdXJjaGFzZWQ7CgogICAgLy8gYSBtYXBwaW5nIG9mIGR5bmFtaWNhbGx5IGluc3RhbnRpYXRlZCB0b2tlbiB0aW1lbG9ja3MgZm9yIGVhY2ggcHJlLWNvbW1pdG1lbnQgYmVuZWZpY2lhcnkKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBhZGRyZXNzKSBwdWJsaWMgdmVzdGVkVG9rZW5zOwoKICAgIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogICAgLy8gVG9rZW4gVGltZWxvY2tzCiAgICBUb2tlblRpbWVsb2NrIHB1YmxpYyBmb3VuZGVyc1RpbWVsb2NrMTsKICAgIFRva2VuVGltZWxvY2sgcHVibGljIGZvdW5kZXJzVGltZWxvY2syOwogICAgVG9rZW5UaW1lbG9jayBwdWJsaWMgZm91bmRhdGlvblRpbWVsb2NrOwoKICAgIC8vIFZhdWx0IHRvIGhvbGQgZnVuZHMgdW50aWwgY3Jvd2RzYWxlIGlzIGZpbmFsaXplZC4gQWxsb3dzIHJlZnVuZGluZyBpZiBjcm93ZHNhbGUgaXMgbm90IHN1Y2Nlc3NmdWwuCiAgICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAgLy8gQ3Jvd2RzYWxlIGV2ZW50cwogICAgZXZlbnQgVG9rZW5QdXJjaGFzZSgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwKICAgICAgICB1aW50MjU2IHZhbHVlLAogICAgICAgIHVpbnQyNTYgYW1vdW50CiAgICApOwoKICAgIGV2ZW50IFZlcmlmaWVkS1lDKGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCk7CgogICAgZXZlbnQgQWRkZWRQcmVjb21taXRtZW50KAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwKICAgICAgICB1aW50MjU2IHRva2Vuc0FsbG9jYXRlZAogICAgKTsKCiAgICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgICBtb2RpZmllciB2ZXJpZmllck9ubHkoKSB7CiAgICAgICAgcmVxdWlyZShpc1ZlcmlmaWVyW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDcm93ZHNhbGUgY29udHJhY3QgY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSBfc3RhcnRUaW1lIOKAlCBVbml4IHRpbWVzdGFtcCByZXByZXNlbnRpbmcgdGhlIGNyb3dkc2FsZSBzdGFydCB0aW1lCiAgICAgKiBAcGFyYW0gX2VuZFRpbWUg4oCUIFVuaXggdGltZXN0YW1wIHJlcHJlc2VudGluZyB0aGUgY3Jvd2RzYWxlIHN0YXJ0IHRpbWUKICAgICAqIEBwYXJhbSBfZ29hbCDigJQgTWluaW11bSBhbW91bnQgb2YgdG9rZW5zIGV4cGVjdGVkIHRvIHNlbGwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNlbGZLZXlDcm93ZHNhbGUoCiAgICAgICAgdWludDY0IF9zdGFydFRpbWUsCiAgICAgICAgdWludDY0IF9lbmRUaW1lLAogICAgICAgIHVpbnQyNTYgX2dvYWwKICAgICkgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShfZW5kVGltZSA+IF9zdGFydFRpbWUpOwoKICAgICAgICAvLyBzZXRzIGNvbnRyYWN0IG93bmVyIGFzIGEgdmVyaWZpZXIKICAgICAgICBpc1ZlcmlmaWVyW21zZy5zZW5kZXJdID0gdHJ1ZTsKCiAgICAgICAgdG9rZW4gPSBuZXcgU2VsZktleVRva2VuKFRPVEFMX1NVUFBMWV9DQVApOwoKICAgICAgICAvLyBtaW50cyBhbGwgcG9zc2libGUgdG9rZW5zIHRvIHRoZSBjcm93ZHNhbGUgY29udHJhY3QKICAgICAgICB0b2tlbi5taW50KGFkZHJlc3ModGhpcyksIFRPVEFMX1NVUFBMWV9DQVApOwogICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKCiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICAgICAgZ29hbCA9IF9nb2FsOwoKICAgICAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdChDUk9XRFNBTEVfV0FMTEVUX0FERFIpOwoKICAgICAgICAvLyBTZXQgdGltZWxvY2tzIHRvIDYgbW9udGhzIGFuZCBhIHllYXIgYWZ0ZXIgc3RhcnRUaW1lLCByZXNwZWN0aXZlbHkKICAgICAgICB1aW50NjQgc2l4TW9udGhMb2NrID0gdWludDY0KHN0YXJ0VGltZSArIDE1NTUyMDAwKTsKICAgICAgICB1aW50NjQgeWVhckxvY2sgPSB1aW50NjQoc3RhcnRUaW1lICsgMzExMDQwMDApOwoKICAgICAgICAvLyBJbnN0YW50aWF0aW9uIG9mIHRva2VuIHRpbWVsb2NrcwogICAgICAgIGZvdW5kZXJzVGltZWxvY2sxID0gbmV3IFRva2VuVGltZWxvY2sodG9rZW4sIEZPVU5ERVJTX1BPT0xfQUREUiwgc2l4TW9udGhMb2NrKTsKICAgICAgICBmb3VuZGVyc1RpbWVsb2NrMiA9IG5ldyBUb2tlblRpbWVsb2NrKHRva2VuLCBGT1VOREVSU19QT09MX0FERFIsIHllYXJMb2NrKTsKICAgICAgICBmb3VuZGF0aW9uVGltZWxvY2sgPSBuZXcgVG9rZW5UaW1lbG9jayh0b2tlbiwgRk9VTkRBVElPTl9QT09MX0FERFJfVkVTVCwgeWVhckxvY2spOwoKICAgICAgICAvLyBHZW5lc2lzIGFsbG9jYXRpb24gb2YgdG9rZW5zCiAgICAgICAgdG9rZW4uc2FmZVRyYW5zZmVyKEZPVU5EQVRJT05fUE9PTF9BRERSLCBGT1VOREFUSU9OX1BPT0xfVE9LRU5TKTsKICAgICAgICB0b2tlbi5zYWZlVHJhbnNmZXIoQ09NTVVOSVRZX1BPT0xfQUREUiwgQ09NTVVOSVRZX1BPT0xfVE9LRU5TKTsKICAgICAgICB0b2tlbi5zYWZlVHJhbnNmZXIoRk9VTkRFUlNfUE9PTF9BRERSLCBGT1VOREVSU19UT0tFTlMpOwogICAgICAgIHRva2VuLnNhZmVUcmFuc2ZlcihMRUdBTF9FWFBFTlNFU19BRERSXzEsIExFR0FMX0VYUEVOU0VTXzFfVE9LRU5TKTsKICAgICAgICB0b2tlbi5zYWZlVHJhbnNmZXIoTEVHQUxfRVhQRU5TRVNfQUREUl8yLCBMRUdBTF9FWFBFTlNFU18yX1RPS0VOUyk7CgogICAgICAgIC8vIEFsbG9jYXRpb24gb2YgdmVzdGVkIHRva2VucwogICAgICAgIHRva2VuLnNhZmVUcmFuc2Zlcihmb3VuZGVyc1RpbWVsb2NrMSwgRk9VTkRFUlNfVE9LRU5TX1ZFU1RFRF8xKTsKICAgICAgICB0b2tlbi5zYWZlVHJhbnNmZXIoZm91bmRlcnNUaW1lbG9jazIsIEZPVU5ERVJTX1RPS0VOU19WRVNURURfMik7CiAgICAgICAgdG9rZW4uc2FmZVRyYW5zZmVyKGZvdW5kYXRpb25UaW1lbG9jaywgRk9VTkRBVElPTl9QT09MX1RPS0VOU19WRVNURUQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGYWxsYmFjayBmdW5jdGlvbiBpcyB1c2VkIHRvIGJ1eSB0b2tlbnMuCiAgICAgKiAgICAgIEl0J3MgdGhlIG9ubHkgZW50cnkgcG9pbnQgc2luY2UgYGJ1eVRva2Vuc2AgaXMgaW50ZXJuYWwKICAgICAqLwogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWRkcyBhbiBhZGRyZXNzIHRvIHRoZSB3aGl0ZWxpc3Qgb2YgVmVyaWZpZXJzCiAgICAgKiBAcGFyYW0gX2FkZHJlc3MgLSBhZGRyZXNzIG9mIHRoZSB2ZXJpZmllcgogICAgICovCiAgICBmdW5jdGlvbiBhZGRWZXJpZmllciAoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaXNWZXJpZmllcltfYWRkcmVzc10gPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZW1vdmVzIGFuIGFkZHJlc3MgZnJvbSB0aGUgd2hpdGVsaXN0IG9mIFZlcmlmaWVycwogICAgICogQHBhcmFtIF9hZGRyZXNzIC0gYWRkcmVzcyBvZiB0aGUgdmVyaWZpZXIgdG8gYmUgcmVtb3ZlZAogICAgICovCiAgICBmdW5jdGlvbiByZW1vdmVWZXJpZmllciAoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaXNWZXJpZmllcltfYWRkcmVzc10gPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0cyBhIG5ldyBzdGFydCBkYXRlIGFzIGxvbmcgYXMgdG9rZW4gaGFzbid0IHN0YXJ0ZWQgeWV0CiAgICAgKiBAcGFyYW0gX3N0YXJ0VGltZSAtIHVuaXggdGltZXN0YW1wIG9mIHRoZSBuZXcgc3RhcnQgdGltZQogICAgICovCiAgICBmdW5jdGlvbiBzZXRTdGFydFRpbWUgKHVpbnQ2NCBfc3RhcnRUaW1lKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgICAgcmVxdWlyZShfc3RhcnRUaW1lID4gbm93KTsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPCBlbmRUaW1lKTsKCiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0cyBhIG5ldyBlbmQgZGF0ZSBhcyBsb25nIGFzIGVuZCBkYXRlIGhhc24ndCBiZWVuIHJlYWNoZWQKICAgICAqIEBwYXJhbSBfZW5kVGltZSAtIHVuaXggdGltZXN0YW1wIG9mIHRoZSBuZXcgZW5kIHRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0RW5kVGltZSAodWludDY0IF9lbmRUaW1lKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5vdyA8IGVuZFRpbWUpOwogICAgICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBub3cpOwogICAgICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBzdGFydFRpbWUpOwoKICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZXMgdGhlIEVUSC9VU0QgY29udmVyc2lvbiByYXRlIGFzIGxvbmcgYXMgdGhlIHB1YmxpYyBzYWxlIGhhc24ndCBzdGFydGVkCiAgICAgKiBAcGFyYW0gX2V0aFByaWNlIC0gVXBkYXRlZCBjb252ZXJzaW9uIHJhdGUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0RXRoUHJpY2UodWludDI1NiBfZXRoUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobm93IDwgc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9ldGhQcmljZSA+IDApOwoKICAgICAgICBldGhQcmljZSA9IF9ldGhQcmljZTsKICAgICAgICByYXRlID0gZXRoUHJpY2UubXVsKDEwMDApLmRpdihUT0tFTl9QUklDRV9USE9VU0FORFRIKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvIHNvbWUgZXh0cmEgZmluYWxpemF0aW9uCiAgICAgKiAgICAgIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5vdyA+IHN0YXJ0VGltZSk7CiAgICAgICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwoKICAgICAgICBmaW5hbGl6YXRpb24oKTsKICAgICAgICBGaW5hbGl6ZWQoKTsKCiAgICAgICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBJZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBhIHJlZnVuZCBjYW4gYmUgY2xhaW1lZCBiYWNrCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kKGFkZHJlc3MgcGFydGljaXBhbnQpIHB1YmxpYyB7CiAgICAgICAgLy8gcmVxdWlyZXMgc2FsZSB0byBiZSBmaW5hbGl6ZWQgYW5kIGdvYWwgbm90IHJlYWNoZWQsCiAgICAgICAgcmVxdWlyZShpc0ZpbmFsaXplZCk7CiAgICAgICAgcmVxdWlyZSghZ29hbFJlYWNoZWQoKSk7CgogICAgICAgIHZhdWx0LnJlZnVuZChwYXJ0aWNpcGFudCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IElmIGNyb3dkc2FsZSBpcyB1bnN1Y2Nlc3NmdWwsIHBhcnRpY2lwYW50cyBjYW4gY2xhaW0gcmVmdW5kcwogICAgICovCiAgICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRvdGFsUHVyY2hhc2VkID49IGdvYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbGVhc2UgdGltZS1sb2NrZWQgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VMb2NrRm91bmRlcnMxKCkgcHVibGljIHsKICAgICAgICBmb3VuZGVyc1RpbWVsb2NrMS5yZWxlYXNlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVsZWFzZUxvY2tGb3VuZGVyczIoKSBwdWJsaWMgewogICAgICAgIGZvdW5kZXJzVGltZWxvY2syLnJlbGVhc2UoKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWxlYXNlTG9ja0ZvdW5kYXRpb24oKSBwdWJsaWMgewogICAgICAgIGZvdW5kYXRpb25UaW1lbG9jay5yZWxlYXNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbGVhc2UgdGltZS1sb2NrZWQgdG9rZW5zIGZvciBhbnkgdmVzdGVkIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gcmVsZWFzZUxvY2soYWRkcmVzcyBwYXJ0aWNpcGFudCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHZlc3RlZFRva2Vuc1twYXJ0aWNpcGFudF0gIT0gMHgwKTsKCiAgICAgICAgVG9rZW5UaW1lbG9jayB0aW1lbG9jayA9IFRva2VuVGltZWxvY2sodmVzdGVkVG9rZW5zW3BhcnRpY2lwYW50XSk7CiAgICAgICAgdGltZWxvY2sucmVsZWFzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBWZXJpZmllcyBLWUMgZm9yIGdpdmVuIHBhcnRpY2lwYW50LgogICAgICogICAgICBUaGlzIGVuYWJsZXMgdG9rZW4gcHVyY2hhc2VzIGJ5IHRoZSBwYXJ0aWNpcGFudCBhZGRyZXMKICAgICAqLwogICAgZnVuY3Rpb24gdmVyaWZ5S1lDKGFkZHJlc3MgcGFydGljaXBhbnQpIHB1YmxpYyB2ZXJpZmllck9ubHkgewogICAgICAgIGt5Y1ZlcmlmaWVkW3BhcnRpY2lwYW50XSA9IHRydWU7CgogICAgICAgIFZlcmlmaWVkS1lDKHBhcnRpY2lwYW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWRkcyBhbiBhZGRyZXNzIGZvciBwcmUtc2FsZSBjb21taXRtZW50cyBtYWRlIG9mZi1jaGFpbi4KICAgICAqIEBwYXJhbSBiZW5lZmljaWFyeSDigJQgQWRkcmVzcyBvZiB0aGUgYWxyZWFkeSB2ZXJpZmllZCBwYXJ0aWNpcGFudAogICAgICogQHBhcmFtIHRva2Vuc0FsbG9jYXRlZCDigJQgRXhhY3QgYW1vdW50IG9mIEtFWSB0b2tlbnMgKGluY2x1ZGluZyBkZWNpbWFsIHBsYWNlcykgdG8gYWxsb2NhdGUKICAgICAqIEBwYXJhbSBoYWxmVmVzdGluZyDigJQgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBoYWxmIHRoZSB0b2tlbnMgd2lsbCBiZSB0aW1lLWxvY2tlZCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gYWRkUHJlY29tbWl0bWVudCgKICAgICAgICBhZGRyZXNzIGJlbmVmaWNpYXJ5LAogICAgICAgIHVpbnQyNTYgdG9rZW5zQWxsb2NhdGVkLAogICAgICAgIGJvb2wgaGFsZlZlc3RpbmcKICAgICkgcHVibGljIHZlcmlmaWVyT25seQogICAgewogICAgICAgIC8vIHJlcXVpcmVzIHRvIGJlIG9uIHByZS1zYWxlCiAgICAgICAgcmVxdWlyZShub3cgPCBzdGFydFRpbWUpOyAvLyBzb2xoaW50LWRpc2FibGUtbGluZSBub3QtcmVseS1vbi10aW1lCgogICAgICAgIGt5Y1ZlcmlmaWVkW2JlbmVmaWNpYXJ5XSA9IHRydWU7CgogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gdG9rZW5zQWxsb2NhdGVkOwogICAgICAgIHRvdGFsUHVyY2hhc2VkID0gdG90YWxQdXJjaGFzZWQuYWRkKHRva2Vucyk7CiAgICAgICAgdG9rZW5zUHVyY2hhc2VkW2JlbmVmaWNpYXJ5XSA9IHRva2Vuc1B1cmNoYXNlZFtiZW5lZmljaWFyeV0uYWRkKHRva2Vucyk7CgogICAgICAgIGlmIChoYWxmVmVzdGluZykgewogICAgICAgICAgICAvLyBoYWxmIHRoZSB0b2tlbnMgYXJlIHB1dCBpbnRvIGEgdGltZS1sb2NrIGZvciBhIHByZS1kZWZpbmVkIHBlcmlvZAogICAgICAgICAgICB1aW50NjQgZW5kVGltZUxvY2sgPSB1aW50NjQoc3RhcnRUaW1lICsgUFJFQ09NTUlUTUVOVF9WRVNUSU5HX1NFQ09ORFMpOwoKICAgICAgICAgICAgLy8gU2V0cyBhIHRpbWVsb2NrIGZvciBoYWxmIHRoZSB0b2tlbnMgYWxsb2NhdGVkCiAgICAgICAgICAgIHVpbnQyNTYgaGFsZiA9IHRva2Vucy5kaXYoMik7CiAgICAgICAgICAgIFRva2VuVGltZWxvY2sgdGltZWxvY2s7CgogICAgICAgICAgICBpZiAodmVzdGVkVG9rZW5zW2JlbmVmaWNpYXJ5XSA9PSAweDApIHsKICAgICAgICAgICAgICAgIHRpbWVsb2NrID0gbmV3IFRva2VuVGltZWxvY2sodG9rZW4sIGJlbmVmaWNpYXJ5LCBlbmRUaW1lTG9jayk7CiAgICAgICAgICAgICAgICB2ZXN0ZWRUb2tlbnNbYmVuZWZpY2lhcnldID0gYWRkcmVzcyh0aW1lbG9jayk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aW1lbG9jayA9IFRva2VuVGltZWxvY2sodmVzdGVkVG9rZW5zW2JlbmVmaWNpYXJ5XSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRva2VuLnNhZmVUcmFuc2ZlcihiZW5lZmljaWFyeSwgaGFsZik7CiAgICAgICAgICAgIHRva2VuLnNhZmVUcmFuc2Zlcih0aW1lbG9jaywgdG9rZW5zLnN1YihoYWxmKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gYWxsIHRva2VucyBhcmUgc2VudCB0byB0aGUgcGFydGljaXBhbnQncyBhZGRyZXNzCiAgICAgICAgICAgIHRva2VuLnNhZmVUcmFuc2ZlcihiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgICAgICB9CgogICAgICAgIEFkZGVkUHJlY29tbWl0bWVudCgKICAgICAgICAgICAgYmVuZWZpY2lhcnksCiAgICAgICAgICAgIHRva2VucwogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFkZGl0aW9uYWwgZmluYWxpemF0aW9uIGxvZ2ljLiBFbmFibGVzIHRva2VuIHRyYW5zZmVycy4KICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogICAgICAgIGlmIChnb2FsUmVhY2hlZCgpKSB7CiAgICAgICAgICAgIGJ1cm5VbnNvbGQoKTsKICAgICAgICAgICAgdmF1bHQuY2xvc2UoKTsKICAgICAgICAgICAgdG9rZW4uZW5hYmxlVHJhbnNmZXJzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqICBAZGV2IExvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZS4gT25seSBjYWxsYWJsZSBpbnRlcm5hbGx5LiBQYXJ0aWNpcGFudHMgTVVTVCBiZSBLWUMtdmVyaWZpZWQgYmVmb3JlIHB1cmNoYXNlCiAgICAgKiAgQHBhcmFtIHBhcnRpY2lwYW50IOKAlCBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gcHVyY2hhc2VyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIHBhcnRpY2lwYW50KSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShreWNWZXJpZmllZFtwYXJ0aWNpcGFudF0pOwogICAgICAgIHJlcXVpcmUobm93ID49IHN0YXJ0VGltZSk7CiAgICAgICAgcmVxdWlyZShub3cgPCBlbmRUaW1lKTsKICAgICAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgIT0gMCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgdG9rZW4gYW1vdW50IHRvIGJlIGFsbG9jYXRlZAogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKTsKCiAgICAgICAgLy8gVXBkYXRlIHN0YXRlCiAgICAgICAgdG9rZW5zUHVyY2hhc2VkW3BhcnRpY2lwYW50XSA9IHRva2Vuc1B1cmNoYXNlZFtwYXJ0aWNpcGFudF0uYWRkKHRva2Vucyk7CiAgICAgICAgdG90YWxQdXJjaGFzZWQgPSB0b3RhbFB1cmNoYXNlZC5hZGQodG9rZW5zKTsKCiAgICAgICAgcmVxdWlyZSh0b3RhbFB1cmNoYXNlZCA8PSBTQUxFX0NBUCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNQdXJjaGFzZWRbcGFydGljaXBhbnRdID49IFBVUkNIQVNFUl9NSU5fVE9LRU5fQ0FQKTsKCiAgICAgICAgaWYgKG5vdyA8IHN0YXJ0VGltZSArIDg2NDAwKSB7CiAgICAgICAgICAgIC8vIGlmIHN0aWxsIGR1cmluZyB0aGUgZmlyc3QgZGF5IG9mIHRva2VuIHNhbGUsIGFwcGx5IGRpZmZlcmVudCBtYXggY2FwCiAgICAgICAgICAgIHJlcXVpcmUodG9rZW5zUHVyY2hhc2VkW3BhcnRpY2lwYW50XSA8PSBQVVJDSEFTRVJfTUFYX1RPS0VOX0NBUF9EQVkxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKHRva2Vuc1B1cmNoYXNlZFtwYXJ0aWNpcGFudF0gPD0gUFVSQ0hBU0VSX01BWF9UT0tFTl9DQVApOwogICAgICAgIH0KCiAgICAgICAgLy8gU2VuZHMgRVRIIGNvbnRyaWJ1dGlvbiB0byB0aGUgUmVmdW5kVmF1bHQgYW5kIHRva2VucyB0byBwYXJ0aWNpcGFudAogICAgICAgIHZhdWx0LmRlcG9zaXQudmFsdWUobXNnLnZhbHVlKShwYXJ0aWNpcGFudCk7CiAgICAgICAgdG9rZW4uc2FmZVRyYW5zZmVyKHBhcnRpY2lwYW50LCB0b2tlbnMpOwoKICAgICAgICBUb2tlblB1cmNoYXNlKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBwYXJ0aWNpcGFudCwKICAgICAgICAgICAgd2VpQW1vdW50LAogICAgICAgICAgICB0b2tlbnMKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCdXJuIGFsbCByZW1haW5pbmcgKHVuc29sZCkgdG9rZW5zLgogICAgICogICAgICBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgc2FsZSBmaW5hbGl6YXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gYnVyblVuc29sZCgpIGludGVybmFsIHsKICAgICAgICAvLyBBbGwgdG9rZW5zIGhlbGQgYnkgdGhpcyBjb250cmFjdCBnZXQgYnVybmVkCiAgICAgICAgdG9rZW4uYnVybih0b2tlbi5iYWxhbmNlT2YodGhpcykpOwogICAgfQp9'.
	

]
