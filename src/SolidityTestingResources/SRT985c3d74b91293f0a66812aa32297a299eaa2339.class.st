Class {
	#name : #SRT985c3d74b91293f0a66812aa32297a299eaa2339,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT985c3d74b91293f0a66812aa32297a299eaa2339 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIC8qKgogICAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgICAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAgICoKICAgICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8qKgogICAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCgoKLy8vIEB0aXRsZSBTdGFuZGFyZFRva2VuIHdoaWNoIGNhbiBiZSBtaW50ZWQgYnkgYW5vdGhlciBjb250cmFjdC4KY29udHJhY3QgTWludGFibGVUb2tlbiB7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwoKICAgIC8vLyBAZGV2IG1pbnRzIG5ldyB0b2tlbnMKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgoKCi8qKgogKiBNZXRyb3BvbE1pbnRhYmxlVG9rZW4KICovCmNvbnRyYWN0IE1ldHJvcG9sTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBNaW50YWJsZVRva2VuIHsKCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOy8vdG9kbyBwcm9wb3NlIHJldHVybiB2YWx1ZQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgICAqIEludGVybmFsIGZvciBub3QgZm9yZ2V0dGluZyB0byBhZGQgYWNjZXNzIG1vZGlmaWVyCiAgICAgKgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICAgKgogICAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICAqLwogICAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9hbW91bnQ+MCk7CiAgICAgICAgcmVxdWlyZShfdG8hPWFkZHJlc3MoMCkpOwoKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgTWludChfdG8sIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKLyoqCiAqIENvbnRyYWN0IHdoaWNoIGlzIG9wZXJhdGVkIGJ5IGNvbnRyb2xsZXIuCiAqCiAqIFByb3ZpZGVzIGEgd2F5IHRvIHNldCB1cCBhbiBlbnRpdHkgKHR5cGljYWxseSBvdGhlciBjb250cmFjdCkgZW50aXRsZWQgdG8gY29udHJvbCBhY3Rpb25zIG9mIHRoaXMgY29udHJhY3QuCiAqCiAqIENvbnRyb2xsZXIgY2hlY2sgaXMgcGVyZm9ybWVkIGJ5IG9ubHlDb250cm9sbGVyIG1vZGlmaWVyLgogKi8KY29udHJhY3QgQ29udHJvbGxlZCB7CgogICAgYWRkcmVzcyBwdWJsaWMgbV9jb250cm9sbGVyOwoKICAgIGV2ZW50IENvbnRyb2xsZXJTZXQoYWRkcmVzcyBjb250cm9sbGVyKTsKICAgIGV2ZW50IENvbnRyb2xsZXJSZXRpcmVkKGFkZHJlc3Mgd2FzKTsKCgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtX2NvbnRyb2xsZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBleHRlcm5hbDsKCiAgICAvKioKICAgICAqIFNldHMgdGhlIGNvbnRyb2xsZXIuIEludGVybmFsIGZvciBub3QgZm9yZ2V0dGluZyB0byBhZGQgYWNjZXNzIG1vZGlmaWVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnRyb2xsZXJJbnRlcm5hbChhZGRyZXNzIF9jb250cm9sbGVyKSBpbnRlcm5hbCB7CiAgICAgICAgbV9jb250cm9sbGVyID0gX2NvbnRyb2xsZXI7CiAgICAgICAgQ29udHJvbGxlclNldChtX2NvbnRyb2xsZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQWJpbGl0eSBmb3IgY29udHJvbGxlciB0byBzdGVwIGRvd24KICAgICAqLwogICAgZnVuY3Rpb24gZGV0YWNoQ29udHJvbGxlcigpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBhZGRyZXNzIHdhcyA9IG1fY29udHJvbGxlcjsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBhZGRyZXNzKDApOwogICAgICAgIENvbnRyb2xsZXJSZXRpcmVkKHdhcyk7CiAgICB9Cn0KCgovKioKICogTWludGFibGVDb250cm9sbGVkVG9rZW4KICovCmNvbnRyYWN0IE1pbnRhYmxlQ29udHJvbGxlZFRva2VuIGlzIE1ldHJvcG9sTWludGFibGVUb2tlbiwgQ29udHJvbGxlZCB7CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAgICoKICAgICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBzdXBlci5taW50SW50ZXJuYWwoX3RvLCBfYW1vdW50KTsKICAgIH0KCn0KCgovKioKICogQnVybmFibGVUb2tlbgogKi8KY29udHJhY3QgQnVybmFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IGFtb3VudCk7CgogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRvIGJ1cm4gdG9rZW5zCiAgICAgKiBJbnRlcm5hbCBmb3Igbm90IGZvcmdldHRpbmcgdG8gYWRkIGFjY2VzcyBtb2RpZmllcgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0byBidXJuIHRva2VucyBmcm9tLgogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYnVybi4KICAgICAqCiAgICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAgICovCiAgICBmdW5jdGlvbiBidXJuSW50ZXJuYWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50PjApOwogICAgICAgIHJlcXVpcmUoX2Ftb3VudDw9YmFsYW5jZXNbX2Zyb21dKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfYW1vdW50KTsKICAgICAgICBCdXJuKF9mcm9tLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgYWRkcmVzcygwKSwgX2Ftb3VudCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKCi8qKgogKiBCdXJuYWJsZUNvbnRyb2xsZWRUb2tlbgogKi8KY29udHJhY3QgQnVybmFibGVDb250cm9sbGVkVG9rZW4gaXMgQnVybmFibGVUb2tlbiwgQ29udHJvbGxlZCB7CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBidXJuIHRva2VucwogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0byBidXJuIHRva2VucyBmcm9tLgogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYnVybi4KICAgICAqCiAgICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAgICovCiAgICBmdW5jdGlvbiBidXJuKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYnVybkludGVybmFsKF9mcm9tLCBfYW1vdW50KTsKICAgIH0KCn0KCgovLy8gbm90ZTogZHVyaW5nIGFueSBvd25lcnNoaXAgY2hhbmdlcyBhbGwgcGVuZGluZyBvcGVyYXRpb25zICh3YWl0aW5nIGZvciBtb3JlIHNpZ25hdHVyZXMpIGFyZSBjYW5jZWxsZWQKLy8gVE9ETyBhY2NlcHRPd25lcnNoaXAKY29udHJhY3QgbXVsdGlvd25lZCB7CgogICAgLy8gVFlQRVMKCiAgICAvLyBzdHJ1Y3QgZm9yIHRoZSBzdGF0dXMgb2YgYSBwZW5kaW5nIG9wZXJhdGlvbi4KICAgIHN0cnVjdCBNdWx0aU93bmVkT3BlcmF0aW9uUGVuZGluZ1N0YXRlIHsKICAgIC8vIGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkCiAgICB1aW50IHlldE5lZWRlZDsKCiAgICAvLyBiaXRtYXAgb2YgY29uZmlybWF0aW9ucyB3aGVyZSBvd25lciAjb3duZXJJbmRleCdzIGRlY2lzaW9uIGNvcnJlc3BvbmRzIHRvIDIqKm93bmVySW5kZXggYml0CiAgICB1aW50IG93bmVyc0RvbmU7CgogICAgLy8gcG9zaXRpb24gb2YgdGhpcyBvcGVyYXRpb24ga2V5IGluIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleAogICAgdWludCBpbmRleDsKICAgIH0KCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IEZpbmFsQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKCiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwoKICAgIC8vIHRoZSBsYXN0IG9uZSBpcyBlbWl0dGVkIGlmIHRoZSByZXF1aXJlZCBzaWduYXR1cmVzIGNoYW5nZQogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2VkKHVpbnQgbmV3UmVxdWlyZW1lbnQpOwoKICAgIC8vIE1PRElGSUVSUwoKICAgIC8vIHNpbXBsZSBzaW5nbGUtc2lnIGZ1bmN0aW9uIG1vZGlmaWVyLgogICAgbW9kaWZpZXIgb25seW93bmVyIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CiAgICAvLyBtdWx0aS1zaWcgZnVuY3Rpb24gbW9kaWZpZXI6IHRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQKICAgIC8vIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgIG1vZGlmaWVyIG9ubHltYW55b3duZXJzKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgLy8gRXZlbiBpZiByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBoYXMndCBiZWVuIGNvbGxlY3RlZCB5ZXQsCiAgICAgICAgLy8gd2UgY2FuJ3QgdGhyb3cgaGVyZSAtIGJlY2F1c2UgY2hhbmdlcyB0byB0aGUgc3RhdGUgaGF2ZSB0byBiZSBwcmVzZXJ2ZWQuCiAgICAgICAgLy8gQnV0LCBjb25maXJtQW5kQ2hlY2sgaXRzZWxmIHdpbGwgdGhyb3cgaW4gY2FzZSBzZW5kZXIgaXMgbm90IGFuIG93bmVyLgogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkTnVtT3duZXJzKHVpbnQgX251bU93bmVycykgewogICAgICAgIHJlcXVpcmUoX251bU93bmVycyA+IDAgJiYgX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCwgdWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWQgPiAwICYmIF9yZXF1aXJlZCA8PSBfbnVtT3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyKF9hZGRyZXNzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgcmVxdWlyZShpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgaXMgZ2l2ZW4gbnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgdG8gZG8gcHJvdGVjdGVkICJvbmx5bWFueW93bmVycyIgdHJhbnNhY3Rpb25zCiAgICAvLyBhcyB3ZWxsIGFzIHRoZSBzZWxlY3Rpb24gb2YgYWRkcmVzc2VzIGNhcGFibGUgb2YgY29uZmlybWluZyB0aGVtIChtc2cuc2VuZGVyIGlzIG5vdCBhZGRlZCB0byB0aGUgb3duZXJzISkuCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgIHZhbGlkTnVtT3duZXJzKF9vd25lcnMubGVuZ3RoKQogICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQoX3JlcXVpcmVkLCBfb3duZXJzLmxlbmd0aCkKICAgIHsKICAgICAgICBhc3NlcnQoY19tYXhPd25lcnMgPD0gMjU1KTsKCiAgICAgICAgbV9udW1Pd25lcnMgPSBfb3duZXJzLmxlbmd0aDsKICAgICAgICBtX211bHRpT3duZWRSZXF1aXJlZCA9IF9yZXF1aXJlZDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7ICsraSkKICAgICAgICB7CiAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfb3duZXJzW2ldOwogICAgICAgICAgICAvLyBpbnZhbGlkIGFuZCBkdXBsaWNhdGUgYWRkcmVzc2VzIGFyZSBub3QgYWxsb3dlZAogICAgICAgICAgICByZXF1aXJlKDAgIT0gb3duZXIgJiYgIWlzT3duZXIob3duZXIpIC8qIG5vdCBpc093bmVyIHlldCEgKi8pOwoKICAgICAgICAgICAgdWludCBjdXJyZW50T3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChpICsgMSAvKiBmaXJzdCBzbG90IGlzIHVudXNlZCAqLyk7CiAgICAgICAgICAgIG1fb3duZXJzW2N1cnJlbnRPd25lckluZGV4XSA9IG93bmVyOwogICAgICAgICAgICBtX293bmVySW5kZXhbb3duZXJdID0gY3VycmVudE93bmVySW5kZXg7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcmVwbGFjZXMgYW4gb3duZXIgYF9mcm9tYCB3aXRoIGFub3RoZXIgYF90b2AuCiAgICAvLy8gQHBhcmFtIF9mcm9tIGFkZHJlc3Mgb2Ygb3duZXIgdG8gcmVwbGFjZQogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBvZiBuZXcgb3duZXIKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKQogICAgZXh0ZXJuYWwKICAgIG93bmVyRXhpc3RzKF9mcm9tKQogICAgb3duZXJEb2VzTm90RXhpc3QoX3RvKQogICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19mcm9tXSk7CiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSBfdG87CiAgICAgICAgbV9vd25lckluZGV4W19mcm9tXSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W190b10gPSBvd25lckluZGV4OwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJDaGFuZ2VkKF9mcm9tLCBfdG8pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGFkZHMgYW4gb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgbmV3IG93bmVyCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIF9vd25lcikKICAgIGV4dGVybmFsCiAgICBvd25lckRvZXNOb3RFeGlzdChfb3duZXIpCiAgICB2YWxpZE51bU93bmVycyhtX251bU93bmVycyArIDEpCiAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIG1fbnVtT3duZXJzKys7CiAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gX293bmVyOwogICAgICAgIG1fb3duZXJJbmRleFtfb3duZXJdID0gY2hlY2tPd25lckluZGV4KG1fbnVtT3duZXJzKTsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZW1vdmVzIGFuIG93bmVyCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIG93bmVyIHRvIHJlbW92ZQogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICBleHRlcm5hbAogICAgb3duZXJFeGlzdHMoX293bmVyKQogICAgdmFsaWROdW1Pd25lcnMobV9udW1Pd25lcnMgLSAxKQogICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQobV9tdWx0aU93bmVkUmVxdWlyZWQsIG1fbnVtT3duZXJzIC0gMSkKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtfb3duZXJdKTsKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W19vd25lcl0gPSAwOwogICAgICAgIC8vbWFrZSBzdXJlIG1fbnVtT3duZXJzIGlzIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3duZXJzIGFuZCBhbHdheXMgcG9pbnRzIHRvIHRoZSBsYXN0IG93bmVyCiAgICAgICAgcmVvcmdhbml6ZU93bmVycygpOwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2hhbmdlcyB0aGUgcmVxdWlyZWQgbnVtYmVyIG9mIG93bmVyIHNpZ25hdHVyZXMKICAgIC8vLyBAcGFyYW0gX25ld1JlcXVpcmVkIG5ldyBudW1iZXIgb2Ygc2lnbmF0dXJlcyByZXF1aXJlZAogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpCiAgICBleHRlcm5hbAogICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQoX25ld1JlcXVpcmVkLCBtX251bU93bmVycykKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX25ld1JlcXVpcmVkOwogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlZChfbmV3UmVxdWlyZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldHMgYW4gb3duZXIgYnkgMC1pbmRleGVkIHBvc2l0aW9uCiAgICAvLy8gQHBhcmFtIG93bmVySW5kZXggMC1pbmRleGVkIG93bmVyIHBvc2l0aW9uCiAgICBmdW5jdGlvbiBnZXRPd25lcih1aW50IG93bmVySW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJzW293bmVySW5kZXggKyAxXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXRzIG93bmVycwogICAgLy8vIEByZXR1cm4gbWVtb3J5IGFycmF5IG9mIG93bmVycwogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3NbXSkgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IGFkZHJlc3NbXShtX251bU93bmVycyk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbV9udW1Pd25lcnM7IGkrKykKICAgICAgICByZXN1bHRbaV0gPSBnZXRPd25lcihpKTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjaGVja3MgaWYgcHJvdmlkZWQgYWRkcmVzcyBpcyBhbiBvd25lciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9hZGRyIGFkZHJlc3MgdG8gY2hlY2sKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtX293bmVySW5kZXhbX2FkZHJdID4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUZXN0cyBvd25lcnNoaXAgb2YgdGhlIGN1cnJlbnQgY2FsbGVyLgogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIGFuIG93bmVyCiAgICAvLyBJdCdzIGFkdmlzYWJsZSB0byBjYWxsIGl0IGJ5IG5ldyBvd25lciB0byBtYWtlIHN1cmUgdGhhdCB0aGUgc2FtZSBlcnJvbmVvdXMgYWRkcmVzcyBpcyBub3QgY29weS1wYXN0ZWQgdG8KICAgIC8vIGFkZE93bmVyL2NoYW5nZU93bmVyIGFuZCB0byBpc093bmVyLgogICAgZnVuY3Rpb24gYW1JT3duZXIoKSBleHRlcm5hbCBjb25zdGFudCBvbmx5b3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldm9rZXMgYSBwcmlvciBjb25maXJtYXRpb24gb2YgdGhlIGdpdmVuIG9wZXJhdGlvbgogICAgLy8vIEBwYXJhbSBfb3BlcmF0aW9uIG9wZXJhdGlvbiB2YWx1ZSwgdHlwaWNhbGx5IHNoYTMobXNnLmRhdGEpCiAgICBmdW5jdGlvbiByZXZva2UoYnl0ZXMzMiBfb3BlcmF0aW9uKQogICAgZXh0ZXJuYWwKICAgIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShfb3BlcmF0aW9uKQogICAgb25seW93bmVyCiAgICB7CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICByZXF1aXJlKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPiAwKTsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwoKICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCsrOwogICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSAtPSBvd25lckluZGV4Qml0OwoKICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiBvd25lciBjb25maXJtZWQgZ2l2ZW4gb3BlcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9vcGVyYXRpb24gb3BlcmF0aW9uIHZhbHVlLCB0eXBpY2FsbHkgc2hhMyhtc2cuZGF0YSkKICAgIC8vLyBAcGFyYW0gX293bmVyIGFuIG93bmVyIGFkZHJlc3MKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKQogICAgZXh0ZXJuYWwKICAgIGNvbnN0YW50CiAgICBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoX29wZXJhdGlvbikKICAgIG93bmVyRXhpc3RzKF9vd25lcikKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuICEobV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS5vd25lcnNEb25lICYgbWFrZU93bmVyQml0bWFwQml0KF9vd25lcikgPT0gMCk7CiAgICB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGNvbmZpcm1BbmRDaGVjayhieXRlczMyIF9vcGVyYXRpb24pCiAgICBwcml2YXRlCiAgICBvbmx5b3duZXIKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKDUxMiA9PSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoKQogICAgICAgIC8vIEluIGNhc2UgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4IGdyb3dzIHRvbyBtdWNoIHdlIGhhdmUgdG8gc2hyaW5rIGl0OiBvdGhlcndpc2UgYXQgc29tZSBwb2ludAogICAgICAgIC8vIHdlIHdvbid0IGJlIGFibGUgdG8gZG8gaXQgYmVjYXVzZSBvZiBibG9jayBnYXMgbGltaXQuCiAgICAgICAgLy8gWWVzLCBwZW5kaW5nIGNvbmZpcm1hdGlvbnMgd2lsbCBiZSBsb3N0LiBEb250IHNlZSBhbnkgc2VjdXJpdHkgb3Igc3RhYmlsaXR5IGltcGxpY2F0aW9ucy4KICAgICAgICAvLyBUT0RPIHVzZSBtb3JlIGdyYWNlZnVsIGFwcHJvYWNoIGxpa2UgY29tcGFjdCBvciByZW1vdmFsIG9mIGNsZWFyUGVuZGluZyBjb21wbGV0ZWx5CiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CgogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKCiAgICAgICAgLy8gaWYgd2UncmUgbm90IHlldCB3b3JraW5nIG9uIHRoaXMgb3BlcmF0aW9uLCBzd2l0Y2ggb3ZlciBhbmQgcmVzZXQgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICAgICAgaWYgKCEgaXNPcGVyYXRpb25BY3RpdmUoX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuCiAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkID0gbV9tdWx0aU93bmVkUmVxdWlyZWQ7CiAgICAgICAgICAgIC8vIHJlc2V0IHdoaWNoIG93bmVycyBoYXZlIGNvbmZpcm1lZCAobm9uZSkgLSBzZXQgb3VyIGJpdG1hcCB0byAwLgogICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgPSAwOwogICAgICAgICAgICBwZW5kaW5nLmluZGV4ID0gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Lmxlbmd0aCsrOwogICAgICAgICAgICBtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPSBfb3BlcmF0aW9uOwogICAgICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgfQoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSAodGhlIG1lc3NhZ2Ugc2VuZGVyKSBoYXZlbid0IGNvbmZpcm1lZCB0aGlzIG9wZXJhdGlvbiBwcmV2aW91c2x5LgogICAgICAgIGlmIChwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID09IDApIHsKICAgICAgICAgICAgLy8gb2sgLSBjaGVjayBpZiBjb3VudCBpcyBlbm91Z2ggdG8gZ28gYWhlYWQuCiAgICAgICAgICAgIGFzc2VydChwZW5kaW5nLnlldE5lZWRlZCA+IDApOwogICAgICAgICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gZW5vdWdoIGNvbmZpcm1hdGlvbnM6IHJlc2V0IGFuZCBydW4gaW50ZXJpb3IuCiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W21fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl0uaW5kZXhdOwogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgICAgICAgICBGaW5hbENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4KICAgICAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkLS07CiAgICAgICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgfD0gb3duZXJJbmRleEJpdDsKICAgICAgICAgICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKICAgICAgICAgICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBSZWNsYWltcyBmcmVlIHNsb3RzIGJldHdlZW4gdmFsaWQgb3duZXJzIGluIG1fb3duZXJzLgogICAgLy8gVE9ETyBnaXZlbiB0aGF0IGl0cyBjYWxsZWQgYWZ0ZXIgZWFjaCByZW1vdmFsLCBpdCBjb3VsZCBiZSBzaW1wbGlmaWVkLgogICAgZnVuY3Rpb24gcmVvcmdhbml6ZU93bmVycygpIHByaXZhdGUgewogICAgICAgIHVpbnQgZnJlZSA9IDE7CiAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycykKICAgICAgICB7CiAgICAgICAgICAgIC8vIGl0ZXJhdGluZyB0byB0aGUgZmlyc3QgZnJlZSBzbG90IGZyb20gdGhlIGJlZ2lubmluZwogICAgICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW2ZyZWVdICE9IDApIGZyZWUrKzsKCiAgICAgICAgICAgIC8vIGl0ZXJhdGluZyB0byB0aGUgZmlyc3Qgb2NjdXBpZWQgc2xvdCBmcm9tIHRoZSBlbmQKICAgICAgICAgICAgd2hpbGUgKG1fbnVtT3duZXJzID4gMSAmJiBtX293bmVyc1ttX251bU93bmVyc10gPT0gMCkgbV9udW1Pd25lcnMtLTsKCiAgICAgICAgICAgIC8vIHN3YXAsIGlmIHBvc3NpYmxlLCBzbyBmcmVlIHNsb3QgaXMgbG9jYXRlZCBhdCB0aGUgZW5kIGFmdGVyIHRoZSBzd2FwCiAgICAgICAgICAgIGlmIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdICE9IDAgJiYgbV9vd25lcnNbZnJlZV0gPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gb3duZXJzIGJldHdlZW4gc3dhcHBlZCBzbG90cyBzaG91bGQndCBiZSByZW51bWJlcmVkIC0gdGhhdCBzYXZlcyBhIGxvdCBvZiBnYXMKICAgICAgICAgICAgICAgIG1fb3duZXJzW2ZyZWVdID0gbV9vd25lcnNbbV9udW1Pd25lcnNdOwogICAgICAgICAgICAgICAgbV9vd25lckluZGV4W21fb3duZXJzW2ZyZWVdXSA9IGZyZWU7CiAgICAgICAgICAgICAgICBtX293bmVyc1ttX251bU93bmVyc10gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFyUGVuZGluZygpIHByaXZhdGUgb25seW93bmVyIHsKICAgICAgICB1aW50IGxlbmd0aCA9IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGg7CiAgICAgICAgLy8gVE9ETyBibG9jayBnYXMgbGltaXQKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAobV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W2ldICE9IDApCiAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW21fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtpXV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tPd25lckluZGV4KHVpbnQgb3duZXJJbmRleCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KDAgIT0gb3duZXJJbmRleCAmJiBvd25lckluZGV4IDw9IGNfbWF4T3duZXJzKTsKICAgICAgICByZXR1cm4gb3duZXJJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlT3duZXJCaXRtYXBCaXQoYWRkcmVzcyBvd25lcikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtvd25lcl0pOwogICAgICAgIHJldHVybiAyICoqIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPcGVyYXRpb25BY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gMCAhPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLnlldE5lZWRlZDsKICAgIH0KCgogICAgZnVuY3Rpb24gYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgIGFzc2VydChtX251bU93bmVycyA+IDApOwogICAgICAgIGFzc2VydChtX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgYXNzZXJ0KG1fb3duZXJzWzBdID09IDApOwogICAgICAgIGFzc2VydCgwICE9IG1fbXVsdGlPd25lZFJlcXVpcmVkICYmIG1fbXVsdGlPd25lZFJlcXVpcmVkIDw9IG1fbnVtT3duZXJzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgYXNzZXJ0KDAgIT0gcGVuZGluZy55ZXROZWVkZWQpOwogICAgICAgIGFzc2VydChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPT0gX29wZXJhdGlvbik7CiAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkIDw9IG1fbXVsdGlPd25lZFJlcXVpcmVkKTsKICAgIH0KCgogICAgLy8gRklFTERTCgogICAgdWludCBjb25zdGFudCBjX21heE93bmVycyA9IDI1MDsKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fbXVsdGlPd25lZFJlcXVpcmVkOwoKCiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMgKGFkZHJlc3NlcyksCiAgICAvLyBzbG90IDAgaXMgdW51c2VkIHNvIHRoZXJlIGFyZSBubyBvd25lciB3aGljaCBpbmRleCBpcyAwLgogICAgLy8gVE9ETyBjb3VsZCB3ZSBzYXZlIHNwYWNlIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5IGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgPDEwIG93bmVycz8gYW5kIHNob3VsZCB3ZT8KICAgIGFkZHJlc3NbMjU2XSBpbnRlcm5hbCBtX293bmVyczsKCiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXA6IG93bmVyIGFkZHJlc3MgPT4gaW5kZXggaW4gbV9vd25lcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBpbnRlcm5hbCBtX293bmVySW5kZXg7CgoKICAgIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gTXVsdGlPd25lZE9wZXJhdGlvblBlbmRpbmdTdGF0ZSkgaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZzsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7Cn0KCgovKioKICogQ29udHJhY3Qgd2hpY2ggaXMgb3duZWQgYnkgb3duZXJzIGFuZCBvcGVyYXRlZCBieSBjb250cm9sbGVyLgogKgogKiBQcm92aWRlcyBhIHdheSB0byBzZXQgdXAgYW4gZW50aXR5ICh0eXBpY2FsbHkgb3RoZXIgY29udHJhY3QpIGVudGl0bGVkIHRvIGNvbnRyb2wgYWN0aW9ucyBvZiB0aGlzIGNvbnRyYWN0LgogKiBDb250cm9sbGVyIGlzIHNldCB1cCBieSBvd25lcnMgb3IgZHVyaW5nIGNvbnN0cnVjdGlvbi4KICoKICovCmNvbnRyYWN0IE1ldHJvcG9sTXVsdGlvd25lZENvbnRyb2xsZWQgaXMgQ29udHJvbGxlZCwgbXVsdGlvd25lZCB7CgoKICAgIGZ1bmN0aW9uIE1ldHJvcG9sTXVsdGlvd25lZENvbnRyb2xsZWQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQyNTYgX3NpZ25hdHVyZXNSZXF1aXJlZCkKICAgIG11bHRpb3duZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCkKICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIG5vdGhpbmcgaGVyZQogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB0aGUgY29udHJvbGxlcgogICAgICovCiAgICBmdW5jdGlvbiBzZXRDb250cm9sbGVyKGFkZHJlc3MgX2NvbnRyb2xsZXIpIGV4dGVybmFsIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSB7CiAgICAgICAgc3VwZXIuc2V0Q29udHJvbGxlckludGVybmFsKF9jb250cm9sbGVyKTsKICAgIH0KCn0KCgoKLy8vIEB0aXRsZSBTdGFuZGFyZFRva2VuIHdoaWNoIGNpcmN1bGF0aW9uIGNhbiBiZSBkZWxheWVkIGFuZCBzdGFydGVkIGJ5IGFub3RoZXIgY29udHJhY3QuCi8vLyBAZGV2IFRvIGJlIHVzZWQgYXMgYSBtaXhpbiBjb250cmFjdC4KLy8vIFRoZSBjb250cmFjdCBpcyBjcmVhdGVkIGluIGRpc2FibGVkIHN0YXRlOiBjaXJjdWxhdGlvbiBpcyBkaXNhYmxlZC4KY29udHJhY3QgQ2lyY3VsYXRpbmdUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICBldmVudCBDaXJjdWxhdGlvbkVuYWJsZWQoKTsKCiAgICBtb2RpZmllciByZXF1aXJlc0NpcmN1bGF0aW9uIHsKICAgICAgICByZXF1aXJlKG1faXNDaXJjdWxhdGluZyk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLy8gUFVCTElDIGludGVyZmFjZQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmVxdWlyZXNDaXJjdWxhdGlvbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXF1aXJlc0NpcmN1bGF0aW9uIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmVxdWlyZXNDaXJjdWxhdGlvbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CgoKICAgIC8vIElOVEVSTkFMIGZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIGVuYWJsZUNpcmN1bGF0aW9uKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChtX2lzQ2lyY3VsYXRpbmcpCiAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBtX2lzQ2lyY3VsYXRpbmcgPSB0cnVlOwogICAgICAgIENpcmN1bGF0aW9uRW5hYmxlZCgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBGSUVMRFMKCiAgICAvLy8gQG5vdGljZSBhcmUgdGhlIGNpcmN1bGF0aW9uIHN0YXJ0ZWQ/CiAgICBib29sIHB1YmxpYyBtX2lzQ2lyY3VsYXRpbmc7Cn0KCgoKCi8qKgogKiBDaXJjdWxhdGluZ0NvbnRyb2xsZWRUb2tlbgogKi8KY29udHJhY3QgQ2lyY3VsYXRpbmdDb250cm9sbGVkVG9rZW4gaXMgQ2lyY3VsYXRpbmdUb2tlbiwgQ29udHJvbGxlZCB7CgogICAgLyoqCiAgICAgKiBBbGxvd3MgdG9rZW4gdHJhbnNmZXJzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0Q2lyY3VsYXRpb24oKSBleHRlcm5hbCBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgYXNzZXJ0KGVuYWJsZUNpcmN1bGF0aW9uKCkpOyAgICAvLyBtdXN0IGJlIGNhbGxlZCBvbmNlCiAgICB9Cn0KCgovKioKICogTWV0cm9wb2xUb2tlbgogKi8KY29udHJhY3QgTWV0cm9wb2xUb2tlbiBpcwogICAgU3RhbmRhcmRUb2tlbiwKICAgIENvbnRyb2xsZWQsCiAgICBNaW50YWJsZUNvbnRyb2xsZWRUb2tlbiwKICAgIEJ1cm5hYmxlQ29udHJvbGxlZFRva2VuLAogICAgQ2lyY3VsYXRpbmdDb250cm9sbGVkVG9rZW4sCiAgICBNZXRyb3BvbE11bHRpb3duZWRDb250cm9sbGVkCnsKICAgIHN0cmluZyBpbnRlcm5hbCBtX25hbWUgPSAnJzsKICAgIHN0cmluZyBpbnRlcm5hbCBtX3N5bWJvbCA9ICcnOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLyoqCiAgICAgKiBNZXRyb3BvbFRva2VuIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGZ1bmN0aW9uIE1ldHJvcG9sVG9rZW4oYWRkcmVzc1tdIF9vd25lcnMpCiAgICAgICAgTWV0cm9wb2xNdWx0aW93bmVkQ29udHJvbGxlZChfb3duZXJzLCAyKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoMyA9PSBfb3duZXJzLmxlbmd0aCk7CiAgICB9CgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gbV9uYW1lOwogICAgfQogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBtX3N5bWJvbDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXROYW1lU3ltYm9sKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIGV4dGVybmFsIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSB7CiAgICAgICAgcmVxdWlyZShieXRlcyhtX25hbWUpLmxlbmd0aD09MCk7CiAgICAgICAgcmVxdWlyZShieXRlcyhfbmFtZSkubGVuZ3RoIT0wICYmIGJ5dGVzKF9zeW1ib2wpLmxlbmd0aCE9MCk7CgogICAgICAgIG1fbmFtZSA9IF9uYW1lOwogICAgICAgIG1fc3ltYm9sID0gX3N5bWJvbDsKICAgIH0KCn0='.
	

]
