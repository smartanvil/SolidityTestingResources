Class {
	#name : #SRT7da90089a73edd14c75b0c827cb54f4248d47ecc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7da90089a73edd14c75b0c827cb54f4248d47ecc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8vIDxPUkFDTElaRV9BUEk+Ci8qCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTApDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFRECgoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKCgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7Ly9wbGVhc2UgaW1wb3J0IG9yYWNsaXplQVBJX3ByZTAuNC5zb2wgd2hlbiBzb2xpZGl0eSA8IDAuNC4wCgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gdXNlQ291cG9uKHN0cmluZyBfY291cG9uKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOwogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7CiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSk7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKICAgIAogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKGFkZHJlc3MoT0FSKT09MCkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzYjI2MzhhN2NjOWYyY2IzZDI5OGEzZGE3YTkwYjY3ZTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM2EyNjE1ZDVlZmFmNWY0OWY2MGI3YmI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNhMjYxNWQ1ZWZhZjVmNDlmNjBiN2JiNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0gICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7CiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDA7CiAgIH0gCgogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKSAKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaC5sZW5ndGg7IGkgKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOwogICAgICAgICAgICAgICAgICAgIH0gICAKICAgICAgICAgICAgICAgICAgICBpZihzdWJpbmRleCA9PSBuLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfSAgIAogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsICIiLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmICgoYnJlc3VsdFtpXSA+PSA0OCkmJihicmVzdWx0W2ldIDw9IDU3KSl7CiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpewogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAqKl9iOwogICAgICAgIHJldHVybiBtaW50OwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KICAgIAogICAgCgp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKY29udHJhY3QgRGljZSBpcyB1c2luZ09yYWNsaXplIHsKCiAgICB1aW50IGNvbnN0YW50IHB3aW4gPSA5MDAwOyAvL3Byb2JhYmlsaXR5IG9mIHdpbm5pbmcgKDEwMDAwID0gMTAwJSkKICAgIHVpbnQgY29uc3RhbnQgZWRnZSA9IDE5MDsgLy9lZGdlIHBlcmNlbnRhZ2UgKDEwMDAwID0gMTAwJSkKICAgIHVpbnQgY29uc3RhbnQgbWF4V2luID0gMTAwOyAvL21heCB3aW4gKGJlZm9yZSBlZGdlIGlzIHRha2VuKSBhcyBwZXJjZW50YWdlIG9mIGJhbmtyb2xsICgxMDAwMCA9IDEwMCUpCiAgICB1aW50IGNvbnN0YW50IG1pbkJldCA9IDIwMCBmaW5uZXk7CiAgICB1aW50IGNvbnN0YW50IG1heEludmVzdG9ycyA9IDEwOyAvL21heGltdW0gbnVtYmVyIG9mIGludmVzdG9ycwogICAgdWludCBjb25zdGFudCBob3VzZUVkZ2UgPSA5MDsgLy9lZGdlIHBlcmNlbnRhZ2UgKDEwMDAwID0gMTAwJSkKICAgIHVpbnQgY29uc3RhbnQgZGl2ZXN0RmVlID0gNTA7IC8vZGl2ZXN0IGZlZSBwZXJjZW50YWdlICgxMDAwMCA9IDEwMCUpCiAgICB1aW50IGNvbnN0YW50IGVtZXJnZW5jeVdpdGhkcmF3YWxSYXRpbyA9IDEwOyAvL3JhdGlvIHBlcmNlbnRhZ2UgKDEwMCA9IDEwMCUpCgogICAgdWludCBzYWZlR2FzID0gMjMwMDsKICAgIHVpbnQgY29uc3RhbnQgT1JBQ0xJWkVfR0FTX0xJTUlUID0gMTc1MDAwOwogICAgdWludCBjb25zdGFudCBJTlZBTElEX0JFVF9NQVJLRVIgPSA5OTk5OTsKICAgIHVpbnQgY29uc3RhbnQgRU1FUkdFTkNZX1RJTUVPVVQgPSAzIGRheXM7CgogICAgc3RydWN0IEludmVzdG9yIHsKICAgICAgICBhZGRyZXNzIGludmVzdG9yQWRkcmVzczsKICAgICAgICB1aW50IGFtb3VudEludmVzdGVkOwogICAgICAgIGJvb2wgdm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsOwogICAgfQoKICAgIHN0cnVjdCBCZXQgewogICAgICAgIGFkZHJlc3MgcGxheWVyQWRkcmVzczsKICAgICAgICB1aW50IGFtb3VudEJldDsKICAgICAgICB1aW50IG51bWJlclJvbGxlZDsKICAgIH0KCiAgICBzdHJ1Y3QgV2l0aGRyYXdhbFByb3Bvc2FsIHsKICAgICAgICBhZGRyZXNzIHRvQWRkcmVzczsKICAgICAgICB1aW50IGF0VGltZTsKICAgIH0KCiAgICAvL1N0YXJ0aW5nIGF0IDEKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgaW52ZXN0b3JJRHM7CiAgICBtYXBwaW5nKHVpbnQgPT4gSW52ZXN0b3IpIHB1YmxpYyBpbnZlc3RvcnM7CiAgICB1aW50IHB1YmxpYyBudW1JbnZlc3RvcnMgPSAwOwoKICAgIHVpbnQgcHVibGljIGludmVzdGVkID0gMDsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIGhvdXNlQWRkcmVzczsKICAgIGJvb2wgcHVibGljIGlzU3RvcHBlZDsKCiAgICBXaXRoZHJhd2FsUHJvcG9zYWwgcHVibGljIHByb3Bvc2VkV2l0aGRyYXdhbDsKCiAgICBtYXBwaW5nIChieXRlczMyID0+IEJldCkgcHVibGljIGJldHM7CiAgICBieXRlczMyW10gcHVibGljIGJldHNLZXlzOwoKICAgIHVpbnQgcHVibGljIGludmVzdG9yc1Byb2ZpdCA9IDA7CiAgICB1aW50IHB1YmxpYyBpbnZlc3RvcnNMb3NzZXMgPSAwOwogICAgYm9vbCBwcm9maXREaXN0cmlidXRlZDsKCiAgICBldmVudCBMT0dfTmV3QmV0KGFkZHJlc3MgcGxheWVyQWRkcmVzcywgdWludCBhbW91bnQpOwogICAgZXZlbnQgTE9HX0JldFdvbihhZGRyZXNzIHBsYXllckFkZHJlc3MsIHVpbnQgbnVtYmVyUm9sbGVkLCB1aW50IGFtb3VudFdvbik7CiAgICBldmVudCBMT0dfQmV0TG9zdChhZGRyZXNzIHBsYXllckFkZHJlc3MsIHVpbnQgbnVtYmVyUm9sbGVkKTsKICAgIGV2ZW50IExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsUHJvcG9zZWQoKTsKICAgIGV2ZW50IExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsRmFpbGVkKGFkZHJlc3Mgd2l0aGRyYXdhbEFkZHJlc3MpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxTdWNjZWVkZWQoYWRkcmVzcyB3aXRoZHJhd2FsQWRkcmVzcywgdWludCBhbW91bnRXaXRoZHJhd24pOwogICAgZXZlbnQgTE9HX0ZhaWxlZFNlbmQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTE9HX1plcm9TZW5kKCk7CiAgICBldmVudCBMT0dfSW52ZXN0b3JFbnRyYW5jZShhZGRyZXNzIGludmVzdG9yLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfSW52ZXN0b3JDYXBpdGFsVXBkYXRlKGFkZHJlc3MgaW52ZXN0b3IsIGludCBhbW91bnQpOwogICAgZXZlbnQgTE9HX0ludmVzdG9yRXhpdChhZGRyZXNzIGludmVzdG9yLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfQ29udHJhY3RTdG9wcGVkKCk7CiAgICBldmVudCBMT0dfQ29udHJhY3RSZXN1bWVkKCk7CiAgICBldmVudCBMT0dfT3duZXJBZGRyZXNzQ2hhbmdlZChhZGRyZXNzIG9sZEFkZHIsIGFkZHJlc3MgbmV3T3duZXJBZGRyZXNzKTsKICAgIGV2ZW50IExPR19Ib3VzZUFkZHJlc3NDaGFuZ2VkKGFkZHJlc3Mgb2xkQWRkciwgYWRkcmVzcyBuZXdIb3VzZUFkZHJlc3MpOwogICAgZXZlbnQgTE9HX0dhc0xpbWl0Q2hhbmdlZCh1aW50IG9sZEdhc0xpbWl0LCB1aW50IG5ld0dhc0xpbWl0KTsKICAgIGV2ZW50IExPR19FbWVyZ2VuY3lBdXRvU3RvcCgpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxWb3RlKGFkZHJlc3MgaW52ZXN0b3IsIGJvb2wgdm90ZSk7CiAgICBldmVudCBMT0dfVmFsdWVJc1Rvb0JpZygpOwogICAgZXZlbnQgTE9HX1N1Y2Nlc3NmdWxTZW5kKGFkZHJlc3MgYWRkciwgdWludCBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIERpY2UoKSB7CiAgICAgICAgb3JhY2xpemVfc2V0UHJvb2YocHJvb2ZUeXBlX1RMU05vdGFyeSB8IHByb29mU3RvcmFnZV9JUEZTKTsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgaG91c2VBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvL1NFQ1RJT04gSTogTU9ESUZJRVJTIEFORCBIRUxQRVIgRlVOQ1RJT05TCgogICAgLy9NT0RJRklFUlMKCiAgICBtb2RpZmllciBvbmx5SWZOb3RTdG9wcGVkIHsKICAgICAgICBpZiAoaXNTdG9wcGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZlN0b3BwZWQgewogICAgICAgIGlmICghaXNTdG9wcGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJbnZlc3RvcnMgewogICAgICAgIGlmIChpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlOb3RJbnZlc3RvcnMgewogICAgICAgIGlmIChpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSAhPSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgaWYgKG93bmVyICE9IG1zZy5zZW5kZXIpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU9yYWNsaXplIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5TW9yZVRoYW5NaW5JbnZlc3RtZW50IHsKICAgICAgICBpZiAobXNnLnZhbHVlIDw9IGdldE1pbkludmVzdG1lbnQoKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5TW9yZVRoYW5aZXJvIHsKICAgICAgICBpZiAobXNnLnZhbHVlID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmQmV0RXhpc3QoYnl0ZXMzMiBteWlkKSB7CiAgICAgICAgaWYoYmV0c1tteWlkXS5wbGF5ZXJBZGRyZXNzID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZCZXRTaXplSXNTdGlsbENvcnJlY3QoYnl0ZXMzMiBteWlkKSB7CiAgICAgICAgaWYgKCgoKGJldHNbbXlpZF0uYW1vdW50QmV0ICogKCgxMDAwMCAtIGVkZ2UpIC0gcHdpbikpIC8gcHdpbiApIDw9IChtYXhXaW4gKiBnZXRCYW5rcm9sbCgpKSAvIDEwMDAwKSAgJiYgKGJldHNbbXlpZF0uYW1vdW50QmV0ID49IG1pbkJldCkpIHsKICAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBiZXRzW215aWRdLm51bWJlclJvbGxlZCA9IElOVkFMSURfQkVUX01BUktFUjsKICAgICAgICAgICAgc2FmZVNlbmQoYmV0c1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBiZXRzW215aWRdLmFtb3VudEJldCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmVmFsaWRSb2xsKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIHVpbnQgbnVtYmVyUm9sbGVkID0gcGFyc2VJbnQocmVzdWx0KTsKICAgICAgICBpZiAoKG51bWJlclJvbGxlZCA8IDEgfHwgbnVtYmVyUm9sbGVkID4gMTAwMDApICYmIGJldHNbbXlpZF0ubnVtYmVyUm9sbGVkID09IDApIHsKICAgICAgICAgICAgYmV0c1tteWlkXS5udW1iZXJSb2xsZWQgPSBJTlZBTElEX0JFVF9NQVJLRVI7CiAgICAgICAgICAgIHNhZmVTZW5kKGJldHNbbXlpZF0ucGxheWVyQWRkcmVzcywgYmV0c1tteWlkXS5hbW91bnRCZXQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVdpbm5pbmdCZXRzKHVpbnQgbnVtYmVyUm9sbGVkKSB7CiAgICAgICAgaWYgKG51bWJlclJvbGxlZCAtIDEgPCBwd2luKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlMb3NpbmdCZXRzKHVpbnQgbnVtYmVyUm9sbGVkKSB7CiAgICAgICAgaWYgKG51bWJlclJvbGxlZCAtIDEgPj0gcHdpbikgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJQcm9wb3NlZCB7CiAgICAgICAgaWYgKHByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3MgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZQcm9maXROb3REaXN0cmlidXRlZCB7CiAgICAgICAgaWYgKCFwcm9maXREaXN0cmlidXRlZCkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZWYWxpZEdhcyh1aW50IG5ld0dhc0xpbWl0KSB7CiAgICAgICAgaWYgKE9SQUNMSVpFX0dBU19MSU1JVCArIG5ld0dhc0xpbWl0IDwgT1JBQ0xJWkVfR0FTX0xJTUlUKSB0aHJvdzsKICAgICAgICBpZiAobmV3R2FzTGltaXQgPCAyNTAwMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZOb3RQcm9jZXNzZWQoYnl0ZXMzMiBteWlkKSB7CiAgICAgICAgaWYgKGJldHNbbXlpZF0ubnVtYmVyUm9sbGVkID4gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZFbWVyZ2VuY3lUaW1lT3V0SGFzUGFzc2VkIHsKICAgICAgICBpZiAocHJvcG9zZWRXaXRoZHJhd2FsLmF0VGltZSArIEVNRVJHRU5DWV9USU1FT1VUID4gbm93KSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGludmVzdG9yc0ludmFyaWFudCB7CiAgICAgICAgXzsKICAgICAgICBpZiAobnVtSW52ZXN0b3JzID4gbWF4SW52ZXN0b3JzKSB0aHJvdzsKICAgIH0KCiAgICAvL0NPTlNUQU5UIEhFTFBFUiBGVU5DVElPTlMKCiAgICBmdW5jdGlvbiBnZXRCYW5rcm9sbCgpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgaWYgKChpbnZlc3RlZCA8IGludmVzdG9yc1Byb2ZpdCkgfHwKICAgICAgICAgICAgKGludmVzdGVkICsgaW52ZXN0b3JzUHJvZml0IDwgaW52ZXN0ZWQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIGludmVzdG9yc1Byb2ZpdCA8IGludmVzdG9yc0xvc3NlcykpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gaW52ZXN0ZWQgKyBpbnZlc3RvcnNQcm9maXQgLSBpbnZlc3RvcnNMb3NzZXM7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1pbkludmVzdG1lbnQoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIGlmIChudW1JbnZlc3RvcnMgPT0gbWF4SW52ZXN0b3JzKSB7CiAgICAgICAgICAgIHVpbnQgaW52ZXN0b3JJRCA9IHNlYXJjaFNtYWxsZXN0SW52ZXN0b3IoKTsKICAgICAgICAgICAgcmV0dXJuIGdldEJhbGFuY2UoaW52ZXN0b3JzW2ludmVzdG9ySURdLmludmVzdG9yQWRkcmVzcyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0U3RhdHVzKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCkgewoKICAgICAgICB1aW50IGJhbmtyb2xsID0gZ2V0QmFua3JvbGwoKTsKICAgICAgICB1aW50IG1pbkludmVzdG1lbnQgPSBnZXRNaW5JbnZlc3RtZW50KCk7CiAgICAgICAgcmV0dXJuIChiYW5rcm9sbCwgcHdpbiwgZWRnZSwgbWF4V2luLCBtaW5CZXQsIChpbnZlc3RvcnNQcm9maXQgLSBpbnZlc3RvcnNMb3NzZXMpLCBtaW5JbnZlc3RtZW50LCBiZXRzS2V5cy5sZW5ndGgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJldCh1aW50IGlkKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyhhZGRyZXNzLCB1aW50LCB1aW50KSB7CgogICAgICAgIGlmIChpZCA8IGJldHNLZXlzLmxlbmd0aCkgewogICAgICAgICAgICBieXRlczMyIGJldEtleSA9IGJldHNLZXlzW2lkXTsKICAgICAgICAgICAgcmV0dXJuIChiZXRzW2JldEtleV0ucGxheWVyQWRkcmVzcywgYmV0c1tiZXRLZXldLmFtb3VudEJldCwgYmV0c1tiZXRLZXldLm51bWJlclJvbGxlZCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG51bUJldHMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIHJldHVybiBiZXRzS2V5cy5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWluQmV0QW1vdW50KCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICB1aW50IG9yYWNsaXplRmVlID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpLmdldFByaWNlKCJVUkwiLCBPUkFDTElaRV9HQVNfTElNSVQgKyBzYWZlR2FzKTsKICAgICAgICByZXR1cm4gb3JhY2xpemVGZWUgKyBtaW5CZXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWF4QmV0QW1vdW50KCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICB1aW50IG9yYWNsaXplRmVlID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpLmdldFByaWNlKCJVUkwiLCBPUkFDTElaRV9HQVNfTElNSVQgKyBzYWZlR2FzKTsKICAgICAgICB1aW50IGJldFZhbHVlID0gIChtYXhXaW4gKiBnZXRCYW5rcm9sbCgpKSAqIHB3aW4gLyAoMTAwMDAgKiAoMTAwMDAgLSBlZGdlIC0gcHdpbikpOwogICAgICAgIHJldHVybiBiZXRWYWx1ZSArIG9yYWNsaXplRmVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExvc3Nlc1NoYXJlKGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICByZXR1cm4gaW52ZXN0b3JzW2ludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl1dLmFtb3VudEludmVzdGVkICogKGludmVzdG9yc0xvc3NlcykgLyBpbnZlc3RlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcm9maXRTaGFyZShhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIGludmVzdG9yc1tpbnZlc3RvcklEc1tjdXJyZW50SW52ZXN0b3JdXS5hbW91bnRJbnZlc3RlZCAqIChpbnZlc3RvcnNQcm9maXQpIC8gaW52ZXN0ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZShhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgdWludCBpbnZlc3RlZCA9IGludmVzdG9yc1tpbnZlc3RvcklEc1tjdXJyZW50SW52ZXN0b3JdXS5hbW91bnRJbnZlc3RlZDsKICAgICAgICB1aW50IHByb2ZpdCA9IGdldFByb2ZpdFNoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgdWludCBsb3NzZXMgPSBnZXRMb3NzZXNTaGFyZShjdXJyZW50SW52ZXN0b3IpOwoKICAgICAgICBpZiAoKGludmVzdGVkICsgcHJvZml0IDwgcHJvZml0KSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBwcm9maXQgPCBpbnZlc3RlZCkgfHwKICAgICAgICAgICAgKGludmVzdGVkICsgcHJvZml0IDwgbG9zc2VzKSkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gaW52ZXN0ZWQgKyBwcm9maXQgLSBsb3NzZXM7CiAgICB9CgogICAgZnVuY3Rpb24gc2VhcmNoU21hbGxlc3RJbnZlc3RvcigpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgdWludCBpbnZlc3RvcklEID0gMTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gbnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGdldEJhbGFuY2UoaW52ZXN0b3JzW2ldLmludmVzdG9yQWRkcmVzcykgPCBnZXRCYWxhbmNlKGludmVzdG9yc1tpbnZlc3RvcklEXS5pbnZlc3RvckFkZHJlc3MpKSB7CiAgICAgICAgICAgICAgICBpbnZlc3RvcklEID0gaTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGludmVzdG9ySUQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlT3JhY2xpemVQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIGlmIChfcHJvb2ZUeXBlID09IDB4MDApIHRocm93OwogICAgICAgIG9yYWNsaXplX3NldFByb29mKCBfcHJvb2ZUeXBlIHwgIHByb29mU3RvcmFnZV9JUEZTICk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlT3JhY2xpemVDb25maWcoYnl0ZXMzMiBfY29uZmlnKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIG9yYWNsaXplX3NldENvbmZpZyhfY29uZmlnKTsKICAgIH0KCiAgICAvLyBQUklWQVRFIEhFTFBFUlMgRlVOQ1RJT04KCiAgICBmdW5jdGlvbiBzYWZlU2VuZChhZGRyZXNzIGFkZHIsIHVpbnQgdmFsdWUpCiAgICAgICAgcHJpdmF0ZSB7CgogICAgICAgIGlmICh2YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIExPR19aZXJvU2VuZCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5iYWxhbmNlIDwgdmFsdWUpIHsKICAgICAgICAgICAgTE9HX1ZhbHVlSXNUb29CaWcoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCEoYWRkci5jYWxsLmdhcyhzYWZlR2FzKS52YWx1ZSh2YWx1ZSkoKSkpIHsKICAgICAgICAgICAgTE9HX0ZhaWxlZFNlbmQoYWRkciwgdmFsdWUpOwogICAgICAgICAgICBpZiAoYWRkciAhPSBob3VzZUFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIC8vRm9yd2FyZCB0byBob3VzZSBhZGRyZXNzIGFsbCBjaGFuZ2UKICAgICAgICAgICAgICAgIGlmICghKGhvdXNlQWRkcmVzcy5jYWxsLmdhcyhzYWZlR2FzKS52YWx1ZSh2YWx1ZSkoKSkpIExPR19GYWlsZWRTZW5kKGhvdXNlQWRkcmVzcywgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMT0dfU3VjY2Vzc2Z1bFNlbmQoYWRkcix2YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkSW52ZXN0b3JBdElEKHVpbnQgaWQpCiAgICAgICAgcHJpdmF0ZSB7CgogICAgICAgIGludmVzdG9ySURzW21zZy5zZW5kZXJdID0gaWQ7CiAgICAgICAgaW52ZXN0b3JzW2lkXS5pbnZlc3RvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGludmVzdG9yc1tpZF0uYW1vdW50SW52ZXN0ZWQgPSBtc2cudmFsdWU7CiAgICAgICAgaW52ZXN0ZWQgKz0gbXNnLnZhbHVlOwoKICAgICAgICBMT0dfSW52ZXN0b3JFbnRyYW5jZShtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2ZpdERpc3RyaWJ1dGlvbigpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG9ubHlJZlByb2ZpdE5vdERpc3RyaWJ1dGVkIHsKCiAgICAgICAgdWludCBjb3B5SW52ZXN0ZWQ7CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGN1cnJlbnRJbnZlc3RvciA9IGludmVzdG9yc1tpXS5pbnZlc3RvckFkZHJlc3M7CiAgICAgICAgICAgIHVpbnQgcHJvZml0T2ZJbnZlc3RvciA9IGdldFByb2ZpdFNoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgICAgIHVpbnQgbG9zc2VzT2ZJbnZlc3RvciA9IGdldExvc3Nlc1NoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgICAgIC8vQ2hlY2sgZm9yIG92ZXJmbG93IGFuZCB1bmRlcmZsb3cKICAgICAgICAgICAgaWYgKChpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQgKyBwcm9maXRPZkludmVzdG9yID49IGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCkgJiYKICAgICAgICAgICAgICAgIChpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQgKyBwcm9maXRPZkludmVzdG9yID49IGxvc3Nlc09mSW52ZXN0b3IpKSAgewogICAgICAgICAgICAgICAgaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkICs9IHByb2ZpdE9mSW52ZXN0b3IgLSBsb3NzZXNPZkludmVzdG9yOwogICAgICAgICAgICAgICAgTE9HX0ludmVzdG9yQ2FwaXRhbFVwZGF0ZShjdXJyZW50SW52ZXN0b3IsIChpbnQpIChwcm9maXRPZkludmVzdG9yIC0gbG9zc2VzT2ZJbnZlc3RvcikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaXNTdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIExPR19FbWVyZ2VuY3lBdXRvU3RvcCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29weUludmVzdGVkICsgaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkID49IGNvcHlJbnZlc3RlZCkKICAgICAgICAgICAgICAgIGNvcHlJbnZlc3RlZCArPSBpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgfQoKICAgICAgICBkZWxldGUgaW52ZXN0b3JzUHJvZml0OwogICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNMb3NzZXM7CiAgICAgICAgaW52ZXN0ZWQgPSBjb3B5SW52ZXN0ZWQ7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBTRUNUSU9OIElJOiBCRVQgJiBCRVQgUFJPQ0VTU0lORwoKICAgIGZ1bmN0aW9uKCkKICAgICAgICBwYXlhYmxlIHsKCiAgICAgICAgYmV0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gYmV0KCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgb25seUlmTm90U3RvcHBlZCB7CgogICAgICAgIHVpbnQgb3JhY2xpemVGZWUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSkuZ2V0UHJpY2UoIlVSTCIsIE9SQUNMSVpFX0dBU19MSU1JVCArIHNhZmVHYXMpOwogICAgICAgIGlmIChvcmFjbGl6ZUZlZSA+PSBtc2cudmFsdWUpIHRocm93OwogICAgICAgIHVpbnQgYmV0VmFsdWUgPSBtc2cudmFsdWUgLSBvcmFjbGl6ZUZlZTsKICAgICAgICBpZiAoKCgoYmV0VmFsdWUgKiAoKDEwMDAwIC0gZWRnZSkgLSBwd2luKSkgLyBwd2luICkgPD0gKG1heFdpbiAqIGdldEJhbmtyb2xsKCkpIC8gMTAwMDApICYmIChiZXRWYWx1ZSA+PSBtaW5CZXQpKSB7CiAgICAgICAgICAgIExPR19OZXdCZXQobXNnLnNlbmRlciwgYmV0VmFsdWUpOwogICAgICAgICAgICBieXRlczMyIG15aWQgPQogICAgICAgICAgICAgICAgb3JhY2xpemVfcXVlcnkoCiAgICAgICAgICAgICAgICAgICAgIm5lc3RlZCIsCiAgICAgICAgICAgICAgICAgICAgIltVUkxdIFsnanNvbihodHRwczovL2FwaS5yYW5kb20ub3JnL2pzb24tcnBjLzEvaW52b2tlKS5yZXN1bHQucmFuZG9tLmRhdGEuMCcsICdcXG57XCJqc29ucnBjXCI6XCIyLjBcIixcIm1ldGhvZFwiOlwiZ2VuZXJhdGVTaWduZWRJbnRlZ2Vyc1wiLFwicGFyYW1zXCI6e1wiYXBpS2V5XCI6JHtbZGVjcnlwdF0gQklZa3piMUdRelJaRk5zVHpGN2ZoK244Vm1UOEdFeVczbUhZbHJVOEl0NU82L2JhbTYvTFZWeHFrdXJ5OFlaREpQam0wbVdRZXFRR2ViR0FWU0ZyRncxNi9WSEo2NVFNRkJmSUhOMmZyaGF2L2QxMEFScUVDam9PdnNlNXY0L0RJVDNMUVVIUEV4MFovNVVkdHFZVFF5ZFcvcGJDNUJNPX0sXCJuXCI6MSxcIm1pblwiOjEsXCJtYXhcIjoxMDAwMCR7W2lkZW50aXR5XSBcIn1cIn0sXCJpZFwiOjEke1tpZGVudGl0eV0gXCJ9XCJ9J10iLAogICAgICAgICAgICAgICAgICAgIE9SQUNMSVpFX0dBU19MSU1JVCArIHNhZmVHYXMKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJldHNbbXlpZF0gPSBCZXQobXNnLnNlbmRlciwgYmV0VmFsdWUsIDApOwogICAgICAgICAgICBiZXRzS2V5cy5wdXNoKG15aWQpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikKICAgICAgICBvbmx5T3JhY2xpemUKICAgICAgICBvbmx5SWZCZXRFeGlzdChteWlkKQogICAgICAgIG9ubHlJZk5vdFByb2Nlc3NlZChteWlkKQogICAgICAgIG9ubHlJZlZhbGlkUm9sbChteWlkLCByZXN1bHQpCiAgICAgICAgb25seUlmQmV0U2l6ZUlzU3RpbGxDb3JyZWN0KG15aWQpICB7CgogICAgICAgIHVpbnQgbnVtYmVyUm9sbGVkID0gcGFyc2VJbnQocmVzdWx0KTsKICAgICAgICBiZXRzW215aWRdLm51bWJlclJvbGxlZCA9IG51bWJlclJvbGxlZDsKICAgICAgICBpc1dpbm5pbmdCZXQoYmV0c1tteWlkXSwgbnVtYmVyUm9sbGVkKTsKICAgICAgICBpc0xvc2luZ0JldChiZXRzW215aWRdLCBudW1iZXJSb2xsZWQpOwogICAgICAgIGRlbGV0ZSBwcm9maXREaXN0cmlidXRlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1dpbm5pbmdCZXQoQmV0IHRoaXNCZXQsIHVpbnQgbnVtYmVyUm9sbGVkKQogICAgICAgIHByaXZhdGUKICAgICAgICBvbmx5V2lubmluZ0JldHMobnVtYmVyUm9sbGVkKSB7CgogICAgICAgIHVpbnQgd2luQW1vdW50ID0gKHRoaXNCZXQuYW1vdW50QmV0ICogKDEwMDAwIC0gZWRnZSkpIC8gcHdpbjsKICAgICAgICBMT0dfQmV0V29uKHRoaXNCZXQucGxheWVyQWRkcmVzcywgbnVtYmVyUm9sbGVkLCB3aW5BbW91bnQpOwogICAgICAgIHNhZmVTZW5kKHRoaXNCZXQucGxheWVyQWRkcmVzcywgd2luQW1vdW50KTsKCiAgICAgICAgLy9DaGVjayBmb3Igb3ZlcmZsb3cgYW5kIHVuZGVyZmxvdwogICAgICAgIGlmICgoaW52ZXN0b3JzTG9zc2VzICsgd2luQW1vdW50IDwgaW52ZXN0b3JzTG9zc2VzKSB8fAogICAgICAgICAgICAoaW52ZXN0b3JzTG9zc2VzICsgd2luQW1vdW50IDwgdGhpc0JldC5hbW91bnRCZXQpKSB7CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfQoKICAgICAgICBpbnZlc3RvcnNMb3NzZXMgKz0gd2luQW1vdW50IC0gdGhpc0JldC5hbW91bnRCZXQ7CiAgICB9CgogICAgZnVuY3Rpb24gaXNMb3NpbmdCZXQoQmV0IHRoaXNCZXQsIHVpbnQgbnVtYmVyUm9sbGVkKQogICAgICAgIHByaXZhdGUKICAgICAgICBvbmx5TG9zaW5nQmV0cyhudW1iZXJSb2xsZWQpIHsKCiAgICAgICAgTE9HX0JldExvc3QodGhpc0JldC5wbGF5ZXJBZGRyZXNzLCBudW1iZXJSb2xsZWQpOwogICAgICAgIHNhZmVTZW5kKHRoaXNCZXQucGxheWVyQWRkcmVzcywgMSk7CgogICAgICAgIC8vQ2hlY2sgZm9yIG92ZXJmbG93IGFuZCB1bmRlcmZsb3cKICAgICAgICBpZiAoKGludmVzdG9yc1Byb2ZpdCArIHRoaXNCZXQuYW1vdW50QmV0IDwgaW52ZXN0b3JzUHJvZml0KSB8fAogICAgICAgICAgICAoaW52ZXN0b3JzUHJvZml0ICsgdGhpc0JldC5hbW91bnRCZXQgPCB0aGlzQmV0LmFtb3VudEJldCkgfHwKICAgICAgICAgICAgKHRoaXNCZXQuYW1vdW50QmV0ID09IDEpKSB7CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfQoKICAgICAgICB1aW50IHRvdGFsUHJvZml0ID0gaW52ZXN0b3JzUHJvZml0ICsgKHRoaXNCZXQuYW1vdW50QmV0IC0gMSk7IC8vYWRkZWQgYmFzZWQgb24gYXVkaXQgZmVlZGJhY2sKICAgICAgICBpbnZlc3RvcnNQcm9maXQgKz0gKHRoaXNCZXQuYW1vdW50QmV0IC0gMSkqKDEwMDAwIC0gaG91c2VFZGdlKS8xMDAwMDsKICAgICAgICB1aW50IGhvdXNlUHJvZml0ID0gdG90YWxQcm9maXQgLSBpbnZlc3RvcnNQcm9maXQ7IC8vY2hhbmdlZCBiYXNlZCBvbiBhdWRpdCBmZWVkYmFjawogICAgICAgIHNhZmVTZW5kKGhvdXNlQWRkcmVzcywgaG91c2VQcm9maXQpOwogICAgfQoKICAgIC8vU0VDVElPTiBJSUk6IElOVkVTVCAmIERJVkVTVAoKICAgIGZ1bmN0aW9uIGluY3JlYXNlSW52ZXN0bWVudCgpCiAgICAgICAgcGF5YWJsZQogICAgICAgIG9ubHlJZk5vdFN0b3BwZWQKICAgICAgICBvbmx5TW9yZVRoYW5aZXJvCiAgICAgICAgb25seUludmVzdG9ycyAgewoKICAgICAgICBwcm9maXREaXN0cmlidXRpb24oKTsKICAgICAgICBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl1dLmFtb3VudEludmVzdGVkICs9IG1zZy52YWx1ZTsKICAgICAgICBpbnZlc3RlZCArPSBtc2cudmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gbmV3SW52ZXN0b3IoKQogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5SWZOb3RTdG9wcGVkCiAgICAgICAgb25seU1vcmVUaGFuWmVybwogICAgICAgIG9ubHlOb3RJbnZlc3RvcnMKICAgICAgICBvbmx5TW9yZVRoYW5NaW5JbnZlc3RtZW50CiAgICAgICAgaW52ZXN0b3JzSW52YXJpYW50IHsKCiAgICAgICAgcHJvZml0RGlzdHJpYnV0aW9uKCk7CgogICAgICAgIGlmIChudW1JbnZlc3RvcnMgPT0gbWF4SW52ZXN0b3JzKSB7CiAgICAgICAgICAgIHVpbnQgc21hbGxlc3RJbnZlc3RvcklEID0gc2VhcmNoU21hbGxlc3RJbnZlc3RvcigpOwogICAgICAgICAgICBkaXZlc3QoaW52ZXN0b3JzW3NtYWxsZXN0SW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CgogICAgICAgIG51bUludmVzdG9ycysrOwogICAgICAgIGFkZEludmVzdG9yQXRJRChudW1JbnZlc3RvcnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdmVzdCgpCiAgICAgICAgb25seUludmVzdG9ycyB7CgogICAgICAgIGRpdmVzdChtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgZnVuY3Rpb24gZGl2ZXN0KGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIHByaXZhdGUKICAgICAgICBpbnZlc3RvcnNJbnZhcmlhbnQgewoKICAgICAgICBwcm9maXREaXN0cmlidXRpb24oKTsKICAgICAgICB1aW50IGN1cnJlbnRJRCA9IGludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl07CiAgICAgICAgdWludCBhbW91bnRUb1JldHVybiA9IGdldEJhbGFuY2UoY3VycmVudEludmVzdG9yKTsKCiAgICAgICAgaWYgKChpbnZlc3RlZCA+PSBpbnZlc3RvcnNbY3VycmVudElEXS5hbW91bnRJbnZlc3RlZCkpIHsKICAgICAgICAgICAgaW52ZXN0ZWQgLT0gaW52ZXN0b3JzW2N1cnJlbnRJRF0uYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgICAgIHVpbnQgZGl2ZXN0RmVlQW1vdW50ID0gIChhbW91bnRUb1JldHVybipkaXZlc3RGZWUpLzEwMDAwOwogICAgICAgICAgICBhbW91bnRUb1JldHVybiAtPSBkaXZlc3RGZWVBbW91bnQ7CgogICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JzW2N1cnJlbnRJRF07CiAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcklEc1tjdXJyZW50SW52ZXN0b3JdOwoKICAgICAgICAgICAgLy9SZW9yZGVyIGludmVzdG9ycwogICAgICAgICAgICBpZiAoY3VycmVudElEICE9IG51bUludmVzdG9ycykgewogICAgICAgICAgICAgICAgLy8gR2V0IGxhc3QgaW52ZXN0b3IKICAgICAgICAgICAgICAgIEludmVzdG9yIGxhc3RJbnZlc3RvciA9IGludmVzdG9yc1tudW1JbnZlc3RvcnNdOwogICAgICAgICAgICAgICAgLy9TZXQgbGFzdCBpbnZlc3RvciBJRCB0byBpbnZlc3RvcklEIG9mIGRpdmVzdGluZyBhY2NvdW50CiAgICAgICAgICAgICAgICBpbnZlc3RvcklEc1tsYXN0SW52ZXN0b3IuaW52ZXN0b3JBZGRyZXNzXSA9IGN1cnJlbnRJRDsKICAgICAgICAgICAgICAgIC8vQ29weSBpbnZlc3RvciBhdCB0aGUgbmV3IHBvc2l0aW9uIGluIHRoZSBtYXBwaW5nCiAgICAgICAgICAgICAgICBpbnZlc3RvcnNbY3VycmVudElEXSA9IGxhc3RJbnZlc3RvcjsKICAgICAgICAgICAgICAgIC8vRGVsZXRlIG9sZCBwb3NpdGlvbiBpbiB0aGUgbWFwcHBpbmcKICAgICAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbbnVtSW52ZXN0b3JzXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbnVtSW52ZXN0b3JzLS07CiAgICAgICAgICAgIHNhZmVTZW5kKGN1cnJlbnRJbnZlc3RvciwgYW1vdW50VG9SZXR1cm4pOwogICAgICAgICAgICBzYWZlU2VuZChob3VzZUFkZHJlc3MsIGRpdmVzdEZlZUFtb3VudCk7CiAgICAgICAgICAgIExPR19JbnZlc3RvckV4aXQoY3VycmVudEludmVzdG9yLCBhbW91bnRUb1JldHVybik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXNTdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgTE9HX0VtZXJnZW5jeUF1dG9TdG9wKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZvcmNlRGl2ZXN0T2ZBbGxJbnZlc3RvcnMoKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIHVpbnQgY29weU51bUludmVzdG9ycyA9IG51bUludmVzdG9yczsKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gY29weU51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGRpdmVzdChpbnZlc3RvcnNbMV0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgIFRoZSBvd25lciBjYW4gdXNlIHRoaXMgZnVuY3Rpb24gdG8gZm9yY2UgdGhlIGV4aXQgb2YgYW4gaW52ZXN0b3IgZnJvbSB0aGUKICAgIGNvbnRyYWN0IGR1cmluZyBhbiBlbWVyZ2VuY3kgd2l0aGRyYXdhbCBpbiB0aGUgZm9sbG93aW5nIHNpdHVhdGlvbnM6CiAgICAgICAgLSBVbnJlc3BvbnNpdmUgaW52ZXN0b3IKICAgICAgICAtIEludmVzdG9yIGRlbWFuZGluZyB0byBiZSBwYWlkIGluIG90aGVyIHRvIHZvdGUsIHRoZSBmYWN0by1ibGFja21haWxpbmcKICAgICAgICBvdGhlciBpbnZlc3RvcnMKICAgICovCiAgICBmdW5jdGlvbiBmb3JjZURpdmVzdE9mT25lSW52ZXN0b3IoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUlmU3RvcHBlZCB7CgogICAgICAgIGRpdmVzdChjdXJyZW50SW52ZXN0b3IpOwogICAgICAgIC8vUmVzZXRzIGVtZXJnZW5jeSB3aXRoZHJhd2FsIHByb3Bvc2FsLiBJbnZlc3RvcnMgbXVzdCB2b3RlIGFnYWluCiAgICAgICAgZGVsZXRlIHByb3Bvc2VkV2l0aGRyYXdhbDsKICAgIH0KCiAgICAvL1NFQ1RJT04gSVY6IENPTlRSQUNUIE1BTkFHRU1FTlQKCiAgICBmdW5jdGlvbiBzdG9wQ29udHJhY3QoKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIGlzU3RvcHBlZCA9IHRydWU7CiAgICAgICAgTE9HX0NvbnRyYWN0U3RvcHBlZCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlc3VtZUNvbnRyYWN0KCkKICAgICAgICBvbmx5T3duZXIgewoKICAgICAgICBpc1N0b3BwZWQgPSBmYWxzZTsKICAgICAgICBMT0dfQ29udHJhY3RSZXN1bWVkKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlSG91c2VBZGRyZXNzKGFkZHJlc3MgbmV3SG91c2UpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgaWYgKG5ld0hvdXNlID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7IC8vY2hhbmdlZCBiYXNlZCBvbiBhdWRpdCBmZWVkYmFjawogICAgICAgIGhvdXNlQWRkcmVzcyA9IG5ld0hvdXNlOwogICAgICAgIExPR19Ib3VzZUFkZHJlc3NDaGFuZ2VkKGhvdXNlQWRkcmVzcywgbmV3SG91c2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyQWRkcmVzcyhhZGRyZXNzIG5ld093bmVyKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIGlmIChuZXdPd25lciA9PSBhZGRyZXNzKDB4MCkpIHRocm93OwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgTE9HX093bmVyQWRkcmVzc0NoYW5nZWQob3duZXIsIG5ld093bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VHYXNMaW1pdE9mU2FmZVNlbmQodWludCBuZXdHYXNMaW1pdCkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5SWZWYWxpZEdhcyhuZXdHYXNMaW1pdCkgewoKICAgICAgICBzYWZlR2FzID0gbmV3R2FzTGltaXQ7CiAgICAgICAgTE9HX0dhc0xpbWl0Q2hhbmdlZChzYWZlR2FzLCBuZXdHYXNMaW1pdCk7CiAgICB9CgogICAgLy9TRUNUSU9OIFY6IEVNRVJHRU5DWSBXSVRIRFJBV0FMCgogICAgZnVuY3Rpb24gdm90ZUVtZXJnZW5jeVdpdGhkcmF3YWwoYm9vbCB2b3RlKQogICAgICAgIG9ubHlJbnZlc3RvcnMKICAgICAgICBvbmx5QWZ0ZXJQcm9wb3NlZAogICAgICAgIG9ubHlJZlN0b3BwZWQgewoKICAgICAgICBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl1dLnZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbCA9IHZvdGU7CiAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxWb3RlKG1zZy5zZW5kZXIsIHZvdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb3Bvc2VFbWVyZ2VuY3lXaXRoZHJhd2FsKGFkZHJlc3Mgd2l0aGRyYXdhbEFkZHJlc3MpCiAgICAgICAgb25seUlmU3RvcHBlZAogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIC8vUmVzZXRzIHByZXZpb3VzIHZvdGVzCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbaV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsOwogICAgICAgIH0KCiAgICAgICAgcHJvcG9zZWRXaXRoZHJhd2FsID0gV2l0aGRyYXdhbFByb3Bvc2FsKHdpdGhkcmF3YWxBZGRyZXNzLCBub3cpOwogICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsUHJvcG9zZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleGVjdXRlRW1lcmdlbmN5V2l0aGRyYXdhbCgpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUFmdGVyUHJvcG9zZWQKICAgICAgICBvbmx5SWZTdG9wcGVkCiAgICAgICAgb25seUlmRW1lcmdlbmN5VGltZU91dEhhc1Bhc3NlZCB7CgogICAgICAgIHVpbnQgbnVtT2ZWb3Rlc0luRmF2b3VyOwogICAgICAgIHVpbnQgYW1vdW50VG9XaXRoZHJhdyA9IHRoaXMuYmFsYW5jZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpbnZlc3RvcnNbaV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsID09IHRydWUpIHsKICAgICAgICAgICAgICAgIG51bU9mVm90ZXNJbkZhdm91cisrOwogICAgICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tpXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChudW1PZlZvdGVzSW5GYXZvdXIgPj0gZW1lcmdlbmN5V2l0aGRyYXdhbFJhdGlvICogbnVtSW52ZXN0b3JzIC8gMTAwKSB7CiAgICAgICAgICAgIGlmICghcHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcy5zZW5kKGFtb3VudFRvV2l0aGRyYXcpKSB7CiAgICAgICAgICAgICAgICBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbEZhaWxlZChwcm9wb3NlZFdpdGhkcmF3YWwudG9BZGRyZXNzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsU3VjY2VlZGVkKHByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3MsIGFtb3VudFRvV2l0aGRyYXcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9Cgp9'.
	

]
