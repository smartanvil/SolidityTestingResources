Class {
	#name : #SRT9dda491445b0b33976527ed741e0476a16380c49,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9dda491445b0b33976527ed741e0476a16380c49 >> base64 [
	^ 'Ly8gaGV2bTogZmxhdHRlbmVkIHNvdXJjZXMgb2Ygc3JjL2ZhYi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLy8vLy8gbGliL2RzLWd1YXJkL2xpYi9kcy1hdXRoL3NyYy9hdXRoLnNvbAovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgpjb250cmFjdCBEU0F1dGhvcml0eSB7CiAgICBmdW5jdGlvbiBjYW5DYWxsKAogICAgICAgIGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgYnl0ZXM0IHNpZwogICAgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRFNBdXRoRXZlbnRzIHsKICAgIGV2ZW50IExvZ1NldEF1dGhvcml0eSAoYWRkcmVzcyBpbmRleGVkIGF1dGhvcml0eSk7CiAgICBldmVudCBMb2dTZXRPd25lciAgICAgKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7Cn0KCmNvbnRyYWN0IERTQXV0aCBpcyBEU0F1dGhFdmVudHMgewogICAgRFNBdXRob3JpdHkgIHB1YmxpYyAgYXV0aG9yaXR5OwogICAgYWRkcmVzcyAgICAgIHB1YmxpYyAgb3duZXI7CgogICAgZnVuY3Rpb24gRFNBdXRoKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgTG9nU2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pCiAgICAgICAgcHVibGljCiAgICAgICAgYXV0aAogICAgewogICAgICAgIG93bmVyID0gb3duZXJfOwogICAgICAgIExvZ1NldE93bmVyKG93bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBdXRob3JpdHkoRFNBdXRob3JpdHkgYXV0aG9yaXR5XykKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgYXV0aG9yaXR5ID0gYXV0aG9yaXR5XzsKICAgICAgICBMb2dTZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKICAgIH0KCiAgICBtb2RpZmllciBhdXRoIHsKICAgICAgICByZXF1aXJlKGlzQXV0aG9yaXplZChtc2cuc2VuZGVyLCBtc2cuc2lnKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQoYWRkcmVzcyBzcmMsIGJ5dGVzNCBzaWcpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzcmMgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNyYyA9PSBvd25lcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGF1dGhvcml0eSA9PSBEU0F1dGhvcml0eSgwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eS5jYW5DYWxsKHNyYywgdGhpcywgc2lnKTsKICAgICAgICB9CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtZ3VhcmQvc3JjL2d1YXJkLnNvbAovLyBndWFyZC5zb2wgLS0gc2ltcGxlIHdoaXRlbGlzdCBpbXBsZW1lbnRhdGlvbiBvZiBEU0F1dGhvcml0eQoKLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBEYXBwSHViLCBMTEMKCi8vIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Ci8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5Ci8vIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCi8vIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgovLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLy8gYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLy8gTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQovLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCgovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsgKi8KCi8qIGltcG9ydCAiZHMtYXV0aC9hdXRoLnNvbCI7ICovCgpjb250cmFjdCBEU0d1YXJkRXZlbnRzIHsKICAgIGV2ZW50IExvZ1Blcm1pdCgKICAgICAgICBieXRlczMyIGluZGV4ZWQgc3JjLAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBkc3QsCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHNpZwogICAgKTsKCiAgICBldmVudCBMb2dGb3JiaWQoCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHNyYywKICAgICAgICBieXRlczMyIGluZGV4ZWQgZHN0LAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBzaWcKICAgICk7Cn0KCmNvbnRyYWN0IERTR3VhcmQgaXMgRFNBdXRoLCBEU0F1dGhvcml0eSwgRFNHdWFyZEV2ZW50cyB7CiAgICBieXRlczMyIGNvbnN0YW50IHB1YmxpYyBBTlkgPSBieXRlczMyKHVpbnQoLTEpKTsKCiAgICBtYXBwaW5nIChieXRlczMyID0+IG1hcHBpbmcgKGJ5dGVzMzIgPT4gbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSkpIGFjbDsKCiAgICBmdW5jdGlvbiBjYW5DYWxsKAogICAgICAgIGFkZHJlc3Mgc3JjXywgYWRkcmVzcyBkc3RfLCBieXRlczQgc2lnCiAgICApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB2YXIgc3JjID0gYnl0ZXMzMihzcmNfKTsKICAgICAgICB2YXIgZHN0ID0gYnl0ZXMzMihkc3RfKTsKCiAgICAgICAgcmV0dXJuIGFjbFtzcmNdW2RzdF1bc2lnXQogICAgICAgICAgICB8fCBhY2xbc3JjXVtkc3RdW0FOWV0KICAgICAgICAgICAgfHwgYWNsW3NyY11bQU5ZXVtzaWddCiAgICAgICAgICAgIHx8IGFjbFtzcmNdW0FOWV1bQU5ZXQogICAgICAgICAgICB8fCBhY2xbQU5ZXVtkc3RdW3NpZ10KICAgICAgICAgICAgfHwgYWNsW0FOWV1bZHN0XVtBTlldCiAgICAgICAgICAgIHx8IGFjbFtBTlldW0FOWV1bc2lnXQogICAgICAgICAgICB8fCBhY2xbQU5ZXVtBTlldW0FOWV07CiAgICB9CgogICAgZnVuY3Rpb24gcGVybWl0KGJ5dGVzMzIgc3JjLCBieXRlczMyIGRzdCwgYnl0ZXMzMiBzaWcpIHB1YmxpYyBhdXRoIHsKICAgICAgICBhY2xbc3JjXVtkc3RdW3NpZ10gPSB0cnVlOwogICAgICAgIExvZ1Blcm1pdChzcmMsIGRzdCwgc2lnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBmb3JiaWQoYnl0ZXMzMiBzcmMsIGJ5dGVzMzIgZHN0LCBieXRlczMyIHNpZykgcHVibGljIGF1dGggewogICAgICAgIGFjbFtzcmNdW2RzdF1bc2lnXSA9IGZhbHNlOwogICAgICAgIExvZ0ZvcmJpZChzcmMsIGRzdCwgc2lnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwZXJtaXQoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCBieXRlczMyIHNpZykgcHVibGljIHsKICAgICAgICBwZXJtaXQoYnl0ZXMzMihzcmMpLCBieXRlczMyKGRzdCksIHNpZyk7CiAgICB9CiAgICBmdW5jdGlvbiBmb3JiaWQoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCBieXRlczMyIHNpZykgcHVibGljIHsKICAgICAgICBmb3JiaWQoYnl0ZXMzMihzcmMpLCBieXRlczMyKGRzdCksIHNpZyk7CiAgICB9Cgp9Cgpjb250cmFjdCBEU0d1YXJkRmFjdG9yeSB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpICBwdWJsaWMgIGlzR3VhcmQ7CgogICAgZnVuY3Rpb24gbmV3R3VhcmQoKSBwdWJsaWMgcmV0dXJucyAoRFNHdWFyZCBndWFyZCkgewogICAgICAgIGd1YXJkID0gbmV3IERTR3VhcmQoKTsKICAgICAgICBndWFyZC5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgICAgICBpc0d1YXJkW2d1YXJkXSA9IHRydWU7CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtcm9sZXMvc3JjL3JvbGVzLnNvbAovLyByb2xlcy5zb2wgLSByb2xlZCBiYXNlZCBhdXRoZW50aWNhdGlvbgoKLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBEYXBwSHViLCBMTEMKCi8vIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Ci8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5Ci8vIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCi8vIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgovLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLy8gYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLy8gTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQovLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCgovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xMzsgKi8KCi8qIGltcG9ydCAnZHMtYXV0aC9hdXRoLnNvbCc7ICovCgpjb250cmFjdCBEU1JvbGVzIGlzIERTQXV0aCwgRFNBdXRob3JpdHkKewogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBfcm9vdF91c2VyczsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ynl0ZXMzMikgX3VzZXJfcm9sZXM7CiAgICBtYXBwaW5nKGFkZHJlc3M9Pm1hcHBpbmcoYnl0ZXM0PT5ieXRlczMyKSkgX2NhcGFiaWxpdHlfcm9sZXM7CiAgICBtYXBwaW5nKGFkZHJlc3M9Pm1hcHBpbmcoYnl0ZXM0PT5ib29sKSkgX3B1YmxpY19jYXBhYmlsaXRpZXM7CgogICAgZnVuY3Rpb24gZ2V0VXNlclJvbGVzKGFkZHJlc3Mgd2hvKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJldHVybiBfdXNlcl9yb2xlc1t3aG9dOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENhcGFiaWxpdHlSb2xlcyhhZGRyZXNzIGNvZGUsIGJ5dGVzNCBzaWcpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJ5dGVzMzIpCiAgICB7CiAgICAgICAgcmV0dXJuIF9jYXBhYmlsaXR5X3JvbGVzW2NvZGVdW3NpZ107CiAgICB9CgogICAgZnVuY3Rpb24gaXNVc2VyUm9vdChhZGRyZXNzIHdobykKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gX3Jvb3RfdXNlcnNbd2hvXTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0NhcGFiaWxpdHlQdWJsaWMoYWRkcmVzcyBjb2RlLCBieXRlczQgc2lnKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBfcHVibGljX2NhcGFiaWxpdGllc1tjb2RlXVtzaWddOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc1VzZXJSb2xlKGFkZHJlc3Mgd2hvLCB1aW50OCByb2xlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGJ5dGVzMzIgcm9sZXMgPSBnZXRVc2VyUm9sZXMod2hvKTsKICAgICAgICBieXRlczMyIHNoaWZ0ZWQgPSBieXRlczMyKHVpbnQyNTYodWludDI1NigyKSAqKiB1aW50MjU2KHJvbGUpKSk7CiAgICAgICAgcmV0dXJuIGJ5dGVzMzIoMCkgIT0gcm9sZXMgJiBzaGlmdGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbkNhbGwoYWRkcmVzcyBjYWxsZXIsIGFkZHJlc3MgY29kZSwgYnl0ZXM0IHNpZykKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiggaXNVc2VyUm9vdChjYWxsZXIpIHx8IGlzQ2FwYWJpbGl0eVB1YmxpYyhjb2RlLCBzaWcpICkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgaGFzX3JvbGVzID0gZ2V0VXNlclJvbGVzKGNhbGxlcik7CiAgICAgICAgICAgIHZhciBuZWVkc19vbmVfb2YgPSBnZXRDYXBhYmlsaXR5Um9sZXMoY29kZSwgc2lnKTsKICAgICAgICAgICAgcmV0dXJuIGJ5dGVzMzIoMCkgIT0gaGFzX3JvbGVzICYgbmVlZHNfb25lX29mOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBCSVROT1QoYnl0ZXMzMiBpbnB1dCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyIG91dHB1dCkgewogICAgICAgIHJldHVybiAoaW5wdXQgXiBieXRlczMyKHVpbnQoLTEpKSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Um9vdFVzZXIoYWRkcmVzcyB3aG8sIGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgX3Jvb3RfdXNlcnNbd2hvXSA9IGVuYWJsZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VXNlclJvbGUoYWRkcmVzcyB3aG8sIHVpbnQ4IHJvbGUsIGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgdmFyIGxhc3Rfcm9sZXMgPSBfdXNlcl9yb2xlc1t3aG9dOwogICAgICAgIGJ5dGVzMzIgc2hpZnRlZCA9IGJ5dGVzMzIodWludDI1Nih1aW50MjU2KDIpICoqIHVpbnQyNTYocm9sZSkpKTsKICAgICAgICBpZiggZW5hYmxlZCApIHsKICAgICAgICAgICAgX3VzZXJfcm9sZXNbd2hvXSA9IGxhc3Rfcm9sZXMgfCBzaGlmdGVkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF91c2VyX3JvbGVzW3dob10gPSBsYXN0X3JvbGVzICYgQklUTk9UKHNoaWZ0ZWQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQdWJsaWNDYXBhYmlsaXR5KGFkZHJlc3MgY29kZSwgYnl0ZXM0IHNpZywgYm9vbCBlbmFibGVkKQogICAgICAgIHB1YmxpYwogICAgICAgIGF1dGgKICAgIHsKICAgICAgICBfcHVibGljX2NhcGFiaWxpdGllc1tjb2RlXVtzaWddID0gZW5hYmxlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSb2xlQ2FwYWJpbGl0eSh1aW50OCByb2xlLCBhZGRyZXNzIGNvZGUsIGJ5dGVzNCBzaWcsIGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgdmFyIGxhc3Rfcm9sZXMgPSBfY2FwYWJpbGl0eV9yb2xlc1tjb2RlXVtzaWddOwogICAgICAgIGJ5dGVzMzIgc2hpZnRlZCA9IGJ5dGVzMzIodWludDI1Nih1aW50MjU2KDIpICoqIHVpbnQyNTYocm9sZSkpKTsKICAgICAgICBpZiggZW5hYmxlZCApIHsKICAgICAgICAgICAgX2NhcGFiaWxpdHlfcm9sZXNbY29kZV1bc2lnXSA9IGxhc3Rfcm9sZXMgfCBzaGlmdGVkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jYXBhYmlsaXR5X3JvbGVzW2NvZGVdW3NpZ10gPSBsYXN0X3JvbGVzICYgQklUTk9UKHNoaWZ0ZWQpOwogICAgICAgIH0KCiAgICB9Cgp9CgovLy8vLy8gbGliL2RzLXNwZWxsL2xpYi9kcy1ub3RlL3NyYy9ub3RlLnNvbAovLy8gbm90ZS5zb2wgLS0gdGhlIGBub3RlJyBtb2RpZmllciwgZm9yIGxvZ2dpbmcgY2FsbHMgYXMgZXZlbnRzCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgpjb250cmFjdCBEU05vdGUgewogICAgZXZlbnQgTG9nTm90ZSgKICAgICAgICBieXRlczQgICBpbmRleGVkICBzaWcsCiAgICAgICAgYWRkcmVzcyAgaW5kZXhlZCAgZ3V5LAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIGZvbywKICAgICAgICBieXRlczMyICBpbmRleGVkICBiYXIsCiAgICAgICAgdWludCAgICAgICAgICAgICAgd2FkLAogICAgICAgIGJ5dGVzICAgICAgICAgICAgIGZheAogICAgKSBhbm9ueW1vdXM7CgogICAgbW9kaWZpZXIgbm90ZSB7CiAgICAgICAgYnl0ZXMzMiBmb287CiAgICAgICAgYnl0ZXMzMiBiYXI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgZm9vIDo9IGNhbGxkYXRhbG9hZCg0KQogICAgICAgICAgICBiYXIgOj0gY2FsbGRhdGFsb2FkKDM2KQogICAgICAgIH0KCiAgICAgICAgTG9nTm90ZShtc2cuc2lnLCBtc2cuc2VuZGVyLCBmb28sIGJhciwgbXNnLnZhbHVlLCBtc2cuZGF0YSk7CgogICAgICAgIF87CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtdGhpbmcvbGliL2RzLW1hdGgvc3JjL21hdGguc29sCi8vLyBtYXRoLnNvbCAtLSBtaXhpbiBmb3IgaW5saW5lIG51bWVyaWNhbCB3aXphcmRyeQoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjEzOyAqLwoKY29udHJhY3QgRFNNYXRoIHsKICAgIGZ1bmN0aW9uIGFkZCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCArIHkpID49IHgpOwogICAgfQogICAgZnVuY3Rpb24gc3ViKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoKHogPSB4IC0geSkgPD0geCk7CiAgICB9CiAgICBmdW5jdGlvbiBtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSh5ID09IDAgfHwgKHogPSB4ICogeSkgLyB5ID09IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBtYXgodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1pbihpbnQgeCwgaW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50IHopIHsKICAgICAgICByZXR1cm4geCA8PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBpbWF4KGludCB4LCBpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KCiAgICB1aW50IGNvbnN0YW50IFdBRCA9IDEwICoqIDE4OwogICAgdWludCBjb25zdGFudCBSQVkgPSAxMCAqKiAyNzsKCiAgICBmdW5jdGlvbiB3bXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIHkpLCBXQUQgLyAyKSAvIFdBRDsKICAgIH0KICAgIGZ1bmN0aW9uIHJtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgeSksIFJBWSAvIDIpIC8gUkFZOwogICAgfQogICAgZnVuY3Rpb24gd2Rpdih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCBXQUQpLCB5IC8gMikgLyB5OwogICAgfQogICAgZnVuY3Rpb24gcmRpdih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCBSQVkpLCB5IC8gMikgLyB5OwogICAgfQoKICAgIC8vIFRoaXMgZmFtb3VzIGFsZ29yaXRobSBpcyBjYWxsZWQgImV4cG9uZW50aWF0aW9uIGJ5IHNxdWFyaW5nIgogICAgLy8gYW5kIGNhbGN1bGF0ZXMgeF5uIHdpdGggeCBhcyBmaXhlZC1wb2ludCBhbmQgbiBhcyByZWd1bGFyIHVuc2lnbmVkLgogICAgLy8KICAgIC8vIEl0J3MgTyhsb2cgbiksIGluc3RlYWQgb2YgTyhuKSBmb3IgbmFpdmUgcmVwZWF0ZWQgbXVsdGlwbGljYXRpb24uCiAgICAvLwogICAgLy8gVGhlc2UgZmFjdHMgYXJlIHdoeSBpdCB3b3JrczoKICAgIC8vCiAgICAvLyAgSWYgbiBpcyBldmVuLCB0aGVuIHhebiA9ICh4XjIpXihuLzIpLgogICAgLy8gIElmIG4gaXMgb2RkLCAgdGhlbiB4Xm4gPSB4ICogeF4obi0xKSwKICAgIC8vICAgYW5kIGFwcGx5aW5nIHRoZSBlcXVhdGlvbiBmb3IgZXZlbiB4IGdpdmVzCiAgICAvLyAgICB4Xm4gPSB4ICogKHheMileKChuLTEpIC8gMikuCiAgICAvLwogICAgLy8gIEFsc28sIEVWTSBkaXZpc2lvbiBpcyBmbG9vcmluZyBhbmQKICAgIC8vICAgIGZsb29yWyhuLTEpIC8gMl0gPSBmbG9vcltuIC8gMl0uCiAgICAvLwogICAgZnVuY3Rpb24gcnBvdyh1aW50IHgsIHVpbnQgbikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gbiAlIDIgIT0gMCA/IHggOiBSQVk7CgogICAgICAgIGZvciAobiAvPSAyOyBuICE9IDA7IG4gLz0gMikgewogICAgICAgICAgICB4ID0gcm11bCh4LCB4KTsKCiAgICAgICAgICAgIGlmIChuICUgMiAhPSAwKSB7CiAgICAgICAgICAgICAgICB6ID0gcm11bCh6LCB4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLy8vLy8vIGxpYi9kcy10aGluZy9zcmMvdGhpbmcuc29sCi8vIHRoaW5nLnNvbCAtIGBhdXRoYCB3aXRoIGhhbmR5IG1peGlucy4geW91ciB0aGluZ3Mgc2hvdWxkIGJlIERTVGhpbmdzCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhcHBIdWIsIExMQwoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjEzOyAqLwoKLyogaW1wb3J0ICdkcy1hdXRoL2F1dGguc29sJzsgKi8KLyogaW1wb3J0ICdkcy1ub3RlL25vdGUuc29sJzsgKi8KLyogaW1wb3J0ICdkcy1tYXRoL21hdGguc29sJzsgKi8KCmNvbnRyYWN0IERTVGhpbmcgaXMgRFNBdXRoLCBEU05vdGUsIERTTWF0aCB7CgogICAgZnVuY3Rpb24gUyhzdHJpbmcgcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczQpIHsKICAgICAgICByZXR1cm4gYnl0ZXM0KGtlY2NhazI1NihzKSk7CiAgICB9Cgp9CgovLy8vLy8gbGliL2RzLXRva2VuL2xpYi9kcy1zdG9wL3NyYy9zdG9wLnNvbAovLy8gc3RvcC5zb2wgLS0gbWl4aW4gZm9yIGVuYWJsZS9kaXNhYmxlIGZ1bmN0aW9uYWxpdHkKCi8vIENvcHlyaWdodCAoQykgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgovKiBpbXBvcnQgImRzLWF1dGgvYXV0aC5zb2wiOyAqLwovKiBpbXBvcnQgImRzLW5vdGUvbm90ZS5zb2wiOyAqLwoKY29udHJhY3QgRFNTdG9wIGlzIERTTm90ZSwgRFNBdXRoIHsKCiAgICBib29sIHB1YmxpYyBzdG9wcGVkOwoKICAgIG1vZGlmaWVyIHN0b3BwYWJsZSB7CiAgICAgICAgcmVxdWlyZSghc3RvcHBlZCk7CiAgICAgICAgXzsKICAgIH0KICAgIGZ1bmN0aW9uIHN0b3AoKSBwdWJsaWMgYXV0aCBub3RlIHsKICAgICAgICBzdG9wcGVkID0gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHN0YXJ0KCkgcHVibGljIGF1dGggbm90ZSB7CiAgICAgICAgc3RvcHBlZCA9IGZhbHNlOwogICAgfQoKfQoKLy8vLy8vIGxpYi9kcy10b2tlbi9saWIvZXJjMjAvc3JjL2VyYzIwLnNvbAovLy8gZXJjMjAuc29sIC0tIEFQSSBmb3IgdGhlIEVSQzIwIHRva2VuIHN0YW5kYXJkCgovLyBTZWUgPGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMD4uCgovLyBUaGlzIGZpbGUgbGlrZWx5IGRvZXMgbm90IG1lZXQgdGhlIHRocmVzaG9sZCBvZiBvcmlnaW5hbGl0eQovLyByZXF1aXJlZCBmb3IgY29weXJpZ2h0IHRvIGFwcGx5LiAgQXMgYSByZXN1bHQsIHRoaXMgaXMgZnJlZSBhbmQKLy8gdW5lbmN1bWJlcmVkIHNvZnR3YXJlIGJlbG9uZ2luZyB0byB0aGUgcHVibGljIGRvbWFpbi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40Ljg7ICovCgpjb250cmFjdCBFUkMyMEV2ZW50cyB7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZ3V5LCB1aW50IHdhZCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZHN0LCB1aW50IHdhZCk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwRXZlbnRzIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBndXkpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGd1eSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgZHN0LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgdWludCB3YWQKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgovLy8vLy8gbGliL2RzLXRva2VuL3NyYy9iYXNlLnNvbAovLy8gYmFzZS5zb2wgLS0gYmFzaWMgRVJDMjAgaW1wbGVtZW50YXRpb24KCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgovKiBpbXBvcnQgImVyYzIwL2VyYzIwLnNvbCI7ICovCi8qIGltcG9ydCAiZHMtbWF0aC9tYXRoLnNvbCI7ICovCgpjb250cmFjdCBEU1Rva2VuQmFzZSBpcyBFUkMyMCwgRFNNYXRoIHsKICAgIHVpbnQyNTYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zdXBwbHk7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpICAgICAgICAgICAgICAgICAgICAgICBfYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpICBfYXBwcm92YWxzOwoKICAgIGZ1bmN0aW9uIERTVG9rZW5CYXNlKHVpbnQgc3VwcGx5KSBwdWJsaWMgewogICAgICAgIF9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1cHBseTsKICAgICAgICBfc3VwcGx5ID0gc3VwcGx5OwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfc3VwcGx5OwogICAgfQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgc3JjKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9iYWxhbmNlc1tzcmNdOwogICAgfQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGd1eSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfYXBwcm92YWxzW3NyY11bZ3V5XTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIGRzdCwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBkc3QsIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgdWludCB3YWQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoc3JjICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgX2FwcHJvdmFsc1tzcmNdW21zZy5zZW5kZXJdID0gc3ViKF9hcHByb3ZhbHNbc3JjXVttc2cuc2VuZGVyXSwgd2FkKTsKICAgICAgICB9CgogICAgICAgIF9iYWxhbmNlc1tzcmNdID0gc3ViKF9iYWxhbmNlc1tzcmNdLCB3YWQpOwogICAgICAgIF9iYWxhbmNlc1tkc3RdID0gYWRkKF9iYWxhbmNlc1tkc3RdLCB3YWQpOwoKICAgICAgICBUcmFuc2ZlcihzcmMsIGRzdCwgd2FkKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgX2FwcHJvdmFsc1ttc2cuc2VuZGVyXVtndXldID0gd2FkOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBndXksIHdhZCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgovLy8vLy8gbGliL2RzLXRva2VuL3NyYy90b2tlbi5zb2wKLy8vIHRva2VuLnNvbCAtLSBFUkMyMCBpbXBsZW1lbnRhdGlvbiB3aXRoIG1pbnRpbmcgYW5kIGJ1cm5pbmcKCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7ICovCgovKiBpbXBvcnQgImRzLXN0b3Avc3RvcC5zb2wiOyAqLwoKLyogaW1wb3J0ICIuL2Jhc2Uuc29sIjsgKi8KCmNvbnRyYWN0IERTVG9rZW4gaXMgRFNUb2tlbkJhc2UoMCksIERTU3RvcCB7CgogICAgYnl0ZXMzMiAgcHVibGljICBzeW1ib2w7CiAgICB1aW50MjU2ICBwdWJsaWMgIGRlY2ltYWxzID0gMTg7IC8vIHN0YW5kYXJkIHRva2VuIHByZWNpc2lvbi4gb3ZlcnJpZGUgdG8gY3VzdG9taXplCgogICAgZnVuY3Rpb24gRFNUb2tlbihieXRlczMyIHN5bWJvbF8pIHB1YmxpYyB7CiAgICAgICAgc3ltYm9sID0gc3ltYm9sXzsKICAgIH0KCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCBndXksIHVpbnQgd2FkKTsKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGd1eSwgdWludCB3YWQpOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBndXkpIHB1YmxpYyBzdG9wcGFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci5hcHByb3ZlKGd1eSwgdWludCgtMSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBndXksIHVpbnQgd2FkKSBwdWJsaWMgc3RvcHBhYmxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShndXksIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgdWludCB3YWQpCiAgICAgICAgcHVibGljCiAgICAgICAgc3RvcHBhYmxlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoc3JjICE9IG1zZy5zZW5kZXIgJiYgX2FwcHJvdmFsc1tzcmNdW21zZy5zZW5kZXJdICE9IHVpbnQoLTEpKSB7CiAgICAgICAgICAgIF9hcHByb3ZhbHNbc3JjXVttc2cuc2VuZGVyXSA9IHN1YihfYXBwcm92YWxzW3NyY11bbXNnLnNlbmRlcl0sIHdhZCk7CiAgICAgICAgfQoKICAgICAgICBfYmFsYW5jZXNbc3JjXSA9IHN1YihfYmFsYW5jZXNbc3JjXSwgd2FkKTsKICAgICAgICBfYmFsYW5jZXNbZHN0XSA9IGFkZChfYmFsYW5jZXNbZHN0XSwgd2FkKTsKCiAgICAgICAgVHJhbnNmZXIoc3JjLCBkc3QsIHdhZCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1c2goYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIHRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBkc3QsIHdhZCk7CiAgICB9CiAgICBmdW5jdGlvbiBwdWxsKGFkZHJlc3Mgc3JjLCB1aW50IHdhZCkgcHVibGljIHsKICAgICAgICB0cmFuc2ZlckZyb20oc3JjLCBtc2cuc2VuZGVyLCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gbW92ZShhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIHRyYW5zZmVyRnJvbShzcmMsIGRzdCwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50KHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIG1pbnQobXNnLnNlbmRlciwgd2FkKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJ1cm4odWludCB3YWQpIHB1YmxpYyB7CiAgICAgICAgYnVybihtc2cuc2VuZGVyLCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyBhdXRoIHN0b3BwYWJsZSB7CiAgICAgICAgX2JhbGFuY2VzW2d1eV0gPSBhZGQoX2JhbGFuY2VzW2d1eV0sIHdhZCk7CiAgICAgICAgX3N1cHBseSA9IGFkZChfc3VwcGx5LCB3YWQpOwogICAgICAgIE1pbnQoZ3V5LCB3YWQpOwogICAgfQogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyBhdXRoIHN0b3BwYWJsZSB7CiAgICAgICAgaWYgKGd1eSAhPSBtc2cuc2VuZGVyICYmIF9hcHByb3ZhbHNbZ3V5XVttc2cuc2VuZGVyXSAhPSB1aW50KC0xKSkgewogICAgICAgICAgICBfYXBwcm92YWxzW2d1eV1bbXNnLnNlbmRlcl0gPSBzdWIoX2FwcHJvdmFsc1tndXldW21zZy5zZW5kZXJdLCB3YWQpOwogICAgICAgIH0KCiAgICAgICAgX2JhbGFuY2VzW2d1eV0gPSBzdWIoX2JhbGFuY2VzW2d1eV0sIHdhZCk7CiAgICAgICAgX3N1cHBseSA9IHN1Yihfc3VwcGx5LCB3YWQpOwogICAgICAgIEJ1cm4oZ3V5LCB3YWQpOwogICAgfQoKICAgIC8vIE9wdGlvbmFsIHRva2VuIG5hbWUKICAgIGJ5dGVzMzIgICBwdWJsaWMgIG5hbWUgPSAiIjsKCiAgICBmdW5jdGlvbiBzZXROYW1lKGJ5dGVzMzIgbmFtZV8pIHB1YmxpYyBhdXRoIHsKICAgICAgICBuYW1lID0gbmFtZV87CiAgICB9Cn0KCi8vLy8vLyBsaWIvZHMtdmFsdWUvc3JjL3ZhbHVlLnNvbAovLy8gdmFsdWUuc29sIC0gYSB2YWx1ZSBpcyBhIHNpbXBsZSB0aGluZywgaXQgY2FuIGJlIGdldCBhbmQgc2V0CgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhcHBIdWIsIExMQwoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjEzOyAqLwoKLyogaW1wb3J0ICdkcy10aGluZy90aGluZy5zb2wnOyAqLwoKY29udHJhY3QgRFNWYWx1ZSBpcyBEU1RoaW5nIHsKICAgIGJvb2wgICAgaGFzOwogICAgYnl0ZXMzMiB2YWw7CiAgICBmdW5jdGlvbiBwZWVrKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMiwgYm9vbCkgewogICAgICAgIHJldHVybiAodmFsLGhhcyk7CiAgICB9CiAgICBmdW5jdGlvbiByZWFkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHZhciAod3V0LCBoYXopID0gcGVlaygpOwogICAgICAgIGFzc2VydChoYXopOwogICAgICAgIHJldHVybiB3dXQ7CiAgICB9CiAgICBmdW5jdGlvbiBwb2tlKGJ5dGVzMzIgd3V0KSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB2YWwgPSB3dXQ7CiAgICAgICAgaGFzID0gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHZvaWQoKSBwdWJsaWMgbm90ZSBhdXRoIHsgIC8vIHVuc2V0IHRoZSB2YWx1ZQogICAgICAgIGhhcyA9IGZhbHNlOwogICAgfQp9CgovLy8vLy8gc3JjL3ZveC5zb2wKLy8vIHZveC5zb2wgLS0gdGFyZ2V0IHByaWNlIGZlZWQKCi8vIENvcHlyaWdodCAoQykgMjAxNiwgMjAxNyAgTmlrb2xhaSBNdXNoZWdpYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYmVkMGQ3ZDVkMWQyZGZkN2ZlZGFkZmNlY2VkNmNiZGM5MGRkZDFkMyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNiwgMjAxNyAgRGFuaWVsIEJyb2NrbWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjM4NWM1OTU2NTE1ZDU0Nzg1YzU5NDg0ODUwNGQ1YTE2NWI1NzU1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8gQ29weXJpZ2h0IChDKSAyMDE3ICAgICAgICBSYWluIEJyZWFrIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImU5OWI4ODgwODc4YjliOGM4ODgyYTk5YjgwOWE4YzljOTljNzg3OGM5ZCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKLyogcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7ICovCgovKiBpbXBvcnQgImRzLXRoaW5nL3RoaW5nLnNvbCI7ICovCgpjb250cmFjdCBTYWlWb3ggaXMgRFNUaGluZyB7CiAgICB1aW50MjU2ICBfcGFyOwogICAgdWludDI1NiAgX3dheTsKCiAgICB1aW50MjU2ICBwdWJsaWMgIGZpeDsKICAgIHVpbnQyNTYgIHB1YmxpYyAgaG93OwogICAgdWludDI1NiAgcHVibGljICB0YXU7CgogICAgZnVuY3Rpb24gU2FpVm94KHVpbnQgcGFyXykgcHVibGljIHsKICAgICAgICBfcGFyID0gZml4ID0gcGFyXzsKICAgICAgICBfd2F5ID0gUkFZOwogICAgICAgIHRhdSAgPSBlcmEoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBlcmEoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJsb2NrLnRpbWVzdGFtcDsKICAgIH0KCiAgICBmdW5jdGlvbiBtb2xkKGJ5dGVzMzIgcGFyYW0sIHVpbnQgdmFsKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICBpZiAocGFyYW0gPT0gJ3dheScpIF93YXkgPSB2YWw7CiAgICB9CgogICAgLy8gRGFpIFRhcmdldCBQcmljZSAocmVmIHBlciBkYWkpCiAgICBmdW5jdGlvbiBwYXIoKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHByb2QoKTsKICAgICAgICByZXR1cm4gX3BhcjsKICAgIH0KICAgIGZ1bmN0aW9uIHdheSgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcHJvZCgpOwogICAgICAgIHJldHVybiBfd2F5OwogICAgfQoKICAgIGZ1bmN0aW9uIHRlbGwodWludDI1NiByYXkpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIGZpeCA9IHJheTsKICAgIH0KICAgIGZ1bmN0aW9uIHR1bmUodWludDI1NiByYXkpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIGhvdyA9IHJheTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9kKCkgcHVibGljIG5vdGUgewogICAgICAgIHZhciBhZ2UgPSBlcmEoKSAtIHRhdTsKICAgICAgICBpZiAoYWdlID09IDApIHJldHVybjsgIC8vIG9wdGltaXNlZAogICAgICAgIHRhdSA9IGVyYSgpOwoKICAgICAgICBpZiAoX3dheSAhPSBSQVkpIF9wYXIgPSBybXVsKF9wYXIsIHJwb3coX3dheSwgYWdlKSk7ICAvLyBvcHRpbWlzZWQKCiAgICAgICAgaWYgKGhvdyA9PSAwKSByZXR1cm47ICAvLyBvcHRpbWlzZWQKICAgICAgICB2YXIgd2FnID0gaW50MTI4KGhvdyAqIGFnZSk7CiAgICAgICAgX3dheSA9IGluaihwcmooX3dheSkgKyAoZml4IDwgX3BhciA/IHdhZyA6IC13YWcpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmooaW50MTI4IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB4ID49IDAgPyB1aW50MjU2KHgpICsgUkFZCiAgICAgICAgICAgIDogcmRpdihSQVksIFJBWSArIHVpbnQyNTYoLXgpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHByaih1aW50MjU2IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50MTI4KSB7CiAgICAgICAgcmV0dXJuIHggPj0gUkFZID8gaW50MTI4KHggLSBSQVkpCiAgICAgICAgICAgIDogaW50MTI4KFJBWSkgLSBpbnQxMjgocmRpdihSQVksIHgpKTsKICAgIH0KfQoKLy8vLy8vIHNyYy90dWIuc29sCi8vLyB0dWIuc29sIC0tIHNpbXBsaWZpZWQgQ0RQIGVuZ2luZSAoYmFieSBicm90aGVyIG9mIGB2YXQnKQoKLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBOaWtvbGFpIE11c2hlZ2lhbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIwYzYyNjU2NzYzNjA2ZDY1NGM2ODZkN2M3YzY0Nzk2ZTIyNmY2MzYxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8gQ29weXJpZ2h0IChDKSAyMDE3ICBEYW5pZWwgQnJvY2ttYW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iM2E1ZTViNTQ1MzVmNTY3YTVlNWI0YTRhNTI0ZjU4MTQ1OTU1NTciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIFJhaW4gQnJlYWsgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNjUxNzA0MGMwYjA3MTcwMDA0MGUyNTE3MGMxNjAwMTAxNTRiMGIwMDExIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Ci8vIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5Ci8vIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCi8vIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgovLyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKLy8gYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLy8gTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQovLyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKLy8gWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCgovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xODsgKi8KCi8qIGltcG9ydCAiZHMtdGhpbmcvdGhpbmcuc29sIjsgKi8KLyogaW1wb3J0ICJkcy10b2tlbi90b2tlbi5zb2wiOyAqLwovKiBpbXBvcnQgImRzLXZhbHVlL3ZhbHVlLnNvbCI7ICovCgovKiBpbXBvcnQgIi4vdm94LnNvbCI7ICovCgpjb250cmFjdCBTYWlUdWJFdmVudHMgewogICAgZXZlbnQgTG9nTmV3Q3VwKGFkZHJlc3MgaW5kZXhlZCBsYWQsIGJ5dGVzMzIgY3VwKTsKfQoKY29udHJhY3QgU2FpVHViIGlzIERTVGhpbmcsIFNhaVR1YkV2ZW50cyB7CiAgICBEU1Rva2VuICBwdWJsaWMgIHNhaTsgIC8vIFN0YWJsZWNvaW4KICAgIERTVG9rZW4gIHB1YmxpYyAgc2luOyAgLy8gRGVidCAobmVnYXRpdmUgc2FpKQoKICAgIERTVG9rZW4gIHB1YmxpYyAgc2tyOyAgLy8gQWJzdHJhY3RlZCBjb2xsYXRlcmFsCiAgICBFUkMyMCAgICBwdWJsaWMgIGdlbTsgIC8vIFVuZGVybHlpbmcgY29sbGF0ZXJhbAoKICAgIERTVG9rZW4gIHB1YmxpYyAgZ292OyAgLy8gR292ZXJuYW5jZSB0b2tlbgoKICAgIFNhaVZveCAgIHB1YmxpYyAgdm94OyAgLy8gVGFyZ2V0IHByaWNlIGZlZWQKICAgIERTVmFsdWUgIHB1YmxpYyAgcGlwOyAgLy8gUmVmZXJlbmNlIHByaWNlIGZlZWQKICAgIERTVmFsdWUgIHB1YmxpYyAgcGVwOyAgLy8gR292ZXJuYW5jZSBwcmljZSBmZWVkCgogICAgYWRkcmVzcyAgcHVibGljICB0YXA7ICAvLyBMaXF1aWRhdG9yCiAgICBhZGRyZXNzICBwdWJsaWMgIHBpdDsgIC8vIEdvdmVybmFuY2UgVmF1bHQKCiAgICB1aW50MjU2ICBwdWJsaWMgIGF4ZTsgIC8vIExpcXVpZGF0aW9uIHBlbmFsdHkKICAgIHVpbnQyNTYgIHB1YmxpYyAgY2FwOyAgLy8gRGVidCBjZWlsaW5nCiAgICB1aW50MjU2ICBwdWJsaWMgIG1hdDsgIC8vIExpcXVpZGF0aW9uIHJhdGlvCiAgICB1aW50MjU2ICBwdWJsaWMgIHRheDsgIC8vIFN0YWJpbGl0eSBmZWUKICAgIHVpbnQyNTYgIHB1YmxpYyAgZmVlOyAgLy8gR292ZXJuYW5jZSBmZWUKICAgIHVpbnQyNTYgIHB1YmxpYyAgZ2FwOyAgLy8gSm9pbi1FeGl0IFNwcmVhZAoKICAgIGJvb2wgICAgIHB1YmxpYyAgb2ZmOyAgLy8gQ2FnZSBmbGFnCiAgICBib29sICAgICBwdWJsaWMgIG91dDsgIC8vIFBvc3QgY2FnZSBleGl0CgogICAgdWludDI1NiAgcHVibGljICBmaXQ7ICAvLyBSRUYgcGVyIFNLUiAoanVzdCBiZWZvcmUgc2V0dGxlbWVudCkKCiAgICB1aW50MjU2ICBwdWJsaWMgIHJobzsgIC8vIFRpbWUgb2YgbGFzdCBkcmlwCiAgICB1aW50MjU2ICAgICAgICAgX2NoaTsgIC8vIEFjY3VtdWxhdGVkIFRheCBSYXRlcwogICAgdWludDI1NiAgICAgICAgIF9yaGk7ICAvLyBBY2N1bXVsYXRlZCBUYXggKyBGZWUgUmF0ZXMKICAgIHVpbnQyNTYgIHB1YmxpYyAgcnVtOyAgLy8gVG90YWwgbm9ybWFsaXNlZCBkZWJ0CgogICAgdWludDI1NiAgICAgICAgICAgICAgICAgICBwdWJsaWMgIGN1cGk7CiAgICBtYXBwaW5nIChieXRlczMyID0+IEN1cCkgIHB1YmxpYyAgY3VwczsKCiAgICBzdHJ1Y3QgQ3VwIHsKICAgICAgICBhZGRyZXNzICBsYWQ7ICAgICAgLy8gQ0RQIG93bmVyCiAgICAgICAgdWludDI1NiAgaW5rOyAgICAgIC8vIExvY2tlZCBjb2xsYXRlcmFsIChpbiBTS1IpCiAgICAgICAgdWludDI1NiAgYXJ0OyAgICAgIC8vIE91dHN0YW5kaW5nIG5vcm1hbGlzZWQgZGVidCAodGF4IG9ubHkpCiAgICAgICAgdWludDI1NiAgaXJlOyAgICAgIC8vIE91dHN0YW5kaW5nIG5vcm1hbGlzZWQgZGVidAogICAgfQoKICAgIGZ1bmN0aW9uIGxhZChieXRlczMyIGN1cCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBjdXBzW2N1cF0ubGFkOwogICAgfQogICAgZnVuY3Rpb24gaW5rKGJ5dGVzMzIgY3VwKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGN1cHNbY3VwXS5pbms7CiAgICB9CiAgICBmdW5jdGlvbiB0YWIoYnl0ZXMzMiBjdXApIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJtdWwoY3Vwc1tjdXBdLmFydCwgY2hpKCkpOwogICAgfQogICAgZnVuY3Rpb24gcmFwKGJ5dGVzMzIgY3VwKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzdWIocm11bChjdXBzW2N1cF0uaXJlLCByaGkoKSksIHRhYihjdXApKTsKICAgIH0KCiAgICAvLyBUb3RhbCBDRFAgRGVidAogICAgZnVuY3Rpb24gZGluKCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcm11bChydW0sIGNoaSgpKTsKICAgIH0KICAgIC8vIEJhY2tpbmcgY29sbGF0ZXJhbAogICAgZnVuY3Rpb24gYWlyKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBza3IuYmFsYW5jZU9mKHRoaXMpOwogICAgfQogICAgLy8gUmF3IGNvbGxhdGVyYWwKICAgIGZ1bmN0aW9uIHBpZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZ2VtLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIGZ1bmN0aW9uIFNhaVR1YigKICAgICAgICBEU1Rva2VuICBzYWlfLAogICAgICAgIERTVG9rZW4gIHNpbl8sCiAgICAgICAgRFNUb2tlbiAgc2tyXywKICAgICAgICBFUkMyMCAgICBnZW1fLAogICAgICAgIERTVG9rZW4gIGdvdl8sCiAgICAgICAgRFNWYWx1ZSAgcGlwXywKICAgICAgICBEU1ZhbHVlICBwZXBfLAogICAgICAgIFNhaVZveCAgIHZveF8sCiAgICAgICAgYWRkcmVzcyAgcGl0XwogICAgKSBwdWJsaWMgewogICAgICAgIGdlbSA9IGdlbV87CiAgICAgICAgc2tyID0gc2tyXzsKCiAgICAgICAgc2FpID0gc2FpXzsKICAgICAgICBzaW4gPSBzaW5fOwoKICAgICAgICBnb3YgPSBnb3ZfOwogICAgICAgIHBpdCA9IHBpdF87CgogICAgICAgIHBpcCA9IHBpcF87CiAgICAgICAgcGVwID0gcGVwXzsKICAgICAgICB2b3ggPSB2b3hfOwoKICAgICAgICBheGUgPSBSQVk7CiAgICAgICAgbWF0ID0gUkFZOwogICAgICAgIHRheCA9IFJBWTsKICAgICAgICBmZWUgPSBSQVk7CiAgICAgICAgZ2FwID0gV0FEOwoKICAgICAgICBfY2hpID0gUkFZOwogICAgICAgIF9yaGkgPSBSQVk7CgogICAgICAgIHJobyA9IGVyYSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVyYSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJsb2NrLnRpbWVzdGFtcDsKICAgIH0KCiAgICAvLy0tUmlzay1wYXJhbWV0ZXItY29uZmlnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIGZ1bmN0aW9uIG1vbGQoYnl0ZXMzMiBwYXJhbSwgdWludCB2YWwpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIGlmICAgICAgKHBhcmFtID09ICdjYXAnKSBjYXAgPSB2YWw7CiAgICAgICAgZWxzZSBpZiAocGFyYW0gPT0gJ21hdCcpIHsgcmVxdWlyZSh2YWwgPj0gUkFZKTsgbWF0ID0gdmFsOyB9CiAgICAgICAgZWxzZSBpZiAocGFyYW0gPT0gJ3RheCcpIHsgcmVxdWlyZSh2YWwgPj0gUkFZKTsgZHJpcCgpOyB0YXggPSB2YWw7IH0KICAgICAgICBlbHNlIGlmIChwYXJhbSA9PSAnZmVlJykgeyByZXF1aXJlKHZhbCA+PSBSQVkpOyBkcmlwKCk7IGZlZSA9IHZhbDsgfQogICAgICAgIGVsc2UgaWYgKHBhcmFtID09ICdheGUnKSB7IHJlcXVpcmUodmFsID49IFJBWSk7IGF4ZSA9IHZhbDsgfQogICAgICAgIGVsc2UgaWYgKHBhcmFtID09ICdnYXAnKSB7IHJlcXVpcmUodmFsID49IFdBRCk7IGdhcCA9IHZhbDsgfQogICAgICAgIGVsc2UgcmV0dXJuOwogICAgfQoKICAgIC8vLS1QcmljZS1mZWVkLXNldHRlcnMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgZnVuY3Rpb24gc2V0UGlwKERTVmFsdWUgcGlwXykgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgcGlwID0gcGlwXzsKICAgIH0KICAgIGZ1bmN0aW9uIHNldFBlcChEU1ZhbHVlIHBlcF8pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHBlcCA9IHBlcF87CiAgICB9CiAgICBmdW5jdGlvbiBzZXRWb3goU2FpVm94IHZveF8pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHZveCA9IHZveF87CiAgICB9CgogICAgLy8tLVRhcC1zZXR0ZXItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHR1cm4oYWRkcmVzcyB0YXBfKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSh0YXAgID09IDApOwogICAgICAgIHJlcXVpcmUodGFwXyAhPSAwKTsKICAgICAgICB0YXAgPSB0YXBfOwogICAgfQoKICAgIC8vLS1Db2xsYXRlcmFsLXdyYXBwZXItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gV3JhcHBlciByYXRpbyAoZ2VtIHBlciBza3IpCiAgICBmdW5jdGlvbiBwZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJheSkgewogICAgICAgIHJldHVybiBza3IudG90YWxTdXBwbHkoKSA9PSAwID8gUkFZIDogcmRpdihwaWUoKSwgc2tyLnRvdGFsU3VwcGx5KCkpOwogICAgfQogICAgLy8gSm9pbiBwcmljZSAoZ2VtIHBlciBza3IpCiAgICBmdW5jdGlvbiBhc2sodWludCB3YWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcm11bCh3YWQsIHdtdWwocGVyKCksIGdhcCkpOwogICAgfQogICAgLy8gRXhpdCBwcmljZSAoZ2VtIHBlciBza3IpCiAgICBmdW5jdGlvbiBiaWQodWludCB3YWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcm11bCh3YWQsIHdtdWwocGVyKCksIHN1YigyICogV0FELCBnYXApKSk7CiAgICB9CiAgICBmdW5jdGlvbiBqb2luKHVpbnQgd2FkKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSghb2ZmKTsKICAgICAgICByZXF1aXJlKGFzayh3YWQpID4gMCk7CiAgICAgICAgcmVxdWlyZShnZW0udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIGFzayh3YWQpKSk7CiAgICAgICAgc2tyLm1pbnQobXNnLnNlbmRlciwgd2FkKTsKICAgIH0KICAgIGZ1bmN0aW9uIGV4aXQodWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKCFvZmYgfHwgb3V0KTsKICAgICAgICByZXF1aXJlKGdlbS50cmFuc2Zlcihtc2cuc2VuZGVyLCBiaWQod2FkKSkpOwogICAgICAgIHNrci5idXJuKG1zZy5zZW5kZXIsIHdhZCk7CiAgICB9CgogICAgLy8tLVN0YWJpbGl0eS1mZWUtYWNjdW11bGF0aW9uLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyBBY2N1bXVsYXRlZCBSYXRlcwogICAgZnVuY3Rpb24gY2hpKCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBkcmlwKCk7CiAgICAgICAgcmV0dXJuIF9jaGk7CiAgICB9CiAgICBmdW5jdGlvbiByaGkoKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIGRyaXAoKTsKICAgICAgICByZXR1cm4gX3JoaTsKICAgIH0KICAgIGZ1bmN0aW9uIGRyaXAoKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgaWYgKG9mZikgcmV0dXJuOwoKICAgICAgICB2YXIgcmhvXyA9IGVyYSgpOwogICAgICAgIHZhciBhZ2UgPSByaG9fIC0gcmhvOwogICAgICAgIGlmIChhZ2UgPT0gMCkgcmV0dXJuOyAgICAvLyBvcHRpbWlzZWQKICAgICAgICByaG8gPSByaG9fOwoKICAgICAgICB2YXIgaW5jID0gUkFZOwoKICAgICAgICBpZiAodGF4ICE9IFJBWSkgeyAgLy8gb3B0aW1pc2VkCiAgICAgICAgICAgIHZhciBfY2hpXyA9IF9jaGk7CiAgICAgICAgICAgIGluYyA9IHJwb3codGF4LCBhZ2UpOwogICAgICAgICAgICBfY2hpID0gcm11bChfY2hpLCBpbmMpOwogICAgICAgICAgICBzYWkubWludCh0YXAsIHJtdWwoc3ViKF9jaGksIF9jaGlfKSwgcnVtKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBvcHRpbWlzZWQKICAgICAgICBpZiAoZmVlICE9IFJBWSkgaW5jID0gcm11bChpbmMsIHJwb3coZmVlLCBhZ2UpKTsKICAgICAgICBpZiAoaW5jICE9IFJBWSkgX3JoaSA9IHJtdWwoX3JoaSwgaW5jKTsKICAgIH0KCgogICAgLy8tLUNEUC1yaXNrLWluZGljYXRvci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyBBYnN0cmFjdGVkIGNvbGxhdGVyYWwgcHJpY2UgKHJlZiBwZXIgc2tyKQogICAgZnVuY3Rpb24gdGFnKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCB3YWQpIHsKICAgICAgICByZXR1cm4gb2ZmID8gZml0IDogd211bChwZXIoKSwgdWludChwaXAucmVhZCgpKSk7CiAgICB9CiAgICAvLyBSZXR1cm5zIHRydWUgaWYgY3VwIGlzIHdlbGwtY29sbGF0ZXJhbGl6ZWQKICAgIGZ1bmN0aW9uIHNhZmUoYnl0ZXMzMiBjdXApIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdmFyIHBybyA9IHJtdWwodGFnKCksIGluayhjdXApKTsKICAgICAgICB2YXIgY29uID0gcm11bCh2b3gucGFyKCksIHRhYihjdXApKTsKICAgICAgICB2YXIgbWluID0gcm11bChjb24sIG1hdCk7CiAgICAgICAgcmV0dXJuIHBybyA+PSBtaW47CiAgICB9CgoKICAgIC8vLS1DRFAtb3BlcmF0aW9ucy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgZnVuY3Rpb24gb3BlbigpIHB1YmxpYyBub3RlIHJldHVybnMgKGJ5dGVzMzIgY3VwKSB7CiAgICAgICAgcmVxdWlyZSghb2ZmKTsKICAgICAgICBjdXBpID0gYWRkKGN1cGksIDEpOwogICAgICAgIGN1cCA9IGJ5dGVzMzIoY3VwaSk7CiAgICAgICAgY3Vwc1tjdXBdLmxhZCA9IG1zZy5zZW5kZXI7CiAgICAgICAgTG9nTmV3Q3VwKG1zZy5zZW5kZXIsIGN1cCk7CiAgICB9CiAgICBmdW5jdGlvbiBnaXZlKGJ5dGVzMzIgY3VwLCBhZGRyZXNzIGd1eSkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjdXBzW2N1cF0ubGFkKTsKICAgICAgICByZXF1aXJlKGd1eSAhPSAwKTsKICAgICAgICBjdXBzW2N1cF0ubGFkID0gZ3V5OwogICAgfQoKICAgIGZ1bmN0aW9uIGxvY2soYnl0ZXMzMiBjdXAsIHVpbnQgd2FkKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSghb2ZmKTsKICAgICAgICBjdXBzW2N1cF0uaW5rID0gYWRkKGN1cHNbY3VwXS5pbmssIHdhZCk7CiAgICAgICAgc2tyLnB1bGwobXNnLnNlbmRlciwgd2FkKTsKICAgICAgICByZXF1aXJlKGN1cHNbY3VwXS5pbmsgPT0gMCB8fCBjdXBzW2N1cF0uaW5rID4gMC4wMDUgZXRoZXIpOwogICAgfQogICAgZnVuY3Rpb24gZnJlZShieXRlczMyIGN1cCwgdWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3Vwc1tjdXBdLmxhZCk7CiAgICAgICAgY3Vwc1tjdXBdLmluayA9IHN1YihjdXBzW2N1cF0uaW5rLCB3YWQpOwogICAgICAgIHNrci5wdXNoKG1zZy5zZW5kZXIsIHdhZCk7CiAgICAgICAgcmVxdWlyZShzYWZlKGN1cCkpOwogICAgICAgIHJlcXVpcmUoY3Vwc1tjdXBdLmluayA9PSAwIHx8IGN1cHNbY3VwXS5pbmsgPiAwLjAwNSBldGhlcik7CiAgICB9CgogICAgZnVuY3Rpb24gZHJhdyhieXRlczMyIGN1cCwgdWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKCFvZmYpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjdXBzW2N1cF0ubGFkKTsKICAgICAgICByZXF1aXJlKHJkaXYod2FkLCBjaGkoKSkgPiAwKTsKCiAgICAgICAgY3Vwc1tjdXBdLmFydCA9IGFkZChjdXBzW2N1cF0uYXJ0LCByZGl2KHdhZCwgY2hpKCkpKTsKICAgICAgICBydW0gPSBhZGQocnVtLCByZGl2KHdhZCwgY2hpKCkpKTsKCiAgICAgICAgY3Vwc1tjdXBdLmlyZSA9IGFkZChjdXBzW2N1cF0uaXJlLCByZGl2KHdhZCwgcmhpKCkpKTsKICAgICAgICBzYWkubWludChjdXBzW2N1cF0ubGFkLCB3YWQpOwoKICAgICAgICByZXF1aXJlKHNhZmUoY3VwKSk7CiAgICAgICAgcmVxdWlyZShzYWkudG90YWxTdXBwbHkoKSA8PSBjYXApOwogICAgfQogICAgZnVuY3Rpb24gd2lwZShieXRlczMyIGN1cCwgdWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKCFvZmYpOwoKICAgICAgICB2YXIgb3dlID0gcm11bCh3YWQsIHJkaXYocmFwKGN1cCksIHRhYihjdXApKSk7CgogICAgICAgIGN1cHNbY3VwXS5hcnQgPSBzdWIoY3Vwc1tjdXBdLmFydCwgcmRpdih3YWQsIGNoaSgpKSk7CiAgICAgICAgcnVtID0gc3ViKHJ1bSwgcmRpdih3YWQsIGNoaSgpKSk7CgogICAgICAgIGN1cHNbY3VwXS5pcmUgPSBzdWIoY3Vwc1tjdXBdLmlyZSwgcmRpdihhZGQod2FkLCBvd2UpLCByaGkoKSkpOwogICAgICAgIHNhaS5idXJuKG1zZy5zZW5kZXIsIHdhZCk7CgogICAgICAgIHZhciAodmFsLCBvaykgPSBwZXAucGVlaygpOwogICAgICAgIGlmIChvayAmJiB2YWwgIT0gMCkgZ292Lm1vdmUobXNnLnNlbmRlciwgcGl0LCB3ZGl2KG93ZSwgdWludCh2YWwpKSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2h1dChieXRlczMyIGN1cCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIW9mZik7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGN1cHNbY3VwXS5sYWQpOwogICAgICAgIGlmICh0YWIoY3VwKSAhPSAwKSB3aXBlKGN1cCwgdGFiKGN1cCkpOwogICAgICAgIGlmIChpbmsoY3VwKSAhPSAwKSBmcmVlKGN1cCwgaW5rKGN1cCkpOwogICAgICAgIGRlbGV0ZSBjdXBzW2N1cF07CiAgICB9CgogICAgZnVuY3Rpb24gYml0ZShieXRlczMyIGN1cCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIXNhZmUoY3VwKSB8fCBvZmYpOwoKICAgICAgICAvLyBUYWtlIG9uIGFsbCBvZiB0aGUgZGVidCwgZXhjZXB0IHVucGFpZCBmZWVzCiAgICAgICAgdmFyIHJ1ZSA9IHRhYihjdXApOwogICAgICAgIHNpbi5taW50KHRhcCwgcnVlKTsKICAgICAgICBydW0gPSBzdWIocnVtLCBjdXBzW2N1cF0uYXJ0KTsKICAgICAgICBjdXBzW2N1cF0uYXJ0ID0gMDsKICAgICAgICBjdXBzW2N1cF0uaXJlID0gMDsKCiAgICAgICAgLy8gQW1vdW50IG93ZWQgaW4gU0tSLCBpbmNsdWRpbmcgbGlxdWlkYXRpb24gcGVuYWx0eQogICAgICAgIHZhciBvd2UgPSByZGl2KHJtdWwocm11bChydWUsIGF4ZSksIHZveC5wYXIoKSksIHRhZygpKTsKCiAgICAgICAgaWYgKG93ZSA+IGN1cHNbY3VwXS5pbmspIHsKICAgICAgICAgICAgb3dlID0gY3Vwc1tjdXBdLmluazsKICAgICAgICB9CgogICAgICAgIHNrci5wdXNoKHRhcCwgb3dlKTsKICAgICAgICBjdXBzW2N1cF0uaW5rID0gc3ViKGN1cHNbY3VwXS5pbmssIG93ZSk7CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICBmdW5jdGlvbiBjYWdlKHVpbnQgZml0XywgdWludCBqYW0pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHJlcXVpcmUoIW9mZiAmJiBmaXRfICE9IDApOwogICAgICAgIG9mZiA9IHRydWU7CiAgICAgICAgYXhlID0gUkFZOwogICAgICAgIGdhcCA9IFdBRDsKICAgICAgICBmaXQgPSBmaXRfOyAgICAgICAgIC8vIHJlZiBwZXIgc2tyCiAgICAgICAgcmVxdWlyZShnZW0udHJhbnNmZXIodGFwLCBqYW0pKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZsb3coKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICByZXF1aXJlKG9mZik7CiAgICAgICAgb3V0ID0gdHJ1ZTsKICAgIH0KfQoKLy8vLy8vIHNyYy90YXAuc29sCi8vLyB0YXAuc29sIC0tIGxpcXVpZGF0aW9uIGVuZ2luZSAoc2VlIGFsc28gYHZvd2ApCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIE5pa29sYWkgTXVzaGVnaWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjkyZmNmYmY5ZmRmZWYzZmJkMmY2ZjNlMmUyZmFlN2YwYmNmMWZkZmYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhbmllbCBCcm9ja21hbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI4YWVlZWJlNGUzZWZlNmNhZWVlYmZhZmFlMmZmZThhNGU5ZTVlNyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgUmFpbiBCcmVhayA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5Y2VlZmRmNWYyZmVlZWY5ZmRmN2RjZWVmNWVmZjllOWVjYjJmMmY5ZTgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjE4OyAqLwoKLyogaW1wb3J0ICIuL3R1Yi5zb2wiOyAqLwoKY29udHJhY3QgU2FpVGFwIGlzIERTVGhpbmcgewogICAgRFNUb2tlbiAgcHVibGljICBzYWk7CiAgICBEU1Rva2VuICBwdWJsaWMgIHNpbjsKICAgIERTVG9rZW4gIHB1YmxpYyAgc2tyOwoKICAgIFNhaVZveCAgIHB1YmxpYyAgdm94OwogICAgU2FpVHViICAgcHVibGljICB0dWI7CgogICAgdWludDI1NiAgcHVibGljICBnYXA7ICAvLyBCb29tLUJ1c3QgU3ByZWFkCiAgICBib29sICAgICBwdWJsaWMgIG9mZjsgIC8vIENhZ2UgZmxhZwogICAgdWludDI1NiAgcHVibGljICBmaXg7ICAvLyBDYWdlIHByaWNlCgogICAgLy8gU3VycGx1cwogICAgZnVuY3Rpb24gam95KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzYWkuYmFsYW5jZU9mKHRoaXMpOwogICAgfQogICAgLy8gQmFkIGRlYnQKICAgIGZ1bmN0aW9uIHdvZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gc2luLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KICAgIC8vIENvbGxhdGVyYWwgcGVuZGluZyBsaXF1aWRhdGlvbgogICAgZnVuY3Rpb24gZm9nKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBza3IuYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKCiAgICBmdW5jdGlvbiBTYWlUYXAoU2FpVHViIHR1Yl8pIHB1YmxpYyB7CiAgICAgICAgdHViID0gdHViXzsKCiAgICAgICAgc2FpID0gdHViLnNhaSgpOwogICAgICAgIHNpbiA9IHR1Yi5zaW4oKTsKICAgICAgICBza3IgPSB0dWIuc2tyKCk7CgogICAgICAgIHZveCA9IHR1Yi52b3goKTsKCiAgICAgICAgZ2FwID0gV0FEOwogICAgfQoKICAgIGZ1bmN0aW9uIG1vbGQoYnl0ZXMzMiBwYXJhbSwgdWludCB2YWwpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIGlmIChwYXJhbSA9PSAnZ2FwJykgZ2FwID0gdmFsOwogICAgfQoKICAgIC8vIENhbmNlbCBkZWJ0CiAgICBmdW5jdGlvbiBoZWFsKCkgcHVibGljIG5vdGUgewogICAgICAgIGlmIChqb3koKSA9PSAwIHx8IHdvZSgpID09IDApIHJldHVybjsgIC8vIG9wdGltaXNlZAogICAgICAgIHZhciB3YWQgPSBtaW4oam95KCksIHdvZSgpKTsKICAgICAgICBzYWkuYnVybih3YWQpOwogICAgICAgIHNpbi5idXJuKHdhZCk7CiAgICB9CgogICAgLy8gRmVlZCBwcmljZSAoc2FpIHBlciBza3IpCiAgICBmdW5jdGlvbiBzMnMoKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHZhciB0YWcgPSB0dWIudGFnKCk7ICAgIC8vIHJlZiBwZXIgc2tyCiAgICAgICAgdmFyIHBhciA9IHZveC5wYXIoKTsgICAgLy8gcmVmIHBlciBzYWkKICAgICAgICByZXR1cm4gcmRpdih0YWcsIHBhcik7ICAvLyBzYWkgcGVyIHNrcgogICAgfQogICAgLy8gQm9vbSBwcmljZSAoc2FpIHBlciBza3IpCiAgICBmdW5jdGlvbiBiaWQodWludCB3YWQpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJtdWwod2FkLCB3bXVsKHMycygpLCBzdWIoMiAqIFdBRCwgZ2FwKSkpOwogICAgfQogICAgLy8gQnVzdCBwcmljZSAoc2FpIHBlciBza3IpCiAgICBmdW5jdGlvbiBhc2sodWludCB3YWQpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJtdWwod2FkLCB3bXVsKHMycygpLCBnYXApKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZsaXAodWludCB3YWQpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKGFzayh3YWQpID4gMCk7CiAgICAgICAgc2tyLnB1c2gobXNnLnNlbmRlciwgd2FkKTsKICAgICAgICBzYWkucHVsbChtc2cuc2VuZGVyLCBhc2sod2FkKSk7CiAgICAgICAgaGVhbCgpOwogICAgfQogICAgZnVuY3Rpb24gZmxvcCh1aW50IHdhZCkgaW50ZXJuYWwgewogICAgICAgIHNrci5taW50KHN1Yih3YWQsIGZvZygpKSk7CiAgICAgICAgZmxpcCh3YWQpOwogICAgICAgIHJlcXVpcmUoam95KCkgPT0gMCk7ICAvLyBjYW4ndCBmbG9wIGludG8gc3VycGx1cwogICAgfQogICAgZnVuY3Rpb24gZmxhcCh1aW50IHdhZCkgaW50ZXJuYWwgewogICAgICAgIGhlYWwoKTsKICAgICAgICBzYWkucHVzaChtc2cuc2VuZGVyLCBiaWQod2FkKSk7CiAgICAgICAgc2tyLmJ1cm4obXNnLnNlbmRlciwgd2FkKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJ1c3QodWludCB3YWQpIHB1YmxpYyBub3RlIHsKICAgICAgICByZXF1aXJlKCFvZmYpOwogICAgICAgIGlmICh3YWQgPiBmb2coKSkgZmxvcCh3YWQpOwogICAgICAgIGVsc2UgZmxpcCh3YWQpOwogICAgfQogICAgZnVuY3Rpb24gYm9vbSh1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUoIW9mZik7CiAgICAgICAgZmxhcCh3YWQpOwogICAgfQoKICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgZnVuY3Rpb24gY2FnZSh1aW50IGZpeF8pIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHJlcXVpcmUoIW9mZik7CiAgICAgICAgb2ZmID0gdHJ1ZTsKICAgICAgICBmaXggPSBmaXhfOwogICAgfQogICAgZnVuY3Rpb24gY2FzaCh1aW50IHdhZCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUob2ZmKTsKICAgICAgICBzYWkuYnVybihtc2cuc2VuZGVyLCB3YWQpOwogICAgICAgIHJlcXVpcmUodHViLmdlbSgpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHJtdWwod2FkLCBmaXgpKSk7CiAgICB9CiAgICBmdW5jdGlvbiBtb2NrKHVpbnQgd2FkKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZShvZmYpOwogICAgICAgIHNhaS5taW50KG1zZy5zZW5kZXIsIHdhZCk7CiAgICAgICAgcmVxdWlyZSh0dWIuZ2VtKCkudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIHJtdWwod2FkLCBmaXgpKSk7CiAgICB9CiAgICBmdW5jdGlvbiB2ZW50KCkgcHVibGljIG5vdGUgewogICAgICAgIHJlcXVpcmUob2ZmKTsKICAgICAgICBza3IuYnVybihmb2coKSk7CiAgICB9Cn0KCi8vLy8vLyBzcmMvdG9wLnNvbAovLy8gdG9wLnNvbCAtLSBnbG9iYWwgc2V0dGxlbWVudCBtYW5hZ2VyCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIE5pa29sYWkgTXVzaGVnaWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjE4NzY3MTczNzc3NDc5NzE1ODdjNzk2ODY4NzA2ZDdhMzY3Yjc3NzUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhbmllbCBCcm9ja21hbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlMTg1ODA4Zjg4ODQ4ZGExODU4MDkxOTE4OTk0ODNjZjgyOGU4YyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgUmFpbiBCcmVhayA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIyYTU4NGI0MzQ0NDg1ODRmNGI0MTZhNTg0MzU5NGY1ZjVhMDQ0NDRmNWUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjE4OyAqLwoKLyogaW1wb3J0ICIuL3R1Yi5zb2wiOyAqLwovKiBpbXBvcnQgIi4vdGFwLnNvbCI7ICovCgpjb250cmFjdCBTYWlUb3AgaXMgRFNUaGluZyB7CiAgICBTYWlWb3ggICBwdWJsaWMgIHZveDsKICAgIFNhaVR1YiAgIHB1YmxpYyAgdHViOwogICAgU2FpVGFwICAgcHVibGljICB0YXA7CgogICAgRFNUb2tlbiAgcHVibGljICBzYWk7CiAgICBEU1Rva2VuICBwdWJsaWMgIHNpbjsKICAgIERTVG9rZW4gIHB1YmxpYyAgc2tyOwogICAgRVJDMjAgICAgcHVibGljICBnZW07CgogICAgdWludDI1NiAgcHVibGljICBmaXg7ICAvLyBzYWkgY2FnZSBwcmljZSAoZ2VtIHBlciBzYWkpCiAgICB1aW50MjU2ICBwdWJsaWMgIGZpdDsgIC8vIHNrciBjYWdlIHByaWNlIChyZWYgcGVyIHNrcikKICAgIHVpbnQyNTYgIHB1YmxpYyAgY2FnZWQ7CiAgICB1aW50MjU2ICBwdWJsaWMgIGNvb2xkb3duID0gNiBob3VyczsKCiAgICBmdW5jdGlvbiBTYWlUb3AoU2FpVHViIHR1Yl8sIFNhaVRhcCB0YXBfKSBwdWJsaWMgewogICAgICAgIHR1YiA9IHR1Yl87CiAgICAgICAgdGFwID0gdGFwXzsKCiAgICAgICAgdm94ID0gdHViLnZveCgpOwoKICAgICAgICBzYWkgPSB0dWIuc2FpKCk7CiAgICAgICAgc2luID0gdHViLnNpbigpOwogICAgICAgIHNrciA9IHR1Yi5za3IoKTsKICAgICAgICBnZW0gPSB0dWIuZ2VtKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZXJhKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBibG9jay50aW1lc3RhbXA7CiAgICB9CgogICAgLy8gZm9yY2Ugc2V0dGxlbWVudCBvZiB0aGUgc3lzdGVtIGF0IGEgZ2l2ZW4gcHJpY2UgKHNhaSBwZXIgZ2VtKS4KICAgIC8vIFRoaXMgaXMgbmVhcmx5IHRoZSBlcXVpdmFsZW50IG9mIGJpdGluZyBhbGwgY3VwcyBhdCBvbmNlLgogICAgLy8gSW1wb3J0YW50IGNvbnNpZGVyYXRpb246IHRoZSBnZW1zIGFzc29jaWF0ZWQgd2l0aCBmcmVlIHNrciBjYW4KICAgIC8vIGJlIHRhcHBlZCB0byBtYWtlIHNhaSB3aG9sZS4KICAgIGZ1bmN0aW9uIGNhZ2UodWludCBwcmljZSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoIXR1Yi5vZmYoKSAmJiBwcmljZSAhPSAwKTsKICAgICAgICBjYWdlZCA9IGVyYSgpOwoKICAgICAgICB0dWIuZHJpcCgpOyAgLy8gY29sbGVjdCByZW1haW5pbmcgZmVlcwogICAgICAgIHRhcC5oZWFsKCk7ICAvLyBhYnNvcmIgYW55IHBlbmRpbmcgZmVlcwoKICAgICAgICBmaXQgPSBybXVsKHdtdWwocHJpY2UsIHZveC5wYXIoKSksIHR1Yi5wZXIoKSk7CiAgICAgICAgLy8gTW9zdCBnZW1zIHdlIGNhbiBnZXQgcGVyIHNhaSBpcyB0aGUgZnVsbCBiYWxhbmNlIG9mIHRoZSB0dWIuCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gc2FpIGlzc3VlZCwgd2Ugc2hvdWxkIHN0aWxsIGJlIGFibGUgdG8gY2FnZS4KICAgICAgICBpZiAoc2FpLnRvdGFsU3VwcGx5KCkgPT0gMCkgewogICAgICAgICAgICBmaXggPSByZGl2KFdBRCwgcHJpY2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpeCA9IG1pbihyZGl2KFdBRCwgcHJpY2UpLCByZGl2KHR1Yi5waWUoKSwgc2FpLnRvdGFsU3VwcGx5KCkpKTsKICAgICAgICB9CgogICAgICAgIHR1Yi5jYWdlKGZpdCwgcm11bChmaXgsIHNhaS50b3RhbFN1cHBseSgpKSk7CiAgICAgICAgdGFwLmNhZ2UoZml4KTsKCiAgICAgICAgdGFwLnZlbnQoKTsgICAgLy8gYnVybiBwZW5kaW5nIHNhbGUgc2tyCiAgICB9CiAgICAvLyBjYWdlIGJ5IHJlYWRpbmcgdGhlIGxhc3QgdmFsdWUgZnJvbSB0aGUgZmVlZCBmb3IgdGhlIHByaWNlCiAgICBmdW5jdGlvbiBjYWdlKCkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgY2FnZShyZGl2KHVpbnQodHViLnBpcCgpLnJlYWQoKSksIHZveC5wYXIoKSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZsb3coKSBwdWJsaWMgbm90ZSB7CiAgICAgICAgcmVxdWlyZSh0dWIub2ZmKCkpOwogICAgICAgIHZhciBlbXB0eSA9IHR1Yi5kaW4oKSA9PSAwICYmIHRhcC5mb2coKSA9PSAwOwogICAgICAgIHZhciBlbmRlZCA9IGVyYSgpID4gY2FnZWQgKyBjb29sZG93bjsKICAgICAgICByZXF1aXJlKGVtcHR5IHx8IGVuZGVkKTsKICAgICAgICB0dWIuZmxvdygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvb2xkb3duKHVpbnQgY29vbGRvd25fKSBwdWJsaWMgYXV0aCB7CiAgICAgICAgY29vbGRvd24gPSBjb29sZG93bl87CiAgICB9Cn0KCi8vLy8vLyBzcmMvbW9tLnNvbAovLy8gbW9tLnNvbCAtLSBhZG1pbiBtYW5hZ2VyCgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIE5pa29sYWkgTXVzaGVnaWFuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjdkMTMxNDE2MTIxMTFjMTQzZDE5MWMwZDBkMTUwODFmNTMxZTEyMTAiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLyBDb3B5cmlnaHQgKEMpIDIwMTcgIERhbmllbCBCcm9ja21hbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1NjMyMzczODNmMzMzYTE2MzIzNzI2MjYzZTIzMzQ3ODM1MzkzYiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vIENvcHlyaWdodCAoQykgMjAxNyAgUmFpbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0YjM5MmEyMjI1MjkzOTJlMmEyMDBiMzkyMjM4MmUzZTNiNjUyNTJlM2YiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKLy8gVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLy8gaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKLy8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKLy8gKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCi8vIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi8vIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgovLyBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQovLyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KCi8qIHByYWdtYSBzb2xpZGl0eSBeMC40LjE4OyAqLwoKLyogaW1wb3J0ICdkcy10aGluZy90aGluZy5zb2wnOyAqLwovKiBpbXBvcnQgJy4vdHViLnNvbCc7ICovCi8qIGltcG9ydCAnLi90b3Auc29sJzsgKi8KLyogaW1wb3J0ICcuL3RhcC5zb2wnOyAqLwoKY29udHJhY3QgU2FpTW9tIGlzIERTVGhpbmcgewogICAgU2FpVHViICBwdWJsaWMgIHR1YjsKICAgIFNhaVRhcCAgcHVibGljICB0YXA7CiAgICBTYWlWb3ggIHB1YmxpYyAgdm94OwoKICAgIGZ1bmN0aW9uIFNhaU1vbShTYWlUdWIgdHViXywgU2FpVGFwIHRhcF8sIFNhaVZveCB2b3hfKSBwdWJsaWMgewogICAgICAgIHR1YiA9IHR1Yl87CiAgICAgICAgdGFwID0gdGFwXzsKICAgICAgICB2b3ggPSB2b3hfOwogICAgfQogICAgLy8gRGVidCBjZWlsaW5nCiAgICBmdW5jdGlvbiBzZXRDYXAodWludCB3YWQpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHR1Yi5tb2xkKCJjYXAiLCB3YWQpOwogICAgfQogICAgLy8gTGlxdWlkYXRpb24gcmF0aW8KICAgIGZ1bmN0aW9uIHNldE1hdCh1aW50IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdHViLm1vbGQoIm1hdCIsIHJheSk7CiAgICAgICAgdmFyIGF4ZSA9IHR1Yi5heGUoKTsKICAgICAgICB2YXIgbWF0ID0gdHViLm1hdCgpOwogICAgICAgIHJlcXVpcmUoYXhlID49IFJBWSAmJiBheGUgPD0gbWF0KTsKICAgIH0KICAgIC8vIFN0YWJpbGl0eSBmZWUKICAgIGZ1bmN0aW9uIHNldFRheCh1aW50IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdHViLm1vbGQoInRheCIsIHJheSk7CiAgICAgICAgdmFyIHRheCA9IHR1Yi50YXgoKTsKICAgICAgICByZXF1aXJlKFJBWSA8PSB0YXgpOwogICAgICAgIHJlcXVpcmUodGF4IDwgMTAwMDIgKiAxMCAqKiAyMyk7ICAvLyB+MjAwJSBwZXIgaG91cgogICAgfQogICAgLy8gR292ZXJuYW5jZSBmZWUKICAgIGZ1bmN0aW9uIHNldEZlZSh1aW50IHJheSkgcHVibGljIG5vdGUgYXV0aCB7CiAgICAgICAgdHViLm1vbGQoImZlZSIsIHJheSk7CiAgICAgICAgdmFyIGZlZSA9IHR1Yi5mZWUoKTsKICAgICAgICByZXF1aXJlKFJBWSA8PSBmZWUpOwogICAgICAgIHJlcXVpcmUoZmVlIDwgMTAwMDIgKiAxMCAqKiAyMyk7ICAvLyB+MjAwJSBwZXIgaG91cgogICAgfQogICAgLy8gTGlxdWlkYXRpb24gZmVlCiAgICBmdW5jdGlvbiBzZXRBeGUodWludCByYXkpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHR1Yi5tb2xkKCJheGUiLCByYXkpOwogICAgICAgIHZhciBheGUgPSB0dWIuYXhlKCk7CiAgICAgICAgdmFyIG1hdCA9IHR1Yi5tYXQoKTsKICAgICAgICByZXF1aXJlKGF4ZSA+PSBSQVkgJiYgYXhlIDw9IG1hdCk7CiAgICB9CiAgICAvLyBKb2luL0V4aXQgU3ByZWFkCiAgICBmdW5jdGlvbiBzZXRUdWJHYXAodWludCB3YWQpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHR1Yi5tb2xkKCJnYXAiLCB3YWQpOwogICAgfQogICAgLy8gRVRIL1VTRCBGZWVkCiAgICBmdW5jdGlvbiBzZXRQaXAoRFNWYWx1ZSBwaXBfKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0dWIuc2V0UGlwKHBpcF8pOwogICAgfQogICAgLy8gTUtSL1VTRCBGZWVkCiAgICBmdW5jdGlvbiBzZXRQZXAoRFNWYWx1ZSBwZXBfKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0dWIuc2V0UGVwKHBlcF8pOwogICAgfQogICAgLy8gVFJGTQogICAgZnVuY3Rpb24gc2V0Vm94KFNhaVZveCB2b3hfKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0dWIuc2V0Vm94KHZveF8pOwogICAgfQogICAgLy8gQm9vbS9CdXN0IFNwcmVhZAogICAgZnVuY3Rpb24gc2V0VGFwR2FwKHVpbnQgd2FkKSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICB0YXAubW9sZCgiZ2FwIiwgd2FkKTsKICAgICAgICB2YXIgZ2FwID0gdGFwLmdhcCgpOwogICAgICAgIHJlcXVpcmUoZ2FwIDw9IDEuMDUgZXRoZXIpOwogICAgICAgIHJlcXVpcmUoZ2FwID49IDAuOTUgZXRoZXIpOwogICAgfQogICAgLy8gUmF0ZSBvZiBjaGFuZ2Ugb2YgdGFyZ2V0IHByaWNlIChwZXIgc2Vjb25kKQogICAgZnVuY3Rpb24gc2V0V2F5KHVpbnQgcmF5KSBwdWJsaWMgbm90ZSBhdXRoIHsKICAgICAgICByZXF1aXJlKHJheSA8IDEwMDAyICogMTAgKiogMjMpOyAgLy8gfjIwMCUgcGVyIGhvdXIKICAgICAgICByZXF1aXJlKHJheSA+IDk5OTggKiAxMCAqKiAyMyk7CiAgICAgICAgdm94Lm1vbGQoIndheSIsIHJheSk7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRIb3codWludCByYXkpIHB1YmxpYyBub3RlIGF1dGggewogICAgICAgIHZveC50dW5lKHJheSk7CiAgICB9Cn0KCi8vLy8vLyBzcmMvZmFiLnNvbAovKiBwcmFnbWEgc29saWRpdHkgXjAuNC4xODsgKi8KCi8qIGltcG9ydCAiZHMtYXV0aC9hdXRoLnNvbCI7ICovCi8qIGltcG9ydCAnZHMtdG9rZW4vdG9rZW4uc29sJzsgKi8KLyogaW1wb3J0ICdkcy1ndWFyZC9ndWFyZC5zb2wnOyAqLwovKiBpbXBvcnQgJ2RzLXJvbGVzL3JvbGVzLnNvbCc7ICovCi8qIGltcG9ydCAnZHMtdmFsdWUvdmFsdWUuc29sJzsgKi8KCi8qIGltcG9ydCAnLi9tb20uc29sJzsgKi8KCmNvbnRyYWN0IEdlbUZhYiB7CiAgICBmdW5jdGlvbiBuZXdUb2soYnl0ZXMzMiBuYW1lKSBwdWJsaWMgcmV0dXJucyAoRFNUb2tlbiB0b2tlbikgewogICAgICAgIHRva2VuID0gbmV3IERTVG9rZW4obmFtZSk7CiAgICAgICAgdG9rZW4uc2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9Cn0KCmNvbnRyYWN0IFZveEZhYiB7CiAgICBmdW5jdGlvbiBuZXdWb3goKSBwdWJsaWMgcmV0dXJucyAoU2FpVm94IHZveCkgewogICAgICAgIHZveCA9IG5ldyBTYWlWb3goMTAgKiogMjcpOwogICAgICAgIHZveC5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgIH0KfQoKY29udHJhY3QgVHViRmFiIHsKICAgIGZ1bmN0aW9uIG5ld1R1YihEU1Rva2VuIHNhaSwgRFNUb2tlbiBzaW4sIERTVG9rZW4gc2tyLCBFUkMyMCBnZW0sIERTVG9rZW4gZ292LCBEU1ZhbHVlIHBpcCwgRFNWYWx1ZSBwZXAsIFNhaVZveCB2b3gsIGFkZHJlc3MgcGl0KSBwdWJsaWMgcmV0dXJucyAoU2FpVHViIHR1YikgewogICAgICAgIHR1YiA9IG5ldyBTYWlUdWIoc2FpLCBzaW4sIHNrciwgZ2VtLCBnb3YsIHBpcCwgcGVwLCB2b3gsIHBpdCk7CiAgICAgICAgdHViLnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgfQp9Cgpjb250cmFjdCBUYXBGYWIgewogICAgZnVuY3Rpb24gbmV3VGFwKFNhaVR1YiB0dWIpIHB1YmxpYyByZXR1cm5zIChTYWlUYXAgdGFwKSB7CiAgICAgICAgdGFwID0gbmV3IFNhaVRhcCh0dWIpOwogICAgICAgIHRhcC5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgIH0KfQoKY29udHJhY3QgVG9wRmFiIHsKICAgIGZ1bmN0aW9uIG5ld1RvcChTYWlUdWIgdHViLCBTYWlUYXAgdGFwKSBwdWJsaWMgcmV0dXJucyAoU2FpVG9wIHRvcCkgewogICAgICAgIHRvcCA9IG5ldyBTYWlUb3AodHViLCB0YXApOwogICAgICAgIHRvcC5zZXRPd25lcihtc2cuc2VuZGVyKTsKICAgIH0KfQoKY29udHJhY3QgTW9tRmFiIHsKICAgIGZ1bmN0aW9uIG5ld01vbShTYWlUdWIgdHViLCBTYWlUYXAgdGFwLCBTYWlWb3ggdm94KSBwdWJsaWMgcmV0dXJucyAoU2FpTW9tIG1vbSkgewogICAgICAgIG1vbSA9IG5ldyBTYWlNb20odHViLCB0YXAsIHZveCk7CiAgICAgICAgbW9tLnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgfQp9Cgpjb250cmFjdCBEYWRGYWIgewogICAgZnVuY3Rpb24gbmV3RGFkKCkgcHVibGljIHJldHVybnMgKERTR3VhcmQgZGFkKSB7CiAgICAgICAgZGFkID0gbmV3IERTR3VhcmQoKTsKICAgICAgICBkYWQuc2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9Cn0KCmNvbnRyYWN0IERhaUZhYiBpcyBEU0F1dGggewogICAgR2VtRmFiIHB1YmxpYyBnZW1GYWI7CiAgICBWb3hGYWIgcHVibGljIHZveEZhYjsKICAgIFRhcEZhYiBwdWJsaWMgdGFwRmFiOwogICAgVHViRmFiIHB1YmxpYyB0dWJGYWI7CiAgICBUb3BGYWIgcHVibGljIHRvcEZhYjsKICAgIE1vbUZhYiBwdWJsaWMgbW9tRmFiOwogICAgRGFkRmFiIHB1YmxpYyBkYWRGYWI7CgogICAgRFNUb2tlbiBwdWJsaWMgc2FpOwogICAgRFNUb2tlbiBwdWJsaWMgc2luOwogICAgRFNUb2tlbiBwdWJsaWMgc2tyOwoKICAgIFNhaVZveCBwdWJsaWMgdm94OwogICAgU2FpVHViIHB1YmxpYyB0dWI7CiAgICBTYWlUYXAgcHVibGljIHRhcDsKICAgIFNhaVRvcCBwdWJsaWMgdG9wOwoKICAgIFNhaU1vbSBwdWJsaWMgbW9tOwogICAgRFNHdWFyZCBwdWJsaWMgZGFkOwoKICAgIHVpbnQ4IHB1YmxpYyBzdGVwID0gMDsKCiAgICBmdW5jdGlvbiBEYWlGYWIoR2VtRmFiIGdlbUZhYl8sIFZveEZhYiB2b3hGYWJfLCBUdWJGYWIgdHViRmFiXywgVGFwRmFiIHRhcEZhYl8sIFRvcEZhYiB0b3BGYWJfLCBNb21GYWIgbW9tRmFiXywgRGFkRmFiIGRhZEZhYl8pIHB1YmxpYyB7CiAgICAgICAgZ2VtRmFiID0gZ2VtRmFiXzsKICAgICAgICB2b3hGYWIgPSB2b3hGYWJfOwogICAgICAgIHR1YkZhYiA9IHR1YkZhYl87CiAgICAgICAgdGFwRmFiID0gdGFwRmFiXzsKICAgICAgICB0b3BGYWIgPSB0b3BGYWJfOwogICAgICAgIG1vbUZhYiA9IG1vbUZhYl87CiAgICAgICAgZGFkRmFiID0gZGFkRmFiXzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlVG9rZW5zKCkgcHVibGljIGF1dGggewogICAgICAgIHJlcXVpcmUoc3RlcCA9PSAwKTsKICAgICAgICBzYWkgPSBnZW1GYWIubmV3VG9rKCdzYWknKTsKICAgICAgICBzaW4gPSBnZW1GYWIubmV3VG9rKCdzaW4nKTsKICAgICAgICBza3IgPSBnZW1GYWIubmV3VG9rKCdza3InKTsKICAgICAgICBzdGVwICs9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZVZveFR1YihFUkMyMCBnZW0sIERTVG9rZW4gZ292LCBEU1ZhbHVlIHBpcCwgRFNWYWx1ZSBwZXAsIGFkZHJlc3MgcGl0KSBwdWJsaWMgYXV0aCB7CiAgICAgICAgcmVxdWlyZShzdGVwID09IDEpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhnZW0pICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGdvdikgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MocGlwKSAhPSAweDApOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhwZXApICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShwaXQgIT0gMHgwKTsKICAgICAgICB2b3ggPSB2b3hGYWIubmV3Vm94KCk7CiAgICAgICAgdHViID0gdHViRmFiLm5ld1R1YihzYWksIHNpbiwgc2tyLCBnZW0sIGdvdiwgcGlwLCBwZXAsIHZveCwgcGl0KTsKICAgICAgICBzdGVwICs9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZVRhcFRvcCgpIHB1YmxpYyBhdXRoIHsKICAgICAgICByZXF1aXJlKHN0ZXAgPT0gMik7CiAgICAgICAgdGFwID0gdGFwRmFiLm5ld1RhcCh0dWIpOwogICAgICAgIHR1Yi50dXJuKHRhcCk7CiAgICAgICAgdG9wID0gdG9wRmFiLm5ld1RvcCh0dWIsIHRhcCk7CiAgICAgICAgc3RlcCArPSAxOwogICAgfQoKICAgIGZ1bmN0aW9uIFMoc3RyaW5nIHMpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXM0KSB7CiAgICAgICAgcmV0dXJuIGJ5dGVzNChrZWNjYWsyNTYocykpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJheSh1aW50MjU2IHdhZCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHdhZCAqIDEwICoqIDk7CiAgICB9CgogICAgLy8gTGlxdWlkYXRpb24gUmF0aW8gICAxNTAlCiAgICAvLyBMaXF1aWRhdGlvbiBQZW5hbHR5IDEzJQogICAgLy8gU3RhYmlsaXR5IEZlZSAgICAgICAwLjA1JQogICAgLy8gUEVUSCBGZWUgICAgICAgICAgICAwJQogICAgLy8gQm9vbS9CdXN0IFNwcmVhZCAgIC0zJQogICAgLy8gSm9pbi9FeGl0IFNwcmVhZCAgICAwJQogICAgLy8gRGVidCBDZWlsaW5nICAgICAgICAwCiAgICBmdW5jdGlvbiBjb25maWdQYXJhbXMoKSBwdWJsaWMgYXV0aCB7CiAgICAgICAgcmVxdWlyZShzdGVwID09IDMpOwoKICAgICAgICB0dWIubW9sZCgiY2FwIiwgMCk7CiAgICAgICAgdHViLm1vbGQoIm1hdCIsIHJheSgxLjUgIGV0aGVyKSk7CiAgICAgICAgdHViLm1vbGQoImF4ZSIsIHJheSgxLjEzIGV0aGVyKSk7CiAgICAgICAgdHViLm1vbGQoImZlZSIsIDEwMDAwMDAwMDAxNTgxNTM5MDM4Mzc5NDYyNTcpOyAgLy8gMC41JSAvIHllYXIKICAgICAgICB0dWIubW9sZCgidGF4IiwgcmF5KDEgZXRoZXIpKTsKICAgICAgICB0dWIubW9sZCgiZ2FwIiwgMSBldGhlcik7CgogICAgICAgIHRhcC5tb2xkKCJnYXAiLCAwLjk3IGV0aGVyKTsKCiAgICAgICAgc3RlcCArPSAxOwogICAgfQoKICAgIGZ1bmN0aW9uIHZlcmlmeVBhcmFtcygpIHB1YmxpYyBhdXRoIHsKICAgICAgICByZXF1aXJlKHN0ZXAgPT0gNCk7CgogICAgICAgIHJlcXVpcmUodHViLmNhcCgpID09IDApOwogICAgICAgIHJlcXVpcmUodHViLm1hdCgpID09IDE1MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIHJlcXVpcmUodHViLmF4ZSgpID09IDExMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIHJlcXVpcmUodHViLmZlZSgpID09IDEwMDAwMDAwMDAxNTgxNTM5MDM4Mzc5NDYyNTcpOwogICAgICAgIHJlcXVpcmUodHViLnRheCgpID09IDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIHJlcXVpcmUodHViLmdhcCgpID09IDEwMDAwMDAwMDAwMDAwMDAwMDApOwoKICAgICAgICByZXF1aXJlKHRhcC5nYXAoKSA9PSA5NzAwMDAwMDAwMDAwMDAwMDApOwoKICAgICAgICByZXF1aXJlKHZveC5wYXIoKSA9PSAxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICByZXF1aXJlKHZveC5ob3coKSA9PSAwKTsKCiAgICAgICAgc3RlcCArPSAxOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbmZpZ0F1dGgoRFNBdXRob3JpdHkgYXV0aG9yaXR5KSBwdWJsaWMgYXV0aCB7CiAgICAgICAgcmVxdWlyZShzdGVwID09IDUpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhhdXRob3JpdHkpICE9IDB4MCk7CgogICAgICAgIG1vbSA9IG1vbUZhYi5uZXdNb20odHViLCB0YXAsIHZveCk7CiAgICAgICAgZGFkID0gZGFkRmFiLm5ld0RhZCgpOwoKICAgICAgICB2b3guc2V0QXV0aG9yaXR5KGRhZCk7CiAgICAgICAgdm94LnNldE93bmVyKDApOwogICAgICAgIHR1Yi5zZXRBdXRob3JpdHkoZGFkKTsKICAgICAgICB0dWIuc2V0T3duZXIoMCk7CiAgICAgICAgdGFwLnNldEF1dGhvcml0eShkYWQpOwogICAgICAgIHRhcC5zZXRPd25lcigwKTsKICAgICAgICBzYWkuc2V0QXV0aG9yaXR5KGRhZCk7CiAgICAgICAgc2FpLnNldE93bmVyKDApOwogICAgICAgIHNpbi5zZXRBdXRob3JpdHkoZGFkKTsKICAgICAgICBzaW4uc2V0T3duZXIoMCk7CiAgICAgICAgc2tyLnNldEF1dGhvcml0eShkYWQpOwogICAgICAgIHNrci5zZXRPd25lcigwKTsKCiAgICAgICAgdG9wLnNldEF1dGhvcml0eShhdXRob3JpdHkpOwogICAgICAgIHRvcC5zZXRPd25lcigwKTsKICAgICAgICBtb20uc2V0QXV0aG9yaXR5KGF1dGhvcml0eSk7CiAgICAgICAgbW9tLnNldE93bmVyKDApOwoKICAgICAgICBkYWQucGVybWl0KHRvcCwgdHViLCBTKCJjYWdlKHVpbnQyNTYsdWludDI1NikiKSk7CiAgICAgICAgZGFkLnBlcm1pdCh0b3AsIHR1YiwgUygiZmxvdygpIikpOwogICAgICAgIGRhZC5wZXJtaXQodG9wLCB0YXAsIFMoImNhZ2UodWludDI1NikiKSk7CgogICAgICAgIGRhZC5wZXJtaXQodHViLCBza3IsIFMoJ21pbnQoYWRkcmVzcyx1aW50MjU2KScpKTsKICAgICAgICBkYWQucGVybWl0KHR1Yiwgc2tyLCBTKCdidXJuKGFkZHJlc3MsdWludDI1NiknKSk7CgogICAgICAgIGRhZC5wZXJtaXQodHViLCBzYWksIFMoJ21pbnQoYWRkcmVzcyx1aW50MjU2KScpKTsKICAgICAgICBkYWQucGVybWl0KHR1Yiwgc2FpLCBTKCdidXJuKGFkZHJlc3MsdWludDI1NiknKSk7CgogICAgICAgIGRhZC5wZXJtaXQodHViLCBzaW4sIFMoJ21pbnQoYWRkcmVzcyx1aW50MjU2KScpKTsKCiAgICAgICAgZGFkLnBlcm1pdCh0YXAsIHNhaSwgUygnbWludChhZGRyZXNzLHVpbnQyNTYpJykpOwogICAgICAgIGRhZC5wZXJtaXQodGFwLCBzYWksIFMoJ2J1cm4oYWRkcmVzcyx1aW50MjU2KScpKTsKICAgICAgICBkYWQucGVybWl0KHRhcCwgc2FpLCBTKCdidXJuKHVpbnQyNTYpJykpOwogICAgICAgIGRhZC5wZXJtaXQodGFwLCBzaW4sIFMoJ2J1cm4odWludDI1NiknKSk7CgogICAgICAgIGRhZC5wZXJtaXQodGFwLCBza3IsIFMoJ21pbnQodWludDI1NiknKSk7CiAgICAgICAgZGFkLnBlcm1pdCh0YXAsIHNrciwgUygnYnVybih1aW50MjU2KScpKTsKICAgICAgICBkYWQucGVybWl0KHRhcCwgc2tyLCBTKCdidXJuKGFkZHJlc3MsdWludDI1NiknKSk7CgogICAgICAgIGRhZC5wZXJtaXQobW9tLCB2b3gsIFMoIm1vbGQoYnl0ZXMzMix1aW50MjU2KSIpKTsKICAgICAgICBkYWQucGVybWl0KG1vbSwgdm94LCBTKCJ0dW5lKHVpbnQyNTYpIikpOwogICAgICAgIGRhZC5wZXJtaXQobW9tLCB0dWIsIFMoIm1vbGQoYnl0ZXMzMix1aW50MjU2KSIpKTsKICAgICAgICBkYWQucGVybWl0KG1vbSwgdGFwLCBTKCJtb2xkKGJ5dGVzMzIsdWludDI1NikiKSk7CiAgICAgICAgZGFkLnBlcm1pdChtb20sIHR1YiwgUygic2V0UGlwKGFkZHJlc3MpIikpOwogICAgICAgIGRhZC5wZXJtaXQobW9tLCB0dWIsIFMoInNldFBlcChhZGRyZXNzKSIpKTsKICAgICAgICBkYWQucGVybWl0KG1vbSwgdHViLCBTKCJzZXRWb3goYWRkcmVzcykiKSk7CgogICAgICAgIGRhZC5zZXRPd25lcigwKTsKICAgICAgICBzdGVwICs9IDE7CiAgICB9Cn0='.
	

]
