Class {
	#name : #SRTf70a642bd387f94380ffb90451c2c81d4eb82cbc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf70a642bd387f94380ffb90451c2c81d4eb82cbc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCmNvbnRyYWN0IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUgewogICAgZnVuY3Rpb24gc3RhcnREYXRlKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KICAgIGZ1bmN0aW9uIGVuZGVkQXQoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7fQogICAgZnVuY3Rpb24gaXNFbmRlZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdG90YWxSYWlzZWRBbW91bnRJbkNueSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnkoYWRkcmVzcyBwdXJjaGFzZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkVwQnkoYWRkcmVzcyBwdXJjaGFzZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwp9Cgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24ge30KCi8vLyBAdGl0bGUgVG9rZW4gY29udHJhY3QgLSBFUkMyMCBjb21wYXRpYmxlIFN0YXJiYXNlIHRva2VuIGNvbnRyYWN0LgovLy8gQGF1dGhvciBTdGFyYmFzZSBQVEUuIExURC4gLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmYTkzOTQ5Yzk1YmE4OThlOWI4ODk4OWI4OTlmZDQ5OTk1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgU3RhcmJhc2VUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IFB1YmxpY09mZmVyaW5nUGxhbkRlY2xhcmVkKHVpbnQyNTYgdG9rZW5Db3VudCwgdWludDI1NiB1bmxvY2tDb21wYW55c1Rva2Vuc0F0KTsKICAgIGV2ZW50IE12cExhdW5jaGVkKHVpbnQyNTYgbGF1bmNoZWRBdCk7CiAgICBldmVudCBMb2dOZXdGdW5kcmFpc2VyIChhZGRyZXNzIGluZGV4ZWQgZnVuZHJhaXNlckFkZHJlc3MsIGJvb2wgaXNCb25hRmlkZSk7CiAgICBldmVudCBMb2dVcGRhdGVGdW5kcmFpc2VyKGFkZHJlc3MgaW5kZXhlZCBmdW5kcmFpc2VyQWRkcmVzcywgYm9vbCBpc0JvbmFGaWRlKTsKCiAgICAvKgogICAgICogIFR5cGVzCiAgICAgKi8KICAgIHN0cnVjdCBQdWJsaWNPZmZlcmluZ1BsYW4gewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudDsKICAgICAgICB1aW50MjU2IHVubG9ja0NvbXBhbnlzVG9rZW5zQXQ7CiAgICAgICAgdWludDI1NiBkZWNsYXJlZEF0OwogICAgfQoKICAgIC8qCiAgICAgKiAgRXh0ZXJuYWwgY29udHJhY3RzCiAgICAgKi8KICAgIEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUgcHVibGljIHN0YXJiYXNlQ3Jvd2RzYWxlOwogICAgQWJzdHJhY3RTdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduIHB1YmxpYyBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduOwoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBhZGRyZXNzIHB1YmxpYyBjb21wYW55OwogICAgUHVibGljT2ZmZXJpbmdQbGFuW10gcHVibGljIHB1YmxpY09mZmVyaW5nUGxhbnM7ICAvLyBmdXJ0aGVyIGNyb3dkc2FsZXMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uOyAgICAvLyBJbml0aWFsIHRva2VuIGFsbG9jYXRpb25zIGZvciBFYXJseSBDb250cmlidXRvcnMKICAgIHVpbnQyNTYgcHVibGljIG12cExhdW5jaGVkQXQ7ICAvLyAwIHVudGlsIGEgTVZQIG9mIFN0YXJiYXNlIFBsYXRmb3JtIGxhdW5jaGVzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHJpdmF0ZSBmdW5kcmFpc2VyczsgLy8gRnVuZHJhaXNlcnMgYXJlIHZldHRlZCBhZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBleGVjdXRlIGZ1bmN0aW9ucyB3aXRoaW4gdGhlIGNvbnRyYWN0CgogICAgLyoKICAgICAqICBDb25zdGFudHMgLyBUb2tlbiBtZXRhIGRhdGEKICAgICAqLwogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBuYW1lID0gIlN0YXJiYXNlIjsgIC8vIFRva2VuIG5hbWUKICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgc3ltYm9sID0gIlNUQVIiOyAgLy8gVG9rZW4gc3ltYm9sCiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGluaXRpYWxTdXBwbHkgPSAxMDAwMDAwMDAwZTE4OyAvLyAxQiBTVEFSIHRva2VucwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaW5pdGlhbENvbXBhbnlzVG9rZW5BbGxvY2F0aW9uID0gNzUwMDAwMDAwZTE4OyAgLy8gNzUwTQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaW5pdGlhbEJhbGFuY2VGb3JDcm93ZHNhbGUgPSAxNzUwMDAwMDBlMTg7ICAvLyBDUygxMjVNKStFUCg1ME0pCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpbml0aWFsQmFsYW5jZUZvck1hcmtldGluZ0NhbXBhaWduID0gMTI1MDAwMDBlMTg7ICAgLy8gMTIuNU0KCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBvbmx5Q3Jvd2RzYWxlQ29udHJhY3QoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzdGFyYmFzZUNyb3dkc2FsZSkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1hcmtldGluZ0NhbXBhaWduQ29udHJhY3QoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RnVuZHJhaXNlcigpIHsKICAgICAgICAvLyBPbmx5IHJpZ2h0ZnVsIGZ1bmRyYWlzZXIgaXMgcGVybWl0dGVkLgogICAgICAgIGFzc2VydChpc0Z1bmRyYWlzZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUJlZm9yZUNyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKHN0YXJiYXNlQ3Jvd2RzYWxlLnN0YXJ0RGF0ZSgpID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFmdGVyQ3Jvd2RzYWxlKCkgewogICAgICAgIHJlcXVpcmUoc3RhcmJhc2VDcm93ZHNhbGUuaXNFbmRlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID09IHNpemUgKyA0KTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24KICAgICAqIEBwYXJhbSBzdGFyYmFzZUNvbXBhbnlBZGRyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkcyB1bnRyYW5zZmVycmFibGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VDcm93ZHNhbGVBZGRyIEFkZHJlc3Mgb2YgdGhlIGNyb3dkc2FsZSBjb250cmFjdAogICAgICogQHBhcmFtIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBtYXJrZXRpbmcgY2FtcGFpZ24gY29udHJhY3QKICAgICAqLwoKICAgIGZ1bmN0aW9uIFN0YXJiYXNlVG9rZW4oCiAgICAgICAgYWRkcmVzcyBzdGFyYmFzZUNvbXBhbnlBZGRyLAogICAgICAgIGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVBZGRyLAogICAgICAgIGFkZHJlc3Mgc3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbkFkZHIKICAgICkgewogICAgICAgIGFzc2VydCgKICAgICAgICAgICAgc3RhcmJhc2VDb21wYW55QWRkciAhPSAwICYmCiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciAhPSAwICYmCiAgICAgICAgICAgIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyICE9IDApOwoKICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZSA9IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUoc3RhcmJhc2VDcm93ZHNhbGVBZGRyKTsKICAgICAgICBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduID0gQWJzdHJhY3RTdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyKTsKICAgICAgICBjb21wYW55ID0gc3RhcmJhc2VDb21wYW55QWRkcjsKCiAgICAgICAgLy8gbXNnLnNlbmRlciBiZWNvbWVzIGZpcnN0IGZ1bmRyYWlzZXIKICAgICAgICBmdW5kcmFpc2Vyc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgTG9nTmV3RnVuZHJhaXNlcihtc2cuc2VuZGVyLCB0cnVlKTsKCiAgICAgICAgLy8gVG9rZW5zIGZvciBjcm93ZHNhbGUgYW5kIGVhcmx5IHB1cmNoYXNlcnMKICAgICAgICBiYWxhbmNlc1thZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKV0gPSBpbml0aWFsQmFsYW5jZUZvckNyb3dkc2FsZTsKICAgICAgICBUcmFuc2ZlcigwLCBhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSwgaW5pdGlhbEJhbGFuY2VGb3JDcm93ZHNhbGUpOwoKICAgICAgICAvLyBUb2tlbnMgZm9yIG1hcmtldGluZyBjYW1wYWlnbiBzdXBwb3J0ZXJzCiAgICAgICAgYmFsYW5jZXNbYWRkcmVzcyhzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKV0gPSBpbml0aWFsQmFsYW5jZUZvck1hcmtldGluZ0NhbXBhaWduOwogICAgICAgIFRyYW5zZmVyKDAsIGFkZHJlc3Moc3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbiksIGluaXRpYWxCYWxhbmNlRm9yTWFya2V0aW5nQ2FtcGFpZ24pOwoKICAgICAgICAvLyBUb2tlbnMgZm9yIGVhcmx5IGNvbnRyaWJ1dG9ycywgc2hvdWxkIGJlIGFsbG9jYXRlZCBieSBmdW5jdGlvbgogICAgICAgIGJhbGFuY2VzWzBdID0gNjI1MDAwMDBlMTg7IC8vIDYyLjVNCgogICAgICAgIC8vIFN0YXJiYXNlIGNvbXBhbnkgaG9sZHMgdW50cmFuc2ZlcnJhYmxlIHRva2VucyBpbml0aWFsbHkKICAgICAgICBiYWxhbmNlc1tzdGFyYmFzZUNvbXBhbnlBZGRyXSA9IGluaXRpYWxDb21wYW55c1Rva2VuQWxsb2NhdGlvbjsgLy8gNzUwTQogICAgICAgIFRyYW5zZmVyKDAsIHN0YXJiYXNlQ29tcGFueUFkZHIsIGluaXRpYWxDb21wYW55c1Rva2VuQWxsb2NhdGlvbik7CgogICAgICAgIHRvdGFsU3VwcGx5ID0gaW5pdGlhbFN1cHBseTsgICAgLy8gMUIKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdHMnIGFkZHJlc3NlcwogICAgICogQHBhcmFtIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciBDcm93ZHNhbGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkciBNYXJrZXRpbmcgY2FtcGFpZ24gY29udHJhY3QgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciwgYWRkcmVzcyBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkcikKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShzdGFyYmFzZUNyb3dkc2FsZUFkZHIgIT0gMCAmJiBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkciAhPSAwKTsKICAgICAgICBhc3NlcnQoYmFsYW5jZXNbYWRkcmVzcyhzdGFyYmFzZUNyb3dkc2FsZSldID09IGluaXRpYWxCYWxhbmNlRm9yQ3Jvd2RzYWxlKTsKICAgICAgICBhc3NlcnQoYmFsYW5jZXNbYWRkcmVzcyhzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKV0gPT0gaW5pdGlhbEJhbGFuY2VGb3JNYXJrZXRpbmdDYW1wYWlnbik7CgogICAgICAgIC8vIE1vdmUgdGhlIGJhbGFuY2VzIHRvIHRoZSBuZXcgb25lcwogICAgICAgIGJhbGFuY2VzW2FkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpXSA9IDA7CiAgICAgICAgYmFsYW5jZXNbYWRkcmVzcyhzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKV0gPSAwOwogICAgICAgIGJhbGFuY2VzW3N0YXJiYXNlQ3Jvd2RzYWxlQWRkcl0gPSBpbml0aWFsQmFsYW5jZUZvckNyb3dkc2FsZTsKICAgICAgICBiYWxhbmNlc1tzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkcl0gPSBpbml0aWFsQmFsYW5jZUZvck1hcmtldGluZ0NhbXBhaWduOwoKICAgICAgICAvLyBVcGRhdGUgdGhlIHJlZmVyZW5jZXMKICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZSA9IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUoc3RhcmJhc2VDcm93ZHNhbGVBZGRyKTsKICAgICAgICBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduID0gQWJzdHJhY3RTdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKgogICAgICogIEV4dGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGRlY2xhcmVkIHB1YmxpYyBvZmZlcmluZyBwbGFucwogICAgICovCiAgICBmdW5jdGlvbiBudW1PZkRlY2xhcmVkUHVibGljT2ZmZXJpbmdQbGFucygpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIHB1YmxpY09mZmVyaW5nUGxhbnMubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWNsYXJlcyBhIHB1YmxpYyBvZmZlcmluZyBwbGFuIHRvIG1ha2UgY29tcGFueSdzIHRva2VucyB0cmFuc2ZlcmFibGUKICAgICAqIEBwYXJhbSB0b2tlbkNvdW50IE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gdW5sb2NrQ29tcGFueXNUb2tlbnNBdCBUaW1lIG9mIHRoZSB0b2tlbnMgd2lsbCBiZSB1bmxvY2tlZAogICAgICovCiAgICBmdW5jdGlvbiBkZWNsYXJlUHVibGljT2ZmZXJpbmdQbGFuKHVpbnQyNTYgdG9rZW5Db3VudCwgdWludDI1NiB1bmxvY2tDb21wYW55c1Rva2Vuc0F0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICBvbmx5QWZ0ZXJDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFzc2VydCh0b2tlbkNvdW50IDw9IDEwMDAwMDAwMGUxOCk7ICAgIC8vIHNoYWxsIG5vdCBleGNlZWQgMTAwTSB0b2tlbnMKICAgICAgICBhc3NlcnQoU2FmZU1hdGguc3ViKG5vdywgc3RhcmJhc2VDcm93ZHNhbGUuZW5kZWRBdCgpKSA+PSAxODAgZGF5cyk7ICAgLy8gc2hhbGwgbm90IGJlIGRlY2xhcmVkIGZvciA2IG1vbnRocyBhZnRlciB0aGUgY3Jvd2RzYWxlIGVuZGVkCiAgICAgICAgYXNzZXJ0KFNhZmVNYXRoLnN1Yih1bmxvY2tDb21wYW55c1Rva2Vuc0F0LCBub3cpID49IDYwIGRheXMpOyAgIC8vIHRva2VucyBtdXN0IGJlIHVudHJhbnNmZXJhYmxlIGF0IGxlYXN0IGZvciAyIG1vbnRocwoKICAgICAgICAvLyBjaGVjayBpZiBsYXN0IGRlY2xhcmF0aW9uIHdhcyBtb3JlIHRoYW4gNiBtb250aHMgYWdvCiAgICAgICAgaWYgKHB1YmxpY09mZmVyaW5nUGxhbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB1aW50MjU2IGxhc3REZWNsYXJlZEF0ID0KICAgICAgICAgICAgICAgIHB1YmxpY09mZmVyaW5nUGxhbnNbcHVibGljT2ZmZXJpbmdQbGFucy5sZW5ndGggLSAxXS5kZWNsYXJlZEF0OwogICAgICAgICAgICBhc3NlcnQoU2FmZU1hdGguc3ViKG5vdywgbGFzdERlY2xhcmVkQXQpID49IDE4MCBkYXlzKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdG90YWxEZWNsYXJlZFRva2VuQ291bnQgPSB0b2tlbkNvdW50OwogICAgICAgIGZvciAodWludDggaTsgaSA8IHB1YmxpY09mZmVyaW5nUGxhbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG90YWxEZWNsYXJlZFRva2VuQ291bnQgPSBTYWZlTWF0aC5hZGQodG90YWxEZWNsYXJlZFRva2VuQ291bnQsIHB1YmxpY09mZmVyaW5nUGxhbnNbaV0udG9rZW5Db3VudCk7CiAgICAgICAgfQogICAgICAgIGFzc2VydCh0b3RhbERlY2xhcmVkVG9rZW5Db3VudCA8PSBpbml0aWFsQ29tcGFueXNUb2tlbkFsbG9jYXRpb24pOyAgIC8vIHNoYWxsIG5vdCBleGNlZWQgdGhlIGluaXRpYWwgdG9rZW4gYWxsb2NhdGlvbgoKICAgICAgICBwdWJsaWNPZmZlcmluZ1BsYW5zLnB1c2goCiAgICAgICAgICAgIFB1YmxpY09mZmVyaW5nUGxhbih0b2tlbkNvdW50LCB1bmxvY2tDb21wYW55c1Rva2Vuc0F0LCBub3cpKTsKCiAgICAgICAgUHVibGljT2ZmZXJpbmdQbGFuRGVjbGFyZWQodG9rZW5Db3VudCwgdW5sb2NrQ29tcGFueXNUb2tlbnNBdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG9jYXRlIHRva2VucyB0byBhIG1hcmtldGluZyBzdXBwb3J0ZXIgZnJvbSB0aGUgbWFya2V0aW5nIGNhbXBhaWduIHNoYXJlCiAgICAgKiBAcGFyYW0gdG8gQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIGFsbG9jYXRlZAogICAgICogQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb2NhdGVUb01hcmtldGluZ1N1cHBvcnRlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU1hcmtldGluZ0NhbXBhaWduQ29udHJhY3QKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmV0dXJuIGFsbG9jYXRlRnJvbShhZGRyZXNzKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24pLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdG8gYW4gZWFybHkgY29udHJpYnV0b3IgZnJvbSB0aGUgZWFybHkgY29udHJpYnV0b3Igc2hhcmUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvRWFybHlDb250cmlidXRvcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uW3RvXSA9CiAgICAgICAgICAgIFNhZmVNYXRoLmFkZChpbml0aWFsRWNUb2tlbkFsbG9jYXRpb25bdG9dLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIGFsbG9jYXRlRnJvbSgwLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBJc3N1ZSBuZXcgdG9rZW5zIGFjY29yZGluZyB0byB0aGUgU1RBUiB0b2tlbiBpbmZsYXRpb24gbGltaXRzCiAgICAgKiBAcGFyYW0gX2ZvciBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBpc3N1ZQogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF9mb3IsIHVpbnQyNTYgdmFsdWUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIG9ubHlBZnRlckNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfZm9yICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIGNoZWNrIGlmIHRoZSB2YWx1ZSB1bmRlciB0aGUgbGltaXRzCiAgICAgICAgYXNzZXJ0KHZhbHVlIDw9IG51bU9mSW5mbGF0YWJsZVRva2VucygpKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSBTYWZlTWF0aC5hZGQodG90YWxTdXBwbHksIHZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZm9yXSA9IFNhZmVNYXRoLmFkZChiYWxhbmNlc1tfZm9yXSwgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWNsYXJlcyBTdGFyYmFzZSBNVlAgaGFzIGJlZW4gbGF1bmNoZWQKICAgICAqIEBwYXJhbSBsYXVuY2hlZEF0IFdoZW4gdGhlIE1WUCBsYXVuY2hlZCAodGltZXN0YW1wKQogICAgICovCiAgICBmdW5jdGlvbiBkZWNsYXJlTXZwTGF1bmNoZWQodWludDI1NiBsYXVuY2hlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICBvbmx5QWZ0ZXJDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUobXZwTGF1bmNoZWRBdCA9PSAwKTsgLy8gb3ZlcndyaXRpbmcgdGhlIGxhdW5jaCBkYXRlIGlzIG5vdCBwZXJtaXR0ZWQKICAgICAgICByZXF1aXJlKGxhdW5jaGVkQXQgPD0gbm93KTsKICAgICAgICByZXF1aXJlKHN0YXJiYXNlQ3Jvd2RzYWxlLmlzRW5kZWQoKSk7CgogICAgICAgIG12cExhdW5jaGVkQXQgPSBsYXVuY2hlZEF0OwogICAgICAgIE12cExhdW5jaGVkKGxhdW5jaGVkQXQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdG8gYSBjcm93ZHNhbGUgb3IgZWFybHkgcHVyY2hhc2VyIGZyb20gdGhlIGNyb3dkc2FsZSBzaGFyZQogICAgICogQHBhcmFtIHRvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBhbGxvY2F0ZWQKICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9Dcm93ZHNhbGVQdXJjaGFzZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlDcm93ZHNhbGVDb250cmFjdAogICAgICAgIG9ubHlBZnRlckNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZSh0byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXR1cm4gYWxsb2NhdGVGcm9tKGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAgKiBAcGFyYW0gdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlci4KICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDIqMzIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhc3NlcnQoaXNUcmFuc2ZlcmFibGUobXNnLnNlbmRlciwgdmFsdWUpKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgICAqIEBwYXJhbSBmcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDMqMzIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhc3NlcnQoaXNUcmFuc2ZlcmFibGUoZnJvbSwgdmFsdWUpKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFkZHMgZnVuZHJhaXNlci4gT25seSBjYWxsZWQgYnkgYW5vdGhlciBmdW5kcmFpc2VyLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIGluIGNoZWNrCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZEZ1bmRyYWlzZXIoYWRkcmVzcyBmdW5kcmFpc2VyQWRkcmVzcykgcHVibGljIG9ubHlGdW5kcmFpc2VyIHsKICAgICAgICByZXF1aXJlKGZ1bmRyYWlzZXJBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGFzc2VydCghaXNGdW5kcmFpc2VyKGZ1bmRyYWlzZXJBZGRyZXNzKSk7CgogICAgICAgIGZ1bmRyYWlzZXJzW2Z1bmRyYWlzZXJBZGRyZXNzXSA9IHRydWU7CiAgICAgICAgTG9nTmV3RnVuZHJhaXNlcihmdW5kcmFpc2VyQWRkcmVzcywgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSBmdW5kcmFpc2VyIGFkZHJlc3MgcmlnaHRzLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHVwZGF0ZQogICAgICogQHBhcmFtIGlzQm9uYUZpZGUgQm9vbGVhbiB0aGF0IGRlbm90ZXMgd2hldGhlciBmdW5kcmFpc2VyIGlzIGFjdGl2ZSBvciBub3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUZ1bmRyYWlzZXIoYWRkcmVzcyBmdW5kcmFpc2VyQWRkcmVzcywgYm9vbCBpc0JvbmFGaWRlKQogICAgICAgcHVibGljCiAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIGFzc2VydChpc0Z1bmRyYWlzZXIoZnVuZHJhaXNlckFkZHJlc3MpKTsKCiAgICAgICAgZnVuZHJhaXNlcnNbZnVuZHJhaXNlckFkZHJlc3NdID0gaXNCb25hRmlkZTsKICAgICAgICBMb2dVcGRhdGVGdW5kcmFpc2VyKGZ1bmRyYWlzZXJBZGRyZXNzLCBpc0JvbmFGaWRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIGZ1bmRyYWlzZXIgYWRkcmVzcyBoYXMgcmlnaHRzLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIGluIGNoZWNrCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzRnVuZHJhaXNlcihhZGRyZXNzIGZ1bmRyYWlzZXJBZGRyZXNzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGZ1bmRyYWlzZXJzW2Z1bmRyYWlzZXJBZGRyZXNzXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIHRoZSB0cmFuc2ZlcnJpbmcgb2YgdG9rZW5zIGlzIGF2YWlsYWJsZSBmdW5kcmFpc2VyLgogICAgICogQHBhcmFtIGZyb20gQWRkcmVzcyBvZiB0b2tlbiBzZW5kZXIKICAgICAqIEBwYXJhbSB0b2tlbkNvdW50IE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzVHJhbnNmZXJhYmxlKGFkZHJlc3MgZnJvbSwgdWludDI1NiB0b2tlbkNvdW50KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwIHx8IGJhbGFuY2VzW2Zyb21dIDwgdG9rZW5Db3VudCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBjb21wYW55J3MgdG9rZW5zIG1heSBiZSBsb2NrZWQgdXAKICAgICAgICBpZiAoZnJvbSA9PSBjb21wYW55KSB7CiAgICAgICAgICAgIGlmICh0b2tlbkNvdW50ID4gbnVtT2ZUcmFuc2ZlcmFibGVDb21wYW55c1Rva2VucygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50ID0gMDsKCiAgICAgICAgLy8gZWFybHkgY29udHJpYnV0b3IncyB0b2tlbnMgbWF5IGJlIGxvY2tlZCB1cAogICAgICAgIGlmIChpbml0aWFsRWNUb2tlbkFsbG9jYXRpb25bZnJvbV0gPiAwKSB7CiAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9IFNhZmVNYXRoLmFkZCgKICAgICAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCwKICAgICAgICAgICAgICAgIG51bU9mVW50cmFuc2ZlcmFibGVFY1Rva2Vucyhmcm9tKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFUCBhbmQgQ1MgcHVyY2hhc2VycycgdG9rZW5zIHNob3VsZCBiZSB1bnRyYW5zZmVyYWJsZSBpbml0aWFsbHkKICAgICAgICBpZiAoc3RhcmJhc2VDcm93ZHNhbGUuaXNFbmRlZCgpKSB7CiAgICAgICAgICAgIHVpbnQyNTYgcGFzc2VkRGF5cyA9CiAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIobm93LCBzdGFyYmFzZUNyb3dkc2FsZS5lbmRlZEF0KCkpIC8gODY0MDA7IC8vIDFkID0gODY0MDBzCiAgICAgICAgICAgIGlmIChwYXNzZWREYXlzIDwgNykgeyAgLy8gd2l0aGluIGEgd2VlawogICAgICAgICAgICAgICAgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlcnMgY2Fubm90IHRyYW5zZmVyIHRoZWlyIHRva2VucyBmb3IgYSB3ZWVrCiAgICAgICAgICAgICAgICB1bnRyYW5zZmVyYWJsZVRva2VuQ291bnQgPSBTYWZlTWF0aC5hZGQoCiAgICAgICAgICAgICAgICAgICAgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50LAogICAgICAgICAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlLm51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5KGZyb20pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFzc2VkRGF5cyA8IDE0KSB7ICAvLyB3aXRoaW4gdHdvIHdlZWtzCiAgICAgICAgICAgICAgICAvLyBlYXJseSBwdXJjaGFzZXJzIGNhbm5vdCB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZm9yIHR3byB3ZWVrcwogICAgICAgICAgICAgICAgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50ID0gU2FmZU1hdGguYWRkKAogICAgICAgICAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCwKICAgICAgICAgICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZS5udW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeShmcm9tKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9CiAgICAgICAgICAgIFNhZmVNYXRoLnN1YihiYWxhbmNlc1tmcm9tXSwgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50KTsKCiAgICAgICAgaWYgKHRyYW5zZmVyYWJsZVRva2VuQ291bnQgPCB0b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0cmFuc2ZlcmFibGUgY29tcGFueSdzIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBudW1PZlRyYW5zZmVyYWJsZUNvbXBhbnlzVG9rZW5zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHVubG9ja2VkVG9rZW5zID0gMDsKICAgICAgICBmb3IgKHVpbnQ4IGk7IGkgPCBwdWJsaWNPZmZlcmluZ1BsYW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFB1YmxpY09mZmVyaW5nUGxhbiBtZW1vcnkgcGxhbiA9IHB1YmxpY09mZmVyaW5nUGxhbnNbaV07CiAgICAgICAgICAgIGlmIChwbGFuLnVubG9ja0NvbXBhbnlzVG9rZW5zQXQgPD0gbm93KSB7CiAgICAgICAgICAgICAgICB1bmxvY2tlZFRva2VucyA9IFNhZmVNYXRoLmFkZCh1bmxvY2tlZFRva2VucywgcGxhbi50b2tlbkNvdW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKAogICAgICAgICAgICBiYWxhbmNlc1tjb21wYW55XSwKICAgICAgICAgICAgaW5pdGlhbENvbXBhbnlzVG9rZW5BbGxvY2F0aW9uIC0gdW5sb2NrZWRUb2tlbnMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdW50cmFuc2ZlcmFibGUgdG9rZW5zIG9mIHRoZSBlYXJseSBjb250cmlidXRvcgogICAgICogQHBhcmFtIF9mb3IgQWRkcmVzcyBvZiBlYXJseSBjb250cmlidXRvciB0byBjaGVjawogICAgICovCiAgICBmdW5jdGlvbiBudW1PZlVudHJhbnNmZXJhYmxlRWNUb2tlbnMoYWRkcmVzcyBfZm9yKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgaW5pdGlhbENvdW50ID0gaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uW19mb3JdOwogICAgICAgIGlmIChtdnBMYXVuY2hlZEF0ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxDb3VudDsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcGFzc2VkV2Vla3MgPSBTYWZlTWF0aC5zdWIobm93LCBtdnBMYXVuY2hlZEF0KSAvIDcgZGF5czsKICAgICAgICBpZiAocGFzc2VkV2Vla3MgPD0gNTIpIHsgICAgLy8gYSB5ZWFyIOKJiCA1MiB3ZWVrcwogICAgICAgICAgICAvLyBhbGwgdG9rZW5zIHNob3VsZCBiZSBsb2NrZWQgdXAgZm9yIGEgeWVhcgogICAgICAgICAgICByZXR1cm4gaW5pdGlhbENvdW50OwogICAgICAgIH0KCiAgICAgICAgLy8gdW5sb2NrIDEvNTIgdG9rZW5zIGV2ZXJ5IHdlZWtzIGFmdGVyIGEgeWVhcgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9IGluaXRpYWxDb3VudCAvIDUyICogKHBhc3NlZFdlZWtzIC0gNTIpOwogICAgICAgIGlmICh0cmFuc2ZlcmFibGVUb2tlbkNvdW50ID49IGluaXRpYWxDb3VudCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKGluaXRpYWxDb3VudCwgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgd2hpY2ggY2FuIGJlIGlzc3VlZCBhY2NvcmRpbmcgdG8gdGhlIGluZmxhdGlvbiBydWxlcwogICAgICovCiAgICBmdW5jdGlvbiBudW1PZkluZmxhdGFibGVUb2tlbnMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChzdGFyYmFzZUNyb3dkc2FsZS5lbmRlZEF0KCkgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBwYXNzZWREYXlzID0gU2FmZU1hdGguc3ViKG5vdywgc3RhcmJhc2VDcm93ZHNhbGUuZW5kZWRBdCgpKSAvIDg2NDAwOyAgLy8gMWQgPSA2MHMgKiA2MG0gKiAyNGggPSA4NjQwMHMKICAgICAgICB1aW50MjU2IHBhc3NlZFllYXJzID0gcGFzc2VkRGF5cyAqIDEwMCAvIDM2NTI1OyAgICAvLyBhYm91dCAzNjUuMjUgZGF5cyBpbiBhIHllYXIKICAgICAgICB1aW50MjU2IGluZmxhdGVkU3VwcGx5ID0gaW5pdGlhbFN1cHBseTsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IHBhc3NlZFllYXJzOyBpKyspIHsKICAgICAgICAgICAgaW5mbGF0ZWRTdXBwbHkgPSBTYWZlTWF0aC5hZGQoaW5mbGF0ZWRTdXBwbHksIFNhZmVNYXRoLm11bChpbmZsYXRlZFN1cHBseSwgMjUpIC8gMTAwMCk7IC8vIDIuNSUveSA9IDAuMDI1L3kKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcmVtYWluZGVyZWREYXlzID0gcGFzc2VkRGF5cyAqIDEwMCAlIDM2NTI1IC8gMTAwOwogICAgICAgIGlmIChyZW1haW5kZXJlZERheXMgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgaW5mbGF0YWJsZVRva2Vuc09mTmV4dFllYXIgPQogICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKGluZmxhdGVkU3VwcGx5LCAyNSkgLyAxMDAwOwogICAgICAgICAgICBpbmZsYXRlZFN1cHBseSA9IFNhZmVNYXRoLmFkZChpbmZsYXRlZFN1cHBseSwgU2FmZU1hdGgubXVsKAogICAgICAgICAgICAgICAgaW5mbGF0YWJsZVRva2Vuc09mTmV4dFllYXIsIHJlbWFpbmRlcmVkRGF5cyAqIDEwMCkgLyAzNjUyNSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKGluZmxhdGVkU3VwcGx5LCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgLyoKICAgICAqICBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdmFsdWUgZnJvbSBhbiBhZGRyZXNzIHRvIGFub3RoZXIgb25lLiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgY2FsbGVkIGludGVybmFsbHkuCiAgICAgKiBAcGFyYW0gZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGNvbWUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZUZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYXNzZXJ0KHZhbHVlID4gMCAmJiBiYWxhbmNlc1tmcm9tXSA+PSB2YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbZnJvbV0sIHZhbHVlKTsKICAgICAgICBiYWxhbmNlc1t0b10gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbdG9dLCB2YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
