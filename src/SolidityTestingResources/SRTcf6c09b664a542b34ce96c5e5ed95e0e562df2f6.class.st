Class {
	#name : #SRTcf6c09b664a542b34ce96c5e5ed95e0e562df2f6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcf6c09b664a542b34ce96c5e5ed95e0e562df2f6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgoKCi8qKgogKiBAdGl0bGUgQ2xhaW1hYmxlCiAqIEBkZXYgRXh0ZW5zaW9uIGZvciB0aGUgT3duYWJsZSBjb250cmFjdCwgd2hlcmUgdGhlIG93bmVyc2hpcCBuZWVkcyB0byBiZSBjbGFpbWVkLgogKiBUaGlzIGFsbG93cyB0aGUgbmV3IG93bmVyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIuCiAqLwpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CgogICAgLyoqCiAgICAgKiBAZGV2IE1vZGlmaWVyIHRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgcGVuZGluZ093bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5UGVuZGluZ093bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcGVuZGluZ093bmVyID0gbmV3T3duZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIG9ubHlQZW5kaW5nT3duZXIgcHVibGljIHsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgICAgICBvd25lciA9IHBlbmRpbmdPd25lcjsKICAgICAgICBwZW5kaW5nT3duZXIgPSBhZGRyZXNzKDApOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBMaW1pdGVkVHJhbnNmZXJUb2tlbgogKiBAZGV2IExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4KICogdHJhbnNmZXJhYmlsaXR5IGZvciBkaWZmZXJlbnQgZXZlbnRzLiBJdCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGFzIGEgYmFzZSBjbGFzcyBmb3Igb3RoZXIgdG9rZW4KICogY29udHJhY3RzLgogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsCiAqIHRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHJlY3Vyc2l2ZWx5IGNhbGxpbmcgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKCkgdW50aWwgdGhlIGJhc2UgY2xhc3MgaXMKICogaGl0LiBGb3IgZXhhbXBsZToKICogICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAqICAgICAgIHJldHVybiBtaW4yNTYodW5sb2NrZWRUb2tlbnMsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICogICAgIH0KICogQSB3b3JraW5nIGV4YW1wbGUgaXMgVmVzdGVkVG9rZW4uc29sOgogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy90b2tlbi9WZXN0ZWRUb2tlbi5zb2wKICovCgpjb250cmFjdCBMaW1pdGVkVHJhbnNmZXJUb2tlbiBpcyBFUkMyMCB7CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyLCB1aW50MjU2IF92YWx1ZSkgewogICByZXF1aXJlKF92YWx1ZSA8PSB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKTsKICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHNlbmQgdGhlIHRva2Vucy4KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHRva2Vucy4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLgogICAqIEBkZXYgT3ZlcndyaXRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZQogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7CiAgfQp9CgoKCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCgoKCi8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKiBAZGV2IElzc3VlOiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvaXNzdWVzLzEyMAogKiBCYXNlZCBvbiBjb2RlIGJ5IFRva2VuTWFya2V0TmV0OiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAogKi8KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgQ2xhaW1hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9CgovKgogICAgU21hcnQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElTbWFydFRva2VuIHsKCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lbWJlcnMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZCA9IGZhbHNlOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXZlbnQKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy8gdHJpZ2dlcmVkIHdoZW4gYSBzbWFydCB0b2tlbiBpcyBkZXBsb3llZCAtIHRoZSBfdG9rZW4gYWRkcmVzcyBpcyBkZWZpbmVkIGZvciBmb3J3YXJkIGNvbXBhdGliaWxpdHksIGluIGNhc2Ugd2Ugd2FudCB0byB0cmlnZ2VyIHRoZSBldmVudCBmcm9tIGEgZmFjdG9yeQogICAgZXZlbnQgTmV3U21hcnRUb2tlbihhZGRyZXNzIF90b2tlbik7CiAgICAvLyB0cmlnZ2VyZWQgd2hlbiB0aGUgdG90YWwgc3VwcGx5IGlzIGluY3JlYXNlZAogICAgZXZlbnQgSXNzdWFuY2UodWludDI1NiBfYW1vdW50KTsKICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSB0b3RhbCBzdXBwbHkgaXMgZGVjcmVhc2VkCiAgICBldmVudCBEZXN0cnVjdGlvbih1aW50MjU2IF9hbW91bnQpOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnVuY3Rpb25zCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljOwogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwogICAgZnVuY3Rpb24gZGVzdHJveShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKCi8qKgogICAgQmFuY29yU21hcnRUb2tlbgoqLwpjb250cmFjdCBMaW1pdGVkVHJhbnNmZXJCYW5jb3JTbWFydFRva2VuIGlzIE1pbnRhYmxlVG9rZW4sIElTbWFydFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RpZmllcnMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBkZXN0cm95IGZsYWcgaXMgbm90IGVuYWJsZWQuCiAgICAgKi8KICAgIG1vZGlmaWVyIGNhbkRlc3Ryb3koKSB7CiAgICAgICAgcmVxdWlyZShkZXN0cm95RW5hYmxlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lbWJlcnMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy8gV2UgYWRkIHRoaXMgZmxhZyB0byBhdm9pZCB1c2VycyBhbmQgb3duZXIgZnJvbSBkZXN0cm95IHRva2VucyBkdXJpbmcgY3Jvd2RzYWxlLAogICAgLy8gVGhpcyBmbGFnIGlzIHNldCB0byBmYWxzZSBieSBkZWZhdWx0IGFuZCBibG9ja3MgZGVzdHJveSBmdW5jdGlvbiwKICAgIC8vIFdlIGVuYWJsZSBkZXN0cm95IG9wdGlvbiBvbiBmaW5hbGl6ZSwgc28gZGVzdHJveSB3aWxsIGJlIHBvc3NpYmxlIGFmdGVyIHRoZSBjcm93ZHNhbGUuCiAgICBib29sIHB1YmxpYyBkZXN0cm95RW5hYmxlZCA9IGZhbHNlOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHVibGljIEZ1bmN0aW9ucwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICBmdW5jdGlvbiBzZXREZXN0cm95RW5hYmxlZChib29sIF9lbmFibGUpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGRlc3Ryb3lFbmFibGVkID0gX2VuYWJsZTsKICAgIH0KCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEltcGwgSVNtYXJ0VG9rZW4KICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy9AT3ZlcnJpZGUKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9ICFfZGlzYWJsZTsKICAgIH0KCiAgICAvL0BPdmVycmlkZQogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShzdXBlci5taW50KF90bywgX2Ftb3VudCkpOwogICAgICAgIElzc3VhbmNlKF9hbW91bnQpOwogICAgfQoKICAgIC8vQE92ZXJyaWRlCiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgY2FuRGVzdHJveSBwdWJsaWMgewoKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gX2Zyb20gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX2Ftb3VudCk7CgogICAgICAgIERlc3RydWN0aW9uKF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCAweDAsIF9hbW91bnQpOwogICAgfQoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW1wbCBMaW1pdGVkVHJhbnNmZXJUb2tlbgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgogICAgLy8gRW5hYmxlL0Rpc2FibGUgdG9rZW4gdHJhbnNmZXIKICAgIC8vIFRva2VucyB3aWxsIGJlIGxvY2tlZCBpbiB0aGVpciB3YWxsZXRzIHVudGlsIHRoZSBlbmQgb2YgdGhlIENyb3dkc2FsZS4KICAgIC8vIEBob2xkZXIgLSB0b2tlbmBzIG93bmVyCiAgICAvLyBAdGltZSAtIG5vdCB1c2VkIChmcmFtZXdvcmsgdW5uZWVkZWQgZnVuY3Rpb25hbGl0eSkKICAgIC8vCiAgICAvLyBAT3ZlcnJpZGUKICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSk7CiAgICB9Cn0KCgoKCi8qKgogIEEgVG9rZW4gd2hpY2ggaXMgJ0JhbmNvcicgY29tcGF0aWJsZSBhbmQgY2FuIG1pbnQgbmV3IHRva2VucyBhbmQgcGF1c2UgdG9rZW4tdHJhbnNmZXIgZnVuY3Rpb25hbGl0eQoqLwpjb250cmFjdCBTaXJpblNtYXJ0VG9rZW4gaXMgTGltaXRlZFRyYW5zZmVyQmFuY29yU21hcnRUb2tlbiB7CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZW1iZXJzCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJTSVJJTiI7CgogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiU1JOIjsKCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnN0cnVjdG9yCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIGZ1bmN0aW9uIFNpcmluU21hcnRUb2tlbigpIHB1YmxpYyB7CiAgICAgICAgLy9BcGFydCBvZiAnQmFuY29yJyBjb21wdXRhYmlsaXR5IC0gdHJpZ2dlcmVkIHdoZW4gYSBzbWFydCB0b2tlbiBpcyBkZXBsb3llZAogICAgICAgIE5ld1NtYXJ0VG9rZW4oYWRkcmVzcyh0aGlzKSk7CiAgICB9Cn0KCgovKioKICogQHRpdGxlIFJlZnVuZFZhdWx0CiAqIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIGZvciBzdG9yaW5nIFRPS0VOUyBBTkQgRVRIRVIgd2hpbGUgYSBjcm93ZHNhbGUgaXMgaW4gcHJvZ3Jlc3MgZm9yIGEgcGVyaW9kIG9mIDYwIERBWVMuCiAqIEludmVzdG9yIGNhbiBhc2sgZm9yIGEgZnVsbC9wYXJ0IHJlZnVuZCBmb3IgaGlzIGV0aGVyIGFnYWluc3QgdG9rZW4uIE9uY2UgdG9rZW5zIGFyZSBDbGFpbWVkIGJ5IHRoZSBpbnZlc3RvciwgdGhleSBjYW5ub3QgYmUgcmVmdW5kZWQuCiAqIEFmdGVyIDYwIGRheXMsIGFsbCBldGhlciB3aWxsIGJlIHdpdGhkcmF3biBmcm9tIHRoZSB2YXVsdGBzIHdhbGxldCwgbGVhdmluZyBhbGwgdG9rZW5zIHRvIGJlIGNsYWltZWQgYnkgdGhlIHRoZWlyIG93bmVycy4KICoqLwpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBDbGFpbWFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbnVtcwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZW1iZXJzCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIC8vIFJlZnVuZCB0aW1lIGZyYW1lCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBSRUZVTkRfVElNRV9GUkFNRSA9IDYwIGRheXM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkRVRIOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkVG9rZW47CgogICAgYWRkcmVzcyBwdWJsaWMgZXRoZXJXYWxsZXQ7CiAgICBTaXJpblNtYXJ0VG9rZW4gcHVibGljIHRva2VuOwogICAgU3RhdGUgcHVibGljIHN0YXRlOwogICAgdWludDI1NiBwdWJsaWMgcmVmdW5kU3RhcnRUaW1lOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXZlbnRzCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIGV2ZW50IEFjdGl2ZSgpOwogICAgZXZlbnQgQ2xvc2VkKCk7CiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiBldGhlcldlaUFtb3VudCwgdWludDI1NiB0b2tlbldlaUFtb3VudCk7CiAgICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogICAgZXZlbnQgUmVmdW5kZWRFVEgoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwogICAgZXZlbnQgVG9rZW5zQ2xhaW1lZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZGlmaWVycwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICBtb2RpZmllciBpc0FjdGl2ZVN0YXRlKCkgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzUmVmdW5kaW5nU3RhdGUoKSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5SZWZ1bmRpbmcpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlzQ2xvc2VTdGF0ZSgpIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkNsb3NlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1JlZnVuZGluZ09yQ2xvc2VTdGF0ZSgpIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyB8fCBzdGF0ZSA9PSBTdGF0ZS5DbG9zZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgIGlzSW5SZWZ1bmRUaW1lRnJhbWUoKSB7CiAgICAgICAgcmVxdWlyZShyZWZ1bmRTdGFydFRpbWUgPD0gbm93ICYmIHJlZnVuZFN0YXJ0VGltZSArIFJFRlVORF9USU1FX0ZSQU1FID4gbm93KTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzUmVmdW5kVGltZUZyYW1lRXhjZWVkZWQoKSB7CiAgICAgICAgcmVxdWlyZShyZWZ1bmRTdGFydFRpbWUgKyBSRUZVTkRfVElNRV9GUkFNRSA8IG5vdyk7CiAgICAgICAgXzsKICAgIH0KICAgIAoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3RvcnMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfZXRoZXJXYWxsZXQsIFNpcmluU21hcnRUb2tlbiBfdG9rZW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfZXRoZXJXYWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGV0aGVyV2FsbGV0ID0gX2V0aGVyV2FsbGV0OwogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgICAgIHN0YXRlID0gU3RhdGUuQWN0aXZlOwogICAgICAgIEFjdGl2ZSgpOwogICAgfQoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHVibGljIEZ1bmN0aW9ucwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQyNTYgdG9rZW5zQW1vdW50KSBpc0FjdGl2ZVN0YXRlIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CgogICAgICAgIGRlcG9zaXRlZEVUSFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRFVEhbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogICAgICAgIGRlcG9zaXRlZFRva2VuW2ludmVzdG9yXSA9IGRlcG9zaXRlZFRva2VuW2ludmVzdG9yXS5hZGQodG9rZW5zQW1vdW50KTsKCiAgICAgICAgRGVwb3NpdChpbnZlc3RvciwgbXNnLnZhbHVlLCB0b2tlbnNBbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlKCkgaXNSZWZ1bmRpbmdTdGF0ZSBvbmx5T3duZXIgaXNSZWZ1bmRUaW1lRnJhbWVFeGNlZWRlZCBwdWJsaWMgewogICAgICAgIHN0YXRlID0gU3RhdGUuQ2xvc2VkOwogICAgICAgIENsb3NlZCgpOwogICAgICAgIGV0aGVyV2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIGlzQWN0aXZlU3RhdGUgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5SZWZ1bmRpbmc7CiAgICAgICAgcmVmdW5kU3RhcnRUaW1lID0gbm93OwoKICAgICAgICBSZWZ1bmRzRW5hYmxlZCgpOwogICAgfQoKICAgIC8vQGRldiBSZWZ1bmQgZXRoZXIgYmFjayB0byB0aGUgaW52ZXN0b3IgaW4gcmV0dXJucyBvZiBwcm9wb3J0aW9uYWwgYW1vdW50IG9mIFNSTgogICAgLy9iYWNrIHRvIHRoZSBTaXJpbmBzIHdhbGxldAogICAgZnVuY3Rpb24gcmVmdW5kRVRIKHVpbnQyNTYgRVRIVG9SZWZ1bmRBbW91bnRXZWkpIGlzSW5SZWZ1bmRUaW1lRnJhbWUgaXNSZWZ1bmRpbmdTdGF0ZSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoRVRIVG9SZWZ1bmRBbW91bnRXZWkgIT0gMCk7CgogICAgICAgIHVpbnQyNTYgZGVwb3NpdGVkVG9rZW5WYWx1ZSA9IGRlcG9zaXRlZFRva2VuW21zZy5zZW5kZXJdOwogICAgICAgIHVpbnQyNTYgZGVwb3NpdGVkRVRIVmFsdWUgPSBkZXBvc2l0ZWRFVEhbbXNnLnNlbmRlcl07CgogICAgICAgIHJlcXVpcmUoRVRIVG9SZWZ1bmRBbW91bnRXZWkgPD0gZGVwb3NpdGVkRVRIVmFsdWUpOwoKICAgICAgICB1aW50MjU2IHJlZnVuZFRva2VucyA9IEVUSFRvUmVmdW5kQW1vdW50V2VpLm11bChkZXBvc2l0ZWRUb2tlblZhbHVlKS5kaXYoZGVwb3NpdGVkRVRIVmFsdWUpOwoKICAgICAgICBhc3NlcnQocmVmdW5kVG9rZW5zID4gMCk7CgogICAgICAgIGRlcG9zaXRlZEVUSFttc2cuc2VuZGVyXSA9IGRlcG9zaXRlZEVUSFZhbHVlLnN1YihFVEhUb1JlZnVuZEFtb3VudFdlaSk7CiAgICAgICAgZGVwb3NpdGVkVG9rZW5bbXNnLnNlbmRlcl0gPSBkZXBvc2l0ZWRUb2tlblZhbHVlLnN1YihyZWZ1bmRUb2tlbnMpOwoKICAgICAgICB0b2tlbi5kZXN0cm95KGFkZHJlc3ModGhpcykscmVmdW5kVG9rZW5zKTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKEVUSFRvUmVmdW5kQW1vdW50V2VpKTsKCiAgICAgICAgUmVmdW5kZWRFVEgobXNnLnNlbmRlciwgRVRIVG9SZWZ1bmRBbW91bnRXZWkpOwogICAgfQoKICAgIC8vQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSB0aGUgdmF1bHQgdG8gdGhlIGludmVzdG9yIHdoaWxlIHJlbGVhc2luZyBwcm9wb3J0aW9uYWwgYW1vdW50IG9mIGV0aGVyCiAgICAvL3RvIFNpcmluYHMgd2FsbGV0LgogICAgLy9DYW4gYmUgdHJpZ2dlcmQgYnkgdGhlIGludmVzdG9yIG9ubHkKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKHVpbnQyNTYgdG9rZW5zVG9DbGFpbSkgaXNSZWZ1bmRpbmdPckNsb3NlU3RhdGUgcHVibGljIHsKICAgICAgICByZXF1aXJlKHRva2Vuc1RvQ2xhaW0gIT0gMCk7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBpbnZlc3RvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgcmVxdWlyZShkZXBvc2l0ZWRUb2tlbltpbnZlc3Rvcl0gPiAwKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGRlcG9zaXRlZFRva2VuVmFsdWUgPSBkZXBvc2l0ZWRUb2tlbltpbnZlc3Rvcl07CiAgICAgICAgdWludDI1NiBkZXBvc2l0ZWRFVEhWYWx1ZSA9IGRlcG9zaXRlZEVUSFtpbnZlc3Rvcl07CgogICAgICAgIHJlcXVpcmUodG9rZW5zVG9DbGFpbSA8PSBkZXBvc2l0ZWRUb2tlblZhbHVlKTsKCiAgICAgICAgdWludDI1NiBjbGFpbWVkRVRIID0gdG9rZW5zVG9DbGFpbS5tdWwoZGVwb3NpdGVkRVRIVmFsdWUpLmRpdihkZXBvc2l0ZWRUb2tlblZhbHVlKTsKCiAgICAgICAgYXNzZXJ0KGNsYWltZWRFVEggPiAwKTsKCiAgICAgICAgZGVwb3NpdGVkRVRIW2ludmVzdG9yXSA9IGRlcG9zaXRlZEVUSFZhbHVlLnN1YihjbGFpbWVkRVRIKTsKICAgICAgICBkZXBvc2l0ZWRUb2tlbltpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRUb2tlblZhbHVlLnN1Yih0b2tlbnNUb0NsYWltKTsKCiAgICAgICAgdG9rZW4udHJhbnNmZXIoaW52ZXN0b3IsIHRva2Vuc1RvQ2xhaW0pOwogICAgICAgIGlmKHN0YXRlICE9IFN0YXRlLkNsb3NlZCkgewogICAgICAgICAgICBldGhlcldhbGxldC50cmFuc2ZlcihjbGFpbWVkRVRIKTsKICAgICAgICB9CgogICAgICAgIFRva2Vuc0NsYWltZWQoaW52ZXN0b3IsIHRva2Vuc1RvQ2xhaW0pOwogICAgfQogICAgCiAgICAvL0BkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gdGhlIHZhdWx0IHRvIHRoZSBpbnZlc3RvciB3aGlsZSByZWxlYXNpbmcgcHJvcG9ydGlvbmFsIGFtb3VudCBvZiBldGhlcgogICAgLy90byBTaXJpbmBzIHdhbGxldC4KICAgIC8vQ2FuIGJlIHRyaWdnZXJkIGJ5IHRoZSBvd25lciBvZiB0aGUgdmF1bHQgKGluIG91ciBjYXNlIC0gU2lyaW5gcyBvd25lciBhZnRlciA2MCBkYXlzKQogICAgZnVuY3Rpb24gY2xhaW1BbGxJbnZlc3RvclRva2Vuc0J5T3duZXIoYWRkcmVzcyBpbnZlc3RvcikgaXNDbG9zZVN0YXRlIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHVpbnQyNTYgZGVwb3NpdGVkVG9rZW5WYWx1ZSA9IGRlcG9zaXRlZFRva2VuW2ludmVzdG9yXTsKICAgICAgICByZXF1aXJlKGRlcG9zaXRlZFRva2VuVmFsdWUgPiAwKTsKICAgICAgICAKCiAgICAgICAgdG9rZW4udHJhbnNmZXIoaW52ZXN0b3IsIGRlcG9zaXRlZFRva2VuVmFsdWUpOwogICAgICAgIAogICAgICAgIFRva2Vuc0NsYWltZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFRva2VuVmFsdWUpOwogICAgfQoKICAgIC8vIEBkZXYgaW52ZXN0b3JzIGNhbiBjbGFpbSB0b2tlbnMgYnkgY2FsbGluZyB0aGUgZnVuY3Rpb24KICAgIC8vIEBwYXJhbSB0b2tlblRvQ2xhaW1BbW91bnQgLSBhbW91bnQgb2YgdGhlIHRva2VuIHRvIGNsYWltCiAgICBmdW5jdGlvbiBjbGFpbUFsbFRva2VucygpIGlzUmVmdW5kaW5nT3JDbG9zZVN0YXRlIHB1YmxpYyAgewogICAgICAgIHVpbnQyNTYgZGVwb3NpdGVkVG9rZW5WYWx1ZSA9IGRlcG9zaXRlZFRva2VuW21zZy5zZW5kZXJdOwogICAgICAgIGNsYWltVG9rZW5zKGRlcG9zaXRlZFRva2VuVmFsdWUpOwogICAgfQoKCn0KCgoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUKICogQGRldiBDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogICAgU2lyaW5TbWFydFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwoKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogICAgLy8gYWRkcmVzcyB3aGVyZSBmdW5kcyBhcmUgY29sbGVjdGVkCiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHJhdGU7CgogICAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKCiAgICAvKioKICAgICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAgICovCiAgICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCwgU2lyaW5TbWFydFRva2VuIF90b2tlbikgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPj0gbm93KTsKICAgICAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgICAgICByZXF1aXJlKF93YWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICAgICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgfQoKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICAgIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChnZXRSYXRlKCkpOwoKICAgICAgICAvLyB1cGRhdGUgc3RhdGUKICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgICAgIHRva2VuLmlzc3VlKGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgdG9rZW5zKTsKCiAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CiAgICB9CgogICAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogICAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogICAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgfQoKICAgIC8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMKICAgIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICAgIH0KCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogICAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgICB9CgogICAgLy8gQHJldHVybiB0aGUgY3Jvd2RzYWxlIHJhdGUKICAgIGZ1bmN0aW9uIGdldFJhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHJhdGU7CiAgICB9CgoKfQoKCi8qKgogKiBAdGl0bGUgRmluYWxpemFibGVDcm93ZHNhbGUKICogQGRldiBFeHRlbnNpb24gb2YgQ3Jvd2RzYWxlIHdoZXJlIGFuIG93bmVyIGNhbiBkbyBleHRyYSB3b3JrCiAqIGFmdGVyIGZpbmlzaGluZy4KICovCmNvbnRyYWN0IEZpbmFsaXphYmxlQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgQ2xhaW1hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgYm9vbCBwdWJsaWMgaXNGaW5hbGl6ZWQgPSBmYWxzZTsKCiAgZXZlbnQgRmluYWxpemVkKCk7CgogIC8qKgogICAqIEBkZXYgTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgY3Jvd2RzYWxlIGVuZHMsIHRvIGRvIHNvbWUgZXh0cmEgZmluYWxpemF0aW9uCiAgICogd29yay4gQ2FsbHMgdGhlIGNvbnRyYWN0J3MgZmluYWxpemF0aW9uIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKGhhc0VuZGVkKCkpOwoKICAgIGZpbmFsaXphdGlvbigpOwogICAgRmluYWxpemVkKCk7CgogICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBDYW4gYmUgb3ZlcnJpZGRlbiB0byBhZGQgZmluYWxpemF0aW9uIGxvZ2ljLiBUaGUgb3ZlcnJpZGluZyBmdW5jdGlvbgogICAqIHNob3VsZCBjYWxsIHN1cGVyLmZpbmFsaXphdGlvbigpIHRvIGVuc3VyZSB0aGUgY2hhaW4gb2YgZmluYWxpemF0aW9uIGlzCiAgICogZXhlY3V0ZWQgZW50aXJlbHkuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogIH0KfQoKCgoKY29udHJhY3QgU2lyaW5Dcm93ZHNhbGUgaXMgRmluYWxpemFibGVDcm93ZHNhbGUgewoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc3RhbnRzCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gTWF4IGFtb3VudCBvZiBrbm93biBhZGRyZXNzZXMgb2Ygd2hpY2ggd2lsbCBnZXQgU1JOIGJ5ICdHcmFudCcgbWV0aG9kLgogICAgLy8KICAgIC8vIGdyYW50ZWVzIGFkZHJlc3NlcyB3aWxsIGJlIFNpcmluTGFicyB3YWxsZXRzIGFkZHJlc3Nlcy4KICAgIC8vIHRoZXNlIHdhbGxldHMgd2lsbCBjb250YWluIFNSTiB0b2tlbnMgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIDIgcHVycG9zZXMgb25seSAtCiAgICAvLyAxLiBTUk4gdG9rZW5zIGFnYWluc3QgcmFpc2VkIGZpYXQgbW9uZXkKICAgIC8vIDIuIFNSTiB0b2tlbnMgZm9yIHByZXNhbGUgYm9udXMuCiAgICAvLyB3ZSBzZXQgdGhlIHZhbHVlIHRvIDEwIChhbmQgbm90IHRvIDIpIGJlY2F1c2Ugd2Ugd2FudCB0byBhbGxvdyBzb21lIGZsZXhpYmlsaXR5IGZvciBjYXNlcyBsaWtlIGZpYXQgbW9uZXkgdGhhdCBpcyByYWlzZWQgY2xvc2UgdG8gdGhlIGNyb3dkc2FsZS4KICAgIC8vIHdlIGxpbWl0IHRoZSB2YWx1ZSB0byAxMCAoYW5kIG5vdCBsYXJnZXIpIHRvIGxpbWl0IHRoZSBydW4gdGltZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBwcm9jZXNzIHRoZSBncmFudGVlcyBhcnJheS4KICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBNQVhfVE9LRU5fR1JBTlRFRVMgPSAxMDsKCiAgICAvLyBTUk4gdG8gRVRIIGJhc2UgcmF0ZQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRVhDSEFOR0VfUkFURSA9IDUwMDsKCiAgICAvLyBSZWZ1bmQgZGl2aXNpb24gcmF0ZQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUkVGVU5EX0RJVklTSU9OX1JBVEUgPSAyOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kaWZpZXJzCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIG5vdCBkdXJpbmcgdGhlIGNyb3dkc2FsZSB0aW1lIGZyYW1lCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlXaGlsZVNhbGUoKSB7CiAgICAgICAgcmVxdWlyZShpc0FjdGl2ZSgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVtYmVycwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICAvLyB3YWxsZXRzIGFkZHJlc3MgZm9yIDYwJSBvZiBTUk4gYWxsb2NhdGlvbgogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0VGVhbTsgICAvLzEwJSBvZiB0aGUgdG90YWwgbnVtYmVyIG9mIFNSTiB0b2tlbnMgd2lsbCBiZSBhbGxvY2F0ZWQgdG8gdGhlIHRlYW0KICAgIGFkZHJlc3MgcHVibGljIHdhbGxldE9FTTsgICAgICAgLy8xMCUgb2YgdGhlIHRvdGFsIG51bWJlciBvZiBTUk4gdG9rZW5zIHdpbGwgYmUgYWxsb2NhdGVkIHRvIE9FTeKAmXMsIE9wZXJhdGluZyBTeXN0ZW0gaW1wbGVtZW50YXRpb24sIFNESyBkZXZlbG9wZXJzIGFuZCByZWJhdGUgdG8gZGV2aWNlIGFuZCBTaGllbGQgT1PihKIgdXNlcnMKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldEJvdW50aWVzOyAgLy81JSBvZiB0aGUgdG90YWwgbnVtYmVyIG9mIFNSTiB0b2tlbnMgd2lsbCBiZSBhbGxvY2F0ZWQgdG8gcHJvZmVzc2lvbmFsIGZlZXMgYW5kIEJvdW50aWVzCiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXRSZXNlcnZlOyAgIC8vMzUlIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgU1JOIHRva2VucyB3aWxsIGJlIGFsbG9jYXRlZCB0byBTSVJJTiBMQUJTIGFuZCBhcyBhIHJlc2VydmUgZm9yIHRoZSBjb21wYW55IHRvIGJlIHVzZWQgZm9yIGZ1dHVyZSBzdHJhdGVnaWMgcGxhbnMgZm9yIHRoZSBjcmVhdGVkIGVjb3N5c3RlbQoKICAgIC8vIEZ1bmRzIGNvbGxlY3RlZCBvdXRzaWRlIHRoZSBjcm93ZHNhbGUgaW4gd2VpCiAgICB1aW50MjU2IHB1YmxpYyBmaWF0UmFpc2VkQ29udmVydGVkVG9XZWk7CgogICAgLy9HcmFudGVlcyAtIHVzZWQgZm9yIG5vbi1ldGhlciBhbmQgcHJlc2FsZSBib251cyB0b2tlbiBnZW5lcmF0aW9uCiAgICBhZGRyZXNzW10gcHVibGljIHByZXNhbGVHcmFudGVlc01hcEtleXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwcmVzYWxlR3JhbnRlZXNNYXA7ICAvL2FkZHJlc3M9PndlaSB0b2tlbiBhbW91bnQKCiAgICAvLyBUaGUgcmVmdW5kIHZhdWx0CiAgICBSZWZ1bmRWYXVsdCBwdWJsaWMgcmVmdW5kVmF1bHQ7CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFdmVudHMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICBldmVudCBHcmFudEFkZGVkKGFkZHJlc3MgaW5kZXhlZCBfZ3JhbnRlZSwgdWludDI1NiBfYW1vdW50KTsKCiAgICBldmVudCBHcmFudFVwZGF0ZWQoYWRkcmVzcyBpbmRleGVkIF9ncmFudGVlLCB1aW50MjU2IF9vbGRBbW91bnQsIHVpbnQyNTYgX25ld0Ftb3VudCk7CgogICAgZXZlbnQgR3JhbnREZWxldGVkKGFkZHJlc3MgaW5kZXhlZCBfZ3JhbnRlZSwgdWludDI1NiBfaGFkQW1vdW50KTsKCiAgICBldmVudCBGaWF0UmFpc2VkVXBkYXRlZChhZGRyZXNzIGluZGV4ZWQgX2FkZHJlc3MsIHVpbnQyNTYgX2ZpYXRSYWlzZWQpOwoKICAgIGV2ZW50IFRva2VuUHVyY2hhc2VXaXRoR3VhcmFudGVlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc3RydWN0b3JzCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIGZ1bmN0aW9uIFNpcmluQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICBhZGRyZXNzIF93YWxsZXQsCiAgICBhZGRyZXNzIF93YWxsZXRUZWFtLAogICAgYWRkcmVzcyBfd2FsbGV0T0VNLAogICAgYWRkcmVzcyBfd2FsbGV0Qm91bnRpZXMsCiAgICBhZGRyZXNzIF93YWxsZXRSZXNlcnZlLAogICAgU2lyaW5TbWFydFRva2VuIF9zaXJpblNtYXJ0VG9rZW4sCiAgICBSZWZ1bmRWYXVsdCBfcmVmdW5kVmF1bHQpCiAgICBwdWJsaWMKICAgIENyb3dkc2FsZShfc3RhcnRUaW1lLCBfZW5kVGltZSwgRVhDSEFOR0VfUkFURSwgX3dhbGxldCwgX3NpcmluU21hcnRUb2tlbikgewogICAgICAgIHJlcXVpcmUoX3dhbGxldFRlYW0gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0T0VNICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3dhbGxldEJvdW50aWVzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3dhbGxldFJlc2VydmUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfc2lyaW5TbWFydFRva2VuICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3JlZnVuZFZhdWx0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB3YWxsZXRUZWFtID0gX3dhbGxldFRlYW07CiAgICAgICAgd2FsbGV0T0VNID0gX3dhbGxldE9FTTsKICAgICAgICB3YWxsZXRCb3VudGllcyA9IF93YWxsZXRCb3VudGllczsKICAgICAgICB3YWxsZXRSZXNlcnZlID0gX3dhbGxldFJlc2VydmU7CgogICAgICAgIHRva2VuID0gX3NpcmluU21hcnRUb2tlbjsKICAgICAgICByZWZ1bmRWYXVsdCAgPSBfcmVmdW5kVmF1bHQ7CiAgICB9CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbXBsIENyb3dkc2FsZQogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICAvLyBAcmV0dXJuIHRoZSByYXRlIGluIFNSTiBwZXIgMSBFVEggYWNjb3JkaW5nIHRvIHRoZSB0aW1lIG9mIHRoZSB0eCBhbmQgdGhlIFNSTiBwcmljaW5nIHByb2dyYW0uCiAgICAvLyBAT3ZlcnJpZGUKICAgIGZ1bmN0aW9uIGdldFJhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDI0IGhvdXJzKSkpIHtyZXR1cm4gMTAwMDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDIgZGF5cykpKSB7cmV0dXJuIDk1MDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDMgZGF5cykpKSB7cmV0dXJuIDkwMDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDQgZGF5cykpKSB7cmV0dXJuIDg1NTt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDUgZGF5cykpKSB7cmV0dXJuIDgxMDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDYgZGF5cykpKSB7cmV0dXJuIDc3MDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDcgZGF5cykpKSB7cmV0dXJuIDczMDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDggZGF5cykpKSB7cmV0dXJuIDY5MDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDkgZGF5cykpKSB7cmV0dXJuIDY1MDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDEwIGRheXMpKSkge3JldHVybiA2MTU7fQogICAgICAgIGlmIChub3cgPCAoc3RhcnRUaW1lLmFkZCgxMSBkYXlzKSkpIHtyZXR1cm4gNTgwO30KICAgICAgICBpZiAobm93IDwgKHN0YXJ0VGltZS5hZGQoMTIgZGF5cykpKSB7cmV0dXJuIDU1MDt9CiAgICAgICAgaWYgKG5vdyA8IChzdGFydFRpbWUuYWRkKDEzIGRheXMpKSkge3JldHVybiA1MjU7fQoKICAgICAgICByZXR1cm4gcmF0ZTsKICAgIH0KCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEltcGwgRmluYWxpemFibGVDcm93ZHNhbGUKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy9AT3ZlcnJpZGUKICAgIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc3VwZXIuZmluYWxpemF0aW9uKCk7CgogICAgICAgIC8vIGdyYW50aW5nIGJvbnVzZXMgZm9yIHRoZSBwcmUgY3Jvd2RzYWxlIGdyYW50ZWVzOgogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IHByZXNhbGVHcmFudGVlc01hcEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG9rZW4uaXNzdWUocHJlc2FsZUdyYW50ZWVzTWFwS2V5c1tpXSwgcHJlc2FsZUdyYW50ZWVzTWFwW3ByZXNhbGVHcmFudGVlc01hcEtleXNbaV1dKTsKICAgICAgICB9CgogICAgICAgIC8vIEFkZGluZyA2MCUgb2YgdGhlIHRvdGFsIHRva2VuIHN1cHBseSAoNDAlIHdlcmUgZ2VuZXJhdGVkIGR1cmluZyB0aGUgY3Jvd2RzYWxlKQogICAgICAgIC8vIDQwICogMi41ID0gMTAwCiAgICAgICAgdWludDI1NiBuZXdUb3RhbFN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCkubXVsKDI1MCkuZGl2KDEwMCk7CgogICAgICAgIC8vIDEwJSBvZiB0aGUgdG90YWwgbnVtYmVyIG9mIFNSTiB0b2tlbnMgd2lsbCBiZSBhbGxvY2F0ZWQgdG8gdGhlIHRlYW0KICAgICAgICB0b2tlbi5pc3N1ZSh3YWxsZXRUZWFtLCBuZXdUb3RhbFN1cHBseS5tdWwoMTApLmRpdigxMDApKTsKCiAgICAgICAgLy8gMTAlIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgU1JOIHRva2VucyB3aWxsIGJlIGFsbG9jYXRlZCB0byBPRU3igJlzLCBPcGVyYXRpbmcgU3lzdGVtIGltcGxlbWVudGF0aW9uLAogICAgICAgIC8vIFNESyBkZXZlbG9wZXJzIGFuZCByZWJhdGUgdG8gZGV2aWNlIGFuZCBTaXJpbiBPU+KEoiB1c2VycwogICAgICAgIHRva2VuLmlzc3VlKHdhbGxldE9FTSwgbmV3VG90YWxTdXBwbHkubXVsKDEwKS5kaXYoMTAwKSk7CgogICAgICAgIC8vIDUlIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgU1JOIHRva2VucyB3aWxsIGJlIGFsbG9jYXRlZCB0byBwcm9mZXNzaW9uYWwgZmVlcyBhbmQgQm91bnRpZXMKICAgICAgICB0b2tlbi5pc3N1ZSh3YWxsZXRCb3VudGllcywgbmV3VG90YWxTdXBwbHkubXVsKDUpLmRpdigxMDApKTsKCiAgICAgICAgLy8gMzUlIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgU1JOIHRva2VucyB3aWxsIGJlIGFsbG9jYXRlZCB0byBTSVJJTiBMQUJTLAogICAgICAgIC8vIGFuZCBhcyBhIHJlc2VydmUgZm9yIHRoZSBjb21wYW55IHRvIGJlIHVzZWQgZm9yIGZ1dHVyZSBzdHJhdGVnaWMgcGxhbnMgZm9yIHRoZSBjcmVhdGVkIGVjb3N5c3RlbQogICAgICAgIHRva2VuLmlzc3VlKHdhbGxldFJlc2VydmUsIG5ld1RvdGFsU3VwcGx5Lm11bCgzNSkuZGl2KDEwMCkpOwoKICAgICAgICAvLyBSZS1lbmFibGUgdHJhbnNmZXJzIGFmdGVyIHRoZSB0b2tlbiBzYWxlLgogICAgICAgIHRva2VuLmRpc2FibGVUcmFuc2ZlcnMoZmFsc2UpOwoKICAgICAgICAvLyBSZS1lbmFibGUgZGVzdHJveSBmdW5jdGlvbiBhZnRlciB0aGUgdG9rZW4gc2FsZS4KICAgICAgICB0b2tlbi5zZXREZXN0cm95RW5hYmxlZCh0cnVlKTsKCiAgICAgICAgLy8gRW5hYmxlIEVUSCByZWZ1bmRzIGFuZCB0b2tlbiBjbGFpbS4KICAgICAgICByZWZ1bmRWYXVsdC5lbmFibGVSZWZ1bmRzKCk7CgogICAgICAgIC8vIHRyYW5zZmVyIHRva2VuIG93bmVyc2hpcCB0byBjcm93ZHNhbGUgb3duZXIKICAgICAgICB0b2tlbi50cmFuc2Zlck93bmVyc2hpcChvd25lcik7CgogICAgICAgIC8vIHRyYW5zZmVyIHJlZnVuZFZhdWx0IG93bmVyc2hpcCB0byBjcm93ZHNhbGUgb3duZXIKICAgICAgICByZWZ1bmRWYXVsdC50cmFuc2Zlck93bmVyc2hpcChvd25lcik7CiAgICB9CgogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQdWJsaWMgTWV0aG9kcwogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIEByZXR1cm4gdGhlIHRvdGFsIGZ1bmRzIGNvbGxlY3RlZCBpbiB3ZWkoRVRIIGFuZCBub25lIEVUSCkuCiAgICBmdW5jdGlvbiBnZXRUb3RhbEZ1bmRzUmFpc2VkKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBmaWF0UmFpc2VkQ29udmVydGVkVG9XZWkuYWRkKHdlaVJhaXNlZCk7CiAgICB9CgogICAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaXMgYWN0aXZlLCBoZW5jZSB1c2VycyBjYW4gYnV5IHRva2VucwogICAgZnVuY3Rpb24gaXNBY3RpdmUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDwgZW5kVGltZTsKICAgIH0KCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4dGVybmFsIE1ldGhvZHMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvLyBAZGV2IEFkZHMvVXBkYXRlcyBhZGRyZXNzIGFuZCB0b2tlbiBhbGxvY2F0aW9uIGZvciB0b2tlbiBncmFudHMuCiAgICAvLyBHcmFudGVkIHRva2VucyBhcmUgYWxsb2NhdGVkIHRvIG5vbi1ldGhlciwgcHJlc2FsZSwgYnV5ZXJzLgogICAgLy8gQHBhcmFtIF9ncmFudGVlIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGdyYW50ZWUuCiAgICAvLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIHZhbHVlIG9mIHRoZSBncmFudCBpbiB3ZWkgdG9rZW4uCiAgICBmdW5jdGlvbiBhZGRVcGRhdGVHcmFudGVlKGFkZHJlc3MgX2dyYW50ZWUsIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCBvbmx5T3duZXIgb25seVdoaWxlU2FsZXsKICAgICAgICByZXF1aXJlKF9ncmFudGVlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIEFkZGluZyBuZXcga2V5IGlmIG5vdCBwcmVzZW50OgogICAgICAgIGlmIChwcmVzYWxlR3JhbnRlZXNNYXBbX2dyYW50ZWVdID09IDApIHsKICAgICAgICAgICAgcmVxdWlyZShwcmVzYWxlR3JhbnRlZXNNYXBLZXlzLmxlbmd0aCA8IE1BWF9UT0tFTl9HUkFOVEVFUyk7CiAgICAgICAgICAgIHByZXNhbGVHcmFudGVlc01hcEtleXMucHVzaChfZ3JhbnRlZSk7CiAgICAgICAgICAgIEdyYW50QWRkZWQoX2dyYW50ZWUsIF92YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBHcmFudFVwZGF0ZWQoX2dyYW50ZWUsIHByZXNhbGVHcmFudGVlc01hcFtfZ3JhbnRlZV0sIF92YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBwcmVzYWxlR3JhbnRlZXNNYXBbX2dyYW50ZWVdID0gX3ZhbHVlOwogICAgfQoKICAgIC8vIEBkZXYgZGVsZXRlcyBlbnRyaWVzIGZyb20gdGhlIGdyYW50cyBsaXN0LgogICAgLy8gQHBhcmFtIF9ncmFudGVlIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGdyYW50ZWUuCiAgICBmdW5jdGlvbiBkZWxldGVHcmFudGVlKGFkZHJlc3MgX2dyYW50ZWUpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5V2hpbGVTYWxlIHsKICAgICAgICByZXF1aXJlKF9ncmFudGVlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUocHJlc2FsZUdyYW50ZWVzTWFwW19ncmFudGVlXSAhPSAwKTsKCiAgICAgICAgLy9kZWxldGUgZnJvbSB0aGUgbWFwOgogICAgICAgIGRlbGV0ZSBwcmVzYWxlR3JhbnRlZXNNYXBbX2dyYW50ZWVdOwoKICAgICAgICAvL2RlbGV0ZSBmcm9tIHRoZSBhcnJheSAoa2V5cyk6CiAgICAgICAgdWludDI1NiBpbmRleDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBwcmVzYWxlR3JhbnRlZXNNYXBLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwcmVzYWxlR3JhbnRlZXNNYXBLZXlzW2ldID09IF9ncmFudGVlKSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwcmVzYWxlR3JhbnRlZXNNYXBLZXlzW2luZGV4XSA9IHByZXNhbGVHcmFudGVlc01hcEtleXNbcHJlc2FsZUdyYW50ZWVzTWFwS2V5cy5sZW5ndGggLSAxXTsKICAgICAgICBkZWxldGUgcHJlc2FsZUdyYW50ZWVzTWFwS2V5c1twcmVzYWxlR3JhbnRlZXNNYXBLZXlzLmxlbmd0aCAtIDFdOwogICAgICAgIHByZXNhbGVHcmFudGVlc01hcEtleXMubGVuZ3RoLS07CgogICAgICAgIEdyYW50RGVsZXRlZChfZ3JhbnRlZSwgcHJlc2FsZUdyYW50ZWVzTWFwW19ncmFudGVlXSk7CiAgICB9CgogICAgLy8gQGRldiBTZXQgZnVuZHMgY29sbGVjdGVkIG91dHNpZGUgdGhlIGNyb3dkc2FsZSBpbiB3ZWkuCiAgICAvLyAgbm90ZTogd2Ugbm90IHRvIHVzZSBhY2N1bXVsYXRvciB0byBhbGxvdyBmbGV4aWJpbGl0eSBpbiBjYXNlIG9mIGh1bWFuZSBtaXN0YWtlcy4KICAgIC8vIGZ1bmRzIGFyZSBjb252ZXJ0ZWQgdG8gd2VpIHVzaW5nIHRoZSBtYXJrZXQgY29udmVyc2lvbiByYXRlIG9mIFVTRFxFVEggb24gdGhlIGRheSBvbiB0aGUgcHVyY2hhc2UuCiAgICAvLyBAcGFyYW0gX2ZpYXRSYWlzZWRDb252ZXJ0ZWRUb1dlaSBudW1iZXIgb2Ygbm9uZSBldGggcmFpc2VkLgogICAgZnVuY3Rpb24gc2V0RmlhdFJhaXNlZENvbnZlcnRlZFRvV2VpKHVpbnQyNTYgX2ZpYXRSYWlzZWRDb252ZXJ0ZWRUb1dlaSkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlXaGlsZVNhbGUgewogICAgICAgIGZpYXRSYWlzZWRDb252ZXJ0ZWRUb1dlaSA9IF9maWF0UmFpc2VkQ29udmVydGVkVG9XZWk7CiAgICAgICAgRmlhdFJhaXNlZFVwZGF0ZWQobXNnLnNlbmRlciwgZmlhdFJhaXNlZENvbnZlcnRlZFRvV2VpKTsKICAgIH0KCiAgICAvLy8gQGRldiBBY2NlcHRzIG5ldyBvd25lcnNoaXAgb24gYmVoYWxmIG9mIHRoZSBTaXJpbkNyb3dkc2FsZSBjb250cmFjdC4gVGhpcyBjYW4gYmUgdXNlZCwgYnkgdGhlIHRva2VuIHNhbGUKICAgIC8vLyBjb250cmFjdCBpdHNlbGYgdG8gY2xhaW0gYmFjayBvd25lcnNoaXAgb2YgdGhlIFNpcmluU21hcnRUb2tlbiBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5Pd25lcnNoaXAoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHRva2VuLmNsYWltT3duZXJzaGlwKCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXB0cyBuZXcgb3duZXJzaGlwIG9uIGJlaGFsZiBvZiB0aGUgU2lyaW5Dcm93ZHNhbGUgY29udHJhY3QuIFRoaXMgY2FuIGJlIHVzZWQsIGJ5IHRoZSB0b2tlbiBzYWxlCiAgICAvLy8gY29udHJhY3QgaXRzZWxmIHRvIGNsYWltIGJhY2sgb3duZXJzaGlwIG9mIHRoZSByZWZ1bmRWYXVsdCBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kVmF1bHRPd25lcnNoaXAoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlZnVuZFZhdWx0LmNsYWltT3duZXJzaGlwKCk7CiAgICB9CgogICAgLy8gQGRldiBCdXkgdG9rZXMgd2l0aCBndWFyYW50ZWUKICAgIGZ1bmN0aW9uIGJ1eVRva2Vuc1dpdGhHdWFyYW50ZWUoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKGdldFJhdGUoKSk7CiAgICAgICAgdG9rZW5zID0gdG9rZW5zLmRpdihSRUZVTkRfRElWSVNJT05fUkFURSk7CgogICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICAgICAgdG9rZW4uaXNzdWUoYWRkcmVzcyhyZWZ1bmRWYXVsdCksIHRva2Vucyk7CgogICAgICAgIHJlZnVuZFZhdWx0LmRlcG9zaXQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyLCB0b2tlbnMpOwoKICAgICAgICBUb2tlblB1cmNoYXNlV2l0aEd1YXJhbnRlZShtc2cuc2VuZGVyLCBhZGRyZXNzKHJlZnVuZFZhdWx0KSwgd2VpQW1vdW50LCB0b2tlbnMpOwogICAgfQp9'.
	

]
