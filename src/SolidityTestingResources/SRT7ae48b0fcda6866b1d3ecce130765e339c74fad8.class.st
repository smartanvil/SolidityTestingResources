Class {
	#name : #SRT7ae48b0fcda6866b1d3ecce130765e339c74fad8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7ae48b0fcda6866b1d3ecce130765e339c74fad8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwoKY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCgovKioKICogQHRpdGxlIENyb3dkc2FsZQogKiBAZGV2IENyb3dkc2FsZSBpcyBhIGJhc2UgY29udHJhY3QgZm9yIG1hbmFnaW5nIGEgdG9rZW4gY3Jvd2RzYWxlLgogKiBDcm93ZHNhbGVzIGhhdmUgYSBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMsIHdoZXJlIGludmVzdG9ycyBjYW4gbWFrZQogKiB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKICogb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0CiAqIGFzIHRoZXkgYXJyaXZlLgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICBNaW50YWJsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKCiAgLy8gYWRkcmVzcyB3aGVyZSBmdW5kcyBhcmUgY29sbGVjdGVkCiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogIHVpbnQyNTYgcHVibGljIHJhdGU7CgogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwoKICAvKioKICAgKiBldmVudCBmb3IgdG9rZW4gcHVyY2hhc2UgbG9nZ2luZwogICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICogQHBhcmFtIHZhbHVlIHdlaXMgcGFpZCBmb3IgcHVyY2hhc2UKICAgKiBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICovCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCgogIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCkgcHVibGljIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKCiAgICB0b2tlbiA9IGNyZWF0ZVRva2VuQ29udHJhY3QoKTsKICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICByYXRlID0gX3JhdGU7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogIH0KCiAgLy8gY3JlYXRlcyB0aGUgdG9rZW4gdG8gYmUgc29sZC4KICAvLyBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBoYXZlIGNyb3dkc2FsZSBvZiBhIHNwZWNpZmljIG1pbnRhYmxlIHRva2VuLgogIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICByZXR1cm4gbmV3IE1pbnRhYmxlVG9rZW4oKTsKICB9CgoKICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKTsKCiAgICAvLyB1cGRhdGUgc3RhdGUKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgIGZvcndhcmRGdW5kcygpOwogIH0KCiAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogIC8vIG92ZXJyaWRlIHRvIGNyZWF0ZSBjdXN0b20gZnVuZCBmb3J3YXJkaW5nIG1lY2hhbmlzbXMKICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2U7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQoKCn0KCgovKioKICogQHRpdGxlIEZpbmFsaXphYmxlQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dkc2FsZSB3aGVyZSBhbiBvd25lciBjYW4gZG8gZXh0cmEgd29yawogKiBhZnRlciBmaW5pc2hpbmcuCiAqLwpjb250cmFjdCBGaW5hbGl6YWJsZUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwoKICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgLyoqCiAgICogQGRldiBNdXN0IGJlIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZW5kcywgdG8gZG8gc29tZSBleHRyYSBmaW5hbGl6YXRpb24KICAgKiB3b3JrLiBDYWxscyB0aGUgY29udHJhY3QncyBmaW5hbGl6YXRpb24gZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CgogICAgZmluYWxpemF0aW9uKCk7CiAgICBGaW5hbGl6ZWQoKTsKCiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbiBiZSBvdmVycmlkZGVuIHRvIGFkZCBmaW5hbGl6YXRpb24gbG9naWMuIFRoZSBvdmVycmlkaW5nIGZ1bmN0aW9uCiAgICogc2hvdWxkIGNhbGwgc3VwZXIuZmluYWxpemF0aW9uKCkgdG8gZW5zdXJlIHRoZSBjaGFpbiBvZiBmaW5hbGl6YXRpb24gaXMKICAgKiBleGVjdXRlZCBlbnRpcmVseS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBSZWZ1bmRWYXVsdAogKiBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCBmb3Igc3RvcmluZyBmdW5kcyB3aGlsZSBhIGNyb3dkc2FsZQogKiBpcyBpbiBwcm9ncmVzcy4gU3VwcG9ydHMgcmVmdW5kaW5nIHRoZSBtb25leSBpZiBjcm93ZHNhbGUgZmFpbHMsCiAqIGFuZCBmb3J3YXJkaW5nIGl0IGlmIGNyb3dkc2FsZSBpcyBzdWNjZXNzZnVsLgogKi8KY29udHJhY3QgUmVmdW5kVmF1bHQgaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGVudW0gU3RhdGUgeyBBY3RpdmUsIFJlZnVuZGluZywgQ2xvc2VkIH0KCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkOwogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKICBTdGF0ZSBwdWJsaWMgc3RhdGU7CgogIGV2ZW50IENsb3NlZCgpOwogIGV2ZW50IFJlZnVuZHNFbmFibGVkKCk7CiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCk7CgogIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KGFkZHJlc3MgX3dhbGxldCkgcHVibGljIHsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gY2xvc2UoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuQ2xvc2VkOwogICAgQ2xvc2VkKCk7CiAgICB3YWxsZXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICB9CgogIGZ1bmN0aW9uIGVuYWJsZVJlZnVuZHMoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5SZWZ1bmRpbmcpOwogICAgdWludDI1NiBkZXBvc2l0ZWRWYWx1ZSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl07CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gMDsKICAgIGludmVzdG9yLnRyYW5zZmVyKGRlcG9zaXRlZFZhbHVlKTsKICAgIFJlZnVuZGVkKGludmVzdG9yLCBkZXBvc2l0ZWRWYWx1ZSk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgoKCmNvbnRyYWN0IEZyZWV6YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50NjQpIGludGVybmFsIHJvb3RzOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDY0KSBpbnRlcm5hbCBjaGFpbnM7CgogICAgZXZlbnQgRnJlZXplZChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQ2NCByZWxlYXNlLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBSZWxlYXNlZChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgZ2V0cyBzdW1tYXJ5IGluZm9ybWF0aW9uIGFib3V0IGFsbCBmcmVlemUgdG9rZW5zIGZvciB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX2FkZHIgQWRkcmVzcyBvZiBmcmVlemUgdG9rZW5zIG93bmVyLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRGcmVlemluZ1N1bW1hcnlPZihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCB0b2tlbkFtb3VudCwgdWludCBmcmVlemluZ0NvdW50KSB7CiAgICAgICAgdWludCBjb3VudDsKICAgICAgICB1aW50IHRvdGFsOwogICAgICAgIHVpbnQ2NCByZWxlYXNlID0gcm9vdHNbX2FkZHJdOwogICAgICAgIHdoaWxlIChyZWxlYXNlICE9IDApIHsKICAgICAgICAgICAgY291bnQgKys7CiAgICAgICAgICAgIHRvdGFsICs9IGJhbGFuY2VPZihhZGRyZXNzKGtlY2NhazI1Nih0b0tleShfYWRkciwgcmVsZWFzZSkpKSk7CiAgICAgICAgICAgIHJlbGVhc2UgPSBjaGFpbnNbdG9LZXkoX2FkZHIsIHJlbGVhc2UpXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAodG90YWwsIGNvdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgZ2V0cyBmcmVlemluZyBlbmQgZGF0ZSBhbmQgZnJlZXppbmcgYmFsYW5jZSBmb3IgdGhlIGZyZWV6aW5nIHBvcnRpb24gc3BlY2lmaWVkIGJ5IGluZGV4LgogICAgICogQHBhcmFtIF9hZGRyIEFkZHJlc3Mgb2YgZnJlZXplIHRva2VucyBvd25lci4KICAgICAqIEBwYXJhbSBfaW5kZXggRnJlZXppbmcgcG9ydGlvbiBpbmRleC4gSXQgb3JkZXJlZCBieSByZWxlYXNlIGRhdGUgZGVzY2VuZGluZy4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0RnJlZXppbmcoYWRkcmVzcyBfYWRkciwgdWludCBfaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50NjQgX3JlbGVhc2UsIHVpbnQgX2JhbGFuY2UpIHsKICAgICAgICB1aW50NjQgcmVsZWFzZSA9IHJvb3RzW19hZGRyXTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfaW5kZXg7IGkgKyspIHsKICAgICAgICAgICAgcmVsZWFzZSA9IGNoYWluc1t0b0tleShfYWRkciwgcmVsZWFzZSldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKHJlbGVhc2UsIGJhbGFuY2VPZihhZGRyZXNzKGtlY2NhazI1Nih0b0tleShfYWRkciwgcmVsZWFzZSkpKSkpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBmcmVlemUgeW91ciB0b2tlbnMgdG8gdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgICogICAgICBCZSBjYXJlZnVsLCBnYXMgdXNhZ2UgaXMgbm90IGRldGVybWluaXN0aWMsCiAgICAgKiAgICAgIGFuZCBkZXBlbmRzIG9uIGhvdyBtYW55IGZyZWV6ZXMgX3RvIGFkZHJlc3MgYWxyZWFkeSBoYXMuCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gd2hpY2ggdG9rZW4gd2lsbCBiZSBmcmVlemUuCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBBbW91bnQgb2YgdG9rZW4gdG8gZnJlZXplLgogICAgICogQHBhcmFtIF91bnRpbCBSZWxlYXNlIGRhdGUsIG11c3QgYmUgaW4gZnV0dXJlLgogICAgICovCiAgICBmdW5jdGlvbiBmcmVlemVUbyhhZGRyZXNzIF90bywgdWludCBfYW1vdW50LCB1aW50NjQgX3VudGlsKSBwdWJsaWMgewogICAgICAgIGJ5dGVzMzIgY3VycmVudEtleSA9IHRvS2V5KF90bywgX3VudGlsKTsKICAgICAgICB0cmFuc2ZlcihhZGRyZXNzKGtlY2NhazI1NihjdXJyZW50S2V5KSksIF9hbW91bnQpOwoKICAgICAgICBmcmVlemUoX3RvLCBfdW50aWwpOwogICAgICAgIEZyZWV6ZWQoX3RvLCBfdW50aWwsIF9hbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZWxlYXNlIGZpcnN0IGF2YWlsYWJsZSBmcmVlemluZyB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VPbmNlKCkgcHVibGljIHsKICAgICAgICB1aW50NjQgaGVhZCA9IHJvb3RzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUoaGVhZCAhPSAwKTsKICAgICAgICByZXF1aXJlKHVpbnQ2NChibG9jay50aW1lc3RhbXApID4gaGVhZCk7CiAgICAgICAgYnl0ZXMzMiBjdXJyZW50S2V5ID0gdG9LZXkobXNnLnNlbmRlciwgaGVhZCk7CgogICAgICAgIHVpbnQ2NCBuZXh0ID0gY2hhaW5zW2N1cnJlbnRLZXldOwoKICAgICAgICBhZGRyZXNzIGN1cnJlbnRBZGRyZXNzID0gYWRkcmVzcyhrZWNjYWsyNTYoY3VycmVudEtleSkpOwogICAgICAgIHVpbnQgYW1vdW50ID0gYmFsYW5jZXNbY3VycmVudEFkZHJlc3NdOwogICAgICAgIGRlbGV0ZSBiYWxhbmNlc1tjdXJyZW50QWRkcmVzc107CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IGFtb3VudDsKCiAgICAgICAgaWYgKG5leHQgPT0gMCkgewogICAgICAgICAgICBkZWxldGUgcm9vdHNbbXNnLnNlbmRlcl07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByb290c1ttc2cuc2VuZGVyXSA9IG5leHQ7CiAgICAgICAgfQogICAgICAgIFJlbGVhc2VkKG1zZy5zZW5kZXIsIGFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlbGVhc2UgYWxsIGF2YWlsYWJsZSBmb3IgcmVsZWFzZSBmcmVlemluZyB0b2tlbnMuIEdhcyB1c2FnZSBpcyBub3QgZGV0ZXJtaW5pc3RpYyEKICAgICAqIEByZXR1cm4gaG93IG1hbnkgdG9rZW5zIHdhcyByZWxlYXNlZAogICAgICovCiAgICBmdW5jdGlvbiByZWxlYXNlQWxsKCkgcHVibGljIHJldHVybnMgKHVpbnQgdG9rZW5zKSB7CiAgICAgICAgdWludCByZWxlYXNlOwogICAgICAgIHVpbnQgYmFsYW5jZTsKICAgICAgICAocmVsZWFzZSwgYmFsYW5jZSkgPSBnZXRGcmVlemluZyhtc2cuc2VuZGVyLCAwKTsKICAgICAgICB3aGlsZSAocmVsZWFzZSAhPSAwICYmIGJsb2NrLnRpbWVzdGFtcCA+IHJlbGVhc2UpIHsKICAgICAgICAgICAgcmVsZWFzZU9uY2UoKTsKICAgICAgICAgICAgdG9rZW5zICs9IGJhbGFuY2U7CiAgICAgICAgICAgIChyZWxlYXNlLCBiYWxhbmNlKSA9IGdldEZyZWV6aW5nKG1zZy5zZW5kZXIsIDApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleShhZGRyZXNzIF9hZGRyLCB1aW50IF9yZWxlYXNlKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyIHJlc3VsdCkgewogICAgICAgIC8vIFdJU0ggbWFzYyB0byBpbmNyZWFzZSBlbnRyb3B5CiAgICAgICAgcmVzdWx0ID0gMHg1NzQ5NTM0ODAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmVzdWx0IDo9IG9yKHJlc3VsdCwgbXVsKF9hZGRyLCAweDEwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgcmVzdWx0IDo9IG9yKHJlc3VsdCwgX3JlbGVhc2UpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZyZWV6ZShhZGRyZXNzIF90bywgdWludDY0IF91bnRpbCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX3VudGlsID4gYmxvY2sudGltZXN0YW1wKTsKICAgICAgICB1aW50NjQgaGVhZCA9IHJvb3RzW190b107CgogICAgICAgIGlmIChoZWFkID09IDApIHsKICAgICAgICAgICAgcm9vdHNbX3RvXSA9IF91bnRpbDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBoZWFkS2V5ID0gdG9LZXkoX3RvLCBoZWFkKTsKICAgICAgICB1aW50IHBhcmVudDsKICAgICAgICBieXRlczMyIHBhcmVudEtleTsKCiAgICAgICAgd2hpbGUgKGhlYWQgIT0gMCAmJiBfdW50aWwgPiBoZWFkKSB7CiAgICAgICAgICAgIHBhcmVudCA9IGhlYWQ7CiAgICAgICAgICAgIHBhcmVudEtleSA9IGhlYWRLZXk7CgogICAgICAgICAgICBoZWFkID0gY2hhaW5zW2hlYWRLZXldOwogICAgICAgICAgICBoZWFkS2V5ID0gdG9LZXkoX3RvLCBoZWFkKTsKICAgICAgICB9CgogICAgICAgIGlmIChfdW50aWwgPT0gaGVhZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoaGVhZCAhPSAwKSB7CiAgICAgICAgICAgIGNoYWluc1t0b0tleShfdG8sIF91bnRpbCldID0gaGVhZDsKICAgICAgICB9CgogICAgICAgIGlmIChwYXJlbnQgPT0gMCkgewogICAgICAgICAgICByb290c1tfdG9dID0gX3VudGlsOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY2hhaW5zW3BhcmVudEtleV0gPSBfdW50aWw7CiAgICAgICAgfQogICAgfQp9CgovKioKICogQHRpdGxlIEJ1cm5hYmxlIFRva2VuCiAqIEBkZXYgVG9rZW4gdGhhdCBjYW4gYmUgaXJyZXZlcnNpYmx5IGJ1cm5lZCAoZGVzdHJveWVkKS4KICovCmNvbnRyYWN0IEJ1cm5hYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvKioKICAgICAqIEBkZXYgQnVybnMgYSBzcGVjaWZpYyBhbW91bnQgb2YgdG9rZW5zLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIGJ1cm5lZC4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKICAgICAgICAvLyBubyBuZWVkIHRvIHJlcXVpcmUgdmFsdWUgPD0gdG90YWxTdXBwbHksIHNpbmNlIHRoYXQgd291bGQgaW1wbHkgdGhlCiAgICAgICAgLy8gc2VuZGVyJ3MgYmFsYW5jZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRvdGFsU3VwcGx5LCB3aGljaCAqc2hvdWxkKiBiZSBhbiBhc3NlcnRpb24gZmFpbHVyZQoKICAgICAgICBhZGRyZXNzIGJ1cm5lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgYmFsYW5jZXNbYnVybmVyXSA9IGJhbGFuY2VzW2J1cm5lcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlKTsKICAgICAgICBCdXJuKGJ1cm5lciwgX3ZhbHVlKTsKICAgIH0KfQoKCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCgoKLyoqCiAqIEB0aXRsZSBUb2tlblRpbWVsb2NrCiAqIEBkZXYgVG9rZW5UaW1lbG9jayBpcyBhIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IHdpbGwgYWxsb3cgYQogKiBiZW5lZmljaWFyeSB0byBleHRyYWN0IHRoZSB0b2tlbnMgYWZ0ZXIgYSBnaXZlbiByZWxlYXNlIHRpbWUKICovCmNvbnRyYWN0IFRva2VuVGltZWxvY2sgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLy8gRVJDMjAgYmFzaWMgdG9rZW4gY29udHJhY3QgYmVpbmcgaGVsZAogIEVSQzIwQmFzaWMgcHVibGljIHRva2VuOwoKICAvLyBiZW5lZmljaWFyeSBvZiB0b2tlbnMgYWZ0ZXIgdGhleSBhcmUgcmVsZWFzZWQKICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKCiAgLy8gdGltZXN0YW1wIHdoZW4gdG9rZW4gcmVsZWFzZSBpcyBlbmFibGVkCiAgdWludDY0IHB1YmxpYyByZWxlYXNlVGltZTsKCiAgZnVuY3Rpb24gVG9rZW5UaW1lbG9jayhFUkMyMEJhc2ljIF90b2tlbiwgYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQ2NCBfcmVsZWFzZVRpbWUpIHB1YmxpYyB7CiAgICByZXF1aXJlKF9yZWxlYXNlVGltZSA+IG5vdyk7CiAgICB0b2tlbiA9IF90b2tlbjsKICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogICAgcmVsZWFzZVRpbWUgPSBfcmVsZWFzZVRpbWU7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIFRyYW5zZmVycyB0b2tlbnMgaGVsZCBieSB0aW1lbG9jayB0byBiZW5lZmljaWFyeS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlKCkgcHVibGljIHsKICAgIHJlcXVpcmUobm93ID49IHJlbGVhc2VUaW1lKTsKCiAgICB1aW50MjU2IGFtb3VudCA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHJlcXVpcmUoYW1vdW50ID4gMCk7CgogICAgdG9rZW4uc2FmZVRyYW5zZmVyKGJlbmVmaWNpYXJ5LCBhbW91bnQpOwogIH0KfQoKCgpjb250cmFjdCBGcmVlemFibGVNaW50YWJsZVRva2VuIGlzIEZyZWV6YWJsZVRva2VuLCBNaW50YWJsZVRva2VuIHsKICAgIC8qKgogICAgICogQGRldiBNaW50IHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VuIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBhbmQgZnJlZXplIGl0IHVudGlsIHRoZSBzcGVjaWZpZWQgZGF0ZS4KICAgICAqICAgICAgQmUgY2FyZWZ1bCwgZ2FzIHVzYWdlIGlzIG5vdCBkZXRlcm1pbmlzdGljLAogICAgICogICAgICBhbmQgZGVwZW5kcyBvbiBob3cgbWFueSBmcmVlemVzIF90byBhZGRyZXNzIGFscmVhZHkgaGFzLgogICAgICogQHBhcmFtIF90byBBZGRyZXNzIHRvIHdoaWNoIHRva2VuIHdpbGwgYmUgZnJlZXplLgogICAgICogQHBhcmFtIF9hbW91bnQgQW1vdW50IG9mIHRva2VuIHRvIG1pbnQgYW5kIGZyZWV6ZS4KICAgICAqIEBwYXJhbSBfdW50aWwgUmVsZWFzZSBkYXRlLCBtdXN0IGJlIGluIGZ1dHVyZS4KICAgICAqLwogICAgZnVuY3Rpb24gbWludEFuZEZyZWV6ZShhZGRyZXNzIF90bywgdWludCBfYW1vdW50LCB1aW50NjQgX3VudGlsKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBieXRlczMyIGN1cnJlbnRLZXkgPSB0b0tleShfdG8sIF91bnRpbCk7CiAgICAgICAgbWludChhZGRyZXNzKGtlY2NhazI1NihjdXJyZW50S2V5KSksIF9hbW91bnQpOwoKICAgICAgICBmcmVlemUoX3RvLCBfdW50aWwpOwogICAgICAgIEZyZWV6ZWQoX3RvLCBfdW50aWwsIF9hbW91bnQpOwogICAgfQp9Cgpjb250cmFjdCB1c2luZ0NvbnN0cyB7CiAgICB1aW50IGNvbnN0YW50IFRPS0VOX0RFQ0lNQUxTID0gMTg7CiAgICB1aW50OCBjb25zdGFudCBUT0tFTl9ERUNJTUFMU19VSU5UOCA9IDE4OwogICAgdWludCBjb25zdGFudCBUT0tFTl9ERUNJTUFMX01VTFRJUExJRVIgPSAxMCAqKiBUT0tFTl9ERUNJTUFMUzsKCiAgICBzdHJpbmcgY29uc3RhbnQgVE9LRU5fTkFNRSA9ICJQaGFybWFUb2tlbiI7CiAgICBzdHJpbmcgY29uc3RhbnQgVE9LRU5fU1lNQk9MID0gIlJ4VCI7CiAgICBib29sIGNvbnN0YW50IFBBVVNFRCA9IHRydWU7CiAgICBhZGRyZXNzIGNvbnN0YW50IFRBUkdFVF9VU0VSID0gMHgwM0ZiZEE1MDg3NkY5YjJCZTk0QUE5ZDJDZGJlNUJFODRmMzRFODUxOwogICAgdWludCBjb25zdGFudCBTVEFSVF9USU1FID0gMTUyMTgzMjYyMDsKICAgIGJvb2wgY29uc3RhbnQgQ09OVElOVUVfTUlOVElORyA9IGZhbHNlOwp9CgoKCmNvbnRyYWN0IE1haW5Ub2tlbiBpcyB1c2luZ0NvbnN0cywgRnJlZXphYmxlTWludGFibGVUb2tlbiwgQnVybmFibGVUb2tlbiwgUGF1c2FibGUgewogICAgZnVuY3Rpb24gTWFpblRva2VuKCkgewogICAgfQoKICAgIGZ1bmN0aW9uIG5hbWUoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoc3RyaW5nIF9uYW1lKSB7CiAgICAgICAgcmV0dXJuIFRPS0VOX05BTUU7CiAgICB9CgogICAgZnVuY3Rpb24gc3ltYm9sKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHN0cmluZyBfc3ltYm9sKSB7CiAgICAgICAgcmV0dXJuIFRPS0VOX1NZTUJPTDsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNpbWFscygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50OCBfZGVjaW1hbHMpIHsKICAgICAgICByZXR1cm4gVE9LRU5fREVDSU1BTFNfVUlOVDg7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBfc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBfc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgQ2FwcGVkQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dkc2FsZSB3aXRoIGEgbWF4IGFtb3VudCBvZiBmdW5kcyByYWlzZWQKICovCmNvbnRyYWN0IENhcHBlZENyb3dkc2FsZSBpcyBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICB1aW50MjU2IHB1YmxpYyBjYXA7CgogIGZ1bmN0aW9uIENhcHBlZENyb3dkc2FsZSh1aW50MjU2IF9jYXApIHB1YmxpYyB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSN2YWxpZFB1cmNoYXNlIHRvIGFkZCBleHRyYSBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3JzIGNhbiBidXkgYXQgdGhlIG1vbWVudAogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluQ2FwID0gd2VpUmFpc2VkLmFkZChtc2cudmFsdWUpIDw9IGNhcDsKICAgIHJldHVybiBzdXBlci52YWxpZFB1cmNoYXNlKCkgJiYgd2l0aGluQ2FwOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICBib29sIGNhcFJlYWNoZWQgPSB3ZWlSYWlzZWQgPj0gY2FwOwogICAgcmV0dXJuIHN1cGVyLmhhc0VuZGVkKCkgfHwgY2FwUmVhY2hlZDsKICB9Cgp9CgoKCi8qKgogKiBAdGl0bGUgUmVmdW5kYWJsZUNyb3dkc2FsZQogKiBAZGV2IEV4dGVuc2lvbiBvZiBDcm93ZHNhbGUgY29udHJhY3QgdGhhdCBhZGRzIGEgZnVuZGluZyBnb2FsLCBhbmQKICogdGhlIHBvc3NpYmlsaXR5IG9mIHVzZXJzIGdldHRpbmcgYSByZWZ1bmQgaWYgZ29hbCBpcyBub3QgbWV0LgogKiBVc2VzIGEgUmVmdW5kVmF1bHQgYXMgdGhlIGNyb3dkc2FsZSdzIHZhdWx0LgogKi8KY29udHJhY3QgUmVmdW5kYWJsZUNyb3dkc2FsZSBpcyBGaW5hbGl6YWJsZUNyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIG1pbmltdW0gYW1vdW50IG9mIGZ1bmRzIHRvIGJlIHJhaXNlZCBpbiB3ZWlzCiAgdWludDI1NiBwdWJsaWMgZ29hbDsKCiAgLy8gcmVmdW5kIHZhdWx0IHVzZWQgdG8gaG9sZCBmdW5kcyB3aGlsZSBjcm93ZHNhbGUgaXMgcnVubmluZwogIFJlZnVuZFZhdWx0IHB1YmxpYyB2YXVsdDsKCiAgZnVuY3Rpb24gUmVmdW5kYWJsZUNyb3dkc2FsZSh1aW50MjU2IF9nb2FsKSBwdWJsaWMgewogICAgcmVxdWlyZShfZ29hbCA+IDApOwogICAgdmF1bHQgPSBuZXcgUmVmdW5kVmF1bHQod2FsbGV0KTsKICAgIGdvYWwgPSBfZ29hbDsKICB9CgogIC8vIFdlJ3JlIG92ZXJyaWRpbmcgdGhlIGZ1bmQgZm9yd2FyZGluZyBmcm9tIENyb3dkc2FsZS4KICAvLyBJbiBhZGRpdGlvbiB0byBzZW5kaW5nIHRoZSBmdW5kcywgd2Ugd2FudCB0byBjYWxsCiAgLy8gdGhlIFJlZnVuZFZhdWx0IGRlcG9zaXQgZnVuY3Rpb24KICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgfQoKICAvLyBpZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBpbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZHMgaGVyZQogIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZSghZ29hbFJlYWNoZWQoKSk7CgogICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogIH0KCiAgLy8gdmF1bHQgZmluYWxpemF0aW9uIHRhc2ssIGNhbGxlZCB3aGVuIG93bmVyIGNhbGxzIGZpbmFsaXplKCkKICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewogICAgICB2YXVsdC5jbG9zZSgpOwogICAgfSBlbHNlIHsKICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgfQoKICAgIHN1cGVyLmZpbmFsaXphdGlvbigpOwogIH0KCiAgZnVuY3Rpb24gZ29hbFJlYWNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IGdvYWw7CiAgfQoKfQoKCmNvbnRyYWN0IE1haW5Dcm93ZHNhbGUgaXMgdXNpbmdDb25zdHMsIEZpbmFsaXphYmxlQ3Jvd2RzYWxlIHsKICAgIGZ1bmN0aW9uIGhhc1N0YXJ0ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBub3cgPj0gc3RhcnRUaW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgICAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKCiAgICAgICAgaWYgKFBBVVNFRCkgewogICAgICAgICAgICBNYWluVG9rZW4odG9rZW4pLnVucGF1c2UoKTsKICAgICAgICB9CgogICAgICAgIGlmICghQ09OVElOVUVfTUlOVElORykgewogICAgICAgICAgICB0b2tlbi5maW5pc2hNaW50aW5nKCk7CiAgICAgICAgfQoKICAgICAgICB0b2tlbi50cmFuc2Zlck93bmVyc2hpcChUQVJHRVRfVVNFUik7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKS5kaXYoMSBldGhlcik7CgogICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICAgICAgdG9rZW4ubWludChiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CgogICAgICAgIGZvcndhcmRGdW5kcygpOwogICAgfQp9CgoKY29udHJhY3QgQ2hlY2thYmxlIHsKICAgIGFkZHJlc3MgcHJpdmF0ZSBzZXJ2aWNlQWNjb3VudDsKICAgIC8qKgogICAgICogRmxhZyBtZWFucyB0aGF0IGNvbnRyYWN0IGFjY2lkZW50IGFscmVhZHkgb2NjdXJzLgogICAgICovCiAgICBib29sIHByaXZhdGUgdHJpZ2dlcmVkID0gZmFsc2U7CgogICAgLy8gT2NjdXJzIHdoZW4gYWNjaWRlbnQgaGFwcGVuZWQuCiAgICBldmVudCBUcmlnZ2VyZWQodWludCBiYWxhbmNlKTsKCiAgICBmdW5jdGlvbiBDaGVja2FibGUoKSBwdWJsaWMgewogICAgICAgIHNlcnZpY2VBY2NvdW50ID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmVwbGFjZSBzZXJ2aWNlIGFjY291bnQgd2l0aCBuZXcgb25lLgogICAgICogQHBhcmFtIF9hY2NvdW50IFZhbGlkIHNlcnZpY2UgYWNjb3VudCBhZGRyZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VTZXJ2aWNlQWNjb3VudChhZGRyZXNzIF9hY2NvdW50KSBvbmx5U2VydmljZSBwdWJsaWMgewogICAgICAgIGFzc2VydChfYWNjb3VudCAhPSAwKTsKICAgICAgICBzZXJ2aWNlQWNjb3VudCA9IF9hY2NvdW50OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBJcyBjYWxsZXIgKHNlbmRlcikgc2VydmljZSBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBpc1NlcnZpY2VBY2NvdW50KCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbXNnLnNlbmRlciA9PSBzZXJ2aWNlQWNjb3VudDsKICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBjaGVjayBtZXRob2QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrKCkgb25seVNlcnZpY2Ugbm90VHJpZ2dlcmVkIHBheWFibGUgcHVibGljIHsKICAgICAgICBpZiAoaW50ZXJuYWxDaGVjaygpKSB7CiAgICAgICAgICAgIFRyaWdnZXJlZCh0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICB0cmlnZ2VyZWQgPSB0cnVlOwogICAgICAgICAgICBpbnRlcm5hbEFjdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRG8gaW5uZXIgY2hlY2suCiAgICAgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBvZiBhY2NpZGVudCB0cmlnZ2VyZWQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gaW50ZXJuYWxDaGVjaygpIGludGVybmFsIHJldHVybnMgKGJvb2wpOwoKICAgIC8qKgogICAgICogQGRldiBEbyBpbm5lciBhY3Rpb24gaWYgY2hlY2sgd2FzIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludGVybmFsQWN0aW9uKCkgaW50ZXJuYWw7CgogICAgbW9kaWZpZXIgb25seVNlcnZpY2UgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZXJ2aWNlQWNjb3VudCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RUcmlnZ2VyZWQoKSB7CiAgICAgICAgcmVxdWlyZSghdHJpZ2dlcmVkKTsKICAgICAgICBfOwogICAgfQp9CgoKY29udHJhY3QgQm9udXNhYmxlQ3Jvd2RzYWxlIGlzIHVzaW5nQ29uc3RzLCBDcm93ZHNhbGUgewoKICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CgogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgICAgICB1aW50MjU2IGJvbnVzUmF0ZSA9IGdldEJvbnVzUmF0ZSh3ZWlBbW91bnQpOwogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChib251c1JhdGUpLmRpdigxIGV0aGVyKTsKCiAgICAgICAgLy8gdXBkYXRlIHN0YXRlCiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgICAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgdG9rZW5zKTsKCiAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Qm9udXNSYXRlKHVpbnQyNTYgd2VpQW1vdW50KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBib251c1JhdGUgPSByYXRlOwoKICAgICAgICAKICAgICAgICAvLyBhcHBseSBib251cyBmb3IgdGltZSAmIHdlaVJhaXNlZAogICAgICAgIHVpbnRbNF0gbWVtb3J5IHdlaVJhaXNlZFN0YXJ0c0JvdW5kYXJpZXMgPSBbdWludCgwKSx1aW50KDI1MDAwMDAwMDAwMDAwMDAwMDAwMDApLHVpbnQoNzUwMDAwMDAwMDAwMDAwMDAwMDAwMCksdWludCgzMjUwMDAwMDAwMDAwMDAwMDAwMDAwMCldOwogICAgICAgIHVpbnRbNF0gbWVtb3J5IHdlaVJhaXNlZEVuZHNCb3VuZGFyaWVzID0gW3VpbnQoMjUwMDAwMDAwMDAwMDAwMDAwMDAwMCksdWludCg3NTAwMDAwMDAwMDAwMDAwMDAwMDAwKSx1aW50KDMyNTAwMDAwMDAwMDAwMDAwMDAwMDAwKSx1aW50KDkwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKV07CiAgICAgICAgdWludDY0WzRdIG1lbW9yeSB0aW1lU3RhcnRzQm91bmRhcmllcyA9IFt1aW50NjQoMTUyMTgzMjYyMCksdWludDY0KDE1MjE4MzI2MjApLHVpbnQ2NCgxNTIxODMyNjIwKSx1aW50NjQoMTUyMTgzMjYyMCldOwogICAgICAgIHVpbnQ2NFs0XSBtZW1vcnkgdGltZUVuZHNCb3VuZGFyaWVzID0gW3VpbnQ2NCgxNTI0NTExMDIwKSx1aW50NjQoMTUyNzE4OTQxNSksdWludDY0KDE1MjcxODk0MTUpLHVpbnQ2NCgxNTI3MTg5NDE1KV07CiAgICAgICAgdWludFs0XSBtZW1vcnkgd2VpUmFpc2VkQW5kVGltZVJhdGVzID0gW3VpbnQoMTAwMCksdWludCg3NTApLHVpbnQoNTAwKSx1aW50KDI1MCldOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgICAgYm9vbCB3ZWlSYWlzZWRJbkJvdW5kID0gKHdlaVJhaXNlZFN0YXJ0c0JvdW5kYXJpZXNbaV0gPD0gd2VpUmFpc2VkKSAmJiAod2VpUmFpc2VkIDwgd2VpUmFpc2VkRW5kc0JvdW5kYXJpZXNbaV0pOwogICAgICAgICAgICBib29sIHRpbWVJbkJvdW5kID0gKHRpbWVTdGFydHNCb3VuZGFyaWVzW2ldIDw9IG5vdykgJiYgKG5vdyA8IHRpbWVFbmRzQm91bmRhcmllc1tpXSk7CiAgICAgICAgICAgIGlmICh3ZWlSYWlzZWRJbkJvdW5kICYmIHRpbWVJbkJvdW5kKSB7CiAgICAgICAgICAgICAgICBib251c1JhdGUgKz0gYm9udXNSYXRlICogd2VpUmFpc2VkQW5kVGltZVJhdGVzW2ldIC8gMTAwMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKCiAgICAgICAgCiAgICAgICAgLy8gYXBwbHkgYW1vdW50CiAgICAgICAgdWludFszXSBtZW1vcnkgd2VpQW1vdW50Qm91bmRhcmllcyA9IFt1aW50KDEwMDAwMDAwMDAwMDAwMDAwMDAwKSx1aW50KDEwMDAwMDAwMDAwMDAwMDAwMDAwKSx1aW50KDEwMDAwMDAwMDAwMDAwMDAwMDApXTsKICAgICAgICB1aW50WzNdIG1lbW9yeSB3ZWlBbW91bnRSYXRlcyA9IFt1aW50KDI1MCksdWludCgwKSx1aW50KDUwKV07CgogICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgICBpZiAod2VpQW1vdW50ID49IHdlaUFtb3VudEJvdW5kYXJpZXNbal0pIHsKICAgICAgICAgICAgICAgIGJvbnVzUmF0ZSArPSBib251c1JhdGUgKiB3ZWlBbW91bnRSYXRlc1tqXSAvIDEwMDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKCiAgICAgICAgcmV0dXJuIGJvbnVzUmF0ZTsKICAgIH0KfQoKCgpjb250cmFjdCBUZW1wbGF0ZUNyb3dkc2FsZSBpcyB1c2luZ0NvbnN0cywgTWFpbkNyb3dkc2FsZQogICAgCiAgICAsIEJvbnVzYWJsZUNyb3dkc2FsZQogICAgCiAgICAKICAgICwgQ2FwcGVkQ3Jvd2RzYWxlCiAgICAKICAgICwgQ2hlY2thYmxlCiAgICAKewogICAgZXZlbnQgSW5pdGlhbGl6ZWQoKTsKICAgIGJvb2wgcHVibGljIGluaXRpYWxpemVkID0gZmFsc2U7CgogICAgZnVuY3Rpb24gVGVtcGxhdGVDcm93ZHNhbGUoTWludGFibGVUb2tlbiBfdG9rZW4pCiAgICAgICAgQ3Jvd2RzYWxlKFNUQVJUX1RJTUUgPiBub3cgPyBTVEFSVF9USU1FIDogbm93LCAxNTI3MTg5NDIwLCAxMDAwICogVE9LRU5fREVDSU1BTF9NVUxUSVBMSUVSLCAweDAzNTlDMTc3Mjc4M2NhRWY1ODg3ZmJlMTIwZEU3YzBhNjIzOGMxMEEpCiAgICAgICAgQ2FwcGVkQ3Jvd2RzYWxlKDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkKICAgICAgICAKICAgIHsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0KCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZSghaW5pdGlhbGl6ZWQpOwogICAgICAgIGluaXRpYWxpemVkID0gdHJ1ZTsKCiAgICAgICAgaWYgKFBBVVNFRCkgewogICAgICAgICAgICBNYWluVG9rZW4odG9rZW4pLnBhdXNlKCk7CiAgICAgICAgfQoKICAgICAgICAKICAgICAgICBhZGRyZXNzWzJdIG1lbW9yeSBhZGRyZXNzZXMgPSBbYWRkcmVzcygweDNjZTlmMzc5YjUxMTNmN2ZkNjEwNmFiMWQ4ZWY5M2RhY2IzZGNkYWYpLGFkZHJlc3MoMHhiZDQxOWE5Y2Q5MDRiNjYxMGYzMDAxNThmZTM5YWMyNjA5OGIwY2M1KV07CiAgICAgICAgdWludFsyXSBtZW1vcnkgYW1vdW50cyA9IFt1aW50KDI1MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSx1aW50KDI1MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKV07CiAgICAgICAgdWludDY0WzJdIG1lbW9yeSBmcmVlemVzID0gW3VpbnQ2NCgwKSx1aW50NjQoMCldOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhZGRyZXNzZXMubGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIGlmIChmcmVlemVzW2ldID09IDApIHsKICAgICAgICAgICAgICAgIHRva2VuLm1pbnQoYWRkcmVzc2VzW2ldLCBhbW91bnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEZyZWV6YWJsZU1pbnRhYmxlVG9rZW4odG9rZW4pLm1pbnRBbmRGcmVlemUoYWRkcmVzc2VzW2ldLCBhbW91bnRzW2ldLCBmcmVlemVzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKCiAgICAgICAgdHJhbnNmZXJPd25lcnNoaXAoVEFSR0VUX1VTRVIpOwogICAgICAgIEluaXRpYWxpemVkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IG92ZXJyaWRlIHRva2VuIGNyZWF0aW9uIHRvIHNldCB0b2tlbiBhZGRyZXNzIGluIGNvbnN0cnVjdG9yLgogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAoTWludGFibGVUb2tlbikgewogICAgICAgIHJldHVybiBNaW50YWJsZVRva2VuKDApOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IERvIGlubmVyIGNoZWNrLgogICAgICogQHJldHVybiBib29sIHRydWUgb2YgYWNjaWRlbnQgdHJpZ2dlcmVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludGVybmFsQ2hlY2soKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICFpc0ZpbmFsaXplZCAmJiBoYXNFbmRlZCgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEbyBpbm5lciBhY3Rpb24gaWYgY2hlY2sgd2FzIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludGVybmFsQWN0aW9uKCkgaW50ZXJuYWwgewogICAgICAgIGZpbmFsaXphdGlvbigpOwogICAgICAgIEZpbmFsaXplZCgpOwoKICAgICAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgICB9CiAgICAKfQ=='.
	

]
