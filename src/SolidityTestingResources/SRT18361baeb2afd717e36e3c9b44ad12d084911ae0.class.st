Class {
	#name : #SRT18361baeb2afd717e36e3c9b44ad12d084911ae0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT18361baeb2afd717e36e3c9b44ad12d084911ae0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKY29udHJhY3QgU2FmZU1hdGggewoKCWZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCXVpbnQyNTYgYyA9IGEgKyBiOwoJCWFzc2VydChjID49IGEgJiYgYyA+PSBiKTsKCQlyZXR1cm4gYzsKCX0KCglmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQlhc3NlcnQoYiA8PSBhKTsKCQlyZXR1cm4gYSAtIGI7Cgl9CgoJZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CgkJdWludDI1NiBjID0gYSAqIGI7CgkJYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKCQlyZXR1cm4gYzsKCX0KCglmdW5jdGlvbiBzYWZlRGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQlhc3NlcnQoYiA+IDApOwoJCXVpbnQyNTYgYyA9IGEgLyBiOwoJCWFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwoJCXJldHVybiBjOwoJfQp9CgoKY29udHJhY3QgRVJDMjBUb2tlbiB7CgoJLy8gLS0tLS0tLS0KCS8vCUV2ZW50cwoJLy8gLS0tLS0tLS0tCgoJLy8gcHVibGljaXplIGFjdGlvbnMgdG8gZXh0ZXJuYWwgbGlzdGVuZXJzLgoJLy8vIEBub3RpY2UgVHJpZ2dlcmVkIHdoZW4gdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZC4KCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwoKCS8vLyBAbm90aWNlIFRyaWdnZXJlZCB3aGVuZXZlciBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBpcyBjYWxsZWQuCglldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCgkvLyAtLS0tLS0tLQoJLy8JR2V0dGVycwoJLy8gLS0tLS0tLS0tCgoJLy8vIEBub3RpY2UgR2V0IHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW4gc3VwcGx5CglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IF90b3RhbFN1cHBseSk7CgoJLy8vIEBub3RpY2UgR2V0IHRoZSBhY2NvdW50IGJhbGFuY2Ugb2YgYWRkcmVzcyBfb3duZXIKCS8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKCS8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKCS8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKCS8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCgkvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50IGJ5IHRoZSBfc3BlbmRlciBmcm9tIF9vd25lciBhY2NvdW50CglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgoJLy8gLS0tLS0tLS0KCS8vCUFjdGlvbnMKCS8vIC0tLS0tLS0tLQoKCS8vLyBAbm90aWNlIHNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gX3RvIGFkZHJlc3MgZnJvbSBtc2cuc2VuZGVyIGFkZHJlc3MKCS8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKCS8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCS8vLyBAcmV0dXJuIGEgYm9vbGVhbiAtIHdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCgkvLy8gQG5vdGljZSBzZW5kIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIF90byBhZGRyZXNzIGZyb20gX2Zyb20gYWRkcmVzcywgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBfZnJvbQoJLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCgkvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CgkvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCgkvLy8gQHJldHVybiBhIGJvb2xlYW4gLSB3aGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKCS8vLyBAbm90aWNlIG1zZy5zZW5kZXIgYXBwcm92ZXMgX3NwZW5kZXIgdG8gc3BlbmQgbXVsdGlwbGUgdGltZXMgdXAgdG8gX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMKCS8vLyBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KCS8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCgkvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKCS8vLyBAcmV0dXJuIGEgYm9vbGVhbiAtIHdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCgpjb250cmFjdCBTZWN1cmVFUkMyMFRva2VuIGlzIEVSQzIwVG9rZW4gewoKCS8vIFN0YXRlIHZhcmlhYmxlcwoKCS8vIGJhbGFuY2VzIGRpY3Rpb25hcnkgdGhhdCBtYXBzIGFkZHJlc3NlcyB0byBiYWxhbmNlcwoJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwcml2YXRlIGJhbGFuY2VzOwoKCS8vIGxvY2tlZCBhY2NvdW50IGRpY3Rpb25hcnkgdGhhdCBtYXBzIGFkZHJlc3NlcyB0byBib29sZWFuCgltYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgbG9ja2VkQWNjb3VudHM7CgoJIC8vIGFsbG93ZWQgZGljdGlvbmFyeSB0aGF0IGFsbG93IHRyYW5zZmVyIHJpZ2h0cyB0byBvdGhlciBhZGRyZXNzZXMuCgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHJpdmF0ZSBhbGxvd2VkOwoKCS8vIFRoZSBUb2tlbidzIG5hbWU6IGUuZy4gJ0dpbGdhbWVzaCBUb2tlbnMnCglzdHJpbmcgcHVibGljIG5hbWU7CgoJLy8gU3ltYm9sIG9mIHRoZSB0b2tlbjogZS5xICdHSUwnCglzdHJpbmcgcHVibGljIHN5bWJvbDsKCgkvLyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQ6IGUuZyAnMTgnCgl1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgoJLy8gTnVtYmVyIG9mIHRvdGFsIHRva2VuczogZSxnOiAnMTAwMDAwMDAwMCcKCXVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKCS8vIHRva2VuIHZlcnNpb24KCXVpbnQ4IHB1YmxpYyB2ZXJzaW9uID0gMTsKCgkvLyBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhZG1pbgoJYWRkcmVzcyBwdWJsaWMgYWRtaW47CgoJLy8gYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgbWludGVyCglhZGRyZXNzIHB1YmxpYyBtaW50ZXI7CgoJLy8gY3JlYXRpb25CbG9jayBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIFRva2VuIHdhcyBjcmVhdGVkCgl1aW50MjU2IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKCS8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90CgkvLyBkaXNhYmxlIGFjdGlvbmFibGUgRVJDMjAgdG9rZW4gbWV0aG9kcwoJYm9vbCBwdWJsaWMgaXNUcmFuc2ZlckVuYWJsZWQ7CgoJZXZlbnQgQWRtaW5Pd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNBZG1pbiwgYWRkcmVzcyBpbmRleGVkIG5ld0FkbWluKTsKCWV2ZW50IE1pbnRlck93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c01pbnRlciwgYWRkcmVzcyBpbmRleGVkIG5ld01pbnRlcik7CglldmVudCBUcmFuc2ZlclN0YXR1cyhhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCBib29sIHN0YXR1cyk7CgoJLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgR2lsZ2FtZXNoIEVSQzIwIFRva2VuCglmdW5jdGlvbiBTZWN1cmVFUkMyMFRva2VuKAoJCXVpbnQyNTYgaW5pdGlhbFN1cHBseSwKCQlzdHJpbmcgX25hbWUsCgkJc3RyaW5nIF9zeW1ib2wsCgkJdWludDggX2RlY2ltYWxzLAoJCWJvb2wgX2lzVHJhbnNmZXJFbmFibGVkCgkpIHB1YmxpYyB7CgkJLy8gYXNzaWduIGFsbCB0b2tlbnMgdG8gdGhlIGRlcGxveWVyCgkJYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBpbml0aWFsU3VwcGx5OwoKCQl0b3RhbFN1cHBseSA9IGluaXRpYWxTdXBwbHk7IC8vIHNldCBpbml0aWFsIHN1cHBseSBvZiBUb2tlbnMKCQluYW1lID0gX25hbWU7CQkJCSAvLyBzZXQgdG9rZW4gbmFtZQoJCWRlY2ltYWxzID0gX2RlY2ltYWxzOwkJIC8vIHNldCB0aGUgZGVjaW1hbHMKCQlzeW1ib2wgPSBfc3ltYm9sOwkJCSAvLyBzZXQgdGhlIHRva2VuIHN5bWJvbAoJCWlzVHJhbnNmZXJFbmFibGVkID0gX2lzVHJhbnNmZXJFbmFibGVkOwoJCWNyZWF0aW9uQmxvY2sgPSBibG9jay5udW1iZXI7CgkJbWludGVyID0gbXNnLnNlbmRlcjsJCS8vIGJ5IGRlZmF1bHQgdGhlIGNvbnRyYWN0IGRlcGxveWVyIGlzIHRoZSBtaW50ZXIKCQlhZG1pbiA9IG1zZy5zZW5kZXI7CQkJLy8gYnkgZGVmYXVsdCB0aGUgY29udHJhY3QgZGVwbG95ZXIgaXMgdGhlIGFkbWluCgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0KCS8vIEVSQzIwIE1ldGhvZHMKCS8vIC0tLS0tLS0tLS0tLS0tCgoJLy8vIEBub3RpY2UgR2V0IHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW4gc3VwcGx5CglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IF90b3RhbFN1cHBseSkgewoJCXJldHVybiB0b3RhbFN1cHBseTsKCX0KCgkvLy8gQG5vdGljZSBHZXQgdGhlIGFjY291bnQgYmFsYW5jZSBvZiBhZGRyZXNzIF9vd25lcgoJLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAoJLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewoJCXJldHVybiBiYWxhbmNlc1tfb3duZXJdOwoJfQoKCS8vLyBAbm90aWNlIHNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gX3RvIGFkZHJlc3MgZnJvbSBtc2cuc2VuZGVyIGFkZHJlc3MKCS8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKCS8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCS8vLyBAcmV0dXJuIGEgYm9vbGVhbiAtIHdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJLy8gaWYgdHJhbnNmZXIgaXMgbm90IGVuYWJsZWQgdGhyb3cgYW4gZXJyb3IgYW5kIHN0b3AgZXhlY3V0aW9uLgoJCXJlcXVpcmUoaXNUcmFuc2ZlckVuYWJsZWQpOwoKCQkvLyBjb250aW51ZSB3aXRoIHRyYW5zZmVyCgkJcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoJfQoKCS8vLyBAbm90aWNlIHNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gX3RvIGFkZHJlc3MgZnJvbSBfZnJvbSBhZGRyZXNzLCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IF9mcm9tCgkvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKCS8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKCS8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCS8vLyBAcmV0dXJuIGEgYm9vbGVhbiAtIHdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCS8vIGlmIHRyYW5zZmVyIGlzIG5vdCBlbmFibGVkIHRocm93IGFuIGVycm9yIGFuZCBzdG9wIGV4ZWN1dGlvbi4KCQlyZXF1aXJlKGlzVHJhbnNmZXJFbmFibGVkKTsKCgkJLy8gaWYgZnJvbSBhbGxvd2VkIHRyYW5zZmVycmFibGUgcmlnaHRzIHRvIHNlbmRlciBmb3IgYW1vdW50IF92YWx1ZQoJCWlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF92YWx1ZSkgcmV2ZXJ0KCk7CgoJCS8vIHN1YnRyZWFjdCBhbGxvd2FuY2UKCQlhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgoJCS8vIGNvbnRpbnVlIHdpdGggdHJhbnNmZXIKCQlyZXR1cm4gZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJfQoKCS8vLyBAbm90aWNlIG1zZy5zZW5kZXIgYXBwcm92ZXMgX3NwZW5kZXIgdG8gc3BlbmQgX3ZhbHVlIHRva2VucwoJLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKCS8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgoJLy8vIEByZXR1cm4gYSBib29sZWFuIC0gd2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKQoJcHVibGljCglpc19ub3RfbG9ja2VkKF9zcGVuZGVyKQoJcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJLy8gaWYgdHJhbnNmZXIgaXMgbm90IGVuYWJsZWQgdGhyb3cgYW4gZXJyb3IgYW5kIHN0b3AgZXhlY3V0aW9uLgoJCXJlcXVpcmUoaXNUcmFuc2ZlckVuYWJsZWQpOwoKCQkvLyB1c2VyIGNhbiBvbmx5IHJlYXNzaWduIGFuIGFsbG93YW5jZSBvZiAwIGlmIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiAwCgkJLy8gc2VuZGVyIHNob3VsZCBmaXJzdCBjaGFuZ2UgdGhlIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYXBwcm92ZShfc3BlbmRlciwgMCkKCQkvLyByYWNlIGNvbmRpdGlvbiBpcyBleHBsYWluZWQgYmVsb3c6CgkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKCQlpZihfdmFsdWUgIT0gMCAmJiBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSByZXZlcnQoKTsKCgkJaWYgKAoJCQkvLyBpZiBzZW5kZXIgYmFsYW5jZSBpcyBsZXNzIHRoYW4gX3ZhbHVlIHJldHVybiBmYWxzZTsKCQkJYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCBfdmFsdWUKCQkpIHsKCQkJLy8gdHJhbnNhY3Rpb24gZmFpbHVyZQoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBhbGxvdyB0cmFuc2ZlciByaWdodHMgZnJvbSBtc2cuc2VuZGVyIHRvIF9zcGVuZGVyIGZvciBfdmFsdWUgdG9rZW4gYW1vdW50CgkJYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgoJCS8vIGxvZyBhcHByb3ZhbCBldmVudAoJCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKCQkvLyB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsCgkJcmV0dXJuIHRydWU7Cgl9CgoJLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwoJLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKCS8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQgYnkgdGhlIF9zcGVuZGVyIGZyb20gX293bmVyIGFjY291bnQKCWZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKCXB1YmxpYwoJY29uc3RhbnQKCXJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CgkJcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0KCS8vIENvbnRyYWN0IEN1c3RvbSBNZXRob2RzIC0gTm9uIEVSQzIwCgkvLyAtLS0tLS0tLS0tLS0tLQoKCS8qIFB1YmxpYyBNZXRob2RzICovCgoJLy8vIEBub3RpY2Ugb25seSB0aGUgYWRtaW4gaXMgYWxsb3dlZCB0byBsb2NrIGFjY291bnRzLgoJLy8vIEBwYXJhbSBfb3duZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdG8gYmUgbG9ja2VkCglmdW5jdGlvbiBsb2NrQWNjb3VudChhZGRyZXNzIF9vd25lcikKCXB1YmxpYwoJaXNfbm90X2xvY2tlZChfb3duZXIpCgl2YWxpZGF0ZV9hZGRyZXNzKF9vd25lcikKCW9ubHlBZG1pbiB7CgkJbG9ja2VkQWNjb3VudHNbX293bmVyXSA9IHRydWU7Cgl9CgoJLy8vIEBub3RpY2Ugb25seSB0aGUgYWRtaW4gaXMgYWxsb3dlZCB0byB1bmxvY2sgYWNjb3VudHMuCgkvLy8gQHBhcmFtIF9vd25lciB0aGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0byBiZSB1bmxvY2tlZAoJZnVuY3Rpb24gdW5sb2NrQWNjb3VudChhZGRyZXNzIF9vd25lcikKCXB1YmxpYwoJaXNfbG9ja2VkKF9vd25lcikKCXZhbGlkYXRlX2FkZHJlc3MoX293bmVyKQoJb25seUFkbWluIHsKCQlsb2NrZWRBY2NvdW50c1tfb3duZXJdID0gZmFsc2U7Cgl9CgoJLy8vIEBub3RpY2Ugb25seSB0aGUgYWRtaW4gaXMgYWxsb3dlZCB0byBidXJuIHRva2VucyAtIGluIGNhc2UgaWYgdGhlIHVzZXIgaGF2ZW4ndCB2ZXJpZmllZCBpZGVudGl0eSBvciBwZXJmb3JtZWQgZnJhdWQKCS8vLyBAcGFyYW0gX293bmVyIHRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgdGhlaXIgdG9rZW5zIG5lZWRzIHRvIGJlIGJ1cm50CglmdW5jdGlvbiBidXJuVXNlclRva2VucyhhZGRyZXNzIF9vd25lcikKCXB1YmxpYwoJdmFsaWRhdGVfYWRkcmVzcyhfb3duZXIpCglvbmx5QWRtaW4gewoJCS8vIGlmIHVzZXIgYmFsYW5jZSBpcyAwIGlnbm9yZQoJCWlmIChiYWxhbmNlc1tfb3duZXJdID09IDApIHJldmVydCgpOwoKCQkvLyBzaG91bGQgbmV2ZXIgaGFwcGVuIGJ1dCBqdXN0IGluIGNhc2UKCQlpZiAoYmFsYW5jZXNbX293bmVyXSA+IHRvdGFsU3VwcGx5KSByZXZlcnQoKTsKCgkJLy8gZGVjcmVhc2UgdGhlIHRvdGFsIHN1cHBseQoJCXRvdGFsU3VwcGx5IC09IGJhbGFuY2VzW19vd25lcl07CgoJCS8vIGJ1cm4gaXQgYWxsCgkJYmFsYW5jZXNbX293bmVyXSA9IDA7Cgl9CgoJLy8vIEBub3RpY2Ugb25seSB0aGUgYWRtaW4gaXMgYWxsb3dlZCB0byBjaGFuZ2UgdGhlIG1pbnRlci4KCS8vLyBAcGFyYW0gbmV3TWludGVyIHRoZSBhZGRyZXNzIG9mIHRoZSBtaW50ZXIKCWZ1bmN0aW9uIGNoYW5nZU1pbnRlcihhZGRyZXNzIG5ld01pbnRlcikKCXB1YmxpYwoJdmFsaWRhdGVfYWRkcmVzcyhuZXdNaW50ZXIpCglvbmx5QWRtaW4gewoJCWlmIChtaW50ZXIgPT0gbmV3TWludGVyKSByZXZlcnQoKTsKCQlNaW50ZXJPd25lcnNoaXBUcmFuc2ZlcnJlZChtaW50ZXIsIG5ld01pbnRlcik7CgkJbWludGVyID0gbmV3TWludGVyOwoJfQoKCS8vLyBAbm90aWNlIG9ubHkgdGhlIGFkbWluIGlzIGFsbG93ZWQgdG8gY2hhbmdlIHRoZSBhZG1pbi4KCS8vLyBAcGFyYW0gbmV3QWRtaW4gdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBhZG1pbgoJZnVuY3Rpb24gY2hhbmdlQWRtaW4oYWRkcmVzcyBuZXdBZG1pbikKCXB1YmxpYwoJdmFsaWRhdGVfYWRkcmVzcyhuZXdBZG1pbikKCW9ubHlBZG1pbiB7CgkJaWYgKGFkbWluID09IG5ld0FkbWluKSByZXZlcnQoKTsKCQlBZG1pbk93bmVyc2hpcFRyYW5zZmVycmVkKGFkbWluLCBuZXdBZG1pbik7CgkJYWRtaW4gPSBuZXdBZG1pbjsKCX0KCgkvLy8gQG5vdGljZSBtaW50IG5ldyB0b2tlbnMgYnkgdGhlIG1pbnRlcgoJLy8vIEBwYXJhbSBfb3duZXIgdGhlIG93bmVyIG9mIHRoZSBuZXdseSB0b2tlbnMKCS8vLyBAcGFyYW0gX2Ftb3VudCB0aGUgYW1vdW50IG9mIG5ldyB0b2tlbiB0byBiZSBtaW50ZWQKCWZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2Ftb3VudCkKCXB1YmxpYwoJb25seU1pbnRlcgoJdmFsaWRhdGVfYWRkcmVzcyhfb3duZXIpCglyZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQkvLyBwcmV2ZW50aW5nIG92ZXJmbG93IG9uIHRoZSB0b3RhbFN1cHBseQoJCWlmICh0b3RhbFN1cHBseSArIF9hbW91bnQgPCB0b3RhbFN1cHBseSkgcmV2ZXJ0KCk7CgoJCS8vIHByZXZlbnRpbmcgb3ZlcmZsb3cgb24gdGhlIHJlY2VpdmVyIGFjY291bnQKCQlpZiAoYmFsYW5jZXNbX293bmVyXSArIF9hbW91bnQgPCBiYWxhbmNlc1tfb3duZXJdKSByZXZlcnQoKTsKCgkJLy8gaW5jcmVhc2UgdGhlIHRvdGFsIHN1cHBseQoJCXRvdGFsU3VwcGx5ICs9IF9hbW91bnQ7CgoJCS8vIGFzc2lnbiB0aGUgYWRkaXRpb25hbCBzdXBwbHkgdG8gdGhlIHRhcmdldCBhY2NvdW50LgoJCWJhbGFuY2VzW19vd25lcl0gKz0gX2Ftb3VudDsKCgkJLy8gY29udHJhY3QgaGFzIG1pbnRlZCBuZXcgdG9rZW4gYnkgdGhlIG1pbnRlcgoJCVRyYW5zZmVyKDB4MCwgbXNnLnNlbmRlciwgX2Ftb3VudCk7CgoJCS8vIG1pbnRlciBoYXMgdHJhbnNmZXJyZWQgdG9rZW4gdG8gdGhlIHRhcmdldCBhY2NvdW50CgkJVHJhbnNmZXIobXNnLnNlbmRlciwgX293bmVyLCBfYW1vdW50KTsKCgkJcmV0dXJuIHRydWU7Cgl9CgoJLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQoJLy8vIGFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgZmluaXNoZWQgaXQgd2lsbCBiZSB0cnVlCgkvLy8gZm9yIHNlY3VyaXR5IHJlYXNvbnMgY2FuIGJlIHN3aXRjaGVkIHRvIGZhbHNlCgkvLy8gQHBhcmFtIF9pc1RyYW5zZmVyRW5hYmxlZCBib29sZWFuCglmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfaXNUcmFuc2ZlckVuYWJsZWQpIHB1YmxpYyBvbmx5QWRtaW4gewoJCWlzVHJhbnNmZXJFbmFibGVkID0gX2lzVHJhbnNmZXJFbmFibGVkOwoJCVRyYW5zZmVyU3RhdHVzKG1zZy5zZW5kZXIsIGlzVHJhbnNmZXJFbmFibGVkKTsKCX0KCgkvKiBJbnRlcm5hbCBNZXRob2RzICovCgoJLy8vCUBkZXYgdGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGFuZCBpdCBjYW4gb25seSBiZSBjYWxsZWQgaW50ZXJuYWxseQoJLy8vIEBub3RpY2Ugc2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBfdG8gYWRkcmVzcyBmcm9tIF9mcm9tIGFkZHJlc3MKCS8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKCS8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCS8vLyBAcmV0dXJuIGEgYm9vbGVhbiAtIHdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAoJZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCgl2YWxpZGF0ZV9hZGRyZXNzKF90bykKCWlzX25vdF9sb2NrZWQoX2Zyb20pCglpbnRlcm5hbAoJcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJaWYgKAoJCQkvLyBpZiB0aGUgdmFsdWUgaXMgbm90IG1vcmUgdGhhbiAwIGZhaWwKCQkJX3ZhbHVlIDw9IDAgfHwKCQkJLy8gaWYgdGhlIHNlbmRlciBkb2Vzbid0IGhhdmUgZW5vdWdoIGJhbGFuY2UgZmFpbAoJCQliYWxhbmNlc1tfZnJvbV0gPCBfdmFsdWUgfHwKCQkJLy8gaWYgdG9rZW4gc3VwcGx5IG92ZXJmbG93cyAodG90YWwgc3VwcGx5IGV4Y2VlZHMgMl4yNTYgLSAxKSBmYWlsCgkJCWJhbGFuY2VzW190b10gKyBfdmFsdWUgPCBiYWxhbmNlc1tfdG9dCgkJKSB7CgkJCS8vIHRyYW5zYWN0aW9uIGZhaWxlZAoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBkZWNyZWFzZSB0aGUgbnVtYmVyIG9mIHRva2VucyBmcm9tIHNlbmRlciBhZGRyZXNzLgoJCWJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CgoJCS8vIGluY3JlYXNlIHRoZSBudW1iZXIgb2YgdG9rZW5zIGZvciBfdG8gYWRkcmVzcwoJCWJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwoKCQkvLyBsb2cgdHJhbnNmZXIgZXZlbnQKCQlUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoKCQkvLyB0cmFuc2FjdGlvbiBzdWNjZXNzZnVsCgkJcmV0dXJuIHRydWU7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0KCS8vIE1vZGlmaWVycwoJLy8gLS0tLS0tLS0tLS0tLS0KCW1vZGlmaWVyIG9ubHlNaW50ZXIoKSB7CgkJLy8gaWYgc2VuZGVyIGlzIG5vdCB0aGUgbWludGVyIHN0b3AgdGhlIGV4ZWN1dGlvbgoJCWlmIChtc2cuc2VuZGVyICE9IG1pbnRlcikgcmV2ZXJ0KCk7CgkJLy8gaWYgdGhlIHNlbmRlciBpcyB0aGUgbWludGVyIGNvbnRpbnVlCgkJXzsKCX0KCgltb2RpZmllciBvbmx5QWRtaW4oKSB7CgkJLy8gaWYgc2VuZGVyIGlzIG5vdCB0aGUgYWRtaW4gc3RvcCB0aGUgZXhlY3V0aW9uCgkJaWYgKG1zZy5zZW5kZXIgIT0gYWRtaW4pIHJldmVydCgpOwoJCS8vIGlmIHRoZSBzZW5kZXIgaXMgdGhlIGFkbWluIGNvbnRpbnVlCgkJXzsKCX0KCgltb2RpZmllciB2YWxpZGF0ZV9hZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsKCQlpZiAoX2FkZHJlc3MgPT0gYWRkcmVzcygwKSkgcmV2ZXJ0KCk7CgkJXzsKCX0KCgltb2RpZmllciBpc19ub3RfbG9ja2VkKGFkZHJlc3MgX2FkZHJlc3MpIHsKCQlpZiAobG9ja2VkQWNjb3VudHNbX2FkZHJlc3NdID09IHRydWUpIHJldmVydCgpOwoJCV87Cgl9CgoJbW9kaWZpZXIgaXNfbG9ja2VkKGFkZHJlc3MgX2FkZHJlc3MpIHsKCQlpZiAobG9ja2VkQWNjb3VudHNbX2FkZHJlc3NdICE9IHRydWUpIHJldmVydCgpOwoJCV87Cgl9Cn0KCgpjb250cmFjdCBHaWxnYW1lc2hUb2tlbiBpcyBTZWN1cmVFUkMyMFRva2VuIHsKCS8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIEdpbGdhbWVzaCBFUkMyMCBUb2tlbgoJZnVuY3Rpb24gR2lsZ2FtZXNoVG9rZW4oKQoJcHVibGljCglTZWN1cmVFUkMyMFRva2VuKAoJCTAsIC8vIG5vIHRva2VuIGluIHRoZSBiZWduaW5nCgkJIkdpbGdhbWVzaCBUb2tlbiIsIC8vIFRva2VuIE5hbWUKCQkiR0lMIiwgLy8gVG9rZW4gU3ltYm9sCgkJMTgsIC8vIERlY2ltYWxzCgkJZmFsc2UgLy8gRW5hYmxlIHRva2VuIHRyYW5zZmVyCgkpIHt9Cgp9CgoKLyoKCUNvcHlyaWdodCAyMDE3LCBTa2lyYWwgSW5jCiovCmNvbnRyYWN0IEdpbGdhbWVzaFRva2VuU2FsZSBpcyBTYWZlTWF0aHsKCgkvLyBjcmVhdGlvbkJsb2NrIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgVG9rZW4gd2FzIGNyZWF0ZWQKCXVpbnQyNTYgcHVibGljIGNyZWF0aW9uQmxvY2s7CgoJLy8gc3RhcnRCbG9jayB0b2tlbiBzYWxlIHN0YXJ0aW5nIGJsb2NrCgl1aW50MjU2IHB1YmxpYyBzdGFydEJsb2NrOwoKCS8vIGVuZEJsb2NrIHRva2VuIHNhbGUgZW5kaW5nIGJsb2NrCgkvLyBlbmQgYmxvY2sgaXMgbm90IGEgdmFsaWQgYmxvY2sgZm9yIGNyb3dkZnVuZGluZy4gZW5kQmxvY2sgLSAxIGlzIHRoZSBsYXN0IHZhbGlkIGJsb2NrCgl1aW50MjU2IHB1YmxpYyBlbmRCbG9jazsKCgkvLyB0b3RhbCBXZWkgcmFzaXNlZAoJdWludDI1NiBwdWJsaWMgdG90YWxSYWlzZWQgPSAwOwoKCS8vIEhhcyBHaWxnYW1lc2ggc3RvcHBlZCB0aGUgc2FsZQoJYm9vbCBwdWJsaWMgc2FsZVN0b3BwZWQgPSBmYWxzZTsKCgkvLyBIYXMgR2lsZ2FtZXNoIGZpbmFsaXplZCB0aGUgc2FsZQoJYm9vbCBwdWJsaWMgc2FsZUZpbmFsaXplZCA9IGZhbHNlOwoKCS8vIE1pbmltdW0gcHVyY2hhc2UgLSAwLjEgRXRoZXIKCXVpbnQyNTYgY29uc3RhbnQgcHVibGljIG1pbmltdW1JbnZlc3RtZW50ID0gMTAwIGZpbm5leTsKCgkvLyBNYXhpbXVtIGhhcmQgQ2FwCgl1aW50MjU2IHB1YmxpYyBoYXJkQ2FwID0gNTAwMDAgZXRoZXI7CgoJLy8gbnVtYmVyIG9mIHdlaSBHSUwgdG9rZW5zIGZvciBzYWxlIC0gNjAgTWlsbGlvbiBHSUwgVG9rZW5zCgl1aW50MjU2IHB1YmxpYyB0b2tlbkNhcCA9IDYwMDAwMDAwICogMTAqKjE4OwoKCS8vIE1pbmltdW0gY2FwCgl1aW50MjU2IHB1YmxpYyBtaW5pbXVtQ2FwID0gMTI1MCBldGhlcjsKCgkvKiBDb250cmFjdCBJbmZvICovCgoJLy8gdGhlIGRlcG9zaXQgYWRkcmVzcyBmb3IgdGhlIEV0aCB0aGF0IGlzIHJhaXNlZC4KCWFkZHJlc3MgcHVibGljIGZ1bmRPd25lcldhbGxldDsKCgkvLyB0aGUgZGVwb3NpdCBhZGRyZXNzIGZvciB0aGUgdG9rZW5zIHRoYXQgaXMgbWludGVkIGZvciB0aGUgZGV2IHRlYW0uCglhZGRyZXNzIHB1YmxpYyB0b2tlbk93bmVyV2FsbGV0OwoKCS8vIG93bmVyIHRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBkZXBvbG95ZXIKCWFkZHJlc3MgcHVibGljIG93bmVyOwoKCS8vIExpc3Qgb2Ygc3RhZ2UgYm9udXMgcGVyY2VudGFnZXMgaW4gZXZlcnkgc3RhZ2UKCS8vIHRoaXMgd2lsbCBnZXQgZ2VuZXJhdGVkIGluIHRoZSBjb25zdHJ1Y3RvcgoJdWludFtdIHB1YmxpYyBzdGFnZUJvbnVzUGVyY2VudGFnZTsKCgkvLyBudW1iZXIgb2YgcGFydGljaXBhbnRzCgl1aW50MjU2IHB1YmxpYyB0b3RhbFBhcnRpY2lwYW50czsKCgkvLyBhIG1hcCBvZiB1c2VySWQgdG8gd2VpCgltYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIHBheW1lbnRzQnlVc2VySWQ7CgoJLy8gYSBtYXAgb2YgdXNlciBhZGRyZXNzIHRvIHdlaQoJbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXltZW50c0J5QWRkcmVzczsKCgkvLyB0b3RhbCBudW1iZXIgb2YgYm9udXMgc3RhZ2VzLgoJdWludDggcHVibGljIHRvdGFsU3RhZ2VzOwoKCS8vIG1heCBib251cyBwZXJjZW50YWdlIG9uIGZpcnN0IHN0YWdlCgl1aW50OCBwdWJsaWMgc3RhZ2VNYXhCb251c1BlcmNlbnRhZ2U7CgoJLy8gbnVtYmVyIG9mIHdlaS1HSUwgdG9rZW5zIGZvciAxIHdlaSAoMTggZGVjaW1hbHMpCgl1aW50MjU2IHB1YmxpYyB0b2tlblByaWNlOwoKCS8vIHRoZSB0ZWFtIG93bnMgMjUlIG9mIHRoZSB0b2tlbnMgLSAzIHRpbWVzIG1vcmUgdGhhbiB0b2tlbiBwdXJjaGFzZXJzLgoJdWludDggcHVibGljIHRlYW1Ub2tlblJhdGlvID0gMzsKCgkvLyBHSUwgdG9rZW4gYWRkcmVzcwoJR2lsZ2FtZXNoVG9rZW4gcHVibGljIHRva2VuOwoKCS8vIGlmIEV0aGVyIG9yIFRva2VuIGNhcCBoYXMgYmVlbiByZWFjaGVkCglib29sIHB1YmxpYyBpc0NhcFJlYWNoZWQgPSBmYWxzZTsKCgkvLyBsb2cgd2hlbiB0b2tlbiBzYWxlIGhhcyBiZWVuIGluaXRpYWxpemVkCglldmVudCBMb2dUb2tlblNhbGVJbml0aWFsaXplZCgKCQlhZGRyZXNzIGluZGV4ZWQgb3duZXIsCgkJYWRkcmVzcyBpbmRleGVkIGZ1bmRPd25lcldhbGxldCwKCQl1aW50MjU2IHN0YXJ0QmxvY2ssCgkJdWludDI1NiBlbmRCbG9jaywKCQl1aW50MjU2IGNyZWF0aW9uQmxvY2sKCSk7CgoJLy8gbG9nIGVhY2ggY29udHJpYnV0aW9uCglldmVudCBMb2dDb250cmlidXRpb24oCgkJYWRkcmVzcyBpbmRleGVkIGNvbnRyaWJ1dG9yQWRkcmVzcywKCQlhZGRyZXNzIGluZGV4ZWQgaW52b2tlckFkZHJlc3MsCgkJdWludDI1NiBhbW91bnQsCgkJdWludDI1NiB0b3RhbFJhaXNlZCwKCQl1aW50MjU2IHVzZXJBc3NpZ25lZFRva2VucywKCQl1aW50MjU2IGluZGV4ZWQgdXNlcklkCgkpOwoKCS8vIGxvZyB3aGVuIGNyb3dkIGZ1bmQgaXMgZmluYWxpemVkCglldmVudCBMb2dGaW5hbGl6ZWQoYWRkcmVzcyBvd25lciwgdWludDI1NiB0ZWFtVG9rZW5zKTsKCgkvLyBDb25zdHJ1Y3RvcgoJZnVuY3Rpb24gR2lsZ2FtZXNoVG9rZW5TYWxlKAoJCXVpbnQyNTYgX3N0YXJ0QmxvY2ssIC8vIHN0YXJ0aW5nIGJsb2NrIG51bWJlcgoJCXVpbnQyNTYgX2VuZEJsb2NrLCAvLyBlbmRpbmcgYmxvY2sgbnVtYmVyCgkJYWRkcmVzcyBfZnVuZE93bmVyV2FsbGV0LCAvLyBmdW5kIG93bmVyIHdhbGxldCBhZGRyZXNzIC0gdHJhbnNmZXIgZXRoZXIgdG8gdGhpcyBhZGRyZXNzIGR1cmluZyBhbmQgYWZ0ZXIgZnVuZCBoYXMgYmVlbiBjbG9zZWQKCQlhZGRyZXNzIF90b2tlbk93bmVyV2FsbGV0LCAvLyB0b2tlbiBmdW5kIG93bmVyIHdhbGxldCBhZGRyZXNzIC0gdHJhbnNmZXIgR0lMIHRva2VucyB0byB0aGlzIGFkZHJlc3MgYWZ0ZXIgZnVuZCBpcyBmaW5hbGl6ZWQKCQl1aW50OCBfdG90YWxTdGFnZXMsIC8vIHRvdGFsIG51bWJlciBvZiBib251cyBzdGFnZXMKCQl1aW50OCBfc3RhZ2VNYXhCb251c1BlcmNlbnRhZ2UsIC8vIG1heGltdW0gcGVyY2VudGFnZSBmb3IgYm9udXMgaW4gdGhlIGZpcnN0IHN0YWdlCgkJdWludDI1NiBfdG9rZW5QcmljZSwgLy8gcHJpY2Ugb2YgZWFjaCBHSUwgdG9rZW4gaW4gd2VpCgkJYWRkcmVzcyBfZ2lsZ2FtZXNoVG9rZW4sIC8vIGFkZHJlc3Mgb2YgdGhlIGdpbGdhbWVzaCBFUkMyMCB0b2tlbiBjb250cmFjdAoJCXVpbnQyNTYgX21pbmltdW1DYXAsIC8vIG1pbmltdW0gY2FwLCBtaW5pbXVtIGFtb3VudCBvZiB3ZWkgdG8gYmUgcmFpc2VkCgkJdWludDI1NiBfdG9rZW5DYXAgLy8gdG9rZW5DYXAKCSkKCXB1YmxpYwoJdmFsaWRhdGVfYWRkcmVzcyhfZnVuZE93bmVyV2FsbGV0KSB7CgoJCWlmICgKCQkJX2dpbGdhbWVzaFRva2VuID09IDB4MCB8fAoJCQlfdG9rZW5Pd25lcldhbGxldCA9PSAweDAgfHwKCQkJLy8gc3RhcnQgYmxvY2sgbmVlZHMgdG8gYmUgaW4gdGhlIGZ1dHVyZQoJCQlfc3RhcnRCbG9jayA8IGdldEJsb2NrTnVtYmVyKCkgIHx8CgkJCS8vIHN0YXJ0IGJsb2NrIHNob3VsZCBiZSBsZXNzIHRoYW4gZW5kaW5nIGJsb2NrCgkJCV9zdGFydEJsb2NrID49IF9lbmRCbG9jayAgfHwKCQkJLy8gbWluaW11bSBudW1iZXIgb2Ygc3RhZ2VzIGlzIDIKCQkJX3RvdGFsU3RhZ2VzIDwgMiB8fAoJCQkvLyB2ZXJpZnkgc3RhZ2UgbWF4IGJvbnVzCgkJCV9zdGFnZU1heEJvbnVzUGVyY2VudGFnZSA8IDAgIHx8CgkJCV9zdGFnZU1heEJvbnVzUGVyY2VudGFnZSA+IDEwMCB8fAoJCQkvLyBzdGFnZSBib251cyBwZXJjZW50YWdlIG5lZWRzIHRvIGJlIGRldmlzaWJsZSBieSBudW1iZXIgb2Ygc3RhZ2VzCgkJCV9zdGFnZU1heEJvbnVzUGVyY2VudGFnZSAlIChfdG90YWxTdGFnZXMgLSAxKSAhPSAwIHx8CgkJCS8vIHRvdGFsIG51bWJlciBvZiBibG9ja3MgbmVlZHMgdG8gYmUgZGV2aXNpYmxlIGJ5IHRoZSB0b3RhbCBzdGFnZXMKCQkJKF9lbmRCbG9jayAtIF9zdGFydEJsb2NrKSAlIF90b3RhbFN0YWdlcyAhPSAwCgkJKSByZXZlcnQoKTsKCgkJb3duZXIgPSBtc2cuc2VuZGVyOyAvLyBtYWtlIHRoZSBjb250cmFjdCBjcmVhdG9yIHRoZSBgb3duZXJgCgkJdG9rZW4gPSBHaWxnYW1lc2hUb2tlbihfZ2lsZ2FtZXNoVG9rZW4pOwoJCWVuZEJsb2NrID0gX2VuZEJsb2NrOwoJCXN0YXJ0QmxvY2sgPSBfc3RhcnRCbG9jazsKCQljcmVhdGlvbkJsb2NrID0gZ2V0QmxvY2tOdW1iZXIoKTsKCQlmdW5kT3duZXJXYWxsZXQgPSBfZnVuZE93bmVyV2FsbGV0OwoJCXRva2VuT3duZXJXYWxsZXQgPSBfdG9rZW5Pd25lcldhbGxldDsKCQl0b2tlblByaWNlID0gX3Rva2VuUHJpY2U7CgkJdG90YWxTdGFnZXMgPSBfdG90YWxTdGFnZXM7CgkJbWluaW11bUNhcCA9IF9taW5pbXVtQ2FwOwoJCXN0YWdlTWF4Qm9udXNQZXJjZW50YWdlID0gX3N0YWdlTWF4Qm9udXNQZXJjZW50YWdlOwoJCXRvdGFsUmFpc2VkID0gMDsgLy8JdG90YWwgbnVtYmVyIG9mIHdlaSByYWlzZWQKCQl0b2tlbkNhcCA9IF90b2tlbkNhcDsKCgkJLy8gc3ByZWFkIGJvbnVzZXMgZXZlbmx5IGJldHdlZW4gc3RhZ2VzIC0gZS5nIDI3IC8gOSA9IDMlCgkJdWludCBzcHJlYWQgPSBzdGFnZU1heEJvbnVzUGVyY2VudGFnZSAvICh0b3RhbFN0YWdlcyAtIDEpOwoKCQkvLyBsb29wIHRocm91Z2ggWzEwIHRvIDFdID0+ICggOSB0byAwKSAqIDMlID0gWzI3JSwgMjQlLCAyMSUsIDE4JSwgMTUlLCAxMiUsIDklLCA2JSwgMyUsIDAlXQoJCWZvciAodWludCBzdGFnZU51bWJlciA9IHRvdGFsU3RhZ2VzOyBzdGFnZU51bWJlciA+IDA7IHN0YWdlTnVtYmVyLS0pIHsKCQkJc3RhZ2VCb251c1BlcmNlbnRhZ2UucHVzaCgoc3RhZ2VOdW1iZXIgLSAxKSAqIHNwcmVhZCk7CgkJfQoKCQlMb2dUb2tlblNhbGVJbml0aWFsaXplZCgKCQkJb3duZXIsCgkJCWZ1bmRPd25lcldhbGxldCwKCQkJc3RhcnRCbG9jaywKCQkJZW5kQmxvY2ssCgkJCWNyZWF0aW9uQmxvY2sKCQkpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tCgkvLyBQdWJsaWMgRnVudGlvbnMKCS8vIC0tLS0tLS0tLS0tLS0tCgoJLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gc3RvcCBzYWxlIGZvciBhbiBlbWVyZ2VuY3kuCgkvLy8gQGRldiBPbmx5IEdpbGdhbWVzaCBEZXYgY2FuIGRvIGl0IGFmdGVyIGl0IGhhcyBiZWVuIGFjdGl2YXRlZC4KCWZ1bmN0aW9uIGVtZXJnZW5jeVN0b3BTYWxlKCkKCXB1YmxpYwoJb25seV9zYWxlX2FjdGl2ZQoJb25seU93bmVyIHsKCQlzYWxlU3RvcHBlZCA9IHRydWU7Cgl9CgoJLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVzdGFydCBzdG9wcGVkIHNhbGUuCgkvLy8gQGRldiBPbmx5IEdpbGdhbWVzaCBEZXYgY2FuIGRvIGl0IGFmdGVyIGl0IGhhcyBiZWVuIGRpc2FibGVkIGFuZCBzYWxlIGhhcyBzdG9wcGVkLgoJLy8vIGNhbiBpdCdzIGluIGEgdmFsaWQgdGltZSByYW5nZSBmb3Igc2FsZQoJZnVuY3Rpb24gcmVzdGFydFNhbGUoKQoJcHVibGljCglvbmx5X2R1cmluZ19zYWxlX3BlcmlvZAoJb25seV9zYWxlX3N0b3BwZWQKCW9ubHlPd25lciB7CgkJLy8gaWYgc2FsZSBpcyBmaW5hbGl6ZWQgZmFpbAoJCWlmIChzYWxlRmluYWxpemVkKSByZXZlcnQoKTsKCQlzYWxlU3RvcHBlZCA9IGZhbHNlOwoJfQoKCS8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgZnVuZCBvd25lciB3YWxsZXQgYWRkcmVzcwoJLy8vIEBkZXYgT25seSBHaWxnYW1lc2ggRGV2IGNhbiB0cmlnZ2VyIHRoaXMgZnVuY3Rpb24KCWZ1bmN0aW9uIGNoYW5nZUZ1bmRPd25lcldhbGxldEFkZHJlc3MoYWRkcmVzcyBfZnVuZE93bmVyV2FsbGV0KQoJcHVibGljCgl2YWxpZGF0ZV9hZGRyZXNzKF9mdW5kT3duZXJXYWxsZXQpCglvbmx5T3duZXIgewoJCWZ1bmRPd25lcldhbGxldCA9IF9mdW5kT3duZXJXYWxsZXQ7Cgl9CgoJLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gY2hhbmdlIHRoZSB0b2tlbiBmdW5kIG93bmVyIHdhbGxldCBhZGRyZXNzCgkvLy8gQGRldiBPbmx5IEdpbGdhbWVzaCBEZXYgY2FuIHRyaWdnZXIgdGhpcyBmdW5jdGlvbgoJZnVuY3Rpb24gY2hhbmdlVG9rZW5Pd25lcldhbGxldEFkZHJlc3MoYWRkcmVzcyBfdG9rZW5Pd25lcldhbGxldCkKCXB1YmxpYwoJdmFsaWRhdGVfYWRkcmVzcyhfdG9rZW5Pd25lcldhbGxldCkKCW9ubHlPd25lciB7CgkJdG9rZW5Pd25lcldhbGxldCA9IF90b2tlbk93bmVyV2FsbGV0OwoJfQoKCS8vLyBAbm90aWNlIGZpbmFsaXplIHRoZSBzYWxlCgkvLy8gQGRldiBPbmx5IEdpbGdhbWVzaCBEZXYgY2FuIHRyaWdnZXIgdGhpcyBmdW5jdGlvbgoJZnVuY3Rpb24gZmluYWxpemVTYWxlKCkKCXB1YmxpYwoJb25seU93bmVyIHsKCQlkb0ZpbmFsaXplU2FsZSgpOwoJfQoKCS8vLyBAbm90aWNlIGNoYW5nZSBoYXJkIGNhcCBhbmQgaWYgaXQgcmVhY2hlcyBoYXJkIGNhcCBmaW5hbGl6ZSBzYWxlCglmdW5jdGlvbiBjaGFuZ2VDYXAodWludDI1NiBfY2FwKQoJcHVibGljCglvbmx5T3duZXIgewoJCWlmIChfY2FwIDwgbWluaW11bUNhcCkgcmV2ZXJ0KCk7CgkJaWYgKF9jYXAgPD0gdG90YWxSYWlzZWQpIHJldmVydCgpOwoKCQloYXJkQ2FwID0gX2NhcDsKCgkJaWYgKHRvdGFsUmFpc2VkICsgbWluaW11bUludmVzdG1lbnQgPj0gaGFyZENhcCkgewoJCQlpc0NhcFJlYWNoZWQgPSB0cnVlOwoJCQlkb0ZpbmFsaXplU2FsZSgpOwoJCX0KCX0KCgkvLy8gQG5vdGljZSBjaGFuZ2UgbWluaW11bSBjYXAsIGluIGNhc2UgRXRoZXIgcHJpY2UgZmx1Y3R1YXRlcy4KCWZ1bmN0aW9uIGNoYW5nZU1pbmltdW1DYXAodWludDI1NiBfY2FwKQoJcHVibGljCglvbmx5T3duZXIgewoJCWlmIChtaW5pbXVtQ2FwIDwgX2NhcCkgcmV2ZXJ0KCk7CgkJbWluaW11bUNhcCA9IF9jYXA7Cgl9CgoJLy8vIEBub3RpY2UgcmVtb3ZlIGNvbnR0YWN0IG9ubHkgd2hlbiBzYWxlIGhhcyBiZWVuIGZpbmFsaXplZAoJLy8vIHRyYW5zZmVyIGFsbCB0aGUgZnVuZCB0byB0aGUgY29udHJhY3Qgb3duZXIKCS8vLyBAZGV2IG9ubHkgR2lsZ2FtZXNoIERldiBjYW4gdHJpZ2dlciB0aGlzIGZ1bmN0aW9uCglmdW5jdGlvbiByZW1vdmVDb250cmFjdCgpCglwdWJsaWMKCW9ubHlPd25lciB7CgkJaWYgKCFzYWxlRmluYWxpemVkKSByZXZlcnQoKTsKCQlzZWxmZGVzdHJ1Y3QobXNnLnNlbmRlcik7Cgl9CgoJLy8vIEBub3RpY2Ugb25seSB0aGUgb3duZXIgaXMgYWxsb3dlZCB0byBjaGFuZ2UgdGhlIG93bmVyLgoJLy8vIEBwYXJhbSBfbmV3T3duZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBvd25lcgoJZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpCglwdWJsaWMKCXZhbGlkYXRlX2FkZHJlc3MoX25ld093bmVyKQoJb25seU93bmVyIHsKCQlyZXF1aXJlKF9uZXdPd25lciAhPSBvd25lcik7CgkJb3duZXIgPSBfbmV3T3duZXI7Cgl9CgoJLy8vIEBkZXYgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGV0aGVyIGlzIHNlbnQgdG8gdGhlIGNvbnRyYWN0CgkvLy8gUGF5YWJsZSBpcyBhIHJlcXVpcmVkIHNvbGlkaXR5IG1vZGlmaWVyIHRvIHJlY2VpdmUgZXRoZXIKCS8vLyBldmVyeSBjb250cmFjdCBvbmx5IGhhcyBvbmUgdW5uYW1lZCBmdW5jdGlvbgoJLy8vIDIzMDAgZ2FzIGF2YWlsYWJsZSBmb3IgdGhpcyBmdW5jdGlvbgoJLypmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CgkJcmV0dXJuIGRlcG9zaXQoKTsKCX0qLwoKCS8qKgoJKiBQYXkgb24gYSBiZWhhbGYgb2YgdGhlIHNlbmRlci4KCSoKCSogQHBhcmFtIGN1c3RvbWVySWQgSWRlbnRpZmllciBpbiB0aGUgY2VudHJhbCBkYXRhYmFzZSwgVVVJRCB2NAoJKgoJKi8KCS8vLyBAZGV2IGFsbG93IHB1cmNoYXNlcnMgdG8gZGVwb3NpdCBFVEggZm9yIEdJTCBUb2tlbnMuCglmdW5jdGlvbiBkZXBvc2l0Rm9yTXlTZWxmKHVpbnQyNTYgdXNlcklkKQoJcHVibGljCglvbmx5X3NhbGVfYWN0aXZlCgltaW5pbXVtX2NvbnRyaWJ1dGlvbigpCglwYXlhYmxlIHsKCQlkZXBvc2l0KHVzZXJJZCwgbXNnLnNlbmRlcik7Cgl9CgoJLy8vCUBkZXYgZGVwb3NpdCgpIGlzIGFuIHB1YmxpYyBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgYSB1c2VySWQgYW5kIHVzZXJBZGRyZXNzCgkvLy8JY29udHJhY3QgcmVjZWl2ZXMgRVRIIGluIHJldHVybiBvZiBHSUwgdG9rZW5zCglmdW5jdGlvbiBkZXBvc2l0KHVpbnQyNTYgdXNlcklkLCBhZGRyZXNzIHVzZXJBZGRyZXNzKQoJcHVibGljCglwYXlhYmxlCglvbmx5X3NhbGVfYWN0aXZlCgltaW5pbXVtX2NvbnRyaWJ1dGlvbigpCgl2YWxpZGF0ZV9hZGRyZXNzKHVzZXJBZGRyZXNzKSB7CgkJLy8gaWYgaXQgcGFzc2VzIGhhcmQgY2FwIHRocm93CgkJaWYgKHRvdGFsUmFpc2VkICsgbXNnLnZhbHVlID4gaGFyZENhcCkgcmV2ZXJ0KCk7CgoJCXVpbnQyNTYgdXNlckFzc2lnbmVkVG9rZW5zID0gY2FsY3VsYXRlVG9rZW5zKG1zZy52YWx1ZSk7CgoJCS8vIGlmIHVzZXIgdG9rZW5zIGFyZSAwIHRocm93CgkJaWYgKHVzZXJBc3NpZ25lZFRva2VucyA8PSAwKSByZXZlcnQoKTsKCgkJLy8gaWYgbnVtYmVyIG9mIHRva2VucyBleGNlZWQgdGhlIHRva2VuIGNhcCBzdG9wIGV4ZWN1dGlvbgoJCWlmICh0b2tlbi50b3RhbFN1cHBseSgpICsgdXNlckFzc2lnbmVkVG9rZW5zID4gdG9rZW5DYXApIHJldmVydCgpOwoKCQkvLyBzZW5kIGZ1bmRzIHRvIGZ1bmQgb3duZXIgd2FsbGV0CgkJaWYgKCFmdW5kT3duZXJXYWxsZXQuc2VuZChtc2cudmFsdWUpKSByZXZlcnQoKTsKCgkJLy8gbWludCB0b2tlbnMgZm9yIHRoZSB1c2VyCgkJaWYgKCF0b2tlbi5taW50KHVzZXJBZGRyZXNzLCB1c2VyQXNzaWduZWRUb2tlbnMpKSByZXZlcnQoKTsKCgkJLy8gc2F2ZSB0b3RhbCBudW1iZXIgd2VpIHJhaXNlZAoJCXRvdGFsUmFpc2VkID0gc2FmZUFkZCh0b3RhbFJhaXNlZCwgbXNnLnZhbHVlKTsKCgkJLy8gaWYgY2FwIGlzIHJlYWNoZWQgbWFyayBpdAoJCWlmICh0b3RhbFJhaXNlZCA+PSBoYXJkQ2FwKSB7CgkJCWlzQ2FwUmVhY2hlZCA9IHRydWU7CgkJfQoKCQkvLyBpZiB0b2tlbiBzdXBwbHkgaGFzIGV4Y2VlZGVkIG9yIHJlYWNoZWQgdGhlIHRva2VuIGNhcCBzdG9wCgkJaWYgKHRva2VuLnRvdGFsU3VwcGx5KCkgPj0gdG9rZW5DYXApIHsKCQkJaXNDYXBSZWFjaGVkID0gdHJ1ZTsKCQl9CgoJCS8vIGluY3JlYXNlIHRoZSBudW1iZXIgb2YgcGFydGljaXBhbnRzIGZvciB0aGUgZmlyc3QgdHJhbnNhY3Rpb24KCQlpZiAocGF5bWVudHNCeVVzZXJJZFt1c2VySWRdID09IDApIHsKCQkJdG90YWxQYXJ0aWNpcGFudHMrKzsKCQl9CgoJCS8vIGluY3JlYXNlIHRoZSBhbW91bnQgdGhhdCB0aGUgdXNlciBoYXMgcGF5ZWQKCQlwYXltZW50c0J5VXNlcklkW3VzZXJJZF0gKz0gbXNnLnZhbHVlOwoKCQkvLyB0b3RhbCB3ZWkgYmFzZWQgb24gYWRkcmVzcwoJCXBheW1lbnRzQnlBZGRyZXNzW3VzZXJBZGRyZXNzXSArPSBtc2cudmFsdWU7CgoJCS8vIGxvZyBjb250cmlidXRpb24gZXZlbnQKCQlMb2dDb250cmlidXRpb24oCgkJCXVzZXJBZGRyZXNzLAoJCQltc2cuc2VuZGVyLAoJCQltc2cudmFsdWUsCgkJCXRvdGFsUmFpc2VkLAoJCQl1c2VyQXNzaWduZWRUb2tlbnMsCgkJCXVzZXJJZAoJCSk7Cgl9CgoJLy8vIEBub3RpY2UgY2FsY3VsYXRlIG51bWJlciBvZiB0b2tlbnMgbmVlZCB0byBiZSBpc3N1ZWQgYmFzZWQgb24gdGhlIGFtb3VudCByZWNlaXZlZAoJLy8vIEBwYXJhbSBhbW91bnQgbnVtYmVyIG9mIHdlaSByZWNlaXZlZAoJZnVuY3Rpb24gY2FsY3VsYXRlVG9rZW5zKHVpbnQyNTYgYW1vdW50KQoJcHVibGljCgl2aWV3CglyZXR1cm5zICh1aW50MjU2KSB7CgkJLy8gcmV0dXJuIDAgaWYgdGhlIGNyb3dkIGZ1bmQgaGFzIGVuZGVkIG9yIGl0IGhhc24ndCBzdGFydGVkCgkJaWYgKCFpc0R1cmluZ1NhbGVQZXJpb2QoZ2V0QmxvY2tOdW1iZXIoKSkpIHJldHVybiAwOwoKCQkvLyBnZXQgdGhlIGN1cnJlbnQgc3RhZ2UgbnVtYmVyIGJ5IGJsb2NrIG51bWJlcgoJCXVpbnQ4IGN1cnJlbnRTdGFnZSA9IGdldFN0YWdlQnlCbG9ja051bWJlcihnZXRCbG9ja051bWJlcigpKTsKCgkJLy8gaWYgY3VycmVudCBzdGFnZSBpcyBtb3JlIHRoYW4gdGhlIHRvdGFsIHN0YWdlIHJldHVybiAwIC0gc29tZXRoaW5nIGlzIHdyb25nCgkJaWYgKGN1cnJlbnRTdGFnZSA+IHRvdGFsU3RhZ2VzKSByZXR1cm4gMDsKCgkJLy8gY2FsY3VsYXRlIG51bWJlciBvZiB0b2tlbnMgdGhhdCBuZWVkcyB0byBiZSBpc3N1ZWQgZm9yIHRoZSBwdXJjaGFzZXIKCQl1aW50MjU2IHB1cmNoYXNlZFRva2VucyA9IHNhZmVNdWwoYW1vdW50LCB0b2tlblByaWNlKTsKCQkvLyBjYWxjdWxhdGUgbnVtYmVyIG9mIHRva2VucyB0aGF0IG5lZWRzIHRvIGJlIHJld3JhZGVkIHRvIHRoZSBwdXJjaGFzZXIKCQl1aW50MjU2IHJld2FyZGVkVG9rZW5zID0gY2FsY3VsYXRlUmV3YXJkVG9rZW5zKHB1cmNoYXNlZFRva2VucywgY3VycmVudFN0YWdlKTsKCQkvLyBhZGQgcHVyY2hhc2VkVG9rZW5zIGFuZCByZXdhcmRlZFRva2VucwoJCXJldHVybiBzYWZlQWRkKHB1cmNoYXNlZFRva2VucywgcmV3YXJkZWRUb2tlbnMpOwoJfQoKCS8vLyBAbm90aWNlIGNhbGN1bGF0ZSByZXdhcmQgYmFzZWQgb24gYW1vdW50IG9mIHRva2VucyB0aGF0IHdpbGwgYmUgaXNzdWVkIHRvIHRoZSBwdXJjaGFzZXIKCS8vLyBAcGFyYW0gYW1vdW50IG51bWJlciB0b2tlbnMgdGhhdCB3aWxsIGJlIG1pbnRlZCBmb3IgdGhlIHB1cmNoYXNlcgoJLy8vIEBwYXJhbSBzdGFnZU51bWJlciBudW1iZXIgb2YgY3VycmVudCBzdGFnZSBpbiB0aGUgY3Jvd2QgZnVuZCBwcm9jZXNzCglmdW5jdGlvbiBjYWxjdWxhdGVSZXdhcmRUb2tlbnModWludDI1NiBhbW91bnQsIHVpbnQ4IHN0YWdlTnVtYmVyKQoJcHVibGljCgl2aWV3CglyZXR1cm5zICh1aW50MjU2IHJld2FyZEFtb3VudCkgewoJCS8vIHRocm93IGlmIGl0J3MgaW52YWxpZCBzdGFnZSBudW1iZXIKCQlpZiAoCgkJCXN0YWdlTnVtYmVyIDwgMSB8fAoJCQlzdGFnZU51bWJlciA+IHRvdGFsU3RhZ2VzCgkJKSByZXZlcnQoKTsKCgkJLy8gZ2V0IHN0YWdlIGluZGV4IGZvciB0aGUgYXJyYXkKCQl1aW50OCBzdGFnZUluZGV4ID0gc3RhZ2VOdW1iZXIgLSAxOwoKCQkvLyBjYWxjdWxhdGUgcmV3YXJkIC0gZS5xIDEwMCB0b2tlbiBjcmVhdGVzIDEwMCAqIDIwIC8xMDAgPSAyMCB0b2tlbnMgZm9yIHJld2FyZAoJCXJldHVybiBzYWZlRGl2KHNhZmVNdWwoYW1vdW50LCBzdGFnZUJvbnVzUGVyY2VudGFnZVtzdGFnZUluZGV4XSksIDEwMCk7Cgl9CgoJLy8vIEBub3RpY2UgZ2V0IGNyb3dkIGZ1bmQgc3RhZ2UgYnkgYmxvY2sgbnVtYmVyCgkvLy8gQHBhcmFtIF9ibG9ja051bWJlciBibG9jayBudW1iZXIKCWZ1bmN0aW9uIGdldFN0YWdlQnlCbG9ja051bWJlcih1aW50MjU2IF9ibG9ja051bWJlcikKCXB1YmxpYwoJdmlldwoJcmV0dXJucyAodWludDgpIHsKCQkvLyB0aHJvdyBlcnJvciwgaWYgYmxvY2sgbnVtYmVyIGlzIG91dCBvZiByYW5nZQoJCWlmICghaXNEdXJpbmdTYWxlUGVyaW9kKF9ibG9ja051bWJlcikpIHJldmVydCgpOwoKCQl1aW50MjU2IHRvdGFsQmxvY2tzID0gc2FmZVN1YihlbmRCbG9jaywgc3RhcnRCbG9jayk7CgkJdWludDI1NiBudW1PZkJsb2NrUGFzc2VkID0gc2FmZVN1YihfYmxvY2tOdW1iZXIsIHN0YXJ0QmxvY2spOwoKCQkvLyBzaW5jZSBudW1iZXJzIHJvdW5kIGRvd24gd2UgbmVlZCB0byBhZGQgb25lIHRvIG51bWJlciBvZiBzdGFnZQoJCXJldHVybiB1aW50OChzYWZlRGl2KHNhZmVNdWwodG90YWxTdGFnZXMsIG51bU9mQmxvY2tQYXNzZWQpLCB0b3RhbEJsb2NrcykgKyAxKTsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLQoJLy8gSW50ZXJuYWwgRnVudGlvbnMKCS8vIC0tLS0tLS0tLS0tLS0tCgoJLy8vIEBub3RpY2UgY2hlY2sgaWYgdGhlIGJsb2NrIG51bWJlciBpcyBkdXJpbmcgdGhlIHNhbGUgcGVyaW9kCgkvLy8gQHBhcmFtIF9ibG9ja051bWJlciBibG9jayBudW1iZXIKCWZ1bmN0aW9uIGlzRHVyaW5nU2FsZVBlcmlvZCh1aW50MjU2IF9ibG9ja051bWJlcikKCXZpZXcKCWludGVybmFsCglyZXR1cm5zIChib29sKSB7CgkJcmV0dXJuIChfYmxvY2tOdW1iZXIgPj0gc3RhcnRCbG9jayAmJiBfYmxvY2tOdW1iZXIgPCBlbmRCbG9jayk7Cgl9CgoJLy8vIEBub3RpY2UgZmluYWxpemUgdGhlIGNyb3dkZnVuIHNhbGUKCS8vLyBAZGV2IE9ubHkgR2lsZ2FtZXNoIERldiBjYW4gdHJpZ2dlciB0aGlzIGZ1bmN0aW9uCglmdW5jdGlvbiBkb0ZpbmFsaXplU2FsZSgpCglpbnRlcm5hbAoJb25seU93bmVyIHsKCgkJaWYgKHNhbGVGaW5hbGl6ZWQpIHJldmVydCgpOwoKCQkvLyBjYWxjdWxhdGUgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCBuZWVkcyB0byBiZSBhc3NpZ25lZCB0byBHaWxnYW1lc2ggdGVhbQoJCXVpbnQyNTYgdGVhbVRva2VucyA9IHNhZmVNdWwodG9rZW4udG90YWxTdXBwbHkoKSwgdGVhbVRva2VuUmF0aW8pOwoKCQlpZiAodGVhbVRva2VucyA+IDApewoJCQkvLyBtaW50IHRva2VucyBmb3IgdGhlIHRlYW0KCQkJaWYgKCF0b2tlbi5taW50KHRva2VuT3duZXJXYWxsZXQsIHRlYW1Ub2tlbnMpKSByZXZlcnQoKTsKCQl9CgoJCS8vIGlmIHRoZXJlIGlzIGFueSBmdW5kIGRyYWluIGl0CgkJaWYodGhpcy5iYWxhbmNlID4gMCkgewoJCQkvLyBzZW5kIGV0aGVyIGZ1bmRzIHRvIGZ1bmQgb3duZXIgd2FsbGV0CgkJCWlmICghZnVuZE93bmVyV2FsbGV0LnNlbmQodGhpcy5iYWxhbmNlKSkgcmV2ZXJ0KCk7CgkJfQoKCQkvLyBmaW5hbGl6ZSBzYWxlIGZsYWcKCQlzYWxlRmluYWxpemVkID0gdHJ1ZTsKCgkJLy8gc3RvcCBzYWxlIGZsYWcKCQlzYWxlU3RvcHBlZCA9IHRydWU7CgoJCS8vIGxvZyBmaW5hbGl6ZWQKCQlMb2dGaW5hbGl6ZWQodG9rZW5Pd25lcldhbGxldCwgdGVhbVRva2Vucyk7Cgl9CgoJLy8vIEBub3RpY2UgcmV0dXJucyBibG9jay5udW1iZXIKCWZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewoJCXJldHVybiBibG9jay5udW1iZXI7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0KCS8vIE1vZGlmaWVycwoJLy8gLS0tLS0tLS0tLS0tLS0KCgkvLy8gY29udGludWUgb25seSB3aGVuIHNhbGUgaGFzIHN0b3BwZWQKCW1vZGlmaWVyIG9ubHlfc2FsZV9zdG9wcGVkIHsKCQlpZiAoIXNhbGVTdG9wcGVkKSByZXZlcnQoKTsKCQlfOwoJfQoKCgkvLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsCgltb2RpZmllciB2YWxpZGF0ZV9hZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsKCQlpZiAoX2FkZHJlc3MgPT0gMHgwKSByZXZlcnQoKTsKCQlfOwoJfQoKCS8vLyBjb250aW51ZSBvbmx5IGR1cmluZyB0aGUgc2FsZSBwZXJpb2QKCW1vZGlmaWVyIG9ubHlfZHVyaW5nX3NhbGVfcGVyaW9kIHsKCQkvLyBpZiBibG9jayBudW1iZXIgaXMgbGVzcyB0aGFuIHN0YXJ0aW5nIGJsb2NrIGZhaWwKCQlpZiAoZ2V0QmxvY2tOdW1iZXIoKSA8IHN0YXJ0QmxvY2spIHJldmVydCgpOwoJCS8vIGlmIGJsb2NrIG51bWJlciBoYXMgcmVhY2ggdG8gdGhlIGVuZCBibG9jayBmYWlsCgkJaWYgKGdldEJsb2NrTnVtYmVyKCkgPj0gZW5kQmxvY2spIHJldmVydCgpOwoJCS8vIG90aGVyd2lzZSBzYWZlIHRvIGNvbnRpbnVlCgkJXzsKCX0KCgkvLy8gY29udGludWUgd2hlbiBzYWxlIGlzIGFjdGl2ZSBhbmQgdmFsaWQKCW1vZGlmaWVyIG9ubHlfc2FsZV9hY3RpdmUgewoJCS8vIGlmIHNhbGUgaXMgZmluYWxpemVkIGZhaWwKCQlpZiAoc2FsZUZpbmFsaXplZCkgcmV2ZXJ0KCk7CgkJLy8gaWYgc2FsZSBpcyBzdG9wcGVkIGZhaWwKCQlpZiAoc2FsZVN0b3BwZWQpIHJldmVydCgpOwoJCS8vIGlmIGNhcCBpcyByZWFjaGVkCgkJaWYgKGlzQ2FwUmVhY2hlZCkgcmV2ZXJ0KCk7CgkJLy8gaWYgYmxvY2sgbnVtYmVyIGlzIGxlc3MgdGhhbiBzdGFydGluZyBibG9jayBmYWlsCgkJaWYgKGdldEJsb2NrTnVtYmVyKCkgPCBzdGFydEJsb2NrKSByZXZlcnQoKTsKCQkvLyBpZiBibG9jayBudW1iZXIgaGFzIHJlYWNoIHRvIHRoZSBlbmQgYmxvY2sgZmFpbAoJCWlmIChnZXRCbG9ja051bWJlcigpID49IGVuZEJsb2NrKSByZXZlcnQoKTsKCQkvLyBvdGhlcndpc2Ugc2FmZSB0byBjb250aW51ZQoJCV87Cgl9CgoJLy8vIGNvbnRpbnVlIGlmIG1pbmltdW0gY29udHJpYnV0aW9uIGhhcyByZWFjaGVkCgltb2RpZmllciBtaW5pbXVtX2NvbnRyaWJ1dGlvbigpIHsKCQlpZiAobXNnLnZhbHVlIDwgbWluaW11bUludmVzdG1lbnQpIHJldmVydCgpOwoJCV87Cgl9CgoJLy8vIGNvbnRpbnVlIHdoZW4gdGhlIGludm9rZXIgaXMgdGhlIG93bmVyCgltb2RpZmllciBvbmx5T3duZXIoKSB7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHJldmVydCgpOwoJCV87Cgl9Cn0='.
	

]
