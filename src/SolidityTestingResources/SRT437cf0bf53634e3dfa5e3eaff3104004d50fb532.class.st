Class {
	#name : #SRT437cf0bf53634e3dfa5e3eaff3104004d50fb532,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT437cf0bf53634e3dfa5e3eaff3104004d50fb532 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwp9CgoKCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuIAogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwoKICAvKioKICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgewogICAgICAgdGhyb3c7CiAgICAgfQogICAgIF87CiAgfQoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCgoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1hbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcnQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyBpZiAoX3ZhbHVlID4gX2FsbG93YW5jZSkgdGhyb3c7CgogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWFobGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgTGltaXRlZFRyYW5zZmVyVG9rZW4KICogQGRldiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBkZWZpbmVzIHRoZSBnZW5lcmljIGludGVyZmFjZSBhbmQgdGhlIGltcGxlbWVudGF0aW9uIHRvIGxpbWl0IHRva2VuIAogKiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGRpZmZlcmVudCBldmVudHMuIEl0IGlzIGludGVuZGVkIHRvIGJlIHVzZWQgYXMgYSBiYXNlIGNsYXNzIGZvciBvdGhlciB0b2tlbiAKICogY29udHJhY3RzLiAKICogTGltaXRlZFRyYW5zZmVyVG9rZW4gaGFzIGJlZW4gZGVzaWduZWQgdG8gYWxsb3cgZm9yIGRpZmZlcmVudCBsaW1pdGluZyBmYWN0b3JzLAogKiB0aGlzIGNhbiBiZSBhY2hpZXZlZCBieSByZWN1cnNpdmVseSBjYWxsaW5nIHN1cGVyLnRyYW5zZmVyYWJsZVRva2VucygpIHVudGlsIHRoZSBiYXNlIGNsYXNzIGlzIAogKiBoaXQuIEZvciBleGFtcGxlOgogKiAgICAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICogICAgICAgcmV0dXJuIG1pbjI1Nih1bmxvY2tlZFRva2Vucywgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogKiAgICAgfQogKiBBIHdvcmtpbmcgZXhhbXBsZSBpcyBWZXN0ZWRUb2tlbi5zb2w6CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL3Rva2VuL1Zlc3RlZFRva2VuLnNvbAogKi8KCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsKCiAgLyoqCiAgICogQGRldiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cy4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CiAgIGlmIChfdmFsdWUgPiB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKSB0aHJvdzsKICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSB7CiAgICBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgewogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IERlZmF1bHQgdHJhbnNmZXJhYmxlIHRva2VucyBmdW5jdGlvbiByZXR1cm5zIGFsbCB0b2tlbnMgZm9yIGEgaG9sZGVyIChubyBsaW1pdCkuCiAgICogQGRldiBPdmVyd3JpdGluZyB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBpcyB0aGUgd2F5IHRvIHByb3ZpZGUgdGhlIAogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgVmVzdGVkIHRva2VuCiAqIEBkZXYgVG9rZW5zIHRoYXQgY2FuIGJlIHZlc3RlZCBmb3IgYSBncm91cCBvZiBhZGRyZXNzZXMuCiAqLwpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CgogIHVpbnQyNTYgTUFYX0dSQU5UU19QRVJfQUREUkVTUyA9IDIwOwoKICBzdHJ1Y3QgVG9rZW5HcmFudCB7CiAgICBhZGRyZXNzIGdyYW50ZXI7ICAgICAvLyAyMCBieXRlcwogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMKICAgIHVpbnQ2NCBjbGlmZjsKICAgIHVpbnQ2NCB2ZXN0aW5nOwogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcwogICAgYm9vbCByZXZva2FibGU7CiAgICBib29sIGJ1cm5zT25SZXZva2U7ICAvLyAyICogMSA9IDIgYml0cz8gb3IgMiBieXRlcz8KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7CgogIGV2ZW50IE5ld1Rva2VuR3JhbnQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgdWludDI1NiBncmFudElkKTsKCiAgLyoqCiAgICogQGRldiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgZ3JhbnRlZCB0by4KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgKiBAcGFyYW0gX3N0YXJ0IHVpbnQ2NCBUaW1lIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50LgogICAqIEBwYXJhbSBfY2xpZmYgdWludDY0IFRpbWUgb2YgdGhlIGNsaWZmIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBncmFudFZlc3RlZFRva2VucygKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdmFsdWUsCiAgICB1aW50NjQgX3N0YXJ0LAogICAgdWludDY0IF9jbGlmZiwKICAgIHVpbnQ2NCBfdmVzdGluZywKICAgIGJvb2wgX3Jldm9rYWJsZSwKICAgIGJvb2wgX2J1cm5zT25SZXZva2UKICApIHB1YmxpYyB7CgogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3IKICAgIGlmIChfY2xpZmYgPCBfc3RhcnQgfHwgX3Zlc3RpbmcgPCBfY2xpZmYpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYgKHRva2VuR3JhbnRzQ291bnQoX3RvKSA+IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MpIHRocm93OyAgIC8vIFRvIHByZXZlbnQgYSB1c2VyIGJlaW5nIHNwYW1tZWQgYW5kIGhhdmUgaGlzIGJhbGFuY2UgbG9ja2VkIChvdXQgb2YgZ2FzIGF0dGFjayB3aGVuIGNhbGN1bGF0aW5nIHZlc3RpbmcpLgoKICAgIHVpbnQgY291bnQgPSBncmFudHNbX3RvXS5wdXNoKAogICAgICAgICAgICAgICAgVG9rZW5HcmFudCgKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLCAvLyBhdm9pZCBzdG9yaW5nIGFuIGV4dHJhIDIwIGJ5dGVzIHdoZW4gaXQgaXMgbm9uLXJldm9rYWJsZQogICAgICAgICAgICAgICAgICBfdmFsdWUsCiAgICAgICAgICAgICAgICAgIF9jbGlmZiwKICAgICAgICAgICAgICAgICAgX3Zlc3RpbmcsCiAgICAgICAgICAgICAgICAgIF9zdGFydCwKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSwKICAgICAgICAgICAgICAgICAgX2J1cm5zT25SZXZva2UKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICApOwoKICAgIHRyYW5zZmVyKF90bywgX3ZhbHVlKTsKCiAgICBOZXdUb2tlbkdyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBjb3VudCAtIDEpOwogIH0KCiAgLyoqCiAgICogQGRldiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmVkIGFkZHJlc3MuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4KICAgKi8KICBmdW5jdGlvbiByZXZva2VUb2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgcHVibGljIHsKICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGlmICghZ3JhbnQucmV2b2thYmxlKSB7IC8vIENoZWNrIGlmIGdyYW50IHdhcyByZXZva2FibGUKICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYgKGdyYW50LmdyYW50ZXIgIT0gbXNnLnNlbmRlcikgeyAvLyBPbmx5IGdyYW50ZXIgY2FuIHJldm9rZSBpdAogICAgICB0aHJvdzsKICAgIH0KCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7CgogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKCiAgICAvLyByZW1vdmUgZ3JhbnQgZnJvbSBhcnJheQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsKICAgIGdyYW50c1tfaG9sZGVyXS5sZW5ndGggLT0gMTsKCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7CiAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IGJhbGFuY2VzW19ob2xkZXJdLnN1Yihub25WZXN0ZWQpOwoKICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOwogIH0KCgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7IC8vIHNob3J0Y3V0IGZvciBob2xkZXIgd2l0aG91dCBncmFudHMKCiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIHRoZSBncmFudHMgdGhlIGhvbGRlciBoYXMsIGFuZCBhZGQgYWxsIG5vbi12ZXN0ZWQgdG9rZW5zCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IDA7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgbm9uVmVzdGVkID0gU2FmZU1hdGguYWRkKG5vblZlc3RlZCwgbm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7CiAgICB9CgogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQogICAgdWludDI1NiB2ZXN0ZWRUcmFuc2ZlcmFibGUgPSBTYWZlTWF0aC5zdWIoYmFsYW5jZU9mKGhvbGRlciksIG5vblZlc3RlZCk7CgogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlCiAgICAvLyBpbiBjYXNlIHRoZXJlIGFyZSBvdGhlciBsaW1pdGluZyB0cmFuc2ZlcmFiaWxpdHkgZmFjdG9ycyAoZGVmYXVsdCBpcyBiYWxhbmNlT2YpCiAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBob2xkZXIgb2YgdGhlIGdyYW50cy4KICAgKiBAcmV0dXJuIEEgdWludCByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5kZXgpIHsKICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuCiAgICogQHBhcmFtIHRva2VucyB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIGdyYW50dGVkLgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbmluZyBvZiB0aGUgZ3JhbnQKICAgKiBAcGFyYW0gY2xpZmYgdWludDY0IFRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2Vuc29mIGEgc3BlY2lmIGdyYW50LgogICAqICB0cmFuc2ZlcmFibGVUb2tlbnMKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0CiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAvCiAgICogICB8ICAgICAgICAgICAgICAufAogICAqICAgfCAgICAgICAgICAgIC4gIHwKICAgKiAgIHwgICAgICAgICAgLiAgICB8CiAgICogICB8ICAgICAgICAuICAgICAgfAogICAqICAgfCAgICAgIC4gICAgICAgIHwKICAgKiAgIHwgICAgLiAgICAgICAgICB8CiAgICogICArPT09Kz09PT09PT09PT09Ky0tLS0tLS0tLSstLS0tLS0tLS0tPiB0aW1lCiAgICogICAgICBTdGFydCAgICAgICBDbGlmdCAgICBWZXN0aW5nCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgdWludDI1NiB0b2tlbnMsCiAgICB1aW50MjU2IHRpbWUsCiAgICB1aW50MjU2IHN0YXJ0LAogICAgdWludDI1NiBjbGlmZiwKICAgIHVpbnQyNTYgdmVzdGluZykgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuCiAgICAgIGlmICh0aW1lIDwgY2xpZmYpIHJldHVybiAwOwogICAgICBpZiAodGltZSA+PSB2ZXN0aW5nKSByZXR1cm4gdG9rZW5zOwoKICAgICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnMuCiAgICAgIC8vIEFzIGJlZm9yZSBjbGlmZiB0aGUgc2hvcnRjdXQgcmV0dXJucyAwLCB3ZSBjYW4gdXNlIGp1c3QgY2FsY3VsYXRlIGEgdmFsdWUKICAgICAgLy8gaW4gdGhlIHZlc3RpbmcgcmVjdCAoYXMgc2hvd24gaW4gYWJvdmUncyBmaWd1cmUpCgogICAgICAvLyB2ZXN0ZWRUb2tlbnMgPSB0b2tlbnMgKiAodGltZSAtIHN0YXJ0KSAvICh2ZXN0aW5nIC0gc3RhcnQpCiAgICAgIHVpbnQyNTYgdmVzdGVkVG9rZW5zID0gU2FmZU1hdGguZGl2KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5tdWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1Yih0aW1lLCBzdGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIodmVzdGluZywgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICByZXR1cm4gdmVzdGVkVG9rZW5zOwogIH0KCiAgLyoqCiAgICogQGRldiBHZXQgYWxsIGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmYyBncmFudC4KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLgogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50LgogICAqIEByZXR1cm4gUmV0dXJucyBhbGwgdGhlIHZhbHVlcyB0aGF0IHJlcHJlc2VudCBhIFRva2VuR3JhbnQoYWRkcmVzcywgdmFsdWUsIHN0YXJ0LCBjbGlmZiwKICAgKiByZXZva2FiaWxpdHksIGJ1cm5zT25SZXZva2UsIGFuZCB2ZXN0aW5nKSBwbHVzIHRoZSB2ZXN0ZWQgdmFsdWUgYXQgdGhlIGN1cnJlbnQgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0b2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7CiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKCiAgICBncmFudGVyID0gZ3JhbnQuZ3JhbnRlcjsKICAgIHZhbHVlID0gZ3JhbnQudmFsdWU7CiAgICBzdGFydCA9IGdyYW50LnN0YXJ0OwogICAgY2xpZmYgPSBncmFudC5jbGlmZjsKICAgIHZlc3RpbmcgPSBncmFudC52ZXN0aW5nOwogICAgcmV2b2thYmxlID0gZ3JhbnQucmV2b2thYmxlOwogICAgYnVybnNPblJldm9rZSA9IGdyYW50LmJ1cm5zT25SZXZva2U7CgogICAgdmVzdGVkID0gdmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldCB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLgogICAqIEBwYXJhbSB0aW1lIFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50IGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKi8KICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgICAgZ3JhbnQudmFsdWUsCiAgICAgIHVpbnQyNTYodGltZSksCiAgICAgIHVpbnQyNTYoZ3JhbnQuc3RhcnQpLAogICAgICB1aW50MjU2KGdyYW50LmNsaWZmKSwKICAgICAgdWludDI1NihncmFudC52ZXN0aW5nKQogICAgKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmYyBncmFudCBvbiB0aGUgCiAgICogcGFzc2VkIHRpbWUgZnJhbWUuCiAgICovCiAgZnVuY3Rpb24gbm9uVmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBncmFudC52YWx1ZS5zdWIodmVzdGVkVG9rZW5zKGdyYW50LCB0aW1lKSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgZGF0ZSB3aGVuIHRoZSBob2xkZXIgY2FuIHRyYXNmZXIgYWxsIGl0cyB0b2tlbnMKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50NjQgZGF0ZSkgewogICAgZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIGRhdGUgPSBTYWZlTWF0aC5tYXg2NChncmFudHNbaG9sZGVyXVtpXS52ZXN0aW5nLCBkYXRlKTsKICAgIH0KICB9Cn0KCi8vIC0gQ29uc2lkZXJpbmcgd2UgaW5oZXJpdCBmcm9tIFZlc3RlZFRva2VuLCBob3cgbXVjaCBkb2VzIHRoYXQgaGl0IGF0IG91ciBnYXMgcHJpY2U/Ci8vIC0gRW5zdXJlIG1heCBzdXBwbHkgaXMgMTUwLDAwMCwwMDAKLy8gLSBFbnN1cmUgdGhhdCBldmVuIGlmIG5vdCB0b3RhbFN1cHBseSBpcyBzb2xkLCB0b2tlbnMgd291bGQgc3RpbGwgYmUgdHJhbnNmZXJyYWJsZSBhZnRlci4KCi8vIHZlc3Rpbmc6IDM2NSBkYXlzLCAzNjUgZGF5cyAvIDQgdmVzdGluZwoKCmNvbnRyYWN0IEJUTiBpcyBWZXN0ZWRUb2tlbiB7CiAgLy9GSUVMRFMKICBzdHJpbmcgcHVibGljIG5hbWUgPSAiQkVUTmV0d29yayI7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiQlROIjsKICB1aW50IHB1YmxpYyBkZWNpbWFscyA9IDQ7CgogIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUdFX1BSRVNBTEVfRVRIUmFpc2VkID0gMzUwMCoxIGV0aGVyOyAvLyBTdGFnZSAxIEV0aGVyIDEwMDAwCiAgdWludCBwdWJsaWMgY29uc3RhbnQgU1RBR0VfVFdPX0VUSFJhaXNlZCA9IDg1MDAqMSBldGhlcjsgLy8gIFN0YWdlIDIgRXRoZXIgMTAwMDAKICB1aW50IHB1YmxpYyBjb25zdGFudCBTVEFHRV9USFJFRV9FVEhSYWlzZWQgPSAxNDAwMCoxIGV0aGVyOwogIHVpbnQgcHVibGljIGNvbnN0YW50IFNUQUdFX0ZPVVJfRVRIUmFpc2VkID0gMjAwMDAqMSBldGhlcjsKICAKICAvLyBNdWx0aXBsaWVyIGZvciB0aGUgZGVjaW1hbHMKICB1aW50IHByaXZhdGUgY29uc3RhbnQgREVDSU1BTFMgPSAxMDAwMDsKCiAgLy9QcmljZXMgb2YgQlROCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBTkRBUkQgICAgPSAzMTI4KkRFQ0lNQUxTOyAvLyBCVE4gcmVjZWl2ZWQgcGVyIG9uZSBFVEg7IE1BWF9TVVBQTFkgLyAodmFsdWF0aW9uIC8gZXRoUHJpY2UpCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBR0VfUFJFU0FMRSAgID0gUFJJQ0VfU1RBTkRBUkQgKiAxNDAvMTAwOyAvLyAxRVRIID0gNDAlIG1vcmUgQlROCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfU1RBR0VfVFdPICAgPSBQUklDRV9TVEFOREFSRCAqIDEyNS8xMDA7IC8vIDFFVEggPSAyNSUgbW9yZSBCVE4KICB1aW50IHB1YmxpYyBjb25zdGFudCBQUklDRV9TVEFHRV9USFJFRSA9IFBSSUNFX1NUQU5EQVJEICogMTE1LzEwMDsgLy8gMUVUSCA9IDE1JSBtb3JlIEJUTgogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1NUQUdFX0ZPVVIgPSBQUklDRV9TVEFOREFSRCAqIDEwNS8xMDA7IC8vIDFFVEggPSA1JSBtb3JlIEJUTgogIAogIC8vQlROIFRva2VuIExpbWl0cwogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX1RFQU0gPSAgICAgICAgIDIyNTAwMDAwKkRFQ0lNQUxTOyAvLyB0ZWFtCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfUkVTID0gICAgICAgICAyMjUwMDAwMCpERUNJTUFMUzsgLy8gUmVzZXJ2ZQogIHVpbnQgcHVibGljIGNvbnN0YW50IEFMTE9DX0NST1dEU0FMRSA9ICAgIDEwNTAwMDAwMCpERUNJTUFMUzsKICAKICAvL0FTU0lHTkVEIElOIElOSVRJQUxJWkFUSU9OCiAgLy9TdGFydCBhbmQgZW5kIHRpbWVzCiAgdWludCBwdWJsaWMgcHVibGljU3RhcnRUaW1lOyAvLyBUaW1lIGluIHNlY29uZHMgcHVibGljIGNyb3dkIHNhbGUgc3RhcnRzLgogIHVpbnQgcHVibGljIHB1YmxpY0VuZFRpbWU7IC8vIFRpbWUgaW4gc2Vjb25kcyBCVE4gY3Jvd2RzYWxlIGVuZHMKICB1aW50IHB1YmxpYyBoYXJkY2FwSW5FdGg9MzAwMDAqIDEgZXRoZXI7CgogIC8vU3BlY2lhbCBBZGRyZXNzZXMKICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ0FkZHJlc3M9MHgyREQwMTY2NjhCRDQwOUI3RTE5ODhkRmRkQzA4Mzg4ZTQ0OGYxRTkwOyAvLyBBZGRyZXNzIHRvIHdoaWNoIGFsbCBldGhlciBmdW5kIGZsb3dzLgogIGFkZHJlc3MgcHVibGljIEJFVE5ldHdvcmtUZWFtQWRkcmVzcz0weGRDRTU5OTk5ODhhNDBBRjBmOUU2YjczRUFGOUQ1YTFEQzAxYTI0RTk7IC8vIEFkZHJlc3MgdG8gd2hpY2ggdGVhbXMgZnVuZHMgdHJhbnNmZXJyZWQuCiAgYWRkcmVzcyBwdWJsaWMgb3duZXJBZGRyZXNzOyAvLyBBZGRyZXNzIG9mIHRoZSBjb250cmFjdCBvd25lci4gQ2FuIGhhbHQgdGhlIGNyb3dkc2FsZS4KCgogIC8vUnVubmluZyB0b3RhbHMKICB1aW50IHB1YmxpYyBldGhlclJhaXNlZDsgLy8gVG90YWwgRXRoZXIgcmFpc2VkLgogIHVpbnQgcHVibGljIEJUTlNvbGQ7IC8vIFRvdGFsIEJUTiBjcmVhdGVkCiAgCiAgLy9ib29sZWFucwogIGJvb2wgcHVibGljIGhhbHRlZDsgLy8gaGFsdHMgdGhlIGNyb3dkIHNhbGUgaWYgdHJ1ZS4KCiAgLy8gTU9ESUZJRVJTCiAgLy9JcyBjdXJyZW50bHkgaW4gdGhlIHBlcmlvZCBhZnRlciB0aGUgcHJpdmF0ZSBzdGFydCB0aW1lIGFuZCBiZWZvcmUgdGhlIHB1YmxpYyBzdGFydCB0aW1lLgogIG1vZGlmaWVyIGlzX3ByZV9jcm93ZGZ1bmRfcGVyaW9kKCkgewogICAgaWYgKG5vdyA+PSBwdWJsaWNTdGFydFRpbWUgKSB0aHJvdzsKICAgIF87CiAgfQoKICAvL0lzIGN1cnJlbnRseSB0aGUgY3Jvd2RmdW5kIHBlcmlvZAogIG1vZGlmaWVyIGlzX2Nyb3dkZnVuZF9wZXJpb2QoKSB7CiAgICBpZiAobm93IDwgcHVibGljU3RhcnRUaW1lKSB0aHJvdzsKICAgIGlmIChpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKSB0aHJvdzsKICAgIF87CiAgfQoKICAvLyBJcyBjb21wbGV0ZWQKICBtb2RpZmllciBpc19jcm93ZGZ1bmRfY29tcGxldGVkKCkgewogICAgaWYgKCFpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKSB0aHJvdzsKICAgIF87CiAgfQogIGZ1bmN0aW9uIGlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKG5vdyA+IHB1YmxpY0VuZFRpbWUgfHwgQlROU29sZCA+PSBBTExPQ19DUk9XRFNBTEUgfHwgZXRoZXJSYWlzZWQgPj0gaGFyZGNhcEluRXRoKSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vTWF5IG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBhZGRyZXNzCiAgbW9kaWZpZXIgb25seV9vd25lcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyQWRkcmVzcykgdGhyb3c7CiAgICBfOwogIH0KCiAgLy9NYXkgb25seSBiZSBjYWxsZWQgaWYgdGhlIGNyb3dkZnVuZCBoYXMgbm90IGJlZW4gaGFsdGVkCiAgbW9kaWZpZXIgaXNfbm90X2hhbHRlZCgpIHsKICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIC8vIEVWRU5UUwogIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgX3JlY2lwaWVudCwgdWludCBfYW1vdW50KTsKCiAgLy8gSW5pdGlhbGl6YXRpb24gY29udHJhY3QgYXNzaWducyBhZGRyZXNzIG9mIGNyb3dkZnVuZCBjb250cmFjdCBhbmQgZW5kIHRpbWUuCiAgZnVuY3Rpb24gQlROKCkgewogICAgb3duZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIHB1YmxpY1N0YXJ0VGltZSA9IG5vdzsKICAgIHB1YmxpY0VuZFRpbWUgPSBub3cgKyA2IHdlZWtzOwogICAgYmFsYW5jZXNbQkVUTmV0d29ya1RlYW1BZGRyZXNzXSArPSBBTExPQ19URUFNOwogICAgYmFsYW5jZXNbb3duZXJBZGRyZXNzXSArPSBBTExPQ19SRVM7CiAgICBiYWxhbmNlc1tvd25lckFkZHJlc3NdICs9IEFMTE9DX0NST1dEU0FMRTsKICB9CgogIC8vIFRyYW5zZmVyIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBzZW5kZXIgYWNjb3VudCB0byByZWNpcGllbnQuCiAgLy8gT25seSBjYWxsYWJsZSBhZnRlciB0aGUgY3Jvd2QgZnVuZCBpcyBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpCiAgewogICAgaWYgKF90byA9PSBtc2cuc2VuZGVyKSByZXR1cm47IC8vIG5vLW9wLCBhbGxvdyBldmVuIGR1cmluZyBjcm93ZHNhbGUsIGluIG9yZGVyIHRvIHdvcmsgYXJvdW5kIHVzaW5nIGdyYW50VmVzdGVkVG9rZW5zKCkgd2hpbGUgaW4gY3Jvd2RzYWxlCiAgICBpZiAoIWlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkpIHRocm93OwogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYSByZWNpcGllbnQuCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIHNlbmRlciBhY2NvdW50IHRvIHJlY2lwaWVudC4KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZAogIHsKICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLy9jb25zdGFudCBmdW5jdGlvbiByZXR1cm5zIHRoZSBjdXJyZW50IEJUTiBwcmljZS4KICBmdW5jdGlvbiBnZXRQcmljZVJhdGUoKQogICAgICBjb25zdGFudAogICAgICByZXR1cm5zICh1aW50IG9fcmF0ZSkKICB7CiAgICAgIHVpbnQgZGVsdGEgPSBldGhlclJhaXNlZDsKICAgICAgaWYgKGRlbHRhIDwgU1RBR0VfUFJFU0FMRV9FVEhSYWlzZWQpIHJldHVybiBQUklDRV9TVEFHRV9QUkVTQUxFOwogICAgICBpZiAoZGVsdGEgPCBTVEFHRV9UV09fRVRIUmFpc2VkKSByZXR1cm4gUFJJQ0VfU1RBR0VfVFdPOwogICAgICBpZiAoZGVsdGEgPCBTVEFHRV9USFJFRV9FVEhSYWlzZWQpIHJldHVybiBQUklDRV9TVEFHRV9USFJFRTsKICAgICAgIGlmIChkZWx0YSA8IFNUQUdFX0ZPVVJfRVRIUmFpc2VkKSByZXR1cm4gUFJJQ0VfU1RBR0VfRk9VUjsKICAgICAgcmV0dXJuIChQUklDRV9TVEFOREFSRCk7CiAgfQoKICAvLyBjYWxjdWxhdGVzIHdtb3VudCBvZiBCVE4gd2UgZ2V0LCBnaXZlbiB0aGUgd2VpIGFuZCB0aGUgcmF0ZXMgd2UndmUgZGVmaW5lZCBwZXIgMSBldGgKICBmdW5jdGlvbiBjYWxjQW1vdW50KHVpbnQgX3dlaSwgdWludCBfcmF0ZSkgCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCkgCiAgewogICAgcmV0dXJuIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoX3dlaSwgX3JhdGUpLCAxIGV0aGVyKTsKICB9IAogIAogIC8vIEdpdmVuIHRoZSByYXRlIG9mIGEgcHVyY2hhc2UgYW5kIHRoZSByZW1haW5pbmcgdG9rZW5zIGluIHRoaXMgdHJhbmNoZSwgaXQKICAvLyB3aWxsIHRocm93IGlmIHRoZSBzYWxlIHdvdWxkIHRha2UgaXQgcGFzdCB0aGUgbGltaXQgb2YgdGhlIHRyYW5jaGUuCiAgLy8gUmV0dXJucyBgYW1vdW50YCBpbiBzY29wZSBhcyB0aGUgbnVtYmVyIG9mIEJUTiB0b2tlbnMgdGhhdCBpdCB3aWxsIHB1cmNoYXNlLgogIGZ1bmN0aW9uIHByb2Nlc3NQdXJjaGFzZSh1aW50IF9yYXRlLCB1aW50IF9yZW1haW5pbmcpCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAodWludCBvX2Ftb3VudCkKICB7CiAgICBvX2Ftb3VudCA9IGNhbGNBbW91bnQobXNnLnZhbHVlLCBfcmF0ZSk7CgogICAgaWYgKG9fYW1vdW50ID4gX3JlbWFpbmluZykgdGhyb3c7CiAgICBpZiAoIW11bHRpc2lnQWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpIHRocm93OwoKICAgIGJhbGFuY2VzW293bmVyQWRkcmVzc10gPSBiYWxhbmNlc1tvd25lckFkZHJlc3NdLnN1YihvX2Ftb3VudCk7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChvX2Ftb3VudCk7CgogICAgQlROU29sZCArPSBvX2Ftb3VudDsKICAgIGV0aGVyUmFpc2VkICs9IG1zZy52YWx1ZTsKICB9CgogIC8vRGVmYXVsdCBmdW5jdGlvbiBjYWxsZWQgYnkgc2VuZGluZyBFdGhlciB0byB0aGlzIGFkZHJlc3Mgd2l0aCBubyBhcmd1bWVudHMuCiAgLy9SZXN1bHRzIGluIGNyZWF0aW9uIG9mIG5ldyBCVE4gVG9rZW5zIGlmIHRyYW5zYWN0aW9uIHdvdWxkIG5vdCBleGNlZWQgaGFyZCBsaW1pdCBvZiBBRFggVG9rZW4uCiAgZnVuY3Rpb24oKQogICAgcGF5YWJsZQogICAgaXNfY3Jvd2RmdW5kX3BlcmlvZAogICAgaXNfbm90X2hhbHRlZAogIHsKICAgIHVpbnQgYW1vdW50ID0gcHJvY2Vzc1B1cmNoYXNlKGdldFByaWNlUmF0ZSgpLCBTYWZlTWF0aC5zdWIoQUxMT0NfQ1JPV0RTQUxFLCBCVE5Tb2xkKSk7CiAgICBCdXkobXNnLnNlbmRlciwgYW1vdW50KTsKICB9CgogIC8vIFRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGNyb3dkZnVuZCBwZXJpb2QKICAvLyBXQVJOSU5HOiB0cmFuc2ZlcigpLCB3aGljaCBpcyBjYWxsZWQgYnkgZ3JhbnRWZXN0ZWRUb2tlbnMoKSwgd2FudHMgYSBtaW5pbXVtIG1lc3NhZ2UgbGVuZ3RoCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWQoYWRkcmVzcyBfQkVUTmV0d29ya1RlYW1BZGRyZXNzLCBhZGRyZXNzIF9CRVROZXR3b3JrRnVuZEFkZHJlc3MpCiAgICBpc19jcm93ZGZ1bmRfY29tcGxldGVkCiAgICBvbmx5X293bmVyCiAgICBpc19ub3RfaGFsdGVkCiAgewogICAgLy8gR3JhbnQgdG9rZW5zIHByZS1hbGxvY2F0ZWQgZm9yIHRoZSB0ZWFtCiAgICBncmFudFZlc3RlZFRva2VucygKICAgICAgX0JFVE5ldHdvcmtUZWFtQWRkcmVzcywgQUxMT0NfVEVBTSwKICAgICAgdWludDY0KG5vdyksIHVpbnQ2NChub3cpICsgOTEgZGF5cyAsIHVpbnQ2NChub3cpICsgMzY1IGRheXMsIAogICAgICBmYWxzZSwgZmFsc2UKICAgICk7CgogICAgLy8gR3JhbnQgdG9rZW5zIHRoYXQgcmVtYWluIGFmdGVyIGNyb3dkc2FsZSB0byB0aGUgQkVUTmV0d29yayBmdW5kLCB2ZXN0ZWQgZm9yIDIgeWVhcnMKICAgIGdyYW50VmVzdGVkVG9rZW5zKAogICAgICBfQkVUTmV0d29ya0Z1bmRBZGRyZXNzLCBiYWxhbmNlc1tvd25lckFkZHJlc3NdLAogICAgICB1aW50NjQobm93KSwgdWludDY0KG5vdykgKyAxODIgZGF5cyAsIHVpbnQ2NChub3cpICsgNzMwIGRheXMsIAogICAgICBmYWxzZSwgZmFsc2UKICAgICk7CiAgfQoKICAvL01heSBiZSB1c2VkIGJ5IG93bmVyIG9mIGNvbnRyYWN0IHRvIGhhbHQgY3Jvd2RzYWxlIGFuZCBubyBsb25nZXIgZXhjZXB0IGV0aGVyLgogIGZ1bmN0aW9uIHRvZ2dsZUhhbHQoYm9vbCBfaGFsdGVkKQogICAgb25seV9vd25lcgogIHsKICAgIGhhbHRlZCA9IF9oYWx0ZWQ7CiAgfQoKICAvL2ZhaWxzYWZlIGRyYWluCiAgZnVuY3Rpb24gZHJhaW4oKQogICAgb25seV9vd25lcgogIHsKICAgIGlmICghb3duZXJBZGRyZXNzLnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7CiAgfQp9'.
	

]
