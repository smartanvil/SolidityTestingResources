Class {
	#name : #SRT3fdfd6f586ec42b4db17bac2cc2acd1587004f1c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3fdfd6f586ec42b4db17bac2cc2acd1587004f1c >> base64 [
	^ 'LyoKCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgoKICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgoqLwpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE1hdGgKICogQGRldiBBc3NvcnRlZCBtYXRoIG9wZXJhdGlvbnMKICovCgpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCi8vLyBAdGl0bGUgVWludFV0aWwKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImZkOTk5YzkzOTQ5ODkxYmQ5MTkyOTI4ZDhmOTQ5MzlhZDM5MjhmOWEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgovLy8gQGRldiB1aW50IHV0aWxpdHkgZnVuY3Rpb25zCmxpYnJhcnkgVWludExpYiB7CiAgICB1c2luZyBTYWZlTWF0aCAgZm9yIHVpbnQ7CgogICAgZnVuY3Rpb24gdG9sZXJhbnRTdWIodWludCB4LCB1aW50IHkpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgeikgewogICAgICAgIGlmICh4ID49IHkpCiAgICAgICAgICAgIHogPSB4IC0geTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHogPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG5leHQodWludCBpLCB1aW50IHNpemUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gKGkgKyAxKSAlIHNpemU7CiAgICB9CgogICAgZnVuY3Rpb24gcHJldih1aW50IGksIHVpbnQgc2l6ZSkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiAoaSArIHNpemUgLSAxKSAlIHNpemU7CiAgICB9CgogICAgLy8vIEBkZXYgY2FsY3VsYXRlIHRoZSBzcXVhcmUgb2YgQ29lZmZpY2llbnQgb2YgVmFyaWF0aW9uIChDVikKICAgIC8vLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db2VmZmljaWVudF9vZl92YXJpYXRpb24KICAgIGZ1bmN0aW9uIGN2c3F1YXJlKAogICAgICAgIHVpbnRbXSBhcnIsCiAgICAgICAgdWludCBzY2FsZSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB1aW50IGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgcmVxdWlyZShsZW4gPiAxKTsKICAgICAgICByZXF1aXJlKHNjYWxlID4gMCk7CgogICAgICAgIHVpbnQgYXZnID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBhdmcgKz0gYXJyW2ldOwogICAgICAgIH0KCiAgICAgICAgYXZnID0gYXZnLmRpdihsZW4pOwoKICAgICAgICBpZiAoYXZnID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IGN2cyA9IDA7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgc3ViID0gMDsKICAgICAgICAgICAgaWYgKGFycltpXSA+IGF2ZykgewogICAgICAgICAgICAgICAgc3ViID0gYXJyW2ldIC0gYXZnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3ViID0gYXZnIC0gYXJyW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN2cyArPSBzdWIubXVsKHN1Yik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY3ZzLm11bChzY2FsZSkuZGl2KGF2ZykubXVsKHNjYWxlKS5kaXYoYXZnKS5kaXYobGVuIC0gMSk7CiAgICB9Cn0KCi8vLyBAdGl0bGUgVG9rZW4gUmVnaXN0ZXIgQ29udHJhY3QKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0MzI4MmMyZDI0MmYyYTIyMmQyNDAzMmYyYzJjMzMzMTJhMmQyNDZkMmMzMTI0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI4ZmViZWVlMWU2ZWFlM2NmZTNlMGUwZmZmZGU2ZTFlOGExZTBmZGU4Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmxpYnJhcnkgVWludDhMaWIgewogICAgZnVuY3Rpb24geG9yUmVkdWNlKAogICAgICAgIHVpbnQ4W10gYXJyLAogICAgICAgIHVpbnQgICAgbGVuCiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50OCByZXMpCiAgICB7CiAgICAgICAgcmVzID0gYXJyWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlcyBePSBhcnJbaV07CiAgICAgICAgfQogICAgfQp9CgovLy8gQHRpdGxlIFRva2VuIFJlZ2lzdGVyIENvbnRyYWN0Ci8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJiNWQxZDRkYmRjZDBkOWY1ZDlkYWRhYzVjN2RjZGJkMjliZGFjN2QyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmxpYnJhcnkgRXJyb3JMaWIgewoKICAgIGV2ZW50IEVycm9yKHN0cmluZyBtZXNzYWdlKTsKCiAgICAvLy8gQGRldiBDaGVjayBpZiBjb25kaXRpb24gaG9sZCwgaWYgbm90LCBsb2cgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnQuCiAgICBmdW5jdGlvbiBjaGVjayhib29sIGNvbmRpdGlvbiwgc3RyaW5nIG1lc3NhZ2UpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICBpZiAoIWNvbmRpdGlvbikgewogICAgICAgICAgICBlcnJvcihtZXNzYWdlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZXJyb3Ioc3RyaW5nIG1lc3NhZ2UpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICBFcnJvcihtZXNzYWdlKTsKICAgICAgICByZXZlcnQoKTsKICAgIH0KfQoKLy8vIEB0aXRsZSBUb2tlbiBSZWdpc3RlciBDb250cmFjdAovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjUxM2EzZTNmMzYzZDM4MzAzZjM2MTEzZDNlM2UyMTIzMzgzZjM2N2YzZTIzMzYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiwKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjMzNTc1MjVkNWE1NjVmNzM1ZjVjNWM0MzQxNWE1ZDU0MWQ1YzQxNTQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pi4KbGlicmFyeSBCeXRlczMyTGliIHsKCiAgICBmdW5jdGlvbiB4b3JSZWR1Y2UoCiAgICAgICAgYnl0ZXMzMltdICAgYXJyLAogICAgICAgIHVpbnQgICAgICAgIGxlbgogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiByZXMpCiAgICB7CiAgICAgICAgcmVzID0gYXJyWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlcyA9IHhvck9wKHJlcywgYXJyW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24geG9yT3AoCiAgICAgICAgYnl0ZXMzMiBiczEsCiAgICAgICAgYnl0ZXMzMiBiczIKICAgICAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJ5dGVzMzIgcmVzKQogICAgewogICAgICAgIGJ5dGVzIG1lbW9yeSB0ZW1wID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAzMjsgaSsrKSB7CiAgICAgICAgICAgIHRlbXBbaV0gPSBiczFbaV0gXiBiczJbaV07CiAgICAgICAgfQogICAgICAgIHN0cmluZyBtZW1vcnkgc3RyID0gc3RyaW5nKHRlbXApOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmVzIDo9IG1sb2FkKGFkZChzdHIsIDMyKSkKICAgICAgICB9CiAgICB9Cn0KCi8vLyBAdGl0bGUgVG9rZW4gUmVnaXN0ZXIgQ29udHJhY3QKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5MWZhZmVmZmY2ZmRmOGYwZmZmNmQxZmRmZWZlZTFlM2Y4ZmZmNmJmZmVlM2Y2Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI3YzE4MWQxMjE1MTkxMDNjMTAxMzEzMGMwZTE1MTIxYjUyMTMwZTFiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmNvbnRyYWN0IFRva2VuUmVnaXN0cnkgaXMgT3duYWJsZSB7CgogICAgYWRkcmVzc1tdIHB1YmxpYyB0b2tlbnM7CgogICAgbWFwcGluZyAoc3RyaW5nID0+IGFkZHJlc3MpIHRva2VuU3ltYm9sTWFwOwoKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVG9rZW4oYWRkcmVzcyBfdG9rZW4sIHN0cmluZyBfc3ltYm9sKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoIWlzVG9rZW5SZWdpc3RlcmVkQnlTeW1ib2woX3N5bWJvbCkpOwogICAgICAgIHJlcXVpcmUoIWlzVG9rZW5SZWdpc3RlcmVkKF90b2tlbikpOwogICAgICAgIHRva2Vucy5wdXNoKF90b2tlbik7CiAgICAgICAgdG9rZW5TeW1ib2xNYXBbX3N5bWJvbF0gPSBfdG9rZW47CiAgICB9CgogICAgZnVuY3Rpb24gdW5yZWdpc3RlclRva2VuKGFkZHJlc3MgX3Rva2VuLCBzdHJpbmcgX3N5bWJvbCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKHRva2VuU3ltYm9sTWFwW19zeW1ib2xdID09IF90b2tlbik7CiAgICAgICAgZGVsZXRlIHRva2VuU3ltYm9sTWFwW19zeW1ib2xdOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodG9rZW5zW2ldID09IF90b2tlbikgewogICAgICAgICAgICAgICAgdG9rZW5zW2ldID09IHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICB0b2tlbnMubGVuZ3RoIC0tOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNUb2tlblJlZ2lzdGVyZWRCeVN5bWJvbChzdHJpbmcgc3ltYm9sKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gdG9rZW5TeW1ib2xNYXBbc3ltYm9sXSAhPSBhZGRyZXNzKDApOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzVG9rZW5SZWdpc3RlcmVkKGFkZHJlc3MgX3Rva2VuKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0b2tlbnNbaV0gPT0gX3Rva2VuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWRkcmVzc0J5U3ltYm9sKHN0cmluZyBzeW1ib2wpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIHJldHVybiB0b2tlblN5bWJvbE1hcFtzeW1ib2xdOwogICAgfQoKfQoKLy8vIEB0aXRsZSBUb2tlblRyYW5zZmVyRGVsZWdhdGUgLSBBY3RzIGFzIGEgbWlkZGxlIG1hbiB0byB0cmFuc2ZlciBFUkMyMCB0b2tlbnMKLy8vIG9uIGJlaGFsZiBvZiBkaWZmZXJlbnQgdmVyc2lvbmVkIG9mIExvb3ByaW5nIHByb3RvY29sIHRvIGF2b2lkIEVSQzIwCi8vLyByZS1hdXRob3JpemF0aW9uLgovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNjMwNzAyMGQwYTA2MGYyMzBmMGMwYzEzMTEwYTBkMDQ0ZDBjMTEwNCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Lgpjb250cmFjdCBUb2tlblRyYW5zZmVyRGVsZWdhdGUgaXMgT3duYWJsZSB7CiAgICB1c2luZyBNYXRoIGZvciB1aW50OwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBWYXJpYWJsZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICB1aW50IGxhc3RWZXJzaW9uID0gMDsKICAgIGFkZHJlc3NbXSBwdWJsaWMgdmVyc2lvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB2ZXJzaW9uZWQ7CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBNb2RpZmllcnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBtb2RpZmllciBpc1ZlcnNpb25lZChhZGRyZXNzIGFkZHIpIHsKICAgICAgICBpZiAodmVyc2lvbmVkW2FkZHJdID09IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90VmVyc2lvbmVkKGFkZHJlc3MgYWRkcikgewogICAgICAgIGlmICh2ZXJzaW9uZWRbYWRkcl0gPiAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gRXZlbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZXZlbnQgVmVyc2lvbkFkZGVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50IHZlcnNpb24pOwoKICAgIGV2ZW50IFZlcnNpb25SZW1vdmVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50IHZlcnNpb24pOwoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgQWRkIGEgTG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkciBBIGxvb3ByaW5nIHByb3RvY29sIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBhZGRWZXJzaW9uKGFkZHJlc3MgYWRkcikKICAgICAgICBvbmx5T3duZXIKICAgICAgICBub3RWZXJzaW9uZWQoYWRkcikKICAgIHsKICAgICAgICB2ZXJzaW9uZWRbYWRkcl0gPSArK2xhc3RWZXJzaW9uOwogICAgICAgIHZlcnNpb25zLnB1c2goYWRkcik7CiAgICAgICAgVmVyc2lvbkFkZGVkKGFkZHIsIGxhc3RWZXJzaW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmUgYSBMb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIEEgbG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHJlbW92ZVZlcnNpb24oYWRkcmVzcyBhZGRyKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGlzVmVyc2lvbmVkKGFkZHIpCiAgICB7CiAgICAgICAgcmVxdWlyZSh2ZXJzaW9uZWRbYWRkcl0gPiAwKTsKICAgICAgICB1aW50IHZlcnNpb24gPSB2ZXJzaW9uZWRbYWRkcl07CiAgICAgICAgZGVsZXRlIHZlcnNpb25lZFthZGRyXTsKCiAgICAgICAgdWludCBsZW5ndGggPSB2ZXJzaW9ucy5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHZlcnNpb25zW2ldID09IGFkZHIpIHsKICAgICAgICAgICAgICAgIHZlcnNpb25zW2ldID0gdmVyc2lvbnNbbGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICB2ZXJzaW9ucy5sZW5ndGggLT0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFZlcnNpb25SZW1vdmVkKGFkZHIsIHZlcnNpb24pOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiBFUkMyMCB0b2tlbiB0aGF0IGNhbiBiZSBzcGVudCBieSB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSB0b2tlbkFkZHJlc3MgQWRkcmVzcyBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdGhlIHRva2VuIG93bmVyLgogICAgZnVuY3Rpb24gZ2V0U3BlbmRhYmxlKAogICAgICAgIGFkZHJlc3MgdG9rZW5BZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX293bmVyCiAgICAgICAgKQogICAgICAgIGlzVmVyc2lvbmVkKG1zZy5zZW5kZXIpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewoKICAgICAgICB2YXIgdG9rZW4gPSBFUkMyMCh0b2tlbkFkZHJlc3MpOwogICAgICAgIHJldHVybiB0b2tlbi5hbGxvd2FuY2UoCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgYWRkcmVzcyh0aGlzKQogICAgICAgICkubWluMjU2KAogICAgICAgICAgICB0b2tlbi5iYWxhbmNlT2YoX293bmVyKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgSW52b2tlIEVSQzIwIHRyYW5zZmVyRnJvbSBtZXRob2QuCiAgICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGZyb20gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbiBmcm9tLgogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VuIHRvLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBUYW5zZmVyIHJlc3VsdC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oCiAgICAgICAgYWRkcmVzcyB0b2tlbiwKICAgICAgICBhZGRyZXNzIGZyb20sCiAgICAgICAgYWRkcmVzcyB0bywKICAgICAgICB1aW50IHZhbHVlKQogICAgICAgIGlzVmVyc2lvbmVkKG1zZy5zZW5kZXIpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoZnJvbSA9PSB0bykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIEVSQzIwKHRva2VuKS50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgR2V0cyBhbGwgdmVyc2lvbmVkIGFkZHJlc3Nlcy4KICAgIC8vLyBAcmV0dXJuIEFycmF5IG9mIHZlcnNpb25lZCBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9ucygpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10pCiAgICB7CiAgICAgICAgcmV0dXJuIHZlcnNpb25zOwogICAgfQp9CgovLy8gQHRpdGxlIFJpbmcgSGFzaCBSZWdpc3RyeSBDb250cmFjdAovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImM2YWRhOWE4YTFhYWFmYTdhOGExODZhYWE5YTliNmI0YWZhOGExZThhOWI0YTEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiwKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjMwNTQ1MTVlNTk1NTVjNzA1YzVmNWY0MDQyNTk1ZTU3MWU1ZjQyNTciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pi4KY29udHJhY3QgUmluZ2hhc2hSZWdpc3RyeSB7CiAgICB1c2luZyBCeXRlczMyTGliICAgIGZvciBieXRlczMyW107CiAgICB1c2luZyBFcnJvckxpYiAgICAgIGZvciBib29sOwogICAgdXNpbmcgVWludDhMaWIgICAgICBmb3IgdWludDhbXTsKCiAgICB1aW50IHB1YmxpYyBibG9ja3NUb0xpdmU7CgogICAgc3RydWN0IFN1Ym1pc3Npb24gewogICAgICAgIGFkZHJlc3MgcmluZ21pbmVyOwogICAgICAgIHVpbnQgYmxvY2s7CiAgICB9CgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBTdWJtaXNzaW9uKSBzdWJtaXNzaW9uczsKCgogICAgLy8vIEV2ZW50cwoKICAgIGV2ZW50IFJpbmdoYXNoU3VibWl0dGVkKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfcmluZ21pbmVyLAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBfcmluZ2hhc2gKICAgICk7CgogICAgLy8vIENvbnN0cnVjdG9yCgogICAgZnVuY3Rpb24gUmluZ2hhc2hSZWdpc3RyeSh1aW50IF9ibG9ja3NUb0xpdmUpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShfYmxvY2tzVG9MaXZlID4gMCk7CiAgICAgICAgYmxvY2tzVG9MaXZlID0gX2Jsb2Nrc1RvTGl2ZTsKICAgIH0KCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmdoYXNoKAogICAgICAgIHVpbnQgICAgICAgIHJpbmdTaXplLAogICAgICAgIGFkZHJlc3MgICAgIHJpbmdtaW5lciwKICAgICAgICB1aW50OFtdICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICByTGlzdCwKICAgICAgICBieXRlczMyW10gICBzTGlzdCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBieXRlczMyIHJpbmdoYXNoID0gY2FsY3VsYXRlUmluZ2hhc2goCiAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0CiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIGNhblN1Ym1pdChyaW5naGFzaCwgcmluZ21pbmVyKSwKICAgICAgICAgICAgIlJpbmdoYXNoIHN1Ym1pdHRlZCIKICAgICAgICApOwoKICAgICAgICBzdWJtaXNzaW9uc1tyaW5naGFzaF0gPSBTdWJtaXNzaW9uKHJpbmdtaW5lciwgYmxvY2subnVtYmVyKTsKICAgICAgICBSaW5naGFzaFN1Ym1pdHRlZChyaW5nbWluZXIsIHJpbmdoYXNoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5TdWJtaXQoCiAgICAgICAgYnl0ZXMzMiByaW5naGFzaCwKICAgICAgICBhZGRyZXNzIHJpbmdtaW5lcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdmFyIHN1Ym1pc3Npb24gPSBzdWJtaXNzaW9uc1tyaW5naGFzaF07CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgc3VibWlzc2lvbi5yaW5nbWluZXIgPT0gYWRkcmVzcygwKSB8fCAoCiAgICAgICAgICAgIHN1Ym1pc3Npb24uYmxvY2sgKyBibG9ja3NUb0xpdmUgPCBibG9jay5udW1iZXIpIHx8ICgKICAgICAgICAgICAgc3VibWlzc2lvbi5yaW5nbWluZXIgPT0gcmluZ21pbmVyKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBhIHJpbmcncyBoYXNoIGhhcyBldmVyIGJlZW4gc3VibWl0dGVkOyBmYWxzZSBvdGhlcndpc2UuCiAgICBmdW5jdGlvbiByaW5naGFzaEZvdW5kKGJ5dGVzMzIgcmluZ2hhc2gpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewoKICAgICAgICByZXR1cm4gc3VibWlzc2lvbnNbcmluZ2hhc2hdLnJpbmdtaW5lciAhPSBhZGRyZXNzKDApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgaGFzaCBvZiBhIHJpbmcuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSaW5naGFzaCgKICAgICAgICB1aW50ICAgICAgICByaW5nU2l6ZSwKICAgICAgICB1aW50OFtdICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICByTGlzdCwKICAgICAgICBieXRlczMyW10gICBzTGlzdCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJ5dGVzMzIpCiAgICB7CiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIHJpbmdTaXplID09IHZMaXN0Lmxlbmd0aCAtIDEgJiYgKAogICAgICAgICAgICByaW5nU2l6ZSA9PSByTGlzdC5sZW5ndGggLSAxKSAmJiAoCiAgICAgICAgICAgIHJpbmdTaXplID09IHNMaXN0Lmxlbmd0aCAtIDEpLAogICAgICAgICAgICAiaW52YWxpZCByaW5nIGRhdGEiCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIGtlY2NhazI1NigKICAgICAgICAgICAgdkxpc3QueG9yUmVkdWNlKHJpbmdTaXplKSwKICAgICAgICAgICAgckxpc3QueG9yUmVkdWNlKHJpbmdTaXplKSwKICAgICAgICAgICAgc0xpc3QueG9yUmVkdWNlKHJpbmdTaXplKQogICAgICAgICk7CiAgICB9Cn0KCi8vLyBAdGl0bGUgTG9vcHJpbmcgVG9rZW4gRXhjaGFuZ2UgUHJvdG9jb2wgQ29udHJhY3QgSW50ZXJmYWNlCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI3YzE4MWQxMjE1MTkxMDNjMTAxMzEzMGMwZTE1MTIxYjUyMTMwZTFiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlMzg4OGM4ZDg0OGY4YTgyOGQ4NGEzOGY4YzhjOTM5MThhOGQ4NGNkOGM5MTg0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgTG9vcHJpbmdQcm90b2NvbCB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0YW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgdWludCAgICBwdWJsaWMgY29uc3RhbnQgRkVFX1NFTEVDVF9MUkMgICAgICAgICAgICAgICA9IDA7CiAgICB1aW50ICAgIHB1YmxpYyBjb25zdGFudCBGRUVfU0VMRUNUX01BUkdJTl9TUExJVCAgICAgID0gMTsKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IEZFRV9TRUxFQ1RfTUFYX1ZBTFVFICAgICAgICAgPSAxOwoKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IE1BUkdJTl9TUExJVF9QRVJDRU5UQUdFX0JBU0UgPSAxMDA7CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBTdHJ1Y3RzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQHBhcmFtIHRva2VuUyAgICAgICBUb2tlbiB0byBzZWxsLgogICAgLy8vIEBwYXJhbSB0b2tlbkIgICAgICAgVG9rZW4gdG8gYnV5LgogICAgLy8vIEBwYXJhbSBhbW91bnRTICAgICAgTWF4aW11bSBhbW91bnQgb2YgdG9rZW5TIHRvIHNlbGwuCiAgICAvLy8gQHBhcmFtIGFtb3VudEIgICAgICBNaW5pbXVtIGFtb3VudCBvZiB0b2tlbkIgdG8gYnV5IGlmIGFsbCBhbW91bnRTIHNvbGQuCiAgICAvLy8gQHBhcmFtIHRpbWVzdGFtcCAgICBJbmRpY2F0aW5nIHdodG4gdGhpcyBvcmRlciBpcyBjcmVhdGVkL3NpZ25lZC4KICAgIC8vLyBAcGFyYW0gdHRsICAgICAgICAgIEluZGljYXRpbmcgYWZ0ZXIgaG93IG1hbnkgc2Vjb25kcyBmcm9tIGB0aW1lc3RhbXBgCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGlzIG9yZGVyIHdpbGwgZXhwaXJlLgogICAgLy8vIEBwYXJhbSBzYWx0ICAgICAgICAgQSByYW5kb20gbnVtYmVyIHRvIG1ha2UgdGhpcyBvcmRlcidzIGhhc2ggdW5pcXVlLgogICAgLy8vIEBwYXJhbSBscmNGZWUgICAgICAgTWF4IGFtb3VudCBvZiBMUkMgdG8gcGF5IGZvciBtaW5lci4gVGhlIHJlYWwgYW1vdW50CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0byBwYXkgaXMgcHJvcG9ydGlvbmFsIHRvIGZpbGwgYW1vdW50LgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBJZiB0cnVlLCB0aGlzIG9yZGVyIGRvZXMgbm90IGFjY2VwdCBidXlpbmcgbW9yZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhhbiBgYW1vdW50QmAuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGUgcGVyY2VudGFnZSBvZiBtYXJnaW4gcGFpZCB0byBtaW5lci4KICAgIC8vLyBAcGFyYW0gdiAgICAgICAgICAgIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciAgICAgICAgICAgIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgICAgICAgICAgICBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgc3RydWN0IE9yZGVyIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIGFkZHJlc3MgdG9rZW5TOwogICAgICAgIGFkZHJlc3MgdG9rZW5COwogICAgICAgIHVpbnQgICAgYW1vdW50UzsKICAgICAgICB1aW50ICAgIGFtb3VudEI7CiAgICAgICAgdWludCAgICB0aW1lc3RhbXA7CiAgICAgICAgdWludCAgICB0dGw7CiAgICAgICAgdWludCAgICBzYWx0OwogICAgICAgIHVpbnQgICAgbHJjRmVlOwogICAgICAgIGJvb2wgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEI7CiAgICAgICAgdWludDggICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2U7CiAgICAgICAgdWludDggICB2OwogICAgICAgIGJ5dGVzMzIgcjsKICAgICAgICBieXRlczMyIHM7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBTdWJtaXQgYSBvcmRlci1yaW5nIGZvciB2YWxpZGF0aW9uIGFuZCBzZXR0bGVtZW50LgogICAgLy8vIEBwYXJhbSBhZGRyZXNzTGlzdCAgTGlzdCBvZiBlYWNoIG9yZGVyJ3Mgb3duZXIgYW5kIHRva2VuUy4gTm90ZSB0aGF0IG5leHQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG9yZGVyJ3MgYHRva2VuU2AgZXF1YWxzIHRoaXMgb3JkZXIncyBgdG9rZW5CYC4KICAgIC8vLyBAcGFyYW0gdWludEFyZ3NMaXN0IExpc3Qgb2YgdWludC10eXBlIGFyZ3VtZW50cyBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYW1vdW50UywgQW1vdW50QiwgcmF0ZUFtb3VudFMsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYW5kIGxyY0ZlZS4KICAgIC8vLyBAcGFyYW0gdWludDhBcmdzTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMaXN0IG9mIHVuaXQ4LXR5cGUgYXJndW1lbnRzLCBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlTGlzdCwgZmVlU2VsZWN0aW9uTGlzdC4KICAgIC8vLyBAcGFyYW0gdkxpc3QgICAgICAgIExpc3Qgb2YgdiBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdiB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJMaXN0ICAgICAgICBMaXN0IG9mIHIgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHIgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSBzTGlzdCAgICAgICAgTGlzdCBvZiBzIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gcmluZ21pbmVyICAgIFRoZSBhZGRyZXNzIHRoYXQgc2lnbmVkIHRoaXMgdHguCiAgICAvLy8gQHBhcmFtIGZlZVJlY2VwaWVudCBUaGUgcmVjZXBpZW50IGFkZHJlc3MgZm9yIGZlZSBjb2xsZWN0aW9uLiBJZiB0aGlzIGlzCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAnMHgwJywgYWxsIGZlZXMgd2lsbCBiZSBwYWlkIHRvIHRoZSBhZGRyZXNzIHdobyBoYWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHNpZ25lZCB0aGlzIHRyYW5zYWN0aW9uLCBub3QgYG1zZy5zZW5kZXJgLiBOb3RlZCBpZgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgTFJDIG5lZWQgdG8gYmUgcGFpZCBiYWNrIHRvIG9yZGVyIG93bmVyIGFzIHRoZSByZXN1bHQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG9mIGZlZSBzZWxlY3Rpb24gbW9kZWwsIExSQyB3aWxsIGFsc28gYmUgc2VudCBmcm9tCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGlzIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHRocm93SWZMUkNJc0luc3VmZmNpZW50IC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIElmIHRydWUsIHRocm93IGV4Y2VwdGlvbiBpZiBhbnkgb3JkZXIncyBzcGVuZGFibGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExSQyBhbW91bnQgaXMgc21hbGxlciB0aGFuIHJlcXVyaWVkOyBpZiBmYWxzZSwgcmluZy0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG1pbm9yIHdpbGwgZ2l2ZSB1cCBjb2xsZWN0aW9uIHRoZSBMUkMgZmVlLgogICAgZnVuY3Rpb24gc3VibWl0UmluZygKICAgICAgICBhZGRyZXNzWzJdW10gICAgYWRkcmVzc0xpc3QsCiAgICAgICAgdWludFs3XVtdICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgIHVpbnQ4W10gICAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHNMaXN0LAogICAgICAgIGFkZHJlc3MgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIGZlZVJlY2VwaWVudCwKICAgICAgICBib29sICAgICAgICAgICAgdGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQKICAgICAgICApIHB1YmxpYzsKCiAgICAvLy8gQGRldiBDYW5jZWwgYSBvcmRlci4gY2FuY2VsIGFtb3VudChhbW91bnRTIG9yIGFtb3VudEIpIGNhbiBiZSBzcGVjaWZpZWQKICAgIC8vLyAgICAgIGluIG9yZGVyVmFsdWVzLgogICAgLy8vIEBwYXJhbSBhZGRyZXNzZXMgICAgICAgICAgb3duZXIsIHRva2VuUywgdG9rZW5CCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzICAgICAgICBhbW91bnRTLCBhbW91bnRCLCB0aW1lc3RhbXAsIHR0bCwgc2FsdCwgbHJjRmVlLAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQW1vdW50UywgYW5kIGNhbmNlbEFtb3VudEIuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCIC0KICAgIC8vLyBAcGFyYW0gdiAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgICAgICAgICAgICAgICAgICBPcmRlciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoCiAgICAgICAgYWRkcmVzc1szXSBhZGRyZXNzZXMsCiAgICAgICAgdWludFs3XSAgICBvcmRlclZhbHVlcywKICAgICAgICBib29sICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgIHVpbnQ4ICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlLAogICAgICAgIHVpbnQ4ICAgICAgdiwKICAgICAgICBieXRlczMyICAgIHIsCiAgICAgICAgYnl0ZXMzMiAgICBzCiAgICAgICAgKSBwdWJsaWM7CgogICAgLy8vIEBkZXYgICBTZXQgYSBjdXRvZmYgdGltZXN0YW1wIHRvIGludmFsaWRhdGUgYWxsIG9yZGVycyB3aG9zZSB0aW1lc3RhbXAKICAgIC8vLyAgICAgICAgaXMgc21hbGxlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBuZXcgdmFsdWUgb2YgdGhlIGFkZHJlc3MncyBjdXRvZmYKICAgIC8vLyAgICAgICAgdGltZXN0YW1wLgogICAgLy8vIEBwYXJhbSBjdXRvZmYgVGhlIGN1dG9mZiB0aW1lc3RhbXAsIHdpbGwgZGVmYXVsdCB0byBgYmxvY2sudGltZXN0YW1wYAogICAgLy8vICAgICAgICBpZiBpdCBpcyAwLgogICAgZnVuY3Rpb24gc2V0Q3V0b2ZmKHVpbnQgY3V0b2ZmKSBwdWJsaWM7Cn0KCi8vLyBAdGl0bGUgTG9vcHJpbmcgVG9rZW4gRXhjaGFuZ2UgUHJvdG9jb2wgSW1wbGVtZW50YXRpb24gQ29udHJhY3QgdjEKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImM5YWRhOGE3YTBhY2E1ODlhNWE2YTZiOWJiYTBhN2FlZTdhNmJiYWUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiwKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJkY2I3YjNiMmJiYjBiNWJkYjJiYjljYjBiM2IzYWNhZWI1YjJiYmYyYjNhZWJiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgTG9vcHJpbmdQcm90b2NvbEltcGwgaXMgTG9vcHJpbmdQcm90b2NvbCB7CiAgICB1c2luZyBNYXRoICAgICAgZm9yIHVpbnQ7CiAgICB1c2luZyBTYWZlTWF0aCAgZm9yIHVpbnQ7CiAgICB1c2luZyBVaW50TGliICAgZm9yIHVpbnQ7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFZhcmlhYmxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGFkZHJlc3MgcHVibGljICBscmNUb2tlbkFkZHJlc3MgICAgICAgICAgICAgPSBhZGRyZXNzKDApOwogICAgYWRkcmVzcyBwdWJsaWMgIHRva2VuUmVnaXN0cnlBZGRyZXNzICAgICAgICA9IGFkZHJlc3MoMCk7CiAgICBhZGRyZXNzIHB1YmxpYyAgcmluZ2hhc2hSZWdpc3RyeUFkZHJlc3MgICAgID0gYWRkcmVzcygwKTsKICAgIGFkZHJlc3MgcHVibGljICBkZWxlZ2F0ZUFkZHJlc3MgICAgICAgICAgICAgPSBhZGRyZXNzKDApOwoKICAgIHVpbnQgICAgcHVibGljICBtYXhSaW5nU2l6ZSAgICAgICAgICAgICAgICAgPSAwOwogICAgdWludCAgICBwdWJsaWMgIHJpbmdJbmRleCAgICAgICAgICAgICAgICAgICA9IDA7CiAgICBib29sICAgIHByaXZhdGUgZW50ZXJlZCAgICAgICAgICAgICAgICAgICAgID0gZmFsc2U7CgogICAgLy8gRXhjaGFuZ2UgcmF0ZSAocmF0ZSkgaXMgdGhlIGFtb3VudCB0byBzZWxsIG9yIHNvbGQgZGl2aWRlZCBieSB0aGUgYW1vdW50CiAgICAvLyB0byBidXkgb3IgYm91Z2h0LgogICAgLy8KICAgIC8vIFJhdGUgcmF0aW8gaXMgdGhlIHJhdGlvIGJldHdlZW4gZXhlY3V0ZWQgcmF0ZSBhbmQgYW4gb3JkZXIncyBvcmlnaW5hbAogICAgLy8gcmF0ZS4KICAgIC8vCiAgICAvLyBUbyByZXF1aXJlIGFsbCBvcmRlcnMnIHJhdGUgcmF0aW9zIHRvIGhhdmUgY29lZmZpY2llbnQgb2Z2YXJpYXRpb24gKENWKQogICAgLy8gc21hbGxlciB0aGFuIDIuNSUsIGZvciBhbiBleGFtcGxlICwgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkIHNob3VsZCBiZToKICAgIC8vICAgICBgKDAuMDI1ICogUkFURV9SQVRJT19TQ0FMRSleMmAgb3IgNjI1MDAuCiAgICB1aW50ICAgIHB1YmxpYyAgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkICAgICAgID0gMDsKCiAgICB1aW50ICAgIHB1YmxpYyBjb25zdGFudCBSQVRFX1JBVElPX1NDQUxFICAgID0gMTAwMDA7CgogICAgLy8gVGhlIGZvbGxvd2luZyB0d28gbWFwcyBhcmUgdXNlZCB0byBrZWVwIHRyYWNlIG9mIG9yZGVyIGZpbGwgYW5kCiAgICAvLyBjYW5jZWxsYXRpb24gaGlzdG9yeS4KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcHVibGljIGZpbGxlZDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcHVibGljIGNhbmNlbGxlZDsKCiAgICAvLyBBIG1hcCBmcm9tIGFkZHJlc3MgdG8gaXRzIGN1dG9mZiB0aW1lc3RhbXAuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBjdXRvZmZzOwoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgc3RydWN0IFJhdGUgewogICAgICAgIHVpbnQgYW1vdW50UzsKICAgICAgICB1aW50IGFtb3VudEI7CiAgICB9CgogICAgLy8vIEBwYXJhbSBvcmRlciAgICAgICAgVGhlIG9yaWdpbmFsIG9yZGVyCiAgICAvLy8gQHBhcmFtIG9yZGVySGFzaCAgICBUaGUgb3JkZXIncyBoYXNoCiAgICAvLy8gQHBhcmFtIGZlZVNlbGVjdGlvbiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBBIG1pbmVyLXN1cHBsaWVkIHZhbHVlIGluZGljYXRpbmcgaWYgTFJDICh2YWx1ZSA9IDApCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvciBtYXJnaW4gc3BsaXQgaXMgY2hvb3NlbiBieSB0aGUgbWluZXIgKHZhbHVlID0gMSkuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBXZSBtYXkgc3VwcG9ydCBtb3JlIGZlZSBtb2RlbCBpbiB0aGUgZnV0dXJlLgogICAgLy8vIEBwYXJhbSByYXRlICAgICAgICAgRXhjaGFuZ2UgcmF0ZSBwcm92aWRlZCBieSBtaW5lci4KICAgIC8vLyBAcGFyYW0gYXZhaWxhYmxlQW1vdW50UyAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGUgYWN0dWFsIHNwZW5kYWJsZSBhbW91bnRTLgogICAgLy8vIEBwYXJhbSBmaWxsQW1vdW50UyAgQW1vdW50IG9mIHRva2VuUyB0byBzZWxsLCBjYWxjdWxhdGVkIGJ5IHByb3RvY29sLgogICAgLy8vIEBwYXJhbSBscmNSZXdhcmQgICAgVGhlIGFtb3VudCBvZiBMUkMgcGFpZCBieSBtaW5lciB0byBvcmRlciBvd25lciBpbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2UgZm9yIG1hcmdpbiBzcGxpdC4KICAgIC8vLyBAcGFyYW0gbHJjRmVlICAgICAgIFRoZSBhbW91bnQgb2YgTFIgcGFpZCBieSBvcmRlciBvd25lciB0byBtaW5lci4KICAgIC8vLyBAcGFyYW0gc3BsaXRTICAgICAgVG9rZW5TIHBhaWQgdG8gbWluZXIuCiAgICAvLy8gQHBhcmFtIHNwbGl0QiAgICAgIFRva2VuQiBwYWlkIHRvIG1pbmVyLgogICAgc3RydWN0IE9yZGVyU3RhdGUgewogICAgICAgIE9yZGVyICAgb3JkZXI7CiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2g7CiAgICAgICAgdWludDggICBmZWVTZWxlY3Rpb247CiAgICAgICAgUmF0ZSAgICByYXRlOwogICAgICAgIHVpbnQgICAgYXZhaWxhYmxlQW1vdW50UzsKICAgICAgICB1aW50ICAgIGZpbGxBbW91bnRTOwogICAgICAgIHVpbnQgICAgbHJjUmV3YXJkOwogICAgICAgIHVpbnQgICAgbHJjRmVlOwogICAgICAgIHVpbnQgICAgc3BsaXRTOwogICAgICAgIHVpbnQgICAgc3BsaXRCOwogICAgfQoKICAgIHN0cnVjdCBSaW5nIHsKICAgICAgICBieXRlczMyICAgICAgcmluZ2hhc2g7CiAgICAgICAgT3JkZXJTdGF0ZVtdIG9yZGVyczsKICAgICAgICBhZGRyZXNzICAgICAgbWluZXI7CiAgICAgICAgYWRkcmVzcyAgICAgIGZlZVJlY2VwaWVudDsKICAgICAgICBib29sICAgICAgICAgdGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQ7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBFdmVudHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBldmVudCBSaW5nTWluZWQoCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfcmluZ0luZGV4LAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3RpbWUsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYmxvY2tudW1iZXIsCiAgICAgICAgYnl0ZXMzMiAgICAgaW5kZXhlZCBfcmluZ2hhc2gsCiAgICAgICAgYWRkcmVzcyAgICAgaW5kZXhlZCBfbWluZXIsCiAgICAgICAgYWRkcmVzcyAgICAgaW5kZXhlZCBfZmVlUmVjZXBpZW50LAogICAgICAgIGJvb2wgICAgICAgICAgICAgICAgX3JpbmdoYXNoRm91bmQpOwoKICAgIGV2ZW50IE9yZGVyRmlsbGVkKAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3JpbmdJbmRleCwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF90aW1lLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Jsb2NrbnVtYmVyLAogICAgICAgIGJ5dGVzMzIgICAgIGluZGV4ZWQgX3JpbmdoYXNoLAogICAgICAgIGJ5dGVzMzIgICAgICAgICAgICAgX3ByZXZPcmRlckhhc2gsCiAgICAgICAgYnl0ZXMzMiAgICAgaW5kZXhlZCBfb3JkZXJIYXNoLAogICAgICAgIGJ5dGVzMzIgICAgICAgICAgICAgIF9uZXh0T3JkZXJIYXNoLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Ftb3VudFMsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYW1vdW50QiwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9scmNSZXdhcmQsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfbHJjRmVlKTsKCiAgICBldmVudCBPcmRlckNhbmNlbGxlZCgKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF90aW1lLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Jsb2NrbnVtYmVyLAogICAgICAgIGJ5dGVzMzIgICAgIGluZGV4ZWQgX29yZGVySGFzaCwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9hbW91bnRDYW5jZWxsZWQpOwoKICAgIGV2ZW50IEN1dG9mZlRpbWVzdGFtcENoYW5nZWQoCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfdGltZSwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9ibG9ja251bWJlciwKICAgICAgICBhZGRyZXNzICAgICBpbmRleGVkIF9hZGRyZXNzLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2N1dG9mZik7CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBDb25zdHJ1Y3RvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBMb29wcmluZ1Byb3RvY29sSW1wbCgKICAgICAgICBhZGRyZXNzIF9scmNUb2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfdG9rZW5SZWdpc3RyeUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcmluZ2hhc2hSZWdpc3RyeUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfZGVsZWdhdGVBZGRyZXNzLAogICAgICAgIHVpbnQgICAgX21heFJpbmdTaXplLAogICAgICAgIHVpbnQgICAgX3JhdGVSYXRpb0NWU1RocmVzaG9sZAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX2xyY1Rva2VuQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKDApICE9IF90b2tlblJlZ2lzdHJ5QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKDApICE9IF9kZWxlZ2F0ZUFkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKF9tYXhSaW5nU2l6ZSA+IDEpOwogICAgICAgIHJlcXVpcmUoX3JhdGVSYXRpb0NWU1RocmVzaG9sZCA+IDApOwoKICAgICAgICBscmNUb2tlbkFkZHJlc3MgPSBfbHJjVG9rZW5BZGRyZXNzOwogICAgICAgIHRva2VuUmVnaXN0cnlBZGRyZXNzID0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIHJpbmdoYXNoUmVnaXN0cnlBZGRyZXNzID0gX3JpbmdoYXNoUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIGRlbGVnYXRlQWRkcmVzcyA9IF9kZWxlZ2F0ZUFkZHJlc3M7CiAgICAgICAgbWF4UmluZ1NpemUgPSBfbWF4UmluZ1NpemU7CiAgICAgICAgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkID0gX3JhdGVSYXRpb0NWU1RocmVzaG9sZDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgRGlzYWJsZSBkZWZhdWx0IGZ1bmN0aW9uLgogICAgZnVuY3Rpb24gKCkKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgLy8vIEBkZXYgU3VibWl0IGEgb3JkZXItcmluZyBmb3IgdmFsaWRhdGlvbiBhbmQgc2V0dGxlbWVudC4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc0xpc3QgIExpc3Qgb2YgZWFjaCBvcmRlcidzIHRva2VuUy4gTm90ZSB0aGF0IG5leHQgb3JkZXIncwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYHRva2VuU2AgZXF1YWxzIHRoaXMgb3JkZXIncyBgdG9rZW5CYC4KICAgIC8vLyBAcGFyYW0gdWludEFyZ3NMaXN0IExpc3Qgb2YgdWludC10eXBlIGFyZ3VtZW50cyBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHJhdGVBbW91bnRTLgogICAgLy8vIEBwYXJhbSB1aW50OEFyZ3NMaXN0IC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExpc3Qgb2YgdW5pdDgtdHlwZSBhcmd1bWVudHMsIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2VMaXN0LGZlZVNlbGVjdGlvbkxpc3QuCiAgICAvLy8gQHBhcmFtIHZMaXN0ICAgICAgICBMaXN0IG9mIHYgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHYgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByTGlzdCAgICAgICAgTGlzdCBvZiByIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gc0xpc3QgICAgICAgIExpc3Qgb2YgcyBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcyB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJpbmdtaW5lciAgICBUaGUgYWRkcmVzcyB0aGF0IHNpZ25lZCB0aGlzIHR4LgogICAgLy8vIEBwYXJhbSBmZWVSZWNlcGllbnQgVGhlIHJlY2VwaWVudCBhZGRyZXNzIGZvciBmZWUgY29sbGVjdGlvbi4gSWYgdGhpcyBpcwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgJzB4MCcsIGFsbCBmZWVzIHdpbGwgYmUgcGFpZCB0byB0aGUgYWRkcmVzcyB3aG8gaGFkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzaWduZWQgdGhpcyB0cmFuc2FjdGlvbiwgbm90IGBtc2cuc2VuZGVyYC4gTm90ZWQgaWYKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExSQyBuZWVkIHRvIGJlIHBhaWQgYmFjayB0byBvcmRlciBvd25lciBhcyB0aGUgcmVzdWx0CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvZiBmZWUgc2VsZWN0aW9uIG1vZGVsLCBMUkMgd2lsbCBhbHNvIGJlIHNlbnQgZnJvbQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhpcyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBJZiB0cnVlLCB0aHJvdyBleGNlcHRpb24gaWYgYW55IG9yZGVyJ3Mgc3BlbmRhYmxlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMUkMgYW1vdW50IGlzIHNtYWxsZXIgdGhhbiByZXF1cmllZDsgaWYgZmFsc2UsIHJpbmctCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBtaW5vciB3aWxsIGdpdmUgdXAgY29sbGVjdGlvbiB0aGUgTFJDIGZlZS4KICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmcoCiAgICAgICAgYWRkcmVzc1syXVtdICAgIGFkZHJlc3NMaXN0LAogICAgICAgIHVpbnRbN11bXSAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgdWludDhbMl1bXSAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICB1aW50OFtdICAgICAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICBzTGlzdCwKICAgICAgICBhZGRyZXNzICAgICAgICAgcmluZ21pbmVyLAogICAgICAgIGFkZHJlc3MgICAgICAgICBmZWVSZWNlcGllbnQsCiAgICAgICAgYm9vbCAgICAgICAgICAgIHRocm93SWZMUkNJc0luc3VmZmNpZW50CiAgICAgICAgKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIEVycm9yTGliLmNoZWNrKCFlbnRlcmVkLCAiYXR0ZW1wdGVkIHRvIHJlLWVudCBzdWJtaXRSaW5nIGZ1bmN0aW9uIik7CiAgICAgICAgZW50ZXJlZCA9IHRydWU7CgogICAgICAgIC8vQ2hlY2sgcmluZyBzaXplCiAgICAgICAgdWludCByaW5nU2l6ZSA9IGFkZHJlc3NMaXN0Lmxlbmd0aDsKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgcmluZ1NpemUgPiAxICYmIHJpbmdTaXplIDw9IG1heFJpbmdTaXplLAogICAgICAgICAgICAiaW52YWxpZCByaW5nIHNpemUiCiAgICAgICAgKTsKCiAgICAgICAgdmVyaWZ5SW5wdXREYXRhSW50ZWdyaXR5KAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgYWRkcmVzc0xpc3QsCiAgICAgICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0CiAgICAgICAgKTsKCiAgICAgICAgdmVyaWZ5VG9rZW5zUmVnaXN0ZXJlZChhZGRyZXNzTGlzdCk7CgogICAgICAgIHZhciByaW5naGFzaFJlZ2lzdHJ5ID0gUmluZ2hhc2hSZWdpc3RyeShyaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyk7CgogICAgICAgIGJ5dGVzMzIgcmluZ2hhc2ggPSByaW5naGFzaFJlZ2lzdHJ5LmNhbGN1bGF0ZVJpbmdoYXNoKAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICByaW5naGFzaFJlZ2lzdHJ5LmNhblN1Ym1pdChyaW5naGFzaCwgZmVlUmVjZXBpZW50KSwKICAgICAgICAgICAgIlJpbmcgY2xhaW1lZCBieSBvdGhlcnMiCiAgICAgICAgKTsKCiAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICB2TGlzdFtyaW5nU2l6ZV0sCiAgICAgICAgICAgIHJMaXN0W3JpbmdTaXplXSwKICAgICAgICAgICAgc0xpc3RbcmluZ1NpemVdCiAgICAgICAgKTsKCiAgICAgICAgLy9Bc3NlbWJsZSBpbnB1dCBkYXRhIGludG8gYSBzdHJ1Y3Qgc28gd2UgY2FuIHBhc3MgaXQgdG8gZnVuY3Rpb25zLgogICAgICAgIHZhciBvcmRlcnMgPSBhc3NlbWJsZU9yZGVycygKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIGFkZHJlc3NMaXN0LAogICAgICAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CgogICAgICAgIGlmIChmZWVSZWNlcGllbnQgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBmZWVSZWNlcGllbnQgPSByaW5nbWluZXI7CiAgICAgICAgfQoKICAgICAgICBoYW5kbGVSaW5nKAogICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgb3JkZXJzLAogICAgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgICAgIGZlZVJlY2VwaWVudCwKICAgICAgICAgICAgdGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQKICAgICAgICApOwoKICAgICAgICBlbnRlcmVkID0gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VsIGEgb3JkZXIuIEFtb3VudCAoYW1vdW50UyBvciBhbW91bnRCKSB0byBjYW5jZWwgY2FuIGJlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpZWQgdXNpbmcgb3JkZXJWYWx1ZXMuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NlcyAgICAgICAgICBvd25lciwgdG9rZW5TLCB0b2tlbkIKICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgICAgICAgIGFtb3VudFMsIGFtb3VudEIsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgbHJjRmVlLCBhbmQgY2FuY2VsQW1vdW50CiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUsIHRoaXMgb3JkZXIgZG9lcyBub3QgYWNjZXB0IGJ1eWluZwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9yZSB0aGFuIGBhbW91bnRCYC4KICAgIC8vLyBAcGFyYW0gbWFyZ2luU3BsaXRQZXJjZW50YWdlIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBwZXJjZW50YWdlIG9mIG1hcmdpbiBwYWlkIHRvIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCgogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoCiAgICAgICAgYWRkcmVzc1szXSBhZGRyZXNzZXMsCiAgICAgICAgdWludFs3XSAgICBvcmRlclZhbHVlcywKICAgICAgICBib29sICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgIHVpbnQ4ICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlLAogICAgICAgIHVpbnQ4ICAgICAgdiwKICAgICAgICBieXRlczMyICAgIHIsCiAgICAgICAgYnl0ZXMzMiAgICBzCiAgICAgICAgKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHVpbnQgY2FuY2VsQW1vdW50ID0gb3JkZXJWYWx1ZXNbNl07CiAgICAgICAgRXJyb3JMaWIuY2hlY2soY2FuY2VsQW1vdW50ID4gMCwgImFtb3VudCB0byBjYW5jZWwgaXMgemVybyIpOwoKICAgICAgICB2YXIgb3JkZXIgPSBPcmRlcigKICAgICAgICAgICAgYWRkcmVzc2VzWzBdLAogICAgICAgICAgICBhZGRyZXNzZXNbMV0sCiAgICAgICAgICAgIGFkZHJlc3Nlc1syXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbMF0sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzFdLAogICAgICAgICAgICBvcmRlclZhbHVlc1syXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbM10sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzRdLAogICAgICAgICAgICBvcmRlclZhbHVlc1s1XSwKICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgICAgIG1hcmdpblNwbGl0UGVyY2VudGFnZSwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKG1zZy5zZW5kZXIgPT0gb3JkZXIub3duZXIsICJjYW5jZWxPcmRlciBub3Qgc3VibWl0dGVkIGJ5IG9yZGVyIG93bmVyIik7CgogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoID0gY2FsY3VsYXRlT3JkZXJIYXNoKG9yZGVyKTsKCiAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICBvcmRlci5vd25lciwKICAgICAgICAgICAgb3JkZXJIYXNoLAogICAgICAgICAgICBvcmRlci52LAogICAgICAgICAgICBvcmRlci5yLAogICAgICAgICAgICBvcmRlci5zCiAgICAgICAgKTsKCiAgICAgICAgY2FuY2VsbGVkW29yZGVySGFzaF0gPSBjYW5jZWxsZWRbb3JkZXJIYXNoXS5hZGQoY2FuY2VsQW1vdW50KTsKCiAgICAgICAgT3JkZXJDYW5jZWxsZWQoCiAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCwKICAgICAgICAgICAgYmxvY2subnVtYmVyLAogICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgIGNhbmNlbEFtb3VudAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgICBTZXQgYSBjdXRvZmYgdGltZXN0YW1wIHRvIGludmFsaWRhdGUgYWxsIG9yZGVycyB3aG9zZSB0aW1lc3RhbXAKICAgIC8vLyAgICAgICAgaXMgc21hbGxlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBuZXcgdmFsdWUgb2YgdGhlIGFkZHJlc3MncyBjdXRvZmYKICAgIC8vLyAgICAgICAgdGltZXN0YW1wLgogICAgLy8vIEBwYXJhbSBjdXRvZmYgVGhlIGN1dG9mZiB0aW1lc3RhbXAsIHdpbGwgZGVmYXVsdCB0byBgYmxvY2sudGltZXN0YW1wYAogICAgLy8vICAgICAgICBpZiBpdCBpcyAwLgogICAgZnVuY3Rpb24gc2V0Q3V0b2ZmKHVpbnQgY3V0b2ZmKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHVpbnQgdCA9IGN1dG9mZjsKICAgICAgICBpZiAodCA9PSAwKSB7CiAgICAgICAgICAgIHQgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgfQoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgY3V0b2Zmc1ttc2cuc2VuZGVyXSA8IHQsCiAgICAgICAgICAgICJhdHRlbXB0ZWQgdG8gc2V0IGN1dG9mZiB0byBhIHNtYWxsZXIgdmFsdWUiCiAgICAgICAgKTsKCiAgICAgICAgY3V0b2Zmc1ttc2cuc2VuZGVyXSA9IHQ7CgogICAgICAgIEN1dG9mZlRpbWVzdGFtcENoYW5nZWQoCiAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCwKICAgICAgICAgICAgYmxvY2subnVtYmVyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICB0CiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gSW50ZXJuYWwgJiBQcml2YXRlIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgVmFsaWRhdGUgYSByaW5nLgogICAgZnVuY3Rpb24gdmVyaWZ5UmluZ0hhc05vU3ViUmluZyhSaW5nIHJpbmcpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgewogICAgICAgIHVpbnQgcmluZ1NpemUgPSByaW5nLm9yZGVycy5sZW5ndGg7CiAgICAgICAgLy8gQ2hlY2sgdGhlIHJpbmcgaGFzIG5vIHN1Yi1yaW5nLgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgdG9rZW5TID0gcmluZy5vcmRlcnNbaV0ub3JkZXIudG9rZW5TOwogICAgICAgICAgICBmb3IgKHVpbnQgaiA9IGkgKyAxOyBqIDwgcmluZ1NpemU7IGorKykgewogICAgICAgICAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgICAgICAgICAgdG9rZW5TICE9IHJpbmcub3JkZXJzW2pdLm9yZGVyLnRva2VuUywKICAgICAgICAgICAgICAgICAgICAiZm91bmQgc3ViLXJpbmciCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHZlcmlmeVRva2Vuc1JlZ2lzdGVyZWQoYWRkcmVzc1syXVtdIGFkZHJlc3NMaXN0KQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgIHsKICAgICAgICB2YXIgcmVnaXN0cnlDb250cmFjdCA9IFRva2VuUmVnaXN0cnkodG9rZW5SZWdpc3RyeUFkZHJlc3MpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFkZHJlc3NMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICAgICAgcmVnaXN0cnlDb250cmFjdC5pc1Rva2VuUmVnaXN0ZXJlZChhZGRyZXNzTGlzdFtpXVsxXSksCiAgICAgICAgICAgICAgICAidG9rZW4gbm90IHJlZ2lzdGVyZWQiCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZVJpbmcoCiAgICAgICAgYnl0ZXMzMiByaW5naGFzaCwKICAgICAgICBPcmRlclN0YXRlW10gb3JkZXJzLAogICAgICAgIGFkZHJlc3MgbWluZXIsCiAgICAgICAgYWRkcmVzcyBmZWVSZWNlcGllbnQsCiAgICAgICAgYm9vbCB0aHJvd0lmTFJDSXNJbnN1ZmZjaWVudAogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHZhciByaW5nID0gUmluZygKICAgICAgICAgICAgcmluZ2hhc2gsCiAgICAgICAgICAgIG9yZGVycywKICAgICAgICAgICAgbWluZXIsCiAgICAgICAgICAgIGZlZVJlY2VwaWVudCwKICAgICAgICAgICAgdGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQKICAgICAgICApOwoKICAgICAgICAvLyBEbyB0aGUgaGFyZCB3b3JrLgogICAgICAgIHZlcmlmeVJpbmdIYXNOb1N1YlJpbmcocmluZyk7CgogICAgICAgIC8vIEV4Y2hhbmdlIHJhdGVzIGNhbGN1bGF0aW9uIGFyZSBwZXJmb3JtZWQgYnkgcmluZy1taW5lcnMgYXMgc29saWRpdHkKICAgICAgICAvLyBjYW5ub3QgZ2V0IHBvd2VyLW9mLTEvbiBvcGVyYXRpb24sIHRoZXJlZm9yZSB3ZSBoYXZlIHRvIHZlcmlmeQogICAgICAgIC8vIHRoZXNlIHJhdGVzIGFyZSBjb3JyZWN0LgogICAgICAgIHZlcmlmeU1pbmVyU3VwcGxpZWRGaWxsUmF0ZXMocmluZyk7CgogICAgICAgIC8vIFNjYWxlIGRvd24gZWFjaCBvcmRlciBpbmRlcGVuZGVudGx5IGJ5IHN1YnN0cmFjdGluZyBhbW91bnQtZmlsbGVkIGFuZAogICAgICAgIC8vIGFtb3VudC1jYW5jZWxsZWQuIE9yZGVyIG93bmVyJ3MgY3VycmVudCBiYWxhbmNlIGFuZCBhbGxvd2FuY2UgYXJlCiAgICAgICAgLy8gbm90IHRha2VuIGludG8gY29uc2lkZXJhdGlvbiBpbiB0aGVzZSBvcGVyYXRpb25zLgogICAgICAgIHNjYWxlUmluZ0Jhc2VkT25IaXN0b3JpY2FsUmVjb3JkcyhyaW5nKTsKCiAgICAgICAgLy8gQmFzZWQgb24gdGhlIGFscmVhZHkgdmVyaWZpZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlZCBieSByaW5nLW1pbmVycywKICAgICAgICAvLyB3ZSBjYW4gZnVydGh1ciBzY2FsZSBkb3duIG9yZGVycyBiYXNlZCBvbiB0b2tlbiBiYWxhbmNlIGFuZCBhbGxvd2FuY2UsCiAgICAgICAgLy8gdGhlbiBmaW5kIHRoZSBzbWFsbGVzdCBvcmRlciBvZiB0aGUgcmluZywgdGhlbiBjYWxjdWxhdGUgZWFjaCBvcmRlcidzCiAgICAgICAgLy8gYGZpbGxBbW91bnRTYC4KICAgICAgICBjYWxjdWxhdGVSaW5nRmlsbEFtb3VudChyaW5nKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGVhY2ggb3JkZXIncyBgbHJjRmVlYCBhbmQgYGxyY1Jld3JhcmRgIGFuZCBzcGxpY3QgaG93IG11Y2gKICAgICAgICAvLyBvZiBgZmlsbEFtb3VudFNgIHNoYWxsIGJlIHBhaWQgdG8gbWF0Y2hpbmcgb3JkZXIgb3IgbWluZXIgYXMgbWFyZ2luCiAgICAgICAgLy8gc3BsaXQuCiAgICAgICAgY2FsY3VsYXRlUmluZ0ZlZXMocmluZyk7CgogICAgICAgIC8vLyBNYWtlIHBheW1lbnRzLgogICAgICAgIHNldHRsZVJpbmcocmluZyk7CgogICAgICAgIFJpbmdNaW5lZCgKICAgICAgICAgICAgcmluZ0luZGV4KyssCiAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCwKICAgICAgICAgICAgYmxvY2subnVtYmVyLAogICAgICAgICAgICByaW5nLnJpbmdoYXNoLAogICAgICAgICAgICByaW5nLm1pbmVyLAogICAgICAgICAgICByaW5nLmZlZVJlY2VwaWVudCwKICAgICAgICAgICAgUmluZ2hhc2hSZWdpc3RyeShyaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcykucmluZ2hhc2hGb3VuZChyaW5nLnJpbmdoYXNoKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0dGxlUmluZyhSaW5nIHJpbmcpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICB1aW50IHJpbmdTaXplID0gcmluZy5vcmRlcnMubGVuZ3RoOwogICAgICAgIHZhciBkZWxlZ2F0ZSA9IFRva2VuVHJhbnNmZXJEZWxlZ2F0ZShkZWxlZ2F0ZUFkZHJlc3MpOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHJpbmcub3JkZXJzW2ldOwogICAgICAgICAgICB2YXIgcHJldiA9IHJpbmcub3JkZXJzW2kucHJldihyaW5nU2l6ZSldOwogICAgICAgICAgICB2YXIgbmV4dCA9IHJpbmcub3JkZXJzW2kubmV4dChyaW5nU2l6ZSldOwoKICAgICAgICAgICAgLy8gUGF5IHRva2VuUyB0byBwcmV2aW91cyBvcmRlciwgb3IgdG8gbWluZXIgYXMgcHJldmlvdXMgb3JkZXIncwogICAgICAgICAgICAvLyBtYXJnaW4gc3BsaXQgb3IvYW5kIHRoaXMgb3JkZXIncyBtYXJnaW4gc3BsaXQuCgogICAgICAgICAgICBkZWxlZ2F0ZS50cmFuc2ZlclRva2VuKAogICAgICAgICAgICAgICAgc3RhdGUub3JkZXIudG9rZW5TLAogICAgICAgICAgICAgICAgc3RhdGUub3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICBwcmV2Lm9yZGVyLm93bmVyLAogICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMgLSBwcmV2LnNwbGl0QgogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKHByZXYuc3BsaXRCICsgc3RhdGUuc3BsaXRTID4gMCkgewogICAgICAgICAgICAgICAgZGVsZWdhdGUudHJhbnNmZXJUb2tlbigKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci50b2tlblMsCiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICAgICAgcmluZy5mZWVSZWNlcGllbnQsCiAgICAgICAgICAgICAgICAgICAgcHJldi5zcGxpdEIgKyBzdGF0ZS5zcGxpdFMKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFBheSBMUkMKICAgICAgICAgICAgaWYgKHN0YXRlLmxyY1Jld2FyZCA+IDApIHsKICAgICAgICAgICAgICAgIGRlbGVnYXRlLnRyYW5zZmVyVG9rZW4oCiAgICAgICAgICAgICAgICAgICAgbHJjVG9rZW5BZGRyZXNzLAogICAgICAgICAgICAgICAgICAgIHJpbmcuZmVlUmVjZXBpZW50LAogICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm93bmVyLAogICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY1Jld2FyZAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0YXRlLmxyY0ZlZSA+IDApIHsKICAgICAgICAgICAgICAgIGRlbGVnYXRlLnRyYW5zZmVyVG9rZW4oCiAgICAgICAgICAgICAgICAgICAgbHJjVG9rZW5BZGRyZXNzLAogICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm93bmVyLAogICAgICAgICAgICAgICAgICAgIHJpbmcuZmVlUmVjZXBpZW50LAogICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY0ZlZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXBkYXRlIGZpbGwgcmVjb3JkcwogICAgICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgIGZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdICs9IG5leHQuZmlsbEFtb3VudFM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmaWxsZWRbc3RhdGUub3JkZXJIYXNoXSArPSBzdGF0ZS5maWxsQW1vdW50UzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgT3JkZXJGaWxsZWQoCiAgICAgICAgICAgICAgICByaW5nSW5kZXgsCiAgICAgICAgICAgICAgICBibG9jay50aW1lc3RhbXAsCiAgICAgICAgICAgICAgICBibG9jay5udW1iZXIsCiAgICAgICAgICAgICAgICByaW5nLnJpbmdoYXNoLAogICAgICAgICAgICAgICAgcHJldi5vcmRlckhhc2gsCiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlckhhc2gsCiAgICAgICAgICAgICAgICBuZXh0Lm9yZGVySGFzaCwKICAgICAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTICsgc3RhdGUuc3BsaXRTLAogICAgICAgICAgICAgICAgbmV4dC5maWxsQW1vdW50UyAtIHN0YXRlLnNwbGl0QiwKICAgICAgICAgICAgICAgIHN0YXRlLmxyY1Jld2FyZCwKICAgICAgICAgICAgICAgIHN0YXRlLmxyY0ZlZQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICB9CgogICAgZnVuY3Rpb24gdmVyaWZ5TWluZXJTdXBwbGllZEZpbGxSYXRlcyhSaW5nIHJpbmcpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgewogICAgICAgIHZhciBvcmRlcnMgPSByaW5nLm9yZGVyczsKICAgICAgICB1aW50IHJpbmdTaXplID0gb3JkZXJzLmxlbmd0aDsKICAgICAgICB1aW50W10gbWVtb3J5IHJhdGVSYXRpb3MgPSBuZXcgdWludFtdKHJpbmdTaXplKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB1aW50IHMxYjAgPSBvcmRlcnNbaV0ucmF0ZS5hbW91bnRTLm11bChvcmRlcnNbaV0ub3JkZXIuYW1vdW50Qik7CiAgICAgICAgICAgIHVpbnQgczBiMSA9IG9yZGVyc1tpXS5vcmRlci5hbW91bnRTLm11bChvcmRlcnNbaV0ucmF0ZS5hbW91bnRCKTsKCiAgICAgICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICAgICAgczFiMCA8PSBzMGIxLAogICAgICAgICAgICAgICAgIm1pbmVyIHN1cHBsaWVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXMgaW52YWxpZCBkaXNjb3VudCIKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJhdGVSYXRpb3NbaV0gPSBSQVRFX1JBVElPX1NDQUxFLm11bChzMWIwKS5kaXYoczBiMSk7CiAgICAgICAgfQoKICAgICAgICB1aW50IGN2cyA9IFVpbnRMaWIuY3ZzcXVhcmUocmF0ZVJhdGlvcywgUkFURV9SQVRJT19TQ0FMRSk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICBjdnMgPD0gcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkLAogICAgICAgICAgICAibWluZXIgc3VwcGxpZWQgZXhjaGFuZ2UgcmF0ZSBpcyBub3QgZXZlbmx5IGRpc2NvdW50ZWQiCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSaW5nRmVlcyhSaW5nIHJpbmcpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgewogICAgICAgIHVpbnQgbWluZXJMcmNTcGVuZGFibGUgPSBnZXRMUkNTcGVuZGFibGUocmluZy5mZWVSZWNlcGllbnQpOwogICAgICAgIHVpbnQgcmluZ1NpemUgPSByaW5nLm9yZGVycy5sZW5ndGg7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gcmluZy5vcmRlcnNbaV07CiAgICAgICAgICAgIHZhciBuZXh0ID0gcmluZy5vcmRlcnNbaS5uZXh0KHJpbmdTaXplKV07CgogICAgICAgICAgICBpZiAoc3RhdGUuZmVlU2VsZWN0aW9uID09IEZFRV9TRUxFQ1RfTFJDKSB7CgogICAgICAgICAgICAgICAgdWludCBscmNTcGVuZGFibGUgPSBnZXRMUkNTcGVuZGFibGUoc3RhdGUub3JkZXIub3duZXIpOwoKICAgICAgICAgICAgICAgIGlmIChscmNTcGVuZGFibGUgPCBzdGF0ZS5scmNGZWUpIHsKICAgICAgICAgICAgICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgICAgICAgICAgICAgIXJpbmcudGhyb3dJZkxSQ0lzSW5zdWZmY2llbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICJvcmRlciBMUkMgYmFsYW5jZSBpbnN1ZmZjaWVudCIKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5scmNGZWUgPSBscmNTcGVuZGFibGU7CiAgICAgICAgICAgICAgICAgICAgbWluZXJMcmNTcGVuZGFibGUgKz0gbHJjU3BlbmRhYmxlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5mZWVTZWxlY3Rpb24gPT0gRkVFX1NFTEVDVF9NQVJHSU5fU1BMSVQpIHsKICAgICAgICAgICAgICAgIGlmIChtaW5lckxyY1NwZW5kYWJsZSA+PSBzdGF0ZS5scmNGZWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBzcGxpdFMgPSBuZXh0LmZpbGxBbW91bnRTLm11bCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLmFtb3VudFMKICAgICAgICAgICAgICAgICAgICAgICAgKS5kaXYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5hbW91bnRCCiAgICAgICAgICAgICAgICAgICAgICAgICkuc3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnNwbGl0UyA9IHNwbGl0Uy5tdWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKS5kaXYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBzcGxpdEIgPSBuZXh0LmZpbGxBbW91bnRTLnN1YihzdGF0ZS5maWxsQW1vdW50UwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm11bChzdGF0ZS5vcmRlci5hbW91bnRCKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdihzdGF0ZS5vcmRlci5hbW91bnRTKQogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3BsaXRCID0gc3BsaXRCLm11bCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZQogICAgICAgICAgICAgICAgICAgICAgICApLmRpdigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1BUkdJTl9TUExJVF9QRVJDRU5UQUdFX0JBU0UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaW1wbGljaXRzIG9yZGVyIHdpdGggc21hbGxlciBpbmRleCBpbiB0aGUgcmluZyB3aWxsCiAgICAgICAgICAgICAgICAgICAgLy8gYmUgcGFpZCBMUkMgcmV3YXJkIGZpcnN0LCBzbyB0aGUgb3JkZXJzIGluIHRoZSByaW5nIGRvZXMKICAgICAgICAgICAgICAgICAgICAvLyBtYXRlci4KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc3BsaXRTID4gMCB8fCBzdGF0ZS5zcGxpdEIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmVyTHJjU3BlbmRhYmxlID0gbWluZXJMcmNTcGVuZGFibGUuc3ViKHN0YXRlLmxyY0ZlZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY1Jld2FyZCA9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIEVycm9yTGliLmVycm9yKCJ1bnN1cHBvcnRlZCBmZWUgc2VsZWN0aW9uIHZhbHVlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdGaWxsQW1vdW50KFJpbmcgcmluZykKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICB7CiAgICAgICAgdWludCByaW5nU2l6ZSA9IHJpbmcub3JkZXJzLmxlbmd0aDsKICAgICAgICB1aW50IHNtYWxsZXN0SWR4ID0gMDsKICAgICAgICB1aW50IGk7CiAgICAgICAgdWludCBqOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICBqID0gaS5uZXh0KHJpbmdTaXplKTsKCiAgICAgICAgICAgIHVpbnQgcmVzID0gY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgICAgICAgICAgcmluZy5vcmRlcnNbaV0sCiAgICAgICAgICAgICAgICByaW5nLm9yZGVyc1tqXQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKHJlcyA9PSAxKSB7CiAgICAgICAgICAgICAgICBzbWFsbGVzdElkeCA9IGk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzID09IDIpIHsKICAgICAgICAgICAgICAgIHNtYWxsZXN0SWR4ID0gajsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNtYWxsZXN0SWR4OyBpKyspIHsKICAgICAgICAgICAgaiA9IGkubmV4dChyaW5nU2l6ZSk7CiAgICAgICAgICAgIGNhbGN1bGF0ZU9yZGVyRmlsbEFtb3VudCgKICAgICAgICAgICAgICAgIHJpbmcub3JkZXJzW2ldLAogICAgICAgICAgICAgICAgcmluZy5vcmRlcnNbal0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEByZXR1cm4gMCBpZiBuZWl0aGVyIG9yZGVyIGlzIHRoZSBzbWFsbGVzdCBvbmU7CiAgICAvLy8gICAgICAgICAxIGlmICdzdGF0ZScgaXMgdGhlIHNtYWxsZXN0IG9yZGVyOwogICAgLy8vICAgICAgICAgMiBpZiAnbmV4dCcgaXMgdGhlIHNtYWxsZXN0IG9yZGVyLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgIE9yZGVyU3RhdGUgc3RhdGUsCiAgICAgICAgT3JkZXJTdGF0ZSBuZXh0CiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IHdoaWNoSXNTbWFsbGVyKQogICAgewogICAgICAgIHVpbnQgZmlsbEFtb3VudEIgPSBzdGF0ZS5maWxsQW1vdW50Uy5tdWwoCiAgICAgICAgICAgIHN0YXRlLnJhdGUuYW1vdW50QgogICAgICAgICkuZGl2KAogICAgICAgICAgICBzdGF0ZS5yYXRlLmFtb3VudFMKICAgICAgICApOwoKICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgaWYgKGZpbGxBbW91bnRCID4gc3RhdGUub3JkZXIuYW1vdW50QikgewogICAgICAgICAgICAgICAgZmlsbEFtb3VudEIgPSBzdGF0ZS5vcmRlci5hbW91bnRCOwoKICAgICAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTID0gZmlsbEFtb3VudEIubXVsKAogICAgICAgICAgICAgICAgICAgIHN0YXRlLnJhdGUuYW1vdW50UwogICAgICAgICAgICAgICAgKS5kaXYoCiAgICAgICAgICAgICAgICAgICAgc3RhdGUucmF0ZS5hbW91bnRCCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIHdoaWNoSXNTbWFsbGVyID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3RhdGUubHJjRmVlID0gc3RhdGUub3JkZXIubHJjRmVlLm11bCgKICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMKICAgICAgICApLmRpdigKICAgICAgICAgICAgc3RhdGUub3JkZXIuYW1vdW50UwogICAgICAgICk7CgogICAgICAgIGlmIChmaWxsQW1vdW50QiA8PSBuZXh0LmZpbGxBbW91bnRTKSB7CiAgICAgICAgICAgIG5leHQuZmlsbEFtb3VudFMgPSBmaWxsQW1vdW50QjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3aGljaElzU21hbGxlciA9IDI7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFNjYWxlIGRvd24gYWxsIG9yZGVycyBiYXNlZCBvbiBoaXN0b3JpY2FsIGZpbGwgb3IgY2FuY2VsbGF0aW9uCiAgICAvLy8gICAgICBzdGF0cyBidXQga2V5IHRoZSBvcmRlcidzIG9yaWdpbmFsIGV4Y2hhbmdlIHJhdGUuCiAgICBmdW5jdGlvbiBzY2FsZVJpbmdCYXNlZE9uSGlzdG9yaWNhbFJlY29yZHMoUmluZyByaW5nKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgIHsKICAgICAgICB1aW50IHJpbmdTaXplID0gcmluZy5vcmRlcnMubGVuZ3RoOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHJpbmcub3JkZXJzW2ldOwogICAgICAgICAgICB2YXIgb3JkZXIgPSBzdGF0ZS5vcmRlcjsKCiAgICAgICAgICAgIGlmIChvcmRlci5idXlOb01vcmVUaGFuQW1vdW50QikgewogICAgICAgICAgICAgICAgdWludCBhbW91bnRCID0gb3JkZXIuYW1vdW50Qi5zdWIoCiAgICAgICAgICAgICAgICAgICAgZmlsbGVkW3N0YXRlLm9yZGVySGFzaF0KICAgICAgICAgICAgICAgICkudG9sZXJhbnRTdWIoCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkW3N0YXRlLm9yZGVySGFzaF0KICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA9IGFtb3VudEIubXVsKG9yZGVyLmFtb3VudFMpLmRpdihvcmRlci5hbW91bnRCKTsKICAgICAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSA9IGFtb3VudEIubXVsKG9yZGVyLmxyY0ZlZSkuZGl2KG9yZGVyLmFtb3VudEIpOwoKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudEIgPSBhbW91bnRCOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdWludCBhbW91bnRTID0gb3JkZXIuYW1vdW50Uy5zdWIoCiAgICAgICAgICAgICAgICAgICAgZmlsbGVkW3N0YXRlLm9yZGVySGFzaF0KICAgICAgICAgICAgICAgICkudG9sZXJhbnRTdWIoCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkW3N0YXRlLm9yZGVySGFzaF0KICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50QiA9IGFtb3VudFMubXVsKG9yZGVyLmFtb3VudEIpLmRpdihvcmRlci5hbW91bnRTKTsKICAgICAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSA9IGFtb3VudFMubXVsKG9yZGVyLmxyY0ZlZSkuZGl2KG9yZGVyLmFtb3VudFMpOwoKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgPSBhbW91bnRTOwogICAgICAgICAgICB9CgogICAgICAgICAgICBFcnJvckxpYi5jaGVjayhvcmRlci5hbW91bnRTID4gMCwgImFtb3VudFMgaXMgemVybyIpOwogICAgICAgICAgICBFcnJvckxpYi5jaGVjayhvcmRlci5hbW91bnRCID4gMCwgImFtb3VudEIgaXMgemVybyIpOwoKICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMgPSBvcmRlci5hbW91bnRTLm1pbjI1NihzdGF0ZS5hdmFpbGFibGVBbW91bnRTKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIEVSQzIwIHRva2VuIHRoYXQgY2FuIGJlIHNwZW50IGJ5IHRoaXMgY29udHJhY3QuCiAgICBmdW5jdGlvbiBnZXRTcGVuZGFibGUoCiAgICAgICAgYWRkcmVzcyB0b2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyB0b2tlbk93bmVyCiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBUb2tlblRyYW5zZmVyRGVsZWdhdGUoCiAgICAgICAgICAgIGRlbGVnYXRlQWRkcmVzcwogICAgICAgICkuZ2V0U3BlbmRhYmxlKAogICAgICAgICAgICB0b2tlbkFkZHJlc3MsCiAgICAgICAgICAgIHRva2VuT3duZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiBMUkMgdG9rZW4gdGhhdCBjYW4gYmUgc3BlbnQgYnkgdGhpcyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGdldExSQ1NwZW5kYWJsZShhZGRyZXNzIHRva2VuT3duZXIpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIGdldFNwZW5kYWJsZShscmNUb2tlbkFkZHJlc3MsIHRva2VuT3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IHZlcmlmeSBpbnB1dCBkYXRhJ3MgYmFzaWMgaW50ZWdyaXR5LgogICAgZnVuY3Rpb24gdmVyaWZ5SW5wdXREYXRhSW50ZWdyaXR5KAogICAgICAgIHVpbnQgcmluZ1NpemUsCiAgICAgICAgYWRkcmVzc1syXVtdICAgIGFkZHJlc3NMaXN0LAogICAgICAgIHVpbnRbN11bXSAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgdWludDhbMl1bXSAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICB1aW50OFtdICAgICAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICBzTGlzdAogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICB7CiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIHJpbmdTaXplID09IGFkZHJlc3NMaXN0Lmxlbmd0aCwKICAgICAgICAgICAgInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSBhZGRyZXNzTGlzdCIKICAgICAgICApOwoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgcmluZ1NpemUgPT0gdWludEFyZ3NMaXN0Lmxlbmd0aCwKICAgICAgICAgICAgInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSB1aW50QXJnc0xpc3QiCiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIHJpbmdTaXplID09IHVpbnQ4QXJnc0xpc3QubGVuZ3RoLAogICAgICAgICAgICAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHVpbnQ4QXJnc0xpc3QiCiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIHJpbmdTaXplID09IGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdC5sZW5ndGgsCiAgICAgICAgICAgICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0IgogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICByaW5nU2l6ZSArIDEgPT0gdkxpc3QubGVuZ3RoLAogICAgICAgICAgICAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHZMaXN0IgogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICByaW5nU2l6ZSArIDEgPT0gckxpc3QubGVuZ3RoLAogICAgICAgICAgICAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHJMaXN0IgogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICByaW5nU2l6ZSArIDEgPT0gc0xpc3QubGVuZ3RoLAogICAgICAgICAgICAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHNMaXN0IgogICAgICAgICk7CgogICAgICAgIC8vIFZhbGlkYXRlIHJpbmctbWluaW5nIHJlbGF0ZWQgYXJndW1lbnRzLgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bNl0gPiAwLAogICAgICAgICAgICAgICAgIm9yZGVyIHJhdGVBbW91bnRTIGlzIHplcm8iCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3RbaV1bMV0gPD0gRkVFX1NFTEVDVF9NQVhfVkFMVUUsCiAgICAgICAgICAgICAgICAiaW52YWxpZCBvcmRlciBmZWUgc2VsZWN0aW9uIgogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiAgICAgICAgYXNzbWJsZSBvcmRlciBwYXJhbWV0ZXJzIGludG8gT3JkZXIgc3RydWN0LgogICAgLy8vIEByZXR1cm4gICAgIEEgbGlzdCBvZiBvcmRlcnMuCiAgICBmdW5jdGlvbiBhc3NlbWJsZU9yZGVycygKICAgICAgICB1aW50ICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgYWRkcmVzc1syXVtdICAgIGFkZHJlc3NMaXN0LAogICAgICAgIHVpbnRbN11bXSAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgdWludDhbMl1bXSAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICB1aW50OFtdICAgICAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICBzTGlzdAogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoT3JkZXJTdGF0ZVtdKQogICAgewogICAgICAgIHZhciBvcmRlcnMgPSBuZXcgT3JkZXJTdGF0ZVtdKHJpbmdTaXplKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB1aW50IGogPSBpLm5leHQocmluZ1NpemUpOwoKICAgICAgICAgICAgdmFyIG9yZGVyID0gT3JkZXIoCiAgICAgICAgICAgICAgICBhZGRyZXNzTGlzdFtpXVswXSwKICAgICAgICAgICAgICAgIGFkZHJlc3NMaXN0W2ldWzFdLAogICAgICAgICAgICAgICAgYWRkcmVzc0xpc3Rbal1bMV0sCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bMF0sCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bMV0sCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bMl0sCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bM10sCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bNF0sCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bNV0sCiAgICAgICAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3RbaV0sCiAgICAgICAgICAgICAgICB1aW50OEFyZ3NMaXN0W2ldWzBdLAogICAgICAgICAgICAgICAgdkxpc3RbaV0sCiAgICAgICAgICAgICAgICByTGlzdFtpXSwKICAgICAgICAgICAgICAgIHNMaXN0W2ldCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBieXRlczMyIG9yZGVySGFzaCA9IGNhbGN1bGF0ZU9yZGVySGFzaChvcmRlcik7CgogICAgICAgICAgICB2ZXJpZnlTaWduYXR1cmUoCiAgICAgICAgICAgICAgICBvcmRlci5vd25lciwKICAgICAgICAgICAgICAgIG9yZGVySGFzaCwKICAgICAgICAgICAgICAgIG9yZGVyLnYsCiAgICAgICAgICAgICAgICBvcmRlci5yLAogICAgICAgICAgICAgICAgb3JkZXIucwogICAgICAgICAgICApOwoKICAgICAgICAgICAgdmFsaWRhdGVPcmRlcihvcmRlcik7CgogICAgICAgICAgICBvcmRlcnNbaV0gPSBPcmRlclN0YXRlKAogICAgICAgICAgICAgICAgb3JkZXIsCiAgICAgICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgICAgICB1aW50OEFyZ3NMaXN0W2ldWzFdLCAgLy8gZmVlU2VsZWN0aW9uCiAgICAgICAgICAgICAgICBSYXRlKHVpbnRBcmdzTGlzdFtpXVs2XSwgb3JkZXIuYW1vdW50QiksCiAgICAgICAgICAgICAgICBnZXRTcGVuZGFibGUob3JkZXIudG9rZW5TLCBvcmRlci5vd25lciksCiAgICAgICAgICAgICAgICAwLCAgIC8vIGZpbGxBbW91bnRTCiAgICAgICAgICAgICAgICAwLCAgIC8vIGxyY1Jld2FyZAogICAgICAgICAgICAgICAgMCwgICAvLyBscmNGZWUKICAgICAgICAgICAgICAgIDAsICAgLy8gc3BsaXRTCiAgICAgICAgICAgICAgICAwICAgIC8vIHNwbGl0QgogICAgICAgICAgICApOwoKICAgICAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgICAgICBvcmRlcnNbaV0uYXZhaWxhYmxlQW1vdW50UyA+IDAsCiAgICAgICAgICAgICAgICAib3JkZXIgc3BlbmRhYmxlIGFtb3VudFMgaXMgemVybyIKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmRlcnM7CiAgICB9CgogICAgLy8vIEBkZXYgdmFsaWRhdGUgb3JkZXIncyBwYXJhbWV0ZXJzIGFyZSBPSy4KICAgIGZ1bmN0aW9uIHZhbGlkYXRlT3JkZXIoT3JkZXIgb3JkZXIpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgewogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICBvcmRlci5vd25lciAhPSBhZGRyZXNzKDApLAogICAgICAgICAgICAiaW52YWxpZCBvcmRlciBvd25lciIKICAgICAgICApOwoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgb3JkZXIudG9rZW5TICE9IGFkZHJlc3MoMCksCiAgICAgICAgICAgICJpbnZhbGlkIG9yZGVyIHRva2VuUyIKICAgICAgICApOwoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgb3JkZXIudG9rZW5CICE9IGFkZHJlc3MoMCksCiAgICAgICAgICAgICJpbnZhbGlkIG9yZGVyIHRva2VuQiIKICAgICAgICApOwoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA+IDAsCiAgICAgICAgICAgICJpbnZhbGlkIG9yZGVyIGFtb3VudFMiCiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIG9yZGVyLmFtb3VudEIgPiAwLAogICAgICAgICAgICAiaW52YWxpZCBvcmRlciBhbW91bnRCIgogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICBvcmRlci50aW1lc3RhbXAgPD0gYmxvY2sudGltZXN0YW1wLAogICAgICAgICAgICAib3JkZXIgaXMgdG9vIGVhcmx5IHRvIG1hdGNoIgogICAgICAgICk7CgogICAgICAgIEVycm9yTGliLmNoZWNrKAogICAgICAgICAgICBvcmRlci50aW1lc3RhbXAgPiBjdXRvZmZzW29yZGVyLm93bmVyXSwKICAgICAgICAgICAgIm9yZGVyIGlzIGN1dCBvZmYiCiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIG9yZGVyLnR0bCA+IDAsCiAgICAgICAgICAgICJvcmRlciB0dGwgaXMgMCIKICAgICAgICApOwoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgb3JkZXIudGltZXN0YW1wICsgb3JkZXIudHRsID4gYmxvY2sudGltZXN0YW1wLAogICAgICAgICAgICAib3JkZXIgaXMgZXhwaXJlZCIKICAgICAgICApOwoKICAgICAgICBFcnJvckxpYi5jaGVjaygKICAgICAgICAgICAgb3JkZXIuc2FsdCA+IDAsCiAgICAgICAgICAgICJpbnZhbGlkIG9yZGVyIHNhbHQiCiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soCiAgICAgICAgICAgIG9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZSA8PSBNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFLAogICAgICAgICAgICAiaW52YWxpZCBvcmRlciBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UiCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBHZXQgdGhlIEtlY2Nhay0yNTYgaGFzaCBvZiBvcmRlciB3aXRoIHNwZWNpZmllZCBwYXJhbWV0ZXJzLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlT3JkZXJIYXNoKE9yZGVyIG9yZGVyKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoCiAgICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICAgIG9yZGVyLm93bmVyLAogICAgICAgICAgICBvcmRlci50b2tlblMsCiAgICAgICAgICAgIG9yZGVyLnRva2VuQiwKICAgICAgICAgICAgb3JkZXIuYW1vdW50UywKICAgICAgICAgICAgb3JkZXIuYW1vdW50QiwKICAgICAgICAgICAgb3JkZXIudGltZXN0YW1wLAogICAgICAgICAgICBvcmRlci50dGwsCiAgICAgICAgICAgIG9yZGVyLnNhbHQsCiAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSwKICAgICAgICAgICAgb3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgICAgIG9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgVmVyaWZ5IHNpZ25lcidzIHNpZ25hdHVyZS4KICAgIGZ1bmN0aW9uIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICBhZGRyZXNzIHNpZ25lciwKICAgICAgICBieXRlczMyIGhhc2gsCiAgICAgICAgdWludDggICB2LAogICAgICAgIGJ5dGVzMzIgciwKICAgICAgICBieXRlczMyIHMpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgewogICAgICAgIGFkZHJlc3MgYWRkciA9IGVjcmVjb3ZlcigKICAgICAgICAgICAga2VjY2FrMjU2KCJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiIsIGhhc2gpLAogICAgICAgICAgICB2LAogICAgICAgICAgICByLAogICAgICAgICAgICBzCiAgICAgICAgKTsKCiAgICAgICAgRXJyb3JMaWIuY2hlY2soc2lnbmVyID09IGFkZHIsICJpbnZhbGlkIHNpZ25hdHVyZSIpOwogICAgfQoKfQ=='.
	

]
