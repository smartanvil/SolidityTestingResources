Class {
	#name : #SRTb8eb17dfa4ec9a6457e4c8fb3d724c0ed9ba4cf0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb8eb17dfa4ec9a6457e4c8fb3d724c0ed9ba4cf0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICBNaW50YWJsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKCiAgLy8gYWRkcmVzcyB3aGVyZSBmdW5kcyBhcmUgY29sbGVjdGVkCiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogIHVpbnQyNTYgcHVibGljIHJhdGU7CgogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwoKICAvKioKICAgKiBldmVudCBmb3IgdG9rZW4gcHVyY2hhc2UgbG9nZ2luZwogICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICogQHBhcmFtIHZhbHVlIHdlaXMgcGFpZCBmb3IgcHVyY2hhc2UKICAgKiBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICovCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCgogIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCkgcHVibGljIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogIC8vIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgY3Jvd2RzYWxlIG9mIGEgc3BlY2lmaWMgbWludGFibGUgdG9rZW4uCiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgIHJldHVybiBuZXcgTWludGFibGVUb2tlbigpOwogIH0KCgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDApOwogICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKHJhdGUpOwoKICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgIHRva2VuLm1pbnQoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CgogICAgZm9yd2FyZEZ1bmRzKCk7CiAgfQoKICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2U7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmRUaW1lOwogIH0KCgp9Cgpjb250cmFjdCBDYXBwZWRDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSBwdWJsaWMgewogICAgcmVxdWlyZShfY2FwID4gMCk7CiAgICBjYXAgPSBfY2FwOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjdmFsaWRQdXJjaGFzZSB0byBhZGQgZXh0cmEgY2FwIGxvZ2ljCiAgLy8gQHJldHVybiB0cnVlIGlmIGludmVzdG9ycyBjYW4gYnV5IGF0IHRoZSBtb21lbnQKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCB3aXRoaW5DYXAgPSB3ZWlSYWlzZWQuYWRkKG1zZy52YWx1ZSkgPD0gY2FwOwogICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2UoKSAmJiB3aXRoaW5DYXA7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNoYXNFbmRlZCB0byBhZGQgY2FwIGxvZ2ljCiAgLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQKICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICBib29sIGNhcFJlYWNoZWQgPSB3ZWlSYWlzZWQgPj0gY2FwOwogICAgcmV0dXJuIHN1cGVyLmhhc0VuZGVkKCkgfHwgY2FwUmVhY2hlZDsKICB9Cgp9Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IFdoaXRlTGlzdENyb3dkc2FsZSBpcwogIENhcHBlZENyb3dkc2FsZSwKICBPd25hYmxlCnsKCiAgLyoqCiAgICogQGRldiBSYXRlIG9mIGJvbnVzIHRva2VucyByZWNlaXZlZCBieSBpbnZlc3RvcnMgZHVyaW5nIHRoZSB3aGl0ZWxpc3QgcGVyaW9kIG9mIHRoZSBjcm93ZHNhbGUuCiAgICovCiAgdWludDggcHVibGljIGNvbnN0YW50IFdISVRFTElTVF9CT05VU19SQVRFID0gMTA7CgogIC8qKgogICAqIEBkZXYgUmF0ZSBvZiBib251cyB0b2tlbnMgcmVjZWl2ZWQgYnkgYSByZWZlcnJpbmcgaW52ZXN0b3IsCiAgICogZXhwcmVzc2VkIGFzICUgb2YgdG90YWwgYm9udXMgdG9rZW5zIGlzc3VlZCBmb3IgdGhlIHB1cmNoYXNlLgogICAqLwogIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBSRUZFUlJBTF9TSEFSRV9SQVRFID0gNTA7CgogIC8qKgogICAqIEBkZXYgVGltZXN0YW1wIHVudGlsIHdoaWNoIGl0IGlzIHBvc3NpYmxlIHRvIGFkZCBhbiBpbnZlc3RvciB0byB0aGUgd2hpdGVsaXN0LgogICAqLwogIHVpbnQyNTYgcHVibGljIHdoaXRlTGlzdFJlZ2lzdHJhdGlvbkVuZFRpbWU7CgogIC8qKgogICAqIEBkZXYgVGltZXN0YW1wIGFmdGVyIHdoaWNoIGFueW9uZSBjYW4gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZS4KICAgKi8KICB1aW50MjU2IHB1YmxpYyB3aGl0ZUxpc3RFbmRUaW1lOwoKICAvKioKICAgKiBAZGV2IFdoaXRlbGlzdGVkIGFkZHJlc3Nlcy4KICAgKi8KICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzV2hpdGVMaXN0ZWQ7CgogIC8qKgogICAqIEBkZXYgUmVmZXJyYWwgY29kZXMgYXNzb2NpYXRlZCB0byB0aGVpciByZWZlcnJpbmcgYWRkcmVzc2VzLgogICAqLwogIG1hcHBpbmcoYnl0ZXMzMiA9PiBhZGRyZXNzKSBpbnRlcm5hbCByZWZlcnJhbENvZGVzOwoKICAvKioKICAgKiBAZGV2IE1hcHMgcmVmZXJyZWQgaW52ZXN0b3JzIHRvIHRoZWlyIHJlZmVycmVycyAocmVmZXJyZWQgPT4gcmVmZXJyaW5nKS4KICAgKi8KICBtYXBwaW5nKGFkZHJlc3MgPT4gYWRkcmVzcykgaW50ZXJuYWwgcmVmZXJyYWxzOwoKICAvKioKICAgKiBAZGV2IEV2ZW50IGZpcmVkIHdoZW4gYW4gYWRkcmVzcyBpcyBhZGRlZCB0byB0aGUgd2hpdGVsaXN0LgogICAqIEBwYXJhbSBpbnZlc3RvciB3aGl0ZWxpc3RlZCBpbnZlc3RvcgogICAqIEBwYXJhbSByZWZlcnJhbENvZGUgcmVmZXJyYWwgY29kZSBvZiB0aGUgd2hpdGVsaXN0ZWQgaW52ZXN0b3IKICAgKi8KICBldmVudCBXaGl0ZUxpc3RlZEludmVzdG9yQWRkZWQoCiAgICBhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsCiAgICBzdHJpbmcgcmVmZXJyYWxDb2RlCiAgKTsKCiAgLyoqCiAgICogZXZlbnQgZm9yIGJvbnVzIHRva2VuIGVtbWl0ZWQKICAgKiBAcGFyYW0gcmVmZXJyYWxDb2RlIHJlZmVycmFsIGNvZGUgb2YgdGhlIHdoaXRlbGlzdGVkIGludmVzdG9yCiAgICogQHBhcmFtIHJlZmVycmVkSW52ZXN0b3IgYWRkcmVzcyBvZiB0aGUgcmVmZXJyZWQgaW52ZXN0b3IKICAgKi8KICBldmVudCBSZWZlcnJlZEludmVzdG9yQWRkZWQoCiAgICBzdHJpbmcgcmVmZXJyYWxDb2RlLAogICAgYWRkcmVzcyByZWZlcnJlZEludmVzdG9yCiAgKTsKCiAgLyoqCiAgICogQGRldiBFdmVudCBmaXJlZCB3aGVuIGJvbnVzIHRva2VucyBhcmUgZW1pdHRlZCBmb3IgcmVmZXJyZWQgcHVyY2hhc2VzLgogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gYW1vdW50IGJvbnVzIHRva2VucyBpc3N1ZWQKICAgKi8KICBldmVudCBSZWZlcnJlZEJvbnVzVG9rZW5zRW1pdHRlZCgKICAgIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwKICAgIHVpbnQyNTYgYW1vdW50CiAgKTsKCiAgLyoqCiAgICogQGRldiBFdmVudCBmaXJlZCB3aGVuIGJvbnVzIHRva2VucyBhcmUgZW1pdHRlZCBmb3Igd2hpdGVsaXN0IG9yIHJlZmVycmVkIHB1cmNoYXNlcy4KICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGFtb3VudCBib251cyB0b2tlbnMgaXNzdWVkCiAgICovCiAgZXZlbnQgV2hpdGVMaXN0Qm9udXNUb2tlbnNFbWl0dGVkKAogICAgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LAogICAgdWludDI1NiBhbW91bnQKICApOwoKICAvKioKICAgKiBAZGV2IFdoaXRlTGlzdENyb3dkc2FsZSBjb25zdHJ1Y3Rpb24uCiAgICogQHBhcmFtIF93aGl0ZUxpc3RSZWdpc3RyYXRpb25FbmRUaW1lIHRpbWUgdW50aWwgd2hpY2ggd2hpdGUgbGlzdCByZWdpc3RyYXRpb24gaXMgc3RpbGwgcG9zc2libGUKICAgKiBAcGFyYW0gX3doaXRlTGlzdEVuZFRpbWUgdGltZSB1bnRpbCB3aGljaCBvbmx5IHdoaXRlIGxpc3QgcHVyY2hhc2VzIGFyZSBhY2NlcHRlZAogICAqLwogIGZ1bmN0aW9uIFdoaXRlTGlzdENyb3dkc2FsZSh1aW50MjU2IF93aGl0ZUxpc3RSZWdpc3RyYXRpb25FbmRUaW1lLCB1aW50MjU2IF93aGl0ZUxpc3RFbmRUaW1lKSBwdWJsaWMgewogICAgcmVxdWlyZShfd2hpdGVMaXN0RW5kVGltZSA+IHN0YXJ0VGltZSk7CgogICAgd2hpdGVMaXN0RW5kVGltZSA9IF93aGl0ZUxpc3RFbmRUaW1lOwogICAgd2hpdGVMaXN0UmVnaXN0cmF0aW9uRW5kVGltZSA9IF93aGl0ZUxpc3RSZWdpc3RyYXRpb25FbmRUaW1lOwogIH0KCiAgLyoqCiAgICogQGRldiBPdmVycmlkaW5nIENyb3dkc2FsZSNidXlUb2tlbnMgdG8gYWRkIGV4dHJhIHdoaXRlbGlzdCBhbmQgcmVmZXJyYWwgbG9naWMuCiAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBhZGRyZXNzIHRoYXQgaXMgYnV5aW5nIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlCiAgewogICAgcmVxdWlyZSh2YWxpZFdoaXRlTGlzdGVkUHVyY2hhc2UoX2JlbmVmaWNpYXJ5KSk7CgogICAgLy8gQnV5cyB0b2tlbnMgYW5kIHRyYW5zZmVycyB0aGVtIHRvIF9iZW5lZmljaWFyeS4KICAgIHN1cGVyLmJ1eVRva2VucyhfYmVuZWZpY2lhcnkpOwogICAgCiAgICB1aW50MjU2IGJvbnVzVG9rZW5zID0gY29tcHV0ZUJvbnVzVG9rZW5zKF9iZW5lZmljaWFyeSwgbXNnLnZhbHVlKTsKICAgIGlmIChpc1JlZmVycmVkKF9iZW5lZmljaWFyeSkpCiAgICB7CiAgICAgIHVpbnQyNTYgYm9udXNUb2tlbnNGb3JSZWZlcnJhbCA9IGJvbnVzVG9rZW5zLm11bChSRUZFUlJBTF9TSEFSRV9SQVRFKS5kaXYoMTAwKTsKICAgICAgdWludDI1NiBib251c1Rva2Vuc0ZvclJlZmVycmVkID0gYm9udXNUb2tlbnMuc3ViKGJvbnVzVG9rZW5zRm9yUmVmZXJyYWwpOwogICAgICB0b2tlbi5taW50KF9iZW5lZmljaWFyeSwgYm9udXNUb2tlbnNGb3JSZWZlcnJlZCk7CiAgICAgIHRva2VuLm1pbnQocmVmZXJyYWxzW19iZW5lZmljaWFyeV0sIGJvbnVzVG9rZW5zRm9yUmVmZXJyYWwpOwogICAgICBSZWZlcnJlZEJvbnVzVG9rZW5zRW1pdHRlZChfYmVuZWZpY2lhcnksIGJvbnVzVG9rZW5zRm9yUmVmZXJyZWQpOwogICAgICBXaGl0ZUxpc3RCb251c1Rva2Vuc0VtaXR0ZWQocmVmZXJyYWxzW19iZW5lZmljaWFyeV0sIGJvbnVzVG9rZW5zRm9yUmVmZXJyYWwpOwogICAgfQogICAgZWxzZSBpZiAoaXNXaGl0ZUxpc3RlZFtfYmVuZWZpY2lhcnldKQogICAgewogICAgICB0b2tlbi5taW50KF9iZW5lZmljaWFyeSwgYm9udXNUb2tlbnMpOwogICAgICBXaGl0ZUxpc3RCb251c1Rva2Vuc0VtaXR0ZWQoX2JlbmVmaWNpYXJ5LCBib251c1Rva2Vucyk7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IEFkZHMgYW4gaW52ZXN0b3IgdG8gdGhlIHdoaXRlbGlzdCBpZiByZWdpc3RyYXRpb24gaXMgb3Blbi4gRmFpbHMgb3RoZXJ3aXNlLgogICAqIEBwYXJhbSBfaW52ZXN0b3Igd2hpdGVsaXN0ZWQgaW52ZXN0b3IKICAgKiBAcGFyYW0gX3JlZmVycmFsQ29kZSBpbnZlc3RvcidzIHJlZmVycmFsIGNvZGUKICAgKi8KICBmdW5jdGlvbiBhZGRXaGl0ZUxpc3RlZEludmVzdG9yKGFkZHJlc3MgX2ludmVzdG9yLCBzdHJpbmcgX3JlZmVycmFsQ29kZSkgcHVibGljCiAgewogICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPD0gd2hpdGVMaXN0UmVnaXN0cmF0aW9uRW5kVGltZSk7CiAgICByZXF1aXJlKF9pbnZlc3RvciAhPSAwKTsKICAgIHJlcXVpcmUoIWlzV2hpdGVMaXN0ZWRbX2ludmVzdG9yXSk7CiAgICBieXRlczMyIHJlZmVycmFsQ29kZUhhc2ggPSBrZWNjYWsyNTYoX3JlZmVycmFsQ29kZSk7CiAgICByZXF1aXJlKHJlZmVycmFsQ29kZXNbcmVmZXJyYWxDb2RlSGFzaF0gPT0gMHgwKTsKICAgIAogICAgaXNXaGl0ZUxpc3RlZFtfaW52ZXN0b3JdID0gdHJ1ZTsKICAgIHJlZmVycmFsQ29kZXNbcmVmZXJyYWxDb2RlSGFzaF0gPSBfaW52ZXN0b3I7CiAgICBXaGl0ZUxpc3RlZEludmVzdG9yQWRkZWQoX2ludmVzdG9yLCBfcmVmZXJyYWxDb2RlKTsKICB9CgogIC8qKgogICAqIEBkZXYgQWRkcyB1cCB0byAzMCB3aGl0ZWxpc3RlZCBpbnZlc3RvcnMuIFRvIGJlIGNhbGxlZCBvbmUgb3IgbW9yZSB0aW1lcwogICAqIGZvciBpbml0aWFsIHdoaXRlbGlzdCBsb2FkaW5nLgogICAqIEBwYXJhbSBfaW52ZXN0b3JzIHdoaXRlbGlzdGVkIGludmVzdG9ycy4KICAgKiBAcGFyYW0gX3JlZmVycmFsQ29kZXMga2VjY2FrLTI1NiBoYXNoZXMgb2YgY29ycmVzcG9uZGluZyBpbnZlc3RvciByZWZlcnJhbCBjb2Rlcy4KICAgKi8KICBmdW5jdGlvbiBsb2FkV2hpdGVMaXN0KGFkZHJlc3NbXSBfaW52ZXN0b3JzLCBieXRlczMyW10gX3JlZmVycmFsQ29kZXMpIHB1YmxpYyBvbmx5T3duZXIKICB7CiAgICByZXF1aXJlKF9pbnZlc3RvcnMubGVuZ3RoIDw9IDMwKTsKICAgIHJlcXVpcmUoX2ludmVzdG9ycy5sZW5ndGggPT0gX3JlZmVycmFsQ29kZXMubGVuZ3RoKTsKCiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfaW52ZXN0b3JzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpc1doaXRlTGlzdGVkW19pbnZlc3RvcnNbaV1dID0gdHJ1ZTsKICAgICAgcmVmZXJyYWxDb2Rlc1tfcmVmZXJyYWxDb2Rlc1tpXV0gPSBfaW52ZXN0b3JzW2ldOwogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiBBZGRzIGEgcmVmZXJyZWQgaW52ZXN0b3IgdG8gdGhlIHNlY29uZC1sZXZlbCB3aGl0ZWxpc3QuCiAgICogQHBhcmFtIF9yZWZlcnJlZEludmVzdG9yIHdoaXRlbGlzdGVkIGludmVzdG9yLgogICAqIEBwYXJhbSBfcmVmZXJyYWxDb2RlIGludmVzdG9yJ3MgcmVmZXJyYWwgY29kZS4KICAgKi8KICBmdW5jdGlvbiBhZGRSZWZlcnJlZEludmVzdG9yKHN0cmluZyBfcmVmZXJyYWxDb2RlLCBhZGRyZXNzIF9yZWZlcnJlZEludmVzdG9yKSBwdWJsaWMKICB7CiAgICByZXF1aXJlKCFoYXNFbmRlZCgpKTsKICAgIHJlcXVpcmUoIWlzV2hpdGVMaXN0ZWRbX3JlZmVycmVkSW52ZXN0b3JdKTsKICAgIHJlcXVpcmUoX3JlZmVycmVkSW52ZXN0b3IgIT0gMCk7CiAgICByZXF1aXJlKHJlZmVycmFsc1tfcmVmZXJyZWRJbnZlc3Rvcl0gPT0gMHgwKTsKICAgIGJ5dGVzMzIgcmVmZXJyYWxDb2RlSGFzaCA9IGtlY2NhazI1NihfcmVmZXJyYWxDb2RlKTsKICAgIHJlcXVpcmUocmVmZXJyYWxDb2Rlc1tyZWZlcnJhbENvZGVIYXNoXSAhPSAwKTsKCiAgICByZWZlcnJhbHNbX3JlZmVycmVkSW52ZXN0b3JdID0gcmVmZXJyYWxDb2Rlc1tyZWZlcnJhbENvZGVIYXNoXTsKICAgIFJlZmVycmVkSW52ZXN0b3JBZGRlZChfcmVmZXJyYWxDb2RlLCBfcmVmZXJyZWRJbnZlc3Rvcik7CiAgfQoKICAvKioKICAgKiBAZGV2IEFkZHMgdXAgdG8gMzAgcmVmZXJyZWQgaW52ZXN0b3JzLiBUbyBiZSBjYWxsZWQgb25lIG9yIG1vcmUgdGltZXMKICAgKiBmb3IgaW5pdGlhbCByZWZlcnJlZCBsaXN0IGxvYWRpbmcuCiAgICogQHBhcmFtIF9yZWZlcnJhbENvZGVzIGtlY2Nhay0yNTYgaGFzaGVzIG9mIHJlZmVycmFsIGNvZGVzLgogICAqIEBwYXJhbSBfaW52ZXN0b3JzIGNvcnJlc3BvbmRpbmcgcmVmZXJyZWQgaW52ZXN0b3JzLgogICAqLwogIGZ1bmN0aW9uIGxvYWRSZWZlcnJlZEludmVzdG9ycyhieXRlczMyW10gX3JlZmVycmFsQ29kZXMsIGFkZHJlc3NbXSBfaW52ZXN0b3JzKSBwdWJsaWMgb25seU93bmVyCiAgewogICAgcmVxdWlyZShfaW52ZXN0b3JzLmxlbmd0aCA8PSAzMCk7CiAgICByZXF1aXJlKF9pbnZlc3RvcnMubGVuZ3RoID09IF9yZWZlcnJhbENvZGVzLmxlbmd0aCk7CgogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2ludmVzdG9ycy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgcmVmZXJyYWxzW19pbnZlc3RvcnNbaV1dID0gcmVmZXJyYWxDb2Rlc1tfcmVmZXJyYWxDb2Rlc1tpXV07CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiBfaW52ZXN0b3IgaXMgYSByZWZlcnJlZCBpbnZlc3Rvci4KICAgKiBAcGFyYW0gX2ludmVzdG9yIGFkZHJlc3MgdG8gY2hlY2sgYWdhaW5zdCB0aGUgbGlzdCBvZiByZWZlcnJlZCBpbnZlc3RvcnMuCiAgICovCiAgZnVuY3Rpb24gaXNSZWZlcnJlZChhZGRyZXNzIF9pbnZlc3RvcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIHJlZmVycmFsc1tfaW52ZXN0b3JdICE9IDB4MDsKICB9CgogIC8qKgogICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIF9pbnZlc3RvciBpcyBhIHdoaXRlbGlzdGVkIG9yIHJlZmVycmVkIGludmVzdG9yLAogICAqIG9yIHRoZSB3aGl0ZWxpc3QgcGVyaW9kIGhhcyBlbmRlZCAoYW5kIHRoZSBjcm93ZHNhbGUgaGFzbid0KSBhbmQgZXZlcnlvbmUgY2FuIGJ1eS4KICAgKiBAcGFyYW0gX2ludmVzdG9yIGludmVzdG9yIHdobyBpcyBtYWtpbmcgdGhlIHB1cmNoYXNlLgogICAqLwogIGZ1bmN0aW9uIHZhbGlkV2hpdGVMaXN0ZWRQdXJjaGFzZShhZGRyZXNzIF9pbnZlc3RvcikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXR1cm4gaXNXaGl0ZUxpc3RlZFtfaW52ZXN0b3JdIHx8IGlzUmVmZXJyZWQoX2ludmVzdG9yKSB8fCBibG9jay50aW1lc3RhbXAgPiB3aGl0ZUxpc3RFbmRUaW1lOwogIH0KCiAgLyoqCiAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYm9udXMgdG9rZW5zIGZvciBhIHdoaXRlbGlzdGVkIG9yIHJlZmVycmVkIHB1cmNoYXNlLgogICAqIFJldHVybnMgemVybyBpZiB0aGUgcHVyY2hhc2UgaXMgbm90IGZyb20gYSB3aGl0ZWxpc3RlZCBvciByZWZlcnJlZCBpbnZlc3Rvci4KICAgKiBAcGFyYW0gX3dlaUFtb3VudCBwdXJjaGFzZSBhbW91bnQuCiAgICovCiAgZnVuY3Rpb24gY29tcHV0ZUJvbnVzVG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgewogICAgaWYgKGlzUmVmZXJyZWQoX2JlbmVmaWNpYXJ5KSB8fCBpc1doaXRlTGlzdGVkW19iZW5lZmljaWFyeV0pIHsKICAgICAgdWludDI1NiBib251c1Rva2VucyA9IF93ZWlBbW91bnQubXVsKHJhdGUpLm11bChXSElURUxJU1RfQk9OVVNfUkFURSkuZGl2KDEwMCk7CiAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPiB3aGl0ZUxpc3RFbmRUaW1lKSB7CiAgICAgICAgYm9udXNUb2tlbnMgPSBib251c1Rva2Vucy5kaXYoMik7CiAgICAgIH0KICAgICAgcmV0dXJuIGJvbnVzVG9rZW5zOwogICAgfQogICAgZWxzZQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICB9Cgp9Cgpjb250cmFjdCBGaW5hbGl6YWJsZUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwoKICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgLyoqCiAgICogQGRldiBNdXN0IGJlIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZW5kcywgdG8gZG8gc29tZSBleHRyYSBmaW5hbGl6YXRpb24KICAgKiB3b3JrLiBDYWxscyB0aGUgY29udHJhY3QncyBmaW5hbGl6YXRpb24gZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CgogICAgZmluYWxpemF0aW9uKCk7CiAgICBGaW5hbGl6ZWQoKTsKCiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbiBiZSBvdmVycmlkZGVuIHRvIGFkZCBmaW5hbGl6YXRpb24gbG9naWMuIFRoZSBvdmVycmlkaW5nIGZ1bmN0aW9uCiAgICogc2hvdWxkIGNhbGwgc3VwZXIuZmluYWxpemF0aW9uKCkgdG8gZW5zdXJlIHRoZSBjaGFpbiBvZiBmaW5hbGl6YXRpb24gaXMKICAgKiBleGVjdXRlZCBlbnRpcmVseS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgfQp9Cgpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgZXZlbnQgQ2xvc2VkKCk7CiAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKCiAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgfQoKICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgaW52ZXN0b3IpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkW2ludmVzdG9yXS5hZGQobXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogIH0KfQoKY29udHJhY3QgUmVmdW5kYWJsZUNyb3dkc2FsZSBpcyBGaW5hbGl6YWJsZUNyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIG1pbmltdW0gYW1vdW50IG9mIGZ1bmRzIHRvIGJlIHJhaXNlZCBpbiB3ZWlzCiAgdWludDI1NiBwdWJsaWMgZ29hbDsKCiAgLy8gcmVmdW5kIHZhdWx0IHVzZWQgdG8gaG9sZCBmdW5kcyB3aGlsZSBjcm93ZHNhbGUgaXMgcnVubmluZwogIFJlZnVuZFZhdWx0IHB1YmxpYyB2YXVsdDsKCiAgZnVuY3Rpb24gUmVmdW5kYWJsZUNyb3dkc2FsZSh1aW50MjU2IF9nb2FsKSBwdWJsaWMgewogICAgcmVxdWlyZShfZ29hbCA+IDApOwogICAgdmF1bHQgPSBuZXcgUmVmdW5kVmF1bHQod2FsbGV0KTsKICAgIGdvYWwgPSBfZ29hbDsKICB9CgogIC8vIFdlJ3JlIG92ZXJyaWRpbmcgdGhlIGZ1bmQgZm9yd2FyZGluZyBmcm9tIENyb3dkc2FsZS4KICAvLyBJbiBhZGRpdGlvbiB0byBzZW5kaW5nIHRoZSBmdW5kcywgd2Ugd2FudCB0byBjYWxsCiAgLy8gdGhlIFJlZnVuZFZhdWx0IGRlcG9zaXQgZnVuY3Rpb24KICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgfQoKICAvLyBpZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBpbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZHMgaGVyZQogIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZSghZ29hbFJlYWNoZWQoKSk7CgogICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogIH0KCiAgLy8gdmF1bHQgZmluYWxpemF0aW9uIHRhc2ssIGNhbGxlZCB3aGVuIG93bmVyIGNhbGxzIGZpbmFsaXplKCkKICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewogICAgICB2YXVsdC5jbG9zZSgpOwogICAgfSBlbHNlIHsKICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgfQoKICAgIHN1cGVyLmZpbmFsaXphdGlvbigpOwogIH0KCiAgZnVuY3Rpb24gZ29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBnb2FsOwogIH0KCn0KCmNvbnRyYWN0IERlc3RydWN0aWJsZSBpcyBPd25hYmxlIHsKCiAgZnVuY3Rpb24gRGVzdHJ1Y3RpYmxlKCkgcHVibGljIHBheWFibGUgeyB9CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBjdXJyZW50IGJhbGFuY2UgdG8gdGhlIG93bmVyIGFuZCB0ZXJtaW5hdGVzIHRoZSBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBkZXN0cm95KCkgb25seU93bmVyIHB1YmxpYyB7CiAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogIH0KCiAgZnVuY3Rpb24gZGVzdHJveUFuZFNlbmQoYWRkcmVzcyBfcmVjaXBpZW50KSBvbmx5T3duZXIgcHVibGljIHsKICAgIHNlbGZkZXN0cnVjdChfcmVjaXBpZW50KTsKICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IERlbWV0ZXJDcm93ZHNhbGUgaXMKICBSZWZ1bmRhYmxlQ3Jvd2RzYWxlLAogIFdoaXRlTGlzdENyb3dkc2FsZSwKICBQYXVzYWJsZSwKICBEZXN0cnVjdGlibGUKewoKICAvKioKICAgKiBAZGV2IEVhY2ggdGltZSBhbiBpbnZlc3RvciBwdXJjaGFzZXMsIGhlIGdldHMgdGhpcyAlIG9mIHRoZSBtaW50ZWQgdG9rZW5zCiAgICogKHBsdXMgYm9udXMgaWYgYXBwbGljYWJsZSksIHdoaWxlIHRoZSBjb21wYW55IGdldHMgNzAlIChtaW51cyBib251cykuCiAgICovCiAgdWludDggY29uc3RhbnQgcHVibGljIFBFUkNfVE9LRU5TX1RPX0lOVkVTVE9SID0gMzA7CgogIC8qKgogICAqIEBkZXYgUG9ydGlvbiBvZiB0b3RhbCB0b2tlbnMgcmVzZXJ2ZWQgZm9yIGZ1dHVyZSB0b2tlbiByZWxlYXNlcy4KICAgKiBEb2N1bWVudGF0aW9uLW9ubHkuIFVudXNlZCBpbiBjb2RlLCBhcyB0aGUgcmVsZWFzZSBwYXJ0IGlzIGNhbGN1bGF0ZWQgYnkgc3VidHJhY3Rpb24uCiAgICovCiAgdWludDggY29uc3RhbnQgcHVibGljIFBFUkNfVE9LRU5TX1RPX1JFTEVBU0UgPSAyNTsKCiAgLyoqCiAgICogQGRldiBBZGRyZXNzIHRvIHdoaWNoIHRoZSByZWxlYXNlIHRva2VucyBhcmUgY3JlZGl0ZWQuCiAgICovCiAgYWRkcmVzcyBjb25zdGFudCBwdWJsaWMgUkVMRUFTRV9XQUxMRVQgPSAweDg2N0Q4NTQzN2QyN2NBOTdlMUVCNTc0MjUwZWZiYmE0ODdhY2E2Mzc7CgogIC8qKgogICAqIFBvcnRpb24gb2YgdG90YWwgdG9rZW5zIHJlc2VydmVkIGZvciBkZXYuIHRlYW0uCiAgICovCiAgdWludDggY29uc3RhbnQgcHVibGljIFBFUkNfVE9LRU5TX1RPX0RFViA9IDIwOwoKICAvKioKICAgKiBAZGV2IEFkZHJlc3MgdG8gd2hpY2ggdGhlIGRldi4gdG9rZW5zIGFyZSBjcmVkaXRlZC4KICAgKi8KICBhZGRyZXNzIGNvbnN0YW50IHB1YmxpYyBERVZfV0FMTEVUID0gMHg3MDMyMzIyMjY5NDU4NGM2OEJENWEyOTE5NGJiNzJjMjQ4ZTcxNUY3OwoKICAvKioKICAgKiBQb3J0aW9uIG9mIHRvdGFsIHRva2VucyByZXNlcnZlZCBmb3IgYnVzaW5lc3MgZGV2LgogICAqLwogIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBQRVJDX1RPS0VOU19UT19CSVpERVYgPSAyNTsKCiAgLyoqCiAgICogQGRldiBBZGRyZXNzIHRvIHdoaWNoIHRoZSBidXNpbmVzcyBkZXYuIHRva2VucyBhcmUgY3JlZGl0ZWQuCiAgICovCiAgYWRkcmVzcyBjb25zdGFudCBwdWJsaWMgQklaREVWX1dBTExFVCA9IDB4RTQzMDUzZTI2NUYwNGY2OTAwMjE3MzVFMDJCQkE1NTlDZWE2ODFENjsKCiAgLyoqCiAgICogQGRldiBFdmVudCBmaXJlZCB3aGVuZXZlciBjb21wYW55IHRva2VucyBhcmUgaXNzdWVkIGZvciBhIHB1cmNoYXNlLgogICAqIEBwYXJhbSBpbnZlc3RvciB3aG8gbWFkZSB0aGUgcHVyY2hhc2UKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBtaW50ZWQgZm9yIHRoZSBjb21wYW55CiAgICovCiAgZXZlbnQgQ29tcGFueVRva2Vuc0lzc3VlZCgKICAgIGFkZHJlc3MgaW5kZXhlZCBpbnZlc3RvciwKICAgIHVpbnQyNTYgdmFsdWUsCiAgICB1aW50MjU2IGFtb3VudAogICk7CgogIC8qKgogICAqIEBkZXYgRGVtZXRlckNyb3dkc2FsZSBjb25zdHJ1Y3Rpb24uCiAgICogQHBhcmFtIF9zdGFydFRpbWUgYmVnaW5uaW5nIG9mIGNyb3dkc2FsZS4KICAgKiBAcGFyYW0gX2VuZFRpbWUgZW5kIG9mIGNyb3dkc2FsZS4KICAgKiBAcGFyYW0gX3doaXRlTGlzdFJlZ2lzdHJhdGlvbkVuZFRpbWUgdGltZSB1bnRpbCB3aGljaCB3aGl0ZWxpc3QgcmVnaXN0cmF0aW9uIGlzIHN0aWxsIHBvc3NpYmxlLgogICAqIEBwYXJhbSBfd2hpdGVMaXN0RW5kVGltZSB0aW1lIHVudGlsIHdoaWNoIG9ubHkgd2hpdGVsaXN0IHB1cmNoYXNlcyBhcmUgYWNjZXB0ZWQuCiAgICogQHBhcmFtIF9yYXRlIGhvdyBtYW55IHRva2VucyBwZXIgZXRoZXIgaW4gY2FzZSBvZiBubyB3aGl0ZWxpc3Qgb3IgcmVmZXJyYWwgYm9udXNlcy4KICAgKiBAcGFyYW0gX2NhcCBjcm93ZHNhbGUgaGFyZCBjYXAgaW4gd2VpLgogICAqIEBwYXJhbSBfZ29hbCBtaW5pbXVtIGNyb3dkc2FsZSBnb2FsIGluIHdlaTsgaWYgbm90IHJlYWNoZWQsIGNhdXNlcyByZWZ1bmRzIHRvIGJlIGF2YWlsYWJsZS4KICAgKiBAcGFyYW0gX3dhbGxldCB3aGVyZSB0aGUgcmFpc2VkIGV0aGVycyBhcmUgdHJhbnNmZXJyZWQgaW4gY2FzZSBvZiBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBEZW1ldGVyQ3Jvd2RzYWxlKAogICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgdWludDI1NiBfZW5kVGltZSwKICAgIHVpbnQyNTYgX3doaXRlTGlzdFJlZ2lzdHJhdGlvbkVuZFRpbWUsCiAgICB1aW50MjU2IF93aGl0ZUxpc3RFbmRUaW1lLAogICAgdWludDI1NiBfcmF0ZSwKICAgIHVpbnQyNTYgX2NhcCwKICAgIHVpbnQyNTYgX2dvYWwsCiAgICBhZGRyZXNzIF93YWxsZXQKICApIHB1YmxpYwogICAgQ3Jvd2RzYWxlKF9zdGFydFRpbWUsIF9lbmRUaW1lLCBfcmF0ZSwgX3dhbGxldCkKICAgIENhcHBlZENyb3dkc2FsZShfY2FwKQogICAgUmVmdW5kYWJsZUNyb3dkc2FsZShfZ29hbCkKICAgIFdoaXRlTGlzdENyb3dkc2FsZShfd2hpdGVMaXN0UmVnaXN0cmF0aW9uRW5kVGltZSwgX3doaXRlTGlzdEVuZFRpbWUpCiAgewogICAgRGVtZXRlclRva2VuKHRva2VuKS5zZXRVbmxvY2tUaW1lKF9lbmRUaW1lKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsbGVkIHdoZW4gYSBwdXJjaGFzZSBpcyBtYWRlLiBPdmVycmlkZSB0byBpc3N1ZSBjb21wYW55IHRva2VucwogICAqIGluIGFkZGl0aW9uIHRvIGJvdWdodCBhbmQgYm9udXMgdG9rZW5zLgogICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgdGhlIGludmVzdG9yIHRoYXQgYnV5cyB0aGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSAwLjEgZXRoZXIpOwogICAgLy8gYnV5cyB0b2tlbnMgKGluY2x1ZGluZyByZWZlcnJhbCBvciB3aGl0ZWxpc3QgdG9rZW5zKSBhbmQKICAgIC8vIHRyYW5zZmVycyB0aGVtIHRvIF9iZW5lZmljaWFyeS4KICAgIHN1cGVyLmJ1eVRva2VucyhfYmVuZWZpY2lhcnkpOwogICAgCiAgICAvLyBtaW50cyBhZGRpdGlvbmFsIHRva2VucyBmb3IgdGhlIGNvbXBhbnkgYW5kIGRpc3RyaWJ1dGVzIHRoZW0gdG8gdGhlIGNvbXBhbnkgd2FsbGV0cy4KICAgIGlzc3VlQ29tcGFueVRva2VucyhfYmVuZWZpY2lhcnksIG1zZy52YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENsb3NlcyB0aGUgdmF1bHQsIHRlcm1pbmF0ZXMgdGhlIGNvbnRyYWN0IGFuZCB0aGUgdG9rZW4gY29udHJhY3QgYXMgd2VsbC4KICAgKiBPbmx5IGFsbG93ZWQgd2hpbGUgdGhlIHZhdWx0IGlzIG9wZW4gKG5vdCB3aGVuIHJlZnVuZHMgYXJlIGVuYWJsZWQgb3IgdGhlIHZhdWx0CiAgICogaXMgYWxyZWFkeSBjbG9zZWQpLiBCYWxhbmNlIHdvdWxkIGJlIHRyYW5zZmVycmVkIHRvIHRoZSBvd25lciwgYnV0IGl0IGlzCiAgICogYWx3YXlzIHplcm8gYW55d2F5LgogICAqLwogIGZ1bmN0aW9uIGRlc3Ryb3koKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHZhdWx0LmNsb3NlKCk7CiAgICBzdXBlci5kZXN0cm95KCk7CiAgICBEZW1ldGVyVG9rZW4odG9rZW4pLmRlc3Ryb3lBbmRTZW5kKHRoaXMpOwogIH0KCiAgLyoqCiAgICogQGRldiBDbG9zZXMgdGhlIHZhdWx0LCB0ZXJtaW5hdGVzIHRoZSBjb250cmFjdCBhbmQgdGhlIHRva2VuIGNvbnRyYWN0IGFzIHdlbGwuCiAgICogT25seSBhbGxvd2VkIHdoaWxlIHRoZSB2YXVsdCBpcyBvcGVuIChub3Qgd2hlbiByZWZ1bmRzIGFyZSBlbmFibGVkIG9yIHRoZSB2YXVsdAogICAqIGlzIGFscmVhZHkgY2xvc2VkKS4gQmFsYW5jZSB3b3VsZCBiZSB0cmFuc2ZlcnJlZCB0byBfcmVjaXBpZW50LCBidXQgaXQgaXMKICAgKiBhbHdheXMgemVybyBhbnl3YXkuCiAgICovCiAgZnVuY3Rpb24gZGVzdHJveUFuZFNlbmQoYWRkcmVzcyBfcmVjaXBpZW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgIHZhdWx0LmNsb3NlKCk7CiAgICBzdXBlci5kZXN0cm95QW5kU2VuZChfcmVjaXBpZW50KTsKICAgIERlbWV0ZXJUb2tlbih0b2tlbikuZGVzdHJveUFuZFNlbmQoX3JlY2lwaWVudCk7CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgb3duZXIgdG8gY2hhbmdlIHRoZSBtaW5pbXVtIGdvYWwgZHVyaW5nIHRoZSBzYWxlLgogICAqIEBwYXJhbSBfZ29hbCBuZXcgZ29hbCBpbiB3ZWkuCiAgICovCiAgZnVuY3Rpb24gdXBkYXRlR29hbCh1aW50MjU2IF9nb2FsKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoX2dvYWwgPj0gMCAmJiBfZ29hbCA8PSBjYXApOwogICAgcmVxdWlyZSghaGFzRW5kZWQoKSk7CgogICAgZ29hbCA9IF9nb2FsOwogIH0KCiAgLyoqCiAgICogQGRldiBNaW50cyBhZGRpdGlvbmFsIHRva2VucyBmb3IgdGhlIGNvbXBhbnkgYW5kIGRpc3RyaWJ1dGVzIHRoZW0gdG8gdGhlIGNvbXBhbnkgd2FsbGV0cy4KICAgKiBAcGFyYW0gX2ludmVzdG9yIHRoZSBpbnZlc3RvciB0aGF0IGJvdWdodCB0b2tlbnMuCiAgICogQHBhcmFtIF93ZWlBbW91bnQgdGhlIGFtb3VudCBwYWlkIGluIHdlaXMuCiAgICovCiAgZnVuY3Rpb24gaXNzdWVDb21wYW55VG9rZW5zKGFkZHJlc3MgX2ludmVzdG9yLCB1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIHsKICAgIHVpbnQyNTYgaW52ZXN0b3JUb2tlbnMgPSBfd2VpQW1vdW50Lm11bChyYXRlKTsKICAgIHVpbnQyNTYgYm9udXNUb2tlbnMgPSBjb21wdXRlQm9udXNUb2tlbnMoX2ludmVzdG9yLCBfd2VpQW1vdW50KTsKICAgIHVpbnQyNTYgY29tcGFueVRva2VucyA9IGludmVzdG9yVG9rZW5zLm11bCgxMDAgLSBQRVJDX1RPS0VOU19UT19JTlZFU1RPUikuZGl2KFBFUkNfVE9LRU5TX1RPX0lOVkVTVE9SKTsKICAgIHVpbnQyNTYgdG90YWxUb2tlbnMgPSBpbnZlc3RvclRva2Vucy5hZGQoY29tcGFueVRva2Vucyk7CiAgICAvLyBkaXN0cmlidXRlIHRvdGFsIHRva2VucyBhbW9uZyB0aGUgdGhyZWUgd2FsbGV0cy4KICAgIHVpbnQyNTYgZGV2VG9rZW5zID0gdG90YWxUb2tlbnMubXVsKFBFUkNfVE9LRU5TX1RPX0RFVikuZGl2KDEwMCk7CiAgICB0b2tlbi5taW50KERFVl9XQUxMRVQsIGRldlRva2Vucyk7CiAgICAvLyBXZSB0YWtlIG91dCBib251cyB0b2tlbnMgZnJvbSBiaXpEZXYgYW1vdW50LgogICAgdWludDI1NiBiaXpEZXZUb2tlbnMgPSAodG90YWxUb2tlbnMubXVsKFBFUkNfVE9LRU5TX1RPX0JJWkRFVikuZGl2KDEwMCkpLnN1Yihib251c1Rva2Vucyk7CiAgICB0b2tlbi5taW50KEJJWkRFVl9XQUxMRVQsIGJpekRldlRva2Vucyk7CiAgICB1aW50MjU2IGFjdHVhbENvbXBhbnlUb2tlbnMgPSBjb21wYW55VG9rZW5zLnN1Yihib251c1Rva2Vucyk7CiAgICB1aW50MjU2IHJlbGVhc2VUb2tlbnMgPSBhY3R1YWxDb21wYW55VG9rZW5zLnN1YihiaXpEZXZUb2tlbnMpLnN1YihkZXZUb2tlbnMpOwogICAgdG9rZW4ubWludChSRUxFQVNFX1dBTExFVCwgcmVsZWFzZVRva2Vucyk7CgogICAgQ29tcGFueVRva2Vuc0lzc3VlZChfaW52ZXN0b3IsIF93ZWlBbW91bnQsIGFjdHVhbENvbXBhbnlUb2tlbnMpOwogIH0KCiAgLyoqCiAgICogQGRldiBPdmVycmlkZSB0byBjcmVhdGUgb3VyIHNwZWNpZmljIHRva2VuIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICByZXR1cm4gbmV3IERlbWV0ZXJUb2tlbigpOwogIH0KCiAgLyoqCiAgICogSW1tZWRpYXRlbHkgdW5sb2NrcyB0b2tlbnMuIFRvIGJlIHVzZWQgaW4gY2FzZSBvZiBlYXJseSBjbG9zZSBvZiB0aGUgc2FsZS4KICAgKi8KICBmdW5jdGlvbiB1bmxvY2tUb2tlbnMoKSBpbnRlcm5hbCB7CiAgICBpZiAoRGVtZXRlclRva2VuKHRva2VuKS51bmxvY2tUaW1lKCkgPiBibG9jay50aW1lc3RhbXApIHsKICAgICAgRGVtZXRlclRva2VuKHRva2VuKS5zZXRVbmxvY2tUaW1lKGJsb2NrLnRpbWVzdGFtcCk7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IFVubG9jayB0aGUgdG9rZW5zIGltbWVkaWF0ZWx5IGlmIHRoZSBzYWxlIGNsb3NlcyBwcmVtYXR1cmVseS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKICAgIHVubG9ja1Rva2VucygpOwogIH0KCn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgVHJhbnNmZXIoMHgwLCBfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKY29udHJhY3QgVGltZUxvY2tlZFRva2VuIGlzIE1pbnRhYmxlVG9rZW4KewoKICAvKioKICAgKiBAZGV2IFRpbWVzdGFtcCBhZnRlciB3aGljaCB0b2tlbnMgY2FuIGJlIHRyYW5zZmVycmVkLgogICAqLwogIHVpbnQyNTYgcHVibGljIHVubG9ja1RpbWUgPSAwOwoKICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGl0IGNhbiB0cmFuc2ZlciBvciBvdGhlcndpc2UgdGhyb3dzLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKCkgewogICAgcmVxdWlyZSh1bmxvY2tUaW1lID09IDAgfHwgYmxvY2sudGltZXN0YW1wID4gdW5sb2NrVGltZSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBTZXRzIHRoZSBkYXRlIGFuZCB0aW1lIHNpbmNlIHdoaWNoIHRva2VucyBjYW4gYmUgdHJhbnNmZXJlZC4KICAgKiBJdCBjYW4gb25seSBiZSBtb3ZlZCBiYWNrLCBhbmQgbm90IGluIHRoZSBwYXN0LgogICAqIEBwYXJhbSBfdW5sb2NrVGltZSBOZXcgdW5sb2NrIHRpbWVzdGFtcC4KICAgKi8KICBmdW5jdGlvbiBzZXRVbmxvY2tUaW1lKHVpbnQyNTYgX3VubG9ja1RpbWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSh1bmxvY2tUaW1lID09IDAgfHwgX3VubG9ja1RpbWUgPCB1bmxvY2tUaW1lKTsKICAgIHJlcXVpcmUoX3VubG9ja1RpbWUgPj0gYmxvY2sudGltZXN0YW1wKTsKCiAgICB1bmxvY2tUaW1lID0gX3VubG9ja1RpbWU7CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2ZlciByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc2VuZCB0aGUgdG9rZW5zLgogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2ZlciByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKfQoKY29udHJhY3QgRGVtZXRlclRva2VuIGlzIFRpbWVMb2NrZWRUb2tlbiwgRGVzdHJ1Y3RpYmxlCnsKICBzdHJpbmcgcHVibGljIG5hbWUgPSAiRGVtZXRlciI7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiRE1UIjsKICB1aW50MjU2IHB1YmxpYyBkZWNpbWFscyA9IDE4Owp9'.
	

]
