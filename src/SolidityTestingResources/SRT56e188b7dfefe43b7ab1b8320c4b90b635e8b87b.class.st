Class {
	#name : #SRT56e188b7dfefe43b7ab1b8320c4b90b635e8b87b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT56e188b7dfefe43b7ab1b8320c4b90b635e8b87b >> base64 [
	^ 'LyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTTWF0aExpYiB7CgogICAgZnVuY3Rpb24gdGltZXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdmlkZXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA+IDApOwogICAgICAgIHVpbnQgYyA9IGEgLyBiOwogICAgICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYz49YSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cgp9CgoKCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpjb250cmFjdCBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPiAwKTsKICAgICAgICB1aW50IGMgPSBhIC8gYjsKICAgICAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCn0KLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgICAqIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cgp9CgoKLy8gQ3JlYXRlZCB1c2luZyBJQ08gV2l6YXJkIGh0dHBzOi8vZ2l0aHViLmNvbS9vcmFjbGVzb3JnL2ljby13aXphcmQgYnkgT3JhY2xlcyBOZXR3b3JrCgovKgogKiBIYWx0YWJsZQogKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKgogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICAgIGJvb2wgcHVibGljIGhhbHRlZDsKCiAgICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgc3RvcE5vbk93bmVyc0luRW1lcmdlbmN5IHsKICAgICAgICBpZiAoaGFsdGVkICYmIG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgICAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaGFsdGVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgICAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIH0KCn0KCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCgovKioKICogU3RhbmRhcmQgRVJDMjAgdG9rZW4gd2l0aCBTaG9ydCBIYW5kIEF0dGFjayBhbmQgYXBwcm92ZSgpIHJhY2UgY29uZGl0aW9uIG1pdGlnYXRpb24uCiAqCiAqIEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDoKICogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7CgogICAgLyogVG9rZW4gc3VwcGx5IGdvdCBpbmNyZWFzZWQgYW5kIGEgbmV3IG93bmVyIHJlY2VpdmVkIHRoZXNlIHRva2VucyAqLwogICAgZXZlbnQgTWludGVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvKiBBY3R1YWwgYmFsYW5jZXMgb2YgdG9rZW4gaG9sZGVycyAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwoKICAgIC8qIGFwcHJvdmUoKSBhbGxvd2FuY2VzICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogICAgLyogSW50ZXJmYWNlIGRlY2xhcmF0aW9uICovCiAgICBmdW5jdGlvbiBpc1Rva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgd2VBcmUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSk7CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCi8qKgogKiBVcGdyYWRlIGFnZW50IGludGVyZmFjZSBpbnNwaXJlZCBieSBMdW55ci4KICoKICogVXBncmFkZSBhZ2VudCB0cmFuc2ZlcnMgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogKiBVcGdyYWRlIGFnZW50IGl0c2VsZiBjYW4gYmUgdGhlIHRva2VuIGNvbnRyYWN0LCBvciBqdXN0IGEgbWlkZGxlIG1hbiBjb250cmFjdCBkb2luZyB0aGUgaGVhdnkgbGlmdGluZy4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogICAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogICAgLyoqIEludGVyZmFjZSBtYXJrZXIgKi8KICAgIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKfQoKCi8qKgogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucyB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4KICoKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogICAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsKCiAgICAvKiogVGhlIG5leHQgY29udHJhY3Qgd2hlcmUgdGhlIHRva2VucyB3aWxsIGJlIG1pZ3JhdGVkLiAqLwogICAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogICAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogICAgLyoqCiAgICAgKiBVcGdyYWRlIHN0YXRlcy4KICAgICAqCiAgICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4KICAgICAqIC0gV2FpdGluZ0ZvckFnZW50OiBUb2tlbiBhbGxvd3MgdXBncmFkZSwgYnV0IHdlIGRvbid0IGhhdmUgYSBuZXcgYWdlbnQgeWV0CiAgICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldAogICAgICogLSBVcGdyYWRpbmc6IFVwZ3JhZGUgYWdlbnQgaXMgc2V0IGFuZCB0aGUgYmFsYW5jZSBob2xkZXJzIGNhbiB1cGdyYWRlIHRoZWlyIHRva2VucwogICAgICoKICAgICAqLwogICAgZW51bSBVcGdyYWRlU3RhdGUge1Vua25vd24sIE5vdEFsbG93ZWQsIFdhaXRpbmdGb3JBZ2VudCwgUmVhZHlUb1VwZ3JhZGUsIFVwZ3JhZGluZ30KCiAgICAvKioKICAgICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICAgKi8KICAgIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLyoqCiAgICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuCiAgICAgKi8KICAgIGV2ZW50IFVwZ3JhZGVBZ2VudFNldChhZGRyZXNzIGFnZW50KTsKCiAgICAvKioKICAgICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBfdXBncmFkZU1hc3RlcikgewogICAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBfdXBncmFkZU1hc3RlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgICAqLwogICAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgewoKICAgICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgICByZXF1aXJlKCEoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpKTsKCiAgICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgICAgcmVxdWlyZSAodmFsdWUgPT0gMCk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdmFsdWUpOwoKICAgICAgICAvLyBUYWtlIHRva2VucyBvdXQgZnJvbSBjaXJjdWxhdGlvbgogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgdmFsdWUpOwogICAgICAgIHRvdGFsVXBncmFkZWQgPSBzYWZlQWRkKHRvdGFsVXBncmFkZWQsIHZhbHVlKTsKCiAgICAgICAgLy8gVXBncmFkZSBhZ2VudCByZWlzc3VlcyB0aGUgdG9rZW5zCiAgICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFVwZ3JhZGVBZ2VudChhZGRyZXNzIGFnZW50KSBleHRlcm5hbCB7CgogICAgICAgIHJlcXVpcmUoIWNhblVwZ3JhZGUoKSk7IC8vIFRoZSB0b2tlbiBpcyBub3QgeWV0IGluIGEgc3RhdGUgdGhhdCB3ZSBjb3VsZCB0aGluayB1cGdyYWRpbmc7CgogICAgICAgIHJlcXVpcmUoYWdlbnQgPT0gMHgwKTsKICAgICAgICAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgYWdlbnQKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3Rlcik7CiAgICAgICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQKICAgICAgICByZXF1aXJlKGdldFVwZ3JhZGVTdGF0ZSgpID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgICAgICB1cGdyYWRlQWdlbnQgPSBVcGdyYWRlQWdlbnQoYWdlbnQpOwoKICAgICAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICAgICAgcmVxdWlyZSghdXBncmFkZUFnZW50LmlzVXBncmFkZUFnZW50KCkpOwogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICAgICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSk7CgogICAgICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBzdGF0ZSBvZiB0aGUgdG9rZW4gdXBncmFkZS4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7CiAgICAgICAgaWYoIWNhblVwZ3JhZGUoKSkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5Ob3RBbGxvd2VkOwogICAgICAgIGVsc2UgaWYoYWRkcmVzcyh1cGdyYWRlQWdlbnQpID09IDB4MDApIHJldHVybiBVcGdyYWRlU3RhdGUuV2FpdGluZ0ZvckFnZW50OwogICAgICAgIGVsc2UgaWYodG90YWxVcGdyYWRlZCA9PSAwKSByZXR1cm4gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlOwogICAgICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLgogICAgICoKICAgICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobWFzdGVyID09IDB4MCk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpOwogICAgICAgIHVwZ3JhZGVNYXN0ZXIgPSBtYXN0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGlsZCBjb250cmFjdCBjYW4gZW5hYmxlIHRvIHByb3ZpZGUgdGhlIGNvbmRpdGlvbiB3aGVuIHRoZSB1cGdyYWRlIGNhbiBiZWd1bi4KICAgICAqLwogICAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KCgoKCi8qKgogKiBBIHRva2VuIHRoYXQgY2FuIGluY3JlYXNlIGl0cyBzdXBwbHkgYnkgYW5vdGhlciBjb250cmFjdC4KICoKICogVGhpcyBhbGxvd3MgdW5jYXBwZWQgY3Jvd2RzYWxlIGJ5IGR5bmFtaWNhbGx5IGluY3JlYXNpbmcgdGhlIHN1cHBseSB3aGVuIG1vbmV5IHBvdXJzIGluLgogKiBPbmx5IG1pbnQgYWdlbnRzLCBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgb3duZXIsIGNhbiBtaW50IG5ldyB0b2tlbnMuCiAqCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuRXh0IGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAgIHVzaW5nIFNNYXRoTGliIGZvciB1aW50OwoKICAgIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKICAgIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50QWdlbnRzOwoKICAgIGV2ZW50IE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlICApOwoKICAgIC8qKiBpblBlcmNlbnRhZ2VVbml0IGlzIHBlcmNlbnRzIG9mIHRva2VucyBtdWx0aXBsaWVkIHRvIDEwIHVwIHRvIHBlcmNlbnRzIGRlY2ltYWxzLgogICAgKiBGb3IgZXhhbXBsZSwgZm9yIHJlc2VydmVkIHRva2VucyBpbiBwZXJjZW50cyAyLjU0JQogICAgKiBpblBlcmNlbnRhZ2VVbml0ID0gMjU0CiAgICAqIGluUGVyY2VudGFnZURlY2ltYWxzID0gMgogICAgKi8KICAgIHN0cnVjdCBSZXNlcnZlZFRva2Vuc0RhdGEgewogICAgICAgIHVpbnQgaW5Ub2tlbnM7CiAgICAgICAgdWludCBpblBlcmNlbnRhZ2VVbml0OwogICAgICAgIHVpbnQgaW5QZXJjZW50YWdlRGVjaW1hbHM7CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBSZXNlcnZlZFRva2Vuc0RhdGEpIHB1YmxpYyByZXNlcnZlZFRva2Vuc0xpc3Q7CiAgICBhZGRyZXNzW10gcHVibGljIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zOwogICAgdWludCBwdWJsaWMgcmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4gPSAwOwoKICAgIGZ1bmN0aW9uIHNldFJlc2VydmVkVG9rZW5zTGlzdChhZGRyZXNzIGFkZHIsIHVpbnQgaW5Ub2tlbnMsIHVpbnQgaW5QZXJjZW50YWdlVW5pdCwgdWludCBpblBlcmNlbnRhZ2VEZWNpbWFscykgb25seU93bmVyIHsKICAgICAgICByZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9ucy5wdXNoKGFkZHIpOwogICAgICAgIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zTGVuKys7CiAgICAgICAgcmVzZXJ2ZWRUb2tlbnNMaXN0W2FkZHJdID0gUmVzZXJ2ZWRUb2tlbnNEYXRhKHtpblRva2VuczppblRva2VucywgaW5QZXJjZW50YWdlVW5pdDppblBlcmNlbnRhZ2VVbml0LCBpblBlcmNlbnRhZ2VEZWNpbWFsczogaW5QZXJjZW50YWdlRGVjaW1hbHN9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZXNlcnZlZFRva2Vuc0xpc3RWYWxJblRva2VucyhhZGRyZXNzIGFkZHIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5Ub2tlbnMpIHsKICAgICAgICByZXR1cm4gcmVzZXJ2ZWRUb2tlbnNMaXN0W2FkZHJdLmluVG9rZW5zOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJlc2VydmVkVG9rZW5zTGlzdFZhbEluUGVyY2VudGFnZVVuaXQoYWRkcmVzcyBhZGRyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluUGVyY2VudGFnZVVuaXQpIHsKICAgICAgICByZXR1cm4gcmVzZXJ2ZWRUb2tlbnNMaXN0W2FkZHJdLmluUGVyY2VudGFnZVVuaXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZWRUb2tlbnNMaXN0VmFsSW5QZXJjZW50YWdlRGVjaW1hbHMoYWRkcmVzcyBhZGRyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluUGVyY2VudGFnZURlY2ltYWxzKSB7CiAgICAgICAgcmV0dXJuIHJlc2VydmVkVG9rZW5zTGlzdFthZGRyXS5pblBlcmNlbnRhZ2VEZWNpbWFsczsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSZXNlcnZlZFRva2Vuc0xpc3RNdWx0aXBsZShhZGRyZXNzW10gYWRkcnMsIHVpbnRbXSBpblRva2VucywgdWludFtdIGluUGVyY2VudGFnZVVuaXQsIHVpbnRbXSBpblBlcmNlbnRhZ2VEZWNpbWFscykgb25seU93bmVyIHsKICAgICAgICBmb3IgKHVpbnQgaXRlcmF0b3IgPSAwOyBpdGVyYXRvciA8IGFkZHJzLmxlbmd0aDsgaXRlcmF0b3IrKykgewogICAgICAgICAgICBzZXRSZXNlcnZlZFRva2Vuc0xpc3QoYWRkcnNbaXRlcmF0b3JdLCBpblRva2Vuc1tpdGVyYXRvcl0sIGluUGVyY2VudGFnZVVuaXRbaXRlcmF0b3JdLCBpblBlcmNlbnRhZ2VEZWNpbWFsc1tpdGVyYXRvcl0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBuZXcgdG9rZW5zIGFuZCBhbGxvY2F0ZSB0aGVtIHRvIGFuIGFkZHJlc3MuLgogICAgICoKICAgICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAgICovCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBvbmx5TWludEFnZW50IGNhbk1pbnQgcHVibGljIHsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnBsdXMoYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwoKICAgICAgICAvLyBUaGlzIHdpbGwgbWFrZSB0aGUgbWludCB0cmFuc2FjdGlvbiBhcHBlciBpbiBFdGhlclNjYW4uaW8KICAgICAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgYWZ0ZXIgdGhlcmUgaXMgYSBzdGFuZGFyZGl6ZWQgbWludGluZyBldmVudAogICAgICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0TWludEFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHsKICAgICAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICAgICAgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyLCBzdGF0ZSk7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsKICAgICAgICAvLyBPbmx5IGNyb3dkc2FsZSBjb250cmFjdHMgYXJlIGFsbG93ZWQgdG8gbWludCBuZXcgdG9rZW5zCiAgICAgICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLyoqIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IGRvbmUgeWV0LiAqLwogICAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgICAgICBpZihtaW50aW5nRmluaXNoZWQpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9Cn0KLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIEVSQzIwLCBPd25hYmxlIHsKCiAgICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIHVubGlmdCB0aGUgdHJhbnNmZXIgbGltaXRzIG9uIHRoaXMgdG9rZW4gKi8KICAgIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKCiAgICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICAgIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7CgogICAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAgIC8qKgogICAgICogTGltaXQgdG9rZW4gdHJhbnNmZXIgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAgICoKICAgICAqLwogICAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyKSB7CgogICAgICAgIGlmKCFyZWxlYXNlZCkgewogICAgICAgICAgICBpZighdHJhbnNmZXJBZ2VudHNbX3NlbmRlcl0pIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgICAqCiAgICAgKiBEZXNpZ24gY2hvaWNlLiBBbGxvdyByZXNldCB0aGUgcmVsZWFzZSBhZ2VudCB0byBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewoKICAgICAgICAvLyBXZSBkb24ndCBkbyBpbnRlcmZhY2UgY2hlY2sgaGVyZSBhcyB3ZSBtaWdodCB3YW50IHRvIGEgbm9ybWFsIHdhbGxldCBhZGRyZXNzIHRvIGFjdCBhcyBhIHJlbGVhc2UgYWdlbnQKICAgICAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogICAgfQoKICAgIC8qKgogICAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgICAgIHRyYW5zZmVyQWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBPbmUgd2F5IGZ1bmN0aW9uIHRvIHJlbGVhc2UgdGhlIHRva2VucyB0byB0aGUgd2lsZC4KICAgICAqCiAgICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IGlzIHRoZSBmaW5hbCBJQ08gY29udHJhY3QuIEl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gc3VjY2VzcyAoZmlyc3QgbWlsZXN0b25lIHJlYWNoZWQpLgogICAgICovCiAgICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgICAgICByZWxlYXNlZCA9IHRydWU7CiAgICB9CgogICAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VzZCAqLwogICAgbW9kaWZpZXIgaW5SZWxlYXNlU3RhdGUoYm9vbCByZWxlYXNlU3RhdGUpIHsKICAgICAgICBpZihyZWxlYXNlU3RhdGUgIT0gcmVsZWFzZWQpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYSB3aGl0ZWxpc3RlZCByZWxlYXNlIGFnZW50LiAqLwogICAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgICAgICBpZihtc2cuc2VuZGVyICE9IHJlbGVhc2VBZ2VudCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlcigpCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKfQoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCgoKCgpjb250cmFjdCBCdXJuYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIHVzaW5nIFNNYXRoTGliIGZvciB1aW50OwogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvKioKICAgICAqIEBkZXYgQnVybnMgYSBzcGVjaWZpYyBhbW91bnQgb2YgdG9rZW5zLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIGJ1cm5lZC4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgLy8gbm8gbmVlZCB0byByZXF1aXJlIHZhbHVlIDw9IHRvdGFsU3VwcGx5LCBzaW5jZSB0aGF0IHdvdWxkIGltcGx5IHRoZQogICAgICAgIC8vIHNlbmRlcidzIGJhbGFuY2UgaXMgZ3JlYXRlciB0aGFuIHRoZSB0b3RhbFN1cHBseSwgd2hpY2ggKnNob3VsZCogYmUgYW4gYXNzZXJ0aW9uIGZhaWx1cmUKCiAgICAgICAgYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGJhbGFuY2VzW2J1cm5lcl0gPSBiYWxhbmNlc1tidXJuZXJdLm1pbnVzKF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5taW51cyhfdmFsdWUpOwogICAgICAgIEJ1cm4oYnVybmVyLCBfdmFsdWUpOwogICAgfQp9CgoKCgovKioKICogQSBjcm93ZHNhbGVkIHRva2VuLgogKgogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLgogKgogKiAtIFRoZSB0b2tlbiB0cmFuc2ZlcigpIGlzIGRpc2FibGVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3ZlcgogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0CiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggYXBwcm92ZSgpIG1lY2hhbmlzbQogKiAtIFRoZSB0b2tlbiBjYW4gYmUgY2FwcGVkIChzdXBwbHkgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvcikgb3IgdW5jYXBwZWQgKGNyb3dkc2FsZSBjb250cmFjdCBjYW4gbWludCBuZXcgdG9rZW5zKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW5FeHQgaXMgUmVsZWFzYWJsZVRva2VuLCBNaW50YWJsZVRva2VuRXh0LCBCdXJuYWJsZVRva2VuLCBVcGdyYWRlYWJsZVRva2VuIHsKCiAgICAvKiogTmFtZSBhbmQgc3ltYm9sIHdlcmUgdXBkYXRlZC4gKi8KICAgIGV2ZW50IFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBuZXdOYW1lLCBzdHJpbmcgbmV3U3ltYm9sKTsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CgogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogICAgdWludCBwdWJsaWMgZGVjaW1hbHM7CgogICAgLyogTWluaW11bSBhbW1vdW50IG9mIHRva2VucyBldmVyeSBidXllciBjYW4gYnV5LiAqLwogICAgdWludCBwdWJsaWMgbWluQ2FwOwoKCiAgICAvKioKICAgICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uCiAgICAgKgogICAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAgICoKICAgICAqIEBwYXJhbSBfbmFtZSBUb2tlbiBuYW1lCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBUb2tlbiBzeW1ib2wgLSBzaG91bGQgYmUgYWxsIGNhcHMKICAgICAqIEBwYXJhbSBfaW5pdGlhbFN1cHBseSBIb3cgbWFueSB0b2tlbnMgd2Ugc3RhcnQgd2l0aAogICAgICogQHBhcmFtIF9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgICAqIEBwYXJhbSBfbWludGFibGUgQXJlIG5ldyB0b2tlbnMgY3JlYXRlZCBvdmVyIHRoZSBjcm93ZHNhbGUgb3IgZG8gd2UgZGlzdHJpYnV0ZSBvbmx5IHRoZSBpbml0aWFsIHN1cHBseT8gTm90ZSB0aGF0IHdoZW4gdGhlIHRva2VuIGJlY29tZXMgdHJhbnNmZXJhYmxlIHRoZSBtaW50aW5nIGFsd2F5cyBlbmRzLgogICAgICovCiAgICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbkV4dChzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscywgYm9vbCBfbWludGFibGUsIHVpbnQgX2dsb2JhbE1pbkNhcCkKICAgIFVwZ3JhZGVhYmxlVG9rZW4obXNnLnNlbmRlcikgewoKICAgICAgICAvLyBDcmVhdGUgYW55IGFkZHJlc3MsIGNhbiBiZSB0cmFuc2ZlcnJlZAogICAgICAgIC8vIHRvIHRlYW0gbXVsdGlzaWcgdmlhIGNoYW5nZU93bmVyKCksCiAgICAgICAgLy8gYWxzbyByZW1lbWJlciB0byBjYWxsIHNldFVwZ3JhZGVNYXN0ZXIoKQogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CgogICAgICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CgogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwoKICAgICAgICBtaW5DYXAgPSBfZ2xvYmFsTWluQ2FwOwoKICAgICAgICAvLyBDcmVhdGUgaW5pdGlhbGx5IGFsbCBiYWxhbmNlIG9uIHRoZSB0ZWFtIG11bHRpc2lnCiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHk7CgogICAgICAgIGlmKHRvdGFsU3VwcGx5ID4gMCkgewogICAgICAgICAgICBNaW50ZWQob3duZXIsIHRvdGFsU3VwcGx5KTsKICAgICAgICB9CgogICAgICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgICAgIGlmKCFfbWludGFibGUpIHsKICAgICAgICAgICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgaWYodG90YWxTdXBwbHkgPT0gMCkgewogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vIENhbm5vdCBjcmVhdGUgYSB0b2tlbiB3aXRob3V0IHN1cHBseSBhbmQgbm8gbWludGluZwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIGVuZm9yY2Ugbm8gbmV3IHRva2VucyBjYW4gYmUgY3JlYXRlZC4KICAgICAqLwogICAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICAgICAgc3VwZXIucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVwZ3JhZGUgYWdlbnQgZnVuY3Rpb25hbGl0eSBraWNrIGluIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSB3YXMgc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gcmVsZWFzZWQgJiYgc3VwZXIuY2FuVXBncmFkZSgpOwogICAgfQoKICAgIC8qKgogICAgICogT3duZXIgY2FuIHVwZGF0ZSB0b2tlbiBpbmZvcm1hdGlvbiBoZXJlLgogICAgICoKICAgICAqIEl0IGlzIG9mdGVuIHVzZWZ1bCB0byBjb25jZWFsIHRoZSBhY3R1YWwgdG9rZW4gYXNzb2NpYXRpb24sIHVudGlsCiAgICAgKiB0aGUgdG9rZW4gb3BlcmF0aW9ucywgbGlrZSBjZW50cmFsIGlzc3VhbmNlIG9yIHJlaXNzdWFuY2UgaGF2ZSBiZWVuIGNvbXBsZXRlZC4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGFsbG93cyB0aGUgdG9rZW4gb3duZXIgdG8gcmVuYW1lIHRoZSB0b2tlbiBhZnRlciB0aGUgb3BlcmF0aW9ucwogICAgICogaGF2ZSBiZWVuIGNvbXBsZXRlZCBhbmQgdGhlbiBwb2ludCB0aGUgYXVkaWVuY2UgdG8gdXNlIHRoZSB0b2tlbiBjb250cmFjdC4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0VG9rZW5JbmZvcm1hdGlvbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sKSBvbmx5T3duZXIgewogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgICAgICBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihuYW1lLCBzeW1ib2wpOwogICAgfQoKfQoKCmNvbnRyYWN0IE1qdFRva2VuIGlzIENyb3dkc2FsZVRva2VuRXh0IHsKCiAgICB1aW50IHB1YmxpYyBvd25lcnNQcm9kdWN0Q29tbWlzc2lvbkluUGVyYyA9IDU7CgogICAgdWludCBwdWJsaWMgb3BlcmF0b3JQcm9kdWN0Q29tbWlzc2lvbkluUGVyYyA9IDI1OwoKICAgIGV2ZW50IEluZGVwZW5kZW50U2VsbGVySm9pbmVkKGFkZHJlc3Mgc2VsbGVyV2FsbGV0LCB1aW50IGFtb3VudE9mVG9rZW5zLCBhZGRyZXNzIG9wZXJhdG9yV2FsbGV0KTsKICAgIGV2ZW50IE93bmVyc1Byb2R1Y3RBZGRlZChhZGRyZXNzIG93bmVyc1dhbGxldCwgdWludCBhbW91bnRPZlRva2VucywgYWRkcmVzcyBvcGVyYXRvcldhbGxldCk7CiAgICBldmVudCBPcGVyYXRvclByb2R1Y3RDb21taXNzaW9uQ2hhbmdlZCh1aW50IF92YWx1ZSk7CiAgICBldmVudCBPd25lcnNQcm9kdWN0Q29tbWlzc2lvbkNoYW5nZWQodWludCBfdmFsdWUpOwoKCiAgICBmdW5jdGlvbiBzZXRPcGVyYXRvckNvbW1pc3Npb24odWludCBfdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID49IDApOwogICAgICAgIG9wZXJhdG9yUHJvZHVjdENvbW1pc3Npb25JblBlcmMgPSBfdmFsdWU7CiAgICAgICAgT3BlcmF0b3JQcm9kdWN0Q29tbWlzc2lvbkNoYW5nZWQoX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRPd25lcnNDb21taXNzaW9uKHVpbnQgX3ZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+PSAwKTsKICAgICAgICBvd25lcnNQcm9kdWN0Q29tbWlzc2lvbkluUGVyYyA9IF92YWx1ZTsKICAgICAgICBPd25lcnNQcm9kdWN0Q29tbWlzc2lvbkNoYW5nZWQoX3ZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBNZXRob2QgY2FsbGVkIHdoZW4gbmV3IHNlbGxlciBqb2luZWQgdGhlIHByb2dyYW0KICAgICAqIFRvIGF2b2lkIHZhbHVlIGxvc3QgYWZ0ZXIgZGl2aXNpb24sIGFtb3VudE9mVG9rZW5zIG11c3QgYmUgbXVsdGlwbGUgb2YgMTAwCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluZGVwZW5kZW50U2VsbGVySm9pbmVkKGFkZHJlc3Mgc2VsbGVyV2FsbGV0LCB1aW50IGFtb3VudE9mVG9rZW5zLCBhZGRyZXNzIG9wZXJhdG9yV2FsbGV0KSBwdWJsaWMgb25seU93bmVyIGNhbk1pbnQgewogICAgICAgIHJlcXVpcmUoYW1vdW50T2ZUb2tlbnMgPiAxMDApOwogICAgICAgIHJlcXVpcmUoc2VsbGVyV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUob3BlcmF0b3JXYWxsZXQgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHVpbnQgb3BlcmF0b3JDb21taXNzaW9uID0gYW1vdW50T2ZUb2tlbnMuZGl2aWRlcygxMDApLnRpbWVzKG9wZXJhdG9yUHJvZHVjdENvbW1pc3Npb25JblBlcmMpOwogICAgICAgIHVpbnQgc2VsbGVyQW1vdW50ID0gYW1vdW50T2ZUb2tlbnMubWludXMob3BlcmF0b3JDb21taXNzaW9uKTsKCiAgICAgICAgaWYgKG9wZXJhdG9yQ29tbWlzc2lvbiA+IDApIHsKICAgICAgICAgICAgbWludChvcGVyYXRvcldhbGxldCwgb3BlcmF0b3JDb21taXNzaW9uKTsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxsZXJBbW91bnQgPiAwKSB7CiAgICAgICAgICAgIG1pbnQoc2VsbGVyV2FsbGV0LCBzZWxsZXJBbW91bnQpOwogICAgICAgIH0KICAgICAgICBJbmRlcGVuZGVudFNlbGxlckpvaW5lZChzZWxsZXJXYWxsZXQsIGFtb3VudE9mVG9rZW5zLCBvcGVyYXRvcldhbGxldCk7CiAgICB9CgoKICAgIC8qKgogICAgKiBNZXRob2QgY2FsbGVkIHdoZW4gb3duZXJzIGFkZCB0aGVpciBvd24gcHJvZHVjdAogICAgKiBUbyBhdm9pZCB2YWx1ZSBsb3N0IGFmdGVyIGRpdmlzaW9uLCBhbW91bnRPZlRva2VucyBtdXN0IGJlIG11bHRpcGxlIG9mIDEwMAogICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyc1Byb2R1Y3RBZGRlZChhZGRyZXNzIG93bmVyc1dhbGxldCwgdWludCBhbW91bnRPZlRva2VucywgYWRkcmVzcyBvcGVyYXRvcldhbGxldCkgcHVibGljIG9ubHlPd25lciBjYW5NaW50IHsKICAgICAgICByZXF1aXJlKGFtb3VudE9mVG9rZW5zID4gMTAwKTsKICAgICAgICByZXF1aXJlKG93bmVyc1dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB1aW50IG93bmVyc0NvbWlzc2lvbiA9IGFtb3VudE9mVG9rZW5zLmRpdmlkZXMoMTAwKS50aW1lcyhvd25lcnNQcm9kdWN0Q29tbWlzc2lvbkluUGVyYyk7CiAgICAgICAgdWludCBvcGVyYXRvckFtb3VudCA9IGFtb3VudE9mVG9rZW5zLm1pbnVzKG93bmVyc0NvbWlzc2lvbik7CgoKICAgICAgICBpZiAob3duZXJzQ29taXNzaW9uID4gMCkgewogICAgICAgICAgICBtaW50KG93bmVyc1dhbGxldCwgb3duZXJzQ29taXNzaW9uKTsKICAgICAgICB9CgogICAgICAgIGlmIChvcGVyYXRvckFtb3VudCA+IDApIHsKICAgICAgICAgICAgbWludChvcGVyYXRvcldhbGxldCwgb3BlcmF0b3JBbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgT3duZXJzUHJvZHVjdEFkZGVkKG93bmVyc1dhbGxldCwgYW1vdW50T2ZUb2tlbnMsIG9wZXJhdG9yV2FsbGV0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBNanRUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscywgYm9vbCBfbWludGFibGUsIHVpbnQgX2dsb2JhbE1pbkNhcCkKICAgIENyb3dkc2FsZVRva2VuRXh0KF9uYW1lLCBfc3ltYm9sLCBfaW5pdGlhbFN1cHBseSwgX2RlY2ltYWxzLCBfbWludGFibGUsIF9nbG9iYWxNaW5DYXApIHt9Cgp9CgoKLyoqCiAqCiAqIFRpbWUtbG9ja2VkIHRva2VuIHZhdWx0IG9mIGFsbG9jYXRlZCBmb3VuZGVyIHRva2Vucy4KICoKICogRmlyc3QgdXNlZCBieSBMdW55ciBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cwogKgogKgogKiBTZWUgVG9rZW5WYXVsdCBmb3IgbXVsdGkgdXNlciBpbXBsZW1lbnRhdGlvbi4KICovCmNvbnRyYWN0IFRpbWVWYXVsdCB7CgogICAgLyoqIEludGVyZmFjZSBmbGFnIHRvIGRldGVybWluZSBpZiBhZGRyZXNzIGlzIGZvciBhIHJlYWwgY29udHJhY3Qgb3Igbm90ICovCiAgICBib29sIHB1YmxpYyBpc1RpbWVWYXVsdCA9IHRydWU7CgogICAgLyoqIFRva2VuIHdlIGFyZSBob2xkaW5nICovCiAgICBTdGFuZGFyZFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICAvKiogQWRkcmVzcyB0aGF0IGNhbiBjbGFpbSB0b2tlbnMgKi8KICAgIGFkZHJlc3MgcHVibGljIHRlYW1NdWx0aXNpZzsKCiAgICAvKiogVU5JWCB0aW1lc3RhbXAgd2hlbiB0b2tlbnMgY2FuIGJlIGNsYWltZWQuICovCiAgICB1aW50MjU2IHB1YmxpYyB1bmxvY2tlZEF0OwoKICAgIGV2ZW50IFVubG9ja2VkKCk7CgogICAgZnVuY3Rpb24gVGltZVZhdWx0KGFkZHJlc3MgX3RlYW1NdWx0aXNpZywgU3RhbmRhcmRUb2tlbiBfdG9rZW4sIHVpbnQgX3VubG9ja2VkQXQpIHsKCiAgICAgICAgdGVhbU11bHRpc2lnID0gX3RlYW1NdWx0aXNpZzsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgICAgICB1bmxvY2tlZEF0ID0gX3VubG9ja2VkQXQ7CgogICAgICAgIC8vIFNhbml0eSBjaGVjawogICAgICAgIGlmICh0ZWFtTXVsdGlzaWcgPT0gMHgwKSB0aHJvdzsKICAgICAgICBpZiAoYWRkcmVzcyh0b2tlbikgPT0gMHgwKSB0aHJvdzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkJhbGFuY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5sb2NrKCkgcHVibGljIHsKICAgICAgICAvLyBXYWl0IHlvdXIgdHVybiEKICAgICAgICBpZiAobm93IDwgdW5sb2NrZWRBdCkgdGhyb3c7CgogICAgICAgIC8vIFN0YW5kYXJkVG9rZW4gd2lsbCB0aHJvdyBpbiB0aGUgY2FzZSBvZiB0cmFuc2FjdGlvbiBmYWlscwogICAgICAgIHRva2VuLnRyYW5zZmVyKHRlYW1NdWx0aXNpZywgZ2V0VG9rZW5CYWxhbmNlKCkpOwoKICAgICAgICBVbmxvY2tlZCgpOwogICAgfQoKICAgIC8vIGRpc2FsbG93IEVUSCBwYXltZW50IGZvciB0aGlzIHZhdWx0CiAgICBmdW5jdGlvbiAoKSB7IHRocm93OyB9Cgp9'.
	

]
