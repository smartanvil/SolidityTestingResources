Class {
	#name : #SRTa679f6a1db126f60ba1ed876d5235a63583c67be,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa679f6a1db126f60ba1ed876d5235a63583c67be >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFdhbGxldCBHZXR0ZXIgTGlicmFyeQogKiBAYXV0aG9yIE1vZHVsYXIubmV0d29yawogKgogKiB2ZXJzaW9uIDEuMS4wCiAqIENvcHlyaWdodCAoYykgMjAxNyBNb2R1bGFyLCBMTEMKICogVGhlIE1JVCBMaWNlbnNlIChNSVQpCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9Nb2R1bGFyLW5ldHdvcmsvZXRoZXJldW0tbGlicmFyaWVzL2Jsb2IvbWFzdGVyL0xJQ0VOU0UKICoKICogVGhlIFdhbGxldCBMaWJyYXJ5IGZhbWlseSBpcyBpbnNwaXJlZCBieSB0aGUgbXVsdGlzaWcgd2FsbGV0cyBidWlsdCBieSBDb25zZW5zeXMKICogYXQgaHR0cHM6Ly9naXRodWIuY29tL0NvbnNlblN5cy9NdWx0aVNpZ1dhbGxldCBhbmQgUGFyaXR5IGF0CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXJpdHl0ZWNoL2NvbnRyYWN0cy9ibG9iL21hc3Rlci9XYWxsZXQuc29sIHdpdGggYWRkZWQKICogZnVuY3Rpb25hbGl0eS4gTW9kdWxhciB3b3JrcyBvbiBvcGVuIHNvdXJjZSBwcm9qZWN0cyBpbiB0aGUgRXRoZXJldW0KICogY29tbXVuaXR5IHdpdGggdGhlIHB1cnBvc2Ugb2YgdGVzdGluZywgZG9jdW1lbnRpbmcsIGFuZCBkZXBsb3lpbmcgcmV1c2FibGUKICogY29kZSBvbnRvIHRoZSBibG9ja2NoYWluIHRvIGltcHJvdmUgc2VjdXJpdHkgYW5kIHVzYWJpbGl0eSBvZiBzbWFydCBjb250cmFjdHMuCiAqIE1vZHVsYXIgYWxzbyBzdHJpdmVzIHRvIGVkdWNhdGUgbm9uLXByb2ZpdHMsIHNjaG9vbHMsIGFuZCBvdGhlciBjb21tdW5pdHkKICogbWVtYmVycyBhYm91dCB0aGUgYXBwbGljYXRpb24gb2YgYmxvY2tjaGFpbiB0ZWNobm9sb2d5LiBGb3IgZnVydGhlcgogKiBpbmZvcm1hdGlvbjogbW9kdWxhci5uZXR3b3JrLCBjb25zZW5zeXMubmV0LCBwYXJpdHl0ZWNoLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpsaWJyYXJ5IFdhbGxldEdldHRlckxpYiB7CgogIC8qR2V0dGVyIEZ1bmN0aW9ucyovCgogIC8vLyBAZGV2IEdldCBsaXN0IG9mIHdhbGxldCBvd25lcnMsIHdpbGwgcmV0dXJuIGZpeGVkIDUwIHVudGlsIGZvcmsKICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHJldHVybiBhZGRyZXNzWzUxXSBSZXR1cm5zIGVudGlyZSA1MSBvd25lciBzbG90cwogIGZ1bmN0aW9uIGdldE93bmVycyhXYWxsZXRNYWluTGliLldhbGxldERhdGEgc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzWzUxXSkgewogICAgYWRkcmVzc1s1MV0gbWVtb3J5IG87CiAgICBmb3IodWludDI1NiBpID0gMDsgaTxzZWxmLm93bmVycy5sZW5ndGg7IGkrKyl7CiAgICAgIG9baV0gPSBzZWxmLm93bmVyc1tpXTsKICAgIH0KICAgIHJldHVybiBvOwogIH0KCiAgLy8vIEBkZXYgR2V0IGluZGV4IG9mIGFuIG93bmVyCiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiBvd25lcgogIC8vLyBAcmV0dXJuIHVpbnQyNTYgSW5kZXggb2YgdGhlIG93bmVyCiAgZnVuY3Rpb24gZ2V0T3duZXJJbmRleChXYWxsZXRNYWluTGliLldhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYub3duZXJJbmRleFtfb3duZXJdOwogIH0KCiAgLy8vIEBkZXYgR2V0IG1heCBudW1iZXIgb2Ygd2FsbGV0IG93bmVycwogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcmV0dXJuIHVpbnQyNTYgTWF4aW11bSBudW1iZXIgb2Ygb3duZXJzCiAgZnVuY3Rpb24gZ2V0TWF4T3duZXJzKFdhbGxldE1haW5MaWIuV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLm1heE93bmVyczsKICB9CgogIC8vLyBAZGV2IEdldCBudW1iZXIgb2Ygd2FsbGV0IG93bmVycwogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcmV0dXJuIHVpbnQyNTYgTnVtYmVyIG9mIG93bmVycwogIGZ1bmN0aW9uIGdldE93bmVyQ291bnQoV2FsbGV0TWFpbkxpYi5XYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYub3duZXJzLmxlbmd0aCAtIDE7CiAgfQoKICAvLy8gQGRldiBHZXQgc2lnIHJlcXVpcmVtZW50cyBmb3IgYWRtaW5pc3RyYXRpdmUgY2hhbmdlcwogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcmV0dXJuIHVpbnQyNTYgTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQKICBmdW5jdGlvbiBnZXRSZXF1aXJlZEFkbWluKFdhbGxldE1haW5MaWIuV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLnJlcXVpcmVkQWRtaW47CiAgfQoKICAvLy8gQGRldiBHZXQgc2lnIHJlcXVpcmVtZW50cyBmb3IgbWlub3IgdHggc3BlbmRzCiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEByZXR1cm4gdWludDI1NiBOdW1iZXIgb2Ygc2lncyByZXF1aXJlZAogIGZ1bmN0aW9uIGdldFJlcXVpcmVkTWlub3IoV2FsbGV0TWFpbkxpYi5XYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYucmVxdWlyZWRNaW5vcjsKICB9CgogIC8vLyBAZGV2IEdldCBzaWcgcmVxdWlyZW1lbnRzIGZvciBtYWpvciB0eCBzcGVuZHMKICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHJldHVybiB1aW50MjU2IE51bWJlciBvZiBzaWdzIHJlcXVpcmVkCiAgZnVuY3Rpb24gZ2V0UmVxdWlyZWRNYWpvcihXYWxsZXRNYWluTGliLldhbGxldERhdGEgc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2VsZi5yZXF1aXJlZE1ham9yOwogIH0KCiAgLy8vIEBkZXYgR2V0IGN1cnJlbnQgZGF5IHNwZW5kIGZvciB0b2tlbgogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcGFyYW0gX3Rva2VuIEFkZHJlc3Mgb2YgdG9rZW4sIDAgZm9yIGV0aGVyCiAgLy8vIEByZXR1cm4gdWludDI1NlsyXSAwLWluZGV4IGlzIGRheSB0aW1lc3RhbXAsIDEtaW5kZXggaXMgdGhlIGRheSBzcGVuZAogIGZ1bmN0aW9uIGdldEN1cnJlbnRTcGVuZChXYWxsZXRNYWluTGliLldhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF90b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NlsyXSkgewogICAgdWludDI1NlsyXSBtZW1vcnkgY3M7CiAgICBjc1swXSA9IHNlbGYuY3VycmVudFNwZW5kW190b2tlbl1bMF07CiAgICBjc1sxXSA9IHNlbGYuY3VycmVudFNwZW5kW190b2tlbl1bMV07CiAgICByZXR1cm4gY3M7CiAgfQoKICAvLy8gQGRldiBHZXQgbWFqb3IgdHggdGhyZXNob2xkIHBlciB0b2tlbgogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcGFyYW0gX3Rva2VuIEFkZHJlc3Mgb2YgdG9rZW4sIDAgZm9yIGV0aGVyCiAgLy8vIEByZXR1cm4gdWludDI1NiBUaHJlc2hvbGQgYW1vdW50CiAgZnVuY3Rpb24gZ2V0TWFqb3JUaHJlc2hvbGQoV2FsbGV0TWFpbkxpYi5XYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLm1ham9yVGhyZXNob2xkW190b2tlbl07CiAgfQoKICAvLy8gQGRldiBHZXQgdGhlIG51bWJlciBvZiB0eCdzIHdpdGggdGhlIHNhbWUgaWQKICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9pZCBJRCBvZiB0cmFuc2FjdGlvbnMgcmVxdWVzdGVkCiAgLy8vIEByZXR1cm4gdWludDI1NiBOdW1iZXIgb2YgdHgncyB3aXRoIHNhbWUgSUQKICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkxlbmd0aChXYWxsZXRNYWluTGliLldhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9pZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF0ubGVuZ3RoOwogIH0KCiAgLy8vIEBkZXYgR2V0IGxpc3Qgb2YgY29uZmlybWF0aW9ucyBmb3IgYSB0eCwgdXNlIGdldFRyYW5zYWN0aW9uTGVuZ3RoIHRvIGdldCBsYXRlc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfaWQgSUQgb2YgdHJhbnNhY3Rpb24gcmVxdWVzdGVkCiAgLy8vIEBwYXJhbSBfdHhJbmRleCBUaGUgdHJhbnNhY3Rpb24gaW5kZXggbnVtYmVyCiAgLy8vIEByZXR1cm4gdWludDI1Nls1MF0gUmV0dXJucyBsaXN0IG9mIGNvbmZpcm1hdGlvbnMsIGZpeGVkIGF0IDUwIHVudGlsIGZvcmsKICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkNvbmZpcm1zKFdhbGxldE1haW5MaWIuV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlczMyIF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3R4SW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2WzUwXSkKICB7CiAgICB1aW50MjU2WzUwXSBtZW1vcnkgdGM7CiAgICBmb3IodWludDI1NiBpID0gMDsgaTxzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtZWRPd25lcnMubGVuZ3RoOyBpKyspewogICAgICB0Y1tpXSA9IHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1lZE93bmVyc1tpXTsKICAgIH0KICAgIHJldHVybiB0YzsKICB9CgogIC8vLyBAZGV2IFJldHJpZXZlIHR4IGNvbmZpcm1hdGlvbiBjb3VudAogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcGFyYW0gX2lkIElEIG9mIHRyYW5zYWN0aW9uIHJlcXVlc3RlZAogIC8vLyBAcGFyYW0gX3R4SW5kZXggVGhlIHRyYW5zYWN0aW9uIGluZGV4IG51bWJlcgogIC8vLyBAcmV0dXJuIHVpbnQyNTYgUmV0dXJucyB0aGUgY3VycmVudCBudW1iZXIgb2YgdHggY29uZmlybWF0aW9ucwogIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQ29uZmlybUNvdW50KFdhbGxldE1haW5MaWIuV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF90eEluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmV0dXJuIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudDsKICB9CgogIC8vLyBAZGV2IFJldHJpZXZlIGlmIHRyYW5zYWN0aW9uIHdhcyBzdWNjZXNzZnVsCiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfaWQgSUQgb2YgdHJhbnNhY3Rpb24gcmVxdWVzdGVkCiAgLy8vIEBwYXJhbSBfdHhJbmRleCBUaGUgdHJhbnNhY3Rpb24gaW5kZXggbnVtYmVyCiAgLy8vIEByZXR1cm4gYm9vbCBSZXR1cm5zIHRydWUgaWYgdHggc3VjY2Vzc2Z1bGx5IGV4ZWN1dGVkLCBmYWxzZSBvdGhlcndpc2UKICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvblN1Y2Nlc3MoV2FsbGV0TWFpbkxpYi5XYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiBfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3R4SW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLnN1Y2Nlc3M7CiAgfQp9CgpsaWJyYXJ5IFdhbGxldE1haW5MaWIgewogIHVzaW5nIEFycmF5MjU2TGliIGZvciB1aW50MjU2W107CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgV2FsbGV0RGF0YSB7CiAgICB1aW50MjU2IG1heE93bmVyczsgLy9NYXhpbXVtIHdhbGxldCBvd25lcnMsIHNob3VsZCBiZSA1MAogICAgYWRkcmVzc1tdIG93bmVyczsgLy9BcnJheSBvZiBhbGwgb3duZXJzCiAgICB1aW50MjU2IHJlcXVpcmVkQWRtaW47IC8vTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgZm9yIGFkbWluaXN0cmF0aXZlIGNoYW5nZXMKICAgIHVpbnQyNTYgcmVxdWlyZWRNYWpvcjsgLy9OdW1iZXIgb2Ygc2lncyByZXF1aXJlZCBmb3IgbWFqb3IgdHJhbnNhY3Rpb25zCiAgICB1aW50MjU2IHJlcXVpcmVkTWlub3I7IC8vTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgZm9yIG1pbm9yIHRyYW5zYWN0aW9ucwoKICAgIC8vIFRoZSBhbW91bnQgb2YgYSB0b2tlbiBzcGVudCBwZXIgZGF5LCBldGhlciBpcyBhdCBhZGRyZXNzIG1hcHBpbmcgMCwKICAgIC8vIGFsbCBvdGhlciB0b2tlbnMgZGVmaW5lZCBieSBhZGRyZXNzLiB1aW50MjU2WzBdIGNvcnJlc3BvbmRzIHRvIHRoZSBjdXJyZW50CiAgICAvLyBkYXksICB1aW50MjU2WzFdIGlzIHRoZSBzcGVuZCBhbW91bnQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NlsyXSkgY3VycmVudFNwZW5kOwogICAgLy9UaGUgZGF5IHNwZW5kIHRocmVzaG9sZCBmb3IgdHJhbnNhY3Rpb25zIHRvIGJlIG1ham9yLCBldGhlciBhdCAwLCBhbGwgb3RoZXJzIGJ5IGFkZHJlc3MKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgbWFqb3JUaHJlc2hvbGQ7CiAgICAvL0FycmF5IG9mIHRyYW5zYWN0aW9ucyBwZXIgZGF5LCB1aW50MjU2IGlzIHRoZSBkYXkgdGltZXN0YW1wLCBieXRlczMyIGlzIHRoZSB0cmFuc2FjdGlvbiBpZAogICAgbWFwcGluZyAodWludDI1NiA9PiBieXRlczMyW10pIHRyYW5zYWN0aW9uczsKICAgIC8vVHJhY2tzIHRoZSBpbmRleCBvZiBlYWNoIG93bmVyIGluIHRoZSBvd25lcnMgQXJyYXkKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgb3duZXJJbmRleDsKICAgIC8vQXJyYXkgb2YgVHJhbnNhY3Rpb24ncyBieSBpZCwgbmV3IHR4J3Mgd2l0aCBleGFjdCBpbnB1dHMgYXMgcHJldmlvdXMgdHggd2lsbCBhZGQgdG8gYXJyYXkKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gVHJhbnNhY3Rpb25bXSkgdHJhbnNhY3Rpb25JbmZvOwoKICB9CgogIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICB1aW50MjU2IGRheTsgLy9UaW1lc3RhbXAgb2YgdGhlIGRheSBpbml0aWFsaXplZAogICAgdWludDI1NiB2YWx1ZTsgLy9BbW91bnQgb2YgZXRoZXIgYmVpbmcgc2VudAogICAgYWRkcmVzcyB0b2tlbkFkcmVzczsgLy9BZGRyZXNzIG9mIHRva2VuIHRyYW5zZmVycmVkCiAgICB1aW50MjU2IGFtb3VudDsgLy9BbW91bnQgb2YgdG9rZW5zIHRyYW5zZmVycmVkCiAgICBieXRlcyBkYXRhOyAvL1RlbXAgbG9jYXRpb24gZm9yIHBlbmRpbmcgdHJhbnNhY3Rpb25zLCBlcmFzZWQgYWZ0ZXIgZmluYWwgY29uZmlybWF0aW9uCiAgICB1aW50MjU2W10gY29uZmlybWVkT3duZXJzOyAvL0FycmF5IG9mIG93bmVycyBjb25maXJtaW5nIHRyYW5zYWN0aW9uCiAgICB1aW50MjU2IGNvbmZpcm1Db3VudDsgLy9UcmFja3MgdGhlIG51bWJlciBvZiBjb25maXJtcwogICAgdWludDI1NiBjb25maXJtUmVxdWlyZWQ7IC8vTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgZm9yIHRoaXMgdHJhbnNhY3Rpb24KICAgIGJvb2wgc3VjY2VzczsgLy9UcnVlIGFmdGVyIGZpbmFsIGNvbmZpcm1hdGlvbgogIH0KCiAgLypFdmVudHMqLwogIGV2ZW50IExvZ1Jldm9rZU5vdGljZShieXRlczMyIHR4aWQsIGFkZHJlc3Mgc2VuZGVyLCB1aW50MjU2IGNvbmZpcm1zTmVlZGVkKTsKICBldmVudCBMb2dUcmFuc2FjdGlvbkZhaWxlZChieXRlczMyIHR4aWQsIGFkZHJlc3Mgc2VuZGVyKTsKICBldmVudCBMb2dUcmFuc2FjdGlvbkNvbmZpcm1lZChieXRlczMyIHR4aWQsIGFkZHJlc3Mgc2VuZGVyLCB1aW50MjU2IGNvbmZpcm1zTmVlZGVkKTsKICBldmVudCBMb2dUcmFuc2FjdGlvbkNvbXBsZXRlKGJ5dGVzMzIgdHhpZCwgYWRkcmVzcyB0YXJnZXQsIHVpbnQyNTYgdmFsdWUsIGJ5dGVzIGRhdGEpOwogIGV2ZW50IExvZ0NvbnRyYWN0Q3JlYXRlZChhZGRyZXNzIG5ld0NvbnRyYWN0LCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBMb2dFcnJvck1zZyh1aW50MjU2IGFtb3VudCwgc3RyaW5nIG1zZyk7CgogIC8vLyBAZGV2IENvbnN0cnVjdG9yCiAgLy8vIEBwYXJhbSBzZWxmIFRoZSB3YWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcGFyYW0gX293bmVycyBBcnJheSBvZiBpbml0aWFsIG93bmVycwogIC8vLyBAcGFyYW0gX3JlcXVpcmVkQWRtaW4gU2V0IG51bWJlciBvZiBzaWdzIGZvciBhZG1pbmlzdHJhdGl2ZSB0YXNrcwogIC8vLyBAcGFyYW0gX3JlcXVpcmVkTWFqb3IgU2V0IG51bWJlciBvZiBzaWdzIGZvciBtYWpvciB0eAogIC8vLyBAcGFyYW0gX3JlcXVpcmVkTWlub3IgU2V0IG51bWJlciBvZiBzaWdzIGZvciBtaW5vciB0eAogIC8vLyBAcGFyYW0gX21ham9yVGhyZXNob2xkIFNldCBtYWpvciB0eCB0aHJlc2hvbGQgYW1vdW50IGZvciBldGhlcgogIC8vLyBAcmV0dXJuIFdpbGwgcmV0dXJuIHRydWUgd2hlbiBjb21wbGV0ZQogIGZ1bmN0aW9uIGluaXQoV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzW10gX293bmVycywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX3JlcXVpcmVkQWRtaW4sCiAgICAgICAgICAgICAgICB1aW50MjU2IF9yZXF1aXJlZE1ham9yLAogICAgICAgICAgICAgICAgdWludDI1NiBfcmVxdWlyZWRNaW5vciwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX21ham9yVGhyZXNob2xkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKHNlbGYub3duZXJzLmxlbmd0aCA9PSAwKTsKICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPj0gX3JlcXVpcmVkQWRtaW4gJiYgX3JlcXVpcmVkQWRtaW4gPiAwKTsKICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPj0gX3JlcXVpcmVkTWFqb3IgJiYgX3JlcXVpcmVkTWFqb3IgPiAwKTsKICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPj0gX3JlcXVpcmVkTWlub3IgJiYgX3JlcXVpcmVkTWlub3IgPiAwKTsKICAgIHNlbGYub3duZXJzLnB1c2goMCk7IC8vTGVhdmUgaW5kZXgtMCBlbXB0eSBmb3IgZWFzaWVyIG93bmVyIGNoZWNrcwoKICAgIGZvciAodWludDI1NiBpPTA7IGk8X293bmVycy5sZW5ndGg7IGkrKykgewogICAgICByZXF1aXJlKF9vd25lcnNbaV0gIT0gMCk7CiAgICAgIHNlbGYub3duZXJzLnB1c2goX293bmVyc1tpXSk7CiAgICAgIHNlbGYub3duZXJJbmRleFtfb3duZXJzW2ldXSA9IGkrMTsKICAgIH0KICAgIHNlbGYucmVxdWlyZWRBZG1pbiA9IF9yZXF1aXJlZEFkbWluOwogICAgc2VsZi5yZXF1aXJlZE1ham9yID0gX3JlcXVpcmVkTWFqb3I7CiAgICBzZWxmLnJlcXVpcmVkTWlub3IgPSBfcmVxdWlyZWRNaW5vcjsKICAgIHNlbGYubWF4T3duZXJzID0gNTA7IC8vTGltaXRzIHRvIDUwIG93bmVycywgc2hvdWxkIGNyZWF0ZSB3YWxsZXQgcG9vbHMgZm9yIG1vcmUgb3duZXJzCiAgICBzZWxmLm1ham9yVGhyZXNob2xkWzBdID0gX21ham9yVGhyZXNob2xkOyAvL1NldHMgZXRoZXIgdGhyZXNob2xkIGF0IGFkZHJlc3MgMAoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLypDaGVja3MqLwoKICAvLy8gQGRldiBWZXJpZmllcyBhIGNvbmZpcm1pbmcgb3duZXIgaGFzIG5vdCBjb25maXJtZWQgYWxyZWFkeQogIC8vLyBAcGFyYW0gc2VsZiBDb250cmFjdCB3YWxsZXQgaW4gc3RvcmFnZQogIC8vLyBAcGFyYW0gX2lkIElEIG9mIHRoZSB0eCBiZWluZyBjaGVja2VkCiAgLy8vIEBwYXJhbSBfdHhJbmRleCBJbmRleCBudW1iZXIgb2YgdGhpcyB0eAogIC8vLyBAcmV0dXJuIFJldHVybnMgdHJ1ZSBpZiBjaGVjayBwYXNzZXMsIGZhbHNlIG90aGVyd2lzZQogIGZ1bmN0aW9uIGNoZWNrTm90Q29uZmlybWVkKFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9pZCwgdWludDI1NiBfdHhJbmRleCkKICAgICAgICAgICBwdWJsaWMgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKHNlbGYub3duZXJJbmRleFttc2cuc2VuZGVyXSA+IDApOwogICAgdWludDI1NiBfdHhMZW4gPSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdLmxlbmd0aDsKCiAgICBpZihfdHhMZW4gPT0gMCB8fCBfdHhJbmRleCA+PSBfdHhMZW4pewogICAgICBMb2dFcnJvck1zZyhfdHhMZW4sICJUeCBub3QgaW5pdGlhdGVkIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZihzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5zdWNjZXNzKXsKICAgICAgTG9nRXJyb3JNc2coX3R4SW5kZXgsICJUcmFuc2FjdGlvbiBhbHJlYWR5IGNvbXBsZXRlIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvL0Z1bmN0aW9uIGZyb20gTW9kdWxhci5pbyBhcnJheSB1dGlsaXR5IGxpYnJhcnkKICAgIGJvb2wgZm91bmQ7CiAgICB1aW50MjU2IGluZGV4OwogICAgKGZvdW5kLCBpbmRleCkgPSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtZWRPd25lcnMuaW5kZXhPZih1aW50MjU2KG1zZy5zZW5kZXIpLCBmYWxzZSk7CiAgICBpZihmb3VuZCl7CiAgICAgIExvZ0Vycm9yTXNnKGluZGV4LCAiT3duZXIgYWxyZWFkeSBjb25maXJtZWQiKTsKICAgICAgTG9nVHJhbnNhY3Rpb25GYWlsZWQoX2lkLCBtc2cuc2VuZGVyKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLypVdGlsaXR5IEZ1bmN0aW9ucyovCgogIC8vLyBAZGV2IFVzZWQgbGF0ZXIgdG8gY2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQgZm9yIHR4CiAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQKICAvLy8gQHBhcmFtIF9jb3VudCBDdXJyZW50IG51bWJlciBvZiBzaWdzCiAgZnVuY3Rpb24gY2FsY0NvbmZpcm1zTmVlZGVkKHVpbnQyNTYgX3JlcXVpcmVkLCB1aW50MjU2IF9jb3VudCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDI1Nil7CiAgICByZXR1cm4gX3JlcXVpcmVkIC0gX2NvdW50OwogIH0KCiAgLy8vIEBkZXYgVXNlZCB0byBjaGVjayBpZiB0eCBpcyBtb3ZpbmcgdG9rZW5zIGFuZCBwYXJzZXMgYW1vdW50CiAgLy8vIEBwYXJhbSBfdHhEYXRhIERhdGEgZm9yIHByb3Bvc2VkIHR4CiAgLy8vIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRyYW5zYWN0aW9uIGlzIG1vdmluZyB0b2tlbnMKICAvLy8gQHJldHVybiB1aW50MjU2IEFtb3VudCBvZiB0b2tlbnMgaW52b2x2ZWQsIDAgaWYgbm90IHNwZW5kaW5nIHR4CiAgZnVuY3Rpb24gZ2V0QW1vdW50KGJ5dGVzIF90eERhdGEpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wsdWludDI1NikgewogICAgYnl0ZXMzMiBnZXRTaWc7CiAgICBieXRlczQgc2lnOwogICAgYnl0ZXM0IHRTaWcgPSAweGE5MDU5Y2JiOyAvL3RyYW5zZmVyIGZ1bmMgc2lnbmF0dXJlCiAgICBieXRlczQgYVNpZyA9IDB4MDk1ZWE3YjM7IC8vYXBwcm92ZSBmdW5jIHNpZ25hdHVyZQogICAgYnl0ZXM0IHRmU2lnID0gMHgyM2I4NzJkZDsgLy90cmFuc2ZlckZyb20gZnVuYyBzaWduYXR1cmUKICAgIGJvb2wgdHJhbnNmZXI7CiAgICBieXRlczMyIF9hbW91bnREYXRhOwogICAgdWludDI1NiBfYW1vdW50OwoKICAgIGFzc2VtYmx5IHsgZ2V0U2lnIDo9IG1sb2FkKGFkZChfdHhEYXRhLDB4MjApKSB9CiAgICBzaWcgPSBieXRlczQoZ2V0U2lnKTsKICAgIGlmKHNpZyA9PSAgdFNpZyB8fCBzaWcgPT0gYVNpZyl7CiAgICAgIHRyYW5zZmVyID0gdHJ1ZTsKICAgICAgYXNzZW1ibHkgeyBfYW1vdW50RGF0YSA6PSBtbG9hZChhZGQoX3R4RGF0YSwweDQ0KSkgfQogICAgICBfYW1vdW50ID0gdWludDI1NihfYW1vdW50RGF0YSk7CiAgICB9IGVsc2UgaWYoc2lnID09IHRmU2lnKXsKICAgICAgdHJhbnNmZXIgPSB0cnVlOwogICAgICBhc3NlbWJseSB7IF9hbW91bnREYXRhIDo9IG1sb2FkKGFkZChfdHhEYXRhLDB4NjQpKSB9CiAgICAgIF9hbW91bnQgPSB1aW50MjU2KF9hbW91bnREYXRhKTsKICAgIH0KICAgIHJldHVybiAodHJhbnNmZXIsX2Ftb3VudCk7CiAgfQoKICAvLy8gQGRldiBSZXRyaWV2ZXMgc2lnIHJlcXVpcmVtZW50IGZvciBzcGVuZGluZyB0eAogIC8vLyBAcGFyYW0gc2VsZiBDb250cmFjdCB3YWxsZXQgaW4gc3RvcmFnZQogIC8vLyBAcGFyYW0gX3RvIFRhcmdldCBhZGRyZXNzIG9mIHRyYW5zYWN0aW9uCiAgLy8vIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIGV0aGVyIHNwZW5kCiAgLy8vIEBwYXJhbSBfaXNUcmFuc2ZlciBUcnVlIGlmIHRyYW5zZmVycmluZyBvdGhlciB0b2tlbnMsIGZhbHNlIG90aGVyd2lzZQogIC8vLyBAcGFyYW0gX2Ftb3VudCBBbW91bnQgb2YgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkLCAwIGlmIG5vdCBhIHRyYW5zZmVyIHR4CiAgLy8vIEByZXR1cm4gdWludDI1NiBUaGUgcmVxdWlyZWQgc2lncyBmb3IgdHgKICBmdW5jdGlvbiBnZXRSZXF1aXJlZChXYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF92YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICBib29sIF9pc1RyYW5zZmVyLAogICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgcmV0dXJucyAodWludDI1NikKICB7CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgcmVzOwogICAgYm9vbCBtYWpvciA9IHRydWU7CiAgICAvL1Jlc2V0IHNwZW5kIGlmIHRoaXMgaXMgZmlyc3QgY2hlY2sgb2YgdGhlIGRheQogICAgaWYoKG5vdyAvIDEgZGF5cykgPiBzZWxmLmN1cnJlbnRTcGVuZFswXVswXSl7CiAgICAgIHNlbGYuY3VycmVudFNwZW5kWzBdWzBdID0gbm93IC8gMSBkYXlzOwogICAgICBzZWxmLmN1cnJlbnRTcGVuZFswXVsxXSA9IDA7CiAgICB9CgogICAgKGVyciwgcmVzKSA9IHNlbGYuY3VycmVudFNwZW5kWzBdWzFdLnBsdXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgaWYocmVzIDwgc2VsZi5tYWpvclRocmVzaG9sZFswXSkKICAgICAgbWFqb3IgPSBmYWxzZTsKCiAgICBpZihfdG8gIT0gMCAmJiBfaXNUcmFuc2Zlcil7CiAgICAgIGlmKChub3cgLyAxIGRheXMpID4gc2VsZi5jdXJyZW50U3BlbmRbX3RvXVswXSl7CiAgICAgICAgc2VsZi5jdXJyZW50U3BlbmRbX3RvXVswXSA9IG5vdyAvIDEgZGF5czsKICAgICAgICBzZWxmLmN1cnJlbnRTcGVuZFtfdG9dWzFdID0gMDsKICAgICAgfQoKICAgICAgKGVyciwgcmVzKSA9IHNlbGYuY3VycmVudFNwZW5kW190b11bMV0ucGx1cyhfYW1vdW50KTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIGlmKHJlcyA+PSBzZWxmLm1ham9yVGhyZXNob2xkW190b10pCiAgICAgICAgbWFqb3IgPSB0cnVlOwogICAgfQoKICAgIHJldHVybiBtYWpvciA/IHNlbGYucmVxdWlyZWRNYWpvciA6IHNlbGYucmVxdWlyZWRNaW5vcjsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGNyZWF0ZSBuZXcgY29udHJhY3QKICAvLy8gQHBhcmFtIF90eERhdGEgVHJhbnNhY3Rpb24gZGF0YQogIC8vLyBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiBldGggc2VuZGluZyB0byBuZXcgY29udHJhY3QKICBmdW5jdGlvbiBjcmVhdGVDb250cmFjdChieXRlcyBfdHhEYXRhLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgIGFkZHJlc3MgX25ld0NvbnRyYWN0OwogICAgYm9vbCBhbGxHb29kOwoKICAgIGFzc2VtYmx5IHsKICAgICAgX25ld0NvbnRyYWN0IDo9IGNyZWF0ZShfdmFsdWUsIGFkZChfdHhEYXRhLCAweDIwKSwgbWxvYWQoX3R4RGF0YSkpCiAgICAgIGFsbEdvb2QgOj0gZ3QoZXh0Y29kZXNpemUoX25ld0NvbnRyYWN0KSwwKQogICAgfQogICAgcmVxdWlyZShhbGxHb29kKTsKICAgIExvZ0NvbnRyYWN0Q3JlYXRlZChfbmV3Q29udHJhY3QsIF92YWx1ZSk7CiAgfQoKICAvKlByaW1hcnkgRnVuY3Rpb24qLwoKICAvLy8gQGRldiBDcmVhdGUgYW5kIGV4ZWN1dGUgdHJhbnNhY3Rpb24gZnJvbSB3YWxsZXQKICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRhcmdldAogIC8vLyBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiBldGhlciBzZW5kaW5nCiAgLy8vIEBwYXJhbSBfdHhEYXRhIERhdGEgZm9yIGV4ZWN1dGluZyB0cmFuc2FjdGlvbgogIC8vLyBAcGFyYW0gX2NvbmZpcm0gVHJ1ZSBpZiBjb25maXJtaW5nLCBmYWxzZSBpZiByZXZva2luZyBjb25maXJtYXRpb24KICAvLy8gQHBhcmFtIF9kYXRhIE1lc3NhZ2UgZGF0YSBwYXNzZWQgZnJvbSB3YWxsZXQgY29udHJhY3QKICAvLy8gQHJldHVybiBib29sIFJldHVybnMgdHJ1ZSBpZiBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAvLy8gQHJldHVybiBieXRlczMyIFJldHVybnMgdGhlIHR4IElELCBjYW4gYmUgdXNlZCBmb3IgY29uZmlybS9yZXZva2UgZnVuY3Rpb25zCiAgZnVuY3Rpb24gc2VydmVUeChXYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgICAgICAgICAgICAgdWludDI1NiBfdmFsdWUsCiAgICAgICAgICAgICAgICAgICBieXRlcyBfdHhEYXRhLAogICAgICAgICAgICAgICAgICAgYm9vbCBfY29uZmlybSwKICAgICAgICAgICAgICAgICAgIGJ5dGVzIF9kYXRhKQogICAgICAgICAgICAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wsYnl0ZXMzMikKICB7CiAgICBieXRlczMyIF9pZCA9IGtlY2NhazI1Nigic2VydmVUeCIsX3RvLF92YWx1ZSxfdHhEYXRhKTsKICAgIHVpbnQyNTYgX3R4SW5kZXggPSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdLmxlbmd0aDsKICAgIHVpbnQyNTYgX3JlcXVpcmVkID0gc2VsZi5yZXF1aXJlZE1ham9yOwoKICAgIC8vUnVuIGNoZWNrcyBpZiBub3QgY2FsbGVkIGZyb20gZ2VuZXJpYyBjb25maXJtL3Jldm9rZSBmdW5jdGlvbgogICAgaWYobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKXsKICAgICAgYm9vbCBhbGxHb29kOwogICAgICB1aW50MjU2IF9hbW91bnQ7CiAgICAgIC8vIGlmIHRoZSBvd25lciBpcyByZXZva2luZyBoaXMvaGVyIGNvbmZpcm1hdGlvbiBidXQgZG9lc24ndCBrbm93IHRoZQogICAgICAvLyBzcGVjaWZpYyB0cmFuc2FjdGlvbiBpZCBoYXNoCiAgICAgIGlmKCFfY29uZmlybSkgewogICAgICAgIGFsbEdvb2QgPSByZXZva2VDb25maXJtKHNlbGYsIF9pZCk7CiAgICAgICAgcmV0dXJuIChhbGxHb29kLF9pZCk7CiAgICAgIH0gZWxzZSB7IC8vIGVsc2UgY29uZmlybWluZyB0aGUgdHJhbnNhY3Rpb24KICAgICAgICAvL1JldXNlIGFsbEdvb2QgZHVlIHRvIHN0YWNrIGxpbWl0CiAgICAgICAgaWYoX3RvICE9IDApCiAgICAgICAgICAoYWxsR29vZCxfYW1vdW50KSA9IGdldEFtb3VudChfdHhEYXRhKTsKCiAgICAgICAgLy9pZiB0aGlzIGlzIGEgbmV3IHRyYW5zYWN0aW9uIGlkIG9yIGlmIGEgcHJldmlvdXMgaWRlbnRpY2FsIHRyYW5zYWN0aW9uIGhhZCBhbHJlYWR5IHN1Y2NlZWRlZAogICAgICAgIGlmKF90eEluZGV4ID09IDAgfHwgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleCAtIDFdLnN1Y2Nlc3MpewogICAgICAgICAgcmVxdWlyZShzZWxmLm93bmVySW5kZXhbbXNnLnNlbmRlcl0gPiAwKTsKCiAgICAgICAgICBfcmVxdWlyZWQgPSBnZXRSZXF1aXJlZChzZWxmLCBfdG8sIF92YWx1ZSwgYWxsR29vZCxfYW1vdW50KTsKCiAgICAgICAgICAvLyBhZGQgdGhpcyB0cmFuc2FjdGlvbiB0byB0aGUgd2FsbGV0cyByZWNvcmQgYW5kIGluaXRpYWxpemUgdGhlIHNldHRpbmdzCiAgICAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdLmxlbmd0aCsrOwogICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybVJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uZGF5ID0gbm93IC8gMSBkYXlzOwogICAgICAgICAgc2VsZi50cmFuc2FjdGlvbnNbbm93IC8gMSBkYXlzXS5wdXNoKF9pZCk7CiAgICAgICAgfSBlbHNlIHsgLy8gZWxzZSB0aGUgdHJhbnNhY3Rpb24gaXMgYWxyZWFkeSBwZW5kaW5nCiAgICAgICAgICBfdHhJbmRleC0tOyAvLyBzZXQgdGhlIGluZGV4IHRvIHRoZSBpbmRleCBvZiB0aGUgZXhpc3RpbmcgdHJhbnNhY3Rpb24KICAgICAgICAgIC8vbWFrZSBzdXJlIHRoZSBzZW5kZXIgaXNuJ3QgYWxyZWFkeSBjb25maXJtZWQKICAgICAgICAgIGFsbEdvb2QgPSBjaGVja05vdENvbmZpcm1lZChzZWxmLCBfaWQsIF90eEluZGV4KTsKICAgICAgICAgIGlmKCFhbGxHb29kKQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLF9pZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBhZGQgdGhlIHNlbmRlcnMgY29uZmlybWF0aW9uIHRvIHRoZSB0cmFuc2FjdGlvbgogICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtZWRPd25lcnMucHVzaCh1aW50MjU2KG1zZy5zZW5kZXIpKTsKICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybUNvdW50Kys7CiAgICB9IGVsc2UgewogICAgICAvLyBlbHNlIHdlcmUgY2FsbGluZyBmcm9tIGdlbmVyaWMgY29uZmlybS9yZXZva2UgZnVuY3Rpb24sIHNldCB0aGUKICAgICAgLy8gX3R4SW5kZXggaW5kZXggdG8gdGhlIGluZGV4IG9mIHRoZSBleGlzdGluZyB0cmFuc2FjdGlvbgogICAgICBfdHhJbmRleC0tOwogICAgfQoKICAgIC8vIGlmIHRoZXJlIGFyZSBlbm91Z2ggY29uZmlybWF0aW9ucwogICAgaWYoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybUNvdW50ID09CiAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtUmVxdWlyZWQpCiAgICB7CiAgICAgIC8vIGV4ZWN1dGUgdGhlIHRyYW5zYWN0aW9uCiAgICAgIHNlbGYuY3VycmVudFNwZW5kWzBdWzFdICs9IF92YWx1ZTsKICAgICAgc2VsZi5jdXJyZW50U3BlbmRbX3RvXVsxXSArPSBfYW1vdW50OwogICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5zdWNjZXNzID0gdHJ1ZTsKCiAgICAgIGlmKF90byA9PSAwKXsKICAgICAgICAvL0ZhaWx1cmUgaXMgc2VsZiBjb250YWluZWQgaW4gbWV0aG9kCiAgICAgICAgY3JlYXRlQ29udHJhY3QoX3R4RGF0YSwgX3ZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXF1aXJlKF90by5jYWxsLnZhbHVlKF92YWx1ZSkoX3R4RGF0YSkpOwogICAgICB9CiAgICAgIGRlbGV0ZSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5kYXRhOwogICAgICBMb2dUcmFuc2FjdGlvbkNvbXBsZXRlKF9pZCwgX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmRhdGEubGVuZ3RoID09IDApCiAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uZGF0YSA9IF9kYXRhOwoKICAgICAgdWludDI1NiBjb25maXJtc05lZWRlZCA9IGNhbGNDb25maXJtc05lZWRlZChzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtUmVxdWlyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybUNvdW50KTsKICAgICAgTG9nVHJhbnNhY3Rpb25Db25maXJtZWQoX2lkLCBtc2cuc2VuZGVyLCBjb25maXJtc05lZWRlZCk7CiAgICB9CgogICAgcmV0dXJuICh0cnVlLF9pZCk7CiAgfQoKICAvKiBDb25maXJtL1Jldm9rZSBmdW5jdGlvbnMgdXNpbmcgdHggSUQgKi8KCiAgLy8vIEBkZXYgQ29uZmlybXMgYSBjdXJyZW50IHBlbmRpbmcgdHgsIHdpbGwgZXhlY3V0ZSBpZiBmaW5hbCBjb25maXJtYXRpb24KICAvLy8gQHBhcmFtIHNlbGYgV2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9pZCBJRCBvZiB0aGUgdHJhbnNhY3Rpb24KICAvLy8gQHJldHVybiBSZXR1cm5zIHRydWUgaWYgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gY29uZmlybVR4KFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9pZCkKICAgICAgICAgICAgICAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoc2VsZi5vd25lckluZGV4W21zZy5zZW5kZXJdID4gMCk7CiAgICB1aW50MjU2IF90eEluZGV4ID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CiAgICBib29sIHJldDsKCiAgICBpZihfdHhJbmRleCA9PSAwKXsKICAgICAgTG9nRXJyb3JNc2coX3R4SW5kZXgsICJUeCBub3QgaW5pdGlhdGVkIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBfdHhJbmRleC0tOwogICAgYm9vbCBhbGxHb29kID0gY2hlY2tOb3RDb25maXJtZWQoc2VsZiwgX2lkLCBfdHhJbmRleCk7CiAgICBpZighYWxsR29vZCkKICAgICAgcmV0dXJuIGZhbHNlOwoKICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1lZE93bmVycy5wdXNoKHVpbnQyNTYobXNnLnNlbmRlcikpOwogICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybUNvdW50Kys7CgogICAgaWYoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybUNvdW50ID09CiAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtUmVxdWlyZWQpCiAgICB7CiAgICAgIGFkZHJlc3MgYSA9IGFkZHJlc3ModGhpcyk7CiAgICAgIHJlcXVpcmUoYS5jYWxsKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmRhdGEpKTsKICAgIH0gZWxzZSB7CiAgICAgIHVpbnQyNTYgY29uZmlybXNOZWVkZWQgPSBjYWxjQ29uZmlybXNOZWVkZWQoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybVJlcXVpcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCk7CgogICAgICBMb2dUcmFuc2FjdGlvbkNvbmZpcm1lZChfaWQsIG1zZy5zZW5kZXIsIGNvbmZpcm1zTmVlZGVkKTsKICAgICAgcmV0ID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gcmV0OwogIH0KCiAgLy8vIEBkZXYgUmV2b2tlcyBhIHByaW9yIGNvbmZpcm1hdGlvbiBmcm9tIHNlbmRlciwgY2FsbCB3aXRoIHR4IElECiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfaWQgSUQgb2YgdGhlIHRyYW5zYWN0aW9uCiAgLy8vIEByZXR1cm4gUmV0dXJucyB0cnVlIGlmIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogIGZ1bmN0aW9uIHJldm9rZUNvbmZpcm0oV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsIGJ5dGVzMzIgX2lkKQogICAgICAgICAgIHB1YmxpYwogICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShzZWxmLm93bmVySW5kZXhbbXNnLnNlbmRlcl0gPiAwKTsKICAgIHVpbnQyNTYgX3R4SW5kZXggPSBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdLmxlbmd0aDsKCiAgICBpZihfdHhJbmRleCA9PSAwKXsKICAgICAgTG9nRXJyb3JNc2coX3R4SW5kZXgsICJUeCBub3QgaW5pdGlhdGVkIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBfdHhJbmRleC0tOwogICAgaWYoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uc3VjY2Vzcyl7CiAgICAgIExvZ0Vycm9yTXNnKF90eEluZGV4LCAiVHJhbnNhY3Rpb24gYWxyZWFkeSBjb21wbGV0ZSIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy9GdW5jdGlvbiBmcm9tIE1vZHVsYXIuaW8gYXJyYXkgdXRpbGl0eSBsaWJyYXJ5CiAgICBib29sIGZvdW5kOwogICAgdWludDI1NiBpbmRleDsKICAgIChmb3VuZCwgaW5kZXgpID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybWVkT3duZXJzLmluZGV4T2YodWludDI1Nihtc2cuc2VuZGVyKSwgZmFsc2UpOwogICAgaWYoIWZvdW5kKXsKICAgICAgTG9nRXJyb3JNc2coaW5kZXgsICJPd25lciBoYXMgbm90IGNvbmZpcm1lZCB0eCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtZWRPd25lcnNbaW5kZXhdID0gMDsKICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudC0tOwoKICAgIHVpbnQyNTYgY29uZmlybXNOZWVkZWQgPSBjYWxjQ29uZmlybXNOZWVkZWQoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybVJlcXVpcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtQ291bnQpOwogICAgLy9UcmFuc2FjdGlvbiByZW1vdmVkIGlmIGFsbCBzaWdzIHJldm9rZWQgYnV0IGlkIHJlbWFpbnMgaW4gd2FsbGV0IHRyYW5zYWN0aW9uIGxpc3QKICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCA9PSAwKQogICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdLmxlbmd0aC0tOwoKICAgIExvZ1Jldm9rZU5vdGljZShfaWQsIG1zZy5zZW5kZXIsIGNvbmZpcm1zTmVlZGVkKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKbGlicmFyeSBBcnJheTI1NkxpYiB7CgogIC8vLyBAZGV2IFN1bSB2ZWN0b3IKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICAvLy8gQHJldHVybiBzdW0gVGhlIHN1bSBvZiBhbGwgZWxlbWVudHMsIGRvZXMgbm90IGNoZWNrIGZvciBvdmVyZmxvdwogIGZ1bmN0aW9uIHN1bUVsZW1lbnRzKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NiBzdW0pIHsKICAgIGFzc2VtYmx5IHsKICAgICAgbXN0b3JlKDB4NjAsc2VsZl9zbG90KQoKICAgICAgZm9yIHsgbGV0IGkgOj0gMCB9IGx0KGksIHNsb2FkKHNlbGZfc2xvdCkpIHsgaSA6PSBhZGQoaSwgMSkgfSB7CiAgICAgICAgc3VtIDo9IGFkZChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGkpKSxzdW0pCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFJldHVybnMgdGhlIG1heCB2YWx1ZSBpbiBhbiBhcnJheS4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICAvLy8gQHJldHVybiBtYXhWYWx1ZSBUaGUgaGlnaGVzdCB2YWx1ZSBpbiB0aGUgYXJyYXkKICBmdW5jdGlvbiBnZXRNYXgodWludDI1NltdIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2IG1heFZhbHVlKSB7CiAgICBhc3NlbWJseSB7CiAgICAgIG1zdG9yZSgweDYwLHNlbGZfc2xvdCkKICAgICAgbWF4VmFsdWUgOj0gc2xvYWQoc2hhMygweDYwLDB4MjApKQoKICAgICAgZm9yIHsgbGV0IGkgOj0gMCB9IGx0KGksIHNsb2FkKHNlbGZfc2xvdCkpIHsgaSA6PSBhZGQoaSwgMSkgfSB7CiAgICAgICAgc3dpdGNoIGd0KHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksaSkpLCBtYXhWYWx1ZSkKICAgICAgICBjYXNlIDEgewogICAgICAgICAgbWF4VmFsdWUgOj0gc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxpKSkKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFJldHVybnMgdGhlIG1pbmltdW0gdmFsdWUgaW4gYW4gYXJyYXkuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JhZ2UgYXJyYXkgY29udGFpbmluZyB1aW50MjU2IHR5cGUgdmFyaWFibGVzCiAgLy8vIEByZXR1cm4gbWluVmFsdWUgVGhlIGhpZ2hlc3QgdmFsdWUgaW4gdGhlIGFycmF5CiAgZnVuY3Rpb24gZ2V0TWluKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NiBtaW5WYWx1ZSkgewogICAgYXNzZW1ibHkgewogICAgICBtc3RvcmUoMHg2MCxzZWxmX3Nsb3QpCiAgICAgIG1pblZhbHVlIDo9IHNsb2FkKHNoYTMoMHg2MCwweDIwKSkKCiAgICAgIGZvciB7IGxldCBpIDo9IDAgfSBsdChpLCBzbG9hZChzZWxmX3Nsb3QpKSB7IGkgOj0gYWRkKGksIDEpIH0gewogICAgICAgIHN3aXRjaCBndChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGkpKSwgbWluVmFsdWUpCiAgICAgICAgY2FzZSAwIHsKICAgICAgICAgIG1pblZhbHVlIDo9IHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksaSkpCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBGaW5kcyB0aGUgaW5kZXggb2YgYSBnaXZlbiB2YWx1ZSBpbiBhbiBhcnJheQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yYWdlIGFycmF5IGNvbnRhaW5pbmcgdWludDI1NiB0eXBlIHZhcmlhYmxlcwogIC8vLyBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IKICAvLy8gQHBhcmFtIGlzU29ydGVkIFRydWUgaWYgdGhlIGFycmF5IGlzIHNvcnRlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgLy8vIEByZXR1cm4gZm91bmQgVHJ1ZSBpZiB0aGUgdmFsdWUgd2FzIGZvdW5kLCBmYWxzZSBvdGhlcndpc2UKICAvLy8gQHJldHVybiBpbmRleCBUaGUgaW5kZXggb2YgdGhlIGdpdmVuIHZhbHVlLCByZXR1cm5zIDAgaWYgZm91bmQgaXMgZmFsc2UKICBmdW5jdGlvbiBpbmRleE9mKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdmFsdWUsIGJvb2wgaXNTb3J0ZWQpCiAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgdmlldwogICAgICAgICAgIHJldHVybnMoYm9vbCBmb3VuZCwgdWludDI1NiBpbmRleCkgewogICAgYXNzZW1ibHl7CiAgICAgIG1zdG9yZSgweDYwLHNlbGZfc2xvdCkKICAgICAgc3dpdGNoIGlzU29ydGVkCiAgICAgIGNhc2UgMSB7CiAgICAgICAgbGV0IGhpZ2ggOj0gc3ViKHNsb2FkKHNlbGZfc2xvdCksMSkKICAgICAgICBsZXQgbWlkIDo9IDAKICAgICAgICBsZXQgbG93IDo9IDAKICAgICAgICBmb3IgeyB9IGlzemVybyhndChsb3csIGhpZ2gpKSB7IH0gewogICAgICAgICAgbWlkIDo9IGRpdihhZGQobG93LGhpZ2gpLDIpCgogICAgICAgICAgc3dpdGNoIGx0KHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksbWlkKSksdmFsdWUpCiAgICAgICAgICBjYXNlIDEgewogICAgICAgICAgICAgbG93IDo9IGFkZChtaWQsMSkKICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgMCB7CiAgICAgICAgICAgIHN3aXRjaCBndChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLG1pZCkpLHZhbHVlKQogICAgICAgICAgICBjYXNlIDEgewogICAgICAgICAgICAgIGhpZ2ggOj0gc3ViKG1pZCwxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMCB7CiAgICAgICAgICAgICAgZm91bmQgOj0gMQogICAgICAgICAgICAgIGluZGV4IDo9IG1pZAogICAgICAgICAgICAgIGxvdyA6PSBhZGQoaGlnaCwxKQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNhc2UgMCB7CiAgICAgICAgZm9yIHsgbGV0IGxvdyA6PSAwIH0gbHQobG93LCBzbG9hZChzZWxmX3Nsb3QpKSB7IGxvdyA6PSBhZGQobG93LCAxKSB9IHsKICAgICAgICAgIHN3aXRjaCBlcShzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGxvdykpLCB2YWx1ZSkKICAgICAgICAgIGNhc2UgMSB7CiAgICAgICAgICAgIGZvdW5kIDo9IDEKICAgICAgICAgICAgaW5kZXggOj0gbG93CiAgICAgICAgICAgIGxvdyA6PSBzbG9hZChzZWxmX3Nsb3QpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBVdGlsaXR5IGZ1bmN0aW9uIGZvciBoZWFwU29ydAogIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIGNoaWxkIG5vZGUKICAvLy8gQHJldHVybiBwSSBUaGUgcGFyZW50IG5vZGUgaW5kZXgKICBmdW5jdGlvbiBnZXRQYXJlbnRJKHVpbnQyNTYgaW5kZXgpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50MjU2IHBJKSB7CiAgICB1aW50MjU2IGkgPSBpbmRleCAtIDE7CiAgICBwSSA9IGkvMjsKICB9CgogIC8vLyBAZGV2IFV0aWxpdHkgZnVuY3Rpb24gZm9yIGhlYXBTb3J0CiAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggb2YgcGFyZW50IG5vZGUKICAvLy8gQHJldHVybiBsY0kgVGhlIGluZGV4IG9mIGxlZnQgY2hpbGQKICBmdW5jdGlvbiBnZXRMZWZ0Q2hpbGRJKHVpbnQyNTYgaW5kZXgpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50MjU2IGxjSSkgewogICAgdWludDI1NiBpID0gaW5kZXggKiAyOwogICAgbGNJID0gaSArIDE7CiAgfQoKICAvLy8gQGRldiBTb3J0cyBnaXZlbiBhcnJheSBpbiBwbGFjZQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yYWdlIGFycmF5IGNvbnRhaW5pbmcgdWludDI1NiB0eXBlIHZhcmlhYmxlcwogIGZ1bmN0aW9uIGhlYXBTb3J0KHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB7CiAgICB1aW50MjU2IGVuZCA9IHNlbGYubGVuZ3RoIC0gMTsKICAgIHVpbnQyNTYgc3RhcnQgPSBnZXRQYXJlbnRJKGVuZCk7CiAgICB1aW50MjU2IHJvb3QgPSBzdGFydDsKICAgIHVpbnQyNTYgbENoaWxkOwogICAgdWludDI1NiByQ2hpbGQ7CiAgICB1aW50MjU2IHN3YXA7CiAgICB1aW50MjU2IHRlbXA7CiAgICB3aGlsZShzdGFydCA+PSAwKXsKICAgICAgcm9vdCA9IHN0YXJ0OwogICAgICBsQ2hpbGQgPSBnZXRMZWZ0Q2hpbGRJKHN0YXJ0KTsKICAgICAgd2hpbGUobENoaWxkIDw9IGVuZCl7CiAgICAgICAgckNoaWxkID0gbENoaWxkICsgMTsKICAgICAgICBzd2FwID0gcm9vdDsKICAgICAgICBpZihzZWxmW3N3YXBdIDwgc2VsZltsQ2hpbGRdKQogICAgICAgICAgc3dhcCA9IGxDaGlsZDsKICAgICAgICBpZigockNoaWxkIDw9IGVuZCkgJiYgKHNlbGZbc3dhcF08c2VsZltyQ2hpbGRdKSkKICAgICAgICAgIHN3YXAgPSByQ2hpbGQ7CiAgICAgICAgaWYoc3dhcCA9PSByb290KQogICAgICAgICAgbENoaWxkID0gZW5kKzE7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0ZW1wID0gc2VsZltzd2FwXTsKICAgICAgICAgIHNlbGZbc3dhcF0gPSBzZWxmW3Jvb3RdOwogICAgICAgICAgc2VsZltyb290XSA9IHRlbXA7CiAgICAgICAgICByb290ID0gc3dhcDsKICAgICAgICAgIGxDaGlsZCA9IGdldExlZnRDaGlsZEkocm9vdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmKHN0YXJ0ID09IDApCiAgICAgICAgYnJlYWs7CiAgICAgIGVsc2UKICAgICAgICBzdGFydCA9IHN0YXJ0IC0gMTsKICAgIH0KICAgIHdoaWxlKGVuZCA+IDApewogICAgICB0ZW1wID0gc2VsZltlbmRdOwogICAgICBzZWxmW2VuZF0gPSBzZWxmWzBdOwogICAgICBzZWxmWzBdID0gdGVtcDsKICAgICAgZW5kID0gZW5kIC0gMTsKICAgICAgcm9vdCA9IDA7CiAgICAgIGxDaGlsZCA9IGdldExlZnRDaGlsZEkoMCk7CiAgICAgIHdoaWxlKGxDaGlsZCA8PSBlbmQpewogICAgICAgIHJDaGlsZCA9IGxDaGlsZCArIDE7CiAgICAgICAgc3dhcCA9IHJvb3Q7CiAgICAgICAgaWYoc2VsZltzd2FwXSA8IHNlbGZbbENoaWxkXSkKICAgICAgICAgIHN3YXAgPSBsQ2hpbGQ7CiAgICAgICAgaWYoKHJDaGlsZCA8PSBlbmQpICYmIChzZWxmW3N3YXBdPHNlbGZbckNoaWxkXSkpCiAgICAgICAgICBzd2FwID0gckNoaWxkOwogICAgICAgIGlmKHN3YXAgPT0gcm9vdCkKICAgICAgICAgIGxDaGlsZCA9IGVuZCArIDE7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0ZW1wID0gc2VsZltzd2FwXTsKICAgICAgICAgIHNlbGZbc3dhcF0gPSBzZWxmW3Jvb3RdOwogICAgICAgICAgc2VsZltyb290XSA9IHRlbXA7CiAgICAgICAgICByb290ID0gc3dhcDsKICAgICAgICAgIGxDaGlsZCA9IGdldExlZnRDaGlsZEkocm9vdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBSZW1vdmVzIGR1cGxpY2F0ZXMgZnJvbSBhIGdpdmVuIGFycmF5LgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yYWdlIGFycmF5IGNvbnRhaW5pbmcgdWludDI1NiB0eXBlIHZhcmlhYmxlcwogIGZ1bmN0aW9uIHVuaXEodWludDI1NltdIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKHVpbnQyNTYgbGVuZ3RoKSB7CiAgICBib29sIGNvbnRhaW5zOwogICAgdWludDI1NiBpbmRleDsKCiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBzZWxmLmxlbmd0aDsgaSsrKSB7CiAgICAgIChjb250YWlucywgaW5kZXgpID0gaW5kZXhPZihzZWxmLCBzZWxmW2ldLCBmYWxzZSk7CgogICAgICBpZiAoaSA+IGluZGV4KSB7CiAgICAgICAgZm9yICh1aW50MjU2IGogPSBpOyBqIDwgc2VsZi5sZW5ndGggLSAxOyBqKyspewogICAgICAgICAgc2VsZltqXSA9IHNlbGZbaiArIDFdOwogICAgICAgIH0KCiAgICAgICAgZGVsZXRlIHNlbGZbc2VsZi5sZW5ndGggLSAxXTsKICAgICAgICBzZWxmLmxlbmd0aC0tOwogICAgICAgIGktLTsKICAgICAgfQogICAgfQoKICAgIGxlbmd0aCA9IHNlbGYubGVuZ3RoOwogIH0KfQoKbGlicmFyeSBCYXNpY01hdGhMaWIgewogIC8vLyBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBwcm9kdWN0IG9mIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICBmdW5jdGlvbiB0aW1lcyh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gbXVsKGEsYikKICAgICAgc3dpdGNoIG9yKGlzemVybyhiKSwgZXEoZGl2KHJlcyxiKSwgYSkpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBEaXZpZGVzIHR3byBudW1iZXJzIGJ1dCBjaGVja3MgZm9yIDAgaW4gdGhlIGRpdmlzb3IgZmlyc3QuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiBgYmAgaXMgMAogIC8vLyBAcmV0dXJuIHJlcyBUaGUgcXVvdGllbnQgb2YgYSBhbmQgYiwgb3IgMCBpZiBgYmAgaXMgMAogIGZ1bmN0aW9uIGRpdmlkZWRCeSh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiBpKSB7CiAgICB1aW50MjU2IHJlczsKICAgIGFzc2VtYmx5ewogICAgICBzd2l0Y2ggaXN6ZXJvKGIpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgcmVzIDo9IGRpdihhLGIpCiAgICAgICAgbGV0IGxvYyA6PSBtbG9hZCgweDQwKQogICAgICAgIG1zdG9yZShhZGQobG9jLDB4MjApLHJlcykKICAgICAgICBpIDo9IG1sb2FkKGFkZChsb2MsMHgyMCkpCiAgICAgIH0KICAgICAgZGVmYXVsdCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICBpIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgQWRkcyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciBvdmVyZmxvdyBiZWZvcmUgcmV0dXJuaW5nLgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHN1bSBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gcGx1cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsIHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IGFkZChhLGIpCiAgICAgIHN3aXRjaCBhbmQoZXEoc3ViKHJlcyxiKSwgYSksIG9yKGd0KHJlcyxiKSxlcShyZXMsYikpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgU3VidHJhY3RzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIHVuZGVyZmxvdyBiZWZvcmUgcmV0dXJuaW5nLgogIC8vLyBEb2VzIG5vdCB0aHJvdyBidXQgcmF0aGVyIGxvZ3MgYW4gRXJyIGV2ZW50IGlmIHRoZXJlIGlzIHVuZGVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBkaWZmZXJlbmNlIGJldHdlZW4gYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cKICBmdW5jdGlvbiBtaW51cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gc3ViKGEsYikKICAgICAgc3dpdGNoIGVxKGFuZChlcShhZGQocmVzLGIpLCBhKSwgb3IobHQocmVzLGEpLCBlcShyZXMsYSkpKSwgMSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9Cn0='.
	

]
