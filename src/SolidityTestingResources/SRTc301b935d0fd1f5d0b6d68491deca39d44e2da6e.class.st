Class {
	#name : #SRTc301b935d0fd1f5d0b6d68491deca39d44e2da6e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc301b935d0fd1f5d0b6d68491deca39d44e2da6e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHsKICAgIGZ1bmN0aW9uIHN0YXJ0RGF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBlbmRlZEF0KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KICAgIGZ1bmN0aW9uIGlzRW5kZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRvdGFsUmFpc2VkQW1vdW50SW5DbnkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5KGFkZHJlc3MgcHVyY2hhc2VyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VkVG9rZW5zT25FcEJ5KGFkZHJlc3MgcHVyY2hhc2VyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKfQoKY29udHJhY3QgQWJzdHJhY3RTdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduIHt9CgovLy8gQHRpdGxlIFRva2VuIGNvbnRyYWN0IC0gRVJDMjAgY29tcGF0aWJsZSBTdGFyYmFzZSB0b2tlbiBjb250cmFjdC4KLy8vIEBhdXRob3IgU3RhcmJhc2UgUFRFLiBMVEQuIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5OGYxZjZmZWY3ZDhlYmVjZjllYWZhZjllYmZkYjZmYmY3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgU3RhcmJhc2VUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IFB1YmxpY09mZmVyaW5nUGxhbkRlY2xhcmVkKHVpbnQyNTYgdG9rZW5Db3VudCwgdWludDI1NiB1bmxvY2tDb21wYW55c1Rva2Vuc0F0KTsKICAgIGV2ZW50IE12cExhdW5jaGVkKHVpbnQyNTYgbGF1bmNoZWRBdCk7CiAgICBldmVudCBMb2dOZXdGdW5kcmFpc2VyIChhZGRyZXNzIGluZGV4ZWQgZnVuZHJhaXNlckFkZHJlc3MsIGJvb2wgaXNCb25hRmlkZSk7CiAgICBldmVudCBMb2dVcGRhdGVGdW5kcmFpc2VyKGFkZHJlc3MgaW5kZXhlZCBmdW5kcmFpc2VyQWRkcmVzcywgYm9vbCBpc0JvbmFGaWRlKTsKCiAgICAvKgogICAgICogIFR5cGVzCiAgICAgKi8KICAgIHN0cnVjdCBQdWJsaWNPZmZlcmluZ1BsYW4gewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudDsKICAgICAgICB1aW50MjU2IHVubG9ja0NvbXBhbnlzVG9rZW5zQXQ7CiAgICAgICAgdWludDI1NiBkZWNsYXJlZEF0OwogICAgfQoKICAgIC8qCiAgICAgKiAgRXh0ZXJuYWwgY29udHJhY3RzCiAgICAgKi8KICAgIEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUgcHVibGljIHN0YXJiYXNlQ3Jvd2RzYWxlOwogICAgQWJzdHJhY3RTdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduIHB1YmxpYyBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduOwoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBhZGRyZXNzIHB1YmxpYyBjb21wYW55OwogICAgUHVibGljT2ZmZXJpbmdQbGFuW10gcHVibGljIHB1YmxpY09mZmVyaW5nUGxhbnM7ICAvLyBmdXJ0aGVyIGNyb3dkc2FsZXMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uOyAgICAvLyBJbml0aWFsIHRva2VuIGFsbG9jYXRpb25zIGZvciBFYXJseSBDb250cmlidXRvcnMKICAgIHVpbnQyNTYgcHVibGljIG12cExhdW5jaGVkQXQ7ICAvLyAwIHVudGlsIGEgTVZQIG9mIFN0YXJiYXNlIFBsYXRmb3JtIGxhdW5jaGVzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHJpdmF0ZSBmdW5kcmFpc2VyczsgLy8gRnVuZHJhaXNlcnMgYXJlIHZldHRlZCBhZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBleGVjdXRlIGZ1bmN0aW9ucyB3aXRoaW4gdGhlIGNvbnRyYWN0CgogICAgLyoKICAgICAqICBDb25zdGFudHMgLyBUb2tlbiBtZXRhIGRhdGEKICAgICAqLwogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBuYW1lID0gIlN0YXJiYXNlIjsgIC8vIFRva2VuIG5hbWUKICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgc3ltYm9sID0gIlNUQVIiOyAgLy8gVG9rZW4gc3ltYm9sCiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGluaXRpYWxTdXBwbHkgPSAxMDAwMDAwMDAwZTE4OyAvLyAxQiBTVEFSIHRva2VucwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaW5pdGlhbENvbXBhbnlzVG9rZW5BbGxvY2F0aW9uID0gNzUwMDAwMDAwZTE4OyAgLy8gNzUwTQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaW5pdGlhbEJhbGFuY2VGb3JDcm93ZHNhbGUgPSAxNzUwMDAwMDBlMTg7ICAvLyBDUygxMjVNKStFUCg1ME0pCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpbml0aWFsQmFsYW5jZUZvck1hcmtldGluZ0NhbXBhaWduID0gMTI1MDAwMDBlMTg7ICAgLy8gMTIuNU0KCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBvbmx5Q3Jvd2RzYWxlQ29udHJhY3QoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzdGFyYmFzZUNyb3dkc2FsZSkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1hcmtldGluZ0NhbXBhaWduQ29udHJhY3QoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RnVuZHJhaXNlcigpIHsKICAgICAgICAvLyBPbmx5IHJpZ2h0ZnVsIGZ1bmRyYWlzZXIgaXMgcGVybWl0dGVkLgogICAgICAgIGFzc2VydChpc0Z1bmRyYWlzZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUJlZm9yZUNyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKHN0YXJiYXNlQ3Jvd2RzYWxlLnN0YXJ0RGF0ZSgpID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFmdGVyQ3Jvd2RzYWxlKCkgewogICAgICAgIHJlcXVpcmUoc3RhcmJhc2VDcm93ZHNhbGUuaXNFbmRlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24KICAgICAqIEBwYXJhbSBzdGFyYmFzZUNvbXBhbnlBZGRyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkcyB1bnRyYW5zZmVycmFibGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VDcm93ZHNhbGVBZGRyIEFkZHJlc3Mgb2YgdGhlIGNyb3dkc2FsZSBjb250cmFjdAogICAgICogQHBhcmFtIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBtYXJrZXRpbmcgY2FtcGFpZ24gY29udHJhY3QKICAgICAqLwoKICAgIGZ1bmN0aW9uIFN0YXJiYXNlVG9rZW4oCiAgICAgICAgYWRkcmVzcyBzdGFyYmFzZUNvbXBhbnlBZGRyLAogICAgICAgIGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVBZGRyLAogICAgICAgIGFkZHJlc3Mgc3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbkFkZHIKICAgICkgewogICAgICAgIGFzc2VydCgKICAgICAgICAgICAgc3RhcmJhc2VDb21wYW55QWRkciAhPSAwICYmCiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciAhPSAwICYmCiAgICAgICAgICAgIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyICE9IDApOwoKICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZSA9IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUoc3RhcmJhc2VDcm93ZHNhbGVBZGRyKTsKICAgICAgICBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduID0gQWJzdHJhY3RTdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyKTsKICAgICAgICBjb21wYW55ID0gc3RhcmJhc2VDb21wYW55QWRkcjsKCiAgICAgICAgLy8gbXNnLnNlbmRlciBiZWNvbWVzIGZpcnN0IGZ1bmRyYWlzZXIKICAgICAgICBmdW5kcmFpc2Vyc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgTG9nTmV3RnVuZHJhaXNlcihtc2cuc2VuZGVyLCB0cnVlKTsKCiAgICAgICAgLy8gVG9rZW5zIGZvciBjcm93ZHNhbGUgYW5kIGVhcmx5IHB1cmNoYXNlcnMKICAgICAgICBiYWxhbmNlc1thZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKV0gPSBpbml0aWFsQmFsYW5jZUZvckNyb3dkc2FsZTsKCiAgICAgICAgLy8gVG9rZW5zIGZvciBtYXJrZXRpbmcgY2FtcGFpZ24gc3VwcG9ydGVycwogICAgICAgIGJhbGFuY2VzW2FkZHJlc3Moc3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbildID0gaW5pdGlhbEJhbGFuY2VGb3JNYXJrZXRpbmdDYW1wYWlnbjsKCiAgICAgICAgLy8gVG9rZW5zIGZvciBlYXJseSBjb250cmlidXRvcnMsIHNob3VsZCBiZSBhbGxvY2F0ZWQgYnkgZnVuY3Rpb24KICAgICAgICBiYWxhbmNlc1swXSA9IDYyNTAwMDAwZTE4OyAvLyA2Mi41TQoKICAgICAgICAvLyBTdGFyYmFzZSBjb21wYW55IGhvbGRzIHVudHJhbnNmZXJyYWJsZSB0b2tlbnMgaW5pdGlhbGx5CiAgICAgICAgYmFsYW5jZXNbc3RhcmJhc2VDb21wYW55QWRkcl0gPSBpbml0aWFsQ29tcGFueXNUb2tlbkFsbG9jYXRpb247IC8vIDc1ME0KCiAgICAgICAgdG90YWxTdXBwbHkgPSBpbml0aWFsU3VwcGx5OyAgICAvLyAxQgogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0cycgYWRkcmVzc2VzCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VDcm93ZHNhbGVBZGRyIENyb3dkc2FsZSBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyIE1hcmtldGluZyBjYW1wYWlnbiBjb250cmFjdCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVBZGRyLCBhZGRyZXNzIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICBvbmx5QmVmb3JlQ3Jvd2RzYWxlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciAhPSAwICYmIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyICE9IDApOwogICAgICAgIGFzc2VydChiYWxhbmNlc1thZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKV0gPT0gaW5pdGlhbEJhbGFuY2VGb3JDcm93ZHNhbGUpOwogICAgICAgIGFzc2VydChiYWxhbmNlc1thZGRyZXNzKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24pXSA9PSBpbml0aWFsQmFsYW5jZUZvck1hcmtldGluZ0NhbXBhaWduKTsKCiAgICAgICAgLy8gTW92ZSB0aGUgYmFsYW5jZXMgdG8gdGhlIG5ldyBvbmVzCiAgICAgICAgYmFsYW5jZXNbYWRkcmVzcyhzdGFyYmFzZUNyb3dkc2FsZSldID0gMDsKICAgICAgICBiYWxhbmNlc1thZGRyZXNzKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24pXSA9IDA7CiAgICAgICAgYmFsYW5jZXNbc3RhcmJhc2VDcm93ZHNhbGVBZGRyXSA9IGluaXRpYWxCYWxhbmNlRm9yQ3Jvd2RzYWxlOwogICAgICAgIGJhbGFuY2VzW3N0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyXSA9IGluaXRpYWxCYWxhbmNlRm9yTWFya2V0aW5nQ2FtcGFpZ247CgogICAgICAgIC8vIFVwZGF0ZSB0aGUgcmVmZXJlbmNlcwogICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlID0gQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZShzdGFyYmFzZUNyb3dkc2FsZUFkZHIpOwogICAgICAgIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24gPSBBYnN0cmFjdFN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24oc3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbkFkZHIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qCiAgICAgKiAgRXh0ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgZGVjbGFyZWQgcHVibGljIG9mZmVyaW5nIHBsYW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bU9mRGVjbGFyZWRQdWJsaWNPZmZlcmluZ1BsYW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gcHVibGljT2ZmZXJpbmdQbGFucy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IERlY2xhcmVzIGEgcHVibGljIG9mZmVyaW5nIHBsYW4gdG8gbWFrZSBjb21wYW55J3MgdG9rZW5zIHRyYW5zZmVyYWJsZQogICAgICogQHBhcmFtIHRva2VuQ291bnQgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSB1bmxvY2tDb21wYW55c1Rva2Vuc0F0IFRpbWUgb2YgdGhlIHRva2VucyB3aWxsIGJlIHVubG9ja2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlY2xhcmVQdWJsaWNPZmZlcmluZ1BsYW4odWludDI1NiB0b2tlbkNvdW50LCB1aW50MjU2IHVubG9ja0NvbXBhbnlzVG9rZW5zQXQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIG9ubHlBZnRlckNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KHRva2VuQ291bnQgPD0gMTAwMDAwMDAwZTE4KTsgICAgLy8gc2hhbGwgbm90IGV4Y2VlZCAxMDBNIHRva2VucwogICAgICAgIGFzc2VydChTYWZlTWF0aC5zdWIobm93LCBzdGFyYmFzZUNyb3dkc2FsZS5lbmRlZEF0KCkpID49IDE4MCBkYXlzKTsgICAvLyBzaGFsbCBub3QgYmUgZGVjbGFyZWQgZm9yIDYgbW9udGhzIGFmdGVyIHRoZSBjcm93ZHNhbGUgZW5kZWQKICAgICAgICBhc3NlcnQoU2FmZU1hdGguc3ViKHVubG9ja0NvbXBhbnlzVG9rZW5zQXQsIG5vdykgPj0gNjAgZGF5cyk7ICAgLy8gdG9rZW5zIG11c3QgYmUgdW50cmFuc2ZlcmFibGUgYXQgbGVhc3QgZm9yIDIgbW9udGhzCgogICAgICAgIC8vIGNoZWNrIGlmIGxhc3QgZGVjbGFyYXRpb24gd2FzIG1vcmUgdGhhbiA2IG1vbnRocyBhZ28KICAgICAgICBpZiAocHVibGljT2ZmZXJpbmdQbGFucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgbGFzdERlY2xhcmVkQXQgPQogICAgICAgICAgICAgICAgcHVibGljT2ZmZXJpbmdQbGFuc1twdWJsaWNPZmZlcmluZ1BsYW5zLmxlbmd0aCAtIDFdLmRlY2xhcmVkQXQ7CiAgICAgICAgICAgIGFzc2VydChTYWZlTWF0aC5zdWIobm93LCBsYXN0RGVjbGFyZWRBdCkgPj0gMTgwIGRheXMpOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiB0b3RhbERlY2xhcmVkVG9rZW5Db3VudCA9IHRva2VuQ291bnQ7CiAgICAgICAgZm9yICh1aW50OCBpOyBpIDwgcHVibGljT2ZmZXJpbmdQbGFucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbERlY2xhcmVkVG9rZW5Db3VudCA9IFNhZmVNYXRoLmFkZCh0b3RhbERlY2xhcmVkVG9rZW5Db3VudCwgcHVibGljT2ZmZXJpbmdQbGFuc1tpXS50b2tlbkNvdW50KTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0KHRvdGFsRGVjbGFyZWRUb2tlbkNvdW50IDw9IGluaXRpYWxDb21wYW55c1Rva2VuQWxsb2NhdGlvbik7ICAgLy8gc2hhbGwgbm90IGV4Y2VlZCB0aGUgaW5pdGlhbCB0b2tlbiBhbGxvY2F0aW9uCgogICAgICAgIHB1YmxpY09mZmVyaW5nUGxhbnMucHVzaCgKICAgICAgICAgICAgUHVibGljT2ZmZXJpbmdQbGFuKHRva2VuQ291bnQsIHVubG9ja0NvbXBhbnlzVG9rZW5zQXQsIG5vdykpOwoKICAgICAgICBQdWJsaWNPZmZlcmluZ1BsYW5EZWNsYXJlZCh0b2tlbkNvdW50LCB1bmxvY2tDb21wYW55c1Rva2Vuc0F0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb2NhdGUgdG9rZW5zIHRvIGEgbWFya2V0aW5nIHN1cHBvcnRlciBmcm9tIHRoZSBtYXJrZXRpbmcgY2FtcGFpZ24gc2hhcmUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvTWFya2V0aW5nU3VwcG9ydGVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5TWFya2V0aW5nQ2FtcGFpZ25Db250cmFjdAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG9jYXRlRnJvbShhZGRyZXNzKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24pLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdG8gYW4gZWFybHkgY29udHJpYnV0b3IgZnJvbSB0aGUgZWFybHkgY29udHJpYnV0b3Igc2hhcmUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvRWFybHlDb250cmlidXRvcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGluaXRpYWxFY1Rva2VuQWxsb2NhdGlvblt0b10gPQogICAgICAgICAgICBTYWZlTWF0aC5hZGQoaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uW3RvXSwgdmFsdWUpOwogICAgICAgIHJldHVybiBhbGxvY2F0ZUZyb20oMCwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSXNzdWUgbmV3IHRva2VucyBhY2NvcmRpbmcgdG8gdGhlIFNUQVIgdG9rZW4gaW5mbGF0aW9uIGxpbWl0cwogICAgICogQHBhcmFtIF9mb3IgQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIGFsbG9jYXRlZAogICAgICogQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gaXNzdWUKICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfZm9yLCB1aW50MjU2IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICBvbmx5QWZ0ZXJDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIGNoZWNrIGlmIHRoZSB2YWx1ZSB1bmRlciB0aGUgbGltaXRzCiAgICAgICAgYXNzZXJ0KHZhbHVlIDw9IG51bU9mSW5mbGF0YWJsZVRva2VucygpKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSBTYWZlTWF0aC5hZGQodG90YWxTdXBwbHksIHZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZm9yXSA9IFNhZmVNYXRoLmFkZChiYWxhbmNlc1tfZm9yXSwgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWNsYXJlcyBTdGFyYmFzZSBNVlAgaGFzIGJlZW4gbGF1bmNoZWQKICAgICAqIEBwYXJhbSBsYXVuY2hlZEF0IFdoZW4gdGhlIE1WUCBsYXVuY2hlZCAodGltZXN0YW1wKQogICAgICovCiAgICBmdW5jdGlvbiBkZWNsYXJlTXZwTGF1bmNoZWQodWludDI1NiBsYXVuY2hlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICBvbmx5QWZ0ZXJDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUobXZwTGF1bmNoZWRBdCA9PSAwKTsgLy8gb3ZlcndyaXRpbmcgdGhlIGxhdW5jaCBkYXRlIGlzIG5vdCBwZXJtaXR0ZWQKICAgICAgICByZXF1aXJlKGxhdW5jaGVkQXQgPD0gbm93KTsKICAgICAgICByZXF1aXJlKHN0YXJiYXNlQ3Jvd2RzYWxlLmlzRW5kZWQoKSk7CgogICAgICAgIG12cExhdW5jaGVkQXQgPSBsYXVuY2hlZEF0OwogICAgICAgIE12cExhdW5jaGVkKGxhdW5jaGVkQXQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdG8gYSBjcm93ZHNhbGUgb3IgZWFybHkgcHVyY2hhc2VyIGZyb20gdGhlIGNyb3dkc2FsZSBzaGFyZQogICAgICogQHBhcmFtIHRvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBhbGxvY2F0ZWQKICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9Dcm93ZHNhbGVQdXJjaGFzZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlDcm93ZHNhbGVDb250cmFjdAogICAgICAgIG9ubHlBZnRlckNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG9jYXRlRnJvbShhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlcnMgc2VuZGVyJ3MgdG9rZW5zIHRvIGEgZ2l2ZW4gYWRkcmVzcy4gUmV0dXJucyBzdWNjZXNzLgogICAgICogQHBhcmFtIHRvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIuCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhc3NlcnQoaXNUcmFuc2ZlcmFibGUobXNnLnNlbmRlciwgdmFsdWUpKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgICAqIEBwYXJhbSBmcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFzc2VydChpc1RyYW5zZmVyYWJsZShmcm9tLCB2YWx1ZSkpOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWRkcyBmdW5kcmFpc2VyLiBPbmx5IGNhbGxlZCBieSBhbm90aGVyIGZ1bmRyYWlzZXIuCiAgICAgKiBAcGFyYW0gZnVuZHJhaXNlckFkZHJlc3MgVGhlIGFkZHJlc3MgaW4gY2hlY2sKICAgICAqLwogICAgZnVuY3Rpb24gYWRkRnVuZHJhaXNlcihhZGRyZXNzIGZ1bmRyYWlzZXJBZGRyZXNzKSBwdWJsaWMgb25seUZ1bmRyYWlzZXIgewogICAgICAgIGFzc2VydCghaXNGdW5kcmFpc2VyKGZ1bmRyYWlzZXJBZGRyZXNzKSk7CgogICAgICAgIGZ1bmRyYWlzZXJzW2Z1bmRyYWlzZXJBZGRyZXNzXSA9IHRydWU7CiAgICAgICAgTG9nTmV3RnVuZHJhaXNlcihmdW5kcmFpc2VyQWRkcmVzcywgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSBmdW5kcmFpc2VyIGFkZHJlc3MgcmlnaHRzLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHVwZGF0ZQogICAgICogQHBhcmFtIGlzQm9uYUZpZGUgQm9vbGVhbiB0aGF0IGRlbm90ZXMgd2hldGhlciBmdW5kcmFpc2VyIGlzIGFjdGl2ZSBvciBub3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUZ1bmRyYWlzZXIoYWRkcmVzcyBmdW5kcmFpc2VyQWRkcmVzcywgYm9vbCBpc0JvbmFGaWRlKQogICAgICAgcHVibGljCiAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIGFzc2VydChpc0Z1bmRyYWlzZXIoZnVuZHJhaXNlckFkZHJlc3MpKTsKCiAgICAgICAgZnVuZHJhaXNlcnNbZnVuZHJhaXNlckFkZHJlc3NdID0gaXNCb25hRmlkZTsKICAgICAgICBMb2dVcGRhdGVGdW5kcmFpc2VyKGZ1bmRyYWlzZXJBZGRyZXNzLCBpc0JvbmFGaWRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIGZ1bmRyYWlzZXIgYWRkcmVzcyBoYXMgcmlnaHRzLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIGluIGNoZWNrCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzRnVuZHJhaXNlcihhZGRyZXNzIGZ1bmRyYWlzZXJBZGRyZXNzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGZ1bmRyYWlzZXJzW2Z1bmRyYWlzZXJBZGRyZXNzXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIHRoZSB0cmFuc2ZlcnJpbmcgb2YgdG9rZW5zIGlzIGF2YWlsYWJsZSBmdW5kcmFpc2VyLgogICAgICogQHBhcmFtIGZyb20gQWRkcmVzcyBvZiB0b2tlbiBzZW5kZXIKICAgICAqIEBwYXJhbSB0b2tlbkNvdW50IE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzVHJhbnNmZXJhYmxlKGFkZHJlc3MgZnJvbSwgdWludDI1NiB0b2tlbkNvdW50KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwIHx8IGJhbGFuY2VzW2Zyb21dIDwgdG9rZW5Db3VudCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBjb21wYW55J3MgdG9rZW5zIG1heSBiZSBsb2NrZWQgdXAKICAgICAgICBpZiAoZnJvbSA9PSBjb21wYW55KSB7CiAgICAgICAgICAgIGlmICh0b2tlbkNvdW50ID4gbnVtT2ZUcmFuc2ZlcmFibGVDb21wYW55c1Rva2VucygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50ID0gMDsKCiAgICAgICAgLy8gZWFybHkgY29udHJpYnV0b3IncyB0b2tlbnMgbWF5IGJlIGxvY2tlZCB1cAogICAgICAgIGlmIChpbml0aWFsRWNUb2tlbkFsbG9jYXRpb25bZnJvbV0gPiAwKSB7CiAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9IFNhZmVNYXRoLmFkZCgKICAgICAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCwKICAgICAgICAgICAgICAgIG51bU9mVW50cmFuc2ZlcmFibGVFY1Rva2Vucyhmcm9tKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFUCBhbmQgQ1MgcHVyY2hhc2VycycgdG9rZW5zIHNob3VsZCBiZSB1bnRyYW5zZmVyYWJsZSBpbml0aWFsbHkKICAgICAgICBpZiAoc3RhcmJhc2VDcm93ZHNhbGUuaXNFbmRlZCgpKSB7CiAgICAgICAgICAgIHVpbnQyNTYgcGFzc2VkRGF5cyA9CiAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIobm93LCBzdGFyYmFzZUNyb3dkc2FsZS5lbmRlZEF0KCkpIC8gODY0MDA7IC8vIDFkID0gODY0MDBzCiAgICAgICAgICAgIGlmIChwYXNzZWREYXlzIDwgNykgeyAgLy8gd2l0aGluIGEgd2VlawogICAgICAgICAgICAgICAgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlcnMgY2Fubm90IHRyYW5zZmVyIHRoZWlyIHRva2VucyBmb3IgYSB3ZWVrCiAgICAgICAgICAgICAgICB1bnRyYW5zZmVyYWJsZVRva2VuQ291bnQgPSBTYWZlTWF0aC5hZGQoCiAgICAgICAgICAgICAgICAgICAgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50LAogICAgICAgICAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlLm51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5KGZyb20pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFzc2VkRGF5cyA8IDE0KSB7ICAvLyB3aXRoaW4gdHdvIHdlZWtzCiAgICAgICAgICAgICAgICAvLyBlYXJseSBwdXJjaGFzZXJzIGNhbm5vdCB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZm9yIHR3byB3ZWVrcwogICAgICAgICAgICAgICAgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50ID0gU2FmZU1hdGguYWRkKAogICAgICAgICAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCwKICAgICAgICAgICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZS5udW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeShmcm9tKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9CiAgICAgICAgICAgIFNhZmVNYXRoLnN1YihiYWxhbmNlc1tmcm9tXSwgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50KTsKCiAgICAgICAgaWYgKHRyYW5zZmVyYWJsZVRva2VuQ291bnQgPCB0b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0cmFuc2ZlcmFibGUgY29tcGFueSdzIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBudW1PZlRyYW5zZmVyYWJsZUNvbXBhbnlzVG9rZW5zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHVubG9ja2VkVG9rZW5zID0gMDsKICAgICAgICBmb3IgKHVpbnQ4IGk7IGkgPCBwdWJsaWNPZmZlcmluZ1BsYW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFB1YmxpY09mZmVyaW5nUGxhbiBtZW1vcnkgcGxhbiA9IHB1YmxpY09mZmVyaW5nUGxhbnNbaV07CiAgICAgICAgICAgIGlmIChwbGFuLnVubG9ja0NvbXBhbnlzVG9rZW5zQXQgPD0gbm93KSB7CiAgICAgICAgICAgICAgICB1bmxvY2tlZFRva2VucyA9IFNhZmVNYXRoLmFkZCh1bmxvY2tlZFRva2VucywgcGxhbi50b2tlbkNvdW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKAogICAgICAgICAgICBiYWxhbmNlc1tjb21wYW55XSwKICAgICAgICAgICAgaW5pdGlhbENvbXBhbnlzVG9rZW5BbGxvY2F0aW9uIC0gdW5sb2NrZWRUb2tlbnMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdW50cmFuc2ZlcmFibGUgdG9rZW5zIG9mIHRoZSBlYXJseSBjb250cmlidXRvcgogICAgICogQHBhcmFtIF9mb3IgQWRkcmVzcyBvZiBlYXJseSBjb250cmlidXRvciB0byBjaGVjawogICAgICovCiAgICBmdW5jdGlvbiBudW1PZlVudHJhbnNmZXJhYmxlRWNUb2tlbnMoYWRkcmVzcyBfZm9yKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgaW5pdGlhbENvdW50ID0gaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uW19mb3JdOwogICAgICAgIGlmIChtdnBMYXVuY2hlZEF0ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxDb3VudDsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcGFzc2VkV2Vla3MgPSBTYWZlTWF0aC5zdWIobm93LCBtdnBMYXVuY2hlZEF0KSAvIDcgZGF5czsKICAgICAgICBpZiAocGFzc2VkV2Vla3MgPD0gNTIpIHsgICAgLy8gYSB5ZWFyIOKJiCA1MiB3ZWVrcwogICAgICAgICAgICAvLyBhbGwgdG9rZW5zIHNob3VsZCBiZSBsb2NrZWQgdXAgZm9yIGEgeWVhcgogICAgICAgICAgICByZXR1cm4gaW5pdGlhbENvdW50OwogICAgICAgIH0KCiAgICAgICAgLy8gdW5sb2NrIDEvNTIgdG9rZW5zIGV2ZXJ5IHdlZWtzIGFmdGVyIGEgeWVhcgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9IGluaXRpYWxDb3VudCAvIDUyICogKHBhc3NlZFdlZWtzIC0gNTIpOwogICAgICAgIGlmICh0cmFuc2ZlcmFibGVUb2tlbkNvdW50ID49IGluaXRpYWxDb3VudCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKGluaXRpYWxDb3VudCwgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgd2hpY2ggY2FuIGJlIGlzc3VlZCBhY2NvcmRpbmcgdG8gdGhlIGluZmxhdGlvbiBydWxlcwogICAgICovCiAgICBmdW5jdGlvbiBudW1PZkluZmxhdGFibGVUb2tlbnMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChzdGFyYmFzZUNyb3dkc2FsZS5lbmRlZEF0KCkgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBwYXNzZWREYXlzID0gU2FmZU1hdGguc3ViKG5vdywgc3RhcmJhc2VDcm93ZHNhbGUuZW5kZWRBdCgpKSAvIDg2NDAwOyAgLy8gMWQgPSA2MHMgKiA2MG0gKiAyNGggPSA4NjQwMHMKICAgICAgICB1aW50MjU2IHBhc3NlZFllYXJzID0gcGFzc2VkRGF5cyAqIDEwMCAvIDM2NTI1OyAgICAvLyBhYm91dCAzNjUuMjUgZGF5cyBpbiBhIHllYXIKICAgICAgICB1aW50MjU2IGluZmxhdGVkU3VwcGx5ID0gaW5pdGlhbFN1cHBseTsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IHBhc3NlZFllYXJzOyBpKyspIHsKICAgICAgICAgICAgaW5mbGF0ZWRTdXBwbHkgPSBTYWZlTWF0aC5hZGQoaW5mbGF0ZWRTdXBwbHksIFNhZmVNYXRoLm11bChpbmZsYXRlZFN1cHBseSwgMjUpIC8gMTAwMCk7IC8vIDIuNSUveSA9IDAuMDI1L3kKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcmVtYWluZGVyZWREYXlzID0gcGFzc2VkRGF5cyAqIDEwMCAlIDM2NTI1IC8gMTAwOwogICAgICAgIGlmIChyZW1haW5kZXJlZERheXMgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgaW5mbGF0YWJsZVRva2Vuc09mTmV4dFllYXIgPQogICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKGluZmxhdGVkU3VwcGx5LCAyNSkgLyAxMDAwOwogICAgICAgICAgICBpbmZsYXRlZFN1cHBseSA9IFNhZmVNYXRoLmFkZChpbmZsYXRlZFN1cHBseSwgU2FmZU1hdGgubXVsKAogICAgICAgICAgICAgICAgaW5mbGF0YWJsZVRva2Vuc09mTmV4dFllYXIsIHJlbWFpbmRlcmVkRGF5cyAqIDEwMCkgLyAzNjUyNSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKGluZmxhdGVkU3VwcGx5LCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgLyoKICAgICAqICBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdmFsdWUgZnJvbSBhbiBhZGRyZXNzIHRvIGFub3RoZXIgb25lLiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgY2FsbGVkIGludGVybmFsbHkuCiAgICAgKiBAcGFyYW0gZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGNvbWUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZUZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYXNzZXJ0KHZhbHVlID4gMCAmJiBiYWxhbmNlc1tmcm9tXSA+PSB2YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbZnJvbV0sIHZhbHVlKTsKICAgICAgICBiYWxhbmNlc1t0b10gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbdG9dLCB2YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
