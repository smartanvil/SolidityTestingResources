Class {
	#name : #SRTb5da84cdc928765c15a8192bf3c6649e7802772b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb5da84cdc928765c15a8192bf3c6649e7802772b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgppbnRlcmZhY2UgRVJDNzIxRW51bWVyYWJsZSAvKiBpcyBFUkM3MjEgKi8gewogICAgLy8vIEBub3RpY2UgQ291bnQgTkZUcyB0cmFja2VkIGJ5IHRoaXMgY29udHJhY3QKICAgIC8vLyBAcmV0dXJuIEEgY291bnQgb2YgdmFsaWQgTkZUcyB0cmFja2VkIGJ5IHRoaXMgY29udHJhY3QsIHdoZXJlIGVhY2ggb25lIG9mCiAgICAvLy8gIHRoZW0gaGFzIGFuIGFzc2lnbmVkIGFuZCBxdWVyeWFibGUgb3duZXIgbm90IGVxdWFsIHRvIHRoZSB6ZXJvIGFkZHJlc3MKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8vIEBub3RpY2UgRW51bWVyYXRlIHZhbGlkIE5GVHMKICAgIC8vLyBAZGV2IFRocm93cyBpZiBgX2luZGV4YCA+PSBgdG90YWxTdXBwbHkoKWAuCiAgICAvLy8gQHBhcmFtIF9pbmRleCBBIGNvdW50ZXIgbGVzcyB0aGFuIGB0b3RhbFN1cHBseSgpYAogICAgLy8vIEByZXR1cm4gVGhlIHRva2VuIGlkZW50aWZpZXIgZm9yIHRoZSBgX2luZGV4YHRoIE5GVCwKICAgIC8vLyAgKHNvcnQgb3JkZXIgbm90IHNwZWNpZmllZCkKICAgIGZ1bmN0aW9uIHRva2VuQnlJbmRleCh1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KTsKCiAgICAvLy8gQG5vdGljZSBFbnVtZXJhdGUgTkZUcyBhc3NpZ25lZCB0byBhbiBvd25lcgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfaW5kZXhgID49IGBiYWxhbmNlT2YoX293bmVyKWAgb3IgaWYKICAgIC8vLyAgYF9vd25lcmAgaXMgdGhlIHplcm8gYWRkcmVzcywgcmVwcmVzZW50aW5nIGludmFsaWQgTkZUcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFuIGFkZHJlc3Mgd2hlcmUgd2UgYXJlIGludGVyZXN0ZWQgaW4gTkZUcyBvd25lZCBieSB0aGVtCiAgICAvLy8gQHBhcmFtIF9pbmRleCBBIGNvdW50ZXIgbGVzcyB0aGFuIGBiYWxhbmNlT2YoX293bmVyKWAKICAgIC8vLyBAcmV0dXJuIFRoZSB0b2tlbiBpZGVudGlmaWVyIGZvciB0aGUgYF9pbmRleGB0aCBORlQgYXNzaWduZWQgdG8gYF9vd25lcmAsCiAgICAvLy8gICAoc29ydCBvcmRlciBub3Qgc3BlY2lmaWVkKQogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfdG9rZW5JZCk7Cn0KCmludGVyZmFjZSBFUkM3MjFNZXRhZGF0YSAvKiBpcyBFUkM3MjEgKi8gewogICAgLy8vIEBub3RpY2UgQSBkZXNjcmlwdGl2ZSBuYW1lIGZvciBhIGNvbGxlY3Rpb24gb2YgTkZUcyBpbiB0aGlzIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBuYW1lKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgX25hbWUpOwoKICAgIC8vLyBAbm90aWNlIEFuIGFiYnJldmlhdGVkIG5hbWUgZm9yIE5GVHMgaW4gdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gc3ltYm9sKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCk7CgogICAgLy8vIEBub3RpY2UgQSBkaXN0aW5jdCBVbmlmb3JtIFJlc291cmNlIElkZW50aWZpZXIgKFVSSSkgZm9yIGEgZ2l2ZW4gYXNzZXQuCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYF90b2tlbklkYCBpcyBub3QgYSB2YWxpZCBORlQuIFVSSXMgYXJlIGRlZmluZWQgaW4gUkZDCiAgICAvLy8gIDM5ODYuIFRoZSBVUkkgbWF5IHBvaW50IHRvIGEgSlNPTiBmaWxlIHRoYXQgY29uZm9ybXMgdG8gdGhlICJFUkM3MjEKICAgIC8vLyAgTWV0YWRhdGEgSlNPTiBTY2hlbWEiLgogICAgZnVuY3Rpb24gdG9rZW5VUkkodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcpOwp9Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBfbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoX25ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIF9uZXdPd25lcik7CiAgICBvd25lciA9IF9uZXdPd25lcjsKICB9Cgp9CgppbnRlcmZhY2UgRVJDNzIxVG9rZW5SZWNlaXZlciB7CiAgICAvLy8gQG5vdGljZSBIYW5kbGUgdGhlIHJlY2VpcHQgb2YgYW4gTkZUCiAgICAvLy8gQGRldiBUaGUgRVJDNzIxIHNtYXJ0IGNvbnRyYWN0IGNhbGxzIHRoaXMgZnVuY3Rpb24gb24gdGhlIHJlY2lwaWVudAogICAgLy8vICBhZnRlciBhIGB0cmFuc2ZlcmAuIFRoaXMgZnVuY3Rpb24gTUFZIHRocm93IHRvIHJldmVydCBhbmQgcmVqZWN0IHRoZQogICAgLy8vICB0cmFuc2Zlci4gVGhpcyBmdW5jdGlvbiBNVVNUIHVzZSA1MCwwMDAgZ2FzIG9yIGxlc3MuIFJldHVybiBvZiBvdGhlcgogICAgLy8vICB0aGFuIHRoZSBtYWdpYyB2YWx1ZSBNVVNUIHJlc3VsdCBpbiB0aGUgdHJhbnNhY3Rpb24gYmVpbmcgcmV2ZXJ0ZWQuCiAgICAvLy8gIE5vdGU6IHRoZSBjb250cmFjdCBhZGRyZXNzIGlzIGFsd2F5cyB0aGUgbWVzc2FnZSBzZW5kZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBzZW5kaW5nIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIE5GVCBpZGVudGlmaWVyIHdoaWNoIGlzIGJlaW5nIHRyYW5zZmVyZWQKICAgIC8vLyBAcGFyYW0gX2RhdGEgQWRkaXRpb25hbCBkYXRhIHdpdGggbm8gc3BlY2lmaWVkIGZvcm1hdAogICAgLy8vIEByZXR1cm4gYGJ5dGVzNChrZWNjYWsyNTYoIm9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyx1aW50MjU2LGJ5dGVzKSIpKWAKICAgIC8vLyAgdW5sZXNzIHRocm93aW5nCglmdW5jdGlvbiBvbkVSQzcyMVJlY2VpdmVkKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQsIGJ5dGVzIF9kYXRhKSBleHRlcm5hbCByZXR1cm5zKGJ5dGVzNCk7Cn0KCmxpYnJhcnkgTWF0aCB7CiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKY29udHJhY3QgTGljZW5zZUFjY2Vzc0NvbnRyb2wgewogIC8qKgogICAqIEBub3RpY2UgQ29udHJhY3RVcGdyYWRlIGlzIHRoZSBldmVudCB0aGF0IHdpbGwgYmUgZW1pdHRlZCBpZiB3ZSBzZXQgYSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAqLwogIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKICBldmVudCBQYXVzZWQoKTsKICBldmVudCBVbnBhdXNlZCgpOwoKICAvKioKICAgKiBAbm90aWNlIENFTydzIGFkZHJlc3MgRk9PQkFSCiAgICovCiAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKCiAgLyoqCiAgICogQG5vdGljZSBDRk8ncyBhZGRyZXNzCiAgICovCiAgYWRkcmVzcyBwdWJsaWMgY2ZvQWRkcmVzczsKCiAgLyoqCiAgICogQG5vdGljZSBDT08ncyBhZGRyZXNzCiAgICovCiAgYWRkcmVzcyBwdWJsaWMgY29vQWRkcmVzczsKCiAgLyoqCiAgICogQG5vdGljZSB3aXRoZHJhd2FsIGFkZHJlc3MKICAgKi8KICBhZGRyZXNzIHB1YmxpYyB3aXRoZHJhd2FsQWRkcmVzczsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIG9ubHkgY2FsbGFibGUgYnkgdGhlIENFTwogICAqLwogIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gb25seSBjYWxsYWJsZSBieSB0aGUgQ0ZPCiAgICovCiAgbW9kaWZpZXIgb25seUNGTygpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBvbmx5IGNhbGxhYmxlIGJ5IHRoZSBDT08KICAgKi8KICBtb2RpZmllciBvbmx5Q09PKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIG9ubHkgY2FsbGFibGUgYnkgQy1sZXZlbCBleGVjcwogICAqLwogIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICByZXF1aXJlKAogICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MgfHwKICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgIG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcwogICAgKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBvbmx5IGNhbGxhYmxlIGJ5IENFTyBvciBDRk8KICAgKi8KICBtb2RpZmllciBvbmx5Q0VPT3JDRk8oKSB7CiAgICByZXF1aXJlKAogICAgICBtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MgfHwKICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzCiAgICApOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIG9ubHkgY2FsbGFibGUgYnkgQ0VPIG9yIENPTwogICAqLwogIG1vZGlmaWVyIG9ubHlDRU9PckNPTygpIHsKICAgIHJlcXVpcmUoCiAgICAgIG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyB8fAogICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MKICAgICk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSBTZXRzIGEgbmV3IENFTwogICAqIEBwYXJhbSBfbmV3Q0VPIC0gdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgKi8KICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKICAgIGNlb0FkZHJlc3MgPSBfbmV3Q0VPOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSBTZXRzIGEgbmV3IENGTwogICAqIEBwYXJhbSBfbmV3Q0ZPIC0gdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRk8KICAgKi8KICBmdW5jdGlvbiBzZXRDRk8oYWRkcmVzcyBfbmV3Q0ZPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSBTZXRzIGEgbmV3IENPTwogICAqIEBwYXJhbSBfbmV3Q09PIC0gdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICAgKi8KICBmdW5jdGlvbiBzZXRDT08oYWRkcmVzcyBfbmV3Q09PKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlcXVpcmUoX25ld0NPTyAhPSBhZGRyZXNzKDApKTsKICAgIGNvb0FkZHJlc3MgPSBfbmV3Q09POwogIH0KCiAgLyoqCiAgICogQG5vdGljZSBTZXRzIGEgbmV3IHdpdGhkcmF3YWxBZGRyZXNzCiAgICogQHBhcmFtIF9uZXdXaXRoZHJhd2FsQWRkcmVzcyAtIHRoZSBhZGRyZXNzIHdoZXJlIHdlJ2xsIHNlbmQgdGhlIGZ1bmRzCiAgICovCiAgZnVuY3Rpb24gc2V0V2l0aGRyYXdhbEFkZHJlc3MoYWRkcmVzcyBfbmV3V2l0aGRyYXdhbEFkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgcmVxdWlyZShfbmV3V2l0aGRyYXdhbEFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICB3aXRoZHJhd2FsQWRkcmVzcyA9IF9uZXdXaXRoZHJhd2FsQWRkcmVzczsKICB9CgogIC8qKgogICAqIEBub3RpY2UgV2l0aGRyYXcgdGhlIGJhbGFuY2UgdG8gdGhlIHdpdGhkcmF3YWxBZGRyZXNzCiAgICogQGRldiBXZSBzZXQgYSB3aXRoZHJhd2FsIGFkZHJlc3Mgc2VwZXJhdGUgZnJvbSB0aGUgQ0ZPIGJlY2F1c2UgdGhpcyBhbGxvd3MgdXMgdG8gd2l0aGRyYXcgdG8gYSBjb2xkIHdhbGxldC4KICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCBvbmx5Q0VPT3JDRk8gewogICAgcmVxdWlyZSh3aXRoZHJhd2FsQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgIHdpdGhkcmF3YWxBZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICAvKiogUGF1c2FibGUgZnVuY3Rpb25hbGl0eSBhZGFwdGVkIGZyb20gT3BlblplcHBlbGluICoqLwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAbm90aWNlIGNhbGxlZCBieSBhbnkgQy1sZXZlbCB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2VkKCk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIGNhbGxlZCBieSB0aGUgQ0VPIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlZCgpOwogIH0KfQoKY29udHJhY3QgTGljZW5zZUJhc2UgaXMgTGljZW5zZUFjY2Vzc0NvbnRyb2wgewogIC8qKgogICAqIEBub3RpY2UgSXNzdWVkIGlzIGVtaXR0ZWQgd2hlbiBhIG5ldyBsaWNlbnNlIGlzIGlzc3VlZAogICAqLwogIGV2ZW50IExpY2Vuc2VJc3N1ZWQoCiAgICBhZGRyZXNzIGluZGV4ZWQgb3duZXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLAogICAgdWludDI1NiBsaWNlbnNlSWQsCiAgICB1aW50MjU2IHByb2R1Y3RJZCwKICAgIHVpbnQyNTYgYXR0cmlidXRlcywKICAgIHVpbnQyNTYgaXNzdWVkVGltZSwKICAgIHVpbnQyNTYgZXhwaXJhdGlvblRpbWUsCiAgICBhZGRyZXNzIGFmZmlsaWF0ZQogICk7CgogIGV2ZW50IExpY2Vuc2VSZW5ld2FsKAogICAgYWRkcmVzcyBpbmRleGVkIG93bmVyLAogICAgYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwKICAgIHVpbnQyNTYgbGljZW5zZUlkLAogICAgdWludDI1NiBwcm9kdWN0SWQsCiAgICB1aW50MjU2IGV4cGlyYXRpb25UaW1lCiAgKTsKCiAgc3RydWN0IExpY2Vuc2UgewogICAgdWludDI1NiBwcm9kdWN0SWQ7CiAgICB1aW50MjU2IGF0dHJpYnV0ZXM7CiAgICB1aW50MjU2IGlzc3VlZFRpbWU7CiAgICB1aW50MjU2IGV4cGlyYXRpb25UaW1lOwogICAgYWRkcmVzcyBhZmZpbGlhdGU7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEFsbCBsaWNlbnNlcyBpbiBleGlzdGVuY2UuCiAgICogQGRldiBUaGUgSUQgb2YgZWFjaCBsaWNlbnNlIGlzIGFuIGluZGV4IGluIHRoaXMgYXJyYXkuCiAgICovCiAgTGljZW5zZVtdIGxpY2Vuc2VzOwoKICAvKiogaW50ZXJuYWwgKiovCiAgZnVuY3Rpb24gX2lzVmFsaWRMaWNlbnNlKHVpbnQyNTYgX2xpY2Vuc2VJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbGljZW5zZVByb2R1Y3RJZChfbGljZW5zZUlkKSAhPSAwOwogIH0KCiAgLyoqIGFueW9uZSAqKi8KCiAgLyoqCiAgICogQG5vdGljZSBHZXQgYSBsaWNlbnNlJ3MgcHJvZHVjdElkCiAgICogQHBhcmFtIF9saWNlbnNlSWQgdGhlIGxpY2Vuc2UgaWQKICAgKi8KICBmdW5jdGlvbiBsaWNlbnNlUHJvZHVjdElkKHVpbnQyNTYgX2xpY2Vuc2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGxpY2Vuc2VzW19saWNlbnNlSWRdLnByb2R1Y3RJZDsKICB9CgogIC8qKgogICAqIEBub3RpY2UgR2V0IGEgbGljZW5zZSdzIGF0dHJpYnV0ZXMKICAgKiBAcGFyYW0gX2xpY2Vuc2VJZCB0aGUgbGljZW5zZSBpZAogICAqLwogIGZ1bmN0aW9uIGxpY2Vuc2VBdHRyaWJ1dGVzKHVpbnQyNTYgX2xpY2Vuc2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGxpY2Vuc2VzW19saWNlbnNlSWRdLmF0dHJpYnV0ZXM7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEdldCBhIGxpY2Vuc2UncyBpc3N1ZVRpbWUKICAgKiBAcGFyYW0gX2xpY2Vuc2VJZCB0aGUgbGljZW5zZSBpZAogICAqLwogIGZ1bmN0aW9uIGxpY2Vuc2VJc3N1ZWRUaW1lKHVpbnQyNTYgX2xpY2Vuc2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGxpY2Vuc2VzW19saWNlbnNlSWRdLmlzc3VlZFRpbWU7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEdldCBhIGxpY2Vuc2UncyBpc3N1ZVRpbWUKICAgKiBAcGFyYW0gX2xpY2Vuc2VJZCB0aGUgbGljZW5zZSBpZAogICAqLwogIGZ1bmN0aW9uIGxpY2Vuc2VFeHBpcmF0aW9uVGltZSh1aW50MjU2IF9saWNlbnNlSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBsaWNlbnNlc1tfbGljZW5zZUlkXS5leHBpcmF0aW9uVGltZTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgR2V0IGEgdGhlIGFmZmlsaWF0ZSBjcmVkaXRlZCBmb3IgdGhlIHNhbGUgb2YgdGhpcyBsaWNlbnNlCiAgICogQHBhcmFtIF9saWNlbnNlSWQgdGhlIGxpY2Vuc2UgaWQKICAgKi8KICBmdW5jdGlvbiBsaWNlbnNlQWZmaWxpYXRlKHVpbnQyNTYgX2xpY2Vuc2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgcmV0dXJuIGxpY2Vuc2VzW19saWNlbnNlSWRdLmFmZmlsaWF0ZTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgR2V0IGEgbGljZW5zZSdzIGluZm8KICAgKiBAcGFyYW0gX2xpY2Vuc2VJZCB0aGUgbGljZW5zZSBpZAogICAqLwogIGZ1bmN0aW9uIGxpY2Vuc2VJbmZvKHVpbnQyNTYgX2xpY2Vuc2VJZCkKICAgIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIGFkZHJlc3MpCiAgewogICAgcmV0dXJuICgKICAgICAgbGljZW5zZVByb2R1Y3RJZChfbGljZW5zZUlkKSwKICAgICAgbGljZW5zZUF0dHJpYnV0ZXMoX2xpY2Vuc2VJZCksCiAgICAgIGxpY2Vuc2VJc3N1ZWRUaW1lKF9saWNlbnNlSWQpLAogICAgICBsaWNlbnNlRXhwaXJhdGlvblRpbWUoX2xpY2Vuc2VJZCksCiAgICAgIGxpY2Vuc2VBZmZpbGlhdGUoX2xpY2Vuc2VJZCkKICAgICk7CiAgfQp9Cgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9Cgpjb250cmFjdCBBZmZpbGlhdGVQcm9ncmFtIGlzIFBhdXNhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZXZlbnQgQWZmaWxpYXRlQ3JlZGl0KAogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGFmZmlsaWF0ZQogICAgYWRkcmVzcyBhZmZpbGlhdGUsCiAgICAvLyBUaGUgc3RvcmUncyBJRCBvZiB3aGF0IHdhcyBzb2xkIChlLmcuIGEgdG9rZW5JZCkKICAgIHVpbnQyNTYgcHJvZHVjdElkLAogICAgLy8gVGhlIGFtb3VudCBvd2VkIHRoaXMgYWZmaWxpYXRlIGluIHRoaXMgc2FsZQogICAgdWludDI1NiBhbW91bnQKICApOwoKICBldmVudCBXaXRoZHJhdyhhZGRyZXNzIGFmZmlsaWF0ZSwgYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWZmaWxpYXRlLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgUmF0ZUNoYW5nZWQodWludDI1NiByYXRlLCB1aW50MjU2IGFtb3VudCk7CgogIC8vIEBub3RpY2UgQSBtYXBwaW5nIGZyb20gYWZmaWxpYXRlIGFkZHJlc3MgdG8gdGhlaXIgYmFsYW5jZQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VzOwoKICAvLyBAbm90aWNlIEEgbWFwcGluZyBmcm9tIGFmZmlsaWF0ZSBhZGRyZXNzIHRvIHRoZSB0aW1lIG9mIGxhc3QgZGVwb3NpdAogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGxhc3REZXBvc2l0VGltZXM7CgogIC8vIEBub3RpY2UgVGhlIGxhc3QgZGVwb3NpdCBnbG9iYWxseQogIHVpbnQyNTYgcHVibGljIGxhc3REZXBvc2l0VGltZTsKCiAgLy8gQG5vdGljZSBUaGUgbWF4aW11bSByYXRlIGZvciBhbnkgYWZmaWxpYXRlCiAgLy8gQGRldiBUaGUgaGFyZC1jb2RlZCBtYXhpbXVtIGFmZmlsaWF0ZSByYXRlIChpbiBiYXNpcyBwb2ludHMpCiAgLy8gQWxsIHJhdGVzIGFyZSBtZWFzdXJlZCBpbiBiYXNpcyBwb2ludHMgKDEvMTAwIG9mIGEgcGVyY2VudCkKICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgaGFyZENvZGVkTWF4aW11bVJhdGUgPSA1MDAwOwoKICAvLyBAbm90aWNlIFRoZSBjb21taXNzaW9uIGV4aXJhdGlvbiB0aW1lCiAgLy8gQGRldiBBZmZpbGlhdGUgY29tbWlzc2lvbnMgZXhwaXJlIGlmIHRoZXkgYXJlIHVuY2xhaW1lZCBhZnRlciB0aGlzIGFtb3VudCBvZiB0aW1lCiAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IGNvbW1pc3Npb25FeHBpcnlUaW1lID0gMzAgZGF5czsKCiAgLy8gQG5vdGljZSBUaGUgYmFzZWxpbmUgYWZmaWxpYXRlIHJhdGUgKGluIGJhc2lzIHBvaW50cykgZm9yIG5vbi13aGl0ZWxpc3RlZCByZWZlcnJhbHMKICB1aW50MjU2IHB1YmxpYyBiYXNlbGluZVJhdGUgPSAwOwoKICAvLyBAbm90aWNlIEEgbWFwcGluZyBmcm9tIHdoaXRlbGlzdGVkIHJlZmVycmFscyB0byB0aGVpciBpbmRpdmlkdWFsIHJhdGVzCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgd2hpdGVsaXN0UmF0ZXM7CgogIC8vIEBub3RpY2UgVGhlIG1heGltdW0gcmF0ZSBmb3IgYW55IGFmZmlsaWF0ZQogIC8vIEBkZXYgb3ZlcnJpZGVzIGluZGl2aWR1YWwgcmF0ZXMuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2xpcCB0aGUgcmF0ZSB1c2VkIGluIGJ1bGssIGlmIG5lY2Vzc2FyeQogIHVpbnQyNTYgcHVibGljIG1heGltdW1SYXRlID0gNTAwMDsKCiAgLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgc3RvcmUgc2VsbGluZyBwcm9kdWN0cwogIGFkZHJlc3MgcHVibGljIHN0b3JlQWRkcmVzczsKCiAgLy8gQG5vdGljZSBUaGUgY29udHJhY3QgaXMgcmV0aXJlZAogIC8vIEBkZXYgSWYgd2UgZGVjaWRlIHRvIHJldGlyZSB0aGlzIHByb2dyYW0sIHRoaXMgdmFsdWUgd2lsbCBiZSBzZXQgdG8gdHJ1ZQogIC8vIGFuZCB0aGVuIHRoZSBjb250cmFjdCBjYW5ub3QgYmUgdW5wYXVzZWQKICBib29sIHB1YmxpYyByZXRpcmVkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBvbmx5IGNhbGxhYmxlIGJ5IHRoZSBzdG9yZSBvciB0aGUgb3duZXIKICAgKi8KICBtb2RpZmllciBvbmx5U3RvcmVPck93bmVyKCkgewogICAgcmVxdWlyZSgKICAgICAgbXNnLnNlbmRlciA9PSBzdG9yZUFkZHJlc3MgfHwKICAgICAgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBZmZpbGlhdGVQcm9ncmFtIGNvbnN0cnVjdG9yIC0ga2VlcHMgdGhlIGFkZHJlc3Mgb2YgaXQncyBwYXJlbnQgc3RvcmUKICAgKiBhbmQgcGF1c2VzIHRoZSBjb250cmFjdAogICAqLwogIGZ1bmN0aW9uIEFmZmlsaWF0ZVByb2dyYW0oYWRkcmVzcyBfc3RvcmVBZGRyZXNzKSBwdWJsaWMgewogICAgcmVxdWlyZShfc3RvcmVBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgc3RvcmVBZGRyZXNzID0gX3N0b3JlQWRkcmVzczsKICAgIHBhdXNlZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEV4cG9zZXMgdGhhdCB0aGlzIGNvbnRyYWN0IHRoaW5rcyBpdCBpcyBhbiBBZmZpbGlhdGVQcm9ncmFtCiAgICovCiAgZnVuY3Rpb24gaXNBZmZpbGlhdGVQcm9ncmFtKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIHJldHVybnMgdGhlIGNvbW1pc3Npb24gcmF0ZSBmb3IgYSBzYWxlCiAgICoKICAgKiBAZGV2IHJhdGVGb3IgcmV0dXJucyB0aGUgcmF0ZSB3aGljaCBzaG91bGQgYmUgdXNlZCB0byBjYWxjdWxhdGUgdGhlIGNvbWlzc2lvbgogICAqICBmb3IgdGhpcyBhZmZpbGlhdGUvc2FsZSBjb21iaW5hdGlvbiwgaW4gYmFzaXMgcG9pbnRzICgxLzEwMHRoIG9mIGEgcGVyY2VudCkuCiAgICoKICAgKiAgV2UgbWF5IHdhbnQgdG8gY29tcGxldGVseSBibGFja2xpc3QgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGUuZy4gYSBrbm93biBiYWQgYWN0b3IgYWZmaWxpdGUpLgogICAqICBUbyB0aGF0IGVuZCwgaWYgdGhlIHdoaXRlbGlzdFJhdGUgaXMgZXhhY3RseSAxYnAsIHdlIHVzZSB0aGF0IGFzIGEgc2lnbmFsIGZvciBibGFja2xpc3RpbmcKICAgKiAgYW5kIHJldHVybiBhIHJhdGUgb2YgemVyby4gVGhlIHVwc2lkZSBpcyB0aGF0IHdlIGNhbiBjb21wbGV0ZWx5IHR1cm4gb2ZmCiAgICogIHNlbmRpbmcgdHJhbnNhY3Rpb25zIHRvIGEgcGFydGljdWxhciBhZGRyZXNzIHdoZW4gdGhpcyBpcyBuZWVkZWQuIFRoZQogICAqICBkb3duc2lkZSBpcyB0aGF0IHlvdSBjYW4ndCBpc3N1ZWQgMS8xMDB0aCBvZiBhIHBlcmNlbnQgY29tbWlzc2lvbi4KICAgKiAgSG93ZXZlciwgc2luY2UgdGhpcyBpcyBzdWNoIGEgc21hbGwgYW1vdW50IGl0cyBhbiBhY2NlcHRhYmxlIHRyYWRlb2ZmLgogICAqCiAgICogIFRoaXMgaW1wbGVtZW50YXRpb24gZG9lcyBub3QgdXNlIHRoZSBfcHJvZHVjdElkLCBfcHJ1Y2hhc2VJZCwKICAgKiAgX3B1cmNoYXNlQW1vdW50LCBidXQgd2UgaW5jbHVkZSB0aGVtIGhlcmUgYXMgcGFydCBvZiB0aGUgcHJvdG9jb2wsIGJlY2F1c2UKICAgKiAgdGhleSBjb3VsZCBiZSB1c2VmdWwgaW4gbW9yZSBhZHZhbmNlZCBhZmZpbGlhdGUgcHJvZ3JhbXMuCiAgICoKICAgKiBAcGFyYW0gX2FmZmlsaWF0ZSAtIHRoZSBhZGRyZXNzIG9mIHRoZSBhZmZpbGlhdGUgdG8gY2hlY2sgZm9yCiAgICovCiAgZnVuY3Rpb24gcmF0ZUZvcigKICAgIGFkZHJlc3MgX2FmZmlsaWF0ZSwKICAgIHVpbnQyNTYgLypfcHJvZHVjdElkKi8sCiAgICB1aW50MjU2IC8qX3B1cmNoYXNlSWQqLywKICAgIHVpbnQyNTYgLypfcHVyY2hhc2VBbW91bnQqLykKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICB7CiAgICB1aW50MjU2IHdoaXRlbGlzdGVkUmF0ZSA9IHdoaXRlbGlzdFJhdGVzW19hZmZpbGlhdGVdOwogICAgaWYod2hpdGVsaXN0ZWRSYXRlID4gMCkgewogICAgICAvLyB1c2UgMSBicCBhcyBhIGJsYWNrbGlzdCBzaWduYWwKICAgICAgaWYod2hpdGVsaXN0ZWRSYXRlID09IDEpIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gTWF0aC5taW4yNTYod2hpdGVsaXN0ZWRSYXRlLCBtYXhpbXVtUmF0ZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBNYXRoLm1pbjI1NihiYXNlbGluZVJhdGUsIG1heGltdW1SYXRlKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBub3RpY2UgY3V0Rm9yIHJldHVybnMgdGhlIGFmZmlsaWF0ZSBjdXQgZm9yIGEgc2FsZQogICAqIEBkZXYgY3V0Rm9yIHJldHVybnMgdGhlIGN1dCAoYW1vdW50IGluIHdlaSkgdG8gZ2l2ZSBpbiBjb21pc3Npb24gdG8gdGhlIGFmZmlsaWF0ZQogICAqCiAgICogQHBhcmFtIF9hZmZpbGlhdGUgLSB0aGUgYWRkcmVzcyBvZiB0aGUgYWZmaWxpYXRlIHRvIGNoZWNrIGZvcgogICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3RJZCBpbiB0aGUgc2FsZQogICAqIEBwYXJhbSBfcHVyY2hhc2VJZCAtIHRoZSBwdXJjaGFzZUlkIGluIHRoZSBzYWxlCiAgICogQHBhcmFtIF9wdXJjaGFzZUFtb3VudCAtIHRoZSBwdXJjaGFzZUFtb3VudAogICAqLwogIGZ1bmN0aW9uIGN1dEZvcigKICAgIGFkZHJlc3MgX2FmZmlsaWF0ZSwKICAgIHVpbnQyNTYgX3Byb2R1Y3RJZCwKICAgIHVpbnQyNTYgX3B1cmNoYXNlSWQsCiAgICB1aW50MjU2IF9wdXJjaGFzZUFtb3VudCkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICB7CiAgICB1aW50MjU2IHJhdGUgPSByYXRlRm9yKAogICAgICBfYWZmaWxpYXRlLAogICAgICBfcHJvZHVjdElkLAogICAgICBfcHVyY2hhc2VJZCwKICAgICAgX3B1cmNoYXNlQW1vdW50KTsKICAgIHJlcXVpcmUocmF0ZSA8PSBoYXJkQ29kZWRNYXhpbXVtUmF0ZSk7CiAgICByZXR1cm4gKF9wdXJjaGFzZUFtb3VudC5tdWwocmF0ZSkpLmRpdigxMDAwMCk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIGNyZWRpdCBhbiBhZmZpbGlhdGUgZm9yIGEgcHVyY2hhc2UKICAgKiBAZGV2IGNyZWRpdCBhY2NlcHRzIGV0aCBhbmQgY3JlZGl0cyB0aGUgYWZmaWxpYXRlJ3MgYmFsYW5jZSBmb3IgdGhlIGFtb3VudAogICAqCiAgICogQHBhcmFtIF9hZmZpbGlhdGUgLSB0aGUgYWRkcmVzcyBvZiB0aGUgYWZmaWxpYXRlIHRvIGNyZWRpdAogICAqIEBwYXJhbSBfcHVyY2hhc2VJZCAtIHRoZSBwdXJjaGFzZUlkIG9mIHRoZSBzYWxlCiAgICovCiAgZnVuY3Rpb24gY3JlZGl0KAogICAgYWRkcmVzcyBfYWZmaWxpYXRlLAogICAgdWludDI1NiBfcHVyY2hhc2VJZCkKICAgIHB1YmxpYwogICAgb25seVN0b3JlT3JPd25lcgogICAgd2hlbk5vdFBhdXNlZAogICAgcGF5YWJsZQogIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICByZXF1aXJlKF9hZmZpbGlhdGUgIT0gYWRkcmVzcygwKSk7CiAgICBiYWxhbmNlc1tfYWZmaWxpYXRlXSArPSBtc2cudmFsdWU7CiAgICBsYXN0RGVwb3NpdFRpbWVzW19hZmZpbGlhdGVdID0gbm93OyAvLyBzb2xpdW0tZGlzYWJsZS1saW5lIHNlY3VyaXR5L25vLWJsb2NrLW1lbWJlcnMKICAgIGxhc3REZXBvc2l0VGltZSA9IG5vdzsgLy8gc29saXVtLWRpc2FibGUtbGluZSBzZWN1cml0eS9uby1ibG9jay1tZW1iZXJzCiAgICBBZmZpbGlhdGVDcmVkaXQoX2FmZmlsaWF0ZSwgX3B1cmNoYXNlSWQsIG1zZy52YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IF9wZXJmb3JtV2l0aGRyYXcgcGVyZm9ybXMgYSB3aXRoZHJhd2FsIGZyb20gYWRkcmVzcyBfZnJvbSBhbmQKICAgKiB0cmFuc2ZlcnMgaXQgdG8gX3RvLiBUaGlzIGNhbiBiZSBkaWZmZXJlbnQgYmVjYXVzZSB3ZSBhbGxvdyB0aGUgb3duZXIKICAgKiB0byB3aXRoZHJhdyB1bmNsYWltZWQgZnVuZHMgYWZ0ZXIgYSBwZXJpb2Qgb2YgdGltZS4KICAgKgogICAqIEBwYXJhbSBfZnJvbSAtIHRoZSBhZGRyZXNzIHRvIHN1YnRyYWN0IGJhbGFuY2UgZnJvbQogICAqIEBwYXJhbSBfdG8gLSB0aGUgYWRkcmVzcyB0byB0cmFuc2ZlciBFVEggdG8KICAgKi8KICBmdW5jdGlvbiBfcGVyZm9ybVdpdGhkcmF3KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBwcml2YXRlIHsKICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID4gMCk7CiAgICB1aW50MjU2IGJhbGFuY2VWYWx1ZSA9IGJhbGFuY2VzW19mcm9tXTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IDA7CiAgICBfdG8udHJhbnNmZXIoYmFsYW5jZVZhbHVlKTsKICAgIFdpdGhkcmF3KF9mcm9tLCBfdG8sIGJhbGFuY2VWYWx1ZSk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIHdpdGhkcmF3CiAgICogQGRldiB3aXRoZHJhdyB0aGUgbXNnLnNlbmRlcidzIGJhbGFuY2UKICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgIF9wZXJmb3JtV2l0aGRyYXcobXNnLnNlbmRlciwgbXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIHdpdGhkcmF3IGZyb20gYSBzcGVjaWZpYyBhY2NvdW50CiAgICogQGRldiB3aXRoZHJhd0Zyb20gYWxsb3dzIHRoZSBvd25lciB0byB3aXRoZHJhdyBhbiBhZmZpbGlhdGUncyB1bmNsYWltZWQKICAgKiBFVEgsIGFmdGVyIHRoZSBhbG90dGVkIHRpbWUuCiAgICoKICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgZXZlbiBpZiB0aGUgY29udHJhY3QgaXMgcGF1c2VkCiAgICoKICAgKiBAcGFyYW0gX2FmZmlsaWF0ZSAtIHRoZSBhZGRyZXNzIG9mIHRoZSBhZmZpbGlhdGUKICAgKiBAcGFyYW0gX3RvIC0gdGhlIGFkZHJlc3MgdG8gc2VuZCBFVEggdG8KICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd0Zyb20oYWRkcmVzcyBfYWZmaWxpYXRlLCBhZGRyZXNzIF90bykgb25seU93bmVyIHB1YmxpYyB7CiAgICAvLyBzb2xpdW0tZGlzYWJsZS1uZXh0LWxpbmUgc2VjdXJpdHkvbm8tYmxvY2stbWVtYmVycwogICAgcmVxdWlyZShub3cgPiBsYXN0RGVwb3NpdFRpbWVzW19hZmZpbGlhdGVdLmFkZChjb21taXNzaW9uRXhwaXJ5VGltZSkpOwogICAgX3BlcmZvcm1XaXRoZHJhdyhfYWZmaWxpYXRlLCBfdG8pOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSByZXRpcmUgdGhlIGNvbnRyYWN0IChkYW5nZXJvdXMpCiAgICogQGRldiByZXRpcmUgLSB3aXRoZHJhd3MgdGhlIGVudGlyZSBiYWxhbmNlIGFuZCBtYXJrcyB0aGUgY29udHJhY3QgYXMgcmV0aXJlZCwgd2hpY2gKICAgKiBwcmV2ZW50cyB1bnBhdXNpbmcuCiAgICoKICAgKiBJZiBubyBuZXcgY29taXNzaW9ucyBoYXZlIGJlZW4gZGVwb3NpdGVkIGZvciB0aGUgYWxvdHRlZCB0aW1lLAogICAqIHRoZW4gdGhlIG93bmVyIG1heSBwYXVzZSB0aGUgcHJvZ3JhbSBhbmQgcmV0aXJlIHRoaXMgY29udHJhY3QuCiAgICogVGhpcyBtYXkgb25seSBiZSBwZXJmb3JtZWQgb25jZSBhcyB0aGUgY29udHJhY3QgY2Fubm90IGJlIHVucGF1c2VkLgogICAqCiAgICogV2UgZG8gdGhpcyBhcyBhbiBhbHRlcm5hdGl2ZSB0byBzZWxmZGVzdHJ1Y3QsIGJlY2F1c2UgY2VydGFpbiBvcGVyYXRpb25zCiAgICogY2FuIHN0aWxsIGJlIHBlcmZvcm1lZCBhZnRlciB0aGUgY29udHJhY3QgaGFzIGJlZW4gc2VsZmRlc3RydWN0ZWQsIHN1Y2ggYXMKICAgKiB0aGUgb3duZXIgd2l0aGRyYXdpbmcgRVRIIGFjY2lkZW50YWxseSBzZW50IGhlcmUuCiAgICovCiAgZnVuY3Rpb24gcmV0aXJlKGFkZHJlc3MgX3RvKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgLy8gc29saXVtLWRpc2FibGUtbmV4dC1saW5lIHNlY3VyaXR5L25vLWJsb2NrLW1lbWJlcnMKICAgIHJlcXVpcmUobm93ID4gbGFzdERlcG9zaXRUaW1lLmFkZChjb21taXNzaW9uRXhwaXJ5VGltZSkpOwogICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICByZXRpcmVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBub3RpY2Ugd2hpdGVsaXN0IGFuIGFmZmlsaWF0ZSBhZGRyZXNzCiAgICogQGRldiB3aGl0ZWxpc3QgLSB3aGl0ZSBsaXN0ZWQgYWZmaWxpYXRlcyBjYW4gcmVjZWl2ZSBhIGRpZmZlcmVudAogICAqICAgcmF0ZSB0aGFuIHRoZSBnZW5lcmFsIHB1YmxpYyAod2hpdGVsaXN0ZWQgYWNjb3VudHMgd291bGQgZ2VuZXJhbGx5IGdldCBhCiAgICogICBiZXR0ZXIgcmF0ZSkuCiAgICogQHBhcmFtIF9hZmZpbGlhdGUgLSB0aGUgYWZmaWxpYXRlIGFkZHJlc3MgdG8gd2hpdGVsaXN0CiAgICogQHBhcmFtIF9yYXRlIC0gdGhlIHJhdGUsIGluIGJhc2lzLXBvaW50cyAoMS8xMDB0aCBvZiBhIHBlcmNlbnQpIHRvIGdpdmUgdGhpcyBhZmZpbGlhdGUgaW4gZWFjaCBzYWxlLiBOT1RFOiBhIHJhdGUgb2YgZXhhY3RseSAxIGlzIHRoZSBzaWduYWwgdG8gYmxhY2tsaXN0IHRoaXMgYWZmaWxpYXRlLiBUaGF0IGlzLCBhIHJhdGUgb2YgMSB3aWxsIHNldCB0aGUgY29tbWlzc2lvbiB0byAwLgogICAqLwogIGZ1bmN0aW9uIHdoaXRlbGlzdChhZGRyZXNzIF9hZmZpbGlhdGUsIHVpbnQyNTYgX3JhdGUpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShfcmF0ZSA8PSBoYXJkQ29kZWRNYXhpbXVtUmF0ZSk7CiAgICB3aGl0ZWxpc3RSYXRlc1tfYWZmaWxpYXRlXSA9IF9yYXRlOwogICAgV2hpdGVsaXN0ZWQoX2FmZmlsaWF0ZSwgX3JhdGUpOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSBzZXQgdGhlIHJhdGUgZm9yIG5vbi13aGl0ZWxpc3RlZCBhZmZpbGlhdGVzCiAgICogQGRldiBzZXRCYXNlbGluZVJhdGUgLSBzZXRzIHRoZSBiYXNlbGluZSByYXRlIGZvciBhbnkgYWZmaWxpYXRlIHRoYXQgaXMgbm90IHdoaXRlbGlzdGVkCiAgICogQHBhcmFtIF9uZXdSYXRlIC0gdGhlIHJhdGUsIGluIGJwICgxLzEwMHRoIG9mIGEgcGVyY2VudCkgdG8gZ2l2ZSBhbnkgbm9uLXdoaXRlbGlzdGVkIGFmZmlsaWF0ZS4gU2V0IHRvIHplcm8gdG8gInR1cm4gb2ZmIgogICAqLwogIGZ1bmN0aW9uIHNldEJhc2VsaW5lUmF0ZSh1aW50MjU2IF9uZXdSYXRlKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoX25ld1JhdGUgPD0gaGFyZENvZGVkTWF4aW11bVJhdGUpOwogICAgYmFzZWxpbmVSYXRlID0gX25ld1JhdGU7CiAgICBSYXRlQ2hhbmdlZCgwLCBfbmV3UmF0ZSk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIHNldCB0aGUgbWF4aW11bSByYXRlIGZvciBhbnkgYWZmaWxpYXRlCiAgICogQGRldiBzZXRNYXhpbXVtUmF0ZSAtIFNldCB0aGUgbWF4aW11bSByYXRlIGZvciBhbnkgYWZmaWxpYXRlLCBpbmNsdWRpbmcgd2hpdGVsaXN0cy4gVGhhdCBpcywgdGhpcyBvdmVycmlkZXMgaW5kaXZpZHVhbCByYXRlcy4KICAgKiBAcGFyYW0gX25ld1JhdGUgLSB0aGUgcmF0ZSwgaW4gYnAgKDEvMTAwdGggb2YgYSBwZXJjZW50KQogICAqLwogIGZ1bmN0aW9uIHNldE1heGltdW1SYXRlKHVpbnQyNTYgX25ld1JhdGUpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShfbmV3UmF0ZSA8PSBoYXJkQ29kZWRNYXhpbXVtUmF0ZSk7CiAgICBtYXhpbXVtUmF0ZSA9IF9uZXdSYXRlOwogICAgUmF0ZUNoYW5nZWQoMSwgX25ld1JhdGUpOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSB1bnBhdXNlIHRoZSBjb250cmFjdAogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZS4gV2lsbCBub3QKICAgKiB1bnBhdXNlIGlmIHRoZSBjb250cmFjdCBpcyByZXRpcmVkLgogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcmVxdWlyZSghcmV0aXJlZCk7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cgp9Cgpjb250cmFjdCBFUkM3MjEgewogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9hcHByb3ZlZCwgdWludDI1NiBfdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWxGb3JBbGwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpOwoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2JhbGFuY2UpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQsIGJ5dGVzIGRhdGEpIHB1YmxpYzsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgZnVuY3Rpb24gc2V0QXBwcm92YWxGb3JBbGwoYWRkcmVzcyBfdG8sIGJvb2wgX2FwcHJvdmVkKSBleHRlcm5hbDsKICBmdW5jdGlvbiBnZXRBcHByb3ZlZCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yQWxsKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9vcGVyYXRvcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IExpY2Vuc2VJbnZlbnRvcnkgaXMgTGljZW5zZUJhc2UgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBldmVudCBQcm9kdWN0Q3JlYXRlZCgKICAgIHVpbnQyNTYgaWQsCiAgICB1aW50MjU2IHByaWNlLAogICAgdWludDI1NiBhdmFpbGFibGUsCiAgICB1aW50MjU2IHN1cHBseSwKICAgIHVpbnQyNTYgaW50ZXJ2YWwsCiAgICBib29sIHJlbmV3YWJsZQogICk7CiAgZXZlbnQgUHJvZHVjdEludmVudG9yeUFkanVzdGVkKHVpbnQyNTYgcHJvZHVjdElkLCB1aW50MjU2IGF2YWlsYWJsZSk7CiAgZXZlbnQgUHJvZHVjdFByaWNlQ2hhbmdlZCh1aW50MjU2IHByb2R1Y3RJZCwgdWludDI1NiBwcmljZSk7CiAgZXZlbnQgUHJvZHVjdFJlbmV3YWJsZUNoYW5nZWQodWludDI1NiBwcm9kdWN0SWQsIGJvb2wgcmVuZXdhYmxlKTsKCgogIC8qKgogICAqIEBub3RpY2UgUHJvZHVjdCBkZWZpbmVzIGEgcHJvZHVjdAogICAqICogcmVuZXdhYmxlOiBUaGVyZSBtYXkgY29tZSBhIHRpbWUgd2hlbiB3ZSB3aGljaCB0byBkaXNhYmxlIHRoZSBhYmlsaXR5IHRvIHJlbmV3IGEgc3Vic2NyaXB0aW9uLiBGb3IgZXhhbXBsZSwgYSBwbGFuIHdlIG5vIGxvbmdlciB3aXNoIHRvIHN1cHBvcnQuIE9idmlvdXNseSBjYXJlIG5lZWRzIHRvIGJlIHRha2VuIHdpdGggaG93IHdlIGNvbW11bmljYXRlIHRoaXMgdG8gY3VzdG9tZXJzLCBidXQgY29udHJhY3Qtd2lzZSwgd2Ugd2FudCB0byBzdXBwb3J0IHRoZSBhYmlsaXR5IHRvIGRpc2NvbnRpbnVlIHJlbmV3YWwgb2YgY2VydGFpbiBwbGFucy4KICAqLwogIHN0cnVjdCBQcm9kdWN0IHsKICAgIHVpbnQyNTYgaWQ7CiAgICB1aW50MjU2IHByaWNlOwogICAgdWludDI1NiBhdmFpbGFibGU7CiAgICB1aW50MjU2IHN1cHBseTsKICAgIHVpbnQyNTYgc29sZDsKICAgIHVpbnQyNTYgaW50ZXJ2YWw7CiAgICBib29sIHJlbmV3YWJsZTsKICB9CgogIC8vIEBub3RpY2UgQWxsIHByb2R1Y3RzIGluIGV4aXN0ZW5jZQogIHVpbnQyNTZbXSBwdWJsaWMgYWxsUHJvZHVjdElkczsKCiAgLy8gQG5vdGljZSBBIG1hcHBpbmcgZnJvbSBwcm9kdWN0IGlkcyB0byBQcm9kdWN0cwogIG1hcHBpbmcgKHVpbnQyNTYgPT4gUHJvZHVjdCkgcHVibGljIHByb2R1Y3RzOwoKICAvKioqIGludGVybmFsICoqKi8KCiAgLyoqCiAgICogQG5vdGljZSBfcHJvZHVjdEV4aXN0cyBjaGVja3MgdG8gc2VlIGlmIGEgcHJvZHVjdCBleGlzdHMKICAgKi8KICBmdW5jdGlvbiBfcHJvZHVjdEV4aXN0cyh1aW50MjU2IF9wcm9kdWN0SWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHByb2R1Y3RzW19wcm9kdWN0SWRdLmlkICE9IDA7CiAgfQoKICBmdW5jdGlvbiBfcHJvZHVjdERvZXNOb3RFeGlzdCh1aW50MjU2IF9wcm9kdWN0SWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHByb2R1Y3RzW19wcm9kdWN0SWRdLmlkID09IDA7CiAgfQoKICBmdW5jdGlvbiBfY3JlYXRlUHJvZHVjdCgKICAgIHVpbnQyNTYgX3Byb2R1Y3RJZCwKICAgIHVpbnQyNTYgX2luaXRpYWxQcmljZSwKICAgIHVpbnQyNTYgX2luaXRpYWxJbnZlbnRvcnlRdWFudGl0eSwKICAgIHVpbnQyNTYgX3N1cHBseSwKICAgIHVpbnQyNTYgX2ludGVydmFsKQogICAgaW50ZXJuYWwKICB7CiAgICByZXF1aXJlKF9wcm9kdWN0RG9lc05vdEV4aXN0KF9wcm9kdWN0SWQpKTsKICAgIHJlcXVpcmUoX2luaXRpYWxJbnZlbnRvcnlRdWFudGl0eSA8PSBfc3VwcGx5KTsKCiAgICBQcm9kdWN0IG1lbW9yeSBfcHJvZHVjdCA9IFByb2R1Y3QoewogICAgICBpZDogX3Byb2R1Y3RJZCwKICAgICAgcHJpY2U6IF9pbml0aWFsUHJpY2UsCiAgICAgIGF2YWlsYWJsZTogX2luaXRpYWxJbnZlbnRvcnlRdWFudGl0eSwKICAgICAgc3VwcGx5OiBfc3VwcGx5LAogICAgICBzb2xkOiAwLAogICAgICBpbnRlcnZhbDogX2ludGVydmFsLAogICAgICByZW5ld2FibGU6IF9pbnRlcnZhbCA9PSAwID8gZmFsc2UgOiB0cnVlCiAgICB9KTsKCiAgICBwcm9kdWN0c1tfcHJvZHVjdElkXSA9IF9wcm9kdWN0OwogICAgYWxsUHJvZHVjdElkcy5wdXNoKF9wcm9kdWN0SWQpOwoKICAgIFByb2R1Y3RDcmVhdGVkKAogICAgICBfcHJvZHVjdC5pZCwKICAgICAgX3Byb2R1Y3QucHJpY2UsCiAgICAgIF9wcm9kdWN0LmF2YWlsYWJsZSwKICAgICAgX3Byb2R1Y3Quc3VwcGx5LAogICAgICBfcHJvZHVjdC5pbnRlcnZhbCwKICAgICAgX3Byb2R1Y3QucmVuZXdhYmxlCiAgICAgICk7CiAgfQoKICBmdW5jdGlvbiBfaW5jcmVtZW50SW52ZW50b3J5KAogICAgdWludDI1NiBfcHJvZHVjdElkLAogICAgdWludDI1NiBfaW52ZW50b3J5QWRqdXN0bWVudCkKICAgIGludGVybmFsCiAgewogICAgcmVxdWlyZShfcHJvZHVjdEV4aXN0cyhfcHJvZHVjdElkKSk7CiAgICB1aW50MjU2IG5ld0ludmVudG9yeUxldmVsID0gcHJvZHVjdHNbX3Byb2R1Y3RJZF0uYXZhaWxhYmxlLmFkZChfaW52ZW50b3J5QWRqdXN0bWVudCk7CgogICAgLy8gQSBzdXBwbHkgb2YgIjAiIG1lYW5zICJ1bmxpbWl0ZWQiLiBPdGhlcndpc2Ugd2UgbmVlZCB0byBlbnN1cmUgdGhhdCB3ZSdyZSBub3Qgb3Zlci1jcmVhdGluZyB0aGlzIHByb2R1Y3QKICAgIGlmKHByb2R1Y3RzW19wcm9kdWN0SWRdLnN1cHBseSA+IDApIHsKICAgICAgLy8geW91IGhhdmUgdG8gdGFrZSBhbHJlYWR5IHNvbGQgaW50byBhY2NvdW50CiAgICAgIHJlcXVpcmUocHJvZHVjdHNbX3Byb2R1Y3RJZF0uc29sZC5hZGQobmV3SW52ZW50b3J5TGV2ZWwpIDw9IHByb2R1Y3RzW19wcm9kdWN0SWRdLnN1cHBseSk7CiAgICB9CgogICAgcHJvZHVjdHNbX3Byb2R1Y3RJZF0uYXZhaWxhYmxlID0gbmV3SW52ZW50b3J5TGV2ZWw7CiAgfQoKICBmdW5jdGlvbiBfZGVjcmVtZW50SW52ZW50b3J5KAogICAgdWludDI1NiBfcHJvZHVjdElkLAogICAgdWludDI1NiBfaW52ZW50b3J5QWRqdXN0bWVudCkKICAgIGludGVybmFsCiAgewogICAgcmVxdWlyZShfcHJvZHVjdEV4aXN0cyhfcHJvZHVjdElkKSk7CiAgICB1aW50MjU2IG5ld0ludmVudG9yeUxldmVsID0gcHJvZHVjdHNbX3Byb2R1Y3RJZF0uYXZhaWxhYmxlLnN1YihfaW52ZW50b3J5QWRqdXN0bWVudCk7CiAgICAvLyB1bm5lY2Vzc2FyeSBiZWNhdXNlIHdlJ3JlIHVzaW5nIFNhZmVNYXRoIGFuZCBhbiB1bnNpZ25lZCBpbnQKICAgIC8vIHJlcXVpcmUobmV3SW52ZW50b3J5TGV2ZWwgPj0gMCk7CiAgICBwcm9kdWN0c1tfcHJvZHVjdElkXS5hdmFpbGFibGUgPSBuZXdJbnZlbnRvcnlMZXZlbDsKICB9CgogIGZ1bmN0aW9uIF9jbGVhckludmVudG9yeSh1aW50MjU2IF9wcm9kdWN0SWQpIGludGVybmFsCiAgewogICAgcmVxdWlyZShfcHJvZHVjdEV4aXN0cyhfcHJvZHVjdElkKSk7CiAgICBwcm9kdWN0c1tfcHJvZHVjdElkXS5hdmFpbGFibGUgPSAwOwogIH0KCiAgZnVuY3Rpb24gX3NldFByaWNlKHVpbnQyNTYgX3Byb2R1Y3RJZCwgdWludDI1NiBfcHJpY2UpIGludGVybmFsCiAgewogICAgcmVxdWlyZShfcHJvZHVjdEV4aXN0cyhfcHJvZHVjdElkKSk7CiAgICBwcm9kdWN0c1tfcHJvZHVjdElkXS5wcmljZSA9IF9wcmljZTsKICB9CgogIGZ1bmN0aW9uIF9zZXRSZW5ld2FibGUodWludDI1NiBfcHJvZHVjdElkLCBib29sIF9pc1JlbmV3YWJsZSkgaW50ZXJuYWwKICB7CiAgICByZXF1aXJlKF9wcm9kdWN0RXhpc3RzKF9wcm9kdWN0SWQpKTsKICAgIHByb2R1Y3RzW19wcm9kdWN0SWRdLnJlbmV3YWJsZSA9IF9pc1JlbmV3YWJsZTsKICB9CgogIGZ1bmN0aW9uIF9wdXJjaGFzZU9uZVVuaXRJblN0b2NrKHVpbnQyNTYgX3Byb2R1Y3RJZCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShfcHJvZHVjdEV4aXN0cyhfcHJvZHVjdElkKSk7CiAgICByZXF1aXJlKGF2YWlsYWJsZUludmVudG9yeU9mKF9wcm9kdWN0SWQpID4gMCk7CgogICAgLy8gbG93ZXIgaW52ZW50b3J5CiAgICBfZGVjcmVtZW50SW52ZW50b3J5KF9wcm9kdWN0SWQsIDEpOwoKICAgIC8vIHJlY29yZCB0aGF0IG9uZSB3YXMgc29sZAogICAgcHJvZHVjdHNbX3Byb2R1Y3RJZF0uc29sZCA9IHByb2R1Y3RzW19wcm9kdWN0SWRdLnNvbGQuYWRkKDEpOwogIH0KCiAgZnVuY3Rpb24gX3JlcXVpcmVSZW5ld2FibGVQcm9kdWN0KHVpbnQyNTYgX3Byb2R1Y3RJZCkgaW50ZXJuYWwgdmlldyB7CiAgICAvLyBwcm9kdWN0SWQgbXVzdCBleGlzdAogICAgcmVxdWlyZShfcHJvZHVjdElkICE9IDApOwogICAgLy8gWW91IGNhbiBvbmx5IHJlbmV3IGEgc3Vic2NyaXB0aW9uIHByb2R1Y3QKICAgIHJlcXVpcmUoaXNTdWJzY3JpcHRpb25Qcm9kdWN0KF9wcm9kdWN0SWQpKTsKICAgIC8vIFRoZSBwcm9kdWN0IG11c3QgY3VycmVudGx5IGJlIHJlbmV3YWJsZQogICAgcmVxdWlyZShyZW5ld2FibGVPZihfcHJvZHVjdElkKSk7CiAgfQoKICAvKioqIHB1YmxpYyAqKiovCgogIC8qKiBleGVjdXRpdmVzLW9ubHkgKiovCgogIC8qKgogICAqIEBub3RpY2UgY3JlYXRlUHJvZHVjdCBjcmVhdGVzIGEgbmV3IHByb2R1Y3QgaW4gdGhlIHN5c3RlbQogICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIGlkIG9mIHRoZSBwcm9kdWN0IHRvIHVzZSAoY2Fubm90IGJlIGNoYW5nZWQpCiAgICogQHBhcmFtIF9pbml0aWFsUHJpY2UgLSB0aGUgc3RhcnRpbmcgcHJpY2UgKHByaWNlIGNhbiBiZSBjaGFuZ2VkKQogICAqIEBwYXJhbSBfaW5pdGlhbEludmVudG9yeVF1YW50aXR5IC0gdGhlIGluaXRpYWwgaW52ZW50b3J5IChpbnZlbnRvcnkgY2FuIGJlIGNoYW5nZWQpCiAgICogQHBhcmFtIF9zdXBwbHkgLSB0aGUgdG90YWwgc3VwcGx5IC0gdXNlIGAwYCBmb3IgInVubGltaXRlZCIgKGNhbm5vdCBiZSBjaGFuZ2VkKQogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZVByb2R1Y3QoCiAgICB1aW50MjU2IF9wcm9kdWN0SWQsCiAgICB1aW50MjU2IF9pbml0aWFsUHJpY2UsCiAgICB1aW50MjU2IF9pbml0aWFsSW52ZW50b3J5UXVhbnRpdHksCiAgICB1aW50MjU2IF9zdXBwbHksCiAgICB1aW50MjU2IF9pbnRlcnZhbCkKICAgIGV4dGVybmFsCiAgICBvbmx5Q0VPT3JDT08KICB7CiAgICBfY3JlYXRlUHJvZHVjdCgKICAgICAgX3Byb2R1Y3RJZCwKICAgICAgX2luaXRpYWxQcmljZSwKICAgICAgX2luaXRpYWxJbnZlbnRvcnlRdWFudGl0eSwKICAgICAgX3N1cHBseSwKICAgICAgX2ludGVydmFsKTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgaW5jcmVtZW50SW52ZW50b3J5IC0gaW5jcmVtZW50cyB0aGUgaW52ZW50b3J5IG9mIGEgcHJvZHVjdAogICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAgKiBAcGFyYW0gX2ludmVudG9yeUFkanVzdG1lbnQgLSB0aGUgYW1vdW50IHRvIGluY3JlbWVudAogICAqLwogIGZ1bmN0aW9uIGluY3JlbWVudEludmVudG9yeSgKICAgIHVpbnQyNTYgX3Byb2R1Y3RJZCwKICAgIHVpbnQyNTYgX2ludmVudG9yeUFkanVzdG1lbnQpCiAgICBleHRlcm5hbAogICAgb25seUNMZXZlbAogIHsKICAgIF9pbmNyZW1lbnRJbnZlbnRvcnkoX3Byb2R1Y3RJZCwgX2ludmVudG9yeUFkanVzdG1lbnQpOwogICAgUHJvZHVjdEludmVudG9yeUFkanVzdGVkKF9wcm9kdWN0SWQsIGF2YWlsYWJsZUludmVudG9yeU9mKF9wcm9kdWN0SWQpKTsKICB9CgogIC8qKgogICogQG5vdGljZSBkZWNyZW1lbnRJbnZlbnRvcnkgcmVtb3ZlcyBpbnZlbnRvcnkgbGV2ZWxzIGZvciBhIHByb2R1Y3QKICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAqIEBwYXJhbSBfaW52ZW50b3J5QWRqdXN0bWVudCAtIHRoZSBhbW91bnQgdG8gZGVjcmVtZW50CiAgKi8KICBmdW5jdGlvbiBkZWNyZW1lbnRJbnZlbnRvcnkoCiAgICB1aW50MjU2IF9wcm9kdWN0SWQsCiAgICB1aW50MjU2IF9pbnZlbnRvcnlBZGp1c3RtZW50KQogICAgZXh0ZXJuYWwKICAgIG9ubHlDTGV2ZWwKICB7CiAgICBfZGVjcmVtZW50SW52ZW50b3J5KF9wcm9kdWN0SWQsIF9pbnZlbnRvcnlBZGp1c3RtZW50KTsKICAgIFByb2R1Y3RJbnZlbnRvcnlBZGp1c3RlZChfcHJvZHVjdElkLCBhdmFpbGFibGVJbnZlbnRvcnlPZihfcHJvZHVjdElkKSk7CiAgfQoKICAvKioKICAqIEBub3RpY2UgY2xlYXJJbnZlbnRvcnkgY2xlYXJzIHRoZSBpbnZlbnRvcnkgb2YgYSBwcm9kdWN0LgogICogQGRldiBkZWNyZW1lbnRJbnZlbnRvcnkgdmVyaWZpZXMgaW52ZW50b3J5IGxldmVscywgd2hlcmVhcyB0aGlzIG1ldGhvZAogICogc2ltcGx5IHNldHMgdGhlIGludmVudG9yeSB0byB6ZXJvLiBUaGlzIGlzIHVzZWZ1bCwgZm9yIGV4YW1wbGUsIGlmIGFuCiAgKiBleGVjdXRpdmUgd2FudHMgdG8gdGFrZSBhIHByb2R1Y3Qgb2ZmIHRoZSBtYXJrZXQgcXVpY2tseS4gVGhlcmUgY291bGQgYmUgYQogICogcmFjZSBjb25kaXRpb24gd2l0aCBkZWNyZW1lbnRJbnZlbnRvcnkgd2hlcmUgYSBwcm9kdWN0IGlzIHNvbGQsIHdoaWNoIGNvdWxkCiAgKiBjYXVzZSB0aGUgYWRtaW5zIGRlY3JlbWVudCB0byBmYWlsIChiZWNhdXNlIGl0IG1heSB0cnkgdG8gZGVjcmVtZW50IG1vcmUKICAqIHRoYW4gYXZhaWxhYmxlKS4KICAqCiAgKiBAcGFyYW0gX3Byb2R1Y3RJZCAtIHRoZSBwcm9kdWN0IGlkCiAgKi8KICBmdW5jdGlvbiBjbGVhckludmVudG9yeSh1aW50MjU2IF9wcm9kdWN0SWQpCiAgICBleHRlcm5hbAogICAgb25seUNMZXZlbAogIHsKICAgIF9jbGVhckludmVudG9yeShfcHJvZHVjdElkKTsKICAgIFByb2R1Y3RJbnZlbnRvcnlBZGp1c3RlZChfcHJvZHVjdElkLCBhdmFpbGFibGVJbnZlbnRvcnlPZihfcHJvZHVjdElkKSk7CiAgfQoKICAvKioKICAqIEBub3RpY2Ugc2V0UHJpY2UgLSBzZXRzIHRoZSBwcmljZSBvZiBhIHByb2R1Y3QKICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAqIEBwYXJhbSBfcHJpY2UgLSB0aGUgcHJvZHVjdCBwcmljZQogICovCiAgZnVuY3Rpb24gc2V0UHJpY2UodWludDI1NiBfcHJvZHVjdElkLCB1aW50MjU2IF9wcmljZSkKICAgIGV4dGVybmFsCiAgICBvbmx5Q0xldmVsCiAgewogICAgX3NldFByaWNlKF9wcm9kdWN0SWQsIF9wcmljZSk7CiAgICBQcm9kdWN0UHJpY2VDaGFuZ2VkKF9wcm9kdWN0SWQsIF9wcmljZSk7CiAgfQoKICAvKioKICAqIEBub3RpY2Ugc2V0UmVuZXdhYmxlIC0gc2V0cyBpZiBhIHByb2R1Y3QgaXMgcmVuZXdhYmxlCiAgKiBAcGFyYW0gX3Byb2R1Y3RJZCAtIHRoZSBwcm9kdWN0IGlkCiAgKiBAcGFyYW0gX25ld1JlbmV3YWJsZSAtIHRoZSBuZXcgcmVuZXdhYmxlIHNldHRpbmcKICAqLwogIGZ1bmN0aW9uIHNldFJlbmV3YWJsZSh1aW50MjU2IF9wcm9kdWN0SWQsIGJvb2wgX25ld1JlbmV3YWJsZSkKICAgIGV4dGVybmFsCiAgICBvbmx5Q0xldmVsCiAgewogICAgX3NldFJlbmV3YWJsZShfcHJvZHVjdElkLCBfbmV3UmVuZXdhYmxlKTsKICAgIFByb2R1Y3RSZW5ld2FibGVDaGFuZ2VkKF9wcm9kdWN0SWQsIF9uZXdSZW5ld2FibGUpOwogIH0KCiAgLyoqIGFueW9uZSAqKi8KCiAgLyoqCiAgKiBAbm90aWNlIFRoZSBwcmljZSBvZiBhIHByb2R1Y3QKICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAqLwogIGZ1bmN0aW9uIHByaWNlT2YodWludDI1NiBfcHJvZHVjdElkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gcHJvZHVjdHNbX3Byb2R1Y3RJZF0ucHJpY2U7CiAgfQoKICAvKioKICAqIEBub3RpY2UgVGhlIGF2YWlsYWJsZSBpbnZlbnRvcnkgb2YgYSBwcm9kdWN0CiAgKiBAcGFyYW0gX3Byb2R1Y3RJZCAtIHRoZSBwcm9kdWN0IGlkCiAgKi8KICBmdW5jdGlvbiBhdmFpbGFibGVJbnZlbnRvcnlPZih1aW50MjU2IF9wcm9kdWN0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBwcm9kdWN0c1tfcHJvZHVjdElkXS5hdmFpbGFibGU7CiAgfQoKICAvKioKICAqIEBub3RpY2UgVGhlIHRvdGFsIHN1cHBseSBvZiBhIHByb2R1Y3QKICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAqLwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5T2YodWludDI1NiBfcHJvZHVjdElkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gcHJvZHVjdHNbX3Byb2R1Y3RJZF0uc3VwcGx5OwogIH0KCiAgLyoqCiAgKiBAbm90aWNlIFRoZSB0b3RhbCBzb2xkIG9mIGEgcHJvZHVjdAogICogQHBhcmFtIF9wcm9kdWN0SWQgLSB0aGUgcHJvZHVjdCBpZAogICovCiAgZnVuY3Rpb24gdG90YWxTb2xkKHVpbnQyNTYgX3Byb2R1Y3RJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHByb2R1Y3RzW19wcm9kdWN0SWRdLnNvbGQ7CiAgfQoKICAvKioKICAqIEBub3RpY2UgVGhlIHJlbmV3YWwgaW50ZXJ2YWwgb2YgYSBwcm9kdWN0IGluIHNlY29uZHMKICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAqLwogIGZ1bmN0aW9uIGludGVydmFsT2YodWludDI1NiBfcHJvZHVjdElkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gcHJvZHVjdHNbX3Byb2R1Y3RJZF0uaW50ZXJ2YWw7CiAgfQoKICAvKioKICAqIEBub3RpY2UgSXMgdGhpcyBwcm9kdWN0IHJlbmV3YWJsZT8KICAqIEBwYXJhbSBfcHJvZHVjdElkIC0gdGhlIHByb2R1Y3QgaWQKICAqLwogIGZ1bmN0aW9uIHJlbmV3YWJsZU9mKHVpbnQyNTYgX3Byb2R1Y3RJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHByb2R1Y3RzW19wcm9kdWN0SWRdLnJlbmV3YWJsZTsKICB9CgoKICAvKioKICAqIEBub3RpY2UgVGhlIHByb2R1Y3QgaW5mbyBmb3IgYSBwcm9kdWN0CiAgKiBAcGFyYW0gX3Byb2R1Y3RJZCAtIHRoZSBwcm9kdWN0IGlkCiAgKi8KICBmdW5jdGlvbiBwcm9kdWN0SW5mbyh1aW50MjU2IF9wcm9kdWN0SWQpCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYsIGJvb2wpCiAgewogICAgcmV0dXJuICgKICAgICAgcHJpY2VPZihfcHJvZHVjdElkKSwKICAgICAgYXZhaWxhYmxlSW52ZW50b3J5T2YoX3Byb2R1Y3RJZCksCiAgICAgIHRvdGFsU3VwcGx5T2YoX3Byb2R1Y3RJZCksCiAgICAgIGludGVydmFsT2YoX3Byb2R1Y3RJZCksCiAgICAgIHJlbmV3YWJsZU9mKF9wcm9kdWN0SWQpKTsKICB9CgogIC8qKgogICogQG5vdGljZSBHZXQgYWxsIHByb2R1Y3QgaWRzCiAgKi8KICBmdW5jdGlvbiBnZXRBbGxQcm9kdWN0SWRzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NltdKSB7CiAgICByZXR1cm4gYWxsUHJvZHVjdElkczsKICB9CgogIC8qKgogICAqIEBub3RpY2UgcmV0dXJucyB0aGUgdG90YWwgY29zdCB0byByZW5ldyBhIHByb2R1Y3QgZm9yIGEgbnVtYmVyIG9mIGN5Y2xlcwogICAqIEBkZXYgSWYgYSBwcm9kdWN0IGlzIGEgc3Vic2NyaXB0aW9uLCB0aGUgaW50ZXJ2YWwgZGVmaW5lcyB0aGUgcGVyaW9kIG9mCiAgICogdGltZSwgaW4gc2Vjb25kcywgdXNlcnMgY2FuIHN1YnNjcmliZSBmb3IuIEUuZy4gMSBtb250aCBvciAxIHllYXIuCiAgICogX251bUN5Y2xlcyBpcyB0aGUgbnVtYmVyIG9mIHRoZXNlIGludGVydmFscyB3ZSB3YW50IHRvIHVzZSBpbiB0aGUKICAgKiBjYWxjdWxhdGlvbiBvZiB0aGUgcHJpY2UuCiAgICoKICAgKiBXZSByZXF1aXJlIHRoYXQgdGhlIGVuZCB1c2VyIHNlbmQgcHJlY2lzZWx5IHRoZSBhbW91bnQgcmVxdWlyZWQgKGluc3RlYWQKICAgKiBvZiBkZWFsaW5nIHdpdGggZXhjZXNzIHJlZnVuZHMpLiBUaGlzIG1ldGhvZCBpcyBwdWJsaWMgc28gdGhhdCBjbGllbnRzIGNhbgogICAqIHJlYWQgdGhlIGV4YWN0IGFtb3VudCBvdXIgY29udHJhY3QgZXhwZWN0cyB0byByZWNlaXZlLgogICAqCiAgICogQHBhcmFtIF9wcm9kdWN0SWQgLSB0aGUgcHJvZHVjdCB3ZSdyZSBjYWxjdWxhdGluZyBmb3IKICAgKiBAcGFyYW0gX251bUN5Y2xlcyAtIHRoZSBudW1iZXIgb2YgY3ljbGVzIHRvIGNhbGN1bGF0ZSBmb3IKICAgKi8KICBmdW5jdGlvbiBjb3N0Rm9yUHJvZHVjdEN5Y2xlcyh1aW50MjU2IF9wcm9kdWN0SWQsIHVpbnQyNTYgX251bUN5Y2xlcykKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICB7CiAgICByZXR1cm4gcHJpY2VPZihfcHJvZHVjdElkKS5tdWwoX251bUN5Y2xlcyk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIHJldHVybnMgaWYgdGhpcyBwcm9kdWN0IGlzIGEgc3Vic2NyaXB0aW9uIG9yIG5vdAogICAqIEBkZXYgU29tZSBwcm9kdWN0cyBhcmUgc3Vic2NyaXB0aW9ucyBhbmQgb3RoZXJzIGFyZSBub3QuIEFuIGludGVydmFsIG9mIDAKICAgKiBtZWFucyB0aGUgcHJvZHVjdCBpcyBub3QgYSBzdWJzY3JpcHRpb24KICAgKiBAcGFyYW0gX3Byb2R1Y3RJZCAtIHRoZSBwcm9kdWN0IHdlJ3JlIGNoZWNraW5nCiAgICovCiAgZnVuY3Rpb24gaXNTdWJzY3JpcHRpb25Qcm9kdWN0KHVpbnQyNTYgX3Byb2R1Y3RJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGludGVydmFsT2YoX3Byb2R1Y3RJZCkgPiAwOwogIH0KCn0KCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgppbnRlcmZhY2UgRVJDMTY1IHsKICAgIC8vLyBAbm90aWNlIFF1ZXJ5IGlmIGEgY29udHJhY3QgaW1wbGVtZW50cyBhbiBpbnRlcmZhY2UKICAgIC8vLyBAcGFyYW0gaW50ZXJmYWNlSUQgVGhlIGludGVyZmFjZSBpZGVudGlmaWVyLCBhcyBzcGVjaWZpZWQgaW4gRVJDLTE2NQogICAgLy8vIEBkZXYgSW50ZXJmYWNlIGlkZW50aWZpY2F0aW9uIGlzIHNwZWNpZmllZCBpbiBFUkMtMTY1LiBUaGlzIGZ1bmN0aW9uCiAgICAvLy8gIHVzZXMgbGVzcyB0aGFuIDMwLDAwMCBnYXMuCiAgICAvLy8gQHJldHVybiBgdHJ1ZWAgaWYgdGhlIGNvbnRyYWN0IGltcGxlbWVudHMgYGludGVyZmFjZUlEYCBhbmQKICAgIC8vLyAgYGludGVyZmFjZUlEYCBpcyBub3QgMHhmZmZmZmZmZiwgYGZhbHNlYCBvdGhlcndpc2UKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBpbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgTGljZW5zZU93bmVyc2hpcCBpcyBMaWNlbnNlSW52ZW50b3J5LCBFUkM3MjEsIEVSQzE2NSwgRVJDNzIxTWV0YWRhdGEsIEVSQzcyMUVudW1lcmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUb3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgdWludDI1NiBwcml2YXRlIHRvdGFsVG9rZW5zOwoKICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gb3duZXIKICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHByaXZhdGUgdG9rZW5Pd25lcjsKCiAgLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGFwcHJvdmVkIGFkZHJlc3MKICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHByaXZhdGUgdG9rZW5BcHByb3ZhbHM7CgogIC8vIE1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIG9wZXJhdG9yIGFkZHJlc3MgdG8gYXBwcm92YWwKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkpIHByaXZhdGUgb3BlcmF0b3JBcHByb3ZhbHM7CgogIC8vIE1hcHBpbmcgZnJvbSBvd25lciB0byBsaXN0IG9mIG93bmVkIHRva2VuIElEcwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NltdKSBwcml2YXRlIG93bmVkVG9rZW5zOwoKICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gaW5kZXggb2YgdGhlIG93bmVyIHRva2VucyBsaXN0CiAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHByaXZhdGUgb3duZWRUb2tlbnNJbmRleDsKCiAgLyoqKiBDb25zdGFudHMgKioqLwogIC8vIENvbmZpZ3VyZSB0aGVzZSBmb3IgeW91ciBvd24gZGVwbG95bWVudAogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgTkFNRSA9ICJEb3R0YWJvdCI7CiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBTWU1CT0wgPSAiRE9UVEEiOwogIHN0cmluZyBwdWJsaWMgdG9rZW5NZXRhZGF0YUJhc2VVUkkgPSAiaHR0cHM6Ly9hcGkuZG90dGFib3QuY29tLyI7CgogIC8qKgogICAqIEBub3RpY2UgdG9rZW4ncyBuYW1lCiAgICovCiAgZnVuY3Rpb24gbmFtZSgpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gTkFNRTsKICB9CgogIC8qKgogICAqIEBub3RpY2Ugc3ltYm9scydzIG5hbWUKICAgKi8KICBmdW5jdGlvbiBzeW1ib2woKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIFNZTUJPTDsKICB9CgogIGZ1bmN0aW9uIGltcGxlbWVudHNFUkM3MjEoKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdG9rZW5VUkkodWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkKICB7CiAgICByZXR1cm4gU3RyaW5ncy5zdHJDb25jYXQoCiAgICAgIHRva2VuTWV0YWRhdGFCYXNlVVJJLAogICAgICBTdHJpbmdzLnVpbnQyc3RyKF90b2tlbklkKSk7CiAgfQoKICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZSgKICAgIGJ5dGVzNCBpbnRlcmZhY2VJRCkgLy8gc29saXVtLWRpc2FibGUtbGluZSBkb3R0YS91bmRlcnNjb3JlLWZ1bmN0aW9uLWFyZ3VtZW50cwogICAgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybgogICAgICBpbnRlcmZhY2VJRCA9PSB0aGlzLnN1cHBvcnRzSW50ZXJmYWNlLnNlbGVjdG9yIHx8IC8vIEVSQzE2NQogICAgICBpbnRlcmZhY2VJRCA9PSAweDViNWUxMzlmIHx8IC8vIEVSQzcyMU1ldGFkYXRhCiAgICAgIGludGVyZmFjZUlEID09IDB4NjQ2NjM1M2MgfHwgLy8gRVJDLTcyMSBvbiAzLzcvMjAxOAogICAgICBpbnRlcmZhY2VJRCA9PSAweDc4MGU5ZDYzOyAvLyBFUkM3MjFFbnVtZXJhYmxlCiAgfQoKICBmdW5jdGlvbiBzZXRUb2tlbk1ldGFkYXRhQmFzZVVSSShzdHJpbmcgX25ld0Jhc2VVUkkpIGV4dGVybmFsIG9ubHlDRU9PckNPTyB7CiAgICB0b2tlbk1ldGFkYXRhQmFzZVVSSSA9IF9uZXdCYXNlVVJJOwogIH0KCiAgLyoqCiAgKiBAbm90aWNlIEd1YXJhbnRlZXMgbXNnLnNlbmRlciBpcyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4KICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byB2YWxpZGF0ZSBpdHMgb3duZXJzaGlwIGJlbG9uZ3MgdG8gbXNnLnNlbmRlcgogICovCiAgbW9kaWZpZXIgb25seU93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgewogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBtc2cuc2VuZGVyKTsKICAgIF87CiAgfQoKICAvKioKICAqIEBub3RpY2UgR2V0cyB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBzdG9yZWQgYnkgdGhlIGNvbnRyYWN0CiAgKiBAcmV0dXJuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgKi8KICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b3RhbFRva2VuczsKICB9CgogIC8qKgogICogQG5vdGljZSBFbnVtZXJhdGUgdmFsaWQgTkZUcwogICogQGRldiBPdXIgTGljZW5zZXMgYXJlIGtlcHQgaW4gYW4gYXJyYXkgYW5kIGVhY2ggbmV3IExpY2Vuc2UtdG9rZW4gaXMganVzdAogICogdGhlIG5leHQgZWxlbWVudCBpbiB0aGUgYXJyYXkuIFRoaXMgbWV0aG9kIGlzIHJlcXVpcmVkIGZvciBFUkM3MjFFbnVtZXJhYmxlCiAgKiB3aGljaCBtYXkgc3VwcG9ydCBtb3JlIGNvbXBsaWNhdGVkIHN0b3JhZ2Ugc2NoZW1lcy4gSG93ZXZlciwgaW4gb3VyIGNhc2UgdGhlCiAgKiBfaW5kZXggaXMgdGhlIHRva2VuSWQKICAqIEBwYXJhbSBfaW5kZXggQSBjb3VudGVyIGxlc3MgdGhhbiBgdG90YWxTdXBwbHkoKWAKICAqIEByZXR1cm4gVGhlIHRva2VuIGlkZW50aWZpZXIgZm9yIHRoZSBgX2luZGV4YHRoIE5GVAogICovCiAgZnVuY3Rpb24gdG9rZW5CeUluZGV4KHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJlcXVpcmUoX2luZGV4IDwgdG90YWxTdXBwbHkoKSk7CiAgICByZXR1cm4gX2luZGV4OwogIH0KCiAgLyoqCiAgKiBAbm90aWNlIEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgdG8gcXVlcnkgdGhlIGJhbGFuY2Ugb2YKICAqIEByZXR1cm4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICByZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXS5sZW5ndGg7CiAgfQoKICAvKioKICAqIEBub3RpY2UgR2V0cyB0aGUgbGlzdCBvZiB0b2tlbnMgb3duZWQgYnkgYSBnaXZlbiBhZGRyZXNzCiAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRva2VucyBvZgogICogQHJldHVybiB1aW50MjU2W10gcmVwcmVzZW50aW5nIHRoZSBsaXN0IG9mIHRva2VucyBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIHRva2Vuc09mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2W10pIHsKICAgIHJldHVybiBvd25lZFRva2Vuc1tfb3duZXJdOwogIH0KCiAgLyoqCiAgKiBAbm90aWNlIEVudW1lcmF0ZSBORlRzIGFzc2lnbmVkIHRvIGFuIG93bmVyCiAgKiBAZGV2IFRocm93cyBpZiBgX2luZGV4YCA+PSBgYmFsYW5jZU9mKF9vd25lcilgIG9yIGlmCiAgKiAgYF9vd25lcmAgaXMgdGhlIHplcm8gYWRkcmVzcywgcmVwcmVzZW50aW5nIGludmFsaWQgTkZUcy4KICAqIEBwYXJhbSBfb3duZXIgQW4gYWRkcmVzcyB3aGVyZSB3ZSBhcmUgaW50ZXJlc3RlZCBpbiBORlRzIG93bmVkIGJ5IHRoZW0KICAqIEBwYXJhbSBfaW5kZXggQSBjb3VudGVyIGxlc3MgdGhhbiBgYmFsYW5jZU9mKF9vd25lcilgCiAgKiBAcmV0dXJuIFRoZSB0b2tlbiBpZGVudGlmaWVyIGZvciB0aGUgYF9pbmRleGB0aCBORlQgYXNzaWduZWQgdG8gYF9vd25lcmAsCiAgKi8KICBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2IF90b2tlbklkKQogIHsKICAgIHJlcXVpcmUoX2luZGV4IDwgYmFsYW5jZU9mKF9vd25lcikpOwogICAgcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl1bX2luZGV4XTsKICB9CgogIC8qKgogICogQG5vdGljZSBHZXRzIHRoZSBvd25lciBvZiB0aGUgc3BlY2lmaWVkIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIG93bmVyIG9mCiAgKiBAcmV0dXJuIG93bmVyIGFkZHJlc3MgY3VycmVudGx5IG1hcmtlZCBhcyB0aGUgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKi8KICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIGFkZHJlc3Mgb3duZXIgPSB0b2tlbk93bmVyW190b2tlbklkXTsKICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICByZXR1cm4gb3duZXI7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEdldHMgdGhlIGFwcHJvdmVkIGFkZHJlc3MgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRAogICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcmV0dXJuIGFkZHJlc3MgY3VycmVudGx5IGFwcHJvdmVkIHRvIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICAqLwogIGZ1bmN0aW9uIGdldEFwcHJvdmVkKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiB0b2tlbkFwcHJvdmFsc1tfdG9rZW5JZF07CiAgfQoKICAvKioKICAgKiBAbm90aWNlIFRlbGxzIHdoZXRoZXIgdGhlIG1zZy5zZW5kZXIgaXMgYXBwcm92ZWQgdG8gdHJhbnNmZXIgdGhlIGdpdmVuIHRva2VuIElEIG9yIG5vdAogICAqIENoZWNrcyBib3RoIGZvciBzcGVjaWZpYyBhcHByb3ZhbCBhbmQgb3BlcmF0b3IgYXBwcm92YWwKICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIGFwcHJvdmFsIG9mCiAgICogQHJldHVybiBib29sIHdoZXRoZXIgdHJhbnNmZXIgYnkgbXNnLnNlbmRlciBpcyBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElEIG9yIG5vdAogICAqLwogIGZ1bmN0aW9uIGlzU2VuZGVyQXBwcm92ZWRGb3IodWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4KICAgICAgb3duZXJPZihfdG9rZW5JZCkgPT0gbXNnLnNlbmRlciB8fAogICAgICBpc1NwZWNpZmljYWxseUFwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSB8fAogICAgICBpc0FwcHJvdmVkRm9yQWxsKG93bmVyT2YoX3Rva2VuSWQpLCBtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVGVsbHMgd2hldGhlciB0aGUgbXNnLnNlbmRlciBpcyBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElEIG9yIG5vdAogICAqIEBwYXJhbSBfYXNrZXIgYWRkcmVzcyBvZiBhc2tpbmcgZm9yIGFwcHJvdmFsCiAgICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIHF1ZXJ5IHRoZSBhcHByb3ZhbCBvZgogICAqIEByZXR1cm4gYm9vbCB3aGV0aGVyIHRoZSBtc2cuc2VuZGVyIGlzIGFwcHJvdmVkIGZvciB0aGUgZ2l2ZW4gdG9rZW4gSUQgb3Igbm90CiAgICovCiAgZnVuY3Rpb24gaXNTcGVjaWZpY2FsbHlBcHByb3ZlZEZvcihhZGRyZXNzIF9hc2tlciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gZ2V0QXBwcm92ZWQoX3Rva2VuSWQpID09IF9hc2tlcjsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVGVsbHMgd2hldGhlciBhbiBvcGVyYXRvciBpcyBhcHByb3ZlZCBieSBhIGdpdmVuIG93bmVyCiAgICogQHBhcmFtIF9vd25lciBvd25lciBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHF1ZXJ5IHRoZSBhcHByb3ZhbCBvZgogICAqIEBwYXJhbSBfb3BlcmF0b3Igb3BlcmF0b3IgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcmV0dXJuIGJvb2wgd2hldGhlciB0aGUgZ2l2ZW4gb3BlcmF0b3IgaXMgYXBwcm92ZWQgYnkgdGhlIGdpdmVuIG93bmVyCiAgICovCiAgZnVuY3Rpb24gaXNBcHByb3ZlZEZvckFsbChhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfb3BlcmF0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIG9wZXJhdG9yQXBwcm92YWxzW19vd25lcl1bX29wZXJhdG9yXTsKICB9CgogIC8qKgogICogQG5vdGljZSBUcmFuc2ZlcnMgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElEIHRvIGFub3RoZXIgYWRkcmVzcwogICogQHBhcmFtIF90byBhZGRyZXNzIHRvIHJlY2VpdmUgdGhlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgb25seU93bmVyT2YoX3Rva2VuSWQpCiAgewogICAgX2NsZWFyQXBwcm92YWxBbmRUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICB9CgogIC8qKgogICogQG5vdGljZSBBcHByb3ZlcyBhbm90aGVyIGFkZHJlc3MgdG8gY2xhaW0gZm9yIHRoZSBvd25lcnNoaXAgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gYmUgYXBwcm92ZWQgZm9yIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFwcHJvdmVkCiAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIG9ubHlPd25lck9mKF90b2tlbklkKQogIHsKICAgIGFkZHJlc3Mgb3duZXIgPSBvd25lck9mKF90b2tlbklkKTsKICAgIHJlcXVpcmUoX3RvICE9IG93bmVyKTsKICAgIGlmIChnZXRBcHByb3ZlZChfdG9rZW5JZCkgIT0gMCB8fCBfdG8gIT0gMCkgewogICAgICB0b2tlbkFwcHJvdmFsc1tfdG9rZW5JZF0gPSBfdG87CiAgICAgIEFwcHJvdmFsKG93bmVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICB9CgogIC8qKgogICogQG5vdGljZSBFbmFibGUgb3IgZGlzYWJsZSBhcHByb3ZhbCBmb3IgYSB0aGlyZCBwYXJ0eSAoIm9wZXJhdG9yIikgdG8gbWFuYWdlIGFsbCB5b3VyIGFzc2V0cwogICogQGRldiBFbWl0cyB0aGUgQXBwcm92YWxGb3JBbGwgZXZlbnQKICAqIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBhZGQgdG8gdGhlIHNldCBvZiBhdXRob3JpemVkIG9wZXJhdG9ycy4KICAqIEBwYXJhbSBfYXBwcm92ZWQgVHJ1ZSBpZiB0aGUgb3BlcmF0b3JzIGlzIGFwcHJvdmVkLCBmYWxzZSB0byByZXZva2UgYXBwcm92YWwKICAqLwogIGZ1bmN0aW9uIHNldEFwcHJvdmFsRm9yQWxsKGFkZHJlc3MgX3RvLCBib29sIF9hcHByb3ZlZCkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgaWYoX2FwcHJvdmVkKSB7CiAgICAgIGFwcHJvdmVBbGwoX3RvKTsKICAgIH0gZWxzZSB7CiAgICAgIGRpc2FwcHJvdmVBbGwoX3RvKTsKICAgIH0KICB9CgogIC8qKgogICogQG5vdGljZSBBcHByb3ZlcyBhbm90aGVyIGFkZHJlc3MgdG8gY2xhaW0gZm9yIHRoZSBvd25lcnNoaXAgb2YgYW55IHRva2VucyBvd25lZCBieSB0aGlzIGFjY291bnQKICAqIEBwYXJhbSBfdG8gYWRkcmVzcyB0byBiZSBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElECiAgKi8KICBmdW5jdGlvbiBhcHByb3ZlQWxsKGFkZHJlc3MgX3RvKQogICAgcHVibGljCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgcmVxdWlyZShfdG8gIT0gbXNnLnNlbmRlcik7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIG9wZXJhdG9yQXBwcm92YWxzW21zZy5zZW5kZXJdW190b10gPSB0cnVlOwogICAgQXBwcm92YWxGb3JBbGwobXNnLnNlbmRlciwgX3RvLCB0cnVlKTsKICB9CgogIC8qKgogICogQG5vdGljZSBSZW1vdmVzIGFwcHJvdmFsIGZvciBhbm90aGVyIGFkZHJlc3MgdG8gY2xhaW0gZm9yIHRoZSBvd25lcnNoaXAgb2YgYW55CiAgKiAgdG9rZW5zIG93bmVkIGJ5IHRoaXMgYWNjb3VudC4KICAqIEBkZXYgTm90ZSB0aGF0IHRoaXMgb25seSByZW1vdmVzIHRoZSBvcGVyYXRvciBhcHByb3ZhbCBhbmQKICAqICBkb2VzIG5vdCBjbGVhciBhbnkgaW5kZXBlbmRlbnQsIHNwZWNpZmljIGFwcHJvdmFscyBvZiB0b2tlbiB0cmFuc2ZlcnMgdG8gdGhpcyBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gYmUgZGlzYXBwcm92ZWQgZm9yIHRoZSBnaXZlbiB0b2tlbiBJRAogICovCiAgZnVuY3Rpb24gZGlzYXBwcm92ZUFsbChhZGRyZXNzIF90bykKICAgIHB1YmxpYwogICAgd2hlbk5vdFBhdXNlZAogIHsKICAgIHJlcXVpcmUoX3RvICE9IG1zZy5zZW5kZXIpOwogICAgZGVsZXRlIG9wZXJhdG9yQXBwcm92YWxzW21zZy5zZW5kZXJdW190b107CiAgICBBcHByb3ZhbEZvckFsbChtc2cuc2VuZGVyLCBfdG8sIGZhbHNlKTsKICB9CgogIC8qKgogICogQG5vdGljZSBDbGFpbXMgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gYmVpbmcgY2xhaW1lZCBieSB0aGUgbXNnLnNlbmRlcgogICovCiAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKQogICBleHRlcm5hbAogICB3aGVuTm90UGF1c2VkCiAgewogICAgcmVxdWlyZShpc1NlbmRlckFwcHJvdmVkRm9yKF90b2tlbklkKSk7CiAgICBfY2xlYXJBcHByb3ZhbEFuZFRyYW5zZmVyKG93bmVyT2YoX3Rva2VuSWQpLCBtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgfQoKICAvKioKICAqIEBub3RpY2UgVHJhbnNmZXIgYSB0b2tlbiBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZyBhZGRyZXNzIGhhcwogICogIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIHRva2VuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCB0YWtlIG93bmVyc2hpcCBvZiB0aGUgdG9rZW4uIENhbiBiZSBhbnkgYWRkcmVzcywgaW5jbHVkaW5nIHRoZSBjYWxsZXIKICAqIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICBhZGRyZXNzIF9mcm9tLAogICAgYWRkcmVzcyBfdG8sCiAgICB1aW50MjU2IF90b2tlbklkCiAgKQogICAgcHVibGljCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgcmVxdWlyZShpc1NlbmRlckFwcHJvdmVkRm9yKF90b2tlbklkKSk7CiAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IF9mcm9tKTsKICAgIF9jbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIob3duZXJPZihfdG9rZW5JZCksIF90bywgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAbm90aWNlIFRyYW5zZmVycyB0aGUgb3duZXJzaGlwIG9mIGFuIE5GVCBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIgYWRkcmVzcwogICogQGRldiBUaHJvd3MgdW5sZXNzIGBtc2cuc2VuZGVyYCBpcyB0aGUgY3VycmVudCBvd25lciwgYW4gYXV0aG9yaXplZAogICogb3BlcmF0b3IsIG9yIHRoZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0aGlzIE5GVC4gVGhyb3dzIGlmIGBfZnJvbWAgaXMKICAqIG5vdCB0aGUgY3VycmVudCBvd25lci4gVGhyb3dzIGlmIGBfdG9gIGlzIHRoZSB6ZXJvIGFkZHJlc3MuIFRocm93cyBpZgogICogYF90b2tlbklkYCBpcyBub3QgYSB2YWxpZCBORlQuIFdoZW4gdHJhbnNmZXIgaXMgY29tcGxldGUsIHRoaXMgZnVuY3Rpb24KICAqIGNoZWNrcyBpZiBgX3RvYCBpcyBhIHNtYXJ0IGNvbnRyYWN0IChjb2RlIHNpemUgPiAwKS4gSWYgc28sIGl0IGNhbGxzCiAgKiBgb25FUkM3MjFSZWNlaXZlZGAgb24gYF90b2AgYW5kIHRocm93cyBpZiB0aGUgcmV0dXJuIHZhbHVlIGlzIG5vdAogICogYGJ5dGVzNChrZWNjYWsyNTYoIm9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyx1aW50MjU2LGJ5dGVzKSIpKWAuCiAgKiBAcGFyYW0gX2Zyb20gVGhlIGN1cnJlbnQgb3duZXIgb2YgdGhlIE5GVAogICogQHBhcmFtIF90byBUaGUgbmV3IG93bmVyCiAgKiBAcGFyYW0gX3Rva2VuSWQgVGhlIE5GVCB0byB0cmFuc2ZlcgogICogQHBhcmFtIF9kYXRhIEFkZGl0aW9uYWwgZGF0YSB3aXRoIG5vIHNwZWNpZmllZCBmb3JtYXQsIHNlbnQgaW4gY2FsbCB0byBgX3RvYAogICovCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbSgKICAgIGFkZHJlc3MgX2Zyb20sCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICBieXRlcyBfZGF0YQogICkKICAgIHB1YmxpYwogICAgd2hlbk5vdFBhdXNlZAogIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfaXNWYWxpZExpY2Vuc2UoX3Rva2VuSWQpKTsKICAgIHRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICBpZiAoX2lzQ29udHJhY3QoX3RvKSkgewogICAgICBieXRlczQgdG9rZW5SZWNlaXZlclJlc3BvbnNlID0gRVJDNzIxVG9rZW5SZWNlaXZlcihfdG8pLm9uRVJDNzIxUmVjZWl2ZWQuZ2FzKDUwMDAwKSgKICAgICAgICBfZnJvbSwgX3Rva2VuSWQsIF9kYXRhCiAgICAgICk7CiAgICAgIHJlcXVpcmUodG9rZW5SZWNlaXZlclJlc3BvbnNlID09IGJ5dGVzNChrZWNjYWsyNTYoIm9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyx1aW50MjU2LGJ5dGVzKSIpKSk7CiAgICB9CiAgfQoKICAvKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHRoZSBvd25lcnNoaXAgb2YgYW4gTkZUIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlciBhZGRyZXNzCiAgICogQGRldiBUaGlzIHdvcmtzIGlkZW50aWNhbGx5IHRvIHRoZSBvdGhlciBmdW5jdGlvbiB3aXRoIGFuIGV4dHJhIGRhdGEgcGFyYW1ldGVyLAogICAqICBleGNlcHQgdGhpcyBmdW5jdGlvbiBqdXN0IHNldHMgZGF0YSB0byAiIgogICAqIEBwYXJhbSBfZnJvbSBUaGUgY3VycmVudCBvd25lciBvZiB0aGUgTkZUCiAgICogQHBhcmFtIF90byBUaGUgbmV3IG93bmVyCiAgICogQHBhcmFtIF90b2tlbklkIFRoZSBORlQgdG8gdHJhbnNmZXIKICAqLwogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oCiAgICBhZGRyZXNzIF9mcm9tLAogICAgYWRkcmVzcyBfdG8sCiAgICB1aW50MjU2IF90b2tlbklkCiAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICB7CiAgICBzYWZlVHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF90b2tlbklkLCAiIik7CiAgfQoKICAvKioKICAqIEBub3RpY2UgTWludCB0b2tlbiBmdW5jdGlvbgogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgb3duIHRoZSBtaW50ZWQgdG9rZW4KICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSBtaW50ZWQgYnkgdGhlIG1zZy5zZW5kZXIKICAqLwogIGZ1bmN0aW9uIF9taW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIF9hZGRUb2tlbihfdG8sIF90b2tlbklkKTsKICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfdG9rZW5JZCk7CiAgfQoKICAvKioKICAqIEBub3RpY2UgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xlYXIgY3VycmVudCBhcHByb3ZhbCBhbmQgdHJhbnNmZXIgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdGhlIHRva2VuIHRvCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogIGZ1bmN0aW9uIF9jbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdG8gIT0gb3duZXJPZihfdG9rZW5JZCkpOwogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBfZnJvbSk7CiAgICByZXF1aXJlKF9pc1ZhbGlkTGljZW5zZShfdG9rZW5JZCkpOwoKICAgIF9jbGVhckFwcHJvdmFsKF9mcm9tLCBfdG9rZW5JZCk7CiAgICBfcmVtb3ZlVG9rZW4oX2Zyb20sIF90b2tlbklkKTsKICAgIF9hZGRUb2tlbihfdG8sIF90b2tlbklkKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICB9CgogIC8qKgogICogQG5vdGljZSBJbnRlcm5hbCBmdW5jdGlvbiB0byBjbGVhciBjdXJyZW50IGFwcHJvdmFsIG9mIGEgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgZnVuY3Rpb24gX2NsZWFyQXBwcm92YWwoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBfb3duZXIpOwogICAgdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdID0gMDsKICAgIEFwcHJvdmFsKF9vd25lciwgMCwgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAbm90aWNlIEludGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhIHRva2VuIElEIHRvIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF90byBhZGRyZXNzIHJlcHJlc2VudGluZyB0aGUgbmV3IG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFkZGVkIHRvIHRoZSB0b2tlbnMgbGlzdCBvZiB0aGUgZ2l2ZW4gYWRkcmVzcwogICovCiAgZnVuY3Rpb24gX2FkZFRva2VuKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgIHJlcXVpcmUodG9rZW5Pd25lcltfdG9rZW5JZF0gPT0gYWRkcmVzcygwKSk7CiAgICB0b2tlbk93bmVyW190b2tlbklkXSA9IF90bzsKICAgIHVpbnQyNTYgbGVuZ3RoID0gYmFsYW5jZU9mKF90byk7CiAgICBvd25lZFRva2Vuc1tfdG9dLnB1c2goX3Rva2VuSWQpOwogICAgb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF0gPSBsZW5ndGg7CiAgICB0b3RhbFRva2VucyA9IHRvdGFsVG9rZW5zLmFkZCgxKTsKICB9CgogIC8qKgogICogQG5vdGljZSBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSB0b2tlbiBJRCBmcm9tIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBwcmV2aW91cyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSByZW1vdmVkIGZyb20gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiBfcmVtb3ZlVG9rZW4oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB7CiAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IF9mcm9tKTsKCiAgICB1aW50MjU2IHRva2VuSW5kZXggPSBvd25lZFRva2Vuc0luZGV4W190b2tlbklkXTsKICAgIHVpbnQyNTYgbGFzdFRva2VuSW5kZXggPSBiYWxhbmNlT2YoX2Zyb20pLnN1YigxKTsKICAgIHVpbnQyNTYgbGFzdFRva2VuID0gb3duZWRUb2tlbnNbX2Zyb21dW2xhc3RUb2tlbkluZGV4XTsKCiAgICB0b2tlbk93bmVyW190b2tlbklkXSA9IDA7CiAgICBvd25lZFRva2Vuc1tfZnJvbV1bdG9rZW5JbmRleF0gPSBsYXN0VG9rZW47CiAgICBvd25lZFRva2Vuc1tfZnJvbV1bbGFzdFRva2VuSW5kZXhdID0gMDsKICAgIC8vIE5vdGUgdGhhdCB0aGlzIHdpbGwgaGFuZGxlIHNpbmdsZS1lbGVtZW50IGFycmF5cy4gSW4gdGhhdCBjYXNlLCBib3RoIHRva2VuSW5kZXggYW5kIGxhc3RUb2tlbkluZGV4IGFyZSBnb2luZyB0bwogICAgLy8gYmUgemVyby4gVGhlbiB3ZSBjYW4gbWFrZSBzdXJlIHRoYXQgd2Ugd2lsbCByZW1vdmUgX3Rva2VuSWQgZnJvbSB0aGUgb3duZWRUb2tlbnMgbGlzdCBzaW5jZSB3ZSBhcmUgZmlyc3Qgc3dhcHBpbmcKICAgIC8vIHRoZSBsYXN0VG9rZW4gdG8gdGhlIGZpcnN0IHBvc2l0aW9uLCBhbmQgdGhlbiBkcm9wcGluZyB0aGUgZWxlbWVudCBwbGFjZWQgaW4gdGhlIGxhc3QgcG9zaXRpb24gb2YgdGhlIGxpc3QKCiAgICBvd25lZFRva2Vuc1tfZnJvbV0ubGVuZ3RoLS07CiAgICBvd25lZFRva2Vuc0luZGV4W190b2tlbklkXSA9IDA7CiAgICBvd25lZFRva2Vuc0luZGV4W2xhc3RUb2tlbl0gPSB0b2tlbkluZGV4OwogICAgdG90YWxUb2tlbnMgPSB0b3RhbFRva2Vucy5zdWIoMSk7CiAgfQoKICBmdW5jdGlvbiBfaXNDb250cmFjdChhZGRyZXNzIGFkZHIpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBzaXplOwogICAgYXNzZW1ibHkgeyBzaXplIDo9IGV4dGNvZGVzaXplKGFkZHIpIH0KICAgIHJldHVybiBzaXplID4gMDsKICB9Cn0KCmNvbnRyYWN0IExpY2Vuc2VTYWxlIGlzIExpY2Vuc2VPd25lcnNoaXAgewogIEFmZmlsaWF0ZVByb2dyYW0gcHVibGljIGFmZmlsaWF0ZVByb2dyYW07CgogIC8qKgogICAqIEBub3RpY2UgV2UgY3JlZGl0IGFmZmlsaWF0ZXMgZm9yIHJlbmV3YWxzIHRoYXQgb2NjdXIgd2l0aGluIHRoaXMgdGltZSBvZgogICAqIG9yaWdpbmFsIHB1cmNoYXNlLiBFLmcuIElmIHRoaXMgaXMgc2V0IHRvIDEgeWVhciwgYW5kIHNvbWVvbmUgc3Vic2NyaWJlcyB0bwogICAqIGEgbW9udGhseSBwbGFuLCB0aGUgYWZmaWxpYXRlIHdpbGwgcmVjZWl2ZSBjcmVkaXRzIGZvciB0aGF0IHdob2xlIHllYXIsIGFzCiAgICogdGhlIHVzZXIgcmVuZXdzIHRoZWlyIHBsYW4KICAgKi8KICB1aW50MjU2IHB1YmxpYyByZW5ld2Fsc0NyZWRpdEFmZmlsaWF0ZXNGb3IgPSAxIHllYXJzOwoKICAvKiogaW50ZXJuYWwgKiovCiAgZnVuY3Rpb24gX3BlcmZvcm1QdXJjaGFzZSgKICAgIHVpbnQyNTYgX3Byb2R1Y3RJZCwKICAgIHVpbnQyNTYgX251bUN5Y2xlcywKICAgIGFkZHJlc3MgX2Fzc2lnbmVlLAogICAgdWludDI1NiBfYXR0cmlidXRlcywKICAgIGFkZHJlc3MgX2FmZmlsaWF0ZSkKICAgIGludGVybmFsIHJldHVybnMgKHVpbnQpCiAgewogICAgX3B1cmNoYXNlT25lVW5pdEluU3RvY2soX3Byb2R1Y3RJZCk7CiAgICByZXR1cm4gX2NyZWF0ZUxpY2Vuc2UoCiAgICAgIF9wcm9kdWN0SWQsCiAgICAgIF9udW1DeWNsZXMsCiAgICAgIF9hc3NpZ25lZSwKICAgICAgX2F0dHJpYnV0ZXMsCiAgICAgIF9hZmZpbGlhdGUKICAgICAgKTsKICB9CgogIGZ1bmN0aW9uIF9jcmVhdGVMaWNlbnNlKAogICAgdWludDI1NiBfcHJvZHVjdElkLAogICAgdWludDI1NiBfbnVtQ3ljbGVzLAogICAgYWRkcmVzcyBfYXNzaWduZWUsCiAgICB1aW50MjU2IF9hdHRyaWJ1dGVzLAogICAgYWRkcmVzcyBfYWZmaWxpYXRlKQogICAgaW50ZXJuYWwKICAgIHJldHVybnMgKHVpbnQpCiAgewogICAgLy8gWW91IGNhbm5vdCBjcmVhdGUgYSBzdWJzY3JpcHRpb24gbGljZW5zZSB3aXRoIHplcm8gY3ljbGVzCiAgICBpZihpc1N1YnNjcmlwdGlvblByb2R1Y3QoX3Byb2R1Y3RJZCkpIHsKICAgICAgcmVxdWlyZShfbnVtQ3ljbGVzICE9IDApOwogICAgfQoKICAgIC8vIE5vbi1zdWJzY3JpcHRpb24gcHJvZHVjdHMgaGF2ZSBhbiBleHBpcmF0aW9uIHRpbWUgb2YgMCwgbWVhbmluZyAibm8tZXhwaXJhdGlvbiIKICAgIHVpbnQyNTYgZXhwaXJhdGlvblRpbWUgPSBpc1N1YnNjcmlwdGlvblByb2R1Y3QoX3Byb2R1Y3RJZCkgPwogICAgICBub3cuYWRkKGludGVydmFsT2YoX3Byb2R1Y3RJZCkubXVsKF9udW1DeWNsZXMpKSA6IC8vIHNvbGl1bS1kaXNhYmxlLWxpbmUgc2VjdXJpdHkvbm8tYmxvY2stbWVtYmVycwogICAgICAwOwoKICAgIExpY2Vuc2UgbWVtb3J5IF9saWNlbnNlID0gTGljZW5zZSh7CiAgICAgIHByb2R1Y3RJZDogX3Byb2R1Y3RJZCwKICAgICAgYXR0cmlidXRlczogX2F0dHJpYnV0ZXMsCiAgICAgIGlzc3VlZFRpbWU6IG5vdywgLy8gc29saXVtLWRpc2FibGUtbGluZSBzZWN1cml0eS9uby1ibG9jay1tZW1iZXJzCiAgICAgIGV4cGlyYXRpb25UaW1lOiBleHBpcmF0aW9uVGltZSwKICAgICAgYWZmaWxpYXRlOiBfYWZmaWxpYXRlCiAgICB9KTsKCiAgICB1aW50MjU2IG5ld0xpY2Vuc2VJZCA9IGxpY2Vuc2VzLnB1c2goX2xpY2Vuc2UpIC0gMTsgLy8gc29saXVtLWRpc2FibGUtbGluZSB6ZXBwZWxpbi9uby1hcml0aG1ldGljLW9wZXJhdGlvbnMKICAgIExpY2Vuc2VJc3N1ZWQoCiAgICAgIF9hc3NpZ25lZSwKICAgICAgbXNnLnNlbmRlciwKICAgICAgbmV3TGljZW5zZUlkLAogICAgICBfbGljZW5zZS5wcm9kdWN0SWQsCiAgICAgIF9saWNlbnNlLmF0dHJpYnV0ZXMsCiAgICAgIF9saWNlbnNlLmlzc3VlZFRpbWUsCiAgICAgIF9saWNlbnNlLmV4cGlyYXRpb25UaW1lLAogICAgICBfbGljZW5zZS5hZmZpbGlhdGUpOwogICAgX21pbnQoX2Fzc2lnbmVlLCBuZXdMaWNlbnNlSWQpOwogICAgcmV0dXJuIG5ld0xpY2Vuc2VJZDsKICB9CgogIGZ1bmN0aW9uIF9oYW5kbGVBZmZpbGlhdGUoCiAgICBhZGRyZXNzIF9hZmZpbGlhdGUsCiAgICB1aW50MjU2IF9wcm9kdWN0SWQsCiAgICB1aW50MjU2IF9saWNlbnNlSWQsCiAgICB1aW50MjU2IF9wdXJjaGFzZUFtb3VudCkKICAgIGludGVybmFsCiAgewogICAgdWludDI1NiBhZmZpbGlhdGVDdXQgPSBhZmZpbGlhdGVQcm9ncmFtLmN1dEZvcigKICAgICAgX2FmZmlsaWF0ZSwKICAgICAgX3Byb2R1Y3RJZCwKICAgICAgX2xpY2Vuc2VJZCwKICAgICAgX3B1cmNoYXNlQW1vdW50KTsKICAgIGlmKGFmZmlsaWF0ZUN1dCA+IDApIHsKICAgICAgcmVxdWlyZShhZmZpbGlhdGVDdXQgPCBfcHVyY2hhc2VBbW91bnQpOwogICAgICBhZmZpbGlhdGVQcm9ncmFtLmNyZWRpdC52YWx1ZShhZmZpbGlhdGVDdXQpKF9hZmZpbGlhdGUsIF9saWNlbnNlSWQpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX3BlcmZvcm1SZW5ld2FsKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX251bUN5Y2xlcykgaW50ZXJuYWwgewogICAgLy8gWW91IGNhbm5vdCByZW5ldyBhIG5vbi1leHBpcmluZyBsaWNlbnNlCiAgICAvLyAuLi4gYnV0IGluIHdoYXQgc2NlbmFyaW8gY2FuIHRoaXMgaGFwcGVuPwogICAgLy8gcmVxdWlyZShsaWNlbnNlc1tfdG9rZW5JZF0uZXhwaXJhdGlvblRpbWUgIT0gMCk7CiAgICB1aW50MjU2IHByb2R1Y3RJZCA9IGxpY2Vuc2VQcm9kdWN0SWQoX3Rva2VuSWQpOwoKICAgIC8vIElmIG91ciBleHBpcmF0aW9uIGlzIGluIHRoZSBmdXR1cmUsIHJlbmV3aW5nIGFkZHMgdGltZSB0byB0aGF0IGZ1dHVyZSBleHBpcmF0aW9uCiAgICAvLyBJZiBvdXIgZXhwaXJhdGlvbiBoYXMgcGFzc2VkIGFscmVhZHksIHRoZW4gd2UgdXNlIGBub3dgIGFzIHRoZSBiYXNlLgogICAgdWludDI1NiByZW5ld2FsQmFzZVRpbWUgPSBNYXRoLm1heDI1Nihub3csIGxpY2Vuc2VzW190b2tlbklkXS5leHBpcmF0aW9uVGltZSk7CgogICAgLy8gV2UgYXNzdW1lIHRoYXQgdGhlIHBheW1lbnQgaGFzIGJlZW4gdmFsaWRhdGVkIG91dHNpZGUgb2YgdGhpcyBmdW5jdGlvbgogICAgdWludDI1NiBuZXdFeHBpcmF0aW9uVGltZSA9IHJlbmV3YWxCYXNlVGltZS5hZGQoaW50ZXJ2YWxPZihwcm9kdWN0SWQpLm11bChfbnVtQ3ljbGVzKSk7CgogICAgbGljZW5zZXNbX3Rva2VuSWRdLmV4cGlyYXRpb25UaW1lID0gbmV3RXhwaXJhdGlvblRpbWU7CgogICAgTGljZW5zZVJlbmV3YWwoCiAgICAgIG93bmVyT2YoX3Rva2VuSWQpLAogICAgICBtc2cuc2VuZGVyLAogICAgICBfdG9rZW5JZCwKICAgICAgcHJvZHVjdElkLAogICAgICBuZXdFeHBpcmF0aW9uVGltZQogICAgKTsKICB9CgogIGZ1bmN0aW9uIF9hZmZpbGlhdGVQcm9ncmFtSXNBY3RpdmUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybgogICAgICBhZmZpbGlhdGVQcm9ncmFtICE9IGFkZHJlc3MoMCkgJiYKICAgICAgYWZmaWxpYXRlUHJvZ3JhbS5zdG9yZUFkZHJlc3MoKSA9PSBhZGRyZXNzKHRoaXMpICYmCiAgICAgICFhZmZpbGlhdGVQcm9ncmFtLnBhdXNlZCgpOwogIH0KCiAgLyoqIGV4ZWN1dGl2ZXMgKiovCiAgZnVuY3Rpb24gc2V0QWZmaWxpYXRlUHJvZ3JhbUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICBBZmZpbGlhdGVQcm9ncmFtIGNhbmRpZGF0ZUNvbnRyYWN0ID0gQWZmaWxpYXRlUHJvZ3JhbShfYWRkcmVzcyk7CiAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzQWZmaWxpYXRlUHJvZ3JhbSgpKTsKICAgIGFmZmlsaWF0ZVByb2dyYW0gPSBjYW5kaWRhdGVDb250cmFjdDsKICB9CgogIGZ1bmN0aW9uIHNldFJlbmV3YWxzQ3JlZGl0QWZmaWxpYXRlc0Zvcih1aW50MjU2IF9uZXdUaW1lKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlbmV3YWxzQ3JlZGl0QWZmaWxpYXRlc0ZvciA9IF9uZXdUaW1lOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUHJvbW90aW9uYWxQdXJjaGFzZSgKICAgIHVpbnQyNTYgX3Byb2R1Y3RJZCwKICAgIHVpbnQyNTYgX251bUN5Y2xlcywKICAgIGFkZHJlc3MgX2Fzc2lnbmVlLAogICAgdWludDI1NiBfYXR0cmlidXRlcwogICAgKQogICAgZXh0ZXJuYWwKICAgIG9ubHlDRU9PckNPTwogICAgd2hlbk5vdFBhdXNlZAogICAgcmV0dXJucyAodWludDI1NikKICB7CiAgICByZXR1cm4gX3BlcmZvcm1QdXJjaGFzZSgKICAgICAgX3Byb2R1Y3RJZCwKICAgICAgX251bUN5Y2xlcywKICAgICAgX2Fzc2lnbmVlLAogICAgICBfYXR0cmlidXRlcywKICAgICAgYWRkcmVzcygwKSk7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVQcm9tb3Rpb25hbFJlbmV3YWwoCiAgICB1aW50MjU2IF90b2tlbklkLAogICAgdWludDI1NiBfbnVtQ3ljbGVzCiAgICApCiAgICBleHRlcm5hbAogICAgb25seUNFT09yQ09PCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgdWludDI1NiBwcm9kdWN0SWQgPSBsaWNlbnNlUHJvZHVjdElkKF90b2tlbklkKTsKICAgIF9yZXF1aXJlUmVuZXdhYmxlUHJvZHVjdChwcm9kdWN0SWQpOwoKICAgIHJldHVybiBfcGVyZm9ybVJlbmV3YWwoX3Rva2VuSWQsIF9udW1DeWNsZXMpOwogIH0KCiAgLyoqIGFueW9uZSAqKi8KCiAgLyoqCiAgKiBAbm90aWNlIE1ha2VzIGEgcHVyY2hhc2Ugb2YgYSBwcm9kdWN0LgogICogQGRldiBSZXF1aXJlcyB0aGF0IHRoZSB2YWx1ZSBzZW50IGlzIGV4YWN0bHkgdGhlIHByaWNlIG9mIHRoZSBwcm9kdWN0CiAgKiBAcGFyYW0gX3Byb2R1Y3RJZCAtIHRoZSBwcm9kdWN0IHRvIHB1cmNoYXNlCiAgKiBAcGFyYW0gX251bUN5Y2xlcyAtIHRoZSBudW1iZXIgb2YgY3ljbGVzIGJlaW5nIHB1cmNoYXNlZC4gVGhpcyBudW1iZXIgc2hvdWxkIGJlIGAxYCBmb3Igbm9uLXN1YnNjcmlwdGlvbiBwcm9kdWN0cyBhbmQgdGhlIG51bWJlciBvZiBjeWNsZXMgZm9yIHN1YnNjcmlwdGlvbnMuCiAgKiBAcGFyYW0gX2Fzc2lnbmVlIC0gdGhlIGFkZHJlc3MgdG8gYXNzaWduIHRoZSBwdXJjaGFzZSB0byAoZG9lc24ndCBoYXZlIHRvIGJlIG1zZy5zZW5kZXIpCiAgKiBAcGFyYW0gX2FmZmlsaWF0ZSAtIHRoZSBhZGRyZXNzIHRvIG9mIHRoZSBhZmZpbGlhdGUgLSB1c2UgYWRkcmVzcygwKSBpZiBub25lCiAgKi8KICBmdW5jdGlvbiBwdXJjaGFzZSgKICAgIHVpbnQyNTYgX3Byb2R1Y3RJZCwKICAgIHVpbnQyNTYgX251bUN5Y2xlcywKICAgIGFkZHJlc3MgX2Fzc2lnbmVlLAogICAgYWRkcmVzcyBfYWZmaWxpYXRlCiAgICApCiAgICBleHRlcm5hbAogICAgcGF5YWJsZQogICAgd2hlbk5vdFBhdXNlZAogICAgcmV0dXJucyAodWludDI1NikKICB7CiAgICByZXF1aXJlKF9wcm9kdWN0SWQgIT0gMCk7CiAgICByZXF1aXJlKF9udW1DeWNsZXMgIT0gMCk7CiAgICByZXF1aXJlKF9hc3NpZ25lZSAhPSBhZGRyZXNzKDApKTsKICAgIC8vIG1zZy52YWx1ZSBjYW4gYmUgemVybzogZnJlZSBwcm9kdWN0cyBhcmUgc3VwcG9ydGVkCgogICAgLy8gRG9uJ3QgYm90aGVyIGRlYWxpbmcgd2l0aCBleGNlc3MgcGF5bWVudHMuIEVuc3VyZSB0aGUgcHJpY2UgcGFpZCBpcwogICAgLy8gYWNjdXJhdGUuIE5vIG1vcmUsIG5vIGxlc3MuCiAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBjb3N0Rm9yUHJvZHVjdEN5Y2xlcyhfcHJvZHVjdElkLCBfbnVtQ3ljbGVzKSk7CgogICAgLy8gTm9uLXN1YnNjcmlwdGlvbiBwcm9kdWN0cyBzaG91bGQgc2VuZCBhIF9udW1DeWNsZSBvZiAxIC0tIHlvdSBjYW4ndCBidXkgYQogICAgLy8gbXVsdGlwbGUgcXVhbnRpdHkgb2YgYSBub24tc3Vic2NyaXB0aW9uIHByb2R1Y3Qgd2l0aCB0aGlzIGZ1bmN0aW9uCiAgICBpZighaXNTdWJzY3JpcHRpb25Qcm9kdWN0KF9wcm9kdWN0SWQpKSB7CiAgICAgIHJlcXVpcmUoX251bUN5Y2xlcyA9PSAxKTsKICAgIH0KCiAgICAvLyB0aGlzIGNhbiwgb2YgY291cnNlLCBiZSBnYW1lZCBieSBtYWxpY2lvdXMgbWluZXJzLiBCdXQgaXQncyBhZGVxdWF0ZSBmb3Igb3VyIGFwcGxpY2F0aW9uCiAgICAvLyBGZWVsIGZyZWUgdG8gYWRkIHlvdXIgb3duIHN0cmF0ZWdpZXMgZm9yIHByb2R1Y3QgYXR0cmlidXRlcwogICAgLy8gc29saXVtLWRpc2FibGUtbmV4dC1saW5lIHNlY3VyaXR5L25vLWJsb2NrLW1lbWJlcnMsIHplcHBlbGluL25vLWFyaXRobWV0aWMtb3BlcmF0aW9ucwogICAgdWludDI1NiBhdHRyaWJ1dGVzID0gdWludDI1NihrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSkpXl9wcm9kdWN0SWReKHVpbnQyNTYoX2Fzc2lnbmVlKSk7CiAgICB1aW50MjU2IGxpY2Vuc2VJZCA9IF9wZXJmb3JtUHVyY2hhc2UoCiAgICAgIF9wcm9kdWN0SWQsCiAgICAgIF9udW1DeWNsZXMsCiAgICAgIF9hc3NpZ25lZSwKICAgICAgYXR0cmlidXRlcywKICAgICAgX2FmZmlsaWF0ZSk7CgogICAgaWYoCiAgICAgIHByaWNlT2YoX3Byb2R1Y3RJZCkgPiAwICYmCiAgICAgIF9hZmZpbGlhdGUgIT0gYWRkcmVzcygwKSAmJgogICAgICBfYWZmaWxpYXRlUHJvZ3JhbUlzQWN0aXZlKCkKICAgICkgewogICAgICBfaGFuZGxlQWZmaWxpYXRlKAogICAgICAgIF9hZmZpbGlhdGUsCiAgICAgICAgX3Byb2R1Y3RJZCwKICAgICAgICBsaWNlbnNlSWQsCiAgICAgICAgbXNnLnZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gbGljZW5zZUlkOwogIH0KCiAgLyoqCiAgICogQG5vdGljZSBSZW5ld3MgYSBzdWJzY3JpcHRpb24KICAgKi8KICBmdW5jdGlvbiByZW5ldygKICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICB1aW50MjU2IF9udW1DeWNsZXMKICAgICkKICAgIGV4dGVybmFsCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgewogICAgcmVxdWlyZShfbnVtQ3ljbGVzICE9IDApOwogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IHByb2R1Y3RJZCA9IGxpY2Vuc2VQcm9kdWN0SWQoX3Rva2VuSWQpOwogICAgX3JlcXVpcmVSZW5ld2FibGVQcm9kdWN0KHByb2R1Y3RJZCk7CgogICAgLy8gTm8gZXhjZXNzIHBheW1lbnRzLiBFbnN1cmUgdGhlIHByaWNlIHBhaWQgaXMgZXhhY3RseSBhY2N1cmF0ZS4gTm8gbW9yZSwKICAgIC8vIG5vIGxlc3MuCiAgICB1aW50MjU2IHJlbmV3YWxDb3N0ID0gY29zdEZvclByb2R1Y3RDeWNsZXMocHJvZHVjdElkLCBfbnVtQ3ljbGVzKTsKICAgIHJlcXVpcmUobXNnLnZhbHVlID09IHJlbmV3YWxDb3N0KTsKCiAgICBfcGVyZm9ybVJlbmV3YWwoX3Rva2VuSWQsIF9udW1DeWNsZXMpOwoKICAgIGlmKAogICAgICByZW5ld2FsQ29zdCA+IDAgJiYKICAgICAgbGljZW5zZUFmZmlsaWF0ZShfdG9rZW5JZCkgIT0gYWRkcmVzcygwKSAmJgogICAgICBfYWZmaWxpYXRlUHJvZ3JhbUlzQWN0aXZlKCkgJiYKICAgICAgbGljZW5zZUlzc3VlZFRpbWUoX3Rva2VuSWQpLmFkZChyZW5ld2Fsc0NyZWRpdEFmZmlsaWF0ZXNGb3IpID4gbm93CiAgICApIHsKICAgICAgX2hhbmRsZUFmZmlsaWF0ZSgKICAgICAgICBsaWNlbnNlQWZmaWxpYXRlKF90b2tlbklkKSwKICAgICAgICBwcm9kdWN0SWQsCiAgICAgICAgX3Rva2VuSWQsCiAgICAgICAgbXNnLnZhbHVlKTsKICAgIH0KICB9Cgp9Cgpjb250cmFjdCBMaWNlbnNlQ29yZSBpcyBMaWNlbnNlU2FsZSB7CiAgYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKICBmdW5jdGlvbiBMaWNlbnNlQ29yZSgpIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwoKICAgIGNlb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICBjZm9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIHdpdGhkcmF3YWxBZGRyZXNzID0gbXNnLnNlbmRlcjsKICB9CgogIGZ1bmN0aW9uIHNldE5ld0FkZHJlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgbmV3Q29udHJhY3RBZGRyZXNzID0gX3YyQWRkcmVzczsKICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICB9CgogIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgewogICAgYXNzZXJ0KGZhbHNlKTsKICB9CgogIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwogICAgc3VwZXIudW5wYXVzZSgpOwogIH0KfQoKbGlicmFyeSBTdHJpbmdzIHsKICAvLyB2aWEgaHR0cHM6Ly9naXRodWIuY29tL29yYWNsaXplL2V0aGVyZXVtLWFwaS9ibG9iL21hc3Rlci9vcmFjbGl6ZUFQSV8wLjUuc29sCiAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICBieXRlcyBtZW1vcnkgX2JiID0gYnl0ZXMoX2IpOwogICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICBieXRlcyBtZW1vcnkgX2JlID0gYnl0ZXMoX2UpOwogICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgIHVpbnQgayA9IDA7CiAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICBmb3IgKGkgPSAwOyBpIDwgX2JjLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iY1tpXTsKICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICByZXR1cm4gc3RyaW5nKGJhYmNkZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKXsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGogLz0gMTA7CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgICAgdWludCBrID0gbGVuIC0gMTsKICAgICAgICB3aGlsZSAoaSAhPSAwKXsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9Cn0='.
	

]
