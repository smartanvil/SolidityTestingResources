Class {
	#name : #SRT4156A19E82D48c1D7edb630E3E9CAbF21C893EeA,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4156A19E82D48c1D7edb630E3E9CAbF21C893EeA >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLyBDb2RlIHRha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2RhcHAtYmluL2Jsb2IvbWFzdGVyL3dhbGxldC93YWxsZXQuc29sCi8vIEF1ZGl0LCByZWZhY3RvcmluZyBhbmQgaW1wcm92ZW1lbnRzIGJ5IGdpdGh1Yi5jb20vRWVuYWUKCi8vIEBhdXRob3JzOgovLyBHYXYgV29vZCA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImRjYmI5Y2I5YThiNGI4YjlhYWYyYmZiM2IxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8gaW5oZXJpdGFibGUgInByb3BlcnR5IiBjb250cmFjdCB0aGF0IGVuYWJsZXMgbWV0aG9kcyB0byBiZSBwcm90ZWN0ZWQgYnkgcmVxdWlyaW5nIHRoZSBhY3F1aWVzY2VuY2Ugb2YgZWl0aGVyIGEKLy8gc2luZ2xlLCBvciwgY3J1Y2lhbGx5LCBlYWNoIG9mIGEgbnVtYmVyIG9mLCBkZXNpZ25hdGVkIG93bmVycy4KLy8gdXNhZ2U6Ci8vIHVzZSBtb2RpZmllcnMgb25seW93bmVyIChqdXN0IG93biBvd25lZCkgb3Igb25seW1hbnlvd25lcnMoaGFzaCksIHdoZXJlYnkgdGhlIHNhbWUgaGFzaCBtdXN0IGJlIHByb3ZpZGVkIGJ5Ci8vIHNvbWUgbnVtYmVyIChzcGVjaWZpZWQgaW4gY29uc3RydWN0b3IpIG9mIHRoZSBzZXQgb2Ygb3duZXJzIChzcGVjaWZpZWQgaW4gdGhlIGNvbnN0cnVjdG9yLCBtb2RpZmlhYmxlKSBiZWZvcmUgdGhlCi8vIGludGVyaW9yIGlzIGV4ZWN1dGVkLgoKCgovLy8gbm90ZTogZHVyaW5nIGFueSBvd25lcnNoaXAgY2hhbmdlcyBhbGwgcGVuZGluZyBvcGVyYXRpb25zICh3YWl0aW5nIGZvciBtb3JlIHNpZ25hdHVyZXMpIGFyZSBjYW5jZWxsZWQKLy8gVE9ETyBhY2NlcHRPd25lcnNoaXAKY29udHJhY3QgbXVsdGlvd25lZCB7CgoJLy8gVFlQRVMKCiAgICAvLyBzdHJ1Y3QgZm9yIHRoZSBzdGF0dXMgb2YgYSBwZW5kaW5nIG9wZXJhdGlvbi4KICAgIHN0cnVjdCBNdWx0aU93bmVkT3BlcmF0aW9uUGVuZGluZ1N0YXRlIHsKICAgICAgICAvLyBjb3VudCBvZiBjb25maXJtYXRpb25zIG5lZWRlZAogICAgICAgIHVpbnQgeWV0TmVlZGVkOwoKICAgICAgICAvLyBiaXRtYXAgb2YgY29uZmlybWF0aW9ucyB3aGVyZSBvd25lciAjb3duZXJJbmRleCdzIGRlY2lzaW9uIGNvcnJlc3BvbmRzIHRvIDIqKm93bmVySW5kZXggYml0CiAgICAgICAgdWludCBvd25lcnNEb25lOwoKICAgICAgICAvLyBwb3NpdGlvbiBvZiB0aGlzIG9wZXJhdGlvbiBrZXkgaW4gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4CiAgICAgICAgdWludCBpbmRleDsKICAgIH0KCgkvLyBFVkVOVFMKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IEZpbmFsQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKCiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwoKICAgIC8vIHRoZSBsYXN0IG9uZSBpcyBlbWl0dGVkIGlmIHRoZSByZXF1aXJlZCBzaWduYXR1cmVzIGNoYW5nZQogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2VkKHVpbnQgbmV3UmVxdWlyZW1lbnQpOwoKCS8vIE1PRElGSUVSUwoKICAgIC8vIHNpbXBsZSBzaW5nbGUtc2lnIGZ1bmN0aW9uIG1vZGlmaWVyLgogICAgbW9kaWZpZXIgb25seW93bmVyIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CiAgICAvLyBtdWx0aS1zaWcgZnVuY3Rpb24gbW9kaWZpZXI6IHRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQKICAgIC8vIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgIG1vZGlmaWVyIG9ubHltYW55b3duZXJzKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgLy8gRXZlbiBpZiByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBoYXMndCBiZWVuIGNvbGxlY3RlZCB5ZXQsCiAgICAgICAgLy8gd2UgY2FuJ3QgdGhyb3cgaGVyZSAtIGJlY2F1c2UgY2hhbmdlcyB0byB0aGUgc3RhdGUgaGF2ZSB0byBiZSBwcmVzZXJ2ZWQuCiAgICAgICAgLy8gQnV0LCBjb25maXJtQW5kQ2hlY2sgaXRzZWxmIHdpbGwgdGhyb3cgaW4gY2FzZSBzZW5kZXIgaXMgbm90IGFuIG93bmVyLgogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkTnVtT3duZXJzKHVpbnQgX251bU93bmVycykgewogICAgICAgIHJlcXVpcmUoX251bU93bmVycyA+IDAgJiYgX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCwgdWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWQgPiAwICYmIF9yZXF1aXJlZCA8PSBfbnVtT3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyKF9hZGRyZXNzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgcmVxdWlyZShpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSk7CiAgICAgICAgXzsKICAgIH0KCgkvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgaXMgZ2l2ZW4gbnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgdG8gZG8gcHJvdGVjdGVkICJvbmx5bWFueW93bmVycyIgdHJhbnNhY3Rpb25zCiAgICAvLyBhcyB3ZWxsIGFzIHRoZSBzZWxlY3Rpb24gb2YgYWRkcmVzc2VzIGNhcGFibGUgb2YgY29uZmlybWluZyB0aGVtIChtc2cuc2VuZGVyIGlzIG5vdCBhZGRlZCB0byB0aGUgb3duZXJzISkuCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICB2YWxpZE51bU93bmVycyhfb3duZXJzLmxlbmd0aCkKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChfcmVxdWlyZWQsIF9vd25lcnMubGVuZ3RoKQogICAgewogICAgICAgIGFzc2VydChjX21heE93bmVycyA8PSAyNTUpOwoKICAgICAgICBtX251bU93bmVycyA9IF9vd25lcnMubGVuZ3RoOwogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX3JlcXVpcmVkOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfb3duZXJzLmxlbmd0aDsgKytpKQogICAgICAgIHsKICAgICAgICAgICAgYWRkcmVzcyBvd25lciA9IF9vd25lcnNbaV07CiAgICAgICAgICAgIC8vIGludmFsaWQgYW5kIGR1cGxpY2F0ZSBhZGRyZXNzZXMgYXJlIG5vdCBhbGxvd2VkCiAgICAgICAgICAgIHJlcXVpcmUoMCAhPSBvd25lciAmJiAhaXNPd25lcihvd25lcikgLyogbm90IGlzT3duZXIgeWV0ISAqLyk7CgogICAgICAgICAgICB1aW50IGN1cnJlbnRPd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KGkgKyAxIC8qIGZpcnN0IHNsb3QgaXMgdW51c2VkICovKTsKICAgICAgICAgICAgbV9vd25lcnNbY3VycmVudE93bmVySW5kZXhdID0gb3duZXI7CiAgICAgICAgICAgIG1fb3duZXJJbmRleFtvd25lcl0gPSBjdXJyZW50T3duZXJJbmRleDsKICAgICAgICB9CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZXBsYWNlcyBhbiBvd25lciBgX2Zyb21gIHdpdGggYW5vdGhlciBgX3RvYC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gYWRkcmVzcyBvZiBvd25lciB0byByZXBsYWNlCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIG9mIG5ldyBvd25lcgogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvd25lckV4aXN0cyhfZnJvbSkKICAgICAgICBvd25lckRvZXNOb3RFeGlzdChfdG8pCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19mcm9tXSk7CiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSBfdG87CiAgICAgICAgbV9vd25lckluZGV4W19mcm9tXSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W190b10gPSBvd25lckluZGV4OwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJDaGFuZ2VkKF9mcm9tLCBfdG8pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGFkZHMgYW4gb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgbmV3IG93bmVyCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIF9vd25lcikKICAgICAgICBleHRlcm5hbAogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KF9vd25lcikKICAgICAgICB2YWxpZE51bU93bmVycyhtX251bU93bmVycyArIDEpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBtX251bU93bmVycysrOwogICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IF9vd25lcjsKICAgICAgICBtX293bmVySW5kZXhbX293bmVyXSA9IGNoZWNrT3duZXJJbmRleChtX251bU93bmVycyk7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lckFkZGVkKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcmVtb3ZlcyBhbiBvd25lcgogICAgLy8vIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBvZiBvd25lciB0byByZW1vdmUKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb3duZXJFeGlzdHMoX293bmVyKQogICAgICAgIHZhbGlkTnVtT3duZXJzKG1fbnVtT3duZXJzIC0gMSkKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChtX211bHRpT3duZWRSZXF1aXJlZCwgbV9udW1Pd25lcnMgLSAxKQogICAgICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtfb3duZXJdKTsKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W19vd25lcl0gPSAwOwogICAgICAgIC8vbWFrZSBzdXJlIG1fbnVtT3duZXJzIGlzIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3duZXJzIGFuZCBhbHdheXMgcG9pbnRzIHRvIHRoZSBsYXN0IG93bmVyCiAgICAgICAgcmVvcmdhbml6ZU93bmVycygpOwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2hhbmdlcyB0aGUgcmVxdWlyZWQgbnVtYmVyIG9mIG93bmVyIHNpZ25hdHVyZXMKICAgIC8vLyBAcGFyYW0gX25ld1JlcXVpcmVkIG5ldyBudW1iZXIgb2Ygc2lnbmF0dXJlcyByZXF1aXJlZAogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChfbmV3UmVxdWlyZWQsIG1fbnVtT3duZXJzKQogICAgICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX25ld1JlcXVpcmVkOwogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlZChfbmV3UmVxdWlyZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldHMgYW4gb3duZXIgYnkgMC1pbmRleGVkIHBvc2l0aW9uCiAgICAvLy8gQHBhcmFtIG93bmVySW5kZXggMC1pbmRleGVkIG93bmVyIHBvc2l0aW9uCiAgICBmdW5jdGlvbiBnZXRPd25lcih1aW50IG93bmVySW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJzW293bmVySW5kZXggKyAxXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXRzIG93bmVycwogICAgLy8vIEByZXR1cm4gbWVtb3J5IGFycmF5IG9mIG93bmVycwogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3NbXSkgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IGFkZHJlc3NbXShtX251bU93bmVycyk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbV9udW1Pd25lcnM7IGkrKykKICAgICAgICAgICAgcmVzdWx0W2ldID0gZ2V0T3duZXIoaSk7CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2hlY2tzIGlmIHByb3ZpZGVkIGFkZHJlc3MgaXMgYW4gb3duZXIgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYWRkciBhZGRyZXNzIHRvIGNoZWNrCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGl0J3MgYW4gb3duZXIKICAgIGZ1bmN0aW9uIGlzT3duZXIoYWRkcmVzcyBfYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbV9vd25lckluZGV4W19hZGRyXSA+IDA7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGVzdHMgb3duZXJzaGlwIG9mIHRoZSBjdXJyZW50IGNhbGxlci4KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgLy8gSXQncyBhZHZpc2FibGUgdG8gY2FsbCBpdCBieSBuZXcgb3duZXIgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHNhbWUgZXJyb25lb3VzIGFkZHJlc3MgaXMgbm90IGNvcHktcGFzdGVkIHRvCiAgICAvLyBhZGRPd25lci9jaGFuZ2VPd25lciBhbmQgdG8gaXNPd25lci4KICAgIGZ1bmN0aW9uIGFtSU93bmVyKCkgZXh0ZXJuYWwgY29uc3RhbnQgb25seW93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXZva2VzIGEgcHJpb3IgY29uZmlybWF0aW9uIG9mIHRoZSBnaXZlbiBvcGVyYXRpb24KICAgIC8vLyBAcGFyYW0gX29wZXJhdGlvbiBvcGVyYXRpb24gdmFsdWUsIHR5cGljYWxseSBzaGEzKG1zZy5kYXRhKQogICAgZnVuY3Rpb24gcmV2b2tlKGJ5dGVzMzIgX29wZXJhdGlvbikKICAgICAgICBleHRlcm5hbAogICAgICAgIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShfb3BlcmF0aW9uKQogICAgICAgIG9ubHlvd25lcgogICAgewogICAgICAgIHVpbnQgb3duZXJJbmRleEJpdCA9IG1ha2VPd25lckJpdG1hcEJpdChtc2cuc2VuZGVyKTsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgcmVxdWlyZShwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID4gMCk7CgogICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKCiAgICAgICAgcGVuZGluZy55ZXROZWVkZWQrKzsKICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgLT0gb3duZXJJbmRleEJpdDsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgIFJldm9rZShtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgaWYgb3duZXIgY29uZmlybWVkIGdpdmVuIG9wZXJhdGlvbgogICAgLy8vIEBwYXJhbSBfb3BlcmF0aW9uIG9wZXJhdGlvbiB2YWx1ZSwgdHlwaWNhbGx5IHNoYTMobXNnLmRhdGEpCiAgICAvLy8gQHBhcmFtIF9vd25lciBhbiBvd25lciBhZGRyZXNzCiAgICBmdW5jdGlvbiBoYXNDb25maXJtZWQoYnl0ZXMzMiBfb3BlcmF0aW9uLCBhZGRyZXNzIF9vd25lcikKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgbXVsdGlPd25lZE9wZXJhdGlvbklzQWN0aXZlKF9vcGVyYXRpb24pCiAgICAgICAgb3duZXJFeGlzdHMoX293bmVyKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuICEobV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS5vd25lcnNEb25lICYgbWFrZU93bmVyQml0bWFwQml0KF9vd25lcikgPT0gMCk7CiAgICB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGNvbmZpcm1BbmRDaGVjayhieXRlczMyIF9vcGVyYXRpb24pCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG9ubHlvd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKDUxMiA9PSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoKQogICAgICAgICAgICAvLyBJbiBjYXNlIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleCBncm93cyB0b28gbXVjaCB3ZSBoYXZlIHRvIHNocmluayBpdDogb3RoZXJ3aXNlIGF0IHNvbWUgcG9pbnQKICAgICAgICAgICAgLy8gd2Ugd29uJ3QgYmUgYWJsZSB0byBkbyBpdCBiZWNhdXNlIG9mIGJsb2NrIGdhcyBsaW1pdC4KICAgICAgICAgICAgLy8gWWVzLCBwZW5kaW5nIGNvbmZpcm1hdGlvbnMgd2lsbCBiZSBsb3N0LiBEb250IHNlZSBhbnkgc2VjdXJpdHkgb3Igc3RhYmlsaXR5IGltcGxpY2F0aW9ucy4KICAgICAgICAgICAgLy8gVE9ETyB1c2UgbW9yZSBncmFjZWZ1bCBhcHByb2FjaCBsaWtlIGNvbXBhY3Qgb3IgcmVtb3ZhbCBvZiBjbGVhclBlbmRpbmcgY29tcGxldGVseQogICAgICAgICAgICBjbGVhclBlbmRpbmcoKTsKCiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwoKICAgICAgICAvLyBpZiB3ZSdyZSBub3QgeWV0IHdvcmtpbmcgb24gdGhpcyBvcGVyYXRpb24sIHN3aXRjaCBvdmVyIGFuZCByZXNldCB0aGUgY29uZmlybWF0aW9uIHN0YXR1cy4KICAgICAgICBpZiAoISBpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSkgewogICAgICAgICAgICAvLyByZXNldCBjb3VudCBvZiBjb25maXJtYXRpb25zIG5lZWRlZC4KICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQgPSBtX211bHRpT3duZWRSZXF1aXJlZDsKICAgICAgICAgICAgLy8gcmVzZXQgd2hpY2ggb3duZXJzIGhhdmUgY29uZmlybWVkIChub25lKSAtIHNldCBvdXIgYml0bWFwIHRvIDAuCiAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSA9IDA7CiAgICAgICAgICAgIHBlbmRpbmcuaW5kZXggPSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoKys7CiAgICAgICAgICAgIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtwZW5kaW5nLmluZGV4XSA9IF9vcGVyYXRpb247CiAgICAgICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKICAgICAgICB9CgogICAgICAgIC8vIGRldGVybWluZSB0aGUgYml0IHRvIHNldCBmb3IgdGhpcyBvd25lci4KICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSBtYWtlT3duZXJCaXRtYXBCaXQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gbWFrZSBzdXJlIHdlICh0aGUgbWVzc2FnZSBzZW5kZXIpIGhhdmVuJ3QgY29uZmlybWVkIHRoaXMgb3BlcmF0aW9uIHByZXZpb3VzbHkuCiAgICAgICAgaWYgKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPT0gMCkgewogICAgICAgICAgICAvLyBvayAtIGNoZWNrIGlmIGNvdW50IGlzIGVub3VnaCB0byBnbyBhaGVhZC4KICAgICAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkID4gMCk7CiAgICAgICAgICAgIGlmIChwZW5kaW5nLnlldE5lZWRlZCA9PSAxKSB7CiAgICAgICAgICAgICAgICAvLyBlbm91Z2ggY29uZmlybWF0aW9uczogcmVzZXQgYW5kIHJ1biBpbnRlcmlvci4KICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS5pbmRleF07CiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICAgICAgICAgIEZpbmFsQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBub3QgZW5vdWdoOiByZWNvcmQgdGhhdCB0aGlzIG93bmVyIGluIHBhcnRpY3VsYXIgY29uZmlybWVkLgogICAgICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQtLTsKICAgICAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSB8PSBvd25lckluZGV4Qml0OwogICAgICAgICAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgICAgICAgICAgQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFJlY2xhaW1zIGZyZWUgc2xvdHMgYmV0d2VlbiB2YWxpZCBvd25lcnMgaW4gbV9vd25lcnMuCiAgICAvLyBUT0RPIGdpdmVuIHRoYXQgaXRzIGNhbGxlZCBhZnRlciBlYWNoIHJlbW92YWwsIGl0IGNvdWxkIGJlIHNpbXBsaWZpZWQuCiAgICBmdW5jdGlvbiByZW9yZ2FuaXplT3duZXJzKCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBmcmVlID0gMTsKICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzKQogICAgICAgIHsKICAgICAgICAgICAgLy8gaXRlcmF0aW5nIHRvIHRoZSBmaXJzdCBmcmVlIHNsb3QgZnJvbSB0aGUgYmVnaW5uaW5nCiAgICAgICAgICAgIHdoaWxlIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbZnJlZV0gIT0gMCkgZnJlZSsrOwoKICAgICAgICAgICAgLy8gaXRlcmF0aW5nIHRvIHRoZSBmaXJzdCBvY2N1cGllZCBzbG90IGZyb20gdGhlIGVuZAogICAgICAgICAgICB3aGlsZSAobV9udW1Pd25lcnMgPiAxICYmIG1fb3duZXJzW21fbnVtT3duZXJzXSA9PSAwKSBtX251bU93bmVycy0tOwoKICAgICAgICAgICAgLy8gc3dhcCwgaWYgcG9zc2libGUsIHNvIGZyZWUgc2xvdCBpcyBsb2NhdGVkIGF0IHRoZSBlbmQgYWZ0ZXIgdGhlIHN3YXAKICAgICAgICAgICAgaWYgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1ttX251bU93bmVyc10gIT0gMCAmJiBtX293bmVyc1tmcmVlXSA9PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBvd25lcnMgYmV0d2VlbiBzd2FwcGVkIHNsb3RzIHNob3VsZCd0IGJlIHJlbnVtYmVyZWQgLSB0aGF0IHNhdmVzIGEgbG90IG9mIGdhcwogICAgICAgICAgICAgICAgbV9vd25lcnNbZnJlZV0gPSBtX293bmVyc1ttX251bU93bmVyc107CiAgICAgICAgICAgICAgICBtX293bmVySW5kZXhbbV9vd25lcnNbZnJlZV1dID0gZnJlZTsKICAgICAgICAgICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJQZW5kaW5nKCkgcHJpdmF0ZSBvbmx5b3duZXIgewogICAgICAgIHVpbnQgbGVuZ3RoID0gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Lmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAobV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W2ldICE9IDApCiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ1ttX211bHRpT3duZWRQZW5kaW5nSW5kZXhbaV1dOwogICAgICAgIH0KICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrT3duZXJJbmRleCh1aW50IG93bmVySW5kZXgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIGFzc2VydCgwICE9IG93bmVySW5kZXggJiYgb3duZXJJbmRleCA8PSBjX21heE93bmVycyk7CiAgICAgICAgcmV0dXJuIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZU93bmVyQml0bWFwQml0KGFkZHJlc3Mgb3duZXIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChtX293bmVySW5kZXhbb3duZXJdKTsKICAgICAgICByZXR1cm4gMiAqKiBvd25lckluZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzT3BlcmF0aW9uQWN0aXZlKGJ5dGVzMzIgX29wZXJhdGlvbikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIDAgIT0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS55ZXROZWVkZWQ7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICBhc3NlcnQobV9udW1Pd25lcnMgPiAwKTsKICAgICAgICBhc3NlcnQobV9udW1Pd25lcnMgPD0gY19tYXhPd25lcnMpOwogICAgICAgIGFzc2VydChtX293bmVyc1swXSA9PSAwKTsKICAgICAgICBhc3NlcnQoMCAhPSBtX211bHRpT3duZWRSZXF1aXJlZCAmJiBtX211bHRpT3duZWRSZXF1aXJlZCA8PSBtX251bU93bmVycyk7CiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KGJ5dGVzMzIgX29wZXJhdGlvbikgcHJpdmF0ZSBjb25zdGFudCB7CiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgIGFzc2VydCgwICE9IHBlbmRpbmcueWV0TmVlZGVkKTsKICAgICAgICBhc3NlcnQobV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W3BlbmRpbmcuaW5kZXhdID09IF9vcGVyYXRpb24pOwogICAgICAgIGFzc2VydChwZW5kaW5nLnlldE5lZWRlZCA8PSBtX211bHRpT3duZWRSZXF1aXJlZCk7CiAgICB9CgoKICAgCS8vIEZJRUxEUwoKICAgIHVpbnQgY29uc3RhbnQgY19tYXhPd25lcnMgPSAyNTA7CgogICAgLy8gdGhlIG51bWJlciBvZiBvd25lcnMgdGhhdCBtdXN0IGNvbmZpcm0gdGhlIHNhbWUgb3BlcmF0aW9uIGJlZm9yZSBpdCBpcyBydW4uCiAgICB1aW50IHB1YmxpYyBtX211bHRpT3duZWRSZXF1aXJlZDsKCgogICAgLy8gcG9pbnRlciB1c2VkIHRvIGZpbmQgYSBmcmVlIHNsb3QgaW4gbV9vd25lcnMKICAgIHVpbnQgcHVibGljIG1fbnVtT3duZXJzOwoKICAgIC8vIGxpc3Qgb2Ygb3duZXJzIChhZGRyZXNzZXMpLAogICAgLy8gc2xvdCAwIGlzIHVudXNlZCBzbyB0aGVyZSBhcmUgbm8gb3duZXIgd2hpY2ggaW5kZXggaXMgMC4KICAgIC8vIFRPRE8gY291bGQgd2Ugc2F2ZSBzcGFjZSBhdCB0aGUgZW5kIG9mIHRoZSBhcnJheSBmb3IgdGhlIGNvbW1vbiBjYXNlIG9mIDwxMCBvd25lcnM/IGFuZCBzaG91bGQgd2U/CiAgICBhZGRyZXNzWzI1Nl0gaW50ZXJuYWwgbV9vd25lcnM7CgogICAgLy8gaW5kZXggb24gdGhlIGxpc3Qgb2Ygb3duZXJzIHRvIGFsbG93IHJldmVyc2UgbG9va3VwOiBvd25lciBhZGRyZXNzID0+IGluZGV4IGluIG1fb3duZXJzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgaW50ZXJuYWwgbV9vd25lckluZGV4OwoKCiAgICAvLyB0aGUgb25nb2luZyBvcGVyYXRpb25zLgogICAgbWFwcGluZyhieXRlczMyID0+IE11bHRpT3duZWRPcGVyYXRpb25QZW5kaW5nU3RhdGUpIGludGVybmFsIG1fbXVsdGlPd25lZFBlbmRpbmc7CiAgICBieXRlczMyW10gaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Owp9CgoKbGlicmFyeSBGaXhlZFRpbWVCb251c2VzIHsKCiAgICBzdHJ1Y3QgQm9udXMgewogICAgICAgIHVpbnQgZW5kVGltZTsKICAgICAgICB1aW50IGJvbnVzOwogICAgfQoKICAgIHN0cnVjdCBEYXRhIHsKICAgICAgICBCb251c1tdIGJvbnVzZXM7CiAgICB9CgogICAgLy8vIEBkZXYgdmFsaWRhdGVzIGNvbnNpc3RlbmN5IG9mIGRhdGEgc3RydWN0dXJlCiAgICAvLy8gQHBhcmFtIHNlbGYgZGF0YSBzdHJ1Y3R1cmUKICAgIC8vLyBAcGFyYW0gc2hvdWxkRGVjcmVhc2UgYWRkaXRpb25hbGx5IGNoZWNrIGlmIGJvbnVzZXMgYXJlIGRlY3JlYXNpbmcgb3ZlciB0aW1lCiAgICBmdW5jdGlvbiB2YWxpZGF0ZShEYXRhIHN0b3JhZ2Ugc2VsZiwgYm9vbCBzaG91bGREZWNyZWFzZSkgY29uc3RhbnQgewogICAgICAgIHVpbnQgbGVuZ3RoID0gc2VsZi5ib251c2VzLmxlbmd0aDsKICAgICAgICByZXF1aXJlKGxlbmd0aCA+IDApOwoKICAgICAgICBCb251cyBzdG9yYWdlIGxhc3QgPSBzZWxmLmJvbnVzZXNbMF07CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgQm9udXMgc3RvcmFnZSBjdXJyZW50ID0gc2VsZi5ib251c2VzW2ldOwogICAgICAgICAgICByZXF1aXJlKGN1cnJlbnQuZW5kVGltZSA+IGxhc3QuZW5kVGltZSk7CiAgICAgICAgICAgIGlmIChzaG91bGREZWNyZWFzZSkKICAgICAgICAgICAgICAgIHJlcXVpcmUoY3VycmVudC5ib251cyA8IGxhc3QuYm9udXMpOwogICAgICAgICAgICBsYXN0ID0gY3VycmVudDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgZ2V0IGVuZGluZyB0aW1lIG9mIHRoZSBsYXN0IGJvbnVzCiAgICAvLy8gQHBhcmFtIHNlbGYgZGF0YSBzdHJ1Y3R1cmUKICAgIGZ1bmN0aW9uIGdldExhc3RUaW1lKERhdGEgc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHNlbGYuYm9udXNlc1tzZWxmLmJvbnVzZXMubGVuZ3RoIC0gMV0uZW5kVGltZTsKICAgIH0KCiAgICAvLy8gQGRldiB2YWxpZGF0ZXMgY29uc2lzdGVuY3kgb2YgZGF0YSBzdHJ1Y3R1cmUKICAgIC8vLyBAcGFyYW0gc2VsZiBkYXRhIHN0cnVjdHVyZQogICAgLy8vIEBwYXJhbSB0aW1lIHRpbWUgZm9yIHdoaWNoIGJvbnVzIG11c3QgYmUgY29tcHV0ZWQgKGFzc3VtaW5nIHRpbWUgPD0gZ2V0TGFzdFRpbWUoKSkKICAgIGZ1bmN0aW9uIGdldEJvbnVzKERhdGEgc3RvcmFnZSBzZWxmLCB1aW50IHRpbWUpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBUT0RPIGJpbmFyeSBzZWFyY2g/CiAgICAgICAgdWludCBsZW5ndGggPSBzZWxmLmJvbnVzZXMubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChzZWxmLmJvbnVzZXNbaV0uZW5kVGltZSA+PSB0aW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYm9udXNlc1tpXS5ib251czsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0KGZhbHNlKTsgIC8vIG11c3QgYmUgdW5yZWFjaGFibGUKICAgIH0KfQoKCgovKioKICogQHRpdGxlIENvbnRyYWN0IHdoaWNoIGlzIG93bmVkIGJ5IG93bmVycyBhbmQgb3BlcmF0ZWQgYnkgY29udHJvbGxlci4KICoKICogQG5vdGljZSBQcm92aWRlcyBhIHdheSB0byBzZXQgdXAgYW4gZW50aXR5ICh0eXBpY2FsbHkgb3RoZXIgY29udHJhY3QpIGVudGl0bGVkIHRvIGNvbnRyb2wgYWN0aW9ucyBvZiB0aGlzIGNvbnRyYWN0LgogKiBDb250cm9sbGVyIGlzIHNldCB1cCBieSBvd25lcnMgb3IgZHVyaW5nIGNvbnN0cnVjdGlvbi4KICoKICogQGRldiBjb250cm9sbGVyIGNoZWNrIGlzIHBlcmZvcm1lZCBieSBvbmx5Q29udHJvbGxlciBtb2RpZmllci4KICovCmNvbnRyYWN0IE11bHRpb3duZWRDb250cm9sbGVkIGlzIG11bHRpb3duZWQgewoKICAgIGV2ZW50IENvbnRyb2xsZXJTZXQoYWRkcmVzcyBjb250cm9sbGVyKTsKICAgIGV2ZW50IENvbnRyb2xsZXJSZXRpcmVkKGFkZHJlc3Mgd2FzKTsKCgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtX2NvbnRyb2xsZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2UKCiAgICBmdW5jdGlvbiBNdWx0aW93bmVkQ29udHJvbGxlZChhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9jb250cm9sbGVyKQogICAgICAgIG11bHRpb3duZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCkKICAgIHsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgICAgICBDb250cm9sbGVyU2V0KG1fY29udHJvbGxlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2Ugc2V0cyB0aGUgY29udHJvbGxlcgogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBleHRlcm5hbCBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgewogICAgICAgIG1fY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogICAgICAgIENvbnRyb2xsZXJTZXQobV9jb250cm9sbGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBhYmlsaXR5IGZvciBjb250cm9sbGVyIHRvIHN0ZXAgZG93bgogICAgZnVuY3Rpb24gZGV0YWNoQ29udHJvbGxlcigpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBhZGRyZXNzIHdhcyA9IG1fY29udHJvbGxlcjsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBhZGRyZXNzKDApOwogICAgICAgIENvbnRyb2xsZXJSZXRpcmVkKHdhcyk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGFkZHJlc3Mgb2YgZW50aXR5IGVudGl0bGVkIHRvIG1pbnQgbmV3IHRva2VucwogICAgYWRkcmVzcyBwdWJsaWMgbV9jb250cm9sbGVyOwp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBIZWxwcyBjb250cmFjdHMgZ3VhcmQgYWdhaW5zIHJlbnRyYW5jeSBhdHRhY2tzLgogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmNTg3OTA5ODk2OWFiNWM3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPs+ALmNvbT4KICogQG5vdGljZSBJZiB5b3UgbWFyayBhIGZ1bmN0aW9uIGBub25SZWVudHJhbnRgLCB5b3Ugc2hvdWxkIGFsc28KICogbWFyayBpdCBgZXh0ZXJuYWxgLgogKi8KY29udHJhY3QgUmVlbnRyYW5jeUd1YXJkIHsKCiAgLyoqCiAgICogQGRldiBXZSB1c2UgYSBzaW5nbGUgbG9jayBmb3IgdGhlIHdob2xlIGNvbnRyYWN0LgogICAqLwogIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IFByZXZlbnRzIGEgY29udHJhY3QgZnJvbSBjYWxsaW5nIGl0c2VsZiwgZGlyZWN0bHkgb3IgaW5kaXJlY3RseS4KICAgKiBAbm90aWNlIElmIHlvdSBtYXJrIGEgZnVuY3Rpb24gYG5vblJlZW50cmFudGAsIHlvdSBzaG91bGQgYWxzbwogICAqIG1hcmsgaXQgYGV4dGVybmFsYC4gQ2FsbGluZyBvbmUgbm9uUmVlbnRyYW50IGZ1bmN0aW9uIGZyb20KICAgKiBhbm90aGVyIGlzIG5vdCBzdXBwb3J0ZWQuIEluc3RlYWQsIHlvdSBjYW4gaW1wbGVtZW50IGEKICAgKiBgcHJpdmF0ZWAgZnVuY3Rpb24gZG9pbmcgdGhlIGFjdHVhbCB3b3JrLCBhbmQgYSBgZXh0ZXJuYWxgCiAgICogd3JhcHBlciBtYXJrZWQgYXMgYG5vblJlZW50cmFudGAuCiAgICovCiAgbW9kaWZpZXIgbm9uUmVlbnRyYW50KCkgewogICAgcmVxdWlyZSghcmVudHJhbmN5X2xvY2spOwogICAgcmVudHJhbmN5X2xvY2sgPSB0cnVlOwogICAgXzsKICAgIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CiAgfQoKfQoKCgovLy8gQHRpdGxlIHJlZ2lzdHJ5IG9mIGZ1bmRzIHNlbnQgYnkgaW52ZXN0b3JzCmNvbnRyYWN0IEZ1bmRzUmVnaXN0cnkgaXMgTXVsdGlvd25lZENvbnRyb2xsZWQsIFJlZW50cmFuY3lHdWFyZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBlbnVtIFN0YXRlIHsKICAgICAgICAvLyBnYXRoZXJpbmcgZnVuZHMKICAgICAgICBHQVRIRVJJTkcsCiAgICAgICAgLy8gcmV0dXJuaW5nIGZ1bmRzIHRvIGludmVzdG9ycwogICAgICAgIFJFRlVORElORywKICAgICAgICAvLyBmdW5kcyBjYW4gYmUgcHVsbGVkIGJ5IG93bmVycwogICAgICAgIFNVQ0NFRURFRAogICAgfQoKICAgIGV2ZW50IFN0YXRlQ2hhbmdlZChTdGF0ZSBfc3RhdGUpOwogICAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBFdGhlclNlbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IFJlZnVuZFNlbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKCgogICAgbW9kaWZpZXIgcmVxdWlyZXNTdGF0ZShTdGF0ZSBfc3RhdGUpIHsKICAgICAgICByZXF1aXJlKG1fc3RhdGUgPT0gX3N0YXRlKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gRnVuZHNSZWdpc3RyeShhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9jb250cm9sbGVyKQogICAgICAgIE11bHRpb3duZWRDb250cm9sbGVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQsIF9jb250cm9sbGVyKQogICAgewogICAgfQoKICAgIC8vLyBAZGV2IHBlcmZvcm1zIG9ubHkgYWxsb3dlZCBzdGF0ZSB0cmFuc2l0aW9ucwogICAgZnVuY3Rpb24gY2hhbmdlU3RhdGUoU3RhdGUgX25ld1N0YXRlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUNvbnRyb2xsZXIKICAgIHsKICAgICAgICBhc3NlcnQobV9zdGF0ZSAhPSBfbmV3U3RhdGUpOwoKICAgICAgICBpZiAoU3RhdGUuR0FUSEVSSU5HID09IG1fc3RhdGUpIHsgICBhc3NlcnQoU3RhdGUuUkVGVU5ESU5HID09IF9uZXdTdGF0ZSB8fCBTdGF0ZS5TVUNDRUVERUQgPT0gX25ld1N0YXRlKTsgfQogICAgICAgIGVsc2UgYXNzZXJ0KGZhbHNlKTsKCiAgICAgICAgbV9zdGF0ZSA9IF9uZXdTdGF0ZTsKICAgICAgICBTdGF0ZUNoYW5nZWQobV9zdGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgcmVjb3JkcyBhbiBpbnZlc3RtZW50CiAgICBmdW5jdGlvbiBpbnZlc3RlZChhZGRyZXNzIF9pbnZlc3RvcikKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5Q29udHJvbGxlcgogICAgICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuR0FUSEVSSU5HKQogICAgewogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gbXNnLnZhbHVlOwogICAgICAgIHJlcXVpcmUoMCAhPSBhbW91bnQpOwogICAgICAgIGFzc2VydChfaW52ZXN0b3IgIT0gbV9jb250cm9sbGVyKTsKCiAgICAgICAgLy8gcmVnaXN0ZXIgaW52ZXN0b3IKICAgICAgICBpZiAoMCA9PSBtX3dlaUJhbGFuY2VzW19pbnZlc3Rvcl0pCiAgICAgICAgICAgIG1faW52ZXN0b3JzLnB1c2goX2ludmVzdG9yKTsKCiAgICAgICAgLy8gcmVnaXN0ZXIgcGF5bWVudAogICAgICAgIHRvdGFsSW52ZXN0ZWQgPSB0b3RhbEludmVzdGVkLmFkZChhbW91bnQpOwogICAgICAgIG1fd2VpQmFsYW5jZXNbX2ludmVzdG9yXSA9IG1fd2VpQmFsYW5jZXNbX2ludmVzdG9yXS5hZGQoYW1vdW50KTsKCiAgICAgICAgSW52ZXN0ZWQoX2ludmVzdG9yLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFNlbmQgYHZhbHVlYCBvZiBldGhlciB0byBhZGRyZXNzIGB0b2AKICAgIGZ1bmN0aW9uIHNlbmRFdGhlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5TVUNDRUVERUQpCiAgICB7CiAgICAgICAgcmVxdWlyZSgwICE9IHRvKTsKICAgICAgICByZXF1aXJlKHZhbHVlID4gMCAmJiB0aGlzLmJhbGFuY2UgPj0gdmFsdWUpOwogICAgICAgIHRvLnRyYW5zZmVyKHZhbHVlKTsKICAgICAgICBFdGhlclNlbnQodG8sIHZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUuCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vblJlZW50cmFudAogICAgICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuUkVGVU5ESU5HKQogICAgewogICAgICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQyNTYgcGF5bWVudCA9IG1fd2VpQmFsYW5jZXNbcGF5ZWVdOwoKICAgICAgICByZXF1aXJlKHBheW1lbnQgIT0gMCk7CiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gcGF5bWVudCk7CgogICAgICAgIHRvdGFsSW52ZXN0ZWQgPSB0b3RhbEludmVzdGVkLnN1YihwYXltZW50KTsKICAgICAgICBtX3dlaUJhbGFuY2VzW3BheWVlXSA9IDA7CgogICAgICAgIHBheWVlLnRyYW5zZmVyKHBheW1lbnQpOwogICAgICAgIFJlZnVuZFNlbnQocGF5ZWUsIHBheW1lbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEludmVzdG9yc0NvdW50KCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgeyByZXR1cm4gbV9pbnZlc3RvcnMubGVuZ3RoOyB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIHRvdGFsIGFtb3VudCBvZiBpbnZlc3RtZW50cyBpbiB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsSW52ZXN0ZWQ7CgogICAgLy8vIEBub3RpY2Ugc3RhdGUgb2YgdGhlIHJlZ2lzdHJ5CiAgICBTdGF0ZSBwdWJsaWMgbV9zdGF0ZSA9IFN0YXRlLkdBVEhFUklORzsKCiAgICAvLy8gQGRldiBiYWxhbmNlcyBvZiBpbnZlc3RvcnMgaW4gd2VpCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG1fd2VpQmFsYW5jZXM7CgogICAgLy8vIEBkZXYgbGlzdCBvZiB1bmlxdWUgaW52ZXN0b3JzCiAgICBhZGRyZXNzW10gcHVibGljIG1faW52ZXN0b3JzOwp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiAKICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCgoKLy8vIEB0aXRsZSBTdGFuZGFyZFRva2VuIHdoaWNoIGNpcmN1bGF0aW9uIGNhbiBiZSBkZWxheWVkIGFuZCBzdGFydGVkIGJ5IGFub3RoZXIgY29udHJhY3QuCi8vLyBAZGV2IFRvIGJlIHVzZWQgYXMgYSBtaXhpbiBjb250cmFjdC4KLy8vIFRoZSBjb250cmFjdCBpcyBjcmVhdGVkIGluIGRpc2FibGVkIHN0YXRlOiBjaXJjdWxhdGlvbiBpcyBkaXNhYmxlZC4KY29udHJhY3QgQ2lyY3VsYXRpbmdUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICBldmVudCBDaXJjdWxhdGlvbkVuYWJsZWQoKTsKCiAgICBtb2RpZmllciByZXF1aXJlc0NpcmN1bGF0aW9uIHsKICAgICAgICByZXF1aXJlKG1faXNDaXJjdWxhdGluZyk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLy8gUFVCTElDIGludGVyZmFjZQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmVxdWlyZXNDaXJjdWxhdGlvbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXF1aXJlc0NpcmN1bGF0aW9uIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmVxdWlyZXNDaXJjdWxhdGlvbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CgoKICAgIC8vIElOVEVSTkFMIGZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIGVuYWJsZUNpcmN1bGF0aW9uKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChtX2lzQ2lyY3VsYXRpbmcpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgbV9pc0NpcmN1bGF0aW5nID0gdHJ1ZTsKICAgICAgICBDaXJjdWxhdGlvbkVuYWJsZWQoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gRklFTERTCgogICAgLy8vIEBub3RpY2UgYXJlIHRoZSBjaXJjdWxhdGlvbiBzdGFydGVkPwogICAgYm9vbCBwdWJsaWMgbV9pc0NpcmN1bGF0aW5nOwp9CgoKCi8vLyBAdGl0bGUgU3RhbmRhcmRUb2tlbiB3aGljaCBjYW4gYmUgbWludGVkIGJ5IGFub3RoZXIgY29udHJhY3QuCmNvbnRyYWN0IE1pbnRhYmxlTXVsdGlvd25lZFRva2VuIGlzIE11bHRpb3duZWRDb250cm9sbGVkLCBTdGFuZGFyZFRva2VuIHsKCiAgICAvLy8gQGRldiBwYXJhbWV0ZXJzIG9mIGFuIGV4dHJhIHRva2VuIGVtaXNzaW9uCiAgICBzdHJ1Y3QgRW1pc3Npb25JbmZvIHsKICAgICAgICAvLyB0b2tlbnMgY3JlYXRlZAogICAgICAgIHVpbnQyNTYgY3JlYXRlZDsKCiAgICAgICAgLy8gdG90YWxTdXBwbHkgYXQgdGhlIG1vbWVudCBvZiBlbWlzc2lvbiAoZXhjbHVkaW5nIGNyZWF0ZWQgdG9rZW5zKQogICAgICAgIHVpbnQyNTYgdG90YWxTdXBwbHlXYXM7CiAgICB9CgogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IEVtaXNzaW9uKHVpbnQyNTYgdG9rZW5zQ3JlYXRlZCwgdWludDI1NiB0b3RhbFN1cHBseVdhcywgdWludDI1NiB0aW1lKTsKICAgIGV2ZW50IERpdmlkZW5kKGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gTWludGFibGVNdWx0aW93bmVkVG9rZW4oYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3NpZ25hdHVyZXNSZXF1aXJlZCwgYWRkcmVzcyBfbWludGVyKQogICAgICAgIE11bHRpb3duZWRDb250cm9sbGVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQsIF9taW50ZXIpCiAgICB7CiAgICAgICAgZGl2aWRlbmRzUG9vbCA9IHRoaXM7ICAgLy8gb3IgYW55IG90aGVyIHNwZWNpYWwgdW5mb3JnZWFibGUgdmFsdWUsIGFjdHVhbGx5CgogICAgICAgIC8vIGVtaXNzaW9uICMwIGlzIGEgZHVtbXk6IGJlY2F1c2Ugb2YgZGVmYXVsdCB2YWx1ZSAwIGluIG1fbGFzdEFjY291bnRFbWlzc2lvbgogICAgICAgIG1fZW1pc3Npb25zLnB1c2goRW1pc3Npb25JbmZvKHtjcmVhdGVkOiAwLCB0b3RhbFN1cHBseVdhczogMH0pKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXF1ZXN0IGRpdmlkZW5kcyBmb3IgY3VycmVudCBhY2NvdW50LgogICAgZnVuY3Rpb24gcmVxdWVzdERpdmlkZW5kcygpIGV4dGVybmFsIHsKICAgICAgICBwYXlEaXZpZGVuZHNUbyhtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBob29rIG9uIHN0YW5kYXJkIEVSQzIwI3RyYW5zZmVyIHRvIHBheSBkaXZpZGVuZHMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHBheURpdmlkZW5kc1RvKG1zZy5zZW5kZXIpOwogICAgICAgIHBheURpdmlkZW5kc1RvKF90byk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBob29rIG9uIHN0YW5kYXJkIEVSQzIwI3RyYW5zZmVyRnJvbSB0byBwYXkgZGl2aWRlbmRzCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcGF5RGl2aWRlbmRzVG8oX2Zyb20pOwogICAgICAgIHBheURpdmlkZW5kc1RvKF90byk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vIERpc2FibGVkOiB0aGlzIGNvdWxkIGJlIHVuZGVzaXJhYmxlIGJlY2F1c2Ugc3VtIG9mIChiYWxhbmNlT2YoKSBmb3IgZWFjaCB0b2tlbiBvd25lcikgIT0gdG90YWxTdXBwbHkKICAgIC8vIChidXQ6IHN1bSBvZiAoYmFsYW5jZXNbb3duZXJdIGZvciBlYWNoIHRva2VuIG93bmVyKSA9PSB0b3RhbFN1cHBseSEpLgogICAgLy8KICAgIC8vIEBub3RpY2UgaG9vayBvbiBzdGFuZGFyZCBFUkMyMCNiYWxhbmNlT2YgdG8gdGFrZSBkaXZpZGVuZHMgaW50byBjb25zaWRlcmF0aW9uCiAgICAvLyBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vICAgICB2YXIgKGhhc05ld0RpdmlkZW5kcywgZGl2aWRlbmRzKSA9IGNhbGN1bGF0ZURpdmlkZW5kc0Zvcihfb3duZXIpOwogICAgLy8gICAgIHJldHVybiBoYXNOZXdEaXZpZGVuZHMgPyBzdXBlci5iYWxhbmNlT2YoX293bmVyKS5hZGQoZGl2aWRlbmRzKSA6IHN1cGVyLmJhbGFuY2VPZihfb3duZXIpOwogICAgLy8gfQoKCiAgICAvLy8gQGRldiBtaW50cyBuZXcgdG9rZW5zCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICByZXF1aXJlKG1fZXh0ZXJuYWxNaW50aW5nRW5hYmxlZCk7CiAgICAgICAgcGF5RGl2aWRlbmRzVG8oX3RvKTsKICAgICAgICBtaW50SW50ZXJuYWwoX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBkaXNhYmxlcyBtaW50KCksIGlycmV2ZXJzaWJsZSEKICAgIGZ1bmN0aW9uIGRpc2FibGVNaW50aW5nKCkgZXh0ZXJuYWwgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlcXVpcmUobV9leHRlcm5hbE1pbnRpbmdFbmFibGVkKTsKICAgICAgICBtX2V4dGVybmFsTWludGluZ0VuYWJsZWQgPSBmYWxzZTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwgZnVuY3Rpb25zCgogICAgLyoqCiAgICAgKiBAbm90aWNlIFN0YXJ0cyBuZXcgdG9rZW4gZW1pc3Npb24KICAgICAqIEBwYXJhbSBfdG9rZW5zQ3JlYXRlZCBBbW91bnQgb2YgdG9rZW5zIHRvIGNyZWF0ZQogICAgICogQGRldiBEaXZpZGVuZHMgYXJlIG5vdCBkaXN0cmlidXRlZCBpbW1lZGlhdGVseSBhcyBpdCBjb3VsZCByZXF1aXJlIGJpbGxpb25zIG9mIGdhcywKICAgICAqIGluc3RlYWQgdGhleSBhcmUgYHB1bGxlZGAgYnkgYSBob2xkZXIgZnJvbSBkaXZpZGVuZHMgcG9vbCBhY2NvdW50IGJlZm9yZSBhbnkgdXBkYXRlIHRvIHRoZSBob2xkZXIgYWNjb3VudCBvY2N1cnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVtaXNzaW9uSW50ZXJuYWwodWludDI1NiBfdG9rZW5zQ3JlYXRlZCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoMCAhPSBfdG9rZW5zQ3JlYXRlZCk7CiAgICAgICAgcmVxdWlyZShfdG9rZW5zQ3JlYXRlZCA8IHRvdGFsU3VwcGx5IC8gMik7ICAvLyBvdGhlcndpc2UgaXQgbG9va3MgbGlrZSBhbiBlcnJvcgoKICAgICAgICB1aW50MjU2IHRvdGFsU3VwcGx5V2FzID0gdG90YWxTdXBwbHk7CgogICAgICAgIG1fZW1pc3Npb25zLnB1c2goRW1pc3Npb25JbmZvKHtjcmVhdGVkOiBfdG9rZW5zQ3JlYXRlZCwgdG90YWxTdXBwbHlXYXM6IHRvdGFsU3VwcGx5V2FzfSkpOwogICAgICAgIG1pbnRJbnRlcm5hbChkaXZpZGVuZHNQb29sLCBfdG9rZW5zQ3JlYXRlZCk7CgogICAgICAgIEVtaXNzaW9uKF90b2tlbnNDcmVhdGVkLCB0b3RhbFN1cHBseVdhcywgbm93KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50SW50ZXJuYWwoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgewogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgYWRkcyBkaXZpZGVuZHMgdG8gdGhlIGFjY291bnQgX3RvCiAgICBmdW5jdGlvbiBwYXlEaXZpZGVuZHNUbyhhZGRyZXNzIF90bykgaW50ZXJuYWwgewogICAgICAgIHZhciAoaGFzTmV3RGl2aWRlbmRzLCBkaXZpZGVuZHMpID0gY2FsY3VsYXRlRGl2aWRlbmRzRm9yKF90byk7CiAgICAgICAgaWYgKCFoYXNOZXdEaXZpZGVuZHMpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKDAgIT0gZGl2aWRlbmRzKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW2RpdmlkZW5kc1Bvb2xdID0gYmFsYW5jZXNbZGl2aWRlbmRzUG9vbF0uc3ViKGRpdmlkZW5kcyk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChkaXZpZGVuZHMpOwogICAgICAgIH0KICAgICAgICBtX2xhc3RBY2NvdW50RW1pc3Npb25bX3RvXSA9IGdldExhc3RFbWlzc2lvbk51bSgpOwogICAgfQoKICAgIC8vLyBAZGV2IGNhbGN1bGF0ZXMgZGl2aWRlbmRzIGZvciB0aGUgYWNjb3VudCBfZm9yCiAgICAvLy8gQHJldHVybiAodHJ1ZSBpZiBzdGF0ZSBoYXMgdG8gYmUgdXBkYXRlZCwgZGl2aWRlbmQgYW1vdW50IChjb3VsZCBiZSAwISkpCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVEaXZpZGVuZHNGb3IoYWRkcmVzcyBfZm9yKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sIGhhc05ld0RpdmlkZW5kcywgdWludCBkaXZpZGVuZHMpIHsKICAgICAgICBhc3NlcnQoX2ZvciAhPSBkaXZpZGVuZHNQb29sKTsgIC8vIG5vIGRpdmlkZW5kcyBmb3IgdGhlIHBvb2whCgogICAgICAgIHVpbnQyNTYgbGFzdEVtaXNzaW9uTnVtID0gZ2V0TGFzdEVtaXNzaW9uTnVtKCk7CiAgICAgICAgdWludDI1NiBsYXN0QWNjb3VudEVtaXNzaW9uTnVtID0gbV9sYXN0QWNjb3VudEVtaXNzaW9uW19mb3JdOwogICAgICAgIGFzc2VydChsYXN0QWNjb3VudEVtaXNzaW9uTnVtIDw9IGxhc3RFbWlzc2lvbk51bSk7CiAgICAgICAgaWYgKGxhc3RBY2NvdW50RW1pc3Npb25OdW0gPT0gbGFzdEVtaXNzaW9uTnVtKQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgdWludDI1NiBpbml0aWFsQmFsYW5jZSA9IGJhbGFuY2VzW19mb3JdOyAgICAvLyBiZXdhcmUgb2YgcmVjdXJzaW9uIQogICAgICAgIGlmICgwID09IGluaXRpYWxCYWxhbmNlKQogICAgICAgICAgICByZXR1cm4gKHRydWUsIDApOwoKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBpbml0aWFsQmFsYW5jZTsKICAgICAgICBmb3IgKHVpbnQyNTYgZW1pc3Npb25Ub1Byb2Nlc3MgPSBsYXN0QWNjb3VudEVtaXNzaW9uTnVtICsgMTsgZW1pc3Npb25Ub1Byb2Nlc3MgPD0gbGFzdEVtaXNzaW9uTnVtOyBlbWlzc2lvblRvUHJvY2VzcysrKSB7CiAgICAgICAgICAgIEVtaXNzaW9uSW5mbyBzdG9yYWdlIGVtaXNzaW9uID0gbV9lbWlzc2lvbnNbZW1pc3Npb25Ub1Byb2Nlc3NdOwogICAgICAgICAgICBhc3NlcnQoMCAhPSBlbWlzc2lvbi5jcmVhdGVkICYmIDAgIT0gZW1pc3Npb24udG90YWxTdXBwbHlXYXMpOwoKICAgICAgICAgICAgdWludDI1NiBkaXZpZGVuZCA9IGJhbGFuY2UubXVsKGVtaXNzaW9uLmNyZWF0ZWQpLmRpdihlbWlzc2lvbi50b3RhbFN1cHBseVdhcyk7CiAgICAgICAgICAgIERpdmlkZW5kKF9mb3IsIGRpdmlkZW5kKTsKCiAgICAgICAgICAgIGJhbGFuY2UgPSBiYWxhbmNlLmFkZChkaXZpZGVuZCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHRydWUsIGJhbGFuY2Uuc3ViKGluaXRpYWxCYWxhbmNlKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGFzdEVtaXNzaW9uTnVtKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG1fZW1pc3Npb25zLmxlbmd0aCAtIDE7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGlmIHRoaXMgdHJ1ZSB0aGVuIHRva2VuIGlzIHN0aWxsIGV4dGVybmFsbHkgbWludGFibGUgKGJ1dCB0aGlzIGZsYWcgZG9lcyd0IGFmZmVjdCBlbWlzc2lvbnMhKQogICAgYm9vbCBwdWJsaWMgbV9leHRlcm5hbE1pbnRpbmdFbmFibGVkID0gdHJ1ZTsKCiAgICAvLy8gQGRldiBpbnRlcm5hbCBhZGRyZXNzIG9mIGRpdmlkZW5kcyBpbiBiYWxhbmNlcyBtYXBwaW5nLgogICAgYWRkcmVzcyBkaXZpZGVuZHNQb29sOwoKICAgIC8vLyBAbm90aWNlIHJlY29yZCBvZiBpc3N1ZWQgZGl2aWRlbmQgZW1pc3Npb25zCiAgICBFbWlzc2lvbkluZm9bXSBwdWJsaWMgbV9lbWlzc2lvbnM7CgogICAgLy8vIEBkZXYgZm9yIGVhY2ggdG9rZW4gaG9sZGVyOiBsYXN0IGVtaXNzaW9uIChpbmRleCBpbiBtX2VtaXNzaW9ucykgd2hpY2ggd2FzIHByb2Nlc3NlZCBmb3IgdGhpcyBob2xkZXIKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBtX2xhc3RBY2NvdW50RW1pc3Npb247Cn0KCgovLy8gQHRpdGxlIFN0b3JpcWEgY29pbiBjb250cmFjdApjb250cmFjdCBTVFFUb2tlbiBpcyBDaXJjdWxhdGluZ1Rva2VuLCBNaW50YWJsZU11bHRpb3duZWRUb2tlbiB7CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2UKCiAgICBmdW5jdGlvbiBTVFFUb2tlbihhZGRyZXNzW10gX293bmVycykKICAgICAgICBNaW50YWJsZU11bHRpb3duZWRUb2tlbihfb3duZXJzLCAyLCAvKiBtaW50ZXI6ICovIGFkZHJlc3MoMCkpCiAgICB7CiAgICAgICAgcmVxdWlyZSgzID09IF9vd25lcnMubGVuZ3RoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgdG9rZW4gdHJhbnNmZXJzCiAgICBmdW5jdGlvbiBzdGFydENpcmN1bGF0aW9uKCkgZXh0ZXJuYWwgb25seUNvbnRyb2xsZXIgewogICAgICAgIGFzc2VydChlbmFibGVDaXJjdWxhdGlvbigpKTsgICAgLy8gbXVzdCBiZSBjYWxsZWQgb25jZQogICAgfQoKICAgIC8vLyBAbm90aWNlIFN0YXJ0cyBuZXcgdG9rZW4gZW1pc3Npb24KICAgIC8vLyBAcGFyYW0gX3Rva2Vuc0NyZWF0ZWRJblNUUSBBbW91bnQgb2YgU1RRIChub3QgU1RRLXdlaSEpIHRvIGNyZWF0ZSwgbGlrZSAzMCAwMDAgb3Igc28KICAgIGZ1bmN0aW9uIGVtaXNzaW9uKHVpbnQyNTYgX3Rva2Vuc0NyZWF0ZWRJblNUUSkgZXh0ZXJuYWwgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIHsKICAgICAgICBlbWlzc2lvbkludGVybmFsKF90b2tlbnNDcmVhdGVkSW5TVFEubXVsKHVpbnQyNTYoMTApICoqIHVpbnQyNTYoZGVjaW1hbHMpKSk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICdTdG9yaXFhIFRva2VuJzsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ1NUUSc7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKfQoKCi8qKgogKiBAdGl0bGUgTWF0aAogKiBAZGV2IEFzc29ydGVkIG1hdGggb3BlcmF0aW9ucwogKi8KCmxpYnJhcnkgTWF0aCB7CiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCgoKLy8vIEB0aXRsZSBTdG9yaXFhIElDTyBjb250cmFjdApjb250cmFjdCBTVFFDcm93ZHNhbGUgaXMgbXVsdGlvd25lZCwgUmVlbnRyYW5jeUd1YXJkIHsKICAgIHVzaW5nIE1hdGggZm9yIHVpbnQyNTY7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIHVzaW5nIEZpeGVkVGltZUJvbnVzZXMgZm9yIEZpeGVkVGltZUJvbnVzZXMuRGF0YTsKCiAgICB1aW50IGludGVybmFsIGNvbnN0YW50IE1TSzJVVENfREVMVEEgPSAzNjAwICogMzsKCiAgICBlbnVtIEljb1N0YXRlIHsgSU5JVCwgSUNPLCBQQVVTRUQsIEZBSUxFRCwgU1VDQ0VFREVEIH0KCgogICAgZXZlbnQgU3RhdGVDaGFuZ2VkKEljb1N0YXRlIF9zdGF0ZSk7CiAgICBldmVudCBGdW5kVHJhbnNmZXIoYWRkcmVzcyBiYWNrZXIsIHVpbnQgYW1vdW50LCBib29sIGlzQ29udHJpYnV0aW9uKTsKCgogICAgbW9kaWZpZXIgcmVxdWlyZXNTdGF0ZShJY29TdGF0ZSBfc3RhdGUpIHsKICAgICAgICByZXF1aXJlKG1fc3RhdGUgPT0gX3N0YXRlKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IHRyaWdnZXJzIHNvbWUgc3RhdGUgY2hhbmdlcyBiYXNlZCBvbiBjdXJyZW50IHRpbWUKICAgIC8vLyBub3RlOiBmdW5jdGlvbiBib2R5IGNvdWxkIGJlIHNraXBwZWQhCiAgICBtb2RpZmllciB0aW1lZFN0YXRlQ2hhbmdlKCkgewogICAgICAgIGlmIChJY29TdGF0ZS5JTklUID09IG1fc3RhdGUgJiYgZ2V0Q3VycmVudFRpbWUoKSA+PSBnZXRTdGFydFRpbWUoKSkKICAgICAgICAgICAgY2hhbmdlU3RhdGUoSWNvU3RhdGUuSUNPKTsKCiAgICAgICAgaWYgKEljb1N0YXRlLklDTyA9PSBtX3N0YXRlICYmIGdldEN1cnJlbnRUaW1lKCkgPiBnZXRFbmRUaW1lKCkpIHsKICAgICAgICAgICAgZmluaXNoSUNPKCk7CgogICAgICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgICAgICAgICAgLy8gbm90ZSB0aGF0IGV4ZWN1dGlvbiBvZiBmdXJ0aGVyIChidXQgbm90IHByZWNlZGluZyEpIG1vZGlmaWVycyBhbmQgZnVuY3Rpb25zIGVuZHMgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IGF1dG9tYXRpYyBjaGVjayBmb3IgdW5hY2NvdW50ZWQgd2l0aGRyYXdhbHMKICAgIG1vZGlmaWVyIGZ1bmRzQ2hlY2tlcigpIHsKICAgICAgICBhc3NlcnQobV9zdGF0ZSA9PSBJY29TdGF0ZS5JQ08pOwoKICAgICAgICB1aW50IGF0VGhlQmVnaW5uaW5nID0gbV9mdW5kcy5iYWxhbmNlOwogICAgICAgIGlmIChhdFRoZUJlZ2lubmluZyA8IG1fbGFzdEZ1bmRzQW1vdW50KSB7CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKEljb1N0YXRlLlBBVVNFRCk7CiAgICAgICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOyAvLyB3ZSBjYW50IHRocm93IChoYXZlIHRvIHNhdmUgc3RhdGUpLCBzbyByZWZ1bmRpbmcgdGhpcyB3YXkKICAgICAgICAgICAgLy8gbm90ZSB0aGF0IGV4ZWN1dGlvbiBvZiBmdXJ0aGVyIChidXQgbm90IHByZWNlZGluZyEpIG1vZGlmaWVycyBhbmQgZnVuY3Rpb25zIGVuZHMgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF87CgogICAgICAgICAgICBpZiAobV9mdW5kcy5iYWxhbmNlIDwgYXRUaGVCZWdpbm5pbmcpIHsKICAgICAgICAgICAgICAgIGNoYW5nZVN0YXRlKEljb1N0YXRlLlBBVVNFRCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtX2xhc3RGdW5kc0Ftb3VudCA9IG1fZnVuZHMuYmFsYW5jZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLy8gUFVCTElDIGludGVyZmFjZQoKICAgIGZ1bmN0aW9uIFNUUUNyb3dkc2FsZShhZGRyZXNzW10gX293bmVycywgYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2Z1bmRzKQogICAgICAgIG11bHRpb3duZWQoX293bmVycywgMikKICAgIHsKICAgICAgICByZXF1aXJlKDMgPT0gX293bmVycy5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcygwKSAhPSBhZGRyZXNzKF90b2tlbikgJiYgYWRkcmVzcygwKSAhPSBhZGRyZXNzKF9mdW5kcykpOwoKICAgICAgICBtX3Rva2VuID0gU1RRVG9rZW4oX3Rva2VuKTsKICAgICAgICBtX2Z1bmRzID0gRnVuZHNSZWdpc3RyeShfZnVuZHMpOwoKICAgICAgICBtX2JvbnVzZXMuYm9udXNlcy5wdXNoKEZpeGVkVGltZUJvbnVzZXMuQm9udXMoe2VuZFRpbWU6IDE1MDU2ODE5OTkgKyBNU0syVVRDX0RFTFRBLCBib251czogNTB9KSk7CiAgICAgICAgbV9ib251c2VzLmJvbnVzZXMucHVzaChGaXhlZFRpbWVCb251c2VzLkJvbnVzKHtlbmRUaW1lOiAxNTA1NzY4Mzk5ICsgTVNLMlVUQ19ERUxUQSwgYm9udXM6IDI1fSkpOwogICAgICAgIG1fYm9udXNlcy5ib251c2VzLnB1c2goRml4ZWRUaW1lQm9udXNlcy5Cb251cyh7ZW5kVGltZTogMTUwNTk0MTE5OSArIE1TSzJVVENfREVMVEEsIGJvbnVzOiAyMH0pKTsKICAgICAgICBtX2JvbnVzZXMuYm9udXNlcy5wdXNoKEZpeGVkVGltZUJvbnVzZXMuQm9udXMoe2VuZFRpbWU6IDE1MDYyMDAzOTkgKyBNU0syVVRDX0RFTFRBLCBib251czogMTV9KSk7CiAgICAgICAgbV9ib251c2VzLmJvbnVzZXMucHVzaChGaXhlZFRpbWVCb251c2VzLkJvbnVzKHtlbmRUaW1lOiAxNTA2NTQ1OTk5ICsgTVNLMlVUQ19ERUxUQSwgYm9udXM6IDEwfSkpOwogICAgICAgIG1fYm9udXNlcy5ib251c2VzLnB1c2goRml4ZWRUaW1lQm9udXNlcy5Cb251cyh7ZW5kVGltZTogMTUwNjg5MTU5OSArIE1TSzJVVENfREVMVEEsIGJvbnVzOiA1fSkpOwogICAgICAgIG1fYm9udXNlcy5ib251c2VzLnB1c2goRml4ZWRUaW1lQm9udXNlcy5Cb251cyh7ZW5kVGltZTogMTUwODM2MDM5OSArIE1TSzJVVENfREVMVEEsIGJvbnVzOiAwfSkpOwogICAgICAgIG1fYm9udXNlcy52YWxpZGF0ZSh0cnVlKTsKICAgIH0KCgogICAgLy8gUFVCTElDIGludGVyZmFjZTogcGF5bWVudHMKCiAgICAvLyBmYWxsYmFjayBmdW5jdGlvbiBhcyBhIHNob3J0Y3V0CiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIGJ1eSgpOyAgLy8gb25seSBpbnRlcm5hbCBjYWxsIGhlcmUhCiAgICB9CgogICAgLy8vIEBub3RpY2UgSUNPIHBhcnRpY2lwYXRpb24KICAgIC8vLyBAcmV0dXJuIG51bWJlciBvZiBTVFEgdG9rZW5zIGJvdWdodCAod2l0aCBhbGwgZGVjaW1hbCBzeW1ib2xzKQogICAgZnVuY3Rpb24gYnV5KCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgbm9uUmVlbnRyYW50CiAgICAgICAgdGltZWRTdGF0ZUNoYW5nZQogICAgICAgIHJlcXVpcmVzU3RhdGUoSWNvU3RhdGUuSUNPKQogICAgICAgIGZ1bmRzQ2hlY2tlcgogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgYWRkcmVzcyBpbnZlc3RvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgdWludDI1NiBwYXltZW50ID0gbXNnLnZhbHVlOwogICAgICAgIHJlcXVpcmUocGF5bWVudCA+PSBjX01pbkludmVzdG1lbnQpOwoKICAgICAgICB1aW50IHN0YXJ0aW5nSW52YXJpYW50ID0gdGhpcy5iYWxhbmNlLmFkZChtX2Z1bmRzLmJhbGFuY2UpOwoKICAgICAgICAvLyBjaGVja2luZyBmb3IgbWF4IGNhcAogICAgICAgIHVpbnQgZnVuZHNBbGxvd2VkID0gZ2V0TWF4aW11bUZ1bmRzKCkuc3ViKG1fZnVuZHMudG90YWxJbnZlc3RlZCgpKTsKICAgICAgICBhc3NlcnQoMCAhPSBmdW5kc0FsbG93ZWQpOyAgLy8gaW4gdGhpcyBjYXNlIHN0YXRlIG11c3Qgbm90IGJlIEljb1N0YXRlLklDTwogICAgICAgIHBheW1lbnQgPSBmdW5kc0FsbG93ZWQubWluMjU2KHBheW1lbnQpOwogICAgICAgIHVpbnQyNTYgY2hhbmdlID0gbXNnLnZhbHVlLnN1YihwYXltZW50KTsKCiAgICAgICAgLy8gaXNzdWUgdG9rZW5zCiAgICAgICAgdWludCBzdHEgPSBjYWxjU1RRQW1vdW50KHBheW1lbnQpOwogICAgICAgIG1fdG9rZW4ubWludChpbnZlc3Rvciwgc3RxKTsKCiAgICAgICAgLy8gcmVjb3JkIHBheW1lbnQKICAgICAgICBtX2Z1bmRzLmludmVzdGVkLnZhbHVlKHBheW1lbnQpKGludmVzdG9yKTsKICAgICAgICBGdW5kVHJhbnNmZXIoaW52ZXN0b3IsIHBheW1lbnQsIHRydWUpOwoKICAgICAgICAvLyBjaGVjayBpZiBJQ08gbXVzdCBiZSBjbG9zZWQgZWFybHkKICAgICAgICBpZiAoY2hhbmdlID4gMCkKICAgICAgICB7CiAgICAgICAgICAgIGFzc2VydChnZXRNYXhpbXVtRnVuZHMoKSA9PSBtX2Z1bmRzLnRvdGFsSW52ZXN0ZWQoKSk7CiAgICAgICAgICAgIGZpbmlzaElDTygpOwoKICAgICAgICAgICAgLy8gc2VuZCBjaGFuZ2UKICAgICAgICAgICAgaW52ZXN0b3IudHJhbnNmZXIoY2hhbmdlKTsKICAgICAgICAgICAgYXNzZXJ0KHN0YXJ0aW5nSW52YXJpYW50ID09IHRoaXMuYmFsYW5jZS5hZGQobV9mdW5kcy5iYWxhbmNlKS5hZGQoY2hhbmdlKSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICAgICAgYXNzZXJ0KHN0YXJ0aW5nSW52YXJpYW50ID09IHRoaXMuYmFsYW5jZS5hZGQobV9mdW5kcy5iYWxhbmNlKSk7CgogICAgICAgIHJldHVybiBzdHE7CiAgICB9CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2U6IG93bmVyczogbWFpbnRlbmFuY2UKCiAgICAvLy8gQG5vdGljZSBwYXVzZXMgSUNPCiAgICBmdW5jdGlvbiBwYXVzZSgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB0aW1lZFN0YXRlQ2hhbmdlCiAgICAgICAgcmVxdWlyZXNTdGF0ZShJY29TdGF0ZS5JQ08pCiAgICAgICAgb25seW93bmVyCiAgICB7CiAgICAgICAgY2hhbmdlU3RhdGUoSWNvU3RhdGUuUEFVU0VEKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZXN1bWUgcGF1c2VkIElDTwogICAgZnVuY3Rpb24gdW5wYXVzZSgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB0aW1lZFN0YXRlQ2hhbmdlCiAgICAgICAgcmVxdWlyZXNTdGF0ZShJY29TdGF0ZS5QQVVTRUQpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgY2hhbmdlU3RhdGUoSWNvU3RhdGUuSUNPKTsKICAgICAgICBjaGVja1RpbWUoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjb25zaWRlciBwYXVzZWQgSUNPIGFzIGZhaWxlZAogICAgZnVuY3Rpb24gZmFpbCgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB0aW1lZFN0YXRlQ2hhbmdlCiAgICAgICAgcmVxdWlyZXNTdGF0ZShJY29TdGF0ZS5QQVVTRUQpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgY2hhbmdlU3RhdGUoSWNvU3RhdGUuRkFJTEVEKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBJbiBjYXNlIHdlIG5lZWQgdG8gYXR0YWNoIHRvIGV4aXN0ZW50IHRva2VuCiAgICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIF90b2tlbikKICAgICAgICBleHRlcm5hbAogICAgICAgIHRpbWVkU3RhdGVDaGFuZ2UKICAgICAgICByZXF1aXJlc1N0YXRlKEljb1N0YXRlLlBBVVNFRCkKICAgICAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX3Rva2VuKTsKICAgICAgICBtX3Rva2VuID0gU1RRVG9rZW4oX3Rva2VuKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBJbiBjYXNlIHdlIG5lZWQgdG8gYXR0YWNoIHRvIGV4aXN0ZW50IGZ1bmRzCiAgICBmdW5jdGlvbiBzZXRGdW5kc1JlZ2lzdHJ5KGFkZHJlc3MgX2Z1bmRzKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdGltZWRTdGF0ZUNoYW5nZQogICAgICAgIHJlcXVpcmVzU3RhdGUoSWNvU3RhdGUuUEFVU0VEKQogICAgICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIHJlcXVpcmUoYWRkcmVzcygwKSAhPSBfZnVuZHMpOwogICAgICAgIG1fZnVuZHMgPSBGdW5kc1JlZ2lzdHJ5KF9mdW5kcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgZXhwbGljaXQgdHJpZ2dlciBmb3IgdGltZWQgc3RhdGUgY2hhbmdlcwogICAgZnVuY3Rpb24gY2hlY2tUaW1lKCkKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFN0YXRlQ2hhbmdlCiAgICAgICAgb25seW93bmVyCiAgICB7CiAgICB9CgoKICAgIC8vIElOVEVSTkFMIGZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIGZpbmlzaElDTygpIHByaXZhdGUgewogICAgICAgIGlmIChtX2Z1bmRzLnRvdGFsSW52ZXN0ZWQoKSA8IGdldE1pbkZ1bmRzKCkpCiAgICAgICAgICAgIGNoYW5nZVN0YXRlKEljb1N0YXRlLkZBSUxFRCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjaGFuZ2VTdGF0ZShJY29TdGF0ZS5TVUNDRUVERUQpOwogICAgfQoKICAgIC8vLyBAZGV2IHBlcmZvcm1zIG9ubHkgYWxsb3dlZCBzdGF0ZSB0cmFuc2l0aW9ucwogICAgZnVuY3Rpb24gY2hhbmdlU3RhdGUoSWNvU3RhdGUgX25ld1N0YXRlKSBwcml2YXRlIHsKICAgICAgICBhc3NlcnQobV9zdGF0ZSAhPSBfbmV3U3RhdGUpOwoKICAgICAgICBpZiAoSWNvU3RhdGUuSU5JVCA9PSBtX3N0YXRlKSB7ICAgICAgICBhc3NlcnQoSWNvU3RhdGUuSUNPID09IF9uZXdTdGF0ZSk7IH0KICAgICAgICBlbHNlIGlmIChJY29TdGF0ZS5JQ08gPT0gbV9zdGF0ZSkgeyAgICBhc3NlcnQoSWNvU3RhdGUuUEFVU0VEID09IF9uZXdTdGF0ZSB8fCBJY29TdGF0ZS5GQUlMRUQgPT0gX25ld1N0YXRlIHx8IEljb1N0YXRlLlNVQ0NFRURFRCA9PSBfbmV3U3RhdGUpOyB9CiAgICAgICAgZWxzZSBpZiAoSWNvU3RhdGUuUEFVU0VEID09IG1fc3RhdGUpIHsgYXNzZXJ0KEljb1N0YXRlLklDTyA9PSBfbmV3U3RhdGUgfHwgSWNvU3RhdGUuRkFJTEVEID09IF9uZXdTdGF0ZSk7IH0KICAgICAgICBlbHNlIGFzc2VydChmYWxzZSk7CgogICAgICAgIG1fc3RhdGUgPSBfbmV3U3RhdGU7CiAgICAgICAgU3RhdGVDaGFuZ2VkKG1fc3RhdGUpOwoKICAgICAgICAvLyB0aGlzIHNob3VsZCBiZSB0aWdodGx5IGxpbmtlZAogICAgICAgIGlmIChJY29TdGF0ZS5TVUNDRUVERUQgPT0gbV9zdGF0ZSkgewogICAgICAgICAgICBvblN1Y2Nlc3MoKTsKICAgICAgICB9IGVsc2UgaWYgKEljb1N0YXRlLkZBSUxFRCA9PSBtX3N0YXRlKSB7CiAgICAgICAgICAgIG9uRmFpbHVyZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvblN1Y2Nlc3MoKSBwcml2YXRlIHsKICAgICAgICAvLyBtaW50IHRva2VucyBmb3Igb3duZXJzCiAgICAgICAgdWludCB0b2tlbnNQZXJPd25lciA9IG1fdG9rZW4udG90YWxTdXBwbHkoKS5tdWwoNCkuZGl2KG1fbnVtT3duZXJzKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtX251bU93bmVyczsgaSsrKQogICAgICAgICAgICBtX3Rva2VuLm1pbnQoZ2V0T3duZXIoaSksIHRva2Vuc1Blck93bmVyKTsKCiAgICAgICAgbV9mdW5kcy5jaGFuZ2VTdGF0ZShGdW5kc1JlZ2lzdHJ5LlN0YXRlLlNVQ0NFRURFRCk7CiAgICAgICAgbV9mdW5kcy5kZXRhY2hDb250cm9sbGVyKCk7CgogICAgICAgIG1fdG9rZW4uZGlzYWJsZU1pbnRpbmcoKTsKICAgICAgICBtX3Rva2VuLnN0YXJ0Q2lyY3VsYXRpb24oKTsKICAgICAgICBtX3Rva2VuLmRldGFjaENvbnRyb2xsZXIoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbkZhaWx1cmUoKSBwcml2YXRlIHsKICAgICAgICBtX2Z1bmRzLmNoYW5nZVN0YXRlKEZ1bmRzUmVnaXN0cnkuU3RhdGUuUkVGVU5ESU5HKTsKICAgICAgICBtX2Z1bmRzLmRldGFjaENvbnRyb2xsZXIoKTsKICAgIH0KCgogICAgLy8vIEBkZXYgY2FsY3VsYXRlcyBhbW91bnQgb2YgU1RRIHRvIHdoaWNoIHBheWVyIG9mIF93ZWkgaXMgZW50aXRsZWQKICAgIGZ1bmN0aW9uIGNhbGNTVFFBbW91bnQodWludCBfd2VpKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHN0cSA9IF93ZWkubXVsKGNfU1RRcGVyRVRIKTsKCiAgICAgICAgLy8gYXBwbHkgYm9udXMKICAgICAgICBzdHEgPSBzdHEubXVsKG1fYm9udXNlcy5nZXRCb251cyhnZXRDdXJyZW50VGltZSgpKS5hZGQoMTAwKSkuZGl2KDEwMCk7CgogICAgICAgIHJldHVybiBzdHE7CiAgICB9CgogICAgLy8vIEBkZXYgc3RhcnQgdGltZSBvZiB0aGUgSUNPLCBpbmNsdXNpdmUKICAgIGZ1bmN0aW9uIGdldFN0YXJ0VGltZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBjX3N0YXJ0VGltZTsKICAgIH0KCiAgICAvLy8gQGRldiBlbmQgdGltZSBvZiB0aGUgSUNPLCBpbmNsdXNpdmUKICAgIGZ1bmN0aW9uIGdldEVuZFRpbWUoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbV9ib251c2VzLmdldExhc3RUaW1lKCk7CiAgICB9CgogICAgLy8vIEBkZXYgdG8gYmUgb3ZlcnJpZGRlbiBpbiB0ZXN0cwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFRpbWUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLy8gQGRldiB0byBiZSBvdmVycmlkZGVuIGluIHRlc3RzCiAgICBmdW5jdGlvbiBnZXRNaW5GdW5kcygpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gY19NaW5GdW5kczsKICAgIH0KCiAgICAvLy8gQGRldiB0byBiZSBvdmVycmlkZGVuIGluIHRlc3RzCiAgICBmdW5jdGlvbiBnZXRNYXhpbXVtRnVuZHMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGNfTWF4aW11bUZ1bmRzOwogICAgfQoKCiAgICAvLyBGSUVMRFMKCiAgICAvLy8gQG5vdGljZSBzdGFydGluZyBleGNoYW5nZSByYXRlIG9mIFNUUQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgY19TVFFwZXJFVEggPSAxMDA7CgogICAgLy8vIEBub3RpY2UgbWluaW11bSBpbnZlc3RtZW50CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBjX01pbkludmVzdG1lbnQgPSAxMCBmaW5uZXk7CgogICAgLy8vIEBub3RpY2UgbWluaW11bSBpbnZlc3RtZW50cyB0byBjb25zaWRlciBJQ08gYXMgYSBzdWNjZXNzCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBjX01pbkZ1bmRzID0gNTAwMCBldGhlcjsKCiAgICAvLy8gQG5vdGljZSBtYXhpbXVtIGludmVzdG1lbnRzIHRvIGJlIGFjY2VwdGVkIGR1cmluZyBJQ08KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGNfTWF4aW11bUZ1bmRzID0gNTAwMDAwIGV0aGVyOwoKICAgIC8vLyBAbm90aWNlIHN0YXJ0IHRpbWUgb2YgdGhlIElDTwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgY19zdGFydFRpbWUgPSAxNTA1NTQxNjAwOwoKICAgIC8vLyBAbm90aWNlIHRpbWVkIGJvbnVzZXMKICAgIEZpeGVkVGltZUJvbnVzZXMuRGF0YSBtX2JvbnVzZXM7CgogICAgLy8vIEBkZXYgc3RhdGUgb2YgdGhlIElDTwogICAgSWNvU3RhdGUgcHVibGljIG1fc3RhdGUgPSBJY29TdGF0ZS5JTklUOwoKICAgIC8vLyBAZGV2IGNvbnRyYWN0IHJlc3BvbnNpYmxlIGZvciB0b2tlbiBhY2NvdW50aW5nCiAgICBTVFFUb2tlbiBwdWJsaWMgbV90b2tlbjsKCiAgICAvLy8gQGRldiBjb250cmFjdCByZXNwb25zaWJsZSBmb3IgaW52ZXN0bWVudHMgYWNjb3VudGluZwogICAgRnVuZHNSZWdpc3RyeSBwdWJsaWMgbV9mdW5kczsKCiAgICAvLy8gQGRldiBsYXN0IHJlY29yZGVkIGZ1bmRzCiAgICB1aW50MjU2IHB1YmxpYyBtX2xhc3RGdW5kc0Ftb3VudDsKfQ=='.
	

]
