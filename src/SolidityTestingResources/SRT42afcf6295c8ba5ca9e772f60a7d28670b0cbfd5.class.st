Class {
	#name : #SRT42afcf6295c8ba5ca9e772f60a7d28670b0cbfd5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT42afcf6295c8ba5ca9e772f60a7d28670b0cbfd5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBUdXJuIHRoZSB1c2FnZSBvZiBjYWxsY29kZQpjb250cmFjdCBTYWZlTWF0aCB7CiAgICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgICAgdWludCBjID0gYSAqIGI7CiAgICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgICAgcmV0dXJuIGM7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICAgICAgICByZXR1cm4gYzsKICAgICB9Cn0KCmNvbnRyYWN0IENyZWF0b3JFbmFibGVkIHsKICAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yID0gMHgwOwoKICAgICBtb2RpZmllciBvbmx5Q3JlYXRvcigpIHsgcmVxdWlyZShtc2cuc2VuZGVyPT1jcmVhdG9yKTsgXzsgfQoKICAgICBmdW5jdGlvbiBjaGFuZ2VDcmVhdG9yKGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgY3JlYXRvciA9IF90bzsKICAgICB9Cn0KCi8vIEVSQzIwIHN0YW5kYXJkCmNvbnRyYWN0IFN0ZFRva2VuIGlzIFNhZmVNYXRoIHsKLy8gRmllbGRzOgogICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CiAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwogICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsKCi8vIEV2ZW50czoKICAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCi8vIEZ1bmN0aW9uczoKICAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHJldHVybnMoYm9vbCkgewogICAgICAgICAgcmVxdWlyZSgweDAhPV90byk7CgogICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLF92YWx1ZSk7CiAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLF92YWx1ZSk7CgogICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQoKICAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICAgIHJlcXVpcmUoMHgwIT1fdG8pOwoKICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sX3ZhbHVlKTsKICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLF92YWx1ZSk7CiAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sX3ZhbHVlKTsKCiAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQoKICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgICB9CgogICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IF9zaXplKSB7CiAgICAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA+PSBfc2l6ZSArIDQpOwogICAgICAgICAgXzsKICAgICB9Cn0KCmNvbnRyYWN0IElHb2xkRmVlIHsKICAgICBmdW5jdGlvbiBjYWxjdWxhdGVGZWUoCiAgICAgICAgICBib29sIF9pc01pZ3JhdGlvblN0YXJ0ZWQsIGJvb2wgX2lzTWlncmF0aW9uRmluaXNoZWQsIAogICAgICAgICAgdWludCBfbW50cEJhbGFuY2UsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KTsKfQoKY29udHJhY3QgR29sZEZlZSBpcyBDcmVhdG9yRW5hYmxlZCB7Ci8vIEZ1bmN0aW9uczogCiAgICAgZnVuY3Rpb24gR29sZEZlZSgpIHsKICAgICAgICAgIGNyZWF0b3IgPSBtc2cuc2VuZGVyOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0TWluKHVpbnQgb3V0KXJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIC8vIDAuMDAyIEdPTEQgaXMgbWluIGZlZQogICAgICAgICAgdWludCBtaW5GZWUgPSAoMiAqIDEgZXRoZXIpIC8gMTAwMDsKICAgICAgICAgIGlmIChvdXQgPCBtaW5GZWUpIHsKICAgICAgICAgICAgICAgcmV0dXJuIG1pbkZlZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvdXQ7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRNYXgodWludCBvdXQpcmV0dXJucyAodWludCkgewogICAgICAgICAgLy8gMC4wMiBHT0xEIGlzIG1heCBmZWUKICAgICAgICAgIHVpbnQgbWF4RmVlID0gKDIgKiAxIGV0aGVyKSAvIDEwMDsKICAgICAgICAgIGlmIChvdXQgPj0gbWF4RmVlKSB7CiAgICAgICAgICAgICAgIHJldHVybiBtYXhGZWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gb3V0OwogICAgIH0KCiAgICAgZnVuY3Rpb24gY2FsY3VsYXRlRmVlKAogICAgICAgICAgYm9vbCBfaXNNaWdyYXRpb25TdGFydGVkLCBib29sIF9pc01pZ3JhdGlvbkZpbmlzaGVkLCAKICAgICAgICAgIHVpbnQgX21udHBCYWxhbmNlLCB1aW50IF92YWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgCiAgICAgewogICAgICAgICAgLy8gV2hlbiBtaWdyYXRpb24gcHJvY2VzcyBpcyBmaW5pc2hlZCAoMSB5ZWFyIGZyb20gR29sZG1pbnQgYmxvY2tjaGFpbiBsYXVuY2gpLCB0aGVuIHRyYW5zYWN0aW9uIGZlZSBpcyAxJSBHT0xELgogICAgICAgICAgaWYgKF9pc01pZ3JhdGlvbkZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgIHJldHVybiAoX3ZhbHVlIC8gMTAwKTsgCiAgICAgICAgICB9CgogICAgICAgICAgLy8gSWYgdGhlIHNlbmRlciBob2xkcyAwIE1OVFAsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIGZlZSBpcyAxJSBHT0xELgoKICAgICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaG9sZHMgYXQgbGVhc3QgMTAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDAuMzMzMzMzJSBHT0xELCAKICAgICAgICAgIC8vIGJ1dCBub3QgbGVzcyB0aGFuIDAuMDAyIE1OVFAKCiAgICAgICAgICAvLyBJZiB0aGUgc2VuZGVyIGhvbGRzIGF0IGxlYXN0IDEwMDAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDAuMDMzMzMzJSBHT0xELAogICAgICAgICAgLy8gYnV0IG5vdCBsZXNzIHRoYW4gMC4wMDIgTU5UUAoKICAgICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaG9sZHMgYXQgbGVhc3QgMTAwMDAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDAuMDMzMzMzMyUgR09MRCwKICAgICAgICAgIC8vIGJ1dCBub3QgbW9yZSB0aGFuIDAuMDIgTU5UUAogICAgICAgICAgaWYgKF9tbnRwQmFsYW5jZSA+PSAoMTAwMDAgKiAxIGV0aGVyKSkgewogICAgICAgICAgICAgICByZXR1cm4gZ2V0TWF4KChfdmFsdWUgLyAxMDApIC8gMzApOwogICAgICAgICAgfQogICAgICAgICAgaWYgKF9tbnRwQmFsYW5jZSA+PSAoMTAwMCAqIDEgZXRoZXIpKSB7CiAgICAgICAgICAgICAgIHJldHVybiBnZXRNaW4oKF92YWx1ZSAvIDEwMCkgLyAzMCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoX21udHBCYWxhbmNlID49ICgxMCAqIDEgZXRoZXIpKSB7CiAgICAgICAgICAgICAgIHJldHVybiBnZXRNaW4oKF92YWx1ZSAvIDEwMCkgLyAzKTsKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgLy8gMSUKICAgICAgICAgIHJldHVybiBnZXRNaW4oX3ZhbHVlIC8gMTAwKTsKICAgICB9Cn0KCmNvbnRyYWN0IEdvbGQgaXMgU3RkVG9rZW4sIENyZWF0b3JFbmFibGVkIHsKLy8gRmllbGRzOgogICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJHb2xkbWludCBHT0xEIFRva2VuIjsKICAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJHT0xEIjsKICAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICAgLy8gdGhpcyBpcyB1c2VkIHRvIHNlbmQgZmVlcyAodGhhdCBpcyB0aGVuIGRpc3RyaWJ1dGVkIGFzIHJld2FyZHMpCiAgICAgYWRkcmVzcyBwdWJsaWMgbWlncmF0aW9uQWRkcmVzcyA9IDB4MDsKICAgICBhZGRyZXNzIHB1YmxpYyBzdG9yYWdlQ29udHJvbGxlckFkZHJlc3MgPSAweDA7CgogICAgIGFkZHJlc3MgcHVibGljIGdvbGRtaW50VGVhbUFkZHJlc3MgPSAweDA7CiAgICAgSU1OVFAgcHVibGljIG1udHBUb2tlbjsKICAgICBJR29sZEZlZSBwdWJsaWMgZ29sZEZlZTsKICAgICAKCiAgICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzTG9ja2VkID0gZmFsc2U7CiAgICAgYm9vbCBwdWJsaWMgY29udHJhY3RMb2NrZWQgPSBmYWxzZTsKICAgICBib29sIHB1YmxpYyBtaWdyYXRpb25TdGFydGVkID0gZmFsc2U7CiAgICAgYm9vbCBwdWJsaWMgbWlncmF0aW9uRmluaXNoZWQgPSBmYWxzZTsKCiAgICAgdWludCBwdWJsaWMgdG90YWxJc3N1ZWQgPSAwOwogICAgIHVpbnQgcHVibGljIHRvdGFsQnVybnQgPSAwOwoKCi8vIE1vZGlmaWVyczoKICAgICBtb2RpZmllciBvbmx5TWlncmF0aW9uKCkgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWlncmF0aW9uQWRkcmVzcyk7IF87IH0KICAgICBtb2RpZmllciBvbmx5Q3JlYXRvcigpIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyZWF0b3IpOyBfOyB9CiAgICAgbW9kaWZpZXIgb25seU1pZ3JhdGlvbk9yU3RvcmFnZUNvbnRyb2xsZXIoKSB7IHJlcXVpcmUobXNnLnNlbmRlciA9PSBtaWdyYXRpb25BZGRyZXNzIHx8IG1zZy5zZW5kZXIgPT0gc3RvcmFnZUNvbnRyb2xsZXJBZGRyZXNzKTsgXzsgfQogICAgIG1vZGlmaWVyIG9ubHlDcmVhdG9yT3JTdG9yYWdlQ29udHJvbGxlcigpIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyZWF0b3IgfHwgbXNnLnNlbmRlciA9PSBzdG9yYWdlQ29udHJvbGxlckFkZHJlc3MpOyBfOyB9CiAgICAgbW9kaWZpZXIgb25seUlmVW5sb2NrZWQoKSB7IHJlcXVpcmUoIXRyYW5zZmVyc0xvY2tlZCk7IF87IH0KCi8vIEZ1bmN0aW9uczoKICAgICBmdW5jdGlvbiBHb2xkKGFkZHJlc3MgX21udHBDb250cmFjdEFkZHJlc3MsIGFkZHJlc3MgX2dvbGRtaW50VGVhbUFkZHJlc3MsIGFkZHJlc3MgX2dvbGRGZWVBZGRyZXNzKSBwdWJsaWMgewogICAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CgogICAgICAgICAgbW50cFRva2VuID0gSU1OVFAoX21udHBDb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgZ29sZG1pbnRUZWFtQWRkcmVzcyA9IF9nb2xkbWludFRlYW1BZGRyZXNzOyAKICAgICAgICAgIGdvbGRGZWUgPSBJR29sZEZlZShfZ29sZEZlZUFkZHJlc3MpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gc2V0Q3JlYXRvcihhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICBjcmVhdG9yID0gX2FkZHJlc3M7CiAgICAgfQoKICAgIGZ1bmN0aW9uIGxvY2tDb250cmFjdChib29sIF9jb250cmFjdExvY2tlZCkgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICAgY29udHJhY3RMb2NrZWQgPSBfY29udHJhY3RMb2NrZWQ7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRTdG9yYWdlQ29udHJvbGxlckNvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgc3RvcmFnZUNvbnRyb2xsZXJBZGRyZXNzID0gX2FkZHJlc3M7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRNaWdyYXRpb25Db250cmFjdEFkZHJlc3MoYWRkcmVzcyBfbWlncmF0aW9uQWRkcmVzcykgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIG1pZ3JhdGlvbkFkZHJlc3MgPSBfbWlncmF0aW9uQWRkcmVzczsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNldEdvbGRtaW50VGVhbUFkZHJlc3MoYWRkcmVzcyBfdGVhbUFkZHJlc3MpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBnb2xkbWludFRlYW1BZGRyZXNzID0gX3RlYW1BZGRyZXNzOwogICAgIH0KCiAgICAgZnVuY3Rpb24gc2V0R29sZEZlZUFkZHJlc3MoYWRkcmVzcyBfZ29sZEZlZUFkZHJlc3MpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBnb2xkRmVlID0gSUdvbGRGZWUoX2dvbGRGZWVBZGRyZXNzKTsKICAgICB9CiAgICAgCiAgICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpIHB1YmxpYyBvbmx5Q3JlYXRvck9yU3RvcmFnZUNvbnRyb2xsZXIgewogICAgICAgICAgcmVxdWlyZSghY29udHJhY3RMb2NrZWQpOwoKICAgICAgICAgIGJhbGFuY2VzW193aG9dID0gc2FmZUFkZChiYWxhbmNlc1tfd2hvXSxfdG9rZW5zKTsKICAgICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSxfdG9rZW5zKTsKICAgICAgICAgIHRvdGFsSXNzdWVkID0gc2FmZUFkZCh0b3RhbElzc3VlZCxfdG9rZW5zKTsKCiAgICAgICAgICBUcmFuc2ZlcigweDAsIF93aG8sIF90b2tlbnMpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2VucykgcHVibGljIG9ubHlNaWdyYXRpb25PclN0b3JhZ2VDb250cm9sbGVyIHsKICAgICAgICAgIHJlcXVpcmUoIWNvbnRyYWN0TG9ja2VkKTsKICAgICAgICAgIGJhbGFuY2VzW193aG9dID0gc2FmZVN1YihiYWxhbmNlc1tfd2hvXSxfdG9rZW5zKTsKICAgICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSxfdG9rZW5zKTsKICAgICAgICAgIHRvdGFsQnVybnQgPSBzYWZlQWRkKHRvdGFsQnVybnQsX3Rva2Vucyk7CiAgICAgfQoKICAgICAvLyB0aGVyZSBpcyBubyB3YXkgdG8gcmV2ZXJ0IHRoYXQKICAgICBmdW5jdGlvbiBzdGFydE1pZ3JhdGlvbigpIHB1YmxpYyBvbmx5TWlncmF0aW9uIHsKICAgICAgICAgIHJlcXVpcmUoZmFsc2UgPT0gbWlncmF0aW9uU3RhcnRlZCk7CiAgICAgICAgICBtaWdyYXRpb25TdGFydGVkID0gdHJ1ZTsKICAgICB9CgogICAgIC8vIHRoZXJlIGlzIG5vIHdheSB0byByZXZlcnQgdGhhdAogICAgIGZ1bmN0aW9uIGZpbmlzaE1pZ3JhdGlvbigpIHB1YmxpYyBvbmx5TWlncmF0aW9uIHsKICAgICAgICAgIHJlcXVpcmUodHJ1ZSA9PSBtaWdyYXRpb25TdGFydGVkKTsKCiAgICAgICAgICBtaWdyYXRpb25GaW5pc2hlZCA9IHRydWU7CiAgICAgfQoKICAgICBmdW5jdGlvbiBsb2NrVHJhbnNmZXIoYm9vbCBfbG9jaykgcHVibGljIG9ubHlNaWdyYXRpb24gewogICAgICAgICAgdHJhbnNmZXJzTG9ja2VkID0gX2xvY2s7CiAgICAgfQoKICAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5SWZVbmxvY2tlZCBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICB1aW50IHlvdXJDdXJyZW50TW50cEJhbGFuY2UgPSBtbnRwVG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpOwoKICAgICAgICAgIC8vIHlvdSBjYW4gdHJhbnNmZXIgaWYgZmVlIGlzIFpFUk8gCiAgICAgICAgICB1aW50IGZlZSA9IGdvbGRGZWUuY2FsY3VsYXRlRmVlKG1pZ3JhdGlvblN0YXJ0ZWQsIG1pZ3JhdGlvbkZpbmlzaGVkLCB5b3VyQ3VycmVudE1udHBCYWxhbmNlLCBfdmFsdWUpOwogICAgICAgICAgdWludCBzZW5kVGhpcyA9IF92YWx1ZTsKICAgICAgICAgIGlmICgwICE9IGZlZSkgeyAKICAgICAgICAgICAgICAgc2VuZFRoaXMgPSBzYWZlU3ViKF92YWx1ZSxmZWUpOwogICAgICAgICAgCiAgICAgICAgICAgICAgIC8vIDEuVHJhbnNmZXIgZmVlCiAgICAgICAgICAgICAgIC8vIEEgLT4gcmV3YXJkcyBhY2NvdW50CiAgICAgICAgICAgICAgIC8vIAogICAgICAgICAgICAgICAvLyBFYWNoIEdPTEQgdG9rZW4gdHJhbnNmZXIgc2hvdWxkIHNlbmQgdHJhbnNhY3Rpb24gZmVlIHRvCiAgICAgICAgICAgICAgIC8vIEdvbGRtaW50TWlncmF0aW9uIGNvbnRyYWN0IGlmIE1pZ3JhdGlvbiBwcm9jZXNzIGlzIG5vdCBzdGFydGVkLgogICAgICAgICAgICAgICAvLyBHb2xkbWludCB0ZWFtIGlmIE1pZ3JhdGlvbiBwcm9jZXNzIGlzIHN0YXJ0ZWQuCiAgICAgICAgICAgICAgIGlmIChtaWdyYXRpb25TdGFydGVkKSB7CiAgICAgICAgICAgICAgICAgICAgc3VwZXIudHJhbnNmZXIoZ29sZG1pbnRUZWFtQWRkcmVzcywgZmVlKTsKICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdXBlci50cmFuc2ZlcihtaWdyYXRpb25BZGRyZXNzLCBmZWUpOwogICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gMi5UcmFuc2ZlcgogICAgICAgICAgLy8gQSAtPiBCCiAgICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBzZW5kVGhpcyk7CiAgICAgfQoKICAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seUlmVW5sb2NrZWQgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgdWludCB5b3VyQ3VycmVudE1udHBCYWxhbmNlID0gbW50cFRva2VuLmJhbGFuY2VPZihfZnJvbSk7CgogICAgICAgICAgdWludCBmZWUgPSBnb2xkRmVlLmNhbGN1bGF0ZUZlZShtaWdyYXRpb25TdGFydGVkLCBtaWdyYXRpb25GaW5pc2hlZCwgeW91ckN1cnJlbnRNbnRwQmFsYW5jZSwgX3ZhbHVlKTsKICAgICAgICAgIGlmICgwICE9IGZlZSkgeyAKICAgICAgICAgICAgICAgLy8gMS5UcmFuc2ZlciBmZWUKICAgICAgICAgICAgICAgLy8gQSAtPiByZXdhcmRzIGFjY291bnQKICAgICAgICAgICAgICAgLy8gCiAgICAgICAgICAgICAgIC8vIEVhY2ggR09MRCB0b2tlbiB0cmFuc2ZlciBzaG91bGQgc2VuZCB0cmFuc2FjdGlvbiBmZWUgdG8KICAgICAgICAgICAgICAgLy8gR29sZG1pbnRNaWdyYXRpb24gY29udHJhY3QgaWYgTWlncmF0aW9uIHByb2Nlc3MgaXMgbm90IHN0YXJ0ZWQuCiAgICAgICAgICAgICAgIC8vIEdvbGRtaW50IHRlYW0gaWYgTWlncmF0aW9uIHByb2Nlc3MgaXMgc3RhcnRlZC4KICAgICAgICAgICAgICAgaWYgKG1pZ3JhdGlvblN0YXJ0ZWQpIHsKICAgICAgICAgICAgICAgICAgICBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIGdvbGRtaW50VGVhbUFkZHJlc3MsIGZlZSk7CiAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBtaWdyYXRpb25BZGRyZXNzLCBmZWUpOwogICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICAgIC8vIDIuVHJhbnNmZXIKICAgICAgICAgIC8vIEEgLT4gQgogICAgICAgICAgdWludCBzZW5kVGhpcyA9IHNhZmVTdWIoX3ZhbHVlLGZlZSk7CiAgICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIHNlbmRUaGlzKTsKICAgICB9CgogICAgIC8vIFVzZWQgdG8gc2VuZCByZXdhcmRzKQogICAgIGZ1bmN0aW9uIHRyYW5zZmVyUmV3YXJkV2l0aG91dEZlZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyBvbmx5TWlncmF0aW9uIG9ubHlQYXlsb2FkU2l6ZSgyKjMyKSB7CiAgICAgICAgICByZXF1aXJlKDB4MCE9X3RvKTsKCiAgICAgICAgICBiYWxhbmNlc1ttaWdyYXRpb25BZGRyZXNzXSA9IHNhZmVTdWIoYmFsYW5jZXNbbWlncmF0aW9uQWRkcmVzc10sX3ZhbHVlKTsKICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sX3ZhbHVlKTsKCiAgICAgICAgICBUcmFuc2ZlcihtaWdyYXRpb25BZGRyZXNzLCBfdG8sIF92YWx1ZSk7CiAgICAgfQoKICAgICAvLyBUaGlzIGlzIGFuIGVtZXJnZW5jeSBmdW5jdGlvbiB0aGF0IGNhbiBiZSBjYWxsZWQgYnkgQ3JlYXRvciBvbmx5IAogICAgIGZ1bmN0aW9uIHJlc2N1ZUFsbFJld2FyZHMoYWRkcmVzcyBfdG8pIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICByZXF1aXJlKDB4MCE9X3RvKTsKCiAgICAgICAgICB1aW50IHRvdGFsUmV3YXJkID0gYmFsYW5jZXNbbWlncmF0aW9uQWRkcmVzc107CgogICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSx0b3RhbFJld2FyZCk7CiAgICAgICAgICBiYWxhbmNlc1ttaWdyYXRpb25BZGRyZXNzXSA9IDA7CgogICAgICAgICAgVHJhbnNmZXIobWlncmF0aW9uQWRkcmVzcywgX3RvLCB0b3RhbFJld2FyZCk7CiAgICAgfQoKCiAgICAgZnVuY3Rpb24gZ2V0VG90YWxJc3N1ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgcmV0dXJuIHRvdGFsSXNzdWVkOyAKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldFRvdGFsQnVybnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgcmV0dXJuIHRvdGFsQnVybnQ7IAogICAgIH0KCgp9Cgpjb250cmFjdCBJTU5UUCBpcyBTdGRUb2tlbiB7Ci8vIEFkZGl0aW9uYWwgbWV0aG9kcyB0aGF0IE1OVFAgY29udHJhY3QgcHJvdmlkZXMKICAgICBmdW5jdGlvbiBsb2NrVHJhbnNmZXIoYm9vbCBfbG9jayk7CiAgICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpOwogICAgIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBfd2hvLCB1aW50IF90b2tlbnMpOwp9Cgpjb250cmFjdCBHb2xkbWludE1pZ3JhdGlvbiBpcyBDcmVhdG9yRW5hYmxlZCB7Ci8vIEZpZWxkczoKICAgICBJTU5UUCBwdWJsaWMgbW50cFRva2VuOwogICAgIEdvbGQgcHVibGljIGdvbGRUb2tlbjsKCiAgICAgZW51bSBTdGF0ZSB7CiAgICAgICAgICBJbml0LAogICAgICAgICAgTWlncmF0aW9uU3RhcnRlZCwKICAgICAgICAgIE1pZ3JhdGlvblBhdXNlZCwKICAgICAgICAgIE1pZ3JhdGlvbkZpbmlzaGVkCiAgICAgfQoKICAgICBTdGF0ZSBwdWJsaWMgc3RhdGUgPSBTdGF0ZS5Jbml0OwogICAgIAogICAgIC8vIHRoaXMgaXMgdG90YWwgY29sbGVjdGVkIEdPTEQgcmV3YXJkcyAobGF1bmNoIHRvIG1pZ3JhdGlvbiBzdGFydCkKICAgICB1aW50IHB1YmxpYyBtbnRwVG9NaWdyYXRlVG90YWwgPSAwOwogICAgIHVpbnQgcHVibGljIG1pZ3JhdGlvblJld2FyZFRvdGFsID0gMDsKICAgICB1aW50NjQgcHVibGljIG1pZ3JhdGlvblN0YXJ0ZWRUaW1lID0gMDsKICAgICB1aW50NjQgcHVibGljIG1pZ3JhdGlvbkZpbmlzaGVkVGltZSA9IDA7CgogICAgIHN0cnVjdCBNaWdyYXRpb24gewogICAgICAgICAgYWRkcmVzcyBldGhBZGRyZXNzOwogICAgICAgICAgc3RyaW5nIGdtQWRkcmVzczsKICAgICAgICAgIHVpbnQgdG9rZW5zQ291bnQ7CiAgICAgICAgICBib29sIG1pZ3JhdGVkOwogICAgICAgICAgdWludDY0IGRhdGU7CiAgICAgICAgICBzdHJpbmcgY29tbWVudDsKICAgICB9CgogICAgIG1hcHBpbmcgKHVpbnQ9Pk1pZ3JhdGlvbikgcHVibGljIG1udHBNaWdyYXRpb25zOwogICAgIG1hcHBpbmcgKGFkZHJlc3M9PnVpbnQpIHB1YmxpYyBtbnRwTWlncmF0aW9uSW5kZXhlczsKICAgICB1aW50IHB1YmxpYyBtbnRwTWlncmF0aW9uc0NvdW50ID0gMDsKCiAgICAgbWFwcGluZyAodWludD0+TWlncmF0aW9uKSBwdWJsaWMgZ29sZE1pZ3JhdGlvbnM7CiAgICAgbWFwcGluZyAoYWRkcmVzcz0+dWludCkgcHVibGljIGdvbGRNaWdyYXRpb25JbmRleGVzOwogICAgIHVpbnQgcHVibGljIGdvbGRNaWdyYXRpb25zQ291bnQgPSAwOwoKICAgICBldmVudCBNbnRwTWlncmF0ZVdhbnRlZChhZGRyZXNzIF9ldGhBZGRyZXNzLCBzdHJpbmcgX2dtQWRkcmVzcywgdWludDI1NiBfdmFsdWUpOwogICAgIGV2ZW50IE1udHBNaWdyYXRlZChhZGRyZXNzIF9ldGhBZGRyZXNzLCBzdHJpbmcgX2dtQWRkcmVzcywgdWludDI1NiBfdmFsdWUpOwoKICAgICBldmVudCBHb2xkTWlncmF0ZVdhbnRlZChhZGRyZXNzIF9ldGhBZGRyZXNzLCBzdHJpbmcgX2dtQWRkcmVzcywgdWludDI1NiBfdmFsdWUpOwogICAgIGV2ZW50IEdvbGRNaWdyYXRlZChhZGRyZXNzIF9ldGhBZGRyZXNzLCBzdHJpbmcgX2dtQWRkcmVzcywgdWludDI1NiBfdmFsdWUpOwoKLy8gQWNjZXNzIG1ldGhvZHMKICAgICBmdW5jdGlvbiBnZXRNbnRwTWlncmF0aW9uKHVpbnQgaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGFkZHJlc3Msc3RyaW5nLHVpbnQsYm9vbCx1aW50NjQsc3RyaW5nKXsKICAgICAgICAgIE1pZ3JhdGlvbiBtZW1vcnkgbWlnID0gbW50cE1pZ3JhdGlvbnNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIChtaWcuZXRoQWRkcmVzcywgbWlnLmdtQWRkcmVzcywgbWlnLnRva2Vuc0NvdW50LCBtaWcubWlncmF0ZWQsIG1pZy5kYXRlLCBtaWcuY29tbWVudCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRHb2xkTWlncmF0aW9uKHVpbnQgaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGFkZHJlc3Msc3RyaW5nLHVpbnQsYm9vbCx1aW50NjQsc3RyaW5nKXsKICAgICAgICAgIE1pZ3JhdGlvbiBtZW1vcnkgbWlnID0gZ29sZE1pZ3JhdGlvbnNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIChtaWcuZXRoQWRkcmVzcywgbWlnLmdtQWRkcmVzcywgbWlnLnRva2Vuc0NvdW50LCBtaWcubWlncmF0ZWQsIG1pZy5kYXRlLCBtaWcuY29tbWVudCk7CiAgICAgfQoKLy8gRnVuY3Rpb25zOgogICAgIC8vIENvbnN0cnVjdG9yCiAgICAgZnVuY3Rpb24gR29sZG1pbnRNaWdyYXRpb24oYWRkcmVzcyBfbW50cENvbnRyYWN0QWRkcmVzcywgYWRkcmVzcyBfZ29sZENvbnRyYWN0QWRkcmVzcykgcHVibGljIHsKICAgICAgICAgIGNyZWF0b3IgPSBtc2cuc2VuZGVyOwoKICAgICAgICAgIHJlcXVpcmUoX21udHBDb250cmFjdEFkZHJlc3MgIT0gMCk7CiAgICAgICAgICByZXF1aXJlKF9nb2xkQ29udHJhY3RBZGRyZXNzICE9IDApOwoKICAgICAgICAgIG1udHBNaWdyYXRpb25JbmRleGVzW2FkZHJlc3MoMHgwKV0gPSAwOwogICAgICAgICAgZ29sZE1pZ3JhdGlvbkluZGV4ZXNbYWRkcmVzcygweDApXSA9IDA7CgogICAgICAgICAgbW50cFRva2VuID0gSU1OVFAoX21udHBDb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgZ29sZFRva2VuID0gR29sZChfZ29sZENvbnRyYWN0QWRkcmVzcyk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBsb2NrTW50cFRyYW5zZmVycyhib29sIF9sb2NrKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgbW50cFRva2VuLmxvY2tUcmFuc2ZlcihfbG9jayk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBsb2NrR29sZFRyYW5zZmVycyhib29sIF9sb2NrKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgZ29sZFRva2VuLmxvY2tUcmFuc2ZlcihfbG9jayk7CiAgICAgfQoKICAgICAvLyBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbiBtaWdyYXRpb24gdG8gR29sZG1pbnQncyBibG9ja2NoYWluCiAgICAgLy8gcHJvY2VzcyBpcyBzdGFydGVkLi4uCiAgICAgZnVuY3Rpb24gc3RhcnRNaWdyYXRpb24oKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgcmVxdWlyZSgoU3RhdGUuSW5pdCA9PSBzdGF0ZSkgfHwgKFN0YXRlLk1pZ3JhdGlvblBhdXNlZCA9PSBzdGF0ZSkpOwoKICAgICAgICAgIGlmIChTdGF0ZS5Jbml0ID09IHN0YXRlKSB7CiAgICAgICAgICAgICAgIC8vIDEgLSBjaGFuZ2UgZmVlcwogICAgICAgICAgICAgICBnb2xkVG9rZW4uc3RhcnRNaWdyYXRpb24oKTsKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIC8vIDIgLSBzdG9yZSB0aGUgY3VycmVudCB2YWx1ZXMgCiAgICAgICAgICAgICAgIG1pZ3JhdGlvblJld2FyZFRvdGFsID0gZ29sZFRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICAgICAgICAgbWlncmF0aW9uU3RhcnRlZFRpbWUgPSB1aW50NjQobm93KTsKICAgICAgICAgICAgICAgbW50cFRvTWlncmF0ZVRvdGFsID0gbW50cFRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgICB9CgogICAgICAgICAgc3RhdGUgPSBTdGF0ZS5NaWdyYXRpb25TdGFydGVkOwogICAgIH0KCiAgICAgZnVuY3Rpb24gcGF1c2VNaWdyYXRpb24oKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgcmVxdWlyZSgoc3RhdGUgPT0gU3RhdGUuTWlncmF0aW9uU3RhcnRlZCkgfHwgKHN0YXRlID09IFN0YXRlLk1pZ3JhdGlvbkZpbmlzaGVkKSk7CgogICAgICAgICAgc3RhdGUgPSBTdGF0ZS5NaWdyYXRpb25QYXVzZWQ7CiAgICAgfQoKICAgICAvLyB0aGF0IGRvZXNuJ3QgbWVhbiB0aGF0IHlvdSBjYW50IG1pZ3JhdGUgZnJvbSBFdGhlcmV1bSAtPiBHb2xkbWludCBibG9ja2NoYWluCiAgICAgLy8gdGhhdCBtZWFucyB0aGF0IHlvdSB3aWxsIGdldCBubyByZXdhcmQKICAgICBmdW5jdGlvbiBmaW5pc2hNaWdyYXRpb24oKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgcmVxdWlyZSgoU3RhdGUuTWlncmF0aW9uU3RhcnRlZCA9PSBzdGF0ZSkgfHwgKFN0YXRlLk1pZ3JhdGlvblBhdXNlZCA9PSBzdGF0ZSkpOwoKICAgICAgICAgIGlmIChTdGF0ZS5NaWdyYXRpb25TdGFydGVkID09IHN0YXRlKSB7CiAgICAgICAgICAgICAgIGdvbGRUb2tlbi5maW5pc2hNaWdyYXRpb24oKTsKICAgICAgICAgICAgICAgbWlncmF0aW9uRmluaXNoZWRUaW1lID0gdWludDY0KG5vdyk7CiAgICAgICAgICB9CgogICAgICAgICAgc3RhdGUgPSBTdGF0ZS5NaWdyYXRpb25GaW5pc2hlZDsKICAgICB9CgogICAgIGZ1bmN0aW9uIGRlc3Ryb3lNZSgpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBzZWxmZGVzdHJ1Y3QobXNnLnNlbmRlcik7ICAgICAgICAgIAogICAgIH0KCi8vIE1OVFAKICAgICAvLyBDYWxsIHRoaXMgdG8gbWlncmF0ZSB5b3VyIE1OVFAgdG9rZW5zIHRvIEdvbGRtaW50IE1OVAogICAgIC8vICh0aGlzIGlzIG9uZS13YXkgb25seSkKICAgICAvLyBfZ21BZGRyZXNzIGlzIHNvbWV0aGluZyBsaWtlIHRoYXQgLSAiQlRTN3lSWENrQmpLeGhvNTdSQ2JxWUUzbkVpcHJXWFhFU3czSHhzNUNLUm5mdDh4N21kR2kiCiAgICAgLy8KICAgICAvLyAhISEgV0FSTklORzogd2lsbCBub3QgYWxsb3cgYW55b25lIHRvIG1pZ3JhdGUgdG9rZW5zIHBhcnRseQogICAgIC8vICEhISBESVNDTEFJTUVSOiBjaGVjayBnb2xkbWludCBibG9ja2NoYWluIGFkZHJlc3MgZm9ybWF0LiBZb3Ugd2lsbCBub3QgYmUgYWJsZSB0byBjaGFuZ2UgdGhhdCEKICAgICBmdW5jdGlvbiBtaWdyYXRlTW50cChzdHJpbmcgX2dtQWRkcmVzcykgcHVibGljIHsKICAgICAgICAgIHJlcXVpcmUoKHN0YXRlPT1TdGF0ZS5NaWdyYXRpb25TdGFydGVkKSB8fCAoc3RhdGU9PVN0YXRlLk1pZ3JhdGlvbkZpbmlzaGVkKSk7CgogICAgICAgICAgLy8gMSAtIGNhbGN1bGF0ZSBjdXJyZW50IHJld2FyZAogICAgICAgICAgdWludCBteUJhbGFuY2UgPSBtbnRwVG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpOwogICAgICAgICAgcmVxdWlyZSgwIT1teUJhbGFuY2UpOwoKICAgICAgICAgIHVpbnQgbXlSZXdhcmRNYXggPSBjYWxjdWxhdGVNeVJld2FyZE1heChtc2cuc2VuZGVyKTsgICAgICAgIAogICAgICAgICAgdWludCBteVJld2FyZCA9IGNhbGN1bGF0ZU15UmV3YXJkKG15UmV3YXJkTWF4KTsKCiAgICAgICAgICAvLyAyIC0gcGF5IHRoZSByZXdhcmQgdG8gb3VyIHVzZXIKICAgICAgICAgIGdvbGRUb2tlbi50cmFuc2ZlclJld2FyZFdpdGhvdXRGZWUobXNnLnNlbmRlciwgbXlSZXdhcmQpOwoKICAgICAgICAgIC8vIDMgLSBidXJuIHRva2VucyAKICAgICAgICAgIC8vIFdBUk5JTkc6IGJ1cm4gd2lsbCByZWR1Y2UgdG90YWxTdXBwbHkKICAgICAgICAgIC8vIAogICAgICAgICAgLy8gV0FSTklORzogY3JlYXRvciBtdXN0IGNhbGwgCiAgICAgICAgICAvLyBzZXRJY29Db250cmFjdEFkZHJlc3MobWlncmF0aW9uQ29udHJhY3RBZGRyZXNzKQogICAgICAgICAgLy8gb2YgdGhlIG1udHBUb2tlbgogICAgICAgICAgbW50cFRva2VuLmJ1cm5Ub2tlbnMobXNnLnNlbmRlcixteUJhbGFuY2UpOwoKICAgICAgICAgIC8vIHNhdmUgdHVwbGUgCiAgICAgICAgICBNaWdyYXRpb24gbWVtb3J5IG1pZzsKICAgICAgICAgIG1pZy5ldGhBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAgIG1pZy5nbUFkZHJlc3MgPSBfZ21BZGRyZXNzOwogICAgICAgICAgbWlnLnRva2Vuc0NvdW50ID0gbXlCYWxhbmNlOwogICAgICAgICAgbWlnLm1pZ3JhdGVkID0gZmFsc2U7CiAgICAgICAgICBtaWcuZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgICAgICAgbWlnLmNvbW1lbnQgPSAnJzsKCiAgICAgICAgICBtbnRwTWlncmF0aW9uc1ttbnRwTWlncmF0aW9uc0NvdW50ICsgMV0gPSBtaWc7CiAgICAgICAgICBtbnRwTWlncmF0aW9uSW5kZXhlc1ttc2cuc2VuZGVyXSA9IG1udHBNaWdyYXRpb25zQ291bnQgKyAxOwogICAgICAgICAgbW50cE1pZ3JhdGlvbnNDb3VudCsrOwoKICAgICAgICAgIC8vIHNlbmQgYW4gZXZlbnQKICAgICAgICAgIE1udHBNaWdyYXRlV2FudGVkKG1zZy5zZW5kZXIsIF9nbUFkZHJlc3MsIG15QmFsYW5jZSk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBpc01udHBNaWdyYXRlZChhZGRyZXNzIF93aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICAgIHVpbnQgaW5kZXggPSBtbnRwTWlncmF0aW9uSW5kZXhlc1tfd2hvXTsKCiAgICAgICAgICBNaWdyYXRpb24gbWVtb3J5IG1pZyA9IG1udHBNaWdyYXRpb25zW2luZGV4XTsKICAgICAgICAgIHJldHVybiBtaWcubWlncmF0ZWQ7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRNbnRwTWlncmF0ZWQoYWRkcmVzcyBfd2hvLCBib29sIF9pc01pZ3JhdGVkLCBzdHJpbmcgX2NvbW1lbnQpIHB1YmxpYyBvbmx5Q3JlYXRvciB7IAogICAgICAgICAgdWludCBpbmRleCA9IG1udHBNaWdyYXRpb25JbmRleGVzW193aG9dOwogICAgICAgICAgcmVxdWlyZShpbmRleCA+IDApOwoKICAgICAgICAgIG1udHBNaWdyYXRpb25zW2luZGV4XS5taWdyYXRlZCA9IF9pc01pZ3JhdGVkOyAKICAgICAgICAgIG1udHBNaWdyYXRpb25zW2luZGV4XS5jb21tZW50ID0gX2NvbW1lbnQ7IAoKICAgICAgICAgIC8vIHNlbmQgYW4gZXZlbnQKICAgICAgICAgIGlmIChfaXNNaWdyYXRlZCkgewogICAgICAgICAgICAgICBNbnRwTWlncmF0ZWQoICBtbnRwTWlncmF0aW9uc1tpbmRleF0uZXRoQWRkcmVzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1udHBNaWdyYXRpb25zW2luZGV4XS5nbUFkZHJlc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtbnRwTWlncmF0aW9uc1tpbmRleF0udG9rZW5zQ291bnQpOwogICAgICAgICAgfQogICAgIH0KCi8vIEdPTEQKICAgICBmdW5jdGlvbiBtaWdyYXRlR29sZChzdHJpbmcgX2dtQWRkcmVzcykgcHVibGljIHsKICAgICAgICAgIHJlcXVpcmUoKHN0YXRlPT1TdGF0ZS5NaWdyYXRpb25TdGFydGVkKSB8fCAoc3RhdGU9PVN0YXRlLk1pZ3JhdGlvbkZpbmlzaGVkKSk7CgogICAgICAgICAgLy8gMSAtIGdldCBiYWxhbmNlCiAgICAgICAgICB1aW50IG15QmFsYW5jZSA9IGdvbGRUb2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgICByZXF1aXJlKDAhPW15QmFsYW5jZSk7CgogICAgICAgICAgLy8gMiAtIGJ1cm4gdG9rZW5zIAogICAgICAgICAgLy8gV0FSTklORzogYnVybiB3aWxsIHJlZHVjZSB0b3RhbFN1cHBseQogICAgICAgICAgLy8gCiAgICAgICAgICBnb2xkVG9rZW4uYnVyblRva2Vucyhtc2cuc2VuZGVyLG15QmFsYW5jZSk7CgogICAgICAgICAgLy8gc2F2ZSB0dXBsZSAKICAgICAgICAgIE1pZ3JhdGlvbiBtZW1vcnkgbWlnOwogICAgICAgICAgbWlnLmV0aEFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgICAgbWlnLmdtQWRkcmVzcyA9IF9nbUFkZHJlc3M7CiAgICAgICAgICBtaWcudG9rZW5zQ291bnQgPSBteUJhbGFuY2U7CiAgICAgICAgICBtaWcubWlncmF0ZWQgPSBmYWxzZTsKICAgICAgICAgIG1pZy5kYXRlID0gdWludDY0KG5vdyk7CiAgICAgICAgICBtaWcuY29tbWVudCA9ICcnOwoKICAgICAgICAgIGdvbGRNaWdyYXRpb25zW2dvbGRNaWdyYXRpb25zQ291bnQgKyAxXSA9IG1pZzsKICAgICAgICAgIGdvbGRNaWdyYXRpb25JbmRleGVzW21zZy5zZW5kZXJdID0gZ29sZE1pZ3JhdGlvbnNDb3VudCArIDE7CiAgICAgICAgICBnb2xkTWlncmF0aW9uc0NvdW50Kys7CgogICAgICAgICAgLy8gc2VuZCBhbiBldmVudAogICAgICAgICAgR29sZE1pZ3JhdGVXYW50ZWQobXNnLnNlbmRlciwgX2dtQWRkcmVzcywgbXlCYWxhbmNlKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGlzR29sZE1pZ3JhdGVkKGFkZHJlc3MgX3dobykgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgICAgdWludCBpbmRleCA9IGdvbGRNaWdyYXRpb25JbmRleGVzW193aG9dOwoKICAgICAgICAgIE1pZ3JhdGlvbiBtZW1vcnkgbWlnID0gZ29sZE1pZ3JhdGlvbnNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIG1pZy5taWdyYXRlZDsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNldEdvbGRNaWdyYXRlZChhZGRyZXNzIF93aG8sIGJvb2wgX2lzTWlncmF0ZWQsIHN0cmluZyBfY29tbWVudCkgcHVibGljIG9ubHlDcmVhdG9yIHsgCiAgICAgICAgICB1aW50IGluZGV4ID0gZ29sZE1pZ3JhdGlvbkluZGV4ZXNbX3dob107CiAgICAgICAgICByZXF1aXJlKGluZGV4ID4gMCk7CgogICAgICAgICAgZ29sZE1pZ3JhdGlvbnNbaW5kZXhdLm1pZ3JhdGVkID0gX2lzTWlncmF0ZWQ7IAogICAgICAgICAgZ29sZE1pZ3JhdGlvbnNbaW5kZXhdLmNvbW1lbnQgPSBfY29tbWVudDsgCgogICAgICAgICAgLy8gc2VuZCBhbiBldmVudAogICAgICAgICAgaWYgKF9pc01pZ3JhdGVkKSB7CiAgICAgICAgICAgICAgIEdvbGRNaWdyYXRlZCggIGdvbGRNaWdyYXRpb25zW2luZGV4XS5ldGhBZGRyZXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29sZE1pZ3JhdGlvbnNbaW5kZXhdLmdtQWRkcmVzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvbGRNaWdyYXRpb25zW2luZGV4XS50b2tlbnNDb3VudCk7CiAgICAgICAgICB9CiAgICAgfQoKICAgICAvLyBFYWNoIE1OVFAgdG9rZW4gaG9sZGVyIGdldHMgYSBHT0xEIHJld2FyZCBhcyBhIHBlcmNlbnQgb2YgYWxsIHJld2FyZHMKICAgICAvLyBwcm9wb3J0aW9uYWwgdG8gaGlzIE1OVFAgdG9rZW4gc3Rha2UKICAgICBmdW5jdGlvbiBjYWxjdWxhdGVNeVJld2FyZE1heChhZGRyZXNzIF9vZikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCl7CiAgICAgICAgICBpZiAoMCA9PSBtbnRwVG9NaWdyYXRlVG90YWwpIHsKICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICB9CgogICAgICAgICAgdWludCBteUN1cnJlbnRNbnRwQmFsYW5jZSA9IG1udHBUb2tlbi5iYWxhbmNlT2YoX29mKTsKICAgICAgICAgIGlmICgwID09IG15Q3VycmVudE1udHBCYWxhbmNlKSB7CiAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAobWlncmF0aW9uUmV3YXJkVG90YWwgKiBteUN1cnJlbnRNbnRwQmFsYW5jZSkgLyBtbnRwVG9NaWdyYXRlVG90YWw7CiAgICAgfQoKICAgICAvLyBNaWdyYXRpb24gcmV3YXJkcyBkZWNyZWFzZWQgbGluZWFybHkuIAogICAgIC8vIAogICAgIC8vIFRoZSBmb3JtdWxhIGlzOiByZXdhcmRQZXJjZW50cyA9IG1heCgxMDAgLSAxMDAgKiBkYXkgLyAzNjUsIDApCiAgICAgLy8KICAgICAvLyBPbiAxc3QgZGF5IG9mIG1pZ3JhdGlvbiwgeW91IHdpbGwgZ2V0OiAxMDAgLSAxMDAgKiAwLzM2NSA9IDEwMCUgb2YgeW91ciByZXdhcmRzCiAgICAgLy8gT24gMm5kIGRheSBvZiBtaWdyYXRpb24sIHlvdSB3aWxsIGdldDogMTAwIC0gMTAwICogMS8zNjUgPSA5OS43MjYxJSBvZiB5b3VyIHJld2FyZHMKICAgICAvLyBPbiAzNjV0aCBkYXkgb2YgbWlncmF0aW9uLCB5b3Ugd2lsbCBnZXQ6IDEwMCAtIDEwMCAqIDM2NC8zNjUgPSAwLjI3NCUKICAgICBmdW5jdGlvbiBjYWxjdWxhdGVNeVJld2FyZERlY3JlYXNlZCh1aW50IF9kYXksIHVpbnQgX215UmV3YXJkTWF4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KXsKICAgICAgICAgIGlmIChfZGF5ID49IDM2NSkgewogICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KCiAgICAgICAgICB1aW50IHggPSAoKDEwMCAqIDEwMDAwMDAwMDAgKiBfZGF5KSAvIDM2NSk7CiAgICAgICAgICByZXR1cm4gKF9teVJld2FyZE1heCAqICgoMTAwICogMTAwMDAwMDAwMCkgLSB4KSkgLyAoMTAwICogMTAwMDAwMDAwMCk7CiAgICAgfQogICAgIAogICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU15UmV3YXJkKHVpbnQgX215UmV3YXJkTWF4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KXsKICAgICAgICAgIC8vIGRheSBzdGFydHMgZnJvbSAwCiAgICAgICAgICB1aW50IGRheSA9ICh1aW50NjQobm93KSAtIG1pZ3JhdGlvblN0YXJ0ZWRUaW1lKSAvIHVpbnQ2NCgxIGRheXMpOyAgCiAgICAgICAgICByZXR1cm4gY2FsY3VsYXRlTXlSZXdhcmREZWNyZWFzZWQoZGF5LCBfbXlSZXdhcmRNYXgpOwogICAgIH0KCi8vLy8vLy8vLwogICAgIC8vIGRvIG5vdCBhbGxvdyB0byBzZW5kIG1vbmV5IHRvIHRoaXMgY29udHJhY3QuLi4KICAgICBmdW5jdGlvbigpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgfQp9'.
	

]
