Class {
	#name : #SRTd850942ef8811f2a866692a623011bde52a462c1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd850942ef8811f2a866692a623011bde52a462c1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBPd25lZCB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgZnVuY3Rpb24gT3duZWQoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiB0b1VJTlQxMTIodWludDI1NiBhKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQxMTIpIHsKICAgIGFzc2VydCh1aW50MTEyKGEpID09IGEpOwogICAgcmV0dXJuIHVpbnQxMTIoYSk7CiAgfQoKICBmdW5jdGlvbiB0b1VJTlQxMjAodWludDI1NiBhKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQxMjApIHsKICAgIGFzc2VydCh1aW50MTIwKGEpID09IGEpOwogICAgcmV0dXJuIHVpbnQxMjAoYSk7CiAgfQoKICBmdW5jdGlvbiB0b1VJTlQxMjgodWludDI1NiBhKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQxMjgpIHsKICAgIGFzc2VydCh1aW50MTI4KGEpID09IGEpOwogICAgcmV0dXJuIHVpbnQxMjgoYSk7CiAgfQp9CgoKLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKCmNvbnRyYWN0IFRva2VuIHsKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgLy91aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9hZGRyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHdlaSB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKCi8vLyBWRU4gdG9rZW4sIEVSQzIwIGNvbXBsaWFudApjb250cmFjdCBWRU4gaXMgVG9rZW4sIE93bmVkIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSAgICA9ICJWZUNoYWluIFRva2VuIjsgIC8vVGhlIFRva2VuJ3MgbmFtZQogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7ICAgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sICA9ICJWRU4iOyAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllciAgICAKCiAgICAvLyBwYWNrZWQgdG8gMjU2Yml0IHRvIHNhdmUgZ2FzIHVzYWdlLgogICAgc3RydWN0IFN1cHBsaWVzIHsKICAgICAgICAvLyB1aW50MTI4J3MgbWF4IHZhbHVlIGlzIGFib3V0IDNlMzguCiAgICAgICAgLy8gaXQncyBlbm91Z2ggdG8gcHJlc2VudCBhbW91bnQgb2YgdG9rZW5zCiAgICAgICAgdWludDEyOCB0b3RhbDsKICAgICAgICB1aW50MTI4IHJhd1Rva2VuczsKICAgIH0KCiAgICBTdXBwbGllcyBzdXBwbGllczsKCiAgICAvLyBQYWNrZWQgdG8gMjU2Yml0IHRvIHNhdmUgZ2FzIHVzYWdlLiAgICAKICAgIHN0cnVjdCBBY2NvdW50IHsKICAgICAgICAvLyB1aW50MTEyJ3MgbWF4IHZhbHVlIGlzIGFib3V0IDVlMzMuCiAgICAgICAgLy8gaXQncyBlbm91Z2ggdG8gcHJlc2VudCBhbW91bnQgb2YgdG9rZW5zCiAgICAgICAgdWludDExMiBiYWxhbmNlOwoKICAgICAgICAvLyByYXcgdG9rZW4gY2FuIGJlIHRyYW5zZm9ybWVkIGludG8gYmFsYW5jZSB3aXRoIGJvbnVzICAgICAgICAKICAgICAgICB1aW50MTEyIHJhd1Rva2VuczsKCiAgICAgICAgLy8gc2FmZSB0byBzdG9yZSB0aW1lc3RhbXAKICAgICAgICB1aW50MzIgbGFzdE1pbnRlZFRpbWVzdGFtcDsKICAgIH0KCiAgICAvLyBCYWxhbmNlcyBmb3IgZWFjaCBhY2NvdW50CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQWNjb3VudCkgYWNjb3VudHM7CgogICAgLy8gT3duZXIgb2YgYWNjb3VudCBhcHByb3ZlcyB0aGUgdHJhbnNmZXIgb2YgYW4gYW1vdW50IHRvIGFub3RoZXIgYWNjb3VudAogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBib251cyB0aGF0IGNhbiBiZSBzaGFyZWQgYnkgcmF3IHRva2VucwogICAgdWludDI1NiBib251c09mZmVyZWQ7CgogICAgLy8gQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFZFTigpIHsKICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KXsKICAgICAgICByZXR1cm4gc3VwcGxpZXMudG90YWw7CiAgICB9CgogICAgLy8gU2VuZCBiYWNrIGV0aGVyIHNlbnQgdG8gbWUKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KCiAgICAvLyBJZiBzZWFsZWQsIHRyYW5zZmVyIGlzIGVuYWJsZWQgYW5kIG1pbnQgaXMgZGlzYWJsZWQKICAgIGZ1bmN0aW9uIGlzU2VhbGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBvd25lciA9PSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGxhc3RNaW50ZWRUaW1lc3RhbXAoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnModWludDMyKSB7CiAgICAgICAgcmV0dXJuIGFjY291bnRzW19vd25lcl0ubGFzdE1pbnRlZFRpbWVzdGFtcDsKICAgIH0KCiAgICAvLyBDbGFpbSBib251cyBieSByYXcgdG9rZW5zCiAgICBmdW5jdGlvbiBjbGFpbUJvbnVzKGFkZHJlc3MgX293bmVyKSBpbnRlcm5hbHsgICAgICAKICAgICAgICByZXF1aXJlKGlzU2VhbGVkKCkpOwogICAgICAgIGlmIChhY2NvdW50c1tfb3duZXJdLnJhd1Rva2VucyAhPSAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgcmVhbEJhbGFuY2UgPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICAgICAgdWludDI1NiBib251cyA9IHJlYWxCYWxhbmNlCiAgICAgICAgICAgICAgICAuc3ViKGFjY291bnRzW19vd25lcl0uYmFsYW5jZSkKICAgICAgICAgICAgICAgIC5zdWIoYWNjb3VudHNbX293bmVyXS5yYXdUb2tlbnMpOwoKICAgICAgICAgICAgYWNjb3VudHNbX293bmVyXS5iYWxhbmNlID0gcmVhbEJhbGFuY2UudG9VSU5UMTEyKCk7CiAgICAgICAgICAgIGFjY291bnRzW19vd25lcl0ucmF3VG9rZW5zID0gMDsKICAgICAgICAgICAgaWYoYm9udXMgPiAwKXsKICAgICAgICAgICAgICAgIFRyYW5zZmVyKHRoaXMsIF9vd25lciwgYm9udXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFdoYXQgaXMgdGhlIGJhbGFuY2Ugb2YgYSBwYXJ0aWN1bGFyIGFjY291bnQ/CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIGlmIChhY2NvdW50c1tfb3duZXJdLnJhd1Rva2VucyA9PSAwKQogICAgICAgICAgICByZXR1cm4gYWNjb3VudHNbX293bmVyXS5iYWxhbmNlOwoKICAgICAgICBpZiAoYm9udXNPZmZlcmVkID4gMCkgewogICAgICAgICAgICB1aW50MjU2IGJvbnVzID0gYm9udXNPZmZlcmVkCiAgICAgICAgICAgICAgICAgLm11bChhY2NvdW50c1tfb3duZXJdLnJhd1Rva2VucykKICAgICAgICAgICAgICAgICAuZGl2KHN1cHBsaWVzLnJhd1Rva2Vucyk7CgogICAgICAgICAgICByZXR1cm4gYm9udXMuYWRkKGFjY291bnRzW19vd25lcl0uYmFsYW5jZSkKICAgICAgICAgICAgICAgICAgICAuYWRkKGFjY291bnRzW19vd25lcl0ucmF3VG9rZW5zKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHVpbnQyNTYoYWNjb3VudHNbX293bmVyXS5iYWxhbmNlKQogICAgICAgICAgICAuYWRkKGFjY291bnRzW19vd25lcl0ucmF3VG9rZW5zKTsKICAgIH0KCiAgICAvLyBUcmFuc2ZlciB0aGUgYmFsYW5jZSBmcm9tIG93bmVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoaXNTZWFsZWQoKSk7CgogICAgICAgIC8vIGltcGxpY2l0bHkgY2xhaW0gYm9udXMgZm9yIGJvdGggc2VuZGVyIGFuZCByZWNlaXZlcgogICAgICAgIGNsYWltQm9udXMobXNnLnNlbmRlcik7CiAgICAgICAgY2xhaW1Cb251cyhfdG8pOwoKICAgICAgICAvLyBhY2NvcmRpbmcgdG8gVkVOJ3MgdG90YWwgc3VwcGx5LCBuZXZlciBvdmVyZmxvdyBoZXJlCiAgICAgICAgaWYgKGFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPj0gX2Ftb3VudAogICAgICAgICAgICAmJiBfYW1vdW50ID4gMCkgeyAgICAgICAgICAgIAogICAgICAgICAgICBhY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlIC09IHVpbnQxMTIoX2Ftb3VudCk7CiAgICAgICAgICAgIGFjY291bnRzW190b10uYmFsYW5jZSA9IF9hbW91bnQuYWRkKGFjY291bnRzW190b10uYmFsYW5jZSkudG9VSU5UMTEyKCk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8KICAgIC8vIFRoZSB0cmFuc2ZlckZyb20gbWV0aG9kIGlzIHVzZWQgZm9yIGEgd2l0aGRyYXcgd29ya2Zsb3csIGFsbG93aW5nIGNvbnRyYWN0cyB0byBzZW5kCiAgICAvLyB0b2tlbnMgb24geW91ciBiZWhhbGYsIGZvciBleGFtcGxlIHRvICJkZXBvc2l0IiB0byBhIGNvbnRyYWN0IGFkZHJlc3MgYW5kL29yIHRvIGNoYXJnZQogICAgLy8gZmVlcyBpbiBzdWItY3VycmVuY2llczsgdGhlIGNvbW1hbmQgc2hvdWxkIGZhaWwgdW5sZXNzIHRoZSBfZnJvbSBhY2NvdW50IGhhcwogICAgLy8gZGVsaWJlcmF0ZWx5IGF1dGhvcml6ZWQgdGhlIHNlbmRlciBvZiB0aGUgbWVzc2FnZSB2aWEgc29tZSBtZWNoYW5pc207IHdlIHByb3Bvc2UKICAgIC8vIHRoZXNlIHN0YW5kYXJkaXplZCBBUElzIGZvciBhcHByb3ZhbDoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGlzU2VhbGVkKCkpOwoKICAgICAgICAvLyBpbXBsaWNpdGx5IGNsYWltIGJvbnVzIGZvciBib3RoIHNlbmRlciBhbmQgcmVjZWl2ZXIKICAgICAgICBjbGFpbUJvbnVzKF9mcm9tKTsKICAgICAgICBjbGFpbUJvbnVzKF90byk7CgogICAgICAgIC8vIGFjY29yZGluZyB0byBWRU4ncyB0b3RhbCBzdXBwbHksIG5ldmVyIG92ZXJmbG93IGhlcmUKICAgICAgICBpZiAoYWNjb3VudHNbX2Zyb21dLmJhbGFuY2UgPj0gX2Ftb3VudAogICAgICAgICAgICAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfYW1vdW50CiAgICAgICAgICAgICYmIF9hbW91bnQgPiAwKSB7CiAgICAgICAgICAgIGFjY291bnRzW19mcm9tXS5iYWxhbmNlIC09IHVpbnQxMTIoX2Ftb3VudCk7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgICAgIGFjY291bnRzW190b10uYmFsYW5jZSA9IF9hbW91bnQuYWRkKGFjY291bnRzW190b10uYmFsYW5jZSkudG9VSU5UMTEyKCk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEFsbG93IF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20geW91ciBhY2NvdW50LCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQuCiAgICAvLyBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qIEFwcHJvdmVzIGFuZCB0aGVuIGNhbGxzIHRoZSByZWNlaXZpbmcgY29udHJhY3QgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgLy9jYWxsIHRoZSByZWNlaXZlQXBwcm92YWwgZnVuY3Rpb24gb24gdGhlIGNvbnRyYWN0IHlvdSB3YW50IHRvIGJlIG5vdGlmaWVkLiBUaGlzIGNyYWZ0cyB0aGUgZnVuY3Rpb24gc2lnbmF0dXJlIG1hbnVhbGx5IHNvIG9uZSBkb2Vzbid0IGhhdmUgdG8gaW5jbHVkZSBhIGNvbnRyYWN0IGluIGhlcmUganVzdCBmb3IgdGhpcy4KICAgICAgICAvL3JlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW5Db250cmFjdCwgYnl0ZXMgX2V4dHJhRGF0YSkKICAgICAgICAvL2l0IGlzIGFzc3VtZWQgdGhhdCB3aGVuIGRvZXMgdGhpcyB0aGF0IHRoZSBjYWxsICpzaG91bGQqIHN1Y2NlZWQsIG90aGVyd2lzZSBvbmUgd291bGQgdXNlIHZhbmlsbGEgYXBwcm92ZSBpbnN0ZWFkLgogICAgICAgIC8vaWYoIV9zcGVuZGVyLmNhbGwoYnl0ZXM0KGJ5dGVzMzIoc2hhMygicmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MsdWludDI1NixhZGRyZXNzLGJ5dGVzKSIpKSksIG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSkpIHsgcmV2ZXJ0KCk7IH0KICAgICAgICBBcHByb3ZhbFJlY2VpdmVyKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwobXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8gTWludCB0b2tlbnMgYW5kIGFzc2lnbiB0byBzb21lIG9uZQogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfYW1vdW50LCBib29sIF9pc1JhdywgdWludDMyIHRpbWVzdGFtcCkgb25seU93bmVyewogICAgICAgIGlmIChfaXNSYXcpIHsKICAgICAgICAgICAgYWNjb3VudHNbX293bmVyXS5yYXdUb2tlbnMgPSBfYW1vdW50LmFkZChhY2NvdW50c1tfb3duZXJdLnJhd1Rva2VucykudG9VSU5UMTEyKCk7CiAgICAgICAgICAgIHN1cHBsaWVzLnJhd1Rva2VucyA9IF9hbW91bnQuYWRkKHN1cHBsaWVzLnJhd1Rva2VucykudG9VSU5UMTI4KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWNjb3VudHNbX293bmVyXS5iYWxhbmNlID0gX2Ftb3VudC5hZGQoYWNjb3VudHNbX293bmVyXS5iYWxhbmNlKS50b1VJTlQxMTIoKTsKICAgICAgICB9CgogICAgICAgIGFjY291bnRzW19vd25lcl0ubGFzdE1pbnRlZFRpbWVzdGFtcCA9IHRpbWVzdGFtcDsKCiAgICAgICAgc3VwcGxpZXMudG90YWwgPSBfYW1vdW50LmFkZChzdXBwbGllcy50b3RhbCkudG9VSU5UMTI4KCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsKICAgIH0KICAgIAogICAgLy8gT2ZmZXIgYm9udXMgdG8gcmF3IHRva2VucyBob2xkZXIKICAgIGZ1bmN0aW9uIG9mZmVyQm9udXModWludDI1NiBfYm9udXMpIG9ubHlPd25lciB7IAogICAgICAgIGJvbnVzT2ZmZXJlZCA9IGJvbnVzT2ZmZXJlZC5hZGQoX2JvbnVzKTsKICAgICAgICBzdXBwbGllcy50b3RhbCA9IF9ib251cy5hZGQoc3VwcGxpZXMudG90YWwpLnRvVUlOVDEyOCgpOwogICAgICAgIFRyYW5zZmVyKDAsIHRoaXMsIF9ib251cyk7CiAgICB9CgogICAgLy8gU2V0IG93bmVyIHRvIHplcm8gYWRkcmVzcywgdG8gZGlzYWJsZSBtaW50LCBhbmQgZW5hYmxlIHRva2VuIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBzZWFsKCkgb25seU93bmVyIHsKICAgICAgICBzZXRPd25lcigwKTsKICAgIH0KfQoKY29udHJhY3QgQXBwcm92YWxSZWNlaXZlciB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpOwp9CgoKLy8gQ29udHJhY3QgdG8gc2VsbCBhbmQgZGlzdHJpYnV0ZSBWRU4gdG9rZW5zCmNvbnRyYWN0IFZFTlNhbGUgaXMgT3duZWR7CgogICAgLy8vIGNoYXJ0IG9mIHN0YWdlIHRyYW5zaXRpb24gCiAgICAvLy8KICAgIC8vLyBkZXBsb3kgICBpbml0aWFsaXplICAgICAgc3RhcnRUaW1lICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFRpbWUgICAgICAgICAgICAgICAgIGZpbmFsaXplCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IDwtZWFybHlTdGFnZUxhc3RzLT4gfCAgICAgICAgICAgICB8IDwtIGNsb3NlZFN0YWdlTGFzdHMgLT4gfAogICAgLy8vICBPLS0tLS0tLS0tLS1PLS0tLS0tLS0tLS0tLS0tTy0tLS0tLS0tLS0tLS0tLS0tLS0tLU8tLS0tLS0tLS0tLS0tTy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLU8tLS0tLS0tLS0tLS0+CiAgICAvLy8gICAgIENyZWF0ZWQgICAgIEluaXRpYWxpemVkICAgICAgICAgICBFYXJseSAgICAgICAgICAgICBOb3JtYWwgICAgICAgICAgICAgQ2xvc2VkICAgICAgICAgICAgRmluYWxpemVkCiAgICBlbnVtIFN0YWdlIHsKICAgICAgICBOb3RDcmVhdGVkLAogICAgICAgIENyZWF0ZWQsCiAgICAgICAgSW5pdGlhbGl6ZWQsCiAgICAgICAgRWFybHksCiAgICAgICAgTm9ybWFsLAogICAgICAgIENsb3NlZCwKICAgICAgICBGaW5hbGl6ZWQKICAgIH0KCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG90YWxTdXBwbHkgICAgICAgICA9ICgxMCAqKiA5KSAqICgxMCAqKiAxOCk7IC8vIDEgYmlsbGlvbiBWRU4sIGRlY2ltYWxzIHNldCB0byAxOAoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHJpdmF0ZVN1cHBseSAgICAgICAgICAgICAgPSB0b3RhbFN1cHBseSAqIDkgLyAxMDA7ICAvLyA5JSBmb3IgcHJpdmF0ZSBJQ08KICAgIHVpbnQyNTYgY29uc3RhbnQgY29tbWVyY2lhbFBsYW4gICAgICAgICAgICAgPSB0b3RhbFN1cHBseSAqIDIzIC8gMTAwOyAvLyAyMyUgZm9yIGNvbW1lcmNpYWwgcGxhbgogICAgdWludDI1NiBjb25zdGFudCByZXNlcnZlZEZvclRlYW0gICAgICAgICAgICA9IHRvdGFsU3VwcGx5ICogNSAvIDEwMDsgIC8vIDUlIGZvciB0ZWFtCiAgICB1aW50MjU2IGNvbnN0YW50IHJlc2VydmVkRm9yT3BlcmF0aW9ucyAgICAgID0gdG90YWxTdXBwbHkgKiAyMiAvIDEwMDsgLy8gMjIgZm9yIG9wZXJhdGlvbnMKCiAgICAvLyA1OSUKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG5vblB1YmxpY1N1cHBseSAgICAgPSBwcml2YXRlU3VwcGx5ICsgY29tbWVyY2lhbFBsYW4gKyByZXNlcnZlZEZvclRlYW0gKyByZXNlcnZlZEZvck9wZXJhdGlvbnM7CiAgICAvLyA0MSUKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHB1YmxpY1N1cHBseSA9IHRvdGFsU3VwcGx5IC0gbm9uUHVibGljU3VwcGx5OwoKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBvZmZpY2lhbExpbWl0ID0gNjQzNzE4MjUgKiAoMTAgKiogMTgpOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgY2hhbm5lbHNMaW1pdCA9IHB1YmxpY1N1cHBseSAtIG9mZmljaWFsTGltaXQ7CgogICAgLy8gcGFja2VkIHRvIDI1NmJpdAogICAgc3RydWN0IFNvbGRPdXQgewogICAgICAgIHVpbnQxNiBwbGFjZWhvbGRlcjsgLy8gcGxhY2Vob2xkZXIgdG8gbWFrZSBzdHJ1Y3QgcHJlLWFsbG9jZWQKCiAgICAgICAgLy8gYW1vdW50IG9mIHRva2VucyBvZmZpY2lhbGx5IHNvbGQgb3V0LgogICAgICAgIC8vIG1heCB2YWx1ZSBvZiAxMjBiaXQgaXMgYWJvdXQgMWUzNiwgaXQncyBlbm91Z2ggZm9yIHRva2VuIGFtb3VudAogICAgICAgIHVpbnQxMjAgb2ZmaWNpYWw7IAoKICAgICAgICB1aW50MTIwIGNoYW5uZWxzOyAvLyBhbW91bnQgb2YgdG9rZW5zIHNvbGQgb3V0IHZpYSBjaGFubmVscwogICAgfQoKICAgIFNvbGRPdXQgc29sZE91dDsKICAgIAogICAgdWludDI1NiBjb25zdGFudCB2ZW5QZXJFdGggPSAzNTAwOyAgLy8gbm9ybWFsIGV4Y2hhbmdlIHJhdGUKICAgIHVpbnQyNTYgY29uc3RhbnQgdmVuUGVyRXRoRWFybHlTdGFnZSA9IHZlblBlckV0aCArIHZlblBlckV0aCAqIDE1IC8gMTAwOyAgLy8gZWFybHkgc3RhZ2UgaGFzIDE1JSByZXdhcmQKCiAgICB1aW50IGNvbnN0YW50IG1pbkJ1eUludGVydmFsID0gMzAgbWludXRlczsgLy8gZWFjaCBhY2NvdW50IGNhbiBidXkgb25jZSBpbiAzMCBtaW51dGVzCiAgICB1aW50IGNvbnN0YW50IG1heEJ1eUV0aEFtb3VudCA9IDMwIGV0aGVyOwogICAKICAgIFZFTiB2ZW47IC8vIFZFTiB0b2tlbiBjb250cmFjdCBmb2xsb3dzIEVSQzIwIHN0YW5kYXJkCgogICAgYWRkcmVzcyBldGhWYXVsdDsgLy8gdGhlIGFjY291bnQgdG8ga2VlcCByZWNlaXZlZCBldGhlcgogICAgYWRkcmVzcyB2ZW5WYXVsdDsgLy8gdGhlIGFjY291bnQgdG8ga2VlcCBub24tcHVibGljIG9mZmVyZWQgVkVOIHRva2VucwoKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IHN0YXJ0VGltZSA9IDE1MDMwNTc2MDA7IC8vIHRpbWUgdG8gc3RhcnQgc2FsZQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgZW5kVGltZSA9IDE1MDQxODA4MDA7ICAgLy8gdGllbSB0byBjbG9zZSBzYWxlCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBlYXJseVN0YWdlTGFzdHMgPSAzIGRheXM7IC8vIGVhcmx5IGJpcmQgc3RhZ2UgbGFzdHMgaW4gc2Vjb25kcwoKICAgIGJvb2wgaW5pdGlhbGl6ZWQ7CiAgICBib29sIGZpbmFsaXplZDsKCiAgICBmdW5jdGlvbiBWRU5TYWxlKCkgewogICAgICAgIHNvbGRPdXQucGxhY2Vob2xkZXIgPSAxOwogICAgfSAgICAKCiAgICAvLy8gQG5vdGljZSBjYWxjdWx0ZSBleGNoYW5nZSByYXRlIGFjY29yZGluZyB0byBjdXJyZW50IHN0YWdlCiAgICAvLy8gQHJldHVybiBleGNoYW5nZSByYXRlLiB6ZXJvIGlmIG5vdCBpbiBzYWxlLgogICAgZnVuY3Rpb24gZXhjaGFuZ2VSYXRlKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgaWYgKHN0YWdlKCkgPT0gU3RhZ2UuRWFybHkpIHsKICAgICAgICAgICAgcmV0dXJuIHZlblBlckV0aEVhcmx5U3RhZ2U7CiAgICAgICAgfQogICAgICAgIGlmIChzdGFnZSgpID09IFN0YWdlLk5vcm1hbCkgewogICAgICAgICAgICByZXR1cm4gdmVuUGVyRXRoOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBmb3IgdGVzdCBwdXJwb3NlCiAgICBmdW5jdGlvbiBibG9ja1RpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MzIpIHsKICAgICAgICByZXR1cm4gdWludDMyKGJsb2NrLnRpbWVzdGFtcCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgZXN0aW1hdGUgc3RhZ2UKICAgIC8vLyBAcmV0dXJuIGN1cnJlbnQgc3RhZ2UKICAgIGZ1bmN0aW9uIHN0YWdlKCkgY29uc3RhbnQgcmV0dXJucyAoU3RhZ2UpIHsgCiAgICAgICAgaWYgKGZpbmFsaXplZCkgewogICAgICAgICAgICByZXR1cm4gU3RhZ2UuRmluYWxpemVkOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpbml0aWFsaXplZCkgewogICAgICAgICAgICAvLyBkZXBsb3llZCBidXQgbm90IGluaXRpYWxpemVkCiAgICAgICAgICAgIHJldHVybiBTdGFnZS5DcmVhdGVkOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJsb2NrVGltZSgpIDwgc3RhcnRUaW1lKSB7CiAgICAgICAgICAgIC8vIG5vdCBzdGFydGVkIHlldAogICAgICAgICAgICByZXR1cm4gU3RhZ2UuSW5pdGlhbGl6ZWQ7CiAgICAgICAgfQoKICAgICAgICBpZiAodWludDI1Nihzb2xkT3V0Lm9mZmljaWFsKS5hZGQoc29sZE91dC5jaGFubmVscykgPj0gcHVibGljU3VwcGx5KSB7CiAgICAgICAgICAgIC8vIGFsbCBzb2xkIG91dAogICAgICAgICAgICByZXR1cm4gU3RhZ2UuQ2xvc2VkOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJsb2NrVGltZSgpIDwgZW5kVGltZSkgewogICAgICAgICAgICAvLyBpbiBzYWxlICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChibG9ja1RpbWUoKSA8IHN0YXJ0VGltZS5hZGQoZWFybHlTdGFnZUxhc3RzKSkgewogICAgICAgICAgICAgICAgLy8gZWFybHkgYmlyZCBzdGFnZQogICAgICAgICAgICAgICAgcmV0dXJuIFN0YWdlLkVhcmx5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIG5vcm1hbCBzdGFnZQogICAgICAgICAgICByZXR1cm4gU3RhZ2UuTm9ybWFsOwogICAgICAgIH0KCiAgICAgICAgLy8gY2xvc2VkCiAgICAgICAgcmV0dXJuIFN0YWdlLkNsb3NlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemUgPiAwOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGVudHJ5IHRvIGJ1eSB0b2tlbnMKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgeyAgICAgICAgCiAgICAgICAgYnV5KCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgZW50cnkgdG8gYnV5IHRva2VucwogICAgZnVuY3Rpb24gYnV5KCkgcGF5YWJsZSB7CiAgICAgICAgLy8gcmVqZWN0IGNvbnRyYWN0IGJ1eWVyIHRvIGF2b2lkIGJyZWFraW5nIGludGVydmFsIGxpbWl0CiAgICAgICAgcmVxdWlyZSghaXNDb250cmFjdChtc2cuc2VuZGVyKSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gMC4wMSBldGhlcik7CgogICAgICAgIHVpbnQyNTYgcmF0ZSA9IGV4Y2hhbmdlUmF0ZSgpOwogICAgICAgIC8vIGhlcmUgZG9uJ3QgbmVlZCB0byBjaGVjayBzdGFnZS4gcmF0ZSBpcyBvbmx5IHZhbGlkIHdoZW4gaW4gc2FsZQogICAgICAgIHJlcXVpcmUocmF0ZSA+IDApOwogICAgICAgIC8vIGVhY2ggYWNjb3VudCBpcyBhbGxvd2VkIG9uY2UgaW4gbWluQnV5SW50ZXJ2YWwKICAgICAgICByZXF1aXJlKGJsb2NrVGltZSgpID49IHZlbi5sYXN0TWludGVkVGltZXN0YW1wKG1zZy5zZW5kZXIpICsgbWluQnV5SW50ZXJ2YWwpOwoKICAgICAgICB1aW50MjU2IHJlcXVlc3RlZDsKICAgICAgICAvLyBhbmQgbGltaXRlZCB0byBtYXhCdXlFdGhBbW91bnQKICAgICAgICBpZiAobXNnLnZhbHVlID4gbWF4QnV5RXRoQW1vdW50KSB7CiAgICAgICAgICAgIHJlcXVlc3RlZCA9IG1heEJ1eUV0aEFtb3VudC5tdWwocmF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWVzdGVkID0gbXNnLnZhbHVlLm11bChyYXRlKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcmVtYWluZWQgPSBvZmZpY2lhbExpbWl0LnN1Yihzb2xkT3V0Lm9mZmljaWFsKTsKICAgICAgICBpZiAocmVxdWVzdGVkID4gcmVtYWluZWQpIHsKICAgICAgICAgICAgLy9leGNlZWQgcmVtYWluZWQKICAgICAgICAgICAgcmVxdWVzdGVkID0gcmVtYWluZWQ7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGV0aENvc3QgPSByZXF1ZXN0ZWQuZGl2KHJhdGUpOwogICAgICAgIGlmIChyZXF1ZXN0ZWQgPiAwKSB7CiAgICAgICAgICAgIHZlbi5taW50KG1zZy5zZW5kZXIsIHJlcXVlc3RlZCwgdHJ1ZSwgYmxvY2tUaW1lKCkpOwogICAgICAgICAgICAvLyB0cmFuc2ZlciBFVEggdG8gdmF1bHQKICAgICAgICAgICAgZXRoVmF1bHQudHJhbnNmZXIoZXRoQ29zdCk7CgogICAgICAgICAgICBzb2xkT3V0Lm9mZmljaWFsID0gcmVxdWVzdGVkLmFkZChzb2xkT3V0Lm9mZmljaWFsKS50b1VJTlQxMjAoKTsKICAgICAgICAgICAgb25Tb2xkKG1zZy5zZW5kZXIsIHJlcXVlc3RlZCwgZXRoQ29zdCk7ICAgICAgICAKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdG9SZXR1cm4gPSBtc2cudmFsdWUuc3ViKGV0aENvc3QpOwogICAgICAgIGlmKHRvUmV0dXJuID4gMCkgewogICAgICAgICAgICAvLyByZXR1cm4gb3ZlciBwYXllZCBFVEgKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih0b1JldHVybik7CiAgICAgICAgfSAgICAgICAgCiAgICB9CgogICAgLy8vIEBub3RpY2UgcmV0dXJucyB0b2tlbnMgc29sZCBvZmZpY2lhbGx5CiAgICBmdW5jdGlvbiBvZmZpY2lhbFNvbGQoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNvbGRPdXQub2ZmaWNpYWw7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcmV0dXJucyB0b2tlbnMgc29sZCB2aWEgY2hhbm5lbHMKICAgIGZ1bmN0aW9uIGNoYW5uZWxzU29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc29sZE91dC5jaGFubmVsczsKICAgIH0gCgogICAgLy8vIEBub3RpY2UgbWFudWFsbHkgb2ZmZXIgdG9rZW5zIHRvIGNoYW5uZWwKICAgIGZ1bmN0aW9uIG9mZmVyVG9DaGFubmVsKGFkZHJlc3MgX2NoYW5uZWxBY2NvdW50LCB1aW50MjU2IF92ZW5BbW91bnQpIG9ubHlPd25lciB7CiAgICAgICAgU3RhZ2Ugc3RnID0gc3RhZ2UoKTsKICAgICAgICAvLyBzaW5jZSB0aGUgc2V0dGxlbWVudCBtYXkgYmUgZGVsYXllZCwgc28gaXQncyBhbGxvd2VkIGluIGNsb3NlZCBzdGFnZQogICAgICAgIHJlcXVpcmUoc3RnID09IFN0YWdlLkVhcmx5IHx8IHN0ZyA9PSBTdGFnZS5Ob3JtYWwgfHwgc3RnID09IFN0YWdlLkNsb3NlZCk7CgogICAgICAgIHNvbGRPdXQuY2hhbm5lbHMgPSBfdmVuQW1vdW50LmFkZChzb2xkT3V0LmNoYW5uZWxzKS50b1VJTlQxMjAoKTsKCiAgICAgICAgLy9zaG91bGQgbm90IGV4Y2VlZCBsaW1pdAogICAgICAgIHJlcXVpcmUoc29sZE91dC5jaGFubmVscyA8PSBjaGFubmVsc0xpbWl0KTsKCiAgICAgICAgdmVuLm1pbnQoCiAgICAgICAgICAgIF9jaGFubmVsQWNjb3VudCwKICAgICAgICAgICAgX3ZlbkFtb3VudCwKICAgICAgICAgICAgdHJ1ZSwgIC8vIHVuc29sZCB0b2tlbnMgY2FuIGJlIGNsYWltZWQgYnkgY2hhbm5lbHMgcG9ydGlvbgogICAgICAgICAgICBibG9ja1RpbWUoKQogICAgICAgICAgICApOwoKICAgICAgICBvblNvbGQoX2NoYW5uZWxBY2NvdW50LCBfdmVuQW1vdW50LCAwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBpbml0aWFsaXplIHRvIHByZXBhcmUgZm9yIHNhbGUKICAgIC8vLyBAcGFyYW0gX3ZlbiBUaGUgYWRkcmVzcyBWRU4gdG9rZW4gY29udHJhY3QgZm9sbG93aW5nIEVSQzIwIHN0YW5kYXJkCiAgICAvLy8gQHBhcmFtIF9ldGhWYXVsdCBUaGUgcGxhY2UgdG8gc3RvcmUgcmVjZWl2ZWQgRVRICiAgICAvLy8gQHBhcmFtIF92ZW5WYXVsdCBUaGUgcGxhY2UgdG8gc3RvcmUgbm9uLXB1YmxpY2x5IHN1cHBsaWVkIFZFTiB0b2tlbnMKICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoCiAgICAgICAgVkVOIF92ZW4sCiAgICAgICAgYWRkcmVzcyBfZXRoVmF1bHQsCiAgICAgICAgYWRkcmVzcyBfdmVuVmF1bHQpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShzdGFnZSgpID09IFN0YWdlLkNyZWF0ZWQpOwoKICAgICAgICAvLyBvd25lcnNoaXAgb2YgdG9rZW4gY29udHJhY3Qgc2hvdWxkIGFscmVhZHkgYmUgdGhpcwogICAgICAgIHJlcXVpcmUoX3Zlbi5vd25lcigpID09IGFkZHJlc3ModGhpcykpOwoKICAgICAgICByZXF1aXJlKGFkZHJlc3MoX2V0aFZhdWx0KSAhPSAwKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoX3ZlblZhdWx0KSAhPSAwKTsgICAgICAKCiAgICAgICAgdmVuID0gX3ZlbjsKICAgICAgICAKICAgICAgICBldGhWYXVsdCA9IF9ldGhWYXVsdDsKICAgICAgICB2ZW5WYXVsdCA9IF92ZW5WYXVsdDsgICAgCiAgICAgICAgCiAgICAgICAgdmVuLm1pbnQoCiAgICAgICAgICAgIHZlblZhdWx0LAogICAgICAgICAgICByZXNlcnZlZEZvclRlYW0uYWRkKHJlc2VydmVkRm9yT3BlcmF0aW9ucyksCiAgICAgICAgICAgIGZhbHNlLCAvLyB0ZWFtIGFuZCBvcGVyYXRpb25zIHJlc2VydmVkIHBvcnRpb24gY2FuJ3Qgc2hhcmUgdW5zb2xkIHRva2VucwogICAgICAgICAgICBibG9ja1RpbWUoKQogICAgICAgICk7CgogICAgICAgIHZlbi5taW50KAogICAgICAgICAgICB2ZW5WYXVsdCwKICAgICAgICAgICAgcHJpdmF0ZVN1cHBseS5hZGQoY29tbWVyY2lhbFBsYW4pLAogICAgICAgICAgICB0cnVlLCAvLyBwcml2YXRlIElDTyBhbmQgY29tbWVyY2lhbCBwbGFuIGNhbiBzaGFyZSB1bnNvbGQgdG9rZW5zCiAgICAgICAgICAgIGJsb2NrVGltZSgpCiAgICAgICAgKTsKCiAgICAgICAgaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgIG9uSW5pdGlhbGl6ZWQoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBmaW5hbGl6ZQogICAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgewogICAgICAgIC8vIG9ubHkgYWZ0ZXIgY2xvc2VkIHN0YWdlCiAgICAgICAgcmVxdWlyZShzdGFnZSgpID09IFN0YWdlLkNsb3NlZCk7ICAgICAgIAoKICAgICAgICB1aW50MjU2IHVuc29sZCA9IHB1YmxpY1N1cHBseS5zdWIoc29sZE91dC5vZmZpY2lhbCkuc3ViKHNvbGRPdXQuY2hhbm5lbHMpOwoKICAgICAgICBpZiAodW5zb2xkID4gMCkgewogICAgICAgICAgICAvLyB1bnNvbGQgVkVOIGFzIGJvbnVzCiAgICAgICAgICAgIHZlbi5vZmZlckJvbnVzKHVuc29sZCk7ICAgICAgICAKICAgICAgICB9CiAgICAgICAgdmVuLnNlYWwoKTsKCiAgICAgICAgZmluYWxpemVkID0gdHJ1ZTsKICAgICAgICBvbkZpbmFsaXplZCgpOwogICAgfQoKICAgIGV2ZW50IG9uSW5pdGlhbGl6ZWQoKTsKICAgIGV2ZW50IG9uRmluYWxpemVkKCk7CgogICAgZXZlbnQgb25Tb2xkKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiB2ZW5BbW91bnQsIHVpbnQyNTYgZXRoQ29zdCk7Cn0='.
	

]
