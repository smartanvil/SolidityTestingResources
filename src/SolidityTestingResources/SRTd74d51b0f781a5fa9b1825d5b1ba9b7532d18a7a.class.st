Class {
	#name : #SRTd74d51b0f781a5fa9b1825d5b1ba9b7532d18a7a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd74d51b0f781a5fa9b1825d5b1ba9b7532d18a7a >> base64 [
	^ 'LyoKICogQHRpdGxlIFN0cmluZyAmIHNsaWNlIHV0aWxpdHkgbGlicmFyeSBmb3IgU29saWRpdHkgY29udHJhY3RzLgogKiBAYXV0aG9yIE5pY2sgSm9obnNvbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI4ZWVmZmNlZmVkZTZlMGU3ZWFjZWUwZTFmYWVhZTFmYWEwZTBlYmZhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KICoKICogQGRldiBGdW5jdGlvbmFsaXR5IGluIHRoaXMgbGlicmFyeSBpcyBsYXJnZWx5IGltcGxlbWVudGVkIHVzaW5nIGFuCiAqICAgICAgYWJzdHJhY3Rpb24gY2FsbGVkIGEgJ3NsaWNlJy4gQSBzbGljZSByZXByZXNlbnRzIGEgcGFydCBvZiBhIHN0cmluZyAtCiAqICAgICAgYW55dGhpbmcgZnJvbSB0aGUgZW50aXJlIHN0cmluZyB0byBhIHNpbmdsZSBjaGFyYWN0ZXIsIG9yIGV2ZW4gbm8KICogICAgICBjaGFyYWN0ZXJzIGF0IGFsbCAoYSAwLWxlbmd0aCBzbGljZSkuIFNpbmNlIGEgc2xpY2Ugb25seSBoYXMgdG8gc3BlY2lmeQogKiAgICAgIGFuIG9mZnNldCBhbmQgYSBsZW5ndGgsIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyBzbGljZXMgaXMgYSBsb3QgbGVzcwogKiAgICAgIGV4cGVuc2l2ZSB0aGFuIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyB0aGUgc3RyaW5ncyB0aGV5IHJlZmVyZW5jZS4KICoKICogICAgICBUbyBmdXJ0aGVyIHJlZHVjZSBnYXMgY29zdHMsIG1vc3QgZnVuY3Rpb25zIG9uIHNsaWNlIHRoYXQgbmVlZCB0byByZXR1cm4KICogICAgICBhIHNsaWNlIG1vZGlmeSB0aGUgb3JpZ2luYWwgb25lIGluc3RlYWQgb2YgYWxsb2NhdGluZyBhIG5ldyBvbmU7IGZvcgogKiAgICAgIGluc3RhbmNlLCBgcy5zcGxpdCgiLiIpYCB3aWxsIHJldHVybiB0aGUgdGV4dCB1cCB0byB0aGUgZmlyc3QgJy4nLAogKiAgICAgIG1vZGlmeWluZyBzIHRvIG9ubHkgY29udGFpbiB0aGUgcmVtYWluZGVyIG9mIHRoZSBzdHJpbmcgYWZ0ZXIgdGhlICcuJy4KICogICAgICBJbiBzaXR1YXRpb25zIHdoZXJlIHlvdSBkbyBub3Qgd2FudCB0byBtb2RpZnkgdGhlIG9yaWdpbmFsIHNsaWNlLCB5b3UKICogICAgICBjYW4gbWFrZSBhIGNvcHkgZmlyc3Qgd2l0aCBgLmNvcHkoKWAsIGZvciBleGFtcGxlOgogKiAgICAgIGBzLmNvcHkoKS5zcGxpdCgiLiIpYC4gVHJ5IGFuZCBhdm9pZCB1c2luZyB0aGlzIGlkaW9tIGluIGxvb3BzOyBzaW5jZQogKiAgICAgIFNvbGlkaXR5IGhhcyBubyBtZW1vcnkgbWFuYWdlbWVudCwgaXQgd2lsbCByZXN1bHQgaW4gYWxsb2NhdGluZyBtYW55CiAqICAgICAgc2hvcnQtbGl2ZWQgc2xpY2VzIHRoYXQgYXJlIGxhdGVyIGRpc2NhcmRlZC4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCByZXR1cm4gdHdvIHNsaWNlcyBjb21lIGluIHR3byB2ZXJzaW9uczogYSBub24tYWxsb2NhdGluZwogKiAgICAgIHZlcnNpb24gdGhhdCB0YWtlcyB0aGUgc2Vjb25kIHNsaWNlIGFzIGFuIGFyZ3VtZW50LCBtb2RpZnlpbmcgaXQgaW4KICogICAgICBwbGFjZSwgYW5kIGFuIGFsbG9jYXRpbmcgdmVyc2lvbiB0aGF0IGFsbG9jYXRlcyBhbmQgcmV0dXJucyB0aGUgc2Vjb25kCiAqICAgICAgc2xpY2U7IHNlZSBgbmV4dFJ1bmVgIGZvciBleGFtcGxlLgogKgogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IGhhdmUgdG8gY29weSBzdHJpbmcgZGF0YSB3aWxsIHJldHVybiBzdHJpbmdzIHJhdGhlciB0aGFuCiAqICAgICAgc2xpY2VzOyB0aGVzZSBjYW4gYmUgY2FzdCBiYWNrIHRvIHNsaWNlcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nIGlmCiAqICAgICAgcmVxdWlyZWQuCiAqCiAqICAgICAgRm9yIGNvbnZlbmllbmNlLCBzb21lIGZ1bmN0aW9ucyBhcmUgcHJvdmlkZWQgd2l0aCBub24tbW9kaWZ5aW5nCiAqICAgICAgdmFyaWFudHMgdGhhdCBjcmVhdGUgYSBuZXcgc2xpY2UgYW5kIHJldHVybiBib3RoOyBmb3IgaW5zdGFuY2UsCiAqICAgICAgYHMuc3BsaXROZXcoJy4nKWAgbGVhdmVzIHMgdW5tb2RpZmllZCwgYW5kIHJldHVybnMgdHdvIHZhbHVlcwogKiAgICAgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxlZnQgYW5kIHJpZ2h0IHBhcnRzIG9mIHRoZSBzdHJpbmcuCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuNzsKCmxpYnJhcnkgc3RyaW5ncyB7CiAgICBzdHJ1Y3Qgc2xpY2UgewogICAgICAgIHVpbnQgX2xlbjsKICAgICAgICB1aW50IF9wdHI7CiAgICB9CgogICAgZnVuY3Rpb24gbWVtY3B5KHVpbnQgZGVzdCwgdWludCBzcmMsIHVpbnQgbGVuKSBwcml2YXRlIHsKICAgICAgICAvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShkZXN0LCBtbG9hZChzcmMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlc3QgKz0gMzI7CiAgICAgICAgICAgIHNyYyArPSAzMjsKICAgICAgICB9CgogICAgICAgIC8vIENvcHkgcmVtYWluaW5nIGJ5dGVzCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKHNyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykKICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc3RyaW5nIHRvIG1ha2UgYSBzbGljZSBmcm9tLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICovCiAgICBmdW5jdGlvbiB0b1NsaWNlKHN0cmluZyBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBvZiBhIG51bGwtdGVybWluYXRlZCBieXRlczMyIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSB2YWx1ZSB0byBmaW5kIHRoZSBsZW5ndGggb2YuCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHN0cmluZywgZnJvbSAwIHRvIDMyLgogICAgICovCiAgICBmdW5jdGlvbiBsZW4oYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCByZXQ7CiAgICAgICAgaWYgKHNlbGYgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDE2OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSA4OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSA0OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAyOwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMzIgLSByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBieXRlczMyLCBpbnRlcnByZXRlZCBhcyBhCiAgICAgKiAgICAgIG51bGwtdGVybWludGFlZCB1dGYtOCBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgYnl0ZXMzMiB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc2xpY2UuCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCBhcmd1bWVudCB1cCB0byB0aGUKICAgICAqICAgICAgICAgZmlyc3QgbnVsbC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TbGljZUIzMihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgewogICAgICAgIC8vIEFsbG9jYXRlIHNwYWNlIGZvciBgc2VsZmAgaW4gbWVtb3J5LCBjb3B5IGl0IHRoZXJlLCBhbmQgcG9pbnQgcmV0IGF0IGl0CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgcHRyIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZSgweDQwLCBhZGQocHRyLCAweDIwKSkKICAgICAgICAgICAgbXN0b3JlKHB0ciwgc2VsZikKICAgICAgICAgICAgbXN0b3JlKGFkZChyZXQsIDB4MjApLCBwdHIpCiAgICAgICAgfQogICAgICAgIHJldC5fbGVuID0gbGVuKHNlbGYpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIHRoZSBjdXJyZW50IHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvcHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICByZXR1cm4gc2xpY2Uoc2VsZi5fbGVuLCBzZWxmLl9wdHIpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IENvcGllcyBhIHNsaWNlIHRvIGEgbmV3IHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgc2xpY2UncyB0ZXh0LgogICAgICovCiAgICBmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBpbiBydW5lcyBvZiB0aGUgc2xpY2UuIE5vdGUgdGhhdCB0aGlzIG9wZXJhdGlvbgogICAgICogICAgICB0YWtlcyB0aW1lIHByb3BvcnRpb25hbCB0byB0aGUgbGVuZ3RoIG9mIHRoZSBzbGljZTsgYXZvaWQgdXNpbmcgaXQKICAgICAqICAgICAgaW4gbG9vcHMsIGFuZCBjYWxsIGBzbGljZS5lbXB0eSgpYCBpZiB5b3Ugb25seSBuZWVkIHRvIGtub3cgd2hldGhlcgogICAgICogICAgICB0aGUgc2xpY2UgaXMgZW1wdHkgb3Igbm90LgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRoZSBsZW5ndGggb2YgdGhlIHNsaWNlIGluIHJ1bmVzLgogICAgICovCiAgICBmdW5jdGlvbiBsZW4oc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIFN0YXJ0aW5nIGF0IHB0ci0zMSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dAogICAgICAgIHZhciBwdHIgPSBzZWxmLl9wdHIgLSAzMTsKICAgICAgICB2YXIgZW5kID0gcHRyICsgc2VsZi5fbGVuOwogICAgICAgIGZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7CiAgICAgICAgICAgIHVpbnQ4IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQocHRyKSwgMHhGRikgfQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAxOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAyOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAzOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsKICAgICAgICAgICAgICAgIHB0ciArPSA0OwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RkMpIHsKICAgICAgICAgICAgICAgIHB0ciArPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHRyICs9IDY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxlbjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5IChoYXMgYSBsZW5ndGggb2YgMCkuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHksIEZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZW1wdHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzZWxmLl9sZW4gPT0gMDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgcG9zaXRpdmUgbnVtYmVyIGlmIGBvdGhlcmAgY29tZXMgbGV4aWNvZ3JhcGhpY2FsbHkgYWZ0ZXIKICAgICAqICAgICAgYHNlbGZgLCBhIG5lZ2F0aXZlIG51bWJlciBpZiBpdCBjb21lcyBiZWZvcmUsIG9yIHplcm8gaWYgdGhlCiAgICAgKiAgICAgIGNvbnRlbnRzIG9mIHRoZSB0d28gc2xpY2VzIGFyZSBlcXVhbC4gQ29tcGFyaXNvbiBpcyBkb25lIHBlci1ydW5lLAogICAgICogICAgICBvbiB1bmljb2RlIGNvZGVwb2ludHMuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEBwYXJhbSBvdGhlciBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgb2YgdGhlIGNvbXBhcmlzb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbXBhcmUoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIHVpbnQgc2hvcnRlc3QgPSBzZWxmLl9sZW47CiAgICAgICAgaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pCiAgICAgICAgICAgIHNob3J0ZXN0ID0gb3RoZXIuX2xlbjsKCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHI7CiAgICAgICAgdmFyIG90aGVycHRyID0gb3RoZXIuX3B0cjsKICAgICAgICBmb3IgKHVpbnQgaWR4ID0gMDsgaWR4IDwgc2hvcnRlc3Q7IGlkeCArPSAzMikgewogICAgICAgICAgICB1aW50IGE7CiAgICAgICAgICAgIHVpbnQgYjsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgYSA6PSBtbG9hZChzZWxmcHRyKQogICAgICAgICAgICAgICAgYiA6PSBtbG9hZChvdGhlcnB0cikKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYSAhPSBiKSB7CiAgICAgICAgICAgICAgICAvLyBNYXNrIG91dCBpcnJlbGV2YW50IGJ5dGVzIGFuZCBjaGVjayBhZ2FpbgogICAgICAgICAgICAgICAgdWludCBtYXNrID0gfigyICoqICg4ICogKDMyIC0gc2hvcnRlc3QgKyBpZHgpKSAtIDEpOwogICAgICAgICAgICAgICAgdmFyIGRpZmYgPSAoYSAmIG1hc2spIC0gKGIgJiBtYXNrKTsKICAgICAgICAgICAgICAgIGlmIChkaWZmICE9IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChkaWZmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmcHRyICs9IDMyOwogICAgICAgICAgICBvdGhlcnB0ciArPSAzMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGludChzZWxmLl9sZW4pIC0gaW50KG90aGVyLl9sZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIHNsaWNlcyBjb250YWluIHRoZSBzYW1lIHRleHQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlcXVhbHMoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gY29tcGFyZShzZWxmLCBvdGhlcikgPT0gMDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBFeHRyYWN0cyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UgaW50byBgcnVuZWAsIGFkdmFuY2luZyB0aGUKICAgICAqICAgICAgc2xpY2UgdG8gcG9pbnQgdG8gdGhlIG5leHQgcnVuZSBhbmQgcmV0dXJuaW5nIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIHJ1bmUgVGhlIHNsaWNlIHRoYXQgd2lsbCBjb250YWluIHRoZSBmaXJzdCBydW5lLgogICAgICogQHJldHVybiBgcnVuZWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYsIHNsaWNlIHJ1bmUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcnVuZS5fcHRyID0gc2VsZi5fcHRyOwoKICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsKICAgICAgICAgICAgcnVuZS5fbGVuID0gMDsKICAgICAgICAgICAgcmV0dXJuIHJ1bmU7CiAgICAgICAgfQoKICAgICAgICB1aW50IGxlbjsKICAgICAgICB1aW50IGI7CiAgICAgICAgLy8gTG9hZCB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgcnVuZSBpbnRvIHRoZSBMU0JzIG9mIGIKICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHN1YihtbG9hZChhZGQoc2VsZiwgMzIpKSwgMzEpKSwgMHhGRikgfQogICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICBsZW4gPSAxOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICBsZW4gPSAyOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICBsZW4gPSAzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlbiA9IDQ7CiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IHNlbGYuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyICs9IHNlbGYuX2xlbjsKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICAgICAgcmV0dXJuIHJ1bmU7CiAgICAgICAgfQoKICAgICAgICBzZWxmLl9wdHIgKz0gbGVuOwogICAgICAgIHNlbGYuX2xlbiAtPSBsZW47CiAgICAgICAgcnVuZS5fbGVuID0gbGVuOwogICAgICAgIHJldHVybiBydW5lOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlLCBhZHZhbmNpbmcgdGhlIHNsaWNlIHRvIHBvaW50CiAgICAgKiAgICAgIHRvIHRoZSBuZXh0IHJ1bmUuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gQSBzbGljZSBjb250YWluaW5nIG9ubHkgdGhlIGZpcnN0IHJ1bmUgZnJvbSBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgewogICAgICAgIG5leHRSdW5lKHNlbGYsIHJldCk7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG9yZChzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IHJldCkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHVpbnQgd29yZDsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB1aW50IGRpdiA9IDIgKiogMjQ4OwoKICAgICAgICAvLyBMb2FkIHRoZSBydW5lIGludG8gdGhlIE1TQnMgb2YgYgogICAgICAgIGFzc2VtYmx5IHsgd29yZDo9IG1sb2FkKG1sb2FkKGFkZChzZWxmLCAzMikpKSB9CiAgICAgICAgdmFyIGIgPSB3b3JkIC8gZGl2OwogICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICByZXQgPSBiOwogICAgICAgICAgICBsZW4gPSAxOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICByZXQgPSBiICYgMHgxRjsKICAgICAgICAgICAgbGVuID0gMjsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgcmV0ID0gYiAmIDB4MEY7CiAgICAgICAgICAgIGxlbiA9IDM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0ID0gYiAmIDB4MDc7CiAgICAgICAgICAgIGxlbiA9IDQ7CiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgZGl2ID0gZGl2IC8gMjU2OwogICAgICAgICAgICBiID0gKHdvcmQgLyBkaXYpICYgMHhGRjsKICAgICAgICAgICAgaWYgKGIgJiAweEMwICE9IDB4ODApIHsKICAgICAgICAgICAgICAgIC8vIEludmFsaWQgVVRGLTggc2VxdWVuY2UKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldCA9IChyZXQgKiA2NCkgfCAoYiAmIDB4M0YpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guCiAgICAgKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBzbGljZS4KICAgICAqLwogICAgZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByZXQgOj0gc2hhMyhtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpCiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxmLl9wdHIgPT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkKICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQogICAgICogICAgICBiZWdpbm5pbmcgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAKICAgICAqLwogICAgZnVuY3Rpb24gYmV5b25kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsKICAgICAgICBpZiAoc2VsZi5fcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgZW5kcyB3aXRoIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlbmRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsKCiAgICAgICAgaWYgKHNlbGZwdHIgPT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZXF1YWw7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQogICAgICogICAgICBlbmQgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAKICAgICAqLwogICAgZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47CiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7CiAgICAgICAgaWYgKHNlbGZwdHIgIT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxdWFsKSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mCiAgICAvLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBmaXJzdCBieXRlIGFmdGVyIGBzZWxmYCBpZiBub3QgZm91bmQuCiAgICBmdW5jdGlvbiBmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcHRyOwogICAgICAgIHVpbnQgaWR4OwoKICAgICAgICBpZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsKICAgICAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSAzMikgewogICAgICAgICAgICAgICAgLy8gT3B0aW1pemVkIGFzc2VtYmx5IGZvciA2OCBnYXMgcGVyIGJ5dGUgb24gc2hvcnQgc3RyaW5ncwogICAgICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgICAgIGxldCBtYXNrIDo9IG5vdChzdWIoZXhwKDIsIG11bCg4LCBzdWIoMzIsIG5lZWRsZWxlbikpKSwgMSkpCiAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spCiAgICAgICAgICAgICAgICAgICAgbGV0IGVuZCA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHNlbGZwdHIKICAgICAgICAgICAgICAgICAgICBsb29wOgogICAgICAgICAgICAgICAgICAgIGp1bXBpKGV4aXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIDEpCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzZWxmbGVuKQogICAgICAgICAgICAgICAgICAgIGV4aXQ6CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcHRyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcKICAgICAgICAgICAgICAgIGJ5dGVzMzIgaGFzaDsKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICBwdHIgPSBzZWxmcHRyOwogICAgICAgICAgICAgICAgZm9yIChpZHggPSAwOyBpZHggPD0gc2VsZmxlbiAtIG5lZWRsZWxlbjsgaWR4KyspIHsKICAgICAgICAgICAgICAgICAgICBieXRlczMyIHRlc3RIYXNoOwogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgdGVzdEhhc2ggOj0gc2hhMyhwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyOwogICAgICAgICAgICAgICAgICAgIHB0ciArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmcHRyICsgc2VsZmxlbjsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mCiAgICAvLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBhZGRyZXNzIG9mIGBzZWxmYCBpZiBub3QgZm91bmQuCiAgICBmdW5jdGlvbiByZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHB0cjsKCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsKICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjkgZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc3ViKHNlbGZsZW4sIG5lZWRsZWxlbikpCiAgICAgICAgICAgICAgICAgICAgbG9vcDoKICAgICAgICAgICAgICAgICAgICBqdW1waShyZXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IHN1YihwdHIsIDEpCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgZ3QoYWRkKHB0ciwgMSksIHNlbGZwdHIpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyCiAgICAgICAgICAgICAgICAgICAganVtcChleGl0KQogICAgICAgICAgICAgICAgICAgIHJldDoKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHB0ciwgbmVlZGxlbGVuKQogICAgICAgICAgICAgICAgICAgIGV4aXQ6CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcHRyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcKICAgICAgICAgICAgICAgIGJ5dGVzMzIgaGFzaDsKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgaGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICBwdHIgPSBzZWxmcHRyICsgKHNlbGZsZW4gLSBuZWVkbGVsZW4pOwogICAgICAgICAgICAgICAgd2hpbGUgKHB0ciA+PSBzZWxmcHRyKSB7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsKICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0ciArIG5lZWRsZWxlbjsKICAgICAgICAgICAgICAgICAgICBwdHIgLT0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZnB0cjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiBldmVyeXRoaW5nIGZyb20gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgICAqICAgICAgYG5lZWRsZWAgdG8gdGhlIGVuZCBvZiB0aGUgc2xpY2UuIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlCiAgICAgKiAgICAgIGlmIGBuZWVkbGVgIGlzIG5vdCBmb3VuZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBmaW5kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgc2VsZi5fbGVuIC09IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICBzZWxmLl9wdHIgPSBwdHI7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gdGhlIHBhcnQgb2YgdGhlIHN0cmluZyBmcm9tIHRoZSBzdGFydCBvZgogICAgICogICAgICBgc2VsZmAgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYC4gSWYgYG5lZWRsZWAKICAgICAqICAgICAgaXMgbm90IGZvdW5kLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiByZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICBzZWxmLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLgogICAgICogQHJldHVybiBgdG9rZW5gLgogICAgICovCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgLy8gTm90IGZvdW5kCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyID0gcHRyICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCB1cCB0byB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLgogICAgICovCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CiAgICAgICAgc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHB0cjsKICAgICAgICB0b2tlbi5fbGVuID0gc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0cik7CiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIpIHsKICAgICAgICAgICAgLy8gTm90IGZvdW5kCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBhZnRlciBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZiBgZGVsaW1gLgogICAgICovCiAgICBmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewogICAgICAgIHJzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBDb3VudHMgdGhlIG51bWJlciBvZiBub25vdmVybGFwcGluZyBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiBvY2N1cnJlbmNlcyBvZiBgbmVlZGxlYCBmb3VuZCBpbiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvdW50KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCBjb3VudCkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwogICAgICAgIHdoaWxlIChwdHIgPD0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0ciksIHB0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIFRydWUgaWYgYHNlbGZgIGNvbnRhaW5zIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYG5lZWRsZWAgaXMgZm91bmQgaW4gYHNlbGZgLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRhaW5zKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSAhPSBzZWxmLl9wdHI7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgY29uY2F0ZW5hdGlvbiBvZgogICAgICogICAgICBgc2VsZmAgYW5kIGBvdGhlcmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb25jYXRlbmF0ZS4KICAgICAqIEByZXR1cm4gVGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlIHR3byBzdHJpbmdzLgogICAgICovCiAgICBmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbiArIG90aGVyLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgIG1lbWNweShyZXRwdHIgKyBzZWxmLl9sZW4sIG90aGVyLl9wdHIsIG90aGVyLl9sZW4pOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgSm9pbnMgYW4gYXJyYXkgb2Ygc2xpY2VzLCB1c2luZyBgc2VsZmAgYXMgYSBkZWxpbWl0ZXIsIHJldHVybmluZyBhCiAgICAgKiAgICAgIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZGVsaW1pdGVyIHRvIHVzZS4KICAgICAqIEBwYXJhbSBwYXJ0cyBBIGxpc3Qgb2Ygc2xpY2VzIHRvIGpvaW4uCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUgc2xpY2VzIGluIGBwYXJ0c2AsCiAgICAgKiAgICAgICAgIGpvaW5lZCB3aXRoIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gam9pbihzbGljZSBzZWxmLCBzbGljZVtdIHBhcnRzKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBpZiAocGFydHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAgICAgdWludCBsZW4gPSBzZWxmLl9sZW4gKiAocGFydHMubGVuZ3RoIC0gMSk7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgbGVuICs9IHBhcnRzW2ldLl9sZW47CgogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKGxlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KCiAgICAgICAgZm9yKGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgcGFydHNbaV0uX3B0ciwgcGFydHNbaV0uX2xlbik7CiAgICAgICAgICAgIHJldHB0ciArPSBwYXJ0c1tpXS5fbGVuOwogICAgICAgICAgICBpZiAoaSA8IHBhcnRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICAgICAgICAgIHJldHB0ciArPSBzZWxmLl9sZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9GbGlnaHREZWxheUFjY2Vzc0NvbnRyb2xsZXJJbnRlcmZhY2Uuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uCUFjY2Vzc0NvbnRyb2xsZXJJbnRlcmZhY2UKICogQGNvcHlyaWdodCAoYykgMjAxNyBldGhlcmlzYyBHbWJICiAqIEBhdXRob3IgQ2hyaXN0b3BoIE11c3NlbmJyb2NrCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKY29udHJhY3QgRmxpZ2h0RGVsYXlBY2Nlc3NDb250cm9sbGVySW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uQnlJZCh1aW50OCBfcGVybSwgYnl0ZXMzMiBfaWQpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uQnlJZCh1aW50OCBfcGVybSwgYnl0ZXMzMiBfaWQsIGJvb2wgX2FjY2VzcykgcHVibGljOwoKICAgIGZ1bmN0aW9uIHNldFBlcm1pc3Npb25CeUFkZHJlc3ModWludDggX3Blcm0sIGFkZHJlc3MgX2FkZHIpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uQnlBZGRyZXNzKHVpbnQ4IF9wZXJtLCBhZGRyZXNzIF9hZGRyLCBib29sIF9hY2Nlc3MpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBjaGVja1Blcm1pc3Npb24odWludDggX3Blcm0sIGFkZHJlc3MgX2FkZHIpIHB1YmxpYyByZXR1cm5zIChib29sIF9zdWNjZXNzKTsKfQoKLy8gRmlsZTogY29udHJhY3RzL0ZsaWdodERlbGF5Q29uc3RhbnRzLnNvbAoKLyoqCiAqIEZsaWdodERlbGF5IHdpdGggT3JhY2xpemVkIFVuZGVyd3JpdGluZyBhbmQgUGF5b3V0CiAqCiAqIEBkZXNjcmlwdGlvbglFdmVudHMgYW5kIENvbnN0YW50cwogKiBAY29weXJpZ2h0IChjKSAyMDE3IGV0aGVyaXNjIEdtYkgKICogQGF1dGhvciBDaHJpc3RvcGggTXVzc2VuYnJvY2sKICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCgpjb250cmFjdCBGbGlnaHREZWxheUNvbnN0YW50cyB7CgogICAgLyoKICAgICogR2VuZXJhbCBldmVudHMKICAgICovCgovLyAtLT4gdGVzdC1tb2RlCi8vICAgICAgICBldmVudCBMb2dVaW50KHN0cmluZyBfbWVzc2FnZSwgdWludCBfdWludCk7Ci8vICAgICAgICBldmVudCBMb2dVaW50RXRoKHN0cmluZyBfbWVzc2FnZSwgdWludCBldGhVaW50KTsKLy8gICAgICAgIGV2ZW50IExvZ1VpbnRUaW1lKHN0cmluZyBfbWVzc2FnZSwgdWludCB0aW1lVWludCk7Ci8vICAgICAgICBldmVudCBMb2dJbnQoc3RyaW5nIF9tZXNzYWdlLCBpbnQgX2ludCk7Ci8vICAgICAgICBldmVudCBMb2dBZGRyZXNzKHN0cmluZyBfbWVzc2FnZSwgYWRkcmVzcyBfYWRkcmVzcyk7Ci8vICAgICAgICBldmVudCBMb2dCeXRlczMyKHN0cmluZyBfbWVzc2FnZSwgYnl0ZXMzMiBoZXhCeXRlczMyKTsKLy8gICAgICAgIGV2ZW50IExvZ0J5dGVzKHN0cmluZyBfbWVzc2FnZSwgYnl0ZXMgaGV4Qnl0ZXMpOwovLyAgICAgICAgZXZlbnQgTG9nQnl0ZXMzMlN0cihzdHJpbmcgX21lc3NhZ2UsIGJ5dGVzMzIgc3RyQnl0ZXMzMik7Ci8vICAgICAgICBldmVudCBMb2dTdHJpbmcoc3RyaW5nIF9tZXNzYWdlLCBzdHJpbmcgX3N0cmluZyk7Ci8vICAgICAgICBldmVudCBMb2dCb29sKHN0cmluZyBfbWVzc2FnZSwgYm9vbCBfYm9vbCk7Ci8vICAgICAgICBldmVudCBMb2coYWRkcmVzcyk7Ci8vIDwtLSB0ZXN0LW1vZGUKCiAgICBldmVudCBMb2dQb2xpY3lBcHBsaWVkKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyLAogICAgICAgIGJ5dGVzMzIgc3RyQ2FycmllckZsaWdodE51bWJlciwKICAgICAgICB1aW50IGV0aFByZW1pdW0KICAgICk7CiAgICBldmVudCBMb2dQb2xpY3lBY2NlcHRlZCgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMCwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMSwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMiwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzMywKICAgICAgICB1aW50IF9zdGF0aXN0aWNzNCwKICAgICAgICB1aW50IF9zdGF0aXN0aWNzNQogICAgKTsKICAgIGV2ZW50IExvZ1BvbGljeVBhaWRPdXQoCiAgICAgICAgdWludCBfcG9saWN5SWQsCiAgICAgICAgdWludCBldGhBbW91bnQKICAgICk7CiAgICBldmVudCBMb2dQb2xpY3lFeHBpcmVkKAogICAgICAgIHVpbnQgX3BvbGljeUlkCiAgICApOwogICAgZXZlbnQgTG9nUG9saWN5RGVjbGluZWQoCiAgICAgICAgdWludCBfcG9saWN5SWQsCiAgICAgICAgYnl0ZXMzMiBzdHJSZWFzb24KICAgICk7CiAgICBldmVudCBMb2dQb2xpY3lNYW51YWxQYXlvdXQoCiAgICAgICAgdWludCBfcG9saWN5SWQsCiAgICAgICAgYnl0ZXMzMiBzdHJSZWFzb24KICAgICk7CiAgICBldmVudCBMb2dTZW5kRnVuZHMoCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LAogICAgICAgIHVpbnQ4IF9mcm9tLAogICAgICAgIHVpbnQgZXRoQW1vdW50CiAgICApOwogICAgZXZlbnQgTG9nUmVjZWl2ZUZ1bmRzKAogICAgICAgIGFkZHJlc3MgX3NlbmRlciwKICAgICAgICB1aW50OCBfdG8sCiAgICAgICAgdWludCBldGhBbW91bnQKICAgICk7CiAgICBldmVudCBMb2dTZW5kRmFpbCgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICBieXRlczMyIHN0clJlYXNvbgogICAgKTsKICAgIGV2ZW50IExvZ09yYWNsaXplQ2FsbCgKICAgICAgICB1aW50IF9wb2xpY3lJZCwKICAgICAgICBieXRlczMyIGhleFF1ZXJ5SWQsCiAgICAgICAgc3RyaW5nIF9vcmFjbGl6ZVVybCwKICAgICAgICB1aW50MjU2IF9vcmFjbGl6ZVRpbWUKICAgICk7CiAgICBldmVudCBMb2dPcmFjbGl6ZUNhbGxiYWNrKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIGJ5dGVzMzIgaGV4UXVlcnlJZCwKICAgICAgICBzdHJpbmcgX3Jlc3VsdCwKICAgICAgICBieXRlcyBoZXhQcm9vZgogICAgKTsKICAgIGV2ZW50IExvZ1NldFN0YXRlKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIHVpbnQ4IF9wb2xpY3lTdGF0ZSwKICAgICAgICB1aW50IF9zdGF0ZVRpbWUsCiAgICAgICAgYnl0ZXMzMiBfc3RhdGVNZXNzYWdlCiAgICApOwogICAgZXZlbnQgTG9nRXh0ZXJuYWwoCiAgICAgICAgdWludDI1NiBfcG9saWN5SWQsCiAgICAgICAgYWRkcmVzcyBfYWRkcmVzcywKICAgICAgICBieXRlczMyIF9leHRlcm5hbElkCiAgICApOwoKICAgIC8qCiAgICAqIEdlbmVyYWwgY29uc3RhbnRzCiAgICAqLwoKICAgIC8vIG1pbmltdW0gb2JzZXJ2YXRpb25zIGZvciB2YWxpZCBwcmVkaWN0aW9uCiAgICB1aW50IGNvbnN0YW50IE1JTl9PQlNFUlZBVElPTlMgPSAxMDsKICAgIC8vIG1pbmltdW0gcHJlbWl1bSB0byBjb3ZlciBjb3N0cwogICAgdWludCBjb25zdGFudCBNSU5fUFJFTUlVTSA9IDUwIGZpbm5leTsKICAgIC8vIG1heGltdW0gcHJlbWl1bQogICAgdWludCBjb25zdGFudCBNQVhfUFJFTUlVTSA9IDEgZXRoZXI7CiAgICAvLyBtYXhpbXVtIHBheW91dAogICAgdWludCBjb25zdGFudCBNQVhfUEFZT1VUID0gMTEwMCBmaW5uZXk7CgogICAgdWludCBjb25zdGFudCBNSU5fUFJFTUlVTV9FVVIgPSAxNTAwIHdlaTsKICAgIHVpbnQgY29uc3RhbnQgTUFYX1BSRU1JVU1fRVVSID0gMjkwMDAgd2VpOwogICAgdWludCBjb25zdGFudCBNQVhfUEFZT1VUX0VVUiA9IDMwMDAwIHdlaTsKCiAgICB1aW50IGNvbnN0YW50IE1JTl9QUkVNSVVNX1VTRCA9IDE3MDAgd2VpOwogICAgdWludCBjb25zdGFudCBNQVhfUFJFTUlVTV9VU0QgPSAzNDAwMCB3ZWk7CiAgICB1aW50IGNvbnN0YW50IE1BWF9QQVlPVVRfVVNEID0gMzUwMDAgd2VpOwoKICAgIHVpbnQgY29uc3RhbnQgTUlOX1BSRU1JVU1fR0JQID0gMTMwMCB3ZWk7CiAgICB1aW50IGNvbnN0YW50IE1BWF9QUkVNSVVNX0dCUCA9IDI1MDAwIHdlaTsKICAgIHVpbnQgY29uc3RhbnQgTUFYX1BBWU9VVF9HQlAgPSAyNzAgd2VpOwoKICAgIC8vIG1heGltdW0gY3VtdWxhdGVkIHdlaWdodGVkIHByZW1pdW0gcGVyIHJpc2sKICAgIHVpbnQgY29uc3RhbnQgTUFYX0NVTVVMQVRFRF9XRUlHSFRFRF9QUkVNSVVNID0gNjAgZXRoZXI7CiAgICAvLyAxIHBlcmNlbnQgZm9yIERBTywgMSBwZXJjZW50IGZvciBtYWludGFpbmVyCiAgICB1aW50OCBjb25zdGFudCBSRVdBUkRfUEVSQ0VOVCA9IDI7CiAgICAvLyByZXNlcnZlIGZvciB0YWlsIHJpc2tzCiAgICB1aW50OCBjb25zdGFudCBSRVNFUlZFX1BFUkNFTlQgPSAxOwogICAgLy8gdGhlIHdlaWdodCBwYXR0ZXJuOyBpbiBmdXR1cmUgdmVyc2lvbnMgdGhpcyBtYXkgYmVjb21lIHBhcnQgb2YgdGhlIHBvbGljeSBzdHJ1Y3QuCiAgICAvLyBjdXJyZW50bHkgY2FuJ3QgYmUgY29uc3RhbnQgYmVjYXVzZSBvZiBjb21waWxlciByZXN0cmljdGlvbnMKICAgIC8vIFdFSUdIVF9QQVRURVJOWzBdIGlzIG5vdCB1c2VkLCBqdXN0IHRvIGJlIGNvbnNpc3RlbnQKICAgIHVpbnQ4WzZdIFdFSUdIVF9QQVRURVJOID0gWwogICAgICAgIDAsCiAgICAgICAgMTAsCiAgICAgICAgMjAsCiAgICAgICAgMzAsCiAgICAgICAgNTAsCiAgICAgICAgNTAKICAgIF07CgovLyAtLT4gcHJvZC1tb2RlCiAgICAvLyBERUZJTklUSU9OUyBGT1IgUk9QU1RFTiBBTkQgTUFJTk5FVAogICAgLy8gbWluaW11bSB0aW1lIGJlZm9yZSBkZXBhcnR1cmUgZm9yIGFwcGx5aW5nCiAgICB1aW50IGNvbnN0YW50IE1JTl9USU1FX0JFRk9SRV9ERVBBUlRVUkUJPSAyNCBob3VyczsgLy8gZm9yIHByb2R1Y3Rpb24KICAgIC8vIGNoZWNrIGZvciBkZWxheSBhZnRlciAuLiBtaW51dGVzIGFmdGVyIHNjaGVkdWxlZCBhcnJpdmFsCiAgICB1aW50IGNvbnN0YW50IENIRUNLX1BBWU9VVF9PRkZTRVQgPSAxNSBtaW51dGVzOyAvLyBmb3IgcHJvZHVjdGlvbgovLyA8LS0gcHJvZC1tb2RlCgovLyAtLT4gdGVzdC1tb2RlCi8vICAgICAgICAvLyBERUZJTklUSU9OUyBGT1IgTE9DQUwgVEVTVE5FVAovLyAgICAgICAgLy8gbWluaW11bSB0aW1lIGJlZm9yZSBkZXBhcnR1cmUgZm9yIGFwcGx5aW5nCi8vICAgICAgICB1aW50IGNvbnN0YW50IE1JTl9USU1FX0JFRk9SRV9ERVBBUlRVUkUgPSAxIHNlY29uZHM7IC8vIGZvciB0ZXN0aW5nCi8vICAgICAgICAvLyBjaGVjayBmb3IgZGVsYXkgYWZ0ZXIgLi4gbWludXRlcyBhZnRlciBzY2hlZHVsZWQgYXJyaXZhbAovLyAgICAgICAgdWludCBjb25zdGFudCBDSEVDS19QQVlPVVRfT0ZGU0VUID0gMSBzZWNvbmRzOyAvLyBmb3IgdGVzdGluZwovLyA8LS0gdGVzdC1tb2RlCgogICAgLy8gbWF4aW11bSBkdXJhdGlvbiBvZiBmbGlnaHQKICAgIHVpbnQgY29uc3RhbnQgTUFYX0ZMSUdIVF9EVVJBVElPTiA9IDIgZGF5czsKICAgIC8vIERlYWRsaW5lIGZvciBhY2NlcHRhbmNlIG9mIHBvbGljaWVzOiAzMS4xMi4yMDMwIChUZXN0bmV0KQogICAgdWludCBjb25zdGFudCBDT05UUkFDVF9ERUFEX0xJTkUgPSAxOTIyMzk2Mzk5OwoKICAgIC8vIGdhcyBDb25zdGFudHMgZm9yIG9yYWNsaXplCiAgICB1aW50IGNvbnN0YW50IE9SQUNMSVpFX0dBUyA9IDcwMDAwMDsKICAgIHVpbnQgY29uc3RhbnQgT1JBQ0xJWkVfR0FTUFJJQ0UgPSA0MDAwMDAwMDAwOwoKCiAgICAvKgogICAgKiBVUkxzIGFuZCBxdWVyeSBzdHJpbmdzIGZvciBvcmFjbGl6ZQogICAgKi8KCi8vIC0tPiBwcm9kLW1vZGUKICAgIC8vIERFRklOSVRJT05TIEZPUiBST1BTVEVOIEFORCBNQUlOTkVUCiAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfUkFUSU5HU19CQVNFX1VSTCA9CiAgICAgICAgLy8gcmF0aW5ncyBhcGkgaXMgdjEsIHNlZSBodHRwczovL2RldmVsb3Blci5mbGlnaHRzdGF0cy5jb20vYXBpLWRvY3MvcmF0aW5ncy92MQogICAgICAgICJbVVJMXSBqc29uKGh0dHBzOi8vYXBpLmZsaWdodHN0YXRzLmNvbS9mbGV4L3JhdGluZ3MvcmVzdC92MS9qc29uL2ZsaWdodC8iOwogICAgc3RyaW5nIGNvbnN0YW50IE9SQUNMSVpFX1JBVElOR1NfUVVFUlkgPQogICAgICAgICI/JHtbZGVjcnlwdF0gQkFyNlo5UW9sTTJQUWltRi9wTkM2elhsZE92WjJxcXVPU0ttL3FKa0pXblNHZ0FlUncyMXdCR25CYlhpYW1yL0lTQzVTbGNKQjZ3RVBLdGhkYzZGK0lwcU0vaVhhdktzYWxSVXJHTnVCc0dmYU1YcjhmUlF3NmdMenFrMGVjT0ZOZUNhNDgveXFCdkMva2FzK2pUS0hpWXhBM3dUSnJWWkNxNzZZMDNsWkkyeHhMYW9uaVJrfSkucmF0aW5nc1swXVsnb2JzZXJ2YXRpb25zJywnbGF0ZTE1JywnbGF0ZTMwJywnbGF0ZTQ1JywnY2FuY2VsbGVkJywnZGl2ZXJ0ZWQnLCdhcnJpdmFsQWlycG9ydEZzQ29kZScsJ2RlcGFydHVyZUFpcnBvcnRGc0NvZGUnXSI7CiAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfU1RBVFVTX0JBU0VfVVJMID0KICAgICAgICAvLyBmbGlnaHQgc3RhdHVzIGFwaSBpcyB2Miwgc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmZsaWdodHN0YXRzLmNvbS9hcGktZG9jcy9mbGlnaHRzdGF0dXMvdjIvZmxpZ2h0CiAgICAgICAgIltVUkxdIGpzb24oaHR0cHM6Ly9hcGkuZmxpZ2h0c3RhdHMuY29tL2ZsZXgvZmxpZ2h0c3RhdHVzL3Jlc3QvdjIvanNvbi9mbGlnaHQvc3RhdHVzLyI7CiAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfU1RBVFVTX1FVRVJZID0KICAgICAgICAvLyBwYXR0ZXJuOgogICAgICAgICI/JHtbZGVjcnlwdF0gQkp4cHdSYUh1allUVDk4cUk1c2xRSnBsai9WYmZWN3ZZa01PcC9NcjVELzUrZ2tnSlFLWmIwZ1ZTQ2E2YUt4MldvZ28vY0c3eWFXSU5SNnZudVl6Y2NRRTV5VkpTcjdSUWlsUmF3eG5BdFpYdDZKQjcwWXBYNHhsZnZwaXBpdDRSK09tUVR1ckpHR3diOFBnbnI0THZvdHlkQ2p1cDZ3djJCay96M1VkR0E3U2wrRlU1YSswfSZ1dGM9dHJ1ZSkuZmxpZ2h0U3RhdHVzZXNbMF1bJ3N0YXR1cycsJ2RlbGF5cycsJ29wZXJhdGlvbmFsVGltZXMnXSI7Ci8vIDwtLSBwcm9kLW1vZGUKCi8vIC0tPiB0ZXN0LW1vZGUKLy8gICAgICAgIC8vIERFRklOSVRJT05TIEZPUiBMT0NBTCBURVNUTkVUCi8vICAgICAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfUkFUSU5HU19CQVNFX1VSTCA9Ci8vICAgICAgICAgICAgLy8gcmF0aW5ncyBhcGkgaXMgdjEsIHNlZSBodHRwczovL2RldmVsb3Blci5mbGlnaHRzdGF0cy5jb20vYXBpLWRvY3MvcmF0aW5ncy92MQovLyAgICAgICAgICAgICJbVVJMXSBqc29uKGh0dHBzOi8vYXBpLXRlc3QuZXRoZXJpc2MuY29tL2ZsZXgvcmF0aW5ncy9yZXN0L3YxL2pzb24vZmxpZ2h0LyI7Ci8vICAgICAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfUkFUSU5HU19RVUVSWSA9Ci8vICAgICAgICAgICAgLy8gZm9yIHRlc3RycGM6Ci8vICAgICAgICAgICAgIikucmF0aW5nc1swXVsnb2JzZXJ2YXRpb25zJywnbGF0ZTE1JywnbGF0ZTMwJywnbGF0ZTQ1JywnY2FuY2VsbGVkJywnZGl2ZXJ0ZWQnLCdhcnJpdmFsQWlycG9ydEZzQ29kZScsJ2RlcGFydHVyZUFpcnBvcnRGc0NvZGUnXSI7Ci8vICAgICAgICBzdHJpbmcgY29uc3RhbnQgT1JBQ0xJWkVfU1RBVFVTX0JBU0VfVVJMID0KLy8gICAgICAgICAgICAvLyBmbGlnaHQgc3RhdHVzIGFwaSBpcyB2Miwgc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmZsaWdodHN0YXRzLmNvbS9hcGktZG9jcy9mbGlnaHRzdGF0dXMvdjIvZmxpZ2h0Ci8vICAgICAgICAgICAgIltVUkxdIGpzb24oaHR0cHM6Ly9hcGktdGVzdC5ldGhlcmlzYy5jb20vZmxleC9mbGlnaHRzdGF0dXMvcmVzdC92Mi9qc29uL2ZsaWdodC9zdGF0dXMvIjsKLy8gICAgICAgIHN0cmluZyBjb25zdGFudCBPUkFDTElaRV9TVEFUVVNfUVVFUlkgPQovLyAgICAgICAgICAgIC8vIGZvciB0ZXN0cnBjOgovLyAgICAgICAgICAgICI/dXRjPXRydWUpLmZsaWdodFN0YXR1c2VzWzBdWydzdGF0dXMnLCdkZWxheXMnLCdvcGVyYXRpb25hbFRpbWVzJ10iOwovLyA8LS0gdGVzdC1tb2RlCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9GbGlnaHREZWxheUNvbnRyb2xsZXJJbnRlcmZhY2Uuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uIENvbnRyYWN0IGludGVyZmFjZQogKiBAY29weXJpZ2h0IChjKSAyMDE3IGV0aGVyaXNjIEdtYkgKICogQGF1dGhvciBDaHJpc3RvcGggTXVzc2VuYnJvY2ssIFN0ZXBoYW4gS2FycGlzY2hlawogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKCmNvbnRyYWN0IEZsaWdodERlbGF5Q29udHJvbGxlckludGVyZmFjZSB7CgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBfaXNPd25lcik7CgogICAgZnVuY3Rpb24gc2VsZlJlZ2lzdGVyKGJ5dGVzMzIgX2lkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCByZXN1bHQpOwoKICAgIGZ1bmN0aW9uIGdldENvbnRyYWN0KGJ5dGVzMzIgX2lkKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9GbGlnaHREZWxheURhdGFiYXNlTW9kZWwuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uIERhdGFiYXNlIG1vZGVsCiAqIEBjb3B5cmlnaHQgKGMpIDIwMTcgZXRoZXJpc2MgR21iSAogKiBAYXV0aG9yIENocmlzdG9waCBNdXNzZW5icm9jaywgU3RlcGhhbiBLYXJwaXNjaGVrCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKY29udHJhY3QgRmxpZ2h0RGVsYXlEYXRhYmFzZU1vZGVsIHsKCiAgICAvLyBMZWRnZXIgYWNjb3VudHMuCiAgICBlbnVtIEFjYyB7CiAgICAgICAgUHJlbWl1bSwgICAgICAvLyAwCiAgICAgICAgUmlza0Z1bmQsICAgICAvLyAxCiAgICAgICAgUGF5b3V0LCAgICAgICAvLyAyCiAgICAgICAgQmFsYW5jZSwgICAgICAvLyAzCiAgICAgICAgUmV3YXJkLCAgICAgICAvLyA0CiAgICAgICAgT3JhY2xpemVDb3N0cyAvLyA1CiAgICB9CgogICAgLy8gcG9saWN5IFN0YXR1cyBDb2RlcyBhbmQgbWVhbmluZzoKICAgIC8vCiAgICAvLyAwMCA9IEFwcGxpZWQ6CSAgdGhlIGN1c3RvbWVyIGhhcyBwYXllZCBhIHByZW1pdW0sIGJ1dCB0aGUgb3JhY2xlIGhhcwogICAgLy8JCQkJCSAgICAgICAgbm90IHlldCBjaGVja2VkIGFuZCBjb25maXJtZWQuCiAgICAvLwkJCQkJICAgICAgICBUaGUgY3VzdG9tZXIgY2FuIHN0aWxsIHJldm9rZSB0aGUgcG9saWN5LgogICAgLy8gMDEgPSBBY2NlcHRlZDoJICB0aGUgb3JhY2xlIGhhcyBjaGVja2VkIGFuZCBjb25maXJtZWQuCiAgICAvLwkJCQkJICAgICAgICBUaGUgY3VzdG9tZXIgY2FuIHN0aWxsIHJldm9rZSB0aGUgcG9saWN5LgogICAgLy8gMDIgPSBSZXZva2VkOgkgIFRoZSBjdXN0b21lciBoYXMgcmV2b2tlZCB0aGUgcG9saWN5LgogICAgLy8JCQkJCSAgICAgICAgVGhlIHByZW1pdW0gbWludXMgY2FuY2VsbGF0aW9uIGZlZSBpcyBwYXllZCBiYWNrIHRvIHRoZQogICAgLy8JCQkJCSAgICAgICAgY3VzdG9tZXIgYnkgdGhlIG9yYWNsZS4KICAgIC8vIDAzID0gUGFpZE91dDoJICBUaGUgZmxpZ2h0IGhhcyBlbmRlZCB3aXRoIGRlbGF5LgogICAgLy8JCQkJCSAgICAgICAgVGhlIG9yYWNsZSBoYXMgY2hlY2tlZCBhbmQgcGF5ZWQgb3V0LgogICAgLy8gMDQgPSBFeHBpcmVkOgkgIFRoZSBmbGlnaHQgaGFzIGVuZGV0IHdpdGggPDE1bWluLiBkZWxheS4KICAgIC8vCQkJCQkgICAgICAgIE5vIHBheW91dC4KICAgIC8vIDA1ID0gRGVjbGluZWQ6CSAgVGhlIGFwcGxpY2F0aW9uIHdhcyBpbnZhbGlkLgogICAgLy8JCQkJCSAgICAgICAgVGhlIHByZW1pdW0gbWludXMgY2FuY2VsbGF0aW9uIGZlZSBpcyBwYXllZCBiYWNrIHRvIHRoZQogICAgLy8JCQkJCSAgICAgICAgY3VzdG9tZXIgYnkgdGhlIG9yYWNsZS4KICAgIC8vIDA2ID0gU2VuZEZhaWxlZDoJRHVyaW5nIFJldm9rZSwgRGVjbGluZSBvciBQYXlvdXQsIHNlbmRpbmcgZXRoZXIgZmFpbGVkCiAgICAvLwkJCQkJICAgICAgICBmb3IgdW5rbm93biByZWFzb25zLgogICAgLy8JCQkJCSAgICAgICAgVGhlIGZ1bmRzIHJlbWFpbiBpbiB0aGUgY29udHJhY3RzIFJpc2tGdW5kLgoKCiAgICAvLyAgICAgICAgICAgICAgICAgICAwMCAgICAgICAwMSAgICAgICAgMDIgICAgICAgMDMgICAgICAgIDA0ICAgICAgMDUgICAgICAgICAgIDA2CiAgICBlbnVtIHBvbGljeVN0YXRlIHsgQXBwbGllZCwgQWNjZXB0ZWQsIFJldm9rZWQsIFBhaWRPdXQsIEV4cGlyZWQsIERlY2xpbmVkLCBTZW5kRmFpbGVkIH0KCiAgICAvLyBvcmFjbGl6ZSBjYWxsYmFjayB0eXBlczoKICAgIGVudW0gb3JhY2xpemVTdGF0ZSB7IEZvclVuZGVyd3JpdGluZywgRm9yUGF5b3V0IH0KCiAgICAvLyAgICAgICAgICAgICAgIDAwICAgMDEgICAwMiAgIDAzCiAgICBlbnVtIEN1cnJlbmN5IHsgRVRILCBFVVIsIFVTRCwgR0JQIH0KCiAgICAvLyB0aGUgcG9saWN5IHN0cnVjdHVyZTogdGhpcyBzdHJ1Y3R1cmUga2VlcHMgdHJhY2sgb2YgdGhlIGluZGl2aWR1YWwgcGFyYW1ldGVycyBvZiBhIHBvbGljeS4KICAgIC8vIHR5cGljYWxseSBjdXN0b21lciBhZGRyZXNzLCBwcmVtaXVtIGFuZCBzb21lIHN0YXR1cyBpbmZvcm1hdGlvbi4KICAgIHN0cnVjdCBQb2xpY3kgewogICAgICAgIC8vIDAgLSB0aGUgY3VzdG9tZXIKICAgICAgICBhZGRyZXNzIGN1c3RvbWVyOwoKICAgICAgICAvLyAxIC0gcHJlbWl1bQogICAgICAgIHVpbnQgcHJlbWl1bTsKICAgICAgICAvLyByaXNrIHNwZWNpZmljIHBhcmFtZXRlcnM6CiAgICAgICAgLy8gMiAtIHBvaW50ZXIgdG8gdGhlIHJpc2sgaW4gdGhlIHJpc2tzIG1hcHBpbmcKICAgICAgICBieXRlczMyIHJpc2tJZDsKICAgICAgICAvLyBjdXN0b20gcGF5b3V0IHBhdHRlcm4KICAgICAgICAvLyBpbiBmdXR1cmUgdmVyc2lvbnMsIGN1c3RvbWVyIHdpbGwgYmUgYWJsZSB0byB0YW1wZXIgd2l0aCB0aGlzIGFycmF5LgogICAgICAgIC8vIHRvIGtlZXAgdGhpbmdzIHNpbXBsZSwgd2UgaGF2ZSBkZWNpZGVkIHRvIGhhcmQtY29kZSB0aGUgYXJyYXkgZm9yIGFsbCBwb2xpY2llcy4KICAgICAgICAvLyB1aW50OFs1XSBwYXR0ZXJuOwogICAgICAgIC8vIDMgLSBwcm9iYWJpbGl0eSB3ZWlnaHQuIHRoaXMgaXMgdGhlIGNlbnRyYWwgcGFyYW1ldGVyCiAgICAgICAgdWludCB3ZWlnaHQ7CiAgICAgICAgLy8gNCAtIGNhbGN1bGF0ZWQgUGF5b3V0CiAgICAgICAgdWludCBjYWxjdWxhdGVkUGF5b3V0OwogICAgICAgIC8vIDUgLSBhY3R1YWwgUGF5b3V0CiAgICAgICAgdWludCBhY3R1YWxQYXlvdXQ7CgogICAgICAgIC8vIHN0YXR1cyBmaWVsZHM6CiAgICAgICAgLy8gNiAtIHRoZSBzdGF0ZSBvZiB0aGUgcG9saWN5CiAgICAgICAgcG9saWN5U3RhdGUgc3RhdGU7CiAgICAgICAgLy8gNyAtIHRpbWUgb2YgbGFzdCBzdGF0ZSBjaGFuZ2UKICAgICAgICB1aW50IHN0YXRlVGltZTsKICAgICAgICAvLyA4IC0gc3RhdGUgY2hhbmdlIG1lc3NhZ2UvcmVhc29uCiAgICAgICAgYnl0ZXMzMiBzdGF0ZU1lc3NhZ2U7CiAgICAgICAgLy8gOSAtIFRMU05vdGFyeSBQcm9vZgogICAgICAgIGJ5dGVzIHByb29mOwogICAgICAgIC8vIDEwIC0gQ3VycmVuY3kKICAgICAgICBDdXJyZW5jeSBjdXJyZW5jeTsKICAgICAgICAvLyAxMCAtIEV4dGVybmFsIGN1c3RvbWVyIGlkCiAgICAgICAgYnl0ZXMzMiBjdXN0b21lckV4dGVybmFsSWQ7CiAgICB9CgogICAgLy8gdGhlIHJpc2sgc3RydWN0dXJlOyB0aGlzIHN0cnVjdHVyZSBrZWVwcyB0cmFjayBvZiB0aGUgcmlzay0KICAgIC8vIHNwZWNpZmljIHBhcmFtZXRlcnMuCiAgICAvLyBzZXZlcmFsIHBvbGljaWVzIGNhbiBzaGFyZSB0aGUgc2FtZSByaXNrIHN0cnVjdHVyZSAodHlwaWNhbGx5CiAgICAvLyBzb21lIHBlb3BsZSBmbHlpbmcgd2l0aCB0aGUgc2FtZSBwbGFuZSkKICAgIHN0cnVjdCBSaXNrIHsKICAgICAgICAvLyAwIC0gQWlybGluZSBDb2RlICsgRmxpZ2h0TnVtYmVyCiAgICAgICAgYnl0ZXMzMiBjYXJyaWVyRmxpZ2h0TnVtYmVyOwogICAgICAgIC8vIDEgLSBzY2hlZHVsZWQgZGVwYXJ0dXJlIGFuZCBhcnJpdmFsIHRpbWUgaW4gdGhlIGZvcm1hdCAvZGVwL1lZWVkvTU0vREQKICAgICAgICBieXRlczMyIGRlcGFydHVyZVllYXJNb250aERheTsKICAgICAgICAvLyAyIC0gdGhlIGluaXRhbCBhcnJpdmFsIHRpbWUKICAgICAgICB1aW50IGFycml2YWxUaW1lOwogICAgICAgIC8vIDMgLSB0aGUgZmluYWwgZGVsYXkgaW4gbWludXRlcwogICAgICAgIHVpbnQgZGVsYXlJbk1pbnV0ZXM7CiAgICAgICAgLy8gNCAtIHRoZSBkZXRlcm1pbmVkIGRlbGF5IGNhdGVnb3J5ICgwLTUpCiAgICAgICAgdWludDggZGVsYXk7CiAgICAgICAgLy8gNSAtIHdlIGxpbWl0IHRoZSBjdW11bGF0ZWQgd2VpZ2h0ZWQgcHJlbWl1bSB0byBhdm9pZCBjbHVzdGVyIHJpc2tzCiAgICAgICAgdWludCBjdW11bGF0ZWRXZWlnaHRlZFByZW1pdW07CiAgICAgICAgLy8gNiAtIG1heCBjdW11bGF0ZWQgUGF5b3V0IGZvciB0aGlzIHJpc2sKICAgICAgICB1aW50IHByZW1pdW1NdWx0aXBsaWVyOwogICAgfQoKICAgIC8vIHRoZSBvcmFjbGl6ZSBjYWxsYmFjayBzdHJ1Y3R1cmU6IHdlIHVzZSBzZXZlcmFsIG9yYWNsaXplIGNhbGxzLgogICAgLy8gYWxsIG9yYWNsaXplIGNhbGxzIHdpbGwgcmVzdWx0IGluIGEgY29tbW9uIGNhbGxiYWNrIHRvIF9fY2FsbGJhY2soLi4uKS4KICAgIC8vIHRvIGtlZXAgdHJhY2sgb2YgdGhlIGRpZmZlcmVudCBxdWVyeXMgd2UgaGF2ZSB0byBpbnRyb2R1Y2UgdGhpcyBzdHJ1Y3QuCiAgICBzdHJ1Y3QgT3JhY2xpemVDYWxsYmFjayB7CiAgICAgICAgLy8gZm9yIHdoaWNoIHBvbGljeSBoYXZlIHdlIGNhbGxlZD8KICAgICAgICB1aW50IHBvbGljeUlkOwogICAgICAgIC8vIGZvciB3aGljaCBwdXJwb3NlIGRpZCB3ZSBjYWxsPyB7Rm9yVW5kZXJ3cml0ZSB8IEZvclBheW91dH0KICAgICAgICBvcmFjbGl6ZVN0YXRlIG9TdGF0ZTsKICAgICAgICAvLyB0aW1lCiAgICAgICAgdWludCBvcmFjbGl6ZVRpbWU7CiAgICB9CgogICAgc3RydWN0IEN1c3RvbWVyIHsKICAgICAgICBieXRlczMyIGN1c3RvbWVyRXh0ZXJuYWxJZDsKICAgICAgICBib29sIGlkZW50aXR5Q29uZmlybWVkOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvRmxpZ2h0RGVsYXlDb250cm9sbGVkQ29udHJhY3Quc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uIENvbnRyb2xsZWQgY29udHJhY3QgSW50ZXJmYWNlCiAqIEBjb3B5cmlnaHQgKGMpIDIwMTcgZXRoZXJpc2MgR21iSAogKiBAYXV0aG9yIENocmlzdG9waCBNdXNzZW5icm9jawogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKCgoKCmNvbnRyYWN0IEZsaWdodERlbGF5Q29udHJvbGxlZENvbnRyYWN0IGlzIEZsaWdodERlbGF5RGF0YWJhc2VNb2RlbCB7CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKICAgIEZsaWdodERlbGF5Q29udHJvbGxlckludGVyZmFjZSBGRF9DSTsKCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb250cm9sbGVyKGFkZHJlc3MgX2NvbnRyb2xsZXIpIGludGVybmFsIHJldHVybnMgKGJvb2wgX3Jlc3VsdCkgewogICAgICAgIGNvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgICAgICBGRF9DSSA9IEZsaWdodERlbGF5Q29udHJvbGxlckludGVyZmFjZShfY29udHJvbGxlcik7CiAgICAgICAgX3Jlc3VsdCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVzdHJ1Y3QoKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIHNlbGZkZXN0cnVjdChjb250cm9sbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb250cmFjdHMoKSBwdWJsaWMgb25seUNvbnRyb2xsZXIge30KCiAgICBmdW5jdGlvbiBnZXRDb250cmFjdChieXRlczMyIF9pZCkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyBfYWRkcikgewogICAgICAgIF9hZGRyID0gRkRfQ0kuZ2V0Q29udHJhY3QoX2lkKTsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0ZsaWdodERlbGF5RGF0YWJhc2VJbnRlcmZhY2Uuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uIERhdGFiYXNlIGNvbnRyYWN0IGludGVyZmFjZQogKiBAY29weXJpZ2h0IChjKSAyMDE3IGV0aGVyaXNjIEdtYkgKICogQGF1dGhvciBDaHJpc3RvcGggTXVzc2VuYnJvY2ssIFN0ZXBoYW4gS2FycGlzY2hlawogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKCgoKY29udHJhY3QgRmxpZ2h0RGVsYXlEYXRhYmFzZUludGVyZmFjZSBpcyBGbGlnaHREZWxheURhdGFiYXNlTW9kZWwgewoKICAgIHVpbnQgcHVibGljIE1JTl9ERVBBUlRVUkVfTElNOwoKICAgIHVpbnQgcHVibGljIE1BWF9ERVBBUlRVUkVfTElNOwoKICAgIGJ5dGVzMzJbXSBwdWJsaWMgdmFsaWRPcmlnaW5zOwoKICAgIGJ5dGVzMzJbXSBwdWJsaWMgdmFsaWREZXN0aW5hdGlvbnM7CgogICAgZnVuY3Rpb24gY291bnRPcmlnaW5zKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX2xlbmd0aCk7CgogICAgZnVuY3Rpb24gZ2V0T3JpZ2luQnlJbmRleCh1aW50MjU2IF9pKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiBfb3JpZ2luKTsKCiAgICBmdW5jdGlvbiBjb3VudERlc3RpbmF0aW9ucygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IF9sZW5ndGgpOwoKICAgIGZ1bmN0aW9uIGdldERlc3RpbmF0aW9uQnlJbmRleCh1aW50MjU2IF9pKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiBfZGVzdGluYXRpb24pOwoKICAgIGZ1bmN0aW9uIHNldEFjY2Vzc0NvbnRyb2woYWRkcmVzcyBfY29udHJhY3QsIGFkZHJlc3MgX2NhbGxlciwgdWludDggX3Blcm0pIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBzZXRBY2Nlc3NDb250cm9sKAogICAgICAgIGFkZHJlc3MgX2NvbnRyYWN0LAogICAgICAgIGFkZHJlc3MgX2NhbGxlciwKICAgICAgICB1aW50OCBfcGVybSwKICAgICAgICBib29sIF9hY2Nlc3MKICAgICkgcHVibGljOwoKICAgIGZ1bmN0aW9uIGdldEFjY2Vzc0NvbnRyb2woYWRkcmVzcyBfY29udHJhY3QsIGFkZHJlc3MgX2NhbGxlciwgdWludDggX3Blcm0pIHB1YmxpYyByZXR1cm5zIChib29sIF9hbGxvd2VkKSA7CgogICAgZnVuY3Rpb24gc2V0TGVkZ2VyKHVpbnQ4IF9pbmRleCwgaW50IF92YWx1ZSkgcHVibGljOwoKICAgIGZ1bmN0aW9uIGdldExlZGdlcih1aW50OCBfaW5kZXgpIHB1YmxpYyByZXR1cm5zIChpbnQgX3ZhbHVlKSA7CgogICAgZnVuY3Rpb24gZ2V0Q3VzdG9tZXJQcmVtaXVtKHVpbnQgX3BvbGljeUlkKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3ByZW1pdW0pIDsKCiAgICBmdW5jdGlvbiBnZXRQb2xpY3lEYXRhKHVpbnQgX3BvbGljeUlkKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3ByZW1pdW0sIHVpbnQgX3dlaWdodCkgOwoKICAgIGZ1bmN0aW9uIGdldFBvbGljeVN0YXRlKHVpbnQgX3BvbGljeUlkKSBwdWJsaWMgcmV0dXJucyAocG9saWN5U3RhdGUgX3N0YXRlKSA7CgogICAgZnVuY3Rpb24gZ2V0Umlza0lkKHVpbnQgX3BvbGljeUlkKSBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMiBfcmlza0lkKTsKCiAgICBmdW5jdGlvbiBjcmVhdGVQb2xpY3koYWRkcmVzcyBfY3VzdG9tZXIsIHVpbnQgX3ByZW1pdW0sIEN1cnJlbmN5IF9jdXJyZW5jeSwgYnl0ZXMzMiBfY3VzdG9tZXJFeHRlcm5hbElkLCBieXRlczMyIF9yaXNrSWQpIHB1YmxpYyByZXR1cm5zICh1aW50IF9wb2xpY3lJZCkgOwoKICAgIGZ1bmN0aW9uIHNldFN0YXRlKAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIHBvbGljeVN0YXRlIF9zdGF0ZSwKICAgICAgICB1aW50IF9zdGF0ZVRpbWUsCiAgICAgICAgYnl0ZXMzMiBfc3RhdGVNZXNzYWdlCiAgICApIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBzZXRXZWlnaHQodWludCBfcG9saWN5SWQsIHVpbnQgX3dlaWdodCwgYnl0ZXMgX3Byb29mKSBwdWJsaWM7CgogICAgZnVuY3Rpb24gc2V0UGF5b3V0cyh1aW50IF9wb2xpY3lJZCwgdWludCBfY2FsY3VsYXRlZFBheW91dCwgdWludCBfYWN0dWFsUGF5b3V0KSBwdWJsaWM7CgogICAgZnVuY3Rpb24gc2V0RGVsYXkodWludCBfcG9saWN5SWQsIHVpbnQ4IF9kZWxheSwgdWludCBfZGVsYXlJbk1pbnV0ZXMpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBnZXRSaXNrUGFyYW1ldGVycyhieXRlczMyIF9yaXNrSWQpCiAgICAgICAgcHVibGljIHJldHVybnMgKGJ5dGVzMzIgX2NhcnJpZXJGbGlnaHROdW1iZXIsIGJ5dGVzMzIgX2RlcGFydHVyZVllYXJNb250aERheSwgdWludCBfYXJyaXZhbFRpbWUpIDsKCiAgICBmdW5jdGlvbiBnZXRQcmVtaXVtRmFjdG9ycyhieXRlczMyIF9yaXNrSWQpCiAgICAgICAgcHVibGljIHJldHVybnMgKHVpbnQgX2N1bXVsYXRlZFdlaWdodGVkUHJlbWl1bSwgdWludCBfcHJlbWl1bU11bHRpcGxpZXIpOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVVwZGF0ZVJpc2soYnl0ZXMzMiBfY2FycmllckZsaWdodE51bWJlciwgYnl0ZXMzMiBfZGVwYXJ0dXJlWWVhck1vbnRoRGF5LCB1aW50IF9hcnJpdmFsVGltZSkKICAgICAgICBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMiBfcmlza0lkKTsKCiAgICBmdW5jdGlvbiBzZXRQcmVtaXVtRmFjdG9ycyhieXRlczMyIF9yaXNrSWQsIHVpbnQgX2N1bXVsYXRlZFdlaWdodGVkUHJlbWl1bSwgdWludCBfcHJlbWl1bU11bHRpcGxpZXIpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBnZXRPcmFjbGl6ZUNhbGxiYWNrKGJ5dGVzMzIgX3F1ZXJ5SWQpCiAgICAgICAgcHVibGljIHJldHVybnMgKHVpbnQgX3BvbGljeUlkLCB1aW50IF9vcmFjbGl6ZVRpbWUpIDsKCiAgICBmdW5jdGlvbiBnZXRPcmFjbGl6ZVBvbGljeUlkKGJ5dGVzMzIgX3F1ZXJ5SWQpCiAgICAgICAgcHVibGljIHJldHVybnMgKHVpbnQgX3BvbGljeUlkKSA7CgogICAgZnVuY3Rpb24gY3JlYXRlT3JhY2xpemVDYWxsYmFjaygKICAgICAgICBieXRlczMyIF9xdWVyeUlkLAogICAgICAgIHVpbnQgX3BvbGljeUlkLAogICAgICAgIG9yYWNsaXplU3RhdGUgX29yYWNsaXplU3RhdGUsCiAgICAgICAgdWludCBfb3JhY2xpemVUaW1lCiAgICApIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBjaGVja1RpbWUoYnl0ZXMzMiBfcXVlcnlJZCwgYnl0ZXMzMiBfcmlza0lkLCB1aW50IF9vZmZzZXQpCiAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wgX3Jlc3VsdCkgOwp9CgovLyBGaWxlOiBjb250cmFjdHMvRmxpZ2h0RGVsYXlMZWRnZXJJbnRlcmZhY2Uuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uCUxlZGdlciBjb250cmFjdCBpbnRlcmZhY2UKICogQGNvcHlyaWdodCAoYykgMjAxNyBldGhlcmlzYyBHbWJICiAqIEBhdXRob3IgQ2hyaXN0b3BoIE11c3NlbmJyb2NrLCBTdGVwaGFuIEthcnBpc2NoZWsKICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCgoKCmNvbnRyYWN0IEZsaWdodERlbGF5TGVkZ2VySW50ZXJmYWNlIGlzIEZsaWdodERlbGF5RGF0YWJhc2VNb2RlbCB7CgogICAgZnVuY3Rpb24gcmVjZWl2ZUZ1bmRzKEFjYyBfdG8pIHB1YmxpYyBwYXlhYmxlOwoKICAgIGZ1bmN0aW9uIHNlbmRGdW5kcyhhZGRyZXNzIF9yZWNpcGllbnQsIEFjYyBfZnJvbSwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gYm9va2tlZXBpbmcoQWNjIF9mcm9tLCBBY2MgX3RvLCB1aW50IGFtb3VudCkgcHVibGljOwp9CgovLyBGaWxlOiB2ZW5kb3JzL3VzaW5nT3JhY2xpemUuc29sCgovLyA8T1JBQ0xJWkVfQVBJPgovKgpDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNiBPcmFjbGl6ZSBTUkwKQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURAoKCgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgoKClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwgVEhFCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgpUSEUgU09GVFdBUkUuCiovCgoKCmNvbnRyYWN0IE9yYWNsaXplSSB7CiAgICBhZGRyZXNzIHB1YmxpYyBjYkFkZHJlc3M7CiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOwogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7CiAgICBmdW5jdGlvbiBzZXRDb25maWcoYnl0ZXMzMiBfY29uZmlnKTsKICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsKICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgcmV0dXJucyhieXRlczMyKTsKfQpjb250cmFjdCBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgewogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsKICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7CiAgICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAqNjAqMjQqMzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OYXRpdmUgPSAweEYwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7CiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7CiAgICAgICAgaWYoKGFkZHJlc3MoT0FSKT09MCl8fChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpPT0wKSkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9tYWlubmV0Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcm9wc3RlbjMiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpPjApeyAvL2tvdmFuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpPjApeyAvL3JpbmtlYnkgdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yaW5rZWJ5Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KT4wKXsgLy9ldGhlcmV1bS1icmlkZ2UKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIHsKICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgewogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2NiQWRkcmVzcygpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldFByb29mKGJ5dGUgcHJvb2ZQKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUucmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOwogICAgICAgIHVpbnQxNjAgYjE7CiAgICAgICAgdWludDE2MCBiMjsKICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7CiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsKICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7CiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7CiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkmJihiMSA8PSA3MCkpIGIxIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSYmKGIyIDw9IDcwKSkgYjIgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKXsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGogLz0gMTA7CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgICAgdWludCBrID0gbGVuIC0gMTsKICAgICAgICB3aGlsZSAoaSAhPSAwKXsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKCiAgICBzdHJpbmcgb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29ya05hbWUoc3RyaW5nIF9uZXR3b3JrX25hbWUpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9uZXR3b3JrX25hbWUgPSBfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICBpZiAoKF9uYnl0ZXMgPT0gMCl8fChfbmJ5dGVzID4gMzIpKSB0aHJvdzsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXNbM10gbWVtb3J5IGFyZ3MgPSBbdW5vbmNlLCBuYnl0ZXMsIHNlc3Npb25LZXlIYXNoXTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeShfZGVsYXksICJyYW5kb20iLCBhcmdzLCBfY3VzdG9tR2FzTGltaXQpOwogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQocXVlcnlJZCwgc2hhMyhieXRlczgoX2RlbGF5KSwgYXJnc1sxXSwgc2hhMjU2KGFyZ3NbMF0pLCBhcmdzWzJdKSk7CiAgICAgICAgcmV0dXJuIHF1ZXJ5SWQ7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50OwogICAgfQoKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ynl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CgogICAgICAgIGJ5dGVzMzIgc2lncjsKICAgICAgICBieXRlczMyIHNpZ3M7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBvZmZzZXQgPSA0Kyh1aW50KGRlcnNpZ1szXSkgLSAweDIwKTsKICAgICAgICBzaWdyXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCwgMzIsIHNpZ3JfLCAwKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2lnc18gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIG9mZnNldCArPSAzMiArIDI7CiAgICAgICAgc2lnc18gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQrKHVpbnQoZGVyc2lnW29mZnNldC0xXSkgLSAweDIwKSwgMzIsIHNpZ3NfLCAwKTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaWdyIDo9IG1sb2FkKGFkZChzaWdyXywgMzIpKQogICAgICAgICAgICBzaWdzIDo9IG1sb2FkKGFkZChzaWdzXywgMzIpKQogICAgICAgIH0KCgogICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyNywgc2lnciwgc2lncyk7CiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwoKICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcyID0gbmV3IGJ5dGVzKHVpbnQocHJvb2Zbc2lnMm9mZnNldCsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LCBzaWcyLmxlbmd0aCwgc2lnMiwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDErNjUrMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSAxOyAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZmQ5NGZhNzFiYzBiYTEwZDM5ZDQ2NGQwZDhmNDY1ZWZlZWYwYTI3NjRlMzg4N2ZjYzlkZjQxZGVkMjBmNTA1YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CgogICAgICAgIGlmIChzaWdvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMyA9IG5ldyBieXRlcygxKzY1KTsKICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwoKICAgICAgICByZXR1cm4gc2lnb2s7CiAgICB9CgogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSB0aHJvdzsKCiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fcmV0dXJuQ29kZShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCl7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHJldHVybiAxOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHJldHVybiAyOwoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgbWF0Y2hfID0gdHJ1ZTsKCiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHByZWZpeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKGJ5dGVzIHByb29mLCBieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzIHJlc3VsdCwgc3RyaW5nIGNvbnRleHRfbmFtZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBjaGVja29rOwoKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGNoZWNrb2sgPSAoc2hhMyhrZXloYXNoKSA9PSBzaGEzKHNoYTI1Nihjb250ZXh0X25hbWUsIHF1ZXJ5SWQpKSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzEgPSBuZXcgYnl0ZXModWludChwcm9vZltsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSwgc2lnMS5sZW5ndGgsIHNpZzEsIDApOwoKCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgY2hlY2tvayA9IG1hdGNoQnl0ZXMzMlByZWZpeChzaGEyNTYoc2lnMSksIHJlc3VsdCk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNDogY29tbWl0bWVudCBtYXRjaCB2ZXJpZmljYXRpb24sIHNoYTMoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLgogICAgICAgIC8vIFRoaXMgaXMgdG8gdmVyaWZ5IHRoYXQgdGhlIGNvbXB1dGVkIGFyZ3MgbWF0Y2ggd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQgaW4gdGhlIHF1ZXJ5LgogICAgICAgIGJ5dGVzIG1lbW9yeSBjb21taXRtZW50U2xpY2UxID0gbmV3IGJ5dGVzKDgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCszMiwgOCsxKzMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwoKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IHNoYTMoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBjaGVja29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKXsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOwogICAgfQoKCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gbGVuZ3RoICsgdG9PZmZzZXQ7CgogICAgICAgIGlmICh0by5sZW5ndGggPCBtaW5MZW5ndGgpIHsKICAgICAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgICAgICB0aHJvdzsgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KICAgICAgICB9CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCn0KLy8gPC9PUkFDTElaRV9BUEk+CgovLyBGaWxlOiBjb250cmFjdHMvRmxpZ2h0RGVsYXlPcmFjbGl6ZUludGVyZmFjZS5zb2wKCi8qKgogKiBGbGlnaHREZWxheSB3aXRoIE9yYWNsaXplZCBVbmRlcndyaXRpbmcgYW5kIFBheW91dAogKgogKiBAZGVzY3JpcHRpb24JT2NhY2xpemUgQVBJIGludGVyZmFjZQogKiBAY29weXJpZ2h0IChjKSAyMDE3IGV0aGVyaXNjIEdtYkgKICogQGF1dGhvciBDaHJpc3RvcGggTXVzc2VuYnJvY2ssIFN0ZXBoYW4gS2FycGlzY2hlawogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKCgoKY29udHJhY3QgRmxpZ2h0RGVsYXlPcmFjbGl6ZUludGVyZmFjZSBpcyB1c2luZ09yYWNsaXplIHsKCiAgICBtb2RpZmllciBvbmx5T3JhY2xpemVPciAoYWRkcmVzcyBfZW1lcmdlbmN5KSB7Ci8vIC0tPiBwcm9kLW1vZGUKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3JhY2xpemVfY2JBZGRyZXNzKCkgfHwgbXNnLnNlbmRlciA9PSBfZW1lcmdlbmN5KTsKLy8gPC0tIHByb2QtbW9kZQogICAgICAgIF87CiAgICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9GbGlnaHREZWxheVBheW91dEludGVyZmFjZS5zb2wKCi8qKgogKiBGbGlnaHREZWxheSB3aXRoIE9yYWNsaXplZCBVbmRlcndyaXRpbmcgYW5kIFBheW91dAogKgogKiBAZGVzY3JpcHRpb24JUGF5b3V0IGNvbnRyYWN0IGludGVyZmFjZQogKiBAY29weXJpZ2h0IChjKSAyMDE3IGV0aGVyaXNjIEdtYkgKICogQGF1dGhvciBDaHJpc3RvcGggTXVzc2VuYnJvY2ssIFN0ZXBoYW4gS2FycGlzY2hlawogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKCmNvbnRyYWN0IEZsaWdodERlbGF5UGF5b3V0SW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBzY2hlZHVsZVBheW91dE9yYWNsaXplQ2FsbCh1aW50IF9wb2xpY3lJZCwgYnl0ZXMzMiBfcmlza0lkLCB1aW50IF9vZmZzZXQpIHB1YmxpYzsKfQoKLy8gRmlsZTogY29udHJhY3RzL2NvbnZlcnRMaWIuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uCUNvbnZlcnNpb25zCiAqIEBjb3B5cmlnaHQgKGMpIDIwMTcgZXRoZXJpc2MgR21iSAogKiBAYXV0aG9yIENocmlzdG9waCBNdXNzZW5icm9jawogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKCmNvbnRyYWN0IENvbnZlcnRMaWIgewoKICAgIC8vIC4uIHNpbmNlIGJlZ2lubmluZyBvZiB0aGUgeWVhcgogICAgdWludDE2WzEyXSBkYXlzX3NpbmNlID0gWwogICAgICAgIDExLAogICAgICAgIDQyLAogICAgICAgIDcwLAogICAgICAgIDEwMSwKICAgICAgICAxMzEsCiAgICAgICAgMTYyLAogICAgICAgIDE5MiwKICAgICAgICAyMjMsCiAgICAgICAgMjU0LAogICAgICAgIDI4NCwKICAgICAgICAzMTUsCiAgICAgICAgMzQ1CiAgICBdOwoKICAgIGZ1bmN0aW9uIGIzMnRvU3RyaW5nKGJ5dGVzMzIgeCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgLy8gZ2FzIHVzYWdlOiBhYm91dCAxSyBnYXMgcGVyIGNoYXIuCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IGNoYXJDb3VudCA9IDA7CgogICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IDMyOyBqKyspIHsKICAgICAgICAgICAgYnl0ZSBjaGFyID0gYnl0ZShieXRlczMyKHVpbnQoeCkgKiAyICoqICg4ICogaikpKTsKICAgICAgICAgICAgaWYgKGNoYXIgIT0gMCkgewogICAgICAgICAgICAgICAgYnl0ZXNTdHJpbmdbY2hhckNvdW50XSA9IGNoYXI7CiAgICAgICAgICAgICAgICBjaGFyQ291bnQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nVHJpbW1lZCA9IG5ldyBieXRlcyhjaGFyQ291bnQpOwoKICAgICAgICBmb3IgKGogPSAwOyBqIDwgY2hhckNvdW50OyBqKyspIHsKICAgICAgICAgICAgYnl0ZXNTdHJpbmdUcmltbWVkW2pdID0gYnl0ZXNTdHJpbmdbal07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3RyaW5nKGJ5dGVzU3RyaW5nVHJpbW1lZCk7CiAgICB9CgogICAgZnVuY3Rpb24gYjMydG9IZXhTdHJpbmcoYnl0ZXMzMiB4KSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgMzI7IGkrKykgewogICAgICAgICAgICB1aW50OCBieSA9IHVpbnQ4KHVpbnQoeCkgLyAoMioqKDgqKDMxIC0gaSkpKSk7CiAgICAgICAgICAgIHVpbnQ4IGhpZ2ggPSBieS8xNjsKICAgICAgICAgICAgdWludDggbG93ID0gYnkgLSAxNipoaWdoOwogICAgICAgICAgICBpZiAoaGlnaCA+IDkpIHsKICAgICAgICAgICAgICAgIGhpZ2ggKz0gMzk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxvdyA+IDkpIHsKICAgICAgICAgICAgICAgIGxvdyArPSAzOTsKICAgICAgICAgICAgfQogICAgICAgICAgICBiWzIqaV0gPSBieXRlKGhpZ2grNDgpOwogICAgICAgICAgICBiWzIqaSsxXSA9IGJ5dGUobG93KzQ4KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdHJpbmcoYik7CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBfYi0tOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSB7CiAgICAgICAgICAgICAgICBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgewogICAgICAgICAgICBtaW50ICo9IDEwKipfYjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiB5aWVsZHMgY29ycmVjdCByZXN1bHRzIGluIHRoZSB0aW1lIGJldHdlZW4gMS4zLjIwMTYgYW5kIDI4LjAyLjIwMjAsCiAgICAvLyBzbyB3aXRoaW4gdGhlIHZhbGlkaXR5IG9mIHRoZSBjb250cmFjdCBpdHMgY29ycmVjdC4KICAgIGZ1bmN0aW9uIHRvVW5peHRpbWUoYnl0ZXMzMiBfZGF5TW9udGhZZWFyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHVuaXh0aW1lKSB7CiAgICAgICAgLy8gX2RheV9tb250aF95ZWFyID0gL2RlcC8yMDE2LzA5LzEwCiAgICAgICAgYnl0ZXMgbWVtb3J5IGJEbXkgPSBieXRlcyhiMzJ0b1N0cmluZyhfZGF5TW9udGhZZWFyKSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRlbXAyID0gYnl0ZXMobmV3IHN0cmluZygyKSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRlbXA0ID0gYnl0ZXMobmV3IHN0cmluZyg0KSk7CgogICAgICAgIHRlbXA0WzBdID0gYkRteVs1XTsKICAgICAgICB0ZW1wNFsxXSA9IGJEbXlbNl07CiAgICAgICAgdGVtcDRbMl0gPSBiRG15WzddOwogICAgICAgIHRlbXA0WzNdID0gYkRteVs4XTsKICAgICAgICB1aW50IHllYXIgPSBwYXJzZUludChzdHJpbmcodGVtcDQpKTsKCiAgICAgICAgdGVtcDJbMF0gPSBiRG15WzEwXTsKICAgICAgICB0ZW1wMlsxXSA9IGJEbXlbMTFdOwogICAgICAgIHVpbnQgbW9udGggPSBwYXJzZUludChzdHJpbmcodGVtcDIpKTsKCiAgICAgICAgdGVtcDJbMF0gPSBiRG15WzEzXTsKICAgICAgICB0ZW1wMlsxXSA9IGJEbXlbMTRdOwogICAgICAgIHVpbnQgZGF5ID0gcGFyc2VJbnQoc3RyaW5nKHRlbXAyKSk7CgogICAgICAgIHVuaXh0aW1lID0gKCh5ZWFyIC0gMTk3MCkgKiAzNjUgKyBkYXlzX3NpbmNlW21vbnRoLTFdICsgZGF5KSAqIDg2NDAwOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvRmxpZ2h0RGVsYXlQYXlvdXQuc29sCgovKioKICogRmxpZ2h0RGVsYXkgd2l0aCBPcmFjbGl6ZWQgVW5kZXJ3cml0aW5nIGFuZCBQYXlvdXQKICoKICogQGRlc2NyaXB0aW9uCVBheW91dCBjb250cmFjdAogKiBAY29weXJpZ2h0IChjKSAyMDE3IGV0aGVyaXNjIEdtYkgKICogQGF1dGhvciBDaHJpc3RvcGggTXVzc2VuYnJvY2sKICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCgoKCgoKCgoKCgoKY29udHJhY3QgRmxpZ2h0RGVsYXlQYXlvdXQgaXMgRmxpZ2h0RGVsYXlDb250cm9sbGVkQ29udHJhY3QsIEZsaWdodERlbGF5Q29uc3RhbnRzLCBGbGlnaHREZWxheU9yYWNsaXplSW50ZXJmYWNlLCBDb252ZXJ0TGliIHsKCiAgICB1c2luZyBzdHJpbmdzIGZvciAqOwoKICAgIEZsaWdodERlbGF5RGF0YWJhc2VJbnRlcmZhY2UgRkRfREI7CiAgICBGbGlnaHREZWxheUxlZGdlckludGVyZmFjZSBGRF9MRzsKICAgIEZsaWdodERlbGF5QWNjZXNzQ29udHJvbGxlckludGVyZmFjZSBGRF9BQzsKCiAgICAvKgogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBzZXRzIGl0cyBjb250cm9sbGVyCiAgICAgKiBAcGFyYW0gX2NvbnRyb2xsZXIgRkQuQ29udHJvbGxlcgogICAgICovCiAgICBmdW5jdGlvbiBGbGlnaHREZWxheVBheW91dChhZGRyZXNzIF9jb250cm9sbGVyKSBwdWJsaWMgewogICAgICAgIHNldENvbnRyb2xsZXIoX2NvbnRyb2xsZXIpOwogICAgICAgIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKE9SQUNMSVpFX0dBU1BSSUNFKTsKICAgIH0KCiAgICAvKgogICAgICogUHVibGljIG1ldGhvZHMKICAgICAqLwoKICAgIC8qCiAgICAgKiBAZGV2IFNldCBhY2Nlc3MgcGVybWlzc2lvbnMgZm9yIG1ldGhvZHMKICAgICAqLwogICAgZnVuY3Rpb24gc2V0Q29udHJhY3RzKCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBGRF9BQyA9IEZsaWdodERlbGF5QWNjZXNzQ29udHJvbGxlckludGVyZmFjZShnZXRDb250cmFjdCgiRkQuQWNjZXNzQ29udHJvbGxlciIpKTsKICAgICAgICBGRF9EQiA9IEZsaWdodERlbGF5RGF0YWJhc2VJbnRlcmZhY2UoZ2V0Q29udHJhY3QoIkZELkRhdGFiYXNlIikpOwogICAgICAgIEZEX0xHID0gRmxpZ2h0RGVsYXlMZWRnZXJJbnRlcmZhY2UoZ2V0Q29udHJhY3QoIkZELkxlZGdlciIpKTsKCiAgICAgICAgRkRfQUMuc2V0UGVybWlzc2lvbkJ5SWQoMTAxLCAiRkQuVW5kZXJ3cml0ZSIpOwogICAgICAgIEZEX0FDLnNldFBlcm1pc3Npb25CeUFkZHJlc3MoMTAxLCBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7CiAgICAgICAgRkRfQUMuc2V0UGVybWlzc2lvbkJ5SWQoMTAyLCAiRkQuRnVuZGVyIik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgRnVuZCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShGRF9BQy5jaGVja1Blcm1pc3Npb24oMTAyLCBtc2cuc2VuZGVyKSk7CgogICAgICAgIC8vIHRvZG86IGJvb2trZWVwaW5nCiAgICAgICAgLy8gdG9kbzogZmlyZSBmdW5kaW5nIGV2ZW50CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU2NoZWR1bGUgb3JhY2xpemUgY2FsbCBmb3IgcGF5b3V0CiAgICAgKiBAcGFyYW0gX3BvbGljeUlkCiAgICAgKiBAcGFyYW0gX3Jpc2tJZAogICAgICogQHBhcmFtIF9vcmFjbGl6ZVRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gc2NoZWR1bGVQYXlvdXRPcmFjbGl6ZUNhbGwodWludCBfcG9saWN5SWQsIGJ5dGVzMzIgX3Jpc2tJZCwgdWludCBfb3JhY2xpemVUaW1lKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoRkRfQUMuY2hlY2tQZXJtaXNzaW9uKDEwMSwgbXNnLnNlbmRlcikpOwoKICAgICAgICB2YXIgKGNhcnJpZXJGbGlnaHROdW1iZXIsIGRlcGFydHVyZVllYXJNb250aERheSwpID0gRkRfREIuZ2V0Umlza1BhcmFtZXRlcnMoX3Jpc2tJZCk7CgogICAgICAgIHN0cmluZyBtZW1vcnkgb3JhY2xpemVVcmwgPSBzdHJDb25jYXQoCiAgICAgICAgICAgIE9SQUNMSVpFX1NUQVRVU19CQVNFX1VSTCwKICAgICAgICAgICAgYjMydG9TdHJpbmcoY2FycmllckZsaWdodE51bWJlciksCiAgICAgICAgICAgIGIzMnRvU3RyaW5nKGRlcGFydHVyZVllYXJNb250aERheSksCiAgICAgICAgICAgIE9SQUNMSVpFX1NUQVRVU19RVUVSWQogICAgICAgICk7CgogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KAogICAgICAgICAgICBfb3JhY2xpemVUaW1lLAogICAgICAgICAgICAibmVzdGVkIiwKICAgICAgICAgICAgb3JhY2xpemVVcmwsCiAgICAgICAgICAgIE9SQUNMSVpFX0dBUwogICAgICAgICk7CgogICAgICAgIEZEX0RCLmNyZWF0ZU9yYWNsaXplQ2FsbGJhY2soCiAgICAgICAgICAgIHF1ZXJ5SWQsCiAgICAgICAgICAgIF9wb2xpY3lJZCwKICAgICAgICAgICAgb3JhY2xpemVTdGF0ZS5Gb3JQYXlvdXQsCiAgICAgICAgICAgIF9vcmFjbGl6ZVRpbWUKICAgICAgICApOwoKICAgICAgICBMb2dPcmFjbGl6ZUNhbGwoX3BvbGljeUlkLCBxdWVyeUlkLCBvcmFjbGl6ZVVybCwgX29yYWNsaXplVGltZSk7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgT3JhY2xpemUgY2FsbGJhY2suIEluIGFuIGVtZXJnZW5jeSBjYXNlLCB3ZSBjYW4gY2FsbCB0aGlzIGRpcmVjdGx5IGZyb20gRkQuRW1lcmdlbmN5IEFjY291bnQuCiAgICAgKiBAcGFyYW0gX3F1ZXJ5SWQKICAgICAqIEBwYXJhbSBfcmVzdWx0CiAgICAgKiBAcGFyYW0gX3Byb29mCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgcHVibGljIG9ubHlPcmFjbGl6ZU9yKGdldENvbnRyYWN0KCdGRC5FbWVyZ2VuY3knKSkgewoKICAgICAgICB2YXIgKHBvbGljeUlkLCBvcmFjbGl6ZVRpbWUpID0gRkRfREIuZ2V0T3JhY2xpemVDYWxsYmFjayhfcXVlcnlJZCk7CiAgICAgICAgTG9nT3JhY2xpemVDYWxsYmFjayhwb2xpY3lJZCwgX3F1ZXJ5SWQsIF9yZXN1bHQsIF9wcm9vZik7CgogICAgICAgIC8vIGNoZWNrIGlmIHBvbGljeSB3YXMgZGVjbGluZWQgYWZ0ZXIgdGhpcyBjYWxsYmFjayB3YXMgc2NoZWR1bGVkCiAgICAgICAgdmFyIHN0YXRlID0gRkRfREIuZ2V0UG9saWN5U3RhdGUocG9saWN5SWQpOwogICAgICAgIHJlcXVpcmUodWludDgoc3RhdGUpICE9IDUpOwoKICAgICAgICBieXRlczMyIHJpc2tJZCA9IEZEX0RCLmdldFJpc2tJZChwb2xpY3lJZCk7CgovLyAtLT4gZGVidWctbW9kZQovLyAgICAgICAgICAgIExvZ0J5dGVzMzIoInJpc2tJZCIsIHJpc2tJZCk7Ci8vIDwtLSBkZWJ1Zy1tb2RlCgogICAgICAgIHZhciBzbFJlc3VsdCA9IF9yZXN1bHQudG9TbGljZSgpOwoKICAgICAgICBpZiAoYnl0ZXMoX3Jlc3VsdCkubGVuZ3RoID09IDApIHsgLy8gZW1wdHkgUmVzdWx0CiAgICAgICAgICAgIGlmIChGRF9EQi5jaGVja1RpbWUoX3F1ZXJ5SWQsIHJpc2tJZCwgMTgwIG1pbnV0ZXMpKSB7CiAgICAgICAgICAgICAgICBMb2dQb2xpY3lNYW51YWxQYXlvdXQocG9saWN5SWQsICJObyBDYWxsYmFjayBhdCArMTIwIG1pbiIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2NoZWR1bGVQYXlvdXRPcmFjbGl6ZUNhbGwocG9saWN5SWQsIHJpc2tJZCwgb3JhY2xpemVUaW1lICsgNDUgbWludXRlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBmaXJzdCBjaGVjayBzdGF0dXMKICAgICAgICAgICAgLy8gZXh0cmFjdCB0aGUgc3RhdHVzIGZpZWxkOgogICAgICAgICAgICBzbFJlc3VsdC5maW5kKCJcIiIudG9TbGljZSgpKS5iZXlvbmQoIlwiIi50b1NsaWNlKCkpOwogICAgICAgICAgICBzbFJlc3VsdC51bnRpbChzbFJlc3VsdC5jb3B5KCkuZmluZCgiXCIiLnRvU2xpY2UoKSkpOwogICAgICAgICAgICBieXRlczEgc3RhdHVzID0gYnl0ZXMoc2xSZXN1bHQudG9TdHJpbmcoKSlbMF07CS8vIHMgPSBMCiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gIkMiKSB7CiAgICAgICAgICAgICAgICAvLyBmbGlnaHQgY2FuY2VsbGVkIC0tPiBwYXlvdXQKICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgNCwgMCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09ICJEIikgewogICAgICAgICAgICAgICAgLy8gZmxpZ2h0IGRpdmVydGVkIC0tPiBwYXlvdXQKICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgNSwgMCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzICE9ICJMIiAmJiBzdGF0dXMgIT0gIkEiICYmIHN0YXR1cyAhPSAiQyIgJiYgc3RhdHVzICE9ICJEIikgewogICAgICAgICAgICAgICAgTG9nUG9saWN5TWFudWFsUGF5b3V0KHBvbGljeUlkLCAiVW5wcm9jZXNzYWJsZSBzdGF0dXMiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcHJvY2VzcyB0aGUgcmVzdCBvZiB0aGUgcmVzcG9uc2U6CiAgICAgICAgICAgIHNsUmVzdWx0ID0gX3Jlc3VsdC50b1NsaWNlKCk7CiAgICAgICAgICAgIGJvb2wgYXJyaXZlZCA9IHNsUmVzdWx0LmNvbnRhaW5zKCJhY3R1YWxHYXRlQXJyaXZhbCIudG9TbGljZSgpKTsKCiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gIkEiIHx8IChzdGF0dXMgPT0gIkwiICYmICFhcnJpdmVkKSkgewogICAgICAgICAgICAgICAgLy8gZmxpZ2h0IHN0aWxsIGFjdGl2ZSBvciBub3QgYXQgZ2F0ZSAtLT4gcmVzY2hlZHVsZQogICAgICAgICAgICAgICAgaWYgKEZEX0RCLmNoZWNrVGltZShfcXVlcnlJZCwgcmlza0lkLCAxODAgbWludXRlcykpIHsKICAgICAgICAgICAgICAgICAgICBMb2dQb2xpY3lNYW51YWxQYXlvdXQocG9saWN5SWQsICJObyBhcnJpdmFsIGF0ICsxODAgbWluIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlUGF5b3V0T3JhY2xpemVDYWxsKHBvbGljeUlkLCByaXNrSWQsIG9yYWNsaXplVGltZSArIDQ1IG1pbnV0ZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSAiTCIgJiYgYXJyaXZlZCkgewogICAgICAgICAgICAgICAgdmFyIGFHID0gIlwiYXJyaXZhbEdhdGVEZWxheU1pbnV0ZXNcIjogIi50b1NsaWNlKCk7CiAgICAgICAgICAgICAgICBpZiAoc2xSZXN1bHQuY29udGFpbnMoYUcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2xSZXN1bHQuZmluZChhRykuYmV5b25kKGFHKTsKICAgICAgICAgICAgICAgICAgICBzbFJlc3VsdC51bnRpbChzbFJlc3VsdC5jb3B5KCkuZmluZCgiXCIiLnRvU2xpY2UoKSkuYmV5b25kKCJcIiIudG9TbGljZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gdHJ1ZmZsZSBidWcsIHJlcGxhY2UgYnkgIn0iIGFzIHNvb24gYXMgaXQgaXMgZml4ZWQuCiAgICAgICAgICAgICAgICAgICAgc2xSZXN1bHQudW50aWwoc2xSZXN1bHQuY29weSgpLmZpbmQoIlx4N0QiLnRvU2xpY2UoKSkpOwogICAgICAgICAgICAgICAgICAgIHNsUmVzdWx0LnVudGlsKHNsUmVzdWx0LmNvcHkoKS5maW5kKCIsIi50b1NsaWNlKCkpKTsKICAgICAgICAgICAgICAgICAgICB1aW50IGRlbGF5SW5NaW51dGVzID0gcGFyc2VJbnQoc2xSZXN1bHQudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRlbGF5SW5NaW51dGVzID0gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZGVsYXlJbk1pbnV0ZXMgPCAxNSkgewogICAgICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgMCwgMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlbGF5SW5NaW51dGVzIDwgMzApIHsKICAgICAgICAgICAgICAgICAgICBwYXlPdXQocG9saWN5SWQsIDEsIGRlbGF5SW5NaW51dGVzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVsYXlJbk1pbnV0ZXMgPCA0NSkgewogICAgICAgICAgICAgICAgICAgIHBheU91dChwb2xpY3lJZCwgMiwgZGVsYXlJbk1pbnV0ZXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwYXlPdXQocG9saWN5SWQsIDMsIGRlbGF5SW5NaW51dGVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsgLy8gbm8gZGVsYXkgaW5mbwogICAgICAgICAgICAgICAgcGF5T3V0KHBvbGljeUlkLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogSW50ZXJuYWwgbWV0aG9kcwogICAgICovCgogICAgLyoKICAgICAqIEBkZXYgUGF5b3V0CiAgICAgKiBAcGFyYW0gX3BvbGljeUlkCiAgICAgKiBAcGFyYW0gX2RlbGF5CiAgICAgKiBAcGFyYW0gX2RlbGF5SW5NaW51dGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBheU91dCh1aW50IF9wb2xpY3lJZCwgdWludDggX2RlbGF5LCB1aW50IF9kZWxheUluTWludXRlcykJaW50ZXJuYWwgewovLyAtLT4gZGVidWctbW9kZQovLyAgICAgICAgICAgIExvZ1N0cmluZygiaW0gcGF5T3V0IiwgIiIpOwovLyAgICAgICAgICAgIExvZ1VpbnQoInBvbGljeUlkIiwgX3BvbGljeUlkKTsKLy8gICAgICAgICAgICBMb2dVaW50KCJkZWxheSIsIF9kZWxheSk7Ci8vICAgICAgICAgICAgTG9nVWludCgiaW4gbWludXRlcyIsIF9kZWxheUluTWludXRlcyk7Ci8vIDwtLSBkZWJ1Zy1tb2RlCgogICAgICAgIEZEX0RCLnNldERlbGF5KF9wb2xpY3lJZCwgX2RlbGF5LCBfZGVsYXlJbk1pbnV0ZXMpOwoKICAgICAgICBpZiAoX2RlbGF5ID09IDApIHsKICAgICAgICAgICAgRkRfREIuc2V0U3RhdGUoCiAgICAgICAgICAgICAgICBfcG9saWN5SWQsCiAgICAgICAgICAgICAgICBwb2xpY3lTdGF0ZS5FeHBpcmVkLAogICAgICAgICAgICAgICAgbm93LAogICAgICAgICAgICAgICAgIkV4cGlyZWQgLSBubyBkZWxheSEiCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIChjdXN0b21lciwgd2VpZ2h0LCBwcmVtaXVtKSA9IEZEX0RCLmdldFBvbGljeURhdGEoX3BvbGljeUlkKTsKCi8vIC0tPiBkZWJ1Zy1tb2RlCi8vICAgICAgICAgICAgICAgIExvZ1VpbnQoIndlaWdodCIsIHdlaWdodCk7Ci8vIDwtLSBkZWJ1Zy1tb2RlCgogICAgICAgICAgICBpZiAod2VpZ2h0ID09IDApIHsKICAgICAgICAgICAgICAgIHdlaWdodCA9IDIwMDAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1aW50IHBheW91dCA9IHByZW1pdW0gKiBXRUlHSFRfUEFUVEVSTltfZGVsYXldICogMTAwMDAgLyB3ZWlnaHQ7CiAgICAgICAgICAgIHVpbnQgY2FsY3VsYXRlZFBheW91dCA9IHBheW91dDsKCiAgICAgICAgICAgIGlmIChwYXlvdXQgPiBNQVhfUEFZT1VUKSB7CiAgICAgICAgICAgICAgICBwYXlvdXQgPSBNQVhfUEFZT1VUOwogICAgICAgICAgICB9CgogICAgICAgICAgICBGRF9EQi5zZXRQYXlvdXRzKF9wb2xpY3lJZCwgY2FsY3VsYXRlZFBheW91dCwgcGF5b3V0KTsKCiAgICAgICAgICAgIGlmICghRkRfTEcuc2VuZEZ1bmRzKGN1c3RvbWVyLCBBY2MuUGF5b3V0LCBwYXlvdXQpKSB7CiAgICAgICAgICAgICAgICBGRF9EQi5zZXRTdGF0ZSgKICAgICAgICAgICAgICAgICAgICBfcG9saWN5SWQsCiAgICAgICAgICAgICAgICAgICAgcG9saWN5U3RhdGUuU2VuZEZhaWxlZCwKICAgICAgICAgICAgICAgICAgICBub3csCiAgICAgICAgICAgICAgICAgICAgIlBheW91dCwgc2VuZCBmYWlsZWQhIgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBGRF9EQi5zZXRQYXlvdXRzKF9wb2xpY3lJZCwgY2FsY3VsYXRlZFBheW91dCwgMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBGRF9EQi5zZXRTdGF0ZSgKICAgICAgICAgICAgICAgICAgICBfcG9saWN5SWQsCiAgICAgICAgICAgICAgICAgICAgcG9saWN5U3RhdGUuUGFpZE91dCwKICAgICAgICAgICAgICAgICAgICBub3csCiAgICAgICAgICAgICAgICAgICAgIlBheW91dCBzdWNjZXNzZnVsISIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0='.
	

]
