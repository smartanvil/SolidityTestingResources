Class {
	#name : #SRTCF28Bf20B662F746A4B487FA81de5A40ac0af49C,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTCF28Bf20B662F746A4B487FA81de5A40ac0af49C >> base64 [
	^ 'LyoKICAgIEdvbGQgUmVzZXJ2ZSBbWEdSXQogICAgMS4wLjAKICAgIAogICAgUmFqY2kgJ2lGQScgQW5kb3IgQCA8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImExYzhjN2MwZTFjN2Q0ZDJjOGNlY2ZkNmMwY2RjZGM0ZDU4ZmM4Y2UiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+CiovCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKY29udHJhY3QgU2FmZU1hdGggewogICAgLyogSW50ZXJuYWxzICovCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIGlmICggYiA+IDAgKSB7CiAgICAgICAgICAgIGFzc2VydCggYSArIGIgPiBhICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgaWYgKCBiID4gMCApIHsKICAgICAgICAgICAgYXNzZXJ0KCBhIC0gYiA8IGEgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQogICAgZnVuY3Rpb24gc2FmZURpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSAvIGI7CiAgICB9Cn0KCmNvbnRyYWN0IE93bmVkIHsKICAgIC8qIFZhcmlhYmxlcyAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgLyogRXh0ZXJuYWxzICovCiAgICBmdW5jdGlvbiByZXBsYWNlT3duZXIoYWRkcmVzcyBuZXdPd25lcikgZXh0ZXJuYWwgcmV0dXJucyhib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKCBpc093bmVyKCkgKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyogSW50ZXJuYWxzICovCiAgICBmdW5jdGlvbiBpc093bmVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gb3duZXIgPT0gbXNnLnNlbmRlcjsKICAgIH0KICAgIC8qIE1vZGlmaWVycyAqLwogICAgbW9kaWZpZXIgb25seUZvck93bmVyIHsKICAgICAgICByZXF1aXJlKCBpc093bmVyKCkgKTsKICAgICAgICBfOwogICAgfQp9Cgpjb250cmFjdCBUb2tlbiBpcyBTYWZlTWF0aCwgT3duZWQgewogICAgLyoqCiAgICAqIEB0aXRsZSBHb2xkIFJlc2VydmUgW1hHUl0gdG9rZW4KICAgICovCiAgICAvKiBWYXJpYWJsZXMgKi8KICAgIHN0cmluZyAgcHVibGljIG5hbWUgPSAiR29sZFJlc2VydmUiOwogICAgc3RyaW5nICBwdWJsaWMgc3ltYm9sID0gIlhHUiI7CiAgICB1aW50OCAgIHB1YmxpYyBkZWNpbWFscyA9IDg7CiAgICB1aW50MjU2IHB1YmxpYyB0cmFuc2FjdGlvbkZlZVJhdGUgICA9IDIwOyAvLyAwLjAyICUKICAgIHVpbnQyNTYgcHVibGljIHRyYW5zYWN0aW9uRmVlUmF0ZU0gID0gMWUzOyAvLyAxMDAwCiAgICB1aW50MjU2IHB1YmxpYyB0cmFuc2FjdGlvbkZlZU1pbiAgICA9ICAgMjAwMDAwMDsgLy8gMC4yIFhHUgogICAgdWludDI1NiBwdWJsaWMgdHJhbnNhY3Rpb25GZWVNYXggICAgPSAyMDAwMDAwMDA7IC8vIDIuMCBYR1IKICAgIGFkZHJlc3MgcHVibGljIGRhdGFiYXNlQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGRlcG9zaXRzQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGZvcmtBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgbGliQWRkcmVzczsKICAgIC8qIENvbnN0cnVjdG9yICovCiAgICBmdW5jdGlvbiBUb2tlbihhZGRyZXNzIG5ld0RhdGFiYXNlQWRkcmVzcywgYWRkcmVzcyBuZXdEZXBvc2l0QWRkcmVzcywgYWRkcmVzcyBuZXdGcm9rQWRkcmVzcywgYWRkcmVzcyBuZXdMaWJBZGRyZXNzKSBwdWJsaWMgewogICAgICAgIGRhdGFiYXNlQWRkcmVzcyA9IG5ld0RhdGFiYXNlQWRkcmVzczsKICAgICAgICBkZXBvc2l0c0FkZHJlc3MgPSBuZXdEZXBvc2l0QWRkcmVzczsKICAgICAgICBmb3JrQWRkcmVzcyA9IG5ld0Zyb2tBZGRyZXNzOwogICAgICAgIGxpYkFkZHJlc3MgPSBuZXdMaWJBZGRyZXNzOwogICAgfQogICAgLyogRmFsbGJhY2sgKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8qIEV4dGVybmFscyAqLwogICAgZnVuY3Rpb24gY2hhbmdlRGF0YUJhc2VBZGRyZXNzKGFkZHJlc3MgbmV3RGF0YWJhc2VBZGRyZXNzKSBleHRlcm5hbCBvbmx5Rm9yT3duZXIgewogICAgICAgIGRhdGFiYXNlQWRkcmVzcyA9IG5ld0RhdGFiYXNlQWRkcmVzczsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZURlcG9zaXRzQWRkcmVzcyhhZGRyZXNzIG5ld0RlcG9zaXRzQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICBkZXBvc2l0c0FkZHJlc3MgPSBuZXdEZXBvc2l0c0FkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VGb3JrQWRkcmVzcyhhZGRyZXNzIG5ld0ZvcmtBZGRyZXNzKSBleHRlcm5hbCBvbmx5Rm9yT3duZXIgewogICAgICAgIGZvcmtBZGRyZXNzID0gbmV3Rm9ya0FkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VMaWJBZGRyZXNzKGFkZHJlc3MgbmV3TGliQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICBsaWJBZGRyZXNzID0gbmV3TGliQWRkcmVzczsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZUZlZXModWludDI1NiByYXRlLCB1aW50MjU2IHJhdGVNdWx0aXBsaWVyLCB1aW50MjU2IG1pbiwgdWludDI1NiBtYXgpIGV4dGVybmFsIG9ubHlGb3JPd25lciB7CiAgICAgICAgdHJhbnNhY3Rpb25GZWVSYXRlID0gcmF0ZTsKICAgICAgICB0cmFuc2FjdGlvbkZlZVJhdGVNID0gcmF0ZU11bHRpcGxpZXI7CiAgICAgICAgdHJhbnNhY3Rpb25GZWVNaW4gPSBtaW47CiAgICAgICAgdHJhbnNhY3Rpb25GZWVNYXggPSBtYXg7CiAgICB9CiAgICAvKioKICAgICAqIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBzcGVuZGVyYCB0byBzcGVuZCBgYW1vdW50YCB0b2tlbnMgb24gaXRzIGJlaGFsZi4KICAgICAqIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgICogQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgICAqIEBwYXJhbSBub25jZSBUaGUgdHJhbnNhY3Rpb24gY291bnQgb2YgdGhlIGF1dGhvcmlzZWQgYWRkcmVzcwogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgbm9uY2UpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFkZHJlc3MgX3RyZyA9IGxpYkFkZHJlc3M7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbSA6PSBtbG9hZCgweDIwKQogICAgICAgICAgICBjYWxsZGF0YWNvcHkobSwgMCwgY2FsbGRhdGFzaXplKQogICAgICAgICAgICBsZXQgc3VjY2VzcyA6PSBkZWxlZ2F0ZWNhbGwoZ2FzLCBfdHJnLCBtLCBjYWxsZGF0YXNpemUsIG0sIDB4MjApCiAgICAgICAgICAgIHN3aXRjaCBzdWNjZXNzIGNhc2UgMCB7CiAgICAgICAgICAgICAgICBpbnZhbGlkCiAgICAgICAgICAgIH0gZGVmYXVsdCB7CiAgICAgICAgICAgICAgICByZXR1cm4obSwgMHgyMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYHNwZW5kZXJgIHRvIHNwZW5kIGBhbW91bnRgIHRva2VucyBvbiBpdHMgYmVoYWxmIGFuZCBub3RpZnkgdGhlIHNwZW5kZXIgZnJvbSB5b3VyIGFwcHJvdmUgd2l0aCB5b3VyIGBleHRyYURhdGFgIGRhdGEuCiAgICAgKiBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAgKiBAcGFyYW0gbm9uY2UgVGhlIHRyYW5zYWN0aW9uIGNvdW50IG9mIHRoZSBhdXRob3Jpc2VkIGFkZHJlc3MKICAgICAqIEBwYXJhbSBleHRyYURhdGEgRGF0YSB0byBnaXZlIGZvcndhcmQgdG8gdGhlIHJlY2VpdmVyCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgbm9uY2UsIGJ5dGVzIGV4dHJhRGF0YSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWRkcmVzcyBfdHJnID0gbGliQWRkcmVzczsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBtIDo9IG1sb2FkKDB4MjApCiAgICAgICAgICAgIGNhbGxkYXRhY29weShtLCAwLCBjYWxsZGF0YXNpemUpCiAgICAgICAgICAgIGxldCBzdWNjZXNzIDo9IGRlbGVnYXRlY2FsbChnYXMsIF90cmcsIG0sIGNhbGxkYXRhc2l6ZSwgbSwgMHgyMCkKICAgICAgICAgICAgc3dpdGNoIHN1Y2Nlc3MgY2FzZSAwIHsKICAgICAgICAgICAgICAgIGludmFsaWQKICAgICAgICAgICAgfSBkZWZhdWx0IHsKICAgICAgICAgICAgICAgIHJldHVybihtLCAweDIwKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAbm90aWNlIFNlbmQgYGFtb3VudGAgdG9rZW5zIHRvIGB0b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgICAqIEBwYXJhbSB0byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWRkcmVzcyBfdHJnID0gbGliQWRkcmVzczsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBtIDo9IG1sb2FkKDB4MjApCiAgICAgICAgICAgIGNhbGxkYXRhY29weShtLCAwLCBjYWxsZGF0YXNpemUpCiAgICAgICAgICAgIGxldCBzdWNjZXNzIDo9IGRlbGVnYXRlY2FsbChnYXMsIF90cmcsIG0sIGNhbGxkYXRhc2l6ZSwgbSwgMHgyMCkKICAgICAgICAgICAgc3dpdGNoIHN1Y2Nlc3MgY2FzZSAwIHsKICAgICAgICAgICAgICAgIGludmFsaWQKICAgICAgICAgICAgfSBkZWZhdWx0IHsKICAgICAgICAgICAgICAgIHJldHVybihtLCAweDIwKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAbm90aWNlIFNlbmQgYGFtb3VudGAgdG9rZW5zIHRvIGB0b2AgZnJvbSBgZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgZnJvbWAKICAgICAqIEBwYXJhbSBmcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgICogQHBhcmFtIHRvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFkZHJlc3MgX3RyZyA9IGxpYkFkZHJlc3M7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbSA6PSBtbG9hZCgweDIwKQogICAgICAgICAgICBjYWxsZGF0YWNvcHkobSwgMCwgY2FsbGRhdGFzaXplKQogICAgICAgICAgICBsZXQgc3VjY2VzcyA6PSBkZWxlZ2F0ZWNhbGwoZ2FzLCBfdHJnLCBtLCBjYWxsZGF0YXNpemUsIG0sIDB4MjApCiAgICAgICAgICAgIHN3aXRjaCBzdWNjZXNzIGNhc2UgMCB7CiAgICAgICAgICAgICAgICBpbnZhbGlkCiAgICAgICAgICAgIH0gZGVmYXVsdCB7CiAgICAgICAgICAgICAgICByZXR1cm4obSwgMHgyMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQG5vdGljZSBTZW5kIGBhbW91bnRgIHRva2VucyB0byBgdG9gIGZyb20gYG1zZy5zZW5kZXJgIGFuZCBub3RpZnkgdGhlIHJlY2VpdmVyIGZyb20geW91ciB0cmFuc2FjdGlvbiB3aXRoIHlvdXIgYGV4dHJhRGF0YWAgZGF0YQogICAgICogQHBhcmFtIHRvIFRoZSBjb250cmFjdCBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqIEBwYXJhbSBleHRyYURhdGEgRGF0YSB0byBnaXZlIGZvcndhcmQgdG8gdGhlIHJlY2VpdmVyCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCwgYnl0ZXMgZXh0cmFEYXRhKSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhZGRyZXNzIF90cmcgPSBsaWJBZGRyZXNzOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IG0gOj0gbWxvYWQoMHgyMCkKICAgICAgICAgICAgY2FsbGRhdGFjb3B5KG0sIDAsIGNhbGxkYXRhc2l6ZSkKICAgICAgICAgICAgbGV0IHN1Y2Nlc3MgOj0gZGVsZWdhdGVjYWxsKGdhcywgX3RyZywgbSwgY2FsbGRhdGFzaXplLCBtLCAweDIwKQogICAgICAgICAgICBzd2l0Y2ggc3VjY2VzcyBjYXNlIDAgewogICAgICAgICAgICAgICAgaW52YWxpZAogICAgICAgICAgICB9IGRlZmF1bHQgewogICAgICAgICAgICAgICAgcmV0dXJuKG0sIDB4MjApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgdmFsdWUpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFkZHJlc3MgX3RyZyA9IGxpYkFkZHJlc3M7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbSA6PSBtbG9hZCgweDIwKQogICAgICAgICAgICBjYWxsZGF0YWNvcHkobSwgMCwgY2FsbGRhdGFzaXplKQogICAgICAgICAgICBsZXQgc3VjY2VzcyA6PSBkZWxlZ2F0ZWNhbGwoZ2FzLCBfdHJnLCBtLCBjYWxsZGF0YXNpemUsIG0sIDB4MjApCiAgICAgICAgICAgIHN3aXRjaCBzdWNjZXNzIGNhc2UgMCB7CiAgICAgICAgICAgICAgICBpbnZhbGlkCiAgICAgICAgICAgIH0gZGVmYXVsdCB7CiAgICAgICAgICAgICAgICByZXR1cm4obSwgMHgyMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIC8qIEludGVybmFscyAqLwogICAgLyogQ29uc3RhbnRzICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcsIHVpbnQyNTYgbm9uY2UpIHsKICAgICAgICBhZGRyZXNzIF90cmcgPSBsaWJBZGRyZXNzOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IG0gOj0gbWxvYWQoMHgyMCkKICAgICAgICAgICAgY2FsbGRhdGFjb3B5KG0sIDAsIGNhbGxkYXRhc2l6ZSkKICAgICAgICAgICAgbGV0IHN1Y2Nlc3MgOj0gZGVsZWdhdGVjYWxsKGdhcywgX3RyZywgbSwgY2FsbGRhdGFzaXplLCBtLCAweDQwKQogICAgICAgICAgICBzd2l0Y2ggc3VjY2VzcyBjYXNlIDAgewogICAgICAgICAgICAgICAgaW52YWxpZAogICAgICAgICAgICB9IGRlZmF1bHQgewogICAgICAgICAgICAgICAgcmV0dXJuKG0sIDB4NDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkZlZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzLCB1aW50MjU2IGZlZSkgewogICAgICAgIGFkZHJlc3MgX3RyZyA9IGxpYkFkZHJlc3M7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbSA6PSBtbG9hZCgweDIwKQogICAgICAgICAgICBjYWxsZGF0YWNvcHkobSwgMCwgY2FsbGRhdGFzaXplKQogICAgICAgICAgICBsZXQgc3VjY2VzcyA6PSBkZWxlZ2F0ZWNhbGwoZ2FzLCBfdHJnLCBtLCBjYWxsZGF0YXNpemUsIG0sIDB4NDApCiAgICAgICAgICAgIHN3aXRjaCBzdWNjZXNzIGNhc2UgMCB7CiAgICAgICAgICAgICAgICBpbnZhbGlkCiAgICAgICAgICAgIH0gZGVmYXVsdCB7CiAgICAgICAgICAgICAgICByZXR1cm4obSwgMHg0MCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB2YWx1ZSkgewogICAgICAgIGFkZHJlc3MgX3RyZyA9IGxpYkFkZHJlc3M7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbSA6PSBtbG9hZCgweDIwKQogICAgICAgICAgICBjYWxsZGF0YWNvcHkobSwgMCwgY2FsbGRhdGFzaXplKQogICAgICAgICAgICBsZXQgc3VjY2VzcyA6PSBkZWxlZ2F0ZWNhbGwoZ2FzLCBfdHJnLCBtLCBjYWxsZGF0YXNpemUsIG0sIDB4MjApCiAgICAgICAgICAgIHN3aXRjaCBzdWNjZXNzIGNhc2UgMCB7CiAgICAgICAgICAgICAgICBpbnZhbGlkCiAgICAgICAgICAgIH0gZGVmYXVsdCB7CiAgICAgICAgICAgICAgICByZXR1cm4obSwgMHgyMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VzT2YoYWRkcmVzcyBvd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSwgdWludDI1NiBsb2NrZWRBbW91bnQpIHsKICAgICAgICBhZGRyZXNzIF90cmcgPSBsaWJBZGRyZXNzOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IG0gOj0gbWxvYWQoMHgyMCkKICAgICAgICAgICAgY2FsbGRhdGFjb3B5KG0sIDAsIGNhbGxkYXRhc2l6ZSkKICAgICAgICAgICAgbGV0IHN1Y2Nlc3MgOj0gZGVsZWdhdGVjYWxsKGdhcywgX3RyZywgbSwgY2FsbGRhdGFzaXplLCBtLCAweDQwKQogICAgICAgICAgICBzd2l0Y2ggc3VjY2VzcyBjYXNlIDAgewogICAgICAgICAgICAgICAgaW52YWxpZAogICAgICAgICAgICB9IGRlZmF1bHQgewogICAgICAgICAgICAgICAgcmV0dXJuKG0sIDB4NDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHZhbHVlKSB7CiAgICAgICAgYWRkcmVzcyBfdHJnID0gbGliQWRkcmVzczsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBtIDo9IG1sb2FkKDB4MjApCiAgICAgICAgICAgIGNhbGxkYXRhY29weShtLCAwLCBjYWxsZGF0YXNpemUpCiAgICAgICAgICAgIGxldCBzdWNjZXNzIDo9IGRlbGVnYXRlY2FsbChnYXMsIF90cmcsIG0sIGNhbGxkYXRhc2l6ZSwgbSwgMHgyMCkKICAgICAgICAgICAgc3dpdGNoIHN1Y2Nlc3MgY2FzZSAwIHsKICAgICAgICAgICAgICAgIGludmFsaWQKICAgICAgICAgICAgfSBkZWZhdWx0IHsKICAgICAgICAgICAgICAgIHJldHVybihtLCAweDIwKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLyogRXZlbnRzICovCiAgICBldmVudCBBbGxvd2FuY2VVc2VkKGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCBhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgaW5kZXhlZCB2YWx1ZSk7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IGluZGV4ZWQgdmFsdWUpOwogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYWRkciwgdWludDI1NiBpbmRleGVkIHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBUcmFuc2ZlcjIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBpbmRleGVkIHZhbHVlLCBieXRlcyBkYXRhKTsKfQoKY29udHJhY3QgVG9rZW5EQiBpcyBTYWZlTWF0aCwgT3duZWQgewogICAgLyogU3RydWN0dXJlcyAqLwogICAgc3RydWN0IGFsbG93YW5jZV9zIHsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50MjU2IG5vbmNlOwogICAgfQogICAgc3RydWN0IGRlcG9zaXRzX3MgewogICAgICAgIGFkZHJlc3MgYWRkcjsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50MjU2IHN0YXJ0OwogICAgICAgIHVpbnQyNTYgZW5kOwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RPbkVuZDsKICAgICAgICB1aW50MjU2IGludGVyZXN0QmVmb3JlRW5kOwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RGZWU7CiAgICAgICAgdWludDI1NiBpbnRlcmVzdE11bHRpcGxpZXI7CiAgICAgICAgYm9vbCAgICBjbG9zZWFibGU7CiAgICAgICAgYm9vbCAgICB2YWxpZDsKICAgIH0KICAgIC8qIFZhcmlhYmxlcyAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiBhbGxvd2FuY2VfcykpIHB1YmxpYyBhbGxvd2FuY2U7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsKICAgIG1hcHBpbmcodWludDI1NiA9PiBkZXBvc2l0c19zKSBwcml2YXRlIGRlcG9zaXRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBsb2NrZWRCYWxhbmNlczsKICAgIGFkZHJlc3MgcHVibGljIHRva2VuQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGRlcG9zaXRzQWRkcmVzczsKICAgIHVpbnQyNTYgcHVibGljIGRlcG9zaXRzQ291bnRlcjsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgLyogQ29uc3RydWN0b3IgKi8KICAgIC8qIEV4dGVybmFscyAqLwogICAgZnVuY3Rpb24gY2hhbmdlVG9rZW5BZGRyZXNzKGFkZHJlc3MgbmV3VG9rZW5BZGRyZXNzKSBleHRlcm5hbCBvbmx5Rm9yT3duZXIgewogICAgICAgIHRva2VuQWRkcmVzcyA9IG5ld1Rva2VuQWRkcmVzczsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZURlcG9zaXRzQWRkcmVzcyhhZGRyZXNzIG5ld0RlcG9zaXRzQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICBkZXBvc2l0c0FkZHJlc3MgPSBuZXdEZXBvc2l0c0FkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiBvcGVuRGVwb3NpdChhZGRyZXNzIGFkZHIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IGVuZCwgdWludDI1NiBpbnRlcmVzdE9uRW5kLAogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RCZWZvcmVFbmQsIHVpbnQyNTYgaW50ZXJlc3RGZWUsIHVpbnQyNTYgbXVsdGlwbGllciwgYm9vbCBjbG9zZWFibGUpIGV4dGVybmFsIG9ubHlGb3JEZXBvc2l0cyByZXR1cm5zKGJvb2wgc3VjY2VzcywgdWludDI1NiBESUQpIHsKICAgICAgICBkZXBvc2l0c0NvdW50ZXIgKz0gMTsKICAgICAgICBESUQgPSBkZXBvc2l0c0NvdW50ZXI7CiAgICAgICAgbG9ja2VkQmFsYW5jZXNbYWRkcl0gPSBzYWZlQWRkKGxvY2tlZEJhbGFuY2VzW2FkZHJdLCBhbW91bnQpOwogICAgICAgIGRlcG9zaXRzW0RJRF0gPSBkZXBvc2l0c19zKAogICAgICAgICAgICBhZGRyLAogICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgIGJsb2NrLm51bWJlciwKICAgICAgICAgICAgZW5kLAogICAgICAgICAgICBpbnRlcmVzdE9uRW5kLAogICAgICAgICAgICBpbnRlcmVzdEJlZm9yZUVuZCwKICAgICAgICAgICAgaW50ZXJlc3RGZWUsCiAgICAgICAgICAgIG11bHRpcGxpZXIsCiAgICAgICAgICAgIGNsb3NlYWJsZSwKICAgICAgICAgICAgdHJ1ZQogICAgICAgICk7CiAgICAgICAgcmV0dXJuICh0cnVlLCBESUQpOwogICAgfQogICAgZnVuY3Rpb24gY2xvc2VEZXBvc2l0KHVpbnQyNTYgRElEKSBleHRlcm5hbCBvbmx5Rm9yRGVwb3NpdHMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSggZGVwb3NpdHNbRElEXS52YWxpZCApOwogICAgICAgIGRlbGV0ZSBkZXBvc2l0c1tESURdLnZhbGlkOwogICAgICAgIGxvY2tlZEJhbGFuY2VzW2RlcG9zaXRzW0RJRF0uYWRkcl0gPSBzYWZlU3ViKGxvY2tlZEJhbGFuY2VzW2RlcG9zaXRzW0RJRF0uYWRkcl0sIGRlcG9zaXRzW0RJRF0uYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgZmVlKSBleHRlcm5hbCBvbmx5Rm9yVG9rZW4gcmV0dXJucyhib29sIHN1Y2Nlc3MpIHsKICAgICAgICBiYWxhbmNlT2ZbZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VPZltmcm9tXSwgc2FmZUFkZChhbW91bnQsIGZlZSkpOwogICAgICAgIGJhbGFuY2VPZlt0b10gPSBzYWZlQWRkKGJhbGFuY2VPZlt0b10sIGFtb3VudCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCBmZWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gaW5jcmVhc2UoYWRkcmVzcyBvd25lciwgdWludDI1NiB2YWx1ZSkgZXh0ZXJuYWwgb25seUZvclRva2VuIHJldHVybnMoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYmFsYW5jZU9mW293bmVyXSA9IHNhZmVBZGQoYmFsYW5jZU9mW293bmVyXSwgdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gZGVjcmVhc2UoYWRkcmVzcyBvd25lciwgdWludDI1NiB2YWx1ZSkgZXh0ZXJuYWwgb25seUZvclRva2VuIHJldHVybnMoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSggc2FmZVN1YihiYWxhbmNlT2Zbb3duZXJdLCBzYWZlQWRkKGxvY2tlZEJhbGFuY2VzW293bmVyXSwgdmFsdWUpKSA+PSAwICk7CiAgICAgICAgYmFsYW5jZU9mW293bmVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW293bmVyXSwgdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gc2V0QWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgbm9uY2UpIGV4dGVybmFsIG9ubHlGb3JUb2tlbiByZXR1cm5zKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93YW5jZVtvd25lcl1bc3BlbmRlcl0uYW1vdW50ID0gYW1vdW50OwogICAgICAgIGFsbG93YW5jZVtvd25lcl1bc3BlbmRlcl0ubm9uY2UgPSBub25jZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qIENvbnN0YW50cyAqLwogICAgZnVuY3Rpb24gZ2V0QWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCBzdWNjZXNzLCB1aW50MjU2IHJlbWFpbmluZywgdWludDI1NiBub25jZSkgewogICAgICAgIHJldHVybiAoIHRydWUsIGFsbG93YW5jZVtvd25lcl1bc3BlbmRlcl0uYW1vdW50LCBhbGxvd2FuY2Vbb3duZXJdW3NwZW5kZXJdLm5vbmNlICk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXREZXBvc2l0KHVpbnQyNTYgVUlEKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzIGFkZHIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHN0YXJ0LAogICAgICAgIHVpbnQyNTYgZW5kLCB1aW50MjU2IGludGVyZXN0T25FbmQsIHVpbnQyNTYgaW50ZXJlc3RCZWZvcmVFbmQsIHVpbnQyNTYgaW50ZXJlc3RGZWUsIHVpbnQyNTYgaW50ZXJlc3RNdWx0aXBsaWVyLCBib29sIGNsb3NlYWJsZSwgYm9vbCB2YWxpZCkgewogICAgICAgIGFkZHIgPSBkZXBvc2l0c1tVSURdLmFkZHI7CiAgICAgICAgYW1vdW50ID0gZGVwb3NpdHNbVUlEXS5hbW91bnQ7CiAgICAgICAgc3RhcnQgPSBkZXBvc2l0c1tVSURdLnN0YXJ0OwogICAgICAgIGVuZCA9IGRlcG9zaXRzW1VJRF0uZW5kOwogICAgICAgIGludGVyZXN0T25FbmQgPSBkZXBvc2l0c1tVSURdLmludGVyZXN0T25FbmQ7CiAgICAgICAgaW50ZXJlc3RCZWZvcmVFbmQgPSBkZXBvc2l0c1tVSURdLmludGVyZXN0QmVmb3JlRW5kOwogICAgICAgIGludGVyZXN0RmVlID0gZGVwb3NpdHNbVUlEXS5pbnRlcmVzdEZlZTsKICAgICAgICBpbnRlcmVzdE11bHRpcGxpZXIgPSBkZXBvc2l0c1tVSURdLmludGVyZXN0TXVsdGlwbGllcjsKICAgICAgICBjbG9zZWFibGUgPSBkZXBvc2l0c1tVSURdLmNsb3NlYWJsZTsKICAgICAgICB2YWxpZCA9IGRlcG9zaXRzW1VJRF0udmFsaWQ7CiAgICB9CiAgICAvKiBNb2RpZmllcnMgKi8KICAgIG1vZGlmaWVyIG9ubHlGb3JUb2tlbiB7CiAgICAgICAgcmVxdWlyZSggbXNnLnNlbmRlciA9PSB0b2tlbkFkZHJlc3MgKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgb25seUZvckRlcG9zaXRzIHsKICAgICAgICByZXF1aXJlKCBtc2cuc2VuZGVyID09IGRlcG9zaXRzQWRkcmVzcyApOwogICAgICAgIF87CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuTGliIGlzIFNhZmVNYXRoLCBPd25lZCB7CiAgICAvKioKICAgICogQHRpdGxlIEdvbGQgUmVzZXJ2ZSBbWEdSXSB0b2tlbgogICAgKi8KICAgIC8qIFZhcmlhYmxlcyAqLwogICAgc3RyaW5nICBwdWJsaWMgbmFtZSA9ICJHb2xkUmVzZXJ2ZSI7CiAgICBzdHJpbmcgIHB1YmxpYyBzeW1ib2wgPSAiWEdSIjsKICAgIHVpbnQ4ICAgcHVibGljIGRlY2ltYWxzID0gODsKICAgIHVpbnQyNTYgcHVibGljIHRyYW5zYWN0aW9uRmVlUmF0ZSAgID0gMjA7IC8vIDAuMDIgJQogICAgdWludDI1NiBwdWJsaWMgdHJhbnNhY3Rpb25GZWVSYXRlTSAgPSAxZTM7IC8vIDEwMDAKICAgIHVpbnQyNTYgcHVibGljIHRyYW5zYWN0aW9uRmVlTWluICAgID0gICAyMDAwMDAwOyAvLyAwLjIgWEdSCiAgICB1aW50MjU2IHB1YmxpYyB0cmFuc2FjdGlvbkZlZU1heCAgICA9IDIwMDAwMDAwMDsgLy8gMi4wIFhHUgogICAgYWRkcmVzcyBwdWJsaWMgZGF0YWJhc2VBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgZGVwb3NpdHNBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgZm9ya0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBsaWJBZGRyZXNzOwogICAgLyogQ29uc3RydWN0b3IgKi8KICAgIGZ1bmN0aW9uIFRva2VuTGliKGFkZHJlc3MgbmV3RGF0YWJhc2VBZGRyZXNzLCBhZGRyZXNzIG5ld0RlcG9zaXRBZGRyZXNzLCBhZGRyZXNzIG5ld0Zyb2tBZGRyZXNzLCBhZGRyZXNzIG5ld0xpYkFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgZGF0YWJhc2VBZGRyZXNzID0gbmV3RGF0YWJhc2VBZGRyZXNzOwogICAgICAgIGRlcG9zaXRzQWRkcmVzcyA9IG5ld0RlcG9zaXRBZGRyZXNzOwogICAgICAgIGZvcmtBZGRyZXNzID0gbmV3RnJva0FkZHJlc3M7CiAgICAgICAgbGliQWRkcmVzcyA9IG5ld0xpYkFkZHJlc3M7CiAgICB9CiAgICAvKiBGYWxsYmFjayAqLwogICAgZnVuY3Rpb24gKCkgcHVibGljIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8qIEV4dGVybmFscyAqLwogICAgZnVuY3Rpb24gY2hhbmdlRGF0YUJhc2VBZGRyZXNzKGFkZHJlc3MgbmV3RGF0YWJhc2VBZGRyZXNzKSBleHRlcm5hbCBvbmx5Rm9yT3duZXIgewogICAgICAgIGRhdGFiYXNlQWRkcmVzcyA9IG5ld0RhdGFiYXNlQWRkcmVzczsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZURlcG9zaXRzQWRkcmVzcyhhZGRyZXNzIG5ld0RlcG9zaXRzQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICBkZXBvc2l0c0FkZHJlc3MgPSBuZXdEZXBvc2l0c0FkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VGb3JrQWRkcmVzcyhhZGRyZXNzIG5ld0ZvcmtBZGRyZXNzKSBleHRlcm5hbCBvbmx5Rm9yT3duZXIgewogICAgICAgIGZvcmtBZGRyZXNzID0gbmV3Rm9ya0FkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VMaWJBZGRyZXNzKGFkZHJlc3MgbmV3TGliQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICBsaWJBZGRyZXNzID0gbmV3TGliQWRkcmVzczsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZUZlZXModWludDI1NiByYXRlLCB1aW50MjU2IHJhdGVNdWx0aXBsaWVyLCB1aW50MjU2IG1pbiwgdWludDI1NiBtYXgpIGV4dGVybmFsIG9ubHlGb3JPd25lciB7CiAgICAgICAgdHJhbnNhY3Rpb25GZWVSYXRlID0gcmF0ZTsKICAgICAgICB0cmFuc2FjdGlvbkZlZVJhdGVNID0gcmF0ZU11bHRpcGxpZXI7CiAgICAgICAgdHJhbnNhY3Rpb25GZWVNaW4gPSBtaW47CiAgICAgICAgdHJhbnNhY3Rpb25GZWVNYXggPSBtYXg7CiAgICB9CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgbm9uY2UpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIF9hcHByb3ZlKHNwZW5kZXIsIGFtb3VudCwgbm9uY2UpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiBub25jZSwgYnl0ZXMgZXh0cmFEYXRhKSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBfYXBwcm92ZShzcGVuZGVyLCBhbW91bnQsIG5vbmNlKTsKICAgICAgICByZXF1aXJlKCBjaGVja0NvbnRyYWN0KHNwZW5kZXIpICk7CiAgICAgICAgcmVxdWlyZSggU2FtcGxlQ29udHJhY3Qoc3BlbmRlcikuYXBwcm92ZWRUb2tlbihtc2cuc2VuZGVyLCBhbW91bnQsIGV4dHJhRGF0YSkgKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2RhdGE7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCBhbW91bnQsIHRydWUsIF9kYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIGZyb20gIT0gbXNnLnNlbmRlciApIHsKICAgICAgICAgICAgdmFyIChfc3VjY2VzcywgX3JlYW1pbmluZywgX25vbmNlKSA9IFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5nZXRBbGxvd2FuY2UoZnJvbSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIHJlcXVpcmUoIF9zdWNjZXNzICk7CiAgICAgICAgICAgIF9yZWFtaW5pbmcgPSBzYWZlU3ViKF9yZWFtaW5pbmcsIGFtb3VudCk7CiAgICAgICAgICAgIF9ub25jZSA9IHNhZmVBZGQoX25vbmNlLCAxKTsKICAgICAgICAgICAgcmVxdWlyZSggVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLnNldEFsbG93YW5jZShmcm9tLCBtc2cuc2VuZGVyLCBfcmVhbWluaW5nLCBfbm9uY2UpICk7CiAgICAgICAgICAgIEFsbG93YW5jZVVzZWQobXNnLnNlbmRlciwgZnJvbSwgYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9kYXRhOwogICAgICAgIF90cmFuc2Zlcihmcm9tLCB0bywgYW1vdW50LCB0cnVlLCBfZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCwgYnl0ZXMgZXh0cmFEYXRhKSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIGFtb3VudCwgdHJ1ZSwgZXh0cmFEYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBvd25lciwgdWludDI1NiB2YWx1ZSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSggbXNnLnNlbmRlciA9PSBmb3JrQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IGRlcG9zaXRzQWRkcmVzcyApOwogICAgICAgIF9taW50KG93bmVyLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKiBJbnRlcm5hbHMgKi8KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50LCBib29sIGZlZSwgYnl0ZXMgZXh0cmFEYXRhKSBpbnRlcm5hbCB7CiAgICAgICAgYm9vbCBfc3VjY2VzczsKICAgICAgICB1aW50MjU2IF9mZWU7CiAgICAgICAgdWludDI1NiBfcGF5QmFjazsKICAgICAgICB1aW50MjU2IF9hbW91bnQgPSBhbW91bnQ7CiAgICAgICAgcmVxdWlyZSggZnJvbSAhPSAweDAwICYmIHRvICE9IDB4MDAgKTsKICAgICAgICBpZiggZmVlICkgewogICAgICAgICAgICAoX3N1Y2Nlc3MsIF9mZWUpID0gZ2V0VHJhbnNhY3Rpb25GZWUoYW1vdW50KTsKICAgICAgICAgICAgcmVxdWlyZSggX3N1Y2Nlc3MgKTsKICAgICAgICAgICAgaWYgKCBUb2tlbkRCKGRhdGFiYXNlQWRkcmVzcykuYmFsYW5jZU9mKGZyb20pID09IGFtb3VudCApIHsKICAgICAgICAgICAgICAgIF9hbW91bnQgPSBzYWZlU3ViKGFtb3VudCwgX2ZlZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCBmZWUgKSB7CiAgICAgICAgICAgIEJ1cm4oZnJvbSwgX2ZlZSk7CiAgICAgICAgfQogICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcjIoZnJvbSwgdG8sIF9hbW91bnQsIGV4dHJhRGF0YSk7CiAgICAgICAgcmVxdWlyZSggVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLnRyYW5zZmVyKGZyb20sIHRvLCBfYW1vdW50LCBfZmVlKSApOwogICAgICAgIGlmICggaXNDb250cmFjdCh0bykgKSB7CiAgICAgICAgICAgIHJlcXVpcmUoIGNoZWNrQ29udHJhY3QodG8pICk7CiAgICAgICAgICAgIChfc3VjY2VzcywgX3BheUJhY2spID0gU2FtcGxlQ29udHJhY3QodG8pLnJlY2VpdmVUb2tlbihmcm9tLCBhbW91bnQsIGV4dHJhRGF0YSk7CiAgICAgICAgICAgIHJlcXVpcmUoIF9zdWNjZXNzICk7CiAgICAgICAgICAgIHJlcXVpcmUoIGFtb3VudCA+IF9wYXlCYWNrICk7CiAgICAgICAgICAgIGlmICggX3BheUJhY2sgPiAwICkgewogICAgICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IF9kYXRhOwogICAgICAgICAgICAgICAgVHJhbnNmZXIodG8sIGZyb20sIF9wYXlCYWNrKTsKICAgICAgICAgICAgICAgIFRyYW5zZmVyMih0bywgZnJvbSwgX3BheUJhY2ssIF9kYXRhKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUoIFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS50cmFuc2Zlcih0bywgZnJvbSwgX3BheUJhY2ssIDApICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfbWludChhZGRyZXNzIG93bmVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSggVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLmluY3JlYXNlKG93bmVyLCB2YWx1ZSkgKTsKICAgICAgICBNaW50KG93bmVyLCB2YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBfYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IG5vbmNlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSggbXNnLnNlbmRlciAhPSBzcGVuZGVyICk7CiAgICAgICAgdmFyIChfc3VjY2VzcywgX3JlbWFpbmluZywgX25vbmNlKSA9IFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5nZXRBbGxvd2FuY2UobXNnLnNlbmRlciwgc3BlbmRlcik7CiAgICAgICAgcmVxdWlyZSggX3N1Y2Nlc3MgJiYgKCBfbm9uY2UgPT0gbm9uY2UgKSApOwogICAgICAgIHJlcXVpcmUoIFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5zZXRBbGxvd2FuY2UobXNnLnNlbmRlciwgc3BlbmRlciwgYW1vdW50LCBub25jZSkgKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbW91bnQpOwogICAgfQogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIGFkZHIpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgdWludDI1NiBfY29kZUxlbmd0aDsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9jb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKGFkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBfY29kZUxlbmd0aCA+IDA7CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja0NvbnRyYWN0KGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sIGFwcHJvcHJpYXRlKSB7CiAgICAgICAgcmV0dXJuIFNhbXBsZUNvbnRyYWN0KGFkZHIpLlhHUkFkZHJlc3MoKSA9PSBhZGRyZXNzKHRoaXMpOwogICAgfQogICAgLyogQ29uc3RhbnRzICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcsIHVpbnQyNTYgbm9uY2UpIHsKICAgICAgICB2YXIgKF9zdWNjZXNzLCBfcmVtYWluaW5nLCBfbm9uY2UpID0gVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLmdldEFsbG93YW5jZShvd25lciwgc3BlbmRlcik7CiAgICAgICAgcmVxdWlyZSggX3N1Y2Nlc3MgKTsKICAgICAgICByZXR1cm4gKF9yZW1haW5pbmcsIF9ub25jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkZlZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzLCB1aW50MjU2IGZlZSkgewogICAgICAgIGZlZSA9IHNhZmVNdWwodmFsdWUsIHRyYW5zYWN0aW9uRmVlUmF0ZSkgLyB0cmFuc2FjdGlvbkZlZVJhdGVNIC8gMTAwOwogICAgICAgIGlmICggZmVlID4gdHJhbnNhY3Rpb25GZWVNYXggKSB7IGZlZSA9IHRyYW5zYWN0aW9uRmVlTWF4OyB9CiAgICAgICAgZWxzZSBpZiAoIGZlZSA8IHRyYW5zYWN0aW9uRmVlTWluICkgeyBmZWUgPSB0cmFuc2FjdGlvbkZlZU1pbjsgfQogICAgICAgIHJldHVybiAodHJ1ZSwgZmVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB2YWx1ZSkgewogICAgICAgIHJldHVybiBUb2tlbkRCKGRhdGFiYXNlQWRkcmVzcykuYmFsYW5jZU9mKG93bmVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VzT2YoYWRkcmVzcyBvd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSwgdWludDI1NiBsb2NrZWRBbW91bnQpIHsKICAgICAgICByZXR1cm4gKFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5iYWxhbmNlT2Yob3duZXIpLCBUb2tlbkRCKGRhdGFiYXNlQWRkcmVzcykubG9ja2VkQmFsYW5jZXMob3duZXIpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdmFsdWUpIHsKICAgICAgICByZXR1cm4gVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLnRvdGFsU3VwcGx5KCk7CiAgICB9CiAgICAvKiBFdmVudHMgKi8KICAgIGV2ZW50IEFsbG93YW5jZVVzZWQoYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiBpbmRleGVkIHZhbHVlKTsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQyNTYgaW5kZXhlZCB2YWx1ZSk7CiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IGluZGV4ZWQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgX3ZhbHVlKTsKICAgIGV2ZW50IFRyYW5zZmVyMihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgdmFsdWUsIGJ5dGVzIGRhdGEpOwp9Cgpjb250cmFjdCBEZXBvc2l0cyBpcyBPd25lZCwgU2FmZU1hdGggewogICAgLyogU3RydWN0dXJlcyAqLwogICAgc3RydWN0IGRlcG9zaXRUeXBlc19zIHsKICAgICAgICB1aW50MjU2IGJsb2NrRGVsYXk7CiAgICAgICAgdWludDI1NiBiYXNlRnVuZHM7CiAgICAgICAgdWludDI1NiBpbnRlcmVzdFJhdGVPbkVuZDsKICAgICAgICB1aW50MjU2IGludGVyZXN0UmF0ZUJlZm9yZUVuZDsKICAgICAgICB1aW50MjU2IGludGVyZXN0RmVlOwogICAgICAgIGJvb2wgY2xvc2VhYmxlOwogICAgICAgIGJvb2wgdmFsaWQ7CiAgICB9CiAgICBzdHJ1Y3QgZGVwb3NpdHNfcyB7CiAgICAgICAgYWRkcmVzcyBhZGRyOwogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgICAgIHVpbnQyNTYgc3RhcnQ7CiAgICAgICAgdWludDI1NiBlbmQ7CiAgICAgICAgdWludDI1NiBpbnRlcmVzdE9uRW5kOwogICAgICAgIHVpbnQyNTYgaW50ZXJlc3RCZWZvcmVFbmQ7CiAgICAgICAgdWludDI1NiBpbnRlcmVzdEZlZTsKICAgICAgICB1aW50MjU2IGludGVyZXN0TXVsdGlwbGllcjsKICAgICAgICBib29sICAgIGNsb3NlYWJsZTsKICAgICAgICBib29sICAgIHZhbGlkOwogICAgfQogICAgLyogVmFyaWFibGVzICovCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gZGVwb3NpdFR5cGVzX3MpIHB1YmxpYyBkZXBvc2l0VHlwZXM7CiAgICB1aW50MjU2IHB1YmxpYyBkZXBvc2l0VHlwZXNDb3VudGVyOwogICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgZGF0YWJhc2VBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgZm91bmRlckFkZHJlc3M7CiAgICB1aW50MjU2IHB1YmxpYyBpbnRlcmVzdE11bHRpcGxpZXIgPSAxZTQ7CiAgICAvKiBFeHRlcm5hbHMgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZURhdGFCYXNlQWRkcmVzcyhhZGRyZXNzIG5ld0RhdGFiYXNlQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICBkYXRhYmFzZUFkZHJlc3MgPSBuZXdEYXRhYmFzZUFkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VUb2tlbkFkZHJlc3MoYWRkcmVzcyBuZXdUb2tlbkFkZHJlc3MpIGV4dGVybmFsIG9ubHlGb3JPd25lciB7CiAgICAgICAgdG9rZW5BZGRyZXNzID0gbmV3VG9rZW5BZGRyZXNzOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlRm91bmRlckFkZHJlc3NzKGFkZHJlc3MgbmV3Rm91bmRlckFkZHJlc3MpIGV4dGVybmFsIG9ubHlGb3JPd25lciB7CiAgICAgICAgZm91bmRlckFkZHJlc3MgPSBuZXdGb3VuZGVyQWRkcmVzczsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZERlcG9zaXRUeXBlKHVpbnQyNTYgYmxvY2tEZWxheSwgdWludDI1NiBiYXNlRnVuZHMsIHVpbnQyNTYgaW50ZXJlc3RSYXRlT25FbmQsCiAgICAgICAgdWludDI1NiBpbnRlcmVzdFJhdGVCZWZvcmVFbmQsIHVpbnQyNTYgaW50ZXJlc3RGZWUsIGJvb2wgY2xvc2VhYmxlKSBleHRlcm5hbCBvbmx5Rm9yT3duZXIgewogICAgICAgIGRlcG9zaXRUeXBlc0NvdW50ZXIgKz0gMTsKICAgICAgICB1aW50MjU2IERUSUQgPSBkZXBvc2l0VHlwZXNDb3VudGVyOwogICAgICAgIGRlcG9zaXRUeXBlc1tEVElEXSA9IGRlcG9zaXRUeXBlc19zKAogICAgICAgICAgICBibG9ja0RlbGF5LAogICAgICAgICAgICBiYXNlRnVuZHMsCiAgICAgICAgICAgIGludGVyZXN0UmF0ZU9uRW5kLAogICAgICAgICAgICBpbnRlcmVzdFJhdGVCZWZvcmVFbmQsCiAgICAgICAgICAgIGludGVyZXN0RmVlLAogICAgICAgICAgICBjbG9zZWFibGUsCiAgICAgICAgICAgIHRydWUKICAgICAgICApOwogICAgICAgIEV2ZW50TmV3RGVwb3NpdFR5cGUoCiAgICAgICAgICAgIERUSUQsCiAgICAgICAgICAgIGJsb2NrRGVsYXksCiAgICAgICAgICAgIGJhc2VGdW5kcywKICAgICAgICAgICAgaW50ZXJlc3RSYXRlT25FbmQsCiAgICAgICAgICAgIGludGVyZXN0UmF0ZUJlZm9yZUVuZCwKICAgICAgICAgICAgaW50ZXJlc3RGZWUsCiAgICAgICAgICAgIGNsb3NlYWJsZQogICAgICAgICk7CiAgICB9CiAgICBmdW5jdGlvbiByZWtvdmVEZXBvc2l0VHlwZSh1aW50MjU2IERUSUQpIGV4dGVybmFsIG9ubHlGb3JPd25lciB7CiAgICAgICAgZGVwb3NpdFR5cGVzW0RUSURdLnZhbGlkID0gZmFsc2U7CiAgICB9CiAgICBmdW5jdGlvbiBwbGFjZURlcG9zaXQodWludDI1NiBhbW91bnQsIHVpbnQyNTYgZGVwb3NpdFR5cGUpIGV4dGVybmFsIGNoZWNrU2VsZiB7CiAgICAgICAgcmVxdWlyZSggZGVwb3NpdFR5cGVzW2RlcG9zaXRUeXBlXS52YWxpZCApOwogICAgICAgIHJlcXVpcmUoIGRlcG9zaXRUeXBlc1tkZXBvc2l0VHlwZV0uYmFzZUZ1bmRzIDw9IGFtb3VudCApOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgdWludDI1NiBsb2NrZWQgPSBUb2tlbkRCKGRhdGFiYXNlQWRkcmVzcykubG9ja2VkQmFsYW5jZXMobXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSggc2FmZVN1YihiYWxhbmNlLCBsb2NrZWQpID49IGFtb3VudCApOwogICAgICAgIHZhciAoc3VjY2VzcywgRElEKSA9IFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5vcGVuRGVwb3NpdCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICBzYWZlQWRkKGJsb2NrLm51bWJlciwgZGVwb3NpdFR5cGVzW2RlcG9zaXRUeXBlXS5ibG9ja0RlbGF5KSwKICAgICAgICAgICAgZGVwb3NpdFR5cGVzW2RlcG9zaXRUeXBlXS5pbnRlcmVzdFJhdGVPbkVuZCwKICAgICAgICAgICAgZGVwb3NpdFR5cGVzW2RlcG9zaXRUeXBlXS5pbnRlcmVzdFJhdGVCZWZvcmVFbmQsCiAgICAgICAgICAgIGRlcG9zaXRUeXBlc1tkZXBvc2l0VHlwZV0uaW50ZXJlc3RGZWUsCiAgICAgICAgICAgIGludGVyZXN0TXVsdGlwbGllciwKICAgICAgICAgICAgZGVwb3NpdFR5cGVzW2RlcG9zaXRUeXBlXS5jbG9zZWFibGUKICAgICAgICApOwogICAgICAgIHJlcXVpcmUoIHN1Y2Nlc3MgKTsKICAgICAgICBFdmVudE5ld0RlcG9zaXQoRElEKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNsb3NlRGVwb3NpdChhZGRyZXNzIGJlbmVmaWNhcnksIHVpbnQyNTYgRElEKSBleHRlcm5hbCBjaGVja1NlbGYgewogICAgICAgIGFkZHJlc3MgX2JlbmVmaWNhcnkgPSBiZW5lZmljYXJ5OwogICAgICAgIGlmICggX2JlbmVmaWNhcnkgPT0gMHgwMCApIHsKICAgICAgICAgICAgX2JlbmVmaWNhcnkgPSBtc2cuc2VuZGVyOwogICAgICAgIH0KICAgICAgICB2YXIgKGFkZHIsIGFtb3VudCwgc3RhcnQsIGVuZCwgaW50ZXJlc3RPbkVuZCwgaW50ZXJlc3RCZWZvcmVFbmQsIGludGVyZXN0RmVlLAogICAgICAgICAgICBpbnRlcmVzdE0sIGNsb3NlYWJsZSwgdmFsaWQpID0gVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLmdldERlcG9zaXQoRElEKTsKICAgICAgICBfY2xvc2VEZXBvc2l0KF9iZW5lZmljYXJ5LCBESUQsIGRlcG9zaXRzX3MoYWRkciwgYW1vdW50LCBzdGFydCwgZW5kLCBpbnRlcmVzdE9uRW5kLCBpbnRlcmVzdEJlZm9yZUVuZCwgaW50ZXJlc3RGZWUsIGludGVyZXN0TSwgY2xvc2VhYmxlLCB2YWxpZCkpOwogICAgfQogICAgLyogSW50ZXJuYWxzICovCiAgICBmdW5jdGlvbiBfY2xvc2VEZXBvc2l0KGFkZHJlc3MgYmVuZWZpY2FyeSwgdWludDI1NiBESUQsIGRlcG9zaXRzX3MgZGF0YSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoIGRhdGEudmFsaWQgJiYgZGF0YS5hZGRyID09IG1zZy5zZW5kZXIgKTsKICAgICAgICB2YXIgKGludGVyZXN0LCBpbnRlcmVzdEZlZSkgPSBfY2FsY3VsYXRlSW50ZXJlc3QoZGF0YSk7CiAgICAgICAgaWYgKCBpbnRlcmVzdCA+IDAgKSB7CiAgICAgICAgICAgIHJlcXVpcmUoIFRva2VuKHRva2VuQWRkcmVzcykubWludChiZW5lZmljYXJ5LCBpbnRlcmVzdCkgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCBpbnRlcmVzdEZlZSA+IDAgKSB7CiAgICAgICAgICAgIHJlcXVpcmUoIFRva2VuKHRva2VuQWRkcmVzcykubWludChmb3VuZGVyQWRkcmVzcywgaW50ZXJlc3RGZWUpICk7CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUoIFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS5jbG9zZURlcG9zaXQoRElEKSApOwogICAgICAgIEV2ZW50RGVwb3NpdENsb3NlZChESUQsIGludGVyZXN0LCBpbnRlcmVzdEZlZSk7CiAgICB9CiAgICBmdW5jdGlvbiBfY2FsY3VsYXRlSW50ZXJlc3QoZGVwb3NpdHNfcyBkYXRhKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgaW50ZXJlc3QsIHVpbnQyNTYgaW50ZXJlc3RGZWUpIHsKICAgICAgICBpZiAoICEgZGF0YS52YWxpZCB8fCBkYXRhLmFtb3VudCA8PSAwIHx8IGRhdGEuZW5kIDw9IGRhdGEuc3RhcnQgfHwgYmxvY2subnVtYmVyIDw9IGRhdGEuc3RhcnQgKSB7IHJldHVybiAoMCwgMCk7IH0KICAgICAgICB1aW50MjU2IHJhdGU7CiAgICAgICAgdWludDI1NiBkZWxheTsKICAgICAgICBpZiAoIGRhdGEuZW5kIDw9IGJsb2NrLm51bWJlciApIHsKICAgICAgICAgICAgcmF0ZSA9IGRhdGEuaW50ZXJlc3RPbkVuZDsKICAgICAgICAgICAgZGVsYXkgPSBzYWZlU3ViKGRhdGEuZW5kLCBkYXRhLnN0YXJ0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKCBkYXRhLmNsb3NlYWJsZSApOwogICAgICAgICAgICByYXRlID0gZGF0YS5pbnRlcmVzdEJlZm9yZUVuZDsKICAgICAgICAgICAgZGVsYXkgPSBzYWZlU3ViKGJsb2NrLm51bWJlciwgZGF0YS5zdGFydCk7CiAgICAgICAgfQogICAgICAgIGlmICggcmF0ZSA9PSAwICkgeyByZXR1cm4gKDAsIDApOyB9CiAgICAgICAgaW50ZXJlc3QgPSBzYWZlRGl2KHNhZmVNdWwoc2FmZURpdihzYWZlRGl2KHNhZmVNdWwoZGF0YS5hbW91bnQsIHJhdGUpLCAxMDApLCBkYXRhLmludGVyZXN0TXVsdGlwbGllciksIGRlbGF5KSwgc2FmZVN1YihkYXRhLmVuZCwgZGF0YS5zdGFydCkpOwogICAgICAgIGlmICggZGF0YS5pbnRlcmVzdEZlZSA+IDAgJiYgaW50ZXJlc3QgPiAwKSB7CiAgICAgICAgICAgIGludGVyZXN0RmVlID0gc2FmZURpdihzYWZlRGl2KHNhZmVNdWwoaW50ZXJlc3QsIGRhdGEuaW50ZXJlc3RGZWUpLCAxMDApLCBkYXRhLmludGVyZXN0TXVsdGlwbGllcik7CiAgICAgICAgfQogICAgICAgIGlmICggaW50ZXJlc3RGZWUgPiAwICkgewogICAgICAgICAgICBpbnRlcmVzdCA9IHNhZmVTdWIoaW50ZXJlc3QsIGludGVyZXN0RmVlKTsKICAgICAgICB9CiAgICB9CiAgICAvKiBDb25zdGFudHMgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUludGVyZXN0KHVpbnQyNTYgRElEKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgICAgICB2YXIgKGFkZHIsIGFtb3VudCwgc3RhcnQsIGVuZCwgaW50ZXJlc3RPbkVuZCwgaW50ZXJlc3RCZWZvcmVFbmQsIGludGVyZXN0RmVlLAogICAgICAgICAgICBpbnRlcmVzdE0sIGNsb3NlYWJsZSwgdmFsaWQpID0gVG9rZW5EQihkYXRhYmFzZUFkZHJlc3MpLmdldERlcG9zaXQoRElEKTsKICAgICAgICByZXR1cm4gX2NhbGN1bGF0ZUludGVyZXN0KGRlcG9zaXRzX3MoYWRkciwgYW1vdW50LCBzdGFydCwgZW5kLCBpbnRlcmVzdE9uRW5kLCBpbnRlcmVzdEJlZm9yZUVuZCwgaW50ZXJlc3RGZWUsIGludGVyZXN0TSwgY2xvc2VhYmxlLCB2YWxpZCkpOwogICAgfQogICAgLyogTW9kaWZpZXJzICovCiAgICBtb2RpZmllciBjaGVja1NlbGYgewogICAgICAgIHJlcXVpcmUoIFRva2VuREIoZGF0YWJhc2VBZGRyZXNzKS50b2tlbkFkZHJlc3MoKSA9PSB0b2tlbkFkZHJlc3MgKTsKICAgICAgICByZXF1aXJlKCBUb2tlbkRCKGRhdGFiYXNlQWRkcmVzcykuZGVwb3NpdHNBZGRyZXNzKCkgPT0gYWRkcmVzcyh0aGlzKSApOwogICAgICAgIF87CiAgICB9CiAgICAvKiBFdmVudHMgKi8KICAgIGV2ZW50IEV2ZW50TmV3RGVwb3NpdFR5cGUodWludDI1NiBpbmRleGVkIERUSUQsIHVpbnQyNTYgYmxvY2tEZWxheSwgdWludDI1NiBiYXNlRnVuZHMsCiAgICAgICAgdWludDI1NiBpbnRlcmVzdFJhdGVPbkVuZCwgdWludDI1NiBpbnRlcmVzdFJhdGVCZWZvcmVFbmQsIHVpbnQyNTYgaW50ZXJlc3RGZWUsIGJvb2wgY2xvc2VhYmxlKTsKICAgIGV2ZW50IEV2ZW50UmV2b2tlRGVwb3NpdFR5cGUodWludDI1NiBpbmRleGVkIERUSUQpOwogICAgZXZlbnQgRXZlbnROZXdEZXBvc2l0KHVpbnQyNTYgaW5kZXhlZCBESUQpOwogICAgZXZlbnQgRXZlbnREZXBvc2l0Q2xvc2VkKHVpbnQyNTYgaW5kZXhlZCBESUQsIHVpbnQyNTYgaW5kZXhlZCBpbnRlcmVzdCwgdWludDI1NiBpbmRleGVkIGludGVyZXN0RmVlKTsKfQoKY29udHJhY3QgRm9yayBpcyBPd25lZCB7CiAgICAvKiBWYXJpYWJsZXMgKi8KICAgIGFkZHJlc3MgcHVibGljIHVwbG9hZGVyOwogICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5BZGRyZXNzOwogICAgLyogQ29uc3RydWN0b3IgKi8KICAgIGZ1bmN0aW9uIEZvcmsoYWRkcmVzcyBfdXBsb2FkZXIpIHB1YmxpYyB7CiAgICAgICAgdXBsb2FkZXIgPSBfdXBsb2FkZXI7CiAgICB9CiAgICAvKiBFeHRlcm5hbHMgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZVRva2VuQWRkcmVzcyhhZGRyZXNzIG5ld1Rva2VuQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICB0b2tlbkFkZHJlc3MgPSBuZXdUb2tlbkFkZHJlc3M7CiAgICB9CiAgICBmdW5jdGlvbiB1cGxvYWQoYWRkcmVzc1tdIGFkZHIsIHVpbnQyNTZbXSBhbW91bnQpIGV4dGVybmFsIG9ubHlGb3JVcGxvYWRlciB7CiAgICAgICAgcmVxdWlyZSggYWRkci5sZW5ndGggPT0gYW1vdW50Lmxlbmd0aCApOwogICAgICAgIGZvciAoIHVpbnQyNTYgYT0wIDsgYTxhZGRyLmxlbmd0aCA7IGErKyApIHsKICAgICAgICAgICAgcmVxdWlyZSggVG9rZW4odG9rZW5BZGRyZXNzKS5taW50KGFkZHJbYV0sIGFtb3VudFthXSkgKTsKICAgICAgICB9CiAgICB9CiAgICAvKiBNb2RpZmllcnMgKi8KICAgIG1vZGlmaWVyIG9ubHlGb3JVcGxvYWRlciB7CiAgICAgICAgcmVxdWlyZSggbXNnLnNlbmRlciA9PSB1cGxvYWRlciApOwogICAgICAgIF87CiAgICB9Cn0KCmNvbnRyYWN0IFNhbXBsZUNvbnRyYWN0IGlzIE93bmVkLCBTYWZlTWF0aCB7CiAgICAvKiBWYXJpYWJsZXMgKi8KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdHM7IC8vIERhdGFiYXNlIG9mIHVzZXJzIGJhbGFuY2UKICAgIGFkZHJlc3MgcHVibGljIFhHUkFkZHJlc3M7IC8vIFhHUiBUb2tlbiBhZGRyZXNzLCBwbGVhc2UgZG8gbm90IGNoYW5nZSB0aGlzIHZhcmlhYmxlIG5hbWUhCiAgICAvKiBDb25zdHJ1Y3RvciAqLwogICAgZnVuY3Rpb24gU2FtcGxlQ29udHJhY3QoYWRkcmVzcyBuZXdYR1JUb2tlbkFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgLyoKICAgICAgICAgICAgRm9yIHRoZSBmaXJzdCB0aW1lIHlvdSBuZWVkIHNldCB0aGUgWEdSIHRva2VuIGFkZHJlc3MuCiAgICAgICAgICAgIFRoZSBjb250cmFjdCBkZXBsb3llciB3b3VsZCBiZSBhbHNvIHRoZSBvd25lci4KICAgICAgICAqLwogICAgICAgIFhHUkFkZHJlc3MgPSBuZXdYR1JUb2tlbkFkZHJlc3M7CiAgICB9CiAgICAvKiBFeHRlcm5hbHMgKi8KICAgIGZ1bmN0aW9uIHJlY2VpdmVUb2tlbihhZGRyZXNzIGFkZHIsIHVpbnQyNTYgYW1vdW50LCBieXRlcyBkYXRhKSBleHRlcm5hbCBvbmx5RnJvbVhHUlRva2VuIHJldHVybnMoYm9vbCwgdWludDI1NikgewogICAgICAgIC8qCiAgICAgICAgICAgIEBhZGRyIGhhcyBzZW5kIEBhbW91bnQgdG8gb3Vyc2VsZi4gVGhlIHNlY29uZCByZXR1cm4gcGFyYW1ldGVyIGlzIHRoZSByZWZ1bmQgYW1vdW50LgogICAgICAgICAgICBJZiB5b3UgZG9uJ3QgbmVlZCB0aGUgd2hvbGUgYW1vdW50LCB5b3UgY2FuIHJlZnVuZCB0aGF0IGZvciB0aGUgYWRkcmVzcyBpbnN0YW50bHkuCiAgICAgICAgICAgIFBsZWFzZSBkbyBub3QgY2hhbmdlIHRoaXMgZnVuY3Rpb24gbmFtZSBhbmQgcGFyYW1ldGVyIQogICAgICAgICovCiAgICAgICAgaW5jb21pbmdUb2tlbihhZGRyLCBhbW91bnQpOwogICAgICAgIHJldHVybiAodHJ1ZSwgMCk7CiAgICB9CiAgICBmdW5jdGlvbiBhcHByb3ZlZFRva2VuKGFkZHJlc3MgYWRkciwgdWludDI1NiBhbW91bnQsIGJ5dGVzIGRhdGEpIGV4dGVybmFsIG9ubHlGcm9tWEdSVG9rZW4gcmV0dXJucyhib29sKSB7CiAgICAgICAgLyoKICAgICAgICAgICAgQGFkZHIgaGFzIGFsbG93ZWQgQGFtb3VudCBmb3Igd2l0aGRyYXcgZnJvbSBoZXIvaGlzIGJhbGFuY2UuIFdlIHdpdGhkcmF3IHRoYXQgdG8gb3Vyc2VsZi4KICAgICAgICAgICAgUGxlYXNlIGRvIG5vdCBjaGFuZ2UgdGhpcyBmdW5jdGlvbiBuYW1lIGFuZCBwYXJhbWV0ZXIhCiAgICAgICAgKi8KICAgICAgICByZXF1aXJlKCBUb2tlbihYR1JBZGRyZXNzKS50cmFuc2ZlckZyb20oYWRkciwgYWRkcmVzcyh0aGlzKSwgYW1vdW50KSApOwogICAgICAgIGluY29taW5nVG9rZW4oYWRkciwgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZVRva2VuQWRkcmVzcyhhZGRyZXNzIG5ld1Rva2VuQWRkcmVzcykgZXh0ZXJuYWwgb25seUZvck93bmVyIHsKICAgICAgICAvKgogICAgICAgICAgICBNYXliZSB0aGUgWEdSIHRva2VuIGNvbnRyYWN0IGJlY29tZXMgbmV3IGFkZHJlc3MsIHlvdSBuZWVkIG1haW50ZW5hbmNlIHRoaXMuCiAgICAgICAgKi8KICAgICAgICBYR1JBZGRyZXNzID0gbmV3VG9rZW5BZGRyZXNzOwogICAgfQogICAgZnVuY3Rpb24ga2lsbFRoaXNDb250cmFjdCgpIGV4dGVybmFsIG9ubHlGb3JPd25lciB7CiAgICAgICAgdmFyIGJhbGFuY2UgPSBUb2tlbihYR1JBZGRyZXNzKS5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7IC8vIGdldCB0aGlzIGNvbnRyYWN0IFhHUiBiYWxhbmNlCiAgICAgICAgcmVxdWlyZSggVG9rZW4oWEdSQWRkcmVzcykudHJhbnNmZXIobXNnLnNlbmRlciwgYmFsYW5jZSkgKTsgLy8gc2VuZCBhbGwgWEdSIHRva2VuIHRvIHRoZSBjYWxsZXIKICAgICAgICBzZWxmZGVzdHJ1Y3QobXNnLnNlbmRlcik7IC8vIGRlc3RydWN0IHRoZSBjb250cmFjdDsKICAgIH0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCB7CiAgICAgICAgLyoKICAgICAgICAgICAgU29tZSB1c2VycyB3aXRoZHJhdyBYR1IgdG9rZW4gZnJvbSB0aGlzIGNvbnRyYWN0LgogICAgICAgICAgICBUaGUgY29udHJhY3QgbXVzdCBwYXkgdGhlIFhHUiB0b2tlbiBmZWUsIHdlIG5lZWQgdG8gcmVkdWNlIHRoYXQgZnJvbSB0aGUgYW1vdW50OwogICAgICAgICovCiAgICAgICAgdmFyIChzdWNjZXNzLCBmZWUpID0gVG9rZW4oWEdSQWRkcmVzcykuZ2V0VHJhbnNhY3Rpb25GZWUoYW1vdW50KTsgLy8gR2V0IHRoZSB0cmFuc2ZlciBmZWUgZnJvbSB0aGUgY29udHJhY3QKICAgICAgICByZXF1aXJlKCBzdWNjZXNzICk7CiAgICAgICAgd2l0aGRyYXdUb2tlbihtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgICAgIHJlcXVpcmUoIFRva2VuKFhHUkFkZHJlc3MpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHNhZmVTdWIoYW1vdW50LCBmZWUpKSApOwogICAgfQogICAgLyogSW50ZXJuYWxzICovCiAgICBmdW5jdGlvbiBpbmNvbWluZ1Rva2VuKGFkZHJlc3MgYWRkciwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBkZXBvc2l0c1thZGRyXSA9IHNhZmVBZGQoZGVwb3NpdHNbYWRkcl0sIGFtb3VudCk7CiAgICB9CiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKGFkZHJlc3MgYWRkciwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBkZXBvc2l0c1thZGRyXSA9IHNhZmVTdWIoZGVwb3NpdHNbYWRkcl0sIGFtb3VudCk7CiAgICB9CiAgICAvKiBNb2RpZmllcnMgKi8KICAgIG1vZGlmaWVyIG9ubHlGcm9tWEdSVG9rZW4gewogICAgICAgIHJlcXVpcmUoIG1zZy5zZW5kZXIgPT0gWEdSQWRkcmVzcyApOwogICAgICAgIF87CiAgICB9Cn0='.
	

]
