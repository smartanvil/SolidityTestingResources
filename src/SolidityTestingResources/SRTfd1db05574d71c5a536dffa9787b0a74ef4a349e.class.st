Class {
	#name : #SRTfd1db05574d71c5a536dffa9787b0a74ef4a349e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTfd1db05574d71c5a536dffa9787b0a74ef4a349e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IE5vbi1GdW5naWJsZSBUb2tlbnMKLy8vIEBhdXRob3IgRGlldGVyIFNoaXJsZXkgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIwMTY1NjQ3NTY0NDE2MDc5Njg2ZTZjN2I2NDZmMmY2MjZlIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4gKGh0dHBzOi8vZ2l0aHViLmNvbS9kZXRlKQpjb250cmFjdCBFUkM3MjEgewogICAgLy8gUmVxdWlyZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8gT3B0aW9uYWwKICAgIC8vIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICAgIC8vIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKTsKICAgIC8vIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKTsKCiAgICAvLyBFUkMtMTY1IENvbXBhdGliaWxpdHkgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgICogYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICB9CiAgICB9Cgp9CgoKCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogICAgLyoqCiAgICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgICAqLwogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUocGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIFBhdXNlKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgoKCgoKCi8vLyBAdGl0bGUgQXVjdGlvbiBDb3JlCi8vLyBAZGV2IENvbnRhaW5zIG1vZGVscywgdmFyaWFibGVzLCBhbmQgaW50ZXJuYWwgbWV0aG9kcyBmb3IgdGhlIGF1Y3Rpb24uCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8gUmVwcmVzZW50cyBhbiBhdWN0aW9uIG9uIGFuIE5GVAogICAgc3RydWN0IEF1Y3Rpb24gewogICAgICAgIC8vIEN1cnJlbnQgb3duZXIgb2YgTkZUCiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgZW5kIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IGVuZGluZ1ByaWNlOwogICAgICAgIC8vIER1cmF0aW9uIChpbiBzZWNvbmRzKSBvZiBhdWN0aW9uCiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIC8vIFRpbWUgd2hlbiBhdWN0aW9uIHN0YXJ0ZWQKICAgICAgICAvLyBOT1RFOiAwIGlmIHRoaXMgYXVjdGlvbiBoYXMgYmVlbiBjb25jbHVkZWQKICAgICAgICB1aW50NjQgc3RhcnRlZEF0OwogICAgfQoKICAgIC8vIFJlZmVyZW5jZSB0byBjb250cmFjdCB0cmFja2luZyBORlQgb3duZXJzaGlwCiAgICBFUkM3MjEgcHVibGljIG5vbkZ1bmdpYmxlQ29udHJhY3Q7CgogICAgLy8gQ3V0IG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MjU2IHB1YmxpYyBvd25lckN1dDsKCiAgICAvLyBNYXAgZnJvbSB0b2tlbiBJRCB0byB0aGVpciBjb3JyZXNwb25kaW5nIGF1Y3Rpb24uCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IEF1Y3Rpb24pIHRva2VuSWRUb0F1Y3Rpb247CgogICAgZXZlbnQgQXVjdGlvbkNyZWF0ZWQodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24pOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHRvdGFsUHJpY2UsIGFkZHJlc3Mgd2lubmVyKTsKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQodWludDI1NiB0b2tlbklkKTsKCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIGNsYWltYW50IG93bnMgdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgLSBBZGRyZXNzIGNsYWltaW5nIHRvIG93biB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2Ugb3duZXJzaGlwIHRvIHZlcmlmeS4KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKG5vbkZ1bmdpYmxlQ29udHJhY3Qub3duZXJPZihfdG9rZW5JZCkgPT0gX2NsYWltYW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBFc2Nyb3dzIHRoZSBORlQsIGFzc2lnbmluZyBvd25lcnNoaXAgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBUaHJvd3MgaWYgdGhlIGVzY3JvdyBmYWlscy4KICAgIC8vLyBAcGFyYW0gX293bmVyIC0gQ3VycmVudCBvd25lciBhZGRyZXNzIG9mIHRva2VuIHRvIGVzY3Jvdy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB3aG9zZSBhcHByb3ZhbCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfZXNjcm93KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXJGcm9tKF9vd25lciwgdGhpcywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyBhbiBORlQgb3duZWQgYnkgdGhpcyBjb250cmFjdCB0byBhbm90aGVyIGFkZHJlc3MuCiAgICAvLy8gUmV0dXJucyB0cnVlIGlmIHRoZSB0cmFuc2ZlciBzdWNjZWVkcy4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyIC0gQWRkcmVzcyB0byB0cmFuc2ZlciBORlQgdG8uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfcmVjZWl2ZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBpdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlcihfcmVjZWl2ZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBZGRzIGFuIGF1Y3Rpb24gdG8gdGhlIGxpc3Qgb2Ygb3BlbiBhdWN0aW9ucy4gQWxzbyBmaXJlcyB0aGUKICAgIC8vLyAgQXVjdGlvbkNyZWF0ZWQgZXZlbnQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgcHV0IG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hdWN0aW9uIEF1Y3Rpb24gdG8gYWRkLgogICAgZnVuY3Rpb24gX2FkZEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWwgewogICAgICAgIC8vIFJlcXVpcmUgdGhhdCBhbGwgYXVjdGlvbnMgaGF2ZSBhIGR1cmF0aW9uIG9mCiAgICAgICAgLy8gYXQgbGVhc3Qgb25lIG1pbnV0ZS4gKEtlZXBzIG91ciBtYXRoIGZyb20gZ2V0dGluZyBoYWlyeSEpCiAgICAgICAgcmVxdWlyZShfYXVjdGlvbi5kdXJhdGlvbiA+PSAxIG1pbnV0ZXMpOwoKICAgICAgICB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXSA9IF9hdWN0aW9uOwoKICAgICAgICBBdWN0aW9uQ3JlYXRlZCgKICAgICAgICAgICAgdWludDI1NihfdG9rZW5JZCksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmR1cmF0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHVuY29uZGl0aW9uYWxseS4KICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3NlbGxlcikgaW50ZXJuYWwgewogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKICAgICAgICBfdHJhbnNmZXIoX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBwcmljZSBhbmQgdHJhbnNmZXJzIHdpbm5pbmdzLgogICAgLy8vIERvZXMgTk9UIHRyYW5zZmVyIG93bmVyc2hpcCBvZiB0b2tlbi4KICAgIGZ1bmN0aW9uIF9iaWQodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfYmlkQW1vdW50KQogICAgaW50ZXJuYWwKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CgogICAgICAgIC8vIEV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGlzIGF1Y3Rpb24gaXMgY3VycmVudGx5IGxpdmUuCiAgICAgICAgLy8gKEJlY2F1c2Ugb2YgaG93IEV0aGVyZXVtIG1hcHBpbmdzIHdvcmssIHdlIGNhbid0IGp1c3QgY291bnQKICAgICAgICAvLyBvbiB0aGUgbG9va3VwIGFib3ZlIGZhaWxpbmcuIEFuIGludmFsaWQgX3Rva2VuSWQgd2lsbCBqdXN0CiAgICAgICAgLy8gcmV0dXJuIGFuIGF1Y3Rpb24gb2JqZWN0IHRoYXQgaXMgYWxsIHplcm9zLikKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGJpZCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGN1cnJlbnQgcHJpY2UKICAgICAgICB1aW50MjU2IHByaWNlID0gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gcHJpY2UpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIC8vIGdldHMgZGVsZXRlZC4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBUaGUgYmlkIGlzIGdvb2QhIFJlbW92ZSB0aGUgYXVjdGlvbiBiZWZvcmUgc2VuZGluZyB0aGUgZmVlcwogICAgICAgIC8vIHRvIHRoZSBzZW5kZXIgc28gd2UgY2FuJ3QgaGF2ZSBhIHJlZW50cmFuY3kgYXR0YWNrLgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgcHJvY2VlZHMgdG8gc2VsbGVyIChpZiB0aGVyZSBhcmUgYW55ISkKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYXVjdGlvbmVlcidzIGN1dC4KICAgICAgICAgICAgLy8gKE5PVEU6IF9jb21wdXRlQ3V0KCkgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gYQogICAgICAgICAgICAvLyB2YWx1ZSA8PSBwcmljZSwgc28gdGhpcyBzdWJ0cmFjdGlvbiBjYW4ndCBnbyBuZWdhdGl2ZS4pCiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKCiAgICAgICAgICAgIC8vIE5PVEU6IERvaW5nIGEgdHJhbnNmZXIoKSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcGxleAogICAgICAgICAgICAvLyBtZXRob2QgbGlrZSB0aGlzIGlzIGdlbmVyYWxseSBkaXNjb3VyYWdlZCBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHJlZW50cmFuY3kgYXR0YWNrcyBhbmQgRG9TIGF0dGFja3MgaWYgdGhlIHNlbGxlciBpcwogICAgICAgICAgICAvLyBhIGNvbnRyYWN0IHdpdGggYW4gaW52YWxpZCBmYWxsYmFjayBmdW5jdGlvbi4gV2UgZXhwbGljaXRseQogICAgICAgICAgICAvLyBndWFyZCBhZ2FpbnN0IHJlZW50cmFuY3kgYXR0YWNrcyBieSByZW1vdmluZyB0aGUgYXVjdGlvbgogICAgICAgICAgICAvLyBiZWZvcmUgY2FsbGluZyB0cmFuc2ZlcigpLCBhbmQgdGhlIG9ubHkgdGhpbmcgdGhlIHNlbGxlcgogICAgICAgICAgICAvLyBjYW4gRG9TIGlzIHRoZSBzYWxlIG9mIHRoZWlyIG93biBhc3NldCEgKEFuZCBpZiBpdCdzIGFuCiAgICAgICAgICAgIC8vIGFjY2lkZW50LCB0aGV5IGNhbiBjYWxsIGNhbmNlbEF1Y3Rpb24oKS4gKQogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgd2l0aCB0aGUgYmlkLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gYmlkZGVyLgogICAgICAgIC8vIE5PVEU6IFdlIGNoZWNrZWQgYWJvdmUgdGhhdCB0aGUgYmlkIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgcHJpY2Ugc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gX2JpZEFtb3VudCAtIHByaWNlOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzLiBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyB0cmFuc2ZlciwgdGhpcyBpcwogICAgICAgIC8vIG5vdCBzdXNjZXB0aWJsZSB0byBhIHJlLWVudHJ5IGF0dGFjayBiZWNhdXNlIHRoZSBhdWN0aW9uIGlzCiAgICAgICAgLy8gcmVtb3ZlZCBiZWZvcmUgYW55IHRyYW5zZmVycyBvY2N1ci4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJpZEV4Y2Vzcyk7CgogICAgICAgIC8vIFRlbGwgdGhlIHdvcmxkIQogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbklkLCBwcmljZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmVzIGFuIGF1Y3Rpb24gZnJvbSB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gX3JlbW92ZUF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIE5GVCBpcyBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiAtIEF1Y3Rpb24gdG8gY2hlY2suCiAgICBmdW5jdGlvbiBfaXNPbkF1Y3Rpb24oQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9hdWN0aW9uLnN0YXJ0ZWRBdCA+IDApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgY3VycmVudCBwcmljZSBvZiBhbiBORlQgb24gYXVjdGlvbi4gQnJva2VuIGludG8gdHdvCiAgICAvLy8gIGZ1bmN0aW9ucyAodGhpcyBvbmUsIHRoYXQgY29tcHV0ZXMgdGhlIGR1cmF0aW9uIGZyb20gdGhlIGF1Y3Rpb24KICAgIC8vLyAgc3RydWN0dXJlLCBhbmQgdGhlIG90aGVyIHRoYXQgZG9lcyB0aGUgcHJpY2UgY29tcHV0YXRpb24pIHNvIHdlCiAgICAvLy8gIGNhbiBlYXNpbHkgdGVzdCB0aGF0IHRoZSBwcmljZSBjb21wdXRhdGlvbiB3b3JrcyBjb3JyZWN0bHkuCiAgICBmdW5jdGlvbiBfY3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgIGludGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IDA7CgogICAgICAgIC8vIEEgYml0IG9mIGluc3VyYW5jZSBhZ2FpbnN0IG5lZ2F0aXZlIHZhbHVlcyAob3Igd3JhcGFyb3VuZCkuCiAgICAgICAgLy8gUHJvYmFibHkgbm90IG5lY2Vzc2FyeSAoc2luY2UgRXRoZXJldW0gZ3Vhcm5hdGVlcyB0aGF0IHRoZQogICAgICAgIC8vIG5vdyB2YXJpYWJsZSBkb2Vzbid0IGV2ZXIgZ28gYmFja3dhcmRzKS4KICAgICAgICBpZiAobm93ID4gX2F1Y3Rpb24uc3RhcnRlZEF0KSB7CiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQgPSBub3cgLSBfYXVjdGlvbi5zdGFydGVkQXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4gRmFjdG9yZWQgb3V0CiAgICAvLy8gIGZyb20gX2N1cnJlbnRQcmljZSBzbyB3ZSBjYW4gcnVuIGV4dGVuc2l2ZSB1bml0IHRlc3RzLgogICAgLy8vICBXaGVuIHRlc3RpbmcsIG1ha2UgdGhpcyBmdW5jdGlvbiBwdWJsaWMgYW5kIHR1cm4gb24KICAgIC8vLyAgYEN1cnJlbnQgcHJpY2UgY29tcHV0YXRpb25gIHRlc3Qgc3VpdGUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgX3NlY29uZHNQYXNzZWQKICAgICkKICAgIGludGVybmFsCiAgICBwdXJlCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgcHVibGljIGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgdGltZSAoYXQgNjQtYml0cykgYW5kIGN1cnJlbmN5IChhdCAxMjgtYml0cykuIF9kdXJhdGlvbiBpcwogICAgICAgIC8vICBhbHNvIGtub3duIHRvIGJlIG5vbi16ZXJvIChzZWUgdGhlIHJlcXVpcmUoKSBzdGF0ZW1lbnQgaW4KICAgICAgICAvLyAgX2FkZEF1Y3Rpb24oKSkKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIC8vIFdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZHluYW1pYyBwcmljaW5nIHBvcnRpb24KICAgICAgICAgICAgLy8gb2YgdGhlIGF1Y3Rpb24sIGp1c3QgcmV0dXJuIHRoZSBlbmQgcHJpY2UuCiAgICAgICAgICAgIHJldHVybiBfZW5kaW5nUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU3RhcnRpbmcgcHJpY2UgY2FuIGJlIGhpZ2hlciB0aGFuIGVuZGluZyBwcmljZSAoYW5kIG9mdGVuIGlzISksIHNvCiAgICAgICAgICAgIC8vIHRoaXMgZGVsdGEgY2FuIGJlIG5lZ2F0aXZlLgogICAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihfZW5kaW5nUHJpY2UpIC0gaW50MjU2KF9zdGFydGluZ1ByaWNlKTsKCiAgICAgICAgICAgIC8vIFRoaXMgbXVsdGlwbGljYXRpb24gY2FuJ3Qgb3ZlcmZsb3csIF9zZWNvbmRzUGFzc2VkIHdpbGwgZWFzaWx5IGZpdCB3aXRoaW4KICAgICAgICAgICAgLy8gNjQtYml0cywgYW5kIHRvdGFsUHJpY2VDaGFuZ2Ugd2lsbCBlYXNpbHkgZml0IHdpdGhpbiAxMjgtYml0cywgdGhlaXIgcHJvZHVjdAogICAgICAgICAgICAvLyB3aWxsIGFsd2F5cyBmaXQgd2l0aGluIDI1Ni1iaXRzLgogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludDI1Nihfc2Vjb25kc1Bhc3NlZCkgLyBpbnQyNTYoX2R1cmF0aW9uKTsKCiAgICAgICAgICAgIC8vIGN1cnJlbnRQcmljZUNoYW5nZSBjYW4gYmUgbmVnYXRpdmUsIGJ1dCBpZiBzbywgd2lsbCBoYXZlIGEgbWFnbml0dWRlCiAgICAgICAgICAgIC8vIGxlc3MgdGhhdCBfc3RhcnRpbmdQcmljZS4gVGh1cywgdGhpcyByZXN1bHQgd2lsbCBhbHdheXMgZW5kIHVwIHBvc2l0aXZlLgogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlID0gaW50MjU2KF9zdGFydGluZ1ByaWNlKSArIGN1cnJlbnRQcmljZUNoYW5nZTsKCiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KGN1cnJlbnRQcmljZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIG93bmVyJ3MgY3V0IG9mIGEgc2FsZS4KICAgIC8vLyBAcGFyYW0gX3ByaWNlIC0gU2FsZSBwcmljZSBvZiBORlQuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1dCh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBlbnRyeSBmdW5jdGlvbnMgY2FyZWZ1bGx5IGNhcCB0aGUgbWF4aW11bSB2YWx1ZXMgZm9yCiAgICAgICAgLy8gIGN1cnJlbmN5IChhdCAxMjgtYml0cyksIGFuZCBvd25lckN1dCA8PSAxMDAwMCAoc2VlIHRoZSByZXF1aXJlKCkKICAgICAgICAvLyAgc3RhdGVtZW50IGluIHRoZSBDbG9ja0F1Y3Rpb24gY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyAgZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX3ByaWNlLgogICAgICAgIHJldHVybiBfcHJpY2UgKiBvd25lckN1dCAvIDEwMDAwOwogICAgfQoKfQoKCgoKCi8vLyBAdGl0bGUgQ2xvY2sgYXVjdGlvbiBmb3Igbm9uLWZ1bmdpYmxlIHRva2Vucy4KLy8vIEBub3RpY2UgV2Ugb21pdCBhIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBzZW5kcyB0byB0aGlzIGNvbnRyYWN0Lgpjb250cmFjdCBDbG9ja0F1Y3Rpb24gaXMgUGF1c2FibGUsIENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vLyBAZGV2IFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NQogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0gYnl0ZXM0KDB4OWEyMDQ4M2QpOwoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGNyZWF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIE5GVCBvd25lcnNoaXAgY29udHJhY3QKICAgIC8vLyAgYW5kIHZlcmlmaWVzIHRoZSBvd25lciBjdXQgaXMgaW4gdGhlIHZhbGlkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBfbmZ0QWRkcmVzcyAtIGFkZHJlc3Mgb2YgYSBkZXBsb3llZCBjb250cmFjdCBpbXBsZW1lbnRpbmcKICAgIC8vLyAgdGhlIE5vbmZ1bmdpYmxlIEludGVyZmFjZS4KICAgIC8vLyBAcGFyYW0gX2N1dCAtIHBlcmNlbnQgY3V0IHRoZSBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG11c3QgYmUKICAgIC8vLyAgYmV0d2VlbiAwLTEwLDAwMC4KICAgIGZ1bmN0aW9uIENsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyZXNzLCB1aW50MjU2IF9jdXQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfY3V0IDw9IDEwMDAwKTsKICAgICAgICBvd25lckN1dCA9IF9jdXQ7CgogICAgICAgIEVSQzcyMSBjYW5kaWRhdGVDb250cmFjdCA9IEVSQzcyMShfbmZ0QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5zdXBwb3J0c0ludGVyZmFjZShJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFJlbW92ZSBhbGwgRXRoZXIgZnJvbSB0aGUgY29udHJhY3QsIHdoaWNoIGlzIHRoZSBvd25lcidzIGN1dHMKICAgIC8vLyAgYXMgd2VsbCBhcyBhbnkgRXRoZXIgc2VudCBkaXJlY3RseSB0byB0aGUgY29udHJhY3QgYWRkcmVzcy4KICAgIC8vLyAgQWx3YXlzIHRyYW5zZmVycyB0byB0aGUgTkZUIGNvbnRyYWN0LCBidXQgY2FuIGJlIGNhbGxlZCBlaXRoZXIgYnkKICAgIC8vLyAgdGhlIG93bmVyIG9yIHRoZSBORlQgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBuZnRBZGRyZXNzID0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KTsKCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBvd25lciB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IG5mdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGlzIGJvb2xlYW4gbWV0aG9kIHRvIG1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgb25lIGZhaWxzIGl0IHdpbGwgc3RpbGwgd29yawogICAgICAgIG5mdEFkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcKICAgIC8vLyAgcHJpY2UgYW5kIGVuZGluZyBwcmljZSAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIF9lc2Nyb3cobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBCaWRzIG9uIGFuIG9wZW4gYXVjdGlvbiwgY29tcGxldGluZyB0aGUgYXVjdGlvbiBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICBwYXlhYmxlCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gX2JpZCB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHRoYXQgaGFzbid0IGJlZW4gd29uIHlldC4KICAgIC8vLyAgUmV0dXJucyB0aGUgTkZUIHRvIG9yaWdpbmFsIG93bmVyLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBhIHN0YXRlLW1vZGlmeWluZyBmdW5jdGlvbiB0aGF0IGNhbgogICAgLy8vICBiZSBjYWxsZWQgd2hpbGUgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiBvbiBhdWN0aW9uCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIHNlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyAgT25seSB0aGUgb3duZXIgbWF5IGRvIHRoaXMsIGFuZCBORlRzIGFyZSByZXR1cm5lZCB0bwogICAgLy8vICB0aGUgc2VsbGVyLiBUaGlzIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gZW1lcmdlbmNpZXMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIE5GVCBvbiBhdWN0aW9uIHRvIGNhbmNlbC4KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb25XaGVuUGF1c2VkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICB3aGVuUGF1c2VkCiAgICBvbmx5T3duZXIKICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGF1Y3Rpb24gaW5mbyBmb3IgYW4gTkZUIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgTkZUIG9uIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucwogICAgKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGVuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBzdGFydGVkQXQKICAgICkgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiAoCiAgICAgICAgYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgIGF1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSB0b2tlbiBwcmljZSB3ZSBhcmUgY2hlY2tpbmcuCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludDI1NiBfdG9rZW5JZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQoKfQoKLy8KY29udHJhY3QgR2VuZVNjaWVuY2UgewoKICAgIHVpbnQ2NCBfc2VlZCA9IDA7CgogICAgLy8vIEBkZXYgc2ltcGx5IGEgYm9vbGVhbiB0byBpbmRpY2F0ZSB0aGlzIGlzIHRoZSBjb250cmFjdCB3ZSBleHBlY3QgdG8gYmUKICAgIC8vLyBwdXJlIG1lYW5zICJ0aGV5IHByb21pc2Ugbm90IHRvIHJlYWQgZnJvbSBvciBtb2RpZnkgdGhlIHN0YXRlLiIKICAgIGZ1bmN0aW9uIGlzR2VuZVNjaWVuY2UoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gcmV0dXJuIGEgcHNldWRvIHJhbmRvbSBudW1iZXIgYmV0d2VlbiBsb3dlciBhbmQgdXBwZXIgYm91bmRzCiAgICAvLyBnaXZlbiB0aGUgbnVtYmVyIG9mIHByZXZpb3VzIGJsb2NrcyBpdCBzaG91bGQgaGFzaC4KICAgIGZ1bmN0aW9uIHJhbmRvbSh1aW50NjQgdXBwZXIpIGludGVybmFsIHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIF9zZWVkID0gdWludDY0KGtlY2NhazI1NihrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIF9zZWVkKSwgbm93KSk7CiAgICAgICAgcmV0dXJuIF9zZWVkICUgdXBwZXI7CiAgICB9CgogICAgZnVuY3Rpb24gcmFuZG9tQmV0d2Vlbih1aW50MzIgYSwgdWludDMyIGIpIGludGVybmFsIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHVpbnQzMiBtaW47CiAgICAgICAgdWludDMyIG1heDsKICAgICAgICBpZihhIDwgYikgewogICAgICAgICAgICBtaW4gPSBhOwogICAgICAgICAgICBtYXggPSBiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1pbiA9IGI7CiAgICAgICAgICAgIG1heCA9IGE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWluICsgdWludDMyKHJhbmRvbShtYXggLSBtaW4gKyAxKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmFuZG9tQ29kZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgLy8KICAgICAgICB1aW50NjQgciA9IHJhbmRvbSgxMDAwMDAwKTsKCiAgICAgICAgaWYgKHIgPD0gMTYzKSByZXR1cm4gMTUxOwogICAgICAgIGlmIChyIDw9IDMyNykgcmV0dXJuIDI1MTsKICAgICAgICBpZiAociA8PSA0OTApIHJldHVybiAxOTY7CiAgICAgICAgaWYgKHIgPD0gNjU0KSByZXR1cm4gMTk3OwogICAgICAgIGlmIChyIDw9IDgxNykgcmV0dXJuIDIzODsKICAgICAgICBpZiAociA8PSA5ODEpIHJldHVybiAyNDA7CiAgICAgICAgaWYgKHIgPD0gMTE0NCkgcmV0dXJuIDIzOTsKICAgICAgICBpZiAociA8PSAxMzA4KSByZXR1cm4gMTczOwogICAgICAgIGlmIChyIDw9IDE0NzEpIHJldHVybiAxNzU7CiAgICAgICAgaWYgKHIgPD0gMTYzNSkgcmV0dXJuIDE3NDsKICAgICAgICBpZiAociA8PSAxNzk4KSByZXR1cm4gMjM2OwogICAgICAgIGlmIChyIDw9IDE5NjIpIHJldHVybiAxNzI7CiAgICAgICAgaWYgKHIgPD0gMjI4OSkgcmV0dXJuIDI1MDsKICAgICAgICBpZiAociA8PSAyNjE2KSByZXR1cm4gMjQ5OwogICAgICAgIGlmIChyIDw9IDI5NDMpIHJldHVybiAyNDQ7CiAgICAgICAgaWYgKHIgPD0gMzI3MCkgcmV0dXJuIDI0MzsKICAgICAgICBpZiAociA8PSAzNTk3KSByZXR1cm4gMjQ1OwogICAgICAgIGlmIChyIDw9IDQwODcpIHJldHVybiAxNDU7CiAgICAgICAgaWYgKHIgPD0gNDU3NykgcmV0dXJuIDE0NjsKICAgICAgICBpZiAociA8PSA1MDY4KSByZXR1cm4gMTQ0OwogICAgICAgIGlmIChyIDw9IDU4ODUpIHJldHVybiAyNDg7CiAgICAgICAgaWYgKHIgPD0gNjcwMykgcmV0dXJuIDE0OTsKICAgICAgICBpZiAociA8PSA3NTIwKSByZXR1cm4gMTQzOwogICAgICAgIGlmIChyIDw9IDgzMzcpIHJldHVybiAxMTI7CiAgICAgICAgaWYgKHIgPD0gOTE1NSkgcmV0dXJuIDI0MjsKICAgICAgICBpZiAociA8PSA5OTcyKSByZXR1cm4gMjEyOwogICAgICAgIGlmIChyIDw9IDEwNzkwKSByZXR1cm4gMTYwOwogICAgICAgIGlmIChyIDw9IDExNjA3KSByZXR1cm4gNjsKICAgICAgICBpZiAociA8PSAxMjQyNCkgcmV0dXJuIDE1NzsKICAgICAgICBpZiAociA8PSAxMzI0MikgcmV0dXJuIDEzMTsKICAgICAgICBpZiAociA8PSAxNDA1OSkgcmV0dXJuIDM7CiAgICAgICAgaWYgKHIgPD0gMTQ4NzcpIHJldHVybiAyMzM7CiAgICAgICAgaWYgKHIgPD0gMTU2OTQpIHJldHVybiA5OwogICAgICAgIGlmIChyIDw9IDE2NTExKSByZXR1cm4gMTU0OwogICAgICAgIGlmIChyIDw9IDE3MzI5KSByZXR1cm4gMTgyOwogICAgICAgIGlmIChyIDw9IDE4MTQ2KSByZXR1cm4gMTc2OwogICAgICAgIGlmIChyIDw9IDE5MTI3KSByZXR1cm4gMTUwOwogICAgICAgIGlmIChyIDw9IDIwNzYyKSByZXR1cm4gMTMwOwogICAgICAgIGlmIChyIDw9IDIyMzk3KSByZXR1cm4gNjg7CiAgICAgICAgaWYgKHIgPD0gMjQwMzEpIHJldHVybiA2NTsKICAgICAgICBpZiAociA8PSAyNTY2NikgcmV0dXJuIDU5OwogICAgICAgIGlmIChyIDw9IDI3MzAxKSByZXR1cm4gOTQ7CiAgICAgICAgaWYgKHIgPD0gMjg5MzYpIHJldHVybiAxOTk7CiAgICAgICAgaWYgKHIgPD0gMzA1NzEpIHJldHVybiAxNjk7CiAgICAgICAgaWYgKHIgPD0gMzIyMDUpIHJldHVybiAyMDg7CiAgICAgICAgaWYgKHIgPD0gMzM4NDApIHJldHVybiAyMzA7CiAgICAgICAgaWYgKHIgPD0gMzU0NzUpIHJldHVybiAxODY7CiAgICAgICAgaWYgKHIgPD0gMzcxMTApIHJldHVybiAzNjsKICAgICAgICBpZiAociA8PSAzODc0NCkgcmV0dXJuIDM4OwogICAgICAgIGlmIChyIDw9IDQwMzc5KSByZXR1cm4gMTkyOwogICAgICAgIGlmIChyIDw9IDQyMDE0KSByZXR1cm4gMjY7CiAgICAgICAgaWYgKHIgPD0gNDM2NDkpIHJldHVybiAyMzc7CiAgICAgICAgaWYgKHIgPD0gNDUyODQpIHJldHVybiAxNDg7CiAgICAgICAgaWYgKHIgPD0gNDY5MTgpIHJldHVybiAyNDc7CiAgICAgICAgaWYgKHIgPD0gNDg1NTMpIHJldHVybiAyOwogICAgICAgIGlmIChyIDw9IDUwMTg4KSByZXR1cm4gNTsKICAgICAgICBpZiAociA8PSA1MTgyMykgcmV0dXJuIDg7CiAgICAgICAgaWYgKHIgPD0gNTM3ODUpIHJldHVybiAxMzQ7CiAgICAgICAgaWYgKHIgPD0gNTU3NDYpIHJldHVybiAyMzI7CiAgICAgICAgaWYgKHIgPD0gNTc3MDgpIHJldHVybiA3NjsKICAgICAgICBpZiAociA8PSA1OTY3MCkgcmV0dXJuIDEzNjsKICAgICAgICBpZiAociA8PSA2MTYzMikgcmV0dXJuIDEzNTsKICAgICAgICBpZiAociA8PSA2MzU5MykgcmV0dXJuIDE4MTsKICAgICAgICBpZiAociA8PSA2NTU1NSkgcmV0dXJuIDYyOwogICAgICAgIGlmIChyIDw9IDY3NTE3KSByZXR1cm4gMzQ7CiAgICAgICAgaWYgKHIgPD0gNjk0NzkpIHJldHVybiAzMTsKICAgICAgICBpZiAociA8PSA3MTQ0MCkgcmV0dXJuIDIyMTsKICAgICAgICBpZiAociA8PSA3MzQwMikgcmV0dXJuIDcxOwogICAgICAgIGlmIChyIDw9IDc1MzY0KSByZXR1cm4gMTg1OwogICAgICAgIGlmIChyIDw9IDc3MzI1KSByZXR1cm4gMTg7CiAgICAgICAgaWYgKHIgPD0gNzkyODcpIHJldHVybiAxNTsKICAgICAgICBpZiAociA8PSA4MTI0OSkgcmV0dXJuIDEyOwogICAgICAgIGlmIChyIDw9IDgzMjExKSByZXR1cm4gMTU5OwogICAgICAgIGlmIChyIDw9IDg1MTcyKSByZXR1cm4gMTg5OwogICAgICAgIGlmIChyIDw9IDg3MTM0KSByZXR1cm4gMjE5OwogICAgICAgIGlmIChyIDw9IDg5MDk2KSByZXR1cm4gMTU2OwogICAgICAgIGlmIChyIDw9IDkxMDU4KSByZXR1cm4gMTUzOwogICAgICAgIGlmIChyIDw9IDkzNTEwKSByZXR1cm4gMjE3OwogICAgICAgIGlmIChyIDw9IDk1OTYyKSByZXR1cm4gMTM5OwogICAgICAgIGlmIChyIDw9IDk4NDE0KSByZXR1cm4gMjI5OwogICAgICAgIGlmIChyIDw9IDEwMDg2NikgcmV0dXJuIDE0MTsKICAgICAgICBpZiAociA8PSAxMDMzMTkpIHJldHVybiAyMTA7CiAgICAgICAgaWYgKHIgPD0gMTA1NzcxKSByZXR1cm4gNDU7CiAgICAgICAgaWYgKHIgPD0gMTA4MjIzKSByZXR1cm4gMjA1OwogICAgICAgIGlmIChyIDw9IDExMDY3NSkgcmV0dXJuIDc4OwogICAgICAgIGlmIChyIDw9IDExMzEyNykgcmV0dXJuIDIyNDsKICAgICAgICBpZiAociA8PSAxMTU1ODApIHJldHVybiAxNzE7CiAgICAgICAgaWYgKHIgPD0gMTE4MDMyKSByZXR1cm4gMTY0OwogICAgICAgIGlmIChyIDw9IDEyMDQ4NCkgcmV0dXJuIDE3ODsKICAgICAgICBpZiAociA8PSAxMjI5MzYpIHJldHVybiAxOTU7CiAgICAgICAgaWYgKHIgPD0gMTI1Mzg4KSByZXR1cm4gMTA1OwogICAgICAgIGlmIChyIDw9IDEyNzg0MCkgcmV0dXJuIDE2MjsKICAgICAgICBpZiAociA8PSAxMzAyOTMpIHJldHVybiAxNjg7CiAgICAgICAgaWYgKHIgPD0gMTMyNzQ1KSByZXR1cm4gMTg0OwogICAgICAgIGlmIChyIDw9IDEzNTE5NykgcmV0dXJuIDE2NjsKICAgICAgICBpZiAociA8PSAxMzg0NjcpIHJldHVybiAxMDM7CiAgICAgICAgaWYgKHIgPD0gMTQxNzM2KSByZXR1cm4gODk7CiAgICAgICAgaWYgKHIgPD0gMTQ1MDA2KSByZXR1cm4gOTk7CiAgICAgICAgaWYgKHIgPD0gMTQ4Mjc1KSByZXR1cm4gMTQyOwogICAgICAgIGlmIChyIDw9IDE1MTU0NSkgcmV0dXJuIDgwOwogICAgICAgIGlmIChyIDw9IDE1NDgxNCkgcmV0dXJuIDkxOwogICAgICAgIGlmIChyIDw9IDE1ODA4NCkgcmV0dXJuIDExNTsKICAgICAgICBpZiAociA8PSAxNjEzNTQpIHJldHVybiAxMDY7CiAgICAgICAgaWYgKHIgPD0gMTY0NjIzKSByZXR1cm4gNzM7CiAgICAgICAgaWYgKHIgPD0gMTY3ODkzKSByZXR1cm4gMjg7CiAgICAgICAgaWYgKHIgPD0gMTcxMTYyKSByZXR1cm4gMjQxOwogICAgICAgIGlmIChyIDw9IDE3NDQzMikgcmV0dXJuIDEyMTsKICAgICAgICBpZiAociA8PSAxNzc3MDEpIHJldHVybiA1NTsKICAgICAgICBpZiAociA8PSAxODA5NzEpIHJldHVybiAxMjY7CiAgICAgICAgaWYgKHIgPD0gMTg0MjQxKSByZXR1cm4gODI7CiAgICAgICAgaWYgKHIgPD0gMTg3NTEwKSByZXR1cm4gMTI1OwogICAgICAgIGlmIChyIDw9IDE5MDc4MCkgcmV0dXJuIDExMDsKICAgICAgICBpZiAociA8PSAxOTQwNDkpIHJldHVybiA4NTsKICAgICAgICBpZiAociA8PSAxOTczMTkpIHJldHVybiA1NzsKICAgICAgICBpZiAociA8PSAyMDA1ODkpIHJldHVybiAxMDc7CiAgICAgICAgaWYgKHIgPD0gMjAzODU4KSByZXR1cm4gOTc7CiAgICAgICAgaWYgKHIgPD0gMjA3MTI4KSByZXR1cm4gMTE5OwogICAgICAgIGlmIChyIDw9IDIxMDM5NykgcmV0dXJuIDIyNzsKICAgICAgICBpZiAociA8PSAyMTM2NjcpIHJldHVybiAxMTc7CiAgICAgICAgaWYgKHIgPD0gMjE2OTM2KSByZXR1cm4gNDk7CiAgICAgICAgaWYgKHIgPD0gMjIwMjA2KSByZXR1cm4gNDA7CiAgICAgICAgaWYgKHIgPD0gMjIzNDc2KSByZXR1cm4gMTAxOwogICAgICAgIGlmIChyIDw9IDIyNjc0NSkgcmV0dXJuIDg3OwogICAgICAgIGlmIChyIDw9IDIzMDAxNSkgcmV0dXJuIDIxNTsKICAgICAgICBpZiAociA8PSAyMzMyODQpIHJldHVybiA0MjsKICAgICAgICBpZiAociA8PSAyMzY1NTQpIHJldHVybiAyMjsKICAgICAgICBpZiAociA8PSAyMzk4MjMpIHJldHVybiAyMDc7CiAgICAgICAgaWYgKHIgPD0gMjQzMDkzKSByZXR1cm4gMjQ7CiAgICAgICAgaWYgKHIgPD0gMjQ2MzYzKSByZXR1cm4gOTM7CiAgICAgICAgaWYgKHIgPD0gMjQ5NjMyKSByZXR1cm4gNDc7CiAgICAgICAgaWYgKHIgPD0gMjUyOTAyKSByZXR1cm4gMjA7CiAgICAgICAgaWYgKHIgPD0gMjU2MTcxKSByZXR1cm4gNTM7CiAgICAgICAgaWYgKHIgPD0gMjU5NDQxKSByZXR1cm4gMTEzOwogICAgICAgIGlmIChyIDw9IDI2MjcxMCkgcmV0dXJuIDE5ODsKICAgICAgICBpZiAociA8PSAyNjU5ODApIHJldHVybiA1MTsKICAgICAgICBpZiAociA8PSAyNjkyNTApIHJldHVybiAxMDg7CiAgICAgICAgaWYgKHIgPD0gMjcyNTE5KSByZXR1cm4gMTkwOwogICAgICAgIGlmIChyIDw9IDI3NTc4OSkgcmV0dXJuIDE1ODsKICAgICAgICBpZiAociA8PSAyNzkwNTgpIHJldHVybiA5NTsKICAgICAgICBpZiAociA8PSAyODIzMjgpIHJldHVybiAxOwogICAgICAgIGlmIChyIDw9IDI4NTU5OCkgcmV0dXJuIDIyNTsKICAgICAgICBpZiAociA8PSAyODg4NjcpIHJldHVybiA0OwogICAgICAgIGlmIChyIDw9IDI5MjEzNykgcmV0dXJuIDE1NTsKICAgICAgICBpZiAociA8PSAyOTU0MDYpIHJldHVybiA3OwogICAgICAgIGlmIChyIDw9IDI5ODY3NikgcmV0dXJuIDE1MjsKICAgICAgICBpZiAociA8PSAzMDE5NDUpIHJldHVybiAyNTsKICAgICAgICBpZiAociA8PSAzMDUyMTUpIHJldHVybiAxMzI7CiAgICAgICAgaWYgKHIgPD0gMzA5MzAyKSByZXR1cm4gNjc7CiAgICAgICAgaWYgKHIgPD0gMzEzMzg5KSByZXR1cm4gNjQ7CiAgICAgICAgaWYgKHIgPD0gMzE3NDc2KSByZXR1cm4gNzU7CiAgICAgICAgaWYgKHIgPD0gMzIxNTYzKSByZXR1cm4gNzA7CiAgICAgICAgaWYgKHIgPD0gMzI1NjUwKSByZXR1cm4gMTgwOwogICAgICAgIGlmIChyIDw9IDMyOTczNykgcmV0dXJuIDYxOwogICAgICAgIGlmIChyIDw9IDMzMzgyNCkgcmV0dXJuIDMzOwogICAgICAgIGlmIChyIDw9IDMzNzkxMSkgcmV0dXJuIDMwOwogICAgICAgIGlmIChyIDw9IDM0MTk5OCkgcmV0dXJuIDE3OwogICAgICAgIGlmIChyIDw9IDM0NjA4NSkgcmV0dXJuIDIwMjsKICAgICAgICBpZiAociA8PSAzNTAxNzIpIHJldHVybiAxODg7CiAgICAgICAgaWYgKHIgPD0gMzU0MjU5KSByZXR1cm4gMTE7CiAgICAgICAgaWYgKHIgPD0gMzU4MzQ2KSByZXR1cm4gMTQ7CiAgICAgICAgaWYgKHIgPD0gMzYyNDMzKSByZXR1cm4gMjM1OwogICAgICAgIGlmIChyIDw9IDM2NzMzNykgcmV0dXJuIDIxNDsKICAgICAgICBpZiAociA8PSAzNzIyNDEpIHJldHVybiAxMjc7CiAgICAgICAgaWYgKHIgPD0gMzc3MTQ2KSByZXR1cm4gMTI0OwogICAgICAgIGlmIChyIDw9IDM4MjA1MCkgcmV0dXJuIDEyODsKICAgICAgICBpZiAociA8PSAzODY5NTQpIHJldHVybiAxMjM7CiAgICAgICAgaWYgKHIgPD0gMzkxODU5KSByZXR1cm4gMjI2OwogICAgICAgIGlmIChyIDw9IDM5Njc2MykgcmV0dXJuIDIzNDsKICAgICAgICBpZiAociA8PSA0MDE2NjcpIHJldHVybiAxMjI7CiAgICAgICAgaWYgKHIgPD0gNDA2NTcyKSByZXR1cm4gMjExOwogICAgICAgIGlmIChyIDw9IDQxMTQ3NikgcmV0dXJuIDIwMzsKICAgICAgICBpZiAociA8PSA0MTYzODEpIHJldHVybiAyMDA7CiAgICAgICAgaWYgKHIgPD0gNDIxMjg1KSByZXR1cm4gMjA2OwogICAgICAgIGlmIChyIDw9IDQyNjE4OSkgcmV0dXJuIDQ0OwogICAgICAgIGlmIChyIDw9IDQzMTA5NCkgcmV0dXJuIDE5MzsKICAgICAgICBpZiAociA8PSA0MzU5OTgpIHJldHVybiAyMjI7CiAgICAgICAgaWYgKHIgPD0gNDQwOTAyKSByZXR1cm4gNTg7CiAgICAgICAgaWYgKHIgPD0gNDQ1ODA3KSByZXR1cm4gODM7CiAgICAgICAgaWYgKHIgPD0gNDUwNzExKSByZXR1cm4gMzU7CiAgICAgICAgaWYgKHIgPD0gNDU1NjE1KSByZXR1cm4gMjAxOwogICAgICAgIGlmIChyIDw9IDQ2MDUyMCkgcmV0dXJuIDM3OwogICAgICAgIGlmIChyIDw9IDQ2NTQyNCkgcmV0dXJuIDIxODsKICAgICAgICBpZiAociA8PSA0NzAzMjkpIHJldHVybiAyMjA7CiAgICAgICAgaWYgKHIgPD0gNDc1MjMzKSByZXR1cm4gMjEzOwogICAgICAgIGlmIChyIDw9IDQ4MTc3MikgcmV0dXJuIDExNDsKICAgICAgICBpZiAociA8PSA0ODgzMTEpIHJldHVybiAxMzc7CiAgICAgICAgaWYgKHIgPD0gNDk0ODUwKSByZXR1cm4gNzc7CiAgICAgICAgaWYgKHIgPD0gNTAxMzkwKSByZXR1cm4gMTM4OwogICAgICAgIGlmIChyIDw9IDUwNzkyOSkgcmV0dXJuIDE0MDsKICAgICAgICBpZiAociA8PSA1MTQ0NjgpIHJldHVybiAyMDk7CiAgICAgICAgaWYgKHIgPD0gNTIxMDA3KSByZXR1cm4gMjI4OwogICAgICAgIGlmIChyIDw9IDUyNzU0NikgcmV0dXJuIDE3MDsKICAgICAgICBpZiAociA8PSA1MzQwODUpIHJldHVybiAyMDQ7CiAgICAgICAgaWYgKHIgPD0gNTQwNjI0KSByZXR1cm4gOTI7CiAgICAgICAgaWYgKHIgPD0gNTQ3MTY0KSByZXR1cm4gMTMzOwogICAgICAgIGlmIChyIDw9IDU1MzcwMykgcmV0dXJuIDEwNDsKICAgICAgICBpZiAociA8PSA1NjAyNDIpIHJldHVybiAxNzc7CiAgICAgICAgaWYgKHIgPD0gNTY2NzgxKSByZXR1cm4gMjQ2OwogICAgICAgIGlmIChyIDw9IDU3MzMyMCkgcmV0dXJuIDE0NzsKICAgICAgICBpZiAociA8PSA1Nzk4NTkpIHJldHVybiA0NjsKICAgICAgICBpZiAociA8PSA1ODYzOTkpIHJldHVybiAxOTQ7CiAgICAgICAgaWYgKHIgPD0gNTk0NTczKSByZXR1cm4gMTExOwogICAgICAgIGlmIChyIDw9IDYwMjc0NikgcmV0dXJuIDk4OwogICAgICAgIGlmIChyIDw9IDYxMDkyMCkgcmV0dXJuIDg4OwogICAgICAgIGlmIChyIDw9IDYxOTA5NCkgcmV0dXJuIDc5OwogICAgICAgIGlmIChyIDw9IDYyNzI2OCkgcmV0dXJuIDY2OwogICAgICAgIGlmIChyIDw9IDYzNTQ0MikgcmV0dXJuIDI3OwogICAgICAgIGlmIChyIDw9IDY0MzYxNikgcmV0dXJuIDc0OwogICAgICAgIGlmIChyIDw9IDY1MTc5MCkgcmV0dXJuIDIxNjsKICAgICAgICBpZiAociA8PSA2NTk5NjQpIHJldHVybiAyMzE7CiAgICAgICAgaWYgKHIgPD0gNjY4MTM4KSByZXR1cm4gNjM7CiAgICAgICAgaWYgKHIgPD0gNjc2MzEyKSByZXR1cm4gMTAyOwogICAgICAgIGlmIChyIDw9IDY4NDQ4NikgcmV0dXJuIDEwOTsKICAgICAgICBpZiAociA8PSA2OTI2NjApIHJldHVybiA4MTsKICAgICAgICBpZiAociA8PSA3MDA4MzQpIHJldHVybiA4NDsKICAgICAgICBpZiAociA8PSA3MDkwMDgpIHJldHVybiAxMTg7CiAgICAgICAgaWYgKHIgPD0gNzE3MTgyKSByZXR1cm4gNTY7CiAgICAgICAgaWYgKHIgPD0gNzI1MzU2KSByZXR1cm4gOTY7CiAgICAgICAgaWYgKHIgPD0gNzMzNTMwKSByZXR1cm4gNTQ7CiAgICAgICAgaWYgKHIgPD0gNzQxNzAzKSByZXR1cm4gOTA7CiAgICAgICAgaWYgKHIgPD0gNzQ5ODc3KSByZXR1cm4gNzI7CiAgICAgICAgaWYgKHIgPD0gNzU4MDUxKSByZXR1cm4gMTIwOwogICAgICAgIGlmIChyIDw9IDc2NjIyNSkgcmV0dXJuIDExNjsKICAgICAgICBpZiAociA8PSA3NzQzOTkpIHJldHVybiA2OTsKICAgICAgICBpZiAociA8PSA3ODI1NzMpIHJldHVybiA0ODsKICAgICAgICBpZiAociA8PSA3OTA3NDcpIHJldHVybiA4NjsKICAgICAgICBpZiAociA8PSA3OTg5MjEpIHJldHVybiAxNzk7CiAgICAgICAgaWYgKHIgPD0gODA3MDk1KSByZXR1cm4gMTAwOwogICAgICAgIGlmIChyIDw9IDgxNTI2OSkgcmV0dXJuIDIzOwogICAgICAgIGlmIChyIDw9IDgyMzQ0MykgcmV0dXJuIDIyMzsKICAgICAgICBpZiAociA8PSA4MzE2MTcpIHJldHVybiAzMjsKICAgICAgICBpZiAociA8PSA4Mzk3OTEpIHJldHVybiAyOTsKICAgICAgICBpZiAociA8PSA4NDc5NjUpIHJldHVybiAzOTsKICAgICAgICBpZiAociA8PSA4NTYxMzkpIHJldHVybiA2MDsKICAgICAgICBpZiAociA8PSA4NjQzMTMpIHJldHVybiAxNjc7CiAgICAgICAgaWYgKHIgPD0gODcyNDg3KSByZXR1cm4gMjE7CiAgICAgICAgaWYgKHIgPD0gODgwNjYwKSByZXR1cm4gMTY1OwogICAgICAgIGlmIChyIDw9IDg4ODgzNCkgcmV0dXJuIDE2MzsKICAgICAgICBpZiAociA8PSA4OTcwMDgpIHJldHVybiA1MjsKICAgICAgICBpZiAociA8PSA5MDUxODIpIHJldHVybiAxOTsKICAgICAgICBpZiAociA8PSA5MTMzNTYpIHJldHVybiAxNjsKICAgICAgICBpZiAociA8PSA5MjE1MzApIHJldHVybiA0MTsKICAgICAgICBpZiAociA8PSA5Mjk3MDQpIHJldHVybiAxNjE7CiAgICAgICAgaWYgKHIgPD0gOTM3ODc4KSByZXR1cm4gMTg3OwogICAgICAgIGlmIChyIDw9IDk0NjA1MikgcmV0dXJuIDUwOwogICAgICAgIGlmIChyIDw9IDk1NDIyNikgcmV0dXJuIDE4MzsKICAgICAgICBpZiAociA8PSA5NjI0MDApIHJldHVybiAxMzsKICAgICAgICBpZiAociA8PSA5NzA1NzQpIHJldHVybiAxMDsKICAgICAgICBpZiAociA8PSA5Nzg3NDgpIHJldHVybiAxOTE7CiAgICAgICAgaWYgKHIgPD0gOTg4NTU2KSByZXR1cm4gNDM7CiAgICAgICAgaWYgKHIgPD0gMTAwMDAwMCkgcmV0dXJuIDEyOTsKCiAgICAgICAgcmV0dXJuIDEyOTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYXNlU3RhdHModWludDggaWQpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQzMiByYSwgdWludDMyIHJkLCB1aW50MzIgcnMpIHsKICAgICAgICBpZiAoaWQgPT0gMTUxKSByZXR1cm4gKDIxMCwgMjEwLCAyMDApOwogICAgICAgIGlmIChpZCA9PSAyNTEpIHJldHVybiAoMjEwLCAyMTAsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE5NikgcmV0dXJuICgyNjEsIDE5NCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTk3KSByZXR1cm4gKDEyNiwgMjUwLCAxOTApOwogICAgICAgIGlmIChpZCA9PSAyMzgpIHJldHVybiAoMTUzLCAxMTYsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMjQwKSByZXR1cm4gKDE1MSwgMTA4LCA5MCk7CiAgICAgICAgaWYgKGlkID09IDIzOSkgcmV0dXJuICgxMzUsIDExMCwgOTApOwogICAgICAgIGlmIChpZCA9PSAxNzMpIHJldHVybiAoNzUsIDkxLCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxNzUpIHJldHVybiAoNjcsIDExNiwgNzApOwogICAgICAgIGlmIChpZCA9PSAxNzQpIHJldHVybiAoNjksIDM0LCAxODApOwogICAgICAgIGlmIChpZCA9PSAyMzYpIHJldHVybiAoNjQsIDY0LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDE3MikgcmV0dXJuICg3NywgNjMsIDQwKTsKICAgICAgICBpZiAoaWQgPT0gMjUwKSByZXR1cm4gKDIzOSwgMjc0LCAxOTMpOwogICAgICAgIGlmIChpZCA9PSAyNDkpIHJldHVybiAoMTkzLCAzMjMsIDIxMik7CiAgICAgICAgaWYgKGlkID09IDI0NCkgcmV0dXJuICgyMzUsIDE3NiwgMjMwKTsKICAgICAgICBpZiAoaWQgPT0gMjQzKSByZXR1cm4gKDI0MSwgMjEwLCAxODApOwogICAgICAgIGlmIChpZCA9PSAyNDUpIHJldHVybiAoMTgwLCAyMzUsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE0NSkgcmV0dXJuICgyNTMsIDE4OCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTQ2KSByZXR1cm4gKDI1MSwgMTg0LCAxODApOwogICAgICAgIGlmIChpZCA9PSAxNDQpIHJldHVybiAoMTkyLCAyNDksIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDI0OCkgcmV0dXJuICgyNTEsIDIxMiwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMTQ5KSByZXR1cm4gKDI2MywgMjAxLCAxODIpOwogICAgICAgIGlmIChpZCA9PSAxNDMpIHJldHVybiAoMTkwLCAxOTAsIDMyMCk7CiAgICAgICAgaWYgKGlkID09IDExMikgcmV0dXJuICgyMjIsIDIwNiwgMjEwKTsKICAgICAgICBpZiAoaWQgPT0gMjQyKSByZXR1cm4gKDEyOSwgMjI5LCA1MTApOwogICAgICAgIGlmIChpZCA9PSAyMTIpIHJldHVybiAoMjM2LCAxOTEsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE2MCkgcmV0dXJuICgyMDUsIDE5NywgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gNikgcmV0dXJuICgyMjMsIDE3NiwgMTU2KTsKICAgICAgICBpZiAoaWQgPT0gMTU3KSByZXR1cm4gKDIyMywgMTc2LCAxNTYpOwogICAgICAgIGlmIChpZCA9PSAxMzEpIHJldHVybiAoMTY1LCAxODAsIDI2MCk7CiAgICAgICAgaWYgKGlkID09IDMpIHJldHVybiAoMTk4LCAxOTgsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDIzMykgcmV0dXJuICgxOTgsIDE4MywgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gOSkgcmV0dXJuICgxNzEsIDIxMCwgMTU4KTsKICAgICAgICBpZiAoaWQgPT0gMTU0KSByZXR1cm4gKDE2OCwgMjAyLCAxNjApOwogICAgICAgIGlmIChpZCA9PSAxODIpIHJldHVybiAoMTY5LCAxODksIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDE3NikgcmV0dXJuICgxMzksIDE5MSwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTUwKSByZXR1cm4gKDMwMCwgMTgyLCAxOTMpOwogICAgICAgIGlmIChpZCA9PSAxMzApIHJldHVybiAoMjM3LCAxOTcsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDY4KSByZXR1cm4gKDIzNCwgMTYyLCAxODApOwogICAgICAgIGlmIChpZCA9PSA2NSkgcmV0dXJuICgyNzEsIDE5NCwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNTkpIHJldHVybiAoMjI3LCAxNjYsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDk0KSByZXR1cm4gKDI2MSwgMTU2LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAxOTkpIHJldHVybiAoMTc3LCAxOTQsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDE2OSkgcmV0dXJuICgxOTQsIDE3OCwgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gMjA4KSByZXR1cm4gKDE0OCwgMzMzLCAxNTApOwogICAgICAgIGlmIChpZCA9PSAyMzApIHJldHVybiAoMTk0LCAxOTQsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDE4NikgcmV0dXJuICgxNzQsIDE5MiwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMzYpIHJldHVybiAoMTc4LCAxNzEsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDM4KSByZXR1cm4gKDE2OSwgMjA0LCAxNDYpOwogICAgICAgIGlmIChpZCA9PSAxOTIpIHJldHVybiAoMTg1LCAxNDgsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDI2KSByZXR1cm4gKDE5MywgMTY1LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAyMzcpIHJldHVybiAoMTczLCAyMTQsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDE0OCkgcmV0dXJuICgxNjMsIDEzOCwgMTIyKTsKICAgICAgICBpZiAoaWQgPT0gMjQ3KSByZXR1cm4gKDE1NSwgMTMzLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyKSByZXR1cm4gKDE1MSwgMTUxLCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1KSByZXR1cm4gKDE1OCwgMTI5LCAxMTYpOwogICAgICAgIGlmIChpZCA9PSA4KSByZXR1cm4gKDEyNiwgMTU1LCAxMTgpOwogICAgICAgIGlmIChpZCA9PSAxMzQpIHJldHVybiAoMjA1LCAxNzcsIDI2MCk7CiAgICAgICAgaWYgKGlkID09IDIzMikgcmV0dXJuICgyMTQsIDIxNCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gNzYpIHJldHVybiAoMjExLCAyMjksIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDEzNikgcmV0dXJuICgyNDYsIDIwNCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTM1KSByZXR1cm4gKDIzMiwgMjAxLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxODEpIHJldHVybiAoMjExLCAxNzIsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDYyKSByZXR1cm4gKDE4MiwgMTg3LCAxODApOwogICAgICAgIGlmIChpZCA9PSAzNCkgcmV0dXJuICgyMDQsIDE1NywgMTYyKTsKICAgICAgICBpZiAoaWQgPT0gMzEpIHJldHVybiAoMTgwLCAxNzQsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDIyMSkgcmV0dXJuICgxODEsIDE0NywgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gNzEpIHJldHVybiAoMjA3LCAxMzgsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDE4NSkgcmV0dXJuICgxNjcsIDE5OCwgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMTgpIHJldHVybiAoMTY2LCAxNTcsIDE2Nik7CiAgICAgICAgaWYgKGlkID09IDE1KSByZXR1cm4gKDE2OSwgMTUwLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMikgcmV0dXJuICgxNjcsIDE1MSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMTU5KSByZXR1cm4gKDE1MCwgMTUxLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxODkpIHJldHVybiAoMTE4LCAxOTcsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDIxOSkgcmV0dXJuICgxMzksIDIwOSwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTU2KSByZXR1cm4gKDE1OCwgMTI5LCAxMTYpOwogICAgICAgIGlmIChpZCA9PSAxNTMpIHJldHVybiAoMTIyLCAxNTUsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIxNykgcmV0dXJuICgyMzYsIDE0NCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTM5KSByZXR1cm4gKDIwNywgMjI3LCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyMjkpIHJldHVybiAoMjI0LCAxNTksIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDE0MSkgcmV0dXJuICgyMjAsIDIwMywgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjEwKSByZXR1cm4gKDIxMiwgMTM3LCAxODApOwogICAgICAgIGlmIChpZCA9PSA0NSkgcmV0dXJuICgyMDIsIDE3MCwgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMjA1KSByZXR1cm4gKDE2MSwgMjQyLCAxNTApOwogICAgICAgIGlmIChpZCA9PSA3OCkgcmV0dXJuICgyMDcsIDE2NywgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMjI0KSByZXR1cm4gKDE5NywgMTQxLCAxNTApOwogICAgICAgIGlmIChpZCA9PSAxNzEpIHJldHVybiAoMTQ2LCAxNDYsIDI1MCk7CiAgICAgICAgaWYgKGlkID09IDE2NCkgcmV0dXJuICgxNDUsIDE3OSwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMTc4KSByZXR1cm4gKDE5MiwgMTQ2LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxOTUpIHJldHVybiAoMTUyLCAxNTIsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDEwNSkgcmV0dXJuICgxNDQsIDIwMCwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMTYyKSByZXR1cm4gKDE0OCwgMTMwLCAxNzApOwogICAgICAgIGlmIChpZCA9PSAxNjgpIHJldHVybiAoMTYxLCAxMjgsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE4NCkgcmV0dXJuICgxMTIsIDE1MiwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMTY2KSByZXR1cm4gKDEwNywgMjA5LCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxMDMpIHJldHVybiAoMjMzLCAxNTgsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDg5KSByZXR1cm4gKDE5MCwgMTg0LCAyMTApOwogICAgICAgIGlmIChpZCA9PSA5OSkgcmV0dXJuICgyNDAsIDIxNCwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTQyKSByZXR1cm4gKDIyMSwgMTY0LCAxNjApOwogICAgICAgIGlmIChpZCA9PSA4MCkgcmV0dXJuICgxNzcsIDE5NCwgMTkwKTsKICAgICAgICBpZiAoaWQgPT0gOTEpIHJldHVybiAoMTg2LCAzMjMsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDExNSkgcmV0dXJuICgxODEsIDE2NSwgMjEwKTsKICAgICAgICBpZiAoaWQgPT0gMTA2KSByZXR1cm4gKDIyNCwgMjExLCAxMDApOwogICAgICAgIGlmIChpZCA9PSA3MykgcmV0dXJuICgxNjYsIDIzNywgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMjgpIHJldHVybiAoMTgyLCAyMDIsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDI0MSkgcmV0dXJuICgxNTcsIDIxMSwgMTkwKTsKICAgICAgICBpZiAoaWQgPT0gMTIxKSByZXR1cm4gKDIxMCwgMTg0LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1NSkgcmV0dXJuICgxOTEsIDE2MywgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMTI2KSByZXR1cm4gKDIwNiwgMTY5LCAxMzApOwogICAgICAgIGlmIChpZCA9PSA4MikgcmV0dXJuICgyMjMsIDE4MiwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTI1KSByZXR1cm4gKDE5OCwgMTczLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMTApIHJldHVybiAoMTc0LCAyMjEsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDg1KSByZXR1cm4gKDIxOCwgMTQ1LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1NykgcmV0dXJuICgyMDcsIDE0NCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTA3KSByZXR1cm4gKDE5MywgMjEyLCAxMDApOwogICAgICAgIGlmIChpZCA9PSA5NykgcmV0dXJuICgxNDQsIDIxNSwgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gMTE5KSByZXR1cm4gKDE3NSwgMTU0LCAxNjApOwogICAgICAgIGlmIChpZCA9PSAyMjcpIHJldHVybiAoMTQ4LCAyNjAsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDExNykgcmV0dXJuICgxODcsIDE4MiwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNDkpIHJldHVybiAoMTc5LCAxNTAsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDQwKSByZXR1cm4gKDE1NiwgOTMsIDI4MCk7CiAgICAgICAgaWYgKGlkID09IDEwMSkgcmV0dXJuICgxNzMsIDE3OSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gODcpIHJldHVybiAoMTM5LCAxODQsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDIxNSkgcmV0dXJuICgxODksIDE1NywgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNDIpIHJldHVybiAoMTYxLCAxNTMsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDIyKSByZXR1cm4gKDE4MiwgMTM1LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAyMDcpIHJldHVybiAoMTQzLCAyMDQsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDI0KSByZXR1cm4gKDE2NywgMTU4LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA5MykgcmV0dXJuICgyMjMsIDExMiwgOTApOwogICAgICAgIGlmIChpZCA9PSA0NykgcmV0dXJuICgxNjUsIDE0NiwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjApIHJldHVybiAoMTYxLCAxNDQsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDUzKSByZXR1cm4gKDE1MCwgMTM5LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMTMpIHJldHVybiAoNjAsIDE3NiwgNTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTk4KSByZXR1cm4gKDE3NSwgODcsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDUxKSByZXR1cm4gKDE2NywgMTQ3LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDEwOCkgcmV0dXJuICgxMDgsIDEzNywgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTkwKSByZXR1cm4gKDEzNiwgMTEyLCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxNTgpIHJldHVybiAoMTE3LCAxMTYsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDk1KSByZXR1cm4gKDg1LCAyODgsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMSkgcmV0dXJuICgxMTgsIDExOCwgOTApOwogICAgICAgIGlmIChpZCA9PSAyMjUpIHJldHVybiAoMTI4LCA5MCwgOTApOwogICAgICAgIGlmIChpZCA9PSA0KSByZXR1cm4gKDExNiwgOTYsIDc4KTsKICAgICAgICBpZiAoaWQgPT0gMTU1KSByZXR1cm4gKDExNiwgOTYsIDc4KTsKICAgICAgICBpZiAoaWQgPT0gNykgcmV0dXJuICg5NCwgMTIyLCA4OCk7CiAgICAgICAgaWYgKGlkID09IDE1MikgcmV0dXJuICg5MiwgMTIyLCA5MCk7CiAgICAgICAgaWYgKGlkID09IDI1KSByZXR1cm4gKDExMiwgMTAxLCA3MCk7CiAgICAgICAgaWYgKGlkID09IDEzMikgcmV0dXJuICg5MSwgOTEsIDk2KTsKICAgICAgICBpZiAoaWQgPT0gNjcpIHJldHVybiAoMTc3LCAxMzAsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDY0KSByZXR1cm4gKDIzMiwgMTM4LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDc1KSByZXR1cm4gKDE2NCwgMTk2LCAxMTApOwogICAgICAgIGlmIChpZCA9PSA3MCkgcmV0dXJuICgxNzIsIDk1LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxODApIHJldHVybiAoMTQ1LCAxMTIsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDYxKSByZXR1cm4gKDEzMCwgMTMwLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAzMykgcmV0dXJuICgxMzcsIDExMiwgMTIyKTsKICAgICAgICBpZiAoaWQgPT0gMzApIHJldHVybiAoMTE3LCAxMjYsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE3KSByZXR1cm4gKDExNywgMTA4LCAxMjYpOwogICAgICAgIGlmIChpZCA9PSAyMDIpIHJldHVybiAoNjAsIDEwNiwgMzgwKTsKICAgICAgICBpZiAoaWQgPT0gMTg4KSByZXR1cm4gKDkxLCAxMjcsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDExKSByZXR1cm4gKDQ1LCA5NCwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTQpIHJldHVybiAoNDYsIDg2LCA5MCk7CiAgICAgICAgaWYgKGlkID09IDIzNSkgcmV0dXJuICg0MCwgODgsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDIxNCkgcmV0dXJuICgyMzQsIDE4OSwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMTI3KSByZXR1cm4gKDIzOCwgMTk3LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMjQpIHJldHVybiAoMjIzLCAxODIsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDEyOCkgcmV0dXJuICgxOTgsIDE5NywgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMTIzKSByZXR1cm4gKDIxOCwgMTcwLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyMjYpIHJldHVybiAoMTQ4LCAyNjAsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDIzNCkgcmV0dXJuICgxOTIsIDEzMiwgMTQ2KTsKICAgICAgICBpZiAoaWQgPT0gMTIyKSByZXR1cm4gKDE5MiwgMjMzLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDIxMSkgcmV0dXJuICgxODQsIDE0OCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMjAzKSByZXR1cm4gKDE4MiwgMTMzLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyMDApIHJldHVybiAoMTY3LCAxNjcsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIwNikgcmV0dXJuICgxMzEsIDEzMSwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gNDQpIHJldHVybiAoMTUzLCAxMzksIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDE5MykgcmV0dXJuICgxNTQsIDk0LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAyMjIpIHJldHVybiAoMTE4LCAxNTYsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDU4KSByZXR1cm4gKDEzNiwgOTYsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDgzKSByZXR1cm4gKDEyNCwgMTE4LCAxMDQpOwogICAgICAgIGlmIChpZCA9PSAzNSkgcmV0dXJuICgxMDcsIDExNiwgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMjAxKSByZXR1cm4gKDEzNiwgOTEsIDk2KTsKICAgICAgICBpZiAoaWQgPT0gMzcpIHJldHVybiAoOTYsIDEyMiwgNzYpOwogICAgICAgIGlmIChpZCA9PSAyMTgpIHJldHVybiAoMTE4LCA3MSwgODApOwogICAgICAgIGlmIChpZCA9PSAyMjApIHJldHVybiAoOTAsIDc0LCAxMDApOwogICAgICAgIGlmIChpZCA9PSAyMTMpIHJldHVybiAoMTcsIDM5NiwgNDApOwogICAgICAgIGlmIChpZCA9PSAxMTQpIHJldHVybiAoMTgzLCAyMDUsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDEzNykgcmV0dXJuICgxNTMsIDEzOSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gNzcpIHJldHVybiAoMTcwLCAxMzIsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDEzOCkgcmV0dXJuICgxNTUsIDE3NCwgNzApOwogICAgICAgIGlmIChpZCA9PSAxNDApIHJldHVybiAoMTQ4LCAxNjIsIDYwKTsKICAgICAgICBpZiAoaWQgPT0gMjA5KSByZXR1cm4gKDEzNywgODksIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIyOCkgcmV0dXJuICgxNTIsIDkzLCA5MCk7CiAgICAgICAgaWYgKGlkID09IDE3MCkgcmV0dXJuICgxMDYsIDEwNiwgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMjA0KSByZXR1cm4gKDEwOCwgMTQ2LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA5MikgcmV0dXJuICgxODYsIDcwLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDEzMykgcmV0dXJuICgxMDQsIDEyMSwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTA0KSByZXR1cm4gKDkwLCAxNjUsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDE3NykgcmV0dXJuICgxMzQsIDg5LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDI0NikgcmV0dXJuICgxMTUsIDkzLCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxNDcpIHJldHVybiAoMTE5LCA5NCwgODIpOwogICAgICAgIGlmIChpZCA9PSA0NikgcmV0dXJuICgxMjEsIDk5LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDE5NCkgcmV0dXJuICg3NSwgNzUsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDExMSkgcmV0dXJuICgxNDAsIDE1NywgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gOTgpIHJldHVybiAoMTgxLCAxNTYsIDYwKTsKICAgICAgICBpZiAoaWQgPT0gODgpIHJldHVybiAoMTM1LCA5MCwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gNzkpIHJldHVybiAoMTA5LCAxMDksIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDY2KSByZXR1cm4gKDEzNywgODgsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDI3KSByZXR1cm4gKDEyNiwgMTQ1LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA3NCkgcmV0dXJuICgxMzIsIDE2MywgODApOwogICAgICAgIGlmIChpZCA9PSAyMTYpIHJldHVybiAoMTQyLCA5MywgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjMxKSByZXR1cm4gKDEwNywgMTA3LCAxODApOwogICAgICAgIGlmIChpZCA9PSA2MykgcmV0dXJuICgxOTUsIDEwMywgNTApOwogICAgICAgIGlmIChpZCA9PSAxMDIpIHJldHVybiAoMTA3LCAxNDAsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDEwOSkgcmV0dXJuICgxMTksIDE2NCwgODApOwogICAgICAgIGlmIChpZCA9PSA4MSkgcmV0dXJuICgxNjUsIDEyOCwgNTApOwogICAgICAgIGlmIChpZCA9PSA4NCkgcmV0dXJuICgxNTgsIDg4LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDExOCkgcmV0dXJuICgxMjMsIDExNSwgOTApOwogICAgICAgIGlmIChpZCA9PSA1NikgcmV0dXJuICgxNDgsIDg3LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDk2KSByZXR1cm4gKDg5LCAxNTgsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDU0KSByZXR1cm4gKDEyMiwgOTYsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDkwKSByZXR1cm4gKDExNiwgMTY4LCA2MCk7CiAgICAgICAgaWYgKGlkID09IDcyKSByZXR1cm4gKDk3LCAxODIsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTIwKSByZXR1cm4gKDEzNywgMTEyLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDExNikgcmV0dXJuICgxMjksIDEyNSwgNjApOwogICAgICAgIGlmIChpZCA9PSA2OSkgcmV0dXJuICgxMzksIDY0LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA0OCkgcmV0dXJuICgxMDAsIDEwMiwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gODYpIHJldHVybiAoODUsIDEyOCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTc5KSByZXR1cm4gKDExNCwgODIsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDEwMCkgcmV0dXJuICgxMDksIDExNCwgODApOwogICAgICAgIGlmIChpZCA9PSAyMykgcmV0dXJuICgxMTAsIDEwMiwgNzApOwogICAgICAgIGlmIChpZCA9PSAyMjMpIHJldHVybiAoMTI3LCA2OSwgNzApOwogICAgICAgIGlmIChpZCA9PSAzMikgcmV0dXJuICgxMDUsIDc2LCA5Mik7CiAgICAgICAgaWYgKGlkID09IDI5KSByZXR1cm4gKDg2LCA5NCwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMzkpIHJldHVybiAoODAsIDQ0LCAyMzApOwogICAgICAgIGlmIChpZCA9PSA2MCkgcmV0dXJuICgxMDEsIDgyLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDE2NykgcmV0dXJuICgxMDUsIDczLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDIxKSByZXR1cm4gKDExMiwgNjEsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTY1KSByZXR1cm4gKDcyLCAxNDIsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTYzKSByZXR1cm4gKDY3LCAxMDEsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDUyKSByZXR1cm4gKDkyLCA4MSwgODApOwogICAgICAgIGlmIChpZCA9PSAxOSkgcmV0dXJuICgxMDMsIDcwLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDE2KSByZXR1cm4gKDg1LCA3NiwgODApOwogICAgICAgIGlmIChpZCA9PSA0MSkgcmV0dXJuICg4MywgNzYsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTYxKSByZXR1cm4gKDc5LCA3NywgNzApOwogICAgICAgIGlmIChpZCA9PSAxODcpIHJldHVybiAoNjcsIDEwMSwgNzApOwogICAgICAgIGlmIChpZCA9PSA1MCkgcmV0dXJuICgxMDksIDg4LCAyMCk7CiAgICAgICAgaWYgKGlkID09IDE4MykgcmV0dXJuICgzNywgOTMsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDEzKSByZXR1cm4gKDYzLCA1NSwgODApOwogICAgICAgIGlmIChpZCA9PSAxMCkgcmV0dXJuICg1NSwgNjIsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMTkxKSByZXR1cm4gKDU1LCA1NSwgNjApOwogICAgICAgIGlmIChpZCA9PSA0MykgcmV0dXJuICgxMzEsIDExNiwgOTApOwogICAgICAgIGlmIChpZCA9PSAxMjkpIHJldHVybiAoMjksIDEwMiwgNDApOwogICAgICAgIHJldHVybiAoMCwgMCwgMCk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNxcnQodWludDI1NiB4KSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2IHkpIHsKICAgICAgICB1aW50MjU2IHogPSAoeCArIDEpIC8gMjsKICAgICAgICB5ID0geDsKICAgICAgICB3aGlsZSAoeiA8IHkpIHsKICAgICAgICAgICAgeSA9IHo7CiAgICAgICAgICAgIHogPSAoeCAvIHogKyB6KSAvIDI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1heENQKHVpbnQyNTYgZ2VuZXMsIHVpbnQxNiBnZW5lcmF0aW9uKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MzIgbWF4X2NwKSB7CiAgICAgICAgdmFyIGNvZGUgPSB1aW50OChnZW5lcyAmIDB4RkYpOwogICAgICAgIHZhciBhID0gdWludDMyKChnZW5lcyA+PiA4KSAmIDB4RkYpOwogICAgICAgIHZhciBkID0gdWludDMyKChnZW5lcyA+PiAxNikgJiAweEZGKTsKICAgICAgICB2YXIgcyA9IHVpbnQzMigoZ2VuZXMgPj4gMjQpICYgMHhGRik7Ci8vICAgICAgdmFyIGdlbmRlciA9IHVpbnQzMigoZ2VuZXMgPj4gMzIpICYgMHgxKTsKICAgICAgICB2YXIgYmdDb2xvciA9IHVpbnQ4KChnZW5lcyA+PiAzMykgJiAweEZGKTsKICAgICAgICB2YXIgKHJhLCByZCwgcnMpID0gZ2V0QmFzZVN0YXRzKGNvZGUpOwoKCiAgICAgICAgbWF4X2NwID0gdWludDMyKHNxcnQodWludDI1NihyYSArIGEpICogdWludDI1NihyYSArIGEpICogdWludDI1NihyZCArIGQpICogdWludDI1NihycyArIHMpICogMzkwMDkyNzkzODk5MzI4MS8xMDAwMDAwMDAwMDAwMDAwMCAvIDEwMCkpOwogICAgICAgIGlmKG1heF9jcCA8IDEwKQogICAgICAgICAgICBtYXhfY3AgPSAxMDsKCiAgICAgICAgaWYoZ2VuZXJhdGlvbiA8IDEwKQogICAgICAgICAgICBtYXhfY3AgKz0gKDEwIC0gZ2VuZXJhdGlvbikgKiA1MDsKCiAgICAgICAgLy8gYmdDb2xvcgogICAgICAgIGlmKGJnQ29sb3IgPj0gOCkKICAgICAgICAgICAgYmdDb2xvciA9IDA7CgogICAgICAgIG1heF9jcCArPSBiZ0NvbG9yICogMjU7CiAgICAgICAgcmV0dXJuIG1heF9jcDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlKHVpbnQyNTYgZ2VuZXMpIHB1cmUgcHVibGljIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ4KGdlbmVzICYgMHhGRik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXR0YWNrKHVpbnQyNTYgZ2VuZXMpIHB1cmUgcHVibGljIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ4KChnZW5lcyA+PiA4KSAmIDB4RkYpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERlZmVuc2UodWludDI1NiBnZW5lcykgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoKGdlbmVzID4+IDE2KSAmIDB4RkYpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFN0YW1pbmEodWludDI1NiBnZW5lcykgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoKGdlbmVzID4+IDI0KSAmIDB4RkYpOwogICAgfQoKICAgIC8vLyBAZGV2IGdpdmVuIGdlbmVzIG9mIGtpdHRlbiAxICYgMiwgcmV0dXJuIGEgZ2VuZXRpYyBjb21iaW5hdGlvbiAtIG1heSBoYXZlIGEgcmFuZG9tIGZhY3RvcgogICAgLy8vIEBwYXJhbSBnZW5lczEgZ2VuZXMgb2YgbW9tCiAgICAvLy8gQHBhcmFtIGdlbmVzMiBnZW5lcyBvZiBzaXJlCiAgICAvLy8gQHJldHVybiB0aGUgZ2VuZXMgdGhhdCBhcmUgc3VwcG9zZWQgdG8gYmUgcGFzc2VkIGRvd24gdGhlIGNoaWxkCiAgICBmdW5jdGlvbiBtaXhHZW5lcyh1aW50MjU2IGdlbmVzMSwgdWludDI1NiBnZW5lczIsIHVpbnQyNTYgdGFyZ2V0QmxvY2spIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgogICAgICAgIHVpbnQ4IGNvZGU7CiAgICAgICAgdmFyIHIgPSByYW5kb20oMTApOwoKICAgICAgICAvLyAyMCUgcGVyY2VudCBvZiBwYXJlbnRzIEROQQogICAgICAgIGlmKHIgPT0gMCkKICAgICAgICAgICAgY29kZSA9IGdldENvZGUoZ2VuZXMxKTsKICAgICAgICBlbHNlIGlmKHIgPT0gMSkKICAgICAgICAgICAgY29kZSA9IGdldENvZGUoZ2VuZXMyKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUgPSByYW5kb21Db2RlKCk7CgogICAgICAgIC8vIDcwJSBwZXJjZW50IG9mIHBhcmVudHMgRE5BCiAgICAgICAgdmFyIGF0dGFjayA9IHJhbmRvbSgzKSA9PSAwID8gdWludDgocmFuZG9tKDMyKSkgOiB1aW50OChyYW5kb21CZXR3ZWVuKGdldEF0dGFjayhnZW5lczEpLCBnZXRBdHRhY2soZ2VuZXMyKSkpOwogICAgICAgIHZhciBkZWZlbnNlID0gcmFuZG9tKDMpID09IDAgPyB1aW50OChyYW5kb20oMzIpKSA6IHVpbnQ4KHJhbmRvbUJldHdlZW4oZ2V0RGVmZW5zZShnZW5lczEpLCBnZXREZWZlbnNlKGdlbmVzMikpKTsKICAgICAgICB2YXIgc3RhbWluYSA9IHJhbmRvbSgzKSA9PSAwID8gdWludDgocmFuZG9tKDMyKSkgOiB1aW50OChyYW5kb21CZXR3ZWVuKGdldFN0YW1pbmEoZ2VuZXMxKSwgZ2V0U3RhbWluYShnZW5lczIpKSk7CiAgICAgICAgdmFyIGdlbmRlciA9IHVpbnQ4KHJhbmRvbSgyKSk7CiAgICAgICAgdmFyIGJnQ29sb3IgPSB1aW50OChyYW5kb20oOCkpOwogICAgICAgIHZhciByYW5kID0gcmFuZG9tKH51aW50NjQoMCkpOwoKICAgICAgICByZXR1cm4gdWludDI1Nihjb2RlKSAvLyA4CiAgICAgICAgfCAodWludDI1NihhdHRhY2spIDw8IDgpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KGRlZmVuc2UpIDw8IDE2KSAvLyA4CiAgICAgICAgfCAodWludDI1NihzdGFtaW5hKSA8PCAyNCkgLy8gOAogICAgICAgIHwgKHVpbnQyNTYoZ2VuZGVyKSA8PCAzMikgLy8gMQogICAgICAgIHwgKHVpbnQyNTYoYmdDb2xvcikgPDwgMzMpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KHJhbmQpIDw8IDQxKSAvLyA2NAogICAgICAgIDsKICAgIH0KCiAgICBmdW5jdGlvbiByYW5kb21HZW5lcygpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdmFyIGNvZGUgPSByYW5kb21Db2RlKCk7CiAgICAgICAgdmFyIGF0dGFjayA9IHVpbnQ4KHJhbmRvbSgzMikpOwogICAgICAgIHZhciBkZWZlbnNlID0gdWludDgocmFuZG9tKDMyKSk7CiAgICAgICAgdmFyIHN0YW1pbmEgPSB1aW50OChyYW5kb20oMzIpKTsKICAgICAgICB2YXIgZ2VuZGVyID0gdWludDgocmFuZG9tKDIpKTsKICAgICAgICB2YXIgYmdDb2xvciA9IHVpbnQ4KHJhbmRvbSg4KSk7CiAgICAgICAgdmFyIHJhbmQgPSByYW5kb20ofnVpbnQ2NCgwKSk7CgogICAgICAgIHJldHVybiB1aW50MjU2KGNvZGUpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KGF0dGFjaykgPDwgOCkgLy8gOAogICAgICAgIHwgKHVpbnQyNTYoZGVmZW5zZSkgPDwgMTYpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KHN0YW1pbmEpIDw8IDI0KSAvLyA4CiAgICAgICAgfCAodWludDI1NihnZW5kZXIpIDw8IDMyKSAvLyAxCiAgICAgICAgfCAodWludDI1NihiZ0NvbG9yKSA8PCAzMykgLy8gOAogICAgICAgIHwgKHVpbnQyNTYocmFuZCkgPDwgNDEpIC8vIDY0CiAgICAgICAgOwogICAgfQp9CgovLy8gQHRpdGxlIENsb2NrIGF1Y3Rpb24gbW9kaWZpZWQgZm9yIHNhbGUgb2YgbW9uc3RlcnMKLy8vIEBub3RpY2UgV2Ugb21pdCBhIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBzZW5kcyB0byB0aGlzIGNvbnRyYWN0Lgpjb250cmFjdCBTYWxlQ2xvY2tBdWN0aW9uIGlzIENsb2NrQXVjdGlvbiB7CgogICAgLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IGF1Y3Rpb24gaW4gb3VyIHNldFNhbGVBdWN0aW9uQWRkcmVzcygpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc1NhbGVDbG9ja0F1Y3Rpb24gPSB0cnVlOwoKICAgIC8vIFRyYWNrcyBsYXN0IDUgc2FsZSBwcmljZSBvZiBnZW4wIG1vbnN0ZXIgc2FsZXMKICAgIHVpbnQyNTYgcHVibGljIGdlbjBTYWxlQ291bnQ7CiAgICB1aW50MjU2WzVdIHB1YmxpYyBsYXN0R2VuMFNhbGVQcmljZXM7CgogICAgLy8gRGVsZWdhdGUgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNhbGVDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkciwgdWludDI1NiBfY3V0KSBwdWJsaWMKICAgIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgX2N1dCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpOwogICAgICAgIF9lc2Nyb3coX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIGxhc3RTYWxlUHJpY2UgaWYgc2VsbGVyIGlzIHRoZSBuZnQgY29udHJhY3QKICAgIC8vLyBPdGhlcndpc2UsIHdvcmtzIHRoZSBzYW1lIGFzIGRlZmF1bHQgYmlkIG1ldGhvZC4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHsKICAgICAgICAvLyBfYmlkIHZlcmlmaWVzIHRva2VuIElEIHNpemUKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICB1aW50MjU2IHByaWNlID0gX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAvLyBJZiBub3QgYSBnZW4wIGF1Y3Rpb24sIGV4aXQKICAgICAgICBpZiAoc2VsbGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpIHsKICAgICAgICAgICAgLy8gVHJhY2sgZ2VuMCBzYWxlIHByaWNlcwogICAgICAgICAgICBsYXN0R2VuMFNhbGVQcmljZXNbZ2VuMFNhbGVDb3VudCAlIDVdID0gcHJpY2U7CiAgICAgICAgICAgIGdlbjBTYWxlQ291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZUdlbjBTYWxlUHJpY2UoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBsYXN0R2VuMFNhbGVQcmljZXNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdW0gLyA1OwogICAgfQoKfQoKLy8vIEB0aXRsZSBSZXZlcnNlIGF1Y3Rpb24gbW9kaWZpZWQgZm9yIHNpcmluZwovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IFNpcmluZ0Nsb2NrQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTaXJpbmdBdWN0aW9uQWRkcmVzcygpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc1NpcmluZ0Nsb2NrQXVjdGlvbiA9IHRydWU7CgogICAgLy8gRGVsZWdhdGUgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNpcmluZ0Nsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyLCB1aW50MjU2IF9jdXQpIHB1YmxpYwogICAgQ2xvY2tBdWN0aW9uKF9uZnRBZGRyLCBfY3V0KSB7fQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYW5kIGJlZ2lucyBhIG5ldyBhdWN0aW9uLiBTaW5jZSB0aGlzIGZ1bmN0aW9uIGlzIHdyYXBwZWQsCiAgICAvLy8gcmVxdWlyZSBzZW5kZXIgdG8gYmUgTW9uc3RlckNvcmUgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIGF1Y3Rpb24gKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgUGxhY2VzIGEgYmlkIGZvciBzaXJpbmcuIFJlcXVpcmVzIHRoZSBzZW5kZXIKICAgIC8vLyBpcyB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgYmVjYXVzZSBhbGwgYmlkIG1ldGhvZHMKICAgIC8vLyBzaG91bGQgYmUgd3JhcHBlZC4gQWxzbyByZXR1cm5zIHRoZSBtb25zdGVyIHRvIHRoZQogICAgLy8vIHNlbGxlciByYXRoZXIgdGhhbiB0aGUgd2lubmVyLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICAvLyBfYmlkIGNoZWNrcyB0aGF0IHRva2VuIElEIGlzIHZhbGlkIGFuZCB3aWxsIHRocm93IGlmIGJpZCBmYWlscwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgLy8gV2UgdHJhbnNmZXIgdGhlIG1vbnN0ZXIgYmFjayB0byB0aGUgc2VsbGVyLCB0aGUgd2lubmVyIHdpbGwgZ2V0CiAgICAgICAgLy8gdGhlIG9mZnNwcmluZwogICAgICAgIF90cmFuc2ZlcihzZWxsZXIsIF90b2tlbklkKTsKICAgIH0KCn0KCgoKCgoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIE1vbnN0ZXJDb3JlIHRoYXQgbWFuYWdlcyBzcGVjaWFsIGFjY2VzcyBwcml2aWxlZ2VzLgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKQovLy8gQGRldiBTZWUgdGhlIE1vbnN0ZXJDb3JlIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gdG8gdW5kZXJzdGFuZCBob3cgdGhlIHZhcmlvdXMgY29udHJhY3QgZmFjZXRzIGFyZSBhcnJhbmdlZC4KY29udHJhY3QgTW9uc3RlckFjY2Vzc0NvbnRyb2wgewogICAgLy8gVGhpcyBmYWNldCBjb250cm9scyBhY2Nlc3MgY29udHJvbCBmb3IgQ3J5cHRvTW9uc3RlcnMuIFRoZXJlIGFyZSBmb3VyIHJvbGVzIG1hbmFnZWQgaGVyZToKICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcyBhbmQgY2hhbmdlIHRoZSBhZGRyZXNzZXMgb2Ygb3VyIGRlcGVuZGVudCBzbWFydAogICAgLy8gICAgICAgICBjb250cmFjdHMuIEl0IGlzIGFsc28gdGhlIG9ubHkgcm9sZSB0aGF0IGNhbiB1bnBhdXNlIHRoZSBzbWFydCBjb250cmFjdC4gSXQgaXMgaW5pdGlhbGx5CiAgICAvLyAgICAgICAgIHNldCB0byB0aGUgYWRkcmVzcyB0aGF0IGNyZWF0ZWQgdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBNb25zdGVyQ29yZSBjb25zdHJ1Y3Rvci4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0ZPOiBUaGUgQ0ZPIGNhbiB3aXRoZHJhdyBmdW5kcyBmcm9tIE1vbnN0ZXJDb3JlIGFuZCBpdHMgYXVjdGlvbiBjb250cmFjdHMuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENPTzogVGhlIENPTyBjYW4gcmVsZWFzZSBnZW4wIG1vbnN0ZXJzIHRvIGF1Y3Rpb24sIGFuZCBtaW50IHByb21vIG1vbnN0ZXJzLgogICAgLy8KICAgIC8vIEl0IHNob3VsZCBiZSBub3RlZCB0aGF0IHRoZXNlIHJvbGVzIGFyZSBkaXN0aW5jdCB3aXRob3V0IG92ZXJsYXAgaW4gdGhlaXIgYWNjZXNzIGFiaWxpdGllcywgdGhlCiAgICAvLyBhYmlsaXRpZXMgbGlzdGVkIGZvciBlYWNoIHJvbGUgYWJvdmUgYXJlIGV4aGF1c3RpdmUuIEluIHBhcnRpY3VsYXIsIHdoaWxlIHRoZSBDRU8gY2FuIGFzc2lnbiBhbnkKICAgIC8vIGFkZHJlc3MgdG8gYW55IHJvbGUsIHRoZSBDRU8gYWRkcmVzcyBpdHNlbGYgZG9lc24ndCBoYXZlIHRoZSBhYmlsaXR5IHRvIGFjdCBpbiB0aG9zZSByb2xlcy4gVGhpcwogICAgLy8gcmVzdHJpY3Rpb24gaXMgaW50ZW50aW9uYWwgc28gdGhhdCB3ZSBhcmVuJ3QgdGVtcHRlZCB0byB1c2UgdGhlIENFTyBhZGRyZXNzIGZyZXF1ZW50bHkgb3V0IG9mCiAgICAvLyBjb252ZW5pZW5jZS4gVGhlIGxlc3Mgd2UgdXNlIGFuIGFkZHJlc3MsIHRoZSBsZXNzIGxpa2VseSBpdCBpcyB0aGF0IHdlIHNvbWVob3cgY29tcHJvbWlzZSB0aGUKICAgIC8vIGFjY291bnQuCgogICAgLy8vIEBkZXYgRW1pdGVkIHdoZW4gY29udHJhY3QgaXMgdXBncmFkZWQgLSBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyBuZXdDb250cmFjdCk7CgogICAgLy8gVGhlIGFkZHJlc3NlcyBvZiB0aGUgYWNjb3VudHMgKG9yIGNvbnRyYWN0cykgdGhhdCBjYW4gZXhlY3V0ZSBhY3Rpb25zIHdpdGhpbiBlYWNoIHJvbGVzLgogICAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwoKICAgIC8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENFTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRk8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ09PLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNPTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q0xldmVsKCkgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENFTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0VPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0VPCiAgICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNlb0FkZHJlc3MgPSBfbmV3Q0VPOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENGTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0ZPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0ZPCiAgICBmdW5jdGlvbiBzZXRDRk8oYWRkcmVzcyBfbmV3Q0ZPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRk8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENPTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q09PIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ09PCiAgICBmdW5jdGlvbiBzZXRDT08oYWRkcmVzcyBfbmV3Q09PKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNvb0FkZHJlc3MgPSBfbmV3Q09POwogICAgfQoKICAgIC8qKiogUGF1c2FibGUgZnVuY3Rpb25hbGl0eSBhZGFwdGVkIGZyb20gT3BlblplcHBlbGluICoqKi8KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSAiQy1sZXZlbCIgcm9sZSB0byBwYXVzZSB0aGUgY29udHJhY3QuIFVzZWQgb25seSB3aGVuCiAgICAvLy8gIGEgYnVnIG9yIGV4cGxvaXQgaXMgZGV0ZWN0ZWQgYW5kIHdlIG5lZWQgdG8gbGltaXQgZGFtYWdlLgogICAgZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTywgc2luY2UKICAgIC8vLyAgb25lIHJlYXNvbiB3ZSBtYXkgcGF1c2UgdGhlIGNvbnRyYWN0IGlzIHdoZW4gQ0ZPIG9yIENPTyBhY2NvdW50cyBhcmUKICAgIC8vLyAgY29tcHJvbWlzZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5CiAgICAvLy8gIGRlcml2ZWQgY29udHJhY3RzLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIGNhbid0IHVucGF1c2UgaWYgY29udHJhY3Qgd2FzIHVwZ3JhZGVkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cn0KCgoKCi8vLyBAdGl0bGUgQmFzZSBjb250cmFjdCBmb3IgQ3J5cHRvTW9uc3RlcnMuIEhvbGRzIGFsbCBjb21tb24gc3RydWN0cywgZXZlbnRzIGFuZCBiYXNlIHZhcmlhYmxlcy4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgU2VlIHRoZSBNb25zdGVyQ29yZSBjb250cmFjdCBkb2N1bWVudGF0aW9uIHRvIHVuZGVyc3RhbmQgaG93IHRoZSB2YXJpb3VzIGNvbnRyYWN0IGZhY2V0cyBhcmUgYXJyYW5nZWQuCmNvbnRyYWN0IE1vbnN0ZXJCYXNlIGlzIE1vbnN0ZXJBY2Nlc3NDb250cm9sIHsKICAgIC8qKiogRVZFTlRTICoqKi8KCiAgICAvLy8gQGRldiBUaGUgQmlydGggZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBuZXcgbW9uc3RlciBjb21lcyBpbnRvIGV4aXN0ZW5jZS4gVGhpcyBvYnZpb3VzbHkKICAgIC8vLyAgaW5jbHVkZXMgYW55IHRpbWUgYSBtb25zdGVyIGlzIGNyZWF0ZWQgdGhyb3VnaCB0aGUgZ2l2ZUJpcnRoIG1ldGhvZCwgYnV0IGl0IGlzIGFsc28gY2FsbGVkCiAgICAvLy8gIHdoZW4gYSBuZXcgZ2VuMCBtb25zdGVyIGlzIGNyZWF0ZWQuCiAgICBldmVudCBCaXJ0aChhZGRyZXNzIG93bmVyLCB1aW50MjU2IG1vbnN0ZXJJZCwgdWludDI1NiBtYXRyb25JZCwgdWludDI1NiBzaXJlSWQsIHVpbnQyNTYgZ2VuZXMsIHVpbnQxNiBnZW5lcmF0aW9uKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlciBldmVudCBhcyBkZWZpbmVkIGluIGN1cnJlbnQgZHJhZnQgb2YgRVJDNzIxLiBFbWl0dGVkIGV2ZXJ5IHRpbWUgYSBtb25zdGVyCiAgICAvLy8gIG93bmVyc2hpcCBpcyBhc3NpZ25lZCwgaW5jbHVkaW5nIGJpcnRocy4KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKCiAgICAvKioqIERBVEEgVFlQRVMgKioqLwoKICAgIC8vLyBAZGV2IFRoZSBtYWluIE1vbnN0ZXIgc3RydWN0LiBFdmVyeSBtb25zdGVyIGluIENyeXB0b01vbnN0ZXJzIGlzIHJlcHJlc2VudGVkIGJ5IGEgY29weQogICAgLy8vICBvZiB0aGlzIHN0cnVjdHVyZSwgc28gZ3JlYXQgY2FyZSB3YXMgdGFrZW4gdG8gZW5zdXJlIHRoYXQgaXQgZml0cyBuZWF0bHkgaW50bwogICAgLy8vICBleGFjdGx5IHR3byAyNTYtYml0IHdvcmRzLiBOb3RlIHRoYXQgdGhlIG9yZGVyIG9mIHRoZSBtZW1iZXJzIGluIHRoaXMgc3RydWN0dXJlCiAgICAvLy8gIGlzIGltcG9ydGFudCBiZWNhdXNlIG9mIHRoZSBieXRlLXBhY2tpbmcgcnVsZXMgdXNlZCBieSBFdGhlcmV1bS4KICAgIC8vLyAgUmVmOiBodHRwOi8vc29saWRpdHkucmVhZHRoZWRvY3MuaW8vZW4vZGV2ZWxvcC9taXNjZWxsYW5lb3VzLmh0bWwKICAgIHN0cnVjdCBNb25zdGVyIHsKICAgICAgICAvLyBUaGUgTW9uc3RlcidzIGdlbmV0aWMgY29kZSBpcyBwYWNrZWQgaW50byB0aGVzZSAyNTYtYml0cywgdGhlIGZvcm1hdCBpcwogICAgICAgIC8vIHNvb3Blci1zZWtyZXQhIEEgbW9uc3RlcidzIGdlbmVzIG5ldmVyIGNoYW5nZS4KICAgICAgICB1aW50MjU2IGdlbmVzOwoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIGZyb20gdGhlIGJsb2NrIHdoZW4gdGhpcyBtb25zdGVyIGNhbWUgaW50byBleGlzdGVuY2UuCiAgICAgICAgdWludDY0IGJpcnRoVGltZTsKCiAgICAgICAgLy8gVGhlIG1pbmltdW0gdGltZXN0YW1wIGFmdGVyIHdoaWNoIHRoaXMgbW9uc3RlciBjYW4gZW5nYWdlIGluIGJyZWVkaW5nCiAgICAgICAgLy8gYWN0aXZpdGllcyBhZ2Fpbi4gVGhpcyBzYW1lIHRpbWVzdGFtcCBpcyB1c2VkIGZvciB0aGUgcHJlZ25hbmN5CiAgICAgICAgLy8gdGltZXIgKGZvciBtYXRyb25zKSBhcyB3ZWxsIGFzIHRoZSBzaXJpbmcgY29vbGRvd24uCiAgICAgICAgdWludDY0IGNvb2xkb3duRW5kQmxvY2s7CgogICAgICAgIC8vIFRoZSBJRCBvZiB0aGUgcGFyZW50cyBvZiB0aGlzIG1vbnN0ZXIsIHNldCB0byAwIGZvciBnZW4wIG1vbnN0ZXJzLgogICAgICAgIC8vIE5vdGUgdGhhdCB1c2luZyAzMi1iaXQgdW5zaWduZWQgaW50ZWdlcnMgbGltaXRzIHVzIHRvIGEgIm1lcmUiCiAgICAgICAgLy8gNCBiaWxsaW9uIG1vbnN0ZXJzLiBUaGlzIG51bWJlciBtaWdodCBzZWVtIHNtYWxsIHVudGlsIHlvdSByZWFsaXplCiAgICAgICAgLy8gdGhhdCBFdGhlcmV1bSBjdXJyZW50bHkgaGFzIGEgbGltaXQgb2YgYWJvdXQgNTAwIG1pbGxpb24KICAgICAgICAvLyB0cmFuc2FjdGlvbnMgcGVyIHllYXIhIFNvLCB0aGlzIGRlZmluaXRlbHkgd29uJ3QgYmUgYSBwcm9ibGVtCiAgICAgICAgLy8gZm9yIHNldmVyYWwgeWVhcnMgKGV2ZW4gYXMgRXRoZXJldW0gbGVhcm5zIHRvIHNjYWxlKS4KICAgICAgICB1aW50MzIgbWF0cm9uSWQ7CiAgICAgICAgdWludDMyIHNpcmVJZDsKCiAgICAgICAgLy8gU2V0IHRvIHRoZSBJRCBvZiB0aGUgc2lyZSBtb25zdGVyIGZvciBtYXRyb25zIHRoYXQgYXJlIHByZWduYW50LAogICAgICAgIC8vIHplcm8gb3RoZXJ3aXNlLiBBIG5vbi16ZXJvIHZhbHVlIGhlcmUgaXMgaG93IHdlIGtub3cgYSBtb25zdGVyCiAgICAgICAgLy8gaXMgcHJlZ25hbnQuIFVzZWQgdG8gcmV0cmlldmUgdGhlIGdlbmV0aWMgbWF0ZXJpYWwgZm9yIHRoZSBuZXcKICAgICAgICAvLyBtb25zdGVyIHdoZW4gdGhlIGJpcnRoIHRyYW5zcGlyZXMuCiAgICAgICAgdWludDMyIHNpcmluZ1dpdGhJZDsKCiAgICAgICAgLy8gU2V0IHRvIHRoZSBpbmRleCBpbiB0aGUgY29vbGRvd24gYXJyYXkgKHNlZSBiZWxvdykgdGhhdCByZXByZXNlbnRzCiAgICAgICAgLy8gdGhlIGN1cnJlbnQgY29vbGRvd24gZHVyYXRpb24gZm9yIHRoaXMgTW9uc3Rlci4gVGhpcyBzdGFydHMgYXQgemVybwogICAgICAgIC8vIGZvciBnZW4wIG1vbnN0ZXJzLCBhbmQgaXMgaW5pdGlhbGl6ZWQgdG8gZmxvb3IoZ2VuZXJhdGlvbi8yKSBmb3Igb3RoZXJzLgogICAgICAgIC8vIEluY3JlbWVudGVkIGJ5IG9uZSBmb3IgZWFjaCBzdWNjZXNzZnVsIGJyZWVkaW5nIGFjdGlvbiwgcmVnYXJkbGVzcwogICAgICAgIC8vIG9mIHdoZXRoZXIgdGhpcyBtb25zdGVyIGlzIGFjdGluZyBhcyBtYXRyb24gb3Igc2lyZS4KICAgICAgICB1aW50MTYgY29vbGRvd25JbmRleDsKCiAgICAgICAgLy8gVGhlICJnZW5lcmF0aW9uIG51bWJlciIgb2YgdGhpcyBtb25zdGVyLiBNb25zdGVycyBtaW50ZWQgYnkgdGhlIENLIGNvbnRyYWN0CiAgICAgICAgLy8gZm9yIHNhbGUgYXJlIGNhbGxlZCAiZ2VuMCIgYW5kIGhhdmUgYSBnZW5lcmF0aW9uIG51bWJlciBvZiAwLiBUaGUKICAgICAgICAvLyBnZW5lcmF0aW9uIG51bWJlciBvZiBhbGwgb3RoZXIgbW9uc3RlcnMgaXMgdGhlIGxhcmdlciBvZiB0aGUgdHdvIGdlbmVyYXRpb24KICAgICAgICAvLyBudW1iZXJzIG9mIHRoZWlyIHBhcmVudHMsIHBsdXMgb25lLgogICAgICAgIC8vIChpLmUuIG1heChtYXRyb24uZ2VuZXJhdGlvbiwgc2lyZS5nZW5lcmF0aW9uKSArIDEpCiAgICAgICAgdWludDE2IGdlbmVyYXRpb247CiAgICB9CgogICAgLyoqKiBDT05TVEFOVFMgKioqLwoKICAgIC8vLyBAZGV2IEEgbG9va3VwIHRhYmxlIGluZGltb25zdGVyaW5nIHRoZSBjb29sZG93biBkdXJhdGlvbiBhZnRlciBhbnkgc3VjY2Vzc2Z1bAogICAgLy8vICBicmVlZGluZyBhY3Rpb24sIGNhbGxlZCAicHJlZ25hbmN5IHRpbWUiIGZvciBtYXRyb25zIGFuZCAic2lyaW5nIGNvb2xkb3duIgogICAgLy8vICBmb3Igc2lyZXMuIERlc2lnbmVkIHN1Y2ggdGhhdCB0aGUgY29vbGRvd24gcm91Z2hseSBkb3VibGVzIGVhY2ggdGltZSBhIG1vbnN0ZXIKICAgIC8vLyAgaXMgYnJlZCwgZW5jb3VyYWdpbmcgb3duZXJzIG5vdCB0byBqdXN0IGtlZXAgYnJlZWRpbmcgdGhlIHNhbWUgbW9uc3RlciBvdmVyCiAgICAvLy8gIGFuZCBvdmVyIGFnYWluLiBDYXBzIG91dCBhdCBvbmUgd2VlayAoYSBtb25zdGVyIGNhbiBicmVlZCBhbiB1bmJvdW5kZWQgbnVtYmVyCiAgICAvLy8gIG9mIHRpbWVzLCBhbmQgdGhlIG1heGltdW0gY29vbGRvd24gaXMgYWx3YXlzIHNldmVuIGRheXMpLgogICAgdWludDMyWzE0XSBwdWJsaWMgY29vbGRvd25zID0gWwogICAgdWludDMyKDEgbWludXRlcyksCiAgICB1aW50MzIoMiBtaW51dGVzKSwKICAgIHVpbnQzMig1IG1pbnV0ZXMpLAogICAgdWludDMyKDEwIG1pbnV0ZXMpLAogICAgdWludDMyKDMwIG1pbnV0ZXMpLAogICAgdWludDMyKDEgaG91cnMpLAogICAgdWludDMyKDIgaG91cnMpLAogICAgdWludDMyKDQgaG91cnMpLAogICAgdWludDMyKDggaG91cnMpLAogICAgdWludDMyKDE2IGhvdXJzKSwKICAgIHVpbnQzMigxIGRheXMpLAogICAgdWludDMyKDIgZGF5cyksCiAgICB1aW50MzIoNCBkYXlzKSwKICAgIHVpbnQzMig3IGRheXMpCiAgICBdOwoKICAgIC8vIEFuIGFwcHJveGltYXRpb24gb2YgY3VycmVudGx5IGhvdyBtYW55IHNlY29uZHMgYXJlIGluIGJldHdlZW4gYmxvY2tzLgogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kc1BlckJsb2NrID0gMTU7CgogICAgLyoqKiBTVE9SQUdFICoqKi8KCiAgICAvLy8gQGRldiBBbiBhcnJheSBjb250YWluaW5nIHRoZSBNb25zdGVyIHN0cnVjdCBmb3IgYWxsIE1vbnN0ZXJzIGluIGV4aXN0ZW5jZS4gVGhlIElECiAgICAvLy8gIG9mIGVhY2ggbW9uc3RlciBpcyBhY3R1YWxseSBhbiBpbmRleCBpbnRvIHRoaXMgYXJyYXkuIE5vdGUgdGhhdCBJRCAwIGlzIGEgbmVnYW1vbnN0ZXIsCiAgICAvLy8gIHRoZSB1bk1vbnN0ZXIsIHRoZSBteXRoaWNhbCBiZWFzdCB0aGF0IGlzIHRoZSBwYXJlbnQgb2YgYWxsIGdlbjAgbW9uc3RlcnMuIEEgYml6YXJyZQogICAgLy8vICBjcmVhdHVyZSB0aGF0IGlzIGJvdGggbWF0cm9uIGFuZCBzaXJlLi4uIHRvIGl0c2VsZiEgSGFzIGFuIGludmFsaWQgZ2VuZXRpYyBjb2RlLgogICAgLy8vICBJbiBvdGhlciB3b3JkcywgbW9uc3RlciBJRCAwIGlzIGludmFsaWQuLi4gOy0pCiAgICBNb25zdGVyW10gbW9uc3RlcnM7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gbW9uc3RlciBJRHMgdG8gdGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZW0uIEFsbCBtb25zdGVycyBoYXZlCiAgICAvLy8gIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcywgZXZlbiBnZW4wIG1vbnN0ZXJzIGFyZSBjcmVhdGVkIHdpdGggYSBub24temVybyBvd25lci4KICAgIG1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgbW9uc3RlckluZGV4VG9Pd25lcjsKCiAgICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG93bmVyIGFkZHJlc3MgdG8gY291bnQgb2YgdG9rZW5zIHRoYXQgYWRkcmVzcyBvd25zLgogICAgLy8gIFVzZWQgaW50ZXJuYWxseSBpbnNpZGUgYmFsYW5jZU9mKCkgdG8gcmVzb2x2ZSBvd25lcnNoaXAgY291bnQuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1Nikgb3duZXJzaGlwVG9rZW5Db3VudDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBNb25zdGVySURzIHRvIGFuIGFkZHJlc3MgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCB0byBjYWxsCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBFYWNoIE1vbnN0ZXIgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdHJhbnNmZXIKICAgIC8vLyAgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICAgIG1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgbW9uc3RlckluZGV4VG9BcHByb3ZlZDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBNb25zdGVySURzIHRvIGFuIGFkZHJlc3MgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCB0byB1c2UKICAgIC8vLyAgdGhpcyBNb25zdGVyIGZvciBzaXJpbmcgdmlhIGJyZWVkV2l0aCgpLiBFYWNoIE1vbnN0ZXIgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQKICAgIC8vLyAgYWRkcmVzcyBmb3Igc2lyaW5nIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHNpcmVBbGxvd2VkVG9BZGRyZXNzOwoKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBDbG9ja0F1Y3Rpb24gY29udHJhY3QgdGhhdCBoYW5kbGVzIHNhbGVzIG9mIE1vbnN0ZXJzLiBUaGlzCiAgICAvLy8gIHNhbWUgY29udHJhY3QgaGFuZGxlcyBib3RoIHBlZXItdG8tcGVlciBzYWxlcyBhcyB3ZWxsIGFzIHRoZSBnZW4wIHNhbGVzIHdoaWNoIGFyZQogICAgLy8vICBpbml0aWF0ZWQgZXZlcnkgMTUgbWludXRlcy4KICAgIFNhbGVDbG9ja0F1Y3Rpb24gcHVibGljIHNhbGVBdWN0aW9uOwoKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzIG9mIGEgY3VzdG9tIENsb2NrQXVjdGlvbiBzdWJjbGFzc2VkIGNvbnRyYWN0IHRoYXQgaGFuZGxlcyBzaXJpbmcKICAgIC8vLyAgYXVjdGlvbnMuIE5lZWRzIHRvIGJlIHNlcGFyYXRlIGZyb20gc2FsZUF1Y3Rpb24gYmVjYXVzZSB0aGUgYWN0aW9ucyB0YWtlbiBvbiBzdWNjZXNzCiAgICAvLy8gIGFmdGVyIGEgc2FsZXMgYW5kIHNpcmluZyBhdWN0aW9uIGFyZSBxdWl0ZSBkaWZmZXJlbnQuCiAgICBTaXJpbmdDbG9ja0F1Y3Rpb24gcHVibGljIHNpcmluZ0F1Y3Rpb247CgogICAgR2VuZVNjaWVuY2UgcHVibGljIGdlbmVTY2llbmNlOwoKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgTW9uc3RlciB0byBhbiBhZGRyZXNzLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gU2luY2UgdGhlIG51bWJlciBvZiBtb25zdGVycyBpcyBjYXBwZWQgdG8gMl4zMiB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAgICAgLy8gdHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgbW9uc3RlckluZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IG1vbnN0ZXJzIF9mcm9tIGlzIDB4MCwgYnV0IHdlIGNhbid0IGFjY291bnQgdGhhdCBhZGRyZXNzLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CiAgICAgICAgICAgIC8vIG9uY2UgdGhlIG1vbnN0ZXIgaXMgdHJhbnNmZXJyZWQgYWxzbyBjbGVhciBzaXJlIGFsbG93YW5jZXMKICAgICAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW190b2tlbklkXTsKICAgICAgICAgICAgLy8gY2xlYXIgYW55IHByZXZpb3VzbHkgYXBwcm92ZWQgb3duZXJzaGlwIGV4Y2hhbmdlCiAgICAgICAgICAgIGRlbGV0ZSBtb25zdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXTsKICAgICAgICB9CiAgICAgICAgLy8gRW1pdCB0aGUgdHJhbnNmZXIgZXZlbnQuCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFuIGludGVybmFsIG1ldGhvZCB0aGF0IGNyZWF0ZXMgYSBuZXcgbW9uc3RlciBhbmQgc3RvcmVzIGl0LiBUaGlzCiAgICAvLy8gIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuIFdpbGwgZ2VuZXJhdGUgYm90aCBhIEJpcnRoIGV2ZW50CiAgICAvLy8gIGFuZCBhIFRyYW5zZmVyIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgVGhlIG1vbnN0ZXIgSUQgb2YgdGhlIG1hdHJvbiBvZiB0aGlzIG1vbnN0ZXIgKHplcm8gZm9yIGdlbjApCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIG1vbnN0ZXIgSUQgb2YgdGhlIHNpcmUgb2YgdGhpcyBtb25zdGVyICh6ZXJvIGZvciBnZW4wKQogICAgLy8vIEBwYXJhbSBfZ2VuZXJhdGlvbiBUaGUgZ2VuZXJhdGlvbiBudW1iZXIgb2YgdGhpcyBtb25zdGVyLCBtdXN0IGJlIGNvbXB1dGVkIGJ5IGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX2dlbmVzIFRoZSBtb25zdGVyJ3MgZ2VuZXRpYyBjb2RlLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGluaXRhbCBvd25lciBvZiB0aGlzIG1vbnN0ZXIsIG11c3QgYmUgbm9uLXplcm8gKGV4Y2VwdCBmb3IgdGhlIHVuTW9uc3RlciwgSUQgMCkKICAgIGZ1bmN0aW9uIF9jcmVhdGVNb25zdGVyKAogICAgICAgIHVpbnQyNTYgX21hdHJvbklkLAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9nZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgX2dlbmVzLAogICAgICAgIGFkZHJlc3MgX293bmVyCiAgICApCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICAvLyBUaGVzZSByZXF1aXJlcyBhcmUgbm90IHN0cmljdGx5IG5lY2Vzc2FyeSwgb3VyIGNhbGxpbmcgY29kZSBzaG91bGQgbWFrZQogICAgICAgIC8vIHN1cmUgdGhhdCB0aGVzZSBjb25kaXRpb25zIGFyZSBuZXZlciBicm9rZW4uIEhvd2V2ZXIhIF9jcmVhdGVNb25zdGVyKCkgaXMgYWxyZWFkeQogICAgICAgIC8vIGFuIGV4cGVuc2l2ZSBjYWxsIChmb3Igc3RvcmFnZSksIGFuZCBpdCBkb2Vzbid0IGh1cnQgdG8gYmUgZXNwZWNpYWxseSBjYXJlZnVsCiAgICAgICAgLy8gdG8gZW5zdXJlIG91ciBkYXRhIHN0cnVjdHVyZXMgYXJlIGFsd2F5cyB2YWxpZC4KICAgICAgICByZXF1aXJlKF9tYXRyb25JZCA9PSB1aW50MjU2KHVpbnQzMihfbWF0cm9uSWQpKSk7CiAgICAgICAgcmVxdWlyZShfc2lyZUlkID09IHVpbnQyNTYodWludDMyKF9zaXJlSWQpKSk7CiAgICAgICAgcmVxdWlyZShfZ2VuZXJhdGlvbiA9PSB1aW50MjU2KHVpbnQxNihfZ2VuZXJhdGlvbikpKTsKCiAgICAgICAgLy8gTmV3IG1vbnN0ZXIgc3RhcnRzIHdpdGggdGhlIHNhbWUgY29vbGRvd24gYXMgcGFyZW50IGdlbi8yCiAgICAgICAgdWludDE2IGNvb2xkb3duSW5kZXggPSB1aW50MTYoX2dlbmVyYXRpb24gLyAyKTsKICAgICAgICBpZiAoY29vbGRvd25JbmRleCA+IDEzKSB7CiAgICAgICAgICAgIGNvb2xkb3duSW5kZXggPSAxMzsKICAgICAgICB9CgogICAgICAgIE1vbnN0ZXIgbWVtb3J5IF9tb25zdGVyID0gTW9uc3Rlcih7CiAgICAgICAgICAgIGdlbmVzIDogX2dlbmVzLAogICAgICAgICAgICBiaXJ0aFRpbWUgOiB1aW50NjQobm93KSwKICAgICAgICAgICAgY29vbGRvd25FbmRCbG9jayA6IDAsCiAgICAgICAgICAgIG1hdHJvbklkIDogdWludDMyKF9tYXRyb25JZCksCiAgICAgICAgICAgIHNpcmVJZCA6IHVpbnQzMihfc2lyZUlkKSwKICAgICAgICAgICAgc2lyaW5nV2l0aElkIDogMCwKICAgICAgICAgICAgY29vbGRvd25JbmRleCA6IGNvb2xkb3duSW5kZXgsCiAgICAgICAgICAgIGdlbmVyYXRpb24gOiB1aW50MTYoX2dlbmVyYXRpb24pCiAgICAgICAgICAgIH0pOwogICAgICAgIHVpbnQyNTYgbmV3S2l0dGVuSWQgPSBtb25zdGVycy5wdXNoKF9tb25zdGVyKSAtIDE7CgogICAgICAgIC8vIEl0J3MgcHJvYmFibHkgbmV2ZXIgZ29pbmcgdG8gaGFwcGVuLCA0IGJpbGxpb24gbW9uc3RlcnMgaXMgQSBMT1QsIGJ1dAogICAgICAgIC8vIGxldCdzIGp1c3QgYmUgMTAwJSBzdXJlIHdlIG5ldmVyIGxldCB0aGlzIGhhcHBlbi4KICAgICAgICByZXF1aXJlKG5ld0tpdHRlbklkID09IHVpbnQyNTYodWludDMyKG5ld0tpdHRlbklkKSkpOwoKICAgICAgICAvLyBlbWl0IHRoZSBiaXJ0aCBldmVudAogICAgICAgIEJpcnRoKAogICAgICAgICAgICBfb3duZXIsCiAgICAgICAgICAgIG5ld0tpdHRlbklkLAogICAgICAgICAgICB1aW50MjU2KF9tb25zdGVyLm1hdHJvbklkKSwKICAgICAgICAgICAgdWludDI1NihfbW9uc3Rlci5zaXJlSWQpLAogICAgICAgICAgICBfbW9uc3Rlci5nZW5lcywKICAgICAgICAgICAgdWludDE2KF9nZW5lcmF0aW9uKQogICAgICAgICk7CgogICAgICAgIC8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwLCBhbmQgYWxzbyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudCBhcwogICAgICAgIC8vIHBlciBFUkM3MjEgZHJhZnQKICAgICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdLaXR0ZW5JZCk7CgogICAgICAgIHJldHVybiBuZXdLaXR0ZW5JZDsKICAgIH0KCiAgICAvLyBBbnkgQy1sZXZlbCBjYW4gZml4IGhvdyBtYW55IHNlY29uZHMgcGVyIGJsb2NrcyBhcmUgY3VycmVudGx5IG9ic2VydmVkLgogICAgZnVuY3Rpb24gc2V0U2Vjb25kc1BlckJsb2NrKHVpbnQyNTYgc2VjcykgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgcmVxdWlyZShzZWNzIDwgY29vbGRvd25zWzBdKTsKICAgICAgICBzZWNvbmRzUGVyQmxvY2sgPSBzZWNzOwogICAgfQp9CgoKCgoKLy8vIEB0aXRsZSBUaGUgZXh0ZXJuYWwgY29udHJhY3QgdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgZ2VuZXJhdGluZyBtZXRhZGF0YSBmb3IgdGhlIG1vbnN0ZXJzLAovLy8gIGl0IGhhcyBvbmUgZnVuY3Rpb24gdGhhdCB3aWxsIHJldHVybiB0aGUgZGF0YSBhcyBieXRlcy4KY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewogICAgLy8vIEBkZXYgR2l2ZW4gYSB0b2tlbiBJZCwgcmV0dXJucyBhIGJ5dGUgYXJyYXkgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBjb252ZXJ0ZWQgaW50byBzdHJpbmcuCiAgICBmdW5jdGlvbiBnZXRNZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzJbNF0gYnVmZmVyLCB1aW50MjU2IGNvdW50KSB7CiAgICAgICAgaWYgKF90b2tlbklkID09IDEpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkhlbGxvIFdvcmxkISA6RCI7CiAgICAgICAgICAgIGNvdW50ID0gMTU7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJJIHdvdWxkIGRlZmluaXRlbHkgY2hvb3NlIGEgbWVkaSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJ1bSBsZW5ndGggc3RyaW5nLiI7CiAgICAgICAgICAgIGNvdW50ID0gNDk7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAzKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgbWkgZSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJzdCBhY2N1bXNhbiBkYXBpYnVzIGF1Z3VlIGxvcmVtLCI7CiAgICAgICAgICAgIGJ1ZmZlclsyXSA9ICIgdHJpc3RpcXVlIHZlc3RpYnVsdW0gaWQsIGxpYmVybyI7CiAgICAgICAgICAgIGJ1ZmZlclszXSA9ICIgc3VzY2lwaXQgdmFyaXVzIHNhcGllbiBhbGlxdWFtLiI7CiAgICAgICAgICAgIGNvdW50ID0gMTI4OwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAdGl0bGUgVGhlIGZhY2V0IG9mIHRoZSBDcnlwdG9Nb25zdGVycyBjb3JlIGNvbnRyYWN0IHRoYXQgbWFuYWdlcyBvd25lcnNoaXAsIEVSQy03MjEgKGRyYWZ0KSBjb21wbGlhbnQuCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQovLy8gIFNlZSB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBNb25zdGVyT3duZXJzaGlwIGlzIE1vbnN0ZXJCYXNlLCBFUkM3MjEgewoKICAgIC8vLyBAbm90aWNlIE5hbWUgYW5kIHN5bWJvbCBvZiB0aGUgbm9uIGZ1bmdpYmxlIHRva2VuLCBhcyBkZWZpbmVkIGluIEVSQzcyMS4KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJFdGhlcm1vbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJFTSI7CgogICAgLy8gVGhlIGNvbnRyYWN0IHRoYXQgd2lsbCByZXR1cm4gbW9uc3RlciBtZXRhZGF0YQogICAgRVJDNzIxTWV0YWRhdGEgcHVibGljIGVyYzcyMU1ldGFkYXRhOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPQogICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RvdGFsU3VwcGx5KCknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAgIC8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KICAgIC8vLyAgUmV0dXJucyB0cnVlIGZvciBhbnkgc3RhbmRhcmRpemVkIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgdGhpcyBjb250cmFjdC4gV2UgaW1wbGVtZW50CiAgICAvLy8gIEVSQy0xNjUgKG9idmlvdXNseSEpIGFuZCBFUkMtNzIxLgogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIERFQlVHIE9OTFkKICAgICAgICAvL3JlcXVpcmUoKEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPT0gMHgwMWZmYzlhNykgJiYgKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPT0gMHg5YTIwNDgzZCkpOwoKICAgICAgICByZXR1cm4gKChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSkgfHwgKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0IHRoZSBhZGRyZXNzIG9mIHRoZSBzaWJsaW5nIGNvbnRyYWN0IHRoYXQgdHJhY2tzIG1ldGFkYXRhLgogICAgLy8vICBDRU8gb25seS4KICAgIGZ1bmN0aW9uIHNldE1ldGFkYXRhQWRkcmVzcyhhZGRyZXNzIF9jb250cmFjdEFkZHJlc3MpIHB1YmxpYyBvbmx5Q0VPIHsKICAgICAgICBlcmM3MjFNZXRhZGF0YSA9IEVSQzcyMU1ldGFkYXRhKF9jb250cmFjdEFkZHJlc3MpOwogICAgfQoKICAgIC8vIEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb25zOiBUaGVzZSBmdW5jdGlvbnMgYWxsIGFzc3VtZSB0aGF0IHRoZWlyIGlucHV0IGFyZ3VtZW50cwogICAgLy8gYXJlIHZhbGlkLiBXZSBsZWF2ZSBpdCB0byBwdWJsaWMgbWV0aG9kcyB0byBzYW5pdGl6ZSB0aGVpciBpbnB1dHMgYW5kIGZvbGxvdwogICAgLy8gdGhlIHJlcXVpcmVkIGxvZ2ljLgoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaXMgdGhlIGN1cnJlbnQgb3duZXIgb2YgYSBwYXJ0aWN1bGFyIE1vbnN0ZXIuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgdmFsaWRhdGluZyBhZ2FpbnN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBtb25zdGVyIGlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIE1vbnN0ZXIuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgY29uZmlybWluZyBtb25zdGVyIGlzIGFwcHJvdmVkIGZvci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgbW9uc3RlciBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmtzIGFuIGFkZHJlc3MgYXMgYmVpbmcgYXBwcm92ZWQgZm9yIHRyYW5zZmVyRnJvbSgpLCBvdmVyd3JpdGluZyBhbnkgcHJldmlvdXMKICAgIC8vLyAgYXBwcm92YWwuIFNldHRpbmcgX2FwcHJvdmVkIHRvIGFkZHJlc3MoMCkgY2xlYXJzIGFsbCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgIC8vLyAgTk9URTogX2FwcHJvdmUoKSBkb2VzIE5PVCBzZW5kIHRoZSBBcHByb3ZhbCBldmVudC4gVGhpcyBpcyBpbnRlbnRpb25hbCBiZWNhdXNlCiAgICAvLy8gIF9hcHByb3ZlKCkgYW5kIHRyYW5zZmVyRnJvbSgpIGFyZSB1c2VkIHRvZ2V0aGVyIGZvciBwdXR0aW5nIE1vbnN0ZXJzIG9uIGF1Y3Rpb24sIGFuZAogICAgLy8vICB0aGVyZSBpcyBubyB2YWx1ZSBpbiBzcGFtbWluZyB0aGUgbG9nIHdpdGggQXBwcm92YWwgZXZlbnRzIGluIHRoYXQgY2FzZS4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgbnVtYmVyIG9mIE1vbnN0ZXJzIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgYSBNb25zdGVyIHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvIGEgc21hcnQKICAgIC8vLyAgY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEgKG9yCiAgICAvLy8gIENyeXB0b01vbnN0ZXJzIHNwZWNpZmljYWxseSkgb3IgeW91ciBNb25zdGVyIG1heSBiZSBsb3N0IGZvcmV2ZXIuIFNlcmlvdXNseS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgTW9uc3RlciB0byB0cmFuc2Zlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBtb25zdGVycyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgZ2VuMCBtb25zdGVyIGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGUgYXVjdGlvbiBjb250cmFjdHMgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBtb25zdGVycwogICAgICAgIC8vIHRocm91Z2ggdGhlIGFsbG93ICsgdHJhbnNmZXJGcm9tIGZsb3cuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhzYWxlQXVjdGlvbikpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3Moc2lyaW5nQXVjdGlvbikpOwoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biBtb25zdGVyLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgYSBzcGVjaWZpYyBNb25zdGVyIHZpYQogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gVGhpcyBpcyB0aGUgcHJlZmVycmVkIGZsb3cgZm9yIHRyYW5zZmVyaW5nIE5GVHMgdG8gY29udHJhY3RzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAvLy8gIGNsZWFyIGFsbCBhcHByb3ZhbHMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgTW9uc3RlciB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gYXBwcm92ZSgKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIE9ubHkgYW4gb3duZXIgY2FuIGdyYW50IHRyYW5zZmVyIGFwcHJvdmFsLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIChyZXBsYWNpbmcgYW55IHByZXZpb3VzIGFwcHJvdmFsKS4KICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBhcHByb3ZhbCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIE1vbnN0ZXIgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcgYWRkcmVzcwogICAgLy8vICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIE1vbnN0ZXIgdG8gYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBNb25zdGVyLiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgbW9uc3RlcnMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgbW9uc3RlciBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIE1vbnN0ZXJzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJzLmxlbmd0aCAtIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYWRkcmVzcyBjdXJyZW50bHkgYXNzaWduZWQgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gTW9uc3Rlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgIHsKICAgICAgICBvd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdOwoKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBsaXN0IG9mIGFsbCBNb25zdGVyIElEcyBhc3NpZ25lZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIE1vbnN0ZXJzIHdlIGFyZSBpbnRlcmVzdGVkIGluLgogICAgLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gRmlyc3QsIGl0J3MgZmFpcmx5CiAgICAvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBNb25zdGVyIGFycmF5IGxvb2tpbmcgZm9yIG1vbnN0ZXJzIGJlbG9uZ2luZyB0byBvd25lciksCiAgICAvLy8gIGJ1dCBpdCBhbHNvIHJldHVybnMgYSBkeW5hbWljIGFycmF5LCB3aGljaCBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscywgYW5kCiAgICAvLy8gIG5vdCBjb250cmFjdC10by1jb250cmFjdCBjYWxscy4KICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIG93bmVyVG9rZW5zKSB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbE1vbnN0ZXJzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICAvLyBXZSBjb3VudCBvbiB0aGUgZmFjdCB0aGF0IGFsbCBtb25zdGVycyBoYXZlIElEcyBzdGFydGluZyBhdCAxIGFuZCBpbmNyZWFzaW5nCiAgICAgICAgICAgIC8vIHNlcXVlbnRpYWxseSB1cCB0byB0aGUgdG90YWxNb25zdGVyIGNvdW50LgogICAgICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZDsKCiAgICAgICAgICAgIGZvciAobW9uc3RlcklkID0gMTsgbW9uc3RlcklkIDw9IHRvdGFsTW9uc3RlcnM7IG1vbnN0ZXJJZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAobW9uc3RlckluZGV4VG9Pd25lclttb25zdGVySWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBtb25zdGVySWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIG1lbWNweSgpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZmY5ZThkOWU5Yzk3OTE5NjliYmY5MTkwOGI5YjkwOGJkMTkxOWE4YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+KQogICAgLy8vICBUaGlzIG1ldGhvZCBpcyBsaWNlbmNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzL2Jsb2IvMmY2Y2E5YWNjYjQ4YWUxNGM2NmYxNDM3ZWM1MGVkMTlhMDYxNmY3OC9zdHJpbmdzLnNvbAogICAgZnVuY3Rpb24gX21lbWNweSh1aW50IF9kZXN0LCB1aW50IF9zcmMsIHVpbnQgX2xlbikgcHJpdmF0ZSB2aWV3IHsKICAgICAgICAvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQogICAgICAgIGZvciAoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgbWxvYWQoX3NyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Rlc3QgKz0gMzI7CiAgICAgICAgICAgIF9zcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQyNTYgbWFzayA9IDI1NiAqKiAoMzIgLSBfbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoX3NyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChfZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gdG9TdHJpbmcoc2xpY2UpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZWY4ZTlkOGU4Yzg3ODE4NjhiYWY4MTgwOWI4YjgwOWJjMTgxOGE5YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+KQogICAgLy8vICBUaGlzIG1ldGhvZCBpcyBsaWNlbmNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzL2Jsb2IvMmY2Y2E5YWNjYjQ4YWUxNGM2NmYxNDM3ZWM1MGVkMTlhMDYxNmY3OC9zdHJpbmdzLnNvbAogICAgZnVuY3Rpb24gX3RvU3RyaW5nKGJ5dGVzMzJbNF0gX3Jhd0J5dGVzLCB1aW50MjU2IF9zdHJpbmdMZW5ndGgpIHByaXZhdGUgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgb3V0cHV0U3RyaW5nID0gbmV3IHN0cmluZyhfc3RyaW5nTGVuZ3RoKTsKICAgICAgICB1aW50MjU2IG91dHB1dFB0cjsKICAgICAgICB1aW50MjU2IGJ5dGVzUHRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG91dHB1dFB0ciA6PSBhZGQob3V0cHV0U3RyaW5nLCAzMikKICAgICAgICAgICAgYnl0ZXNQdHIgOj0gX3Jhd0J5dGVzCiAgICAgICAgfQoKICAgICAgICBfbWVtY3B5KG91dHB1dFB0ciwgYnl0ZXNQdHIsIF9zdHJpbmdMZW5ndGgpOwoKICAgICAgICByZXR1cm4gb3V0cHV0U3RyaW5nOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBVUkkgcG9pbnRpbmcgdG8gYSBtZXRhZGF0YSBwYWNrYWdlIGZvciB0aGlzIHRva2VuIGNvbmZvcm1pbmcgdG8KICAgIC8vLyAgRVJDLTcyMSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG51bWJlciBvZiB0aGUgTW9uc3RlciB3aG9zZSBtZXRhZGF0YSBzaG91bGQgYmUgcmV0dXJuZWQuCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICAgICAgcmVxdWlyZShlcmM3MjFNZXRhZGF0YSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CiAgICAgICAgdWludDI1NiBjb3VudDsKICAgICAgICAoYnVmZmVyLCBjb3VudCkgPSBlcmM3MjFNZXRhZGF0YS5nZXRNZXRhZGF0YShfdG9rZW5JZCwgX3ByZWZlcnJlZFRyYW5zcG9ydCk7CgogICAgICAgIHJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIE1vbnN0ZXJDb3JlIHRoYXQgbWFuYWdlcyBNb25zdGVyIHNpcmluZywgZ2VzdGF0aW9uLCBhbmQgYmlydGguCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFNlZSB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBNb25zdGVyQnJlZWRpbmcgaXMgTW9uc3Rlck93bmVyc2hpcCB7CgogICAgLy8vIEBkZXYgVGhlIFByZWduYW50IGV2ZW50IGlzIGZpcmVkIHdoZW4gdHdvIG1vbnN0ZXJzIHN1Y2Nlc3NmdWxseSBicmVlZCBhbmQgdGhlIHByZWduYW5jeQogICAgLy8vICB0aW1lciBiZWdpbnMgZm9yIHRoZSBtYXRyb24uCiAgICBldmVudCBQcmVnbmFudChhZGRyZXNzIG93bmVyLCB1aW50MjU2IG1hdHJvbklkLCB1aW50MjU2IHNpcmVJZCwgdWludDI1NiBjb29sZG93bkVuZEJsb2NrKTsKCiAgICAvLy8gQG5vdGljZSBUaGUgbWluaW11bSBwYXltZW50IHJlcXVpcmVkIHRvIHVzZSBicmVlZFdpdGhBdXRvKCkuIFRoaXMgZmVlIGdvZXMgdG93YXJkcwogICAgLy8vICB0aGUgZ2FzIGNvc3QgcGFpZCBieSB3aGF0ZXZlciBjYWxscyBnaXZlQmlydGgoKSwgYW5kIGNhbiBiZSBkeW5hbWljYWxseSB1cGRhdGVkIGJ5CiAgICAvLy8gIHRoZSBDT08gcm9sZSBhcyB0aGUgZ2FzIHByaWNlIGNoYW5nZXMuCiAgICB1aW50MjU2IHB1YmxpYyBhdXRvQmlydGhGZWUgPSA4IGZpbm5leTsKCiAgICAvLyBLZWVwcyB0cmFjayBvZiBudW1iZXIgb2YgcHJlZ25hbnQgbW9uc3RlcnMuCiAgICB1aW50MjU2IHB1YmxpYyBwcmVnbmFudE1vbnN0ZXJzOwoKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBzaWJsaW5nIGNvbnRyYWN0IHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgdGhlIHNvb3Blci1zZWtyZXQKICAgIC8vLyAgZ2VuZXRpYyBjb21iaW5hdGlvbiBhbGdvcml0aG0uCgogICAgLy8vIEBkZXYgVXBkYXRlIHRoZSBhZGRyZXNzIG9mIHRoZSBnZW5ldGljIGNvbnRyYWN0LCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTy4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgQW4gYWRkcmVzcyBvZiBhIEdlbmVTY2llbmNlIGNvbnRyYWN0IGluc3RhbmNlIHRvIGJlIHVzZWQgZnJvbSB0aGlzIHBvaW50IGZvcndhcmQuCiAgICBmdW5jdGlvbiBzZXRHZW5lU2NpZW5jZUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgR2VuZVNjaWVuY2UgY2FuZGlkYXRlQ29udHJhY3QgPSBHZW5lU2NpZW5jZShfYWRkcmVzcyk7CgogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNHZW5lU2NpZW5jZSgpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIGdlbmVTY2llbmNlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIHRoYXQgYSBnaXZlbiBtb25zdGVyIGlzIGFibGUgdG8gYnJlZWQuIFJlcXVpcmVzIHRoYXQgdGhlCiAgICAvLy8gIGN1cnJlbnQgY29vbGRvd24gaXMgZmluaXNoZWQgKGZvciBzaXJlcykgYW5kIGFsc28gY2hlY2tzIHRoYXQgdGhlcmUgaXMKICAgIC8vLyAgbm8gcGVuZGluZyBwcmVnbmFuY3kuCiAgICBmdW5jdGlvbiBfaXNSZWFkeVRvQnJlZWQoTW9uc3RlciBfbW9uc3RlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gSW4gYWRkaXRpb24gdG8gY2hlY2tpbmcgdGhlIGNvb2xkb3duRW5kQmxvY2ssIHdlIGFsc28gbmVlZCB0byBjaGVjayB0byBzZWUgaWYKICAgICAgICAvLyB0aGUgbW9uc3RlciBoYXMgYSBwZW5kaW5nIGJpcnRoOyB0aGVyZSBjYW4gYmUgc29tZSBwZXJpb2Qgb2YgdGltZSBiZXR3ZWVuIHRoZSBlbmQKICAgICAgICAvLyBvZiB0aGUgcHJlZ25hY3kgdGltZXIgYW5kIHRoZSBiaXJ0aCBldmVudC4KICAgICAgICByZXR1cm4gKF9tb25zdGVyLnNpcmluZ1dpdGhJZCA9PSAwKSAmJiAoX21vbnN0ZXIuY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2sgaWYgYSBzaXJlIGhhcyBhdXRob3JpemVkIGJyZWVkaW5nIHdpdGggdGhpcyBtYXRyb24uIFRydWUgaWYgYm90aCBzaXJlCiAgICAvLy8gIGFuZCBtYXRyb24gaGF2ZSB0aGUgc2FtZSBvd25lciwgb3IgaWYgdGhlIHNpcmUgaGFzIGdpdmVuIHNpcmluZyBwZXJtaXNzaW9uIHRvCiAgICAvLy8gIHRoZSBtYXRyb24ncyBvd25lciAodmlhIGFwcHJvdmVTaXJpbmcoKSkuCiAgICBmdW5jdGlvbiBfaXNTaXJpbmdQZXJtaXR0ZWQodWludDI1NiBfc2lyZUlkLCB1aW50MjU2IF9tYXRyb25JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWRkcmVzcyBtYXRyb25Pd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICBhZGRyZXNzIHNpcmVPd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX3NpcmVJZF07CgogICAgICAgIC8vIFNpcmluZyBpcyBva2F5IGlmIHRoZXkgaGF2ZSBzYW1lIG93bmVyLCBvciBpZiB0aGUgbWF0cm9uJ3Mgb3duZXIgd2FzIGdpdmVuCiAgICAgICAgLy8gcGVybWlzc2lvbiB0byBicmVlZCB3aXRoIHRoaXMgc2lyZS4KICAgICAgICByZXR1cm4gKG1hdHJvbk93bmVyID09IHNpcmVPd25lciB8fCBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfc2lyZUlkXSA9PSBtYXRyb25Pd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0IHRoZSBjb29sZG93bkVuZFRpbWUgZm9yIHRoZSBnaXZlbiBNb25zdGVyLCBiYXNlZCBvbiBpdHMgY3VycmVudCBjb29sZG93bkluZGV4LgogICAgLy8vICBBbHNvIGluY3JlbWVudHMgdGhlIGNvb2xkb3duSW5kZXggKHVubGVzcyBpdCBoYXMgaGl0IHRoZSBjYXApLgogICAgLy8vIEBwYXJhbSBfbW9uc3RlciBBIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlciBpbiBzdG9yYWdlIHdoaWNoIG5lZWRzIGl0cyB0aW1lciBzdGFydGVkLgogICAgZnVuY3Rpb24gX3RyaWdnZXJDb29sZG93bihNb25zdGVyIHN0b3JhZ2UgX21vbnN0ZXIpIGludGVybmFsIHsKICAgICAgICAvLyBDb21wdXRlIGFuIGVzdGltYXRpb24gb2YgdGhlIGNvb2xkb3duIHRpbWUgaW4gYmxvY2tzIChiYXNlZCBvbiBjdXJyZW50IGNvb2xkb3duSW5kZXgpLgogICAgICAgIF9tb25zdGVyLmNvb2xkb3duRW5kQmxvY2sgPSB1aW50NjQoKGNvb2xkb3duc1tfbW9uc3Rlci5jb29sZG93bkluZGV4XSAvIHNlY29uZHNQZXJCbG9jaykgKyBibG9jay5udW1iZXIpOwoKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGJyZWVkaW5nIGNvdW50LCBjbGFtcGluZyBpdCBhdCAxMywgd2hpY2ggaXMgdGhlIGxlbmd0aCBvZiB0aGUKICAgICAgICAvLyBjb29sZG93bnMgYXJyYXkuIFdlIGNvdWxkIGNoZWNrIHRoZSBhcnJheSBzaXplIGR5bmFtaWNhbGx5LCBidXQgaGFyZC1jb2RpbmcKICAgICAgICAvLyB0aGlzIGFzIGEgY29uc3RhbnQgc2F2ZXMgZ2FzLiBZYXksIFNvbGlkaXR5IQogICAgICAgIGlmIChfbW9uc3Rlci5jb29sZG93bkluZGV4IDwgMTMpIHsKICAgICAgICAgICAgX21vbnN0ZXIuY29vbGRvd25JbmRleCArPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBHcmFudHMgYXBwcm92YWwgdG8gYW5vdGhlciB1c2VyIHRvIHNpcmUgd2l0aCBvbmUgb2YgeW91ciBNb25zdGVycy4KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFibGUgdG8gc2lyZSB3aXRoIHlvdXIgTW9uc3Rlci4gU2V0IHRvCiAgICAvLy8gIGFkZHJlc3MoMCkgdG8gY2xlYXIgYWxsIHNpcmluZyBhcHByb3ZhbHMgZm9yIHRoaXMgTW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBBIE1vbnN0ZXIgdGhhdCB5b3Ugb3duIHRoYXQgX2FkZHIgd2lsbCBub3cgYmUgYWJsZSB0byBzaXJlIHdpdGguCiAgICAvLy8gS0VSTllTIOyZuOu2gOyXkOyEnCDslYTruaDqsIAg7Zi47Lac7ZWgIOyImCDsnojri6QuIChtZXRhIG1hc2vroZwpCiAgICBmdW5jdGlvbiBhcHByb3ZlU2lyaW5nKGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX3NpcmVJZCkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfc2lyZUlkKSk7CiAgICAgICAgc2lyZUFsbG93ZWRUb0FkZHJlc3NbX3NpcmVJZF0gPSBfYWRkcjsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBtaW5pbXVtIHBheW1lbnQgcmVxdWlyZWQgZm9yIGNhbGxpbmcgZ2l2ZUJpcnRoQXV0bygpLiBDYW4gb25seQogICAgLy8vICBiZSBjYWxsZWQgYnkgdGhlIENPTyBhZGRyZXNzLiAoVGhpcyBmZWUgaXMgdXNlZCB0byBvZmZzZXQgdGhlIGdhcyBjb3N0IGluY3VycmVkCiAgICAvLy8gIGJ5IHRoZSBhdXRvYmlydGggZGFlbW9uKS4KICAgIGZ1bmN0aW9uIHNldEF1dG9CaXJ0aEZlZSh1aW50MjU2IHZhbCkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYXV0b0JpcnRoRmVlID0gdmFsOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB0byBzZWUgaWYgYSBnaXZlbiBNb25zdGVyIGlzIHByZWduYW50IGFuZCAoaWYgc28pIGlmIHRoZSBnZXN0YXRpb24KICAgIC8vLyAgcGVyaW9kIGhhcyBwYXNzZWQuCiAgICBmdW5jdGlvbiBfaXNSZWFkeVRvR2l2ZUJpcnRoKE1vbnN0ZXIgX21hdHJvbikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9tYXRyb24uc2lyaW5nV2l0aElkICE9IDApICYmIChfbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgPD0gdWludDY0KGJsb2NrLm51bWJlcikpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB0aGF0IGEgZ2l2ZW4gbW9uc3RlciBpcyBhYmxlIHRvIGJyZWVkIChpLmUuIGl0IGlzIG5vdCBwcmVnbmFudCBvcgogICAgLy8vICBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duKS4KICAgIC8vLyBAcGFyYW0gX21vbnN0ZXJJZCByZWZlcmVuY2UgdGhlIGlkIG9mIHRoZSBtb25zdGVyLCBhbnkgdXNlciBjYW4gaW5xdWlyZSBhYm91dCBpdAogICAgZnVuY3Rpb24gaXNSZWFkeVRvQnJlZWQodWludDI1NiBfbW9uc3RlcklkKQogICAgcHVibGljCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX21vbnN0ZXJJZCA+IDApOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtb25zdGVyID0gbW9uc3RlcnNbX21vbnN0ZXJJZF07CiAgICAgICAgcmV0dXJuIF9pc1JlYWR5VG9CcmVlZChtb25zdGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3Mgd2hldGhlciBhIG1vbnN0ZXIgaXMgY3VycmVudGx5IHByZWduYW50LgogICAgLy8vIEBwYXJhbSBfbW9uc3RlcklkIHJlZmVyZW5jZSB0aGUgaWQgb2YgdGhlIG1vbnN0ZXIsIGFueSB1c2VyIGNhbiBpbnF1aXJlIGFib3V0IGl0CiAgICBmdW5jdGlvbiBpc1ByZWduYW50KHVpbnQyNTYgX21vbnN0ZXJJZCkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9tb25zdGVySWQgPiAwKTsKICAgICAgICAvLyBBIG1vbnN0ZXIgaXMgcHJlZ25hbnQgaWYgYW5kIG9ubHkgaWYgdGhpcyBmaWVsZCBpcyBzZXQKICAgICAgICByZXR1cm4gbW9uc3RlcnNbX21vbnN0ZXJJZF0uc2lyaW5nV2l0aElkICE9IDA7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgY2hlY2sgdG8gc2VlIGlmIGEgZ2l2ZW4gc2lyZSBhbmQgbWF0cm9uIGFyZSBhIHZhbGlkIG1hdGluZyBwYWlyLiBET0VTIE5PVAogICAgLy8vICBjaGVjayBvd25lcnNoaXAgcGVybWlzc2lvbnMgKHRoYXQgaXMgdXAgdG8gdGhlIGNhbGxlcikuCiAgICAvLy8gQHBhcmFtIF9tYXRyb24gQSByZWZlcmVuY2UgdG8gdGhlIE1vbnN0ZXIgc3RydWN0IG9mIHRoZSBwb3RlbnRpYWwgbWF0cm9uLgogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgVGhlIG1hdHJvbidzIElELgogICAgLy8vIEBwYXJhbSBfc2lyZSBBIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlciBzdHJ1Y3Qgb2YgdGhlIHBvdGVudGlhbCBzaXJlLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIFRoZSBzaXJlJ3MgSUQKICAgIGZ1bmN0aW9uIF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICBNb25zdGVyIHN0b3JhZ2UgX21hdHJvbiwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICBNb25zdGVyIHN0b3JhZ2UgX3NpcmUsCiAgICAgICAgdWludDI1NiBfc2lyZUlkCiAgICApCiAgICBwcml2YXRlCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIEEgTW9uc3RlciBjYW4ndCBicmVlZCB3aXRoIGl0c2VsZiEKICAgICAgICBpZiAoX21hdHJvbklkID09IF9zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gTW9uc3RlcnMgY2FuJ3QgYnJlZWQgd2l0aCB0aGVpciBwYXJlbnRzLgogICAgICAgIGlmIChfbWF0cm9uLm1hdHJvbklkID09IF9zaXJlSWQgfHwgX21hdHJvbi5zaXJlSWQgPT0gX3NpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSBfbWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb25JZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBXZSBjYW4gc2hvcnQgY2lyY3VpdCB0aGUgc2libGluZyBjaGVjayAoYmVsb3cpIGlmIGVpdGhlciBtb25zdGVyIGlzCiAgICAgICAgLy8gZ2VuIHplcm8gKGhhcyBhIG1hdHJvbiBJRCBvZiB6ZXJvKS4KICAgICAgICBpZiAoX3NpcmUubWF0cm9uSWQgPT0gMCB8fCBfbWF0cm9uLm1hdHJvbklkID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBNb25zdGVycyBjYW4ndCBicmVlZCB3aXRoIGZ1bGwgb3IgaGFsZiBzaWJsaW5ncy4KICAgICAgICBpZiAoX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbi5tYXRyb25JZCB8fCBfc2lyZS5tYXRyb25JZCA9PSBfbWF0cm9uLnNpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5zaXJlSWQgPT0gX21hdHJvbi5tYXRyb25JZCB8fCBfc2lyZS5zaXJlSWQgPT0gX21hdHJvbi5zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gRXZlcnl0aGluZyBzZWVtcyBjb29sISBMZXQncyBnZXQgRFRGLgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGNoZWNrIHRvIHNlZSBpZiBhIGdpdmVuIHNpcmUgYW5kIG1hdHJvbiBhcmUgYSB2YWxpZCBtYXRpbmcgcGFpciBmb3IKICAgIC8vLyAgYnJlZWRpbmcgdmlhIGF1Y3Rpb24gKGkuZS4gc2tpcHMgb3duZXJzaGlwIGFuZCBzaXJpbmcgYXBwcm92YWwgY2hlY2tzKS4KICAgIGZ1bmN0aW9uIF9jYW5CcmVlZFdpdGhWaWFBdWN0aW9uKHVpbnQyNTYgX21hdHJvbklkLCB1aW50MjU2IF9zaXJlSWQpCiAgICBpbnRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBNb25zdGVyIHN0b3JhZ2UgbWF0cm9uID0gbW9uc3RlcnNbX21hdHJvbklkXTsKICAgICAgICBNb25zdGVyIHN0b3JhZ2Ugc2lyZSA9IG1vbnN0ZXJzW19zaXJlSWRdOwogICAgICAgIHJldHVybiBfaXNWYWxpZE1hdGluZ1BhaXIobWF0cm9uLCBfbWF0cm9uSWQsIHNpcmUsIF9zaXJlSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB0byBzZWUgaWYgdHdvIG1vbnN0ZXJzIGNhbiBicmVlZCB0b2dldGhlciwgaW5jbHVkaW5nIGNoZWNrcyBmb3IKICAgIC8vLyAgb3duZXJzaGlwIGFuZCBzaXJpbmcgYXBwcm92YWxzLiBEb2VzIE5PVCBjaGVjayB0aGF0IGJvdGggbW9uc3RlcnMgYXJlIHJlYWR5IGZvcgogICAgLy8vICBicmVlZGluZyAoaS5lLiBicmVlZFdpdGggY291bGQgc3RpbGwgZmFpbCB1bnRpbCB0aGUgY29vbGRvd25zIGFyZSBmaW5pc2hlZCkuCiAgICAvLy8gIFRPRE86IFNob3VsZG4ndCB0aGlzIGNoZWNrIHByZWduYW5jeSBhbmQgY29vbGRvd25zPyE/CiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgSUQgb2YgdGhlIHByb3Bvc2VkIG1hdHJvbi4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBUaGUgSUQgb2YgdGhlIHByb3Bvc2VkIHNpcmUuCiAgICBmdW5jdGlvbiBjYW5CcmVlZFdpdGgodWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX21hdHJvbklkID4gMCk7CiAgICAgICAgcmVxdWlyZShfc2lyZUlkID4gMCk7CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1hdHJvbiA9IG1vbnN0ZXJzW19tYXRyb25JZF07CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIHNpcmUgPSBtb25zdGVyc1tfc2lyZUlkXTsKICAgICAgICByZXR1cm4gX2lzVmFsaWRNYXRpbmdQYWlyKG1hdHJvbiwgX21hdHJvbklkLCBzaXJlLCBfc2lyZUlkKSAmJgogICAgICAgIF9pc1NpcmluZ1Blcm1pdHRlZChfc2lyZUlkLCBfbWF0cm9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb24gdG8gaW5pdGlhdGUgYnJlZWRpbmcsIGFzc3VtZXMgdGhhdCBhbGwgYnJlZWRpbmcKICAgIC8vLyAgcmVxdWlyZW1lbnRzIGhhdmUgYmVlbiBjaGVja2VkLgogICAgZnVuY3Rpb24gX2JyZWVkV2l0aCh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlcnMgZnJvbSBzdG9yYWdlLgogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBzaXJlID0gbW9uc3RlcnNbX3NpcmVJZF07CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1hdHJvbiA9IG1vbnN0ZXJzW19tYXRyb25JZF07CgogICAgICAgIC8vIE1hcmsgdGhlIG1hdHJvbiBhcyBwcmVnbmFudCwga2VlcGluZyB0cmFjayBvZiB3aG8gdGhlIHNpcmUgaXMuCiAgICAgICAgbWF0cm9uLnNpcmluZ1dpdGhJZCA9IHVpbnQzMihfc2lyZUlkKTsKCiAgICAgICAgLy8gVHJpZ2dlciB0aGUgY29vbGRvd24gZm9yIGJvdGggcGFyZW50cy4KICAgICAgICBfdHJpZ2dlckNvb2xkb3duKHNpcmUpOwogICAgICAgIF90cmlnZ2VyQ29vbGRvd24obWF0cm9uKTsKCiAgICAgICAgLy8gQ2xlYXIgc2lyaW5nIHBlcm1pc3Npb24gZm9yIGJvdGggcGFyZW50cy4gVGhpcyBtYXkgbm90IGJlIHN0cmljdGx5IG5lY2Vzc2FyeQogICAgICAgIC8vIGJ1dCBpdCdzIGxpa2VseSB0byBhdm9pZCBjb25mdXNpb24hCiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19tYXRyb25JZF07CiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdOwoKICAgICAgICAvLyBFdmVyeSB0aW1lIGEgbW9uc3RlciBnZXRzIHByZWduYW50LCBjb3VudGVyIGlzIGluY3JlbWVudGVkLgogICAgICAgIHByZWduYW50TW9uc3RlcnMrKzsKCiAgICAgICAgLy8gRW1pdCB0aGUgcHJlZ25hbmN5IGV2ZW50LgogICAgICAgIFByZWduYW50KG1vbnN0ZXJJbmRleFRvT3duZXJbX21hdHJvbklkXSwgX21hdHJvbklkLCBfc2lyZUlkLCBtYXRyb24uY29vbGRvd25FbmRCbG9jayk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQnJlZWQgYSBNb25zdGVyIHlvdSBvd24gKGFzIG1hdHJvbikgd2l0aCBhIHNpcmUgdGhhdCB5b3Ugb3duLCBvciBmb3Igd2hpY2ggeW91CiAgICAvLy8gIGhhdmUgcHJldmlvdXNseSBiZWVuIGdpdmVuIFNpcmluZyBhcHByb3ZhbC4gV2lsbCBlaXRoZXIgbWFrZSB5b3VyIG1vbnN0ZXIgcHJlZ25hbnQsIG9yIHdpbGwKICAgIC8vLyAgZmFpbCBlbnRpcmVseS4gUmVxdWlyZXMgYSBwcmUtcGF5bWVudCBvZiB0aGUgZmVlIGdpdmVuIG91dCB0byB0aGUgZmlyc3QgY2FsbGVyIG9mIGdpdmVCaXJ0aCgpCiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgYWN0aW5nIGFzIG1hdHJvbiAod2lsbCBlbmQgdXAgcHJlZ25hbnQgaWYgc3VjY2Vzc2Z1bCkKICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgYWN0aW5nIGFzIHNpcmUgKHdpbGwgYmVnaW4gaXRzIHNpcmluZyBjb29sZG93biBpZiBzdWNjZXNzZnVsKQogICAgZnVuY3Rpb24gYnJlZWRXaXRoQXV0byh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBDaGVja3MgZm9yIHBheW1lbnQuCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gYXV0b0JpcnRoRmVlKTsKCiAgICAgICAgLy8gQ2FsbGVyIG11c3Qgb3duIHRoZSBtYXRyb24uCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbWF0cm9uSWQpKTsKCiAgICAgICAgLy8gTmVpdGhlciBzaXJlIG5vciBtYXRyb24gYXJlIGFsbG93ZWQgdG8gYmUgb24gYXVjdGlvbiBkdXJpbmcgYSBub3JtYWwKICAgICAgICAvLyBicmVlZGluZyBvcGVyYXRpb24sIGJ1dCB3ZSBkb24ndCBuZWVkIHRvIGNoZWNrIHRoYXQgZXhwbGljaXRseS4KICAgICAgICAvLyBGb3IgbWF0cm9uOiBUaGUgY2FsbGVyIG9mIHRoaXMgZnVuY3Rpb24gY2FuJ3QgYmUgdGhlIG93bmVyIG9mIHRoZSBtYXRyb24KICAgICAgICAvLyAgIGJlY2F1c2UgdGhlIG93bmVyIG9mIGEgTW9uc3RlciBvbiBhdWN0aW9uIGlzIHRoZSBhdWN0aW9uIGhvdXNlLCBhbmQgdGhlCiAgICAgICAgLy8gICBhdWN0aW9uIGhvdXNlIHdpbGwgbmV2ZXIgY2FsbCBicmVlZFdpdGgoKS4KICAgICAgICAvLyBGb3Igc2lyZTogU2ltaWxhcmx5LCBhIHNpcmUgb24gYXVjdGlvbiB3aWxsIGJlIG93bmVkIGJ5IHRoZSBhdWN0aW9uIGhvdXNlCiAgICAgICAgLy8gICBhbmQgdGhlIGFjdCBvZiB0cmFuc2ZlcnJpbmcgb3duZXJzaGlwIHdpbGwgaGF2ZSBjbGVhcmVkIGFueSBvdXN0YW5kaW5nCiAgICAgICAgLy8gICBzaXJpbmcgYXBwcm92YWwuCiAgICAgICAgLy8gVGh1cyB3ZSBkb24ndCBuZWVkIHRvIHNwZW5kIGdhcyBleHBsaWNpdGx5IGNoZWNraW5nIHRvIHNlZSBpZiBlaXRoZXIgbW9uc3RlcgogICAgICAgIC8vIGlzIG9uIGF1Y3Rpb24uCgogICAgICAgIC8vIENoZWNrIHRoYXQgbWF0cm9uIGFuZCBzaXJlIGFyZSBib3RoIG93bmVkIGJ5IGNhbGxlciwgb3IgdGhhdCB0aGUgc2lyZQogICAgICAgIC8vIGhhcyBnaXZlbiBzaXJpbmcgcGVybWlzc2lvbiB0byBjYWxsZXIgKGkuZS4gbWF0cm9uJ3Mgb3duZXIpLgogICAgICAgIC8vIFdpbGwgZmFpbCBmb3IgX3NpcmVJZCA9IDAKICAgICAgICByZXF1aXJlKF9pc1NpcmluZ1Blcm1pdHRlZChfc2lyZUlkLCBfbWF0cm9uSWQpKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgcG90ZW50aWFsIG1hdHJvbgogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtYXRyb24gPSBtb25zdGVyc1tfbWF0cm9uSWRdOwoKICAgICAgICAvLyBNYWtlIHN1cmUgbWF0cm9uIGlzbid0IHByZWduYW50LCBvciBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvQnJlZWQobWF0cm9uKSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHBvdGVudGlhbCBzaXJlCiAgICAgICAgTW9uc3RlciBzdG9yYWdlIHNpcmUgPSBtb25zdGVyc1tfc2lyZUlkXTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHNpcmUgaXNuJ3QgcHJlZ25hbnQsIG9yIGluIHRoZSBtaWRkbGUgb2YgYSBzaXJpbmcgY29vbGRvd24KICAgICAgICByZXF1aXJlKF9pc1JlYWR5VG9CcmVlZChzaXJlKSk7CgogICAgICAgIC8vIFRlc3QgdGhhdCB0aGVzZSBtb25zdGVycyBhcmUgYSB2YWxpZCBtYXRpbmcgcGFpci4KICAgICAgICByZXF1aXJlKF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICAgICAgICAgIG1hdHJvbiwKICAgICAgICAgICAgICAgIF9tYXRyb25JZCwKICAgICAgICAgICAgICAgIHNpcmUsCiAgICAgICAgICAgICAgICBfc2lyZUlkCiAgICAgICAgICAgICkpOwoKICAgICAgICAvLyBBbGwgY2hlY2tzIHBhc3NlZCwgbW9uc3RlciBnZXRzIHByZWduYW50IQogICAgICAgIF9icmVlZFdpdGgoX21hdHJvbklkLCBfc2lyZUlkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBIYXZlIGEgcHJlZ25hbnQgTW9uc3RlciBnaXZlIGJpcnRoIQogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgQSBNb25zdGVyIHJlYWR5IHRvIGdpdmUgYmlydGguCiAgICAvLy8gQHJldHVybiBUaGUgTW9uc3RlciBJRCBvZiB0aGUgbmV3IG1vbnN0ZXIuCiAgICAvLy8gQGRldiBMb29rcyBhdCBhIGdpdmVuIE1vbnN0ZXIgYW5kLCBpZiBwcmVnbmFudCBhbmQgaWYgdGhlIGdlc3RhdGlvbiBwZXJpb2QgaGFzIHBhc3NlZCwKICAgIC8vLyAgY29tYmluZXMgdGhlIGdlbmVzIG9mIHRoZSB0d28gcGFyZW50cyB0byBjcmVhdGUgYSBuZXcgbW9uc3Rlci4gVGhlIG5ldyBNb25zdGVyIGlzIGFzc2lnbmVkCiAgICAvLy8gIHRvIHRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSBtYXRyb24uIFVwb24gc3VjY2Vzc2Z1bCBjb21wbGV0aW9uLCBib3RoIHRoZSBtYXRyb24gYW5kIHRoZQogICAgLy8vICBuZXcgbW9uc3RlciB3aWxsIGJlIHJlYWR5IHRvIGJyZWVkIGFnYWluLiBOb3RlIHRoYXQgYW55b25lIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gKGlmIHRoZXkKICAgIC8vLyAgYXJlIHdpbGxpbmcgdG8gcGF5IHRoZSBnYXMhKSwgYnV0IHRoZSBuZXcgbW9uc3RlciBhbHdheXMgZ29lcyB0byB0aGUgbW90aGVyJ3Mgb3duZXIuCiAgICBmdW5jdGlvbiBnaXZlQmlydGgodWludDI1NiBfbWF0cm9uSWQpCiAgICBleHRlcm5hbAogICAgb25seUNPTwogICAgd2hlbk5vdFBhdXNlZAogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBtYXRyb24gaW4gc3RvcmFnZS4KICAgICAgICBNb25zdGVyIHN0b3JhZ2UgbWF0cm9uID0gbW9uc3RlcnNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgbWF0cm9uIGlzIGEgdmFsaWQgbW9uc3Rlci4KICAgICAgICByZXF1aXJlKG1hdHJvbi5iaXJ0aFRpbWUgIT0gMCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIG1hdHJvbiBpcyBwcmVnbmFudCwgYW5kIHRoYXQgaXRzIHRpbWUgaGFzIGNvbWUhCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvR2l2ZUJpcnRoKG1hdHJvbikpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzaXJlIGluIHN0b3JhZ2UuCiAgICAgICAgdWludDI1NiBzaXJlSWQgPSBtYXRyb24uc2lyaW5nV2l0aElkOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBzaXJlID0gbW9uc3RlcnNbc2lyZUlkXTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBoaWdoZXIgZ2VuZXJhdGlvbiBudW1iZXIgb2YgdGhlIHR3byBwYXJlbnRzCiAgICAgICAgdWludDE2IHBhcmVudEdlbiA9IG1hdHJvbi5nZW5lcmF0aW9uOwogICAgICAgIGlmIChzaXJlLmdlbmVyYXRpb24gPiBtYXRyb24uZ2VuZXJhdGlvbikgewogICAgICAgICAgICBwYXJlbnRHZW4gPSBzaXJlLmdlbmVyYXRpb247CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxsIHRoZSBzb29wZXItc2VrcmV0IGdlbmUgbWl4aW5nIG9wZXJhdGlvbi4KICAgICAgICAvLyB0YXJnZXRCbG9jawogICAgICAgIHVpbnQyNTYgY2hpbGRHZW5lcyA9IGdlbmVTY2llbmNlLm1peEdlbmVzKG1hdHJvbi5nZW5lcywgc2lyZS5nZW5lcywgbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgLSAxKTsKCiAgICAgICAgLy8gTWFrZSB0aGUgbmV3IG1vbnN0ZXIhCiAgICAgICAgYWRkcmVzcyBvd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKF9tYXRyb25JZCwgbWF0cm9uLnNpcmluZ1dpdGhJZCwgcGFyZW50R2VuICsgMSwgY2hpbGRHZW5lcywgb3duZXIpOwoKICAgICAgICAvLyBDbGVhciB0aGUgcmVmZXJlbmNlIHRvIHNpcmUgZnJvbSB0aGUgbWF0cm9uIChSRVFVSVJFRCEgSGF2aW5nIHNpcmluZ1dpdGhJZAogICAgICAgIC8vIHNldCBpcyB3aGF0IG1hcmtzIGEgbWF0cm9uIGFzIGJlaW5nIHByZWduYW50LikKICAgICAgICBkZWxldGUgbWF0cm9uLnNpcmluZ1dpdGhJZDsKCiAgICAgICAgLy8gRXZlcnkgdGltZSBhIG1vbnN0ZXIgZ2l2ZXMgYmlydGggY291bnRlciBpcyBkZWNyZW1lbnRlZC4KICAgICAgICBwcmVnbmFudE1vbnN0ZXJzLS07CgogICAgICAgIC8vIFNlbmQgdGhlIGJhbGFuY2UgZmVlIHRvIHRoZSBwZXJzb24gd2hvIG1hZGUgYmlydGggaGFwcGVuLgogICAgICAgIG1zZy5zZW5kZXIuc2VuZChhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyByZXR1cm4gdGhlIG5ldyBtb25zdGVyJ3MgSUQKICAgICAgICByZXR1cm4gbW9uc3RlcklkOwogICAgfQp9CgoKCgoKCgoKCgoKCi8vLyBAdGl0bGUgSGFuZGxlcyBjcmVhdGluZyBhdWN0aW9ucyBmb3Igc2FsZSBhbmQgc2lyaW5nIG9mIG1vbnN0ZXJzLgovLy8gIFRoaXMgd3JhcHBlciBvZiBSZXZlcnNlQXVjdGlvbiBleGlzdHMgb25seSBzbyB0aGF0IHVzZXJzIGNhbiBjcmVhdGUKLy8vICBhdWN0aW9ucyB3aXRoIG9ubHkgb25lIHRyYW5zYWN0aW9uLgpjb250cmFjdCBNb25zdGVyQXVjdGlvbiBpcyBNb25zdGVyQnJlZWRpbmcgewoKICAgIC8vIEBub3RpY2UgVGhlIGF1Y3Rpb24gY29udHJhY3QgdmFyaWFibGVzIGFyZSBkZWZpbmVkIGluIE1vbnN0ZXJCYXNlIHRvIGFsbG93CiAgICAvLyAgdXMgdG8gcmVmZXIgdG8gdGhlbSBpbiBNb25zdGVyT3duZXJzaGlwIHRvIHByZXZlbnQgYWNjaWRlbnRhbCB0cmFuc2ZlcnMuCiAgICAvLyBgc2FsZUF1Y3Rpb25gIHJlZmVycyB0byB0aGUgYXVjdGlvbiBmb3IgZ2VuMCBhbmQgcDJwIHNhbGUgb2YgbW9uc3RlcnMuCiAgICAvLyBgc2lyaW5nQXVjdGlvbmAgcmVmZXJzIHRvIHRoZSBhdWN0aW9uIGZvciBzaXJpbmcgcmlnaHRzIG9mIG1vbnN0ZXJzLgoKICAgIC8vLyBAZGV2IFNldHMgdGhlIHJlZmVyZW5jZSB0byB0aGUgc2FsZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyAtIEFkZHJlc3Mgb2Ygc2FsZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldFNhbGVBdWN0aW9uQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBTYWxlQ2xvY2tBdWN0aW9uIGNhbmRpZGF0ZUNvbnRyYWN0ID0gU2FsZUNsb2NrQXVjdGlvbihfYWRkcmVzcyk7CgogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2FsZUNsb2NrQXVjdGlvbigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIHNhbGVBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBzaXJpbmcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgLSBBZGRyZXNzIG9mIHNpcmluZyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldFNpcmluZ0F1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIFNpcmluZ0Nsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNpcmluZ0Nsb2NrQXVjdGlvbihfYWRkcmVzcyk7CgogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2lyaW5nQ2xvY2tBdWN0aW9uKCkpOwoKICAgICAgICAvLyBTZXQgdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgc2lyaW5nQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFB1dCBhIG1vbnN0ZXIgdXAgZm9yIGF1Y3Rpb24uCiAgICAvLy8gIERvZXMgc29tZSBvd25lcnNoaXAgdHJpY2tlcnkgdG8gY3JlYXRlIGF1Y3Rpb25zIGluIG9uZSB0eC4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNhbGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX21vbnN0ZXJJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIEF1Y3Rpb24gY29udHJhY3QgY2hlY2tzIGlucHV0IHNpemVzCiAgICAgICAgLy8gSWYgbW9uc3RlciBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbW9uc3RlcklkKSk7CiAgICAgICAgLy8gRW5zdXJlIHRoZSBtb25zdGVyIGlzIG5vdCBwcmVnbmFudCB0byBwcmV2ZW50IHRoZSBhdWN0aW9uCiAgICAgICAgLy8gY29udHJhY3QgYWNjaWRlbnRhbGx5IHJlY2VpdmluZyBvd25lcnNoaXAgb2YgdGhlIGNoaWxkLgogICAgICAgIC8vIE5PVEU6IHRoZSBtb25zdGVyIElTIGFsbG93ZWQgdG8gYmUgaW4gYSBjb29sZG93bi4KICAgICAgICByZXF1aXJlKCFpc1ByZWduYW50KF9tb25zdGVySWQpKTsKICAgICAgICBfYXBwcm92ZShfbW9uc3RlcklkLCBzYWxlQXVjdGlvbik7CiAgICAgICAgLy8gU2FsZSBhdWN0aW9uIHRocm93cyBpZiBpbnB1dHMgYXJlIGludmFsaWQgYW5kIGNsZWFycwogICAgICAgIC8vIHRyYW5zZmVyIGFuZCBzaXJlIGFwcHJvdmFsIGFmdGVyIGVzY3Jvd2luZyB0aGUgbW9uc3Rlci4KICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfbW9uc3RlcklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IFB1dCBhIG1vbnN0ZXIgdXAgZm9yIGF1Y3Rpb24gdG8gYmUgc2lyZS4KICAgIC8vLyAgUGVyZm9ybXMgY2hlY2tzIHRvIGVuc3VyZSB0aGUgbW9uc3RlciBjYW4gYmUgc2lyZWQsIHRoZW4KICAgIC8vLyAgZGVsZWdhdGVzIHRvIHJldmVyc2UgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNpcmluZ0F1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfbW9uc3RlcklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24KICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBtb25zdGVyIGlzIGFscmVhZHkgb24gYW55IGF1Y3Rpb24sIHRoaXMgd2lsbCB0aHJvdwogICAgICAgIC8vIGJlY2F1c2UgaXQgd2lsbCBiZSBvd25lZCBieSB0aGUgYXVjdGlvbiBjb250cmFjdC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9tb25zdGVySWQpKTsKICAgICAgICByZXF1aXJlKGlzUmVhZHlUb0JyZWVkKF9tb25zdGVySWQpKTsKICAgICAgICBfYXBwcm92ZShfbW9uc3RlcklkLCBzaXJpbmdBdWN0aW9uKTsKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB0aHJvd3MgaWYgaW5wdXRzIGFyZSBpbnZhbGlkIGFuZCBjbGVhcnMKICAgICAgICAvLyB0cmFuc2ZlciBhbmQgc2lyZSBhcHByb3ZhbCBhZnRlciBlc2Nyb3dpbmcgdGhlIG1vbnN0ZXIuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfbW9uc3RlcklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXBsZXRlcyBhIHNpcmluZyBhdWN0aW9uIGJ5IGJpZGRpbmcuCiAgICAvLy8gIEltbWVkaWF0ZWx5IGJyZWVkcyB0aGUgd2lubmluZyBtYXRyb24gd2l0aCB0aGUgc2lyZSBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIC0gSUQgb2YgdGhlIHNpcmUgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIC0gSUQgb2YgdGhlIG1hdHJvbiBvd25lZCBieSB0aGUgYmlkZGVyLgogICAgZnVuY3Rpb24gYmlkT25TaXJpbmdBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBBdWN0aW9uIGNvbnRyYWN0IGNoZWNrcyBpbnB1dCBzaXplcwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CiAgICAgICAgcmVxdWlyZShpc1JlYWR5VG9CcmVlZChfbWF0cm9uSWQpKTsKICAgICAgICByZXF1aXJlKF9jYW5CcmVlZFdpdGhWaWFBdWN0aW9uKF9tYXRyb25JZCwgX3NpcmVJZCkpOwoKICAgICAgICAvLyBEZWZpbmUgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgdGhlIGF1Y3Rpb24uCiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2UgPSBzaXJpbmdBdWN0aW9uLmdldEN1cnJlbnRQcmljZShfc2lyZUlkKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBjdXJyZW50UHJpY2UgKyBhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB3aWxsIHRocm93IGlmIHRoZSBiaWQgZmFpbHMuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5iaWQudmFsdWUobXNnLnZhbHVlIC0gYXV0b0JpcnRoRmVlKShfc2lyZUlkKTsKICAgICAgICBfYnJlZWRXaXRoKHVpbnQzMihfbWF0cm9uSWQpLCB1aW50MzIoX3NpcmVJZCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0aGUgYmFsYW5jZSBvZiB0aGUgc2FsZSBhdWN0aW9uIGNvbnRyYWN0CiAgICAvLy8gdG8gdGhlIE1vbnN0ZXJDb3JlIGNvbnRyYWN0LiBXZSB1c2UgdHdvLXN0ZXAgd2l0aGRyYXdhbCB0bwogICAgLy8vIHByZXZlbnQgdHdvIHRyYW5zZmVyIGNhbGxzIGluIHRoZSBhdWN0aW9uIGJpZCBmdW5jdGlvbi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QXVjdGlvbkJhbGFuY2VzKCkgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgc2FsZUF1Y3Rpb24ud2l0aGRyYXdCYWxhbmNlKCk7CiAgICAgICAgc2lyaW5nQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgYWxsIGZ1bmN0aW9ucyByZWxhdGVkIHRvIGNyZWF0aW5nIG1vbnN0ZXJzCmNvbnRyYWN0IE1vbnN0ZXJNaW50aW5nIGlzIE1vbnN0ZXJBdWN0aW9uIHsKCiAgICAvLyBMaW1pdHMgdGhlIG51bWJlciBvZiBtb25zdGVycyB0aGUgY29udHJhY3Qgb3duZXIgY2FuIGV2ZXIgY3JlYXRlLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTU9fQ1JFQVRJT05fTElNSVQgPSA1MDAwOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9DUkVBVElPTl9MSU1JVCA9IDQ1MDAwOwoKICAgIC8vIENvbnN0YW50cyBmb3IgZ2VuMCBhdWN0aW9ucy4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEdFTjBfU1RBUlRJTkdfUFJJQ0UgPSAxMCBmaW5uZXk7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX0FVQ1RJT05fRFVSQVRJT04gPSAxIGRheXM7CgogICAgLy8gQ291bnRzIHRoZSBudW1iZXIgb2YgbW9uc3RlcnMgdGhlIGNvbnRyYWN0IG93bmVyIGhhcyBjcmVhdGVkLgogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CiAgICB1aW50MjU2IHB1YmxpYyBnZW4wQ3JlYXRlZENvdW50OwoKICAgIC8vLyBAZGV2IHdlIGNhbiBjcmVhdGUgcHJvbW8gbW9uc3RlcnMsIHVwIHRvIGEgbGltaXQuIE9ubHkgY2FsbGFibGUgYnkgQ09PCiAgICAvLy8gQHBhcmFtIF9nZW5lcyB0aGUgZW5jb2RlZCBnZW5lcyBvZiB0aGUgbW9uc3RlciB0byBiZSBjcmVhdGVkLCBhbnkgdmFsdWUgaXMgYWNjZXB0ZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIHRoZSBmdXR1cmUgb3duZXIgb2YgdGhlIGNyZWF0ZWQgbW9uc3RlcnMuIERlZmF1bHQgdG8gY29udHJhY3QgQ09PCiAgICBmdW5jdGlvbiBjcmVhdGVQcm9tb01vbnN0ZXIodWludDI1NiBfZ2VuZXMsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBhZGRyZXNzIG1vbnN0ZXJPd25lciA9IF9vd25lcjsKICAgICAgICBpZiAobW9uc3Rlck93bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgbW9uc3Rlck93bmVyID0gY29vQWRkcmVzczsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShwcm9tb0NyZWF0ZWRDb3VudCA8IFBST01PX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgcHJvbW9DcmVhdGVkQ291bnQrKzsKICAgICAgICBfY3JlYXRlTW9uc3RlcigwLCAwLCAwLCBfZ2VuZXMsIG1vbnN0ZXJPd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhIG5ldyBnZW4wIG1vbnN0ZXIgd2l0aCB0aGUgZ2l2ZW4gZ2VuZXMgYW5kCiAgICAvLy8gIGNyZWF0ZXMgYW4gYXVjdGlvbiBmb3IgaXQuCiAgICBmdW5jdGlvbiBjcmVhdGVHZW4wQXVjdGlvbih1aW50MjU2IF9nZW5lcykgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgcmVxdWlyZShnZW4wQ3JlYXRlZENvdW50IDwgR0VOMF9DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHVpbnQyNTYgZ2VuZXMgPSBfZ2VuZXM7CiAgICAgICAgaWYoZ2VuZXMgPT0gMCkKICAgICAgICAgICAgZ2VuZXMgPSBnZW5lU2NpZW5jZS5yYW5kb21HZW5lcygpOwoKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDAsIDAsIDAsIGdlbmVzLCBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfYXBwcm92ZShtb25zdGVySWQsIHNhbGVBdWN0aW9uKTsKCiAgICAgICAgc2FsZUF1Y3Rpb24uY3JlYXRlQXVjdGlvbigKICAgICAgICAgICAgbW9uc3RlcklkLAogICAgICAgICAgICBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgR0VOMF9BVUNUSU9OX0RVUkFUSU9OLAogICAgICAgICAgICBhZGRyZXNzKHRoaXMpCiAgICAgICAgKTsKCiAgICAgICAgZ2VuMENyZWF0ZWRDb3VudCsrOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBuZXh0IGdlbjAgYXVjdGlvbiBzdGFydGluZyBwcmljZSwgZ2l2ZW4KICAgIC8vLyAgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHBhc3QgNSBwcmljZXMgKyA1MCUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGF2ZVByaWNlID0gc2FsZUF1Y3Rpb24uYXZlcmFnZUdlbjBTYWxlUHJpY2UoKTsKCiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRvIGVuc3VyZSB3ZSBkb24ndCBvdmVyZmxvdyBhcml0aG1ldGljCiAgICAgICAgcmVxdWlyZShhdmVQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoYXZlUHJpY2UpKSk7CgogICAgICAgIHVpbnQyNTYgbmV4dFByaWNlID0gYXZlUHJpY2UgKyAoYXZlUHJpY2UgLyAyKTsKCiAgICAgICAgLy8gV2UgbmV2ZXIgYXVjdGlvbiBmb3IgbGVzcyB0aGFuIHN0YXJ0aW5nIHByaWNlCiAgICAgICAgaWYgKG5leHRQcmljZSA8IEdFTjBfU1RBUlRJTkdfUFJJQ0UpIHsKICAgICAgICAgICAgbmV4dFByaWNlID0gR0VOMF9TVEFSVElOR19QUklDRTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXh0UHJpY2U7CiAgICB9Cn0KCgovLy8gQHRpdGxlIENyeXB0b01vbnN0ZXJzOiBDb2xsZWN0aWJsZSwgYnJlZWRhYmxlLCBhbmQgb2gtc28tYWRvcmFibGUgbW9uc3RlcnMgb24gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4uCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFRoZSBtYWluIENyeXB0b01vbnN0ZXJzIGNvbnRyYWN0LCBrZWVwcyB0cmFjayBvZiBtb25zdGVycyBzbyB0aGV5IGRvbid0IHdhbmRlciBhcm91bmQgYW5kIGdldCBsb3N0Lgpjb250cmFjdCBNb25zdGVyQ29yZSBpcyBNb25zdGVyTWludGluZyB7CgogICAgLy8gVGhpcyBpcyB0aGUgbWFpbiBDcnlwdG9Nb25zdGVycyBjb250cmFjdC4gSW4gb3JkZXIgdG8ga2VlcCBvdXIgY29kZSBzZXBlcmF0ZWQgaW50byBsb2dpY2FsIHNlY3Rpb25zLAogICAgLy8gd2UndmUgYnJva2VuIGl0IHVwIGluIHR3byB3YXlzLiBGaXJzdCwgd2UgaGF2ZSBzZXZlcmFsIHNlcGVyYXRlbHktaW5zdGFudGlhdGVkIHNpYmxpbmcgY29udHJhY3RzCiAgICAvLyB0aGF0IGhhbmRsZSBhdWN0aW9ucyBhbmQgb3VyIHN1cGVyLXRvcC1zZWNyZXQgZ2VuZXRpYyBjb21iaW5hdGlvbiBhbGdvcml0aG0uIFRoZSBhdWN0aW9ucyBhcmUKICAgIC8vIHNlcGVyYXRlIHNpbmNlIHRoZWlyIGxvZ2ljIGlzIHNvbWV3aGF0IGNvbXBsZXggYW5kIHRoZXJlJ3MgYWx3YXlzIGEgcmlzayBvZiBzdWJ0bGUgYnVncy4gQnkga2VlcGluZwogICAgLy8gdGhlbSBpbiB0aGVpciBvd24gY29udHJhY3RzLCB3ZSBjYW4gdXBncmFkZSB0aGVtIHdpdGhvdXQgZGlzcnVwdGluZyB0aGUgbWFpbiBjb250cmFjdCB0aGF0IHRyYWNrcwogICAgLy8gbW9uc3RlciBvd25lcnNoaXAuIFRoZSBnZW5ldGljIGNvbWJpbmF0aW9uIGFsZ29yaXRobSBpcyBrZXB0IHNlcGVyYXRlIHNvIHdlIGNhbiBvcGVuLXNvdXJjZSBhbGwgb2YKICAgIC8vIHRoZSByZXN0IG9mIG91ciBjb2RlIHdpdGhvdXQgbWFraW5nIGl0IF90b29fIGVhc3kgZm9yIGZvbGtzIHRvIGZpZ3VyZSBvdXQgaG93IHRoZSBnZW5ldGljcyB3b3JrLgogICAgLy8gRG9uJ3Qgd29ycnksIEknbSBzdXJlIHNvbWVvbmUgd2lsbCByZXZlcnNlIGVuZ2luZWVyIGl0IHNvb24gZW5vdWdoIQogICAgLy8KICAgIC8vIFNlY29uZGx5LCB3ZSBicmVhayB0aGUgY29yZSBjb250cmFjdCBpbnRvIG11bHRpcGxlIGZpbGVzIHVzaW5nIGluaGVyaXRlbmNlLCBvbmUgZm9yIGVhY2ggbWFqb3IKICAgIC8vIGZhY2V0IG9mIGZ1bmN0aW9uYWxpdHkgb2YgQ0suIFRoaXMgYWxsb3dzIHVzIHRvIGtlZXAgcmVsYXRlZCBjb2RlIGJ1bmRsZWQgdG9nZXRoZXIgd2hpbGUgc3RpbGwKICAgIC8vIGF2b2lkaW5nIGEgc2luZ2xlIGdpYW50IGZpbGUgd2l0aCBldmVyeXRoaW5nIGluIGl0LiBUaGUgYnJlYWtkb3duIGlzIGFzIGZvbGxvd3M6CiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJCYXNlOiBUaGlzIGlzIHdoZXJlIHdlIGRlZmluZSB0aGUgbW9zdCBmdW5kYW1lbnRhbCBjb2RlIHNoYXJlZCB0aHJvdWdob3V0IHRoZSBjb3JlCiAgICAvLyAgICAgICAgICAgICBmdW5jdGlvbmFsaXR5LiBUaGlzIGluY2x1ZGVzIG91ciBtYWluIGRhdGEgc3RvcmFnZSwgY29uc3RhbnRzIGFuZCBkYXRhIHR5cGVzLCBwbHVzCiAgICAvLyAgICAgICAgICAgICBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIHRoZXNlIGl0ZW1zLgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyQWNjZXNzQ29udHJvbDogVGhpcyBjb250cmFjdCBtYW5hZ2VzIHRoZSB2YXJpb3VzIGFkZHJlc3NlcyBhbmQgY29uc3RyYWludHMgZm9yIG9wZXJhdGlvbnMKICAgIC8vICAgICAgICAgICAgIHRoYXQgY2FuIGJlIGV4ZWN1dGVkIG9ubHkgYnkgc3BlY2lmaWMgcm9sZXMuIE5hbWVseSBDRU8sIENGTyBhbmQgQ09PLgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyT3duZXJzaGlwOiBUaGlzIHByb3ZpZGVzIHRoZSBtZXRob2RzIHJlcXVpcmVkIGZvciBiYXNpYyBub24tZnVuZ2libGUgdG9rZW4KICAgIC8vICAgICAgICAgICAgIHRyYW5zYWN0aW9ucywgZm9sbG93aW5nIHRoZSBkcmFmdCBFUkMtNzIxIHNwZWMgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpLgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyQnJlZWRpbmc6IFRoaXMgZmlsZSBjb250YWlucyB0aGUgbWV0aG9kcyBuZWNlc3NhcnkgdG8gYnJlZWQgbW9uc3RlcnMgdG9nZXRoZXIsIGluY2x1ZGluZwogICAgLy8gICAgICAgICAgICAga2VlcGluZyB0cmFjayBvZiBzaXJpbmcgb2ZmZXJzLCBhbmQgcmVsaWVzIG9uIGFuIGV4dGVybmFsIGdlbmV0aWMgY29tYmluYXRpb24gY29udHJhY3QuCiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJBdWN0aW9uczogSGVyZSB3ZSBoYXZlIHRoZSBwdWJsaWMgbWV0aG9kcyBmb3IgYXVjdGlvbmluZyBvciBiaWRkaW5nIG9uIG1vbnN0ZXJzIG9yIHNpcmluZwogICAgLy8gICAgICAgICAgICAgc2VydmljZXMuIFRoZSBhY3R1YWwgYXVjdGlvbiBmdW5jdGlvbmFsaXR5IGlzIGhhbmRsZWQgaW4gdHdvIHNpYmxpbmcgY29udHJhY3RzIChvbmUKICAgIC8vICAgICAgICAgICAgIGZvciBzYWxlcyBhbmQgb25lIGZvciBzaXJpbmcpLCB3aGlsZSBhdWN0aW9uIGNyZWF0aW9uIGFuZCBiaWRkaW5nIGlzIG1vc3RseSBtZWRpYXRlZAogICAgLy8gICAgICAgICAgICAgdGhyb3VnaCB0aGlzIGZhY2V0IG9mIHRoZSBjb3JlIGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyTWludGluZzogVGhpcyBmaW5hbCBmYWNldCBjb250YWlucyB0aGUgZnVuY3Rpb25hbGl0eSB3ZSB1c2UgZm9yIGNyZWF0aW5nIG5ldyBnZW4wIG1vbnN0ZXJzLgogICAgLy8gICAgICAgICAgICAgV2UgY2FuIG1ha2UgdXAgdG8gNTAwMCAicHJvbW8iIG1vbnN0ZXJzIHRoYXQgY2FuIGJlIGdpdmVuIGF3YXkgKGVzcGVjaWFsbHkgaW1wb3J0YW50IHdoZW4KICAgIC8vICAgICAgICAgICAgIHRoZSBjb21tdW5pdHkgaXMgbmV3KSwgYW5kIGFsbCBvdGhlcnMgY2FuIG9ubHkgYmUgY3JlYXRlZCBhbmQgdGhlbiBpbW1lZGlhdGVseSBwdXQgdXAKICAgIC8vICAgICAgICAgICAgIGZvciBhdWN0aW9uIHZpYSBhbiBhbGdvcml0aG1pY2FsbHkgZGV0ZXJtaW5lZCBzdGFydGluZyBwcmljZS4gUmVnYXJkbGVzcyBvZiBob3cgdGhleQogICAgLy8gICAgICAgICAgICAgYXJlIGNyZWF0ZWQsIHRoZXJlIGlzIGEgaGFyZCBsaW1pdCBvZiA1MGsgZ2VuMCBtb25zdGVycy4gQWZ0ZXIgdGhhdCwgaXQncyBhbGwgdXAgdG8gdGhlCiAgICAvLyAgICAgICAgICAgICBjb21tdW5pdHkgdG8gYnJlZWQsIGJyZWVkLCBicmVlZCEKCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgY29yZSBjb250cmFjdCBpcyBicm9rZW4gYW5kIGFuIHVwZ3JhZGUgaXMgcmVxdWlyZWQKICAgIGFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIHRoZSBtYWluIENyeXB0b01vbnN0ZXJzIHNtYXJ0IGNvbnRyYWN0IGluc3RhbmNlLgogICAgZnVuY3Rpb24gTW9uc3RlckNvcmUoKSBwdWJsaWMgewogICAgICAgIC8vIFN0YXJ0cyBwYXVzZWQuCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRU8KICAgICAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIGFsc28gdGhlIGluaXRpYWwgQ09PCiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vCiAgICAgICAgY2ZvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHN0YXJ0IHdpdGggdGhlIG15dGhpY2FsIG1vbnN0ZXIgMCAtIHNvIHdlIGRvbid0IGhhdmUgZ2VuZXJhdGlvbi0wIHBhcmVudCBpc3N1ZXMKICAgICAgICBfY3JlYXRlTW9uc3RlcigwLCAwLCAwLCB1aW50MjU2KDU3ODk2MDQ0NjE4NjU4MDk3NzExNzg1NDkyNTA0MzQzOTUzOTI2NjM0OTkyMzMyODIwMjgyMDE5NzI4NzkyMDA0MDIxNTExNDYyODA3KSwgYWRkcmVzcygwKSk7CiAgICB9CgogICAgLy8vIEBkZXYgVXNlZCB0byBtYXJrIHRoZSBzbWFydCBjb250cmFjdCBhcyB1cGdyYWRlZCwgaW4gY2FzZSB0aGVyZSBpcyBhIHNlcmlvdXMKICAgIC8vLyAgYnJlYWtpbmcgYnVnLiBUaGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcgYnV0IGtlZXAgdHJhY2sgb2YgdGhlIG5ldyBjb250cmFjdCBhbmQKICAgIC8vLyAgZW1pdCBhIG1lc3NhZ2UgaW5kaW1vbnN0ZXJpbmcgdGhhdCB0aGUgbmV3IGFkZHJlc3MgaXMgc2V0LiBJdCdzIHVwIHRvIGNsaWVudHMgb2YgdGhpcwogICAgLy8vICBjb250cmFjdCB0byB1cGRhdGUgdG8gdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzIGluIHRoYXQgY2FzZS4gKFRoaXMgY29udHJhY3Qgd2lsbAogICAgLy8vICBiZSBwYXVzZWQgaW5kZWZpbml0ZWx5IGlmIHN1Y2ggYW4gdXBncmFkZSB0YWtlcyBwbGFjZS4pCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgbmV3IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE5ld0FkZHJlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBObyB0aXBwaW5nIQogICAgLy8vIEBkZXYgUmVqZWN0IGFsbCBFdGhlciBmcm9tIGJlaW5nIHNlbnQgaGVyZSwgdW5sZXNzIGl0J3MgZnJvbSBvbmUgb2YgdGhlCiAgICAvLy8gIHR3byBhdWN0aW9uIGNvbnRyYWN0cy4gKEhvcGVmdWxseSwgd2UgY2FuIHByZXZlbnQgdXNlciBhY2NpZGVudHMuKQogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2FsZUF1Y3Rpb24pIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgbW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX2lkIFRoZSBJRCBvZiB0aGUgbW9uc3RlciBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXIodWludDI1NiBfaWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoCiAgICAgICAgYm9vbCBpc0dlc3RhdGluZywKICAgICAgICBib29sIGlzUmVhZHksCiAgICAgICAgdWludDI1NiBjb29sZG93bkluZGV4LAogICAgICAgIHVpbnQyNTYgbmV4dEFjdGlvbkF0LAogICAgICAgIHVpbnQyNTYgc2lyaW5nV2l0aElkLAogICAgICAgIHVpbnQyNTYgYmlydGhUaW1lLAogICAgICAgIHVpbnQyNTYgbWF0cm9uSWQsCiAgICAgICAgdWludDI1NiBzaXJlSWQsCiAgICAgICAgdWludDI1NiBnZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgZ2VuZXMKICAgICkgewogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtb25zdGVyID0gbW9uc3RlcnNbX2lkXTsKCiAgICAgICAgLy8gaWYgdGhpcyB2YXJpYWJsZSBpcyAwIHRoZW4gaXQncyBub3QgZ2VzdGF0aW5nCiAgICAgICAgaXNHZXN0YXRpbmcgPSAobW9uc3Rlci5zaXJpbmdXaXRoSWQgIT0gMCk7CiAgICAgICAgaXNSZWFkeSA9IChtb25zdGVyLmNvb2xkb3duRW5kQmxvY2sgPD0gYmxvY2subnVtYmVyKTsKICAgICAgICBjb29sZG93bkluZGV4ID0gdWludDI1Nihtb25zdGVyLmNvb2xkb3duSW5kZXgpOwogICAgICAgIG5leHRBY3Rpb25BdCA9IHVpbnQyNTYobW9uc3Rlci5jb29sZG93bkVuZEJsb2NrKTsKICAgICAgICBzaXJpbmdXaXRoSWQgPSB1aW50MjU2KG1vbnN0ZXIuc2lyaW5nV2l0aElkKTsKICAgICAgICBiaXJ0aFRpbWUgPSB1aW50MjU2KG1vbnN0ZXIuYmlydGhUaW1lKTsKICAgICAgICBtYXRyb25JZCA9IHVpbnQyNTYobW9uc3Rlci5tYXRyb25JZCk7CiAgICAgICAgc2lyZUlkID0gdWludDI1Nihtb25zdGVyLnNpcmVJZCk7CiAgICAgICAgZ2VuZXJhdGlvbiA9IHVpbnQyNTYobW9uc3Rlci5nZW5lcmF0aW9uKTsKICAgICAgICBnZW5lcyA9IG1vbnN0ZXIuZ2VuZXM7CiAgICB9CgogICAgLy8vIEBkZXYgT3ZlcnJpZGUgdW5wYXVzZSBzbyBpdCByZXF1aXJlcyBhbGwgZXh0ZXJuYWwgY29udHJhY3QgYWRkcmVzc2VzCiAgICAvLy8gIHRvIGJlIHNldCBiZWZvcmUgY29udHJhY3QgY2FuIGJlIHVucGF1c2VkLiBBbHNvLCB3ZSBjYW4ndCBoYXZlCiAgICAvLy8gIG5ld0NvbnRyYWN0QWRkcmVzcyBzZXQgZWl0aGVyLCBiZWNhdXNlIHRoZW4gdGhlIGNvbnRyYWN0IHdhcyB1cGdyYWRlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIHdlIGNhbiBjYWxsIHN1cGVyLnVucGF1c2UKICAgIC8vLyAgd2l0aG91dCB1c2luZyBhbiBleHBlbnNpdmUgQ0FMTC4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHNhbGVBdWN0aW9uICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoc2lyaW5nQXVjdGlvbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGdlbmVTY2llbmNlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CgogICAgLy8gQGRldiBBbGxvd3MgdGhlIENGTyB0byBjYXB0dXJlIHRoZSBiYWxhbmNlIGF2YWlsYWJsZSB0byB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgLy8gU3VidHJhY3QgYWxsIHRoZSBjdXJyZW50bHkgcHJlZ25hbnQgbW9uc3RlcnMgd2UgaGF2ZSwgcGx1cyAxIG9mIG1hcmdpbi4KICAgICAgICB1aW50MjU2IHN1YnRyYWN0RmVlcyA9IChwcmVnbmFudE1vbnN0ZXJzICsgMSkgKiBhdXRvQmlydGhGZWU7CgogICAgICAgIGlmIChiYWxhbmNlID4gc3VidHJhY3RGZWVzKSB7CiAgICAgICAgICAgIGNmb0FkZHJlc3Muc2VuZChiYWxhbmNlIC0gc3VidHJhY3RGZWVzKTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
