Class {
	#name : #SRT4c13184721de2d1b47a8875775ba3ce0b2e00ee0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4c13184721de2d1b47a8875775ba3ce0b2e00ee0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIEhlbHBzIGNvbnRyYWN0cyBndWFyZCBhZ2FpbnMgcmVudHJhbmN5IGF0dGFja3MuCiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIxODZhN2Q3NTdiNzc1ODJhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPs+ALmNvbT4KICogQG5vdGljZSBJZiB5b3UgbWFyayBhIGZ1bmN0aW9uIGBub25SZWVudHJhbnRgLCB5b3Ugc2hvdWxkIGFsc28KICogbWFyayBpdCBgZXh0ZXJuYWxgLgogKi8KY29udHJhY3QgUmVlbnRyYW5jeUd1YXJkIHsKCiAgLyoqCiAgICogQGRldiBXZSB1c2UgYSBzaW5nbGUgbG9jayBmb3IgdGhlIHdob2xlIGNvbnRyYWN0LgogICAqLwogIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IFByZXZlbnRzIGEgY29udHJhY3QgZnJvbSBjYWxsaW5nIGl0c2VsZiwgZGlyZWN0bHkgb3IgaW5kaXJlY3RseS4KICAgKiBAbm90aWNlIElmIHlvdSBtYXJrIGEgZnVuY3Rpb24gYG5vblJlZW50cmFudGAsIHlvdSBzaG91bGQgYWxzbwogICAqIG1hcmsgaXQgYGV4dGVybmFsYC4gQ2FsbGluZyBvbmUgbm9uUmVlbnRyYW50IGZ1bmN0aW9uIGZyb20KICAgKiBhbm90aGVyIGlzIG5vdCBzdXBwb3J0ZWQuIEluc3RlYWQsIHlvdSBjYW4gaW1wbGVtZW50IGEKICAgKiBgcHJpdmF0ZWAgZnVuY3Rpb24gZG9pbmcgdGhlIGFjdHVhbCB3b3JrLCBhbmQgYSBgZXh0ZXJuYWxgCiAgICogd3JhcHBlciBtYXJrZWQgYXMgYG5vblJlZW50cmFudGAuCiAgICovCiAgbW9kaWZpZXIgbm9uUmVlbnRyYW50KCkgewogICAgcmVxdWlyZSghcmVudHJhbmN5X2xvY2spOwogICAgcmVudHJhbmN5X2xvY2sgPSB0cnVlOwogICAgXzsKICAgIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKLy8gTWluaW1hbCBCaXRjb2luZXVtIGludGVyZmFjZSBmb3IgcHJveHkgbWluaW5nCmNvbnRyYWN0IEJpdGNvaW5ldW1JbnRlcmZhY2UgewogICBmdW5jdGlvbiBtaW5lKCkgcGF5YWJsZTsKICAgZnVuY3Rpb24gY2xhaW0odWludDI1NiBfYmxvY2tOdW1iZXIsIGFkZHJlc3MgZm9yQ3JlZGl0VG8pOwogICBmdW5jdGlvbiBjaGVja01pbmluZ0F0dGVtcHQodWludDI1NiBfYmxvY2tOdW0sIGFkZHJlc3MgX3NlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpOwogICBmdW5jdGlvbiBjaGVja1dpbm5pbmcodWludDI1NiBfYmxvY2tOdW0pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKTsKICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICBmdW5jdGlvbiBjdXJyZW50RGlmZmljdWx0eVdlaSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICAgfQoKLy8gU2hhcmtwb29sIGlzIGEgcm9sbGluZyB3aW5kb3cgQml0Y29pbmV1bSBtaW5lcgovLyBTbWFydCBjb250cmFjdCBiYXNlZCB2aXJ0dWFsIG1pbmluZwovLyBodHRwOi8vd3d3LmJpdGNvaW5ldW0uY29tLwoKY29udHJhY3QgU2hhcmtQb29sIGlzIE93bmFibGUsIFJlZW50cmFuY3lHdWFyZCB7CgogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBwb29sX25hbWUgPSAiU2hhcmtQb29sIDIwMCI7CgogICAgLy8gUGVyY2VudGFnZSBvZiBCVEUgcG9vbCB0YWtlcyBmb3Igb3BlcmF0aW9ucwogICAgdWludDI1NiBwdWJsaWMgcG9vbF9wZXJjZW50YWdlID0gNTsKCiAgICAvLyBMaW1pdGluZyB1c2VycyBiZWNhdXNlIG9mIGdhcyBsaW1pdHMKICAgIC8vIEkgd291bGQgbm90IGluY3JlYXNlIHRoaXMgdmFsdWUgaXQgY291bGQgbWFrZSB0aGUgcG9vbCB1bnN0YWJsZQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgbWF4X3VzZXJzID0gMTAwOwoKICAgIC8vIFRyYWNrIHRvdGFsIHVzZXJzIHRvIHN3aXRjaCB0byBkZWdyYWRlZCBjYXNlIHdoZW4gY29udHJhY3QgaXMgZnVsbAogICAgdWludDI1NiBwdWJsaWMgdG90YWxfdXNlcnMgPSAwOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRpdmlzaWJsZV91bml0cyA9IDEwMDAwMDAwOwoKICAgIC8vIEhvdyBsb25nIHdpbGwgYSBwYXltZW50IGV2ZW50IG1pbmUgYmxvY2tzIGZvciB5b3UKICAgIHVpbnQyNTYgcHVibGljIGNvbnRyYWN0X3BlcmlvZCA9IDEwMDsKICAgIHVpbnQyNTYgcHVibGljIG1pbmVkX2Jsb2NrcyA9IDE7CiAgICB1aW50MjU2IHB1YmxpYyBjbGFpbWVkX2Jsb2NrcyA9IDE7CiAgICB1aW50MjU2IHB1YmxpYyBibG9ja0NyZWF0aW9uUmF0ZSA9IDA7CgogICAgQml0Y29pbmV1bUludGVyZmFjZSBiYXNlX2NvbnRyYWN0OwoKICAgIHN0cnVjdCB1c2VyIHsKICAgICAgICB1aW50MjU2IHN0YXJ0X2Jsb2NrOwogICAgICAgIHVpbnQyNTYgZW5kX2Jsb2NrOwogICAgICAgIHVpbnQyNTYgcHJvcG9ydGlvbmFsX2NvbnRyaWJ1dGlvbjsKICAgIH0KCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVzZXIpIHB1YmxpYyB1c2VyczsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIGF0dGVtcHRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgdWludDhbXSBzbG90czsKICAgIGFkZHJlc3NbMjU2XSBwdWJsaWMgYWN0aXZlX3VzZXJzOyAvLyBTaG91bGQgZXF1YWwgbWF4X3VzZXJzCgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gc2V0X3Bvb2xfcGVyY2VudGFnZSh1aW50OCBfcGVyY2VudGFnZSkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IG9ubHlPd25lciB7CiAgICAgICAvLyBKdXN0IGluIGNhc2Ugb3duZXIgaXMgY29tcHJvbWlzZWQKICAgICAgIHJlcXVpcmUoX3BlcmNlbnRhZ2UgPCAxMSk7CiAgICAgICBwb29sX3BlcmNlbnRhZ2UgPSBfcGVyY2VudGFnZTsKICAgIH0KCgogICAgZnVuY3Rpb24gZmluZF9jb250cmlidXRpb24oYWRkcmVzcyBfd2hvKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgIGlmICh1c2Vyc1tfd2hvXS5zdGFydF9ibG9jayA+IDApIHsKICAgICAgICAgdXNlciBtZW1vcnkgdSA9IHVzZXJzW193aG9dOwogICAgICAgICB1aW50MjU2IHJlbWFpbmluZ19wZXJpb2Q9IDA7CiAgICAgICAgIGlmICh1LmVuZF9ibG9jayA+IG1pbmVkX2Jsb2NrcykgewogICAgICAgICAgICByZW1haW5pbmdfcGVyaW9kID0gdS5lbmRfYmxvY2sgLSBtaW5lZF9ibG9ja3M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlbWFpbmluZ19wZXJpb2QgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgIHJldHVybiAodS5zdGFydF9ibG9jaywgdS5lbmRfYmxvY2ssCiAgICAgICAgICAgICAgICAgdS5wcm9wb3J0aW9uYWxfY29udHJpYnV0aW9uLAogICAgICAgICAgICAgICAgIHUucHJvcG9ydGlvbmFsX2NvbnRyaWJ1dGlvbiAqIGNvbnRyYWN0X3BlcmlvZCwKICAgICAgICAgICAgICAgICB1LnByb3BvcnRpb25hbF9jb250cmlidXRpb24gKiByZW1haW5pbmdfcGVyaW9kKTsKICAgICAgfQogICAgICByZXR1cm4gKDAsMCwwLDAsMCk7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb2NhdGVfc2xvdChhZGRyZXNzIF93aG8pIGludGVybmFsIHsKICAgICAgIGlmKHRvdGFsX3VzZXJzIDwgbWF4X3VzZXJzKSB7IAogICAgICAgICAgICAvLyBKdXN0IHB1c2ggaW50byBhY3RpdmVfdXNlcnMKICAgICAgICAgICAgYWN0aXZlX3VzZXJzW3RvdGFsX3VzZXJzXSA9IF93aG87CiAgICAgICAgICAgIHRvdGFsX3VzZXJzICs9IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBUaGUgbWF4aW11bSB1c2VycyBoYXZlIGJlZW4gcmVhY2hlZCwgY2FuIHdlIGFsbG9jYXRlIGEgZnJlZSBzcGFjZT8KICAgICAgICAgICAgaWYgKHNsb3RzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBUaGVyZSBpc24ndCBhbnkgcm9vbSBsZWZ0CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgdWludDggbG9jYXRpb24gPSBzbG90c1tzbG90cy5sZW5ndGgtMV07CiAgICAgICAgICAgICAgIGFjdGl2ZV91c2Vyc1tsb2NhdGlvbl0gPSBfd2hvOwogICAgICAgICAgICAgICBkZWxldGUgc2xvdHNbc2xvdHMubGVuZ3RoLTFdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICB9CgogICAgIGZ1bmN0aW9uIGV4dGVybmFsX3RvX2ludGVybmFsX2Jsb2NrX251bWJlcih1aW50MjU2IF9leHRlcm5hbEJsb2NrTnVtKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGJsb2NrQ3JlYXRpb25SYXRlIGlzID4gMAogICAgICAgIHJldHVybiBfZXh0ZXJuYWxCbG9ja051bSAvIGJsb2NrQ3JlYXRpb25SYXRlOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYXZhaWxhYmxlX3Nsb3RzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAodG90YWxfdXNlcnMgPCBtYXhfdXNlcnMpIHsKICAgICAgICAgICAgcmV0dXJuIG1heF91c2VycyAtIHRvdGFsX3VzZXJzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gc2xvdHMubGVuZ3RoOwogICAgICAgIH0KICAgICB9CiAgCiAgIGV2ZW50IExvZ0V2ZW50KAogICAgICAgdWludDI1NiBfaW5mbwogICApOwoKICAgIGZ1bmN0aW9uIGdldF9iaXRjb2luZXVtX2NvbnRyYWN0X2FkZHJlc3MoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgcmV0dXJuIDB4NzNkRDA2OWMyOTlBNWQ2OTFFOTgzNjI0M0JjYWVDOWM4QzFEODczNDsgLy8gUHJvZHVjdGlvbgogICAgCiAgICAgICAvLyByZXR1cm4gMHg3ZTdhMjk5ZGEzNGEzNTBkMDRkMjA0Y2Q4MGFiNTFkMDY4YWQ1MzBmOyAvLyBUZXN0aW5nCiAgICB9CgogICAgLy8gaXRlcmF0ZSBvdmVyIGFsbCBhY2NvdW50IGhvbGRlcnMKICAgIC8vIGFuZCBiYWxhbmNlIHRyYW5zZmVyIHByb3BvcnRpb25hbCBidGUKICAgIC8vIGJhbGFuY2Ugc2hvdWxkIGJlIDAgYWZ0d2FyZHMgaW4gYSBwZXJmZWN0IHdvcmxkCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlX3Jld2FyZCh1aW50MjU2IF90b3RhbEF0dGVtcHQsIHVpbnQyNTYgX2JhbGFuY2UpIGludGVybmFsIHsKICAgICAgdWludDI1NiByZW1haW5pbmdfYmFsYW5jZSA9IF9iYWxhbmNlOwogICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgdG90YWxfdXNlcnM7IGkrKykgewogICAgICAgICAgYWRkcmVzcyB1c2VyX2FkZHJlc3MgPSBhY3RpdmVfdXNlcnNbaV07CiAgICAgICAgICBpZiAodXNlcl9hZGRyZXNzID4gMCAmJiByZW1haW5pbmdfYmFsYW5jZSAhPSAwKSB7CiAgICAgICAgICAgICAgdWludDI1NiBwcm9wb3J0aW9uID0gdXNlcnNbdXNlcl9hZGRyZXNzXS5wcm9wb3J0aW9uYWxfY29udHJpYnV0aW9uOwogICAgICAgICAgICAgIHVpbnQyNTYgZGl2aWRlZF9wb3J0aW9uID0gKHByb3BvcnRpb24gKiBkaXZpc2libGVfdW5pdHMpIC8gX3RvdGFsQXR0ZW1wdDsKICAgICAgICAgICAgICB1aW50MjU2IHBheW91dCA9IChfYmFsYW5jZSAqIGRpdmlkZWRfcG9ydGlvbikgLyBkaXZpc2libGVfdW5pdHM7CiAgICAgICAgICAgICAgaWYgKHBheW91dCA+IHJlbWFpbmluZ19iYWxhbmNlKSB7CiAgICAgICAgICAgICAgICAgcGF5b3V0ID0gcmVtYWluaW5nX2JhbGFuY2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJhbGFuY2VzW3VzZXJfYWRkcmVzc10gPSBiYWxhbmNlc1t1c2VyX2FkZHJlc3NdICsgcGF5b3V0OwogICAgICAgICAgICAgIHJlbWFpbmluZ19iYWxhbmNlID0gcmVtYWluaW5nX2JhbGFuY2UgLSBwYXlvdXQ7CiAgICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBTaGFya1Bvb2woKSB7CiAgICAgIGJsb2NrQ3JlYXRpb25SYXRlID0gNTA7IC8vIG1hdGNoIGJ0ZQogICAgICBiYXNlX2NvbnRyYWN0ID0gQml0Y29pbmV1bUludGVyZmFjZShnZXRfYml0Y29pbmV1bV9jb250cmFjdF9hZGRyZXNzKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGN1cnJlbnRfZXh0ZXJuYWxfYmxvY2soKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBibG9jay5udW1iZXI7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZV9taW5pbXVtX2NvbnRyaWJ1dGlvbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSAgewogICAgICAgcmV0dXJuIGJhc2VfY29udHJhY3QuY3VycmVudERpZmZpY3VsdHlXZWkoKSAvIDEwMDAwMDAwICogY29udHJhY3RfcGVyaW9kOwogICAgfQoKICAgIC8vIEEgZGVmYXVsdCBldGhlciB0eCB3aXRob3V0IGdhcyBzcGVjaWZpZWQgd2lsbCBmYWlsLgogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGNhbGN1bGF0ZV9taW5pbXVtX2NvbnRyaWJ1dGlvbigpKTsKCiAgICAgICAgIC8vIERpZCB0aGUgdXNlciBhbHJlYWR5IGNvbnRyaWJ1dGUKICAgICAgICAgdXNlciBzdG9yYWdlIGN1cnJlbnRfdXNlciA9IHVzZXJzW21zZy5zZW5kZXJdOwoKICAgICAgICAgLy8gRG9lcyB1c2VyIGV4aXN0IGFscmVhZHkKICAgICAgICAgaWYgKGN1cnJlbnRfdXNlci5zdGFydF9ibG9jayA+IDApIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRfdXNlci5lbmRfYmxvY2sgPiBtaW5lZF9ibG9ja3MpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgcGVyaW9kc19sZWZ0ID0gY3VycmVudF91c2VyLmVuZF9ibG9jayAtIG1pbmVkX2Jsb2NrczsKICAgICAgICAgICAgICAgIHVpbnQyNTYgYW1vdW50X3JlbWFpbmluZyA9IGN1cnJlbnRfdXNlci5wcm9wb3J0aW9uYWxfY29udHJpYnV0aW9uICogcGVyaW9kc19sZWZ0OwogICAgICAgICAgICAgICAgYW1vdW50X3JlbWFpbmluZyA9IGFtb3VudF9yZW1haW5pbmcgKyBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICBhbW91bnRfcmVtYWluaW5nID0gYW1vdW50X3JlbWFpbmluZyAvIGNvbnRyYWN0X3BlcmlvZDsKICAgICAgICAgICAgICAgIGN1cnJlbnRfdXNlci5wcm9wb3J0aW9uYWxfY29udHJpYnV0aW9uID0gYW1vdW50X3JlbWFpbmluZzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgY3VycmVudF91c2VyLnByb3BvcnRpb25hbF9jb250cmlidXRpb24gPSBtc2cudmFsdWUgLyBjb250cmFjdF9wZXJpb2Q7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAvLyBJZiB0aGUgdXNlciBleGlzdHMgYW5kIGhhcyBhIGJhbGFuY2UgbGV0J3MgdHJhbnNmZXIgaXQgdG8gdGhlbQogICAgICAgICAgZG9fcmVkZW1wdGlvbigpOwoKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIGN1cnJlbnRfdXNlci5wcm9wb3J0aW9uYWxfY29udHJpYnV0aW9uID0gbXNnLnZhbHVlIC8gY29udHJhY3RfcGVyaW9kOwogICAgICAgICAgICAgICBhbGxvY2F0ZV9zbG90KG1zZy5zZW5kZXIpOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudF91c2VyLnN0YXJ0X2Jsb2NrID0gbWluZWRfYmxvY2tzOwogICAgICAgICAgY3VycmVudF91c2VyLmVuZF9ibG9jayA9IG1pbmVkX2Jsb2NrcyArIGNvbnRyYWN0X3BlcmlvZDsKICAgICAgICAgfQoKICAgIAogICAgLy8gUHJveHkgbWluaW5nIHRvIHRva2VuCiAgIGZ1bmN0aW9uIG1pbmUoKSBleHRlcm5hbCBub25SZWVudHJhbnQKICAgewogICAgIC8vIERpZCBzb21lb25lIGFscmVhZHkgdHJ5IHRvIG1pbmUgdGhpcyBibG9jaz8KICAgICB1aW50MjU2IF9ibG9ja051bSA9IGV4dGVybmFsX3RvX2ludGVybmFsX2Jsb2NrX251bWJlcihjdXJyZW50X2V4dGVybmFsX2Jsb2NrKCkpOwogICAgIHJlcXVpcmUoIWJhc2VfY29udHJhY3QuY2hlY2tNaW5pbmdBdHRlbXB0KF9ibG9ja051bSwgdGhpcykpOwoKICAgICAvLyBBbHJpZ2h0IG5vYm9keSBtaW5lZCBsZXRzIGl0ZXJhdGUgb3ZlciBvdXIgYWN0aXZlX3VzZXJzCgogICAgIHVpbnQyNTYgdG90YWxfYXR0ZW1wdCA9IDA7CiAgICAgdWludDggdG90YWxfZWplY3RlZCA9IDA7IAoKICAgICBmb3IgKHVpbnQ4IGk9MDsgaSA8IHRvdGFsX3VzZXJzOyBpKyspIHsKICAgICAgICAgYWRkcmVzcyB1c2VyX2FkZHJlc3MgPSBhY3RpdmVfdXNlcnNbaV07CiAgICAgICAgIGlmICh1c2VyX2FkZHJlc3MgPiAwKSB7CiAgICAgICAgICAgICAvLyBUaGlzIHVzZXIgZXhpc3RzCiAgICAgICAgICAgICB1c2VyIG1lbW9yeSB1ID0gdXNlcnNbdXNlcl9hZGRyZXNzXTsKICAgICAgICAgICAgIGlmICh1LmVuZF9ibG9jayA8PSBtaW5lZF9ibG9ja3MpIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgdXNlciBuZWVkcyB0byBiZSBlamVjdGVkLCBubyBtb3JlIGF0dGVtcHRzIGxlZnQKICAgICAgICAgICAgICAgIC8vIGJ1dCB3ZSBsaW1pdCB0byAyMCB0byBwcmV2ZW50IGdhcyBpc3N1ZXMgb24gc2xvdCBpbnNlcnQKICAgICAgICAgICAgICAgIGlmICh0b3RhbF9lamVjdGVkIDwgMTApIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgYWN0aXZlX3VzZXJzW2ldOwogICAgICAgICAgICAgICAgICAgIHNsb3RzLnB1c2goaSk7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHVzZXJzW2FjdGl2ZV91c2Vyc1tpXV07CiAgICAgICAgICAgICAgICAgICAgdG90YWxfZWplY3RlZCA9IHRvdGFsX2VqZWN0ZWQgKyAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgLy8gVGhpcyB1c2VyIGlzIHN0aWxsIGFjdGl2ZQogICAgICAgICAgICAgICB0b3RhbF9hdHRlbXB0ID0gdG90YWxfYXR0ZW1wdCArIHUucHJvcG9ydGlvbmFsX2NvbnRyaWJ1dGlvbjsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgIH0KICAgICBpZiAodG90YWxfYXR0ZW1wdCA+IDApIHsKICAgICAgICAvLyBOb3cgd2UgaGF2ZSBhIHRvdGFsIGNvbnRyaWJ1dGlvbiBhbW91bnQKICAgICAgICBhdHRlbXB0c1tfYmxvY2tOdW1dID0gdG90YWxfYXR0ZW1wdDsKICAgICAgICBiYXNlX2NvbnRyYWN0Lm1pbmUudmFsdWUodG90YWxfYXR0ZW1wdCkoKTsKICAgICAgICBtaW5lZF9ibG9ja3MgPSBtaW5lZF9ibG9ja3MgKyAxOwogICAgIH0KICAgfQoKICAgZnVuY3Rpb24gY2xhaW0odWludDI1NiBfYmxvY2tOdW1iZXIsIGFkZHJlc3MgZm9yQ3JlZGl0VG8pCiAgICAgICAgICAgICAgICAgIG5vblJlZW50cmFudAogICAgICAgICAgICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAvLyBEaWQgd2Ugd2luIHRoZSBibG9jayBpbiBxdWVzdGlvbgogICAgICAgICAgICAgICAgICByZXF1aXJlKGJhc2VfY29udHJhY3QuY2hlY2tXaW5uaW5nKF9ibG9ja051bWJlcikpOwoKICAgICAgICAgICAgICAgICAgdWludDI1NiBpbml0aWFsX2JhbGFuY2UgPSBiYXNlX2NvbnRyYWN0LmJhbGFuY2VPZih0aGlzKTsKCiAgICAgICAgICAgICAgICAgIC8vIFdlIHdvbiBsZXQncyBnZXQgb3VyIHJld2FyZAogICAgICAgICAgICAgICAgICBiYXNlX2NvbnRyYWN0LmNsYWltKF9ibG9ja051bWJlciwgdGhpcyk7CgogICAgICAgICAgICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBiYXNlX2NvbnRyYWN0LmJhbGFuY2VPZih0aGlzKTsKICAgICAgICAgICAgICAgICAgdWludDI1NiB0b3RhbF9hdHRlbXB0ID0gYXR0ZW1wdHNbX2Jsb2NrTnVtYmVyXTsKCiAgICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGVfcmV3YXJkKHRvdGFsX2F0dGVtcHQsIGJhbGFuY2UgLSBpbml0aWFsX2JhbGFuY2UpOwogICAgICAgICAgICAgICAgICBjbGFpbWVkX2Jsb2NrcyA9IGNsYWltZWRfYmxvY2tzICsgMTsKICAgICAgICAgICAgICAgICAgfQoKICAgZnVuY3Rpb24gZG9fcmVkZW1wdGlvbigpIGludGVybmFsIHsKICAgICB1aW50MjU2IGJhbGFuY2UgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICBpZiAoYmFsYW5jZSA+IDApIHsKICAgICAgICB1aW50MjU2IG93bmVyX2N1dCA9IChiYWxhbmNlIC8gMTAwKSAqIHBvb2xfcGVyY2VudGFnZTsKICAgICAgICB1aW50MjU2IHJlbWFpbmRlciA9IGJhbGFuY2UgLSBvd25lcl9jdXQ7CiAgICAgICAgaWYgKG93bmVyX2N1dCA+IDApIHsKICAgICAgICAgICAgYmFzZV9jb250cmFjdC50cmFuc2Zlcihvd25lciwgb3duZXJfY3V0KTsKICAgICAgICB9CiAgICAgICAgYmFzZV9jb250cmFjdC50cmFuc2Zlcihtc2cuc2VuZGVyLCByZW1haW5kZXIpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgIH0KICAgfQoKICAgZnVuY3Rpb24gcmVkZWVtKCkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50CiAgICAgewogICAgICAgIGRvX3JlZGVtcHRpb24oKTsKICAgICB9CgogICBmdW5jdGlvbiBjaGVja01pbmluZ0F0dGVtcHQodWludDI1NiBfYmxvY2tOdW0sIGFkZHJlc3MgX3NlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIGJhc2VfY29udHJhY3QuY2hlY2tNaW5pbmdBdHRlbXB0KF9ibG9ja051bSwgX3NlbmRlcik7CiAgIH0KICAgCiAgIGZ1bmN0aW9uIGNoZWNrV2lubmluZyh1aW50MjU2IF9ibG9ja051bSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICByZXR1cm4gYmFzZV9jb250cmFjdC5jaGVja1dpbm5pbmcoX2Jsb2NrTnVtKTsKICAgfQoKfQ=='.
	

]
