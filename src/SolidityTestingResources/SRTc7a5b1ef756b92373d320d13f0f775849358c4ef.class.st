Class {
	#name : #SRTc7a5b1ef756b92373d320d13f0f775849358c4ef,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc7a5b1ef756b92373d320d13f0f775849358c4ef >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsKCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7Cgp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgpsaWJyYXJ5IFNhZmVNYXRoTGliIHsKCiAgZnVuY3Rpb24gdGltZXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWludXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSk7CiAgICByZXR1cm4gYzsKICB9Cgp9Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOyAgICAgIAogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMCBpcyBFUkMyMCB7CgogIHVpbnQgcHVibGljIGRlY2ltYWxzOwoKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7CgogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogU2VsZiBjaGVjayBpZiBhbGwgcmVmZXJlbmNlcyBhcmUgY29ycmVjdGx5IHNldC4KICAgKgogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4KICAgKi8KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJpY2luZyB0ZWxscyBpZiB0aGlzIGlzIGEgcHJlc2FsZSBwdXJjaGFzZSBvciBub3QuCiAgICAgQHBhcmFtIHB1cmNoYXNlciBBZGRyZXNzIG9mIHRoZSBwdXJjaGFzZXIKICAgICBAcmV0dXJuIEZhbHNlIGJ5IGRlZmF1bHQsIHRydWUgaWYgYSBwcmVzYWxlIHB1cmNoYXNlcgogICAqLwogIGZ1bmN0aW9uIGlzUHJlc2FsZVB1cmNoYXNlKGFkZHJlc3MgcHVyY2hhc2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyIGluIHRoZSBtYWluIHRva2VuIHNhbGUgLSB0aGlzIG51bWJlciBleGNsdWRlcyBwcmVzYWxlCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9Cgpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBpZiAoaGFsdGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBzdG9wTm9uT3duZXJzSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaWYgKCFoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgfQoKfQoKY29udHJhY3QgUHJlSUNPUHJveHlCdXllciBpcyBPd25hYmxlLCBIYWx0YWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qKiBIb3cgbWFueSBpbnZlc3RvcnMgd2UgaGF2ZSBub3cgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50OwoKICAvKiogSG93IG1hbnkgd2VpIHdlIGhhdmUgcmFpc2VkIHRvdGxhLiAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZDsKCiAgLyoqIFdobyBhcmUgb3VyIGludmVzdG9ycyAoaXRlcmFibGUpICovCiAgYWRkcmVzc1tdIHB1YmxpYyBpbnZlc3RvcnM7CgogIC8qKiBIb3cgbXVjaCB0aGV5IGhhdmUgaW52ZXN0ZWQgKi8KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJhbGFuY2VzOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIGludmVzdG9ycyBoYXZlIGNsYWltZWQgKi8KICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGNsYWltZWQ7CgogIC8qKiBXaGVuIG91ciByZWZ1bmQgZnJlZXplIGlzIG92ZXIgKFVOSVQgdGltZXN0YW1wKSAqLwogIHVpbnQgcHVibGljIGZyZWV6ZUVuZHNBdDsKCiAgLyoqIFdoYXQgaXMgdGhlIG1pbmltdW0gYnV5IGluICovCiAgdWludCBwdWJsaWMgd2VpTWluaW11bUxpbWl0OwoKICAvKiogV2hhdCBpcyB0aGUgbWF4aW11bSBidXkgaW4gKi8KICB1aW50IHB1YmxpYyB3ZWlNYXhpbXVtTGltaXQ7CgogIC8qKiBIb3cgbWFueSB3ZWlzIHRvdGFsIHdlIGFyZSBhbGxvd2VkIHRvIGNvbGxlY3QuICovCiAgdWludCBwdWJsaWMgd2VpQ2FwOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHdlcmUgYm91Z2h0ICovCiAgdWludCBwdWJsaWMgdG9rZW5zQm91Z2h0OwoKICAgLyoqIEhvdyBtYW55IGludmVzdG9ycyBoYXZlIGNsYWltZWQgdGhlaXIgdG9rZW5zICovCiAgdWludCBwdWJsaWMgY2xhaW1Db3VudDsKCiAgdWludCBwdWJsaWMgdG90YWxDbGFpbWVkOwoKICAvKiogSWYgdGltZUxvY2sgPiAwLCBjbGFpbWluZyBpcyBwb3NzaWJsZSBvbmx5IGFmdGVyIHRoZSB0aW1lIGhhcyBwYXNzZWQgKiovCiAgdWludCBwdWJsaWMgdGltZUxvY2s7CgogIC8qKiBUaGlzIGlzIHVzZWQgdG8gc2lnbmFsIHRoYXQgd2Ugd2FudCB0aGUgcmVmdW5kICoqLwogIGJvb2wgcHVibGljIGZvcmNlZFJlZnVuZDsKCiAgLyoqIE91ciBJQ08gY29udHJhY3Qgd2hlcmUgd2Ugd2lsbCBtb3ZlIHRoZSBmdW5kcyAqLwogIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlOwoKICAvKiogV2hhdCBpcyBvdXIgY3VycmVudCBzdGF0ZS4gKi8KICBlbnVtIFN0YXRle1Vua25vd24sIEZ1bmRpbmcsIERpc3RyaWJ1dGluZywgUmVmdW5kaW5nfQoKICAvKiogU29tZWJvZHkgbG9hZGVkIHRoZWlyIGludmVzdG1lbnQgbW9uZXkgKi8KICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsKCiAgLyoqIFJlZnVuZCBjbGFpbWVkICovCiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB2YWx1ZSk7CgogIC8qKiBXZSBleGVjdXRlZCBvdXIgYnV5ICovCiAgZXZlbnQgVG9rZW5zQm91Z2h0cyh1aW50IGNvdW50KTsKCiAgLyoqIFdlIGRpc3RyaWJ1dGVkIHRva2VucyB0byBhbiBpbnZlc3RvciAqLwogIGV2ZW50IERpc3RyaWJ1dGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgY291bnQpOwoKICAvKioKICAgKiBDcmVhdGUgcHJlc2FsZSBjb250cmFjdCB3aGVyZSBsb2NrIHVwIHBlcmlvZCBpcyBnaXZlbiBkYXlzCiAgICovCiAgZnVuY3Rpb24gUHJlSUNPUHJveHlCdXllcihhZGRyZXNzIF9vd25lciwgdWludCBfZnJlZXplRW5kc0F0LCB1aW50IF93ZWlNaW5pbXVtTGltaXQsIHVpbnQgX3dlaU1heGltdW1MaW1pdCwgdWludCBfd2VpQ2FwKSB7CgogICAgb3duZXIgPSBfb3duZXI7CgogICAgLy8gR2l2ZSBhcmd1bWVudAogICAgaWYoX2ZyZWV6ZUVuZHNBdCA9PSAwKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEdpdmUgYXJndW1lbnQKICAgIGlmKF93ZWlNaW5pbXVtTGltaXQgPT0gMCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBpZihfd2VpTWF4aW11bUxpbWl0ID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgd2VpTWluaW11bUxpbWl0ID0gX3dlaU1pbmltdW1MaW1pdDsKICAgIHdlaU1heGltdW1MaW1pdCA9IF93ZWlNYXhpbXVtTGltaXQ7CiAgICB3ZWlDYXAgPSBfd2VpQ2FwOwogICAgZnJlZXplRW5kc0F0ID0gX2ZyZWV6ZUVuZHNBdDsKICB9CgogIC8qKgogICAqIEdldCB0aGUgdG9rZW4gd2UgYXJlIGRpc3RyaWJ1dGluZy4KICAgKi8KICBmdW5jdGlvbiBnZXRUb2tlbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKEZyYWN0aW9uYWxFUkMyMCkgewogICAgaWYoYWRkcmVzcyhjcm93ZHNhbGUpID09IDApICB7CiAgICAgIHRocm93OwogICAgfQoKICAgIHJldHVybiBjcm93ZHNhbGUudG9rZW4oKTsKICB9CgogIC8qKgogICAqIFBhcnRpY2lwYXRlIHRvIGEgcHJlc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3QodWludDEyOCBjdXN0b21lcklkKSBwcml2YXRlIHsKCiAgICAvLyBDYW5ub3QgaW52ZXN0IGFueW1vcmUgdGhyb3VnaCBjcm93ZHNhbGUgd2hlbiBtb3ZpbmcgaGFzIGJlZ3VuCiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLkZ1bmRpbmcpIHRocm93OwoKICAgIGlmKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsgLy8gTm8gZW1wdHkgYnV5cwoKICAgIGFkZHJlc3MgaW52ZXN0b3IgPSBtc2cuc2VuZGVyOwoKICAgIGJvb2wgZXhpc3RpbmcgPSBiYWxhbmNlc1tpbnZlc3Rvcl0gPiAwOwoKICAgIGJhbGFuY2VzW2ludmVzdG9yXSA9IGJhbGFuY2VzW2ludmVzdG9yXS5hZGQobXNnLnZhbHVlKTsKCiAgICAvLyBOZWVkIHRvIHNhdGlzZnkgbWluaW11bSBhbmQgbWF4aW11bSBsaW1pdHMKICAgIGlmKGJhbGFuY2VzW2ludmVzdG9yXSA8IHdlaU1pbmltdW1MaW1pdCB8fCBiYWxhbmNlc1tpbnZlc3Rvcl0gPiB3ZWlNYXhpbXVtTGltaXQpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gVGhpcyBpcyBhIG5ldyBpbnZlc3RvcgogICAgaWYoIWV4aXN0aW5nKSB7CiAgICAgIGludmVzdG9ycy5wdXNoKGludmVzdG9yKTsKICAgICAgaW52ZXN0b3JDb3VudCsrOwogICAgfQoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKTsKICAgIGlmKHdlaVJhaXNlZCA+IHdlaUNhcCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBXZSB3aWxsIHVzZSB0aGUgc2FtZSBldmVudCBmb3JtIHRoZSBDcm93ZHNhbGUgZm9yIGNvbXBhdGliaWxpdHkgcmVhc29ucwogICAgLy8gZGVzcGl0ZSBub3QgaGF2aW5nIGEgdG9rZW4gYW1vdW50LgogICAgSW52ZXN0ZWQoaW52ZXN0b3IsIG1zZy52YWx1ZSwgMCwgY3VzdG9tZXJJZCk7CiAgfQoKICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBzdG9wSW5FbWVyZ2VuY3kgcGF5YWJsZSB7CiAgICBpbnZlc3QoY3VzdG9tZXJJZCk7CiAgfQoKICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgc3RvcEluRW1lcmdlbmN5IHBheWFibGUgewogICAgaW52ZXN0KDB4MCk7CiAgfQoKCiAgLyoqCiAgICogTG9hZCBmdW5kcyB0byB0aGUgY3Jvd2RzYWxlIGZvciBhbGwgaW52ZXN0b3JzLgogICAqCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlGb3JFdmVyeWJvZHkoKSBzdG9wTm9uT3duZXJzSW5FbWVyZ2VuY3kgcHVibGljIHsKCiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLkZ1bmRpbmcpIHsKICAgICAgLy8gT25seSBhbGxvdyBidXkgb25jZQogICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBDcm93ZHNhbGUgbm90IHlldCBzZXQKICAgIGlmKGFkZHJlc3MoY3Jvd2RzYWxlKSA9PSAwKSB0aHJvdzsKCiAgICAvLyBCdXkgdG9rZW5zIG9uIHRoZSBjb250cmFjdAogICAgY3Jvd2RzYWxlLmludmVzdC52YWx1ZSh3ZWlSYWlzZWQpKGFkZHJlc3ModGhpcykpOwoKICAgIC8vIFJlY29yZCBob3cgbWFueSB0b2tlbnMgd2UgZ290CiAgICB0b2tlbnNCb3VnaHQgPSBnZXRUb2tlbigpLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKCiAgICBpZih0b2tlbnNCb3VnaHQgPT0gMCkgewogICAgICAvLyBEaWQgbm90IGdldCBhbnkgdG9rZW5zCiAgICAgIHRocm93OwogICAgfQoKICAgIFRva2Vuc0JvdWdodHModG9rZW5zQm91Z2h0KTsKICB9CgogIC8qKgogICAqIEhvdyBtYXkgdG9rZW5zIGVhY2ggaW52ZXN0b3IgZ2V0cy4KICAgKi8KICBmdW5jdGlvbiBnZXRDbGFpbUFtb3VudChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewoKICAgIC8vIENsYWltcyBjYW4gYmUgb25seSBtYWRlIGlmIHdlIG1hbmFnZSB0byBidXkgdG9rZW5zCiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLkRpc3RyaWJ1dGluZykgewogICAgICB0aHJvdzsKICAgIH0KICAgIHJldHVybiBiYWxhbmNlc1tpbnZlc3Rvcl0ubXVsKHRva2Vuc0JvdWdodCkgLyB3ZWlSYWlzZWQ7CiAgfQoKICAvKioKICAgKiBIb3cgbWFueSB0b2tlbnMgcmVtYWluIHVuY2xhaW1lZCBmb3IgYW4gaW52ZXN0b3IuCiAgICovCiAgZnVuY3Rpb24gZ2V0Q2xhaW1MZWZ0KGFkZHJlc3MgaW52ZXN0b3IpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZ2V0Q2xhaW1BbW91bnQoaW52ZXN0b3IpLnN1YihjbGFpbWVkW2ludmVzdG9yXSk7CiAgfQoKICAvKioKICAgKiBDbGFpbSBhbGwgcmVtYWluaW5nIHRva2VucyBmb3IgdGhpcyBpbnZlc3Rvci4KICAgKi8KICBmdW5jdGlvbiBjbGFpbUFsbCgpIHsKICAgIGNsYWltKGdldENsYWltTGVmdChtc2cuc2VuZGVyKSk7CiAgfQoKICAvKioKICAgKiBDbGFpbSBOIGJvdWdodCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGFzIHRoZSBtc2cgc2VuZGVyLgogICAqCiAgICovCiAgZnVuY3Rpb24gY2xhaW0odWludCBhbW91bnQpIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlIChub3cgPiB0aW1lTG9jayk7CgogICAgYWRkcmVzcyBpbnZlc3RvciA9IG1zZy5zZW5kZXI7CgogICAgaWYoYW1vdW50ID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoZ2V0Q2xhaW1MZWZ0KGludmVzdG9yKSA8IGFtb3VudCkgewogICAgICAvLyBXb29wcyB3ZSBjYW5ub3QgZ2V0IG1vcmUgdGhhbiB3ZSBoYXZlIGxlZnQKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gV2UgdHJhY2sgd2hvIG1hbnkgaW52ZXN0b3IgaGF2ZSAocGFydGlhbGx5KSBjbGFpbWVkIHRoZWlyIHRva2VucwogICAgaWYoY2xhaW1lZFtpbnZlc3Rvcl0gPT0gMCkgewogICAgICBjbGFpbUNvdW50Kys7CiAgICB9CgogICAgY2xhaW1lZFtpbnZlc3Rvcl0gPSBjbGFpbWVkW2ludmVzdG9yXS5hZGQoYW1vdW50KTsKICAgIHRvdGFsQ2xhaW1lZCA9IHRvdGFsQ2xhaW1lZC5hZGQoYW1vdW50KTsKICAgIGdldFRva2VuKCkudHJhbnNmZXIoaW52ZXN0b3IsIGFtb3VudCk7CgogICAgRGlzdHJpYnV0ZWQoaW52ZXN0b3IsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBJQ08gbmV2ZXIgaGFwcGVuZWQuIEFsbG93IHJlZnVuZC4KICAgKi8KICBmdW5jdGlvbiByZWZ1bmQoKSBzdG9wSW5FbWVyZ2VuY3kgewoKICAgIC8vIFRyeWluZyB0byBhc2sgcmVmdW5kIHRvbyBzb29uCiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLlJlZnVuZGluZykgdGhyb3c7CgogICAgYWRkcmVzcyBpbnZlc3RvciA9IG1zZy5zZW5kZXI7CiAgICBpZihiYWxhbmNlc1tpbnZlc3Rvcl0gPT0gMCkgdGhyb3c7CiAgICB1aW50IGFtb3VudCA9IGJhbGFuY2VzW2ludmVzdG9yXTsKICAgIGRlbGV0ZSBiYWxhbmNlc1tpbnZlc3Rvcl07CiAgICBpZighKGludmVzdG9yLmNhbGwudmFsdWUoYW1vdW50KSgpKSkgdGhyb3c7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgYW1vdW50KTsKICB9CgogIC8qKgogICAqIFNldCB0aGUgdGFyZ2V0IGNyb3dkc2FsZSB3aGVyZSB3ZSB3aWxsIG1vdmUgcHJlc2FsZSBmdW5kcyB3aGVuIHRoZSBjcm93ZHNhbGUgb3BlbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlKENyb3dkc2FsZSBfY3Jvd2RzYWxlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CgogICAgLy8gQ2hlY2sgaW50ZXJmYWNlCiAgICBpZighY3Jvd2RzYWxlLmlzQ3Jvd2RzYWxlKCkpIHRydWU7CiAgfQoKICAvLy8gQGRldiBTZXR0aW5nIHRpbWVsb2NrIChkZWxheSkgZm9yIGNsYWltaW5nCiAgLy8vIEBwYXJhbSBfdGltZUxvY2sgVGltZSBhZnRlciB3aGljaCBjbGFpbWluZyBpcyBwb3NzaWJsZQogIGZ1bmN0aW9uIHNldFRpbWVMb2NrKHVpbnQgX3RpbWVMb2NrKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHRpbWVMb2NrID0gX3RpbWVMb2NrOwogIH0KCiAgLy8vIEBkZXYgVGhpcyBpcyB1c2VkIGluIHRoZSBmaXJzdCBjYXNlIHNjZW5hcmlvLCB0aGlzIHdpbGwgZm9yY2UgdGhlIHN0YXRlCiAgLy8vICAgICAgdG8gcmVmdW5kaW5nLiBUaGlzIGNhbiBiZSBhbHNvIHVzZWQgd2hlbiB0aGUgSUNPIGZhaWxzIHRvIG1lZXQgdGhlIGNhcC4KICBmdW5jdGlvbiBmb3JjZVJlZnVuZCgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgZm9yY2VkUmVmdW5kID0gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFRoaXMgc2hvdWxkIGJlIHVzZWQgaWYgdGhlIENyb3dkc2FsZSBmYWlscywgdG8gcmVjZWl2ZSB0aGUgcmVmdWxkIG1vbmV5LgogIC8vLyAgICAgIHdlIGNhbid0IHVzZSBDcm93ZHNhbGUncyByZWZ1bmQsIHNpbmNlIG91ciBkZWZhdWx0IGZ1bmN0aW9uIGRvZXMgbm90CiAgLy8vICAgICAgYWNjZXB0IG1vbmV5IGluLgogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihnZXRTdGF0ZSgpICE9IFN0YXRlLlJlZnVuZGluZykgdGhyb3c7CiAgfQoKICAvKioKICAgKiBSZXNvbHZlIHRoZSBjb250cmFjdCB1bWFtYmlnaW91cyBzdGF0ZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyByZXR1cm5zKFN0YXRlKSB7CiAgICBpZiAoZm9yY2VkUmVmdW5kKQogICAgICByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwoKICAgIGlmKHRva2Vuc0JvdWdodCA9PSAwKSB7CiAgICAgIGlmKG5vdyA+PSBmcmVlemVFbmRzQXQpIHsKICAgICAgICAgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIFN0YXRlLkRpc3RyaWJ1dGluZzsKICAgIH0KICB9CgogIC8qKiBJbnRlcmZhY2UgbWFya2VyLiAqLwogIGZ1bmN0aW9uIGlzUHJlc2FsZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBFeHBsaWNpdGx5IGNhbGwgZnVuY3Rpb24gZnJvbSB5b3VyIHdhbGxldC4gKi8KICBmdW5jdGlvbigpIHBheWFibGUgewogICAgdGhyb3c7CiAgfQp9Cgpjb250cmFjdCBDcm93ZHNhbGVCYXNlIGlzIEhhbHRhYmxlIHsKCiAgLyogTWF4IGludmVzdG1lbnQgY291bnQgd2hlbiB3ZSBhcmUgc3RpbGwgYWxsb3dlZCB0byBjaGFuZ2UgdGhlIG11bHRpc2lnIGFkZHJlc3MgKi8KICB1aW50IHB1YmxpYyBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSA9IDU7CgogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50OwoKICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOwoKICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLwogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5OwoKICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50OwoKICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7CgogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBlbmRzQXQ7CgogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwoKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogIC8qIENhbGN1bGF0ZSBpbmNvbWluZyBmdW5kcyBmcm9tIHByZXNhbGUgY29udHJhY3RzIGFuZCBhZGRyZXNzZXMgKi8KICB1aW50IHB1YmxpYyBwcmVzYWxlV2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovCiAgdWludCBwdWJsaWMgd2VpUmVmdW5kZWQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CgogIC8qKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwoKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2FsIG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7CgogIC8qKiBUaGlzIGlzIGZvciBtYW51bCB0ZXN0aW5nIGZvciB0aGUgaW50ZXJhY3Rpb24gZnJvbSBvd25lciB3YWxsZXQuIFlvdSBjYW4gc2V0IGl0IHRvIGFueSB2YWx1ZSBhbmQgaW5zcGVjdCB0aGlzIGluIGJsb2NrY2hhaW4gZXhwbG9yZXIgdG8gc2VlIHRoYXQgY3Jvd2RzYWxlIGludGVyYWN0aW9uIHdvcmtzLiAqLwogIHVpbnQgcHVibGljIG93bmVyVGVzdFZhbHVlOwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldAogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcGFzc2VkIHN0YXJ0IHRpbWUgeWV0CiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlCiAgICogLSBTdWNjZXNzOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCByZWFjaGVkCiAgICogLSBGYWlsdXJlOiBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBub3QgcmVhY2hlZCBiZWZvcmUgZW5kaW5nIHRpbWUKICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplZCBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkCiAgICogLSBSZWZ1bmRpbmc6IFJlZnVuZHMgYXJlIGxvYWRlZCBvbiB0aGUgY29udHJhY3QgZm9yIHJlY2xhaW0uCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVwYXJpbmcsIFByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmUsIEZpbmFsaXplZCwgUmVmdW5kaW5nfQoKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CgogIC8vIFJlZnVuZCB3YXMgcHJvY2Vzc2VkIGZvciBhIGNvbnRyaWJ1dG9yCiAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50KTsKCiAgLy8gVGhlIHJ1bGVzIHdlcmUgY2hhbmdlZCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0CiAgZXZlbnQgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQoYm9vbCBuZXdSZXF1aXJlQ3VzdG9tZXJJZCwgYm9vbCBuZXdSZXF1aXJlZFNpZ25lZEFkZHJlc3MsIGFkZHJlc3MgbmV3U2lnbmVyQWRkcmVzcyk7CgogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKCiAgLy8gQ3Jvd2RzYWxlIGVuZCB0aW1lIGhhcyBiZWVuIGNoYW5nZWQKICBldmVudCBFbmRzQXRDaGFuZ2VkKHVpbnQgbmV3RW5kc0F0KTsKCiAgU3RhdGUgcHVibGljIHRlc3RTdGF0ZTsKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlQmFzZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsKCiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsKCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CgogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7CiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoX3N0YXJ0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBzdGFydHNBdCA9IF9zdGFydDsKCiAgICBpZihfZW5kID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBlbmRzQXQgPSBfZW5kOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybwogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUnCiAgICoKICAgKiBAcmV0dXJuIHRva2VuQW1vdW50IEhvdyBtb255IHRva2VucyB3ZXJlIGJvdWdodAogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IGludGVybmFsIHJldHVybnModWludCB0b2tlbnNCb3VnaHQpIHsKCiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgaWYoIWVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbcmVjZWl2ZXJdKSB7CiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgIH0gZWxzZSBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpIHsKICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nCiAgICAgIC8vIHBhc3MKICAgIH0gZWxzZSB7CiAgICAgIC8vIFVud2FudGVkIHN0YXRlCiAgICAgIHRocm93OwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgIC8vIEFjY291bnQgcHJlc2FsZSBzYWxlcyBzZXBhcmF0ZWx5LCBzbyB0aGF0IHRoZXkgZG8gbm90IGNvdW50IGFnYWluc3QgcHJpY2luZyB0cmFuY2hlcwogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCAtIHByZXNhbGVXZWlSYWlzZWQsIHRva2Vuc1NvbGQsIG1zZy5zZW5kZXIsIHRva2VuLmRlY2ltYWxzKCkpOwoKICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgaWYocHJpY2luZ1N0cmF0ZWd5LmlzUHJlc2FsZVB1cmNoYXNlKHJlY2VpdmVyKSkgewogICAgICAgIHByZXNhbGVXZWlSYWlzZWQgPSBwcmVzYWxlV2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIH0KCiAgICAvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwCiAgICByZXF1aXJlKCFpc0JyZWFraW5nQ2FwKHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCkpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXksIG9yIGZhaWwgdGhlIGNyb3dkc2FsZSBpZiB3ZSBmb3Igc29tZSByZWFzb24gY2Fubm90IHNlbmQgdGhlIG1vbmV5IHRvIG91ciBtdWx0aXNpZwogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7CgogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCBjdXN0b21lcklkKTsKCiAgICByZXR1cm4gdG9rZW5BbW91bnQ7CiAgfQoKICAvKioKICAgKiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLgogICAqCiAgICogVGhlIG93bmVyIGNhbiB0cmlnZ3JlIGEgY2FsbCB0aGUgY29udHJhY3QgdGhhdCBwcm92aWRlcyBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CgogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQKICAgIGlmKGZpbmFsaXplZCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBGaW5hbGl6aW5nIGlzIG9wdGlvbmFsLiBXZSBvbmx5IGNhbGwgaXQgaWYgd2UgYXJlIGdpdmVuIGEgZmluYWxpemluZyBhZ2VudC4KICAgIGlmKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgIT0gMCkgewogICAgICBmaW5hbGl6ZUFnZW50LmZpbmFsaXplQ3Jvd2RzYWxlKCk7CiAgICB9CgogICAgZmluYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgZmluYWxpemUgYWdlbnQuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsKICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOwoKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighZmluYWxpemVBZ2VudC5pc0ZpbmFsaXplQWdlbnQoKSkgewogICAgICB0aHJvdzsKICAgIH0KICB9CgogIC8qKgogICAqIEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjbG9zZSBlYXJseSBvciBleHRlbmQgdGhlIGNyb3dkc2FsZS4KICAgKgogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOgogICAqIC0gYWZ0ZXIgWCBhbW91bnQgaXMgcmVhY2hlZCBkZXRlcm1pbmUgbWFudWFsIGNsb3NpbmcKICAgKgogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsCiAgICogYnV0IHdlIHRydXN0IG93bmVycyBrbm93IHdoYXQgdGhleSBhcmUgZG9pbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRFbmRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgewoKICAgIGlmKG5vdyA+IHRpbWUpIHsKICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0CiAgICB9CgogICAgaWYoc3RhcnRzQXQgPiB0aW1lKSB7CiAgICAgIHRocm93OyAvLyBQcmV2ZW50IGh1bWFuIG1pc3Rha2VzCiAgICB9CgogICAgZW5kc0F0ID0gdGltZTsKICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcmljaW5nU3RyYXRlZ3koUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3kpIG9ubHlPd25lciB7CiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5OwoKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuCiAgICoKICAgKiBUaGlzIGFsbG93cyB0byBzYXZlIGEgZGVwbG95ZWQgY3Jvd2RzYWxlIHdhbGxldCBpbiB0aGUgY2FzZSB0aGUgY3Jvd2RzYWxlIGhhcyBub3QgeWV0IGJlZ3VuCiAgICogKHdlIGhhdmUgZG9uZSBvbmx5IGZldyB0ZXN0IHRyYW5zYWN0aW9ucykuIEFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgZ29pbmcKICAgKiB0aGVuIG11bHRpc2lnIGFkZHJlc3Mgc3RheXMgbG9ja2VkIGZvciB0aGUgc2FmZXR5IHJlYXNvbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICAvLyBDaGFuZ2UKICAgIGlmKGludmVzdG9yQ291bnQgPiBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuCiAgICoKICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4KICAgKi8KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7CiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQucGx1cyhtc2cudmFsdWUpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuCiAgICoKICAgKiBOb3RlIHRoYXQgYW55IHJlZnVuZHMgZnJvbSBwcm94eSBidXllcnMgc2hvdWxkIGJlIGhhbmRsZWQgc2VwYXJhdGVseSwKICAgKiBhbmQgbm90IHRocm91Z2ggdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsKICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOwogICAgaWYgKHdlaVZhbHVlID09IDApIHRocm93OwogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7CiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOwogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsKICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHdlaVZhbHVlKSkgdGhyb3c7CiAgfQoKICAvKioKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4KICAgKi8KICBmdW5jdGlvbiBpc0ZpbmFsaXplclNhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7CiAgICByZXR1cm4gZmluYWxpemVBZ2VudC5pc1NhbmUoKTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4KICAgKi8KICBmdW5jdGlvbiBpc1ByaWNpbmdTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgewogICAgcmV0dXJuIHByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSk7CiAgfQoKICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CgogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsKICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYWRkcmVzc2VzIHRvIGRvIGVhcmx5IHBhcnRpY2lwYXRpb24uCiAgICoKICAgKiBUT0RPOiBGaXggc3BlbGxpbmcgZXJyb3IgaW4gdGhlIG5hbWUKICAgKi8KICBmdW5jdGlvbiBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgb25seU93bmVyIHsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBzdGF0dXM7CiAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMpOwogIH0KCgogIC8qKiBJbnRlcmZhY2UgbWFya2VyLiAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8KICAvLyBNb2RpZmllcnMKICAvLwoKICAvKiogTW9kaWZpZWQgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgdGhyb3c7CiAgICBfOwogIH0KCgogIC8vCiAgLy8gQWJzdHJhY3QgZnVuY3Rpb25zCiAgLy8KCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgaW52ZXN0ZWQgYnJlYWtzIG91ciBjYXAgcnVsZXMuCiAgICoKICAgKgogICAqIFRoZSBjaGlsZCBjb250cmFjdCBtdXN0IGRlZmluZSB0aGVpciBvd24gY2FwIHNldHRpbmcgcnVsZXMuCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLgogICAqCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB3ZWlSYWlzZWRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCByYWlzZWQgYmFsYW5jZSBhZnRlciB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGFraW5nIHRoaXMgaW52ZXN0bWVudCB3b3VsZCBicmVhayBvdXIgY2FwIHJ1bGVzCiAgICovCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgbGltaXRCcm9rZW4pOwoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgZnVsbCBhbmQgd2UgY2FuIG5vIGxvbmdlciBzZWxsIGFueSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4KICAgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgaW50ZXJuYWw7Cn0KCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBDcm93ZHNhbGVCYXNlIHsKCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIHVuaXF1ZSBjb250cmlidXRvciBpZCBmb3IgZWFjaCBjdXN0b21lciAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVDdXN0b21lcklkOwoKICAvKioKICAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLgogICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYXZlIGFjY2VwdGVkIHRlcm1zIG9uIHNhbGUgKG9uIHRoZSB3ZWIpLgogICAgKi8KICBib29sIHB1YmxpYyByZXF1aXJlZFNpZ25lZEFkZHJlc3M7CgogIC8qIFNlcnZlciBzaWRlIGFkZHJlc3MgdGhhdCBzaWduZWQgYWxsb3dlZCBjb250cmlidXRvcnMgKEV0aGVyZXVtIGFkZHJlc3NlcykgdGhhdCBjYW4gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSAqLwogIGFkZHJlc3MgcHVibGljIHNpZ25lckFkZHJlc3M7CgogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIENyb3dkc2FsZUJhc2UoX3Rva2VuLCBfcHJpY2luZ1N0cmF0ZWd5LCBfbXVsdGlzaWdXYWxsZXQsIF9zdGFydCwgX2VuZCwgX21pbmltdW1GdW5kaW5nR29hbCkgewogIH0KCiAgLyoqCiAgICogUHJlYWxsb2NhdGUgdG9rZW5zIGZvciB0aGUgZWFybHkgaW52ZXN0b3JzLgogICAqCiAgICogUHJlYWxsb2NhdGVkIHRva2VucyBoYXZlIGJlZW4gc29sZCBiZWZvcmUgdGhlIGFjdHVhbCBjcm93ZHNhbGUgb3BlbnMuCiAgICogVGhpcyBmdW5jdGlvbiBtaW50cyB0aGUgdG9rZW5zIGFuZCBtb3ZlcyB0aGUgY3Jvd2RzYWxlIG5lZWRsZS4KICAgKgogICAqIEludmVzdG9yIGNvdW50IGlzIG5vdCBoYW5kbGVkOyBpdCBpcyBhc3N1bWVkIHRoaXMgZ29lcyBmb3IgbXVsdGlwbGUgaW52ZXN0b3JzCiAgICogYW5kIHRoZSB0b2tlbiBkaXN0cmlidXRpb24gaGFwcGVucyBvdXRzaWRlIHRoZSBzbWFydCBjb250cmFjdCBmbG93LgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIGZ1bGxUb2tlbnMgdG9rZW5zIGFzIGZ1bGwgdG9rZW5zIC0gZGVjaW1hbCBwbGFjZXMgYWRkZWQgaW50ZXJuYWxseQogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBmdWxsIHRva2VuIGluIHdlaQogICAqCiAgICovCiAgZnVuY3Rpb24gcHJlYWxsb2NhdGUoYWRkcmVzcyByZWNlaXZlciwgdWludCBmdWxsVG9rZW5zLCB1aW50IHdlaVByaWNlKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICB1aW50IHRva2VuQW1vdW50ID0gZnVsbFRva2VucyAqIDEwKip0b2tlbi5kZWNpbWFscygpOwogICAgdWludCB3ZWlBbW91bnQgPSB3ZWlQcmljZSAqIGZ1bGxUb2tlbnM7IC8vIFRoaXMgY2FuIGJlIGFsc28gMCwgd2UgZ2l2ZSBvdXQgdG9rZW5zIGZvciBmcmVlCgogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwoKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIDApOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgYnl0ZXMzMiBoYXNoID0gc2hhMjU2KGFkZHIpOwogICAgIGlmIChlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgIT0gc2lnbmVyQWRkcmVzcykgdGhyb3c7CiAgICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sKICAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFRyYWNrIHdobyBpcyB0aGUgY3VzdG9tZXIgbWFraW5nIHRoZSBwYXltZW50IHNvIHdlIGNhbiBzZW5kIHRoYW5rIHlvdSBlbWFpbC4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3RXaXRoQ3VzdG9tZXJJZChhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgewogICAgaWYocmVxdWlyZWRTaWduZWRBZGRyZXNzKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIGFsbG93cyBvbmx5IHNlcnZlci1zaWRlIHNpZ25lZCBwYXJ0aWNpcGFudHMKICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIGFkZHIpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVDdXN0b21lcklkKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIG5lZWRzIHRvIHRyYWNrIHBhcnRpY2lwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgMCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyIGFuZCBjbGVhciBoaXMgYWRkcmVzcy4KICAgKgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQsIHYsIHIsIHMpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllci4KICAgKgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkV2l0aENoZWNrc3VtKHVpbnQxMjggY3VzdG9tZXJJZCwgYnl0ZXMxIGNoZWNrc3VtKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAvLyBzZWUgY3VzdG9tZXJpZC5weQogICAgaWYgKGJ5dGVzMShzaGEzKGN1c3RvbWVySWQpKSAhPSBjaGVja3N1bSkgdGhyb3c7CiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIExlZ2FjeSBBUEkgc2lnbmF0dXJlLgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdChtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgb25seU93bmVyIHsKICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBfc2lnbmVyQWRkcmVzczsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCn0='.
	

]
