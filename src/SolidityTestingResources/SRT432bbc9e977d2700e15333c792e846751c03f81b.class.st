Class {
	#name : #SRT432bbc9e977d2700e15333c792e846751c03f81b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT432bbc9e977d2700e15333c792e846751c03f81b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBOb3ZhQWNjZXNzQ29udHJvbCB7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBtYW5hZ2VyczsKICBhZGRyZXNzIHB1YmxpYyBjZm9BZGRyZXNzOwoKICBmdW5jdGlvbiBOb3ZhQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICBtYW5hZ2Vyc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgfQoKICBtb2RpZmllciBvbmx5TWFuYWdlcigpIHsKICAgIHJlcXVpcmUobWFuYWdlcnNbbXNnLnNlbmRlcl0pOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHNldE1hbmFnZXIoYWRkcmVzcyBfbmV3TWFuYWdlcikgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgcmVxdWlyZShfbmV3TWFuYWdlciAhPSBhZGRyZXNzKDApKTsKICAgIG1hbmFnZXJzW19uZXdNYW5hZ2VyXSA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiByZW1vdmVNYW5hZ2VyKGFkZHJlc3MgbWFuZ2VyQWRkcmVzcykgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgcmVxdWlyZShtYW5nZXJBZGRyZXNzICE9IG1zZy5zZW5kZXIpOwogICAgbWFuYWdlcnNbbWFuZ2VyQWRkcmVzc10gPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUNmbyhhZGRyZXNzIG5ld0Nmb0FkZHJlc3MpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIHsKICAgIHJlcXVpcmUobmV3Q2ZvQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgIGNmb0FkZHJlc3MgPSBuZXdDZm9BZGRyZXNzOwogIH0KfQoKY29udHJhY3QgTm92YUNvaW4gaXMgTm92YUFjY2Vzc0NvbnRyb2wgewogIHN0cmluZyBwdWJsaWMgbmFtZTsKICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBhZGRyZXNzIHN1cHBsaWVyOwogIC8vIDE6MSBjb252ZXJ0IHdpdGggY3VycmVuY3ksIHNvIHRvIGNlbnQKICB1aW50OCBwdWJsaWMgZGVjaW1hbHMgPSAyOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsKICBhZGRyZXNzIHB1YmxpYyBub3ZhQ29udHJhY3RBZGRyZXNzOwoKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBOb3ZhQ29pblRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CgogIGZ1bmN0aW9uIE5vdmFDb2luKHVpbnQyNTYgaW5pdGlhbFN1cHBseSwgc3RyaW5nIHRva2VuTmFtZSwgc3RyaW5nIHRva2VuU3ltYm9sKSBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSBpbml0aWFsU3VwcGx5ICogMTAgKiogdWludDI1NihkZWNpbWFscyk7CiAgICBzdXBwbGllciA9IG1zZy5zZW5kZXI7CiAgICBiYWxhbmNlT2Zbc3VwcGxpZXJdID0gdG90YWxTdXBwbHk7CiAgICBuYW1lID0gdG9rZW5OYW1lOwogICAgc3ltYm9sID0gdG9rZW5TeW1ib2w7CiAgfQoKICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKF90byAhPSAweDApOwogICAgcmVxdWlyZShiYWxhbmNlT2ZbX2Zyb21dID49IF92YWx1ZSk7CiAgICByZXF1aXJlKGJhbGFuY2VPZltfdG9dICsgX3ZhbHVlID4gYmFsYW5jZU9mW190b10pOwogICAgYmFsYW5jZU9mW19mcm9tXSAtPSBfdmFsdWU7CiAgICBiYWxhbmNlT2ZbX3RvXSArPSBfdmFsdWU7CiAgfQoKICAvLyBjdXJyZW50bHkgb25seSBwZXJtaXQgTm92YUNvbnRyYWN0IHRvIGNvbnN1bWUKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGV4dGVybmFsIHsKICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBub3ZhVHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICBfdHJhbnNmZXIoc3VwcGxpZXIsIF90bywgX3ZhbHVlKTsKICAgIE5vdmFDb2luVHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlTm92YUNvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIG5vdmFBZGRyZXNzKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICBub3ZhQ29udHJhY3RBZGRyZXNzID0gbm92YUFkZHJlc3M7CiAgfQoKICAvLyBUaGlzIGlzIGZ1bmN0aW9uIGlzIHVzZWQgZm9yIHNlbGwgTm92YSBwcm9wZXJwdHkgb25seQogIC8vIGNvaW4gY2FuIG9ubHkgYmUgdHJhc2ZlcmVkIHRvIGludm9rZXIsIGFuZCBpbnZva2VyIG11c3QgYmUgTm92YSBjb250cmFjdAogIGZ1bmN0aW9uIGNvbnN1bWVDb2luRm9yTm92YShhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSkgZXh0ZXJuYWwgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5vdmFDb250cmFjdEFkZHJlc3MpOwogICAgcmVxdWlyZShiYWxhbmNlT2ZbX2Zyb21dID49IF92YWx1ZSk7CiAgICB2YXIgX3RvID0gbm92YUNvbnRyYWN0QWRkcmVzczsKICAgIHJlcXVpcmUoYmFsYW5jZU9mW190b10gKyBfdmFsdWUgPiBiYWxhbmNlT2ZbX3RvXSk7CiAgICB1aW50IHByZXZpb3VzQmFsYW5jZXMgPSBiYWxhbmNlT2ZbX2Zyb21dICsgYmFsYW5jZU9mW190b107CiAgICBiYWxhbmNlT2ZbX2Zyb21dIC09IF92YWx1ZTsKICAgIGJhbGFuY2VPZltfdG9dICs9IF92YWx1ZTsKICB9Cn0KCi8vLyBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBOb24tRnVuZ2libGUgVG9rZW5zCi8vLyBAYXV0aG9yIERpZXRlciBTaGlybGV5IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZjE5NTk0ODU5NGIxOTA4OTk4OWU5YzhiOTQ5ZmRmOTI5ZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKY29udHJhY3QgRVJDNzIxIHsKICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwoKICAvLyBFdmVudHMKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgLy8gT3B0aW9uYWwKICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogIC8vIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKTsKICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogIC8vIEVSQy0xNjUgQ29tcGF0aWJpbGl0eSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkKICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgovLyBqdXN0IGludGVyZmFjZSByZWZlcmVuY2UKY29udHJhY3QgTm92YUxhYkludGVyZmFjZSB7CiAgZnVuY3Rpb24gYm9yblN0YXIoKSBleHRlcm5hbCByZXR1cm5zKHVpbnQgc3Rhcikge30KICBmdW5jdGlvbiBib3JuTWV0ZW9yaXRlTnVtYmVyKCkgZXh0ZXJuYWwgcmV0dXJucyh1aW50IG1OdW1iZXIpIHt9CiAgZnVuY3Rpb24gYm9ybk1ldGVvcml0ZSgpIGV4dGVybmFsIHJldHVybnModWludCBtUSkge30KICBmdW5jdGlvbiBtZXJnZU1ldGVvcml0ZSh1aW50IHRvdGFsUXVhbGl0eSkgZXh0ZXJuYWwgcmV0dXJucyhib29sIGlzU3VjY2VzcywgdWludCBmaW5hbE1hc3MpIHt9Cn0KCmNvbnRyYWN0IEZhbWVkU3RhckludGVyZmFjZSB7CiAgZnVuY3Rpb24gYm9ybkZhbWVkU3RhcihhZGRyZXNzIHVzZXJBZGRyZXNzLCB1aW50IG1hc3MpIGV4dGVybmFsIHJldHVybnModWludCBpZCwgYnl0ZXMzMiBuYW1lKSB7fQogIGZ1bmN0aW9uIHVwZGF0ZUZhbWVkU3Rhck93bmVyKHVpbnQgaWQsIGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIHt9Cn0KCmNvbnRyYWN0IE5vdmEgaXMgTm92YUFjY2Vzc0NvbnRyb2wsRVJDNzIxIHsKICAvLyBFUkM3MjEgUmVxdWlyZWQKICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9IGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5zT2ZPd25lcihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbk1ldGFkYXRhKHVpbnQyNTYsc3RyaW5nKScpKTsKCiAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gKChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSkgfHwgKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgfQoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gIk5vdmEiOwogIH0KCiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gIk5PVkEiOwogIH0KCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKSB7CiAgICByZXR1cm4gdmFsaWRBc3Ryb0NvdW50OwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYXN0cm9Pd25lclRvSURzTGVuW19vd25lcl07CiAgfQoKICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsKICAgIHJldHVybiBhc3Ryb0luZGV4VG9Pd25lcnNbX3Rva2VuSWRdOwogIH0KCiAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFzdHJvSW5kZXhUb093bmVyc1tfdG9rZW5JZF0pOwogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IF90byk7CgogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfdG9dID0gX3Rva2VuSWQ7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICB9CgogIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKSB7CiAgICByZXR1cm4gYXN0cm9Pd25lclRvSURzW19vd25lcl07CiAgfQoKICBzdHJpbmcgbWV0YUJhc2VVcmwgPSAiaHR0cDovL3N1cGVybm92YS5kdWVsb2ZraW5ncy5jb20iOwogIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICByZXR1cm4gbWV0YUJhc2VVcmw7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVNZXRhQmFzZVVybChzdHJpbmcgbmV3VXJsKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICBtZXRhQmFzZVVybCA9IG5ld1VybDsKICB9CgogIC8vIEVORCBvZiBFUkMtMTY1IEVSQy03MjEKCiAgZW51bSBBc3Ryb1R5cGUge1BsYWNlaG9sZGVyLCBTdXBlcm5vdmEsIE1ldGVvcml0ZSwgTm9ybWFsU3RhciwgRmFtZWRTdGFyLCBEaXNtaXNzZWR9CiAgdWludCBwdWJsaWMgc3VwZXJOb3ZhU3VwcGx5OwogIHVpbnQgcHVibGljIHZhbGlkQXN0cm9Db3VudDsKICBhZGRyZXNzIHB1YmxpYyBub3ZhQ29pbkFkZHJlc3M7CiAgYWRkcmVzcyBwdWJsaWMgbGFiQWRkcmVzczsKICBhZGRyZXNzIHB1YmxpYyBmYW1lZFN0YXJBZGRyZXNzOwogIHVpbnQgcHVibGljIGFzdHJvSURQb29sOwogIHVpbnQgcHVibGljIHByaWNlVmFsaWRTZWNvbmRzID0gMzYwMDsgLy9kZWZhdWx0IDEgaG91cgoKICB1aW50IG5vdmFUcmFuc2ZlclJhdGUgPSAzMDsgLy8gMzAvMTAwMAoKICBzdHJ1Y3QgQXN0cm8gewogICAgdWludCBpZDsgLy93b3JsZCB1bmlxdWUsIGFzdHJvSURQb29sIHN0YXJ0IGZyb20gMQogICAgdWludCBjcmVhdGVUaW1lOwogICAgdWludCBuZXh0QXR0cmFjdFRpbWU7CiAgICAvLyBbOF1bOF1bODhdWzg4XSAtPiBMIHRvIEg6IGFzdHJvVHlwZSwgY2RJZHgsIGZhbWVkSUQsIG1hc3MKICAgIHVpbnQ0OCBjb2RlOwogICAgYnl0ZXMzMiBuYW1lOwogIH0KCiAgc3RydWN0IFB1cmNoYXNpbmdSZWNvcmQgewogICAgdWludCBpZDsKICAgIHVpbnQgcHJpY2VXZWk7CiAgICB1aW50IHRpbWU7CiAgfQoKICBBc3Ryb1tdIHB1YmxpYyBzdXBlcm5vdmFzOwogIEFzdHJvW10gcHVibGljIG5vcm1hbFN0YXJzOwogIEFzdHJvW10gcHVibGljIGZhbWVkU3RhcnM7CiAgQXN0cm9bXSBwdWJsaWMgbWV0ZW9yaXRlczsKCiAgdWludDMyWzMxXSBwdWJsaWMgY2QgPSBbCiAgICAwLAogICAgdWludDMyKDM2MCBtaW51dGVzKSwKICAgIHVpbnQzMig0MDAgbWludXRlcyksCiAgICB1aW50MzIoNDQ0IG1pbnV0ZXMpLAogICAgdWludDMyKDQ5NCBtaW51dGVzKSwKICAgIHVpbnQzMig1NTAgbWludXRlcyksCiAgICB1aW50MzIoNjEwIG1pbnV0ZXMpLAogICAgdWludDMyKDY3NyBtaW51dGVzKSwKICAgIHVpbnQzMig3NTIgbWludXRlcyksCiAgICB1aW50MzIoODM0IG1pbnV0ZXMpLAogICAgdWludDMyKDkyNSBtaW51dGVzKSwKICAgIHVpbnQzMigxMDI3IG1pbnV0ZXMpLAogICAgdWludDMyKDExNDAgbWludXRlcyksCiAgICB1aW50MzIoMTI2NSBtaW51dGVzKSwKICAgIHVpbnQzMigxNDA0IG1pbnV0ZXMpLAogICAgdWludDMyKDE1NTggbWludXRlcyksCiAgICB1aW50MzIoMTcyOSBtaW51dGVzKSwKICAgIHVpbnQzMigxOTE5IG1pbnV0ZXMpLAogICAgdWludDMyKDIxMzAgbWludXRlcyksCiAgICB1aW50MzIoMjM2NCBtaW51dGVzKSwKICAgIHVpbnQzMigyNjI0IG1pbnV0ZXMpLAogICAgdWludDMyKDI5MTIgbWludXRlcyksCiAgICB1aW50MzIoMzIzMiBtaW51dGVzKSwKICAgIHVpbnQzMigzNTg3IG1pbnV0ZXMpLAogICAgdWludDMyKDM5ODIgbWludXRlcyksCiAgICB1aW50MzIoNDQyMCBtaW51dGVzKSwKICAgIHVpbnQzMig0OTA2IG1pbnV0ZXMpLAogICAgdWludDMyKDU0NDUgbWludXRlcyksCiAgICB1aW50MzIoNjA0NCBtaW51dGVzKSwKICAgIHVpbnQzMig2NzA4IG1pbnV0ZXMpLAogICAgdWludDMyKDcyMDAgbWludXRlcykKICBdOwoKICAvLyBhIG1hcHBpbmcgZnJvbSBhc3RybyBJRCB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMKICBtYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpIHB1YmxpYyBhc3Ryb0luZGV4VG9Pd25lcnM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50W10pIHB1YmxpYyBhc3Ryb093bmVyVG9JRHM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYXN0cm9Pd25lclRvSURzTGVuOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcodWludCA9PiB1aW50KSkgcHVibGljIGFzdHJvT3duZXJUb0lESW5kZXg7CgogIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgcHVibGljIGlkVG9JbmRleDsKCiAgLy8gYSBtYXBwaW5nIGZyb20gYXN0cm8gbmFtZSB0byBJRAogIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDI1NikgYXN0cm9OYW1lVG9JRHM7CgogIC8vIHB1cmNoYXNpbmcgbWFwcGluZwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gUHVyY2hhc2luZ1JlY29yZCkgcHVibGljIHB1cmNoYXNpbmdCdXllcjsKCiAgZXZlbnQgUHVyY2hhc2VkU3VwZXJub3ZhKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnQgYXN0cm9JRCk7CiAgZXZlbnQgRXhwbG9kZWRTdXBlcm5vdmEoYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludFtdIG5ld0FzdHJvSURzKTsKICBldmVudCBNZXJnZWRBc3Ryb3MoYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludCBuZXdBc3Ryb0lEKTsKICBldmVudCBBdHRyYWN0ZWRNZXRlb3JpdGVzKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnRbXSBuZXdBc3Ryb0lEcyk7CiAgZXZlbnQgVXNlclB1cmNoYXNlZEFzdHJvKGFkZHJlc3MgYnV5ZXJBZGRyZXNzLCBhZGRyZXNzIHNlbGxlckFkZHJlc3MsIHVpbnQgYXN0cm9JRCwgdWludCByZWNvcmRQcmljZVdlaSwgdWludCB2YWx1ZSk7CiAgZXZlbnQgTm92YVB1cmNoYXNpbmcoYWRkcmVzcyBidXlBZGRyZXNzLCB1aW50IGFzdHJvSUQsIHVpbnQgcHJpY2VXZWkpOwoKICAvLyBpbml0aWFsIHN1cHBseSB0byBtYW5hZ2VyQWRkcmVzcwogIGZ1bmN0aW9uIE5vdmEodWludDMyIGluaXRpYWxTdXBwbHkpIHB1YmxpYyB7CiAgICBzdXBlck5vdmFTdXBwbHkgPSBpbml0aWFsU3VwcGx5OwogICAgdmFsaWRBc3Ryb0NvdW50ID0gMDsKICAgIGFzdHJvSURQb29sID0gMDsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZU5vdmFUcmFuc2ZlclJhdGUodWludCByYXRlKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICBub3ZhVHJhbnNmZXJSYXRlID0gcmF0ZTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZU5vdmFDb2luQWRkcmVzcyhhZGRyZXNzIG5vdmFDb2luQWRkcikgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgbm92YUNvaW5BZGRyZXNzID0gbm92YUNvaW5BZGRyOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlTGFiQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgYWRkcikgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgbGFiQWRkcmVzcyA9IGFkZHI7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVGYW1lZFN0YXJDb250cmFjdEFkZHJlc3MoYWRkcmVzcyBhZGRyKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICBmYW1lZFN0YXJBZGRyZXNzID0gYWRkcjsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZVByaWNlVmFsaWRTZWNvbmRzKHVpbnQgbmV3U2Vjb25kcykgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgcHJpY2VWYWxpZFNlY29uZHMgPSBuZXdTZWNvbmRzOwogIH0KCiAgZnVuY3Rpb24gZ2V0QXN0cm9zTGVuZ3RoKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgIHJldHVybiBhc3Ryb0lEUG9vbDsKICB9CgogIGZ1bmN0aW9uIGdldFVzZXJBc3Ryb0lEcyhhZGRyZXNzIHVzZXJBZGRyZXNzKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnRbXSkgewogICAgcmV0dXJuIGFzdHJvT3duZXJUb0lEc1t1c2VyQWRkcmVzc107CiAgfQoKICBmdW5jdGlvbiBnZXROb3ZhT3duZXJBZGRyZXNzKHVpbnQgbm92YUlEKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgcmV0dXJuIGFzdHJvSW5kZXhUb093bmVyc1tub3ZhSURdOwogIH0KCiAgZnVuY3Rpb24gZ2V0QXN0cm9JbmZvKHVpbnQgaWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQgbm92YUlkLCB1aW50IGlkeCwgQXN0cm9UeXBlIGFzdHJvVHlwZSwgc3RyaW5nIGFzdHJvTmFtZSwgdWludCBtYXNzLCB1aW50IGNyZWF0ZVRpbWUsIHVpbnQgZmFtZWRJRCwgdWludCBuZXh0QXR0cmFjdFRpbWUsIHVpbnQgY2RUaW1lKSB7CiAgICAgIGlmIChpZCA+IGFzdHJvSURQb29sKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIChpZHgsIGFzdHJvVHlwZSkgPSBfZXh0cmFjdEluZGV4KGlkVG9JbmRleFtpZF0pOwogICAgICBpZiAoYXN0cm9UeXBlID09IEFzdHJvVHlwZS5QbGFjZWhvbGRlciB8fCBhc3Ryb1R5cGUgPT0gQXN0cm9UeXBlLkRpc21pc3NlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBBc3RybyBtZW1vcnkgYXN0cm87CiAgICAgIHVpbnQgY2RJZHg7CgogICAgICB2YXIgYXN0cm9Qb29sID0gX2dldEFzdHJvUG9vbEJ5VHlwZShhc3Ryb1R5cGUpOwogICAgICBhc3RybyA9IGFzdHJvUG9vbFtpZHhdOwogICAgICAoYXN0cm9UeXBlLCBjZElkeCwgZmFtZWRJRCwgbWFzcykgPSBfZXh0cmFjdENvZGUoYXN0cm8uY29kZSk7CgogICAgICByZXR1cm4gKGlkLCBpZHgsIGFzdHJvVHlwZSwgX2J5dGVzMzJUb1N0cmluZyhhc3Ryby5uYW1lKSwgbWFzcywgYXN0cm8uY3JlYXRlVGltZSwgZmFtZWRJRCwgYXN0cm8ubmV4dEF0dHJhY3RUaW1lLCBjZFtjZElkeF0pOwogIH0KCiAgZnVuY3Rpb24gZ2V0QXN0cm9JbmZvQnlJZHgodWludCBpbmRleCwgQXN0cm9UeXBlIGFUeXBlKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQgbm92YUlkLCB1aW50IGlkeCwgQXN0cm9UeXBlIGFzdHJvVHlwZSwgc3RyaW5nIGFzdHJvTmFtZSwgdWludCBtYXNzLCB1aW50IGNyZWF0ZVRpbWUsIHVpbnQgZmFtZWRJRCwgdWludCBuZXh0QXR0cmFjdFRpbWUsIHVpbnQgY2RUaW1lKSB7CiAgICAgIGlmIChhVHlwZSA9PSBBc3Ryb1R5cGUuUGxhY2Vob2xkZXIgfHwgYVR5cGUgPT0gQXN0cm9UeXBlLkRpc21pc3NlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYXN0cm9Qb29sID0gX2dldEFzdHJvUG9vbEJ5VHlwZShhVHlwZSk7CiAgICAgIEFzdHJvIG1lbW9yeSBhc3RybyA9IGFzdHJvUG9vbFtpbmRleF07CiAgICAgIHVpbnQgY2RJZHg7CiAgICAgIChhc3Ryb1R5cGUsIGNkSWR4LCBmYW1lZElELCBtYXNzKSA9IF9leHRyYWN0Q29kZShhc3Ryby5jb2RlKTsKICAgICAgcmV0dXJuIChhc3Ryby5pZCwgaW5kZXgsIGFzdHJvVHlwZSwgX2J5dGVzMzJUb1N0cmluZyhhc3Ryby5uYW1lKSwgbWFzcywgYXN0cm8uY3JlYXRlVGltZSwgZmFtZWRJRCwgYXN0cm8ubmV4dEF0dHJhY3RUaW1lLCBjZFtjZElkeF0pOwogIH0KCiAgZnVuY3Rpb24gZ2V0U3VwZXJub3ZhQmFsYW5jZSgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludCkgewogICAgICByZXR1cm4gc3VwZXJOb3ZhU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gZ2V0QXN0cm9Qb29sTGVuZ3RoKEFzdHJvVHlwZSBhc3Ryb1R5cGUpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludCkgewogICAgICBBc3Ryb1tdIHN0b3JhZ2UgcG9vbCA9IF9nZXRBc3Ryb1Bvb2xCeVR5cGUoYXN0cm9UeXBlKTsKICAgICAgcmV0dXJuIHBvb2wubGVuZ3RoOwogIH0KCiAgLy8gcmVhZCBmcm9tIGVuZCBwb3NpdGlvbgogIGZ1bmN0aW9uIGdldEFzdHJvSWR4c0J5UGFnZSh1aW50IGxhc3RJbmRleCwgdWludCBjb3VudCwgQXN0cm9UeXBlIGV4cGVjdGVkVHlwZSkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50W10gaWR4LCB1aW50IGlkeExlbikgewogICAgICBpZiAoZXhwZWN0ZWRUeXBlID09IEFzdHJvVHlwZS5QbGFjZWhvbGRlciB8fCBleHBlY3RlZFR5cGUgPT0gQXN0cm9UeXBlLkRpc21pc3NlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBBc3Ryb1tdIHN0b3JhZ2UgYXN0cm9Qb29sID0gX2dldEFzdHJvUG9vbEJ5VHlwZShleHBlY3RlZFR5cGUpOwoKICAgICAgaWYgKGxhc3RJbmRleCA9PSAwIHx8IGFzdHJvUG9vbC5sZW5ndGggPT0gMCB8fCBsYXN0SW5kZXggPiBhc3Ryb1Bvb2wubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHVpbnRbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnRbXShjb3VudCk7CiAgICAgIHVpbnQgc3RhcnQgPSBsYXN0SW5kZXggLSAxOwogICAgICB1aW50IGkgPSAwOwogICAgICBmb3IgKHVpbnQgY3Vyc29yID0gc3RhcnQ7IGN1cnNvciA+PSAwICYmIGkgPCBjb3VudDsgLS1jdXJzb3IpIHsKICAgICAgICAgIHZhciBhc3RybyA9IGFzdHJvUG9vbFtjdXJzb3JdOwogICAgICAgICAgaWYgKF9pc1ZhbGlkQXN0cm8oX2dldEFzdHJvVHlwZUJ5Q29kZShhc3Ryby5jb2RlKSkpIHsKICAgICAgICAgICAgcmVzdWx0W2krK10gPSBjdXJzb3I7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY3Vyc29yID09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gdWdseQogICAgICB1aW50W10gbWVtb3J5IGZpbmFsUiA9IG5ldyB1aW50W10oaSk7CiAgICAgIGZvciAodWludCBjbnQgPSAwOyBjbnQgPCBpOyBjbnQrKykgewogICAgICAgIGZpbmFsUltjbnRdID0gcmVzdWx0W2NudF07CiAgICAgIH0KCiAgICAgIHJldHVybiAoZmluYWxSLCBpKTsKICB9CgogIGZ1bmN0aW9uIGlzVXNlck93bk5vdmFzKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnRbXSBub3ZhSURzKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKGJvb2wgaXNPd24pIHsKICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbm92YUlEcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGFzdHJvSW5kZXhUb093bmVyc1tub3ZhSURzW2ldXSAhPSB1c2VyQWRkcmVzcykgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBnZXRVc2VyUHVyY2hhc2luZ1RpbWUoYWRkcmVzcyBidXllckFkZHJlc3MpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludCkgewogICAgcmV0dXJuIHB1cmNoYXNpbmdCdXllcltidXllckFkZHJlc3NdLnRpbWU7CiAgfQoKICBmdW5jdGlvbiBfZXh0cmFjdEluZGV4KHVpbnQgY29kZUlkeCkgcHVyZSBwdWJsaWMgcmV0dXJucyh1aW50IGluZGV4LCBBc3Ryb1R5cGUgYXN0cm9UeXBlKSB7CiAgICAgIGFzdHJvVHlwZSA9IEFzdHJvVHlwZShjb2RlSWR4ICYgMHgwMDAwMDAwMDAwZmYpOwogICAgICBpbmRleCA9IHVpbnQoY29kZUlkeCA+PiA4KTsKICB9CgogIGZ1bmN0aW9uIF9jb21iaW5lSW5kZXgodWludCBpbmRleCwgQXN0cm9UeXBlIGFzdHJvVHlwZSkgcHVyZSBwdWJsaWMgcmV0dXJucyh1aW50IGNvZGVJZHgpIHsKICAgICAgY29kZUlkeCA9IHVpbnQoKGluZGV4IDw8IDgpIHwgdWludChhc3Ryb1R5cGUpKTsKICB9CgogIGZ1bmN0aW9uIF91cGRhdGVBc3Ryb1R5cGVGb3JJbmRleENvZGUodWludCBvcmdDb2RlSWR4LCBBc3Ryb1R5cGUgYXN0cm9UeXBlKSBwdXJlIHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgcmV0dXJuIChvcmdDb2RlSWR4ICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjAwKSB8ICh1aW50KGFzdHJvVHlwZSkpOwogIH0KCiAgZnVuY3Rpb24gX3VwZGF0ZUluZGV4Rm9ySW5kZXhDb2RlKHVpbnQgb3JnQ29kZUlkeCwgdWludCBpZHgpIHB1cmUgcHVibGljIHJldHVybnModWludCkgewogICAgICByZXR1cm4gKG9yZ0NvZGVJZHggJiAweGZmKSB8IChpZHggPDwgOCk7CiAgfQoKICBmdW5jdGlvbiBfZXh0cmFjdENvZGUodWludDQ4IGNvZGUpIHB1cmUgcHVibGljIHJldHVybnMoQXN0cm9UeXBlIGFzdHJvVHlwZSwgdWludCBjZElkeCwgdWludCBmYW1lZElELCB1aW50IG1hc3MpIHsKICAgICBhc3Ryb1R5cGUgPSBBc3Ryb1R5cGUoY29kZSAmIDB4MDAwMDAwMDAwMGZmKTsKICAgICBpZiAoYXN0cm9UeXBlID09IEFzdHJvVHlwZS5Ob3JtYWxTdGFyKSB7CiAgICAgICAgY2RJZHggPSAoY29kZSAmIDB4MDAwMDAwMDBmZjAwKSA+PiA4OwogICAgICAgIGZhbWVkSUQgPSAwOwogICAgICAgIG1hc3MgPSAoY29kZSAmIDB4ZmZmZjAwMDAwMDAwKSA+PiAzMjsKICAgICB9IGVsc2UgaWYgKGFzdHJvVHlwZSA9PSBBc3Ryb1R5cGUuRmFtZWRTdGFyKSB7CiAgICAgICAgY2RJZHggPSAoY29kZSAmIDB4MDAwMDAwMDBmZjAwKSA+PiA4OwogICAgICAgIGZhbWVkSUQgPSAoY29kZSAmIDB4MDAwMGZmZmYwMDAwKSA+PiAxNjsKICAgICAgICBtYXNzID0gKGNvZGUgJiAweGZmZmYwMDAwMDAwMCkgPj4gMzI7CiAgICAgfSBlbHNlIGlmIChhc3Ryb1R5cGUgPT0gQXN0cm9UeXBlLlN1cGVybm92YSkgewogICAgICAgIGNkSWR4ID0gMDsKICAgICAgICBmYW1lZElEID0gMDsKICAgICAgICBtYXNzID0gMDsKICAgICB9IGVsc2UgewogICAgICAgIGNkSWR4ID0gMDsKICAgICAgICBmYW1lZElEID0gMDsKICAgICAgICBtYXNzID0gKGNvZGUgJiAweGZmZmYwMDAwMDAwMCkgPj4gMzI7CiAgICAgfQogIH0KCiAgZnVuY3Rpb24gX2dldEFzdHJvVHlwZUJ5Q29kZSh1aW50NDggY29kZSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKEFzdHJvVHlwZSBhc3Ryb1R5cGUpIHsKICAgICByZXR1cm4gQXN0cm9UeXBlKGNvZGUgJiAweDAwMDAwMDAwMDBmZik7CiAgfQoKICBmdW5jdGlvbiBfZ2V0TWFzc0J5Q29kZSh1aW50NDggY29kZSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQgbWFzcykgewogICAgIHJldHVybiB1aW50KChjb2RlICYgMHhmZmZmMDAwMDAwMDApID4+IDMyKTsKICB9CgogIGZ1bmN0aW9uIF9nZXRDZElkeEJ5Q29kZSh1aW50NDggY29kZSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQgY2RJZHgpIHsKICAgICByZXR1cm4gdWludCgoY29kZSAmIDB4MDAwMDAwMDBmZjAwKSA+PiA4KTsKICB9CgogIGZ1bmN0aW9uIF9nZXRGYW1lZElEQnlDb2RlKHVpbnQ0OCBjb2RlKSBwdXJlIGludGVybmFsIHJldHVybnModWludCBmYW1lZElEKSB7CiAgICByZXR1cm4gdWludCgoY29kZSAmIDB4MDAwMGZmZmYwMDAwKSA+PiAxNik7CiAgfQoKICBmdW5jdGlvbiBfY29tYmllQ29kZShBc3Ryb1R5cGUgYXN0cm9UeXBlLCB1aW50IGNkSWR4LCB1aW50IGZhbWVkSUQsIHVpbnQgbWFzcykgcHVyZSBwdWJsaWMgcmV0dXJucyh1aW50NDggY29kZSkgewogICAgIGlmIChhc3Ryb1R5cGUgPT0gQXN0cm9UeXBlLk5vcm1hbFN0YXIpIHsKICAgICAgICByZXR1cm4gdWludDQ4KGFzdHJvVHlwZSkgfCAodWludDQ4KGNkSWR4KSA8PCA4KSB8ICh1aW50NDgobWFzcykgPDwgMzIpOwogICAgIH0gZWxzZSBpZiAoYXN0cm9UeXBlID09IEFzdHJvVHlwZS5GYW1lZFN0YXIpIHsKICAgICAgICByZXR1cm4gdWludDQ4KGFzdHJvVHlwZSkgfCAodWludDQ4KGNkSWR4KSA8PCA4KSB8ICh1aW50NDgoZmFtZWRJRCkgPDwgMTYpIHwgKHVpbnQ0OChtYXNzKSA8PCAzMik7CiAgICAgfSBlbHNlIGlmIChhc3Ryb1R5cGUgPT0gQXN0cm9UeXBlLlN1cGVybm92YSkgewogICAgICAgIHJldHVybiB1aW50NDgoYXN0cm9UeXBlKTsKICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1aW50NDgoYXN0cm9UeXBlKSB8ICh1aW50NDgobWFzcykgPDwgMzIpOwogICAgIH0KICB9CgogIGZ1bmN0aW9uIF91cGRhdGVBc3Ryb1R5cGVGb3JDb2RlKHVpbnQ0OCBvcmdDb2RlLCBBc3Ryb1R5cGUgbmV3VHlwZSkgcHVyZSBwdWJsaWMgcmV0dXJucyh1aW50NDggbmV3Q29kZSkgewogICAgIHJldHVybiAob3JnQ29kZSAmIDB4ZmZmZmZmZmZmZjAwKSB8ICh1aW50NDgobmV3VHlwZSkpOwogIH0KCiAgZnVuY3Rpb24gX3VwZGF0ZUNkSWR4Rm9yQ29kZSh1aW50NDggb3JnQ29kZSwgdWludCBuZXdJZHgpIHB1cmUgcHVibGljIHJldHVybnModWludDQ4IG5ld0NvZGUpIHsKICAgICByZXR1cm4gKG9yZ0NvZGUgJiAweGZmZmZmZmZmMDBmZikgfCAodWludDQ4KG5ld0lkeCkgPDwgOCk7CiAgfQoKICBmdW5jdGlvbiBfZ2V0QXN0cm9Qb29sQnlUeXBlKEFzdHJvVHlwZSBleHBlY3RlZFR5cGUpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoQXN0cm9bXSBzdG9yYWdlIHBvb2wpIHsKICAgICAgaWYgKGV4cGVjdGVkVHlwZSA9PSBBc3Ryb1R5cGUuU3VwZXJub3ZhKSB7CiAgICAgICAgICByZXR1cm4gc3VwZXJub3ZhczsKICAgICAgfSBlbHNlIGlmIChleHBlY3RlZFR5cGUgPT0gQXN0cm9UeXBlLk1ldGVvcml0ZSkgewogICAgICAgICAgcmV0dXJuIG1ldGVvcml0ZXM7CiAgICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09IEFzdHJvVHlwZS5Ob3JtYWxTdGFyKSB7CiAgICAgICAgICByZXR1cm4gbm9ybWFsU3RhcnM7CiAgICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09IEFzdHJvVHlwZS5GYW1lZFN0YXIpIHsKICAgICAgICAgIHJldHVybiBmYW1lZFN0YXJzOwogICAgICB9CiAgfQoKICBmdW5jdGlvbiBfaXNWYWxpZEFzdHJvKEFzdHJvVHlwZSBhc3Ryb1R5cGUpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgIHJldHVybiBhc3Ryb1R5cGUgIT0gQXN0cm9UeXBlLlBsYWNlaG9sZGVyICYmIGFzdHJvVHlwZSAhPSBBc3Ryb1R5cGUuRGlzbWlzc2VkOwogIH0KCiAgZnVuY3Rpb24gX3JlZHVjZVZhbGlkQXN0cm9Db3VudCgpIGludGVybmFsIHsKICAgIC0tdmFsaWRBc3Ryb0NvdW50OwogIH0KCiAgZnVuY3Rpb24gX3BsdXNWYWxpZEFzdHJvQ291bnQoKSBpbnRlcm5hbCB7CiAgICArK3ZhbGlkQXN0cm9Db3VudDsKICB9CgogIGZ1bmN0aW9uIF9hZGRBc3RybyhBc3Ryb1R5cGUgYXN0cm9UeXBlLCBieXRlczMyIGFzdHJvTmFtZSwgdWludCBtYXNzLCB1aW50IGNyZWF0ZVRpbWUsIHVpbnQgZmFtZWRJRCkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICB1aW50NDggY29kZSA9IF9jb21iaWVDb2RlKGFzdHJvVHlwZSwgMCwgZmFtZWRJRCwgbWFzcyk7CgogICAgdmFyIGFzdHJvUG9vbCA9IF9nZXRBc3Ryb1Bvb2xCeVR5cGUoYXN0cm9UeXBlKTsKICAgICsrYXN0cm9JRFBvb2w7CiAgICB1aW50IGlkeCA9IGFzdHJvUG9vbC5wdXNoKEFzdHJvKHsKICAgICAgICBpZDogYXN0cm9JRFBvb2wsCiAgICAgICAgbmFtZTogYXN0cm9OYW1lLAogICAgICAgIGNyZWF0ZVRpbWU6IGNyZWF0ZVRpbWUsCiAgICAgICAgbmV4dEF0dHJhY3RUaW1lOiAwLAogICAgICAgIGNvZGU6IGNvZGUKICAgIH0pKSAtIDE7CgogICAgaWRUb0luZGV4W2FzdHJvSURQb29sXSA9IF9jb21iaW5lSW5kZXgoaWR4LCBhc3Ryb1R5cGUpOwoKICAgIHJldHVybiBhc3Ryb0lEUG9vbDsKICB9CgogIGZ1bmN0aW9uIF9yZW1vdmVBc3Ryb0Zyb21Vc2VyKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnQgbm92YUlEKSBpbnRlcm5hbCB7CiAgICB1aW50IGlkc0xlbiA9IGFzdHJvT3duZXJUb0lEc0xlblt1c2VyQWRkcmVzc107CiAgICB1aW50IGluZGV4ID0gYXN0cm9Pd25lclRvSURJbmRleFt1c2VyQWRkcmVzc11bbm92YUlEXTsKCiAgICBpZiAoaWRzTGVuID4gMSAmJiBpbmRleCAhPSBpZHNMZW4gLSAxKSB7CiAgICAgICAgdWludCBlbmROb3ZhSUQgPSBhc3Ryb093bmVyVG9JRHNbdXNlckFkZHJlc3NdW2lkc0xlbiAtIDFdOwogICAgICAgIGFzdHJvT3duZXJUb0lEc1t1c2VyQWRkcmVzc11baW5kZXhdID0gZW5kTm92YUlEOwogICAgICAgIGFzdHJvT3duZXJUb0lESW5kZXhbdXNlckFkZHJlc3NdW2VuZE5vdmFJRF0gPSBpbmRleDsKICAgIH0KICAgIGFzdHJvT3duZXJUb0lEc1t1c2VyQWRkcmVzc11baWRzTGVuIC0gMV0gPSAwOwogICAgYXN0cm9Pd25lclRvSURzTGVuW3VzZXJBZGRyZXNzXSA9IGlkc0xlbiAtIDE7CiAgfQoKICBmdW5jdGlvbiBfYWRkQXN0cm9Ub1VzZXIoYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludCBub3ZhSUQpIGludGVybmFsIHsKICAgIHVpbnQgaWRzTGVuID0gYXN0cm9Pd25lclRvSURzTGVuW3VzZXJBZGRyZXNzXTsKICAgIHVpbnQgYXJyYXlMZW4gPSBhc3Ryb093bmVyVG9JRHNbdXNlckFkZHJlc3NdLmxlbmd0aDsKICAgIGlmIChpZHNMZW4gPT0gYXJyYXlMZW4pIHsKICAgICAgYXN0cm9Pd25lclRvSURzTGVuW3VzZXJBZGRyZXNzXSA9IGFzdHJvT3duZXJUb0lEc1t1c2VyQWRkcmVzc10ucHVzaChub3ZhSUQpOwogICAgICBhc3Ryb093bmVyVG9JREluZGV4W3VzZXJBZGRyZXNzXVtub3ZhSURdID0gYXN0cm9Pd25lclRvSURzTGVuW3VzZXJBZGRyZXNzXSAtIDE7CiAgICB9IGVsc2UgewogICAgICAvLyB0aGVyZSBpcyBnYXAKICAgICAgYXN0cm9Pd25lclRvSURzW3VzZXJBZGRyZXNzXVtpZHNMZW5dID0gbm92YUlEOwogICAgICBhc3Ryb093bmVyVG9JRHNMZW5bdXNlckFkZHJlc3NdID0gaWRzTGVuICsgMTsKICAgICAgYXN0cm9Pd25lclRvSURJbmRleFt1c2VyQWRkcmVzc11bbm92YUlEXSA9IGlkc0xlbjsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9idXJuRG93bkFzdHJvKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnQgbm92YUlEKSBpbnRlcm5hbCB7CiAgICBkZWxldGUgYXN0cm9JbmRleFRvT3duZXJzW25vdmFJRF07CiAgICBfcmVtb3ZlQXN0cm9Gcm9tVXNlcih1c2VyQWRkcmVzcywgbm92YUlEKTsKCiAgICB1aW50IGlkeDsKICAgIEFzdHJvVHlwZSBhc3Ryb1R5cGU7CiAgICB1aW50IG9yZ0lkeENvZGUgPSBpZFRvSW5kZXhbbm92YUlEXTsKICAgIChpZHgsIGFzdHJvVHlwZSkgPSBfZXh0cmFjdEluZGV4KG9yZ0lkeENvZGUpOwoKICAgIHZhciBwb29sID0gX2dldEFzdHJvUG9vbEJ5VHlwZShhc3Ryb1R5cGUpOwogICAgcG9vbFtpZHhdLmNvZGUgPSBfdXBkYXRlQXN0cm9UeXBlRm9yQ29kZShwb29sW2lkeF0uY29kZSwgQXN0cm9UeXBlLkRpc21pc3NlZCk7CgogICAgaWRUb0luZGV4W25vdmFJRF0gPSBfdXBkYXRlQXN0cm9UeXBlRm9ySW5kZXhDb2RlKG9yZ0lkeENvZGUsIEFzdHJvVHlwZS5EaXNtaXNzZWQpOwoKICAgIF9yZWR1Y2VWYWxpZEFzdHJvQ291bnQoKTsKICB9CgogIGZ1bmN0aW9uIF9pbnNlcnROZXdBc3RybyhhZGRyZXNzIHVzZXJBZGRyZXNzLCBBc3Ryb1R5cGUgdCwgdWludCBtYXNzLCBieXRlczMyIG5vdmFOYW1lLCB1aW50IGZhbWVkSUQpIGludGVybmFsIHJldHVybnModWludCkgewogICAgdWludCBuZXdOb3ZhSUQgPSBfYWRkQXN0cm8odCwgbm92YU5hbWUsIG1hc3MsIGJsb2NrLnRpbWVzdGFtcCwgZmFtZWRJRCk7CiAgICBhc3Ryb0luZGV4VG9Pd25lcnNbbmV3Tm92YUlEXSA9IHVzZXJBZGRyZXNzOwogICAgX2FkZEFzdHJvVG9Vc2VyKHVzZXJBZGRyZXNzLCBuZXdOb3ZhSUQpOwoKICAgIF9wbHVzVmFsaWRBc3Ryb0NvdW50KCk7CiAgICByZXR1cm4gbmV3Tm92YUlEOwogIH0KCiAgZnVuY3Rpb24gX2J5dGVzMzJUb1N0cmluZyhieXRlczMyIHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICBieXRlcyBtZW1vcnkgYnl0ZXNTdHJpbmcgPSBuZXcgYnl0ZXMoMzIpOwogICAgdWludCBjaGFyQ291bnQgPSAwOwogICAgZm9yICh1aW50IGogPSAwOyBqIDwgMzI7IGorKykgewogICAgICAgIGJ5dGUgY2hhciA9IGJ5dGUoYnl0ZXMzMih1aW50KHgpICogMiAqKiAoOCAqIGopKSk7CiAgICAgICAgaWYgKGNoYXIgIT0gMCkgewogICAgICAgICAgICBieXRlc1N0cmluZ1tjaGFyQ291bnRdID0gY2hhcjsKICAgICAgICAgICAgY2hhckNvdW50Kys7CiAgICAgICAgfQogICAgfQogICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nVHJpbW1lZCA9IG5ldyBieXRlcyhjaGFyQ291bnQpOwogICAgZm9yIChqID0gMDsgaiA8IGNoYXJDb3VudDsgaisrKSB7CiAgICAgICAgYnl0ZXNTdHJpbmdUcmltbWVkW2pdID0gYnl0ZXNTdHJpbmdbal07CiAgICB9CiAgICByZXR1cm4gc3RyaW5nKGJ5dGVzU3RyaW5nVHJpbW1lZCk7CiAgfQoKICBmdW5jdGlvbiBfc3RyaW5nVG9CeXRlczMyKHN0cmluZyBzb3VyY2UpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgIGJ5dGVzIG1lbW9yeSB0ZW1wRW1wdHlTdHJpbmdUZXN0ID0gYnl0ZXMoc291cmNlKTsKICAgIGlmICh0ZW1wRW1wdHlTdHJpbmdUZXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgcmV0dXJuIDB4MDsKICAgIH0KCiAgICBhc3NlbWJseSB7CiAgICAgICAgcmVzdWx0IDo9IG1sb2FkKGFkZChzb3VyY2UsIDMyKSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShfZnJvbSA9PSBhc3Ryb0luZGV4VG9Pd25lcnNbX3Rva2VuSWRdKTsKICAgIHJlcXVpcmUoX2Zyb20gIT0gX3RvICYmIF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50IHBvb2xJZHg7CiAgICBBc3Ryb1R5cGUgaXRlbVR5cGU7CiAgICAocG9vbElkeCwgaXRlbVR5cGUpID0gX2V4dHJhY3RJbmRleChpZFRvSW5kZXhbX3Rva2VuSWRdKTsKICAgIHZhciBwb29sID0gX2dldEFzdHJvUG9vbEJ5VHlwZShpdGVtVHlwZSk7CiAgICB2YXIgYXN0cm8gPSBwb29sW3Bvb2xJZHhdOwogICAgcmVxdWlyZShfZ2V0QXN0cm9UeXBlQnlDb2RlKGFzdHJvLmNvZGUpICE9IEFzdHJvVHlwZS5EaXNtaXNzZWQpOwoKICAgIGFzdHJvSW5kZXhUb093bmVyc1tfdG9rZW5JZF0gPSBfdG87CgogICAgX3JlbW92ZUFzdHJvRnJvbVVzZXIoX2Zyb20sIF90b2tlbklkKTsKICAgIF9hZGRBc3Ryb1RvVXNlcihfdG8sIF90b2tlbklkKTsKCiAgICAvLyBDaGVjayBpZiBpdCdzIGZhbW91cyBzdGFyCiAgICB1aW50IGZhbWVkSUQgPSBfZ2V0RmFtZWRJREJ5Q29kZShhc3Ryby5jb2RlKTsKICAgIGlmIChmYW1lZElEID4gMCkgewogICAgICB2YXIgZmFtZWRzdGFyQ29udHJhY3QgPSBGYW1lZFN0YXJJbnRlcmZhY2UoZmFtZWRTdGFyQWRkcmVzcyk7CiAgICAgIGZhbWVkc3RhckNvbnRyYWN0LnVwZGF0ZUZhbWVkU3Rhck93bmVyKGZhbWVkSUQsIF90byk7CiAgICB9CiAgfQoKICAvLyBQdXJjaGFzZSBhY3Rpb24gb25seSBwZXJtaXQgbWFuYWdlciB0byB1c2UKICBmdW5jdGlvbiBwdXJjaGFzZVN1cGVybm92YShhZGRyZXNzIHRhcmdldEFkZHJlc3MsIHVpbnQgcHJpY2UpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIHsKICAgIHJlcXVpcmUoc3VwZXJOb3ZhU3VwcGx5ID49IDEpOwogICAgTm92YUNvaW4gbm92YUNvaW5Db250cmFjdCA9IE5vdmFDb2luKG5vdmFDb2luQWRkcmVzcyk7CiAgICByZXF1aXJlKG5vdmFDb2luQ29udHJhY3QuYmFsYW5jZU9mKHRhcmdldEFkZHJlc3MpID49IHByaWNlKTsKICAgIG5vdmFDb2luQ29udHJhY3QuY29uc3VtZUNvaW5Gb3JOb3ZhKHRhcmdldEFkZHJlc3MsIHByaWNlKTsKCiAgICBzdXBlck5vdmFTdXBwbHkgLT0gMTsKICAgIHZhciBuZXdOb3ZhSUQgPSBfaW5zZXJ0TmV3QXN0cm8odGFyZ2V0QWRkcmVzcywgQXN0cm9UeXBlLlN1cGVybm92YSwgMCwgMCwgMCk7CiAgICBQdXJjaGFzZWRTdXBlcm5vdmEodGFyZ2V0QWRkcmVzcywgbmV3Tm92YUlEKTsKICB9CgogIC8vIGV4cGxvZGUgb25lIHN1cGVybm92YSBmcm9tIHVzZXIncyBzdXBlcm5vdmEgYmFsYW5jZSwgd3JpdGUgZXhwbG9kZSByZXN1bHQgaW50byB1c2VyIGFjY291bnQKICBmdW5jdGlvbiBleHBsb2RlU3VwZXJub3ZhKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnQgbm92YUlEKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICAvLyB2ZXJpZnUgaWYgdXNlciBvd24ncyB0aGlzIHN1cGVybm92YQogICAgcmVxdWlyZShhc3Ryb0luZGV4VG9Pd25lcnNbbm92YUlEXSA9PSB1c2VyQWRkcmVzcyk7CiAgICB1aW50IHBvb2xJZHg7CiAgICBBc3Ryb1R5cGUgaXRlbVR5cGU7CiAgICAocG9vbElkeCwgaXRlbVR5cGUpID0gX2V4dHJhY3RJbmRleChpZFRvSW5kZXhbbm92YUlEXSk7CiAgICByZXF1aXJlKGl0ZW1UeXBlID09IEFzdHJvVHlwZS5TdXBlcm5vdmEpOwogICAgLy8gYnVybiBkb3duIHVzZXIncyBzdXBlcm5vdmEKICAgIF9idXJuRG93bkFzdHJvKHVzZXJBZGRyZXNzLCBub3ZhSUQpOwoKICAgIHVpbnRbXSBtZW1vcnkgbmV3QXN0cm9JRHM7CgogICAgdmFyIGxhYkNvbnRyYWN0ID0gTm92YUxhYkludGVyZmFjZShsYWJBZGRyZXNzKTsKICAgIHVpbnQgc3RhciA9IGxhYkNvbnRyYWN0LmJvcm5TdGFyKCk7CiAgICBpZiAoc3RhciA+IDApIHsKICAgICAgICAvLyBHb3Qgc3RhciwgY2hlY2sgaWYgaXQncyBmYW1lZCBzdGFyCiAgICAgICAgbmV3QXN0cm9JRHMgPSBuZXcgdWludFtdKDEpOwogICAgICAgIHZhciBmYW1lZHN0YXJDb250cmFjdCA9IEZhbWVkU3RhckludGVyZmFjZShmYW1lZFN0YXJBZGRyZXNzKTsKICAgICAgICB1aW50IGZhbWVkSUQ7CiAgICAgICAgYnl0ZXMzMiBub3ZhTmFtZTsKICAgICAgICAoZmFtZWRJRCwgbm92YU5hbWUpID0gZmFtZWRzdGFyQ29udHJhY3QuYm9ybkZhbWVkU3Rhcih1c2VyQWRkcmVzcywgc3Rhcik7CiAgICAgICAgaWYgKGZhbWVkSUQgPiAwKSB7CiAgICAgICAgICAgIG5ld0FzdHJvSURzWzBdID0gX2luc2VydE5ld0FzdHJvKHVzZXJBZGRyZXNzLCBBc3Ryb1R5cGUuRmFtZWRTdGFyLCBzdGFyLCBub3ZhTmFtZSwgZmFtZWRJRCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3QXN0cm9JRHNbMF0gPSBfaW5zZXJ0TmV3QXN0cm8odXNlckFkZHJlc3MsIEFzdHJvVHlwZS5Ob3JtYWxTdGFyLCBzdGFyLCAwLCAwKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHVpbnQgbU51bSA9IGxhYkNvbnRyYWN0LmJvcm5NZXRlb3JpdGVOdW1iZXIoKTsKICAgICAgICBuZXdBc3Ryb0lEcyA9IG5ldyB1aW50W10obU51bSk7CiAgICAgICAgdWludCBtOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1OdW07IGkrKykgewogICAgICAgICAgICBtID0gbGFiQ29udHJhY3QuYm9ybk1ldGVvcml0ZSgpOwogICAgICAgICAgICBuZXdBc3Ryb0lEc1tpXSA9IF9pbnNlcnROZXdBc3Rybyh1c2VyQWRkcmVzcywgQXN0cm9UeXBlLk1ldGVvcml0ZSwgbSwgMCwgMCk7CiAgICAgICAgfQogICAgfQogICAgRXhwbG9kZWRTdXBlcm5vdmEodXNlckFkZHJlc3MsIG5ld0FzdHJvSURzKTsKICB9CgogIGZ1bmN0aW9uIF9tZXJnZShhZGRyZXNzIHVzZXJBZGRyZXNzLCB1aW50IG1lcmdlTWFzcykgaW50ZXJuYWwgcmV0dXJucyAodWludCBmYW1lZElELCBieXRlczMyIG5vdmFOYW1lLCBBc3Ryb1R5cGUgbmV3VHlwZSwgdWludCBmaW5hbE1hc3MpIHsKICAgIHZhciBsYWJDb250cmFjdCA9IE5vdmFMYWJJbnRlcmZhY2UobGFiQWRkcmVzcyk7CiAgICBib29sIG1lcmdlUmVzdWx0OwogICAgKG1lcmdlUmVzdWx0LCBmaW5hbE1hc3MpID0gbGFiQ29udHJhY3QubWVyZ2VNZXRlb3JpdGUobWVyZ2VNYXNzKTsKICAgIGlmIChtZXJnZVJlc3VsdCkgewogICAgICAgIC8vZ290IHN0YXIsIGNoZWNrIGlmIHdlIGNhbiBnZXQgZmFtZWQgc3RhcgogICAgICAgIHZhciBmYW1lZHN0YXJDb250cmFjdCA9IEZhbWVkU3RhckludGVyZmFjZShmYW1lZFN0YXJBZGRyZXNzKTsKICAgICAgICAoZmFtZWRJRCwgbm92YU5hbWUpID0gZmFtZWRzdGFyQ29udHJhY3QuYm9ybkZhbWVkU3Rhcih1c2VyQWRkcmVzcywgbWVyZ2VNYXNzKTsKICAgICAgICBpZiAoZmFtZWRJRCA+IDApIHsKICAgICAgICAgICAgbmV3VHlwZSA9IEFzdHJvVHlwZS5GYW1lZFN0YXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3VHlwZSA9IEFzdHJvVHlwZS5Ob3JtYWxTdGFyOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgbmV3VHlwZSA9IEFzdHJvVHlwZS5NZXRlb3JpdGU7CiAgICB9CiAgICByZXR1cm47CiAgfQoKICBmdW5jdGlvbiBfY29tYmluZShhZGRyZXNzIHVzZXJBZGRyZXNzLCB1aW50W10gYXN0cm9JRHMpIGludGVybmFsIHJldHVybnModWludCBtZXJnZU1hc3MpIHsKICAgIHVpbnQgYXN0cm9JRDsKICAgIG1lcmdlTWFzcyA9IDA7CiAgICB1aW50IHBvb2xJZHg7CiAgICBBc3Ryb1R5cGUgaXRlbVR5cGU7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhc3Ryb0lEcy5sZW5ndGg7IGkrKykgewogICAgICAgIGFzdHJvSUQgPSBhc3Ryb0lEc1tpXTsKICAgICAgICAocG9vbElkeCwgaXRlbVR5cGUpID0gX2V4dHJhY3RJbmRleChpZFRvSW5kZXhbYXN0cm9JRF0pOwogICAgICAgIHJlcXVpcmUoYXN0cm9JbmRleFRvT3duZXJzW2FzdHJvSURdID09IHVzZXJBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGl0ZW1UeXBlID09IEFzdHJvVHlwZS5NZXRlb3JpdGUpOwogICAgICAgIC8vIHN0YXJ0IG1lcmdlCiAgICAgICAgLy9tZXJnZU1hc3MgKz0gbWV0ZW9yaXRlc1tpZFRvSW5kZXhbYXN0cm9JRF0uaW5kZXhdLm1hc3M7CiAgICAgICAgbWVyZ2VNYXNzICs9IF9nZXRNYXNzQnlDb2RlKG1ldGVvcml0ZXNbcG9vbElkeF0uY29kZSk7CiAgICAgICAgLy8gQnVybiBkb3duCiAgICAgICAgX2J1cm5Eb3duQXN0cm8odXNlckFkZHJlc3MsIGFzdHJvSUQpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbWVyZ2VBc3Ryb3MoYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludCBub3ZhQ29pbkNlbnRDb3N0LCB1aW50W10gYXN0cm9JRHMpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIHsKICAgIC8vIGNoZWNrIG5vdmEgY29pbiBiYWxhbmNlCiAgICBOb3ZhQ29pbiBub3ZhQ29pbkNvbnRyYWN0ID0gTm92YUNvaW4obm92YUNvaW5BZGRyZXNzKTsKICAgIHJlcXVpcmUobm92YUNvaW5Db250cmFjdC5iYWxhbmNlT2YodXNlckFkZHJlc3MpID49IG5vdmFDb2luQ2VudENvc3QpOwogICAgLy8gY2hlY2sgYXN0cm9zCiAgICByZXF1aXJlKGFzdHJvSURzLmxlbmd0aCA+IDEgJiYgYXN0cm9JRHMubGVuZ3RoIDw9IDEwKTsKCiAgICB1aW50IG1lcmdlTWFzcyA9IF9jb21iaW5lKHVzZXJBZGRyZXNzLCBhc3Ryb0lEcyk7CiAgICAvLyBDb25zdW1lIG5vdmFDb2luCiAgICBub3ZhQ29pbkNvbnRyYWN0LmNvbnN1bWVDb2luRm9yTm92YSh1c2VyQWRkcmVzcywgbm92YUNvaW5DZW50Q29zdCk7CiAgICAvLyBzdGFydCBtZXJnZQogICAgdWludCBmYW1lZElEOwogICAgYnl0ZXMzMiBub3ZhTmFtZTsKICAgIEFzdHJvVHlwZSBuZXdUeXBlOwogICAgdWludCBmaW5hbE1hc3M7CiAgICAoZmFtZWRJRCwgbm92YU5hbWUsIG5ld1R5cGUsIGZpbmFsTWFzcykgPSBfbWVyZ2UodXNlckFkZHJlc3MsIG1lcmdlTWFzcyk7CiAgICAvLyBDcmVhdGUgbmV3IEFzdHJvCiAgICBNZXJnZWRBc3Ryb3ModXNlckFkZHJlc3MsIF9pbnNlcnROZXdBc3Rybyh1c2VyQWRkcmVzcywgbmV3VHlwZSwgZmluYWxNYXNzLCBub3ZhTmFtZSwgZmFtZWRJRCkpOwogIH0KCiAgZnVuY3Rpb24gX2F0dHJhY3RCYWxhbmNlQ2hlY2soYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludCBub3ZhQ29pbkNlbnRDb3N0KSBpbnRlcm5hbCB7CiAgICAvLyBjaGVjayBiYWxhbmNlCiAgICBOb3ZhQ29pbiBub3ZhQ29pbkNvbnRyYWN0ID0gTm92YUNvaW4obm92YUNvaW5BZGRyZXNzKTsKICAgIHJlcXVpcmUobm92YUNvaW5Db250cmFjdC5iYWxhbmNlT2YodXNlckFkZHJlc3MpID49IG5vdmFDb2luQ2VudENvc3QpOwoKICAgIC8vIGNvbnN1bWUgY29pbgogICAgbm92YUNvaW5Db250cmFjdC5jb25zdW1lQ29pbkZvck5vdmEodXNlckFkZHJlc3MsIG5vdmFDb2luQ2VudENvc3QpOwogIH0KCiAgZnVuY3Rpb24gYXR0cmFjdE1ldGVvcml0ZXMoYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludCBub3ZhQ29pbkNlbnRDb3N0LCB1aW50IHN0YXJJRCkgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgcmVxdWlyZShhc3Ryb0luZGV4VG9Pd25lcnNbc3RhcklEXSA9PSB1c2VyQWRkcmVzcyk7CiAgICB1aW50IHBvb2xJZHg7CiAgICBBc3Ryb1R5cGUgaXRlbVR5cGU7CiAgICAocG9vbElkeCwgaXRlbVR5cGUpID0gX2V4dHJhY3RJbmRleChpZFRvSW5kZXhbc3RhcklEXSk7CgogICAgcmVxdWlyZShpdGVtVHlwZSA9PSBBc3Ryb1R5cGUuTm9ybWFsU3RhciB8fCBpdGVtVHlwZSA9PSBBc3Ryb1R5cGUuRmFtZWRTdGFyKTsKCiAgICB2YXIgYXN0cm9Qb29sID0gX2dldEFzdHJvUG9vbEJ5VHlwZShpdGVtVHlwZSk7CiAgICBBc3RybyBzdG9yYWdlIGFzdHJvID0gYXN0cm9Qb29sW3Bvb2xJZHhdOwogICAgcmVxdWlyZShhc3Ryby5uZXh0QXR0cmFjdFRpbWUgPD0gYmxvY2sudGltZXN0YW1wKTsKCiAgICBfYXR0cmFjdEJhbGFuY2VDaGVjayh1c2VyQWRkcmVzcywgbm92YUNvaW5DZW50Q29zdCk7CgogICAgdmFyIGxhYkNvbnRyYWN0ID0gTm92YUxhYkludGVyZmFjZShsYWJBZGRyZXNzKTsKICAgIHVpbnRbXSBtZW1vcnkgbmV3QXN0cm9JRHMgPSBuZXcgdWludFtdKDEpOwogICAgdWludCBtID0gbGFiQ29udHJhY3QuYm9ybk1ldGVvcml0ZSgpOwogICAgbmV3QXN0cm9JRHNbMF0gPSBfaW5zZXJ0TmV3QXN0cm8odXNlckFkZHJlc3MsIEFzdHJvVHlwZS5NZXRlb3JpdGUsIG0sIDAsIDApOwogICAgLy8gdXBkYXRlIGNkCiAgICB1aW50IGNkSWR4ID0gX2dldENkSWR4QnlDb2RlKGFzdHJvLmNvZGUpOwogICAgaWYgKGNkSWR4ID49IGNkLmxlbmd0aCAtIDEpIHsKICAgICAgICBhc3Ryby5uZXh0QXR0cmFjdFRpbWUgPSBibG9jay50aW1lc3RhbXAgKyBjZFtjZC5sZW5ndGggLSAxXTsKICAgIH0gZWxzZSB7CiAgICAgICAgYXN0cm8uY29kZSA9IF91cGRhdGVDZElkeEZvckNvZGUoYXN0cm8uY29kZSwgKytjZElkeCk7CiAgICAgICAgYXN0cm8ubmV4dEF0dHJhY3RUaW1lID0gYmxvY2sudGltZXN0YW1wICsgY2RbY2RJZHhdOwogICAgfQoKICAgIEF0dHJhY3RlZE1ldGVvcml0ZXModXNlckFkZHJlc3MsIG5ld0FzdHJvSURzKTsKICB9CgogIGZ1bmN0aW9uIHNldFB1cmNoYXNpbmcoYWRkcmVzcyBidXllckFkZHJlc3MsIGFkZHJlc3Mgb3duZXJBZGRyZXNzLCB1aW50IGFzdHJvSUQsIHVpbnQgcHJpY2VXZWkpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIHsKICAgIHJlcXVpcmUoYXN0cm9JbmRleFRvT3duZXJzW2FzdHJvSURdID09IG93bmVyQWRkcmVzcyk7CiAgICBwdXJjaGFzaW5nQnV5ZXJbYnV5ZXJBZGRyZXNzXSA9IFB1cmNoYXNpbmdSZWNvcmQoewogICAgICAgICBpZDogYXN0cm9JRCwKICAgICAgICAgcHJpY2VXZWk6IHByaWNlV2VpLAogICAgICAgICB0aW1lOiBibG9jay50aW1lc3RhbXAKICAgIH0pOwogICAgTm92YVB1cmNoYXNpbmcoYnV5ZXJBZGRyZXNzLCBhc3Ryb0lELCBwcmljZVdlaSk7CiAgfQoKICBmdW5jdGlvbiB1c2VyUHVyY2hhc2VBc3RybyhhZGRyZXNzIG93bmVyQWRkcmVzcywgdWludCBhc3Ryb0lEKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgIC8vIGNoZWNrIHZhbGlkIHB1cmNoYXNpbmcgdGltCiAgICByZXF1aXJlKG1zZy5zZW5kZXIuYmFsYW5jZSA+PSBtc2cudmFsdWUpOwogICAgdmFyIHJlY29yZCA9IHB1cmNoYXNpbmdCdXllclttc2cuc2VuZGVyXTsKICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDwgcmVjb3JkLnRpbWUgKyBwcmljZVZhbGlkU2Vjb25kcyk7CiAgICByZXF1aXJlKHJlY29yZC5pZCA9PSBhc3Ryb0lEKTsKICAgIHJlcXVpcmUocmVjb3JkLnByaWNlV2VpIDw9IG1zZy52YWx1ZSk7CgogICAgdWludCByb3lhbHRpZXMgPSB1aW50KG1zZy52YWx1ZSAqIG5vdmFUcmFuc2ZlclJhdGUgLyAxMDAwKTsKICAgIG93bmVyQWRkcmVzcy50cmFuc2Zlcihtc2cudmFsdWUgLSByb3lhbHRpZXMpOwogICAgY2ZvQWRkcmVzcy50cmFuc2Zlcihyb3lhbHRpZXMpOwoKICAgIF90cmFuc2Zlcihvd25lckFkZHJlc3MsIG1zZy5zZW5kZXIsIGFzdHJvSUQpOwoKICAgIFVzZXJQdXJjaGFzZWRBc3Rybyhtc2cuc2VuZGVyLCBvd25lckFkZHJlc3MsIGFzdHJvSUQsIHJlY29yZC5wcmljZVdlaSwgbXNnLnZhbHVlKTsKICAgIC8vIGNsZWFyIHB1cmNoYXNpbmcgc3RhdGUKICAgIGRlbGV0ZSBwdXJjaGFzaW5nQnV5ZXJbbXNnLnNlbmRlcl07CiAgfQp9'.
	

]
