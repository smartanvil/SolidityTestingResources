Class {
	#name : #SRT3b03bfac807ef159d64a09420ed67848e2160232,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3b03bfac807ef159d64a09420ed67848e2160232 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyA9PT09IE9wZW4gWmVwcGVsaW4gbGlicmFyeSA9PT0KCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIFNhZmVFUkMyMAogKiBAZGV2IFdyYXBwZXJzIGFyb3VuZCBFUkMyMCBvcGVyYXRpb25zIHRoYXQgdGhyb3cgb24gZmFpbHVyZS4KICogVG8gdXNlIHRoaXMgbGlicmFyeSB5b3UgY2FuIGFkZCBhIGB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwO2Agc3RhdGVtZW50IHRvIHlvdXIgY29udHJhY3QsCiAqIHdoaWNoIGFsbG93cyB5b3UgdG8gY2FsbCB0aGUgc2FmZSBvcGVyYXRpb25zIGFzIGB0b2tlbi5zYWZlVHJhbnNmZXIoLi4uKWAsIGV0Yy4KICovCmxpYnJhcnkgU2FmZUVSQzIwIHsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXIoRVJDMjBCYXNpYyB0b2tlbiwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShFUkMyMCB0b2tlbiwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgQ29udHJhY3RzIHRoYXQgc2hvdWxkIG5vdCBvd24gRXRoZXIKICogQGF1dGhvciBSZW1jbyBCbG9lbWVuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjdiMDkxZTE2MTgxNDNiNDkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+z4AuY29tPgogKiBAZGV2IFRoaXMgdHJpZXMgdG8gYmxvY2sgaW5jb21pbmcgZXRoZXIgdG8gcHJldmVudCBhY2NpZGVudGFsIGxvc3Mgb2YgRXRoZXIuIFNob3VsZCBFdGhlciBlbmQgdXAKICogaW4gdGhlIGNvbnRyYWN0LCBpdCB3aWxsIGFsbG93IHRoZSBvd25lciB0byByZWNsYWltIHRoaXMgZXRoZXIuCiAqIEBub3RpY2UgRXRoZXIgY2FuIHN0aWxsIGJlIHNlbmQgdG8gdGhpcyBjb250cmFjdCBieToKICogY2FsbGluZyBmdW5jdGlvbnMgbGFiZWxlZCBgcGF5YWJsZWAKICogYHNlbGZkZXN0cnVjdChjb250cmFjdF9hZGRyZXNzKWAKICogbWluaW5nIGRpcmVjdGx5IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzCiovCmNvbnRyYWN0IEhhc05vRXRoZXIgaXMgT3duYWJsZSB7CgogIC8qKgogICogQGRldiBDb25zdHJ1Y3RvciB0aGF0IHJlamVjdHMgaW5jb21pbmcgRXRoZXIKICAqIEBkZXYgVGhlIGBwYXlhYmxlYCBmbGFnIGlzIGFkZGVkIHNvIHdlIGNhbiBhY2Nlc3MgYG1zZy52YWx1ZWAgd2l0aG91dCBjb21waWxlciB3YXJuaW5nLiBJZiB3ZQogICogbGVhdmUgb3V0IHBheWFibGUsIHRoZW4gU29saWRpdHkgd2lsbCBhbGxvdyBpbmhlcml0aW5nIGNvbnRyYWN0cyB0byBpbXBsZW1lbnQgYSBwYXlhYmxlCiAgKiBjb25zdHJ1Y3Rvci4gQnkgZG9pbmcgaXQgdGhpcyB3YXkgd2UgcHJldmVudCBhIHBheWFibGUgY29uc3RydWN0b3IgZnJvbSB3b3JraW5nLiBBbHRlcm5hdGl2ZWx5CiAgKiB3ZSBjb3VsZCB1c2UgYXNzZW1ibHkgdG8gYWNjZXNzIG1zZy52YWx1ZS4KICAqLwogIGZ1bmN0aW9uIEhhc05vRXRoZXIoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGlzYWxsb3dzIGRpcmVjdCBzZW5kIGJ5IHNldHRpbmdzIGEgZGVmYXVsdCBmdW5jdGlvbiB3aXRob3V0IHRoZSBgcGF5YWJsZWAgZmxhZy4KICAgKi8KICBmdW5jdGlvbigpIGV4dGVybmFsIHsKICB9CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgYWxsIEV0aGVyIGhlbGQgYnkgdGhlIGNvbnRyYWN0IHRvIHRoZSBvd25lci4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltRXRoZXIoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgYXNzZXJ0KG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgfQp9CgovKioKICogQHRpdGxlIENvbnRyYWN0cyB0aGF0IHNob3VsZCBub3Qgb3duIENvbnRyYWN0cwogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iODJmMGU3ZWZlMWVkYzJiMCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj7PgC5jb20+CiAqIEBkZXYgU2hvdWxkIGNvbnRyYWN0cyAoYW55dGhpbmcgT3duYWJsZSkgZW5kIHVwIGJlaW5nIG93bmVkIGJ5IHRoaXMgY29udHJhY3QsIGl0IGFsbG93cyB0aGUgb3duZXIKICogb2YgdGhpcyBjb250cmFjdCB0byByZWNsYWltIG93bmVyc2hpcCBvZiB0aGUgY29udHJhY3RzLgogKi8KY29udHJhY3QgSGFzTm9Db250cmFjdHMgaXMgT3duYWJsZSB7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBvd25lcnNoaXAgb2YgT3duYWJsZSBjb250cmFjdHMKICAgKiBAcGFyYW0gY29udHJhY3RBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBPd25hYmxlIHRvIGJlIHJlY2xhaW1lZC4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBPd25hYmxlIGNvbnRyYWN0SW5zdCA9IE93bmFibGUoY29udHJhY3RBZGRyKTsKICAgIGNvbnRyYWN0SW5zdC50cmFuc2Zlck93bmVyc2hpcChvd25lcik7CiAgfQp9CgovKioKICogQHRpdGxlIENvbnRyYWN0cyB0aGF0IHNob3VsZCBiZSBhYmxlIHRvIHJlY292ZXIgdG9rZW5zCiAqIEBhdXRob3IgU3lsVGkKICogQGRldiBUaGlzIGFsbG93IGEgY29udHJhY3QgdG8gcmVjb3ZlciBhbnkgRVJDMjAgdG9rZW4gcmVjZWl2ZWQgaW4gYSBjb250cmFjdCBieSB0cmFuc2ZlcnJpbmcgdGhlIGJhbGFuY2UgdG8gdGhlIGNvbnRyYWN0IG93bmVyLgogKiBUaGlzIHdpbGwgcHJldmVudCBhbnkgYWNjaWRlbnRhbCBsb3NzIG9mIHRva2Vucy4KICovCmNvbnRyYWN0IENhblJlY2xhaW1Ub2tlbiBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBhbGwgRVJDMjBCYXNpYyBjb21wYXRpYmxlIHRva2VucwogICAqIEBwYXJhbSB0b2tlbiBFUkMyMEJhc2ljIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAqLwogIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbihFUkMyMEJhc2ljIHRva2VuKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgdG9rZW4uc2FmZVRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICB9Cgp9CgovKioKICogQHRpdGxlIENvbnRyYWN0cyB0aGF0IHNob3VsZCBub3Qgb3duIFRva2VucwogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNzgwYTFkMTUxYjE3Mzg0YSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj7PgC5jb20+CiAqIEBkZXYgVGhpcyBibG9ja3MgaW5jb21pbmcgRVJDMjMgdG9rZW5zIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBsb3NzIG9mIHRva2Vucy4KICogU2hvdWxkIHRva2VucyAoYW55IEVSQzIwQmFzaWMgY29tcGF0aWJsZSkgZW5kIHVwIGluIHRoZSBjb250cmFjdCwgaXQgYWxsb3dzIHRoZQogKiBvd25lciB0byByZWNsYWltIHRoZSB0b2tlbnMuCiAqLwpjb250cmFjdCBIYXNOb1Rva2VucyBpcyBDYW5SZWNsYWltVG9rZW4gewoKIC8qKgogICogQGRldiBSZWplY3QgYWxsIEVSQzIzIGNvbXBhdGlibGUgdG9rZW5zCiAgKiBAcGFyYW0gZnJvbV8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IGlzIHRyYW5zZmVycmluZyB0aGUgdG9rZW5zCiAgKiBAcGFyYW0gdmFsdWVfIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0aGUgc3BlY2lmaWVkIHRva2VuCiAgKiBAcGFyYW0gZGF0YV8gQnl0ZXMgVGhlIGRhdGEgcGFzc2VkIGZyb20gdGhlIGNhbGxlci4KICAqLwogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBmcm9tXywgdWludDI1NiB2YWx1ZV8sIGJ5dGVzIGRhdGFfKSBwdXJlIGV4dGVybmFsIHsKICAgIGZyb21fOwogICAgdmFsdWVfOwogICAgZGF0YV87CiAgICByZXZlcnQoKTsKICB9Cgp9CgovKioKICogQHRpdGxlIEJhc2UgY29udHJhY3QgZm9yIGNvbnRyYWN0cyB0aGF0IHNob3VsZCBub3Qgb3duIHRoaW5ncy4KICogQGF1dGhvciBSZW1jbyBCbG9lbWVuIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijg4ZmFlZGU1ZWJlN2M4YmEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+z4AuY29tPgogKiBAZGV2IFNvbHZlcyBhIGNsYXNzIG9mIGVycm9ycyB3aGVyZSBhIGNvbnRyYWN0IGFjY2lkZW50YWxseSBiZWNvbWVzIG93bmVyIG9mIEV0aGVyLCBUb2tlbnMgb3IKICogT3duZWQgY29udHJhY3RzLiBTZWUgcmVzcGVjdGl2ZSBiYXNlIGNvbnRyYWN0cyBmb3IgZGV0YWlscy4KICovCmNvbnRyYWN0IE5vT3duZXIgaXMgSGFzTm9FdGhlciwgSGFzTm9Ub2tlbnMsIEhhc05vQ29udHJhY3RzIHsKfQoKLyoqCiAqIEB0aXRsZSBEZXN0cnVjdGlibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHRoYXQgY2FuIGJlIGRlc3Ryb3llZCBieSBvd25lci4gQWxsIGZ1bmRzIGluIGNvbnRyYWN0IHdpbGwgYmUgc2VudCB0byB0aGUgb3duZXIuCiAqLwpjb250cmFjdCBEZXN0cnVjdGlibGUgaXMgT3duYWJsZSB7CgogIGZ1bmN0aW9uIERlc3RydWN0aWJsZSgpIHB1YmxpYyBwYXlhYmxlIHsgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVycyB0aGUgY3VycmVudCBiYWxhbmNlIHRvIHRoZSBvd25lciBhbmQgdGVybWluYXRlcyB0aGUgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gZGVzdHJveSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgc2VsZmRlc3RydWN0KG93bmVyKTsKICB9CgogIGZ1bmN0aW9uIGRlc3Ryb3lBbmRTZW5kKGFkZHJlc3MgX3JlY2lwaWVudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICBzZWxmZGVzdHJ1Y3QoX3JlY2lwaWVudCk7CiAgfQp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgovKioKICogQHRpdGxlIE1pbnRhYmxlIHRva2VuCiAqIEBkZXYgU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggbWludGFibGUgdG9rZW4gY3JlYXRpb24KICogQGRldiBJc3N1ZTogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2lzc3Vlcy8xMjAKICogQmFzZWQgb24gY29kZSBieSBUb2tlbk1hcmtldE5ldDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9jb250cmFjdHMvTWludGFibGVUb2tlbi5zb2wKICovCgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBUb2tlblZlc3RpbmcKICogQGRldiBBIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IGNhbiByZWxlYXNlIGl0cyB0b2tlbiBiYWxhbmNlIGdyYWR1YWxseSBsaWtlIGEKICogdHlwaWNhbCB2ZXN0aW5nIHNjaGVtZSwgd2l0aCBhIGNsaWZmIGFuZCB2ZXN0aW5nIHBlcmlvZC4gT3B0aW9uYWxseSByZXZvY2FibGUgYnkgdGhlCiAqIG93bmVyLgogKi8KY29udHJhY3QgVG9rZW5WZXN0aW5nIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgZXZlbnQgUmVsZWFzZWQodWludDI1NiBhbW91bnQpOwogIGV2ZW50IFJldm9rZWQoKTsKCiAgLy8gYmVuZWZpY2lhcnkgb2YgdG9rZW5zIGFmdGVyIHRoZXkgYXJlIHJlbGVhc2VkCiAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CgogIHVpbnQyNTYgcHVibGljIGNsaWZmOwogIHVpbnQyNTYgcHVibGljIHN0YXJ0OwogIHVpbnQyNTYgcHVibGljIGR1cmF0aW9uOwoKICBib29sIHB1YmxpYyByZXZvY2FibGU7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlbGVhc2VkOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJldm9rZWQ7CgogIC8qKgogICAqIEBkZXYgQ3JlYXRlcyBhIHZlc3RpbmcgY29udHJhY3QgdGhhdCB2ZXN0cyBpdHMgYmFsYW5jZSBvZiBhbnkgRVJDMjAgdG9rZW4gdG8gdGhlCiAgICogX2JlbmVmaWNpYXJ5LCBncmFkdWFsbHkgaW4gYSBsaW5lYXIgZmFzaGlvbiB1bnRpbCBfc3RhcnQgKyBfZHVyYXRpb24uIEJ5IHRoZW4gYWxsCiAgICogb2YgdGhlIGJhbGFuY2Ugd2lsbCBoYXZlIHZlc3RlZC4KICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IGFkZHJlc3Mgb2YgdGhlIGJlbmVmaWNpYXJ5IHRvIHdob20gdmVzdGVkIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgKiBAcGFyYW0gX2NsaWZmIGR1cmF0aW9uIGluIHNlY29uZHMgb2YgdGhlIGNsaWZmIGluIHdoaWNoIHRva2VucyB3aWxsIGJlZ2luIHRvIHZlc3QKICAgKiBAcGFyYW0gX2R1cmF0aW9uIGR1cmF0aW9uIGluIHNlY29uZHMgb2YgdGhlIHBlcmlvZCBpbiB3aGljaCB0aGUgdG9rZW5zIHdpbGwgdmVzdAogICAqIEBwYXJhbSBfcmV2b2NhYmxlIHdoZXRoZXIgdGhlIHZlc3RpbmcgaXMgcmV2b2NhYmxlIG9yIG5vdAogICAqLwogIGZ1bmN0aW9uIFRva2VuVmVzdGluZyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3RhcnQsIHVpbnQyNTYgX2NsaWZmLCB1aW50MjU2IF9kdXJhdGlvbiwgYm9vbCBfcmV2b2NhYmxlKSBwdWJsaWMgewogICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF9jbGlmZiA8PSBfZHVyYXRpb24pOwoKICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogICAgcmV2b2NhYmxlID0gX3Jldm9jYWJsZTsKICAgIGR1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgY2xpZmYgPSBfc3RhcnQuYWRkKF9jbGlmZik7CiAgICBzdGFydCA9IF9zdGFydDsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHZlc3RlZCB0b2tlbnMgdG8gYmVuZWZpY2lhcnkuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHsKICAgIHVpbnQyNTYgdW5yZWxlYXNlZCA9IHJlbGVhc2FibGVBbW91bnQodG9rZW4pOwoKICAgIHJlcXVpcmUodW5yZWxlYXNlZCA+IDApOwoKICAgIHJlbGVhc2VkW3Rva2VuXSA9IHJlbGVhc2VkW3Rva2VuXS5hZGQodW5yZWxlYXNlZCk7CgogICAgdG9rZW4uc2FmZVRyYW5zZmVyKGJlbmVmaWNpYXJ5LCB1bnJlbGVhc2VkKTsKCiAgICBSZWxlYXNlZCh1bnJlbGVhc2VkKTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgQWxsb3dzIHRoZSBvd25lciB0byByZXZva2UgdGhlIHZlc3RpbmcuIFRva2VucyBhbHJlYWR5IHZlc3RlZAogICAqIHJlbWFpbiBpbiB0aGUgY29udHJhY3QsIHRoZSByZXN0IGFyZSByZXR1cm5lZCB0byB0aGUgb3duZXIuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJldm9rZShFUkMyMEJhc2ljIHRva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUocmV2b2NhYmxlKTsKICAgIHJlcXVpcmUoIXJldm9rZWRbdG9rZW5dKTsKCiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CgogICAgdWludDI1NiB1bnJlbGVhc2VkID0gcmVsZWFzYWJsZUFtb3VudCh0b2tlbik7CiAgICB1aW50MjU2IHJlZnVuZCA9IGJhbGFuY2Uuc3ViKHVucmVsZWFzZWQpOwoKICAgIHJldm9rZWRbdG9rZW5dID0gdHJ1ZTsKCiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIHJlZnVuZCk7CgogICAgUmV2b2tlZCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGVzIHRoZSBhbW91bnQgdGhhdCBoYXMgYWxyZWFkeSB2ZXN0ZWQgYnV0IGhhc24ndCBiZWVuIHJlbGVhc2VkIHlldC4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzYWJsZUFtb3VudChFUkMyMEJhc2ljIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdmVzdGVkQW1vdW50KHRva2VuKS5zdWIocmVsZWFzZWRbdG9rZW5dKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkLgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiB2ZXN0ZWRBbW91bnQoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjdXJyZW50QmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHVpbnQyNTYgdG90YWxCYWxhbmNlID0gY3VycmVudEJhbGFuY2UuYWRkKHJlbGVhc2VkW3Rva2VuXSk7CgogICAgaWYgKG5vdyA8IGNsaWZmKSB7CiAgICAgIHJldHVybiAwOwogICAgfSBlbHNlIGlmIChub3cgPj0gc3RhcnQuYWRkKGR1cmF0aW9uKSB8fCByZXZva2VkW3Rva2VuXSkgewogICAgICByZXR1cm4gdG90YWxCYWxhbmNlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZS5tdWwobm93LnN1YihzdGFydCkpLmRpdihkdXJhdGlvbik7CiAgICB9CiAgfQp9CgoKLy8gPT09PSBBQUxNIENvbnRyYWN0cyA9PT0KCmNvbnRyYWN0IEFBTE1Ub2tlbiBpcyBNaW50YWJsZVRva2VuLCBOb093bmVyIHsgLy9NaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gJ0FBTE0nOwogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gJ0FsbSBUb2tlbic7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICBhZGRyZXNzIGZvdW5kZXI7ICAgIC8vZm91bmRlciBhZGRyZXNzIHRvIGFsbG93IGhpbSB0cmFuc2ZlciB0b2tlbnMgd2hpbGUgbWludGluZwogICAgZnVuY3Rpb24gaW5pdChhZGRyZXNzIF9mb3VuZGVyKSBvbmx5T3duZXIgcHVibGljewogICAgICAgIGZvdW5kZXIgPSBfZm91bmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHRyYW5zZmVyIG9ubHkgYWZ0ZXIgY3Jvd2RzYWxlIGZpbmlzaGVkCiAgICAgKi8KICAgIG1vZGlmaWVyIGNhblRyYW5zZmVyKCkgewogICAgICAgIHJlcXVpcmUobWludGluZ0ZpbmlzaGVkIHx8IG1zZy5zZW5kZXIgPT0gZm91bmRlcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBjYW5UcmFuc2ZlciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9Cn0KCmNvbnRyYWN0IEFBTE1Dcm93ZHNhbGUgaXMgT3duYWJsZSwgQ2FuUmVjbGFpbVRva2VuLCBEZXN0cnVjdGlibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7ICAgIAoKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IFBFUkNFTlRfRElWSURFUiA9IDEwMDsKCiAgICBzdHJ1Y3QgQnVsa0JvbnVzIHsKICAgICAgICB1aW50MjU2IG1pbkFtb3VudDsgICAgICAvL01pbmltYWwgYW1vdW50IHRvIHJlY2VpdmUgYm9udXMgKGluY2x1ZGluZyB0aGlzIGFtb3VudCkKICAgICAgICB1aW50MzIgYm9udXNQZXJjZW50OyAgICAvL2EgYm9udXMgcGVyY2VudCwgc28gdGhhdCBib251cyA9IGFtb3VudC5tdWwoYm9udXNQZXJjZW50KS5kaXYoUEVSQ0VOVF9ESVZJREVSKQogICAgfQoKICAgIHVpbnQ2NCBwdWJsaWMgc3RhcnRUaW1lc3RhbXA7ICAgLy9Dcm93ZHNhbGUgc3RhcnQgdGltZXN0YW1wCiAgICB1aW50NjQgcHVibGljIGVuZFRpbWVzdGFtcDsgICAgIC8vQ3Jvd2RzYWxlIGVuZCB0aW1lc3RhbXAKICAgIHVpbnQyNTYgcHVibGljIG1pbkNhcDsgICAgICAgICAgLy9taW5pbWFsIGFtb3VudCBvZiBzb2xkIHRva2VucyAoaWYgbm90IHJlYWNoZWQgLSBFVEggbWF5IGJlIHJlZnVuZGVkKQogICAgdWludDI1NiBwdWJsaWMgaGFyZENhcDsgICAgICAgICAvL3RvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXZhaWxhYmxlCiAgICB1aW50MjU2IHB1YmxpYyBiYXNlUmF0ZTsgICAgICAgIC8vaG93IG1hbnkgdG9rZW5zIHdpbGwgYmUgbWludGVkIGZvciAxIEVUSCAobGlrZSAxMDAwIEFBTE0gZm9yIDEgRVRIKSB3aXRob3V0IGJvbnVzZXMKCiAgICB1aW50MzIgcHVibGljIG1heFRpbWVCb251c1BlcmNlbnQ7ICAvL0EgbWF4aW11bSB0aW1lIGJvbnVzIHBlcmNlbnQ6IGF0IHRoZSBzdGFydCBvZiBjcm93ZHNhbGUgdGltZUJvbnVzID0gdmFsdWUubXVsKGJhc2VSYXRlKS5tdWwobWF4VGltZUJvbnVzUGVyY2VudCkuZGl2KFBFUkNFTlRfRElWSURFUikKICAgIHVpbnQzMiBwdWJsaWMgcmVmZXJyZXJCb251c1BlcmNlbnQ7IC8vQSBib251cyBwZXJjZW50IHRoYXQgcmVmZmVyZXIgd2lsbCByZWNlaXZlLCBzbyB0aGF0IHJlZmVycmVyQm9udXMgPSB2YWx1ZS5tdWwoYmFzZVJhdGUpLm11bChyZWZlcnJlckJvbnVzUGVyY2VudCkuZGl2KFBFUkNFTlRfRElWSURFUikKICAgIHVpbnQzMiBwdWJsaWMgcmVmZXJyYWxCb251c1BlcmNlbnQ7IC8vQSBib251cyBwZXJjZW50IHRoYXQgcmVmZmVyYWwgd2lsbCByZWNlaXZlLCBzbyB0aGF0IHJlZmVycmFsQm9udXMgPSB2YWx1ZS5tdWwoYmFzZVJhdGUpLm11bChyZWZlcnJhbEJvbnVzUGVyY2VudCkuZGl2KFBFUkNFTlRfRElWSURFUikKICAgIEJ1bGtCb251c1tdIHB1YmxpYyBidWxrQm9udXNlczsgICAgIC8vQnVsayBCb251c2VzIHNvcnRlZCBieSBldGhlciBhbW91bnQgKG1pbmltYWwgYW1vdW50IGZpcnN0KQogIAoKICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc01pbnRlZDsgICAgLy90b3RhbCBhbW91bnQgb2YgbWludGVkIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZDsgICAgICAvL3RvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCghKSBvbiBJQ08sIGluY2x1ZGluZyBhbGwgYm9udXNlcwogICAgdWludDI1NiBwdWJsaWMgY29sbGVjdGVkRXRoZXI7ICAvL3RvdGFsIGFtb3VudCBvZiBldGhlciBjb2xsZWN0ZWQgZHVyaW5nIElDTyAod2l0aG91dCBQcmUtSUNPKQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBjb250cmlidXRpb25zOyAvL2Ftb3VudCBvZiBldGhlciAoaW4gd2VpKXJlY2VpdmVkIGZyb20gYSBidXllcgoKICAgIEFBTE1Ub2tlbiBwdWJsaWMgdG9rZW47CiAgICBUb2tlblZlc3RpbmcgcHVibGljIGZvdW5kZXJWZXN0aW5nQ29udHJhY3Q7IC8vQ29udHJhY3Qgd2hpY2ggaG9sZHMgRm91bmRlcidzIHRva2VucwoKICAgIGJvb2wgcHVibGljIGZpbmFsaXplZDsKCiAgICBmdW5jdGlvbiBBQUxNQ3Jvd2RzYWxlKHVpbnQ2NCBfc3RhcnRUaW1lc3RhbXAsIHVpbnQ2NCBfZW5kVGltZXN0YW1wLCB1aW50MjU2IF9oYXJkQ2FwLCB1aW50MjU2IF9taW5DYXAsIAogICAgICAgIHVpbnQyNTYgX2ZvdW5kZXJUb2tlbnNJbW1lZGlhdGUsIHVpbnQyNTYgX2ZvdW5kZXJUb2tlbnNWZXN0ZWQsIHVpbnQyNTYgX3Zlc3RpbmdEdXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9iYXNlUmF0ZSwgdWludDMyIF9tYXhUaW1lQm9udXNQZXJjZW50LCB1aW50MzIgX3JlZmVycmVyQm9udXNQZXJjZW50LCB1aW50MzIgX3JlZmVycmFsQm9udXNQZXJjZW50LCAKICAgICAgICB1aW50MjU2W10gYnVsa0JvbnVzTWluQW1vdW50cywgdWludDMyW10gYnVsa0JvbnVzUGVyY2VudHMgCiAgICAgICAgKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZXN0YW1wID4gbm93KTsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWVzdGFtcCA8IF9lbmRUaW1lc3RhbXApOwogICAgICAgIHN0YXJ0VGltZXN0YW1wID0gX3N0YXJ0VGltZXN0YW1wOwogICAgICAgIGVuZFRpbWVzdGFtcCA9IF9lbmRUaW1lc3RhbXA7CgogICAgICAgIHJlcXVpcmUoX2hhcmRDYXAgPiAwKTsKICAgICAgICBoYXJkQ2FwID0gX2hhcmRDYXA7CgogICAgICAgIG1pbkNhcCA9IF9taW5DYXA7CgogICAgICAgIGluaXRSYXRlc0FuZEJvbnVzZXMoX2Jhc2VSYXRlLCBfbWF4VGltZUJvbnVzUGVyY2VudCwgX3JlZmVycmVyQm9udXNQZXJjZW50LCBfcmVmZXJyYWxCb251c1BlcmNlbnQsIGJ1bGtCb251c01pbkFtb3VudHMsIGJ1bGtCb251c1BlcmNlbnRzKTsKCiAgICAgICAgdG9rZW4gPSBuZXcgQUFMTVRva2VuKCk7CiAgICAgICAgdG9rZW4uaW5pdChvd25lcik7CgogICAgICAgIHJlcXVpcmUoX2ZvdW5kZXJUb2tlbnNJbW1lZGlhdGUuYWRkKF9mb3VuZGVyVG9rZW5zVmVzdGVkKSA8IF9oYXJkQ2FwKTsKICAgICAgICBtaW50VG9rZW5zKG93bmVyLCBfZm91bmRlclRva2Vuc0ltbWVkaWF0ZSk7CgogICAgICAgIGZvdW5kZXJWZXN0aW5nQ29udHJhY3QgPSBuZXcgVG9rZW5WZXN0aW5nKG93bmVyLCBlbmRUaW1lc3RhbXAsIDAsIF92ZXN0aW5nRHVyYXRpb24sIGZhbHNlKTsKICAgICAgICBtaW50VG9rZW5zKGZvdW5kZXJWZXN0aW5nQ29udHJhY3QsIF9mb3VuZGVyVG9rZW5zVmVzdGVkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0UmF0ZXNBbmRCb251c2VzKAogICAgICAgIHVpbnQyNTYgX2Jhc2VSYXRlLCB1aW50MzIgX21heFRpbWVCb251c1BlcmNlbnQsIHVpbnQzMiBfcmVmZXJyZXJCb251c1BlcmNlbnQsIHVpbnQzMiBfcmVmZXJyYWxCb251c1BlcmNlbnQsIAogICAgICAgIHVpbnQyNTZbXSBidWxrQm9udXNNaW5BbW91bnRzLCB1aW50MzJbXSBidWxrQm9udXNQZXJjZW50cyAKICAgICAgICApIGludGVybmFsIHsKCiAgICAgICAgcmVxdWlyZShfYmFzZVJhdGUgPiAwKTsKICAgICAgICBiYXNlUmF0ZSA9IF9iYXNlUmF0ZTsKCiAgICAgICAgbWF4VGltZUJvbnVzUGVyY2VudCA9IF9tYXhUaW1lQm9udXNQZXJjZW50OwogICAgICAgIHJlZmVycmVyQm9udXNQZXJjZW50ID0gX3JlZmVycmVyQm9udXNQZXJjZW50OwogICAgICAgIHJlZmVycmFsQm9udXNQZXJjZW50ID0gX3JlZmVycmFsQm9udXNQZXJjZW50OwoKICAgICAgICB1aW50MjU2IHByZXZCdWxrQW1vdW50ID0gMDsKICAgICAgICByZXF1aXJlKGJ1bGtCb251c01pbkFtb3VudHMubGVuZ3RoID09IGJ1bGtCb251c1BlcmNlbnRzLmxlbmd0aCk7CiAgICAgICAgYnVsa0JvbnVzZXMubGVuZ3RoID0gYnVsa0JvbnVzTWluQW1vdW50cy5sZW5ndGg7CiAgICAgICAgZm9yKHVpbnQ4IGk9MDsgaSA8IGJ1bGtCb251c2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgYnVsa0JvbnVzZXNbaV0gPSBCdWxrQm9udXMoe21pbkFtb3VudDpidWxrQm9udXNNaW5BbW91bnRzW2ldLCBib251c1BlcmNlbnQ6YnVsa0JvbnVzUGVyY2VudHNbaV19KTsKICAgICAgICAgICAgQnVsa0JvbnVzIHN0b3JhZ2UgYmIgPSBidWxrQm9udXNlc1tpXTsKICAgICAgICAgICAgcmVxdWlyZShwcmV2QnVsa0Ftb3VudCA8IGJiLm1pbkFtb3VudCk7CiAgICAgICAgICAgIHByZXZCdWxrQW1vdW50ID0gYmIubWluQW1vdW50OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogQG5vdGljZSBEaXN0cmlidXRlIHRva2VucyBzb2xkIGR1cmluZyBQcmUtSUNPCiAgICAqIEBwYXJhbSBiZW5lZmljaWFyaWVzIEFycmF5IG9mIGJlbmVmaWNpYXJpIGFkZHJlc3NlcwogICAgKiBAcGFyYW0gYW1vdW50cyBBcnJheSBvZiBhbW91bnRzIG9mIHRva2VucyB0byBzZW5kCiAgICAqLwogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByZUlDT1Rva2VucyhhZGRyZXNzW10gYmVuZWZpY2lhcmllcywgdWludDI1NltdIGFtb3VudHMpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcmllcy5sZW5ndGggPT0gYW1vdW50cy5sZW5ndGgpOwogICAgICAgIGZvcih1aW50MjU2IGk9MDsgaTxiZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgbWludFRva2VucyhiZW5lZmljaWFyaWVzW2ldLCBhbW91bnRzW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIEBub3RpY2UgU2VsbCB0b2tlbnMgZGlyZWN0bHksIHdpdGhvdXQgcmVmZXJyYWwgYm9udXNlcwogICAgKi8KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHsKICAgICAgICBzYWxlKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgYWRkcmVzcygwKSk7CiAgICB9CiAgICAvKioKICAgICogQG5vdGljZSBTZWxsIHRva2VucyB2aWEgUmVmZmVyYWxDcm93ZHNhbGUgY29udHJhY3QKICAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IE9yaWdpbmFsIHNlbmRlciAoYnV5ZXIpCiAgICAqIEBwYXJhbSByZWZlcnJlciBUaGUgcGFydG5lciB3aG8gcmVmZXJlcmVkIHRoZSBidXllcgogICAgKi8KICAgIGZ1bmN0aW9uIHJlZmVycmFsU2FsZShhZGRyZXNzIGJlbmVmaWNpYXJ5LCBhZGRyZXNzIHJlZmVycmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBzYWxlKGJlbmVmaWNpYXJ5LCBtc2cudmFsdWUsIHJlZmVycmVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9ucyB0byBzZWxsIHRva2VucwogICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIHNob3VsZCByZWNlaXZlIHRva2VucyAodGhlIGJ1eWVyKQogICAgKiBAcGFyYW0gdmFsdWUgb2YgZXRoZXIgc2VudCBieSBidXllcgogICAgKiBAcGFyYW0gcmVmZXJyZXIgd2hvIHNob3VsZCByZWNlaXZlIHJlZmVycmVyIGJvbnVzLCBpZiBhbnkuIFplcm8gYWRkcmVzcyBpZiBubyByZWZlcnJhbCBib251c2VzIHNob3VsZCBiZSBwYWlkCiAgICAqLwogICAgZnVuY3Rpb24gc2FsZShhZGRyZXNzIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCBhZGRyZXNzIHJlZmVycmVyKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShjcm93ZHNhbGVPcGVuKCkpOwogICAgICAgIHJlcXVpcmUodmFsdWUgPiAwKTsKICAgICAgICBjb2xsZWN0ZWRFdGhlciA9IGNvbGxlY3RlZEV0aGVyLmFkZCh2YWx1ZSk7CiAgICAgICAgY29udHJpYnV0aW9uc1tiZW5lZmljaWFyeV0gPSBjb250cmlidXRpb25zW2JlbmVmaWNpYXJ5XS5hZGQodmFsdWUpOwogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgICAgIGlmKHJlZmVycmVyID09IGFkZHJlc3MoMCkpewogICAgICAgICAgICBhbW91bnQgPSBnZXRUb2tlbnNXaXRoQm9udXNlcyh2YWx1ZSwgZmFsc2UpOwogICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgYW1vdW50ID0gZ2V0VG9rZW5zV2l0aEJvbnVzZXModmFsdWUsIHRydWUpOwogICAgICAgICAgICB1aW50MjU2IHJlZmVycmVyQW1vdW50ICA9IGdldFJlZmVycmVyQm9udXModmFsdWUpOwogICAgICAgICAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQocmVmZXJyZXJBbW91bnQpOwogICAgICAgICAgICBtaW50VG9rZW5zKHJlZmVycmVyLCByZWZlcnJlckFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLmFkZChhbW91bnQpOwogICAgICAgIG1pbnRUb2tlbnMoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAqIEBub3RpY2UgTWludCB0b2tlbnMgZm9yIHB1cnNoYXNlcyB3aXRoIE5vbi1FdGhlciBjdXJyZW5jaWVzCiAgICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG9tIHRvIHNlbmQgdG9rZW5kCiAgICAqIEBwYXJhbSBhbW91bnQgaG93IG11Y2ggdG9rZW5zIHRvIHNlbmQKICAgICogcGFyYW0gbWVzc2FnZSByZWFzb24gd2h5IHdlIGFyZSBzZW5kaW5nIHRva2VucyAobm90IHN0b3JlZCBhbnl0aGVyZSwgb25seSBpbiB0cmFuc2FjdGlvbiBpdHNlbGYpCiAgICAqLwogICAgZnVuY3Rpb24gc2FsZU5vbkV0aGVyKGFkZHJlc3MgYmVuZWZpY2lhcnksIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgLyptZXNzYWdlKi8pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIG1pbnRUb2tlbnMoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAqIEBub3RpY2UgSWYgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICAgICovCiAgICBmdW5jdGlvbiBjcm93ZHNhbGVPcGVuKCkgdmlldyBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuICghZmluYWxpemVkKSAmJiAodG9rZW5zTWludGVkIDwgaGFyZENhcCkgJiYgKHN0YXJ0VGltZXN0YW1wIDw9IG5vdykgJiYgKG5vdyA8PSBlbmRUaW1lc3RhbXApOwogICAgfQoKICAgIC8qKgogICAgKiBAbm90aWNlIENhbGN1bGF0ZXMgaG93IG1hbnkgdG9rZW5zIGFyZSBsZWZ0IHRvIHNhbGUKICAgICogQHJldHVybiBhbW91bnQgb2YgdG9rZW5zIGxlZnQgYmVmb3JlIGhhcmQgY2FwIHJlYWNoZWQKICAgICovCiAgICBmdW5jdGlvbiBnZXRUb2tlbnNMZWZ0KCkgdmlldyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGhhcmRDYXAuc3ViKHRva2Vuc01pbnRlZCk7CiAgICB9CgogICAgLyoqCiAgICAqIEBub3RpY2UgQ2FsY3VsYXRlcyBob3cgbWFueSB0b2tlbnMgb25lIHNob3VsZCByZWNlaXZlIGF0IGN1cmVudCB0aW1lIGZvciBhIHNwZWNpZmllZCB2YWx1ZSBvZiBldGhlcgogICAgKiBAcGFyYW0gdmFsdWUgb2YgZXRoZXIgdG8gZ2V0IGJvbnVzIGZvcgogICAgKiBAcGFyYW0gd2l0aFJlZmVycmFsQm9udXMgaWYgc2hvdWxkIGFkZCByZWZlcnJhbCBib251cwogICAgKiBAcmV0dXJuIGJvbnVzIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGdldFRva2Vuc1dpdGhCb251c2VzKHVpbnQyNTYgdmFsdWUsIGJvb2wgd2l0aFJlZmVycmFsQm9udXMpIHZpZXcgcHVibGljIHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gdmFsdWUubXVsKGJhc2VSYXRlKTsKICAgICAgICBhbW91bnQgPSBhbW91bnQuYWRkKGdldFRpbWVCb251cyh2YWx1ZSkpLmFkZChnZXRCdWxrQm9udXModmFsdWUpKTsKICAgICAgICBpZih3aXRoUmVmZXJyYWxCb251cyl7CiAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudC5hZGQoZ2V0UmVmZXJyYWxCb251cyh2YWx1ZSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgKiBAbm90aWNlIENhbGN1bGF0ZXMgY3VycmVudCB0aW1lIGJvbnVzCiAgICAqIEBwYXJhbSB2YWx1ZSBvZiBldGhlciB0byBnZXQgYm9udXMgZm9yCiAgICAqIEByZXR1cm4gYm9udXMgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0VGltZUJvbnVzKHVpbnQyNTYgdmFsdWUpIHZpZXcgcHVibGljIHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgbWF4Qm9udXMgPSB2YWx1ZS5tdWwoYmFzZVJhdGUpLm11bChtYXhUaW1lQm9udXNQZXJjZW50KS5kaXYoUEVSQ0VOVF9ESVZJREVSKTsKICAgICAgICByZXR1cm4gbWF4Qm9udXMubXVsKGVuZFRpbWVzdGFtcCAtIG5vdykuZGl2KGVuZFRpbWVzdGFtcCAtIHN0YXJ0VGltZXN0YW1wKTsKICAgIH0KCiAgICAvKioKICAgICogQG5vdGljZSBDYWxjdWxhdGVzIGEgYnVsayBib251cyBmb3IgYSBzcGVjaWZpZWQgdmFsdWUgb2YgZXRoZXIKICAgICogQHBhcmFtIHZhbHVlIG9mIGV0aGVyIHRvIGdldCBib251cyBmb3IKICAgICogQHJldHVybiBib251cyB0b2tlbnMKICAgICovCiAgICBmdW5jdGlvbiBnZXRCdWxrQm9udXModWludDI1NiB2YWx1ZSkgdmlldyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgZm9yKHVpbnQ4IGk9dWludDgoYnVsa0JvbnVzZXMubGVuZ3RoKTsgaSA+IDA7IGktLSl7CiAgICAgICAgICAgIHVpbnQ4IGlkeCA9IGkgLSAxOyAvL2lmIGkgID0gYnVsa0JvbnVzZXMubGVuZ3RoLTEgdG8gMCwgaS0tIGZhaWxzIG9uIGxhc3QgaXRlcmF0aW9uCiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBidWxrQm9udXNlc1tpZHhdLm1pbkFtb3VudCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLm11bChiYXNlUmF0ZSkubXVsKGJ1bGtCb251c2VzW2lkeF0uYm9udXNQZXJjZW50KS5kaXYoUEVSQ0VOVF9ESVZJREVSKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICogQG5vdGljZSBDYWxjdWxhdGVzIHJlZmVycmVyIGJvbnVzCiAgICAqIEBwYXJhbSB2YWx1ZSBvZiBldGhlciAgdG8gZ2V0IGJvbnVzIGZvcgogICAgKiBAcmV0dXJuIGJvbnVzIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGdldFJlZmVycmVyQm9udXModWludDI1NiB2YWx1ZSkgdmlldyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHZhbHVlLm11bChiYXNlUmF0ZSkubXVsKHJlZmVycmVyQm9udXNQZXJjZW50KS5kaXYoUEVSQ0VOVF9ESVZJREVSKTsKICAgIH0KICAgIC8qKgogICAgKiBAbm90aWNlIENhbGN1bGF0ZXMgcmVmZXJyYWwgYm9udXMKICAgICogQHBhcmFtIHZhbHVlIG9mIGV0aGVyICB0byBnZXQgYm9udXMgZm9yCiAgICAqIEByZXR1cm4gYm9udXMgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmVmZXJyYWxCb251cyh1aW50MjU2IHZhbHVlKSB2aWV3IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdmFsdWUubXVsKGJhc2VSYXRlKS5tdWwocmVmZXJyYWxCb251c1BlcmNlbnQpLmRpdihQRVJDRU5UX0RJVklERVIpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEhlbHBlciBmdW5jdGlvbiB0byBtaW50IHRva2VucyBhbmQgaW5jcmVhc2UgdG9rZW5zTWludGVkIGNvdW50ZXIKICAgICovCiAgICBmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnksIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgdG9rZW5zTWludGVkID0gdG9rZW5zTWludGVkLmFkZChhbW91bnQpOwogICAgICAgIHJlcXVpcmUodG9rZW5zTWludGVkIDw9IGhhcmRDYXApOwogICAgICAgIGFzc2VydCh0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCBhbW91bnQpKTsKICAgIH0KCiAgICAvKioKICAgICogQG5vdGljZSBTZW5kcyBhbGwgY29udHJpYnV0ZWQgZXRoZXIgYmFjayBpZiBtaW5pbXVtIGNhcCBpcyBub3QgcmVhY2hlZCBieSB0aGUgZW5kIG9mIGNyb3dkc2FsZQogICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyByZXR1cm5zKGJvb2wpewogICAgICAgIHJldHVybiByZWZ1bmRUbyhtc2cuc2VuZGVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlZnVuZFRvKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dGlvbnNbYmVuZWZpY2lhcnldID4gMCk7CiAgICAgICAgcmVxdWlyZShmaW5hbGl6ZWQgfHwgKG5vdyA+IGVuZFRpbWVzdGFtcCkpOwogICAgICAgIHJlcXVpcmUodG9rZW5zU29sZCA8IG1pbkNhcCk7CgogICAgICAgIHVpbnQyNTYgX3JlZnVuZCA9IGNvbnRyaWJ1dGlvbnNbYmVuZWZpY2lhcnldOwogICAgICAgIGNvbnRyaWJ1dGlvbnNbYmVuZWZpY2lhcnldID0gMDsKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2ZlcihfcmVmdW5kKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICogQG5vdGljZSBDbG9zZXMgY3Jvd2RzYWxlLCBmaW5pc2hlcyBtaW50aW5nIChhbGxvd2luZyB0b2tlbiB0cmFuc2ZlcnMpLCB0cmFuc2ZlcnMgdG9rZW4gb3duZXJzaGlwIHRvIHRoZSBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgZmluYWxpemVkID0gdHJ1ZTsKICAgICAgICB0b2tlbi5maW5pc2hNaW50aW5nKCk7CiAgICAgICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAob3duZXIpOwogICAgICAgIGlmKHRva2Vuc1NvbGQgPj0gbWluQ2FwICYmIHRoaXMuYmFsYW5jZSA+IDApewogICAgICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgKiBAbm90aWNlIENsYWltIGNvbGxlY3RlZCBldGhlciB3aXRob3V0IGNsb3NpbmcgY3Jvd2RzYWxlCiAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1FdGhlcigpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUodG9rZW5zU29sZCA+PSBtaW5DYXApOwogICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9Cgp9'.
	

]
