Class {
	#name : #SRT33537c8c6711035ed450bab4a1817511a28ee424,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT33537c8c6711035ed450bab4a1817511a28ee424 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIC8vVmFyaWFibGVzCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICAvLyAgICBNb2RpZmllcnMKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAgKiBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgICogQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgfQogICAgfQp9CgoKY29udHJhY3QgVG9rZW5SZWNpcGllbnQgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlLCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljOwp9CgoKY29udHJhY3QgRVJDMjAgaXMgT3duYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLyogUHVibGljIHZhcmlhYmxlcyBvZiB0aGUgdG9rZW4gKi8KICAgIHN0cmluZyBwdWJsaWMgc3RhbmRhcmQ7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwoKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgICB1aW50MjU2IHB1YmxpYyBpbml0aWFsU3VwcGx5OwoKICAgIGJvb2wgcHVibGljIGxvY2tlZDsKCiAgICB1aW50MjU2IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VzOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGFsbG93YW5jZTsKCiAgICAvKiBUaGlzIGdlbmVyYXRlcyBhIHB1YmxpYyBldmVudCBvbiB0aGUgYmxvY2tjaGFpbiB0aGF0IHdpbGwgbm90aWZ5IGNsaWVudHMgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwoKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwoKICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IG51bXdvcmRzKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5kYXRhLmxlbmd0aCA9PSBudW13b3Jkcy5tdWwoMzIpLmFkZCg0KSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBJbml0aWFsaXplcyBjb250cmFjdCB3aXRoIGluaXRpYWwgc3VwcGx5IHRva2VucyB0byB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgKi8KICAgIGZ1bmN0aW9uIEVSQzIwKAogICAgICAgIHVpbnQyNTYgX2luaXRpYWxTdXBwbHksCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyQWxsU3VwcGx5VG9Pd25lciwKICAgICAgICBib29sIF9sb2NrZWQKICAgICkgewogICAgICAgIHN0YW5kYXJkID0gIkVSQzIwIDAuMSI7CgogICAgICAgIGluaXRpYWxTdXBwbHkgPSBfaW5pdGlhbFN1cHBseTsKCiAgICAgICAgaWYgKF90cmFuc2ZlckFsbFN1cHBseVRvT3duZXIpIHsKICAgICAgICAgICAgc2V0QmFsYW5jZShtc2cuc2VuZGVyLCBpbml0aWFsU3VwcGx5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRCYWxhbmNlKHRoaXMsIGluaXRpYWxTdXBwbHkpOwogICAgICAgIH0KCiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7CiAgICAgICAgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOwogICAgICAgIC8vIFNldCB0aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOwogICAgICAgIC8vIEFtb3VudCBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGxvY2tlZCA9IF9sb2NrZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCiAgICAvKiBwdWJsaWMgbWV0aG9kcyAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBpbml0aWFsU3VwcGx5OwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfYWRkcmVzc107CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGxvY2tlZCA9PSBmYWxzZSk7CgogICAgICAgIGJvb2wgc3RhdHVzID0gdHJhbnNmZXJJbnRlcm5hbChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJlcXVpcmUoc3RhdHVzID09IHRydWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGxvY2tlZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChsb2NrZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgVG9rZW5SZWNpcGllbnQgc3BlbmRlciA9IFRva2VuUmVjaXBpZW50KF9zcGVuZGVyKTsKCiAgICAgICAgaWYgKGFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSkpIHsKICAgICAgICAgICAgc3BlbmRlci5yZWNlaXZlQXBwcm92YWwobXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAobG9ja2VkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdIDwgX3ZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgX3N1Y2Nlc3MgPSB0cmFuc2ZlckludGVybmFsKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIGlmIChfc3VjY2VzcykgewogICAgICAgICAgICBhbGxvd2FuY2VbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfc3VjY2VzczsKICAgIH0KCiAgICAvKiBpbnRlcm5hbCBiYWxhbmNlcyAqLwogICAgZnVuY3Rpb24gc2V0QmFsYW5jZShhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgewogICAgICAgIGJhbGFuY2VzW19ob2xkZXJdID0gX2Ftb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckludGVybmFsKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIDApOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPCBfdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgc2V0QmFsYW5jZShfZnJvbSwgYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpKTsKICAgICAgICBzZXRCYWxhbmNlKF90bywgYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKSk7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKLyoKVGhpcyBjb250cmFjdCBtYW5hZ2VzIHRoZSBtaW50ZXJzIGFuZCB0aGUgbW9kaWZpZXIgdG8gYWxsb3cgbWludCB0byBoYXBwZW4gb25seSBpZiBjYWxsZWQgYnkgbWludGVycwpUaGlzIGNvbnRyYWN0IGNvbnRhaW5zIGJhc2ljIG1pbnRpbmcgZnVuY3Rpb25hbGl0eSB0aG91Z2gKKi8KY29udHJhY3QgTWludGluZ0VSQzIwIGlzIEVSQzIwIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICB1aW50MjU2IHB1YmxpYyBtYXhTdXBwbHk7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludGVyczsKCiAgICBtb2RpZmllciBvbmx5TWludGVycyAoKSB7CiAgICAgICAgcmVxdWlyZSh0cnVlID09IG1pbnRlcnNbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gTWludGluZ0VSQzIwKAogICAgICAgIHVpbnQyNTYgX2luaXRpYWxTdXBwbHksCiAgICAgICAgdWludDI1NiBfbWF4U3VwcGx5LAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFscywKICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlckFsbFN1cHBseVRvT3duZXIsCiAgICAgICAgYm9vbCBfbG9ja2VkCiAgICApCiAgICAgICAgRVJDMjAoX2luaXRpYWxTdXBwbHksIF90b2tlbk5hbWUsIF9kZWNpbWFscywgX3N5bWJvbCwgX3RyYW5zZmVyQWxsU3VwcGx5VG9Pd25lciwgX2xvY2tlZCkKICAgIHsKICAgICAgICBtaW50ZXJzW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBtYXhTdXBwbHkgPSBfbWF4U3VwcGx5OwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZE1pbnRlcihhZGRyZXNzIF9uZXdNaW50ZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIG1pbnRlcnNbX25ld01pbnRlcl0gPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU1pbnRlcihhZGRyZXNzIF9taW50ZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIG1pbnRlcnNbX21pbnRlcl0gPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlNaW50ZXJzIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoX2Ftb3VudCA9PSB1aW50MjU2KDApKSB7CiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRvdGFsU3VwcGx5KCkuYWRkKF9hbW91bnQpID4gbWF4U3VwcGx5KSB7CiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KDApOwogICAgICAgIH0KCiAgICAgICAgaW5pdGlhbFN1cHBseSA9IGluaXRpYWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW19hZGRyXSA9IGJhbGFuY2VzW19hZGRyXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX2FkZHIsIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gX2Ftb3VudDsKICAgIH0KfQoKY29udHJhY3QgVG90dW0gaXMgTWludGluZ0VSQzIwIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBUb3R1bVBoYXNlcyBwdWJsaWMgdG90dW1QaGFzZXM7CgogICAgLy8gQmxvY2sgdG9rZW4gdHJhbnNmZXJzIHRpbGwgSUNPIGVuZC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyRnJvemVuID0gdHJ1ZTsKCiAgICBmdW5jdGlvbiBUb3R1bSgKICAgIHVpbnQyNTYgX21heFN1cHBseSwKICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgIHVpbnQ4IF9wcmVjaXNpb24sCiAgICBib29sIF9sb2NrZWQKICAgICkKICAgIE1pbnRpbmdFUkMyMCgwLCBfbWF4U3VwcGx5LCBfdG9rZW5OYW1lLCBfcHJlY2lzaW9uLCBfdG9rZW5TeW1ib2wsIGZhbHNlLCBfbG9ja2VkKQogICAgewogICAgICAgIHN0YW5kYXJkID0gIlRvdHVtIDAuMSI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TG9ja2VkKGJvb2wgX2xvY2tlZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgbG9ja2VkID0gX2xvY2tlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUb3R1bVBoYXNlcyhhZGRyZXNzIF90b3R1bVBoYXNlcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdG90dW1QaGFzZXMgPSBUb3R1bVBoYXNlcyhfdG90dW1QaGFzZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVuZnJlZXplKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKHRvdHVtUGhhc2VzICE9IGFkZHJlc3MoMCkgJiYgdG90dW1QaGFzZXMuaXNGaW5pc2hlZCgxKSkgewogICAgICAgICAgICB0cmFuc2ZlckZyb3plbiA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBidXlCYWNrKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5TWludGVycyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKF9hZGRyZXNzKSAhPSAweDApOwoKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBiYWxhbmNlT2YoX2FkZHJlc3MpOwogICAgICAgIHNldEJhbGFuY2UoX2FkZHJlc3MsIDApOwogICAgICAgIHNldEJhbGFuY2UodGhpcywgYmFsYW5jZU9mKHRoaXMpLmFkZChiYWxhbmNlKSk7CiAgICAgICAgVHJhbnNmZXIoX2FkZHJlc3MsIHRoaXMsIGJhbGFuY2UpOwoKICAgICAgICByZXR1cm4gYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSghdHJhbnNmZXJGcm96ZW4pOwoKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKCF0cmFuc2ZlckZyb3plbik7CgogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCn0KCmNvbnRyYWN0IFRvdHVtQWxsb2NhdGlvbiBpcyBPd25hYmxlIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBhZGRyZXNzIHB1YmxpYyBib3VudHlBZGRyZXNzOwoKICAgIGFkZHJlc3MgcHVibGljIHRlYW1BZGRyZXNzOwoKICAgIGFkZHJlc3MgcHVibGljIHByZUlDT0FkZHJlc3M7CgogICAgYWRkcmVzcyBwdWJsaWMgaWNvQWRkcmVzczsKCiAgICBhZGRyZXNzIHB1YmxpYyBpY29BZGRyZXNzMTsKCiAgICBmdW5jdGlvbiBUb3R1bUFsbG9jYXRpb24oCiAgICBhZGRyZXNzIF9ib3VudHlBZGRyZXNzLCAvLzUlCiAgICBhZGRyZXNzIF90ZWFtQWRkcmVzcywgLy83JQogICAgYWRkcmVzcyBfcHJlSUNPQWRkcmVzcywKICAgIGFkZHJlc3MgX2ljb0FkZHJlc3MsIC8vNTAlCiAgICBhZGRyZXNzIF9pY29BZGRyZXNzMSAvLzUwJQogICAgKSB7CiAgICAgICAgcmVxdWlyZSgoYWRkcmVzcyhfYm91bnR5QWRkcmVzcykgIT0gMHgwKSAmJiAoYWRkcmVzcyhfdGVhbUFkZHJlc3MpICE9IDB4MCkpOwogICAgICAgIHJlcXVpcmUoKGFkZHJlc3MoX3ByZUlDT0FkZHJlc3MpICE9IDB4MCkgJiYgKGFkZHJlc3MoX2ljb0FkZHJlc3MpICE9IDB4MCkgJiYgKGFkZHJlc3MoX2ljb0FkZHJlc3MxKSAhPSAweDApKTsKCiAgICAgICAgYm91bnR5QWRkcmVzcyA9IF9ib3VudHlBZGRyZXNzOwogICAgICAgIHRlYW1BZGRyZXNzID0gX3RlYW1BZGRyZXNzOwogICAgICAgIHByZUlDT0FkZHJlc3MgPSBfcHJlSUNPQWRkcmVzczsKICAgICAgICBpY29BZGRyZXNzID0gX2ljb0FkZHJlc3M7CiAgICAgICAgaWNvQWRkcmVzczEgPSBfaWNvQWRkcmVzczE7CiAgICB9Cgp9Cgpjb250cmFjdCBUb3R1bVBoYXNlcyBpcyBPd25hYmxlIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBUb3R1bSBwdWJsaWMgdG90dW07CgogICAgVG90dW1BbGxvY2F0aW9uIHB1YmxpYyB0b3R1bUFsbG9jYXRpb247CgogICAgUGhhc2VbXSBwdWJsaWMgcGhhc2VzOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IERBWSA9IDg2NDAwOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbGxlY3RlZEV0aGVyczsKCiAgICB1aW50MjU2IHB1YmxpYyBzb2xkVG9rZW5zOwoKICAgIHVpbnQyNTYgcHVibGljIGludmVzdG9yc0NvdW50OwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGljb0V0aGVyQmFsYW5jZXM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIGludmVzdG9yczsKCiAgICBldmVudCBSZWZ1bmQoYWRkcmVzcyBob2xkZXIsIHVpbnQyNTYgZXRoZXJzLCB1aW50MjU2IHRva2Vucyk7CgogICAgc3RydWN0IFBoYXNlIHsKICAgIHVpbnQyNTYgcHJpY2U7CiAgICB1aW50MjU2IG1pbkludmVzdDsKICAgIHVpbnQyNTYgc29mdENhcDsKICAgIHVpbnQyNTYgaGFyZENhcDsKICAgIHVpbnQyNTYgc2luY2U7CiAgICB1aW50MjU2IHRpbGw7CiAgICBib29sIGlzU3VjY2VlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBUb3R1bVBoYXNlcygKICAgIGFkZHJlc3MgX3RvdHVtLAogICAgdWludDI1NiBfbWluSW52ZXN0LAogICAgdWludDI1NiBfdG9rZW5QcmljZSwgLy8wLjAwMzMgZXRoZXJzCiAgICB1aW50MjU2IF9wcmVJY29NYXhDYXAsCiAgICB1aW50MjU2IF9wcmVJY29TaW5jZSwKICAgIHVpbnQyNTYgX3ByZUljb1RpbGwsCiAgICB1aW50MjU2IF9pY29NaW5DYXAsCiAgICB1aW50MjU2IF9pY29NYXhDYXAsCiAgICB1aW50MjU2IF9pY29TaW5jZSwKICAgIHVpbnQyNTYgX2ljb1RpbGwKICAgICkgewogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhfdG90dW0pICE9IDB4MCk7CiAgICAgICAgdG90dW0gPSBUb3R1bShhZGRyZXNzKF90b3R1bSkpOwoKICAgICAgICByZXF1aXJlKChfcHJlSWNvU2luY2UgPCBfcHJlSWNvVGlsbCkgJiYgKF9pY29TaW5jZSA8IF9pY29UaWxsKSAmJiAoX3ByZUljb1RpbGwgPD0gX2ljb1NpbmNlKSk7CiAgICAgICAgcmVxdWlyZSgoX3ByZUljb01heENhcCA8IF9pY29NYXhDYXApICYmIChfaWNvTWF4Q2FwIDwgdG90dW0ubWF4U3VwcGx5KCkpKTsKCiAgICAgICAgcGhhc2VzLnB1c2goUGhhc2UoX3Rva2VuUHJpY2UsIF9taW5JbnZlc3QsIDAsIF9wcmVJY29NYXhDYXAsIF9wcmVJY29TaW5jZSwgX3ByZUljb1RpbGwsIGZhbHNlKSk7CiAgICAgICAgcGhhc2VzLnB1c2goUGhhc2UoX3Rva2VuUHJpY2UsIF9taW5JbnZlc3QsIF9pY29NaW5DYXAsIF9pY29NYXhDYXAsIF9pY29TaW5jZSwgX2ljb1RpbGwsIGZhbHNlKSk7CiAgICB9CgogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShidXkobXNnLnNlbmRlciwgbXNnLnZhbHVlKSA9PSB0cnVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDdXJyZW50UmF0ZSh1aW50MjU2IF9yYXRlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9yYXRlID4gMCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcGhhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFBoYXNlIHN0b3JhZ2UgcGhhc2UgPSBwaGFzZXNbaV07CiAgICAgICAgICAgIHBoYXNlLnByaWNlID0gX3JhdGU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRvdHVtKGFkZHJlc3MgX3RvdHVtKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICB0b3R1bSA9IFRvdHVtKF90b3R1bSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG90dW1BbGxvY2F0aW9uKGFkZHJlc3MgX3RvdHVtQWxsb2NhdGlvbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdG90dW1BbGxvY2F0aW9uID0gVG90dW1BbGxvY2F0aW9uKF90b3R1bUFsbG9jYXRpb24pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFBoYXNlKAogICAgdWludDggX3BoYXNlSWQsCiAgICB1aW50MjU2IF9zaW5jZSwKICAgIHVpbnQyNTYgX3RpbGwsCiAgICB1aW50MjU2IF9wcmljZSwKICAgIHVpbnQyNTYgX3NvZnRDYXAsCiAgICB1aW50MjU2IF9oYXJkQ2FwCiAgICApIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoKHBoYXNlcy5sZW5ndGggPiBfcGhhc2VJZCkgJiYgKF9wcmljZSA+IDApKTsKICAgICAgICByZXF1aXJlKChfdGlsbCA+IF9zaW5jZSkgJiYgKF9zaW5jZSA+IDApKTsKICAgICAgICByZXF1aXJlKCh0b3R1bS5tYXhTdXBwbHkoKSA+IF9oYXJkQ2FwKSAmJiAoX2hhcmRDYXAgPiBfc29mdENhcCkgJiYgKF9zb2Z0Q2FwID49IDApKTsKCiAgICAgICAgUGhhc2Ugc3RvcmFnZSBwaGFzZSA9IHBoYXNlc1tfcGhhc2VJZF07CgogICAgICAgIGlmIChwaGFzZS5pc1N1Y2NlZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHBoYXNlLnNpbmNlID0gX3NpbmNlOwogICAgICAgIHBoYXNlLnRpbGwgPSBfdGlsbDsKICAgICAgICBwaGFzZS5wcmljZSA9IF9wcmljZTsKICAgICAgICBwaGFzZS5zb2Z0Q2FwID0gX3NvZnRDYXA7CiAgICAgICAgcGhhc2UuaGFyZENhcCA9IF9oYXJkQ2FwOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZW5kVG9BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX3Rva2VucykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKF90b2tlbnMgPT0gMCB8fCBhZGRyZXNzKF9hZGRyZXNzKSA9PSAweDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gX3Rva2Vucy5hZGQoZ2V0Qm9udXNBbW91bnQoX3Rva2Vucywgbm93KSk7CiAgICAgICAgaWYgKGdldFRva2VucygpLmFkZCh0b3RhbEFtb3VudCkgPiB0b3R1bS5tYXhTdXBwbHkoKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBib29sIHN0YXR1cyA9ICh0b3RhbEFtb3VudCAhPSB0b3R1bS5taW50KF9hZGRyZXNzLCB0b3RhbEFtb3VudCkpOwogICAgICAgIGlmIChzdGF0dXMpIHsKICAgICAgICAgICAgc29sZFRva2VucyA9IHNvbGRUb2tlbnMuYWRkKHRvdGFsQW1vdW50KTsKICAgICAgICAgICAgaW5jcmVhc2VJbnZlc3RvcnNDb3VudChfYWRkcmVzcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3RhdHVzOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbmRUb0FkZHJlc3NXaXRoVGltZShhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF90b2tlbnMsIHVpbnQyNTYgX3RpbWUpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfdG9rZW5zID09IDAgfHwgYWRkcmVzcyhfYWRkcmVzcykgPT0gMHgwIHx8IF90aW1lID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiB0b3RhbEFtb3VudCA9IF90b2tlbnMuYWRkKGdldEJvbnVzQW1vdW50KF90b2tlbnMsIF90aW1lKSk7CgogICAgICAgIGlmIChnZXRUb2tlbnMoKS5hZGQodG90YWxBbW91bnQpID4gdG90dW0ubWF4U3VwcGx5KCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBzdGF0dXMgPSAodG90YWxBbW91bnQgIT0gdG90dW0ubWludChfYWRkcmVzcywgdG90YWxBbW91bnQpKTsKCiAgICAgICAgaWYgKHN0YXR1cykgewogICAgICAgICAgICBzb2xkVG9rZW5zID0gc29sZFRva2Vucy5hZGQodG90YWxBbW91bnQpOwogICAgICAgICAgICBpbmNyZWFzZUludmVzdG9yc0NvdW50KF9hZGRyZXNzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgZnVuY3Rpb24gc2VuZFRvQWRkcmVzc1dpdGhCb251cygKICAgIGFkZHJlc3MgX2FkZHJlc3MsCiAgICB1aW50MjU2IF90b2tlbnMsCiAgICB1aW50MjU2IF9ib251cwogICAgKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoX3Rva2VucyA9PSAwIHx8IGFkZHJlc3MoX2FkZHJlc3MpID09IDB4MCB8fCBfYm9udXMgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gX3Rva2Vucy5hZGQoX2JvbnVzKTsKCiAgICAgICAgaWYgKGdldFRva2VucygpLmFkZCh0b3RhbEFtb3VudCkgPiB0b3R1bS5tYXhTdXBwbHkoKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBib29sIHN0YXR1cyA9ICh0b3RhbEFtb3VudCAhPSB0b3R1bS5taW50KF9hZGRyZXNzLCB0b3RhbEFtb3VudCkpOwoKICAgICAgICBpZiAoc3RhdHVzKSB7CiAgICAgICAgICAgIHNvbGRUb2tlbnMgPSBzb2xkVG9rZW5zLmFkZCh0b3RhbEFtb3VudCk7CiAgICAgICAgICAgIGluY3JlYXNlSW52ZXN0b3JzQ291bnQoX2FkZHJlc3MpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN0YXR1czsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UGhhc2UodWludDI1NiBfdGltZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgaWYgKF90aW1lID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHVpbnQ4KHBoYXNlcy5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgcGhhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFBoYXNlIHN0b3JhZ2UgcGhhc2UgPSBwaGFzZXNbaV07CiAgICAgICAgICAgIGlmIChwaGFzZS5zaW5jZSA+IF90aW1lKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBoYXNlLnRpbGwgPCBfdGltZSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHVpbnQ4KHBoYXNlcy5sZW5ndGgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2VucygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdHVtLnRvdGFsU3VwcGx5KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0U29sZFRva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc29sZFRva2VuczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBbGxJbnZlc3RvcnMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBpbnZlc3RvcnNDb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlQ29udHJhY3QoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjb2xsZWN0ZWRFdGhlcnM7CiAgICB9CgogICAgZnVuY3Rpb24gaXNTdWNjZWVkKHVpbnQ4IF9waGFzZUlkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChwaGFzZXMubGVuZ3RoIDw9IF9waGFzZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgUGhhc2Ugc3RvcmFnZSBwaGFzZSA9IHBoYXNlc1tfcGhhc2VJZF07CiAgICAgICAgaWYgKHBoYXNlLmlzU3VjY2VlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAocGhhc2UudGlsbCA+IG5vdykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChwaGFzZS5zb2Z0Q2FwICE9IDAgJiYgcGhhc2Uuc29mdENhcCA+IGdldFRva2VucygpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcGhhc2UuaXNTdWNjZWVkID0gdHJ1ZTsKICAgICAgICBpZiAoX3BoYXNlSWQgPT0gMSkgewogICAgICAgICAgICBhbGxvY2F0ZUJvdW50eSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBQaGFzZSBzdG9yYWdlIGljb1BoYXNlID0gcGhhc2VzWzFdOwogICAgICAgIGlmIChpY29QaGFzZS50aWxsID4gbm93KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGljb1BoYXNlLnNvZnRDYXAgPCBnZXRUb2tlbnMoKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChpY29FdGhlckJhbGFuY2VzW21zZy5zZW5kZXJdID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB1aW50MjU2IHJlZnVuZEFtb3VudCA9IGljb0V0aGVyQmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSB0b3R1bS5idXlCYWNrKG1zZy5zZW5kZXIpOwogICAgICAgIGljb0V0aGVyQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kQW1vdW50KTsKICAgICAgICBSZWZ1bmQobXNnLnNlbmRlciwgcmVmdW5kQW1vdW50LCB0b2tlbnMpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0ZpbmlzaGVkKHVpbnQ4IF9waGFzZUlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChwaGFzZXMubGVuZ3RoIDw9IF9waGFzZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgUGhhc2Ugc3RvcmFnZSBwaGFzZSA9IHBoYXNlc1tfcGhhc2VJZF07CgogICAgICAgIHJldHVybiAocGhhc2UuaXNTdWNjZWVkIHx8IG5vdyA+IHBoYXNlLnRpbGwpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eShhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfdmFsdWUgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB1aW50OCBjdXJyZW50UGhhc2UgPSBnZXRDdXJyZW50UGhhc2Uobm93KTsKCiAgICAgICAgaWYgKHBoYXNlcy5sZW5ndGggPD0gY3VycmVudFBoYXNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZ2V0VG9rZW5zQW1vdW50KF92YWx1ZSwgY3VycmVudFBoYXNlKTsKCiAgICAgICAgaWYgKGFtb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgYm9udXMgPSBnZXRCb251c0Ftb3VudChhbW91bnQsIG5vdyk7CgogICAgICAgIGlmIChjdXJyZW50UGhhc2UgPT0gMSkgewogICAgICAgICAgICBib251cyA9IGJvbnVzLmFkZChnZXRWb2x1bWVCYXNlZEJvbnVzQW1vdW50KF92YWx1ZSwgYW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICBhbW91bnQgPSBhbW91bnQuYWRkKGJvbnVzKTsKCiAgICAgICAgYm9vbCBzdGF0dXMgPSAoYW1vdW50ID09IHRvdHVtLm1pbnQoX2FkZHJlc3MsIGFtb3VudCkpOwoKICAgICAgICBpZiAoc3RhdHVzKSB7CiAgICAgICAgICAgIG9uU3VjY2Vzc2Z1bEJ1eShfYWRkcmVzcywgX3ZhbHVlLCBhbW91bnQsIGN1cnJlbnRQaGFzZSk7CiAgICAgICAgICAgIGFsbG9jYXRlKGN1cnJlbnRQaGFzZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3RhdHVzOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uU3VjY2Vzc2Z1bEJ1eShhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfYW1vdW50LCB1aW50OCBfY3VycmVudFBoYXNlKSBpbnRlcm5hbCB7CiAgICAgICAgY29sbGVjdGVkRXRoZXJzID0gY29sbGVjdGVkRXRoZXJzLmFkZChfdmFsdWUpOwogICAgICAgIHNvbGRUb2tlbnMgPSBzb2xkVG9rZW5zLmFkZChfYW1vdW50KTsKICAgICAgICBpbmNyZWFzZUludmVzdG9yc0NvdW50KF9hZGRyZXNzKTsKCiAgICAgICAgaWYgKF9jdXJyZW50UGhhc2UgPT0gMSkgewogICAgICAgICAgICBpY29FdGhlckJhbGFuY2VzW19hZGRyZXNzXSA9IGljb0V0aGVyQmFsYW5jZXNbX2FkZHJlc3NdLmFkZChfdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZUludmVzdG9yc0NvdW50KGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHsKICAgICAgICBpZiAoYWRkcmVzcyhfYWRkcmVzcykgIT0gMHgwICYmIGludmVzdG9yc1tfYWRkcmVzc10gPT0gZmFsc2UpIHsKICAgICAgICAgICAgaW52ZXN0b3JzW19hZGRyZXNzXSA9IHRydWU7CiAgICAgICAgICAgIGludmVzdG9yc0NvdW50ID0gaW52ZXN0b3JzQ291bnQuYWRkKDEpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRWb2x1bWVCYXNlZEJvbnVzQW1vdW50KHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9hbW91bnQpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoX2Ftb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBpZiAoX3ZhbHVlIDwgMyBldGhlcikgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2UgaWYgKF92YWx1ZSA8IDE1IGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBfYW1vdW50Lm11bCgzKS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgaWYgKF92YWx1ZSA8IDMwIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBfYW1vdW50Lm11bCg1KS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gX2Ftb3VudC5tdWwoNykuZGl2KDEwMCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2Vuc0Ftb3VudCh1aW50MjU2IF92YWx1ZSwgdWludDggX2N1cnJlbnRQaGFzZSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChfdmFsdWUgPT0gMCB8fCBwaGFzZXMubGVuZ3RoIDw9IF9jdXJyZW50UGhhc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoMCk7CiAgICAgICAgfQoKICAgICAgICBQaGFzZSBzdG9yYWdlIHBoYXNlID0gcGhhc2VzW19jdXJyZW50UGhhc2VdOwoKICAgICAgICB1aW50MjU2IGFtb3VudCA9IF92YWx1ZS5tdWwodWludDI1NigxMCkgKiogdG90dW0uZGVjaW1hbHMoKSkuZGl2KHBoYXNlLnByaWNlKTsKCiAgICAgICAgaWYgKGFtb3VudCA8IHBoYXNlLm1pbkludmVzdCkgewogICAgICAgICAgICByZXR1cm4gdWludDI1NigwKTsKICAgICAgICB9CgogICAgICAgIGlmIChnZXRUb2tlbnMoKS5hZGQoYW1vdW50KSA+IHBoYXNlLmhhcmRDYXApIHsKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoMCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJvbnVzQW1vdW50KHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdGltZSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQ4IGN1cnJlbnRQaGFzZSA9IGdldEN1cnJlbnRQaGFzZShfdGltZSk7CiAgICAgICAgaWYgKF9hbW91bnQgPT0gMCB8fCBfdGltZSA9PSAwIHx8IHBoYXNlcy5sZW5ndGggPD0gY3VycmVudFBoYXNlKSB7CiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKGN1cnJlbnRQaGFzZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBfYW1vdW50Lm11bCg1MCkuZGl2KDEwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChjdXJyZW50UGhhc2UgPT0gMSkgewogICAgICAgICAgICByZXR1cm4gZ2V0SUNPQm9udXNBbW91bnQoX2Ftb3VudCwgX3RpbWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHVpbnQyNTYoMCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SUNPQm9udXNBbW91bnQodWludDI1NiBfYW1vdW50LCB1aW50MjU2IF90aW1lKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgUGhhc2Ugc3RvcmFnZSBpY28gPSBwaGFzZXNbMV07CiAgICAgICAgaWYgKF90aW1lLnN1YihpY28uc2luY2UpIDwgMTEgKiBEQVkpIHsvLyAxMWQgc2luY2UgaWNvID0+IHJld2FyZCAyMCU7CiAgICAgICAgICAgIHJldHVybiBfYW1vdW50Lm11bCgyMCkuZGl2KDEwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChfdGltZS5zdWIoaWNvLnNpbmNlKSA8IDIxICogREFZKSB7Ly8gMjFkIHNpbmNlIGljbyA9PiByZXdhcmQgMTUlCiAgICAgICAgICAgIHJldHVybiBfYW1vdW50Lm11bCgxNSkuZGl2KDEwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChfdGltZS5zdWIoaWNvLnNpbmNlKSA8IDMxICogREFZKSB7Ly8gMzFkIHNpbmNlIGljbyA9PiByZXdhcmQgMTAlCiAgICAgICAgICAgIHJldHVybiBfYW1vdW50Lm11bCgxMCkuZGl2KDEwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChfdGltZS5zdWIoaWNvLnNpbmNlKSA8IDQxICogREFZKSB7Ly8gNDFkIHNpbmNlIGljbyA9PiByZXdhcmQgNSUKICAgICAgICAgICAgcmV0dXJuIF9hbW91bnQubXVsKDUpLmRpdigxMDApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb2NhdGUodWludDggX2N1cnJlbnRQaGFzZSkgaW50ZXJuYWwgewogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPiAwICYmIHBoYXNlcy5sZW5ndGggPiBfY3VycmVudFBoYXNlKSB7CiAgICAgICAgICAgIFBoYXNlIHN0b3JhZ2UgcGhhc2UgPSBwaGFzZXNbX2N1cnJlbnRQaGFzZV07CgogICAgICAgICAgICBpZiAoX2N1cnJlbnRQaGFzZSA9PSAwKSB7CiAgICAgICAgICAgICAgICB0b3R1bUFsbG9jYXRpb24ucHJlSUNPQWRkcmVzcygpLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX2N1cnJlbnRQaGFzZSA9PSAxICYmIHNvbGRUb2tlbnMgPj0gcGhhc2Uuc29mdENhcCkgewogICAgICAgICAgICAgICAgdG90dW1BbGxvY2F0aW9uLmljb0FkZHJlc3MoKS50cmFuc2Zlcih0aGlzLmJhbGFuY2UubXVsKDUpLmRpdigxMCkpOwogICAgICAgICAgICAgICAgdG90dW1BbGxvY2F0aW9uLmljb0FkZHJlc3MxKCkudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvY2F0ZUJvdW50eSgpIGludGVybmFsIHsKICAgICAgICBpZiAoaXNGaW5pc2hlZCgxKSkgewogICAgICAgICAgICB1aW50MjU2IGFtb3VudCA9IHRvdHVtLm1heFN1cHBseSgpLm11bCg1KS5kaXYoMTAwKTsKICAgICAgICAgICAgdWludDI1NiBtaW50ZWRBbW91bnQgPSB0b3R1bS5taW50KHRvdHVtQWxsb2NhdGlvbi5ib3VudHlBZGRyZXNzKCksIGFtb3VudCk7CgogICAgICAgICAgICByZXF1aXJlKG1pbnRlZEFtb3VudCA9PSBhbW91bnQpOwoKICAgICAgICAgICAgYW1vdW50ID0gdG90dW0ubWF4U3VwcGx5KCkubXVsKDcpLmRpdigxMDApOwogICAgICAgICAgICBtaW50ZWRBbW91bnQgPSB0b3R1bS5taW50KHRvdHVtQWxsb2NhdGlvbi50ZWFtQWRkcmVzcygpLCBhbW91bnQpOwoKICAgICAgICAgICAgcmVxdWlyZShtaW50ZWRBbW91bnQgPT0gYW1vdW50KTsKICAgICAgICB9CiAgICB9Cgp9'.
	

]
