Class {
	#name : #SRT6310ee0a08dc01a9b1acd077cb1d9bd17e55a081,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6310ee0a08dc01a9b1acd077cb1d9bd17e55a081 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbCAKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4gCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKiAKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBpbnRlcm5hbCB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLiAKICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uIAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIGV2ZW50IEhhbHRlZChib29sIGhhbHRlZCk7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKCFoYWx0ZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKGhhbHRlZCk7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgICBIYWx0ZWQodHJ1ZSk7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIEhhbHRlZChmYWxzZSk7CiAgfQoKfQoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSAgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKLyoqCiAqIEludGVyZmFjZSBmb3IgdGhlIHN0YW5kYXJkIHRva2VuLgogKiBCYXNlZCBvbiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogKi8KaW50ZXJmYWNlIEVJUDIwVG9rZW4gewoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgLyoqCiAgKiogT3B0aW9uYWwgZnVuY3Rpb25zCiAgKgogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCBkZWNpbWFscyk7CiAgKgogICoqLwoKfQoKLy8gSW50ZXJmYWNlIGZvciBidXJuaW5nIHRva2Vucwpjb250cmFjdCBCdXJuYWJsZSB7CiAgLy8gQGRldiBEZXN0cm95cyB0b2tlbnMgZm9yIGFuIGFjY291bnQKICAvLyBAcGFyYW0gYWNjb3VudCBBY2NvdW50IHdob3NlIHRva2VucyBhcmUgZGVzdHJveWVkCiAgLy8gQHBhcmFtIHZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gZGVzdHJveQogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbDsKICBldmVudCBCdXJuZWQoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKTsKfQoKLyoqCiAqIEF1dGhvcmVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCgovKioKICogSW50ZXJuYWwgaW50ZXJmYWNlIGZvciB0aGUgbWludGluZyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBNaW50YWJsZSB7CgogIC8qKgogICAqIEBkZXYgTWludHMgdG9rZW5zIGZvciBhbiBhY2NvdW50CiAgICogVGhpcyBmdW5jdGlvbiBzaG91bGQgZW1pdCB0aGUgTWludGVkIGV2ZW50LgogICAqLwogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgaW50ZXJuYWw7CgogIC8qKiBUb2tlbiBzdXBwbHkgZ290IGluY3JlYXNlZCBhbmQgYSBuZXcgb3duZXIgcmVjZWl2ZWQgdGhlc2UgdG9rZW5zICovCiAgZXZlbnQgTWludGVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCB0b2tlbgogKiBAZGV2IEJhc2ljIGltcGxlbWVudGF0aW9uIG9mIHRoZSBFSVAyMCBzdGFuZGFyZCB0b2tlbiAoYWxzbyBrbm93biBhcyBFUkMyMCB0b2tlbikuCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVJUDIwVG9rZW4sIEJ1cm5hYmxlLCBNaW50YWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIHVpbnQgcHJpdmF0ZSB0b3RhbF9zdXBwbHk7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHByaXZhdGUgYmFsYW5jZXM7CiAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIHByaXZhdGUgYWxsb3dlZDsKCgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRvdGFsX3N1cHBseTsKICB9CgogIC8qKgogICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICogQHBhcmFtIHZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAqIEBwYXJhbSBhY2NvdW50IFRoZSBhZGRyZXNzIHdob3NlIGJhbGFuY2UgaXMgdG8gYmUgcXVlcmllZC4KICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGFjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW2FjY291bnRdOwogIH0KCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIGZyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIHRvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IGFsbG93YW5jZSA9IGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihhbGxvd2FuY2UsIHZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSh2YWx1ZSA8PSBhbGxvd2FuY2UpOwogICAgLy8gU2FmZU1hdGggdXNlcyBhc3NlcnQgaW5zdGVhZCBvZiByZXF1aXJlIHRob3VnaCwgYmV3YXJlIHdoZW4gdXNpbmcgYW4gYW5hbHlzaXMgdG9vbAoKICAgIGJhbGFuY2VzW2Zyb21dID0gYmFsYW5jZXNbZnJvbV0uc3ViKHZhbHVlKTsKICAgIGJhbGFuY2VzW3RvXSA9IGJhbGFuY2VzW3RvXS5hZGQodmFsdWUpOwogICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93YW5jZS5zdWIodmFsdWUpOwogICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzJwogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUgKHZhbHVlID09IDAgfHwgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9PSAwKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhbiBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gYWNjb3VudCBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBzcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIGFjY291bnQsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW2FjY291bnRdW3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGluY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZwogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICoKICAgKi8KICBmdW5jdGlvbiBhZGRBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXTsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IG9sZFZhbHVlLmFkZChhZGRlZFZhbHVlKTsKICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGRlY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZy4KICAgKgogICAqIFdvcmtzIGFyb3VuZCBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqLwogIGZ1bmN0aW9uIHN1YkFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBzdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgIHVpbnQgb2xkVmFsID0gYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXTsKCiAgICAgIGlmIChzdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWwpIHsKICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IG9sZFZhbC5zdWIoc3VidHJhY3RlZFZhbHVlKTsKICAgICAgfQogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIGZ1bmN0aW9uIGZvciBkZXN0cm95aW5nIHRva2Vucy4gVXNlZnVsIGZvciB1cGdyYWRlcy4KICAgKi8KICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSkgaW50ZXJuYWwgewogICAgYmFsYW5jZXNbYWNjb3VudF0gPSBiYWxhbmNlc1thY2NvdW50XS5zdWIodmFsdWUpOwogICAgdG90YWxfc3VwcGx5ID0gdG90YWxfc3VwcGx5LnN1Yih2YWx1ZSk7CiAgICBUcmFuc2ZlcihhY2NvdW50LCAwLCB2YWx1ZSk7CiAgICBCdXJuZWQoYWNjb3VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBQcm92aWRlcyBhbiBpbnRlcm5hbCBtaW50aW5nIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgaW50ZXJuYWwgewogICAgdG90YWxfc3VwcGx5ID0gdG90YWxfc3VwcGx5LmFkZChhbW91bnQpOwogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChhbW91bnQpOwogICAgTWludGVkKHJlY2VpdmVyLCBhbW91bnQpOwoKICAgIC8vIEJld2FyZTogQWRkcmVzcyB6ZXJvIG1heSBiZSB1c2VkIGZvciBzcGVjaWFsIHRyYW5zYWN0aW9ucyBpbiBhIGZ1dHVyZSBmb3JrLgogICAgLy8gVGhpcyB3aWxsIG1ha2UgdGhlIG1pbnQgdHJhbnNhY3Rpb24gYXBwZWFyIGluIEV0aGVyU2Nhbi5pbwogICAgLy8gV2UgY2FuIHJlbW92ZSB0aGlzIGFmdGVyIHRoZXJlIGlzIGEgc3RhbmRhcmRpemVkIG1pbnRpbmcgZXZlbnQKICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogIH0KICAKfQoKLyoqCiAqIERlZmluZSBpbnRlcmZhY2UgZm9yIHJlbGVhc2luZyB0aGUgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICovCmNvbnRyYWN0IFJlbGVhc2FibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKCiAgLyogVGhlIGZpbmFsaXplciBjb250cmFjdCB0aGF0IGFsbG93cyBsaWZ0aW5nIHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLwogIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKCiAgLyoqIEEgY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiByZWxlYXNlIHVzIHRvIHRoZSB3aWxkIGlmIElDTyBzdWNjZXNzLiBJZiBmYWxzZSB3ZSBhcmUgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLiovCiAgYm9vbCBwdWJsaWMgcmVsZWFzZWQgPSBmYWxzZTsKCiAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB0cmFuc2ZlckFnZW50czsKCiAgLyoqCiAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgKgogICAqIFNpbmNlIHRoZSBvd25lciBvZiB0aGlzIGNvbnRyYWN0IGlzIChvciBzaG91bGQgYmUpIHRoZSBjcm93ZHNhbGUsCiAgICogaXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGEgY29ycmVzcG9uZGluZyBleHBvc2VkIEFQSSBpbiB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGluIGNhc2Ugb2YgaW5wdXQgZXJyb3IuCiAgICovCiAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBoYXZlIGEgbm9ybWFsIHdhbGxldCBhZGRyZXNzIHRvIGFjdCBhcyBhIHJlbGVhc2UgYWdlbnQuCiAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChlLmcuIGEgY3Jvd2RzYWxlIGNvbnRyYWN0KSB0byB0cmFuc2ZlciB0b2tlbnMgZGVzcGl0ZSB0aGUgbG9jayB1cCBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKICAgIHRyYW5zZmVyQWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgfQoKICAvKioKICAgKiBPbmUgd2F5IGZ1bmN0aW9uIHRvIHJlbGVhc2UgdGhlIHRva2VucyBpbnRvIHRoZSB3aWxkLgogICAqCiAgICogQ2FuIGJlIGNhbGxlZCBvbmx5IGZyb20gdGhlIHJlbGVhc2UgYWdlbnQgdGhhdCBzaG91bGQgdHlwaWNhbGx5IGJlIHRoZSBmaW5hbGl6ZSBhZ2VudCBJQ08gY29udHJhY3QuCiAgICogSW4gdGhlIHNjb3BlIG9mIHRoZSBjcm93ZHNhbGUsIGl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gYSBzdWNjZXNzIChmaXJzdCBtaWxlc3RvbmUgcmVhY2hlZCkuCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICByZWxlYXNlZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBzZW5kZXIpIHsKICAgIHJlcXVpcmUocmVsZWFzZWQgfHwgdHJhbnNmZXJBZ2VudHNbc2VuZGVyXSk7CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VkICovCiAgbW9kaWZpZXIgaW5SZWxlYXNlU3RhdGUoYm9vbCByZWxlYXNlU3RhdGUpIHsKICAgIHJlcXVpcmUocmVsZWFzZVN0YXRlID09IHJlbGVhc2VkKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSByZWxlYXNlQWdlbnQpOwogICAgXzsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlciBieSBvdmVycmlkaW5nIGl0ICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgfQoKICAvKiogV2UgcmVzdHJpY3QgdHJhbnNmZXJGcm9tIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIoZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXJGb3JtKCkKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICB9Cgp9CgovKioKICogSW5zcGlyZWQgYnkgTHVueXIuCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqLwoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgdHJhbnNmZXJzIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICogVXBncmFkZSBhZ2VudCBpdHNlbGYgY2FuIGJlIHRoZSB0b2tlbiBjb250cmFjdCwgb3IganVzdCBhIG1pZGRsZSBtYW4gY29udHJhY3QgZG9pbmcgdGhlIGhlYXZ5IGxpZnRpbmcuCiAqCiAqIFRoZSBVcGdyYWRlIGFnZW50IGlzIHRoZSBpbnRlcmZhY2UgdXNlZCB0byBpbXBsZW1lbnQgYSB0b2tlbgogKiBtaWdyYXRpb24gaW4gdGhlIGNhc2Ugb2YgYW4gZW1lcmdlbmN5LgogKiBUaGUgZnVuY3Rpb24gdXBncmFkZUZyb20gaGFzIHRvIGltcGxlbWVudCB0aGUgcGFydCBvZiB0aGUgY3JlYXRpb24KICogb2YgbmV3IHRva2VucyBvbiBiZWhhbGYgb2YgdGhlIHVzZXIgZG9pbmcgdGhlIHVwZ3JhZGUuCiAqCiAqIFRoZSBuZXcgdG9rZW4gY2FuIGltcGxlbWVudCB0aGlzIGludGVyZmFjZSBkaXJlY3RseSwgb3IgdXNlLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgLyoqIFRoaXMgdmFsdWUgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBvcmlnaW5hbCB0b2tlbidzIHRvdGFsIHN1cHBseSAqLwogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5OwoKICAvKiogSW50ZXJmYWNlIHRvIGVuc3VyZSB0aGUgY29udHJhY3QgaXMgY29ycmVjdGx5IGNvbmZpZ3VyZWQgKi8KICBmdW5jdGlvbiBpc1VwZ3JhZGVBZ2VudCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgVXBncmFkZSBhbiBhY2NvdW50CgogIFdoZW4gdGhlIHRva2VuIGNvbnRyYWN0IGlzIGluIHRoZSB1cGdyYWRlIHN0YXR1cyB0aGUgZWFjaCB1c2VyIHdpbGwKICBoYXZlIHRvIGNhbGwgYHVwZ3JhZGUodmFsdWUpYCBmdW5jdGlvbiBmcm9tIFVwZ3JhZGVhYmxlVG9rZW4uCgogIFRoZSB1cGdyYWRlIGZ1bmN0aW9uIGFkanVzdCB0aGUgYmFsYW5jZSBvZiB0aGUgdXNlciBhbmQgdGhlIHN1cHBseQogIG9mIHRoZSBwcmV2aW91cyB0b2tlbiBhbmQgdGhlbiBjYWxsIGB1cGdyYWRlRnJvbSh2YWx1ZSlgLgoKICBUaGUgVXBncmFkZUFnZW50IGlzIHRoZSByZXNwb25zaWJsZSB0byBjcmVhdGUgdGhlIHRva2VucyBmb3IgdGhlIHVzZXIKICBpbiB0aGUgbmV3IGNvbnRyYWN0LgoKICAqIEBwYXJhbSBmcm9tIEFjY291bnQgdG8gdXBncmFkZS4KICAqIEBwYXJhbSB2YWx1ZSBUb2tlbnMgdG8gdXBncmFkZS4KCiAgKi8KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIGZyb20sIHVpbnQgdmFsdWUpIHB1YmxpYzsKCn0KCgovKioKICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uCiAqCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIEVJUDIwVG9rZW4sIEJ1cm5hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqIENvbnRyYWN0IC8gcGVyc29uIHdobyBjYW4gc2V0IHRoZSB1cGdyYWRlIHBhdGguIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGFzIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBhcyB3aGF0IGl0IGlzIHdpdGggaXRzIGRlZmF1bHQgdmFsdWUuICovCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsKCiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8KICB1aW50IHB1YmxpYyB0b3RhbFVwZ3JhZGVkID0gMDsKCiAgLyoqCiAgICogVXBncmFkZSBzdGF0ZXMuCiAgICoKICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogVG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldAogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0LiBUaGlzIGFsbG93cyBjaGFuZ2luZyB0aGUgdXBncmFkZSBhZ2VudCB3aGlsZSB0aGVyZSBpcyB0aW1lLgogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMKICAgKgogICAqLwogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9CgogIC8qKgogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICovCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CgogIC8qKgogICAqIE5ldyB1cGdyYWRlIGFnZW50IGF2YWlsYWJsZS4KICAgKi8KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIG1hc3RlcikgaW50ZXJuYWwgewogICAgc2V0VXBncmFkZU1hc3RlcihtYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdGhlIHRva2VuIGhvbGRlciB0byB1cGdyYWRlIHNvbWUgb2YgdGhlaXIgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHVwZ3JhZGUodWludCB2YWx1ZSkgcHVibGljIHsKICAgIFVwZ3JhZGVTdGF0ZSBzdGF0ZSA9IGdldFVwZ3JhZGVTdGF0ZSgpOwogICAgLy8gRW5zdXJlIGl0J3Mgbm90IGNhbGxlZCBpbiBhIGJhZCBzdGF0ZQogICAgcmVxdWlyZShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7CgogICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICByZXF1aXJlKHZhbHVlICE9IDApOwoKICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIAogICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgIGJ1cm5Ub2tlbnMobXNnLnNlbmRlciwgdmFsdWUpOwogICAgdG90YWxVcGdyYWRlZCA9IHRvdGFsVXBncmFkZWQuYWRkKHZhbHVlKTsKCiAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzIHRoZSB1cGdyYWRlIHByb2Nlc3MKICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgb25seU1hc3RlciBleHRlcm5hbCB7CiAgICAvLyBDaGVjayB3aGV0aGVyIHRoZSB0b2tlbiBpcyBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgb2YgdXBncmFkaW5nCiAgICByZXF1aXJlKGNhblVwZ3JhZGUoKSk7CgogICAgcmVxdWlyZShhZ2VudCAhPSAweDApOwogICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQKICAgIHJlcXVpcmUoZ2V0VXBncmFkZVN0YXRlKCkgIT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7CgogICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKCiAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICByZXF1aXJlKHVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKTsKICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICByZXF1aXJlKHVwZ3JhZGVBZ2VudC5vcmlnaW5hbFN1cHBseSgpID09IHRvdGFsU3VwcGx5KCkpOwoKICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBzdGF0ZSBvZiB0aGUgdG9rZW4gdXBncmFkZS4KICAgKi8KICBmdW5jdGlvbiBnZXRVcGdyYWRlU3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zKFVwZ3JhZGVTdGF0ZSkgewogICAgaWYgKCFjYW5VcGdyYWRlKCkpIHJldHVybiBVcGdyYWRlU3RhdGUuTm90QWxsb3dlZDsKICAgIGVsc2UgaWYgKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYgKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsKICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgfQoKICAvKioKICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLgogICAqCiAgICogVGhpcyBhbGxvd3MgdXMgdG8gc2V0IGEgbmV3IG93bmVyIGZvciB0aGUgdXBncmFkZSBtZWNoYW5pc20uCiAgICovCiAgZnVuY3Rpb24gY2hhbmdlVXBncmFkZU1hc3RlcihhZGRyZXNzIG5ld19tYXN0ZXIpIG9ubHlNYXN0ZXIgcHVibGljIHsKICAgIHNldFVwZ3JhZGVNYXN0ZXIobmV3X21hc3Rlcik7CiAgfQoKICAvKioKICAgKiBJbnRlcm5hbCB1cGdyYWRlIG1hc3RlciBzZXR0ZXIuCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZU1hc3RlcihhZGRyZXNzIG5ld19tYXN0ZXIpIHByaXZhdGUgewogICAgcmVxdWlyZShuZXdfbWFzdGVyICE9IDB4MCk7CiAgICB1cGdyYWRlTWFzdGVyID0gbmV3X21hc3RlcjsKICB9CgogIC8qKgogICAqIENoaWxkIGNvbnRyYWN0IGNhbiBvdmVycmlkZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gaW4gd2hpY2ggdGhlIHVwZ3JhZGUgY2FuIGJlZ2luLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICBtb2RpZmllciBvbmx5TWFzdGVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHVwZ3JhZGVNYXN0ZXIpOwogICAgXzsKICB9Cn0KCi8vIFRoaXMgY29udHJhY3QgYWltcyB0byBwcm92aWRlIGFuIGluaGVyaXRhYmxlIHdheSB0byByZWNvdmVyIHRva2VucyBmcm9tIGEgY29udHJhY3Qgbm90IG1lYW50IHRvIGhvbGQgdG9rZW5zCi8vIFRvIHVzZSB0aGlzIGNvbnRyYWN0LCBoYXZlIHlvdXIgdG9rZW4taWdub3JpbmcgY29udHJhY3QgaW5oZXJpdCB0aGlzIG9uZSBhbmQgaW1wbGVtZW50IGdldExvc3RBbmRGb3VuZE1hc3RlciB0byBkZWNpZGUgd2hvIGNhbiBtb3ZlIGxvc3QgdG9rZW5zLgovLyBPZiBjb3Vyc2UsIHRoaXMgY29udHJhY3QgaW1wb3NlcyBzdXBwb3J0IGNvc3RzIHVwb24gd2hvZXZlciBpcyB0aGUgbG9zdCBhbmQgZm91bmQgbWFzdGVyLgpjb250cmFjdCBMb3N0QW5kRm91bmRUb2tlbiB7CiAgLyoqCiAgICogQHJldHVybiBBZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgaGFuZGxlcyBtb3ZlbWVudHMuCiAgICovCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKCiAgLyoqCiAgICogQHBhcmFtIGFnZW50IEFkZHJlc3MgdGhhdCB3aWxsIGJlIGFibGUgdG8gbW92ZSB0b2tlbnMgd2l0aCB0cmFuc2ZlckZyb20KICAgKiBAcGFyYW0gdG9rZW5zIEFtb3VudCBvZiB0b2tlbnMgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICogQHBhcmFtIHRva2VuX2NvbnRyYWN0IENvbnRyYWN0IG9mIHRoZSB0b2tlbgogICAqLwogIGZ1bmN0aW9uIGVuYWJsZUxvc3RBbmRGb3VuZChhZGRyZXNzIGFnZW50LCB1aW50IHRva2VucywgRUlQMjBUb2tlbiB0b2tlbl9jb250cmFjdCkgcHVibGljIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSk7CiAgICAvLyBXZSB1c2UgYXBwcm92ZSBpbnN0ZWFkIG9mIHRyYW5zZmVyIHRvIG1pbmltaXplIHRoZSBwb3NzaWJpbGl0eSBvZiB0aGUgbG9zdCBhbmQgZm91bmQgbWFzdGVyCiAgICAvLyAgZ2V0dGluZyB0aGVtIHN0dWNrIGluIGFub3RoZXIgYWRkcmVzcyBieSBhY2NpZGVudC4KICAgIHRva2VuX2NvbnRyYWN0LmFwcHJvdmUoYWdlbnQsIHRva2Vucyk7CiAgfQp9CgoKCi8qKgogKiBBIHB1YmxpYyBpbnRlcmZhY2UgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBvZiBhIHRva2VuLgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIHVzdWFsbHkgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IHRoZSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgTWludGFibGUsIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpOwoKCiAgZnVuY3Rpb24gTWludGFibGVUb2tlbih1aW50IGluaXRpYWxTdXBwbHksIGFkZHJlc3MgbXVsdGlzaWcsIGJvb2wgbWludGFibGUpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXVsdGlzaWcgIT0gYWRkcmVzcygwKSk7CiAgICAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgIHJlcXVpcmUobWludGFibGUgfHwgaW5pdGlhbFN1cHBseSAhPSAwKTsKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGlmIChpbml0aWFsU3VwcGx5ID4gMCkKICAgICAgbWludEludGVybmFsKG11bHRpc2lnLCBpbml0aWFsU3VwcGx5KTsKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgbWludGluZ0ZpbmlzaGVkID0gIW1pbnRhYmxlOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4KICAgKgogICAqIE9ubHkgY2FsbGFibGUgYnkgYSBtaW50IGFnZW50IChlLmcuIGNyb3dkc2FsZSBjb250cmFjdCkuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50SW50ZXJuYWwocmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIG1vZGlmaWVyIG9ubHlNaW50QWdlbnQoKSB7CiAgICAvLyBPbmx5IG1pbnQgYWdlbnRzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgcmVxdWlyZShtaW50QWdlbnRzW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KfQoKCi8qKgogKiBBIGNyb3dkc2FsZSB0b2tlbi4KICoKICogQW4gRVJDLTIwIHRva2VuIGRlc2lnbmVkIHNwZWNpZmljYWxseSBmb3IgY3Jvd2RzYWxlcyB3aXRoIGludmVzdG9yIHByb3RlY3Rpb24gYW5kIGZ1cnRoZXIgZGV2ZWxvcG1lbnQgcGF0aC4KICoKICogLSBUaGUgdG9rZW4gdHJhbnNmZXIoKSBpcyBkaXNhYmxlZCB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIKICogLSBUaGUgdG9rZW4gY29udHJhY3QgZ2l2ZXMgYW4gb3B0LWluIHVwZ3JhZGUgcGF0aCB0byBhIG5ldyBjb250cmFjdAogKiAtIFRoZSBzYW1lIHRva2VuIGNhbiBiZSBwYXJ0IG9mIHNldmVyYWwgY3Jvd2RzYWxlcyB0aHJvdWdoIHRoZSBhcHByb3ZlKCkgbWVjaGFuaXNtCiAqIC0gVGhlIHRva2VuIGNhbiBiZSBjYXBwZWQgKHN1cHBseSBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yKSBvciB1bmNhcHBlZCAoY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiBtaW50IG5ldyB0b2tlbnMpCiAqIC0gRVJDMjAgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoaXMgY29udHJhY3QgY2FuIGJlIHJlY292ZXJlZCBieSBhIGxvc3QgYW5kIGZvdW5kIG1hc3RlcgogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gaXMgUmVsZWFzYWJsZVRva2VuLCBNaW50YWJsZVRva2VuLCBVcGdyYWRlYWJsZVRva2VuLCBMb3N0QW5kRm91bmRUb2tlbiB7CgogIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJUb2tlbkhvbWUiOwoKICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJUSCI7CgogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgYWRkcmVzcyBwdWJsaWMgbG9zdF9hbmRfZm91bmRfbWFzdGVyOwoKICAvKioKICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLgogICAqCiAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAqCiAgICogQHBhcmFtIGluaXRpYWxfc3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoLgogICAqIEBwYXJhbSB0b2tlbl9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgdGhhdCByZWNlaXZlcyB0aGUgaW5pdGlhbCBzdXBwbHkgYW5kIGlzIHNldCBhcyB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICogQHBhcmFtIG1pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIEVSQzIwIHRva2VucyB0aGF0IHdlcmUgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbih1aW50IGluaXRpYWxfc3VwcGx5LCB1aW50OCB0b2tlbl9kZWNpbWFscywgYWRkcmVzcyB0ZWFtX211bHRpc2lnLCBib29sIG1pbnRhYmxlLCBhZGRyZXNzIHRva2VuX3JldHJpZXZlcikgcHVibGljCiAgVXBncmFkZWFibGVUb2tlbih0ZWFtX211bHRpc2lnKSBNaW50YWJsZVRva2VuKGluaXRpYWxfc3VwcGx5LCB0ZWFtX211bHRpc2lnLCBtaW50YWJsZSkgewogICAgcmVxdWlyZSh0b2tlbl9yZXRyaWV2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICBkZWNpbWFscyA9IHRva2VuX2RlY2ltYWxzOwogICAgbG9zdF9hbmRfZm91bmRfbWFzdGVyID0gdG9rZW5fcmV0cmlldmVyOwogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIHByb2hpYml0IG5ldyB0b2tlbiBjcmVhdGlvbi4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgZnVuY3Rpb24gYnVybihhZGRyZXNzIGFjY291bnQsIHVpbnQgdmFsdWUpIG9ubHlPd25lciBwdWJsaWMgewogICAgYnVyblRva2VucyhhY2NvdW50LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkgdG8ga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIGEgc3VjY2Vzcy4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gcmVsZWFzZWQgJiYgc3VwZXIuY2FuVXBncmFkZSgpOwogIH0KCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3MpIHsKICAgIHJldHVybiBsb3N0X2FuZF9mb3VuZF9tYXN0ZXI7CiAgfQoKfQovKioKICogQWJzdHJhY3QgYmFzZSBjb250cmFjdCBmb3IgdG9rZW4gc2FsZXMuCiAqCiAqIEhhbmRsZXMKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQogKgogKi8KY29udHJhY3QgR2VuZXJpY0Nyb3dkc2FsZSBpcyBIYWx0YWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8KICBDcm93ZHNhbGVUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8qIGV0aGVyIHdpbGwgYmUgdHJhbnNmZXJyZWQgdG8gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIHRoZSBzdGFydGluZyBibG9jayBudW1iZXIgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgZW5kaW5nIGJsb2NrIG51bWJlciBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwoKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAvKiBIb3cgbWFueSBkaXN0aW5jdCBhZGRyZXNzZXMgaGF2ZSBpbnZlc3RlZCAqLwogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQgPSBmYWxzZTsKCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIGEgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQgPSBmYWxzZTsKCiAgLyoqCiAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLgogICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIHRoZSBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYWQgYWNjZXB0ZWQgdGVybXMgb2Ygc2FsZSAob24gdGhlIHdlYikuCiAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdHJ1ZTsKCiAgLyoqIFNlcnZlciBzaWRlIGFkZHJlc3MgdGhhdCBzaWduZWQgYWxsb3dlZCBjb250cmlidXRvcnMgKEV0aGVyZXVtIGFkZHJlc3NlcykgdGhhdCBjYW4gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSAqLwogIGFkZHJlc3MgcHVibGljIHNpZ25lckFkZHJlc3M7CgogIC8qKiBIb3cgbWFueSBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCBpbiB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwoKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2lhbGx5IG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7CgogIC8qKiBTdGF0ZSBtYWNoaW5lCiAgICoKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHJlYWNoZWQgdGhlIHN0YXJ0aW5nIGJsb2NrIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogQ3Jvd2RzYWxlIGVuZGVkCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGaW5hbGl6ZWR9CgoKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CgogIC8vIFRoZSBydWxlcyBhYm91dCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0IHdlcmUgY2hhbmdlZAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUNJZCwgYm9vbCByZXF1aXJlU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXIpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSdzIGZpbmFsaXplIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZAogIGV2ZW50IEZpbmFsaXplZCgpOwoKCiAgLyoqCiAgICogQmFzaWMgY29uc3RydWN0b3IgZm9yIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWduYXR1cmUgd2FsbGV0IG9mIHRoZSB0ZWFtIHRoYXQgd2lsbCByZWNlaXZlIGFsbCB0aGUgZnVuZHMgY29udHJpYnV0ZWQgaW4gdGhlIGNyb3dkc2FsZS4KICAgKiBAcGFyYW0gc3RhcnQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgd2lsbCBiZSBvZmZpY2lhbGx5IHN0YXJ0ZWQuIEl0IHNob3VsZCBiZSBncmVhdGVyIHRoYW4gdGhlIGJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgY29udHJhY3QgaXMgZGVwbG95ZWQuCiAgICogQHBhcmFtIGVuZCBCbG9jayBudW1iZXIgd2hlcmUgdGhlIGNyb3dkc2FsZSBmaW5pc2hlcy4gTm8gdG9rZW5zIGNhbiBiZSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCBhZnRlciB0aGlzIGJsb2NrLgogICAqLwogIGZ1bmN0aW9uIEdlbmVyaWNDcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCkgaW50ZXJuYWwgewogICAgc2V0TXVsdGlzaWcodGVhbV9tdWx0aXNpZyk7CgogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMKICAgIHJlcXVpcmUoc3RhcnQgIT0gMCAmJiBlbmQgIT0gMCk7CiAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0ICYmIHN0YXJ0IDwgZW5kKTsKICAgIHN0YXJ0c0F0ID0gc3RhcnQ7CiAgICBlbmRzQXQgPSBlbmQ7CiAgfQoKICAvKioKICAgKiBEZWZhdWx0IGZhbGxiYWNrIGJlaGF2aW91ciBpcyB0byBjYWxsIGJ1eS4KICAgKiBJZGVhbGx5LCBubyBjb250cmFjdCBjYWxscyB0aGlzIGNyb3dkc2FsZSB3aXRob3V0IHN1cHBvcnRpbmcgRVJDMjAuCiAgICogSG93ZXZlciwgc29tZSBzb3J0IG9mIHJlZnVuZGluZyBmdW5jdGlvbiBtYXkgYmUgZGVzaXJlZCB0byBjb3ZlciBzdWNoIHNpdHVhdGlvbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBidXkoKTsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIFRoZSBjcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgbm90RmluaXNoZWQgcHJpdmF0ZSB7CiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmIChnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0CiAgICAgIHJlcXVpcmUoZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQ7CiAgICB1aW50IHRva2VuQW1vdW50OwogICAgKHdlaUFtb3VudCwgdG9rZW5BbW91bnQpID0gY2FsY3VsYXRlVG9rZW5BbW91bnQobXNnLnZhbHVlLCByZWNlaXZlcik7CiAgICAvLyBTYW5pdHkgY2hlY2sgYWdhaW5zdCBiYWQgaW1wbGVtZW50YXRpb24uCiAgICBhc3NlcnQod2VpQW1vdW50IDw9IG1zZy52YWx1ZSk7CiAgICAKICAgIC8vIER1c3QgdHJhbnNhY3Rpb24gaWYgbm8gdG9rZW5zIGNhbiBiZSBnaXZlbgogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKCiAgICBpZiAoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAvLyBBIG5ldyBpbnZlc3RvcgogICAgICBpbnZlc3RvckNvdW50Kys7CiAgICB9CiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyLCBjdXN0b21lcklkKTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBtdWx0aXNpZ1dhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgIC8vIFJldHVybiBleGNlc3Mgb2YgbW9uZXkKICAgIHJldHVybkV4Y2VkZW50KG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KSwgbXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIEFjY291bnQgdGhhdCByZWNlaXZlcyB0aGUgdG9rZW5zLgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFyZSBhZGRlZCBpbnRlcm5hbGx5LgogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBpbmRpdmlzaWJsZSB0b2tlbiBpbiB3ZWkuCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgewogICAgcmVxdWlyZShyZWNlaXZlciAhPSBhZGRyZXNzKDApKTsKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBmdWxsVG9rZW5zLm11bCgxMCoqdWludCh0b2tlbi5kZWNpbWFscygpKSk7CiAgICByZXF1aXJlKHRva2VuQW1vdW50ICE9IDApOwogICAgdWludCB3ZWlBbW91bnQgPSB3ZWlQcmljZS5tdWwodG9rZW5BbW91bnQpOyAvLyBUaGlzIGNhbiBhbHNvIGJlIDAsIGluIHdoaWNoIGNhc2Ugd2UgZ2l2ZSBvdXQgdG9rZW5zIGZvciBmcmVlCiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyICwgMCk7CiAgfQoKICAvKioKICAgKiBQcml2YXRlIGZ1bmN0aW9uIHRvIHVwZGF0ZSBhY2NvdW50aW5nIGluIHRoZSBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gdXBkYXRlSW52ZXN0b3JGdW5kcyh1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBwcml2YXRlIHsKICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5hZGQod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0uYWRkKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQodG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogICAgLy8gVGVsbCB1cyB0aGF0IHRoZSBpbnZlc3RtZW50IHdhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5CiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSByZWNlaXZlciBhbmQgdmVyaWZpZXMgaGUgaXMgYWxsb3dlZCB0byBpbnZlc3QuCiAgICoKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZldpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB7CiAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYocmVjZWl2ZXIpOwogICAgcmVxdWlyZShlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgPT0gc2lnbmVyQWRkcmVzcyk7CiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSByZWNlaXZlci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZldpdGhDdXN0b21lcklkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgdmFsaWRDdXN0b21lcklkKGN1c3RvbWVySWQpIHVuc2lnbmVkQnV5QWxsb3dlZCB7CiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBCdXlzIHRva2VucyBvbiBiZWhhbGYgb2YgYW4gYWRkcmVzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSByZWNlaXZlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eU9uQmVoYWxmKGFkZHJlc3MgcmVjZWl2ZXIpIHB1YmxpYyBwYXlhYmxlIHVuc2lnbmVkQnV5QWxsb3dlZCB7CiAgICByZXF1aXJlKCFyZXF1aXJlQ3VzdG9tZXJJZCk7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aWNpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbAogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIDApOwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcGF5ZXIgYW5kIHZlcmlmaWVzIGhlIGlzIGFsbG93ZWQgdG8gaW52ZXN0LgogICAqCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgYnV5T25CZWhhbGZXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsKICB9CgoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmV2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmKG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqIE5vdGUgdGhhdCBieSBkZWZhdWx0IHRva2VucyBhcmUgbm90IGluIGEgcmVsZWFzZWQgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgICBGaW5hbGl6ZWQoKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4KICAgKgogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIHNpZ25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBzaWduZXI7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCBzdG9wSW5FbWVyZ2VuY3kgewogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQoKICAvKioKICAgKiBJbnRlcm5hbCBzZXR0ZXIgZm9yIHRoZSBtdWx0aXNpZyB3YWxsZXQKICAgKi8KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWRkciAhPSAwKTsKICAgIG11bHRpc2lnV2FsbGV0ID0gYWRkcjsKICB9CgogIC8qKgogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICoKICAgKiBUaGlzIGZ1bmN0aW9uIGhhcyB0aGUgdGltZWQgdHJhbnNpdGlvbiBidWlsdGluLgogICAqIFNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChTdGF0ZSkgewogICAgaWYgKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgfQoKICAvKiogSW50ZXJuYWwgZnVuY3Rpb25zIHRoYXQgZXhpc3QgdG8gcHJvdmlkZSBpbnZlcnNpb24gb2YgY29udHJvbCBzaG91bGQgdGhleSBiZSBvdmVycmlkZW4gKi8KCiAgLyoqIEludGVyZmFjZSBmb3IgdGhlIGNvbmNyZXRlIGluc3RhbmNlIHRvIGludGVyYWN0IHdpdGggdGhlIHRva2VuIGNvbnRyYWN0IGluIGEgY3VzdG9taXphYmxlIHdheSAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqCiAgICogIERldGVybWluZSBpZiB0aGUgZ29hbCB3YXMgYWxyZWFkeSByZWFjaGVkIGluIHRoZSBjdXJyZW50IGNyb3dkc2FsZQogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCBmdWxsKTsKCiAgLyoqCiAgICogUmV0dXJucyBhbnkgZXhjZXNzIHdlaSByZWNlaXZlZAogICAqIAogICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIG92ZXJyaWRlbiB0byBwcm92aWRlIGEgZGlmZmVyZW50IHJlZnVuZGluZyBtZXRob2QuCiAgICovCiAgZnVuY3Rpb24gcmV0dXJuRXhjZWRlbnQodWludCBleGNlZGVudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgewogICAgaWYgKGV4Y2VkZW50ID4gMCkgewogICAgICByZWNlaXZlci50cmFuc2ZlcihleGNlZGVudCk7CiAgICB9CiAgfQoKICAvKiogCiAgICogIENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSByZWNlaXZlZCBhbW91bnQuCiAgICogIFRoZSB3ZWkgYW1vdW50IGlzIHJldHVybmVkIHRvbyBpbiBjYXNlIG5vdCBhbGwgb2YgaXQgY2FuIGJlIGludmVzdGVkLgogICAqCiAgICogIE5vdGU6IFdoZW4gdGhlcmUncyBhbiBleGNlZGVudCBkdWUgdG8gcm91bmRpbmcgZXJyb3IsIGl0IHNob3VsZCBiZSByZXR1cm5lZCB0byBhbGxvdyByZWZ1bmRpbmcuCiAgICogIFRoaXMgaXMgd29ya2VkIGFyb3VuZCBpbiB0aGUgY3VycmVudCBkZXNpZ24gdXNpbmcgYW4gYXBwcm9wcmlhdGUgYW1vdW50IG9mIGRlY2ltYWxzIGluIHRoZSBGcmFjdGlvbmFsRVJDMjAgc3RhbmRhcmQuCiAgICogIFRoZSB3b3JrYXJvdW5kIGlzIGdvb2QgZW5vdWdoIGZvciBtb3N0IHVzZSBjYXNlcywgaGVuY2UgdGhlIHNpbXBsaWZpZWQgZnVuY3Rpb24gc2lnbmF0dXJlLgogICAqICBAcmV0dXJuIHdlaUFsbG93ZWQgVGhlIGFtb3VudCBvZiB3ZWkgYWNjZXB0ZWQgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKiAgQHJldHVybiB0b2tlbkFtb3VudCBUaGUgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIHRoZSByZWNlaXZlciBpbiB0aGlzIHRyYW5zYWN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQW1vdW50KHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzIHJlY2VpdmVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgd2VpQWxsb3dlZCwgdWludCB0b2tlbkFtb3VudCk7CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgcmVxdWlyZShnZXRTdGF0ZSgpID09IHN0YXRlKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB1bnNpZ25lZEJ1eUFsbG93ZWQoKSB7CiAgICByZXF1aXJlKCFyZXF1aXJlZFNpZ25lZEFkZHJlc3MpOwogICAgXzsKICB9CgogIC8qKiBNb2RpZmllciBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBub3RGaW5pc2hlZCgpIHsKICAgIFN0YXRlIGN1cnJlbnRfc3RhdGUgPSBnZXRTdGF0ZSgpOwogICAgcmVxdWlyZShjdXJyZW50X3N0YXRlID09IFN0YXRlLlByZUZ1bmRpbmcgfHwgY3VycmVudF9zdGF0ZSA9PSBTdGF0ZS5GdW5kaW5nKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB2YWxpZEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSB7CiAgICByZXF1aXJlKGN1c3RvbWVySWQgIT0gMCk7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICBfOwogIH0KCn0KCgoKCgovLyBTaW1wbGUgZGVwbG95bWVudCBpbmZvcm1hdGlvbiBzdG9yZSBpbnNpZGUgY29udHJhY3Qgc3RvcmFnZS4KY29udHJhY3QgRGVwbG95bWVudEluZm8gewogIHVpbnQgcHJpdmF0ZSBkZXBsb3llZF9vbjsKCiAgZnVuY3Rpb24gRGVwbG95bWVudEluZm8oKSBwdWJsaWMgewogICAgZGVwbG95ZWRfb24gPSBibG9jay5udW1iZXI7CiAgfQoKCiAgZnVuY3Rpb24gZ2V0RGVwbG95bWVudEJsb2NrKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGRlcGxveWVkX29uOwogIH0KfQoKCi8vLyBAZGV2IFRyYW5jaGUgYmFzZWQgcHJpY2luZy4KLy8vICAgICAgSW1wbGVtZW50aW5nICJmaXJzdCBwcmljZSIgdHJhbmNoZXMsIG1lYW5pbmcsIHRoYXQgaWYgYSBidXllcidzIG9yZGVyIGlzCi8vLyAgICAgIGNvdmVyaW5nIG1vcmUgdGhhbiBvbmUgdHJhbmNoZSwgdGhlIHByaWNlIG9mIHRoZSBsb3dlc3QgdHJhbmNoZSB3aWxsIGFwcGx5Ci8vLyAgICAgIHRvIHRoZSB3aG9sZSBvcmRlci4KY29udHJhY3QgVG9rZW5UcmFuY2hlUHJpY2luZyB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKioKICAgKiBEZWZpbmUgcHJpY2luZyBzY2hlZHVsZSB1c2luZyB0cmFuY2hlcy4KICAgKi8KICBzdHJ1Y3QgVHJhbmNoZSB7CiAgICAgIC8vIEFtb3VudCBpbiB0b2tlbnMgd2hlbiB0aGlzIHRyYW5jaGUgYmVjb21lcyBpbmFjdGl2ZQogICAgICB1aW50IGFtb3VudDsKICAgICAgLy8gQmxvY2sgaW50ZXJ2YWwgW3N0YXJ0LCBlbmQpCiAgICAgIC8vIFN0YXJ0aW5nIGJsb2NrIChpbmNsdWRlZCBpbiB0aGUgaW50ZXJ2YWwpCiAgICAgIHVpbnQgc3RhcnQ7CiAgICAgIC8vIEVuZGluZyBibG9jayAoZXhjbHVkZWQgZnJvbSB0aGUgaW50ZXJ2YWwpCiAgICAgIHVpbnQgZW5kOwogICAgICAvLyBIb3cgbWFueSB0b2tlbnMgcGVyIHdlaSB5b3Ugd2lsbCBnZXQgd2hpbGUgdGhpcyB0cmFuY2hlIGlzIGFjdGl2ZQogICAgICB1aW50IHByaWNlOwogIH0KICAvLyBXZSBkZWZpbmUgb2Zmc2V0cyBhbmQgc2l6ZSBmb3IgdGhlIGRlc2VyaWFsaXphdGlvbiBvZiBvcmRlcmVkIHR1cGxlcyBpbiByYXcgYXJyYXlzCiAgdWludCBwcml2YXRlIGNvbnN0YW50IGFtb3VudF9vZmZzZXQgPSAwOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBzdGFydF9vZmZzZXQgPSAxOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBlbmRfb2Zmc2V0ID0gMjsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgcHJpY2Vfb2Zmc2V0ID0gMzsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgdHJhbmNoZV9zaXplID0gNDsKCiAgVHJhbmNoZVtdIHB1YmxpYyB0cmFuY2hlczsKCiAgZnVuY3Rpb24gZ2V0VHJhbmNoZXNMZW5ndGgoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdHJhbmNoZXMubGVuZ3RoOwogIH0KCiAgLy8vIEBkZXYgQ29uc3RydWN0aW9uLCBjcmVhdGluZyBhIGxpc3Qgb2YgdHJhbmNoZXMKICAvLy8gQHBhcmFtIGluaXRfdHJhbmNoZXMgUmF3IGFycmF5IG9mIG9yZGVyZWQgdHVwbGVzOiAoc3RhcnQgYW1vdW50LCBzdGFydCBibG9jaywgZW5kIGJsb2NrLCBwcmljZSkKICBmdW5jdGlvbiBUb2tlblRyYW5jaGVQcmljaW5nKHVpbnRbXSBpbml0X3RyYW5jaGVzKSBwdWJsaWMgewogICAgLy8gTmVlZCB0byBoYXZlIHR1cGxlcywgbGVuZ3RoIGNoZWNrCiAgICByZXF1aXJlKGluaXRfdHJhbmNoZXMubGVuZ3RoICUgdHJhbmNoZV9zaXplID09IDApOwogICAgLy8gQSB0cmFuY2hlIHdpdGggYW1vdW50IHplcm8gY2FuIG5ldmVyIGJlIHNlbGVjdGVkIGFuZCBpcyB0aGVyZWZvcmUgdXNlbGVzcy4KICAgIC8vIFRoaXMgY2hlY2sgYW5kIHRoZSBvbmUgaW5zaWRlIHRoZSBsb29wIGVuc3VyZSBubyB0cmFuY2hlIGNhbiBoYXZlIGFuIGFtb3VudCBlcXVhbCB0byB6ZXJvLgogICAgcmVxdWlyZShpbml0X3RyYW5jaGVzW2Ftb3VudF9vZmZzZXRdID4gMCk7CgogICAgdWludCBpbnB1dF90cmFuY2hlc19sZW5ndGggPSBpbml0X3RyYW5jaGVzLmxlbmd0aC5kaXYodHJhbmNoZV9zaXplKTsKICAgIFRyYW5jaGUgbWVtb3J5IGxhc3RfdHJhbmNoZTsKICAgIGZvciAodWludCBpID0gMDsgaSA8IGlucHV0X3RyYW5jaGVzX2xlbmd0aDsgaSsrKSB7CiAgICAgIHVpbnQgdHJhbmNoZV9vZmZzZXQgPSBpLm11bCh0cmFuY2hlX3NpemUpOwogICAgICB1aW50IGFtb3VudCA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKGFtb3VudF9vZmZzZXQpXTsKICAgICAgdWludCBzdGFydCA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKHN0YXJ0X29mZnNldCldOwogICAgICB1aW50IGVuZCA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKGVuZF9vZmZzZXQpXTsKICAgICAgdWludCBwcmljZSA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKHByaWNlX29mZnNldCldOwogICAgICAvLyBObyBpbnZhbGlkIHN0ZXBzCiAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDwgc3RhcnQgJiYgc3RhcnQgPCBlbmQpOwogICAgICAvLyBCYWlsIG91dCB3aGVuIGVudGVyaW5nIHVubmVjZXNzYXJ5IHRyYW5jaGVzCiAgICAgIC8vIFRoaXMgaXMgcHJlZmVyYWJseSBjaGVja2VkIGJlZm9yZSBkZXBsb3lpbmcgY29udHJhY3QgaW50byBhbnkgYmxvY2tjaGFpbi4KICAgICAgcmVxdWlyZShpID09IDAgfHwgKGVuZCA+PSBsYXN0X3RyYW5jaGUuZW5kICYmIGFtb3VudCA+IGxhc3RfdHJhbmNoZS5hbW91bnQpIHx8CiAgICAgICAgICAgICAgKGVuZCA+IGxhc3RfdHJhbmNoZS5lbmQgJiYgYW1vdW50ID49IGxhc3RfdHJhbmNoZS5hbW91bnQpKTsKCiAgICAgIGxhc3RfdHJhbmNoZSA9IFRyYW5jaGUoYW1vdW50LCBzdGFydCwgZW5kLCBwcmljZSk7CiAgICAgIHRyYW5jaGVzLnB1c2gobGFzdF90cmFuY2hlKTsKICAgIH0KICB9CgogIC8vLyBAZGV2IEdldCB0aGUgY3VycmVudCB0cmFuY2hlIG9yIGJhaWwgb3V0IGlmIHRoZXJlIGlzIG5vIHRyYW5jaGUgZGVmaW5lZCBmb3IgdGhlIGN1cnJlbnQgYmxvY2suCiAgLy8vIEBwYXJhbSB0b2tlbnNTb2xkIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBzdHJ1Y3QgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICBmdW5jdGlvbiBnZXRDdXJyZW50VHJhbmNoZSh1aW50IHRva2Vuc1NvbGQpIHByaXZhdGUgdmlldyByZXR1cm5zIChUcmFuY2hlIHN0b3JhZ2UpIHsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHRyYW5jaGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh0cmFuY2hlc1tpXS5zdGFydCA8PSBibG9jay50aW1lc3RhbXAgJiYgYmxvY2sudGltZXN0YW1wIDwgdHJhbmNoZXNbaV0uZW5kICYmIHRva2Vuc1NvbGQgPCB0cmFuY2hlc1tpXS5hbW91bnQpIHsKICAgICAgICByZXR1cm4gdHJhbmNoZXNbaV07CiAgICAgIH0KICAgIH0KICAgIC8vIE5vIHRyYW5jaGUgaXMgY3VycmVudGx5IGFjdGl2ZQogICAgcmV2ZXJ0KCk7CiAgfQoKICAvLy8gQGRldiBHZXQgdGhlIGN1cnJlbnQgcHJpY2UuIE1heSByZXZlcnQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBjdXJyZW50bHkgYWN0aXZlLgogIC8vLyBAcGFyYW0gdG9rZW5zU29sZCB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQsIGZvciBjYWxjdWxhdGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgLy8vIEByZXR1cm4gVGhlIGN1cnJlbnQgcHJpY2UKICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludCB0b2tlbnNTb2xkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICByZXR1cm4gZ2V0Q3VycmVudFRyYW5jaGUodG9rZW5zU29sZCkucHJpY2U7CiAgfQoKfQovLyBUaGlzIGNvbnRyYWN0IGhhcyB0aGUgc29sZSBvYmplY3RpdmUgb2YgcHJvdmlkaW5nIGEgc2FuZSBjb25jcmV0ZSBpbnN0YW5jZSBvZiB0aGUgQ3Jvd2RzYWxlIGNvbnRyYWN0Lgpjb250cmFjdCBDcm93ZHNhbGUgaXMgR2VuZXJpY0Nyb3dkc2FsZSwgTG9zdEFuZEZvdW5kVG9rZW4sIERlcGxveW1lbnRJbmZvLCBUb2tlblRyYW5jaGVQcmljaW5newogIC8vCiAgdWludCBwcml2YXRlIGNvbnN0YW50IHRva2VuX2luaXRpYWxfc3VwcGx5ID0gODUgKiAoMTAgKiogNikgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogIHVpbnQ4IHByaXZhdGUgY29uc3RhbnQgdG9rZW5fZGVjaW1hbHMgPSAxODsKICBib29sIHByaXZhdGUgY29uc3RhbnQgdG9rZW5fbWludGFibGUgPSB0cnVlOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBzZWxsYWJsZV90b2tlbnMgPSAzNDAgKiAoMTAgKiogNikgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogIHVpbnQgcHVibGljIG1pbGlldXJzX3Blcl9ldGg7CiAgLyoqCiAgICogQ29uc3RydWN0b3IgZm9yIHRoZSBjcm93ZHNhbGUuCiAgICogTm9ybWFsbHksIHRoZSB0b2tlbiBjb250cmFjdCBpcyBjcmVhdGVkIGhlcmUuIFRoYXQgd2F5LCB0aGUgbWludGluZywgcmVsZWFzZSBhbmQgdHJhbnNmZXIgYWdlbnRzIGNhbiBiZSBzZXQgaGVyZSB0b28uCiAgICoKICAgKiBAcGFyYW0gdGVhbV9tdWx0aXNpZyBBZGRyZXNzIG9mIHRoZSBtdWx0aXNpZ25hdHVyZSB3YWxsZXQgb2YgdGhlIHRlYW0gdGhhdCB3aWxsIHJlY2VpdmUgYWxsIHRoZSBmdW5kcyBjb250cmlidXRlZCBpbiB0aGUgY3Jvd2RzYWxlLgogICAqIEBwYXJhbSBzdGFydCBCbG9jayBudW1iZXIgd2hlcmUgdGhlIGNyb3dkc2FsZSB3aWxsIGJlIG9mZmljaWFsbHkgc3RhcnRlZC4gSXQgc2hvdWxkIGJlIGdyZWF0ZXIgdGhhbiB0aGUgYmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBjb250cmFjdCBpcyBkZXBsb3llZC4KICAgKiBAcGFyYW0gZW5kIEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIGZpbmlzaGVzLiBObyB0b2tlbnMgY2FuIGJlIHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0IGFmdGVyIHRoaXMgYmxvY2suCiAgICogQHBhcmFtIHRva2VuX3JldHJpZXZlciBBZGRyZXNzIHRoYXQgd2lsbCBoYW5kbGUgdG9rZW5zIGFjY2lkZW50YWxseSBzZW50IHRvIHRoZSB0b2tlbiBjb250cmFjdC4gU2VlIHRoZSBMb3N0QW5kRm91bmRUb2tlbiBhbmQgQ3Jvd2RzYWxlVG9rZW4gY29udHJhY3RzIGZvciBmdXJ0aGVyIGRldGFpbHMuCiAgICovCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgdWludCBzdGFydCwgdWludCBlbmQsIGFkZHJlc3MgdG9rZW5fcmV0cmlldmVyLCB1aW50W10gaW5pdF90cmFuY2hlcywgdWludCBtaWxpX2V1cnNfcGVyX2V0aCkgR2VuZXJpY0Nyb3dkc2FsZSh0ZWFtX211bHRpc2lnLCBzdGFydCwgZW5kKSBUb2tlblRyYW5jaGVQcmljaW5nKGluaXRfdHJhbmNoZXMpIHB1YmxpYyB7CgogICAgcmVxdWlyZShlbmQgPT0gdHJhbmNoZXNbdHJhbmNoZXMubGVuZ3RoLnN1YigxKV0uZW5kKTsKICAgIC8vIFRlc3RpbmcgdmFsdWVzCiAgICB0b2tlbiA9IG5ldyBDcm93ZHNhbGVUb2tlbih0b2tlbl9pbml0aWFsX3N1cHBseSwgdG9rZW5fZGVjaW1hbHMsIHRlYW1fbXVsdGlzaWcsIHRva2VuX21pbnRhYmxlLCB0b2tlbl9yZXRyaWV2ZXIpOwogICAgCiAgICAvLyBTZXQgcGVybWlzc2lvbnMgdG8gbWludCwgdHJhbnNmZXIgYW5kIHJlbGVhc2UKICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLnNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyh0aGlzKSwgdHJ1ZSk7CiAgICB0b2tlbi5zZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyh0aGlzKSk7CiAgICAKICAgIC8vIFRva2VucyB0byBiZSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdAogICAgdG9rZW4ubWludChhZGRyZXNzKHRoaXMpLCBzZWxsYWJsZV90b2tlbnMpOwogICAgCiAgICAvLyBXZSBkb24ndCBuZWVkIHRvIG1pbnQgYW55bW9yZSBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIHRoZSBjb250cmFjdC4KICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCBmYWxzZSk7CiAgICAKICAgIC8vR2l2ZSBtdWx0aXNpZyBwZXJtaXNpb24gdG8gc2VuZCB0b2tlbnMgdG8gcGFydG5lcnMKICAgIHRva2VuLnNldFRyYW5zZmVyQWdlbnQodGVhbV9tdWx0aXNpZywgdHJ1ZSk7CgogICAgdXBkYXRlRXVyc1BlckV0aChtaWxpX2V1cnNfcGVyX2V0aCk7CiAgfQoKICAvL1Rva2VuIGFzc2lnbmF0aW9uIHRocm91Z2ggdHJhbnNmZXIKICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgaW50ZXJuYWx7CiAgICB0b2tlbi50cmFuc2ZlcihyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogIH0KCiAgLy9Ub2tlbiBhbW91bnQgY2FsY3VsYXRpb24KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcykgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHdlaUFsbG93ZWQsIHVpbnQgdG9rZW5BbW91bnQpewogICAgdWludCB0b2tlbnNQZXJFdGggPSBnZXRDdXJyZW50UHJpY2UodG9rZW5zU29sZCkubXVsKG1pbGlldXJzX3Blcl9ldGgpLmRpdigxMDAwKTsKICAgIHVpbnQgbWF4V2VpQWxsb3dlZCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCkubXVsKDEgZXRoZXIpLmRpdih0b2tlbnNQZXJFdGgpOwogICAgd2VpQWxsb3dlZCA9IG1heFdlaUFsbG93ZWQubWluMjU2KHdlaUFtb3VudCk7CgogICAgaWYgKHdlaUFtb3VudCA8IG1heFdlaUFsbG93ZWQpIHsKICAgICAgLy9EaXZpZGVkIGJ5IDEwMDAgYmVjYXVzZSBldGggZXRoX3ByaWNlX2luX2V1cnMgaXMgbXVsdGlwbGllZCBieSAxMDAwCiAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5zUGVyRXRoLm11bCh3ZWlBbW91bnQpLmRpdigxIGV0aGVyKTsKICAgIH0KICAgIC8vIFdpdGggdGhpcyBjYXNlIHdlIGxldCB0aGUgY3Jvd2RzYWxlIGVuZCBldmVuIHdoZW4gdGhlcmUgYXJlIHJvdW5kaW5nIGVycm9ycyBkdWUgdG8gdGhlIHRva2VucyB0byB3ZWkgcmF0aW8KICAgIGVsc2UgewogICAgICB0b2tlbkFtb3VudCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCk7CiAgICB9CiAgfQoKICAvLyBDcm93ZHNhbGUgaXMgZnVsbCBvbmNlIGFsbCBzZWxsYWJsZV90b2tlbnMgYXJlIHNvbGQuCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sIGZ1bGwpIHsKICAgIHJldHVybiB0b2tlbnNTb2xkID49IHNlbGxhYmxlX3Rva2VuczsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGUgb3duZXIgY2FuIHRyaWdnZXIgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKiBOb3RlIHRoYXQgYnkgZGVmYXVsdCB0b2tlbnMgYXJlIG5vdCBpbiBhIHJlbGVhc2VkIHN0YXRlLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICB0b2tlbi5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogICAgdWludCB1bnNvbGRUb2tlbnMgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICB0b2tlbi5idXJuKGFkZHJlc3ModGhpcyksIHVuc29sZFRva2Vucyk7CiAgICBzdXBlci5maW5hbGl6ZSgpOwogIH0KCgogIC8vQ2hhbmdlIHRoZSB0aGUgc3RhcnRpbmcgdGltZSBpbiBvcmRlciB0byBlbmQgdGhlIHByZXNhbGUgcGVyaW9kIGVhcmx5IGlmIG5lZWRlZC4KICBmdW5jdGlvbiBzZXRTdGFydGluZ1RpbWUodWludCBzdGFydGluZ1RpbWUpIHB1YmxpYyBvbmx5T3duZXIgaW5TdGF0ZShTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICByZXF1aXJlKHN0YXJ0aW5nVGltZSA+IGJsb2NrLnRpbWVzdGFtcCAmJiBzdGFydGluZ1RpbWUgPCBlbmRzQXQpOwogICAgc3RhcnRzQXQgPSBzdGFydGluZ1RpbWU7CiAgfQoKICAvL0NoYW5nZSB0aGUgdGhlIGVuZGluZyB0aW1lIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gZmluYWxpemUgdGhlIGNyb3dkc2FsZSBpZiBuZWVkZWQuCiAgZnVuY3Rpb24gc2V0RW5kaW5nVGltZSh1aW50IGVuZGluZ1RpbWUpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgewogICAgcmVxdWlyZShlbmRpbmdUaW1lID4gYmxvY2sudGltZXN0YW1wICYmIGVuZGluZ1RpbWUgPiBzdGFydHNBdCk7CiAgICBlbmRzQXQgPSBlbmRpbmdUaW1lOwogIH0KCiAgLyoqCiAgICogVGhpcyBmdW5jdGlvbiBkZWNpZGVzIHdobyBoYW5kbGVzIGxvc3QgdG9rZW5zLgogICAqIERvIG5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIE5PVCBtZWFudCB0byBiZSB1c2VkIGluIGEgdG9rZW4gcmVmdW5kIG1lY2FobmlzbS4KICAgKiBJdHMgc29sZSBwdXJwb3NlIGlzIGRldGVybWluaW5nIHdobyBjYW4gbW92ZSBhcm91bmQgRVJDMjAgdG9rZW5zIGFjY2lkZW50YWxseSBzZW50IHRvIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gb3duZXI7CiAgfQogIAogIC8vVXBkYXRlIEVUSCB2YWx1ZSBpbiBtaWxpZXVycwogIGZ1bmN0aW9uIHVwZGF0ZUV1cnNQZXJFdGggKHVpbnQgbWlsaWV1cnNfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobWlsaWV1cnNfYW1vdW50ID49IDEwMCk7CiAgICBtaWxpZXVyc19wZXJfZXRoID0gbWlsaWV1cnNfYW1vdW50OwogIH0KICAvKioKICAgKiBPdmVycmlkZSB0byByZWplY3QgY2FsbHMgdW5sZXNzIHRoZSBjcm93ZHNhbGUgaXMgZmluYWxpemVkIG9yCiAgICogIHRoZSB0b2tlbiBjb250cmFjdCBpcyBub3QgdGhlIG9uZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgY3Jvd2RzYWxlCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlTG9zdEFuZEZvdW5kKGFkZHJlc3MgYWdlbnQsIHVpbnQgdG9rZW5zLCBFSVAyMFRva2VuIHRva2VuX2NvbnRyYWN0KSBwdWJsaWMgewogICAgLy8gRWl0aGVyIHRoZSBzdGF0ZSBpcyBmaW5hbGl6ZWQgb3IgdGhlIHRva2VuX2NvbnRyYWN0IGlzIG5vdCB0aGlzIGNyb3dkc2FsZSB0b2tlbgogICAgcmVxdWlyZShhZGRyZXNzKHRva2VuX2NvbnRyYWN0KSAhPSBhZGRyZXNzKHRva2VuKSB8fCBnZXRTdGF0ZSgpID09IFN0YXRlLkZpbmFsaXplZCk7CiAgICBzdXBlci5lbmFibGVMb3N0QW5kRm91bmQoYWdlbnQsIHRva2VucywgdG9rZW5fY29udHJhY3QpOwogIH0KfQ=='.
	

]
