Class {
	#name : #SRTd2f81cd7a20d60c0d558496c7169a20968389b40,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd2f81cd7a20d60c0d558496c7169a20968389b40 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCgogLy8gUGF1c2UgZnVuY3Rpb25hbGl0eSB0YWtlbiBmcm9tIE9wZW5aZXBwZWxpbi4gTGljZW5zZSBiZWxvdy4KIC8qIFRoZSBNSVQgTGljZW5zZSAoTUlUKQogQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nCiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUKICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcKIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwKIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0bwogcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCiB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6ICovCgogLyoqCiAgKiBAdGl0bGUgUGF1c2FibGUKICAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKCiAgZXZlbnQgU2V0UGF1c2VkKGJvb2wgcGF1c2VkKTsKCiAgLy8gc3RhcnRzIHVucGF1c2VkCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8qIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZCAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBTZXRQYXVzZWQocGF1c2VkKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFNldFBhdXNlZChwYXVzZWQpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBFdGhlcmJvdHNQcml2aWxlZ2VzIGlzIFBhdXNhYmxlIHsKICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyBuZXdDb250cmFjdCk7Cgp9CgoKCi8vIFRoaXMgY29udHJhY3QgaW1wbGVtZW50cyBib3RoIHRoZSBvcmlnaW5hbCBFUkMtNzIxIHN0YW5kYXJkIGFuZAovLyB0aGUgcHJvcG9zZWQgJ2RlZWQnIHN0YW5kYXJkIG9mIDg0MQovLyBJIGRvbid0IGtub3cgd2hpY2ggc3RhbmRhcmQgd2lsbCBldmVudHVhbGx5IGJlIGFkb3B0ZWQgLSBzdXBwb3J0IGJvdGggZm9yIG5vdwoKCi8vLyBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBEZWVkIFN0YW5kYXJkCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpLCBldC4gYWwuCi8vLyBAZGV2IFNwZWNpZmljYXRpb24gYXQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2VpcHMvODQxCi8vLyBjYW4gcmVhZCB0aGUgY29tbWVudHMgdGhlcmUKY29udHJhY3QgRVJDNzIxIHsKCiAgICAvLyBDT01QTElBTkNFIFdJVEggRVJDLTE2NSAoRFJBRlQpCgogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIGl0c2VsZgogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDMTY1ID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJzdXBwb3J0c0ludGVyZmFjZShieXRlczQpIikpOwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9CiAgICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoIm93bmVyT2YodWludDI1NikiKSkgXgogICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJjb3VudE9mRGVlZHMoKSIpKSBeCiAgICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoImNvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcykiKSkgXgogICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyx1aW50MjU2KSIpKSBeCiAgICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoImFwcHJvdmUoYWRkcmVzcyx1aW50MjU2KSIpKSBeCiAgICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRha2VPd25lcnNoaXAodWludDI1NikiKSk7CgogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKTsKCiAgICAvLyBQVUJMSUMgUVVFUlkgRlVOQ1RJT05TIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9kZWVkSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKTsKICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkcygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfY291bnQpOwogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IF9jb3VudCk7CiAgICBmdW5jdGlvbiBkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2RlZWRJZCk7CgogICAgLy8gVFJBTlNGRVIgTUVDSEFOSVNNIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgcGF5YWJsZTsKICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwYXlhYmxlOwp9CgovLy8gQHRpdGxlIE1ldGFkYXRhIGV4dGVuc2lvbiB0byBFUkMtNzIxIGludGVyZmFjZQovLy8gQGF1dGhvciBXaWxsaWFtIEVudHJpa2VuIChodHRwczovL3Bob3IubmV0KQovLy8gQGRldiBTcGVjaWZpY2F0aW9uIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9laXBzL2lzc3Vlcy9YWFhYCmNvbnRyYWN0IEVSQzcyMU1ldGFkYXRhIGlzIEVSQzcyMSB7CgogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxTWV0YWRhdGEgPQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoIm5hbWUoKSIpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nigic3ltYm9sKCkiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoImRlZWRVcmkodWludDI1NikiKSk7CgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBuKTsKICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBzKTsKCiAgICAvLy8gQG5vdGljZSBBIGRpc3RpbmN0IFVSSSAoUkZDIDM5ODYpIGZvciBhIGdpdmVuIHRva2VuLgogICAgLy8vIEBkZXYgSWY6CiAgICAvLy8gICogVGhlIFVSSSBpcyBhIFVSTAogICAgLy8vICAqIFRoZSBVUkwgaXMgYWNjZXNzaWJsZQogICAgLy8vICAqIFRoZSBVUkwgcG9pbnRzIHRvIGEgdmFsaWQgSlNPTiBmaWxlIGZvcm1hdCAoRUNNQS00MDQgMm5kIGVkLikKICAgIC8vLyAgKiBUaGUgSlNPTiBiYXNlIGVsZW1lbnQgaXMgYW4gb2JqZWN0CiAgICAvLy8gIHRoZW4gdGhlc2UgbmFtZXMgb2YgdGhlIGJhc2UgZWxlbWVudCBTSEFMTCBoYXZlIHNwZWNpYWwgbWVhbmluZzoKICAgIC8vLyAgKiAibmFtZSI6IEEgc3RyaW5nIGlkZW50aWZ5aW5nIHRoZSBpdGVtIHRvIHdoaWNoIGBfZGVlZElkYCBncmFudHMKICAgIC8vLyAgICBvd25lcnNoaXAKICAgIC8vLyAgKiAiZGVzY3JpcHRpb24iOiBBIHN0cmluZyBkZXRhaWxpbmcgdGhlIGl0ZW0gdG8gd2hpY2ggYF9kZWVkSWRgIGdyYW50cwogICAgLy8vICAgIG93bmVyc2hpcAogICAgLy8vICAqICJpbWFnZSI6IEEgVVJJIHBvaW50aW5nIHRvIGEgZmlsZSBvZiBpbWFnZS8qIG1pbWUgdHlwZSByZXByZXNlbnRpbmcKICAgIC8vLyAgICB0aGUgaXRlbSB0byB3aGljaCBgX2RlZWRJZGAgZ3JhbnRzIG93bmVyc2hpcAogICAgLy8vICBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICAvLy8gIENvbnNpZGVyIG1ha2luZyBhbnkgaW1hZ2VzIGF0IGEgd2lkdGggYmV0d2VlbiAzMjAgYW5kIDEwODAgcGl4ZWxzIGFuZAogICAgLy8vICBhc3BlY3QgcmF0aW8gYmV0d2VlbiAxLjkxOjEgYW5kIDQ6NSBpbmNsdXNpdmUuCiAgICBmdW5jdGlvbiBkZWVkVXJpKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgX3VyaSk7Cn0KCi8vLyBAdGl0bGUgRW51bWVyYXRpb24gZXh0ZW5zaW9uIHRvIEVSQy03MjEgaW50ZXJmYWNlCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpCi8vLyBAZGV2IFNwZWNpZmljYXRpb24gYXQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2VpcHMvaXNzdWVzL1hYWFgKY29udHJhY3QgRVJDNzIxRW51bWVyYWJsZSBpcyBFUkM3MjFNZXRhZGF0YSB7CgogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQzcyMQogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxRW51bWVyYWJsZSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigiZGVlZEJ5SW5kZXgoKSIpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigiY291bnRPZk93bmVycygpIikpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJvd25lckJ5SW5kZXgodWludDI1NikiKSk7CgogICAgZnVuY3Rpb24gZGVlZEJ5SW5kZXgodWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfZGVlZElkKTsKICAgIGZ1bmN0aW9uIGNvdW50T2ZPd25lcnMoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2NvdW50KTsKICAgIGZ1bmN0aW9uIG93bmVyQnlJbmRleCh1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIF9vd25lcik7Cn0KCmNvbnRyYWN0IEVSQzcyMU9yaWdpbmFsIHsKCiAgICBieXRlczQgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjFPcmlnaW5hbCA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigidG90YWxTdXBwbHkoKSIpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigiYmFsYW5jZU9mKGFkZHJlc3MpIikpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJvd25lck9mKHVpbnQyNTYpIikpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJhcHByb3ZlKGFkZHJlc3MsdWludDI1NikiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRha2VPd25lcnNoaXAodWludDI1NikiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRyYW5zZmVyKGFkZHJlc3MsdWludDI1NikiKSk7CgogICAgLy8gQ29yZSBmdW5jdGlvbnMKICAgIGZ1bmN0aW9uIGltcGxlbWVudHNFUkM3MjEoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfdG90YWxTdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF9iYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludCBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgZXh0ZXJuYWwgcGF5YWJsZTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgcHVibGljOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpIHB1YmxpYyBwYXlhYmxlOwoKICAgIC8vIE9wdGlvbmFsIGZ1bmN0aW9ucwogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfbmFtZSk7CiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCk7CiAgICBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IF90b2tlbklkKTsKICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludCBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIF9pbmZvVXJsKTsKCiAgICAvLyBFdmVudHMKICAgIC8vIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5JZCk7CiAgICAvLyBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX2FwcHJvdmVkLCB1aW50MjU2IF90b2tlbklkKTsKfQoKY29udHJhY3QgRVJDNzIxQWxsSW1wbGVtZW50YXRpb25zIGlzIEVSQzcyMU9yaWdpbmFsLCBFUkM3MjFFbnVtZXJhYmxlIHsKCn0KCmNvbnRyYWN0IEV0aGVyYm90c0Jhc2UgaXMgRXRoZXJib3RzUHJpdmlsZWdlcyB7CgoKICAgIGZ1bmN0aW9uIEV0aGVyYm90c0Jhc2UoKSBwdWJsaWMgewogICAgLy8gICBzY3JhcHlhcmQgPSBhZGRyZXNzKHRoaXMpOwogICAgfQogICAgLyoqKiBFVkVOVFMgKioqLwoKICAgIC8vLyAgRm9yZ2UgZmlyZXMgd2hlbiBhIG5ldyBwYXJ0IGlzIGNyZWF0ZWQgLSA0IHRpbWVzIHdoZW4gYSBjcmF0ZSBpcyBvcGVuZWQsCiAgICAvLy8gYW5kIG9uY2Ugd2hlbiBhIGJhdHRsZSB0YWtlcyBwbGFjZS4gQWxzbyBoYXMgZmlyZXMgd2hlbgogICAgLy8vIHBhcnRzIGFyZSBjb21iaW5lZCBpbiB0aGUgZnVybmFjZS4KICAgIGV2ZW50IEZvcmdlKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgcGFydElELCBQYXJ0IHBhcnQpOwoKICAgIC8vLyAgVHJhbnNmZXIgZXZlbnQgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLyoqKiBEQVRBIFRZUEVTICoqKi8KICAgIC8vLyAgVGhlIG1haW4gc3RydWN0IHJlcHJlc2VudGF0aW9uIG9mIGEgcm9ib3QgcGFydC4gRWFjaCByb2JvdCBpbiBFdGhlcmJvdHMgaXMgcmVwcmVzZW50ZWQgYnkgZm91ciBjb3BpZXMKICAgIC8vLyAgb2YgdGhpcyBzdHJ1Y3R1cmUsIG9uZSBmb3IgZWFjaCBvZiB0aGUgZm91ciBwYXJ0cyBjb21wcmlzaW5nIGl0OgogICAgLy8vIDEuIFJpZ2h0IEFybSAoTWVsZWUpLAogICAgLy8vIDIuIExlZnQgQXJtIChEZWZlbmNlKSwKICAgIC8vLyAzLiBIZWFkIChUdXJyZXQpLAogICAgLy8vIDQuIEJvZHkuCiAgICAvLyBzdG9yZSB0b2tlbiBpZCBvbiB0aGlzPwogICAgIHN0cnVjdCBQYXJ0IHsKICAgICAgICB1aW50MzIgdG9rZW5JZDsKICAgICAgICB1aW50OCBwYXJ0VHlwZTsKICAgICAgICB1aW50OCBwYXJ0U3ViVHlwZTsKICAgICAgICB1aW50OCByYXJpdHk7CiAgICAgICAgdWludDggZWxlbWVudDsKICAgICAgICB1aW50MzIgYmF0dGxlc0xhc3REYXk7CiAgICAgICAgdWludDMyIGV4cGVyaWVuY2U7CiAgICAgICAgdWludDMyIGZvcmdlVGltZTsKICAgICAgICB1aW50MzIgYmF0dGxlc0xhc3RSZXNldDsKICAgIH0KCiAgICAvLyBQYXJ0IHR5cGUgLSBjYW4gYmUgc2hhcmVkIHdpdGggb3RoZXIgcGFydCBmYWN0b3JpZXMuCiAgICB1aW50OCBjb25zdGFudCBERUZFTkNFID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IE1FTEVFID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IEJPRFkgPSAzOwogICAgdWludDggY29uc3RhbnQgVFVSUkVUID0gNDsKCiAgICAvLyBSYXJpdHkgLSBjYW4gYmUgc2hhcmVkIHdpdGggb3RoZXIgcGFydCBmYWN0b3JpZXMuCiAgICB1aW50OCBjb25zdGFudCBTVEFOREFSRCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBTSEFET1cgPSAyOwogICAgdWludDggY29uc3RhbnQgR09MRCA9IDM7CgoKICAgIC8vIFN0b3JlIGEgdXNlciBzdHJ1Y3QKICAgIC8vIGluIG9yZGVyIHRvIGtlZXAgdHJhY2sgb2YgZXhwZXJpZW5jZSBhbmQgcGVyayBjaG9pY2VzLgogICAgLy8gVGhpcyBwZXJrIHRyZWUgaXMgYSBiaW5hcnkgdHJlZSwgZWZmaWNpZW50bHkgZW5jb2RhYmxlIGFzIGFuIGFycmF5LgogICAgLy8gMCByZWZsZWN0cyBubyBwZXJrIHNlbGVjdGVkLiAxIGlzIGZpcnN0IGNob2ljZS4gMiBpcyBzZWNvbmQuIDMgaXMgYm90aC4KICAgIC8vIEVhY2ggY2hvaWNlIGNvc3RzIGV4cGVyaWVuY2UgKGRlZHVjdGVkIGZyb20gdXNlciBzdHJ1Y3QpLgoKICAgIC8qKiogfn5+fn5ST0JPVCBQRVJLU35+fn5+ICoqKi8KICAgIC8vIFBFUksgMTogQVRUQUNLIHZzIERFRkVOQ0UgUEVSSyBDSE9JQ0UuCiAgICAvLyBDaG9vc2UKICAgIC8vIFBFUksgVFdPIEFUVEFDSy8gU0hPT1QsIG9yIERFRkVORC9ET0RHRQogICAgLy8gUEVSSyAyOiBNRUNIIHZzIEVMRU1FTlRBTCBQRVJLIENIT0lDRSAtLS0KICAgIC8vIENob29zZSBzdGVlbCBhbmQgZWxlY3RyaWMgKE1lY2ggcGF0aCksIG9yIHdhdGVyIGFuZCBmaXJlIChFbGVtZXRhbCBwYXRoKQogICAgLy8gKC4uLiB3aWxsIHRoZSBtZWNocyB3aW4gdGhlIHdhciBmb3IgRXRoZXJ0b3BpYT8gb3Igd2lsbCB0aGUgYW5kcm9pZHMKICAgIC8vIGJlIGRlbHVnZWQgaW4gZmxvb2QgYW5kIGZpcmU/IC4uLikKICAgIC8vIFBFUksgMzogQ29tbWl0IHRvIGEgc3BlY2lmaWMgZWxlbWVudGFsIHBhdGh3YXk6CiAgICAvLyAxLiB0aGUgcGF0aCBvZiBzdGVlbDogdGhlIGlyb24gc3dvcmQ7IHRoZSBidXJuaW5nIGZyeWluZyBwYW4hCiAgICAvLyAyLiB0aGUgcGF0aCBvZiBlbGVjdHJpY2l0eTogdGhlIGRlYWRseSB0YXNlciwgdGhlIGZlYXJzb21lIGZvcmNlZmllbGQKICAgIC8vIDMuIHRoZSBwYXRoIG9mIHdhdGVyOiBoaWdoIHByZXNzdXJlIHdhdGVyIGJsYXN0ZXJzIGhhdmUgbmV2ZXIgYmVlbiBzbyBjb29sCiAgICAvLyA0LiB0aGUgcGF0aCBvZiBmaXJlITogd2Ugd2lsbCBodW50IHlvdSBkb3duLCBBYW5nLi4uCgoKICAgIHN0cnVjdCBVc2VyIHsKICAgICAgICAvLyBhZGRyZXNzIHVzZXJBZGRyZXNzOwogICAgICAgIHVpbnQzMiBudW1TaGFyZHM7IC8vbGltaXQgc2hhcmRzIHRvIHVwcGVyIGJvdW5kIGVnIDEwMDAwCiAgICAgICAgdWludDMyIGV4cGVyaWVuY2U7CiAgICAgICAgdWludDhbMzJdIHBlcmtzOwogICAgfQoKICAgIC8vTWFpbnRhaW4gYW4gYXJyYXkgb2YgYWxsIHVzZXJzLgogICAgLy8gVXNlcltdIHB1YmxpYyB1c2VyczsKCiAgICAvLyBTdG9yZSBhIG1hcCBvZiB0aGUgYWRkcmVzcyB0byBhIHVpbnQgcmVwcmVzZW50aW5nIGluZGV4IG9mIFVzZXIgd2l0aGluIHVzZXJzCiAgICAvLyB3ZSBjaGVjayBpZiBhIHVzZXIgZXhpc3RzIGF0IG11bHRpcGxlIHBvaW50cywgZXZlcnkgdGltZSB0aGV5IGFjcXVpcmUKICAgIC8vIHZpYSBhIGNyYXRlIG9yIHRoZSBtYXJrZXQuIFVzZXJzIGNhbiBhbHNvIG1hbnVhbGx5IHJlZ2lzdGVyIHRoZWlyIGFkZHJlc3MuCiAgICBtYXBwaW5nICggYWRkcmVzcyA9PiBVc2VyICkgcHVibGljIGFkZHJlc3NUb1VzZXI7CgogICAgLy8gQXJyYXkgY29udGFpbmluZyB0aGUgc3RydWN0cyBvZiBhbGwgcGFydHMgaW4gZXhpc3RlbmNlLiBUaGUgSUQKICAgIC8vIG9mIGVhY2ggcGFydCBpcyBhbiBpbmRleCBpbnRvIHRoaXMgYXJyYXkuCiAgICBQYXJ0W10gcGFydHM7CgogICAgLy8gTWFwcGluZyBmcm9tIHBhcnQgSURzIHRvIHRvIG93bmluZyBhZGRyZXNzLiBTaG91bGQgYWx3YXlzIGV4aXN0LgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgcGFydEluZGV4VG9Pd25lcjsKCiAgICAvLyAgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiB0b2tlbnMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4gUkVNT1ZFPwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBhZGRyZXNzVG9Ub2tlbnNPd25lZDsKCiAgICAvLyBNYXBwaW5nIGZyb20gUGFydCBJRCB0byBhbiBhZGRyZXNzIGFwcHJvdmVkIHRvIGNhbGwgdHJhbnNmZXJGcm9tKCkuCiAgICAvLyBtYXhpbXVtIG9mIG9uZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0cmFuc2ZlciBhdCBhbnkgdGltZS4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHBhcnRJbmRleFRvQXBwcm92ZWQ7CgogICAgYWRkcmVzcyBhdWN0aW9uOwogICAgLy8gYWRkcmVzcyBzY3JhcHlhcmQ7CgogICAgLy8gQXJyYXkgdG8gc3RvcmUgYXBwcm92ZWQgYmF0dGxlIGNvbnRyYWN0cy4KICAgIC8vIENhbiBvbmx5IGV2ZXIgYmUgYWRkZWQgdG8sIG5vdCByZW1vdmVkIGZyb20uCiAgICAvLyBPbmNlIGEgcnVsZXNldCBpcyBwdWJsaXNoZWQsIHlvdSB3aWxsIEFMV0FZUyBiZSBhYmxlIHRvIHVzZSB0aGF0IGNvbnRyYWN0CiAgICBhZGRyZXNzW10gYXBwcm92ZWRCYXR0bGVzOwoKCiAgICBmdW5jdGlvbiBnZXRVc2VyQnlBZGRyZXNzKGFkZHJlc3MgX3VzZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQzMiwgdWludDhbMzJdKSB7CiAgICAgICAgcmV0dXJuIChhZGRyZXNzVG9Vc2VyW191c2VyXS5leHBlcmllbmNlLCBhZGRyZXNzVG9Vc2VyW191c2VyXS5wZXJrcyk7CiAgICB9CgogICAgLy8gIFRyYW5zZmVyIGEgcGFydCB0byBhbiBhZGRyZXNzCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBObyBjYXAgb24gbnVtYmVyIG9mIHBhcnRzCiAgICAgICAgLy8gVmVyeSB1bmxpa2VseSB0byBldmVyIGJlIDJeMjU2IHBhcnRzIG93bmVkIGJ5IG9uZSBhY2NvdW50CiAgICAgICAgLy8gU2hvdWxkbid0IHdhc3RlIGdhcyBjaGVja2luZyBmb3Igb3ZlcmZsb3cKICAgICAgICAvLyBubyBwb2ludCBtYWtpbmcgaXQgbGVzcyB0aGFuIGEgdWludCAtLT4gbWFwcGluZ3MgZG9uJ3QgcGFjawogICAgICAgIGFkZHJlc3NUb1Rva2Vuc093bmVkW190b10rKzsKICAgICAgICAvLyB0cmFuc2ZlciBvd25lcnNoaXAKICAgICAgICBwYXJ0SW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKICAgICAgICAvLyBOZXcgcGFydHMgYXJlIHRyYW5zZmVycmVkIF9mcm9tIDB4MCwgYnV0IHdlIGNhbid0IGFjY291bnQgdGhhdCBhZGRyZXNzLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGFkZHJlc3NUb1Rva2Vuc093bmVkW19mcm9tXS0tOwogICAgICAgICAgICAvLyBjbGVhciBhbnkgcHJldmlvdXNseSBhcHByb3ZlZCBvd25lcnNoaXAgZXhjaGFuZ2UKICAgICAgICAgICAgZGVsZXRlIHBhcnRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UGFydEJ5SWQodWludCBfaWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgdWludDMyIHRva2VuSWQsCiAgICAgICAgdWludDggcGFydFR5cGUsCiAgICAgICAgdWludDggcGFydFN1YlR5cGUsCiAgICAgICAgdWludDggcmFyaXR5LAogICAgICAgIHVpbnQ4IGVsZW1lbnQsCiAgICAgICAgdWludDMyIGJhdHRsZXNMYXN0RGF5LAogICAgICAgIHVpbnQzMiBleHBlcmllbmNlLAogICAgICAgIHVpbnQzMiBmb3JnZVRpbWUsCiAgICAgICAgdWludDMyIGJhdHRsZXNMYXN0UmVzZXQKICAgICkgewogICAgICAgIFBhcnQgbWVtb3J5IHAgPSBwYXJ0c1tfaWRdOwogICAgICAgIHJldHVybiAocC50b2tlbklkLCBwLnBhcnRUeXBlLCBwLnBhcnRTdWJUeXBlLCBwLnJhcml0eSwgcC5lbGVtZW50LCBwLmJhdHRsZXNMYXN0RGF5LCBwLmV4cGVyaWVuY2UsIHAuZm9yZ2VUaW1lLCBwLmJhdHRsZXNMYXN0UmVzZXQpOwogICAgfQoKCiAgICBmdW5jdGlvbiBzdWJzdHJpbmcoc3RyaW5nIHN0ciwgdWludCBzdGFydEluZGV4LCB1aW50IGVuZEluZGV4KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBzdHJCeXRlcyA9IGJ5dGVzKHN0cik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHJlc3VsdCA9IG5ldyBieXRlcyhlbmRJbmRleC1zdGFydEluZGV4KTsKICAgICAgICBmb3IgKHVpbnQgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleDsgaSsrKSB7CiAgICAgICAgICAgIHJlc3VsdFtpLXN0YXJ0SW5kZXhdID0gc3RyQnl0ZXNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcocmVzdWx0KTsKICAgIH0KCiAgICAvLyBoZWxwZXIgZnVuY3Rpb25zIGFkYXB0ZWQgZnJvbSAgSm9zc2llIENhbGRlcm9uIG9uIHN0YWNrZXhjaGFuZ2UKICAgIGZ1bmN0aW9uIHN0cmluZ1RvVWludDMyKHN0cmluZyBzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMocyk7CiAgICAgICAgdWludCByZXN1bHQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspIHsgLy8gYyA9IGJbaV0gd2FzIG5vdCBuZWVkZWQKICAgICAgICAgICAgaWYgKGJbaV0gPj0gNDggJiYgYltpXSA8PSA1NykgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICogMTAgKyAodWludChiW2ldKSAtIDQ4KTsgLy8gYnl0ZXMgYW5kIGludCBhcmUgbm90IGNvbXBhdGlibGUgd2l0aCB0aGUgb3BlcmF0b3IgLS4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdWludDMyKHJlc3VsdCk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyaW5nVG9VaW50OChzdHJpbmcgcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiB1aW50OChzdHJpbmdUb1VpbnQzMihzKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdWludFRvU3RyaW5nKHVpbnQgdikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB1aW50IG1heGxlbmd0aCA9IDEwMDsKICAgICAgICBieXRlcyBtZW1vcnkgcmV2ZXJzZWQgPSBuZXcgYnl0ZXMobWF4bGVuZ3RoKTsKICAgICAgICB1aW50IGkgPSAwOwogICAgICAgIHdoaWxlICh2ICE9IDApIHsKICAgICAgICAgICAgdWludCByZW1haW5kZXIgPSB2ICUgMTA7CiAgICAgICAgICAgIHYgPSB2IC8gMTA7CiAgICAgICAgICAgIHJldmVyc2VkW2krK10gPSBieXRlKDQ4ICsgcmVtYWluZGVyKTsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IHMgPSBuZXcgYnl0ZXMoaSk7IC8vIGkgKyAxIGlzIGluZWZmaWNpZW50CiAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgaTsgaisrKSB7CiAgICAgICAgICAgIHNbal0gPSByZXZlcnNlZFtpIC0gaiAtIDFdOyAvLyB0byBhdm9pZCB0aGUgb2ZmLWJ5LW9uZSBlcnJvcgogICAgICAgIH0KICAgICAgICBzdHJpbmcgbWVtb3J5IHN0ciA9IHN0cmluZyhzKTsKICAgICAgICByZXR1cm4gc3RyOwogICAgfQp9CmNvbnRyYWN0IEV0aGVyYm90c05GVCBpcyBFdGhlcmJvdHNCYXNlLCBFUkM3MjFFbnVtZXJhYmxlLCBFUkM3MjFPcmlnaW5hbCB7CiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9pbnRlcmZhY2VJRCA9PSBFUkM3MjFPcmlnaW5hbC5JTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU9yaWdpbmFsKSB8fAogICAgICAgICAgICAoX2ludGVyZmFjZUlEID09IEVSQzcyMS5JTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSkgfHwKICAgICAgICAgICAgKF9pbnRlcmZhY2VJRCA9PSBFUkM3MjFNZXRhZGF0YS5JTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhKSB8fAogICAgICAgICAgICAoX2ludGVyZmFjZUlEID09IEVSQzcyMUVudW1lcmFibGUuSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjFFbnVtZXJhYmxlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGltcGxlbWVudHNFUkM3MjEoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfbmFtZSkgewogICAgICByZXR1cm4gIkV0aGVyYm90cyI7CiAgICB9CgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9zbWJvbCkgewogICAgICByZXR1cm4gIkVUSEJPVCI7CiAgICB9CgogICAgLy8gdG90YWwgc3VwcGx5IG9mIHBhcnRzIC0tPiBhcyBubyBwYXJ0cyBhcmUgZXZlciBkZWxldGVkLCB0aGlzIGlzIHNpbXBseQogICAgLy8gdGhlIHRvdGFsIHN1cHBseSBvZiBwYXJ0cyBldmVyIGNyZWF0ZWQKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJ0cy5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIGRlZWRzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHBhcnRzLmxlbmd0aDsKICAgIH0KCiAgICAvLy0tLyBpbnRlcm5hbCBmdW5jdGlvbiAgICB3aGljaCBjaGVja3Mgd2hldGhlciB0aGUgdG9rZW4gd2l0aCBpZCAoX3Rva2VuSWQpCiAgICAvLy8gaXMgb3duZWQgYnkgdGhlIChfY2xhaW1hbnQpIGFkZHJlc3MKICAgIGZ1bmN0aW9uIG93bnMoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKHBhcnRJbmRleFRvT3duZXJbX3Rva2VuSWRdID09IF9vd25lcik7CiAgICB9CgogICAgLy8vIGludGVybmFsIGZ1bmN0aW9uICAgIHdoaWNoIGNoZWNrcyB3aGV0aGVyIHRoZSB0b2tlbiB3aXRoIGlkIChfdG9rZW5JZCkKICAgIC8vLyBpcyBvd25lZCBieSB0aGUgKF9jbGFpbWFudCkgYWRkcmVzcwogICAgZnVuY3Rpb24gb3duc0FsbChhZGRyZXNzIF9vd25lciwgdWludDI1NltdIF90b2tlbklkcykgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3Rva2VuSWRzLmxlbmd0aCA+IDApOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF90b2tlbklkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAocGFydEluZGV4VG9Pd25lcltfdG9rZW5JZHNbaV1dICE9IF9vd25lcikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgcGFydEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX25ld093bmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKHBhcnRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF9uZXdPd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJCeUluZGV4KHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKXsKICAgICAgICByZXR1cm4gcGFydEluZGV4VG9Pd25lcltfaW5kZXhdOwogICAgfQoKICAgIC8vIHJldHVybnMgdGhlIE5VTUJFUiBvZiB0b2tlbnMgb3duZWQgYnkgKF9vd25lcikKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBhZGRyZXNzVG9Ub2tlbnNPd25lZFtfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBiYWxhbmNlT2YoX293bmVyKTsKICAgIH0KCiAgICAvLyB0cmFuc2ZlcnMgYSBwYXJ0IHRvIGFub3RoZXIgYWNjb3VudAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHBheWFibGUgewogICAgICAgIC8vIHBheWFibGUgZm9yIEVSQzcyMSAtLT4gZG9uJ3QgYWN0dWFsbHkgc2VuZCBldGggQDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNmQzMjJkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwoKICAgICAgICAvLyBTYWZldHkgY2hlY2tzIHRvIHByZXZlbnQgYWNjaWRlbnRhbCB0cmFuc2ZlcnMgdG8gY29tbW9uIGFjY291bnRzCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgLy8gY2FuJ3QgdHJhbnNmZXIgcGFydHMgdG8gdGhlIGF1Y3Rpb24gY29udHJhY3QgZGlyZWN0bHkKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKGF1Y3Rpb24pKTsKICAgICAgICAvLyBjYW4ndCB0cmFuc2ZlciBwYXJ0cyB0byBhbnkgb2YgdGhlIGJhdHRsZSBjb250cmFjdHMgZGlyZWN0bHkKICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCBhcHByb3ZlZEJhdHRsZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgcmVxdWlyZShfdG8gIT0gYXBwcm92ZWRCYXR0bGVzW2pdKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbm5vdCBzZW5kIHRva2VucyB5b3UgZG9uJ3Qgb3duCiAgICAgICAgcmVxdWlyZShvd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIHBlcmZvcm0gc3RhdGUgY2hhbmdlcyBuZWNlc3NhcnkgZm9yIHRyYW5zZmVyCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQogICAgLy8gdHJhbnNmZXJzIGEgcGFydCB0byBhbm90aGVyIGFjY291bnQKCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFsbChhZGRyZXNzIF90bywgdWludDI1NltdIF90b2tlbklkcykgcHVibGljIHdoZW5Ob3RQYXVzZWQgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CgogICAgICAgIC8vIFNhZmV0eSBjaGVja3MgdG8gcHJldmVudCBhY2NpZGVudGFsIHRyYW5zZmVycyB0byBjb21tb24gYWNjb3VudHMKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBjYW4ndCB0cmFuc2ZlciBwYXJ0cyB0byB0aGUgYXVjdGlvbiBjb250cmFjdCBkaXJlY3RseQogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoYXVjdGlvbikpOwogICAgICAgIC8vIGNhbid0IHRyYW5zZmVyIHBhcnRzIHRvIGFueSBvZiB0aGUgYmF0dGxlIGNvbnRyYWN0cyBkaXJlY3RseQogICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IGFwcHJvdmVkQmF0dGxlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICByZXF1aXJlKF90byAhPSBhcHByb3ZlZEJhdHRsZXNbal0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2Fubm90IHNlbmQgdG9rZW5zIHlvdSBkb24ndCBvd24KICAgICAgICByZXF1aXJlKG93bnNBbGwobXNnLnNlbmRlciwgX3Rva2VuSWRzKSk7CgogICAgICAgIGZvciAodWludCBrID0gMDsgayA8IF90b2tlbklkcy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAvLyBwZXJmb3JtIHN0YXRlIGNoYW5nZXMgbmVjZXNzYXJ5IGZvciB0cmFuc2ZlcgogICAgICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZHNba10pOwogICAgICAgIH0KCgogICAgfQoKCiAgICAvLyBhcHByb3ZlcyB0aGUgKF90bykgYWRkcmVzcyB0byB1c2UgdGhlIHRyYW5zZmVyRnJvbSBmdW5jdGlvbiBvbiB0aGUgdG9rZW4gd2l0aCBpZCAoX3Rva2VuSWQpCiAgICAvLyBpZiB5b3Ugd2FudCB0byBjbGVhciBhbGwgYXBwcm92YWxzLCBzaW1wbHkgcGFzcyB0aGUgemVybyBhZGRyZXNzCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgcGF5YWJsZSB7CiAgICAgICAgLy8gcGF5YWJsZSBmb3IgRVJDNzIxIC0tPiBkb24ndCBhY3R1YWxseSBzZW5kIGV0aCBAPHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJkYzgzOWMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7Ci8vIHVzZSBpbnRlcm5hbCBmdW5jdGlvbj8KICAgICAgICAvLyBDYW5ub3QgYXBwcm92ZSB0aGUgdHJhbnNmZXIgb2YgdG9rZW5zIHlvdSBkb24ndCBvd24KICAgICAgICByZXF1aXJlKG93bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwoKICAgICAgICAvLyBTdG9yZSB0aGUgYXBwcm92YWwgKGNhbiBvbmx5IGFwcHJvdmUgb25lIGF0IGEgdGltZSkKICAgICAgICBwYXJ0SW5kZXhUb0FwcHJvdmVkW19kZWVkSWRdID0gX3RvOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF9kZWVkSWQpOwogICAgfQoKICAgIC8vIGFwcHJvdmVzIG1hbnkgdG9rZW4gaWRzCiAgICBmdW5jdGlvbiBhcHByb3ZlTWFueShhZGRyZXNzIF90bywgdWludDI1NltdIF90b2tlbklkcykgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCBwYXlhYmxlIHsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3Rva2VuSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgX3Rva2VuSWQgPSBfdG9rZW5JZHNbaV07CgogICAgICAgICAgICAvLyBDYW5ub3QgYXBwcm92ZSB0aGUgdHJhbnNmZXIgb2YgdG9rZW5zIHlvdSBkb24ndCBvd24KICAgICAgICAgICAgcmVxdWlyZShvd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgICAgICAvLyBTdG9yZSB0aGUgYXBwcm92YWwgKGNhbiBvbmx5IGFwcHJvdmUgb25lIGF0IGEgdGltZSkKICAgICAgICAgICAgcGFydEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgICAgIC8vY3JlYXRlIGV2ZW50IGZvciBlYWNoIGFwcHJvdmFsPyBfdG9rZW5JZCBndWFyYW50ZWVkIHRvIGhvbGQgY29ycmVjdCB2YWx1ZT8KICAgICAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIHRyYW5zZmVyIHRoZSBwYXJ0IHdpdGggaWQgKF90b2tlbklkKSBmcm9tIChfZnJvbSkgdG8gKF90bykKICAgIC8vIChfdG8pIG11c3QgYWxyZWFkeSBiZSBhcHByb3ZlZCBmb3IgdGhpcyAoX3Rva2VuSWQpCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKCiAgICAgICAgLy8gU2FmZXR5IGNoZWNrcyB0byBwcmV2ZW50IGFjY2lkZW50cwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLyBzZW5kZXIgbXVzdCBiZSBhcHByb3ZlZAogICAgICAgIHJlcXVpcmUocGFydEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgLy8gZnJvbSBtdXN0IGN1cnJlbnRseSBvd24gdGhlIHRva2VuCiAgICAgICAgcmVxdWlyZShvd25zKF9mcm9tLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLyByZXR1cm5zIHRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSB0b2tlbiB3aXRoIGlkID0gX3Rva2VuSWQKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfZGVlZElkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIF9vd25lcikgewogICAgICAgIF9vd25lciA9IHBhcnRJbmRleFRvT3duZXJbX2RlZWRJZF07CiAgICAgICAgLy8gbXVzdCByZXN1bHQgZmFsc2UgaWYgaW5kZXgga2V5IG5vdCBmb3VuZAogICAgICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vIHJldHVybnMgYSBkeW5hbWljIGFycmF5IG9mIHRoZSBpZHMgb2YgYWxsIHRva2VucyB3aGljaCBhcmUgb3duZWQgYnkgKF9vd25lcikKICAgIC8vIExvb3BpbmcgdGhyb3VnaCBldmVyeSBwb3NzaWJsZSBwYXJ0IGFuZCBjaGVja2luZyBpdCBhZ2FpbnN0IHRoZSBvd25lciBpcwogICAgLy8gYWN0dWFsbHkgbXVjaCBtb3JlIGVmZmljaWVudCB0aGFuIHN0b3JpbmcgYSBtYXBwaW5nIG9yIHNvbWV0aGluZywgYmVjYXVzZQogICAgLy8gaXQgd29uJ3QgYmUgZXhlY3V0ZWQgYXMgYSB0cmFuc2FjdGlvbgogICAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgICAgIHVpbnQyNTYgdG90YWxQYXJ0cyA9IHRvdGFsU3VwcGx5KCk7CgogICAgICAgIHJldHVybiB0b2tlbnNPZk93bmVyV2l0aGluUmFuZ2UoX293bmVyLCAwLCB0b3RhbFBhcnRzKTsKICAKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyV2l0aGluUmFuZ2UoYWRkcmVzcyBfb3duZXIsIHVpbnQgX3N0YXJ0LCB1aW50IF9udW1Ub1NlYXJjaCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICAgICAgdWludDI1NltdIG1lbW9yeSB0bXBSZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRtcFJlc3VsdDsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwogICAgICAgIGZvciAodWludCBwYXJ0SWQgPSBfc3RhcnQ7IHBhcnRJZCA8IF9zdGFydCArIF9udW1Ub1NlYXJjaDsgcGFydElkKyspIHsKICAgICAgICAgICAgaWYgKHBhcnRJbmRleFRvT3duZXJbcGFydElkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgIHRtcFJlc3VsdFtyZXN1bHRJbmRleF0gPSBwYXJ0SWQ7CiAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdEluZGV4ID09IHRva2VuQ291bnQpIHsgLy9mb3VuZCBhbGwgdG9rZW5zIGFjY291bnRlZCBmb3IsIG5vIG5lZWQgdG8gY29udGludWUKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY29weSBudW1iZXIgb2YgdG9rZW5zIGZvdW5kIGluIGdpdmVuIHJhbmdlCiAgICAgICAgdWludCByZXN1bHRMZW5ndGggPSByZXN1bHRJbmRleDsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10ocmVzdWx0TGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPHJlc3VsdExlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlc3VsdFtpXSA9IHRtcFJlc3VsdFtpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCgoKICAgIC8vc2FtZSBpc3N1ZXMgYXMgYWJvdmUKICAgIC8vIFJldHVybnMgYW4gYXJyYXkgb2YgYWxsIHBhcnQgc3RydWN0cyBvd25lZCBieSB0aGUgdXNlci4gRnJlZSB0byBjYWxsLgogICAgZnVuY3Rpb24gZ2V0UGFydHNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYnl0ZXMyNFtdKSB7CiAgICAgICAgdWludDI1NiB0b3RhbFBhcnRzID0gdG90YWxTdXBwbHkoKTsKCiAgICAgICAgcmV0dXJuIGdldFBhcnRzT2ZPd25lcldpdGhpblJhbmdlKF9vd25lciwgMCwgdG90YWxQYXJ0cyk7CiAgICB9CiAgICAKICAgIC8vIFRoaXMgaXMgcHVibGljIHNvIGl0IGNhbiBiZSBjYWxsZWQgYnkgZ2V0UGFydHNPZk93bmVyLiBJdCBzaG91bGQgTk9UIGJlIGNhbGxlZCBieSBhbm90aGVyIGNvbnRyYWN0CiAgICAvLyBhcyBpdCBpcyB2ZXJ5IGdhcyBodW5ncnkuCiAgICBmdW5jdGlvbiBnZXRQYXJ0c09mT3duZXJXaXRoaW5SYW5nZShhZGRyZXNzIF9vd25lciwgdWludCBfc3RhcnQsIHVpbnQgX251bVRvU2VhcmNoKSBwdWJsaWMgdmlldyByZXR1cm5zKGJ5dGVzMjRbXSkgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICB1aW50IHJlc3VsdEluZGV4ID0gMDsKICAgICAgICBieXRlczI0W10gbWVtb3J5IHJlc3VsdCA9IG5ldyBieXRlczI0W10odG9rZW5Db3VudCk7CiAgICAgICAgZm9yICh1aW50IHBhcnRJZCA9IF9zdGFydDsgcGFydElkIDwgX3N0YXJ0ICsgX251bVRvU2VhcmNoOyBwYXJ0SWQrKykgewogICAgICAgICAgICBpZiAocGFydEluZGV4VG9Pd25lcltwYXJ0SWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IF9wYXJ0VG9CeXRlcyhwYXJ0c1twYXJ0SWRdKTsKICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsgLy8gd2lsbCBoYXZlIDAgZWxlbWVudHMgaWYgdG9rZW5Db3VudCA9PSAwCiAgICB9CgoKICAgIGZ1bmN0aW9uIF9wYXJ0VG9CeXRlcyhQYXJ0IHApIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMyNCBiKSB7CiAgICAgICAgYiA9IGJ5dGVzMjQocC50b2tlbklkKTsKCiAgICAgICAgYiA9IGIgPDwgODsKICAgICAgICBiID0gYiB8IGJ5dGVzMjQocC5wYXJ0VHlwZSk7CgogICAgICAgIGIgPSBiIDw8IDg7CiAgICAgICAgYiA9IGIgfCBieXRlczI0KHAucGFydFN1YlR5cGUpOwoKICAgICAgICBiID0gYiA8PCA4OwogICAgICAgIGIgPSBiIHwgYnl0ZXMyNChwLnJhcml0eSk7CgogICAgICAgIGIgPSBiIDw8IDg7CiAgICAgICAgYiA9IGIgfCBieXRlczI0KHAuZWxlbWVudCk7CgogICAgICAgIGIgPSBiIDw8IDMyOwogICAgICAgIGIgPSBiIHwgYnl0ZXMyNChwLmJhdHRsZXNMYXN0RGF5KTsKCiAgICAgICAgYiA9IGIgPDwgMzI7CiAgICAgICAgYiA9IGIgfCBieXRlczI0KHAuZXhwZXJpZW5jZSk7CgogICAgICAgIGIgPSBiIDw8IDMyOwogICAgICAgIGIgPSBiIHwgYnl0ZXMyNChwLmZvcmdlVGltZSk7CgogICAgICAgIGIgPSBiIDw8IDMyOwogICAgICAgIGIgPSBiIHwgYnl0ZXMyNChwLmJhdHRsZXNMYXN0UmVzZXQpOwogICAgfQoKICAgIHVpbnQzMiBjb25zdGFudCBGSVJTVF9MRVZFTCA9IDEwMDA7CiAgICB1aW50MzIgY29uc3RhbnQgSU5DUkVNRU5UID0gMTAwMDsKCiAgICAvLyBldmVyeSBsZXZlbCwgeW91IG5lZWQgMTAwMCBtb3JlIGV4cCB0byBnbyB1cCBhIGxldmVsCiAgICBmdW5jdGlvbiBnZXRMZXZlbCh1aW50MzIgX2V4cCkgcHVibGljIHB1cmUgcmV0dXJucyh1aW50MzIpIHsKICAgICAgICB1aW50MzIgYyA9IDA7CiAgICAgICAgZm9yICh1aW50MzIgaSA9IEZJUlNUX0xFVkVMOyBpIDw9IEZJUlNUX0xFVkVMICsgX2V4cDsgaSArPSBjICogSU5DUkVNRU5UKSB7CiAgICAgICAgICAgIGMrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgc3RyaW5nIG1ldGFkYXRhQmFzZSA9ICJodHRwczovL2FwaS5ldGhlcmJvdHMuaW8vYXBpLyI7CgoKICAgIGZ1bmN0aW9uIHNldE1ldGFkYXRhQmFzZShzdHJpbmcgX2Jhc2UpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgbWV0YWRhdGFCYXNlID0gX2Jhc2U7CiAgICB9CgogICAgLy8gcGFydCB0eXBlLCBzdWJ0eXBlLAogICAgLy8gaGF2ZSBvbmUgaW50ZXJuYWwgZnVuY3Rpb24gd2hpY2ggbGV0cyB1cyBpbXBsZW1lbnQgdGhlIGRpdmVyZ2VudCBpbnRlcmZhY2VzCiAgICBmdW5jdGlvbiBfbWV0YWRhdGEodWludDI1NiBfaWQpIGludGVybmFsIHZpZXcgcmV0dXJucyhzdHJpbmcpIHsKICAgICAgICBQYXJ0IG1lbW9yeSBwID0gcGFydHNbX2lkXTsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KHN0ckNvbmNhdCgKICAgICAgICAgICAgbWV0YWRhdGFCYXNlLAogICAgICAgICAgICB1aW50VG9TdHJpbmcodWludChwLnBhcnRUeXBlKSksCiAgICAgICAgICAgICIvIiwKICAgICAgICAgICAgdWludFRvU3RyaW5nKHVpbnQocC5wYXJ0U3ViVHlwZSkpLAogICAgICAgICAgICAiLyIKICAgICAgICApLCB1aW50VG9TdHJpbmcodWludChwLnJhcml0eSkpLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGRpc3RpbmN0IFVSSSAoUkZDIDM5ODYpIGZvciBhIGdpdmVuIHRva2VuLgogICAgLy8vIEBkZXYgSWY6CiAgICAvLy8gICogVGhlIFVSSSBpcyBhIFVSTAogICAgLy8vICAqIFRoZSBVUkwgaXMgYWNjZXNzaWJsZQogICAgLy8vICAqIFRoZSBVUkwgcG9pbnRzIHRvIGEgdmFsaWQgSlNPTiBmaWxlIGZvcm1hdCAoRUNNQS00MDQgMm5kIGVkLikKICAgIC8vLyAgKiBUaGUgSlNPTiBiYXNlIGVsZW1lbnQgaXMgYW4gb2JqZWN0CiAgICAvLy8gIHRoZW4gdGhlc2UgbmFtZXMgb2YgdGhlIGJhc2UgZWxlbWVudCBTSEFMTCBoYXZlIHNwZWNpYWwgbWVhbmluZzoKICAgIC8vLyAgKiAibmFtZSI6IEEgc3RyaW5nIGlkZW50aWZ5aW5nIHRoZSBpdGVtIHRvIHdoaWNoIGBfZGVlZElkYCBncmFudHMKICAgIC8vLyAgICBvd25lcnNoaXAKICAgIC8vLyAgKiAiZGVzY3JpcHRpb24iOiBBIHN0cmluZyBkZXRhaWxpbmcgdGhlIGl0ZW0gdG8gd2hpY2ggYF9kZWVkSWRgIGdyYW50cwogICAgLy8vICAgIG93bmVyc2hpcAogICAgLy8vICAqICJpbWFnZSI6IEEgVVJJIHBvaW50aW5nIHRvIGEgZmlsZSBvZiBpbWFnZS8qIG1pbWUgdHlwZSByZXByZXNlbnRpbmcKICAgIC8vLyAgICB0aGUgaXRlbSB0byB3aGljaCBgX2RlZWRJZGAgZ3JhbnRzIG93bmVyc2hpcAogICAgLy8vICBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICAvLy8gIENvbnNpZGVyIG1ha2luZyBhbnkgaW1hZ2VzIGF0IGEgd2lkdGggYmV0d2VlbiAzMjAgYW5kIDEwODAgcGl4ZWxzIGFuZAogICAgLy8vICBhc3BlY3QgcmF0aW8gYmV0d2VlbiAxLjkxOjEgYW5kIDQ6NSBpbmNsdXNpdmUuCiAgICBmdW5jdGlvbiBkZWVkVXJpKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgX3VyaSl7CiAgICAgICAgcmV0dXJuIF9tZXRhZGF0YShfZGVlZElkKTsKICAgIH0KCiAgICAvLy8gcmV0dXJucyBhIG1ldGFkYXRhIFVSSQogICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkgewogICAgICAgIHJldHVybiBfbWV0YWRhdGEoX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAvLyBwYXlhYmxlIGZvciBFUkM3MjEgLS0+IGRvbid0IGFjdHVhbGx5IHNlbmQgZXRoIEA8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImE5ZjZlOSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKCiAgICAgICAgYWRkcmVzcyBfZnJvbSA9IHBhcnRJbmRleFRvT3duZXJbX2RlZWRJZF07CgogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBtc2cuc2VuZGVyLCBfZGVlZElkKTsKICAgIH0KCiAgICAvLyBwYXJ0cyBhcmUgc3RvcmVkIHNlcXVlbnRpYWxseQogICAgZnVuY3Rpb24gZGVlZEJ5SW5kZXgodWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfZGVlZElkKXsKICAgICAgICByZXR1cm4gX2luZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIGNvdW50T2ZPd25lcnMoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2NvdW50KXsKICAgICAgICAvLyBUT0RPOiBpbXBsZW1lbnQgdGhpcwogICAgICAgIHJldHVybiAwOwogICAgfQoKLy8gdGhpcnN0eSBmdW5jdGlvbgogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludCBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCBfdG9rZW5JZCl7CiAgICAgICAgcmV0dXJuIF90b2tlbk9mT3duZXJCeUluZGV4KF9vd25lciwgX2luZGV4KTsKICAgIH0KCi8vIGNvZGUgZHVwbGljYXRlZAogICAgZnVuY3Rpb24gX3Rva2VuT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2luZGV4KSBwcml2YXRlIHZpZXcgcmV0dXJucyAodWludCBfdG9rZW5JZCl7CiAgICAgICAgLy8gVGhlIGluZGV4IHNob3VsZCBiZSB2YWxpZC4KICAgICAgICByZXF1aXJlKF9pbmRleCA8IGJhbGFuY2VPZihfb3duZXIpKTsKCiAgICAgICAgLy8gY2FuIGxvb3AgdGhyb3VnaCBhbGwgd2l0aG91dAogICAgICAgIHVpbnQyNTYgc2VlbiA9IDA7CiAgICAgICAgdWludDI1NiB0b3RhbFRva2VucyA9IHRvdGFsU3VwcGx5KCk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRvdGFsVG9rZW5zOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBhcnRJbmRleFRvT3duZXJbaV0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VlbiA9PSBfaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlZW4rKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2RlZWRJZCl7CiAgICAgICAgcmV0dXJuIF90b2tlbk9mT3duZXJCeUluZGV4KF9vd25lciwgX2luZGV4KTsKICAgIH0KfQoKLy8gdGhlIGNvbnRyYWN0IHdoaWNoIGFsbCBiYXR0bGVzIG11c3QgaW1wbGVtZW50Ci8vIGFsbG93cyBmb3IgZGlmZmVyZW50IHR5cGVzIG9mIGJhdHRsZXMgdG8gdGFrZSBwbGFjZQpjb250cmFjdCBQZXJrVHJlZSBpcyBFdGhlcmJvdHNORlQgewogICAgLy8gVGhlIHBlcmt0cmVlIGlzIHJlcHJlc2VudGVkIGluIGEgdWludDhbMzJdIHJlcHJlc2VudGluZyBhIGJpbmFyeSB0cmVlCiAgICAvLyBzZWUgdGhlIG51bWJlciBvZiBwZXJrcyBhY3RpdmUKICAgIC8vIGJ1eSBhIG5ldyBwZXJrCiAgICAvLyAwOiBQcmVzdGlnZSBsZXZlbCAtPiBzdGFydHMgYXQgMDsKICAgIC8vIG5leHQgcm93IG9mIHRyZWUKICAgIC8vIDE6IG9mZmVuc2l2ZSBtb3ZlcyAyOiBkZWZlbnNpdmUgbW92ZXMKICAgIC8vIG5leHQgcm93IG9mIHRyZWUKICAgIC8vIDM6IG1lbGVlIGF0dGFjayA0OiB0dXJyZXQgc2hvb3RpbmcgNTogZGVmZW5kIGFybSA2OiBib2R5IGRvZGdlCiAgICAvLyBuZXh0IHJvdyBvZiB0cmVlCiAgICAvLyA3OiBtZWNoIG1lbGVlIDg6IGFuZHJvaWQgbWVsZWUgOTogbWVjaCB0dXJyZXQgMTA6IGFuZHJvaWQgdHVycmV0CiAgICAvLyAxMTogbWVjaCBkZWZlbmNlIDEyOiBhbmRyb2lkIGRlZmVuY2UgMTM6IG1lY2ggYm9keSAxNDogYW5kcm9pZCBib2R5CiAgICAvL25leHQgcm93IG9mIHRyZWUKICAgIC8vIDE1OiBtZWxlZSBlbGVjdHJpYyAxNjogbWVsZWUgc3RlZWwgMTc6IG1lbGVlIGZpcmUgMTg6IG1lbGVlIHdhdGVyCiAgICAvLyAxOTogdHVycmV0IGVsZWN0cmljIDIwOiB0dXJyZXQgc3RlZWwgMjE6IHR1cnJldCBmaXJlIDIyOiB0dXJyZXQgd2F0ZXIKICAgIC8vIDIzOiBkZWZlbmQgZWxlY3RyaWMgMjQ6IGRlZmVuZCBzdGVlbCAyNTogZGVmZW5kIGZpcmUgMjY6IGRlZmVuZCB3YXRlcgogICAgLy8gMjc6IGJvZHkgZWxlY3RyaWMgMjg6IGJvZHkgc3RlZWwgMjk6IGJvZHkgZmlyZSAzMDogYm9keSB3YXRlcgogICAgZnVuY3Rpb24gX2xlZnRDaGlsZCh1aW50OCBfaSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiAyKl9pICsgMTsKICAgIH0KICAgIGZ1bmN0aW9uIF9yaWdodENoaWxkKHVpbnQ4IF9pKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIDIqX2kgKyAyOwogICAgfQogICAgZnVuY3Rpb24gX3BhcmVudCh1aW50OCBfaSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiAoX2ktMSkvMjsKICAgIH0KCgogICAgdWludDggY29uc3RhbnQgUFJFU1RJR0VfSU5ERVggPSAwOwogICAgdWludDggY29uc3RhbnQgUEVSS19DT1VOVCA9IDMwOwoKICAgIGV2ZW50IFByaW50UGVyayhzdHJpbmcsdWludDgsdWludDhbMzJdKTsKCiAgICBmdW5jdGlvbiBfaXNWYWxpZFBlcmtUb0FkZCh1aW50OFszMl0gX3BlcmtzLCB1aW50OCBfaW5kZXgpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIGEgcHJldmlvdXNseSB1bmxvY2tlZCBwZXJrIGlzIG5vdCBhIHZhbGlkIHBlcmsgdG8gYWRkLgogICAgICAgIGlmICgoX2luZGV4PT1QUkVTVElHRV9JTkRFWCkgfHwgKF9wZXJrc1tfaW5kZXhdID4gMCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBwZXJrIG5vdCB2YWxpZCBpZiBhbnkgYW5jZXN0b3Igbm90IHVubG9ja2VkCiAgICAgICAgZm9yICh1aW50OCBpID0gX3BhcmVudChfaW5kZXgpOyBpID4gUFJFU1RJR0VfSU5ERVg7IGkgPSBfcGFyZW50KGkpKSB7CiAgICAgICAgICAgIGlmIChfcGVya3NbaV0gPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIHN1bSBvZiBwZXJrcyAoZXhjbHVkaW5nIHByZXN0aWdlKQogICAgZnVuY3Rpb24gX3N1bUFjdGl2ZVBlcmtzKHVpbnQ4WzMyXSBfcGVya3MpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQzMiBzdW0gPSAwOwogICAgICAgIC8vc3VtIGZyb20gYWZ0ZXIgcHJlc3RpZ2VfaW5kZXgsIHRvIGNvdW50KzEgKGZvciBwcmVzdGlnZSBpbmRleCkuCiAgICAgICAgZm9yICh1aW50OCBpID0gUFJFU1RJR0VfSU5ERVgrMTsgaSA8IFBFUktfQ09VTlQrMTsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBfcGVya3NbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdW07CiAgICB9CgogICAgLy8geW91IGNhbiB1bmxvY2sgYSBuZXcgcGVyayBldmVyeSB0d28gbGV2ZWxzIChpbmNsdWRpbmcgcHJlc3RpZ2Ugd2hlbiBwb3NzaWJsZSkKICAgIGZ1bmN0aW9uIGNob29zZVBlcmsodWludDggX2kpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKChfaSA+PSBQUkVTVElHRV9JTkRFWCkgJiYgKF9pIDwgUEVSS19DT1VOVCsxKSk7CiAgICAgICAgVXNlciBzdG9yYWdlIGN1cnJlbnRVc2VyID0gYWRkcmVzc1RvVXNlclttc2cuc2VuZGVyXTsKICAgICAgICB1aW50MjU2IF9udW1BY3RpdmVQZXJrcyA9IF9zdW1BY3RpdmVQZXJrcyhjdXJyZW50VXNlci5wZXJrcyk7CiAgICAgICAgYm9vbCBjYW5QcmVzdGlnZSA9IChfbnVtQWN0aXZlUGVya3MgPT0gUEVSS19DT1VOVCk7CgogICAgICAgIC8vYWRkIHByZXN0aWdlIHZhbHVlIHRvIHN1bSBvZiBwZXJrcwogICAgICAgIF9udW1BY3RpdmVQZXJrcyArPSBjdXJyZW50VXNlci5wZXJrc1tQUkVTVElHRV9JTkRFWF0gKiBQRVJLX0NPVU5UOwogICAgICAgIHJlcXVpcmUoX251bUFjdGl2ZVBlcmtzIDwgZ2V0TGV2ZWwoY3VycmVudFVzZXIuZXhwZXJpZW5jZSkgLyAyKTsKCiAgICAgICAgaWYgKF9pID09IFBSRVNUSUdFX0lOREVYKSB7CiAgICAgICAgICAgIHJlcXVpcmUoY2FuUHJlc3RpZ2UpOwogICAgICAgICAgICBfcHJlc3RpZ2UoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKF9pc1ZhbGlkUGVya1RvQWRkKGN1cnJlbnRVc2VyLnBlcmtzLCBfaSkpOwogICAgICAgICAgICBfYWRkUGVyayhfaSk7CiAgICAgICAgfQogICAgICAgIFBlcmtDaG9zZW4obXNnLnNlbmRlciwgX2kpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9hZGRQZXJrKHVpbnQ4IHBlcmspIGludGVybmFsIHsKICAgICAgICBhZGRyZXNzVG9Vc2VyW21zZy5zZW5kZXJdLnBlcmtzW3BlcmtdKys7CiAgICB9CgogICAgZnVuY3Rpb24gX3ByZXN0aWdlKCkgaW50ZXJuYWwgewogICAgICAgIFVzZXIgc3RvcmFnZSBjdXJyZW50VXNlciA9IGFkZHJlc3NUb1VzZXJbbXNnLnNlbmRlcl07CiAgICAgICAgZm9yICh1aW50OCBpID0gMTsgaSA8IGN1cnJlbnRVc2VyLnBlcmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGN1cnJlbnRVc2VyLnBlcmtzW2ldID0gMDsKICAgICAgICB9CiAgICAgICAgY3VycmVudFVzZXIucGVya3NbUFJFU1RJR0VfSU5ERVhdKys7CiAgICB9CgogICAgZXZlbnQgUGVya0Nob3NlbihhZGRyZXNzIGluZGV4ZWQgdXBncmFkZWRVc2VyLCB1aW50OCBpbmRleGVkIHBlcmspOwoKfQoKLy8gQ2VudHJhbCBjb2xsZWN0aW9uIG9mIHN0b3JhZ2Ugb24gd2hpY2ggYWxsIG90aGVyIGNvbnRyYWN0cyBkZXBlbmQuCi8vIENvbnRhaW5zIHN0cnVjdHMgZm9yIHBhcnRzLCB1c2VycyBhbmQgZnVuY3Rpb25zIHdoaWNoIGNvbnRyb2wgdGhlaXIKLy8gdHJhbnNmZXJyZW5jZS4KCgovLyBBdWN0aW9uIGNvbnRyYWN0LCBmYWNpbGl0YXRpbmcgc3RhdGljYWxseSBwcmljZWQgc2FsZXMsIGFzIHdlbGwgYXMgCi8vIGluZmxhdGlvbmFyeSBhbmQgZGVmbGF0aW9uYXJ5IHByaWNpbmcgZm9yIGl0ZW1zLgovLyBSZWxpZXMgaGVhdmlseSBvbiB0aGUgRVJDNzIxIGludGVyZmFjZSBhbmQgc28gbW9zdCBvZiB0aGUgbWV0aG9kcwovLyBhcmUgdGlnaHRseSBib3VuZCB0byB0aGF0IGltcGxlbWVudGF0aW9uCmNvbnRyYWN0IE5GVEF1Y3Rpb25CYXNlIGlzIFBhdXNhYmxlIHsKCiAgICBFUkM3MjFBbGxJbXBsZW1lbnRhdGlvbnMgcHVibGljIG5mdENvbnRyYWN0OwogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CiAgICB1aW50IHB1YmxpYyBtaW5EdXJhdGlvbjsKICAgIHVpbnQgcHVibGljIG1heER1cmF0aW9uOwoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvbiBhbiBORlQgKGluIHRoaXMgY2FzZSwgUm9ib3QgcGFydCkKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICAvLyBhZGRyZXNzIG9mIHBhcnQgb3duZXIKICAgICAgICBhZGRyZXNzIHNlbGxlcjsKICAgICAgICAvLyB3ZWkgcHJpY2Ugb2YgbGlzdGluZwogICAgICAgIHVpbnQyNTYgc3RhcnRQcmljZTsKICAgICAgICAvLyB3ZWkgcHJpY2Ugb2YgZmxvb3IKICAgICAgICB1aW50MjU2IGVuZFByaWNlOwogICAgICAgIC8vIGR1cmF0aW9uIG9mIHNhbGUgaW4gc2Vjb25kcy4KICAgICAgICB1aW50NjQgZHVyYXRpb247CiAgICAgICAgLy8gVGltZSB3aGVuIHNhbGUgc3RhcnRlZAogICAgICAgIC8vIFJlc2V0IHRvIDAgYWZ0ZXIgc2FsZSBjb25jbHVkZWQKICAgICAgICB1aW50NjQgc3RhcnQ7CiAgICB9CgogICAgZnVuY3Rpb24gTkZUQXVjdGlvbkJhc2UoKSBwdWJsaWMgewogICAgICAgIG1pbkR1cmF0aW9uID0gNjAgbWludXRlczsKICAgICAgICBtYXhEdXJhdGlvbiA9IDMwIGRheXM7IC8vIGFyYml0cmFyeQogICAgfQoKICAgIC8vIG1hcCBvZiBhbGwgdG9rZW5zIGFuZCB0aGVpciBhdWN0aW9ucwogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSB0b2tlbklkVG9BdWN0aW9uOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBzdGFydFByaWNlLCB1aW50MjU2IGVuZFByaWNlLCB1aW50NjQgZHVyYXRpb24sIHVpbnQ2NCBzdGFydCk7CiAgICBldmVudCBBdWN0aW9uU3VjY2Vzc2Z1bCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgdG90YWxQcmljZSwgYWRkcmVzcyB3aW5uZXIpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGxlZCh1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgdG9rZW4gd2l0aCBpZCBfcGFydElkIGlzIG93bmVkIGJ5IHRoZSBfY2xhaW1hbnQgYWRkcmVzcwogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3BhcnRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG5mdENvbnRyYWN0Lm93bmVyT2YoX3BhcnRJZCkgPT0gX2NsYWltYW50OwogICAgfQoKICAgLy8gcmV0dXJucyBmYWxzZSBpZiBhdWN0aW9uIHN0YXJ0IHRpbWUgaXMgMCwgbGlrZWx5IGZyb20gdW5pbml0aWFsaXNlZCBzdHJ1Y3QKICAgIGZ1bmN0aW9uIF9pc0FjdGl2ZUF1Y3Rpb24oQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIF9hdWN0aW9uLnN0YXJ0ID4gMDsKICAgIH0KICAgIAogICAgLy8gYXNzaWducyBvd25lcnNoaXAgb2YgdGhlIHRva2VuIHdpdGggaWQgPSBfcGFydElkIHRvIHRoaXMgY29udHJhY3QKICAgIC8vIG11c3QgaGF2ZSBhbHJlYWR5IGJlZW4gYXBwcm92ZWQKICAgIGZ1bmN0aW9uIF9lc2Nyb3coYWRkcmVzcywgdWludCBfcGFydElkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gdGhyb3dzIG9uIHRyYW5zZmVyIGZhaWwKICAgICAgICBuZnRDb250cmFjdC50YWtlT3duZXJzaGlwKF9wYXJ0SWQpOwogICAgfQoKICAgIC8vIHRyYW5zZmVyIHRoZSB0b2tlbiB3aXRoIGlkID0gX3BhcnRJZCB0byBidXlpbmcgYWRkcmVzcwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3B1cmNoYXNvciwgdWludDI1NiBfcGFydElkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gc3VjY2Vzc2Z1bCBwdXJjaGFzZWRlciBtdXN0IHRha2VPd25lcnNoaXAgb2YgX3BhcnRJZAogICAgICAgIC8vIG5mdENvbnRyYWN0LmFwcHJvdmUoX3B1cmNoYXNvciwgX3BhcnRJZCk7IAogICAgICAgICAgICAgICAvLyBhY3R1YWwgdHJhbnNmZXIKICAgICAgICAgICAgICAgIG5mdENvbnRyYWN0LnRyYW5zZmVyKF9wdXJjaGFzb3IsIF9wYXJ0SWQpOwoKICAgIH0KCiAgICAvLyBjcmVhdGVzCiAgICBmdW5jdGlvbiBfbmV3QXVjdGlvbih1aW50MjU2IF9wYXJ0SWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKCiAgICAgICAgcmVxdWlyZShfYXVjdGlvbi5kdXJhdGlvbiA+PSBtaW5EdXJhdGlvbik7CiAgICAgICAgcmVxdWlyZShfYXVjdGlvbi5kdXJhdGlvbiA8PSBtYXhEdXJhdGlvbik7CgogICAgICAgIHRva2VuSWRUb0F1Y3Rpb25bX3BhcnRJZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQodWludDI1NihfcGFydElkKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5zdGFydFByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5lbmRQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfYXVjdGlvbi5kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChfYXVjdGlvbi5zdGFydCkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1pbkR1cmF0aW9uKHVpbnQgX2R1cmF0aW9uKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIG1pbkR1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1heER1cmF0aW9uKHVpbnQgX2R1cmF0aW9uKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIG1heER1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgfQoKICAgIC8vLyBSZW1vdmVzIGF1Y3Rpb24gZnJvbSBwdWJsaWMgdmlldywgcmV0dXJucyB0b2tlbiB0byB0aGUgc2VsbGVyCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF9wYXJ0SWQsIGFkZHJlc3MgX3NlbGxlcikgaW50ZXJuYWwgewogICAgICAgIF9yZW1vdmVBdWN0aW9uKF9wYXJ0SWQpOwogICAgICAgIF90cmFuc2Zlcihfc2VsbGVyLCBfcGFydElkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF9wYXJ0SWQpOwogICAgfQoKICAgIGV2ZW50IFByaW50RXZlbnQoc3RyaW5nLCBhZGRyZXNzLCB1aW50KTsKCiAgICAvLyBDYWxjdWxhdGVzIHByaWNlIGFuZCB0cmFuc2ZlcnMgcHVyY2hhc2UgdG8gb3duZXIuIFBhcnQgaXMgTk9UIHRyYW5zZmVycmVkIHRvIGJ1eWVyLgogICAgZnVuY3Rpb24gX3B1cmNoYXNlKHVpbnQyNTYgX3BhcnRJZCwgdWludDI1NiBfcHVyY2hhc2VBbW91bnQpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKCiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW19wYXJ0SWRdOwoKICAgICAgICAvLyBjaGVjayB0aGF0IHRoaXMgdG9rZW4gaXMgYmVpbmcgYXVjdGlvbmVkCiAgICAgICAgcmVxdWlyZShfaXNBY3RpdmVBdWN0aW9uKGF1Y3Rpb24pKTsKCiAgICAgICAgLy8gZW5mb3JjZSBwdXJjaGFzZSA+PSB0aGUgY3VycmVudCBwcmljZQogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgICAgIHJlcXVpcmUoX3B1cmNoYXNlQW1vdW50ID49IHByaWNlKTsKCiAgICAgICAgLy8gU3RvcmUgc2VsbGVyIGJlZm9yZSB3ZSBkZWxldGUgYXVjdGlvbi4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBWYWxpZCBwdXJjaGFzZS4gUmVtb3ZlIGF1Y3Rpb24gdG8gcHJldmVudCByZWVudHJhbmN5LgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF9wYXJ0SWQpOwoKICAgICAgICAvLyBUcmFuc2ZlciBwcm9jZWVkcyB0byBzZWxsZXIgKGlmIHRoZXJlIGFyZSBhbnkhKQogICAgICAgIGlmIChwcmljZSA+IDApIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBhbmQgdGFrZSBmZWUgZnJvbSBwdXJjaGFzZQoKICAgICAgICAgICAgdWludDI1NiBhdWN0aW9uZWVyQ3V0ID0gX2NvbXB1dGVGZWUocHJpY2UpOwogICAgICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gcHJpY2UgLSBhdWN0aW9uZWVyQ3V0OwoKICAgICAgICAgICAgUHJpbnRFdmVudCgiU2VsbGVyLCBwcm9jZWVkcyIsIHNlbGxlciwgc2VsbGVyUHJvY2VlZHMpOwoKICAgICAgICAgICAgLy8gUGF5IHRoZSBzZWxsZXIKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBleGNlc3MgZnVuZHMgYW5kIHJldHVybiB0byBidXllci4KICAgICAgICB1aW50MjU2IHB1cmNoYXNlRXhjZXNzID0gX3B1cmNoYXNlQW1vdW50IC0gcHJpY2U7CgogICAgICAgIFByaW50RXZlbnQoIlNlbmRlciwgZXhjZXNzIiwgbXNnLnNlbmRlciwgcHVyY2hhc2VFeGNlc3MpOwogICAgICAgIC8vIFJldHVybiBhbnkgZXhjZXNzIGZ1bmRzLiBSZWVudHJhbmN5IGFnYWluIHByZXZlbnRlZCBieSBkZWxldGluZyBhdWN0aW9uLgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocHVyY2hhc2VFeGNlc3MpOwoKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfcGFydElkLCBwcmljZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICAvLyByZXR1cm5zIHRoZSBjdXJyZW50IHByaWNlIG9mIHRoZSB0b2tlbiBiZWluZyBhdWN0aW9uZWQgaW4gX2F1Y3Rpb24KICAgIGZ1bmN0aW9uIF9jdXJyZW50UHJpY2UoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHNlY3NFbGFwc2VkID0gbm93IC0gX2F1Y3Rpb24uc3RhcnQ7CiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgICAgICBfYXVjdGlvbi5zdGFydFByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5lbmRQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIHNlY3NFbGFwc2VkCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBDaGVja3MgaWYgTkZUUGFydCBpcyBjdXJyZW50bHkgYmVpbmcgYXVjdGlvbmVkLgogICAgLy8gZnVuY3Rpb24gX2lzQmVpbmdBdWN0aW9uZWQoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIC8vICAgICByZXR1cm4gKF9hdWN0aW9uLnN0YXJ0ID4gMCk7CiAgICAvLyB9CgogICAgLy8gcmVtb3ZlcyB0aGUgYXVjdGlvbiBvZiB0aGUgcGFydCB3aXRoIGlkIF9wYXJ0SWQKICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX3BhcnRJZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSB0b2tlbklkVG9BdWN0aW9uW19wYXJ0SWRdOwogICAgfQoKICAgIC8vIGNvbXB1dGVzIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIGRlZmxhdGluZy1wcmljZSBhdWN0aW9uIAogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXJyZW50UHJpY2UoIHVpbnQyNTYgX3N0YXJ0UHJpY2UsIHVpbnQyNTYgX2VuZFByaWNlLCB1aW50MjU2IF9kdXJhdGlvbiwgdWludDI1NiBfc2Vjb25kc1Bhc3NlZCApIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NiBfcHJpY2UpIHsKICAgICAgICBfcHJpY2UgPSBfc3RhcnRQcmljZTsKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIC8vIEhhcyBiZWVuIHVwIGxvbmcgZW5vdWdoIHRvIGhpdCBlbmRQcmljZS4KICAgICAgICAgICAgLy8gUmV0dXJuIHRoaXMgcHJpY2UgZmxvb3IuCiAgICAgICAgICAgIF9wcmljZSA9IF9lbmRQcmljZTsKICAgICAgICAgICAgLy8gdGhpcyBpcyBhIHN0YXRpY2FsbHkgcHJpY2Ugc2FsZS4gSnVzdCByZXR1cm4gdGhlIHByaWNlLgogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChfZHVyYXRpb24gPiAwKSB7CiAgICAgICAgICAgIC8vIFRoaXMgYXVjdGlvbiBjb250cmFjdCBzdXBwb3J0cyBhdWN0aW9uaW5nIGZyb20gYW55IHZhbGlkIHByaWNlIHRvIGFueSBvdGhlciB2YWxpZCBwcmljZS4KICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGUgcHJpY2UgY2FuIGR5bmFtaWNhbGx5IGluY3JlYXNlIHVwd2FyZCwgb3IgZG93bmFyZC4KICAgICAgICAgICAgaW50MjU2IHByaWNlRGlmZmVyZW5jZSA9IGludDI1NihfZW5kUHJpY2UpIC0gaW50MjU2KF9zdGFydFByaWNlKTsKICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZURpZmZlcmVuY2UgPSBwcmljZURpZmZlcmVuY2UgKiBpbnQyNTYoX3NlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9kdXJhdGlvbik7CiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0UHJpY2UpICsgY3VycmVudFByaWNlRGlmZmVyZW5jZTsKCiAgICAgICAgICAgIF9wcmljZSA9IHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9wcmljZTsKICAgIH0KCiAgICAvLyBDb21wdXRlIHBlcmNlbnRhZ2UgZmVlIG9mIHRyYW5zYWN0aW9uCgogICAgZnVuY3Rpb24gX2NvbXB1dGVGZWUgKHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gX3ByaWNlICogb3duZXJDdXQgLyAxMDAwMDsgCiAgICB9Cgp9CgovLyBDbG9jayBhdWN0aW9uIGZvciBORlRQYXJ0cy4KLy8gT25seSB0aW1lZCB3aGVuIHByaWNpbmcgaXMgZHluYW1pYyAoaS5lLiBzdGFydFByaWNlICE9IGVuZFByaWNlKS4KLy8gRWxzZSwgdGhpcyBiZWNvbWVzIGFuIGluZmluaXRlIGR1cmF0aW9uIHN0YXRpY2FsbHkgcHJpY2VkIHNhbGUsCi8vIHJlc29sdmluZyB3aGVuIHN1Y2Nlc2Z1bGx5IHB1cmNoYXNlIGZvciBvciBjYW5jZWxsZWQuCgpjb250cmFjdCBEdXRjaEF1Y3Rpb24gaXMgTkZUQXVjdGlvbkJhc2UsIEV0aGVyYm90c1ByaXZpbGVnZXMgewoKICAgIC8vIFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweGRhNjcxYjliKTsKIAogICAgZnVuY3Rpb24gRHV0Y2hBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHJlc3MsIHVpbnQyNTYgX2ZlZSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9mZWUgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2ZlZTsKCiAgICAgICAgRVJDNzIxQWxsSW1wbGVtZW50YXRpb25zIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRVJDNzIxQWxsSW1wbGVtZW50YXRpb25zKF9uZnRBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgICAgICBuZnRDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vIFJlbW92ZSBhbGwgZXRoZXIgZnJvbSB0aGUgY29udHJhY3QuIFRoaXMgd2lsbCBiZSBtYXJrZXRwbGFjZSBmZWVzLgogICAgLy8gVHJhbnNmZXJzIHRvIHRoZSBORlQgY29udHJhY3QuIAogICAgLy8gQ2FuIGJlIGNhbGxlZCBieSBvd25lciBvciBORlQgY29udHJhY3QuCgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIGFkZHJlc3MgbmZ0QWRkcmVzcyA9IGFkZHJlc3MobmZ0Q29udHJhY3QpOwoKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzKTsKCiAgICAgICAgbmZ0QWRkcmVzcy50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIGV2ZW50IFByaW50RXZlbnQoc3RyaW5nLCBhZGRyZXNzLCB1aW50KTsKCiAgICAvLyBDcmVhdGVzIGFuIGF1Y3Rpb24gYW5kIGxpc3RzIGl0LgogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbiggdWludDI1NiBfcGFydElkLCB1aW50MjU2IF9zdGFydFByaWNlLCB1aW50MjU2IF9lbmRQcmljZSwgdWludDI1NiBfZHVyYXRpb24sIGFkZHJlc3MgX3NlbGxlciApIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZAogICAgICAgIC8vIHRvIHN0b3JlIHRoZW0gaW4gdGhlIGF1Y3Rpb24gc3RydWN0LgogICAgICAgIHJlcXVpcmUoX3N0YXJ0UHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydFByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZFByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwogICAgICAgIHJlcXVpcmUoX3N0YXJ0UHJpY2UgPj0gX2VuZFByaWNlKTsKCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MobmZ0Q29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF9wYXJ0SWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydFByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykgLy9zZWNvbmRzIHVpbnQgCiAgICAgICAgKTsKICAgICAgICBQcmludEV2ZW50KCJBdWN0aW9uIFN0YXJ0IiwgMHgwLCBhdWN0aW9uLnN0YXJ0KTsKICAgICAgICBfbmV3QXVjdGlvbihfcGFydElkLCBhdWN0aW9uKTsKICAgIH0KCgogICAgLy8gU0NSQVBZQVJEIFBSSUNJTkcgTE9HSUMKCiAgICB1aW50OCBjb25zdGFudCBMQVNUX0NPTlNJREVSRUQgPSA1OwogICAgdWludDggcHVibGljIHNjcmFwQ291bnRlciA9IDA7CiAgICB1aW50WzVdIHB1YmxpYyBsYXN0U2NyYXBQcmljZXM7CiAgICAKICAgIC8vIFB1cmNoYXNlcyBhbiBvcGVuIGF1Y3Rpb24KICAgIC8vIFdpbGwgdHJhbnNmZXIgb3duZXJzaGlwIGlmIHN1Y2Nlc3NmdWwuCiAgICAKICAgIGZ1bmN0aW9uIHB1cmNoYXNlKHVpbnQyNTYgX3BhcnRJZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3BhcnRJZF0uc2VsbGVyOwoKICAgICAgICAvLyBfcHVyY2hhc2Ugd2lsbCB0aHJvdyBpZiB0aGUgcHVyY2hhc2Ugb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICB1aW50MjU2IHByaWNlID0gX3B1cmNoYXNlKF9wYXJ0SWQsIG1zZy52YWx1ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF9wYXJ0SWQpOwogICAgICAgIAogICAgICAgIC8vIElmIHRoZSBzZWxsZXIgaXMgdGhlIHNjcmFweWFyZCwgdHJhY2sgcHJpY2UgaW5mb3JtYXRpb24uCiAgICAgICAgaWYgKHNlbGxlciA9PSBhZGRyZXNzKG5mdENvbnRyYWN0KSkgewoKICAgICAgICAgICAgbGFzdFNjcmFwUHJpY2VzW3NjcmFwQ291bnRlcl0gPSBwcmljZTsKICAgICAgICAgICAgaWYgKHNjcmFwQ291bnRlciA9PSBMQVNUX0NPTlNJREVSRUQgLSAxKSB7CiAgICAgICAgICAgICAgICBzY3JhcENvdW50ZXIgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2NyYXBDb3VudGVyKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZVNjcmFwUHJpY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBzdW0gPSAwOwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBMQVNUX0NPTlNJREVSRUQ7IGkrKykgewogICAgICAgICAgICBzdW0gKz0gbGFzdFNjcmFwUHJpY2VzW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VtIC8gTEFTVF9DT05TSURFUkVEOwogICAgfQoKICAgIC8vIEFsbG93cyBhIHVzZXIgdG8gY2FuY2VsIGFuIGF1Y3Rpb24gYmVmb3JlIGl0J3MgcmVzb2x2ZWQuCiAgICAvLyBSZXR1cm5zIHRoZSBwYXJ0IHRvIHRoZSBzZWxsZXIuCgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF9wYXJ0SWQpIGV4dGVybmFsIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3BhcnRJZF07CiAgICAgICAgcmVxdWlyZShfaXNBY3RpdmVBdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF9wYXJ0SWQsIHNlbGxlcik7CiAgICB9CgogICAgLy8gcmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiB0aGUgYXVjdGlvbiBvZiBhIHRva2VuIHdpdGggaWQgX3BhcnRJZAogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQyNTYgX3BhcnRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW19wYXJ0SWRdOwogICAgICAgIHJlcXVpcmUoX2lzQWN0aXZlQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICB9CgogICAgLy8gIFJldHVybnMgdGhlIGRldGFpbHMgb2YgYW4gYXVjdGlvbiBmcm9tIGl0cyBfcGFydElkLgogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF9wYXJ0SWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoIGFkZHJlc3Mgc2VsbGVyLCB1aW50MjU2IHN0YXJ0UHJpY2UsIHVpbnQyNTYgZW5kUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24sIHVpbnQyNTYgc3RhcnRlZEF0ICkgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfcGFydElkXTsKICAgICAgICByZXF1aXJlKF9pc0FjdGl2ZUF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiAoIGF1Y3Rpb24uc2VsbGVyLCBhdWN0aW9uLnN0YXJ0UHJpY2UsIGF1Y3Rpb24uZW5kUHJpY2UsIGF1Y3Rpb24uZHVyYXRpb24sIGF1Y3Rpb24uc3RhcnQpOwogICAgfQoKICAgIC8vIEFsbG93cyBvd25lciB0byBjYW5jZWwgYW4gYXVjdGlvbi4KICAgIC8vIE9OTFkgYWJsZSB0byBiZSB1c2VkIHdoZW4gY29udHJhY3QgaXMgcGF1c2VkLAogICAgLy8gaW4gdGhlIGNhc2Ugb2YgZW1lcmdlbmNpZXMuCiAgICAvLyBQYXJ0cyByZXR1cm5lZCB0byBzZWxsZXIgYXMgaXQncyBlcXVpdmFsZW50IHRvIHRoZW0gCiAgICAvLyBjYWxsaW5nIGNhbmNlbC4KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb25XaGVuUGF1c2VkKHVpbnQyNTYgX3BhcnRJZCkgd2hlblBhdXNlZCBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfcGFydElkXTsKICAgICAgICByZXF1aXJlKF9pc0FjdGl2ZUF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF9wYXJ0SWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KfQoKY29udHJhY3QgRXRoZXJib3RzQXVjdGlvbiBpcyBQZXJrVHJlZSB7CgogICAgLy8gU2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBzYWxlIGF1Y3Rpb24uCgogICAgZnVuY3Rpb24gc2V0QXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIER1dGNoQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IER1dGNoQXVjdGlvbihfYWRkcmVzcyk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBhdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8gbGlzdCBhIHBhcnQgZm9yIGF1Y3Rpb24uCgogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbigKICAgICAgICB1aW50MjU2IF9wYXJ0SWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiApIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgCiAgICB7CgoKICAgICAgICAvLyB1c2VyIG11c3QgaGF2ZSBjdXJyZW50IGNvbnRyb2wgb2YgdGhlIHBhcnQKICAgICAgICAvLyB3aWxsIGxvc2UgY29udHJvbCBpZiB0aGV5IGRlbGVnYXRlIHRvIHRoZSBhdWN0aW9uCiAgICAgICAgLy8gdGhlcmVmb3JlIG5vIGR1cGxpY2F0ZSBhdWN0aW9ucyEKICAgICAgICByZXF1aXJlKG93bnMobXNnLnNlbmRlciwgX3BhcnRJZCkpOwoKICAgICAgICBfYXBwcm92ZShfcGFydElkLCBhdWN0aW9uKTsKCiAgICAgICAgLy8gd2lsbCB0aHJvdyBpZiBpbnB1dHMgYXJlIGludmFsaWQKICAgICAgICAvLyB3aWxsIGNsZWFyIHRyYW5zZmVyIGFwcHJvdmFsCiAgICAgICAgRHV0Y2hBdWN0aW9uKGF1Y3Rpb24pLmNyZWF0ZUF1Y3Rpb24oX3BhcnRJZCxfc3RhcnRQcmljZSxfZW5kUHJpY2UsX2R1cmF0aW9uLG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIHRyYW5zZmVyIGJhbGFuY2UgYmFjayB0byBjb3JlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiB3aXRoZHJhd0F1Y3Rpb25CYWxhbmNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBEdXRjaEF1Y3Rpb24oYXVjdGlvbikud2l0aGRyYXdCYWxhbmNlKCk7CiAgICB9CgogICAgLy8gU0NSQVAgRlVOQ1RJT04KICAKICAgIC8vIFRoaXMgdGFrZXMgc2NyYXBwZWQgcGFydHMgYW5kIGF1dG9tYXRpY2FsbHkgcmVsaXN0cyB0aGVtIG9uIHRoZSBtYXJrZXQuCiAgICAvLyBQcm92aWRlcyBhIGdvb2QgZmxvb3IgZm9yIGVudHJhbmNlIGludG8gdGhlIGdhbWUsIHdoaWxlIGtlZXBpbmcgc3VwcGx5CiAgICAvLyBjb25zdGFudCBhcyB0aGVzZSBwYXJ0cyB3ZXJlIGFscmVhZHkgaW4gY2lyY3VsYXRpb24uCgogICAgLy8gdWludCBwdWJsaWMgY29uc3RhbnQgU0NSQVBZQVJEX1NUQVJUSU5HX1BSSUNFID0gMC4xIGV0aGVyOwogICAgdWludCBzY3JhcE1pblN0YXJ0UHJpY2UgPSAwLjA1IGV0aGVyOyAvLyBzZXR0YWJsZSBtaW5pbXVtIHN0YXJ0aW5nIHByaWNlIGZvciBzYW5pdHkKICAgIHVpbnQgc2NyYXBNaW5FbmRQcmljZSA9IDAuMDA1IGV0aGVyOyAgLy8gc2V0dGFibGUgbWluaW11bSBlbmRpbmcgcHJpY2UgZm9yIHNhbml0eQogICAgdWludCBzY3JhcEF1Y3Rpb25EdXJhdGlvbiA9IDIgZGF5czsKICAgIAogICAgZnVuY3Rpb24gc2V0U2NyYXBNaW5TdGFydFByaWNlKHVpbnQgX25ld01pblN0YXJ0UHJpY2UpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc2NyYXBNaW5TdGFydFByaWNlID0gX25ld01pblN0YXJ0UHJpY2U7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRTY3JhcE1pbkVuZFByaWNlKHVpbnQgX25ld01pbkVuZFByaWNlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHNjcmFwTWluRW5kUHJpY2UgPSBfbmV3TWluRW5kUHJpY2U7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRTY3JhcEF1Y3Rpb25EdXJhdGlvbih1aW50IF9uZXdTY3JhcEF1Y3Rpb25EdXJhdGlvbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBzY3JhcEF1Y3Rpb25EdXJhdGlvbiA9IF9uZXdTY3JhcEF1Y3Rpb25EdXJhdGlvbjsKICAgIH0KIAogICAgZnVuY3Rpb24gX2NyZWF0ZVNjcmFwUGFydEF1Y3Rpb24odWludCBfc2NyYXBQYXJ0SWQpIGludGVybmFsIHsKICAgICAgICAvLyBpZiAoc2NyYXB5YXJkID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICBfYXBwcm92ZShfc2NyYXBQYXJ0SWQsIGF1Y3Rpb24pOwogICAgICAgIAogICAgICAgIER1dGNoQXVjdGlvbihhdWN0aW9uKS5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfc2NyYXBQYXJ0SWQsCiAgICAgICAgICAgIF9nZXROZXh0QXVjdGlvblByaWNlKCksIC8vIGdlbiBuZXh0IGF1Y3Rpb24gcHJpY2UKICAgICAgICAgICAgc2NyYXBNaW5FbmRQcmljZSwKICAgICAgICAgICAgc2NyYXBBdWN0aW9uRHVyYXRpb24sCiAgICAgICAgICAgIGFkZHJlc3ModGhpcykKICAgICAgICApOwogICAgICAgIC8vIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfZ2V0TmV4dEF1Y3Rpb25QcmljZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYXZnID0gRHV0Y2hBdWN0aW9uKGF1Y3Rpb24pLmF2ZXJhZ2VTY3JhcFByaWNlKCk7CiAgICAgICAgLy8gYWRkIDMwJSB0byB0aGUgYXZlcmFnZQogICAgICAgIC8vIHByZXZlbnQgcnVuYXdheSBwcmljaW5nCiAgICAgICAgdWludCBuZXh0ID0gYXZnICsgKCgzMCAqIGF2ZykgLyAxMDApOwogICAgICAgIGlmIChuZXh0IDwgc2NyYXBNaW5TdGFydFByaWNlKSB7CiAgICAgICAgICAgIG5leHQgPSBzY3JhcE1pblN0YXJ0UHJpY2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXh0OwogICAgfQoKfQoKY29udHJhY3QgUGVya3NSZXdhcmRzIGlzIEV0aGVyYm90c0F1Y3Rpb24gewogICAgLy8vICBBbiBpbnRlcm5hbCBtZXRob2QgdGhhdCBjcmVhdGVzIGEgbmV3IHBhcnQgYW5kIHN0b3JlcyBpdC4gVGhpcwogICAgLy8vICBtZXRob2QgZG9lc24ndCBkbyBhbnkgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIHRoZQogICAgLy8vICBpbnB1dCBkYXRhIGlzIGtub3duIHRvIGJlIHZhbGlkLiBXaWxsIGdlbmVyYXRlIGJvdGggYSBGb3JnZSBldmVudAogICAgLy8vICBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgZnVuY3Rpb24gX2NyZWF0ZVBhcnQodWludDhbNF0gX3BhcnRBcnJheSwgYWRkcmVzcyBfb3duZXIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50MzIgbmV3UGFydElkID0gdWludDMyKHBhcnRzLmxlbmd0aCk7CiAgICAgICAgYXNzZXJ0KG5ld1BhcnRJZCA9PSBwYXJ0cy5sZW5ndGgpOwoKICAgICAgICBQYXJ0IG1lbW9yeSBfcGFydCA9IFBhcnQoewogICAgICAgICAgICB0b2tlbklkOiBuZXdQYXJ0SWQsCiAgICAgICAgICAgIHBhcnRUeXBlOiBfcGFydEFycmF5WzBdLAogICAgICAgICAgICBwYXJ0U3ViVHlwZTogX3BhcnRBcnJheVsxXSwKICAgICAgICAgICAgcmFyaXR5OiBfcGFydEFycmF5WzJdLAogICAgICAgICAgICBlbGVtZW50OiBfcGFydEFycmF5WzNdLAogICAgICAgICAgICBiYXR0bGVzTGFzdERheTogMCwKICAgICAgICAgICAgZXhwZXJpZW5jZTogMCwKICAgICAgICAgICAgZm9yZ2VUaW1lOiB1aW50MzIobm93KSwKICAgICAgICAgICAgYmF0dGxlc0xhc3RSZXNldDogdWludDMyKG5vdykKICAgICAgICB9KTsKICAgICAgICBhc3NlcnQobmV3UGFydElkID09IHBhcnRzLnB1c2goX3BhcnQpIC0gMSk7CgogICAgICAgIC8vIGVtaXQgdGhlIEZPUkdJTkchISEKICAgICAgICBGb3JnZShfb3duZXIsIG5ld1BhcnRJZCwgX3BhcnQpOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQgYXMKICAgICAgICAvLyBwZXIgRVJDNzIxIGRyYWZ0CiAgICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3UGFydElkKTsKCiAgICAgICAgcmV0dXJuIG5ld1BhcnRJZDsKICAgIH0KCiAgICB1aW50IHB1YmxpYyBQQVJUX1JFV0FSRF9DSEFOQ0UgPSA5OTU7CiAgICAvLyBEZXByZWNhdGVkIHN1YnR5cGVzIGNvbnRhaW4gdGhlIHN1YnR5cGUgSURzIG9mIGxlZ2FjeSBpdGVtcwogICAgLy8gd2hpY2ggYXJlIG5vIGxvbmdlciBhdmFpbGFibGUgdG8gYmUgcmVkZWVtZWQgaW4gZ2FtZS4KICAgIC8vIGkuZS4gc3VidHlwZSBJRCAxNCByZXByZXNlbnRzIGxhbWJvIGJvZHksIHByZXNhbGUgZXhjbHVzaXZlLgogICAgLy8gYSB2YWx1ZSBvZiAwIHJlcHJlc2VudHMgdGhhdCBzdWJ0eXBlIChpZCB3aXRoaW4gcmFuZ2UpCiAgICAvLyBhcyBiZWluZyBkZXByZWNhdGVkIGZvciB0aGF0IHBhcnQgdHlwZSAoYm9keSwgdHVycmV0LCBldGMpCiAgICB1aW50OFtdIHB1YmxpYyBkZWZlbmNlRWxlbWVudEJ5U3VidHlwZUluZGV4OwogICAgdWludDhbXSBwdWJsaWMgbWVsZWVFbGVtZW50QnlTdWJ0eXBlSW5kZXg7CiAgICB1aW50OFtdIHB1YmxpYyBib2R5RWxlbWVudEJ5U3VidHlwZUluZGV4OwogICAgdWludDhbXSBwdWJsaWMgdHVycmV0RWxlbWVudEJ5U3VidHlwZUluZGV4OwogICAgLy8gdWludDhbXSBwdWJsaWMgZGVmZW5jZUVsZW1lbnRCeVN1YnR5cGVJbmRleCA9IFsxLDIsNCwzLDQsMSwzLDMsMiwxLDRdOwogICAgLy8gdWludDhbXSBwdWJsaWMgbWVsZWVFbGVtZW50QnlTdWJ0eXBlSW5kZXggPSBbMywxLDMsMiwzLDQsMiwyLDEsMSwxLDEsNCw0XTsKICAgIC8vIHVpbnQ4W10gcHVibGljIGJvZHlFbGVtZW50QnlTdWJ0eXBlSW5kZXggPSBbMiwxLDIsMyw0LDMsMSwxLDQsMiwzLDQsMSwwLDFdOyAvLyBubyBtb3JlIGxhbWJvcyA6JygKICAgIC8vIHVpbnQ4W10gcHVibGljIHR1cnJldEVsZW1lbnRCeVN1YnR5cGVJbmRleCA9IFs0LDMsMiwxLDIsMSwxLDMsNCwzLDRdOwoKICAgIGZ1bmN0aW9uIHNldFJld2FyZENoYW5jZSh1aW50IF9uZXdDaGFuY2UpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfbmV3Q2hhbmNlID4gOTgwKTsgLy8gbm90IHRvbyBob3QKICAgICAgICByZXF1aXJlKF9uZXdDaGFuY2UgPD0gMTAwMCk7IC8vIG5vdCB0b28gY29sZAogICAgICAgIFBBUlRfUkVXQVJEX0NIQU5DRSA9IF9uZXdDaGFuY2U7IC8vIGp1c3QgcmlnaHQKICAgICAgICAvLyBjb21lIGF0IG1lIGdvbGRpbG9ja3MKICAgIH0KICAgIC8vIFRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIERPTidUIGNyZWF0ZSBwYXJ0cywgdGhleSBhZGQgbmV3IHBhcnRzCiAgICAvLyBhcyBwb3NzaWJsZSByZXdhcmRzIGZyb20gdGhlIHJld2FyZCBwb29sLgoKCiAgICBmdW5jdGlvbiBhZGREZWZlbmNlUGFydHModWludDhbXSBfbmV3RWxlbWVudCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgX25ld0VsZW1lbnQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZGVmZW5jZUVsZW1lbnRCeVN1YnR5cGVJbmRleC5wdXNoKF9uZXdFbGVtZW50W2ldKTsKICAgICAgICB9CiAgICAgICAgLy8gcmVxdWlyZShkZWZlbmNlRWxlbWVudEJ5U3VidHlwZUluZGV4Lmxlbmd0aCA8IHVpbnQodWludDgoLTEpKSk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRNZWxlZVBhcnRzKHVpbnQ4W10gX25ld0VsZW1lbnQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IF9uZXdFbGVtZW50Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1lbGVlRWxlbWVudEJ5U3VidHlwZUluZGV4LnB1c2goX25ld0VsZW1lbnRbaV0pOwogICAgICAgIH0KICAgICAgICAvLyByZXF1aXJlKG1lbGVlRWxlbWVudEJ5U3VidHlwZUluZGV4Lmxlbmd0aCA8IHVpbnQodWludDgoLTEpKSk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRCb2R5UGFydHModWludDhbXSBfbmV3RWxlbWVudCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgX25ld0VsZW1lbnQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYm9keUVsZW1lbnRCeVN1YnR5cGVJbmRleC5wdXNoKF9uZXdFbGVtZW50W2ldKTsKICAgICAgICB9CiAgICAgICAgLy8gcmVxdWlyZShib2R5RWxlbWVudEJ5U3VidHlwZUluZGV4Lmxlbmd0aCA8IHVpbnQodWludDgoLTEpKSk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRUdXJyZXRQYXJ0cyh1aW50OFtdIF9uZXdFbGVtZW50KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBfbmV3RWxlbWVudC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0dXJyZXRFbGVtZW50QnlTdWJ0eXBlSW5kZXgucHVzaChfbmV3RWxlbWVudFtpXSk7CiAgICAgICAgfQogICAgICAgIC8vIHJlcXVpcmUodHVycmV0RWxlbWVudEJ5U3VidHlwZUluZGV4Lmxlbmd0aCA8IHVpbnQodWludDgoLTEpKSk7CiAgICB9CiAgICAvLyBEZXByZWNhdGUgc3VidHlwZXMuIE9uY2UgYSBzdWJ0eXBlIGhhcyBiZWVuIGRlcHJlY2F0ZWQgaXQgY2FuIG5ldmVyIGJlCiAgICAvLyB1bmRlcHJlY2F0ZWQuIFN0YXJ0aW5nIHdpdGggbGFtYm8hCiAgICBmdW5jdGlvbiBkZXByZWNhdGVEZWZlbmNlU3VidHlwZSh1aW50OCBfc3VidHlwZUluZGV4VG9EZXByZWNhdGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgZGVmZW5jZUVsZW1lbnRCeVN1YnR5cGVJbmRleFtfc3VidHlwZUluZGV4VG9EZXByZWNhdGVdID0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBkZXByZWNhdGVNZWxlZVN1YnR5cGUodWludDggX3N1YnR5cGVJbmRleFRvRGVwcmVjYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIG1lbGVlRWxlbWVudEJ5U3VidHlwZUluZGV4W19zdWJ0eXBlSW5kZXhUb0RlcHJlY2F0ZV0gPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlcHJlY2F0ZUJvZHlTdWJ0eXBlKHVpbnQ4IF9zdWJ0eXBlSW5kZXhUb0RlcHJlY2F0ZSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBib2R5RWxlbWVudEJ5U3VidHlwZUluZGV4W19zdWJ0eXBlSW5kZXhUb0RlcHJlY2F0ZV0gPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlcHJlY2F0ZVR1cnJldFN1YnR5cGUodWludDggX3N1YnR5cGVJbmRleFRvRGVwcmVjYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHR1cnJldEVsZW1lbnRCeVN1YnR5cGVJbmRleFtfc3VidHlwZUluZGV4VG9EZXByZWNhdGVdID0gMDsKICAgIH0KCiAgICAvLyBmdW5jdGlvbiBfcmFuZG9tSW5kZXgodWludCBfcmFuZCwgdWludDggX3N0YXJ0SXgsIHVpbnQ4IF9lbmRJeCwgdWludDggX21vZHVsbykgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgLy8gICAgIHJlcXVpcmUoX3N0YXJ0SXggPCBfZW5kSXgpOwogICAgLy8gICAgIGJ5dGVzMzIgcmFuZEJ5dGVzID0gYnl0ZXMzMihfcmFuZCk7CiAgICAvLyAgICAgdWludCByZXN1bHQgPSAwOwogICAgLy8gICAgIGZvciAodWludDggaT1fc3RhcnRJeDsgaTxfZW5kSXg7IGkrKykgewogICAgLy8gICAgICAgICByZXN1bHQgPSByZXN1bHQgfCB1aW50OChyYW5kQnl0ZXNbaV0pOwogICAgLy8gICAgICAgICByZXN1bHQgPDwgODsKICAgIC8vICAgICB9CiAgICAvLyAgICAgdWludDggcmVzdWx0SW50ID0gdWludDgodWludChyZXN1bHQpICUgX21vZHVsbyk7CiAgICAvLyAgICAgcmV0dXJuIHJlc3VsdEludDsKICAgIC8vIH0KCgogICAgLy8gVGhpcyBmdW5jdGlvbiB0YWtlcyBhIHJhbmRvbSB1aW50LCBhbiBvd25lciBhbmQgcmFuZG9tbHkgZ2VuZXJhdGVzIGEgdmFsaWQgcGFydC4KICAgIC8vIEl0IHRoZW4gdHJhbnNmZXJzIHRoYXQgcGFydCB0byB0aGUgb3duZXIuCiAgICBmdW5jdGlvbiBfZ2VuZXJhdGVSYW5kb21QYXJ0KHVpbnQgX3JhbmQsIGFkZHJlc3MgX293bmVyKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gcmFuZG9tIHVpbnQgMjAgaW4gbGVuZ3RoIC0gTUFZQkUgMjAuCiAgICAgICAgLy8gZmlyc3QgcmFuZG9tbHkgZ2VuIGEgcGFydCB0eXBlCiAgICAgICAgX3JhbmQgPSB1aW50KGtlY2NhazI1NihfcmFuZCkpOwogICAgICAgIHVpbnQ4WzRdIG1lbW9yeSByYW5kb21QYXJ0OwogICAgICAgIHJhbmRvbVBhcnRbMF0gPSB1aW50OChfcmFuZCAlIDQpICsgMTsKICAgICAgICBfcmFuZCA9IHVpbnQoa2VjY2FrMjU2KF9yYW5kKSk7CgogICAgICAgIC8vIHJhbmRvbVBhcnRbMF0gPSBfcmFuZG9tSW5kZXgoX3JhbmQsMCw0LDQpICsgMTsgLy8gMSwgMiwgMywgNCwgPT4gZGVmZW5jZSwgbWVsZWUsIGJvZHksIHR1cnJldAoKICAgICAgICBpZiAocmFuZG9tUGFydFswXSA9PSBERUZFTkNFKSB7CiAgICAgICAgICAgIHJhbmRvbVBhcnRbMV0gPSBfZ2V0UmFuZG9tUGFydFN1YnR5cGUoX3JhbmQsZGVmZW5jZUVsZW1lbnRCeVN1YnR5cGVJbmRleCk7CiAgICAgICAgICAgIHJhbmRvbVBhcnRbM10gPSBfZ2V0RWxlbWVudChkZWZlbmNlRWxlbWVudEJ5U3VidHlwZUluZGV4LCByYW5kb21QYXJ0WzFdKTsKCiAgICAgICAgfSBlbHNlIGlmIChyYW5kb21QYXJ0WzBdID09IE1FTEVFKSB7CiAgICAgICAgICAgIHJhbmRvbVBhcnRbMV0gPSBfZ2V0UmFuZG9tUGFydFN1YnR5cGUoX3JhbmQsbWVsZWVFbGVtZW50QnlTdWJ0eXBlSW5kZXgpOwogICAgICAgICAgICByYW5kb21QYXJ0WzNdID0gX2dldEVsZW1lbnQobWVsZWVFbGVtZW50QnlTdWJ0eXBlSW5kZXgsIHJhbmRvbVBhcnRbMV0pOwoKICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbVBhcnRbMF0gPT0gQk9EWSkgewogICAgICAgICAgICByYW5kb21QYXJ0WzFdID0gX2dldFJhbmRvbVBhcnRTdWJ0eXBlKF9yYW5kLGJvZHlFbGVtZW50QnlTdWJ0eXBlSW5kZXgpOwogICAgICAgICAgICByYW5kb21QYXJ0WzNdID0gX2dldEVsZW1lbnQoYm9keUVsZW1lbnRCeVN1YnR5cGVJbmRleCwgcmFuZG9tUGFydFsxXSk7CgogICAgICAgIH0gZWxzZSBpZiAocmFuZG9tUGFydFswXSA9PSBUVVJSRVQpIHsKICAgICAgICAgICAgcmFuZG9tUGFydFsxXSA9IF9nZXRSYW5kb21QYXJ0U3VidHlwZShfcmFuZCx0dXJyZXRFbGVtZW50QnlTdWJ0eXBlSW5kZXgpOwogICAgICAgICAgICByYW5kb21QYXJ0WzNdID0gX2dldEVsZW1lbnQodHVycmV0RWxlbWVudEJ5U3VidHlwZUluZGV4LCByYW5kb21QYXJ0WzFdKTsKCiAgICAgICAgfQogICAgICAgIF9yYW5kID0gdWludChrZWNjYWsyNTYoX3JhbmQpKTsKICAgICAgICByYW5kb21QYXJ0WzJdID0gX2dldFJhcml0eShfcmFuZCk7CiAgICAgICAgLy8gcmFuZG9tUGFydFsyXSA9IF9nZXRSYXJpdHkoX3JhbmRvbUluZGV4KF9yYW5kLDgsMTIsMykpOyAvLyByYXJpdHkKICAgICAgICBfY3JlYXRlUGFydChyYW5kb21QYXJ0LCBfb3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRSYW5kb21QYXJ0U3VidHlwZSh1aW50IF9yYW5kLCB1aW50OFtdIGVsZW1lbnRCeVN1YnR5cGVJbmRleCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJlcXVpcmUoZWxlbWVudEJ5U3VidHlwZUluZGV4Lmxlbmd0aCA8IHVpbnQodWludDgoLTEpKSk7CiAgICAgICAgdWludDggc3VidHlwZUxlbmd0aCA9IHVpbnQ4KGVsZW1lbnRCeVN1YnR5cGVJbmRleC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoc3VidHlwZUxlbmd0aCA+IDApOwogICAgICAgIHVpbnQ4IHN1YnR5cGVJbmRleCA9IHVpbnQ4KF9yYW5kICUgc3VidHlwZUxlbmd0aCk7CiAgICAgICAgLy8gdWludDggc3VidHlwZUluZGV4ID0gX3JhbmRvbUluZGV4KF9yYW5kLDQsOCxzdWJ0eXBlTGVuZ3RoKTsKICAgICAgICB1aW50OCBjb3VudCA9IDA7CiAgICAgICAgd2hpbGUgKGVsZW1lbnRCeVN1YnR5cGVJbmRleFtzdWJ0eXBlSW5kZXhdID09IDApIHsKICAgICAgICAgICAgc3VidHlwZUluZGV4Kys7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIGlmIChzdWJ0eXBlSW5kZXggPT0gc3VidHlwZUxlbmd0aCkgewogICAgICAgICAgICAgICAgc3VidHlwZUluZGV4ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY291bnQgPiBzdWJ0eXBlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXF1aXJlKGVsZW1lbnRCeVN1YnR5cGVJbmRleFtzdWJ0eXBlSW5kZXhdICE9IDApOwogICAgICAgIHJldHVybiBzdWJ0eXBlSW5kZXggKyAxOwogICAgfQoKCiAgICBmdW5jdGlvbiBfZ2V0UmFyaXR5KHVpbnQgcmFuZCkgcHVyZSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCkgewogICAgICAgIHVpbnQxNiByYXJpdHkgPSB1aW50MTYocmFuZCAlIDEwMDApOwogICAgICAgIGlmIChyYXJpdHkgPj0gOTkwKSB7ICAvLyAxJSBjaGFuY2Ugb2YgZ29sZAogICAgICAgICAgcmV0dXJuIEdPTEQ7CiAgICAgICAgfSBlbHNlIGlmIChyYXJpdHkgPj0gOTcwKSB7IC8vIDIlIGNoYW5jZSBvZiBzaGFkb3cKICAgICAgICAgIHJldHVybiBTSEFET1c7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBTVEFOREFSRDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX2dldEVsZW1lbnQodWludDhbXSBlbGVtZW50QnlTdWJ0eXBlSW5kZXgsIHVpbnQ4IHN1YnR5cGUpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50OCBzdWJ0eXBlSW5kZXggPSBzdWJ0eXBlIC0gMTsKICAgICAgICByZXR1cm4gZWxlbWVudEJ5U3VidHlwZUluZGV4W3N1YnR5cGVJbmRleF07CiAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnRbXSkgcGVuZGluZ1BhcnRDcmF0ZXMgOwoKICAgIGZ1bmN0aW9uIGdldFBlbmRpbmdQYXJ0Q3JhdGVMZW5ndGgoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGVuZGluZ1BhcnRDcmF0ZXNbbXNnLnNlbmRlcl0ubGVuZ3RoOwogICAgfQoKICAgIC8vLyBQdXQgc2hhcmRzIHRvZ2V0aGVyIGludG8gYSBuZXcgcGFydC1jcmF0ZQogICAgZnVuY3Rpb24gcmVkZWVtU2hhcmRzSW50b1BlbmRpbmcoKSBleHRlcm5hbCB7CiAgICAgICAgVXNlciBzdG9yYWdlIHVzZXIgPSBhZGRyZXNzVG9Vc2VyW21zZy5zZW5kZXJdOwogICAgICAgICB3aGlsZSAodXNlci5udW1TaGFyZHMgPj0gU0hBUkRTX1RPX1BBUlQpIHsKICAgICAgICAgICAgIHVzZXIubnVtU2hhcmRzIC09IFNIQVJEU19UT19QQVJUOwogICAgICAgICAgICAgcGVuZGluZ1BhcnRDcmF0ZXNbbXNnLnNlbmRlcl0ucHVzaChibG9jay5udW1iZXIpOwogICAgICAgICAgICAgLy8gMjU2IGJsb2NrcyB0byByZWRlZW0KICAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9wZW5QZW5kaW5nUGFydENyYXRlcygpIGV4dGVybmFsIHsKICAgICAgICB1aW50W10gbWVtb3J5IGNyYXRlcyA9IHBlbmRpbmdQYXJ0Q3JhdGVzW21zZy5zZW5kZXJdOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGNyYXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50IHBlbmRpbmdCbG9ja051bWJlciA9IGNyYXRlc1tpXTsKICAgICAgICAgICAgLy8gY2FuJ3Qgb3BlbiBvbiB0aGUgc2FtZSB0aW1lc3RhbXAKICAgICAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiBwZW5kaW5nQmxvY2tOdW1iZXIpOwoKICAgICAgICAgICAgdmFyIGhhc2ggPSBibG9jay5ibG9ja2hhc2gocGVuZGluZ0Jsb2NrTnVtYmVyKTsKCiAgICAgICAgICAgIGlmICh1aW50KGhhc2gpICE9IDApIHsKICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudCByZXN1bHRzIGZvciBhbGwgZGlmZmVyZW50IGNyYXRlcywgZXZlbiBvbiB0aGUgc2FtZSBibG9jay9zYW1lIHVzZXIKICAgICAgICAgICAgICAgIC8vIHJhbmRvbW5lc3MgaXMgYWxyZWFkeSB0YWtlbiBjYXJlIG9mCiAgICAgICAgICAgICAgICB1aW50IHJhbmQgPSB1aW50KGtlY2NhazI1NihoYXNoLCBtc2cuc2VuZGVyLCBpKSk7IC8vICUgKDEwICoqIDIwKTsKICAgICAgICAgICAgICAgIF9nZW5lcmF0ZVJhbmRvbVBhcnQocmFuZCwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nLCBubyBzZWNvbmQgY2hhbmNlcyB0byBzZWN1cmUgaW50ZWdyaXR5IG9mIHJhbmRvbW5lc3MuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGVsZXRlIHBlbmRpbmdQYXJ0Q3JhdGVzW21zZy5zZW5kZXJdOwogICAgfQoKICAgIHVpbnQzMiBjb25zdGFudCBTSEFSRFNfTUFYID0gMTAwMDA7CgogICAgZnVuY3Rpb24gX2FkZFNoYXJkc1RvVXNlcihVc2VyIHN0b3JhZ2UgX3VzZXIsIHVpbnQzMiBfc2hhcmRzKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDMyIHVwZGF0ZWRTaGFyZHMgPSBfdXNlci5udW1TaGFyZHMgKyBfc2hhcmRzOwogICAgICAgIGlmICh1cGRhdGVkU2hhcmRzID4gU0hBUkRTX01BWCkgewogICAgICAgICAgICB1cGRhdGVkU2hhcmRzID0gU0hBUkRTX01BWDsKICAgICAgICB9CiAgICAgICAgX3VzZXIubnVtU2hhcmRzID0gdXBkYXRlZFNoYXJkczsKICAgICAgICBTaGFyZHNBZGRlZChtc2cuc2VuZGVyLCBfc2hhcmRzKTsKICAgIH0KCiAgICAvLyBGT1JHSU5HIC8gU0NSQVBQSU5HCiAgICBldmVudCBTaGFyZHNBZGRlZChhZGRyZXNzIGNhbGxlciwgdWludDMyIHNoYXJkcyk7CiAgICBldmVudCBTY3JhcChhZGRyZXNzIHVzZXIsIHVpbnQgcGFydElkKTsKCiAgICB1aW50MzIgY29uc3RhbnQgU0hBUkRTX1RPX1BBUlQgPSA1MDA7CiAgICB1aW50OCBwdWJsaWMgc2NyYXBQZXJjZW50ID0gNjA7CiAgICB1aW50OCBwdWJsaWMgYnVyblJhdGUgPSA2MDsgCgogICAgZnVuY3Rpb24gc2V0U2NyYXBQZXJjZW50KHVpbnQ4IF9uZXdQZXJjZW50KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoKF9uZXdQZXJjZW50ID49IDUwKSAmJiAoX25ld1BlcmNlbnQgPD0gOTApKTsKICAgICAgICBzY3JhcFBlcmNlbnQgPSBfbmV3UGVyY2VudDsKICAgIH0KCiAgICAvLyBmdW5jdGlvbiBzZXRTY3JhcHlhcmQoYWRkcmVzcyBfc2NyYXB5YXJkKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgLy8gICAgIHNjcmFweWFyZCA9IF9zY3JhcHlhcmQ7CiAgICAvLyB9CgogICAgZnVuY3Rpb24gc2V0QnVyblJhdGUodWludDggX3JhdGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgYnVyblJhdGUgPSBfcmF0ZTsKICAgIH0KCgogICAgdWludCBwdWJsaWMgc2NyYXBDb3VudCA9IDA7CgogICAgLy8gc2NyYXBzIGEgcGFydCBmb3Igc2hhcmRzCiAgICBmdW5jdGlvbiBzY3JhcCh1aW50IHBhcnRJZCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUob3ducyhtc2cuc2VuZGVyLCBwYXJ0SWQpKTsKICAgICAgICBVc2VyIHN0b3JhZ2UgdSA9IGFkZHJlc3NUb1VzZXJbbXNnLnNlbmRlcl07CiAgICAgICAgX2FkZFNoYXJkc1RvVXNlcih1LCAoU0hBUkRTX1RPX1BBUlQgKiBzY3JhcFBlcmNlbnQpIC8gMTAwKTsKICAgICAgICBTY3JhcChtc2cuc2VuZGVyLCBwYXJ0SWQpOwogICAgICAgIC8vIHRoaXMgZG9lc24ndCBuZWVkIHRvIGJlIHNlY3VyZQogICAgICAgIC8vIG5vIHdheSB0byBtYW5pcHVsYXRlIGl0IGFwYXJ0IGZyb20gZ3VhcmFudGVlaW5nIHlvdXIgcGFydHMgYXJlIHJlc29sZAogICAgICAgIC8vIG9yIGJ1cm50CiAgICAgICAgaWYgKHVpbnQoa2VjY2FrMjU2KHNjcmFwQ291bnQpKSAlIDEwMCA+PSBidXJuUmF0ZSkgewogICAgICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgYWRkcmVzcyh0aGlzKSwgcGFydElkKTsKICAgICAgICAgICAgX2NyZWF0ZVNjcmFwUGFydEF1Y3Rpb24ocGFydElkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgYWRkcmVzcygwKSwgcGFydElkKTsKICAgICAgICB9CiAgICAgICAgc2NyYXBDb3VudCsrOwogICAgfQoKfQoKY29udHJhY3QgTWludCBpcyBQZXJrc1Jld2FyZHMgewogICAgCiAgICAvLyBPd25lciBvbmx5IGZ1bmN0aW9uIHRvIGdpdmUgYW4gYWRkcmVzcyBuZXcgcGFydHMuCiAgICAvLyBTdHJpY3RseSBjYXBwZWQgYXQgNTAwMC4KICAgIC8vIFRoaXMgd2lsbCBPTkxZIGJlIHVzZWQgZm9yIHByb21vdGlvbmFsIHB1cnBvc2VzIChpLmUuIHByb3ZpZGluZyBpdGVtcyBmb3IgV2F4L09QU2tpbnMgcGFydG5lcnNoaXApCiAgICAvLyB3aGljaCB3ZSBkb24ndCBiZW5lZml0IGZpbmFuY2lhbGx5IGZyb20sIG9yIGdpdmluZyB1c2VycyB3aG8gd2luIHRoZSBwcml6ZSBvZiBkZXNpZ25pbmcgYSBwYXJ0IAogICAgLy8gZm9yIHRoZSBnYW1lLCBhIHNpbmdsZSBjb3B5IG9mIHRoYXQgcGFydC4KICAgIAogICAgdWludDE2IGNvbnN0YW50IE1JTlRfTElNSVQgPSA1MDAwOwogICAgdWludDE2IHB1YmxpYyBwYXJ0c01pbnRlZCA9IDA7CgogICAgZnVuY3Rpb24gbWludFBhcnRzKHVpbnQxNiBfY291bnQsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9jb3VudCA+IDAgJiYgX2NvdW50IDw9IDUwKTsKICAgICAgICAvLyBjaGVjayBvdmVyZmxvdwogICAgICAgIHJlcXVpcmUocGFydHNNaW50ZWQgKyBfY291bnQgPiBwYXJ0c01pbnRlZCk7CiAgICAgICAgcmVxdWlyZShwYXJ0c01pbnRlZCArIF9jb3VudCA8IE1JTlRfTElNSVQpOwogICAgICAgIAogICAgICAgIGFkZHJlc3NUb1VzZXJbX293bmVyXS5udW1TaGFyZHMgKz0gU0hBUkRTX1RPX1BBUlQgKiBfY291bnQ7CiAgICAgICAgCiAgICAgICAgcGFydHNNaW50ZWQgKz0gX2NvdW50OwogICAgfSAgICAgICAKCiAgICBmdW5jdGlvbiBtaW50UGFydGljdWxhclBhcnQodWludDhbNF0gX3BhcnRBcnJheSwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUocGFydHNNaW50ZWQgPCBNSU5UX0xJTUlUKTsKICAgICAgICAvKiBjYW5ub3QgY3JlYXRlIGRlcHJlY2F0ZWQgcGFydHMKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBkZXByZWNhdGVkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfcGFydEFycmF5WzJdID09IGRlcHJlY2F0ZWRbaV0pIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSAqLwogICAgICAgIF9jcmVhdGVQYXJ0KF9wYXJ0QXJyYXksIF9vd25lcik7CiAgICAgICAgcGFydHNNaW50ZWQrKzsKICAgIH0KCn0KCgoKCmNvbnRyYWN0IE5ld0NyYXRlUHJlU2FsZSB7CiAgICAKICAgIC8vIG1pZ3JhdGlvbiBmdW5jdGlvbnMgbWlncmF0ZSB0aGUgZGF0YSBmcm9tIHRoZSBwcmV2aW91cyBjb250cmFjdCBpbiBzdGFnZXMKICAgIC8vIGFsbCBhZGRyZXNzZXMgYXJlIGluY2x1ZGVkIGZvciB0cmFuc3BhcmVuY3kgYW5kIGVhc3kgdmVyaWZpY2F0aW9uCiAgICAvLyBob3dldmVyIGFkZHJlc3NlcyB3aXRoIG5vIHJvYm90cyAoaS5lLiBmYWlsZWQgdHJhbnNhY3Rpb24gYW5kIG5ldmVyIGJvdWdodCBwcm9wZXJseSkgaGF2ZSBiZWVuIGNvbW1lbnRlZCBvdXQuCiAgICAvLyB0byB2aWV3IHRoZSBmdWxsIGxpc3Qgb2Ygc3RhdGUgYXNzaWdubWVudHMsIGdvIHRvIGV0aGVyc2Nhbi5pby9hZGRyZXNzL3thZGRyZXNzfSBhbmQgeW91IGNhbiB2aWV3IHRoZSB2ZXJpZmllZAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50W10pIHB1YmxpYyB1c2VyVG9Sb2JvdHM7IAoKICAgIGZ1bmN0aW9uIF9taWdyYXRlKHVpbnQgX2luZGV4KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGJ5dGVzNCBzZWxlY3RvciA9IGJ5dGVzNChrZWNjYWsyNTYoInNldERhdGEoKSIpKTsKICAgICAgICBhZGRyZXNzIGEgPSBtaWdyYXRvcnNbX2luZGV4XTsKICAgICAgICByZXF1aXJlKGEuZGVsZWdhdGVjYWxsKHNlbGVjdG9yKSk7CiAgICB9CiAgICAvLyBzb3VyY2UgY29kZSAtIGZlZWwgZnJlZSB0byB2ZXJpZnkgdGhlIG1pZ3JhdGlvbgogICAgYWRkcmVzc1s2XSBtaWdyYXRvcnMgPSBbCiAgICAgICAgMHg3MDBGZUJEOTM2MGFjMEEwYTcyRjM3MTYxNTQyN0JlYzRFNDQ1NEU1LCAvLzB4OTdBRTAxODkzRTQyZDZkMzNmZDk4NTFBMjhFNTYyNzIyMkFmN0JCQiwKICAgICAgICAweDcyQ2M4OThkZTBBNEVBQzQ5YzQ2Y2NiOTkwMzc5MDk5NDYxMzQyZjYsCiAgICAgICAgMHhjM2NDNDhkYTNCODE2ODE1NGUwZjE0QmYwNDQ2QzdhOTM2MTNGMEE3LAogICAgICAgIDB4NGNDOTZmMkRkZjY4NDQzMjNhZTBkODQ2MWQ0MThhNEQ0NzNiOUFDMywKICAgICAgICAweGE1MmJGY2I1RkY1OTllMjlFRTJCOTEzMEYxNTc1QmFCYWEyN2RlMEEsCiAgICAgICAgMHhlNTAzYjQyQWFiZEEyMjk3NGUyQThCNzVGYTg3RTAxMGUxQjEzNTg0CiAgICBdOwogICAgCiAgICBmdW5jdGlvbiBOZXdDcmF0ZVByZVNhbGUoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgCiAgICAgICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICAvLyBvbmUgdGltZSB0cmFuc2ZlciBvZiBzdGF0ZSBmcm9tIHRoZSBwcmV2aW91cyBjb250cmFjdAogICAgICAgIC8vIHZhciBwcmV2aW91cyA9IENyYXRlUHJlU2FsZSgweDNjNzc2NzAxMUM0NDNFZmVGMjE4N2NmMUYyYTRjMDIwNjJkYTM5OTgpOyAvL01BSU5ORVQKCiAgICAgICAgLy8gb2xkQXBwcmVjaWF0aW9uUmF0ZVdlaSA9IHByZXZpb3VzLmFwcHJlY2lhdGlvblJhdGVXZWkoKTsKICAgICAgICBvbGRBcHByZWNpYXRpb25SYXRlV2VpID0gMTAwMDAwMDAwMDAwMDAwOwogICAgICAgIGFwcHJlY2lhdGlvblJhdGVXZWkgPSBvbGRBcHByZWNpYXRpb25SYXRlV2VpOwogIAogICAgICAgIC8vIG9sZFByaWNlID0gcHJldmlvdXMuY3VycmVudFByaWNlKCk7CiAgICAgICAgb2xkUHJpY2UgPSAyMzI2MDAwMDAwMDAwMDAwMDA7CiAgICAgICAgY3VycmVudFByaWNlID0gb2xkUHJpY2U7CgogICAgICAgIC8vIG9sZENyYXRlc1NvbGQgPSBwcmV2aW91cy5jcmF0ZXNTb2xkKCk7CiAgICAgICAgb2xkQ3JhdGVzU29sZCA9IDEwNzU7CiAgICAgICAgY3JhdGVzU29sZCA9IG9sZENyYXRlc1NvbGQ7CgogICAgICAgIC8vIE1pZ3JhdGlvbiBSYXRpb25hbGUKICAgICAgICAvLyBkdWUgdG8gc29saWRpdHkgaXNzdWVzIHdpdGggZW51bWVyYWJpbGl0eSAoY29udHJhY3QgY2FsbHMgY2Fubm90IHJldHVybiBkeW5hbWljIGFycmF5cyBldGMpCiAgICAgICAgLy8gbm8gbmVlZCBmb3IgdHJ1c3QgLT4gY2FuIHN0aWxsIHVzZSB3ZWIzIHRvIGNhbGwgdGhlIHByZXZpb3VzIGNvbnRyYWN0IGFuZCBjaGVjayB0aGUgc3RhdGUKICAgICAgICAvLyB3aWxsIG9ubHkgY2hhbmdlIGluIHRoZSBmdXR1cmUgaWYgcGVvcGxlIHNlbmQgbW9yZSBldGgKICAgICAgICAvLyBhbmQgd2lsbCBiZSBvYnZpb3VzIGR1ZSB0byBjaGFuZ2UgaW4gY3JhdGUgY291bnQuIEFueSBwdXJjaGFzZXMgb24gdGhlIG9sZCBjb250cmFjdAogICAgICAgIC8vIGFmdGVyIHRoaXMgY29udHJhY3QgaXMgZGVwbG95ZWQgd2lsbCBiZSBmdWxseSByZWZ1bmRlZCwgYW5kIHRob3NlIHJvYm90cyBib3VnaHQgd2lsbCBiZSB2b2lkZWQuIAogICAgICAgIC8vIGZlZWwgZnJlZSB0byB2YWxpZGF0ZSBhbnkgYWRkcmVzcyBvbiB0aGUgb2xkIGV0aGVyc2NhbjoKICAgICAgICAvLyBodHRwczovL2V0aGVyc2Nhbi5pby9hZGRyZXNzLzB4M2M3NzY3MDExQzQ0M0VmZUYyMTg3Y2YxRjJhNGMwMjA2MmRhMzk5OAogICAgICAgIC8vIGNhbiB2aXNpdCB0aGUgZXhhY3QgY29udHJhY3RzIGF0IHRoZSBhZGRyZXNzZXMgbGlzdGVkIGFib3ZlCiAgICB9CgogICAgLy8gLS0tLS0tIFNUQVRFIC0tLS0tLQogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgTUFYX0NSQVRFU19UT19TRUxMID0gMzkwMDsgLy8gTWF4IG5vLiBvZiByb2JvdCBjcmF0ZXMgdG8gZXZlciBiZSBzb2xkCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBQUkVTQUxFX0VORF9USU1FU1RBTVAgPSAxNTE4Njk5NjAwOyAvLyBFbmQgZGF0ZSBmb3IgdGhlIHByZXNhbGUgLSBubyBwdXJjaGFzZXMgY2FuIGJlIG1hZGUgYWZ0ZXIgdGhpcyBkYXRlIC0gTWlkbmlnaHQgMTYgRmViIDIwMTggVVRDCgogICAgdWludDI1NiBwdWJsaWMgYXBwcmVjaWF0aW9uUmF0ZVdlaTsKICAgIHVpbnQzMiBwdWJsaWMgY3JhdGVzU29sZDsKICAgIHVpbnQyNTYgcHVibGljIGN1cnJlbnRQcmljZTsKCiAgICAvLyBwcmVzZXJ2ZSB0aGVzZSBmb3IgbGF0ZXIgdmVyaWZpY2F0aW9uCiAgICB1aW50MzIgcHVibGljIG9sZENyYXRlc1NvbGQ7CiAgICB1aW50MjU2IHB1YmxpYyBvbGRQcmljZTsKICAgIHVpbnQyNTYgcHVibGljIG9sZEFwcHJlY2lhdGlvblJhdGVXZWk7CiAgICAvLyBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQzMikgcHVibGljIHVzZXJDcmF0ZUNvdW50OyAvLyByZXBsYWNlZCB3aXRoIG1vcmUgZWZmaWNpZW50IG1ldGhvZAogICAgCgogICAgLy8gc3RvcmUgdGhlIHVub3BlbmVkIGNyYXRlcyBvZiB0aGlzIHVzZXIKICAgIC8vIGFjdHVhbGx5IHN0b3JlcyB0aGUgYmxvY2tudW1iZXIgb2YgZWFjaCBjcmF0ZSAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludFtdKSBwdWJsaWMgYWRkcmVzc1RvUHVyY2hhc2VkQmxvY2tzOwogICAgLy8gc3RvcmUgdGhlIG51bWJlciBvZiBleHBpcmVkIGNyYXRlcyBmb3IgZWFjaCB1c2VyIAogICAgLy8gaS5lLiBjcmF0ZXMgd2hlcmUgdGhlIHVzZXIgZmFpbGVkIHRvIG9wZW4gdGhlIGNyYXRlIHdpdGhpbiAyNTYgYmxvY2tzICh+MSBob3VyKQogICAgLy8gdGhlc2UgY3JhdGVzIHdpbGwgYmUgYWJsZSB0byBiZSBvcGVuZWQgcG9zdC1sYXVuY2gKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGV4cGlyZWRDcmF0ZXM7CiAgICAvLyBzdG9yZSB0aGUgcGFydCBpbmZvcm1hdGlvbiBvZiBwdXJjaGFzZWQgY3JhdGVzCgoKCiAgICBmdW5jdGlvbiBvcGVuQWxsKCkgcHVibGljIHsKICAgICAgICB1aW50IGxlbiA9IGFkZHJlc3NUb1B1cmNoYXNlZEJsb2Nrc1ttc2cuc2VuZGVyXS5sZW5ndGg7CiAgICAgICAgcmVxdWlyZShsZW4gPiAwKTsKICAgICAgICB1aW50OCBjb3VudCA9IDA7CiAgICAgICAgLy8gbGVuID4gaSB0byBzdG9wIHByZWRpY2F0YWJsZSB3cmFwYXJvdW5kCiAgICAgICAgZm9yICh1aW50IGkgPSBsZW4gLSAxOyBpID49IDAgJiYgbGVuID4gaTsgaS0tKSB7CiAgICAgICAgICAgIHVpbnQgY3JhdGVCbG9jayA9IGFkZHJlc3NUb1B1cmNoYXNlZEJsb2Nrc1ttc2cuc2VuZGVyXVtpXTsKICAgICAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiBjcmF0ZUJsb2NrKTsKICAgICAgICAgICAgLy8gY2FuJ3Qgb3BlbiBvbiB0aGUgc2FtZSB0aW1lc3RhbXAKICAgICAgICAgICAgdmFyIGhhc2ggPSBibG9jay5ibG9ja2hhc2goY3JhdGVCbG9jayk7CiAgICAgICAgICAgIGlmICh1aW50KGhhc2gpICE9IDApIHsKICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudCByZXN1bHRzIGZvciBhbGwgZGlmZmVyZW50IGNyYXRlcywgZXZlbiBvbiB0aGUgc2FtZSBibG9jay9zYW1lIHVzZXIKICAgICAgICAgICAgICAgIC8vIHJhbmRvbW5lc3MgaXMgYWxyZWFkeSB0YWtlbiBjYXJlIG9mCiAgICAgICAgICAgICAgICB1aW50IHJhbmQgPSB1aW50KGtlY2NhazI1NihoYXNoLCBtc2cuc2VuZGVyLCBpKSkgJSAoMTAgKiogMjApOwogICAgICAgICAgICAgICAgdXNlclRvUm9ib3RzW21zZy5zZW5kZXJdLnB1c2gocmFuZCk7CiAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gYWxsIG90aGVycyB3aWxsIGJlIGV4cGlyZWQKICAgICAgICAgICAgICAgIGV4cGlyZWRDcmF0ZXNbbXNnLnNlbmRlcl0gKz0gKGkgKyAxKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENyYXRlc09wZW5lZChtc2cuc2VuZGVyLCBjb3VudCk7CiAgICAgICAgZGVsZXRlIGFkZHJlc3NUb1B1cmNoYXNlZEJsb2Nrc1ttc2cuc2VuZGVyXTsKICAgIH0KCiAgICAvLyAtLS0tLS0gRVZFTlRTIC0tLS0tLQogICAgZXZlbnQgQ3JhdGVzUHVyY2hhc2VkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgdWludDggX3F1YW50aXR5KTsKICAgIGV2ZW50IENyYXRlc09wZW5lZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIHVpbnQ4IF9xdWFudGl0eSk7CgogICAgLy8gLS0tLS0tIEZVTkNUSU9OUyAtLS0tLS0KICAgIGZ1bmN0aW9uIGdldFByaWNlKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjdXJyZW50UHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Um9ib3RDb3VudEZvclVzZXIoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdXNlclRvUm9ib3RzW191c2VyXS5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Um9ib3RGb3JVc2VyQnlJbmRleChhZGRyZXNzIF91c2VyLCB1aW50IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gdXNlclRvUm9ib3RzW191c2VyXVtfaW5kZXhdOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJvYm90c0ZvclVzZXIoYWRkcmVzcyBfdXNlcikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludFtdKSB7CiAgICAgICAgcmV0dXJuIHVzZXJUb1JvYm90c1tfdXNlcl07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UGVuZGluZ0NyYXRlc0ZvclVzZXIoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnRbXSkgewogICAgICAgIHJldHVybiBhZGRyZXNzVG9QdXJjaGFzZWRCbG9ja3NbX3VzZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFBlbmRpbmdDcmF0ZUZvclVzZXJCeUluZGV4KGFkZHJlc3MgX3VzZXIsIHVpbnQgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBhZGRyZXNzVG9QdXJjaGFzZWRCbG9ja3NbX3VzZXJdW19pbmRleF07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXhwaXJlZENyYXRlc0ZvclVzZXIoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gZXhwaXJlZENyYXRlc1tfdXNlcl07CiAgICB9CgogICAgZnVuY3Rpb24gaW5jcmVtZW50UHJpY2UoKSBwcml2YXRlIHsKICAgICAgICAvLyBEZWNyZWFzZSB0aGUgcmF0ZSBvZiBpbmNyZWFzZSBvZiB0aGUgY3JhdGUgcHJpY2UKICAgICAgICAvLyBhcyB0aGUgY3JhdGVzIGJlY29tZSBtb3JlIGV4cGVuc2l2ZQogICAgICAgIC8vIHRvIGF2b2lkIHJ1bmF3YXkgcHJpY2luZwogICAgICAgIC8vIChoYWx2aW5nIHJhdGUgb2YgaW5jcmVhc2UgYXQgMC4xIEVUSCwgMC4yIEVUSCwgMC4zIEVUSCkuCiAgICAgICAgaWYgKCBjdXJyZW50UHJpY2UgPT0gMTAwMDAwMDAwMDAwMDAwMDAwICkgewogICAgICAgICAgICBhcHByZWNpYXRpb25SYXRlV2VpID0gMjAwMDAwMDAwMDAwMDAwOwogICAgICAgIH0gZWxzZSBpZiAoIGN1cnJlbnRQcmljZSA9PSAyMDAwMDAwMDAwMDAwMDAwMDApIHsKICAgICAgICAgICAgYXBwcmVjaWF0aW9uUmF0ZVdlaSA9IDEwMDAwMDAwMDAwMDAwMDsKICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRQcmljZSA9PSAzMDAwMDAwMDAwMDAwMDAwMDApIHsKICAgICAgICAgICAgYXBwcmVjaWF0aW9uUmF0ZVdlaSA9IDUwMDAwMDAwMDAwMDAwOwogICAgICAgIH0KICAgICAgICBjdXJyZW50UHJpY2UgKz0gYXBwcmVjaWF0aW9uUmF0ZVdlaTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXJjaGFzZUNyYXRlcyh1aW50OCBfY3JhdGVzVG9CdXkpIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUobm93IDwgUFJFU0FMRV9FTkRfVElNRVNUQU1QKTsgLy8gQ2hlY2sgcHJlc2FsZSBpcyBzdGlsbCBvbmdvaW5nLgogICAgICAgIHJlcXVpcmUoX2NyYXRlc1RvQnV5IDw9IDEwKTsgLy8gQ2FuIG9ubHkgYnV5IG1heCAxMCBjcmF0ZXMgYXQgYSB0aW1lLiBEb24ndCBiZSBncmVlZHkhCiAgICAgICAgcmVxdWlyZShfY3JhdGVzVG9CdXkgPj0gMSk7IC8vIFNhbml0eSBjaGVjay4gQWxzbywgeW91IGhhdmUgdG8gYnV5IGEgY3JhdGUuIAogICAgICAgIHJlcXVpcmUoY3JhdGVzU29sZCArIF9jcmF0ZXNUb0J1eSA8PSBNQVhfQ1JBVEVTX1RPX1NFTEwpOyAvLyBDaGVjayBtYXggY3JhdGVzIHNvbGQgaXMgbGVzcyB0aGFuIGhhcmQgbGltaXQKICAgICAgICB1aW50MjU2IHByaWNlVG9QYXkgPSBfY2FsY3VsYXRlUGF5bWVudChfY3JhdGVzVG9CdXkpOwogICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBwcmljZVRvUGF5KTsgLy8gQ2hlY2sgYnV5ZXIgc2VudCBzdWZmaWNpZW50IGZ1bmRzIHRvIHB1cmNoYXNlCiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IHByaWNlVG9QYXkpIHsgLy9vdmVycGFpZCwgcmV0dXJuIGV4Y2VzcwogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZS1wcmljZVRvUGF5KTsKICAgICAgICB9CiAgICAgICAgLy9hbGwgZ29vZCwgcGF5bWVudCByZWNlaXZlZC4gaW5jcmVtZW50IG51bWJlciBzb2xkLCBwcmljZSwgYW5kIGdlbmVyYXRlIGNyYXRlIHJlY2VpcHRzIQogICAgICAgIGNyYXRlc1NvbGQgKz0gX2NyYXRlc1RvQnV5OwogICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgX2NyYXRlc1RvQnV5OyBpKyspIHsKICAgICAgICAgICAgaW5jcmVtZW50UHJpY2UoKTsKICAgICAgICAgICAgYWRkcmVzc1RvUHVyY2hhc2VkQmxvY2tzW21zZy5zZW5kZXJdLnB1c2goYmxvY2subnVtYmVyKTsKICAgICAgICB9CgogICAgICAgIENyYXRlc1B1cmNoYXNlZChtc2cuc2VuZGVyLCBfY3JhdGVzVG9CdXkpOwogICAgfSAKCiAgICBmdW5jdGlvbiBfY2FsY3VsYXRlUGF5bWVudCAodWludDggX2NyYXRlc1RvQnV5KSBwcml2YXRlIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIAogICAgICAgIHVpbnQyNTYgdGVtcFByaWNlID0gY3VycmVudFByaWNlOwoKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAxOyBpIDwgX2NyYXRlc1RvQnV5OyBpKyspIHsKICAgICAgICAgICAgdGVtcFByaWNlICs9IChjdXJyZW50UHJpY2UgKyAoYXBwcmVjaWF0aW9uUmF0ZVdlaSAqIGkpKTsKICAgICAgICB9IC8vIGZvciBldmVyeSBjcmF0ZSBvdmVyIDEgYm91Z2h0LCBhZGQgY3VycmVudCBQcmljZSBhbmQgYSBtdWx0aXBsZSBvZiB0aGUgYXBwcmVjaWF0aW9uIHJhdGUKICAgICAgICAgIC8vIHZlcnkgc21hbGwgZWRnZSBjYXNlIG9mIGJ1eWluZyAxMCB3aGVuIHlvdSB0aGUgYXBwcmVjaWF0aW9uIHJhdGUgaXMgYWJvdXQgdG8gaGFsdmUKICAgICAgICAgIC8vIGlzIGNvbXBlbnNhdGVkIGJ5IHRoZSBncmVhdCByZWR1Y3Rpb24gaW4gZ2FzIGJ5IGJ1eWluZyBOIGF0IGEgdGltZS4KICAgICAgICAKICAgICAgICByZXR1cm4gdGVtcFByaWNlOwogICAgfQoKCiAgICAvL293bmVyIG9ubHkgd2l0aGRyYXdhbCBmdW5jdGlvbiBmb3IgdGhlIHByZXNhbGUKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRGdW5kcygpIG9ubHlPd25lciBleHRlcm5hbCBwYXlhYmxlIHsKCiAgICB9CgogIGV2ZW50IFNldFBhdXNlZChib29sIHBhdXNlZCk7CgogIC8vIHN0YXJ0cyB1bnBhdXNlZAogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHBhdXNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFNldFBhdXNlZChwYXVzZWQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB1bnBhdXNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBTZXRQYXVzZWQocGF1c2VkKTsKICAgIHJldHVybiB0cnVlOwogIH0KCgogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgoKCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9CiAgICAKfQpjb250cmFjdCBFdGhlcmJvdHNNaWdyYXRpb25zIGlzIE1pbnQgewoKICAgIGV2ZW50IENyYXRlc09wZW5lZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIHVpbnQ4IF9xdWFudGl0eSk7CiAgICBldmVudCBPcGVuZWRPbGRDcmF0ZXMoYWRkcmVzcyBpbmRleGVkIF9mcm9tKTsKICAgIGV2ZW50IE1pZ3JhdGVkQ3JhdGVzKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgdWludDE2IF9xdWFudGl0eSwgYm9vbCBpc01pZ3JhdGlvbkNvbXBsZXRlKTsKCiAgICBhZGRyZXNzIHByZXNhbGUgPSAweGMyM0Y3NmFFYTAwQjc3NUFBREM4NTA0Q2NCMjI0NjhGNGZEMjI2MUE7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGhhc01pZ3JhdGVkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBoYXNPcGVuZWRPbGRDcmF0ZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludFtdKSBwZW5kaW5nQ3JhdGVzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQxNikgcHVibGljIGNyYXRlc01pZ3JhdGVkOwoKICAKICAgIC8vIEVsZW1lbnQ6IGNvcHkgZm9yIE1JR1JBVElPTlMgT05MWS4KICAgIHN0cmluZyBjb25zdGFudCBwcml2YXRlIERFRkVOQ0VfRUxFTUVOVF9CWV9JRCA9ICIxMjQzNDEzMzIxNCI7CiAgICBzdHJpbmcgY29uc3RhbnQgcHJpdmF0ZSBNRUxFRV9FTEVNRU5UX0JZX0lEID0gIjMxMzIzNDIyMTExMTQ0IjsKICAgIHN0cmluZyBjb25zdGFudCBwcml2YXRlIEJPRFlfRUxFTUVOVF9CWV9JRCA9ICIyMTIzNDMxMTQyMzQxMTEiOwogICAgc3RyaW5nIGNvbnN0YW50IHByaXZhdGUgVFVSUkVUX0VMRU1FTlRfQllfSUQgPSAiNDMyMTIxMTM0MzQiOwoKICAgIC8vIE9uY2Ugb25seSBmdW5jdGlvbi4KICAgIC8vIFRyYW5zZmVycyBhbGwgcGVuZGluZyBhbmQgZXhwaXJlZCBjcmF0ZXMgaW4gdGhlIG9sZCBjb250cmFjdAogICAgLy8gaW50byBwZW5kaW5nIGNyYXRlcyBpbiB0aGUgY3VycmVudCBvbmUuCiAgICAvLyBVc2VycyBjYW4gdGhlbiBvcGVuIHRoZW0gb24gdGhlIG5ldyBjb250cmFjdC4KICAgIC8vIFNob3VsZCBvbmx5IHJhcmVseSBoYXZlIHRvIGJlIGNhbGxlZC4KICAgIC8vIGV2ZW50IG9sZHBlbmRpbmcodWludCBvbGQpOwoKICAgIGZ1bmN0aW9uIG9wZW5PbGRDcmF0ZXMoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShoYXNPcGVuZWRPbGRDcmF0ZXNbbXNnLnNlbmRlcl0gPT0gZmFsc2UpOwogICAgICAgIC8vIHVpbnQgb2xkUGVuZGluZ0NyYXRlcyA9IE5ld0NyYXRlUHJlU2FsZShwcmVzYWxlKS5nZXRQZW5kaW5nQ3JhdGVGb3JVc2VyQnlJbmRleChtc2cuc2VuZGVyLDApOyAvLyBnZXR0aW5nIHVucmVjb2duaXNlZCBvcGNvZGUgaGVyZSAtLSEKICAgICAgICAvLyBvbGRwZW5kaW5nKG9sZFBlbmRpbmdDcmF0ZXMpOwogICAgICAgIC8vIHJlcXVpcmUob2xkUGVuZGluZ0NyYXRlcyA9PSAwKTsKICAgICAgICBfbWlncmF0ZUV4cGlyZWRDcmF0ZXMoKTsKICAgICAgICBoYXNPcGVuZWRPbGRDcmF0ZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIE9wZW5lZE9sZENyYXRlcyhtc2cuc2VuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaWdyYXRlKCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgCiAgICAgICAgLy8gQ2FuJ3QgbWlncmF0ZSB0d2ljZSAuCiAgICAgICAgcmVxdWlyZShoYXNNaWdyYXRlZFttc2cuc2VuZGVyXSA9PSBmYWxzZSk7CiAgICAgICAgCiAgICAgICAgLy8gcmVxdWlyZShOZXdDcmF0ZVByZVNhbGUocHJlc2FsZSkuZ2V0UGVuZGluZ0NyYXRlRm9yVXNlckJ5SW5kZXgobXNnLnNlbmRlciwwKSA9PSAwKTsKICAgICAgICAvLyBObyBwZW5kaW5nIGNyYXRlcyBpbiB0aGUgbmV3IGNvbnRyYWN0IGFsbG93ZWQuIE1ha2Ugc3VyZSB5b3Ugb3BlbiB0aGVtIGZpcnN0LgogICAgICAgIHJlcXVpcmUocGVuZGluZ0NyYXRlc1ttc2cuc2VuZGVyXS5sZW5ndGggPT0gMCk7CiAgICAgICAgCiAgICAgICAgLy8gSWYgdGhlIHVzZXIgaGFzIG9sZCBleHBpcmVkIGNyYXRlcywgZG9uJ3QgbGV0IHRoZW0gbWlncmF0ZSB1bnRpbCB0aGV5J3ZlCiAgICAgICAgLy8gY29udmVydGVkIHRoZW0gdG8gcGVuZGluZyBjcmF0ZXMgaW4gdGhlIG5ldyBjb250cmFjdC4KICAgICAgICBpZiAoTmV3Q3JhdGVQcmVTYWxlKHByZXNhbGUpLmdldEV4cGlyZWRDcmF0ZXNGb3JVc2VyKG1zZy5zZW5kZXIpID4gMCkgewogICAgICAgICAgICByZXF1aXJlKGhhc09wZW5lZE9sZENyYXRlc1ttc2cuc2VuZGVyXSk7IAogICAgICAgIH0KCiAgICAgICAgLy8gaGF2ZSB0byBtYWtlIGEgdG9uIG9mIGNhbGxzIHVuZm9ydHVuYXRlbHkgCiAgICAgICAgdWludDE2IGxlbmd0aCA9IHVpbnQxNihOZXdDcmF0ZVByZVNhbGUocHJlc2FsZSkuZ2V0Um9ib3RDb3VudEZvclVzZXIobXNnLnNlbmRlcikpOwoKICAgICAgICAvLyBnYXMgbGltaXQgd2lsbCBiZSBleGNlZWRlZCB3aXRoICp3aGFsZSogZXRoZXJib3QgcGxheWVycyEKICAgICAgICAvLyBsZXQncyBtaWdyYXRlIHRoZWlyIHJvYm90cyBpbiBiYXRjaGVzIG9mIHRlbi4KICAgICAgICAvLyB0aGV5IGNhbiBhZmZvcmQgaXQKICAgICAgICBib29sIGlzTWlncmF0aW9uQ29tcGxldGUgPSBmYWxzZTsKICAgICAgICB2YXIgbWF4ID0gbGVuZ3RoIC0gY3JhdGVzTWlncmF0ZWRbbXNnLnNlbmRlcl07CiAgICAgICAgaWYgKG1heCA+IDkpIHsKICAgICAgICAgICAgbWF4ID0gOTsKICAgICAgICB9IGVsc2UgeyAvLyBmaW5hbCBjYWxsIC0gYWxsIHJvYm90cyB3aWxsIGJlIG1pZ3JhdGVkCiAgICAgICAgICAgIGlzTWlncmF0aW9uQ29tcGxldGUgPSB0cnVlOwogICAgICAgICAgICBoYXNNaWdyYXRlZFttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGZvciAodWludCBpID0gY3JhdGVzTWlncmF0ZWRbbXNnLnNlbmRlcl07IGkgPCBjcmF0ZXNNaWdyYXRlZFttc2cuc2VuZGVyXSArIG1heDsgaSsrKSB7CiAgICAgICAgICAgIHZhciByb2JvdCA9IE5ld0NyYXRlUHJlU2FsZShwcmVzYWxlKS5nZXRSb2JvdEZvclVzZXJCeUluZGV4KG1zZy5zZW5kZXIsIGkpOwogICAgICAgICAgICB2YXIgcm9ib3RTdHJpbmcgPSB1aW50VG9TdHJpbmcocm9ib3QpOwogICAgICAgICAgICAvLyBNaWdyYXRlZEJvdChyb2JvdFN0cmluZyk7CgogICAgICAgICAgICBfbWlncmF0ZVJvYm90KHJvYm90U3RyaW5nKTsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIGNyYXRlc01pZ3JhdGVkW21zZy5zZW5kZXJdICs9IG1heDsKICAgICAgICBNaWdyYXRlZENyYXRlcyhtc2cuc2VuZGVyLCBjcmF0ZXNNaWdyYXRlZFttc2cuc2VuZGVyXSwgaXNNaWdyYXRpb25Db21wbGV0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gX21pZ3JhdGVSb2JvdChzdHJpbmcgcm9ib3QpIHByaXZhdGUgewogICAgICAgIHZhciAobWVsZWUsIGRlZmVuY2UsIGJvZHksIHR1cnJldCkgPSBfY29udmVydEJsdWVwcmludChyb2JvdCk7CiAgICAgICAgLy8gYmx1ZXByaW50cyBldmVudAogICAgICAgIC8vIGJsdWVwcmludHMoYm9keSwgdHVycmV0LCBtZWxlZSwgZGVmZW5jZSk7CiAgICAgICAgX2NyZWF0ZVBhcnQobWVsZWUsIG1zZy5zZW5kZXIpOwogICAgICAgIF9jcmVhdGVQYXJ0KGRlZmVuY2UsIG1zZy5zZW5kZXIpOwogICAgICAgIF9jcmVhdGVQYXJ0KHR1cnJldCwgbXNnLnNlbmRlcik7CiAgICAgICAgX2NyZWF0ZVBhcnQoYm9keSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gX2dldFJhcml0eShzdHJpbmcgb3JpZ2luYWwsIHVpbnQ4IGxvdywgdWludDggaGlnaCkgcHVyZSBwcml2YXRlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgdWludDMyIHJhcml0eSA9IHN0cmluZ1RvVWludDMyKHN1YnN0cmluZyhvcmlnaW5hbCxsb3csaGlnaCkpOwogICAgICAgIGlmIChyYXJpdHkgPj0gOTUwKSB7CiAgICAgICAgICByZXR1cm4gR09MRDsgCiAgICAgICAgfSBlbHNlIGlmIChyYXJpdHkgPj0gODUwKSB7CiAgICAgICAgICByZXR1cm4gU0hBRE9XOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gU1RBTkRBUkQ7IAogICAgICAgIH0KICAgIH0KICAgCiAgICBmdW5jdGlvbiBfZ2V0RWxlbWVudChzdHJpbmcgZWxlbWVudFN0cmluZywgdWludCBwYXJ0SWQpIHB1cmUgcHJpdmF0ZSByZXR1cm5zKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHN0cmluZ1RvVWludDgoc3Vic3RyaW5nKGVsZW1lbnRTdHJpbmcsIHBhcnRJZC0xLHBhcnRJZCkpOwogICAgfQoKICAgIC8vIEFjdHVhbGx5IHBhcnQgdHlwZQogICAgZnVuY3Rpb24gX2dldFBhcnRJZChzdHJpbmcgb3JpZ2luYWwsIHVpbnQ4IHN0YXJ0LCB1aW50OCBlbmQsIHVpbnQ4IHBhcnRDb3VudCkgcHVyZSBwcml2YXRlIHJldHVybnModWludDgpIHsKICAgICAgICByZXR1cm4gKHN0cmluZ1RvVWludDgoc3Vic3RyaW5nKG9yaWdpbmFsLHN0YXJ0LGVuZCkpICUgcGFydENvdW50KSArIDE7CiAgICB9CgogICAgZnVuY3Rpb24gdXNlclBlbmRpbmdDcmF0ZU51bWJlcihhZGRyZXNzIF91c2VyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGVuZGluZ0NyYXRlc1tfdXNlcl0ubGVuZ3RoOwogICAgfSAgICAKICAgIAogICAgLy8gY29udmVydCBvbGQgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHJvYm90IGludG8gNCBuZXcgRVJDNzIxIHBhcnRzCiAgCiAgICBmdW5jdGlvbiBfY29udmVydEJsdWVwcmludChzdHJpbmcgb3JpZ2luYWwpIHB1cmUgcHJpdmF0ZSByZXR1cm5zKHVpbnQ4WzRdIGJvZHksdWludDhbNF0gbWVsZWUsIHVpbnQ4WzRdIHR1cnJldCwgdWludDhbNF0gZGVmZW5jZSApIHsKCiAgICAgICAgLyogLS0tLS0tIENPTlZFUlNJT04gVElNRSAtLS0tLS0gKi8KICAgICAgICAKCiAgICAgICAgYm9keVswXSA9IEJPRFk7IAogICAgICAgIGJvZHlbMV0gPSBfZ2V0UGFydElkKG9yaWdpbmFsLCAzLCA1LCAxNSk7CiAgICAgICAgYm9keVsyXSA9IF9nZXRSYXJpdHkob3JpZ2luYWwsIDAsIDMpOwogICAgICAgIGJvZHlbM10gPSBfZ2V0RWxlbWVudChCT0RZX0VMRU1FTlRfQllfSUQsIGJvZHlbMV0pOwogICAgICAgIAogICAgICAgIHR1cnJldFswXSA9IFRVUlJFVDsKICAgICAgICB0dXJyZXRbMV0gPSBfZ2V0UGFydElkKG9yaWdpbmFsLCA4LCAxMCwgMTEpOwogICAgICAgIHR1cnJldFsyXSA9IF9nZXRSYXJpdHkob3JpZ2luYWwsIDUsIDgpOwogICAgICAgIHR1cnJldFszXSA9IF9nZXRFbGVtZW50KFRVUlJFVF9FTEVNRU5UX0JZX0lELCB0dXJyZXRbMV0pOwoKICAgICAgICBtZWxlZVswXSA9IE1FTEVFOwogICAgICAgIG1lbGVlWzFdID0gX2dldFBhcnRJZChvcmlnaW5hbCwgMTMsIDE1LCAxNCk7CiAgICAgICAgbWVsZWVbMl0gPSBfZ2V0UmFyaXR5KG9yaWdpbmFsLCAxMCwgMTMpOwogICAgICAgIG1lbGVlWzNdID0gX2dldEVsZW1lbnQoTUVMRUVfRUxFTUVOVF9CWV9JRCwgbWVsZWVbMV0pOwoKICAgICAgICBkZWZlbmNlWzBdID0gREVGRU5DRTsKICAgICAgICB2YXIgbGVuID0gYnl0ZXMob3JpZ2luYWwpLmxlbmd0aDsKICAgICAgICAvLyBzdHJpbmcgb2YgbnVtYmVyIGRvZXMgbm90IGhhdmUgcHJlY2VkaW5nIDAncwogICAgICAgIGlmIChsZW4gPT0gMjApIHsKICAgICAgICAgICAgZGVmZW5jZVsxXSA9IF9nZXRQYXJ0SWQob3JpZ2luYWwsIDE4LCAyMCwgMTEpOwogICAgICAgIH0gZWxzZSBpZiAobGVuID09IDE5KSB7CiAgICAgICAgICAgIGRlZmVuY2VbMV0gPSBfZ2V0UGFydElkKG9yaWdpbmFsLCAxOCwgMTksIDExKTsKICAgICAgICB9IGVsc2UgeyAvL3VubGlrZWx5IHRvIGhhdmUgbGVuZ3RoIGxlc3MgdGhhbiAxOQogICAgICAgICAgICBkZWZlbmNlWzFdID0gdWludDgoMSk7CiAgICAgICAgfQogICAgICAgIGRlZmVuY2VbMl0gPSBfZ2V0UmFyaXR5KG9yaWdpbmFsLCAxNSwgMTgpOwogICAgICAgIGRlZmVuY2VbM10gPSBfZ2V0RWxlbWVudChERUZFTkNFX0VMRU1FTlRfQllfSUQsIGRlZmVuY2VbMV0pOwoKICAgICAgICAvLyBpbXBsaWNpdCByZXR1cm4KICAgIH0KCiAgICAvLyBnaXZlIG9uZSBtb3JlIGNoYW5jZQogICAgZnVuY3Rpb24gX21pZ3JhdGVFeHBpcmVkQ3JhdGVzKCkgcHJpdmF0ZSB7CiAgICAgICAgLy8gZ2V0IHRoZSBudW1iZXIgb2YgZXhwaXJlZCBjcmF0ZXMKICAgICAgICB1aW50IGV4cGlyZWQgPSBOZXdDcmF0ZVByZVNhbGUocHJlc2FsZSkuZ2V0RXhwaXJlZENyYXRlc0ZvclVzZXIobXNnLnNlbmRlcik7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgZXhwaXJlZDsgaSsrKSB7CiAgICAgICAgICAgIHBlbmRpbmdDcmF0ZXNbbXNnLnNlbmRlcl0ucHVzaChibG9jay5udW1iZXIpOwogICAgICAgIH0KICAgIH0KICAgIC8vIFVzZXJzIGNhbiBvcGVuIHBlbmRpbmcgY3JhdGVzIG9uIHRoZSBuZXcgY29udHJhY3QuCiAgICBmdW5jdGlvbiBvcGVuQ3JhdGVzKCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnRbXSBtZW1vcnkgcGMgPSBwZW5kaW5nQ3JhdGVzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUocGMubGVuZ3RoID4gMCk7CiAgICAgICAgdWludDggY291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgY3JhdGVCbG9jayA9IHBjW2ldOwogICAgICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+IGNyYXRlQmxvY2spOwogICAgICAgICAgICAvLyBjYW4ndCBvcGVuIG9uIHRoZSBzYW1lIHRpbWVzdGFtcAogICAgICAgICAgICB2YXIgaGFzaCA9IGJsb2NrLmJsb2NraGFzaChjcmF0ZUJsb2NrKTsKICAgICAgICAgICAgaWYgKHVpbnQoaGFzaCkgIT0gMCkgewogICAgICAgICAgICAgICAgLy8gZGlmZmVyZW50IHJlc3VsdHMgZm9yIGFsbCBkaWZmZXJlbnQgY3JhdGVzLCBldmVuIG9uIHRoZSBzYW1lIGJsb2NrL3NhbWUgdXNlcgogICAgICAgICAgICAgICAgLy8gcmFuZG9tbmVzcyBpcyBhbHJlYWR5IHRha2VuIGNhcmUgb2YKICAgICAgICAgICAgICAgIHVpbnQgcmFuZCA9IHVpbnQoa2VjY2FrMjU2KGhhc2gsIG1zZy5zZW5kZXIsIGkpKSAlICgxMCAqKiAyMCk7CiAgICAgICAgICAgICAgICBfbWlncmF0ZVJvYm90KHVpbnRUb1N0cmluZyhyYW5kKSk7CiAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENyYXRlc09wZW5lZChtc2cuc2VuZGVyLCBjb3VudCk7CiAgICAgICAgZGVsZXRlIHBlbmRpbmdDcmF0ZXNbbXNnLnNlbmRlcl07CiAgICB9CgogICAgCn0KCmNvbnRyYWN0IEJhdHRsZSB7CiAgICAvLyBUaGlzIHN0cnVjdCBkb2VzIG5vdCBleGlzdCBvdXRzaWRlIHRoZSBjb250ZXh0IG9mIGEgYmF0dGxlCgogICAgLy8gdGhlIG5hbWUgb2YgdGhlIGJhdHRsZSB0eXBlCiAgICBmdW5jdGlvbiBuYW1lKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICAgLy8gdGhlIG51bWJlciBvZiByb2JvdHMgY3VycmVudGx5IGJhdHRsaW5nCiAgICBmdW5jdGlvbiBwbGF5ZXJDb3VudCgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCBjb3VudCk7CiAgICAvLyBjcmVhdGVzIGEgbmV3IGJhdHRsZSwgd2l0aCBhIHN1Ym1pdHRlZCB1c2VyIHN0cmluZyBmb3IgaW5pdGlhbCBpbnB1dC8KICAgIGZ1bmN0aW9uIGNyZWF0ZUJhdHRsZShhZGRyZXNzIF9jcmVhdG9yLCB1aW50W10gX3BhcnRJZHMsIGJ5dGVzMzIgX2NvbW1pdCwgdWludCBfcmV2ZWFsTGVuZ3RoKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKHVpbnQpOwogICAgLy8gY2FuY2VscyB0aGUgYmF0dGxlIGF0IGJhdHRsZUlECiAgICBmdW5jdGlvbiBjYW5jZWxCYXR0bGUodWludCBiYXR0bGVJRCkgZXh0ZXJuYWw7CiAgICAKICAgIGZ1bmN0aW9uIHdpbm5lck9mKHVpbnQgYmF0dGxlSWQsIHVpbnQgaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBsb3Nlck9mKHVpbnQgYmF0dGxlSWQsIHVpbnQgaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CgogICAgZXZlbnQgQmF0dGxlQ3JlYXRlZCh1aW50IGluZGV4ZWQgYmF0dGxlSUQsIGFkZHJlc3MgaW5kZXhlZCBzdGFydGVyKTsKICAgIGV2ZW50IEJhdHRsZVN0YWdlKHVpbnQgaW5kZXhlZCBiYXR0bGVJRCwgdWludDggbW92ZU51bWJlciwgdWludDhbMl0gYXR0YWNrZXJNb3Zlc0RlZmVuZGVyTW92ZXMsIHVpbnQxNlsyXSBhdHRhY2tlckRhbWFnZURlZmVuZGVyRGFtYWdlKTsKICAgIGV2ZW50IEJhdHRsZUVuZGVkKHVpbnQgaW5kZXhlZCBiYXR0bGVJRCwgYWRkcmVzcyBpbmRleGVkIHdpbm5lcik7CiAgICBldmVudCBCYXR0bGVDb25jbHVkZWQodWludCBpbmRleGVkIGJhdHRsZUlEKTsKICAgIGV2ZW50IEJhdHRsZVByb3BlcnR5Q2hhbmdlZChzdHJpbmcgbmFtZSwgdWludCBwcmV2aW91cywgdWludCB2YWx1ZSk7Cn0KY29udHJhY3QgRXRoZXJib3RzQmF0dGxlIGlzIEV0aGVyYm90c01pZ3JhdGlvbnMgewoKICAgIC8vIGNhbiBuZXZlciByZW1vdmUgYW55IG9mIHRoZXNlIGNvbnRyYWN0cywgY2FuIG9ubHkgYWRkCiAgICAvLyBvbmNlIHdlIHB1Ymxpc2ggYSBjb250cmFjdCwgeW91J2xsIGFsd2F5cyBiZSBhYmxlIHRvIHBsYXkgYnkgdGhhdCBydWxlc2V0CiAgICAvLyBnb29kIGZvciB0d28gcGxheWVyIGdhbWVzIHdoaWNoIGFyZSBub24tc3VzY2VwdGlibGUgdG8gY29sbHVzaW9uCiAgICAvLyBwZW9wbGUgY2FuIGJlIHRydXN0ZWQgdG8gY2hvb3NlIHRoZSBtb3N0IGJlbmVmaWNpYWwgb3V0Y29tZSwgd2hpY2ggaW4gdGhpcyBjYXNlCiAgICAvLyBpcyB0aGUgZmFpcmVzdCBmb3JtIG9mIGdhbWVwbGF5LgogICAgLy8gZmllbGRzIHdoaWNoIGFyZSB2dWxuZXJhYmxlIHRvIGNvbGx1c2lvbiBzdGlsbCBoYXZlIHRvIGJlIGNlbnRyYWxseSBjb250cm9sbGVkIDooCiAgICBmdW5jdGlvbiBhZGRBcHByb3ZlZEJhdHRsZShCYXR0bGUgX2JhdHRsZSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhcHByb3ZlZEJhdHRsZXMucHVzaChfYmF0dGxlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfaXNBcHByb3ZlZEJhdHRsZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBhcHByb3ZlZEJhdHRsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhhcHByb3ZlZEJhdHRsZXNbaV0pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFwcHJvdmVkQmF0dGxlcygpewogICAgICAgIHJlcXVpcmUoX2lzQXBwcm92ZWRCYXR0bGUoKSk7CiAgICAgICAgXzsKICAgIH0KCgogICAgZnVuY3Rpb24gY3JlYXRlQmF0dGxlKHVpbnQgX2JhdHRsZUlkLCB1aW50W10gcGFydElkcywgYnl0ZXMzMiBjb21taXQsIHVpbnQgcmV2ZWFsTGVuZ3RoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAvLyBzYW5pdHkgY2hlY2sgdG8gbWFrZSBzdXJlIF9iYXR0bGVJZCBpcyBhIHZhbGlkIGJhdHRsZQogICAgICAgIHJlcXVpcmUoX2JhdHRsZUlkIDwgYXBwcm92ZWRCYXR0bGVzLmxlbmd0aCk7CiAgICAgICAgLy9pZiBwYXJ0cyBhcmUgZ2l2ZW4sIG1ha2Ugc3VyZSB0aGV5IGFyZSBvd25lZAogICAgICAgIGlmIChwYXJ0SWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShvd25zQWxsKG1zZy5zZW5kZXIsIHBhcnRJZHMpKTsKICAgICAgICB9CiAgICAgICAgLy9iYXR0bGUgY2FuIGRlY2lkZSBudW1iZXIgb2YgcGFydHMgcmVxdWlyZWQgZm9yIGJhdHRsZQoKICAgICAgICBCYXR0bGUgYmF0dGxlID0gQmF0dGxlKGFwcHJvdmVkQmF0dGxlc1tfYmF0dGxlSWRdKTsKICAgICAgICAvLyBUcmFuc2ZlciBhbGwgdG8gc2VsZWN0ZWQgYmF0dGxlIGNvbnRyYWN0LgogICAgICAgIGZvciAodWludCBpPTA7IGk8cGFydElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBfYXBwcm92ZShwYXJ0SWRzW2ldLCBhZGRyZXNzKGJhdHRsZSkpOwogICAgICAgIH0KICAgICAgICB1aW50IG5ld0R1ZWxJZCA9IGJhdHRsZS5jcmVhdGVCYXR0bGUudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyLCBwYXJ0SWRzLCBjb21taXQsIHJldmVhbExlbmd0aCk7CiAgICAgICAgTmV3RHVlbChfYmF0dGxlSWQsIG5ld0R1ZWxJZCk7CiAgICB9CgogICAgZXZlbnQgTmV3RHVlbCh1aW50IGJhdHRsZUlkLCB1aW50IGR1ZWxJZCk7CgoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBSZXdhcmRbXSkgcHVibGljIHBlbmRpbmdSZXdhcmRzOwogICAgLy8gYWN0dWFsbHkgcHJvYmFibHkganVzdCB3YW50IGEgbGVuZ3RoIGdldHRlciBoZXJlIGFzIGRlZmF1bHQgcHVibGljIG1hcHBpbmcgZ2V0dGVycwogICAgLy8gYXJlIHByZXR0eSBleHBlbnNpdmUKCiAgICBmdW5jdGlvbiBnZXRQZW5kaW5nQmF0dGxlUmV3YXJkc0NvdW50KGFkZHJlc3MgX3VzZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwZW5kaW5nUmV3YXJkc1tfdXNlcl0ubGVuZ3RoOwogICAgfSAKCiAgICBzdHJ1Y3QgUmV3YXJkIHsKICAgICAgICB1aW50IGJsb2NrbnVtYmVyOwogICAgICAgIGludDMyIGV4cDsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRFeHBlcmllbmNlKGFkZHJlc3MgX3VzZXIsIHVpbnRbXSBfcGFydElkcywgaW50MzJbXSBfZXhwcykgZXh0ZXJuYWwgb25seUFwcHJvdmVkQmF0dGxlcyB7CiAgICAgICAgYWRkcmVzcyB1c2VyID0gX3VzZXI7CiAgICAgICAgcmVxdWlyZShfcGFydElkcy5sZW5ndGggPT0gX2V4cHMubGVuZ3RoKTsKICAgICAgICBpbnQzMiBzdW0gPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9leHBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBfYWRkUGFydEV4cGVyaWVuY2UoX3BhcnRJZHNbaV0sIF9leHBzW2ldKTsKICAgICAgICB9CiAgICAgICAgX2FkZFVzZXJFeHBlcmllbmNlKHVzZXIsIHN1bSk7CiAgICAgICAgX3N0b3JlUmV3YXJkKHVzZXIsIHN1bSk7CiAgICB9CgogICAgLy8gc3RvcmUgc3VtLgogICAgZnVuY3Rpb24gX3N0b3JlUmV3YXJkKGFkZHJlc3MgX3VzZXIsIGludDMyIF9iYXR0bGVFeHApIGludGVybmFsIHsKICAgICAgICBwZW5kaW5nUmV3YXJkc1tfdXNlcl0ucHVzaChSZXdhcmQoewogICAgICAgICAgICBibG9ja251bWJlcjogMCwKICAgICAgICAgICAgZXhwOiBfYmF0dGxlRXhwCiAgICAgICAgfSkpOwogICAgfQoKICAgIC8qIGZ1bmN0aW9uIF9nZXRFeHBQcm9wb3J0aW9uKGludCBfZXhwKSByZXR1cm5zKGludCkgewogICAgICAgIC8vIGFzc3VtZSBtYXgvbWluIG9mIDFrLCAtMWsKICAgICAgICByZXR1cm4gMTAwMCArIF9leHAgKyAxOyAvLyBtYWtlcyBpdCBiZXR3ZWVuICgxLCAyMDAxKQogICAgfSAqLwogICAgdWludDggYmVzdE11bHRpcGxlID0gMzsKICAgIHVpbnQ4IG1lZGl1bU11bHRpcGxlID0gMjsKICAgIHVpbnQ4IHdvcnN0TXVsdGlwbGUgPSAxOwogICAgdWludDggbWluU2hhcmRzID0gMTsKICAgIHVpbnQ4IGJlc3RQcm9iYWJpbGl0eSA9IDk3OwogICAgdWludDggbWVkaXVtUHJvYmFiaWxpdHkgPSA4NTsKICAgIGZ1bmN0aW9uIF9nZXRFeHBNdWx0aXBsZShpbnQgX2V4cCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50OCwgdWludDgpIHsKICAgICAgICBpZiAoX2V4cCA+IDUwMCkgewogICAgICAgICAgICByZXR1cm4gKGJlc3RNdWx0aXBsZSxtZWRpdW1NdWx0aXBsZSk7CiAgICAgICAgfSBlbHNlIGlmIChfZXhwID4gMCkgewogICAgICAgICAgICByZXR1cm4gKG1lZGl1bU11bHRpcGxlLG1lZGl1bU11bHRpcGxlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKHdvcnN0TXVsdGlwbGUsbWVkaXVtTXVsdGlwbGUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCZXN0KHVpbnQ4IF9uZXdCZXN0TXVsdGlwbGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgYmVzdE11bHRpcGxlID0gX25ld0Jlc3RNdWx0aXBsZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldE1lZGl1bSh1aW50OCBfbmV3TWVkaXVtTXVsdGlwbGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgbWVkaXVtTXVsdGlwbGUgPSBfbmV3TWVkaXVtTXVsdGlwbGU7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRXb3JzdCh1aW50OCBfbmV3V29yc3RNdWx0aXBsZSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICB3b3JzdE11bHRpcGxlID0gX25ld1dvcnN0TXVsdGlwbGU7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRNaW5TaGFyZHModWludDggX25ld01pbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBtaW5TaGFyZHMgPSBfbmV3TWluOwogICAgfQogICAgZnVuY3Rpb24gc2V0QmVzdFByb2JhYmlsaXR5KHVpbnQ4IF9uZXdCZXN0UHJvYikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBiZXN0UHJvYmFiaWxpdHkgPSBfbmV3QmVzdFByb2I7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRNZWRpdW1Qcm9iYWJpbGl0eSh1aW50OCBfbmV3TWluUHJvYikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBtZWRpdW1Qcm9iYWJpbGl0eSA9IF9uZXdNaW5Qcm9iOwogICAgfQoKCgogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZVNoYXJkcyhpbnQgX2V4cCwgdWludCByYW5kKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQxNikgewogICAgICAgIHZhciAoYSwgYikgPSBfZ2V0RXhwTXVsdGlwbGUoX2V4cCk7CiAgICAgICAgdWludDE2IHNoYXJkczsKICAgICAgICB1aW50IHJhbmRQZXJjZW50ID0gcmFuZCAlIDEwMDsKICAgICAgICBpZiAocmFuZFBlcmNlbnQgPiBiZXN0UHJvYmFiaWxpdHkpIHsKICAgICAgICAgICAgc2hhcmRzID0gdWludDE2KGEgKiAoKHJhbmQgJSAyMCkgKyAxMikgLyBiKTsKICAgICAgICB9IGVsc2UgaWYgKHJhbmRQZXJjZW50ID4gbWVkaXVtUHJvYmFiaWxpdHkpIHsKICAgICAgICAgICAgc2hhcmRzID0gdWludDE2KGEgKiAoKHJhbmQgJSAxMCkgKyA2KSAvIGIpOyAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2hhcmRzID0gdWludDE2KChhICogKHJhbmQgJSA1KSkgLyBiKTsgICAgICAgCiAgICAgICAgfQoKICAgICAgICBpZiAoc2hhcmRzIDwgbWluU2hhcmRzKSB7CiAgICAgICAgICAgIHNoYXJkcyA9IG1pblNoYXJkczsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzaGFyZHM7CiAgICB9CgogICAgLy8gY29udmVydCB3aW5zIGludG8gcGVuZGluZyBiYXR0bGUgY3JhdGVzCiAgICAvLyBOb3QgdG8gcGVuZGluZyBvbGQgY3JhdGVzIChtaWdyYXRpb24pLCBub3IgcGVuZGluZyBwYXJ0IGNyYXRlcyAocmVkZWVtU2hhcmRzKQogICAgZnVuY3Rpb24gY29udmVydFJld2FyZCgpIGV4dGVybmFsIHsKCiAgICAgICAgUmV3YXJkW10gc3RvcmFnZSByZXdhcmRzID0gcGVuZGluZ1Jld2FyZHNbbXNnLnNlbmRlcl07CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJld2FyZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHJld2FyZHNbaV0uYmxvY2tudW1iZXIgPT0gMCkgewogICAgICAgICAgICAgICAgcmV3YXJkc1tpXS5ibG9ja251bWJlciA9IGJsb2NrLm51bWJlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgLy8gaW4gUGVya3NSZXdhcmRzCiAgICBmdW5jdGlvbiByZWRlZW1CYXR0bGVDcmF0ZXMoKSBleHRlcm5hbCB7CiAgICAgICAgdWludDggY291bnQgPSAwOwogICAgICAgIHVpbnQgbGVuID0gcGVuZGluZ1Jld2FyZHNbbXNnLnNlbmRlcl0ubGVuZ3RoOwogICAgICAgIHJlcXVpcmUobGVuID4gMCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgUmV3YXJkIG1lbW9yeSByZXdhcmRTdHJ1Y3QgPSBwZW5kaW5nUmV3YXJkc1ttc2cuc2VuZGVyXVtpXTsKICAgICAgICAgICAgLy8gY2FuJ3Qgb3BlbiBvbiB0aGUgc2FtZSB0aW1lc3RhbXAKICAgICAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiByZXdhcmRTdHJ1Y3QuYmxvY2tudW1iZXIpOwogICAgICAgICAgICAvLyBlbnN1cmUgdXNlciBoYXMgY29udmVydGVkIGFsbCBwZW5kaW5nUmV3YXJkcwogICAgICAgICAgICByZXF1aXJlKHJld2FyZFN0cnVjdC5ibG9ja251bWJlciAhPSAwKTsKCiAgICAgICAgICAgIHZhciBoYXNoID0gYmxvY2suYmxvY2toYXNoKHJld2FyZFN0cnVjdC5ibG9ja251bWJlcik7CgogICAgICAgICAgICBpZiAodWludChoYXNoKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAvLyBkaWZmZXJlbnQgcmVzdWx0cyBmb3IgYWxsIGRpZmZlcmVudCBjcmF0ZXMsIGV2ZW4gb24gdGhlIHNhbWUgYmxvY2svc2FtZSB1c2VyCiAgICAgICAgICAgICAgICAvLyByYW5kb21uZXNzIGlzIGFscmVhZHkgdGFrZW4gY2FyZSBvZgogICAgICAgICAgICAgICAgdWludCByYW5kID0gdWludChrZWNjYWsyNTYoaGFzaCwgbXNnLnNlbmRlciwgaSkpOwogICAgICAgICAgICAgICAgX2dlbmVyYXRlQmF0dGxlUmV3YXJkKHJhbmQscmV3YXJkU3RydWN0LmV4cCk7CiAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZywgbm8gc2Vjb25kIGNoYW5jZXMgdG8gc2VjdXJlIGludGVncml0eSBvZiByYW5kb21uZXNzLgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENyYXRlc09wZW5lZChtc2cuc2VuZGVyLCBjb3VudCk7CiAgICAgICAgZGVsZXRlIHBlbmRpbmdSZXdhcmRzW21zZy5zZW5kZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZW5lcmF0ZUJhdHRsZVJld2FyZCh1aW50IHJhbmQsIGludDMyIGV4cCkgaW50ZXJuYWwgewogICAgICAgIGlmICgoKHJhbmQgJSAxMDAwKSA+IFBBUlRfUkVXQVJEX0NIQU5DRSkgJiYgKGV4cCA+IDApKSB7CiAgICAgICAgICAgIF9nZW5lcmF0ZVJhbmRvbVBhcnQocmFuZCwgbXNnLnNlbmRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2FkZFNoYXJkc1RvVXNlcihhZGRyZXNzVG9Vc2VyW21zZy5zZW5kZXJdLCBfY2FsY3VsYXRlU2hhcmRzKGV4cCwgcmFuZCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBkb24ndCBuZWVkIHRvIGRvIGFueSBzY2FsaW5nCiAgICAvLyBzaG91bGQgYWxyZWFkeSBoYXZlIGJlZW4gZG9uZSBieSBwcmV2aW91cyBzdGFnZXMKICAgIGZ1bmN0aW9uIF9hZGRVc2VyRXhwZXJpZW5jZShhZGRyZXNzIHVzZXIsIGludDMyIGV4cCkgaW50ZXJuYWwgewogICAgICAgIC8vIG5ldmVyIGFsbG93IGV4cCB0byBkcm9wIGJlbG93IDAKICAgICAgICBVc2VyIG1lbW9yeSB1ID0gYWRkcmVzc1RvVXNlclt1c2VyXTsKICAgICAgICBpZiAoZXhwIDwgMCAmJiB1aW50MzIoaW50MzIodS5leHBlcmllbmNlKSArIGV4cCkgPiB1LmV4cGVyaWVuY2UpIHsKICAgICAgICAgICAgdS5leHBlcmllbmNlID0gMDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAoZXhwID4gMCkgewogICAgICAgICAgICAvLyBjaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICAgcmVxdWlyZSh1aW50MzIoaW50MzIodS5leHBlcmllbmNlKSArIGV4cCkgPiB1LmV4cGVyaWVuY2UpOwogICAgICAgIH0KICAgICAgICBhZGRyZXNzVG9Vc2VyW3VzZXJdLmV4cGVyaWVuY2UgPSB1aW50MzIoaW50MzIodS5leHBlcmllbmNlKSArIGV4cCk7CiAgICAgICAgLy9fYWRkVXNlclJld2FyZCh1c2VyLCBleHApOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1pblNjYWxlZChpbnQ4IF9taW4pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgbWluU2NhbGVkID0gX21pbjsKICAgIH0KCiAgICBpbnQ4IG1pblNjYWxlZCA9IDI1OwoKICAgIGZ1bmN0aW9uIF9zY2FsZUV4cCh1aW50MzIgX2JhdHRsZUNvdW50LCBpbnQzMiBfZXhwKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGludDMyKSB7CiAgICAgICAgaWYgKF9iYXR0bGVDb3VudCA8PSAxMCkgewogICAgICAgICAgICByZXR1cm4gX2V4cDsgLy8gbm8gZHJvcCBvZmYKICAgICAgICB9CiAgICAgICAgaW50MzIgZXhwID0gIChfZXhwICogMTApL2ludDMyKF9iYXR0bGVDb3VudCk7CgogICAgICAgIGlmIChleHAgPCBtaW5TY2FsZWQpIHsKICAgICAgICAgICAgcmV0dXJuIG1pblNjYWxlZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH0KCiAgICBmdW5jdGlvbiBfYWRkUGFydEV4cGVyaWVuY2UodWludCBfaWQsIGludDMyIF9iYXNlRXhwKSBpbnRlcm5hbCByZXR1cm5zIChpbnQzMikgewogICAgICAgIC8vIG5ldmVyIGFsbG93IGV4cCB0byBkcm9wIGJlbG93IDAKICAgICAgICBQYXJ0IHN0b3JhZ2UgcCA9IHBhcnRzW19pZF07CiAgICAgICAgaWYgKG5vdyAtIHAuYmF0dGxlc0xhc3RSZXNldCA+IDI0IGhvdXJzKSB7CiAgICAgICAgICAgIHAuYmF0dGxlc0xhc3RSZXNldCA9IHVpbnQzMihub3cpOwogICAgICAgICAgICBwLmJhdHRsZXNMYXN0RGF5ID0gMDsKICAgICAgICB9CiAgICAgICAgcC5iYXR0bGVzTGFzdERheSsrOwogICAgICAgIGludDMyIGV4cCA9IF9iYXNlRXhwOwogICAgICAgIGlmIChleHAgPiAwKSB7CiAgICAgICAgICAgIGV4cCA9IF9zY2FsZUV4cChwLmJhdHRsZXNMYXN0RGF5LCBfYmFzZUV4cCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZXhwIDwgMCAmJiB1aW50MzIoaW50MzIocC5leHBlcmllbmNlKSArIGV4cCkgPiBwLmV4cGVyaWVuY2UpIHsKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHdyYXAtYXJvdW5kCiAgICAgICAgICAgIHAuZXhwZXJpZW5jZSA9IDA7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKGV4cCA+IDApIHsKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgIHJlcXVpcmUodWludDMyKGludDMyKHAuZXhwZXJpZW5jZSkgKyBleHApID4gcC5leHBlcmllbmNlKTsKICAgICAgICB9CgogICAgICAgIHBhcnRzW19pZF0uZXhwZXJpZW5jZSA9IHVpbnQzMihpbnQzMihwYXJ0c1tfaWRdLmV4cGVyaWVuY2UpICsgZXhwKTsKICAgICAgICByZXR1cm4gZXhwOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsTGV2ZWwodWludFtdIHBhcnRJZHMpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHVpbnQzMiB0b3RhbCA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcGFydElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbCArPSBnZXRMZXZlbChwYXJ0c1twYXJ0SWRzW2ldXS5leHBlcmllbmNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgfQoKICAgIC8vcmVxdWlyZXMgcGFydHMgaW4gb3JkZXIKICAgIGZ1bmN0aW9uIGhhc09yZGVyZWRSb2JvdFBhcnRzKHVpbnRbXSBwYXJ0SWRzKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQgbGVuID0gcGFydElkcy5sZW5ndGg7CiAgICAgICAgaWYgKGxlbiAhPSA0KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBhcnRzW3BhcnRJZHNbaV1dLnBhcnRUeXBlICE9IGkrMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKY29udHJhY3QgRXRoZXJib3RzQ29yZSBpcyBFdGhlcmJvdHNCYXR0bGUgewoKICAgIC8vIFRoZSBzdHJ1Y3R1cmUgb2YgRXRoZXJib3RzIGlzIG1vZGVsbGVkIG9uIENyeXB0b0tpdHRpZXMgZm9yIG9idmlvdXMgcmVhc29uczoKICAgIC8vIGVhc2Ugb2YgaW1wbGVtZW50YXRpb24sIHRyaWVkICsgdGVzdGVkIGV0Yy4KICAgIC8vIGl0IGVsaWRlcyBzb21lIGZlYXR1cmVzIGFuZCBpbmNsdWRlcyBzb21lIG90aGVycy4KCiAgICAvLyBUaGUgZnVsbCBzeXN0ZW0gaXMgaW1wbGVtZW50ZWQgaW4gdGhlIGZvbGxvd2luZyBtYW5uZXI6CiAgICAvLwogICAgLy8gRXRoZXJib3RzQmFzZSAgICB8IFN0b3JhZ2UgYW5kIGJhc2UgdHlwZXMKICAgIC8vIEV0aGVyYm90c0FjY2VzcyAgfCBBY2Nlc3MgQ29udHJvbCAtIHdobyBjYW4gY2hhbmdlIHdoaWNoIHN0YXRlIHZhcnMgZXRjLgogICAgLy8gRXRoZXJib3RzTkZUICAgICB8IEVSQzcyMSBJbXBsZW1lbnRhdGlvbgogICAgLy8gRXRoZXJib3RzQmF0dGxlICB8IEJhdHRsZSBpbnRlcmZhY2UgY29udHJhY3Q6IG9ubHkgb25lIGltcGxlbWVudGF0aW9uIGN1cnJlbnRseSwgYnV0IGNvdWxkIGFkZCBtb3JlIGxhdGVyLgogICAgLy8gRXRoZXJib3RzQXVjdGlvbiB8IEF1Y3Rpb24gaW50ZXJmYWNlIGNvbnRyYWN0CgoKICAgIGZ1bmN0aW9uIEV0aGVyYm90c0NvcmUoKSBwdWJsaWMgewogICAgICAgIC8vIFN0YXJ0cyBwYXVzZWQuCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9Cn0='.
	

]
