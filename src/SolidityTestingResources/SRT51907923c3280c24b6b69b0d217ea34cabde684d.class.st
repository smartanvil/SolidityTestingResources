Class {
	#name : #SRT51907923c3280c24b6b69b0d217ea34cabde684d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT51907923c3280c24b6b69b0d217ea34cabde684d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKgogICAgT3duZWQgY29udHJhY3QgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElPd25lZCB7CiAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBvd25lcigpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHt9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWM7Cn0KCi8qCiAgICBVdGlsaXRpZXMgJiBDb21tb24gTW9kaWZpZXJzCiovCmNvbnRyYWN0IFV0aWxzIHsKICAgIC8qKgogICAgICAgIGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gVXRpbHMoKSBwdWJsaWMgewogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgYW4gYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiB6ZXJvCiAgICBtb2RpZmllciBncmVhdGVyVGhhblplcm8odWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYW4gYWRkcmVzcyAtIGN1cnJlbnRseSBvbmx5IGNoZWNrcyB0aGF0IGl0IGlzbid0IG51bGwKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgaXMgZGlmZmVyZW50IHRoYW4gdGhpcyBjb250cmFjdCBhZGRyZXNzCiAgICBtb2RpZmllciBub3RUaGlzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gT3ZlcmZsb3cgcHJvdGVjdGVkIG1hdGggZnVuY3Rpb25zCgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBzdW0gb2YgX3ggYW5kIF95LCBhc3NlcnRzIGlmIHRoZSBjYWxjdWxhdGlvbiBvdmVyZmxvd3MKCiAgICAgICAgQHBhcmFtIF94ICAgdmFsdWUgMQogICAgICAgIEBwYXJhbSBfeSAgIHZhbHVlIDIKCiAgICAgICAgQHJldHVybiBzdW0KICAgICovCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7CiAgICAgICAgYXNzZXJ0KHogPj0gX3gpOwogICAgICAgIHJldHVybiB6OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcgoKICAgICAgICBAcGFyYW0gX3ggICBtaW51ZW5kCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZAoKICAgICAgICBAcmV0dXJuIGRpZmZlcmVuY2UKICAgICovCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChfeCA+PSBfeSk7CiAgICAgICAgcmV0dXJuIF94IC0gX3k7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBwcm9kdWN0IG9mIG11bHRpcGx5aW5nIF94IGJ5IF95LCBhc3NlcnRzIGlmIHRoZSBjYWxjdWxhdGlvbiBvdmVyZmxvd3MKCiAgICAgICAgQHBhcmFtIF94ICAgZmFjdG9yIDEKICAgICAgICBAcGFyYW0gX3kgICBmYWN0b3IgMgoKICAgICAgICBAcmV0dXJuIHByb2R1Y3QKICAgICovCiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICogX3k7CiAgICAgICAgYXNzZXJ0KF94ID09IDAgfHwgeiAvIF94ID09IF95KTsKICAgICAgICByZXR1cm4gejsKICAgIH0KfQoKLyoKICAgIEVSQzIwIFN0YW5kYXJkIFRva2VuIGludGVyZmFjZQoqLwpjb250cmFjdCBJRVJDMjBUb2tlbiB7CiAgICAvLyB0aGVzZSBmdW5jdGlvbnMgYXJlbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7fQogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7fQogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCkge30KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nikge30KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyBfb3duZXI7IH0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyBfb3duZXI7IF9zcGVuZGVyOyB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCgoKLyoKICAgIEJhbmNvciBRdWljayBDb252ZXJ0ZXIgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElCYW5jb3JRdWlja0NvbnZlcnRlciB7CiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGNvbnZlcnRGb3IoSUVSQzIwVG9rZW5bXSBfcGF0aCwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4sIGFkZHJlc3MgX2ZvcikgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludDI1Nik7Cn0KCgovKgogICAgQmFuY29yIEdhcyBQcmljZSBMaW1pdCBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUJhbmNvckdhc1ByaWNlTGltaXQgewogICAgZnVuY3Rpb24gZ2FzUHJpY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7fQp9CgoKLyoKICAgIEJhbmNvciBGb3JtdWxhIGludGVyZmFjZQoqLwpjb250cmFjdCBJQmFuY29yRm9ybXVsYSB7CiAgICBmdW5jdGlvbiBjYWxjdWxhdGVQdXJjaGFzZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX2Nvbm5lY3RvckJhbGFuY2UsIHVpbnQzMiBfY29ubmVjdG9yV2VpZ2h0LCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVNhbGVSZXR1cm4odWludDI1NiBfc3VwcGx5LCB1aW50MjU2IF9jb25uZWN0b3JCYWxhbmNlLCB1aW50MzIgX2Nvbm5lY3RvcldlaWdodCwgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7Cn0KCgoKCgovKgogICAgQmFuY29yIENvbnZlcnRlciBFeHRlbnNpb25zIGludGVyZmFjZQoqLwpjb250cmFjdCBJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyB7CiAgICBmdW5jdGlvbiBmb3JtdWxhKCkgcHVibGljIHZpZXcgcmV0dXJucyAoSUJhbmNvckZvcm11bGEpIHt9CiAgICBmdW5jdGlvbiBnYXNQcmljZUxpbWl0KCkgcHVibGljIHZpZXcgcmV0dXJucyAoSUJhbmNvckdhc1ByaWNlTGltaXQpIHt9CiAgICBmdW5jdGlvbiBxdWlja0NvbnZlcnRlcigpIHB1YmxpYyB2aWV3IHJldHVybnMgKElCYW5jb3JRdWlja0NvbnZlcnRlcikge30KfQoKCgovKgogICAgRUlQMjI4IFRva2VuIENvbnZlcnRlciBpbnRlcmZhY2UKKi8KY29udHJhY3QgSVRva2VuQ29udmVydGVyIHsKICAgIGZ1bmN0aW9uIGNvbnZlcnRpYmxlVG9rZW5Db3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQxNik7CiAgICBmdW5jdGlvbiBjb252ZXJ0aWJsZVRva2VuKHVpbnQxNiBfdG9rZW5JbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRSZXR1cm4oSUVSQzIwVG9rZW4gX2Zyb21Ub2tlbiwgSUVSQzIwVG9rZW4gX3RvVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpOwogICAgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpOwp9CgoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3QgbWFuYWdlbWVudAoqLwpjb250cmFjdCBNYW5hZ2VkIHsKICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdNYW5hZ2VyOwoKICAgIGV2ZW50IE1hbmFnZXJVcGRhdGUoYWRkcmVzcyBpbmRleGVkIF9wcmV2TWFuYWdlciwgYWRkcmVzcyBpbmRleGVkIF9uZXdNYW5hZ2VyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gTWFuYWdlZCgpIHB1YmxpYyB7CiAgICAgICAgbWFuYWdlciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgbWFuYWdlciBvbmx5CiAgICBtb2RpZmllciBtYW5hZ2VyT25seSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gbWFuYWdlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0cmFuc2ZlcnJpbmcgdGhlIGNvbnRyYWN0IG1hbmFnZW1lbnQKICAgICAgICB0aGUgbmV3IG1hbmFnZXIgc3RpbGwgbmVlZHMgdG8gYWNjZXB0IHRoZSB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3QgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX25ld01hbmFnZXIgICAgbmV3IGNvbnRyYWN0IG1hbmFnZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck1hbmFnZW1lbnQoYWRkcmVzcyBfbmV3TWFuYWdlcikgcHVibGljIG1hbmFnZXJPbmx5IHsKICAgICAgICByZXF1aXJlKF9uZXdNYW5hZ2VyICE9IG1hbmFnZXIpOwogICAgICAgIG5ld01hbmFnZXIgPSBfbmV3TWFuYWdlcjsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgbWFuYWdlciB0byBhY2NlcHQgYSBtYW5hZ2VtZW50IHRyYW5zZmVyCiAgICAqLwogICAgZnVuY3Rpb24gYWNjZXB0TWFuYWdlbWVudCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld01hbmFnZXIpOwogICAgICAgIE1hbmFnZXJVcGRhdGUobWFuYWdlciwgbmV3TWFuYWdlcik7CiAgICAgICAgbWFuYWdlciA9IG5ld01hbmFnZXI7CiAgICAgICAgbmV3TWFuYWdlciA9IGFkZHJlc3MoMCk7CiAgICB9Cn0KCgoKCgoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3Qgb3duZXJzaGlwCiovCmNvbnRyYWN0IE93bmVkIGlzIElPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgaW5kZXhlZCBfcHJldk93bmVyLCBhZGRyZXNzIGluZGV4ZWQgX25ld093bmVyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gT3duZWQoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIGJ5IHRoZSBvd25lciBvbmx5CiAgICBtb2RpZmllciBvd25lck9ubHkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgY29udHJhY3Qgb3duZXJzaGlwCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkcyB0byBhY2NlcHQgdGhlIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX25ld093bmVyICAgIG5ldyBjb250cmFjdCBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSBvd25lcik7CiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG93bmVyIHRvIGFjY2VwdCBhbiBvd25lcnNoaXAgdHJhbnNmZXIKICAgICovCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdPd25lcik7CiAgICAgICAgT3duZXJVcGRhdGUob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIG5ld093bmVyID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgfQp9CgoKLyoKICAgIFRva2VuIEhvbGRlciBpbnRlcmZhY2UKKi8KY29udHJhY3QgSVRva2VuSG9sZGVyIGlzIElPd25lZCB7CiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKCgovKgogICAgV2UgY29uc2lkZXIgZXZlcnkgY29udHJhY3QgdG8gYmUgYSAndG9rZW4gaG9sZGVyJyBzaW5jZSBpdCdzIGN1cnJlbnRseSBub3QgcG9zc2libGUKICAgIGZvciBhIGNvbnRyYWN0IHRvIGRlbnkgcmVjZWl2aW5nIHRva2Vucy4KCiAgICBUaGUgVG9rZW5Ib2xkZXIncyBjb250cmFjdCBzb2xlIHB1cnBvc2UgaXMgdG8gcHJvdmlkZSBhIHNhZmV0eSBtZWNoYW5pc20gdGhhdCBhbGxvd3MKICAgIHRoZSBvd25lciB0byBzZW5kIHRva2VucyB0aGF0IHdlcmUgc2VudCB0byB0aGUgY29udHJhY3QgYnkgbWlzdGFrZSBiYWNrIHRvIHRoZWlyIHNlbmRlci4KKi8KY29udHJhY3QgVG9rZW5Ib2xkZXIgaXMgSVRva2VuSG9sZGVyLCBPd25lZCwgVXRpbHMgewogICAgLyoqCiAgICAgICAgQGRldiBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFRva2VuSG9sZGVyKCkgcHVibGljIHsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHdpdGhkcmF3cyB0b2tlbnMgaGVsZCBieSB0aGUgY29udHJhY3QgYW5kIHNlbmRzIHRoZW0gdG8gYW4gYWNjb3VudAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKCiAgICAgICAgQHBhcmFtIF90b2tlbiAgIEVSQzIwIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3RvICAgICAgYWNjb3VudCB0byByZWNlaXZlIHRoZSBuZXcgYW1vdW50CiAgICAgICAgQHBhcmFtIF9hbW91bnQgIGFtb3VudCB0byB3aXRoZHJhdwogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pCiAgICAgICAgbm90VGhpcyhfdG8pCiAgICB7CiAgICAgICAgYXNzZXJ0KF90b2tlbi50cmFuc2ZlcihfdG8sIF9hbW91bnQpKTsKICAgIH0KfQoKCgovKgogICAgVGhlIHNtYXJ0IHRva2VuIGNvbnRyb2xsZXIgaXMgYW4gdXBncmFkYWJsZSBwYXJ0IG9mIHRoZSBzbWFydCB0b2tlbiB0aGF0IGFsbG93cwogICAgbW9yZSBmdW5jdGlvbmFsaXR5IGFzIHdlbGwgYXMgZml4ZXMgZm9yIGJ1Z3MvZXhwbG9pdHMuCiAgICBPbmNlIGl0IGFjY2VwdHMgb3duZXJzaGlwIG9mIHRoZSB0b2tlbiwgaXQgYmVjb21lcyB0aGUgdG9rZW4ncyBzb2xlIGNvbnRyb2xsZXIKICAgIHRoYXQgY2FuIGV4ZWN1dGUgYW55IG9mIGl0cyBmdW5jdGlvbnMuCgogICAgVG8gdXBncmFkZSB0aGUgY29udHJvbGxlciwgb3duZXJzaGlwIG11c3QgYmUgdHJhbnNmZXJyZWQgdG8gYSBuZXcgY29udHJvbGxlciwgYWxvbmcgd2l0aAogICAgYW55IHJlbGV2YW50IGRhdGEuCgogICAgVGhlIHNtYXJ0IHRva2VuIG11c3QgYmUgc2V0IG9uIGNvbnN0cnVjdGlvbiBhbmQgY2Fubm90IGJlIGNoYW5nZWQgYWZ0ZXJ3YXJkcy4KICAgIFdyYXBwZXJzIGFyZSBwcm92aWRlZCAoYXMgb3Bwb3NlZCB0byBhIHNpbmdsZSAnZXhlY3V0ZScgZnVuY3Rpb24pIGZvciBlYWNoIG9mIHRoZSB0b2tlbidzIGZ1bmN0aW9ucywgZm9yIGVhc2llciBhY2Nlc3MuCgogICAgTm90ZSB0aGF0IHRoZSBjb250cm9sbGVyIGNhbiB0cmFuc2ZlciB0b2tlbiBvd25lcnNoaXAgdG8gYSBuZXcgY29udHJvbGxlciB0aGF0CiAgICBkb2Vzbid0IGFsbG93IGV4ZWN1dGluZyBhbnkgZnVuY3Rpb24gb24gdGhlIHRva2VuLCBmb3IgYSB0cnVzdGxlc3Mgc29sdXRpb24uCiAgICBEb2luZyB0aGF0IHdpbGwgYWxzbyByZW1vdmUgdGhlIG93bmVyJ3MgYWJpbGl0eSB0byB1cGdyYWRlIHRoZSBjb250cm9sbGVyLgoqLwpjb250cmFjdCBTbWFydFRva2VuQ29udHJvbGxlciBpcyBUb2tlbkhvbGRlciB7CiAgICBJU21hcnRUb2tlbiBwdWJsaWMgdG9rZW47ICAgLy8gc21hcnQgdG9rZW4KCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gU21hcnRUb2tlbkNvbnRyb2xsZXIoSVNtYXJ0VG9rZW4gX3Rva2VuKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICB7CiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICB9CgogICAgLy8gZW5zdXJlcyB0aGF0IHRoZSBjb250cm9sbGVyIGlzIHRoZSB0b2tlbidzIG93bmVyCiAgICBtb2RpZmllciBhY3RpdmUoKSB7CiAgICAgICAgYXNzZXJ0KHRva2VuLm93bmVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIGNvbnRyb2xsZXIgaXMgbm90IHRoZSB0b2tlbidzIG93bmVyCiAgICBtb2RpZmllciBpbmFjdGl2ZSgpIHsKICAgICAgICBhc3NlcnQodG9rZW4ub3duZXIoKSAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgdG9rZW4gb3duZXJzaGlwCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IHRva2VuIG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJUb2tlbk93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgb3duZXIgdG8gYWNjZXB0IGEgdG9rZW4gb3duZXJzaGlwIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdFRva2VuT3duZXJzaGlwKCkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4uYWNjZXB0T3duZXJzaGlwKCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcy9lbmFibGVzIHRva2VuIHRyYW5zZmVycwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgIHRydWUgdG8gZGlzYWJsZSB0cmFuc2ZlcnMsIGZhbHNlIHRvIGVuYWJsZSB0aGVtCiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLmRpc2FibGVUcmFuc2ZlcnMoX2Rpc2FibGUpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgd2l0aGRyYXdzIHRva2VucyBoZWxkIGJ5IHRoZSBjb250cm9sbGVyIGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0Zyb21Ub2tlbigKICAgICAgICBJRVJDMjBUb2tlbiBfdG9rZW4sIAogICAgICAgIGFkZHJlc3MgX3RvLCAKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICkgCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICB7CiAgICAgICAgSVRva2VuSG9sZGVyKHRva2VuKS53aXRoZHJhd1Rva2VucyhfdG9rZW4sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlVG9rZW5Pd25lcihhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgIHRva2VuLmNoYW5nZU93bmVyKF9uZXdPd25lcik7CiAgICB9Cn0KCgoKCgoKCgoKCgovKgogICAgU21hcnQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElPd25lZCwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgoKCgoKCgoKCgoKLyoKICAgIEV0aGVyIFRva2VuIGludGVyZmFjZQoqLwpjb250cmFjdCBJRXRoZXJUb2tlbiBpcyBJVG9rZW5Ib2xkZXIsIElFUkMyMFRva2VuIHsKICAgIGZ1bmN0aW9uIGRlcG9zaXQoKSBwdWJsaWMgcGF5YWJsZTsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwogICAgZnVuY3Rpb24gd2l0aGRyYXdUbyhhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7Cn0KCgovKgogICAgQmFuY29yIENvbnZlcnRlciB2MC43CgogICAgVGhlIEJhbmNvciB2ZXJzaW9uIG9mIHRoZSB0b2tlbiBjb252ZXJ0ZXIsIGFsbG93cyBjb252ZXJzaW9uIGJldHdlZW4gYSBzbWFydCB0b2tlbiBhbmQgb3RoZXIgRVJDMjAgdG9rZW5zIGFuZCBiZXR3ZWVuIGRpZmZlcmVudCBFUkMyMCB0b2tlbnMgYW5kIHRoZW1zZWx2ZXMuCgogICAgRVJDMjAgY29ubmVjdG9yIGJhbGFuY2UgY2FuIGJlIHZpcnR1YWwsIG1lYW5pbmcgdGhhdCB0aGUgY2FsY3VsYXRpb25zIGFyZSBiYXNlZCBvbiB0aGUgdmlydHVhbCBiYWxhbmNlIGluc3RlYWQgb2YgcmVseWluZyBvbgogICAgdGhlIGFjdHVhbCBjb25uZWN0b3IgYmFsYW5jZS4gVGhpcyBpcyBhIHNlY3VyaXR5IG1lY2hhbmlzbSB0aGF0IHByZXZlbnRzIHRoZSBuZWVkIHRvIGtlZXAgYSB2ZXJ5IGxhcmdlIChhbmQgdmFsdWFibGUpIGJhbGFuY2UgaW4gYSBzaW5nbGUgY29udHJhY3QuCgogICAgVGhlIGNvbnZlcnRlciBpcyB1cGdyYWRhYmxlIChqdXN0IGxpa2UgYW55IFNtYXJ0VG9rZW5Db250cm9sbGVyKS4KCiAgICBXQVJOSU5HOiBJdCBpcyBOT1QgUkVDT01NRU5ERUQgdG8gdXNlIHRoZSBjb252ZXJ0ZXIgd2l0aCBTbWFydCBUb2tlbnMgdGhhdCBoYXZlIGxlc3MgdGhhbiA4IGRlY2ltYWwgZGlnaXRzCiAgICAgICAgICAgICBvciB3aXRoIHZlcnkgc21hbGwgbnVtYmVycyBiZWNhdXNlIG9mIHByZWNpc2lvbiBsb3NzCgoKICAgIE9wZW4gaXNzdWVzOgogICAgLSBGcm9udC1ydW5uaW5nIGF0dGFja3MgYXJlIGN1cnJlbnRseSBtaXRpZ2F0ZWQgYnkgdGhlIGZvbGxvd2luZyBtZWNoYW5pc21zOgogICAgICAgIC0gbWluaW11bSByZXR1cm4gYXJndW1lbnQgZm9yIGVhY2ggY29udmVyc2lvbiBwcm92aWRlcyBhIHdheSB0byBkZWZpbmUgYSBtaW5pbXVtL21heGltdW0gcHJpY2UgZm9yIHRoZSB0cmFuc2FjdGlvbgogICAgICAgIC0gZ2FzIHByaWNlIGxpbWl0IHByZXZlbnRzIHVzZXJzIGZyb20gaGF2aW5nIGNvbnRyb2wgb3ZlciB0aGUgb3JkZXIgb2YgZXhlY3V0aW9uCiAgICAgIE90aGVyIHBvdGVudGlhbCBzb2x1dGlvbnMgbWlnaHQgaW5jbHVkZSBhIGNvbW1pdC9yZXZlYWwgYmFzZWQgc2NoZW1lcwogICAgLSBQb3NzaWJseSBhZGQgZ2V0dGVycyBmb3IgdGhlIGNvbm5lY3RvciBmaWVsZHMgc28gdGhhdCB0aGUgY2xpZW50IHdvbid0IG5lZWQgdG8gcmVseSBvbiB0aGUgb3JkZXIgaW4gdGhlIHN0cnVjdAoqLwpjb250cmFjdCBCYW5jb3JDb252ZXJ0ZXIgaXMgSVRva2VuQ29udmVydGVyLCBTbWFydFRva2VuQ29udHJvbGxlciwgTWFuYWdlZCB7CiAgICB1aW50MzIgcHJpdmF0ZSBjb25zdGFudCBNQVhfV0VJR0hUID0gMTAwMDAwMDsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9DT05WRVJTSU9OX0ZFRSA9IDEwMDAwMDA7CgogICAgc3RydWN0IENvbm5lY3RvciB7CiAgICAgICAgdWludDI1NiB2aXJ0dWFsQmFsYW5jZTsgICAgICAgICAvLyBjb25uZWN0b3IgdmlydHVhbCBiYWxhbmNlCiAgICAgICAgdWludDMyIHdlaWdodDsgICAgICAgICAgICAgICAgICAvLyBjb25uZWN0b3Igd2VpZ2h0LCByZXByZXNlbnRlZCBpbiBwcG0sIDEtMTAwMDAwMAogICAgICAgIGJvb2wgaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQ7ICAgLy8gdHJ1ZSBpZiB2aXJ0dWFsIGJhbGFuY2UgaXMgZW5hYmxlZCwgZmFsc2UgaWYgbm90CiAgICAgICAgYm9vbCBpc1B1cmNoYXNlRW5hYmxlZDsgICAgICAgICAvLyBpcyBwdXJjaGFzZSBvZiB0aGUgc21hcnQgdG9rZW4gZW5hYmxlZCB3aXRoIHRoZSBjb25uZWN0b3IsIGNhbiBiZSBzZXQgYnkgdGhlIG93bmVyCiAgICAgICAgYm9vbCBpc1NldDsgICAgICAgICAgICAgICAgICAgICAvLyB1c2VkIHRvIHRlbGwgaWYgdGhlIG1hcHBpbmcgZWxlbWVudCBpcyBkZWZpbmVkCiAgICB9CgogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJzAuNyc7CiAgICBzdHJpbmcgcHVibGljIGNvbnZlcnRlclR5cGUgPSAnYmFuY29yJzsKCiAgICBJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyBwdWJsaWMgZXh0ZW5zaW9uczsgICAgICAgLy8gYmFuY29yIGNvbnZlcnRlciBleHRlbnNpb25zIGNvbnRyYWN0CiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyBjb25uZWN0b3JUb2tlbnM7ICAgICAgICAgICAgICAgLy8gRVJDMjAgc3RhbmRhcmQgdG9rZW4gYWRkcmVzc2VzCiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyBxdWlja0J1eVBhdGg7ICAgICAgICAgICAgICAgICAgLy8gY29udmVyc2lvbiBwYXRoIHRoYXQncyB1c2VkIGluIG9yZGVyIHRvIGJ1eSB0aGUgdG9rZW4gd2l0aCBFVEgKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ29ubmVjdG9yKSBwdWJsaWMgY29ubmVjdG9yczsgICAvLyBjb25uZWN0b3IgdG9rZW4gYWRkcmVzc2VzIC0+IGNvbm5lY3RvciBkYXRhCiAgICB1aW50MzIgcHJpdmF0ZSB0b3RhbENvbm5lY3RvcldlaWdodCA9IDA7ICAgICAgICAgICAgLy8gdXNlZCB0byBlZmZpY2llbnRseSBwcmV2ZW50IGluY3JlYXNpbmcgdGhlIHRvdGFsIGNvbm5lY3RvciB3ZWlnaHQgYWJvdmUgMTAwJQogICAgdWludDMyIHB1YmxpYyBtYXhDb252ZXJzaW9uRmVlID0gMDsgICAgICAgICAgICAgICAgIC8vIG1heGltdW0gY29udmVyc2lvbiBmZWUgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgY29udHJhY3QsIHJlcHJlc2VudGVkIGluIHBwbSwgMC4uLjEwMDAwMDAgKDAgPSBubyBmZWUsIDEwMCA9IDAuMDElLCAxMDAwMDAwID0gMTAwJSkKICAgIHVpbnQzMiBwdWJsaWMgY29udmVyc2lvbkZlZSA9IDA7ICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0sIDAuLi5tYXhDb252ZXJzaW9uRmVlCiAgICBib29sIHB1YmxpYyBjb252ZXJzaW9uc0VuYWJsZWQgPSB0cnVlOyAgICAgICAgICAgICAgLy8gdHJ1ZSBpZiB0b2tlbiBjb252ZXJzaW9ucyBpcyBlbmFibGVkLCBmYWxzZSBpZiBub3QKCiAgICAvLyB0cmlnZ2VyZWQgd2hlbiBhIGNvbnZlcnNpb24gYmV0d2VlbiB0d28gdG9rZW5zIG9jY3VycyAoVG9rZW5Db252ZXJ0ZXIgZXZlbnQpCiAgICBldmVudCBDb252ZXJzaW9uKGFkZHJlc3MgaW5kZXhlZCBfZnJvbVRva2VuLCBhZGRyZXNzIGluZGV4ZWQgX3RvVG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfdHJhZGVyLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3JldHVybiwKICAgICAgICAgICAgICAgICAgICAgaW50MjU2IF9jb252ZXJzaW9uRmVlLCB1aW50MjU2IF9jdXJyZW50UHJpY2VOLCB1aW50MjU2IF9jdXJyZW50UHJpY2VEKTsKICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSBjb252ZXJzaW9uIGZlZSBpcyB1cGRhdGVkCiAgICBldmVudCBDb252ZXJzaW9uRmVlVXBkYXRlKHVpbnQzMiBfcHJldkZlZSwgdWludDMyIF9uZXdGZWUpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKCiAgICAgICAgQHBhcmFtICBfdG9rZW4gICAgICAgICAgICAgIHNtYXJ0IHRva2VuIGdvdmVybmVkIGJ5IHRoZSBjb252ZXJ0ZXIKICAgICAgICBAcGFyYW0gIF9leHRlbnNpb25zICAgICAgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBjb252ZXJ0ZXIgZXh0ZW5zaW9ucyBjb250cmFjdAogICAgICAgIEBwYXJhbSAgX21heENvbnZlcnNpb25GZWUgICBtYXhpbXVtIGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICAgICBAcGFyYW0gIF9jb25uZWN0b3JUb2tlbiAgICAgb3B0aW9uYWwsIGluaXRpYWwgY29ubmVjdG9yLCBhbGxvd3MgZGVmaW5pbmcgdGhlIGZpcnN0IGNvbm5lY3RvciBhdCBkZXBsb3ltZW50IHRpbWUKICAgICAgICBAcGFyYW0gIF9jb25uZWN0b3JXZWlnaHQgICAgb3B0aW9uYWwsIHdlaWdodCBmb3IgdGhlIGluaXRpYWwgY29ubmVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yQ29udmVydGVyKElTbWFydFRva2VuIF90b2tlbiwgSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgX2V4dGVuc2lvbnMsIHVpbnQzMiBfbWF4Q29udmVyc2lvbkZlZSwgSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MzIgX2Nvbm5lY3RvcldlaWdodCkKICAgICAgICBwdWJsaWMKICAgICAgICBTbWFydFRva2VuQ29udHJvbGxlcihfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF9leHRlbnNpb25zKQogICAgICAgIHZhbGlkTWF4Q29udmVyc2lvbkZlZShfbWF4Q29udmVyc2lvbkZlZSkKICAgIHsKICAgICAgICBleHRlbnNpb25zID0gX2V4dGVuc2lvbnM7CiAgICAgICAgbWF4Q29udmVyc2lvbkZlZSA9IF9tYXhDb252ZXJzaW9uRmVlOwoKICAgICAgICBpZiAoX2Nvbm5lY3RvclRva2VuICE9IGFkZHJlc3MoMCkpCiAgICAgICAgICAgIGFkZENvbm5lY3RvcihfY29ubmVjdG9yVG9rZW4sIF9jb25uZWN0b3JXZWlnaHQsIGZhbHNlKTsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSBjb25uZWN0b3IgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIGNvbm5lY3RvciB0b2tlbnMKICAgIG1vZGlmaWVyIHZhbGlkQ29ubmVjdG9yKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShjb25uZWN0b3JzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgY29udmVydGlibGUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFRva2VuKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSB0b2tlbiB8fCBjb25uZWN0b3JzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2ZXJpZmllcyB0aGF0IHRoZSBnYXMgcHJpY2UgaXMgbG93ZXIgdGhhbiB0aGUgdW5pdmVyc2FsIGxpbWl0CiAgICBtb2RpZmllciB2YWxpZEdhc1ByaWNlKCkgewogICAgICAgIGFzc2VydCh0eC5nYXNwcmljZSA8PSBleHRlbnNpb25zLmdhc1ByaWNlTGltaXQoKS5nYXNQcmljZSgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHZhbGlkYXRlcyBtYXhpbXVtIGNvbnZlcnNpb24gZmVlCiAgICBtb2RpZmllciB2YWxpZE1heENvbnZlcnNpb25GZWUodWludDMyIF9jb252ZXJzaW9uRmVlKSB7CiAgICAgICAgcmVxdWlyZShfY29udmVyc2lvbkZlZSA+PSAwICYmIF9jb252ZXJzaW9uRmVlIDw9IE1BWF9DT05WRVJTSU9OX0ZFRSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgY29udmVyc2lvbiBmZWUKICAgIG1vZGlmaWVyIHZhbGlkQ29udmVyc2lvbkZlZSh1aW50MzIgX2NvbnZlcnNpb25GZWUpIHsKICAgICAgICByZXF1aXJlKF9jb252ZXJzaW9uRmVlID49IDAgJiYgX2NvbnZlcnNpb25GZWUgPD0gbWF4Q29udmVyc2lvbkZlZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgY29ubmVjdG9yIHdlaWdodCByYW5nZQogICAgbW9kaWZpZXIgdmFsaWRDb25uZWN0b3JXZWlnaHQodWludDMyIF93ZWlnaHQpIHsKICAgICAgICByZXF1aXJlKF93ZWlnaHQgPiAwICYmIF93ZWlnaHQgPD0gTUFYX1dFSUdIVCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSBjb252ZXJzaW9uIHBhdGggLSB2ZXJpZmllcyB0aGF0IHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaXMgb2RkIGFuZCB0aGF0IG1heGltdW0gbnVtYmVyIG9mICdob3BzJyBpcyAxMAogICAgbW9kaWZpZXIgdmFsaWRDb252ZXJzaW9uUGF0aChJRVJDMjBUb2tlbltdIF9wYXRoKSB7CiAgICAgICAgcmVxdWlyZShfcGF0aC5sZW5ndGggPiAyICYmIF9wYXRoLmxlbmd0aCA8PSAoMSArIDIgKiAxMCkgJiYgX3BhdGgubGVuZ3RoICUgMiA9PSAxKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gb25seSB3aGVuIGNvbnZlcnNpb25zIGFyZW4ndCBkaXNhYmxlZAogICAgbW9kaWZpZXIgY29udmVyc2lvbnNBbGxvd2VkIHsKICAgICAgICBhc3NlcnQoY29udmVyc2lvbnNFbmFibGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gb25seSBmb3Igb3duZXIgb3IgbWFuYWdlcgogICAgbW9kaWZpZXIgb3duZXJPck1hbmFnZXJPbmx5IHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSBtYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbnVtYmVyIG9mIGNvbm5lY3RvciB0b2tlbnMgZGVmaW5lZAoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjb25uZWN0b3IgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gY29ubmVjdG9yVG9rZW5Db3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQxNikgewogICAgICAgIHJldHVybiB1aW50MTYoY29ubmVjdG9yVG9rZW5zLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBudW1iZXIgb2YgY29udmVydGlibGUgdG9rZW5zIHN1cHBvcnRlZCBieSB0aGUgY29udHJhY3QKICAgICAgICBub3RlIHRoYXQgdGhlIG51bWJlciBvZiBjb252ZXJ0aWJsZSB0b2tlbnMgaXMgdGhlIG51bWJlciBvZiBjb25uZWN0b3IgdG9rZW4sIHBsdXMgMSAodGhhdCByZXByZXNlbnRzIHRoZSBzbWFydCB0b2tlbikKCiAgICAgICAgQHJldHVybiBudW1iZXIgb2YgY29udmVydGlibGUgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbkNvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgcmV0dXJuIGNvbm5lY3RvclRva2VuQ291bnQoKSArIDE7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBnaXZlbiBhIGNvbnZlcnRpYmxlIHRva2VuIGluZGV4LCByZXR1cm5zIGl0cyBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfdG9rZW5JbmRleCAgY29udmVydGlibGUgdG9rZW4gaW5kZXgKCiAgICAgICAgQHJldHVybiBjb252ZXJ0aWJsZSB0b2tlbiBhZGRyZXNzCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3Rva2VuSW5kZXggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRva2VuOwogICAgICAgIHJldHVybiBjb25uZWN0b3JUb2tlbnNbX3Rva2VuSW5kZXggLSAxXTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIGV4dGVuc2lvbnMgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2V4dGVuc2lvbnMgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBjb252ZXJ0ZXIgZXh0ZW5zaW9ucyBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEV4dGVuc2lvbnMoSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgX2V4dGVuc2lvbnMpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF9leHRlbnNpb25zKQogICAgICAgIG5vdFRoaXMoX2V4dGVuc2lvbnMpCiAgICB7CiAgICAgICAgZXh0ZW5zaW9ucyA9IF9leHRlbnNpb25zOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG1hbmFnZXIgdG8gdXBkYXRlIHRoZSBxdWljayBidXkgcGF0aAoKICAgICAgICBAcGFyYW0gX3BhdGggICAgbmV3IHF1aWNrIGJ1eSBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBpbiB0aGUgQmFuY29yUXVpY2tDb252ZXJ0ZXIgY29udHJhY3QKICAgICovCiAgICBmdW5jdGlvbiBzZXRRdWlja0J1eVBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZENvbnZlcnNpb25QYXRoKF9wYXRoKQogICAgewogICAgICAgIHF1aWNrQnV5UGF0aCA9IF9wYXRoOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG1hbmFnZXIgdG8gY2xlYXIgdGhlIHF1aWNrIGJ1eSBwYXRoCiAgICAqLwogICAgZnVuY3Rpb24gY2xlYXJRdWlja0J1eVBhdGgoKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICBxdWlja0J1eVBhdGgubGVuZ3RoID0gMDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgcXVpY2sgYnV5IHBhdGggYXJyYXkKCiAgICAgICAgQHJldHVybiBxdWljayBidXkgcGF0aCBsZW5ndGgKICAgICovCiAgICBmdW5jdGlvbiBnZXRRdWlja0J1eVBhdGhMZW5ndGgoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHF1aWNrQnV5UGF0aC5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcyB0aGUgZW50aXJlIGNvbnZlcnNpb24gZnVuY3Rpb25hbGl0eQogICAgICAgIHRoaXMgaXMgYSBzYWZldHkgbWVjaGFuaXNtIGluIGNhc2Ugb2YgYSBlbWVyZ2VuY3kKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlIHRydWUgdG8gZGlzYWJsZSBjb252ZXJzaW9ucywgZmFsc2UgdG8gcmUtZW5hYmxlIHRoZW0KICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQ29udmVyc2lvbnMoYm9vbCBfZGlzYWJsZSkgcHVibGljIG93bmVyT3JNYW5hZ2VyT25seSB7CiAgICAgICAgY29udmVyc2lvbnNFbmFibGVkID0gIV9kaXNhYmxlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXBkYXRlcyB0aGUgY3VycmVudCBjb252ZXJzaW9uIGZlZQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX2NvbnZlcnNpb25GZWUgbmV3IGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICovCiAgICBmdW5jdGlvbiBzZXRDb252ZXJzaW9uRmVlKHVpbnQzMiBfY29udmVyc2lvbkZlZSkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9yTWFuYWdlck9ubHkKICAgICAgICB2YWxpZENvbnZlcnNpb25GZWUoX2NvbnZlcnNpb25GZWUpCiAgICB7CiAgICAgICAgQ29udmVyc2lvbkZlZVVwZGF0ZShjb252ZXJzaW9uRmVlLCBfY29udmVyc2lvbkZlZSk7CiAgICAgICAgY29udmVyc2lvbkZlZSA9IF9jb252ZXJzaW9uRmVlOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBjb252ZXJzaW9uIGZlZSBhbW91bnQgZm9yIGEgZ2l2ZW4gcmV0dXJuIGFtb3VudAoKICAgICAgICBAcmV0dXJuIGNvbnZlcnNpb24gZmVlIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGdldENvbnZlcnNpb25GZWVBbW91bnQodWludDI1NiBfYW1vdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2Ftb3VudCwgY29udmVyc2lvbkZlZSkgLyBNQVhfQ09OVkVSU0lPTl9GRUU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkZWZpbmVzIGEgbmV3IGNvbm5lY3RvciBmb3IgdGhlIHRva2VuCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciB3aGlsZSB0aGUgY29udmVydGVyIGlzIGluYWN0aXZlCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICBhZGRyZXNzIG9mIHRoZSBjb25uZWN0b3IgdG9rZW4KICAgICAgICBAcGFyYW0gX3dlaWdodCAgICAgICAgICAgICAgICAgY29uc3RhbnQgY29ubmVjdG9yIHdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgY29ubmVjdG9yLCBmYWxzZSB0byBkaXNhYmxlIGl0CiAgICAqLwogICAgZnVuY3Rpb24gYWRkQ29ubmVjdG9yKElFUkMyMFRva2VuIF90b2tlbiwgdWludDMyIF93ZWlnaHQsIGJvb2wgX2VuYWJsZVZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIGluYWN0aXZlCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICBub3RUaGlzKF90b2tlbikKICAgICAgICB2YWxpZENvbm5lY3RvcldlaWdodChfd2VpZ2h0KQogICAgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IHRva2VuICYmICFjb25uZWN0b3JzW190b2tlbl0uaXNTZXQgJiYgdG90YWxDb25uZWN0b3JXZWlnaHQgKyBfd2VpZ2h0IDw9IE1BWF9XRUlHSFQpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICBjb25uZWN0b3JzW190b2tlbl0udmlydHVhbEJhbGFuY2UgPSAwOwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS53ZWlnaHQgPSBfd2VpZ2h0OwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCA9IF9lbmFibGVWaXJ0dWFsQmFsYW5jZTsKICAgICAgICBjb25uZWN0b3JzW190b2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSB0cnVlOwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS5pc1NldCA9IHRydWU7CiAgICAgICAgY29ubmVjdG9yVG9rZW5zLnB1c2goX3Rva2VuKTsKICAgICAgICB0b3RhbENvbm5lY3RvcldlaWdodCArPSBfd2VpZ2h0OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXBkYXRlcyBvbmUgb2YgdGhlIHRva2VuIGNvbm5lY3RvcnMKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gICAgICAgICBhZGRyZXNzIG9mIHRoZSBjb25uZWN0b3IgdG9rZW4KICAgICAgICBAcGFyYW0gX3dlaWdodCAgICAgICAgICAgICAgICAgY29uc3RhbnQgY29ubmVjdG9yIHdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgY29ubmVjdG9yLCBmYWxzZSB0byBkaXNhYmxlIGl0CiAgICAgICAgQHBhcmFtIF92aXJ0dWFsQmFsYW5jZSAgICAgICAgIG5ldyBjb25uZWN0b3IncyB2aXJ0dWFsIGJhbGFuY2UKICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDb25uZWN0b3IoSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MzIgX3dlaWdodCwgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UsIHVpbnQyNTYgX3ZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQ29ubmVjdG9yKF9jb25uZWN0b3JUb2tlbikKICAgICAgICB2YWxpZENvbm5lY3RvcldlaWdodChfd2VpZ2h0KQogICAgewogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICByZXF1aXJlKHRvdGFsQ29ubmVjdG9yV2VpZ2h0IC0gY29ubmVjdG9yLndlaWdodCArIF93ZWlnaHQgPD0gTUFYX1dFSUdIVCk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIHRvdGFsQ29ubmVjdG9yV2VpZ2h0ID0gdG90YWxDb25uZWN0b3JXZWlnaHQgLSBjb25uZWN0b3Iud2VpZ2h0ICsgX3dlaWdodDsKICAgICAgICBjb25uZWN0b3Iud2VpZ2h0ID0gX3dlaWdodDsKICAgICAgICBjb25uZWN0b3IuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7CiAgICAgICAgY29ubmVjdG9yLnZpcnR1YWxCYWxhbmNlID0gX3ZpcnR1YWxCYWxhbmNlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGlzYWJsZXMgcHVyY2hhc2luZyB3aXRoIHRoZSBnaXZlbiBjb25uZWN0b3IgdG9rZW4gaW4gY2FzZSB0aGUgY29ubmVjdG9yIHRva2VuIGdvdCBjb21wcm9taXNlZAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgICAgICBub3RlIHRoYXQgc2VsbGluZyBpcyBzdGlsbCBlbmFibGVkIHJlZ2FyZGxlc3Mgb2YgdGhpcyBmbGFnIGFuZCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgICAgICAgdHJ1ZSB0byBkaXNhYmxlIHRoZSB0b2tlbiwgZmFsc2UgdG8gcmUtZW5hYmxlIGl0CiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZUNvbm5lY3RvclB1cmNoYXNlcyhJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIGJvb2wgX2Rpc2FibGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgewogICAgICAgIGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXS5pc1B1cmNoYXNlRW5hYmxlZCA9ICFfZGlzYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGNvbm5lY3RvcidzIHZpcnR1YWwgYmFsYW5jZSBpZiBvbmUgaXMgZGVmaW5lZCwgb3RoZXJ3aXNlIHJldHVybnMgdGhlIGFjdHVhbCBiYWxhbmNlCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gY29ubmVjdG9yIGJhbGFuY2UKICAgICovCiAgICBmdW5jdGlvbiBnZXRDb25uZWN0b3JCYWxhbmNlKElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQ29ubmVjdG9yIHN0b3JhZ2UgY29ubmVjdG9yID0gY29ubmVjdG9yc1tfY29ubmVjdG9yVG9rZW5dOwogICAgICAgIHJldHVybiBjb25uZWN0b3IuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPyBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgOiBfY29ubmVjdG9yVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBjb252ZXJ0aW5nIGEgc3BlY2lmaWMgYW1vdW50IG9mIF9mcm9tVG9rZW4gdG8gX3RvVG9rZW4KCiAgICAgICAgQHBhcmFtIF9mcm9tVG9rZW4gIEVSQzIwIHRva2VuIHRvIGNvbnZlcnQgZnJvbQogICAgICAgIEBwYXJhbSBfdG9Ub2tlbiAgICBFUkMyMCB0b2tlbiB0byBjb252ZXJ0IHRvCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBjb252ZXJ0LCBpbiBmcm9tVG9rZW4KCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBjb252ZXJzaW9uIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRSZXR1cm4oSUVSQzIwVG9rZW4gX2Zyb21Ub2tlbiwgSUVSQzIwVG9rZW4gX3RvVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2Zyb21Ub2tlbiAhPSBfdG9Ub2tlbik7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIC8vIGNvbnZlcnNpb24gYmV0d2VlbiB0aGUgdG9rZW4gYW5kIG9uZSBvZiBpdHMgY29ubmVjdG9ycwogICAgICAgIGlmIChfdG9Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGdldFB1cmNoYXNlUmV0dXJuKF9mcm9tVG9rZW4sIF9hbW91bnQpOwogICAgICAgIGVsc2UgaWYgKF9mcm9tVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBfYW1vdW50KTsKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIDIgY29ubmVjdG9ycwogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VSZXR1cm5BbW91bnQgPSBnZXRQdXJjaGFzZVJldHVybihfZnJvbVRva2VuLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gZ2V0U2FsZVJldHVybihfdG9Ub2tlbiwgcHVyY2hhc2VSZXR1cm5BbW91bnQsIHNhZmVBZGQodG9rZW4udG90YWxTdXBwbHkoKSwgcHVyY2hhc2VSZXR1cm5BbW91bnQpKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3IgYnV5aW5nIHRoZSB0b2tlbiBmb3IgYSBjb25uZWN0b3IgdG9rZW4KCiAgICAgICAgQHBhcmFtIF9jb25uZWN0b3JUb2tlbiAgY29ubmVjdG9yIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgICBhbW91bnQgdG8gZGVwb3NpdCAoaW4gdGhlIGNvbm5lY3RvciB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBwdXJjaGFzZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHVyY2hhc2VSZXR1cm4oSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICBhY3RpdmUKICAgICAgICB2YWxpZENvbm5lY3RvcihfY29ubmVjdG9yVG9rZW4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBDb25uZWN0b3Igc3RvcmFnZSBjb25uZWN0b3IgPSBjb25uZWN0b3JzW19jb25uZWN0b3JUb2tlbl07CiAgICAgICAgcmVxdWlyZShjb25uZWN0b3IuaXNQdXJjaGFzZUVuYWJsZWQpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB1aW50MjU2IHRva2VuU3VwcGx5ID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IGNvbm5lY3RvckJhbGFuY2UgPSBnZXRDb25uZWN0b3JCYWxhbmNlKF9jb25uZWN0b3JUb2tlbik7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBleHRlbnNpb25zLmZvcm11bGEoKS5jYWxjdWxhdGVQdXJjaGFzZVJldHVybih0b2tlblN1cHBseSwgY29ubmVjdG9yQmFsYW5jZSwgY29ubmVjdG9yLndlaWdodCwgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyBkZWR1Y3QgdGhlIGZlZSBmcm9tIHRoZSByZXR1cm4gYW1vdW50CiAgICAgICAgdWludDI1NiBmZWVBbW91bnQgPSBnZXRDb252ZXJzaW9uRmVlQW1vdW50KGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHNhZmVTdWIoYW1vdW50LCBmZWVBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBzYWxlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRTYWxlUmV0dXJuKElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbiwgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF9jb25uZWN0b3JUb2tlbiwgX3NlbGxBbW91bnQsIHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgYSBzcGVjaWZpYyBhbW91bnQgb2YgX2Zyb21Ub2tlbiB0byBfdG9Ub2tlbgoKICAgICAgICBAcGFyYW0gX2Zyb21Ub2tlbiAgRVJDMjAgdG9rZW4gdG8gY29udmVydCBmcm9tCiAgICAgICAgQHBhcmFtIF90b1Rva2VuICAgIEVSQzIwIHRva2VuIHRvIGNvbnZlcnQgdG8KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGNvbnZlcnQsIGluIGZyb21Ub2tlbgogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBjb252ZXJzaW9uIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9mcm9tVG9rZW4gIT0gX3RvVG9rZW4pOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICAvLyBjb252ZXJzaW9uIGJldHdlZW4gdGhlIHRva2VuIGFuZCBvbmUgb2YgaXRzIGNvbm5lY3RvcnMKICAgICAgICBpZiAoX3RvVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBidXkoX2Zyb21Ub2tlbiwgX2Ftb3VudCwgX21pblJldHVybik7CiAgICAgICAgZWxzZSBpZiAoX2Zyb21Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIHNlbGwoX3RvVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwoKICAgICAgICAvLyBjb252ZXJzaW9uIGJldHdlZW4gMiBjb25uZWN0b3JzCiAgICAgICAgdWludDI1NiBwdXJjaGFzZUFtb3VudCA9IGJ1eShfZnJvbVRva2VuLCBfYW1vdW50LCAxKTsKICAgICAgICByZXR1cm4gc2VsbChfdG9Ub2tlbiwgcHVyY2hhc2VBbW91bnQsIF9taW5SZXR1cm4pOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYnV5cyB0aGUgdG9rZW4gYnkgZGVwb3NpdGluZyBvbmUgb2YgaXRzIGNvbm5lY3RvciB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9jb25uZWN0b3JUb2tlbiAgY29ubmVjdG9yIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgICBhbW91bnQgdG8gZGVwb3NpdCAoaW4gdGhlIGNvbm5lY3RvciB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBidXkgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGJ1eShJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICBjb252ZXJzaW9uc0FsbG93ZWQKICAgICAgICB2YWxpZEdhc1ByaWNlCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF9taW5SZXR1cm4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9jb25uZWN0b3JUb2tlbiwgX2RlcG9zaXRBbW91bnQpOwogICAgICAgIHJlcXVpcmUoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICBpZiAoY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgPSBzYWZlQWRkKGNvbm5lY3Rvci52aXJ0dWFsQmFsYW5jZSwgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyB0cmFuc2ZlciBfZGVwb3NpdEFtb3VudCBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW4gdGhlIGNvbm5lY3RvciB0b2tlbgogICAgICAgIGFzc2VydChfY29ubmVjdG9yVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9kZXBvc2l0QW1vdW50KSk7CiAgICAgICAgLy8gaXNzdWUgbmV3IGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgdG9rZW4uaXNzdWUobXNnLnNlbmRlciwgYW1vdW50KTsKCiAgICAgICAgZGlzcGF0Y2hDb252ZXJzaW9uRXZlbnQoX2Nvbm5lY3RvclRva2VuLCBfZGVwb3NpdEFtb3VudCwgYW1vdW50LCB0cnVlKTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgc2VsbHMgdGhlIHRva2VuIGJ5IHdpdGhkcmF3aW5nIGZyb20gb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gc2VsbCByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gc2VsbChJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICBjb252ZXJzaW9uc0FsbG93ZWQKICAgICAgICB2YWxpZEdhc1ByaWNlCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF9taW5SZXR1cm4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXF1aXJlKF9zZWxsQW1vdW50IDw9IHRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKSk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZ2V0U2FsZVJldHVybihfY29ubmVjdG9yVG9rZW4sIF9zZWxsQW1vdW50KTsKICAgICAgICByZXF1aXJlKGFtb3VudCAhPSAwICYmIGFtb3VudCA+PSBfbWluUmV0dXJuKTsgLy8gZW5zdXJlIHRoZSB0cmFkZSBnaXZlcyBzb21ldGhpbmcgaW4gcmV0dXJuIGFuZCBtZWV0cyB0aGUgbWluaW11bSByZXF1ZXN0ZWQgYW1vdW50CgogICAgICAgIHVpbnQyNTYgdG9rZW5TdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQmFsYW5jZSA9IGdldENvbm5lY3RvckJhbGFuY2UoX2Nvbm5lY3RvclRva2VuKTsKICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgdHJhZGUgd2lsbCBvbmx5IGRlcGxldGUgdGhlIGNvbm5lY3RvciBpZiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlcGxldGVkIGFzIHdlbGwKICAgICAgICBhc3NlcnQoYW1vdW50IDwgY29ubmVjdG9yQmFsYW5jZSB8fCAoYW1vdW50ID09IGNvbm5lY3RvckJhbGFuY2UgJiYgX3NlbGxBbW91bnQgPT0gdG9rZW5TdXBwbHkpKTsKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICBpZiAoY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgPSBzYWZlU3ViKGNvbm5lY3Rvci52aXJ0dWFsQmFsYW5jZSwgYW1vdW50KTsKCiAgICAgICAgLy8gZGVzdHJveSBfc2VsbEFtb3VudCBmcm9tIHRoZSBjYWxsZXIncyBiYWxhbmNlIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgIHRva2VuLmRlc3Ryb3kobXNnLnNlbmRlciwgX3NlbGxBbW91bnQpOwogICAgICAgIC8vIHRyYW5zZmVyIGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIGNvbm5lY3RvciB0b2tlbgogICAgICAgIC8vIHRoZSB0cmFuc2ZlciBtaWdodCBmYWlsIGlmIHRoZSBhY3R1YWwgY29ubmVjdG9yIGJhbGFuY2UgaXMgc21hbGxlciB0aGFuIHRoZSB2aXJ0dWFsIGJhbGFuY2UKICAgICAgICBhc3NlcnQoX2Nvbm5lY3RvclRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCkpOwoKICAgICAgICBkaXNwYXRjaENvbnZlcnNpb25FdmVudChfY29ubmVjdG9yVG9rZW4sIF9zZWxsQW1vdW50LCBhbW91bnQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nIGEgcHJlZGVmaW5lZCBjb252ZXJzaW9uIHBhdGgKICAgICAgICBub3RlIHRoYXQgd2hlbiBjb252ZXJ0aW5nIGZyb20gYW4gRVJDMjAgdG9rZW4gKGFzIG9wcG9zZWQgdG8gYSBzbWFydCB0b2tlbiksIGFsbG93YW5jZSBtdXN0IGJlIHNldCBiZWZvcmVoYW5kCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICAgICAgY29udmVyc2lvbiBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBpbiB0aGUgQmFuY29yUXVpY2tDb252ZXJ0ZXIgY29udHJhY3QKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gcXVpY2tDb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICB2YWxpZENvbnZlcnNpb25QYXRoKF9wYXRoKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgSUVSQzIwVG9rZW4gZnJvbVRva2VuID0gX3BhdGhbMF07CiAgICAgICAgSUJhbmNvclF1aWNrQ29udmVydGVyIHF1aWNrQ29udmVydGVyID0gZXh0ZW5zaW9ucy5xdWlja0NvbnZlcnRlcigpOwoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHRyYW5zZmVyIHRoZSBzb3VyY2UgdG9rZW5zIGZyb20gdGhlIGNhbGxlciB0byB0aGUgcXVpY2sgY29udmVydGVyLAogICAgICAgIC8vIHNvIGl0IGNhbiBleGVjdXRlIHRoZSBjb252ZXJzaW9uIG9uIGJlaGFsZiBvZiB0aGUgY2FsbGVyCiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIC8vIG5vdCBFVEgsIHNlbmQgdGhlIHNvdXJjZSB0b2tlbnMgdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICAvLyBpZiB0aGUgdG9rZW4gaXMgdGhlIHNtYXJ0IHRva2VuLCBubyBhbGxvd2FuY2UgaXMgcmVxdWlyZWQgLSBkZXN0cm95IHRoZSB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIGFuZCBpc3N1ZSB0aGVtIHRvIHRoZSBxdWljayBjb252ZXJ0ZXIKICAgICAgICAgICAgaWYgKGZyb21Ub2tlbiA9PSB0b2tlbikgewogICAgICAgICAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfYW1vdW50KTsgLy8gZGVzdHJveSBfYW1vdW50IHRva2VucyBmcm9tIHRoZSBjYWxsZXIncyBiYWxhbmNlIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgICAgICAgICAgdG9rZW4uaXNzdWUocXVpY2tDb252ZXJ0ZXIsIF9hbW91bnQpOyAvLyBpc3N1ZSBfYW1vdW50IG5ldyB0b2tlbnMgdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCB3ZSBhc3N1bWUgd2UgYWxyZWFkeSBoYXZlIGFsbG93YW5jZSwgdHJhbnNmZXIgdGhlIHRva2VucyBkaXJlY3RseSB0byB0aGUgcXVpY2sgY29udmVydGVyCiAgICAgICAgICAgICAgICBhc3NlcnQoZnJvbVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBxdWlja0NvbnZlcnRlciwgX2Ftb3VudCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBleGVjdXRlIHRoZSBjb252ZXJzaW9uIGFuZCBwYXNzIG9uIHRoZSBFVEggd2l0aCB0aGUgY2FsbAogICAgICAgIHJldHVybiBxdWlja0NvbnZlcnRlci5jb252ZXJ0Rm9yLnZhbHVlKG1zZy52YWx1ZSkoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIGRlcHJlY2F0ZWQsIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnQoX2Zyb21Ub2tlbiwgX3RvVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zLCBnaXZlbiBhIHRvdGFsIHN1cHBseSBvdmVycmlkZQoKICAgICAgICBAcGFyYW0gX2Nvbm5lY3RvclRva2VuICBjb25uZWN0b3IgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF90b3RhbFN1cHBseSAgICAgdG90YWwgdG9rZW4gc3VwcGx5LCBvdmVycmlkZXMgdGhlIGFjdHVhbCB0b2tlbiB0b3RhbCBzdXBwbHkgd2hlbiBjYWxjdWxhdGluZyB0aGUgcmV0dXJuCgogICAgICAgIEByZXR1cm4gc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX3RvdGFsU3VwcGx5KQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgYWN0aXZlCiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfdG90YWxTdXBwbHkpCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBDb25uZWN0b3Igc3RvcmFnZSBjb25uZWN0b3IgPSBjb25uZWN0b3JzW19jb25uZWN0b3JUb2tlbl07CiAgICAgICAgdWludDI1NiBjb25uZWN0b3JCYWxhbmNlID0gZ2V0Q29ubmVjdG9yQmFsYW5jZShfY29ubmVjdG9yVG9rZW4pOwogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZXh0ZW5zaW9ucy5mb3JtdWxhKCkuY2FsY3VsYXRlU2FsZVJldHVybihfdG90YWxTdXBwbHksIGNvbm5lY3RvckJhbGFuY2UsIGNvbm5lY3Rvci53ZWlnaHQsIF9zZWxsQW1vdW50KTsKCiAgICAgICAgLy8gZGVkdWN0IHRoZSBmZWUgZnJvbSB0aGUgcmV0dXJuIGFtb3VudAogICAgICAgIHVpbnQyNTYgZmVlQW1vdW50ID0gZ2V0Q29udmVyc2lvbkZlZUFtb3VudChhbW91bnQpOwogICAgICAgIHJldHVybiBzYWZlU3ViKGFtb3VudCwgZmVlQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGhlbHBlciwgZGlzcGF0Y2hlcyB0aGUgQ29udmVyc2lvbiBldmVudAogICAgICAgIFRoZSBmdW5jdGlvbiBhbHNvIHRha2VzIHRoZSB0b2tlbnMnIGRlY2ltYWxzIGludG8gYWNjb3VudCB3aGVuIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHByaWNlCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgICAgICAgYW1vdW50IHB1cmNoYXNlZC9zb2xkIChpbiB0aGUgc291cmNlIHRva2VuKQogICAgICAgIEBwYXJhbSBfcmV0dXJuQW1vdW50ICAgIGFtb3VudCByZXR1cm5lZCAoaW4gdGhlIHRhcmdldCB0b2tlbikKICAgICAgICBAcGFyYW0gaXNQdXJjaGFzZSAgICAgICB0cnVlIGlmIGl0J3MgYSBwdXJjaGFzZSwgZmFsc2UgaWYgaXQncyBhIHNhbGUKICAgICovCiAgICBmdW5jdGlvbiBkaXNwYXRjaENvbnZlcnNpb25FdmVudChJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfcmV0dXJuQW1vdW50LCBib29sIGlzUHVyY2hhc2UpIHByaXZhdGUgewogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgcHJpY2UgdXNpbmcgdGhlIHNpbXBsZSBwcmljZSBmb3JtdWxhCiAgICAgICAgLy8gcHJpY2UgPSBjb25uZWN0b3IgYmFsYW5jZSAvIChzdXBwbHkgKiB3ZWlnaHQpCiAgICAgICAgLy8gd2VpZ2h0IGlzIHJlcHJlc2VudGVkIGluIHBwbSwgc28gbXVsdGlwbHlpbmcgYnkgMTAwMDAwMAogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQW1vdW50ID0gc2FmZU11bChnZXRDb25uZWN0b3JCYWxhbmNlKF9jb25uZWN0b3JUb2tlbiksIE1BWF9XRUlHSFQpOwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuLnRvdGFsU3VwcGx5KCksIGNvbm5lY3Rvci53ZWlnaHQpOwoKICAgICAgICAvLyBub3JtYWxpemUgdmFsdWVzCiAgICAgICAgdWludDggdG9rZW5EZWNpbWFscyA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICAgICAgdWludDggY29ubmVjdG9yVG9rZW5EZWNpbWFscyA9IF9jb25uZWN0b3JUb2tlbi5kZWNpbWFscygpOwogICAgICAgIGlmICh0b2tlbkRlY2ltYWxzICE9IGNvbm5lY3RvclRva2VuRGVjaW1hbHMpIHsKICAgICAgICAgICAgaWYgKHRva2VuRGVjaW1hbHMgPiBjb25uZWN0b3JUb2tlbkRlY2ltYWxzKQogICAgICAgICAgICAgICAgY29ubmVjdG9yQW1vdW50ID0gc2FmZU11bChjb25uZWN0b3JBbW91bnQsIDEwICoqIHVpbnQyNTYodG9rZW5EZWNpbWFscyAtIGNvbm5lY3RvclRva2VuRGVjaW1hbHMpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuQW1vdW50LCAxMCAqKiB1aW50MjU2KGNvbm5lY3RvclRva2VuRGVjaW1hbHMgLSB0b2tlbkRlY2ltYWxzKSk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGZlZUFtb3VudCA9IGdldENvbnZlcnNpb25GZWVBbW91bnQoX3JldHVybkFtb3VudCk7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIGZlZSBpcyBjYXBwZWQgYXQgMjU1IGJpdHMgdG8gcHJldmVudCBvdmVyZmxvdyB3aGVuIGNvbnZlcnRpbmcgaXQgdG8gYSBzaWduZWQgaW50CiAgICAgICAgYXNzZXJ0KGZlZUFtb3VudCA8PSAyICoqIDI1NSk7CgogICAgICAgIGlmIChpc1B1cmNoYXNlKQogICAgICAgICAgICBDb252ZXJzaW9uKF9jb25uZWN0b3JUb2tlbiwgdG9rZW4sIG1zZy5zZW5kZXIsIF9hbW91bnQsIF9yZXR1cm5BbW91bnQsIGludDI1NihmZWVBbW91bnQpLCBjb25uZWN0b3JBbW91bnQsIHRva2VuQW1vdW50KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIENvbnZlcnNpb24odG9rZW4sIF9jb25uZWN0b3JUb2tlbiwgbXNnLnNlbmRlciwgX2Ftb3VudCwgX3JldHVybkFtb3VudCwgaW50MjU2KGZlZUFtb3VudCksIHRva2VuQW1vdW50LCBjb25uZWN0b3JBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZmFsbGJhY2ssIGJ1eXMgdGhlIHNtYXJ0IHRva2VuIHdpdGggRVRICiAgICAgICAgbm90ZSB0aGF0IHRoZSBwdXJjaGFzZSB3aWxsIHVzZSB0aGUgcHJpY2UgYXQgdGhlIHRpbWUgb2YgdGhlIHB1cmNoYXNlCiAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcXVpY2tDb252ZXJ0KHF1aWNrQnV5UGF0aCwgbXNnLnZhbHVlLCAxKTsKICAgIH0KfQ=='.
	

]
