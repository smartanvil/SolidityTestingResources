Class {
	#name : #SRT2af47a65da8cd66729b4209c22017d6a5c2d2400,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2af47a65da8cd66729b4209c22017d6a5c2d2400 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CmNvbnRyYWN0IFRva2VuIHsKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuCiAgICAgICAgLy9JZiB5b3VyIHRva2VuIGxlYXZlcyBvdXQgdG90YWxTdXBwbHkgYW5kIGNhbiBpc3N1ZSBtb3JlIHRva2VucyBhcyB0aW1lIGdvZXMgb24sIHlvdSBuZWVkIHRvIGNoZWNrIGlmIGl0IGRvZXNuJ3Qgd3JhcC4KICAgICAgICAvL1JlcGxhY2UgdGhlIGlmIHdpdGggdGhpcyBvbmUgaW5zdGVhZC4KICAgICAgICAvL2lmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL3NhbWUgYXMgYWJvdmUuIFJlcGxhY2UgdGhpcyBsaW5lIHdpdGggdGhlIGZvbGxvd2luZyBpZiB5b3Ugd2FudCB0byBwcm90ZWN0IGFnYWluc3Qgd3JhcHBpbmcgdWludHMuCiAgICAgICAgLy9pZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKfQpjb250cmFjdCBIdW1hblN0YW5kYXJkVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLyogUHVibGljIHZhcmlhYmxlcyBvZiB0aGUgdG9rZW4gKi8KCiAgICAvKgogICAgTk9URToKICAgIFRoZSBmb2xsb3dpbmcgdmFyaWFibGVzIGFyZSBPUFRJT05BTCB2YW5pdGllcy4gT25lIGRvZXMgbm90IGhhdmUgdG8gaW5jbHVkZSB0aGVtLgogICAgVGhleSBhbGxvdyBvbmUgdG8gY3VzdG9taXNlIHRoZSB0b2tlbiBjb250cmFjdCAmIGluIG5vIHdheSBpbmZsdWVuY2VzIHRoZSBjb3JlIGZ1bmN0aW9uYWxpdHkuCiAgICBTb21lIHdhbGxldHMvaW50ZXJmYWNlcyBtaWdodCBub3QgZXZlbiBib3RoZXIgdG8gbG9vayBhdCB0aGlzIGluZm9ybWF0aW9uLgogICAgKi8KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgICAgLy9mYW5jeSBuYW1lOiBlZyBTaW1vbiBCdWNrcwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAgICAvL0hvdyBtYW55IGRlY2ltYWxzIHRvIHNob3cuIGllLiBUaGVyZSBjb3VsZCAxMDAwIGJhc2UgdW5pdHMgd2l0aCAzIGRlY2ltYWxzLiBNZWFuaW5nIDAuOTgwIFNCWCA9IDk4MCBiYXNlIHVuaXRzLiBJdCdzIGxpa2UgY29tcGFyaW5nIDEgd2VpIHRvIDEgZXRoZXIuCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZWcgU0JYCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnSDAuMSc7ICAgICAgIC8vaHVtYW4gMC4xIHN0YW5kYXJkLiBKdXN0IGFuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZS4KCiAgICBmdW5jdGlvbiBIdW1hblN0YW5kYXJkVG9rZW4oCiAgICAgICAgdWludDI1NiBfaW5pdGlhbEFtb3VudCwKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wKICAgICAgICApIHsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9pbml0aWFsQW1vdW50OyAgICAgICAgICAgICAgIC8vIEdpdmUgdGhlIGNyZWF0b3IgYWxsIGluaXRpYWwgdG9rZW5zCiAgICAgICAgdG90YWxTdXBwbHkgPSBfaW5pdGlhbEFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdG90YWwgc3VwcGx5CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFtb3VudCBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgIH0KCiAgICAvKiBBcHByb3ZlcyBhbmQgdGhlbiBjYWxscyB0aGUgcmVjZWl2aW5nIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgogICAgICAgIC8vY2FsbCB0aGUgcmVjZWl2ZUFwcHJvdmFsIGZ1bmN0aW9uIG9uIHRoZSBjb250cmFjdCB5b3Ugd2FudCB0byBiZSBub3RpZmllZC4gVGhpcyBjcmFmdHMgdGhlIGZ1bmN0aW9uIHNpZ25hdHVyZSBtYW51YWxseSBzbyBvbmUgZG9lc24ndCBoYXZlIHRvIGluY2x1ZGUgYSBjb250cmFjdCBpbiBoZXJlIGp1c3QgZm9yIHRoaXMuCiAgICAgICAgLy9yZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpCiAgICAgICAgLy9pdCBpcyBhc3N1bWVkIHRoYXQgd2hlbiBkb2VzIHRoaXMgdGhhdCB0aGUgY2FsbCAqc2hvdWxkKiBzdWNjZWVkLCBvdGhlcndpc2Ugb25lIHdvdWxkIHVzZSB2YW5pbGxhIGFwcHJvdmUgaW5zdGVhZC4KICAgICAgICByZXF1aXJlKF9zcGVuZGVyLmNhbGwoYnl0ZXM0KGJ5dGVzMzIoc2hhMygicmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MsdWludDI1NixhZGRyZXNzLGJ5dGVzKSIpKSksIG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9Cgpjb250cmFjdCBTdGFuZGFyZEJvdW50aWVzIHsKCiAgLyoKICAgKiBFdmVudHMKICAgKi8KICBldmVudCBCb3VudHlJc3N1ZWQodWludCBib3VudHlJZCk7CiAgZXZlbnQgQm91bnR5QWN0aXZhdGVkKHVpbnQgYm91bnR5SWQsIGFkZHJlc3MgaXNzdWVyKTsKICBldmVudCBCb3VudHlGdWxmaWxsZWQodWludCBib3VudHlJZCwgYWRkcmVzcyBpbmRleGVkIGZ1bGZpbGxlciwgdWludDI1NiBpbmRleGVkIF9mdWxmaWxsbWVudElkKTsKICBldmVudCBGdWxmaWxsbWVudFVwZGF0ZWQodWludCBfYm91bnR5SWQsIHVpbnQgX2Z1bGZpbGxtZW50SWQpOwogIGV2ZW50IEZ1bGZpbGxtZW50QWNjZXB0ZWQodWludCBib3VudHlJZCwgYWRkcmVzcyBpbmRleGVkIGZ1bGZpbGxlciwgdWludDI1NiBpbmRleGVkIF9mdWxmaWxsbWVudElkKTsKICBldmVudCBCb3VudHlLaWxsZWQodWludCBib3VudHlJZCwgYWRkcmVzcyBpbmRleGVkIGlzc3Vlcik7CiAgZXZlbnQgQ29udHJpYnV0aW9uQWRkZWQodWludCBib3VudHlJZCwgYWRkcmVzcyBpbmRleGVkIGNvbnRyaWJ1dG9yLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBEZWFkbGluZUV4dGVuZGVkKHVpbnQgYm91bnR5SWQsIHVpbnQgbmV3RGVhZGxpbmUpOwogIGV2ZW50IEJvdW50eUNoYW5nZWQodWludCBib3VudHlJZCk7CiAgZXZlbnQgSXNzdWVyVHJhbnNmZXJyZWQodWludCBfYm91bnR5SWQsIGFkZHJlc3MgaW5kZXhlZCBfbmV3SXNzdWVyKTsKICBldmVudCBQYXlvdXRJbmNyZWFzZWQodWludCBfYm91bnR5SWQsIHVpbnQgX25ld0Z1bGZpbGxtZW50QW1vdW50KTsKCgogIC8qCiAgICogU3RvcmFnZQogICAqLwoKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgQm91bnR5W10gcHVibGljIGJvdW50aWVzOwoKICBtYXBwaW5nKHVpbnQ9PkZ1bGZpbGxtZW50W10pIGZ1bGZpbGxtZW50czsKICBtYXBwaW5nKHVpbnQ9PnVpbnQpIG51bUFjY2VwdGVkOwogIG1hcHBpbmcodWludD0+SHVtYW5TdGFuZGFyZFRva2VuKSB0b2tlbkNvbnRyYWN0czsKCiAgLyoKICAgKiBFbnVtcwogICAqLwoKICBlbnVtIEJvdW50eVN0YWdlcyB7CiAgICAgIERyYWZ0LAogICAgICBBY3RpdmUsCiAgICAgIERlYWQKICB9CgogIC8qCiAgICogU3RydWN0cwogICAqLwoKICBzdHJ1Y3QgQm91bnR5IHsKICAgICAgYWRkcmVzcyBpc3N1ZXI7CiAgICAgIHVpbnQgZGVhZGxpbmU7CiAgICAgIHN0cmluZyBkYXRhOwogICAgICB1aW50IGZ1bGZpbGxtZW50QW1vdW50OwogICAgICBhZGRyZXNzIGFyYml0ZXI7CiAgICAgIGJvb2wgcGF5c1Rva2VuczsKICAgICAgQm91bnR5U3RhZ2VzIGJvdW50eVN0YWdlOwogICAgICB1aW50IGJhbGFuY2U7CiAgfQoKICBzdHJ1Y3QgRnVsZmlsbG1lbnQgewogICAgICBib29sIGFjY2VwdGVkOwogICAgICBhZGRyZXNzIGZ1bGZpbGxlcjsKICAgICAgc3RyaW5nIGRhdGE7CiAgfQoKICAvKgogICAqIE1vZGlmaWVycwogICAqLwoKICBtb2RpZmllciB2YWxpZGF0ZU5vdFRvb01hbnlCb3VudGllcygpewogICAgcmVxdWlyZSgoYm91bnRpZXMubGVuZ3RoICsgMSkgPiBib3VudGllcy5sZW5ndGgpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIHZhbGlkYXRlTm90VG9vTWFueUZ1bGZpbGxtZW50cyh1aW50IF9ib3VudHlJZCl7CiAgICByZXF1aXJlKChmdWxmaWxsbWVudHNbX2JvdW50eUlkXS5sZW5ndGggKyAxKSA+IGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdLmxlbmd0aCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KHVpbnQgX2JvdW50eUlkKXsKICAgIHJlcXVpcmUoX2JvdW50eUlkIDwgYm91bnRpZXMubGVuZ3RoKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SXNzdWVyKHVpbnQgX2JvdW50eUlkKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBib3VudGllc1tfYm91bnR5SWRdLmlzc3Vlcik7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5RnVsZmlsbGVyKHVpbnQgX2JvdW50eUlkLCB1aW50IF9mdWxmaWxsbWVudElkKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uZnVsZmlsbGVyKTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIGFtb3VudElzTm90WmVybyh1aW50IF9hbW91bnQpIHsKICAgICAgcmVxdWlyZShfYW1vdW50ICE9IDApOwogICAgICBfOwogIH0KCiAgbW9kaWZpZXIgdHJhbnNmZXJyZWRBbW91bnRFcXVhbHNWYWx1ZSh1aW50IF9ib3VudHlJZCwgdWludCBfYW1vdW50KSB7CiAgICAgIGlmIChib3VudGllc1tfYm91bnR5SWRdLnBheXNUb2tlbnMpewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogICAgICAgIHVpbnQgb2xkQmFsYW5jZSA9IHRva2VuQ29udHJhY3RzW19ib3VudHlJZF0uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGlmIChfYW1vdW50ICE9IDApewogICAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0c1tfYm91bnR5SWRdLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfYW1vdW50KSk7CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUoKHRva2VuQ29udHJhY3RzW19ib3VudHlJZF0uYmFsYW5jZU9mKHRoaXMpIC0gb2xkQmFsYW5jZSkgPT0gX2Ftb3VudCk7CgogICAgICB9IGVsc2UgewogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgKiAxIHdlaSkgPT0gbXNnLnZhbHVlKTsKICAgICAgfQogICAgICBfOwogIH0KCiAgbW9kaWZpZXIgaXNCZWZvcmVEZWFkbGluZSh1aW50IF9ib3VudHlJZCkgewogICAgICByZXF1aXJlKG5vdyA8IGJvdW50aWVzW19ib3VudHlJZF0uZGVhZGxpbmUpOwogICAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRhdGVEZWFkbGluZSh1aW50IF9uZXdEZWFkbGluZSkgewogICAgICByZXF1aXJlKF9uZXdEZWFkbGluZSA+IG5vdyk7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciBpc0F0U3RhZ2UodWludCBfYm91bnR5SWQsIEJvdW50eVN0YWdlcyBfZGVzaXJlZFN0YWdlKSB7CiAgICAgIHJlcXVpcmUoYm91bnRpZXNbX2JvdW50eUlkXS5ib3VudHlTdGFnZSA9PSBfZGVzaXJlZFN0YWdlKTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIHZhbGlkYXRlRnVsZmlsbG1lbnRBcnJheUluZGV4KHVpbnQgX2JvdW50eUlkLCB1aW50IF9pbmRleCkgewogICAgICByZXF1aXJlKF9pbmRleCA8IGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdLmxlbmd0aCk7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciBub3RZZXRBY2NlcHRlZCh1aW50IF9ib3VudHlJZCwgdWludCBfZnVsZmlsbG1lbnRJZCl7CiAgICAgIHJlcXVpcmUoZnVsZmlsbG1lbnRzW19ib3VudHlJZF1bX2Z1bGZpbGxtZW50SWRdLmFjY2VwdGVkID09IGZhbHNlKTsKICAgICAgXzsKICB9CgogIC8qCiAgICogUHVibGljIGZ1bmN0aW9ucwogICAqLwoKCiAgLy8vIEBkZXYgU3RhbmRhcmRCb3VudGllcygpOiBpbnN0YW50aWF0ZXMKICAvLy8gQHBhcmFtIF9vd25lciB0aGUgaXNzdWVyIG9mIHRoZSBzdGFuZGFyZGJvdW50aWVzIGNvbnRyYWN0LCB3aG8gaGFzIHRoZQogIC8vLyBhYmlsaXR5IHRvIHJlbW92ZSBib3VudGllcwogIGZ1bmN0aW9uIFN0YW5kYXJkQm91bnRpZXMoYWRkcmVzcyBfb3duZXIpCiAgICAgIHB1YmxpYwogIHsKICAgICAgb3duZXIgPSBfb3duZXI7CiAgfQoKICAvLy8gQGRldiBpc3N1ZUJvdW50eSgpOiBpbnN0YW50aWF0ZXMgYSBuZXcgZHJhZnQgYm91bnR5CiAgLy8vIEBwYXJhbSBfaXNzdWVyIHRoZSBhZGRyZXNzIG9mIHRoZSBpbnRlbmRlZCBpc3N1ZXIgb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2RlYWRsaW5lIHRoZSB1bml4IHRpbWVzdGFtcCBhZnRlciB3aGljaCBmdWxmaWxsbWVudHMgd2lsbCBubyBsb25nZXIgYmUgYWNjZXB0ZWQKICAvLy8gQHBhcmFtIF9kYXRhIHRoZSByZXF1aXJlbWVudHMgb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2Z1bGZpbGxtZW50QW1vdW50IHRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIHBhaWQgb3V0IGZvciBlYWNoIHN1Y2Nlc3NmdWwgZnVsZmlsbG1lbnQKICAvLy8gQHBhcmFtIF9hcmJpdGVyIHRoZSBhZGRyZXNzIG9mIHRoZSBhcmJpdGVyIHdobyBjYW4gbWVkaWF0ZSBjbGFpbXMKICAvLy8gQHBhcmFtIF9wYXlzVG9rZW5zIHdoZXRoZXIgdGhlIGJvdW50eSBwYXlzIGluIHRva2VucyBvciBpbiBFVEgKICAvLy8gQHBhcmFtIF90b2tlbkNvbnRyYWN0IHRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBpZiBfcGF5c1Rva2VucyBpcyB0cnVlCiAgZnVuY3Rpb24gaXNzdWVCb3VudHkoCiAgICAgIGFkZHJlc3MgX2lzc3VlciwKICAgICAgdWludCBfZGVhZGxpbmUsCiAgICAgIHN0cmluZyBfZGF0YSwKICAgICAgdWludDI1NiBfZnVsZmlsbG1lbnRBbW91bnQsCiAgICAgIGFkZHJlc3MgX2FyYml0ZXIsCiAgICAgIGJvb2wgX3BheXNUb2tlbnMsCiAgICAgIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QKICApCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZURlYWRsaW5lKF9kZWFkbGluZSkKICAgICAgYW1vdW50SXNOb3RaZXJvKF9mdWxmaWxsbWVudEFtb3VudCkKICAgICAgdmFsaWRhdGVOb3RUb29NYW55Qm91bnRpZXMKICAgICAgcmV0dXJucyAodWludCkKICB7CiAgICAgIGJvdW50aWVzLnB1c2goQm91bnR5KF9pc3N1ZXIsIF9kZWFkbGluZSwgX2RhdGEsIF9mdWxmaWxsbWVudEFtb3VudCwgX2FyYml0ZXIsIF9wYXlzVG9rZW5zLCBCb3VudHlTdGFnZXMuRHJhZnQsIDApKTsKICAgICAgaWYgKF9wYXlzVG9rZW5zKXsKICAgICAgICB0b2tlbkNvbnRyYWN0c1tib3VudGllcy5sZW5ndGggLSAxXSA9IEh1bWFuU3RhbmRhcmRUb2tlbihfdG9rZW5Db250cmFjdCk7CiAgICAgIH0KICAgICAgQm91bnR5SXNzdWVkKGJvdW50aWVzLmxlbmd0aCAtIDEpOwogICAgICByZXR1cm4gKGJvdW50aWVzLmxlbmd0aCAtIDEpOwogIH0KCiAgLy8vIEBkZXYgaXNzdWVBbmRBY3RpdmF0ZUJvdW50eSgpOiBpbnN0YW50aWF0ZXMgYSBuZXcgZHJhZnQgYm91bnR5CiAgLy8vIEBwYXJhbSBfaXNzdWVyIHRoZSBhZGRyZXNzIG9mIHRoZSBpbnRlbmRlZCBpc3N1ZXIgb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2RlYWRsaW5lIHRoZSB1bml4IHRpbWVzdGFtcCBhZnRlciB3aGljaCBmdWxmaWxsbWVudHMgd2lsbCBubyBsb25nZXIgYmUgYWNjZXB0ZWQKICAvLy8gQHBhcmFtIF9kYXRhIHRoZSByZXF1aXJlbWVudHMgb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2Z1bGZpbGxtZW50QW1vdW50IHRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIHBhaWQgb3V0IGZvciBlYWNoIHN1Y2Nlc3NmdWwgZnVsZmlsbG1lbnQKICAvLy8gQHBhcmFtIF9hcmJpdGVyIHRoZSBhZGRyZXNzIG9mIHRoZSBhcmJpdGVyIHdobyBjYW4gbWVkaWF0ZSBjbGFpbXMKICAvLy8gQHBhcmFtIF9wYXlzVG9rZW5zIHdoZXRoZXIgdGhlIGJvdW50eSBwYXlzIGluIHRva2VucyBvciBpbiBFVEgKICAvLy8gQHBhcmFtIF90b2tlbkNvbnRyYWN0IHRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBpZiBfcGF5c1Rva2VucyBpcyB0cnVlCiAgLy8vIEBwYXJhbSBfdmFsdWUgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgZGVwb3NpdGVkIHVwb24gYWN0aXZhdGlvbgogIGZ1bmN0aW9uIGlzc3VlQW5kQWN0aXZhdGVCb3VudHkoCiAgICAgIGFkZHJlc3MgX2lzc3VlciwKICAgICAgdWludCBfZGVhZGxpbmUsCiAgICAgIHN0cmluZyBfZGF0YSwKICAgICAgdWludDI1NiBfZnVsZmlsbG1lbnRBbW91bnQsCiAgICAgIGFkZHJlc3MgX2FyYml0ZXIsCiAgICAgIGJvb2wgX3BheXNUb2tlbnMsCiAgICAgIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QsCiAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgKQogICAgICBwdWJsaWMKICAgICAgcGF5YWJsZQogICAgICB2YWxpZGF0ZURlYWRsaW5lKF9kZWFkbGluZSkKICAgICAgYW1vdW50SXNOb3RaZXJvKF9mdWxmaWxsbWVudEFtb3VudCkKICAgICAgdmFsaWRhdGVOb3RUb29NYW55Qm91bnRpZXMKICAgICAgcmV0dXJucyAodWludCkKICB7CiAgICAgIHJlcXVpcmUgKF92YWx1ZSA+PSBfZnVsZmlsbG1lbnRBbW91bnQpOwogICAgICBpZiAoX3BheXNUb2tlbnMpewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogICAgICAgIHRva2VuQ29udHJhY3RzW2JvdW50aWVzLmxlbmd0aF0gPSBIdW1hblN0YW5kYXJkVG9rZW4oX3Rva2VuQ29udHJhY3QpOwogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdHNbYm91bnRpZXMubGVuZ3RoXS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgX3ZhbHVlKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVxdWlyZSgoX3ZhbHVlICogMSB3ZWkpID09IG1zZy52YWx1ZSk7CiAgICAgIH0KICAgICAgYm91bnRpZXMucHVzaChCb3VudHkoX2lzc3VlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9kZWFkbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2Z1bGZpbGxtZW50QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2FyYml0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGF5c1Rva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvdW50eVN0YWdlcy5BY3RpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdmFsdWUpKTsKICAgICAgQm91bnR5SXNzdWVkKGJvdW50aWVzLmxlbmd0aCAtIDEpOwogICAgICBDb250cmlidXRpb25BZGRlZChib3VudGllcy5sZW5ndGggLSAxLCBtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICBCb3VudHlBY3RpdmF0ZWQoYm91bnRpZXMubGVuZ3RoIC0gMSwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiAoYm91bnRpZXMubGVuZ3RoIC0gMSk7CiAgfQoKICBtb2RpZmllciBpc05vdERlYWQodWludCBfYm91bnR5SWQpIHsKICAgICAgcmVxdWlyZShib3VudGllc1tfYm91bnR5SWRdLmJvdW50eVN0YWdlICE9IEJvdW50eVN0YWdlcy5EZWFkKTsKICAgICAgXzsKICB9CgogIC8vLyBAZGV2IGNvbnRyaWJ1dGUoKTogYSBmdW5jdGlvbiBhbGxvd2luZyBhbnlvbmUgdG8gY29udHJpYnV0ZSB0b2tlbnMgdG8gYQogIC8vLyBib3VudHksIGFzIGxvbmcgYXMgaXQgaXMgc3RpbGwgYmVmb3JlIGl0cyBkZWFkbGluZS4gU2hvdWxkbid0IGtlZXAKICAvLy8gdGhlbSBieSBhY2NpZGVudCAoaGVuY2UgJ3ZhbHVlJykuCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IGJlaW5nIGNvbnRyaWJ1dGVkIGluIGV0aGVyIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBkZXBvc2l0cwogIC8vLyBAbm90aWNlIFBsZWFzZSBub3RlIHlvdSBmdW5kcyB3aWxsIGJlIGF0IHRoZSBtZXJjeSBvZiB0aGUgaXNzdWVyCiAgLy8vICBhbmQgY2FuIGJlIGRyYWluZWQgYXQgYW55IG1vbWVudC4gQmUgY2FyZWZ1bCEKICBmdW5jdGlvbiBjb250cmlidXRlICh1aW50IF9ib3VudHlJZCwgdWludCBfdmFsdWUpCiAgICAgIHBheWFibGUKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIGlzQmVmb3JlRGVhZGxpbmUoX2JvdW50eUlkKQogICAgICBpc05vdERlYWQoX2JvdW50eUlkKQogICAgICBhbW91bnRJc05vdFplcm8oX3ZhbHVlKQogICAgICB0cmFuc2ZlcnJlZEFtb3VudEVxdWFsc1ZhbHVlKF9ib3VudHlJZCwgX3ZhbHVlKQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlICs9IF92YWx1ZTsKCiAgICAgIENvbnRyaWJ1dGlvbkFkZGVkKF9ib3VudHlJZCwgbXNnLnNlbmRlciwgX3ZhbHVlKTsKICB9CgogIC8vLyBAbm90aWNlIFNlbmQgZnVuZHMgdG8gYWN0aXZhdGUgdGhlIGJ1ZyBib3VudHkKICAvLy8gQGRldiBhY3RpdmF0ZUJvdW50eSgpOiBhY3RpdmF0ZSBhIGJvdW50eSBzbyBpdCBtYXkgcGF5IG91dAogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfdmFsdWUgdGhlIGFtb3VudCBiZWluZyBjb250cmlidXRlZCBpbiBldGhlciB0byBwcmV2ZW50CiAgLy8vIGFjY2lkZW50YWwgZGVwb3NpdHMKICBmdW5jdGlvbiBhY3RpdmF0ZUJvdW50eSh1aW50IF9ib3VudHlJZCwgdWludCBfdmFsdWUpCiAgICAgIHBheWFibGUKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIGlzQmVmb3JlRGVhZGxpbmUoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgdHJhbnNmZXJyZWRBbW91bnRFcXVhbHNWYWx1ZShfYm91bnR5SWQsIF92YWx1ZSkKICB7CiAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uYmFsYW5jZSArPSBfdmFsdWU7CiAgICAgIHJlcXVpcmUgKGJvdW50aWVzW19ib3VudHlJZF0uYmFsYW5jZSA+PSBib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50KTsKICAgICAgdHJhbnNpdGlvblRvU3RhdGUoX2JvdW50eUlkLCBCb3VudHlTdGFnZXMuQWN0aXZlKTsKCiAgICAgIENvbnRyaWJ1dGlvbkFkZGVkKF9ib3VudHlJZCwgbXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgICAgQm91bnR5QWN0aXZhdGVkKF9ib3VudHlJZCwgbXNnLnNlbmRlcik7CiAgfQoKICBtb2RpZmllciBub3RJc3N1ZXJPckFyYml0ZXIodWludCBfYm91bnR5SWQpIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGJvdW50aWVzW19ib3VudHlJZF0uaXNzdWVyICYmIG1zZy5zZW5kZXIgIT0gYm91bnRpZXNbX2JvdW50eUlkXS5hcmJpdGVyKTsKICAgICAgXzsKICB9CgogIC8vLyBAZGV2IGZ1bGZpbGxCb3VudHkoKTogc3VibWl0IGEgZnVsZmlsbG1lbnQgZm9yIHRoZSBnaXZlbiBib3VudHkKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2RhdGEgdGhlIGRhdGEgYXJ0aWZhY3RzIHJlcHJlc2VudGluZyB0aGUgZnVsZmlsbG1lbnQgb2YgdGhlIGJvdW50eQogIGZ1bmN0aW9uIGZ1bGZpbGxCb3VudHkodWludCBfYm91bnR5SWQsIHN0cmluZyBfZGF0YSkKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIHZhbGlkYXRlTm90VG9vTWFueUZ1bGZpbGxtZW50cyhfYm91bnR5SWQpCiAgICAgIGlzQXRTdGFnZShfYm91bnR5SWQsIEJvdW50eVN0YWdlcy5BY3RpdmUpCiAgICAgIGlzQmVmb3JlRGVhZGxpbmUoX2JvdW50eUlkKQogICAgICBub3RJc3N1ZXJPckFyYml0ZXIoX2JvdW50eUlkKQogIHsKICAgICAgZnVsZmlsbG1lbnRzW19ib3VudHlJZF0ucHVzaChGdWxmaWxsbWVudChmYWxzZSwgbXNnLnNlbmRlciwgX2RhdGEpKTsKCiAgICAgIEJvdW50eUZ1bGZpbGxlZChfYm91bnR5SWQsIG1zZy5zZW5kZXIsIChmdWxmaWxsbWVudHNbX2JvdW50eUlkXS5sZW5ndGggLSAxKSk7CiAgfQoKICAvLy8gQGRldiB1cGRhdGVGdWxmaWxsbWVudCgpOiBTdWJtaXQgdXBkYXRlZCBkYXRhIGZvciBhIGdpdmVuIGZ1bGZpbGxtZW50CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9mdWxmaWxsbWVudElkIHRoZSBpbmRleCBvZiB0aGUgZnVsZmlsbG1lbnQKICAvLy8gQHBhcmFtIF9kYXRhIHRoZSBuZXcgZGF0YSBiZWluZyBzdWJtaXR0ZWQKICBmdW5jdGlvbiB1cGRhdGVGdWxmaWxsbWVudCh1aW50IF9ib3VudHlJZCwgdWludCBfZnVsZmlsbG1lbnRJZCwgc3RyaW5nIF9kYXRhKQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgdmFsaWRhdGVGdWxmaWxsbWVudEFycmF5SW5kZXgoX2JvdW50eUlkLCBfZnVsZmlsbG1lbnRJZCkKICAgICAgb25seUZ1bGZpbGxlcihfYm91bnR5SWQsIF9mdWxmaWxsbWVudElkKQogICAgICBub3RZZXRBY2NlcHRlZChfYm91bnR5SWQsIF9mdWxmaWxsbWVudElkKQogIHsKICAgICAgZnVsZmlsbG1lbnRzW19ib3VudHlJZF1bX2Z1bGZpbGxtZW50SWRdLmRhdGEgPSBfZGF0YTsKICAgICAgRnVsZmlsbG1lbnRVcGRhdGVkKF9ib3VudHlJZCwgX2Z1bGZpbGxtZW50SWQpOwogIH0KCiAgbW9kaWZpZXIgb25seUlzc3Vlck9yQXJiaXRlcih1aW50IF9ib3VudHlJZCkgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYm91bnRpZXNbX2JvdW50eUlkXS5pc3N1ZXIgfHwKICAgICAgICAgKG1zZy5zZW5kZXIgPT0gYm91bnRpZXNbX2JvdW50eUlkXS5hcmJpdGVyICYmIGJvdW50aWVzW19ib3VudHlJZF0uYXJiaXRlciAhPSBhZGRyZXNzKDApKSk7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciBmdWxmaWxsbWVudE5vdFlldEFjY2VwdGVkKHVpbnQgX2JvdW50eUlkLCB1aW50IF9mdWxmaWxsbWVudElkKSB7CiAgICAgIHJlcXVpcmUoZnVsZmlsbG1lbnRzW19ib3VudHlJZF1bX2Z1bGZpbGxtZW50SWRdLmFjY2VwdGVkID09IGZhbHNlKTsKICAgICAgXzsKICB9CgogIG1vZGlmaWVyIGVub3VnaEZ1bmRzVG9QYXkodWludCBfYm91bnR5SWQpIHsKICAgICAgcmVxdWlyZShib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgPj0gYm91bnRpZXNbX2JvdW50eUlkXS5mdWxmaWxsbWVudEFtb3VudCk7CiAgICAgIF87CiAgfQoKICAvLy8gQGRldiBhY2NlcHRGdWxmaWxsbWVudCgpOiBhY2NlcHQgYSBnaXZlbiBmdWxmaWxsbWVudAogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfZnVsZmlsbG1lbnRJZCB0aGUgaW5kZXggb2YgdGhlIGZ1bGZpbGxtZW50IGJlaW5nIGFjY2VwdGVkCiAgZnVuY3Rpb24gYWNjZXB0RnVsZmlsbG1lbnQodWludCBfYm91bnR5SWQsIHVpbnQgX2Z1bGZpbGxtZW50SWQpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICB2YWxpZGF0ZUZ1bGZpbGxtZW50QXJyYXlJbmRleChfYm91bnR5SWQsIF9mdWxmaWxsbWVudElkKQogICAgICBvbmx5SXNzdWVyT3JBcmJpdGVyKF9ib3VudHlJZCkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkFjdGl2ZSkKICAgICAgZnVsZmlsbG1lbnROb3RZZXRBY2NlcHRlZChfYm91bnR5SWQsIF9mdWxmaWxsbWVudElkKQogICAgICBlbm91Z2hGdW5kc1RvUGF5KF9ib3VudHlJZCkKICB7CiAgICAgIGZ1bGZpbGxtZW50c1tfYm91bnR5SWRdW19mdWxmaWxsbWVudElkXS5hY2NlcHRlZCA9IHRydWU7CiAgICAgIG51bUFjY2VwdGVkW19ib3VudHlJZF0rKzsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlIC09IGJvdW50aWVzW19ib3VudHlJZF0uZnVsZmlsbG1lbnRBbW91bnQ7CiAgICAgIGlmIChib3VudGllc1tfYm91bnR5SWRdLnBheXNUb2tlbnMpewogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdHNbX2JvdW50eUlkXS50cmFuc2ZlcihmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uZnVsZmlsbGVyLCBib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZnVsZmlsbG1lbnRzW19ib3VudHlJZF1bX2Z1bGZpbGxtZW50SWRdLmZ1bGZpbGxlci50cmFuc2Zlcihib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50KTsKICAgICAgfQogICAgICBGdWxmaWxsbWVudEFjY2VwdGVkKF9ib3VudHlJZCwgbXNnLnNlbmRlciwgX2Z1bGZpbGxtZW50SWQpOwogIH0KCiAgLy8vIEBkZXYga2lsbEJvdW50eSgpOiBkcmFpbnMgdGhlIGNvbnRyYWN0IG9mIGl0J3MgcmVtYWluaW5nCiAgLy8vIGZ1bmRzLCBhbmQgbW92ZXMgdGhlIGJvdW50eSBpbnRvIHN0YWdlIDMgKGRlYWQpIHNpbmNlIGl0IHdhcwogIC8vLyBlaXRoZXIga2lsbGVkIGluIGRyYWZ0IHN0YWdlLCBvciBuZXZlciBhY2NlcHRlZCBhbnkgZnVsZmlsbG1lbnRzCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICBmdW5jdGlvbiBraWxsQm91bnR5KHVpbnQgX2JvdW50eUlkKQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgb25seUlzc3VlcihfYm91bnR5SWQpCiAgewogICAgICB0cmFuc2l0aW9uVG9TdGF0ZShfYm91bnR5SWQsIEJvdW50eVN0YWdlcy5EZWFkKTsKICAgICAgdWludCBvbGRCYWxhbmNlID0gYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlOwogICAgICBib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgPSAwOwogICAgICBpZiAob2xkQmFsYW5jZSA+IDApewogICAgICAgIGlmIChib3VudGllc1tfYm91bnR5SWRdLnBheXNUb2tlbnMpewogICAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0c1tfYm91bnR5SWRdLnRyYW5zZmVyKGJvdW50aWVzW19ib3VudHlJZF0uaXNzdWVyLCBvbGRCYWxhbmNlKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uaXNzdWVyLnRyYW5zZmVyKG9sZEJhbGFuY2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBCb3VudHlLaWxsZWQoX2JvdW50eUlkLCBtc2cuc2VuZGVyKTsKICB9CgogIG1vZGlmaWVyIG5ld0RlYWRsaW5lSXNWYWxpZCh1aW50IF9ib3VudHlJZCwgdWludCBfbmV3RGVhZGxpbmUpIHsKICAgICAgcmVxdWlyZShfbmV3RGVhZGxpbmUgPiBib3VudGllc1tfYm91bnR5SWRdLmRlYWRsaW5lKTsKICAgICAgXzsKICB9CgogIC8vLyBAZGV2IGV4dGVuZERlYWRsaW5lKCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIGFkZCBtb3JlIHRpbWUgdG8gdGhlCiAgLy8vIGJvdW50eSwgYWxsb3dpbmcgaXQgdG8gY29udGludWUgYWNjZXB0aW5nIGZ1bGZpbGxtZW50cwogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfbmV3RGVhZGxpbmUgdGhlIG5ldyBkZWFkbGluZSBpbiB0aW1lc3RhbXAgZm9ybWF0CiAgZnVuY3Rpb24gZXh0ZW5kRGVhZGxpbmUodWludCBfYm91bnR5SWQsIHVpbnQgX25ld0RlYWRsaW5lKQogICAgICBwdWJsaWMKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgb25seUlzc3VlcihfYm91bnR5SWQpCiAgICAgIG5ld0RlYWRsaW5lSXNWYWxpZChfYm91bnR5SWQsIF9uZXdEZWFkbGluZSkKICB7CiAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uZGVhZGxpbmUgPSBfbmV3RGVhZGxpbmU7CgogICAgICBEZWFkbGluZUV4dGVuZGVkKF9ib3VudHlJZCwgX25ld0RlYWRsaW5lKTsKICB9CgogIC8vLyBAZGV2IHRyYW5zZmVySXNzdWVyKCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIHRyYW5zZmVyIG93bmVyc2hpcCBvZiB0aGUKICAvLy8gYm91bnR5IHRvIHNvbWUgbmV3IGFkZHJlc3MKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX25ld0lzc3VlciB0aGUgYWRkcmVzcyBvZiB0aGUgbmV3IGlzc3VlcgogIGZ1bmN0aW9uIHRyYW5zZmVySXNzdWVyKHVpbnQgX2JvdW50eUlkLCBhZGRyZXNzIF9uZXdJc3N1ZXIpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICB7CiAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uaXNzdWVyID0gX25ld0lzc3VlcjsKICAgICAgSXNzdWVyVHJhbnNmZXJyZWQoX2JvdW50eUlkLCBfbmV3SXNzdWVyKTsKICB9CgoKICAvLy8gQGRldiBjaGFuZ2VCb3VudHlEZWFkbGluZSgpOiBhbGxvd3MgdGhlIGlzc3VlciB0byBjaGFuZ2UgYSBib3VudHkncyBkZWFkbGluZQogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfbmV3RGVhZGxpbmUgdGhlIG5ldyBkZWFkbGluZSBmb3IgdGhlIGJvdW50eQogIGZ1bmN0aW9uIGNoYW5nZUJvdW50eURlYWRsaW5lKHVpbnQgX2JvdW50eUlkLCB1aW50IF9uZXdEZWFkbGluZSkKICAgICAgcHVibGljCiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIG9ubHlJc3N1ZXIoX2JvdW50eUlkKQogICAgICB2YWxpZGF0ZURlYWRsaW5lKF9uZXdEZWFkbGluZSkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkRyYWZ0KQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5kZWFkbGluZSA9IF9uZXdEZWFkbGluZTsKICAgICAgQm91bnR5Q2hhbmdlZChfYm91bnR5SWQpOwogIH0KCiAgLy8vIEBkZXYgY2hhbmdlRGF0YSgpOiBhbGxvd3MgdGhlIGlzc3VlciB0byBjaGFuZ2UgYSBib3VudHkncyBkYXRhCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9uZXdEYXRhIHRoZSBuZXcgcmVxdWlyZW1lbnRzIG9mIHRoZSBib3VudHkKICBmdW5jdGlvbiBjaGFuZ2VCb3VudHlEYXRhKHVpbnQgX2JvdW50eUlkLCBzdHJpbmcgX25ld0RhdGEpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkRyYWZ0KQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5kYXRhID0gX25ld0RhdGE7CiAgICAgIEJvdW50eUNoYW5nZWQoX2JvdW50eUlkKTsKICB9CgogIC8vLyBAZGV2IGNoYW5nZUJvdW50eWZ1bGZpbGxtZW50QW1vdW50KCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIGNoYW5nZSBhIGJvdW50eSdzIGZ1bGZpbGxtZW50IGFtb3VudAogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfbmV3RnVsZmlsbG1lbnRBbW91bnQgdGhlIG5ldyBmdWxmaWxsbWVudCBhbW91bnQKICBmdW5jdGlvbiBjaGFuZ2VCb3VudHlGdWxmaWxsbWVudEFtb3VudCh1aW50IF9ib3VudHlJZCwgdWludCBfbmV3RnVsZmlsbG1lbnRBbW91bnQpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkRyYWZ0KQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5mdWxmaWxsbWVudEFtb3VudCA9IF9uZXdGdWxmaWxsbWVudEFtb3VudDsKICAgICAgQm91bnR5Q2hhbmdlZChfYm91bnR5SWQpOwogIH0KCiAgLy8vIEBkZXYgY2hhbmdlQm91bnR5QXJiaXRlcigpOiBhbGxvd3MgdGhlIGlzc3VlciB0byBjaGFuZ2UgYSBib3VudHkncyBhcmJpdGVyCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9uZXdBcmJpdGVyIHRoZSBuZXcgYWRkcmVzcyBvZiB0aGUgYXJiaXRlcgogIGZ1bmN0aW9uIGNoYW5nZUJvdW50eUFyYml0ZXIodWludCBfYm91bnR5SWQsIGFkZHJlc3MgX25ld0FyYml0ZXIpCiAgICAgIHB1YmxpYwogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgaXNBdFN0YWdlKF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzLkRyYWZ0KQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5hcmJpdGVyID0gX25ld0FyYml0ZXI7CiAgICAgIEJvdW50eUNoYW5nZWQoX2JvdW50eUlkKTsKICB9CgogIG1vZGlmaWVyIG5ld0Z1bGZpbGxtZW50QW1vdW50SXNJbmNyZWFzZSh1aW50IF9ib3VudHlJZCwgdWludCBfbmV3RnVsZmlsbG1lbnRBbW91bnQpIHsKICAgICAgcmVxdWlyZShib3VudGllc1tfYm91bnR5SWRdLmZ1bGZpbGxtZW50QW1vdW50IDwgX25ld0Z1bGZpbGxtZW50QW1vdW50KTsKICAgICAgXzsKICB9CgogIC8vLyBAZGV2IGluY3JlYXNlUGF5b3V0KCk6IGFsbG93cyB0aGUgaXNzdWVyIHRvIGluY3JlYXNlIGEgZ2l2ZW4gZnVsZmlsbG1lbnQKICAvLy8gYW1vdW50IGluIHRoZSBhY3RpdmUgc3RhZ2UKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX25ld0Z1bGZpbGxtZW50QW1vdW50IHRoZSBuZXcgZnVsZmlsbG1lbnQgYW1vdW50CiAgLy8vIEBwYXJhbSBfdmFsdWUgdGhlIHZhbHVlIG9mIHRoZSBhZGRpdGlvbmFsIGRlcG9zaXQgYmVpbmcgYWRkZWQKICBmdW5jdGlvbiBpbmNyZWFzZVBheW91dCh1aW50IF9ib3VudHlJZCwgdWludCBfbmV3RnVsZmlsbG1lbnRBbW91bnQsIHVpbnQgX3ZhbHVlKQogICAgICBwdWJsaWMKICAgICAgcGF5YWJsZQogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICBvbmx5SXNzdWVyKF9ib3VudHlJZCkKICAgICAgbmV3RnVsZmlsbG1lbnRBbW91bnRJc0luY3JlYXNlKF9ib3VudHlJZCwgX25ld0Z1bGZpbGxtZW50QW1vdW50KQogICAgICB0cmFuc2ZlcnJlZEFtb3VudEVxdWFsc1ZhbHVlKF9ib3VudHlJZCwgX3ZhbHVlKQogIHsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlICs9IF92YWx1ZTsKICAgICAgcmVxdWlyZShib3VudGllc1tfYm91bnR5SWRdLmJhbGFuY2UgPj0gX25ld0Z1bGZpbGxtZW50QW1vdW50KTsKICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5mdWxmaWxsbWVudEFtb3VudCA9IF9uZXdGdWxmaWxsbWVudEFtb3VudDsKICAgICAgUGF5b3V0SW5jcmVhc2VkKF9ib3VudHlJZCwgX25ld0Z1bGZpbGxtZW50QW1vdW50KTsKICB9CgogIC8vLyBAZGV2IGdldEZ1bGZpbGxtZW50KCk6IFJldHVybnMgdGhlIGZ1bGZpbGxtZW50IGF0IGEgZ2l2ZW4gaW5kZXgKICAvLy8gQHBhcmFtIF9ib3VudHlJZCB0aGUgaW5kZXggb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2Z1bGZpbGxtZW50SWQgdGhlIGluZGV4IG9mIHRoZSBmdWxmaWxsbWVudCB0byByZXR1cm4KICAvLy8gQHJldHVybiBSZXR1cm5zIGEgdHVwbGUgZm9yIHRoZSBmdWxmaWxsbWVudAogIGZ1bmN0aW9uIGdldEZ1bGZpbGxtZW50KHVpbnQgX2JvdW50eUlkLCB1aW50IF9mdWxmaWxsbWVudElkKQogICAgICBwdWJsaWMKICAgICAgY29uc3RhbnQKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgdmFsaWRhdGVGdWxmaWxsbWVudEFycmF5SW5kZXgoX2JvdW50eUlkLCBfZnVsZmlsbG1lbnRJZCkKICAgICAgcmV0dXJucyAoYm9vbCwgYWRkcmVzcywgc3RyaW5nKQogIHsKICAgICAgcmV0dXJuIChmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uYWNjZXB0ZWQsCiAgICAgICAgICAgICAgZnVsZmlsbG1lbnRzW19ib3VudHlJZF1bX2Z1bGZpbGxtZW50SWRdLmZ1bGZpbGxlciwKICAgICAgICAgICAgICBmdWxmaWxsbWVudHNbX2JvdW50eUlkXVtfZnVsZmlsbG1lbnRJZF0uZGF0YSk7CiAgfQoKICAvLy8gQGRldiBnZXRCb3VudHkoKTogUmV0dXJucyB0aGUgZGV0YWlscyBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHJldHVybiBSZXR1cm5zIGEgdHVwbGUgZm9yIHRoZSBib3VudHkKICBmdW5jdGlvbiBnZXRCb3VudHkodWludCBfYm91bnR5SWQpCiAgICAgIHB1YmxpYwogICAgICBjb25zdGFudAogICAgICB2YWxpZGF0ZUJvdW50eUFycmF5SW5kZXgoX2JvdW50eUlkKQogICAgICByZXR1cm5zIChhZGRyZXNzLCB1aW50LCB1aW50LCBib29sLCB1aW50LCB1aW50KQogIHsKICAgICAgcmV0dXJuIChib3VudGllc1tfYm91bnR5SWRdLmlzc3VlciwKICAgICAgICAgICAgICBib3VudGllc1tfYm91bnR5SWRdLmRlYWRsaW5lLAogICAgICAgICAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uZnVsZmlsbG1lbnRBbW91bnQsCiAgICAgICAgICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5wYXlzVG9rZW5zLAogICAgICAgICAgICAgIHVpbnQoYm91bnRpZXNbX2JvdW50eUlkXS5ib3VudHlTdGFnZSksCiAgICAgICAgICAgICAgYm91bnRpZXNbX2JvdW50eUlkXS5iYWxhbmNlKTsKICB9CgogIC8vLyBAZGV2IGdldEJvdW50eUFyYml0ZXIoKTogUmV0dXJucyB0aGUgYXJiaXRlciBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHJldHVybiBSZXR1cm5zIGFuIGFkZHJlc3MgZm9yIHRoZSBhcmJpdGVyIG9mIHRoZSBib3VudHkKICBmdW5jdGlvbiBnZXRCb3VudHlBcmJpdGVyKHVpbnQgX2JvdW50eUlkKQogICAgICBwdWJsaWMKICAgICAgY29uc3RhbnQKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgcmV0dXJucyAoYWRkcmVzcykKICB7CiAgICAgIHJldHVybiAoYm91bnRpZXNbX2JvdW50eUlkXS5hcmJpdGVyKTsKICB9CgogIC8vLyBAZGV2IGdldEJvdW50eURhdGEoKTogUmV0dXJucyB0aGUgZGF0YSBvZiB0aGUgYm91bnR5CiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHJldHVybiBSZXR1cm5zIGEgc3RyaW5nIGZvciB0aGUgYm91bnR5IGRhdGEKICBmdW5jdGlvbiBnZXRCb3VudHlEYXRhKHVpbnQgX2JvdW50eUlkKQogICAgICBwdWJsaWMKICAgICAgY29uc3RhbnQKICAgICAgdmFsaWRhdGVCb3VudHlBcnJheUluZGV4KF9ib3VudHlJZCkKICAgICAgcmV0dXJucyAoc3RyaW5nKQogIHsKICAgICAgcmV0dXJuIChib3VudGllc1tfYm91bnR5SWRdLmRhdGEpOwogIH0KCiAgLy8vIEBkZXYgZ2V0Qm91bnR5VG9rZW4oKTogUmV0dXJucyB0aGUgdG9rZW4gY29udHJhY3Qgb2YgdGhlIGJvdW50eQogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEByZXR1cm4gUmV0dXJucyBhbiBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdGhhdCB0aGUgYm91bnR5IHVzZXMKICBmdW5jdGlvbiBnZXRCb3VudHlUb2tlbih1aW50IF9ib3VudHlJZCkKICAgICAgcHVibGljCiAgICAgIGNvbnN0YW50CiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIHJldHVybnMgKGFkZHJlc3MpCiAgewogICAgICByZXR1cm4gKHRva2VuQ29udHJhY3RzW19ib3VudHlJZF0pOwogIH0KCiAgLy8vIEBkZXYgZ2V0TnVtQm91bnRpZXMoKSByZXR1cm5zIHRoZSBudW1iZXIgb2YgYm91bnRpZXMgaW4gdGhlIHJlZ2lzdHJ5CiAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGJvdW50aWVzCiAgZnVuY3Rpb24gZ2V0TnVtQm91bnRpZXMoKQogICAgICBwdWJsaWMKICAgICAgY29uc3RhbnQKICAgICAgcmV0dXJucyAodWludCkKICB7CiAgICAgIHJldHVybiBib3VudGllcy5sZW5ndGg7CiAgfQoKICAvLy8gQGRldiBnZXROdW1GdWxmaWxsbWVudHMoKSByZXR1cm5zIHRoZSBudW1iZXIgb2YgZnVsZmlsbG1lbnRzIGZvciBhIGdpdmVuIG1pbGVzdG9uZQogIC8vLyBAcGFyYW0gX2JvdW50eUlkIHRoZSBpbmRleCBvZiB0aGUgYm91bnR5CiAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGZ1bGZpbGxtZW50cwogIGZ1bmN0aW9uIGdldE51bUZ1bGZpbGxtZW50cyh1aW50IF9ib3VudHlJZCkKICAgICAgcHVibGljCiAgICAgIGNvbnN0YW50CiAgICAgIHZhbGlkYXRlQm91bnR5QXJyYXlJbmRleChfYm91bnR5SWQpCiAgICAgIHJldHVybnMgKHVpbnQpCiAgewogICAgICByZXR1cm4gZnVsZmlsbG1lbnRzW19ib3VudHlJZF0ubGVuZ3RoOwogIH0KCiAgLyoKICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMKICAgKi8KCiAgLy8vIEBkZXYgdHJhbnNpdGlvblRvU3RhdGUoKTogdHJhbnNpdGlvbnMgdGhlIGNvbnRyYWN0IHRvIHRoZQogIC8vLyBzdGF0ZSBwYXNzZWQgaW4gdGhlIHBhcmFtZXRlciBgX25ld1N0YWdlYCBnaXZlbiB0aGUKICAvLy8gY29uZGl0aW9ucyBzdGF0ZWQgaW4gdGhlIGJvZHkgb2YgdGhlIGZ1bmN0aW9uCiAgLy8vIEBwYXJhbSBfYm91bnR5SWQgdGhlIGluZGV4IG9mIHRoZSBib3VudHkKICAvLy8gQHBhcmFtIF9uZXdTdGFnZSB0aGUgbmV3IHN0YWdlIHRvIHRyYW5zaXRpb24gdG8KICBmdW5jdGlvbiB0cmFuc2l0aW9uVG9TdGF0ZSh1aW50IF9ib3VudHlJZCwgQm91bnR5U3RhZ2VzIF9uZXdTdGFnZSkKICAgICAgaW50ZXJuYWwKICB7CiAgICAgIGJvdW50aWVzW19ib3VudHlJZF0uYm91bnR5U3RhZ2UgPSBfbmV3U3RhZ2U7CiAgfQp9'.
	

]
