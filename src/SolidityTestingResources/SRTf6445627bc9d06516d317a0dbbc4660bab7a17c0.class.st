Class {
	#name : #SRTf6445627bc9d06516d317a0dbbc4660bab7a17c0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf6445627bc9d06516d317a0dbbc4660bab7a17c0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyBEZXBsb3llZCA8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iOWZlOGY2ZjNmM2RmZmFlYmY3ZjlmNmYxZmFlN2IxZmNmMGYyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPiAzMS8xMi8xNwoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgoKY29udHJhY3QgVXBncmFkZWRTdGFuZGFyZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewogICAgLy8gdGhvc2UgbWV0aG9kcyBhcmUgY2FsbGVkIGJ5IHRoZSBsZWdhY3kgY29udHJhY3QKICAgIC8vIGFuZCB0aGV5IG11c3QgZW5zdXJlIG1zZy5zZW5kZXIgdG8gYmUgdGhlIGNvbnRyYWN0IGFkZHJlc3MKICAgIHVpbnQgcHVibGljIF90b3RhbFN1cHBseTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyQnlMZWdhY3koYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb21CeUxlZ2FjeShhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmVCeUxlZ2FjeShhZGRyZXNzIGZyb20sIGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbEJ5TGVnYWN5KGFkZHJlc3MgZnJvbSwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IGFkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWxCeUxlZ2FjeShhZGRyZXNzIGZyb20sIGFkZHJlc3Mgc3BlbmRlciwgdWludCBzdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbldpdGhGZWVzIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAvLyBBZGRpdGlvbmFsIHZhcmlhYmxlcyBmb3IgdXNlIGlmIHRyYW5zYWN0aW9uIGZlZXMgZXZlciBiZWNhbWUgbmVjZXNzYXJ5CiAgdWludDI1NiBwdWJsaWMgYmFzaXNQb2ludHNSYXRlID0gMDsKICB1aW50MjU2IHB1YmxpYyBtYXhpbXVtRmVlID0gMDsKICB1aW50MjU2IGNvbnN0YW50IE1BWF9TRVRUQUJMRV9CQVNJU19QT0lOVFMgPSAyMDsKICB1aW50MjU2IGNvbnN0YW50IE1BWF9TRVRUQUJMRV9GRUUgPSA1MDsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lOwogIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICB1aW50IHB1YmxpYyBfdG90YWxTdXBwbHk7CgogIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9VSU5UID0gMioqMjU2IC0gMTsKCiAgZnVuY3Rpb24gY2FsY0ZlZSh1aW50IF92YWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgZmVlID0gKF92YWx1ZS5tdWwoYmFzaXNQb2ludHNSYXRlKSkuZGl2KDEwMDAwKTsKICAgIGlmIChmZWUgPiBtYXhpbXVtRmVlKSB7CiAgICAgICAgZmVlID0gbWF4aW11bUZlZTsKICAgIH0KICAgIHJldHVybiBmZWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IGZlZSA9IGNhbGNGZWUoX3ZhbHVlKTsKICAgIHVpbnQgc2VuZEFtb3VudCA9IF92YWx1ZS5zdWIoZmVlKTsKCiAgICBzdXBlci50cmFuc2ZlcihfdG8sIHNlbmRBbW91bnQpOwogICAgaWYgKGZlZSA+IDApIHsKICAgICAgc3VwZXIudHJhbnNmZXIob3duZXIsIGZlZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIHVpbnQgZmVlID0gY2FsY0ZlZShfdmFsdWUpOwogICAgdWludCBzZW5kQW1vdW50ID0gX3ZhbHVlLnN1YihmZWUpOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChzZW5kQW1vdW50KTsKICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IE1BWF9VSU5UKSB7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIH0KICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIHNlbmRBbW91bnQpOwogICAgaWYgKGZlZSA+IDApIHsKICAgICAgYmFsYW5jZXNbb3duZXJdID0gYmFsYW5jZXNbb3duZXJdLmFkZChmZWUpOwogICAgICBUcmFuc2ZlcihfZnJvbSwgb3duZXIsIGZlZSk7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHNldFBhcmFtcyh1aW50IG5ld0Jhc2lzUG9pbnRzLCB1aW50IG5ld01heEZlZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIC8vIEVuc3VyZSB0cmFuc3BhcmVuY3kgYnkgaGFyZGNvZGluZyBsaW1pdCBiZXlvbmQgd2hpY2ggZmVlcyBjYW4gbmV2ZXIgYmUgYWRkZWQKICAgICAgcmVxdWlyZShuZXdCYXNpc1BvaW50cyA8IE1BWF9TRVRUQUJMRV9CQVNJU19QT0lOVFMpOwogICAgICByZXF1aXJlKG5ld01heEZlZSA8IE1BWF9TRVRUQUJMRV9GRUUpOwoKICAgICAgYmFzaXNQb2ludHNSYXRlID0gbmV3QmFzaXNQb2ludHM7CiAgICAgIG1heGltdW1GZWUgPSBuZXdNYXhGZWUubXVsKHVpbnQoMTApKipkZWNpbWFscyk7CgogICAgICBQYXJhbXMoYmFzaXNQb2ludHNSYXRlLCBtYXhpbXVtRmVlKTsKICB9CgogIC8vIENhbGxlZCBpZiBjb250cmFjdCBldmVyIGFkZHMgZmVlcwogIGV2ZW50IFBhcmFtcyh1aW50IGZlZUJhc2lzUG9pbnRzLCB1aW50IG1heEZlZSk7Cgp9CgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgovLy8gQHRpdGxlIFdoaXRlbGlzdCBjb250cmFjdCAtIE9ubHkgYWRkcmVzc2VzIHdoaWNoIGFyZSByZWdpc3RlcmVkIGFzIHBhcnQgb2YgdGhlIG1hcmtldCBtYWtlciBsb3lhbHR5IHNjaGVtZSBjYW4gYmUgd2hpdGVsaXN0ZWQgdG8gZWFybiBhbmQgb3duIE5lY3RhciB0b2tlbnMKY29udHJhY3QgV2hpdGVsaXN0IGlzIE93bmFibGUgewoKICBib29sIHB1YmxpYyBsaXN0QWN0aXZlID0gdHJ1ZTsKCiAgLy8gT25seSB1c2VycyB3aG8gYXJlIG9uIHRoZSB3aGl0ZWxpc3QKICBmdW5jdGlvbiBpc1JlZ2lzdGVyZWQoYWRkcmVzcyBfdXNlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGlmICghbGlzdEFjdGl2ZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBpc09uTGlzdFtfdXNlcl07CiAgICB9CiAgfQoKICAvLyBPbmx5IGF1dGhvcmlzZWQgc291cmNlcy9jb250cmFjdHMgY2FuIGNvbnRyaWJ1dGUgZmVlcyBvbiBiZWhhbGYgb2YgbWFrZXJzIHRvIGVhcm4gdG9rZW5zCiAgbW9kaWZpZXIgYXV0aG9yaXNlZCAoKSB7CiAgICByZXF1aXJlKGlzQXV0aG9yaXNlZE1ha2VyW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvLyBUaGlzIGlzIHRoZSB3aGl0ZWxpc3Qgb2YgdXNlcnMgd2hvIGFyZSByZWdpc3RlcmVkIHRvIGJlIGFibGUgdG8gb3duIHRoZSB0b2tlbnMKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc09uTGlzdDsKCiAgLy8gVGhpcyBpcyBhIG1vcmUgc2VsZWN0IGxpc3Qgb2YgYSBmZXcgY29udHJhY3RzIG9yIGFkZHJlc3NlcyB3aGljaCBjYW4gY29udHJpYnV0ZSBmZWVzIG9uIGJlaGFsZiBvZiBtYWtlcnMsIHRvIGdlbmVyYXRlIHRva2VucwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzQXV0aG9yaXNlZE1ha2VyOwoKCiAgLy8vIEBkZXYgcmVnaXN0ZXIKICAvLy8gQHBhcmFtIG5ld1VzZXJzIC0gQXJyYXkgb2YgdXNlcnMgdG8gYWRkIHRvIHRoZSB3aGl0ZWxpc3QKICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzW10gbmV3VXNlcnMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbmV3VXNlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgaXNPbkxpc3RbbmV3VXNlcnNbaV1dID0gdHJ1ZTsKICAgIH0KICB9CgogIC8vLyBAZGV2IGRlcmVnaXN0ZXIKICAvLy8gQHBhcmFtIGJhbm5lZFVzZXJzIC0gQXJyYXkgb2YgdXNlcnMgdG8gcmVtb3ZlIGZyb20gdGhlIHdoaXRlbGlzdAogIGZ1bmN0aW9uIGRlcmVnaXN0ZXIoYWRkcmVzc1tdIGJhbm5lZFVzZXJzKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGZvciAodWludCBpID0gMDsgaSA8IGJhbm5lZFVzZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlzT25MaXN0W2Jhbm5lZFVzZXJzW2ldXSA9IGZhbHNlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgYXV0aG9yaXNlTWFrZXIKICAvLy8gQHBhcmFtIG1ha2VyIC0gU291cmNlIHRvIGFkZCB0byBhdXRob3Jpc2VkIGNvbnRyaWJ1dG9ycwogIGZ1bmN0aW9uIGF1dGhvcmlzZU1ha2VyKGFkZHJlc3MgbWFrZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICBpc0F1dGhvcmlzZWRNYWtlclttYWtlcl0gPSB0cnVlOwogICAgICAvLyBBbHNvIGFkZCBhbnkgYXV0aG9yaXNlZCBNYWtlciB0byB0aGUgd2hpdGVsaXN0CiAgICAgIGFkZHJlc3NbXSBtZW1vcnkgbWFrZXJzID0gbmV3IGFkZHJlc3NbXSgxKTsKICAgICAgbWFrZXJzWzBdID0gbWFrZXI7CiAgICAgIHJlZ2lzdGVyKG1ha2Vycyk7CiAgfQoKICAvLy8gQGRldiBkZWF1dGhvcmlzZU1ha2VyCiAgLy8vIEBwYXJhbSBtYWtlciAtIFNvdXJjZSB0byByZW1vdmUgZnJvbSBhdXRob3Jpc2VkIGNvbnRyaWJ1dG9ycwogIGZ1bmN0aW9uIGRlYXV0aG9yaXNlTWFrZXIoYWRkcmVzcyBtYWtlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgIGlzQXV0aG9yaXNlZE1ha2VyW21ha2VyXSA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gYWN0aXZhdGVXaGl0ZWxpc3QoYm9vbCBuZXdTZXR0aW5nKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgbGlzdEFjdGl2ZSA9IG5ld1NldHRpbmc7CiAgfQoKICAvLy8vLy8vIEdldHRlcnMgdG8gYWxsb3cgdGhlIHNhbWUgd2hpdGVsaXN0IHRvIGJlIHVzZWQgYWxzbyBieSBvdGhlciBjb250cmFjdHMgKGluY2x1ZGluZyB1cGdyYWRlZCBDb250cm9sbGVycykgLy8vLy8vLwoKICBmdW5jdGlvbiBnZXRSZWdpc3RyYXRpb25TdGF0dXMoYWRkcmVzcyBfdXNlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGlzT25MaXN0W191c2VyXTsKICB9CgogIGZ1bmN0aW9uIGdldEF1dGhvcmlzYXRpb25TdGF0dXMoYWRkcmVzcyBfbWFrZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBpc0F1dGhvcmlzZWRNYWtlcltfbWFrZXJdOwogIH0KCiAgZnVuY3Rpb24gZ2V0T3duZXIoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gb3duZXI7CiAgfQoKCn0KCmNvbnRyYWN0IFRldGhlclRva2VuIGlzIFBhdXNhYmxlLCBTdGFuZGFyZFRva2VuV2l0aEZlZXMsIFdoaXRlbGlzdCB7CgogICAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZWRBZGRyZXNzOwogICAgYm9vbCBwdWJsaWMgZGVwcmVjYXRlZDsKCiAgICAvLyAgVGhlIGNvbnRyYWN0IGNhbiBiZSBpbml0aWFsaXplZCB3aXRoIGEgbnVtYmVyIG9mIHRva2VucwogICAgLy8gIEFsbCB0aGUgdG9rZW5zIGFyZSBkZXBvc2l0ZWQgdG8gdGhlIG93bmVyIGFkZHJlc3MKICAgIC8vCiAgICAvLyBAcGFyYW0gX2JhbGFuY2UgSW5pdGlhbCBzdXBwbHkgb2YgdGhlIGNvbnRyYWN0CiAgICAvLyBAcGFyYW0gX25hbWUgVG9rZW4gTmFtZQogICAgLy8gQHBhcmFtIF9zeW1ib2wgVG9rZW4gc3ltYm9sCiAgICAvLyBAcGFyYW0gX2RlY2ltYWxzIFRva2VuIGRlY2ltYWxzCiAgICBmdW5jdGlvbiBUZXRoZXJUb2tlbih1aW50IF9pbml0aWFsU3VwcGx5LCBzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpIHB1YmxpYyB7CiAgICAgICAgX3RvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gX2luaXRpYWxTdXBwbHk7CiAgICAgICAgZGVwcmVjYXRlZCA9IGZhbHNlOwogICAgfQoKICAgIC8vIEZvcndhcmQgRVJDMjAgbWV0aG9kcyB0byB1cGdyYWRlZCBjb250cmFjdCBpZiB0aGlzIG9uZSBpcyBkZXByZWNhdGVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGlzUmVnaXN0ZXJlZChtc2cuc2VuZGVyKSk7CiAgICAgICAgaWYgKGRlcHJlY2F0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFVwZ3JhZGVkU3RhbmRhcmRUb2tlbih1cGdyYWRlZEFkZHJlc3MpLnRyYW5zZmVyQnlMZWdhY3kobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEZvcndhcmQgRVJDMjAgbWV0aG9kcyB0byB1cGdyYWRlZCBjb250cmFjdCBpZiB0aGlzIG9uZSBpcyBkZXByZWNhdGVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShpc1JlZ2lzdGVyZWQoX2Zyb20pKTsKICAgICAgICBpZiAoZGVwcmVjYXRlZCkgewogICAgICAgICAgICByZXR1cm4gVXBncmFkZWRTdGFuZGFyZFRva2VuKHVwZ3JhZGVkQWRkcmVzcykudHJhbnNmZXJGcm9tQnlMZWdhY3kobXNnLnNlbmRlciwgX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEZvcndhcmQgRVJDMjAgbWV0aG9kcyB0byB1cGdyYWRlZCBjb250cmFjdCBpZiB0aGlzIG9uZSBpcyBkZXByZWNhdGVkCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGRlcHJlY2F0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFVwZ3JhZGVkU3RhbmRhcmRUb2tlbih1cGdyYWRlZEFkZHJlc3MpLmJhbGFuY2VPZih3aG8pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5iYWxhbmNlT2Yod2hvKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQWxsb3cgY2hlY2tzIG9mIGJhbGFuY2UgYXQgdGltZSBvZiBkZXByZWNhdGlvbgogICAgZnVuY3Rpb24gb2xkQmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChkZXByZWNhdGVkKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5iYWxhbmNlT2Yod2hvKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gRm9yd2FyZCBFUkMyMCBtZXRob2RzIHRvIHVwZ3JhZGVkIGNvbnRyYWN0IGlmIHRoaXMgb25lIGlzIGRlcHJlY2F0ZWQKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoZGVwcmVjYXRlZCkgewogICAgICAgICAgICByZXR1cm4gVXBncmFkZWRTdGFuZGFyZFRva2VuKHVwZ3JhZGVkQWRkcmVzcykuYXBwcm92ZUJ5TGVnYWN5KG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoZGVwcmVjYXRlZCkgewogICAgICAgICAgICByZXR1cm4gVXBncmFkZWRTdGFuZGFyZFRva2VuKHVwZ3JhZGVkQWRkcmVzcykuaW5jcmVhc2VBcHByb3ZhbEJ5TGVnYWN5KG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYWRkZWRWYWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoZGVwcmVjYXRlZCkgewogICAgICAgICAgICByZXR1cm4gVXBncmFkZWRTdGFuZGFyZFRva2VuKHVwZ3JhZGVkQWRkcmVzcykuZGVjcmVhc2VBcHByb3ZhbEJ5TGVnYWN5KG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gc3VwZXIuZGVjcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEZvcndhcmQgRVJDMjAgbWV0aG9kcyB0byB1cGdyYWRlZCBjb250cmFjdCBpZiB0aGlzIG9uZSBpcyBkZXByZWNhdGVkCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgICAgIGlmIChkZXByZWNhdGVkKSB7CiAgICAgICAgICAgIHJldHVybiBTdGFuZGFyZFRva2VuKHVwZ3JhZGVkQWRkcmVzcykuYWxsb3dhbmNlKF9vd25lciwgX3NwZW5kZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5hbGxvd2FuY2UoX293bmVyLCBfc3BlbmRlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGRlcHJlY2F0ZSBjdXJyZW50IGNvbnRyYWN0IGluIGZhdm91ciBvZiBhIG5ldyBvbmUKICAgIGZ1bmN0aW9uIGRlcHJlY2F0ZShhZGRyZXNzIF91cGdyYWRlZEFkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3VwZ3JhZGVkQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBkZXByZWNhdGVkID0gdHJ1ZTsKICAgICAgICB1cGdyYWRlZEFkZHJlc3MgPSBfdXBncmFkZWRBZGRyZXNzOwogICAgICAgIERlcHJlY2F0ZShfdXBncmFkZWRBZGRyZXNzKTsKICAgIH0KCiAgICAvLyBkZXByZWNhdGUgY3VycmVudCBjb250cmFjdCBpZiBmYXZvdXIgb2YgYSBuZXcgb25lCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGRlcHJlY2F0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFN0YW5kYXJkVG9rZW4odXBncmFkZWRBZGRyZXNzKS50b3RhbFN1cHBseSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBfdG90YWxTdXBwbHk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIElzc3VlIGEgbmV3IGFtb3VudCBvZiB0b2tlbnMKICAgIC8vIHRoZXNlIHRva2VucyBhcmUgZGVwb3NpdGVkIGludG8gdGhlIG93bmVyIGFkZHJlc3MKICAgIC8vCiAgICAvLyBAcGFyYW0gX2Ftb3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIGJlIGlzc3VlZAogICAgZnVuY3Rpb24gaXNzdWUodWludCBhbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGJhbGFuY2VzW293bmVyXS5hZGQoYW1vdW50KTsKICAgICAgICBfdG90YWxTdXBwbHkgPSBfdG90YWxTdXBwbHkuYWRkKGFtb3VudCk7CiAgICAgICAgSXNzdWUoYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBvd25lciwgYW1vdW50KTsKICAgIH0KCiAgICAvLyBSZWRlZW0gdG9rZW5zLgogICAgLy8gVGhlc2UgdG9rZW5zIGFyZSB3aXRoZHJhd24gZnJvbSB0aGUgb3duZXIgYWRkcmVzcwogICAgLy8gaWYgdGhlIGJhbGFuY2UgbXVzdCBiZSBlbm91Z2ggdG8gY292ZXIgdGhlIHJlZGVlbQogICAgLy8gb3IgdGhlIGNhbGwgd2lsbCBmYWlsLgogICAgLy8gQHBhcmFtIF9hbW91bnQgTnVtYmVyIG9mIHRva2VucyB0byBiZSBpc3N1ZWQKICAgIGZ1bmN0aW9uIHJlZGVlbSh1aW50IGFtb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgX3RvdGFsU3VwcGx5ID0gX3RvdGFsU3VwcGx5LnN1YihhbW91bnQpOwogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGJhbGFuY2VzW293bmVyXS5zdWIoYW1vdW50KTsKICAgICAgICBSZWRlZW0oYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihvd25lciwgYWRkcmVzcygwKSwgYW1vdW50KTsKICAgIH0KCiAgICAvLyBDYWxsZWQgd2hlbiBuZXcgdG9rZW4gYXJlIGlzc3VlZAogICAgZXZlbnQgSXNzdWUodWludCBhbW91bnQpOwoKICAgIC8vIENhbGxlZCB3aGVuIHRva2VucyBhcmUgcmVkZWVtZWQKICAgIGV2ZW50IFJlZGVlbSh1aW50IGFtb3VudCk7CgogICAgLy8gQ2FsbGVkIHdoZW4gY29udHJhY3QgaXMgZGVwcmVjYXRlZAogICAgZXZlbnQgRGVwcmVjYXRlKGFkZHJlc3MgbmV3QWRkcmVzcyk7Cgp9'.
	

]
