Class {
	#name : #SRT58F792248d5fE5cadcc8Cc222eAA97c1F4089F8b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT58F792248d5fE5cadcc8Cc222eAA97c1F4089F8b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNjsKCi8qCiAqCiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLgogKgogKiBUaGUgTWFuYWdlciBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciB0aGUgbWFuYWdlbWVudCBvZiBhY2NvdW50cyBhbmQgdG9rZW5zLgogKgogKiBSZWNpcGllbnQgaXMgMCBmb3IgdGhlIERhbyBhY2NvdW50IG1hbmFnZXIgYW5kIHRoZSBhZGRyZXNzIG9mCiAqIGNvbnRyYWN0b3IncyByZWNpcGllbnQgZm9yIHRoZSBjb250cmFjdG9ycydzIG1haGFnZXJzLgogKgoqLwoKLy8vIEB0aXRsZSBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IG9mIHRoZSBQYXNzIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbmlzYXRpb24KY29udHJhY3QgUGFzc01hbmFnZXJJbnRlcmZhY2UgewoKICAgIHN0cnVjdCBwcm9wb3NhbCB7CiAgICAgICAgLy8gQW1vdW50IChpbiB3ZWkpIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIHVpbnQgYW1vdW50OwogICAgICAgIC8vIEEgZGVzY3JpcHRpb24gb2YgdGhlIHByb3Bvc2FsCiAgICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uOwogICAgICAgIC8vIFRoZSBoYXNoIG9mIHRoZSBwcm9wb3NhbCdzIGRvY3VtZW50CiAgICAgICAgYnl0ZXMzMiBoYXNoT2ZUaGVEb2N1bWVudDsKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSB3aGVuIHRoZSBwcm9wb3NhbCB3YXMgY3JlYXRlZAogICAgICAgIHVpbnQgZGF0ZU9mUHJvcG9zYWw7CiAgICAgICAgLy8gVGhlIGluZGV4IG9mIHRoZSBsYXN0IGFwcHJvdmVkIGNsaWVudCBwcm9wb3NhbAogICAgICAgIHVpbnQgbGFzdENsaWVudFByb3Bvc2FsSUQ7CiAgICAgICAgLy8gVGhlIHN1bSBhbW91bnQgKGluIHdlaSkgb3JkZXJlZCBmb3IgdGhpcyBwcm9wb3NhbCAKICAgICAgICB1aW50IG9yZGVyQW1vdW50OwogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBkYXRlIG9mIHRoZSBsYXN0IG9yZGVyIGZvciB0aGUgYXBwcm92ZWQgcHJvcG9zYWwKICAgICAgICB1aW50IGRhdGVPZk9yZGVyOwogICAgfQogICAgICAgIAogICAgLy8gUHJvcG9zYWxzIHRvIHdvcmsgZm9yIHRoZSBjbGllbnQKICAgIHByb3Bvc2FsW10gcHVibGljIHByb3Bvc2FsczsKCiAgICBzdHJ1Y3QgZnVuZGluZ0RhdGEgewogICAgICAgIC8vIFRydWUgaWYgcHVibGljIGZ1bmRpbmcgd2l0aG91dCBhIG1haW4gcGFydG5lcgogICAgICAgIGJvb2wgcHVibGljQ3JlYXRpb247IAogICAgICAgIC8vIFRoZSBhZGRyZXNzIHdoaWNoIHNldHMgcGFydG5lcnMgYW5kIG1hbmFnZXMgdGhlIGZ1bmRpbmcgaW4gY2FzZSBvZiBwcml2YXRlIGZ1bmRpbmcKICAgICAgICBhZGRyZXNzIG1haW5QYXJ0bmVyOwogICAgICAgIC8vIFRoZSBtYXhpbXVtIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgZnVuZGluZwogICAgICAgIHVpbnQgbWF4QW1vdW50VG9GdW5kOwogICAgICAgIC8vIFRoZSBhY3R1YWwgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQogICAgICAgIHVpbnQgZnVuZGVkQW1vdW50OwogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBzdGFydCB0aW1lIG9mIHRoZSBmdW5kaW5nCiAgICAgICAgdWludCBzdGFydFRpbWU7IAogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBjbG9zaW5nIHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IGNsb3NpbmdUaW1lOyAgCiAgICAgICAgLy8gVGhlIHByaWNlIG11bHRpcGxpZXIgZm9yIGEgc2hhcmUgb3IgYSB0b2tlbiB3aXRob3V0IGNvbnNpZGVyaW5nIHRoZSBpbmZsYXRpb24gcmF0ZQogICAgICAgIHVpbnQgaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICAvLyBSYXRlIHBlciB5ZWFyIGluIHBlcmNlbnRhZ2UgYXBwbGllZCB0byB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgCiAgICAgICAgdWludCBpbmZsYXRpb25SYXRlOyAKICAgICAgICAvLyBJbmRleCBvZiB0aGUgY2xpZW50IHByb3Bvc2FsCiAgICAgICAgdWludCBwcm9wb3NhbElEOwogICAgfSAKICAgIAogICAgLy8gUnVsZXMgZm9yIHRoZSBhY3R1YWwgZnVuZGluZyBhbmQgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UKICAgIGZ1bmRpbmdEYXRhWzJdIHB1YmxpYyBGdW5kaW5nUnVsZXM7CgogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGxhc3QgTWFuYWdlciBiZWZvcmUgY2xvbmluZwogICAgYWRkcmVzcyBwdWJsaWMgY2xvbmVkRnJvbTsKCiAgICAvLyBBZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoZSBzbWFydCBjb250cmFjdAogICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvcjsKICAgIC8vIEFkZHJlc3Mgb2YgdGhlIERhbyAoZm9yIHRoZSBEYW8gbWFuYWdlcikKICAgIGFkZHJlc3MgY2xpZW50OwogICAgLy8gQWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50OwogICAgYWRkcmVzcyBwdWJsaWMgcmVjaXBpZW50OwogICAgLy8gQWRkcmVzcyBvZiB0aGUgRGFvIG1hbmFnZXIgKGZvciBjb250cmFjdG9yIG1hbmFnZXJzKQogICAgUGFzc01hbmFnZXIgcHVibGljIGRhb01hbmFnZXI7CiAgICAKICAgIC8vIFRoZSB0b2tlbiBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIC8vIFRoZSB0b2tlbiBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICAvLyBUaGUgcXVhbnRpdHkgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIC8vIEVuZCBkYXRlIG9mIHRoZSBzZXR1cCBwcm9jZWR1cmUKICAgIHVpbnQgcHVibGljIHNtYXJ0Q29udHJhY3RTdGFydERhdGU7CiAgICAvLyBVbml4IGRhdGUgd2hlbiBzaGFyZXMgYW5kIHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQgYWZ0ZXIgY2xvbmluZyAoZm9yIHRoZSBEYW8gbWFuYWdlcikKICAgIHVpbnQgY2xvc2luZ1RpbWVGb3JDbG9uaW5nOwogICAgCiAgICAvLyBUb3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgICB1aW50MjU2IHRvdGFsVG9rZW5TdXBwbHk7CgogICAgLy8gQXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICAvLyBBcnJheSB3aXRoIGFsbCBhbGxvd2FuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gTWFwIG9mIHRoZSByZXN1bHQgKGluIHdlaSkgb2YgZnVuZGluZ3MKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgZnVuZGVkQW1vdW50OwoKICAgIC8vIEFycmF5IG9mIHRva2VuIG9yIHNoYXJlIGhvbGRlcnMKICAgIGFkZHJlc3NbXSBob2xkZXJzOwogICAgLy8gTWFwIHdpdGggdGhlIGluZGV4ZXMgb2YgdGhlIGhvbGRlcnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGhvbGRlcklEOwoKICAgIC8vIElmIHRydWUsIHRoZSBzaGFyZXMgb3IgdG9rZW5zIGNhbiBiZSB0cmFuc2ZlcmVkCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcmFibGU7CiAgICAvLyBNYXAgb2YgYmxvY2tlZCBEYW8gc2hhcmUgYWNjb3VudHMuIFBvaW50cyB0byB0aGUgZGF0ZSB3aGVuIHRoZSBzaGFyZSBob2xkZXIgY2FuIHRyYW5zZmVyIHNoYXJlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmxvY2tlZERlYWRMaW5lOyAKCiAgICAvLyBAcmV0dXJuIFRoZSBjbGllbnQgb2YgdGhpcyBtYW5hZ2VyCiAgICBmdW5jdGlvbiBDbGllbnQoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKTsKICAgIAogICAgLy8gQHJldHVybiBUaGUgdW5peCBkYXRlIHdoZW4gc2hhcmVzIGFuZCB0b2tlbnMgY2FuIGJlIHRyYW5zZmVycmVkIGFmdGVyIGNsb25pbmcKICAgIGZ1bmN0aW9uIENsb3NpbmdUaW1lRm9yQ2xvbmluZygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgc3VwcGx5IG9mIHNoYXJlcyBvciB0b2tlbnMgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBRdWFudGl0eSBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBEYW8gcHJvcG9zYWwKICAgIC8vLyBAcmV0dXJuIFRoZSByZXN1bHQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcKICAgIGZ1bmN0aW9uIEZ1bmRlZEFtb3VudCh1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQHBhcmFtIF9zYWxlRGF0ZSBpbiBjYXNlIG9mIHByZXNhbGUsIHRoZSBkYXRlIG9mIHRoZSBwcmVzYWxlCiAgICAvLy8gQHJldHVybiB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgZGl2aXNvciBjb25kaWRlcmluZyB0aGUgc2FsZSBkYXRlIGFuZCB0aGUgaW5mbGF0aW9uIHJhdGUKICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcih1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAcmV0dXJuIHRoZSBhY3R1YWwgcHJpY2UgZGl2aXNvciBvZiBhIHNoYXJlIG9yIHRva2VuCiAgICBmdW5jdGlvbiBhY3R1YWxQcmljZURpdmlzb3IoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQHJldHVybiBUaGUgbWF4aW1hbCBhbW91bnQgYSBtYWluIHBhcnRuZXIgY2FuIGZ1bmQgYXQgdGhpcyBtb21lbnQKICAgIC8vLyBAcGFyYW0gX21haW5QYXJ0bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBtYWluIHBhcm5lcgogICAgZnVuY3Rpb24gZnVuZGluZ01heEFtb3VudChhZGRyZXNzIF9tYWluUGFydG5lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygc2hhcmUgb3IgdG9rZW4gaG9sZGVycyAKICAgIGZ1bmN0aW9uIG51bWJlck9mSG9sZGVycygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAcGFyYW0gX2luZGV4IFRoZSBpbmRleCBvZiB0aGUgaG9sZGVyCiAgICAvLy8gQHJldHVybiB0aGUgYWRkcmVzcyBvZiB0aGUgYW4gaG9sZGVyCiAgICBmdW5jdGlvbiBIb2xkZXJBZGRyZXNzKHVpbnQgX2luZGV4KSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKTsKCiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIERhbyBydWxlcyBwcm9wb3NhbHMgICAgIAogICAgZnVuY3Rpb24gbnVtYmVyT2ZQcm9wb3NhbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAvLy8gQHBhcmFtIF9jbGllbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIERhbwogICAgLy8vIEBwYXJhbSBfZGFvTWFuYWdlciBUaGUgYWRkcmVzcyBvZiB0aGUgRGFvIG1hbmFnZXIgKGZvciBjb250cmFjdG9yIG1hbmFnZXJzKQogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQuIDAgZm9yIHRoZSBEYW8KICAgIC8vLyBAcGFyYW0gX2Nsb25lZEZyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIGxhc3QgTWFuYWdlciBiZWZvcmUgY2xvbmluZwogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIFRoZSB0b2tlbiBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRoZSB0b2tlbiBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgLy8vIEBwYXJhbSBfdG9rZW5EZWNpbWFscyBUaGUgcXVhbnRpdHkgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJhYmxlIFRydWUgaWYgYWxsb3dzIHRoZSB0cmFuc2ZlciBvZiB0b2tlbnMKICAgIC8vZnVuY3Rpb24gUGFzc01hbmFnZXIoCiAgICAvLyAgICBhZGRyZXNzIF9jbGllbnQsCiAgICAvLyAgICBhZGRyZXNzIF9kYW9NYW5hZ2VyLAogICAgLy8gICAgYWRkcmVzcyBfcmVjaXBpZW50LAogICAgLy8gICAgYWRkcmVzcyBfY2xvbmVkRnJvbSwKICAgIC8vICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgLy8gICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgIC8vICAgIHVpbnQ4IF90b2tlbkRlY2ltYWxzLAogICAgLy8gICAgYm9vbCBfdHJhbnNmZXJhYmxlKTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gY2xvbmUgYSBwcm9wb3NhbCBmcm9tIGFub3RoZXIgbWFuYWdlciBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYW1vdW50IEFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIEEgZGVzY3JpcHRpb24gb2YgdGhlIHByb3Bvc2FsCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVEb2N1bWVudCBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwncyBkb2N1bWVudAogICAgLy8vIEBwYXJhbSBfZGF0ZU9mUHJvcG9zYWwgQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGRhdGUgd2hlbiB0aGUgcHJvcG9zYWwgd2FzIGNyZWF0ZWQKICAgIC8vLyBAcGFyYW0gX2xhc3RDbGllbnRQcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBhcHByb3ZlZCBjbGllbnQgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX29yZGVyQW1vdW50IFRoZSBzdW0gYW1vdW50IChpbiB3ZWkpIG9yZGVyZWQgZm9yIHRoaXMgcHJvcG9zYWwgCiAgICAvLy8gQHBhcmFtIF9kYXRlT2ZPcmRlciBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCBvcmRlciBmb3IgdGhlIGFwcHJvdmVkIHByb3Bvc2FsCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiBjbG9uZVByb3Bvc2FsKAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLAogICAgICAgIGJ5dGVzMzIgX2hhc2hPZlRoZURvY3VtZW50LAogICAgICAgIHVpbnQgX2RhdGVPZlByb3Bvc2FsLAogICAgICAgIHVpbnQgX2xhc3RDbGllbnRQcm9wb3NhbElELAogICAgICAgIHVpbnQgX29yZGVyQW1vdW50LAogICAgICAgIHVpbnQgX2RhdGVPZk9yZGVyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0byBjcmVhdGUgaW5pdGlhbCB0b2tlbnMgICAgCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGJlbmVmaWNpYXJ5IG9mIHRoZSBjcmVhdGVkIHRva2VucwogICAgLy8vIEBwYXJhbSBfcXVhbnRpdHkgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBjcmVhdGUgICAgCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgICAgIAogICAgZnVuY3Rpb24gaW5pdGlhbFRva2VuU3VwcGx5KAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfcXVhbnRpdHkpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICAgICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBjbG9uZSB0b2tlbnMgZnJvbSBhIG1hbmFnZXIKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGluZGV4IG9mIHRoZSBmaXJzdCBob2xkZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBob2xkZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAKICAgIGZ1bmN0aW9uIGNsb25lVG9rZW5zKAogICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgdWludCBfdG8pIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNsb3NlIHRoZSBzZXR1cCBwcm9jZWR1cmUgb2YgdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gY2xvc2VTZXR1cCgpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHVwZGF0ZSB0aGUgcmVjaXBlbnQgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfbmV3UmVjaXBpZW50IFRoZSBhZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgZnVuY3Rpb24gdXBkYXRlUmVjaXBpZW50KGFkZHJlc3MgX25ld1JlY2lwaWVudCk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVjZWl2ZSBwYXltZW50cyBvciBkZXBvc2l0cwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gYWxsb3cgY29udHJhY3RvcnMgdG8gd2l0aGRyYXcgZXRoZXJzCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSB0byB3aXRoZHJhdwogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCBfYW1vdW50KTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIGNsaWVudCBhZGRyZXNzCiAgICBmdW5jdGlvbiB1cGRhdGVDbGllbnQoYWRkcmVzcyBfbmV3Q2xpZW50KTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gbWFrZSBhIHByb3Bvc2FsIHRvIHdvcmsgZm9yIHRoZSBjbGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfZGVzY3JpcHRpb24gU3RyaW5nIGRlc2NyaWJpbmcgdGhlIHByb3Bvc2FsCiAgICAvLy8gQHBhcmFtIF9oYXNoT2ZUaGVEb2N1bWVudCBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwgZG9jdW1lbnQKICAgIC8vLyBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgZnVuY3Rpb24gbmV3UHJvcG9zYWwoCiAgICAgICAgdWludCBfYW1vdW50LAogICAgICAgIHN0cmluZyBfZGVzY3JpcHRpb24sIAogICAgICAgIGJ5dGVzMzIgX2hhc2hPZlRoZURvY3VtZW50CiAgICApIHJldHVybnMgKHVpbnQpOwogICAgICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIG9yZGVyIGFjY29yZGluZyB0byB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfY2xpZW50UHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIGxhc3QgYXBwcm92ZWQgY2xpZW50IHByb3Bvc2FsCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIG9yZGVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBvcmRlciB3YXMgbWFkZSBvciBub3QKICAgIGZ1bmN0aW9uIG9yZGVyKAogICAgICAgIHVpbnQgX2NsaWVudFByb3Bvc2FsSUQsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwKICAgICAgICB1aW50IF9hbW91bnQKICAgICkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkgOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gc2VuZCBldGhlcnMgZnJvbSB0aGUgRGFvIG1hbmFnZXIKICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYWRkcmVzcyB0byBzZW5kIHRvCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSB0byBzZW5kCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHNlbmRUbygKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIAogICAgICAgIHVpbnQgX2Ftb3VudAogICAgKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGEgbmV3IHRva2VuIG9yIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBvciBzaGFyZSBob2xkZXIKICAgIGZ1bmN0aW9uIGFkZEhvbGRlcihhZGRyZXNzIF9ob2xkZXIpIGludGVybmFsOwogICAgCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjcmVhdGUgaW5pdGlhbCB0b2tlbnMgICAgCiAgICAvLy8gQHBhcmFtIF9ob2xkZXIgVGhlIGJlbmVmaWNpYXJ5IG9mIHRoZSBjcmVhdGVkIHRva2VucwogICAgLy8vIEBwYXJhbSBfcXVhbnRpdHkgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBjcmVhdGUKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAKICAgIGZ1bmN0aW9uIGNyZWF0ZUluaXRpYWxUb2tlbnMoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9xdWFudGl0eSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSA7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRoYXQgYWxsb3cgdGhlIGNvbnRyYWN0b3IgdG8gcHJvcG9zZSBhIHRva2VuIHByaWNlCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2YgY29udHJhY3RvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9jbG9zaW5nVGltZSBUaGUgaW5pdGlhbCBwcmljZSBhbmQgaW5mbGF0aW9uIHJhdGUgY2FuIGJlIGNoYW5nZWQgYWZ0ZXIgdGhpcyBkYXRlCiAgICBmdW5jdGlvbiBzZXRUb2tlblByaWNlUHJvcG9zYWwoICAgICAgICAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICApOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCBhIGZ1bmRpbmcuIENhbiBiZSBwcml2YXRlIG9yIHB1YmxpYwogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNtYXJ0IGNvbnRyYWN0IHRvIG1hbmFnZSBhIHByaXZhdGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfcHVibGljQ3JlYXRpb24gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFByaWNlTXVsdGlwbGllciBQcmljZSBtdWx0aXBsaWVyIHdpdGhvdXQgY29uc2lkZXJpbmcgYW55IGluZmxhdGlvbiByYXRlCiAgICAvLy8gQHBhcmFtIF9tYXhBbW91bnRUb0Z1bmQgVGhlIG1heGltdW0gYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5mbGF0aW9uUmF0ZSBJZiAwLCB0aGUgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwgKG5vdCBtYW5kYXRvcnkpCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoCiAgICAgICAgYWRkcmVzcyBfbWFpblBhcnRuZXIsCiAgICAgICAgYm9vbCBfcHVibGljQ3JlYXRpb24sIAogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsIAogICAgICAgIHVpbnQgX21heEFtb3VudFRvRnVuZCwgCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRAogICAgKSBleHRlcm5hbDsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gZm9yIHRoZSBjcmVhdGlvbiBvZiBzaGFyZXMgb3IgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBhZGRyZXNzIG9mIHNoYXJlcyBvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQogICAgLy8vIEBwYXJhbSBfc2FsZURhdGUgSW4gY2FzZSBvZiBwcmVzYWxlLCB0aGUgZGF0ZSBvZiB0aGUgcHJlc2FsZQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgY3JlYXRpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbigKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICB1aW50IF9zYWxlRGF0ZQogICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byBzZXQgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgIC8vLyBAcGFyYW0gX3N0YXJ0VGltZSBUaGUgdW5peCBzdGFydCBkYXRlIG9mIHRoZSBmdW5kaW5nIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byByZXdhcmQgc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQgb2Ygc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIFdlaSkgdG8gY2FsY3VsYXRlIHRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGNyZWF0ZQogICAgLy8vIEBwYXJhbSBfZGF0ZSBUaGUgdW5peCBkYXRlIHRvIGNvbnNpZGVyIGZvciB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgY2FsY3VsYXRpb24KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfZGF0ZQogICAgICAgICkgZXh0ZXJuYWw7CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xvc2UgdGhlIGFjdHVhbCBmdW5kaW5nCiAgICBmdW5jdGlvbiBjbG9zZUZ1bmRpbmcoKSBpbnRlcm5hbDsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgZnVuZGluZyBmdWVsZWQKICAgIGZ1bmN0aW9uIHNldEZ1bmRpbmdGdWVsZWQoKSBleHRlcm5hbDsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzIG9yIGNvbnRyYWN0b3IgdG9rZW5zCiAgICBmdW5jdGlvbiBhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBkaXNhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzCiAgICAvLy8gQHBhcmFtIF9jbG9zaW5nVGltZSBEYXRlIHdoZW4gc2hhcmVzIG9yIHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2Zlcih1aW50IF9jbG9zaW5nVGltZSk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIGJsb2NrIHRoZSB0cmFuc2ZlciBvZiBzaGFyZXMgZnJvbSBhbmQgdG8gYSBzaGFyZSBob2xkZXIKICAgIC8vLyBAcGFyYW0gX3NoYXJlSG9sZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBzaGFyZSBob2xkZXIKICAgIC8vLyBAcGFyYW0gX2RlYWRMaW5lIFdoZW4gdGhlIGFjY291bnQgd2lsbCBiZSB1bmJsb2NrZWQKICAgIGZ1bmN0aW9uIGJsb2NrVHJhbnNmZXIoYWRkcmVzcyBfc2hhcmVIb2xkZXIsIHVpbnQgX2RlYWRMaW5lKSBleHRlcm5hbDsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBidXkgRGFvIHNoYXJlcyBhY2NvcmRpbmcgdG8gdGhlIGZ1bmRpbmcgcnVsZXMgCiAgICAvLy8gd2l0aCBgbXNnLnNlbmRlcmAgYXMgdGhlIGJlbmVmaWNpYXJ5CiAgICBmdW5jdGlvbiBidXlTaGFyZXMoKSBwYXlhYmxlOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBidXkgRGFvIHNoYXJlcyBhY2NvcmRpbmcgdG8gdGhlIGZ1bmRpbmcgcnVsZXMgCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIGJlbmVmaWNpYXJ5IG9mIHRoZSBjcmVhdGVkIHNoYXJlcwogICAgZnVuY3Rpb24gYnV5U2hhcmVzRm9yKGFkZHJlc3MgX3JlY2lwaWVudCkgcGF5YWJsZTsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfRnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIHF1YW50aXR5IG9mIHNoYXJlcyBvciB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVRvKAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24gaXRzIGJlaGFsZgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGV2ZW50IEZlZXNSZWNlaXZlZChhZGRyZXNzIGluZGV4ZWQgRnJvbSwgdWludCBBbW91bnQpOwogICAgZXZlbnQgQW1vdW50UmVjZWl2ZWQoYWRkcmVzcyBpbmRleGVkIEZyb20sIHVpbnQgQW1vdW50KTsKICAgIGV2ZW50IHBheW1lbnRSZWNlaXZlZChhZGRyZXNzIGluZGV4ZWQgZGFvTWFuYWdlciwgdWludCBBbW91bnQpOwogICAgZXZlbnQgUHJvcG9zYWxDbG9uZWQodWludCBpbmRleGVkIExhc3RDbGllbnRQcm9wb3NhbElELCB1aW50IGluZGV4ZWQgUHJvcG9zYWxJRCwgdWludCBBbW91bnQsIHN0cmluZyBEZXNjcmlwdGlvbiwgYnl0ZXMzMiBIYXNoT2ZUaGVEb2N1bWVudCk7CiAgICBldmVudCBDbGllbnRVcGRhdGVkKGFkZHJlc3MgTGFzdENsaWVudCwgYWRkcmVzcyBOZXdDbGllbnQpOwogICAgZXZlbnQgUmVjaXBpZW50VXBkYXRlZChhZGRyZXNzIExhc3RSZWNpcGllbnQsIGFkZHJlc3MgTmV3UmVjaXBpZW50KTsKICAgIGV2ZW50IFByb3Bvc2FsQWRkZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50LCBzdHJpbmcgRGVzY3JpcHRpb24sIGJ5dGVzMzIgSGFzaE9mVGhlRG9jdW1lbnQpOwogICAgZXZlbnQgT3JkZXIodWludCBpbmRleGVkIGNsaWVudFByb3Bvc2FsSUQsIHVpbnQgaW5kZXhlZCBQcm9wb3NhbElELCB1aW50IEFtb3VudCk7CiAgICBldmVudCBXaXRoZGF3YWwoYWRkcmVzcyBpbmRleGVkIFJlY2lwaWVudCwgdWludCBBbW91bnQpOwogICAgZXZlbnQgVG9rZW5QcmljZVByb3Bvc2FsU2V0KHVpbnQgSW5pdGlhbFByaWNlTXVsdGlwbGllciwgdWludCBJbmZsYXRpb25SYXRlLCB1aW50IENsb3NpbmdUaW1lKTsKICAgIGV2ZW50IGhvbGRlckFkZGVkKHVpbnQgSW5kZXgsIGFkZHJlc3MgSG9sZGVyKTsKICAgIGV2ZW50IFRva2Vuc0NyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIFNlbmRlciwgYWRkcmVzcyBpbmRleGVkIFRva2VuSG9sZGVyLCB1aW50IFF1YW50aXR5KTsKICAgIGV2ZW50IEZ1bmRpbmdSdWxlc1NldChhZGRyZXNzIGluZGV4ZWQgTWFpblBhcnRuZXIsIHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJZCwgdWludCBpbmRleGVkIFN0YXJ0VGltZSwgdWludCBDbG9zaW5nVGltZSk7CiAgICBldmVudCBGdW5kaW5nRnVlbGVkKHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJRCwgdWludCBGdW5kZWRBbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXJBYmxlKCk7CiAgICBldmVudCBUcmFuc2ZlckRpc2FibGUodWludCBjbG9zaW5nVGltZSk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKCn0gICAgCgpjb250cmFjdCBQYXNzTWFuYWdlciBpcyBQYXNzTWFuYWdlckludGVyZmFjZSB7CgovLyBDb25zdGFudCBmdW5jdGlvbnMKCiAgICBmdW5jdGlvbiBDbGllbnQoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSByZXR1cm4gY2xpZW50OwogICAgICAgIGVsc2UgcmV0dXJuIGRhb01hbmFnZXIuQ2xpZW50KCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIENsb3NpbmdUaW1lRm9yQ2xvbmluZygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAocmVjaXBpZW50ID09IDApIHJldHVybiBjbG9zaW5nVGltZUZvckNsb25pbmc7CiAgICAgICAgZWxzZSByZXR1cm4gZGFvTWFuYWdlci5DbG9zaW5nVGltZUZvckNsb25pbmcoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsVG9rZW5TdXBwbHk7CiAgICB9CgogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBGdW5kZWRBbW91bnQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBmdW5kZWRBbW91bnRbX3Byb3Bvc2FsSURdOwogICAgfQoKICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcih1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgX2RhdGUgPSBfc2FsZURhdGU7CiAgICAgICAgCiAgICAgICAgaWYgKF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgX2RhdGUgPSBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWU7CiAgICAgICAgaWYgKF9zYWxlRGF0ZSA8IEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUpIF9kYXRlID0gRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZTsKCiAgICAgICAgcmV0dXJuIDEwMCArIDEwMCpGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSooX2RhdGUgLSBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lKS8oMTAwKjM2NSBkYXlzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWN0dWFsUHJpY2VEaXZpc29yKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwcmljZURpdmlzb3Iobm93KTsKICAgIH0KCiAgICBmdW5jdGlvbiBmdW5kaW5nTWF4QW1vdW50KGFkZHJlc3MgX21haW5QYXJ0bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IF9tYWluUGFydG5lciAhPSBGdW5kaW5nUnVsZXNbMF0ubWFpblBhcnRuZXIpIHsKICAgICAgICAgICAgcmV0dXJuIDA7ICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIEZ1bmRpbmdSdWxlc1swXS5tYXhBbW91bnRUb0Z1bmQ7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIG51bWJlck9mSG9sZGVycygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaG9sZGVycy5sZW5ndGggLSAxOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBIb2xkZXJBZGRyZXNzKHVpbnQgX2luZGV4KSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNbX2luZGV4XTsKICAgIH0KCiAgICBmdW5jdGlvbiBudW1iZXJPZlByb3Bvc2FscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcHJvcG9zYWxzLmxlbmd0aCAtIDE7CiAgICB9CgovLyBNb2RpZmllcnMKCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBjbGllbnQgdG8gbWFuYWdlIHRoaXMgYWNjb3VudCBtYW5hZ2VyCiAgICBtb2RpZmllciBvbmx5Q2xpZW50IHtpZiAobXNnLnNlbmRlciAhPSBDbGllbnQoKSkgdGhyb3c7IF87fQogICAgCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBtYWluIHBhcnRuZXIgdG8gbWFuYWdlIHRoZSBhY3R1YWwgZnVuZGluZwogICAgbW9kaWZpZXIgb25seU1haW5QYXJ0bmVyIHtpZiAobXNnLnNlbmRlciAhPSAgRnVuZGluZ1J1bGVzWzBdLm1haW5QYXJ0bmVyKSB0aHJvdzsgXzt9CiAgICAKICAgIC8vIE1vZGlmaWVyIHRoYXQgYWxsb3dzIG9ubHkgdGhlIGNvbnRyYWN0b3IgcHJvcG9zZSBzZXQgdGhlIHRva2VuIHByaWNlIG9yIHdpdGhkcmF3CiAgICBtb2RpZmllciBvbmx5Q29udHJhY3RvciB7aWYgKHJlY2lwaWVudCA9PSAwIHx8IChtc2cuc2VuZGVyICE9IHJlY2lwaWVudCAmJiBtc2cuc2VuZGVyICE9IGNyZWF0b3IpKSB0aHJvdzsgXzt9CiAgICAKICAgIC8vIE1vZGlmaWVyIGZvciBEYW8gZnVuY3Rpb25zCiAgICBtb2RpZmllciBvbmx5RGFvIHtpZiAocmVjaXBpZW50ICE9IDApIHRocm93OyBfO30KICAgIAovLyBDb25zdHJ1Y3RvciBmdW5jdGlvbgoKICAgIGZ1bmN0aW9uIFBhc3NNYW5hZ2VyKAogICAgICAgIGFkZHJlc3MgX2NsaWVudCwKICAgICAgICBhZGRyZXNzIF9kYW9NYW5hZ2VyLAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwKICAgICAgICBhZGRyZXNzIF9jbG9uZWRGcm9tLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlCiAgICApIHsKCiAgICAgICAgaWYgKChfcmVjaXBpZW50ID09IDAgJiYgX2NsaWVudCA9PSAwKQogICAgICAgICAgICB8fCBfY2xpZW50ID09IF9yZWNpcGllbnQpIHRocm93OwoKICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsgCiAgICAgICAgY2xpZW50ID0gX2NsaWVudDsKICAgICAgICByZWNpcGllbnQgPSBfcmVjaXBpZW50OwogICAgICAgIAogICAgICAgIGlmIChfcmVjaXBpZW50ICE9MCkgZGFvTWFuYWdlciA9IFBhc3NNYW5hZ2VyKF9kYW9NYW5hZ2VyKTsKCiAgICAgICAgY2xvbmVkRnJvbSA9IF9jbG9uZWRGcm9tOyAgICAgICAgICAgIAogICAgICAgIAogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsKICAgICAgICBkZWNpbWFscyA9IF90b2tlbkRlY2ltYWxzOwogICAgICAgICAgCiAgICAgICAgaWYgKF90cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgVHJhbnNmZXJBYmxlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgwKTsKICAgICAgICB9CgogICAgICAgIGhvbGRlcnMubGVuZ3RoID0gMTsKICAgICAgICBwcm9wb3NhbHMubGVuZ3RoID0gMTsKICAgICAgICAKICAgIH0KCi8vIFNldHRpbmcgZnVuY3Rpb25zCgogICAgZnVuY3Rpb24gY2xvbmVQcm9wb3NhbCgKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgc3RyaW5nIF9kZXNjcmlwdGlvbiwKICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudCwKICAgICAgICB1aW50IF9kYXRlT2ZQcm9wb3NhbCwKICAgICAgICB1aW50IF9sYXN0Q2xpZW50UHJvcG9zYWxJRCwKICAgICAgICB1aW50IF9vcmRlckFtb3VudCwKICAgICAgICB1aW50IF9kYXRlT2ZPcmRlcgogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAgICAgCiAgICAgICAgaWYgKHNtYXJ0Q29udHJhY3RTdGFydERhdGUgIT0gMCB8fCByZWNpcGllbnQgPT0gMAogICAgICAgIHx8IG1zZy5zZW5kZXIgIT0gY3JlYXRvcikgdGhyb3c7CiAgICAgICAgCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCA9IHByb3Bvc2Fscy5sZW5ndGgrKzsKICAgICAgICBwcm9wb3NhbCBjID0gcHJvcG9zYWxzW19wcm9wb3NhbElEXTsKCiAgICAgICAgYy5hbW91bnQgPSBfYW1vdW50OwogICAgICAgIGMuZGVzY3JpcHRpb24gPSBfZGVzY3JpcHRpb247CiAgICAgICAgYy5oYXNoT2ZUaGVEb2N1bWVudCA9IF9oYXNoT2ZUaGVEb2N1bWVudDsgCiAgICAgICAgYy5kYXRlT2ZQcm9wb3NhbCA9IF9kYXRlT2ZQcm9wb3NhbDsKICAgICAgICBjLmxhc3RDbGllbnRQcm9wb3NhbElEID0gX2xhc3RDbGllbnRQcm9wb3NhbElEOwogICAgICAgIGMub3JkZXJBbW91bnQgPSBfb3JkZXJBbW91bnQ7CiAgICAgICAgYy5kYXRlT2ZPcmRlciA9IF9kYXRlT2ZPcmRlcjsKICAgICAgICAKICAgICAgICBQcm9wb3NhbENsb25lZChfbGFzdENsaWVudFByb3Bvc2FsSUQsIF9wcm9wb3NhbElELCBjLmFtb3VudCwgYy5kZXNjcmlwdGlvbiwgYy5oYXNoT2ZUaGVEb2N1bWVudCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRpYWxUb2tlblN1cHBseSgKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIAogICAgICAgIHVpbnQgX3F1YW50aXR5KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgaWYgKHNtYXJ0Q29udHJhY3RTdGFydERhdGUgIT0gMCB8fCBtc2cuc2VuZGVyICE9IGNyZWF0b3IpIHRocm93OwogICAgICAgIAogICAgICAgIGlmIChfcmVjaXBpZW50ICE9IDAgJiYgX3F1YW50aXR5ICE9IDApIHsKICAgICAgICAgICAgcmV0dXJuIChjcmVhdGVJbml0aWFsVG9rZW5zKF9yZWNpcGllbnQsIF9xdWFudGl0eSkpOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICB9CgogICAgZnVuY3Rpb24gY2xvbmVUb2tlbnMoCiAgICAgICAgdWludCBfZnJvbSwKICAgICAgICB1aW50IF90bykgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgCiAgICAgICAgaWYgKHNtYXJ0Q29udHJhY3RTdGFydERhdGUgIT0gMCkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgUGFzc01hbmFnZXIgX2Nsb25lZEZyb20gPSBQYXNzTWFuYWdlcihjbG9uZWRGcm9tKTsKICAgICAgICAKICAgICAgICBpZiAoX2Zyb20gPCAxIHx8IF90byA+IF9jbG9uZWRGcm9tLm51bWJlck9mSG9sZGVycygpKSB0aHJvdzsKCiAgICAgICAgYWRkcmVzcyBfaG9sZGVyOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IF9mcm9tOyBpIDw9IF90bzsgaSsrKSB7CiAgICAgICAgICAgIF9ob2xkZXIgPSBfY2xvbmVkRnJvbS5Ib2xkZXJBZGRyZXNzKGkpOwogICAgICAgICAgICBpZiAoYmFsYW5jZXNbX2hvbGRlcl0gPT0gMCkgewogICAgICAgICAgICAgICAgY3JlYXRlSW5pdGlhbFRva2VucyhfaG9sZGVyLCBfY2xvbmVkRnJvbS5iYWxhbmNlT2YoX2hvbGRlcikpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZVNldHVwKCkgewogICAgICAgIAogICAgICAgIGlmIChzbWFydENvbnRyYWN0U3RhcnREYXRlICE9IDAgfHwgbXNnLnNlbmRlciAhPSBjcmVhdG9yKSB0aHJvdzsKCiAgICAgICAgc21hcnRDb250cmFjdFN0YXJ0RGF0ZSA9IG5vdzsKCiAgICB9CgovLyBGdW5jdGlvbiB0byByZWNlaXZlIHBheW1lbnRzIG9yIGRlcG9zaXRzCgogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgQW1vdW50UmVjZWl2ZWQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KICAgIAovLyBDb250cmFjdG9ycyBBY2NvdW50IE1hbmFnZW1lbnQKCiAgICBmdW5jdGlvbiB1cGRhdGVSZWNpcGllbnQoYWRkcmVzcyBfbmV3UmVjaXBpZW50KSBvbmx5Q29udHJhY3RvciB7CgogICAgICAgIGlmIChfbmV3UmVjaXBpZW50ID09IDAgCiAgICAgICAgICAgIHx8IF9uZXdSZWNpcGllbnQgPT0gY2xpZW50KSB0aHJvdzsKCiAgICAgICAgUmVjaXBpZW50VXBkYXRlZChyZWNpcGllbnQsIF9uZXdSZWNpcGllbnQpOwogICAgICAgIHJlY2lwaWVudCA9IF9uZXdSZWNpcGllbnQ7CgogICAgfSAKCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IF9hbW91bnQpIG9ubHlDb250cmFjdG9yIHsKICAgICAgICBpZiAoIXJlY2lwaWVudC5zZW5kKF9hbW91bnQpKSB0aHJvdzsKICAgICAgICBXaXRoZGF3YWwocmVjaXBpZW50LCBfYW1vdW50KTsKICAgIH0KICAgIAovLyBEQU8gUHJvcG9zYWxzIE1hbmFnZW1lbnQKCiAgICBmdW5jdGlvbiB1cGRhdGVDbGllbnQoYWRkcmVzcyBfbmV3Q2xpZW50KSBvbmx5Q2xpZW50IHsKICAgICAgICAKICAgICAgICBpZiAoX25ld0NsaWVudCA9PSAwIAogICAgICAgICAgICB8fCBfbmV3Q2xpZW50ID09IHJlY2lwaWVudCkgdGhyb3c7CgogICAgICAgIENsaWVudFVwZGF0ZWQoY2xpZW50LCBfbmV3Q2xpZW50KTsKICAgICAgICBjbGllbnQgPSBfbmV3Q2xpZW50OyAgICAgICAgCgogICAgfQoKICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCAKICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudAogICAgKSBvbmx5Q29udHJhY3RvciByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQgPSBwcm9wb3NhbHMubGVuZ3RoKys7CiAgICAgICAgcHJvcG9zYWwgYyA9IHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07CgogICAgICAgIGMuYW1vdW50ID0gX2Ftb3VudDsKICAgICAgICBjLmRlc2NyaXB0aW9uID0gX2Rlc2NyaXB0aW9uOwogICAgICAgIGMuaGFzaE9mVGhlRG9jdW1lbnQgPSBfaGFzaE9mVGhlRG9jdW1lbnQ7IAogICAgICAgIGMuZGF0ZU9mUHJvcG9zYWwgPSBub3c7CiAgICAgICAgCiAgICAgICAgUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgYy5hbW91bnQsIGMuZGVzY3JpcHRpb24sIGMuaGFzaE9mVGhlRG9jdW1lbnQpOwogICAgICAgIAogICAgICAgIHJldHVybiBfcHJvcG9zYWxJRDsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JkZXIoCiAgICAgICAgdWludCBfY2xpZW50UHJvcG9zYWxJRCwKICAgICAgICB1aW50IF9wcm9wb3NhbElELAogICAgICAgIHVpbnQgX29yZGVyQW1vdW50CiAgICApIGV4dGVybmFsIG9ubHlDbGllbnQgcmV0dXJucyAoYm9vbCkgewogICAgCiAgICAgICAgcHJvcG9zYWwgYyA9IHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07CiAgICAgICAgCiAgICAgICAgdWludCBfc3VtID0gYy5vcmRlckFtb3VudCArIF9vcmRlckFtb3VudDsKICAgICAgICBpZiAoX3N1bSA+IGMuYW1vdW50CiAgICAgICAgICAgIHx8IF9zdW0gPCBjLm9yZGVyQW1vdW50CiAgICAgICAgICAgIHx8IF9zdW0gPCBfb3JkZXJBbW91bnQpIHJldHVybjsgCgogICAgICAgIGMubGFzdENsaWVudFByb3Bvc2FsSUQgPSAgX2NsaWVudFByb3Bvc2FsSUQ7CiAgICAgICAgYy5vcmRlckFtb3VudCA9IF9zdW07CiAgICAgICAgYy5kYXRlT2ZPcmRlciA9IG5vdzsKICAgICAgICAKICAgICAgICBPcmRlcihfY2xpZW50UHJvcG9zYWxJRCwgX3Byb3Bvc2FsSUQsIF9vcmRlckFtb3VudCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNlbmRUbygKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsCiAgICAgICAgdWludCBfYW1vdW50CiAgICApIGV4dGVybmFsIG9ubHlDbGllbnQgb25seURhbyByZXR1cm5zIChib29sKSB7CgogICAgICAgIGlmIChfcmVjaXBpZW50LnNlbmQoX2Ftb3VudCkpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlOwoKICAgIH0KICAgIAovLyBUb2tlbiBNYW5hZ2VtZW50CiAgICAKICAgIGZ1bmN0aW9uIGFkZEhvbGRlcihhZGRyZXNzIF9ob2xkZXIpIGludGVybmFsIHsKICAgICAgICAKICAgICAgICBpZiAoaG9sZGVySURbX2hvbGRlcl0gPT0gMCkgewogICAgICAgICAgICAKICAgICAgICAgICAgdWludCBfaG9sZGVySUQgPSBob2xkZXJzLmxlbmd0aCsrOwogICAgICAgICAgICBob2xkZXJzW19ob2xkZXJJRF0gPSBfaG9sZGVyOwogICAgICAgICAgICBob2xkZXJJRFtfaG9sZGVyXSA9IF9ob2xkZXJJRDsKICAgICAgICAgICAgaG9sZGVyQWRkZWQoX2hvbGRlcklELCBfaG9sZGVyKTsKCiAgICAgICAgfQogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBjcmVhdGVJbml0aWFsVG9rZW5zKAogICAgICAgIGFkZHJlc3MgX2hvbGRlciwgCiAgICAgICAgdWludCBfcXVhbnRpdHkKICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIGlmIChfcXVhbnRpdHkgPiAwICYmIGJhbGFuY2VzW19ob2xkZXJdID09IDApIHsKICAgICAgICAgICAgYWRkSG9sZGVyKF9ob2xkZXIpOwogICAgICAgICAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IF9xdWFudGl0eTsgCiAgICAgICAgICAgIHRvdGFsVG9rZW5TdXBwbHkgKz0gX3F1YW50aXR5OwogICAgICAgICAgICBUb2tlbnNDcmVhdGVkKG1zZy5zZW5kZXIsIF9ob2xkZXIsIF9xdWFudGl0eSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0VG9rZW5QcmljZVByb3Bvc2FsKCAgICAgICAgCiAgICAgICAgdWludCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwgCiAgICAgICAgdWludCBfaW5mbGF0aW9uUmF0ZSwKICAgICAgICB1aW50IF9jbG9zaW5nVGltZQogICAgKSBvbmx5Q29udHJhY3RvciB7CiAgICAgICAgCiAgICAgICAgaWYgKF9jbG9zaW5nVGltZSA8IG5vdyAKICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzFdLmNsb3NpbmdUaW1lKSB0aHJvdzsKICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMV0uaW5pdGlhbFByaWNlTXVsdGlwbGllciA9IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyOwogICAgICAgIEZ1bmRpbmdSdWxlc1sxXS5pbmZsYXRpb25SYXRlID0gX2luZmxhdGlvblJhdGU7CiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLnN0YXJ0VGltZSA9IG5vdzsKICAgICAgICBGdW5kaW5nUnVsZXNbMV0uY2xvc2luZ1RpbWUgPSBfY2xvc2luZ1RpbWU7CiAgICAgICAgCiAgICAgICAgVG9rZW5QcmljZVByb3Bvc2FsU2V0KF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCBfaW5mbGF0aW9uUmF0ZSwgX2Nsb3NpbmdUaW1lKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1J1bGVzKAogICAgICAgIGFkZHJlc3MgX21haW5QYXJ0bmVyLAogICAgICAgIGJvb2wgX3B1YmxpY0NyZWF0aW9uLCAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLAogICAgICAgIHVpbnQgX21heEFtb3VudFRvRnVuZCwgCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHsKCiAgICAgICAgaWYgKG5vdyA8IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gYWRkcmVzcyh0aGlzKQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gY2xpZW50CiAgICAgICAgICAgIHx8ICghX3B1YmxpY0NyZWF0aW9uICYmIF9tYWluUGFydG5lciA9PSAwKQogICAgICAgICAgICB8fCAoX3B1YmxpY0NyZWF0aW9uICYmIF9tYWluUGFydG5lciAhPSAwKQogICAgICAgICAgICB8fCAocmVjaXBpZW50ID09IDAgJiYgX2luaXRpYWxQcmljZU11bHRpcGxpZXIgPT0gMCkKICAgICAgICAgICAgfHwgKHJlY2lwaWVudCAhPSAwIAogICAgICAgICAgICAgICAgJiYgKEZ1bmRpbmdSdWxlc1sxXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID09IDAKICAgICAgICAgICAgICAgICAgICB8fCBfaW5mbGF0aW9uUmF0ZSA8IEZ1bmRpbmdSdWxlc1sxXS5pbmZsYXRpb25SYXRlCiAgICAgICAgICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzFdLnN0YXJ0VGltZQogICAgICAgICAgICAgICAgICAgIHx8IEZ1bmRpbmdSdWxlc1sxXS5jbG9zaW5nVGltZSA8IG5vdyArIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgKiAxIG1pbnV0ZXMpKSkKICAgICAgICAgICAgfHwgX21heEFtb3VudFRvRnVuZCA9PSAwCiAgICAgICAgICAgIHx8IF9taW51dGVzRnVuZGluZ1BlcmlvZCA9PSAwCiAgICAgICAgICAgICkgdGhyb3c7CgogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUgPSBub3c7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLmNsb3NpbmdUaW1lID0gbm93ICsgX21pbnV0ZXNGdW5kaW5nUGVyaW9kICogMSBtaW51dGVzOwogICAgICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMF0ubWFpblBhcnRuZXIgPSBfbWFpblBhcnRuZXI7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnB1YmxpY0NyZWF0aW9uID0gX3B1YmxpY0NyZWF0aW9uOwogICAgICAgIAogICAgICAgIGlmIChyZWNpcGllbnQgPT0gMCkgRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICBlbHNlIEZ1bmRpbmdSdWxlc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gRnVuZGluZ1J1bGVzWzFdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgCiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOwogICAgICAgIGVsc2UgRnVuZGluZ1J1bGVzWzBdLmluZmxhdGlvblJhdGUgPSBGdW5kaW5nUnVsZXNbMV0uaW5mbGF0aW9uUmF0ZTsKICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50ID0gMDsKICAgICAgICBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kID0gX21heEFtb3VudFRvRnVuZDsKCiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnByb3Bvc2FsSUQgPSBfcHJvcG9zYWxJRDsKCiAgICAgICAgRnVuZGluZ1J1bGVzU2V0KF9tYWluUGFydG5lciwgX3Byb3Bvc2FsSUQsIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUsIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSk7CiAgICAgICAgICAgIAogICAgfSAKICAgIAogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfc2FsZURhdGUKICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIGlmIChub3cgPiBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWUKICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZQogICAgICAgICAgICB8fF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBfc2FsZURhdGUgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IEZ1bmRpbmdSdWxlc1swXS5mdW5kZWRBbW91bnQgKyBfYW1vdW50ID4gRnVuZGluZ1J1bGVzWzBdLm1heEFtb3VudFRvRnVuZCkgcmV0dXJuOwoKICAgICAgICB1aW50IF9hID0gX2Ftb3VudCpGdW5kaW5nUnVsZXNbMF0uaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gMTAwKl9hOwogICAgICAgIHVpbnQgX3F1YW50aXR5ID0gX211bHRpcGxpZXIvcHJpY2VEaXZpc29yKF9zYWxlRGF0ZSk7CiAgICAgICAgaWYgKF9hL19hbW91bnQgIT0gRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIKICAgICAgICAgICAgfHwgX211bHRpcGxpZXIvMTAwICE9IF9hCiAgICAgICAgICAgIHx8IHRvdGFsVG9rZW5TdXBwbHkgKyBfcXVhbnRpdHkgPD0gdG90YWxUb2tlblN1cHBseSAKICAgICAgICAgICAgfHwgdG90YWxUb2tlblN1cHBseSArIF9xdWFudGl0eSA8PSBfcXVhbnRpdHkpIHJldHVybjsKCiAgICAgICAgYWRkSG9sZGVyKF9yZWNpcGllbnQpOwogICAgICAgIGJhbGFuY2VzW19yZWNpcGllbnRdICs9IF9xdWFudGl0eTsKICAgICAgICB0b3RhbFRva2VuU3VwcGx5ICs9IF9xdWFudGl0eTsKICAgICAgICBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50ICs9IF9hbW91bnQ7CgogICAgICAgIFRva2Vuc0NyZWF0ZWQobXNnLnNlbmRlciwgX3JlY2lwaWVudCwgX3F1YW50aXR5KTsKICAgICAgICAKICAgICAgICBpZiAoRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudCA9PSBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kKSBjbG9zZUZ1bmRpbmcoKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJld2FyZFRva2VuKAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50LAogICAgICAgIHVpbnQgX2RhdGUKICAgICAgICApIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CgogICAgICAgIHVpbnQgX3NhbGVEYXRlOwogICAgICAgIGlmIChfZGF0ZSA9PSAwKSBfc2FsZURhdGUgPSBub3c7IGVsc2UgX3NhbGVEYXRlID0gX2RhdGU7CgogICAgICAgIGlmICghY3JlYXRlVG9rZW4oX3JlY2lwaWVudCwgX2Ftb3VudCwgX3NhbGVEYXRlKSkgdGhyb3c7CgogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlRnVuZGluZygpIGludGVybmFsIHsKICAgICAgICBpZiAocmVjaXBpZW50ID09IDApIGZ1bmRlZEFtb3VudFtGdW5kaW5nUnVsZXNbMF0ucHJvcG9zYWxJRF0gPSBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50OwogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSA9IG5vdzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ0Z1ZWxlZCgpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgY2xvc2VGdW5kaW5nKCk7CiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBGdW5kaW5nRnVlbGVkKEZ1bmRpbmdSdWxlc1swXS5wcm9wb3NhbElELCBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWJsZVRyYW5zZmVyKCkgb25seUNsaWVudCB7CiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgY2xvc2luZ1RpbWVGb3JDbG9uaW5nID0gMDsKICAgICAgICAgICAgVHJhbnNmZXJBYmxlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2Zlcih1aW50IF9jbG9zaW5nVGltZSkgb25seUNsaWVudCB7CiAgICAgICAgaWYgKHRyYW5zZmVyYWJsZSAmJiBfY2xvc2luZ1RpbWUgPT0gMCkgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgICAgICAgZWxzZSBjbG9zaW5nVGltZUZvckNsb25pbmcgPSBfY2xvc2luZ1RpbWU7CiAgICAgICAgICAgIAogICAgICAgIFRyYW5zZmVyRGlzYWJsZShfY2xvc2luZ1RpbWUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBibG9ja1RyYW5zZmVyKGFkZHJlc3MgX3NoYXJlSG9sZGVyLCB1aW50IF9kZWFkTGluZSkgZXh0ZXJuYWwgb25seUNsaWVudCBvbmx5RGFvIHsKICAgICAgICBpZiAoX2RlYWRMaW5lID4gYmxvY2tlZERlYWRMaW5lW19zaGFyZUhvbGRlcl0pIHsKICAgICAgICAgICAgYmxvY2tlZERlYWRMaW5lW19zaGFyZUhvbGRlcl0gPSBfZGVhZExpbmU7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBidXlTaGFyZXMoKSBwYXlhYmxlIHsKICAgICAgICBidXlTaGFyZXNGb3IobXNnLnNlbmRlcik7CiAgICB9IAogICAgCiAgICBmdW5jdGlvbiBidXlTaGFyZXNGb3IoYWRkcmVzcyBfcmVjaXBpZW50KSBwYXlhYmxlIG9ubHlEYW8gewogICAgICAgIAogICAgICAgIGlmICghRnVuZGluZ1J1bGVzWzBdLnB1YmxpY0NyZWF0aW9uIAogICAgICAgICAgICB8fCAhY3JlYXRlVG9rZW4oX3JlY2lwaWVudCwgbXNnLnZhbHVlLCBub3cpKSB0aHJvdzsKCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVRvKAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsgIAoKICAgICAgICBpZiAoKHRyYW5zZmVyYWJsZSAmJiBub3cgPiBDbG9zaW5nVGltZUZvckNsb25pbmcoKSkKICAgICAgICAgICAgJiYgbm93ID4gYmxvY2tlZERlYWRMaW5lW19mcm9tXQogICAgICAgICAgICAmJiBub3cgPiBibG9ja2VkRGVhZExpbmVbX3RvXQogICAgICAgICAgICAmJiBfdG8gIT0gYWRkcmVzcyh0aGlzKQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlCiAgICAgICAgICAgICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dCiAgICAgICAgICAgICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gX3ZhbHVlCiAgICAgICAgKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICBhZGRIb2xkZXIoX3RvKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgeyAgCiAgICAgICAgaWYgKCF0cmFuc2ZlckZyb21Ubyhtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSkpIHRocm93OwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLCAKICAgICAgICBhZGRyZXNzIF90bywgCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgeyAKICAgICAgICAKICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfdmFsdWUKICAgICAgICAgICAgfHwgIXRyYW5zZmVyRnJvbVRvKF9mcm9tLCBfdG8sIF92YWx1ZSkpIHRocm93OwogICAgICAgICAgICAKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKfSAgICAKCnByYWdtYSBzb2xpZGl0eSBeMC40LjY7CgovKgpUaGlzIGZpbGUgaXMgcGFydCBvZiBQYXNzIERBTy4KClBhc3MgREFPIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgbGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgpQYXNzIERBTyBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLApidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgpNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCkdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCmFsb25nIHdpdGggUGFzcyBEQU8uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgovKgpTbWFydCBjb250cmFjdCBmb3IgYSBEZWNlbnRyYWxpemVkIEF1dG9ub21vdXMgT3JnYW5pemF0aW9uIChEQU8pCnRvIGF1dG9tYXRlIG9yZ2FuaXphdGlvbmFsIGdvdmVybmFuY2UgYW5kIGRlY2lzaW9uLW1ha2luZy4KKi8KCi8vLyBAdGl0bGUgUGFzcyBEZWNlbnRyYWxpemVkIEF1dG9ub21vdXMgT3JnYW5pc2F0aW9uCmNvbnRyYWN0IFBhc3NEYW9JbnRlcmZhY2UgewoKICAgIHN0cnVjdCBCb2FyZE1lZXRpbmcgeyAgICAgICAgCiAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgY3JlYXRvciBvZiB0aGUgYm9hcmQgbWVldGluZyBmb3IgYSBwcm9wb3NhbAogICAgICAgIGFkZHJlc3MgY3JlYXRvcjsgIAogICAgICAgIC8vIEluZGV4IHRvIGlkZW50aWZ5IHRoZSBwcm9wb3NhbCB0byBwYXkgYSBjb250cmFjdG9yIG9yIGZ1bmQgdGhlIERhbwogICAgICAgIHVpbnQgcHJvcG9zYWxJRDsKICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgcHJvcG9zYWwgdG8gdXBkYXRlIHRoZSBEYW8gcnVsZXMgCiAgICAgICAgdWludCBkYW9SdWxlc1Byb3Bvc2FsSUQ7IAogICAgICAgIC8vIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZW5kIG9mIHRoZSBzZXQgcGVyaW9kIG9mIGEgcHJvcG9zYWwgYmVmb3JlIHRoZSBib2FyZCBtZWV0aW5nIAogICAgICAgIHVpbnQgc2V0RGVhZGxpbmU7CiAgICAgICAgLy8gRmVlcyAoaW4gd2VpKSBwYWlkIGJ5IHRoZSBjcmVhdG9yIG9mIHRoZSBib2FyZCBtZWV0aW5nCiAgICAgICAgdWludCBmZWVzOwogICAgICAgIC8vIFRvdGFsIG9mIGZlZXMgKGluIHdlaSkgcmV3YXJkZWQgdG8gdGhlIHZvdGVycyBvciB0byB0aGUgRGFvIGFjY291bnQgbWFuYWdlciBmb3IgdGhlIGJhbGFuY2UKICAgICAgICB1aW50IHRvdGFsUmV3YXJkZWRBbW91bnQ7CiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGVuZCBvZiB0aGUgdm90aW5nIHBlcmlvZAogICAgICAgIHVpbnQgdm90aW5nRGVhZGxpbmU7CiAgICAgICAgLy8gVHJ1ZSBpZiB0aGUgcHJvcG9zYWwncyB2b3RlcyBoYXZlIHlldCB0byBiZSBjb3VudGVkLCBvdGhlcndpc2UgRmFsc2UKICAgICAgICBib29sIG9wZW47IAogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBkYXRlIG9mIHRoZSBleGVjdXRpb24gb2YgdGhlIGFwcHJvdmVkIHByb3Bvc2FsCiAgICAgICAgdWludCBkYXRlT2ZFeGVjdXRpb247CiAgICAgICAgLy8gTnVtYmVyIG9mIHNoYXJlcyBpbiBmYXZvciBvZiB0aGUgcHJvcG9zYWwKICAgICAgICB1aW50IHllYTsgCiAgICAgICAgLy8gTnVtYmVyIG9mIHNoYXJlcyBvcHBvc2VkIHRvIHRoZSBwcm9wb3NhbAogICAgICAgIHVpbnQgbmF5OyAKICAgICAgICAvLyBtYXBwaW5nIHRvIGluZGljYXRlIGlmIGEgc2hhcmVob2xkZXIgaGFzIHZvdGVkCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBoYXNWb3RlZDsgIAogICAgfQoKICAgIHN0cnVjdCBDb250cmFjdG9yIHsKICAgICAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3RvciBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0CiAgICAgICAgYWRkcmVzcyBjb250cmFjdG9yTWFuYWdlcjsKICAgICAgICAvLyBUaGUgZGF0ZSBvZiB0aGUgZmlyc3Qgb3JkZXIgZm9yIHRoZSBjb250cmFjdG9yCiAgICAgICAgdWludCBjcmVhdGlvbkRhdGU7CiAgICB9CiAgICAgICAgCiAgICBzdHJ1Y3QgUHJvcG9zYWwgewogICAgICAgIC8vIEluZGV4IHRvIGlkZW50aWZ5IHRoZSBib2FyZCBtZWV0aW5nIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIHVpbnQgYm9hcmRNZWV0aW5nSUQ7CiAgICAgICAgLy8gVGhlIGNvbnRyYWN0b3IgbWFuYWdlciBzbWFydCBjb250cmFjdAogICAgICAgIFBhc3NNYW5hZ2VyIGNvbnRyYWN0b3JNYW5hZ2VyOwogICAgICAgIC8vIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgICAgIHVpbnQgY29udHJhY3RvclByb3Bvc2FsSUQ7CiAgICAgICAgLy8gVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgICAgICB1aW50IGFtb3VudDsgCiAgICAgICAgLy8gVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgZm9yZXNlZXMgYSBjb250cmFjdG9yIHRva2VuIGNyZWF0aW9uCiAgICAgICAgYm9vbCB0b2tlbkNyZWF0aW9uOwogICAgICAgIC8vIFRydWUgaWYgcHVibGljIGZ1bmRpbmcgd2l0aG91dCBhIG1haW4gcGFydG5lcgogICAgICAgIGJvb2wgcHVibGljU2hhcmVDcmVhdGlvbjsgCiAgICAgICAgLy8gVGhlIGFkZHJlc3Mgd2hpY2ggc2V0cyBwYXJ0bmVycyBhbmQgbWFuYWdlcyB0aGUgZnVuZGluZyBpbiBjYXNlIG9mIHByaXZhdGUgZnVuZGluZwogICAgICAgIGFkZHJlc3MgbWFpblBhcnRuZXI7CiAgICAgICAgLy8gVGhlIGluaXRpYWwgcHJpY2UgbXVsdGlwbGllciBvZiBEYW8gc2hhcmVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IGluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllcjsgCiAgICAgICAgLy8gVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgYWN0dWFsIGNvbnRyYWN0b3Igc2hhcmUgcHJpY2UKICAgICAgICB1aW50IGluZmxhdGlvblJhdGU7CiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IG1pbnV0ZXNGdW5kaW5nUGVyaW9kOwogICAgICAgIC8vIFRydWUgaWYgdGhlIHByb3Bvc2FsIGlzIGNsb3NlZAogICAgICAgIGJvb2wgb3BlbjsgCiAgICB9CgogICAgc3RydWN0IFJ1bGVzIHsKICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgYm9hcmQgbWVldGluZyB0aGF0IGRlY2lkZXMgdG8gYXBwbHkgb3Igbm90IHRoZSBEYW8gcnVsZXMKICAgICAgICB1aW50IGJvYXJkTWVldGluZ0lEOyAgCiAgICAgICAgLy8gVGhlIHF1b3J1bSBuZWVkZWQgZm9yIGVhY2ggcHJvcG9zYWwgaXMgY2FsY3VsYXRlZCBieSB0b3RhbFN1cHBseSAvIG1pblF1b3J1bURpdmlzb3IKICAgICAgICB1aW50IG1pblF1b3J1bURpdmlzb3I7ICAKICAgICAgICAvLyBNaW5pbXVtIGZlZXMgKGluIHdlaSkgdG8gY3JlYXRlIGEgcHJvcG9zYWwKICAgICAgICB1aW50IG1pbkJvYXJkTWVldGluZ0ZlZXM7IAogICAgICAgIC8vIFBlcmlvZCBpbiBtaW51dGVzIHRvIGNvbnNpZGVyIG9yIHNldCBhIHByb3Bvc2FsIGJlZm9yZSB0aGUgdm90aW5nIHByb2NlZHVyZQogICAgICAgIHVpbnQgbWludXRlc1NldFByb3Bvc2FsUGVyaW9kOyAKICAgICAgICAvLyBUaGUgbWluaW11bSBkZWJhdGUgcGVyaW9kIGluIG1pbnV0ZXMgdGhhdCBhIGdlbmVyaWMgcHJvcG9zYWwgY2FuIGhhdmUKICAgICAgICB1aW50IG1pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7CiAgICAgICAgLy8gVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcgCiAgICAgICAgdWludCBmZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZTsKICAgICAgICAvLyBUcnVlIGlmIHRoZSBkYW8gcnVsZXMgYWxsb3cgdGhlIHRyYW5zZmVyIG9mIHNoYXJlcwogICAgICAgIGJvb2wgdHJhbnNmZXJhYmxlOwogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIG5ldyBEYW8gc21hcnQgY29udHJhY3QgYWZ0ZXIgYW4gdXBncmFkZQogICAgICAgIGFkZHJlc3MgbmV3ZGFvOwogICAgICAgIC8vIFRoZSBwZXJpb2QgaW4gbWludXRlcyBmb3IgdGhlIGNsb25pbmcgcHJvY2VkdXJlIG9mIHNoYXJlcyBhbmQgdG9rZW5zCiAgICAgICAgdWludCBtaW51dGVzRm9yVG9rZW5zQ2xvbmluZzsKICAgIH0gCiAgICAKICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBEYW8KICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3I7CiAgICAvLyBUaGUgbmFtZSBvZiB0aGUgcHJvamVjdAogICAgc3RyaW5nIHB1YmxpYyBwcm9qZWN0TmFtZTsKICAgIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBsYXN0IERhbyBiZWZvcmUgdXBncmFkZSAobm90IG1hbmRhdG9yeSkKICAgIGFkZHJlc3MgcHVibGljIGxhc3REYW87CiAgICAvLyBFbmQgZGF0ZSBvZiB0aGUgc2V0dXAgcHJvY2VkdXJlCiAgICB1aW50IHB1YmxpYyBzbWFydENvbnRyYWN0U3RhcnREYXRlOwogICAgLy8gVGhlIERhbyBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0CiAgICBQYXNzTWFuYWdlciBwdWJsaWMgZGFvTWFuYWdlcjsKICAgIC8vIFRoZSBtaW5pbXVtIHBlcmlvZHMgaW4gbWludXRlcyAKICAgIHVpbnQgcHVibGljIG1pbk1pbnV0ZXNQZXJpb2RzOwogICAgLy8gVGhlIG1heGltdW0gcGVyaW9kIGluIG1pbnV0ZXMgZm9yIHByb3Bvc2FscyAoc2V0K2RlYmF0ZSkKICAgIHVpbnQgcHVibGljIG1heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZDsKICAgIC8vIFRoZSBtYXhpbXVtIGZ1bmRpbmcgcGVyaW9kIGluIG1pbnV0ZXMgZm9yIGZ1bmRpbmcgcHJvcG9zYWxzCiAgICB1aW50IHB1YmxpYyBtYXhNaW51dGVzRnVuZGluZ1BlcmlvZDsKICAgIC8vIFRoZSBtYXhpbXVtIGluZmxhdGlvbiByYXRlIGZvciBzaGFyZSBwcmljZSBvciByZXdhcmRzIHRvIHZvdGVycwogICAgdWludCBwdWJsaWMgbWF4SW5mbGF0aW9uUmF0ZTsKICAgIAogICAgLy8gTWFwIHRvIGFsbG93IHRoZSBzaGFyZSBob2xkZXJzIHRvIHdpdGhkcmF3IGJvYXJkIG1lZXRpbmcgZmVlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwZW5kaW5nRmVlczsKCiAgICAvLyBCb2FyZCBtZWV0aW5ncyB0byB2b3RlIGZvciBvciBhZ2FpbnN0IGEgcHJvcG9zYWwKICAgIEJvYXJkTWVldGluZ1tdIHB1YmxpYyBCb2FyZE1lZXRpbmdzOyAKICAgIC8vIENvbnRyYWN0b3JzIG9mIHRoZSBEYW8KICAgIENvbnRyYWN0b3JbXSBwdWJsaWMgQ29udHJhY3RvcnM7CiAgICAvLyBNYXAgd2l0aCB0aGUgaW5kZXhlcyBvZiB0aGUgY29udHJhY3RvcnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgY29udHJhY3RvcklEOwogICAgLy8gUHJvcG9zYWxzIHRvIHBheSBhIGNvbnRyYWN0b3Igb3IgZnVuZCB0aGUgRGFvCiAgICBQcm9wb3NhbFtdIHB1YmxpYyBQcm9wb3NhbHM7CiAgICAvLyBQcm9wb3NhbHMgdG8gdXBkYXRlIHRoZSBEYW8gcnVsZXMKICAgIFJ1bGVzW10gcHVibGljIERhb1J1bGVzUHJvcG9zYWxzOwogICAgLy8gVGhlIGN1cnJlbnQgRGFvIHJ1bGVzCiAgICBSdWxlcyBwdWJsaWMgRGFvUnVsZXM7IAogICAgCiAgICAvLyBEYXRlIHdoZW4gc2hhcmVzIGFuZCB0b2tlbnMgY2FuIGJlIHRyYW5zZmVycmVkIGFmdGVyIGNsb25pbmcKICAgIHVpbnQgcHVibGljIGNsb3NpbmdUaW1lRm9yQ2xvbmluZzsKICAgIAogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAvLy8gQHBhcmFtIF9wcm9qZWN0TmFtZSBUaGUgbmFtZSBvZiB0aGUgRGFvCiAgICAvLy8gQHBhcmFtIF9sYXN0RGFvIFRoZSBhZGRyZXNzIG9mIHRoZSBsYXN0IERhbyBiZWZvcmUgdXBncmFkZSAobm90IG1hbmRhdG9yeSkKICAgIC8vZnVuY3Rpb24gUGFzc0RhbygKICAgIC8vICAgIHN0cmluZyBfcHJvamVjdE5hbWUsCiAgICAvLyAgICBhZGRyZXNzIF9sYXN0RGFvKTsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGEgbmV3IGNvbnRyYWN0b3IKICAgIC8vLyBAcGFyYW0gX2NvbnRyYWN0b3JNYW5hZ2VyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdG9yIG1hbmFnZXIKICAgIC8vLyBAcGFyYW0gX2NyZWF0aW9uRGF0ZSBUaGUgZGF0ZSBvZiB0aGUgZmlyc3Qgb3JkZXIKICAgIGZ1bmN0aW9uIGFkZENvbnRyYWN0b3IoYWRkcmVzcyBfY29udHJhY3Rvck1hbmFnZXIsIHVpbnQgX2NyZWF0aW9uRGF0ZSkgaW50ZXJuYWw7CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gY2xvbmUgYSBjb250cmFjdG9yIGZyb20gdGhlIGxhc3QgRGFvIGluIGNhc2Ugb2YgdXBncmFkZSAKICAgIC8vLyBAcGFyYW0gX2NvbnRyYWN0b3JNYW5hZ2VyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdG9yIG1hbmFnZXIKICAgIC8vLyBAcGFyYW0gX2NyZWF0aW9uRGF0ZSBUaGUgZGF0ZSBvZiB0aGUgZmlyc3Qgb3JkZXIKICAgIGZ1bmN0aW9uIGNsb25lQ29udHJhY3RvcihhZGRyZXNzIF9jb250cmFjdG9yTWFuYWdlciwgdWludCBfY3JlYXRpb25EYXRlKTsKICAgIAogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gaW5pdGlhbGl6ZSB0aGUgRGFvCiAgICAvLy8gQHBhcmFtIF9kYW9NYW5hZ2VyIEFkZHJlc3Mgb2YgdGhlIERhbyBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9tYXhJbmZsYXRpb25SYXRlIFRoZSBtYXhpbXVtIGluZmxhdGlvbiByYXRlIGZvciBjb250cmFjdG9yIGFuZCBmdW5kaW5nIHByb3Bvc2FscwogICAgLy8vIEBwYXJhbSBfbWluTWludXRlc1BlcmlvZHMgVGhlIG1pbmltdW0gcGVyaW9kcyBpbiBtaW51dGVzCiAgICAvLy8gQHBhcmFtIF9tYXhNaW51dGVzRnVuZGluZ1BlcmlvZCBUaGUgbWF4aW11bSBmdW5kaW5nIHBlcmlvZCBpbiBtaW51dGVzIGZvciBmdW5kaW5nIHByb3Bvc2FscwogICAgLy8vIEBwYXJhbSBfbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kIFRoZSBtYXhpbXVtIHBlcmlvZCBpbiBtaW51dGVzIGZvciBwcm9wb3NhbHMgKHNldCtkZWJhdGUpCiAgICAvLy8gQHBhcmFtIF9taW5RdW9ydW1EaXZpc29yIFRoZSBpbml0aWFsIG1pbmltdW0gcXVvcnVtIGRpdmlzb3IgZm9yIHRoZSBwcm9wb3NhbHMKICAgIC8vLyBAcGFyYW0gX21pbkJvYXJkTWVldGluZ0ZlZXMgVGhlIGFtb3VudCAoaW4gd2VpKSB0byBtYWtlIGEgcHJvcG9zYWwgYW5kIGFzayBmb3IgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgVGhlIG1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgYmVmb3JlIGEgYm9hcmQgbWVldGluZwogICAgLy8vIEBwYXJhbSBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCBUaGUgbWluaW11bSBwZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgYm9hcmQgbWVldGluZ3MKICAgIC8vLyBAcGFyYW0gX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlIFRoZSBpbmZsYXRpb24gcmF0ZSB0byBjYWxjdWxhdGUgdGhlIHJld2FyZCBvZiBmZWVzIHRvIHZvdGVycyBkdXJpbmcgYSBib2FyZCBtZWV0aW5nCiAgICBmdW5jdGlvbiBpbml0RGFvKAogICAgICAgIGFkZHJlc3MgX2Rhb01hbmFnZXIsCiAgICAgICAgdWludCBfbWF4SW5mbGF0aW9uUmF0ZSwKICAgICAgICB1aW50IF9taW5NaW51dGVzUGVyaW9kcywKICAgICAgICB1aW50IF9tYXhNaW51dGVzRnVuZGluZ1BlcmlvZCwKICAgICAgICB1aW50IF9tYXhNaW51dGVzUHJvcG9zYWxQZXJpb2QsCiAgICAgICAgdWludCBfbWluUXVvcnVtRGl2aXNvciwKICAgICAgICB1aW50IF9taW5Cb2FyZE1lZXRpbmdGZWVzLAogICAgICAgIHVpbnQgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCwKICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLAogICAgICAgIHVpbnQgX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlCiAgICAgICAgKTsKICAgICAgICAKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGJvYXJkIG1lZXRpbmcKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbCBpZiBmb3IgYSBjb250cmFjdG9yIG9yIGZvciBhIGZ1bmRpbmcKICAgIC8vLyBAcGFyYW0gX2Rhb1J1bGVzUHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIHByb3Bvc2FsIGlmIERhbyBydWxlcwogICAgLy8vIEBwYXJhbSBfbWludXRlc0RlYmF0aW5nUGVyaW9kIFRoZSBkdXJhdGlvbiBpbiBtaW51dGVzIG9mIHRoZSBtZWV0aW5nCiAgICAvLy8gQHJldHVybiB0aGUgaW5kZXggb2YgdGhlIGJvYXJkIG1lZXRpbmcKICAgIGZ1bmN0aW9uIG5ld0JvYXJkTWVldGluZygKICAgICAgICB1aW50IF9wcm9wb3NhbElELCAKICAgICAgICB1aW50IF9kYW9SdWxlc1Byb3Bvc2FsSUQsIAogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZAogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gbWFrZSBhIHByb3Bvc2FsIHRvIHBheSBhIGNvbnRyYWN0b3Igb3IgZnVuZCB0aGUgRGFvCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdG9yTWFuYWdlciBBZGRyZXNzIG9mIHRoZSBjb250cmFjdG9yIG1hbmFnZXIgc21hcnQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2NvbnRyYWN0b3JQcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjb250cmFjdG9yIHByb3Bvc2FsIG9mIHRoZSBjb250cmFjdG9yIG1hbmFnZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfdG9rZW5DcmVhdGlvbiBUcnVlIGlmIHRoZSBwcm9wb3NhbCBmb3Jlc2VlcyBhIGNvbnRyYWN0b3IgdG9rZW4gY3JlYXRpb24KICAgIC8vLyBAcGFyYW0gX3B1YmxpY1NoYXJlQ3JlYXRpb24gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZyB3aXRob3V0IGEgbWFpbiBwYXJ0bmVyCiAgICAvLy8gQHBhcmFtIF9tYWluUGFydG5lciBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2UgdGhlIGZ1bmRpbmcgCiAgICAvLy8gaW4gY2FzZSBvZiBwcml2YXRlIGZ1bmRpbmcgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgVGhlIGluaXRpYWwgcHJpY2UgbXVsdGlwbGllciBvZiBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIHNoYXJlIHByaWNlIGRvZXNuJ3QgY2hhbmdlIGR1cmluZyB0aGUgZnVuZGluZyAobm90IG1hbmRhdG9yeSkKICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNGdW5kaW5nUGVyaW9kIFBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRGViYXRpbmdQZXJpb2QgUGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmcgdG8gdm90ZSBvbiB0aGUgcHJvcG9zYWwKICAgIC8vLyBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwKICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKAogICAgICAgIGFkZHJlc3MgX2NvbnRyYWN0b3JNYW5hZ2VyLAogICAgICAgIHVpbnQgX2NvbnRyYWN0b3JQcm9wb3NhbElELAogICAgICAgIHVpbnQgX2Ftb3VudCwgCiAgICAgICAgYm9vbCBfcHVibGljU2hhcmVDcmVhdGlvbiwKICAgICAgICBib29sIF90b2tlbkNyZWF0aW9uLAogICAgICAgIGFkZHJlc3MgX21haW5QYXJ0bmVyLAogICAgICAgIHVpbnQgX2luaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciwgCiAgICAgICAgdWludCBfaW5mbGF0aW9uUmF0ZSwKICAgICAgICB1aW50IF9taW51dGVzRnVuZGluZ1BlcmlvZCwKICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QKICAgICkgcGF5YWJsZSByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBtYWtlIGEgcHJvcG9zYWwgdG8gY2hhbmdlIHRoZSBEYW8gcnVsZXMgCiAgICAvLy8gQHBhcmFtIF9taW5RdW9ydW1EaXZpc29yIElmIDUsIHRoZSBtaW5pbXVtIHF1b3J1bSBpcyAyMCUKICAgIC8vLyBAcGFyYW0gX21pbkJvYXJkTWVldGluZ0ZlZXMgVGhlIGFtb3VudCAoaW4gd2VpKSB0byBtYWtlIGEgcHJvcG9zYWwgYW5kIGFzayBmb3IgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgTWluaW11bSBwZXJpb2QgaW4gbWludXRlcyBiZWZvcmUgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9taW5NaW51dGVzRGViYXRlUGVyaW9kIFRoZSBtaW5pbXVtIHBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBib2FyZCBtZWV0aW5ncwogICAgLy8vIEBwYXJhbSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyYWJsZSBUcnVlIGlmIHRoZSBwcm9wb3NhbCBmb3Jlc2VlcyB0byBhbGxvdyB0aGUgdHJhbnNmZXIgb2YgRGFvIHNoYXJlcwogICAgLy8vIEBwYXJhbSBfbmV3ZGFvIEFkZHJlc3Mgb2YgYSBuZXcgRGFvIHNtYXJ0IGNvbnRyYWN0IGluIGNhc2Ugb2YgdXBncmFkZSAobm90IG1hbmRhdG9yeSkgICAKICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nIFRoZSBwZXJpb2QgaW4gbWludXRlcyBmb3IgdGhlIGNsb25pbmcgcHJvY2VkdXJlIG9mIHNoYXJlcyBhbmQgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRGViYXRpbmdQZXJpb2QgUGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGJvYXJkIG1lZXRpbmcgdG8gdm90ZSBvbiB0aGUgcHJvcG9zYWwKICAgIGZ1bmN0aW9uIG5ld0Rhb1J1bGVzUHJvcG9zYWwoCiAgICAgICAgdWludCBfbWluUXVvcnVtRGl2aXNvciwgCiAgICAgICAgdWludCBfbWluQm9hcmRNZWV0aW5nRmVlcywKICAgICAgICB1aW50IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsCiAgICAgICAgdWludCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCwKICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwKICAgICAgICBib29sIF90cmFuc2ZlcmFibGUsCiAgICAgICAgYWRkcmVzcyBfbmV3ZGFvLAogICAgICAgIHVpbnQgX21pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nLAogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZAogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byB2b3RlIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcKICAgIC8vLyBAcGFyYW0gX2JvYXJkTWVldGluZ0lEIFRoZSBpbmRleCBvZiB0aGUgYm9hcmQgbWVldGluZwogICAgLy8vIEBwYXJhbSBfc3VwcG9ydHNQcm9wb3NhbCBUcnVlIGlmIHRoZSBwcm9wb3NhbCBpcyBzdXBwb3J0ZWQKICAgIGZ1bmN0aW9uIHZvdGUoCiAgICAgICAgdWludCBfYm9hcmRNZWV0aW5nSUQsIAogICAgICAgIGJvb2wgX3N1cHBvcnRzUHJvcG9zYWwKICAgICk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gZXhlY3V0ZSBhIGJvYXJkIG1lZXRpbmcgZGVjaXNpb24gYW5kIGNsb3NlIHRoZSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9ib2FyZE1lZXRpbmdJRCBUaGUgaW5kZXggb2YgdGhlIGJvYXJkIG1lZXRpbmcKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHByb3Bvc2FsIHdhcyBleGVjdXRlZCBvciBub3QKICAgIGZ1bmN0aW9uIGV4ZWN1dGVEZWNpc2lvbih1aW50IF9ib2FyZE1lZXRpbmdJRCkgcmV0dXJucyAoYm9vbCk7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIG9yZGVyIGEgY29udHJhY3RvciBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIHByb3Bvc2FsCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBwcm9wb3NhbCB3YXMgb3JkZXJlZCBhbmQgdGhlIHByb3Bvc2FsIGFtb3VudCBzZW50IG9yIG5vdAogICAgZnVuY3Rpb24gb3JkZXJDb250cmFjdG9yUHJvcG9zYWwodWludCBfcHJvcG9zYWxJRCkgcmV0dXJucyAoYm9vbCk7ICAgCgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gd2l0aGRyYXcgdGhlIHJld2FyZGVkIGJvYXJkIG1lZXRpbmcgZmVlcwogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgd2l0aGRyYXcgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90ICAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXdCb2FyZE1lZXRpbmdGZWVzKCkgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBwYXJhbSBfc2hhcmVIb2xkZXIgQWRkcmVzcyBvZiB0aGUgc2hhcmVob2xkZXIKICAgIC8vLyBAcmV0dXJuIFRoZSBhbW91bnQgaW4gd2VpIHRoZSBzaGFyZWhvbGRlciBjYW4gd2l0aGRyYXcgICAgCiAgICBmdW5jdGlvbiBQZW5kaW5nRmVlcyhhZGRyZXNzIF9zaGFyZUhvbGRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAcmV0dXJuIFRoZSBtaW5pbXVtIHF1b3J1bSBmb3IgcHJvcG9zYWxzIHRvIHBhc3MgCiAgICBmdW5jdGlvbiBtaW5RdW9ydW0oKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIGNvbnRyYWN0b3JzIAogICBmdW5jdGlvbiBudW1iZXJPZkNvbnRyYWN0b3JzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBib2FyZCBtZWV0aW5ncyAob3IgcHJvcG9zYWxzKSAKICAgIGZ1bmN0aW9uIG51bWJlck9mQm9hcmRNZWV0aW5ncygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIGV2ZW50IENvbnRyYWN0b3JBZGRlZCh1aW50IGluZGV4ZWQgQ29udHJhY3RvcklELCBhZGRyZXNzIENvbnRyYWN0b3JNYW5hZ2VyLCB1aW50IENyZWF0aW9uRGF0ZSk7CiAgICBldmVudCBDb250cmFjdG9yUHJvcG9zYWxBZGRlZCh1aW50IGluZGV4ZWQgUHJvcG9zYWxJRCwgdWludCBib2FyZE1lZXRpbmdJRCwgYWRkcmVzcyBpbmRleGVkIENvbnRyYWN0b3JNYW5hZ2VyLCAKICAgICAgICB1aW50IGluZGV4ZWQgQ29udHJhY3RvclByb3Bvc2FsSUQsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IEZ1bmRpbmdQcm9wb3NhbEFkZGVkKHVpbnQgaW5kZXhlZCBQcm9wb3NhbElELCB1aW50IGJvYXJkTWVldGluZ0lELCBib29sIGluZGV4ZWQgTGlua2VkVG9Db250cmFjdG9yUHJvcG9zYWwsIAogICAgICAgIHVpbnQgYW1vdW50LCBhZGRyZXNzIE1haW5QYXJ0bmVyLCB1aW50IEluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciwgdWludCBJbmZsYXRpb25SYXRlLCB1aW50IE1pbnV0ZXNGdW5kaW5nUGVyaW9kKTsKICAgIGV2ZW50IERhb1J1bGVzUHJvcG9zYWxBZGRlZCh1aW50IGluZGV4ZWQgRGFvUnVsZXNQcm9wb3NhbElELCB1aW50IGJvYXJkTWVldGluZ0lELCB1aW50IE1pblF1b3J1bURpdmlzb3IsIAogICAgICAgIHVpbnQgTWluQm9hcmRNZWV0aW5nRmVlcywgdWludCBNaW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsIHVpbnQgTWluTWludXRlc0RlYmF0ZVBlcmlvZCwgdWludCBGZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwgCiAgICAgICAgYm9vbCBUcmFuc2ZlcmFibGUsIGFkZHJlc3MgTmV3RGFvLCB1aW50IE1pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nKTsKICAgIGV2ZW50IFZvdGVkKHVpbnQgaW5kZXhlZCBib2FyZE1lZXRpbmdJRCwgdWludCBQcm9wb3NhbElELCB1aW50IERhb1J1bGVzUHJvcG9zYWxJRCwgYm9vbCBwb3NpdGlvbiwgYWRkcmVzcyBpbmRleGVkIHZvdGVyKTsKICAgIGV2ZW50IFByb3Bvc2FsQ2xvc2VkKHVpbnQgaW5kZXhlZCBQcm9wb3NhbElELCB1aW50IGluZGV4ZWQgRGFvUnVsZXNQcm9wb3NhbElELCB1aW50IGJvYXJkTWVldGluZ0lELCAKICAgICAgICB1aW50IEZlZXNHaXZlbkJhY2ssIGJvb2wgUHJvcG9zYWxFeGVjdXRlZCwgdWludCBCYWxhbmNlU2VudFRvRGFvTWFuYWdlcik7CiAgICBldmVudCBTZW50VG9Db250cmFjdG9yKHVpbnQgaW5kZXhlZCBQcm9wb3NhbElELCB1aW50IGluZGV4ZWQgQ29udHJhY3RvclByb3Bvc2FsSUQsIGFkZHJlc3MgaW5kZXhlZCBDb250cmFjdG9yTWFuYWdlckFkZHJlc3MsIHVpbnQgQW1vdW50U2VudCk7CiAgICBldmVudCBXaXRoZHJhd2FsKGFkZHJlc3MgaW5kZXhlZCBSZWNpcGllbnQsIHVpbnQgQW1vdW50KTsKICAgIGV2ZW50IERhb1VwZ3JhZGVkKGFkZHJlc3MgTmV3RGFvKTsKICAgIAp9Cgpjb250cmFjdCBQYXNzRGFvIGlzIFBhc3NEYW9JbnRlcmZhY2UgewoKICAgIGZ1bmN0aW9uIFBhc3NEYW8oCiAgICAgICAgc3RyaW5nIF9wcm9qZWN0TmFtZSwKICAgICAgICBhZGRyZXNzIF9sYXN0RGFvKSB7CgogICAgICAgIGxhc3REYW8gPSBfbGFzdERhbzsKICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICBwcm9qZWN0TmFtZSA9X3Byb2plY3ROYW1lOwoKICAgICAgICBDb250cmFjdG9ycy5sZW5ndGggPSAxOwogICAgICAgIEJvYXJkTWVldGluZ3MubGVuZ3RoID0gMTsKICAgICAgICBQcm9wb3NhbHMubGVuZ3RoID0gMTsKICAgICAgICBEYW9SdWxlc1Byb3Bvc2Fscy5sZW5ndGggPSAxOyAKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkQ29udHJhY3RvcihhZGRyZXNzIF9jb250cmFjdG9yTWFuYWdlciwgdWludCBfY3JlYXRpb25EYXRlKSBpbnRlcm5hbCB7CiAgICAgICAgCiAgICAgICAgaWYgKGNvbnRyYWN0b3JJRFtfY29udHJhY3Rvck1hbmFnZXJdID09IDApIHsKCiAgICAgICAgICAgIHVpbnQgX2NvbnRyYWN0b3JJRCA9IENvbnRyYWN0b3JzLmxlbmd0aCsrOwogICAgICAgICAgICBDb250cmFjdG9yIGMgPSBDb250cmFjdG9yc1tfY29udHJhY3RvcklEXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRyYWN0b3JJRFtfY29udHJhY3Rvck1hbmFnZXJdID0gX2NvbnRyYWN0b3JJRDsKICAgICAgICAgICAgYy5jb250cmFjdG9yTWFuYWdlciA9IF9jb250cmFjdG9yTWFuYWdlcjsKICAgICAgICAgICAgYy5jcmVhdGlvbkRhdGUgPSBfY3JlYXRpb25EYXRlOwogICAgICAgICAgICAKICAgICAgICAgICAgQ29udHJhY3RvckFkZGVkKF9jb250cmFjdG9ySUQsIGMuY29udHJhY3Rvck1hbmFnZXIsIGMuY3JlYXRpb25EYXRlKTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNsb25lQ29udHJhY3RvcihhZGRyZXNzIF9jb250cmFjdG9yTWFuYWdlciwgdWludCBfY3JlYXRpb25EYXRlKSB7CiAgICAgICAgCiAgICAgICAgaWYgKERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IgIT0gMCB8fCBtc2cuc2VuZGVyICE9IGNyZWF0b3IpIHRocm93OwoKICAgICAgICBhZGRDb250cmFjdG9yKF9jb250cmFjdG9yTWFuYWdlciwgX2NyZWF0aW9uRGF0ZSk7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGluaXREYW8oCiAgICAgICAgYWRkcmVzcyBfZGFvTWFuYWdlciwKICAgICAgICB1aW50IF9tYXhJbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNQZXJpb2RzLAogICAgICAgIHVpbnQgX21heE1pbnV0ZXNGdW5kaW5nUGVyaW9kLAogICAgICAgIHVpbnQgX21heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZCwKICAgICAgICB1aW50IF9taW5RdW9ydW1EaXZpc29yLAogICAgICAgIHVpbnQgX21pbkJvYXJkTWVldGluZ0ZlZXMsCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLAogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsCiAgICAgICAgdWludCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUKICAgICAgICApIHsKICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYgKHNtYXJ0Q29udHJhY3RTdGFydERhdGUgIT0gMCkgdGhyb3c7CgogICAgICAgIG1heEluZmxhdGlvblJhdGUgPSBfbWF4SW5mbGF0aW9uUmF0ZTsKICAgICAgICBtaW5NaW51dGVzUGVyaW9kcyA9IF9taW5NaW51dGVzUGVyaW9kczsKICAgICAgICBtYXhNaW51dGVzRnVuZGluZ1BlcmlvZCA9IF9tYXhNaW51dGVzRnVuZGluZ1BlcmlvZDsKICAgICAgICBtYXhNaW51dGVzUHJvcG9zYWxQZXJpb2QgPSBfbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kOwogICAgICAgIAogICAgICAgIERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IgPSBfbWluUXVvcnVtRGl2aXNvcjsKICAgICAgICBEYW9SdWxlcy5taW5Cb2FyZE1lZXRpbmdGZWVzID0gX21pbkJvYXJkTWVldGluZ0ZlZXM7CiAgICAgICAgRGFvUnVsZXMubWludXRlc1NldFByb3Bvc2FsUGVyaW9kID0gX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZDsKICAgICAgICBEYW9SdWxlcy5taW5NaW51dGVzRGViYXRlUGVyaW9kID0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7CiAgICAgICAgRGFvUnVsZXMuZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7CiAgICAgICAgZGFvTWFuYWdlciA9IFBhc3NNYW5hZ2VyKF9kYW9NYW5hZ2VyKTsKICAgICAgICAKICAgICAgICBzbWFydENvbnRyYWN0U3RhcnREYXRlID0gbm93OwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBuZXdCb2FyZE1lZXRpbmcoCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgCiAgICAgICAgdWludCBfZGFvUnVsZXNQcm9wb3NhbElELCAKICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewoKICAgICAgICBpZiAobXNnLnZhbHVlIDwgRGFvUnVsZXMubWluQm9hcmRNZWV0aW5nRmVlcwogICAgICAgICAgICB8fCBEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgKyBfbWludXRlc0RlYmF0aW5nUGVyaW9kID4gbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kCiAgICAgICAgICAgIHx8IG5vdyArICgoRGFvUnVsZXMubWludXRlc1NldFByb3Bvc2FsUGVyaW9kICsgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCkgKiAxIG1pbnV0ZXMpIDwgbm93CiAgICAgICAgICAgIHx8IF9taW51dGVzRGViYXRpbmdQZXJpb2QgPCBEYW9SdWxlcy5taW5NaW51dGVzRGViYXRlUGVyaW9kCiAgICAgICAgICAgIHx8IG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7CgogICAgICAgIHVpbnQgX2JvYXJkTWVldGluZ0lEID0gQm9hcmRNZWV0aW5ncy5sZW5ndGgrKzsKICAgICAgICBCb2FyZE1lZXRpbmcgYiA9IEJvYXJkTWVldGluZ3NbX2JvYXJkTWVldGluZ0lEXTsKCiAgICAgICAgYi5jcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgYi5wcm9wb3NhbElEID0gX3Byb3Bvc2FsSUQ7CiAgICAgICAgYi5kYW9SdWxlc1Byb3Bvc2FsSUQgPSBfZGFvUnVsZXNQcm9wb3NhbElEOwoKICAgICAgICBiLmZlZXMgPSBtc2cudmFsdWU7CiAgICAgICAgCiAgICAgICAgYi5zZXREZWFkbGluZSA9IG5vdyArIChEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgKiAxIG1pbnV0ZXMpOyAgICAgICAgCiAgICAgICAgYi52b3RpbmdEZWFkbGluZSA9IGIuc2V0RGVhZGxpbmUgKyAoX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCAqIDEgbWludXRlcyk7IAoKICAgICAgICBiLm9wZW4gPSB0cnVlOyAKCiAgICAgICAgcmV0dXJuIF9ib2FyZE1lZXRpbmdJRDsKCiAgICB9CgogICAgZnVuY3Rpb24gbmV3UHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfY29udHJhY3Rvck1hbmFnZXIsCiAgICAgICAgdWludCBfY29udHJhY3RvclByb3Bvc2FsSUQsCiAgICAgICAgdWludCBfYW1vdW50LCAKICAgICAgICBib29sIF90b2tlbkNyZWF0aW9uLAogICAgICAgIGJvb2wgX3B1YmxpY1NoYXJlQ3JlYXRpb24sCiAgICAgICAgYWRkcmVzcyBfbWFpblBhcnRuZXIsCiAgICAgICAgdWludCBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX21pbnV0ZXNGdW5kaW5nUGVyaW9kLAogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZAogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgaWYgKChfY29udHJhY3Rvck1hbmFnZXIgIT0gMCAmJiBfY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkKICAgICAgICAgICAgfHwgKF9jb250cmFjdG9yTWFuYWdlciA9PSAwIAogICAgICAgICAgICAgICAgJiYgKF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgPT0gMAogICAgICAgICAgICAgICAgICAgIHx8IF9jb250cmFjdG9yUHJvcG9zYWxJRCAhPSAwKQogICAgICAgICAgICB8fCAoX3Rva2VuQ3JlYXRpb24gJiYgX3B1YmxpY1NoYXJlQ3JlYXRpb24pCiAgICAgICAgICAgIHx8IChfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyICE9IDAKICAgICAgICAgICAgICAgICYmIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgPCBtaW5NaW51dGVzUGVyaW9kcwogICAgICAgICAgICAgICAgICAgIHx8IF9pbmZsYXRpb25SYXRlID4gbWF4SW5mbGF0aW9uUmF0ZQogICAgICAgICAgICAgICAgICAgIHx8IF9taW51dGVzRnVuZGluZ1BlcmlvZCA+IG1heE1pbnV0ZXNGdW5kaW5nUGVyaW9kKSkpKSB0aHJvdzsKCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCA9IFByb3Bvc2Fscy5sZW5ndGgrKzsKICAgICAgICBQcm9wb3NhbCBwID0gUHJvcG9zYWxzW19wcm9wb3NhbElEXTsKCiAgICAgICAgcC5jb250cmFjdG9yTWFuYWdlciA9IFBhc3NNYW5hZ2VyKF9jb250cmFjdG9yTWFuYWdlcik7CiAgICAgICAgcC5jb250cmFjdG9yUHJvcG9zYWxJRCA9IF9jb250cmFjdG9yUHJvcG9zYWxJRDsKICAgICAgICAKICAgICAgICBwLmFtb3VudCA9IF9hbW91bnQ7CiAgICAgICAgcC50b2tlbkNyZWF0aW9uID0gX3Rva2VuQ3JlYXRpb247CgogICAgICAgIHAucHVibGljU2hhcmVDcmVhdGlvbiA9IF9wdWJsaWNTaGFyZUNyZWF0aW9uOwogICAgICAgIHAubWFpblBhcnRuZXIgPSBfbWFpblBhcnRuZXI7CiAgICAgICAgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyOwogICAgICAgIHAuaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOwogICAgICAgIHAubWludXRlc0Z1bmRpbmdQZXJpb2QgPSBfbWludXRlc0Z1bmRpbmdQZXJpb2Q7CgogICAgICAgIHAuYm9hcmRNZWV0aW5nSUQgPSBuZXdCb2FyZE1lZXRpbmcoX3Byb3Bvc2FsSUQsIDAsIF9taW51dGVzRGViYXRpbmdQZXJpb2QpOyAgIAoKICAgICAgICBwLm9wZW4gPSB0cnVlOwogICAgICAgIAogICAgICAgIGlmIChfY29udHJhY3RvclByb3Bvc2FsSUQgIT0gMCkgewogICAgICAgICAgICBDb250cmFjdG9yUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgcC5ib2FyZE1lZXRpbmdJRCwgcC5jb250cmFjdG9yTWFuYWdlciwgcC5jb250cmFjdG9yUHJvcG9zYWxJRCwgcC5hbW91bnQpOwogICAgICAgICAgICBpZiAoX2luaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciAhPSAwKSB7CiAgICAgICAgICAgICAgICBGdW5kaW5nUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgcC5ib2FyZE1lZXRpbmdJRCwgdHJ1ZSwgcC5hbW91bnQsIHAubWFpblBhcnRuZXIsIAogICAgICAgICAgICAgICAgICAgIHAuaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCBfaW5mbGF0aW9uUmF0ZSwgX21pbnV0ZXNGdW5kaW5nUGVyaW9kKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyICE9IDApIHsKICAgICAgICAgICAgICAgIEZ1bmRpbmdQcm9wb3NhbEFkZGVkKF9wcm9wb3NhbElELCBwLmJvYXJkTWVldGluZ0lELCBmYWxzZSwgcC5hbW91bnQsIHAubWFpblBhcnRuZXIsIAogICAgICAgICAgICAgICAgICAgIHAuaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCBfaW5mbGF0aW9uUmF0ZSwgX21pbnV0ZXNGdW5kaW5nUGVyaW9kKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfcHJvcG9zYWxJRDsKICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBuZXdEYW9SdWxlc1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX21pblF1b3J1bURpdmlzb3IsIAogICAgICAgIHVpbnQgX21pbkJvYXJkTWVldGluZ0ZlZXMsCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLAogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsCiAgICAgICAgdWludCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlLAogICAgICAgIGFkZHJlc3MgX25ld0RhbywKICAgICAgICB1aW50IF9taW51dGVzRm9yVG9rZW5zQ2xvbmluZywKICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QKICAgICkgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAKICAgICAgICBpZiAoX21pblF1b3J1bURpdmlzb3IgPD0gMQogICAgICAgICAgICB8fCBfbWluUXVvcnVtRGl2aXNvciA+IDEwCiAgICAgICAgICAgIHx8IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgPCBtaW5NaW51dGVzUGVyaW9kcwogICAgICAgICAgICB8fCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCA8IG1pbk1pbnV0ZXNQZXJpb2RzCiAgICAgICAgICAgIHx8IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgKyBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCA+IG1heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZAogICAgICAgICAgICB8fCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPiBtYXhJbmZsYXRpb25SYXRlCiAgICAgICAgICAgICkgdGhyb3c7IAogICAgICAgIAogICAgICAgIHVpbnQgX0Rhb1J1bGVzUHJvcG9zYWxJRCA9IERhb1J1bGVzUHJvcG9zYWxzLmxlbmd0aCsrOwogICAgICAgIFJ1bGVzIHIgPSBEYW9SdWxlc1Byb3Bvc2Fsc1tfRGFvUnVsZXNQcm9wb3NhbElEXTsKCiAgICAgICAgci5taW5RdW9ydW1EaXZpc29yID0gX21pblF1b3J1bURpdmlzb3I7CiAgICAgICAgci5taW5Cb2FyZE1lZXRpbmdGZWVzID0gX21pbkJvYXJkTWVldGluZ0ZlZXM7CiAgICAgICAgci5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgPSBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kOwogICAgICAgIHIubWluTWludXRlc0RlYmF0ZVBlcmlvZCA9IF9taW5NaW51dGVzRGViYXRlUGVyaW9kOwogICAgICAgIHIuZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGU7CiAgICAgICAgci50cmFuc2ZlcmFibGUgPSBfdHJhbnNmZXJhYmxlOwogICAgICAgIHIubmV3ZGFvID0gX25ld0RhbzsKICAgICAgICByLm1pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nID0gX21pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nOwoKICAgICAgICByLmJvYXJkTWVldGluZ0lEID0gbmV3Qm9hcmRNZWV0aW5nKDAsIF9EYW9SdWxlc1Byb3Bvc2FsSUQsIF9taW51dGVzRGViYXRpbmdQZXJpb2QpOyAgICAgCgogICAgICAgIERhb1J1bGVzUHJvcG9zYWxBZGRlZChfRGFvUnVsZXNQcm9wb3NhbElELCByLmJvYXJkTWVldGluZ0lELCBfbWluUXVvcnVtRGl2aXNvciwgX21pbkJvYXJkTWVldGluZ0ZlZXMsIAogICAgICAgICAgICBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCwgX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlICxfdHJhbnNmZXJhYmxlLCBfbmV3RGFvICxfbWludXRlc0ZvclRva2Vuc0Nsb25pbmcpOwoKICAgICAgICByZXR1cm4gX0Rhb1J1bGVzUHJvcG9zYWxJRDsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdm90ZSgKICAgICAgICB1aW50IF9ib2FyZE1lZXRpbmdJRCwgCiAgICAgICAgYm9vbCBfc3VwcG9ydHNQcm9wb3NhbAogICAgKSB7CiAgICAgICAgCiAgICAgICAgQm9hcmRNZWV0aW5nIGIgPSBCb2FyZE1lZXRpbmdzW19ib2FyZE1lZXRpbmdJRF07CgogICAgICAgIGlmIChiLmhhc1ZvdGVkW21zZy5zZW5kZXJdIAogICAgICAgICAgICB8fCBub3cgPCBiLnNldERlYWRsaW5lCiAgICAgICAgICAgIHx8IG5vdyA+IGIudm90aW5nRGVhZGxpbmUpIHRocm93OwoKICAgICAgICB1aW50IF9iYWxhbmNlID0gdWludChkYW9NYW5hZ2VyLmJhbGFuY2VPZihtc2cuc2VuZGVyKSk7CiAgICAgICAgaWYgKF9iYWxhbmNlID09IDApIHRocm93OwogICAgICAgIAogICAgICAgIGIuaGFzVm90ZWRbbXNnLnNlbmRlcl0gPSB0cnVlOwoKICAgICAgICBpZiAoX3N1cHBvcnRzUHJvcG9zYWwpIGIueWVhICs9IF9iYWxhbmNlOwogICAgICAgIGVsc2UgYi5uYXkgKz0gX2JhbGFuY2U7IAoKICAgICAgICBpZiAoYi5mZWVzID4gMCAmJiBiLnByb3Bvc2FsSUQgIT0gMCAmJiBQcm9wb3NhbHNbYi5wcm9wb3NhbElEXS5jb250cmFjdG9yUHJvcG9zYWxJRCAhPSAwKSB7CgogICAgICAgICAgICB1aW50IF9hID0gMTAwKmIuZmVlczsKICAgICAgICAgICAgaWYgKChfYS8xMDAgIT0gYi5mZWVzKSB8fCAoKF9hKl9iYWxhbmNlKS9fYSAhPSBfYmFsYW5jZSkpIHRocm93OwogICAgICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gKF9hKl9iYWxhbmNlKS91aW50KGRhb01hbmFnZXIudG90YWxTdXBwbHkoKSk7CgogICAgICAgICAgICB1aW50IF9kaXZpc29yID0gMTAwICsgMTAwKkRhb1J1bGVzLmZlZXNSZXdhcmRJbmZsYXRpb25SYXRlKihub3cgLSBiLnNldERlYWRsaW5lKS8oMTAwKjM2NSBkYXlzKTsKCiAgICAgICAgICAgIHVpbnQgX3Jld2FyZGVkYW1vdW50ID0gX211bHRpcGxpZXIvX2Rpdmlzb3I7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoYi50b3RhbFJld2FyZGVkQW1vdW50ICsgX3Jld2FyZGVkYW1vdW50ID4gYi5mZWVzKSBfcmV3YXJkZWRhbW91bnQgPSBiLmZlZXMgLSBiLnRvdGFsUmV3YXJkZWRBbW91bnQ7CiAgICAgICAgICAgIGIudG90YWxSZXdhcmRlZEFtb3VudCArPSBfcmV3YXJkZWRhbW91bnQ7CiAgICAgICAgICAgIHBlbmRpbmdGZWVzW21zZy5zZW5kZXJdICs9IF9yZXdhcmRlZGFtb3VudDsKICAgICAgICB9CgogICAgICAgIFZvdGVkKF9ib2FyZE1lZXRpbmdJRCwgYi5wcm9wb3NhbElELCBiLmRhb1J1bGVzUHJvcG9zYWxJRCwgX3N1cHBvcnRzUHJvcG9zYWwsIG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIGRhb01hbmFnZXIuYmxvY2tUcmFuc2Zlcihtc2cuc2VuZGVyLCBiLnZvdGluZ0RlYWRsaW5lKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZXhlY3V0ZURlY2lzaW9uKHVpbnQgX2JvYXJkTWVldGluZ0lEKSByZXR1cm5zIChib29sKSB7CgogICAgICAgIEJvYXJkTWVldGluZyBiID0gQm9hcmRNZWV0aW5nc1tfYm9hcmRNZWV0aW5nSURdOwogICAgICAgIFByb3Bvc2FsIHAgPSBQcm9wb3NhbHNbYi5wcm9wb3NhbElEXTsKICAgICAgICAKICAgICAgICBpZiAobm93IDwgYi52b3RpbmdEZWFkbGluZSB8fCAhYi5vcGVuKSB0aHJvdzsKICAgICAgICAKICAgICAgICBiLm9wZW4gPSBmYWxzZTsKICAgICAgICBpZiAocC5jb250cmFjdG9yUHJvcG9zYWxJRCA9PSAwKSBwLm9wZW4gPSBmYWxzZTsKCiAgICAgICAgdWludCBfZmVlczsKICAgICAgICB1aW50IF9taW5RdW9ydW0gPSBtaW5RdW9ydW0oKTsKCiAgICAgICAgaWYgKGIuZmVlcyA+IDAKICAgICAgICAgICAgJiYgKGIucHJvcG9zYWxJRCA9PSAwIHx8IHAuY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkKICAgICAgICAgICAgJiYgYi55ZWEgKyBiLm5heSA+PSBfbWluUXVvcnVtKSB7CiAgICAgICAgICAgICAgICAgICAgX2ZlZXMgPSBiLmZlZXM7CiAgICAgICAgICAgICAgICAgICAgYi5mZWVzID0gMDsKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nRmVlc1tiLmNyZWF0b3JdICs9IF9mZWVzOwogICAgICAgIH0gICAgICAgIAoKICAgICAgICB1aW50IF9iYWxhbmNlID0gYi5mZWVzIC0gYi50b3RhbFJld2FyZGVkQW1vdW50OwogICAgICAgIGlmIChfYmFsYW5jZSA+IDApIHsKICAgICAgICAgICAgaWYgKCFkYW9NYW5hZ2VyLnNlbmQoX2JhbGFuY2UpKSB0aHJvdzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGIueWVhICsgYi5uYXkgPCBfbWluUXVvcnVtIHx8IGIueWVhIDw9IGIubmF5KSB7CiAgICAgICAgICAgIHAub3BlbiA9IGZhbHNlOwogICAgICAgICAgICBQcm9wb3NhbENsb3NlZChiLnByb3Bvc2FsSUQsIGIuZGFvUnVsZXNQcm9wb3NhbElELCBfYm9hcmRNZWV0aW5nSUQsIF9mZWVzLCBmYWxzZSwgX2JhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBiLmRhdGVPZkV4ZWN1dGlvbiA9IG5vdzsKCiAgICAgICAgaWYgKGIucHJvcG9zYWxJRCAhPSAwKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgIT0gMCkgewoKICAgICAgICAgICAgICAgIGRhb01hbmFnZXIuc2V0RnVuZGluZ1J1bGVzKHAubWFpblBhcnRuZXIsIHAucHVibGljU2hhcmVDcmVhdGlvbiwgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIAogICAgICAgICAgICAgICAgICAgIHAuYW1vdW50LCBwLm1pbnV0ZXNGdW5kaW5nUGVyaW9kLCBwLmluZmxhdGlvblJhdGUsIGIucHJvcG9zYWxJRCk7CgogICAgICAgICAgICAgICAgaWYgKHAuY29udHJhY3RvclByb3Bvc2FsSUQgIT0gMCAmJiBwLnRva2VuQ3JlYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwLmNvbnRyYWN0b3JNYW5hZ2VyLnNldEZ1bmRpbmdSdWxlcyhwLm1haW5QYXJ0bmVyLCBwLnB1YmxpY1NoYXJlQ3JlYXRpb24sIDAsIAogICAgICAgICAgICAgICAgICAgICAgICBwLmFtb3VudCwgcC5taW51dGVzRnVuZGluZ1BlcmlvZCwgbWF4SW5mbGF0aW9uUmF0ZSwgYi5wcm9wb3NhbElEKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgIFJ1bGVzIHIgPSBEYW9SdWxlc1Byb3Bvc2Fsc1tiLmRhb1J1bGVzUHJvcG9zYWxJRF07CiAgICAgICAgICAgIERhb1J1bGVzLmJvYXJkTWVldGluZ0lEID0gci5ib2FyZE1lZXRpbmdJRDsKCiAgICAgICAgICAgIERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IgPSByLm1pblF1b3J1bURpdmlzb3I7CiAgICAgICAgICAgIERhb1J1bGVzLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgPSByLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7IAogICAgICAgICAgICBEYW9SdWxlcy5taW5Cb2FyZE1lZXRpbmdGZWVzID0gci5taW5Cb2FyZE1lZXRpbmdGZWVzOwogICAgICAgICAgICBEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgPSByLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZDsKICAgICAgICAgICAgRGFvUnVsZXMuZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPSByLmZlZXNSZXdhcmRJbmZsYXRpb25SYXRlOwoKICAgICAgICAgICAgRGFvUnVsZXMudHJhbnNmZXJhYmxlID0gci50cmFuc2ZlcmFibGU7CiAgICAgICAgICAgIGlmIChyLnRyYW5zZmVyYWJsZSkgZGFvTWFuYWdlci5hYmxlVHJhbnNmZXIoKTsKICAgICAgICAgICAgZWxzZSBkYW9NYW5hZ2VyLmRpc2FibGVUcmFuc2ZlcigwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChyLm1pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nICE9IDApIHsKICAgICAgICAgICAgICAgIGNsb3NpbmdUaW1lRm9yQ2xvbmluZyA9IG5vdyArIChyLm1pbnV0ZXNGb3JUb2tlbnNDbG9uaW5nICogMSBtaW51dGVzKTsKICAgICAgICAgICAgICAgIGRhb01hbmFnZXIuZGlzYWJsZVRyYW5zZmVyKGNsb3NpbmdUaW1lRm9yQ2xvbmluZyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoci5uZXdkYW8gIT0gMCkgJiYgKHIubmV3ZGFvICE9IGFkZHJlc3ModGhpcykpKSB7CiAgICAgICAgICAgICAgICBEYW9SdWxlcy5uZXdkYW8gPSByLm5ld2RhbzsKICAgICAgICAgICAgICAgIGRhb01hbmFnZXIudXBkYXRlQ2xpZW50KHIubmV3ZGFvKTsKICAgICAgICAgICAgICAgIERhb1VwZ3JhZGVkKHIubmV3ZGFvKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIFByb3Bvc2FsQ2xvc2VkKGIucHJvcG9zYWxJRCwgYi5kYW9SdWxlc1Byb3Bvc2FsSUQsIF9ib2FyZE1lZXRpbmdJRCAsX2ZlZXMsIHRydWUsIF9iYWxhbmNlKTsKICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yZGVyQ29udHJhY3RvclByb3Bvc2FsKHVpbnQgX3Byb3Bvc2FsSUQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAKICAgICAgICBQcm9wb3NhbCBwID0gUHJvcG9zYWxzW19wcm9wb3NhbElEXTsKICAgICAgICBCb2FyZE1lZXRpbmcgYiA9IEJvYXJkTWVldGluZ3NbcC5ib2FyZE1lZXRpbmdJRF07CgogICAgICAgIGlmIChiLm9wZW4gfHwgIXAub3BlbikgdGhyb3c7CiAgICAgICAgCiAgICAgICAgdWludCBfYW1vdW50ID0gcC5hbW91bnQ7CgogICAgICAgIGlmIChwLmluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllciAhPSAwKSB7CiAgICAgICAgICAgIF9hbW91bnQgPSBkYW9NYW5hZ2VyLkZ1bmRlZEFtb3VudChfcHJvcG9zYWxJRCk7CiAgICAgICAgICAgIGlmIChfYW1vdW50ID09IDAgJiYgbm93IDwgYi5kYXRlT2ZFeGVjdXRpb24gKyAocC5taW51dGVzRnVuZGluZ1BlcmlvZCAqIDEgbWludXRlcykpIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcC5vcGVuID0gZmFsc2U7ICAgCgogICAgICAgIGlmIChfYW1vdW50ID09IDAgfHwgIXAuY29udHJhY3Rvck1hbmFnZXIub3JkZXIoX3Byb3Bvc2FsSUQsIHAuY29udHJhY3RvclByb3Bvc2FsSUQsIF9hbW91bnQpKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgaWYgKCFkYW9NYW5hZ2VyLnNlbmRUbyhwLmNvbnRyYWN0b3JNYW5hZ2VyLCBfYW1vdW50KSkgdGhyb3c7CiAgICAgICAgU2VudFRvQ29udHJhY3RvcihfcHJvcG9zYWxJRCwgcC5jb250cmFjdG9yUHJvcG9zYWxJRCwgYWRkcmVzcyhwLmNvbnRyYWN0b3JNYW5hZ2VyKSwgX2Ftb3VudCk7CiAgICAgICAgCiAgICAgICAgYWRkQ29udHJhY3RvcihhZGRyZXNzKHAuY29udHJhY3Rvck1hbmFnZXIpLCBub3cpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KICAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXdCb2FyZE1lZXRpbmdGZWVzKCkgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICB1aW50IF9hbW91bnQgPSBwZW5kaW5nRmVlc1ttc2cuc2VuZGVyXTsKCiAgICAgICAgcGVuZGluZ0ZlZXNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKF9hbW91bnQpKSB7CiAgICAgICAgICAgIFdpdGhkcmF3YWwobXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBlbmRpbmdGZWVzW21zZy5zZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICB9CgogICAgZnVuY3Rpb24gUGVuZGluZ0ZlZXMoYWRkcmVzcyBfc2hhcmVIb2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gKHBlbmRpbmdGZWVzW19zaGFyZUhvbGRlcl0pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBtaW5RdW9ydW0oKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuICh1aW50KGRhb01hbmFnZXIudG90YWxTdXBwbHkoKSkgLyBEYW9SdWxlcy5taW5RdW9ydW1EaXZpc29yKTsKICAgIH0KCiAgICBmdW5jdGlvbiBudW1iZXJPZkNvbnRyYWN0b3JzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBDb250cmFjdG9ycy5sZW5ndGggLSAxOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBudW1iZXJPZkJvYXJkTWVldGluZ3MoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIEJvYXJkTWVldGluZ3MubGVuZ3RoIC0gMTsKICAgIH0KICAgIAp9'.
	

]
