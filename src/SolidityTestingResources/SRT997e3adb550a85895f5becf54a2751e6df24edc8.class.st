Class {
	#name : #SRT997e3adb550a85895f5becf54a2751e6df24edc8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT997e3adb550a85895f5becf54a2751e6df24edc8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBUb2tlbiB7IC8vIEVSQzIwIHN0YW5kYXJkCgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKY29udHJhY3QgU2FmZU1hdGggewoKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gc2FmZU51bURpZ2l0cyh1aW50IG51bWJlcikgcHVyZSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCkgewogICAgdWludDggZGlnaXRzID0gMDsKICAgIHdoaWxlIChudW1iZXIgIT0gMCkgewogICAgICAgIG51bWJlciAvPSAxMDsKICAgICAgICBkaWdpdHMrKzsKICAgIH0KICAgIHJldHVybiBkaWdpdHM7Cn0KCiAgLy8gbWl0aWdhdGUgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAvLyB0aGFua3MgdG8gaHR0cHM6Ly9naXRodWIuY29tL251bWVyYWkvY29udHJhY3QvYmxvYi9jMTgyNDY1ZjgyZTUwY2VkOGRhY2IzOTc3ZWMzNzRhODkyZjVmYThjL2NvbnRyYWN0cy9TYWZlLnNvbCNMMzAtTDM0LgogIC8vIFRPRE86IGRvdWJsZWNoZWNrIGltcGxpY2F0aW9uIG9mID49IGNvbXBhcmVkIHRvID09CiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgbnVtV29yZHMpIHsKICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID49IG51bVdvcmRzICogMzIgKyA0KTsKICAgICBfOwogIH0KCn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4sIFNhZmVNYXRoIHsKCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3NlcycKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nICdhcHByb3ZlKF9zcGVuZGVyLCAwKScgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlQYXlsb2FkU2l6ZSgyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfb2xkVmFsdWUsIHVpbnQyNTYgX25ld1ZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDMpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gX29sZFZhbHVlKTsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdWYWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX25ld1ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCn0KCmNvbnRyYWN0IEdSTyBpcyBTdGFuZGFyZFRva2VuIHsKICAgIC8vIEZJRUxEUwogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkdyb24gRGlnaXRhbCI7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJHUk8iOwogICAgdWludDI1NiBwdWJsaWMgZGVjaW1hbHMgPSAxODsKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICIxMS4wIjsKCiAgICAvLyBOaW5lIEh1bmRyZWQgYW5kIEZpZnR5IG1pbGxpb24gd2l0aCBzdXBwb3J0IGZvciAxOCBkZWNpbWFscwogICAgdWludDI1NiBwdWJsaWMgdG9rZW5DYXAgPSA5NTAwMDAwMDAgKiAxMCoqMTg7CgogICAgLy8gY3Jvd2RzYWxlIHBhcmFtZXRlcnMKICAgIHVpbnQyNTYgcHVibGljIGZ1bmRpbmdTdGFydEJsb2NrOwogICAgdWludDI1NiBwdWJsaWMgZnVuZGluZ0VuZEJsb2NrOwoKICAgIC8vIHZlc3RpbmcgZmllbGRzCiAgICBhZGRyZXNzIHB1YmxpYyB2ZXN0aW5nQ29udHJhY3Q7CiAgICBib29sIHByaXZhdGUgdmVzdGluZ1NldCA9IGZhbHNlOwoKICAgIC8vIHJvb3QgY29udHJvbAogICAgYWRkcmVzcyBwdWJsaWMgZnVuZFdhbGxldDsKICAgIC8vIGNvbnRyb2wgb2YgbGlxdWlkaXR5IGFuZCBsaW1pdGVkIGNvbnRyb2wgb2YgdXBkYXRlUHJpY2UKICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xXYWxsZXQ7CiAgICAvLyB0aW1lIHRvIHdhaXQgYmV0d2VlbiBjb250cm9sV2FsbGV0IHByaWNlIHVwZGF0ZXMKICAgIHVpbnQyNTYgcHVibGljIHdhaXRUaW1lID0gNSBob3VyczsKCiAgICAvLyBmdW5kV2FsbGV0IGNvbnRyb2xsZWQgc3RhdGUgdmFyaWFibGVzCiAgICAvLyBoYWx0ZWQ6IGhhbHQgYnV5aW5nIGR1ZSB0byBlbWVyZ2VuY3ksIHRyYWRlYWJsZTogc2lnbmFsIHRoYXQgR1JPTiBwbGF0Zm9ybSBpcyB1cCBhbmQgcnVubmluZwogICAgYm9vbCBwdWJsaWMgaGFsdGVkID0gZmFsc2U7CiAgICBib29sIHB1YmxpYyB0cmFkZWFibGUgPSBmYWxzZTsKCiAgICAvLyAtLSB0b3RhbFN1cHBseSBkZWZpbmVkIGluIFN0YW5kYXJkVG9rZW4KICAgIC8vIC0tIG1hcHBpbmcgdG8gdG9rZW4gYmFsYW5jZXMgZG9uZSBpbiBTdGFuZGFyZFRva2VuCgogICAgdWludDI1NiBwdWJsaWMgcHJldmlvdXNVcGRhdGVUaW1lID0gMDsKICAgIFByaWNlIHB1YmxpYyBjdXJyZW50UHJpY2U7CiAgICB1aW50MjU2IHB1YmxpYyBtaW5BbW91bnQ7IC8vIE1pbmltdW0gYW1vdW50IG9mIGV0aGVyIHRvIGFjY2VwdCBmb3IgR1JPIHB1cmNoYXNlcwoKICAgIC8vIG1hcCBwYXJ0aWNpcGFudCBhZGRyZXNzIHRvIGEgd2l0aGRyYXdhbCByZXF1ZXN0CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFdpdGhkcmF3YWwpIHB1YmxpYyB3aXRoZHJhd2FsczsKICAgIC8vIG1hcHMgcHJldmlvdXNVcGRhdGVUaW1lIHRvIHRoZSBuZXh0IHByaWNlCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IFByaWNlKSBwdWJsaWMgcHJpY2VzOwogICAgLy8gbWFwcyBhZGRyZXNzZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdDsKCiAgICAvLyBUWVBFUwoKICAgIHN0cnVjdCBQcmljZSB7IC8vIHRva2Vuc1BlckV0aAogICAgICAgIHVpbnQyNTYgbnVtZXJhdG9yOwogICAgfQoKICAgIHN0cnVjdCBXaXRoZHJhd2FsIHsKICAgICAgICB1aW50MjU2IHRva2VuczsKICAgICAgICB1aW50MjU2IHRpbWU7IC8vIHRpbWUgZm9yIGVhY2ggd2l0aGRyYXdhbCBpcyBzZXQgdG8gdGhlIHByZXZpb3VzVXBkYXRlVGltZQogICAgfQoKICAgIC8vIEVWRU5UUwoKICAgIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgcGFydGljaXBhbnQsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlWYWx1ZSwgdWludDI1NiBhbW91bnRUb2tlbnMpOwogICAgZXZlbnQgQWxsb2NhdGVQcmVzYWxlKGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwgdWludDI1NiBhbW91bnRUb2tlbnMpOwogICAgZXZlbnQgQm9udXNBbGxvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwgc3RyaW5nIHBhcnRpY2lwYW50X2FkZHIsIHN0cmluZyB0eG5IYXNoLCB1aW50MjU2IGJvbnVzVG9rZW5zKTsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBXaGl0ZWxpc3QoYWRkcmVzcyBpbmRleGVkIHBhcnRpY2lwYW50KTsKICAgIGV2ZW50IFByaWNlVXBkYXRlKHVpbnQyNTYgbnVtZXJhdG9yKTsKICAgIGV2ZW50IEFkZExpcXVpZGl0eSh1aW50MjU2IGV0aEFtb3VudCk7CiAgICBldmVudCBSZW1vdmVMaXF1aWRpdHkodWludDI1NiBldGhBbW91bnQpOwogICAgZXZlbnQgV2l0aGRyYXdSZXF1ZXN0KGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwgdWludDI1NiBhbW91bnRUb2tlbnMpOwogICAgZXZlbnQgV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIHBhcnRpY2lwYW50LCB1aW50MjU2IGFtb3VudFRva2VucywgdWludDI1NiBldGhlckFtb3VudCk7CgogICAgLy8gTU9ESUZJRVJTCgogICAgbW9kaWZpZXIgaXNUcmFkZWFibGUgeyAvLyBleGVtcHQgdmVzdGluZ0NvbnRyYWN0IGFuZCBmdW5kV2FsbGV0IHRvIGFsbG93IGRldiBhbGxvY2F0aW9ucwogICAgICAgIHJlcXVpcmUodHJhZGVhYmxlIHx8IG1zZy5zZW5kZXIgPT0gZnVuZFdhbGxldCB8fCBtc2cuc2VuZGVyID09IHZlc3RpbmdDb250cmFjdCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2hpdGVsaXN0IHsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZ1bmRXYWxsZXQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1hbmFnaW5nV2FsbGV0cyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xXYWxsZXQgfHwgbXNnLnNlbmRlciA9PSBmdW5kV2FsbGV0KTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlfaWZfY29udHJvbFdhbGxldCB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gY29udHJvbFdhbGxldCkgXzsKICAgIH0KICAgIG1vZGlmaWVyIHJlcXVpcmVfd2FpdGVkIHsKICAgICAgcmVxdWlyZShzYWZlU3ViKGN1cnJlbnRUaW1lKCksIHdhaXRUaW1lKSA+PSBwcmV2aW91c1VwZGF0ZVRpbWUpOwogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBvbmx5X2lmX2RlY3JlYXNlICh1aW50MjU2IG5ld051bWVyYXRvcikgewogICAgICAgIGlmIChuZXdOdW1lcmF0b3IgPCBjdXJyZW50UHJpY2UubnVtZXJhdG9yKSBfOwogICAgfQoKICAgIC8vIENPTlNUUlVDVE9SCiAgICBmdW5jdGlvbiBHUk8oKSBwdWJsaWMgewogICAgICAgIGZ1bmRXYWxsZXQgPSBtc2cuc2VuZGVyOwogICAgICAgIHdoaXRlbGlzdFtmdW5kV2FsbGV0XSA9IHRydWU7CiAgICAgICAgcHJldmlvdXNVcGRhdGVUaW1lID0gY3VycmVudFRpbWUoKTsKICAgIH0KCiAgICAvLyBDYWxsZWQgYWZ0ZXIgZGVwbG95bWVudAogICAgLy8gTm90IGFsbCBkZXBsb3ltZW50IGNsaWVudHMgc3VwcG9ydCBjb25zdHJ1Y3RvciBhcmd1bWVudHMuCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIGZvciBtYXhpbXVtIGNvbXBhdGliaWxpdHkuIAogICAgZnVuY3Rpb24gaW5pdGlhbGlzZUNvbnRyYWN0KGFkZHJlc3MgY29udHJvbFdhbGxldElucHV0LCB1aW50MjU2IHByaWNlTnVtZXJhdG9ySW5wdXQsIHVpbnQyNTYgc3RhcnRCbG9ja0lucHV0LCB1aW50MjU2IGVuZEJsb2NrSW5wdXQpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgcmVxdWlyZShjb250cm9sV2FsbGV0SW5wdXQgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUocHJpY2VOdW1lcmF0b3JJbnB1dCA+IDApOwogICAgICByZXF1aXJlKGVuZEJsb2NrSW5wdXQgPiBzdGFydEJsb2NrSW5wdXQpOwogICAgICBjb250cm9sV2FsbGV0ID0gY29udHJvbFdhbGxldElucHV0OwogICAgICB3aGl0ZWxpc3RbY29udHJvbFdhbGxldF0gPSB0cnVlOwogICAgICBjdXJyZW50UHJpY2UgPSBQcmljZShwcmljZU51bWVyYXRvcklucHV0KTsKICAgICAgZnVuZGluZ1N0YXJ0QmxvY2sgPSBzdGFydEJsb2NrSW5wdXQ7CiAgICAgIGZ1bmRpbmdFbmRCbG9jayA9IGVuZEJsb2NrSW5wdXQ7CiAgICAgIHByZXZpb3VzVXBkYXRlVGltZSA9IGN1cnJlbnRUaW1lKCk7CiAgICAgIG1pbkFtb3VudCA9IDAuMDUgZXRoZXI7IC8vIDUwMCBHUk8KICAgIH0KCiAgICAvLyBNRVRIT0RTCgogICAgZnVuY3Rpb24gc2V0VmVzdGluZ0NvbnRyYWN0KGFkZHJlc3MgdmVzdGluZ0NvbnRyYWN0SW5wdXQpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgICByZXF1aXJlKHZlc3RpbmdDb250cmFjdElucHV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHZlc3RpbmdDb250cmFjdCA9IHZlc3RpbmdDb250cmFjdElucHV0OwogICAgICAgIHdoaXRlbGlzdFt2ZXN0aW5nQ29udHJhY3RdID0gdHJ1ZTsKICAgICAgICB2ZXN0aW5nU2V0ID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBhbGxvd3MgY29udHJvbFdhbGxldCB0byB1cGRhdGUgdGhlIHByaWNlIHdpdGhpbiBhIHRpbWUgY29udHN0cmFpbnQsIGFsbG93cyBmdW5kV2FsbGV0IGNvbXBsZXRlIGNvbnRyb2wKICAgIGZ1bmN0aW9uIHVwZGF0ZVByaWNlKHVpbnQyNTYgbmV3TnVtZXJhdG9yKSBleHRlcm5hbCBvbmx5TWFuYWdpbmdXYWxsZXRzIHsKICAgICAgICByZXF1aXJlKG5ld051bWVyYXRvciA+IDApOwogICAgICAgIHJlcXVpcmVfbGltaXRlZF9jaGFuZ2UobmV3TnVtZXJhdG9yKTsKICAgICAgICAvLyBlaXRoZXIgY29udHJvbFdhbGxldCBjb21tYW5kIGlzIGNvbXBsaWFudCBvciB0cmFuc2FjdGlvbiBjYW1lIGZyb20gZnVuZFdhbGxldAogICAgICAgIGN1cnJlbnRQcmljZS5udW1lcmF0b3IgPSBuZXdOdW1lcmF0b3I7CiAgICAgICAgLy8gbWFwcyB0aW1lIHRvIG5ldyBQcmljZSAoaWYgbm90IGR1cmluZyBJQ08pCiAgICAgICAgcHJpY2VzW3ByZXZpb3VzVXBkYXRlVGltZV0gPSBjdXJyZW50UHJpY2U7CiAgICAgICAgcHJldmlvdXNVcGRhdGVUaW1lID0gY3VycmVudFRpbWUoKTsKICAgICAgICBQcmljZVVwZGF0ZShuZXdOdW1lcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlcXVpcmVfbGltaXRlZF9jaGFuZ2UgKHVpbnQyNTYgbmV3TnVtZXJhdG9yKQogICAgICBwcml2YXRlCiAgICAgIHZpZXcKICAgICAgb25seV9pZl9jb250cm9sV2FsbGV0CiAgICAgIHJlcXVpcmVfd2FpdGVkCiAgICAgIG9ubHlfaWZfZGVjcmVhc2UobmV3TnVtZXJhdG9yKQogICAgewogICAgICAgIHVpbnQyNTYgcGVyY2VudGFnZV9kaWZmID0gMDsKICAgICAgICBwZXJjZW50YWdlX2RpZmYgPSBzYWZlTXVsKG5ld051bWVyYXRvciwgMTAwKSAvIGN1cnJlbnRQcmljZS5udW1lcmF0b3I7CiAgICAgICAgcGVyY2VudGFnZV9kaWZmID0gc2FmZVN1YigxMDAsIHBlcmNlbnRhZ2VfZGlmZik7CiAgICAgICAgLy8gY29udHJvbFdhbGxldCBjYW4gb25seSBpbmNyZWFzZSBwcmljZSBieSBtYXggMjAlIGFuZCBvbmx5IGV2ZXJ5IHdhaXRUaW1lCiAgICAgICAgcmVxdWlyZShwZXJjZW50YWdlX2RpZmYgPD0gMjApOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBwYXJ0aWNpcGFudCwgdWludDI1NiBhbW91bnRUb2tlbnMpIHByaXZhdGUgewogICAgICAgIHJlcXVpcmUodmVzdGluZ1NldCk7CiAgICAgICAgLy8gNDAlIG9mIHRvdGFsIGFsbG9jYXRlZCBmb3IgRm91bmRlcnMsIFRlYW0gaW5jZW50aXZlcyAmIEJvbnVzZXMuCgoJLy8gU29saWRpdHkgdjAuNC4xOCAtIGZsb2F0aW5nIHBvaW50IGlzIG5vdCBmdWxseSBzdXBwb3J0ZWQsCgkvLyBpbnRlZ2VyIGRpdmlzaW9uIHJlc3VsdHMgaW4gdHJ1bmNhdGVkIHZhbHVlcwoJLy8gVGhlcmVmb3JlIHdlIGFyZSBtdWx0aXBseWluZyBvdXQgYnkgMTAwMDAwMC4uLiBmb3IKCS8vIHByZWNpc2lvbi4gVGhpcyBhbGxvd3MgcmF0aW9zIHZhbHVlcyB1cCB0byAwLjAwMDB4IG9yIDAuMDB4IHBlcmNlbnQKCXVpbnQyNTYgcHJlY2lzaW9uID0gMTAqKjE4OwoJdWludDI1NiBhbGxvY2F0aW9uUmF0aW8gPSBzYWZlTXVsKGFtb3VudFRva2VucywgcHJlY2lzaW9uKSAvIHNhZmVNdWwoNTcwMDAwMDAwLCBwcmVjaXNpb24pOwogICAgICAgIHVpbnQyNTYgZGV2ZWxvcG1lbnRBbGxvY2F0aW9uID0gc2FmZU11bChhbGxvY2F0aW9uUmF0aW8sIHNhZmVNdWwoMzgwMDAwMDAwLCBwcmVjaXNpb24pKSAvIHByZWNpc2lvbjsKICAgICAgICAvLyBjaGVjayB0aGF0IHRva2VuIGNhcCBpcyBub3QgZXhjZWVkZWQKICAgICAgICB1aW50MjU2IG5ld1Rva2VucyA9IHNhZmVBZGQoYW1vdW50VG9rZW5zLCBkZXZlbG9wbWVudEFsbG9jYXRpb24pOwogICAgICAgIHJlcXVpcmUoc2FmZUFkZCh0b3RhbFN1cHBseSwgbmV3VG9rZW5zKSA8PSB0b2tlbkNhcCk7CiAgICAgICAgLy8gaW5jcmVhc2UgdG9rZW4gc3VwcGx5LCBhc3NpZ24gdG9rZW5zIHRvIHBhcnRpY2lwYW50CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBuZXdUb2tlbnMpOwogICAgICAgIGJhbGFuY2VzW3BhcnRpY2lwYW50XSA9IHNhZmVBZGQoYmFsYW5jZXNbcGFydGljaXBhbnRdLCBhbW91bnRUb2tlbnMpOwogICAgICAgIGJhbGFuY2VzW3Zlc3RpbmdDb250cmFjdF0gPSBzYWZlQWRkKGJhbGFuY2VzW3Zlc3RpbmdDb250cmFjdF0sIGRldmVsb3BtZW50QWxsb2NhdGlvbik7CgoJTWludChmdW5kV2FsbGV0LCBuZXdUb2tlbnMpOwoJVHJhbnNmZXIoZnVuZFdhbGxldCwgcGFydGljaXBhbnQsIGFtb3VudFRva2Vucyk7CglUcmFuc2ZlcihmdW5kV2FsbGV0LCB2ZXN0aW5nQ29udHJhY3QsIGRldmVsb3BtZW50QWxsb2NhdGlvbik7CiAgICB9CgogICAgLy8gYW1vdW50VG9rZW5zIGlzIHN1cHBsaWVkIGluIG1ham9yIHVuaXRzLCBub3Qgc3VidW5pdHMgLyBkZWNpbWFsCiAgICAvLyB1bml0cy4KICAgIGZ1bmN0aW9uIGFsbG9jYXRlUHJlc2FsZVRva2VucygKCQkJICAgICAgIGFkZHJlc3MgcGFydGljaXBhbnRfYWRkcmVzcywKCQkJICAgICAgIHN0cmluZyBwYXJ0aWNpcGFudF9zdHIsCgkJCSAgICAgICB1aW50MjU2IGFtb3VudFRva2VucywKCQkJICAgICAgIHN0cmluZyB0eG5IYXNoCgkJCSAgICAgICApCiAgICAgIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKCiAgICAgIHJlcXVpcmUoY3VycmVudEJsb2NrKCkgPCBmdW5kaW5nRW5kQmxvY2spOwogICAgICByZXF1aXJlKHBhcnRpY2lwYW50X2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgCiAgICAgIHVpbnQyNTYgYm9udXNUb2tlbnMgPSAwOwogICAgICB1aW50MjU2IHRvdGFsVG9rZW5zID0gc2FmZU11bChhbW91bnRUb2tlbnMsIDEwKioxOCk7IC8vIHNjYWxlIHRvIHN1YnVuaXQKCiAgICAgIGlmIChmaXJzdERpZ2l0KHR4bkhhc2gpID09IGZpcnN0RGlnaXQocGFydGljaXBhbnRfc3RyKSkgewoJICAvLyBDYWxjdWxhdGUgMTAlIGJvbnVzCgkgIGJvbnVzVG9rZW5zID0gc2FmZU11bCh0b3RhbFRva2VucywgMTApIC8gMTAwOwoJICB0b3RhbFRva2VucyA9IHNhZmVBZGQodG90YWxUb2tlbnMsIGJvbnVzVG9rZW5zKTsKICAgICAgfQogICAgICAgIAogICAgICAgIG1pbnQocGFydGljaXBhbnRfYWRkcmVzcywgdG90YWxUb2tlbnMpOwoJLy8gRXZlbnRzICAgICAgICAKICAgICAgICBBbGxvY2F0ZVByZXNhbGUocGFydGljaXBhbnRfYWRkcmVzcywgdG90YWxUb2tlbnMpOwoJQm9udXNBbGxvY2F0aW9uKHBhcnRpY2lwYW50X2FkZHJlc3MsIHBhcnRpY2lwYW50X3N0ciwgdHhuSGFzaCwgYm9udXNUb2tlbnMpOwogICAgfQoKICAgIC8vIHJldHVybnMgdGhlIGZpcnN0IGNoYXJhY3RlciBhcyBhIGJ5dGUgaW4gYSBnaXZlbiBoZXggc3RyaW5nCiAgICAvLyBhZGRyZXNzIEdpdmVuIDB4MWFiY2QuLi4gcmV0dXJucyAxCiAgICBmdW5jdGlvbiBmaXJzdERpZ2l0KHN0cmluZyBzKSBwdXJlIHB1YmxpYyByZXR1cm5zKGJ5dGUpewoJYnl0ZXMgbWVtb3J5IHN0ckJ5dGVzID0gYnl0ZXMocyk7CglyZXR1cm4gc3RyQnl0ZXNbMl07CiAgICAgIH0KCiAgICBmdW5jdGlvbiB2ZXJpZnlQYXJ0aWNpcGFudChhZGRyZXNzIHBhcnRpY2lwYW50KSBleHRlcm5hbCBvbmx5TWFuYWdpbmdXYWxsZXRzIHsKICAgICAgICB3aGl0ZWxpc3RbcGFydGljaXBhbnRdID0gdHJ1ZTsKICAgICAgICBXaGl0ZWxpc3QocGFydGljaXBhbnQpOwogICAgfQoKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uCiAgICBmdW5jdGlvbigpIHBheWFibGUgcHVibGljIHsKICAgICAgcmVxdWlyZSh0eC5vcmlnaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgIGJ1eVRvKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eSgpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIGJ1eVRvKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eVRvKGFkZHJlc3MgcGFydGljaXBhbnQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgcmVxdWlyZSghaGFsdGVkKTsKICAgICAgcmVxdWlyZShwYXJ0aWNpcGFudCAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluQW1vdW50KTsKICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IGZ1bmRpbmdFbmRCbG9jayk7CiAgICAgIC8vIG1zZy52YWx1ZSBpbiB3ZWkgLSBzY2FsZSB0byBHUk8KICAgICAgdWludDI1NiBiYXNlQW1vdW50VG9rZW5zID0gc2FmZU11bChtc2cudmFsdWUsIGN1cnJlbnRQcmljZS5udW1lcmF0b3IpOwogICAgICAvLyBjYWxjIGxvdHRlcnkgYW1vdW50IGV4Y2x1ZGluZyBwb3RlbnRpYWwgaWNvIGJvbnVzCiAgICAgIHVpbnQyNTYgbG90dGVyeUFtb3VudCA9IGJsb2NrTG90dGVyeShiYXNlQW1vdW50VG9rZW5zKTsKICAgICAgdWludDI1NiBpY29BbW91bnQgPSBzYWZlTXVsKG1zZy52YWx1ZSwgaWNvTnVtZXJhdG9yUHJpY2UoKSk7CgogICAgICB1aW50MjU2IHRva2Vuc1RvQnV5ID0gc2FmZUFkZChpY29BbW91bnQsIGxvdHRlcnlBbW91bnQpOwogICAgICBtaW50KHBhcnRpY2lwYW50LCB0b2tlbnNUb0J1eSk7CiAgICAgIC8vIHNlbmQgZXRoZXIgdG8gZnVuZFdhbGxldAogICAgICBmdW5kV2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgIC8vIEV2ZW50cwogICAgICBCdXkobXNnLnNlbmRlciwgcGFydGljaXBhbnQsIG1zZy52YWx1ZSwgdG9rZW5zVG9CdXkpOwogICAgfQoKICAgIC8vIHRpbWUgYmFzZWQgb24gYmxvY2tudW1iZXJzLCBhc3N1bWluZyBhIGJsb2NrdGltZSBvZiAxNXMKICAgIGZ1bmN0aW9uIGljb051bWVyYXRvclByaWNlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKCiAgICAgIGlmIChjdXJyZW50QmxvY2soKSA8IGZ1bmRpbmdTdGFydEJsb2NrKXsKCXJldHVybiAxNDAwMDsKICAgICAgfQogICAgICAKICAgICAgdWludDI1NiBpY29EdXJhdGlvbiA9IHNhZmVTdWIoY3VycmVudEJsb2NrKCksIGZ1bmRpbmdTdGFydEJsb2NrKTsKCiAgICAgIHVpbnQyNTYgZmlyc3RCbG9ja1BoYXNlID0gODA2NDA7IC8vICNibG9ja3MgPSAyKjcqMjQqNjAqNjAvMTUgPSA4MDY0MAogICAgICB1aW50MjU2IHNlY29uZEJsb2NrUGhhc2UgPSAxNjEyODA7IC8vIC8vICNibG9ja3MgPSA0KjcqMjQqNjAqNjAvMTUgPSAxNjEyODAKICAgICAgdWludDI1NiB0aGlyZEJsb2NrUGhhc2UgPSAyNDE5MjA7IC8vIC8vICNibG9ja3MgPSA2KjcqMjQqNjAqNjAvMTUgPSAyNDE5MjAKCiAgICAgIGlmIChpY29EdXJhdGlvbiA8IGZpcnN0QmxvY2tQaGFzZSApIHsKCXJldHVybiAgMTMwMDA7CSAgCiAgICAgIH0gZWxzZSBpZiAoaWNvRHVyYXRpb24gPCBzZWNvbmRCbG9ja1BoYXNlICkgeyAKCXJldHVybiAgMTIwMDA7CSAgICAKICAgICAgfSBlbHNlIGlmIChpY29EdXJhdGlvbiA8IHRoaXJkQmxvY2tQaGFzZSApIHsgCglyZXR1cm4gMTEwMDA7CSAgICAKICAgICAgfSBlbHNlIHsKCXJldHVybiAxMDAwMDsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGN1cnJlbnRCbG9jaygpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IF9jdXJyZW50QmxvY2spIHsKICAgICAgcmV0dXJuIGJsb2NrLm51bWJlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyZW50VGltZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IF9jdXJyZW50VGltZSkgewogICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIGZ1bmN0aW9uIGJsb2NrTG90dGVyeSh1aW50MjU2IF9hbW91bnRUb2tlbnMpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgZGl2aXNvciA9IDEwOwogICAgICB1aW50MjU2IHdpbm5pbmdfZGlnaXQgPSAwOwogICAgICB1aW50MjU2IHRva2VuV2lubmluZ3MgPSAwOwoKICAgICAgaWYgKGN1cnJlbnRCbG9jaygpICUgZGl2aXNvciA9PSB3aW5uaW5nX2RpZ2l0KSB7Cgl0b2tlbldpbm5pbmdzID0gc2FmZU11bChfYW1vdW50VG9rZW5zLCAxMCkgLyAxMDA7CiAgICAgIH0KICAgICAgCiAgICAgIHJldHVybiB0b2tlbldpbm5pbmdzOwkKICAgIH0KCiAgICBmdW5jdGlvbiByZXF1ZXN0V2l0aGRyYXdhbCh1aW50MjU2IGFtb3VudFRva2Vuc1RvV2l0aGRyYXcpIGV4dGVybmFsIGlzVHJhZGVhYmxlIG9ubHlXaGl0ZWxpc3QgewogICAgICByZXF1aXJlKGN1cnJlbnRCbG9jaygpID4gZnVuZGluZ0VuZEJsb2NrKTsKICAgICAgICByZXF1aXJlKGFtb3VudFRva2Vuc1RvV2l0aGRyYXcgPiAwKTsKICAgICAgICBhZGRyZXNzIHBhcnRpY2lwYW50ID0gbXNnLnNlbmRlcjsKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZihwYXJ0aWNpcGFudCkgPj0gYW1vdW50VG9rZW5zVG9XaXRoZHJhdyk7CiAgICAgICAgcmVxdWlyZSh3aXRoZHJhd2Fsc1twYXJ0aWNpcGFudF0udG9rZW5zID09IDApOyAvLyBwYXJ0aWNpcGFudCBjYW5ub3QgaGF2ZSBvdXRzdGFuZGluZyB3aXRoZHJhd2FscwogICAgICAgIGJhbGFuY2VzW3BhcnRpY2lwYW50XSA9IHNhZmVTdWIoYmFsYW5jZXNbcGFydGljaXBhbnRdLCBhbW91bnRUb2tlbnNUb1dpdGhkcmF3KTsKICAgICAgICB3aXRoZHJhd2Fsc1twYXJ0aWNpcGFudF0gPSBXaXRoZHJhd2FsKHt0b2tlbnM6IGFtb3VudFRva2Vuc1RvV2l0aGRyYXcsIHRpbWU6IHByZXZpb3VzVXBkYXRlVGltZX0pOwogICAgICAgIFdpdGhkcmF3UmVxdWVzdChwYXJ0aWNpcGFudCwgYW1vdW50VG9rZW5zVG9XaXRoZHJhdyk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBleHRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBwYXJ0aWNpcGFudCA9IG1zZy5zZW5kZXI7CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSB3aXRoZHJhd2Fsc1twYXJ0aWNpcGFudF0udG9rZW5zOwogICAgICAgIHJlcXVpcmUodG9rZW5zID4gMCk7IC8vIHBhcnRpY2lwYW50IG11c3QgaGF2ZSByZXF1ZXN0ZWQgYSB3aXRoZHJhd2FsCiAgICAgICAgdWludDI1NiByZXF1ZXN0VGltZSA9IHdpdGhkcmF3YWxzW3BhcnRpY2lwYW50XS50aW1lOwogICAgICAgIC8vIG9idGFpbiB0aGUgbmV4dCBwcmljZSB0aGF0IHdhcyBzZXQgYWZ0ZXIgdGhlIHJlcXVlc3QKICAgICAgICBQcmljZSBwcmljZSA9IHByaWNlc1tyZXF1ZXN0VGltZV07CiAgICAgICAgcmVxdWlyZShwcmljZS5udW1lcmF0b3IgPiAwKTsgLy8gcHJpY2UgbXVzdCBoYXZlIGJlZW4gc2V0CiAgICAgICAgdWludDI1NiB3aXRoZHJhd1ZhbHVlID0gdG9rZW5zIC8gcHJpY2UubnVtZXJhdG9yOwogICAgICAgIC8vIGlmIGNvbnRyYWN0IGV0aGJhbCA+IHRoZW4gc2VuZCArIHRyYW5zZmVyIHRva2VucyB0byBmdW5kV2FsbGV0LCBvdGhlcndpc2UgZ2l2ZSB0b2tlbnMgYmFjawogICAgICAgIHdpdGhkcmF3YWxzW3BhcnRpY2lwYW50XS50b2tlbnMgPSAwOwogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPj0gd2l0aGRyYXdWYWx1ZSkgewogICAgICAgICAgICBlbmFjdF93aXRoZHJhd2FsX2dyZWF0ZXJfZXF1YWwocGFydGljaXBhbnQsIHdpdGhkcmF3VmFsdWUsIHRva2Vucyk7Cgl9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGVuYWN0X3dpdGhkcmF3YWxfbGVzcyhwYXJ0aWNpcGFudCwgd2l0aGRyYXdWYWx1ZSwgdG9rZW5zKTsKCX0KICAgIH0KCiAgICBmdW5jdGlvbiBlbmFjdF93aXRoZHJhd2FsX2dyZWF0ZXJfZXF1YWwoYWRkcmVzcyBwYXJ0aWNpcGFudCwgdWludDI1NiB3aXRoZHJhd1ZhbHVlLCB1aW50MjU2IHRva2VucykKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgYXNzZXJ0KHRoaXMuYmFsYW5jZSA+PSB3aXRoZHJhd1ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tmdW5kV2FsbGV0XSA9IHNhZmVBZGQoYmFsYW5jZXNbZnVuZFdhbGxldF0sIHRva2Vucyk7CiAgICAgICAgcGFydGljaXBhbnQudHJhbnNmZXIod2l0aGRyYXdWYWx1ZSk7CiAgICAgICAgV2l0aGRyYXcocGFydGljaXBhbnQsIHRva2Vucywgd2l0aGRyYXdWYWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBlbmFjdF93aXRoZHJhd2FsX2xlc3MoYWRkcmVzcyBwYXJ0aWNpcGFudCwgdWludDI1NiB3aXRoZHJhd1ZhbHVlLCB1aW50MjU2IHRva2VucykKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgYXNzZXJ0KHRoaXMuYmFsYW5jZSA8IHdpdGhkcmF3VmFsdWUpOwogICAgICAgIGJhbGFuY2VzW3BhcnRpY2lwYW50XSA9IHNhZmVBZGQoYmFsYW5jZXNbcGFydGljaXBhbnRdLCB0b2tlbnMpOwogICAgICAgIFdpdGhkcmF3KHBhcnRpY2lwYW50LCB0b2tlbnMsIDApOyAvLyBpbmRpY2F0ZSBhIGZhaWxlZCB3aXRoZHJhd2FsCiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgZXRoZXIgdmFsdWUgKGluIHdlaSB1bml0cykgZm9yIHRoZSBhbW91bnQgb2YgdG9rZW5zCiAgICAvLyBpbiBzdWJ1bml0cyBmb3IgZGVjaW1hbCBzdXBwb3J0LCBhdCB0aGUgY3VycmVudCBHUk8gZXhjaGFuZ2UKICAgIC8vIHJhdGUKICAgIGZ1bmN0aW9uIGNoZWNrV2l0aGRyYXdWYWx1ZSh1aW50MjU2IGFtb3VudFRva2Vuc0luU3VidW5pdCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgd2VpVmFsdWUpIHsKICAgICAgICByZXF1aXJlKGFtb3VudFRva2Vuc0luU3VidW5pdCA+IDApOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IGFtb3VudFRva2Vuc0luU3VidW5pdCk7CiAgICAgICAgdWludDI1NiB3aXRoZHJhd1ZhbHVlID0gYW1vdW50VG9rZW5zSW5TdWJ1bml0IC8gY3VycmVudFByaWNlLm51bWVyYXRvcjsKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+PSB3aXRoZHJhd1ZhbHVlKTsKICAgICAgICByZXR1cm4gd2l0aGRyYXdWYWx1ZTsKICAgIH0KCiAgICAvLyBhbGxvdyBmdW5kV2FsbGV0IG9yIGNvbnRyb2xXYWxsZXQgdG8gYWRkIGV0aGVyIHRvIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBhZGRMaXF1aWRpdHkoKSBleHRlcm5hbCBvbmx5TWFuYWdpbmdXYWxsZXRzIHBheWFibGUgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgQWRkTGlxdWlkaXR5KG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8gYWxsb3cgZnVuZFdhbGxldCB0byByZW1vdmUgZXRoZXIgZnJvbSBjb250cmFjdAogICAgZnVuY3Rpb24gcmVtb3ZlTGlxdWlkaXR5KHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCBvbmx5TWFuYWdpbmdXYWxsZXRzIHsKICAgICAgICByZXF1aXJlKGFtb3VudCA8PSB0aGlzLmJhbGFuY2UpOwogICAgICAgIGZ1bmRXYWxsZXQudHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBSZW1vdmVMaXF1aWRpdHkoYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VGdW5kV2FsbGV0KGFkZHJlc3MgbmV3RnVuZFdhbGxldCkgZXh0ZXJuYWwgb25seUZ1bmRXYWxsZXQgewogICAgICAgIHJlcXVpcmUobmV3RnVuZFdhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBmdW5kV2FsbGV0ID0gbmV3RnVuZFdhbGxldDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sV2FsbGV0KGFkZHJlc3MgbmV3Q29udHJvbFdhbGxldCkgZXh0ZXJuYWwgb25seUZ1bmRXYWxsZXQgewogICAgICAgIHJlcXVpcmUobmV3Q29udHJvbFdhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjb250cm9sV2FsbGV0ID0gbmV3Q29udHJvbFdhbGxldDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VXYWl0VGltZSh1aW50MjU2IG5ld1dhaXRUaW1lKSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgd2FpdFRpbWUgPSBuZXdXYWl0VGltZTsKICAgIH0KCiAgICAvLyBzcGVjaWZpZWQgaW4gd2VpCiAgICBmdW5jdGlvbiBjaGFuZ2VNaW5BbW91bnQodWludDI1NiBuZXdNaW5BbW91bnQpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgbWluQW1vdW50ID0gbmV3TWluQW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUZ1bmRpbmdTdGFydEJsb2NrKHVpbnQyNTYgbmV3RnVuZGluZ1N0YXJ0QmxvY2spIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IGZ1bmRpbmdTdGFydEJsb2NrKTsKICAgICAgICByZXF1aXJlKGN1cnJlbnRCbG9jaygpIDwgbmV3RnVuZGluZ1N0YXJ0QmxvY2spOwogICAgICAgIGZ1bmRpbmdTdGFydEJsb2NrID0gbmV3RnVuZGluZ1N0YXJ0QmxvY2s7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlRnVuZGluZ0VuZEJsb2NrKHVpbnQyNTYgbmV3RnVuZGluZ0VuZEJsb2NrKSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IGZ1bmRpbmdFbmRCbG9jayk7CiAgICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IG5ld0Z1bmRpbmdFbmRCbG9jayk7CiAgICAgICAgZnVuZGluZ0VuZEJsb2NrID0gbmV3RnVuZGluZ0VuZEJsb2NrOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgaGFsdGVkID0gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmFibGVUcmFkaW5nKCkgZXh0ZXJuYWwgb25seUZ1bmRXYWxsZXQgewogICAgICAgIHJlcXVpcmUoY3VycmVudEJsb2NrKCkgPiBmdW5kaW5nRW5kQmxvY2spOwogICAgICAgIHRyYWRlYWJsZSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBUb2tlbiB0b2tlbiA9IFRva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGZ1bmRXYWxsZXQsIGJhbGFuY2UpOwogICAgIH0KCiAgICAvLyBwcmV2ZW50IHRyYW5zZmVycyB1bnRpbCB0cmFkaW5nIGFsbG93ZWQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIGlzVHJhZGVhYmxlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgaXNUcmFkZWFibGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQp9'.
	

]
