Class {
	#name : #SRTdde21f8be9e50b9b1165ee302e6b468cf30e4c4c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdde21f8be9e50b9b1165ee302e6b468cf30e4c4c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLy8vIEB0aXRsZSBNYXRoIGxpYnJhcnkgLSBBbGxvd3MgY2FsY3VsYXRpb24gb2YgbG9nYXJpdGhtaWMgYW5kIGV4cG9uZW50aWFsIGZ1bmN0aW9ucwovLy8gQGF1dGhvciBBbGFuIEx1IC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZGZiZWIzYmViMWYxYjNhYTlmYjhiMWIwYWNiNmFjZjFhZmIyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjcwMDMwNDE1MTYxMTFlMzAxNzFlMWYwMzE5MDM1ZTAwMWQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgpsaWJyYXJ5IE1hdGggewoKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIC8vIFRoaXMgaXMgZXF1YWwgdG8gMSBpbiBvdXIgY2FsY3VsYXRpb25zCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBPTkUgPSAgMHgxMDAwMDAwMDAwMDAwMDAwMDsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IExOMiA9IDB4YjE3MjE3ZjdkMWNmNzlhYzsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IExPRzJfRSA9IDB4MTcxNTQ3NjUyYjgyZmUxNzc7CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbmF0dXJhbCBleHBvbmVudGlhbCBmdW5jdGlvbiB2YWx1ZSBvZiBnaXZlbiB4CiAgICAvLy8gQHBhcmFtIHggeAogICAgLy8vIEByZXR1cm4gZSoqeAogICAgZnVuY3Rpb24gZXhwKGludCB4KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICAvLyByZXZlcnQgaWYgeCBpcyA+IE1BWF9QT1dFUiwgd2hlcmUKICAgICAgICAvLyBNQVhfUE9XRVIgPSBpbnQobXAuZmxvb3IobXAubG9nKG1wZigyKioyNTYgLSAxKSAvIE9ORSkgKiBPTkUpKQogICAgICAgIHJlcXVpcmUoeCA8PSAyNDU0OTcxMjU5ODc4OTA5ODg2Njc5KTsKICAgICAgICAvLyByZXR1cm4gMCBpZiBleHAoeCkgaXMgdGlueSwgdXNpbmcKICAgICAgICAvLyBNSU5fUE9XRVIgPSBpbnQobXAuZmxvb3IobXAubG9nKG1wZigxKSAvIE9ORSkgKiBPTkUpKQogICAgICAgIGlmICh4IDwgLTgxODMyMzc1MzI5Mjk2OTk2MjIyNykKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgLy8gVHJhbnNmb3JtIHNvIHRoYXQgZV54IC0+IDJeeAogICAgICAgIHggPSB4ICogaW50KE9ORSkgLyBpbnQoTE4yKTsKICAgICAgICAvLyAyXnggPSAyXndob2xlKHgpICogMl5mcmFjKHgpCiAgICAgICAgLy8gICAgICAgXl5eXl5eXl5eXiBpcyBhIGJpdCBzaGlmdAogICAgICAgIC8vIHNvIFRheWxvciBleHBhbmQgb24geiA9IGZyYWMoeCkKICAgICAgICBpbnQgc2hpZnQ7CiAgICAgICAgdWludCB6OwogICAgICAgIGlmICh4ID49IDApIHsKICAgICAgICAgICAgc2hpZnQgPSB4IC8gaW50KE9ORSk7CiAgICAgICAgICAgIHogPSB1aW50KHggJSBpbnQoT05FKSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzaGlmdCA9IHggLyBpbnQoT05FKSAtIDE7CiAgICAgICAgICAgIHogPSBPTkUgLSB1aW50KC14ICUgaW50KE9ORSkpOwogICAgICAgIH0KICAgICAgICAvLyAyXnggPSAxICsgKGxuIDIpIHggKyAobG4gMileMi8yISB4XjIgKyAuLi4KICAgICAgICAvLwogICAgICAgIC8vIENhbiBnZW5lcmF0ZSB0aGUgeiBjb2VmZmljaWVudHMgdXNpbmcgbXBtYXRoIGFuZCB0aGUgZm9sbG93aW5nIGxpbmVzCiAgICAgICAgLy8gPj4+IGZyb20gbXBtYXRoIGltcG9ydCBtcAogICAgICAgIC8vID4+PiBtcC5kcHMgPSAxMDAKICAgICAgICAvLyA+Pj4gT05FID0gIDB4MTAwMDAwMDAwMDAwMDAwMDAKICAgICAgICAvLyA+Pj4gcHJpbnQoJ1xuJy5qb2luKGhleChpbnQobXAubG9nKDIpKippIC8gbXAuZmFjdG9yaWFsKGkpICogT05FKSkgZm9yIGkgaW4gcmFuZ2UoMSwgNykpKQogICAgICAgIC8vIDB4YjE3MjE3ZjdkMWNmNzlhYgogICAgICAgIC8vIDB4M2Q3ZjdiZmYwNThiMWQ1MAogICAgICAgIC8vIDB4ZTM1ODQ2YjgyNTA1ZmM1CiAgICAgICAgLy8gMHgyNzY1NTZkZjc0OWNlZTUKICAgICAgICAvLyAweDU3NjFmZjllMjk5Y2M0CiAgICAgICAgLy8gMHhhMTg0ODk3YzM2M2MzCiAgICAgICAgdWludCB6cG93ID0gejsKICAgICAgICB1aW50IHJlc3VsdCA9IE9ORTsKICAgICAgICByZXN1bHQgKz0gMHhiMTcyMTdmN2QxY2Y3OWFiICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4M2Q3ZjdiZmYwNThiMWQ1MCAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweGUzNTg0NmI4MjUwNWZjNSAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDI3NjU1NmRmNzQ5Y2VlNSAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDU3NjFmZjllMjk5Y2M0ICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4YTE4NDg5N2MzNjNjMyAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweGZmZTVmZTJjNDU4NiAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDE2MmMwMjIzYTVjOCAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDFiNTI1M2QzOTVlICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4MWU0Y2Y1MTU4YiAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDFlOGNhYzczNSAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDFjM2JkNjUwICogenBvdyAvIE9ORTsKICAgICAgICB6cG93ID0genBvdyAqIHogLyBPTkU7CiAgICAgICAgcmVzdWx0ICs9IDB4MTgxNjE5MyAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweDEzMTQ5NiAqIHpwb3cgLyBPTkU7CiAgICAgICAgenBvdyA9IHpwb3cgKiB6IC8gT05FOwogICAgICAgIHJlc3VsdCArPSAweGUxYjcgKiB6cG93IC8gT05FOwogICAgICAgIHpwb3cgPSB6cG93ICogeiAvIE9ORTsKICAgICAgICByZXN1bHQgKz0gMHg5YzcgKiB6cG93IC8gT05FOwogICAgICAgIGlmIChzaGlmdCA+PSAwKSB7CiAgICAgICAgICAgIGlmIChyZXN1bHQgPj4gKDI1Ni1zaGlmdCkgPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuICgyKioyNTYtMSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQgPDwgc2hpZnQ7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA+PiAoLXNoaWZ0KTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG5hdHVyYWwgbG9nYXJpdGhtIHZhbHVlIG9mIGdpdmVuIHgKICAgIC8vLyBAcGFyYW0geCB4CiAgICAvLy8gQHJldHVybiBsbih4KQogICAgZnVuY3Rpb24gbG4odWludCB4KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIHJlcXVpcmUoeCA+IDApOwogICAgICAgIC8vIGJpbmFyeSBzZWFyY2ggZm9yIGZsb29yKGxvZzIoeCkpCiAgICAgICAgaW50IGlsb2cyID0gZmxvb3JMb2cyKHgpOwogICAgICAgIGludCB6OwogICAgICAgIGlmIChpbG9nMiA8IDApCiAgICAgICAgICAgIHogPSBpbnQoeCA8PCB1aW50KC1pbG9nMikpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgeiA9IGludCh4ID4+IHVpbnQoaWxvZzIpKTsKICAgICAgICAvLyB6ID0geCAqIDJeLeKMimxvZ+KCgnjijIsKICAgICAgICAvLyBzbyAxIDw9IHogPCAyCiAgICAgICAgLy8gYW5kIGxuIHogPSBsbiB4IC0g4oyKbG9n4oKCeOKMiy9sb2figoJlCiAgICAgICAgLy8gc28ganVzdCBjb21wdXRlIGxuIHogdXNpbmcgYXJ0YW5oIHNlcmllcwogICAgICAgIC8vIGFuZCBjYWxjdWxhdGUgbG4geCBmcm9tIHRoYXQKICAgICAgICBpbnQgdGVybSA9ICh6IC0gaW50KE9ORSkpICogaW50KE9ORSkgLyAoeiArIGludChPTkUpKTsKICAgICAgICBpbnQgaGFsZmxueiA9IHRlcm07CiAgICAgICAgaW50IHRlcm1wb3cgPSB0ZXJtICogdGVybSAvIGludChPTkUpICogdGVybSAvIGludChPTkUpOwogICAgICAgIGhhbGZsbnogKz0gdGVybXBvdyAvIDM7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gNTsKICAgICAgICB0ZXJtcG93ID0gdGVybXBvdyAqIHRlcm0gLyBpbnQoT05FKSAqIHRlcm0gLyBpbnQoT05FKTsKICAgICAgICBoYWxmbG56ICs9IHRlcm1wb3cgLyA3OwogICAgICAgIHRlcm1wb3cgPSB0ZXJtcG93ICogdGVybSAvIGludChPTkUpICogdGVybSAvIGludChPTkUpOwogICAgICAgIGhhbGZsbnogKz0gdGVybXBvdyAvIDk7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTE7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTM7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTU7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTc7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMTk7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMjE7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMjM7CiAgICAgICAgdGVybXBvdyA9IHRlcm1wb3cgKiB0ZXJtIC8gaW50KE9ORSkgKiB0ZXJtIC8gaW50KE9ORSk7CiAgICAgICAgaGFsZmxueiArPSB0ZXJtcG93IC8gMjU7CiAgICAgICAgcmV0dXJuIChpbG9nMiAqIGludChPTkUpKSAqIGludChPTkUpIC8gaW50KExPRzJfRSkgKyAyICogaGFsZmxuejsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGJhc2UgMiBsb2dhcml0aG0gdmFsdWUgb2YgZ2l2ZW4geAogICAgLy8vIEBwYXJhbSB4IHgKICAgIC8vLyBAcmV0dXJuIGxvZ2FyaXRobWljIHZhbHVlCiAgICBmdW5jdGlvbiBmbG9vckxvZzIodWludCB4KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50IGxvKQogICAgewogICAgICAgIGxvID0gLTY0OwogICAgICAgIGludCBoaSA9IDE5MzsKICAgICAgICAvLyBJIHVzZSBhIHNoaWZ0IGhlcmUgaW5zdGVhZCBvZiAvIDIgYmVjYXVzZSBpdCBmbG9vcnMgaW5zdGVhZCBvZiByb3VuZGluZyB0b3dhcmRzIDAKICAgICAgICBpbnQgbWlkID0gKGhpICsgbG8pID4+IDE7CiAgICAgICAgd2hpbGUoKGxvICsgMSkgPCBoaSkgewogICAgICAgICAgICBpZiAobWlkIDwgMCAmJiB4IDw8IHVpbnQoLW1pZCkgPCBPTkUgfHwgbWlkID49IDAgJiYgeCA+PiB1aW50KG1pZCkgPCBPTkUpCiAgICAgICAgICAgICAgICBoaSA9IG1pZDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG8gPSBtaWQ7CiAgICAgICAgICAgIG1pZCA9IChoaSArIGxvKSA+PiAxOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG1heGltdW0gb2YgYW4gYXJyYXkKICAgIC8vLyBAcGFyYW0gbnVtcyBOdW1iZXJzIHRvIGxvb2sgdGhyb3VnaAogICAgLy8vIEByZXR1cm4gTWF4aW11bSBudW1iZXIKICAgIGZ1bmN0aW9uIG1heChpbnRbXSBudW1zKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50IG1heCkKICAgIHsKICAgICAgICByZXF1aXJlKG51bXMubGVuZ3RoID4gMCk7CiAgICAgICAgbWF4ID0gLTIqKjI1NTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBudW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAobnVtc1tpXSA+IG1heCkKICAgICAgICAgICAgICAgIG1heCA9IG51bXNbaV07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB3aGV0aGVyIGFuIGFkZCBvcGVyYXRpb24gY2F1c2VzIGFuIG92ZXJmbG93CiAgICAvLy8gQHBhcmFtIGEgRmlyc3QgYWRkZW5kCiAgICAvLy8gQHBhcmFtIGIgU2Vjb25kIGFkZGVuZAogICAgLy8vIEByZXR1cm4gRGlkIG5vIG92ZXJmbG93IG9jY3VyPwogICAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYSArIGIgPj0gYTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgYSBzdWJ0cmFjdGlvbiBvcGVyYXRpb24gY2F1c2VzIGFuIHVuZGVyZmxvdwogICAgLy8vIEBwYXJhbSBhIE1pbnVlbmQKICAgIC8vLyBAcGFyYW0gYiBTdWJ0cmFoZW5kCiAgICAvLy8gQHJldHVybiBEaWQgbm8gdW5kZXJmbG93IG9jY3VyPwogICAgZnVuY3Rpb24gc2FmZVRvU3ViKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYSA+PSBiOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgd2hldGhlciBhIG11bHRpcGx5IG9wZXJhdGlvbiBjYXVzZXMgYW4gb3ZlcmZsb3cKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBmYWN0b3IKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgZmFjdG9yCiAgICAvLy8gQHJldHVybiBEaWQgbm8gb3ZlcmZsb3cgb2NjdXI/CiAgICBmdW5jdGlvbiBzYWZlVG9NdWwodWludCBhLCB1aW50IGIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBiID09IDAgfHwgYSAqIGIgLyBiID09IGE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBzdW0gaWYgbm8gb3ZlcmZsb3cgb2NjdXJyZWQKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBhZGRlbmQKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgYWRkZW5kCiAgICAvLy8gQHJldHVybiBTdW0KICAgIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShzYWZlVG9BZGQoYSwgYikpOwogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGRpZmZlcmVuY2UgaWYgbm8gb3ZlcmZsb3cgb2NjdXJyZWQKICAgIC8vLyBAcGFyYW0gYSBNaW51ZW5kCiAgICAvLy8gQHBhcmFtIGIgU3VidHJhaGVuZAogICAgLy8vIEByZXR1cm4gRGlmZmVyZW5jZQogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKHNhZmVUb1N1YihhLCBiKSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgcHJvZHVjdCBpZiBubyBvdmVyZmxvdyBvY2N1cnJlZAogICAgLy8vIEBwYXJhbSBhIEZpcnN0IGZhY3RvcgogICAgLy8vIEBwYXJhbSBiIFNlY29uZCBmYWN0b3IKICAgIC8vLyBAcmV0dXJuIFByb2R1Y3QKICAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShzYWZlVG9NdWwoYSwgYikpOwogICAgICAgIHJldHVybiBhICogYjsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgYW4gYWRkIG9wZXJhdGlvbiBjYXVzZXMgYW4gb3ZlcmZsb3cKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBhZGRlbmQKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgYWRkZW5kCiAgICAvLy8gQHJldHVybiBEaWQgbm8gb3ZlcmZsb3cgb2NjdXI/CiAgICBmdW5jdGlvbiBzYWZlVG9BZGQoaW50IGEsIGludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gKGIgPj0gMCAmJiBhICsgYiA+PSBhKSB8fCAoYiA8IDAgJiYgYSArIGIgPCBhKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgYSBzdWJ0cmFjdGlvbiBvcGVyYXRpb24gY2F1c2VzIGFuIHVuZGVyZmxvdwogICAgLy8vIEBwYXJhbSBhIE1pbnVlbmQKICAgIC8vLyBAcGFyYW0gYiBTdWJ0cmFoZW5kCiAgICAvLy8gQHJldHVybiBEaWQgbm8gdW5kZXJmbG93IG9jY3VyPwogICAgZnVuY3Rpb24gc2FmZVRvU3ViKGludCBhLCBpbnQgYikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIChiID49IDAgJiYgYSAtIGIgPD0gYSkgfHwgKGIgPCAwICYmIGEgLSBiID4gYSk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB3aGV0aGVyIGEgbXVsdGlwbHkgb3BlcmF0aW9uIGNhdXNlcyBhbiBvdmVyZmxvdwogICAgLy8vIEBwYXJhbSBhIEZpcnN0IGZhY3RvcgogICAgLy8vIEBwYXJhbSBiIFNlY29uZCBmYWN0b3IKICAgIC8vLyBAcmV0dXJuIERpZCBubyBvdmVyZmxvdyBvY2N1cj8KICAgIGZ1bmN0aW9uIHNhZmVUb011bChpbnQgYSwgaW50IGIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoYiA9PSAwKSB8fCAoYSAqIGIgLyBiID09IGEpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgc3VtIGlmIG5vIG92ZXJmbG93IG9jY3VycmVkCiAgICAvLy8gQHBhcmFtIGEgRmlyc3QgYWRkZW5kCiAgICAvLy8gQHBhcmFtIGIgU2Vjb25kIGFkZGVuZAogICAgLy8vIEByZXR1cm4gU3VtCiAgICBmdW5jdGlvbiBhZGQoaW50IGEsIGludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIHJlcXVpcmUoc2FmZVRvQWRkKGEsIGIpKTsKICAgICAgICByZXR1cm4gYSArIGI7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBkaWZmZXJlbmNlIGlmIG5vIG92ZXJmbG93IG9jY3VycmVkCiAgICAvLy8gQHBhcmFtIGEgTWludWVuZAogICAgLy8vIEBwYXJhbSBiIFN1YnRyYWhlbmQKICAgIC8vLyBAcmV0dXJuIERpZmZlcmVuY2UKICAgIGZ1bmN0aW9uIHN1YihpbnQgYSwgaW50IGIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShzYWZlVG9TdWIoYSwgYikpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHByb2R1Y3QgaWYgbm8gb3ZlcmZsb3cgb2NjdXJyZWQKICAgIC8vLyBAcGFyYW0gYSBGaXJzdCBmYWN0b3IKICAgIC8vLyBAcGFyYW0gYiBTZWNvbmQgZmFjdG9yCiAgICAvLy8gQHJldHVybiBQcm9kdWN0CiAgICBmdW5jdGlvbiBtdWwoaW50IGEsIGludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIHJlcXVpcmUoc2FmZVRvTXVsKGEsIGIpKTsKICAgICAgICByZXR1cm4gYSAqIGI7CiAgICB9Cn0KCi8vLyBJbXBsZW1lbnRzIEVSQyAyMCBUb2tlbiBzdGFuZGFyZDogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKCgovLy8gQHRpdGxlIEFic3RyYWN0IHRva2VuIGNvbnRyYWN0IC0gRnVuY3Rpb25zIHRvIGJlIGltcGxlbWVudGVkIGJ5IHRva2VuIGNvbnRyYWN0cwpjb250cmFjdCBUb2tlbiB7CgogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKfQoKCgovLy8gQHRpdGxlIFN0YW5kYXJkIHRva2VuIGNvbnRyYWN0IHdpdGggb3ZlcmZsb3cgcHJvdGVjdGlvbgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuIHsKICAgIHVzaW5nIE1hdGggZm9yICo7CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93YW5jZXM7CiAgICB1aW50IHRvdGFsVG9rZW5zOwoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgc2VuZGVyJ3MgdG9rZW5zIHRvIGEgZ2l2ZW4gYWRkcmVzcy4gUmV0dXJucyBzdWNjZXNzCiAgICAvLy8gQHBhcmFtIHRvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgIC8vLyBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2FzIHRyYW5zZmVyIHN1Y2Nlc3NmdWw/CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKCAgICFiYWxhbmNlc1ttc2cuc2VuZGVyXS5zYWZlVG9TdWIodmFsdWUpCiAgICAgICAgICAgIHx8ICFiYWxhbmNlc1t0b10uc2FmZVRvQWRkKHZhbHVlKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IHZhbHVlOwogICAgICAgIGJhbGFuY2VzW3RvXSArPSB2YWx1ZTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbGxvd2VkIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuIFJldHVybnMgc3VjY2VzcwogICAgLy8vIEBwYXJhbSBmcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bgogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudAogICAgLy8vIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBXYXMgdHJhbnNmZXIgc3VjY2Vzc2Z1bD8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoICAgIWJhbGFuY2VzW2Zyb21dLnNhZmVUb1N1Yih2YWx1ZSkKICAgICAgICAgICAgfHwgIWFsbG93YW5jZXNbZnJvbV1bbXNnLnNlbmRlcl0uc2FmZVRvU3ViKHZhbHVlKQogICAgICAgICAgICB8fCAhYmFsYW5jZXNbdG9dLnNhZmVUb0FkZCh2YWx1ZSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBiYWxhbmNlc1tmcm9tXSAtPSB2YWx1ZTsKICAgICAgICBhbGxvd2FuY2VzW2Zyb21dW21zZy5zZW5kZXJdIC09IHZhbHVlOwogICAgICAgIGJhbGFuY2VzW3RvXSArPSB2YWx1ZTsKICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzCiAgICAvLy8gQHBhcmFtIHNwZW5kZXIgQWRkcmVzcyBvZiBhbGxvd2VkIGFjY291bnQKICAgIC8vLyBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIGFwcHJvdmVkIHRva2VucwogICAgLy8vIEByZXR1cm4gV2FzIGFwcHJvdmFsIHN1Y2Nlc3NmdWw/CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFsbG93YW5jZXNbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgYWxsb3dlZCB0b2tlbnMgZm9yIGdpdmVuIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lcgogICAgLy8vIEBwYXJhbSBzcGVuZGVyIEFkZHJlc3Mgb2YgdG9rZW4gc3BlbmRlcgogICAgLy8vIEByZXR1cm4gUmVtYWluaW5nIGFsbG93YW5jZSBmb3Igc3BlbmRlcgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG93YW5jZXNbb3duZXJdW3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIHRva2VucyBvd25lZCBieSBnaXZlbiBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIKICAgIC8vLyBAcmV0dXJuIEJhbGFuY2Ugb2Ygb3duZXIKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbb3duZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgc3VwcGx5IG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVG90YWwgc3VwcGx5CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiB0b3RhbFRva2VuczsKICAgIH0KfQoKCi8vLyBAdGl0bGUgT3V0Y29tZSB0b2tlbiBjb250cmFjdCAtIElzc3VpbmcgYW5kIHJldm9raW5nIG91dGNvbWUgdG9rZW5zCi8vLyBAYXV0aG9yIFN0ZWZhbiBHZW9yZ2UgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1OTJhMmQzYzNmMzgzNzE5M2UzNzM2MmEzMDJhNzcyOTM0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgT3V0Y29tZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewogICAgdXNpbmcgTWF0aCBmb3IgKjsKCiAgICAvKgogICAgICogIEV2ZW50cwogICAgICovCiAgICBldmVudCBJc3N1YW5jZShhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IFJldm9jYXRpb24oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IGFtb3VudCk7CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIGV2ZW50Q29udHJhY3Q7CgogICAgLyoKICAgICAqICBNb2RpZmllcnMKICAgICAqLwogICAgbW9kaWZpZXIgaXNFdmVudENvbnRyYWN0ICgpIHsKICAgICAgICAvLyBPbmx5IGV2ZW50IGNvbnRyYWN0IGlzIGFsbG93ZWQgdG8gcHJvY2VlZAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBldmVudENvbnRyYWN0KTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciBzZXRzIGV2ZW50cyBjb250cmFjdCBhZGRyZXNzCiAgICBmdW5jdGlvbiBPdXRjb21lVG9rZW4oKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGV2ZW50Q29udHJhY3QgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBFdmVudHMgY29udHJhY3QgaXNzdWVzIG5ldyB0b2tlbnMgZm9yIGFkZHJlc3MuIFJldHVybnMgc3VjY2VzcwogICAgLy8vIEBwYXJhbSBfZm9yIEFkZHJlc3Mgb2YgcmVjZWl2ZXIKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuQ291bnQgTnVtYmVyIG9mIHRva2VucyB0byBpc3N1ZQogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfZm9yLCB1aW50IG91dGNvbWVUb2tlbkNvdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIGlzRXZlbnRDb250cmFjdAogICAgewogICAgICAgIGJhbGFuY2VzW19mb3JdID0gYmFsYW5jZXNbX2Zvcl0uYWRkKG91dGNvbWVUb2tlbkNvdW50KTsKICAgICAgICB0b3RhbFRva2VucyA9IHRvdGFsVG9rZW5zLmFkZChvdXRjb21lVG9rZW5Db3VudCk7CiAgICAgICAgSXNzdWFuY2UoX2Zvciwgb3V0Y29tZVRva2VuQ291bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IEV2ZW50cyBjb250cmFjdCByZXZva2VzIHRva2VucyBmb3IgYWRkcmVzcy4gUmV0dXJucyBzdWNjZXNzCiAgICAvLy8gQHBhcmFtIF9mb3IgQWRkcmVzcyBvZiB0b2tlbiBob2xkZXIKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuQ291bnQgTnVtYmVyIG9mIHRva2VucyB0byByZXZva2UKICAgIGZ1bmN0aW9uIHJldm9rZShhZGRyZXNzIF9mb3IsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgaXNFdmVudENvbnRyYWN0CiAgICB7CiAgICAgICAgYmFsYW5jZXNbX2Zvcl0gPSBiYWxhbmNlc1tfZm9yXS5zdWIob3V0Y29tZVRva2VuQ291bnQpOwogICAgICAgIHRvdGFsVG9rZW5zID0gdG90YWxUb2tlbnMuc3ViKG91dGNvbWVUb2tlbkNvdW50KTsKICAgICAgICBSZXZvY2F0aW9uKF9mb3IsIG91dGNvbWVUb2tlbkNvdW50KTsKICAgIH0KfQoKCgovLy8gQHRpdGxlIEFic3RyYWN0IG9yYWNsZSBjb250cmFjdCAtIEZ1bmN0aW9ucyB0byBiZSBpbXBsZW1lbnRlZCBieSBvcmFjbGVzCmNvbnRyYWN0IE9yYWNsZSB7CgogICAgZnVuY3Rpb24gaXNPdXRjb21lU2V0KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0T3V0Y29tZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChpbnQpOwp9CgoKCi8vLyBAdGl0bGUgRXZlbnQgY29udHJhY3QgLSBQcm92aWRlIGJhc2ljIGZ1bmN0aW9uYWxpdHkgcmVxdWlyZWQgYnkgZGlmZmVyZW50IGV2ZW50IHR5cGVzCi8vLyBAYXV0aG9yIFN0ZWZhbiBHZW9yZ2UgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmODhiOGM5ZDllOTk5NmI4OWY5Njk3OGI5MThiZDY4ODk1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgRXZlbnQgewoKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IE91dGNvbWVUb2tlbkNyZWF0aW9uKE91dGNvbWVUb2tlbiBvdXRjb21lVG9rZW4sIHVpbnQ4IGluZGV4KTsKICAgIGV2ZW50IE91dGNvbWVUb2tlblNldElzc3VhbmNlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBjb2xsYXRlcmFsVG9rZW5Db3VudCk7CiAgICBldmVudCBPdXRjb21lVG9rZW5TZXRSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQpOwogICAgZXZlbnQgT3V0Y29tZUFzc2lnbm1lbnQoaW50IG91dGNvbWUpOwogICAgZXZlbnQgV2lubmluZ3NSZWRlbXB0aW9uKGFkZHJlc3MgaW5kZXhlZCByZWNlaXZlciwgdWludCB3aW5uaW5ncyk7CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIFRva2VuIHB1YmxpYyBjb2xsYXRlcmFsVG9rZW47CiAgICBPcmFjbGUgcHVibGljIG9yYWNsZTsKICAgIGJvb2wgcHVibGljIGlzT3V0Y29tZVNldDsKICAgIGludCBwdWJsaWMgb3V0Y29tZTsKICAgIE91dGNvbWVUb2tlbltdIHB1YmxpYyBvdXRjb21lVG9rZW5zOwoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciB2YWxpZGF0ZXMgYW5kIHNldHMgYmFzaWMgZXZlbnQgcHJvcGVydGllcwogICAgLy8vIEBwYXJhbSBfY29sbGF0ZXJhbFRva2VuIFRva2VucyB1c2VkIGFzIGNvbGxhdGVyYWwgaW4gZXhjaGFuZ2UgZm9yIG91dGNvbWUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9vcmFjbGUgT3JhY2xlIGNvbnRyYWN0IHVzZWQgdG8gcmVzb2x2ZSB0aGUgZXZlbnQKICAgIC8vLyBAcGFyYW0gb3V0Y29tZUNvdW50IE51bWJlciBvZiBldmVudCBvdXRjb21lcwogICAgZnVuY3Rpb24gRXZlbnQoVG9rZW4gX2NvbGxhdGVyYWxUb2tlbiwgT3JhY2xlIF9vcmFjbGUsIHVpbnQ4IG91dGNvbWVDb3VudCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBWYWxpZGF0ZSBpbnB1dAogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhfY29sbGF0ZXJhbFRva2VuKSAhPSAwICYmIGFkZHJlc3MoX29yYWNsZSkgIT0gMCAmJiBvdXRjb21lQ291bnQgPj0gMik7CiAgICAgICAgY29sbGF0ZXJhbFRva2VuID0gX2NvbGxhdGVyYWxUb2tlbjsKICAgICAgICBvcmFjbGUgPSBfb3JhY2xlOwogICAgICAgIC8vIENyZWF0ZSBhbiBvdXRjb21lIHRva2VuIGZvciBlYWNoIG91dGNvbWUKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgb3V0Y29tZUNvdW50OyBpKyspIHsKICAgICAgICAgICAgT3V0Y29tZVRva2VuIG91dGNvbWVUb2tlbiA9IG5ldyBPdXRjb21lVG9rZW4oKTsKICAgICAgICAgICAgb3V0Y29tZVRva2Vucy5wdXNoKG91dGNvbWVUb2tlbik7CiAgICAgICAgICAgIE91dGNvbWVUb2tlbkNyZWF0aW9uKG91dGNvbWVUb2tlbiwgaSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEJ1eXMgZXF1YWwgbnVtYmVyIG9mIHRva2VucyBvZiBhbGwgb3V0Y29tZXMsIGV4Y2hhbmdpbmcgY29sbGF0ZXJhbCB0b2tlbnMgYW5kIHNldHMgb2Ygb3V0Y29tZSB0b2tlbnMgMToxCiAgICAvLy8gQHBhcmFtIGNvbGxhdGVyYWxUb2tlbkNvdW50IE51bWJlciBvZiBjb2xsYXRlcmFsIHRva2VucwogICAgZnVuY3Rpb24gYnV5QWxsT3V0Y29tZXModWludCBjb2xsYXRlcmFsVG9rZW5Db3VudCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBUcmFuc2ZlciBjb2xsYXRlcmFsIHRva2VucyB0byBldmVudHMgY29udHJhY3QKICAgICAgICByZXF1aXJlKGNvbGxhdGVyYWxUb2tlbi50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgY29sbGF0ZXJhbFRva2VuQ291bnQpKTsKICAgICAgICAvLyBJc3N1ZSBuZXcgb3V0Y29tZSB0b2tlbnMgdG8gc2VuZGVyCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IG91dGNvbWVUb2tlbnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIG91dGNvbWVUb2tlbnNbaV0uaXNzdWUobXNnLnNlbmRlciwgY29sbGF0ZXJhbFRva2VuQ291bnQpOwogICAgICAgIE91dGNvbWVUb2tlblNldElzc3VhbmNlKG1zZy5zZW5kZXIsIGNvbGxhdGVyYWxUb2tlbkNvdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBTZWxscyBlcXVhbCBudW1iZXIgb2YgdG9rZW5zIG9mIGFsbCBvdXRjb21lcywgZXhjaGFuZ2luZyBjb2xsYXRlcmFsIHRva2VucyBhbmQgc2V0cyBvZiBvdXRjb21lIHRva2VucyAxOjEKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuQ291bnQgTnVtYmVyIG9mIG91dGNvbWUgdG9rZW5zCiAgICBmdW5jdGlvbiBzZWxsQWxsT3V0Y29tZXModWludCBvdXRjb21lVG9rZW5Db3VudCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBSZXZva2Ugc2VuZGVyJ3Mgb3V0Y29tZSB0b2tlbnMgb2YgYWxsIG91dGNvbWVzCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IG91dGNvbWVUb2tlbnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIG91dGNvbWVUb2tlbnNbaV0ucmV2b2tlKG1zZy5zZW5kZXIsIG91dGNvbWVUb2tlbkNvdW50KTsKICAgICAgICAvLyBUcmFuc2ZlciBjb2xsYXRlcmFsIHRva2VucyB0byBzZW5kZXIKICAgICAgICByZXF1aXJlKGNvbGxhdGVyYWxUb2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBvdXRjb21lVG9rZW5Db3VudCkpOwogICAgICAgIE91dGNvbWVUb2tlblNldFJldm9jYXRpb24obXNnLnNlbmRlciwgb3V0Y29tZVRva2VuQ291bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgd2lubmluZyBldmVudCBvdXRjb21lCiAgICBmdW5jdGlvbiBzZXRPdXRjb21lKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBXaW5uaW5nIG91dGNvbWUgaXMgbm90IHNldCB5ZXQgaW4gZXZlbnQgY29udHJhY3QgYnV0IGluIG9yYWNsZSBjb250cmFjdAogICAgICAgIHJlcXVpcmUoIWlzT3V0Y29tZVNldCAmJiBvcmFjbGUuaXNPdXRjb21lU2V0KCkpOwogICAgICAgIC8vIFNldCB3aW5uaW5nIG91dGNvbWUKICAgICAgICBvdXRjb21lID0gb3JhY2xlLmdldE91dGNvbWUoKTsKICAgICAgICBpc091dGNvbWVTZXQgPSB0cnVlOwogICAgICAgIE91dGNvbWVBc3NpZ25tZW50KG91dGNvbWUpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgb3V0Y29tZSBjb3VudAogICAgLy8vIEByZXR1cm4gT3V0Y29tZSBjb3VudAogICAgZnVuY3Rpb24gZ2V0T3V0Y29tZUNvdW50KCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQ4KQogICAgewogICAgICAgIHJldHVybiB1aW50OChvdXRjb21lVG9rZW5zLmxlbmd0aCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBvdXRjb21lIHRva2VucyBhcnJheQogICAgLy8vIEByZXR1cm4gT3V0Y29tZSB0b2tlbnMKICAgIGZ1bmN0aW9uIGdldE91dGNvbWVUb2tlbnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoT3V0Y29tZVRva2VuW10pCiAgICB7CiAgICAgICAgcmV0dXJuIG91dGNvbWVUb2tlbnM7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgYW1vdW50IG9mIG91dGNvbWUgdG9rZW5zIGhlbGQgYnkgb3duZXIKICAgIC8vLyBAcmV0dXJuIE91dGNvbWUgdG9rZW4gZGlzdHJpYnV0aW9uCiAgICBmdW5jdGlvbiBnZXRPdXRjb21lVG9rZW5EaXN0cmlidXRpb24oYWRkcmVzcyBvd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnRbXSBvdXRjb21lVG9rZW5EaXN0cmlidXRpb24pCiAgICB7CiAgICAgICAgb3V0Y29tZVRva2VuRGlzdHJpYnV0aW9uID0gbmV3IHVpbnRbXShvdXRjb21lVG9rZW5zLmxlbmd0aCk7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IG91dGNvbWVUb2tlbkRpc3RyaWJ1dGlvbi5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0Y29tZVRva2VuRGlzdHJpYnV0aW9uW2ldID0gb3V0Y29tZVRva2Vuc1tpXS5iYWxhbmNlT2Yob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgYW5kIHJldHVybnMgZXZlbnQgaGFzaAogICAgLy8vIEByZXR1cm4gRXZlbnQgaGFzaAogICAgZnVuY3Rpb24gZ2V0RXZlbnRIYXNoKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpOwoKICAgIC8vLyBAZGV2IEV4Y2hhbmdlcyBzZW5kZXIncyB3aW5uaW5nIG91dGNvbWUgdG9rZW5zIGZvciBjb2xsYXRlcmFsIHRva2VucwogICAgLy8vIEByZXR1cm4gU2VuZGVyJ3Mgd2lubmluZ3MKICAgIGZ1bmN0aW9uIHJlZGVlbVdpbm5pbmdzKCkgcHVibGljIHJldHVybnMgKHVpbnQpOwp9CgoKCi8vLyBAdGl0bGUgQWJzdHJhY3QgbWFya2V0IG1ha2VyIGNvbnRyYWN0IC0gRnVuY3Rpb25zIHRvIGJlIGltcGxlbWVudGVkIGJ5IG1hcmtldCBtYWtlciBjb250cmFjdHMKY29udHJhY3QgTWFya2V0TWFrZXIgewoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICBmdW5jdGlvbiBjYWxjQ29zdChNYXJrZXQgbWFya2V0LCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gY2FsY1Byb2ZpdChNYXJrZXQgbWFya2V0LCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gY2FsY01hcmdpbmFsUHJpY2UoTWFya2V0IG1hcmtldCwgdWludDggb3V0Y29tZVRva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKfQoKCgovLy8gQHRpdGxlIEFic3RyYWN0IG1hcmtldCBjb250cmFjdCAtIEZ1bmN0aW9ucyB0byBiZSBpbXBsZW1lbnRlZCBieSBtYXJrZXQgY29udHJhY3RzCmNvbnRyYWN0IE1hcmtldCB7CgogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgTWFya2V0RnVuZGluZyh1aW50IGZ1bmRpbmcpOwogICAgZXZlbnQgTWFya2V0Q2xvc2luZygpOwogICAgZXZlbnQgRmVlV2l0aGRyYXdhbCh1aW50IGZlZXMpOwogICAgZXZlbnQgT3V0Y29tZVRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBvdXRjb21lVG9rZW5Db3N0LCB1aW50IG1hcmtldEZlZXMpOwogICAgZXZlbnQgT3V0Y29tZVRva2VuU2FsZShhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBvdXRjb21lVG9rZW5Qcm9maXQsIHVpbnQgbWFya2V0RmVlcyk7CiAgICBldmVudCBPdXRjb21lVG9rZW5TaG9ydFNhbGUoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBjb3N0KTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvcjsKICAgIHVpbnQgcHVibGljIGNyZWF0ZWRBdEJsb2NrOwogICAgRXZlbnQgcHVibGljIGV2ZW50Q29udHJhY3Q7CiAgICBNYXJrZXRNYWtlciBwdWJsaWMgbWFya2V0TWFrZXI7CiAgICB1aW50MjQgcHVibGljIGZlZTsKICAgIHVpbnQgcHVibGljIGZ1bmRpbmc7CiAgICBpbnRbXSBwdWJsaWMgbmV0T3V0Y29tZVRva2Vuc1NvbGQ7CiAgICBTdGFnZXMgcHVibGljIHN0YWdlOwoKICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBNYXJrZXRDcmVhdGVkLAogICAgICAgIE1hcmtldEZ1bmRlZCwKICAgICAgICBNYXJrZXRDbG9zZWQKICAgIH0KCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgZnVuY3Rpb24gZnVuZCh1aW50IF9mdW5kaW5nKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBjbG9zZSgpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RmVlcygpIHB1YmxpYyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJ1eSh1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBtYXhDb3N0KSBwdWJsaWMgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBzZWxsKHVpbnQ4IG91dGNvbWVUb2tlbkluZGV4LCB1aW50IG91dGNvbWVUb2tlbkNvdW50LCB1aW50IG1pblByb2ZpdCkgcHVibGljIHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gc2hvcnRTZWxsKHVpbnQ4IG91dGNvbWVUb2tlbkluZGV4LCB1aW50IG91dGNvbWVUb2tlbkNvdW50LCB1aW50IG1pblByb2ZpdCkgcHVibGljIHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gY2FsY01hcmtldEZlZSh1aW50IG91dGNvbWVUb2tlbkNvc3QpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKfQoKCi8vLyBAdGl0bGUgTWFya2V0IGZhY3RvcnkgY29udHJhY3QgLSBBbGxvd3MgdG8gY3JlYXRlIG1hcmtldCBjb250cmFjdHMKLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImY1ODY4MTkwOTM5NDliYjU5MjliOWE4NjljODZkYjg1OTgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBTdGFuZGFyZE1hcmtldCBpcyBNYXJrZXQgewogICAgdXNpbmcgTWF0aCBmb3IgKjsKCiAgICAvKgogICAgICogIENvbnN0YW50cwogICAgICovCiAgICB1aW50MjQgcHVibGljIGNvbnN0YW50IEZFRV9SQU5HRSA9IDEwMDAwMDA7IC8vIDEwMCUKCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBpc0NyZWF0b3IoKSB7CiAgICAgICAgLy8gT25seSBjcmVhdG9yIGlzIGFsbG93ZWQgdG8gcHJvY2VlZAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcmVhdG9yKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGF0U3RhZ2UoU3RhZ2VzIF9zdGFnZSkgewogICAgICAgIC8vIENvbnRyYWN0IGhhcyB0byBiZSBpbiBnaXZlbiBzdGFnZQogICAgICAgIHJlcXVpcmUoc3RhZ2UgPT0gX3N0YWdlKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciB2YWxpZGF0ZXMgYW5kIHNldHMgbWFya2V0IHByb3BlcnRpZXMKICAgIC8vLyBAcGFyYW0gX2NyZWF0b3IgTWFya2V0IGNyZWF0b3IKICAgIC8vLyBAcGFyYW0gX2V2ZW50Q29udHJhY3QgRXZlbnQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX21hcmtldE1ha2VyIE1hcmtldCBtYWtlciBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfZmVlIE1hcmtldCBmZWUKICAgIGZ1bmN0aW9uIFN0YW5kYXJkTWFya2V0KGFkZHJlc3MgX2NyZWF0b3IsIEV2ZW50IF9ldmVudENvbnRyYWN0LCBNYXJrZXRNYWtlciBfbWFya2V0TWFrZXIsIHVpbnQyNCBfZmVlKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIFZhbGlkYXRlIGlucHV0cwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhfZXZlbnRDb250cmFjdCkgIT0gMCAmJiBhZGRyZXNzKF9tYXJrZXRNYWtlcikgIT0gMCAmJiBfZmVlIDwgRkVFX1JBTkdFKTsKICAgICAgICBjcmVhdG9yID0gX2NyZWF0b3I7CiAgICAgICAgY3JlYXRlZEF0QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgZXZlbnRDb250cmFjdCA9IF9ldmVudENvbnRyYWN0OwogICAgICAgIG5ldE91dGNvbWVUb2tlbnNTb2xkID0gbmV3IGludFtdKGV2ZW50Q29udHJhY3QuZ2V0T3V0Y29tZUNvdW50KCkpOwogICAgICAgIGZlZSA9IF9mZWU7CiAgICAgICAgbWFya2V0TWFrZXIgPSBfbWFya2V0TWFrZXI7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuTWFya2V0Q3JlYXRlZDsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gZnVuZCB0aGUgbWFya2V0IHdpdGggY29sbGF0ZXJhbCB0b2tlbnMgY29udmVydGluZyB0aGVtIGludG8gb3V0Y29tZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Z1bmRpbmcgRnVuZGluZyBhbW91bnQKICAgIGZ1bmN0aW9uIGZ1bmQodWludCBfZnVuZGluZykKICAgICAgICBwdWJsaWMKICAgICAgICBpc0NyZWF0b3IKICAgICAgICBhdFN0YWdlKFN0YWdlcy5NYXJrZXRDcmVhdGVkKQogICAgewogICAgICAgIC8vIFJlcXVlc3QgY29sbGF0ZXJhbCB0b2tlbnMgYW5kIGFsbG93IGV2ZW50IGNvbnRyYWN0IHRvIHRyYW5zZmVyIHRoZW0gdG8gYnV5IGFsbCBvdXRjb21lcwogICAgICAgIHJlcXVpcmUoICAgZXZlbnRDb250cmFjdC5jb2xsYXRlcmFsVG9rZW4oKS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgX2Z1bmRpbmcpCiAgICAgICAgICAgICAgICAmJiBldmVudENvbnRyYWN0LmNvbGxhdGVyYWxUb2tlbigpLmFwcHJvdmUoZXZlbnRDb250cmFjdCwgX2Z1bmRpbmcpKTsKICAgICAgICBldmVudENvbnRyYWN0LmJ1eUFsbE91dGNvbWVzKF9mdW5kaW5nKTsKICAgICAgICBmdW5kaW5nID0gX2Z1bmRpbmc7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuTWFya2V0RnVuZGVkOwogICAgICAgIE1hcmtldEZ1bmRpbmcoZnVuZGluZyk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIG1hcmtldCBjcmVhdG9yIHRvIGNsb3NlIHRoZSBtYXJrZXRzIGJ5IHRyYW5zZmVycmluZyBhbGwgcmVtYWluaW5nIG91dGNvbWUgdG9rZW5zIHRvIHRoZSBjcmVhdG9yCiAgICBmdW5jdGlvbiBjbG9zZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgaXNDcmVhdG9yCiAgICAgICAgYXRTdGFnZShTdGFnZXMuTWFya2V0RnVuZGVkKQogICAgewogICAgICAgIHVpbnQ4IG91dGNvbWVDb3VudCA9IGV2ZW50Q29udHJhY3QuZ2V0T3V0Y29tZUNvdW50KCk7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IG91dGNvbWVDb3VudDsgaSsrKQogICAgICAgICAgICByZXF1aXJlKGV2ZW50Q29udHJhY3Qub3V0Y29tZVRva2VucyhpKS50cmFuc2ZlcihjcmVhdG9yLCBldmVudENvbnRyYWN0Lm91dGNvbWVUb2tlbnMoaSkuYmFsYW5jZU9mKHRoaXMpKSk7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuTWFya2V0Q2xvc2VkOwogICAgICAgIE1hcmtldENsb3NpbmcoKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgbWFya2V0IGNyZWF0b3IgdG8gd2l0aGRyYXcgZmVlcyBnZW5lcmF0ZWQgYnkgdHJhZGVzCiAgICAvLy8gQHJldHVybiBGZWUgYW1vdW50CiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZlZXMoKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzQ3JlYXRvcgogICAgICAgIHJldHVybnMgKHVpbnQgZmVlcykKICAgIHsKICAgICAgICBmZWVzID0gZXZlbnRDb250cmFjdC5jb2xsYXRlcmFsVG9rZW4oKS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgLy8gVHJhbnNmZXIgZmVlcwogICAgICAgIHJlcXVpcmUoZXZlbnRDb250cmFjdC5jb2xsYXRlcmFsVG9rZW4oKS50cmFuc2ZlcihjcmVhdG9yLCBmZWVzKSk7CiAgICAgICAgRmVlV2l0aGRyYXdhbChmZWVzKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gYnV5IG91dGNvbWUgdG9rZW5zIGZyb20gbWFya2V0IG1ha2VyCiAgICAvLy8gQHBhcmFtIG91dGNvbWVUb2tlbkluZGV4IEluZGV4IG9mIHRoZSBvdXRjb21lIHRva2VuIHRvIGJ1eQogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5Db3VudCBBbW91bnQgb2Ygb3V0Y29tZSB0b2tlbnMgdG8gYnV5CiAgICAvLy8gQHBhcmFtIG1heENvc3QgVGhlIG1heGltdW0gY29zdCBpbiBjb2xsYXRlcmFsIHRva2VucyB0byBwYXkgZm9yIG91dGNvbWUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBDb3N0IGluIGNvbGxhdGVyYWwgdG9rZW5zCiAgICBmdW5jdGlvbiBidXkodWludDggb3V0Y29tZVRva2VuSW5kZXgsIHVpbnQgb3V0Y29tZVRva2VuQ291bnQsIHVpbnQgbWF4Q29zdCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdFN0YWdlKFN0YWdlcy5NYXJrZXRGdW5kZWQpCiAgICAgICAgcmV0dXJucyAodWludCBjb3N0KQogICAgewogICAgICAgIC8vIENhbGN1bGF0ZSBjb3N0IHRvIGJ1eSBvdXRjb21lIHRva2VucwogICAgICAgIHVpbnQgb3V0Y29tZVRva2VuQ29zdCA9IG1hcmtldE1ha2VyLmNhbGNDb3N0KHRoaXMsIG91dGNvbWVUb2tlbkluZGV4LCBvdXRjb21lVG9rZW5Db3VudCk7CiAgICAgICAgLy8gQ2FsY3VsYXRlIGZlZXMgY2hhcmdlZCBieSBtYXJrZXQKICAgICAgICB1aW50IGZlZXMgPSBjYWxjTWFya2V0RmVlKG91dGNvbWVUb2tlbkNvc3QpOwogICAgICAgIGNvc3QgPSBvdXRjb21lVG9rZW5Db3N0LmFkZChmZWVzKTsKICAgICAgICAvLyBDaGVjayBjb3N0IGRvZXNuJ3QgZXhjZWVkIG1heCBjb3N0CiAgICAgICAgcmVxdWlyZShjb3N0ID4gMCAmJiBjb3N0IDw9IG1heENvc3QpOwogICAgICAgIC8vIFRyYW5zZmVyIHRva2VucyB0byBtYXJrZXRzIGNvbnRyYWN0IGFuZCBidXkgYWxsIG91dGNvbWVzCiAgICAgICAgcmVxdWlyZSggICBldmVudENvbnRyYWN0LmNvbGxhdGVyYWxUb2tlbigpLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBjb3N0KQogICAgICAgICAgICAgICAgJiYgZXZlbnRDb250cmFjdC5jb2xsYXRlcmFsVG9rZW4oKS5hcHByb3ZlKGV2ZW50Q29udHJhY3QsIG91dGNvbWVUb2tlbkNvc3QpKTsKICAgICAgICAvLyBCdXkgYWxsIG91dGNvbWVzCiAgICAgICAgZXZlbnRDb250cmFjdC5idXlBbGxPdXRjb21lcyhvdXRjb21lVG9rZW5Db3N0KTsKICAgICAgICAvLyBUcmFuc2ZlciBvdXRjb21lIHRva2VucyB0byBidXllcgogICAgICAgIHJlcXVpcmUoZXZlbnRDb250cmFjdC5vdXRjb21lVG9rZW5zKG91dGNvbWVUb2tlbkluZGV4KS50cmFuc2Zlcihtc2cuc2VuZGVyLCBvdXRjb21lVG9rZW5Db3VudCkpOwogICAgICAgIC8vIEFkZCBvdXRjb21lIHRva2VuIGNvdW50IHRvIG1hcmtldCBtYWtlciBuZXQgYmFsYW5jZQogICAgICAgIHJlcXVpcmUoaW50KG91dGNvbWVUb2tlbkNvdW50KSA+PSAwKTsKICAgICAgICBuZXRPdXRjb21lVG9rZW5zU29sZFtvdXRjb21lVG9rZW5JbmRleF0gPSBuZXRPdXRjb21lVG9rZW5zU29sZFtvdXRjb21lVG9rZW5JbmRleF0uYWRkKGludChvdXRjb21lVG9rZW5Db3VudCkpOwogICAgICAgIE91dGNvbWVUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIG91dGNvbWVUb2tlbkluZGV4LCBvdXRjb21lVG9rZW5Db3VudCwgb3V0Y29tZVRva2VuQ29zdCwgZmVlcyk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHNlbGwgb3V0Y29tZSB0b2tlbnMgdG8gbWFya2V0IG1ha2VyCiAgICAvLy8gQHBhcmFtIG91dGNvbWVUb2tlbkluZGV4IEluZGV4IG9mIHRoZSBvdXRjb21lIHRva2VuIHRvIHNlbGwKICAgIC8vLyBAcGFyYW0gb3V0Y29tZVRva2VuQ291bnQgQW1vdW50IG9mIG91dGNvbWUgdG9rZW5zIHRvIHNlbGwKICAgIC8vLyBAcGFyYW0gbWluUHJvZml0IFRoZSBtaW5pbXVtIHByb2ZpdCBpbiBjb2xsYXRlcmFsIHRva2VucyB0byBlYXJuIGZvciBvdXRjb21lIHRva2VucwogICAgLy8vIEByZXR1cm4gUHJvZml0IGluIGNvbGxhdGVyYWwgdG9rZW5zCiAgICBmdW5jdGlvbiBzZWxsKHVpbnQ4IG91dGNvbWVUb2tlbkluZGV4LCB1aW50IG91dGNvbWVUb2tlbkNvdW50LCB1aW50IG1pblByb2ZpdCkKICAgICAgICBwdWJsaWMKICAgICAgICBhdFN0YWdlKFN0YWdlcy5NYXJrZXRGdW5kZWQpCiAgICAgICAgcmV0dXJucyAodWludCBwcm9maXQpCiAgICB7CiAgICAgICAgLy8gQ2FsY3VsYXRlIHByb2ZpdCBmb3Igc2VsbGluZyBvdXRjb21lIHRva2VucwogICAgICAgIHVpbnQgb3V0Y29tZVRva2VuUHJvZml0ID0gbWFya2V0TWFrZXIuY2FsY1Byb2ZpdCh0aGlzLCBvdXRjb21lVG9rZW5JbmRleCwgb3V0Y29tZVRva2VuQ291bnQpOwogICAgICAgIC8vIENhbGN1bGF0ZSBmZWUgY2hhcmdlZCBieSBtYXJrZXQKICAgICAgICB1aW50IGZlZXMgPSBjYWxjTWFya2V0RmVlKG91dGNvbWVUb2tlblByb2ZpdCk7CiAgICAgICAgcHJvZml0ID0gb3V0Y29tZVRva2VuUHJvZml0LnN1YihmZWVzKTsKICAgICAgICAvLyBDaGVjayBwcm9maXQgaXMgbm90IHRvbyBsb3cKICAgICAgICByZXF1aXJlKHByb2ZpdCA+IDAgJiYgcHJvZml0ID49IG1pblByb2ZpdCk7CiAgICAgICAgLy8gVHJhbnNmZXIgb3V0Y29tZSB0b2tlbnMgdG8gbWFya2V0cyBjb250cmFjdCB0byBzZWxsIGFsbCBvdXRjb21lcwogICAgICAgIHJlcXVpcmUoZXZlbnRDb250cmFjdC5vdXRjb21lVG9rZW5zKG91dGNvbWVUb2tlbkluZGV4KS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgb3V0Y29tZVRva2VuQ291bnQpKTsKICAgICAgICAvLyBTZWxsIGFsbCBvdXRjb21lcwogICAgICAgIGV2ZW50Q29udHJhY3Quc2VsbEFsbE91dGNvbWVzKG91dGNvbWVUb2tlblByb2ZpdCk7CiAgICAgICAgLy8gVHJhbnNmZXIgcHJvZml0IHRvIHNlbGxlcgogICAgICAgIHJlcXVpcmUoZXZlbnRDb250cmFjdC5jb2xsYXRlcmFsVG9rZW4oKS50cmFuc2Zlcihtc2cuc2VuZGVyLCBwcm9maXQpKTsKICAgICAgICAvLyBTdWJ0cmFjdCBvdXRjb21lIHRva2VuIGNvdW50IGZyb20gbWFya2V0IG1ha2VyIG5ldCBiYWxhbmNlCiAgICAgICAgcmVxdWlyZShpbnQob3V0Y29tZVRva2VuQ291bnQpID49IDApOwogICAgICAgIG5ldE91dGNvbWVUb2tlbnNTb2xkW291dGNvbWVUb2tlbkluZGV4XSA9IG5ldE91dGNvbWVUb2tlbnNTb2xkW291dGNvbWVUb2tlbkluZGV4XS5zdWIoaW50KG91dGNvbWVUb2tlbkNvdW50KSk7CiAgICAgICAgT3V0Y29tZVRva2VuU2FsZShtc2cuc2VuZGVyLCBvdXRjb21lVG9rZW5JbmRleCwgb3V0Y29tZVRva2VuQ291bnQsIG91dGNvbWVUb2tlblByb2ZpdCwgZmVlcyk7CiAgICB9CgogICAgLy8vIEBkZXYgQnV5cyBhbGwgb3V0Y29tZXMsIHRoZW4gc2VsbHMgYWxsIHNoYXJlcyBvZiBzZWxlY3RlZCBvdXRjb21lIHdoaWNoIHdlcmUgYm91Z2h0LCBrZWVwaW5nCiAgICAvLy8gICAgICBzaGFyZXMgb2YgYWxsIG90aGVyIG91dGNvbWUgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBvdXRjb21lVG9rZW5JbmRleCBJbmRleCBvZiB0aGUgb3V0Y29tZSB0b2tlbiB0byBzaG9ydCBzZWxsCiAgICAvLy8gQHBhcmFtIG91dGNvbWVUb2tlbkNvdW50IEFtb3VudCBvZiBvdXRjb21lIHRva2VucyB0byBzaG9ydCBzZWxsCiAgICAvLy8gQHBhcmFtIG1pblByb2ZpdCBUaGUgbWluaW11bSBwcm9maXQgaW4gY29sbGF0ZXJhbCB0b2tlbnMgdG8gZWFybiBmb3Igc2hvcnQgc29sZCBvdXRjb21lIHRva2VucwogICAgLy8vIEByZXR1cm4gQ29zdCB0byBzaG9ydCBzZWxsIG91dGNvbWUgaW4gY29sbGF0ZXJhbCB0b2tlbnMKICAgIGZ1bmN0aW9uIHNob3J0U2VsbCh1aW50OCBvdXRjb21lVG9rZW5JbmRleCwgdWludCBvdXRjb21lVG9rZW5Db3VudCwgdWludCBtaW5Qcm9maXQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCBjb3N0KQogICAgewogICAgICAgIC8vIEJ1eSBhbGwgb3V0Y29tZXMKICAgICAgICByZXF1aXJlKCAgIGV2ZW50Q29udHJhY3QuY29sbGF0ZXJhbFRva2VuKCkudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIG91dGNvbWVUb2tlbkNvdW50KQogICAgICAgICAgICAgICAgJiYgZXZlbnRDb250cmFjdC5jb2xsYXRlcmFsVG9rZW4oKS5hcHByb3ZlKGV2ZW50Q29udHJhY3QsIG91dGNvbWVUb2tlbkNvdW50KSk7CiAgICAgICAgZXZlbnRDb250cmFjdC5idXlBbGxPdXRjb21lcyhvdXRjb21lVG9rZW5Db3VudCk7CiAgICAgICAgLy8gU2hvcnQgc2VsbCBzZWxlY3RlZCBvdXRjb21lCiAgICAgICAgZXZlbnRDb250cmFjdC5vdXRjb21lVG9rZW5zKG91dGNvbWVUb2tlbkluZGV4KS5hcHByb3ZlKHRoaXMsIG91dGNvbWVUb2tlbkNvdW50KTsKICAgICAgICB1aW50IHByb2ZpdCA9IHRoaXMuc2VsbChvdXRjb21lVG9rZW5JbmRleCwgb3V0Y29tZVRva2VuQ291bnQsIG1pblByb2ZpdCk7CiAgICAgICAgY29zdCA9IG91dGNvbWVUb2tlbkNvdW50IC0gcHJvZml0OwogICAgICAgIC8vIFRyYW5zZmVyIG91dGNvbWUgdG9rZW5zIHRvIGJ1eWVyCiAgICAgICAgdWludDggb3V0Y29tZUNvdW50ID0gZXZlbnRDb250cmFjdC5nZXRPdXRjb21lQ291bnQoKTsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgb3V0Y29tZUNvdW50OyBpKyspCiAgICAgICAgICAgIGlmIChpICE9IG91dGNvbWVUb2tlbkluZGV4KQogICAgICAgICAgICAgICAgcmVxdWlyZShldmVudENvbnRyYWN0Lm91dGNvbWVUb2tlbnMoaSkudHJhbnNmZXIobXNnLnNlbmRlciwgb3V0Y29tZVRva2VuQ291bnQpKTsKICAgICAgICAvLyBTZW5kIGNoYW5nZSBiYWNrIHRvIGJ1eWVyCiAgICAgICAgcmVxdWlyZShldmVudENvbnRyYWN0LmNvbGxhdGVyYWxUb2tlbigpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHByb2ZpdCkpOwogICAgICAgIE91dGNvbWVUb2tlblNob3J0U2FsZShtc2cuc2VuZGVyLCBvdXRjb21lVG9rZW5JbmRleCwgb3V0Y29tZVRva2VuQ291bnQsIGNvc3QpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgZmVlIHRvIGJlIHBhaWQgdG8gbWFya2V0IG1ha2VyCiAgICAvLy8gQHBhcmFtIG91dGNvbWVUb2tlbkNvc3QgQ29zdCBmb3IgYnV5aW5nIG91dGNvbWUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBGZWUgZm9yIHRyYWRlCiAgICBmdW5jdGlvbiBjYWxjTWFya2V0RmVlKHVpbnQgb3V0Y29tZVRva2VuQ29zdCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIG91dGNvbWVUb2tlbkNvc3QgKiBmZWUgLyBGRUVfUkFOR0U7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBNYXJrZXQgZmFjdG9yeSBjb250cmFjdCAtIEFsbG93cyB0byBjcmVhdGUgbWFya2V0IGNvbnRyYWN0cwovLy8gQGF1dGhvciBTdGVmYW4gR2VvcmdlIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTgyYjJjM2QzZTM5MzYxODNmMzYzNzJiMzEyYjc2MjgzNSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CmNvbnRyYWN0IFN0YW5kYXJkTWFya2V0RmFjdG9yeSB7CgogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgU3RhbmRhcmRNYXJrZXRDcmVhdGlvbihhZGRyZXNzIGluZGV4ZWQgY3JlYXRvciwgTWFya2V0IG1hcmtldCwgRXZlbnQgZXZlbnRDb250cmFjdCwgTWFya2V0TWFrZXIgbWFya2V0TWFrZXIsIHVpbnQyNCBmZWUpOwoKICAgIC8qCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgbmV3IG1hcmtldCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBldmVudENvbnRyYWN0IEV2ZW50IGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIG1hcmtldE1ha2VyIE1hcmtldCBtYWtlciBjb250cmFjdAogICAgLy8vIEBwYXJhbSBmZWUgTWFya2V0IGZlZQogICAgLy8vIEByZXR1cm4gTWFya2V0IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVNYXJrZXQoRXZlbnQgZXZlbnRDb250cmFjdCwgTWFya2V0TWFrZXIgbWFya2V0TWFrZXIsIHVpbnQyNCBmZWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoU3RhbmRhcmRNYXJrZXQgbWFya2V0KQogICAgewogICAgICAgIG1hcmtldCA9IG5ldyBTdGFuZGFyZE1hcmtldChtc2cuc2VuZGVyLCBldmVudENvbnRyYWN0LCBtYXJrZXRNYWtlciwgZmVlKTsKICAgICAgICBTdGFuZGFyZE1hcmtldENyZWF0aW9uKG1zZy5zZW5kZXIsIG1hcmtldCwgZXZlbnRDb250cmFjdCwgbWFya2V0TWFrZXIsIGZlZSk7CiAgICB9Cn0='.
	

]
