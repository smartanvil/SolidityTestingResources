Class {
	#name : #SRTcf523594cdd747a464991c360142dabcaa90ddee,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcf523594cdd747a464991c360142dabcaa90ddee >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7Cgpjb250cmFjdCBFUkMyMCB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBhZGQodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKiB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHogPSB4IC8geTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIG1heCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQp9CgoKLyoKICAgIFdlIGRlbGV0ZWQgdW51c2VkIHBhcnQuCiAgICBUbyBzZWUgZnVsbCBzb3VyY2UgY29kZSwgcmVmZXIgYmVsb3cgOiAKICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9waXBlcm1lcnJpYW0vZXRoZXJldW0tZGF0ZXRpbWUKCiAgICBUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCiAgICBDb3B5cmlnaHQgKGMpIDIwMTUgUGlwZXIgTWVycmlhbQoKICAgIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICAgIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAgICBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAgICB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAgICBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICAgIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgogICAgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsCiAgICBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAgICBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICAgIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogICAgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogICAgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICAgIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFCiAgICBTT0ZUV0FSRS4KKi8KY29udHJhY3QgRGF0ZVRpbWUgewogICAgICAgIC8qCiAgICAgICAgICogIERhdGUgYW5kIFRpbWUgdXRpbGl0aWVzIGZvciBldGhlcmV1bSBjb250cmFjdHMKICAgICAgICAgKgogICAgICAgICAqLwogICAgICAgIHN0cnVjdCBEYXRlVGltZSB7CiAgICAgICAgICAgICAgICB1aW50MTYgeWVhcjsKICAgICAgICAgICAgICAgIHVpbnQ4IG1vbnRoOwogICAgICAgICAgICAgICAgdWludDggZGF5OwogICAgICAgICAgICAgICAgdWludDggaG91cjsKICAgICAgICAgICAgICAgIHVpbnQ4IG1pbnV0ZTsKICAgICAgICAgICAgICAgIHVpbnQ4IHNlY29uZDsKICAgICAgICAgICAgICAgIHVpbnQ4IHdlZWtkYXk7CiAgICAgICAgfQoKICAgICAgICB1aW50IGNvbnN0YW50IERBWV9JTl9TRUNPTkRTID0gODY0MDA7CiAgICAgICAgdWludCBjb25zdGFudCBZRUFSX0lOX1NFQ09ORFMgPSAzMTUzNjAwMDsKICAgICAgICB1aW50IGNvbnN0YW50IExFQVBfWUVBUl9JTl9TRUNPTkRTID0gMzE2MjI0MDA7CgogICAgICAgIHVpbnQgY29uc3RhbnQgSE9VUl9JTl9TRUNPTkRTID0gMzYwMDsKICAgICAgICB1aW50IGNvbnN0YW50IE1JTlVURV9JTl9TRUNPTkRTID0gNjA7CgogICAgICAgIHVpbnQxNiBjb25zdGFudCBPUklHSU5fWUVBUiA9IDE5NzA7CgogICAgICAgIGZ1bmN0aW9uIGlzTGVhcFllYXIodWludDE2IHllYXIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAgICAgIGlmICh5ZWFyICUgNCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh5ZWFyICUgMTAwICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoeWVhciAlIDQwMCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbGVhcFllYXJzQmVmb3JlKHVpbnQgeWVhcikgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgICAgICAgeWVhciAtPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIHllYXIgLyA0IC0geWVhciAvIDEwMCArIHllYXIgLyA0MDA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXREYXlzSW5Nb250aCh1aW50OCBtb250aCwgdWludDE2IHllYXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICBpZiAobW9udGggPT0gMSB8fCBtb250aCA9PSAzIHx8IG1vbnRoID09IDUgfHwgbW9udGggPT0gNyB8fCBtb250aCA9PSA4IHx8IG1vbnRoID09IDEwIHx8IG1vbnRoID09IDEyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1vbnRoID09IDQgfHwgbW9udGggPT0gNiB8fCBtb250aCA9PSA5IHx8IG1vbnRoID09IDExKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzTGVhcFllYXIoeWVhcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyODsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBhcnNlVGltZXN0YW1wKHVpbnQgdGltZXN0YW1wKSBpbnRlcm5hbCByZXR1cm5zIChEYXRlVGltZSBkdCkgewogICAgICAgICAgICAgICAgdWludCBzZWNvbmRzQWNjb3VudGVkRm9yID0gMDsKICAgICAgICAgICAgICAgIHVpbnQgYnVmOwogICAgICAgICAgICAgICAgdWludDggaTsKCiAgICAgICAgICAgICAgICAvLyBZZWFyCiAgICAgICAgICAgICAgICBkdC55ZWFyID0gZ2V0WWVhcih0aW1lc3RhbXApOwogICAgICAgICAgICAgICAgYnVmID0gbGVhcFllYXJzQmVmb3JlKGR0LnllYXIpIC0gbGVhcFllYXJzQmVmb3JlKE9SSUdJTl9ZRUFSKTsKCiAgICAgICAgICAgICAgICBzZWNvbmRzQWNjb3VudGVkRm9yICs9IExFQVBfWUVBUl9JTl9TRUNPTkRTICogYnVmOwogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBZRUFSX0lOX1NFQ09ORFMgKiAoZHQueWVhciAtIE9SSUdJTl9ZRUFSIC0gYnVmKTsKCiAgICAgICAgICAgICAgICAvLyBNb250aAogICAgICAgICAgICAgICAgdWludCBzZWNvbmRzSW5Nb250aDsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gMTI7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzSW5Nb250aCA9IERBWV9JTl9TRUNPTkRTICogZ2V0RGF5c0luTW9udGgoaSwgZHQueWVhcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRzSW5Nb250aCArIHNlY29uZHNBY2NvdW50ZWRGb3IgPiB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdC5tb250aCA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBzZWNvbmRzSW5Nb250aDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBEYXkKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gZ2V0RGF5c0luTW9udGgoZHQubW9udGgsIGR0LnllYXIpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKERBWV9JTl9TRUNPTkRTICsgc2Vjb25kc0FjY291bnRlZEZvciA+IHRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0LmRheSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBEQVlfSU5fU0VDT05EUzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBIb3VyCiAgICAgICAgICAgICAgICBkdC5ob3VyID0gZ2V0SG91cih0aW1lc3RhbXApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0WWVhcih1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgICAgICAgICB1aW50IHNlY29uZHNBY2NvdW50ZWRGb3IgPSAwOwogICAgICAgICAgICAgICAgdWludDE2IHllYXI7CiAgICAgICAgICAgICAgICB1aW50IG51bUxlYXBZZWFyczsKCiAgICAgICAgICAgICAgICAvLyBZZWFyCiAgICAgICAgICAgICAgICB5ZWFyID0gdWludDE2KE9SSUdJTl9ZRUFSICsgdGltZXN0YW1wIC8gWUVBUl9JTl9TRUNPTkRTKTsKICAgICAgICAgICAgICAgIG51bUxlYXBZZWFycyA9IGxlYXBZZWFyc0JlZm9yZSh5ZWFyKSAtIGxlYXBZZWFyc0JlZm9yZShPUklHSU5fWUVBUik7CgogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBMRUFQX1lFQVJfSU5fU0VDT05EUyAqIG51bUxlYXBZZWFyczsKICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gWUVBUl9JTl9TRUNPTkRTICogKHllYXIgLSBPUklHSU5fWUVBUiAtIG51bUxlYXBZZWFycyk7CgogICAgICAgICAgICAgICAgd2hpbGUgKHNlY29uZHNBY2NvdW50ZWRGb3IgPiB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGVhcFllYXIodWludDE2KHllYXIgLSAxKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzQWNjb3VudGVkRm9yIC09IExFQVBfWUVBUl9JTl9TRUNPTkRTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgLT0gWUVBUl9JTl9TRUNPTkRTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgLT0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB5ZWFyOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0TW9udGgodWludCB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VUaW1lc3RhbXAodGltZXN0YW1wKS5tb250aDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldERheSh1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVRpbWVzdGFtcCh0aW1lc3RhbXApLmRheTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEhvdXIodWludCB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdWludDgoKHRpbWVzdGFtcCAvIDYwIC8gNjApICUgMjQpOwogICAgICAgIH0KfQoKY29udHJhY3QgSVRHVG9rZW5CYXNlIGlzIEVSQzIwLCBTYWZlTWF0aCB7CgogIC8qIEFjdHVhbCBiYWxhbmNlcyBvZiB0b2tlbiBob2xkZXJzICovCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwoKICAvKiBhcHByb3ZlKCkgYWxsb3dhbmNlcyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9Cgpjb250cmFjdCBBdXRoYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIGV4ZWN1dG9yOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgCiAgICBtb2RpZmllciBvbmx5QXV0aCgpewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IGV4ZWN1dG9yKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE93bmVyKGFkZHJlc3MgX293bmVyKXsKICAgICAgICByZXF1aXJlKG93bmVyID09IDB4MCB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRFeGVjdXRvcihhZGRyZXNzIGV4ZWMpIHsKICAgICAgICByZXF1aXJlKGV4ZWN1dG9yID09IDB4MCB8fCBvd25lciA9PSBtc2cuc2VuZGVyIHx8IGV4ZWN1dG9yID09IG1zZy5zZW5kZXIpOwogICAgICAgIGV4ZWN1dG9yID0gZXhlYzsKICAgIH0KfQoKY29udHJhY3QgQ3Jvd2RTYWxlIGlzIFNhZmVNYXRoLCBBdXRoYWJsZSB7CgogICAgc3RydWN0IFNhbGVBdHRyewogICAgICAgIHVpbnQgYW1vdW50UmFpc2VkVG90YWw7ICAvLyBUb3RhbCBmdW5kaW5nCgogICAgICAgIHVpbnQgc2FsZVN1cHBseVByZTsgLy8gU3VwcGx5IGZvciBQcmUgY3Jvd2RTYWxlCiAgICAgICAgdWludCBzYWxlU3VwcGx5MTsgLy8gU3VwcGx5IGZvciAxc3QgY3Jvd2RTYWxlCiAgICAgICAgdWludCBzYWxlU3VwcGx5MjsgLy8gU3VwcGx5IGZvciAybmQgY3Jvd2RTYWxlCiAgICAgICAgdWludCBzYWxlU3VwcGx5MzsgLy8gU3VwcGx5IGZvciAzcmQgY3Jvd2RTYWxlCiAgICAgICAgdWludCBzYWxlU3VwcGx5NDsgLy8gU3VwcGx5IGZvciA0dGggY3Jvd2RTYWxlCiAgICAgICAgCiAgICAgICAgdWludCBhbW91bnRSYWlzZWRQcmU7ICAgLy8gT25seSBjb3VudCBQcmUgY3Jvd2RTYWxlIGZ1bmRpbmcgZm9yIGRpc3RyaWJ1dGUKICAgICAgICB1aW50IGFtb3VudFJhaXNlZDE7ICAgICAvLyBPbmx5IGNvdW50IDFzdCBjcm93ZFNhbGUgZnVuZGluZyBmb3IgZGlzdHJpYnV0ZQogICAgICAgIHVpbnQgYW1vdW50UmFpc2VkMjsgICAgIC8vIE9ubHkgY291bnQgMm5kIGNyb3dkU2FsZSBmdW5kaW5nIGZvciBqdXN0IHJlY29yZAogICAgICAgIHVpbnQgYW1vdW50UmFpc2VkMzsgICAgIC8vIE9ubHkgY291bnQgM3JkIGNyb3dkU2FsZSBmdW5kaW5nIGZvciBkaXN0cmlidXRlCiAgICAgICAgdWludCBhbW91bnRSYWlzZWQ0OyAgICAgLy8gT25seSBjb3VudCA0dGggY3Jvd2RTYWxlIGZ1bmRpbmcgZm9yIGp1c3QgcmVjb3JkCgogICAgICAgIHVpbnQgc29sZFN1cHBseTI7CiAgICAgICAgdWludCBzb2xkU3VwcGx5NDsKICAgIH0KICAgIFNhbGVBdHRyIHB1YmxpYyBzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwYXJ0aWNpcGFudHNGb3JQcmVTYWxlOyAgICAvLyBQcmUgY3Jvd2RTYWxlIHBhcnRpY2lwYW50cwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwYXJ0aWNpcGFudHNGb3Ixc3RTYWxlOyAgICAvLyAxc3QgY3Jvd2RTYWxlIHBhcnRpY2lwYW50cwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwYXJ0aWNpcGFudHNGb3IzcmRTYWxlOyAgICAvLyAzcmQgY3Jvd2RTYWxlIHBhcnRpY2lwYW50cwoKICAgIGV2ZW50IExvZ0N1c3RvbVNhbGUodWludCBzdGFydFRpbWUsIHVpbnQgZW5kVGltZSwgdWludCB0b2tQZXJFdGgsIHVpbnQgc3VwcGx5KTsKCiAgICBzdHJ1Y3QgU2FsZVRpbWVBdHRyewogICAgICAgIHVpbnQgcHN0YXJ0OwogICAgICAgIHVpbnQgcGRlYWRsaW5lOwoKICAgICAgICAvLyAxc3QsIDNyZCBzYWxlIGlzIHRpbWUgYmFzZWQgc2hhcmUKICAgICAgICAvLyAybmQsIDR0aCBzYWxlIGlzIHByaWNlIHNhbGUKICAgICAgICB1aW50IHN0YXJ0OyAgICAgICAgIC8vIFdoZW4gMXN0IGNyb3dkU2FsZSBzdGFydHMKICAgICAgICB1aW50IGRlYWRsaW5lMTsgICAgIC8vIFdoZW4gMXN0IGNyb3dkU2FsZSBlbmRzIGFuZCAybmQgY3Jvd2RTYWxlIHN0YXJ0cwogICAgICAgIHVpbnQgZGVhZGxpbmUyOyAgICAgLy8gV2hlbiAybmQgY3Jvd2RTYWxlIGVuZHMKICAgICAgICB1aW50IGRlYWRsaW5lMzsgICAgIC8vIFdoZW4gM3JkIGNyb3dkU2FsZSBlbmRzCiAgICAgICAgdWludCBkZWFkbGluZTQ7ICAgICAvLyBXaGVuIDR0aCBjcm93ZFNhbGUgZW5kcwogICAgfQogICAgU2FsZVRpbWVBdHRyIHB1YmxpYyB0OwoKICAgIHN0cnVjdCBDdXN0b21TYWxlQXR0cnsKICAgICAgICB1aW50IHN0YXJ0OwogICAgICAgIHVpbnQgZW5kOwogICAgICAgIHVpbnQgdG9rZW5QZXJFdGg7ICAgLy8gMCBtZWFucyBwZXJpb2Qgc2FsZQogICAgICAgIHVpbnQgc2FsZVN1cHBseTsKICAgICAgICB1aW50IHNvbGRTdXBwbHk7CiAgICAgICAgdWludCBhbW91bnRSYWlzZWQ7CiAgICB9CiAgICBDdXN0b21TYWxlQXR0ciBwdWJsaWMgY3M7CiAgICBtYXBwaW5nKHVpbnQgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgcGFydGljaXBhbnRzRm9yQ3VzdG9tU2FsZTsKCiAgICBmdW5jdGlvbiBzZXRBdHRycyh1aW50IHN1cHBseVByZSwgdWludCBzdXBwbHkxLCB1aW50IHN1cHBseTIsIHVpbnQgc3VwcGx5MywgdWludCBzdXBwbHk0CiAgICAgICAgICAgICwgdWludCBwcmVTdGFydCwgdWludCBwcmVFbmQsIHVpbnQgc3RhcnQsIHVpbnQgZW5kMSwgdWludCBlbmQyLCB1aW50IGVuZDMsIHVpbnQgZW5kNAogICAgICAgICkgb25seUF1dGggewogICAgICAgIHMuc2FsZVN1cHBseVByZSA9IHN1cHBseVByZTsgLy8gdG90YWxTdXBwbHkgKiAxMCAvIDEwMAogICAgICAgIC8vc3RhcnQsIGRlYWRsaW5lMX40IHNob3VsZCBiZSBzZXQgYmVmb3JlIHN0YXJ0CiAgICAgICAgcy5zYWxlU3VwcGx5MSA9IHN1cHBseTE7ICAgIC8vdG90YWxTdXBwbHkgKiAxMCAvIDEwMDsgICAgIC8vIDEwJSBvZiB0b3RhbFN1cHBseS4gVG90YWwgNDAlIHRvIENyb3dkU2FsZSwgNSUgdG8gZGV2IHRlYW0sIDU1JSB3aWxsIGJlIHVzZWQgZm9yIGdhbWUgYW5kIHZvdGUKICAgICAgICBzLnNhbGVTdXBwbHkyID0gc3VwcGx5MjsgICAgLy90b3RhbFN1cHBseSAqICA1IC8gMTAwOwogICAgICAgIHMuc2FsZVN1cHBseTMgPSBzdXBwbHkzOyAgICAvL3RvdGFsU3VwcGx5ICogMTAgLyAxMDA7CiAgICAgICAgcy5zYWxlU3VwcGx5NCA9IHN1cHBseTQ7ICAgIC8vdG90YWxTdXBwbHkgKiAgNSAvIDEwMDsKCiAgICAgICAgdC5wc3RhcnQgPSBwcmVTdGFydDsKICAgICAgICB0LnBkZWFkbGluZSA9IHByZUVuZDsKICAgICAgICB0LnN0YXJ0ID0gc3RhcnQ7CiAgICAgICAgdC5kZWFkbGluZTEgPSBlbmQxOwogICAgICAgIHQuZGVhZGxpbmUyID0gZW5kMjsKICAgICAgICB0LmRlYWRsaW5lMyA9IGVuZDM7CiAgICAgICAgdC5kZWFkbGluZTQgPSBlbmQ0OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEF0dHJDdXN0b20odWludCBzdGFydFRpbWUsIHVpbnQgZW5kVGltZSwgdWludCB0b2tQZXJFdGgsIHVpbnQgc3VwcGx5KSBvbmx5QXV0aCB7CiAgICAgICAgY3Muc3RhcnQgPSBzdGFydFRpbWU7CiAgICAgICAgY3MuZW5kID0gZW5kVGltZTsKICAgICAgICBjcy50b2tlblBlckV0aCA9IHRva1BlckV0aDsKICAgICAgICBjcy5zYWxlU3VwcGx5ID0gc3VwcGx5OwogICAgICAgIGNzLnNvbGRTdXBwbHkgPSAwOwogICAgICAgIGNzLmFtb3VudFJhaXNlZCA9IDA7CiAgICAgICAgTG9nQ3VzdG9tU2FsZShzdGFydFRpbWUsIGVuZFRpbWUsIHRva1BlckV0aCwgc3VwcGx5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9jZXNzKGFkZHJlc3Mgc2VuZGVyLCB1aW50IHNlbmRWYWx1ZSkgb25seU93bmVyIHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpIHsKICAgICAgICBpZihub3cgPiB0LnBzdGFydCAmJiBub3cgPD0gdC5wZGVhZGxpbmUpewogICAgICAgICAgICBwYXJ0aWNpcGFudHNGb3JQcmVTYWxlW3NlbmRlcl0gPSBhZGQocGFydGljaXBhbnRzRm9yUHJlU2FsZVtzZW5kZXJdLHNlbmRWYWx1ZSk7CiAgICAgICAgICAgIHMuYW1vdW50UmFpc2VkUHJlID0gYWRkKHMuYW1vdW50UmFpc2VkUHJlLCBzZW5kVmFsdWUpOwogICAgICAgIH1lbHNlIGlmKG5vdyA+IHQuc3RhcnQgJiYgbm93IDw9IHQuZGVhZGxpbmUxKXsKICAgICAgICAgICAgcGFydGljaXBhbnRzRm9yMXN0U2FsZVtzZW5kZXJdID0gYWRkKHBhcnRpY2lwYW50c0ZvcjFzdFNhbGVbc2VuZGVyXSxzZW5kVmFsdWUpOwogICAgICAgICAgICBzLmFtb3VudFJhaXNlZDEgPSBhZGQocy5hbW91bnRSYWlzZWQxLCBzZW5kVmFsdWUpOwogICAgICAgIH1lbHNlIGlmKG5vdyA+IHQuZGVhZGxpbmUxICYmIG5vdyA8PSB0LmRlYWRsaW5lMiAmJiBzLnNvbGRTdXBwbHkyIDwgcy5zYWxlU3VwcGx5Mil7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gc2VuZFZhbHVlIC8gKHMuYW1vdW50UmFpc2VkMSAvIHMuc2FsZVN1cHBseTEgKiAxMjAgLyAxMDApOyAgICAvL1Rva2VuIFByaWNlID0gcy5hbW91bnRSYWlzZWQxIC8gcy5zYWxlU3VwcGx5MS4gUHJpY2UgaXMgZ29pbmcgdXAgMjAlCiAgICAgICAgICAgIHMuc29sZFN1cHBseTIgPSBhZGQocy5zb2xkU3VwcGx5MiwgdG9rZW5BbW91bnQpOwogICAgICAgICAgICBzLmFtb3VudFJhaXNlZDIgPSBhZGQocy5hbW91bnRSYWlzZWQyLCBzZW5kVmFsdWUpOwoKICAgICAgICAgICAgcmVxdWlyZShzLnNvbGRTdXBwbHkyIDwgcy5zYWxlU3VwcGx5MiAqIDEwNSAvIDEwMCk7ICAgLy8gQSBsaXR0bGUgYml0IG1vcmUgc2FsZSBpcyBncmFudGVkIGZvciB0aGUgcHJpY2Ugc2FsZS4KICAgICAgICB9ZWxzZSBpZihub3cgPiB0LmRlYWRsaW5lMiAmJiBub3cgPD0gdC5kZWFkbGluZTMpewogICAgICAgICAgICBwYXJ0aWNpcGFudHNGb3IzcmRTYWxlW3NlbmRlcl0gPSBhZGQocGFydGljaXBhbnRzRm9yM3JkU2FsZVtzZW5kZXJdLHNlbmRWYWx1ZSk7CiAgICAgICAgICAgIHMuYW1vdW50UmFpc2VkMyA9IGFkZChzLmFtb3VudFJhaXNlZDMsIHNlbmRWYWx1ZSk7CiAgICAgICAgfWVsc2UgaWYobm93ID4gdC5kZWFkbGluZTMgJiYgbm93IDw9IHQuZGVhZGxpbmU0ICYmIHMuc29sZFN1cHBseTQgPCBzLnNhbGVTdXBwbHk0KXsKICAgICAgICAgICAgdG9rZW5BbW91bnQgPSBzZW5kVmFsdWUgLyAocy5hbW91bnRSYWlzZWQzIC8gcy5zYWxlU3VwcGx5MyAqIDEyMCAvIDEwMCk7ICAgICAvL1Rva2VuIFByaWNlID0gcy5hbW91bnRSYWlzZWQzIC8gcy5zYWxlU3VwcGx5My4gUHJpY2UgaXMgZ29pbmcgdXAgMjAlCiAgICAgICAgICAgIHMuc29sZFN1cHBseTQgPSBhZGQocy5zb2xkU3VwcGx5NCwgdG9rZW5BbW91bnQpOwogICAgICAgICAgICBzLmFtb3VudFJhaXNlZDQgPSBhZGQocy5hbW91bnRSYWlzZWQ0LCBzZW5kVmFsdWUpOwoKICAgICAgICAgICAgcmVxdWlyZShzLnNvbGRTdXBwbHk0IDwgcy5zYWxlU3VwcGx5NCAqIDEwNSAvIDEwMCk7ICAgLy8gQSBsaXR0bGUgYml0IG1vcmUgc2FsZSBpcyBncmFudGVkIGZvciB0aGUgcHJpY2Ugc2FsZS4KICAgICAgICB9ZWxzZSBpZihub3cgPiBjcy5zdGFydCAmJiBub3cgPD0gY3MuZW5kICYmIGNzLnNvbGRTdXBwbHkgPCBjcy5zYWxlU3VwcGx5KXsKICAgICAgICAgICAgaWYoY3MudG9rZW5QZXJFdGggPiAwKXsKICAgICAgICAgICAgICAgIHRva2VuQW1vdW50ID0gc2VuZFZhbHVlICogY3MudG9rZW5QZXJFdGg7CiAgICAgICAgICAgICAgICBjcy5zb2xkU3VwcGx5ID0gYWRkKGNzLnNvbGRTdXBwbHksIHRva2VuQW1vdW50KTsKCiAgICAgICAgICAgICAgICByZXF1aXJlKGNzLnNvbGRTdXBwbHkgPCBjcy5zYWxlU3VwcGx5ICogMTA1IC8gMTAwKTsgLy8gQSBsaXR0bGUgYml0IG1vcmUgc2FsZSBpcyBncmFudGVkIGZvciB0aGUgcHJpY2Ugc2FsZS4KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBwYXJ0aWNpcGFudHNGb3JDdXN0b21TYWxlW2NzLnN0YXJ0XVtzZW5kZXJdID0gYWRkKHBhcnRpY2lwYW50c0ZvckN1c3RvbVNhbGVbY3Muc3RhcnRdW3NlbmRlcl0sc2VuZFZhbHVlKTsKICAgICAgICAgICAgICAgIGNzLmFtb3VudFJhaXNlZCA9IGFkZChjcy5hbW91bnRSYWlzZWQsIHNlbmRWYWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIHMuYW1vdW50UmFpc2VkVG90YWwgPSBhZGQocy5hbW91bnRSYWlzZWRUb3RhbCwgc2VuZFZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbihhZGRyZXNzIHNlbmRlcikgb25seU93bmVyIHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpewogICAgICAgIGlmKG5vdyA+IHQucGRlYWRsaW5lICYmIHBhcnRpY2lwYW50c0ZvclByZVNhbGVbc2VuZGVyXSAhPSAwKXsKICAgICAgICAgICAgdG9rZW5BbW91bnQgPSBhZGQodG9rZW5BbW91bnQscGFydGljaXBhbnRzRm9yUHJlU2FsZVtzZW5kZXJdICogcy5zYWxlU3VwcGx5UHJlIC8gcy5hbW91bnRSYWlzZWRQcmUpOyAgLy9Ub2tlbiBBbW91bnQgUGVyIEV0aCA9IHMuc2FsZVN1cHBseVByZSAvIHMuYW1vdW50UmFpc2VkUHJlCiAgICAgICAgICAgIHBhcnRpY2lwYW50c0ZvclByZVNhbGVbc2VuZGVyXSA9IDA7CiAgICAgICAgfQogICAgICAgIGlmKG5vdyA+IHQuZGVhZGxpbmUxICYmIHBhcnRpY2lwYW50c0ZvcjFzdFNhbGVbc2VuZGVyXSAhPSAwKXsKICAgICAgICAgICAgdG9rZW5BbW91bnQgPSBhZGQodG9rZW5BbW91bnQscGFydGljaXBhbnRzRm9yMXN0U2FsZVtzZW5kZXJdICogcy5zYWxlU3VwcGx5MSAvIHMuYW1vdW50UmFpc2VkMSk7ICAvL1Rva2VuIEFtb3VudCBQZXIgRXRoID0gcy5zYWxlU3VwcGx5MSAvIHMuYW1vdW50UmFpc2VkMQogICAgICAgICAgICBwYXJ0aWNpcGFudHNGb3Ixc3RTYWxlW3NlbmRlcl0gPSAwOwogICAgICAgIH0KICAgICAgICBpZihub3cgPiB0LmRlYWRsaW5lMyAmJiBwYXJ0aWNpcGFudHNGb3IzcmRTYWxlW3NlbmRlcl0gIT0gMCl7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gYWRkKHRva2VuQW1vdW50LHBhcnRpY2lwYW50c0ZvcjNyZFNhbGVbc2VuZGVyXSAqIHMuc2FsZVN1cHBseTMgLyBzLmFtb3VudFJhaXNlZDMpOyAgLy9Ub2tlbiBBbW91bnQgUGVyIEV0aCA9IHMuc2FsZVN1cHBseTMgLyBzLmFtb3VudFJhaXNlZDMKICAgICAgICAgICAgcGFydGljaXBhbnRzRm9yM3JkU2FsZVtzZW5kZXJdID0gMDsKICAgICAgICB9CiAgICAgICAgaWYobm93ID4gY3MuZW5kICYmIHBhcnRpY2lwYW50c0ZvckN1c3RvbVNhbGVbY3Muc3RhcnRdW3NlbmRlcl0gIT0gMCl7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gYWRkKHRva2VuQW1vdW50LHBhcnRpY2lwYW50c0ZvckN1c3RvbVNhbGVbY3Muc3RhcnRdW3NlbmRlcl0gKiBjcy5zYWxlU3VwcGx5IC8gY3MuYW1vdW50UmFpc2VkKTsgIC8vVG9rZW4gQW1vdW50IFBlciBFdGggPSBjcy5zYWxlU3VwcGx5IC8gY3MuYW1vdW50UmFpc2VkCiAgICAgICAgICAgIHBhcnRpY2lwYW50c0ZvckN1c3RvbVNhbGVbY3Muc3RhcnRdW3NlbmRlcl0gPSAwOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgVm90aW5nIGlzIFNhZmVNYXRoLCBBdXRoYWJsZSB7CiAgICBtYXBwaW5nKHVpbnQgPT4gdWludCkgcHVibGljIHZvdGVSZXdhcmRQZXJVbml0OyAvLyBJZiB0aGUgdm90ZXJzIHZvdGUsIHRoZXkgd2lsbCByZXdhcmRlZCB4JSBvZiB0b2tlbnMgYnkgdGhlaXIgYmFsYW5jZXMuIDEwMCBtZWFucyAxJSwgMTAwMCBtZWFucyAxMCUKICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBwdWJsaWMgdm90ZVdlaWdodFVuaXQ7ICAgIC8vIElmIDEwMCAqIDEgZXRoZXIsIGVhY2ggMTAwICogMSBldGhlciB0b2tlbiBvZiBob2xkZXIgd2lsbCBnZXQgdm90ZSB3ZWlnaHQgMS4gCiAgICBtYXBwaW5nKHVpbnQgPT4gdWludCkgcHVibGljIHZvdGVTdGFydDsKICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBwdWJsaWMgdm90ZUVuZDsKICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBwdWJsaWMgbWF4Q2FuZGlkYXRlSWQ7CgogICAgbWFwcGluZyh1aW50ID0+IG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIHZvdGVkOwogICAgbWFwcGluZyh1aW50ID0+IG1hcHBpbmcodWludCA9PiB1aW50KSkgcHVibGljIHJlc3VsdHM7CgogICAgZXZlbnQgTG9nVm90ZUluaXRpYXRlKHVpbnQgX3ZvdGVJZCwgdWludCBfdm90ZVJld2FyZFBlclVuaXQsIHVpbnQgX3ZvdGVXZWlnaHRVbml0LCB1aW50IF92b3RlU3RhcnQsIHVpbnQgX3ZvdGVFbmQsIHVpbnQgX21heENhbmRpZGF0ZUlkKTsKICAgIGV2ZW50IExvZ1ZvdGUoYWRkcmVzcyB2b3RlciwgdWludCB3ZWlnaHQsIHVpbnQgdm90ZUlkLCB1aW50IGNhbmRpZGF0ZUlkLCB1aW50IGNhbmRpZGF0ZVZhbHVlKTsKCiAgICBmdW5jdGlvbiB2b3RlSW5pdGlhdGUodWludCBfdm90ZUlkLCB1aW50IF92b3RlUmV3YXJkUGVyVW5pdCwgdWludCBfdm90ZVdlaWdodFVuaXQsIHVpbnQgX3ZvdGVTdGFydCwgdWludCBfdm90ZUVuZCwgdWludCBfbWF4Q2FuZGlkYXRlSWQpIG9ubHlPd25lciB7ICAgCiAgICAgICAgcmVxdWlyZSh2b3RlRW5kW192b3RlSWRdID09IDApOyAgLy8gRG8gbm90IGFsbG93IGR1cGxpY2F0ZSB2b3RlSWQKICAgICAgICByZXF1aXJlKF92b3RlRW5kICE9IDApOwoKICAgICAgICB2b3RlUmV3YXJkUGVyVW5pdFtfdm90ZUlkXSA9IF92b3RlUmV3YXJkUGVyVW5pdDsKICAgICAgICB2b3RlV2VpZ2h0VW5pdFtfdm90ZUlkXSA9IF92b3RlV2VpZ2h0VW5pdDsKICAgICAgICB2b3RlU3RhcnRbX3ZvdGVJZF0gPSBfdm90ZVN0YXJ0OwogICAgICAgIHZvdGVFbmRbX3ZvdGVJZF0gPSBfdm90ZUVuZDsKICAgICAgICBtYXhDYW5kaWRhdGVJZFtfdm90ZUlkXSA9IF9tYXhDYW5kaWRhdGVJZDsKCiAgICAgICAgTG9nVm90ZUluaXRpYXRlKF92b3RlSWQsIF92b3RlUmV3YXJkUGVyVW5pdCwgX3ZvdGVXZWlnaHRVbml0LCBfdm90ZVN0YXJ0LCBfdm90ZUVuZCwgX21heENhbmRpZGF0ZUlkKTsKICAgIH0KCiAgICAgZnVuY3Rpb24gdm90ZShhZGRyZXNzIHNlbmRlciwgdWludCBob2xkaW5nLCB1aW50IHZvdGVJZCwgdWludCBjYW5kaWRhdGVJZCkgb25seU93bmVyIHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgbG9ja1VudGlsKXsKICAgICAgICByZXF1aXJlKG5vdyA+IHZvdGVTdGFydFt2b3RlSWRdICYmIG5vdyA8PSB2b3RlRW5kW3ZvdGVJZF0pOwogICAgICAgIHJlcXVpcmUobWF4Q2FuZGlkYXRlSWRbdm90ZUlkXSA+PSBjYW5kaWRhdGVJZCk7CiAgICAgICAgcmVxdWlyZShob2xkaW5nID49IHZvdGVSZXdhcmRQZXJVbml0W3ZvdGVJZF0pOwogICAgICAgIHJlcXVpcmUoIXZvdGVkW3ZvdGVJZF1bc2VuZGVyXSk7CgogICAgICAgIHVpbnQgd2VpZ2h0ID0gaG9sZGluZyAvIHZvdGVXZWlnaHRVbml0W3ZvdGVJZF07CgogICAgICAgIHJlc3VsdHNbdm90ZUlkXVtjYW5kaWRhdGVJZF0gPSBhZGQocmVzdWx0c1t2b3RlSWRdW2NhbmRpZGF0ZUlkXSwgd2VpZ2h0KTsKICAgICAgICB2b3RlZFt2b3RlSWRdW3NlbmRlcl0gPSB0cnVlOwogICAgICAgIHRva2VuQW1vdW50ID0gd2VpZ2h0ICogdm90ZVdlaWdodFVuaXRbdm90ZUlkXSAqIHZvdGVSZXdhcmRQZXJVbml0W3ZvdGVJZF0gLyAxMDAgLyAxMDA7CiAgICAgICAgbG9ja1VudGlsID0gdm90ZUVuZFt2b3RlSWRdOwoKICAgICAgICBMb2dWb3RlKHNlbmRlciwgd2VpZ2h0LCB2b3RlSWQsIGNhbmRpZGF0ZUlkLCByZXN1bHRzW3ZvdGVJZF1bY2FuZGlkYXRlSWRdKTsKICAgIH0KfQoKY29udHJhY3QgR2FtZXMgaXMgU2FmZU1hdGgsIERhdGVUaW1lLCBBdXRoYWJsZSB7CiAgICBlbnVtIEdhbWVUaW1lIHsgSG91ciwgTW9udGgsIFllYXIsIE91dE9mVGltZSB9CiAgICBlbnVtIEdhbWVUeXBlIHsgUmFuZ2UsIFBvaW50fQoKICAgIHN0cnVjdCBQYXJ0aWNpcGFudCB7CiAgICAgICAgYWRkcmVzcyBzZW5kZXI7CiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICB1aW50IGN1cnJlbmN5OyAvLyAxIDogRXRoLCAyIDogVG9rCiAgICB9CgogICAgc3RydWN0IERhdGVBdHRyewogICAgICAgIHVpbnQgY3VycmVudFllYXI7CiAgICAgICAgdWludCBnYW1lU3RhcnQ7IC8vT25seSBmb3IgUmFuZ2UgR2FtZQogICAgICAgIHVpbnQgZ2FtZUVuZDsgICAvL0ZvciBib3RoIFJhbmdlIEdhbWUgYW5kIHBvaW50IEdhbWUoPWludGltZSB0aW1lc3RhbXApCiAgICAgICAgdWludCBwcmV2R2FtZUVuZDsgLy9Pbmx5IGZvciBQb2ludCBHYW1lCiAgICB9CiAgICBEYXRlQXR0ciBwdWJsaWMgZDsKCiAgICBzdHJ1Y3QgQ29tbW9uQXR0cnsKICAgICAgICBHYW1lVGltZSBjdXJyZW50R2FtZVRpbWVUeXBlOyAgICAgIC8vIEN1cnJlbnQgR2FtZSB0aW1lIHR5cGUKICAgICAgICBHYW1lVHlwZSBnYW1lVHlwZTsKCiAgICAgICAgdWludCBob3VybHlBbW91bnRFdGg7ICAvLyBGdW5kZWQgRXRoIGFtb3VudAogICAgICAgIHVpbnQgbW9udGhseUFtb3VudEV0aDsKICAgICAgICB1aW50IHllYXJseUFtb3VudEV0aDsKICAgICAgICB1aW50IGNoYXJpdHlBbW91bnRFdGg7CgogICAgfQogICAgQ29tbW9uQXR0ciBwdWJsaWMgYzsKCiAgICBzdHJ1Y3QgRnVuZEFtb3VudFN0YXR1c0F0dHJ7CiAgICAgICAgdWludCBob3VybHlTdGF0dXNFdGg7ICAvLyBGdW5kZWQgRXRoIGFtb3VudCBpbiBjdXJyZW50IGdhbWUgdGltZQogICAgICAgIHVpbnQgbW9udGhseVN0YXR1c0V0aDsKICAgICAgICB1aW50IHllYXJseVN0YXR1c0V0aDsKCiAgICAgICAgdWludCBob3VybHlTdGF0dXNUb2s7ICAvLyBGdW5kZWQgVG9rZW4gYW1vdW50IGluIGN1cnJlbnQgZ2FtZSB0aW1lCiAgICAgICAgdWludCBtb250aGx5U3RhdHVzVG9rOwogICAgfQogICAgRnVuZEFtb3VudFN0YXR1c0F0dHIgcHVibGljIGY7CgogICAgc3RydWN0IFByaWNlQXR0cnsKICAgICAgICB1aW50IGJvbnVzUGVyRXRoOyAgIC8vIElmIHlvdSBub3Qgd29uLCB4eCB0b2tlbiB0byAxIEV0aCB3aWxsIGJlIHJld2FyZGVkCgogICAgICAgIHVpbnQgaW5HYW1lVG9rUHJpY2VQZXJFdGg7ICAgLy8gUmVnYXJkIHh4IHRva2VuIHRvIDEgRXRoIGZvciB0b2tlbiBwYXJ0aWNpcGFudHMKICAgICAgICB1aW50IGluR2FtZVRva1dpblJhdGlvTWF4OyAgIC8vIDEwMCBtZWFucyAxMDAlLiBEaXNhZHZlbnRhZ2UgYWdhaW5zdCBFdGguIENoYW5nZSBwcml6ZSByYXRpbyBsaWtlIDI1fjUwJQogICAgICAgIHVpbnQgaW5HYW1lVG9rV2luUmF0aW9NaW47CiAgICAgICAgdWludCBjdXJyZW50SW5HYW1lVG9rV2luUmF0aW87ICAvLyBDdXJyZW50IHRva2VuIHdpbm5lcnMgcHJpemUgcmF0aW8KCiAgICAgICAgdWludCBob3VybHlNaW5QYXJ0aWNpcGF0ZVJhdGlvOyAgICAgLy8gSWYgcGFydGljaXBhbnRzLmxlbmd0aCBhcmUgbGVzcyB0aGFuIDEwMCwgeDEwMCB3b3VsZCBiZSBtaW4gcHJpemUgcmF0aW8KICAgICAgICB1aW50IG1vbnRobHlNaW5QYXJ0aWNpcGF0ZVJhdGlvOyAgICAvLyBJZiBwYXJ0aWNpcGFudHMubGVuZ3RoIGFyZSBsZXNzIHRoYW4gMzAwLCB4MzAwIHdvdWxkIGJlIG1pbiBwcml6ZSByYXRpbwogICAgICAgIHVpbnQgeWVhcmx5TWluUGFydGljaXBhdGVSYXRpbzsgICAgIC8vIElmIHBhcnRpY2lwYW50cy5sZW5ndGggYXJlIGxlc3MgdGhhbiAxMDAwLCB4MTAwMCB3b3VsZCBiZSBtaW4gcHJpemUgcmF0aW8KCiAgICAgICAgdWludCBib29zdFByaXplRXRoOyAgICAvLyBCb29zdHMgcHJpemUgYW1vdW50LiBEZWZhdWx0IGlzIDEwMCBhbmQgaXQgbWVhbnMgMTAwJQogICAgfQogICAgUHJpY2VBdHRyIHB1YmxpYyBwOwoKCiAgICBzdHJ1Y3QgUmFuZ2VHYW1lQXR0cnsKICAgICAgICB1aW50IGluVGltZVJhbmdlX0g7IC8vIDEwIG1lYW5zICstMTAgbWlucyBpbiB0aW1lCiAgICAgICAgdWludCBpblRpbWVSYW5nZV9NOwogICAgICAgIHVpbnQgaW5UaW1lUmFuZ2VfWTsKICAgIH0KICAgIFJhbmdlR2FtZUF0dHIgcHVibGljIHI7CiAgICBQYXJ0aWNpcGFudFtdIHB1YmxpYyBwYXJ0aWNpcGFudHM7ICAvLyBSYW5nZUdhbWUgcGFydGljaXBhbnRzCgogICAgbWFwcGluZyh1aW50MjU2ID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIHdpbm5lcnM7IC8vIEV0aCByZXdhcmQKICAgIG1hcHBpbmcodWludDI1NiA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyB0b2tUYWtlcnM7IC8vIFRvayByZXdhcmQKICAgIG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgd2luUHJpemVzOwogICAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tQcml6ZXM7CgogICAgZXZlbnQgTG9nU2VsZWN0V2lubmVyKHVpbnQgcmFuZCwgdWludCBsdWNreU51bWJlciwgYWRkcmVzcyBzZW5kZXIsIHVpbnQgcmV3YXJkLCB1aW50IGN1cnJlbmN5LCB1aW50IGFtb3VudCk7CgogICAgZnVuY3Rpb24gc2V0UHJpY2VBdHRyKAogICAgICAgICAgICBHYW1lVHlwZSBfZ2FtZVR5cGUsIHVpbnQgX2JvbnVzUGVyRXRoLCB1aW50IF9pbkdhbWVUb2tQcmljZVBlckV0aAogICAgICAgICAgICAsIHVpbnQgX2luR2FtZVRva1dpblJhdGlvTWF4LCB1aW50IF9pbkdhbWVUb2tXaW5SYXRpb01pbiwgdWludCBfY3VycmVudEluR2FtZVRva1dpblJhdGlvCiAgICAgICAgICAgICwgdWludCBfaG91cmx5TWluUGFydGljaXBhdGVSYXRpbywgdWludCBfbW9udGhseU1pblBhcnRpY2lwYXRlUmF0aW8sIHVpbnQgX3llYXJseU1pblBhcnRpY2lwYXRlUmF0aW8sIHVpbnQgX2Jvb3N0UHJpemVFdGgKICAgICAgICApIG9ubHlBdXRoIHsKICAgICAgICBjLmdhbWVUeXBlID0gX2dhbWVUeXBlOwoKICAgICAgICBwLmJvbnVzUGVyRXRoID0gX2JvbnVzUGVyRXRoOyAgIC8vMzAwICAgLy8gRGVwZW5kcyBvbiBjcm93ZFNhbGUgYXZlcmFnZSBwcmljZS4gVm90ZSBuZWVkZWQsIGJ1dCB3ZSBhc3N1bWUgQVZHLzQgaXMgcmVhc29uYWJsZS4KICAgICAgICBwLmluR2FtZVRva1ByaWNlUGVyRXRoID0gX2luR2FtZVRva1ByaWNlUGVyRXRoOyAvLzMwMCAgIC8vIFJlZ2FyZCB4eCB0b2tlbiB0byAxIEV0aCBmb3IgdG9rZW4gcGFydGljaXBhbnRzLiBEZXBlbmRzIG9uIGNyb3dkU2FsZSwgdG9vLgogICAgICAgIHAuaW5HYW1lVG9rV2luUmF0aW9NYXggPSBfaW5HYW1lVG9rV2luUmF0aW9NYXg7IC8vNTAgICAgLy8gMTAwIG1lYW5zIDEwMCUuIERpc2FkdmVudGFnZSBhZ2FpbnN0IEV0aC4gQ2hhbmdlIHByaXplIHJhdGlvIGxpa2UgMjV+NTAlCiAgICAgICAgcC5pbkdhbWVUb2tXaW5SYXRpb01pbiA9IF9pbkdhbWVUb2tXaW5SYXRpb01pbjsgLy8yNQogICAgICAgIHAuY3VycmVudEluR2FtZVRva1dpblJhdGlvID0gX2N1cnJlbnRJbkdhbWVUb2tXaW5SYXRpbzsgICAgLy81MAogICAgICAgIHAuaG91cmx5TWluUGFydGljaXBhdGVSYXRpbyA9IF9ob3VybHlNaW5QYXJ0aWNpcGF0ZVJhdGlvOyAgIC8vMTAwICAgLy8gSWYgcGFydGljaXBhbnRzLmxlbmd0aCBhcmUgbGVzcyB0aGFuIDEwMCwgeDEwMCB3b3VsZCBiZSBtaW4gcHJpemUgcmF0aW8KICAgICAgICBwLm1vbnRobHlNaW5QYXJ0aWNpcGF0ZVJhdGlvID0gX21vbnRobHlNaW5QYXJ0aWNpcGF0ZVJhdGlvOyAvLzMwMAogICAgICAgIHAueWVhcmx5TWluUGFydGljaXBhdGVSYXRpbyA9IF95ZWFybHlNaW5QYXJ0aWNpcGF0ZVJhdGlvOyAgIC8vMTAwMAogICAgICAgIHAuYm9vc3RQcml6ZUV0aCA9IF9ib29zdFByaXplRXRoOyAgIC8vMTAwCiAgICB9CgogICAgZnVuY3Rpb24gc2V0UmFuZ2VHYW1lQXR0cih1aW50IF9pblRpbWVSYW5nZV9ILCB1aW50IF9pblRpbWVSYW5nZV9NLCB1aW50IF9pblRpbWVSYW5nZV9ZKSBvbmx5QXV0aCB7CiAgICAgICAgci5pblRpbWVSYW5nZV9IID0gX2luVGltZVJhbmdlX0g7ICAgLy8xMCAgICAgICAvLyAxMCBtZWFuICstMTAgbWlucyBpbiB0aW1lCiAgICAgICAgci5pblRpbWVSYW5nZV9NID0gX2luVGltZVJhbmdlX007ICAgLy8xOTAgPSAzICogNjAgKyByLmluVGltZVJhbmdlX0gKICAgICAgICByLmluVGltZVJhbmdlX1kgPSBfaW5UaW1lUmFuZ2VfWTsgICAvLzM3MCA9IDYgKiA2MCArIHIuaW5UaW1lUmFuZ2VfSAogICAgfQogICAgIAogICAgLy8gQ2FsdWxhdGUgZ2FtZSB0aW1lIGFuZCBnYyBhbW91bnQgcmVjb3JkCiAgICBtb2RpZmllciBiZWZvcmVSYW5nZUdhbWUoKXsKICAgICAgICByZXF1aXJlKG5vdyA+IGQuZ2FtZVN0YXJ0ICYmIG5vdyA8PSBkLmdhbWVFbmQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgYmVmb3JlUG9pbnRHYW1lKCl7CiAgICAgICAgcmVmcmVzaEdhbWVUaW1lKCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9jZXNzKGFkZHJlc3Mgc2VuZGVyLCB1aW50IHNlbmRWYWx1ZSkgb25seU93bmVyIHsKICAgICAgICBpZihjLmdhbWVUeXBlID09IEdhbWVUeXBlLlJhbmdlKXsKICAgICAgICAgICAgUmFuZ2VHYW1lUHJvY2VzcyhzZW5kZXIsIHNlbmRWYWx1ZSk7CiAgICAgICAgfWVsc2UgaWYoYy5nYW1lVHlwZSA9PSBHYW1lVHlwZS5Qb2ludCl7CiAgICAgICAgICAgIFBvaW50R2FtZVByb2Nlc3Moc2VuZGVyLCBzZW5kVmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwcm9jZXNzV2l0aElURyhhZGRyZXNzIHNlbmRlciwgdWludCB0b2tlbkFtb3VudFRvR2FtZSkgb25seU93bmVyIHsKICAgICAgICBpZihjLmdhbWVUeXBlID09IEdhbWVUeXBlLlJhbmdlKXsKICAgICAgICAgICAgUmFuZ2VHYW1lV2l0aElURyhzZW5kZXIsIHRva2VuQW1vdW50VG9HYW1lKTsKICAgICAgICB9ZWxzZSBpZihjLmdhbWVUeXBlID09IEdhbWVUeXBlLlBvaW50KXsKICAgICAgICAgICAgUG9pbnRHYW1lV2l0aElURyhzZW5kZXIsIHRva2VuQW1vdW50VG9HYW1lKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmFuZ2UgR2FtZQogICAgZnVuY3Rpb24gUmFuZ2VHYW1lUHJvY2VzcyhhZGRyZXNzIHNlbmRlciwgdWludCBzZW5kVmFsdWUpIHByaXZhdGUgYmVmb3JlUmFuZ2VHYW1lIHsKICAgICAgICBpZihjLmN1cnJlbnRHYW1lVGltZVR5cGUgPT0gR2FtZVRpbWUuWWVhcil7CiAgICAgICAgICAgIGMueWVhcmx5QW1vdW50RXRoID0gYWRkKGMueWVhcmx5QW1vdW50RXRoLCBzZW5kVmFsdWUpOwogICAgICAgICAgICBmLnllYXJseVN0YXR1c0V0aCA9IGFkZChmLnllYXJseVN0YXR1c0V0aCwgc2VuZFZhbHVlKTsKICAgICAgICB9ZWxzZSBpZihjLmN1cnJlbnRHYW1lVGltZVR5cGUgPT0gR2FtZVRpbWUuTW9udGgpewogICAgICAgICAgICBjLm1vbnRobHlBbW91bnRFdGggPSBhZGQoYy5tb250aGx5QW1vdW50RXRoLCBzZW5kVmFsdWUpOwogICAgICAgICAgICBmLm1vbnRobHlTdGF0dXNFdGggPSBhZGQoZi5tb250aGx5U3RhdHVzRXRoLCBzZW5kVmFsdWUpOwogICAgICAgIH1lbHNlIGlmKGMuY3VycmVudEdhbWVUaW1lVHlwZSA9PSBHYW1lVGltZS5Ib3VyKXsKICAgICAgICAgICAgYy5ob3VybHlBbW91bnRFdGggPSBhZGQoYy5ob3VybHlBbW91bnRFdGgsIHNlbmRWYWx1ZSk7CiAgICAgICAgICAgIGYuaG91cmx5U3RhdHVzRXRoID0gYWRkKGYuaG91cmx5U3RhdHVzRXRoLCBzZW5kVmFsdWUpOwogICAgICAgIH0KICAgICAgICBwYXJ0aWNpcGFudHMucHVzaChQYXJ0aWNpcGFudChzZW5kZXIsc2VuZFZhbHVlLDEpKTsKICAgICAgICBpZihwLmJvbnVzUGVyRXRoICE9IDApewogICAgICAgICAgICB0b2tUYWtlcnNbZC5jdXJyZW50WWVhcl1bc2VuZGVyXSA9IGFkZCh0b2tUYWtlcnNbZC5jdXJyZW50WWVhcl1bc2VuZGVyXSwgc2VuZFZhbHVlICogcC5ib251c1BlckV0aCk7CiAgICAgICAgICAgIHRva1ByaXplc1tkLmN1cnJlbnRZZWFyXSA9IGFkZCh0b2tQcml6ZXNbZC5jdXJyZW50WWVhcl0sIHNlbmRWYWx1ZSAqIHAuYm9udXNQZXJFdGgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBSYW5nZUdhbWVXaXRoSVRHKGFkZHJlc3Mgc2VuZGVyLCB1aW50IHRva2VuQW1vdW50VG9HYW1lKSBwcml2YXRlIGJlZm9yZVJhbmdlR2FtZSB7CiAgICAgICAgcmVxdWlyZShjLmN1cnJlbnRHYW1lVGltZVR5cGUgIT0gR2FtZVRpbWUuWWVhcik7CgogICAgICAgIGlmKGMuY3VycmVudEdhbWVUaW1lVHlwZSA9PSBHYW1lVGltZS5Nb250aCl7CiAgICAgICAgICAgIGYubW9udGhseVN0YXR1c1RvayA9IGFkZChmLm1vbnRobHlTdGF0dXNUb2ssIHRva2VuQW1vdW50VG9HYW1lKTsKICAgICAgICB9ZWxzZSBpZihjLmN1cnJlbnRHYW1lVGltZVR5cGUgPT0gR2FtZVRpbWUuSG91cil7CiAgICAgICAgICAgIGYuaG91cmx5U3RhdHVzVG9rID0gYWRkKGYuaG91cmx5U3RhdHVzVG9rLCB0b2tlbkFtb3VudFRvR2FtZSk7CiAgICAgICAgfQogICAgICAgIHBhcnRpY2lwYW50cy5wdXNoKFBhcnRpY2lwYW50KHNlbmRlcix0b2tlbkFtb3VudFRvR2FtZSwyKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZVJhbmdlSW5mbygpIHByaXZhdGUgcmV0dXJucyAoR2FtZVRpbWUsIHVpbnQsIHVpbnQsIHVpbnQpIHsKICAgICAgICB1aW50IG5leHRUaW1lU3RhbXA7CiAgICAgICAgdWludCBuZXh0WWVhcjsKICAgICAgICB1aW50IG5leHRNb250aDsKICAgICAgICB1aW50IGJhc2lzOwogICAgICAgIGlmKGMuZ2FtZVR5cGUgPT0gR2FtZVR5cGUuUmFuZ2UpewogICAgICAgICAgICBuZXh0VGltZVN0YW1wID0gbm93ICsgci5pblRpbWVSYW5nZV9ZICogMSBtaW51dGVzICsgMSBob3VyczsKICAgICAgICAgICAgbmV4dFllYXIgPSBnZXRZZWFyKG5leHRUaW1lU3RhbXApOwogICAgICAgICAgICBpZihnZXRZZWFyKG5vdyAtIHIuaW5UaW1lUmFuZ2VfWSAqIDEgbWludXRlcyArIDEgaG91cnMpICE9IG5leHRZZWFyKXsKICAgICAgICAgICAgICAgIGJhc2lzID0gbmV4dFRpbWVTdGFtcCAtIChuZXh0VGltZVN0YW1wICUgMSBkYXlzKTsgICAgLy9UaW1lIHJhbmdlIGxpbWl0IGlzIGxlc3MgdGhhbiAxMiBob3VycwogICAgICAgICAgICAgICAgcmV0dXJuIChHYW1lVGltZS5ZZWFyLCBuZXh0WWVhciwgYmFzaXMgLSByLmluVGltZVJhbmdlX1kgKiAxIG1pbnV0ZXMsIGJhc2lzICsgci5pblRpbWVSYW5nZV9ZICogMSBtaW51dGVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0VGltZVN0YW1wID0gbm93ICsgci5pblRpbWVSYW5nZV9NICogMSBtaW51dGVzICsgMSBob3VyczsKICAgICAgICAgICAgbmV4dE1vbnRoID0gZ2V0TW9udGgobmV4dFRpbWVTdGFtcCk7CiAgICAgICAgICAgIGlmKGdldE1vbnRoKG5vdyAtIHIuaW5UaW1lUmFuZ2VfTSAqIDEgbWludXRlcyArIDEgaG91cnMpICE9IG5leHRNb250aCl7CiAgICAgICAgICAgICAgICBiYXNpcyA9IG5leHRUaW1lU3RhbXAgLSAobmV4dFRpbWVTdGFtcCAlIDEgZGF5cyk7IAogICAgICAgICAgICAgICAgcmV0dXJuIChHYW1lVGltZS5Nb250aCwgbmV4dFllYXIsIGJhc2lzIC0gci5pblRpbWVSYW5nZV9NICogMSBtaW51dGVzLCBiYXNpcyArIHIuaW5UaW1lUmFuZ2VfTSAqIDEgbWludXRlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dFRpbWVTdGFtcCA9IG5vdyArIHIuaW5UaW1lUmFuZ2VfSCAqIDEgbWludXRlcyArIDEgaG91cnM7CiAgICAgICAgICAgIGJhc2lzID0gbmV4dFRpbWVTdGFtcCAtIChuZXh0VGltZVN0YW1wICUgMSBob3Vycyk7IAogICAgICAgICAgICByZXR1cm4gKEdhbWVUaW1lLkhvdXIsIG5leHRZZWFyLCBiYXNpcyAtIHIuaW5UaW1lUmFuZ2VfSCAqIDEgbWludXRlcywgYmFzaXMgKyByLmluVGltZVJhbmdlX0ggKiAxIG1pbnV0ZXMpOwogICAgICAgIH1lbHNlIGlmKGMuZ2FtZVR5cGUgPT0gR2FtZVR5cGUuUG9pbnQpewogICAgICAgICAgICBuZXh0VGltZVN0YW1wID0gbm93IC0gKG5vdyAlIDEgaG91cnMpICsgMSBob3VyczsKICAgICAgICAgICAgbmV4dFllYXIgPSBnZXRZZWFyKG5leHRUaW1lU3RhbXApOwogICAgICAgICAgICBpZihnZXRZZWFyKG5vdykgIT0gbmV4dFllYXIpewogICAgICAgICAgICAgICAgcmV0dXJuIChHYW1lVGltZS5ZZWFyLCBuZXh0WWVhciwgMCwgbmV4dFRpbWVTdGFtcCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dE1vbnRoID0gZ2V0TW9udGgobmV4dFRpbWVTdGFtcCk7CiAgICAgICAgICAgIGlmKGdldE1vbnRoKG5vdykgIT0gbmV4dE1vbnRoKXsKICAgICAgICAgICAgICAgIHJldHVybiAoR2FtZVRpbWUuTW9udGgsIG5leHRZZWFyLCAwLCBuZXh0VGltZVN0YW1wKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKEdhbWVUaW1lLkhvdXIsIG5leHRZZWFyLCAwLCBuZXh0VGltZVN0YW1wKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVmcmVzaEdhbWVUaW1lKCkgcHJpdmF0ZSB7CiAgICAgICAgKGMuY3VycmVudEdhbWVUaW1lVHlwZSwgZC5jdXJyZW50WWVhciwgZC5nYW1lU3RhcnQsIGQuZ2FtZUVuZCkgPSBnZXRUaW1lUmFuZ2VJbmZvKCk7CiAgICB9CgogICAgLy8gR2FyYmFnZSBDb2xsZWN0IHByZXZpb3VzIGZ1bmRlZCBhbW91bnQgcmVjb3JkIGFuZCBsb2cgdGhlIHN0YXR1cwogICAgZnVuY3Rpb24gZ2NGdW5kQW1vdW50KCkgcHJpdmF0ZSB7CiAgICAgICAgZi5ob3VybHlTdGF0dXNFdGggPSAwOwogICAgICAgIGYubW9udGhseVN0YXR1c0V0aCA9IDA7CiAgICAgICAgZi55ZWFybHlTdGF0dXNFdGggPSAwOwoKICAgICAgICBmLmhvdXJseVN0YXR1c1RvayA9IDA7CiAgICAgICAgZi5tb250aGx5U3RhdHVzVG9rID0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxlY3RXaW5uZXIodWludCByYW5kKSBvbmx5T3duZXIgewogICAgICAgIHVpbnQgbHVja3lOdW1iZXIgPSBwYXJ0aWNpcGFudHMubGVuZ3RoICogcmFuZCAvIDEwMDAwMDAwMDsKICAgICAgICB1aW50IHJld2FyZERpdjEwMCA9IDA7CgogICAgICAgIHVpbnQgcGFydGljaXBhdGVSYXRpbyA9IHBhcnRpY2lwYW50cy5sZW5ndGg7CiAgICAgICAgaWYocGFydGljaXBhdGVSYXRpbyAhPSAwKXsKICAgICAgICAgICAgaWYoYy5jdXJyZW50R2FtZVRpbWVUeXBlID09IEdhbWVUaW1lLlllYXIpewogICAgICAgICAgICAgICAgcGFydGljaXBhdGVSYXRpbyA9IHBhcnRpY2lwYXRlUmF0aW8gPiBwLnllYXJseU1pblBhcnRpY2lwYXRlUmF0aW8/cGFydGljaXBhdGVSYXRpbzpwLnllYXJseU1pblBhcnRpY2lwYXRlUmF0aW87CiAgICAgICAgICAgIH1lbHNlIGlmKGMuY3VycmVudEdhbWVUaW1lVHlwZSA9PSBHYW1lVGltZS5Nb250aCl7CiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0ZVJhdGlvID0gcGFydGljaXBhdGVSYXRpbyA+IHAubW9udGhseU1pblBhcnRpY2lwYXRlUmF0aW8/cGFydGljaXBhdGVSYXRpbzpwLm1vbnRobHlNaW5QYXJ0aWNpcGF0ZVJhdGlvOwogICAgICAgICAgICB9ZWxzZSBpZihjLmN1cnJlbnRHYW1lVGltZVR5cGUgPT0gR2FtZVRpbWUuSG91cil7CiAgICAgICAgICAgICAgICBwYXJ0aWNpcGF0ZVJhdGlvID0gcGFydGljaXBhdGVSYXRpbyA+IHAuaG91cmx5TWluUGFydGljaXBhdGVSYXRpbz9wYXJ0aWNpcGF0ZVJhdGlvOnAuaG91cmx5TWluUGFydGljaXBhdGVSYXRpbzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYocGFydGljaXBhbnRzW2x1Y2t5TnVtYmVyXS5jdXJyZW5jeSA9PSAxKXsKICAgICAgICAgICAgICAgIHJld2FyZERpdjEwMCA9IHBhcnRpY2lwYW50c1tsdWNreU51bWJlcl0udmFsdWUgKiBwYXJ0aWNpcGF0ZVJhdGlvICogcC5ib29zdFByaXplRXRoIC8gMTAwIC8gMTAwOwogICAgICAgICAgICAgICAgaWYocC5jdXJyZW50SW5HYW1lVG9rV2luUmF0aW8gPCBwLmluR2FtZVRva1dpblJhdGlvTWF4KXsKICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRJbkdhbWVUb2tXaW5SYXRpbysrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZSBpZihwYXJ0aWNpcGFudHNbbHVja3lOdW1iZXJdLmN1cnJlbmN5ID09IDIpewogICAgICAgICAgICAgICAgcmV3YXJkRGl2MTAwID0gKHBhcnRpY2lwYW50c1tsdWNreU51bWJlcl0udmFsdWUgLyBwLmluR2FtZVRva1ByaWNlUGVyRXRoICogcC5jdXJyZW50SW5HYW1lVG9rV2luUmF0aW8gLyAxMDApICogcGFydGljaXBhdGVSYXRpbyAvIDEwMDsKICAgICAgICAgICAgICAgIGlmKHAuY3VycmVudEluR2FtZVRva1dpblJhdGlvID4gcC5pbkdhbWVUb2tXaW5SYXRpb01pbil7CiAgICAgICAgICAgICAgICAgICAgcC5jdXJyZW50SW5HYW1lVG9rV2luUmF0aW8tLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoYy5jdXJyZW50R2FtZVRpbWVUeXBlID09IEdhbWVUaW1lLlllYXIpewogICAgICAgICAgICAgICAgaWYoYy55ZWFybHlBbW91bnRFdGggPj0gcmV3YXJkRGl2MTAwKjEwNCl7ICAvLzEuMDQKICAgICAgICAgICAgICAgICAgICBjLnllYXJseUFtb3VudEV0aCA9IHN1YihjLnllYXJseUFtb3VudEV0aCwgcmV3YXJkRGl2MTAwKjEwNCk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICByZXdhcmREaXYxMDAgPSBjLnllYXJseUFtb3VudEV0aCAvIDEwNDsKICAgICAgICAgICAgICAgICAgICBjLnllYXJseUFtb3VudEV0aCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1lbHNlIGlmKGMuY3VycmVudEdhbWVUaW1lVHlwZSA9PSBHYW1lVGltZS5Nb250aCl7CiAgICAgICAgICAgICAgICBpZihjLm1vbnRobHlBbW91bnRFdGggPj0gcmV3YXJkRGl2MTAwKjEwNyl7ICAgIC8vMS4wNwogICAgICAgICAgICAgICAgICAgIGMubW9udGhseUFtb3VudEV0aCA9IHN1YihjLm1vbnRobHlBbW91bnRFdGgsIHJld2FyZERpdjEwMCoxMDcpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkRGl2MTAwID0gYy5tb250aGx5QW1vdW50RXRoIC8gMTA3OwogICAgICAgICAgICAgICAgICAgIGMubW9udGhseUFtb3VudEV0aCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjLnllYXJseUFtb3VudEV0aCA9IGFkZChjLnllYXJseUFtb3VudEV0aCxyZXdhcmREaXYxMDAgKiAzKTsgLy8wLjAzLCAxLjEKICAgICAgICAgICAgfWVsc2UgaWYoYy5jdXJyZW50R2FtZVRpbWVUeXBlID09IEdhbWVUaW1lLkhvdXIpewogICAgICAgICAgICAgICAgaWYoYy5ob3VybHlBbW91bnRFdGggPj0gcmV3YXJkRGl2MTAwKjExMCl7CiAgICAgICAgICAgICAgICAgICAgYy5ob3VybHlBbW91bnRFdGggPSBzdWIoYy5ob3VybHlBbW91bnRFdGgsIHJld2FyZERpdjEwMCoxMTApOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkRGl2MTAwID0gYy5ob3VybHlBbW91bnRFdGggLyAxMTA7CiAgICAgICAgICAgICAgICAgICAgYy5ob3VybHlBbW91bnRFdGggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYy5tb250aGx5QW1vdW50RXRoID0gYWRkKGMubW9udGhseUFtb3VudEV0aCxyZXdhcmREaXYxMDAgKiAzKTsKICAgICAgICAgICAgICAgIGMueWVhcmx5QW1vdW50RXRoID0gYWRkKGMueWVhcmx5QW1vdW50RXRoLHJld2FyZERpdjEwMCAqIDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGMuY2hhcml0eUFtb3VudEV0aCA9IGFkZChjLmNoYXJpdHlBbW91bnRFdGgscmV3YXJkRGl2MTAwICogNCk7CgogICAgICAgICAgICB3aW5uZXJzW2QuY3VycmVudFllYXJdW3BhcnRpY2lwYW50c1tsdWNreU51bWJlcl0uc2VuZGVyXSA9IGFkZCh3aW5uZXJzW2QuY3VycmVudFllYXJdW3BhcnRpY2lwYW50c1tsdWNreU51bWJlcl0uc2VuZGVyXSxyZXdhcmREaXYxMDAqMTAwKTsKICAgICAgICAgICAgd2luUHJpemVzW2QuY3VycmVudFllYXJdID0gYWRkKHdpblByaXplc1tkLmN1cnJlbnRZZWFyXSxyZXdhcmREaXYxMDAqMTAwKTsKICAgICAgICAKICAgICAgICAgICAgTG9nU2VsZWN0V2lubmVyKHJhbmQsIGx1Y2t5TnVtYmVyLCBwYXJ0aWNpcGFudHNbbHVja3lOdW1iZXJdLnNlbmRlciwgcmV3YXJkRGl2MTAwKjEwMCwgcGFydGljaXBhbnRzW2x1Y2t5TnVtYmVyXS5jdXJyZW5jeSwgcGFydGljaXBhbnRzW2x1Y2t5TnVtYmVyXS52YWx1ZSk7CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIHBhcnRpY2lwYW50cwogICAgICAgICAgICBwYXJ0aWNpcGFudHMubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgICAgaWYoYy5nYW1lVHlwZSA9PSBHYW1lVHlwZS5SYW5nZSl7CiAgICAgICAgICAgIHJlZnJlc2hHYW1lVGltZSgpOwogICAgICAgIH0KICAgICAgICBnY0Z1bmRBbW91bnQoKTsgICAgCiAgICB9CgogICAgLy9jbGFpbUFsbAogICAgZnVuY3Rpb24gZ2V0UHJpemUoYWRkcmVzcyBzZW5kZXIpIG9ubHlPd25lciByZXR1cm5zICh1aW50IGV0aFByaXplLCB1aW50IHRva1ByaXplKSB7CiAgICAgICAgZXRoUHJpemUgPSBhZGQod2lubmVyc1tkLmN1cnJlbnRZZWFyXVtzZW5kZXJdLHdpbm5lcnNbZC5jdXJyZW50WWVhci0xXVtzZW5kZXJdKTsKICAgICAgICB0b2tQcml6ZSA9IGFkZCh0b2tUYWtlcnNbZC5jdXJyZW50WWVhcl1bc2VuZGVyXSx0b2tUYWtlcnNbZC5jdXJyZW50WWVhci0xXVtzZW5kZXJdKTsKCiAgICAgICAgd2luUHJpemVzW2QuY3VycmVudFllYXJdID0gc3ViKHdpblByaXplc1tkLmN1cnJlbnRZZWFyXSx3aW5uZXJzW2QuY3VycmVudFllYXJdW3NlbmRlcl0pOwogICAgICAgIHRva1ByaXplc1tkLmN1cnJlbnRZZWFyXSA9IHN1Yih0b2tQcml6ZXNbZC5jdXJyZW50WWVhcl0sdG9rVGFrZXJzW2QuY3VycmVudFllYXJdW3NlbmRlcl0pOwogICAgICAgIHdpbm5lcnNbZC5jdXJyZW50WWVhcl1bc2VuZGVyXSA9IDA7CiAgICAgICAgdG9rVGFrZXJzW2QuY3VycmVudFllYXJdW3NlbmRlcl0gPSAwOwoKICAgICAgICB3aW5Qcml6ZXNbZC5jdXJyZW50WWVhci0xXSA9IHN1Yih3aW5Qcml6ZXNbZC5jdXJyZW50WWVhci0xXSx3aW5uZXJzW2QuY3VycmVudFllYXItMV1bc2VuZGVyXSk7CiAgICAgICAgdG9rUHJpemVzW2QuY3VycmVudFllYXItMV0gPSBzdWIodG9rUHJpemVzW2QuY3VycmVudFllYXItMV0sdG9rVGFrZXJzW2QuY3VycmVudFllYXItMV1bc2VuZGVyXSk7CiAgICAgICAgd2lubmVyc1tkLmN1cnJlbnRZZWFyLTFdW3NlbmRlcl0gPSAwOwogICAgICAgIHRva1Rha2Vyc1tkLmN1cnJlbnRZZWFyLTFdW3NlbmRlcl0gPSAwOwogICAgfQoKICAgIC8vIFBvaW50IEdhbWUKICAgIGZ1bmN0aW9uIFBvaW50R2FtZVByb2Nlc3MoYWRkcmVzcyBzZW5kZXIsIHVpbnQgc2VuZFZhbHVlKSBwcml2YXRlIGJlZm9yZVBvaW50R2FtZSB7CiAgICAgICAgaWYoYy5jdXJyZW50R2FtZVRpbWVUeXBlID09IEdhbWVUaW1lLlllYXIpewogICAgICAgICAgICBjLnllYXJseUFtb3VudEV0aCA9IGFkZChjLnllYXJseUFtb3VudEV0aCwgc2VuZFZhbHVlKTsKICAgICAgICAgICAgZi55ZWFybHlTdGF0dXNFdGggPSBhZGQoZi55ZWFybHlTdGF0dXNFdGgsIHNlbmRWYWx1ZSk7CiAgICAgICAgfWVsc2UgaWYoYy5jdXJyZW50R2FtZVRpbWVUeXBlID09IEdhbWVUaW1lLk1vbnRoKXsKICAgICAgICAgICAgYy5tb250aGx5QW1vdW50RXRoID0gYWRkKGMubW9udGhseUFtb3VudEV0aCwgc2VuZFZhbHVlKTsKICAgICAgICAgICAgZi5tb250aGx5U3RhdHVzRXRoID0gYWRkKGYubW9udGhseVN0YXR1c0V0aCwgc2VuZFZhbHVlKTsKICAgICAgICB9ZWxzZSBpZihjLmN1cnJlbnRHYW1lVGltZVR5cGUgPT0gR2FtZVRpbWUuSG91cil7CiAgICAgICAgICAgIGMuaG91cmx5QW1vdW50RXRoID0gYWRkKGMuaG91cmx5QW1vdW50RXRoLCBzZW5kVmFsdWUpOwogICAgICAgICAgICBmLmhvdXJseVN0YXR1c0V0aCA9IGFkZChmLmhvdXJseVN0YXR1c0V0aCwgc2VuZFZhbHVlKTsKICAgICAgICB9CgogICAgICAgIFBvaW50R2FtZVBhcnRpY2lwYXRlKHNlbmRlciwgc2VuZFZhbHVlLCAxKTsKICAgICAgICAKICAgICAgICBpZihwLmJvbnVzUGVyRXRoICE9IDApewogICAgICAgICAgICB0b2tUYWtlcnNbZC5jdXJyZW50WWVhcl1bc2VuZGVyXSA9IGFkZCh0b2tUYWtlcnNbZC5jdXJyZW50WWVhcl1bc2VuZGVyXSwgc2VuZFZhbHVlICogcC5ib251c1BlckV0aCk7CiAgICAgICAgICAgIHRva1ByaXplc1tkLmN1cnJlbnRZZWFyXSA9IGFkZCh0b2tQcml6ZXNbZC5jdXJyZW50WWVhcl0sIHNlbmRWYWx1ZSAqIHAuYm9udXNQZXJFdGgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBQb2ludEdhbWVXaXRoSVRHKGFkZHJlc3Mgc2VuZGVyLCB1aW50IHRva2VuQW1vdW50VG9HYW1lKSBwcml2YXRlIGJlZm9yZVBvaW50R2FtZSB7CiAgICAgICAgcmVxdWlyZShjLmN1cnJlbnRHYW1lVGltZVR5cGUgIT0gR2FtZVRpbWUuWWVhcik7CgogICAgICAgIGlmKGMuY3VycmVudEdhbWVUaW1lVHlwZSA9PSBHYW1lVGltZS5Nb250aCl7CiAgICAgICAgICAgIGYubW9udGhseVN0YXR1c1RvayA9IGFkZChmLm1vbnRobHlTdGF0dXNUb2ssIHRva2VuQW1vdW50VG9HYW1lKTsKICAgICAgICB9ZWxzZSBpZihjLmN1cnJlbnRHYW1lVGltZVR5cGUgPT0gR2FtZVRpbWUuSG91cil7CiAgICAgICAgICAgIGYuaG91cmx5U3RhdHVzVG9rID0gYWRkKGYuaG91cmx5U3RhdHVzVG9rLCB0b2tlbkFtb3VudFRvR2FtZSk7CiAgICAgICAgfQoKICAgICAgICBQb2ludEdhbWVQYXJ0aWNpcGF0ZShzZW5kZXIsIHRva2VuQW1vdW50VG9HYW1lLCAyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBQb2ludEdhbWVQYXJ0aWNpcGF0ZShhZGRyZXNzIHNlbmRlciwgdWludCBzZW5kVmFsdWUsIHVpbnQgY3VycmVuY3kpIHByaXZhdGUgewogICAgICAgIGlmKGQucHJldkdhbWVFbmQgIT0gZC5nYW1lRW5kKXsKICAgICAgICAgICAgc2VsZWN0V2lubmVyKDEpOwogICAgICAgIH0KICAgICAgICBwYXJ0aWNpcGFudHMubGVuZ3RoID0gMDsKICAgICAgICBwYXJ0aWNpcGFudHMucHVzaChQYXJ0aWNpcGFudChzZW5kZXIsc2VuZFZhbHVlLGN1cnJlbmN5KSk7CgogICAgICAgIGQucHJldkdhbWVFbmQgPSBkLmdhbWVFbmQ7CiAgICB9CgogICAgZnVuY3Rpb24gbG9zc1RvQ2hhcml0eSh1aW50IHllYXIpIG9ubHlPd25lciByZXR1cm5zICh1aW50IGFtdCkgewogICAgICAgIHJlcXVpcmUoeWVhciA8IGQuY3VycmVudFllYXItMSk7CiAgICAgICAgCiAgICAgICAgYW10ID0gd2luUHJpemVzW3llYXJdOwogICAgICAgIHRva1ByaXplc1t5ZWFyXSA9IDA7CiAgICAgICAgd2luUHJpemVzW3llYXJdID0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFyaXR5QW10VG9DaGFyaXR5KCkgb25seU93bmVyIHJldHVybnMgKHVpbnQgYW10KSB7CiAgICAgICAgYW10ID0gYy5jaGFyaXR5QW1vdW50RXRoOwogICAgICAgIGMuY2hhcml0eUFtb3VudEV0aCA9IDA7CiAgICB9CgogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVRva2VuU2FsZSh1aW50IGhvdXIsIHVpbnQgbW9udGgsIHVpbnQgeWVhciwgdWludCBjaGFyaXR5KSBvbmx5T3duZXJ7CiAgICAgICAgYy5ob3VybHlBbW91bnRFdGggPSBhZGQoYy5ob3VybHlBbW91bnRFdGgsIGhvdXIpOwogICAgICAgIGMubW9udGhseUFtb3VudEV0aCA9IGFkZChjLm1vbnRobHlBbW91bnRFdGgsIG1vbnRoKTsKICAgICAgICBjLnllYXJseUFtb3VudEV0aCA9IGFkZChjLnllYXJseUFtb3VudEV0aCwgeWVhcik7CiAgICAgICAgYy5jaGFyaXR5QW1vdW50RXRoID0gYWRkKGMuY2hhcml0eUFtb3VudEV0aCwgY2hhcml0eSk7CiAgICB9Cn0KCmNvbnRyYWN0IElUR1Rva2VuIGlzIElUR1Rva2VuQmFzZSwgQXV0aGFibGUgewogICAgYnl0ZXMzMiAgcHVibGljICBzeW1ib2wgPSAiSVRHIjsKICAgIHVpbnQyNTYgIHB1YmxpYyAgZGVjaW1hbHMgPSAxODsKICAgIGJ5dGVzMzIgICBwdWJsaWMgIG5hbWUgPSAiSVRHIjsKCiAgICBlbnVtIFN0YXR1cyB7IENyb3dkU2FsZSwgR2FtZSwgUGF1c2UgfQogICAgU3RhdHVzIHB1YmxpYyBzdGF0dXM7CgogICAgQ3Jvd2RTYWxlIGNyb3dkU2FsZTsKICAgIEdhbWVzIGdhbWVzOwogICAgVm90aW5nIHZvdGluZzsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHdpdGhkcmF3UmVzdHJpY3Rpb247CgogICAgdWludCBwdWJsaWMgbWluRXRoZXJQYXJ0aWNpcGF0ZTsKICAgIHVpbnQgcHVibGljIG1pblRva1BhcnRpY2lwYXRlOwoKICAgIGV2ZW50IExvZ0Z1bmRUcmFuc2ZlcihhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyB0bywgdWludCBhbW91bnQsIHVpbnQ4IGN1cnJlbmN5KTsKCiAgICBtb2RpZmllciBiZWZvcmVUcmFuc2ZlcigpewogICAgICAgIHJlcXVpcmUod2l0aGRyYXdSZXN0cmljdGlvblttc2cuc2VuZGVyXSA8IG5vdyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGJlZm9yZVRyYW5zZmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgYmVmb3JlVHJhbnNmZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgdWludCBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKiAgYXQgaW5pdGlhbGl6YXRpb24sIHNldHVwIHRoZSBvd25lciAqLwogICAgZnVuY3Rpb24gSVRHVG9rZW4oKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHRvdGFsU3VwcGx5ID0gMTAwMDAwMDAwICogMSBldGhlcjsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OwoKICAgICAgICBzdGF0dXMgPSBTdGF0dXMuUGF1c2U7CiAgICB9CiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgIGlmKG1zZy52YWx1ZSA8IG1pbkV0aGVyUGFydGljaXBhdGUpewogICAgICAgICAgICB0aHJvdzsKICAgICAgIH0KCiAgICAgICBpZihzdGF0dXMgPT0gU3RhdHVzLkNyb3dkU2FsZSl7CiAgICAgICAgICAgIExvZ0Z1bmRUcmFuc2Zlcihtc2cuc2VuZGVyLCAweDAsIG1zZy52YWx1ZSwgMSk7CiAgICAgICAgICAgIGl0Z1Rva2VuVHJhbnNmZXIoY3Jvd2RTYWxlLnByb2Nlc3MobXNnLnNlbmRlcixtc2cudmFsdWUpLHRydWUpOwogICAgICAgfWVsc2UgaWYoc3RhdHVzID09IFN0YXR1cy5HYW1lKXsKICAgICAgICAgICAgTG9nRnVuZFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgbXNnLnZhbHVlLCAxKTsKICAgICAgICAgICAgZ2FtZXMucHJvY2Vzcyhtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgICAgfWVsc2UgaWYoc3RhdHVzID09IFN0YXR1cy5QYXVzZSl7CiAgICAgICAgICAgIHRocm93OwogICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldEF0dHJzKGFkZHJlc3MgY3NBZGRyLCBhZGRyZXNzIGdtQWRkciwgYWRkcmVzcyB2dEFkZHIsIFN0YXR1cyBfc3RhdHVzLCB1aW50IGFtdEV0aCwgdWludCBhbXRUb2spIG9ubHlBdXRoIHsKICAgICAgICBjcm93ZFNhbGUgPSBDcm93ZFNhbGUoY3NBZGRyKTsKICAgICAgICBnYW1lcyA9IEdhbWVzKGdtQWRkcik7CiAgICAgICAgdm90aW5nID0gVm90aW5nKHZ0QWRkcik7CiAgICAgICAgc3RhdHVzID0gX3N0YXR1czsKICAgICAgICBtaW5FdGhlclBhcnRpY2lwYXRlID0gYW10RXRoOwogICAgICAgIG1pblRva1BhcnRpY2lwYXRlID0gYW10VG9rOwogICAgfQoKICAgIC8vZ2V0Q3Jvd2RTYWxlVG9rZW4KICAgIGZ1bmN0aW9uIFVTRVJfR0VUX0NST1dEU0FMRV9UT0tFTigpIHsKICAgICAgICBpdGdUb2tlblRyYW5zZmVyKGNyb3dkU2FsZS5nZXRUb2tlbihtc2cuc2VuZGVyKSx0cnVlKTsKICAgIH0KCiAgICAvL3ZvdGUKICAgIGZ1bmN0aW9uIFVTRVJfVk9URSh1aW50IHZvdGVJZCwgdWludCBjYW5kaWRhdGVJZCl7CiAgICAgICAgdWludCBhZGRlZFRva2VuOwogICAgICAgIHVpbnQgbG9ja1VudGlsOwogICAgICAgIChhZGRlZFRva2VuLCBsb2NrVW50aWwpID0gdm90aW5nLnZvdGUobXNnLnNlbmRlcixiYWxhbmNlc1ttc2cuc2VuZGVyXSx2b3RlSWQsY2FuZGlkYXRlSWQpOwogICAgICAgIGl0Z1Rva2VuVHJhbnNmZXIoYWRkZWRUb2tlbix0cnVlKTsKCiAgICAgICAgaWYod2l0aGRyYXdSZXN0cmljdGlvblttc2cuc2VuZGVyXSA8IGxvY2tVbnRpbCl7CiAgICAgICAgICAgIHdpdGhkcmF3UmVzdHJpY3Rpb25bbXNnLnNlbmRlcl0gPSBsb2NrVW50aWw7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHZvdGVJbml0aWF0ZSh1aW50IHZvdGVJZCwgdWludCB2b3RlUmV3YXJkUGVyVW5pdCwgdWludCB2b3RlV2VpZ2h0VW5pdCwgdWludCB2b3RlU3RhcnQsIHVpbnQgdm90ZUVuZCwgdWludCBtYXhDYW5kaWRhdGVJZCkgb25seUF1dGggewogICAgICAgIHZvdGluZy52b3RlSW5pdGlhdGUodm90ZUlkLCB2b3RlUmV3YXJkUGVyVW5pdCwgdm90ZVdlaWdodFVuaXQsIHZvdGVTdGFydCwgdm90ZUVuZCwgbWF4Q2FuZGlkYXRlSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGl0Z1Rva2VuVHJhbnNmZXIodWludCBhbXQsIGJvb2wgZnJvbU93bmVyKSBwcml2YXRlIHsKICAgICAgICBpZihhbXQgPiAwKXsKICAgICAgICAgICAgaWYoZnJvbU93bmVyKXsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW293bmVyXSA9IHN1YihiYWxhbmNlc1tvd25lcl0sIGFtdCk7CiAgICAgICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGFkZChiYWxhbmNlc1ttc2cuc2VuZGVyXSwgYW10KTsKICAgICAgICAgICAgICAgIFRyYW5zZmVyKG93bmVyLCBtc2cuc2VuZGVyLCBhbXQpOwogICAgICAgICAgICAgICAgTG9nRnVuZFRyYW5zZmVyKG93bmVyLCBtc2cuc2VuZGVyLCBhbXQsIDIpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGFkZChiYWxhbmNlc1tvd25lcl0sIGFtdCk7CiAgICAgICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgYW10KTsKICAgICAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIG93bmVyLCBhbXQpOwogICAgICAgICAgICAgICAgTG9nRnVuZFRyYW5zZmVyKG1zZy5zZW5kZXIsIG93bmVyLCBhbXQsIDIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGV0aFRyYW5zZmVyKGFkZHJlc3MgdGFyZ2V0LCB1aW50IGFtdCkgcHJpdmF0ZSB7CiAgICAgICAgaWYoYW10ID4gMCl7CiAgICAgICAgICAgIHRhcmdldC50cmFuc2ZlcihhbXQpOwogICAgICAgICAgICBMb2dGdW5kVHJhbnNmZXIoMHgwLCB0YXJnZXQsIGFtdCwgMSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vZ2FtZVdpdGhUb2tlbgogICAgZnVuY3Rpb24gVVNFUl9HQU1FX1dJVEhfVE9LRU4odWludCB0b2tlbkFtb3VudFRvR2FtZSkgewogICAgICAgIHJlcXVpcmUoc3RhdHVzID09IFN0YXR1cy5HYW1lKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IHRva2VuQW1vdW50VG9HYW1lICogMSBldGhlcik7CiAgICAgICAgcmVxdWlyZSh0b2tlbkFtb3VudFRvR2FtZSAqIDEgZXRoZXIgPj0gbWluVG9rUGFydGljaXBhdGUpOwoKICAgICAgICBpdGdUb2tlblRyYW5zZmVyKHRva2VuQW1vdW50VG9HYW1lICogMSBldGhlcixmYWxzZSk7CgogICAgICAgIGdhbWVzLnByb2Nlc3NXaXRoSVRHKG1zZy5zZW5kZXIsIHRva2VuQW1vdW50VG9HYW1lICogMSBldGhlcik7CiAgICAgICAgCiAgICB9CgogICAgLy9nZXRQcml6ZQogICAgZnVuY3Rpb24gVVNFUl9HRVRfUFJJWkUoKSB7CiAgICAgICAgdWludCBldGhQcml6ZTsKICAgICAgICB1aW50IHRva1ByaXplOwogICAgICAgIChldGhQcml6ZSwgdG9rUHJpemUpID0gZ2FtZXMuZ2V0UHJpemUobXNnLnNlbmRlcik7CiAgICAgICAgaXRnVG9rZW5UcmFuc2Zlcih0b2tQcml6ZSx0cnVlKTsKICAgICAgICBldGhUcmFuc2Zlcihtc2cuc2VuZGVyLCBldGhQcml6ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsZWN0V2lubmVyKHVpbnQgcmFuZCkgb25seUF1dGggewogICAgICAgIGdhbWVzLnNlbGVjdFdpbm5lcihyYW5kKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgYW10KSBvbmx5T3duZXIgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBhbXQpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc3ViKHRvdGFsU3VwcGx5LGFtdCk7CiAgICB9CgogICAgZnVuY3Rpb24gbWludCh1aW50IGFtdCkgb25seU93bmVyIHsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGFkZChiYWxhbmNlc1ttc2cuc2VuZGVyXSwgYW10KTsKICAgICAgICB0b3RhbFN1cHBseSA9IGFkZCh0b3RhbFN1cHBseSxhbXQpOwogICAgfQoKICAgIC8vIFdlIGRvIG5vdCB3YW50IGJpZyBkaWZmZXJlbmNlIHdpdGggb3VyIGNvbnRyYWN0J3MgYmFsYW5jZSBhbmQgYWN0dWFsIHByaXplIHBvb2wuCiAgICAvLyBTbyB0aGUgZXRoZXJldW0gdGhhdCB0aGUgd2lubmVycyBkaWRuJ3QgZ2V0IG92ZXIgYXQgbGVhc3QgMSB5ZWFyIHdpbGwgYmUgdXNlZCBmb3Igb3VyIGNoYXJpdHkgYnVzaW5lc3MuCiAgICAvLyBXZSBzdHJvbmdseSBob3BlIHdpbm5lcnMgZ2V0IHRoZWlyIHByaXplIGFmdGVyIHRoZSBnYW1lLgogICAgZnVuY3Rpb24gbG9zc1RvQ2hhcml0eSh1aW50IHllYXIsYWRkcmVzcyBjaGFyaXR5QWNjb3VudCkgb25seUF1dGggewogICAgICAgIGV0aFRyYW5zZmVyKGNoYXJpdHlBY2NvdW50LCBnYW1lcy5sb3NzVG9DaGFyaXR5KHllYXIpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFyaXR5QW10VG9DaGFyaXR5KGFkZHJlc3MgY2hhcml0eUFjY291bnQpIG9ubHlPd25lciB7CiAgICAgICAgZXRoVHJhbnNmZXIoY2hhcml0eUFjY291bnQsIGdhbWVzLmNoYXJpdHlBbXRUb0NoYXJpdHkoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVRva2VuU2FsZSh1aW50IGhvdXIsIHVpbnQgbW9udGgsIHVpbnQgeWVhciwgdWludCBjaGFyaXR5KSBvbmx5QXV0aHsKICAgICAgICBnYW1lcy5kaXN0cmlidXRlVG9rZW5TYWxlKGhvdXIsIG1vbnRoLCB5ZWFyLCBjaGFyaXR5KTsKICAgIH0KCn0='.
	

]
