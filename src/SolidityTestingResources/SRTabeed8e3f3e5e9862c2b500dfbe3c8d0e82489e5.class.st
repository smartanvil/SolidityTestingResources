Class {
	#name : #SRTabeed8e3f3e5e9862c2b500dfbe3c8d0e82489e5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTabeed8e3f3e5e9862c2b500dfbe3c8d0e82489e5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgTGltaXRlZFRyYW5zZmVyVG9rZW4gaXMgRVJDMjAgewoKICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGl0IGNhbiB0cmFuc2ZlciBvciBvdGhlcndpc2UgdGhyb3dzLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludDI1NiBfdmFsdWUpIHsKICAgcmVxdWlyZShfdmFsdWUgPD0gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSk7CiAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVmYXVsdCB0cmFuc2ZlcmFibGUgdG9rZW5zIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRva2VucyBmb3IgYSBob2xkZXIgKG5vIGxpbWl0KS4KICAgKiBAZGV2IE92ZXJ3cml0aW5nIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGlzIHRoZSB3YXkgdG8gcHJvdmlkZSB0aGUKICAgKiBzcGVjaWZpYyBsb2dpYyBmb3IgbGltaXRpbmcgdG9rZW4gdHJhbnNmZXJhYmlsaXR5IGZvciBhIGhvbGRlciBvdmVyIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgLyp0aW1lKi8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7CiAgfQp9CgpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgQ2FuUmVjbGFpbVRva2VuIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLyoqCiAgICogQGRldiBSZWNsYWltIGFsbCBFUkMyMEJhc2ljIGNvbXBhdGlibGUgdG9rZW5zCiAgICogQHBhcmFtIHRva2VuIEVSQzIwQmFzaWMgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbVRva2VuKEVSQzIwQmFzaWMgdG9rZW4pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogIH0KCn0KCmNvbnRyYWN0IEhhc05vRXRoZXIgaXMgT3duYWJsZSB7CgogIC8qKgogICogQGRldiBDb25zdHJ1Y3RvciB0aGF0IHJlamVjdHMgaW5jb21pbmcgRXRoZXIKICAqIEBkZXYgVGhlIGBwYXlhYmxlYCBmbGFnIGlzIGFkZGVkIHNvIHdlIGNhbiBhY2Nlc3MgYG1zZy52YWx1ZWAgd2l0aG91dCBjb21waWxlciB3YXJuaW5nLiBJZiB3ZQogICogbGVhdmUgb3V0IHBheWFibGUsIHRoZW4gU29saWRpdHkgd2lsbCBhbGxvdyBpbmhlcml0aW5nIGNvbnRyYWN0cyB0byBpbXBsZW1lbnQgYSBwYXlhYmxlCiAgKiBjb25zdHJ1Y3Rvci4gQnkgZG9pbmcgaXQgdGhpcyB3YXkgd2UgcHJldmVudCBhIHBheWFibGUgY29uc3RydWN0b3IgZnJvbSB3b3JraW5nLiBBbHRlcm5hdGl2ZWx5CiAgKiB3ZSBjb3VsZCB1c2UgYXNzZW1ibHkgdG8gYWNjZXNzIG1zZy52YWx1ZS4KICAqLwogIGZ1bmN0aW9uIEhhc05vRXRoZXIoKSBwYXlhYmxlIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogIH0KCiAgLyoqCiAgICogQGRldiBEaXNhbGxvd3MgZGlyZWN0IHNlbmQgYnkgc2V0dGluZ3MgYSBkZWZhdWx0IGZ1bmN0aW9uIHdpdGhvdXQgdGhlIGBwYXlhYmxlYCBmbGFnLgogICAqLwogIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgewogIH0KCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciBhbGwgRXRoZXIgaGVsZCBieSB0aGUgY29udHJhY3QgdG8gdGhlIG93bmVyLgogICAqLwogIGZ1bmN0aW9uIHJlY2xhaW1FdGhlcigpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBhc3NlcnQob3duZXIuc2VuZCh0aGlzLmJhbGFuY2UpKTsKICB9Cn0KCmNvbnRyYWN0IEhhc05vVG9rZW5zIGlzIENhblJlY2xhaW1Ub2tlbiB7CgogLyoqCiAgKiBAZGV2IFJlamVjdCBhbGwgRVJDMjMgY29tcGF0aWJsZSB0b2tlbnMKICAgICoqLwogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyAvKmZyb21fKi8sIHVpbnQyNTYgLyp2YWx1ZV8qLywgYnl0ZXMgLypkYXRhXyovKSBleHRlcm5hbCB7CiAgICByZXZlcnQoKTsKICB9Cgp9Cgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICB9Cn0KCmNvbnRyYWN0IFJlZ3VsYXRlZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlVG9rZW4sIExpbWl0ZWRUcmFuc2ZlclRva2VuLCBIYXNOb0V0aGVyLCBIYXNOb1Rva2VucyB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CiAgICB1aW50MjU2IGNvbnN0YW50IE1BWF9MT0NLU19QRVJfQUREUkVTUyA9IDIwOwoKICAgIGVudW0gUmVkZWVtUmVhc29ue1JlZ3VsYXRvcnlSZWRlbXB0aW9uLCBCdXliYWNrLCBPdGhlcn0KICAgIGVudW0gTG9ja1JlYXNvbntQcmVJQ08sIFZlc3RpbmcsIFVTUGVyc29uLCBGdW5kT3JpZ2luYXRlZCwgT3RoZXJ9CgogICAgc3RydWN0IFRva2VuTG9jayB7CiAgICAgICAgdWludDY0IGlkOwogICAgICAgIExvY2tSZWFzb24gcmVhc29uOwogICAgICAgIHVpbnQyNTYgdmFsdWU7CiAgICAgICAgdWludDY0IGF1dG9SZWxlYXNlVGltZTsgICAgICAgLy9NYXkgYmUgMCwgZm9yIG5vIHJlbGVhc2UgdGltZQogICAgfQoKICAgIHN0cnVjdCBUb2tlblJlZGVtcHRpb24gewogICAgICAgIHVpbnQ2NCByZWRlbXB0aW9uSWQ7CiAgICAgICAgUmVkZWVtUmVhc29uIHJlYXNvbjsKICAgICAgICB1aW50MjU2IHZhbHVlOwogICAgfQoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsSW5hY3RpdmU7CiAgICB1aW50NjQgcHJpdmF0ZSBsb2NrQ291bnRlciA9IDE7CgogICAgLy90b2tlbiBhZG1pbnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIGFkbWluczsKCiAgICAvL2xvY2tzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gVG9rZW5Mb2NrW10pIHByaXZhdGUgbG9ja3M7CgogICAgLy9idXJuIHdhbGxldHMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIGJ1cm5XYWxsZXRzOwoKICAgIC8vUmVkZW1wdGlvbnMgbWFkZSBmb3IgdXNlcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBUb2tlblJlZGVtcHRpb25bXSkgcHJpdmF0ZSB0b2tlblJlZGVtcHRpb25zOwoKICAgIGV2ZW50IElzc3VlZChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmFsdWVMb2NrZWQpOwogICAgZXZlbnQgTG9ja2VkKGFkZHJlc3MgaW5kZXhlZCB3aG8sIHVpbnQyNTYgdmFsdWUsIExvY2tSZWFzb24gcmVhc29uLCB1aW50IHJlbGVhc2VUaW1lLCB1aW50NjQgbG9ja0lkKTsKICAgIGV2ZW50IFVubG9ja2VkKGFkZHJlc3MgaW5kZXhlZCB3aG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQ2NCBsb2NrSWQpOwogICAgZXZlbnQgQWRkZWRCdXJuV2FsbGV0KGFkZHJlc3MgaW5kZXhlZCBidXJuV2FsbGV0KTsKICAgIGV2ZW50IFJlZGVlbWVkKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgYnVybldhbGxldCwgdWludDI1NiB2YWx1ZSwgUmVkZWVtUmVhc29uIHJlYXNvbiwgdWludDY0IGluZGV4ZWQgcmVkZW1wdGlvbklkKTsKICAgIGV2ZW50IEJ1cm5lZChhZGRyZXNzIGluZGV4ZWQgYnVybldhbGxldCwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBEZXN0cm95ZWQoKTsKICAgIGV2ZW50IEFkbWluQWRkZWQoYWRkcmVzcyBhZG1pbik7CiAgICBldmVudCBBZG1pblJlbW92ZWQoYWRkcmVzcyBhZG1pbik7CgoKCiAgICAvKioKICAgICogQGRldiBkZXN0cm95cyB0aGUgdG9rZW4KICAgICogT25seSB3b3JrcyBmcm9tIHRoZSBvd25lciwgYW5kIHdoZW4gdGhlIHRvdGFsIGJhbGFuY2Ugb2YgYWxsIHVzZXJzIGlzIDAgKG5vYm9keSBoYXMgdG9rZW5zKS4KICAgICovCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh0b3RhbFN1cHBseSA9PSAwKTsKICAgICAgICBEZXN0cm95ZWQoKTsKICAgICAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogICAgfQoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgQ09OVFJBQ1QgQURNSU4KCiAgICAgICAgVGhlIGNvbnRyYWN0IGNhbiBoYXZlIDAgb3IgbW9yZSBhZG1pbnMKICAgICAgICBzb21lIGZ1bmN0aW9ucyBhcmUgYWNjZXNzaWJsZSBvbiB0aGUgYWRtaW4gbGV2ZWwgcmF0aGVyIHRoYW4gdGhlIG93bmVyIGxldmVsCiAgICAgICAgdGhlIG93bmVyIGlzIGFsd2F5cyBhbiBhZG1pbgogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgZnVuY3Rpb24gYWRkQWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgb25seU93bmVyIHB1YmxpY3sKICAgICAgICBhZG1pbnNbX2FkZHJlc3NdID0gdHJ1ZTsKICAgICAgICBBZG1pbkFkZGVkKF9hZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSBvbmx5T3duZXIgcHVibGljewogICAgICAgIGFkbWluc1tfYWRkcmVzc10gPSBmYWxzZTsKICAgICAgICBBZG1pblJlbW92ZWQoX2FkZHJlc3MpOwogICAgfQogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIGFuIGFkbWluLgogICAgKi8KICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgYWRtaW5zW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgVE9LRU4gSVNTVUlORwogICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIC8qKgogICAgKiBAZGV2IElzc3VlcyB1bmxvY2tlZCB0b2tlbnMKICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIGlzIGdvaW5nIHRvIHJlY2VpdmUgdGhlIG5ld2x5IGlzc3VlZCB0b2tlbnMKICAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSB2YWx1ZSBvZiB0b2tlbnMgdG8gaXNzdWUKICAgICogQHJldHVybiB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgICovCgogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5QWRtaW4gcHVibGljIHJldHVybnMgKGJvb2wpewogICAgICAgIGlzc3VlVG9rZW5zV2l0aExvY2tpbmcoX3RvLCBfdmFsdWUsIDAsIExvY2tSZWFzb24uT3RoZXIsIDApOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IElzc3VpbmcgdG9rZW5zIGZyb20gdGhlIGZ1bmQKICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIGlzIGdvaW5nIHRvIHJlY2VpdmUgdGhlIG5ld2x5IGlzc3VlZCB0b2tlbnMKICAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSB2YWx1ZSBvZiB0b2tlbnMgdG8gaXNzdWUKICAgICogQHBhcmFtIF92YWx1ZUxvY2tlZCB1aW50MjU2IHZhbHVlIG9mIHRva2VucywgZnJvbSB0aG9zZSBpc3N1ZWQsIHRvIGxvY2sgaW1tZWRpYXRlbHkuCiAgICAqIEBwYXJhbSBfd2h5IHJlYXNvbiBmb3IgdG9rZW4gbG9ja2luZwogICAgKiBAcGFyYW0gX3JlbGVhc2VUaW1lIHRpbWVzdGFtcCB0byByZWxlYXNlIHRoZSBsb2NrIChvciAwIGZvciBsb2NrcyB3aGljaCBjYW4gb25seSByZWxlYXNlZCBieSBhbiB1bmxvY2tUb2tlbnMgY2FsbCkKICAgICogQHJldHVybiB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVRva2Vuc1dpdGhMb2NraW5nKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfdmFsdWVMb2NrZWQsIExvY2tSZWFzb24gX3doeSwgdWludDY0IF9yZWxlYXNlVGltZSkgb25seUFkbWluIHB1YmxpYyByZXR1cm5zIChib29sKXsKCiAgICAgICAgLy9DaGVjayBpbnB1dCB2YWx1ZXMKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlTG9ja2VkID49IDAgJiYgX3ZhbHVlTG9ja2VkIDw9IF92YWx1ZSk7CgogICAgICAgIC8vTWFrZSBzdXJlIHdlIGhhdmUgZW5vdWdoIGluYWN0aXZlIHRva2VucyB0byBpc3N1ZQogICAgICAgIHJlcXVpcmUodG90YWxJbmFjdGl2ZSA+PSBfdmFsdWUpOwoKICAgICAgICAvL0FkZGluZyBhbmQgc3VidHJhY3RpbmcgaXMgZG9uZSB0aHJvdWdoIHNhZmVtYXRoCiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX3ZhbHVlKTsKICAgICAgICB0b3RhbEluYWN0aXZlID0gdG90YWxJbmFjdGl2ZS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKCiAgICAgICAgSXNzdWVkKF90bywgX3ZhbHVlLCBfdmFsdWVMb2NrZWQpOwogICAgICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfdmFsdWUpOwoKICAgICAgICBpZiAoX3ZhbHVlTG9ja2VkID4gMCkgewogICAgICAgICAgICBsb2NrVG9rZW5zKF90bywgX3ZhbHVlTG9ja2VkLCBfd2h5LCBfcmVsZWFzZVRpbWUpOwogICAgICAgIH0KICAgIH0KCgoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBUT0tFTiBMT0NLSU5HCgogICAgICAgIExvY2tpbmcgdG9rZW5zIG1lYW5zIGZyZWV6aW5nIGEgbnVtYmVyIG9mIHRva2VucyBiZWxvbmdpbmcgdG8gYW4gYWRkcmVzcy4KICAgICAgICBMb2NrZWQgdG9rZW5zIGNhbiBub3QgYmUgdHJhbnNmZXJyZWQgYnkgdGhlIHVzZXIgdG8gYW55IG90aGVyIGFkZHJlc3MuCiAgICAgICAgVGhlIGNvbnRyYWN0IG93bmVyICh0aGUgZnVuZCkgbWF5IHN0aWxsIHJlZGVlbSB0aG9zZSB0b2tlbnMsIG9yIHVuZnJlZXplIHRoZW0uCiAgICAgICAgVGhlIHRva2VuIGxvY2sgbWF5IGV4cGlyZSBhdXRvbWF0aWNhbGx5IGF0IGEgY2VydGFpbiB0aW1lc3RhbXAsIG9yIGV4aXN0IGZvcmV2ZXIgdW50aWwgdGhlIG93bmVyIHVubG9ja3MgaXQuCgogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgogICAgLyoqCiAgICAqIEBkZXYgbG9jayB0b2tlbnMKICAgICogQHBhcmFtIF93aG8gYWRkcmVzcyB0byBsb2NrIHRoZSB0b2tlbnMgYXQKICAgICogQHBhcmFtIF92YWx1ZSB2YWx1ZSBvZiB0b2tlbnMgdG8gbG9jawogICAgKiBAcGFyYW0gX3JlYXNvbiByZWFzb24gZm9yIGxvY2sKICAgICogQHBhcmFtIF9yZWxlYXNlVGltZSB0aW1lc3RhbXAgdG8gcmVsZWFzZSB0aGUgbG9jayAob3IgMCBmb3IgbG9ja3Mgd2hpY2ggY2FuIG9ubHkgcmVsZWFzZWQgYnkgYW4gdW5sb2NrVG9rZW5zIGNhbGwpCiAgICAqIEByZXR1cm4gQSB1bmlxdWUgaWQgZm9yIHRoZSBuZXdseSBjcmVhdGVkIGxvY2suCiAgICAqIE5vdGU6IFRoZSB1c2VyIE1BWSBoYXZlIGF0IGEgY2VydGFpbiB0aW1lIG1vcmUgbG9ja2VkIHRva2VucyB0aGFuIGFjdHVhbCB0b2tlbnMKICAgICovCiAgICBmdW5jdGlvbiBsb2NrVG9rZW5zKGFkZHJlc3MgX3dobywgdWludCBfdmFsdWUsIExvY2tSZWFzb24gX3JlYXNvbiwgdWludDY0IF9yZWxlYXNlVGltZSkgb25seUFkbWluIHB1YmxpYyByZXR1cm5zICh1aW50NjQpewogICAgICAgIHJlcXVpcmUoX3dobyAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX3JlbGVhc2VUaW1lID09IDAgfHwgX3JlbGVhc2VUaW1lID4gdWludDY0KG5vdykpOwogICAgICAgIC8vT25seSBhbGxvdyAyMCBsb2NrcyBwZXIgYWRkcmVzcywgdG8gcHJldmVudCBvdXQtb2YtZ2FzIGF0IHRyYW5zZmVyIHNjZW5hcmlvcwogICAgICAgIHJlcXVpcmUobG9ja3NbX3dob10ubGVuZ3RoIDwgTUFYX0xPQ0tTX1BFUl9BRERSRVNTKTsKCiAgICAgICAgdWludDY0IGxvY2tJZCA9IGxvY2tDb3VudGVyKys7CgogICAgICAgIC8vQ3JlYXRlIHRoZSBsb2NrCiAgICAgICAgbG9ja3NbX3dob10ucHVzaChUb2tlbkxvY2sobG9ja0lkLCBfcmVhc29uLCBfdmFsdWUsIF9yZWxlYXNlVGltZSkpOwogICAgICAgIExvY2tlZChfd2hvLCBfdmFsdWUsIF9yZWFzb24sIF9yZWxlYXNlVGltZSwgbG9ja0lkKTsKCiAgICAgICAgcmV0dXJuIGxvY2tJZDsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBSZWxlYXNlcyBhIHNwZWNpZmljIHRva2VuIGxvY2sKICAgICogQHBhcmFtIF93aG8gYWRkcmVzcyB0byByZWxlYXNlIHRoZSB0b2tlbnMgZm9yCiAgICAqIEBwYXJhbSBfbG9ja0lkIHRoZSB1bmlxdWUgbG9jay1pZCB0byByZWxlYXNlCiAgICAqCiAgICAqIG5vdGUgLSB0aGlzIG1heSBjaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSBsb2NrcyBvbiBhbiBhZGRyZXNzLCBzbyBpZiBpdGVyYXRpbmcgdGhlIGl0ZXJhdGlvbiBzaG91bGQgYmUgcmVzdGFydGVkLgogICAgKiBAcmV0dXJuIHRydWUgb24gc3VjY2VzcwogICAgKi8KICAgIGZ1bmN0aW9uIHVubG9ja1Rva2VucyhhZGRyZXNzIF93aG8sIHVpbnQ2NCBfbG9ja0lkKSBvbmx5QWRtaW4gcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF93aG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfbG9ja0lkID4gMCk7CgogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBsb2Nrc1tfd2hvXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobG9ja3NbX3dob11baV0uaWQgPT0gX2xvY2tJZCkgewogICAgICAgICAgICAgICAgVW5sb2NrZWQoX3dobywgbG9ja3NbX3dob11baV0udmFsdWUsIF9sb2NrSWQpOwogICAgICAgICAgICAgICAgZGVsZXRlIGxvY2tzW193aG9dW2ldOwogICAgICAgICAgICAgICAgbG9ja3NbX3dob11baV0gPSBsb2Nrc1tfd2hvXVtsb2Nrc1tfd2hvXS5sZW5ndGguc3ViKDEpXTsKICAgICAgICAgICAgICAgIGxvY2tzW193aG9dLmxlbmd0aCAtPSAxOwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBHZXQgbnVtYmVyIG9mIGxvY2tzIGN1cnJlbnRseSBhc3NvY2lhdGVkIHdpdGggYW4gYWRkcmVzcwogICAgKiBAcGFyYW0gX3dobyBhZGRyZXNzIHRvIGdldCB0b2tlbiBsb2NrIGZvcgogICAgKgogICAgKiBAcmV0dXJuIG51bWJlciBvZiBsb2NrcwogICAgKgogICAgKiBOb3RlIC0gYSBsb2NrIGNhbiBiZSBpbmFjdGl2ZSAoZHVlIHRvIGl0cyB0aW1lIGV4cGlyZWQpIGJ1dCBzdGlsbCBleGlzdHMgZm9yIGEgc3BlY2lmaWMgYWRkcmVzcwogICAgKi8KICAgIGZ1bmN0aW9uIGxvY2tDb3VudChhZGRyZXNzIF93aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCl7CiAgICAgICAgcmVxdWlyZShfd2hvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJldHVybiB1aW50OChsb2Nrc1tfd2hvXS5sZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEdldCBkZXRhaWxzIG9mIGEgc3BlY2lmaWMgbG9jayBhc3NvY2lhdGVkIHdpdGggYW4gYWRkcmVzcwogICAgKiBjYW4gYmUgdXNlZCB0byBpdGVyYXRlIHRocm91Z2ggdGhlIGxvY2tzIG9mIGEgdXNlcgogICAgKiBAcGFyYW0gX3dobyBhZGRyZXNzIHRvIGdldCB0b2tlbiBsb2NrIGZvcgogICAgKiBAcGFyYW0gX2luZGV4IHRoZSAwIGJhc2VkIGluZGV4IG9mIHRoZSBsb2NrLgogICAgKiBAcmV0dXJuIGlkIHRoZSB1bmlxdWUgbG9jayBpZAogICAgKiBAcmV0dXJuIHJlYXNvbiB0aGUgcmVhc29uIGZvciB0aGUgbG9jawogICAgKiBAcmV0dXJuIHZhbHVlIHRoZSB2YWx1ZSBvZiB0b2tlbnMgbG9ja2VkCiAgICAqIEByZXR1cm4gdGhlIHRpbWVzdGFtcCBpbiB3aGljaCB0aGUgbG9jayB3aWxsIGJlIGluYWN0aXZlIChvciAwIGlmIGl0J3MgYWx3YXlzIGFjdGl2ZSB1bnRpbCByZW1vdmVkKQogICAgKgogICAgKiBOb3RlIC0gYSBsb2NrIGNhbiBiZSBpbmFjdGl2ZSAoZHVlIHRvIGl0cyB0aW1lIGV4cGlyZWQpIGJ1dCBzdGlsbCBleGlzdHMgZm9yIGEgc3BlY2lmaWMgYWRkcmVzcwogICAgKi8KICAgIGZ1bmN0aW9uIGxvY2tJbmZvKGFkZHJlc3MgX3dobywgdWludDY0IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCBpZCwgdWludDggcmVhc29uLCB1aW50IHZhbHVlLCB1aW50NjQgYXV0b1JlbGVhc2VUaW1lKXsKICAgICAgICByZXF1aXJlKF93aG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfaW5kZXggPCBsb2Nrc1tfd2hvXS5sZW5ndGgpOwogICAgICAgIGlkID0gbG9ja3NbX3dob11bX2luZGV4XS5pZDsKICAgICAgICByZWFzb24gPSB1aW50OChsb2Nrc1tfd2hvXVtfaW5kZXhdLnJlYXNvbik7CiAgICAgICAgdmFsdWUgPSBsb2Nrc1tfd2hvXVtfaW5kZXhdLnZhbHVlOwogICAgICAgIGF1dG9SZWxlYXNlVGltZSA9IGxvY2tzW193aG9dW19pbmRleF0uYXV0b1JlbGVhc2VUaW1lOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRyYW5zZmVyYWJsZSAobm90IGxvY2tlZCkgdG9rZW5zIHRoZSB1c2VyIGhhcyBhdCBhIHNwZWNpZmljIHRpbWUKICAgICogdXNlZCBieSB0aGUgTGltaXRlZFRyYW5zZmVyVG9rZW4gYmFzZSBjbGFzcyB0byBibG9jayBFUkMyMCB0cmFuc2ZlciBmb3IgbG9ja2VkIHRva2VucwogICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgdG8gZ2V0IHRyYW5zZmVyYWJsZSBjb3VudCBmb3IKICAgICogQHBhcmFtIHRpbWUgYmxvY2sgdGltZXN0YW1wIHRvIGNoZWNrIHRpbWUtbG9ja3Mgd2l0aC4KICAgICogQHJldHVybiB0b3RhbCBudW1iZXIgb2YgdW5sb2NrZWQsIHRyYW5zZmVyYWJsZSB0b2tlbnMKICAgICoKICAgICogTm90ZSAtIHRoZSB0aW1lc3RhbXAgaXMgb25seSB1c2VkIHRvIGNoZWNrIHRpbWUtbG9ja3MsIHRoZSBiYXNlIGJhbGFuY2UgdXNlZCB0byBjaGVjayBpcyBhbHdheXMgdGhlIGN1cnJlbnQgb25lLgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZSh0aW1lID4gMCk7CgogICAgICAgIC8vSWYgaXQncyBhIGJ1cm4gd2FsbGV0LCB0b2tlbnMgY2Fubm90IGJlIG1vdmVkIG91dAogICAgICAgIGlmIChpc0J1cm5XYWxsZXQoaG9sZGVyKSl7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludDggaG9sZGVyTG9ja0NvdW50ID0gdWludDgobG9ja3NbaG9sZGVyXS5sZW5ndGgpOwoKICAgICAgICAvL05vIGxvY2tzLCBnbyB0byBiYXNlIGNsYXNzIGltcGxlbWVudGF0aW9uCiAgICAgICAgaWYgKGhvbGRlckxvY2tDb3VudCA9PSAwKSByZXR1cm4gc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSk7CgogICAgICAgIHVpbnQyNTYgdG90YWxMb2NrZWRUb2tlbnMgPSAwOwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBob2xkZXJMb2NrQ291bnQ7IGkgKyspIHsKCiAgICAgICAgICAgIGlmIChsb2Nrc1tob2xkZXJdW2ldLmF1dG9SZWxlYXNlVGltZSA9PSAwIHx8IGxvY2tzW2hvbGRlcl1baV0uYXV0b1JlbGVhc2VUaW1lID4gdGltZSkgewogICAgICAgICAgICAgICAgdG90YWxMb2NrZWRUb2tlbnMgPSBTYWZlTWF0aC5hZGQodG90YWxMb2NrZWRUb2tlbnMsIGxvY2tzW2hvbGRlcl1baV0udmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHVpbnQgYmFsYW5jZU9mSG9sZGVyID0gYmFsYW5jZU9mKGhvbGRlcik7CgogICAgICAgIC8vdGhlcmUgbWF5IGJlIG1vcmUgbG9ja2VkIHRva2VucyB0aGFuIGFjdHVhbCB0b2tlbnMsIHNvIHRoZSBtaW5pbXVtIGJldHdlZW4gdGhlIHR3bwogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlID0gU2FmZU1hdGguc3ViKGJhbGFuY2VPZkhvbGRlciwgTWF0aC5taW4yNTYodG90YWxMb2NrZWRUb2tlbnMsIGJhbGFuY2VPZkhvbGRlcikpOwoKICAgICAgICAvL0NoZWNrIHdpdGggc3VwZXIgaW1wbGVtZW50YXRpb24gZm9yIGZ1cnRoZXIgcmVkdWN0aW9ucwogICAgICAgIHJldHVybiBNYXRoLm1pbjI1Nih0cmFuc2ZlcmFibGUsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICAgIH0KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgUkVERU1QVElPTiBBTkQgQlVSTklORwoKICAgICAgICBSZWRlZW1pbmcgdG9rZW5zIGludm9sdmVzIHJlbW92aW5nIHRoZW0gZnJvbSBhbiBhZGRyZXNzJ3Mgd2FsbGV0IGFuZCBtb3ZpbmcgdGhlbSB0byBhIChvbmUgb3IgbW9yZSkKICAgICAgICBzcGVjaWFsbHkgZGVzaWduZWQgImJ1cm4gd2FsbGV0cyIuCiAgICAgICAgVGhlIHByb2Nlc3MgaXMgaW1wbGVtZW50ZWQgc3VjaCBhcyB0aGUgb3duZXIgY2FuIGNob29zZSB0byBidXJuIG9yIG5vdCB0byBidXJuIHRoZSB0b2tlbnMgYWZ0ZXIgcmVkZWVtaW5nIHRoZW0sCiAgICAgICAgd2hpY2ggaXMgbGVnYWxseSBuZWNlc3Nhcnkgb24gc29tZSBidXktYmFjayBzY2VuYXJpb3MKICAgICAgICBFYWNoIHJlZGVtcHRpb24gaXMgYXNzb2NpYXRlZCB3aXRoIGEgZ2xvYmFsICJyZWRlbXB0aW9uIGV2ZW50IiAoYSB1bmlxdWUgaWQsIHN1cHBsaWVkIGJ5IHRoZSBvd25lciksCiAgICAgICAgd2hpY2ggY2FuIGxhdGVyIGJlIHVzZWQgdG8gcXVlcnkgdGhlIHRvdGFsIHZhbHVlIHJlZGVlbWVkIGZvciB0aGUgdXNlciBpbiB0aGlzIGV2ZW50IChhbmQgb24gdGhlIG93bmVyJ3MKICAgICAgICBiYWNrZW5kLCB0aHJvdWdoIGV2ZW50IGxvZ3MgcHJvY2Vzc2luZywgdGhlIHRvdGFsIHZhbHVlIHJlZGVlbWVkIGZvciBhbGwgdXNlcnMgaW4gdGhpcyBldmVudCkKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIC8qKgogICAgKiBAZGV2IGRlc2lnbmF0ZXMgYW4gYWRkcmVzcyBhcyBhIGJ1cm4gd2FsbGV0ICh0aGVyZSBjYW4gYmUgYW4gdW5saW1pdGVkIG51bWJlciBvZiBidXJuIHdhbGxldHMpLgogICAgKiBhIGJ1cm4gd2FsbGV0IGNhbiBvbmx5IGJ1cm4gdG9rZW5zIC0gdG9rZW5zIG1heSBub3QgYmUgdHJhbnNmZXJyZWQgb3V0IG9mIGl0LCBhbmQgdG9rZW5zIGRvIG5vdCBwYXJ0aWNpcGF0ZQogICAgKiBpbiByZWRlbXB0aW9ucwogICAgKiBAcGFyYW0gX2J1cm5XYWxsZXRBZGRyZXNzIHRoZSBhZGRyZXNzIHRvIGFkZCB0byB0aGUgYnVybiB3YWxsZXQgbGlzdAogICAgKi8KICAgIGZ1bmN0aW9uIGFkZEJ1cm5XYWxsZXQoYWRkcmVzcyBfYnVybldhbGxldEFkZHJlc3MpIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShfYnVybldhbGxldEFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYnVybldhbGxldHNbX2J1cm5XYWxsZXRBZGRyZXNzXSA9IHRydWU7CiAgICAgICAgQWRkZWRCdXJuV2FsbGV0KF9idXJuV2FsbGV0QWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgcmVkZWVtcyAocmVtb3ZlcykgdG9rZW5zIGZvciBhbiBhZGRyZXNzIGFuZCBtb3ZlcyB0byB0byBhIGJ1cm4gd2FsbGV0CiAgICAqIEBwYXJhbSBfZnJvbSB0aGUgYWRkcmVzcyB0byByZWRlZW0gdG9rZW5zIGZyb20KICAgICogQHBhcmFtIF9idXJuV2FsbGV0IHRoZSBidXJuIHdhbGxldCB0byBtb3ZlIHRoZSB0b2tlbnMgdG8KICAgICogQHBhcmFtIF9yZWFzb24gdGhlIHJlYXNvbiBmb3IgdGhlIHJlZGVtcHRpb24KICAgICogQHBhcmFtIF9yZWRlbXB0aW9uSWQgYSByZWRlbXB0aW9uSWQsIHN1cHBsaWVkIGJ5IHRoZSBjb250cmFjdCBvd25lci4gdXN1YWxseSBhc3NpZ25lZCB0byBhIHNpbmdsZSBnbG9iYWwKICAgICogcmVkZW1wdGlvbiBldmVudCAodG9rZW4gYnV5YmFjaywgb3Igc3VjaCkuCiAgICAqLwogICAgZnVuY3Rpb24gcmVkZWVtVG9rZW5zKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX2J1cm5XYWxsZXQsIHVpbnQyNTYgX3ZhbHVlLCBSZWRlZW1SZWFzb24gX3JlYXNvbiwgdWludDY0IF9yZWRlbXB0aW9uSWQpIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShfZnJvbSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9yZWRlbXB0aW9uSWQgPiAwKTsKICAgICAgICByZXF1aXJlKGlzQnVybldhbGxldChfYnVybldhbGxldCkpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW19idXJuV2FsbGV0XSA9IGJhbGFuY2VzW19idXJuV2FsbGV0XS5hZGQoX3ZhbHVlKTsKICAgICAgICB0b2tlblJlZGVtcHRpb25zW19mcm9tXS5wdXNoKFRva2VuUmVkZW1wdGlvbihfcmVkZW1wdGlvbklkLCBfcmVhc29uLCBfdmFsdWUpKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX2J1cm5XYWxsZXQsIF92YWx1ZSk7CiAgICAgICAgUmVkZWVtZWQoX2Zyb20sIF9idXJuV2FsbGV0LCBfdmFsdWUsIF9yZWFzb24sIF9yZWRlbXB0aW9uSWQpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEJ1cm5zIHRva2VucyBpbnNpZGUgYSBidXJuIHdhbGxldAogICAgKiBUaGUgdG90YWwgbnVtYmVyIG9mIGluYWN0aXZlIHRva2VuIGlzIE5PVCBpbmNyZWFzZWQKICAgICogdGhpcyBtZWFucyB0aGVyZSBpcyBhIGZpbml0ZSBudW1iZXIgYW1vdW50IHRoYXQgY2FuIGV2ZXIgZXhpc3Qgb2YgdGhpcyB0b2tlbgogICAgKiBAcGFyYW0gX2J1cm5XYWxsZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIGJ1cm4gd2FsbGV0CiAgICAqIEBwYXJhbSBfdmFsdWUgdmFsdWUgb2YgdG9rZW5zIHRvIGJ1cm4KICAgICovCiAgICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgX2J1cm5XYWxsZXQsIHVpbnQyNTYgX3ZhbHVlKSBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShpc0J1cm5XYWxsZXQoX2J1cm5XYWxsZXQpKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19idXJuV2FsbGV0XSA+PSBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW19idXJuV2FsbGV0XSA9IGJhbGFuY2VzW19idXJuV2FsbGV0XS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIEJ1cm5lZChfYnVybldhbGxldCwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfYnVybldhbGxldCwweDAsX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBjaGVja3MgaWYgYSB3YWxsZXQgaXMgYSBidXJuIHdhbGxldAogICAgKiBAcGFyYW0gX2J1cm5XYWxsZXRBZGRyZXNzIGFkZHJlc3MgdG8gY2hlY2sKICAgICovCiAgICBmdW5jdGlvbiBpc0J1cm5XYWxsZXQoYWRkcmVzcyBfYnVybldhbGxldEFkZHJlc3MpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKXsKICAgICAgICByZXR1cm4gYnVybldhbGxldHNbX2J1cm5XYWxsZXRBZGRyZXNzXTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBnZXRzIG51bWJlciBvZiByZWRlbXB0aW9ucyBkb25lIG9uIGEgc3BlY2lmaWMgYWRkcmVzcwogICAgKiBAcGFyYW0gX3dobyBhZGRyZXNzIHRvIGNoZWNrCiAgICAqLwogICAgZnVuY3Rpb24gcmVkZW1wdGlvbkNvdW50KGFkZHJlc3MgX3dobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCl7CiAgICAgICAgcmVxdWlyZShfd2hvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJldHVybiB1aW50NjQodG9rZW5SZWRlbXB0aW9uc1tfd2hvXS5sZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGdldHMgZGF0YSBhYm91dCBhIHNwZWNpZmljIHJlZGVtcHRpb24gZG9uZSBvbiBhIHNwZWNpZmljIGFkZHJlc3MKICAgICogQHBhcmFtIF93aG8gYWRkcmVzcyB0byBjaGVjawogICAgKiBAcGFyYW0gX2luZGV4IHplcm8gYmFzZWQgaW5kZXggb2YgdGhlIHJlZGVtcHRpb24KICAgICogQHJldHVybiByZWRlbXB0aW9uSWQgdGhlIGdsb2JhbCByZWRlbXB0aW9uSWQgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcmVkZW1wdGlvbgogICAgKiBAcmV0dXJuIHJlYXNvbiB0aGUgcmVhc29uIGZvciB0aGUgcmVkZW1wdGlvbgogICAgKiBAcmV0dXJuIHZhbHVlIHRoZSB2YWx1ZSBmb3IgdGhlIHJlZGVtcHRpb24KICAgICovCiAgICBmdW5jdGlvbiByZWRlbXB0aW9uSW5mbyhhZGRyZXNzIF93aG8sIHVpbnQ2NCBfaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50NjQgcmVkZW1wdGlvbklkLCB1aW50OCByZWFzb24sIHVpbnQgdmFsdWUpewogICAgICAgIHJlcXVpcmUoX3dobyAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IHRva2VuUmVkZW1wdGlvbnNbX3dob10ubGVuZ3RoKTsKICAgICAgICByZWRlbXB0aW9uSWQgPSB0b2tlblJlZGVtcHRpb25zW193aG9dW19pbmRleF0ucmVkZW1wdGlvbklkOwogICAgICAgIHJlYXNvbiA9IHVpbnQ4KHRva2VuUmVkZW1wdGlvbnNbX3dob11bX2luZGV4XS5yZWFzb24pOwogICAgICAgIHZhbHVlID0gdG9rZW5SZWRlbXB0aW9uc1tfd2hvXVtfaW5kZXhdLnZhbHVlOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGdldHMgdGhlIHRvdGFsIHZhbHVlIHJlZGVtZWVkIGZyb20gYSBzcGVjaWZpYyBhZGRyZXNzLCBmb3IgYSBzaW5nbGUgZ2xvYmFsIHJlZGVtcHRpb24gZXZlbnQKICAgICogQHBhcmFtIF93aG8gYWRkcmVzcyB0byBjaGVjawogICAgKiBAcGFyYW0gX3JlZGVtcHRpb25JZCB0aGUgZ2xvYmFsIHJlZGVtcHRpb24gZXZlbnQgaWQKICAgICogQHJldHVybiB0aGUgdG90YWwgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRoZSByZWRlbXB0aW9uIGV2ZW50CiAgICAqLwoKICAgIGZ1bmN0aW9uIHRvdGFsUmVkZW1wdGlvbklkVmFsdWUoYWRkcmVzcyBfd2hvLCB1aW50NjQgX3JlZGVtcHRpb25JZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJlcXVpcmUoX3dobyAhPSBhZGRyZXNzKDApKTsKICAgICAgICB1aW50MjU2IHRvdGFsID0gMDsKICAgICAgICB1aW50NjQgbnVtYmVyT2ZSZWRlbXB0aW9ucyA9IHJlZGVtcHRpb25Db3VudChfd2hvKTsKICAgICAgICBmb3IgKHVpbnQ2NCBpID0gMDsgaSA8IG51bWJlck9mUmVkZW1wdGlvbnM7IGkrKykgewogICAgICAgICAgICBpZiAodG9rZW5SZWRlbXB0aW9uc1tfd2hvXVtpXS5yZWRlbXB0aW9uSWQgPT0gX3JlZGVtcHRpb25JZCkgewogICAgICAgICAgICAgICAgdG90YWwgPSBTYWZlTWF0aC5hZGQodG90YWwsIHRva2VuUmVkZW1wdGlvbnNbX3dob11baV0udmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b3RhbDsKICAgIH0KCn0KCmNvbnRyYWN0IFNwaWNlVG9rZW4gaXMgUmVndWxhdGVkVG9rZW4gewoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJTUGlDRSBWQyBUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJTUElDRSI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSA4OwogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IElOSVRJQUxfSU5BQ1RJVkVfVE9LRU5TID0gMTMwICogMTAwMDAwMCAqICgxMCAqKiB1aW50MjU2KGRlY2ltYWxzKSk7ICAvLzEzMCBtaWxsaW9uIHRva2VucwoKCiAgICBmdW5jdGlvbiBTcGljZVRva2VuKCkgUmVndWxhdGVkVG9rZW4oKSB7CiAgICAgICAgdG90YWxJbmFjdGl2ZSA9IElOSVRJQUxfSU5BQ1RJVkVfVE9LRU5TOwogICAgICAgIHRvdGFsU3VwcGx5ID0gMDsKICAgIH0KCn0='.
	

]
