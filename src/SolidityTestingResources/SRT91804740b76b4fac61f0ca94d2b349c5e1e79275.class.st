Class {
	#name : #SRT91804740b76b4fac61f0ca94d2b349c5e1e79275,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT91804740b76b4fac61f0ca94d2b349c5e1e79275 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogSm91bGUgc291cmNlIGNvZGVzIGFyZSBhdmFpbGFibGUgYXQgaHR0cHM6Ly9naXRodWIuY29tL015V2lzaFBsYXRmb3JtL2pvdWxlCiAqIEpvdWxlIFVJIGlzIGF2YWlsYWJsZSBhdCBodHRwczovL2pvdWxlLm15d2lzaC5pbwogKiBKb3VsZSB3YXMgbWFkZSBieSBNeVdpc2ggdGVhbSwgcGxlYXNlIHdlbGNvbWUgdG8gb3VyIHNpdGUgaHR0cHM6Ly9teXdpc2guaW8KICovCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgSm91bGVBUEkgewogICAgZXZlbnQgSW52b2tlZChhZGRyZXNzIGluZGV4ZWQgX2ludm9rZXIsIGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgYm9vbCBfc3RhdHVzLCB1aW50IF91c2VkR2FzKTsKICAgIGV2ZW50IFJlZ2lzdGVyZWQoYWRkcmVzcyBpbmRleGVkIF9yZWdpc3RyYW50LCBhZGRyZXNzIGluZGV4ZWQgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKTsKICAgIGV2ZW50IFVucmVnaXN0ZXJlZChhZGRyZXNzIGluZGV4ZWQgX3JlZ2lzdHJhbnQsIGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UsIHVpbnQgX2Ftb3VudCk7CgogICAgLyoqCiAgICAgKiBAZGV2IFJlZ2lzdGVycyB0aGUgc3BlY2lmaWVkIGNvbnRyYWN0IHRvIGludm9rZSBhdCB0aGUgc3BlY2lmaWVkIHRpbWUgd2l0aCB0aGUgc3BlY2lmaWVkIGdhcyBhbmQgcHJpY2UuCiAgICAgKiBAbm90aWNlIFJlZ2lzdHJhdGlvbiByZXF1aXJlcyB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiBFVEggaW4gdmFsdWUsIHRvIGNvdmVyIGludm9rZSBib251cy4gU2VlIGdldFByaWNlIG1ldGhvZC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2FkZHJlc3MgICAgICBDb250cmFjdCdzIGFkZHJlc3MuIENvbnRyYWN0IE1VU1QgaW1wbGVtZW50cyBDaGVja2FibGUgaW50ZXJmYWNlLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgVGltZXN0YW1wIGF0IHdoYXQgbW9tZW50IGNvbnRyYWN0IHNob3VsZCBiZSBjYWxsZWQuIEl0IE1VU1QgYmUgaW4gZnV0dXJlLgogICAgICogQHBhcmFtIF9nYXNMaW1pdCAgICAgR2FzIHdoaWNoIHdpbGwgYmUgcG9zdGVkIHRvIGNhbGwuCiAgICAgKiBAcGFyYW0gX2dhc1ByaWNlICAgICBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBvZiBjaGFuZ2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBSZWdpc3RlcnMgdGhlIHNwZWNpZmllZCBjb250cmFjdCB0byBpbnZva2UgYXQgdGhlIHNwZWNpZmllZCB0aW1lIHdpdGggdGhlIHNwZWNpZmllZCBnYXMgYW5kIHByaWNlLgogICAgICogQG5vdGljZSBSZWdpc3RyYXRpb24gcmVxdWlyZXMgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgRVRIIGluIHZhbHVlLCB0byBjb3ZlciBpbnZva2UgYm9udXMuIFNlZSBnZXRQcmljZSBtZXRob2QuCiAgICAgKiBAbm90aWNlIElmIHZhbHVlIHdvdWxkIGJlIG1vcmUgdGhlbiByZXF1aXJlZCAoc2VlIGdldFByaWNlKSBjaGFuZ2Ugd2lsbCBiZSByZXR1cm5lZCB0byBtc2cuc2VuZGVyIChub3QgdG8gX3JlZ2lzdHJhbnQhKS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3JlZ2lzdHJhbnQgICBBbnkgYWRkcmVzcyB3aGljaCB3aWxsIGJlIG93bmVycyBmb3IgdGhpcyByZWdpc3RyYXRpb24uIE9ubHkgaGUgY2FuIHVucmVnaXN0ZXIuIFVzZWZ1bCBmb3IgY2FsbGluZyBmcm9tIGNvbnRyYWN0LgogICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgQ29udHJhY3QncyBhZGRyZXNzLiBDb250cmFjdCBNVVNUIGltcGxlbWVudHMgQ2hlY2thYmxlIGludGVyZmFjZS4KICAgICAqIEBwYXJhbSBfdGltZXN0YW1wICAgIFRpbWVzdGFtcCBhdCB3aGF0IG1vbWVudCBjb250cmFjdCBzaG91bGQgYmUgY2FsbGVkLiBJdCBNVVNUIGJlIGluIGZ1dHVyZS4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgIEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSAgICAgR2FzIHByaWNlIHdoaWNoIGlzIHJlY29tbWVuZGVkIHRvIHVzZSBmb3IgdGhpcyBpbnZvY2F0aW9uLgogICAgICogQHJldHVybiBBbW91bnQgb2YgY2hhbmdlLgogICAgICovCiAgICBmdW5jdGlvbiByZWdpc3RlckZvcihhZGRyZXNzIF9yZWdpc3RyYW50LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSByZWdpc3RyYXRpb24gb2YgdGhlIHNwZWNpZmllZCBjb250cmFjdCAod2l0aCBleGFjdCBwYXJhbWV0ZXJzKSBieSB0aGUgc3BlY2lmaWVkIGtleS4gU2VlIGZpbmRLZXkgbWV0aG9kIGZvciBsb29raW5nIGZvciBrZXkuCiAgICAgKiBAbm90aWNlIEl0IHJldHVybnMgbm90IGZ1bGwgYW1vdW50IG9mIEVUSC4KICAgICAqIEBub3RpY2UgT25seSByZWdpc3RyYW50IGNhbiByZW1vdmUgdGhlaXIgcmVnaXN0cmF0aW9uLgogICAgICogQG5vdGljZSBPbmx5IHJlZ2lzdHJhdGlvbnMgaW4gZnV0dXJlIGNhbiBiZSByZW1vdmVkLgogICAgICoKICAgICAqIEBwYXJhbSBfa2V5ICAgICAgICAgIENvbnRyYWN0IGtleSwgdG8gZmFzdCBmaW5kaW5nIGR1cmluZyB1bnJlZ2lzdGVyLiBTZWUgZmluZEtleSBtZXRob2QgZm9yIGdldHRpbmcga2V5LgogICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgQ29udHJhY3QncyBhZGRyZXNzLiBDb250cmFjdCBNVVNUIGltcGxlbWVudHMgQ2hlY2thYmxlIGludGVyZmFjZS4KICAgICAqIEBwYXJhbSBfdGltZXN0YW1wICAgIFRpbWVzdGFtcCBhdCB3aGF0IG1vbWVudCBjb250cmFjdCBzaG91bGQgYmUgY2FsbGVkLiBJdCBNVVNUIGJlIGluIGZ1dHVyZS4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgIEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSAgICAgR2FzIHByaWNlIHdoaWNoIGlzIHJlY29tbWVuZGVkIHRvIHVzZSBmb3IgdGhpcyBpbnZvY2F0aW9uLgogICAgICogQHJldHVybiBBbW91bnQgb2YgcmVmdW5kLgogICAgICovCiAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyKGJ5dGVzMzIgX2tleSwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBJbnZva2VzIG5leHQgY29udHJhY3RzIGluIHRoZSBxdWV1ZS4KICAgICAqIEBub3RpY2UgRXRoIGFtb3VudCB0byBjb3ZlciBnYXMgd2lsbCBiZSByZXR1cm5lZCBpZiBnYXMgcHJpY2UgaXMgZXF1YWwgb3IgbGVzcyB0aGVuIHNwZWNpZmllZCBmb3IgY29udHJhY3QuIENoZWNrIGdldFRvcCBmb3IgcmlnaHQgZ2FzIHByaWNlLgogICAgICogQHJldHVybiBSZXdhcmQgYW1vdW50LgogICAgICovCiAgICBmdW5jdGlvbiBpbnZva2UoKSBwdWJsaWMgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEludm9rZXMgbmV4dCBjb250cmFjdHMgaW4gdGhlIHF1ZXVlLgogICAgICogQG5vdGljZSBFdGggYW1vdW50IHRvIGNvdmVyIGdhcyB3aWxsIGJlIHJldHVybmVkIGlmIGdhcyBwcmljZSBpcyBlcXVhbCBvciBsZXNzIHRoZW4gc3BlY2lmaWVkIGZvciBjb250cmFjdC4gQ2hlY2sgZ2V0VG9wIGZvciByaWdodCBnYXMgcHJpY2UuCiAgICAgKiBAcGFyYW0gX2ludm9rZXIgQW55IGFkZHJlc3MgZnJvbSB3aGljaCBldmVudCB3aWxsIGJlIHRocmV3LiBVc2VmdWwgZm9yIGNhbGxpbmcgZnJvbSBjb250cmFjdC4KICAgICAqIEByZXR1cm4gUmV3YXJkIGFtb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gaW52b2tlRm9yKGFkZHJlc3MgX2ludm9rZXIpIHB1YmxpYyByZXR1cm5zICh1aW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgSW52b2tlcyB0aGUgdG9wIGNvbnRyYWN0IGluIHRoZSBxdWV1ZS4KICAgICAqIEBub3RpY2UgRXRoIGFtb3VudCB0byBjb3ZlciBnYXMgd2lsbCBiZSByZXR1cm5lZCBpZiBnYXMgcHJpY2UgaXMgZXF1YWwgb3IgbGVzcyB0aGVuIHNwZWNpZmllZCBmb3IgY29udHJhY3QuIENoZWNrIGdldFRvcCBmb3IgcmlnaHQgZ2FzIHByaWNlLgogICAgICogQHJldHVybiBSZXdhcmQgYW1vdW50LgogICAgICovCiAgICBmdW5jdGlvbiBpbnZva2VPbmNlKCkgcHVibGljIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBJbnZva2VzIHRoZSB0b3AgY29udHJhY3QgaW4gdGhlIHF1ZXVlLgogICAgICogQG5vdGljZSBFdGggYW1vdW50IHRvIGNvdmVyIGdhcyB3aWxsIGJlIHJldHVybmVkIGlmIGdhcyBwcmljZSBpcyBlcXVhbCBvciBsZXNzIHRoZW4gc3BlY2lmaWVkIGZvciBjb250cmFjdC4gQ2hlY2sgZ2V0VG9wIGZvciByaWdodCBnYXMgcHJpY2UuCiAgICAgKiBAcGFyYW0gX2ludm9rZXIgQW55IGFkZHJlc3MgZnJvbSB3aGljaCBldmVudCB3aWxsIGJlIHRocmV3LiBVc2VmdWwgZm9yIGNhbGxpbmcgZnJvbSBjb250cmFjdC4KICAgICAqIEByZXR1cm4gUmV3YXJkIGFtb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gaW52b2tlT25jZUZvcihhZGRyZXNzIF9pbnZva2VyKSBwdWJsaWMgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgcmVxdWlyZWQgdG8gcmVnaXN0ZXIgYW1vdW50IG9mIFdFSS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2dhc0xpbWl0IEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB3ZWkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBob3cgbWFueSBjb250cmFjdHMgYXJlIHJlZ2lzdGVyZWQgKGFuZCBub3QgaW52b2tlZCkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldENvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEdldHMgdG9wIGNvbnRyYWN0ICh0aGUgbmV4dCB0byBpbnZva2UpLgogICAgICoKICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gdGltZXN0YW1wICAgICAgICBUaGUgaW52b2NhdGlvbiB0aW1lc3RhbXAuCiAgICAgKiBAcmV0dXJuIGdhc0xpbWl0ICAgICAgICAgVGhlIGNvbnRyYWN0IGdhcy4KICAgICAqIEByZXR1cm4gZ2FzUHJpY2UgICAgICAgICBUaGUgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gaW52b2tlR2FzICAgICAgICBUaGUgbWluaW1hbCBhbW91bnQgb2YgZ2FzIHRvIGludm9rZSAoaW5jbHVkaW5nIGdhcyBmb3Igam91bGUpLgogICAgICogQHJldHVybiByZXdhcmRBbW91bnQgICAgIFRoZSBhbW91bnQgb2YgcmV3YXJkIGZvciBpbnZvY2F0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRUb3BPbmNlKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzcywKICAgICAgICB1aW50IHRpbWVzdGFtcCwKICAgICAgICB1aW50IGdhc0xpbWl0LAogICAgICAgIHVpbnQgZ2FzUHJpY2UsCiAgICAgICAgdWludCBpbnZva2VHYXMsCiAgICAgICAgdWludCByZXdhcmRBbW91bnQKICAgICk7CgogICAgLyoqCiAgICAgKiBAZGV2IEdldHMgb25lIG5leHQgY29udHJhY3QgYnkgdGhlIHNwZWNpZmllZCBwcmV2aW91cyBpbiBvcmRlciB0byBpbnZva2UuCiAgICAgKgogICAgICogQHBhcmFtIF9jb250cmFjdEFkZHJlc3MgIFRoZSBwcmV2aW91cyBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgICAgIFRoZSBwcmV2aW91cyBpbnZvY2F0aW9uIHRpbWVzdGFtcC4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBtYXhpbXVtIGdhcy4KICAgICAqIEBwYXJhbSBfZ2FzUHJpY2UgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gZ2FzTGltaXQgICAgICAgICBUaGUgY29udHJhY3QgZ2FzLgogICAgICogQHJldHVybiBnYXNQcmljZSAgICAgICAgIFRoZSBpbnZvY2F0aW9uIGV4cGVjdGVkIHByaWNlLgogICAgICogQHJldHVybiBpbnZva2VHYXMgICAgICAgIFRoZSBtaW5pbWFsIGFtb3VudCBvZiBnYXMgdG8gaW52b2tlIChpbmNsdWRpbmcgZ2FzIGZvciBqb3VsZSkuCiAgICAgKiBAcmV0dXJuIHJld2FyZEFtb3VudCAgICAgVGhlIGFtb3VudCBvZiByZXdhcmQgZm9yIGludm9jYXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5leHRPbmNlKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgdWludCBfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNMaW1pdCwKICAgICAgICAgICAgICAgICAgICAgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgY29udHJhY3RBZGRyZXNzLAogICAgICAgIHVpbnQgdGltZXN0YW1wLAogICAgICAgIHVpbnQgZ2FzTGltaXQsCiAgICAgICAgdWludCBnYXNQcmljZSwKICAgICAgICB1aW50IGludm9rZUdhcywKICAgICAgICB1aW50IHJld2FyZEFtb3VudAogICAgKTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBfY291bnQgbmV4dCBjb250cmFjdHMgYnkgdGhlIHNwZWNpZmllZCBwcmV2aW91cyBpbiBvcmRlciB0byBpbnZva2UuCiAgICAgKiBAbm90aWNlIFVubGlrZSBnZXRUb3AgdGhpcyBtZXRob2QgcmV0dXJuIGV4YWN0IF9jb3VudCB2YWx1ZXMuCiAgICAgKgogICAgICogQHBhcmFtIF9jb3VudCAgICAgICAgICAgIFRoZSBjb3VudCBvZiByZXN1bHQgY29udHJhY3RzLgogICAgICogQHBhcmFtIF9jb250cmFjdEFkZHJlc3MgIFRoZSBwcmV2aW91cyBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgICAgIFRoZSBwcmV2aW91cyBpbnZvY2F0aW9uIHRpbWVzdGFtcC4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBtYXhpbXVtIGdhcy4KICAgICAqIEBwYXJhbSBfZ2FzUHJpY2UgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gZ2FzTGltaXQgICAgICAgICBUaGUgY29udHJhY3QgZ2FzLgogICAgICogQHJldHVybiBnYXNQcmljZSAgICAgICAgIFRoZSBpbnZvY2F0aW9uIGV4cGVjdGVkIHByaWNlLgogICAgICogQHJldHVybiBpbnZva2VHYXMgICAgICAgIFRoZSBtaW5pbWFsIGFtb3VudCBvZiBnYXMgdG8gaW52b2tlIChpbmNsdWRpbmcgZ2FzIGZvciBqb3VsZSkuCiAgICAgKiBAcmV0dXJuIHJld2FyZEFtb3VudCAgICAgVGhlIGFtb3VudCBvZiByZXdhcmQgZm9yIGludm9jYXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5leHQodWludCBfY291bnQsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9jb250cmFjdEFkZHJlc3MsCiAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICB1aW50IF9nYXNMaW1pdCwKICAgICAgICAgICAgICAgIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3NbXSBhZGRyZXNzZXMsCiAgICAgICAgdWludFtdIHRpbWVzdGFtcHMsCiAgICAgICAgdWludFtdIGdhc0xpbWl0cywKICAgICAgICB1aW50W10gZ2FzUHJpY2VzLAogICAgICAgIHVpbnRbXSBpbnZva2VHYXNlcywKICAgICAgICB1aW50W10gcmV3YXJkQW1vdW50cwogICAgKTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyB0b3AgX2NvdW50IGNvbnRyYWN0cyAoaW4gb3JkZXIgdG8gaW52b2tlKS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2NvdW50ICAgICAgICAgICAgSG93IG1hbnkgcmVjb3JkcyB3aWxsIGJlIHJldHVybmVkLgogICAgICogQHJldHVybiBhZGRyZXNzZXMgICAgICAgIFRoZSBjb250cmFjdHMgYWRkcmVzc2VzLgogICAgICogQHJldHVybiB0aW1lc3RhbXBzICAgICAgIFRoZSBpbnZvY2F0aW9uIHRpbWVzdGFtcHMuCiAgICAgKiBAcmV0dXJuIGdhc0xpbWl0cyAgICAgICAgVGhlIGNvbnRyYWN0IGdhcy4KICAgICAqIEByZXR1cm4gZ2FzUHJpY2VzICAgICAgICBUaGUgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gaW52b2tlR2FzZXMgICAgICBUaGUgbWluaW1hbCBhbW91bnQgb2YgZ2FzIHRvIGludm9rZSAoaW5jbHVkaW5nIGdhcyBmb3Igam91bGUpLgogICAgICogQHJldHVybiByZXdhcmRBbW91bnRzICAgIFRoZSBhbW91bnQgb2YgcmV3YXJkIGZvciBpbnZvY2F0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRUb3AodWludCBfY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzc1tdIGFkZHJlc3NlcywKICAgICAgICB1aW50W10gdGltZXN0YW1wcywKICAgICAgICB1aW50W10gZ2FzTGltaXRzLAogICAgICAgIHVpbnRbXSBnYXNQcmljZXMsCiAgICAgICAgdWludFtdIGludm9rZUdhc2VzLAogICAgICAgIHVpbnRbXSByZXdhcmRBbW91bnRzCiAgICApOwoKICAgIC8qKgogICAgICogQGRldiBGaW5kcyBrZXkgZm9yIHRoZSByZWdpc3RyYXRpb24gd2l0aCBleGFjdCBwYXJhbWV0ZXJzLiBCZSBjYXJlZnVsLCBrZXkgbWlnaHQgYmUgY2hhbmdlZCBiZWNhdXNlIG9mIG90aGVyIHJlZ2lzdHJhdGlvbnMuCiAgICAgKiBAcGFyYW0gX2FkZHJlc3MgICAgICBDb250cmFjdCdzIGFkZHJlc3MuIENvbnRyYWN0IE1VU1QgaW1wbGVtZW50cyBDaGVja2FibGUgaW50ZXJmYWNlLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgVGltZXN0YW1wIGF0IHdoYXQgbW9tZW50IGNvbnRyYWN0IHNob3VsZCBiZSBjYWxsZWQuIEl0IE1VU1QgYmUgaW4gZnV0dXJlLgogICAgICogQHBhcmFtIF9nYXNMaW1pdCAgICAgR2FzIHdoaWNoIHdpbGwgYmUgcG9zdGVkIHRvIGNhbGwuCiAgICAgKiBAcGFyYW0gX2dhc1ByaWNlICAgICBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIF9rZXkgICAgICAgICBLZXkgb2YgdGhlIHNwZWNpZmllZCByZWdpc3RyYXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmRLZXkoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIpOwoKICAgIC8qKgogICAgICogQGRldiBHZXRzIGFjdHVhbCBjb2RlIHZlcnNpb24uCiAgICAgKiBAcmV0dXJuIENvZGUgdmVyc2lvbi4gTWFzazogMHhmZi4weGZmLjB4ZmZmZi0weGZmZmZmZmZmIChtYWpvci5taW5vci5idWlsZC1oYXNoKQogICAgICovCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9uKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczgpOwoKICAgIC8qKgogICAgICogQGRldiBHZXRzIG1pbmltYWwgZ2FzIHByaWNlLCBzcGVjaWZpZWQgYnkgbWFpbnRhaW5lci4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0TWluR2FzUHJpY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KY29udHJhY3QgVHJhbnNmZXJUb2tlbiBpcyBPd25hYmxlIHsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oRVJDMjBCYXNpYyBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgX3Rva2VuLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KfQpjb250cmFjdCBKb3VsZVByb3h5QVBJIHsKICAgIC8qKgogICAgICogRnVuY3Rpb24gaGFzaCBpczogMHg3MzAyN2Y2ZAogICAgICovCiAgICBmdW5jdGlvbiBjYWxsYmFjayhhZGRyZXNzIF9pbnZva2VyLCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CmNvbnRyYWN0IENoZWNrYWJsZUNvbnRyYWN0IHsKICAgIGV2ZW50IENoZWNrZWQoKTsKICAgIC8qCiAgICAgKiBGdW5jdGlvbiBoYXNoIGlzIDB4OTE5ODQwYWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrKCkgcHVibGljOwp9Cgpjb250cmFjdCB1c2luZ0NvbnN0cyB7CiAgICB1aW50IGNvbnN0YW50IEdXRUkgPSAwLjAwMSBzemFibzsKCiAgICAvLyB0aGlzIHZhbHVlcyBpbmZsdWVuY2UgdG8gdGhlIHJld2FyZCBwcmljZSEgZG8gbm90IGNoYW5nZSBmb3IgYWxyZWFkeSByZWdpc3RlcmVkIGNvbnRyYWN0cyEKICAgIHVpbnQgY29uc3RhbnQgVFJBTlNBQ1RJT05fR0FTID0gMjIwMDA7CiAgICAvLyByZW1haW5pbmcgZ2FzIC0gYW1vdW50IG9mIGdhcyB0byBmaW5pc2ggdHJhbnNhY3Rpb24gYWZ0ZXIgaW52b2tlCiAgICB1aW50IGNvbnN0YW50IFJFTUFJTklOR19HQVMgPSAzMDAwMDsKICAgIC8vIGpvdWxlIGdhcyAtIGdhcyB0byBqb3VsZSAoaW5jbHVkaW5nIHByb3h5IGFuZCBvdGhlcnMpIGludm9jYXRpb24sIGV4Y2x1ZGluZyBjb250cmFjdCBnYXMKICAgIHVpbnQgY29uc3RhbnQgSk9VTEVfR0FTID0gVFJBTlNBQ1RJT05fR0FTICsgUkVNQUlOSU5HX0dBUyArIDUwMDA7CgogICAgLy8gbWluaW1hbCBkZWZhdWx0IGdhcyBwcmljZSAoYmVjYXVzZSBvZiBuZXR3b3JrIGxvYWQpCiAgICB1aW50MzIgY29uc3RhbnQgREVGQVVMVF9NSU5fR0FTX1BSSUNFX0dXRUkgPSAyMDsKICAgIC8vIG1pbiBnYXMgcHJpY2UKICAgIHVpbnQgY29uc3RhbnQgTUlOX0dBU19QUklDRSA9IEdXRUk7CiAgICAvLyBtYXggZ2FzIHByaWNlCiAgICB1aW50IGNvbnN0YW50IE1BWF9HQVNfUFJJQ0UgPSAweGZmZmZmZmZmICogR1dFSTsKICAgIC8vIG5vdCwgaXQgbWlzdCBiZSBsZXNzIHRoZW4gMHgwMGZmZmZmZiwgYmVjYXVzZSBoaWdoIGJ5dGVzIG1pZ2h0IGJlIHVzZWQgZm9yIHN0b3JpbmcgZmxhZ3MKICAgIHVpbnQgY29uc3RhbnQgTUFYX0dBUyA9IDQwMDAwMDA7CiAgICAvLyBDb2RlIHZlcnNpb24KICAgIGJ5dGVzOCBjb25zdGFudCBWRVJTSU9OID0gMHgwMTA4MDA3NjAwYWE2MGVmOwogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgIF5eIC0gbWFqb3IKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eIC0gbWlub3IKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXiAtIGJ1aWxkCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIGdpdCBoYXNoCn0KCgpsaWJyYXJ5IEtleXNVdGlscyB7CiAgICAvLyBTdWNoIG9yZGVyIGlzIGltcG9ydGFudCB0byBsb2FkIGZyb20gc3RhdGUKICAgIHN0cnVjdCBPYmplY3QgewogICAgICAgIHVpbnQzMiBnYXNQcmljZUd3ZWk7CiAgICAgICAgdWludDMyIGdhc0xpbWl0OwogICAgICAgIHVpbnQzMiB0aW1lc3RhbXA7CiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gdG9LZXkoT2JqZWN0IF9vYmopIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiB0b0tleShfb2JqLmNvbnRyYWN0QWRkcmVzcywgX29iai50aW1lc3RhbXAsIF9vYmouZ2FzTGltaXQsIF9vYmouZ2FzUHJpY2VHd2VpKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleUZyb21TdG9yYWdlKE9iamVjdCBzdG9yYWdlIF9vYmopIGludGVybmFsIHZpZXcgcmV0dXJucyAoYnl0ZXMzMiBfa2V5KSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfa2V5IDo9IHNsb2FkKF9vYmpfc2xvdCkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9LZXkoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgICAgICByZXN1bHQgPSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICAgICAgLy8gICAgICAgICBeXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eIC0gYWRkcmVzcyAoMjAgYnl0ZXMpCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXl5eXl4gLSB0aW1lc3RhbXAgKDQgYnl0ZXMpCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIGdhcyBsaW1pdCAoNCBieXRlcykKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXl5eXl4gLSBnYXMgcHJpY2UgKDQgYnl0ZXMpCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByZXN1bHQgOj0gb3IocmVzdWx0LCBtdWwoX2FkZHJlc3MsIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkpCiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihyZXN1bHQsIG11bChhbmQoX3RpbWVzdGFtcCwgMHhmZmZmZmZmZiksIDB4MTAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICByZXN1bHQgOj0gb3IocmVzdWx0LCBtdWwoYW5kKF9nYXNMaW1pdCwgMHhmZmZmZmZmZiksIDB4MTAwMDAwMDAwKSkKICAgICAgICAgICAgcmVzdWx0IDo9IG9yKHJlc3VsdCwgYW5kKF9nYXNQcmljZSwgMHhmZmZmZmZmZikpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRvTWVtb3J5T2JqZWN0KGJ5dGVzMzIgX2tleSwgT2JqZWN0IG1lbW9yeSBfZGVzdCkgaW50ZXJuYWwgcHVyZSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBtc3RvcmUoX2Rlc3QsIGFuZChfa2V5LCAweGZmZmZmZmZmKSkKICAgICAgICAgICAgbXN0b3JlKGFkZChfZGVzdCwgMHgyMCksIGFuZChkaXYoX2tleSwgMHgxMDAwMDAwMDApLCAweGZmZmZmZmZmKSkKICAgICAgICAgICAgbXN0b3JlKGFkZChfZGVzdCwgMHg0MCksIGFuZChkaXYoX2tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMCksIDB4ZmZmZmZmZmYpKQogICAgICAgICAgICBtc3RvcmUoYWRkKF9kZXN0LCAweDYwKSwgZGl2KF9rZXksIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRvT2JqZWN0KGJ5dGVzMzIgX2tleSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChPYmplY3QgbWVtb3J5IF9kZXN0KSB7CiAgICAgICAgdG9NZW1vcnlPYmplY3QoX2tleSwgX2Rlc3QpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvU3RhdGVPYmplY3QoYnl0ZXMzMiBfa2V5LCBPYmplY3Qgc3RvcmFnZSBfZGVzdCkgaW50ZXJuYWwgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc3N0b3JlKF9kZXN0X3Nsb3QsIF9rZXkpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWVzdGFtcChieXRlczMyIF9rZXkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBhbmQoZGl2KF9rZXksIDB4MTAwMDAwMDAwMDAwMDAwMDApLCAweGZmZmZmZmZmKQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgUmVzdHJpY3Rpb24gewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBpbnRlcm5hbCBhY2Nlc3NlczsKCiAgICBmdW5jdGlvbiBSZXN0cmljdGlvbigpIHB1YmxpYyB7CiAgICAgICAgYWNjZXNzZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdpdmVBY2Nlc3MoYWRkcmVzcyBfYWRkcikgcHVibGljIHJlc3RyaWN0ZWQgewogICAgICAgIGFjY2Vzc2VzW19hZGRyXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlQWNjZXNzKGFkZHJlc3MgX2FkZHIpIHB1YmxpYyByZXN0cmljdGVkIHsKICAgICAgICBkZWxldGUgYWNjZXNzZXNbX2FkZHJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc0FjY2VzcygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFjY2Vzc2VzW21zZy5zZW5kZXJdOwogICAgfQoKICAgIG1vZGlmaWVyIHJlc3RyaWN0ZWQoKSB7CiAgICAgICAgcmVxdWlyZShoYXNBY2Nlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KfQoKY29udHJhY3QgSm91bGVTdG9yYWdlIGlzIFJlc3RyaWN0aW9uIHsKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBieXRlczMyKSBtYXA7CgogICAgZnVuY3Rpb24gZ2V0KGJ5dGVzMzIgX2tleSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMiBfdmFsdWUpIHsKICAgICAgICByZXR1cm4gbWFwW19rZXldOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldChieXRlczMyIF9rZXksIGJ5dGVzMzIgX3ZhbHVlKSBwdWJsaWMgcmVzdHJpY3RlZCB7CiAgICAgICAgbWFwW19rZXldID0gX3ZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbChieXRlczMyIF9rZXkpIHB1YmxpYyByZXN0cmljdGVkIHsKICAgICAgICBkZWxldGUgbWFwW19rZXldOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFuZERlbChieXRlczMyIF9rZXkpIHB1YmxpYyByZXN0cmljdGVkIHJldHVybnMgKGJ5dGVzMzIgX3ZhbHVlKSB7CiAgICAgICAgX3ZhbHVlID0gbWFwW19rZXldOwogICAgICAgIGRlbGV0ZSBtYXBbX2tleV07CiAgICB9CgogICAgZnVuY3Rpb24gc3dhcChieXRlczMyIF9mcm9tLCBieXRlczMyIF90bykgcHVibGljIHJlc3RyaWN0ZWQgcmV0dXJucyAoYnl0ZXMzMiBfdmFsdWUpIHsKICAgICAgICBfdmFsdWUgPSBtYXBbX3RvXTsKICAgICAgICBtYXBbX3RvXSA9IG1hcFtfZnJvbV07CiAgICAgICAgZGVsZXRlIG1hcFtfZnJvbV07CiAgICB9Cn0KCmNvbnRyYWN0IEpvdWxlSW5kZXhDb3JlIHsKICAgIHVzaW5nIEtleXNVdGlscyBmb3IgYnl0ZXMzMjsKICAgIHVpbnQgY29uc3RhbnQgWUVBUiA9IDB4MURGRTIwMDsKICAgIGJ5dGVzMzIgY29uc3RhbnQgSEVBRCA9IDB4MDsKCiAgICAvLyBZRUFSIC0+IHdlZWsgLT4gaG91ciAtPiBtaW51dGUKICAgIEpvdWxlU3RvcmFnZSBwdWJsaWMgc3RhdGU7CgogICAgZnVuY3Rpb24gSm91bGVJbmRleENvcmUoSm91bGVTdG9yYWdlIF9zdG9yYWdlKSBwdWJsaWMgewogICAgICAgIHN0YXRlID0gX3N0b3JhZ2U7CiAgICB9CgogICAgZnVuY3Rpb24gaW5zZXJ0SW5kZXgoYnl0ZXMzMiBfa2V5KSBpbnRlcm5hbCB7CiAgICAgICAgdWludCB0aW1lc3RhbXAgPSBfa2V5LmdldFRpbWVzdGFtcCgpOwogICAgICAgIGJ5dGVzMzIgeWVhciA9IHRvS2V5KHRpbWVzdGFtcCwgWUVBUik7CiAgICAgICAgYnl0ZXMzMiBoZWFkTG93OwogICAgICAgIGJ5dGVzMzIgaGVhZEhpZ2g7CiAgICAgICAgKGhlYWRMb3csIGhlYWRIaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoSEVBRCkpOwogICAgICAgIGlmICh5ZWFyIDwgaGVhZExvdyB8fCBoZWFkTG93ID09IDAgfHwgeWVhciA+IGhlYWRIaWdoKSB7CiAgICAgICAgICAgIGlmICh5ZWFyIDwgaGVhZExvdyB8fCBoZWFkTG93ID09IDApIHsKICAgICAgICAgICAgICAgIGhlYWRMb3cgPSB5ZWFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh5ZWFyID4gaGVhZEhpZ2gpIHsKICAgICAgICAgICAgICAgIGhlYWRIaWdoID0geWVhcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5zZXQoSEVBRCwgdG9WYWx1ZShoZWFkTG93LCBoZWFkSGlnaCkpOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiB3ZWVrID0gdG9LZXkodGltZXN0YW1wLCAxIHdlZWtzKTsKICAgICAgICBieXRlczMyIGxvdzsKICAgICAgICBieXRlczMyIGhpZ2g7CiAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KHllYXIpKTsKICAgICAgICBpZiAod2VlayA8IGxvdyB8fCB3ZWVrID4gaGlnaCkgewogICAgICAgICAgICBpZiAod2VlayA8IGxvdyB8fCBsb3cgPT0gMCkgewogICAgICAgICAgICAgICAgbG93ID0gd2VlazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2VlayA+IGhpZ2gpIHsKICAgICAgICAgICAgICAgIGhpZ2ggPSB3ZWVrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLnNldCh5ZWFyLCB0b1ZhbHVlKGxvdywgaGlnaCkpOwogICAgICAgIH0KCiAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KHdlZWspKTsKICAgICAgICBieXRlczMyIGhvdXIgPSB0b0tleSh0aW1lc3RhbXAsIDEgaG91cnMpOwogICAgICAgIGlmIChob3VyIDwgbG93IHx8IGhvdXIgPiBoaWdoKSB7CiAgICAgICAgICAgIGlmIChob3VyIDwgbG93IHx8IGxvdyA9PSAwKSB7CiAgICAgICAgICAgICAgICBsb3cgPSBob3VyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChob3VyID4gaGlnaCkgewogICAgICAgICAgICAgICAgaGlnaCA9IGhvdXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuc2V0KHdlZWssIHRvVmFsdWUobG93LCBoaWdoKSk7CiAgICAgICAgfQoKICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoaG91cikpOwogICAgICAgIGJ5dGVzMzIgbWludXRlID0gdG9LZXkodGltZXN0YW1wLCAxIG1pbnV0ZXMpOwogICAgICAgIGlmIChtaW51dGUgPCBsb3cgfHwgbWludXRlID4gaGlnaCkgewogICAgICAgICAgICBpZiAobWludXRlIDwgbG93IHx8IGxvdyA9PSAwKSB7CiAgICAgICAgICAgICAgICBsb3cgPSBtaW51dGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1pbnV0ZSA+IGhpZ2gpIHsKICAgICAgICAgICAgICAgIGhpZ2ggPSBtaW51dGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuc2V0KGhvdXIsIHRvVmFsdWUobG93LCBoaWdoKSk7CiAgICAgICAgfQoKICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQobWludXRlKSk7CiAgICAgICAgYnl0ZXMzMiB0c0tleSA9IHRvS2V5KHRpbWVzdGFtcCk7CiAgICAgICAgaWYgKHRzS2V5IDwgbG93IHx8IHRzS2V5ID4gaGlnaCkgewogICAgICAgICAgICBpZiAodHNLZXkgPCBsb3cgfHwgbG93ID09IDApIHsKICAgICAgICAgICAgICAgIGxvdyA9IHRzS2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0c0tleSA+IGhpZ2gpIHsKICAgICAgICAgICAgICAgIGhpZ2ggPSB0c0tleTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5zZXQobWludXRlLCB0b1ZhbHVlKGxvdywgaGlnaCkpOwogICAgICAgIH0KCiAgICAgICAgc3RhdGUuc2V0KHRzS2V5LCBfa2V5KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIGtleSB2YWx1ZSBmcm9tIHRoZSBwcmV2aW91cyBzdGF0ZSB0byBuZXcuIFRpbWVzdGFtcCBNVVNUIGJlIHRoZSBzYW1lIG9uIGJvdGgga2V5cy4KICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlSW5kZXgoYnl0ZXMzMiBfcHJldiwgYnl0ZXMzMiBfa2V5KSBpbnRlcm5hbCB7CiAgICAgICAgdWludCB0aW1lc3RhbXAgPSBfa2V5LmdldFRpbWVzdGFtcCgpOwogICAgICAgIGJ5dGVzMzIgdHNLZXkgPSB0b0tleSh0aW1lc3RhbXApOwogICAgICAgIGJ5dGVzMzIgcHJldktleSA9IHN0YXRlLmdldCh0c0tleSk7CiAgICAgICAgLy8gb24gdGhlIHNhbWUgdGltZXN0YW1wIG1pZ2h0IGJlIG90aGVyIGtleSwgaW4gdGhhdCBjYXNlIHdlIGRvIG5vdCBuZWVkIHRvIHVwZGF0ZSBpdAogICAgICAgIGlmIChwcmV2S2V5ICE9IF9wcmV2KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgc3RhdGUuc2V0KHRzS2V5LCBfa2V5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kRmxvb3JLZXlZZWFyKHVpbnQgX3RpbWVzdGFtcCwgYnl0ZXMzMiBfbG93LCBieXRlczMyIF9oaWdoKSB2aWV3IHByaXZhdGUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIGJ5dGVzMzIgeWVhciA9IHRvS2V5KF90aW1lc3RhbXAsIFlFQVIpOwogICAgICAgIGlmICh5ZWFyIDwgX2xvdykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHllYXIgPiBfaGlnaCkgewogICAgICAgICAgICAvLyB3ZWVrCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChfaGlnaCkpOwogICAgICAgICAgICAvLyBob3VyCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChoaWdoKSk7CiAgICAgICAgICAgIC8vIG1pbnV0ZQogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoaGlnaCkpOwogICAgICAgICAgICAvLyB0cwogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoaGlnaCkpOwogICAgICAgICAgICByZXR1cm4gc3RhdGUuZ2V0KGhpZ2gpOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICB3aGlsZSAoeWVhciA+PSBfbG93KSB7CiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldCh5ZWFyKSk7CiAgICAgICAgICAgIGlmIChsb3cgIT0gMCkgewogICAgICAgICAgICAgICAgYnl0ZXMzMiBrZXkgPSBmaW5kRmxvb3JLZXlXZWVrKF90aW1lc3RhbXAsIGxvdywgaGlnaCk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIDB4MURGRTIwMCA9IDUyIHdlZWtzID0gMzE0NDk2MDAKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgeWVhciA6PSBzdWIoeWVhciwgMHgxREZFMjAwKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kRmxvb3JLZXlXZWVrKHVpbnQgX3RpbWVzdGFtcCwgYnl0ZXMzMiBfbG93LCBieXRlczMyIF9oaWdoKSB2aWV3IHByaXZhdGUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIGJ5dGVzMzIgd2VlayA9IHRvS2V5KF90aW1lc3RhbXAsIDEgd2Vla3MpOwogICAgICAgIGlmICh3ZWVrIDwgX2xvdykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgbG93OwogICAgICAgIGJ5dGVzMzIgaGlnaDsKCiAgICAgICAgaWYgKHdlZWsgPiBfaGlnaCkgewogICAgICAgICAgICAvLyBob3VyCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChfaGlnaCkpOwogICAgICAgICAgICAvLyBtaW51dGUKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KGhpZ2gpKTsKICAgICAgICAgICAgLy8gdHMKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KGhpZ2gpKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmdldChoaWdoKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlICh3ZWVrID49IF9sb3cpIHsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KHdlZWspKTsKICAgICAgICAgICAgaWYgKGxvdyAhPSAwKSB7CiAgICAgICAgICAgICAgICBieXRlczMyIGtleSA9IGZpbmRGbG9vcktleUhvdXIoX3RpbWVzdGFtcCwgbG93LCBoaWdoKTsKICAgICAgICAgICAgICAgIGlmIChrZXkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDEgd2Vla3MgPSA2MDQ4MDAKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgd2VlayA6PSBzdWIod2VlaywgNjA0ODAwKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKCiAgICBmdW5jdGlvbiBmaW5kRmxvb3JLZXlIb3VyKHVpbnQgX3RpbWVzdGFtcCwgYnl0ZXMzMiBfbG93LCBieXRlczMyIF9oaWdoKSB2aWV3IHByaXZhdGUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIGJ5dGVzMzIgaG91ciA9IHRvS2V5KF90aW1lc3RhbXAsIDEgaG91cnMpOwogICAgICAgIGlmIChob3VyIDwgX2xvdykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgbG93OwogICAgICAgIGJ5dGVzMzIgaGlnaDsKCiAgICAgICAgaWYgKGhvdXIgPiBfaGlnaCkgewogICAgICAgICAgICAvLyBtaW51dGUKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KF9oaWdoKSk7CiAgICAgICAgICAgIC8vIHRzCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChoaWdoKSk7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5nZXQoaGlnaCk7CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAoaG91ciA+PSBfbG93KSB7CiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChob3VyKSk7CiAgICAgICAgICAgIGlmIChsb3cgIT0gMCkgewogICAgICAgICAgICAgICAgYnl0ZXMzMiBrZXkgPSBmaW5kRmxvb3JLZXlNaW51dGUoX3RpbWVzdGFtcCwgbG93LCBoaWdoKTsKICAgICAgICAgICAgICAgIGlmIChrZXkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDEgaG91cnMgPSAzNjAwCiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGhvdXIgOj0gc3ViKGhvdXIsIDM2MDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEZsb29yS2V5TWludXRlKHVpbnQgX3RpbWVzdGFtcCwgYnl0ZXMzMiBfbG93LCBieXRlczMyIF9oaWdoKSB2aWV3IHByaXZhdGUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIGJ5dGVzMzIgbWludXRlID0gdG9LZXkoX3RpbWVzdGFtcCwgMSBtaW51dGVzKTsKICAgICAgICBpZiAobWludXRlIDwgX2xvdykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgbG93OwogICAgICAgIGJ5dGVzMzIgaGlnaDsKCiAgICAgICAgaWYgKG1pbnV0ZSA+IF9oaWdoKSB7CiAgICAgICAgICAgIC8vIHRzCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChfaGlnaCkpOwogICAgICAgICAgICByZXR1cm4gc3RhdGUuZ2V0KGhpZ2gpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKG1pbnV0ZSA+PSBfbG93KSB7CiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChtaW51dGUpKTsKICAgICAgICAgICAgaWYgKGxvdyAhPSAwKSB7CiAgICAgICAgICAgICAgICBieXRlczMyIGtleSA9IGZpbmRGbG9vcktleVRpbWVzdGFtcChfdGltZXN0YW1wLCBsb3csIGhpZ2gpOwogICAgICAgICAgICAgICAgaWYgKGtleSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMSBtaW51dGVzID0gNjAKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbWludXRlIDo9IHN1YihtaW51dGUsIDYwKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kRmxvb3JLZXlUaW1lc3RhbXAodWludCBfdGltZXN0YW1wLCBieXRlczMyIF9sb3csIGJ5dGVzMzIgX2hpZ2gpIHZpZXcgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiB0c0tleSA9IHRvS2V5KF90aW1lc3RhbXApOwogICAgICAgIGlmICh0c0tleSA8IF9sb3cpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGlmICh0c0tleSA+IF9oaWdoKSB7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5nZXQoX2hpZ2gpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHRzS2V5ID49IF9sb3cpIHsKICAgICAgICAgICAgYnl0ZXMzMiBrZXkgPSBzdGF0ZS5nZXQodHNLZXkpOwogICAgICAgICAgICBpZiAoa2V5ICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgdHNLZXkgOj0gc3ViKHRzS2V5LCAxKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleUluZGV4KHVpbnQgX3RpbWVzdGFtcCkgdmlldyBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7Ci8vICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPiAweGZmZmZmZmZmKTsKLy8gICAgICAgIGlmIChfdGltZXN0YW1wIDwgMTUxNTYxMjQxNSkgewovLyAgICAgICAgICAgIHJldHVybiAwOwovLyAgICAgICAgfQoKICAgICAgICBieXRlczMyIHllYXJMb3c7CiAgICAgICAgYnl0ZXMzMiB5ZWFySGlnaDsKICAgICAgICAoeWVhckxvdywgeWVhckhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChIRUFEKSk7CgogICAgICAgIHJldHVybiBmaW5kRmxvb3JLZXlZZWFyKF90aW1lc3RhbXAsIHllYXJMb3csIHllYXJIaWdoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleSh1aW50IF90aW1lc3RhbXAsIHVpbnQgcm91bmRlcikgcHVyZSBwcml2YXRlIHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0KSB7CiAgICAgICAgLy8gMHgwLi4uMDAwMDAwMDAwMDAwMDAwMDAKICAgICAgICAvLyAgICAgICAgXl5eXl5eXl4gLSByb3VuZGVyIG1hcmtlciAoZWcsIHRvIGF2b2lkIGNyb3NzaW5nIGZpcnN0IGRheSBvZiB5ZWFyIHdpdGggeWVhcikKICAgICAgICAvLyAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIHJvdW5kZWQgbW9tZW50ICh5ZWFyLCB3ZWVrLCBldGMpCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByZXN1bHQgOj0gb3IobXVsKHJvdW5kZXIsIDB4MTAwMDAwMDAwKSwgbXVsKGRpdihfdGltZXN0YW1wLCByb3VuZGVyKSwgcm91bmRlcikpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRvVmFsdWUoYnl0ZXMzMiBfbG93S2V5LCBieXRlczMyIF9oaWdoS2V5KSBwdXJlIHByaXZhdGUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihtdWwoX2xvd0tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMCksIF9oaWdoS2V5KQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBmcm9tVmFsdWUoYnl0ZXMzMiBfdmFsdWUpIHB1cmUgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyIF9sb3dLZXksIGJ5dGVzMzIgX2hpZ2hLZXkpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9sb3dLZXkgOj0gYW5kKGRpdihfdmFsdWUsIDB4MTAwMDAwMDAwMDAwMDAwMDApLCAweGZmZmZmZmZmZmZmZmZmZmYpCiAgICAgICAgICAgIF9oaWdoS2V5IDo9IGFuZChfdmFsdWUsIDB4ZmZmZmZmZmZmZmZmZmZmZikKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9LZXkodWludCB0aW1lc3RhbXApIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBieXRlczMyKHRpbWVzdGFtcCk7CiAgICB9Cn0KCmNvbnRyYWN0IEpvdWxlQ29udHJhY3RIb2xkZXIgaXMgSm91bGVJbmRleENvcmUsIHVzaW5nQ29uc3RzIHsKICAgIHVzaW5nIEtleXNVdGlscyBmb3IgYnl0ZXMzMjsKICAgIHVpbnQgaW50ZXJuYWwgbGVuZ3RoOwogICAgYnl0ZXMzMiBwdWJsaWMgaGVhZDsKCiAgICBmdW5jdGlvbiBKb3VsZUNvbnRyYWN0SG9sZGVyKGJ5dGVzMzIgX2hlYWQsIHVpbnQgX2xlbmd0aCwgSm91bGVTdG9yYWdlIF9zdG9yYWdlKSBwdWJsaWMKICAgICAgICAgICAgSm91bGVJbmRleENvcmUoX3N0b3JhZ2UpIHsKICAgICAgICBoZWFkID0gX2hlYWQ7CiAgICAgICAgbGVuZ3RoID0gX2xlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnNlcnQoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGludGVybmFsIHsKICAgICAgICBsZW5ndGggKys7CiAgICAgICAgYnl0ZXMzMiBpZCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIGlmIChoZWFkID09IDApIHsKICAgICAgICAgICAgaGVhZCA9IGlkOwogICAgICAgICAgICBpbnNlcnRJbmRleChpZCk7Ci8vICAgICAgICAgICAgRm91bmQoMHhmZmZmZmZmZik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYnl0ZXMzMiBwcmV2aW91cyA9IGZpbmRGbG9vcktleUluZGV4KF90aW1lc3RhbXApOwoKICAgICAgICAvLyByZWplY3QgZHVwbGljYXRlIGtleSBvbiB0aGUgZW5kCiAgICAgICAgcmVxdWlyZShwcmV2aW91cyAhPSBpZCk7CiAgICAgICAgLy8gcmVqZWN0IGR1cGxpY2F0ZSBpbiB0aGUgbWlkZGxlCiAgICAgICAgcmVxdWlyZShzdGF0ZS5nZXQoaWQpID09IDApOwoKICAgICAgICB1aW50IHByZXZUaW1lc3RhbXAgPSBwcmV2aW91cy5nZXRUaW1lc3RhbXAoKTsKLy8gICAgICAgIEZvdW5kKHByZXZUaW1lc3RhbXApOwogICAgICAgIHVpbnQgaGVhZFRpbWVzdGFtcCA9IGhlYWQuZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgLy8gYWRkIGFzIGhlYWQsIHByZXZUaW1lc3RhbXAgPT0gMCBvciBpbiB0aGUgcGFzdAogICAgICAgIGlmIChwcmV2VGltZXN0YW1wIDwgaGVhZFRpbWVzdGFtcCkgewogICAgICAgICAgICBzdGF0ZS5zZXQoaWQsIGhlYWQpOwogICAgICAgICAgICBoZWFkID0gaWQ7CiAgICAgICAgfQogICAgICAgIC8vIGFkZCBhZnRlciB0aGUgcHJldmlvdXMKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3RhdGUuc2V0KGlkLCBzdGF0ZS5nZXQocHJldmlvdXMpKTsKICAgICAgICAgICAgc3RhdGUuc2V0KHByZXZpb3VzLCBpZCk7CiAgICAgICAgfQogICAgICAgIGluc2VydEluZGV4KGlkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVHYXMoYnl0ZXMzMiBfa2V5LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSwgdWludCBfbmV3R2FzTGltaXQpIGludGVybmFsIHsKICAgICAgICBieXRlczMyIGlkID0gS2V5c1V0aWxzLnRvS2V5KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgYnl0ZXMzMiBuZXdJZCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgX25ld0dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIGlmIChpZCA9PSBoZWFkKSB7CiAgICAgICAgICAgIGhlYWQgPSBuZXdJZDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoc3RhdGUuZ2V0KF9rZXkpID09IGlkKTsKICAgICAgICAgICAgc3RhdGUuc2V0KF9rZXksIG5ld0lkKTsKICAgICAgICB9CiAgICAgICAgc3RhdGUuc3dhcChpZCwgbmV3SWQpOwogICAgICAgIHVwZGF0ZUluZGV4KGlkLCBuZXdJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gbmV4dCgpIGludGVybmFsIHsKICAgICAgICBoZWFkID0gc3RhdGUuZ2V0QW5kRGVsKGhlYWQpOwogICAgICAgIGxlbmd0aC0tOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBsZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVjb3JkKGJ5dGVzMzIgX3BhcmVudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczMyIF9yZWNvcmQpIHsKICAgICAgICBpZiAoX3BhcmVudCA9PSAwKSB7CiAgICAgICAgICAgIF9yZWNvcmQgPSBoZWFkOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgX3JlY29yZCA9IHN0YXRlLmdldChfcGFyZW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZpbmQgcHJldmlvdXMga2V5IGZvciBleGlzdGluZyB2YWx1ZS4KICAgICAqLwogICAgZnVuY3Rpb24gZmluZFByZXZpb3VzKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBieXRlczMyIHRhcmdldCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIGJ5dGVzMzIgcHJldmlvdXMgPSBoZWFkOwogICAgICAgIGlmICh0YXJnZXQgPT0gcHJldmlvdXMpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIC8vIGlmIGl0IGlzIG5vdCBoZWFkIHRpbWUKICAgICAgICBpZiAoX3RpbWVzdGFtcCAhPSBwcmV2aW91cy5nZXRUaW1lc3RhbXAoKSkgewogICAgICAgICAgICBwcmV2aW91cyA9IGZpbmRGbG9vcktleUluZGV4KF90aW1lc3RhbXAgLSAxKTsKICAgICAgICB9CiAgICAgICAgYnl0ZXMzMiBjdXJyZW50ID0gc3RhdGUuZ2V0KHByZXZpb3VzKTsKICAgICAgICB3aGlsZSAoY3VycmVudCAhPSB0YXJnZXQpIHsKICAgICAgICAgICAgcHJldmlvdXMgPSBjdXJyZW50OwogICAgICAgICAgICBjdXJyZW50ID0gc3RhdGUuZ2V0KHByZXZpb3VzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByZXZpb3VzOwogICAgfQp9Cgpjb250cmFjdCBKb3VsZVZhdWx0IGlzIE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgam91bGU7CgogICAgZnVuY3Rpb24gc2V0Sm91bGUoYWRkcmVzcyBfam91bGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGpvdWxlID0gX2pvdWxlOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlKb3VsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhqb3VsZSkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoYWRkcmVzcyBfcmVjZWl2ZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIG9ubHlKb3VsZSB7CiAgICAgICAgX3JlY2VpdmVyLnRyYW5zZmVyKF9hbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKCiAgICB9Cn0KCmNvbnRyYWN0IEpvdWxlQ29yZSBpcyBKb3VsZUNvbnRyYWN0SG9sZGVyIHsKICAgIEpvdWxlVmF1bHQgcHVibGljIHZhdWx0OwogICAgdWludDMyIHB1YmxpYyBtaW5HYXNQcmljZUd3ZWkgPSBERUZBVUxUX01JTl9HQVNfUFJJQ0VfR1dFSTsKICAgIHVzaW5nIEtleXNVdGlscyBmb3IgYnl0ZXMzMjsKCiAgICBmdW5jdGlvbiBKb3VsZUNvcmUoSm91bGVWYXVsdCBfdmF1bHQsIGJ5dGVzMzIgX2hlYWQsIHVpbnQgX2xlbmd0aCwgSm91bGVTdG9yYWdlIF9zdG9yYWdlKSBwdWJsaWMKICAgICAgICBKb3VsZUNvbnRyYWN0SG9sZGVyKF9oZWFkLCBfbGVuZ3RoLCBfc3RvcmFnZSkgewogICAgICAgIHZhdWx0ID0gX3ZhdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGlubmVyUmVnaXN0ZXIoYWRkcmVzcyBfcmVnaXN0cmFudCwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHByaWNlID0gZ2V0UHJpY2VJbm5lcihfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcHJpY2UpOwogICAgICAgIHZhdWx0LnRyYW5zZmVyKHByaWNlKTsKCiAgICAgICAgLy8gdGhpcyByZXN0cmljdGlvbiB0byBhdm9pZCBhdHRhY2sgdG8gYnJha2UgaW5kZXggdHJlZSAoY3Jvc3Npbmcga2V5KQogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wID4gbm93KTsKICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPCAweDEwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgPD0gTUFYX0dBUyk7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgIT0gMCk7CiAgICAgICAgLy8gZnJvbSAxIGd3ZWkgdG8gMHgxMDAwMDAwMDAgZ3dlaQogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlID49IG1pbkdhc1ByaWNlR3dlaSAqIEdXRUkpOwogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlIDwgTUFYX0dBU19QUklDRSk7CiAgICAgICAgLy8gMCBtZWFucyBub3QgeWV0IHJlZ2lzdGVyZWQKICAgICAgICByZXF1aXJlKF9yZWdpc3RyYW50ICE9IDB4MCk7CgogICAgICAgIHVpbnQgaW5uZXJHYXNQcmljZSA9IF9nYXNQcmljZSAvIEdXRUk7CiAgICAgICAgaW5zZXJ0KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIGlubmVyR2FzUHJpY2UpOwogICAgICAgIHNhdmVSZWdpc3RyYW50KF9yZWdpc3RyYW50LCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBpbm5lckdhc1ByaWNlKTsKCiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IHByaWNlKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlIC0gcHJpY2UpOwogICAgICAgICAgICByZXR1cm4gbXNnLnZhbHVlIC0gcHJpY2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhdmVSZWdpc3RyYW50KGFkZHJlc3MgX3JlZ2lzdHJhbnQsIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCwgdWludCkgaW50ZXJuYWwgewogICAgICAgIGJ5dGVzMzIgaWQgPSBLZXlzVXRpbHMudG9LZXkoX2FkZHJlc3MsIF90aW1lc3RhbXAsIDAsIDApOwogICAgICAgIHJlcXVpcmUoc3RhdGUuZ2V0KGlkKSA9PSAwKTsKICAgICAgICBzdGF0ZS5zZXQoaWQsIGJ5dGVzMzIoX3JlZ2lzdHJhbnQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZWdpc3RyYW50KGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCwgdWludCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiBpZCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgMCwgMCk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3Moc3RhdGUuZ2V0KGlkKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsUmVnaXN0cmFudChLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBjdXJyZW50KSBpbnRlcm5hbCB7CiAgICAgICAgYnl0ZXMzMiBpZCA9IEtleXNVdGlscy50b0tleShjdXJyZW50LmNvbnRyYWN0QWRkcmVzcywgY3VycmVudC50aW1lc3RhbXAsIDAsIDApOwogICAgICAgIHN0YXRlLmRlbChpZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEtleShhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wID4gbm93KTsKICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPCAweDEwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgPCBNQVhfR0FTKTsKICAgICAgICByZXF1aXJlKF9nYXNQcmljZSA+IEdXRUkpOwogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlIDwgMHgxMDAwMDAwMDAgKiBHV0VJKTsKICAgICAgICByZXR1cm4gZmluZFByZXZpb3VzKF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSAvIEdXRUkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlubmVyVW5yZWdpc3RlcihhZGRyZXNzIF9yZWdpc3RyYW50LCBieXRlczMyIF9rZXksIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gb25seSBmdXR1cmUgcmVnaXN0cmF0aW9ucyBtaWdodCBiZSB1cGRhdGVkLCB0byBhdm9pZCByYWNlIGNvbmRpdGlvbiBpbiBibG9jayAod2l0aCBpbnZva2UpCiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wID4gbm93KTsKICAgICAgICAvLyB0byBhdm9pZCByZW1vdmluZyBhbHJlYWR5IHJlbW92ZWQga2V5cwogICAgICAgIHJlcXVpcmUoX2dhc0xpbWl0ICE9IDApOwogICAgICAgIHVpbnQgaW5uZXJHYXNQcmljZSA9IF9nYXNQcmljZSAvIEdXRUk7CiAgICAgICAgLy8gY2hlY2sgcmVnaXN0cmFudAogICAgICAgIGFkZHJlc3MgcmVnaXN0cmFudCA9IGdldFJlZ2lzdHJhbnQoX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgaW5uZXJHYXNQcmljZSk7CiAgICAgICAgcmVxdWlyZShyZWdpc3RyYW50ID09IF9yZWdpc3RyYW50KTsKCiAgICAgICAgdXBkYXRlR2FzKF9rZXksIF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIGlubmVyR2FzUHJpY2UsIDApOwogICAgICAgIHVpbnQgYW1vdW50ID0gX2dhc0xpbWl0ICogX2dhc1ByaWNlOwogICAgICAgIGlmIChhbW91bnQgIT0gMCkgewogICAgICAgICAgICB2YXVsdC53aXRoZHJhdyhyZWdpc3RyYW50LCBhbW91bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgPD0gTUFYX0dBUyk7CiAgICAgICAgcmVxdWlyZShfZ2FzUHJpY2UgPiBHV0VJKTsKICAgICAgICByZXF1aXJlKF9nYXNQcmljZSA8IDB4MTAwMDAwMDAwICogR1dFSSk7CgogICAgICAgIHJldHVybiBnZXRQcmljZUlubmVyKF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcmljZUlubmVyKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gaWYgdGhpcyBsb2dpYyB3aWxsIGJlIGNoYW5nZWQsIGxvb2sgYWxzbyB0byB0aGUgaW5uZXJVbnJlZ2lzdGVyIG1ldGhvZAogICAgICAgIHJldHVybiAoX2dhc0xpbWl0ICsgSk9VTEVfR0FTKSAqIF9nYXNQcmljZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9uKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczgpIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb3AodWludCBfY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzc1tdIF9hZGRyZXNzZXMsCiAgICAgICAgdWludFtdIF90aW1lc3RhbXBzLAogICAgICAgIHVpbnRbXSBfZ2FzTGltaXRzLAogICAgICAgIHVpbnRbXSBfZ2FzUHJpY2VzLAogICAgICAgIHVpbnRbXSBfaW52b2tlR2FzZXMsCiAgICAgICAgdWludFtdIF9yZXdhcmRBbW91bnRzCiAgICApIHsKICAgICAgICB1aW50IGFtb3VudCA9IF9jb3VudCA8PSBsZW5ndGggPyBfY291bnQgOiBsZW5ndGg7CgogICAgICAgIF9hZGRyZXNzZXMgPSBuZXcgYWRkcmVzc1tdKGFtb3VudCk7CiAgICAgICAgX3RpbWVzdGFtcHMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX2dhc0xpbWl0cyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfZ2FzUHJpY2VzID0gbmV3IHVpbnRbXShhbW91bnQpOwogICAgICAgIF9pbnZva2VHYXNlcyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfcmV3YXJkQW1vdW50cyA9IG5ldyB1aW50W10oYW1vdW50KTsKCiAgICAgICAgYnl0ZXMzMiBjdXJyZW50ID0gZ2V0UmVjb3JkKDApOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFtb3VudDsgaSArKykgewogICAgICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBvYmogPSBjdXJyZW50LnRvT2JqZWN0KCk7CiAgICAgICAgICAgIF9hZGRyZXNzZXNbaV0gPSBvYmouY29udHJhY3RBZGRyZXNzOwogICAgICAgICAgICBfdGltZXN0YW1wc1tpXSA9IG9iai50aW1lc3RhbXA7CiAgICAgICAgICAgIHVpbnQgZ2FzTGltaXQgPSBvYmouZ2FzTGltaXQ7CiAgICAgICAgICAgIF9nYXNMaW1pdHNbaV0gPSBnYXNMaW1pdDsKICAgICAgICAgICAgdWludCBnYXNQcmljZSA9IG9iai5nYXNQcmljZUd3ZWkgKiBHV0VJOwogICAgICAgICAgICBfZ2FzUHJpY2VzW2ldID0gZ2FzUHJpY2U7CiAgICAgICAgICAgIHVpbnQgaW52b2tlR2FzID0gZ2FzTGltaXQgKyBKT1VMRV9HQVM7CiAgICAgICAgICAgIF9pbnZva2VHYXNlc1tpXSA9IGludm9rZUdhczsKICAgICAgICAgICAgX3Jld2FyZEFtb3VudHNbaV0gPSBpbnZva2VHYXMgKiBnYXNQcmljZTsKICAgICAgICAgICAgY3VycmVudCA9IGdldFJlY29yZChjdXJyZW50KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9wT25jZSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlLAogICAgICAgIHVpbnQgaW52b2tlR2FzLAogICAgICAgIHVpbnQgcmV3YXJkQW1vdW50CiAgICApIHsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBvYmogPSBnZXRSZWNvcmQoMCkudG9PYmplY3QoKTsKCiAgICAgICAgY29udHJhY3RBZGRyZXNzID0gb2JqLmNvbnRyYWN0QWRkcmVzczsKICAgICAgICB0aW1lc3RhbXAgPSBvYmoudGltZXN0YW1wOwogICAgICAgIGdhc0xpbWl0ID0gb2JqLmdhc0xpbWl0OwogICAgICAgIGdhc1ByaWNlID0gb2JqLmdhc1ByaWNlR3dlaSAqIEdXRUk7CiAgICAgICAgaW52b2tlR2FzID0gZ2FzTGltaXQgKyBKT1VMRV9HQVM7CiAgICAgICAgcmV3YXJkQW1vdW50ID0gaW52b2tlR2FzICogZ2FzUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TmV4dE9uY2UoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlLAogICAgICAgIHVpbnQgaW52b2tlR2FzLAogICAgICAgIHVpbnQgcmV3YXJkQW1vdW50CiAgICApIHsKICAgICAgICBpZiAoX3RpbWVzdGFtcCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRvcE9uY2UoKTsKICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgcHJldiA9IEtleXNVdGlscy50b0tleShfY29udHJhY3RBZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSAvIEdXRUkpOwogICAgICAgIGJ5dGVzMzIgY3VycmVudCA9IGdldFJlY29yZChwcmV2KTsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBvYmogPSBjdXJyZW50LnRvT2JqZWN0KCk7CgogICAgICAgIGNvbnRyYWN0QWRkcmVzcyA9IG9iai5jb250cmFjdEFkZHJlc3M7CiAgICAgICAgdGltZXN0YW1wID0gb2JqLnRpbWVzdGFtcDsKICAgICAgICBnYXNMaW1pdCA9IG9iai5nYXNMaW1pdDsKICAgICAgICBnYXNQcmljZSA9IG9iai5nYXNQcmljZUd3ZWkgKiBHV0VJOwogICAgICAgIGludm9rZUdhcyA9IGdhc0xpbWl0ICsgSk9VTEVfR0FTOwogICAgICAgIHJld2FyZEFtb3VudCA9IGludm9rZUdhcyAqIGdhc1ByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE5leHQodWludCBfY291bnQsCiAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgIHVpbnQgX3RpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNMaW1pdCwKICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzW10gX2FkZHJlc3NlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gX3RpbWVzdGFtcHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIF9nYXNMaW1pdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIF9nYXNQcmljZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIF9pbnZva2VHYXNlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gX3Jld2FyZEFtb3VudHMpIHsKICAgICAgICBfYWRkcmVzc2VzID0gbmV3IGFkZHJlc3NbXShfY291bnQpOwogICAgICAgIF90aW1lc3RhbXBzID0gbmV3IHVpbnRbXShfY291bnQpOwogICAgICAgIF9nYXNMaW1pdHMgPSBuZXcgdWludFtdKF9jb3VudCk7CiAgICAgICAgX2dhc1ByaWNlcyA9IG5ldyB1aW50W10oX2NvdW50KTsKICAgICAgICBfaW52b2tlR2FzZXMgPSBuZXcgdWludFtdKF9jb3VudCk7CiAgICAgICAgX3Jld2FyZEFtb3VudHMgPSBuZXcgdWludFtdKF9jb3VudCk7CgogICAgICAgIGJ5dGVzMzIgcHJldjsKICAgICAgICBpZiAoX3RpbWVzdGFtcCAhPSAwKSB7CiAgICAgICAgICAgIHByZXYgPSBLZXlzVXRpbHMudG9LZXkoX2NvbnRyYWN0QWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UgLyBHV0VJKTsKICAgICAgICB9CgogICAgICAgIHVpbnQgaW5kZXggPSAwOwogICAgICAgIHdoaWxlIChpbmRleCA8IF9jb3VudCkgewogICAgICAgICAgICBieXRlczMyIGN1cnJlbnQgPSBnZXRSZWNvcmQocHJldik7CiAgICAgICAgICAgIGlmIChjdXJyZW50ID09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEtleXNVdGlscy5PYmplY3QgbWVtb3J5IG9iaiA9IGN1cnJlbnQudG9PYmplY3QoKTsKCiAgICAgICAgICAgIF9hZGRyZXNzZXNbaW5kZXhdID0gb2JqLmNvbnRyYWN0QWRkcmVzczsKICAgICAgICAgICAgX3RpbWVzdGFtcHNbaW5kZXhdID0gb2JqLnRpbWVzdGFtcDsKICAgICAgICAgICAgX2dhc0xpbWl0c1tpbmRleF0gPSBvYmouZ2FzTGltaXQ7CiAgICAgICAgICAgIF9nYXNQcmljZXNbaW5kZXhdID0gb2JqLmdhc1ByaWNlR3dlaSAqIEdXRUk7CiAgICAgICAgICAgIF9pbnZva2VHYXNlc1tpbmRleF0gPSBvYmouZ2FzTGltaXQgKyBKT1VMRV9HQVM7CiAgICAgICAgICAgIF9yZXdhcmRBbW91bnRzW2luZGV4XSA9IChvYmouZ2FzTGltaXQgKyBKT1VMRV9HQVMpICogb2JqLmdhc1ByaWNlR3dlaSAqIEdXRUk7CgogICAgICAgICAgICBwcmV2ID0gY3VycmVudDsKICAgICAgICAgICAgaW5kZXggKys7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG5leHQoS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgY3VycmVudCkgaW50ZXJuYWwgewogICAgICAgIGRlbFJlZ2lzdHJhbnQoY3VycmVudCk7CiAgICAgICAgbmV4dCgpOwogICAgfQoKCiAgICBmdW5jdGlvbiBpbm5lckludm9rZShhZGRyZXNzIF9pbnZva2VyKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9hbW91bnQpIHsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBjdXJyZW50ID0gS2V5c1V0aWxzLnRvT2JqZWN0KGhlYWQpOwoKICAgICAgICB1aW50IGFtb3VudDsKICAgICAgICB3aGlsZSAoY3VycmVudC50aW1lc3RhbXAgIT0gMCAmJiBjdXJyZW50LnRpbWVzdGFtcCA8IG5vdyAmJiBtc2cuZ2FzID4gKGN1cnJlbnQuZ2FzTGltaXQgKyBSRU1BSU5JTkdfR0FTKSkgewogICAgICAgICAgICBpZiAoY3VycmVudC5nYXNMaW1pdCAhPSAwKSB7CiAgICAgICAgICAgICAgICBpbnZva2VDYWxsYmFjayhfaW52b2tlciwgY3VycmVudCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFtb3VudCArPSBnZXRQcmljZUlubmVyKGN1cnJlbnQuZ2FzTGltaXQsIGN1cnJlbnQuZ2FzUHJpY2VHd2VpICogR1dFSSk7CiAgICAgICAgICAgIG5leHQoY3VycmVudCk7CiAgICAgICAgICAgIGN1cnJlbnQgPSBoZWFkLnRvT2JqZWN0KCk7CiAgICAgICAgfQogICAgICAgIGlmIChhbW91bnQgPiAwKSB7CiAgICAgICAgICAgIHZhdWx0LndpdGhkcmF3KG1zZy5zZW5kZXIsIGFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW5uZXJJbnZva2VPbmNlKGFkZHJlc3MgX2ludm9rZXIpIGludGVybmFsIHJldHVybnMgKHVpbnQgX2Ftb3VudCkgewogICAgICAgIEtleXNVdGlscy5PYmplY3QgbWVtb3J5IGN1cnJlbnQgPSBoZWFkLnRvT2JqZWN0KCk7CiAgICAgICAgbmV4dChjdXJyZW50KTsKICAgICAgICBpZiAoY3VycmVudC5nYXNMaW1pdCAhPSAwKSB7CiAgICAgICAgICAgIGludm9rZUNhbGxiYWNrKF9pbnZva2VyLCBjdXJyZW50KTsKICAgICAgICB9CgogICAgICAgIHVpbnQgYW1vdW50ID0gZ2V0UHJpY2VJbm5lcihjdXJyZW50Lmdhc0xpbWl0LCBjdXJyZW50Lmdhc1ByaWNlR3dlaSAqIEdXRUkpOwoKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICB2YXVsdC53aXRoZHJhdyhtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKCiAgICBmdW5jdGlvbiBpbnZva2VDYWxsYmFjayhhZGRyZXNzLCBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBfcmVjb3JkKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShtc2cuZ2FzID49IF9yZWNvcmQuZ2FzTGltaXQpOwogICAgICAgIHJldHVybiBfcmVjb3JkLmNvbnRyYWN0QWRkcmVzcy5jYWxsLmdhcyhfcmVjb3JkLmdhc0xpbWl0KSgweDkxOTg0MGFkKTsKICAgIH0KCn0KCgpjb250cmFjdCBKb3VsZUJlaGluZFByb3h5IGlzIEpvdWxlQ29yZSwgT3duYWJsZSwgVHJhbnNmZXJUb2tlbiB7CiAgICBKb3VsZVByb3h5QVBJIHB1YmxpYyBwcm94eTsKCiAgICBmdW5jdGlvbiBKb3VsZUJlaGluZFByb3h5KEpvdWxlVmF1bHQgX3ZhdWx0LCBieXRlczMyIF9oZWFkLCB1aW50IF9sZW5ndGgsIEpvdWxlU3RvcmFnZSBfc3RvcmFnZSkgcHVibGljCiAgICAgICAgSm91bGVDb3JlKF92YXVsdCwgX2hlYWQsIF9sZW5ndGgsIF9zdG9yYWdlKSB7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UHJveHkoSm91bGVQcm94eUFQSSBfcHJveHkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHByb3h5ID0gX3Byb3h5OwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlQcm94eSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhwcm94eSkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TWluR2FzUHJpY2UodWludCBfbWluR2FzUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX21pbkdhc1ByaWNlID49IE1JTl9HQVNfUFJJQ0UpOwogICAgICAgIHJlcXVpcmUoX21pbkdhc1ByaWNlIDw9IE1BWF9HQVNfUFJJQ0UpOwogICAgICAgIG1pbkdhc1ByaWNlR3dlaSA9IHVpbnQzMihfbWluR2FzUHJpY2UgLyBHV0VJKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlckZvcihhZGRyZXNzIF9yZWdpc3RyYW50LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHBheWFibGUgb25seVByb3h5IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW5uZXJSZWdpc3RlcihfcmVnaXN0cmFudCwgX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyRm9yKGFkZHJlc3MgX3JlZ2lzdHJhbnQsIGJ5dGVzMzIgX2tleSwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyBvbmx5UHJveHkgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBpbm5lclVucmVnaXN0ZXIoX3JlZ2lzdHJhbnQsIF9rZXksIF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlRm9yKGFkZHJlc3MgX2ludm9rZXIpIHB1YmxpYyBvbmx5UHJveHkgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBpbm5lckludm9rZShfaW52b2tlcik7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlT25jZUZvcihhZGRyZXNzIF9pbnZva2VyKSBwdWJsaWMgb25seVByb3h5IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW5uZXJJbnZva2VPbmNlKF9pbnZva2VyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VDYWxsYmFjayhhZGRyZXNzIF9pbnZva2VyLCBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBfcmVjb3JkKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHByb3h5LmNhbGxiYWNrKF9pbnZva2VyLCBfcmVjb3JkLmNvbnRyYWN0QWRkcmVzcywgX3JlY29yZC50aW1lc3RhbXAsIF9yZWNvcmQuZ2FzTGltaXQsIF9yZWNvcmQuZ2FzUHJpY2VHd2VpICogR1dFSSk7CiAgICB9Cn0KCmNvbnRyYWN0IEpvdWxlUHJveHkgaXMgSm91bGVQcm94eUFQSSwgSm91bGVBUEksIE93bmFibGUsIFRyYW5zZmVyVG9rZW4sIHVzaW5nQ29uc3RzIHsKICAgIEpvdWxlQmVoaW5kUHJveHkgcHVibGljIGpvdWxlOwoKICAgIGZ1bmN0aW9uIHNldEpvdWxlKEpvdWxlQmVoaW5kUHJveHkgX2pvdWxlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBqb3VsZSA9IF9qb3VsZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Sm91bGUoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Moam91bGUpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gam91bGUuZ2V0Q291bnQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJlZ2lzdGVyRm9yKG1zZy5zZW5kZXIsIF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVnaXN0ZXJGb3IoYWRkcmVzcyBfcmVnaXN0cmFudCwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBSZWdpc3RlcmVkKF9yZWdpc3RyYW50LCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIHVpbnQgY2hhbmdlID0gam91bGUucmVnaXN0ZXJGb3IudmFsdWUobXNnLnZhbHVlKShfcmVnaXN0cmFudCwgX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgICAgICBpZiAoY2hhbmdlID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGNoYW5nZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjaGFuZ2U7CiAgICB9CgogICAgZnVuY3Rpb24gdW5yZWdpc3RlcihieXRlczMyIF9rZXksIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gdW5yZWdpc3RlciB3aWxsIHJldHVybiBmdW5kcyB0byByZWdpc3RyYW50LCBub3QgdG8gbXNnLnNlbmRlciAodW5saWtlIHJlZ2lzdGVyKQogICAgICAgIHVpbnQgYW1vdW50ID0gam91bGUudW5yZWdpc3RlckZvcihtc2cuc2VuZGVyLCBfa2V5LCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIFVucmVnaXN0ZXJlZChtc2cuc2VuZGVyLCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UsIGFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kS2V5KGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIGpvdWxlLmZpbmRLZXkoX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2UoKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBpbnZva2VGb3IobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlRm9yKGFkZHJlc3MgX2ludm9rZXIpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBhbW91bnQgPSBqb3VsZS5pbnZva2VGb3IoX2ludm9rZXIpOwogICAgICAgIGlmIChhbW91bnQgPiAwKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VPbmNlKCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW52b2tlT25jZUZvcihtc2cuc2VuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VPbmNlRm9yKGFkZHJlc3MgX2ludm9rZXIpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBhbW91bnQgPSBqb3VsZS5pbnZva2VPbmNlRm9yKF9pbnZva2VyKTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGpvdWxlLmdldFByaWNlKF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb3BPbmNlKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzcywKICAgICAgICB1aW50IHRpbWVzdGFtcCwKICAgICAgICB1aW50IGdhc0xpbWl0LAogICAgICAgIHVpbnQgZ2FzUHJpY2UsCiAgICAgICAgdWludCBpbnZva2VHYXMsCiAgICAgICAgdWludCByZXdhcmRBbW91bnQKICAgICkgewogICAgICAgIChjb250cmFjdEFkZHJlc3MsIHRpbWVzdGFtcCwgZ2FzTGltaXQsIGdhc1ByaWNlLCBpbnZva2VHYXMsIHJld2FyZEFtb3VudCkgPSBqb3VsZS5nZXRUb3BPbmNlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TmV4dE9uY2UoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlLAogICAgICAgIHVpbnQgaW52b2tlR2FzLAogICAgICAgIHVpbnQgcmV3YXJkQW1vdW50CiAgICApIHsKICAgICAgICAoY29udHJhY3RBZGRyZXNzLCB0aW1lc3RhbXAsIGdhc0xpbWl0LCBnYXNQcmljZSwgaW52b2tlR2FzLCByZXdhcmRBbW91bnQpID0gam91bGUuZ2V0TmV4dE9uY2UoX2NvbnRyYWN0QWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgfQoKCiAgICBmdW5jdGlvbiBnZXROZXh0KHVpbnQgX2NvdW50LAogICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgdWludCBfZ2FzTGltaXQsCiAgICAgICAgICAgICAgICAgICAgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzc1tdIF9hZGRyZXNzZXMsCiAgICAgICAgdWludFtdIF90aW1lc3RhbXBzLAogICAgICAgIHVpbnRbXSBfZ2FzTGltaXRzLAogICAgICAgIHVpbnRbXSBfZ2FzUHJpY2VzLAogICAgICAgIHVpbnRbXSBfaW52b2tlR2FzZXMsCiAgICAgICAgdWludFtdIF9yZXdhcmRBbW91bnRzCiAgICApIHsKICAgICAgICBfYWRkcmVzc2VzID0gbmV3IGFkZHJlc3NbXShfY291bnQpOwogICAgICAgIF90aW1lc3RhbXBzID0gbmV3IHVpbnRbXShfY291bnQpOwogICAgICAgIF9nYXNMaW1pdHMgPSBuZXcgdWludFtdKF9jb3VudCk7CiAgICAgICAgX2dhc1ByaWNlcyA9IG5ldyB1aW50W10oX2NvdW50KTsKICAgICAgICBfaW52b2tlR2FzZXMgPSBuZXcgdWludFtdKF9jb3VudCk7CiAgICAgICAgX3Jld2FyZEFtb3VudHMgPSBuZXcgdWludFtdKF9jb3VudCk7CgogICAgICAgIHVpbnQgaSA9IDA7CgogICAgICAgIChfYWRkcmVzc2VzW2ldLCBfdGltZXN0YW1wc1tpXSwgX2dhc0xpbWl0c1tpXSwgX2dhc1ByaWNlc1tpXSwgX2ludm9rZUdhc2VzW2ldLCBfcmV3YXJkQW1vdW50c1tpXSkgPSBqb3VsZS5nZXROZXh0T25jZShfY29udHJhY3RBZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CgogICAgICAgIGZvciAoaSArPSAxOyBpIDwgX2NvdW50OyBpICsrKSB7CiAgICAgICAgICAgIGlmIChfdGltZXN0YW1wc1tpIC0gMV0gPT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKF9hZGRyZXNzZXNbaV0sIF90aW1lc3RhbXBzW2ldLCBfZ2FzTGltaXRzW2ldLCBfZ2FzUHJpY2VzW2ldLCBfaW52b2tlR2FzZXNbaV0sIF9yZXdhcmRBbW91bnRzW2ldKSA9IGpvdWxlLmdldE5leHRPbmNlKF9hZGRyZXNzZXNbaSAtIDFdLCBfdGltZXN0YW1wc1tpIC0gMV0sIF9nYXNMaW1pdHNbaSAtIDFdLCBfZ2FzUHJpY2VzW2kgLSAxXSk7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBnZXRUb3AodWludCBfY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzc1tdIF9hZGRyZXNzZXMsCiAgICAgICAgdWludFtdIF90aW1lc3RhbXBzLAogICAgICAgIHVpbnRbXSBfZ2FzTGltaXRzLAogICAgICAgIHVpbnRbXSBfZ2FzUHJpY2VzLAogICAgICAgIHVpbnRbXSBfaW52b2tlR2FzZXMsCiAgICAgICAgdWludFtdIF9yZXdhcmRBbW91bnRzCiAgICApIHsKICAgICAgICB1aW50IGxlbmd0aCA9IGpvdWxlLmdldENvdW50KCk7CiAgICAgICAgdWludCBhbW91bnQgPSBfY291bnQgPD0gbGVuZ3RoID8gX2NvdW50IDogbGVuZ3RoOwoKICAgICAgICBfYWRkcmVzc2VzID0gbmV3IGFkZHJlc3NbXShhbW91bnQpOwogICAgICAgIF90aW1lc3RhbXBzID0gbmV3IHVpbnRbXShhbW91bnQpOwogICAgICAgIF9nYXNMaW1pdHMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX2dhc1ByaWNlcyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfaW52b2tlR2FzZXMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX3Jld2FyZEFtb3VudHMgPSBuZXcgdWludFtdKGFtb3VudCk7CgogICAgICAgIHVpbnQgaSA9IDA7CgogICAgICAgIChfYWRkcmVzc2VzW2ldLCBfdGltZXN0YW1wc1tpXSwgX2dhc0xpbWl0c1tpXSwgX2dhc1ByaWNlc1tpXSwgX2ludm9rZUdhc2VzW2ldLCBfcmV3YXJkQW1vdW50c1tpXSkgPSBqb3VsZS5nZXRUb3BPbmNlKCk7CgogICAgICAgIGZvciAoaSArPSAxOyBpIDwgYW1vdW50OyBpICsrKSB7CiAgICAgICAgICAgIChfYWRkcmVzc2VzW2ldLCBfdGltZXN0YW1wc1tpXSwgX2dhc0xpbWl0c1tpXSwgX2dhc1ByaWNlc1tpXSwgX2ludm9rZUdhc2VzW2ldLCBfcmV3YXJkQW1vdW50c1tpXSkgPSBqb3VsZS5nZXROZXh0T25jZShfYWRkcmVzc2VzW2kgLSAxXSwgX3RpbWVzdGFtcHNbaSAtIDFdLCBfZ2FzTGltaXRzW2kgLSAxXSwgX2dhc1ByaWNlc1tpIC0gMV0pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9uKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczgpIHsKICAgICAgICByZXR1cm4gam91bGUuZ2V0VmVyc2lvbigpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1pbkdhc1ByaWNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBqb3VsZS5taW5HYXNQcmljZUd3ZWkoKSAqIEdXRUk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsbGJhY2soYWRkcmVzcyBfaW52b2tlciwgYWRkcmVzcyBfYWRkcmVzcywgdWludCwgdWludCBfZ2FzTGltaXQsIHVpbnQpIHB1YmxpYyBvbmx5Sm91bGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobXNnLmdhcyA+PSBfZ2FzTGltaXQpOwogICAgICAgIHVpbnQgZ2FzID0gbXNnLmdhczsKICAgICAgICBib29sIHN0YXR1cyA9IF9hZGRyZXNzLmNhbGwuZ2FzKF9nYXNMaW1pdCkoMHg5MTk4NDBhZCk7CiAgICAgICAgSW52b2tlZChfaW52b2tlciwgX2FkZHJlc3MsIHN0YXR1cywgZ2FzIC0gbXNnLmdhcyk7CiAgICAgICAgcmV0dXJuIHN0YXR1czsKICAgIH0KfQ=='.
	

]
