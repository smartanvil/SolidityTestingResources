Class {
	#name : #SRTdf68995f07882120b44da1d0fabf41ca1681deec,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdf68995f07882120b44da1d0fabf41ca1681deec >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgoKLyoqCiAqIFByb3ZpZGUgcGxhdGZvcm0gY29udHJhY3QuCiAqLwpjb250cmFjdCBQcm92aWRlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqIFByb3ZpZGUgY29udHJhY3Qgb3duZXI7IGhhcyBhYmlsaXR5IHRvIHVwZGF0ZSB0aGUgcGxhdGZvcm0gcm9ib3QgYWRkcmVzcy4gKi8KICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgLyoqIFByb3ZpZGUgKFBSVkQpIHRva2VuLiAqLwogIFByb3ZpZGVUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8qKiBQcm92aWRlIHBsYXRmb3JtIHJvYm90OyBoYXMgYWJpbGl0eSB0byB1cGRhdGUgdGhlIHdhbGxldCBjb250cmFjdCBhZGRyZXNzZXMuICovCiAgYWRkcmVzcyBwdWJsaWMgcHJ2ZDsKCiAgLyoqIFByb3ZpZGUgcGxhdGZvcm0gd2FsbGV0IHdoZXJlIGZlZXMgb3dlZCB0byBQcm92aWRlIGFyZSByZW1pdHRlZC4gKi8KICBhZGRyZXNzIHB1YmxpYyBwcnZkV2FsbGV0OwoKICAvKiogUHJvdmlkZSBwbGF0Zm9ybSB3YWxsZXQgd2hlcmUgcGF5bWVudCBhbW91bnRzIG93ZWQgdG8gcHJvdmlkZXJzIGFyZSBlc2Nyb3dlZC4gKi8KICBhZGRyZXNzIHB1YmxpYyBwYXltZW50RXNjcm93OwoKICAvKioKICAgKiBAcGFyYW0gX3BydmQgUHJvdmlkZSBwbGF0Zm9ybSByb2JvdCBjb250cmFjdCBhZGRyZXNzCiAgICogQHBhcmFtIF9wcnZkV2FsbGV0IFByb3ZpZGUgcGxhdGZvcm0gd2FsbGV0IHdoZXJlIGZlZXMgb3dlZCB0byBQcm92aWRlIGFyZSByZW1pdHRlZAogICAqIEBwYXJhbSBfcGF5bWVudEVzY3JvdyBQcm92aWRlIHBsYXRmb3JtIHdhbGxldCB3aGVyZSBwYXltZW50IGFtb3VudHMgb3dlZCB0byBwcm92aWRlcnMgYXJlIGVzY3Jvd2VkCiAgICovCiAgZnVuY3Rpb24gUHJvdmlkZSgKICAgIGFkZHJlc3MgX3Rva2VuLAogICAgYWRkcmVzcyBfcHJ2ZCwKICAgIGFkZHJlc3MgX3BydmRXYWxsZXQsCiAgICBhZGRyZXNzIF9wYXltZW50RXNjcm93CiAgKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB0b2tlbiA9IFByb3ZpZGVUb2tlbihfdG9rZW4pOwogICAgcHJ2ZCA9IF9wcnZkOwogICAgcHJ2ZFdhbGxldCA9IF9wcnZkV2FsbGV0OwogICAgcGF5bWVudEVzY3JvdyA9IF9wYXltZW50RXNjcm93OwogIH0KCiAgLyoqCiAgICogRGVwbG95IGEgd29yayBvcmRlciBjb250cmFjdC4KICAgKiBAcGFyYW0gX3BlZXIgQWRkcmVzcyBvZiBwYXJ0eSBwdXJjaGFzaW5nIHNlcnZpY2VzCiAgICogQHBhcmFtIF9pZGVudGlmaWVyIFByb3ZpZGUgcGxhdGZvcm0gd29yayBvcmRlciBpZGVudGlmaWVyIChVVUlEdjQpCiAgICovCiAgZnVuY3Rpb24gY3JlYXRlV29ya09yZGVyKAogICAgYWRkcmVzcyBfcGVlciwKICAgIHVpbnQxMjggX2lkZW50aWZpZXIKICApIG9ubHlQcnZkIHJldHVybnMoYWRkcmVzcyB3b3JrT3JkZXIpIHsKICAgIHJldHVybiBuZXcgUHJvdmlkZVdvcmtPcmRlcih0b2tlbiwgcHJ2ZCwgcHJ2ZFdhbGxldCwgcGF5bWVudEVzY3JvdywgX3BlZXIsIF9pZGVudGlmaWVyKTsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSBjb250cmFjdCBvd25lciB0byB1cGRhdGUgUHJvdmlkZSBwbGF0Zm9ybSByb2JvdC4KICAgKi8KICBmdW5jdGlvbiBzZXRQcnZkKGFkZHJlc3MgX3BydmQpIG9ubHlPd25lciB7CiAgICBpZiAoX3BydmQgPT0gMHgwKSByZXZlcnQoKTsKICAgIHBydmQgPSBfcHJ2ZDsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSBQcm92aWRlIHBsYXRmb3JtIHJvYm90IHRvIHVwZGF0ZSB0aGUgUHJvdmlkZSB3YWxsZXQgY29udHJhY3QgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcnZkV2FsbGV0KGFkZHJlc3MgX3BydmRXYWxsZXQpIG9ubHlQcnZkIHsKICAgIGlmIChfcHJ2ZFdhbGxldCA9PSAweDApIHJldmVydCgpOwogICAgcHJ2ZFdhbGxldCA9IF9wcnZkV2FsbGV0OwogIH0KCiAgLyoqCiAgICogQWxsb3cgdGhlIFByb3ZpZGUgcGxhdGZvcm0gcm9ib3QgdG8gdXBkYXRlIHRoZSBwYXltZW50cyBlc2Nyb3cgd2FsbGV0IGNvbnRyYWN0IGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gc2V0UGF5bWVudEVzY3JvdyhhZGRyZXNzIF9wYXltZW50RXNjcm93KSBvbmx5UHJ2ZCB7CiAgICBpZiAoX3BheW1lbnRFc2Nyb3cgPT0gMHgwKSByZXZlcnQoKTsKICAgIHBheW1lbnRFc2Nyb3cgPSBfcGF5bWVudEVzY3JvdzsKICB9CgogIC8qKgogICAqIE9ubHkgYWxsb3cgdGhlIFByb3ZpZGUgY29udHJhY3Qgb3duZXIgdG8gZXhlY3V0ZSBhIGNvbnRyYWN0IGZ1bmN0aW9uLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSByZXZlcnQoKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBPbmx5IGFsbG93IHRoZSBQcm92aWRlIHBsYXRmb3JtIHJvYm90IHRvIGV4ZWN1dGUgYSBjb250cmFjdCBmdW5jdGlvbi4KICAgKi8KICBtb2RpZmllciBvbmx5UHJ2ZCgpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IHBydmQpIHJldmVydCgpOwogICAgXzsKICB9Cn0KCi8qKgogKiBCYXNlIGNvbnRyYWN0IGZvciB3b3JrIG9yZGVycyBvbiB0aGUgUHJvdmlkZSBwbGF0Zm9ybS4KICovCmNvbnRyYWN0IFByb3ZpZGVXb3JrT3JkZXIgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKiogU3RhdHVzIG9mIHRoZSB3b3JrIG9yZGVyIGNvbnRyYWN0LiAqKi8KICBlbnVtIFN0YXR1cyB7IFBlbmRpbmcsIEluUHJvZ3Jlc3MsIENvbXBsZXRlZCwgUGFpZCB9CgogIC8qKiBQcm92aWRlIChQUlZEKSB0b2tlbi4gKi8KICBQcm92aWRlVG9rZW4gcHVibGljIHRva2VuOwoKICAvKiogUHJvdmlkZSBwbGF0Zm9ybSByb2JvdC4gKi8KICBhZGRyZXNzIHB1YmxpYyBwcnZkOwoKICAvKiogUHJvdmlkZSBwbGF0Zm9ybSB3YWxsZXQgd2hlcmUgZmVlcyBvd2VkIHRvIFByb3ZpZGUgYXJlIHJlbWl0dGVkLiAqLwogIGFkZHJlc3MgcHVibGljIHBydmRXYWxsZXQ7CgogIC8qKiBQcm92aWRlIHBsYXRmb3JtIHdhbGxldCB3aGVyZSBwYXltZW50IGFtb3VudHMgb3dlZCB0byBwcm92aWRlcnMgYXJlIGVzY3Jvd2VkLiAqLwogIGFkZHJlc3MgcHVibGljIHBheW1lbnRFc2Nyb3c7CgogIC8qKiBQZWVyIHJlcXVlc3RpbmcgYW5kIHB1cmNoYXNpbmcgc2VydmljZS4gKi8KICBhZGRyZXNzIHB1YmxpYyBwZWVyOwoKICAvKiogUGVlciBwcm92aWRpbmcgc2VydmljZTsgY29tcGVuc2F0ZWQgaW4gUFJWRCB0b2tlbnMuICovCiAgYWRkcmVzcyBwdWJsaWMgcHJvdmlkZXI7CgogIC8qKiBQcm92aWRlIHBsYXRmb3JtIHdvcmsgb3JkZXIgaWRlbnRpZmllciAoVVVJRHY0KS4gKi8KICB1aW50MTI4IHB1YmxpYyBpZGVudGlmaWVyOwoKICAvKiogQ3VycmVudCBzdGF0dXMgb2YgdGhlIHdvcmsgb3JkZXIgY29udHJhY3QuICoqLwogIFN0YXR1cyBwdWJsaWMgc3RhdHVzOwoKICAvKiogVG90YWwgYW1vdW50IG9mIFByb3ZpZGUgKFBSVkQpIHRva2VucyBwYXlhYmxlIHRvIHByb3ZpZGVyLCBleHByZXNzZWQgaW4gd2VpLiAqLwogIHVpbnQyNTYgcHVibGljIGFtb3VudDsKCiAgLyoqIEVuY29kZWQgdHJhbnNhY3Rpb24gZGV0YWlscy4gKi8KICBzdHJpbmcgcHVibGljIGRldGFpbHM7CgogIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHdvcmsgb3JkZXIgaGFzIGJlZW4gc3RhcnRlZC4gKi8KICBldmVudCBXb3JrT3JkZXJTdGFydGVkKHVpbnQxMjggX2lkZW50aWZpZXIpOwoKICAvKiogRW1pdHRlZCB3aGVuIHRoZSB3b3JrIG9yZGVyIGhhcyBiZWVuIGNvbXBsZXRlZC4gKi8KICBldmVudCBXb3JrT3JkZXJDb21wbGV0ZWQodWludDEyOCBfaWRlbnRpZmllciwgdWludDI1NiBfYW1vdW50LCBzdHJpbmcgX2RldGFpbHMpOwoKICAvKiogRW1pdHRlZCB3aGVuIHRoZSB0cmFuc2FjdGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQuICovCiAgZXZlbnQgVHJhbnNhY3Rpb25Db21wbGV0ZWQodWludDEyOCBfaWRlbnRpZmllciwgdWludDI1NiBfcGF5bWVudEFtb3VudCwgdWludDI1NiBmZWVBbW91bnQsIHN0cmluZyBfZGV0YWlscyk7CgogIC8qKgogICAqIEBwYXJhbSBfcHJ2ZCBQcm92aWRlIHBsYXRmb3JtIHJvYm90IGNvbnRyYWN0IGFkZHJlc3MKICAgKiBAcGFyYW0gX3BheW1lbnRFc2Nyb3cgUHJvdmlkZSBwbGF0Zm9ybSB3YWxsZXQgd2hlcmUgcGF5bWVudCBhbW91bnRzIG93ZWQgdG8gcHJvdmlkZXJzIGFyZSBlc2Nyb3dlZAogICAqIEBwYXJhbSBfcGVlciBBZGRyZXNzIG9mIHBhcnR5IHB1cmNoYXNpbmcgc2VydmljZXMKICAgKiBAcGFyYW0gX2lkZW50aWZpZXIgUHJvdmlkZSBwbGF0Zm9ybSB3b3JrIG9yZGVyIGlkZW50aWZpZXIgKFVVSUR2NCkKICAgKi8KICBmdW5jdGlvbiBQcm92aWRlV29ya09yZGVyKAogICAgYWRkcmVzcyBfdG9rZW4sCiAgICBhZGRyZXNzIF9wcnZkLAogICAgYWRkcmVzcyBfcHJ2ZFdhbGxldCwKICAgIGFkZHJlc3MgX3BheW1lbnRFc2Nyb3csCiAgICBhZGRyZXNzIF9wZWVyLAogICAgdWludDEyOCBfaWRlbnRpZmllcgogICkgewogICAgaWYgKF90b2tlbiA9PSAweDApIHJldmVydCgpOwogICAgaWYgKF9wcnZkID09IDB4MCkgcmV2ZXJ0KCk7CiAgICBpZiAoX3BydmRXYWxsZXQgPT0gMHgwKSByZXZlcnQoKTsKICAgIGlmIChfcGF5bWVudEVzY3JvdyA9PSAweDApIHJldmVydCgpOwogICAgaWYgKF9wZWVyID09IDB4MCkgcmV2ZXJ0KCk7CgogICAgdG9rZW4gPSBQcm92aWRlVG9rZW4oX3Rva2VuKTsKICAgIHBydmQgPSBfcHJ2ZDsKICAgIHBydmRXYWxsZXQgPSBfcHJ2ZFdhbGxldDsKICAgIHBheW1lbnRFc2Nyb3cgPSBfcGF5bWVudEVzY3JvdzsKICAgIHBlZXIgPSBfcGVlcjsKICAgIGlkZW50aWZpZXIgPSBfaWRlbnRpZmllcjsKCiAgICBzdGF0dXMgPSBTdGF0dXMuUGVuZGluZzsKICB9CgogIC8qKgogICAqIFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgcGFydHkgcHJvdmlkaW5nIHNlcnZpY2UgYW5kIHN0YXJ0IHRoZSB3b3JrIG9yZGVyLgogICAqIEBwYXJhbSBfcHJvdmlkZXIgQWRkcmVzcyBvZiB0aGUgcGFydHkgcHJvdmlkaW5nIHNlcnZpY2UKICAgKi8KICBmdW5jdGlvbiBzdGFydChhZGRyZXNzIF9wcm92aWRlcikgcHVibGljIG9ubHlQcnZkIG9ubHlQZW5kaW5nIHsKICAgIGlmIChwcm92aWRlciAhPSAweDApIHJldmVydCgpOwogICAgcHJvdmlkZXIgPSBfcHJvdmlkZXI7CiAgICBzdGF0dXMgPSBTdGF0dXMuSW5Qcm9ncmVzczsKICAgIFdvcmtPcmRlclN0YXJ0ZWQoaWRlbnRpZmllcik7CiAgfQoKICAvKioKICAgKiBDb21wbGV0ZSB0aGUgd29yayBvcmRlci4KICAgKiBAcGFyYW0gX2Ftb3VudCBUb3RhbCBhbW91bnQgb2YgUHJvdmlkZSAoUFJWRCkgdG9rZW5zIHBheWFibGUgdG8gcHJvdmlkZXIsIGV4cHJlc3NlZCBpbiB3ZWkKICAgKiBAcGFyYW0gX2RldGFpbHMgRW5jb2RlZCB0cmFuc2FjdGlvbiBkZXRhaWxzCiAgICovCiAgZnVuY3Rpb24gY29tcGxldGUodWludDI1NiBfYW1vdW50LCBzdHJpbmcgX2RldGFpbHMpIHB1YmxpYyBvbmx5UHJvdmlkZXIgb25seUluUHJvZ3Jlc3MgewogICAgYW1vdW50ID0gX2Ftb3VudDsKICAgIGRldGFpbHMgPSBfZGV0YWlsczsKICAgIHN0YXR1cyA9IFN0YXR1cy5Db21wbGV0ZWQ7CiAgICBXb3JrT3JkZXJDb21wbGV0ZWQoaWRlbnRpZmllciwgYW1vdW50LCBkZXRhaWxzKTsKICB9CgogIC8qKgogICAqIENvbXBsZXRlIHRoZSB0cmFuc2FjdGlvbiBieSByZW1pdHRpbmcgdGhlIGV4YWN0IGFtb3VudCBvZiBQUlZEIHRva2VucyBkdWUuCiAgICogVGhlIHNlcnZpY2UgcHJvdmlkZXIncyBwYXltZW50IGlzIGVzY3Jvd2VkIGluIHRoZSBwYXltZW50IGVzY3JvdyB3YWxsZXQKICAgKiBhbmQgdGhlIHBsYXRmb3JtIGZlZSBpcyByZW1pdHRlZCB0byBQcm92aWRlLgogICAqCiAgICogUGFydGlhbCBwYXltZW50cyB3aWxsIGJlIHJlamVjdGVkLgogICAqLwogIGZ1bmN0aW9uIGNvbXBsZXRlVHJhbnNhY3Rpb24oKSBwdWJsaWMgb25seVB1cmNoYXNlciBvbmx5Q29tcGxldGVkIHsKICAgIHVpbnQgYWxsb3dhbmNlID0gdG9rZW4uYWxsb3dhbmNlKG1zZy5zZW5kZXIsIHRoaXMpOwogICAgaWYgKGFsbG93YW5jZSA8IGFtb3VudCkgcmV2ZXJ0KCk7CgogICAgdG9rZW4udHJhbnNmZXJGcm9tKHRoaXMsIHBheW1lbnRFc2Nyb3csIGFtb3VudCk7CgogICAgdWludCBmZWVBbW91bnQgPSBhbGxvd2FuY2Uuc3ViKGFtb3VudCk7CiAgICBpZiAoZmVlQW1vdW50ID4gMCkgdG9rZW4udHJhbnNmZXJGcm9tKHRoaXMsIHBydmRXYWxsZXQsIGZlZUFtb3VudCk7CgogICAgc3RhdHVzID0gU3RhdHVzLlBhaWQ7CiAgICBUcmFuc2FjdGlvbkNvbXBsZXRlZChpZGVudGlmaWVyLCBhbW91bnQsIGZlZUFtb3VudCwgZGV0YWlscyk7CiAgfQoKICAvKioKICAgKiBPbmx5IGFsbG93IHRoZSBQcm92aWRlIHBsYXRmb3JtIHJvYm90IHRvIGV4ZWN1dGUgYSBjb250cmFjdCBmdW5jdGlvbi4KICAgKi8KICBtb2RpZmllciBvbmx5UHJ2ZCgpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IHBydmQpIHJldmVydCgpOwogICAgXzsKICB9CgogIC8qKgogICAqIE9ubHkgYWxsb3cgdGhlIHBlZXIgcHVyY2hhc2luZyBzZXJ2aWNlcyB0byBleGVjdXRlIGEgY29udHJhY3QgZnVuY3Rpb24uCiAgICovCiAgbW9kaWZpZXIgb25seVB1cmNoYXNlcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IHBlZXIpIHJldmVydCgpOwogICAgXzsKICB9CgogIC8qKgogICAqIE9ubHkgYWxsb3cgdGhlIHNlcnZpY2UgcHJvdmlkZXIgdG8gZXhlY3V0ZSBhIGNvbnRyYWN0IGZ1bmN0aW9uLgogICAqLwogIG1vZGlmaWVyIG9ubHlQcm92aWRlcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IHByb3ZpZGVyKSByZXZlcnQoKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBPbmx5IGFsbG93IGV4ZWN1dGlvbiBvZiBhIGNvbnRyYWN0IGZ1bmN0aW9uIGlmIHRoZSB3b3JrIG9yZGVyIGlzIHBlbmRpbmcuCiAgICovCiAgbW9kaWZpZXIgb25seVBlbmRpbmcoKSB7CiAgICBpZiAodWludChzdGF0dXMpICE9IHVpbnQoU3RhdHVzLlBlbmRpbmcpKSByZXZlcnQoKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBPbmx5IGFsbG93IGV4ZWN1dGlvbiBvZiBhIGNvbnRyYWN0IGZ1bmN0aW9uIGlmIHRoZSB3b3JrIG9yZGVyIGlzIHN0YXJ0ZWQuCiAgICovCiAgbW9kaWZpZXIgb25seUluUHJvZ3Jlc3MoKSB7CiAgICBpZiAodWludChzdGF0dXMpICE9IHVpbnQoU3RhdHVzLkluUHJvZ3Jlc3MpKSByZXZlcnQoKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBPbmx5IGFsbG93IGV4ZWN1dGlvbiBvZiBhIGNvbnRyYWN0IGZ1bmN0aW9uIGlmIHRoZSB3b3JrIG9yZGVyIGlzIGNvbXBsZXRlLgogICAqLwogIG1vZGlmaWVyIG9ubHlDb21wbGV0ZWQoKSB7CiAgICBpZiAodWludChzdGF0dXMpICE9IHVpbnQoU3RhdHVzLkNvbXBsZXRlZCkpIHJldmVydCgpOwogICAgXzsKICB9Cn0KCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGEgLyBiOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIGFzc2VydFRydWUoYm9vbCB2YWwpIGludGVybmFsIHsKICAgIGFzc2VydCh2YWwpOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0RmFsc2UoYm9vbCB2YWwpIGludGVybmFsIHsKICAgIGFzc2VydCghdmFsKTsKICB9Cn0KCgovKioKICogRVJDMjBCYXNpYwogKiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7Cn0KCgovKioKICogRVJDMjAgaW50ZXJmYWNlCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKCi8qKgogKiBCYXNpYyB0b2tlbi4KICogQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwoKICAvKioKICAgKiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4KICAgKi8KICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7CiAgICAgaWYgKG1zZy5kYXRhLmxlbmd0aCA8IHNpemUgKyA0KSB7CiAgICAgICByZXZlcnQoKTsKICAgICB9CiAgICAgXzsKICB9CgogIC8qKgogICogdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQp9CgoKLyoqCiAqIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEltcGxlbWFudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEJhc2ljVG9rZW4sIEVSQzIwIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICAvKioKICAgKiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVhaGxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgewogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSByZXZlcnQoKTsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQp9CgovKioKICogQ29udHJvbGxlciBpbnRlcmZhY2UuCiAqLwpjb250cmFjdCBDb250cm9sbGVyIHsKCiAgLyoqCiAgICogQ2FsbGVkIHRvIGRldGVybWluZSBpZiB0aGUgdG9rZW4gYWxsb3dzIHByb3h5IHBheW1lbnRzLgogICAqCiAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgZXRoZXIgdG8gdGhlIHRva2VuIGNvbnRyYWN0CiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICovCiAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7CgogIC8qKgogICAqIENhbGxlZCB0byBkZXRlcm1pbmUgaWYgdGhlIGNvbnRyb2xsZXIgYXBwcm92ZXMgYSB0b2tlbiB0cmFuc2Zlci4KICAgKgogICAqIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAqIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICogQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICovCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAvKioKICAgKiBDYWxsZWQgdG8gbm90aWZ5IHRoZSBjb250cm9sbGVyIG9mIGEgdHJhbnNmZXIgYXBwcm92YWwuCiAgICoKICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICogQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICovCiAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7Cn0KCgovKioKICogQ29udHJvbGxlZC4KICovCmNvbnRyYWN0IENvbnRyb2xsZWQgewoKICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICBmdW5jdGlvbiBDb250cm9sbGVkKCkgewogICAgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX2NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgIGNvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICB9CgogIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHJldmVydCgpOwogICAgXzsKICB9Cn0KCgovKioKICogQSB0cmFpdCB0aGF0IGFsbG93cyBhbnkgdG9rZW4gb3duZXIgdG8gZGVjcmVhc2UgdGhlIHRva2VuIHN1cHBseS4KICoKICogV2UgYWRkIGEgQnVybmVkIGV2ZW50IHRvIGRpZmZlcmVudGlhdGUgZnJvbSBub3JtYWwgdHJhbnNmZXJzLgogKiBIb3dldmVyLCB3ZSBzdGlsbCB0cnkgdG8gc3VwcG9ydCBzb21lIGxlZ2FjeSBFdGhlcmV1bSBlY29zeXN0ZW0sCiAqIGFzIEVSQy0yMCBoYXMgbm90IHN0YW5kYXJkaXplZCBvbiB0aGUgYnVybiBldmVudCB5ZXQuCiAqLwpjb250cmFjdCBCdXJuYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBCVVJOX0FERFJFU1MgPSAwOwoKICBldmVudCBCdXJuZWQoYWRkcmVzcyBidXJuZXIsIHVpbnQgYnVybmVkQW1vdW50KTsKCiAgLyoqCiAgICogQnVybiBleHRyYSB0b2tlbnMgZnJvbSBhIGJhbGFuY2UuCiAgICoKICAgKiBLZWVwcyB0b2tlbiBiYWxhbmNlIHRyYWNraW5nIHNlcnZpY2VzIGhhcHB5IGJ5IHNlbmRpbmcgdGhlIGJ1cm5lZAogICAqIGFtb3VudCB0byBCVVJOX0FERFJFU1MsIHNvIHRoYXQgaXQgd2lsbCBzaG93IHVwIGFzIGEgRVJDLTIwIHRyYW5zYWN0aW9uCiAgICogaW4gZXRoZXJzY2FuLCBldGMuIGFzIHRoZXJlIGlzIG5vIHN0YW5kYXJkaXplZCBidXJuIGV2ZW50IHlldC4KICAgKgogICAqIEBwYXJhbSBidXJuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4KICAgKi8KICBmdW5jdGlvbiBidXJuKHVpbnQgYnVybkFtb3VudCkgewogICAgYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwogICAgYmFsYW5jZXNbYnVybmVyXSA9IGJhbGFuY2VzW2J1cm5lcl0uc3ViKGJ1cm5BbW91bnQpOwogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoYnVybkFtb3VudCk7CgogICAgQnVybmVkKGJ1cm5lciwgYnVybkFtb3VudCk7CiAgICBUcmFuc2ZlcihidXJuZXIsIEJVUk5fQUREUkVTUywgYnVybkFtb3VudCk7CiAgfQp9CgoKLyoqCiAqIE1pbnRhYmxlIHRva2VuLgogKgogKiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBDb250cm9sbGVkIHsKCiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseSA9IDA7CgogIC8qKgogICAqIEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBvbmx5Q29udHJvbGxlciBjYW5NaW50IHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgaWYgKG1pbnRpbmdGaW5pc2hlZCkgcmV2ZXJ0KCk7CiAgICBfOwogIH0KfQoKCi8qKgogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbgogKgogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBkZWZpbmVzIHRoZSBnZW5lcmljIGludGVyZmFjZSBhbmQgdGhlIGltcGxlbWVudGF0aW9uIHRvIGxpbWl0IHRva2VuCiAqIHRyYW5zZmVyYWJpbGl0eSBmb3IgZGlmZmVyZW50IGV2ZW50cy4gSXQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBhcyBhIGJhc2UgY2xhc3MgZm9yIG90aGVyIHRva2VuCiAqIGNvbnRyYWN0cy4KICogTGltaXRlZFRyYW5zZmVyVG9rZW4gaGFzIGJlZW4gZGVzaWduZWQgdG8gYWxsb3cgZm9yIGRpZmZlcmVudCBsaW1pdGluZyBmYWN0b3JzLAogKiB0aGlzIGNhbiBiZSBhY2hpZXZlZCBieSByZWN1cnNpdmVseSBjYWxsaW5nIHN1cGVyLnRyYW5zZmVyYWJsZVRva2VucygpIHVudGlsIHRoZSBiYXNlIGNsYXNzIGlzCiAqIGhpdC4gRm9yIGV4YW1wbGU6CiAqICAgICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogKiAgICAgICByZXR1cm4gbWluMjU2KHVubG9ja2VkVG9rZW5zLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7CiAqICAgICB9CiAqIEEgd29ya2luZyBleGFtcGxlIGlzIFZlc3RlZFRva2VuLnNvbDoKICovCmNvbnRyYWN0IExpbWl0ZWRUcmFuc2ZlclRva2VuIGlzIEVSQzIwIHsKCiAgLyoqCiAgICogQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MKICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CiAgICBpZiAoX3ZhbHVlID4gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSkgcmV2ZXJ0KCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICAqCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3ZhbHVlKSB7CiAgICBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKIC8qKgogICogQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICoKICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc2VuZCB0aGUgdG9rZW5zCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMKICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpIHsKICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogRGVmYXVsdCB0cmFuc2ZlcmFibGUgdG9rZW5zIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRva2VucyBmb3IgYSBob2xkZXIgKG5vIGxpbWl0KS4KICAgKgogICAqIE92ZXJyaWRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZQogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4KICAgKgogICAqIEBwYXJhbSBob2xkZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGhvbGRlcgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IC8qIHRpbWUgKi8pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7CiAgfQp9CgoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlLgogKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuIFRoZSB1cGdyYWRlIGFnZW50IGl0c2VsZgogKiBjYW4gYmUgdGhlIHRva2VuIGNvbnRyYWN0LCBvciBqdXN0IGFuIGludGVybWVkaWFyeSBjb250cmFjdCBkb2luZyB0aGUgaGVhdnkgbGlmdGluZy4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5OwoKICBmdW5jdGlvbiBpc1VwZ3JhZGVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHVwZ3JhZGVGcm9tKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWM7Cn0KCgovKioKICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMKICogdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uCiAqCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAvKiogQ29udHJhY3QvYWN0b3Igd2hvIGNhbiBzZXQgdGhlIHVwZ3JhZGUgcGF0aC4gKi8KICBhZGRyZXNzIHB1YmxpYyB1cGdyYWRlQ29udHJvbGxlcjsKCiAgLyoqIERlc2lnbmF0ZWQgdXBncmFkZSBhZ2VudCByZXNwb25zaWJsZSBmb3IgY29tcGxldGluZyB0aGUgdXBncmFkZS4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKCiAgLyoqIE51bWJlciBvZiB0b2tlbnMgdXBncmFkZWQgdG8gZGF0ZS4gKi8KICB1aW50MjU2IHB1YmxpYyB0b3RhbFVwZ3JhZGVkOwoKICAvKioKICAgKiBVcGdyYWRlIHN0YXRlczoKICAgKgogICAqIC0gTm90QWxsb3dlZDogdGhlIGNoaWxkIGNvbnRyYWN0IGhhcyBub3QgcmVhY2hlZCBhIGNvbmRpdGlvbiB3aGVyZSB0aGUgdXBncmFkZSBjYW4gYmVnaW4KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogdG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldAogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IHRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0CiAgICogLSBVcGdyYWRpbmc6IHVwZ3JhZGUgYWdlbnQgaXMgc2V0IGFuZCB0aGUgYmFsYW5jZSBob2xkZXJzIGNhbiB1cGdyYWRlIHRoZWlyIHRva2VucwogICAqCiAgICovCiAgZW51bSBVcGdyYWRlU3RhdGUge1Vua25vd24sIE5vdEFsbG93ZWQsIFdhaXRpbmdGb3JBZ2VudCwgUmVhZHlUb1VwZ3JhZGUsIFVwZ3JhZGluZ30KCiAgLyoqCiAgICogRW1pdHRlZCB3aGVuIGEgdG9rZW4gaG9sZGVyIHVwZ3JhZGVzIHNvbWUgcG9ydGlvbiBvZiB0b2tlbiBob2xkaW5ncy4KICAgKi8KICBldmVudCBVcGdyYWRlKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwoKICAvKioKICAgKiBOZXcgdXBncmFkZSBhZ2VudCBoYXMgYmVlbiBzZXQuCiAgICovCiAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAvKioKICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBjb250cm9sbGVyLgogICAqLwogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBfdXBncmFkZUNvbnRyb2xsZXIpIHsKICAgIHVwZ3JhZGVDb250cm9sbGVyID0gX3VwZ3JhZGVDb250cm9sbGVyOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdGhlIHRva2VuIGhvbGRlciB0byB1cGdyYWRlIHNvbWUgb2YgdGhlaXIgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHVwZ3JhZGUodWludDI1NiB2YWx1ZSkgcHVibGljIHsKICAgICAgVXBncmFkZVN0YXRlIHN0YXRlID0gZ2V0VXBncmFkZVN0YXRlKCk7CiAgICAgIGlmICghKHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZSB8fCBzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSkgewogICAgICAgIHJldmVydCgpOyAvLyBjYWxsZWQgaW4gYW4gaW52YWxpZCBzdGF0ZQogICAgICB9CgogICAgICBpZiAodmFsdWUgPT0gMCkgcmV2ZXJ0KCk7IC8vIHZhbGlkYXRlIGlucHV0IHZhbHVlCgogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih2YWx1ZSk7CgogICAgICAvLyBUYWtlIHRva2VucyBvdXQgZnJvbSBjaXJjdWxhdGlvbgogICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1Yih2YWx1ZSk7CiAgICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLmFkZCh2YWx1ZSk7CgogICAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMKICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgY2FuIGhhbmRsZS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgewogICAgICBpZiAoIWNhblVwZ3JhZGUoKSkgewogICAgICAgIHJldmVydCgpOwogICAgICB9CgogICAgICBpZiAoYWdlbnQgPT0gMHgwKSByZXZlcnQoKTsKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZUNvbnRyb2xsZXIpIHJldmVydCgpOyAvLyBvbmx5IHVwZ3JhZGUgY29udHJvbGxlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IGFnZW50CiAgICAgIGlmIChnZXRVcGdyYWRlU3RhdGUoKSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSByZXZlcnQoKTsgLy8gdXBncmFkZSBoYXMgYWxyZWFkeSBzdGFydGVkIGZvciBhbiBhZ2VudAoKICAgICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKCiAgICAgIGlmICghdXBncmFkZUFnZW50LmlzVXBncmFkZUFnZW50KCkpIHJldmVydCgpOyAvLyBiYWQgaW50ZXJmYWNlCiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgcmV2ZXJ0KCk7IC8vIGVuc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CgogICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7CiAgICBpZiAoIWNhblVwZ3JhZGUoKSkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5Ob3RBbGxvd2VkOwogICAgZWxzZSBpZiAoYWRkcmVzcyh1cGdyYWRlQWdlbnQpID09IDB4MCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmICh0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7CiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOwogIH0KCiAgLyoqCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIGNvbnRyb2xsZXIuCiAgICoKICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlQ29udHJvbGxlcihhZGRyZXNzIGNvbnRyb2xsZXIpIHB1YmxpYyB7CiAgICAgIGlmIChjb250cm9sbGVyID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVDb250cm9sbGVyKSByZXZlcnQoKTsKICAgICAgdXBncmFkZUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOwogIH0KCiAgLyoqCiAgICogQ2hpbGQgY29udHJhY3QgY2FuIG92ZXJyaWRlIHRvIGNvbmRpdGlvbiBlbmFibGUgdXBncmFkZSBwYXRoLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgcmV0dXJuIHRydWU7CiAgfQp9CgoKLyoqCiAqIFZlc3RlZCB0b2tlbi4KICoKICogVG9rZW5zIHRoYXQgY2FuIGJlIHZlc3RlZCBmb3IgYSBncm91cCBvZiBhZGRyZXNzZXMuCiAqLwpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CgogIHVpbnQyNTYgTUFYX0dSQU5UU19QRVJfQUREUkVTUyA9IDIwOwoKICBzdHJ1Y3QgVG9rZW5HcmFudCB7CiAgICBhZGRyZXNzIGdyYW50ZXI7ICAgICAvLyAyMCBieXRlcwogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMKICAgIHVpbnQ2NCBjbGlmZjsKICAgIHVpbnQ2NCB2ZXN0aW5nOwogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcwogICAgYm9vbCByZXZva2FibGU7CiAgICBib29sIGJ1cm5zT25SZXZva2U7ICAvLyAyICogMSA9IDIgYml0cz8gb3IgMiBieXRlcz8KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7CgogIGV2ZW50IE5ld1Rva2VuR3JhbnQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgdWludDI1NiBncmFudElkKTsKCiAgLyoqCiAgICogR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICoKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICogQHBhcmFtIF9yZXZva2FibGUgYm9vbCBJZiB0aGUgZ3JhbnQgaXMgcmV2b2thYmxlLgogICAqIEBwYXJhbSBfYnVybnNPblJldm9rZSBib29sIFdoZW4gdHJ1ZSwgdGhlIHRva2VucyBhcmUgYnVybmVkIGlmIHJldm9rZWQuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcsCiAgICBib29sIF9yZXZva2FibGUsCiAgICBib29sIF9idXJuc09uUmV2b2tlCiAgKSBwdWJsaWMgewoKICAgIC8vIENoZWNrIGZvciBkYXRlIGluY29uc2lzdGVuY2llcyB0aGF0IG1heSBjYXVzZSB1bmV4cGVjdGVkIGJlaGF2aW9yCiAgICBpZiAoX2NsaWZmIDwgX3N0YXJ0IHx8IF92ZXN0aW5nIDwgX2NsaWZmKSB7CiAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGlmICh0b2tlbkdyYW50c0NvdW50KF90bykgPiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKSByZXZlcnQoKTsgIC8vIFRvIHByZXZlbnQgYSB1c2VyIGJlaW5nIHNwYW1tZWQgYW5kIGhhdmUgaGlzIGJhbGFuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KCiAgICB1aW50IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuR3JhbnQoCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUgPyBtc2cuc2VuZGVyIDogMCwgIC8vIGF2b2lkIHN0b3JpbmcgYW4gZXh0cmEgMjAgYnl0ZXMgd2hlbiBpdCBpcyBub24tcmV2b2thYmxlCiAgICAgICAgICAgICAgICAgIF92YWx1ZSwKICAgICAgICAgICAgICAgICAgX2NsaWZmLAogICAgICAgICAgICAgICAgICBfdmVzdGluZywKICAgICAgICAgICAgICAgICAgX3N0YXJ0LAogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlLAogICAgICAgICAgICAgICAgICBfYnVybnNPblJldm9rZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICk7CiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICBOZXdUb2tlbkdyYW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBjb3VudCAtIDEpOwogIH0KCiAgLyoqCiAgICogUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgKgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQKICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudAogICAqLwogIGZ1bmN0aW9uIHJldm9rZVRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBwdWJsaWMgewogICAgVG9rZW5HcmFudCBzdG9yYWdlIGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKCiAgICBpZiAoIWdyYW50LnJldm9rYWJsZSkgeyAvLyBjaGVjayBpZiBncmFudCBpcyByZXZva2FibGUKICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgaWYgKGdyYW50LmdyYW50ZXIgIT0gbXNnLnNlbmRlcikgeyAvLyBvbmx5IGdyYW50ZXIgdG8gcmV2b2tlIHRoZSBncmFudAogICAgICByZXZlcnQoKTsKICAgIH0KCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4MCA6IG1zZy5zZW5kZXI7CiAgICB1aW50MjU2IG5vblZlc3RlZCA9IG5vblZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwoKICAgIC8vIHJlbW92ZSBncmFudCBmcm9tIGFycmF5CiAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKICAgIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF0gPSBncmFudHNbX2hvbGRlcl1bZ3JhbnRzW19ob2xkZXJdLmxlbmd0aC5zdWIoMSldOwogICAgZ3JhbnRzW19ob2xkZXJdLmxlbmd0aCAtPSAxOwoKICAgIGJhbGFuY2VzW3JlY2VpdmVyXSA9IGJhbGFuY2VzW3JlY2VpdmVyXS5hZGQobm9uVmVzdGVkKTsKICAgIGJhbGFuY2VzW19ob2xkZXJdID0gYmFsYW5jZXNbX2hvbGRlcl0uc3ViKG5vblZlc3RlZCk7CgogICAgVHJhbnNmZXIoX2hvbGRlciwgcmVjZWl2ZXIsIG5vblZlc3RlZCk7CiAgfQoKICAvKioKICAgKiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZS4KICAgKgogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSBzcGVjaWZpYyB0aW1lCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyBhIGhvbGRlcidzIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKICAgIGlmIChncmFudEluZGV4ID09IDApIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsgLy8gc2hvcnRjdXQgZm9yIGhvbGRlciB3aXRob3V0IGdyYW50cwoKICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIGdyYW50cyB0aGUgaG9sZGVyIGhhcywgYW5kIGFkZCBhbGwgbm9uLXZlc3RlZCB0b2tlbnMKICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gMDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBub25WZXN0ZWQgPSBub25WZXN0ZWQuYWRkKG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQoKICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUKICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gYmFsYW5jZU9mKGhvbGRlcikuc3ViKG5vblZlc3RlZCk7CgogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlCiAgICAvLyBpbiBjYXNlIHRoZXJlIGFyZSBvdGhlciBsaW1pdGluZyB0cmFuc2ZlcmFiaWxpdHkgZmFjdG9ycyAoZGVmYXVsdCBpcyBiYWxhbmNlT2YpCiAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2sgdGhlIGFtb3VudCBvZiBncmFudHMgdGhhdCBhbiBhZGRyZXNzIGhhcy4KICAgKgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBob2xkZXIgb2YgdGhlIGdyYW50cwogICAqIEByZXR1cm4gQSB1aW50IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIGdyYW50cwogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIC8qKgogICAqIENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICoKICAgKiBAcGFyYW0gdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgZ3JhbnRlZAogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHBhcmFtIHN0YXJ0IHVpbnQ2NCBBIHRpbWUgcmVwcmVzZW50aW5nIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50CiAgICogQHBhcmFtIGNsaWZmIHVpbnQ2NCBUaGUgY2xpZmYgcGVyaW9kCiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZAogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGZyb20gYSBzcGVjaWZpYyBncmFudAogICAqICB0cmFuc2ZlcmFibGVUb2tlbnMKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgXy8tLS0tLS0tLSAgIHZlc3RlZFRva2VucyByZWN0CiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAvCiAgICogICB8ICAgICAgICAgICAgICAufAogICAqICAgfCAgICAgICAgICAgIC4gIHwKICAgKiAgIHwgICAgICAgICAgLiAgICB8CiAgICogICB8ICAgICAgICAuICAgICAgfAogICAqICAgfCAgICAgIC4gICAgICAgIHwoZ3JhbnRzW19ob2xkZXJdID09IGFkZHJlc3MoMCkpIHJldHVybiAwOwogICAqICAgfCAgICAuICAgICAgICAgIHwKICAgKiAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKICAgKiAgICAgIFN0YXJ0ICAgICAgIENsaWZ0ICAgIFZlc3RpbmcKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnModWludDI1NiB0b2tlbnMsIHVpbnQyNTYgdGltZSwgdWludDI1NiBzdGFydCwgdWludDI1NiBjbGlmZiwgdWludDI1NiB2ZXN0aW5nKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIC8vIFNob3J0Y3V0cyBmb3IgYmVmb3JlIGNsaWZmIGFuZCBhZnRlciB2ZXN0aW5nIGNhc2VzLgogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsKICAgICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsKCiAgICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLgogICAgICAvLyBBcyBiZWZvcmUgY2xpZmYgdGhlIHNob3J0Y3V0IHJldHVybnMgMCwgd2UgY2FuIHVzZSBqdXN0IGNhbGN1bGF0ZSBhIHZhbHVlCiAgICAgIC8vIGluIHRoZSB2ZXN0aW5nIHJlY3QgKGFzIHNob3duIGluIGFib3ZlJ3MgZmlndXJlKQoKICAgICAgdWludCB2ZXN0ZWRUb2tlbnMgPSB0b2tlbnMubXVsKHRpbWUuc3ViKHN0YXJ0KSkuZGl2KHZlc3Rpbmcuc3ViKHN0YXJ0KSk7CiAgICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7CiAgfQoKICAvKioKICAgKiBHZXQgYWxsIGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmYyBncmFudC4KICAgKgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqICAgICAgICAgcmV2b2thYmlsaXR5LCBidXJuc09uUmV2b2tlLCBhbmQgdmVzdGluZykgcGx1cyB0aGUgdmVzdGVkIHZhbHVlIGF0IHRoZSBjdXJyZW50IHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZ3JhbnRlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiB2ZXN0ZWQsIHVpbnQ2NCBzdGFydCwgdWludDY0IGNsaWZmLCB1aW50NjQgdmVzdGluZywgYm9vbCByZXZva2FibGUsIGJvb2wgYnVybnNPblJldm9rZSkgewogICAgVG9rZW5HcmFudCBzdG9yYWdlIGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKCiAgICBncmFudGVyID0gZ3JhbnQuZ3JhbnRlcjsKICAgIHZhbHVlID0gZ3JhbnQudmFsdWU7CiAgICBzdGFydCA9IGdyYW50LnN0YXJ0OwogICAgY2xpZmYgPSBncmFudC5jbGlmZjsKICAgIHZlc3RpbmcgPSBncmFudC52ZXN0aW5nOwogICAgcmV2b2thYmxlID0gZ3JhbnQucmV2b2thYmxlOwogICAgYnVybnNPblJldm9rZSA9IGdyYW50LmJ1cm5zT25SZXZva2U7CgogICAgdmVzdGVkID0gdmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKgogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLgogICAqIEBwYXJhbSB0aW1lIFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50IGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKi8KICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgICAgZ3JhbnQudmFsdWUsCiAgICAgIHVpbnQyNTYodGltZSksCiAgICAgIHVpbnQyNTYoZ3JhbnQuc3RhcnQpLAogICAgICB1aW50MjU2KGdyYW50LmNsaWZmKSwKICAgICAgdWludDI1NihncmFudC52ZXN0aW5nKQogICAgKTsKICB9CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKgogICAqIEBwYXJhbSBncmFudCBUb2tlbkdyYW50IFRoZSBncmFudCB0byBiZSBjaGVja2VkLgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmYyBncmFudCBvbiB0aGUKICAgKiBwYXNzZWQgdGltZSBmcmFtZS4KICAgKi8KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGdyYW50LnZhbHVlLnN1Yih2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsKICB9CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgZGF0ZSB3aGVuIHRoZSBob2xkZXIgY2FuIHRyYXNmZXIgYWxsIGl0cyB0b2tlbnMKICAgKgogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCB0cmFuc2ZlcmFibGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGxhc3RUb2tlbklzVHJhbnNmZXJhYmxlRGF0ZShhZGRyZXNzIGhvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ2NCBkYXRlKSB7CiAgICBkYXRlID0gdWludDY0KG5vdyk7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSBncmFudHNbaG9sZGVyXS5sZW5ndGg7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgZGF0ZSA9IFNhZmVNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogIH0KfQoKLyoqCiAqIFByb3ZpZGUgKFBSVkQpIHRva2VuIGNvbnRyYWN0LgogKi8KY29udHJhY3QgUHJvdmlkZVRva2VuIGlzIEJ1cm5hYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW4sIFZlc3RlZFRva2VuLCBVcGdyYWRlYWJsZVRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gJ1Byb3ZpZGUnOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ1BSVkQnOwogIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gODsKCiAgZnVuY3Rpb24gUHJvdmlkZVRva2VuKCkgIFVwZ3JhZGVhYmxlVG9rZW4obXNnLnNlbmRlcikgeyB9CgogIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgaWYgKCFDb250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKSByZXZlcnQoKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldmVydCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgIHVpbnQgc2l6ZTsKICAgIGlmIChfYWRkciA9PSBhZGRyZXNzKDApKSByZXR1cm4gZmFsc2U7CiAgICBhc3NlbWJseSB7CiAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICB9CiAgICByZXR1cm4gc2l6ZSA+IDA7CiAgfQp9'.
	

]
