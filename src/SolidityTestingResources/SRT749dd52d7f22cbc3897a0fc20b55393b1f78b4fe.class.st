Class {
	#name : #SRT749dd52d7f22cbc3897a0fc20b55393b1f78b4fe,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT749dd52d7f22cbc3897a0fc20b55393b1f78b4fe >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgU2FuaXR5UmF0ZXNJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gZ2V0U2FuaXR5UmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QpIHB1YmxpYyB2aWV3IHJldHVybnModWludCk7Cn0KCmNvbnRyYWN0IFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGFkZHJlc3MgcHVibGljIGFkbWluOwogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ0FkbWluOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBvcGVyYXRvcnM7CiAgICBtYXBwaW5nKGFkZHJlc3M9PmJvb2wpIGludGVybmFsIGFsZXJ0ZXJzOwogICAgYWRkcmVzc1tdIGludGVybmFsIG9wZXJhdG9yc0dyb3VwOwogICAgYWRkcmVzc1tdIGludGVybmFsIGFsZXJ0ZXJzR3JvdXA7CgogICAgZnVuY3Rpb24gUGVybWlzc2lvbkdyb3VwcygpIHB1YmxpYyB7CiAgICAgICAgYWRtaW4gPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRtaW4pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU9wZXJhdG9yKCkgewogICAgICAgIHJlcXVpcmUob3BlcmF0b3JzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBbGVydGVyKCkgewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0T3BlcmF0b3JzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gb3BlcmF0b3JzR3JvdXA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWxlcnRlcnMgKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3NbXSkgewogICAgICAgIHJldHVybiBhbGVydGVyc0dyb3VwOwogICAgfQoKICAgIGV2ZW50IFRyYW5zZmVyQWRtaW5QZW5kaW5nKGFkZHJlc3MgcGVuZGluZ0FkbWluKTsKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IGFkbWluIHRvIHNldCB0aGUgcGVuZGluZ0FkbWluIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gbmV3QWRtaW4gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFkbWluKGFkZHJlc3MgbmV3QWRtaW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUobmV3QWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgVHJhbnNmZXJBZG1pblBlbmRpbmcocGVuZGluZ0FkbWluKTsKICAgICAgICBwZW5kaW5nQWRtaW4gPSBuZXdBZG1pbjsKICAgIH0KCiAgICBldmVudCBBZG1pbkNsYWltZWQoIGFkZHJlc3MgbmV3QWRtaW4sIGFkZHJlc3MgcHJldmlvdXNBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ0FkbWluIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIGNoYW5nZSBhZG1pbiBwcm9jZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbUFkbWluKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHBlbmRpbmdBZG1pbiA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBBZG1pbkNsYWltZWQocGVuZGluZ0FkbWluLCBhZG1pbik7CiAgICAgICAgYWRtaW4gPSBwZW5kaW5nQWRtaW47CiAgICAgICAgcGVuZGluZ0FkbWluID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICBldmVudCBBbGVydGVyQWRkZWQgKGFkZHJlc3MgbmV3QWxlcnRlciwgYm9vbCBpc0FkZCk7CgogICAgZnVuY3Rpb24gYWRkQWxlcnRlcihhZGRyZXNzIG5ld0FsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoIWFsZXJ0ZXJzW25ld0FsZXJ0ZXJdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIEFsZXJ0ZXJBZGRlZChuZXdBbGVydGVyLCB0cnVlKTsKICAgICAgICBhbGVydGVyc1tuZXdBbGVydGVyXSA9IHRydWU7CiAgICAgICAgYWxlcnRlcnNHcm91cC5wdXNoKG5ld0FsZXJ0ZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUFsZXJ0ZXIgKGFkZHJlc3MgYWxlcnRlcikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShhbGVydGVyc1thbGVydGVyXSk7CiAgICAgICAgYWxlcnRlcnNbYWxlcnRlcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWxlcnRlcnNHcm91cC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAoYWxlcnRlcnNHcm91cFtpXSA9PSBhbGVydGVyKSB7CiAgICAgICAgICAgICAgICBhbGVydGVyc0dyb3VwW2ldID0gYWxlcnRlcnNHcm91cFthbGVydGVyc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cC5sZW5ndGgtLTsKICAgICAgICAgICAgICAgIEFsZXJ0ZXJBZGRlZChhbGVydGVyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBldmVudCBPcGVyYXRvckFkZGVkKGFkZHJlc3MgbmV3T3BlcmF0b3IsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZE9wZXJhdG9yKGFkZHJlc3MgbmV3T3BlcmF0b3IpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoIW9wZXJhdG9yc1tuZXdPcGVyYXRvcl0pOyAvLyBwcmV2ZW50IGR1cGxpY2F0ZXMuCiAgICAgICAgT3BlcmF0b3JBZGRlZChuZXdPcGVyYXRvciwgdHJ1ZSk7CiAgICAgICAgb3BlcmF0b3JzW25ld09wZXJhdG9yXSA9IHRydWU7CiAgICAgICAgb3BlcmF0b3JzR3JvdXAucHVzaChuZXdPcGVyYXRvcik7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlT3BlcmF0b3IgKGFkZHJlc3Mgb3BlcmF0b3IpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUob3BlcmF0b3JzW29wZXJhdG9yXSk7CiAgICAgICAgb3BlcmF0b3JzW29wZXJhdG9yXSA9IGZhbHNlOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvcGVyYXRvcnNHcm91cC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAob3BlcmF0b3JzR3JvdXBbaV0gPT0gb3BlcmF0b3IpIHsKICAgICAgICAgICAgICAgIG9wZXJhdG9yc0dyb3VwW2ldID0gb3BlcmF0b3JzR3JvdXBbb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cC5sZW5ndGggLT0gMTsKICAgICAgICAgICAgICAgIE9wZXJhdG9yQWRkZWQob3BlcmF0b3IsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBXaXRoZHJhd2FibGUgaXMgUGVybWlzc2lvbkdyb3VwcyB7CgogICAgZXZlbnQgVG9rZW5XaXRoZHJhdyhFUkMyMCB0b2tlbiwgdWludCBhbW91bnQsIGFkZHJlc3Mgc2VuZFRvKTsKCiAgICAvKioKICAgICAqIEBkZXYgV2l0aGRyYXcgYWxsIEVSQzIwIGNvbXBhdGlibGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW4oRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKHNlbmRUbywgYW1vdW50KSk7CiAgICAgICAgVG9rZW5XaXRoZHJhdyh0b2tlbiwgYW1vdW50LCBzZW5kVG8pOwogICAgfQoKICAgIGV2ZW50IEV0aGVyV2l0aGRyYXcodWludCBhbW91bnQsIGFkZHJlc3Mgc2VuZFRvKTsKCiAgICAvKioKICAgICAqIEBkZXYgV2l0aGRyYXcgRXRoZXJzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoZXIodWludCBhbW91bnQsIGFkZHJlc3Mgc2VuZFRvKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHNlbmRUby50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIEV0aGVyV2l0aGRyYXcoYW1vdW50LCBzZW5kVG8pOwogICAgfQp9Cgpjb250cmFjdCBWb2x1bWVJbWJhbGFuY2VSZWNvcmRlciBpcyBXaXRoZHJhd2FibGUgewoKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgU0xJRElOR19XSU5ET1dfU0laRSA9IDU7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIFBPV18yXzY0ID0gMiAqKiA2NDsKCiAgICBzdHJ1Y3QgVG9rZW5Db250cm9sSW5mbyB7CiAgICAgICAgdWludCBtaW5pbWFsUmVjb3JkUmVzb2x1dGlvbjsgLy8gY2FuIGJlIHJvdWdobHkgMSBjZW50CiAgICAgICAgdWludCBtYXhQZXJCbG9ja0ltYmFsYW5jZTsgLy8gaW4gdHdlaSByZXNvbHV0aW9uCiAgICAgICAgdWludCBtYXhUb3RhbEltYmFsYW5jZTsgLy8gbWF4IHRvdGFsIGltYmFsYW5jZSAoYmV0d2VlbiByYXRlIHVwZGF0ZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgaGFsdGluZyB0cmFkZQogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBUb2tlbkNvbnRyb2xJbmZvKSBpbnRlcm5hbCB0b2tlbkNvbnRyb2xJbmZvOwoKICAgIHN0cnVjdCBUb2tlbkltYmFsYW5jZURhdGEgewogICAgICAgIGludCAgbGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgdWludCBsYXN0QmxvY2s7CgogICAgICAgIGludCAgdG90YWxCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICB1aW50IGxhc3RSYXRlVXBkYXRlQmxvY2s7CiAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludD0+dWludCkpIHB1YmxpYyB0b2tlbkltYmFsYW5jZURhdGE7CgogICAgZnVuY3Rpb24gVm9sdW1lSW1iYWxhbmNlUmVjb3JkZXIoYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYWRtaW4gPSBfYWRtaW47CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5Db250cm9sSW5mbygKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICB1aW50IG1pbmltYWxSZWNvcmRSZXNvbHV0aW9uLAogICAgICAgIHVpbnQgbWF4UGVyQmxvY2tJbWJhbGFuY2UsCiAgICAgICAgdWludCBtYXhUb3RhbEltYmFsYW5jZQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlBZG1pbgogICAgewogICAgICAgIHRva2VuQ29udHJvbEluZm9bdG9rZW5dID0KICAgICAgICAgICAgVG9rZW5Db250cm9sSW5mbygKICAgICAgICAgICAgICAgIG1pbmltYWxSZWNvcmRSZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgbWF4UGVyQmxvY2tJbWJhbGFuY2UsCiAgICAgICAgICAgICAgICBtYXhUb3RhbEltYmFsYW5jZQogICAgICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2VuQ29udHJvbEluZm8oRVJDMjAgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnModWludCwgdWludCwgdWludCkgewogICAgICAgIHJldHVybiAodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24sCiAgICAgICAgICAgICAgICB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhQZXJCbG9ja0ltYmFsYW5jZSwKICAgICAgICAgICAgICAgIHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1heFRvdGFsSW1iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRJbWJhbGFuY2UoCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50IGJ1eUFtb3VudCwKICAgICAgICB1aW50IHJhdGVVcGRhdGVCbG9jaywKICAgICAgICB1aW50IGN1cnJlbnRCbG9jawogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgdWludCBjdXJyZW50QmxvY2tJbmRleCA9IGN1cnJlbnRCbG9jayAlIFNMSURJTkdfV0lORE9XX1NJWkU7CiAgICAgICAgaW50IHJlY29yZGVkQnV5QW1vdW50ID0gaW50KGJ1eUFtb3VudCAvIGludCh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbikpOwoKICAgICAgICBpbnQgcHJldkltYmFsYW5jZSA9IDA7CgogICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgY3VycmVudEJsb2NrRGF0YSA9CiAgICAgICAgICAgIGRlY29kZVRva2VuSW1iYWxhbmNlRGF0YSh0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW2N1cnJlbnRCbG9ja0luZGV4XSk7CgogICAgICAgIC8vIGZpcnN0IHNjZW5hcmlvIC0gdGhpcyBpcyBub3QgdGhlIGZpcnN0IHR4IGluIHRoZSBjdXJyZW50IGJsb2NrCiAgICAgICAgaWYgKGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrID09IGN1cnJlbnRCbG9jaykgewogICAgICAgICAgICBpZiAodWludChjdXJyZW50QmxvY2tEYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2spID09IHJhdGVVcGRhdGVCbG9jaykgewogICAgICAgICAgICAgICAgLy8ganVzdCBpbmNyZWFzZSBpbWJhbGFuY2UKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgKz0gcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgKz0gcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpbWJhbGFuY2Ugd2FzIGNoYW5nZWQgaW4gdGhlIG1pZGRsZSBvZiB0aGUgYmxvY2sKICAgICAgICAgICAgICAgIHByZXZJbWJhbGFuY2UgPSBnZXRJbWJhbGFuY2VJblJhbmdlKHRva2VuLCByYXRlVXBkYXRlQmxvY2ssIGN1cnJlbnRCbG9jayk7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPSBpbnQocHJldkltYmFsYW5jZSkgKyByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgKz0gcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgPSB1aW50KHJhdGVVcGRhdGVCbG9jayk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBmaXJzdCB0eCBpbiB0aGUgY3VycmVudCBibG9jawogICAgICAgICAgICBpbnQgY3VycmVudEJsb2NrSW1iYWxhbmNlOwogICAgICAgICAgICAocHJldkltYmFsYW5jZSwgY3VycmVudEJsb2NrSW1iYWxhbmNlKSA9IGdldEltYmFsYW5jZVNpbmNlUmF0ZVVwZGF0ZSh0b2tlbiwgcmF0ZVVwZGF0ZUJsb2NrLCBjdXJyZW50QmxvY2spOwoKICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSA9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9jayA9IHVpbnQoY3VycmVudEJsb2NrKTsKICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrID0gdWludChyYXRlVXBkYXRlQmxvY2spOwogICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPSBpbnQocHJldkltYmFsYW5jZSkgKyByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICB9CgogICAgICAgIHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bY3VycmVudEJsb2NrSW5kZXhdID0gZW5jb2RlVG9rZW5JbWJhbGFuY2VEYXRhKGN1cnJlbnRCbG9ja0RhdGEpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEdhcmJhZ2VUb1ZvbHVtZVJlY29yZGVyKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgU0xJRElOR19XSU5ET1dfU0laRTsgaSsrKSB7CiAgICAgICAgICAgIHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1baV0gPSAweDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEltYmFsYW5jZUluUmFuZ2UoRVJDMjAgdG9rZW4sIHVpbnQgc3RhcnRCbG9jaywgdWludCBlbmRCbG9jaykgaW50ZXJuYWwgdmlldyByZXR1cm5zKGludCBidXlJbWJhbGFuY2UpIHsKICAgICAgICAvLyBjaGVjayB0aGUgaW1iYWxhbmNlIGluIHRoZSBzbGlkaW5nIHdpbmRvdwogICAgICAgIHJlcXVpcmUoc3RhcnRCbG9jayA8PSBlbmRCbG9jayk7CgogICAgICAgIGJ1eUltYmFsYW5jZSA9IDA7CgogICAgICAgIGZvciAodWludCB3aW5kb3dJbmQgPSAwOyB3aW5kb3dJbmQgPCBTTElESU5HX1dJTkRPV19TSVpFOyB3aW5kb3dJbmQrKykgewogICAgICAgICAgICBUb2tlbkltYmFsYW5jZURhdGEgbWVtb3J5IHBlckJsb2NrRGF0YSA9IGRlY29kZVRva2VuSW1iYWxhbmNlRGF0YSh0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW3dpbmRvd0luZF0pOwoKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPD0gZW5kQmxvY2sgJiYgcGVyQmxvY2tEYXRhLmxhc3RCbG9jayA+PSBzdGFydEJsb2NrKSB7CiAgICAgICAgICAgICAgICBidXlJbWJhbGFuY2UgKz0gaW50KHBlckJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW1iYWxhbmNlU2luY2VSYXRlVXBkYXRlKEVSQzIwIHRva2VuLCB1aW50IHJhdGVVcGRhdGVCbG9jaywgdWludCBjdXJyZW50QmxvY2spCiAgICAgICAgaW50ZXJuYWwgdmlldwogICAgICAgIHJldHVybnMoaW50IGJ1eUltYmFsYW5jZSwgaW50IGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkKICAgIHsKICAgICAgICBidXlJbWJhbGFuY2UgPSAwOwogICAgICAgIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSA9IDA7CiAgICAgICAgdWludCBsYXRlc3RCbG9jayA9IDA7CiAgICAgICAgaW50IGltYmFsYW5jZUluUmFuZ2UgPSAwOwogICAgICAgIHVpbnQgc3RhcnRCbG9jayA9IHJhdGVVcGRhdGVCbG9jazsKICAgICAgICB1aW50IGVuZEJsb2NrID0gY3VycmVudEJsb2NrOwoKICAgICAgICBmb3IgKHVpbnQgd2luZG93SW5kID0gMDsgd2luZG93SW5kIDwgU0xJRElOR19XSU5ET1dfU0laRTsgd2luZG93SW5kKyspIHsKICAgICAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBwZXJCbG9ja0RhdGEgPSBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVt3aW5kb3dJbmRdKTsKCiAgICAgICAgICAgIGlmIChwZXJCbG9ja0RhdGEubGFzdEJsb2NrIDw9IGVuZEJsb2NrICYmIHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPj0gc3RhcnRCbG9jaykgewogICAgICAgICAgICAgICAgaW1iYWxhbmNlSW5SYW5nZSArPSBwZXJCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwZXJCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jayAhPSByYXRlVXBkYXRlQmxvY2spIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RCbG9jayA8IGxhdGVzdEJsb2NrKSBjb250aW51ZTsKCiAgICAgICAgICAgIGxhdGVzdEJsb2NrID0gcGVyQmxvY2tEYXRhLmxhc3RCbG9jazsKICAgICAgICAgICAgYnV5SW1iYWxhbmNlID0gcGVyQmxvY2tEYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgICAgIGlmICh1aW50KHBlckJsb2NrRGF0YS5sYXN0QmxvY2spID09IGN1cnJlbnRCbG9jaykgewogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrSW1iYWxhbmNlID0gcGVyQmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYnV5SW1iYWxhbmNlID09IDApIHsKICAgICAgICAgICAgYnV5SW1iYWxhbmNlID0gaW1iYWxhbmNlSW5SYW5nZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW1iYWxhbmNlKEVSQzIwIHRva2VuLCB1aW50IHJhdGVVcGRhdGVCbG9jaywgdWludCBjdXJyZW50QmxvY2spCiAgICAgICAgaW50ZXJuYWwgdmlldwogICAgICAgIHJldHVybnMoaW50IHRvdGFsSW1iYWxhbmNlLCBpbnQgY3VycmVudEJsb2NrSW1iYWxhbmNlKQogICAgewoKICAgICAgICBpbnQgcmVzb2x1dGlvbiA9IGludCh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbik7CgogICAgICAgICh0b3RhbEltYmFsYW5jZSwgY3VycmVudEJsb2NrSW1iYWxhbmNlKSA9CiAgICAgICAgICAgIGdldEltYmFsYW5jZVNpbmNlUmF0ZVVwZGF0ZSgKICAgICAgICAgICAgICAgIHRva2VuLAogICAgICAgICAgICAgICAgcmF0ZVVwZGF0ZUJsb2NrLAogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrKTsKCiAgICAgICAgdG90YWxJbWJhbGFuY2UgKj0gcmVzb2x1dGlvbjsKICAgICAgICBjdXJyZW50QmxvY2tJbWJhbGFuY2UgKj0gcmVzb2x1dGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNYXhQZXJCbG9ja0ltYmFsYW5jZShFUkMyMCB0b2tlbikgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4UGVyQmxvY2tJbWJhbGFuY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWF4VG90YWxJbWJhbGFuY2UoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1heFRvdGFsSW1iYWxhbmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuY29kZVRva2VuSW1iYWxhbmNlRGF0YShUb2tlbkltYmFsYW5jZURhdGEgZGF0YSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBjaGVjayBmb3Igb3ZlcmZsb3dzCiAgICAgICAgcmVxdWlyZShkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlIDwgaW50KFBPV18yXzY0IC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSA+IGludCgtMSAqIGludChQT1dfMl82NCkgLyAyKSk7CiAgICAgICAgcmVxdWlyZShkYXRhLmxhc3RCbG9jayA8IFBPV18yXzY0KTsKICAgICAgICByZXF1aXJlKGRhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA8IGludChQT1dfMl82NCAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA+IGludCgtMSAqIGludChQT1dfMl82NCkgLyAyKSk7CiAgICAgICAgcmVxdWlyZShkYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgPCBQT1dfMl82NCk7CgogICAgICAgIC8vIGRvIGVuY29kaW5nCiAgICAgICAgdWludCByZXN1bHQgPSB1aW50KGRhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UpICYgKFBPV18yXzY0IC0gMSk7CiAgICAgICAgcmVzdWx0IHw9IGRhdGEubGFzdEJsb2NrICogUE9XXzJfNjQ7CiAgICAgICAgcmVzdWx0IHw9ICh1aW50KGRhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSkgJiAoUE9XXzJfNjQgLSAxKSkgKiBQT1dfMl82NCAqIFBPV18yXzY0OwogICAgICAgIHJlc3VsdCB8PSBkYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgKiBQT1dfMl82NCAqIFBPV18yXzY0ICogUE9XXzJfNjQ7CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHVpbnQgaW5wdXQpIGludGVybmFsIHB1cmUgcmV0dXJucyhUb2tlbkltYmFsYW5jZURhdGEpIHsKICAgICAgICBUb2tlbkltYmFsYW5jZURhdGEgbWVtb3J5IGRhdGE7CgogICAgICAgIGRhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPSBpbnQoaW50NjQoaW5wdXQgJiAoUE9XXzJfNjQgLSAxKSkpOwogICAgICAgIGRhdGEubGFzdEJsb2NrID0gdWludCh1aW50NjQoKGlucHV0IC8gUE9XXzJfNjQpICYgKFBPV18yXzY0IC0gMSkpKTsKICAgICAgICBkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPSBpbnQoaW50NjQoKGlucHV0IC8gKFBPV18yXzY0ICogUE9XXzJfNjQpKSAmIChQT1dfMl82NCAtIDEpKSk7CiAgICAgICAgZGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrID0gdWludCh1aW50NjQoKGlucHV0IC8gKFBPV18yXzY0ICogUE9XXzJfNjQgKiBQT1dfMl82NCkpKSk7CgogICAgICAgIHJldHVybiBkYXRhOwogICAgfQp9Cgpjb250cmFjdCBVdGlscyB7CgogICAgRVJDMjAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9RVFkgICA9ICgxMCoqMjgpOyAvLyAxQiB0b2tlbnMKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9SQVRFICA9IChQUkVDSVNJT04gKiAxMCoqNik7IC8vIHVwIHRvIDFNIHRva2VucyBwZXIgRVRICiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfREVDSU1BTFMgPSAxODsKCiAgICBmdW5jdGlvbiBjYWxjRHN0UXR5KHVpbnQgc3JjUXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKGRzdERlY2ltYWxzID49IHNyY0RlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlKSAvIChQUkVDSVNJT04gKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjUXR5KHVpbnQgZHN0UXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy9zb3VyY2UgcXVhbnRpdHkgaXMgcm91bmRlZCB1cC4gdG8gYXZvaWQgZGVzdCBxdWFudGl0eSBiZWluZyB0b28gbG93LgogICAgICAgIHVpbnQgbnVtZXJhdG9yOwogICAgICAgIHVpbnQgZGVub21pbmF0b3I7CiAgICAgICAgaWYgKHNyY0RlY2ltYWxzID49IGRzdERlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkgKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IHJhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG51bWVyYXRvciArIGRlbm9taW5hdG9yIC0gMSkgLyBkZW5vbWluYXRvcjsgLy9hdm9pZCByb3VuZGluZyBkb3duIGVycm9ycwogICAgfQp9Cgpjb250cmFjdCBDb252ZXJzaW9uUmF0ZXMgaXMgVm9sdW1lSW1iYWxhbmNlUmVjb3JkZXIsIFV0aWxzIHsKCiAgICAvLyBicHMgLSBiYXNpYyByYXRlIHN0ZXBzLiBvbmUgc3RlcCBpcyAxIC8gMTAwMDAgb2YgdGhlIHJhdGUuCiAgICBzdHJ1Y3QgU3RlcEZ1bmN0aW9uIHsKICAgICAgICBpbnRbXSB4OyAvLyBxdWFudGl0eSBmb3IgZWFjaCBzdGVwLiBRdWFudGl0eSBvZiBlYWNoIHN0ZXAgaW5jbHVkZXMgcHJldmlvdXMgc3RlcHMuCiAgICAgICAgaW50W10geTsgLy8gcmF0ZSBjaGFuZ2UgcGVyIHF1YW50aXR5IHN0ZXAgIGluIGJwcy4KICAgIH0KCiAgICBzdHJ1Y3QgVG9rZW5EYXRhIHsKICAgICAgICBib29sIGxpc3RlZDsgIC8vIHdhcyBhZGRlZCB0byByZXNlcnZlCiAgICAgICAgYm9vbCBlbmFibGVkOyAvLyB3aGV0aGVyIHRyYWRlIGlzIGVuYWJsZWQKCiAgICAgICAgLy8gcG9zaXRpb24gaW4gdGhlIGNvbXBhY3QgZGF0YQogICAgICAgIHVpbnQgY29tcGFjdERhdGFBcnJheUluZGV4OwogICAgICAgIHVpbnQgY29tcGFjdERhdGFGaWVsZEluZGV4OwoKICAgICAgICAvLyByYXRlIGRhdGEuIGJhc2UgYW5kIGNoYW5nZXMgYWNjb3JkaW5nIHRvIHF1YW50aXR5IGFuZCByZXNlcnZlIGJhbGFuY2UuCiAgICAgICAgLy8gZ2VuZXJhbGx5IHNwZWFraW5nLiBTZWxsIHJhdGUgaXMgMSAvIGJ1eSByYXRlIGkuZS4gdGhlIGJ1eSBpbiB0aGUgb3RoZXIgZGlyZWN0aW9uLgogICAgICAgIHVpbnQgYmFzZUJ1eVJhdGU7ICAvLyBpbiBQUkVDSVNJT04gdW5pdHMuIHNlZSBLeWJlckNvbnN0YW50cwogICAgICAgIHVpbnQgYmFzZVNlbGxSYXRlOyAvLyBQUkVDSVNJT04gdW5pdHMuIHdpdGhvdXQgKHNlbGwgLyBidXkpIHNwcmVhZCBpdCBpcyAxIC8gYmFzZUJ1eVJhdGUKICAgICAgICBTdGVwRnVuY3Rpb24gYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbjsgLy8gaW4gYnBzLiBoaWdoZXIgcXVhbnRpdHkgLSBiaWdnZXIgdGhlIHJhdGUuCiAgICAgICAgU3RlcEZ1bmN0aW9uIHNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uOy8vIGluIGJwcy4gaGlnaGVyIHRoZSBxdWEKICAgICAgICBTdGVwRnVuY3Rpb24gYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbjsgLy8gaW4gQlBTLiBoaWdoZXIgcmVzZXJ2ZSBpbWJhbGFuY2UgLSBiaWdnZXIgdGhlIHJhdGUuCiAgICAgICAgU3RlcEZ1bmN0aW9uIHNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uOwogICAgfQoKICAgIC8qCiAgICB0aGlzIGlzIHRoZSBkYXRhIGZvciB0b2tlblJhdGVzQ29tcGFjdERhdGEKICAgIGJ1dCBzb2xpZGl0eSBjb21waWxlciBvcHRpbWl6ZXIgaXMgc3ViLW9wdGltYWwsIGFuZCBjYW5ub3Qgd3JpdGUgdGhpcyBzdHJ1Y3R1cmUgaW4gYSBzaW5nbGUgc3RvcmFnZSB3cml0ZQogICAgc28gd2UgcmVwcmVzZW50IGl0IGFzIGJ5dGVzMzIgYW5kIGRvIHRoZSBieXRlIHRyaWNrcyBvdXJzZWx2ZXMuCiAgICBzdHJ1Y3QgVG9rZW5SYXRlc0NvbXBhY3REYXRhIHsKICAgICAgICBieXRlczE0IGJ1eTsgIC8vIGNoYW5nZSBidXkgcmF0ZSBvZiB0b2tlbiBmcm9tIGJhc2VCdXlSYXRlIGluIDEwIGJwcwogICAgICAgIGJ5dGVzMTQgc2VsbDsgLy8gY2hhbmdlIHNlbGwgcmF0ZSBvZiB0b2tlbiBmcm9tIGJhc2VTZWxsUmF0ZSBpbiAxMCBicHMKCiAgICAgICAgdWludDMyIGJsb2NrTnVtYmVyOwogICAgfSAqLwogICAgdWludCBwdWJsaWMgdmFsaWRSYXRlRHVyYXRpb25JbkJsb2NrcyA9IDEwOyAvLyByYXRlcyBhcmUgdmFsaWQgZm9yIHRoaXMgYW1vdW50IG9mIGJsb2NrcwogICAgRVJDMjBbXSBpbnRlcm5hbCBsaXN0ZWRUb2tlbnM7CiAgICBtYXBwaW5nKGFkZHJlc3M9PlRva2VuRGF0YSkgaW50ZXJuYWwgdG9rZW5EYXRhOwogICAgYnl0ZXMzMltdIGludGVybmFsIHRva2VuUmF0ZXNDb21wYWN0RGF0YTsKICAgIHVpbnQgcHVibGljIG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhID0gMDsKICAgIGFkZHJlc3MgcHVibGljIHJlc2VydmVDb250cmFjdDsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEEgPSAxNDsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgQllURVNfMTRfT0ZGU0VUID0gKDIgKiogKDggKiBOVU1fVE9LRU5TX0lOX0NPTVBBQ1RfREFUQSkpOwoKICAgIGZ1bmN0aW9uIENvbnZlcnNpb25SYXRlcyhhZGRyZXNzIF9hZG1pbikgcHVibGljIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyKF9hZG1pbikKICAgICAgICB7IH0gLy8gc29saGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHktYmxvY2tzCgogICAgZnVuY3Rpb24gYWRkVG9rZW4oRVJDMjAgdG9rZW4pIHB1YmxpYyBvbmx5QWRtaW4gewoKICAgICAgICByZXF1aXJlKCF0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQgPSB0cnVlOwogICAgICAgIGxpc3RlZFRva2Vucy5wdXNoKHRva2VuKTsKCiAgICAgICAgaWYgKG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhID09IDApIHsKICAgICAgICAgICAgdG9rZW5SYXRlc0NvbXBhY3REYXRhLmxlbmd0aCsrOyAvLyBhZGQgbmV3IHN0cnVjdHVyZQogICAgICAgIH0KCiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXggPSB0b2tlblJhdGVzQ29tcGFjdERhdGEubGVuZ3RoIC0gMTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhRmllbGRJbmRleCA9IG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhOwoKICAgICAgICBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9IChudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSArIDEpICUgTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEE7CgogICAgICAgIHNldEdhcmJhZ2VUb1ZvbHVtZVJlY29yZGVyKHRva2VuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb21wYWN0RGF0YShieXRlczE0W10gYnV5LCBieXRlczE0W10gc2VsbCwgdWludCBibG9ja051bWJlciwgdWludFtdIGluZGljZXMpIHB1YmxpYyBvbmx5T3BlcmF0b3IgewoKICAgICAgICByZXF1aXJlKGJ1eS5sZW5ndGggPT0gc2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoaW5kaWNlcy5sZW5ndGggPT0gYnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShibG9ja051bWJlciA8PSAweEZGRkZGRkZGKTsKCiAgICAgICAgdWludCBieXRlczE0T2Zmc2V0ID0gQllURVNfMTRfT0ZGU0VUOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBpbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoaW5kaWNlc1tpXSA8IHRva2VuUmF0ZXNDb21wYWN0RGF0YS5sZW5ndGgpOwogICAgICAgICAgICB1aW50IGRhdGEgPSB1aW50KGJ1eVtpXSkgfCB1aW50KHNlbGxbaV0pICogYnl0ZXMxNE9mZnNldCB8IChibG9ja051bWJlciAqIChieXRlczE0T2Zmc2V0ICogYnl0ZXMxNE9mZnNldCkpOwogICAgICAgICAgICB0b2tlblJhdGVzQ29tcGFjdERhdGFbaW5kaWNlc1tpXV0gPSBieXRlczMyKGRhdGEpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCYXNlUmF0ZSgKICAgICAgICBFUkMyMFtdIHRva2VucywKICAgICAgICB1aW50W10gYmFzZUJ1eSwKICAgICAgICB1aW50W10gYmFzZVNlbGwsCiAgICAgICAgYnl0ZXMxNFtdIGJ1eSwKICAgICAgICBieXRlczE0W10gc2VsbCwKICAgICAgICB1aW50IGJsb2NrTnVtYmVyLAogICAgICAgIHVpbnRbXSBpbmRpY2VzCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU9wZXJhdG9yCiAgICB7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMubGVuZ3RoID09IGJhc2VCdXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHRva2Vucy5sZW5ndGggPT0gYmFzZVNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHNlbGwubGVuZ3RoID09IGJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoc2VsbC5sZW5ndGggPT0gaW5kaWNlcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKHVpbnQgaW5kID0gMDsgaW5kIDwgdG9rZW5zLmxlbmd0aDsgaW5kKyspIHsKICAgICAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5zW2luZF1dLmxpc3RlZCk7CiAgICAgICAgICAgIHRva2VuRGF0YVt0b2tlbnNbaW5kXV0uYmFzZUJ1eVJhdGUgPSBiYXNlQnV5W2luZF07CiAgICAgICAgICAgIHRva2VuRGF0YVt0b2tlbnNbaW5kXV0uYmFzZVNlbGxSYXRlID0gYmFzZVNlbGxbaW5kXTsKICAgICAgICB9CgogICAgICAgIHNldENvbXBhY3REYXRhKGJ1eSwgc2VsbCwgYmxvY2tOdW1iZXIsIGluZGljZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFF0eVN0ZXBGdW5jdGlvbigKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnRbXSB4QnV5LAogICAgICAgIGludFtdIHlCdXksCiAgICAgICAgaW50W10geFNlbGwsCiAgICAgICAgaW50W10geVNlbGwKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKHhCdXkubGVuZ3RoID09IHlCdXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHhTZWxsLmxlbmd0aCA9PSB5U2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwoKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeEJ1eSwgeUJ1eSk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbiA9IFN0ZXBGdW5jdGlvbih4U2VsbCwgeVNlbGwpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEltYmFsYW5jZVN0ZXBGdW5jdGlvbigKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnRbXSB4QnV5LAogICAgICAgIGludFtdIHlCdXksCiAgICAgICAgaW50W10geFNlbGwsCiAgICAgICAgaW50W10geVNlbGwKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKHhCdXkubGVuZ3RoID09IHlCdXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHhTZWxsLmxlbmd0aCA9PSB5U2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwoKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeEJ1eSwgeUJ1eSk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbiA9IFN0ZXBGdW5jdGlvbih4U2VsbCwgeVNlbGwpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3ModWludCBkdXJhdGlvbikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgdmFsaWRSYXRlRHVyYXRpb25JbkJsb2NrcyA9IGR1cmF0aW9uOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuYWJsZVRva2VuVHJhZGUoRVJDMjAgdG9rZW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwogICAgICAgIHJlcXVpcmUodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24gIT0gMCk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5UcmFkZShFUkMyMCB0b2tlbikgcHVibGljIG9ubHlBbGVydGVyIHsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSZXNlcnZlQWRkcmVzcyhhZGRyZXNzIHJlc2VydmUpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlc2VydmVDb250cmFjdCA9IHJlc2VydmU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVjb3JkSW1iYWxhbmNlKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIGludCBidXlBbW91bnQsCiAgICAgICAgdWludCByYXRlVXBkYXRlQmxvY2ssCiAgICAgICAgdWludCBjdXJyZW50QmxvY2sKICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcmVzZXJ2ZUNvbnRyYWN0KTsKCiAgICAgICAgaWYgKHJhdGVVcGRhdGVCbG9jayA9PSAwKSByYXRlVXBkYXRlQmxvY2sgPSBnZXRSYXRlVXBkYXRlQmxvY2sodG9rZW4pOwoKICAgICAgICByZXR1cm4gYWRkSW1iYWxhbmNlKHRva2VuLCBidXlBbW91bnQsIHJhdGVVcGRhdGVCbG9jaywgY3VycmVudEJsb2NrKTsKICAgIH0KCiAgICAvKiBzb2xoaW50LWRpc2FibGUgZnVuY3Rpb24tbWF4LWxpbmVzICovCiAgICBmdW5jdGlvbiBnZXRSYXRlKEVSQzIwIHRva2VuLCB1aW50IGN1cnJlbnRCbG9ja051bWJlciwgYm9vbCBidXksIHVpbnQgcXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBjaGVjayBpZiB0cmFkZSBpcyBlbmFibGVkCiAgICAgICAgaWYgKCF0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQpIHJldHVybiAwOwogICAgICAgIGlmICh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbiA9PSAwKSByZXR1cm4gMDsgLy8gdG9rZW4gY29udHJvbCBpbmZvIG5vdCBzZXQKCiAgICAgICAgLy8gZ2V0IHJhdGUgdXBkYXRlIGJsb2NrCiAgICAgICAgYnl0ZXMzMiBjb21wYWN0RGF0YSA9IHRva2VuUmF0ZXNDb21wYWN0RGF0YVt0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleF07CgogICAgICAgIHVpbnQgdXBkYXRlUmF0ZUJsb2NrID0gZ2V0TGFzdDRCeXRlcyhjb21wYWN0RGF0YSk7CiAgICAgICAgaWYgKGN1cnJlbnRCbG9ja051bWJlciA+PSB1cGRhdGVSYXRlQmxvY2sgKyB2YWxpZFJhdGVEdXJhdGlvbkluQmxvY2tzKSByZXR1cm4gMDsgLy8gcmF0ZSBpcyBleHBpcmVkCiAgICAgICAgLy8gY2hlY2sgaW1iYWxhbmNlCiAgICAgICAgaW50IHRvdGFsSW1iYWxhbmNlOwogICAgICAgIGludCBibG9ja0ltYmFsYW5jZTsKICAgICAgICAodG90YWxJbWJhbGFuY2UsIGJsb2NrSW1iYWxhbmNlKSA9IGdldEltYmFsYW5jZSh0b2tlbiwgdXBkYXRlUmF0ZUJsb2NrLCBjdXJyZW50QmxvY2tOdW1iZXIpOwoKICAgICAgICAvLyBjYWxjdWxhdGUgYWN0dWFsIHJhdGUKICAgICAgICBpbnQgaW1iYWxhbmNlUXR5OwogICAgICAgIGludCBleHRyYUJwczsKICAgICAgICBpbnQ4IHJhdGVVcGRhdGU7CiAgICAgICAgdWludCByYXRlOwoKICAgICAgICBpZiAoYnV5KSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IHdpdGggYmFzZSByYXRlCiAgICAgICAgICAgIHJhdGUgPSB0b2tlbkRhdGFbdG9rZW5dLmJhc2VCdXlSYXRlOwoKICAgICAgICAgICAgLy8gYWRkIHJhdGUgdXBkYXRlCiAgICAgICAgICAgIHJhdGVVcGRhdGUgPSBnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YShjb21wYWN0RGF0YSwgdG9rZW4sIHRydWUpOwogICAgICAgICAgICBleHRyYUJwcyA9IGludChyYXRlVXBkYXRlKSAqIDEwOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGNvbXB1dGUgdG9rZW4gcXR5CiAgICAgICAgICAgIHF0eSA9IGdldFRva2VuUXR5KHRva2VuLCByYXRlLCBxdHkpOwogICAgICAgICAgICBpbWJhbGFuY2VRdHkgPSBpbnQocXR5KTsKICAgICAgICAgICAgdG90YWxJbWJhbGFuY2UgKz0gaW1iYWxhbmNlUXR5OwoKICAgICAgICAgICAgLy8gYWRkIHF0eSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uLCBpbnQocXR5KSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwoKICAgICAgICAgICAgLy8gYWRkIGltYmFsYW5jZSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLCB0b3RhbEltYmFsYW5jZSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IHdpdGggYmFzZSByYXRlCiAgICAgICAgICAgIHJhdGUgPSB0b2tlbkRhdGFbdG9rZW5dLmJhc2VTZWxsUmF0ZTsKCiAgICAgICAgICAgIC8vIGFkZCByYXRlIHVwZGF0ZQogICAgICAgICAgICByYXRlVXBkYXRlID0gZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEoY29tcGFjdERhdGEsIHRva2VuLCBmYWxzZSk7CiAgICAgICAgICAgIGV4dHJhQnBzID0gaW50KHJhdGVVcGRhdGUpICogMTA7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwoKICAgICAgICAgICAgLy8gY29tcHV0ZSB0b2tlbiBxdHkKICAgICAgICAgICAgaW1iYWxhbmNlUXR5ID0gLTEgKiBpbnQocXR5KTsKICAgICAgICAgICAgdG90YWxJbWJhbGFuY2UgKz0gaW1iYWxhbmNlUXR5OwoKICAgICAgICAgICAgLy8gYWRkIHF0eSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbiwgaW50KHF0eSkpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGFkZCBpbWJhbGFuY2Ugb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24sIHRvdGFsSW1iYWxhbmNlKTsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYWJzKHRvdGFsSW1iYWxhbmNlICsgaW1iYWxhbmNlUXR5KSA+PSBnZXRNYXhUb3RhbEltYmFsYW5jZSh0b2tlbikpIHJldHVybiAwOwogICAgICAgIGlmIChhYnMoYmxvY2tJbWJhbGFuY2UgKyBpbWJhbGFuY2VRdHkpID49IGdldE1heFBlckJsb2NrSW1iYWxhbmNlKHRva2VuKSkgcmV0dXJuIDA7CgogICAgICAgIHJldHVybiByYXRlOwogICAgfQogICAgLyogc29saGludC1lbmFibGUgZnVuY3Rpb24tbWF4LWxpbmVzICovCgogICAgZnVuY3Rpb24gZ2V0QmFzaWNSYXRlKEVSQzIwIHRva2VuLCBib29sIGJ1eSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKGJ1eSkKICAgICAgICAgICAgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYmFzZUJ1eVJhdGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5iYXNlU2VsbFJhdGU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29tcGFjdERhdGEoRVJDMjAgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnModWludCwgdWludCwgYnl0ZSwgYnl0ZSkgewogICAgICAgIHVpbnQgYXJyYXlJbmRleCA9IHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFBcnJheUluZGV4OwogICAgICAgIHVpbnQgZmllbGRPZmZzZXQgPSB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhRmllbGRJbmRleDsKCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYXJyYXlJbmRleCwKICAgICAgICAgICAgZmllbGRPZmZzZXQsCiAgICAgICAgICAgIGJ5dGUoZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEodG9rZW5SYXRlc0NvbXBhY3REYXRhW2FycmF5SW5kZXhdLCB0b2tlbiwgdHJ1ZSkpLAogICAgICAgICAgICBieXRlKGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKHRva2VuUmF0ZXNDb21wYWN0RGF0YVthcnJheUluZGV4XSwgdG9rZW4sIGZhbHNlKSkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2VuQmFzaWNEYXRhKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wsIGJvb2wpIHsKICAgICAgICByZXR1cm4gKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkLCB0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQpOwogICAgfQoKICAgIC8qIHNvbGhpbnQtZGlzYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KICAgIGZ1bmN0aW9uIGdldFN0ZXBGdW5jdGlvbkRhdGEoRVJDMjAgdG9rZW4sIHVpbnQgY29tbWFuZCwgdWludCBwYXJhbSkgcHVibGljIHZpZXcgcmV0dXJucyhpbnQpIHsKICAgICAgICBpZiAoY29tbWFuZCA9PSAwKSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAyKSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi55Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMykgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLngubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA1KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA2KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDcpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICBpZiAoY29tbWFuZCA9PSA4KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gOSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDExKSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMikgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLngubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMykgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTQpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTUpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8qIHNvbGhpbnQtZW5hYmxlIGNvZGUtY29tcGxleGl0eSAqLwoKICAgIGZ1bmN0aW9uIGdldFJhdGVVcGRhdGVCbG9jayhFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgYnl0ZXMzMiBjb21wYWN0RGF0YSA9IHRva2VuUmF0ZXNDb21wYWN0RGF0YVt0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleF07CiAgICAgICAgcmV0dXJuIGdldExhc3Q0Qnl0ZXMoY29tcGFjdERhdGEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExpc3RlZFRva2VucygpIHB1YmxpYyB2aWV3IHJldHVybnMoRVJDMjBbXSkgewogICAgICAgIHJldHVybiBsaXN0ZWRUb2tlbnM7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9rZW5RdHkoRVJDMjAgdG9rZW4sIHVpbnQgZXRoUXR5LCB1aW50IHJhdGUpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBkc3REZWNpbWFscyA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICAgICAgdWludCBzcmNEZWNpbWFscyA9IDE4OwoKICAgICAgICByZXR1cm4gY2FsY0RzdFF0eShldGhRdHksIHNyY0RlY2ltYWxzLCBkc3REZWNpbWFscywgcmF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGFzdDRCeXRlcyhieXRlczMyIGIpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gY2Fubm90IHRydXN0IGNvbXBpbGVyIHdpdGggbm90IHR1cm5pbmcgYml0IG9wZXJhdGlvbnMgaW50byBFWFAgb3Bjb2RlCiAgICAgICAgcmV0dXJuIHVpbnQoYikgLyAoQllURVNfMTRfT0ZGU0VUICogQllURVNfMTRfT0ZGU0VUKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YShieXRlczMyIGRhdGEsIEVSQzIwIHRva2VuLCBib29sIGJ1eSkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGludDgpIHsKICAgICAgICB1aW50IGZpZWxkT2Zmc2V0ID0gdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUZpZWxkSW5kZXg7CiAgICAgICAgdWludCBieXRlT2Zmc2V0OwogICAgICAgIGlmIChidXkpCiAgICAgICAgICAgIGJ5dGVPZmZzZXQgPSAzMiAtIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBICsgZmllbGRPZmZzZXQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBieXRlT2Zmc2V0ID0gNCArIGZpZWxkT2Zmc2V0OwoKICAgICAgICByZXR1cm4gaW50OChkYXRhW2J5dGVPZmZzZXRdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleGVjdXRlU3RlcEZ1bmN0aW9uKFN0ZXBGdW5jdGlvbiBmLCBpbnQgeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGludCkgewogICAgICAgIHVpbnQgbGVuID0gZi55Lmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaW5kID0gMDsgaW5kIDwgbGVuOyBpbmQrKykgewogICAgICAgICAgICBpZiAoeCA8PSBmLnhbaW5kXSkgcmV0dXJuIGYueVtpbmRdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGYueVtsZW4tMV07CiAgICB9CgogICAgZnVuY3Rpb24gYWRkQnBzKHVpbnQgcmF0ZSwgaW50IGJwcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IG1heEJwcyA9IDEwMCAqIDEwMDsKICAgICAgICByZXR1cm4gKHJhdGUgKiB1aW50KGludChtYXhCcHMpICsgYnBzKSkgLyBtYXhCcHM7CiAgICB9CgogICAgZnVuY3Rpb24gYWJzKGludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIGlmICh4IDwgMCkKICAgICAgICAgICAgcmV0dXJuIHVpbnQoLTEgKiB4KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB1aW50KHgpOwogICAgfQp9Cgpjb250cmFjdCBLeWJlclJlc2VydmUgaXMgV2l0aGRyYXdhYmxlLCBVdGlscyB7CgogICAgYWRkcmVzcyBwdWJsaWMga3liZXJOZXR3b3JrOwogICAgYm9vbCBwdWJsaWMgdHJhZGVFbmFibGVkOwogICAgQ29udmVyc2lvblJhdGVzIHB1YmxpYyBjb252ZXJzaW9uUmF0ZXNDb250cmFjdDsKICAgIFNhbml0eVJhdGVzSW50ZXJmYWNlIHB1YmxpYyBzYW5pdHlSYXRlc0NvbnRyYWN0OwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBwdWJsaWMgYXBwcm92ZWRXaXRoZHJhd0FkZHJlc3NlczsgLy8gc2hhMyh0b2tlbixhZGRyZXNzKT0+Ym9vbAoKICAgIGZ1bmN0aW9uIEt5YmVyUmVzZXJ2ZShhZGRyZXNzIF9reWJlck5ldHdvcmssIENvbnZlcnNpb25SYXRlcyBfcmF0ZXNDb250cmFjdCwgYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfcmF0ZXNDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9reWJlck5ldHdvcmsgIT0gYWRkcmVzcygwKSk7CiAgICAgICAga3liZXJOZXR3b3JrID0gX2t5YmVyTmV0d29yazsKICAgICAgICBjb252ZXJzaW9uUmF0ZXNDb250cmFjdCA9IF9yYXRlc0NvbnRyYWN0OwogICAgICAgIGFkbWluID0gX2FkbWluOwogICAgICAgIHRyYWRlRW5hYmxlZCA9IHRydWU7CiAgICB9CgogICAgZXZlbnQgRGVwb3NpdFRva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCk7CgogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgRGVwb3NpdFRva2VuKEVUSF9UT0tFTl9BRERSRVNTLCBtc2cudmFsdWUpOwogICAgfQoKICAgIGV2ZW50IFRyYWRlRXhlY3V0ZSgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgb3JpZ2luLAogICAgICAgIGFkZHJlc3Mgc3JjLAogICAgICAgIHVpbnQgc3JjQW1vdW50LAogICAgICAgIGFkZHJlc3MgZGVzdFRva2VuLAogICAgICAgIHVpbnQgZGVzdEFtb3VudCwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzCiAgICApOwoKICAgIGZ1bmN0aW9uIHRyYWRlKAogICAgICAgIEVSQzIwIHNyY1Rva2VuLAogICAgICAgIHVpbnQgc3JjQW1vdW50LAogICAgICAgIEVSQzIwIGRlc3RUb2tlbiwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzLAogICAgICAgIHVpbnQgY29udmVyc2lvblJhdGUsCiAgICAgICAgYm9vbCB2YWxpZGF0ZQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZSh0cmFkZUVuYWJsZWQpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBreWJlck5ldHdvcmspOwoKICAgICAgICByZXF1aXJlKGRvVHJhZGUoc3JjVG9rZW4sIHNyY0Ftb3VudCwgZGVzdFRva2VuLCBkZXN0QWRkcmVzcywgY29udmVyc2lvblJhdGUsIHZhbGlkYXRlKSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGV2ZW50IFRyYWRlRW5hYmxlZChib29sIGVuYWJsZSk7CgogICAgZnVuY3Rpb24gZW5hYmxlVHJhZGUoKSBwdWJsaWMgb25seUFkbWluIHJldHVybnMoYm9vbCkgewogICAgICAgIHRyYWRlRW5hYmxlZCA9IHRydWU7CiAgICAgICAgVHJhZGVFbmFibGVkKHRydWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhZGUoKSBwdWJsaWMgb25seUFsZXJ0ZXIgcmV0dXJucyhib29sKSB7CiAgICAgICAgdHJhZGVFbmFibGVkID0gZmFsc2U7CiAgICAgICAgVHJhZGVFbmFibGVkKGZhbHNlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZXZlbnQgV2l0aGRyYXdBZGRyZXNzQXBwcm92ZWQoRVJDMjAgdG9rZW4sIGFkZHJlc3MgYWRkciwgYm9vbCBhcHByb3ZlKTsKCiAgICBmdW5jdGlvbiBhcHByb3ZlV2l0aGRyYXdBZGRyZXNzKEVSQzIwIHRva2VuLCBhZGRyZXNzIGFkZHIsIGJvb2wgYXBwcm92ZSkgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgYXBwcm92ZWRXaXRoZHJhd0FkZHJlc3Nlc1trZWNjYWsyNTYodG9rZW4sIGFkZHIpXSA9IGFwcHJvdmU7CiAgICAgICAgV2l0aGRyYXdBZGRyZXNzQXBwcm92ZWQodG9rZW4sIGFkZHIsIGFwcHJvdmUpOwogICAgfQoKICAgIGV2ZW50IFdpdGhkcmF3RnVuZHMoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIGRlc3RpbmF0aW9uKTsKCiAgICBmdW5jdGlvbiB3aXRoZHJhdyhFUkMyMCB0b2tlbiwgdWludCBhbW91bnQsIGFkZHJlc3MgZGVzdGluYXRpb24pIHB1YmxpYyBvbmx5T3BlcmF0b3IgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlZFdpdGhkcmF3QWRkcmVzc2VzW2tlY2NhazI1Nih0b2tlbiwgZGVzdGluYXRpb24pXSk7CgogICAgICAgIGlmICh0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBkZXN0aW5hdGlvbi50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCkpOwogICAgICAgIH0KCiAgICAgICAgV2l0aGRyYXdGdW5kcyh0b2tlbiwgYW1vdW50LCBkZXN0aW5hdGlvbik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGV2ZW50IFNldENvbnRyYWN0QWRkcmVzc2VzKGFkZHJlc3MgbmV0d29yaywgYWRkcmVzcyByYXRlLCBhZGRyZXNzIHNhbml0eSk7CgogICAgZnVuY3Rpb24gc2V0Q29udHJhY3RzKGFkZHJlc3MgX2t5YmVyTmV0d29yaywgQ29udmVyc2lvblJhdGVzIF9jb252ZXJzaW9uUmF0ZXMsIFNhbml0eVJhdGVzSW50ZXJmYWNlIF9zYW5pdHlSYXRlcykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5QWRtaW4KICAgIHsKICAgICAgICByZXF1aXJlKF9reWJlck5ldHdvcmsgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfY29udmVyc2lvblJhdGVzICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBreWJlck5ldHdvcmsgPSBfa3liZXJOZXR3b3JrOwogICAgICAgIGNvbnZlcnNpb25SYXRlc0NvbnRyYWN0ID0gX2NvbnZlcnNpb25SYXRlczsKICAgICAgICBzYW5pdHlSYXRlc0NvbnRyYWN0ID0gX3Nhbml0eVJhdGVzOwoKICAgICAgICBTZXRDb250cmFjdEFkZHJlc3NlcyhreWJlck5ldHdvcmssIGNvbnZlcnNpb25SYXRlc0NvbnRyYWN0LCBzYW5pdHlSYXRlc0NvbnRyYWN0KTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gc3RhdHVzIGZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpCiAgICAgICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpIHJldHVybiAxODsKICAgICAgICByZXR1cm4gdG9rZW4uZGVjaW1hbHMoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXREZXN0UXR5KEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBzcmNRdHksIHVpbnQgcmF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBkc3REZWNpbWFscyA9IGdldERlY2ltYWxzKGRlc3QpOwogICAgICAgIHVpbnQgc3JjRGVjaW1hbHMgPSBnZXREZWNpbWFscyhzcmMpOwoKICAgICAgICByZXR1cm4gY2FsY0RzdFF0eShzcmNRdHksIHNyY0RlY2ltYWxzLCBkc3REZWNpbWFscywgcmF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0U3JjUXR5KEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBkc3RRdHksIHVpbnQgcmF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBkc3REZWNpbWFscyA9IGdldERlY2ltYWxzKGRlc3QpOwogICAgICAgIHVpbnQgc3JjRGVjaW1hbHMgPSBnZXREZWNpbWFscyhzcmMpOwoKICAgICAgICByZXR1cm4gY2FsY1NyY1F0eShkc3RRdHksIHNyY0RlY2ltYWxzLCBkc3REZWNpbWFscywgcmF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29udmVyc2lvblJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSwgdWludCBibG9ja051bWJlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgRVJDMjAgdG9rZW47CiAgICAgICAgYm9vbCAgYnV5OwoKICAgICAgICBpZiAoIXRyYWRlRW5hYmxlZCkgcmV0dXJuIDA7CgogICAgICAgIGlmIChFVEhfVE9LRU5fQUREUkVTUyA9PSBzcmMpIHsKICAgICAgICAgICAgYnV5ID0gdHJ1ZTsKICAgICAgICAgICAgdG9rZW4gPSBkZXN0OwogICAgICAgIH0gZWxzZSBpZiAoRVRIX1RPS0VOX0FERFJFU1MgPT0gZGVzdCkgewogICAgICAgICAgICBidXkgPSBmYWxzZTsKICAgICAgICAgICAgdG9rZW4gPSBzcmM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIDA7IC8vIHBhaXIgaXMgbm90IGxpc3RlZAogICAgICAgIH0KCiAgICAgICAgdWludCByYXRlID0gY29udmVyc2lvblJhdGVzQ29udHJhY3QuZ2V0UmF0ZSh0b2tlbiwgYmxvY2tOdW1iZXIsIGJ1eSwgc3JjUXR5KTsKICAgICAgICB1aW50IGRlc3RRdHkgPSBnZXREZXN0UXR5KHNyYywgZGVzdCwgc3JjUXR5LCByYXRlKTsKCiAgICAgICAgaWYgKGdldEJhbGFuY2UoZGVzdCkgPCBkZXN0UXR5KSByZXR1cm4gMDsKCiAgICAgICAgaWYgKHNhbml0eVJhdGVzQ29udHJhY3QgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICB1aW50IHNhbml0eVJhdGUgPSBzYW5pdHlSYXRlc0NvbnRyYWN0LmdldFNhbml0eVJhdGUoc3JjLCBkZXN0KTsKICAgICAgICAgICAgaWYgKHJhdGUgPiBzYW5pdHlSYXRlKSByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHJldHVybiByYXRlOwogICAgfQoKICAgIC8vLyBAZGV2IGRvIGEgdHJhZGUKICAgIC8vLyBAcGFyYW0gc3JjVG9rZW4gU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIHNyY0Ftb3VudCBBbW91bnQgb2Ygc3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RUb2tlbiBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0QWRkcmVzcyBEZXN0aW5hdGlvbiBhZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgICAvLy8gQHBhcmFtIHZhbGlkYXRlIElmIHRydWUsIGFkZGl0aW9uYWwgdmFsaWRhdGlvbnMgYXJlIGFwcGxpY2FibGUKICAgIC8vLyBAcmV0dXJuIHRydWUgaWZmIHRyYWRlIGlzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhZGUoCiAgICAgICAgRVJDMjAgc3JjVG9rZW4sCiAgICAgICAgdWludCBzcmNBbW91bnQsCiAgICAgICAgRVJDMjAgZGVzdFRva2VuLAogICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgdWludCBjb252ZXJzaW9uUmF0ZSwKICAgICAgICBib29sIHZhbGlkYXRlCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgLy8gY2FuIHNraXAgdmFsaWRhdGlvbiBpZiBkb25lIGF0IGt5YmVyIG5ldHdvcmsgbGV2ZWwKICAgICAgICBpZiAodmFsaWRhdGUpIHsKICAgICAgICAgICAgcmVxdWlyZShjb252ZXJzaW9uUmF0ZSA+IDApOwogICAgICAgICAgICBpZiAoc3JjVG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpCiAgICAgICAgICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBzcmNBbW91bnQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKICAgICAgICB9CgogICAgICAgIHVpbnQgZGVzdEFtb3VudCA9IGdldERlc3RRdHkoc3JjVG9rZW4sIGRlc3RUb2tlbiwgc3JjQW1vdW50LCBjb252ZXJzaW9uUmF0ZSk7CiAgICAgICAgLy8gc2FuaXR5IGNoZWNrCiAgICAgICAgcmVxdWlyZShkZXN0QW1vdW50ID4gMCk7CgogICAgICAgIC8vIGFkZCB0byBpbWJhbGFuY2UKICAgICAgICBFUkMyMCB0b2tlbjsKICAgICAgICBpbnQgYnV5OwogICAgICAgIGlmIChzcmNUb2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBidXkgPSBpbnQoZGVzdEFtb3VudCk7CiAgICAgICAgICAgIHRva2VuID0gZGVzdFRva2VuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1eSA9IC0xICogaW50KHNyY0Ftb3VudCk7CiAgICAgICAgICAgIHRva2VuID0gc3JjVG9rZW47CiAgICAgICAgfQoKICAgICAgICBjb252ZXJzaW9uUmF0ZXNDb250cmFjdC5yZWNvcmRJbWJhbGFuY2UoCiAgICAgICAgICAgIHRva2VuLAogICAgICAgICAgICBidXksCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGJsb2NrLm51bWJlcgogICAgICAgICk7CgogICAgICAgIC8vIGNvbGxlY3Qgc3JjIHRva2VucwogICAgICAgIGlmIChzcmNUb2tlbiAhPSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICByZXF1aXJlKHNyY1Rva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBzcmNBbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIC8vIHNlbmQgZGVzdCB0b2tlbnMKICAgICAgICBpZiAoZGVzdFRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGRlc3RBZGRyZXNzLnRyYW5zZmVyKGRlc3RBbW91bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoZGVzdFRva2VuLnRyYW5zZmVyKGRlc3RBZGRyZXNzLCBkZXN0QW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICBUcmFkZUV4ZWN1dGUobXNnLnNlbmRlciwgc3JjVG9rZW4sIHNyY0Ftb3VudCwgZGVzdFRva2VuLCBkZXN0QW1vdW50LCBkZXN0QWRkcmVzcyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9Cgpjb250cmFjdCBTYW5pdHlSYXRlcyBpcyBTYW5pdHlSYXRlc0ludGVyZmFjZSwgV2l0aGRyYXdhYmxlLCBVdGlscyB7CiAgICBtYXBwaW5nKGFkZHJlc3M9PnVpbnQpIHB1YmxpYyB0b2tlblJhdGU7CiAgICBtYXBwaW5nKGFkZHJlc3M9PnVpbnQpIHB1YmxpYyByZWFzb25hYmxlRGlmZkluQnBzOwoKICAgIGZ1bmN0aW9uIFNhbml0eVJhdGVzKGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGFkbWluID0gX2FkbWluOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFJlYXNvbmFibGVEaWZmKEVSQzIwW10gc3JjcywgdWludFtdIGRpZmYpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoc3Jjcy5sZW5ndGggPT0gZGlmZi5sZW5ndGgpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHNyY3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcmVhc29uYWJsZURpZmZJbkJwc1tzcmNzW2ldXSA9IGRpZmZbaV07CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNhbml0eVJhdGVzKEVSQzIwW10gc3JjcywgdWludFtdIHJhdGVzKSBwdWJsaWMgb25seU9wZXJhdG9yIHsKICAgICAgICByZXF1aXJlKHNyY3MubGVuZ3RoID09IHJhdGVzLmxlbmd0aCk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHNyY3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG9rZW5SYXRlW3NyY3NbaV1dID0gcmF0ZXNbaV07CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFNhbml0eVJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAoc3JjICE9IEVUSF9UT0tFTl9BRERSRVNTICYmIGRlc3QgIT0gRVRIX1RPS0VOX0FERFJFU1MpIHJldHVybiAwOwoKICAgICAgICB1aW50IHJhdGU7CiAgICAgICAgYWRkcmVzcyB0b2tlbjsKICAgICAgICBpZiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIHJhdGUgPSAoUFJFQ0lTSU9OKlBSRUNJU0lPTikvdG9rZW5SYXRlW2Rlc3RdOwogICAgICAgICAgICB0b2tlbiA9IGRlc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmF0ZSA9IHRva2VuUmF0ZVtzcmNdOwogICAgICAgICAgICB0b2tlbiA9IHNyYzsKICAgICAgICB9CgogICAgICAgIHJldHVybiByYXRlICogKDEwMDAwICsgcmVhc29uYWJsZURpZmZJbkJwc1t0b2tlbl0pLzEwMDAwOwogICAgfQp9'.
	

]
