Class {
	#name : #SRT5d9a60dcd25966e49a7db368241e8766ca834d61,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5d9a60dcd25966e49a7db368241e8766ca834d61 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBCdXJuYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7CgogICAgLyoqCiAgICAgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgYW1vdW50IG9mIHRva2Vucy4KICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSBidXJuZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKCiAgICAgICAgYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGJhbGFuY2VzW2J1cm5lcl0gPSBiYWxhbmNlc1tidXJuZXJdLnN1YihfdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CiAgICAgICAgQnVybihidXJuZXIsIF92YWx1ZSk7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVkQnVybmFibGVUb2tlbiBpcyBCdXJuYWJsZVRva2VuIHsKCiAgICAgICAgLyoqCiAgICAgICAgICAgU2VudCB3aGVuIGBidXJuZXJgIGJ1cm5zIHNvbWUgYHZhbHVlYCBvZiBgb3duZXJzYCB0b2tlbnMuCiAgICAgICAgKi8KICAgICAgICBldmVudCBCdXJuRnJvbShhZGRyZXNzIGluZGV4ZWQgb3duZXIsIC8vIFRoZSBhZGRyZXNzIHdob3NlIHRva2VucyB3ZXJlIGJ1cm5lZC4KICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCAvLyBUaGUgYWRkcmVzcyB0aGF0IGV4ZWN1dGVkIHRoZSBgYnVybkZyb21gIGNhbGwKICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IHZhbHVlICAgICAgICAgICAvLyBUaGUgYW1vdW50IG9mIHRva2VucyB0aGF0IHdlcmUgYnVybmVkLgogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgLyoqCiAgICAgICAgICAgQGRldiBCdXJucyBhIHNwZWNpZmljIGFtb3VudCBvZiB0b2tlbnMgb2YgYW5vdGhlciBhY2NvdW50IHRoYXQgYG1zZy5zZW5kZXJgCiAgICAgICAgICAgd2FzIGFwcHJvdmVkIHRvIGJ1cm4gdG9rZW5zIGZvciB1c2luZyBgYXBwcm92ZUJ1cm5gIGVhcmxpZXIuCiAgICAgICAgICAgQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBidXJuIHRva2VucyBmcm9tLgogICAgICAgICAgIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSBidXJuZWQuCiAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBidXJuRnJvbShhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgICAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX293bmVyXSk7CiAgICAgICAgICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19vd25lcl1bbXNnLnNlbmRlcl0pOwogICAgICAgICAgICAgICAgLy8gbm8gbmVlZCB0byByZXF1aXJlIHZhbHVlIDw9IHRvdGFsU3VwcGx5LCBzaW5jZSB0aGF0IHdvdWxkIGltcGx5IHRoZQogICAgICAgICAgICAgICAgLy8gc2VuZGVyJ3MgYmFsYW5jZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRvdGFsU3VwcGx5LCB3aGljaCAqc2hvdWxkKiBiZSBhbiBhc3NlcnRpb24gZmFpbHVyZQoKICAgICAgICAgICAgICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW19vd25lcl0gPSBiYWxhbmNlc1tfb3duZXJdLnN1YihfdmFsdWUpOwogICAgICAgICAgICAgICAgYWxsb3dlZFtfb3duZXJdW2J1cm5lcl0gPSBhbGxvd2VkW19vd25lcl1bYnVybmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICAgICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CgogICAgICAgICAgICAgICAgQnVybkZyb20oX293bmVyLCBidXJuZXIsIF92YWx1ZSk7CiAgICAgICAgICAgICAgICBCdXJuKF9vd25lciwgX3ZhbHVlKTsKICAgICAgICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgTWludGFibGVUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcyB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZCAoYm90aCBpbmNsdXNpdmUpCiAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICB1aW50MjU2IHB1YmxpYyByYXRlOwoKICAvLyBhbW91bnQgb2YgcmFpc2VkIG1vbmV5IGluIHdlaQogIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKCiAgLyoqCiAgICogZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlIGxvZ2dpbmcKICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwogICAqIEBwYXJhbSB2YWx1ZSB3ZWlzIHBhaWQgZm9yIHB1cmNoYXNlCiAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CgoKICBmdW5jdGlvbiBDcm93ZHNhbGUodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lLCB1aW50MjU2IF9yYXRlLCBhZGRyZXNzIF93YWxsZXQpIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogIC8vIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgY3Jvd2RzYWxlIG9mIGEgc3BlY2lmaWMgbWludGFibGUgdG9rZW4uCiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgIHJldHVybiBuZXcgTWludGFibGVUb2tlbigpOwogIH0KCgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICB9CgogIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CgogICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCiAgICB1aW50MjU2IHRva2VucyA9IHdlaUFtb3VudC5tdWwocmF0ZSk7CgogICAgLy8gdXBkYXRlIHN0YXRlCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgdG9rZW4ubWludChiZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgdG9rZW5zKTsKCiAgICBmb3J3YXJkRnVuZHMoKTsKICB9CgogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQoKCn0KCmNvbnRyYWN0IENhcHBlZENyb3dkc2FsZSBpcyBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICB1aW50MjU2IHB1YmxpYyBjYXA7CgogIGZ1bmN0aW9uIENhcHBlZENyb3dkc2FsZSh1aW50MjU2IF9jYXApIHsKICAgIHJlcXVpcmUoX2NhcCA+IDApOwogICAgY2FwID0gX2NhcDsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIGV4dHJhIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBpbnZlc3RvcnMgY2FuIGJ1eSBhdCB0aGUgbW9tZW50CiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluQ2FwID0gd2VpUmFpc2VkLmFkZChtc2cudmFsdWUpIDw9IGNhcDsKICAgIHJldHVybiBzdXBlci52YWxpZFB1cmNoYXNlKCkgJiYgd2l0aGluQ2FwOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBjYXBSZWFjaGVkID0gd2VpUmFpc2VkID49IGNhcDsKICAgIHJldHVybiBzdXBlci5oYXNFbmRlZCgpIHx8IGNhcFJlYWNoZWQ7CiAgfQoKfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IEZpbmFsaXphYmxlQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogIGV2ZW50IEZpbmFsaXplZCgpOwoKICAvKioKICAgKiBAZGV2IE11c3QgYmUgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBlbmRzLCB0byBkbyBzb21lIGV4dHJhIGZpbmFsaXphdGlvbgogICAqIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZShoYXNFbmRlZCgpKTsKCiAgICBmaW5hbGl6YXRpb24oKTsKICAgIEZpbmFsaXplZCgpOwoKICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FuIGJlIG92ZXJyaWRkZW4gdG8gYWRkIGZpbmFsaXphdGlvbiBsb2dpYy4gVGhlIG92ZXJyaWRpbmcgZnVuY3Rpb24KICAgKiBzaG91bGQgY2FsbCBzdXBlci5maW5hbGl6YXRpb24oKSB0byBlbnN1cmUgdGhlIGNoYWluIG9mIGZpbmFsaXphdGlvbiBpcwogICAqIGV4ZWN1dGVkIGVudGlyZWx5LgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICBUcmFuc2ZlcigweDAsIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBVbmxvY2tlZEFmdGVyTWludGluZ1Rva2VuIGlzIE1pbnRhYmxlVG9rZW4gewoKICAgIC8qKgogICAgICAgRW5zdXJlcyBjZXJ0YWluIGNhbGxzIGNhbiBvbmx5IGJlIG1hZGUgd2hlbiBtaW50aW5nIGlzIGZpbmlzaGVkLgoKICAgICAgIFRoZSBjYWxscyB0aGF0IGFyZSByZXN0cmljdGVkIGFyZSBhbnkgY2FsbHMgdGhhdCBhbGxvdyBkaXJlY3Qgb3IgaW5kaXJlY3QgdHJhbnNmZXJyYWwgb2YgZnVuZHMuCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5NaW50aW5nRmluaXNoZWQoKSB7CiAgICAgICAgcmVxdWlyZShtaW50aW5nRmluaXNoZWQpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk1pbnRpbmdGaW5pc2hlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAgQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICAgIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgICAgQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAgIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk1pbnRpbmdGaW5pc2hlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgICAgQGRldiBOT1RFOiBUaGlzIGNhbGwgaXMgY29uc2lkZXJlZCBkZXByZWNhdGVkLCBhbmQgb25seSBpbmNsdWRlZCBmb3IgcHJvcGVyIGNvbXBsaWFuY2Ugd2l0aCBFUkMyMC4KICAgICAgQGRldiBSYXRoZXIgdGhhbiB1c2UgdGhpcyBjYWxsLCB1c2UgYGluY3JlYXNlQXBwcm92YWxgIGFuZCBgZGVjcmVhc2VBcHByb3ZhbGAgaW5zdGVhZCwgd2hlbmV2ZXIgcG9zc2libGUuCiAgICAgIEBkZXYgVGhlIHJlYXNvbiBmb3IgdGhpcywgaXMgdGhhdCB1c2luZyBgYXBwcm92ZWAgZGlyZWN0bHkgd2hlbiB5b3VyIGFsbG93YW5jZSBpcyBub256ZXJvIHJlc3VsdHMgaW4gYW4gZXhwbG9pdGFibGUgc2l0dWF0aW9uOgogICAgICBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CgogICAgICBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTWludGluZ0ZpbmlzaGVkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAgQGRldiBhcHByb3ZlIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGFsdGVyIHRoZQogICAgICBAZGV2IGFsbG93ZWQgdmFsdWUgaXQgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uLCBiZWNhdXNlIGl0IGlzIHNhZmVyLgogICAgICBAZGV2IChBbmQgbWFraW5nIGBhcHByb3ZlYCBzYWZlIG1hbnVhbGx5IHdvdWxkIHJlcXVpcmUgbWFraW5nIHR3byBjYWxscyBtYWRlIGluIHNlcGFyYXRlIGJsb2Nrcy4pCgogICAgICBUaGlzIG1ldGhvZCB3YXMgYWRhcHRlZCBmcm9tIHRoZSBvbmUgaW4gdXNlIGJ5IHRoZSBNb25vbGl0aERBTyBUb2tlbi4KICAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgd2hlbk1pbnRpbmdGaW5pc2hlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gc3VwZXIuaW5jcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX2FkZGVkVmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICAgQGRldiBhcHByb3ZlIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGFsdGVyIHRoZQogICAgICAgQGRldiBhbGxvd2VkIHZhbHVlIGl0IGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiwgYmVjYXVzZSBpdCBpcyBzYWZlci4KICAgICAgIEBkZXYgKEFuZCBtYWtpbmcgYGFwcHJvdmVgIHNhZmUgbWFudWFsbHkgd291bGQgcmVxdWlyZSBtYWtpbmcgdHdvIGNhbGxzIG1hZGUgaW4gc2VwYXJhdGUgYmxvY2tzLikKCiAgICAgICBUaGlzIG1ldGhvZCB3YXMgYWRhcHRlZCBmcm9tIHRoZSBvbmUgaW4gdXNlIGJ5IHRoZSBNb25vbGl0aERBTyBUb2tlbi4KICAgICovCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHdoZW5NaW50aW5nRmluaXNoZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQoKICAgIC8vIFRPRE8gUHJldmVudCBidXJuaW5nPwp9Cgpjb250cmFjdCBaYWtlbUNvaW4gaXMgVW5sb2NrZWRBZnRlck1pbnRpbmdUb2tlbiwgQXBwcm92ZWRCdXJuYWJsZVRva2VuIHsKICAgICAgICAvKioKICAgICAgICAgICBAZGV2IFdlIGRvIG5vdCBleHBlY3QgdGhpcyB0byBjaGFuZ2UgZXZlciBhZnRlciBkZXBsb3ltZW50LAogICAgICAgICAgIEBkZXYgYnV0IGl0IGlzIGEgd2F5IHRvIGlkZW50aWZ5IGRpZmZlcmVudCB2ZXJzaW9ucyBvZiB0aGUgWmFrZW1Db2luIGR1cmluZyBkZXZlbG9wbWVudC4KICAgICAgICAqLwogICAgICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBjb250cmFjdFZlcnNpb24gPSAxOwoKICAgICAgICAvKioKICAgICAgICAgICBAZGV2IFRoZSBuYW1lIG9mIHRoZSBaYWtlbUNvaW4sIHNwZWNpZmllZCBhcyBpbmRpY2F0ZWQgaW4gRVJDMjAuCiAgICAgICAgICovCiAgICAgICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlpha2VtQ29pbiI7CgogICAgICAgIC8qKgogICAgICAgICAgIEBkZXYgVGhlIGFiYnJldmlhdGlvbiBGSU5DLCBzcGVjaWZpZWQgYXMgaW5kaWNhdGVkIGluIEVSQzIwLgogICAgICAgICovCiAgICAgICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRklOQyI7CgogICAgICAgIC8qKgogICAgICAgICAgIEBkZXYgVGhlIHNtYWxsZXN0IGRlbm9taW5hdGlvbiBvZiB0aGUgWmFrZW1Db2luIGlzIDEgKiAxMF4oLTE4KSBGSU5DLiBgZGVjaW1hbHNgIGlzIHNwZWNpZmllZCBhcyBpbmRpY2F0ZWQgaW4gRVJDMjAuCiAgICAgICAgKi8KICAgICAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICAgICAgLy8gVE9ETyBleHRyYWN0VG9rZW4gZnVuY3Rpb24gdG8gYWxsb3cgcGVvcGxlIHRvIHJldHJpZXZlIHRva2VuLWZ1bmRzIHNlbnQgaGVyZSBieSBtaXN0YWtlPwoKICAgICAgICAvLyBUT0RPIEVSQzIyMy1pbnRlcmZhY2UKfQoKY29udHJhY3QgUmVmdW5kVmF1bHQgaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGVudW0gU3RhdGUgeyBBY3RpdmUsIFJlZnVuZGluZywgQ2xvc2VkIH0KCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkOwogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKICBTdGF0ZSBwdWJsaWMgc3RhdGU7CgogIGV2ZW50IENsb3NlZCgpOwogIGV2ZW50IFJlZnVuZHNFbmFibGVkKCk7CiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCk7CgogIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KGFkZHJlc3MgX3dhbGxldCkgewogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgfQoKICBmdW5jdGlvbiBkZXBvc2l0KGFkZHJlc3MgaW52ZXN0b3IpIG9ubHlPd25lciBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gZGVwb3NpdGVkW2ludmVzdG9yXS5hZGQobXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKICAgIHVpbnQyNTYgZGVwb3NpdGVkVmFsdWUgPSBkZXBvc2l0ZWRbaW52ZXN0b3JdOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogIH0KfQoKY29udHJhY3QgUmVmdW5kYWJsZUNyb3dkc2FsZSBpcyBGaW5hbGl6YWJsZUNyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIG1pbmltdW0gYW1vdW50IG9mIGZ1bmRzIHRvIGJlIHJhaXNlZCBpbiB3ZWlzCiAgdWludDI1NiBwdWJsaWMgZ29hbDsKCiAgLy8gcmVmdW5kIHZhdWx0IHVzZWQgdG8gaG9sZCBmdW5kcyB3aGlsZSBjcm93ZHNhbGUgaXMgcnVubmluZwogIFJlZnVuZFZhdWx0IHB1YmxpYyB2YXVsdDsKCiAgZnVuY3Rpb24gUmVmdW5kYWJsZUNyb3dkc2FsZSh1aW50MjU2IF9nb2FsKSB7CiAgICByZXF1aXJlKF9nb2FsID4gMCk7CiAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdCh3YWxsZXQpOwogICAgZ29hbCA9IF9nb2FsOwogIH0KCiAgLy8gV2UncmUgb3ZlcnJpZGluZyB0aGUgZnVuZCBmb3J3YXJkaW5nIGZyb20gQ3Jvd2RzYWxlLgogIC8vIEluIGFkZGl0aW9uIHRvIHNlbmRpbmcgdGhlIGZ1bmRzLCB3ZSB3YW50IHRvIGNhbGwKICAvLyB0aGUgUmVmdW5kVmF1bHQgZGVwb3NpdCBmdW5jdGlvbgogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHZhdWx0LmRlcG9zaXQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKTsKICB9CgogIC8vIGlmIGNyb3dkc2FsZSBpcyB1bnN1Y2Nlc3NmdWwsIGludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kcyBoZXJlCiAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWMgewogICAgcmVxdWlyZShpc0ZpbmFsaXplZCk7CiAgICByZXF1aXJlKCFnb2FsUmVhY2hlZCgpKTsKCiAgICB2YXVsdC5yZWZ1bmQobXNnLnNlbmRlcik7CiAgfQoKICAvLyB2YXVsdCBmaW5hbGl6YXRpb24gdGFzaywgY2FsbGVkIHdoZW4gb3duZXIgY2FsbHMgZmluYWxpemUoKQogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgIGlmIChnb2FsUmVhY2hlZCgpKSB7CiAgICAgIHZhdWx0LmNsb3NlKCk7CiAgICB9IGVsc2UgewogICAgICB2YXVsdC5lbmFibGVSZWZ1bmRzKCk7CiAgICB9CgogICAgc3VwZXIuZmluYWxpemF0aW9uKCk7CiAgfQoKICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IGdvYWw7CiAgfQoKfQoKY29udHJhY3QgWmFrZW1GYW5zQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlLCBSZWZ1bmRhYmxlQ3Jvd2RzYWxlLCBDYXBwZWRDcm93ZHNhbGUgewogICAgICAgIC8qKgogICAgICAgICAgIEFkZHJlc3Mgb2YgdGhlIHdhbGxldCBvZiB0aGUgZm91bmRlcnMuCiAgICAgICAgICAgSW4gdGhpcyB3YWxsZXQsIHBhcnQgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzdG9yZWQsIGFuZCB0aGV5IHdpbGwgYmUgbG9ja2VkIGZvciAyNCBtb250aHMuCiAgICAgICAgICovCiAgICAgICAgYWRkcmVzcyBwdWJsaWMgZm91bmRlcnNXYWxsZXQ7CgogICAgICAgIC8qKgogICAgICAgICAgIEFkZHJlc3Mgb2YgdGhlIHdhbGxldCB1c2VkIHRvIHBheSBvdXQgYm91bnRpZXMuCiAgICAgICAgICAgSW4gdGhpcyB3YWxsZXQsIHBhcnQgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzdG9yZWQuCiAgICAgICAgICovCiAgICAgICAgYWRkcmVzcyBwdWJsaWMgYm91bnRpZXNXYWxsZXQ7CgogICAgICAgIC8qKgogICAgICAgICAgIEtlZXBzIHRyYWNrIG9mIGhvdyBtYW55IHRva2VucyBoYXZlIGJlZW4gcmFpc2VkIHNvIGZhci4KICAgICAgICAgICBVc2VkIHRvIGtub3cgd2hlbiBgZ29hbGAgYW5kIGBjYXBgIGhhdmUgYmVlbiByZWFjaGVkLgogICAgICAgICAqLwogICAgICAgIHVpbnQyNTYgcHVibGljIHB1cmNoYXNlZFRva2Vuc1JhaXNlZDsKCiAgICAgICAgLyoqCiAgICAgICAgICAgVGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB3ZXJlIHNvbGQgaW4gdGhlIFByZXNhbGUgYmVmb3JlIHRoZSBDcm93ZHNhbGUuCiAgICAgICAgICAgR2l2ZW4gZHVyaW5nIGNvbnN0cnVjdGlvbiBvZiB0aGlzIGNvbnRyYWN0LgogICAgICAgICAqLwogICAgICAgIHVpbnQyNTYgcHVibGljIHB1cmNoYXNlZFRva2Vuc1JhaXNlZER1cmluZ1ByZXNhbGU7CgogICAgICAgIC8qKgogICAgICAgICAgIEhlbHBlciBwcm9wZXJ0eSB0byBlbnN1cmUgdGhhdCAxLzEyIG9mIGBjYXBgIGRvZXMgbm90IG5lZWQgdG8gYmUgcmUtY2FsY3VsYXRlZCBldmVyeSB0aW1lLgogICAgICAgICAqLwogICAgICAgIHVpbnQyNTYgb25lVHdlbGZ0aE9mQ2FwOwoKICAgICAgICAvKioKICAgICAgICAgICBAZGV2IENvbnN0cnVjdG9yIG9mIHRoZSBaYWtlbUZhbnNDcm93ZHNhbGUgY29udHJhY3QKCiAgICAgICAgICAgQHBhcmFtIF9zdGFydFRpbWUgdGltZSAoU29saWRpdHkgVU5JWCB0aW1lc3RhbXApIGZyb20gd2hlbiBpdCBpcyBhbGxvd2VkIHRvIGJ1eSBGSU5DLgogICAgICAgICAgIEBwYXJhbSBfZW5kVGltZSB0aW1lIChTb2xpZGl0eSBVTklYIHRpbWVzdGFtcCkgdW50aWwgd2hpY2ggaXQgaXMgYWxsb3dlZCB0byBidXkgRklOQy4gKFNob3VsZCBiZSBsYXJnZXIgdGhhbiBzdGFydFRpbWUpCiAgICAgICAgICAgQHBhcmFtIF9yYXRlIE51bWJlciBvZiB0b2tlbnMgY3JlYXRlZCBwZXIgZXRoZXIuIChTaW5jZSBFdGhlciBhbmQgWmFrZW1Db2luIHVzZSB0aGUgc2FtZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMsIHRoaXMgY2FuIGJlIHJlYWQgYXMgZGlyZWN0IGNvbnZlcnNpb24gcmF0ZSBvZiBFdGhlciAtPiBaYWtlbUNvaW4uKQogICAgICAgICAgIEBwYXJhbSBfd2FsbGV0IFRoZSB3YWxsZXQgb2YgWmFrZW1GYW5zIGl0c2VsZiwgdG8gd2hpY2ggc29tZSBvZiB0aGUgZmFjaWxpdGF0aW5nIHRva2VucyB3aWxsIGJlIHNlbnQuCiAgICAgICAgICAgQHBhcmFtIF9ib3VudGllc1dhbGxldCBUaGUgd2FsbGV0IHVzZWQgdG8gcGF5IG91dCBib3VudGllcywgdG8gd2hpY2ggc29tZSBvZiB0aGUgZmFjaWxpdGF0aW5nIHRva2VucyB3aWxsIGJlIHNlbnQuCiAgICAgICAgICAgQHBhcmFtIF9mb3VuZGVyc1dhbGxldCBUaGUgd2FsbGV0IHVzZWQgZm9yIHRoZSBmb3VuZGVycywgdG8gd2hpY2ggc29tZSBvZiB0aGUgZmFjaWxpdGF0aW5nIHRva2VucyB3aWxsIGJlIHNlbnQuCiAgICAgICAgICAgQHBhcmFtIF9nb2FsIFRoZSBtaW5pbXVtIGdvYWwgKGluIDEgKiAxMF4oLTE4KSB0b2tlbnMpIHRoYXQgdGhlIENyb3dkc2FsZSBuZWVkcyB0byByZWFjaC4KICAgICAgICAgICBAcGFyYW0gX2NhcCBUaGUgbWF4aW11bSBjYXAgKGluIDEgKiAxMF4oLTE4KSB0b2tlbnMpIHRoYXQgdGhlIENyb3dkc2FsZSBjYW4gcmVhY2guCiAgICAgICAgICAgQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyB3aGVyZSB0aGUgWmFrZW1Db2luIGNvbnRyYWN0IHdhcyBkZXBsb3llZCBwcmlvciB0byBjcmVhdGluZyB0aGlzIGNvbnRyYWN0LgogICAgICAgICAgIEBwYXJhbSBfcHVyY2hhc2VkVG9rZW5zUmFpc2VkRHVyaW5nUHJlc2FsZSBUaGUgYW1vdW50IChpbiAxICogMTheMTggdG9rZW5zKSB0aGF0IHdhcyBwdXJjaGFzZWQgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIFpha2VtRmFuc0Nyb3dkc2FsZSAoCiAgICAgICAgICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDI1NiBfcmF0ZSwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX3dhbGxldCwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX2JvdW50aWVzV2FsbGV0LAogICAgICAgICAgICAgICAgYWRkcmVzcyBfZm91bmRlcnNXYWxsZXQsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9nb2FsLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfdG9rZW4sCiAgICAgICAgICAgICAgICB1aW50MjU2IF9wdXJjaGFzZWRUb2tlbnNSYWlzZWREdXJpbmdQcmVzYWxlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIF9yYXRlLCBfd2FsbGV0KQogICAgICAgICAgICAgICAgUmVmdW5kYWJsZUNyb3dkc2FsZShfZ29hbCkKICAgICAgICAgICAgICAgIENhcHBlZENyb3dkc2FsZShfY2FwKQogICAgICAgIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoX2dvYWwgPCBfY2FwKTsKCiAgICAgICAgICAgICAgICBib3VudGllc1dhbGxldCA9IF9ib3VudGllc1dhbGxldDsKICAgICAgICAgICAgICAgIGZvdW5kZXJzV2FsbGV0ID0gX2ZvdW5kZXJzV2FsbGV0OwogICAgICAgICAgICAgICAgdG9rZW4gPSBaYWtlbUNvaW4oX3Rva2VuKTsKICAgICAgICAgICAgICAgIHdlaVJhaXNlZCA9IDA7CgogICAgICAgICAgICAgICAgcHVyY2hhc2VkVG9rZW5zUmFpc2VkRHVyaW5nUHJlc2FsZSA9IF9wdXJjaGFzZWRUb2tlbnNSYWlzZWREdXJpbmdQcmVzYWxlOwogICAgICAgICAgICAgICAgcHVyY2hhc2VkVG9rZW5zUmFpc2VkID0gcHVyY2hhc2VkVG9rZW5zUmFpc2VkRHVyaW5nUHJlc2FsZTsKCiAgICAgICAgICAgICAgICBvbmVUd2VsZnRoT2ZDYXAgPSBfY2FwIC8gMTI7CiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAgT3ZlcnJpZGVzIENyb3dkc2FsZS5jcmVhdGVUb2tlbkNvbnRyYWN0LAogICAgICAgICAgYmVjYXVzZSB0aGUgWmFrZW1GYW5zQ3Jvd2RzYWxlIHVzZXMgYW4gYWxyZWFkeS1kZXBsb3llZAogICAgICAgICAgdG9rZW4sIHNvIHRoZXJlIGlzIG5vIG5lZWQgdG8gaW50ZXJuYWxseSBkZXBsb3kgYSBjb250cmFjdC4KICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWludGFibGVUb2tlbigweDApOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAgKiBPdmVycmlkZXMgdmVyc2lvbiBvZiBDcm93ZHNhbGUuYnV5VG9rZW5zIGJlY2F1c2U6CiAgICAgICAgICogLSBUaGUgV2VpLT5GRkMgcmF0ZSBkZXBlbmRzIG9uIGhvdyBtYW55IHRva2VucyBoYXZlIGFscmVhZHkgYmVlbiBzb2xkIChzZWUgYGN1cnJlbnRCb251c1JhdGUoKWApLgogICAgICAgICAqIC0gQWxzbyBtaW50IHRva2VucyBzZW50IHRvIFpha2VtRmFucyBhbmQgdGhlIEZvdW5kZXJzIGF0IHRoZSBzYW1lIHRpbWUuCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgICAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDApOwoKICAgICAgICAgICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgICAgICAgICAgICAgdWludDI1NiBwdXJjaGFzZWRUb2tlbnMgPSB3ZWlBbW91bnQuZGl2KHJhdGUpOwogICAgICAgICAgICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKHB1cmNoYXNlZFRva2VucykpOwogICAgICAgICAgICAgICAgcHVyY2hhc2VkVG9rZW5zID0gcHVyY2hhc2VkVG9rZW5zLm11bChjdXJyZW50Qm9udXNSYXRlKCkpLmRpdigxMDApOwogICAgICAgICAgICAgICAgcmVxdWlyZShwdXJjaGFzZWRUb2tlbnMgIT0gMCk7CgogICAgICAgICAgICAgICAgLy8gdXBkYXRlIHN0YXRlCiAgICAgICAgICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CiAgICAgICAgICAgICAgICBwdXJjaGFzZWRUb2tlbnNSYWlzZWQgPSBwdXJjaGFzZWRUb2tlbnNSYWlzZWQuYWRkKHB1cmNoYXNlZFRva2Vucyk7CgogICAgICAgICAgICAgICAgLy8gTWludCB0b2tlbnMgZm9yIGJlbmVmaWNpYXJ5CiAgICAgICAgICAgICAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCBwdXJjaGFzZWRUb2tlbnMpOwogICAgICAgICAgICAgICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCBwdXJjaGFzZWRUb2tlbnMpOwoKICAgICAgICAgICAgICAgIG1pbnRUb2tlbnNGb3JGYWNpbGl0YXRvcnMocHVyY2hhc2VkVG9rZW5zKTsKCiAgICAgICAgICAgICAgICBmb3J3YXJkRnVuZHMoKTsKICAgICAgICB9CgogICAgICAgIC8qIE92ZXJyaWRlcyBSZWZ1bmRhYmxlQ3Jvd2RzYWxlI2dvYWxSZWFjaGVkCiAgICAgICAgICAgc2luY2Ugd2UgY291bnQgdGhlIGdvYWwgaW4gcHVyY2hhc2VkIHRva2VucywgaW5zdGVhZCBvZiBpbiBXZWkuCiAgICAgICAgICAgQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBoYXMgcmVhY2hlZCBtb3JlIGZ1bmRzIHRoYW4gdGhlIG1pbmltdW0gZ29hbC4KICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwdXJjaGFzZWRUb2tlbnNSYWlzZWQgPj0gZ29hbDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAgIE92ZXJyaWRlcyBDYXBwZWRDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYyBpbiB0b2tlbnMKICAgICAgICAgICBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICAgICAgYm9vbCBjYXBSZWFjaGVkID0gcHVyY2hhc2VkVG9rZW5zUmFpc2VkID49IGNhcDsKICAgICAgICAgICAgICAgIHJldHVybiBDcm93ZHNhbGUuaGFzRW5kZWQoKSB8fCBjYXBSZWFjaGVkOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICAgcmVwbGFjZXMgQ2FwcGVkQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIGV4dHJhIGNhcCBsb2dpYyBpbiB0b2tlbnMKICAgICAgICAgICBAcGFyYW0gcHVyY2hhc2VkVG9rZW5zIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3ZXJlIHB1cmNoYXNlZCAoaW4gdGhlIHNtYWxsZXN0LCAxICogMTBeKC0xOCkgZGVub21pbmF0aW9uKQogICAgICAgICAgIEByZXR1cm4gdHJ1ZSBpZiBpbnZlc3RvcnMgYXJlIGFsbG93ZWQgdG8gcHVyY2hhc2UgdG9rZW5zIGF0IHRoZSBtb21lbnQuCiAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKHVpbnQyNTYgcHVyY2hhc2VkVG9rZW5zKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgICAgICAvKiBib29sIHdpdGhpbkNhcCA9IHB1cmNoYXNlZFRva2Vuc1JhaXNlZC5hZGQocHVyY2hhc2VkVG9rZW5zKSA8PSBjYXA7ICovCiAgICAgICAgICAgICAgICAvKiByZXR1cm4gQ3Jvd2RzYWxlLnZhbGlkUHVyY2hhc2UoKSAmJiB3aXRoaW5DYXA7ICovCiAgICAgICAgICAgICAgICBib29sIHdpdGhpbkNhcCA9IHB1cmNoYXNlZFRva2Vuc1JhaXNlZC5hZGQocHVyY2hhc2VkVG9rZW5zKSA8PSBjYXA7CiAgICAgICAgICAgICAgICByZXR1cm4gQ3Jvd2RzYWxlLnZhbGlkUHVyY2hhc2UoKSAmJiB3aXRoaW5DYXA7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgICBAZGV2IE1pbnRzIHRoZSB0b2tlbnMgZm9yIHRoZSBmYWNpbGl0YXRpbmcgcGFydGllcy4KCiAgICAgICAgICAgQGRldiBJbiB0b3RhbCwgKDIwLzEzKSAqIGBwdXJjaGFzZWRUb2tlbnNgIHRva2VucyBhcmUgY3JlYXRlZC4KICAgICAgICAgICBAZGV2IDEzLzEzdGggb2YgdGhlc2UgYXJlIGZvciB0aGUgQmVuZWZpY2lhcnkuCiAgICAgICAgICAgQGRldiA3LzEzdGggb2YgdGhlc2UgYXJlIG1pbnRlZCBmb3IgdGhlIEZhY2lsaXRhdG9ycyBhcyBmb2xsb3dzOgogICAgICAgICAgIEBkZXYgICAxLzEzdGggLT4gRm91bmRlcnMKICAgICAgICAgICBAZGV2ICAgMi8xM3RoIC0+IEJvdW50aWVzCiAgICAgICAgICAgQGRldiAgIDQvMTN0aCAtPiBaYWtlbUZhbnMKCiAgICAgICAgICAgQGRldiBOb3RlIHRoYXQgYWxsIHJlc3VsdCByYXRpb25hbCBhbW91bnRzIGFyZSBmbG9vcmVkIHNpbmNlIHRoZSBFVk0gb25seSB3b3JrcyB3aXRoIGludGVnZXIgYXJpdGhtZXRpYy4KICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIG1pbnRUb2tlbnNGb3JGYWNpbGl0YXRvcnModWludDI1NiBwdXJjaGFzZWRUb2tlbnMpIGludGVybmFsIHsKICAgICAgICAgICAgICAgIC8vIE1pbnQgdG9rZW5zIGZvciBaYWtlbUZhbnMgYW5kIEZvdW5kZXJzCiAgICAgICAgICAgICAgICB1aW50MjU2IGZpbnRlY2hmYW5zX3Rva2VucyA9IHB1cmNoYXNlZFRva2Vucy5tdWwoNCkuZGl2KDEzKTsKICAgICAgICAgICAgICAgIHVpbnQyNTYgYm91bnRpZXNfdG9rZW5zID0gcHVyY2hhc2VkVG9rZW5zLm11bCgyKS5kaXYoMTMpOwogICAgICAgICAgICAgICAgdWludDI1NiBmb3VuZGVyc190b2tlbnMgPSBwdXJjaGFzZWRUb2tlbnMubXVsKDEpLmRpdigxMyk7CiAgICAgICAgICAgICAgICB0b2tlbi5taW50KHdhbGxldCwgZmludGVjaGZhbnNfdG9rZW5zKTsKICAgICAgICAgICAgICAgIHRva2VuLm1pbnQoYm91bnRpZXNXYWxsZXQsIGJvdW50aWVzX3Rva2Vucyk7CiAgICAgICAgICAgICAgICB0b2tlbi5taW50KGZvdW5kZXJzV2FsbGV0LCBmb3VuZGVyc190b2tlbnMpOy8qIFRPRE8gTG9ja2VkIHZhdWx0PyAqLwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICAgQGRldiByZXR1cm5zIHRoZSBjdXJyZW50IGJvbnVzIHJhdGUuIFRoaXMgaXMgYSBjYWxsIHRoYXQgY2FuIGJlIGRvbmUgYXQgYW55IHRpbWUuCgogICAgICAgICAgIEByZXR1cm4gYSBmaXhlZC1zaXplIG51bWJlciB0aGF0IGlzIHRoZSB0b3RhbCBwZXJjZW50YWdlIG9mIHRva2VucyB0aGF0IHdpbGwgYmUgY3JlYXRlZC4gKDEwMCAqIHRoZSBib251cyByYXRpbykKCiAgICAgICAgICAgQGRldiBXaGVuIDwgMiBtaWxsaW9uIHRva2VucyBwdXJjaGFzZWQsIHRoaXMgd2lsbCBiZSAxMjUlLCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIGEgMjAlIGRpc2NvdW50CiAgICAgICAgICAgQGRldiBXaGVuIDwgNCBtaWxsaW9uIHRva2VucyBwdXJjaGFzZWQsIDExOCUsIHdoaWNoIGlzIGVxdWl2YWxlbnQgdG8gYSAxNSUgZGlzY291bnQuCiAgICAgICAgICAgQGRldiBXaGVuIDwgNiBtaWxsaW9uIHRva2VucyBwdXJjaGFzZWQsIDExMSUsIHdoaWNoIGlzIGVxdWl2YWxlbnQgdG8gYSAxMCUgZGlzY291bnQuCiAgICAgICAgICAgQGRldiBXaGVuIDwgOSBtaWxsaW9uIHRva2VucyBwdXJjaGFzZWQsIDEwNSUsIHdoaWNoIGlzIGVxdWl2YWxlbnQgdG8gYSA1JSBkaXNjb3VudC4KICAgICAgICAgICBAZGV2IE90aGVyd2lzZSwgdGhlcmUgaXMgbm8gYm9udXMgYW5kIHRoZSBmdW5jdGlvbiByZXR1cm5zIDEwMCUuCiAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBjdXJyZW50Qm9udXNSYXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgICAgICAgIGlmKHB1cmNoYXNlZFRva2Vuc1JhaXNlZCA8ICgyICogb25lVHdlbGZ0aE9mQ2FwKSkgcmV0dXJuIDEyNS8qLjI1Ki87IC8vIDIwJSBkaXNjb3VudAogICAgICAgICAgICAgICAgaWYocHVyY2hhc2VkVG9rZW5zUmFpc2VkIDwgKDQgKiBvbmVUd2VsZnRoT2ZDYXApKSByZXR1cm4gMTE4LyouMTc2NDcwNTg4MjM1Mjk0MiovOyAvLyAxNSUgZGlzY291bnQKICAgICAgICAgICAgICAgIGlmKHB1cmNoYXNlZFRva2Vuc1JhaXNlZCA8ICg2ICogb25lVHdlbGZ0aE9mQ2FwKSkgcmV0dXJuIDExMS8qLjExMTExMTExMTExMTExMTIqLzsgLy8gMTAlIGRpc2NvdW50CiAgICAgICAgICAgICAgICBpZihwdXJjaGFzZWRUb2tlbnNSYWlzZWQgPCAoOSAqIG9uZVR3ZWxmdGhPZkNhcCkpIHJldHVybiAxMDUvKi4wNTI2MzE1Nzg5NDczNjg0Ki87IC8vIDUlIGRpc2NvdW50CiAgICAgICAgICAgICAgICByZXR1cm4gMTAwOwogICAgICAgIH0KfQoKY29udHJhY3QgVGhlWmFrZW1GYW5zQ3Jvd2RzYWxlIGlzIFpha2VtRmFuc0Nyb3dkc2FsZSB7CiAgICBmdW5jdGlvbiBUaGVaYWtlbUZhbnNDcm93ZHNhbGUoKQogICAgICAgIFpha2VtRmFuc0Nyb3dkc2FsZSgKICAgICAgICAgICAgMTUxMTQzMzAwMCwgLy8gX3N0YXJ0VGltZSB0aW1lIChTb2xpZGl0eSBVTklYIHRpbWVzdGFtcCkgZnJvbSB3aGVuIGl0IGlzIGFsbG93ZWQgdG8gYnV5IEZJTkMuCiAgICAgICAgICAgIDE1MTE0NDU2MDAsIC8vIF9lbmRUaW1lIHRpbWUgKFNvbGlkaXR5IFVOSVggdGltZXN0YW1wKSB1bnRpbCB3aGljaCBpdCBpcyBhbGxvd2VkIHRvIGJ1eSBGSU5DLiAoU2hvdWxkIGJlIGxhcmdlciB0aGFuIHN0YXJ0VGltZSkKICAgICAgICAgICAgMzg5MCwgLy8gX3JhdGUgTnVtYmVyIG9mIHRva2VucyBjcmVhdGVkIHBlciBldGhlci4gKFNpbmNlIEV0aGVyIGFuZCBaYWtlbUNvaW4gdXNlIHRoZSBzYW1lIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcywgdGhpcyBjYW4gYmUgcmVhZCBhcyBkaXJlY3QgY29udmVyc2lvbiByYXRlIG9mIEV0aGVyIC0+IFpha2VtQ29pbi4pCiAgICAgICAgICAgIDB4OTlBNTQ1MEM5MDE5Q2RlMzZiNGFhRmY5YjIzMkQwYmMxNjI1M0M5NSwgLy8gX3dhbGxldCBUaGUgd2FsbGV0IG9mIFpha2VtRmFucyBpdHNlbGYsIHRvIHdoaWNoIHNvbWUgb2YgdGhlIGZhY2lsaXRhdGluZyB0b2tlbnMgd2lsbCBiZSBzZW50LgogICAgICAgICAgICAweDg4OTIxZjUxNDY5OTkwNkFENDdEMTFGOWM1ZkRiYjhCMDA1Njk0ODQsIC8vIF9ib3VudGllc1dhbGxldCBUaGUgd2FsbGV0IHVzZWQgdG8gcGF5IG91dCBib3VudGllcywgdG8gd2hpY2ggc29tZSBvZiB0aGUgZmFjaWxpdGF0aW5nIHRva2VucyB3aWxsIGJlIHNlbnQuCiAgICAgICAgICAgIDB4MEM2NjlFMzI1Q2VCNThEOGE0MzZkYzM0NjZENERGYUM5ZDVFYjJGMCwgLy8gX2ZvdW5kZXJzV2FsbGV0IFRoZSB3YWxsZXQgdXNlZCBmb3IgdGhlIGZvdW5kZXJzLCB0byB3aGljaCBzb21lIG9mIHRoZSBmYWNpbGl0YXRpbmcgdG9rZW5zIHdpbGwgYmUgc2VudC4KICAgICAgICAgICAgMzk4MDAwMDAwMDAwMDAwMDAsIC8vIF9nb2FsIFRoZSBtaW5pbXVtIGdvYWwgKGluIDEgKiAxMF4oLTE4KSB0b2tlbnMpIHRoYXQgdGhlIENyb3dkc2FsZSBuZWVkcyB0byByZWFjaC4KICAgICAgICAgICAgMzk4MDAwMDAwMDAwMDAwMDAwLCAvLyBfY2FwIFRoZSBtYXhpbXVtIGNhcCAoaW4gMSAqIDEwXigtMTgpIHRva2VucykgdGhhdCB0aGUgQ3Jvd2RzYWxlIGNhbiByZWFjaC4KICAgICAgICAgICAgMHgxNDVlYTU5NzgyYzA0Njg1MTA0NTlmOTIxOWU4NjM1NTViMTg2OGE1LCAvLyBfdG9rZW4gVGhlIGFkZHJlc3Mgd2hlcmUgdGhlIFpha2VtQ29pbiBjb250cmFjdCB3YXMgZGVwbG95ZWQgcHJpb3IgdG8gY3JlYXRpbmcgdGhpcyBjb250cmFjdC4KICAgICAgICAgICAgMCAgLy8gX3B1cmNoYXNlZFRva2Vuc1JhaXNlZER1cmluZ1ByZXNhbGUgVGhlIGFtb3VudCAoaW4gMSAqIDE4XjE4IHRva2VucykgdGhhdCB3YXMgcHVyY2hhc2VkIGR1cmluZyB0aGUgcHJlc2FsZS4KICAgICAgICAgICAgKQogICAgewogICAgfQp9'.
	

]
