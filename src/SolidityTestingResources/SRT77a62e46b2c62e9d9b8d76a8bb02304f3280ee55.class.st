Class {
	#name : #SRT77a62e46b2c62e9d9b8d76a8bb02304f3280ee55,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT77a62e46b2c62e9d9b8d76a8bb02304f3280ee55 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogICAgLyoqCiAgICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICAgKi8KICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICAgKi8KICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgICAqLwogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICAgKi8KICAgIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgICogYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgICBldmVudCBQYXVzZSgpOwogICAgZXZlbnQgVW5wYXVzZSgpOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgICovCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVucGF1c2UoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgICAgIHdoZW5QYXVzZWQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBOb24tRnVuZ2libGUgVG9rZW5zCi8vLyBAYXV0aG9yIERpZXRlciBTaGlybGV5IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZTY4MjgzOTI4M2E2ODc5ZThmODk4YjljODM4OGM4ODU4OSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKY29udHJhY3QgRVJDNzIxIHsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX2FwcHJvdmVkLCB1aW50MjU2IF90b2tlbklkKTsKCiAgICAvLyBSZXF1aXJlZCBtZXRob2RzIGZvciBFUkMtNzIxIENvbXBhdGliaWxpdHkuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwoKICAgIC8vIEVSQy0xNjUgQ29tcGF0aWJpbGl0eSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfYmFsYW5jZSk7Cn0KCgpjb250cmFjdCBNYXN0ZXJwaWVjZUFjY2Vzc0NvbnRyb2wgewogICAgLy8vIC0gQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcywgY2hhbmdlIHRoZSBhZGRyZXNzZXMgb2YgZGVwZW5kZW50IHNtYXJ0IGNvbnRyYWN0cywKICAgIC8vLyBhbmQgcGF1c2UvdW5wYXVzZSB0aGUgTWFzdGVycGllY2VDb3JlIGNvbnRyYWN0LgogICAgLy8vIC0gQ0ZPOiBUaGUgQ0ZPIGNhbiB3aXRoZHJhdyBmdW5kcyBmcm9tIGl0cyBhdWN0aW9uIGFuZCBzYWxlIGNvbnRyYWN0cy4KICAgIC8vLyAtIEN1cmF0b3I6IFRoZSBDdXJhdG9yIGNhbiBtaW50IHJlZ3VsYXIgYW5kIHByb21vIE1hc3RlcnBpZWNlcy4KCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZS4KICAgIGFkZHJlc3MgcHVibGljIGNlb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjZm9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY3VyYXRvckFkZHJlc3M7CgogICAgLy8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkLgogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogICAgLy8vIEBkZXYgRXZlbnQgaXMgZmlyZWQgd2hlbiBjb250cmFjdCBpcyBmb3JrZWQuCiAgICBldmVudCBDb250cmFjdEZvcmsoYWRkcmVzcyBuZXdDb250cmFjdCk7CgogICAgLy8vIEBkZXYgQWNjZXNzLW1vZGlmaWVyIGZvciBDRU8tb25seSBmdW5jdGlvbmFsaXR5LgogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MtbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkuCiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2Vzcy1tb2RpZmllciBmb3IgQ3VyYXRvci1vbmx5IGZ1bmN0aW9uYWxpdHkuCiAgICBtb2RpZmllciBvbmx5Q3VyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3VyYXRvckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzLW1vZGlmaWVyIGZvciBDLWxldmVsLW9ubHkgZnVuY3Rpb25hbGl0eS4KICAgIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGN1cmF0b3JBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gdGhlIENFTyByb2xlLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENGTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0ZPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0ZPCiAgICBmdW5jdGlvbiBzZXRDRk8oYWRkcmVzcyBfbmV3Q0ZPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRk8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogICAgfQoKICAgIC8vLyBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gdGhlIEN1cmF0b3Igcm9sZS4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q3VyYXRvciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IEN1cmF0b3IKICAgIGZ1bmN0aW9uIHNldEN1cmF0b3IoYWRkcmVzcyBfbmV3Q3VyYXRvcikgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShfbmV3Q3VyYXRvciAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY3VyYXRvckFkZHJlc3MgPSBfbmV3Q3VyYXRvcjsKICAgIH0KCiAgICAvKioqIFBhdXNhYmxlIGZ1bmN0aW9uYWxpdHkgYWRhcHRlZCBmcm9tIE9wZW5aZXBwZWxpbiAqKiovCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSAiQy1sZXZlbCIgcm9sZSB0byBwYXVzZSB0aGUgY29udHJhY3QuIFVzZWQgb25seSB3aGVuCiAgICAvLy8gIGEgYnVnIG9yIGV4cGxvaXQgaXMgZGV0ZWN0ZWQgYW5kIHdlIG5lZWQgdG8gbGltaXQgZGFtYWdlLgogICAgZnVuY3Rpb24gcGF1c2UoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUNMZXZlbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFVucGF1c2VzIHRoZSBzbWFydCBjb250cmFjdC4gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBDRU8sIHNpbmNlCiAgICAvLy8gIG9uZSByZWFzb24gd2UgbWF5IHBhdXNlIHRoZSBjb250cmFjdCBpcyB3aGVuIENGTyBvciBDT08gYWNjb3VudHMgYXJlCiAgICAvLy8gIGNvbXByb21pc2VkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gaXQgY2FuIGJlIGNhbGxlZCBieQogICAgLy8vICBkZXJpdmVkIGNvbnRyYWN0cy4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlDRU8KICAgICAgICB3aGVuUGF1c2VkCiAgICB7CiAgICAgICAgLy8gY2FuJ3QgdW5wYXVzZSBpZiBjb250cmFjdCB3YXMgZm9ya2VkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cgp9CgoKLy8vIENvcmUgZnVuY3Rpb25hbGl0eSBmb3IgQ3J5dHBvTWFzdGVycGllY2VzLgpjb250cmFjdCBNYXN0ZXJwaWVjZUJhc2UgaXMgTWFzdGVycGllY2VBY2Nlc3NDb250cm9sIHsKCiAgICAvKioqIERBVEEgVFlQRVMgKioqLwogICAgLy8vIFRoZSBtYWluIG1hc3RlcnBpZWNlIHN0cnVjdC4KICAgIHN0cnVjdCBNYXN0ZXJwaWVjZSB7CiAgICAgICAgLy8vIE5hbWUgb2YgdGhlIG1hc3RlcnBpZWNlCiAgICAgICAgc3RyaW5nIG5hbWU7CiAgICAgICAgLy8vIE5hbWUgb2YgdGhlIGFydGlzdCB3aG8gY3JlYXRlZCB0aGUgbWFzdGVycGllY2UKICAgICAgICBzdHJpbmcgYXJ0aXN0OwogICAgICAgIC8vIFRoZSB0aW1lc3RhbXAgZnJvbSB0aGUgYmxvY2sgd2hlbiB0aGlzIG1hc3RlcnBpZWNlIHdhcyBjcmVhdGVkCiAgICAgICAgdWludDY0IGJpcnRoVGltZTsKICAgIH0KCiAgICAvKioqIEVWRU5UUyAqKiovCiAgICAvLy8gVGhlIEJpcnRoIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgbmV3IG1hc3RlcnBpZWNlIGNvbWVzIGludG8gZXhpc3RlbmNlLgogICAgZXZlbnQgQmlydGgoYWRkcmVzcyBvd25lciwgdWludDI1NiB0b2tlbklkLCB1aW50MjU2IHNuYXRjaFdpbmRvdywgc3RyaW5nIG5hbWUsIHN0cmluZyBhcnRpc3QpOwogICAgLy8vIFRyYW5zZmVyIGV2ZW50IGFzIGRlZmluZWQgaW4gY3VycmVudCBkcmFmdCBvZiBFUkM3MjEuIEZpcmVkIGV2ZXJ5IHRpbWUgbWFzdGVycGllY2Ugb3duZXJzaGlwCiAgICAvLy8gaXMgYXNzaWduZWQsIGluY2x1ZGluZyBiaXJ0aHMuCiAgICBldmVudCBUcmFuc2ZlclRva2VuKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKICAgIC8vLyBUaGUgVG9rZW5Tb2xkIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgdG9rZW4gaXMgc29sZC4KICAgIGV2ZW50IFRva2VuU29sZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgb2xkUHJpY2UsIHVpbnQyNTYgcHJpY2UsIGFkZHJlc3MgcHJldk93bmVyLCBhZGRyZXNzIG93bmVyLCBzdHJpbmcgbmFtZSk7CgogICAgLyoqKiBTVE9SQUdFICoqKi8KICAgIC8vLyBBbiBhcnJheSBjb250YWluaW5nIGFsbCBNYXN0ZXJwaWVjZXMgaW4gZXhpc3RlbmNlLiBUaGUgaWQgb2YgZWFjaCBtYXN0ZXJwaWVjZQogICAgLy8vIGlzIGFuIGluZGV4IGluIHRoaXMgYXJyYXkuCiAgICBNYXN0ZXJwaWVjZVtdIG1hc3RlcnBpZWNlczsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgQ2xvY2tBdWN0aW9uIGNvbnRyYWN0IHRoYXQgaGFuZGxlcyBzYWxlIGF1Y3Rpb25zCiAgICAvLy8gZm9yIE1hc3RlcnBpZWNlcyB0aGF0IHVzZXJzIHdhbnQgdG8gc2VsbCBmb3IgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZQogICAgLy8vIG5leHQgcHJpY2UsIHdoaWNoIGlzIGF1dG9tYXRpY2FsbHkgc2V0IGJ5IHRoZSBjb250cmFjdC4KICAgIFNhbGVDbG9ja0F1Y3Rpb24gcHVibGljIHNhbGVBdWN0aW9uOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIG1hc3RlcnBpZWNlIGlkcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIG1hc3RlcnBpZWNlVG9Pd25lcjsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBtYXN0ZXJwaWVjZSBpZHMgdG8gdGhlaXIgc25hdGNoIHdpbmRvdy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIG1hc3RlcnBpZWNlVG9TbmF0Y2hXaW5kb3c7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiBtYXN0ZXJwaWVjZXMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLy8gVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG93bmVyTWFzdGVycGllY2VDb3VudDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBtYXN0ZXJwaWVjZSBpZHMgdG8gYW4gYWRkcmVzcyB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIHRvIGNhbGwKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIEVhY2ggbWFzdGVycGllY2UgY2FuIG9ubHkgaGF2ZSAxIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRyYW5zZmVyCiAgICAvLy8gIGF0IGFueSB0aW1lLiBBIDAgdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBtYXN0ZXJwaWVjZVRvQXBwcm92ZWQ7CgogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBtYXN0ZXJwaWVjZSBpZHMgdG8gdGhlaXIgcHJpY2UuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBtYXN0ZXJwaWVjZVRvUHJpY2U7CgogICAgLy8gQGRldiBSZXR1cm5zIHRoZSBzbmF0Y2ggd2luZG93IG9mIHRoZSBnaXZlbiB0b2tlbi4KICAgIGZ1bmN0aW9uIHNuYXRjaFdpbmRvd09mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgcHJpY2UpCiAgICB7CiAgICAgICAgcmV0dXJuIG1hc3RlcnBpZWNlVG9TbmF0Y2hXaW5kb3dbX3Rva2VuSWRdOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgbWFzdGVycGllY2UgdG8gYW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcCBhbmQgdXBkYXRlIG93bmVyIG1hc3RlcnBpZWNlIGNvdW50cy4KICAgICAgICBvd25lck1hc3RlcnBpZWNlQ291bnRbX3RvXSsrOwogICAgICAgIG1hc3RlcnBpZWNlVG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgLy8gV2hlbiBjcmVhdGluZyBuZXcgdG9rZW5zIF9mcm9tIGlzIDB4MCwgYnV0IHdlIGNhbid0IGFjY291bnQgdGhhdCBhZGRyZXNzLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyTWFzdGVycGllY2VDb3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgLy8gY2xlYXIgYW55IHByZXZpb3VzbHkgYXBwcm92ZWQgb3duZXJzaGlwIGV4Y2hhbmdlCiAgICAgICAgICAgIGRlbGV0ZSBtYXN0ZXJwaWVjZVRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KICAgICAgICAvLyBGaXJlIHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlclRva2VuKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbiBpbnRlcm5hbCBtZXRob2QgdGhhdCBjcmVhdGVzIGEgbmV3IG1hc3RlcnBpZWNlIGFuZCBzdG9yZXMgaXQuCiAgICAvLy8gQHBhcmFtIF9uYW1lIFRoZSBuYW1lIG9mIHRoZSBtYXN0ZXJwaWVjZSwgZS5nLiBNb25hIExpc2EKICAgIC8vLyBAcGFyYW0gX2FydGlzdCBUaGUgYXJ0aXN0IHdobyBjcmVhdGVkIHRoaXMgbWFzdGVycGllY2UsIGUuZy4gTGVvbmFyZG8gRGEgVmluY2kKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBpbml0aWFsIG93bmVyIG9mIHRoaXMgbWFzdGVycGllY2UKICAgIGZ1bmN0aW9uIF9jcmVhdGVNYXN0ZXJwaWVjZSgKICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgc3RyaW5nIF9hcnRpc3QsCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDI1NiBfc25hdGNoV2luZG93LAogICAgICAgIGFkZHJlc3MgX293bmVyCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIE1hc3RlcnBpZWNlIG1lbW9yeSBfbWFzdGVycGllY2UgPSBNYXN0ZXJwaWVjZSh7CiAgICAgICAgICAgIG5hbWU6IF9uYW1lLAogICAgICAgICAgICBhcnRpc3Q6IF9hcnRpc3QsCiAgICAgICAgICAgIGJpcnRoVGltZTogdWludDY0KG5vdykKICAgICAgICB9KTsKICAgICAgICB1aW50MjU2IG5ld01hc3RlcnBpZWNlSWQgPSBtYXN0ZXJwaWVjZXMucHVzaChfbWFzdGVycGllY2UpIC0gMTsKCiAgICAgICAgLy8gRmlyZSB0aGUgYmlydGggZXZlbnQuCiAgICAgICAgQmlydGgoCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgbmV3TWFzdGVycGllY2VJZCwKICAgICAgICAgICAgX3NuYXRjaFdpbmRvdywKICAgICAgICAgICAgX21hc3RlcnBpZWNlLm5hbWUsCiAgICAgICAgICAgIF9tYXN0ZXJwaWVjZS5hcnRpc3QKICAgICAgICApOwoKICAgICAgICAvLyBTZXQgdGhlIHByaWNlIGZvciB0aGUgbWFzdGVycGllY2UuCiAgICAgICAgbWFzdGVycGllY2VUb1ByaWNlW25ld01hc3RlcnBpZWNlSWRdID0gX3ByaWNlOwoKICAgICAgICAvLyBTZXQgdGhlIHNuYXRjaCB3aW5kb3cgZm9yIHRoZSBtYXN0ZXJwaWVjZS4KICAgICAgICBtYXN0ZXJwaWVjZVRvU25hdGNoV2luZG93W25ld01hc3RlcnBpZWNlSWRdID0gX3NuYXRjaFdpbmRvdzsKCiAgICAgICAgLy8gVGhpcyB3aWxsIGFzc2lnbiBvd25lcnNoaXAsIGFuZCBhbHNvIGZpcmUgdGhlIFRyYW5zZmVyIGV2ZW50IGFzIHBlciBFUkMtNzIxIGRyYWZ0LgogICAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld01hc3RlcnBpZWNlSWQpOwoKICAgICAgICByZXR1cm4gbmV3TWFzdGVycGllY2VJZDsKICAgIH0KCn0KCgovLy8gUHJpY2luZyBsb2dpYyBmb3IgQ3J5dHBvTWFzdGVycGllY2VzLgpjb250cmFjdCBNYXN0ZXJwaWVjZVByaWNpbmcgaXMgTWFzdGVycGllY2VCYXNlIHsKCiAgICAvKioqIENPTlNUQU5UUyAqKiovCiAgICAvLyBQcmljaW5nIHN0ZXBzLgogICAgdWludDEyOCBwcml2YXRlIGNvbnN0YW50IEZJUlNUX1NURVBfTElNSVQgPSAwLjA1IGV0aGVyOwogICAgdWludDEyOCBwcml2YXRlIGNvbnN0YW50IFNFQ09ORF9TVEVQX0xJTUlUID0gMC41IGV0aGVyOwogICAgdWludDEyOCBwcml2YXRlIGNvbnN0YW50IFRISVJEX1NURVBfTElNSVQgPSAyLjAgZXRoZXI7CiAgICB1aW50MTI4IHByaXZhdGUgY29uc3RhbnQgRk9VUlRIX1NURVBfTElNSVQgPSA1LjAgZXRoZXI7CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIG5leHQgbGlzdGVkIHByaWNlLgogICAgLy8vIEBub3RpY2UgVGhpcyBjb250cmFjdCBkb2Vzbid0IGhhbmRsZSBzZXR0aW5nIHRoZSBNYXN0ZXJwaWVjZSdzIG5leHQgbGlzdGluZyBwcmljZS4KICAgIC8vLyBUaGlzIG5leHQgcHJpY2UgaXMgb25seSB1c2VkIGZyb20gaW5zaWRlIGJpZCgpIGluIE1hc3RlcnBpZWNlQXVjdGlvbiBhbmQgaW5zaWRlCiAgICAvLy8gcHVyY2hhc2UoKSBpbiBNYXN0ZXJwaWVjZVNhbGUgdG8gc2V0IHRoZSBuZXh0IGxpc3RlZCBwcmljZS4KICAgIGZ1bmN0aW9uIHNldE5leHRQcmljZU9mKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBzYWxlUHJpY2UpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gVGhlIG5leHQgcHJpY2Ugb2YgYW55IHRva2VuIGNhbiBvbmx5IGJlIHNldCBieSB0aGUgc2FsZSBhdWN0aW9uIGNvbnRyYWN0LgogICAgICAgIC8vIFRvIHNldCB0aGUgbmV4dCBwcmljZSBmb3IgYSB0b2tlbiBzb2xkIHRocm91Z2ggdGhlIHJlZ3VsYXIgc2FsZSwgdXNlIG9ubHkKICAgICAgICAvLyBjb21wdXRlTmV4dFByaWNlIGFuZCBkaXJlY3RseSB1cGRhdGUgdGhlIG1hcHBpbmcuCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Moc2FsZUF1Y3Rpb24pKTsKICAgICAgICBtYXN0ZXJwaWVjZVRvUHJpY2VbdG9rZW5JZF0gPSBjb21wdXRlTmV4dFByaWNlKHNhbGVQcmljZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgbmV4dCBwcmljZSBvZiB0b2tlbiBnaXZlbiB0aGUgY3VycmVudCBzYWxlIHByaWNlLgogICAgZnVuY3Rpb24gY29tcHV0ZU5leHRQcmljZSh1aW50MjU2IHNhbGVQcmljZSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIGlmIChzYWxlUHJpY2UgPCBGSVJTVF9TVEVQX0xJTUlUKSB7CiAgICAgICAgICAgIHJldHVybiBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHNhbGVQcmljZSwgMjAwKSwgOTUpOwogICAgICAgIH0gZWxzZSBpZiAoc2FsZVByaWNlIDwgU0VDT05EX1NURVBfTElNSVQpIHsKICAgICAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2FsZVByaWNlLCAxMzUpLCA5Nik7CiAgICAgICAgfSBlbHNlIGlmIChzYWxlUHJpY2UgPCBUSElSRF9TVEVQX0xJTUlUKSB7CiAgICAgICAgICAgIHJldHVybiBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHNhbGVQcmljZSwgMTI1KSwgOTcpOwogICAgICAgIH0gZWxzZSBpZiAoc2FsZVByaWNlIDwgRk9VUlRIX1NURVBfTElNSVQpIHsKICAgICAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2FsZVByaWNlLCAxMjApLCA5Nyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2FsZVByaWNlLCAxMTUpLCA5OCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBwYXltZW50IGZvciB0aGUgdG9rZW4sIHdoaWNoIGlzIHRoZSBzYWxlIHByaWNlIG9mIHRoZSB0b2tlbgogICAgLy8vIG1pbnVzIHRoZSBob3VzZSdzIGN1dC4KICAgIGZ1bmN0aW9uIGNvbXB1dGVQYXltZW50KHVpbnQyNTYgc2FsZVByaWNlKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKHNhbGVQcmljZSA8IEZJUlNUX1NURVBfTElNSVQpIHsKICAgICAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2FsZVByaWNlLCA5NSksIDEwMCk7CiAgICAgICAgfSBlbHNlIGlmIChzYWxlUHJpY2UgPCBTRUNPTkRfU1RFUF9MSU1JVCkgewogICAgICAgICAgICByZXR1cm4gU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChzYWxlUHJpY2UsIDk2KSwgMTAwKTsKICAgICAgICB9IGVsc2UgaWYgKHNhbGVQcmljZSA8IEZPVVJUSF9TVEVQX0xJTUlUKSB7CiAgICAgICAgICAgIHJldHVybiBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHNhbGVQcmljZSwgOTcpLCAxMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHNhbGVQcmljZSwgOTgpLCAxMDApOwogICAgICAgIH0KICAgIH0KCn0KCgovLy8gTWV0aG9kcyByZXF1aXJlZCBmb3IgTm9uLUZ1bmdpYmxlIFRva2VuIFRyYW5zYWN0aW9ucyBpbiBhZGhlcmVuY2UgdG8gRVJDNzIxLgpjb250cmFjdCBNYXN0ZXJwaWVjZU93bmVyc2hpcCBpcyBNYXN0ZXJwaWVjZVByaWNpbmcsIEVSQzcyMSB7CgogICAgLy8vIE5hbWUgb2YgdGhlIGNvbGxlY3Rpb24gb2YgTkZUcyBtYW5hZ2VkIGJ5IHRoaXMgY29udHJhY3QsIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBOQU1FID0gIk1hc3RlcnBpZWNlcyI7CiAgICAvLy8gU3ltYm9sIHJlZmVyZW5jaW5nIHRoZSBlbnRpcmUgY29sbGVjdGlvbiBvZiBORlRzIG1hbmFnZWQgaW4gdGhpcyBjb250cmFjdCwgYXMKICAgIC8vLyBkZWZpbmVkIGluIEVSQzcyMS4KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgU1lNQk9MID0gIkNNUCI7CgogICAgYnl0ZXM0IHB1YmxpYyBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSA9CiAgICBieXRlczQoa2VjY2FrMjU2KCJzdXBwb3J0c0ludGVyZmFjZShieXRlczQpIikpOwoKICAgIGJ5dGVzNCBwdWJsaWMgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEgPQogICAgYnl0ZXM0KGtlY2NhazI1NigibmFtZSgpIikpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoInN5bWJvbCgpIikpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoInRvdGFsU3VwcGx5KCkiKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigiYmFsYW5jZU9mKGFkZHJlc3MpIikpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoIm93bmVyT2YodWludDI1NikiKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigiYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpIikpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoInRyYW5zZmVyKGFkZHJlc3MsdWludDI1NikiKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigidHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KSIpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCJ0b2tlbnNPZk93bmVyKGFkZHJlc3MpIikpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoInRva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpIikpOwoKICAgIC8vLyBAZGV2IEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgYSBzcGVjaWZpYyBNYXN0ZXJwaWVjZSB2aWEKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogICAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIE1hc3RlcnBpZWNlIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIC8vLyBAbm90aWNlIFJlcXVpcmVkIGZvciBFUkMtMjAgYW5kIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gT25seSBhbiBvd25lciBjYW4gZ3JhbnQgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWdpc3RlciB0aGUgYXBwcm92YWwgKHJlcGxhY2luZyBhbnkgcHJldmlvdXMgYXBwcm92YWwpLgogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCBfdG8pOwoKICAgICAgICAvLyBGaXJlIGFwcHJvdmFsIGV2ZW50IHVwb24gc3VjY2Vzc2Z1bCBhcHByb3ZhbC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYSBNYXN0ZXJwaWVjZSB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0byBhIHNtYXJ0CiAgICAvLy8gIGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxIG9yIGVsc2UgeW91cgogICAgLy8vIE1hc3RlcnBpZWNlIG1heSBiZSBsb3N0IGZvcmV2ZXIuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIE1hc3RlcnBpZWNlIHRvIHRyYW5zZmVyLgogICAgLy8vIEBub3RpY2UgUmVxdWlyZWQgZm9yIEVSQy0yMCBhbmQgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IE1hc3RlcnBpZWNlcyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgTWFzdGVycGllY2UgaXMgY3JlYXRlZC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhlIGF1Y3Rpb24gY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBNYXN0ZXJwaWVjZXMKICAgICAgICAvLyB0aHJvdWdoIHRoZSBhcHByb3ZlIGFuZCB0cmFuc2ZlckZyb20gZmxvdy4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHNhbGVBdWN0aW9uKSk7CiAgICAgICAgLy8gWW91IGNhbiBvbmx5IHNlbmQgeW91ciBvd24gTWFzdGVycGllY2UuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAsIGNsZWFyIHBlbmRpbmcgYXBwcm92YWxzLCBmaXJlIFRyYW5zZmVyIGV2ZW50LgogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlciBhIE1hc3RlcnBpZWNlIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBNYXN0ZXJwaWVjZSB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIE1hc3RlcnBpZWNlLiBDYW4gYmUgYW55CiAgICAvLy8gYWRkcmVzcywgaW5jbHVkaW5nIHRoZSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgTWFzdGVycGllY2UgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQG5vdGljZSBSZXF1aXJlZCBmb3IgRVJDLTIwIGFuZCBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIENoZWNrIGZvciBhcHByb3ZhbCBhbmQgdmFsaWQgb3duZXJzaGlwCiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBmaXJlcyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgTWFzdGVycGllY2UgSURzIGFzc2lnbmVkIHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgd2hvc2UgTWFzdGVycGllY2VzIHdlIGFyZSBpbnRlcmVzdGVkIGluLgogICAgLy8vICBUaGlzIG1ldGhvZCBNVVNUIE5FVkVSIGJlIGNhbGxlZCBieSBzbWFydCBjb250cmFjdCBjb2RlLiBGaXJzdCwgaXQgaXMgZmFpcmx5CiAgICAvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBNYXN0ZXJwaWVjZSBhcnJheSBsb29raW5nIGZvciBNYXN0ZXJwaWVjZXMgYmVsb25naW5nCiAgICAvLy8gdG8gb3duZXIpLCBidXQgaXQgYWxzbyByZXR1cm5zIGEgZHluYW1pYyBhcnJheSwgd2hpY2ggaXMgb25seSBzdXBwb3J0ZWQgZm9yIHdlYjMKICAgIC8vLyBjYWxscywgYW5kIG5vdCBjb250cmFjdC10by1jb250cmFjdCBjYWxscy4gVGh1cywgdGhpcyBtZXRob2QgaXMgZXh0ZXJuYWwgcmF0aGVyCiAgICAvLy8gdGhhbiBwdWJsaWMuCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnModWludDI1NltdIG93bmVyVG9rZW5zKQogICAgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybnMgYW4gZW1wdHkgYXJyYXkKICAgICAgICAgICAgcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwogICAgICAgICAgICB1aW50MjU2IHRvdGFsTWFzdGVycGllY2VzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICB1aW50MjU2IG1hc3RlcnBpZWNlSWQ7CiAgICAgICAgICAgIGZvciAobWFzdGVycGllY2VJZCA9IDA7IG1hc3RlcnBpZWNlSWQgPD0gdG90YWxNYXN0ZXJwaWVjZXM7IG1hc3RlcnBpZWNlSWQrKykgewogICAgICAgICAgICAgICAgaWYgKG1hc3RlcnBpZWNlVG9Pd25lclttYXN0ZXJwaWVjZUlkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gbWFzdGVycGllY2VJZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBJbnRyb3NwZWN0aW9uIGludGVyZmFjZSBhcyBwZXIgRVJDLTE2NSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkuCiAgICAvLy8gIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuIFdlIGltcGxlbWVudAogICAgLy8vICBFUkMtMTY1IChvYnZpb3VzbHkhKSBhbmQgRVJDLTcyMS4KICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gKChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLyBAbm90aWNlIE9wdGlvbmFsIGZvciBFUkMtMjAgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG5hbWUoKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBOQU1FOwogICAgfQoKICAgIC8vIEBub3RpY2UgT3B0aW9uYWwgZm9yIEVSQy0yMCBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gU1lNQk9MOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIE1hc3RlcnBpZWNlLgogICAgLy8vIEBub3RpY2UgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzIG93bmVyKQogICAgewogICAgICAgIG93bmVyID0gbWFzdGVycGllY2VUb093bmVyW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBNYXN0ZXJwaWVjZXMgY3VycmVudGx5IGluIGV4aXN0ZW5jZS4KICAgIC8vLyBAbm90aWNlIFJlcXVpcmVkIGZvciBFUkMtMjAgYW5kIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBtYXN0ZXJwaWVjZXMubGVuZ3RoOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiBNYXN0ZXJwaWVjZXMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQG5vdGljZSBSZXF1aXJlZCBmb3IgRVJDLTIwIGFuZCBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgY291bnQpCiAgICB7CiAgICAgICAgcmV0dXJuIG93bmVyTWFzdGVycGllY2VDb3VudFtfb3duZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaXMgdGhlIGN1cnJlbnQgb3duZXIgb2YgYSBwYXJ0aWN1bGFyIE1hc3RlcnBpZWNlLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIHZhbGlkYXRpbmcgYWdhaW5zdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgTWFzdGVycGllY2UgaWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIG1hc3RlcnBpZWNlVG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmtzIGFuIGFkZHJlc3MgYXMgYmVpbmcgYXBwcm92ZWQgZm9yIHRyYW5zZmVyRnJvbSgpLCBvdmVyd3JpdGluZyBhbnkgcHJldmlvdXMKICAgIC8vLyBhcHByb3ZhbC4gU2V0dGluZyBfYXBwcm92ZWQgdG8gYWRkcmVzcygwKSBjbGVhcnMgYWxsIHRyYW5zZmVyIGFwcHJvdmFsLgogICAgLy8vIE5PVEU6IF9hcHByb3ZlKCkgZG9lcyBOT1Qgc2VuZCB0aGUgQXBwcm92YWwgZXZlbnQuIFRoaXMgaXMgaW50ZW50aW9uYWwgYmVjYXVzZQogICAgLy8vIF9hcHByb3ZlKCkgYW5kIHRyYW5zZmVyRnJvbSgpIGFyZSB1c2VkIHRvZ2V0aGVyIGZvciBwdXR0aW5nIE1hc3RlcnBpZWNlcyBvbiBhdWN0aW9uLCBhbmQKICAgIC8vLyB0aGVyZSBpcyBubyB2YWx1ZSBpbiBzcGFtbWluZyB0aGUgbG9nIHdpdGggQXBwcm92YWwgZXZlbnRzIGluIHRoYXQgY2FzZS4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgbWFzdGVycGllY2VUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIE1hc3RlcnBpZWNlLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIGNvbmZpcm1pbmcgTWFzdGVycGllY2UgaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBNYXN0ZXJwaWVjZSBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIG1hc3RlcnBpZWNlVG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBTYWZldHkgY2hlY2sgb24gX3RvIGFkZHJlc3MgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICBmdW5jdGlvbiBfYWRkcmVzc05vdE51bGwoYWRkcmVzcyBfdG8pIGludGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBfdG8gIT0gYWRkcmVzcygwKTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgQXVjdGlvbiBDb3JlCi8vLyBAZGV2IENvbnRhaW5zIG1vZGVscywgdmFyaWFibGVzLCBhbmQgaW50ZXJuYWwgbWV0aG9kcyBmb3IgdGhlIGF1Y3Rpb24uCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8gUmVwcmVzZW50cyBhbiBhdWN0aW9uIG9uIGFuIE5GVAogICAgc3RydWN0IEF1Y3Rpb24gewogICAgICAgIC8vIEN1cnJlbnQgb3duZXIgb2YgTkZUCiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgZW5kIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IGVuZGluZ1ByaWNlOwogICAgICAgIC8vIER1cmF0aW9uIChpbiBzZWNvbmRzKSBvZiBhdWN0aW9uCiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIC8vIFRpbWUgd2hlbiBhdWN0aW9uIHN0YXJ0ZWQKICAgICAgICAvLyBOT1RFOiAwIGlmIHRoaXMgYXVjdGlvbiBoYXMgYmVlbiBjb25jbHVkZWQKICAgICAgICB1aW50NjQgc3RhcnRlZEF0OwogICAgfQoKICAgIC8vIFJlZmVyZW5jZSB0byBjb250cmFjdCB0cmFja2luZyBORlQgb3duZXJzaGlwCiAgICBNYXN0ZXJwaWVjZU93bmVyc2hpcCBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCiAgICAvLyBDdXQgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtZWFzdXJlZCBpbiBiYXNpcyBwb2ludHMgKDEvMTAwIG9mIGEgcGVyY2VudCkuCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICAgIHVpbnQyNTYgcHVibGljIG93bmVyQ3V0OwoKICAgIC8vIE1hcCBmcm9tIHRva2VuIElEIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgYXVjdGlvbi4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikgcHVibGljIHRva2VuSWRUb0F1Y3Rpb247CgogICAgZXZlbnQgQXVjdGlvbkNyZWF0ZWQodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24pOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHByaWNlLCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBjbGFpbWFudCBvd25zIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IC0gQWRkcmVzcyBjbGFpbWluZyB0byBvd24gdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIG93bmVyc2hpcCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRXNjcm93cyB0aGUgTkZULCBhc3NpZ25pbmcgb3duZXJzaGlwIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gVGhyb3dzIGlmIHRoZSBlc2Nyb3cgZmFpbHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciAtIEN1cnJlbnQgb3duZXIgYWRkcmVzcyBvZiB0b2tlbiB0byBlc2Nyb3cuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2UgYXBwcm92YWwgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyRnJvbShfb3duZXIsIHRoaXMsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYW4gTkZUIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgc3VjY2VlZHMuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlciAtIEFkZHJlc3MgdG8gdHJhbnNmZXIgTkZUIHRvLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAvLy8gIEF1Y3Rpb25DcmVhdGVkIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHB1dCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgLy8gRXhwbGljaXRseSBjaGVjayB0aGF0IHRoaXMgYXVjdGlvbiBpcyBjdXJyZW50bHkgbGl2ZS4KICAgICAgICAvLyAoQmVjYXVzZSBvZiBob3cgRXRoZXJldW0gbWFwcGluZ3Mgd29yaywgd2UgY2FuJ3QganVzdCBjb3VudAogICAgICAgIC8vIG9uIHRoZSBsb29rdXAgYWJvdmUgZmFpbGluZy4gQW4gaW52YWxpZCBfdG9rZW5JZCB3aWxsIGp1c3QKICAgICAgICAvLyByZXR1cm4gYW4gYXVjdGlvbiBvYmplY3QgdGhhdCBpcyBhbGwgemVyb3MuKQogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBiaWQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBjdXJyZW50IHByaWNlCiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdCBnZXRzIGRlbGV0ZWQuCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICAvLyBSZW1vdmUgdGhlIGF1Y3Rpb24gYmVmb3JlIHNlbmRpbmcgdGhlIGZlZXMgdG8gdGhlIHNlbmRlciBzbyB3ZSBjYW4ndCBoYXZlIGEgcmVlbnRyYW5jeSBhdHRhY2suCiAgICAgICAgX3JlbW92ZUF1Y3Rpb24oX3Rva2VuSWQpOwogICAgICAgIGlmIChwcmljZSA+IDApIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhdWN0aW9uZWVyJ3MgY3V0LgogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25lZXJDdXQgPSBfY29tcHV0ZUN1dChwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgc2VsbGVyUHJvY2VlZHMgPSBwcmljZSAtIGF1Y3Rpb25lZXJDdXQ7CiAgICAgICAgICAgIC8vIE5PVEU6IERvaW5nIGEgdHJhbnNmZXIoKSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcGxleAogICAgICAgICAgICAvLyBtZXRob2QgbGlrZSB0aGlzIGlzIGdlbmVyYWxseSBkaXNjb3VyYWdlZCBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHJlZW50cmFuY3kgYXR0YWNrcyBhbmQgRG9TIGF0dGFja3MgaWYgdGhlIHNlbGxlciBpcwogICAgICAgICAgICAvLyBhIGNvbnRyYWN0IHdpdGggYW4gaW52YWxpZCBmYWxsYmFjayBmdW5jdGlvbi4gV2UgZXhwbGljaXRseQogICAgICAgICAgICAvLyBndWFyZCBhZ2FpbnN0IHJlZW50cmFuY3kgYXR0YWNrcyBieSByZW1vdmluZyB0aGUgYXVjdGlvbgogICAgICAgICAgICAvLyBiZWZvcmUgY2FsbGluZyB0cmFuc2ZlcigpLCBhbmQgdGhlIG9ubHkgdGhpbmcgdGhlIHNlbGxlcgogICAgICAgICAgICAvLyBjYW4gRG9TIGlzIHRoZSBzYWxlIG9mIHRoZWlyIG93biBhc3NldCEgKEFuZCBpZiBpdCdzIGFuCiAgICAgICAgICAgIC8vIGFjY2lkZW50LCB0aGV5IGNhbiBjYWxsIGNhbmNlbEF1Y3Rpb24oKS4gKQogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIG5leHQgbGlzdGluZyBwcmljZSBvZiB0aGUgdG9rZW4uCiAgICAgICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3Quc2V0TmV4dFByaWNlT2YoX3Rva2VuSWQsIHByaWNlKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfdG9rZW5JZCwgcHJpY2UsIG1zZy5zZW5kZXIpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhbiBhdWN0aW9uIGZyb20gdGhlIGxpc3Qgb2Ygb3BlbiBhdWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICBkZWxldGUgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBORlQgaXMgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gLSBBdWN0aW9uIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gX2lzT25BdWN0aW9uKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBjdXJyZW50IHByaWNlIG9mIGFuIE5GVCBvbiBhdWN0aW9uLiBCcm9rZW4gaW50byB0d28KICAgIC8vLyAgZnVuY3Rpb25zICh0aGlzIG9uZSwgdGhhdCBjb21wdXRlcyB0aGUgZHVyYXRpb24gZnJvbSB0aGUgYXVjdGlvbgogICAgLy8vICBzdHJ1Y3R1cmUsIGFuZCB0aGUgb3RoZXIgdGhhdCBkb2VzIHRoZSBwcmljZSBjb21wdXRhdGlvbikgc28gd2UKICAgIC8vLyAgY2FuIGVhc2lseSB0ZXN0IHRoYXQgdGhlIHByaWNlIGNvbXB1dGF0aW9uIHdvcmtzIGNvcnJlY3RseS4KICAgIGZ1bmN0aW9uIF9jdXJyZW50UHJpY2UoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgdWludDI1NiBzZWNvbmRzUGFzc2VkID0gMDsKCiAgICAgICAgLy8gQSBiaXQgb2YgaW5zdXJhbmNlIGFnYWluc3QgbmVnYXRpdmUgdmFsdWVzIChvciB3cmFwYXJvdW5kKS4KICAgICAgICAvLyBQcm9iYWJseSBub3QgbmVjZXNzYXJ5IChzaW5jZSBFdGhlcmV1bSBndWFybmF0ZWVzIHRoYXQgdGhlCiAgICAgICAgLy8gbm93IHZhcmlhYmxlIGRvZXNuJ3QgZXZlciBnbyBiYWNrd2FyZHMpLgogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICAgICAgX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBzZWNvbmRzUGFzc2VkCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLiBGYWN0b3JlZCBvdXQKICAgIC8vLyAgZnJvbSBfY3VycmVudFByaWNlIHNvIHdlIGNhbiBydW4gZXh0ZW5zaXZlIHVuaXQgdGVzdHMuCiAgICAvLy8gIFdoZW4gdGVzdGluZywgbWFrZSB0aGlzIGZ1bmN0aW9uIHB1YmxpYyBhbmQgdHVybiBvbgogICAgLy8vICBgQ3VycmVudCBwcmljZSBjb21wdXRhdGlvbmAgdGVzdCBzdWl0ZS4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBfc2Vjb25kc1Bhc3NlZAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBwdWJsaWMgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICB0aW1lIChhdCA2NC1iaXRzKSBhbmQgY3VycmVuY3kgKGF0IDEyOC1iaXRzKS4gX2R1cmF0aW9uIGlzCiAgICAgICAgLy8gIGFsc28ga25vd24gdG8gYmUgbm9uLXplcm8gKHNlZSB0aGUgcmVxdWlyZSgpIHN0YXRlbWVudCBpbgogICAgICAgIC8vICBfYWRkQXVjdGlvbigpKQogICAgICAgIGlmIChfc2Vjb25kc1Bhc3NlZCA+PSBfZHVyYXRpb24pIHsKICAgICAgICAgICAgLy8gV2UndmUgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcG9ydGlvbgogICAgICAgICAgICAvLyBvZiB0aGUgYXVjdGlvbiwganVzdCByZXR1cm4gdGhlIGVuZCBwcmljZS4KICAgICAgICAgICAgcmV0dXJuIF9lbmRpbmdQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTdGFydGluZyBwcmljZSBjYW4gYmUgaGlnaGVyIHRoYW4gZW5kaW5nIHByaWNlIChhbmQgb2Z0ZW4gaXMhKSwgc28KICAgICAgICAgICAgLy8gdGhpcyBkZWx0YSBjYW4gYmUgbmVnYXRpdmUuCiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9lbmRpbmdQcmljZSkgLSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpOwoKICAgICAgICAgICAgLy8gVGhpcyBtdWx0aXBsaWNhdGlvbiBjYW4ndCBvdmVyZmxvdywgX3NlY29uZHNQYXNzZWQgd2lsbCBlYXNpbHkgZml0IHdpdGhpbgogICAgICAgICAgICAvLyA2NC1iaXRzLCBhbmQgdG90YWxQcmljZUNoYW5nZSB3aWxsIGVhc2lseSBmaXQgd2l0aGluIDEyOC1iaXRzLCB0aGVpciBwcm9kdWN0CiAgICAgICAgICAgIC8vIHdpbGwgYWx3YXlzIGZpdCB3aXRoaW4gMjU2LWJpdHMuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KF9zZWNvbmRzUGFzc2VkKSAvIGludDI1NihfZHVyYXRpb24pOwoKICAgICAgICAgICAgLy8gY3VycmVudFByaWNlQ2hhbmdlIGNhbiBiZSBuZWdhdGl2ZSwgYnV0IGlmIHNvLCB3aWxsIGhhdmUgYSBtYWduaXR1ZGUKICAgICAgICAgICAgLy8gbGVzcyB0aGF0IF9zdGFydGluZ1ByaWNlLiBUaHVzLCB0aGlzIHJlc3VsdCB3aWxsIGFsd2F5cyBlbmQgdXAgcG9zaXRpdmUuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwoKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgb3duZXIncyBjdXQgb2YgYSBzYWxlLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgLSBTYWxlIHByaWNlIG9mIE5GVC4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBDbG9jayBhdWN0aW9uIGZvciBub24tZnVuZ2libGUgdG9rZW5zLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbiBpcyBQYXVzYWJsZSwgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8vIEBkZXYgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IHB1YmxpYyBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciBjcmVhdGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gIGFuZCB2ZXJpZmllcyB0aGUgb3duZXIgY3V0IGlzIGluIHRoZSB2YWxpZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gX25mdEFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nCiAgICAvLy8gIHRoZSBOb25mdW5naWJsZSBJbnRlcmZhY2UuCiAgICAvLy8gQHBhcmFtIF9jdXQgLSBwZXJjZW50IGN1dCB0aGUgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtdXN0IGJlCiAgICAvLy8gIGJldHdlZW4gMC0xMCwwMDAuCiAgICBmdW5jdGlvbiBDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkcmVzcywgdWludDI1NiBfY3V0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2N1dCA8PSAxMDAwMCk7CiAgICAgICAgb3duZXJDdXQgPSBfY3V0OwoKICAgICAgICBNYXN0ZXJwaWVjZU93bmVyc2hpcCBjYW5kaWRhdGVDb250cmFjdCA9IE1hc3RlcnBpZWNlT3duZXJzaGlwKF9uZnRBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxKSk7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFJlbW92ZSBhbGwgRXRoZXIgZnJvbSB0aGUgY29udHJhY3QsIHdoaWNoIGlzIHRoZSBvd25lcidzIGN1dHMKICAgIC8vLyAgYXMgd2VsbCBhcyBhbnkgRXRoZXIgc2VudCBkaXJlY3RseSB0byB0aGUgY29udHJhY3QgYWRkcmVzcy4KICAgIC8vLyAgQWx3YXlzIHRyYW5zZmVycyB0byB0aGUgTkZUIGNvbnRyYWN0LCBidXQgY2FuIGJlIGNhbGxlZCBlaXRoZXIgYnkKICAgIC8vLyAgdGhlIG93bmVyIG9yIHRoZSBORlQgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBuZnRBZGRyZXNzID0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KTsKCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBvd25lciB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IG5mdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGlzIGJvb2xlYW4gbWV0aG9kIHRvIG1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgb25lIGZhaWxzIGl0IHdpbGwgc3RpbGwgd29yawogICAgICAgIGJvb2wgcmVzID0gbmZ0QWRkcmVzcy5zZW5kKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIHRpbWUgdG8gbW92ZSBiZXR3ZWVuIHN0YXJ0aW5nCiAgICAvLy8gIHByaWNlIGFuZCBlbmRpbmcgcHJpY2UgKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIF9lc2Nyb3cobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBCaWRzIG9uIGFuIG9wZW4gYXVjdGlvbiwgY29tcGxldGluZyB0aGUgYXVjdGlvbiBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gX2JpZCB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB0aGF0IGhhc24ndCBiZWVuIHdvbiB5ZXQuCiAgICAvLy8gIFJldHVybnMgdGhlIE5GVCB0byBvcmlnaW5hbCBvd25lci4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgYSBzdGF0ZS1tb2RpZnlpbmcgZnVuY3Rpb24gdGhhdCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIHdoaWxlIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gb24gYXVjdGlvbgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsbGVyKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgLy8vICBPbmx5IHRoZSBvd25lciBtYXkgZG8gdGhpcywgYW5kIE5GVHMgYXJlIHJldHVybmVkIHRvCiAgICAvLy8gIHRoZSBzZWxsZXIuIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiBlbWVyZ2VuY2llcy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0aGUgTkZUIG9uIGF1Y3Rpb24gdG8gY2FuY2VsLgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbldoZW5QYXVzZWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5QYXVzZWQKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbi5zZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXVjdGlvbiBpbmZvIGZvciBhbiBORlQgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zCiAgICAoCiAgICAgICAgYWRkcmVzcyBzZWxsZXIsCiAgICAgICAgdWludDI1NiBzdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBkdXJhdGlvbiwKICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgKSB7CiAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGF1Y3Rpb24uc2VsbGVyLAogICAgICAgICAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICAgICAgYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgICAgIGF1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIHRva2VuIHByaWNlIHdlIGFyZSBjaGVja2luZy4KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBDbG9jayBhdWN0aW9uCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgU2FsZUNsb2NrQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTYWxlQXVjdGlvbkFkZHJlc3MoKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNTYWxlQ2xvY2tBdWN0aW9uID0gdHJ1ZTsKCiAgICAvLyBEZWxlZ2F0ZSBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU2FsZUNsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyLCB1aW50MjU2IF9jdXQpIHB1YmxpYwogICAgICAgIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgX2N1dCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgUGxhY2VzIGEgYmlkIGZvciB0aGUgTWFzdGVycGllY2UuIFJlcXVpcmVzIHRoZSBzZW5kZXIKICAgIC8vLyBpcyB0aGUgTWFzdGVycGllY2UgQ29yZSBjb250cmFjdCBiZWNhdXNlIGFsbCBiaWQgbWV0aG9kcwogICAgLy8vIHNob3VsZCBiZSB3cmFwcGVkLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgLyogcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpOyAqLwogICAgICAgIC8vIF9iaWQgY2hlY2tzIHRoYXQgdG9rZW4gSUQgaXMgdmFsaWQgYW5kIHdpbGwgdGhyb3cgaWYgYmlkIGZhaWxzCiAgICAgICAgX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgIH0KfQoKCmNvbnRyYWN0IE1hc3RlcnBpZWNlQXVjdGlvbiBpcyBNYXN0ZXJwaWVjZU93bmVyc2hpcCB7CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHRoZSBiYWxhbmNlIG9mIHRoZSBzYWxlIGF1Y3Rpb24gY29udHJhY3QKICAgIC8vLyB0byB0aGUgTWFzdGVycGllY2VDb3JlIGNvbnRyYWN0LiBXZSB1c2UgdHdvLXN0ZXAgd2l0aGRyYXdhbCB0bwogICAgLy8vIHByZXZlbnQgdHdvIHRyYW5zZmVyIGNhbGxzIGluIHRoZSBhdWN0aW9uIGJpZCBmdW5jdGlvbi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QXVjdGlvbkJhbGFuY2VzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlDTGV2ZWwKICAgIHsKICAgICAgICBzYWxlQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgYXVjdGlvbiBjb250cmFjdCB2YXJpYWJsZSAoc2FsZUF1Y3Rpb24pIGlzIGRlZmluZWQgaW4gTWFzdGVycGllY2VCYXNlCiAgICAvLy8gdG8gYWxsb3cgdXMgdG8gcmVmZXIgdG8gdGhlbSBpbiBNYXN0ZXJwaWVjZU93bmVyc2hpcCB0byBwcmV2ZW50IGFjY2lkZW50YWwgdHJhbnNmZXJzLgogICAgLy8vIEBkZXYgU2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBzYWxlIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hZGRyZXNzIC0gQWRkcmVzcyBvZiBzYWxlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gc2V0U2FsZUF1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5Q0VPCiAgICB7CiAgICAgICAgU2FsZUNsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNhbGVDbG9ja0F1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0KICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iLwogICAgICAgIC8vIGNmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2FsZUNsb2NrQXVjdGlvbigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIHNhbGVBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgVGhlIG93bmVyIG9mIGEgTWFzdGVycGllY2UgY2FuIHB1dCBpdCB1cCBmb3IgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNhbGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIE1hc3RlcnBpZWNlIHRvIGJlIHB1dCBvbiBhbiBhdWN0aW9uIHNhbGUgaXMgb3duZWQgYnkKICAgICAgICAvLyBpdHMgY3VycmVudCBvd25lci4gSWYgaXQncyBhbHJlYWR5IGluIGFuIGF1Y3Rpb24sIHRoaXMgdmFsaWRhdGlvbgogICAgICAgIC8vIHdpbGwgZmFpbCBiZWNhdXNlIHRoZSBNYXN0ZXJwaWVjZUF1Y3Rpb24gY29udHJhY3Qgb3ducyB0aGUKICAgICAgICAvLyBNYXN0ZXJwaWVjZSBvbmNlIGl0IGlzIHB1dCBvbiBhbiBhdWN0aW9uIHNhbGUuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCBzYWxlQXVjdGlvbik7CiAgICAgICAgLy8gU2FsZSBhdWN0aW9uIHRocm93cyBpZiBpbnB1dHMgYXJlIGludmFsaWQgYW5kIGNsZWFycwogICAgICAgIC8vIHRyYW5zZmVyIGFwcHJvdmFsIGFmdGVyIGVzY3JvdwogICAgICAgIHNhbGVBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgICAgIF90b2tlbklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKfQoKCmNvbnRyYWN0IE1hc3RlcnBpZWNlU2FsZSBpcyBNYXN0ZXJwaWVjZUF1Y3Rpb24gewoKICAgIC8vIEFsbG93cyBzb21lb25lIHRvIHNlbmQgZXRoZXIgYW5kIG9idGFpbiB0aGUgdG9rZW4KICAgIGZ1bmN0aW9uIHB1cmNoYXNlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICBhZGRyZXNzIG5ld093bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gbWFzdGVycGllY2VUb093bmVyW190b2tlbklkXTsKICAgICAgICB1aW50MjU2IHNhbGVQcmljZSA9IG1hc3RlcnBpZWNlVG9QcmljZVtfdG9rZW5JZF07CgogICAgICAgIC8vIFJlcXVpcmUgdGhhdCB0aGUgbWFzdGVycGllY2UgaXMgZWl0aGVyIGN1cnJlbnRseSBvd25lZCBieSB0aGUgTWFzdGVycGllY2UKICAgICAgICAvLyBDb3JlIGNvbnRyYWN0IG9yIHdhcyBib3JuIHdpdGhpbiB0aGUgc25hdGNoIHdpbmRvdy4KICAgICAgICByZXF1aXJlKAogICAgICAgICAgICAob2xkT3duZXIgPT0gYWRkcmVzcyh0aGlzKSkgfHwKICAgICAgICAgICAgKG5vdyAtIG1hc3RlcnBpZWNlc1tfdG9rZW5JZF0uYmlydGhUaW1lIDw9IG1hc3RlcnBpZWNlVG9TbmF0Y2hXaW5kb3dbX3Rva2VuSWRdKQogICAgICAgICk7CgogICAgICAgIC8vIFJlcXVpcmUgdGhhdCB0aGUgb3duZXIgb2YgdGhlIHRva2VuIGlzIG5vdCBzZW5kaW5nIHRvIHNlbGYuCiAgICAgICAgcmVxdWlyZShvbGRPd25lciAhPSBuZXdPd25lcik7CgogICAgICAgIC8vIFJlcXVpcmUgdGhhdCB0aGUgTWFzdGVycGllY2UgaXMgbm90IGluIGFuIGF1Y3Rpb24gYnkgY2hlY2tpbmcgdGhhdAogICAgICAgIC8vIHRoZSBTYWxlIENsb2NrIEF1Y3Rpb24gY29udHJhY3QgaXMgbm90IHRoZSBvd25lci4KICAgICAgICByZXF1aXJlKGFkZHJlc3Mob2xkT3duZXIpICE9IGFkZHJlc3Moc2FsZUF1Y3Rpb24pKTsKCiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX2FkZHJlc3NOb3ROdWxsKG5ld093bmVyKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgc2VudCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBzYWxlIHByaWNlCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gc2FsZVByaWNlKTsKCiAgICAgICAgdWludDI1NiBwYXltZW50ID0gdWludDI1Nihjb21wdXRlUGF5bWVudChzYWxlUHJpY2UpKTsKICAgICAgICB1aW50MjU2IHB1cmNoYXNlRXhjZXNzID0gU2FmZU1hdGguc3ViKG1zZy52YWx1ZSwgc2FsZVByaWNlKTsKCiAgICAgICAgLy8gU2V0IG5leHQgbGlzdGluZyBwcmljZS4KICAgICAgICBtYXN0ZXJwaWVjZVRvUHJpY2VbX3Rva2VuSWRdID0gY29tcHV0ZU5leHRQcmljZShzYWxlUHJpY2UpOwoKICAgICAgICAvLyBUcmFuc2ZlciB0aGUgTWFzdGVycGllY2UgdG8gdGhlIGJ1eWVyLgogICAgICAgIF90cmFuc2ZlcihvbGRPd25lciwgbmV3T3duZXIsIF90b2tlbklkKTsKCiAgICAgICAgLy8gUGF5IHNlbGxlciBvZiB0aGUgTWFzdGVycGllY2UgaWYgdGhleSBhcmUgbm90IHRoaXMgY29udHJhY3QuCiAgICAgICAgaWYgKG9sZE93bmVyICE9IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgb2xkT3duZXIudHJhbnNmZXIocGF5bWVudCk7CiAgICAgICAgfQoKICAgICAgICBUb2tlblNvbGQoX3Rva2VuSWQsIHNhbGVQcmljZSwgbWFzdGVycGllY2VUb1ByaWNlW190b2tlbklkXSwgb2xkT3duZXIsIG5ld093bmVyLCBtYXN0ZXJwaWVjZXNbX3Rva2VuSWRdLm5hbWUpOwoKICAgICAgICAvLyBSZWltYnVyc2UgdGhlIGJ1eWVyIG9mIGFueSBleGNlc3MgcGFpZC4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHB1cmNoYXNlRXhjZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcmljZU9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgcHJpY2UpCiAgICB7CiAgICAgICAgcmV0dXJuIG1hc3RlcnBpZWNlVG9QcmljZVtfdG9rZW5JZF07CiAgICB9Cgp9CgoKY29udHJhY3QgTWFzdGVycGllY2VNaW50aW5nIGlzIE1hc3RlcnBpZWNlU2FsZSB7CgogICAgLyoqKiBDT05TVEFOVFMgKioqLwogICAgLy8vIEBkZXYgU3RhcnRpbmcgcHJpY2Ugb2YgYSByZWd1bGFyIE1hc3RlcnBpZWNlLgogICAgdWludDEyOCBwcml2YXRlIGNvbnN0YW50IFNUQVJUSU5HX1BSSUNFID0gMC4wMDEgZXRoZXI7CiAgICAvLy8gQGRldiBMaW1pdCBvZiBudW1iZXIgb2YgcHJvbW8gbWFzdGVycGllY2VzIHRoYXQgY2FuIGJlIGNyZWF0ZWQuCiAgICB1aW50MTYgcHJpdmF0ZSBjb25zdGFudCBQUk9NT19DUkVBVElPTl9MSU1JVCA9IDEwMDAwOwoKICAgIC8vLyBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIFByb21vdGlvbmFsIE1hc3RlcnBpZWNlcyB0aGUgY29udHJhY3Qgb3duZXIgaGFzIGNyZWF0ZWQuCiAgICB1aW50MTYgcHVibGljIHByb21vTWFzdGVycGllY2VzQ3JlYXRlZENvdW50OwogICAgLy8vIEBkZXYgUmVmZXJlbmNlIHRvIGNvbnRyYWN0IHRyYWNraW5nIE5vbiBGdW5naWJsZSBUb2tlbiBvd25lcnNoaXAKICAgIEVSQzcyMSBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgbmV3IE1hc3RlcnBpZWNlIHdpdGggdGhlIGdpdmVuIG5hbWUgYW5kIGFydGlzdC4KICAgIGZ1bmN0aW9uIGNyZWF0ZU1hc3RlcnBpZWNlKAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX2FydGlzdCwKICAgICAgICB1aW50MjU2IF9zbmF0Y2hXaW5kb3cKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5Q3VyYXRvcgogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdWludDI1NiBtYXN0ZXJwaWVjZUlkID0gX2NyZWF0ZU1hc3RlcnBpZWNlKF9uYW1lLCBfYXJ0aXN0LCBTVEFSVElOR19QUklDRSwgX3NuYXRjaFdpbmRvdywgYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmV0dXJuIG1hc3RlcnBpZWNlSWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhIG5ldyBwcm9tb3Rpb25hbCBNYXN0ZXJwaWVjZSB3aXRoIHRoZSBnaXZlbiBuYW1lLCBhcnRpc3QsIHN0YXJ0aW5nCiAgICAvLy8gcHJpY2UsIGFuZCBvd25lci4gSWYgdGhlIG93bmVyIG9yIHRoZSBwcmljZSBpcyBub3Qgc2V0LCB3ZSBkZWZhdWx0IHRoZW0gdG8gdGhlCiAgICAvLy8gY3VyYXRvcidzIGFkZHJlc3MgYW5kIHRoZSBzdGFydGluZyBwcmljZSBmb3IgYWxsIG1hc3RlcnBpZWNlcy4KICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21vTWFzdGVycGllY2UoCiAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgIHN0cmluZyBfYXJ0aXN0LAogICAgICAgIHVpbnQyNTYgX3NuYXRjaFdpbmRvdywKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICBhZGRyZXNzIF9vd25lcgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlDdXJhdG9yCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKHByb21vTWFzdGVycGllY2VzQ3JlYXRlZENvdW50IDwgUFJPTU9fQ1JFQVRJT05fTElNSVQpOwoKICAgICAgICBhZGRyZXNzIG1hc3RlcnBpZWNlT3duZXIgPSBfb3duZXI7CiAgICAgICAgaWYgKG1hc3RlcnBpZWNlT3duZXIgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBtYXN0ZXJwaWVjZU93bmVyID0gY3VyYXRvckFkZHJlc3M7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3ByaWNlIDw9IDApIHsKICAgICAgICAgICAgX3ByaWNlID0gU1RBUlRJTkdfUFJJQ0U7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IG1hc3RlcnBpZWNlSWQgPSBfY3JlYXRlTWFzdGVycGllY2UoX25hbWUsIF9hcnRpc3QsIF9wcmljZSwgX3NuYXRjaFdpbmRvdywgbWFzdGVycGllY2VPd25lcik7CiAgICAgICAgcHJvbW9NYXN0ZXJwaWVjZXNDcmVhdGVkQ291bnQrKzsKICAgICAgICByZXR1cm4gbWFzdGVycGllY2VJZDsKICAgIH0KCn0KCgovLy8gQ3J5cHRvTWFzdGVycGllY2VzOiBDb2xsZWN0aWJsZSBmaW5lIGFydCBtYXN0ZXJwaWVjZXMgb24gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4uCmNvbnRyYWN0IE1hc3RlcnBpZWNlQ29yZSBpcyBNYXN0ZXJwaWVjZU1pbnRpbmcgewoKICAgIC8vIC0gTWFzdGVycGllY2VBY2Nlc3NDb250cm9sOiBUaGlzIGNvbnRyYWN0IGRlZmluZXMgd2hpY2ggdXNlcnMgYXJlIGdyYW50ZWQgdGhlIGdpdmVuIHJvbGVzIHRoYXQgYXJlCiAgICAvLyByZXF1aXJlZCB0byBleGVjdXRlIHNwZWNpZmljIG9wZXJhdGlvbnMuCiAgICAvLwogICAgLy8gLSBNYXN0ZXJwaWVjZUJhc2U6IFRoaXMgY29udHJhY3QgaW5oZXJpdHMgZnJvbSB0aGUgTWFzdGVycGllY2VBY2Nlc3NDb250cm9sIGNvbnRyYWN0IGFuZCBkZWZpbmVzCiAgICAvLyB0aGUgY29yZSBmdW5jdGlvbmFsaXR5IG9mIENyeXB0b01hc3RlcnBpZWNlcywgaW5jbHVkaW5nIHRoZSBkYXRhIHR5cGVzLCBzdG9yYWdlLCBhbmQgY29uc3RhbnRzLgogICAgLy8KICAgIC8vIC0gTWFzdGVycGllY2VQcmljaW5nOiBUaGlzIGNvbnRyYWN0IGluaGVyaXRzIGZyb20gdGhlIE1hc3RlcnBpZWNlQmFzZSBjb250cmFjdCBhbmQgZGVmaW5lcwogICAgLy8gdGhlIHByaWNpbmcgbG9naWMgZm9yIENyeXB0b01hc3RlcnBpZWNlcy4gV2l0aCBldmVyeSBwdXJjaGFzZSBtYWRlIHRocm91Z2ggdGhlIENvcmUgY29udHJhY3Qgb3IKICAgIC8vIHRocm91Z2ggYSBzYWxlIGF1Y3Rpb24sIHRoZSBuZXh0IGxpc3RlZCBwcmljZSB3aWxsIG11bHRpcGx5IGJhc2VkIG9uIDUgcHJpY2UgdGllcnMuIFRoaXMgZW5zdXJlcwogICAgLy8gdGhhdCB0aGUgTWFzdGVycGllY2UgYm91Z2h0IHRocm91Z2ggQ3J5cHRvTWFzdGVycGllY2VzIHdpbGwgYWx3YXlzIGJlIGFkanVzdGVkIHRvIGl0cyBmYWlyIG1hcmtldAogICAgLy8gdmFsdWUuCiAgICAvLwogICAgLy8gLSBNYXN0ZXJwaWVjZU93bmVyc2hpcDogVGhpcyBjb250cmFjdCBpbmhlcml0cyBmcm9tIHRoZSBNYXN0ZXJwaWVjZVByaWNpbmcgY29udHJhY3QgYW5kIHRoZSBFUkMtNzIxCiAgICAvLyAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkgY29udHJhY3QgYW5kIGltcGxlbWVudHMgdGhlIG1ldGhvZHMgcmVxdWlyZWQgZm9yCiAgICAvLyAgTm9uLUZ1bmdpYmxlIFRva2VuIFRyYW5zYWN0aW9ucy4KICAgIC8vCiAgICAvLyAtIE1hc3RlcnBpZWNlQXVjdGlvbjogVGhpcyBjb250cmFjdCBpbmhlcml0cyBmcm9tIHRoZSBNYXN0ZXJwaWVjZU93bmVyc2hpcCBjb250cmFjdC4gSXQgZGVmaW5lcwogICAgLy8gdGhlIER1dGNoICJjbG9jayIgYXVjdGlvbiBtZWNoYW5pc20gZm9yIG93bmVycyBvZiBhIG1hc3RlcnBpZWNlIHRvIHBsYWNlIGl0IG9uIHNhbGUuIFRoZSBhdWN0aW9uCiAgICAvLyBzdGFydHMgb2ZmIGF0IHRoZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBuZXh0IHByaWNlIGFuZCB1bnRpbCBpdCBpcyBzb2xkLCBkZWNyZW1lbnRzIHRoZSBwcmljZQogICAgLy8gYXMgdGltZSBwYXNzZXMuIFRoZSBvd25lciBvZiB0aGUgbWFzdGVycGllY2UgY2FuIGNhbmNlbCB0aGUgYXVjdGlvbiBhdCBhbnkgcG9pbnQgYW5kIHRoZSBwcmljZQogICAgLy8gY2Fubm90IGdvIGxvd2VyIHRoYW4gdGhlIHByaWNlIHRoYXQgdGhlIG93bmVyIGJvdWdodCB0aGUgbWFzdGVycGllY2UgZm9yLgogICAgLy8KICAgIC8vIC0gTWFzdGVycGllY2VTYWxlOiBUaGlzIGNvbnRyYWN0IGluaGVyaXRzIGZyb20gdGhlIE1hc3RlcnBpZWNlQXVjdGlvbiBjb250cmFjdC4gSXQgZGVmaW5lcyB0aGUKICAgIC8vIHRpZXJlZCBwcmljaW5nIGxvZ2ljIGFuZCBoYW5kbGVzIGFsbCBzYWxlcy4gSXQgYWxzbyBjaGVja3MgdGhhdCBhIE1hc3RlcnBpZWNlIGlzIG5vdCBpbiBhbgogICAgLy8gYXVjdGlvbiBiZWZvcmUgYXBwcm92aW5nIGEgcHVyY2hhc2UuCiAgICAvLwogICAgLy8gLSBNYXN0ZXJwaWVjZU1pbnRpbmc6IFRoaXMgY29udHJhY3QgaW5oZXJpdHMgZnJvbSB0aGUgTWFzdGVycGllY2VTYWxlIGNvbnRyYWN0LiBJdCBkZWZpbmVzIHRoZQogICAgLy8gY3JlYXRpb24gb2YgbmV3IHJlZ3VsYXIgYW5kIHByb21vdGlvbmFsIG1hc3RlcnBpZWNlcy4KCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgY29yZSBjb250cmFjdCBpcyBicm9rZW4gYW5kIGEgZm9yayBpcyByZXF1aXJlZAogICAgYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKICAgIGZ1bmN0aW9uIE1hc3RlcnBpZWNlQ29yZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gU3RhcnRzIHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwoKICAgICAgICAvLyBUaGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0VPCiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyBhbHNvIHRoZSBpbml0aWFsIEN1cmF0b3IKICAgICAgICBjdXJhdG9yQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBkZXYgVXNlZCB0byBtYXJrIHRoZSBzbWFydCBjb250cmFjdCBhcyB1cGdyYWRlZCwgaW4gY2FzZSB0aGVyZSBpcyBhIHNlcmlvdXMKICAgIC8vLyAgYnJlYWtpbmcgYnVnLiBUaGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcgYnV0IGtlZXAgdHJhY2sgb2YgdGhlIG5ldyBjb250cmFjdCBhbmQKICAgIC8vLyAgZW1pdCBhIG1lc3NhZ2UgaW5kaWNhdGluZyB0aGF0IHRoZSBuZXcgYWRkcmVzcyBpcyBzZXQuIEl0J3MgdXAgdG8gY2xpZW50cyBvZiB0aGlzCiAgICAvLy8gIGNvbnRyYWN0IHRvIHVwZGF0ZSB0byB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MgaW4gdGhhdCBjYXNlLiAoVGhpcyBjb250cmFjdCB3aWxsCiAgICAvLy8gIGJlIHBhdXNlZCBpbmRlZmluaXRlbHkgaWYgc3VjaCBhbiB1cGdyYWRlIHRha2VzIHBsYWNlLikKICAgIC8vLyBAcGFyYW0gX3YyQWRkcmVzcyBuZXcgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5Q0VPCiAgICAgICAgd2hlblBhdXNlZAogICAgewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0Rm9yayhfdjJBZGRyZXNzKTsKICAgIH0KCiAgICAvLy8gQGRldiBXaXRoZHJhdyBhbGwgRXRoZXIgZnJvbSB0aGUgY29udHJhY3QuIFRoaXMgaW5jbHVkZXMgdGhlIGZlZSBvbiBldmVyeQogICAgLy8vIG1hc3RlcnBpZWNlIHNvbGQgYW5kIGFueSBFdGhlciBzZW50IGRpcmVjdGx5IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzLgogICAgLy8vIE9ubHkgdGhlIENGTyBjYW4gd2l0aGRyYXcgdGhlIGJhbGFuY2Ugb3Igc3BlY2lmeSB0aGUgYWRkcmVzcyB0byBzZW5kCiAgICAvLy8gdGhlIGJhbGFuY2UgdG8uCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoYWRkcmVzcyBfdG8pIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGlzIGJvb2xlYW4gbWV0aG9kIHRvIG1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgb25lIGZhaWxzIGl0IHdpbGwgc3RpbGwgd29yawogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBjZm9BZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYWxsIHRoZSByZWxldmFudCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIG1hc3RlcnBpZWNlLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgdG9rZW5JZCBvZiB0aGUgbWFzdGVycGllY2Ugb2YgaW50ZXJlc3QuCiAgICBmdW5jdGlvbiBnZXRNYXN0ZXJwaWVjZSh1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyBhcnRpc3QsCiAgICAgICAgdWludDI1NiBiaXJ0aFRpbWUsCiAgICAgICAgdWludDI1NiBzbmF0Y2hXaW5kb3csCiAgICAgICAgdWludDI1NiBzZWxsaW5nUHJpY2UsCiAgICAgICAgYWRkcmVzcyBvd25lcgogICAgKSB7CiAgICAgICAgTWFzdGVycGllY2Ugc3RvcmFnZSBtYXN0ZXJwaWVjZSA9IG1hc3RlcnBpZWNlc1tfdG9rZW5JZF07CiAgICAgICAgbmFtZSA9IG1hc3RlcnBpZWNlLm5hbWU7CiAgICAgICAgYXJ0aXN0ID0gbWFzdGVycGllY2UuYXJ0aXN0OwogICAgICAgIGJpcnRoVGltZSA9IHVpbnQyNTYobWFzdGVycGllY2UuYmlydGhUaW1lKTsKICAgICAgICBzbmF0Y2hXaW5kb3cgPSBtYXN0ZXJwaWVjZVRvU25hdGNoV2luZG93W190b2tlbklkXTsKICAgICAgICBzZWxsaW5nUHJpY2UgPSBtYXN0ZXJwaWVjZVRvUHJpY2VbX3Rva2VuSWRdOwogICAgICAgIG93bmVyID0gbWFzdGVycGllY2VUb093bmVyW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBPdmVycmlkZSB1bnBhdXNlIHNvIGl0IHJlcXVpcmVzIGFsbCBleHRlcm5hbCBjb250cmFjdCBhZGRyZXNzZXMKICAgIC8vLyAgdG8gYmUgc2V0IGJlZm9yZSBjb250cmFjdCBjYW4gYmUgdW5wYXVzZWQuIEFsc28sIHdlIGNhbid0IGhhdmUKICAgIC8vLyAgbmV3Q29udHJhY3RBZGRyZXNzIHNldCBlaXRoZXIsIGJlY2F1c2UgdGhlbiB0aGUgY29udHJhY3Qgd2FzIHVwZ3JhZGVkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gd2UgY2FuIGNhbGwgc3VwZXIudW5wYXVzZQogICAgLy8vICB3aXRob3V0IHVzaW5nIGFuIGV4cGVuc2l2ZSBjYWxsLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUNFTwogICAgICAgIHdoZW5QYXVzZWQKICAgIHsKICAgICAgICByZXF1aXJlKHNhbGVBdWN0aW9uICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9Cgp9'.
	

]
