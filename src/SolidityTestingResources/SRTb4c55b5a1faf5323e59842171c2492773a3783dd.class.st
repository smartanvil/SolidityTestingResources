Class {
	#name : #SRTb4c55b5a1faf5323e59842171c2492773a3783dd,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb4c55b5a1faf5323e59842171c2492773a3783dd >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBhY2NlcHRlZCBmcm9tIHplcHBlbGluLXNvbGlkaXR5IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKLyoKICogRVJDMjAgaW50ZXJmYWNlCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiID4gMCk7CiAgICB1aW50IGMgPSBhIC8gYjsKICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KfQoKLy8vIEB0aXRsZSBNdWx0aXNpZ25hdHVyZSB3YWxsZXQgLSBBbGxvd3MgbXVsdGlwbGUgcGFydGllcyB0byBhZ3JlZSBvbiB0cmFuc2FjdGlvbnMgYmVmb3JlIGV4ZWN1dGlvbi4KLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijk0ZTdlMGYxZjJmNWZhYmFmM2YxZmJlNmYzZjFkNGY3ZmJmYWU3ZjFmYWU3ZWRlN2JhZmFmMWUwIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgTXVsdGlTaWdXYWxsZXQgewoKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlmIGFkZHJlc3MgaXMgZm9yIGEgcmVhbCBjb250cmFjdCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzTXVsdGlTaWdXYWxsZXQgPSBmYWxzZTsKCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBNQVhfT1dORVJfQ09VTlQgPSA1MDsKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgUmV2b2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBTdWJtaXNzaW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IEV4ZWN1dGlvbih1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBFeGVjdXRpb25GYWlsdXJlKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IERlcG9zaXQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCB2YWx1ZSk7CiAgICBldmVudCBPd25lckFkZGl0aW9uKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7CiAgICBldmVudCBPd25lclJlbW92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlKHVpbnQgcmVxdWlyZWQpOwoKICAgIG1hcHBpbmcgKHVpbnQgPT4gVHJhbnNhY3Rpb24pIHB1YmxpYyB0cmFuc2FjdGlvbnM7CiAgICBtYXBwaW5nICh1aW50ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkpIHB1YmxpYyBjb25maXJtYXRpb25zOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNPd25lcjsKICAgIGFkZHJlc3NbXSBwdWJsaWMgb3duZXJzOwogICAgdWludCBwdWJsaWMgcmVxdWlyZWQ7CiAgICB1aW50IHB1YmxpYyB0cmFuc2FjdGlvbkNvdW50OwoKICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBkZXN0aW5hdGlvbjsKICAgICAgICB1aW50IHZhbHVlOwogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgYm9vbCBleGVjdXRlZDsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJEb2VzTm90RXhpc3QoYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmIChpc093bmVyW293bmVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckV4aXN0cyhhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgaWYgKCFpc093bmVyW293bmVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0cmFuc2FjdGlvbkV4aXN0cyh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmRlc3RpbmF0aW9uID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmICghY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90Q29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RFeGVjdXRlZCh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmV4ZWN1dGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdE51bGwoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIGlmIChfYWRkcmVzcyA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkUmVxdWlyZW1lbnQodWludCBvd25lckNvdW50LCB1aW50IF9yZXF1aXJlZCkgewogICAgICAgIGlmIChvd25lckNvdW50ID4gTUFYX09XTkVSX0NPVU5UKSB0aHJvdzsKICAgICAgICBpZiAoX3JlcXVpcmVkID4gb3duZXJDb3VudCkgdGhyb3c7CiAgICAgICAgaWYgKF9yZXF1aXJlZCA9PSAwKSB0aHJvdzsKICAgICAgICBpZiAob3duZXJDb3VudCA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIGFsbG93cyB0byBkZXBvc2l0IGV0aGVyLgogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkKICAgICAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIC8qCiAgICAgKiBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIHNldHMgaW5pdGlhbCBvd25lcnMgYW5kIHJlcXVpcmVkIG51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgLy8vIEBwYXJhbSBfb3duZXJzIExpc3Qgb2YgaW5pdGlhbCBvd25lcnMuCiAgICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIE11bHRpU2lnV2FsbGV0KGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxfb3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc093bmVyW19vd25lcnNbaV1dIHx8IF9vd25lcnNbaV0gPT0gMCkgdGhyb3c7CiAgICAgICAgICAgIGlzT3duZXJbX293bmVyc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpc011bHRpU2lnV2FsbGV0ID0gdHJ1ZTsKICAgICAgICBvd25lcnMgPSBfb3duZXJzOwogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byBhZGQgYSBuZXcgb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBuZXcgb3duZXIuCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIG93bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlXYWxsZXQKICAgICAgICBvd25lckRvZXNOb3RFeGlzdChvd25lcikKICAgICAgICBub3ROdWxsKG93bmVyKQogICAgICAgIHZhbGlkUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCArIDEsIHJlcXVpcmVkKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gdHJ1ZTsKICAgICAgICBvd25lcnMucHVzaChvd25lcik7CiAgICAgICAgT3duZXJBZGRpdGlvbihvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlbW92ZSBhbiBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyLgogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBvd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgb3duZXJFeGlzdHMob3duZXIpCiAgICB7CiAgICAgICAgaXNPd25lcltvd25lcl0gPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGggLSAxOyBpKyspCiAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgICAgIG93bmVyc1tpXSA9IG93bmVyc1tvd25lcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIG93bmVycy5sZW5ndGggLT0gMTsKICAgICAgICBpZiAocmVxdWlyZWQgPiBvd25lcnMubGVuZ3RoKQogICAgICAgICAgICBjaGFuZ2VSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoKTsKICAgICAgICBPd25lclJlbW92YWwob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byByZXBsYWNlIGFuIG93bmVyIHdpdGggYSBuZXcgb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lciB0byBiZSByZXBsYWNlZC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBuZXcgb3duZXIuCiAgICBmdW5jdGlvbiByZXBsYWNlT3duZXIoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBuZXdPd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2FsbGV0CiAgICAgICAgb3duZXJFeGlzdHMob3duZXIpCiAgICAgICAgb3duZXJEb2VzTm90RXhpc3QobmV3T3duZXIpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgICAgIG93bmVyc1tpXSA9IG5ld093bmVyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBpc093bmVyW293bmVyXSA9IGZhbHNlOwogICAgICAgIGlzT3duZXJbbmV3T3duZXJdID0gdHJ1ZTsKICAgICAgICBPd25lclJlbW92YWwob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24obmV3T3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byBjaGFuZ2UgdGhlIG51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIGNoYW5nZVJlcXVpcmVtZW50KHVpbnQgX3JlcXVpcmVkKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlXYWxsZXQKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGgsIF9yZXF1aXJlZCkKICAgIHsKICAgICAgICByZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgICAgICBSZXF1aXJlbWVudENoYW5nZShfcmVxdWlyZWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBzdWJtaXQgYW5kIGNvbmZpcm0gYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gZGVzdGluYXRpb24gVHJhbnNhY3Rpb24gdGFyZ2V0IGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRyYW5zYWN0aW9uIGV0aGVyIHZhbHVlLgogICAgLy8vIEBwYXJhbSBkYXRhIFRyYW5zYWN0aW9uIGRhdGEgcGF5bG9hZC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBzdWJtaXRUcmFuc2FjdGlvbihhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICB0cmFuc2FjdGlvbklkID0gYWRkVHJhbnNhY3Rpb24oZGVzdGluYXRpb24sIHZhbHVlLCBkYXRhKTsKICAgICAgICBjb25maXJtVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIGNvbmZpcm0gYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2FjdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJFeGlzdHMobXNnLnNlbmRlcikKICAgICAgICB0cmFuc2FjdGlvbkV4aXN0cyh0cmFuc2FjdGlvbklkKQogICAgICAgIG5vdENvbmZpcm1lZCh0cmFuc2FjdGlvbklkLCBtc2cuc2VuZGVyKQogICAgewogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsKICAgICAgICBleGVjdXRlVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIHJldm9rZSBhIGNvbmZpcm1hdGlvbiBmb3IgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIHJldm9rZUNvbmZpcm1hdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJFeGlzdHMobXNnLnNlbmRlcikKICAgICAgICBjb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgICAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSBmYWxzZTsKICAgICAgICBSZXZvY2F0aW9uKG1zZy5zZW5kZXIsIHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIENvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICBmdW5jdGlvbiBpc0NvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgICAgICBpZiAoY291bnQgPT0gcmVxdWlyZWQpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLy8vIEBkZXYgQWxsb3dzIGFueW9uZSB0byBleGVjdXRlIGEgY29uZmlybWVkIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gZXhlY3V0ZVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgIGludGVybmFsCiAgICAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIGlmIChpc0NvbmZpcm1lZCh0cmFuc2FjdGlvbklkKSkgewogICAgICAgICAgICBUcmFuc2FjdGlvbiB0eCA9IHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXTsKICAgICAgICAgICAgdHguZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAodHguZGVzdGluYXRpb24uY2FsbC52YWx1ZSh0eC52YWx1ZSkodHguZGF0YSkpCiAgICAgICAgICAgICAgICBFeGVjdXRpb24odHJhbnNhY3Rpb25JZCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRXhlY3V0aW9uRmFpbHVyZSh0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhIG5ldyB0cmFuc2FjdGlvbiB0byB0aGUgdHJhbnNhY3Rpb24gbWFwcGluZywgaWYgdHJhbnNhY3Rpb24gZG9lcyBub3QgZXhpc3QgeWV0LgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGFkZFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBub3ROdWxsKGRlc3RpbmF0aW9uKQogICAgICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICB0cmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25Db3VudDsKICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0gPSBUcmFuc2FjdGlvbih7CiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBkZXN0aW5hdGlvbiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICBleGVjdXRlZDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICB0cmFuc2FjdGlvbkNvdW50ICs9IDE7CiAgICAgICAgU3VibWlzc2lvbih0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvKgogICAgICogV2ViMyBjYWxsIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBjb25maXJtYXRpb25zIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBOdW1iZXIgb2YgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbkNvdW50KHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgY291bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWxlcnMgYXJlIGFwcGxpZWQuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBUb3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbHRlcnMgYXJlIGFwcGxpZWQuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkNvdW50KGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgY291bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTx0cmFuc2FjdGlvbkNvdW50OyBpKyspCiAgICAgICAgICAgIGlmICgocGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSB8fAogICAgICAgICAgICAgICAgKGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkpCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiBvd25lcnMuCiAgICAvLy8gQHJldHVybiBMaXN0IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldE93bmVycygpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10pCiAgICB7CiAgICAgICAgcmV0dXJuIG93bmVyczsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGFycmF5IHdpdGggb3duZXIgYWRkcmVzc2VzLCB3aGljaCBjb25maXJtZWQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbnModWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdIF9jb25maXJtYXRpb25zKQogICAgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgY29uZmlybWF0aW9uc1RlbXAgPSBuZXcgYWRkcmVzc1tdKG93bmVycy5sZW5ndGgpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pIHsKICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbnNUZW1wW2NvdW50XSA9IG93bmVyc1tpXTsKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICBfY29uZmlybWF0aW9ucyA9IG5ldyBhZGRyZXNzW10oY291bnQpOwogICAgICAgIGZvciAoaT0wOyBpPGNvdW50OyBpKyspCiAgICAgICAgICAgIF9jb25maXJtYXRpb25zW2ldID0gY29uZmlybWF0aW9uc1RlbXBbaV07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIHRyYW5zYWN0aW9uIElEcyBpbiBkZWZpbmVkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBmcm9tIEluZGV4IHN0YXJ0IHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSB0byBJbmRleCBlbmQgcG9zaXRpb24gb2YgdHJhbnNhY3Rpb24gYXJyYXkuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIHRyYW5zYWN0aW9uIElEcy4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uSWRzKHVpbnQgZnJvbSwgdWludCB0bywgYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludFtdIF90cmFuc2FjdGlvbklkcykKICAgIHsKICAgICAgICB1aW50W10gbWVtb3J5IHRyYW5zYWN0aW9uSWRzVGVtcCA9IG5ldyB1aW50W10odHJhbnNhY3Rpb25Db3VudCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaT0wOyBpPHRyYW5zYWN0aW9uQ291bnQ7IGkrKykKICAgICAgICAgIGlmICgocGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSB8fAogICAgICAgICAgICAgIChleGVjdXRlZCAmJiB0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbklkc1RlbXBbY291bnRdID0gaTsKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICBfdHJhbnNhY3Rpb25JZHMgPSBuZXcgdWludFtdKHRvIC0gZnJvbSk7CiAgICAgICAgZm9yIChpPWZyb207IGk8dG87IGkrKykKICAgICAgICAgICAgX3RyYW5zYWN0aW9uSWRzW2kgLSBmcm9tXSA9IHRyYW5zYWN0aW9uSWRzVGVtcFtpXTsKICAgIH0KfQoKY29udHJhY3QgVXBncmFkZUFnZW50IGlzIFNhZmVNYXRoIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICBib29sIHB1YmxpYyBpc1VwZ3JhZGVBZ2VudDsKICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwogIGZ1bmN0aW9uIHNldE9yaWdpbmFsU3VwcGx5KCkgcHVibGljOwp9CgovLyBAdGl0bGUgQkNEQyBUb2tlbiB2YXVsdCwgbG9ja2VkIHRva2VucyBmb3IgMSBtb250aCAoRGV2IFRlYW0pIGFuZCAxIHllYXIgZm9yIEZvdW5kZXJzCmNvbnRyYWN0IEJDRENWYXVsdCBpcyBTYWZlTWF0aCB7CgogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgaWYgYWRkcmVzcyBpcyBmb3IgYSByZWFsIGNvbnRyYWN0IG9yIG5vdAogICAgYm9vbCBwdWJsaWMgaXNCQ0RDVmF1bHQgPSBmYWxzZTsKCiAgICBCQ0RDVG9rZW4gYmNkY1Rva2VuOwoKICAgIC8vIGFkZHJlc3Mgb2Ygb3VyIHByaXZhdGUgTXVsdGlTaWdXYWxsZXQgY29udHJhY3QKICAgIGFkZHJlc3MgYmNkY011bHRpc2lnOwogICAgLy8gbnVtYmVyIG9mIGJsb2NrIHVubG9jayBmb3IgZGV2ZWxvcGVycwogICAgdWludDI1NiBwdWJsaWMgdW5sb2NrZWRCbG9ja0ZvckRldjsKICAgIC8vIG51bWJlciBvZiBibG9jayB1bmxvY2sgZm9yIGZvdW5kZXJzCiAgICB1aW50MjU2IHB1YmxpYyB1bmxvY2tlZEJsb2NrRm9yRm91bmRlcnM7CiAgICAvLyBJdCBzaG91bGQgYmUgMSAqIDMwIGRheXMgKiAyNCBob3VycyAqIDYwIG1pbnV0ZXMgKiA2MCBzZWNvbmRzIC8gMTcKICAgIC8vIFdlIGNhbiBzZXQgc21hbGwgZm9yIHRlc3RpbmcgcHVycG9zZQogICAgdWludDI1NiBwdWJsaWMgbnVtQmxvY2tzTG9ja2VkRGV2OwogICAgLy8gSXQgc2hvdWxkIGJlIDEyIG1vbnRocyAqIDMwIGRheXMgKiAyNCBob3VycyAqIDYwIG1pbnV0ZXMgKiA2MCBzZWNvbmRzIC8gMTcKICAgIC8vIFdlIGNhbiBzZXQgc21hbGwgZm9yIHRlc3RpbmcgcHVycG9zZQogICAgdWludDI1NiBwdWJsaWMgbnVtQmxvY2tzTG9ja2VkRm91bmRlcnM7CgogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgYWxsIHRoZSB0b2tlbiBmb3IgZGV2ZWxvcGVycyBhbHJlYWR5IHVubG9ja2VkIG9yIG5vdAogICAgYm9vbCBwdWJsaWMgdW5sb2NrZWRBbGxUb2tlbnNGb3JEZXYgPSBmYWxzZTsKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGFsbCB0aGUgdG9rZW4gZm9yIGZvdW5kZXJzIGFscmVhZHkgdW5sb2NrZWQgb3Igbm90CiAgICBib29sIHB1YmxpYyB1bmxvY2tlZEFsbFRva2Vuc0ZvckZvdW5kZXJzID0gZmFsc2U7CgogICAgLy8gQ29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyB0aGUgQkNEQyBNdWx0aXNpZyBhZGRyZXNzIGFuZAogICAgLy8gdG90YWwgbnVtYmVyIG9mIGxvY2tlZCB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIEJDRENWYXVsdChhZGRyZXNzIF9iY2RjTXVsdGlzaWcsdWludDI1NiBfbnVtQmxvY2tzTG9ja2VkRm9yRGV2LHVpbnQyNTYgX251bUJsb2Nrc0xvY2tlZEZvckZvdW5kZXJzKSB7CiAgICAgICAgLy8gSWYgaXQncyBub3QgYmNkY011bHRpc2lnIGFkZHJlc3MgdGhlbiB0aHJvdwogICAgICAgIGlmIChfYmNkY011bHRpc2lnID09IDB4MCkgdGhyb3c7CiAgICAgICAgLy8gSW5pdGFsaXplZCBiY2RjVG9rZW4KICAgICAgICBiY2RjVG9rZW4gPSBCQ0RDVG9rZW4obXNnLnNlbmRlcik7CiAgICAgICAgLy8gSW5pdGFsaXplZCBiY2RjTXVsdGlzaWcgYWRkcmVzcwogICAgICAgIGJjZGNNdWx0aXNpZyA9IF9iY2RjTXVsdGlzaWc7CiAgICAgICAgLy8gTWFyayBpdCBhcyBCQ0RDVmF1bHQKICAgICAgICBpc0JDRENWYXVsdCA9IHRydWU7CiAgICAgICAgLy9Jbml0YWxpemVkIG51bUJsb2Nrc0xvY2tlZERldiBhbmQgbnVtQmxvY2tzTG9ja2VkRm91bmRlcnMgd2l0aCBibG9jayBudW1iZXIKICAgICAgICBudW1CbG9ja3NMb2NrZWREZXYgPSBfbnVtQmxvY2tzTG9ja2VkRm9yRGV2OwogICAgICAgIG51bUJsb2Nrc0xvY2tlZEZvdW5kZXJzID0gX251bUJsb2Nrc0xvY2tlZEZvckZvdW5kZXJzOwogICAgICAgIC8vIEluaXRhbGl6ZWQgdW5sb2NrZWRCbG9ja0ZvckRldiB3aXRoIGJsb2NrIG51bWJlcgogICAgICAgIC8vIGFjY29yZGluZyB0byBjdXJyZW50IGJsb2NrCiAgICAgICAgdW5sb2NrZWRCbG9ja0ZvckRldiA9IHNhZmVBZGQoYmxvY2subnVtYmVyLCBudW1CbG9ja3NMb2NrZWREZXYpOyAvLyAzMCBkYXlzIG9mIGJsb2NrcyBsYXRlcgogICAgICAgIC8vIEluaXRhbGl6ZWQgdW5sb2NrZWRCbG9ja0ZvckZvdW5kZXJzIHdpdGggYmxvY2sgbnVtYmVyCiAgICAgICAgLy8gYWNjb3JkaW5nIHRvIGN1cnJlbnQgYmxvY2sKICAgICAgICB1bmxvY2tlZEJsb2NrRm9yRm91bmRlcnMgPSBzYWZlQWRkKGJsb2NrLm51bWJlciwgbnVtQmxvY2tzTG9ja2VkRm91bmRlcnMpOyAvLyAzNjUgZGF5cyBvZiBibG9ja3MgbGF0ZXIKICAgIH0KCiAgICAvLyBUcmFuc2ZlciBEZXZlbG9wbWVudCBUZWFtIFRva2VucyBUbyBNdWx0aVNpZ1dhbGxldCAtIDMwIERheXMgTG9ja2VkCiAgICBmdW5jdGlvbiB1bmxvY2tGb3JEZXZlbG9wbWVudCgpIGV4dGVybmFsIHsKICAgICAgICAvLyBJZiBpdCBoYXMgbm90IHJlYWNoZWQgMzAgZGF5cyBtYXJrIGRvIG5vdCB0cmFuc2ZlcgogICAgICAgIGlmIChibG9jay5udW1iZXIgPCB1bmxvY2tlZEJsb2NrRm9yRGV2KSB0aHJvdzsKICAgICAgICAvLyBJZiBpdCBpcyBhbHJlYWR5IHVubG9ja2VkIHRoZW4gZG8gbm90IGFsbG93ZWQKICAgICAgICBpZiAodW5sb2NrZWRBbGxUb2tlbnNGb3JEZXYpIHRocm93OwogICAgICAgIC8vIE1hcmsgaXQgYXMgdW5sb2NrZWQKICAgICAgICB1bmxvY2tlZEFsbFRva2Vuc0ZvckRldiA9IHRydWU7CiAgICAgICAgLy8gV2lsbCBmYWlsIGlmIGFsbG9jYXRpb24gKGFuZCB0aGVyZWZvcmUgdG9UcmFuc2ZlcikgaXMgMC4KICAgICAgICB1aW50MjU2IHRvdGFsQmFsYW5jZSA9IGJjZGNUb2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgLy8gdHJhbnNmZXIgaGFsZiBvZiB0b2tlbiB0byBkZXZlbG9wbWVudCB0ZWFtCiAgICAgICAgdWludDI1NiBkZXZlbG9wbWVudFRva2VucyA9IHNhZmVEaXYoc2FmZU11bCh0b3RhbEJhbGFuY2UsIDUwKSwgMTAwKTsKICAgICAgICBpZiAoIWJjZGNUb2tlbi50cmFuc2ZlcihiY2RjTXVsdGlzaWcsIGRldmVsb3BtZW50VG9rZW5zKSkgdGhyb3c7CiAgICB9CgogICAgLy8gIFRyYW5zZmVyIEZvdW5kZXJzIFRlYW0gVG9rZW5zIFRvIE11bHRpU2lnV2FsbGV0IC0gMzY1IERheXMgTG9ja2VkCiAgICBmdW5jdGlvbiB1bmxvY2tGb3JGb3VuZGVycygpIGV4dGVybmFsIHsKICAgICAgICAvLyBJZiBpdCBoYXMgbm90IHJlYWNoZWQgMzY1IGRheXMgbWFyayBkbyBub3QgdHJhbnNmZXIKICAgICAgICBpZiAoYmxvY2subnVtYmVyIDwgdW5sb2NrZWRCbG9ja0ZvckZvdW5kZXJzKSB0aHJvdzsKICAgICAgICAvLyBJZiBpdCBpcyBhbHJlYWR5IHVubG9ja2VkIHRoZW4gZG8gbm90IGFsbG93ZWQKICAgICAgICBpZiAodW5sb2NrZWRBbGxUb2tlbnNGb3JGb3VuZGVycykgdGhyb3c7CiAgICAgICAgLy8gTWFyayBpdCBhcyB1bmxvY2tlZAogICAgICAgIHVubG9ja2VkQWxsVG9rZW5zRm9yRm91bmRlcnMgPSB0cnVlOwogICAgICAgIC8vIFdpbGwgZmFpbCBpZiBhbGxvY2F0aW9uIChhbmQgdGhlcmVmb3JlIHRvVHJhbnNmZXIpIGlzIDAuCiAgICAgICAgaWYgKCFiY2RjVG9rZW4udHJhbnNmZXIoYmNkY011bHRpc2lnLCBiY2RjVG9rZW4uYmFsYW5jZU9mKHRoaXMpKSkgdGhyb3c7CiAgICAgICAgLy8gU28gdGhhdCBldGhlciB3aWxsIG5vdCBiZSB0cmFwcGVkIGhlcmUuCiAgICAgICAgaWYgKCFiY2RjTXVsdGlzaWcuc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsKICAgIH0KCiAgICAvLyBkaXNhbGxvdyBwYXltZW50IGFmdGVyIHVubG9jayBibG9jawogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA+PSB1bmxvY2tlZEJsb2NrRm9yRm91bmRlcnMpIHRocm93OwogICAgfQoKfQoKLy8gQHRpdGxlIEJDREMgVG9rZW4gQ29udHJhY3Qgd2l0aCBUb2tlbiBTYWxlIEZ1bmN0aW9uYWxpdHkgYXMgd2VsbApjb250cmFjdCBCQ0RDVG9rZW4gaXMgU2FmZU1hdGgsIEVSQzIwIHsKCiAgICAvLyBmbGFnIHRvIGRldGVybWluZSBpZiBhZGRyZXNzIGlzIGZvciBhIHJlYWwgY29udHJhY3Qgb3Igbm90CiAgICBib29sIHB1YmxpYyBpc0JDRENUb2tlbiA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgdXBncmFkZUFnZW50U3RhdHVzID0gZmFsc2U7CiAgICAvLyBBZGRyZXNzIG9mIE93bmVyIGZvciB0aGlzIENvbnRyYWN0CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICAvLyBEZWZpbmUgdGhlIGN1cnJlbnQgc3RhdGUgb2YgY3Jvd2RzYWxlCiAgICBlbnVtIFN0YXRle1ByZUZ1bmRpbmcsIEZ1bmRpbmcsIFN1Y2Nlc3MsIEZhaWx1cmV9CgogICAgLy8gVG9rZW4gcmVsYXRlZCBpbmZvcm1hdGlvbgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkJDREMgVG9rZW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQkNEQyI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OyAgLy8gZGVjaW1hbCBwbGFjZXMKCiAgICAvLyBNYXBwaW5nIG9mIHRva2VuIGJhbGFuY2UgYW5kIGFsbG93ZWQgYWRkcmVzcyBmb3IgZWFjaCBhZGRyZXNzIHdpdGggdHJhbnNmZXIgbGltaXQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICAvLyBUaGlzIGlzIG9ubHkgZm9yIHJlZnVuZCBwdXJwb3NlLCBhcyB3ZSBoYXZlIHByaWNlIHJhbmdlIGR1cmluZyBkaWZmZXJlbnQgd2Vla3Mgb2YgQ3Jvd2RmdW5kaW5nLAogICAgLy8gIG5lZWQgdG8gbWFpbnRhaW4gdG90YWwgaW52ZXN0bWVudCBkb25lIHNvIHJlZnVuZCB3b3VsZCBiZSBleGFjdGx5IHNhbWUuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGludmVzdG1lbnQ7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gQ3Jvd2RzYWxlIGluZm9ybWF0aW9uCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWRDcm93ZGZ1bmRpbmcgPSBmYWxzZTsKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlzIHBlcmFsbG9jYXRpb24gZG9uZSBvciBub3QKICAgIGJvb2wgcHVibGljIHByZWFsbG9jYXRlZCA9IGZhbHNlOwogICAgdWludDI1NiBwdWJsaWMgZnVuZGluZ1N0YXJ0QmxvY2s7IC8vIGNyb3dkc2FsZSBzdGFydCBibG9jawogICAgdWludDI1NiBwdWJsaWMgZnVuZGluZ0VuZEJsb2NrOyAvLyBjcm93ZHNhbGUgZW5kIGJsb2NrCiAgICAvLyBjaGFuZ2UgcHJpY2Ugb2YgdG9rZW4gd2hlbiBjdXJyZW50IGJsb2NrIHJlYWNoZWQKCiAgICAvLyBNYXhpbXVtIFRva2VuIFNhbGUgKENyb3dkc2FsZSArIEVhcmx5IFNhbGUgKyBTdXBwb3J0ZXJzKQogICAgLy8gQXBwcm94aW1hdGUgMjUwIG1pbGxpb25zIElUUyArIDEyNSBtaWxsaW9ucyBmb3IgZWFybHkgaW52ZXN0b3JzICsgNzUgTWlsbGlvbnMgdG8gU3VwcG9ydHMKICAgIHVpbnQyNTYgcHVibGljIHRva2VuU2FsZU1heDsKICAgIC8vIE1pbiB0b2tlbnMgbmVlZHMgdG8gYmUgc29sZCBvdXQgZm9yIHN1Y2Nlc3MKICAgIC8vIEFwcHJveGltYXRlIDEvNCBvZiAyNTAgbWlsbGlvbnMKICAgIHVpbnQyNTYgcHVibGljIHRva2VuU2FsZU1pbjsKICAgIC8vMSBCaWxsaW9uIEJDREMgVG9rZW5zCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtYXhUb2tlblN1cHBseSA9IDEwMDAwMDAwMDAgZXRoZXI7CiAgICAvLyBUZWFtIHRva2VuIHBlcmNlbnRhZ2VzIHRvIHN0b3JlIGluIHRpbWUgdmF1bHQKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHZhdWx0UGVyY2VudE9mVG90YWwgPSA1OwogICAgLy8gUHJvamVjdCBSZXNlcnZlZCBGdW5kIFRva2VuICUKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHJlc2VydmVkUGVyY2VudFRvdGFsID0gMjU7CgogICAgLy8gTXVsdGlzaWcgV2FsbGV0IEFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIGJjZGNNdWx0aXNpZzsKICAgIC8vIFByb2plY3QgUmVzZXJ2ZSBGdW5kIGFkZHJlc3MKICAgIGFkZHJlc3MgYmNkY1Jlc2VydmVGdW5kOwogICAgLy8gQkNEQydzIHRpbWUtbG9ja2VkIHZhdWx0CiAgICBCQ0RDVmF1bHQgcHVibGljIHRpbWVWYXVsdDsKCiAgICAvLyBFdmVudHMgZm9yIHJlZnVuZCBwcm9jZXNzCiAgICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBVcGdyYWRlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgVXBncmFkZUZpbmFsaXplZChhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyB1cGdyYWRlQWdlbnQpOwogICAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwogICAgLy8gQkNEQzpFVEggZXhjaGFuZ2UgcmF0ZQogICAgdWludDI1NiB0b2tlbnNQZXJFdGhlcjsKCiAgICAvLyBAZGV2IFRvIEhhbHQgaW4gRW1lcmdlbmN5IENvbmRpdGlvbgogICAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICAgIGJvb2wgcHVibGljIGZpbmFsaXplZFVwZ3JhZGUgPSBmYWxzZTsKICAgIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CiAgICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgoKICAgIC8vIENvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgZm9sbG93aW5nCiAgICAvLyBAcGFyYW0gYmNkY011bHRpc2lnIGFkZHJlc3Mgb2YgYmNkY011bHRpc2lnV2FsbGV0CiAgICAvLyBAcGFyYW0gZnVuZGluZ1N0YXJ0QmxvY2sgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGZ1bmRpbmcgd2lsbCBzdGFydAogICAgLy8gQHBhcmFtIGZ1bmRpbmdFbmRCbG9jayBibG9jayBudW1iZXIgYXQgd2hpY2ggZnVuZGluZyB3aWxsIGVuZAogICAgLy8gQHBhcmFtIHRva2VuU2FsZU1heCBtYXhpbXVtIG51bWJlciBvZiB0b2tlbiB0byBzYWxlCiAgICAvLyBAcGFyYW0gdG9rZW5TYWxlTWluIG1pbmltdW0gbnVtYmVyIG9mIHRva2VuIHRvIHNhbGUKICAgIC8vIEBwYXJhbSB0b2tlbnNQZXJFdGhlciBudW1iZXIgb2YgdG9rZW4gdG8gc2FsZSBwZXIgZXRoZXIKICAgIGZ1bmN0aW9uIEJDRENUb2tlbihhZGRyZXNzIF9iY2RjTXVsdGlTaWcsCiAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF91cGdyYWRlTWFzdGVyLAogICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfZnVuZGluZ1N0YXJ0QmxvY2ssCiAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9mdW5kaW5nRW5kQmxvY2ssCiAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF90b2tlblNhbGVNYXgsCiAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF90b2tlblNhbGVNaW4sCiAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF90b2tlbnNQZXJFdGhlciwKICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX251bUJsb2Nrc0xvY2tlZEZvckRldiwKICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX251bUJsb2Nrc0xvY2tlZEZvckZvdW5kZXJzKSB7CiAgICAgICAgLy8gSXMgbm90IGJjZGNNdWx0aXNpZyBhZGRyZXNzIGNvcnJlY3QgdGhlbiB0aHJvdwogICAgICAgIGlmIChfYmNkY011bHRpU2lnID09IDApIHRocm93OwogICAgICAgIC8vIElzIGZ1bmRpbmcgYWxyZWFkeSBzdGFydGVkIHRoZW4gdGhyb3cKICAgICAgICBpZiAoX3VwZ3JhZGVNYXN0ZXIgPT0gMCkgdGhyb3c7CgogICAgICAgIGlmIChfZnVuZGluZ1N0YXJ0QmxvY2sgPD0gYmxvY2subnVtYmVyKSB0aHJvdzsKICAgICAgICAvLyBJZiBmdW5kaW5nRW5kQmxvY2sgb3IgZnVuZGluZ1N0YXJ0QmxvY2sgdmFsdWUgaXMgbm90IGNvcnJlY3QgdGhlbiB0aHJvdwogICAgICAgIGlmIChfZnVuZGluZ0VuZEJsb2NrICAgPD0gX2Z1bmRpbmdTdGFydEJsb2NrKSB0aHJvdzsKICAgICAgICAvLyBJZiB0b2tlblNhbGVNYXggb3IgdG9rZW5TYWxlTWluIHZhbHVlIGlzIG5vdCBjb3JyZWN0IHRoZW4gdGhyb3cKICAgICAgICBpZiAoX3Rva2VuU2FsZU1heCA8PSBfdG9rZW5TYWxlTWluKSB0aHJvdzsKICAgICAgICAvLyBJZiB0b2tlbnNQZXJFdGhlciB2YWx1ZSBpcyAwIHRoZW4gdGhyb3cKICAgICAgICBpZiAoX3Rva2Vuc1BlckV0aGVyID09IDApIHRocm93OwogICAgICAgIC8vIE1hcmsgaXQgaXMgQkNEQ1Rva2VuCiAgICAgICAgaXNCQ0RDVG9rZW4gPSB0cnVlOwogICAgICAgIC8vIEluaXRhbGl6ZWQgYWxsIHBhcmFtCiAgICAgICAgdXBncmFkZU1hc3RlciA9IF91cGdyYWRlTWFzdGVyOwogICAgICAgIGZ1bmRpbmdTdGFydEJsb2NrID0gX2Z1bmRpbmdTdGFydEJsb2NrOwogICAgICAgIGZ1bmRpbmdFbmRCbG9jayA9IF9mdW5kaW5nRW5kQmxvY2s7CiAgICAgICAgdG9rZW5TYWxlTWF4ID0gX3Rva2VuU2FsZU1heDsKICAgICAgICB0b2tlblNhbGVNaW4gPSBfdG9rZW5TYWxlTWluOwogICAgICAgIHRva2Vuc1BlckV0aGVyID0gX3Rva2Vuc1BlckV0aGVyOwogICAgICAgIC8vIEluaXRhbGl6ZWQgdGltZVZhdWx0IGFzIEJDRENWYXVsdAogICAgICAgIHRpbWVWYXVsdCA9IG5ldyBCQ0RDVmF1bHQoX2JjZGNNdWx0aVNpZyxfbnVtQmxvY2tzTG9ja2VkRm9yRGV2LF9udW1CbG9ja3NMb2NrZWRGb3JGb3VuZGVycyk7CiAgICAgICAgLy8gSWYgdGltZVZhdWx0IGlzIG5vdCBCQ0RDVmF1bHQgdGhlbiB0aHJvdwogICAgICAgIGlmICghdGltZVZhdWx0LmlzQkNEQ1ZhdWx0KCkpIHRocm93OwogICAgICAgIC8vIEluaXRhbGl6ZWQgYmNkY011bHRpc2lnIGFkZHJlc3MKICAgICAgICBiY2RjTXVsdGlzaWcgPSBfYmNkY011bHRpU2lnOwogICAgICAgIC8vIEluaXRhbGl6ZWQgb3duZXIKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgLy8gTXVsdGlTaWdXYWxsZXQgaXMgbm90IGJjZGNNdWx0aXNpZyB0aGVuIHRocm93CiAgICAgICAgaWYgKCFNdWx0aVNpZ1dhbGxldChiY2RjTXVsdGlzaWcpLmlzTXVsdGlTaWdXYWxsZXQoKSkgdGhyb3c7CiAgICB9CiAgICAvLyBPd25lcnNoaXAgcmVsYXRlZCBtb2RpZmVyIGFuZCBmdW5jdGlvbnMKICAgIC8vIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lcgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgewogICAgICAgIHRocm93OwogICAgICB9CiAgICAgIF87CiAgICB9CgogICAgLy8gQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgIC8vIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgIH0KICAgIH0KCiAgICAvLyBAcGFyYW0gX2JjZGNSZXNlcnZlRnVuZCBFdGhlciBBZGRyZXNzIGZvciBQcm9qZWN0IFJlc2VydmUgRnVuZAogICAgLy8gVGhpcyBoYXMgdG8gYmUgY2FsbGVkIGJlZm9yZSBwcmVBbGxvY2F0aW9uCiAgICAvLyBPbmx5IHRvIGJlIGNhbGxlZCBieSBPd25lciBvZiB0aGlzIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRCY2RjUmVzZXJ2ZUZ1bmQoYWRkcmVzcyBfYmNkY1Jlc2VydmVGdW5kKSBvbmx5T3duZXJ7CiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuUHJlRnVuZGluZykgdGhyb3c7CiAgICAgICAgaWYgKHByZWFsbG9jYXRlZCkgdGhyb3c7IC8vIEhhcyB0byBiZSBkb25lIGJlZm9yZSBwcmVhbGxvY2F0aW9uCiAgICAgICAgaWYgKF9iY2RjUmVzZXJ2ZUZ1bmQgPT0gMHgwKSB0aHJvdzsKICAgICAgICBiY2RjUmVzZXJ2ZUZ1bmQgPSBfYmNkY1Jlc2VydmVGdW5kOwogICAgfQoKICAgIC8vIEBwYXJhbSB3aG8gVGhlIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yIHRvIGNoZWNrIGJhbGFuY2UKICAgIC8vIEByZXR1cm4gYmFsYW5jZSB0b2tlbnMgb2YgaW52ZXN0b3IgYWRkcmVzcwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW3dob107CiAgICB9CgogICAgLy8gQHBhcmFtIHdobyBUaGUgYWRkcmVzcyBvZiB0aGUgaW52ZXN0b3IgdG8gY2hlY2sgaW52ZXN0bWVudCBhbW91bnQKICAgIC8vIEByZXR1cm4gdG90YWwgaW52ZXN0bWVudCBkb25lIGJ5IGV0aGVyZXVtIGFkZHJlc3MKICAgIC8vIFRoaXMgbWV0aG9kIGlzIG9ubHkgdXNhYmxlIHVwIHRvIENyb3dkZnVuZGluZyBlbmRzIChTdWNjZXNzIG9yIEZhaWwpCiAgICAvLyBTbyBpZiB0b2tlbnMgYXJlIHRyYW5zZmVyZWQgcG9zdCBjcm93ZHNhbGUgaW52ZXN0bWVudCB3aWxsIG5vdCBjaGFuZ2UuCiAgICBmdW5jdGlvbiBjaGVja0ludmVzdG1lbnQoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW52ZXN0bWVudFt3aG9dOwogICAgfQoKICAgIC8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLyBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhbGxvd2VkW293bmVyXVtzcGVuZGVyXTsKICAgIH0KCiAgICAvLyAgVHJhbnNmZXIgYHZhbHVlYCBCQ0RDIHRva2VucyBmcm9tIHNlbmRlcidzIGFjY291bnQKICAgIC8vIGBtc2cuc2VuZGVyYCB0byBwcm92aWRlZCBhY2NvdW50IGFkZHJlc3MgYHRvYC4KICAgIC8vIEBkZXYgUmVxdWlyZWQgc3RhdGU6IFN1Y2Nlc3MKICAgIC8vIEBwYXJhbSB0byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLyBAcGFyYW0gdmFsdWUgVGhlIG51bWJlciBvZiBCQ0RDIHRva2VucyB0byB0cmFuc2ZlcgogICAgLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIHsKICAgICAgICBpZiAoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5TdWNjZXNzKSB0aHJvdzsgLy8gQWJvcnQgaWYgY3Jvd2RmdW5kaW5nIHdhcyBub3QgYSBzdWNjZXNzLgogICAgICAgIHVpbnQyNTYgc2VuZGVyQmFsYW5jZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIGlmICggc2VuZGVyQmFsYW5jZSA+PSB2YWx1ZSAmJiB2YWx1ZSA+IDApIHsKICAgICAgICAgICAgc2VuZGVyQmFsYW5jZSA9IHNhZmVTdWIoc2VuZGVyQmFsYW5jZSwgdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNlbmRlckJhbGFuY2U7CiAgICAgICAgICAgIGJhbGFuY2VzW3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbdG9dLCB2YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gIFRyYW5zZmVyIGB2YWx1ZWAgQkNEQyB0b2tlbnMgZnJvbSBzZW5kZXIgJ2Zyb20nCiAgICAvLyB0byBwcm92aWRlZCBhY2NvdW50IGFkZHJlc3MgYHRvYC4KICAgIC8vIEBkZXYgUmVxdWlyZWQgc3RhdGU6IFN1Y2Nlc3MKICAgIC8vIEBwYXJhbSBmcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vIEBwYXJhbSB0byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLyBAcGFyYW0gdmFsdWUgVGhlIG51bWJlciBvZiBCQ0RDIHRvIHRyYW5zZmVyCiAgICAvLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLlN1Y2Nlc3MpIHRocm93OyAvLyBBYm9ydCBpZiBjcm93ZGZ1bmRpbmcgd2FzIG5vdCBhIHN1Y2Nlc3MuCiAgICAgICAgaWYgKGJhbGFuY2VzW2Zyb21dID49IHZhbHVlICYmCiAgICAgICAgICAgIGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gPj0gdmFsdWUgJiYKICAgICAgICAgICAgdmFsdWUgPiAwKQogICAgICAgIHsKICAgICAgICAgICAgYmFsYW5jZXNbdG9dID0gc2FmZUFkZChiYWxhbmNlc1t0b10sIHZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW2Zyb21dLCB2YWx1ZSk7CiAgICAgICAgICAgIGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0sIHZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB9CgogICAgLy8gIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgc3BlbmRlcmAgdG8gc3BlbmQgYHZhbHVlYCB0b2tlbnMKICAgIC8vIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8gQHBhcmFtIHZhbHVlIFRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKSB7CiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuU3VjY2VzcykgdGhyb3c7IC8vIEFib3J0IGlmIG5vdCBpbiBTdWNjZXNzIHN0YXRlLgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gU2FsZSBvZiB0aGUgdG9rZW5zLiBJbnZlc3RvcnMgY2FuIGNhbGwgdGhpcyBtZXRob2QgdG8gaW52ZXN0IGludG8gQkNEQyBUb2tlbnMKICAgIC8vIE9ubHkgd2hlbiBpdCdzIGluIGZ1bmRpbmcgbW9kZS4gSW4gY2FzZSBvZiBlbWVyZ2VjeSBpdCB3aWxsIGJlIGhhbHRlZC4KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBzdG9wSWZIYWx0ZWQgZXh0ZXJuYWwgewogICAgICAgIC8vIEFsbG93IG9ubHkgdG8gaW52ZXN0IGluIGZ1bmRpbmcgc3RhdGUKICAgICAgICBpZiAoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5GdW5kaW5nKSB0aHJvdzsKCiAgICAgICAgLy8gU29ycnkgISEgV2UgZG8gbm90IGFsbG93IHRvIGludmVzdCB3aXRoIDAgYXMgdmFsdWUKICAgICAgICBpZiAobXNnLnZhbHVlID09IDApIHRocm93OwoKICAgICAgICAvLyBtdWx0aXBseSBieSBleGNoYW5nZSByYXRlIHRvIGdldCBuZXdseSBjcmVhdGVkIHRva2VuIGFtb3VudAogICAgICAgIHVpbnQyNTYgY3JlYXRlZFRva2VucyA9IHNhZmVNdWwobXNnLnZhbHVlLCB0b2tlbnNQZXJFdGhlcik7CgogICAgICAgIC8vIFdhaXQgd2UgY3Jvc3NlZCBtYXhpbXVtIHRva2VuIHNhbGUgZ29hbC4gSXQncyBzdWNjZXNzZnVsIHRva2VuIHNhbGUgISEKICAgICAgICBpZiAoc2FmZUFkZChjcmVhdGVkVG9rZW5zLCB0b3RhbFN1cHBseSkgPiB0b2tlblNhbGVNYXgpIHRocm93OwoKICAgICAgICAvLyBDYWxsIHRvIEludGVybmFsIGZ1bmN0aW9uIHRvIGFzc2lnbiB0b2tlbnMKICAgICAgICBhc3NpZ25Ub2tlbnMobXNnLnNlbmRlciwgY3JlYXRlZFRva2Vucyk7CgogICAgICAgIC8vIFRyYWNrIHRoZSBpbnZlc3RtZW50IGZvciBlYWNoIGFkZHJlc3MgdGlsbCBjcm93ZHNhbGUgZW5kcwogICAgICAgIGludmVzdG1lbnRbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGludmVzdG1lbnRbbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8gVG8gYWxsb2NhdGUgdG9rZW5zIHRvIFByb2plY3QgRnVuZCAtIGVnLiBSZWN5Y2xlVG9Db2luIGJlZm9yZSBUb2tlbiBTYWxlCiAgICAvLyBUb2tlbnMgYWxsb2NhdGVkIHRvIHRoZXNlIHdpbGwgbm90IGJlIGNvdW50IGluIHRvdGFsU3VwcGx5IHRpbGwgdGhlIFRva2VuIFNhbGUgU3VjY2VzcyBhbmQgRmluYWxpemVkIGluIGZpbmFsaXplQ3Jvd2RmdW5kaW5nKCkKICAgIGZ1bmN0aW9uIHByZUFsbG9jYXRpb24oKSBvbmx5T3duZXIgc3RvcElmSGFsdGVkIGV4dGVybmFsIHsKICAgICAgICAvLyBBbGxvdyBvbmx5IGluIFByZSBGdW5kaW5nIE1vZGUKICAgICAgICBpZiAoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5QcmVGdW5kaW5nKSB0aHJvdzsKICAgICAgICAvLyBDaGVjayBpZiBCQ0RDIFJlc2VydmUgRnVuZCBpcyBzZXQgb3Igbm90CiAgICAgICAgaWYgKGJjZGNSZXNlcnZlRnVuZCA9PSAweDApIHRocm93OwogICAgICAgIC8vIFRvIHByZXZlbnQgbXVsdGlwbGUgY2FsbCBieSBtaXN0YWtlCiAgICAgICAgaWYgKHByZWFsbG9jYXRlZCkgdGhyb3c7CiAgICAgICAgcHJlYWxsb2NhdGVkID0gdHJ1ZTsKICAgICAgICAvLyAyNSUgb2Ygb3ZlcmFsbCBUb2tlbiBTdXBwbHkgdG8gcHJvamVjdCByZXNldmUgZnVuZAogICAgICAgIHVpbnQyNTYgcHJvamVjdFRva2VucyA9IHNhZmVEaXYoc2FmZU11bChtYXhUb2tlblN1cHBseSwgcmVzZXJ2ZWRQZXJjZW50VG90YWwpLCAxMDApOwogICAgICAgIC8vIEF0IHRoaXMgdGltZSB3ZSB3aWxsIG5vdCBhZGQgdG8gdG90YWxTdXBwbHkgYmVjYXVzZSB0aGVzZSBhcmUgbm90IHBhcnQgb2YgU2FsZQogICAgICAgIC8vIEl0IHdpbGwgYmUgYWRkZWQgaW4gdG90YWxTdXBwbHkgb25jZSB0aGUgVG9rZW4gU2FsZSBpcyBGaW5hbGl6ZWQKICAgICAgICBiYWxhbmNlc1tiY2RjUmVzZXJ2ZUZ1bmRdID0gcHJvamVjdFRva2VuczsKICAgICAgICAvLyBMb2cgdGhlIGV2ZW50CiAgICAgICAgVHJhbnNmZXIoMCwgYmNkY1Jlc2VydmVGdW5kLCBwcm9qZWN0VG9rZW5zKTsKICAgIH0KCiAgICAvLyBCQ0RDIGFjY2VwdHMgRWFybHkgSW52ZXN0bWVudCB0aHJvdWdoIG1hbnVhbCBwcm9jZXNzIGluIEZpYXQgQ3VycmVuY3kKICAgIC8vIEJDREMgVGVhbSB3aWxsIGFzc2lnbiB0aGUgdG9rZW5zIHRvIGludmVzdG9ycyBtYW51YWxseSB0aHJvdWdoIHRoaXMgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIGVhcmx5SW52ZXN0bWVudChhZGRyZXNzIGVhcmx5SW52ZXN0b3IsIHVpbnQyNTYgYXNzaWduZWRUb2tlbnMpIG9ubHlPd25lciBzdG9wSWZIYWx0ZWQgZXh0ZXJuYWwgewogICAgICAgIC8vIEFsbG93IG9ubHkgaW4gUHJlIEZ1bmRpbmcgTW9kZSBBbmQgRnVuZGluZyBNb2RlCiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuUHJlRnVuZGluZyAmJiBnZXRTdGF0ZSgpICE9IFN0YXRlLkZ1bmRpbmcpIHRocm93OwogICAgICAgIC8vIENoZWNrIGlmIGVhcmx5SW52ZXN0b3IgYWRkcmVzcyBpcyBzZXQgb3Igbm90CiAgICAgICAgaWYgKGVhcmx5SW52ZXN0b3IgPT0gMHgwKSB0aHJvdzsKICAgICAgICAvLyBCeSBtaXN0YWtlIHRva2VucyBtZW50aW9uZWQgYXMgMCwgc2F2ZSB0aGUgY29zdCBvZiBhc3NpZ25pbmcgdG9rZW5zLgogICAgICAgIGlmIChhc3NpZ25lZFRva2VucyA9PSAwICkgdGhyb3c7CgogICAgICAgIC8vIENhbGwgdG8gSW50ZXJuYWwgZnVuY3Rpb24gdG8gYXNzaWduIHRva2VucwogICAgICAgIGFzc2lnblRva2VucyhlYXJseUludmVzdG9yLCBhc3NpZ25lZFRva2Vucyk7CgogICAgICAgIC8vIFRyYWNrIHRoZSBpbnZlc3RtZW50IGZvciBlYWNoIGFkZHJlc3MKICAgICAgICAvLyBSZWZ1bmQgZm9yIHRoaXMgaW52ZXN0b3IgaXMgdGFrZW4gY2FyZSBieSBvdXQgc2lkZSB0aGUgY29udHJhY3QuYmVjYXVzZSB0aGV5IGFyZSBpbnZlc3RpbmcgaW4gdGhlaXIgZmlhdCBjdXJyZW5jeQogICAgICAgIC8vaW52ZXN0bWVudFtlYXJseUludmVzdG9yXSA9IHNhZmVBZGQoaW52ZXN0bWVudFtlYXJseUludmVzdG9yXSwgZXRoZXJWYWx1ZSk7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gd2lsbCB0cmFuc2ZlciB0aGUgdG9rZW5zIHRvIGludmVzdG9yJ3MgYWRkcmVzcwogICAgLy8gQ29tbW9uIGZ1bmN0aW9uIGNvZGUgZm9yIEVhcmx5IEludmVzdG9yIGFuZCBDcm93ZHNhbGUgSW52ZXN0b3IKICAgIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIGludmVzdG9yLCB1aW50MjU2IHRva2VucykgaW50ZXJuYWwgewogICAgICAgIC8vIENyZWF0aW5nIHRva2VucyBhbmQgIGluY3JlYXNpbmcgdGhlIHRvdGFsU3VwcGx5CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCB0b2tlbnMpOwoKICAgICAgICAvLyBBc3NpZ24gbmV3IHRva2VucyB0byB0aGUgc2VuZGVyCiAgICAgICAgYmFsYW5jZXNbaW52ZXN0b3JdID0gc2FmZUFkZChiYWxhbmNlc1tpbnZlc3Rvcl0sIHRva2Vucyk7CgogICAgICAgIC8vIEZpbmFsbHkgdG9rZW4gY3JlYXRlZCBmb3Igc2VuZGVyLCBsb2cgdGhlIGNyZWF0aW9uIGV2ZW50CiAgICAgICAgVHJhbnNmZXIoMCwgaW52ZXN0b3IsIHRva2Vucyk7CiAgICB9CgogICAgLy8gRmluYWxpemUgY3Jvd2RmdW5kaW5nCiAgICAvLyBGaW5hbGx5IC0gVHJhbnNmZXIgdGhlIEV0aGVyIHRvIE11bHRpc2lnIFdhbGxldAogICAgZnVuY3Rpb24gZmluYWxpemVDcm93ZGZ1bmRpbmcoKSBzdG9wSWZIYWx0ZWQgZXh0ZXJuYWwgewogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBGdW5kaW5nIFN1Y2Nlc3Mgc3RhdGUuCiAgICAgICAgaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuU3VjY2VzcykgdGhyb3c7IC8vIGRvbid0IGZpbmFsaXplIHVubGVzcyB3ZSB3b24KICAgICAgICBpZiAoZmluYWxpemVkQ3Jvd2RmdW5kaW5nKSB0aHJvdzsgLy8gY2FuJ3QgZmluYWxpemUgdHdpY2UgKHNvIHNuZWFreSEpCgogICAgICAgIC8vIHByZXZlbnQgbW9yZSBjcmVhdGlvbiBvZiB0b2tlbnMKICAgICAgICBmaW5hbGl6ZWRDcm93ZGZ1bmRpbmcgPSB0cnVlOwoKICAgICAgICAvLyBDaGVjayBpZiBVbnNvbGQgdG9rZW5zIG91dCA0NTAgbWlsbGlvbnMKICAgICAgICAvLyAyNTAgTWlsbGlvbnMgU2FsZSArIDEyNSBNaWxsaW9ucyBmb3IgRWFybHkgSW52ZXN0b3JzICsgNzUgTWlsbGlvbnMgZm9yIFN1cHBvcnRlcnMKICAgICAgICB1aW50MjU2IHVuc29sZFRva2VucyA9IHNhZmVTdWIodG9rZW5TYWxlTWF4LCB0b3RhbFN1cHBseSk7CgogICAgICAgIC8vIEZvdW5kZXJzIGFuZCBUZWNoIFRlYW0gVG9rZW5zIEdvZXMgdG8gVmF1bHQsIExvY2tlZCBmb3IgMSBtb250aCAoVGVjaCkgYW5kIDEgeWVhcihUZWFtKQogICAgICAgIHVpbnQyNTYgdmF1bHRUb2tlbnMgPSBzYWZlRGl2KHNhZmVNdWwobWF4VG9rZW5TdXBwbHksIHZhdWx0UGVyY2VudE9mVG90YWwpLCAxMDApOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgdmF1bHRUb2tlbnMpOwogICAgICAgIGJhbGFuY2VzW3RpbWVWYXVsdF0gPSBzYWZlQWRkKGJhbGFuY2VzW3RpbWVWYXVsdF0sIHZhdWx0VG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcigwLCB0aW1lVmF1bHQsIHZhdWx0VG9rZW5zKTsKCiAgICAgICAgLy8gT25seSB0cmFuc2FjdCBpZiB0aGVyZSBhcmUgYW55IHVuc29sZCB0b2tlbnMKICAgICAgICBpZih1bnNvbGRUb2tlbnMgPiAwKSB7CiAgICAgICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgdW5zb2xkVG9rZW5zKTsKICAgICAgICAgICAgLy8gUmVtYWluaW5nIHVuc29sZCB0b2tlbnMgYXNzaWduIHRvIG11bHRpc2lnIHdhbGxldAogICAgICAgICAgICBiYWxhbmNlc1tiY2RjTXVsdGlzaWddID0gc2FmZUFkZChiYWxhbmNlc1tiY2RjTXVsdGlzaWddLCB1bnNvbGRUb2tlbnMpOy8vIEFzc2lnbiBSZXdhcmQgVG9rZW5zIHRvIE11bHRpc2lnIHdhbGxldAogICAgICAgICAgICBUcmFuc2ZlcigwLCBiY2RjTXVsdGlzaWcsIHVuc29sZFRva2Vucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgcHJlIGFsbG9jYXRlZCB0b2tlbnMgdG8gcHJvamVjdCByZXNlcnZlIGZ1bmQgdG8gdG90YWxTdXBwbHkKICAgICAgICB1aW50MjU2IHByZWFsbG9jYXRlZFRva2VucyA9IHNhZmVEaXYoc2FmZU11bChtYXhUb2tlblN1cHBseSwgcmVzZXJ2ZWRQZXJjZW50VG90YWwpLCAxMDApOwogICAgICAgIC8vIHByb2plY3QgdG9rZW5zIGFscmVhZHkgY291bnRlZCwgc28gb25seSBhZGQgcHJlYWxsY2F0ZWQgdG9rZW5zCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBwcmVhbGxvY2F0ZWRUb2tlbnMpOwogICAgICAgIC8vIDI1MCBtaWxsaW9ucyByZXdhcmQgdG9rZW5zIHRvIG11bHRpc2lnIChlcXVhbCB0byByZXNlcnZlZnVuZCBwcmVsbG9jYXRpb24pLgogICAgICAgIC8vIFJld2FyZCB0byB0b2tlbiBob2xkZXJzIG9uIHRoZWlyIGNvbW1pdG1lbnQgd2l0aCBCQ0RDICgyNSAlIG9mIDEgYmlsbGlvbiA9IDI1MCBtaWxsaW9ucykKICAgICAgICB1aW50MjU2IHJld2FyZFRva2VucyA9IHNhZmVEaXYoc2FmZU11bChtYXhUb2tlblN1cHBseSwgcmVzZXJ2ZWRQZXJjZW50VG90YWwpLCAxMDApOwogICAgICAgIGJhbGFuY2VzW2JjZGNNdWx0aXNpZ10gPSBzYWZlQWRkKGJhbGFuY2VzW2JjZGNNdWx0aXNpZ10sIHJld2FyZFRva2Vucyk7Ly8gQXNzaWduIFJld2FyZCBUb2tlbnMgdG8gTXVsdGlzaWcgd2FsbGV0CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCByZXdhcmRUb2tlbnMpOwoKICAgICAgICAvLyBUb3RhbCBTdXBwbHkgU2hvdWxkIG5vdCBiZSBncmVhdGVyIHRoYW4gMSBCaWxsaW9uCiAgICAgICAgaWYgKHRvdGFsU3VwcGx5ID4gbWF4VG9rZW5TdXBwbHkpIHRocm93OwogICAgICAgIC8vIFRyYW5zZmVyIEVUSCB0byB0aGUgQkNEQyBNdWx0aXNpZyBhZGRyZXNzLgogICAgICAgIGlmICghYmNkY011bHRpc2lnLnNlbmQodGhpcy5iYWxhbmNlKSkgdGhyb3c7CiAgICB9CgogICAgLy8gQ2FsbCB0aGlzIGZ1bmN0aW9uIHRvIGdldCB0aGUgcmVmdW5kIG9mIGludmVzdG1lbnQgZG9uZSBkdXJpbmcgQ3Jvd2RzYWxlCiAgICAvLyBSZWZ1bmQgY2FuIGJlIGRvbmUgb25seSB3aGVuIE1pbiBHb2FsIGhhcyBub3QgcmVhY2hlZCBhbmQgQ3Jvd2RzYWxlIGlzIG92ZXIKICAgIGZ1bmN0aW9uIHJlZnVuZCgpIGV4dGVybmFsIHsKICAgICAgICAvLyBBYm9ydCBpZiBub3QgaW4gRnVuZGluZyBGYWlsdXJlIHN0YXRlLgogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLkZhaWx1cmUpIHRocm93OwoKICAgICAgICB1aW50MjU2IGJjZGNWYWx1ZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIGlmIChiY2RjVmFsdWUgPT0gMCkgdGhyb3c7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgYmNkY1ZhbHVlKTsKCiAgICAgICAgdWludDI1NiBldGhWYWx1ZSA9IGludmVzdG1lbnRbbXNnLnNlbmRlcl07CiAgICAgICAgaW52ZXN0bWVudFttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgUmVmdW5kKG1zZy5zZW5kZXIsIGV0aFZhbHVlKTsKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChldGhWYWx1ZSkpIHRocm93OwogICAgfQoKICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGN1cnJlbnQgc3RhdGUgb2YgVG9rZW4gU2FsZQogICAgLy8gUmVhZCBvbmx5IG1ldGhvZCBzbyBubyB0cmFuc2FjdGlvbiBmZWVzCiAgICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSl7CiAgICAgIGlmIChibG9jay5udW1iZXIgPCBmdW5kaW5nU3RhcnRCbG9jaykgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICAgIGVsc2UgaWYgKGJsb2NrLm51bWJlciA8PSBmdW5kaW5nRW5kQmxvY2sgJiYgdG90YWxTdXBwbHkgPCB0b2tlblNhbGVNYXgpIHJldHVybiBTdGF0ZS5GdW5kaW5nOwogICAgICBlbHNlIGlmICh0b3RhbFN1cHBseSA+PSB0b2tlblNhbGVNaW4gfHwgdXBncmFkZUFnZW50U3RhdHVzKSByZXR1cm4gU3RhdGUuU3VjY2VzczsKICAgICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICAgIH0KCiAgICAvLyBUb2tlbiB1cGdyYWRlIGZ1bmN0aW9uYWxpdHkKCiAgICAvLy8gQG5vdGljZSBVcGdyYWRlIHRva2VucyB0byB0aGUgbmV3IHRva2VuIGNvbnRyYWN0LgogICAgLy8vIEBkZXYgUmVxdWlyZWQgc3RhdGU6IFN1Y2Nlc3MKICAgIC8vLyBAcGFyYW0gdmFsdWUgVGhlIG51bWJlciBvZiB0b2tlbnMgdG8gdXBncmFkZQogICAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKCF1cGdyYWRlQWdlbnRTdGF0dXMpIHRocm93OwogICAgICAgIC8qaWYgKGdldFN0YXRlKCkgIT0gU3RhdGUuU3VjY2VzcykgdGhyb3c7IC8vIEFib3J0IGlmIG5vdCBpbiBTdWNjZXNzIHN0YXRlLiovCiAgICAgICAgaWYgKHVwZ3JhZGVBZ2VudC5vd25lcigpID09IDB4MCkgdGhyb3c7IC8vIG5lZWQgYSByZWFsIHVwZ3JhZGVBZ2VudCBhZGRyZXNzCiAgICAgICAgaWYgKGZpbmFsaXplZFVwZ3JhZGUpIHRocm93OyAvLyBjYW5ub3QgdXBncmFkZSBpZiBmaW5hbGl6ZWQKCiAgICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgICAgaWYgKHZhbHVlID09IDApIHRocm93OwogICAgICAgIGlmICh2YWx1ZSA+IGJhbGFuY2VzW21zZy5zZW5kZXJdKSB0aHJvdzsKCiAgICAgICAgLy8gdXBkYXRlIHRoZSBiYWxhbmNlcyBoZXJlIGZpcnN0IGJlZm9yZSBjYWxsaW5nIG91dCAocmVlbnRyYW5jeSkKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIHZhbHVlKTsKICAgICAgICB0b3RhbFVwZ3JhZGVkID0gc2FmZUFkZCh0b3RhbFVwZ3JhZGVkLCB2YWx1ZSk7CiAgICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBhZGRyZXNzIG9mIHVwZ3JhZGUgdGFyZ2V0IGNvbnRyYWN0IGFuZCBlbmFibGUgdXBncmFkZQogICAgLy8vIHByb2Nlc3MuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogU3VjY2VzcwogICAgLy8vIEBwYXJhbSBhZ2VudCBUaGUgYWRkcmVzcyBvZiB0aGUgVXBncmFkZUFnZW50IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgewogICAgICAgIGlmIChnZXRTdGF0ZSgpICE9IFN0YXRlLlN1Y2Nlc3MpIHRocm93OyAvLyBBYm9ydCBpZiBub3QgaW4gU3VjY2VzcyBzdGF0ZS4KICAgICAgICBpZiAoYWdlbnQgPT0gMHgwKSB0aHJvdzsgLy8gZG9uJ3Qgc2V0IGFnZW50IHRvIG5vdGhpbmcKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsgLy8gT25seSBhIG1hc3RlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IGFnZW50CiAgICAgICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKICAgICAgICBpZiAoIXVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKSB0aHJvdzsKICAgICAgICAvLyB0aGlzIG5lZWRzIHRvIGJlIGNhbGxlZCBpbiBzdWNjZXNzIGNvbmRpdGlvbiB0byBndWFyYW50ZWUgdGhlIGludmFyaWFudCBpcyB0cnVlCiAgICAgICAgdXBncmFkZUFnZW50U3RhdHVzID0gdHJ1ZTsKICAgICAgICB1cGdyYWRlQWdlbnQuc2V0T3JpZ2luYWxTdXBwbHkoKTsKICAgICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYWRkcmVzcyBvZiB1cGdyYWRlIHRhcmdldCBjb250cmFjdCBhbmQgZW5hYmxlIHVwZ3JhZGUKICAgIC8vLyBwcm9jZXNzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgc3RhdGU6IFN1Y2Nlc3MKICAgIC8vLyBAcGFyYW0gbWFzdGVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBtYW5hZ2UgdXBncmFkZXMsIG5vdCB0aGUgdXBncmFkZUFnZW50IGNvbnRyYWN0IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBtYXN0ZXIpIGV4dGVybmFsIHsKICAgICAgICBpZiAoZ2V0U3RhdGUoKSAhPSBTdGF0ZS5TdWNjZXNzKSB0aHJvdzsgLy8gQWJvcnQgaWYgbm90IGluIFN1Y2Nlc3Mgc3RhdGUuCiAgICAgICAgaWYgKG1hc3RlciA9PSAweDApIHRocm93OwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OyAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgbWFzdGVyCiAgICAgICAgdXBncmFkZU1hc3RlciA9IG1hc3RlcjsKICAgIH0KCiAgICAvLyBUaGVzZSBtb2RpZmllciBhbmQgZnVuY3Rpb25zIHJlbGF0ZWQgdG8gaGFsdCB0aGUgc2FsZSBpbiBjYXNlIG9mIGVtZXJnZW5jeQoKICAgIC8vIEBkZXYgVXNlIHRoaXMgYXMgZnVuY3Rpb24gbW9kaWZpZXIgdGhhdCBzaG91bGQgbm90IGV4ZWN1dGUgaWYgY29udHJhY3Qgc3RhdGUgSGFsdGVkCiAgICBtb2RpZmllciBzdG9wSWZIYWx0ZWQgewogICAgICBpZihoYWx0ZWQpIHRocm93OwogICAgICBfOwogICAgfQoKICAgIC8vIEBkZXYgVXNlIHRoaXMgYXMgZnVuY3Rpb24gbW9kaWZpZXIgdGhhdCBzaG91bGQgZXhlY3V0ZSBvbmx5IGlmIGNvbnRyYWN0IHN0YXRlIEhhbHRlZAogICAgbW9kaWZpZXIgcnVuSWZIYWx0ZWR7CiAgICAgIGlmKCFoYWx0ZWQpIHRocm93OwogICAgICBfOwogICAgfQoKICAgIC8vIEBkZXYgY2FsbGVkIGJ5IG9ubHkgb3duZXIgaW4gY2FzZSBvZiBhbnkgZW1lcmdlY3kgc2l0dWF0aW9uCiAgICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyewogICAgICBoYWx0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIEBkZXYgY2FsbGVkIGJ5IG9ubHkgb3duZXIgdG8gc3RvcCB0aGUgZW1lcmdlbmN5IHNpdHVhdGlvbgogICAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyewogICAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLyBUaGlzIG1ldGhvZCBpcyBvbmx5IHVzZSBmb3IgdHJhbnNmZXIgYmNkY3Rva2VuIGZyb20gYmNkY1Jlc2VydmVGdW5kCiAgICAvLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBpcyBiY2RjUmVzZXJ2ZUZ1bmQgc2V0CiAgICAvLyBAcGFyYW0gdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8gQHBhcmFtIHZhbHVlIFRoZSBudW1iZXIgb2YgQkNEQyB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIC8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiByZXNlcnZlVG9rZW5DbGFpbShhZGRyZXNzIGNsYWltQWRkcmVzcyx1aW50MjU2IHRva2VuKSBvbmx5QmNkY1Jlc2VydmUgcmV0dXJucyAoYm9vbCBvayl7CiAgICAgIC8vIENoZWNrIGlmIEJDREMgUmVzZXJ2ZSBGdW5kIGlzIHNldCBvciBub3QKICAgICAgaWYgKCBiY2RjUmVzZXJ2ZUZ1bmQgPT0gMHgwKSB0aHJvdzsKICAgICAgdWludDI1NiBzZW5kZXJCYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgIGlmKHNlbmRlckJhbGFuY2UgPj0gdG9rZW4gJiYgdG9rZW4+MCl7CiAgICAgICAgc2VuZGVyQmFsYW5jZSA9IHNhZmVTdWIoc2VuZGVyQmFsYW5jZSwgdG9rZW4pOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2VuZGVyQmFsYW5jZTsKICAgICAgICBiYWxhbmNlc1tjbGFpbUFkZHJlc3NdID0gc2FmZUFkZChiYWxhbmNlc1tjbGFpbUFkZHJlc3NdLCB0b2tlbik7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgY2xhaW1BZGRyZXNzLCB0b2tlbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIFRoaXMgbWV0aG9kIGlzIGZvciBnZXR0aW5nIGJjZGN0b2tlbiBhcyByZXdhcmRzCgkgIC8vIEBwYXJhbSB0b2tlbnMgVGhlIG51bWJlciBvZiB0b2tlbnMgYmFjayBmb3IgcmV3YXJkcwogIAlmdW5jdGlvbiBiYWNrVG9rZW5Gb3JSZXdhcmRzKHVpbnQyNTYgdG9rZW5zKSBleHRlcm5hbHsKICAJCS8vIENoZWNrIHRoYXQgdG9rZW4gYXZhaWxhYmxlIGZvciB0cmFuc2ZlcgogIAkJaWYoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCB0b2tlbnMgJiYgdG9rZW5zIDw9IDApIHRocm93OwoKICAJCS8vIERlYml0IHRva2VucyBmcm9tIG1zZy5zZW5kZXIKICAJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdG9rZW5zKTsKCiAgCQkvLyBDcmVkaXQgdG9rZW5zIGludG8gYmNkY1Jlc2VydmVGdW5kCiAgCQliYWxhbmNlc1tiY2RjUmVzZXJ2ZUZ1bmRdID0gc2FmZUFkZChiYWxhbmNlc1tiY2RjUmVzZXJ2ZUZ1bmRdLCB0b2tlbnMpOwogIAkJVHJhbnNmZXIobXNnLnNlbmRlciwgYmNkY1Jlc2VydmVGdW5kLCB0b2tlbnMpOwogIAl9CgogICAgLy8gYmNkY1Jlc2VydmVGdW5kIHJlbGF0ZWQgbW9kaWZlciBhbmQgZnVuY3Rpb25zCiAgICAvLyBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgYmNkY1Jlc2VydmVGdW5kIG93bmVyCiAgICBtb2RpZmllciBvbmx5QmNkY1Jlc2VydmUoKSB7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IGJjZGNSZXNlcnZlRnVuZCkgewogICAgICAgIHRocm93OwogICAgICB9CiAgICAgIF87CiAgICB9Cn0='.
	

]
