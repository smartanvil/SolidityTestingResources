Class {
	#name : #SRTf28e28be834f0daaf295157246608284e0212688,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf28e28be834f0daaf295157246608284e0212688 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKCmludGVyZmFjZSBUb2tlbiB7CgogICAgLy8vIEByZXR1cm4gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBVdGlscyB7CiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIGNvbnRyYWN0X3ZlcnNpb24gPSAiMC4xLl8iOwogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYSBjb250cmFjdCBleGlzdHMKICAgIC8vLyBAcGFyYW0gY2hhbm5lbCBUaGUgYWRkcmVzcyB0byBjaGVjayB3aGV0aGVyIGEgY29udHJhY3QgaXMgZGVwbG95ZWQgb3Igbm90CiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGEgY29udHJhY3QgZXhpc3RzLCBmYWxzZSBvdGhlcndpc2UKICAgIGZ1bmN0aW9uIGNvbnRyYWN0RXhpc3RzKGFkZHJlc3MgY2hhbm5lbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKGNoYW5uZWwpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2l6ZSA+IDA7CiAgICB9Cn0KCgoKCmxpYnJhcnkgTmV0dGluZ0NoYW5uZWxMaWJyYXJ5IHsKICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgY29udHJhY3RfdmVyc2lvbiA9ICIwLjEuXyI7CgogICAgc3RydWN0IFBhcnRpY2lwYW50CiAgICB7CiAgICAgICAgYWRkcmVzcyBub2RlX2FkZHJlc3M7CgogICAgICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbiB0cmFuc2ZlcnJlZCB0byB0aGlzIHNtYXJ0IGNvbnRyYWN0IHRocm91Z2ggdGhlCiAgICAgICAgLy8gYGRlcG9zaXRgIGZ1bmN0aW9uLCBub3RlIHRoYXQgZGlyZWN0IHRva2VuIHRyYW5zZmVyIGNhbm5vdCBiZQogICAgICAgIC8vIHRyYWNrZWQgYW5kIHdpbGwgYmUgYnVybmVkLgogICAgICAgIHVpbnQyNTYgYmFsYW5jZTsKCiAgICAgICAgLy8gVGhlIGxhdGVzdCBrbm93biBtZXJrbGUgcm9vdCBvZiB0aGUgcGVuZGluZyBoYXNoLXRpbWUgbG9ja3MsIHVzZWQgdG8KICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgd2l0aGRyYXduIHByb29mcy4KICAgICAgICBieXRlczMyIGxvY2tzcm9vdDsKCiAgICAgICAgLy8gVGhlIGxhdGVzdCBrbm93biB0cmFuc2ZlcnJlZF9hbW91bnQgZnJvbSB0aGlzIG5vZGUgdG8gdGhlIG90aGVyCiAgICAgICAgLy8gcGFydGljaXBhbnQsIHVzZWQgdG8gY29tcHV0ZSB0aGUgbmV0IGJhbGFuY2Ugb24gc2V0dGxlbWVudC4KICAgICAgICB1aW50MjU2IHRyYW5zZmVycmVkX2Ftb3VudDsKCiAgICAgICAgLy8gVmFsdWUgdXNlZCB0byBvcmRlciB0cmFuc2ZlcnMgYW5kIG9ubHkgYWNjZXB0IHRoZSBsYXRlc3Qgb24gY2FsbHMgdG8KICAgICAgICAvLyB1cGRhdGUsIHRoaXMgd2lsbCBvbmx5IGJlIHJlbGV2YW50IGFmdGVyIGVpdGhlciAjMTgyIG9yICMyOTMgaXMKICAgICAgICAvLyBpbXBsZW1lbnRlZC4KICAgICAgICB1aW50NjQgbm9uY2U7CgogICAgICAgIC8vIEEgbWFwcGluZyB0byBrZWVwIHRyYWNrIG9mIGxvY2tzIHRoYXQgaGF2ZSBiZWVuIHdpdGhkcmF3bi4KICAgICAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gYm9vbCkgd2l0aGRyYXduX2xvY2tzOwogICAgfQoKICAgIHN0cnVjdCBEYXRhIHsKICAgICAgICB1aW50IHNldHRsZV90aW1lb3V0OwogICAgICAgIHVpbnQgb3BlbmVkOwogICAgICAgIHVpbnQgY2xvc2VkOwogICAgICAgIHVpbnQgc2V0dGxlZDsKICAgICAgICBhZGRyZXNzIGNsb3NpbmdfYWRkcmVzczsKICAgICAgICBUb2tlbiB0b2tlbjsKICAgICAgICBQYXJ0aWNpcGFudFsyXSBwYXJ0aWNpcGFudHM7CiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQ4KSBwYXJ0aWNpcGFudF9pbmRleDsKICAgICAgICBib29sIHVwZGF0ZWQ7CiAgICB9CgoKICAgIG1vZGlmaWVyIG5vdFNldHRsZWRCdXRDbG9zZWQoRGF0YSBzdG9yYWdlIHNlbGYpIHsKICAgICAgICByZXF1aXJlKHNlbGYuc2V0dGxlZCA8PSAwICYmIHNlbGYuY2xvc2VkID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBzdGlsbFRpbWVvdXQoRGF0YSBzdG9yYWdlIHNlbGYpIHsKICAgICAgICByZXF1aXJlKHNlbGYuY2xvc2VkICsgc2VsZi5zZXR0bGVfdGltZW91dCA+PSBibG9jay5udW1iZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdGltZW91dE92ZXIoRGF0YSBzdG9yYWdlIHNlbGYpIHsKICAgICAgICByZXF1aXJlKHNlbGYuY2xvc2VkICsgc2VsZi5zZXR0bGVfdGltZW91dCA8PSBibG9jay5udW1iZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2hhbm5lbFNldHRsZWQoRGF0YSBzdG9yYWdlIHNlbGYpIHsKICAgICAgICByZXF1aXJlKHNlbGYuc2V0dGxlZCAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIERlcG9zaXQgYW1vdW50IHRvIGNoYW5uZWwuCiAgICAvLy8gQGRldiBEZXBvc2l0IGFuIGFtb3VudCB0byB0aGUgY2hhbm5lbC4gQXQgbGVhc3Qgb25lIG9mIHRoZSBwYXJ0aWNpcGFudHMKICAgIC8vLyBtdXN0IGRlcG9zaXQgYmVmb3JlIHRoZSBjaGFubmVsIGlzIG9wZW5lZC4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gYmUgZGVwb3NpdGVkIHRvIHRoZSBhZGRyZXNzCiAgICAvLy8gQHJldHVybiBTdWNjZXNzIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgLy8vIEByZXR1cm4gVGhlIG5ldyBiYWxhbmNlIG9mIHRoZSBpbnZva2VyCiAgICBmdW5jdGlvbiBkZXBvc2l0KERhdGEgc3RvcmFnZSBzZWxmLCB1aW50MjU2IGFtb3VudCkKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MsIHVpbnQyNTYgYmFsYW5jZSkKICAgIHsKICAgICAgICB1aW50OCBpbmRleDsKCiAgICAgICAgcmVxdWlyZShzZWxmLm9wZW5lZCA+IDApOwogICAgICAgIHJlcXVpcmUoc2VsZi5jbG9zZWQgPT0gMCk7CiAgICAgICAgcmVxdWlyZShzZWxmLnRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKSA+PSBhbW91bnQpOwoKICAgICAgICBpbmRleCA9IGluZGV4X29yX3Rocm93KHNlbGYsIG1zZy5zZW5kZXIpOwogICAgICAgIFBhcnRpY2lwYW50IHN0b3JhZ2UgcGFydGljaXBhbnQgPSBzZWxmLnBhcnRpY2lwYW50c1tpbmRleF07CgogICAgICAgIHN1Y2Nlc3MgPSBzZWxmLnRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBhbW91bnQpOwogICAgICAgIGlmIChzdWNjZXNzID09IHRydWUpIHsKICAgICAgICAgICAgYmFsYW5jZSA9IHBhcnRpY2lwYW50LmJhbGFuY2U7CiAgICAgICAgICAgIGJhbGFuY2UgKz0gYW1vdW50OwogICAgICAgICAgICBwYXJ0aWNpcGFudC5iYWxhbmNlID0gYmFsYW5jZTsKCiAgICAgICAgICAgIHJldHVybiAodHJ1ZSwgYmFsYW5jZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDbG9zZSBhIGNoYW5uZWwgYmV0d2VlbiB0d28gcGFydGllcyB0aGF0IHdhcyB1c2VkIGJpZGlyZWN0aW9uYWxseQogICAgZnVuY3Rpb24gY2xvc2UoCiAgICAgICAgRGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgdWludDY0IG5vbmNlLAogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJyZWRfYW1vdW50LAogICAgICAgIGJ5dGVzMzIgbG9ja3Nyb290LAogICAgICAgIGJ5dGVzMzIgZXh0cmFfaGFzaCwKICAgICAgICBieXRlcyBzaWduYXR1cmUKICAgICkgewogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJfYWRkcmVzczsKICAgICAgICB1aW50IGNsb3Nlcl9pbmRleDsKICAgICAgICB1aW50IGNvdW50ZXJwYXJ0eV9pbmRleDsKCiAgICAgICAgLy8gY2xvc2UgY2FuIGJlIGNhbGxlZCBvbmx5IG9uY2UKICAgICAgICByZXF1aXJlKHNlbGYuY2xvc2VkID09IDApOwogICAgICAgIHNlbGYuY2xvc2VkID0gYmxvY2subnVtYmVyOwoKICAgICAgICAvLyBPbmx5IGEgcGFydGljaXBhbnQgY2FuIGNhbGwgY2xvc2UKICAgICAgICBjbG9zZXJfaW5kZXggPSBpbmRleF9vcl90aHJvdyhzZWxmLCBtc2cuc2VuZGVyKTsKICAgICAgICBzZWxmLmNsb3NpbmdfYWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIE9ubHkgdGhlIGNsb3NpbmcgcGFydHkgY2FuIHByb3ZpZGUgYSB0cmFuc2ZlciBmcm9tIHRoZSBjb3VudGVycGFydHksCiAgICAgICAgLy8gYW5kIG9ubHkgd2hlbiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCwgaS5lLiB0aGlzIHZhbHVlIGNhbiBub3QgYmUKICAgICAgICAvLyB1cGRhdGVkIGFmdGVyd2FyZHMuCgogICAgICAgIC8vIEFuIGVtcHR5IHZhbHVlIG1lYW5zIHRoYXQgdGhlIGNsb3NlciBuZXZlciByZWNlaXZlZCBhIHRyYW5zZmVyLCBvcgogICAgICAgIC8vIGhlIGlzIGludGVudGlvbmFsbHkgbm90IHByb3ZpZGluZyB0aGUgbGF0ZXN0IHRyYW5zZmVyLCBpbiB3aGljaCBjYXNlCiAgICAgICAgLy8gdGhlIGNsb3NpbmcgcGFydHkgaXMgZ29pbmcgdG8gbG9zZSB0aGUgdG9rZW5zIHRoYXQgd2VyZSB0cmFuc2ZlcnJlZAogICAgICAgIC8vIHRvIGhpbS4KICAgICAgICBpZiAoc2lnbmF0dXJlLmxlbmd0aCA9PSA2NSkgewogICAgICAgICAgICB0cmFuc2Zlcl9hZGRyZXNzID0gcmVjb3ZlckFkZHJlc3NGcm9tU2lnbmF0dXJlKAogICAgICAgICAgICAgICAgbm9uY2UsCiAgICAgICAgICAgICAgICB0cmFuc2ZlcnJlZF9hbW91bnQsCiAgICAgICAgICAgICAgICBsb2Nrc3Jvb3QsCiAgICAgICAgICAgICAgICBleHRyYV9oYXNoLAogICAgICAgICAgICAgICAgc2lnbmF0dXJlIAogICAgICAgICAgICApOwoKICAgICAgICAgICAgY291bnRlcnBhcnR5X2luZGV4ID0gaW5kZXhfb3JfdGhyb3coc2VsZiwgdHJhbnNmZXJfYWRkcmVzcyk7CiAgICAgICAgICAgIHJlcXVpcmUoY2xvc2VyX2luZGV4ICE9IGNvdW50ZXJwYXJ0eV9pbmRleCk7CgogICAgICAgICAgICAvLyB1cGRhdGUgdGhlIHN0cnVjdHVyZSBvZiB0aGUgY291bnRlcnBhcnR5IHdpdGggaXRzIGRhdGEgcHJvdmlkZWQKICAgICAgICAgICAgLy8gYnkgdGhlIGNsb3Npbmcgbm9kZQogICAgICAgICAgICBQYXJ0aWNpcGFudCBzdG9yYWdlIGNvdW50ZXJwYXJ0eSA9IHNlbGYucGFydGljaXBhbnRzW2NvdW50ZXJwYXJ0eV9pbmRleF07CiAgICAgICAgICAgIGNvdW50ZXJwYXJ0eS5ub25jZSA9IHVpbnQ2NChub25jZSk7CiAgICAgICAgICAgIGNvdW50ZXJwYXJ0eS5sb2Nrc3Jvb3QgPSBsb2Nrc3Jvb3Q7CiAgICAgICAgICAgIGNvdW50ZXJwYXJ0eS50cmFuc2ZlcnJlZF9hbW91bnQgPSB0cmFuc2ZlcnJlZF9hbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgY291bnRlciBwYXJ0eSB0cmFuc2ZlciBhZnRlciBjbG9zaW5nLgogICAgZnVuY3Rpb24gdXBkYXRlVHJhbnNmZXIoCiAgICAgICAgRGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgdWludDY0IG5vbmNlLAogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJyZWRfYW1vdW50LAogICAgICAgIGJ5dGVzMzIgbG9ja3Nyb290LAogICAgICAgIGJ5dGVzMzIgZXh0cmFfaGFzaCwKICAgICAgICBieXRlcyBzaWduYXR1cmUKICAgICkKICAgICAgICBub3RTZXR0bGVkQnV0Q2xvc2VkKHNlbGYpCiAgICAgICAgc3RpbGxUaW1lb3V0KHNlbGYpCiAgICB7CiAgICAgICAgYWRkcmVzcyB0cmFuc2Zlcl9hZGRyZXNzOwogICAgICAgIHVpbnQ4IGNhbGxlcl9pbmRleDsKICAgICAgICB1aW50OCBjbG9zZXJfaW5kZXg7CgogICAgICAgIC8vIHVwZGF0ZVRyYW5zZmVyIGNhbiBiZSBjYWxsZWQgYnkgdGhlIGNvdW50ZXIgcGFydHkgb25seSBvbmNlCiAgICAgICAgcmVxdWlyZSghc2VsZi51cGRhdGVkKTsKICAgICAgICBzZWxmLnVwZGF0ZWQgPSB0cnVlOwoKICAgICAgICAvLyBPbmx5IGEgcGFydGljaXBhbnQgY2FuIGNhbGwgdXBkYXRlVHJhbnNmZXIgKCMyOTMgZm9yIHRoaXJkIHBhcnRpZXMpCiAgICAgICAgY2FsbGVyX2luZGV4ID0gaW5kZXhfb3JfdGhyb3coc2VsZiwgbXNnLnNlbmRlcik7CgogICAgICAgIC8vIFRoZSBjbG9zZXIgaXMgbm90IGFsbG93ZWQgdG8gY2FsbCB1cGRhdGVUcmFuc2ZlcgogICAgICAgIHJlcXVpcmUoc2VsZi5jbG9zaW5nX2FkZHJlc3MgIT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIENvdW50ZXIgcGFydHkgY2FuIG9ubHkgdXBkYXRlIHRoZSBjbG9zZXIgdHJhbnNmZXIKICAgICAgICB0cmFuc2Zlcl9hZGRyZXNzID0gcmVjb3ZlckFkZHJlc3NGcm9tU2lnbmF0dXJlKAogICAgICAgICAgICBub25jZSwKICAgICAgICAgICAgdHJhbnNmZXJyZWRfYW1vdW50LAogICAgICAgICAgICBsb2Nrc3Jvb3QsCiAgICAgICAgICAgIGV4dHJhX2hhc2gsCiAgICAgICAgICAgIHNpZ25hdHVyZSAKICAgICAgICApOwogICAgICAgIHJlcXVpcmUodHJhbnNmZXJfYWRkcmVzcyA9PSBzZWxmLmNsb3NpbmdfYWRkcmVzcyk7CgogICAgICAgIC8vIFVwZGF0ZSB0aGUgc3RydWN0dXJlIG9mIHRoZSBjbG9zZXIgd2l0aCBpdHMgZGF0YSBwcm92aWRlZCBieSB0aGUKICAgICAgICAvLyBjb3VudGVycGFydHkKICAgICAgICBjbG9zZXJfaW5kZXggPSAxIC0gY2FsbGVyX2luZGV4OwoKICAgICAgICBzZWxmLnBhcnRpY2lwYW50c1tjbG9zZXJfaW5kZXhdLm5vbmNlID0gbm9uY2U7CiAgICAgICAgc2VsZi5wYXJ0aWNpcGFudHNbY2xvc2VyX2luZGV4XS5sb2Nrc3Jvb3QgPSBsb2Nrc3Jvb3Q7CiAgICAgICAgc2VsZi5wYXJ0aWNpcGFudHNbY2xvc2VyX2luZGV4XS50cmFuc2ZlcnJlZF9hbW91bnQgPSB0cmFuc2ZlcnJlZF9hbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gcmVjb3ZlckFkZHJlc3NGcm9tU2lnbmF0dXJlKAogICAgICAgIHVpbnQ2NCBub25jZSwKICAgICAgICB1aW50MjU2IHRyYW5zZmVycmVkX2Ftb3VudCwKICAgICAgICBieXRlczMyIGxvY2tzcm9vdCwKICAgICAgICBieXRlczMyIGV4dHJhX2hhc2gsCiAgICAgICAgYnl0ZXMgc2lnbmF0dXJlCiAgICApCiAgICAgICAgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykKICAgIHsKICAgICAgICBieXRlczMyIHNpZ25lZF9oYXNoOwoKICAgICAgICByZXF1aXJlKHNpZ25hdHVyZS5sZW5ndGggPT0gNjUpOwoKICAgICAgICBzaWduZWRfaGFzaCA9IHNoYTMoCiAgICAgICAgICAgIG5vbmNlLAogICAgICAgICAgICB0cmFuc2ZlcnJlZF9hbW91bnQsCiAgICAgICAgICAgIGxvY2tzcm9vdCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgZXh0cmFfaGFzaAogICAgICAgICk7CgogICAgICAgIHZhciAociwgcywgdikgPSBzaWduYXR1cmVTcGxpdChzaWduYXR1cmUpOwogICAgICAgIHJldHVybiBlY3JlY292ZXIoc2lnbmVkX2hhc2gsIHYsIHIsIHMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFVubG9jayBhIGxvY2tlZCB0cmFuc2ZlcgogICAgLy8vIEBkZXYgVW5sb2NrIGEgbG9ja2VkIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIGxvY2tlZF9lbmNvZGVkIFRoZSBsb2NrCiAgICAvLy8gQHBhcmFtIG1lcmtsZV9wcm9vZiBUaGUgbWVya2xlIHByb29mCiAgICAvLy8gQHBhcmFtIHNlY3JldCBUaGUgc2VjcmV0CiAgICBmdW5jdGlvbiB3aXRoZHJhdyhEYXRhIHN0b3JhZ2Ugc2VsZiwgYnl0ZXMgbG9ja2VkX2VuY29kZWQsIGJ5dGVzIG1lcmtsZV9wcm9vZiwgYnl0ZXMzMiBzZWNyZXQpCiAgICAgICAgbm90U2V0dGxlZEJ1dENsb3NlZChzZWxmKQogICAgewogICAgICAgIHVpbnQgYW1vdW50OwogICAgICAgIHVpbnQ4IGluZGV4OwogICAgICAgIHVpbnQ2NCBleHBpcmF0aW9uOwogICAgICAgIGJ5dGVzMzIgaDsKICAgICAgICBieXRlczMyIGhhc2hsb2NrOwoKICAgICAgICAvLyBDaGVjayBpZiBtc2cuc2VuZGVyIGlzIGEgcGFydGljaXBhbnQgYW5kIHNlbGVjdCB0aGUgcGFydG5lciAoZm9yCiAgICAgICAgLy8gdGhpcmQgcGFydHkgdW5sb2NrIHNlZSAjNTQxKQogICAgICAgIGluZGV4ID0gMSAtIGluZGV4X29yX3Rocm93KHNlbGYsIG1zZy5zZW5kZXIpOwogICAgICAgIFBhcnRpY2lwYW50IHN0b3JhZ2UgY291bnRlcnBhcnR5ID0gc2VsZi5wYXJ0aWNpcGFudHNbaW5kZXhdOwoKICAgICAgICAvLyBBbiBlbXB0eSBsb2Nrc3Jvb3QgbWVhbnMgdGhlcmUgYXJlIG5vIHBlbmRpbmcgbG9ja3MKICAgICAgICByZXF1aXJlKGNvdW50ZXJwYXJ0eS5sb2Nrc3Jvb3QgIT0gMCk7CgogICAgICAgIChleHBpcmF0aW9uLCBhbW91bnQsIGhhc2hsb2NrKSA9IGRlY29kZUxvY2sobG9ja2VkX2VuY29kZWQpOwoKICAgICAgICAvLyBBIGxvY2sgY2FuIGJlIHdpdGhkcmF3biBvbmx5IG9uY2UgcGVyIHBhcnRpY2lwYW50CiAgICAgICAgcmVxdWlyZSghY291bnRlcnBhcnR5LndpdGhkcmF3bl9sb2Nrc1toYXNobG9ja10pOwoKICAgICAgICBjb3VudGVycGFydHkud2l0aGRyYXduX2xvY2tzW2hhc2hsb2NrXSA9IHRydWU7CgogICAgICAgIC8vIFRoZSBsb2NrIG11c3Qgbm90IGhhdmUgZXhwaXJlZCwgaXQgZG9lcyBub3QgbWF0dGVyIGhvdyBmYXIgaW4gdGhlCiAgICAgICAgLy8gZnV0dXJlIGl0IHdvdWxkIGhhdmUgZXhwaXJlZAogICAgICAgIHJlcXVpcmUoZXhwaXJhdGlvbiA+PSBibG9jay5udW1iZXIpOwogICAgICAgIHJlcXVpcmUoaGFzaGxvY2sgPT0gc2hhMyhzZWNyZXQpKTsKCiAgICAgICAgaCA9IGNvbXB1dGVNZXJrbGVSb290KGxvY2tlZF9lbmNvZGVkLCBtZXJrbGVfcHJvb2YpOwoKICAgICAgICByZXF1aXJlKGNvdW50ZXJwYXJ0eS5sb2Nrc3Jvb3QgPT0gaCk7CgogICAgICAgIC8vIFRoaXMgaW1wbGVtZW50YXRpb24gYWxsb3dzIGZvciBlYWNoIHRyYW5zZmVyIHRvIGJlIHNldCBvbmx5IG9uY2UsIHNvCiAgICAgICAgLy8gaXQncyBzYWZlIHRvIHVwZGF0ZSB0aGUgdHJhbnNmZXJyZWRfYW1vdW50IGluIHBsYWNlLgogICAgICAgIC8vCiAgICAgICAgLy8gT25jZSB0aGlyZCBwYXJ0aWVzIGFyZSBhbGxvd2VkIHRvIHVwZGF0ZSB0aGUgY291bnRlciBwYXJ0eSB0cmFuc2ZlcgogICAgICAgIC8vICgjMjkzLCAjMTgyKSB0aGUgbG9ja3Nyb290IG1heSBjaGFuZ2UsIGlmIHRoZSBsb2Nrc3Jvb3QgY2hhbmdlIHRoZQogICAgICAgIC8vIHRyYW5zZmVycmVkX2Ftb3VudCBtdXN0IGJlIHJlc2V0IGFuZCBsb2NrcyBtdXN0IGJlIHJlLXdpdGhkcmF3biwgc28KICAgICAgICAvLyB0aGlzIGlzIGFsc28gc2FmZS4KICAgICAgICAvLwogICAgICAgIC8vIFRoaXMgbWF5IGJlIHByb2JsZW1hdGljIGlmIGFuIHVwZGF0ZSBjaGFuZ2VzIHRoZSB0cmFuc2ZlcnJlZF9hbW91bnQKICAgICAgICAvLyBidXQgbm90IHRoZSBsb2Nrc3Jvb3QsIHNpbmNlIHRoZSBsb2NrcyBkb24ndCBuZWVkIHRvIGJlCiAgICAgICAgLy8gcmUtd2l0aGRyYXduLCB0aGUgZGlmZmVyZW5jZSBpbiB0aGUgdHJhbnNmZXJyZWRfYW1vdW50IG11c3QgYmUKICAgICAgICAvLyBhY2NvdW50ZWQgZm9yLgogICAgICAgIGNvdW50ZXJwYXJ0eS50cmFuc2ZlcnJlZF9hbW91bnQgKz0gYW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbXB1dGVNZXJrbGVSb290KGJ5dGVzIGxvY2ssIGJ5dGVzIG1lcmtsZV9wcm9vZikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXF1aXJlKG1lcmtsZV9wcm9vZi5sZW5ndGggJSAzMiA9PSAwKTsKCiAgICAgICAgdWludCBpOwogICAgICAgIGJ5dGVzMzIgaDsKICAgICAgICBieXRlczMyIGVsOwoKICAgICAgICBoID0gc2hhMyhsb2NrKTsKICAgICAgICBmb3IgKGkgPSAzMjsgaSA8PSBtZXJrbGVfcHJvb2YubGVuZ3RoOyBpICs9IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGVsIDo9IG1sb2FkKGFkZChtZXJrbGVfcHJvb2YsIGkpKQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaCA8IGVsKSB7CiAgICAgICAgICAgICAgICBoID0gc2hhMyhoLCBlbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBoID0gc2hhMyhlbCwgaCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBoOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldHRsZXMgdGhlIGJhbGFuY2UgYmV0d2VlbiB0aGUgdHdvIHBhcnRpZXMKICAgIC8vLyBAZGV2IFNldHRsZXMgdGhlIGJhbGFuY2VzIG9mIHRoZSB0d28gcGFydGllcyBmbyB0aGUgY2hhbm5lbAogICAgLy8vIEByZXR1cm4gVGhlIHBhcnRpY2lwYW50cyB3aXRoIG5ldHRlZCBiYWxhbmNlcwogICAgZnVuY3Rpb24gc2V0dGxlKERhdGEgc3RvcmFnZSBzZWxmKQogICAgICAgIG5vdFNldHRsZWRCdXRDbG9zZWQoc2VsZikKICAgICAgICB0aW1lb3V0T3ZlcihzZWxmKQogICAgewogICAgICAgIHVpbnQ4IGNsb3NpbmdfaW5kZXg7CiAgICAgICAgdWludDggY291bnRlcl9pbmRleDsKICAgICAgICB1aW50MjU2IHRvdGFsX2RlcG9zaXQ7CiAgICAgICAgdWludDI1NiBjb3VudGVyX25ldDsKICAgICAgICB1aW50MjU2IGNsb3Nlcl9hbW91bnQ7CiAgICAgICAgdWludDI1NiBjb3VudGVyX2Ftb3VudDsKCiAgICAgICAgc2VsZi5zZXR0bGVkID0gYmxvY2subnVtYmVyOwoKICAgICAgICBjbG9zaW5nX2luZGV4ID0gaW5kZXhfb3JfdGhyb3coc2VsZiwgc2VsZi5jbG9zaW5nX2FkZHJlc3MpOwogICAgICAgIGNvdW50ZXJfaW5kZXggPSAxIC0gY2xvc2luZ19pbmRleDsKCiAgICAgICAgUGFydGljaXBhbnQgc3RvcmFnZSBjbG9zaW5nX3BhcnR5ID0gc2VsZi5wYXJ0aWNpcGFudHNbY2xvc2luZ19pbmRleF07CiAgICAgICAgUGFydGljaXBhbnQgc3RvcmFnZSBjb3VudGVyX3BhcnR5ID0gc2VsZi5wYXJ0aWNpcGFudHNbY291bnRlcl9pbmRleF07CgogICAgICAgIGNvdW50ZXJfbmV0ID0gKAogICAgICAgICAgICBjb3VudGVyX3BhcnR5LmJhbGFuY2UKICAgICAgICAgICAgKyBjbG9zaW5nX3BhcnR5LnRyYW5zZmVycmVkX2Ftb3VudAogICAgICAgICAgICAtIGNvdW50ZXJfcGFydHkudHJhbnNmZXJyZWRfYW1vdW50CiAgICAgICAgKTsKCiAgICAgICAgLy8gRGlyZWN0IHRva2VuIHRyYW5zZmVycyBkb25lIHRocm91Z2ggdGhlIHRva2VuIGB0cmFuc2ZlcmAgZnVuY3Rpb24KICAgICAgICAvLyBjYW5ub3QgYmUgYWNjb3VudGVkIGZvciwgdGhlc2Ugc3VwZXJmbHVvdXMgdG9rZW5zIHdpbGwgYmUgYnVybmVkLAogICAgICAgIC8vIHRoaXMgaXMgYmVjYXVzZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCB3aGljaCBwYXJ0aWNpcGFudCAoaWYgYW55KQogICAgICAgIC8vIGhhZCBvd25lcnNoaXAgb3ZlciB0aGUgdG9rZW4uCiAgICAgICAgdG90YWxfZGVwb3NpdCA9IGNsb3NpbmdfcGFydHkuYmFsYW5jZSArIGNvdW50ZXJfcGFydHkuYmFsYW5jZTsKCiAgICAgICAgLy8gV2hlbiB0aGUgY2xvc2luZyBwYXJ0eSBkb2VzIG5vdCBwcm92aWRlIHRoZSBjb3VudGVyIHBhcnR5IHRyYW5zZmVyLAogICAgICAgIC8vIHRoZSBgY291bnRlcl9uZXRgIG1heSBiZSBsYXJnZXIgdGhhbiB0aGUgYHRvdGFsX2RlcG9zaXRgLCB3aXRob3V0CiAgICAgICAgLy8gdGhlIG1pbiB0aGUgdG9rZW4gdHJhbnNmZXIgZmFpbCBhbmQgdGhlIHRva2VuIGlzIGxvY2tlZC4KICAgICAgICBjb3VudGVyX2Ftb3VudCA9IG1pbihjb3VudGVyX25ldCwgdG90YWxfZGVwb3NpdCk7CgogICAgICAgIC8vIFdoZW4gdGhlIGNvdW50ZXIgcGFydHkgZG9lcyBub3QgcHJvdmlkZSB0aGUgY2xvc2luZyBwYXJ0eSB0cmFuc2ZlciwKICAgICAgICAvLyB0aGVuIGBjb3VudGVyX2Ftb3VudGAgbWF5IGJlIG5lZ2F0aXZlIGFuZCB0aGUgdHJhbnNmZXIgZmFpbHMsIGZvcmNlCiAgICAgICAgLy8gdGhlIHZhbHVlIHRvIDAuCiAgICAgICAgY291bnRlcl9hbW91bnQgPSBtYXgoY291bnRlcl9hbW91bnQsIDApOwoKICAgICAgICAvLyBBdCB0aGlzIHBvaW50IGBjb3VudGVyX2Ftb3VudGAgaXMgYmV0d2VlbiBbMCx0b3RhbF9kZXBvc2l0XSwgc28gdGhpcwogICAgICAgIC8vIGlzIHNhZmUuCiAgICAgICAgY2xvc2VyX2Ftb3VudCA9IHRvdGFsX2RlcG9zaXQgLSBjb3VudGVyX2Ftb3VudDsKCiAgICAgICAgaWYgKGNvdW50ZXJfYW1vdW50ID4gMCkgewogICAgICAgICAgICByZXF1aXJlKHNlbGYudG9rZW4udHJhbnNmZXIoY291bnRlcl9wYXJ0eS5ub2RlX2FkZHJlc3MsIGNvdW50ZXJfYW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY2xvc2VyX2Ftb3VudCA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShzZWxmLnRva2VuLnRyYW5zZmVyKGNsb3NpbmdfcGFydHkubm9kZV9hZGRyZXNzLCBjbG9zZXJfYW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICBraWxsKHNlbGYpOwogICAgfQoKICAgIC8vIE5PVEVTOgogICAgLy8KICAgIC8vIC0gVGhlIEVWTSBpcyBhIGJpZy1lbmRpYW4sIGJ5dGUgYWRkcmVzc2luZyBtYWNoaW5lLCB3aXRoIDMyYnl0ZXMvMjU2Yml0cwogICAgLy8gICB3b3Jkcy4KICAgIC8vIC0gVGhlIEV0aGVyZXVtIENvbnRyYWN0IEFCSSBzcGVjaWZpZXMgdGhhdCB2YXJpYWJsZSBsZW5ndGggdHlwZXMgaGF2ZSBhCiAgICAvLyAgIDMyYnl0ZXMgcHJlZml4IHRvIGRlZmluZSB0aGUgdmFyaWFibGUgc2l6ZS4KICAgIC8vIC0gU29saWRpdHkgaGFzIGFkZGl0aW9uYWwgZGF0YSB0eXBlcyB0aGF0IGFyZSBuYXJyb3dlciB0aGFuIDMyYnl0ZXMKICAgIC8vICAgKGUuZy4gdWludDEyOCB1c2VzIGEgaGFsZiB3b3JkKS4KICAgIC8vIC0gU29saWRpdHkgdXNlcyB0aGUgKmxlYXN0LXNpZ25pZmljYW50KiBiaXRzIG9mIHRoZSB3b3JkIHRvIHN0b3JlIHRoZQogICAgLy8gICB2YWx1ZXMgb2YgYSBuYXJyb3dlciB0eXBlLgogICAgLy8KICAgIC8vIEdFTkVSQUwgQVBQUk9BQ0g6CiAgICAvLwogICAgLy8gQWRkIHRvIHRoZSBtZXNzYWdlIHBvaW50ZXIgdGhlIG51bWJlciBvZiBieXRlcyByZXF1aXJlZCB0byBtb3ZlIHRoZQogICAgLy8gYWRkcmVzcyBzbyB0aGF0IHRoZSB0YXJnZXQgZGF0YSBpcyBhdCB0aGUgZW5kIG9mIHRoZSAzMmJ5dGVzIHdvcmQuCiAgICAvLwogICAgLy8gRVhBTVBMRToKICAgIC8vCiAgICAvLyBUbyBkZWNvZGUgdGhlIGNtZGlkLCBjb25zaWRlciB0aGlzIGluaXRpYWwgc3RhdGU6CiAgICAvLwogICAgLy8KICAgIC8vICAgICB2LSBwb2ludGVyIHdvcmQgc3RhcnQKICAgIC8vICAgICBbIDMyIGJ5dGVzIGxlbmd0aCBwcmVmaXggXVsgY21kaWQgXSAtLS0tCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF4tIHBvaW50ZXIgd29yZCBlbmQKICAgIC8vCiAgICAvLwogICAgLy8gQmVjYXVzZSB0aGUgY21kaWQgaGFzIDEgYnl0ZSBsZW5ndGggdGhlIHR5cGUgdWludDggaXMgdXNlZCwgdGhlIGRlY29kZXIKICAgIC8vIG5lZWRzIHRvIG1vdmUgdGhlIHBvaW50ZXIgc28gdGhlIGNtZGlkIGlzIGF0IHRoZSBlbmQgb2YgdGhlIHBvaW50ZXIKICAgIC8vIHdvcmQuCiAgICAvLwogICAgLy8KICAgIC8vICAgICAgICAgICAgIHYtIHBvaW50ZXIgd29yZCBzdGFydCBbbW92ZWQgMWJ5dGUgYWhlYWRdCiAgICAvLyAgICAgWyAzMiBieXRlcyBsZW5ndGggcHJlZml4IF1bIGNtZGlkIF0gLS0tLQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeLSBwb2ludGVyIHdvcmQgZW5kCiAgICAvLwogICAgLy8KICAgIC8vIE5vdyB0aGUgZGF0YSBvZiB0aGUgY21kaWQgY2FuIGJlIGxvYWRlZCB0byB0aGUgdWludDggdmFyaWFibGUuCiAgICAvLwogICAgLy8gUkVGRVJFTkNFUzoKICAgIC8vIC0gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL3dpa2kvd2lraS9FdGhlcmV1bS1Db250cmFjdC1BQkkKICAgIC8vIC0gaHR0cDovL3NvbGlkaXR5LnJlYWR0aGVkb2NzLmlvL2VuL2RldmVsb3AvYXNzZW1ibHkuaHRtbAoKICAgIGZ1bmN0aW9uIGRlY29kZUxvY2soYnl0ZXMgbG9jaykgaW50ZXJuYWwgcmV0dXJucyAodWludDY0IGV4cGlyYXRpb24sIHVpbnQgYW1vdW50LCBieXRlczMyIGhhc2hsb2NrKSB7CiAgICAgICAgcmVxdWlyZShsb2NrLmxlbmd0aCA9PSA3Mik7CgogICAgICAgIC8vIExvY2sgZm9ybWF0OgogICAgICAgIC8vIFswOjhdIGV4cGlyYXRpb24KICAgICAgICAvLyBbODo0MF0gYW1vdW50CiAgICAgICAgLy8gWzQwOjcyXSBoYXNobG9jawogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgZXhwaXJhdGlvbiA6PSBtbG9hZChhZGQobG9jaywgOCkpCiAgICAgICAgICAgIGFtb3VudCA6PSBtbG9hZChhZGQobG9jaywgNDApKQogICAgICAgICAgICBoYXNobG9jayA6PSBtbG9hZChhZGQobG9jaywgNzIpKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzaWduYXR1cmVTcGxpdChieXRlcyBzaWduYXR1cmUpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgciwgYnl0ZXMzMiBzLCB1aW50OCB2KSB7CiAgICAgICAgLy8gVGhlIHNpZ25hdHVyZSBmb3JtYXQgaXMgYSBjb21wYWN0IGZvcm0gb2Y6CiAgICAgICAgLy8gICB7Ynl0ZXMzMiByfXtieXRlczMyIHN9e3VpbnQ4IHZ9CiAgICAgICAgLy8gQ29tcGFjdCBtZWFucywgdWludDggaXMgbm90IHBhZGRlZCB0byAzMiBieXRlcy4KICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHIgOj0gbWxvYWQoYWRkKHNpZ25hdHVyZSwgMzIpKQogICAgICAgICAgICBzIDo9IG1sb2FkKGFkZChzaWduYXR1cmUsIDY0KSkKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcywgaW5jbHVkaW5nIDMxIGJ5dGVzCiAgICAgICAgICAgIC8vIG9mICdzJy4gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcy4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gJ2J5dGUnIGlzIG5vdCB3b3JraW5nIGR1ZSB0byB0aGUgU29saWRpdHkgcGFyc2VyLCBzbyBsZXRzCiAgICAgICAgICAgIC8vIHVzZSB0aGUgc2Vjb25kIGJlc3Qgb3B0aW9uLCAnYW5kJwogICAgICAgICAgICB2IDo9IGFuZChtbG9hZChhZGQoc2lnbmF0dXJlLCA2NSkpLCAweGZmKQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZSh2ID09IDI3IHx8IHYgPT0gMjgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4X29yX3Rocm93KERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHBhcnRpY2lwYW50X2FkZHJlc3MpIHByaXZhdGUgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50OCBuOwogICAgICAgIC8vIFJldHVybiBpbmRleCBvZiBwYXJ0aWNpcGFudCwgb3IgdGhyb3cKICAgICAgICBuID0gc2VsZi5wYXJ0aWNpcGFudF9pbmRleFtwYXJ0aWNpcGFudF9hZGRyZXNzXTsKICAgICAgICBhc3NlcnQobiAhPSAwKTsKICAgICAgICByZXR1cm4gbiAtIDE7CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPiBiID8gYiA6IGE7CiAgICB9CgogICAgZnVuY3Rpb24gbWF4KHVpbnQgYSwgdWludCBiKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPiBiID8gYSA6IGI7CiAgICB9CgogICAgZnVuY3Rpb24ga2lsbChEYXRhIHN0b3JhZ2Ugc2VsZikgY2hhbm5lbFNldHRsZWQoc2VsZikgewogICAgICAgIHNlbGZkZXN0cnVjdCgweDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgIH0KfQoKY29udHJhY3QgTmV0dGluZ0NoYW5uZWxDb250cmFjdCB7CiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIGNvbnRyYWN0X3ZlcnNpb24gPSAiMC4xLl8iOwoKICAgIHVzaW5nIE5ldHRpbmdDaGFubmVsTGlicmFyeSBmb3IgTmV0dGluZ0NoYW5uZWxMaWJyYXJ5LkRhdGE7CiAgICBOZXR0aW5nQ2hhbm5lbExpYnJhcnkuRGF0YSBwdWJsaWMgZGF0YTsKCiAgICBldmVudCBDaGFubmVsTmV3QmFsYW5jZShhZGRyZXNzIHRva2VuX2FkZHJlc3MsIGFkZHJlc3MgcGFydGljaXBhbnQsIHVpbnQgYmFsYW5jZSwgdWludCBibG9ja19udW1iZXIpOwogICAgZXZlbnQgQ2hhbm5lbENsb3NlZChhZGRyZXNzIGNsb3NpbmdfYWRkcmVzcywgdWludCBibG9ja19udW1iZXIpOwogICAgZXZlbnQgVHJhbnNmZXJVcGRhdGVkKGFkZHJlc3Mgbm9kZV9hZGRyZXNzLCB1aW50IGJsb2NrX251bWJlcik7CiAgICBldmVudCBDaGFubmVsU2V0dGxlZCh1aW50IGJsb2NrX251bWJlcik7CiAgICBldmVudCBDaGFubmVsU2VjcmV0UmV2ZWFsZWQoYnl0ZXMzMiBzZWNyZXQsIGFkZHJlc3MgcmVjZWl2ZXJfYWRkcmVzcyk7CgogICAgbW9kaWZpZXIgc2V0dGxlVGltZW91dE5vdFRvb0xvdyh1aW50IHQpIHsKICAgICAgICBhc3NlcnQodCA+PSA2KTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIE5ldHRpbmdDaGFubmVsQ29udHJhY3QoCiAgICAgICAgYWRkcmVzcyB0b2tlbl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgcGFydGljaXBhbnQxLAogICAgICAgIGFkZHJlc3MgcGFydGljaXBhbnQyLAogICAgICAgIHVpbnQgdGltZW91dCkKICAgICAgICBzZXR0bGVUaW1lb3V0Tm90VG9vTG93KHRpbWVvdXQpCiAgICB7CiAgICAgICAgcmVxdWlyZShwYXJ0aWNpcGFudDEgIT0gcGFydGljaXBhbnQyKTsKCiAgICAgICAgZGF0YS5wYXJ0aWNpcGFudHNbMF0ubm9kZV9hZGRyZXNzID0gcGFydGljaXBhbnQxOwogICAgICAgIGRhdGEucGFydGljaXBhbnRzWzFdLm5vZGVfYWRkcmVzcyA9IHBhcnRpY2lwYW50MjsKICAgICAgICBkYXRhLnBhcnRpY2lwYW50X2luZGV4W3BhcnRpY2lwYW50MV0gPSAxOwogICAgICAgIGRhdGEucGFydGljaXBhbnRfaW5kZXhbcGFydGljaXBhbnQyXSA9IDI7CgogICAgICAgIGRhdGEudG9rZW4gPSBUb2tlbih0b2tlbl9hZGRyZXNzKTsKICAgICAgICBkYXRhLnNldHRsZV90aW1lb3V0ID0gdGltZW91dDsKICAgICAgICBkYXRhLm9wZW5lZCA9IGJsb2NrLm51bWJlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxsZXIgbWFrZXMgYSBkZXBvc2l0IGludG8gdGhlaXIgY2hhbm5lbCBiYWxhbmNlLgogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBjYWxsZXIgd2FudHMgdG8gZGVwb3NpdC4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgZGVwb3NpdCBpcyBzdWNjZXNzZnVsLgogICAgZnVuY3Rpb24gZGVwb3NpdCh1aW50MjU2IGFtb3VudCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc3VjY2VzczsKICAgICAgICB1aW50MjU2IGJhbGFuY2U7CgogICAgICAgIChzdWNjZXNzLCBiYWxhbmNlKSA9IGRhdGEuZGVwb3NpdChhbW91bnQpOwoKICAgICAgICBpZiAoc3VjY2VzcyA9PSB0cnVlKSB7CiAgICAgICAgICAgIENoYW5uZWxOZXdCYWxhbmNlKGRhdGEudG9rZW4sIG1zZy5zZW5kZXIsIGJhbGFuY2UsIGJsb2NrLm51bWJlcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3VjY2VzczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIGFkZHJlc3MgYW5kIGJhbGFuY2Ugb2YgYm90aCBwYXJ0bmVycyBpbiBhIGNoYW5uZWwuCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBhbmQgYmFsYW5jZSBwYWlycy4KICAgIGZ1bmN0aW9uIGFkZHJlc3NBbmRCYWxhbmNlKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgcGFydGljaXBhbnQxLAogICAgICAgIHVpbnQgYmFsYW5jZTEsCiAgICAgICAgYWRkcmVzcyBwYXJ0aWNpcGFudDIsCiAgICAgICAgdWludCBiYWxhbmNlMikKICAgIHsKICAgICAgICBOZXR0aW5nQ2hhbm5lbExpYnJhcnkuUGFydGljaXBhbnQgc3RvcmFnZSBub2RlMSA9IGRhdGEucGFydGljaXBhbnRzWzBdOwogICAgICAgIE5ldHRpbmdDaGFubmVsTGlicmFyeS5QYXJ0aWNpcGFudCBzdG9yYWdlIG5vZGUyID0gZGF0YS5wYXJ0aWNpcGFudHNbMV07CgogICAgICAgIHBhcnRpY2lwYW50MSA9IG5vZGUxLm5vZGVfYWRkcmVzczsKICAgICAgICBiYWxhbmNlMSA9IG5vZGUxLmJhbGFuY2U7CiAgICAgICAgcGFydGljaXBhbnQyID0gbm9kZTIubm9kZV9hZGRyZXNzOwogICAgICAgIGJhbGFuY2UyID0gbm9kZTIuYmFsYW5jZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDbG9zZSB0aGUgY2hhbm5lbC4gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGEgcGFydGljaXBhbnQgaW4gdGhlIGNoYW5uZWwuCiAgICBmdW5jdGlvbiBjbG9zZSgKICAgICAgICB1aW50NjQgbm9uY2UsCiAgICAgICAgdWludDI1NiB0cmFuc2ZlcnJlZF9hbW91bnQsCiAgICAgICAgYnl0ZXMzMiBsb2Nrc3Jvb3QsCiAgICAgICAgYnl0ZXMzMiBleHRyYV9oYXNoLAogICAgICAgIGJ5dGVzIHNpZ25hdHVyZQogICAgKSB7CiAgICAgICAgZGF0YS5jbG9zZSgKICAgICAgICAgICAgbm9uY2UsCiAgICAgICAgICAgIHRyYW5zZmVycmVkX2Ftb3VudCwKICAgICAgICAgICAgbG9ja3Nyb290LAogICAgICAgICAgICBleHRyYV9oYXNoLAogICAgICAgICAgICBzaWduYXR1cmUKICAgICAgICApOwogICAgICAgIENoYW5uZWxDbG9zZWQobXNnLnNlbmRlciwgZGF0YS5jbG9zZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIERpc3B1dGUgdGhlIHN0YXRlIGFmdGVyIGNsb3NpbmcsIGNhbGxlZCBieSB0aGUgY291bnRlcnBhcnR5ICh0aGUKICAgIC8vLyAgICAgICAgIHBhcnRpY2lwYW50IHdobyBkaWQgbm90IGNsb3NlIHRoZSBjaGFubmVsKS4KICAgIGZ1bmN0aW9uIHVwZGF0ZVRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBub25jZSwKICAgICAgICB1aW50MjU2IHRyYW5zZmVycmVkX2Ftb3VudCwKICAgICAgICBieXRlczMyIGxvY2tzcm9vdCwKICAgICAgICBieXRlczMyIGV4dHJhX2hhc2gsCiAgICAgICAgYnl0ZXMgc2lnbmF0dXJlCiAgICApIHsKICAgICAgICBkYXRhLnVwZGF0ZVRyYW5zZmVyKAogICAgICAgICAgICBub25jZSwKICAgICAgICAgICAgdHJhbnNmZXJyZWRfYW1vdW50LAogICAgICAgICAgICBsb2Nrc3Jvb3QsCiAgICAgICAgICAgIGV4dHJhX2hhc2gsCiAgICAgICAgICAgIHNpZ25hdHVyZQogICAgICAgICk7CiAgICAgICAgVHJhbnNmZXJVcGRhdGVkKG1zZy5zZW5kZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVW5sb2NrIGEgbG9ja2VkIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBsb2NrZWRfZW5jb2RlZCBUaGUgbG9ja2VkIHRyYW5zZmVyIHRvIGJlIHVubG9ja2VkLgogICAgLy8vIEBwYXJhbSBtZXJrbGVfcHJvb2YgVGhlIG1lcmtlX3Byb29mIGZvciB0aGUgbG9ja2VkIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBzZWNyZXQgVGhlIHNlY3JldCB0byB1bmxvY2sgdGhlIGxvY2tlZCB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KGJ5dGVzIGxvY2tlZF9lbmNvZGVkLCBieXRlcyBtZXJrbGVfcHJvb2YsIGJ5dGVzMzIgc2VjcmV0KSB7CiAgICAgICAgLy8gdGhyb3dzIGlmIHNlbmRlciBpcyBub3QgYSBwYXJ0aWNpcGFudAogICAgICAgIGRhdGEud2l0aGRyYXcobG9ja2VkX2VuY29kZWQsIG1lcmtsZV9wcm9vZiwgc2VjcmV0KTsKICAgICAgICBDaGFubmVsU2VjcmV0UmV2ZWFsZWQoc2VjcmV0LCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXR0bGUgdGhlIHRyYW5zZmVycyBhbmQgYmFsYW5jZXMgb2YgdGhlIGNoYW5uZWwgYW5kIHBheSBvdXQgdG8KICAgIC8vLyAgICAgICAgIGVhY2ggcGFydGljaXBhbnQuIENhbiBvbmx5IGJlIGNhbGxlZCBhZnRlciB0aGUgY2hhbm5lbCBpcyBjbG9zZWQKICAgIC8vLyAgICAgICAgIGFuZCBvbmx5IGFmdGVyIHRoZSBudW1iZXIgb2YgYmxvY2tzIGluIHRoZSBzZXR0bGVtZW50IHRpbWVvdXQKICAgIC8vLyAgICAgICAgIGhhdmUgcGFzc2VkLgogICAgZnVuY3Rpb24gc2V0dGxlKCkgewogICAgICAgIGRhdGEuc2V0dGxlKCk7CiAgICAgICAgQ2hhbm5lbFNldHRsZWQoZGF0YS5zZXR0bGVkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYmxvY2tzIHVudGlsIHRoZSBzZXR0bGVtZW50IHRpbWVvdXQuCiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIGJsb2NrcyB1bnRpbCB0aGUgc2V0dGxlbWVudCB0aW1lb3V0LgogICAgZnVuY3Rpb24gc2V0dGxlVGltZW91dCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZGF0YS5zZXR0bGVfdGltZW91dDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbi4KICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbi4KICAgIGZ1bmN0aW9uIHRva2VuQWRkcmVzcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gZGF0YS50b2tlbjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBibG9jayBudW1iZXIgZm9yIHdoZW4gdGhlIGNoYW5uZWwgd2FzIG9wZW5lZC4KICAgIC8vLyBAcmV0dXJuIFRoZSBibG9jayBudW1iZXIgZm9yIHdoZW4gdGhlIGNoYW5uZWwgd2FzIG9wZW5lZC4KICAgIGZ1bmN0aW9uIG9wZW5lZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZGF0YS5vcGVuZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYmxvY2sgbnVtYmVyIGZvciB3aGVuIHRoZSBjaGFubmVsIHdhcyBjbG9zZWQuCiAgICAvLy8gQHJldHVybiBUaGUgYmxvY2sgbnVtYmVyIGZvciB3aGVuIHRoZSBjaGFubmVsIHdhcyBjbG9zZWQuCiAgICBmdW5jdGlvbiBjbG9zZWQoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGRhdGEuY2xvc2VkOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGJsb2NrIG51bWJlciBmb3Igd2hlbiB0aGUgY2hhbm5lbCB3YXMgc2V0dGxlZC4KICAgIC8vLyBAcmV0dXJuIFRoZSBibG9jayBudW1iZXIgZm9yIHdoZW4gdGhlIGNoYW5uZWwgd2FzIHNldHRsZWQuCiAgICBmdW5jdGlvbiBzZXR0bGVkKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBkYXRhLnNldHRsZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYWRkcmVzcyBvZiB0aGUgY2xvc2luZyBwYXJ0aWNpcGFudC4KICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBjbG9zaW5nIHBhcnRpY2lwYW50LgogICAgZnVuY3Rpb24gY2xvc2luZ0FkZHJlc3MoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuY2xvc2luZ19hZGRyZXNzOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHsgcmV2ZXJ0KCk7IH0KfQoKbGlicmFyeSBDaGFubmVsTWFuYWdlckxpYnJhcnkgewogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBjb250cmFjdF92ZXJzaW9uID0gIjAuMS5fIjsKCiAgICBzdHJ1Y3QgRGF0YSB7CiAgICAgICAgVG9rZW4gdG9rZW47CgogICAgICAgIGFkZHJlc3NbXSBhbGxfY2hhbm5lbHM7CiAgICAgICAgbWFwcGluZyhieXRlczMyID0+IHVpbnQpIHBhcnR5aGFzaF90b19jaGFubmVscG9zOwoKICAgICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYWRkcmVzc1tdKSBub2RlYWRkcmVzc190b19jaGFubmVsYWRkcmVzc2VzOwogICAgICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkpIG5vZGVfaW5kZXg7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0IHRoZSBhZGRyZXNzIG9mIGNoYW5uZWwgd2l0aCBhIHBhcnRuZXIKICAgIC8vLyBAcGFyYW0gcGFydG5lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGFydG5lcgogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIGNoYW5uZWwKICAgIGZ1bmN0aW9uIGdldENoYW5uZWxXaXRoKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHBhcnRuZXIpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHBhcnR5X2hhc2ggPSBwYXJ0eUhhc2gobXNnLnNlbmRlciwgcGFydG5lcik7CiAgICAgICAgdWludCBjaGFubmVsX3BvcyA9IHNlbGYucGFydHloYXNoX3RvX2NoYW5uZWxwb3NbcGFydHlfaGFzaF07CgogICAgICAgIGlmIChjaGFubmVsX3BvcyAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmFsbF9jaGFubmVsc1tjaGFubmVsX3BvcyAtIDFdOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcgcGF5bWVudCBjaGFubmVsIGJldHdlZW4gdHdvIHBhcnRpZXMKICAgIC8vLyBAcGFyYW0gcGFydG5lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGFydG5lcgogICAgLy8vIEBwYXJhbSBzZXR0bGVfdGltZW91dCBUaGUgc2V0dGxlIHRpbWVvdXQgaW4gYmxvY2tzCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3bHkgY3JlYXRlZCBOZXR0aW5nQ2hhbm5lbENvbnRyYWN0LgogICAgZnVuY3Rpb24gbmV3Q2hhbm5lbChEYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBwYXJ0bmVyLCB1aW50IHNldHRsZV90aW1lb3V0KQogICAgICAgIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgICAgYWRkcmVzc1tdIHN0b3JhZ2UgY2FsbGVyX2NoYW5uZWxzID0gc2VsZi5ub2RlYWRkcmVzc190b19jaGFubmVsYWRkcmVzc2VzW21zZy5zZW5kZXJdOwogICAgICAgIGFkZHJlc3NbXSBzdG9yYWdlIHBhcnRuZXJfY2hhbm5lbHMgPSBzZWxmLm5vZGVhZGRyZXNzX3RvX2NoYW5uZWxhZGRyZXNzZXNbcGFydG5lcl07CgogICAgICAgIGJ5dGVzMzIgcGFydHlfaGFzaCA9IHBhcnR5SGFzaChtc2cuc2VuZGVyLCBwYXJ0bmVyKTsKICAgICAgICB1aW50IGNoYW5uZWxfcG9zID0gc2VsZi5wYXJ0eWhhc2hfdG9fY2hhbm5lbHBvc1twYXJ0eV9oYXNoXTsKCiAgICAgICAgYWRkcmVzcyBuZXdfY2hhbm5lbF9hZGRyZXNzID0gbmV3IE5ldHRpbmdDaGFubmVsQ29udHJhY3QoCiAgICAgICAgICAgIHNlbGYudG9rZW4sCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHBhcnRuZXIsCiAgICAgICAgICAgIHNldHRsZV90aW1lb3V0CiAgICAgICAgKTsKCiAgICAgICAgaWYgKGNoYW5uZWxfcG9zICE9IDApIHsKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNoYW5uZWwgd2FzIHNldHRsZWQuIE9uY2UgYSBjaGFubmVsIGlzIHNldHRsZWQgaXQKICAgICAgICAgICAgLy8ga2lsbHMgaXRzZWxmLCBzbyBhZGRyZXNzIG11c3Qgbm90IGhhdmUgY29kZS4KICAgICAgICAgICAgYWRkcmVzcyBzZXR0bGVkX2NoYW5uZWwgPSBzZWxmLmFsbF9jaGFubmVsc1tjaGFubmVsX3BvcyAtIDFdOwogICAgICAgICAgICByZXF1aXJlKCFjb250cmFjdEV4aXN0cyhzZXR0bGVkX2NoYW5uZWwpKTsKCiAgICAgICAgICAgIHVpbnQgY2FsbGVyX3BvcyA9IHNlbGYubm9kZV9pbmRleFttc2cuc2VuZGVyXVtwYXJ0bmVyXTsKICAgICAgICAgICAgdWludCBwYXJ0bmVyX3BvcyA9IHNlbGYubm9kZV9pbmRleFtwYXJ0bmVyXVttc2cuc2VuZGVyXTsKCiAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGNoYW5uZWwgYWRkcmVzcyBpbi1wbGFjZQogICAgICAgICAgICBzZWxmLmFsbF9jaGFubmVsc1tjaGFubmVsX3BvcyAtIDFdID0gbmV3X2NoYW5uZWxfYWRkcmVzczsKICAgICAgICAgICAgY2FsbGVyX2NoYW5uZWxzW2NhbGxlcl9wb3MgLSAxXSA9IG5ld19jaGFubmVsX2FkZHJlc3M7CiAgICAgICAgICAgIHBhcnRuZXJfY2hhbm5lbHNbcGFydG5lcl9wb3MgLSAxXSA9IG5ld19jaGFubmVsX2FkZHJlc3M7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuYWxsX2NoYW5uZWxzLnB1c2gobmV3X2NoYW5uZWxfYWRkcmVzcyk7CiAgICAgICAgICAgIGNhbGxlcl9jaGFubmVscy5wdXNoKG5ld19jaGFubmVsX2FkZHJlc3MpOwogICAgICAgICAgICBwYXJ0bmVyX2NoYW5uZWxzLnB1c2gobmV3X2NoYW5uZWxfYWRkcmVzcyk7CgogICAgICAgICAgICAvLyB1c2luZyB0aGUgMS1pbmRleCwgMCBpcyB1c2VkIGZvciB0aGUgYWJzZW5jZSBvZiBhIHZhbHVlCiAgICAgICAgICAgIHNlbGYucGFydHloYXNoX3RvX2NoYW5uZWxwb3NbcGFydHlfaGFzaF0gPSBzZWxmLmFsbF9jaGFubmVscy5sZW5ndGg7CiAgICAgICAgICAgIHNlbGYubm9kZV9pbmRleFttc2cuc2VuZGVyXVtwYXJ0bmVyXSA9IGNhbGxlcl9jaGFubmVscy5sZW5ndGg7CiAgICAgICAgICAgIHNlbGYubm9kZV9pbmRleFtwYXJ0bmVyXVttc2cuc2VuZGVyXSA9IHBhcnRuZXJfY2hhbm5lbHMubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ld19jaGFubmVsX2FkZHJlc3M7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0IHRoZSBoYXNoIG9mIHRoZSB0d28gYWRkcmVzc2VzCiAgICAvLy8gQHBhcmFtIGFkZHJlc3Nfb25lIGFkZHJlc3Mgb2Ygb25lIHBhcnR5CiAgICAvLy8gQHBhcmFtIGFkZHJlc3NfdHdvIG9mIHRoZSBvdGhlciBwYXJ0eQogICAgLy8vIEByZXR1cm4gVGhlIHNoYTMgaGFzaCBvZiBib3RoIHBhcnRpZXMgc29ydGVkIGJ5IHNpemUgb2YgYWRkcmVzcwogICAgZnVuY3Rpb24gcGFydHlIYXNoKGFkZHJlc3MgYWRkcmVzc19vbmUsIGFkZHJlc3MgYWRkcmVzc190d28pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBpZiAoYWRkcmVzc19vbmUgPCBhZGRyZXNzX3R3bykgewogICAgICAgICAgICByZXR1cm4gc2hhMyhhZGRyZXNzX29uZSwgYWRkcmVzc190d28pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFRoZSB0d28gcGFydGljaXBhbnRzIGNhbid0IGJlIHRoZSBzYW1lIGhlcmUgZHVlIHRvIHRoaXMgY2hlY2sgaW4KICAgICAgICAgICAgLy8gdGhlIG5ldHRpbmcgY2hhbm5lbCBjb25zdHJ1Y3RvcjoKICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JhaWRlbi1uZXR3b3JrL3JhaWRlbi9ibG9iL2UxN2Q5NmRiMzc1ZDMxYjEzNGFlN2I0ZTJhZDJjMWY5MDViNDc4NTcvcmFpZGVuL3NtYXJ0X2NvbnRyYWN0cy9OZXR0aW5nQ2hhbm5lbENvbnRyYWN0LnNvbCNMMjcKICAgICAgICAgICAgcmV0dXJuIHNoYTMoYWRkcmVzc190d28sIGFkZHJlc3Nfb25lKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIFRPRE86IEZpbmQgYSB3YXkgdG8gcmVtb3ZlIHRoaXMgZnVuY3Rpb24gZHVwbGljYXRpb24gZnJvbSBVdGlscy5zb2wgaGVyZQogICAgLy8vICAgICAgIEF0IHRoZSBtb21lbnQgbGlicmFyaWVzIGNhbid0IGluaGVyaXQgc28gd2UgbmVlZCB0byBhZGQgdGhpcyBoZXJlCiAgICAvLy8gICAgICAgZXhwbGljaXRseS4KICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGEgY29udHJhY3QgZXhpc3RzCiAgICAvLy8gQHBhcmFtIGNoYW5uZWwgVGhlIGFkZHJlc3MgdG8gY2hlY2sgd2hldGhlciBhIGNvbnRyYWN0IGlzIGRlcGxveWVkIG9yIG5vdAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBhIGNvbnRyYWN0IGV4aXN0cywgZmFsc2Ugb3RoZXJ3aXNlCiAgICBmdW5jdGlvbiBjb250cmFjdEV4aXN0cyhhZGRyZXNzIGNoYW5uZWwpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKGNoYW5uZWwpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2l6ZSA+IDA7CiAgICB9Cn0KCi8vIGZvciBlYWNoIHRva2VuIGEgbWFuYWdlciB3aWxsIGJlIGRlcGxveWVkLCB0byByZWR1Y2UgZ2FzIHVzYWdlIGZvciBtYW5hZ2VyCi8vIGRlcGxveW1lbnQgdGhlIGxvZ2ljIGlzIG1vdmVkIGludG8gYSBsaWJyYXJ5IGFuZCB0aGlzIGNvbnRyYWN0IHdpbGwgd29yawovLyBvbmx5IGFzIGEgcHJveHkvc3RhdGUgY29udGFpbmVyLgpjb250cmFjdCBDaGFubmVsTWFuYWdlckNvbnRyYWN0IGlzIFV0aWxzIHsKICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgY29udHJhY3RfdmVyc2lvbiA9ICIwLjEuXyI7CgogICAgdXNpbmcgQ2hhbm5lbE1hbmFnZXJMaWJyYXJ5IGZvciBDaGFubmVsTWFuYWdlckxpYnJhcnkuRGF0YTsKICAgIENoYW5uZWxNYW5hZ2VyTGlicmFyeS5EYXRhIGRhdGE7CgogICAgZXZlbnQgQ2hhbm5lbE5ldygKICAgICAgICBhZGRyZXNzIG5ldHRpbmdfY2hhbm5lbCwKICAgICAgICBhZGRyZXNzIHBhcnRpY2lwYW50MSwKICAgICAgICBhZGRyZXNzIHBhcnRpY2lwYW50MiwKICAgICAgICB1aW50IHNldHRsZV90aW1lb3V0CiAgICApOwoKICAgIGV2ZW50IENoYW5uZWxEZWxldGVkKAogICAgICAgIGFkZHJlc3MgY2FsbGVyX2FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBwYXJ0bmVyCiAgICApOwoKICAgIGZ1bmN0aW9uIENoYW5uZWxNYW5hZ2VyQ29udHJhY3QoYWRkcmVzcyB0b2tlbl9hZGRyZXNzKSB7CiAgICAgICAgZGF0YS50b2tlbiA9IFRva2VuKHRva2VuX2FkZHJlc3MpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldCBhbGwgY2hhbm5lbHMKICAgIC8vLyBAcmV0dXJuIEFsbCB0aGUgb3BlbiBjaGFubmVscwogICAgZnVuY3Rpb24gZ2V0Q2hhbm5lbHNBZGRyZXNzZXMoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gZGF0YS5hbGxfY2hhbm5lbHM7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0IGFsbCBwYXJ0aWNpcGFudHMgb2YgYWxsIGNoYW5uZWxzCiAgICAvLy8gQHJldHVybiBBbGwgcGFydGljaXBhbnRzIGluIGFsbCBjaGFubmVscwogICAgZnVuY3Rpb24gZ2V0Q2hhbm5lbHNQYXJ0aWNpcGFudHMoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICB1aW50IGk7CiAgICAgICAgdWludCBwb3M7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSByZXN1bHQ7CiAgICAgICAgTmV0dGluZ0NoYW5uZWxDb250cmFjdCBjaGFubmVsOwoKICAgICAgICB1aW50IG9wZW5fY2hhbm5lbHNfbnVtID0gMDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YS5hbGxfY2hhbm5lbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbnRyYWN0RXhpc3RzKGRhdGEuYWxsX2NoYW5uZWxzW2ldKSkgewogICAgICAgICAgICAgICAgb3Blbl9jaGFubmVsc19udW0gKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBuZXcgYWRkcmVzc1tdKG9wZW5fY2hhbm5lbHNfbnVtICogMik7CgogICAgICAgIHBvcyA9IDA7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGEuYWxsX2NoYW5uZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghY29udHJhY3RFeGlzdHMoZGF0YS5hbGxfY2hhbm5lbHNbaV0pKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFubmVsID0gTmV0dGluZ0NoYW5uZWxDb250cmFjdChkYXRhLmFsbF9jaGFubmVsc1tpXSk7CgogICAgICAgICAgICB2YXIgKGFkZHJlc3MxLCAsIGFkZHJlc3MyLCApID0gY2hhbm5lbC5hZGRyZXNzQW5kQmFsYW5jZSgpOwoKICAgICAgICAgICAgcmVzdWx0W3Bvc10gPSBhZGRyZXNzMTsKICAgICAgICAgICAgcG9zICs9IDE7CiAgICAgICAgICAgIHJlc3VsdFtwb3NdID0gYWRkcmVzczI7CiAgICAgICAgICAgIHBvcyArPSAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgYWxsIGNoYW5uZWxzIHRoYXQgYW4gYWRkcmVzcyBwYXJ0aWNpcGF0ZXMgaW4uCiAgICAvLy8gQHBhcmFtIG5vZGVfYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgbm9kZQogICAgLy8vIEByZXR1cm4gVGhlIGNoYW5uZWwncyBhZGRyZXNzZXMgdGhhdCBub2RlX2FkZHJlc3MgcGFydGljaXBhdGVzIGluLgogICAgZnVuY3Rpb24gbmV0dGluZ0NvbnRyYWN0c0J5QWRkcmVzcyhhZGRyZXNzIG5vZGVfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIGRhdGEubm9kZWFkZHJlc3NfdG9fY2hhbm5lbGFkZHJlc3Nlc1tub2RlX2FkZHJlc3NdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgYWRkcmVzcyBvZiB0aGUgY2hhbm5lbCB0b2tlbgogICAgLy8vIEByZXR1cm4gVGhlIHRva2VuCiAgICBmdW5jdGlvbiB0b2tlbkFkZHJlc3MoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEudG9rZW47CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0IHRoZSBhZGRyZXNzIG9mIGNoYW5uZWwgd2l0aCBhIHBhcnRuZXIKICAgIC8vLyBAcGFyYW0gcGFydG5lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGFydG5lcgogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIGNoYW5uZWwKICAgIGZ1bmN0aW9uIGdldENoYW5uZWxXaXRoKGFkZHJlc3MgcGFydG5lcikgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBkYXRhLmdldENoYW5uZWxXaXRoKHBhcnRuZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENyZWF0ZSBhIG5ldyBwYXltZW50IGNoYW5uZWwgYmV0d2VlbiB0d28gcGFydGllcwogICAgLy8vIEBwYXJhbSBwYXJ0bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwYXJ0bmVyCiAgICAvLy8gQHBhcmFtIHNldHRsZV90aW1lb3V0IFRoZSBzZXR0bGUgdGltZW91dCBpbiBibG9ja3MKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXdseSBjcmVhdGVkIE5ldHRpbmdDaGFubmVsQ29udHJhY3QuCiAgICBmdW5jdGlvbiBuZXdDaGFubmVsKGFkZHJlc3MgcGFydG5lciwgdWludCBzZXR0bGVfdGltZW91dCkgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIGFkZHJlc3Mgb2xkX2NoYW5uZWwgPSBnZXRDaGFubmVsV2l0aChwYXJ0bmVyKTsKICAgICAgICBpZiAob2xkX2NoYW5uZWwgIT0gMCkgewogICAgICAgICAgICBDaGFubmVsRGVsZXRlZChtc2cuc2VuZGVyLCBwYXJ0bmVyKTsKICAgICAgICB9CgogICAgICAgIGFkZHJlc3MgbmV3X2NoYW5uZWwgPSBkYXRhLm5ld0NoYW5uZWwocGFydG5lciwgc2V0dGxlX3RpbWVvdXQpOwogICAgICAgIENoYW5uZWxOZXcobmV3X2NoYW5uZWwsIG1zZy5zZW5kZXIsIHBhcnRuZXIsIHNldHRsZV90aW1lb3V0KTsKICAgICAgICByZXR1cm4gbmV3X2NoYW5uZWw7CiAgICB9CgogICAgZnVuY3Rpb24gKCkgeyByZXZlcnQoKTsgfQp9Cgpjb250cmFjdCBSZWdpc3RyeSB7CiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIGNvbnRyYWN0X3ZlcnNpb24gPSAiMC4xLl8iOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBhZGRyZXNzKSBwdWJsaWMgcmVnaXN0cnk7CiAgICBhZGRyZXNzW10gcHVibGljIHRva2VuczsKCiAgICBldmVudCBUb2tlbkFkZGVkKGFkZHJlc3MgdG9rZW5fYWRkcmVzcywgYWRkcmVzcyBjaGFubmVsX21hbmFnZXJfYWRkcmVzcyk7CgogICAgbW9kaWZpZXIgYWRkcmVzc0V4aXN0cyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShyZWdpc3RyeVtfYWRkcmVzc10gIT0gMHgwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGRvZXNOb3RFeGlzdChhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbHJlYWR5IHJlZ2lzdGVyZWQgb3IgdG9rZW4gY29udHJhY3QgaXMgaW52YWxpZC4KICAgICAgICAvLyBXZSBhc3N1bWUgaWYgaXQgaGFzIGEgdmFsaWQgdG90YWxTdXBwbHkoKSBmdW5jdGlvbiBpdCdzIGEgdmFsaWQgVG9rZW4gY29udHJhY3QKICAgICAgICByZXF1aXJlKHJlZ2lzdHJ5W19hZGRyZXNzXSA9PSAweDApOwogICAgICAgIFRva2VuIHRva2VuID0gVG9rZW4oX2FkZHJlc3MpOwogICAgICAgIHRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZWdpc3RlciBhIG5ldyBFUkMyMCB0b2tlbgogICAgLy8vIEBwYXJhbSB0b2tlbl9hZGRyZXNzIEFkZHJlc3Mgb2YgdGhlIHRva2VuCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgY2hhbm5lbCBtYW5hZ2VyCiAgICBmdW5jdGlvbiBhZGRUb2tlbihhZGRyZXNzIHRva2VuX2FkZHJlc3MpCiAgICAgICAgZG9lc05vdEV4aXN0KHRva2VuX2FkZHJlc3MpCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcykKICAgIHsKICAgICAgICBhZGRyZXNzIG1hbmFnZXJfYWRkcmVzczsKCiAgICAgICAgbWFuYWdlcl9hZGRyZXNzID0gbmV3IENoYW5uZWxNYW5hZ2VyQ29udHJhY3QodG9rZW5fYWRkcmVzcyk7CgogICAgICAgIHJlZ2lzdHJ5W3Rva2VuX2FkZHJlc3NdID0gbWFuYWdlcl9hZGRyZXNzOwogICAgICAgIHRva2Vucy5wdXNoKHRva2VuX2FkZHJlc3MpOwoKICAgICAgICBUb2tlbkFkZGVkKHRva2VuX2FkZHJlc3MsIG1hbmFnZXJfYWRkcmVzcyk7CgogICAgICAgIHJldHVybiBtYW5hZ2VyX2FkZHJlc3M7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0IHRoZSBDaGFubmVsTWFuYWdlciBhZGRyZXNzIGZvciBhIHNwZWNpZmljIHRva2VuCiAgICAvLy8gQHBhcmFtIHRva2VuX2FkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGdpdmVuIHRva2VuCiAgICAvLy8gQHJldHVybiBBZGRyZXNzIG9mIGNoYW5uZWwgbWFuYWdlcgogICAgZnVuY3Rpb24gY2hhbm5lbE1hbmFnZXJCeVRva2VuKGFkZHJlc3MgdG9rZW5fYWRkcmVzcykKICAgICAgICBhZGRyZXNzRXhpc3RzKHRva2VuX2FkZHJlc3MpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIHJldHVybiByZWdpc3RyeVt0b2tlbl9hZGRyZXNzXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgYWxsIHJlZ2lzdGVyZWQgdG9rZW5zCiAgICAvLy8gQHJldHVybiBhZGRyZXNzZXMgb2YgYWxsIHJlZ2lzdGVyZWQgdG9rZW5zCiAgICBmdW5jdGlvbiB0b2tlbkFkZHJlc3NlcygpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10pCiAgICB7CiAgICAgICAgcmV0dXJuIHRva2VuczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIGFkZHJlc3NlcyBvZiBhbGwgY2hhbm5lbCBtYW5hZ2VycyBmb3IgYWxsIHJlZ2lzdGVyZWQgdG9rZW5zCiAgICAvLy8gQHJldHVybiBhZGRyZXNzZXMgb2YgYWxsIGNoYW5uZWwgbWFuYWdlcnMKICAgIGZ1bmN0aW9uIGNoYW5uZWxNYW5hZ2VyQWRkcmVzc2VzKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICB1aW50IGk7CiAgICAgICAgYWRkcmVzcyB0b2tlbl9hZGRyZXNzOwogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgcmVzdWx0OwoKICAgICAgICByZXN1bHQgPSBuZXcgYWRkcmVzc1tdKHRva2Vucy5sZW5ndGgpOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRva2VuX2FkZHJlc3MgPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHJlc3VsdFtpXSA9IHJlZ2lzdHJ5W3Rva2VuX2FkZHJlc3NdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBmdW5jdGlvbiAoKSB7IHJldmVydCgpOyB9Cn0='.
	

]
