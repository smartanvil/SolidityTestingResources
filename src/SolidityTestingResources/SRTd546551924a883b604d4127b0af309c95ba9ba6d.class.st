Class {
	#name : #SRTd546551924a883b604d4127b0af309c95ba9ba6d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd546551924a883b604d4127b0af309c95ba9ba6d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyAKLy8gVWJlckRlbHRhIEV4Y2hhbmdlIENvbnRyYWN0IC0gdjEuMC4wCi8vIAovLyAgd3d3LnViZXJkZWx0YS5jb20KLy8KCmNvbnRyYWN0IFRva2VuIHsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKY29udHJhY3QgU2FmZU1hdGggewogIGZ1bmN0aW9uIHNhZmVNdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NiBjKSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgYyA9IGEgKiBiOwogICAgcmVxdWlyZShjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KICAKICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYgYykgewogICAgcmVxdWlyZShiID4gMCk7IC8vZ2VudGxlciB0aGFuIGFuIGFzc2VydC4KICAgIGMgPSBhIC8gYjsKICAgIHJldHVybiBjOwogIH0KCgogIGZ1bmN0aW9uIHNhZmVTdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmVxdWlyZShiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCgogIGZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NiBjKSB7CiAgICBjID0gYSArIGI7CiAgICByZXF1aXJlKGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IE93bmVyTWFuYWdlciB7CgogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwogIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVyUHJvcG9zZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlckNvbmZpcm1lZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwogIGV2ZW50IE5ld01hbmFnZXIoYWRkcmVzcyBpbmRleGVkIF9uZXdNYW5hZ2VyKTsKCgogIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KICAKICBtb2RpZmllciBvbmx5TWFuYWdlciB7CiAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBtYW5hZ2VyKTsKICAgIF87CiAgfQoKCiAgZnVuY3Rpb24gT3duZXJNYW5hZ2VyKCkgcHVibGljewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgbWFuYWdlciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHlPd25lciBleHRlcm5hbHsKICAgIHJlcXVpcmUoX25ld093bmVyICE9IG93bmVyKTsKICAgIAogICAgT3duZXJzaGlwVHJhbnNmZXJQcm9wb3NlZChvd25lciwgX25ld093bmVyKTsKICAgIAogICAgbmV3T3duZXIgPSBfbmV3T3duZXI7CiAgfQoKCiAgZnVuY3Rpb24gY29uZmlybU93bmVyc2hpcCgpIGV4dGVybmFsIHsKICAgIGFzc2VydChtc2cuc2VuZGVyID09IG5ld093bmVyKTsKICAgIAogICAgT3duZXJzaGlwVHJhbnNmZXJDb25maXJtZWQob3duZXIsIG5ld093bmVyKTsKICAgIAogICAgb3duZXIgPSBuZXdPd25lcjsKICB9CgoKICBmdW5jdGlvbiBuZXdNYW5hZ2VyKGFkZHJlc3MgX25ld01hbmFnZXIpIG9ubHlPd25lciBleHRlcm5hbHsKICAgIHJlcXVpcmUoX25ld01hbmFnZXIgIT0gYWRkcmVzcygweDApKTsKICAgIAogICAgTmV3TWFuYWdlcihfbmV3TWFuYWdlcik7CiAgICAKICAgIG1hbmFnZXIgPSBfbmV3TWFuYWdlcjsKICB9Cgp9CgoKY29udHJhY3QgSGVscGVyIGlzIE93bmVyTWFuYWdlciB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzSGVscGVyOwoKICBtb2RpZmllciBvbmx5SGVscGVyIHsKICAgIGFzc2VydChpc0hlbHBlclttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgIF87CiAgfQoKICBldmVudCBDaGFuZ2VIZWxwZXIoCiAgICBhZGRyZXNzIGluZGV4ZWQgaGVscGVyLAogICAgYm9vbCBzdGF0dXMKICApOwoKICBmdW5jdGlvbiBIZWxwZXIoKSBwdWJsaWN7CiAgICBpc0hlbHBlclttc2cuc2VuZGVyXSA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VIZWxwZXIoYWRkcmVzcyBfaGVscGVyLCBib29sIF9zdGF0dXMpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIHsKCSAgQ2hhbmdlSGVscGVyKF9oZWxwZXIsIF9zdGF0dXMpOwogICAgaXNIZWxwZXJbX2hlbHBlcl0gPSBfc3RhdHVzOwogIH0KCn0KCgpjb250cmFjdCBDb21wbGlhbmNlIHsKICBmdW5jdGlvbiBjYW5EZXBvc2l0KGFkZHJlc3MgX3VzZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgaXNBbGxvd2VkKTsKICBmdW5jdGlvbiBjYW5UcmFkZShhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfdXNlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBpc0FsbG93ZWQpOwogIGZ1bmN0aW9uIHZhbGlkYXRlVHJhZGUoCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIGFkZHJlc3MgX2dldFVzZXIsCiAgICBhZGRyZXNzIF9naXZlVXNlcgogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCBpc0FsbG93ZWQpCiAgOwp9Cgpjb250cmFjdCBPcHRpb25SZWdpc3RyeSB7CiAgZnVuY3Rpb24gcmVnaXN0ZXJPcHRpb25QYWlyKAogICAgYWRkcmVzcyBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9hc3NldFRva2VuQW1vdW50LAogICAgYWRkcmVzcyBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICB1aW50MjU2IF9vcHRpb25FeHBpcmVzCiAgKQogIHB1YmxpYwogIHJldHVybnMoYm9vbCkKICA7CiAgCiAgZnVuY3Rpb24gaXNPcHRpb25QYWlyUmVnaXN0ZXJlZCgKICAgIGFkZHJlc3MgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfYXNzZXRUb2tlbkFtb3VudCwKICAgIGFkZHJlc3MgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX3N0cmlrZVRva2VuQW1vdW50LAogICAgdWludDI1NiBfb3B0aW9uRXhwaXJlcwogICkKICBwdWJsaWMKICB2aWV3CiAgcmV0dXJucyhib29sKSAgCiAgOwogIAp9Cgpjb250cmFjdCBFT1MgewogICAgZnVuY3Rpb24gcmVnaXN0ZXIoc3RyaW5nIGtleSkgcHVibGljOwp9Cgpjb250cmFjdCBVYmVyRGVsdGEgaXMgU2FmZU1hdGgsIE93bmVyTWFuYWdlciwgSGVscGVyIHsKCiAgLy8gVGhlIGFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgZmVlcwogIGFkZHJlc3MgcHVibGljIGZlZUFjY291bnQ7CiAgCiAgLy8gVGhlIGFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgbG9zdCBFUkMyMCB0b2tlbnMKICBhZGRyZXNzIHB1YmxpYyBzd2VlcEFjY291bnQ7CiAgCiAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbXBsaWFuY2UgZW5naW5lCiAgYWRkcmVzcyBwdWJsaWMgY29tcGxpYW5jZUFkZHJlc3M7CiAgCiAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIG9wdGlvbnMgcmVnaXN0cnkKICBhZGRyZXNzIHB1YmxpYyBvcHRpb25zUmVnaXN0cnlBZGRyZXNzOwogIAogIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXh0IGV4Y2hhbmdlIGNvbnRyYWN0CiAgYWRkcmVzcyBwdWJsaWMgbmV3RXhjaGFuZ2U7CgogIC8vIFR1cm4gb2ZmIGRlcG9zaXRzIGFuZCB0cmFkZXMsIGFsbG93IHVwZ3JhZGUgYW5kIHdpdGhkcmF3CiAgYm9vbCBwdWJsaWMgY29udHJhY3RMb2NrZWQ7CiAgCiAgYnl0ZXMzMiBzaWduZWRUcmFkZUhhc2ggPSBrZWNjYWsyNTYoCiAgICAiYWRkcmVzcyBjb250cmFjdEFkZHJlc3MiLAogICAgImFkZHJlc3MgdGFrZXJUb2tlbkFkZHJlc3MiLAogICAgInVpbnQyNTYgdGFrZXJUb2tlbkFtb3VudCIsCiAgICAiYWRkcmVzcyBtYWtlclRva2VuQWRkcmVzcyIsCiAgICAidWludDI1NiBtYWtlclRva2VuQW1vdW50IiwKICAgICJ1aW50MjU2IHRyYWRlRXhwaXJlcyIsCiAgICAidWludDI1NiBzYWx0IiwKICAgICJhZGRyZXNzIG1ha2VyIiwKICAgICJhZGRyZXNzIHJlc3RyaWN0ZWRUbyIKICApOwogIAogIGJ5dGVzMzIgc2lnbmVkV2l0aGRyYXdIYXNoID0ga2VjY2FrMjU2KAogICAgImFkZHJlc3MgY29udHJhY3RBZGRyZXNzIiwKICAgICJ1aW50MjU2IGFtb3VudCIsCiAgICAidWludDI1NiBmZWUiLAogICAgInVpbnQyNTYgd2l0aGRyYXdFeHBpcmVzIiwKICAgICJ1aW50MjU2IHNhbHQiLAogICAgImFkZHJlc3MgbWFrZXIiLAogICAgImFkZHJlc3MgcmVzdHJpY3RlZFRvIgogICk7CgoKICAvLyBCYWxhbmNlIHBlciB0b2tlbiwgZm9yIGVhY2ggdXNlci4KICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBiYWxhbmNlczsKICAKICAvLyBnbG9iYWwgdG9rZW4gYmFsYW5jZSB0cmFja2luZyAodG8gZGV0ZWN0IGxvc3QgdG9rZW5zKQogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGdsb2JhbEJhbGFuY2U7CiAgCiAgLy8gTGlzdCBvZiBvcmRlcnMgY3JlYXRlZCBieSBjYWxsaW5nIHRoZSBleGNoYW5nZSBjb250cmFjdCBkaXJlY3RseS4KICBtYXBwaW5nIChieXRlczMyID0+IGJvb2wpIHB1YmxpYyBvcmRlcnM7CiAgCiAgLy8gTGlzdHMgdGhlIGFtb3VudCBvZiBlYWNoIG9yZGVyIHRoYXQgaGFzIGJlZW4gZmlsbGVkIG9yIGNhbmNlbGxlZC4KICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQyNTYpIHB1YmxpYyBvcmRlckZpbGxzOwogIAogIC8vIFRva2VucyB0aGF0IG5lZWQgdG8gYmUgY2hlY2tlZCB0aHJvdWdoIHRoZSBjb21wbGlhbmNlIGVuZ2luZS4KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyByZXN0cmljdGVkVG9rZW5zOwoKICAvLyBNYXBwaW5nIG9mIGZlZXMgYnkgdXNlciBjbGFzcyAoZGVmYXVsdCBjbGFzcyA9PSAweDApCiAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgZmVlQnlDbGFzczsKICAKICAvLyBNYXBwaW5nIG9mIHVzZXJzIHRvIHVzZXIgY2xhc3Nlcy4KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB1c2VyQ2xhc3M7IAogIAogIAogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgLyBFeGNoYW5nZSBSZWd1bGFyIEV2ZW50cwogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgCiAgLy8gTm90ZTogT3JkZXIgY3JlYXRpb24gaXMgdXN1YWxseSBvZmYtY2hhaW4KICBldmVudCBPcmRlcigKICAgIGJ5dGVzMzIgaW5kZXhlZCB0cmFkZVBhaXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgbWFrZXIsCiAgICBhZGRyZXNzWzRdIGFkZHJlc3NEYXRhLAogICAgdWludDI1Nls0XSBudW1iZXJEYXRhCiAgKTsKICAKICBldmVudCBDYW5jZWwoCiAgICBieXRlczMyIGluZGV4ZWQgdHJhZGVQYWlyLAogICAgYWRkcmVzcyBpbmRleGVkIG1ha2VyLAogICAgYWRkcmVzc1s0XSBhZGRyZXNzRGF0YSwKICAgIHVpbnQyNTZbNF0gbnVtYmVyRGF0YSwKICAgIHVpbnQyNTYgc3RhdHVzCiAgKTsKICAKICAgZXZlbnQgRmFpbGVkVHJhZGUoIAogICAgYnl0ZXMzMiBpbmRleGVkIHRyYWRlUGFpciwKICAgIGFkZHJlc3MgaW5kZXhlZCB0YWtlciwKICAgIGJ5dGVzMzIgaGFzaCwKICAgIHVpbnQyNTYgZmFpbFJlYXNvbgogICk7IAogIAogIGV2ZW50IFRyYWRlKCAKICAgIGJ5dGVzMzIgaW5kZXhlZCB0cmFkZVBhaXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgbWFrZXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgdGFrZXIsCiAgICBhZGRyZXNzIG1ha2VyVG9rZW4sCiAgICBhZGRyZXNzIHRha2VyVG9rZW4sCiAgICBhZGRyZXNzIHJlc3RyaWN0ZWRUbywKICAgIHVpbnQyNTZbNF0gbnVtYmVyRGF0YSwKICAgIHVpbnQyNTYgdHJhZGVBbW91bnQsCiAgICBib29sIGZpbGxPcktpbGwKICApOwogIAogIGV2ZW50IERlcG9zaXQoCiAgICBhZGRyZXNzIGluZGV4ZWQgdG9rZW4sCiAgICBhZGRyZXNzIGluZGV4ZWQgdG9Vc2VyLAogICAgYWRkcmVzcyBpbmRleGVkIHNlbmRlciwKICAgIHVpbnQyNTYgYW1vdW50CiAgKTsKICAKICBldmVudCBXaXRoZHJhdygKICAgIGFkZHJlc3MgaW5kZXhlZCB0b2tlbiwKICAgIGFkZHJlc3MgaW5kZXhlZCB0b1VzZXIsCiAgICB1aW50MjU2IGFtb3VudAogICk7CgogIGV2ZW50IEludGVybmFsVHJhbnNmZXIoCiAgICBhZGRyZXNzIGluZGV4ZWQgdG9rZW4sCiAgICBhZGRyZXNzIGluZGV4ZWQgdG9Vc2VyLAogICAgYWRkcmVzcyBpbmRleGVkIHNlbmRlciwKICAgIHVpbnQyNTYgYW1vdW50CiAgKTsKCiAgZXZlbnQgVG9rZW5Td2VlcCgKICAgIGFkZHJlc3MgaW5kZXhlZCB0b2tlbiwKICAgIGFkZHJlc3MgaW5kZXhlZCBzd2VlcGVyLAogICAgdWludDI1NiBhbW91bnQsCiAgICB1aW50MjU2IGJhbGFuY2UKICApOwogIAogIGV2ZW50IFJlc3RyaWN0VG9rZW4oCiAgICBhZGRyZXNzIGluZGV4ZWQgdG9rZW4sCiAgICBib29sIHN0YXR1cwogICk7CiAgCiAgZXZlbnQgTmV3RXhjaGFuZ2UoCiAgICBhZGRyZXNzIG5ld0V4Y2hhbmdlCiAgKTsKICAKICBldmVudCBDaGFuZ2VGZWVBY2NvdW50KAogICAgYWRkcmVzcyBmZWVBY2NvdW50CiAgKTsKICAKICBldmVudCBDaGFuZ2VTd2VlcEFjY291bnQoCiAgICBhZGRyZXNzIHN3ZWVwQWNjb3VudAogICk7CiAgCiAgZXZlbnQgQ2hhbmdlQ2xhc3NGZWUoCiAgICB1aW50MjU2IGluZGV4ZWQgY2xhc3MsCiAgICB1aW50MjU2IGZlZQogICk7CiAgCiAgZXZlbnQgQ2hhbmdlVXNlckNsYXNzKAogICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICB1aW50MjU2IGNsYXNzCiAgKTsKICAKICBldmVudCBMb2NrQ29udHJhY3QoCiAgICBib29sIHN0YXR1cwogICk7CiAgCiAgZXZlbnQgVXBkYXRlQ29tcGxpYW5jZUFkZHJlc3MoCiAgICBhZGRyZXNzIG5ld0NvbXBsaWFuY2VBZGRyZXNzCiAgKTsKICAKICBldmVudCBVcGRhdGVPcHRpb25zUmVnaXN0cnlBZGRyZXNzKAogICAgYWRkcmVzcyBuZXdPcHRpb25zUmVnaXN0cnlBZGRyZXNzCiAgKTsKICAKICBldmVudCBVcGdyYWRlKAogICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgdG9rZW4sCiAgICBhZGRyZXNzIG5ld0V4Y2hhbmdlLAogICAgdWludDI1NiBhbW91bnQKICApOwogIAogIGV2ZW50IFJlbW90ZVdpdGhkcmF3KAogICAgYWRkcmVzcyBpbmRleGVkIG1ha2VyLAogICAgYWRkcmVzcyBpbmRleGVkIHNlbmRlciwKICAgIHVpbnQyNTYgd2l0aGRyYXdBbW91bnQsCiAgICB1aW50MjU2IGZlZUFtb3VudCwKICAgIHVpbnQyNTYgd2l0aGRyYXdFeHBpcmVzLAogICAgdWludDI1NiBzYWx0LAogICAgYWRkcmVzcyByZXN0cmljdGVkVG8KICApOwogIAogIGV2ZW50IENhbmNlbFJlbW90ZVdpdGhkcmF3KAogICAgYWRkcmVzcyBpbmRleGVkIG1ha2VyLAogICAgdWludDI1NiB3aXRoZHJhd0Ftb3VudCwKICAgIHVpbnQyNTYgZmVlQW1vdW50LAogICAgdWludDI1NiB3aXRoZHJhd0V4cGlyZXMsCiAgICB1aW50MjU2IHNhbHQsCiAgICBhZGRyZXNzIHJlc3RyaWN0ZWRUbywKICAgIHVpbnQyNTYgc3RhdHVzCiAgKTsKCiAgLy9Db25zdHJ1Y3RvciBGdW5jdGlvbiwgc2V0IGluaXRpYWwgdmFsdWVzLgogIGZ1bmN0aW9uIFViZXJEZWx0YSgpIHB1YmxpYyB7CiAgICBmZWVBY2NvdW50ID0gb3duZXI7CiAgICBzd2VlcEFjY291bnQgPSBvd25lcjsKICAgIGZlZUJ5Q2xhc3NbMHgwXSA9IDMwMDAwMDAwMDAwMDAwMDA7CiAgICBjb250cmFjdExvY2tlZCA9IGZhbHNlOwogICAgY29tcGxpYW5jZUFkZHJlc3MgPSB0aGlzOwogICAgb3B0aW9uc1JlZ2lzdHJ5QWRkcmVzcyA9IHRoaXM7CiAgfQoKCiAgLy8gUHJldmVudCByYXcgc2VuZHMgb2YgRXRoLgogIGZ1bmN0aW9uKCkgcHVibGljIHsKICAgIHJldmVydCgpOwogIH0KICAKICAKICAKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIC8gQ29udHJhY3QgQ29udHJvbCBGdW5jdGlvbnMKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogIGZ1bmN0aW9uIGNoYW5nZU5ld0V4Y2hhbmdlKGFkZHJlc3MgX25ld0V4Y2hhbmdlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgLy9zaW5jZSBfbmV3RXhjaGFuZ2UgYmVpbmcgemVybyB0dXJucyBvZmYgdGhlIHVwZ3JhZGUgZnVuY3Rpb24sIGxldHMKICAgIC8vYWxsb3cgdGhpcyB0byBiZSByZXNldCB0byAweDAuCiAgICAKICAgIG5ld0V4Y2hhbmdlID0gX25ld0V4Y2hhbmdlOwogICAgCiAgICBOZXdFeGNoYW5nZShfbmV3RXhjaGFuZ2UpOwogIH0KCgogIGZ1bmN0aW9uIGNoYW5nZUZlZUFjY291bnQoYWRkcmVzcyBfZmVlQWNjb3VudCkgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgcmVxdWlyZShfZmVlQWNjb3VudCAhPSBhZGRyZXNzKDB4MCkpOwogICAgCiAgICBmZWVBY2NvdW50ID0gX2ZlZUFjY291bnQ7CiAgICAKICAgIENoYW5nZUZlZUFjY291bnQoX2ZlZUFjY291bnQpOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlU3dlZXBBY2NvdW50KGFkZHJlc3MgX3N3ZWVwQWNjb3VudCkgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgcmVxdWlyZShfc3dlZXBBY2NvdW50ICE9IGFkZHJlc3MoMHgwKSk7CiAgICAKICAgIHN3ZWVwQWNjb3VudCA9IF9zd2VlcEFjY291bnQ7CiAgICAKICAgIENoYW5nZVN3ZWVwQWNjb3VudChfc3dlZXBBY2NvdW50KTsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZUNsYXNzRmVlKHVpbnQyNTYgX2NsYXNzLCB1aW50MjU2IF9mZWUpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIHsKICAgIHJlcXVpcmUoX2ZlZSA8PSAxMDAwMDAwMDAwMDAwMDAwMCk7IC8vTWF4IDElLgoKICAgIGZlZUJ5Q2xhc3NbX2NsYXNzXSA9IF9mZWU7CgogICAgQ2hhbmdlQ2xhc3NGZWUoX2NsYXNzLCBfZmVlKTsKICB9CiAgCiAgZnVuY3Rpb24gY2hhbmdlVXNlckNsYXNzKGFkZHJlc3MgX3VzZXIsIHVpbnQyNTYgX25ld0NsYXNzKSBleHRlcm5hbCBvbmx5SGVscGVyIHsKICAgIHVzZXJDbGFzc1tfdXNlcl0gPSBfbmV3Q2xhc3M7CiAgICAKICAgIENoYW5nZVVzZXJDbGFzcyhfdXNlciwgX25ld0NsYXNzKTsKICB9CiAgCiAgLy9UdXJuIG9mZiBkZXBvc2l0cyBhbmQgdHJhZGVzLCBidXQgc3RpbGwgYWxsb3cgd2l0aGRyYXdhbHMgYW5kIHVwZ3JhZGVzLgogIGZ1bmN0aW9uIGxvY2tDb250cmFjdChib29sIF9sb2NrKSBleHRlcm5hbCBvbmx5TWFuYWdlciB7CiAgICBjb250cmFjdExvY2tlZCA9IF9sb2NrOwogICAgCiAgICBMb2NrQ29udHJhY3QoX2xvY2spOwogIH0KICAKICBmdW5jdGlvbiB1cGRhdGVDb21wbGlhbmNlQWRkcmVzcyhhZGRyZXNzIF9uZXdDb21wbGlhbmNlQWRkcmVzcykKICAgIGV4dGVybmFsCiAgICBvbmx5TWFuYWdlcgogIHsKICAgIGNvbXBsaWFuY2VBZGRyZXNzID0gX25ld0NvbXBsaWFuY2VBZGRyZXNzOwogICAgCiAgICBVcGRhdGVDb21wbGlhbmNlQWRkcmVzcyhfbmV3Q29tcGxpYW5jZUFkZHJlc3MpOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlT3B0aW9uc1JlZ2lzdHJ5QWRkcmVzcyhhZGRyZXNzIF9uZXdPcHRpb25zUmVnaXN0cnlBZGRyZXNzKQogICAgZXh0ZXJuYWwKICAgIG9ubHlNYW5hZ2VyCiAgewogICAgb3B0aW9uc1JlZ2lzdHJ5QWRkcmVzcyA9IF9uZXdPcHRpb25zUmVnaXN0cnlBZGRyZXNzOwogICAgCiAgICBVcGRhdGVPcHRpb25zUmVnaXN0cnlBZGRyZXNzKF9uZXdPcHRpb25zUmVnaXN0cnlBZGRyZXNzKTsKICB9CgoKICAvLyByZXN0cmljdGlvbiBmdW5jdGlvbiBmb3IgdG9rZW5zIHRoYXQgbmVlZCBhZGRpdGlvbmFsIHZlcmlmaWNhdGlvbnMKICBmdW5jdGlvbiB0b2tlblJlc3RyaWN0aW9uKGFkZHJlc3MgX25ld1Rva2VuLCBib29sIF9zdGF0dXMpIGV4dGVybmFsIG9ubHlIZWxwZXIgewogICAgcmVzdHJpY3RlZFRva2Vuc1tfbmV3VG9rZW5dID0gX3N0YXR1czsKICAgIAogICAgUmVzdHJpY3RUb2tlbihfbmV3VG9rZW4sIF9zdGF0dXMpOwogIH0KCiAgCiAgLy9UdXJuIG9mZiBkZXBvc2l0cyBhbmQgdHJhZGVzLCBidXQgc3RpbGwgYWxsb3cgd2l0aGRyYXdhbHMgYW5kIHVwZ3JhZGVzLgogIG1vZGlmaWVyIG5vdExvY2tlZCgpIHsKICAgIHJlcXVpcmUoIWNvbnRyYWN0TG9ja2VkKTsKICAgIF87CiAgfQogIAogIAogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgLyBEZXBvc2l0L1dpdGhkcmF3YWwvVHJhbnNmZXIKICAvCiAgLyBJbiBhbGwgb2YgdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMsIGl0IHNob3VsZCBiZSBub3RlZAogIC8gdGhhdCB0aGUgMHgwIGFkZHJlc3MgaXMgdXNlZCB0byByZXByZXNlbnQgRVRILgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgCiAgLy8gU2FmZU1hdGggc2FuaXR5IGNoZWNrcyBpbnB1dHMgaW4gZGVwb3NpdCgpLCB3aXRoZHJhdygpLCBhbmQgdG9rZW4gZnVuY3Rpb25zLgogIAogIC8vIERlcG9zaXQgRVRIIGluIHRoZSBjb250cmFjdCB0byB0cmFkZSB3aXRoCiAgZnVuY3Rpb24gZGVwb3NpdCgpIGV4dGVybmFsIG5vdExvY2tlZCBwYXlhYmxlIHJldHVybnModWludDI1NikgewogICAgcmVxdWlyZShDb21wbGlhbmNlKGNvbXBsaWFuY2VBZGRyZXNzKS5jYW5EZXBvc2l0KG1zZy5zZW5kZXIpKTsgCiAgICAvLyBkZWZhdWx0cyB0byB0cnVlIHVudGlsIHdlIGNoYW5nZSBjb21wbGlhbmNlIGNvZGUKICAgIAogICAgYmFsYW5jZXNbYWRkcmVzcygweDApXVttc2cuc2VuZGVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbYWRkcmVzcygweDApXVttc2cuc2VuZGVyXSwgbXNnLnZhbHVlKTsKICAgIGdsb2JhbEJhbGFuY2VbYWRkcmVzcygweDApXSA9IHNhZmVBZGQoZ2xvYmFsQmFsYW5jZVthZGRyZXNzKDB4MCldLCBtc2cudmFsdWUpOwoKICAgIERlcG9zaXQoMHgwLCBtc2cuc2VuZGVyLCBtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgCiAgICByZXR1cm4obXNnLnZhbHVlKTsKICB9CgogIC8vIFdpdGhkcmF3IEVUSCBmcm9tIHRoZSBjb250cmFjdCB0byB5b3VyIHdhbGxldCAgKGludGVybmFsIHRyYW5zYWN0aW9uIG9uIGV0aGVyc2NhbikKICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50MjU2IF9hbW91bnQpIGV4dGVybmFsIHJldHVybnModWludDI1NikgewogICAgLy9yZXF1aXJlKGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bbXNnLnNlbmRlcl0gPj0gX2Ftb3VudCk7CiAgICAvL2hhbmRsZWQgYnkgc2FmZVN1Yi4KICAgIAogICAgYmFsYW5jZXNbYWRkcmVzcygweDApXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbYWRkcmVzcygweDApXVttc2cuc2VuZGVyXSwgX2Ftb3VudCk7CiAgICBnbG9iYWxCYWxhbmNlW2FkZHJlc3MoMHgwKV0gPSBzYWZlU3ViKGdsb2JhbEJhbGFuY2VbYWRkcmVzcygweDApXSwgX2Ftb3VudCk7CiAKICAgIC8vdHJhbnNmZXIgaGFzIGEgYnVpbHQgaW4gcmVxdWlyZQogICAgbXNnLnNlbmRlci50cmFuc2ZlcihfYW1vdW50KTsKICAgIAogICAgV2l0aGRyYXcoMHgwLCBtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgIAogICAgcmV0dXJuKF9hbW91bnQpOwogIH0KCgogIC8vIERlcG9zaXQgRVJDMjAgdG9rZW5zIGluIHRoZSBjb250cmFjdCB0byB0cmFkZSB3aXRoCiAgLy8gVG9rZW4oX3Rva2VuKS5hcHByb3ZlKHRoaXMsIF9hbW91bnQpIG11c3QgYmUgY2FsbGVkIGluIGFkdmFuY2UKICAvLyBFUkMyMjMgdG9rZW5zIG11c3QgYmUgZGVwb3NpdGVkIGJ5IGEgdHJhbnNmZXIgdG8gdGhpcyBjb250cmFjdCAoIHNlZSB0b2tlbkZhbGxCYWNrKC4uKSApCiAgZnVuY3Rpb24gZGVwb3NpdFRva2VuKGFkZHJlc3MgX3Rva2VuLCB1aW50MjU2IF9hbW91bnQpIGV4dGVybmFsIG5vdExvY2tlZCByZXR1cm5zKHVpbnQyNTYpIHsKICAgIHJlcXVpcmUoX3Rva2VuICE9IGFkZHJlc3MoMHgwKSk7CiAgICAKICAgIHJlcXVpcmUoQ29tcGxpYW5jZShjb21wbGlhbmNlQWRkcmVzcykuY2FuRGVwb3NpdChtc2cuc2VuZGVyKSk7CgogICAgYmFsYW5jZXNbX3Rva2VuXVttc2cuc2VuZGVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3Rva2VuXVttc2cuc2VuZGVyXSwgX2Ftb3VudCk7CiAgICBnbG9iYWxCYWxhbmNlW190b2tlbl0gPSBzYWZlQWRkKGdsb2JhbEJhbGFuY2VbX3Rva2VuXSwgX2Ftb3VudCk7CiAgICAKICAgIHJlcXVpcmUoVG9rZW4oX3Rva2VuKS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgX2Ftb3VudCkpOwoKICAgIERlcG9zaXQoX3Rva2VuLCBtc2cuc2VuZGVyLCBtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgIAogICAgcmV0dXJuKF9hbW91bnQpOwogIH0KCiAgLy8gV2l0aGRyYXcgRVJDMjAvMjIzIHRva2VucyBmcm9tIHRoZSBjb250cmFjdCBiYWNrIHRvIHlvdXIgd2FsbGV0CiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbihhZGRyZXNzIF90b2tlbiwgdWludDI1NiBfYW1vdW50KQogICAgZXh0ZXJuYWwKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgewogICAgaWYgKF90b2tlbiA9PSBhZGRyZXNzKDB4MCkpewogICAgICAvL2tlZXAgdGhlIG51bGxzIHRvIHJlZHVjZSBnYXMgdXNhZ2UuCiAgICAgIC8vcmVxdWlyZShiYWxhbmNlc1tfdG9rZW4pXVttc2cuc2VuZGVyXSA+PSBfYW1vdW50KTsKICAgICAgLy9oYW5kbGVkIGJ5IHNhZmVTdWIuCiAgICAgIGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bbXNnLnNlbmRlcl0sIF9hbW91bnQpOwogICAgICBnbG9iYWxCYWxhbmNlW2FkZHJlc3MoMHgwKV0gPSBzYWZlU3ViKGdsb2JhbEJhbGFuY2VbYWRkcmVzcygweDApXSwgX2Ftb3VudCk7CgogICAgICAvL3RyYW5zZmVyIGhhcyBhIGJ1aWx0IGluIHJlcXVpcmUKICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfYW1vdW50KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vcmVxdWlyZShiYWxhbmNlc1tfdG9rZW5dW21zZy5zZW5kZXJdID49IF9hbW91bnQpOwogICAgICAvL2hhbmRsZWQgYnkgc2FmZVN1YiAKIAogICAgICBiYWxhbmNlc1tfdG9rZW5dW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1tfdG9rZW5dW21zZy5zZW5kZXJdLCBfYW1vdW50KTsKICAgICAgZ2xvYmFsQmFsYW5jZVtfdG9rZW5dID0gc2FmZVN1YihnbG9iYWxCYWxhbmNlW190b2tlbl0sIF9hbW91bnQpOwoKICAgICAgcmVxdWlyZShUb2tlbihfdG9rZW4pLnRyYW5zZmVyKG1zZy5zZW5kZXIsIF9hbW91bnQpKTsKICAgIH0gICAgCgogICAgV2l0aGRyYXcoX3Rva2VuLCBtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgIAogICAgcmV0dXJuIF9hbW91bnQ7CiAgfQoKICAvLyBEZXBvc2l0IEVUSCBpbiB0aGUgY29udHJhY3Qgb24gYmVoYWxmIG9mIGFub3RoZXIgYWRkcmVzcwogIC8vIFdhcm5pbmc6IGFmdGVyd2FyZHMsIG9ubHkgX3VzZXIgd2lsbCBiZSBhYmxlIHRvIHRyYWRlIG9yIHdpdGhkcmF3IHRoZXNlIGZ1bmRzCiAgZnVuY3Rpb24gZGVwb3NpdFRvVXNlcihhZGRyZXNzIF90b1VzZXIpIGV4dGVybmFsIHBheWFibGUgbm90TG9ja2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmVxdWlyZSgKICAgICAgICAoX3RvVXNlciAhPSBhZGRyZXNzKDB4MCkpCiAgICAgJiYgKF90b1VzZXIgIT0gYWRkcmVzcyh0aGlzKSkKICAgICAmJiAoQ29tcGxpYW5jZShjb21wbGlhbmNlQWRkcmVzcykuY2FuRGVwb3NpdChfdG9Vc2VyKSkKICAgICk7CiAgICAKICAgIGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bX3RvVXNlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bX3RvVXNlcl0sIG1zZy52YWx1ZSk7CiAgICBnbG9iYWxCYWxhbmNlW2FkZHJlc3MoMHgwKV0gPSBzYWZlQWRkKGdsb2JhbEJhbGFuY2VbYWRkcmVzcygweDApXSwgbXNnLnZhbHVlKTsKICAgIAogICAgRGVwb3NpdCgweDAsIF90b1VzZXIsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICAKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8gRGVwb3NpdCBFUkMyMCB0b2tlbnMgaW4gdGhlIGNvbnRyYWN0IG9uIGJlaGFsZiBvZiBhbm90aGVyIGFkZHJlc3MKICAvLyBUb2tlbihfdG9rZW4pLmFwcHJvdmUodGhpcywgX2Ftb3VudCkgbXVzdCBiZSBjYWxsZWQgaW4gYWR2YW5jZQogIC8vIFdhcm5pbmc6IGFmdGVyd2FyZHMsIG9ubHkgX3RvVXNlciB3aWxsIGJlIGFibGUgdG8gdHJhZGUgb3Igd2l0aGRyYXcgdGhlc2UgZnVuZHMKICAvLyBFUkMyMjMgdG9rZW5zIG11c3QgYmUgZGVwb3NpdGVkIGJ5IGEgdHJhbnNmZXIgdG8gdGhpcyBjb250cmFjdCAoIHNlZSB0b2tlbkZhbGxCYWNrKC4uKSApCiAgZnVuY3Rpb24gZGVwb3NpdFRva2VuVG9Vc2VyKAogICAgYWRkcmVzcyBfdG9Vc2VyLAogICAgYWRkcmVzcyBfdG9rZW4sCiAgICB1aW50MjU2IF9hbW91bnQKICApCiAgICBleHRlcm5hbAogICAgbm90TG9ja2VkCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgewogICAgcmVxdWlyZSgKICAgICAgICAoX3Rva2VuICE9IGFkZHJlc3MoMHgwKSkKCiAgICAgJiYgKF90b1VzZXIgICE9IGFkZHJlc3MoMHgwKSkKICAgICAmJiAoX3RvVXNlciAgIT0gYWRkcmVzcyh0aGlzKSkKICAgICAmJiAoX3RvVXNlciAgIT0gX3Rva2VuKQogICAgICYmIChDb21wbGlhbmNlKGNvbXBsaWFuY2VBZGRyZXNzKS5jYW5EZXBvc2l0KF90b1VzZXIpKQogICAgKTsKICAgIAogICAgYmFsYW5jZXNbX3Rva2VuXVtfdG9Vc2VyXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3Rva2VuXVtfdG9Vc2VyXSwgX2Ftb3VudCk7CiAgICBnbG9iYWxCYWxhbmNlW190b2tlbl0gPSBzYWZlQWRkKGdsb2JhbEJhbGFuY2VbX3Rva2VuXSwgX2Ftb3VudCk7CgogICAgcmVxdWlyZShUb2tlbihfdG9rZW4pLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfYW1vdW50KSk7CgogICAgRGVwb3NpdChfdG9rZW4sIF90b1VzZXIsIG1zZy5zZW5kZXIsIF9hbW91bnQpOwogICAgCiAgICByZXR1cm4gdHJ1ZTsKICB9CgoKICAvL0VSQzIyMyBUb2tlbiBBY2NlcHRvciBmdW5jdGlvbiwgY2FsbGVkIHdoZW4gYW4gRVJDMjIyMyB0b2tlbiBpcyB0cmFuc2ZlcnJlZCB0byB0aGlzIGNvbnRyYWN0CiAgLy8gcHJvdmlkZSBfc2VuZFRvIHRvIG1ha2UgaXQgYSBkZXBvc2l0IG9uIGJlaGFsZiBvZiBhbm90aGVyIGFkZHJlc3MgKGRlcG9zaXRUb1VzZXIpCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjaygKICAgIGFkZHJlc3MgX2Zyb20sICAvLyB1c2VyIGNhbGxpbmcgdGhlIGZ1bmN0aW9uCiAgICB1aW50MjU2IF92YWx1ZSwgLy8gdGhlIG51bWJlciBvZiB0b2tlbnMKICAgIGJ5dGVzIF9zZW5kVG8gICAgIC8vICJkZXBvc2l0IHRvIG90aGVyIHVzZXIiIGlmIGV4YWN0bHkgMjAgYnl0ZXMgc2VudAogICAgCiAgKQogICAgZXh0ZXJuYWwKICAgIG5vdExvY2tlZAogIHsKICAgIC8vZmlyc3QgbGV0cyBmaWd1cmUgb3V0IHdobyB0aGlzIGlzIGdvaW5nIHRvLgogICAgYWRkcmVzcyB0b1VzZXIgPSBfZnJvbTsgICAgIC8vcHJvYmFibHkgdGhpcwogICAgaWYgKF9zZW5kVG8ubGVuZ3RoID09IDIwKXsgIC8vYnV0IHVzZSBkYXRhIGZvciBzZW5kVG8gb3RoZXJ3aXNlLgoKICAgICAgLy8gSSdtIGFib3V0IDkwJSBzdXJlIEkgZG9uJ3QgbmVlZCB0byBkbyB0aGUgY2FzdGluZyBoZXJlLCBidXQgZm9yCiAgICAgIC8vIGxpa2UgdHdlbnR5IGdhcywgSSdsbCB0YWtlIHRoZSBwcm90ZWN0aW9uIGZyb20gcG90ZW50aWFsbHkKICAgICAgLy8gc3RvbXBpbmcgb24gd2VpcmQgbWVtb3J5IGxvY2F0aW9ucy4KICAgICAgCiAgICAgIHVpbnQyNTYgYXNtQWRkcmVzczsKICAgICAgYXNzZW1ibHkgeyAvL3VzZXMgNTAgZ2FzCiAgICAgICAgYXNtQWRkcmVzcyA6PSBjYWxsZGF0YWxvYWQoMTIwKQogICAgICB9CiAgICAgIHRvVXNlciA9IGFkZHJlc3MoYXNtQWRkcmVzcyk7CiAgICB9CiAgICAKICAgIC8vc2FuaXR5IGNoZWNrcy4KICAgIHJlcXVpcmUoCiAgICAgICAgKHRvVXNlciAhPSBhZGRyZXNzKDB4MCkpCiAgICAgJiYgKHRvVXNlciAhPSBhZGRyZXNzKHRoaXMpKQogICAgICYmICh0b1VzZXIgIT0gbXNnLnNlbmRlcikgIC8vIG1zZy5zZW5kZXIgaXMgdGhlIHRva2VuCiAgICAgJiYgKENvbXBsaWFuY2UoY29tcGxpYW5jZUFkZHJlc3MpLmNhbkRlcG9zaXQodG9Vc2VyKSkKICAgICk7CiAgICAKICAgIC8vIGNoZWNrIGlmIGEgY29udHJhY3QgaXMgY2FsbGluZyB0aGlzCiAgICB1aW50MjU2IGNvZGVMZW5ndGg7CiAgICBhc3NlbWJseSB7CiAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoY2FsbGVyKQogICAgfQogICAgcmVxdWlyZShjb2RlTGVuZ3RoID4gMCk7ICAgIAogICAgCiAgICBnbG9iYWxCYWxhbmNlW21zZy5zZW5kZXJdID0gc2FmZUFkZChnbG9iYWxCYWxhbmNlW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl1bdG9Vc2VyXSA9IHNhZmVBZGQoYmFsYW5jZXNbbXNnLnNlbmRlcl1bdG9Vc2VyXSwgX3ZhbHVlKTsKICAgIAogICAgLy9zYW5pdHkgY2hlY2ssIGFuZCBhcyBhIHBlcmssIHdlIGNoZWNrIGZvciBiYWxhbmNlT2YoKTsKICAgIHJlcXVpcmUoVG9rZW4obXNnLnNlbmRlcikuYmFsYW5jZU9mKHRoaXMpID49IF92YWx1ZSk7CgogICAgRGVwb3NpdChtc2cuc2VuZGVyLCB0b1VzZXIsIF9mcm9tLCBfdmFsdWUpOwogIH0KCiAgLy8gTW92ZSBkZXBvc2l0ZWQgdG9rZW5zIG9yIEVUSCAoMHgwKSBmcm9tIG9uZSB0byBhbm90aGVyIGFkZHJlc3Mgd2l0aGluIHRoZSBjb250cmFjdAogIGZ1bmN0aW9uIGludGVybmFsVHJhbnNmZXIoCiAgICBhZGRyZXNzIF90b1VzZXIsCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIHVpbnQyNTYgX2Ftb3VudAogICkKICAgIGV4dGVybmFsCiAgICBub3RMb2NrZWQgCiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgcmVxdWlyZSgKICAgICAgICAoYmFsYW5jZXNbX3Rva2VuXVttc2cuc2VuZGVyXSA+PSBfYW1vdW50KQogICAgICYmIChfdG9Vc2VyICE9IGFkZHJlc3MoMHgwKSkKICAgICAmJiAoX3RvVXNlciAhPSBhZGRyZXNzKHRoaXMpKQogICAgICYmIChfdG9Vc2VyICE9IF90b2tlbikKICAgICAmJiAoQ29tcGxpYW5jZShjb21wbGlhbmNlQWRkcmVzcykuY2FuRGVwb3NpdChfdG9Vc2VyKSkKICAgICk7CiAKICAgIGJhbGFuY2VzW190b2tlbl1bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW190b2tlbl1bbXNnLnNlbmRlcl0sIF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3Rva2VuXVtfdG9Vc2VyXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3Rva2VuXVtfdG9Vc2VyXSwgX2Ftb3VudCk7CgogICAgSW50ZXJuYWxUcmFuc2ZlcihfdG9rZW4sIF90b1VzZXIsIG1zZy5zZW5kZXIsIF9hbW91bnQpOwogICAgCiAgICByZXR1cm4oX2Ftb3VudCk7CiAgfQogIAogIC8vIHJldHVybiB0aGUgdG9rZW4vRVRIIGJhbGFuY2UgYSB1c2VyIGhhcyBkZXBvc2l0ZWQgaW4gdGhlIGNvbnRyYWN0CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF91c2VyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfdG9rZW5dW191c2VyXTsKICB9CgogIAogIC8vIEluIG9yZGVyIHRvIHNlZSB0aGUgRVJDMjAgdG90YWwgYmFsYW5jZSwgd2UncmUgY2FsbGluZyBhbiBleHRlcm5hbCBjb250cmFjdCwKICAvLyBhbmQgdGhpcyBjb250cmFjdCBjbGFpbXMgdG8gYmUgRVJDMjAsIGJ1dCB3ZSBkb24ndCBrbm93IHdoYXQncyByZWFsbHkgdGhlcmUuCiAgLy8gV2UgY2FuJ3QgcmVseSBvbiB0aGUgRVZNIG9yIHNvbGlkaXR5IHRvIGVuZm9yY2UgInZpZXciLCBzbyBldmVuIHRob3VnaCBhCiAgLy8gbm9ybWFsIHRva2VuIGNhbiByZWx5IG9uIGl0c2VsZiB0byBiZSBub24tbWFsaWNpb3VzLCB3ZSBjYW4ndC4KICAvLyBXZSBoYXZlIG5vIGlkZWEgd2hhdCBwb3RlbnRpYWxseSBldmlsIHRva2VucyB3ZSdsbCBiZSBpbnRlcmFjdGluZyB3aXRoLgogIC8vIFRoZSBjYWxsIHRvIGNoZWNrIHRoZSByZXBvcnRlZCBiYWxhbmNlIG5lZWRzIHRvIGdvIGFmdGVyIHRoZSBzdGF0ZSBjaGFuZ2VzLAogIC8vIGV2ZW4gdGhvdWdoIGl0J3MgdW4tbmF0dXJhbC4gTm93LCBvbiBvbmUgaGFuZCwgdGhpcyBmdW5jdGlvbiBtaWdodCBhdCBmaXJzdAogIC8vIGFwcGVhciBzYWZlLCBzaW5jZSB3ZSdyZSBvbmx5IGFsbG93aW5nIHRoZSBzd2VlcGVyIGFkZHJlc3MgdG8gYWNjZXNzCiAgLy8gKnRoaXMgZnVuY3Rpb24sKiBidXQgd2UgYXJlIHJlYWRpbmcgdGhlIHN0YXRlIG9mIHRoZSBnbG9iYWxCYWxhbmNlLgogIC8vIEluIHRoZW9yeSwgYSBtYWxpY2lvdXMgdG9rZW4gY291bGQgZG8gdGhlIGZvbGxvd2luZzoKICAvLyAgMWEpIENoZWNrIGlmIHRoZSBjYWxsZXIgb2YgYmFsYW5jZU9mIGlzIG91ciBjb250cmFjdCwgaWYgaXQncyBub3QsIGFjdCBub3JtYWxseS4KICAvLyAgMWIpIElmIHRoZSBjYWxsZXIgaXMgb3VyIGNvbnRyYWN0LCBpdCBkb2VzIHRoZSBmb2xsb3dpbmc6CiAgLy8gIDIpIFJlYWQgb3VyIGNvbnRyYWN0cyBnbG9iYWxCYWxhbmNlIGZvciBpdHMgb3duIGFkZHJlc3MuCiAgLy8gIDMpIFNldHMgb3VyIGNvbnRyYWN0J3MgYmFsYW5jZSBvZiB0aGUgdG9rZW4gKGluIHRoZSB0b2tlbiBjb250cm9sbGVyKSB0byBvdXIgaW50ZXJuYWwgZ2xvYmFsQmFsYW5jZQogIC8vICA0KSBBbGxvY2F0ZXMgc29tZSBvdGhlciBhZGRyZXNzIHRoZSBkaWZmZXJlbmNlIGluIGdsb2JhbEJhbGFuY2UgYW5kIGFjdHVhbCBiYWxhbmNlIGZvciBvdXIgY29udHJhY3QuCiAgLy8gIDUpIFJlcG9ydCBiYWNrIHRvIHRoaXMgZnVuY3Rpb24gZXhhY3RseSB0aGUgYW1vdW50IHdlIGhhZCBpbiBnbG9iYWxCYWxhbmNlLgogIC8vICh3aGljaCwgYnkgdGhlbiBpcyB0cnVlLCBzaW5jZSB0aGV5IHdlcmUgc3RvbGVuKS4KICAvLyBOb3cgd2UncmUgYWx3YXlzIGdvaW5nIHRvIHNlZSAwIGV4dHJhIHRva2VucywgYW5kIG91ciB1c2VycyBoYXZlIGhhZCB0aGVpciB0b2tlbnMgcGVybWluYW50bHkgbG9zdC4KICAvLyBib251czogdGhpcyBpcyB3aHkgdGhlcmUgaXMgbm8gInN3ZWVwIGFsbCIgZnVuY3Rpb24uCiAgICAKICAvLyBEZXRlY3QgRVJDMjAgdG9rZW5zIHRoYXQgaGF2ZSBiZWVuIHNlbnQgdG8gdGhlIGNvbnRyYWN0IHdpdGhvdXQgYSBkZXBvc2l0IChsb3N0IHRva2VucyksCiAgLy8gd2hpY2ggYXJlIG5vdCBpbmNsdWRlZCBpbiBnbG9iYWxCYWxhbmNlWy4uXQogIGZ1bmN0aW9uIHN3ZWVwVG9rZW5BbW91bnQoYWRkcmVzcyBfdG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgZXh0ZXJuYWwgcmV0dXJucyh1aW50MjU2KSB7CiAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBzd2VlcEFjY291bnQpOwoKICAgIGJhbGFuY2VzW190b2tlbl1bc3dlZXBBY2NvdW50XSA9IHNhZmVBZGQoYmFsYW5jZXNbX3Rva2VuXVtzd2VlcEFjY291bnRdLCBfYW1vdW50KTsKICAgIGdsb2JhbEJhbGFuY2VbX3Rva2VuXSA9IHNhZmVBZGQoZ2xvYmFsQmFsYW5jZVtfdG9rZW5dLCBfYW1vdW50KTsKICAgIAogICAgLy9Zb3UgZ28gbGFzdCEKCWlmKF90b2tlbiAhPSBhZGRyZXNzKDB4MCkpIHsgCiAgICAgIHJlcXVpcmUoZ2xvYmFsQmFsYW5jZVtfdG9rZW5dIDw9IFRva2VuKF90b2tlbikuYmFsYW5jZU9mKHRoaXMpKTsKCX0gZWxzZSB7CgkgIC8vIGlmIGFub3RoZXIgY29udHJhY3QgcGVyZm9ybXMgc2VsZmRlc3RydWN0KFViZXJEZWx0YSksCiAgICAvLyBFVEggY2FuIGdldCBpbiBoZXJlIHdpdGhvdXQgYmVpbmcgaW4gZ2xvYmFsQmFsYW5jZQoJICByZXF1aXJlKGdsb2JhbEJhbGFuY2VbYWRkcmVzcygweDApXSA8PSB0aGlzLmJhbGFuY2UpOyAKCX0KICAgIAogICAgVG9rZW5Td2VlcChfdG9rZW4sIG1zZy5zZW5kZXIsIF9hbW91bnQsIGJhbGFuY2VzW190b2tlbl1bc3dlZXBBY2NvdW50XSk7CiAgICAKICAgIHJldHVybihfYW1vdW50KTsKICB9CiAgCiAgCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAvIFJlZ3VsYXIgVHJhZGluZyBmdW5jdGlvbnMKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogIAogIC8vbm93IGNvbnRyYWN0cyBjYW4gcGxhY2Ugb3JkZXJzIQogIAogIAogIC8vIE5vcm1hbCBvcmRlciBjcmVhdGlvbiBoYXBwZW5zIG9mZi1jaGFpbiBhbmQgb3JkZXJzIGFyZSBzaWduZWQgYnkgY3JlYXRvcnMsCiAgLy8gdGhpcyBmdW5jdGlvbiBhbGxvd3MgZm9yIG9uLWNoYWluIG9yZGVycyB0byBiZSBjcmVhdGVkCiAgZnVuY3Rpb24gb3JkZXIoCiAgICBhZGRyZXNzWzRdIF9hZGRyZXNzRGF0YSwKICAgIHVpbnQyNTZbNF0gX251bWJlckRhdGEgLy93ZWIzIGlzbid0IHJlYWR5IGZvciBzdHJ1Y3RzLgogICkKICAgIGV4dGVybmFsCiAgICBub3RMb2NrZWQKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICB7CiAgCi8vICAgIF9hZGRyZXNzRGF0YVsyXSBpcyBtYWtlcjsKICAgIGlmIChtc2cuc2VuZGVyICE9IF9hZGRyZXNzRGF0YVsyXSkgeyByZXR1cm4gZmFsc2U7IH0KICAgIAogICAgYnl0ZXMzMiBoYXNoID0gZ2V0SGFzaChfYWRkcmVzc0RhdGEsIF9udW1iZXJEYXRhKTsKCiAgICBvcmRlcnNbaGFzaF0gPSB0cnVlOwoKICAgIE9yZGVyKAogICAgICAoYnl0ZXMzMihfYWRkcmVzc0RhdGFbMF0pIF4gYnl0ZXMzMihfYWRkcmVzc0RhdGFbMV0pKSwKICAgICAgbXNnLnNlbmRlciwKICAgICAgX2FkZHJlc3NEYXRhLAogICAgICBfbnVtYmVyRGF0YSk7CiAgICAKICAgIHJldHVybiB0cnVlOwogIH0gIAoKCiAgZnVuY3Rpb24gdHJhZGVCYWxhbmNlcygKICAgIGFkZHJlc3MgX3Rha2VyVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfdGFrZXJUb2tlbkFtb3VudCwKICAgIGFkZHJlc3MgX21ha2VyVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfbWFrZXJUb2tlbkFtb3VudCwKICAgIGFkZHJlc3MgX21ha2VyLAogICAgdWludDI1NiBfdHJhZGVBbW91bnQKICApCiAgICBpbnRlcm5hbAogIHsKICAgIHJlcXVpcmUoX3Rha2VyVG9rZW5BbW91bnQgPiAwKTsgLy9zYWZlRGl2CgogICAgLy8gV2UgY2hhcmdlIG9ubHkgdGhlIHRha2VycyB0aGlzIGZlZQogICAgdWludDI1NiBmZWVWYWx1ZSA9IHNhZmVNdWwoX3RyYWRlQW1vdW50LCBmZWVCeUNsYXNzW3VzZXJDbGFzc1ttc2cuc2VuZGVyXV0pIC8gKDEgZXRoZXIpOwogICAgCiAgICBiYWxhbmNlc1tfdGFrZXJUb2tlbkFkZHJlc3NdW19tYWtlcl0gPQogICAgICBzYWZlQWRkKGJhbGFuY2VzW190YWtlclRva2VuQWRkcmVzc11bX21ha2VyXSwgX3RyYWRlQW1vdW50KTsKICAgIGJhbGFuY2VzW190YWtlclRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0gPQogICAgICBzYWZlU3ViKGJhbGFuY2VzW190YWtlclRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0sIHNhZmVBZGQoX3RyYWRlQW1vdW50LCBmZWVWYWx1ZSkpOwogICAgCiAgICBiYWxhbmNlc1tfbWFrZXJUb2tlbkFkZHJlc3NdW19tYWtlcl0gPQogICAgICBzYWZlU3ViKAogICAgICAgIGJhbGFuY2VzW19tYWtlclRva2VuQWRkcmVzc11bX21ha2VyXSwKICAgICAgICBzYWZlTXVsKF9tYWtlclRva2VuQW1vdW50LCBfdHJhZGVBbW91bnQpIC8gX3Rha2VyVG9rZW5BbW91bnQKICAgICAgKTsKICAgIGJhbGFuY2VzW19tYWtlclRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0gPQogICAgICBzYWZlQWRkKAogICAgICAgIGJhbGFuY2VzW19tYWtlclRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0sCiAgICAgICAgc2FmZU11bChfbWFrZXJUb2tlbkFtb3VudCwgX3RyYWRlQW1vdW50KSAvIF90YWtlclRva2VuQW1vdW50CiAgICAgICk7CiAgICAKICAgIGJhbGFuY2VzW190YWtlclRva2VuQWRkcmVzc11bZmVlQWNjb3VudF0gPQogICAgICBzYWZlQWRkKGJhbGFuY2VzW190YWtlclRva2VuQWRkcmVzc11bZmVlQWNjb3VudF0sIGZlZVZhbHVlKTsKICB9CgoKICBmdW5jdGlvbiB0cmFkZSgKICAgIGFkZHJlc3NbNF0gX2FkZHJlc3NEYXRhLAogICAgdWludDI1Nls0XSBfbnVtYmVyRGF0YSwgLy93ZWIzIGlzbid0IHJlYWR5IGZvciBzdHJ1Y3RzLgogICAgdWludDggX3YsCiAgICBieXRlczMyIF9yLAogICAgYnl0ZXMzMiBfcywKICAgIHVpbnQyNTYgX2Ftb3VudCwKICAgIGJvb2wgX2ZpbGxPcktpbGwKICApCiAgICBleHRlcm5hbAogICAgbm90TG9ja2VkCiAgICByZXR1cm5zKHVpbnQyNTYgdHJhZGVBbW91bnQpCiAgewogIAovLyAgICAgIF9hZGRyZXNzRGF0YVswXSwgLy8gdGFrZXJUb2tlbkFkZHJlc3M7Ci8vICAgICAgX251bWJlckRhdGFbMF0sIC8vIHRha2VyVG9rZW5BbW91bnQ7Ci8vICAgICAgX2FkZHJlc3NEYXRhWzFdLCAvLyBtYWtlclRva2VuQWRkcmVzczsKLy8gICAgICBfbnVtYmVyRGF0YVsxXSwgLy8gbWFrZXJUb2tlbkFtb3VudDsKLy8gICAgICBfbnVtYmVyRGF0YVsyXSwgLy8gdHJhZGVFeHBpcmVzOwovLyAgICAgIF9udW1iZXJEYXRhWzNdLCAvLyBzYWx0OwovLyAgICAgIF9hZGRyZXNzRGF0YVsyXSwgLy8gbWFrZXI7Ci8vICAgICAgX2FkZHJlc3NEYXRhWzNdIC8vIHJlc3RyaWN0ZWRUbzsKICAgIAogICAgYnl0ZXMzMiBoYXNoID0gZ2V0SGFzaChfYWRkcmVzc0RhdGEsIF9udW1iZXJEYXRhKTsKICAgIAogICAgdHJhZGVBbW91bnQgPSBzYWZlU3ViKF9udW1iZXJEYXRhWzBdLCBvcmRlckZpbGxzW2hhc2hdKTsgLy9hdmFpbCB0byB0cmFkZQogICAgCiAgICAvL2JhbGFuY2Ugb2YgZ2l2ZVRva2VuIC8gYW1vdW50IEkgc2FpZCBJJ2QgZ2l2ZSBvZiBnaXZlVG9rZW4gKiBhbW91bnQgSSBzYWlkIEkgd2FudCBvZiBnZXRUb2tlbgogICAgaWYgKAogICAgICB0cmFkZUFtb3VudCA+IHNhZmVEaXYoCiAgICAgICAgc2FmZU11bChiYWxhbmNlc1tfYWRkcmVzc0RhdGFbMV1dW19hZGRyZXNzRGF0YVsyXV0sIF9udW1iZXJEYXRhWzBdKSwKICAgICAgICBfbnVtYmVyRGF0YVsxXQogICAgICApCiAgICApCiAgICB7CiAgICAgIHRyYWRlQW1vdW50ID0gc2FmZURpdigKICAgICAgICBzYWZlTXVsKGJhbGFuY2VzW19hZGRyZXNzRGF0YVsxXV1bX2FkZHJlc3NEYXRhWzJdXSwgX251bWJlckRhdGFbMF0pLAogICAgICAgIF9udW1iZXJEYXRhWzFdCiAgICAgICk7CiAgICB9CiAgICAKICAgIGlmICh0cmFkZUFtb3VudCA+IF9hbW91bnQpIHsgdHJhZGVBbW91bnQgPSBfYW1vdW50OyB9CiAgICAKICAgICAgICAvL19udW1iZXJEYXRhWzBdIGlzIHRha2VyVG9rZW5BbW91bnQKICAgIGlmICh0cmFkZUFtb3VudCA9PSAwKSB7IC8vaWRmay4gVGhlcmUncyBub3RoaW5nIHRoZXJlIHRvIGdldC4gQ2FuY2VsZWQ/IFRyYWRlZD8KICAgICAgaWYgKG9yZGVyRmlsbHNbaGFzaF0gPCBfbnVtYmVyRGF0YVswXSkgeyAvL01ha2VyIHNlZW1zIHRvIGJlIG1pc3NpbmcgdG9rZW5zPwogICAgICAgIEZhaWxlZFRyYWRlKAogICAgICAgICAgKGJ5dGVzMzIoX2FkZHJlc3NEYXRhWzBdKSBeIGJ5dGVzMzIoX2FkZHJlc3NEYXRhWzFdKSksCiAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgaGFzaCwKICAgICAgICAgIDAKICAgICAgICApOwogICAgICB9IGVsc2UgeyAgLy8gZWl0aGVyIGNhbmNlbGxlZCBvciBhbHJlYWR5IHRyYWRlZC4KICAgICAgICBGYWlsZWRUcmFkZSgKICAgICAgICAgIChieXRlczMyKF9hZGRyZXNzRGF0YVswXSkgXiBieXRlczMyKF9hZGRyZXNzRGF0YVsxXSkpLAogICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgIGhhc2gsCiAgICAgICAgICAxCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgCiAgICBpZiAoYmxvY2subnVtYmVyID4gX251bWJlckRhdGFbMl0pIHsgLy9vcmRlciBpcyBleHBpcmVkCiAgICAgIEZhaWxlZFRyYWRlKAogICAgICAgIChieXRlczMyKF9hZGRyZXNzRGF0YVswXSkgXiBieXRlczMyKF9hZGRyZXNzRGF0YVsxXSkpLAogICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgaGFzaCwKICAgICAgICAyCiAgICAgICk7CiAgICAgIHJldHVybiAwOwogICAgfQoKCiAgICBpZiAoKF9maWxsT3JLaWxsID09IHRydWUpICYmICh0cmFkZUFtb3VudCA8IF9hbW91bnQpKSB7IC8vZGlkbnQgZmlsbCwgc28ga2lsbAogICAgICBGYWlsZWRUcmFkZSgKICAgICAgICAoYnl0ZXMzMihfYWRkcmVzc0RhdGFbMF0pIF4gYnl0ZXMzMihfYWRkcmVzc0RhdGFbMV0pKSwKICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgIGhhc2gsCiAgICAgICAgMwogICAgICApOwogICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgICAgIAogICAgdWludDI1NiBmZWVWYWx1ZSA9IHNhZmVNdWwoX2Ftb3VudCwgZmVlQnlDbGFzc1t1c2VyQ2xhc3NbbXNnLnNlbmRlcl1dKSAvICgxIGV0aGVyKTsKCiAgICAvL2lmIHRoZXkgdHJhZGUgbW9yZSB0aGFuIHRoZXkgaGF2ZSwgZ2V0IDAuCiAgICBpZiAoIChfYW1vdW50ICsgZmVlVmFsdWUpID4gYmFsYW5jZXNbX2FkZHJlc3NEYXRhWzBdXVttc2cuc2VuZGVyXSkgIHsgCiAgICAgIEZhaWxlZFRyYWRlKAogICAgICAgIChieXRlczMyKF9hZGRyZXNzRGF0YVswXSkgXiBieXRlczMyKF9hZGRyZXNzRGF0YVsxXSkpLAogICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgaGFzaCwKICAgICAgICA0CiAgICAgICk7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBpZiAoIC8vbm90IGEgdmFsaWQgb3JkZXIuCiAgICAgICAgKGVjcmVjb3ZlcihrZWNjYWsyNTYoc2lnbmVkVHJhZGVIYXNoLCBoYXNoKSwgX3YsIF9yLCBfcykgIT0gX2FkZHJlc3NEYXRhWzJdKQogICAgICAgICYmICghIG9yZGVyc1toYXNoXSkKICAgICkKICAgIHsKICAgICAgRmFpbGVkVHJhZGUoCiAgICAgICAgKGJ5dGVzMzIoX2FkZHJlc3NEYXRhWzBdKSBeIGJ5dGVzMzIoX2FkZHJlc3NEYXRhWzFdKSksCiAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICBoYXNoLAogICAgICAgIDUKICAgICAgKTsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgCiAgICBpZiAoKF9hZGRyZXNzRGF0YVszXSAhPSBhZGRyZXNzKDB4MCkpICYmIChfYWRkcmVzc0RhdGFbM10gIT0gbXNnLnNlbmRlcikpIHsgLy9jaGVjayByZXN0cmljdGVkVG8KICAgICAgRmFpbGVkVHJhZGUoCiAgICAgICAgKGJ5dGVzMzIoX2FkZHJlc3NEYXRhWzBdKSBeIGJ5dGVzMzIoX2FkZHJlc3NEYXRhWzFdKSksCiAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICBoYXNoLAogICAgICAgIDYKICAgICAgKTsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAgICAgCiAgICAKICAgIGlmICggLy9pZiB0aGVyZSdzIGEgY29tcGxpYW5jZSByZXN0cmljdGlvbi4KICAgICAgKChfYWRkcmVzc0RhdGFbMF0gIT0gYWRkcmVzcygweDApKSAvL2lmIG5vdCBFdGgsIGFuZCByZXN0cmljdGVkLCBjaGVjayB3aXRoIENvbXBsaWFuY2UuCiAgICAgICAgJiYgKHJlc3RyaWN0ZWRUb2tlbnNbX2FkZHJlc3NEYXRhWzBdXSApCiAgICAgICAgJiYgISBDb21wbGlhbmNlKGNvbXBsaWFuY2VBZGRyZXNzKS52YWxpZGF0ZVRyYWRlKF9hZGRyZXNzRGF0YVswXSwgX2FkZHJlc3NEYXRhWzJdLCBtc2cuc2VuZGVyKQogICAgICApCiAgICAgIHx8ICgoX2FkZHJlc3NEYXRhWzFdICE9IGFkZHJlc3MoMHgwKSkgIC8vZGl0dG8KICAgICAgICAmJiAocmVzdHJpY3RlZFRva2Vuc1tfYWRkcmVzc0RhdGFbMV1dKQogICAgICAgICYmICEgQ29tcGxpYW5jZShjb21wbGlhbmNlQWRkcmVzcykudmFsaWRhdGVUcmFkZShfYWRkcmVzc0RhdGFbMV0sIF9hZGRyZXNzRGF0YVsyXSwgbXNnLnNlbmRlcikKICAgICAgKQogICAgKQogICAgewogICAgICBGYWlsZWRUcmFkZSgKICAgICAgICAoYnl0ZXMzMihfYWRkcmVzc0RhdGFbMF0pIF4gYnl0ZXMzMihfYWRkcmVzc0RhdGFbMV0pKSwKICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgIGhhc2gsCiAgICAgICAgNwogICAgICApOwogICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgLy9EbyB0aGUgdGhpbmchCiAgICAKICAgIHRyYWRlQmFsYW5jZXMoCiAgICAgIF9hZGRyZXNzRGF0YVswXSwgLy8gdGFrZXJUb2tlbkFkZHJlc3M7CiAgICAgIF9udW1iZXJEYXRhWzBdLCAvLyB0YWtlclRva2VuQW1vdW50OwogICAgICBfYWRkcmVzc0RhdGFbMV0sIC8vIG1ha2VyVG9rZW5BZGRyZXNzOwogICAgICBfbnVtYmVyRGF0YVsxXSwgLy8gbWFrZXJUb2tlbkFtb3VudDsKICAgICAgX2FkZHJlc3NEYXRhWzJdLCAvLyBtYWtlcjsKICAgICAgdHJhZGVBbW91bnQKICAgICk7CgogICAgb3JkZXJGaWxsc1toYXNoXSA9IHNhZmVBZGQob3JkZXJGaWxsc1toYXNoXSwgdHJhZGVBbW91bnQpOwoKICAgIFRyYWRlKAogICAgICAoYnl0ZXMzMihfYWRkcmVzc0RhdGFbMF0pIF4gYnl0ZXMzMihfYWRkcmVzc0RhdGFbMV0pKSwKICAgICAgX2FkZHJlc3NEYXRhWzJdLAogICAgICBtc2cuc2VuZGVyLAogICAgICBfYWRkcmVzc0RhdGFbMV0sCiAgICAgIF9hZGRyZXNzRGF0YVswXSwKICAgICAgX2FkZHJlc3NEYXRhWzNdLAogICAgICBfbnVtYmVyRGF0YSwKICAgICAgdHJhZGVBbW91bnQsCiAgICAgIF9maWxsT3JLaWxsCiAgICApOwogICAgCiAgICByZXR1cm4odHJhZGVBbW91bnQpOwogIH0KICAKICAKICAvLyBDYW5jZWwgYSBzaWduZWQgb3JkZXIsIG9uY2UgdGhpcyBpcyBjb25maXJtZWQgbm9ib2R5IHdpbGwgYmUgYWJsZSB0byB0cmFkZSBpdCBhbnltb3JlCiAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoCiAgICBhZGRyZXNzWzRdIF9hZGRyZXNzRGF0YSwKICAgIHVpbnQyNTZbNF0gX251bWJlckRhdGEgLy93ZWIzIGlzbid0IHJlYWR5IGZvciBzdHJ1Y3RzLgogICkKICAgIGV4dGVybmFsCiAgICByZXR1cm5zKHVpbnQyNTYgYW1vdW50Q2FuY2VsbGVkKQogIHsKICAgIAogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IF9hZGRyZXNzRGF0YVsyXSk7CiAgICAKICAgIC8vICBtc2cuc2VuZGVyIGNhbiAnY2FuY2VsJyBub25leGlzdGVudCBvcmRlcnMgc2luY2UgdGhleSdyZSBvZmZjaGFpbi4KICAgIGJ5dGVzMzIgaGFzaCA9IGdldEhhc2goX2FkZHJlc3NEYXRhLCBfbnVtYmVyRGF0YSk7CiAKICAgIGFtb3VudENhbmNlbGxlZCA9IHNhZmVTdWIoX251bWJlckRhdGFbMF0sb3JkZXJGaWxsc1toYXNoXSk7CiAgICAKICAgIG9yZGVyRmlsbHNbaGFzaF0gPSBfbnVtYmVyRGF0YVswXTsKIAogICAgLy9ldmVudCB0cmlnZ2VyIGlzIG1vdmVkIGFoZWFkIG9mIGJhbGFuY2UgcmVzZXR0aW5nIHRvIGFsbG93IGV4cHJlc3Npb24gb2YgdGhlIGFscmVhZHktZmlsbGVkIGFtb3VudAovLyAgICBfbnVtYmVyRGF0YVswXSBpcyB0YWtlclRva2VuQW1vdW50OwogICAgQ2FuY2VsKAogICAgICAoYnl0ZXMzMihfYWRkcmVzc0RhdGFbMF0pIF4gYnl0ZXMzMihfYWRkcmVzc0RhdGFbMV0pKSwKICAgICAgbXNnLnNlbmRlciwKICAgICAgX2FkZHJlc3NEYXRhLAogICAgICBfbnVtYmVyRGF0YSwKICAgICAgYW1vdW50Q2FuY2VsbGVkKTsKCiAgICByZXR1cm4gYW1vdW50Q2FuY2VsbGVkOyAgICAKICB9CgoKCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqCiAgLyBSZW1vdGUgV2l0aGRyYXcKICAqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgCiAgLy8gUGVyZm9ybSBhbiBFVEggd2l0aGRyYXcgdHJhbnNhY3Rpb24gZm9yIHNvbWVvbmUgZWxzZSBiYXNlZCBvbiB0aGVpciBzaWduZWQgbWVzc2FnZQogIC8vIFVzZWZ1bCBpZiB0aGUgb3duZXIgb2YgdGhlIGZ1bmRzIGRvZXMgbm90IGhhdmUgZW5vdWdoIEVUSCBmb3IgZ2FzIGZlZXMgaW4gdGhlaXIgd2FsbGV0LgogIC8vIG1zZy5zZW5kZXIgcmVjZWl2ZXMgZmVlIGZvciB0aGUgZWZmb3J0IGFuZCBnYXMgY29zdHMKICBmdW5jdGlvbiByZW1vdGVXaXRoZHJhdygKICAgIHVpbnQyNTYgX3dpdGhkcmF3QW1vdW50LAogICAgdWludDI1NiBfZmVlQW1vdW50LAogICAgdWludDI1NiBfd2l0aGRyYXdFeHBpcmVzLAogICAgdWludDI1NiBfc2FsdCwKICAgIGFkZHJlc3MgX21ha2VyLAogICAgYWRkcmVzcyBfcmVzdHJpY3RlZFRvLCAvLzB4MCA9IGFueW9uZQogICAgdWludDggX3YsCiAgICBieXRlczMyIF9yLAogICAgYnl0ZXMzMiBfcwogICkKICAgIGV4dGVybmFsCiAgICBub3RMb2NrZWQKICAgIHJldHVybnMoYm9vbCkKICB7CiAgICAvL2lzIHRoZSB3aXRoZHJhdyBwb3NzaWJsZT8KICAgIHJlcXVpcmUoCiAgICAgICAgKGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bX21ha2VyXSA+PSBzYWZlQWRkKF93aXRoZHJhd0Ftb3VudCwgX2ZlZUFtb3VudCkpCiAgICAgJiYgKAogICAgICAgICAgICAoX3Jlc3RyaWN0ZWRUbyA9PSBhZGRyZXNzKDB4MCkpCiAgICAgICAgIHx8IChfcmVzdHJpY3RlZFRvID09IG1zZy5zZW5kZXIpCiAgICAgICAgKQogICAgICYmICgoX2ZlZUFtb3VudCA9PSAwKSB8fCAoQ29tcGxpYW5jZShjb21wbGlhbmNlQWRkcmVzcykuY2FuRGVwb3NpdChtc2cuc2VuZGVyKSkpCiAgICApOwogICAgCiAgICAvL2hhcyB0aGlzIHdpdGhkcmF3IGhhcHBlbmVkIGFscmVhZHk/IChhbmQgZ2VuZXJhdGUgdGhlIGhhc2gpCgogICAgYnl0ZXMzMiBoYXNoID0ga2VjY2FrMjU2KAogICAgICB0aGlzLCAKICAgICAgX3dpdGhkcmF3QW1vdW50LAogICAgICBfZmVlQW1vdW50LAogICAgICBfd2l0aGRyYXdFeHBpcmVzLAogICAgICBfc2FsdCwKICAgICAgX21ha2VyLAogICAgICBfcmVzdHJpY3RlZFRvCiAgICApOwoKICAgIHJlcXVpcmUob3JkZXJGaWxsc1toYXNoXSA9PSAwKTsKCiAgICAvL2lzIHRoaXMgcmVhbD8KICAgIHJlcXVpcmUoCiAgICAgIGVjcmVjb3ZlcihrZWNjYWsyNTYoc2lnbmVkV2l0aGRyYXdIYXNoLCBoYXNoKSwgX3YsIF9yLCBfcykgPT0gX21ha2VyCiAgICApOwogICAgCiAgICAvL29ubHkgb25jZS4KICAgIG9yZGVyRmlsbHNbaGFzaF0gPSAxOwoKICAgIGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bX21ha2VyXSA9CiAgICAgIHNhZmVTdWIoYmFsYW5jZXNbYWRkcmVzcygweDApXVtfbWFrZXJdLCBzYWZlQWRkKF93aXRoZHJhd0Ftb3VudCwgX2ZlZUFtb3VudCkpOwogICAgLy8gcGF5IGZlZSB0byB0aGUgdXNlciBwZXJmb3JtaW5nIHRoZSByZW1vdGUgd2l0aGRyYXcKICAgIGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW2FkZHJlc3MoMHgwKV1bbXNnLnNlbmRlcl0sIF9mZWVBbW91bnQpOwogICAgCiAgICBnbG9iYWxCYWxhbmNlW2FkZHJlc3MoMHgwKV0gPSBzYWZlU3ViKGdsb2JhbEJhbGFuY2VbYWRkcmVzcygweDApXSwgX3dpdGhkcmF3QW1vdW50KTsKCiAgICBSZW1vdGVXaXRoZHJhdygKICAgICAgX21ha2VyLAogICAgICBtc2cuc2VuZGVyLAogICAgICBfd2l0aGRyYXdBbW91bnQsCiAgICAgIF9mZWVBbW91bnQsCiAgICAgIF93aXRoZHJhd0V4cGlyZXMsCiAgICAgIF9zYWx0LAogICAgICBfcmVzdHJpY3RlZFRvCiAgICApOwoKICAgIC8vaW1wbGljaXQgcmVxdWlyZSBpbmNsdWRlZC4KICAgIF9tYWtlci50cmFuc2Zlcihfd2l0aGRyYXdBbW91bnQpOwogICAgCiAgICByZXR1cm4odHJ1ZSk7CiAgfQoKICAvLyBjYW5jZWwgYSBzaWduZWQgcmVxdWVzdCBmb3IgYSByZW1vdGUgd2l0aGRyYXcKICBmdW5jdGlvbiBjYW5jZWxSZW1vdGVXaXRoZHJhdygKICAgIHVpbnQyNTYgX3dpdGhkcmF3QW1vdW50LAogICAgdWludDI1NiBfZmVlQW1vdW50LAogICAgdWludDI1NiBfd2l0aGRyYXdFeHBpcmVzLAogICAgdWludDI1NiBfc2FsdCwKICAgIGFkZHJlc3MgX3Jlc3RyaWN0ZWRUbyAvLzB4MCA9IGFueW9uZQogICkKICAgIGV4dGVybmFsCiAgewogICAgICAvLyBtc2cuc2VuZGVyIGNhbiBjYW5jZWwgbm9uZXhzaXN0ZW50IG9yZGVycy4KICAgIGJ5dGVzMzIgaGFzaCA9IGtlY2NhazI1NigKICAgICAgdGhpcywgCiAgICAgIF93aXRoZHJhd0Ftb3VudCwKICAgICAgX2ZlZUFtb3VudCwKICAgICAgX3dpdGhkcmF3RXhwaXJlcywKICAgICAgX3NhbHQsCiAgICAgIG1zZy5zZW5kZXIsCiAgICAgIF9yZXN0cmljdGVkVG8KICAgICk7CiAgICAKICAgIENhbmNlbFJlbW90ZVdpdGhkcmF3KAogICAgICBtc2cuc2VuZGVyLAogICAgICBfd2l0aGRyYXdBbW91bnQsCiAgICAgIF9mZWVBbW91bnQsCiAgICAgIF93aXRoZHJhd0V4cGlyZXMsCiAgICAgIF9zYWx0LAogICAgICBfcmVzdHJpY3RlZFRvLAogICAgICBvcmRlckZpbGxzW2hhc2hdCiAgICApOwogICAgCiAgICAvL3NldCB0byBjb21wbGV0ZWQgYWZ0ZXIsIGV2ZW50IHNob3dzIHByZS1jYW5jZWwgc3RhdHVzLgogICAgb3JkZXJGaWxsc1toYXNoXSA9IDE7CiAgfQogIAogIAogCgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKgogIC9VcGdyYWRlIEZ1bmN0aW9uCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAKICAvLyBtb3ZlIHRva2Vucy9FVEggb3ZlciB0byBhIG5ldyB1cGdyYWRlZCBzbWFydCBjb250cmFjdCAgKGF2b2lkcyBoYXZpbmcgdG8gd2l0aGRyYXcgJiBkZXBvc2l0KQogIGZ1bmN0aW9uIHVwZ3JhZGUoYWRkcmVzcyBfdG9rZW4pIGV4dGVybmFsIHJldHVybnModWludDI1NiBtb3ZlQmFsYW5jZSkgewogICAgcmVxdWlyZSAobmV3RXhjaGFuZ2UgIT0gYWRkcmVzcygweDApKTsKCiAgICBtb3ZlQmFsYW5jZSA9IGJhbGFuY2VzW190b2tlbl1bbXNnLnNlbmRlcl07CgogICAgZ2xvYmFsQmFsYW5jZVtfdG9rZW5dID0gc2FmZVN1YihnbG9iYWxCYWxhbmNlW190b2tlbl0sIG1vdmVCYWxhbmNlKTsKICAgIGJhbGFuY2VzW190b2tlbl1bbXNnLnNlbmRlcl0gPSAwOwoKICAgIGlmIChfdG9rZW4gIT0gYWRkcmVzcygweDApKXsKICAgICAgcmVxdWlyZShUb2tlbihfdG9rZW4pLmFwcHJvdmUobmV3RXhjaGFuZ2UsIG1vdmVCYWxhbmNlKSk7CiAgICAgIHJlcXVpcmUoVWJlckRlbHRhKG5ld0V4Y2hhbmdlKS5kZXBvc2l0VG9rZW5Ub1VzZXIobXNnLnNlbmRlciwgX3Rva2VuLCBtb3ZlQmFsYW5jZSkpOwogICAgfSBlbHNlIHsKICAgICAgcmVxdWlyZShVYmVyRGVsdGEobmV3RXhjaGFuZ2UpLmRlcG9zaXRUb1VzZXIudmFsdWUobW92ZUJhbGFuY2UpKG1zZy5zZW5kZXIpKTsKICAgIH0KCiAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIF90b2tlbiwgbmV3RXhjaGFuZ2UsIG1vdmVCYWxhbmNlKTsKICAgIAogICAgcmV0dXJuKG1vdmVCYWxhbmNlKTsKICB9CgoKICAKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIC8gRGF0YSBWaWV3IGZ1bmN0aW9ucwogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgCiAgZnVuY3Rpb24gdGVzdFRyYWRlKAogICAgYWRkcmVzc1s0XSBfYWRkcmVzc0RhdGEsCiAgICB1aW50MjU2WzRdIF9udW1iZXJEYXRhLCAvL3dlYjMgaXNuJ3QgcmVhZHkgZm9yIHN0cnVjdHMuCiAgICB1aW50OCBfdiwKICAgIGJ5dGVzMzIgX3IsCiAgICBieXRlczMyIF9zLAogICAgdWludDI1NiBfYW1vdW50LAogICAgYWRkcmVzcyBfc2VuZGVyLAogICAgYm9vbCBfZmlsbE9yS2lsbAogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyh1aW50MjU2KQogIHsKICAgIHVpbnQyNTYgZmVlVmFsdWUgPSBzYWZlTXVsKF9hbW91bnQsIGZlZUJ5Q2xhc3NbdXNlckNsYXNzW19zZW5kZXJdXSkgLyAoMSBldGhlcik7CgogICAgaWYgKAogICAgICBjb250cmFjdExvY2tlZAogICAgICB8fAogICAgICAoKF9hZGRyZXNzRGF0YVswXSAhPSBhZGRyZXNzKDB4MCkpIC8vaWYgbm90IEV0aCwgYW5kIHJlc3RyaWN0ZWQsIGNoZWNrIHdpdGggQ29tcGxpYW5jZS4KICAgICAgICAmJiAocmVzdHJpY3RlZFRva2Vuc1tfYWRkcmVzc0RhdGFbMF1dICkKICAgICAgICAmJiAhIENvbXBsaWFuY2UoY29tcGxpYW5jZUFkZHJlc3MpLnZhbGlkYXRlVHJhZGUoX2FkZHJlc3NEYXRhWzBdLCBfYWRkcmVzc0RhdGFbMl0sIF9zZW5kZXIpCiAgICAgICkKICAgICAgfHwgKChfYWRkcmVzc0RhdGFbMV0gIT0gYWRkcmVzcygweDApKSAgLy9kaXR0bwogICAgICAgICYmIChyZXN0cmljdGVkVG9rZW5zW19hZGRyZXNzRGF0YVsxXV0pCiAgICAgICAgJiYgISBDb21wbGlhbmNlKGNvbXBsaWFuY2VBZGRyZXNzKS52YWxpZGF0ZVRyYWRlKF9hZGRyZXNzRGF0YVsxXSwgX2FkZHJlc3NEYXRhWzJdLCBfc2VuZGVyKQogICAgICApCiAgICAgICAgIC8vaWYgdGhleSB0cmFkZSBtb3JlIHRoYW4gdGhleSBoYXZlLCBnZXQgMC4KICAgICAgfHwgKChfYW1vdW50ICsgZmVlVmFsdWUpID4gYmFsYW5jZXNbX2FkZHJlc3NEYXRhWzBdXVtfc2VuZGVyXSkgCiAgICAgIHx8ICgoX2FkZHJlc3NEYXRhWzNdICE9IGFkZHJlc3MoMHgwKSkgJiYgKF9hZGRyZXNzRGF0YVszXSAhPSBfc2VuZGVyKSkgLy9jaGVjayByZXN0cmljdGVkVG8KICAgICkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAgIAogICAgdWludDI1NiB0cmFkZUFtb3VudCA9IGF2YWlsYWJsZVZvbHVtZSgKICAgICAgICBfYWRkcmVzc0RhdGEsCiAgICAgICAgX251bWJlckRhdGEsCiAgICAgICAgX3YsCiAgICAgICAgX3IsCiAgICAgICAgX3MKICAgICk7CiAgICAKICAgIGlmICh0cmFkZUFtb3VudCA+IF9hbW91bnQpIHsgdHJhZGVBbW91bnQgPSBfYW1vdW50OyB9CiAgICAKICAgIGlmICgoX2ZpbGxPcktpbGwgPT0gdHJ1ZSkgJiYgKHRyYWRlQW1vdW50IDwgX2Ftb3VudCkpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIHRyYWRlQW1vdW50OwogIH0KCgogIC8vIGdldCBob3cgbXVjaCBvZiBhbiBvcmRlciBpcyBsZWZ0ICh1bmZpbGxlZCkKICAvLyByZXR1cm4gdmFsdWUgaW4gb3JkZXIgb2YgX3Rha2VyVG9rZW5BZGRyZXNzCiAgZnVuY3Rpb24gYXZhaWxhYmxlVm9sdW1lKAogICAgYWRkcmVzc1s0XSBfYWRkcmVzc0RhdGEsCiAgICB1aW50MjU2WzRdIF9udW1iZXJEYXRhLCAvL3dlYjMgaXNuJ3QgcmVhZHkgZm9yIHN0cnVjdHMuCiAgICB1aW50OCBfdiwKICAgIGJ5dGVzMzIgX3IsCiAgICBieXRlczMyIF9zCiAgKQogICAgcHVibGljCiAgICB2aWV3CiAgICByZXR1cm5zKHVpbnQyNTYgYW1vdW50UmVtYWluaW5nKQogIHsgICAgIAovLyAgICBfYWRkcmVzc0RhdGFbMF0gLy8gdGFrZXJUb2tlbkFkZHJlc3M7Ci8vICAgIF9udW1iZXJEYXRhWzBdIC8vIHRha2VyVG9rZW5BbW91bnQ7Ci8vICAgIF9hZGRyZXNzRGF0YVsxXSAvLyBtYWtlclRva2VuQWRkcmVzczsKLy8gICAgX251bWJlckRhdGFbMV0gLy8gbWFrZXJUb2tlbkFtb3VudDsKLy8gICAgX251bWJlckRhdGFbMl0gLy8gdHJhZGVFeHBpcmVzOwovLyAgICBfbnVtYmVyRGF0YVszXSAvLyBzYWx0OwovLyAgICBfYWRkcmVzc0RhdGFbMl0gLy8gbWFrZXI7Ci8vICAgIF9hZGRyZXNzRGF0YVszXSAvLyByZXN0cmljdGVkVG87CgogICAgYnl0ZXMzMiBoYXNoID0gZ2V0SGFzaChfYWRkcmVzc0RhdGEsIF9udW1iZXJEYXRhKTsKCiAgICBpZiAoCiAgICAgIChibG9jay5udW1iZXIgPiBfbnVtYmVyRGF0YVsyXSkKICAgICAgfHwgKCAKICAgICAgICAoZWNyZWNvdmVyKGtlY2NhazI1NihzaWduZWRUcmFkZUhhc2gsIGhhc2gpLCBfdiwgX3IsIF9zKSAhPSBfYWRkcmVzc0RhdGFbMl0pCiAgICAgICAgJiYgKCEgb3JkZXJzW2hhc2hdKQogICAgICApCiAgICApIHsgcmV0dXJuIDA7IH0KCiAgICAvL3VpbnQyNTYgYW1vdW50UmVtYWluaW5nID0gc2FmZVN1YihteVRyYWRlLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyRmlsbHNbaGFzaF0pOwogICAgIGFtb3VudFJlbWFpbmluZyA9IHNhZmVTdWIoX251bWJlckRhdGFbMF0sIG9yZGVyRmlsbHNbaGFzaF0pOwoKICAgIGlmICgKICAgICAgYW1vdW50UmVtYWluaW5nIDwgc2FmZURpdigKICAgICAgICBzYWZlTXVsKGJhbGFuY2VzW19hZGRyZXNzRGF0YVsxXV1bX2FkZHJlc3NEYXRhWzJdXSwgX251bWJlckRhdGFbMF0pLAogICAgICAgIF9udW1iZXJEYXRhWzFdCiAgICAgICkKICAgICkgcmV0dXJuIGFtb3VudFJlbWFpbmluZzsKCiAgICByZXR1cm4gKAogICAgICBzYWZlRGl2KAogICAgICAgIHNhZmVNdWwoYmFsYW5jZXNbX2FkZHJlc3NEYXRhWzFdXVtfYWRkcmVzc0RhdGFbMl1dLCBfbnVtYmVyRGF0YVswXSksCiAgICAgICAgX251bWJlckRhdGFbMV0KICAgICAgKQogICAgKTsKICB9CgoKICAvLyBnZXQgaG93IG11Y2ggb2YgYW4gb3JkZXIgaGFzIGJlZW4gZmlsbGVkCiAgLy8gcmV0dXJuIHZhbHVlIGluIG9yZGVyIG9mIF90YWtlclRva2VuQWRkcmVzcwogIGZ1bmN0aW9uIGdldFVzZXJGZWUoCiAgICBhZGRyZXNzIF91c2VyCiAgKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnModWludDI1NikKICB7CiAgICByZXR1cm4gZmVlQnlDbGFzc1t1c2VyQ2xhc3NbX3VzZXJdXTsKICB9CgoKICAvLyBnZXQgaG93IG11Y2ggb2YgYW4gb3JkZXIgaGFzIGJlZW4gZmlsbGVkCiAgLy8gcmV0dXJuIHZhbHVlIGluIG9yZGVyIG9mIF90YWtlclRva2VuQWRkcmVzcwogIGZ1bmN0aW9uIGFtb3VudEZpbGxlZCgKICAgIGFkZHJlc3NbNF0gX2FkZHJlc3NEYXRhLAogICAgdWludDI1Nls0XSBfbnVtYmVyRGF0YSAvL3dlYjMgaXNuJ3QgcmVhZHkgZm9yIHN0cnVjdHMuCiAgKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnModWludDI1NikKICB7CiAgICBieXRlczMyIGhhc2ggPSBnZXRIYXNoKF9hZGRyZXNzRGF0YSwgX251bWJlckRhdGEpOwoKICAgIHJldHVybiBvcmRlckZpbGxzW2hhc2hdOwogIH0KCiAgCiAgLy8gY2hlY2sgaWYgYSByZXF1ZXN0IGZvciBhIHJlbW90ZSB3aXRoZHJhdyBpcyBzdGlsbCB2YWxpZAogIGZ1bmN0aW9uIHRlc3RSZW1vdGVXaXRoZHJhdygKICAgIHVpbnQyNTYgX3dpdGhkcmF3QW1vdW50LAogICAgdWludDI1NiBfZmVlQW1vdW50LAogICAgdWludDI1NiBfd2l0aGRyYXdFeHBpcmVzLAogICAgdWludDI1NiBfc2FsdCwKICAgIGFkZHJlc3MgX21ha2VyLAogICAgYWRkcmVzcyBfcmVzdHJpY3RlZFRvLAogICAgdWludDggX3YsCiAgICBieXRlczMyIF9yLAogICAgYnl0ZXMzMiBfcywKICAgIGFkZHJlc3MgX3NlbmRlcgogICkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgYnl0ZXMzMiBoYXNoID0ga2VjY2FrMjU2KAogICAgICB0aGlzLAogICAgICBfd2l0aGRyYXdBbW91bnQsCiAgICAgIF9mZWVBbW91bnQsCiAgICAgIF93aXRoZHJhd0V4cGlyZXMsCiAgICAgIF9zYWx0LAogICAgICBfbWFrZXIsCiAgICAgIF9yZXN0cmljdGVkVG8KICAgICk7CgogICAgaWYgKAogICAgICBjb250cmFjdExvY2tlZAogICAgICB8fAogICAgICAoYmFsYW5jZXNbYWRkcmVzcygweDApXVtfbWFrZXJdIDwgc2FmZUFkZChfd2l0aGRyYXdBbW91bnQsIF9mZWVBbW91bnQpKQogICAgICB8fCgoX3Jlc3RyaWN0ZWRUbyAhPSBhZGRyZXNzKDB4MCkpICYmIChfcmVzdHJpY3RlZFRvICE9IF9zZW5kZXIpKQogICAgICB8fCAob3JkZXJGaWxsc1toYXNoXSAhPSAwKQogICAgICB8fCAoZWNyZWNvdmVyKGtlY2NhazI1NihzaWduZWRXaXRoZHJhd0hhc2gsIGhhc2gpLCBfdiwgX3IsIF9zKSAhPSBfbWFrZXIpCiAgICAgIHx8ICgoX2ZlZUFtb3VudCA+IDApICYmICghIENvbXBsaWFuY2UoY29tcGxpYW5jZUFkZHJlc3MpLmNhbkRlcG9zaXQoX3NlbmRlcikpKQogICAgKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBfd2l0aGRyYXdBbW91bnQ7CiAgICB9CiAgfQogIAogIAogIAogIGZ1bmN0aW9uIGdldEhhc2goCiAgICBhZGRyZXNzWzRdIF9hZGRyZXNzRGF0YSwKICAgIHVpbnQyNTZbNF0gX251bWJlckRhdGEgLy93ZWIzIGlzbid0IHJlYWR5IGZvciBzdHJ1Y3RzLgogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyhieXRlczMyKQogIHsKICAgIHJldHVybigKICAgICAga2VjY2FrMjU2KAogICAgICAgIHRoaXMsCiAgICAgICAgX2FkZHJlc3NEYXRhWzBdLCAvLyB0YWtlclRva2VuQWRkcmVzczsKICAgICAgICBfbnVtYmVyRGF0YVswXSwgLy8gdGFrZXJUb2tlbkFtb3VudDsKICAgICAgICBfYWRkcmVzc0RhdGFbMV0sIC8vIG1ha2VyVG9rZW5BZGRyZXNzOwogICAgICAgIF9udW1iZXJEYXRhWzFdLCAvLyBtYWtlclRva2VuQW1vdW50OwogICAgICAgIF9udW1iZXJEYXRhWzJdLCAvLyB0cmFkZUV4cGlyZXM7CiAgICAgICAgX251bWJlckRhdGFbM10sIC8vIHNhbHQ7CiAgICAgICAgX2FkZHJlc3NEYXRhWzJdLCAvLyBtYWtlcjsKICAgICAgICBfYWRkcmVzc0RhdGFbM10gLy8gcmVzdHJpY3RlZFRvOwogICAgICApCiAgICApOwogIH0KICAKICAKCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgLyBDb21wbGlhbmNlIFZpZXcgQ29kZQogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAvL3NpbmNlIHRoZSBjb21wbGlhbmNlIGNvZGUgbWlnaHQgbW92ZSwgd2Ugc2hvdWxkIGhhdmUgYSB3YXkgdG8gYWx3YXlzCiAgLy9jYWxsIGEgZnVuY3Rpb24gdG8gdGhpcyBjb250cmFjdCB0byBnZXQgdGhlIGN1cnJlbnQgdmFsdWVzCgogICAgZnVuY3Rpb24gdGVzdENhbkRlcG9zaXQoCiAgICBhZGRyZXNzIF91c2VyCiAgKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuKENvbXBsaWFuY2UoY29tcGxpYW5jZUFkZHJlc3MpLmNhbkRlcG9zaXQoX3VzZXIpKTsKICB9CiAgCiAgZnVuY3Rpb24gdGVzdENhblRyYWRlKAogICAgYWRkcmVzcyBfdG9rZW4sCiAgICBhZGRyZXNzIF91c2VyCiAgKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuKENvbXBsaWFuY2UoY29tcGxpYW5jZUFkZHJlc3MpLmNhblRyYWRlKF90b2tlbiwgX3VzZXIpKTsKICB9CgogIAogIGZ1bmN0aW9uIHRlc3RWYWxpZGF0ZVRyYWRlKAogICAgYWRkcmVzcyBfdG9rZW4sCiAgICBhZGRyZXNzIF9nZXRVc2VyLAogICAgYWRkcmVzcyBfZ2l2ZVVzZXIKICApCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCBpc0FsbG93ZWQpCiAgewogICAgcmV0dXJuKENvbXBsaWFuY2UoY29tcGxpYW5jZUFkZHJlc3MpLnZhbGlkYXRlVHJhZGUoX3Rva2VuLCBfZ2V0VXNlciwgX2dpdmVVc2VyKSk7CiAgfQogIAoKCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqCiAgLyBEZWZhdWx0IENvbXBsaWFuY2UgQ29kZQogICoqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAvLyBUaGVzZSB3aWxsIGV2ZW50dWFsbHkgbGl2ZSBpbiBhIGRpZmZlcmVudCBjb250cmFjdC4KICAvLyBldmVyeSBjYW4gZGVwb3NpdCBieSBkZWZhdWx0LCBsYXRlciBhIHJlZ2lzdHJ5PwogIC8vIEZvciBub3csIGFsd2F5cyBzYXkgbm8gaWYgY2FsbGVkIGZvciB0cmFkZXMuIAogIC8vIHRoZSBlYXJsaWVzdCB1c2UgbWF5IGJlIGhhbHRpbmcgdHJhZGUgaW4gYSB0b2tlbi4KICBmdW5jdGlvbiBjYW5EZXBvc2l0KAogICAgYWRkcmVzcyBfdXNlcgogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCBpc0FsbG93ZWQpCiAgewogICAgcmV0dXJuKHRydWUpOwogIH0KICAKICBmdW5jdGlvbiBjYW5UcmFkZSgKICAgIGFkZHJlc3MgX3Rva2VuLAogICAgYWRkcmVzcyBfdXNlcgogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCBpc0FsbG93ZWQpCiAgewogICAgcmV0dXJuKGZhbHNlKTsKICB9CgogIAogIGZ1bmN0aW9uIHZhbGlkYXRlVHJhZGUoCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIGFkZHJlc3MgX2dldFVzZXIsCiAgICBhZGRyZXNzIF9naXZlVXNlcgogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCBpc0FsbG93ZWQpCiAgewogICAgcmV0dXJuKGZhbHNlKTsKICB9CiAgCgoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAvIFRISVMgSVMgV0hFUkUgT1BUSU9OUyBMSVZFISEhIQogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogIAogIAogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGV4ZXJjaXNlZE9wdGlvbnM7CiAgCiAgLy9nZXQgYXNzZXQgZm9yIHRpY2tldHMKICBldmVudCBDb2xsYXBzZU9wdGlvbigKICAgIGFkZHJlc3MgaW5kZXhlZCB1c2VyLAogICAgYWRkcmVzcyBpbmRleGVkIGhvbGRlclRpY2tldEFkZHJlc3MsCiAgICBhZGRyZXNzIGluZGV4ZWQgd3JpdGVyVGlja2V0QWRkcmVzcywKICAgIHVpbnQyNTYgdGlja2V0c0NvbGxhcHNlZCwKICAgIGJ5dGVzMzIgb3B0aW9uUGFpciAvL2Fzc2V0VG9rZW5BZGRyZXNzIHhvciBzdHJpa2VUb2tlbkFkZHJlc3MKICApOyAgICAKICAKICAvL2dldCBob2xkZXJ0aWNrZXQgKyBhc3NldCBmb3Igc3RyaWtlCiAgZXZlbnQgRXhjZXJjaXNlVW53aW5kKAogICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgaG9sZGVyVGlja2V0QWRkcmVzcywKICAgIHVpbnQyNTYgdGlja2V0c1Vud291bmQsCiAgICBieXRlczMyIG9wdGlvblBhaXIsCiAgICBib29sIGZpbGxPcktpbGwKICApOyAgCiAgCiAgLy9nZXQgYXNzZXQgZm9yIHdyaXRlcnRpY2tldAogIGV2ZW50IEV4cGlyZU9wdGlvbigKICAgIGFkZHJlc3MgaW5kZXhlZCB1c2VyLAogICAgYWRkcmVzcyBpbmRleGVkIHdyaXRlclRpY2tldEFkZHJlc3MsCiAgICB1aW50MjU2IHRpY2tldHNFeHBpcmVkLAogICAgYnl0ZXMzMiBvcHRpb25QYWlyCiAgKTsgIAogIAogIC8vZ2V0IHRpY2tldHMgZm9yIGFzc2V0CiAgZXZlbnQgQ3JlYXRlT3B0aW9uKAogICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICBhZGRyZXNzIGluZGV4ZWQgaG9sZGVyVGlja2V0QWRkcmVzcywKICAgIGFkZHJlc3MgaW5kZXhlZCB3cml0ZXJUaWNrZXRBZGRyZXNzLAogICAgdWludDI1NiB0aWNrZXRzQ3JlYXRlZCwKICAgIGJ5dGVzMzIgb3B0aW9uUGFpcgogICk7ICAKICAKICAvL2dldCBhc3NzZXQgZm9yIHN0cmlrZSArIGhvbGRlcnRpY2tldAogIGV2ZW50IEV4Y2VyY2lzZU9wdGlvbigKICAgIGFkZHJlc3MgaW5kZXhlZCB1c2VyLAogICAgYWRkcmVzcyBpbmRleGVkIGhvbGRlclRpY2tldEFkZHJlc3MsCiAgICB1aW50MjU2IHRpY2tldHNFeGNlcmNpc2VkLAogICAgYnl0ZXMzMiBvcHRpb25QYWlyIC8vYXNzZXRUb2tlbkFkZHJlc3MgeG9yIHN0cmlrZVRva2VuQWRkcmVzcwogICk7ICAKICAKICAvKioqKioqKioqKioqKioqKioqCiAgLyBvcHRpb25GdW5jdGlvbnMKICAqKioqKioqKioqKioqKioqKiovCiAgCiAgLy9pZiBiZWZvcmUgZXhwaXJ5LCBkZXBvc2l0IGFzc2V0LCBnZXQgYnV5IHRpY2tldCwgd3JpdGUgdGlja2V0CiAgLy8gMSB0aWNrZXQgZ2V0cyAoMTBeMTgpIG9wdGlvbiB1bml0cyBjcmVkaXRlZCB0byB0aGVtLgogIGZ1bmN0aW9uIGNyZWF0ZU9wdGlvblBhaXIoIC8vIzY1CiAgICBhZGRyZXNzIF9hc3NldFRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICBhZGRyZXNzIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9zdHJpa2VUb2tlbkFtb3VudCwKICAgIHVpbnQyNTYgX29wdGlvbkV4cGlyZXMsCiAgICB1aW50MjU2IF90aWNrZXRBbW91bnQgLy90aWNrZXRzIHRpbWVzICgxIGV0aGVyKQogICkKICAgIGV4dGVybmFsCiAgICBub3RMb2NrZWQKICAgIHJldHVybnMgKHVpbnQyNTYgdGlja2V0c0NyZWF0ZWQpCiAgewogICAgLy9pZiBiZWZvcmUgZXhwaXJ5CiAgICByZXF1aXJlIChibG9jay5udW1iZXIgPCBfb3B0aW9uRXhwaXJlcyk7IC8vb3B0aW9uIHdvdWxkIGJlIGV4cGlyZWQKICAgIAogICAgLy9pZiB0aGV5IGhhdmUgdGhlIGFzc2V0CiAgICAvL1tjaGVja2VkIGJ5IHNhZmVtYXRoIGR1cmluZyBsb2NraW5nXQoKICAgIC8vbG9jayBhc3NldCB0byAweDAuCiAgICAvL3RoZSBwZXJjZW50IG9mIG9uZSBjb250cmFjdCB0aW1lcyBfYXNzZXRUb2tlbkFtb3VudCA9IGFtb3VudCBtb3ZpbmcKICAgIC8vY3JlYXRpb24gZmVlPwogICAgYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVsweDBdID0KICAgICAgc2FmZUFkZCgKICAgICAgICBiYWxhbmNlc1tfYXNzZXRUb2tlbkFkZHJlc3NdWzB4MF0sCiAgICAgICAgc2FmZURpdihzYWZlTXVsKF9hc3NldFRva2VuQW1vdW50LCBfdGlja2V0QW1vdW50KSwgMSBldGhlcikKICAgICAgKTsKCiAgICBiYWxhbmNlc1tfYXNzZXRUb2tlbkFkZHJlc3NdW21zZy5zZW5kZXJdID0KICAgICAgc2FmZVN1YigKICAgICAgICBiYWxhbmNlc1tfYXNzZXRUb2tlbkFkZHJlc3NdW21zZy5zZW5kZXJdLAogICAgICAgIHNhZmVEaXYoc2FmZU11bChfYXNzZXRUb2tlbkFtb3VudCwgX3RpY2tldEFtb3VudCksIDEgZXRoZXIpCiAgICAgICk7CiAgICAKICAgIAogICAgYWRkcmVzcyBob2xkZXJUaWNrZXRBZGRyZXNzID0gZ2V0T3B0aW9uQWRkcmVzcygKICAgICAgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgX3N0cmlrZVRva2VuQW1vdW50LAogICAgICBfb3B0aW9uRXhwaXJlcywKICAgICAgZmFsc2UKICAgICk7CiAgICAKICAgIGFkZHJlc3Mgd3JpdGVyVGlja2V0QWRkcmVzcyA9IGdldE9wdGlvbkFkZHJlc3MoCiAgICAgIF9hc3NldFRva2VuQWRkcmVzcywKICAgICAgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICAgIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICAgIF9zdHJpa2VUb2tlbkFtb3VudCwKICAgICAgX29wdGlvbkV4cGlyZXMsCiAgICAgIHRydWUKICAgICk7CiAgICAKICAgIC8vaXNzdWUgd3JpdGUgb3B0aW9uCiAgICBiYWxhbmNlc1t3cml0ZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXSA9CiAgICAgIHNhZmVBZGQoYmFsYW5jZXNbd3JpdGVyVGlja2V0QWRkcmVzc11bbXNnLnNlbmRlcl0sIF90aWNrZXRBbW91bnQpOwogICAgZ2xvYmFsQmFsYW5jZVt3cml0ZXJUaWNrZXRBZGRyZXNzXSA9CiAgICAgIHNhZmVBZGQoZ2xvYmFsQmFsYW5jZVt3cml0ZXJUaWNrZXRBZGRyZXNzXSwgX3RpY2tldEFtb3VudCk7CgogICAgLy9pc3N1ZSBob2xkIG9wdGlvbgogICAgYmFsYW5jZXNbaG9sZGVyVGlja2V0QWRkcmVzc11bbXNnLnNlbmRlcl0gPQogICAgICBzYWZlQWRkKGJhbGFuY2VzW2hvbGRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdLCBfdGlja2V0QW1vdW50KTsKICAgIGdsb2JhbEJhbGFuY2VbaG9sZGVyVGlja2V0QWRkcmVzc10gPQogICAgICBzYWZlQWRkKGdsb2JhbEJhbGFuY2VbaG9sZGVyVGlja2V0QWRkcmVzc10sIF90aWNrZXRBbW91bnQpOwoKICAgIENyZWF0ZU9wdGlvbigKICAgICAgbXNnLnNlbmRlciwKICAgICAgaG9sZGVyVGlja2V0QWRkcmVzcywKICAgICAgd3JpdGVyVGlja2V0QWRkcmVzcywKICAgICAgX3RpY2tldEFtb3VudCwKICAgICAgKGJ5dGVzMzIoX2Fzc2V0VG9rZW5BZGRyZXNzKSBeIGJ5dGVzMzIoX3N0cmlrZVRva2VuQWRkcmVzcykpCiAgICApOwogICAgCiAgICAvL2NoZWNrIGlmIHdlIG5lZWQgdG8gcmVnaXN0ZXIsIGFuZCBkbyBpZiB3ZSBkby4KICAgIGlmICgKICAgICAgT3B0aW9uUmVnaXN0cnkob3B0aW9uc1JlZ2lzdHJ5QWRkcmVzcykuaXNPcHRpb25QYWlyUmVnaXN0ZXJlZCgKICAgICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgICAgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgICAgX29wdGlvbkV4cGlyZXMKICAgICAgKQogICAgICA9PSBmYWxzZQogICAgKQogICAgewogICAgICByZXF1aXJlKAogICAgICAgIE9wdGlvblJlZ2lzdHJ5KG9wdGlvbnNSZWdpc3RyeUFkZHJlc3MpLnJlZ2lzdGVyT3B0aW9uUGFpcigKICAgICAgICAgIF9hc3NldFRva2VuQWRkcmVzcywKICAgICAgICAgIF9hc3NldFRva2VuQW1vdW50LAogICAgICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgICAgIF9zdHJpa2VUb2tlbkFtb3VudCwKICAgICAgICAgIF9vcHRpb25FeHBpcmVzCiAgICAgICAgKQogICAgICApOwogICAgfQogICAgcmV0dXJuIF90aWNrZXRBbW91bnQ7CiAgfQogIAogIC8vaWYgb3duIGJ1eSAmIHdyaXRlciB0aWNrZXQgZ2V0IGFzc2V0LCB2b2lkIHRpY2tldHMKICAvLyAxIHRpY2tldCBnZXRzIDEwXjE4IG9wdGlvbiB1bml0cyB2b2lkZWQuCiAgZnVuY3Rpb24gY29sbGFwc2VPcHRpb25QYWlyKCAvLyM2NgogICAgYWRkcmVzcyBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9hc3NldFRva2VuQW1vdW50LAogICAgYWRkcmVzcyBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICB1aW50MjU2IF9vcHRpb25FeHBpcmVzLAogICAgdWludDI1NiBfdGlja2V0QW1vdW50CiAgKQogICAgZXh0ZXJuYWwKICAgIHJldHVybnMgKHVpbnQyNTYgdGlja2V0c0NvbGxhcHNlZCkKICB7CiAgICAKICAgIGFkZHJlc3MgaG9sZGVyVGlja2V0QWRkcmVzcyA9IGdldE9wdGlvbkFkZHJlc3MoCiAgICAgIF9hc3NldFRva2VuQWRkcmVzcywKICAgICAgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICAgIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICAgIF9zdHJpa2VUb2tlbkFtb3VudCwKICAgICAgX29wdGlvbkV4cGlyZXMsCiAgICAgIGZhbHNlCiAgICApOwogICAgCiAgICBhZGRyZXNzIHdyaXRlclRpY2tldEFkZHJlc3MgPSBnZXRPcHRpb25BZGRyZXNzKAogICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgIF9hc3NldFRva2VuQW1vdW50LAogICAgICBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgIF9vcHRpb25FeHBpcmVzLAogICAgICB0cnVlCiAgICApOwogICAgCiAgICAvL2lmIHRoZXkgaGF2ZSB0aGUgd3JpdGUgb3B0aW9uCiAgICAvL2lmIHRoZXkgaGF2ZSB0aGUgaG9sZCBvcHRpb24KICAgIHJlcXVpcmUgKAogICAgICAoYmFsYW5jZXNbaG9sZGVyVGlja2V0QWRkcmVzc11bbXNnLnNlbmRlcl0gPj0gX3RpY2tldEFtb3VudCkKICAgICAgJiYgKGJhbGFuY2VzW3dyaXRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdID49IF90aWNrZXRBbW91bnQpCiAgICApOwogICAgLy9JIGd1ZXNzIGl0IGNhbiBiZSBleHBpcmVkLCBzaW5jZSB5b3UgaGF2ZSBib3RoIGxlZ3MuCiAgICAKICAgIC8vdm9pZCB3cml0ZSBvcHRpb24KICAgIGJhbGFuY2VzW3dyaXRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdID0KICAgICAgc2FmZVN1YihiYWxhbmNlc1t3cml0ZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXSwgX3RpY2tldEFtb3VudCk7CiAgICBnbG9iYWxCYWxhbmNlW3dyaXRlclRpY2tldEFkZHJlc3NdID0KICAgICAgc2FmZVN1YihnbG9iYWxCYWxhbmNlW3dyaXRlclRpY2tldEFkZHJlc3NdLCBfdGlja2V0QW1vdW50KTsKCiAgICAvL3ZvaWQgaG9sZCBvcHRpb24KICAgIGJhbGFuY2VzW2hvbGRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdID0KICAgICAgc2FmZVN1YihiYWxhbmNlc1tob2xkZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXSwgX3RpY2tldEFtb3VudCk7CiAgICBnbG9iYWxCYWxhbmNlW2hvbGRlclRpY2tldEFkZHJlc3NdID0KICAgICAgc2FmZVN1YihnbG9iYWxCYWxhbmNlW2hvbGRlclRpY2tldEFkZHJlc3NdLCBfdGlja2V0QW1vdW50KTsKIAogICAgLy91bmxvY2sgYXNzZXQKICAgIGJhbGFuY2VzW19hc3NldFRva2VuQWRkcmVzc11bMHgwXSA9IHNhZmVTdWIoCiAgICAgIGJhbGFuY2VzW19hc3NldFRva2VuQWRkcmVzc11bMHgwXSwKICAgICAgc2FmZURpdihzYWZlTXVsKF9hc3NldFRva2VuQW1vdW50LCBfdGlja2V0QW1vdW50KSwgMSBldGhlcikKICAgICk7CgogICAgYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVttc2cuc2VuZGVyXSA9IHNhZmVBZGQoCiAgICAgIGJhbGFuY2VzW19hc3NldFRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0sCiAgICAgIHNhZmVEaXYoc2FmZU11bChfYXNzZXRUb2tlbkFtb3VudCwgX3RpY2tldEFtb3VudCksIDEgZXRoZXIpCiAgICApOwogICAgCiAgICAvL2VtaXQgZXZlbnQKICAgIENvbGxhcHNlT3B0aW9uKAogICAgICBtc2cuc2VuZGVyLAogICAgICBob2xkZXJUaWNrZXRBZGRyZXNzLAogICAgICB3cml0ZXJUaWNrZXRBZGRyZXNzLAogICAgICBfdGlja2V0QW1vdW50LAogICAgICAoYnl0ZXMzMihfYXNzZXRUb2tlbkFkZHJlc3MpIF4gYnl0ZXMzMihfc3RyaWtlVG9rZW5BZGRyZXNzKSkKICAgICk7CiAgICAKICAgIHJldHVybiBfdGlja2V0QW1vdW50OwogIH0KCiAgLyphYm91dCBpbnZpc2FibGVIYW5kT2ZBZGFtU21pdGgoKToKICAgIHE6IHdoeSB3b3VsZCBzb21lb25lIGV2ZXIgd2FudCB0byBidXkgYW4gb3V0LW9mLXRoZS1tb25leSwKICAgICAgIGNvbGxhdGVyaXplZCBjYWxsIG9wdGlvbiBhdCBzdHJpa2UgcHJpY2U/CgogICAgYTogaWYgYW4gYW1lcmljYW4gb3B0aW9uIGlzIGV4ZWN1dGVkLCBhbmQgdGhlIGNvbGxhdGVyYWwncyBtb3ZlbWVudAogICAgICAgbWFrZXMgaXQgbGF0ZXIgb3V0IG9mIHRoZSBtb25leSwgdGhlIHZhbHVlIG9mIHRoZSBvcHRpb24gd291bGQKICAgICAgIG5lZWQgdG8gYmUgY2FsY3VsYXRlZCBieSBpbmNsdWRpbmcgdGhlICJwcmUtZXhlY3V0ZWQiIGFtb3VudC4KICAgICAgICogCiAgICAgICBUaGlzIHdvdWxkIHByZXZlbnQgYW4gZXh0ZXJuYWwgYWN0b3IgcGVyZm9ybWluZyB3ZWlyZCBhcmIgdHJhZGVzCiAgICAgICAod3JpdGUgYSBiaWxsaW9uIHRpY2tldHMsIGNvbGxhcHNlIGEgYmlsbGlvbiB0aWNrZXRzLCBwcm9maXQhKS4KICAgICAgIFNraXAgdGhlIG1pZGRsZSBtYW4hIFdyaXRlcnMgYXJlIG1vcmUgbGlrZWx5IHRvIGdldCAxMDAlIHRva2VuIG9yCiAgICAgICBzdHJpa2UgYXQgZXhwaXJ5LCBiYXNlZCBvbiBtYXJrZXQgdmFsdWUsIGFuZCBob2xkZXJzIHN0aWxsIGhhdmUKICAgICAgIHRoZWlyIG9wdGlvbiBpbnRhY3QuCiAgICAgICAqIAogICAgICAgQXJiZXJzIGdvbm5hIGFyYi4gTGV0IHRoZW0gZG8gdGhlaXIgdGhpbmcuCiovCgogIC8vaWYgdGhlcmUgaGF2ZSBiZWVuIGV4ZWN1dGlvbnMsIEFkYW0gU21pdGggY2FuIGRlcG9zaXQgYXNzZXQsIGdldCBzdHJpa2UsIHVwIHRvIGV4ZWN1dGlvbiBhbW91bnQuCi8vICBmdW5jdGlvbiBpbnZpc2libGVIYW5kT2ZBZGFtU21pdGgoIC8vIzY3CgogIGZ1bmN0aW9uIG9wdGlvbkV4Y2VyY2lzZVVud2luZCgKICAgIGFkZHJlc3MgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfYXNzZXRUb2tlbkFtb3VudCwKICAgIGFkZHJlc3MgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX3N0cmlrZVRva2VuQW1vdW50LAogICAgdWludDI1NiBfb3B0aW9uRXhwaXJlcywKICAgIHVpbnQyNTYgX3RpY2tldEFtb3VudCwKICAgIGJvb2wgX2ZpbGxPcktpbGwgLy9kbyB3ZSB3YW50PyBwcm9iYWJseS4uLgogICkKICAgIGV4dGVybmFsCiAgICBub3RMb2NrZWQKICAgIHJldHVybnMgKHVpbnQyNTYgdGlja2V0c1Vud291bmQpIC8vKGFtb3VudFRyYWRlZCkKICB7CiAgICAvL29ubHkgYmVmb3JlLCBlcXVhbCB0byBleHBpcnkKICAgIHJlcXVpcmUoYmxvY2subnVtYmVyIDw9IF9vcHRpb25FeHBpcmVzKTsKICAgIAogICAgYWRkcmVzcyBob2xkZXJUaWNrZXRBZGRyZXNzID0gZ2V0T3B0aW9uQWRkcmVzcygKICAgICAgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgX3N0cmlrZVRva2VuQW1vdW50LAogICAgICBfb3B0aW9uRXhwaXJlcywKICAgICAgZmFsc2UKICAgICk7CiAgICAKICAgIC8vaWYgc3RyaWtlLXBvb2xbaGFzaF0gIT0gMCB7CiAgICB0aWNrZXRzVW53b3VuZCA9IGV4ZXJjaXNlZE9wdGlvbnNbaG9sZGVyVGlja2V0QWRkcmVzc107CgogICAgLy9maWxsIG9yIGtpbGwuCiAgICByZXF1aXJlKChfZmlsbE9yS2lsbCA9PSBmYWxzZSkgfHwgKHRpY2tldHNVbndvdW5kID49IF90aWNrZXRBbW91bnQpKTsKCiAgICAvL2dldCBhbW91bnQgdG8gdHJhZGUuCiAgICBpZiAodGlja2V0c1Vud291bmQgPiBfdGlja2V0QW1vdW50KSB0aWNrZXRzVW53b3VuZCA9IF90aWNrZXRBbW91bnQ7CiAgICAKICAgIHJlcXVpcmUodGlja2V0c1Vud291bmQgPiAwKTsKICAgIC8vY2FudCBidXkgemVybywgZWl0aGVyIGJlY2F1c2Ugbm90IGF2YWlsLCBvciB5b3UgYXNrZWQgZm9yIHplcm8uCiAKICAgIC8vY2hlY2sgY29tcGxpYW5jZSwgbGlrZSBhIHRyYWRlIQogICAgcmVxdWlyZSgKICAgICAgKCEgcmVzdHJpY3RlZFRva2Vuc1tob2xkZXJUaWNrZXRBZGRyZXNzXSkgLy9pZiBpdCBpcyBub3QgcmVzdHJpY3RlZAogICAgfHwgQ29tcGxpYW5jZShjb21wbGlhbmNlQWRkcmVzcykuY2FuVHJhZGUoaG9sZGVyVGlja2V0QWRkcmVzcywgbXNnLnNlbmRlcikgLy8gb3IgY29tcGxpYW5jZSBzYXlzIHllcy4KICAgICk7CgogICAgLy9kZWJpdCBiYWxhbmNlIG9mIGNhbGxlciBvZiBhc3NldCB0b2tlbnMsIGNyZWRpdCAweDAKICAgIGJhbGFuY2VzW19hc3NldFRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0gPSBzYWZlU3ViKAogICAgICBiYWxhbmNlc1tfYXNzZXRUb2tlbkFkZHJlc3NdW21zZy5zZW5kZXJdLAogICAgICBzYWZlRGl2KHNhZmVNdWwoX2Fzc2V0VG9rZW5BbW91bnQsIHRpY2tldHNVbndvdW5kKSwgMSBldGhlcikKICAgICk7CgogICAgYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVsweDBdID0gc2FmZUFkZCgKICAgICAgYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVsweDBdLAogICAgICBzYWZlRGl2KHNhZmVNdWwoX2Fzc2V0VG9rZW5BbW91bnQsIHRpY2tldHNVbndvdW5kKSwgMSBldGhlcikKICAgICk7CiAgICAKICAgIC8vZGViaXQgYmFsYW5jZSBvZiBleGVyY2lzZWRPcHRpb25zIG9mIGhvbGRPcHRpb24sIGNyZWRpdCBjYWxsZXIuCiAgICAvL25vIGNoYW5nZSBpbiBnbG9iYWwgYmFsYW5jZXMuCiAgICBleGVyY2lzZWRPcHRpb25zW2hvbGRlclRpY2tldEFkZHJlc3NdID0KICAgICAgc2FmZVN1YihleGVyY2lzZWRPcHRpb25zW2hvbGRlclRpY2tldEFkZHJlc3NdLCB0aWNrZXRzVW53b3VuZCk7CiAgICBiYWxhbmNlc1tob2xkZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXSA9CiAgICAgIHNhZmVBZGQoYmFsYW5jZXNbaG9sZGVyVGlja2V0QWRkcmVzc11bbXNnLnNlbmRlcl0sIHRpY2tldHNVbndvdW5kKTsKCiAgICAvL2RlYml0IGJhbGFuY2Ugb2YgMHgwIG9mIHN0cmlrZSwgY3JlZGl0IGNhbGxlci4KICAgIGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdWzB4MF0gPSBzYWZlU3ViKAogICAgICBiYWxhbmNlc1tfc3RyaWtlVG9rZW5BZGRyZXNzXVsweDBdLAogICAgICBzYWZlRGl2KHNhZmVNdWwoX3N0cmlrZVRva2VuQW1vdW50LCB0aWNrZXRzVW53b3VuZCksIDEgZXRoZXIpCiAgICApOwoKICAgIGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdW21zZy5zZW5kZXJdID0gc2FmZUFkZCgKICAgICAgYmFsYW5jZXNbX3N0cmlrZVRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0sCiAgICAgIHNhZmVEaXYoc2FmZU11bChfc3RyaWtlVG9rZW5BbW91bnQsIHRpY2tldHNVbndvdW5kKSwgMSBldGhlcikKICAgICk7CiAgICAKICAgIC8vZW1pdCBldmVudC4KICAgIEV4Y2VyY2lzZVVud2luZCgKICAgICAgbXNnLnNlbmRlciwKICAgICAgaG9sZGVyVGlja2V0QWRkcmVzcywKICAgICAgdGlja2V0c1Vud291bmQsCiAgICAgIChieXRlczMyKF9hc3NldFRva2VuQWRkcmVzcykgXiBieXRlczMyKF9zdHJpa2VUb2tlbkFkZHJlc3MpKSwKICAgICAgX2ZpbGxPcktpbGwKICAgICk7CiAgICAKICAgIHJldHVybiB0aWNrZXRzVW53b3VuZDsKICB9CiAgCiAgLy9pZiBiZWZvcmUgZXhwaXJ5LCBhbmQgb3duIGhvbGQgdGlja2V0LCB0aGVuIHBheSBzdHJpa2UsIGdldCBhc3NldCwgdm9pZCBob2xkIHRpY2tldAogIGZ1bmN0aW9uIGV4Y2VyY2lzZU9wdGlvbiggLy8jNjgKICAgIGFkZHJlc3MgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfYXNzZXRUb2tlbkFtb3VudCwKICAgIGFkZHJlc3MgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX3N0cmlrZVRva2VuQW1vdW50LAogICAgdWludDI1NiBfb3B0aW9uRXhwaXJlcywKICAgIHVpbnQyNTYgX3RpY2tldEFtb3VudAogICkKICBleHRlcm5hbCAKICByZXR1cm5zICh1aW50MjU2IHRpY2tldHNFeGNlcmNpc2VkKQogIHsgIAogICAgLy9vbmx5IGhvbGRlciBiZWZvcmUsIGVxdWFsIHRvIGV4cGlyeQogICAgcmVxdWlyZShibG9jay5udW1iZXIgPD0gX29wdGlvbkV4cGlyZXMpOwogICAgCiAgICBhZGRyZXNzIGhvbGRlclRpY2tldEFkZHJlc3MgPSBnZXRPcHRpb25BZGRyZXNzKAogICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgIF9hc3NldFRva2VuQW1vdW50LAogICAgICBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgIF9vcHRpb25FeHBpcmVzLAogICAgICBmYWxzZQogICAgKTsKICAgIAogICAgLy9nZXQgYmFsYW5jZSBvZiB0aWNrZXRzCiAgICB0aWNrZXRzRXhjZXJjaXNlZCA9IGJhbGFuY2VzW2hvbGRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdOwogICAgcmVxdWlyZSh0aWNrZXRzRXhjZXJjaXNlZCA+PSBfdGlja2V0QW1vdW50KTsgLy9pdHMganVzdCBhIGJhbGFuY2UgaGVyZS4KICAgIAogICAgLy9nZXQgYW1vdW50IHRvIHRyYWRlLgogICAgaWYgKHRpY2tldHNFeGNlcmNpc2VkID4gX3RpY2tldEFtb3VudCkgdGlja2V0c0V4Y2VyY2lzZWQgPSBfdGlja2V0QW1vdW50OwogICAgCiAgICAvL2NhbnQgZXhlY3V0ZSB6ZXJvLCBlaXRoZXIgeW91IGhhdmUgemVybywgb3IgeW91IGFza2VkIGZvciB6ZXJvLgogICAgcmVxdWlyZSh0aWNrZXRzRXhjZXJjaXNlZCA+IDApOwogICAgCiAgICAvL2RlYml0IGJhbGFuY2Ugb2YgY2FsbGVyIGZvciBob2xkT3B0aW9uLCBjcmVkaXQgZXhlcmNpc2VkT3B0aW9ucyAgICAKICAgIGJhbGFuY2VzW2hvbGRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdID0KICAgICAgc2FmZVN1YihiYWxhbmNlc1tob2xkZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXSwgdGlja2V0c0V4Y2VyY2lzZWQpOwogICAgZXhlcmNpc2VkT3B0aW9uc1tob2xkZXJUaWNrZXRBZGRyZXNzXSA9CiAgICAgIHNhZmVBZGQoZXhlcmNpc2VkT3B0aW9uc1tob2xkZXJUaWNrZXRBZGRyZXNzXSwgdGlja2V0c0V4Y2VyY2lzZWQpOwogICAgICAgIAogICAgLy9kZWJpdCBiYWxhbmNlIG9mIGNhbGxlciBmb3Igc3RyaWtlVG9rZW4sIGNyZWRpdCAweDAKICAgIGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdW21zZy5zZW5kZXJdID0gc2FmZVN1YigKICAgICAgYmFsYW5jZXNbX3N0cmlrZVRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0sCiAgICAgIHNhZmVEaXYoc2FmZU11bChfc3RyaWtlVG9rZW5BbW91bnQsIHRpY2tldHNFeGNlcmNpc2VkKSwgMSBldGhlcikKICAgICk7CgogICAgYmFsYW5jZXNbX3N0cmlrZVRva2VuQWRkcmVzc11bMHgwXSA9IHNhZmVBZGQoCiAgICAgIGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdWzB4MF0sCiAgICAgIHNhZmVEaXYoc2FmZU11bChfc3RyaWtlVG9rZW5BbW91bnQsIHRpY2tldHNFeGNlcmNpc2VkKSwgMSBldGhlcikKICAgICk7CiAgICAKICAgIC8vZGViaXQgYmFsYW5jZSBvZiAweDAgb2YgYXNzZXQsIGNyZWRpdCBjYWxsZXIuICAgCiAgICBiYWxhbmNlc1tfYXNzZXRUb2tlbkFkZHJlc3NdWzB4MF0gPSBzYWZlU3ViKAogICAgICBiYWxhbmNlc1tfYXNzZXRUb2tlbkFkZHJlc3NdWzB4MF0sCiAgICAgIHNhZmVEaXYoc2FmZU11bChfYXNzZXRUb2tlbkFtb3VudCwgdGlja2V0c0V4Y2VyY2lzZWQpLCAxIGV0aGVyKQogICAgKTsKICAgIAogICAgYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVttc2cuc2VuZGVyXSA9IHNhZmVBZGQoCiAgICAgIGJhbGFuY2VzW19hc3NldFRva2VuQWRkcmVzc11bbXNnLnNlbmRlcl0sCiAgICAgIHNhZmVEaXYoc2FmZU11bChfYXNzZXRUb2tlbkFtb3VudCwgdGlja2V0c0V4Y2VyY2lzZWQpLCAxIGV0aGVyKQogICAgKTsKCiAgICAKICAgIC8vbm8gY2hhbmdlIGluIGdsb2JhbCBiYWxhbmNlcy4KICAgIC8vZW1pdCBldmVudC4KICAgIEV4Y2VyY2lzZU9wdGlvbigKICAgICAgbXNnLnNlbmRlciwKICAgICAgaG9sZGVyVGlja2V0QWRkcmVzcywKICAgICAgdGlja2V0c0V4Y2VyY2lzZWQsCiAgICAgIChieXRlczMyKF9hc3NldFRva2VuQWRkcmVzcykgXiBieXRlczMyKF9zdHJpa2VUb2tlbkFkZHJlc3MpKQogICAgKTsKICAgIAogICAgcmV0dXJuIHRpY2tldHNFeGNlcmNpc2VkOwogIH0KCiAgCiAgLy9pZiBhZnRlciBleHBpcnksIGdldCBjb2xsYXRlcmFsLCB2b2lkIG9wdGlvbi4KICBmdW5jdGlvbiBleHBpcmVPcHRpb24oIC8vIzY5CiAgICBhZGRyZXNzIF9hc3NldFRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICBhZGRyZXNzIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9zdHJpa2VUb2tlbkFtb3VudCwKICAgIHVpbnQyNTYgX29wdGlvbkV4cGlyZXMsCiAgICB1aW50MjU2IF90aWNrZXRBbW91bnQKICApCiAgZXh0ZXJuYWwgCiAgcmV0dXJucyAodWludDI1NiB0aWNrZXRzRXhwaXJlZCkKICB7CiAgLy9vbmx5IHdyaXRlciwgb25seSBhZnRlciBleHBpcnkKICAgIHJlcXVpcmUoYmxvY2subnVtYmVyID4gX29wdGlvbkV4cGlyZXMpOwogICAgICAgIAogICAgYWRkcmVzcyBob2xkZXJUaWNrZXRBZGRyZXNzID0gZ2V0T3B0aW9uQWRkcmVzcygKICAgICAgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgX3N0cmlrZVRva2VuQW1vdW50LAogICAgICBfb3B0aW9uRXhwaXJlcywKICAgICAgZmFsc2UKICAgICk7CiAgICAKICAgIGFkZHJlc3Mgd3JpdGVyVGlja2V0QWRkcmVzcyA9IGdldE9wdGlvbkFkZHJlc3MoCiAgICAgIF9hc3NldFRva2VuQWRkcmVzcywKICAgICAgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICAgIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICAgIF9zdHJpa2VUb2tlbkFtb3VudCwKICAgICAgX29wdGlvbkV4cGlyZXMsCiAgICAgIHRydWUKICAgICk7CiAgICAKICAgIC8vZ2V0IGJhbGFuY2Ugb2YgdGlja2V0cwogICAgdGlja2V0c0V4cGlyZWQgPSBiYWxhbmNlc1t3cml0ZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXTsKICAgIHJlcXVpcmUodGlja2V0c0V4cGlyZWQgPj0gX3RpY2tldEFtb3VudCk7IC8vaXRzIGp1c3QgYSBiYWxhbmNlIGhlcmUuCiAgICAKICAgIC8vZ2V0IGFtb3VudCB0byB0cmFkZS4KICAgIGlmICh0aWNrZXRzRXhwaXJlZCA+IF90aWNrZXRBbW91bnQpIHRpY2tldHNFeHBpcmVkID0gX3RpY2tldEFtb3VudDsKICAgIAogICAgLy9jYW50IGV4ZWN1dGUgemVybywgZWl0aGVyIHlvdSBoYXZlIHplcm8sIG9yIHlvdSBhc2tlZCBmb3IgemVyby4KICAgIHJlcXVpcmUodGlja2V0c0V4cGlyZWQgPiAwKTsKICAgIAogICAgLy8gZGViaXQgaG9sZGVyIHRpY2tldHMgZnJvbSB1c2VyLCBhZGQgdG8gZXhlcmNpc2VkT3B0aW9ucy4KICAgIGJhbGFuY2VzW3dyaXRlclRpY2tldEFkZHJlc3NdW21zZy5zZW5kZXJdID0KICAgICAgc2FmZVN1YihiYWxhbmNlc1t3cml0ZXJUaWNrZXRBZGRyZXNzXVttc2cuc2VuZGVyXSwgdGlja2V0c0V4cGlyZWQpOwogICAgZXhlcmNpc2VkT3B0aW9uc1t3cml0ZXJUaWNrZXRBZGRyZXNzXSA9CiAgICAgIHNhZmVBZGQoZXhlcmNpc2VkT3B0aW9uc1t3cml0ZXJUaWNrZXRBZGRyZXNzXSwgdGlja2V0c0V4cGlyZWQpOwogICAgCiAgICAvL2NhbGN1bGF0ZSBhbW91bnRzCiAgICB1aW50MjU2IHN0cmlrZVRva2VuQW1vdW50ID0KICAgICAgc2FmZURpdigKICAgICAgICBzYWZlTXVsKAogICAgICAgICAgc2FmZURpdihzYWZlTXVsKHRpY2tldHNFeHBpcmVkLCBfc3RyaWtlVG9rZW5BbW91bnQpLCAxIGV0aGVyKSwgLy90aWNrZXRzCiAgICAgICAgICBleGVyY2lzZWRPcHRpb25zW2hvbGRlclRpY2tldEFkZHJlc3NdCiAgICAgICAgKSwKICAgICAgICBnbG9iYWxCYWxhbmNlW2hvbGRlclRpY2tldEFkZHJlc3NdCiAgICAgICk7CgogICAgdWludDI1NiBhc3NldFRva2VuQW1vdW50ID0KICAgICAgc2FmZURpdigKICAgICAgICBzYWZlTXVsKAogICAgICAgICAgc2FmZURpdihzYWZlTXVsKHRpY2tldHNFeHBpcmVkLCBfYXNzZXRUb2tlbkFtb3VudCksIDEgZXRoZXIpLCAvL3RpY2tldHMKICAgICAgICAgIHNhZmVTdWIoZ2xvYmFsQmFsYW5jZVtob2xkZXJUaWNrZXRBZGRyZXNzXSwgZXhlcmNpc2VkT3B0aW9uc1tob2xkZXJUaWNrZXRBZGRyZXNzXSkKICAgICAgICApLAogICAgICAgIGdsb2JhbEJhbGFuY2VbaG9sZGVyVGlja2V0QWRkcmVzc10KICAgICAgKTsKICAgIAoKICAgIC8vZGViaXQgemVybywgYWRkIHRvIG1zZy5zZW5kZXIKICAgIGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdWzB4MF0gPQogICAgICBzYWZlU3ViKGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdWzB4MF0sIHN0cmlrZVRva2VuQW1vdW50KTsKICAgIGJhbGFuY2VzW19hc3NldFRva2VuQWRkcmVzc11bMHgwXSA9CiAgICAgIHNhZmVTdWIoYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVsweDBdLCBhc3NldFRva2VuQW1vdW50KTsKICAgIGJhbGFuY2VzW19zdHJpa2VUb2tlbkFkZHJlc3NdW21zZy5zZW5kZXJdID0KICAgICAgc2FmZUFkZChiYWxhbmNlc1tfc3RyaWtlVG9rZW5BZGRyZXNzXVttc2cuc2VuZGVyXSwgc3RyaWtlVG9rZW5BbW91bnQpOwogICAgYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVttc2cuc2VuZGVyXSA9CiAgICAgIHNhZmVBZGQoYmFsYW5jZXNbX2Fzc2V0VG9rZW5BZGRyZXNzXVttc2cuc2VuZGVyXSwgYXNzZXRUb2tlbkFtb3VudCk7CiAgCiAgLy9zZXQgaW5hY3RpdmUKCiAgICBFeHBpcmVPcHRpb24oIC8vIzY5XQogICAgICBtc2cuc2VuZGVyLAogICAgICB3cml0ZXJUaWNrZXRBZGRyZXNzLAogICAgICB0aWNrZXRzRXhwaXJlZCwKICAgICAgKGJ5dGVzMzIoX2Fzc2V0VG9rZW5BZGRyZXNzKSBeIGJ5dGVzMzIoX3N0cmlrZVRva2VuQWRkcmVzcykpCiAgICApOwogICAgcmV0dXJuIHRpY2tldHNFeHBpcmVkOwogIH0KCgogIC8vZ2V0IGFuIG9wdGlvbidzIEhhc2gncyBhZGRyZXNzCiAgLy8gICjigKJf4oCiKSAgKCDigKJf4oCiKT7ijJDilqAt4pagICAo4oyQ4pagX+KWoCkKICAvLwogIC8vZ29pbmcgZnJvbSAzMiBieXRlcyB0byAyMCBieXRlcyBzdGlsbCBnaXZlcyB1cyAxNjAgYml0cyBvZiBoYXNoIGdvb2RuZXNzLgogIC8vdGhhdCdzIHN0aWxsIGEgY3JhenkgbGFyZ2UgbnVtYmVyLCBhbmQgdXNlZCBieSBldGhlcmV1bSBmb3IgYWRkcmVzc2VzLgogIGZ1bmN0aW9uIGdldE9wdGlvbkFkZHJlc3MoCiAgICBhZGRyZXNzIF9hc3NldFRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICBhZGRyZXNzIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9zdHJpa2VUb2tlbkFtb3VudCwKICAgIHVpbnQyNTYgX29wdGlvbkV4cGlyZXMsCiAgICBib29sIF9pc1dyaXRlcgogICkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyhhZGRyZXNzKQogIHsKICAgIHJldHVybigKICAgICAgYWRkcmVzcygKICAgICAgICBrZWNjYWsyNTYoCiAgICAgICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgICAgIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICAgICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgICAgICBfb3B0aW9uRXhwaXJlcywKICAgICAgICAgIF9pc1dyaXRlcgogICAgICAgICkKICAgICAgKQogICAgKTsKICB9CgogIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIC8gT3B0aW9ucyBWaWV3IENvZGUKICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgLy9zaW5jZSB0aGUgb3B0aW9ucyBjb2RlIG1pZ2h0IG1vdmUsIHdlIHNob3VsZCBoYXZlIGEgd2F5IHRvIGFsd2F5cwogIC8vY2FsbCBhIGZ1bmN0aW9uIHRvIHRoaXMgY29udHJhY3QgdG8gZ2V0IHRoZSBjdXJyZW50IHZhbHVlcwogIAogIGZ1bmN0aW9uIHRlc3RJc09wdGlvblBhaXJSZWdpc3RlcmVkKAogICAgYWRkcmVzcyBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9hc3NldFRva2VuQW1vdW50LAogICAgYWRkcmVzcyBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICB1aW50MjU2IF9vcHRpb25FeHBpcmVzCiAgKQogIGV4dGVybmFsCiAgdmlldwogIHJldHVybnMoYm9vbCkKICB7CiAgICByZXR1cm4oCiAgICAgIE9wdGlvblJlZ2lzdHJ5KG9wdGlvbnNSZWdpc3RyeUFkZHJlc3MpLmlzT3B0aW9uUGFpclJlZ2lzdGVyZWQoCiAgICAgICAgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgICAgIF9hc3NldFRva2VuQW1vdW50LAogICAgICAgIF9zdHJpa2VUb2tlbkFkZHJlc3MsCiAgICAgICAgX3N0cmlrZVRva2VuQW1vdW50LAogICAgICAgIF9vcHRpb25FeHBpcmVzCiAgICAgICkKICAgICk7CiAgfQogIAoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAvIERlZmF1bHQgT3B0aW9ucyBSZWdpc3RyYXRpb24gQ29kZQogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAvLyBSZWdpc3RlciBlbWl0cyBhbiBldmVudCBhbmQgYWRkcyBpdCB0byByZXN0cmljdGVkVG9rZW4uCiAgLy8gV2UnbGwgZGVhbCB3aXRoIGFueSBvdGhlciBuZWVkZWQgcmVnaXN0cmF0aW9uIGxhdGVyLgogIC8vIFNldCB1cCBmb3IgdXBncmFkZWFibGUgZXh0ZXJuYWwgY29udHJhY3QuCiAgLy8gcmV0dXJuIGJvb2xzLgogIAogIGV2ZW50IFJlZ2lzdGVyT3B0aW9uc1BhaXIoCiAgICBieXRlczMyIGluZGV4ZWQgb3B0aW9uUGFpciwgLy9hc3NldFRva2VuQWRkcmVzcyB4b3Igc3RyaWtlVG9rZW5BZGRyZXNzCiAgICBhZGRyZXNzIGluZGV4ZWQgd3JpdGVyVGlja2V0QWRkcmVzcywKICAgIGFkZHJlc3MgaW5kZXhlZCBob2xkZXJUaWNrZXRBZGRyZXNzLAogICAgYWRkcmVzcyBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9hc3NldFRva2VuQW1vdW50LAogICAgYWRkcmVzcyBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICB1aW50MjU2IF9vcHRpb25FeHBpcmVzCiAgKTsgIAogIAogICAgCiAgZnVuY3Rpb24gcmVnaXN0ZXJPcHRpb25QYWlyKAogICAgYWRkcmVzcyBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9hc3NldFRva2VuQW1vdW50LAogICAgYWRkcmVzcyBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICB1aW50MjU2IF9vcHRpb25FeHBpcmVzCiAgKQogIHB1YmxpYwogIHJldHVybnMoYm9vbCkKICB7CiAgICBhZGRyZXNzIGhvbGRlclRpY2tldEFkZHJlc3MgPSBnZXRPcHRpb25BZGRyZXNzKAogICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgIF9hc3NldFRva2VuQW1vdW50LAogICAgICBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgIF9vcHRpb25FeHBpcmVzLAogICAgICBmYWxzZQogICAgKTsKICAgIAovLyAgICBpZiAoCi8vICAgICAgaXNPcHRpb25QYWlyUmVnaXN0ZXJlZCgKLy8gICAgICAgIF9hc3NldFRva2VuQWRkcmVzcywKLy8gICAgICAgIF9hc3NldFRva2VuQW1vdW50LAovLyAgICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKLy8gICAgICAgIF9zdHJpa2VUb2tlbkFtb3VudCwKLy8gICAgICAgIF9vcHRpb25FeHBpcmVzCi8vICAgICAgKQovLyAgICApCiAgICAvL2NoZWFwZXIgbm90IHRvIG1ha2UgY2FsbCBnYXN3aXNlLCBzYW1lIHJlc3VsdC4KICAgIAogICAgaWYgKHJlc3RyaWN0ZWRUb2tlbnNbaG9sZGVyVGlja2V0QWRkcmVzc10pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgLy9yZXR1cm4gaGFsdHMgZXhlY3V0aW9uLCBidXQgZWxzZSBpcyBiZXR0ZXIgZm9yIHJlYWRpYmlsaXR5CiAgICB9IGVsc2UgewoKICAgICAgYWRkcmVzcyB3cml0ZXJUaWNrZXRBZGRyZXNzID0gZ2V0T3B0aW9uQWRkcmVzcygKICAgICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgICAgX2Fzc2V0VG9rZW5BbW91bnQsCiAgICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgICAgX29wdGlvbkV4cGlyZXMsCiAgICAgICAgdHJ1ZQogICAgICApOwogICAgCiAgICAgIHJlc3RyaWN0ZWRUb2tlbnNbaG9sZGVyVGlja2V0QWRkcmVzc10gPSB0cnVlOwogICAgICByZXN0cmljdGVkVG9rZW5zW3dyaXRlclRpY2tldEFkZHJlc3NdID0gdHJ1ZTsKICAgIAogICAgICAvL2FuIGV4dGVybmFsIGNvbnRyYWN0IHdvdWxkIG5lZWQgdG8gY2FsbCBzb21ldGhpbmcgbGlrZSB0aGlzOgogICAgICAvLyBhZnRlciBiZWluZyByZWdpc3RlcmVkIGFzIGEgaGVscGVyIGNvbnRyYWN0IG9uIHRoZSBtYWluIHNpdGUuCiAgICAgIC8vVWJlckRlbHRhKHViZXJkZWx0YUFkZHJlc3MpLnRva2VuUmVzdHJpY3Rpb24oaG9sZGVyVGlja2V0QWRkcmVzcywgdHJ1ZSk7CiAgICAgIC8vVWJlckRlbHRhKHViZXJkZWx0YUFkZHJlc3MpLnRva2VuUmVzdHJpY3Rpb24od3JpdGVyVGlja2V0QWRkcmVzcywgdHJ1ZSk7CiAgICAKICAgICAgUmVnaXN0ZXJPcHRpb25zUGFpcigKICAgICAgICAoYnl0ZXMzMihfYXNzZXRUb2tlbkFkZHJlc3MpIF4gYnl0ZXMzMihfc3RyaWtlVG9rZW5BZGRyZXNzKSksCiAgICAgICAgaG9sZGVyVGlja2V0QWRkcmVzcywKICAgICAgICB3cml0ZXJUaWNrZXRBZGRyZXNzLAogICAgICAgIF9hc3NldFRva2VuQWRkcmVzcywKICAgICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgICBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgICAgIF9zdHJpa2VUb2tlbkFtb3VudCwKICAgICAgICBfb3B0aW9uRXhwaXJlcwogICAgICApOwogICAgCiAgICAgIHJldHVybih0cnVlKTsKICAgIH0KICB9CiAgCiAgCiAgLy8gZm9yIHYxLCB3ZSdsbCBzaW1wbHkgcmV0dXJuIGlmIHRoZXJlJ3MgYSByZXN0cmljdGlvbi4KICBmdW5jdGlvbiBpc09wdGlvblBhaXJSZWdpc3RlcmVkKAogICAgYWRkcmVzcyBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICB1aW50MjU2IF9hc3NldFRva2VuQW1vdW50LAogICAgYWRkcmVzcyBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICB1aW50MjU2IF9vcHRpb25FeHBpcmVzCiAgKQogIHB1YmxpYwogIHZpZXcKICByZXR1cm5zKGJvb2wpCiAgewogICAgYWRkcmVzcyBob2xkZXJUaWNrZXRBZGRyZXNzID0gZ2V0T3B0aW9uQWRkcmVzcygKICAgICAgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgX3N0cmlrZVRva2VuQW1vdW50LAogICAgICBfb3B0aW9uRXhwaXJlcywKICAgICAgZmFsc2UKICAgICk7CiAgICAKICAgIHJldHVybihyZXN0cmljdGVkVG9rZW5zW2hvbGRlclRpY2tldEFkZHJlc3NdKTsKICB9CiAgCiAgCiAgZnVuY3Rpb24gZ2V0T3B0aW9uUGFpcigKICAgIGFkZHJlc3MgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgdWludDI1NiBfYXNzZXRUb2tlbkFtb3VudCwKICAgIGFkZHJlc3MgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgIHVpbnQyNTYgX3N0cmlrZVRva2VuQW1vdW50LAogICAgdWludDI1NiBfb3B0aW9uRXhwaXJlcwogICkKICBwdWJsaWMKICB2aWV3CiAgcmV0dXJucyhhZGRyZXNzIGhvbGRlclRpY2tldEFkZHJlc3MsIGFkZHJlc3Mgd3JpdGVyVGlja2V0QWRkcmVzcykKICB7CiAgICBob2xkZXJUaWNrZXRBZGRyZXNzID0gZ2V0T3B0aW9uQWRkcmVzcygKICAgICAgX2Fzc2V0VG9rZW5BZGRyZXNzLAogICAgICBfYXNzZXRUb2tlbkFtb3VudCwKICAgICAgX3N0cmlrZVRva2VuQWRkcmVzcywKICAgICAgX3N0cmlrZVRva2VuQW1vdW50LAogICAgICBfb3B0aW9uRXhwaXJlcywKICAgICAgZmFsc2UKICAgICk7CiAgICAKICAgIHdyaXRlclRpY2tldEFkZHJlc3MgPSBnZXRPcHRpb25BZGRyZXNzKAogICAgICBfYXNzZXRUb2tlbkFkZHJlc3MsCiAgICAgIF9hc3NldFRva2VuQW1vdW50LAogICAgICBfc3RyaWtlVG9rZW5BZGRyZXNzLAogICAgICBfc3RyaWtlVG9rZW5BbW91bnQsCiAgICAgIF9vcHRpb25FeHBpcmVzLAogICAgICB0cnVlCiAgICApOwogICAgCiAgICByZXR1cm4oaG9sZGVyVGlja2V0QWRkcmVzcywgd3JpdGVyVGlja2V0QWRkcmVzcyk7CiAgfQogIAogIAogIC8qKioqKioqKioqKioqKioqKioKICAvIEVPUyBSZWdpc3RyYXRpb24KICAqKioqKioqKioqKioqKioqKiovCiAgLy8gc29tZSB1c2VycyB3aWxsIGFjY2lkZW50YWxseSBrZWVwIEVPUyBvbiB0aGUgZXhjaGFuZ2UgZHVyaW5nIHRoZSBzbmFwc2hvdC4KICBmdW5jdGlvbiBFT1NSZWdpc3RyYXRpb24gKHN0cmluZyBfa2V5KSBleHRlcm5hbCBvbmx5T3duZXJ7CiAgICBFT1MoMHhkMGE2RTZDNTREYkM2OERiNWRiM0EwOTFCMTcxQTc3NDA3RmY3Y2NmKS5yZWdpc3Rlcihfa2V5KTsKICB9CiAgCn0='.
	

]
