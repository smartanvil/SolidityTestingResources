Class {
	#name : #SRTbc05e610eaac542bfa64504025413291beb58d36,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbc05e610eaac542bfa64504025413291beb58d36 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIE93bmVkIC0gT3duZXJzaGlwIG1vZGVsIHdpdGggMiBwaGFzZSB0cmFuc2ZlcnMKLy8gRW51bWEgQmxvY2tjaGFpbiBQbGF0Zm9ybQovLwovLyBDb3B5cmlnaHQgKGMpIDIwMTcgRW51bWEgVGVjaG5vbG9naWVzLgovLyBodHRwczovL3d3dy5lbnVtYS5pby8KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCi8vIEltcGxlbWVudHMgYSBzaW1wbGUgb3duZXJzaGlwIG1vZGVsIHdpdGggMi1waGFzZSB0cmFuc2Zlci4KY29udHJhY3QgT3duZWQgewoKICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgIGFkZHJlc3MgcHVibGljIHByb3Bvc2VkT3duZXI7CgogICBldmVudCBPd25lcnNoaXBUcmFuc2ZlckluaXRpYXRlZChhZGRyZXNzIGluZGV4ZWQgX3Byb3Bvc2VkT3duZXIpOwogICBldmVudCBPd25lcnNoaXBUcmFuc2ZlckNvbXBsZXRlZChhZGRyZXNzIGluZGV4ZWQgX25ld093bmVyKTsKICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJDYW5jZWxlZCgpOwoKCiAgIGZ1bmN0aW9uIE93bmVkKCkgcHVibGljCiAgIHsKICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICB9CgoKICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikgPT0gdHJ1ZSk7CiAgICAgIF87CiAgIH0KCgogICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIChfYWRkcmVzcyA9PSBvd25lcik7CiAgIH0KCgogICBmdW5jdGlvbiBpbml0aWF0ZU93bmVyc2hpcFRyYW5zZmVyKGFkZHJlc3MgX3Byb3Bvc2VkT3duZXIpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICByZXF1aXJlKF9wcm9wb3NlZE93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF9wcm9wb3NlZE93bmVyICE9IGFkZHJlc3ModGhpcykpOwogICAgICByZXF1aXJlKF9wcm9wb3NlZE93bmVyICE9IG93bmVyKTsKCiAgICAgIHByb3Bvc2VkT3duZXIgPSBfcHJvcG9zZWRPd25lcjsKCiAgICAgIE93bmVyc2hpcFRyYW5zZmVySW5pdGlhdGVkKHByb3Bvc2VkT3duZXIpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgIH0KCgogICBmdW5jdGlvbiBjYW5jZWxPd25lcnNoaXBUcmFuc2ZlcigpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICBpZiAocHJvcG9zZWRPd25lciA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBwcm9wb3NlZE93bmVyID0gYWRkcmVzcygwKTsKCiAgICAgIE93bmVyc2hpcFRyYW5zZmVyQ2FuY2VsZWQoKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgZnVuY3Rpb24gY29tcGxldGVPd25lcnNoaXBUcmFuc2ZlcigpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwcm9wb3NlZE93bmVyKTsKCiAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgcHJvcG9zZWRPd25lciA9IGFkZHJlc3MoMCk7CgogICAgICBPd25lcnNoaXBUcmFuc2ZlckNvbXBsZXRlZChvd25lcik7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIE9wc01hbmFnZWQgLSBJbXBsZW1lbnRzIGFuIE93bmVyIGFuZCBPcHMgUGVybWlzc2lvbiBNb2RlbAovLyBFbnVtYSBCbG9ja2NoYWluIFBsYXRmb3JtCi8vCi8vIENvcHlyaWdodCAoYykgMjAxNyBFbnVtYSBUZWNobm9sb2dpZXMuCi8vIGh0dHBzOi8vd3d3LmVudW1hLmlvLwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCi8vCi8vIEltcGxlbWVudHMgYSBzZWN1cml0eSBtb2RlbCB3aXRoIG93bmVyIGFuZCBvcHMuCi8vCmNvbnRyYWN0IE9wc01hbmFnZWQgaXMgT3duZWQgewoKICAgYWRkcmVzcyBwdWJsaWMgb3BzQWRkcmVzczsKCiAgIGV2ZW50IE9wc0FkZHJlc3NVcGRhdGVkKGFkZHJlc3MgaW5kZXhlZCBfbmV3QWRkcmVzcyk7CgoKICAgZnVuY3Rpb24gT3BzTWFuYWdlZCgpIHB1YmxpYwogICAgICBPd25lZCgpCiAgIHsKICAgfQoKCiAgIG1vZGlmaWVyIG9ubHlPd25lck9yT3BzKCkgewogICAgICByZXF1aXJlKGlzT3duZXJPck9wcyhtc2cuc2VuZGVyKSk7CiAgICAgIF87CiAgIH0KCgogICBmdW5jdGlvbiBpc09wcyhhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiAob3BzQWRkcmVzcyAhPSBhZGRyZXNzKDApICYmIF9hZGRyZXNzID09IG9wc0FkZHJlc3MpOwogICB9CgoKICAgZnVuY3Rpb24gaXNPd25lck9yT3BzKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIChpc093bmVyKF9hZGRyZXNzKSB8fCBpc09wcyhfYWRkcmVzcykpOwogICB9CgoKICAgZnVuY3Rpb24gc2V0T3BzQWRkcmVzcyhhZGRyZXNzIF9uZXdPcHNBZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmVxdWlyZShfbmV3T3BzQWRkcmVzcyAhPSBvd25lcik7CiAgICAgIHJlcXVpcmUoX25ld09wc0FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CgogICAgICBvcHNBZGRyZXNzID0gX25ld09wc0FkZHJlc3M7CgogICAgICBPcHNBZGRyZXNzVXBkYXRlZChvcHNBZGRyZXNzKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gTWF0aCAtIEdlbmVyYWwgTWF0aCBVdGlsaXR5IExpYnJhcnkKLy8gRW51bWEgQmxvY2tjaGFpbiBQbGF0Zm9ybQovLwovLyBDb3B5cmlnaHQgKGMpIDIwMTcgRW51bWEgVGVjaG5vbG9naWVzLgovLyBodHRwczovL3d3dy5lbnVtYS5pby8KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCmxpYnJhcnkgTWF0aCB7CgogICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICB1aW50MjU2IHIgPSBhICsgYjsKCiAgICAgIHJlcXVpcmUociA+PSBhKTsKCiAgICAgIHJldHVybiByOwogICB9CgoKICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgcmVxdWlyZShhID49IGIpOwoKICAgICAgcmV0dXJuIGEgLSBiOwogICB9CgoKICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiByID0gYSAqIGI7CgogICAgICByZXF1aXJlKGEgPT0gMCB8fCByIC8gYSA9PSBiKTsKCiAgICAgIHJldHVybiByOwogICB9CgoKICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgcmV0dXJuIGEgLyBiOwogICB9Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRVJDMjBJbnRlcmZhY2UgLSBTdGFuZGFyZCBFUkMyMCBJbnRlcmZhY2UgRGVmaW5pdGlvbgovLyBFbnVtYSBCbG9ja2NoYWluIFBsYXRmb3JtCi8vCi8vIENvcHlyaWdodCAoYykgMjAxNyBFbnVtYSBUZWNobm9sb2dpZXMuCi8vIGh0dHBzOi8vd3d3LmVudW1hLmlvLwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEJhc2VkIG9uIHRoZSBmaW5hbCBFUkMyMCBzcGVjaWZpY2F0aW9uIGF0OgovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEVSQzIwSW50ZXJmYWNlIHsKCiAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKCiAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRVJDMjBUb2tlbiAtIFN0YW5kYXJkIEVSQzIwIEltcGxlbWVudGF0aW9uCi8vIEVudW1hIEJsb2NrY2hhaW4gUGxhdGZvcm0KLy8KLy8gQ29weXJpZ2h0IChjKSAyMDE3IEVudW1hIFRlY2hub2xvZ2llcy4KLy8gaHR0cHM6Ly93d3cuZW51bWEuaW8vCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgpjb250cmFjdCBFUkMyMFRva2VuIGlzIEVSQzIwSW50ZXJmYWNlIHsKCiAgIHVzaW5nIE1hdGggZm9yIHVpbnQyNTY7CgogICBzdHJpbmcgIHByaXZhdGUgdG9rZW5OYW1lOwogICBzdHJpbmcgIHByaXZhdGUgdG9rZW5TeW1ib2w7CiAgIHVpbnQ4ICAgcHJpdmF0ZSB0b2tlbkRlY2ltYWxzOwogICB1aW50MjU2IGludGVybmFsIHRva2VuVG90YWxTdXBwbHk7CgogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgaW50ZXJuYWwgYmFsYW5jZXM7CiAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgIGZ1bmN0aW9uIEVSQzIwVG9rZW4oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDggX2RlY2ltYWxzLCB1aW50MjU2IF90b3RhbFN1cHBseSwgYWRkcmVzcyBfaW5pdGlhbFRva2VuSG9sZGVyKSBwdWJsaWMgewogICAgICB0b2tlbk5hbWUgPSBfbmFtZTsKICAgICAgdG9rZW5TeW1ib2wgPSBfc3ltYm9sOwogICAgICB0b2tlbkRlY2ltYWxzID0gX2RlY2ltYWxzOwogICAgICB0b2tlblRvdGFsU3VwcGx5ID0gX3RvdGFsU3VwcGx5OwoKICAgICAgLy8gVGhlIGluaXRpYWwgYmFsYW5jZSBvZiB0b2tlbnMgaXMgYXNzaWduZWQgdG8gdGhlIGdpdmVuIHRva2VuIGhvbGRlciBhZGRyZXNzLgogICAgICBiYWxhbmNlc1tfaW5pdGlhbFRva2VuSG9sZGVyXSA9IF90b3RhbFN1cHBseTsKCiAgICAgIC8vIFBlciBFSVAyMCwgdGhlIGNvbnN0cnVjdG9yIHNob3VsZCBmaXJlIGEgVHJhbnNmZXIgZXZlbnQgaWYgdG9rZW5zIGFyZSBhc3NpZ25lZCB0byBhbiBhY2NvdW50LgogICAgICBUcmFuc2ZlcigweDAsIF9pbml0aWFsVG9rZW5Ib2xkZXIsIF90b3RhbFN1cHBseSk7CiAgIH0KCgogICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgIHJldHVybiB0b2tlbk5hbWU7CiAgIH0KCgogICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgcmV0dXJuIHRva2VuU3ltYm9sOwogICB9CgoKICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCkgewogICAgICByZXR1cm4gdG9rZW5EZWNpbWFsczsKICAgfQoKCiAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICByZXR1cm4gdG9rZW5Ub3RhbFN1cHBseTsKICAgfQoKCiAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICB9CgoKICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgfQoKCiAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKCiAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoKICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKCiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgIH0KfQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGaW5hbGl6YWJsZSAtIEJhc2ljIGltcGxlbWVudGF0aW9uIG9mIHRoZSBmaW5hbGl6YXRpb24gcGF0dGVybgovLyBFbnVtYSBCbG9ja2NoYWluIFBsYXRmb3JtCi8vCi8vIENvcHlyaWdodCAoYykgMjAxNyBFbnVtYSBUZWNobm9sb2dpZXMuCi8vIGh0dHBzOi8vd3d3LmVudW1hLmlvLwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCmNvbnRyYWN0IEZpbmFsaXphYmxlIGlzIE93bmVkIHsKCiAgIGJvb2wgcHVibGljIGZpbmFsaXplZDsKCiAgIGV2ZW50IEZpbmFsaXplZCgpOwoKCiAgIGZ1bmN0aW9uIEZpbmFsaXphYmxlKCkgcHVibGljCiAgICAgIE93bmVkKCkKICAgewogICAgICBmaW5hbGl6ZWQgPSBmYWxzZTsKICAgfQoKCiAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgIHJlcXVpcmUoIWZpbmFsaXplZCk7CgogICAgICBmaW5hbGl6ZWQgPSB0cnVlOwoKICAgICAgRmluYWxpemVkKCk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZpbmFsaXphYmxlVG9rZW4gLSBFeHRlbnNpb24gdG8gRVJDMjBUb2tlbiB3aXRoIG9wcyBhbmQgZmluYWxpemF0aW9uCi8vIEVudW1hIEJsb2NrY2hhaW4gUGxhdGZvcm0KLy8KLy8gQ29weXJpZ2h0IChjKSAyMDE3IEVudW1hIFRlY2hub2xvZ2llcy4KLy8gaHR0cHM6Ly93d3cuZW51bWEuaW8vCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKLy8KLy8gRVJDMjAgdG9rZW4gd2l0aCB0aGUgZm9sbG93aW5nIGFkZGl0aW9uczoKLy8gICAgMS4gT3duZXIvT3BzIE93bmVyc2hpcAovLyAgICAyLiBGaW5hbGl6YXRpb24KLy8KY29udHJhY3QgRmluYWxpemFibGVUb2tlbiBpcyBFUkMyMFRva2VuLCBPcHNNYW5hZ2VkLCBGaW5hbGl6YWJsZSB7CgogICB1c2luZyBNYXRoIGZvciB1aW50MjU2OwoKCiAgIC8vIFRoZSBjb25zdHJ1Y3RvciB3aWxsIGFzc2lnbiB0aGUgaW5pdGlhbCB0b2tlbiBzdXBwbHkgdG8gdGhlIG93bmVyIChtc2cuc2VuZGVyKS4KICAgZnVuY3Rpb24gRmluYWxpemFibGVUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMsIHVpbnQyNTYgX3RvdGFsU3VwcGx5KSBwdWJsaWMKICAgICAgRVJDMjBUb2tlbihfbmFtZSwgX3N5bWJvbCwgX2RlY2ltYWxzLCBfdG90YWxTdXBwbHksIG1zZy5zZW5kZXIpCiAgICAgIE9wc01hbmFnZWQoKQogICAgICBGaW5hbGl6YWJsZSgpCiAgIHsKICAgfQoKCiAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICB2YWxpZGF0ZVRyYW5zZmVyKG1zZy5zZW5kZXIsIF90byk7CgogICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICB9CgoKICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICB2YWxpZGF0ZVRyYW5zZmVyKG1zZy5zZW5kZXIsIF90byk7CgogICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgIH0KCgogICBmdW5jdGlvbiB2YWxpZGF0ZVRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgYWRkcmVzcyBfdG8pIHByaXZhdGUgdmlldyB7CiAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgICAgLy8gT25jZSB0aGUgdG9rZW4gaXMgZmluYWxpemVkLCBldmVyeWJvZHkgY2FuIHRyYW5zZmVyIHRva2Vucy4KICAgICAgaWYgKGZpbmFsaXplZCkgewogICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChpc093bmVyKF90bykpIHsKICAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBCZWZvcmUgdGhlIHRva2VuIGlzIGZpbmFsaXplZCwgb25seSBvd25lciBhbmQgb3BzIGFyZSBhbGxvd2VkIHRvIGluaXRpYXRlIHRyYW5zZmVycy4KICAgICAgLy8gVGhpcyBhbGxvd3MgdGhlbSB0byBtb3ZlIHRva2VucyB3aGlsZSB0aGUgc2FsZSBpcyBzdGlsbCBvbmdvaW5nIGZvciBleGFtcGxlLgogICAgICByZXF1aXJlKGlzT3duZXJPck9wcyhfc2VuZGVyKSk7CiAgIH0KfQoKCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZsZXhpYmxlVG9rZW5TYWxlIC0gVG9rZW4gU2FsZSBDb250cmFjdAovLyBFbnVtYSBCbG9ja2NoYWluIFBsYXRmb3JtCi8vCi8vIENvcHlyaWdodCAoYykgMjAxNyBFbnVtYSBUZWNobm9sb2dpZXMuCi8vIGh0dHBzOi8vd3d3LmVudW1hLmlvLwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCmNvbnRyYWN0IEZsZXhpYmxlVG9rZW5TYWxlIGlzIEZpbmFsaXphYmxlLCBPcHNNYW5hZ2VkIHsKCiAgIHVzaW5nIE1hdGggZm9yIHVpbnQyNTY7CgogICAvLwogICAvLyBMaWZlY3ljbGUKICAgLy8KICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwogICBib29sIHB1YmxpYyBzdXNwZW5kZWQ7CgogICAvLwogICAvLyBQcmljaW5nCiAgIC8vCiAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1BlcktFdGhlcjsKICAgdWludDI1NiBwdWJsaWMgYm9udXM7CiAgIHVpbnQyNTYgcHVibGljIG1heFRva2Vuc1BlckFjY291bnQ7CiAgIHVpbnQyNTYgcHVibGljIGNvbnRyaWJ1dGlvbk1pbjsKICAgdWludDI1NiBwdWJsaWMgdG9rZW5Db252ZXJzaW9uRmFjdG9yOwoKICAgLy8KICAgLy8gV2FsbGV0cwogICAvLwogICBhZGRyZXNzIHB1YmxpYyB3YWxsZXRBZGRyZXNzOwoKICAgLy8KICAgLy8gVG9rZW4KICAgLy8KICAgRmluYWxpemFibGVUb2tlbiBwdWJsaWMgdG9rZW47CgogICAvLwogICAvLyBDb3VudGVycwogICAvLwogICB1aW50MjU2IHB1YmxpYyB0b3RhbFRva2Vuc1NvbGQ7CiAgIHVpbnQyNTYgcHVibGljIHRvdGFsRXRoZXJDb2xsZWN0ZWQ7CgoKICAgLy8KICAgLy8gRXZlbnRzCiAgIC8vCiAgIGV2ZW50IEluaXRpYWxpemVkKCk7CiAgIGV2ZW50IFRva2Vuc1BlcktFdGhlclVwZGF0ZWQodWludDI1NiBfbmV3VmFsdWUpOwogICBldmVudCBNYXhUb2tlbnNQZXJBY2NvdW50VXBkYXRlZCh1aW50MjU2IF9uZXdNYXgpOwogICBldmVudCBCb251c1VwZGF0ZWQodWludDI1NiBfbmV3VmFsdWUpOwogICBldmVudCBTYWxlV2luZG93VXBkYXRlZCh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUpOwogICBldmVudCBXYWxsZXRBZGRyZXNzVXBkYXRlZChhZGRyZXNzIF9uZXdBZGRyZXNzKTsKICAgZXZlbnQgU2FsZVN1c3BlbmRlZCgpOwogICBldmVudCBTYWxlUmVzdW1lZCgpOwogICBldmVudCBUb2tlbnNQdXJjaGFzZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX2Nvc3QsIHVpbnQyNTYgX3Rva2Vucyk7CiAgIGV2ZW50IFRva2Vuc1JlY2xhaW1lZCh1aW50MjU2IF9hbW91bnQpOwoKCiAgIGZ1bmN0aW9uIEZsZXhpYmxlVG9rZW5TYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgYWRkcmVzcyBfd2FsbGV0QWRkcmVzcykgcHVibGljCiAgICAgIE9wc01hbmFnZWQoKQogICB7CiAgICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBfc3RhcnRUaW1lKTsKCiAgICAgIHJlcXVpcmUoX3dhbGxldEFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUoX3dhbGxldEFkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CgogICAgICB3YWxsZXRBZGRyZXNzID0gX3dhbGxldEFkZHJlc3M7CgogICAgICBmaW5hbGl6ZWQgPSBmYWxzZTsKICAgICAgc3VzcGVuZGVkID0gZmFsc2U7CgogICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICBlbmRUaW1lICAgPSBfZW5kVGltZTsKCiAgICAgIC8vIFVzZSBzb21lIGRlZmF1bHRzIGNvbmZpZyB2YWx1ZXMuIENsYXNzZXMgZGVyaXZpbmcgZnJvbSBGbGV4aWJsZVRva2VuU2FsZQogICAgICAvLyBzaG91bGQgc2V0IHRoZWlyIG93biBkZWZhdWx0cwogICAgICB0b2tlbnNQZXJLRXRoZXIgICAgID0gMTAwMDAwOwogICAgICBib251cyAgICAgICAgICAgICAgID0gMDsKICAgICAgbWF4VG9rZW5zUGVyQWNjb3VudCA9IDA7CiAgICAgIGNvbnRyaWJ1dGlvbk1pbiAgICAgPSAwLjEgZXRoZXI7CgogICAgICB0b3RhbFRva2Vuc1NvbGQgICAgID0gMDsKICAgICAgdG90YWxFdGhlckNvbGxlY3RlZCA9IDA7CiAgIH0KCgogICBmdW5jdGlvbiBjdXJyZW50VGltZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHJldHVybiBub3c7CiAgIH0KCgogICAvLyBJbml0aWFsaXplIHNob3VsZCBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGFzIHBhcnQgb2YgdGhlIGRlcGxveW1lbnQgKyBzZXR1cCBwaGFzZS4KICAgLy8gSXQgd2lsbCBhc3NvY2lhdGUgdGhlIHNhbGUgY29udHJhY3Qgd2l0aCB0aGUgdG9rZW4gY29udHJhY3QgYW5kIHBlcmZvcm0gYmFzaWMgY2hlY2tzLgogICBmdW5jdGlvbiBpbml0aWFsaXplKEZpbmFsaXphYmxlVG9rZW4gX3Rva2VuKSBleHRlcm5hbCBvbmx5T3duZXIgcmV0dXJucyhib29sKSB7CiAgICAgIHJlcXVpcmUoYWRkcmVzcyh0b2tlbikgPT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUoYWRkcmVzcyhfdG9rZW4pICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKGFkZHJlc3MoX3Rva2VuKSAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgcmVxdWlyZShhZGRyZXNzKF90b2tlbikgIT0gYWRkcmVzcyh3YWxsZXRBZGRyZXNzKSk7CiAgICAgIHJlcXVpcmUoaXNPd25lck9yT3BzKGFkZHJlc3MoX3Rva2VuKSkgPT0gZmFsc2UpOwoKICAgICAgdG9rZW4gPSBfdG9rZW47CgogICAgICAvLyBUaGlzIGZhY3RvciBpcyB1c2VkIHdoZW4gY29udmVydGluZyBjb3N0IDwtPiB0b2tlbnMuCiAgICAgIC8vIDE4IGlzIGJlY2F1c2Ugb2YgdGhlIEVUSCAtPiBXZWkgY29udmVyc2lvbi4KICAgICAgLy8gMyBiZWNhdXNlIHByaWNlcyBhcmUgaW4gSyBFVEggaW5zdGVhZCBvZiBqdXN0IEVUSC4KICAgICAgLy8gNCBiZWNhdXNlIGJvbnVzZXMgYXJlIGV4cHJlc3NlZCBhcyAwIC0gMTAwMDAgZm9yIDAuMDAlIC0gMTAwLjAwJSAod2l0aCAyIGRlY2ltYWxzKS4KICAgICAgdG9rZW5Db252ZXJzaW9uRmFjdG9yID0gMTAqKih1aW50MjU2KDE4KS5zdWIoX3Rva2VuLmRlY2ltYWxzKCkpLmFkZCgzKS5hZGQoNCkpOwogICAgICByZXF1aXJlKHRva2VuQ29udmVyc2lvbkZhY3RvciA+IDApOwoKICAgICAgSW5pdGlhbGl6ZWQoKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgLy8KICAgLy8gT3duZXIgQ29uZmlndWF0aW9uCiAgIC8vCgogICAvLyBBbGxvd3MgdGhlIG93bmVyIHRvIGNoYW5nZSB0aGUgd2FsbGV0IGFkZHJlc3Mgd2hpY2ggaXMgdXNlZCBmb3IgY29sbGVjdGluZwogICAvLyBldGhlciByZWNlaXZlZCBkdXJpbmcgdGhlIHRva2VuIHNhbGUuCiAgIGZ1bmN0aW9uIHNldFdhbGxldEFkZHJlc3MoYWRkcmVzcyBfd2FsbGV0QWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMoYm9vbCkgewogICAgICByZXF1aXJlKF93YWxsZXRBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF93YWxsZXRBZGRyZXNzICE9IGFkZHJlc3ModGhpcykpOwogICAgICByZXF1aXJlKF93YWxsZXRBZGRyZXNzICE9IGFkZHJlc3ModG9rZW4pKTsKICAgICAgcmVxdWlyZShpc093bmVyT3JPcHMoX3dhbGxldEFkZHJlc3MpID09IGZhbHNlKTsKCiAgICAgIHdhbGxldEFkZHJlc3MgPSBfd2FsbGV0QWRkcmVzczsKCiAgICAgIFdhbGxldEFkZHJlc3NVcGRhdGVkKF93YWxsZXRBZGRyZXNzKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgLy8gQWxsb3dzIHRoZSBvd25lciB0byBzZXQgYW4gb3B0aW9uYWwgbGltaXQgb24gdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBjYW4gYmUgcHVyY2hhc2VkCiAgIC8vIGJ5IGEgY29udHJpYnV0b3IuIEl0IGNhbiBhbHNvIGJlIHNldCB0byAwIHRvIHJlbW92ZSBsaW1pdC4KICAgZnVuY3Rpb24gc2V0TWF4VG9rZW5zUGVyQWNjb3VudCh1aW50MjU2IF9tYXhUb2tlbnMpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zKGJvb2wpIHsKCiAgICAgIG1heFRva2Vuc1BlckFjY291bnQgPSBfbWF4VG9rZW5zOwoKICAgICAgTWF4VG9rZW5zUGVyQWNjb3VudFVwZGF0ZWQoX21heFRva2Vucyk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgb3duZXIgdG8gc3BlY2lmeSB0aGUgY29udmVyc2lvbiByYXRlIGZvciBFVEggLT4gdG9rZW5zLgogICAvLyBGb3IgZXhhbXBsZSwgcGFzc2luZyAxLDAwMCwwMDAgd291bGQgbWVhbiB0aGF0IDEgRVRIIHdvdWxkIHB1cmNoYXNlIDEwMDAgdG9rZW5zLgogICBmdW5jdGlvbiBzZXRUb2tlbnNQZXJLRXRoZXIodWludDI1NiBfdG9rZW5zUGVyS0V0aGVyKSBleHRlcm5hbCBvbmx5T3duZXIgcmV0dXJucyhib29sKSB7CiAgICAgIHJlcXVpcmUoX3Rva2Vuc1BlcktFdGhlciA+IDApOwoKICAgICAgdG9rZW5zUGVyS0V0aGVyID0gX3Rva2Vuc1BlcktFdGhlcjsKCiAgICAgIFRva2Vuc1BlcktFdGhlclVwZGF0ZWQoX3Rva2Vuc1BlcktFdGhlcik7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgb3duZXIgdG8gc2V0IGEgYm9udXMgdG8gYXBwbHkgdG8gYWxsIHB1cmNoYXNlcy4KICAgLy8gRm9yIGV4YW1wbGUsIHNldHRpbmcgaXQgdG8gMjAwMCBtZWFucyB0aGF0IGluc3RlYWQgb2YgcmVjZWl2aW5nIDIwMCB0b2tlbnMsCiAgIC8vIGZvciBhIGdpdmVuIHByaWNlLCBjb250cmlidXRvcnMgd291bGQgcmVjZWl2ZSAyNDAgdG9rZW5zICgyMC4wMCUgYm9udXMpLgogICBmdW5jdGlvbiBzZXRCb251cyh1aW50MjU2IF9ib251cykgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMoYm9vbCkgewogICAgICByZXF1aXJlKF9ib251cyA8PSAxMDAwMCk7CgogICAgICBib251cyA9IF9ib251czsKCiAgICAgIEJvbnVzVXBkYXRlZChfYm9udXMpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgIH0KCgogICAvLyBBbGxvd3MgdGhlIG93bmVyIHRvIHNldCBhIHNhbGUgd2luZG93IHdoaWNoIHdpbGwgYWxsb3cgdGhlIHNhbGUgKGFrYSBidXlUb2tlbnMpIHRvCiAgIC8vIHJlY2VpdmUgY29udHJpYnV0aW9ucyBiZXR3ZWVuIF9zdGFydFRpbWUgYW5kIF9lbmRUaW1lLiBPbmNlIF9lbmRUaW1lIGlzIHJlYWNoZWQsCiAgIC8vIHRoZSBzYWxlIGNvbnRyYWN0IHdpbGwgYXV0b21hdGljYWxseSBzdG9wIGFjY2VwdGluZyBpbmNvbWluZyBjb250cmlidXRpb25zLgogICBmdW5jdGlvbiBzZXRTYWxlV2luZG93KHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSkgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMoYm9vbCkgewogICAgICByZXF1aXJlKF9zdGFydFRpbWUgPiAwKTsKICAgICAgcmVxdWlyZShfZW5kVGltZSA+IF9zdGFydFRpbWUpOwoKICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgICAgZW5kVGltZSAgID0gX2VuZFRpbWU7CgogICAgICBTYWxlV2luZG93VXBkYXRlZChfc3RhcnRUaW1lLCBfZW5kVGltZSk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgb3duZXIgdG8gc3VzcGVuZCB0aGUgc2FsZSB1bnRpbCBpdCBpcyBtYW51YWxseSByZXN1bWVkIGF0IGEgbGF0ZXIgdGltZS4KICAgZnVuY3Rpb24gc3VzcGVuZCgpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zKGJvb2wpIHsKICAgICAgaWYgKHN1c3BlbmRlZCA9PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHN1c3BlbmRlZCA9IHRydWU7CgogICAgICBTYWxlU3VzcGVuZGVkKCk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgb3duZXIgdG8gcmVzdW1lIHRoZSBzYWxlLgogICBmdW5jdGlvbiByZXN1bWUoKSBleHRlcm5hbCBvbmx5T3duZXIgcmV0dXJucyhib29sKSB7CiAgICAgIGlmIChzdXNwZW5kZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgc3VzcGVuZGVkID0gZmFsc2U7CgogICAgICBTYWxlUmVzdW1lZCgpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgIH0KCgogICAvLwogICAvLyBDb250cmlidXRpb25zCiAgIC8vCgogICAvLyBEZWZhdWx0IHBheWFibGUgZnVuY3Rpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gcHVyY2hhc2UgdG9rZW5zLgogICBmdW5jdGlvbiAoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgY2FsbGVyIHRvIHB1cmNoYXNlIHRva2VucyBmb3IgYSBzcGVjaWZpYyBiZW5lZmljaWFyeSAocHJveHkgcHVyY2hhc2UpLgogICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgcmV0dXJuIGJ1eVRva2Vuc0ludGVybmFsKF9iZW5lZmljaWFyeSwgYm9udXMpOwogICB9CgoKICAgZnVuY3Rpb24gYnV5VG9rZW5zSW50ZXJuYWwoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX2JvbnVzKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHJlcXVpcmUoIWZpbmFsaXplZCk7CiAgICAgIHJlcXVpcmUoIXN1c3BlbmRlZCk7CiAgICAgIHJlcXVpcmUoY3VycmVudFRpbWUoKSA+PSBzdGFydFRpbWUpOwogICAgICByZXF1aXJlKGN1cnJlbnRUaW1lKCkgPD0gZW5kVGltZSk7CiAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGNvbnRyaWJ1dGlvbk1pbik7CiAgICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF9iZW5lZmljaWFyeSAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcyh0b2tlbikpOwoKICAgICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBhbGxvdyB0aGUgd2FsbGV0IGNvbGxlY3RpbmcgRVRIIHRvCiAgICAgIC8vIGRpcmVjdGx5IGJlIHVzZWQgdG8gcHVyY2hhc2UgdG9rZW5zLgogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh3YWxsZXRBZGRyZXNzKSk7CgogICAgICAvLyBDaGVjayBob3cgbWFueSB0b2tlbnMgYXJlIHN0aWxsIGF2YWlsYWJsZSBmb3Igc2FsZS4KICAgICAgdWludDI1NiBzYWxlQmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgICAgcmVxdWlyZShzYWxlQmFsYW5jZSA+IDApOwoKICAgICAgLy8gQ2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGUgY29udHJpYnV0b3IgY291bGQgcHVyY2hhc2UgYmFzZWQgb24gRVRIIHJlY2VpdmVkLgogICAgICB1aW50MjU2IHRva2VucyA9IG1zZy52YWx1ZS5tdWwodG9rZW5zUGVyS0V0aGVyKS5tdWwoX2JvbnVzLmFkZCgxMDAwMCkpLmRpdih0b2tlbkNvbnZlcnNpb25GYWN0b3IpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwoKICAgICAgdWludDI1NiBjb3N0ID0gbXNnLnZhbHVlOwogICAgICB1aW50MjU2IHJlZnVuZCA9IDA7CgogICAgICAvLyBDYWxjdWxhdGUgd2hhdCBpcyB0aGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgdGhlIGNvbnRyaWJ1dG9yCiAgICAgIC8vIHNob3VsZCBiZSBhbGxvd2VkIHRvIHB1cmNoYXNlCiAgICAgIHVpbnQyNTYgbWF4VG9rZW5zID0gc2FsZUJhbGFuY2U7CgogICAgICBpZiAobWF4VG9rZW5zUGVyQWNjb3VudCA+IDApIHsKICAgICAgICAgLy8gVGhlcmUgaXMgYSBtYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgcGVyIGFjY291bnQgaW4gcGxhY2UuCiAgICAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGFscmVhZHkgaGl0IHRoYXQgbGltaXQuCiAgICAgICAgIHVpbnQyNTYgdXNlckJhbGFuY2UgPSBnZXRVc2VyVG9rZW5CYWxhbmNlKF9iZW5lZmljaWFyeSk7CiAgICAgICAgIHJlcXVpcmUodXNlckJhbGFuY2UgPCBtYXhUb2tlbnNQZXJBY2NvdW50KTsKCiAgICAgICAgIHVpbnQyNTYgcXVvdGFCYWxhbmNlID0gbWF4VG9rZW5zUGVyQWNjb3VudC5zdWIodXNlckJhbGFuY2UpOwoKICAgICAgICAgaWYgKHF1b3RhQmFsYW5jZSA8IHNhbGVCYWxhbmNlKSB7CiAgICAgICAgICAgIG1heFRva2VucyA9IHF1b3RhQmFsYW5jZTsKICAgICAgICAgfQogICAgICB9CgogICAgICByZXF1aXJlKG1heFRva2VucyA+IDApOwoKICAgICAgaWYgKHRva2VucyA+IG1heFRva2VucykgewogICAgICAgICAvLyBUaGUgY29udHJpYnV0b3Igc2VudCBtb3JlIEVUSCB0aGFuIGFsbG93ZWQgdG8gcHVyY2hhc2UuCiAgICAgICAgIC8vIExpbWl0IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgdGhleSBjYW4gcHVyY2hhc2UgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgICAgICAgdG9rZW5zID0gbWF4VG9rZW5zOwoKICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhY3R1YWwgY29zdCBmb3IgdGhhdCBuZXcgYW1vdW50IG9mIHRva2Vucy4KICAgICAgICAgY29zdCA9IHRva2Vucy5tdWwodG9rZW5Db252ZXJzaW9uRmFjdG9yKS5kaXYodG9rZW5zUGVyS0V0aGVyLm11bChfYm9udXMuYWRkKDEwMDAwKSkpOwoKICAgICAgICAgaWYgKG1zZy52YWx1ZSA+IGNvc3QpIHsKICAgICAgICAgICAgLy8gSWYgdGhlIGNvbnRyaWJ1dG9yIHNlbnQgbW9yZSBFVEggdGhhbiBuZWVkZWQgdG8gYnV5IHRoZSB0b2tlbnMsCiAgICAgICAgICAgIC8vIHRoZSBiYWxhbmNlIHNob3VsZCBiZSByZWZ1bmRlZC4KICAgICAgICAgICAgcmVmdW5kID0gbXNnLnZhbHVlLnN1Yihjb3N0KTsKICAgICAgICAgfQogICAgICB9CgogICAgICAvLyBUaGlzIGlzIHRoZSBhY3R1YWwgYW1vdW50IG9mIEVUSCB0aGF0IGNhbiBiZSBzZW50IHRvIHRoZSB3YWxsZXQuCiAgICAgIHVpbnQyNTYgY29udHJpYnV0aW9uID0gbXNnLnZhbHVlLnN1YihyZWZ1bmQpOwogICAgICB3YWxsZXRBZGRyZXNzLnRyYW5zZmVyKGNvbnRyaWJ1dGlvbik7CgogICAgICAvLyBVcGRhdGUgb3VyIHN0YXRzIGNvdW50ZXJzLgogICAgICB0b3RhbFRva2Vuc1NvbGQgICAgID0gdG90YWxUb2tlbnNTb2xkLmFkZCh0b2tlbnMpOwogICAgICB0b3RhbEV0aGVyQ29sbGVjdGVkID0gdG90YWxFdGhlckNvbGxlY3RlZC5hZGQoY29udHJpYnV0aW9uKTsKCiAgICAgIC8vIFRyYW5zZmVyIHRva2VucyB0byB0aGUgYmVuZWZpY2lhcnkuCiAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoX2JlbmVmaWNpYXJ5LCB0b2tlbnMpKTsKCiAgICAgIC8vIElzc3VlIGEgcmVmdW5kIGZvciB0aGUgZXhjZXNzIEVUSCwgYXMgbmVlZGVkLgogICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgIH0KCiAgICAgIFRva2Vuc1B1cmNoYXNlZChfYmVuZWZpY2lhcnksIGNvc3QsIHRva2Vucyk7CgogICAgICByZXR1cm4gdG9rZW5zOwogICB9CgoKICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRva2VucyB0aGF0IHRoZSB1c2VyIGhhcyBwdXJjaGFzZWQuIFdpbGwgYmUgY2hlY2tlZCBhZ2FpbnN0IHRoZQogICAvLyBtYXhpbXVtIGFsbG93ZWQuIENhbiBiZSBvdmVycmlkZW4gaW4gYSBzdWIgY2xhc3MgdG8gY2hhbmdlIHRoZSBjYWxjdWxhdGlvbnMuCiAgIGZ1bmN0aW9uIGdldFVzZXJUb2tlbkJhbGFuY2UoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKF9iZW5lZmljaWFyeSk7CiAgIH0KCgogICAvLyBBbGxvd3MgdGhlIG93bmVyIHRvIHRha2UgYmFjayB0aGUgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIHRoZSBzYWxlIGNvbnRyYWN0LgogICBmdW5jdGlvbiByZWNsYWltVG9rZW5zKCkgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgdWludDI1NiB0b2tlbnMgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CgogICAgICBpZiAodG9rZW5zID09IDApIHsKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBhZGRyZXNzIHRva2VuT3duZXIgPSB0b2tlbi5vd25lcigpOwogICAgICByZXF1aXJlKHRva2VuT3duZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKHRva2VuT3duZXIsIHRva2VucykpOwoKICAgICAgVG9rZW5zUmVjbGFpbWVkKHRva2Vucyk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQp9CgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBCbHV6ZWxsZVRva2VuQ29uZmlnIC0gVG9rZW4gQ29udHJhY3QgQ29uZmlndXJhdGlvbgovLwovLyBDb3B5cmlnaHQgKGMpIDIwMTcgQmx1emVsbGUgTmV0d29ya3MgUHRlIEx0ZC4KLy8gaHR0cDovL3d3dy5ibHV6ZWxsZS5jb20vCi8vCi8vIFRoZSBNSVQgTGljZW5jZS4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCmNvbnRyYWN0IEJsdXplbGxlVG9rZW5Db25maWcgewoKICAgIHN0cmluZyAgcHVibGljIGNvbnN0YW50IFRPS0VOX1NZTUJPTCAgICAgID0gIkJMWiI7CiAgICBzdHJpbmcgIHB1YmxpYyBjb25zdGFudCBUT0tFTl9OQU1FICAgICAgICA9ICJCbHV6ZWxsZSBUb2tlbiI7CiAgICB1aW50OCAgIHB1YmxpYyBjb25zdGFudCBUT0tFTl9ERUNJTUFMUyAgICA9IDE4OwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IERFQ0lNQUxTRkFDVE9SICAgID0gMTAqKnVpbnQyNTYoVE9LRU5fREVDSU1BTFMpOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fVE9UQUxTVVBQTFkgPSA1MDAwMDAwMDAgKiBERUNJTUFMU0ZBQ1RPUjsKfQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQmx1emVsbGVUb2tlblNhbGVDb25maWcgLSBUb2tlbiBTYWxlIENvbmZpZ3VyYXRpb24KLy8KLy8gQ29weXJpZ2h0IChjKSAyMDE3IEJsdXplbGxlIE5ldHdvcmtzIFB0ZSBMdGQuCi8vIGh0dHA6Ly93d3cuYmx1emVsbGUuY29tLwovLwovLyBUaGUgTUlUIExpY2VuY2UuCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKY29udHJhY3QgQmx1emVsbGVUb2tlblNhbGVDb25maWcgaXMgQmx1emVsbGVUb2tlbkNvbmZpZyB7CgogICAgLy8KICAgIC8vIFRpbWUKICAgIC8vCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJTklUSUFMX1NUQVJUVElNRSAgICAgID0gMTUxNjI0MDgwMDsgLy8gMjAxOC0wMS0xOCwgMDI6MDA6MDAgVVRDCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJTklUSUFMX0VORFRJTUUgICAgICAgID0gMTUxNzUzNjgwMDsgLy8gMjAxOC0wMi0wMiwgMDI6MDA6MDAgVVRDCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJTklUSUFMX1NUQUdFICAgICAgICAgID0gMTsKCgogICAgLy8KICAgIC8vIFB1cmNoYXNlcwogICAgLy8KCiAgICAvLyBNaW5pbXVtIGFtb3VudCBvZiBFVEggdGhhdCBjYW4gYmUgdXNlZCBmb3IgcHVyY2hhc2UuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBDT05UUklCVVRJT05fTUlOICAgICAgPSAwLjEgZXRoZXI7CgogICAgLy8gUHJpY2Ugb2YgdG9rZW5zLCBiYXNlZCBvbiB0aGUgMSBFVEggPSAxNzAwIEJMWiBjb252ZXJzaW9uIHJhdGlvLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX1BFUl9LRVRIRVIgICAgID0gMTcwMDAwMDsKCiAgICAvLyBBbW91bnQgb2YgYm9udXMgYXBwbGllZCB0byB0aGUgc2FsZS4gMjAwMCA9IDIwLjAwJSBib251cywgNzUwID0gNy41MCUgYm9udXMsIDAgPSBubyBib251cy4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEJPTlVTICAgICAgICAgICAgICAgICA9IDA7CgogICAgLy8gTWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgY2FuIGJlIHB1cmNoYXNlZCBmb3IgZWFjaCBhY2NvdW50LgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5TX0FDQ09VTlRfTUFYICAgID0gMTcwMDAgKiBERUNJTUFMU0ZBQ1RPUjsKfQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQmx1emVsbGVUb2tlbiAtIEVSQzIwIENvbXBhdGlibGUgVG9rZW4KLy8KLy8gQ29weXJpZ2h0IChjKSAyMDE3IEJsdXplbGxlIE5ldHdvcmtzIFB0ZSBMdGQuCi8vIGh0dHA6Ly93d3cuYmx1emVsbGUuY29tLwovLwovLyBUaGUgTUlUIExpY2VuY2UuCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBUaGUgQmx1emVsbGUgdG9rZW4gaXMgYSBzdGFuZGFyZCBFUkMyMCB0b2tlbiB3aXRoIHRoZSBhZGRpdGlvbiBvZiBhIGZldwovLyBjb25jZXB0cyBzdWNoIGFzOgovLwovLyAxLiBGaW5hbGl6YXRpb24KLy8gVG9rZW5zIGNhbiBvbmx5IGJlIHRyYW5zZmVyZWQgYnkgY29udHJpYnV0b3JzIGFmdGVyIHRoZSBjb250cmFjdCBoYXMKLy8gYmVlbiBmaW5hbGl6ZWQuCi8vCi8vIDIuIE9wcyBNYW5hZ2VkIE1vZGVsCi8vIEluIGFkZGl0aW9uIHRvIG93bmVyLCB0aGVyZSBpcyBhIG9wcyByb2xlIHdoaWNoIGlzIHVzZWQgZHVyaW5nIHRoZSBzYWxlLAovLyBieSB0aGUgc2FsZSBjb250cmFjdCwgaW4gb3JkZXIgdG8gdHJhbnNmZXIgdG9rZW5zLgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEJsdXplbGxlVG9rZW4gaXMgRmluYWxpemFibGVUb2tlbiwgQmx1emVsbGVUb2tlbkNvbmZpZyB7CgoKICAgZXZlbnQgVG9rZW5zUmVjbGFpbWVkKHVpbnQyNTYgX2Ftb3VudCk7CgoKICAgZnVuY3Rpb24gQmx1emVsbGVUb2tlbigpIHB1YmxpYwogICAgICBGaW5hbGl6YWJsZVRva2VuKFRPS0VOX05BTUUsIFRPS0VOX1NZTUJPTCwgVE9LRU5fREVDSU1BTFMsIFRPS0VOX1RPVEFMU1VQUExZKQogICB7CiAgIH0KCgogICAvLyBBbGxvd3MgdGhlIG93bmVyIHRvIHJlY2xhaW0gdG9rZW5zIHRoYXQgaGF2ZSBiZWVuIHNlbnQgdG8gdGhlIHRva2VuIGFkZHJlc3MgaXRzZWxmLgogICBmdW5jdGlvbiByZWNsYWltVG9rZW5zKCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgogICAgICBhZGRyZXNzIGFjY291bnQgPSBhZGRyZXNzKHRoaXMpOwogICAgICB1aW50MjU2IGFtb3VudCAgPSBiYWxhbmNlT2YoYWNjb3VudCk7CgogICAgICBpZiAoYW1vdW50ID09IDApIHsKICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBiYWxhbmNlc1thY2NvdW50XSA9IGJhbGFuY2VzW2FjY291bnRdLnN1YihhbW91bnQpOwogICAgICBiYWxhbmNlc1tvd25lcl0gPSBiYWxhbmNlc1tvd25lcl0uYWRkKGFtb3VudCk7CgogICAgICBUcmFuc2ZlcihhY2NvdW50LCBvd25lciwgYW1vdW50KTsKCiAgICAgIFRva2Vuc1JlY2xhaW1lZChhbW91bnQpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgIH0KfQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQmx1emVsbGVUb2tlblNhbGUgLSBUb2tlbiBTYWxlIENvbnRyYWN0Ci8vCi8vIENvcHlyaWdodCAoYykgMjAxNyBCbHV6ZWxsZSBOZXR3b3JrcyBQdGUgTHRkLgovLyBodHRwOi8vd3d3LmJsdXplbGxlLmNvbS8KLy8KLy8gVGhlIE1JVCBMaWNlbmNlLgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCmNvbnRyYWN0IEJsdXplbGxlVG9rZW5TYWxlIGlzIEZsZXhpYmxlVG9rZW5TYWxlLCBCbHV6ZWxsZVRva2VuU2FsZUNvbmZpZyB7CgogICAvLwogICAvLyBXaGl0ZWxpc3QKICAgLy8KCiAgIC8vIFRoaXMgaXMgdGhlIHN0YWdlIG9yIHdoaXRlbGlzdCBncm91cCB0aGF0IGlzIGN1cnJlbnRseSBpbiBlZmZlY3QuCiAgIC8vIEV2ZXJ5Ym9keSB0aGF0J3MgYmVlbiB3aGl0ZWxpc3RlZCBmb3IgZWFybGllciBzdGFnZXMgc2hvdWxkIGJlIGFibGUgdG8KICAgLy8gY29udHJpYnV0ZSBpbiB0aGUgY3VycmVudCBzdGFnZS4KICAgdWludDI1NiBwdWJsaWMgY3VycmVudFN0YWdlOwoKICAgLy8gS2VlcHMgdHJhY2sgb2YgdGhlIGFtb3VudCBvZiBib251cyB0byBhcHBseSBmb3IgYSBnaXZlbiBzdGFnZS4gSWYgc2V0CiAgIC8vIHRvIDAsIHRoZSBiYXNlIGNsYXNzIGJvbnVzIHdpbGwgYmUgdXNlZC4KICAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBzdGFnZUJvbnVzOwoKICAgLy8gS2VlcHMgdHJhY2sgb2YgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhIHNwZWNpZmljIGFjY291bnQgaGFzIHJlY2VpdmVkLgogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFjY291bnRUb2tlbnNQdXJjaGFzZWQ7CgogICAvLyBUaGlzIGEgbWFwcGluZyBvZiBhZGRyZXNzIC0+IHN0YWdlIHRoYXQgdGhleSBhcmUgYWxsb3dlZCB0byBwYXJ0aWNpcGF0ZSBpbi4KICAgLy8gRm9yIGV4YW1wbGUsIGlmIHNvbWVvbmUgaGFzIGJlZW4gd2hpdGVsaXN0ZWQgZm9yIHN0YWdlIDIsIHRoZXkgd2lsbCBiZSBhYmxlCiAgIC8vIHRvIHBhcnRpY2lwYXRlIGZvciBzdGFnZXMgMiBhbmQgYWJvdmUgYnV0IHRoZXkgd291bGQgbm90IGJlIGFibGUgdG8gcGFydGljaXBhdGUKICAgLy8gaW4gc3RhZ2UgMS4gQSBzdGFnZSB2YWx1ZSBvZiAwIG1lYW5zIHRoYXQgdGhlIHBhcnRpY2lwYW50IGlzIG5vdCB3aGl0ZWxpc3RlZC4KICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB3aGl0ZWxpc3Q7CgoKICAgLy8KICAgLy8gRXZlbnRzCiAgIC8vCiAgIGV2ZW50IEN1cnJlbnRTdGFnZVVwZGF0ZWQodWludDI1NiBfbmV3U3RhZ2UpOwogICBldmVudCBTdGFnZUJvbnVzVXBkYXRlZCh1aW50MjU2IF9zdGFnZSwgdWludDI1NiBfYm9udXMpOwogICBldmVudCBXaGl0ZWxpc3RlZFN0YXR1c1VwZGF0ZWQoYWRkcmVzcyBpbmRleGVkIF9hZGRyZXNzLCB1aW50MjU2IF9zdGFnZSk7CgoKICAgZnVuY3Rpb24gQmx1emVsbGVUb2tlblNhbGUoYWRkcmVzcyB3YWxsZXQpIHB1YmxpYwogICAgICBGbGV4aWJsZVRva2VuU2FsZShJTklUSUFMX1NUQVJUVElNRSwgSU5JVElBTF9FTkRUSU1FLCB3YWxsZXQpCiAgIHsKICAgICAgY3VycmVudFN0YWdlICAgICAgICA9IElOSVRJQUxfU1RBR0U7CiAgICAgIHRva2Vuc1BlcktFdGhlciAgICAgPSBUT0tFTlNfUEVSX0tFVEhFUjsKICAgICAgYm9udXMgICAgICAgICAgICAgICA9IEJPTlVTOwogICAgICBtYXhUb2tlbnNQZXJBY2NvdW50ID0gVE9LRU5TX0FDQ09VTlRfTUFYOwogICAgICBjb250cmlidXRpb25NaW4gICAgID0gQ09OVFJJQlVUSU9OX01JTjsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgYWRtaW4gdG8gZGV0ZXJtaW5lIHdoYXQgaXMgdGhlIGN1cnJlbnQgc3RhZ2UgZm9yCiAgIC8vIHRoZSBzYWxlLiBJdCBjYW4gb25seSBtb3ZlIGZvcndhcmQuCiAgIGZ1bmN0aW9uIHNldEN1cnJlbnRTdGFnZSh1aW50MjU2IF9zdGFnZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zKGJvb2wpIHsKICAgICAgcmVxdWlyZShfc3RhZ2UgPiAwKTsKCiAgICAgIGlmIChjdXJyZW50U3RhZ2UgPT0gX3N0YWdlKSB7CiAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY3VycmVudFN0YWdlID0gX3N0YWdlOwoKICAgICAgQ3VycmVudFN0YWdlVXBkYXRlZChfc3RhZ2UpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgIH0KCgogICAvLyBBbGxvd3MgdGhlIGFkbWluIHRvIHNldCBhIGJvbnVzIGFtb3VudCB0byBhcHBseSBmb3IgYSBzcGVjaWZpYyBzdGFnZS4KICAgZnVuY3Rpb24gc2V0U3RhZ2VCb251cyh1aW50MjU2IF9zdGFnZSwgdWludDI1NiBfYm9udXMpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyhib29sKSB7CiAgICAgIHJlcXVpcmUoX3N0YWdlID4gMCk7CiAgICAgIHJlcXVpcmUoX2JvbnVzIDw9IDEwMDAwKTsKCiAgICAgIGlmIChzdGFnZUJvbnVzW19zdGFnZV0gPT0gX2JvbnVzKSB7CiAgICAgICAgIC8vIE5vdGhpbmcgdG8gY2hhbmdlLgogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHN0YWdlQm9udXNbX3N0YWdlXSA9IF9ib251czsKCiAgICAgIFN0YWdlQm9udXNVcGRhdGVkKF9zdGFnZSwgX2JvbnVzKTsKCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgLy8gQWxsb3dzIHRoZSBvd25lciBvciBvcHMgdG8gYWRkL3JlbW92ZSBwZW9wbGUgZnJvbSB0aGUgd2hpdGVsaXN0LgogICBmdW5jdGlvbiBzZXRXaGl0ZWxpc3RlZFN0YXR1cyhhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF9zdGFnZSkgcHVibGljIG9ubHlPd25lck9yT3BzIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIHNldFdoaXRlbGlzdGVkU3RhdHVzSW50ZXJuYWwoX2FkZHJlc3MsIF9zdGFnZSk7CiAgIH0KCgogICBmdW5jdGlvbiBzZXRXaGl0ZWxpc3RlZFN0YXR1c0ludGVybmFsKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX3N0YWdlKSBwcml2YXRlIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSB3YWxsZXRBZGRyZXNzKTsKCiAgICAgIHdoaXRlbGlzdFtfYWRkcmVzc10gPSBfc3RhZ2U7CgogICAgICBXaGl0ZWxpc3RlZFN0YXR1c1VwZGF0ZWQoX2FkZHJlc3MsIF9zdGFnZSk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgfQoKCiAgIC8vIEFsbG93cyB0aGUgb3duZXIgb3Igb3BzIHRvIGFkZC9yZW1vdmUgcGVvcGxlIGZyb20gdGhlIHdoaXRlbGlzdCwgaW4gYmF0Y2hlcy4gVGhpcyBtYWtlcwogICAvLyBpdCBlYXNpZXIvY2hlYXBlci9mYXN0ZXIgdG8gdXBsb2FkIHdoaXRlbGlzdCBkYXRhIGluIGJ1bGsuIE5vdGUgdGhhdCB0aGUgZnVuY3Rpb24gaXMgdXNpbmcgYW4KICAgLy8gdW5ib3VuZGVkIGxvb3Agc28gdGhlIGNhbGwgc2hvdWxkIHRha2UgY2FyZSB0byBub3QgZXhjZWVkIHRoZSB0eCBnYXMgbGltaXQgb3IgYmxvY2sgZ2FzIGxpbWl0LgogICBmdW5jdGlvbiBzZXRXaGl0ZWxpc3RlZEJhdGNoKGFkZHJlc3NbXSBfYWRkcmVzc2VzLCB1aW50MjU2IF9zdGFnZSkgcHVibGljIG9ubHlPd25lck9yT3BzIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmVxdWlyZShfYWRkcmVzc2VzLmxlbmd0aCA+IDApOwoKICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2FkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICByZXF1aXJlKHNldFdoaXRlbGlzdGVkU3RhdHVzSW50ZXJuYWwoX2FkZHJlc3Nlc1tpXSwgX3N0YWdlKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICB9CgoKICAgLy8gVGhpcyBpcyBhbiBleHRlbnNpb24gdG8gdGhlIGJ1eVRva2VuIGZ1bmN0aW9uIGluIEZsZXhpYmxlVG9rZW5TYWxlIHdoaWNoIGFsc28gdGFrZXMKICAgLy8gY2FyZSBvZiBjaGVja2luZyBjb250cmlidXRvcnMgYWdhaW5zdCB0aGUgd2hpdGVsaXN0LiBTaW5jZSBidXlUb2tlbnMgc3VwcG9ydHMgcHJveHkgcGF5bWVudHMKICAgLy8gd2UgY2hlY2sgdGhhdCBib3RoIHRoZSBzZW5kZXIgYW5kIHRoZSBiZW5lZmljaWFyeSBoYXZlIGJlZW4gd2hpdGVsaXN0ZWQuCiAgIGZ1bmN0aW9uIGJ1eVRva2Vuc0ludGVybmFsKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9ib251cykgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICByZXF1aXJlKHdoaXRlbGlzdFttc2cuc2VuZGVyXSA+IDApOwogICAgICByZXF1aXJlKHdoaXRlbGlzdFtfYmVuZWZpY2lhcnldID4gMCk7CiAgICAgIHJlcXVpcmUoY3VycmVudFN0YWdlID49IHdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CgogICAgICB1aW50MjU2IF9iZW5lZmljaWFyeVN0YWdlID0gd2hpdGVsaXN0W19iZW5lZmljaWFyeV07CiAgICAgIHJlcXVpcmUoY3VycmVudFN0YWdlID49IF9iZW5lZmljaWFyeVN0YWdlKTsKCiAgICAgIHVpbnQyNTYgYXBwbGljYWJsZUJvbnVzID0gc3RhZ2VCb251c1tfYmVuZWZpY2lhcnlTdGFnZV07CiAgICAgIGlmIChhcHBsaWNhYmxlQm9udXMgPT0gMCkgewogICAgICAgICBhcHBsaWNhYmxlQm9udXMgPSBfYm9udXM7CiAgICAgIH0KCiAgICAgIHVpbnQyNTYgdG9rZW5zUHVyY2hhc2VkID0gc3VwZXIuYnV5VG9rZW5zSW50ZXJuYWwoX2JlbmVmaWNpYXJ5LCBhcHBsaWNhYmxlQm9udXMpOwoKICAgICAgYWNjb3VudFRva2Vuc1B1cmNoYXNlZFtfYmVuZWZpY2lhcnldID0gYWNjb3VudFRva2Vuc1B1cmNoYXNlZFtfYmVuZWZpY2lhcnldLmFkZCh0b2tlbnNQdXJjaGFzZWQpOwoKICAgICAgcmV0dXJuIHRva2Vuc1B1cmNoYXNlZDsKICAgfQoKCiAgIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCB0aGUgdXNlciBoYXMgcHVyY2hhc2VkLiBXZSBrZWVwIGEgc2VwYXJhdGUgYmFsYW5jZSBmcm9tCiAgIC8vIHRoZSB0b2tlbiBjb250cmFjdCBpbiBjYXNlIHdlJ2QgbGlrZSB0byBkbyBhZGRpdGlvbmFsIHNhbGVzIHdpdGggbmV3IHB1cmNoYXNlIGxpbWl0cy4gVGhpcyBiZWhhdmlvcgogICAvLyBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgYmFzZSBpbXBsZW1lbnRhdGlvbiB3aGljaCBqdXN0IGNoZWNrcyB0aGUgdG9rZW4gYmFsYW5jZSBmcm9tIHRoZSB0b2tlbgogICAvLyBjb250cmFjdCBkaXJlY3RseS4KICAgZnVuY3Rpb24gZ2V0VXNlclRva2VuQmFsYW5jZShhZGRyZXNzIF9iZW5lZmljaWFyeSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHJldHVybiBhY2NvdW50VG9rZW5zUHVyY2hhc2VkW19iZW5lZmljaWFyeV07CiAgIH0KfQ=='.
	

]
