Class {
	#name : #SRT40f4991411ac5377675c421e87378e10470134a3,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT40f4991411ac5377675c421e87378e10470134a3 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Ci8qClRoaXMgRllOIHRva2VuIGNvbnRyYWN0IGlzIGRlcml2ZWQgZnJvbSB0aGUgdlNsaWNlIElDTyBjb250cmFjdCwgYmFzZWQgb24gdGhlIEVSQzIwIHRva2VuIGNvbnRyYWN0LiAKQWRkaXRpb25hbCBmdW5jdGlvbmFsaXR5IGhhcyBiZWVuIGludGVncmF0ZWQ6CiogdGhlIGZ1bmN0aW9uIG1pbnRUb2tlbnMoKSBvbmx5IGNhbGxhYmxlIGZyb20gd2FsbGV0LCB3aGljaCBtYWtlcyB1c2Ugb2YgdGhlIGN1cnJlbnRTd2FwUmF0ZSgpIGFuZCBzYWZlVG9BZGQoKSBoZWxwZXJzCiogdGhlIGZ1bmN0aW9uIG1pbnRSZXNlcnZlKCkgb25seSBjYWxsYWJsZSBmcm9tIHdhbGxldCwgd2hpY2ggYXQgdGhlIGVuZCBvZiB0aGUgY3Jvd2RzYWxlIHdpbGwgYWxsb3cgdGhlIG93bmVycyB0byBjbGFpbSB0aGUgdW5zb2xkIHRva2VucwoqIHRoZSBmdW5jdGlvbiBzdG9wVG9rZW4oKSBvbmx5IGNhbGxhYmxlIGZyb20gd2FsbGV0LCB3aGljaCBpbiBhbiBlbWVyZ2VuY3ksIHdpbGwgdHJpZ2dlciBhIGNvbXBsZXRlIGFuZCBpcnJlY292ZXJhYmxlIHNodXRkb3duIG9mIHRoZSB0b2tlbgoqIENvbnRyYWN0IHRva2VucyBhcmUgbG9ja2VkIHdoZW4gY3JlYXRlZCwgYW5kIG5vIHRva2VucyBpbmNsdWRpbmcgcHJlLW1pbmUgY2FuIGJlIG1vdmVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KKi8KCgovLyBFUkMyMCBUb2tlbiBTdGFuZGFyZCBJbnRlcmZhY2UKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCmNvbnRyYWN0IEVSQzIwIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBUb2tlbiBpcyBFUkMyMCB7CgogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJGdW5kWW91cnNlbGZOb3cgVG9rZW4iOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkZZTiI7CiAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7ICAvLyAxOCBpcyB0aGUgbW9zdCBjb21tb24gbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzCiAgdWludDI1NiBwdWJsaWMgdG9rZW5DYXAgPSAxMjUwMDAwMGUxODsgLy8gMTIuNSBtaWxsaW9uIEZZTiBjYXAgCgogIGFkZHJlc3MgcHVibGljIHdhbGxldEFkZHJlc3M7CiAgdWludDI1NiBwdWJsaWMgY3JlYXRpb25UaW1lOwogIGJvb2wgcHVibGljIHRyYW5zZmVyU3RvcDsKIAogIG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApIF9iYWxhbmNlczsKICBtYXBwaW5nKCBhZGRyZXNzID0+IG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApICkgX2FwcHJvdmFsczsKICB1aW50IF9zdXBwbHk7CgogIGV2ZW50IFRva2VuTWludChhZGRyZXNzIG5ld1Rva2VuSG9sZGVyLCB1aW50IGFtb3VudE9mVG9rZW5zKTsKICBldmVudCBUb2tlblN3YXBPdmVyKCk7CiAgZXZlbnQgRW1lcmdlbmN5U3RvcEFjdGl2YXRlZCgpOwoKICBtb2RpZmllciBvbmx5RnJvbVdhbGxldCB7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHdhbGxldEFkZHJlc3MpIHRocm93OwogICAgICBfOwogIH0KCiAgLy8gQ2hlY2sgaWYgdHJhbnNmZXIgc2hvdWxkIHN0b3AKICBtb2RpZmllciBjaGVja1RyYW5zZmVyU3RvcCB7CiAgICAgIGlmICh0cmFuc2ZlclN0b3AgPT0gdHJ1ZSkgdGhyb3c7CiAgICAgIF87CiAgfQogCgogIC8qKgogICAqCiAgICogRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAgKgogICAqIGh0dHA6Ly92ZXNzZW5lcy5jb20vdGhlLWVyYzIwLXNob3J0LWFkZHJlc3MtYXR0YWNrLWV4cGxhaW5lZC8KICAgKi8KCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGlmICghKG1zZy5kYXRhLmxlbmd0aCA9PSBzaXplICsgNCkpIHRocm93OwogICAgIF87CiAgIH0gCiAKICBmdW5jdGlvbiBUb2tlbiggdWludCBpbml0aWFsX2JhbGFuY2UsIGFkZHJlc3Mgd2FsbGV0LCB1aW50MjU2IGNyb3dkc2FsZVRpbWUpIHsKICAgIF9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRpYWxfYmFsYW5jZTsKICAgIF9zdXBwbHkgPSBpbml0aWFsX2JhbGFuY2U7CiAgICB3YWxsZXRBZGRyZXNzID0gd2FsbGV0OwogICAgY3JlYXRpb25UaW1lID0gY3Jvd2RzYWxlVGltZTsKICAgIHRyYW5zZmVyU3RvcCA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgc3VwcGx5KSB7CiAgICByZXR1cm4gX3N1cHBseTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBjb25zdGFudCByZXR1cm5zICh1aW50IHZhbHVlKSB7CiAgICByZXR1cm4gX2JhbGFuY2VzW3dob107CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IF9hbGxvd2FuY2UpIHsKICAgIHJldHVybiBfYXBwcm92YWxzW293bmVyXVtzcGVuZGVyXTsKICB9CgogIC8vIEEgaGVscGVyIHRvIG5vdGlmeSBpZiBvdmVyZmxvdyBvY2N1cnMKICBmdW5jdGlvbiBzYWZlVG9BZGQodWludCBhLCB1aW50IGIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIChhICsgYiA+PSBhICYmIGEgKyBiID49IGIpOwogIH0KICAKICAvLyBBIGhlbHBlciB0byBub3RpZnkgaWYgb3ZlcmZsb3cgb2NjdXJzIGZvciBtdWx0aXBsaWNhdGlvbgogIGZ1bmN0aW9uIHNhZmVUb011bHRpcGx5KHVpbnQgX2EsIHVpbnQgX2IpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIChfYiA9PSAwIHx8ICgoX2EgKiBfYikgLyBfYikgPT0gX2EpOwogIH0KCiAgLy8gQSBoZWxwZXIgdG8gbm90aWZ5IGlmIHVuZGVyZmxvdyBvY2N1cnMgZm9yIHN1YnRyYWN0aW9uCiAgZnVuY3Rpb24gc2FmZVRvU3ViKHVpbnQgYSwgdWludCBiKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiAoYSA+PSBiKTsKICB9CgoKICBmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgIGNoZWNrVHJhbnNmZXJTdG9wCiAgICBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKQogICAgcmV0dXJucyAoYm9vbCBvaykgewoKICAgIGlmICh0byA9PSB3YWxsZXRBZGRyZXNzKSB0aHJvdzsgLy8gUmVqZWN0IHRyYW5zZmVycyB0byB3YWxsZXQgKHdhbGxldCBjYW5ub3QgaW50ZXJhY3Qgd2l0aCB0b2tlbiBjb250cmFjdCkKICAgIGlmKCBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCB2YWx1ZSApIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIGlmKCAhc2FmZVRvQWRkKF9iYWxhbmNlc1t0b10sIHZhbHVlKSApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gdmFsdWU7CiAgICBfYmFsYW5jZXNbdG9dICs9IHZhbHVlOwogICAgVHJhbnNmZXIoIG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSApOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgIGNoZWNrVHJhbnNmZXJTdG9wCiAgICByZXR1cm5zIChib29sIG9rKSB7CgogICAgaWYgKHRvID09IHdhbGxldEFkZHJlc3MpIHRocm93OyAvLyBSZWplY3QgdHJhbnNmZXJzIHRvIHdhbGxldCAod2FsbGV0IGNhbm5vdCBpbnRlcmFjdCB3aXRoIHRva2VuIGNvbnRyYWN0KQoKICAgIC8vIGlmIHlvdSBkb24ndCBoYXZlIGVub3VnaCBiYWxhbmNlLCB0aHJvdwogICAgaWYoIF9iYWxhbmNlc1tmcm9tXSA8IHZhbHVlICkgewogICAgICAgIHRocm93OwogICAgfQogICAgLy8gaWYgeW91IGRvbid0IGhhdmUgYXBwcm92YWwsIHRocm93CiAgICBpZiggX2FwcHJvdmFsc1tmcm9tXVttc2cuc2VuZGVyXSA8IHZhbHVlICkgewogICAgICAgIHRocm93OwogICAgfQogICAgaWYoICFzYWZlVG9BZGQoX2JhbGFuY2VzW3RvXSwgdmFsdWUpICkgewogICAgICAgIHRocm93OwogICAgfQogICAgLy8gdHJhbnNmZXIgYW5kIHJldHVybiB0cnVlCiAgICBfYXBwcm92YWxzW2Zyb21dW21zZy5zZW5kZXJdIC09IHZhbHVlOwogICAgX2JhbGFuY2VzW2Zyb21dIC09IHZhbHVlOwogICAgX2JhbGFuY2VzW3RvXSArPSB2YWx1ZTsKICAgIFRyYW5zZmVyKCBmcm9tLCB0bywgdmFsdWUgKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpCiAgICBjaGVja1RyYW5zZmVyU3RvcAogICAgcmV0dXJucyAoYm9vbCBvaykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgLy8KICAgIC8vIE5vdGUgdGhhdCB0aGlzIGRvZXNuJ3QgcHJldmVudCBhdHRhY2tzOyB0aGUgdXNlciB3aWxsIGhhdmUgdG8gcGVyc29uYWxseQogICAgLy8gIGNoZWNrIHRvIGVuc3VyZSB0aGF0IHRoZSB0b2tlbiBjb3VudCBoYXMgbm90IGNoYW5nZWQsIGJlZm9yZSBpc3N1aW5nCiAgICAvLyAgYSBuZXcgYXBwcm92YWwuIEluY3JlbWVudC9kZWNyZW1lbnQgaXMgbm90IGNvbW1vbmx5IHNwZWMtZWQsIGFuZCAKICAgIC8vICBjaGFuZ2luZyB0byBhIGNoZWNrLW15LWFwcHJvdmFscy1iZWZvcmUtY2hhbmdpbmcgd291bGQgcmVxdWlyZSB1c2VyCiAgICAvLyAgdG8gZmluZCBvdXQgaGlzIGN1cnJlbnQgYXBwcm92YWwgZm9yIHNwZW5kZXIgYW5kIGNoYW5nZSBleHBlY3RlZAogICAgLy8gIGJlaGF2aW91ciBmb3IgRVJDMjAuCgoKICAgIGlmICgodmFsdWUhPTApICYmIChfYXBwcm92YWxzW21zZy5zZW5kZXJdW3NwZW5kZXJdICE9MCkpIHRocm93OwoKICAgIF9hcHByb3ZhbHNbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKCBtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSApOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLyBUaGUgZnVuY3Rpb24gY3VycmVudFN3YXBSYXRlKCkgcmV0dXJucyB0aGUgY3VycmVudCBleGNoYW5nZSByYXRlCiAgLy8gYmV0d2VlbiBGWU4gdG9rZW5zIGFuZCBFdGhlciBkdXJpbmcgdGhlIHRva2VuIHN3YXAgcGVyaW9kCiAgZnVuY3Rpb24gY3VycmVudFN3YXBSYXRlKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgIHVpbnQgcHJlc2FsZVBlcmlvZCA9IDMgZGF5czsKICAgICAgaWYgKGNyZWF0aW9uVGltZSArIHByZXNhbGVQZXJpb2QgPiBub3cpIHsKICAgICAgICAgIHJldHVybiAxNDA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY3JlYXRpb25UaW1lICsgcHJlc2FsZVBlcmlvZCArIDMgd2Vla3MgPiBub3cpIHsKICAgICAgICAgIHJldHVybiAxMjA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY3JlYXRpb25UaW1lICsgcHJlc2FsZVBlcmlvZCArIDYgd2Vla3MgKyA2IGRheXMgKyAzIGhvdXJzICsgMSBkYXlzID4gbm93KSB7IAogICAgICAgICAgLy8gMSBkYXkgYnVmZmVyIHRvIGFsbG93IG9uZSBmaW5hbCB0cmFuc2FjdGlvbiBmcm9tIGFueW9uZSB0byBjbG9zZSBldmVyeXRoaW5nCiAgICAgICAgICAvLyBvdGhlcndpc2Ugd2FsbGV0IHdpbGwgcmVjZWl2ZSBldGhlciBidXQgc2VuZCAwIHRva2VucwogICAgICAgICAgLy8gd2UgY2Fubm90IHRocm93IGFzIHdlIHdpbGwgbG9zZSB0aGUgc3RhdGUgY2hhbmdlIHRvIHN0YXJ0IHN3YXBwYWJpbGl0eSBvZiB0b2tlbnMgCiAgICAgICAgICByZXR1cm4gMTAwOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICB9CgogIC8vIFRoZSBmdW5jdGlvbiBtaW50VG9rZW5zIGlzIG9ubHkgdXNhYmxlIGJ5IHRoZSBjaG9zZW4gd2FsbGV0CiAgLy8gY29udHJhY3QgdG8gbWludCBhIG51bWJlciBvZiB0b2tlbnMgcHJvcG9ydGlvbmFsIHRvIHRoZQogIC8vIGFtb3VudCBvZiBldGhlciBzZW50IHRvIHRoZSB3YWxsZXQgY29udHJhY3QuIFRoZSBmdW5jdGlvbgogIC8vIGNhbiBvbmx5IGJlIGNhbGxlZCBkdXJpbmcgdGhlIHRva2Vuc3dhcCBwZXJpb2QKICBmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3MgbmV3VG9rZW5Ib2xkZXIsIHVpbnQgZXRoZXJBbW91bnQpCiAgICBleHRlcm5hbAogICAgb25seUZyb21XYWxsZXQgewogICAgICAgIGlmICghc2FmZVRvTXVsdGlwbHkoY3VycmVudFN3YXBSYXRlKCksIGV0aGVyQW1vdW50KSkgdGhyb3c7CiAgICAgICAgdWludCB0b2tlbnNBbW91bnQgPSBjdXJyZW50U3dhcFJhdGUoKSAqIGV0aGVyQW1vdW50OwoKICAgICAgICBpZighc2FmZVRvQWRkKF9iYWxhbmNlc1tuZXdUb2tlbkhvbGRlcl0sdG9rZW5zQW1vdW50ICkpIHRocm93OwogICAgICAgIGlmKCFzYWZlVG9BZGQoX3N1cHBseSx0b2tlbnNBbW91bnQpKSB0aHJvdzsKCiAgICAgICAgaWYgKChfc3VwcGx5ICsgdG9rZW5zQW1vdW50KSA+IHRva2VuQ2FwKSB0aHJvdzsKCiAgICAgICAgX2JhbGFuY2VzW25ld1Rva2VuSG9sZGVyXSArPSB0b2tlbnNBbW91bnQ7CiAgICAgICAgX3N1cHBseSArPSB0b2tlbnNBbW91bnQ7CgogICAgICAgIFRva2VuTWludChuZXdUb2tlbkhvbGRlciwgdG9rZW5zQW1vdW50KTsKICB9CgogIGZ1bmN0aW9uIG1pbnRSZXNlcnZlKGFkZHJlc3MgYmVuZWZpY2lhcnkpIAogICAgZXh0ZXJuYWwKICAgIG9ubHlGcm9tV2FsbGV0IHsKICAgICAgICBpZiAodG9rZW5DYXAgPD0gX3N1cHBseSkgdGhyb3c7CiAgICAgICAgaWYoIXNhZmVUb1N1Yih0b2tlbkNhcCxfc3VwcGx5KSkgdGhyb3c7CiAgICAgICAgdWludCB0b2tlbnNBbW91bnQgPSB0b2tlbkNhcCAtIF9zdXBwbHk7CgogICAgICAgIGlmKCFzYWZlVG9BZGQoX2JhbGFuY2VzW2JlbmVmaWNpYXJ5XSwgdG9rZW5zQW1vdW50ICkpIHRocm93OwogICAgICAgIGlmKCFzYWZlVG9BZGQoX3N1cHBseSx0b2tlbnNBbW91bnQpKSB0aHJvdzsKCiAgICAgICAgX2JhbGFuY2VzW2JlbmVmaWNpYXJ5XSArPSB0b2tlbnNBbW91bnQ7CiAgICAgICAgX3N1cHBseSArPSB0b2tlbnNBbW91bnQ7CiAgICAgICAgCiAgICAgICAgVG9rZW5NaW50KGJlbmVmaWNpYXJ5LCB0b2tlbnNBbW91bnQpOwogIH0KCiAgLy8gVGhlIGZ1bmN0aW9uIGRpc2FibGVUb2tlblN3YXBMb2NrKCkgaXMgY2FsbGVkIGJ5IHRoZSB3YWxsZXQKICAvLyBjb250cmFjdCBvbmNlIHRoZSB0b2tlbiBzd2FwIGhhcyByZWFjaGVkIGl0cyBlbmQgY29uZGl0aW9ucwogIGZ1bmN0aW9uIGRpc2FibGVUb2tlblN3YXBMb2NrKCkKICAgIGV4dGVybmFsCiAgICBvbmx5RnJvbVdhbGxldCB7CiAgICAgICAgdHJhbnNmZXJTdG9wID0gZmFsc2U7CiAgICAgICAgVG9rZW5Td2FwT3ZlcigpOwogIH0KCiAgLy8gT25jZSBhY3RpdmF0ZWQsIGEgbmV3IHRva2VuIGNvbnRyYWN0IHdpbGwgbmVlZCB0byBiZSBjcmVhdGVkLCBtaXJyb3JpbmcgdGhlIGN1cnJlbnQgdG9rZW4gaG9sZGluZ3MuIAogIGZ1bmN0aW9uIHN0b3BUb2tlbigpIG9ubHlGcm9tV2FsbGV0IHsKICAgIHRyYW5zZmVyU3RvcCA9IHRydWU7CiAgICBFbWVyZ2VuY3lTdG9wQWN0aXZhdGVkKCk7CiAgfQp9CgoKLyoKVGhlIHN0YW5kYXJkIFdhbGxldCBjb250cmFjdCwgcmV0cmlldmFibGUgYXQKaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2RhcHAtYmluL2Jsb2IvbWFzdGVyL3dhbGxldC93YWxsZXQuc29sIGhhcyBiZWVuCm1vZGlmaWVkIHRvIGluY2x1ZGUgYWRkaXRpb25hbCBmdW5jdGlvbmFsaXR5LCBpbiBwYXJ0aWN1bGFyOgoqIEFuIGFkZGl0aW9uYWwgcGFyZW50IG9mIHdhbGxldCBjb250cmFjdCBjYWxsZWQgdG9rZW5zd2FwLCBpbXBsZW1lbnRpbmcgYWxtb3N0CmFsbCB0aGUgY2hhbmdlczoKICAgIC0gRnVuY3Rpb25zIGZvciBzdGFydGluZyBhbmQgc3RvcHBpbmcgdGhlIHRva2Vuc3dhcAogICAgLSBBIHNldC1vbmx5LW9uY2UgZnVuY3Rpb24gZm9yIHRoZSB0b2tlbiBjb250cmFjdAogICAgLSBidXlUb2tlbnMoKSwgd2hpY2ggY2FsbHMgbWludFRva2VucygpIGluIHRoZSB0b2tlbiBjb250cmFjdAogICAgLSBNb2RpZmllcnMgZm9yIGVuZm9yY2luZyB0b2tlbnN3YXAgdGltZSBsaW1pdHMsIG1heCBldGhlciBjYXAsIGFuZCBtYXggdG9rZW4gY2FwCiAgICAtIHdpdGhkcmF3RXRoZXIoKSwgZm9yIHdpdGhkcmF3aW5nIHVuc29sZCB0b2tlbnMgYWZ0ZXIgdGltZSBjYXAKKiB0aGUgd2FsbGV0IGZhbGxiYWNrIGZ1bmN0aW9uIGNhbGxzIHRoZSBidXlUb2tlbnMgZnVuY3Rpb24KKiB0aGUgd2FsbGV0IGNvbnRyYWN0IGNhbm5vdCBzZWxmZGVzdHJ1Y3QgZHVyaW5nIHRoZSB0b2tlbnN3YXAKKi8KCmNvbnRyYWN0IG11bHRpb3duZWQgewoKCS8vIFRZUEVTCgogICAgLy8gc3RydWN0IGZvciB0aGUgc3RhdHVzIG9mIGEgcGVuZGluZyBvcGVyYXRpb24uCiAgICBzdHJ1Y3QgUGVuZGluZ1N0YXRlIHsKICAgICAgICB1aW50IHlldE5lZWRlZDsKICAgICAgICB1aW50IG93bmVyc0RvbmU7CiAgICAgICAgdWludCBpbmRleDsKICAgIH0KCgkvLyBFVkVOVFMKCiAgICAvLyB0aGlzIGNvbnRyYWN0IG9ubHkgaGFzIHNpeCB0eXBlcyBvZiBldmVudHM6IGl0IGNhbiBhY2NlcHQgYSBjb25maXJtYXRpb24sIGluIHdoaWNoIGNhc2UKICAgIC8vIHdlIHJlY29yZCBvd25lciBhbmQgb3BlcmF0aW9uIChoYXNoKSBhbG9uZ3NpZGUgaXQuCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIC8vIHNvbWUgb3RoZXJzIGFyZSBpbiB0aGUgY2FzZSBvZiBhbiBvd25lciBjaGFuZ2luZy4KICAgIGV2ZW50IE93bmVyQ2hhbmdlZChhZGRyZXNzIG9sZE93bmVyLCBhZGRyZXNzIG5ld093bmVyKTsKICAgIGV2ZW50IE93bmVyQWRkZWQoYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lclJlbW92ZWQoYWRkcmVzcyBvbGRPd25lcik7CiAgICAvLyB0aGUgbGFzdCBvbmUgaXMgZW1pdHRlZCBpZiB0aGUgcmVxdWlyZWQgc2lnbmF0dXJlcyBjaGFuZ2UKICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlZCh1aW50IG5ld1JlcXVpcmVtZW50KTsKCgkvLyBNT0RJRklFUlMKCiAgICAvLyBzaW1wbGUgc2luZ2xlLXNpZyBmdW5jdGlvbiBtb2RpZmllci4KICAgIG1vZGlmaWVyIG9ubHlvd25lciB7CiAgICAgICAgaWYgKGlzT3duZXIobXNnLnNlbmRlcikpCiAgICAgICAgICAgIF87CiAgICB9CiAgICAvLyBtdWx0aS1zaWcgZnVuY3Rpb24gbW9kaWZpZXI6IHRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQKICAgIC8vIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgIG1vZGlmaWVyIG9ubHltYW55b3duZXJzKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpCiAgICAgICAgICAgIF87CiAgICB9CgoJLy8gTUVUSE9EUwoKICAgIC8vIGNvbnN0cnVjdG9yIGlzIGdpdmVuIG51bWJlciBvZiBzaWdzIHJlcXVpcmVkIHRvIGRvIHByb3RlY3RlZCAib25seW1hbnlvd25lcnMiIHRyYW5zYWN0aW9ucwogICAgLy8gYXMgd2VsbCBhcyB0aGUgc2VsZWN0aW9uIG9mIGFkZHJlc3NlcyBjYXBhYmxlIG9mIGNvbmZpcm1pbmcgdGhlbS4KICAgIGZ1bmN0aW9uIG11bHRpb3duZWQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkKSB7CiAgICAgICAgbV9udW1Pd25lcnMgPSBfb3duZXJzLmxlbmd0aCArIDE7CiAgICAgICAgbV9vd25lcnNbMV0gPSB1aW50KG1zZy5zZW5kZXIpOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KG1zZy5zZW5kZXIpXSA9IDE7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7ICsraSkKICAgICAgICB7CiAgICAgICAgICAgIG1fb3duZXJzWzIgKyBpXSA9IHVpbnQoX293bmVyc1tpXSk7CiAgICAgICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcnNbaV0pXSA9IDIgKyBpOwogICAgICAgIH0KICAgICAgICBtX3JlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgfQoKICAgIC8vIFJldm9rZXMgYSBwcmlvciBjb25maXJtYXRpb24gb2YgdGhlIGdpdmVuIG9wZXJhdGlvbgogICAgZnVuY3Rpb24gcmV2b2tlKGJ5dGVzMzIgX29wZXJhdGlvbikgZXh0ZXJuYWwgewogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IG1fb3duZXJJbmRleFt1aW50KG1zZy5zZW5kZXIpXTsKICAgICAgICAvLyBtYWtlIHN1cmUgdGhleSdyZSBhbiBvd25lcgogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsKICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKipvd25lckluZGV4OwogICAgICAgIHZhciBwZW5kaW5nID0gbV9wZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgIGlmIChwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID4gMCkgewogICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCsrOwogICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgLT0gb3duZXJJbmRleEJpdDsKICAgICAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBSZXBsYWNlcyBhbiBvd25lciBgX2Zyb21gIHdpdGggYW5vdGhlciBgX3RvYC4KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgewogICAgICAgIGlmIChpc093bmVyKF90bykpIHJldHVybjsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChfZnJvbSldOwogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSB1aW50KF90byk7CiAgICAgICAgbV9vd25lckluZGV4W3VpbnQoX2Zyb20pXSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W3VpbnQoX3RvKV0gPSBvd25lckluZGV4OwogICAgICAgIE93bmVyQ2hhbmdlZChfZnJvbSwgX3RvKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIF9vd25lcikgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICBpZiAoaXNPd25lcihfb3duZXIpKSByZXR1cm47CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIGlmIChtX251bU93bmVycyA+PSBjX21heE93bmVycykKICAgICAgICAgICAgcmVvcmdhbml6ZU93bmVycygpOwogICAgICAgIGlmIChtX251bU93bmVycyA+PSBjX21heE93bmVycykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIG1fbnVtT3duZXJzKys7CiAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gdWludChfb3duZXIpOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcildID0gbV9udW1Pd25lcnM7CiAgICAgICAgT3duZXJBZGRlZChfb3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3MgX293bmVyKSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgewogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IG1fb3duZXJJbmRleFt1aW50KF9vd25lcildOwogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsKICAgICAgICBpZiAobV9yZXF1aXJlZCA+IG1fbnVtT3duZXJzIC0gMSkgcmV0dXJuOwoKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W3VpbnQoX293bmVyKV0gPSAwOwogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIHJlb3JnYW5pemVPd25lcnMoKTsgLy9tYWtlIHN1cmUgbV9udW1Pd25lciBpcyBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIG93bmVycyBhbmQgYWx3YXlzIHBvaW50cyB0byB0aGUgb3B0aW1hbCBmcmVlIHNsb3QKICAgICAgICBPd25lclJlbW92ZWQoX293bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9uZXdSZXF1aXJlZCkgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICBpZiAoX25ld1JlcXVpcmVkID4gbV9udW1Pd25lcnMpIHJldHVybjsKICAgICAgICBtX3JlcXVpcmVkID0gX25ld1JlcXVpcmVkOwogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlZChfbmV3UmVxdWlyZWQpOwogICAgfQoKICAgIC8vIEdldHMgYW4gb3duZXIgYnkgMC1pbmRleGVkIHBvc2l0aW9uICh1c2luZyBudW1Pd25lcnMgYXMgdGhlIGNvdW50KQogICAgZnVuY3Rpb24gZ2V0T3duZXIodWludCBvd25lckluZGV4KSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MobV9vd25lcnNbb3duZXJJbmRleCArIDFdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FkZHIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbV9vd25lckluZGV4W3VpbnQoX2FkZHIpXSA+IDA7CiAgICB9CgogICAgZnVuY3Rpb24gaGFzQ29uZmlybWVkKGJ5dGVzMzIgX29wZXJhdGlvbiwgYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChfb3duZXIpXTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZXkncmUgYW4gb3duZXIKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGRldGVybWluZSB0aGUgYml0IHRvIHNldCBmb3IgdGhpcyBvd25lci4KICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKipvd25lckluZGV4OwogICAgICAgIHJldHVybiAhKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPT0gMCk7CiAgICB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGNvbmZpcm1BbmRDaGVjayhieXRlczMyIF9vcGVyYXRpb24pIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hhdCBpbmRleCB0aGUgcHJlc2VudCBzZW5kZXIgaXM6CiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQobXNnLnNlbmRlcildOwogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGV5J3JlIGFuIG93bmVyCiAgICAgICAgaWYgKG93bmVySW5kZXggPT0gMCkgcmV0dXJuOwoKICAgICAgICB2YXIgcGVuZGluZyA9IG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICAvLyBpZiB3ZSdyZSBub3QgeWV0IHdvcmtpbmcgb24gdGhpcyBvcGVyYXRpb24sIHN3aXRjaCBvdmVyIGFuZCByZXNldCB0aGUgY29uZmlybWF0aW9uIHN0YXR1cy4KICAgICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPT0gMCkgewogICAgICAgICAgICAvLyByZXNldCBjb3VudCBvZiBjb25maXJtYXRpb25zIG5lZWRlZC4KICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQgPSBtX3JlcXVpcmVkOwogICAgICAgICAgICAvLyByZXNldCB3aGljaCBvd25lcnMgaGF2ZSBjb25maXJtZWQgKG5vbmUpIC0gc2V0IG91ciBiaXRtYXAgdG8gMC4KICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lID0gMDsKICAgICAgICAgICAgcGVuZGluZy5pbmRleCA9IG1fcGVuZGluZ0luZGV4Lmxlbmd0aCsrOwogICAgICAgICAgICBtX3BlbmRpbmdJbmRleFtwZW5kaW5nLmluZGV4XSA9IF9vcGVyYXRpb247CiAgICAgICAgfQogICAgICAgIC8vIGRldGVybWluZSB0aGUgYml0IHRvIHNldCBmb3IgdGhpcyBvd25lci4KICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSAyKipvd25lckluZGV4OwogICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSAodGhlIG1lc3NhZ2Ugc2VuZGVyKSBoYXZlbid0IGNvbmZpcm1lZCB0aGlzIG9wZXJhdGlvbiBwcmV2aW91c2x5LgogICAgICAgIGlmIChwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID09IDApIHsKICAgICAgICAgICAgQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgICAgICAgICAvLyBvayAtIGNoZWNrIGlmIGNvdW50IGlzIGVub3VnaCB0byBnbyBhaGVhZC4KICAgICAgICAgICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkIDw9IDEpIHsKICAgICAgICAgICAgICAgIC8vIGVub3VnaCBjb25maXJtYXRpb25zOiByZXNldCBhbmQgcnVuIGludGVyaW9yLgogICAgICAgICAgICAgICAgZGVsZXRlIG1fcGVuZGluZ0luZGV4W21fcGVuZGluZ1tfb3BlcmF0aW9uXS5pbmRleF07CiAgICAgICAgICAgICAgICBkZWxldGUgbV9wZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBub3QgZW5vdWdoOiByZWNvcmQgdGhhdCB0aGlzIG93bmVyIGluIHBhcnRpY3VsYXIgY29uZmlybWVkLgogICAgICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQtLTsKICAgICAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSB8PSBvd25lckluZGV4Qml0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlb3JnYW5pemVPd25lcnMoKSBwcml2YXRlIHsKICAgICAgICB1aW50IGZyZWUgPSAxOwogICAgICAgIHdoaWxlIChmcmVlIDwgbV9udW1Pd25lcnMpCiAgICAgICAgewogICAgICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW2ZyZWVdICE9IDApIGZyZWUrKzsKICAgICAgICAgICAgd2hpbGUgKG1fbnVtT3duZXJzID4gMSAmJiBtX293bmVyc1ttX251bU93bmVyc10gPT0gMCkgbV9udW1Pd25lcnMtLTsKICAgICAgICAgICAgaWYgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1ttX251bU93bmVyc10gIT0gMCAmJiBtX293bmVyc1tmcmVlXSA9PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtX293bmVyc1tmcmVlXSA9IG1fb3duZXJzW21fbnVtT3duZXJzXTsKICAgICAgICAgICAgICAgIG1fb3duZXJJbmRleFttX293bmVyc1tmcmVlXV0gPSBmcmVlOwogICAgICAgICAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbGVhclBlbmRpbmcoKSBpbnRlcm5hbCB7CiAgICAgICAgdWludCBsZW5ndGggPSBtX3BlbmRpbmdJbmRleC5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpCiAgICAgICAgICAgIGlmIChtX3BlbmRpbmdJbmRleFtpXSAhPSAwKQogICAgICAgICAgICAgICAgZGVsZXRlIG1fcGVuZGluZ1ttX3BlbmRpbmdJbmRleFtpXV07CiAgICAgICAgZGVsZXRlIG1fcGVuZGluZ0luZGV4OwogICAgfQoKICAgCS8vIEZJRUxEUwoKICAgIC8vIHRoZSBudW1iZXIgb2Ygb3duZXJzIHRoYXQgbXVzdCBjb25maXJtIHRoZSBzYW1lIG9wZXJhdGlvbiBiZWZvcmUgaXQgaXMgcnVuLgogICAgdWludCBwdWJsaWMgbV9yZXF1aXJlZDsKICAgIC8vIHBvaW50ZXIgdXNlZCB0byBmaW5kIGEgZnJlZSBzbG90IGluIG1fb3duZXJzCiAgICB1aW50IHB1YmxpYyBtX251bU93bmVyczsKCiAgICAvLyBsaXN0IG9mIG93bmVycwogICAgdWludFsyNTZdIG1fb3duZXJzOwogICAgdWludCBjb25zdGFudCBjX21heE93bmVycyA9IDI1MDsKICAgIC8vIGluZGV4IG9uIHRoZSBsaXN0IG9mIG93bmVycyB0byBhbGxvdyByZXZlcnNlIGxvb2t1cAogICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIG1fb3duZXJJbmRleDsKICAgIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gUGVuZGluZ1N0YXRlKSBtX3BlbmRpbmc7CiAgICBieXRlczMyW10gbV9wZW5kaW5nSW5kZXg7Cn0KCi8vIGluaGVyaXRhYmxlICJwcm9wZXJ0eSIgY29udHJhY3QgdGhhdCBlbmFibGVzIG1ldGhvZHMgdG8gYmUgcHJvdGVjdGVkIGJ5IHBsYWNpbmcgYSBsaW5lYXIgbGltaXQgKHNwZWNpZmlhYmxlKQovLyBvbiBhIHBhcnRpY3VsYXIgcmVzb3VyY2UgcGVyIGNhbGVuZGFyIGRheS4gaXMgbXVsdGlvd25lZCB0byBhbGxvdyB0aGUgbGltaXQgdG8gYmUgYWx0ZXJlZC4gcmVzb3VyY2UgdGhhdCBtZXRob2QKLy8gdXNlcyBpcyBzcGVjaWZpZWQgaW4gdGhlIG1vZGlmaWVyLgpjb250cmFjdCBkYXlsaW1pdCBpcyBtdWx0aW93bmVkIHsKCgkvLyBNT0RJRklFUlMKCiAgICAvLyBzaW1wbGUgbW9kaWZpZXIgZm9yIGRhaWx5IGxpbWl0LgogICAgbW9kaWZpZXIgbGltaXRlZERhaWx5KHVpbnQgX3ZhbHVlKSB7CiAgICAgICAgaWYgKHVuZGVyTGltaXQoX3ZhbHVlKSkKICAgICAgICAgICAgXzsKICAgIH0KCgkvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgLSBzdG9yZXMgaW5pdGlhbCBkYWlseSBsaW1pdCBhbmQgcmVjb3JkcyB0aGUgcHJlc2VudCBkYXkncyBpbmRleC4KICAgIGZ1bmN0aW9uIGRheWxpbWl0KHVpbnQgX2xpbWl0KSB7CiAgICAgICAgbV9kYWlseUxpbWl0ID0gX2xpbWl0OwogICAgICAgIG1fbGFzdERheSA9IHRvZGF5KCk7CiAgICB9CiAgICAvLyAocmUpc2V0cyB0aGUgZGFpbHkgbGltaXQuIG5lZWRzIG1hbnkgb2YgdGhlIG93bmVycyB0byBjb25maXJtLiBkb2Vzbid0IGFsdGVyIHRoZSBhbW91bnQgYWxyZWFkeSBzcGVudCB0b2RheS4KICAgIGZ1bmN0aW9uIHNldERhaWx5TGltaXQodWludCBfbmV3TGltaXQpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICAgbV9kYWlseUxpbWl0ID0gX25ld0xpbWl0OwogICAgfQogICAgLy8gcmVzZXRzIHRoZSBhbW91bnQgYWxyZWFkeSBzcGVudCB0b2RheS4gbmVlZHMgbWFueSBvZiB0aGUgb3duZXJzIHRvIGNvbmZpcm0uCiAgICBmdW5jdGlvbiByZXNldFNwZW50VG9kYXkoKSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgewogICAgICAgIG1fc3BlbnRUb2RheSA9IDA7CiAgICB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIC8vIGNoZWNrcyB0byBzZWUgaWYgdGhlcmUgaXMgYXQgbGVhc3QgYF92YWx1ZWAgbGVmdCBmcm9tIHRoZSBkYWlseSBsaW1pdCB0b2RheS4gaWYgdGhlcmUgaXMsIHN1YnRyYWN0cyBpdCBhbmQKICAgIC8vIHJldHVybnMgdHJ1ZS4gb3RoZXJ3aXNlIGp1c3QgcmV0dXJucyBmYWxzZS4KICAgIGZ1bmN0aW9uIHVuZGVyTGltaXQodWludCBfdmFsdWUpIGludGVybmFsIG9ubHlvd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gcmVzZXQgdGhlIHNwZW5kIGxpbWl0IGlmIHdlJ3JlIG9uIGEgZGlmZmVyZW50IGRheSB0byBsYXN0IHRpbWUuCiAgICAgICAgaWYgKHRvZGF5KCkgPiBtX2xhc3REYXkpIHsKICAgICAgICAgICAgbV9zcGVudFRvZGF5ID0gMDsKICAgICAgICAgICAgbV9sYXN0RGF5ID0gdG9kYXkoKTsKICAgICAgICB9CiAgICAgICAgLy8gY2hlY2sgaWYgaXQncyBzZW5kaW5nIG5vdGhpbmcgKHdpdGggb3Igd2l0aG91dCBkYXRhKS4gVGhpcyBuZWVkcyBNdWx0aXRyYW5zYWN0CiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGVub3VnaCBsZWZ0IC0gaWYgc28sIHN1YnRyYWN0IGFuZCByZXR1cm4gdHJ1ZS4KICAgICAgICAvLyBvdmVyZmxvdyBwcm90ZWN0aW9uICAgICAgICAgICAgICAgICAgICAvLyBkYWlseUxpbWl0IGNoZWNrCiAgICAgICAgaWYgKG1fc3BlbnRUb2RheSArIF92YWx1ZSA+PSBtX3NwZW50VG9kYXkgJiYgbV9zcGVudFRvZGF5ICsgX3ZhbHVlIDw9IG1fZGFpbHlMaW1pdCkgewogICAgICAgICAgICBtX3NwZW50VG9kYXkgKz0gX3ZhbHVlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gZGV0ZXJtaW5lcyB0b2RheSdzIGluZGV4LgogICAgZnVuY3Rpb24gdG9kYXkoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIG5vdyAvIDEgZGF5czsgfQoKCS8vIEZJRUxEUwoKICAgIHVpbnQgcHVibGljIG1fZGFpbHlMaW1pdDsKICAgIHVpbnQgcHVibGljIG1fc3BlbnRUb2RheTsKICAgIHVpbnQgcHVibGljIG1fbGFzdERheTsKfQoKLy8gaW50ZXJmYWNlIGNvbnRyYWN0IGZvciBtdWx0aXNpZyBwcm94eSBjb250cmFjdHM7IHNlZSBiZWxvdyBmb3IgZG9jcy4KY29udHJhY3QgbXVsdGlzaWcgewoKCS8vIEVWRU5UUwoKICAgIC8vIGxvZ2dlZCBldmVudHM6CiAgICAvLyBGdW5kcyBoYXMgYXJyaXZlZCBpbnRvIHRoZSB3YWxsZXQgKHJlY29yZCBob3cgbXVjaCkuCiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgX2Zyb20sIHVpbnQgdmFsdWUpOwogICAgLy8gU2luZ2xlIHRyYW5zYWN0aW9uIGdvaW5nIG91dCBvZiB0aGUgd2FsbGV0IChyZWNvcmQgd2hvIHNpZ25lZCBmb3IgaXQsIGhvdyBtdWNoLCBhbmQgdG8gd2hvbSBpdCdzIGdvaW5nKS4KICAgIGV2ZW50IFNpbmdsZVRyYW5zYWN0KGFkZHJlc3Mgb3duZXIsIHVpbnQgdmFsdWUsIGFkZHJlc3MgdG8sIGJ5dGVzIGRhdGEpOwogICAgLy8gTXVsdGktc2lnIHRyYW5zYWN0aW9uIGdvaW5nIG91dCBvZiB0aGUgd2FsbGV0IChyZWNvcmQgd2hvIHNpZ25lZCBmb3IgaXQgbGFzdCwgdGhlIG9wZXJhdGlvbiBoYXNoLCBob3cgbXVjaCwgYW5kIHRvIHdob20gaXQncyBnb2luZykuCiAgICBldmVudCBNdWx0aVRyYW5zYWN0KGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uLCB1aW50IHZhbHVlLCBhZGRyZXNzIHRvLCBieXRlcyBkYXRhKTsKICAgIC8vIENvbmZpcm1hdGlvbiBzdGlsbCBuZWVkZWQgZm9yIGEgdHJhbnNhY3Rpb24uCiAgICBldmVudCBDb25maXJtYXRpb25OZWVkZWQoYnl0ZXMzMiBvcGVyYXRpb24sIGFkZHJlc3MgaW5pdGlhdG9yLCB1aW50IHZhbHVlLCBhZGRyZXNzIHRvLCBieXRlcyBkYXRhKTsKCiAgICAvLyBGVU5DVElPTlMKCiAgICAvLyBUT0RPOiBkb2N1bWVudAogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIGV4dGVybmFsOwogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBleHRlcm5hbCByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGNvbmZpcm0oYnl0ZXMzMiBfaCkgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IHRva2Vuc3dhcCBpcyBtdWx0aXNpZywgbXVsdGlvd25lZCB7CiAgICBUb2tlbiBwdWJsaWMgdG9rZW5DdHI7CiAgICBib29sIHB1YmxpYyB0b2tlblN3YXA7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBQUkVTQUxFX0xFTkdUSCA9IDMgZGF5czsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFNXQVBfTEVOR1RIID0gUFJFU0FMRV9MRU5HVEggKyA2IHdlZWtzICsgNiBkYXlzICsgMyBob3VyczsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9FVEggPSA3NTAwMCBldGhlcjsgLy8gSGFyZCBjYXAsIGNhcHBlZCBvdGhlcndpc2UgYnkgdG90YWwgdG9rZW5zIHNvbGQgKG1heCA3LjVNIEZZTikKICAgIHVpbnQgcHVibGljIGFtb3VudFJhaXNlZDsKCiAgICBtb2RpZmllciBpc1VuZGVyUHJlc2FsZU1pbmltdW0gewogICAgICAgIGlmICh0b2tlbkN0ci5jcmVhdGlvblRpbWUoKSArIFBSRVNBTEVfTEVOR1RIID4gbm93KSB7CiAgICAgICAgICAgIGlmIChtc2cudmFsdWUgPCAyMCBldGhlcikgdGhyb3c7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNaZXJvVmFsdWUgewogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc092ZXJDYXAgewogICAgCWlmIChhbW91bnRSYWlzZWQgKyBtc2cudmFsdWUgPiBNQVhfRVRIKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzT3ZlclRva2VuQ2FwIHsKICAgICAgICBpZiAoIXNhZmVUb011bHRpcGx5KHRva2VuQ3RyLmN1cnJlbnRTd2FwUmF0ZSgpLCBtc2cudmFsdWUpKSB0aHJvdzsKICAgICAgICB1aW50IHRva2Vuc0Ftb3VudCA9IHRva2VuQ3RyLmN1cnJlbnRTd2FwUmF0ZSgpICogbXNnLnZhbHVlOwogICAgICAgIGlmKCFzYWZlVG9BZGQodG9rZW5DdHIudG90YWxTdXBwbHkoKSx0b2tlbnNBbW91bnQpKSB0aHJvdzsKICAgICAgICBpZiAodG9rZW5DdHIudG90YWxTdXBwbHkoKSArIHRva2Vuc0Ftb3VudCA+IHRva2VuQ3RyLnRva2VuQ2FwKCkpIHRocm93OwogICAgICAgIF87CgogICAgfQoKICAgIG1vZGlmaWVyIGlzU3dhcFN0b3BwZWQgewogICAgICAgIGlmICghdG9rZW5Td2FwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGFyZUNvbmRpdGlvbnNTYXRpc2ZpZWQgewogICAgICAgIF87CiAgICAgICAgLy8gRW5kIHRva2VuIHN3YXAgaWYgc2FsZSBwZXJpb2QgZW5kZWQKICAgICAgICAvLyBXZSBjYW4ndCB0aHJvdyB0byByZXZlcnNlIHRoZSBhbW91bnQgc2VudCBpbiBvciB3ZSB3aWxsIGxvc2Ugc3RhdGUKICAgICAgICAvLyAsIHNvIHdlIHdpbGwgYWNjZXB0IGl0IGV2ZW4gdGhvdWdoIGlmIGl0IGlzIGFmdGVyIGNyb3dkc2FsZQogICAgICAgIGlmICh0b2tlbkN0ci5jcmVhdGlvblRpbWUoKSArIFNXQVBfTEVOR1RIIDwgbm93KSB7CiAgICAgICAgICAgIHRva2VuQ3RyLmRpc2FibGVUb2tlblN3YXBMb2NrKCk7CiAgICAgICAgICAgIHRva2VuU3dhcCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBDaGVjayBpZiBjYXAgaGFzIGJlZW4gcmVhY2hlZCBpbiB0aGlzIHR4CiAgICAgICAgaWYgKGFtb3VudFJhaXNlZCA9PSBNQVhfRVRIKSB7CiAgICAgICAgICAgIHRva2VuQ3RyLmRpc2FibGVUb2tlblN3YXBMb2NrKCk7CiAgICAgICAgICAgIHRva2VuU3dhcCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgaWYgdG9rZW4gY2FwIGhhcyBiZWVuIHJlYWNoIGluIHRoaXMgdHgKICAgICAgICBpZiAodG9rZW5DdHIudG90YWxTdXBwbHkoKSA9PSB0b2tlbkN0ci50b2tlbkNhcCgpKSB7CiAgICAgICAgICAgIHRva2VuQ3RyLmRpc2FibGVUb2tlblN3YXBMb2NrKCk7CiAgICAgICAgICAgIHRva2VuU3dhcCA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBBIGhlbHBlciB0byBub3RpZnkgaWYgb3ZlcmZsb3cgb2NjdXJzIGZvciBhZGRpdGlvbgogICAgZnVuY3Rpb24gc2FmZVRvQWRkKHVpbnQgYSwgdWludCBiKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIChhICsgYiA+PSBhICYmIGEgKyBiID49IGIpOwogICAgfQogIAogICAgLy8gQSBoZWxwZXIgdG8gbm90aWZ5IGlmIG92ZXJmbG93IG9jY3VycyBmb3IgbXVsdGlwbGljYXRpb24KICAgIGZ1bmN0aW9uIHNhZmVUb011bHRpcGx5KHVpbnQgX2EsIHVpbnQgX2IpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICByZXR1cm4gKF9iID09IDAgfHwgKChfYSAqIF9iKSAvIF9iKSA9PSBfYSk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHN0YXJ0VG9rZW5Td2FwKCkgb25seW93bmVyIHsKICAgICAgICB0b2tlblN3YXAgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3BUb2tlblN3YXAoKSBvbmx5b3duZXIgewogICAgICAgIHRva2VuU3dhcCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuQ29udHJhY3QoYWRkcmVzcyBuZXdUb2tlbkNvbnRyYWN0QWRkcikgb25seW93bmVyIHsKICAgICAgICBpZiAobmV3VG9rZW5Db250cmFjdEFkZHIgPT0gYWRkcmVzcygweDApKSB0aHJvdzsKICAgICAgICAvLyBBbGxvdyBzZXR0aW5nIG9ubHkgb25jZQogICAgICAgIGlmICh0b2tlbkN0ciAhPSBhZGRyZXNzKDB4MCkpIHRocm93OwoKICAgICAgICB0b2tlbkN0ciA9IFRva2VuKG5ld1Rva2VuQ29udHJhY3RBZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnkpCiAgICBwYXlhYmxlCiAgICBpc1VuZGVyUHJlc2FsZU1pbmltdW0KICAgIGlzWmVyb1ZhbHVlCiAgICBpc092ZXJDYXAKICAgIGlzT3ZlclRva2VuQ2FwCiAgICBpc1N3YXBTdG9wcGVkCiAgICBhcmVDb25kaXRpb25zU2F0aXNmaWVkIHsKICAgICAgICBEZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICAgICAgdG9rZW5DdHIubWludFRva2VucyhfYmVuZWZpY2lhcnksIG1zZy52YWx1ZSk7CiAgICAgICAgaWYgKCFzYWZlVG9BZGQoYW1vdW50UmFpc2VkLCBtc2cudmFsdWUpKSB0aHJvdzsKICAgICAgICBhbW91bnRSYWlzZWQgKz0gbXNnLnZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3UmVzZXJ2ZShhZGRyZXNzIF9iZW5lZmljaWFyeSkgb25seW93bmVyIHsKCSAgICBpZiAodG9rZW5DdHIuY3JlYXRpb25UaW1lKCkgKyBTV0FQX0xFTkdUSCA8IG5vdykgewogICAgICAgICAgICB0b2tlbkN0ci5taW50UmVzZXJ2ZShfYmVuZWZpY2lhcnkpOwogICAgICAgIH0KICAgIH0gCn0KCi8vIHVzYWdlOgovLyBieXRlczMyIGggPSBXYWxsZXQodykuZnJvbShvbmVPd25lcikudHJhbnNhY3QodG8sIHZhbHVlLCBkYXRhKTsKLy8gV2FsbGV0KHcpLmZyb20oYW5vdGhlck93bmVyKS5jb25maXJtKGgpOwpjb250cmFjdCBXYWxsZXQgaXMgbXVsdGlzaWcsIG11bHRpb3duZWQsIGRheWxpbWl0LCB0b2tlbnN3YXAgewoKCS8vIFRZUEVTCgogICAgLy8gVHJhbnNhY3Rpb24gc3RydWN0dXJlIHRvIHJlbWVtYmVyIGRldGFpbHMgb2YgdHJhbnNhY3Rpb24gbGVzdCBpdCBuZWVkIGJlIHNhdmVkIGZvciBhIGxhdGVyIGNhbGwuCiAgICBzdHJ1Y3QgVHJhbnNhY3Rpb24gewogICAgICAgIGFkZHJlc3MgdG87CiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICBieXRlcyBkYXRhOwogICAgfQoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBjb25zdHJ1Y3RvciAtIGp1c3QgcGFzcyBvbiB0aGUgb3duZXIgYXJyYXkgdG8gdGhlIG11bHRpb3duZWQgYW5kCiAgICAvLyB0aGUgbGltaXQgdG8gZGF5bGltaXQKICAgIGZ1bmN0aW9uIFdhbGxldChhZGRyZXNzW10gX293bmVycywgdWludCBfcmVxdWlyZWQsIHVpbnQgX2RheWxpbWl0KQogICAgICAgICAgICBtdWx0aW93bmVkKF9vd25lcnMsIF9yZXF1aXJlZCkgZGF5bGltaXQoX2RheWxpbWl0KSB7CiAgICB9CgogICAgLy8ga2lsbHMgdGhlIGNvbnRyYWN0IHNlbmRpbmcgZXZlcnl0aGluZyB0byBgX3RvYC4KICAgIGZ1bmN0aW9uIGtpbGwoYWRkcmVzcyBfdG8pIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICAgLy8gZW5zdXJlIG93bmVycyBjYW4ndCBwcmVtYXR1cmVseSBzdG9wIHRva2VuIHNhbGUKICAgICAgICBpZiAodG9rZW5Td2FwKSB0aHJvdzsKICAgICAgICAvLyBlbnN1cmUgb3duZXJzIGNhbid0IGtpbGwgd2FsbGV0IHdpdGhvdXQgc3RvcHBpbmcgdG9rZW4KICAgICAgICAvLyAgb3RoZXJ3aXNlIHRva2VuIGNhbiBuZXZlciBiZSBzdG9wcGVkCiAgICAgICAgaWYgKHRva2VuQ3RyLnRyYW5zZmVyU3RvcCgpID09IGZhbHNlKSB0aHJvdzsKICAgICAgICBzdWljaWRlKF90byk7CiAgICB9CgogICAgLy8gQWN0aXZhdGVzIEVtZXJnZW5jeSBTdG9wIGZvciBUb2tlbgogICAgZnVuY3Rpb24gc3RvcFRva2VuKCkgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgIHRva2VuQ3RyLnN0b3BUb2tlbigpOwogICAgfQoKICAgIC8vIGdldHMgY2FsbGVkIHdoZW4gbm8gb3RoZXIgZnVuY3Rpb24gbWF0Y2hlcwogICAgZnVuY3Rpb24oKQogICAgcGF5YWJsZSB7CiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIE91dHNpZGUtdmlzaWJsZSB0cmFuc2FjdCBlbnRyeSBwb2ludC4gRXhlY3V0ZXMgdHJhbnNhY3Rpb24gaW1tZWRpYXRlbHkgaWYgYmVsb3cgZGFpbHkgc3BlbmQgbGltaXQuCiAgICAvLyBJZiBub3QsIGdvZXMgaW50byBtdWx0aXNpZyBwcm9jZXNzLiBXZSBwcm92aWRlIGEgaGFzaCBvbiByZXR1cm4gdG8gYWxsb3cgdGhlIHNlbmRlciB0byBwcm92aWRlCiAgICAvLyBzaG9ydGN1dHMgZm9yIHRoZSBvdGhlciBjb25maXJtYXRpb25zIChhbGxvd2luZyB0aGVtIHRvIGF2b2lkIHJlcGxpY2F0aW5nIHRoZSBfdG8sIF92YWx1ZQogICAgLy8gYW5kIF9kYXRhIGFyZ3VtZW50cykuIFRoZXkgc3RpbGwgZ2V0IHRoZSBvcHRpb24gb2YgdXNpbmcgdGhlbSBpZiB0aGV5IHdhbnQsIGFueXdheXMuCiAgICBmdW5jdGlvbiBleGVjdXRlKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIGV4dGVybmFsIG9ubHlvd25lciByZXR1cm5zIChieXRlczMyIF9yKSB7CiAgICAgICAgLy8gRGlzYWxsb3cgdGhlIHdhbGxldCBjb250cmFjdCBmcm9tIGNhbGxpbmcgdG9rZW4gY29udHJhY3Qgb25jZSBpdCdzIHNldAogICAgICAgIC8vIHNvIHRva2VucyBjYW4ndCBiZSBtaW50ZWQgYXJiaXRyYXJpbHkgb25jZSB0aGUgc2FsZSBzdGFydHMuCiAgICAgICAgLy8gVG9rZW5zIGNhbiBiZSBtaW50ZWQgZm9yIHByZW1pbmUgYmVmb3JlIHRoZSBzYWxlIG9wZW5zIGFuZCB0b2tlbkN0ciBpcyBzZXQuCiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRva2VuQ3RyKSkgdGhyb3c7CgogICAgICAgIC8vIGZpcnN0LCB0YWtlIHRoZSBvcHBvcnR1bml0eSB0byBjaGVjayB0aGF0IHdlJ3JlIHVuZGVyIHRoZSBkYWlseSBsaW1pdC4KICAgICAgICBpZiAodW5kZXJMaW1pdChfdmFsdWUpKSB7CiAgICAgICAgICAgIFNpbmdsZVRyYW5zYWN0KG1zZy5zZW5kZXIsIF92YWx1ZSwgX3RvLCBfZGF0YSk7CiAgICAgICAgICAgIC8vIHllcyAtIGp1c3QgZXhlY3V0ZSB0aGUgY2FsbC4KICAgICAgICAgICAgaWYoIV90by5jYWxsLnZhbHVlKF92YWx1ZSkoX2RhdGEpKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIGRldGVybWluZSBvdXIgb3BlcmF0aW9uIGhhc2guCiAgICAgICAgX3IgPSBzaGEzKG1zZy5kYXRhLCBibG9jay5udW1iZXIpOwogICAgICAgIGlmICghY29uZmlybShfcikgJiYgbV90eHNbX3JdLnRvID09IDApIHsKICAgICAgICAgICAgbV90eHNbX3JdLnRvID0gX3RvOwogICAgICAgICAgICBtX3R4c1tfcl0udmFsdWUgPSBfdmFsdWU7CiAgICAgICAgICAgIG1fdHhzW19yXS5kYXRhID0gX2RhdGE7CiAgICAgICAgICAgIENvbmZpcm1hdGlvbk5lZWRlZChfciwgbXNnLnNlbmRlciwgX3ZhbHVlLCBfdG8sIF9kYXRhKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gY29uZmlybSBhIHRyYW5zYWN0aW9uIHRocm91Z2gganVzdCB0aGUgaGFzaC4gd2UgdXNlIHRoZSBwcmV2aW91cyB0cmFuc2FjdGlvbnMgbWFwLCBtX3R4cywgaW4gb3JkZXIKICAgIC8vIHRvIGRldGVybWluZSB0aGUgYm9keSBvZiB0aGUgdHJhbnNhY3Rpb24gZnJvbSB0aGUgaGFzaCBwcm92aWRlZC4KICAgIGZ1bmN0aW9uIGNvbmZpcm0oYnl0ZXMzMiBfaCkgb25seW1hbnlvd25lcnMoX2gpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAobV90eHNbX2hdLnRvICE9IDApIHsKICAgICAgICAgICAgaWYgKCFtX3R4c1tfaF0udG8uY2FsbC52YWx1ZShtX3R4c1tfaF0udmFsdWUpKG1fdHhzW19oXS5kYXRhKSkgICAvLyBCdWdmaXg6IElmIHN1Y2Nlc3NmdWwsIE11bHRpVHJhbnNhY3QgZXZlbnQgc2hvdWxkIGZpcmU7IGlmIHVuc3VjY2Vzc2Z1bCwgd2Ugc2hvdWxkIHRocm93CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgTXVsdGlUcmFuc2FjdChtc2cuc2VuZGVyLCBfaCwgbV90eHNbX2hdLnZhbHVlLCBtX3R4c1tfaF0udG8sIG1fdHhzW19oXS5kYXRhKTsKICAgICAgICAgICAgZGVsZXRlIG1fdHhzW19oXTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBjbGVhclBlbmRpbmcoKSBpbnRlcm5hbCB7CiAgICAgICAgdWludCBsZW5ndGggPSBtX3BlbmRpbmdJbmRleC5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpCiAgICAgICAgICAgIGRlbGV0ZSBtX3R4c1ttX3BlbmRpbmdJbmRleFtpXV07CiAgICAgICAgc3VwZXIuY2xlYXJQZW5kaW5nKCk7CiAgICB9CgoJLy8gRklFTERTCgogICAgLy8gcGVuZGluZyB0cmFuc2FjdGlvbnMgd2UgaGF2ZSBhdCBwcmVzZW50LgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBUcmFuc2FjdGlvbikgbV90eHM7Cn0='.
	

]
