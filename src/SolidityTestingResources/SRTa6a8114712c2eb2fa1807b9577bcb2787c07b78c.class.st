Class {
	#name : #SRTa6a8114712c2eb2fa1807b9577bcb2787c07b78c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa6a8114712c2eb2fa1807b9577bcb2787c07b78c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgovLyBFUkMyMCB0b2tlbiBpbnRlcmZhY2UgaXMgaW1wbGVtZW50ZWQgb25seSBwYXJ0aWFsbHkuCmludGVyZmFjZSB0b2tlblJlY2lwaWVudCB7IGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsgfQoKY29udHJhY3QgTmFtaUNyb3dkU2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLy8gTkFDIEJyb2tlciBQcmVzYWxlIFRva2VuCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gTmFtaUNyb3dkU2FsZShhZGRyZXNzIF9lc2Nyb3csIGFkZHJlc3MgX25hbWlNdWx0aVNpZ1dhbGxldCwgYWRkcmVzcyBfbmFtaVByZXNhbGUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfbmFtaU11bHRpU2lnV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgZXNjcm93ID0gX2VzY3JvdzsKICAgICAgICBuYW1pTXVsdGlTaWdXYWxsZXQgPSBfbmFtaU11bHRpU2lnV2FsbGV0OwogICAgICAgIG5hbWlQcmVzYWxlID0gX25hbWlQcmVzYWxlOwogICAgfQoKCiAgICAvKi8KICAgICAqICBDb25zdGFudHMKICAgIC8qLwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJOYW1pIElDTyI7CiAgICBzdHJpbmcgcHVibGljICBzeW1ib2wgPSAiTkFDIjsKICAgIHVpbnQgICBwdWJsaWMgZGVjaW1hbHMgPSAxODsKCiAgICBib29sIHB1YmxpYyBUUkFOU0ZFUkFCTEUgPSBmYWxzZTsgLy8gZGVmYXVsdCBub3QgdHJhbnNmZXJhYmxlCgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgVE9LRU5fU1VQUExZX0xJTUlUID0gMTAwMDAwMDAwMCAqICgxIGV0aGVyIC8gMSB3ZWkpOwogICAgCiAgICB1aW50IHB1YmxpYyBiaW5hcnkgPSAwOwoKICAgIC8qLwogICAgICogIFRva2VuIHN0YXRlCiAgICAvKi8KCiAgICBlbnVtIFBoYXNlIHsKICAgICAgICBDcmVhdGVkLAogICAgICAgIFJ1bm5pbmcsCiAgICAgICAgUGF1c2VkLAogICAgICAgIE1pZ3JhdGluZywKICAgICAgICBNaWdyYXRlZAogICAgfQoKICAgIFBoYXNlIHB1YmxpYyBjdXJyZW50UGhhc2UgPSBQaGFzZS5DcmVhdGVkOwogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHkgPSAwOyAvLyBhbW91bnQgb2YgdG9rZW5zIGFscmVhZHkgc29sZAoKICAgIC8vIGVzY3JvdyBoYXMgZXhjbHVzaXZlIHByaXZlbGVnZXMgdG8gY2FsbCBhZG1pbmlzdHJhdGl2ZQogICAgLy8gZnVuY3Rpb25zIG9uIHRoaXMgY29udHJhY3QuCiAgICBhZGRyZXNzIHB1YmxpYyBlc2Nyb3c7CgogICAgLy8gR2F0aGVyZWQgZnVuZHMgY2FuIGJlIHdpdGhkcmF3biBvbmx5IHRvIG5hbWltdWx0aXNpZ3dhbGxldCdzIGFkZHJlc3MuCiAgICBhZGRyZXNzIHB1YmxpYyBuYW1pTXVsdGlTaWdXYWxsZXQ7CgogICAgLy8gbmFtaSBwcmVzYWxlIGNvbnRyYWN0CiAgICBhZGRyZXNzIHB1YmxpYyBuYW1pUHJlc2FsZTsKCiAgICAvLyBDcm93ZHNhbGUgbWFuYWdlciBoYXMgZXhjbHVzaXZlIHByaXZlbGVnZXMgdG8gYnVybiBwcmVzYWxlIHRva2Vucy4KICAgIGFkZHJlc3MgcHVibGljIGNyb3dkc2FsZU1hbmFnZXI7CiAgICAKICAgIC8vIGJpbmFyeSBvcHRpb24gYWRkcmVzcwogICAgYWRkcmVzcyBwdWJsaWMgYmluYXJ5QWRkcmVzczsKICAgIAogICAgLy8gVGhpcyBjcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGJhbGFuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlT2Y7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2U7CgogICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZU1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyb3dkc2FsZU1hbmFnZXIpOyAKICAgICAgICBfOyAKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RXNjcm93KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBlc2Nyb3cpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlUcmFuZmVyYWJsZSgpIHsKICAgICAgICByZXF1aXJlKFRSQU5TRkVSQUJMRSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seU5hbWlNdWx0aXNpZygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmFtaU11bHRpU2lnV2FsbGV0KTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKi8KICAgICAqICBFdmVudHMKICAgIC8qLwoKICAgIGV2ZW50IExvZ0J1eShhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgTG9nQnVybihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgTG9nUGhhc2VTd2l0Y2goUGhhc2UgbmV3UGhhc2UpOwogICAgLy8gTG9nIG1pZ3JhdGUgdG9rZW4KICAgIGV2ZW50IExvZ01pZ3JhdGUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIC8vIFRoaXMgZ2VuZXJhdGVzIGEgcHVibGljIGV2ZW50IG9uIHRoZSBibG9ja2NoYWluIHRoYXQgd2lsbCBub3RpZnkgY2xpZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CgogICAgLyovCiAgICAgKiAgUHVibGljIGZ1bmN0aW9ucwogICAgLyovCgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCB0cmFuc2Zlciwgb25seSBjYW4gYmUgY2FsbGVkIGJ5IHRoaXMgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgaW50ZXJuYWwgewogICAgICAgIC8vIFByZXZlbnQgdHJhbnNmZXIgdG8gMHgwIGFkZHJlc3MuIFVzZSBidXJuKCkgaW5zdGVhZAogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoCiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2ZbX2Zyb21dID49IF92YWx1ZSk7CiAgICAgICAgLy8gQ2hlY2sgZm9yIG92ZXJmbG93cwogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mW190b10gKyBfdmFsdWUgPiBiYWxhbmNlT2ZbX3RvXSk7CiAgICAgICAgLy8gU2F2ZSB0aGlzIGZvciBhbiBhc3NlcnRpb24gaW4gdGhlIGZ1dHVyZQogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlcyA9IGJhbGFuY2VPZltfZnJvbV0gKyBiYWxhbmNlT2ZbX3RvXTsKICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlT2ZbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICAvLyBBZGQgdGhlIHNhbWUgdG8gdGhlIHJlY2lwaWVudAogICAgICAgIGJhbGFuY2VPZltfdG9dICs9IF92YWx1ZTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIC8vIEFzc2VydHMgYXJlIHVzZWQgdG8gdXNlIHN0YXRpYyBhbmFseXNpcyB0byBmaW5kIGJ1Z3MgaW4geW91ciBjb2RlLiBUaGV5IHNob3VsZCBuZXZlciBmYWlsCiAgICAgICAgYXNzZXJ0KGJhbGFuY2VPZltfZnJvbV0gKyBiYWxhbmNlT2ZbX3RvXSA9PSBwcmV2aW91c0JhbGFuY2VzKTsKICAgIH0KCiAgICAvLyBUcmFuc2ZlciB0aGUgYmFsYW5jZSBmcm9tIG93bmVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQKICAgIC8vIG9ubHkgZXNjcm93IGNhbiBzZW5kIHRva2VuICh0byBzZW5kIHRva2VuIHByaXZhdGUgc2FsZSkKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRm9yVGVhbShhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRyYW5zZmVyIHRva2VucwogICAgICoKICAgICAqIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20geW91ciBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBhbW91bnQgdG8gc2VuZAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYwogICAgICAgIG9ubHlUcmFuZmVyYWJsZQogICAgewogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICB9CiAgICAKICAgICAgIC8qKgogICAgICogVHJhbnNmZXIgdG9rZW5zIGZyb20gb3RoZXIgYWRkcmVzcwogICAgICoKICAgICAqIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGluIGJlaGFsZiBvZiBgX2Zyb21gCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IHRvIHNlbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVRyYW5mZXJhYmxlCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0pOyAgICAgLy8gQ2hlY2sgYWxsb3dhbmNlCiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYWxsb3dhbmNlIGZvciBvdGhlciBhZGRyZXNzCiAgICAgKgogICAgICogQWxsb3dzIGBfc3BlbmRlcmAgdG8gc3BlbmQgbm8gbW9yZSB0aGFuIGBfdmFsdWVgIHRva2VucyBpbiB5b3VyIGJlaGFsZgogICAgICoKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBhdXRob3JpemVkIHRvIHNwZW5kCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBtYXggYW1vdW50IHRoZXkgY2FuIHNwZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYwogICAgICAgIG9ubHlUcmFuZmVyYWJsZQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgCiAgICB7CiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhbGxvd2FuY2UgZm9yIG90aGVyIGFkZHJlc3MgYW5kIG5vdGlmeQogICAgICoKICAgICAqIEFsbG93cyBgX3NwZW5kZXJgIHRvIHNwZW5kIG5vIG1vcmUgdGhhbiBgX3ZhbHVlYCB0b2tlbnMgaW4geW91ciBiZWhhbGYsIGFuZCB0aGVuIHBpbmcgdGhlIGNvbnRyYWN0IGFib3V0IGl0CiAgICAgKgogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIGF1dGhvcml6ZWQgdG8gc3BlbmQKICAgICAqIEBwYXJhbSBfdmFsdWUgdGhlIG1heCBhbW91bnQgdGhleSBjYW4gc3BlbmQKICAgICAqIEBwYXJhbSBfZXh0cmFEYXRhIHNvbWUgZXh0cmEgaW5mb3JtYXRpb24gdG8gc2VuZCB0byB0aGUgYXBwcm92ZWQgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9leHRyYURhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVRyYW5mZXJhYmxlCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAKICAgIHsKICAgICAgICB0b2tlblJlY2lwaWVudCBzcGVuZGVyID0gdG9rZW5SZWNpcGllbnQoX3NwZW5kZXIpOwogICAgICAgIGlmIChhcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpKSB7CiAgICAgICAgICAgIHNwZW5kZXIucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBhbGxvd3MgdHJhbnNmZXIgdG9rZW4KICAgIGZ1bmN0aW9uIGNoYW5nZVRyYW5zZmVyYWJsZSAoKSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgVFJBTlNGRVJBQkxFID0gIVRSQU5TRkVSQUJMRTsKICAgIH0KICAgIAogICAgLy8gY2hhbmdlIGVzY3JvdwogICAgZnVuY3Rpb24gY2hhbmdlRXNjcm93KGFkZHJlc3MgX2VzY3JvdykgcHVibGljCiAgICAgICAgb25seU5hbWlNdWx0aXNpZwogICAgewogICAgICAgIHJlcXVpcmUoX2VzY3JvdyAhPSAweDApOwogICAgICAgIGVzY3JvdyA9IF9lc2Nyb3c7CiAgICB9CiAgICAKICAgIC8vIGNoYW5nZSBiaW5hcnkgdmFsdWUKICAgIGZ1bmN0aW9uIGNoYW5nZUJpbmFyeSh1aW50IF9iaW5hcnkpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIGJpbmFyeSA9IF9iaW5hcnk7CiAgICB9CiAgICAKICAgIC8vIGNoYW5nZSBiaW5hcnkgYWRkcmVzcwogICAgZnVuY3Rpb24gY2hhbmdlQmluYXJ5QWRkcmVzcyhhZGRyZXNzIF9iaW5hcnlBZGRyZXNzKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKF9iaW5hcnlBZGRyZXNzICE9IDB4MCk7CiAgICAgICAgYmluYXJ5QWRkcmVzcyA9IF9iaW5hcnlBZGRyZXNzOwogICAgfQogICAgCiAgICAvKgogICAgKiBwcmljZSBpbiBJQ086CiAgICAqIGZpcnN0IHdlZWs6IDEgRVRIID0gMjQwMCBOQUMKICAgICogc2Vjb25kIHdlZWs6IDEgRVRIID0gMjMwMDAgTkFDCiAgICAqIDNyZCB3ZWVrOiAxIEVUSCA9IDIyMDAgTkFDCiAgICAqIDR0aCB3ZWVrOiAxIEVUSCA9IDIxMDAgTkFDCiAgICAqIDV0aCB3ZWVrOiAxIEVUSCA9IDIwMDAgTkFDCiAgICAqIDZ0aCB3ZWVrOiAxIEVUSCA9IDE5MDAgTkFDCiAgICAqIDd0aCB3ZWVrOiAxIEVUSCA9IDE4MDAgTkFDCiAgICAqIDh0aCB3ZWVrOiAxIEVUSCA9IDE3MDAgbmFjCiAgICAqIHRpbWU6IAogICAgKiAxNTE3NDQzMjAwOiBUaHVyc2RheSwgRmVicnVhcnkgMSwgMjAxOCAxMjowMDowMCBBTQogICAgKiAxNTE4MDQ4MDAwOiBUaHVyc2RheSwgRmVicnVhcnkgOCwgMjAxOCAxMjowMDowMCBBTQogICAgKiAxNTE4NjUyODAwOiBUaHVyc2RheSwgRmVicnVhcnkgMTUsIDIwMTggMTI6MDA6MDAgQU0KICAgICogMTUxOTI1NzYwMDogVGh1cnNkYXksIEZlYnJ1YXJ5IDIyLCAyMDE4IDEyOjAwOjAwIEFNCiAgICAqIDE1MTk4NjI0MDA6IFRodXJzZGF5LCBNYXJjaCAxLCAyMDE4IDEyOjAwOjAwIEFNCiAgICAqIDE1MjA0NjcyMDA6IFRodXJzZGF5LCBNYXJjaCA4LCAyMDE4IDEyOjAwOjAwIEFNCiAgICAqIDE1MjEwNzIwMDA6IFRodXJzZGF5LCBNYXJjaCAxNSwgMjAxOCAxMjowMDowMCBBTQogICAgKiAxNTIxNjc2ODAwOiBUaHVyc2RheSwgTWFyY2ggMjIsIDIwMTggMTI6MDA6MDAgQU0KICAgICogMTUyMjI4MTYwMDogVGh1cnNkYXksIE1hcmNoIDI5LCAyMDE4IDEyOjAwOjAwIEFNCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHJpY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHByaWNlKSB7CiAgICAgICAgaWYgKG5vdyA8IDE1MTc0NDMyMDApIHsKICAgICAgICAgICAgLy8gcHJlc2FsZQogICAgICAgICAgICByZXR1cm4gMzQ1MDsKICAgICAgICB9IGVsc2UgaWYgKDE1MTc0NDMyMDAgPCBub3cgJiYgbm93IDw9IDE1MTgwNDgwMDApIHsKICAgICAgICAgICAgLy8gMXN0IHdlZWsKICAgICAgICAgICAgcmV0dXJuIDI0MDA7CiAgICAgICAgfSBlbHNlIGlmICgxNTE4MDQ4MDAwIDwgbm93ICYmIG5vdyA8PSAxNTE4NjUyODAwKSB7CiAgICAgICAgICAgIC8vIDJuZCB3ZWVrCiAgICAgICAgICAgIHJldHVybiAyMzAwOwogICAgICAgIH0gZWxzZSBpZiAoMTUxODY1MjgwMCA8IG5vdyAmJiBub3cgPD0gMTUxOTI1NzYwMCkgewogICAgICAgICAgICAvLyAzcmQgd2VlawogICAgICAgICAgICByZXR1cm4gMjIwMDsKICAgICAgICB9IGVsc2UgaWYgKDE1MTkyNTc2MDAgPCBub3cgJiYgbm93IDw9IDE1MTk4NjI0MDApIHsKICAgICAgICAgICAgLy8gNHRoIHdlZWsKICAgICAgICAgICAgcmV0dXJuIDIxMDA7CiAgICAgICAgfSBlbHNlIGlmICgxNTE5ODYyNDAwIDwgbm93ICYmIG5vdyA8PSAxNTIwNDY3MjAwKSB7CiAgICAgICAgICAgIC8vIDV0aCB3ZWVrCiAgICAgICAgICAgIHJldHVybiAyMDAwOwogICAgICAgIH0gZWxzZSBpZiAoMTUyMDQ2NzIwMCA8IG5vdyAmJiBub3cgPD0gMTUyMTA3MjAwMCkgewogICAgICAgICAgICAvLyA2dGggd2VlawogICAgICAgICAgICByZXR1cm4gMTkwMDsKICAgICAgICB9IGVsc2UgaWYgKDE1MjEwNzIwMDAgPCBub3cgJiYgbm93IDw9IDE1MjE2NzY4MDApIHsKICAgICAgICAgICAgLy8gN3RoIHdlZWsKICAgICAgICAgICAgcmV0dXJuIDE4MDA7CiAgICAgICAgfSBlbHNlIGlmICgxNTIxNjc2ODAwIDwgbm93ICYmIG5vdyA8PSAxNTIyMjgxNjAwKSB7CiAgICAgICAgICAgIC8vIDh0aCB3ZWVrCiAgICAgICAgICAgIHJldHVybiAxNzAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBiaW5hcnk7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbigpIHBheWFibGUgcHVibGljIHsKICAgICAgICBidXkobXNnLnNlbmRlcik7CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24gYnV5KGFkZHJlc3MgX2J1eWVyKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgLy8gQXZhaWxhYmxlIG9ubHkgaWYgcHJlc2FsZSBpcyBydW5uaW5nLgogICAgICAgIHJlcXVpcmUoY3VycmVudFBoYXNlID09IFBoYXNlLlJ1bm5pbmcpOwogICAgICAgIC8vIHJlcXVpcmUgSUNPIHRpbWUgb3IgYmluYXJ5IG9wdGlvbgogICAgICAgIHJlcXVpcmUobm93IDw9IDE1MjIyODE2MDAgfHwgbXNnLnNlbmRlciA9PSBiaW5hcnlBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSAhPSAwKTsKICAgICAgICB1aW50IG5ld1Rva2VucyA9IG1zZy52YWx1ZSAqIGdldFByaWNlKCk7CiAgICAgICAgcmVxdWlyZSAodG90YWxTdXBwbHkgKyBuZXdUb2tlbnMgPCBUT0tFTl9TVVBQTFlfTElNSVQpOwogICAgICAgIC8vIGFkZCBuZXcgdG9rZW4gdG8gYnV5ZXIKICAgICAgICBiYWxhbmNlT2ZbX2J1eWVyXSA9IGJhbGFuY2VPZltfYnV5ZXJdLmFkZChuZXdUb2tlbnMpOwogICAgICAgIC8vIGFkZCBuZXcgdG9rZW4gdG8gdG90YWxTdXBwbHkKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChuZXdUb2tlbnMpOwogICAgICAgIExvZ0J1eShfYnV5ZXIsbmV3VG9rZW5zKTsKICAgICAgICBUcmFuc2Zlcih0aGlzLF9idXllcixuZXdUb2tlbnMpOwogICAgfQogICAgCgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgdG9rZW5zIG93bmVkIGJ5IGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF9vd25lcikgcHVibGljCiAgICAgICAgb25seUNyb3dkc2FsZU1hbmFnZXIKICAgIHsKICAgICAgICAvLyBBdmFpbGFibGUgb25seSBkdXJpbmcgbWlncmF0aW9uIHBoYXNlCiAgICAgICAgcmVxdWlyZShjdXJyZW50UGhhc2UgPT0gUGhhc2UuTWlncmF0aW5nKTsKCiAgICAgICAgdWludCB0b2tlbnMgPSBiYWxhbmNlT2ZbX293bmVyXTsKICAgICAgICByZXF1aXJlKHRva2VucyAhPSAwKTsKICAgICAgICBiYWxhbmNlT2ZbX293bmVyXSA9IDA7CiAgICAgICAgdG90YWxTdXBwbHkgLT0gdG9rZW5zOwogICAgICAgIExvZ0J1cm4oX293bmVyLCB0b2tlbnMpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgY3Jvd2RzYWxlTWFuYWdlciwgdG9rZW5zKTsKCiAgICAgICAgLy8gQXV0b21hdGljYWxseSBzd2l0Y2ggcGhhc2Ugd2hlbiBtaWdyYXRpb24gaXMgZG9uZS4KICAgICAgICBpZiAodG90YWxTdXBwbHkgPT0gMCkgewogICAgICAgICAgICBjdXJyZW50UGhhc2UgPSBQaGFzZS5NaWdyYXRlZDsKICAgICAgICAgICAgTG9nUGhhc2VTd2l0Y2goUGhhc2UuTWlncmF0ZWQpOwogICAgICAgIH0KICAgIH0KCgogICAgLyovCiAgICAgKiAgQWRtaW5pc3RyYXRpdmUgZnVuY3Rpb25zCiAgICAvKi8KICAgIGZ1bmN0aW9uIHNldFByZXNhbGVQaGFzZShQaGFzZSBfbmV4dFBoYXNlKSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgYm9vbCBjYW5Td2l0Y2hQaGFzZQogICAgICAgICAgICA9ICAoY3VycmVudFBoYXNlID09IFBoYXNlLkNyZWF0ZWQgJiYgX25leHRQaGFzZSA9PSBQaGFzZS5SdW5uaW5nKQogICAgICAgICAgICB8fCAoY3VycmVudFBoYXNlID09IFBoYXNlLlJ1bm5pbmcgJiYgX25leHRQaGFzZSA9PSBQaGFzZS5QYXVzZWQpCiAgICAgICAgICAgICAgICAvLyBzd2l0Y2ggdG8gbWlncmF0aW9uIHBoYXNlIG9ubHkgaWYgY3Jvd2RzYWxlIG1hbmFnZXIgaXMgc2V0CiAgICAgICAgICAgIHx8ICgoY3VycmVudFBoYXNlID09IFBoYXNlLlJ1bm5pbmcgfHwgY3VycmVudFBoYXNlID09IFBoYXNlLlBhdXNlZCkKICAgICAgICAgICAgICAgICYmIF9uZXh0UGhhc2UgPT0gUGhhc2UuTWlncmF0aW5nCiAgICAgICAgICAgICAgICAmJiBjcm93ZHNhbGVNYW5hZ2VyICE9IDB4MCkKICAgICAgICAgICAgfHwgKGN1cnJlbnRQaGFzZSA9PSBQaGFzZS5QYXVzZWQgJiYgX25leHRQaGFzZSA9PSBQaGFzZS5SdW5uaW5nKQogICAgICAgICAgICAgICAgLy8gc3dpdGNoIHRvIG1pZ3JhdGVkIG9ubHkgaWYgZXZlcnl0aW5nIGlzIG1pZ3JhdGVkCiAgICAgICAgICAgIHx8IChjdXJyZW50UGhhc2UgPT0gUGhhc2UuTWlncmF0aW5nICYmIF9uZXh0UGhhc2UgPT0gUGhhc2UuTWlncmF0ZWQKICAgICAgICAgICAgICAgICYmIHRvdGFsU3VwcGx5ID09IDApOwoKICAgICAgICByZXF1aXJlKGNhblN3aXRjaFBoYXNlKTsKICAgICAgICBjdXJyZW50UGhhc2UgPSBfbmV4dFBoYXNlOwogICAgICAgIExvZ1BoYXNlU3dpdGNoKF9uZXh0UGhhc2UpOwogICAgfQoKCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgX2Ftb3VudCkgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUobmFtaU11bHRpU2lnV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgLy8gQXZhaWxhYmxlIGF0IGFueSBwaGFzZS4KICAgICAgICBpZiAodGhpcy5iYWxhbmNlID4gMCkgewogICAgICAgICAgICBuYW1pTXVsdGlTaWdXYWxsZXQudHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBzYWZlV2l0aGRyYXcoYWRkcmVzcyBfd2l0aGRyYXcsIHVpbnQgX2Ftb3VudCkgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIE5hbWlNdWx0aVNpZ1dhbGxldCBuYW1pV2FsbGV0ID0gTmFtaU11bHRpU2lnV2FsbGV0KG5hbWlNdWx0aVNpZ1dhbGxldCk7CiAgICAgICAgaWYgKG5hbWlXYWxsZXQuaXNPd25lcihfd2l0aGRyYXcpKSB7CiAgICAgICAgICAgIF93aXRoZHJhdy50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIHNldENyb3dkc2FsZU1hbmFnZXIoYWRkcmVzcyBfbWdyKSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgLy8gWW91IGNhbid0IGNoYW5nZSBjcm93ZHNhbGUgY29udHJhY3Qgd2hlbiBtaWdyYXRpb24gaXMgaW4gcHJvZ3Jlc3MuCiAgICAgICAgcmVxdWlyZShjdXJyZW50UGhhc2UgIT0gUGhhc2UuTWlncmF0aW5nKTsKICAgICAgICBjcm93ZHNhbGVNYW5hZ2VyID0gX21ncjsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCBtaWdyYXRlIG1pZ3JhdGlvbiB0b2tlbnMKICAgIGZ1bmN0aW9uIF9taWdyYXRlVG9rZW4oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICBQcmVzYWxlVG9rZW4gcHJlc2FsZSA9IFByZXNhbGVUb2tlbihuYW1pUHJlc2FsZSk7CiAgICAgICAgdWludDI1NiBuZXdUb2tlbiA9IHByZXNhbGUuYmFsYW5jZU9mKF9mcm9tKTsKICAgICAgICByZXF1aXJlKG5ld1Rva2VuID4gMCk7CiAgICAgICAgLy8gYnVybiBvbGQgdG9rZW4KICAgICAgICBwcmVzYWxlLmJ1cm5Ub2tlbnMoX2Zyb20pOwogICAgICAgIC8vIGFkZCBuZXcgdG9rZW4gdG8gX3RvCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBiYWxhbmNlT2ZbX3RvXS5hZGQobmV3VG9rZW4pOwogICAgICAgIC8vIGFkZCBuZXcgdG9rZW4gdG8gdG90YWxTdXBwbHkKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChuZXdUb2tlbik7CiAgICAgICAgTG9nTWlncmF0ZShfZnJvbSwgX3RvLCBuZXdUb2tlbik7CiAgICAgICAgVHJhbnNmZXIodGhpcyxfdG8sbmV3VG9rZW4pOwogICAgfQoKICAgIC8vIG1pZ2F0ZSB0b2tlbiBmdW5jdGlvbiBmb3IgTmFtaSBUZWFtCiAgICBmdW5jdGlvbiBtaWdyYXRlVG9rZW4oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICBfbWlncmF0ZVRva2VuKF9mcm9tLCBfdG8pOwogICAgfQoKICAgIC8vIG1pZ3JhdGUgdG9rZW4gZm9yIGludmVzdG9yCiAgICBmdW5jdGlvbiBtaWdyYXRlRm9ySW52ZXN0b3IoKSBwdWJsaWMgewogICAgICAgIF9taWdyYXRlVG9rZW4obXNnLnNlbmRlciwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gTmFtaSBpbnRlcm5hbCBleGNoYW5nZQogICAgCiAgICAvLyBldmVudCBmb3IgTmFtaSBleGNoYW5nZQogICAgZXZlbnQgVHJhbnNmZXJUb0J1eWVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgaW5kZXhlZCBfc2VsbGVyKTsKICAgIGV2ZW50IFRyYW5zZmVyVG9FeGNoYW5nZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IF9wcmljZSk7CiAgICAKICAgIAogICAgICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlciB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgICogICAgICBJbnZva2VzIHRoZSBgdG9rZW5GYWxsYmFja2AgZnVuY3Rpb24gaWYgdGhlIHJlY2lwaWVudCBpcyBhIGNvbnRyYWN0LgogICAgICogICAgICBUaGUgdG9rZW4gdHJhbnNmZXIgZmFpbHMgaWYgdGhlIHJlY2lwaWVudCBpcyBhIGNvbnRyYWN0CiAgICAgKiAgICAgIGJ1dCBkb2VzIG5vdCBpbXBsZW1lbnQgdGhlIGB0b2tlbkZhbGxiYWNrYCBmdW5jdGlvbgogICAgICogICAgICBvciB0aGUgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcmVjZWl2ZSBmdW5kcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvICAgIFJlY2VpdmVyIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkLgogICAgICogQHBhcmFtIF9wcmljZSBwcmljZSB0byBzZWxsIHRva2VuLgogICAgICovCiAgICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvRXhjaGFuZ2UoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IF9wcmljZSkgcHVibGljIHsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CiAgICAgICAgCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBjb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKF90bykKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gYmFsYW5jZU9mW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gYmFsYW5jZU9mW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlcixfdG8sX3ZhbHVlKTsKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrRXhjaGFuZ2UobXNnLnNlbmRlciwgX3ZhbHVlLCBfcHJpY2UpOwogICAgICAgICAgICBUcmFuc2ZlclRvRXhjaGFuZ2UobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9wcmljZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAqICAgICAgSW52b2tlcyB0aGUgYHRva2VuRmFsbGJhY2tgIGZ1bmN0aW9uIGlmIHRoZSByZWNpcGllbnQgaXMgYSBjb250cmFjdC4KICAgICAqICAgICAgVGhlIHRva2VuIHRyYW5zZmVyIGZhaWxzIGlmIHRoZSByZWNpcGllbnQgaXMgYSBjb250cmFjdAogICAgICogICAgICBidXQgZG9lcyBub3QgaW1wbGVtZW50IHRoZSBgdG9rZW5GYWxsYmFja2AgZnVuY3Rpb24KICAgICAqICAgICAgb3IgdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHJlY2VpdmUgZnVuZHMuCiAgICAgKgogICAgICogQHBhcmFtIF90byAgICBSZWNlaXZlciBhZGRyZXNzLgogICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcnJlZC4KICAgICAqIEBwYXJhbSBfYnV5ZXIgYWRkcmVzcyBvZiBzZWxsZXIuCiAgICAgKi8KICAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9CdXllcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgX2J1eWVyKSBwdWJsaWMgewogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKICAgICAgICAKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KICAgICAgICAKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZU9mW190b10gPSBiYWxhbmNlT2ZbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLF90byxfdmFsdWUpOwogICAgICAgIGlmIChjb2RlTGVuZ3RoID4gMCkgewogICAgICAgICAgICBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0KF90byk7CiAgICAgICAgICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2tCdXllcihtc2cuc2VuZGVyLCBfdmFsdWUsIF9idXllcik7CiAgICAgICAgICAgIFRyYW5zZmVyVG9CdXllcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2J1eWVyKTsKICAgICAgICB9CiAgICB9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp9CgoKLyoKKiBCaW5hcnkgb3B0aW9uIHNtYXJ0IGNvbnRyYWN0LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoqLwpjb250cmFjdCBCaW5hcnlPcHRpb24gewogICAgLyoKICAgICAqIGJpbmFyeSBvcHRpb24gY29udHJvbGVkIGJ5IGVzY3JvdyB0byBidXkgTkFDIHdpdGggZ29vZCBwcmljZQogICAgICovCiAgICAvLyBOYW1pQ3Jvd2RTYWxlIGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIG5hbWlDcm93ZFNhbGVBZGRyOwogICAgYWRkcmVzcyBwdWJsaWMgZXNjcm93OwogICAgCiAgICAvLyBuYW1pTXVsdGlTaWdXYWxsZXQKICAgIGFkZHJlc3MgcHVibGljIG5hbWlNdWx0aVNpZ1dhbGxldDsKICAgIAogICAgU2Vzc2lvbiBwdWJsaWMgc2Vzc2lvbjsKICAgIHVpbnQgcHVibGljIHRpbWVJbnZlc3RJbk1pbnV0ZSA9IDMwOwogICAgdWludCBwdWJsaWMgdGltZU9uZVNlc3Npb24gPSAxODA7CiAgICB1aW50IHB1YmxpYyBzZXNzaW9uSWQgPSAxOwogICAgdWludCBwdWJsaWMgcmF0ZSA9IDE5MDsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9JTlZFU1RPUiA9IDIwOwogICAgdWludCBwdWJsaWMgbWluaW11bkV0aCA9IDEwMDAwMDAwMDAwMDAwMDAwOyAvLyBtaW5pbXVuRXRoID0gMC4wMSBldGgKICAgIC8qKgogICAgICogRXZlbnRzIGZvciBiaW5hbnkgb3B0aW9uIHN5c3RlbQogICAgICovCiAgICBldmVudCBTZXNzaW9uT3Blbih1aW50IHRpbWVPcGVuLCB1aW50IGluZGV4ZWQgc2Vzc2lvbklkKTsKICAgIGV2ZW50IEludmVzdENsb3NlKHVpbnQgdGltZUludmVzdENsb3NlLCB1aW50IHByaWNlT3BlbiwgdWludCBpbmRleGVkIHNlc3Npb25JZCk7CiAgICBldmVudCBJbnZlc3QoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCBib29sIGNob29zZSwgdWludCBhbW91bnQsIHVpbnQgdGltZUludmVzdCwgdWludCBpbmRleGVkIHNlc3Npb25JZCk7CiAgICBldmVudCBTZXNzaW9uQ2xvc2UodWludCB0aW1lQ2xvc2UsIHVpbnQgaW5kZXhlZCBzZXNzaW9uSWQsIHVpbnQgcHJpY2VDbG9zZSwgdWludCBuYWNQcmljZSwgdWludCByYXRlKTsKCiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgdmFsdWUpOwogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gYWxsb3dzIHRvIGRlcG9zaXQgZXRoZXIuCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkKICAgICAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQogICAgLy8gdGhlcmUgaXMgb25seSBvbmUgc2Vzc2lvbiBhdmFpbGFibGUgYXQgb25lIHRpbWVPcGVuCiAgICAvLyBwcmljZU9wZW4gaXMgcHJpY2Ugb2YgRVRIIGluIFVTRAogICAgLy8gcHJpY2VDbG9zZSBpcyBwcmljZSBvZiBFVEggaW4gVVNECiAgICAvLyBwcm9jZXNzIG9mIG9uZSBTZXNzaW9uCiAgICAvLyAxc3Q6IGVzY3JvdyByZXNldCBzZXNzaW9uIGJ5IHJ1biByZXNldFNlc3Npb24oKQogICAgLy8gMm5kOiBlc2Nyb3cgb3BlbiBzZXNzaW9uIGJ5IHJ1biBvcGVuU2Vzc2lvbigpID0+IHNhdmUgdGltZU9wZW4gYXQgdGhpcyB0aW1lCiAgICAvLyAzcmQ6IGFsbCBpbnZlc3RvciBjYW4gaW52ZXN0IGJ5IHJ1biBpbnZlc3QoKSwgc2VuZCBtaW5pbXVtIDAuMSBFVEgKICAgIC8vIDR0aDogZXNjcm93IGNsb3NlIGludmVzdCBhbmQgaW5zZXJ0IHByaWNlIG9wZW4gZm9yIHRoaXMgU2Vzc2lvbgogICAgLy8gNXRoOiBlc2Nyb3cgY2xvc2Ugc2Vzc2lvbiBhbmQgc2VuZCBOQUMgZm9yIGludmVzdG9yCiAgICBzdHJ1Y3QgU2Vzc2lvbiB7CiAgICAgICAgdWludCBwcmljZU9wZW47CiAgICAgICAgdWludCBwcmljZUNsb3NlOwogICAgICAgIHVpbnQgdGltZU9wZW47CiAgICAgICAgYm9vbCBpc1Jlc2V0OwogICAgICAgIGJvb2wgaXNPcGVuOwogICAgICAgIGJvb2wgaW52ZXN0T3BlbjsKICAgICAgICB1aW50IGludmVzdG9yQ291bnQ7CiAgICAgICAgbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIGludmVzdG9yOwogICAgICAgIG1hcHBpbmcodWludCA9PiBib29sKSB3aW47CiAgICAgICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIGFtb3VudEludmVzdDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gQmluYXJ5T3B0aW9uKGFkZHJlc3MgX25hbWlDcm93ZFNhbGUsIGFkZHJlc3MgX2VzY3JvdywgYWRkcmVzcyBfbmFtaU11bHRpU2lnV2FsbGV0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX25hbWlDcm93ZFNhbGUgIT0gMHgwICYmIF9lc2Nyb3cgIT0gMHgwKTsKICAgICAgICBuYW1pQ3Jvd2RTYWxlQWRkciA9IF9uYW1pQ3Jvd2RTYWxlOwogICAgICAgIGVzY3JvdyA9IF9lc2Nyb3c7CiAgICAgICAgbmFtaU11bHRpU2lnV2FsbGV0ID0gX25hbWlNdWx0aVNpZ1dhbGxldDsKICAgIH0KICAgIAogICAgCiAgICBtb2RpZmllciBvbmx5RXNjcm93KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09ZXNjcm93KTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAgICAgCiAgICBtb2RpZmllciBvbmx5TmFtaU11bHRpc2lnKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuYW1pTXVsdGlTaWdXYWxsZXQpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vIGNoYW5nZSBlc2Nyb3cKICAgIGZ1bmN0aW9uIGNoYW5nZUVzY3JvdyhhZGRyZXNzIF9lc2Nyb3cpIHB1YmxpYwogICAgICAgIG9ubHlOYW1pTXVsdGlzaWcKICAgIHsKICAgICAgICByZXF1aXJlKF9lc2Nyb3cgIT0gMHgwKTsKICAgICAgICBlc2Nyb3cgPSBfZXNjcm93OwogICAgfQogICAgCiAgICAvLyBjaGFnbmUgbWluaW11bkV0aAogICAgZnVuY3Rpb24gY2hhbmdlTWluRXRoKHVpbnQgX21pbmltdW5FdGgpIHB1YmxpYyAKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZShfbWluaW11bkV0aCAhPSAwKTsKICAgICAgICBtaW5pbXVuRXRoID0gX21pbmltdW5FdGg7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoYW5nZSB0aW1lIGZvciBpbnZlc3RvciBjYW4gaW52ZXN0IGluIG9uZSBzZXNzaW9uLCBjYW4gb25seSBjaGFuZ2UgYXQgdGltZSBub3QgaW4gc2Vzc2lvbgogICAgLy8vIEBwYXJhbSBfdGltZUludmVzdCB0aW1lIGludmVzdCBpbiBtaW51dGVzCiAgICBmdW5jdGlvbiBjaGFuZ2VUaW1lSW52ZXN0KHVpbnQgX3RpbWVJbnZlc3QpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIHJlcXVpcmUoIXNlc3Npb24uaXNPcGVuICYmIF90aW1lSW52ZXN0IDwgdGltZU9uZVNlc3Npb24pOwogICAgICAgIHRpbWVJbnZlc3RJbk1pbnV0ZSA9IF90aW1lSW52ZXN0OwogICAgfQogICAgCiAgICAvLyAxMDAgPCBfcmF0ZSA8IDIwMAogICAgLy8gcHJpY2Ugb2YgTkFDIGZvciBpbnZlc3RvciB3aW4gPSBfcmF0ZS8xMDAKICAgIC8vIHByaWNlIG9mIE5BQyBmb3IgaW52ZXN0b3IgbG9zcyA9IDIgLSBfcmF0ZS8xMDAKICAgIGZ1bmN0aW9uIGNoYW5nZVJhdGUodWludCBfcmF0ZSkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZSgxMDAgPCBfcmF0ZSAmJiBfcmF0ZSA8IDIwMCAmJiAhc2Vzc2lvbi5pc09wZW4pOwogICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2hhbmdlVGltZU9uZVNlc3Npb24odWludCBfdGltZU9uZVNlc3Npb24pIAogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKCFzZXNzaW9uLmlzT3BlbiAmJiBfdGltZU9uZVNlc3Npb24gPiB0aW1lSW52ZXN0SW5NaW51dGUpOwogICAgICAgIHRpbWVPbmVTZXNzaW9uID0gX3RpbWVPbmVTZXNzaW9uOwogICAgfQogICAgCiAgICAvLy8gQGRldiB3aXRoZHJhdyBldGhlciB0byBuYW1pIG11bHRpc2lnbmF0dXJlIHdhbGxldCwgb25seSBlc2Nyb3cgY2FuIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCB2YWx1ZSBldGhlciBpbiB3ZWkgdG8gd2l0aGRyYXcKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoZXIodWludCBfYW1vdW50KSBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZShuYW1pTXVsdGlTaWdXYWxsZXQgIT0gMHgwKTsKICAgICAgICAvLyBBdmFpbGFibGUgYXQgYW55IHBoYXNlLgogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIG5hbWlNdWx0aVNpZ1dhbGxldC50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IHNhZmUgd2l0aGRyYXcgRXRoZXIgdG8gb25lIG9mIG93bmVyIG9mIG5hbWkgbXVsdGlzaWduYXR1cmUgd2FsbGV0CiAgICAvLy8gQHBhcmFtIF93aXRoZHJhdyBhZGRyZXNzIHRvIHdpdGhkcmF3CiAgICBmdW5jdGlvbiBzYWZlV2l0aGRyYXcoYWRkcmVzcyBfd2l0aGRyYXcsIHVpbnQgX2Ftb3VudCkgcHVibGljCiAgICAgICAgb25seUVzY3JvdwogICAgewogICAgICAgIE5hbWlNdWx0aVNpZ1dhbGxldCBuYW1pV2FsbGV0ID0gTmFtaU11bHRpU2lnV2FsbGV0KG5hbWlNdWx0aVNpZ1dhbGxldCk7CiAgICAgICAgaWYgKG5hbWlXYWxsZXQuaXNPd25lcihfd2l0aGRyYXcpKSB7CiAgICAgICAgICAgIF93aXRoZHJhdy50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIG93bmVycy4KICAgIC8vIEByZXR1cm4gTGlzdCBvZiBvd25lciBhZGRyZXNzZXMuCiAgICAvLyBNQVhfSU5WRVNUT1IgPSAyMAogICAgZnVuY3Rpb24gZ2V0SW52ZXN0b3JzKCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1syMF0pCiAgICB7CiAgICAgICAgYWRkcmVzc1syMF0gbWVtb3J5IGxpc3RJbnZlc3RvcjsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBNQVhfSU5WRVNUT1I7IGkrKykgewogICAgICAgICAgICBsaXN0SW52ZXN0b3JbaV0gPSBzZXNzaW9uLmludmVzdG9yW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlzdEludmVzdG9yOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDaG9vc2VzKCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbFsyMF0pCiAgICB7CiAgICAgICAgYm9vbFsyMF0gbWVtb3J5IGxpc3RDaG9vc2VzOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IE1BWF9JTlZFU1RPUjsgaSsrKSB7CiAgICAgICAgICAgIGxpc3RDaG9vc2VzW2ldID0gc2Vzc2lvbi53aW5baV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBsaXN0Q2hvb3NlczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0QW1vdW50KCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludFsyMF0pCiAgICB7CiAgICAgICAgdWludFsyMF0gbWVtb3J5IGxpc3RBbW91bnQ7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgTUFYX0lOVkVTVE9SOyBpKyspIHsKICAgICAgICAgICAgbGlzdEFtb3VudFtpXSA9IHNlc3Npb24uYW1vdW50SW52ZXN0W2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlzdEFtb3VudDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgcmVzZXQgYWxsIGRhdGEgb2YgcHJldmlvdXMgc2Vzc2lvbiwgbXVzdCBydW4gYmVmb3JlIG9wZW4gbmV3IHNlc3Npb24KICAgIC8vIG9ubHkgZXNjcm93IGNhbiBjYWxsCiAgICBmdW5jdGlvbiByZXNldFNlc3Npb24oKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKCFzZXNzaW9uLmlzUmVzZXQgJiYgIXNlc3Npb24uaXNPcGVuKTsKICAgICAgICBzZXNzaW9uLnByaWNlT3BlbiA9IDA7CiAgICAgICAgc2Vzc2lvbi5wcmljZUNsb3NlID0gMDsKICAgICAgICBzZXNzaW9uLmlzUmVzZXQgPSB0cnVlOwogICAgICAgIHNlc3Npb24uaXNPcGVuID0gZmFsc2U7CiAgICAgICAgc2Vzc2lvbi5pbnZlc3RPcGVuID0gZmFsc2U7CiAgICAgICAgc2Vzc2lvbi5pbnZlc3RvckNvdW50ID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBNQVhfSU5WRVNUT1I7IGkrKykgewogICAgICAgICAgICBzZXNzaW9uLmludmVzdG9yW2ldID0gMHgwOwogICAgICAgICAgICBzZXNzaW9uLndpbltpXSA9IGZhbHNlOwogICAgICAgICAgICBzZXNzaW9uLmFtb3VudEludmVzdFtpXSA9IDA7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBPcGVuIG5ldyBzZXNzaW9uLCBvbmx5IGVzY3JvdyBjYW4gY2FsbAogICAgZnVuY3Rpb24gb3BlblNlc3Npb24gKCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5RXNjcm93CiAgICB7CiAgICAgICAgcmVxdWlyZShzZXNzaW9uLmlzUmVzZXQgJiYgIXNlc3Npb24uaXNPcGVuKTsKICAgICAgICBzZXNzaW9uLmlzUmVzZXQgPSBmYWxzZTsKICAgICAgICAvLyBvcGVuIGludmVzdAogICAgICAgIHNlc3Npb24uaW52ZXN0T3BlbiA9IHRydWU7CiAgICAgICAgc2Vzc2lvbi50aW1lT3BlbiA9IG5vdzsKICAgICAgICBzZXNzaW9uLmlzT3BlbiA9IHRydWU7CiAgICAgICAgU2Vzc2lvbk9wZW4obm93LCBzZXNzaW9uSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBGdWN0aW9uIGZvciBpbnZlc3RvciwgbWluaW11biBldGhlciBzZW5kIGlzIDAuMSwgb25lIGFkZHJlc3MgY2FuIGNhbGwgb25lIHRpbWUgaW4gb25lIHNlc3Npb24KICAgIC8vLyBAcGFyYW0gX2Nob29zZSBjaG9pc2Ugb2YgaW52ZXN0b3IsIHRydWUgaXMgY2FsbCwgZmFsc2UgaXMgcHV0CiAgICBmdW5jdGlvbiBpbnZlc3QgKGJvb2wgX2Nob29zZSkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluaW11bkV0aCAmJiBzZXNzaW9uLmludmVzdE9wZW4pOyAvLyBtc2cudmFsdWUgPj0gMC4xIGV0aGVyCiAgICAgICAgcmVxdWlyZShub3cgPCAoc2Vzc2lvbi50aW1lT3BlbiArIHRpbWVJbnZlc3RJbk1pbnV0ZSAqIDEgbWludXRlcykpOwogICAgICAgIHJlcXVpcmUoc2Vzc2lvbi5pbnZlc3RvckNvdW50IDwgTUFYX0lOVkVTVE9SKTsKICAgICAgICBzZXNzaW9uLmludmVzdG9yW3Nlc3Npb24uaW52ZXN0b3JDb3VudF0gPSBtc2cuc2VuZGVyOwogICAgICAgIHNlc3Npb24ud2luW3Nlc3Npb24uaW52ZXN0b3JDb3VudF0gPSBfY2hvb3NlOwogICAgICAgIHNlc3Npb24uYW1vdW50SW52ZXN0W3Nlc3Npb24uaW52ZXN0b3JDb3VudF0gPSBtc2cudmFsdWU7CiAgICAgICAgc2Vzc2lvbi5pbnZlc3RvckNvdW50ICs9IDE7CiAgICAgICAgSW52ZXN0KG1zZy5zZW5kZXIsIF9jaG9vc2UsIG1zZy52YWx1ZSwgbm93LCBzZXNzaW9uSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBjbG9zZSBpbnZlc3QgZm9yIGVzY3JvdwogICAgLy8vIEBwYXJhbSBfcHJpY2VPcGVuIHByaWNlIEVUSCBpbiBVU0QKICAgIGZ1bmN0aW9uIGNsb3NlSW52ZXN0ICh1aW50IF9wcmljZU9wZW4pIAogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKF9wcmljZU9wZW4gIT0gMCAmJiBzZXNzaW9uLmludmVzdE9wZW4pOwogICAgICAgIHJlcXVpcmUobm93ID4gKHNlc3Npb24udGltZU9wZW4gKyB0aW1lSW52ZXN0SW5NaW51dGUgKiAxIG1pbnV0ZXMpKTsKICAgICAgICBzZXNzaW9uLmludmVzdE9wZW4gPSBmYWxzZTsKICAgICAgICBzZXNzaW9uLnByaWNlT3BlbiA9IF9wcmljZU9wZW47CiAgICAgICAgSW52ZXN0Q2xvc2Uobm93LCBfcHJpY2VPcGVuLCBzZXNzaW9uSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBnZXQgYW1vdW50IG9mIGV0aGVyIHRvIGJ1eSBOQUMgZm9yIGludmVzdG9yCiAgICAvLy8gQHBhcmFtIF9ldGhlciBhbW91bnQgZXRoZXIgd2hpY2ggaW52ZXN0b3IgaW52ZXN0CiAgICAvLy8gQHBhcmFtIF9yYXRlIHJhdGUgYmV0d2VlbiB3aW4gYW5kIGxvc3MgaW52ZXN0b3IKICAgIC8vLyBAcGFyYW0gX3N0YXR1cyB0cnVlIGZvciBpbnZlc3RvciB3aW4gYW5kIGZhbHNlIGZvciBpbnZlc3RvciBsb3NzCiAgICBmdW5jdGlvbiBnZXRFdGhlclRvQnV5ICh1aW50IF9ldGhlciwgdWludCBfcmF0ZSwgYm9vbCBfc3RhdHVzKQogICAgICAgIHB1YmxpYwogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIGlmIChfc3RhdHVzKSB7CiAgICAgICAgICAgIHJldHVybiBfZXRoZXIgKiBfcmF0ZSAvIDEwMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gX2V0aGVyICogKDIwMCAtIF9yYXRlKSAvIDEwMDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgY2xvc2Ugc2Vzc2lvbiwgb25seSBlc2Nyb3cgY2FuIGNhbGwKICAgIC8vLyBAcGFyYW0gX3ByaWNlQ2xvc2UgcHJpY2Ugb2YgRVRIIGluIFVTRAogICAgZnVuY3Rpb24gY2xvc2VTZXNzaW9uICh1aW50IF9wcmljZUNsb3NlKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlFc2Nyb3cKICAgIHsKICAgICAgICByZXF1aXJlKF9wcmljZUNsb3NlICE9IDAgJiYgbm93ID4gKHNlc3Npb24udGltZU9wZW4gKyB0aW1lT25lU2Vzc2lvbiAqIDEgbWludXRlcykpOwogICAgICAgIHJlcXVpcmUoIXNlc3Npb24uaW52ZXN0T3BlbiAmJiBzZXNzaW9uLmlzT3Blbik7CiAgICAgICAgc2Vzc2lvbi5wcmljZUNsb3NlID0gX3ByaWNlQ2xvc2U7CiAgICAgICAgYm9vbCByZXN1bHQgPSAoX3ByaWNlQ2xvc2U+c2Vzc2lvbi5wcmljZU9wZW4pP3RydWU6ZmFsc2U7CiAgICAgICAgdWludCBldGhlclRvQnV5OwogICAgICAgIE5hbWlDcm93ZFNhbGUgbmFtaUNvbnRyYWN0ID0gTmFtaUNyb3dkU2FsZShuYW1pQ3Jvd2RTYWxlQWRkcik7CiAgICAgICAgdWludCBwcmljZSA9IG5hbWlDb250cmFjdC5nZXRQcmljZSgpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHNlc3Npb24uaW52ZXN0b3JDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChzZXNzaW9uLndpbltpXT09cmVzdWx0KSB7CiAgICAgICAgICAgICAgICBldGhlclRvQnV5ID0gZ2V0RXRoZXJUb0J1eShzZXNzaW9uLmFtb3VudEludmVzdFtpXSwgcmF0ZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBldGhlclRvQnV5ID0gZ2V0RXRoZXJUb0J1eShzZXNzaW9uLmFtb3VudEludmVzdFtpXSwgcmF0ZSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5hbWlDb250cmFjdC5idXkudmFsdWUoZXRoZXJUb0J1eSkoc2Vzc2lvbi5pbnZlc3RvcltpXSk7CiAgICAgICAgICAgIC8vIHJlc2V0IGludmVzdG9yCiAgICAgICAgICAgIHNlc3Npb24uaW52ZXN0b3JbaV0gPSAweDA7CiAgICAgICAgICAgIHNlc3Npb24ud2luW2ldID0gZmFsc2U7CiAgICAgICAgICAgIHNlc3Npb24uYW1vdW50SW52ZXN0W2ldID0gMDsKICAgICAgICB9CiAgICAgICAgc2Vzc2lvbi5pc09wZW4gPSBmYWxzZTsKICAgICAgICBTZXNzaW9uQ2xvc2Uobm93LCBzZXNzaW9uSWQsIF9wcmljZUNsb3NlLCBwcmljZSwgcmF0ZSk7CiAgICAgICAgc2Vzc2lvbklkICs9IDE7CiAgICAgICAgCiAgICAgICAgLy8gcmVxdWlyZSghc2Vzc2lvbi5pc1Jlc2V0ICYmICFzZXNzaW9uLmlzT3Blbik7CiAgICAgICAgLy8gcmVzZXQgc3RhdGUgc2Vzc2lvbgogICAgICAgIHNlc3Npb24ucHJpY2VPcGVuID0gMDsKICAgICAgICBzZXNzaW9uLnByaWNlQ2xvc2UgPSAwOwogICAgICAgIHNlc3Npb24uaXNSZXNldCA9IHRydWU7CiAgICAgICAgc2Vzc2lvbi5pbnZlc3RPcGVuID0gZmFsc2U7CiAgICAgICAgc2Vzc2lvbi5pbnZlc3RvckNvdW50ID0gMDsKICAgIH0KfQoKCmNvbnRyYWN0IFByZXNhbGVUb2tlbiB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlT2Y7CiAgICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgX293bmVyKSBwdWJsaWM7Cn0KCiAvKgogKiBDb250cmFjdCB0aGF0IGlzIHdvcmtpbmcgd2l0aCBFUkMyMjMgdG9rZW5zCiAqLwogCiAvKioKICogQHRpdGxlIENvbnRyYWN0IHRoYXQgd2lsbCB3b3JrIHdpdGggRVJDMjIzIHRva2Vucy4KICovCiAKY29udHJhY3QgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewovKioKICogQGRldiBTdGFuZGFyZCBFUkMyMjMgZnVuY3Rpb24gdGhhdCB3aWxsIGhhbmRsZSBpbmNvbWluZyB0b2tlbiB0cmFuc2ZlcnMuCiAqCiAqIEBwYXJhbSBfZnJvbSAgVG9rZW4gc2VuZGVyIGFkZHJlc3MuCiAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2Vucy4KICogQHBhcmFtIF9kYXRhICBUcmFuc2FjdGlvbiBtZXRhZGF0YS4KICovCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrQnV5ZXIoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGFkZHJlc3MgX2J1eWVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2tFeGNoYW5nZShhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgdWludCBfcHJpY2UpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9CgoKIC8qCiAqIE5hbWkgSW50ZXJuYWwgRXhjaGFuZ2Ugc21hcnRjb250cmFjdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqCiAqLwoKY29udHJhY3QgTmFtaUV4Y2hhbmdlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogICAgCiAgICBmdW5jdGlvbiBOYW1pRXhjaGFuZ2UoYWRkcmVzcyBfbmFtaUFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgTmFtaUFkZHIgPSBfbmFtaUFkZHJlc3M7CiAgICB9CgogICAgZXZlbnQgVXBkYXRlQmlkKGFkZHJlc3Mgb3duZXIsIHVpbnQgcHJpY2UsIHVpbnQgYmFsYW5jZSk7CiAgICBldmVudCBVcGRhdGVBc2soYWRkcmVzcyBvd25lciwgdWludCBwcmljZSwgdWludCB2b2x1bWUpOwoKICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IE9yZGVyQmlkKSBwdWJsaWMgYmlkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IE9yZGVyQXNrKSBwdWJsaWMgYXNrOwogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIk5hY0V4Y2hhbmdlIjsKICAgIAogICAgLy8vIGFkZHJlc3Mgb2YgTmFtaSB0b2tlbgogICAgYWRkcmVzcyBOYW1pQWRkcjsKICAgIAogICAgLy8vIHByaWNlIG9mIE5hYyA9IEVUSC9OQUMKICAgIHVpbnQgcHVibGljIHByaWNlID0gMTsKICAgIHVpbnQgcHVibGljIGV0aGVyQmFsYW5jZT0wOwogICAgdWludCBwdWJsaWMgbmFjQmFsYW5jZT0wOwogICAgLy8gc3RydWN0IHN0b3JlIG9yZGVyIG9mIHVzZXIKICAgIHN0cnVjdCBPcmRlckJpZCB7CiAgICAgICAgdWludCBwcmljZTsKICAgICAgICB1aW50IGV0aDsKICAgIH0KICAgIAogICAgc3RydWN0IE9yZGVyQXNrIHsKICAgICAgICB1aW50IHByaWNlOwogICAgICAgIHVpbnQgdm9sdW1lOwogICAgfQogICAgCiAgICAgICAgCiAgICAvLyBwcmV2ZW50IGxvc3QgZXRoZXIKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgaWYgKGJpZFttc2cuc2VuZGVyXS5wcmljZSA+IDApIHsKICAgICAgICAgICAgYmlkW21zZy5zZW5kZXJdLmV0aCA9IChiaWRbbXNnLnNlbmRlcl0uZXRoKS5hZGQobXNnLnZhbHVlKTsKICAgICAgICAgICAgZXRoZXJCYWxhbmNlID0gZXRoZXJCYWxhbmNlLmFkZChtc2cudmFsdWUpOwogICAgICAgICAgICBVcGRhdGVCaWQobXNnLnNlbmRlciwgYmlkW21zZy5zZW5kZXJdLnByaWNlLCBiaWRbbXNnLnNlbmRlcl0uZXRoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWZ1bmQKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgICAgIH0KICAgICAgICAvLyB0ZXN0CiAgICAgICAgLy8gYWRkcmVzcyB0ZXN0ID0gIjB4NzBjOTMyMzY5ZmMxQzc2ZmRlNjg0RkYwNTk2NkE3MGI5YzE1NjFjMSI7CiAgICAgICAgLy8gdGVzdC50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgfQoKICAgIC8vIHByZXZlbnQgbG9zdCB0b2tlbgogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDAgJiYgX2RhdGEubGVuZ3RoID09IDApOwogICAgICAgIGlmIChhc2tbX2Zyb21dLnByaWNlID4gMCkgewogICAgICAgICAgICBhc2tbX2Zyb21dLnZvbHVtZSA9IChhc2tbX2Zyb21dLnZvbHVtZSkuYWRkKF92YWx1ZSk7CiAgICAgICAgICAgIG5hY0JhbGFuY2UgPSBuYWNCYWxhbmNlLmFkZChfdmFsdWUpOwogICAgICAgICAgICBVcGRhdGVBc2soX2Zyb20sIGFza1tfZnJvbV0ucHJpY2UsIGFza1tfZnJvbV0udm9sdW1lKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9yZWZ1bmQKICAgICAgICAgICAgRVJDMjMgYXNzZXQgPSBFUkMyMyhOYW1pQWRkcik7CiAgICAgICAgICAgIGFzc2V0LnRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5TmFtaSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IE5hbWlBZGRyKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAKICAgIC8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBmdW5jdGlvbiBhYm91dCBiaWQgT3JkZXItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgCiAgICBmdW5jdGlvbiBwbGFjZUJ1eU9yZGVyKHVpbnQgX3ByaWNlKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfcHJpY2UgPiAwKTsKICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkgewogICAgICAgICAgICBldGhlckJhbGFuY2UgKz0gbXNnLnZhbHVlOwogICAgICAgICAgICBiaWRbbXNnLnNlbmRlcl0uZXRoID0gKGJpZFttc2cuc2VuZGVyXS5ldGgpLmFkZChtc2cudmFsdWUpOwogICAgICAgICAgICBVcGRhdGVCaWQobXNnLnNlbmRlciwgX3ByaWNlLCBiaWRbbXNnLnNlbmRlcl0uZXRoKTsKICAgICAgICB9CiAgICAgICAgYmlkW21zZy5zZW5kZXJdLnByaWNlID0gX3ByaWNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrQnV5ZXIoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGFkZHJlc3MgX2J1eWVyKSBvbmx5TmFtaSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgRVJDMjMgYXNzZXQgPSBFUkMyMyhOYW1pQWRkcik7CiAgICAgICAgdWludCBjdXJyZW50RXRoID0gYmlkW19idXllcl0uZXRoOwogICAgICAgIGlmICgoX3ZhbHVlLmRpdihiaWRbX2J1eWVyXS5wcmljZSkpID4gY3VycmVudEV0aCkgewogICAgICAgICAgICBpZiAoX2Zyb20uc2VuZChjdXJyZW50RXRoKSAmJiBhc3NldC50cmFuc2ZlcihfYnV5ZXIsIGN1cnJlbnRFdGgubXVsKGJpZFtfYnV5ZXJdLnByaWNlKSkgJiYgYXNzZXQudHJhbnNmZXIoX2Zyb20sIF92YWx1ZSAtIChjdXJyZW50RXRoLm11bChiaWRbX2J1eWVyXS5wcmljZSkgKSApICkgewogICAgICAgICAgICAgICAgYmlkW19idXllcl0uZXRoID0gMDsKICAgICAgICAgICAgICAgIGV0aGVyQmFsYW5jZSA9IGV0aGVyQmFsYW5jZS5zdWIoY3VycmVudEV0aCk7CiAgICAgICAgICAgICAgICBVcGRhdGVCaWQoX2J1eWVyLCBiaWRbX2J1eWVyXS5wcmljZSwgYmlkW19idXllcl0uZXRoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcmVmdW5kIHRva2VuCiAgICAgICAgICAgICAgICBhc3NldC50cmFuc2ZlcihfZnJvbSwgX3ZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQgZXRoID0gX3ZhbHVlLmRpdihiaWRbX2J1eWVyXS5wcmljZSk7CiAgICAgICAgICAgIGlmIChfZnJvbS5zZW5kKGV0aCkgJiYgYXNzZXQudHJhbnNmZXIoX2J1eWVyLCBfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICBiaWRbX2J1eWVyXS5ldGggPSAoYmlkW19idXllcl0uZXRoKS5zdWIoZXRoKTsKICAgICAgICAgICAgICAgIGV0aGVyQmFsYW5jZSA9IGV0aGVyQmFsYW5jZS5zdWIoZXRoKTsKICAgICAgICAgICAgICAgIFVwZGF0ZUJpZChfYnV5ZXIsIGJpZFtfYnV5ZXJdLnByaWNlLCBiaWRbX2J1eWVyXS5ldGgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyByZWZ1bmQgdG9rZW4KICAgICAgICAgICAgICAgIGFzc2V0LnRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBjbG9zZUJpZE9yZGVyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGJpZFttc2cuc2VuZGVyXS5ldGggPiAwICYmIGJpZFttc2cuc2VuZGVyXS5wcmljZSA+IDApOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkW21zZy5zZW5kZXJdLmV0aCk7CiAgICAgICAgZXRoZXJCYWxhbmNlID0gZXRoZXJCYWxhbmNlLnN1YihiaWRbbXNnLnNlbmRlcl0uZXRoKTsKICAgICAgICBiaWRbbXNnLnNlbmRlcl0uZXRoID0gMDsKICAgICAgICBVcGRhdGVCaWQobXNnLnNlbmRlciwgYmlkW21zZy5zZW5kZXJdLnByaWNlLCBiaWRbbXNnLnNlbmRlcl0uZXRoKTsKICAgIH0KICAgIAoKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIGZ1bmN0aW9uIGFib3V0IGFzayBPcmRlci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBwbGFjZSBhc2sgb3JkZXIgYnkgc2VuZCBOQUMgdG8gY29udHJhY3QKICAgIAogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFja0V4Y2hhbmdlKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCB1aW50IF9wcmljZSkgb25seU5hbWkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3ByaWNlID4gMCk7CiAgICAgICAgaWYgKF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgbmFjQmFsYW5jZSA9IG5hY0JhbGFuY2UuYWRkKF92YWx1ZSk7CiAgICAgICAgICAgIGFza1tfZnJvbV0udm9sdW1lID0gKGFza1tfZnJvbV0udm9sdW1lKS5hZGQoX3ZhbHVlKTsKICAgICAgICAgICAgYXNrW19mcm9tXS5wcmljZSA9IF9wcmljZTsKICAgICAgICAgICAgVXBkYXRlQXNrKF9mcm9tLCBfcHJpY2UsIGFza1tfZnJvbV0udm9sdW1lKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXNrW19mcm9tXS5wcmljZSA9IF9wcmljZTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2xvc2VBc2tPcmRlcigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShhc2tbbXNnLnNlbmRlcl0udm9sdW1lID4gMCAmJiBhc2tbbXNnLnNlbmRlcl0ucHJpY2UgPiAwKTsKICAgICAgICBFUkMyMyBhc3NldCA9IEVSQzIzKE5hbWlBZGRyKTsKICAgICAgICBpZiAoYXNzZXQudHJhbnNmZXIobXNnLnNlbmRlciwgYXNrW21zZy5zZW5kZXJdLnZvbHVtZSkpIHsKICAgICAgICAgICAgbmFjQmFsYW5jZSA9IG5hY0JhbGFuY2Uuc3ViKGFza1ttc2cuc2VuZGVyXS52b2x1bWUpOwogICAgICAgICAgICBhc2tbbXNnLnNlbmRlcl0udm9sdW1lID0gMDsKICAgICAgICAgICAgVXBkYXRlQXNrKG1zZy5zZW5kZXIsIGFza1ttc2cuc2VuZGVyXS5wcmljZSwgMCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBidXlOYWMoYWRkcmVzcyBfc2VsbGVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDAgJiYgYXNrW19zZWxsZXJdLnZvbHVtZSA+IDAgJiYgYXNrW19zZWxsZXJdLnByaWNlID4gMCk7CiAgICAgICAgRVJDMjMgYXNzZXQgPSBFUkMyMyhOYW1pQWRkcik7CiAgICAgICAgdWludCBtYXhFdGggPSAoYXNrW19zZWxsZXJdLnZvbHVtZSkuZGl2KGFza1tfc2VsbGVyXS5wcmljZSk7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IG1heEV0aCkgewogICAgICAgICAgICBpZiAoX3NlbGxlci5zZW5kKG1heEV0aCkgJiYgbXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZS5zdWIobWF4RXRoKSkgJiYgYXNzZXQudHJhbnNmZXIobXNnLnNlbmRlciwgYXNrW19zZWxsZXJdLnZvbHVtZSkpIHsKICAgICAgICAgICAgICAgIG5hY0JhbGFuY2UgPSBuYWNCYWxhbmNlLnN1Yihhc2tbX3NlbGxlcl0udm9sdW1lKTsKICAgICAgICAgICAgICAgIGFza1tfc2VsbGVyXS52b2x1bWUgPSAwOwogICAgICAgICAgICAgICAgVXBkYXRlQXNrKF9zZWxsZXIsIGFza1tfc2VsbGVyXS5wcmljZSwgMCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vcmVmdW5kCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoX3NlbGxlci5zZW5kKG1zZy52YWx1ZSkgJiYgYXNzZXQudHJhbnNmZXIobXNnLnNlbmRlciwgKG1zZy52YWx1ZSkubXVsKGFza1tfc2VsbGVyXS5wcmljZSkpKSB7CiAgICAgICAgICAgICAgICB1aW50IG5hYyA9IChtc2cudmFsdWUpLm11bChhc2tbX3NlbGxlcl0ucHJpY2UpOwogICAgICAgICAgICAgICAgbmFjQmFsYW5jZSA9IG5hY0JhbGFuY2Uuc3ViKG5hYyk7CiAgICAgICAgICAgICAgICBhc2tbX3NlbGxlcl0udm9sdW1lID0gKGFza1tfc2VsbGVyXS52b2x1bWUpLnN1YihuYWMpOwogICAgICAgICAgICAgICAgVXBkYXRlQXNrKF9zZWxsZXIsIGFza1tfc2VsbGVyXS5wcmljZSwgYXNrW19zZWxsZXJdLnZvbHVtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vcmVmdW5kCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IEVSQzIzIHsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKCgovKgoqIE5hbWlNdWx0aVNpZ1dhbGxldCBzbWFydCBjb250cmFjdC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKi8KLy8vIEB0aXRsZSBNdWx0aXNpZ25hdHVyZSB3YWxsZXQgLSBBbGxvd3MgbXVsdGlwbGUgcGFydGllcyB0byBhZ3JlZSBvbiB0cmFuc2FjdGlvbnMgYmVmb3JlIGV4ZWN1dGlvbi4KY29udHJhY3QgTmFtaU11bHRpU2lnV2FsbGV0IHsKCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBNQVhfT1dORVJfQ09VTlQgPSA1MDsKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgUmV2b2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBTdWJtaXNzaW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IEV4ZWN1dGlvbih1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBFeGVjdXRpb25GYWlsdXJlKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IERlcG9zaXQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCB2YWx1ZSk7CiAgICBldmVudCBPd25lckFkZGl0aW9uKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7CiAgICBldmVudCBPd25lclJlbW92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlKHVpbnQgcmVxdWlyZWQpOwoKICAgIG1hcHBpbmcgKHVpbnQgPT4gVHJhbnNhY3Rpb24pIHB1YmxpYyB0cmFuc2FjdGlvbnM7CiAgICBtYXBwaW5nICh1aW50ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkpIHB1YmxpYyBjb25maXJtYXRpb25zOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNPd25lcjsKICAgIGFkZHJlc3NbXSBwdWJsaWMgb3duZXJzOwogICAgdWludCBwdWJsaWMgcmVxdWlyZWQ7CiAgICB1aW50IHB1YmxpYyB0cmFuc2FjdGlvbkNvdW50OwoKICAgIHN0cnVjdCBUcmFuc2FjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBkZXN0aW5hdGlvbjsKICAgICAgICB1aW50IHZhbHVlOwogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgYm9vbCBleGVjdXRlZDsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckV4aXN0cyhhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgcmVxdWlyZShpc093bmVyW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0cmFuc2FjdGlvbkV4aXN0cyh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICByZXF1aXJlKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5kZXN0aW5hdGlvbiAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXF1aXJlKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdENvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXF1aXJlKCFjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RFeGVjdXRlZCh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICByZXF1aXJlKCF0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZXhlY3V0ZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90TnVsbChhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkUmVxdWlyZW1lbnQodWludCBvd25lckNvdW50LCB1aW50IF9yZXF1aXJlZCkgewogICAgICAgIHJlcXVpcmUoIShvd25lckNvdW50ID4gTUFYX09XTkVSX0NPVU5UCiAgICAgICAgICAgIHx8IF9yZXF1aXJlZCA+IG93bmVyQ291bnQKICAgICAgICAgICAgfHwgX3JlcXVpcmVkID09IDAKICAgICAgICAgICAgfHwgb3duZXJDb3VudCA9PSAwKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbGxvd3MgdG8gZGVwb3NpdCBldGhlci4KICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQogICAgICAgICAgICBEZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3Igc2V0cyBpbml0aWFsIG93bmVycyBhbmQgcmVxdWlyZWQgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuCiAgICAvLy8gQHBhcmFtIF9vd25lcnMgTGlzdCBvZiBpbml0aWFsIG93bmVycy4KICAgIC8vLyBAcGFyYW0gX3JlcXVpcmVkIE51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gTmFtaU11bHRpU2lnV2FsbGV0KGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKCEoaXNPd25lcltfb3duZXJzW2ldXSB8fCBfb3duZXJzW2ldID09IDApKTsKICAgICAgICAgICAgaXNPd25lcltfb3duZXJzW2ldXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIG93bmVycyA9IF9vd25lcnM7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIGFkZCBhIG5ldyBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG5ldyBvd25lci4KICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KG93bmVyKQogICAgICAgIG5vdE51bGwob3duZXIpCiAgICAgICAgdmFsaWRSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoICsgMSwgcmVxdWlyZWQpCiAgICB7CiAgICAgICAgaXNPd25lcltvd25lcl0gPSB0cnVlOwogICAgICAgIG93bmVycy5wdXNoKG93bmVyKTsKICAgICAgICBPd25lckFkZGl0aW9uKG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVtb3ZlIGFuIG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIuCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcihhZGRyZXNzIG93bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlXYWxsZXQKICAgICAgICBvd25lckV4aXN0cyhvd25lcikKICAgIHsKICAgICAgICBpc093bmVyW293bmVyXSA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBvd25lcnNbb3duZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3duZXJzLmxlbmd0aCAtPSAxOwogICAgICAgIGlmIChyZXF1aXJlZCA+IG93bmVycy5sZW5ndGgpCiAgICAgICAgICAgIGNoYW5nZVJlcXVpcmVtZW50KG93bmVycy5sZW5ndGgpOwogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlcGxhY2UgYW4gb3duZXIgd2l0aCBhIG5ldyBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyIHRvIGJlIHJlcGxhY2VkLgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG5ldyBvd25lci4KICAgIGZ1bmN0aW9uIHJlcGxhY2VPd25lcihhZGRyZXNzIG93bmVyLCBhZGRyZXNzIG5ld093bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlXYWxsZXQKICAgICAgICBvd25lckV4aXN0cyhvd25lcikKICAgICAgICBvd25lckRvZXNOb3RFeGlzdChuZXdPd25lcikKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBuZXdPd25lcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgaXNPd25lcltuZXdPd25lcl0gPSB0cnVlOwogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7CiAgICAgICAgT3duZXJBZGRpdGlvbihuZXdPd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIGNoYW5nZSB0aGUgbnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gX3JlcXVpcmVkIE51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfcmVxdWlyZWQpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdhbGxldAogICAgICAgIHZhbGlkUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCwgX3JlcXVpcmVkKQogICAgewogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlKF9yZXF1aXJlZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIHN1Ym1pdCBhbmQgY29uZmlybSBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIHN1Ym1pdFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCB0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIHRyYW5zYWN0aW9uSWQgPSBhZGRUcmFuc2FjdGlvbihkZXN0aW5hdGlvbiwgdmFsdWUsIGRhdGEpOwogICAgICAgIGNvbmZpcm1UcmFuc2FjdGlvbih0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gY29uZmlybSBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQogICAgICAgIHRyYW5zYWN0aW9uRXhpc3RzKHRyYW5zYWN0aW9uSWQpCiAgICAgICAgbm90Q29uZmlybWVkKHRyYW5zYWN0aW9uSWQsIG1zZy5zZW5kZXIpCiAgICB7CiAgICAgICAgY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIHRyYW5zYWN0aW9uSWQpOwogICAgICAgIGV4ZWN1dGVUcmFuc2FjdGlvbih0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gcmV2b2tlIGEgY29uZmlybWF0aW9uIGZvciBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gcmV2b2tlQ29uZmlybWF0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQogICAgICAgIGNvbmZpcm1lZCh0cmFuc2FjdGlvbklkLCBtc2cuc2VuZGVyKQogICAgICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVttc2cuc2VuZGVyXSA9IGZhbHNlOwogICAgICAgIFJldm9jYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFueW9uZSB0byBleGVjdXRlIGEgY29uZmlybWVkIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gZXhlY3V0ZVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgICAgICBwdWJsaWMKICAgICAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIGlmIChpc0NvbmZpcm1lZCh0cmFuc2FjdGlvbklkKSkgewogICAgICAgICAgICAvLyBUcmFuc2FjdGlvbiB0eCA9IHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXTsKICAgICAgICAgICAgdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmV4ZWN1dGVkID0gdHJ1ZTsKICAgICAgICAgICAgLy8gdHguZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmRlc3RpbmF0aW9uLmNhbGwudmFsdWUodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLnZhbHVlKSh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZGF0YSkpIHsKICAgICAgICAgICAgICAgIEV4ZWN1dGlvbih0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIEV4ZWN1dGlvbkZhaWx1cmUodHJhbnNhY3Rpb25JZCk7CiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZXhlY3V0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjb25maXJtYXRpb24gc3RhdHVzIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBDb25maXJtYXRpb24gc3RhdHVzLgogICAgZnVuY3Rpb24gaXNDb25maXJtZWQodWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB1aW50IGNvdW50ID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIGlmIChjb3VudCA9PSByZXF1aXJlZCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IEFkZHMgYSBuZXcgdHJhbnNhY3Rpb24gdG8gdGhlIHRyYW5zYWN0aW9uIG1hcHBpbmcsIGlmIHRyYW5zYWN0aW9uIGRvZXMgbm90IGV4aXN0IHlldC4KICAgIC8vLyBAcGFyYW0gZGVzdGluYXRpb24gVHJhbnNhY3Rpb24gdGFyZ2V0IGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRyYW5zYWN0aW9uIGV0aGVyIHZhbHVlLgogICAgLy8vIEBwYXJhbSBkYXRhIFRyYW5zYWN0aW9uIGRhdGEgcGF5bG9hZC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBhZGRUcmFuc2FjdGlvbihhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKQogICAgICAgIGludGVybmFsCiAgICAgICAgbm90TnVsbChkZXN0aW5hdGlvbikKICAgICAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IHRyYW5zYWN0aW9uQ291bnQ7CiAgICAgICAgdHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdID0gVHJhbnNhY3Rpb24oewogICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sIAogICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgIGV4ZWN1dGVkOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHRyYW5zYWN0aW9uQ291bnQgKz0gMTsKICAgICAgICBTdWJtaXNzaW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8qCiAgICAgKiBXZWIzIGNhbGwgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9uQ291bnQodWludCB0cmFuc2FjdGlvbklkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWxlcnMgYXJlIGFwcGxpZWQuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBUb3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbHRlcnMgYXJlIGFwcGxpZWQuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbkNvdW50KGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgY291bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdHJhbnNhY3Rpb25Db3VudDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQgfHwgZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIG93bmVycy4KICAgIC8vLyBAcmV0dXJuIExpc3Qgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gb3duZXJzOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXJyYXkgd2l0aCBvd25lciBhZGRyZXNzZXMsIHdoaWNoIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9ucyh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10gX2NvbmZpcm1hdGlvbnMpCiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBjb25maXJtYXRpb25zVGVtcCA9IG5ldyBhZGRyZXNzW10ob3duZXJzLmxlbmd0aCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkgewogICAgICAgICAgICAgICAgY29uZmlybWF0aW9uc1RlbXBbY291bnRdID0gb3duZXJzW2ldOwogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfY29uZmlybWF0aW9ucyA9IG5ldyBhZGRyZXNzW10oY291bnQpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIF9jb25maXJtYXRpb25zW2ldID0gY29uZmlybWF0aW9uc1RlbXBbaV07CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiB0cmFuc2FjdGlvbiBJRHMgaW4gZGVmaW5lZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gZnJvbSBJbmRleCBzdGFydCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4KICAgIC8vLyBAcGFyYW0gdG8gSW5kZXggZW5kIHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiB0cmFuc2FjdGlvbiBJRHMuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbklkcyh1aW50IGZyb20sIHVpbnQgdG8sIGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnRbXSBfdHJhbnNhY3Rpb25JZHMpCiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSB0cmFuc2FjdGlvbklkc1RlbXAgPSBuZXcgdWludFtdKHRyYW5zYWN0aW9uQ291bnQpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdHJhbnNhY3Rpb25Db3VudDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQgfHwgZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSB7CiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbklkc1RlbXBbY291bnRdID0gaTsKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX3RyYW5zYWN0aW9uSWRzID0gbmV3IHVpbnRbXSh0byAtIGZyb20pOwogICAgICAgIGZvciAoaSA9IGZyb207IGkgPCB0bzsgaSsrKSB7CiAgICAgICAgICAgIF90cmFuc2FjdGlvbklkc1tpIC0gZnJvbV0gPSB0cmFuc2FjdGlvbklkc1RlbXBbaV07CiAgICAgICAgfQogICAgfQp9'.
	

]
