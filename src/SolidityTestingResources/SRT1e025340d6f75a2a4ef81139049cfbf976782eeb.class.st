Class {
	#name : #SRT1e025340d6f75a2a4ef81139049cfbf976782eeb,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1e025340d6f75a2a4ef81139049cfbf976782eeb >> base64 [
	^ 'Ly9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL0VSQzIwQmFzaWMuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL21hdGgvU2FmZU1hdGguc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvdG9rZW4vRVJDMjAvQmFzaWNUb2tlbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgdWludDI1NiB0b3RhbFN1cHBseV87CgogIC8qKgogICogQGRldiB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGluIGV4aXN0ZW5jZQogICovCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL0VSQzIwLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL3plcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9FUkMyMC9TdGFuZGFyZFRva2VuLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQGRldiBJbmNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gZGVjcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zdWJ0cmFjdGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gZGVjcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL293bmVyc2hpcC9Pd25hYmxlLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL01pbnRhYmxlVG9rZW4uc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCi8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKiBAZGV2IElzc3VlOiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvaXNzdWVzLzEyMAogKiBCYXNlZCBvbiBjb2RlIGJ5IFRva2VuTWFya2V0TmV0OiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseV8gPSB0b3RhbFN1cHBseV8uYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL2Nyb3dkc2FsZS9Dcm93ZHNhbGUuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCi8qKgogKiBAdGl0bGUgQ3Jvd2RzYWxlCiAqIEBkZXYgQ3Jvd2RzYWxlIGlzIGEgYmFzZSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCiAqIHRva2VuIHB1cmNoYXNlcyBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGFzc2lnbiB0aGVtIHRva2VucyBiYXNlZAogKiBvbiBhIHRva2VuIHBlciBFVEggcmF0ZS4gRnVuZHMgY29sbGVjdGVkIGFyZSBmb3J3YXJkZWQgdG8gYSB3YWxsZXQKICogYXMgdGhleSBhcnJpdmUuCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogIE1pbnRhYmxlVG9rZW4gcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogIC8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCiAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewogICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gZ2V0VG9rZW5BbW91bnQod2VpQW1vdW50KTsKCiAgICAvLyB1cGRhdGUgc3RhdGUKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgIGZvcndhcmRGdW5kcygpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQKICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmRUaW1lOwogIH0KCiAgLy8gY3JlYXRlcyB0aGUgdG9rZW4gdG8gYmUgc29sZC4KICAvLyBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBoYXZlIGNyb3dkc2FsZSBvZiBhIHNwZWNpZmljIG1pbnRhYmxlIHRva2VuLgogIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICByZXR1cm4gbmV3IE1pbnRhYmxlVG9rZW4oKTsKICB9CgogIC8vIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgYSB3YXkgdG8gYWRkIGJ1c2luZXNzIGxvZ2ljIHRvIHlvdXIgY3Jvd2RzYWxlIHdoZW4gYnV5aW5nCiAgZnVuY3Rpb24gZ2V0VG9rZW5BbW91bnQodWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICByZXR1cm4gd2VpQW1vdW50Lm11bChyYXRlKTsKICB9CgogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCB3aXRoaW5QZXJpb2QgPSBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lOwogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlOwogIH0KCn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL3plcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy9saWZlY3ljbGUvUGF1c2FibGUuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL1NhZmVFUkMyMC5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvdG9rZW4vRVJDMjAvVG9rZW5WZXN0aW5nLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCgoKCi8qKgogKiBAdGl0bGUgVG9rZW5WZXN0aW5nCiAqIEBkZXYgQSB0b2tlbiBob2xkZXIgY29udHJhY3QgdGhhdCBjYW4gcmVsZWFzZSBpdHMgdG9rZW4gYmFsYW5jZSBncmFkdWFsbHkgbGlrZSBhCiAqIHR5cGljYWwgdmVzdGluZyBzY2hlbWUsIHdpdGggYSBjbGlmZiBhbmQgdmVzdGluZyBwZXJpb2QuIE9wdGlvbmFsbHkgcmV2b2NhYmxlIGJ5IHRoZQogKiBvd25lci4KICovCmNvbnRyYWN0IFRva2VuVmVzdGluZyBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CgogIGV2ZW50IFJlbGVhc2VkKHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBSZXZva2VkKCk7CgogIC8vIGJlbmVmaWNpYXJ5IG9mIHRva2VucyBhZnRlciB0aGV5IGFyZSByZWxlYXNlZAogIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OwoKICB1aW50MjU2IHB1YmxpYyBjbGlmZjsKICB1aW50MjU2IHB1YmxpYyBzdGFydDsKICB1aW50MjU2IHB1YmxpYyBkdXJhdGlvbjsKCiAgYm9vbCBwdWJsaWMgcmV2b2NhYmxlOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyByZWxlYXNlZDsKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyByZXZva2VkOwoKICAvKioKICAgKiBAZGV2IENyZWF0ZXMgYSB2ZXN0aW5nIGNvbnRyYWN0IHRoYXQgdmVzdHMgaXRzIGJhbGFuY2Ugb2YgYW55IEVSQzIwIHRva2VuIHRvIHRoZQogICAqIF9iZW5lZmljaWFyeSwgZ3JhZHVhbGx5IGluIGEgbGluZWFyIGZhc2hpb24gdW50aWwgX3N0YXJ0ICsgX2R1cmF0aW9uLiBCeSB0aGVuIGFsbAogICAqIG9mIHRoZSBiYWxhbmNlIHdpbGwgaGF2ZSB2ZXN0ZWQuCiAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBhZGRyZXNzIG9mIHRoZSBiZW5lZmljaWFyeSB0byB3aG9tIHZlc3RlZCB0b2tlbnMgYXJlIHRyYW5zZmVycmVkCiAgICogQHBhcmFtIF9jbGlmZiBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBjbGlmZiBpbiB3aGljaCB0b2tlbnMgd2lsbCBiZWdpbiB0byB2ZXN0CiAgICogQHBhcmFtIF9kdXJhdGlvbiBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBwZXJpb2QgaW4gd2hpY2ggdGhlIHRva2VucyB3aWxsIHZlc3QKICAgKiBAcGFyYW0gX3Jldm9jYWJsZSB3aGV0aGVyIHRoZSB2ZXN0aW5nIGlzIHJldm9jYWJsZSBvciBub3QKICAgKi8KICBmdW5jdGlvbiBUb2tlblZlc3RpbmcoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZHVyYXRpb24sIGJvb2wgX3Jldm9jYWJsZSkgcHVibGljIHsKICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfY2xpZmYgPD0gX2R1cmF0aW9uKTsKCiAgICBiZW5lZmljaWFyeSA9IF9iZW5lZmljaWFyeTsKICAgIHJldm9jYWJsZSA9IF9yZXZvY2FibGU7CiAgICBkdXJhdGlvbiA9IF9kdXJhdGlvbjsKICAgIGNsaWZmID0gX3N0YXJ0LmFkZChfY2xpZmYpOwogICAgc3RhcnQgPSBfc3RhcnQ7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIFRyYW5zZmVycyB2ZXN0ZWQgdG9rZW5zIHRvIGJlbmVmaWNpYXJ5LgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiByZWxlYXNlKEVSQzIwQmFzaWMgdG9rZW4pIHB1YmxpYyB7CiAgICB1aW50MjU2IHVucmVsZWFzZWQgPSByZWxlYXNhYmxlQW1vdW50KHRva2VuKTsKCiAgICByZXF1aXJlKHVucmVsZWFzZWQgPiAwKTsKCiAgICByZWxlYXNlZFt0b2tlbl0gPSByZWxlYXNlZFt0b2tlbl0uYWRkKHVucmVsZWFzZWQpOwoKICAgIHRva2VuLnNhZmVUcmFuc2ZlcihiZW5lZmljaWFyeSwgdW5yZWxlYXNlZCk7CgogICAgUmVsZWFzZWQodW5yZWxlYXNlZCk7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIEFsbG93cyB0aGUgb3duZXIgdG8gcmV2b2tlIHRoZSB2ZXN0aW5nLiBUb2tlbnMgYWxyZWFkeSB2ZXN0ZWQKICAgKiByZW1haW4gaW4gdGhlIGNvbnRyYWN0LCB0aGUgcmVzdCBhcmUgcmV0dXJuZWQgdG8gdGhlIG93bmVyLgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiByZXZva2UoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHJldm9jYWJsZSk7CiAgICByZXF1aXJlKCFyZXZva2VkW3Rva2VuXSk7CgogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwoKICAgIHVpbnQyNTYgdW5yZWxlYXNlZCA9IHJlbGVhc2FibGVBbW91bnQodG9rZW4pOwogICAgdWludDI1NiByZWZ1bmQgPSBiYWxhbmNlLnN1Yih1bnJlbGVhc2VkKTsKCiAgICByZXZva2VkW3Rva2VuXSA9IHRydWU7CgogICAgdG9rZW4uc2FmZVRyYW5zZmVyKG93bmVyLCByZWZ1bmQpOwoKICAgIFJldm9rZWQoKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkIGJ1dCBoYXNuJ3QgYmVlbiByZWxlYXNlZCB5ZXQuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2FibGVBbW91bnQoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHZlc3RlZEFtb3VudCh0b2tlbikuc3ViKHJlbGVhc2VkW3Rva2VuXSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZXMgdGhlIGFtb3VudCB0aGF0IGhhcyBhbHJlYWR5IHZlc3RlZC4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gdmVzdGVkQW1vdW50KEVSQzIwQmFzaWMgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgY3VycmVudEJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB1aW50MjU2IHRvdGFsQmFsYW5jZSA9IGN1cnJlbnRCYWxhbmNlLmFkZChyZWxlYXNlZFt0b2tlbl0pOwoKICAgIGlmIChub3cgPCBjbGlmZikgewogICAgICByZXR1cm4gMDsKICAgIH0gZWxzZSBpZiAobm93ID49IHN0YXJ0LmFkZChkdXJhdGlvbikgfHwgcmV2b2tlZFt0b2tlbl0pIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0b3RhbEJhbGFuY2UubXVsKG5vdy5zdWIoc3RhcnQpKS5kaXYoZHVyYXRpb24pOwogICAgfQogIH0KfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwL1BhdXNhYmxlVG9rZW4uc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUgdG9rZW4KICogQGRldiBTdGFuZGFyZFRva2VuIG1vZGlmaWVkIHdpdGggcGF1c2FibGUgdHJhbnNmZXJzLgogKiovCmNvbnRyYWN0IFBhdXNhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgUGF1c2FibGUgewoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXR1cm4gc3VwZXIuaW5jcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX2FkZGVkVmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogIH0KfQoKLy9GaWxlOiBzcmMvY29udHJhY3RzL2ljby9EaXZpZGVuZFRva2VuLnNvbAovKioKICogQHRpdGxlIERpdmlkZW5kIGNvbnRyYWN0CiAqCiAqIEB2ZXJzaW9uIDEuMAogKiBAYXV0aG9yIFZhbGlkaXR5IExhYnMgQUcgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNmQwNDAzMGIwMjJkMWIwYzAxMDQwOTA0MTkxNDAxMGMwZjFlNDMwMjFmMGEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgogKi8KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgoKY29udHJhY3QgRGl2aWRlbmRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIHRpbWUgYmVmb3JlIGRpdmlkZW5kRW5kVGltZSBkdXJpbmcgd2hpY2ggZGl2aWRlbmQgY2Fubm90IGJlIGNsYWltZWQgYnkgdG9rZW4gaG9sZGVycwogICAgLy8gaW5zdGVhZCB0aGUgdW5jbGFpbWVkIGRpdmlkZW5kIGNhbiBiZSBjbGFpbWVkIGJ5IHRyZWFzdXJ5IGluIHRoYXQgdGltZSBzcGFuCiAgICB1aW50MjU2IHB1YmxpYyBjbGFpbVRpbWVvdXQgPSAyMCBkYXlzOwoKICAgIHVpbnQyNTYgcHVibGljIGRpdmlkZW5kQ3ljbGVUaW1lID0gMzUwIGRheXM7CgogICAgdWludDI1NiBwdWJsaWMgY3VycmVudERpdmlkZW5kOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSB1bmNsYWltZWREaXZpZGVuZDsKCiAgICAvLyB0cmFja3Mgd2hlbiB0aGUgZGl2aWRlbmQgYmFsYW5jZSBoYXMgYmVlbiB1cGRhdGVkIGxhc3QgdGltZQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBsYXN0VXBkYXRlOwoKICAgIHVpbnQyNTYgcHVibGljIGxhc3REaXZpZGVuZEluY3JlYXNlRGF0ZTsKCiAgICAvLyBhbGxvdyBwYXltZW50IG9mIGRpdmlkZW5kIG9ubHkgYnkgc3BlY2lhbCB0cmVhc3VyeSBhY2NvdW50ICh0cmVhc3VyeSBjYW4gYmUgc2V0IGFuZCBhbHRlcmVkIGJ5IG93bmVyLAogICAgLy8gbXVsdGlwbGUgdHJlYXN1cmVyIGFjY291bnRzIGFyZSBwb3NzaWJsZQogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc1RyZWFzdXJlcjsKCiAgICB1aW50MjU2IHB1YmxpYyBkaXZpZGVuZEVuZFRpbWUgPSAwOwoKICAgIGV2ZW50IFBheWluKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfZW5kVGltZSk7CgogICAgZXZlbnQgUGF5b3V0KGFkZHJlc3MgX3Rva2VuSG9sZGVyLCB1aW50MjU2IF92YWx1ZSk7CgogICAgZXZlbnQgUmVjbGFpbWVkKHVpbnQyNTYgcmVtYWluaW5nQmFsYW5jZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfbm93KTsKCiAgICBldmVudCBDaGFuZ2VkVHJlYXN1cmVyKGFkZHJlc3MgdHJlYXN1cmVyLCBib29sIGFjdGl2ZSk7CgogICAgLyoqCiAgICAgKiBAZGV2IERlcGxveSB0aGUgRGl2aWRlbmRUb2tlbiBjb250cmFjdCBhbmQgc2V0IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gRGl2aWRlbmRUb2tlbigpIHB1YmxpYyB7CiAgICAgICAgaXNUcmVhc3VyZXJbb3duZXJdID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmVxdWVzdCBwYXlvdXQgZGl2aWRlbmQgKGNsYWltKSAocmVxdWVzdGVkIGJ5IHRva2VuSG9sZGVyIC0+IHB1bGwpCiAgICAgKiBkaXZpZGVuZHMgdGhhdCBoYXZlIG5vdCBiZWVuIGNsYWltZWQgd2l0aGluIDMzMCBkYXlzIGV4cGlyZSBhbmQgY2Fubm90IGJlIGNsYWltZWQgYW55bW9yZSBieSB0aGUgdG9rZW4gaG9sZGVyLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbURpdmlkZW5kKCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyB1bmNsYWltZWQgZGl2aWRlbmQgZnJhY3Rpb25zIHNob3VsZCBleHBpcmUgYWZ0ZXIgMzMwIGRheXMgYW5kIHRoZSBvd25lciBjYW4gcmVjbGFpbSB0aGF0IGZyYWN0aW9uCiAgICAgICAgcmVxdWlyZShkaXZpZGVuZEVuZFRpbWUgPiAwICYmIGRpdmlkZW5kRW5kVGltZS5zdWIoY2xhaW1UaW1lb3V0KSA+IG5vdyk7CgogICAgICAgIHVwZGF0ZURpdmlkZW5kKG1zZy5zZW5kZXIpOwoKICAgICAgICB1aW50MjU2IHBheW1lbnQgPSB1bmNsYWltZWREaXZpZGVuZFttc2cuc2VuZGVyXTsKICAgICAgICB1bmNsYWltZWREaXZpZGVuZFttc2cuc2VuZGVyXSA9IDA7CgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocGF5bWVudCk7CgogICAgICAgIC8vIFRyaWdnZXIgcGF5b3V0IGV2ZW50CiAgICAgICAgUGF5b3V0KG1zZy5zZW5kZXIsIHBheW1lbnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgZGl2aWRlbmQgKGZyYWN0aW9uKSB0byBuZXcgdG9rZW4gaG9sZGVyCiAgICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgb2xkIHRva2VuIGhvbGRlcgogICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gaG9sZGVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckRpdmlkZW5kKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgewogICAgICAgIHVwZGF0ZURpdmlkZW5kKF9mcm9tKTsKICAgICAgICB1cGRhdGVEaXZpZGVuZChfdG8pOwoKICAgICAgICB1aW50MjU2IHRyYW5zQW1vdW50ID0gdW5jbGFpbWVkRGl2aWRlbmRbX2Zyb21dLm11bChfdmFsdWUpLmRpdihiYWxhbmNlT2YoX2Zyb20pKTsKCiAgICAgICAgdW5jbGFpbWVkRGl2aWRlbmRbX2Zyb21dID0gdW5jbGFpbWVkRGl2aWRlbmRbX2Zyb21dLnN1Yih0cmFuc0Ftb3VudCk7CiAgICAgICAgdW5jbGFpbWVkRGl2aWRlbmRbX3RvXSA9IHVuY2xhaW1lZERpdmlkZW5kW190b10uYWRkKHRyYW5zQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHRoZSBkaXZpZGVuZCBvZiBob2RsZXIKICAgICAqIEBwYXJhbSBfaG9kbGVyIGFkZHJlc3MgVGhlIEFkZHJlc3Mgb2YgdGhlIGhvZGxlcgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVEaXZpZGVuZChhZGRyZXNzIF9ob2RsZXIpIGludGVybmFsIHsKICAgICAgICAvLyBsYXN0IHVwZGF0ZSBpbiBwcmV2aW91cyBwZXJpb2QgLT4gcmVzZXQgY2xhaW1hYmxlIGRpdmlkZW5kCiAgICAgICAgaWYgKGxhc3RVcGRhdGVbX2hvZGxlcl0gPCBsYXN0RGl2aWRlbmRJbmNyZWFzZURhdGUpIHsKICAgICAgICAgICAgdW5jbGFpbWVkRGl2aWRlbmRbX2hvZGxlcl0gPSBjYWxjRGl2aWRlbmQoX2hvZGxlciwgdG90YWxTdXBwbHlfKTsKICAgICAgICAgICAgbGFzdFVwZGF0ZVtfaG9kbGVyXSA9IG5vdzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEdldCBjbGFpbWFibGUgZGl2aWRlbmQgZm9yIHRoZSBob2RsZXIKICAgICAqIEBwYXJhbSBfaG9kbGVyIGFkZHJlc3MgVGhlIEFkZHJlc3Mgb2YgdGhlIGhvZGxlcgogICAgICovCiAgICBmdW5jdGlvbiBnZXRDbGFpbWFibGVEaXZpZGVuZChhZGRyZXNzIF9ob2RsZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGNsYWltYWJsZURpdmlkZW5kKSB7CiAgICAgICAgaWYgKGxhc3RVcGRhdGVbX2hvZGxlcl0gPCBsYXN0RGl2aWRlbmRJbmNyZWFzZURhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGNEaXZpZGVuZChfaG9kbGVyLCB0b3RhbFN1cHBseV8pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAodW5jbGFpbWVkRGl2aWRlbmRbX2hvZGxlcl0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgT3ZlcnJpZGVzIHRyYW5zZmVyIG1ldGhvZCBmcm9tIEJhc2ljVG9rZW4KICAgICAqIHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHRyYW5zZmVyRGl2aWRlbmQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoKICAgICAgICAvLyBSZXR1cm4gZnJvbSBpbmhlcml0ZWQgdHJhbnNmZXIgbWV0aG9kCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBQcmV2ZW50IGRpdmlkZW5kIHRvIGJlIGNsYWltZWQgdHdpY2UKICAgICAgICB0cmFuc2ZlckRpdmlkZW5kKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIC8vIFJldHVybiBmcm9tIGluaGVyaXRlZCB0cmFuc2ZlckZyb20gbWV0aG9kCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgLyBhbHRlciB0cmVhc3VyZXIgImFjY291bnQiLiBUaGlzIGNhbiBiZSBkb25lIGZyb20gb3duZXIgb25seQogICAgICogQHBhcmFtIF90cmVhc3VyZXIgYWRkcmVzcyBBZGRyZXNzIG9mIHRoZSB0cmVhc3VyZXIgdG8gY3JlYXRlL2FsdGVyCiAgICAgKiBAcGFyYW0gX2FjdGl2ZSBib29sIEZsYWcgdGhhdCBzaG93cyBpZiB0aGUgdHJlYXN1cmVyIGFjY291bnQgaXMgYWN0aXZlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFRyZWFzdXJlcihhZGRyZXNzIF90cmVhc3VyZXIsIGJvb2wgX2FjdGl2ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaXNUcmVhc3VyZXJbX3RyZWFzdXJlcl0gPSBfYWN0aXZlOwogICAgICAgIENoYW5nZWRUcmVhc3VyZXIoX3RyZWFzdXJlciwgX2FjdGl2ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlcXVlc3QgdW5jbGFpbWVkIEVUSCwgcGF5YmFjayB0byBiZW5lZmljaWFyeSAob3duZXIpIHdhbGxldAogICAgICogZGl2aWRlbmQgcGF5bWVudCBpcyBwb3NzaWJsZSBldmVyeSAzMzAgZGF5cyBhdCB0aGUgZWFybGllc3QgLSBjYW4gYmUgbGF0ZXIsIHRoaXMgYWxsb3dzIGZvciBzb21lIGZsZXhpYmlsaXR5LAogICAgICogZS5nLiBib2FyZCBtZWV0aW5nIGhhZCB0byBoYXBwZW4gYSBiaXQgZWFybGllciB0aGlzIHllYXIgdGhhbiBwcmV2aW91cyB5ZWFyLgogICAgICovCiAgICBmdW5jdGlvbiByZXF1ZXN0VW5jbGFpbWVkKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgLy8gU2VuZCByZW1haW5pbmcgRVRIIHRvIGJlbmVmaWNpYXJ5IChiYWNrIHRvIG93bmVyKSBpZiBkaXZpZGVuZCByb3VuZCBpcyBvdmVyCiAgICAgICAgcmVxdWlyZShub3cgPj0gZGl2aWRlbmRFbmRUaW1lLnN1YihjbGFpbVRpbWVvdXQpKTsKCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoKICAgICAgICBSZWNsYWltZWQodGhpcy5iYWxhbmNlLCBkaXZpZGVuZEVuZFRpbWUsIG5vdyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEVUSCBQYXlpbiBmb3IgVHJlYXN1cmVyCiAgICAgKiBPbmx5IG93bmVyIG9yIHRyZWFzdXJlciBjYW4gZG8gYSBwYXlpbiBmb3IgYWxsIHRva2VuIGhvbGRlci4KICAgICAqIE93bmVyIC8gdHJlYXN1cmVyIGNhbiBhbHNvIGluY3JlYXNlIGRpdmlkZW5kIGJ5IGNhbGxpbmcgZmFsbGJhY2sgZnVuY3Rpb24gbXVsdGlwbGUgdGltZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNUcmVhc3VyZXJbbXNnLnNlbmRlcl0pOwogICAgICAgIHJlcXVpcmUoZGl2aWRlbmRFbmRUaW1lIDwgbm93KTsKCiAgICAgICAgLy8gcGF5IGJhY2sgdW5jbGFpbWVkIGRpdmlkZW5kIHRoYXQgbWlnaHQgbm90IGhhdmUgYmVlbiBjbGFpbWVkIGJ5IG93bmVyIHlldAogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPiBtc2cudmFsdWUpIHsKICAgICAgICAgICAgdWludDI1NiBwYXlvdXQgPSB0aGlzLmJhbGFuY2Uuc3ViKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHBheW91dCk7CiAgICAgICAgICAgIFJlY2xhaW1lZChwYXlvdXQsIGRpdmlkZW5kRW5kVGltZSwgbm93KTsKICAgICAgICB9CgogICAgICAgIGN1cnJlbnREaXZpZGVuZCA9IHRoaXMuYmFsYW5jZTsKCiAgICAgICAgLy8gTm8gYWN0aXZlIGRpdmlkZW5kIGN5Y2xlIGZvdW5kLCBpbml0aWFsaXplIG5ldyByb3VuZAogICAgICAgIGRpdmlkZW5kRW5kVGltZSA9IG5vdy5hZGQoZGl2aWRlbmRDeWNsZVRpbWUpOwoKICAgICAgICAvLyBUcmlnZ2VyIHBheWluIGV2ZW50CiAgICAgICAgUGF5aW4obXNnLnNlbmRlciwgbXNnLnZhbHVlLCBkaXZpZGVuZEVuZFRpbWUpOwoKICAgICAgICBsYXN0RGl2aWRlbmRJbmNyZWFzZURhdGUgPSBub3c7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGN1bGF0ZSB0aGUgZGl2aWRlbmQKICAgICAqIEBwYXJhbSBfaG9kbGVyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfdG90YWxTdXBwbHkgdWludDI1NgogICAgICovCiAgICBmdW5jdGlvbiBjYWxjRGl2aWRlbmQoYWRkcmVzcyBfaG9kbGVyLCB1aW50MjU2IF90b3RhbFN1cHBseSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIChjdXJyZW50RGl2aWRlbmQubXVsKGJhbGFuY2VPZihfaG9kbGVyKSkpLmRpdihfdG90YWxTdXBwbHkpOwogICAgfQp9CgovL0ZpbGU6IHNyYy9jb250cmFjdHMvaWNvL0ljb1Rva2VuLnNvbAovKioKICogQHRpdGxlIElDTyB0b2tlbgogKiBAdmVyc2lvbiAxLjAKICogQGF1dGhvciBWYWxpZGl0eSBMYWJzIEFHIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjlkZjRmM2ZiZjJkZGViZmNmMWY0ZjlmNGU5ZTRmMWZjZmZlZWIzZjJlZmZhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KICovCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCmNvbnRyYWN0IEljb1Rva2VuIGlzIE1pbnRhYmxlVG9rZW4sIFBhdXNhYmxlVG9rZW4sIERpdmlkZW5kVG9rZW4gewogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlRlbmQgVG9rZW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiVE5EIjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIC8qKgogICAgICogQGRldiBDb25zdHJ1Y3RvciBvZiBJY29Ub2tlbiB0aGF0IGluc3RhbnRpYXRlIGEgbmV3IERpdmlkZW5kVG9rZW4KICAgICAqLwogICAgZnVuY3Rpb24gSWNvVG9rZW4oKSBwdWJsaWMgRGl2aWRlbmRUb2tlbigpIHsKICAgICAgICAvLyB0b2tlbiBzaG91bGQgbm90IGJlIHRyYW5zZmVycmFibGUgdW50aWwgYWZ0ZXIgYWxsIHRva2VucyBoYXZlIGJlZW4gaXNzdWVkCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KfQoKLy9GaWxlOiBzcmMvY29udHJhY3RzL2ljby9JY29Dcm93ZHNhbGUuc29sCi8qKgogKiBAdGl0bGUgSWNvQ3Jvd2RzYWxlCiAqIFNpbXBsZSB0aW1lIGFuZCBjYXBwZWQgYmFzZWQgY3Jvd2RzYWxlLgogKgogKiBAdmVyc2lvbiAxLjAKICogQGF1dGhvciBWYWxpZGl0eSBMYWJzIEFHIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjBkNjQ2MzZiNjI0ZDdiNmM2MTY0Njk2NDc5NzQ2MTZjNmY3ZTIzNjI3ZjZhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KICovCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCgoKY29udHJhY3QgSWNvQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgT3duYWJsZSB7CiAgICAvKioqIENPTlNUQU5UUyAqKiovCiAgICAvLyBEaWZmZXJlbnQgbGV2ZWxzIG9mIGNhcHMgcGVyIGFsbG90bWVudAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUFYX1RPS0VOX0NBUCA9IDEzZTYgKiAxZTE4OyAgICAgICAgLy8gMTMgbWlsbGlvbiAqIDFlMTgKCiAgICAvLyAvLyBCb3R0b20gdGhyZWUgc2hvdWxkIGFkZCB0byBhYm92ZQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSUNPX0VOQUJMRVJTX0NBUCA9IDE1ZTUgKiAxZTE4OyAgICAgLy8gMS41IG1pbGxpb24gKiAxZTE4CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBERVZFTE9QTUVOVF9URUFNX0NBUCA9IDJlNiAqIDFlMTg7ICAvLyAyIG1pbGxpb24gKiAxZTE4CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJQ09fVE9LRU5fQ0FQID0gOS41ZTYgKiAxZTE4OyAgICAgICAgLy8gOS41IG1pbGxpb24gICogMWUxOAoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENIRl9DRU5UX1BFUl9UT0tFTiA9IDEwMDA7ICAgICAgICAgIC8vIHN0YW5kYXJkIENIRiBwZXIgdG9rZW4gcmF0ZSAtIGluIGNlbnRzIC0gMTAgQ0hGID0+IDEwMDAgQ0hGIGNlbnRzCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBNSU5fQ09OVFJJQlVUSU9OX0NIRiA9IDI1MDsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBWRVNUSU5HX0NMSUZGID0gMSB5ZWFyczsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFZFU1RJTkdfRFVSQVRJT04gPSAzIHllYXJzOwoKICAgIC8vIEFtb3VudCBvZiBkaXNjb3VudGVkIHRva2VucyBwZXIgZGlzY291bnQgc3RhZ2UgKDIgc3RhZ2VzIHRvdGFsOyBlYWNoIGJlaW5nIHRoZSBzYW1lIGFtb3VudCkKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IERJU0NPVU5UX1RPS0VOX0FNT1VOVF9UMSA9IDNlNiAqIDFlMTg7IC8vIDMgbWlsbGlvbiAqIDFlMTgKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IERJU0NPVU5UX1RPS0VOX0FNT1VOVF9UMiA9IERJU0NPVU5UX1RPS0VOX0FNT1VOVF9UMSAqIDI7CgogICAgLy8gVHJhY2sgdG9rZW5zIGRlcGVuZGluZyB3aGljaCBzdGFnZSB0aGF0IHRoZSBJQ08gaXMgaW4KICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1RvTWludDsgICAgICAgICAgICAvLyB0b2tlbnMgdG8gYmUgbWludGVkIGFmdGVyIGNvbmZpcm1hdGlvbgogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zTWludGVkOyAgICAgICAgICAgIC8vIGFscmVhZHkgbWludGVkIHRva2VucyAobWF4aW1hbGx5ID0gY2FwKQogICAgdWludDI1NiBwdWJsaWMgaWNvRW5hYmxlcnNUb2tlbnNNaW50ZWQ7CiAgICB1aW50MjU2IHB1YmxpYyBkZXZlbG9wbWVudFRlYW1Ub2tlbnNNaW50ZWQ7CgogICAgdWludDI1NiBwdWJsaWMgbWluQ29udHJpYnV0aW9uSW5XZWk7CiAgICB1aW50MjU2IHB1YmxpYyB0b2tlblBlcldlaTsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVG9rZW5zUHVyY2hhc2VkOwogICAgYm9vbCBwdWJsaWMgY2FwUmVhY2hlZDsKICAgIGJvb2wgcHVibGljIHRpZXIxUmVhY2hlZDsKICAgIGJvb2wgcHVibGljIHRpZXIyUmVhY2hlZDsKCiAgICBhZGRyZXNzIHB1YmxpYyB1bmRlcndyaXRlcjsKCiAgICAvLyBhbGxvdyBtYW5hZ2VycyB0byBibGFja2xpc3QgYW5kIGNvbmZpcm0gY29udHJpYnV0aW9ucyBieSBtYW5hZ2VyIGFjY291bnRzCiAgICAvLyAobWFuYWdlcnMgY2FuIGJlIHNldCBhbmQgYWx0ZXJlZCBieSBvd25lciwgbXVsdGlwbGUgbWFuYWdlciBhY2NvdW50cyBhcmUgcG9zc2libGUKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNNYW5hZ2VyOwoKICAgIC8vIHRydWUgaWYgYWRkZXNzIGlzIG5vdCBhbGxvd2VkIHRvIGludmVzdAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0JsYWNrbGlzdGVkOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbmZpcm1hdGlvblBlcmlvZDsKICAgIGJvb2wgcHVibGljIGNvbmZpcm1hdGlvblBlcmlvZE92ZXI7ICAgICAvLyBjYW4gYmUgc2V0IGJ5IG93bmVyIHRvIGZpbmlzaCBjb25maXJtYXRpb24gaW4gdW5kZXIgMzAgZGF5cwoKICAgIC8vIGZvciBjb252ZW5pZW5jZSB3ZSBzdG9yZSB2ZXN0aW5nIHdhbGxldHMKICAgIGFkZHJlc3NbXSBwdWJsaWMgdmVzdGluZ1dhbGxldHM7CgogICAgdWludDI1NiBwdWJsaWMgaW52ZXN0bWVudElkTGFzdEF0dGVtcHRlZFRvU2V0dGxlOwoKICAgIHN0cnVjdCBQYXltZW50IHsKICAgICAgICBhZGRyZXNzIGludmVzdG9yOwogICAgICAgIGFkZHJlc3MgYmVuZWZpY2lhcnk7CiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQ7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudDsKICAgICAgICBib29sIGNvbmZpcm1lZDsKICAgICAgICBib29sIGF0dGVtcHRlZFNldHRsZW1lbnQ7CiAgICAgICAgYm9vbCBjb21wbGV0ZWRTZXR0bGVtZW50OwogICAgfQoKICAgIFBheW1lbnRbXSBwdWJsaWMgaW52ZXN0bWVudHM7CgogICAgLyoqKiBFVkVOVFMgKioqLwogICAgZXZlbnQgQ2hhbmdlZEludmVzdG9yQmxhY2tsaXN0aW5nKGFkZHJlc3MgaW52ZXN0b3IsIGJvb2wgYmxhY2tsaXN0ZWQpOwogICAgZXZlbnQgQ2hhbmdlZE1hbmFnZXIoYWRkcmVzcyBtYW5hZ2VyLCBib29sIGFjdGl2ZSk7CiAgICBldmVudCBDaGFuZ2VkSW52ZXN0bWVudENvbmZpcm1hdGlvbih1aW50MjU2IGludmVzdG1lbnRJZCwgYWRkcmVzcyBpbnZlc3RvciwgYm9vbCBjb25maXJtZWQpOwoKICAgIC8qKiogTU9ESUZJRVJTICoqKi8KICAgIG1vZGlmaWVyIG9ubHlVbmRlcndyaXRlcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdW5kZXJ3cml0ZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShpc01hbmFnZXJbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU5vbmVaZXJvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9hbW91bnQgPiAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDb25maXJtUGF5bWVudCgpIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGVuZFRpbWUgJiYgbm93IDw9IGVuZFRpbWUuYWRkKGNvbmZpcm1hdGlvblBlcmlvZCkpOwogICAgICAgIHJlcXVpcmUoIWNvbmZpcm1hdGlvblBlcmlvZE92ZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNvbmZpcm1hdGlvbk92ZXIoKSB7CiAgICAgICAgcmVxdWlyZShjb25maXJtYXRpb25QZXJpb2RPdmVyIHx8IG5vdyA+IGVuZFRpbWUuYWRkKGNvbmZpcm1hdGlvblBlcmlvZCkpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IERlcGxveSBjYXBwZWQgaWNvIGNyb3dkc2FsZSBjb250cmFjdAogICAgICogQHBhcmFtIF9zdGFydFRpbWUgdWludDI1NiBTdGFydCB0aW1lIG9mIHRoZSBjcm93ZHNhbGUKICAgICAqIEBwYXJhbSBfZW5kVGltZSB1aW50MjU2IEVuZCB0aW1lIG9mIHRoZSBjcm93ZHNhbGUKICAgICAqIEBwYXJhbSBfcmF0ZUNoZlBlckV0aCB1aW50MjU2IENIRiBwZXIgRVRIIHJhdGUKICAgICAqIEBwYXJhbSBfd2FsbGV0IGFkZHJlc3MgV2FsbGV0IGFkZHJlc3Mgb2YgdGhlIGNyb3dkc2FsZQogICAgICogQHBhcmFtIF9jb25maXJtYXRpb25QZXJpb2REYXlzIHVpbnQyNTYgQ29uZmlybWF0aW9uIHBlcmlvZCBpbiBkYXlzCiAgICAgKiBAcGFyYW0gX3VuZGVyd3JpdGVyIGFkZHJlc3Mgb2YgdGhlIHVuZGVyd3JpdGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIEljb0Nyb3dkc2FsZSgKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsCiAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICB1aW50MjU2IF9yYXRlQ2hmUGVyRXRoLAogICAgICAgIGFkZHJlc3MgX3dhbGxldCwKICAgICAgICB1aW50MjU2IF9jb25maXJtYXRpb25QZXJpb2REYXlzLAogICAgICAgIGFkZHJlc3MgX3VuZGVyd3JpdGVyCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgQ3Jvd2RzYWxlKF9zdGFydFRpbWUsIF9lbmRUaW1lLCBfcmF0ZUNoZlBlckV0aCwgX3dhbGxldCkKICAgIHsKICAgICAgICByZXF1aXJlKE1BWF9UT0tFTl9DQVAgPT0gSUNPX0VOQUJMRVJTX0NBUC5hZGQoSUNPX1RPS0VOX0NBUCkuYWRkKERFVkVMT1BNRU5UX1RFQU1fQ0FQKSk7CiAgICAgICAgcmVxdWlyZShfdW5kZXJ3cml0ZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHNldE1hbmFnZXIobXNnLnNlbmRlciwgdHJ1ZSk7CgogICAgICAgIHRva2VuUGVyV2VpID0gKF9yYXRlQ2hmUGVyRXRoLm11bCgxZTIpKS5kaXYoQ0hGX0NFTlRfUEVSX1RPS0VOKTsKICAgICAgICBtaW5Db250cmlidXRpb25JbldlaSA9IChNSU5fQ09OVFJJQlVUSU9OX0NIRi5tdWwoMWUxOCkpLmRpdihfcmF0ZUNoZlBlckV0aCk7CgogICAgICAgIGNvbmZpcm1hdGlvblBlcmlvZCA9IF9jb25maXJtYXRpb25QZXJpb2REYXlzICogMSBkYXlzOwogICAgICAgIHVuZGVyd3JpdGVyID0gX3VuZGVyd3JpdGVyOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgLyBhbHRlciBtYW5hZ2VyIC8gYmxhY2tsaXN0ZXIgYWNjb3VudC4gVGhpcyBjYW4gYmUgZG9uZSBmcm9tIG93bmVyIG9ubHkKICAgICAqIEBwYXJhbSBfbWFuYWdlciBhZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIG1hbmFnZXIgdG8gY3JlYXRlL2FsdGVyCiAgICAgKiBAcGFyYW0gX2FjdGl2ZSBib29sIGZsYWcgdGhhdCBzaG93cyBpZiB0aGUgbWFuYWdlciBhY2NvdW50IGlzIGFjdGl2ZQogICAgICovCiAgICBmdW5jdGlvbiBzZXRNYW5hZ2VyKGFkZHJlc3MgX21hbmFnZXIsIGJvb2wgX2FjdGl2ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaXNNYW5hZ2VyW19tYW5hZ2VyXSA9IF9hY3RpdmU7CiAgICAgICAgQ2hhbmdlZE1hbmFnZXIoX21hbmFnZXIsIF9hY3RpdmUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBibGFja2xpc3QgaW52ZXN0b3IgZnJvbSBwYXJ0aWNpcGF0aW5nIGluIHRoZSBjcm93ZHNhbGUKICAgICAqIEBwYXJhbSBfaW52ZXN0b3IgYWRkcmVzcyBhZGRyZXNzIG9mIHRoZSBpbnZlc3RvciB0byBkaXNhbGxvd2VkIHBhcnRpY2lwYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gYmxhY2tMaXN0SW52ZXN0b3IoYWRkcmVzcyBfaW52ZXN0b3IsIGJvb2wgX2FjdGl2ZSkgcHVibGljIG9ubHlNYW5hZ2VyIHsKICAgICAgICBpc0JsYWNrbGlzdGVkW19pbnZlc3Rvcl0gPSBfYWN0aXZlOwogICAgICAgIENoYW5nZWRJbnZlc3RvckJsYWNrbGlzdGluZyhfaW52ZXN0b3IsIF9hY3RpdmUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBvdmVycmlkZSAobm90IGV4dGVuZCEgYmVjYXVzZSB3ZSBvbmx5IGlzc3VlcyB0b2tlbnMgYWZ0ZXIgZmluYWwgS1lDIGNvbmZpcm0gcGhhc2UpCiAgICAgKiAgICAgIGNvcmUgZnVuY3Rpb25hbGl0eSBieSBibGFja2xpc3QgY2hlY2sgYW5kIHJlZ2lzdHJhdGlvbiBvZiBwYXltZW50CiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IGFkZHJlc3MgYWRkcmVzcyBvZiB0aGUgYmVuZWZpY2lhcnkgdG8gcmVjZWl2ZSB0b2tlbnMgYWZ0ZXIgdGhleSBoYXZlIGJlZW4gY29uZmlybWVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKICAgICAgICByZXF1aXJlKCFpc0JsYWNrbGlzdGVkW21zZy5zZW5kZXJdKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudDsKICAgICAgICB1aW50MjU2IHB1cmNoYXNlZFRva2VucyA9IHdlaUFtb3VudC5tdWwodG9rZW5QZXJXZWkpOwogICAgICAgIHVpbnQyNTYgdGVtcFRvdGFsVG9rZW5zUHVyY2hhc2VkID0gdG90YWxUb2tlbnNQdXJjaGFzZWQuYWRkKHB1cmNoYXNlZFRva2Vucyk7CiAgICAgICAgdWludDI1NiBvdmVyZmxvd1Rva2VuczsKICAgICAgICB1aW50MjU2IG92ZXJmbG93VG9rZW5zMjsKICAgICAgICAvLyAyMCUgZGlzY291bnQgYm9udXMgYW1vdW50CiAgICAgICAgdWludDI1NiB0aWVyMUJvbnVzVG9rZW5zOwogICAgICAgIC8vIDEwJSBkaXNjb3VudCBib251cyBhbW91bnQKICAgICAgICB1aW50MjU2IHRpZXIyQm9udXNUb2tlbnM7CgogICAgICAgIC8vIHRpZXIgMSAyMCUgZGlzY291bnQgLSAxc3QgMyBtaWxsaW9uIHRva2VucyBwdXJjaGFzZWQKICAgICAgICBpZiAoIXRpZXIxUmVhY2hlZCkgewoKICAgICAgICAgICAgLy8gdHggdG9rZW5zIG92ZXJmbG93ZWQgaW50byBuZXh0IHRpZXIgMiAtIDEwJSBkaXNjb3VudCAtIG1hcmsgdGllcjFSZWFjaGVkISBlbHNlIGFsbCB0b2tlbnMgYXJlIHRpZXIgMSBkaXNjb3VudGVkCiAgICAgICAgICAgIGlmICh0ZW1wVG90YWxUb2tlbnNQdXJjaGFzZWQgPiBESVNDT1VOVF9UT0tFTl9BTU9VTlRfVDEpIHsKICAgICAgICAgICAgICAgIHRpZXIxUmVhY2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBvdmVyZmxvd1Rva2VucyA9IHRlbXBUb3RhbFRva2Vuc1B1cmNoYXNlZC5zdWIoRElTQ09VTlRfVE9LRU5fQU1PVU5UX1QxKTsKICAgICAgICAgICAgICAgIHRpZXIxQm9udXNUb2tlbnMgPSBwdXJjaGFzZWRUb2tlbnMuc3ViKG92ZXJmbG93VG9rZW5zKTsKICAgICAgICAgICAgLy8gdHggdG9rZW5zIGRpZCBub3Qgb3ZlcmZsb3cgaW50byBuZXh0IHRpZXIgMiAoMTAlIGRpc2NvdW50KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGllcjFCb251c1Rva2VucyA9IHB1cmNoYXNlZFRva2VuczsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2FwcGx5IGRpc2NvdW50CiAgICAgICAgICAgIHRpZXIxQm9udXNUb2tlbnMgPSB0aWVyMUJvbnVzVG9rZW5zLm11bCgxMCkuZGl2KDgpOwogICAgICAgICAgICB0b2tlbkFtb3VudCA9IHRva2VuQW1vdW50LmFkZCh0aWVyMUJvbnVzVG9rZW5zKTsKICAgICAgICB9CgogICAgICAgIC8vIHRpZXIgMiAxMCUgZGlzY291bnQgLSAybmQgMyBtaWxsaW9uIHRva2VucyBwdXJjaGFzZWQKICAgICAgICBpZiAodGllcjFSZWFjaGVkICYmICF0aWVyMlJlYWNoZWQpIHsKCiAgICAgICAgICAgIC8vIHR4IHRva2VucyBvdmVyZmxvd2VkIGludG8gbmV4dCB0aWVyIDMgLSAwJSAtIG1hcmtlZCB0aWVyMlJlYWNoZWQhIGVsc2UgYWxsIHRva2VucyBhcmUgdGllciAyIGRpc2NvdW50ZWQKICAgICAgICAgICAgaWYgKHRlbXBUb3RhbFRva2Vuc1B1cmNoYXNlZCA+IERJU0NPVU5UX1RPS0VOX0FNT1VOVF9UMikgewogICAgICAgICAgICAgICAgdGllcjJSZWFjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG92ZXJmbG93VG9rZW5zMiA9IHRlbXBUb3RhbFRva2Vuc1B1cmNoYXNlZC5zdWIoRElTQ09VTlRfVE9LRU5fQU1PVU5UX1QyKTsKICAgICAgICAgICAgICAgIHRpZXIyQm9udXNUb2tlbnMgPSBwdXJjaGFzZWRUb2tlbnMuc3ViKG92ZXJmbG93VG9rZW5zMik7CiAgICAgICAgICAgIC8vIHR4IHRva2VucyBkaWQgbm90IG92ZXJmbG93IGludG8gbmV4dCB0aWVyIDMgKHRpZXIgMyA9PSBubyBkaXNjb3VudCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHRva2VucyBvdmVyZmxvd2VkIGZyb20gdGllcjEgZWxzZSB0aGlzIHR4IHN0YXJ0ZWQgaW4gdGllcjIKICAgICAgICAgICAgICAgIGlmIChvdmVyZmxvd1Rva2VucyA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aWVyMkJvbnVzVG9rZW5zID0gb3ZlcmZsb3dUb2tlbnM7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRpZXIyQm9udXNUb2tlbnMgPSBwdXJjaGFzZWRUb2tlbnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gYXBwbHkgZGlzY291bnQgZm9yIHRpZXIgMiB0b2tlbnMKICAgICAgICAgICAgdGllcjJCb251c1Rva2VucyA9IHRpZXIyQm9udXNUb2tlbnMubXVsKDEwKS5kaXYoOSk7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQuYWRkKHRpZXIyQm9udXNUb2tlbnMpLmFkZChvdmVyZmxvd1Rva2VuczIpOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhpcyB0cmlnZ2VycyB3aGVuIGJvdGggdGllciAxIGFuZCB0aWVyIDIgZGlzY291bnRlZCB0b2tlbnMgaGF2ZSBiZSBmaWxsZWQgLSBidXQgT05MWSBhZnRlcndhcmRzLCBub3QgaWYgdGhlIGZsYWdzIGdvdCBzZXQgZHVyaW5nIHRoZSBzYW1lIHR4CiAgICAgICAgLy8gYWthIHRoaXMgaXMgdGllciAzCiAgICAgICAgaWYgKHRpZXIyUmVhY2hlZCAmJiB0aWVyMVJlYWNoZWQgJiYgdGllcjJCb251c1Rva2VucyA9PSAwKSB7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gcHVyY2hhc2VkVG9rZW5zOwogICAgICAgIH0KCiAgICAgICAgLyoqKiBSZWNvcmQgJiB1cGRhdGUgc3RhdGUgdmFyaWFibGVzICAqKiovCiAgICAgICAgLy8gVHJhY2tzIHB1cmNoYXNlZCB0b2tlbnMgZm9yIDIgdGllcnMgb2YgZGlzY291bnRzCiAgICAgICAgdG90YWxUb2tlbnNQdXJjaGFzZWQgPSB0b3RhbFRva2Vuc1B1cmNoYXNlZC5hZGQocHVyY2hhc2VkVG9rZW5zKTsKICAgICAgICAvLyBUcmFja3MgdG90YWwgdG9rZW5zIHBlbmRpbmcgdG8gYmUgbWludGVkIC0gdGhpcyBpbmNsdWRlcyBwcmVzYWxlIHRva2VucwogICAgICAgIHRva2Vuc1RvTWludCA9IHRva2Vuc1RvTWludC5hZGQodG9rZW5BbW91bnQpOwoKICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgX2JlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2VuQW1vdW50KTsKCiAgICAgICAgLy8gcmVnaXN0ZXIgcGF5bWVudCBzbyB0aGF0IGxhdGVyIG9uIGl0IGNhbiBiZSBjb25maXJtZWQgKGFuZCB0b2tlbnMgaXNzdWVkIGFuZCBFdGhlciBwYWlkIG91dCkKICAgICAgICBQYXltZW50IG1lbW9yeSBuZXdQYXltZW50ID0gUGF5bWVudChtc2cuc2VuZGVyLCBfYmVuZWZpY2lhcnksIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGZhbHNlLCBmYWxzZSwgZmFsc2UpOwogICAgICAgIGludmVzdG1lbnRzLnB1c2gobmV3UGF5bWVudCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNvbmZpcm1zIHBheW1lbnQKICAgICAqIEBwYXJhbSBfaW52ZXN0bWVudElkIHVpbnQyNTYgdWludDI1NiBvZiB0aGUgaW52ZXN0bWVudCBpZCB0byBjb25maXJtCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbmZpcm1QYXltZW50KHVpbnQyNTYgX2ludmVzdG1lbnRJZCkgcHVibGljIG9ubHlNYW5hZ2VyIG9ubHlDb25maXJtUGF5bWVudCB7CiAgICAgICAgaW52ZXN0bWVudHNbX2ludmVzdG1lbnRJZF0uY29uZmlybWVkID0gdHJ1ZTsKICAgICAgICBDaGFuZ2VkSW52ZXN0bWVudENvbmZpcm1hdGlvbihfaW52ZXN0bWVudElkLCBpbnZlc3RtZW50c1tfaW52ZXN0bWVudElkXS5pbnZlc3RvciwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNvbmZpcm1zIHBheW1lbnRzIHZpYSBhIGJhdGNoIG1ldGhvZAogICAgICogQHBhcmFtIF9pbnZlc3RtZW50SWRzIHVpbnQyNTZbXSBhcnJheSBvZiB1aW50MjU2IG9mIHRoZSBpbnZlc3RtZW50IGlkcyB0byBjb25maXJtCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhdGNoQ29uZmlybVBheW1lbnRzKHVpbnQyNTZbXSBfaW52ZXN0bWVudElkcykgcHVibGljIG9ubHlNYW5hZ2VyIG9ubHlDb25maXJtUGF5bWVudCB7CiAgICAgICAgdWludDI1NiBpbnZlc3RtZW50SWQ7CgogICAgICAgIGZvciAodWludDI1NiBjOyBjIDwgX2ludmVzdG1lbnRJZHMubGVuZ3RoOyBjID0gYy5hZGQoMSkpIHsKICAgICAgICAgICAgaW52ZXN0bWVudElkID0gX2ludmVzdG1lbnRJZHNbY107IC8vIGdhcyBvcHRpbWl6YXRpb24KICAgICAgICAgICAgY29uZmlybVBheW1lbnQoaW52ZXN0bWVudElkKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHVuY29uZmlybXMgcGF5bWVudCBtYWRlIHZpYSBpbnZlc3RtZW50IGlkCiAgICAgKiBAcGFyYW0gX2ludmVzdG1lbnRJZCB1aW50MjU2IHVpbnQyNTYgb2YgdGhlIGludmVzdG1lbnQgdG8gdW5jb25maXJtCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVuQ29uZmlybVBheW1lbnQodWludDI1NiBfaW52ZXN0bWVudElkKSBwdWJsaWMgb25seU1hbmFnZXIgb25seUNvbmZpcm1QYXltZW50IHsKICAgICAgICBpbnZlc3RtZW50c1tfaW52ZXN0bWVudElkXS5jb25maXJtZWQgPSBmYWxzZTsKICAgICAgICBDaGFuZ2VkSW52ZXN0bWVudENvbmZpcm1hdGlvbihfaW52ZXN0bWVudElkLCBpbnZlc3RtZW50c1tfaW52ZXN0bWVudElkXS5pbnZlc3RvciwgZmFsc2UpOwogICAgfQoKICAgLyoqCiAgICAqIEBkZXYgYWxsb3dzIGNvbnRyYWN0IG93bmVyIHRvIG1pbnQgdG9rZW5zIGZvciBwcmVzYWxlIG9yIG5vbi1FVEggY29udHJpYnV0aW9ucyBpbiBiYXRjaGVzCiAgICAgKiBAcGFyYW0gX3RvTGlzdCBhZGRyZXNzW10gYXJyYXkgb2YgdGhlIGJlbmVmaWNpYXJpZXMgdG8gcmVjZWl2ZSB0b2tlbnMKICAgICAqIEBwYXJhbSBfdG9rZW5MaXN0IHVpbnQyNTZbXSBhcnJheSBvZiB0aGUgdG9rZW4gYW1vdW50cyB0byBtaW50IGZvciB0aGUgY29ycmVzcG9uZGluZyB1c2VycwogICAgKi8KICAgIGZ1bmN0aW9uIGJhdGNoTWludFRva2VuRGlyZWN0KGFkZHJlc3NbXSBfdG9MaXN0LCB1aW50MjU2W10gX3Rva2VuTGlzdCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG9MaXN0Lmxlbmd0aCA9PSBfdG9rZW5MaXN0Lmxlbmd0aCk7CgogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgX3RvTGlzdC5sZW5ndGg7IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICBtaW50VG9rZW5EaXJlY3QoX3RvTGlzdFtpXSwgX3Rva2VuTGlzdFtpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBhbGxvd3MgY29udHJhY3Qgb3duZXIgdG8gbWludCB0b2tlbnMgZm9yIHByZXNhbGUgb3Igbm9uLUVUSCBjb250cmlidXRpb25zCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgb2YgdGhlIGJlbmVmaWNpYXJ5IHRvIHJlY2VpdmUgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3Rva2VucyB1aW50MjU2IG9mIHRoZSB0b2tlbiBhbW91bnQgdG8gbWludAogICAgICovCiAgICBmdW5jdGlvbiBtaW50VG9rZW5EaXJlY3QoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VucykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNUb01pbnQuYWRkKF90b2tlbnMpIDw9IElDT19UT0tFTl9DQVApOwoKICAgICAgICB0b2tlbnNUb01pbnQgPSB0b2tlbnNUb01pbnQuYWRkKF90b2tlbnMpOwoKICAgICAgICAvLyByZWdpc3RlciBwYXltZW50IHNvIHRoYXQgbGF0ZXIgb24gaXQgY2FuIGJlIGNvbmZpcm1lZCAoYW5kIHRva2VucyBpc3N1ZWQgYW5kIEV0aGVyIHBhaWQgb3V0KQogICAgICAgIFBheW1lbnQgbWVtb3J5IG5ld1BheW1lbnQgPSBQYXltZW50KGFkZHJlc3MoMCksIF90bywgMCwgX3Rva2VucywgZmFsc2UsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgaW52ZXN0bWVudHMucHVzaChuZXdQYXltZW50KTsKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIF90bywgMCwgX3Rva2Vucyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGFsbG93cyBjb250cmFjdCBvd25lciB0byBtaW50IHRva2VucyBmb3IgSUNPIGVuYWJsZXJzIHJlc3BlY3RpbmcgdGhlIElDT19FTkFCTEVSU19DQVAgKG5vIHZlc3RpbmcpCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgZm9yIGJlbmVmaWNpYXJ5CiAgICAgKiBAcGFyYW0gX3Rva2VucyB1aW50MjU2IHRva2VuIGFtb3VudCB0byBtaW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIG1pbnRJY29FbmFibGVyc1Rva2VucyhhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5zKSBwdWJsaWMgb25seU93bmVyIG9ubHlOb25lWmVybyhfdG8sIF90b2tlbnMpIHsKICAgICAgICByZXF1aXJlKGljb0VuYWJsZXJzVG9rZW5zTWludGVkLmFkZChfdG9rZW5zKSA8PSBJQ09fRU5BQkxFUlNfQ0FQKTsKCiAgICAgICAgdG9rZW4ubWludChfdG8sIF90b2tlbnMpOwogICAgICAgIGljb0VuYWJsZXJzVG9rZW5zTWludGVkID0gaWNvRW5hYmxlcnNUb2tlbnNNaW50ZWQuYWRkKF90b2tlbnMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBhbGxvd3MgY29udHJhY3Qgb3duZXIgdG8gbWludCB0ZWFtIHRva2VucyBwZXIgREVWRUxPUE1FTlRfVEVBTV9DQVAgYW5kIHRyYW5zZmVyIHRvIHRoZSBkZXZlbG9wbWVudCB0ZWFtJ3Mgd2FsbGV0ICh5ZXMgdmVzdGluZykKICAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBmb3IgYmVuZWZpY2lhcnkKICAgICAqIEBwYXJhbSBfdG9rZW5zIHVpbnQyNTYgdG9rZW4gYW1vdW50IHRvIG1pbnQKICAgICAqLwogICAgZnVuY3Rpb24gbWludERldmVsb3BtZW50VGVhbVRva2VucyhhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5zKSBwdWJsaWMgb25seU93bmVyIG9ubHlOb25lWmVybyhfdG8sIF90b2tlbnMpIHsKICAgICAgICByZXF1aXJlKGRldmVsb3BtZW50VGVhbVRva2Vuc01pbnRlZC5hZGQoX3Rva2VucykgPD0gREVWRUxPUE1FTlRfVEVBTV9DQVApOwoKICAgICAgICBkZXZlbG9wbWVudFRlYW1Ub2tlbnNNaW50ZWQgPSBkZXZlbG9wbWVudFRlYW1Ub2tlbnNNaW50ZWQuYWRkKF90b2tlbnMpOwogICAgICAgIFRva2VuVmVzdGluZyBuZXdWYXVsdCA9IG5ldyBUb2tlblZlc3RpbmcoX3RvLCBub3csIFZFU1RJTkdfQ0xJRkYsIFZFU1RJTkdfRFVSQVRJT04sIGZhbHNlKTsKICAgICAgICB2ZXN0aW5nV2FsbGV0cy5wdXNoKGFkZHJlc3MobmV3VmF1bHQpKTsgLy8gZm9yIGNvbnZlbmllbmNlIHdlIGtlZXAgdGhlbSBpbiBzdG9yYWdlIHNvIHRoYXQgdGhleSBhcmUgZWFzaWx5IGFjY2Vzc2libGUgdmlhIE1FVyBvciBldGhlcnNjYW4KICAgICAgICB0b2tlbi5taW50KGFkZHJlc3MobmV3VmF1bHQpLCBfdG9rZW5zKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgcmV0dXJucyBudW1iZXIgb2YgZWxlbWVudHMgaW4gdGhlIHZlc3RpbldhbGxldHMgYXJyYXkKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VmVzdGluZ1dhbGxldExlbmd0aCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdmVzdGluZ1dhbGxldHMubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBzZXQgZmluYWwgdGhlIGNvbmZpcm1hdGlvbiBwZXJpb2QKICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemVDb25maXJtYXRpb25QZXJpb2QoKSBwdWJsaWMgb25seU93bmVyIG9ubHlDb25maXJtUGF5bWVudCB7CiAgICAgICAgY29uZmlybWF0aW9uUGVyaW9kT3ZlciA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHNldHRsZW1lbnQgb2YgaW52ZXN0bWVudCBtYWRlIHZpYSBpbnZlc3RtZW50IGlkCiAgICAgKiBAcGFyYW0gX2ludmVzdG1lbnRJZCB1aW50MjU2IHVpbnQyNTYgYmVpbmcgdGhlIGludmVzdG1lbnQgaWQKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dGxlSW52ZXN0bWVudCh1aW50MjU2IF9pbnZlc3RtZW50SWQpIHB1YmxpYyBvbmx5Q29uZmlybWF0aW9uT3ZlciB7CiAgICAgICAgUGF5bWVudCBzdG9yYWdlIHAgPSBpbnZlc3RtZW50c1tfaW52ZXN0bWVudElkXTsKCiAgICAgICAgLy8gaW52ZXN0bWVudCBzaG91bGQgbm90IGJlIHNldHRsZWQgYWxyZWFkeSAocHJldmVudCBkb3VibGUgdG9rZW4gaXNzdWVpbmcgb3IgcmVwYXltZW50KQogICAgICAgIHJlcXVpcmUoIXAuY29tcGxldGVkU2V0dGxlbWVudCk7CgogICAgICAgIC8vIGludmVzdG1lbnRzIGhhdmUgdG8gYmUgcHJvY2Vzc2VkIGluIHJpZ2h0IG9yZGVyCiAgICAgICAgLy8gdW5sZXNzIHdlJ3JlIGF0IGZpcnN0IGludmVzdG1lbnQsIHRoZSBwcmV2aW91cyBoYXMgbmVlZHMgdG8gaGF2ZSB1bmRlcmdvbmUgYW4gYXR0ZW1wdGVkIHNldHRsZW1lbnQKCiAgICAgICAgcmVxdWlyZShfaW52ZXN0bWVudElkID09IDAgfHwgaW52ZXN0bWVudHNbX2ludmVzdG1lbnRJZC5zdWIoMSldLmF0dGVtcHRlZFNldHRsZW1lbnQpOwoKICAgICAgICBwLmF0dGVtcHRlZFNldHRsZW1lbnQgPSB0cnVlOwoKICAgICAgICAvLyBqdXN0IHNvIHRoYXQgd2UgY2FuIHNlZSB3aGljaCBvbmUgd2UgYXR0ZW1wdGVkIGxhc3QgdGltZSBhbmQgY2FuIGNvbnRpbnVlIHdpdGggbmV4dAogICAgICAgIGludmVzdG1lbnRJZExhc3RBdHRlbXB0ZWRUb1NldHRsZSA9IF9pbnZlc3RtZW50SWQ7CgogICAgICAgIGlmIChwLmNvbmZpcm1lZCAmJiAhY2FwUmVhY2hlZCkgewogICAgICAgICAgICAvLyBpZiBjb25maXJtZWQgLT4gaXNzdWUgdG9rZW5zLCBzZW5kIEVUSCB0byB3YWxsZXQgYW5kIGNvbXBsZXRlIHNldHRsZW1lbnQKCiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBudW1iZXIgb2YgdG9rZW5zIHRvIGJlIGlzc3VlZCB0byBpbnZlc3RvcgogICAgICAgICAgICB1aW50MjU2IHRva2VucyA9IHAudG9rZW5BbW91bnQ7CgogICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhpcyBwdXJjaGFzZSBzZXRzIGl0IG92ZXIgdGhlIGNyb3dkc2FsZSB0b2tlbiBjYXAKICAgICAgICAgICAgLy8gaWYgc28sIHJlZnVuZAogICAgICAgICAgICBpZiAodG9rZW5zTWludGVkLmFkZCh0b2tlbnMpID4gSUNPX1RPS0VOX0NBUCkgewogICAgICAgICAgICAgICAgY2FwUmVhY2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAocC53ZWlBbW91bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcC5pbnZlc3Rvci5zZW5kKHAud2VpQW1vdW50KTsgLy8gZG9lcyBub3QgdGhyb3cgKG90aGVyd2lzZSB3ZSdkIGJsb2NrIGFsbCBmdXJ0aGVyIHNldHRsZW1lbnRzKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9rZW5zVG9NaW50ID0gdG9rZW5zVG9NaW50LnN1Yih0b2tlbnMpOwogICAgICAgICAgICAgICAgdG9rZW5zTWludGVkID0gdG9rZW5zTWludGVkLmFkZCh0b2tlbnMpOwoKICAgICAgICAgICAgICAgIC8vIG1pbnQgdG9rZW5zIGZvciBiZW5lZmljaWFyeQogICAgICAgICAgICAgICAgdG9rZW4ubWludChwLmJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgICAgICAgICAgICAgaWYgKHAud2VpQW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIHNlbmQgRXRoZXIgdG8gcHJvamVjdCB3YWxsZXQgKHRocm93cyBpZiB3YWxsZXQgdGhyb3dzKQogICAgICAgICAgICAgICAgICAgIHdhbGxldC50cmFuc2ZlcihwLndlaUFtb3VudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHAuY29tcGxldGVkU2V0dGxlbWVudCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgbm90IGNvbmZpcm1lZCAtPiByZWltYnVyc2UgRVRIIG9yIGlmIGZpYXQgKHByZXNhbGUpIGludmVzdG9yOiBkbyBub3RoaW5nCiAgICAgICAgICAgIC8vIG9ubHkgY29tcGxldGUgc2V0dGxlbWVudCBpZiBpbnZlc3RvciBnb3QgdGhlaXIgbW9uZXkgYmFjawogICAgICAgICAgICAvLyAoZG9lcyBub3QgdGhyb3cgKGFzIC50cmFuc2ZlciB3b3VsZCkKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIHdvdWxkIGJsb2NrIHNldHRsZW1lbnQgcHJvY2VzcyBvZiBhbGwgZm9sbG93aW5nIGludmVzdG1lbnRzKQogICAgICAgICAgICBpZiAocC5pbnZlc3RvciAhPSBhZGRyZXNzKDApICYmIHAud2VpQW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHAuaW52ZXN0b3Iuc2VuZChwLndlaUFtb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICBwLmNvbXBsZXRlZFNldHRsZW1lbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBhbGxvd3MgdGhlIGJhdGNoIHNldHRsZW1lbnQgb2YgaW52ZXN0bWVudHMgbWFkZQogICAgICogQHBhcmFtIF9pbnZlc3RtZW50SWRzIHVpbnQyNTZbXSBhcnJheSBvZiB1aW50MjU2IG9mIGludmVzdG1lbnQgaWRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhdGNoU2V0dGxlSW52ZXN0bWVudHModWludDI1NltdIF9pbnZlc3RtZW50SWRzKSBwdWJsaWMgewogICAgICAgIGZvciAodWludDI1NiBjOyBjIDwgX2ludmVzdG1lbnRJZHMubGVuZ3RoOyBjID0gYy5hZGQoMSkpIHsKICAgICAgICAgICAgc2V0dGxlSW52ZXN0bWVudChfaW52ZXN0bWVudElkc1tjXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBhbGxvd3MgY29udHJhY3Qgb3duZXIgdG8gZmluYWxpemUgdGhlIElDTywgdW5wYXVzZSB0b2tlbnMsIHNldCB0cmVhc3VyZXIsIGZpbmlzaCBtaW50aW5nLCBhbmQgdHJhbnNmZXIgb3duc2hpcCBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgb25seVVuZGVyd3JpdGVyIG9ubHlDb25maXJtYXRpb25PdmVyIHsKICAgICAgICBQYXVzYWJsZSh0b2tlbikudW5wYXVzZSgpOwoKICAgICAgICAvLyB0aGlzIGNyb3dkc2FsZSBhbHNvIHNob3VsZCBub3QgYmUgdHJlYXN1cmVyIG9mIHRoZSB0b2tlbiBhbnltb3JlCiAgICAgICAgSWNvVG9rZW4odG9rZW4pLnNldFRyZWFzdXJlcih0aGlzLCBmYWxzZSk7CgogICAgICAgIC8vIGRvIG5vdCBhbGxvdyBuZXcgb3duZXIgdG8gbWludCBmdXJ0aGVyIHRva2VucwogICAgICAgIE1pbnRhYmxlVG9rZW4odG9rZW4pLmZpbmlzaE1pbnRpbmcoKTsKCiAgICAgICAgLy8gdW50aWwgbm93IHRoZSBvd25lciBvZiB0aGUgdG9rZW4gaXMgdGhpcyBjcm93ZHNhbGUgY29udHJhY3QKICAgICAgICAvLyBpbiBvcmRlciBmb3IgYSBodW1hbiBvd25lciB0byBtYWtlIHVzZSBvZiB0aGUgdG9rZW5zIG9ubHlPd25lciBmdW5jdGlvbnMKICAgICAgICAvLyB3ZSBuZWVkIHRvIHRyYW5zZmVyIHRoZSBvd25lcnNoaXAKICAgICAgICAvLyBpbiB0aGUgZW5kIHRoZSBvd25lciBvZiB0aGlzIGNyb3dkc2FsZSB3aWxsIGFsc28gYmUgdGhlIG93bmVyIG9mIHRoZSB0b2tlbgogICAgICAgIE93bmFibGUodG9rZW4pLnRyYW5zZmVyT3duZXJzaGlwKG93bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlIG5ldyBpbnN0YW5jZSBvZiBpY28gdG9rZW4gY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgICAgICByZXR1cm4gbmV3IEljb1Rva2VuKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGV4dGVuZCBiYXNlIGZ1bmN0aW9uYWxpdHkgd2l0aCBtaW4gaW52ZXN0bWVudCBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIG1pbmltYWwgaW52ZXN0bWVudDogMjUwIENIRiAocmVwcmVzZW50ZWQgaW4gd2VpKQogICAgICAgIHJlcXVpcmUgKG1zZy52YWx1ZSA+PSBtaW5Db250cmlidXRpb25JbldlaSk7CiAgICAgICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2UoKTsKICAgIH0KfQ=='.
	

]
