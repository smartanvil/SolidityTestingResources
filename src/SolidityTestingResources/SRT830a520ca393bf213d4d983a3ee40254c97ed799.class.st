Class {
	#name : #SRT830a520ca393bf213d4d983a3ee40254c97ed799,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT830a520ca393bf213d4d983a3ee40254c97ed799 >> base64 [
	^ 'LyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzcyMSBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2VpcHMvaXNzdWVzLzcyMQogKi8KY29udHJhY3QgRVJDNzIxIHsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfYXBwcm92ZWQsIHVpbnQyNTYgX3Rva2VuSWQpOwoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2JhbGFuY2UpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfdG9rZW5JZCkgcHVibGljOwp9CgovKioKICogQHRpdGxlIEVSQzcyMVRva2VuCiAqIEdlbmVyaWMgaW1wbGVtZW50YXRpb24gZm9yIHRoZSByZXF1aXJlZCBmdW5jdGlvbmFsaXR5IG9mIHRoZSBFUkM3MjEgc3RhbmRhcmQKICovCmNvbnRyYWN0IEVSQzcyMVRva2VuIGlzIEVSQzcyMSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICB1aW50MjU2IGludGVybmFsIHRvdGFsVG9rZW5zOwoKICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gb3duZXIKICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGludGVybmFsIHRva2VuT3duZXI7CgogIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBhcHByb3ZlZCBhZGRyZXNzCiAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBpbnRlcm5hbCB0b2tlbkFwcHJvdmFsczsKCiAgLy8gTWFwcGluZyBmcm9tIG93bmVyIHRvIGxpc3Qgb2Ygb3duZWQgdG9rZW4gSURzCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2W10pIGludGVybmFsIG93bmVkVG9rZW5zOwoKICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gaW5kZXggb2YgdGhlIG93bmVyIHRva2VucyBsaXN0CiAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIGludGVybmFsIG93bmVkVG9rZW5zSW5kZXg7CgogIC8qKgogICogQGRldiBHdWFyYW50ZWVzIG1zZy5zZW5kZXIgaXMgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gdmFsaWRhdGUgaXRzIG93bmVyc2hpcCBiZWxvbmdzIHRvIG1zZy5zZW5kZXIKICAqLwogIG1vZGlmaWVyIG9ubHlPd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gbXNnLnNlbmRlcik7CiAgICBfOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc3RvcmVkIGJ5IHRoZSBjb250cmFjdAogICogQHJldHVybiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VucwogICovCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG90YWxUb2tlbnM7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyB0byBxdWVyeSB0aGUgYmFsYW5jZSBvZgogICogQHJldHVybiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcwogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXS5sZW5ndGg7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgbGlzdCBvZiB0b2tlbnMgb3duZWQgYnkgYSBnaXZlbiBhZGRyZXNzCiAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRva2VucyBvZgogICogQHJldHVybiB1aW50MjU2W10gcmVwcmVzZW50aW5nIHRoZSBsaXN0IG9mIHRva2VucyBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIHRva2Vuc09mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2W10pIHsKICAgIHJldHVybiBvd25lZFRva2Vuc1tfb3duZXJdOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIG93bmVyIG9mIHRoZSBzcGVjaWZpZWQgdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBxdWVyeSB0aGUgb3duZXIgb2YKICAqIEByZXR1cm4gb3duZXIgYWRkcmVzcyBjdXJyZW50bHkgbWFya2VkIGFzIHRoZSBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqLwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgYWRkcmVzcyBvd25lciA9IHRva2VuT3duZXJbX3Rva2VuSWRdOwogICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICAgIHJldHVybiBvd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyB0aGUgYXBwcm92ZWQgYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECiAgICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIHF1ZXJ5IHRoZSBhcHByb3ZhbCBvZgogICAqIEByZXR1cm4gYWRkcmVzcyBjdXJyZW50bHkgYXBwcm92ZWQgdG8gdGFrZSBvd25lcnNoaXAgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZWRGb3IodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgcmV0dXJuIHRva2VuQXBwcm92YWxzW190b2tlbklkXTsKICB9CgogIC8qKgogICogQGRldiBUcmFuc2ZlcnMgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElEIHRvIGFub3RoZXIgYWRkcmVzcwogICogQHBhcmFtIF90byBhZGRyZXNzIHRvIHJlY2VpdmUgdGhlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBvbmx5T3duZXJPZihfdG9rZW5JZCkgewogICAgY2xlYXJBcHByb3ZhbEFuZFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFwcHJvdmVzIGFub3RoZXIgYWRkcmVzcyB0byBjbGFpbSBmb3IgdGhlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG8gYWRkcmVzcyB0byBiZSBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgYXBwcm92ZWQKICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBvbmx5T3duZXJPZihfdG9rZW5JZCkgewogICAgYWRkcmVzcyBvd25lciA9IG93bmVyT2YoX3Rva2VuSWQpOwogICAgcmVxdWlyZShfdG8gIT0gb3duZXIpOwogICAgaWYgKGFwcHJvdmVkRm9yKF90b2tlbklkKSAhPSAwIHx8IF90byAhPSAwKSB7CiAgICAgIHRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IF90bzsKICAgICAgQXBwcm92YWwob3duZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQogIH0KCiAgLyoqCiAgKiBAZGV2IENsYWltcyB0aGUgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiBiZWluZyBjbGFpbWVkIGJ5IHRoZSBtc2cuc2VuZGVyCiAgKi8KICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CiAgICByZXF1aXJlKGlzQXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgIGNsZWFyQXBwcm92YWxBbmRUcmFuc2Zlcihvd25lck9mKF90b2tlbklkKSwgbXNnLnNlbmRlciwgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IE1pbnQgdG9rZW4gZnVuY3Rpb24KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIG93biB0aGUgbWludGVkIHRva2VuCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgbWludGVkIGJ5IHRoZSBtc2cuc2VuZGVyCiAgKi8KICBmdW5jdGlvbiBfbWludChhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICBhZGRUb2tlbihfdG8sIF90b2tlbklkKTsKICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfdG9rZW5JZCk7CiAgfQoKICAvKioKICAqIEBkZXYgQnVybnMgYSBzcGVjaWZpYyB0b2tlbgogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIGJlaW5nIGJ1cm5lZCBieSB0aGUgbXNnLnNlbmRlcgogICovCiAgZnVuY3Rpb24gX2J1cm4odWludDI1NiBfdG9rZW5JZCkgb25seU93bmVyT2YoX3Rva2VuSWQpIGludGVybmFsIHsKICAgIGlmIChhcHByb3ZlZEZvcihfdG9rZW5JZCkgIT0gMCkgewogICAgICBjbGVhckFwcHJvdmFsKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KICAgIHJlbW92ZVRva2VuKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgICogQGRldiBUZWxscyB3aGV0aGVyIHRoZSBtc2cuc2VuZGVyIGlzIGFwcHJvdmVkIGZvciB0aGUgZ2l2ZW4gdG9rZW4gSUQgb3Igbm90CiAgICogVGhpcyBmdW5jdGlvbiBpcyBub3QgcHJpdmF0ZSBzbyBpdCBjYW4gYmUgZXh0ZW5kZWQgaW4gZnVydGhlciBpbXBsZW1lbnRhdGlvbnMgbGlrZSB0aGUgb3BlcmF0YWJsZSBFUkM3MjEKICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgdGhlIG93bmVyIHRvIHF1ZXJ5IHRoZSBhcHByb3ZhbCBvZgogICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcmV0dXJuIGJvb2wgd2hldGhlciB0aGUgbXNnLnNlbmRlciBpcyBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElEIG9yIG5vdAogICAqLwogIGZ1bmN0aW9uIGlzQXBwcm92ZWRGb3IoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGFwcHJvdmVkRm9yKF90b2tlbklkKSA9PSBfb3duZXI7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xlYXIgY3VycmVudCBhcHByb3ZhbCBhbmQgdHJhbnNmZXIgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdGhlIHRva2VuIHRvCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogIGZ1bmN0aW9uIGNsZWFyQXBwcm92YWxBbmRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF90byAhPSBvd25lck9mKF90b2tlbklkKSk7CiAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IF9mcm9tKTsKCiAgICBjbGVhckFwcHJvdmFsKF9mcm9tLCBfdG9rZW5JZCk7CiAgICByZW1vdmVUb2tlbihfZnJvbSwgX3Rva2VuSWQpOwogICAgYWRkVG9rZW4oX3RvLCBfdG9rZW5JZCk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xlYXIgY3VycmVudCBhcHByb3ZhbCBvZiBhIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogIGZ1bmN0aW9uIGNsZWFyQXBwcm92YWwoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBfb3duZXIpOwogICAgdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdID0gMDsKICAgIEFwcHJvdmFsKF9vd25lciwgMCwgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhIHRva2VuIElEIHRvIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF90byBhZGRyZXNzIHJlcHJlc2VudGluZyB0aGUgbmV3IG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFkZGVkIHRvIHRoZSB0b2tlbnMgbGlzdCBvZiB0aGUgZ2l2ZW4gYWRkcmVzcwogICovCiAgZnVuY3Rpb24gYWRkVG9rZW4oYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewogICAgcmVxdWlyZSh0b2tlbk93bmVyW190b2tlbklkXSA9PSBhZGRyZXNzKDApKTsKICAgIHRva2VuT3duZXJbX3Rva2VuSWRdID0gX3RvOwogICAgdWludDI1NiBsZW5ndGggPSBiYWxhbmNlT2YoX3RvKTsKICAgIG93bmVkVG9rZW5zW190b10ucHVzaChfdG9rZW5JZCk7CiAgICBvd25lZFRva2Vuc0luZGV4W190b2tlbklkXSA9IGxlbmd0aDsKICAgIHRvdGFsVG9rZW5zID0gdG90YWxUb2tlbnMuYWRkKDEpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHJlbW92ZSBhIHRva2VuIElEIGZyb20gdGhlIGxpc3Qgb2YgYSBnaXZlbiBhZGRyZXNzCiAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyByZXByZXNlbnRpbmcgdGhlIHByZXZpb3VzIG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgdG9rZW5zIGxpc3Qgb2YgdGhlIGdpdmVuIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIHJlbW92ZVRva2VuKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBfZnJvbSk7CgogICAgdWludDI1NiB0b2tlbkluZGV4ID0gb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF07CiAgICB1aW50MjU2IGxhc3RUb2tlbkluZGV4ID0gYmFsYW5jZU9mKF9mcm9tKS5zdWIoMSk7CiAgICB1aW50MjU2IGxhc3RUb2tlbiA9IG93bmVkVG9rZW5zW19mcm9tXVtsYXN0VG9rZW5JbmRleF07CgogICAgdG9rZW5Pd25lcltfdG9rZW5JZF0gPSAwOwogICAgb3duZWRUb2tlbnNbX2Zyb21dW3Rva2VuSW5kZXhdID0gbGFzdFRva2VuOwogICAgb3duZWRUb2tlbnNbX2Zyb21dW2xhc3RUb2tlbkluZGV4XSA9IDA7CiAgICAvLyBOb3RlIHRoYXQgdGhpcyB3aWxsIGhhbmRsZSBzaW5nbGUtZWxlbWVudCBhcnJheXMuIEluIHRoYXQgY2FzZSwgYm90aCB0b2tlbkluZGV4IGFuZCBsYXN0VG9rZW5JbmRleCBhcmUgZ29pbmcgdG8KICAgIC8vIGJlIHplcm8uIFRoZW4gd2UgY2FuIG1ha2Ugc3VyZSB0aGF0IHdlIHdpbGwgcmVtb3ZlIF90b2tlbklkIGZyb20gdGhlIG93bmVkVG9rZW5zIGxpc3Qgc2luY2Ugd2UgYXJlIGZpcnN0IHN3YXBwaW5nCiAgICAvLyB0aGUgbGFzdFRva2VuIHRvIHRoZSBmaXJzdCBwb3NpdGlvbiwgYW5kIHRoZW4gZHJvcHBpbmcgdGhlIGVsZW1lbnQgcGxhY2VkIGluIHRoZSBsYXN0IHBvc2l0aW9uIG9mIHRoZSBsaXN0CgogICAgb3duZWRUb2tlbnNbX2Zyb21dLmxlbmd0aC0tOwogICAgb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF0gPSAwOwogICAgb3duZWRUb2tlbnNJbmRleFtsYXN0VG9rZW5dID0gdG9rZW5JbmRleDsKICAgIHRvdGFsVG9rZW5zID0gdG90YWxUb2tlbnMuc3ViKDEpOwogIH0KfQoKCmNvbnRyYWN0IEF1Y3Rpb25Ib3VzZSB7CiAgICBhZGRyZXNzIG93bmVyOwoKICAgIGZ1bmN0aW9uIEF1Y3Rpb25Ib3VzZSgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gUmVwcmVzZW50cyBhbiBhdWN0aW9uIG9uIGFuIE5GVAogICAgc3RydWN0IEF1Y3Rpb24gewogICAgICAgIC8vIEN1cnJlbnQgb3duZXIgb2YgTkZUCiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgZW5kIG9mIGF1Y3Rpb24KICAgICAgICB1aW50MTI4IGVuZGluZ1ByaWNlOwogICAgICAgIC8vIER1cmF0aW9uIChpbiBzZWNvbmRzKSBvZiBhdWN0aW9uCiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIC8vIFRpbWUgd2hlbiBhdWN0aW9uIHN0YXJ0ZWQKICAgICAgICAvLyBOT1RFOiAwIGlmIHRoaXMgYXVjdGlvbiBoYXMgYmVlbiBjb25jbHVkZWQKICAgICAgICB1aW50NjQgc3RhcnRlZEF0OwogICAgfQoKICAgIC8vIEN1dCBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG1lYXN1cmVkIGluIGJhc2lzIHBvaW50cyAoMS8xMDAgb2YgYSBwZXJjZW50KS4KICAgIC8vIFZhbHVlcyAwLTEwLDAwMCBtYXAgdG8gMCUtMTAwJQogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQgPSAzNzU7IC8vIERlZmF1bHQgaXMgMy43NSUKCiAgICAvLyBNYXAgZnJvbSB0b2tlbiBJRCB0byB0aGVpciBjb3JyZXNwb25kaW5nIGF1Y3Rpb24uCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikpIHRva2VuSWRUb0F1Y3Rpb247CgogICAgLy8gQWxsb3dlZCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgc3VwcG9ydGVkVG9rZW5zOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24sIGFkZHJlc3Mgc2VsbGVyKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKGFkZHJlc3MgaW5kZXhlZCB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCB1aW50MjU2IHRvdGFsUHJpY2UsIGFkZHJlc3Mgd2lubmVyKTsKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQoYWRkcmVzcyBpbmRleGVkIHRva2VuQWRkcmVzcywgdWludDI1NiBpbmRleGVkIHRva2VuSWQsIGFkZHJlc3Mgc2VsbGVyKTsKCiAgICAvLyBBZG1pbgoKICAgIC8vIENoYW5nZSBvd25lciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CgogICAgLy8gQWRkIG9yIHJlbW92ZSBzdXBwb3J0ZWQgdG9rZW5zCiAgICBmdW5jdGlvbiBzZXRTdXBwb3J0ZWRUb2tlbihhZGRyZXNzIHRva2VuQWRkcmVzcywgYm9vbCBzdXBwb3J0ZWQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHN1cHBvcnRlZFRva2Vuc1t0b2tlbkFkZHJlc3NdID0gc3VwcG9ydGVkOwogICAgfQoKICAgIC8vIFNldCB0aGUgb3duZXIgY3V0IGZvciBhdWN0aW9ucwogICAgZnVuY3Rpb24gc2V0T3duZXJDdXQodWludDI1NiBjdXQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHJlcXVpcmUoY3V0IDw9IDEwMDAwKTsKICAgICAgICBvd25lckN1dCA9IGN1dDsKICAgIH0KCiAgICAvLyBXaXRoZHJhdyBzYWxlcyBmZWVzCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIGV4dGVybmFsIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIGNsYWltYW50IG93bnMgdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgLSBBZGRyZXNzIGNsYWltaW5nIHRvIG93biB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2Ugb3duZXJzaGlwIHRvIHZlcmlmeS4KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX3Rva2VuQWRkcmVzcywgYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoRVJDNzIxVG9rZW4oX3Rva2VuQWRkcmVzcykub3duZXJPZihfdG9rZW5JZCkgPT0gX2NsYWltYW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBFc2Nyb3dzIHRoZSBORlQsIGFzc2lnbmluZyBvd25lcnNoaXAgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBUaHJvd3MgaWYgdGhlIGVzY3JvdyBmYWlscy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB3aG9zZSBhcHByb3ZhbCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfZXNjcm93KGFkZHJlc3MgX3Rva2VuQWRkcmVzcywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBFUkM3MjFUb2tlbiB0b2tlbiA9IEVSQzcyMVRva2VuKF90b2tlbkFkZHJlc3MpOwogICAgICAgIGlmICh0b2tlbi5vd25lck9mKF90b2tlbklkKSAhPSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICB0b2tlbi50YWtlT3duZXJzaGlwKF90b2tlbklkKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIGFuIE5GVCBvd25lZCBieSB0aGlzIGNvbnRyYWN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgIC8vLyBSZXR1cm5zIHRydWUgaWYgdGhlIHRyYW5zZmVyIHN1Y2NlZWRzLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXIgLSBBZGRyZXNzIHRvIHRyYW5zZmVyIE5GVCB0by4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF90b2tlbkFkZHJlc3MsIGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIEVSQzcyMVRva2VuKF90b2tlbkFkZHJlc3MpLnRyYW5zZmVyKF9yZWNlaXZlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFkZHMgYW4gYXVjdGlvbiB0byB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLiBBbHNvIGZpcmVzIHRoZQogICAgLy8vICBBdWN0aW9uQ3JlYXRlZCBldmVudC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSB0b2tlbiB0byBiZSBwdXQgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gQXVjdGlvbiB0byBhZGQuCiAgICBmdW5jdGlvbiBfYWRkQXVjdGlvbihhZGRyZXNzIF90b2tlbkFkZHJlc3MsIHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5BZGRyZXNzXVtfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIGFkZHJlc3MoX3Rva2VuQWRkcmVzcyksCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbiksCiAgICAgICAgICAgIGFkZHJlc3MoX2F1Y3Rpb24uc2VsbGVyKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHVuY29uZGl0aW9uYWxseS4KICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKGFkZHJlc3MgX3Rva2VuQWRkcmVzcywgdWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfc2VsbGVyKSBpbnRlcm5hbCB7CiAgICAgICAgX3JlbW92ZUF1Y3Rpb24oX3Rva2VuQWRkcmVzcywgX3Rva2VuSWQpOwogICAgICAgIF90cmFuc2ZlcihfdG9rZW5BZGRyZXNzLCBfc2VsbGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbkNhbmNlbGxlZChfdG9rZW5BZGRyZXNzLCBfdG9rZW5JZCwgX3NlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIHByaWNlIGFuZCB0cmFuc2ZlcnMgd2lubmluZ3MuCiAgICAvLy8gRG9lcyBOT1QgdHJhbnNmZXIgb3duZXJzaGlwIG9mIHRva2VuLgogICAgZnVuY3Rpb24gX2JpZChhZGRyZXNzIF90b2tlbkFkZHJlc3MsIHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5BZGRyZXNzXVtfdG9rZW5JZF07CgogICAgICAgIC8vIEV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGlzIGF1Y3Rpb24gaXMgY3VycmVudGx5IGxpdmUuCiAgICAgICAgLy8gKEJlY2F1c2Ugb2YgaG93IEV0aGVyZXVtIG1hcHBpbmdzIHdvcmssIHdlIGNhbid0IGp1c3QgY291bnQKICAgICAgICAvLyBvbiB0aGUgbG9va3VwIGFib3ZlIGZhaWxpbmcuIEFuIGludmFsaWQgX3Rva2VuSWQgd2lsbCBqdXN0CiAgICAgICAgLy8gcmV0dXJuIGFuIGF1Y3Rpb24gb2JqZWN0IHRoYXQgaXMgYWxsIHplcm9zLikKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGJpZCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGN1cnJlbnQgcHJpY2UKICAgICAgICB1aW50MjU2IHByaWNlID0gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gcHJpY2UpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIC8vIGdldHMgZGVsZXRlZC4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBUaGUgYmlkIGlzIGdvb2QhIFJlbW92ZSB0aGUgYXVjdGlvbiBiZWZvcmUgc2VuZGluZyB0aGUgZmVlcwogICAgICAgIC8vIHRvIHRoZSBzZW5kZXIgc28gd2UgY2FuJ3QgaGF2ZSBhIHJlZW50cmFuY3kgYXR0YWNrLgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbkFkZHJlc3MsIF90b2tlbklkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgcHJvY2VlZHMgdG8gc2VsbGVyIChpZiB0aGVyZSBhcmUgYW55ISkKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYXVjdGlvbmVlcidzIGN1dC4KICAgICAgICAgICAgLy8gKE5PVEU6IF9jb21wdXRlQ3V0KCkgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gYQogICAgICAgICAgICAvLyB2YWx1ZSA8PSBwcmljZSwgc28gdGhpcyBzdWJ0cmFjdGlvbiBjYW4ndCBnbyBuZWdhdGl2ZS4pCiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKCiAgICAgICAgICAgIC8vIE5PVEU6IERvaW5nIGEgdHJhbnNmZXIoKSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcGxleAogICAgICAgICAgICAvLyBtZXRob2QgbGlrZSB0aGlzIGlzIGdlbmVyYWxseSBkaXNjb3VyYWdlZCBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHJlZW50cmFuY3kgYXR0YWNrcyBhbmQgRG9TIGF0dGFja3MgaWYgdGhlIHNlbGxlciBpcwogICAgICAgICAgICAvLyBhIGNvbnRyYWN0IHdpdGggYW4gaW52YWxpZCBmYWxsYmFjayBmdW5jdGlvbi4gV2UgZXhwbGljaXRseQogICAgICAgICAgICAvLyBndWFyZCBhZ2FpbnN0IHJlZW50cmFuY3kgYXR0YWNrcyBieSByZW1vdmluZyB0aGUgYXVjdGlvbgogICAgICAgICAgICAvLyBiZWZvcmUgY2FsbGluZyB0cmFuc2ZlcigpLCBhbmQgdGhlIG9ubHkgdGhpbmcgdGhlIHNlbGxlcgogICAgICAgICAgICAvLyBjYW4gRG9TIGlzIHRoZSBzYWxlIG9mIHRoZWlyIG93biBhc3NldCEgKEFuZCBpZiBpdCdzIGFuCiAgICAgICAgICAgIC8vIGFjY2lkZW50LCB0aGV5IGNhbiBjYWxsIGNhbmNlbEF1Y3Rpb24oKS4gKQogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgd2l0aCB0aGUgYmlkLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gYmlkZGVyLgogICAgICAgIC8vIE5PVEU6IFdlIGNoZWNrZWQgYWJvdmUgdGhhdCB0aGUgYmlkIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgcHJpY2Ugc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gX2JpZEFtb3VudCAtIHByaWNlOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzLiBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyB0cmFuc2ZlciwgdGhpcyBpcwogICAgICAgIC8vIG5vdCBzdXNjZXB0aWJsZSB0byBhIHJlLWVudHJ5IGF0dGFjayBiZWNhdXNlIHRoZSBhdWN0aW9uIGlzCiAgICAgICAgLy8gcmVtb3ZlZCBiZWZvcmUgYW55IHRyYW5zZmVycyBvY2N1ci4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJpZEV4Y2Vzcyk7CgogICAgICAgIC8vIFRlbGwgdGhlIHdvcmxkIQogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbkFkZHJlc3MsIF90b2tlbklkLCBwcmljZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmVzIGFuIGF1Y3Rpb24gZnJvbSB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gX3JlbW92ZUF1Y3Rpb24oYWRkcmVzcyBfdG9rZW5BZGRyZXNzLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuQWRkcmVzc11bX3Rva2VuSWRdOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgTkZUIGlzIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hdWN0aW9uIC0gQXVjdGlvbiB0byBjaGVjay4KICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBjdXJyZW50IHByaWNlIG9mIGFuIE5GVCBvbiBhdWN0aW9uLiBCcm9rZW4gaW50byB0d28KICAgIC8vLyAgZnVuY3Rpb25zICh0aGlzIG9uZSwgdGhhdCBjb21wdXRlcyB0aGUgZHVyYXRpb24gZnJvbSB0aGUgYXVjdGlvbgogICAgLy8vICBzdHJ1Y3R1cmUsIGFuZCB0aGUgb3RoZXIgdGhhdCBkb2VzIHRoZSBwcmljZSBjb21wdXRhdGlvbikgc28gd2UKICAgIC8vLyAgY2FuIGVhc2lseSB0ZXN0IHRoYXQgdGhlIHByaWNlIGNvbXB1dGF0aW9uIHdvcmtzIGNvcnJlY3RseS4KICAgIGZ1bmN0aW9uIF9jdXJyZW50UHJpY2UoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgdWludDI1NiBzZWNvbmRzUGFzc2VkID0gMDsKCiAgICAgICAgLy8gQSBiaXQgb2YgaW5zdXJhbmNlIGFnYWluc3QgbmVnYXRpdmUgdmFsdWVzIChvciB3cmFwYXJvdW5kKS4KICAgICAgICAvLyBQcm9iYWJseSBub3QgbmVjZXNzYXJ5IChzaW5jZSBFdGhlcmV1bSBndWFybmF0ZWVzIHRoYXQgdGhlCiAgICAgICAgLy8gbm93IHZhcmlhYmxlIGRvZXNuJ3QgZXZlciBnbyBiYWNrd2FyZHMpLgogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICAgICAgX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBzZWNvbmRzUGFzc2VkCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLiBGYWN0b3JlZCBvdXQKICAgIC8vLyAgZnJvbSBfY3VycmVudFByaWNlIHNvIHdlIGNhbiBydW4gZXh0ZW5zaXZlIHVuaXQgdGVzdHMuCiAgICAvLy8gIFdoZW4gdGVzdGluZywgbWFrZSB0aGlzIGZ1bmN0aW9uIHB1YmxpYyBhbmQgdHVybiBvbgogICAgLy8vICBgQ3VycmVudCBwcmljZSBjb21wdXRhdGlvbmAgdGVzdCBzdWl0ZS4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBfc2Vjb25kc1Bhc3NlZAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBwdWJsaWMgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICB0aW1lIChhdCA2NC1iaXRzKSBhbmQgY3VycmVuY3kgKGF0IDEyOC1iaXRzKS4gX2R1cmF0aW9uIGlzCiAgICAgICAgLy8gIGFsc28ga25vd24gdG8gYmUgbm9uLXplcm8gKHNlZSB0aGUgcmVxdWlyZSgpIHN0YXRlbWVudCBpbgogICAgICAgIC8vICBfYWRkQXVjdGlvbigpKQogICAgICAgIGlmIChfc2Vjb25kc1Bhc3NlZCA+PSBfZHVyYXRpb24pIHsKICAgICAgICAgICAgLy8gV2UndmUgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcG9ydGlvbgogICAgICAgICAgICAvLyBvZiB0aGUgYXVjdGlvbiwganVzdCByZXR1cm4gdGhlIGVuZCBwcmljZS4KICAgICAgICAgICAgcmV0dXJuIF9lbmRpbmdQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTdGFydGluZyBwcmljZSBjYW4gYmUgaGlnaGVyIHRoYW4gZW5kaW5nIHByaWNlIChhbmQgb2Z0ZW4gaXMhKSwgc28KICAgICAgICAgICAgLy8gdGhpcyBkZWx0YSBjYW4gYmUgbmVnYXRpdmUuCiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9lbmRpbmdQcmljZSkgLSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpOwoKICAgICAgICAgICAgLy8gVGhpcyBtdWx0aXBsaWNhdGlvbiBjYW4ndCBvdmVyZmxvdywgX3NlY29uZHNQYXNzZWQgd2lsbCBlYXNpbHkgZml0IHdpdGhpbgogICAgICAgICAgICAvLyA2NC1iaXRzLCBhbmQgdG90YWxQcmljZUNoYW5nZSB3aWxsIGVhc2lseSBmaXQgd2l0aGluIDEyOC1iaXRzLCB0aGVpciBwcm9kdWN0CiAgICAgICAgICAgIC8vIHdpbGwgYWx3YXlzIGZpdCB3aXRoaW4gMjU2LWJpdHMuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KF9zZWNvbmRzUGFzc2VkKSAvIGludDI1NihfZHVyYXRpb24pOwoKICAgICAgICAgICAgLy8gY3VycmVudFByaWNlQ2hhbmdlIGNhbiBiZSBuZWdhdGl2ZSwgYnV0IGlmIHNvLCB3aWxsIGhhdmUgYSBtYWduaXR1ZGUKICAgICAgICAgICAgLy8gbGVzcyB0aGF0IF9zdGFydGluZ1ByaWNlLiBUaHVzLCB0aGlzIHJlc3VsdCB3aWxsIGFsd2F5cyBlbmQgdXAgcG9zaXRpdmUuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwoKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgb3duZXIncyBjdXQgb2YgYSBzYWxlLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgLSBTYWxlIHByaWNlIG9mIE5GVC4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIHRpbWUgdG8gbW92ZSBiZXR3ZWVuIHN0YXJ0aW5nCiAgICAvLy8gIHByaWNlIGFuZCBlbmRpbmcgcHJpY2UgKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIGFkZHJlc3MgX3Rva2VuQWRkcmVzcywKICAgICAgICB1aW50MjU2IF90b2tlbklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgYWRkcmVzcyBfc2VsbGVyCiAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgdGhpcyB0b2tlbiBpcyBzdXBwb3J0ZWQKICAgICAgICByZXF1aXJlKHN1cHBvcnRlZFRva2Vuc1tfdG9rZW5BZGRyZXNzXSk7CgogICAgICAgIC8vIEF1Y3Rpb25zIG11c3QgYmUgbWFkZSBieSB0aGUgdG9rZW4gY29udHJhY3Qgb3IgdGhlIHRva2VuIG93bmVyCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IF90b2tlbkFkZHJlc3MgfHwgX293bnMoX3Rva2VuQWRkcmVzcywgbXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIF9lc2Nyb3coX3Rva2VuQWRkcmVzcywgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbkFkZHJlc3MsIF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBCaWRzIG9uIGFuIG9wZW4gYXVjdGlvbiwgY29tcGxldGluZyB0aGUgYXVjdGlvbiBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWQoYWRkcmVzcyBfdG9rZW5BZGRyZXNzLCB1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIC8vIENoZWNrIHRoaXMgdG9rZW4gaXMgc3VwcG9ydGVkCiAgICAgICAgcmVxdWlyZShzdXBwb3J0ZWRUb2tlbnNbX3Rva2VuQWRkcmVzc10pOwogICAgICAgIC8vIF9iaWQgd2lsbCB0aHJvdyBpZiB0aGUgYmlkIG9yIGZ1bmRzIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgX2JpZChfdG9rZW5BZGRyZXNzLCBfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIoX3Rva2VuQWRkcmVzcywgbXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB0aGF0IGhhc24ndCBiZWVuIHdvbiB5ZXQuCiAgICAvLy8gIFJldHVybnMgdGhlIE5GVCB0byBvcmlnaW5hbCBvd25lci4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgYSBzdGF0ZS1tb2RpZnlpbmcgZnVuY3Rpb24gdGhhdCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIHdoaWxlIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gb24gYXVjdGlvbgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbihhZGRyZXNzIF90b2tlbkFkZHJlc3MsIHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICAvLyBXZSBkb24ndCBjaGVjayBpZiBhIHRva2VuIGlzIHN1cHBvcnRlZCBoZXJlIGJlY2F1c2Ugd2UgbWF5IHJlbW92ZSBzdXBwb3J0ZWQKICAgICAgICAvLyBUaGlzIGFsbG93cyB1c2VycyB0byBjYW5jZWwgYXVjdGlvbnMgZm9yIHRva2VucyB0aGF0IGhhdmUgYmVlbiByZW1vdmVkCiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbkFkZHJlc3NdW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsbGVyKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5BZGRyZXNzLCBfdG9rZW5JZCwgc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGF1Y3Rpb24gaW5mbyBmb3IgYW4gTkZUIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgTkZUIG9uIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKGFkZHJlc3MgX3Rva2VuQWRkcmVzcywgdWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zCiAgICAoCiAgICAgICAgYWRkcmVzcyBzZWxsZXIsCiAgICAgICAgdWludDI1NiBzdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBkdXJhdGlvbiwKICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgKSB7CiAgICAgICAgLy8gQ2hlY2sgdGhpcyB0b2tlbiBpcyBzdXBwb3J0ZWQKICAgICAgICByZXF1aXJlKHN1cHBvcnRlZFRva2Vuc1tfdG9rZW5BZGRyZXNzXSk7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbkFkZHJlc3NdW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgIGF1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0aGUgdG9rZW4gcHJpY2Ugd2UgYXJlIGNoZWNraW5nLgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKGFkZHJlc3MgX3Rva2VuQWRkcmVzcywgdWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIENoZWNrIHRoaXMgdG9rZW4gaXMgc3VwcG9ydGVkCiAgICAgICAgcmVxdWlyZShzdXBwb3J0ZWRUb2tlbnNbX3Rva2VuQWRkcmVzc10pOwogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5BZGRyZXNzXVtfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQp9Cgpjb250cmFjdCBDcnlwdG9IYW5kbGVzIGlzIEVSQzcyMVRva2VuIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIHVpbnQyNTYgcHVibGljIGRlZmF1bHRCdXlOb3dQcmljZSA9IDEwMCBmaW5uZXk7CiAgICB1aW50MjU2IHB1YmxpYyBkZWZhdWx0QXVjdGlvblByaWNlID0gMSBldGhlcjsKICAgIHVpbnQyNTYgcHVibGljIGRlZmF1bHRBdWN0aW9uRHVyYXRpb24gPSAxIGRheXM7CgogICAgQXVjdGlvbkhvdXNlIHB1YmxpYyBhdWN0aW9uczsKCiAgICBtYXBwaW5nICh1aW50ID0+IGJ5dGVzMzIpIGhhbmRsZXM7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHJldmVyc2U7CgogICAgZXZlbnQgU2V0UmVjb3JkKGJ5dGVzMzIgaW5kZXhlZCBoYW5kbGUsIHN0cmluZyBpbmRleGVkIGtleSwgc3RyaW5nIHZhbHVlKTsKCiAgICBmdW5jdGlvbiBDcnlwdG9IYW5kbGVzKGFkZHJlc3MgYXVjdGlvbkFkZHJlc3MpIHsKICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICBhdWN0aW9ucyA9IEF1Y3Rpb25Ib3VzZShhdWN0aW9uQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQ2hhbmdlIG93bmVyIG9mIHRoZSBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBXaXRoZHJhdyBmdW5kcwogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgZXh0ZXJuYWwgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IFNldCBidXkgbm93IHByaWNlCiAgICAqLwogICAgZnVuY3Rpb24gc2V0QnV5Tm93UHJpY2UodWludCBwcmljZSkgZXh0ZXJuYWwgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICBkZWZhdWx0QnV5Tm93UHJpY2UgPSBwcmljZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBTZXQgYnV5IG5vdyBwcmljZQogICAgKi8KICAgIGZ1bmN0aW9uIHNldEF1Y3Rpb25QcmljZSh1aW50IHByaWNlKSBleHRlcm5hbCB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgIGRlZmF1bHRBdWN0aW9uUHJpY2UgPSBwcmljZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBTZXQgZHVyYXRpb24KICAgICovCiAgICBmdW5jdGlvbiBzZXRBdWN0aW9uRHVyYXRpb24odWludCBkdXJhdGlvbikgZXh0ZXJuYWwgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICBkZWZhdWx0QXVjdGlvbkR1cmF0aW9uID0gZHVyYXRpb247CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQWNjZXB0IHByb2NlZWRzIGZyb20gYXVjdGlvbiBzYWxlcwogICAgKi8KICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUge30KCiAgICAvKioKICAgICogQGRldiBDcmVhdGUgYSBuZXcgaGFuZGxlIGlmIHRoZSBoYW5kbGUgaXMgdmFsaWQgYW5kIG5vdCBvd25lZAogICAgKiBAcGFyYW0gX2hhbmRsZSBieXRlczMyIGhhbmRsZSB0byByZWdpc3RlcgogICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZShieXRlczMyIF9oYW5kbGUpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNIYW5kbGVWYWxpZChfaGFuZGxlKSk7CiAgICAgICAgcmVxdWlyZShpc0hhbmRsZUF2YWlsYWJsZShfaGFuZGxlKSk7CiAgICAgICAgdWludCBfdG9rZW5JZCA9IHRvdGFsVG9rZW5zOwogICAgICAgIGhhbmRsZXNbX3Rva2VuSWRdID0gX2hhbmRsZTsKICAgICAgICByZXZlcnNlW19oYW5kbGVdID0gX3Rva2VuSWQ7CgogICAgICAgIC8vIGhhbmRsZSBidXkgbm93CiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSBkZWZhdWx0QnV5Tm93UHJpY2UpIHsKICAgICAgICAgIF9taW50KG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gb3RoZXJ3aXNlIHN0YXJ0IGFuIGF1Y3Rpb24KICAgICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogICAgICAgICAgLy8gbWludCB0aGUgdG9rZW4gdG8gdGhlIGFkZHJlc3MKICAgICAgICAgIF9taW50KGFkZHJlc3MoYXVjdGlvbnMpLCBfdG9rZW5JZCk7CiAgICAgICAgICBhdWN0aW9ucy5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICAgICAgX3Rva2VuSWQsCiAgICAgICAgICAgICAgZGVmYXVsdEF1Y3Rpb25QcmljZSwKICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgIGRlZmF1bHRBdWN0aW9uRHVyYXRpb24sCiAgICAgICAgICAgICAgYWRkcmVzcyh0aGlzKQogICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQ2hlY2tzIGlmIGEgaGFuZGxlIGlzIHZhbGlkOiBhLXosIDAtOSwgXwogICAgKiBAcGFyYW0gX2hhbmRsZSBieXRlczMyIHRvIGNoZWNrIHZhbGlkaXR5CiAgICAqLwogICAgZnVuY3Rpb24gaXNIYW5kbGVWYWxpZChieXRlczMyIF9oYW5kbGUpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoX2hhbmRsZSA9PSAweDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBib29sIHBhZGRlZDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAzMjsgaSsrKSB7CiAgICAgICAgICAgIGJ5dGUgY2hhciA9IGJ5dGUoYnl0ZXMzMih1aW50KF9oYW5kbGUpICogMiAqKiAoOCAqIGkpKSk7CiAgICAgICAgICAgIC8vIG51bGwgZm9yIHBhZGRpbmcKICAgICAgICAgICAgaWYgKGNoYXIgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICBwYWRkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbnVtYmVycyAwLTkKICAgICAgICAgICAgaWYgKGNoYXIgPj0gMHgzMCAgJiYgY2hhciA8PSAweDM5ICYmICFwYWRkZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGxvd2VyY2FzZSBsZXR0ZXJzIGEtegogICAgICAgICAgICBpZiAoY2hhciA+PSAweDYxICAmJiBjaGFyIDw9IDB4N0EgJiYgIXBhZGRlZCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdW5kZXJzY29yZXMgXwogICAgICAgICAgICBpZiAoY2hhciA9PSAweDVGICYmICFwYWRkZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQ2hlY2tzIGlmIGEgaGFuZGxlIGlzIGF2YWlsYWJsZQogICAgKiBAcGFyYW0gX2hhbmRsZSBieXRlczMyIGhhbmRsZSB0byBjaGVjayBhdmFpbGFiaWxpdHkKICAgICovCiAgICBmdW5jdGlvbiBpc0hhbmRsZUF2YWlsYWJsZShieXRlczMyIF9oYW5kbGUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBHZXQgdGhlIHRva2VuSWQgZm9yIGEgZ2l2ZW4gaGFuZGxlCiAgICAgICAgdWludCB0b2tlbklkID0gcmV2ZXJzZVtfaGFuZGxlXTsKICAgICAgICBpZiAoaGFuZGxlc1t0b2tlbklkXSAhPSBfaGFuZGxlKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQXBwcm92ZSB0aGUgQXVjdGlvbkhvdXNlIGFuZCBzdGFydCBhbiBhdWN0aW9uCiAgICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2CiAgICAqIEBwYXJhbSBfc3RhcnRpbmdQcmljZSB1aW50MjU2CiAgICAqIEBwYXJhbSBfZW5kaW5nUHJpY2UgdWludDI1NgogICAgKiBAcGFyYW0gX2R1cmF0aW9uIHVpbnQyNTYKICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF9zdGFydGluZ1ByaWNlLCB1aW50MjU2IF9lbmRpbmdQcmljZSwgdWludDI1NiBfZHVyYXRpb24pIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IG1zZy5zZW5kZXIpOwogICAgICAgIHRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IGFkZHJlc3MoYXVjdGlvbnMpOwogICAgICAgIGF1Y3Rpb25zLmNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICAgIF90b2tlbklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEdldCB0b2tlbklkIGZvciBhIGdpdmVuIGhhbmRsZQogICAgKiBAcGFyYW0gX2hhbmRsZSBieXRlczMyIGhhbmRsZQogICAgKi8KICAgIGZ1bmN0aW9uIHRva2VuSWRGb3JIYW5kbGUoYnl0ZXMzMiBfaGFuZGxlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gSGFuZGxlIDAgaW5kZXgKICAgICAgICB1aW50IHRva2VuSWQgPSByZXZlcnNlW19oYW5kbGVdOwogICAgICAgIHJlcXVpcmUoaGFuZGxlc1t0b2tlbklkXSA9PSBfaGFuZGxlKTsKICAgICAgICByZXR1cm4gdG9rZW5JZDsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBHZXQgaGFuZGxlIGZvciBhIGdpdmVuIHRva2VuSWQKICAgICogQHBhcmFtIF90b2tlbklkIHVpbnQKICAgICovCiAgICBmdW5jdGlvbiBoYW5kbGVGb3JUb2tlbklkKHVpbnQgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBieXRlczMyIGhhbmRsZSA9IGhhbmRsZXNbX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoaGFuZGxlICE9IDB4MCk7CiAgICAgICAgcmV0dXJuIGhhbmRsZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBHZXQgdGhlIGhhbmRsZSBvd25lcgogICAgKiBAcGFyYW0gX2hhbmRsZSBieXRlczMyIGhhbmRsZSB0byBjaGVjayBhdmFpbGFiaWxpdHkKICAgICovCiAgICBmdW5jdGlvbiBnZXRIYW5kbGVPd25lcihieXRlczMyIF9oYW5kbGUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICAvLyBIYW5kbGUgMCBpbmRleAogICAgICAgIHVpbnQgdG9rZW5JZCA9IHJldmVyc2VbX2hhbmRsZV07CiAgICAgICAgcmVxdWlyZShoYW5kbGVzW3Rva2VuSWRdID09IF9oYW5kbGUpOwogICAgICAgIHJldHVybiBvd25lck9mKHRva2VuSWQpOwogICAgfQoKICAgIC8vLyBSZWNvcmRzIGZvciBhIGhhbmRsZQogICAgbWFwcGluZyhieXRlczMyID0+IG1hcHBpbmcoc3RyaW5nID0+IHN0cmluZykpIGludGVybmFsIHJlY29yZHM7CgogICAgZnVuY3Rpb24gc2V0UmVjb3JkKGJ5dGVzMzIgX2hhbmRsZSwgc3RyaW5nIF9rZXksIHN0cmluZyBfdmFsdWUpIGV4dGVybmFsIHsKICAgICAgICB1aW50IHRva2VuSWQgPSByZXZlcnNlW19oYW5kbGVdOwogICAgICAgIHJlcXVpcmUob3duZXJPZih0b2tlbklkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZWNvcmRzW19oYW5kbGVdW19rZXldID0gX3ZhbHVlOwogICAgICAgIFNldFJlY29yZChfaGFuZGxlLCBfa2V5LCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJlY29yZChieXRlczMyIF9oYW5kbGUsIHN0cmluZyBfa2V5KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiByZWNvcmRzW19oYW5kbGVdW19rZXldOwogICAgfQp9'.
	

]
