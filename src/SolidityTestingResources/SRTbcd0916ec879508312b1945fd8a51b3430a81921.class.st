Class {
	#name : #SRTbcd0916ec879508312b1945fd8a51b3430a81921,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbcd0916ec879508312b1945fd8a51b3430a81921 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBJR29sZCB7CiAgICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2Vucyk7CiAgICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2Vucyk7Cn0KCi8vIFN0ZFRva2VuIGluaGVyaXRhbmNlIGlzIGNvbW1lbnRlZCwgYmVjYXVzZSBubyAndG90YWxTdXBwbHknIG5lZWRlZApjb250cmFjdCBJTU5UUCB7IC8qaXMgU3RkVG9rZW4gKi8KICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwovLyBBZGRpdGlvbmFsIG1ldGhvZHMgdGhhdCBNTlRQIGNvbnRyYWN0IHByb3ZpZGVzCiAgICAgZnVuY3Rpb24gbG9ja1RyYW5zZmVyKGJvb2wgX2xvY2spOwogICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zKGFkZHJlc3MgX3dobywgdWludCBfdG9rZW5zKTsKICAgICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgX3dobywgdWludCBfdG9rZW5zKTsKfQoKY29udHJhY3QgU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjPj1hICYmIGM+PWIpOwogICAgICAgIHJldHVybiBjOwogICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQp9Cgpjb250cmFjdCBDcmVhdG9yRW5hYmxlZCB7CiAgICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvciA9IDB4MDsKCiAgICAgbW9kaWZpZXIgb25seUNyZWF0b3IoKSB7IHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcmVhdG9yKTsgXzsgfQoKICAgICBmdW5jdGlvbiBjaGFuZ2VDcmVhdG9yKGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgY3JlYXRvciA9IF90bzsKICAgICB9Cn0KCmNvbnRyYWN0IFN0cmluZ01vdmVyIHsKICAgICBmdW5jdGlvbiBzdHJpbmdUb0J5dGVzMzIoc3RyaW5nIHMpIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMil7CiAgICAgICAgICBieXRlczMyIG91dDsKICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgb3V0IDo9IG1sb2FkKGFkZChzLCAzMikpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gb3V0OwogICAgIH0KCiAgICAgZnVuY3Rpb24gc3RyaW5nVG9CeXRlczY0KHN0cmluZyBzKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIsYnl0ZXMzMil7CiAgICAgICAgICBieXRlczMyIG91dDsKICAgICAgICAgIGJ5dGVzMzIgb3V0MjsKCiAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgIG91dCA6PSBtbG9hZChhZGQocywgMzIpKQogICAgICAgICAgICAgICBvdXQyIDo9IG1sb2FkKGFkZChzLCA2NCkpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gKG91dCxvdXQyKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGJ5dGVzMzJUb1N0cmluZyhieXRlczMyIHgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICAgIHVpbnQgY2hhckNvdW50ID0gMDsKICAgICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IDMyOyBqKyspIHsKICAgICAgICAgICAgICAgYnl0ZSBjaGFyID0gYnl0ZShieXRlczMyKHVpbnQoeCkgKiAyICoqICg4ICogaikpKTsKICAgICAgICAgICAgICAgaWYgKGNoYXIgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzU3RyaW5nW2NoYXJDb3VudF0gPSBjaGFyOwogICAgICAgICAgICAgICAgICAgIGNoYXJDb3VudCsrOwogICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBieXRlcyBtZW1vcnkgYnl0ZXNTdHJpbmdUcmltbWVkID0gbmV3IGJ5dGVzKGNoYXJDb3VudCk7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY2hhckNvdW50OyBqKyspIHsKICAgICAgICAgICAgICAgYnl0ZXNTdHJpbmdUcmltbWVkW2pdID0gYnl0ZXNTdHJpbmdbal07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gc3RyaW5nKGJ5dGVzU3RyaW5nVHJpbW1lZCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBieXRlczY0VG9TdHJpbmcoYnl0ZXMzMiB4LCBieXRlczMyIHkpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICAgIHVpbnQgY2hhckNvdW50ID0gMDsKCiAgICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCAzMjsgaisrKSB7CiAgICAgICAgICAgICAgIGJ5dGUgY2hhciA9IGJ5dGUoYnl0ZXMzMih1aW50KHgpICogMiAqKiAoOCAqIGopKSk7CiAgICAgICAgICAgICAgIGlmIChjaGFyICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1N0cmluZ1tjaGFyQ291bnRdID0gY2hhcjsKICAgICAgICAgICAgICAgICAgICBjaGFyQ291bnQrKzsKICAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm9yIChqID0gMDsgaiA8IDMyOyBqKyspIHsKICAgICAgICAgICAgICAgY2hhciA9IGJ5dGUoYnl0ZXMzMih1aW50KHkpICogMiAqKiAoOCAqIGopKSk7CiAgICAgICAgICAgICAgIGlmIChjaGFyICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1N0cmluZ1tjaGFyQ291bnRdID0gY2hhcjsKICAgICAgICAgICAgICAgICAgICBjaGFyQ291bnQrKzsKICAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlc1N0cmluZ1RyaW1tZWQgPSBuZXcgYnl0ZXMoY2hhckNvdW50KTsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjaGFyQ291bnQ7IGorKykgewogICAgICAgICAgICAgICBieXRlc1N0cmluZ1RyaW1tZWRbal0gPSBieXRlc1N0cmluZ1tqXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzdHJpbmcoYnl0ZXNTdHJpbmdUcmltbWVkKTsKICAgICB9Cn0KCgpjb250cmFjdCBTdG9yYWdlIGlzIFNhZmVNYXRoLCBTdHJpbmdNb3ZlciB7CiAgICAgZnVuY3Rpb24gU3RvcmFnZSgpIHB1YmxpYyB7CiAgICAgICAgICBjb250cm9sbGVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgfQoKICAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyQWRkcmVzcyA9IDB4MDsKICAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcigpIHsgcmVxdWlyZShtc2cuc2VuZGVyPT1jb250cm9sbGVyQWRkcmVzcyk7IF87IH0KCiAgICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlckFkZHJlc3MoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgICAgICAgY29udHJvbGxlckFkZHJlc3MgPSBfbmV3Q29udHJvbGxlcjsKICAgICB9CgogICAgIGFkZHJlc3MgcHVibGljIGhvdFdhbGxldEFkZHJlc3MgPSAweDA7CgogICAgIGZ1bmN0aW9uIHNldEhvdFdhbGxldEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgb25seUNvbnRyb2xsZXIgewogICAgICAgICBob3RXYWxsZXRBZGRyZXNzID0gX2FkZHJlc3M7CiAgICAgfQoKLy8gRmllbGRzIC0gMQogICAgIG1hcHBpbmcodWludCA9PiBzdHJpbmcpIGRvY3M7CiAgICAgdWludCBwdWJsaWMgZG9jQ291bnQgPSAwOwoKLy8gRmllbGRzIC0gMiAKICAgICBtYXBwaW5nKHN0cmluZyA9PiBtYXBwaW5nKHVpbnQgPT4gaW50KSkgZmlhdFR4czsKICAgICBtYXBwaW5nKHN0cmluZyA9PiB1aW50KSBmaWF0QmFsYW5jZXNDZW50czsKICAgICBtYXBwaW5nKHN0cmluZyA9PiB1aW50KSBmaWF0VHhDb3VudHM7CiAgICAgdWludCBmaWF0VHhUb3RhbCA9IDA7CgovLyBGaWVsZHMgLSAzIAogICAgIG1hcHBpbmcoc3RyaW5nID0+IG1hcHBpbmcodWludCA9PiBpbnQpKSBnb2xkVHhzOwogICAgIG1hcHBpbmcoc3RyaW5nID0+IHVpbnQpIGdvbGRIb3RCYWxhbmNlczsKICAgICBtYXBwaW5nKHN0cmluZyA9PiB1aW50KSBnb2xkVHhDb3VudHM7CiAgICAgdWludCBnb2xkVHhUb3RhbCA9IDA7CgovLyBGaWVsZHMgLSA0IAogICAgIHN0cnVjdCBSZXF1ZXN0IHsKICAgICAgICAgIGFkZHJlc3Mgc2VuZGVyOwogICAgICAgICAgc3RyaW5nIHVzZXJJZDsKICAgICAgICAgIHN0cmluZyByZXF1ZXN0SGFzaDsKICAgICAgICAgIGJvb2wgYnV5UmVxdWVzdDsgICAgICAgICAvLyBvdGhlcndpc2UgLSBzZWxsCgogICAgICAgICAgLy8gMCAtIGluaXQKICAgICAgICAgIC8vIDEgLSBwcm9jZXNzZWQKICAgICAgICAgIC8vIDIgLSBjYW5jZWxsZWQKICAgICAgICAgIHVpbnQ4IHN0YXRlOwogICAgIH0KICAgICAKICAgICBtYXBwaW5nICh1aW50PT5SZXF1ZXN0KSByZXF1ZXN0czsKICAgICB1aW50IHB1YmxpYyByZXF1ZXN0c0NvdW50ID0gMDsKCi8vLy8vLy8KICAgICBmdW5jdGlvbiBhZGREb2Moc3RyaW5nIF9pcGZzRG9jTGluaykgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnModWludCkgewogICAgICAgICAgZG9jc1tkb2NDb3VudF0gPSBfaXBmc0RvY0xpbms7CiAgICAgICAgICB1aW50IG91dCA9IGRvY0NvdW50OwogICAgICAgICAgZG9jQ291bnQrKzsKCiAgICAgICAgICByZXR1cm4gb3V0OwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0RG9jQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgcmV0dXJuIGRvY0NvdW50OyAKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldERvY0FzQnl0ZXM2NCh1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIsYnl0ZXMzMikgewogICAgICAgICAgcmVxdWlyZShfaW5kZXggPCBkb2NDb3VudCk7CiAgICAgICAgICByZXR1cm4gc3RyaW5nVG9CeXRlczY0KGRvY3NbX2luZGV4XSk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBhZGRGaWF0VHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIGludCBfYW1vdW50Q2VudHMpIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJlcXVpcmUoMCAhPSBfYW1vdW50Q2VudHMpOwoKICAgICAgICAgIHVpbnQgYyA9IGZpYXRUeENvdW50c1tfdXNlcklkXTsKCiAgICAgICAgICBmaWF0VHhzW191c2VySWRdW2NdID0gX2Ftb3VudENlbnRzOwogICAgICAgIAogICAgICAgICAgaWYgKF9hbW91bnRDZW50cyA+IDApIHsKICAgICAgICAgICAgICBmaWF0QmFsYW5jZXNDZW50c1tfdXNlcklkXSA9IHNhZmVBZGQoZmlhdEJhbGFuY2VzQ2VudHNbX3VzZXJJZF0sIHVpbnQoX2Ftb3VudENlbnRzKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZpYXRCYWxhbmNlc0NlbnRzW191c2VySWRdID0gc2FmZVN1YihmaWF0QmFsYW5jZXNDZW50c1tfdXNlcklkXSwgdWludCgtX2Ftb3VudENlbnRzKSk7CiAgICAgICAgICB9CgogICAgICAgICAgZmlhdFR4Q291bnRzW191c2VySWRdID0gc2FmZUFkZChmaWF0VHhDb3VudHNbX3VzZXJJZF0sIDEpOwoKICAgICAgICAgIGZpYXRUeFRvdGFsKys7CiAgICAgICAgICByZXR1cm4gYzsKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldEZpYXRUcmFuc2FjdGlvbnNDb3VudChzdHJpbmcgX3VzZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBmaWF0VHhDb3VudHNbX3VzZXJJZF07CiAgICAgfQogICAgIAogICAgIGZ1bmN0aW9uIGdldEFsbEZpYXRUcmFuc2FjdGlvbnNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICByZXR1cm4gZmlhdFR4VG90YWw7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRGaWF0VHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIHVpbnQgX2luZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhpbnQpIHsKICAgICAgICAgIHJlcXVpcmUoX2luZGV4IDwgZmlhdFR4Q291bnRzW191c2VySWRdKTsKICAgICAgICAgIHJldHVybiBmaWF0VHhzW191c2VySWRdW19pbmRleF07CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRVc2VyRmlhdEJhbGFuY2Uoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBmaWF0QmFsYW5jZXNDZW50c1tfdXNlcklkXTsKICAgICB9CgogICAgZnVuY3Rpb24gYWRkR29sZFRyYW5zYWN0aW9uKHN0cmluZyBfdXNlcklkLCBpbnQgX2Ftb3VudCkgcHVibGljIG9ubHlDb250cm9sbGVyIHJldHVybnModWludCkgewogICAgICAgICAgcmVxdWlyZSgwICE9IF9hbW91bnQpOwoKICAgICAgICAgIHVpbnQgYyA9IGdvbGRUeENvdW50c1tfdXNlcklkXTsKCiAgICAgICAgICBnb2xkVHhzW191c2VySWRdW2NdID0gX2Ftb3VudDsKCiAgICAgICAgICBpZiAoX2Ftb3VudCA+IDApIHsKICAgICAgICAgICAgICBnb2xkSG90QmFsYW5jZXNbX3VzZXJJZF0gPSBzYWZlQWRkKGdvbGRIb3RCYWxhbmNlc1tfdXNlcklkXSwgdWludChfYW1vdW50KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGdvbGRIb3RCYWxhbmNlc1tfdXNlcklkXSA9IHNhZmVTdWIoZ29sZEhvdEJhbGFuY2VzW191c2VySWRdLCB1aW50KC1fYW1vdW50KSk7CiAgICAgICAgICB9CgogICAgICAgICAgZ29sZFR4Q291bnRzW191c2VySWRdID0gc2FmZUFkZChnb2xkVHhDb3VudHNbX3VzZXJJZF0sIDEpOwoKICAgICAgICAgIGdvbGRUeFRvdGFsKys7CiAgICAgICAgICByZXR1cm4gYzsKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldEdvbGRUcmFuc2FjdGlvbnNDb3VudChzdHJpbmcgX3VzZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBnb2xkVHhDb3VudHNbX3VzZXJJZF07CiAgICAgfQogICAgIAogICAgIGZ1bmN0aW9uIGdldEFsbEdvbGRUcmFuc2FjdGlvbnNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICByZXR1cm4gZ29sZFR4VG90YWw7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRHb2xkVHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIHVpbnQgX2luZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhpbnQpIHsKICAgICAgICAgIHJlcXVpcmUoX2luZGV4IDwgZ29sZFR4Q291bnRzW191c2VySWRdKTsKICAgICAgICAgIHJldHVybiBnb2xkVHhzW191c2VySWRdW19pbmRleF07CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRVc2VySG90R29sZEJhbGFuY2Uoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBnb2xkSG90QmFsYW5jZXNbX3VzZXJJZF07CiAgICAgfQoKICAgICBmdW5jdGlvbiBhZGRCdXlUb2tlbnNSZXF1ZXN0KGFkZHJlc3MgX3dobywgc3RyaW5nIF91c2VySWQsIHN0cmluZyBfcmVxdWVzdEhhc2gpIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIFJlcXVlc3QgbWVtb3J5IHI7CiAgICAgICAgICByLnNlbmRlciA9IF93aG87CiAgICAgICAgICByLnVzZXJJZCA9IF91c2VySWQ7CiAgICAgICAgICByLnJlcXVlc3RIYXNoID0gX3JlcXVlc3RIYXNoOwogICAgICAgICAgci5idXlSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICAgIHIuc3RhdGUgPSAwOwoKICAgICAgICAgIHJlcXVlc3RzW3JlcXVlc3RzQ291bnRdID0gcjsKICAgICAgICAgIHVpbnQgb3V0ID0gcmVxdWVzdHNDb3VudDsKICAgICAgICAgIHJlcXVlc3RzQ291bnQrKzsKICAgICAgICAgIHJldHVybiBvdXQ7CiAgICAgfQoKICAgICBmdW5jdGlvbiBhZGRTZWxsVG9rZW5zUmVxdWVzdChhZGRyZXNzIF93aG8sIHN0cmluZyBfdXNlcklkLCBzdHJpbmcgX3JlcXVlc3RIYXNoKSBvbmx5Q29udHJvbGxlciByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIFJlcXVlc3QgbWVtb3J5IHI7CiAgICAgICAgICByLnNlbmRlciA9IF93aG87CiAgICAgICAgICByLnVzZXJJZCA9IF91c2VySWQ7CiAgICAgICAgICByLnJlcXVlc3RIYXNoID0gX3JlcXVlc3RIYXNoOwogICAgICAgICAgci5idXlSZXF1ZXN0ID0gZmFsc2U7CiAgICAgICAgICByLnN0YXRlID0gMDsKCiAgICAgICAgICByZXF1ZXN0c1tyZXF1ZXN0c0NvdW50XSA9IHI7CiAgICAgICAgICB1aW50IG91dCA9IHJlcXVlc3RzQ291bnQ7CiAgICAgICAgICByZXF1ZXN0c0NvdW50Kys7CiAgICAgICAgICByZXR1cm4gb3V0OwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0UmVxdWVzdHNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiByZXF1ZXN0c0NvdW50OwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0UmVxdWVzdCh1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgICBhZGRyZXNzIGEsIAogICAgICAgICAgYnl0ZXMzMiB1c2VySWQsIAogICAgICAgICAgYnl0ZXMzMiBoYXNoQSwgYnl0ZXMzMiBoYXNoQiwgCiAgICAgICAgICBib29sIGJ1eSwgdWludDggc3RhdGUpCiAgICAgewogICAgICAgICAgcmVxdWlyZShfaW5kZXggPCByZXF1ZXN0c0NvdW50KTsKCiAgICAgICAgICBSZXF1ZXN0IG1lbW9yeSByID0gcmVxdWVzdHNbX2luZGV4XTsKCiAgICAgICAgICBieXRlczMyIHVzZXJCeXRlcyA9IHN0cmluZ1RvQnl0ZXMzMihyLnVzZXJJZCk7CiAgICAgICAgICB2YXIgKG91dDEsIG91dDIpID0gc3RyaW5nVG9CeXRlczY0KHIucmVxdWVzdEhhc2gpOwoKICAgICAgICAgIHJldHVybiAoci5zZW5kZXIsIHVzZXJCeXRlcywgb3V0MSwgb3V0Miwgci5idXlSZXF1ZXN0LCByLnN0YXRlKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGNhbmNlbFJlcXVlc3QodWludCBfaW5kZXgpIG9ubHlDb250cm9sbGVyIHB1YmxpYyB7CiAgICAgICAgICByZXF1aXJlKF9pbmRleCA8IHJlcXVlc3RzQ291bnQpOwogICAgICAgICAgcmVxdWlyZSgwPT1yZXF1ZXN0c1tfaW5kZXhdLnN0YXRlKTsKCiAgICAgICAgICByZXF1ZXN0c1tfaW5kZXhdLnN0YXRlID0gMjsKICAgICB9CiAgICAgCiAgICAgZnVuY3Rpb24gc2V0UmVxdWVzdFByb2Nlc3NlZCh1aW50IF9pbmRleCkgb25seUNvbnRyb2xsZXIgcHVibGljIHsKICAgICAgICAgIHJlcXVlc3RzW19pbmRleF0uc3RhdGUgPSAxOwogICAgIH0KfQoKY29udHJhY3QgR29sZEZpYXRGZWUgaXMgQ3JlYXRvckVuYWJsZWQsIFN0cmluZ01vdmVyIHsKICAgICBzdHJpbmcgZ21Vc2VySWQgPSAiIjsKCi8vIEZ1bmN0aW9uczogCiAgICAgZnVuY3Rpb24gR29sZEZpYXRGZWUoc3RyaW5nIF9nbVVzZXJJZCkgewogICAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICBnbVVzZXJJZCA9IF9nbVVzZXJJZDsKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldEdvbGRtaW50RmVlQWNjb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIpIHsKICAgICAgICAgIGJ5dGVzMzIgdXNlckJ5dGVzID0gc3RyaW5nVG9CeXRlczMyKGdtVXNlcklkKTsKICAgICAgICAgIHJldHVybiB1c2VyQnl0ZXM7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRHb2xkbWludEZlZUFjY291bnQoc3RyaW5nIF9nbVVzZXJJZCkgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIGdtVXNlcklkID0gX2dtVXNlcklkOwogICAgIH0KICAgICAKICAgICBmdW5jdGlvbiBjYWxjdWxhdGVCdXlHb2xkRmVlKHVpbnQgX21udHBCYWxhbmNlLCB1aW50IF9nb2xkVmFsdWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgIH0KCiAgICAgZnVuY3Rpb24gY2FsY3VsYXRlU2VsbEdvbGRGZWUodWludCBfbW50cEJhbGFuY2UsIHVpbnQgX2dvbGRWYWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgICAgLy8gSWYgdGhlIHNlbmRlciBob2xkcyAwIE1OVFAsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIGZlZSBpcyAzJSBmaWF0LCAKICAgICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaG9sZHMgYXQgbGVhc3QgMTAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDIlIGZpYXQsCiAgICAgICAgICAvLyBJZiB0aGUgc2VuZGVyIGhvbGRzIGF0IGxlYXN0IDEwMDAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDEuNSUgZmlhdCwKICAgICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaG9sZHMgYXQgbGVhc3QgMTAwMDAgTU5UUCwgdGhlbiB0aGUgdHJhbnNhY3Rpb24gZmVlIGlzIDElIGZpYXQsCiAgICAgICAgICBpZiAoX21udHBCYWxhbmNlID49ICgxMDAwMCAqIDEgZXRoZXIpKSB7CiAgICAgICAgICAgICAgIHJldHVybiAoNzUgKiBfZ29sZFZhbHVlIC8gMTAwMDApOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfbW50cEJhbGFuY2UgPj0gKDEwMDAgKiAxIGV0aGVyKSkgewogICAgICAgICAgICAgICByZXR1cm4gKDE1ICogX2dvbGRWYWx1ZSAvIDEwMDApOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfbW50cEJhbGFuY2UgPj0gKDEwICogMSBldGhlcikpIHsKICAgICAgICAgICAgICAgcmV0dXJuICgyNSAqIF9nb2xkVmFsdWUgLyAxMDAwKTsKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgLy8gMyUKICAgICAgICAgIHJldHVybiAoMyAqIF9nb2xkVmFsdWUgLyAxMDApOwogICAgIH0KfQoKY29udHJhY3QgSUdvbGRGaWF0RmVlIHsKICAgICBmdW5jdGlvbiBnZXRHb2xkbWludEZlZUFjY291bnQoKXB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIpOwogICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUJ1eUdvbGRGZWUodWludCBfbW50cEJhbGFuY2UsIHVpbnQgX2dvbGRWYWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCk7CiAgICAgZnVuY3Rpb24gY2FsY3VsYXRlU2VsbEdvbGRGZWUodWludCBfbW50cEJhbGFuY2UsIHVpbnQgX2dvbGRWYWx1ZSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCk7Cn0KCmNvbnRyYWN0IFN0b3JhZ2VDb250cm9sbGVyIGlzIFNhZmVNYXRoLCBDcmVhdG9yRW5hYmxlZCwgU3RyaW5nTW92ZXIgewogICAgIFN0b3JhZ2UgcHVibGljIHN0b3I7CiAgICAgSU1OVFAgcHVibGljIG1udHBUb2tlbjsKICAgICBJR29sZCBwdWJsaWMgZ29sZFRva2VuOwogICAgIElHb2xkRmlhdEZlZSBwdWJsaWMgZmlhdEZlZTsKCiAgICAgZXZlbnQgTmV3VG9rZW5CdXlSZXF1ZXN0KGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgc3RyaW5nIGluZGV4ZWQgX3VzZXJJZCk7CiAgICAgZXZlbnQgTmV3VG9rZW5TZWxsUmVxdWVzdChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIHN0cmluZyBpbmRleGVkIF91c2VySWQpOwogICAgIGV2ZW50IFJlcXVlc3RDYW5jZWxsZWQodWludCBpbmRleGVkIF9yZXFJZCk7CiAgICAgZXZlbnQgUmVxdWVzdFByb2Nlc3NlZCh1aW50IGluZGV4ZWQgX3JlcUlkKTsKCiAgICAgZnVuY3Rpb24gU3RvcmFnZUNvbnRyb2xsZXIoYWRkcmVzcyBfbW50cENvbnRyYWN0QWRkcmVzcywgYWRkcmVzcyBfZ29sZENvbnRyYWN0QWRkcmVzcywgYWRkcmVzcyBfc3RvcmFnZUFkZHJlc3MsIGFkZHJlc3MgX2ZpYXRGZWVDb250cmFjdCkgewogICAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CgogICAgICAgICAgaWYgKDAgIT0gX3N0b3JhZ2VBZGRyZXNzKSB7CiAgICAgICAgICAgICAgIC8vIHVzZSBleGlzdGluZyBzdG9yYWdlCiAgICAgICAgICAgICAgIHN0b3IgPSBTdG9yYWdlKF9zdG9yYWdlQWRkcmVzcyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBzdG9yID0gbmV3IFN0b3JhZ2UoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXF1aXJlKDB4MCE9X21udHBDb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgcmVxdWlyZSgweDAhPV9nb2xkQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICAgIHJlcXVpcmUoMHgwIT1fZmlhdEZlZUNvbnRyYWN0KTsKCiAgICAgICAgICBtbnRwVG9rZW4gPSBJTU5UUChfbW50cENvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgICBnb2xkVG9rZW4gPSBJR29sZChfZ29sZENvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgICBmaWF0RmVlID0gSUdvbGRGaWF0RmVlKF9maWF0RmVlQ29udHJhY3QpOwogICAgIH0KCgogICAgIC8vIE9ubHkgb2xkIGNvbnRyb2xsZXIgY2FuIGNhbGwgc2V0Q29udHJvbGxlckFkZHJlc3MKICAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBzdG9yLnNldENvbnRyb2xsZXJBZGRyZXNzKF9uZXdDb250cm9sbGVyKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNldEhvdFdhbGxldEFkZHJlc3MoYWRkcmVzcyBfaG90V2FsbGV0QWRkcmVzcykgcHVibGljIG9ubHlDcmVhdG9yIHsKICAgICAgICAgc3Rvci5zZXRIb3RXYWxsZXRBZGRyZXNzKF9ob3RXYWxsZXRBZGRyZXNzKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldEhvdFdhbGxldEFkZHJlc3MoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgICAgcmV0dXJuIHN0b3IuaG90V2FsbGV0QWRkcmVzcygpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gY2hhbmdlRmlhdEZlZUNvbnRyYWN0KGFkZHJlc3MgX25ld0ZpYXRGZWUpIHB1YmxpYyBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBmaWF0RmVlID0gSUdvbGRGaWF0RmVlKF9uZXdGaWF0RmVlKTsKICAgICB9CgogICAgIC8vIDEKICAgICBmdW5jdGlvbiBhZGREb2Moc3RyaW5nIF9pcGZzRG9jTGluaykgcHVibGljIG9ubHlDcmVhdG9yIHJldHVybnModWludCkgewogICAgICAgICAgcmV0dXJuIHN0b3IuYWRkRG9jKF9pcGZzRG9jTGluayk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXREb2NDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICByZXR1cm4gc3Rvci5kb2NDb3VudCgpOyAKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldERvYyh1aW50IF9pbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgICAgdmFyICh4LCB5KSA9IHN0b3IuZ2V0RG9jQXNCeXRlczY0KF9pbmRleCk7CiAgICAgICAgICByZXR1cm4gYnl0ZXM2NFRvU3RyaW5nKHgseSk7CiAgICAgfQoKLy8gMgogICAgIC8vIF9hbW91bnRDZW50cyBjYW4gYmUgbmVnYXRpdmUKICAgICAvLyByZXR1cm5zIGluZGV4IGluIHVzZXIgYXJyYXkKICAgICBmdW5jdGlvbiBhZGRGaWF0VHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIGludCBfYW1vdW50Q2VudHMpIHB1YmxpYyBvbmx5Q3JlYXRvciByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBzdG9yLmFkZEZpYXRUcmFuc2FjdGlvbihfdXNlcklkLCBfYW1vdW50Q2VudHMpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0RmlhdFRyYW5zYWN0aW9uc0NvdW50KHN0cmluZyBfdXNlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgcmV0dXJuIHN0b3IuZ2V0RmlhdFRyYW5zYWN0aW9uc0NvdW50KF91c2VySWQpOwogICAgIH0KICAgICAKICAgICBmdW5jdGlvbiBnZXRBbGxGaWF0VHJhbnNhY3Rpb25zQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgcmV0dXJuIHN0b3IuZ2V0QWxsRmlhdFRyYW5zYWN0aW9uc0NvdW50KCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRGaWF0VHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIHVpbnQgX2luZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhpbnQpIHsKICAgICAgICAgIHJldHVybiBzdG9yLmdldEZpYXRUcmFuc2FjdGlvbihfdXNlcklkLCBfaW5kZXgpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0VXNlckZpYXRCYWxhbmNlKHN0cmluZyBfdXNlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgICByZXR1cm4gc3Rvci5nZXRVc2VyRmlhdEJhbGFuY2UoX3VzZXJJZCk7CiAgICAgfQoKLy8gMwoKICAgICBmdW5jdGlvbiBhZGRHb2xkVHJhbnNhY3Rpb24oc3RyaW5nIF91c2VySWQsIGludCBfYW1vdW50KSBwdWJsaWMgb25seUNyZWF0b3IgcmV0dXJucyh1aW50KSB7CiAgICAgICAgICByZXR1cm4gc3Rvci5hZGRHb2xkVHJhbnNhY3Rpb24oX3VzZXJJZCwgX2Ftb3VudCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRHb2xkVHJhbnNhY3Rpb25zQ291bnQoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICByZXR1cm4gc3Rvci5nZXRHb2xkVHJhbnNhY3Rpb25zQ291bnQoX3VzZXJJZCk7CiAgICAgfQogICAgIAogICAgIGZ1bmN0aW9uIGdldEFsbEdvbGRUcmFuc2FjdGlvbnNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICByZXR1cm4gc3Rvci5nZXRBbGxHb2xkVHJhbnNhY3Rpb25zQ291bnQoKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldEdvbGRUcmFuc2FjdGlvbihzdHJpbmcgX3VzZXJJZCwgdWludCBfaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGludCkgewogICAgICAgICAgcmV0dXJuIHN0b3IuZ2V0R29sZFRyYW5zYWN0aW9uKF91c2VySWQsIF9pbmRleCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRVc2VySG90R29sZEJhbGFuY2Uoc3RyaW5nIF91c2VySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBzdG9yLmdldFVzZXJIb3RHb2xkQmFsYW5jZShfdXNlcklkKTsKICAgICB9CgovLyA0OgogICAgIGZ1bmN0aW9uIGFkZEJ1eVRva2Vuc1JlcXVlc3Qoc3RyaW5nIF91c2VySWQsIHN0cmluZyBfcmVxdWVzdEhhc2gpIHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIE5ld1Rva2VuQnV5UmVxdWVzdChtc2cuc2VuZGVyLCBfdXNlcklkKTsgCiAgICAgICAgICByZXR1cm4gc3Rvci5hZGRCdXlUb2tlbnNSZXF1ZXN0KG1zZy5zZW5kZXIsIF91c2VySWQsIF9yZXF1ZXN0SGFzaCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBhZGRTZWxsVG9rZW5zUmVxdWVzdChzdHJpbmcgX3VzZXJJZCwgc3RyaW5nIF9yZXF1ZXN0SGFzaCkgcHVibGljIHJldHVybnModWludCkgewogICAgICAgICAgTmV3VG9rZW5TZWxsUmVxdWVzdChtc2cuc2VuZGVyLCBfdXNlcklkKTsKCQlyZXR1cm4gc3Rvci5hZGRTZWxsVG9rZW5zUmVxdWVzdChtc2cuc2VuZGVyLCBfdXNlcklkLCBfcmVxdWVzdEhhc2gpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0UmVxdWVzdHNDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAgIHJldHVybiBzdG9yLmdldFJlcXVlc3RzQ291bnQoKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGdldFJlcXVlc3QodWludCBfaW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MsIHN0cmluZywgc3RyaW5nLCBib29sLCB1aW50OCkgewogICAgICAgICAgdmFyIChzZW5kZXIsIHVzZXJJZEJ5dGVzLCBoYXNoQSwgaGFzaEIsIGJ1eSwgc3RhdGUpID0gc3Rvci5nZXRSZXF1ZXN0KF9pbmRleCk7CgogICAgICAgICAgc3RyaW5nIG1lbW9yeSB1c2VySWQgPSBieXRlczMyVG9TdHJpbmcodXNlcklkQnl0ZXMpOwogICAgICAgICAgc3RyaW5nIG1lbW9yeSBoYXNoID0gYnl0ZXM2NFRvU3RyaW5nKGhhc2hBLCBoYXNoQik7CgogICAgICAgICAgcmV0dXJuIChzZW5kZXIsIHVzZXJJZCwgaGFzaCwgYnV5LCBzdGF0ZSk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBjYW5jZWxSZXF1ZXN0KHVpbnQgX2luZGV4KSBvbmx5Q3JlYXRvciBwdWJsaWMgewogICAgICAgICAgUmVxdWVzdENhbmNlbGxlZChfaW5kZXgpOwogICAgICAgICAgc3Rvci5jYW5jZWxSZXF1ZXN0KF9pbmRleCk7CiAgICAgfQogICAgIAogICAgIGZ1bmN0aW9uIHByb2Nlc3NSZXF1ZXN0KHVpbnQgX2luZGV4LCB1aW50IF9hbW91bnRDZW50cywgdWludCBfY2VudHNQZXJHb2xkKSBvbmx5Q3JlYXRvciBwdWJsaWMgewogICAgICAgICAgcmVxdWlyZShfaW5kZXggPCBnZXRSZXF1ZXN0c0NvdW50KCkpOwoKICAgICAgICAgIHZhciAoc2VuZGVyLCB1c2VySWQsIGhhc2gsIGlzQnV5LCBzdGF0ZSkgPSBnZXRSZXF1ZXN0KF9pbmRleCk7CiAgICAgICAgICByZXF1aXJlKDAgPT0gc3RhdGUpOwoKICAgICAgICAgIGlmIChpc0J1eSkgewogICAgICAgICAgICAgICBwcm9jZXNzQnV5UmVxdWVzdCh1c2VySWQsIHNlbmRlciwgX2Ftb3VudENlbnRzLCBfY2VudHNQZXJHb2xkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIHByb2Nlc3NTZWxsUmVxdWVzdCh1c2VySWQsIHNlbmRlciwgX2Ftb3VudENlbnRzLCBfY2VudHNQZXJHb2xkKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyAzIC0gdXBkYXRlIHN0YXRlCiAgICAgICAgICBzdG9yLnNldFJlcXVlc3RQcm9jZXNzZWQoX2luZGV4KTsKCiAgICAgICAgICAvLyA0IC0gc2VuZCBldmVudAogICAgICAgICAgUmVxdWVzdFByb2Nlc3NlZChfaW5kZXgpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gcHJvY2Vzc0J1eVJlcXVlc3Qoc3RyaW5nIF91c2VySWQsIGFkZHJlc3MgX3VzZXJBZGRyZXNzLCB1aW50IF9hbW91bnRDZW50cywgdWludCBfY2VudHNQZXJHb2xkKSBpbnRlcm5hbCB7CiAgICAgICAgICB1aW50IHVzZXJGaWF0QmFsYW5jZSA9IGdldFVzZXJGaWF0QmFsYW5jZShfdXNlcklkKTsKICAgICAgICAgIHJlcXVpcmUodXNlckZpYXRCYWxhbmNlID4gMCk7CgogICAgICAgICAgaWYgKF9hbW91bnRDZW50cyA+IHVzZXJGaWF0QmFsYW5jZSkgewogICAgICAgICAgICAgICBfYW1vdW50Q2VudHMgPSB1c2VyRmlhdEJhbGFuY2U7CiAgICAgICAgICB9CgogICAgICAgICAgdWludCB1c2VyTW50cEJhbGFuY2UgPSBtbnRwVG9rZW4uYmFsYW5jZU9mKF91c2VyQWRkcmVzcyk7CiAgICAgICAgICB1aW50IGZlZSA9IGZpYXRGZWUuY2FsY3VsYXRlQnV5R29sZEZlZSh1c2VyTW50cEJhbGFuY2UsIF9hbW91bnRDZW50cyk7CiAgICAgICAgICByZXF1aXJlKF9hbW91bnRDZW50cyA+IGZlZSk7ICAKCiAgICAgICAgICAvLyAxIC0gaXNzdWUgdG9rZW5zIG1pbnVzIGZlZQogICAgICAgICAgdWludCBhbW91bnRNaW51c0ZlZSA9IF9hbW91bnRDZW50czsKICAgICAgICAgIGlmIChmZWUgPiAwKSB7IAogICAgICAgICAgICAgICBhbW91bnRNaW51c0ZlZSA9IHNhZmVTdWIoX2Ftb3VudENlbnRzLCBmZWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJlcXVpcmUoYW1vdW50TWludXNGZWUgPiAwKTsKCiAgICAgICAgICB1aW50IHRva2VucyA9ICh1aW50KGFtb3VudE1pbnVzRmVlKSAqIDEgZXRoZXIpIC8gX2NlbnRzUGVyR29sZDsKICAgICAgICAgIGlzc3VlR29sZFRva2VucyhfdXNlckFkZHJlc3MsIHRva2Vucyk7CiAgICAgICAgCiAgICAgICAgICAvLyByZXF1ZXN0IGZyb20gaG90IHdhbGxldAogICAgICAgICAgaWYgKGlzSG90V2FsbGV0KF91c2VyQWRkcmVzcykpIHsKICAgICAgICAgICAgYWRkR29sZFRyYW5zYWN0aW9uKF91c2VySWQsIGludCh0b2tlbnMpKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyAyIC0gYWRkIGZpYXQgdHgKICAgICAgICAgIC8vIG5lZ2F0aXZlIGZvciBidXkgKHRvdGFsIGFtb3VudCBpbmNsdWRpbmcgZmVlISkKICAgICAgICAgIGFkZEZpYXRUcmFuc2FjdGlvbihfdXNlcklkLCAtIGludChfYW1vdW50Q2VudHMpKTsKCiAgICAgICAgICAvLyAzIC0gc2VuZCBmZWUgdG8gR29sZG1pbnQKICAgICAgICAgIC8vIHBvc2l0aXZlIGZvciBzZWxsIAogICAgICAgICAgaWYgKGZlZSA+IDApIHsKICAgICAgICAgICAgICAgc3RyaW5nIG1lbW9yeSBnbUFjY291bnQgPSBieXRlczMyVG9TdHJpbmcoZmlhdEZlZS5nZXRHb2xkbWludEZlZUFjY291bnQoKSk7CiAgICAgICAgICAgICAgIGFkZEZpYXRUcmFuc2FjdGlvbihnbUFjY291bnQsIGludChmZWUpKTsKICAgICAgICAgIH0KICAgICB9CgogICAgIGZ1bmN0aW9uIHByb2Nlc3NTZWxsUmVxdWVzdChzdHJpbmcgX3VzZXJJZCwgYWRkcmVzcyBfdXNlckFkZHJlc3MsIHVpbnQgX2Ftb3VudENlbnRzLCB1aW50IF9jZW50c1BlckdvbGQpIGludGVybmFsIHsKICAgICAgICAgIHVpbnQgdG9rZW5zID0gKHVpbnQoX2Ftb3VudENlbnRzKSAqIDEgZXRoZXIpIC8gX2NlbnRzUGVyR29sZDsKICAgICAgICAgIHVpbnQgdG9rZW5CYWxhbmNlID0gZ29sZFRva2VuLmJhbGFuY2VPZihfdXNlckFkZHJlc3MpOwoKICAgICAgICAgIGlmIChpc0hvdFdhbGxldChfdXNlckFkZHJlc3MpKSB7CiAgICAgICAgICAgICAgdG9rZW5CYWxhbmNlID0gZ2V0VXNlckhvdEdvbGRCYWxhbmNlKF91c2VySWQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0b2tlbkJhbGFuY2UgPCB0b2tlbnMpIHsKICAgICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5CYWxhbmNlOwogICAgICAgICAgICAgICBfYW1vdW50Q2VudHMgPSB1aW50KCh0b2tlbnMgKiBfY2VudHNQZXJHb2xkKSAvIDEgZXRoZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIGJ1cm5Hb2xkVG9rZW5zKF91c2VyQWRkcmVzcywgdG9rZW5zKTsKCiAgICAgICAgICAvLyByZXF1ZXN0IGZyb20gaG90IHdhbGxldAogICAgICAgICAgaWYgKGlzSG90V2FsbGV0KF91c2VyQWRkcmVzcykpIHsKICAgICAgICAgICAgYWRkR29sZFRyYW5zYWN0aW9uKF91c2VySWQsIC0gaW50KHRva2VucykpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIDIgLSBhZGQgZmlhdCB0eAogICAgICAgICAgdWludCB1c2VyTW50cEJhbGFuY2UgPSBtbnRwVG9rZW4uYmFsYW5jZU9mKF91c2VyQWRkcmVzcyk7CiAgICAgICAgICB1aW50IGZlZSA9IGZpYXRGZWUuY2FsY3VsYXRlU2VsbEdvbGRGZWUodXNlck1udHBCYWxhbmNlLCBfYW1vdW50Q2VudHMpOwogICAgICAgICAgcmVxdWlyZShfYW1vdW50Q2VudHMgPiBmZWUpOyAgCgogICAgICAgICAgdWludCBhbW91bnRNaW51c0ZlZSA9IF9hbW91bnRDZW50czsKCiAgICAgICAgICBpZiAoZmVlID4gMCkgeyAKICAgICAgICAgICAgICAgYW1vdW50TWludXNGZWUgPSBzYWZlU3ViKF9hbW91bnRDZW50cywgZmVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXF1aXJlKGFtb3VudE1pbnVzRmVlID4gMCk7CiAgICAgICAgICAvLyBwb3NpdGl2ZSBmb3Igc2VsbCAKICAgICAgICAgIGFkZEZpYXRUcmFuc2FjdGlvbihfdXNlcklkLCBpbnQoYW1vdW50TWludXNGZWUpKTsKCiAgICAgICAgICAvLyAzIC0gc2VuZCBmZWUgdG8gR29sZG1pbnQKICAgICAgICAgIGlmIChmZWUgPiAwKSB7CiAgICAgICAgICAgICAgIHN0cmluZyBtZW1vcnkgZ21BY2NvdW50ID0gYnl0ZXMzMlRvU3RyaW5nKGZpYXRGZWUuZ2V0R29sZG1pbnRGZWVBY2NvdW50KCkpOwogICAgICAgICAgICAgICBhZGRGaWF0VHJhbnNhY3Rpb24oZ21BY2NvdW50LCBpbnQoZmVlKSk7CiAgICAgICAgICB9CiAgICAgfQogICAgIAovLy8vLy8vLyBJTlRFUk5BTCBSRVFVRVNUUyBGUk9NIEhPVCBXQUxMRVQKCiAgICBmdW5jdGlvbiBwcm9jZXNzSW50ZXJuYWxSZXF1ZXN0KHN0cmluZyBfdXNlcklkLCBib29sIF9pc0J1eSwgdWludCBfYW1vdW50Q2VudHMsIHVpbnQgX2NlbnRzUGVyR29sZCkgb25seUNyZWF0b3IgcHVibGljIHsKICAgICAgICBpZiAoX2lzQnV5KSB7CiAgICAgICAgICAgIHByb2Nlc3NCdXlSZXF1ZXN0KF91c2VySWQsIGdldEhvdFdhbGxldEFkZHJlc3MoKSwgX2Ftb3VudENlbnRzLCBfY2VudHNQZXJHb2xkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm9jZXNzU2VsbFJlcXVlc3QoX3VzZXJJZCwgZ2V0SG90V2FsbGV0QWRkcmVzcygpLCBfYW1vdW50Q2VudHMsIF9jZW50c1BlckdvbGQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckdvbGRGcm9tSG90V2FsbGV0KGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgc3RyaW5nIF91c2VySWQpIG9ubHlDcmVhdG9yIHB1YmxpYyB7CiAgICAgICAgCiAgICAgICAgdWludCBiYWxhbmNlID0gZ2V0VXNlckhvdEdvbGRCYWxhbmNlKF91c2VySWQpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZSA+PSBfdmFsdWUpOwoKICAgICAgICBnb2xkVG9rZW4uYnVyblRva2VucyhnZXRIb3RXYWxsZXRBZGRyZXNzKCksIF92YWx1ZSk7CiAgICAgICAgZ29sZFRva2VuLmlzc3VlVG9rZW5zKF90bywgX3ZhbHVlKTsKCiAgICAgICAgYWRkR29sZFRyYW5zYWN0aW9uKF91c2VySWQsIC1pbnQoX3ZhbHVlKSk7CiAgICB9CgovLy8vLy8vLwogICAgIGZ1bmN0aW9uIGlzc3VlR29sZFRva2VucyhhZGRyZXNzIF91c2VyQWRkcmVzcywgdWludCBfdG9rZW5BbW91bnQpIGludGVybmFsIHsKICAgICAgICAgIHJlcXVpcmUoMCE9X3Rva2VuQW1vdW50KTsKICAgICAgICAgIGdvbGRUb2tlbi5pc3N1ZVRva2VucyhfdXNlckFkZHJlc3MsIF90b2tlbkFtb3VudCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBidXJuR29sZFRva2VucyhhZGRyZXNzIF91c2VyQWRkcmVzcywgdWludCBfdG9rZW5BbW91bnQpIGludGVybmFsIHsKICAgICAgICAgIHJlcXVpcmUoMCE9X3Rva2VuQW1vdW50KTsKICAgICAgICAgIGdvbGRUb2tlbi5idXJuVG9rZW5zKF91c2VyQWRkcmVzcywgX3Rva2VuQW1vdW50KTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGlzSG90V2FsbGV0KGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgICByZXR1cm4gX2FkZHJlc3MgPT0gZ2V0SG90V2FsbGV0QWRkcmVzcygpOwogICAgIH0KfQ=='.
	

]
