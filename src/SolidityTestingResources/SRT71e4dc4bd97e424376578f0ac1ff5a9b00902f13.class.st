Class {
	#name : #SRT71e4dc4bd97e424376578f0ac1ff5a9b00902f13,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT71e4dc4bd97e424376578f0ac1ff5a9b00902f13 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMApjb250cmFjdCBFUkMyMCB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG90YWxTdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgY29uc3RhbnQgcmV0dXJucyh1aW50IGRpZ2l0cyk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgoKCi8vLyBAdGl0bGUgS3liZXIgUmVzZXJ2ZSBjb250cmFjdAovLy8gQGF1dGhvciBZYXJvbiBWZWxuZXIKCmNvbnRyYWN0IEt5YmVyUmVzZXJ2ZSB7CiAgICBhZGRyZXNzIHB1YmxpYyByZXNlcnZlT3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBreWJlck5ldHdvcms7CiAgICBFUkMyMCBjb25zdGFudCBwdWJsaWMgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIGJvb2wgcHVibGljIHRyYWRlRW5hYmxlZDsKCiAgICBzdHJ1Y3QgQ29udmVyc2lvblJhdGUgewogICAgICAgIHVpbnQgcmF0ZTsKICAgICAgICB1aW50IGV4cGlyYXRpb25CbG9jazsKICAgIH0KCiAgICBtYXBwaW5nKGJ5dGVzMzI9PkNvbnZlcnNpb25SYXRlKSBwYWlyQ29udmVyc2lvblJhdGU7CgogICAgLy8vIEBkZXYgYyd0b3IuCiAgICAvLy8gQHBhcmFtIF9reWJlck5ldHdvcmsgVGhlIGFkZHJlc3Mgb2Yga3liZXIgbmV0d29yawogICAgLy8vIEBwYXJhbSBfcmVzZXJ2ZU93bmVyIEFkZHJlc3Mgb2YgdGhlIHJlc2VydmUgb3duZXIKICAgIGZ1bmN0aW9uIEt5YmVyUmVzZXJ2ZSggYWRkcmVzcyBfa3liZXJOZXR3b3JrLCBhZGRyZXNzIF9yZXNlcnZlT3duZXIgKSB7CiAgICAgICAga3liZXJOZXR3b3JrID0gX2t5YmVyTmV0d29yazsKICAgICAgICByZXNlcnZlT3duZXIgPSBfcmVzZXJ2ZU93bmVyOwogICAgICAgIHRyYWRlRW5hYmxlZCA9IHRydWU7CiAgICB9CgoKICAgIC8vLyBAZGV2IGNoZWNrIGlmIGEgcGFpciBpcyBsaXN0ZWQgZm9yIHRyYWRpbmcuCiAgICAvLy8gQHBhcmFtIHNvdXJjZSBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdCBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBibG9ja051bWJlciBDdXJyZW50IGJsb2NrIG51bWJlcgogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZmYgcGFpciBpcyBsaXN0ZWQKICAgIGZ1bmN0aW9uIGlzUGFpckxpc3RlZCggRVJDMjAgc291cmNlLCBFUkMyMCBkZXN0LCB1aW50IGJsb2NrTnVtYmVyICkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgQ29udmVyc2lvblJhdGUgbWVtb3J5IHJhdGVJbmZvID0gcGFpckNvbnZlcnNpb25SYXRlW3NoYTMoc291cmNlLGRlc3QpXTsKICAgICAgICBpZiggcmF0ZUluZm8ucmF0ZSA9PSAwICkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiByYXRlSW5mby5leHBpcmF0aW9uQmxvY2sgPj0gYmxvY2tOdW1iZXI7CiAgICB9CgogICAgLy8vIEBkZXYgZ2V0IGN1cnJlbnQgY29udmVyc2lvbiByYXRlCiAgICAvLy8gQHBhcmFtIHNvdXJjZSBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdCBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBibG9ja051bWJlciBDdXJyZW50IGJsb2NrIG51bWJlcgogICAgLy8vIEByZXR1cm4gY29udmVyc2lvbiByYXRlIHdpdGggUFJFQ0lTSU9OIHByZWNpc2lvbgoKICAgIGZ1bmN0aW9uIGdldENvbnZlcnNpb25SYXRlKCBFUkMyMCBzb3VyY2UsIEVSQzIwIGRlc3QsIHVpbnQgYmxvY2tOdW1iZXIgKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBDb252ZXJzaW9uUmF0ZSBtZW1vcnkgcmF0ZUluZm8gPSBwYWlyQ29udmVyc2lvblJhdGVbc2hhMyhzb3VyY2UsZGVzdCldOwogICAgICAgIGlmKCByYXRlSW5mby5yYXRlID09IDAgKSByZXR1cm4gMDsKICAgICAgICBpZiggcmF0ZUluZm8uZXhwaXJhdGlvbkJsb2NrIDwgYmxvY2tOdW1iZXIgKSByZXR1cm4gMDsKICAgICAgICByZXR1cm4gcmF0ZUluZm8ucmF0ZSAqICgxMCAqKiBnZXREZWNpbWFscyhkZXN0KSkgLyAoMTAqKmdldERlY2ltYWxzKHNvdXJjZSkpOwogICAgfQoKICAgIGV2ZW50IEVycm9yUmVwb3J0KCBhZGRyZXNzIGluZGV4ZWQgb3JpZ2luLCB1aW50IGVycm9yLCB1aW50IGVycm9ySW5mbyApOwogICAgZXZlbnQgRG9UcmFkZSggYWRkcmVzcyBpbmRleGVkIG9yaWdpbiwgYWRkcmVzcyBzb3VyY2UsIHVpbnQgc291cmNlQW1vdW50LCBhZGRyZXNzIGRlc3RUb2tlbiwgdWludCBkZXN0QW1vdW50LCBhZGRyZXNzIGRlc3RBZGRyZXNzICk7CgogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoIEVSQzIwIHRva2VuICkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgIGlmKCB0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUyApIHJldHVybiAxODsKICAgICAgcmV0dXJuIHRva2VuLmRlY2ltYWxzKCk7CiAgICB9CgogICAgLy8vIEBkZXYgZG8gYSB0cmFkZQogICAgLy8vIEBwYXJhbSBzb3VyY2VUb2tlbiBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gc291cmNlQW1vdW50IEFtb3VudCBvZiBzb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdFRva2VuIERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIERlc3RpbmF0aW9uIGFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gdmFsaWRhdGUgSWYgdHJ1ZSwgYWRkaXRpb25hbCB2YWxpZGF0aW9ucyBhcmUgYXBwbGljYWJsZQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZmYgdHJhZGUgaXMgc3VjY2VzZnVsCiAgICBmdW5jdGlvbiBkb1RyYWRlKCBFUkMyMCBzb3VyY2VUb2tlbiwKICAgICAgICAgICAgICAgICAgICAgIHVpbnQgc291cmNlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgRVJDMjAgZGVzdFRva2VuLAogICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgIGJvb2wgdmFsaWRhdGUgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgLy8gY2FuIHNraXAgdmFsaWRhdGlvbiBpZiBkb25lIGF0IGt5YmVyIG5ldHdvcmsgbGV2ZWwKICAgICAgICBpZiggdmFsaWRhdGUgKSB7CiAgICAgICAgICAgIGlmKCAhIGlzUGFpckxpc3RlZCggc291cmNlVG9rZW4sIGRlc3RUb2tlbiwgYmxvY2subnVtYmVyICkgKSB7CiAgICAgICAgICAgICAgICAvLyBwYWlyIGlzIG5vdCBsaXN0ZWQKICAgICAgICAgICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDB4ODAwMDAwMDAxLCAwICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCBzb3VyY2VUb2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUyApIHsKICAgICAgICAgICAgICAgIGlmKCBtc2cudmFsdWUgIT0gc291cmNlQW1vdW50ICkgewogICAgICAgICAgICAgICAgICAgIC8vIG1zZy52YWx1ZSAhPSBzb3VyY2VBbW1vdW50CiAgICAgICAgICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MDAwMDAwMDIsIG1zZy52YWx1ZSApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmKCBtc2cudmFsdWUgPiAwICkgewogICAgICAgICAgICAgICAgLy8gbXNnLnZhbHVlIG11c3QgYmUgMAogICAgICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MDAwMDAwMDMsIG1zZy52YWx1ZSApOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYoIHNvdXJjZVRva2VuLmFsbG93YW5jZShtc2cuc2VuZGVyLCB0aGlzICkgPCBzb3VyY2VBbW91bnQgKSB7CiAgICAgICAgICAgICAgICAvLyBhbGxvd2FuY2UgaXMgbm90IGVub3VnaAogICAgICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MDAwMDAwMDQsIHNvdXJjZVRva2VuLmFsbG93YW5jZShtc2cuc2VuZGVyLCB0aGlzICkgKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdWludCBjb252ZXJzaW9uUmF0ZSA9IGdldENvbnZlcnNpb25SYXRlKCBzb3VyY2VUb2tlbiwgZGVzdFRva2VuLCBibG9jay5udW1iZXIgKTsKICAgICAgICAvLyBUT0RPIC0gc2FmZSBtdWx0aXBsaWNhdGlvbgogICAgICAgIHVpbnQgZGVzdEFtb3VudCA9IChjb252ZXJzaW9uUmF0ZSAqIHNvdXJjZUFtb3VudCkgLyBQUkVDSVNJT047CgogICAgICAgIC8vIHNhbml0eSBjaGVjawogICAgICAgIGlmKCBkZXN0QW1vdW50ID09IDAgKSB7CiAgICAgICAgICAgIC8vIHVuZXhwZWN0ZWQgZXJyb3I6IGRlc3QgYW1vdW50IGlzIDAKICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MDAwMDAwMDUsIDAgKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9yIHN1ZmZpY2llbnQgYmFsYW5jZQogICAgICAgIGlmKCBkZXN0VG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MgKSB7CiAgICAgICAgICAgIGlmKCB0aGlzLmJhbGFuY2UgPCBkZXN0QW1vdW50ICkgewogICAgICAgICAgICAgICAgLy8gaW5zdWZmaWNpZW50IGV0aGVyIGJhbGFuY2UKICAgICAgICAgICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDB4ODAwMDAwMDA2LCBkZXN0QW1vdW50ICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCBkZXN0VG9rZW4uYmFsYW5jZU9mKHRoaXMpIDwgZGVzdEFtb3VudCApIHsKICAgICAgICAgICAgICAgIC8vIGluc3VmZmljaWVudCB0b2tlbiBiYWxhbmNlCiAgICAgICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgwMDAwMDAwNywgdWludChkZXN0VG9rZW4pICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNvbGxlY3Qgc291cmNlIHRva2VucwogICAgICAgIGlmKCBzb3VyY2VUb2tlbiAhPSBFVEhfVE9LRU5fQUREUkVTUyApIHsKICAgICAgICAgICAgaWYoICEgc291cmNlVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsdGhpcyxzb3VyY2VBbW91bnQpICkgewogICAgICAgICAgICAgICAgLy8gdHJhbnNmZXIgZnJvbSBzb3VyY2UgdG9rZW4gZmFpbGVkCiAgICAgICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgwMDAwMDAwOCwgdWludChzb3VyY2VUb2tlbikgKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2VuZCBkZXN0IHRva2VucwogICAgICAgIGlmKCBkZXN0VG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MgKSB7CiAgICAgICAgICAgIGlmKCAhIGRlc3RBZGRyZXNzLnNlbmQoZGVzdEFtb3VudCkgKSB7CiAgICAgICAgICAgICAgICAvLyB0cmFuc2ZlciBldGhlciB0byBkZXN0IGZhaWxlZAogICAgICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MDAwMDAwMDksIHVpbnQoZGVzdEFkZHJlc3MpICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCAhIGRlc3RUb2tlbi50cmFuc2ZlcihkZXN0QWRkcmVzcywgZGVzdEFtb3VudCkgKSB7CiAgICAgICAgICAgICAgICAvLyB0cmFuc2ZlciB0b2tlbiB0byBkZXN0IGZhaWxlZAogICAgICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MDAwMDAwMGEsIHVpbnQoZGVzdEFkZHJlc3MpICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIERvVHJhZGUoIHR4Lm9yaWdpbiwgc291cmNlVG9rZW4sIHNvdXJjZUFtb3VudCwgZGVzdFRva2VuLCBkZXN0QW1vdW50LCBkZXN0QWRkcmVzcyApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiB0cmFkZQogICAgLy8vIEBwYXJhbSBzb3VyY2VUb2tlbiBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gc291cmNlQW1vdW50IEFtb3VudCBvZiBzb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdFRva2VuIERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIERlc3RpbmF0aW9uIGFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gdmFsaWRhdGUgSWYgdHJ1ZSwgYWRkaXRpb25hbCB2YWxpZGF0aW9ucyBhcmUgYXBwbGljYWJsZQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZmYgdHJhZGUgaXMgc3VjY2VzZnVsCiAgICBmdW5jdGlvbiB0cmFkZSggRVJDMjAgc291cmNlVG9rZW4sCiAgICAgICAgICAgICAgICAgICAgdWludCBzb3VyY2VBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgRVJDMjAgZGVzdFRva2VuLAogICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgYm9vbCB2YWxpZGF0ZSApIHBheWFibGUgcmV0dXJucyhib29sKSB7CgogICAgICAgIGlmKCAhIHRyYWRlRW5hYmxlZCApIHsKICAgICAgICAgICAgLy8gdHJhZGUgaXMgbm90IGVuYWJsZWQKICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4MTAwMDAwMDAsIDAgKTsKICAgICAgICAgICAgaWYoIG1zZy52YWx1ZSA+IDAgKSB7CiAgICAgICAgICAgICAgICBpZiggISBtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSApIHRocm93OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmKCBtc2cuc2VuZGVyICE9IGt5YmVyTmV0d29yayApIHsKICAgICAgICAgICAgLy8gc2VuZGVyIG11c3QgYmUga3liZXIgbmV0d29yawogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgxMDAwMDAwMSwgdWludChtc2cuc2VuZGVyKSApOwogICAgICAgICAgICBpZiggbXNnLnZhbHVlID4gMCApIHsKICAgICAgICAgICAgICAgIGlmKCAhIG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpICkgdGhyb3c7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmKCAhIGRvVHJhZGUoIHNvdXJjZVRva2VuLCBzb3VyY2VBbW91bnQsIGRlc3RUb2tlbiwgZGVzdEFkZHJlc3MsIHZhbGlkYXRlICkgKSB7CiAgICAgICAgICAgIC8vIGRvIHRyYWRlIGZhaWxlZAogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgxMDAwMDAwMiwgMCApOwogICAgICAgICAgICBpZiggbXNnLnZhbHVlID4gMCApIHsKICAgICAgICAgICAgICAgIGlmKCAhIG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpICkgdGhyb3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMCwgMCApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGV2ZW50IFNldFJhdGUoIEVSQzIwIHNvdXJjZSwgRVJDMjAgZGVzdCwgdWludCByYXRlLCB1aW50IGV4cGlyeUJsb2NrICk7CgogICAgLy8vIEBub3RpY2UgY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IG93bmVyCiAgICAvLy8gQGRldiBzZXQgcmF0ZSBvZiBwYWlyIG9mIHRva2VucwogICAgLy8vIEBwYXJhbSBzb3VyY2VzIGFuIGFycmF5IGNvbnRhaW4gc291cmNlIHRva2VucwogICAgLy8vIEBwYXJhbSBkZXN0cyBhbiBhcnJheSBjb250YWluIGRlc3QgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGNvbnZlcnNpb25SYXRlcyBhbiBhcnJheSB3aXRoIHJhdGVzCiAgICAvLy8gQHBhcmFtIGV4cGlyeUJsb2NrcyBhcnJheSBvZiBleHBpcmF0aW9uIGJsb2NrcwogICAgLy8vIEBwYXJhbSB2YWxpZGF0ZSBJZiB0cnVlLCBhZGRpdGlvbmFsIHZhbGlkYXRpb25zIGFyZSBhcHBsaWNhYmxlCiAgICAvLy8gQHJldHVybiB0cnVlIGlmZiB0cmFkZSBpcyBzdWNjZXNmdWwKICAgIGZ1bmN0aW9uIHNldFJhdGUoIEVSQzIwW10gc291cmNlcywgRVJDMjBbXSBkZXN0cywgdWludFtdIGNvbnZlcnNpb25SYXRlcywgdWludFtdIGV4cGlyeUJsb2NrcywgYm9vbCB2YWxpZGF0ZSApIHJldHVybnMoYm9vbCkgewogICAgICAgIGlmKCBtc2cuc2VuZGVyICE9IHJlc2VydmVPd25lciApIHsKICAgICAgICAgICAgLy8gc2VuZGVyIG11c3QgYmUgcmVzZXJ2ZSBvd25lcgogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgyMDAwMDAwMCwgdWludChtc2cuc2VuZGVyKSApOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiggdmFsaWRhdGUgKSB7CiAgICAgICAgICAgIGlmKCAoIHNvdXJjZXMubGVuZ3RoICE9IGRlc3RzLmxlbmd0aCApIHx8CiAgICAgICAgICAgICAgICAoIHNvdXJjZXMubGVuZ3RoICE9IGNvbnZlcnNpb25SYXRlcy5sZW5ndGggKSB8fAogICAgICAgICAgICAgICAgKCBzb3VyY2VzLmxlbmd0aCAhPSBleHBpcnlCbG9ja3MubGVuZ3RoICkgKSB7CiAgICAgICAgICAgICAgICAvLyBhcnJheXMgbGVuZ3RoIGFyZSBub3QgaWRlbnRpY2FsCiAgICAgICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgyMDAwMDAwMSwgMCApOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IoIHVpbnQgaSA9IDAgOyBpIDwgc291cmNlcy5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgICAgIFNldFJhdGUoIHNvdXJjZXNbaV0sIGRlc3RzW2ldLCBjb252ZXJzaW9uUmF0ZXNbaV0sIGV4cGlyeUJsb2Nrc1tpXSApOwogICAgICAgICAgICBwYWlyQ29udmVyc2lvblJhdGVbc2hhMyhzb3VyY2VzW2ldLGRlc3RzW2ldKV0gPSBDb252ZXJzaW9uUmF0ZSggY29udmVyc2lvblJhdGVzW2ldLCBleHBpcnlCbG9ja3NbaV0gKTsKICAgICAgICB9CgogICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDAsIDAgKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBldmVudCBFbmFibGVUcmFkZSggYm9vbCBlbmFibGUgKTsKCiAgICAvLy8gQG5vdGljZSBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgb3duZXIKICAgIC8vLyBAZGV2IGVuYWJsZSBvZiBkaXNhYmxlIHRyYWRlCiAgICAvLy8gQHBhcmFtIGVuYWJsZSBpZiB0cnVlIHRyYWRlIGlzIGVuYWJsZWQsIG90aGVyd2lzZSBkaXNhYmxlZAogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZmYgdHJhZGUgaXMgc3VjY2VzZnVsCiAgICBmdW5jdGlvbiBlbmFibGVUcmFkZSggYm9vbCBlbmFibGUgKSByZXR1cm5zKGJvb2wpewogICAgICAgIGlmKCBtc2cuc2VuZGVyICE9IHJlc2VydmVPd25lciApIHsKICAgICAgICAgICAgLy8gc2VuZGVyIG11c3QgYmUgcmVzZXJ2ZSBvd25lcgogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDgzMDAwMDAwMCwgdWludChtc2cuc2VuZGVyKSApOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB0cmFkZUVuYWJsZWQgPSBlbmFibGU7CiAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMCwgMCApOwogICAgICAgIEVuYWJsZVRyYWRlKCBlbmFibGUgKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZXZlbnQgRGVwb3NpdFRva2VuKCBFUkMyMCB0b2tlbiwgdWludCBhbW91bnQgKTsKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgRGVwb3NpdFRva2VuKCBFVEhfVE9LRU5fQUREUkVTUywgbXNnLnZhbHVlICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgZXRoZXIgY291bGQgYWxzbyBiZSBkZXBvc2l0ZWQgd2l0aG91dCBjYWxsaW5nIHRoaXMgZnVuY3Rpb24KICAgIC8vLyBAZGV2IGFuIGF1eGlsYXJ5IGZ1bmN0aW9uIHRoYXQgYWxsb3dzIGV0aGVyIGRlcG9zaXRzCiAgICAvLy8gQHJldHVybiB0cnVlIGlmZiBkZXBvc2l0IGlzIHN1Y2Nlc2Z1bAogICAgZnVuY3Rpb24gZGVwb3NpdEV0aGVyKCApIHBheWFibGUgcmV0dXJucyhib29sKSB7CiAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMCwgMCApOwoKICAgICAgICBEZXBvc2l0VG9rZW4oIEVUSF9UT0tFTl9BRERSRVNTLCBtc2cudmFsdWUgKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB0b2tlbnMgY291bGQgYWxzbyBiZSBkZXBvc2l0ZWQgd2l0aG91dCBjYWxsaW5nIHRoaXMgZnVuY3Rpb24KICAgIC8vLyBAZGV2IGFuIGF1eGlsYXJ5IGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRva2VuIGRlcG9zaXRzCiAgICAvLy8gQHBhcmFtIHRva2VuIFRva2VuIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZmYgZGVwb3NpdCBpcyBzdWNjZXNmdWwKICAgIGZ1bmN0aW9uIGRlcG9zaXRUb2tlbiggRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50ICkgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYoIHRva2VuLmFsbG93YW5jZSggbXNnLnNlbmRlciwgdGhpcyApIDwgYW1vdW50ICkgewogICAgICAgICAgICAvLyBhbGxvd2VuY2UgaXMgc21hbGxlciB0aGVuIGFtb3VudAogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDg1MDAwMDAwMSwgdG9rZW4uYWxsb3dhbmNlKCBtc2cuc2VuZGVyLCB0aGlzICkgKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYoICEgdG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIGFtb3VudCApICkgewogICAgICAgICAgICAvLyB0cmFuc2ZlciBmcm9tIGZhaWxlZAogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDg1MDAwMDAwMiwgdWludCh0b2tlbikgKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRGVwb3NpdFRva2VuKCB0b2tlbiwgYW1vdW50ICk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIGV2ZW50IFdpdGhkcmF3KCBFUkMyMCB0b2tlbiwgdWludCBhbW91bnQsIGFkZHJlc3MgZGVzdGluYXRpb24gKTsKCiAgICAvLy8gQG5vdGljZSBjYW4gb25seSBiZSBjYWxsZWQgYnkgb3duZXIuCiAgICAvLy8gQGRldiB3aXRoZGF3IHRva2VucyBvciBldGhlciBmcm9tIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIHRva2VuIFRva2VuIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgdG8gZGVwb3NpdAogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBhZGRyZXNzIHRoYXQgZ2V0IHdpdGhkcmV3ZWQgZnVuZHMKICAgIC8vLyBAcmV0dXJuIHRydWUgaWZmIHdpdGhkcmF3YWwgaXMgc3VjY2VzZnVsCiAgICBmdW5jdGlvbiB3aXRoZHJhdyggRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIGRlc3RpbmF0aW9uICkgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYoIG1zZy5zZW5kZXIgIT0gcmVzZXJ2ZU93bmVyICkgewogICAgICAgICAgICAvLyBzZW5kZXIgbXVzdCBiZSByZXNlcnZlIG93bmVyCiAgICAgICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDB4ODYwMDAwMDAwLCB1aW50KG1zZy5zZW5kZXIpICk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmKCB0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUyApIHsKICAgICAgICAgICAgaWYoICEgZGVzdGluYXRpb24uc2VuZChhbW91bnQpICkgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoICEgdG9rZW4udHJhbnNmZXIoZGVzdGluYXRpb24sYW1vdW50KSApIHsKICAgICAgICAgICAgLy8gdHJhbnNmZXIgdG8gcmVzZXJ2ZSBvd25lciBmYWlsZWQKICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4NjAwMDAwMDEsIHVpbnQodG9rZW4pICk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDAsIDAgKTsKICAgICAgICBXaXRoZHJhdyggdG9rZW4sIGFtb3VudCwgZGVzdGluYXRpb24gKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lciggYWRkcmVzcyBuZXdPd25lciApIHsKICAgICAgaWYoIG1zZy5zZW5kZXIgIT0gcmVzZXJ2ZU93bmVyICkgdGhyb3c7CiAgICAgIHJlc2VydmVPd25lciA9IG5ld093bmVyOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBzdGF0dXMgZnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IGluZm9ybWF0aW9uIG9uIGNvbnZlcnNpb24gcmF0ZSBmcm9tIHNvdXJjZSB0byBkZXN0CiAgICAvLy8gQHBhcmFtIHNvdXJjZSBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0b2luIHRva2VuCiAgICAvLy8gQHJldHVybiAoY29udmVyc2lvbiByYXRlLGV4cGVyYXRpb24gYmxvY2ssZGVzdCB0b2tlbiBiYWxhbmNlIG9mIHJlc2VydmUpCiAgICBmdW5jdGlvbiBnZXRQYWlySW5mbyggRVJDMjAgc291cmNlLCBFUkMyMCBkZXN0ICkgY29uc3RhbnQgcmV0dXJucyh1aW50IHJhdGUsIHVpbnQgZXhwQmxvY2ssIHVpbnQgYmFsYW5jZSkgewogICAgICAgIENvbnZlcnNpb25SYXRlIG1lbW9yeSByYXRlSW5mbyA9IHBhaXJDb252ZXJzaW9uUmF0ZVtzaGEzKHNvdXJjZSxkZXN0KV07CiAgICAgICAgYmFsYW5jZSA9IDA7CiAgICAgICAgaWYoIGRlc3QgPT0gRVRIX1RPS0VOX0FERFJFU1MgKSBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgIGVsc2UgYmFsYW5jZSA9IGRlc3QuYmFsYW5jZU9mKHRoaXMpOwoKICAgICAgICBleHBCbG9jayA9IHJhdGVJbmZvLmV4cGlyYXRpb25CbG9jazsKICAgICAgICByYXRlID0gcmF0ZUluZm8ucmF0ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBhIGRlYnVnIGZ1bmN0aW9uCiAgICAvLy8gQGRldiBnZXQgdGhlIGJhbGFuY2Ugb2YgdGhlIHJlc2VydmUKICAgIC8vLyBAcGFyYW0gdG9rZW4gVGhlIHRva2VuIHR5cGUKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKCBFUkMyMCB0b2tlbiApIGNvbnN0YW50IHJldHVybnModWludCl7CiAgICAgICAgaWYoIHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTICkgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgICAgICBlbHNlIHJldHVybiB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB9Cn0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEB0aXRsZSBLeWJlciBOZXR3b3JrIG1haW4gY29udHJhY3QKLy8vIEBhdXRob3IgWWFyb24gVmVsbmVyCgpjb250cmFjdCBLeWJlck5ldHdvcmsgewogICAgYWRkcmVzcyBhZG1pbjsKICAgIEVSQzIwIGNvbnN0YW50IHB1YmxpYyBFVEhfVE9LRU5fQUREUkVTUyA9IEVSQzIwKDB4MDBlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlKTsKICAgIHVpbnQgIGNvbnN0YW50IFBSRUNJU0lPTiA9ICgxMCoqMTgpOwogICAgdWludCAgY29uc3RhbnQgRVBTSUxPTiA9ICgxMCk7CiAgICBLeWJlclJlc2VydmVbXSBwdWJsaWMgcmVzZXJ2ZXM7CgogICAgbWFwcGluZyhhZGRyZXNzPT5tYXBwaW5nKGJ5dGVzMzI9PmJvb2wpKSBwZXJSZXNlcnZlTGlzdGVkUGFpcnM7CgogICAgZXZlbnQgRXJyb3JSZXBvcnQoIGFkZHJlc3MgaW5kZXhlZCBvcmlnaW4sIHVpbnQgZXJyb3IsIHVpbnQgZXJyb3JJbmZvICk7CgogICAgLy8vIEBkZXYgYyd0b3IuCiAgICAvLy8gQHBhcmFtIF9hZG1pbiBUaGUgYWRkcmVzcyBvZiB0aGUgYWRtaW5pc3RyYXRvcgogICAgZnVuY3Rpb24gS3liZXJOZXR3b3JrKCBhZGRyZXNzIF9hZG1pbiApIHsKICAgICAgICBhZG1pbiA9IF9hZG1pbjsKICAgIH0KCgogICAgc3RydWN0IEt5YmVyUmVzZXJ2ZVBhaXJJbmZvIHsKICAgICAgICB1aW50IHJhdGU7CiAgICAgICAgdWludCByZXNlcnZlQmFsYW5jZTsKICAgICAgICBLeWJlclJlc2VydmUgcmVzZXJ2ZTsKICAgIH0KCgogICAgLy8vIEBkZXYgcmV0dXJucyBudW1iZXIgb2YgcmVzZXJ2ZXMKICAgIC8vLyBAcmV0dXJuIG51bWJlciBvZiByZXNlcnZlcwogICAgZnVuY3Rpb24gZ2V0TnVtUmVzZXJ2ZXMoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpewogICAgICAgIHJldHVybiByZXNlcnZlcy5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBpbmZvcm1hdGlvbiBvbiBjb252ZXJzaW9uIHJhdGUgZnJvbSBzb3VyY2UgdG8gZGVzdCBpbiBzcGVjaWZpYyByZXNlcnZlIG1hbmFnZXIKICAgIC8vLyBAcGFyYW0gc291cmNlIFNvdXJjZSB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0ICAgRGVzdGluYXRvaW4gdG9rZW4KICAgIC8vLyBAcmV0dXJuIChjb252ZXJzaW9uIHJhdGUsZXhwZXJhdGlvbiBibG9jayxkZXN0IHRva2VuIGJhbGFuY2Ugb2YgcmVzZXJ2ZSkKICAgIGZ1bmN0aW9uIGdldFJhdGUoIEVSQzIwIHNvdXJjZSwgRVJDMjAgZGVzdCwgdWludCByZXNlcnZlSW5kZXggKSBjb25zdGFudCByZXR1cm5zKHVpbnQgcmF0ZSwgdWludCBleHBCbG9jaywgdWludCBiYWxhbmNlKXsKICAgICAgICAocmF0ZSxleHBCbG9jaywgYmFsYW5jZSkgPSByZXNlcnZlc1tyZXNlcnZlSW5kZXhdLmdldFBhaXJJbmZvKHNvdXJjZSxkZXN0KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IGluZm9ybWF0aW9uIG9uIGNvbnZlcnNpb24gcmF0ZSB0byBhIGZyb250IGVuZCBhcHBsaWNhdGlvbgogICAgLy8vIEBwYXJhbSBzb3VyY2UgU291cmNlIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3QgICBEZXN0aW5hdG9pbiB0b2tlbgogICAgLy8vIEByZXR1cm4gcmF0ZS4gSWYgbm90IGF2YWlsYWJsZSByZXR1cm5zIDAuCgogICAgZnVuY3Rpb24gZ2V0UHJpY2UoIEVSQzIwIHNvdXJjZSwgRVJDMjAgZGVzdCApIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICB1aW50IHJhdGU7IHVpbnQgZXhwQmxvY2s7IHVpbnQgYmFsYW5jZTsKICAgICAgKHJhdGUsIGV4cEJsb2NrLCBiYWxhbmNlKSA9IGdldFJhdGUoIHNvdXJjZSwgZGVzdCwgMCApOwogICAgICBpZiggZXhwQmxvY2sgPD0gYmxvY2subnVtYmVyICkgcmV0dXJuIDA7IC8vIFRPRE8gLSBjb25zaWRlciBhZGQgMQogICAgICBpZiggYmFsYW5jZSA9PSAwICkgcmV0dXJuIDA7IC8vIFRPRE8gLSBkZWNpZGUgb24gbWluaW1hbCBxdHkKICAgICAgcmV0dXJuIHJhdGU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoIEVSQzIwIHRva2VuICkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgIGlmKCB0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUyApIHJldHVybiAxODsKICAgICAgcmV0dXJuIHRva2VuLmRlY2ltYWxzKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBiZXN0IGNvbnZlcnNpb24gcmF0ZSBmb3IgYSBwYWlyIG9mIHRva2VucwogICAgLy8vIEBwYXJhbSBzb3VyY2UgU291cmNlIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3QgICBEZXN0aW5hdG9pbiB0b2tlbgogICAgLy8vIEByZXR1cm4gS3liZXJSZXNlcnZlUGFpckluZm8gc3RydWN0dXJlCiAgICBmdW5jdGlvbiBmaW5kQmVzdFJhdGUoIEVSQzIwIHNvdXJjZSwgRVJDMjAgZGVzdCApIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoS3liZXJSZXNlcnZlUGFpckluZm8pIHsKICAgICAgICB1aW50IGJlc3RSYXRlOwogICAgICAgIHVpbnQgYmVzdFJlc2VydmVCYWxhbmNlID0gMDsKICAgICAgICB1aW50IG51bVJlc2VydmVzID0gcmVzZXJ2ZXMubGVuZ3RoOwoKICAgICAgICBLeWJlclJlc2VydmVQYWlySW5mbyBtZW1vcnkgb3V0cHV0OwogICAgICAgIEt5YmVyUmVzZXJ2ZSBiZXN0UmVzZXJ2ZSA9IEt5YmVyUmVzZXJ2ZSgwKTsKCiAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IG51bVJlc2VydmVzIDsgaSsrICkgewogICAgICAgICAgICB2YXIgKHJhdGUsZXhwQmxvY2ssYmFsYW5jZSkgPSByZXNlcnZlc1tpXS5nZXRQYWlySW5mbyhzb3VyY2UsZGVzdCk7CgogICAgICAgICAgICBpZiggKGV4cEJsb2NrID49IGJsb2NrLm51bWJlcikgJiYgKGJhbGFuY2UgPiAwKSAmJiAocmF0ZSA+IGJlc3RSYXRlICkgKSB7CiAgICAgICAgICAgICAgICBiZXN0UmF0ZSA9IHJhdGU7CiAgICAgICAgICAgICAgICBiZXN0UmVzZXJ2ZUJhbGFuY2UgPSBiYWxhbmNlOwogICAgICAgICAgICAgICAgYmVzdFJlc2VydmUgPSByZXNlcnZlc1tpXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgb3V0cHV0LnJhdGUgPSBiZXN0UmF0ZTsKICAgICAgICBvdXRwdXQucmVzZXJ2ZUJhbGFuY2UgPSBiZXN0UmVzZXJ2ZUJhbGFuY2U7CiAgICAgICAgb3V0cHV0LnJlc2VydmUgPSBiZXN0UmVzZXJ2ZTsKCiAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBkbyBvbmUgdHJhZGUgd2l0aCBhIHJlc2VydmUKICAgIC8vLyBAcGFyYW0gc291cmNlIFNvdXJjZSB0b2tlbgogICAgLy8vIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHNvdXJjZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0b2luIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gcmVzZXJ2ZSBSZXNlcnZlIHRvIHVzZQogICAgLy8vIEBwYXJhbSB2YWxpZGF0ZSBJZiB0cnVlLCBhZGRpdGlvbmFsIHZhbGlkYXRpb25zIGFyZSBhcHBsaWNhYmxlCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHRyYWRlIGlzIHN1Y2Nlc2Z1bAogICAgZnVuY3Rpb24gZG9TaW5nbGVUcmFkZSggRVJDMjAgc291cmNlLCB1aW50IGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVSQzIwIGRlc3QsIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLeWJlclJlc2VydmUgcmVzZXJ2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgdmFsaWRhdGUgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgdWludCBjYWxsVmFsdWUgPSAwOwogICAgICAgIGlmKCBzb3VyY2UgPT0gRVRIX1RPS0VOX0FERFJFU1MgKSBjYWxsVmFsdWUgPSBhbW91bnQ7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHRha2Ugc291cmNlIHRva2VucyB0byB0aGlzIGNvbnRyYWN0CiAgICAgICAgICAgIHNvdXJjZS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgYW1vdW50KTsKCiAgICAgICAgICAgIC8vIGxldCByZXNlcnZlIHVzZSBuZXR3b3JrIHRva2VucwogICAgICAgICAgICBzb3VyY2UuYXBwcm92ZSggcmVzZXJ2ZSwgYW1vdW50KTsKICAgICAgICB9CgogICAgICAgIGlmKCAhIHJlc2VydmUudHJhZGUudmFsdWUoY2FsbFZhbHVlKShzb3VyY2UsIGFtb3VudCwgZGVzdCwgZGVzdEFkZHJlc3MsIHZhbGlkYXRlICkgKSB7CiAgICAgICAgICAgIGlmKCBzb3VyY2UgIT0gRVRIX1RPS0VOX0FERFJFU1MgKSB7CiAgICAgICAgICAgICAgICAvLyByZXNldCB0b2tlbnMgZm9yIHJlc2VydmUKICAgICAgICAgICAgICAgIGlmKCAhIHNvdXJjZS5hcHByb3ZlKCByZXNlcnZlLCAwKSApIHRocm93OwoKICAgICAgICAgICAgICAgIC8vIHNlbmQgdG9rZW5zIGJhY2sgdG8gc2VuZGVyCiAgICAgICAgICAgICAgICBpZiggISBzb3VyY2UudHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50KSApIHRocm93OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiggc291cmNlICE9IEVUSF9UT0tFTl9BRERSRVNTICkgewogICAgICAgICAgICBzb3VyY2UuYXBwcm92ZSggcmVzZXJ2ZSwgMCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IGNoZWNrcyB0aGF0IHVzZXIgc2VudCBldGhlci90b2tlbnMgdG8gY29udHJhY3QgYmVmb3JlIHRyYWRlCiAgICAvLy8gQHBhcmFtIHNvdXJjZSBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gc3JjQW1vdW50IGFtb3VudCBvZiBzb3VyY2UgdG9rZW5zCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGlucHV0IGlzIHZhbGlkCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVRyYWRlSW5wdXQoIEVSQzIwIHNvdXJjZSwgdWludCBzcmNBbW91bnQgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiggc291cmNlICE9IEVUSF9UT0tFTl9BRERSRVNTICYmIG1zZy52YWx1ZSA+IDAgKSB7CiAgICAgICAgICAgIC8vIHNob3VsZG4ndCBzZW5kIGV0aGVyIGZvciB0b2tlbiBleGNoYW5nZQogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAweDg1MDAwMDAwLCAwICk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiggc291cmNlID09IEVUSF9UT0tFTl9BRERSRVNTICYmIG1zZy52YWx1ZSAhPSBzcmNBbW91bnQgKSB7CiAgICAgICAgICAgIC8vIGFtb3VudCBvZiBzZW50IGV0aGVyIGlzIHdyb25nCiAgICAgICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDB4ODUwMDAwMDEsIG1zZy52YWx1ZSApOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoIHNvdXJjZSAhPSBFVEhfVE9LRU5fQUREUkVTUyApIHsKICAgICAgICAgICAgaWYoIHNvdXJjZS5hbGxvd2FuY2UobXNnLnNlbmRlcix0aGlzKSA8IHNyY0Ftb3VudCApIHsKICAgICAgICAgICAgICAgIC8vIGluc3VmZmljaWVudCBhbGxvd2FuZQogICAgICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4NTAwMDAwMiwgbXNnLnZhbHVlICk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICBldmVudCBUcmFkZSggYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgRVJDMjAgc291cmNlLCBFUkMyMCBkZXN0LCB1aW50IGFjdHVhbFNyY0Ftb3VudCwgdWludCBhY3R1YWxEZXN0QW1vdW50ICk7CgogICAgc3RydWN0IFJlc2VydmVUb2tlbkluZm8gewogICAgICAgIHVpbnQgcmF0ZTsKICAgICAgICBLeWJlclJlc2VydmUgcmVzZXJ2ZTsKICAgICAgICB1aW50IHJlc2VydmVCYWxhbmNlOwogICAgfQoKICAgIHN0cnVjdCBUcmFkZUluZm8gewogICAgICAgIHVpbnQgY29udmVydGVkRGVzdEFtb3VudDsKICAgICAgICB1aW50IHJlbWFpbmVkU291cmNlQW1vdW50OwoKICAgICAgICBib29sIHRyYWRlRmFpbGVkOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHVzZSB0b2tlbiBhZGRyZXNzIEVUSF9UT0tFTl9BRERSRVNTIGZvciBldGhlcgogICAgLy8vIEBkZXYgbWFrZXMgYSB0cmFkZSBiZXR3ZWVuIHNvdXJjZSBhbmQgZGVzdCB0b2tlbiBhbmQgc2VuZCBkZXN0IHRva2VuIHRvCiAgICAvLy8gZGVzdEFkZHJlc3MgYW5kIHJlY29yZCB3YWxsZXQgaWQgZm9yIGxhdGVyIHBheW1lbnQKICAgIC8vLyBAcGFyYW0gc291cmNlIFNvdXJjZSB0b2tlbgogICAgLy8vIEBwYXJhbSBzcmNBbW91bnQgYW1vdW50IG9mIHNvdXJjZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0b2luIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gbWF4RGVzdEFtb3VudCBBIGxpbWl0IG9uIHRoZSBhbW91bnQgb2YgZGVzdCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gbWluQ29udmVyc2lvblJhdGUgVGhlIG1pbmltYWwgY29udmVyc2lvbiByYXRlLiBJZiBhY3R1YWwgcmF0ZSBpcyBsb3dlciwgdHJhZGUgaXMgY2FuY2VsZWQuCiAgICAvLy8gQHBhcmFtIHRocm93T25GYWlsdXJlIGlmIHRydWUgYW5kIHRyYWRlIGlzIG5vdCBjb21wbGV0ZWQsIHRoZW4gZnVuY3Rpb24gdGhyb3dzLgogICAgLy8vIEByZXR1cm4gYW1vdW50IG9mIGFjdHVhbCBkZXN0IHRva2VucwogICAgZnVuY3Rpb24gd2FsbGV0VHJhZGUoIEVSQzIwIHNvdXJjZSwgdWludCBzcmNBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgRVJDMjAgZGVzdCwgYWRkcmVzcyBkZXN0QWRkcmVzcywgdWludCBtYXhEZXN0QW1vdW50LAogICAgICAgICAgICAgICAgICAgIHVpbnQgbWluQ29udmVyc2lvblJhdGUsCiAgICAgICAgICAgICAgICAgICAgYm9vbCB0aHJvd09uRmFpbHVyZSwKICAgICAgICAgICAgICAgICAgICBieXRlczMyIHdhbGxldElkICkgcGF5YWJsZSByZXR1cm5zKHVpbnQpIHsKICAgICAgIC8vIFRPRE8gLSBsb2cgd2FsbGV0IGlkCiAgICAgICByZXR1cm4gdHJhZGUoIHNvdXJjZSwgc3JjQW1vdW50LCBkZXN0LCBkZXN0QWRkcmVzcywgbWF4RGVzdEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgbWluQ29udmVyc2lvblJhdGUsIHRocm93T25GYWlsdXJlICk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGlzTmVnbGlnYWJsZSggdWludCBjdXJyZW50VmFsdWUsIHVpbnQgb3JpZ2luYWxWYWx1ZSApIGNvbnN0YW50IHJldHVybnMoYm9vbCl7CiAgICAgIHJldHVybiAoY3VycmVudFZhbHVlIDwgKG9yaWdpbmFsVmFsdWUgLyAxMDAwKSkgfHwgKGN1cnJlbnRWYWx1ZSA9PSAwKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIHVzZSB0b2tlbiBhZGRyZXNzIEVUSF9UT0tFTl9BRERSRVNTIGZvciBldGhlcgogICAgLy8vIEBkZXYgbWFrZXMgYSB0cmFkZSBiZXR3ZWVuIHNvdXJjZSBhbmQgZGVzdCB0b2tlbiBhbmQgc2VuZCBkZXN0IHRva2VuIHRvIGRlc3RBZGRyZXNzCiAgICAvLy8gQHBhcmFtIHNvdXJjZSBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gc3JjQW1vdW50IGFtb3VudCBvZiBzb3VyY2UgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGRlc3QgICBEZXN0aW5hdG9pbiB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0QWRkcmVzcyBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgICAvLy8gQHBhcmFtIG1heERlc3RBbW91bnQgQSBsaW1pdCBvbiB0aGUgYW1vdW50IG9mIGRlc3QgdG9rZW5zCiAgICAvLy8gQHBhcmFtIG1pbkNvbnZlcnNpb25SYXRlIFRoZSBtaW5pbWFsIGNvbnZlcnNpb24gcmF0ZS4gSWYgYWN0dWFsIHJhdGUgaXMgbG93ZXIsIHRyYWRlIGlzIGNhbmNlbGVkLgogICAgLy8vIEBwYXJhbSB0aHJvd09uRmFpbHVyZSBpZiB0cnVlIGFuZCB0cmFkZSBpcyBub3QgY29tcGxldGVkLCB0aGVuIGZ1bmN0aW9uIHRocm93cy4KICAgIC8vLyBAcmV0dXJuIGFtb3VudCBvZiBhY3R1YWwgZGVzdCB0b2tlbnMKICAgIGZ1bmN0aW9uIHRyYWRlKCBFUkMyMCBzb3VyY2UsIHVpbnQgc3JjQW1vdW50LAogICAgICAgICAgICAgICAgICAgIEVSQzIwIGRlc3QsIGFkZHJlc3MgZGVzdEFkZHJlc3MsIHVpbnQgbWF4RGVzdEFtb3VudCwKICAgICAgICAgICAgICAgICAgICB1aW50IG1pbkNvbnZlcnNpb25SYXRlLAogICAgICAgICAgICAgICAgICAgIGJvb2wgdGhyb3dPbkZhaWx1cmUgKSBwYXlhYmxlIHJldHVybnModWludCkgewoKICAgICAgICBpZiggISB2YWxpZGF0ZVRyYWRlSW5wdXQoIHNvdXJjZSwgc3JjQW1vdW50ICkgKSB7CiAgICAgICAgICAgIC8vIGludmFsaWQgaW5wdXQKICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMHg4NjAwMDAwMCwgMCApOwogICAgICAgICAgICBpZiggbXNnLnZhbHVlID4gMCApIHsKICAgICAgICAgICAgICAgIGlmKCAhIG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpICkgdGhyb3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIHRocm93T25GYWlsdXJlICkgdGhyb3c7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgVHJhZGVJbmZvIG1lbW9yeSB0cmFkZUluZm8gPSBUcmFkZUluZm8oMCxzcmNBbW91bnQsZmFsc2UpOwoKICAgICAgICB3aGlsZSggIWlzTmVnbGlnYWJsZShtYXhEZXN0QW1vdW50LXRyYWRlSW5mby5jb252ZXJ0ZWREZXN0QW1vdW50LCBtYXhEZXN0QW1vdW50KQogICAgICAgICAgICAgICAmJiAhaXNOZWdsaWdhYmxlKHRyYWRlSW5mby5yZW1haW5lZFNvdXJjZUFtb3VudCwgc3JjQW1vdW50KSkgewogICAgICAgICAgICBLeWJlclJlc2VydmVQYWlySW5mbyBtZW1vcnkgcmVzZXJ2ZUluZm8gPSBmaW5kQmVzdFJhdGUoc291cmNlLGRlc3QpOwoKICAgICAgICAgICAgaWYoIHJlc2VydmVJbmZvLnJhdGUgPT0gMCB8fCByZXNlcnZlSW5mby5yYXRlIDwgbWluQ29udmVyc2lvblJhdGUgKSB7CiAgICAgICAgICAgICAgICB0cmFkZUluZm8udHJhZGVGYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgLy8gbm8gbW9yZSBhdmFpbGFibGUgZnVuZHMKICAgICAgICAgICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDB4ODYwMDAwMDEsIHRyYWRlSW5mby5yZW1haW5lZFNvdXJjZUFtb3VudCApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc2VydmVJbmZvLnJhdGUgPSAocmVzZXJ2ZUluZm8ucmF0ZSAqICgxMCAqKiBnZXREZWNpbWFscyhkZXN0KSkpIC8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDEwKipnZXREZWNpbWFscyhzb3VyY2UpKTsKCiAgICAgICAgICAgIHVpbnQgYWN0dWFsU3JjQW1vdW50ID0gdHJhZGVJbmZvLnJlbWFpbmVkU291cmNlQW1vdW50OwogICAgICAgICAgICAvLyBUT0RPIC0gb3ZlcmZsb3cgY2hlY2sKICAgICAgICAgICAgdWludCBhY3R1YWxEZXN0QW1vdW50ID0gKGFjdHVhbFNyY0Ftb3VudCAqIHJlc2VydmVJbmZvLnJhdGUpIC8gUFJFQ0lTSU9OOwogICAgICAgICAgICBpZiggYWN0dWFsRGVzdEFtb3VudCA+IHJlc2VydmVJbmZvLnJlc2VydmVCYWxhbmNlICkgewogICAgICAgICAgICAgICAgYWN0dWFsRGVzdEFtb3VudCA9IHJlc2VydmVJbmZvLnJlc2VydmVCYWxhbmNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCBhY3R1YWxEZXN0QW1vdW50ICsgdHJhZGVJbmZvLmNvbnZlcnRlZERlc3RBbW91bnQgPiBtYXhEZXN0QW1vdW50ICkgewogICAgICAgICAgICAgICAgYWN0dWFsRGVzdEFtb3VudCA9IG1heERlc3RBbW91bnQgLSB0cmFkZUluZm8uY29udmVydGVkRGVzdEFtb3VudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVE9ETyAtIGNoZWNrIG92ZXJmbG93CiAgICAgICAgICAgIGFjdHVhbFNyY0Ftb3VudCA9IChhY3R1YWxEZXN0QW1vdW50ICogUFJFQ0lTSU9OKS9yZXNlcnZlSW5mby5yYXRlOwoKICAgICAgICAgICAgLy8gZG8gYWN0dWFsIHRyYWRlCiAgICAgICAgICAgIGlmKCAhIGRvU2luZ2xlVHJhZGUoIHNvdXJjZSxhY3R1YWxTcmNBbW91bnQsIGRlc3QsIGRlc3RBZGRyZXNzLCByZXNlcnZlSW5mby5yZXNlcnZlLCB0cnVlICkgKSB7CiAgICAgICAgICAgICAgICB0cmFkZUluZm8udHJhZGVGYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgLy8gdHJhZGUgZmFpbGVkIGluIHJlc2VydmUKICAgICAgICAgICAgICAgIEVycm9yUmVwb3J0KCB0eC5vcmlnaW4sIDB4ODYwMDAwMDIsIHRyYWRlSW5mby5yZW1haW5lZFNvdXJjZUFtb3VudCApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRvZG8gLSBjaGVjayBvdmVyZmxvdwogICAgICAgICAgICB0cmFkZUluZm8ucmVtYWluZWRTb3VyY2VBbW91bnQgLT0gYWN0dWFsU3JjQW1vdW50OwogICAgICAgICAgICB0cmFkZUluZm8uY29udmVydGVkRGVzdEFtb3VudCArPSBhY3R1YWxEZXN0QW1vdW50OwogICAgICAgIH0KCiAgICAgICAgaWYoIHRyYWRlSW5mby50cmFkZUZhaWxlZCApIHsKICAgICAgICAgICAgaWYoIHRocm93T25GYWlsdXJlICkgdGhyb3c7CiAgICAgICAgICAgIGlmKCBtc2cudmFsdWUgPiAwICkgewogICAgICAgICAgICAgICAgaWYoICEgbXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgKSB0aHJvdzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBFcnJvclJlcG9ydCggdHgub3JpZ2luLCAwLCAwICk7CiAgICAgICAgICAgIGlmKCB0cmFkZUluZm8ucmVtYWluZWRTb3VyY2VBbW91bnQgPiAwICYmIHNvdXJjZSA9PSBFVEhfVE9LRU5fQUREUkVTUyApIHsKICAgICAgICAgICAgICAgIGlmKCAhIG1zZy5zZW5kZXIuc2VuZCh0cmFkZUluZm8ucmVtYWluZWRTb3VyY2VBbW91bnQpICkgdGhyb3c7CiAgICAgICAgICAgIH0KCgoKICAgICAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMCwgMCApOwogICAgICAgICAgICBUcmFkZSggbXNnLnNlbmRlciwgc291cmNlLCBkZXN0LCBzcmNBbW91bnQtdHJhZGVJbmZvLnJlbWFpbmVkU291cmNlQW1vdW50LCB0cmFkZUluZm8uY29udmVydGVkRGVzdEFtb3VudCApOwogICAgICAgICAgICByZXR1cm4gdHJhZGVJbmZvLmNvbnZlcnRlZERlc3RBbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIGV2ZW50IEFkZFJlc2VydmUoIEt5YmVyUmVzZXJ2ZSByZXNlcnZlLCBib29sIGFkZCApOwoKICAgIC8vLyBAbm90aWNlIGNhbiBiZSBjYWxsZWQgb25seSBieSBhZG1pbgogICAgLy8vIEBkZXYgYWRkIG9yIGRlbGV0ZXMgYSByZXNlcnZlIHRvL2Zyb20gdGhlIG5ldHdvcmsuCiAgICAvLy8gQHBhcmFtIHJlc2VydmUgVGhlIHJlc2VydmUgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkIElmIHRydWUsIHRoZSBhZGQgcmVzZXJ2ZS4gT3RoZXJ3aXNlIGRlbGV0ZSByZXNlcnZlLgogICAgZnVuY3Rpb24gYWRkUmVzZXJ2ZSggS3liZXJSZXNlcnZlIHJlc2VydmUsIGJvb2wgYWRkICkgewogICAgICAgIGlmKCBtc2cuc2VuZGVyICE9IGFkbWluICkgewogICAgICAgICAgICAvLyBvbmx5IGFkbWluIGNhbiBhZGQgdG8gcmVzZXJ2ZQogICAgICAgICAgICBFcnJvclJlcG9ydCggbXNnLnNlbmRlciwgMHg4NzAwMDAwMCwgMCApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiggYWRkICkgewogICAgICAgICAgICByZXNlcnZlcy5wdXNoKHJlc2VydmUpOwogICAgICAgICAgICBBZGRSZXNlcnZlKCByZXNlcnZlLCB0cnVlICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyB3aWxsIGhhdmUgdHJ1YmxlIGlmIG1vcmUgdGhhbiA1MGsgcmVzZXJ2ZXMuLi4KICAgICAgICAgICAgZm9yKCB1aW50IGkgPSAwIDsgaSA8IHJlc2VydmVzLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICAgICAgICAgIGlmKCByZXNlcnZlc1tpXSA9PSByZXNlcnZlICkgewogICAgICAgICAgICAgICAgICAgIGlmKCByZXNlcnZlcy5sZW5ndGggPT0gMCApIHJldHVybjsKICAgICAgICAgICAgICAgICAgICByZXNlcnZlc1tpXSA9IHJlc2VydmVzWy0tcmVzZXJ2ZXMubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICBBZGRSZXNlcnZlKCByZXNlcnZlLCBmYWxzZSApOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBFcnJvclJlcG9ydCggbXNnLnNlbmRlciwgMCwgMCApOwogICAgfQoKICAgIGV2ZW50IExpc3RQYWlyc0ZvclJlc2VydmUoIGFkZHJlc3MgcmVzZXJ2ZSwgRVJDMjAgc291cmNlLCBFUkMyMCBkZXN0LCBib29sIGFkZCApOwoKICAgIC8vLyBAbm90aWNlIGNhbiBiZSBjYWxsZWQgb25seSBieSBhZG1pbgogICAgLy8vIEBkZXYgYWxsb3cgb3IgcHJldmVudCBhIHNwZWNpZmljIHJlc2VydmUgdG8gdHJhZGUgYSBwYWlyIG9mIHRva2VucwogICAgLy8vIEBwYXJhbSByZXNlcnZlIFRoZSByZXNlcnZlIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHNvdXJjZSBTb3VyY2UgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdCBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBhZGQgSWYgdHJ1ZSB0aGVuIGVuYWJsZSB0cmFkZSwgb3RoZXJ3aXNlIGRlbGlzdCBwYWlyLgogICAgZnVuY3Rpb24gbGlzdFBhaXJGb3JSZXNlcnZlKGFkZHJlc3MgcmVzZXJ2ZSwgRVJDMjAgc291cmNlLCBFUkMyMCBkZXN0LCBib29sIGFkZCApIHsKICAgICAgICBpZiggbXNnLnNlbmRlciAhPSBhZG1pbiApIHsKICAgICAgICAgICAgLy8gb25seSBhZG1pbiBjYW4gYWRkIHRvIHJlc2VydmUKICAgICAgICAgICAgRXJyb3JSZXBvcnQoIG1zZy5zZW5kZXIsIDB4ODgwMDAwMDAsIDAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgKHBlclJlc2VydmVMaXN0ZWRQYWlyc1tyZXNlcnZlXSlbc2hhMyhzb3VyY2UsZGVzdCldID0gYWRkOwogICAgICAgIExpc3RQYWlyc0ZvclJlc2VydmUoIHJlc2VydmUsIHNvdXJjZSwgZGVzdCwgYWRkICk7CiAgICAgICAgRXJyb3JSZXBvcnQoIHR4Lm9yaWdpbiwgMCwgMCApOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGNhbiBiZSBjYWxsZWQgb25seSBieSBhZG1pbi4gc3RpbGwgbm90IGltcGxlbWVudGVkCiAgICAvLy8gQGRldiB1cGdyYWRlIG5ldHdvcmsgdG8gYSBuZXcgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gbmV3QWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG5ldHdvcmsKICAgIGZ1bmN0aW9uIHVwZ3JhZGUoIGFkZHJlc3MgbmV3QWRkcmVzcyApIHsKICAgICAgICAvLyBUT0RPCiAgICAgICAgbmV3QWRkcmVzczsgLy8gdW51c2VkIHdhcm5pbmcKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBzaG91bGQgYmUgY2FsbGVkIG9mZiBjaGFpbiB3aXRoIGFzIG11Y2ggZ2FzIGFzIG5lZWRlZAogICAgLy8vIEBkZXYgZ2V0IGFuIGFycmF5IG9mIGFsbCByZXNlcnZlcwogICAgLy8vIEByZXR1cm4gQW4gYXJyYXkgb2YgYWxsIHJlc2VydmVzCiAgICBmdW5jdGlvbiBnZXRSZXNlcnZlcyggKSBjb25zdGFudCByZXR1cm5zKEt5YmVyUmVzZXJ2ZVtdKSB7CiAgICAgICAgcmV0dXJuIHJlc2VydmVzOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBhIGRlYnVnIGZ1bmN0aW9uCiAgICAvLy8gQGRldiBnZXQgdGhlIGJhbGFuY2Ugb2YgdGhlIG5ldHdvcmsuIEl0IGlzIGV4cGVjdGVkIHRvIGJlIDAgYWxsIHRoZSB0aW1lLgogICAgLy8vIEBwYXJhbSB0b2tlbiBUaGUgdG9rZW4gdHlwZQogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoIEVSQzIwIHRva2VuICkgY29uc3RhbnQgcmV0dXJucyh1aW50KXsKICAgICAgICBpZiggdG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MgKSByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgICAgIGVsc2UgcmV0dXJuIHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KfQ=='.
	

]
