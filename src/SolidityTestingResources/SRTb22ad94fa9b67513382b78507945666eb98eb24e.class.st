Class {
	#name : #SRTb22ad94fa9b67513382b78507945666eb98eb24e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb22ad94fa9b67513382b78507945666eb98eb24e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4gCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CgogIC8qKgogICAqIEBkZXYgRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2suCiAgICovCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGlmKG1zZy5kYXRhLmxlbmd0aCA8IHNpemUgKyA0KSB7CiAgICAgICB0aHJvdzsKICAgICB9CiAgICAgXzsKICB9CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIAogICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWFudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFydCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlYWhsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHRocm93OwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYW4gYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBMaW1pdGVkVHJhbnNmZXJUb2tlbgogKiBAZGV2IExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4gCiAqIHRyYW5zZmVyYWJpbGl0eSBmb3IgZGlmZmVyZW50IGV2ZW50cy4gSXQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBhcyBhIGJhc2UgY2xhc3MgZm9yIG90aGVyIHRva2VuIAogKiBjb250cmFjdHMuIAogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsCiAqIHRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHJlY3Vyc2l2ZWx5IGNhbGxpbmcgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKCkgdW50aWwgdGhlIGJhc2UgY2xhc3MgaXMgCiAqIGhpdC4gRm9yIGV4YW1wbGU6CiAqICAgICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogKiAgICAgICByZXR1cm4gbWluMjU2KHVubG9ja2VkVG9rZW5zLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7CiAqICAgICB9CiAqIEEgd29ya2luZyBleGFtcGxlIGlzIFZlc3RlZFRva2VuLnNvbDoKICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9ibG9iL21hc3Rlci9jb250cmFjdHMvdG9rZW4vVmVzdGVkVG9rZW4uc29sCiAqLwoKY29udHJhY3QgTGltaXRlZFRyYW5zZmVyVG9rZW4gaXMgRVJDMjAgewoKICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGl0IGNhbiB0cmFuc2ZlciBvciBvdGhlcndpc2UgdGhyb3dzLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsKICAgaWYgKF92YWx1ZSA+IHRyYW5zZmVyYWJsZVRva2Vucyhfc2VuZGVyLCB1aW50NjQobm93KSkpIHRocm93OwogICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpIHsKICAgIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogQGRldiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHNlbmQgdGhlIHRva2Vucy4KICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2lldmUgdGhlIHRva2Vucy4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKSB7CiAgICBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVmYXVsdCB0cmFuc2ZlcmFibGUgdG9rZW5zIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRva2VucyBmb3IgYSBob2xkZXIgKG5vIGxpbWl0KS4KICAgKiBAZGV2IE92ZXJ3cml0aW5nIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGlzIHRoZSB3YXkgdG8gcHJvdmlkZSB0aGUgCiAgICogc3BlY2lmaWMgbG9naWMgZm9yIGxpbWl0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBWZXN0ZWQgdG9rZW4KICogQGRldiBUb2tlbnMgdGhhdCBjYW4gYmUgdmVzdGVkIGZvciBhIGdyb3VwIG9mIGFkZHJlc3Nlcy4KICovCmNvbnRyYWN0IFZlc3RlZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIExpbWl0ZWRUcmFuc2ZlclRva2VuIHsKCiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7CgogIHN0cnVjdCBUb2tlbkdyYW50IHsKICAgIGFkZHJlc3MgZ3JhbnRlcjsgICAgIAogICAgdWludDI1NiB2YWx1ZTsgICAgICAgCiAgICB1aW50NjQgY2xpZmY7CiAgICB1aW50NjQgdmVzdGluZzsKICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIAogICAgYm9vbCByZXZva2FibGU7CiAgICBib29sIGJ1cm5zT25SZXZva2U7ICAKICB9CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOwoKICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7CgogIC8qKgogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcsCiAgICBib29sIF9yZXZva2FibGUsCiAgICBib29sIF9idXJuc09uUmV2b2tlCiAgKSBwdWJsaWMgewoKICAgIC8vIENoZWNrIGZvciBkYXRlIGluY29uc2lzdGVuY2llcyB0aGF0IG1heSBjYXVzZSB1bmV4cGVjdGVkIGJlaGF2aW9yCiAgICBpZiAoX2NsaWZmIDwgX3N0YXJ0IHx8IF92ZXN0aW5nIDwgX2NsaWZmKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGlmICh0b2tlbkdyYW50c0NvdW50KF90bykgPiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKSB0aHJvdzsgICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KCiAgICB1aW50IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuR3JhbnQoCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUgPyBtc2cuc2VuZGVyIDogMCwgLy8gYXZvaWQgc3RvcmluZyBhbiBleHRyYSAyMCBieXRlcyB3aGVuIGl0IGlzIG5vbi1yZXZva2FibGUKICAgICAgICAgICAgICAgICAgX3ZhbHVlLAogICAgICAgICAgICAgICAgICBfY2xpZmYsCiAgICAgICAgICAgICAgICAgIF92ZXN0aW5nLAogICAgICAgICAgICAgICAgICBfc3RhcnQsCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsCiAgICAgICAgICAgICAgICAgIF9idXJuc09uUmV2b2tlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKTsKCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7CgogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIHB1YmxpYyB7CiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKCiAgICBpZiAoIWdyYW50LnJldm9rYWJsZSkgeyAvLyBDaGVjayBpZiBncmFudCB3YXMgcmV2b2thYmxlCiAgICAgIHRocm93OwogICAgfQoKICAgIGlmIChncmFudC5ncmFudGVyICE9IG1zZy5zZW5kZXIpIHsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQKICAgICAgdGhyb3c7CiAgICB9CgogICAgYWRkcmVzcyByZWNlaXZlciA9IGdyYW50LmJ1cm5zT25SZXZva2UgPyAweGRlYWQgOiBtc2cuc2VuZGVyOwoKICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gbm9uVmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7CgogICAgLy8gcmVtb3ZlIGdyYW50IGZyb20gYXJyYXkKICAgIGRlbGV0ZSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtncmFudHNbX2hvbGRlcl0ubGVuZ3RoLnN1YigxKV07CiAgICBncmFudHNbX2hvbGRlcl0ubGVuZ3RoIC09IDE7CgogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChub25WZXN0ZWQpOwogICAgYmFsYW5jZXNbX2hvbGRlcl0gPSBiYWxhbmNlc1tfaG9sZGVyXS5zdWIobm9uVmVzdGVkKTsKCiAgICBUcmFuc2ZlcihfaG9sZGVyLCByZWNlaXZlciwgbm9uVmVzdGVkKTsKICB9CgoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIKICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHNwZWNpZmljIHRpbWUuCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyBhIGhvbGRlcidzIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSB0b2tlbkdyYW50c0NvdW50KGhvbGRlcik7CgogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IFNhZmVNYXRoLmFkZChub25WZXN0ZWQsIG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQoKICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUKICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gU2FmZU1hdGguc3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOwoKICAgIC8vIFJldHVybiB0aGUgbWluaW11bSBvZiBob3cgbWFueSB2ZXN0ZWQgY2FuIHRyYW5zZmVyIGFuZCBvdGhlciB2YWx1ZQogICAgLy8gaW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgbGltaXRpbmcgdHJhbnNmZXJhYmlsaXR5IGZhY3RvcnMgKGRlZmF1bHQgaXMgYmFsYW5jZU9mKQogICAgcmV0dXJuIFNhZmVNYXRoLm1pbjI1Nih2ZXN0ZWRUcmFuc2ZlcmFibGUsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2hlY2sgdGhlIGFtb3VudCBvZiBncmFudHMgdGhhdCBhbiBhZGRyZXNzIGhhcy4KICAgKiBAcGFyYW0gX2hvbGRlciBUaGUgaG9sZGVyIG9mIHRoZSBncmFudHMuCiAgICogQHJldHVybiBBIHVpbnQgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgZ3JhbnRzLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnRzQ291bnQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLgogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudHRlZC4KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEBwYXJhbSBzdGFydCB1aW50NjQgQSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5pbmcgb2YgdGhlIGdyYW50CiAgICogQHBhcmFtIGNsaWZmIHVpbnQ2NCBUaGUgY2xpZmYgcGVyaW9kLgogICAqIEBwYXJhbSB2ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnNvZiBhIHNwZWNpZiBncmFudC4KICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgIHVpbnQyNTYgdG9rZW5zLAogICAgdWludDI1NiB0aW1lLAogICAgdWludDI1NiBzdGFydCwKICAgIHVpbnQyNTYgY2xpZmYsCiAgICB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgIC8vIFNob3J0Y3V0cyBmb3IgYmVmb3JlIGNsaWZmIGFuZCBhZnRlciB2ZXN0aW5nIGNhc2VzLgogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsKICAgICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsKCiAgICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkKICAgICAgdWludDI1NiB2ZXN0ZWRUb2tlbnMgPSBTYWZlTWF0aC5kaXYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLm11bCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGguc3ViKHRpbWUsIHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1Yih2ZXN0aW5nLCBzdGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldCBhbGwgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZjIGdyYW50LgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIGdyYW50ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmVzdGVkLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcsIGJvb2wgcmV2b2thYmxlLCBib29sIGJ1cm5zT25SZXZva2UpIHsKICAgIFRva2VuR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7CiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsKCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgICBncmFudC52YWx1ZSwKICAgICAgdWludDI1Nih0aW1lKSwKICAgICAgdWludDI1NihncmFudC5zdGFydCksCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLAogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpCiAgICApOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZjIGdyYW50IG9uIHRoZSAKICAgKiBwYXNzZWQgdGltZSBmcmFtZS4KICAgKi8KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGdyYW50LnZhbHVlLnN1Yih2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBkYXRlIHdoZW4gdGhlIGhvbGRlciBjYW4gdHJhc2ZlciBhbGwgaXRzIHRva2VucwogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCB0cmFuc2ZlcmFibGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGxhc3RUb2tlbklzVHJhbnNmZXJhYmxlRGF0ZShhZGRyZXNzIGhvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ2NCBkYXRlKSB7CiAgICBkYXRlID0gdWludDY0KG5vdyk7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSBncmFudHNbaG9sZGVyXS5sZW5ndGg7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgZGF0ZSA9IFNhZmVNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogIH0KfQoKLy8gdmVzdGluZzogMzY1IGRheXMsIDM2NSBkYXlzIC8gNCB2ZXN0aW5nCgoKY29udHJhY3QgWEZNIGlzIFZlc3RlZFRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIlhmZXJNb25leSI7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiWEZNIjsKICB1aW50IHB1YmxpYyBkZWNpbWFscyA9IDQ7CiAKICAvL1NwZWNpYWwgQWRkcmVzc2VzCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdBZGRyZXNzPTB4NzQ5QkQzNEM3NzE0NTZhOERFMjhBYTA4ODNiMDBkMTEyNzNFMkVkZTsgLy8gQWRkcmVzcyB0byB3aGljaCBhbGwgZXRoZXIgZnVuZCByZWNlaXZlLgogIGFkZHJlc3MgcHVibGljIFhmZXJNb25leVRlYW1BZGRyZXNzPTB4YzE3OUZDYmRFZWYyREEyQTYxRWQ5YjE4MTc5NDJkNzJCMGE0NmM4YTsgLy8gQWRkcmVzcyB0byB3aGljaCB0ZWFtIHRva2VucyBhcmUgcmVzZXJ2ZWQuCiAgYWRkcmVzcyBwdWJsaWMgWGZlck1vbmV5TWFya2V0aW5nPTB4OUVFRDYzYjM1M0FmNjljRmJEQzBlMTVBMWIwMzc0MjlmMDc4MEQxYzsgLy8gQWRkcmVzcyB0byB3aGljaCBNYXJrZXRpbmcgdG9rZW5zIGFyZSByZXNlcnZlZC4KICBhZGRyZXNzIHB1YmxpYyBvd25lckFkZHJlc3M7IC8vIEFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IG93bmVyLiBDYW4gaGFsdCB0aGUgY3Jvd2RzYWxlLgoKICAvL0Nyb3dkc2FsZSBUaW1lCiAgdWludCBwdWJsaWMgY29uc3RhbnQgcHVibGljU3RhcnRUaW1lPW5vdzsgLy8gVGltZSBpbiBzZWNvbmRzIHdoZW4gcHVibGljIFByZXNhbGUgc3RhcnRzLgogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSRVNBTEVfU1RBUlRfV0VFSzE9MTUxNjQwNjQwMTsgLy8gVGltZSBpbiBzZWNvbmRzIHdoZW4gUHJlc2FsZSBXZWVsIDEgc3RhcnRzLgogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSRVNBTEVfU1RBUlRfV0VFSzI9MTUxNzAxMTIwMTsgLy8gVGltZSBpbiBzZWNvbmRzIHdoZW4gUHJlc2FsZSBXZWVrIDIgc3RhcnRzLgogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSRVNBTEVfU1RBUlRfV0VFSzM9MTUxNzYxNjAwMTsgLy8gVGltZSBpbiBzZWNvbmRzIHdoZW4gUHJlc2FsZSBXZWVrIDMgc3RhcnRzLgogIHVpbnQgcHVibGljIGNvbnN0YW50IENST1dEU0FMRV9TVEFSVD0xNTE4NjUyODAxOyAvLyBUaW1lIGluIHNlY29uZHMgd2hlbiBQdWJsaWMgQ3Jvd2RzYWxlIHN0YXJ0cy4KICB1aW50IHB1YmxpYyBwdWJsaWNFbmRUaW1lPTE1MjI1NDA3OTk7IC8vIFRpbWUgaW4gc2Vjb25kcyBYRk0gY3Jvd2RzYWxlIGVuZHMKICAKICAvLyBNdWx0aXBsaWVyIGZvciB0aGUgZGVjaW1hbHMKICB1aW50IHByaXZhdGUgY29uc3RhbnQgREVDSU1BTFMgPSAxMDAwMDsKCiAgLy9QcmljZXMgb2YgWEZNCiAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfQ1JPV0RTQUxFICAgID0gODAwMCpERUNJTUFMUzsgLy8gWEZNIFByaWNlIHBlciBvbmUgRVRIIGR1cmluZyBjcm93ZHNhbGU7IAogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1BSRVNBTEVfU1RBUlQgICA9IFBSSUNFX0NST1dEU0FMRSAqIDE0MC8xMDA7IC8vIFByaWNlIHdpdGggNDAlIEJvbnVzIFhGTQogIHVpbnQgcHVibGljIGNvbnN0YW50IFBSSUNFX1BSRVNBTEVfV0VFSzEgICA9IFBSSUNFX0NST1dEU0FMRSAqIDEyNS8xMDA7IC8vICBQcmljZSB3aXRoIDI1JSBCb251cyBYRk0KICB1aW50IHB1YmxpYyBjb25zdGFudCBQUklDRV9QUkVTQUxFX1dFRUsyID0gUFJJQ0VfQ1JPV0RTQUxFICogMTE4LzEwMDsgLy8gICBQcmljZSB3aXRoIDE4JSBCb251cyBYRk0KICB1aW50IHB1YmxpYyBjb25zdGFudCBQUklDRV9QUkVTQUxFX1dFRUszID0gUFJJQ0VfQ1JPV0RTQUxFICogMTEwLzEwMDsgLy8gICBQcmljZSB3aXRoIDEwJSBCb251cyBYRk0KICAKICAvL0Fzc2lnbmVkIFhGTSBUb2tlbnMgCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgX2luaXRpYWxTdXBwbHk9ICAyNTAwMDAwMDAqREVDSU1BTFM7IC8vIFRvdGFsIHRva2VucyBhc3NpZ25lZCBpbml0aWFsbHkgCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfVEVBTSA9ICAgICAgICAgNjI1MDAwMDAqREVDSU1BTFM7IC8vIFRva2VuIHJlc2VydmVkIGZvciB0ZWFtCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfQ1JPV0RTQUxFID0gICAgMTc1MDAwMDAwKkRFQ0lNQUxTOyAvLyBBbGxvY2F0ZWQgZm9yIENyb3dkc2FsZShQaGFzZSAxICsgUGhhc2UgMikgCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQUxMT0NfTUFSS0VUSU5HID0gICAgMTI1MDAwMDAqREVDSU1BTFM7IC8vIEFsbG9jYXRlZCBmb3IgTWFya2V0aW5nLCBCb250aWVzIAogIAogIC8vUnVubmluZyB0b3RhbHMKICB1aW50IHB1YmxpYyBldGhlclJhaXNlZDsgLy8gVG90YWwgRXRoZXIgcmFpc2VkLgogIHVpbnQgcHVibGljIFhGTVNvbGQ7IC8vIFRvdGFsIFhGTSBzb2xkCiAgdWludCBwdWJsaWMgaGFyZGNhcEluRXRoPTI1MDAwKiAxIGV0aGVyOwogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CiAgCiAgLy9ib29sZWFucwogIGJvb2wgcHVibGljIGhhbHRlZDsgLy8gaGFsdHMgdGhlIGNyb3dkIHNhbGUgaWYgdHJ1ZS4KCiAgLy8gTU9ESUZJRVJTCiAgLy9JcyBjdXJyZW50bHkgaW4gdGhlIHBlcmlvZCBhZnRlciB0aGUgcHJpdmF0ZSBzdGFydCB0aW1lIGFuZCBiZWZvcmUgdGhlIHB1YmxpYyBzdGFydCB0aW1lLgogIG1vZGlmaWVyIGlzX3ByZV9jcm93ZGZ1bmRfcGVyaW9kKCkgewogICAgaWYgKG5vdyA+PSBwdWJsaWNTdGFydFRpbWUgKSB0aHJvdzsKICAgIF87CiAgfQoKICAvL0lzIGN1cnJlbnRseSB0aGUgY3Jvd2RmdW5kIHBlcmlvZAogIG1vZGlmaWVyIGlzX2Nyb3dkZnVuZF9wZXJpb2QoKSB7CiAgICBpZiAobm93IDwgcHVibGljU3RhcnRUaW1lKSB0aHJvdzsKICAgIGlmIChpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKSB0aHJvdzsKICAgIF87CiAgfQoKICAvLyBJcyBjb21wbGV0ZWQKICBtb2RpZmllciBpc19jcm93ZGZ1bmRfY29tcGxldGVkKCkgewogICAgaWYgKCFpc0Nyb3dkZnVuZENvbXBsZXRlZCgpKSB0aHJvdzsKICAgIF87CiAgfQogIGZ1bmN0aW9uIGlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKG5vdyA+IHB1YmxpY0VuZFRpbWUgJiYgWEZNU29sZCA+PSBBTExPQ19DUk9XRFNBTEUpIHJldHVybiB0cnVlOyAvLyBDcm93ZHNhbGUgY2FuIGFsc28gYmUgaGFsdGVkIGJ5IHRoZSBvd25lci4KICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vTWF5IG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBhZGRyZXNzCiAgbW9kaWZpZXIgb25seV9vd25lcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyQWRkcmVzcykgdGhyb3c7CiAgICBfOwogIH0KCiAgLy9NYXkgb25seSBiZSBjYWxsZWQgaWYgdGhlIGNyb3dkZnVuZCBoYXMgbm90IGJlZW4gaGFsdGVkCiAgbW9kaWZpZXIgaXNfbm90X2hhbHRlZCgpIHsKICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIC8vIEVWRU5UUwogIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgX3JlY2lwaWVudCwgdWludCBfYW1vdW50KTsKCiAgLy8gSW5pdGlhbGl6YXRpb24gY29udHJhY3QgYXNzaWducyBhZGRyZXNzIG9mIGNyb3dkZnVuZCBjb250cmFjdC4KICBmdW5jdGlvbiBYRk0oKSB7CiAgICBvd25lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgYmFsYW5jZXNbWGZlck1vbmV5VGVhbUFkZHJlc3NdICs9IEFMTE9DX1RFQU07CiAgICBiYWxhbmNlc1tYZmVyTW9uZXlNYXJrZXRpbmddICs9IEFMTE9DX01BUktFVElORzsKICAgIGJhbGFuY2VzW293bmVyQWRkcmVzc10gKz0gQUxMT0NfQ1JPV0RTQUxFOwogICAgfQoKICAvLyBUcmFuc2ZlciBhbW91bnQgb2YgdG9rZW5zIGZyb20gc2VuZGVyIGFjY291bnQgdG8gcmVjaXBpZW50LgogIC8vIE9ubHkgY2FsbGFibGUgYWZ0ZXIgdGhlIGNyb3dkIGZ1bmQgaXMgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogIHsKICAgIGlmIChfdG8gPT0gbXNnLnNlbmRlcikgcmV0dXJuOyAvLyBuby1vcCwgYWxsb3cgZXZlbiBkdXJpbmcgY3Jvd2RzYWxlLCBpbiBvcmRlciB0byB3b3JrIGFyb3VuZCB1c2luZyBncmFudFZlc3RlZFRva2VucygpIHdoaWxlIGluIGNyb3dkc2FsZQogICAvLyBpZiAoIWlzQ3Jvd2RmdW5kQ29tcGxldGVkKCkpIHRocm93OwogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYSByZWNpcGllbnQuCiAgLy8gVHJhbnNmZXIgYW1vdW50IG9mIHRva2VucyBmcm9tIHNlbmRlciBhY2NvdW50IHRvIHJlY2lwaWVudC4KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZAogIHsKICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLy9jb25zdGFudCBmdW5jdGlvbiByZXR1cm5zIHRoZSBjdXJyZW50IFhGTSBwcmljZS4KICBmdW5jdGlvbiBnZXRQcmljZVJhdGUoKQogICAgICBjb25zdGFudAogICAgICByZXR1cm5zICh1aW50IG9fcmF0ZSkKICB7CiAgICAgIHVpbnQgZGVsdGEgPSBub3c7CiAgICAgIGlmIChkZWx0YSA8IFBSRVNBTEVfU1RBUlRfV0VFSzEpIHJldHVybiBQUklDRV9QUkVTQUxFX1NUQVJUOwogICAgICBpZiAoZGVsdGEgPCBQUkVTQUxFX1NUQVJUX1dFRUsyKSByZXR1cm4gUFJJQ0VfUFJFU0FMRV9XRUVLMTsKICAgICAgaWYgKGRlbHRhIDwgUFJFU0FMRV9TVEFSVF9XRUVLMykgcmV0dXJuIFBSSUNFX1BSRVNBTEVfV0VFSzI7CiAgICAgIGlmIChkZWx0YSA8IENST1dEU0FMRV9TVEFSVCkgcmV0dXJuIFBSSUNFX1BSRVNBTEVfV0VFSzM7CiAgICAgIHJldHVybiAoUFJJQ0VfQ1JPV0RTQUxFKTsKICB9CgogIC8vIGNhbGN1bGF0ZXMgYW1vdW50IG9mIFhGTSB3ZSBnZXQsIGdpdmVuIHRoZSB3ZWkgYW5kIHRoZSByYXRlcyBkZWZpbmVkIHBlciAxIGV0aAogIGZ1bmN0aW9uIGNhbGNBbW91bnQodWludCBfd2VpLCB1aW50IF9yYXRlKSAKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50KSAKICB7CiAgICByZXR1cm4gU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChfd2VpLCBfcmF0ZSksIDEgZXRoZXIpOwogIH0gCiAgCiAgLy8gUmV0dXJucyBgYW1vdW50YCBpbiBzY29wZSBhcyB0aGUgbnVtYmVyIG9mIFhGTSB0b2tlbnMgdGhhdCBpdCB3aWxsIHB1cmNoYXNlLgogIGZ1bmN0aW9uIHByb2Nlc3NQdXJjaGFzZSh1aW50IF9yYXRlLCB1aW50IF9yZW1haW5pbmcpCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAodWludCBvX2Ftb3VudCkKICB7CiAgICBvX2Ftb3VudCA9IGNhbGNBbW91bnQobXNnLnZhbHVlLCBfcmF0ZSk7CgogICAgaWYgKG9fYW1vdW50ID4gX3JlbWFpbmluZykgdGhyb3c7CiAgICBpZiAoIW11bHRpc2lnQWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpIHRocm93OwoKICAgIGJhbGFuY2VzW293bmVyQWRkcmVzc10gPSBiYWxhbmNlc1tvd25lckFkZHJlc3NdLnN1YihvX2Ftb3VudCk7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChvX2Ftb3VudCk7CgogICAgWEZNU29sZCArPSBvX2Ftb3VudDsKICAgIGV0aGVyUmFpc2VkICs9IG1zZy52YWx1ZTsKICB9CgogIC8vRGVmYXVsdCBmdW5jdGlvbiBjYWxsZWQgYnkgc2VuZGluZyBFdGhlciB0byB0aGlzIGFkZHJlc3Mgd2l0aCBubyBhcmd1bWVudHMuCiAgLy9SZXN1bHRzIGluIGNyZWF0aW9uIG9mIG5ldyBYRk0gVG9rZW5zIGlmIHRyYW5zYWN0aW9uIHdvdWxkIG5vdCBleGNlZWQgaGFyZCBsaW1pdCBvZiBYRk0gVG9rZW4uCiAgZnVuY3Rpb24oKSBwYXlhYmxlIGlzX2Nyb3dkZnVuZF9wZXJpb2QgICAgaXNfbm90X2hhbHRlZAogIHsKICAgIHVpbnQgYW1vdW50ID0gcHJvY2Vzc1B1cmNoYXNlKGdldFByaWNlUmF0ZSgpLCBTYWZlTWF0aC5zdWIoQUxMT0NfQ1JPV0RTQUxFLCBYRk1Tb2xkKSk7CiAgICBCdXkobXNnLnNlbmRlciwgYW1vdW50KTsKICB9CgogIC8vIFRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGNyb3dkZnVuZCBwZXJpb2QKICAvLyBXQVJOSU5HOiB0cmFuc2ZlcigpLCB3aGljaCBpcyBjYWxsZWQgYnkgZ3JhbnRWZXN0ZWRUb2tlbnMoKSwgd2FudHMgYSBtaW5pbXVtIG1lc3NhZ2UgbGVuZ3RoCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWQoYWRkcmVzcyBfWGZlck1vbmV5VGVhbUFkZHJlc3MsIGFkZHJlc3MgX1hmZXJNb25leUZ1bmRBZGRyZXNzKQogICAgaXNfY3Jvd2RmdW5kX2NvbXBsZXRlZAogICAgb25seV9vd25lcgogICAgaXNfbm90X2hhbHRlZAogIHsKICAgIC8vIEdyYW50IHRva2VucyBwcmUtYWxsb2NhdGVkIGZvciB0aGUgdGVhbQogICAgZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICAgIF9YZmVyTW9uZXlUZWFtQWRkcmVzcywgQUxMT0NfVEVBTSwKICAgICAgdWludDY0KG5vdyksIHVpbnQ2NChub3cpICsgOTEgZGF5cyAsIHVpbnQ2NChub3cpICsgMzY1IGRheXMsIAogICAgICBmYWxzZSwgZmFsc2UKICAgICk7CgogICAgLy8gR3JhbnQgdG9rZW5zIHRoYXQgcmVtYWluIGFmdGVyIGNyb3dkc2FsZSB0byB0aGUgWGZlck1vbmV5IGZ1bmQsIHZlc3RlZCBmb3IgMiB5ZWFycwogICAgZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICAgIF9YZmVyTW9uZXlGdW5kQWRkcmVzcywgYmFsYW5jZXNbb3duZXJBZGRyZXNzXSwKICAgICAgdWludDY0KG5vdyksIHVpbnQ2NChub3cpICsgMTgyIGRheXMgLCB1aW50NjQobm93KSArIDczMCBkYXlzLCAKICAgICAgZmFsc2UsIGZhbHNlCiAgICApOwogIH0KCiAgLy9NYXkgYmUgdXNlZCBieSBvd25lciBvZiBjb250cmFjdCB0byBoYWx0IGNyb3dkc2FsZSBhbmQgbm8gbG9uZ2VyIGV4Y2VwdCBldGhlci4KICBmdW5jdGlvbiB0b2dnbGVIYWx0KGJvb2wgX2hhbHRlZCkKICAgIG9ubHlfb3duZXIKICB7CiAgICBoYWx0ZWQgPSBfaGFsdGVkOwogIH0KCiAgLy9mYWlsc2FmZSBkcmFpbgogIGZ1bmN0aW9uIGRyYWluKCkKICAgIG9ubHlfb3duZXIKICB7CiAgICBpZiAoIW93bmVyQWRkcmVzcy5zZW5kKHRoaXMuYmFsYW5jZSkpIHRocm93OwogIH0KfQ=='.
	

]
