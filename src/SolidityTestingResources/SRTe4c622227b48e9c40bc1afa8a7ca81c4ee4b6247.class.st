Class {
	#name : #SRTe4c622227b48e9c40bc1afa8a7ca81c4ee4b6247,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe4c622227b48e9c40bc1afa8a7ca81c4ee4b6247 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovLy8gQHRpdGxlIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IC0gU3RhbmRhcmQgY29udHJhY3QgaW1wbGVtZW50YXRpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBFUkMyMjMgdG9rZW5zLgpjb250cmFjdCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIHVzZXIgb3IgYW5vdGhlciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVHJhbnNhY3Rpb24gaW5pdGlhdG9yLCBhbmFsb2d1ZSBvZiBtc2cuc2VuZGVyCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBfZGF0YSBEYXRhIGNvbnRhaW5pZyBhIGZ1bmN0aW9uIHNpZ25hdHVyZSBhbmQvb3IgcGFyYW1ldGVycwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQoKY29udHJhY3QgVG9rZW4gewogICAgLyoKICAgICAqIEltcGxlbWVudHMgRVJDIDIwIHN0YW5kYXJkLgogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9mOTA4NjRhM2QyYjJiNDVjNGRlY2Y5NWVmZDI2YjNmMGMyNzYwNTFhL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICAgICAqCiAgICAgKiAgQWRkZWQgc3VwcG9ydCBmb3IgdGhlIEVSQyAyMjMgInRva2VuRmFsbGJhY2siIG1ldGhvZCBpbiBhICJ0cmFuc2ZlciIgZnVuY3Rpb24gd2l0aCBhIHBheWxvYWQuCiAgICAgKiAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIyMwogICAgICovCgogICAgLyoKICAgICAqIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgICogZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICAgKiBpcyByZXBsYWNlZCB3aXRoOgogICAgICogdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICAgKiBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgICogVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICAgKiBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgICAqIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICAqLwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLyoKICAgICAqIEVSQyAyMAogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgLyoKICAgICAqIEVSQyAyMjMKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoKICAgICAqIEV2ZW50cwogICAgICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKICAgIC8vIFRoZXJlIGlzIG5vIEVSQzIyMyBjb21wYXRpYmxlIFRyYW5zZmVyIGV2ZW50LCB3aXRoIGBfZGF0YWAgaW5jbHVkZWQuCn0KCgovLy8gQHRpdGxlIFN0YW5kYXJkIHRva2VuIGNvbnRyYWN0IC0gU3RhbmRhcmQgdG9rZW4gaW1wbGVtZW50YXRpb24uCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIC8qCiAgICAgKiBEYXRhIHN0cnVjdHVyZXMKICAgICAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYC4KICAgIC8vLyBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgIGFuZCB0cmlnZ2VyCiAgICAvLy8gdG9rZW5GYWxsYmFjayBpZiBzZW5kZXIgaXMgYSBjb250cmFjdC4KICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX2RhdGEgRGF0YSB0byBiZSBzZW50IHRvIHRva2VuRmFsbGJhY2sKICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdmFsdWUsCiAgICAgICAgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyKF90bywgX3ZhbHVlKSk7CgogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF92YWx1ZWAgdG9rZW5zIGZyb20gYF9mcm9tYCB0byBgX3RvYCBpZiBgbXNnLnNlbmRlcmAgaXMgYWxsb3dlZC4KICAgIC8vLyBAZGV2IEFsbG93cyBmb3IgYW4gYXBwcm92ZWQgdGhpcmQgcGFydHkgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20gb25lCiAgICAvLy8gYWRkcmVzcyB0byBhbm90aGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBzZW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX2Zyb20gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90byAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBgX3NwZW5kZXJgIHRvIHRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBtc2cuc2VuZGVyYCB0byBhbnkgYWRkcmVzcy4KICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSAweDApOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoKICAgICAqIFJlYWQgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIHRoYXQgYSBzcGVuZGVyIGNhbiB0cmFuc2ZlciBvbgogICAgLy8vIGJlaGFsZiBvZiBhIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyByZW1haW5pbmcgYWxsb3dhbmNlIGZvciBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgdGhlIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBiYWxhbmNlIG9mIG93bmVyLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQp9CgoKLy8vIEB0aXRsZSBSYWlkZW4gVG9rZW4KY29udHJhY3QgUmFpZGVuVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLyoKICAgICAqICBUZXJtaW5vbG9neToKICAgICAqICAxIHRva2VuIHVuaXQgPSBSZWkKICAgICAqICAxIHRva2VuID0gUkROID0gUmVpICogbXVsdGlwbGllcgogICAgICogIG11bHRpcGxpZXIgc2V0IGZyb20gdG9rZW4ncyBudW1iZXIgb2YgZGVjaW1hbHMgKGkuZS4gMTAgKiogZGVjaW1hbHMpCiAgICAgKi8KCiAgICAvKgogICAgICogIFRva2VuIG1ldGFkYXRhCiAgICAgKi8KICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgbmFtZSA9ICJSYWlkZW4gVG9rZW4iOwogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBzeW1ib2wgPSAiUkROIjsKICAgIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBkZWNpbWFscyA9IDE4OwogICAgdWludCBjb25zdGFudCBtdWx0aXBsaWVyID0gMTAgKiogdWludChkZWNpbWFscyk7CgogICAgZXZlbnQgRGVwbG95ZWQodWludCBpbmRleGVkIF90b3RhbF9zdXBwbHkpOwogICAgZXZlbnQgQnVybnQoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9yZWNlaXZlciwKICAgICAgICB1aW50IGluZGV4ZWQgX251bSwKICAgICAgICB1aW50IGluZGV4ZWQgX3RvdGFsX3N1cHBseQogICAgKTsKCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBkdXRjaCBhdWN0aW9uIGNvbnRyYWN0IGFkZHJlc3MKICAgIC8vLyBhbmQgYXNzaWducyBhbGwgdG9rZW5zIHRvIGR1dGNoIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIGF1Y3Rpb25fYWRkcmVzcyBBZGRyZXNzIG9mIGR1dGNoIGF1Y3Rpb24gY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIHdhbGxldF9hZGRyZXNzIEFkZHJlc3Mgb2Ygd2FsbGV0LgogICAgLy8vIEBwYXJhbSBpbml0aWFsX3N1cHBseSBOdW1iZXIgb2YgaW5pdGlhbGx5IHByb3ZpZGVkIHRva2VuIHVuaXRzIChSZWkpLgogICAgZnVuY3Rpb24gUmFpZGVuVG9rZW4oCiAgICAgICAgYWRkcmVzcyBhdWN0aW9uX2FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyB3YWxsZXRfYWRkcmVzcywKICAgICAgICB1aW50IGluaXRpYWxfc3VwcGx5KQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIEF1Y3Rpb24gYWRkcmVzcyBzaG91bGQgbm90IGJlIG51bGwuCiAgICAgICAgcmVxdWlyZShhdWN0aW9uX2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKHdhbGxldF9hZGRyZXNzICE9IDB4MCk7CgogICAgICAgIC8vIEluaXRpYWwgc3VwcGx5IGlzIGluIFJlaQogICAgICAgIHJlcXVpcmUoaW5pdGlhbF9zdXBwbHkgPiBtdWx0aXBsaWVyKTsKCiAgICAgICAgLy8gVG90YWwgc3VwcGx5IG9mIFJlaSBhdCBkZXBsb3ltZW50CiAgICAgICAgdG90YWxTdXBwbHkgPSBpbml0aWFsX3N1cHBseTsKCiAgICAgICAgYmFsYW5jZXNbYXVjdGlvbl9hZGRyZXNzXSA9IGluaXRpYWxfc3VwcGx5IC8gMjsKICAgICAgICBiYWxhbmNlc1t3YWxsZXRfYWRkcmVzc10gPSBpbml0aWFsX3N1cHBseSAvIDI7CgogICAgICAgIFRyYW5zZmVyKDB4MCwgYXVjdGlvbl9hZGRyZXNzLCBiYWxhbmNlc1thdWN0aW9uX2FkZHJlc3NdKTsKICAgICAgICBUcmFuc2ZlcigweDAsIHdhbGxldF9hZGRyZXNzLCBiYWxhbmNlc1t3YWxsZXRfYWRkcmVzc10pOwoKICAgICAgICBEZXBsb3llZCh0b3RhbFN1cHBseSk7CgogICAgICAgIGFzc2VydCh0b3RhbFN1cHBseSA9PSBiYWxhbmNlc1thdWN0aW9uX2FkZHJlc3NdICsgYmFsYW5jZXNbd2FsbGV0X2FkZHJlc3NdKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgYG1zZy5zZW5kZXJgIHRvIHNpbXBseSBkZXN0cm95IGBudW1gIHRva2VuIHVuaXRzIChSZWkpLiBUaGlzIG1lYW5zIHRoZSB0b3RhbAogICAgLy8vIHRva2VuIHN1cHBseSB3aWxsIGRlY3JlYXNlLgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIGRlc3Ryb3kgdG9rZW4gdW5pdHMgKFJlaSkuCiAgICAvLy8gQHBhcmFtIG51bSBOdW1iZXIgb2YgdG9rZW4gdW5pdHMgKFJlaSkgdG8gYnVybi4KICAgIGZ1bmN0aW9uIGJ1cm4odWludCBudW0pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShudW0gPiAwKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IG51bSk7CiAgICAgICAgcmVxdWlyZSh0b3RhbFN1cHBseSA+PSBudW0pOwoKICAgICAgICB1aW50IHByZV9iYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IG51bTsKICAgICAgICB0b3RhbFN1cHBseSAtPSBudW07CiAgICAgICAgQnVybnQobXNnLnNlbmRlciwgbnVtLCB0b3RhbFN1cHBseSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBudW0pOwoKICAgICAgICBhc3NlcnQoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPT0gcHJlX2JhbGFuY2UgLSBudW0pOwogICAgfQoKfQoKCi8vLyBAdGl0bGUgRHV0Y2ggYXVjdGlvbiBjb250cmFjdCAtIGRpc3RyaWJ1dGlvbiBvZiBhIGZpeGVkIG51bWJlciBvZiB0b2tlbnMgdXNpbmcgYW4gYXVjdGlvbi4KLy8vIFRoZSBjb250cmFjdCBjb2RlIGlzIGluc3BpcmVkIGJ5IHRoZSBHbm9zaXMgYXVjdGlvbiBjb250cmFjdC4gTWFpbiBkaWZmZXJlbmNlIGlzIHRoYXQgdGhlCi8vLyBhdWN0aW9uIGVuZHMgaWYgYSBmaXhlZCBudW1iZXIgb2YgdG9rZW5zIHdhcyBzb2xkLgpjb250cmFjdCBEdXRjaEF1Y3Rpb24gewogICAgLyoKICAgICAqIEF1Y3Rpb24gZm9yIHRoZSBSRE4gVG9rZW4uCiAgICAgKgogICAgICogVGVybWlub2xvZ3k6CiAgICAgKiAxIHRva2VuIHVuaXQgPSBSZWkKICAgICAqIDEgdG9rZW4gPSBSRE4gPSBSZWkgKiB0b2tlbl9tdWx0aXBsaWVyCiAgICAgKiB0b2tlbl9tdWx0aXBsaWVyIHNldCBmcm9tIHRva2VuJ3MgbnVtYmVyIG9mIGRlY2ltYWxzIChpLmUuIDEwICoqIGRlY2ltYWxzKQogICAgICovCgogICAgLy8gV2FpdCA3IGRheXMgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgYXVjdGlvbiwgYmVmb3JlIGFueW9uZSBjYW4gY2xhaW0gdG9rZW5zCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyB0b2tlbl9jbGFpbV93YWl0aW5nX3BlcmlvZCA9IDE1IG1pbnV0ZXM7CgogICAgLy8gQmlkIHZhbHVlIG92ZXIgd2hpY2ggdGhlIGFkZHJlc3MgaGFzIHRvIGJlIHdoaXRlbGlzdGVkCiAgICAvLyBBdCBkZXBsb3ltZW50IG1vbWVudCwgbGVzcyB0aGFuIDFrJAogICAgdWludCBjb25zdGFudCBwdWJsaWMgYmlkX3RocmVzaG9sZCA9IDIuNSBldGhlcjsKCiAgICAvKgogICAgICogU3RvcmFnZQogICAgICovCgogICAgUmFpZGVuVG9rZW4gcHVibGljIHRva2VuOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXJfYWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldF9hZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgd2hpdGVsaXN0ZXJfYWRkcmVzczsKCiAgICAvLyBQcmljZSBkZWNheSBmdW5jdGlvbiBwYXJhbWV0ZXJzIHRvIGJlIGNoYW5nZWQgZGVwZW5kaW5nIG9uIHRoZSBkZXNpcmVkIG91dGNvbWUKCiAgICAvLyBTdGFydGluZyBwcmljZSBpbiBXRUk7IGUuZy4gMiAqIDEwICoqIDE4CiAgICB1aW50IHB1YmxpYyBwcmljZV9zdGFydDsKCiAgICAvLyBEaXZpc29yIGNvbnN0YW50OyBlLmcuIDUyNDg4MDAwMAogICAgdWludCBwdWJsaWMgcHJpY2VfY29uc3RhbnQ7CgogICAgLy8gRGl2aXNvciBleHBvbmVudDsgZS5nLiAzCiAgICB1aW50MzIgcHVibGljIHByaWNlX2V4cG9uZW50OwoKICAgIC8vIEZvciBjYWxjdWxhdGluZyBlbGFwc2VkIHRpbWUgZm9yIHByaWNlCiAgICB1aW50IHB1YmxpYyBzdGFydF90aW1lOwogICAgdWludCBwdWJsaWMgZW5kX3RpbWU7CiAgICB1aW50IHB1YmxpYyBzdGFydF9ibG9jazsKCiAgICAvLyBLZWVwIHRyYWNrIG9mIGFsbCBFVEggcmVjZWl2ZWQgaW4gdGhlIGJpZHMKICAgIHVpbnQgcHVibGljIHJlY2VpdmVkX3dlaTsKCiAgICAvLyBLZWVwIHRyYWNrIG9mIGN1bXVsYXRpdmUgRVRIIGZ1bmRzIGZvciB3aGljaCB0aGUgdG9rZW5zIGhhdmUgYmVlbiBjbGFpbWVkCiAgICB1aW50IHB1YmxpYyBmdW5kc19jbGFpbWVkOwoKICAgIHVpbnQgcHVibGljIHRva2VuX211bHRpcGxpZXI7CgogICAgLy8gVG90YWwgbnVtYmVyIG9mIFJlaSAoUkROICogdG9rZW5fbXVsdGlwbGllcikgdGhhdCB3aWxsIGJlIGF1Y3Rpb25lZAogICAgdWludCBwdWJsaWMgbnVtX3Rva2Vuc19hdWN0aW9uZWQ7CgogICAgLy8gV2VpIHBlciBSRE4gKFJlaSAqIHRva2VuX211bHRpcGxpZXIpCiAgICB1aW50IHB1YmxpYyBmaW5hbF9wcmljZTsKCiAgICAvLyBCaWRkZXIgYWRkcmVzcyA9PiBiaWQgdmFsdWUKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJpZHM7CgogICAgLy8gV2hpdGVsaXN0IGZvciBhZGRyZXNzZXMgdGhhdCB3YW50IHRvIGJpZCBtb3JlIHRoYW4gYmlkX3RocmVzaG9sZAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0OwoKICAgIFN0YWdlcyBwdWJsaWMgc3RhZ2U7CgogICAgLyoKICAgICAqIEVudW1zCiAgICAgKi8KICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBBdWN0aW9uRGVwbG95ZWQsCiAgICAgICAgQXVjdGlvblNldFVwLAogICAgICAgIEF1Y3Rpb25TdGFydGVkLAogICAgICAgIEF1Y3Rpb25FbmRlZCwKICAgICAgICBUb2tlbnNEaXN0cmlidXRlZAogICAgfQoKICAgIC8qCiAgICAgKiBNb2RpZmllcnMKICAgICAqLwogICAgbW9kaWZpZXIgYXRTdGFnZShTdGFnZXMgX3N0YWdlKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBfc3RhZ2UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJfYWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1doaXRlbGlzdGVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB3aGl0ZWxpc3Rlcl9hZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiBFdmVudHMKICAgICAqLwoKICAgIGV2ZW50IERlcGxveWVkKAogICAgICAgIHVpbnQgaW5kZXhlZCBfcHJpY2Vfc3RhcnQsCiAgICAgICAgdWludCBpbmRleGVkIF9wcmljZV9jb25zdGFudCwKICAgICAgICB1aW50MzIgaW5kZXhlZCBfcHJpY2VfZXhwb25lbnQKICAgICk7CiAgICBldmVudCBTZXR1cCgpOwogICAgZXZlbnQgQXVjdGlvblN0YXJ0ZWQodWludCBpbmRleGVkIF9zdGFydF90aW1lLCB1aW50IGluZGV4ZWQgX2Jsb2NrX251bWJlcik7CiAgICBldmVudCBCaWRTdWJtaXNzaW9uKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc2VuZGVyLAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICB1aW50IF9taXNzaW5nX2Z1bmRzCiAgICApOwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3JlY2lwaWVudCwgdWludCBfc2VudF9hbW91bnQpOwogICAgZXZlbnQgQXVjdGlvbkVuZGVkKHVpbnQgX2ZpbmFsX3ByaWNlKTsKICAgIGV2ZW50IFRva2Vuc0Rpc3RyaWJ1dGVkKCk7CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgdGhlIHN0YXJ0aW5nIHByaWNlLCBkaXZpc29yIGNvbnN0YW50IGFuZAogICAgLy8vIGRpdmlzb3IgZXhwb25lbnQgZm9yIGNhbGN1bGF0aW5nIHRoZSBEdXRjaCBBdWN0aW9uIHByaWNlLgogICAgLy8vIEBwYXJhbSBfd2FsbGV0X2FkZHJlc3MgV2FsbGV0IGFkZHJlc3MgdG8gd2hpY2ggYWxsIGNvbnRyaWJ1dGVkIEVUSCB3aWxsIGJlIGZvcndhcmRlZC4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX3N0YXJ0IEhpZ2ggcHJpY2UgaW4gV0VJIGF0IHdoaWNoIHRoZSBhdWN0aW9uIHN0YXJ0cy4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX2NvbnN0YW50IEF1Y3Rpb24gcHJpY2UgZGl2aXNvciBjb25zdGFudC4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX2V4cG9uZW50IEF1Y3Rpb24gcHJpY2UgZGl2aXNvciBleHBvbmVudC4KICAgIGZ1bmN0aW9uIER1dGNoQXVjdGlvbigKICAgICAgICBhZGRyZXNzIF93YWxsZXRfYWRkcmVzcywKICAgICAgICBhZGRyZXNzIF93aGl0ZWxpc3Rlcl9hZGRyZXNzLAogICAgICAgIHVpbnQgX3ByaWNlX3N0YXJ0LAogICAgICAgIHVpbnQgX3ByaWNlX2NvbnN0YW50LAogICAgICAgIHVpbnQzMiBfcHJpY2VfZXhwb25lbnQpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0X2FkZHJlc3MgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF93aGl0ZWxpc3Rlcl9hZGRyZXNzICE9IDB4MCk7CiAgICAgICAgd2FsbGV0X2FkZHJlc3MgPSBfd2FsbGV0X2FkZHJlc3M7CiAgICAgICAgd2hpdGVsaXN0ZXJfYWRkcmVzcyA9IF93aGl0ZWxpc3Rlcl9hZGRyZXNzOwoKICAgICAgICBvd25lcl9hZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQ7CiAgICAgICAgY2hhbmdlU2V0dGluZ3MoX3ByaWNlX3N0YXJ0LCBfcHJpY2VfY29uc3RhbnQsIF9wcmljZV9leHBvbmVudCk7CiAgICAgICAgRGVwbG95ZWQoX3ByaWNlX3N0YXJ0LCBfcHJpY2VfY29uc3RhbnQsIF9wcmljZV9leHBvbmVudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBjb250cmFjdCwgd2hpY2ggY2FsbHMgYmlkKCkgaWYgdGhlIGF1Y3Rpb24gaGFzIHN0YXJ0ZWQuCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkgewogICAgICAgIGJpZCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBgX3Rva2VuX2FkZHJlc3NgIGFzIHRoZSB0b2tlbiBhZGRyZXNzIHRvIGJlIHVzZWQgaW4gdGhlIGF1Y3Rpb24uCiAgICAvLy8gQGRldiBTZXR1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0cyBhZGRyZXNzZXMuCiAgICAvLy8gQHBhcmFtIF90b2tlbl9hZGRyZXNzIFRva2VuIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIF90b2tlbl9hZGRyZXNzKSBwdWJsaWMgaXNPd25lciBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQpIHsKICAgICAgICByZXF1aXJlKF90b2tlbl9hZGRyZXNzICE9IDB4MCk7CiAgICAgICAgdG9rZW4gPSBSYWlkZW5Ub2tlbihfdG9rZW5fYWRkcmVzcyk7CgogICAgICAgIC8vIEdldCBudW1iZXIgb2YgUmVpIChSRE4gKiB0b2tlbl9tdWx0aXBsaWVyKSB0byBiZSBhdWN0aW9uZWQgZnJvbSB0b2tlbiBhdWN0aW9uIGJhbGFuY2UKICAgICAgICBudW1fdG9rZW5zX2F1Y3Rpb25lZCA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBudW1iZXIgb2YgdGhlIHRva2VuIG11bHRpcGxpZXIgZm9yIGl0cyBkZWNpbWFscwogICAgICAgIHRva2VuX211bHRpcGxpZXIgPSAxMCAqKiB1aW50KHRva2VuLmRlY2ltYWxzKCkpOwoKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uU2V0VXA7CiAgICAgICAgU2V0dXAoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYF9wcmljZV9zdGFydGAsIGBfcHJpY2VfY29uc3RhbnRgIGFuZCBgX3ByaWNlX2V4cG9uZW50YCBhcwogICAgLy8vIHRoZSBuZXcgc3RhcnRpbmcgcHJpY2UsIHByaWNlIGRpdmlzb3IgY29uc3RhbnQgYW5kIHByaWNlIGRpdmlzb3IgZXhwb25lbnQuCiAgICAvLy8gQGRldiBDaGFuZ2VzIGF1Y3Rpb24gcHJpY2UgZnVuY3Rpb24gcGFyYW1ldGVycyBiZWZvcmUgYXVjdGlvbiBpcyBzdGFydGVkLgogICAgLy8vIEBwYXJhbSBfcHJpY2Vfc3RhcnQgVXBkYXRlZCBzdGFydCBwcmljZS4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX2NvbnN0YW50IFVwZGF0ZWQgcHJpY2UgZGl2aXNvciBjb25zdGFudC4KICAgIC8vLyBAcGFyYW0gX3ByaWNlX2V4cG9uZW50IFVwZGF0ZWQgcHJpY2UgZGl2aXNvciBleHBvbmVudC4KICAgIGZ1bmN0aW9uIGNoYW5nZVNldHRpbmdzKAogICAgICAgIHVpbnQgX3ByaWNlX3N0YXJ0LAogICAgICAgIHVpbnQgX3ByaWNlX2NvbnN0YW50LAogICAgICAgIHVpbnQzMiBfcHJpY2VfZXhwb25lbnQpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKHN0YWdlID09IFN0YWdlcy5BdWN0aW9uRGVwbG95ZWQgfHwgc3RhZ2UgPT0gU3RhZ2VzLkF1Y3Rpb25TZXRVcCk7CiAgICAgICAgcmVxdWlyZShfcHJpY2Vfc3RhcnQgPiAwKTsKICAgICAgICByZXF1aXJlKF9wcmljZV9jb25zdGFudCA+IDApOwoKICAgICAgICBwcmljZV9zdGFydCA9IF9wcmljZV9zdGFydDsKICAgICAgICBwcmljZV9jb25zdGFudCA9IF9wcmljZV9jb25zdGFudDsKICAgICAgICBwcmljZV9leHBvbmVudCA9IF9wcmljZV9leHBvbmVudDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBZGRzIGFjY291bnQgYWRkcmVzc2VzIHRvIHdoaXRlbGlzdC4KICAgIC8vLyBAZGV2IEFkZHMgYWNjb3VudCBhZGRyZXNzZXMgdG8gd2hpdGVsaXN0LgogICAgLy8vIEBwYXJhbSBfYmlkZGVyX2FkZHJlc3NlcyBBcnJheSBvZiBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBhZGRUb1doaXRlbGlzdChhZGRyZXNzW10gX2JpZGRlcl9hZGRyZXNzZXMpIHB1YmxpYyBpc1doaXRlbGlzdGVyIHsKICAgICAgICBmb3IgKHVpbnQzMiBpID0gMDsgaSA8IF9iaWRkZXJfYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdFtfYmlkZGVyX2FkZHJlc3Nlc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZW1vdmVzIGFjY291bnQgYWRkcmVzc2VzIGZyb20gd2hpdGVsaXN0LgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhY2NvdW50IGFkZHJlc3NlcyBmcm9tIHdoaXRlbGlzdC4KICAgIC8vLyBAcGFyYW0gX2JpZGRlcl9hZGRyZXNzZXMgQXJyYXkgb2YgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gcmVtb3ZlRnJvbVdoaXRlbGlzdChhZGRyZXNzW10gX2JpZGRlcl9hZGRyZXNzZXMpIHB1YmxpYyBpc1doaXRlbGlzdGVyIHsKICAgICAgICBmb3IgKHVpbnQzMiBpID0gMDsgaSA8IF9iaWRkZXJfYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdFtfYmlkZGVyX2FkZHJlc3Nlc1tpXV0gPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgU3RhcnQgdGhlIGF1Y3Rpb24uCiAgICAvLy8gQGRldiBTdGFydHMgYXVjdGlvbiBhbmQgc2V0cyBzdGFydF90aW1lLgogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9uKCkgcHVibGljIGlzT3duZXIgYXRTdGFnZShTdGFnZXMuQXVjdGlvblNldFVwKSB7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuQXVjdGlvblN0YXJ0ZWQ7CiAgICAgICAgc3RhcnRfdGltZSA9IG5vdzsKICAgICAgICBzdGFydF9ibG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBBdWN0aW9uU3RhcnRlZChzdGFydF90aW1lLCBzdGFydF9ibG9jayk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRmluYWxpemUgdGhlIGF1Y3Rpb24gLSBzZXRzIHRoZSBmaW5hbCBSRE4gdG9rZW4gcHJpY2UgYW5kIGNoYW5nZXMgdGhlIGF1Y3Rpb24KICAgIC8vLyBzdGFnZSBhZnRlciBubyBiaWRzIGFyZSBhbGxvd2VkIGFueW1vcmUuCiAgICAvLy8gQGRldiBGaW5hbGl6ZSBhdWN0aW9uIGFuZCBzZXQgdGhlIGZpbmFsIFJETiB0b2tlbiBwcmljZS4KICAgIGZ1bmN0aW9uIGZpbmFsaXplQXVjdGlvbigpIHB1YmxpYyBhdFN0YWdlKFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkKICAgIHsKICAgICAgICAvLyBNaXNzaW5nIGZ1bmRzIHNob3VsZCBiZSAwIGF0IHRoaXMgcG9pbnQKICAgICAgICB1aW50IG1pc3NpbmdfZnVuZHMgPSBtaXNzaW5nRnVuZHNUb0VuZEF1Y3Rpb24oKTsKICAgICAgICByZXF1aXJlKG1pc3NpbmdfZnVuZHMgPT0gMCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZmluYWwgcHJpY2UgPSBXRUkgLyBSRE4gPSBXRUkgLyAoUmVpIC8gdG9rZW5fbXVsdGlwbGllcikKICAgICAgICAvLyBSZW1pbmRlcjogbnVtX3Rva2Vuc19hdWN0aW9uZWQgaXMgdGhlIG51bWJlciBvZiBSZWkgKFJETiAqIHRva2VuX211bHRpcGxpZXIpIHRoYXQgYXJlIGF1Y3Rpb25lZAogICAgICAgIGZpbmFsX3ByaWNlID0gdG9rZW5fbXVsdGlwbGllciAqIHJlY2VpdmVkX3dlaSAvIG51bV90b2tlbnNfYXVjdGlvbmVkOwoKICAgICAgICBlbmRfdGltZSA9IG5vdzsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5BdWN0aW9uRW5kZWQ7CiAgICAgICAgQXVjdGlvbkVuZGVkKGZpbmFsX3ByaWNlKTsKCiAgICAgICAgYXNzZXJ0KGZpbmFsX3ByaWNlID4gMCk7CiAgICB9CgogICAgLy8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBBdWN0aW9uIEZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0KCgogICAgLy8vIEBub3RpY2UgU2VuZCBgbXNnLnZhbHVlYCBXRUkgdG8gdGhlIGF1Y3Rpb24gZnJvbSB0aGUgYG1zZy5zZW5kZXJgIGFjY291bnQuCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gc2VuZCBhIGJpZCB0byB0aGUgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGJpZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25TdGFydGVkKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShiaWRzW21zZy5zZW5kZXJdICsgbXNnLnZhbHVlIDw9IGJpZF90aHJlc2hvbGQgfHwgd2hpdGVsaXN0W21zZy5zZW5kZXJdKTsKICAgICAgICBhc3NlcnQoYmlkc1ttc2cuc2VuZGVyXSArIG1zZy52YWx1ZSA+PSBtc2cudmFsdWUpOwoKICAgICAgICAvLyBNaXNzaW5nIGZ1bmRzIHdpdGhvdXQgdGhlIGN1cnJlbnQgYmlkIHZhbHVlCiAgICAgICAgdWludCBtaXNzaW5nX2Z1bmRzID0gbWlzc2luZ0Z1bmRzVG9FbmRBdWN0aW9uKCk7CgogICAgICAgIC8vIFdlIHJlcXVpcmUgYmlkIHZhbHVlcyB0byBiZSBsZXNzIHRoYW4gdGhlIGZ1bmRzIG1pc3NpbmcgdG8gZW5kIHRoZSBhdWN0aW9uCiAgICAgICAgLy8gYXQgdGhlIGN1cnJlbnQgcHJpY2UuCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPD0gbWlzc2luZ19mdW5kcyk7CgogICAgICAgIGJpZHNbbXNnLnNlbmRlcl0gKz0gbXNnLnZhbHVlOwogICAgICAgIHJlY2VpdmVkX3dlaSArPSBtc2cudmFsdWU7CgogICAgICAgIC8vIFNlbmQgYmlkIGFtb3VudCB0byB3YWxsZXQKICAgICAgICB3YWxsZXRfYWRkcmVzcy50cmFuc2Zlcihtc2cudmFsdWUpOwoKICAgICAgICBCaWRTdWJtaXNzaW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgbWlzc2luZ19mdW5kcyk7CgogICAgICAgIGFzc2VydChyZWNlaXZlZF93ZWkgPj0gbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDbGFpbSBhdWN0aW9uIHRva2VucyBmb3IgYG1zZy5zZW5kZXJgIGFmdGVyIHRoZSBhdWN0aW9uIGhhcyBlbmRlZC4KICAgIC8vLyBAZGV2IENsYWltcyB0b2tlbnMgZm9yIGBtc2cuc2VuZGVyYCBhZnRlciBhdWN0aW9uLiBUbyBiZSB1c2VkIGlmIHRva2VucyBjYW4KICAgIC8vLyBiZSBjbGFpbWVkIGJ5IGJlbmVmaWNpYXJpZXMsIGluZGl2aWR1YWxseS4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKCkgcHVibGljIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25FbmRlZCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBwcm94eUNsYWltVG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENsYWltIGF1Y3Rpb24gdG9rZW5zIGZvciBgcmVjZWl2ZXJfYWRkcmVzc2AgYWZ0ZXIgdGhlIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBkZXYgQ2xhaW1zIHRva2VucyBmb3IgYHJlY2VpdmVyX2FkZHJlc3NgIGFmdGVyIGF1Y3Rpb24gaGFzIGVuZGVkLgogICAgLy8vIEBwYXJhbSByZWNlaXZlcl9hZGRyZXNzIFRva2VucyB3aWxsIGJlIGFzc2lnbmVkIHRvIHRoaXMgYWRkcmVzcyBpZiBlbGlnaWJsZS4KICAgIGZ1bmN0aW9uIHByb3h5Q2xhaW1Ub2tlbnMoYWRkcmVzcyByZWNlaXZlcl9hZGRyZXNzKQogICAgICAgIHB1YmxpYwogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkF1Y3Rpb25FbmRlZCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIFdhaXRpbmcgcGVyaW9kIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGF1Y3Rpb24sIGJlZm9yZSBhbnlvbmUgY2FuIGNsYWltIHRva2VucwogICAgICAgIC8vIEVuc3VyZXMgZW5vdWdoIHRpbWUgdG8gY2hlY2sgaWYgYXVjdGlvbiB3YXMgZmluYWxpemVkIGNvcnJlY3RseQogICAgICAgIC8vIGJlZm9yZSB1c2VycyBzdGFydCB0cmFuc2FjdGluZyB0b2tlbnMKICAgICAgICByZXF1aXJlKG5vdyA+IGVuZF90aW1lICsgdG9rZW5fY2xhaW1fd2FpdGluZ19wZXJpb2QpOwogICAgICAgIHJlcXVpcmUocmVjZWl2ZXJfYWRkcmVzcyAhPSAweDApOwoKICAgICAgICBpZiAoYmlkc1tyZWNlaXZlcl9hZGRyZXNzXSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIE51bWJlciBvZiBSZWkgPSBiaWRfd2VpIC8gUmVpID0gYmlkX3dlaSAvICh3ZWlfcGVyX1JETiAqIHRva2VuX211bHRpcGxpZXIpCiAgICAgICAgdWludCBudW0gPSAodG9rZW5fbXVsdGlwbGllciAqIGJpZHNbcmVjZWl2ZXJfYWRkcmVzc10pIC8gZmluYWxfcHJpY2U7CgogICAgICAgIC8vIER1ZSB0byBmaW5hbF9wcmljZSBmbG9vciByb3VuZGluZywgdGhlIG51bWJlciBvZiBhc3NpZ25lZCB0b2tlbnMgbWF5IGJlIGhpZ2hlcgogICAgICAgIC8vIHRoYW4gZXhwZWN0ZWQuIFRoZXJlZm9yZSwgdGhlIG51bWJlciBvZiByZW1haW5pbmcgdW5hc3NpZ25lZCBhdWN0aW9uIHRva2VucwogICAgICAgIC8vIG1heSBiZSBzbWFsbGVyIHRoYW4gdGhlIG51bWJlciBvZiB0b2tlbnMgbmVlZGVkIGZvciB0aGUgbGFzdCBjbGFpbVRva2VucyBjYWxsCiAgICAgICAgdWludCBhdWN0aW9uX3Rva2Vuc19iYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIGlmIChudW0gPiBhdWN0aW9uX3Rva2Vuc19iYWxhbmNlKSB7CiAgICAgICAgICAgIG51bSA9IGF1Y3Rpb25fdG9rZW5zX2JhbGFuY2U7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiBmdW5kcyBmb3Igd2hpY2ggdG9rZW5zIGhhdmUgYmVlbiBjbGFpbWVkCiAgICAgICAgZnVuZHNfY2xhaW1lZCArPSBiaWRzW3JlY2VpdmVyX2FkZHJlc3NdOwoKICAgICAgICAvLyBTZXQgcmVjZWl2ZXIgYmlkIHRvIDAgYmVmb3JlIGFzc2lnbmluZyB0b2tlbnMKICAgICAgICBiaWRzW3JlY2VpdmVyX2FkZHJlc3NdID0gMDsKCiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihyZWNlaXZlcl9hZGRyZXNzLCBudW0pKTsKCiAgICAgICAgQ2xhaW1lZFRva2VucyhyZWNlaXZlcl9hZGRyZXNzLCBudW0pOwoKICAgICAgICAvLyBBZnRlciB0aGUgbGFzdCB0b2tlbnMgYXJlIGNsYWltZWQsIHdlIGNoYW5nZSB0aGUgYXVjdGlvbiBzdGFnZQogICAgICAgIC8vIER1ZSB0byB0aGUgYWJvdmUgbG9naWMsIHJvdW5kaW5nIGVycm9ycyB3aWxsIG5vdCBiZSBhbiBpc3N1ZQogICAgICAgIGlmIChmdW5kc19jbGFpbWVkID09IHJlY2VpdmVkX3dlaSkgewogICAgICAgICAgICBzdGFnZSA9IFN0YWdlcy5Ub2tlbnNEaXN0cmlidXRlZDsKICAgICAgICAgICAgVG9rZW5zRGlzdHJpYnV0ZWQoKTsKICAgICAgICB9CgogICAgICAgIGFzc2VydCh0b2tlbi5iYWxhbmNlT2YocmVjZWl2ZXJfYWRkcmVzcykgPj0gbnVtKTsKICAgICAgICBhc3NlcnQoYmlkc1tyZWNlaXZlcl9hZGRyZXNzXSA9PSAwKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIFJETiBwcmljZSBpbiBXRUkgZHVyaW5nIHRoZSBhdWN0aW9uLCBhdCB0aGUgdGltZSBvZgogICAgLy8vIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4gUmV0dXJucyBgMGAgaWYgYXVjdGlvbiBoYXMgZW5kZWQuCiAgICAvLy8gUmV0dXJucyBgcHJpY2Vfc3RhcnRgIGJlZm9yZSBhdWN0aW9uIGhhcyBzdGFydGVkLgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgY3VycmVudCBSRE4gdG9rZW4gcHJpY2UgaW4gV0VJLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBXRUkgcGVyIFJETiAodG9rZW5fbXVsdGlwbGllciAqIFJlaSkuCiAgICBmdW5jdGlvbiBwcmljZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5BdWN0aW9uRW5kZWQgfHwKICAgICAgICAgICAgc3RhZ2UgPT0gU3RhZ2VzLlRva2Vuc0Rpc3RyaWJ1dGVkKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsY1Rva2VuUHJpY2UoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIG1pc3NpbmcgZnVuZHMgbmVlZGVkIHRvIGVuZCB0aGUgYXVjdGlvbiwKICAgIC8vLyBjYWxjdWxhdGVkIGF0IHRoZSBjdXJyZW50IFJETiBwcmljZSBpbiBXRUkuCiAgICAvLy8gQGRldiBUaGUgbWlzc2luZyBmdW5kcyBhbW91bnQgbmVjZXNzYXJ5IHRvIGVuZCB0aGUgYXVjdGlvbiBhdCB0aGUgY3VycmVudCBSRE4gcHJpY2UgaW4gV0VJLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0aGUgbWlzc2luZyBmdW5kcyBhbW91bnQgaW4gV0VJLgogICAgZnVuY3Rpb24gbWlzc2luZ0Z1bmRzVG9FbmRBdWN0aW9uKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gbnVtX3Rva2Vuc19hdWN0aW9uZWQgPSB0b3RhbCBudW1iZXIgb2YgUmVpIChSRE4gKiB0b2tlbl9tdWx0aXBsaWVyKSB0aGF0IGlzIGF1Y3Rpb25lZAogICAgICAgIHVpbnQgcmVxdWlyZWRfd2VpX2F0X3ByaWNlID0gbnVtX3Rva2Vuc19hdWN0aW9uZWQgKiBwcmljZSgpIC8gdG9rZW5fbXVsdGlwbGllcjsKICAgICAgICBpZiAocmVxdWlyZWRfd2VpX2F0X3ByaWNlIDw9IHJlY2VpdmVkX3dlaSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIGFzc2VydChyZXF1aXJlZF93ZWlfYXRfcHJpY2UgLSByZWNlaXZlZF93ZWkgPiAwKTsKICAgICAgICByZXR1cm4gcmVxdWlyZWRfd2VpX2F0X3ByaWNlIC0gcmVjZWl2ZWRfd2VpOwogICAgfQoKICAgIC8qCiAgICAgKiAgUHJpdmF0ZSBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIHRva2VuIHByaWNlIChXRUkgLyBSRE4pIGF0IHRoZSBjdXJyZW50IHRpbWVzdGFtcAogICAgLy8vIGR1cmluZyB0aGUgYXVjdGlvbjsgZWxhcHNlZCB0aW1lID0gMCBiZWZvcmUgYXVjdGlvbiBzdGFydHMuCiAgICAvLy8gQmFzZWQgb24gdGhlIHByb3ZpZGVkIHBhcmFtZXRlcnMsIHRoZSBwcmljZSBkb2VzIG5vdCBjaGFuZ2UgaW4gdGhlIGZpcnN0CiAgICAvLy8gYHByaWNlX2NvbnN0YW50XigxL3ByaWNlX2V4cG9uZW50KWAgc2Vjb25kcyBkdWUgdG8gcm91bmRpbmcuCiAgICAvLy8gUm91bmRpbmcgaW4gYGRlY2F5X3JhdGVgIGFsc28gcHJvZHVjZXMgdmFsdWVzIHRoYXQgaW5jcmVhc2UgaW5zdGVhZCBvZiBkZWNyZWFzZQogICAgLy8vIGluIHRoZSBiZWdpbm5pbmc7IHRoZXNlIHNwaWtlcyBkZWNyZWFzZSBvdmVyIHRpbWUgYW5kIGFyZSBub3RpY2VhYmxlCiAgICAvLy8gb25seSBpbiBmaXJzdCBob3Vycy4gVGhpcyBzaG91bGQgYmUgY2FsY3VsYXRlZCBiZWZvcmUgdXNhZ2UuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSB0b2tlbiBwcmljZSAtIFdlaSBwZXIgUkROLgogICAgZnVuY3Rpb24gY2FsY1Rva2VuUHJpY2UoKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGVsYXBzZWQ7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5BdWN0aW9uU3RhcnRlZCkgewogICAgICAgICAgICBlbGFwc2VkID0gbm93IC0gc3RhcnRfdGltZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgZGVjYXlfcmF0ZSA9IGVsYXBzZWQgKiogcHJpY2VfZXhwb25lbnQgLyBwcmljZV9jb25zdGFudDsKICAgICAgICByZXR1cm4gcHJpY2Vfc3RhcnQgKiAoMSArIGVsYXBzZWQpIC8gKDEgKyBlbGFwc2VkICsgZGVjYXlfcmF0ZSk7CiAgICB9Cn0='.
	

]
