Class {
	#name : #SRT63a2442e4ad6c1c3c9c7e32021c2db37b8b34a25,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT63a2442e4ad6c1c3c9c7e32021c2db37b8b34a25 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBEU01hdGggewogICAgZnVuY3Rpb24gYWRkKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoKHogPSB4ICsgeSkgPj0geCk7CiAgICB9CiAgICBmdW5jdGlvbiBzdWIodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KICAgIGZ1bmN0aW9uIG11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKHkgPT0gMCB8fCAoeiA9IHggKiB5KSAvIHkgPT0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIG1heCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBpbWluKGludCB4LCBpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltYXgoaW50IHgsIGludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIHVpbnQgY29uc3RhbnQgV0FEID0gMTAgKiogMTg7CiAgICB1aW50IGNvbnN0YW50IFJBWSA9IDEwICoqIDI3OwoKICAgIGZ1bmN0aW9uIHdtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgeSksIFdBRCAvIDIpIC8gV0FEOwogICAgfQogICAgZnVuY3Rpb24gcm11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCB5KSwgUkFZIC8gMikgLyBSQVk7CiAgICB9CiAgICBmdW5jdGlvbiB3ZGl2KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIFdBRCksIHkgLyAyKSAvIHk7CiAgICB9CiAgICBmdW5jdGlvbiByZGl2KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIFJBWSksIHkgLyAyKSAvIHk7CiAgICB9CgogICAgLy8gVGhpcyBmYW1vdXMgYWxnb3JpdGhtIGlzIGNhbGxlZCAiZXhwb25lbnRpYXRpb24gYnkgc3F1YXJpbmciCiAgICAvLyBhbmQgY2FsY3VsYXRlcyB4Xm4gd2l0aCB4IGFzIGZpeGVkLXBvaW50IGFuZCBuIGFzIHJlZ3VsYXIgdW5zaWduZWQuCiAgICAvLwogICAgLy8gSXQncyBPKGxvZyBuKSwgaW5zdGVhZCBvZiBPKG4pIGZvciBuYWl2ZSByZXBlYXRlZCBtdWx0aXBsaWNhdGlvbi4KICAgIC8vCiAgICAvLyBUaGVzZSBmYWN0cyBhcmUgd2h5IGl0IHdvcmtzOgogICAgLy8KICAgIC8vICBJZiBuIGlzIGV2ZW4sIHRoZW4geF5uID0gKHheMileKG4vMikuCiAgICAvLyAgSWYgbiBpcyBvZGQsICB0aGVuIHhebiA9IHggKiB4XihuLTEpLAogICAgLy8gICBhbmQgYXBwbHlpbmcgdGhlIGVxdWF0aW9uIGZvciBldmVuIHggZ2l2ZXMKICAgIC8vICAgIHhebiA9IHggKiAoeF4yKV4oKG4tMSkgLyAyKS4KICAgIC8vCiAgICAvLyAgQWxzbywgRVZNIGRpdmlzaW9uIGlzIGZsb29yaW5nIGFuZAogICAgLy8gICAgZmxvb3JbKG4tMSkgLyAyXSA9IGZsb29yW24gLyAyXS4KICAgIC8vCiAgICBmdW5jdGlvbiBycG93KHVpbnQgeCwgdWludCBuKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBuICUgMiAhPSAwID8geCA6IFJBWTsKCiAgICAgICAgZm9yIChuIC89IDI7IG4gIT0gMDsgbiAvPSAyKSB7CiAgICAgICAgICAgIHggPSBybXVsKHgsIHgpOwoKICAgICAgICAgICAgaWYgKG4gJSAyICE9IDApIHsKICAgICAgICAgICAgICAgIHogPSBybXVsKHosIHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBXRVRIOV8gewogICAgc3RyaW5nIHB1YmxpYyBuYW1lICAgICA9ICJXcmFwcGVkIEV0aGVyIjsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sICAgPSAiV0VUSCI7CiAgICB1aW50OCAgcHVibGljIGRlY2ltYWxzID0gMTg7CgogICAgZXZlbnQgIEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBzcmMsIGFkZHJlc3MgaW5kZXhlZCBndXksIHVpbnQgd2FkKTsKICAgIGV2ZW50ICBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZHN0LCB1aW50IHdhZCk7CiAgICBldmVudCAgRGVwb3NpdChhZGRyZXNzIGluZGV4ZWQgZHN0LCB1aW50IHdhZCk7CiAgICBldmVudCAgV2l0aGRyYXdhbChhZGRyZXNzIGluZGV4ZWQgc3JjLCB1aW50IHdhZCk7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSAgICAgICAgICAgICAgICAgICAgICAgcHVibGljICBiYWxhbmNlT2Y7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpICBwdWJsaWMgIGFsbG93YW5jZTsKCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBkZXBvc2l0KCk7CiAgICB9CiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcHVibGljIHBheWFibGUgewogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSArPSBtc2cudmFsdWU7CiAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCB3YWQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPj0gd2FkKTsKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gLT0gd2FkOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIod2FkKTsKICAgICAgICBXaXRoZHJhd2FsKG1zZy5zZW5kZXIsIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgZ3V5LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bZ3V5XSA9IHdhZDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBndXksIHdhZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cmFuc2ZlckZyb20obXNnLnNlbmRlciwgZHN0LCB3YWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2Zbc3JjXSA+PSB3YWQpOwoKICAgICAgICBpZiAoc3JjICE9IG1zZy5zZW5kZXIgJiYgYWxsb3dhbmNlW3NyY11bbXNnLnNlbmRlcl0gIT0gdWludCgtMSkpIHsKICAgICAgICAgICAgcmVxdWlyZShhbGxvd2FuY2Vbc3JjXVttc2cuc2VuZGVyXSA+PSB3YWQpOwogICAgICAgICAgICBhbGxvd2FuY2Vbc3JjXVttc2cuc2VuZGVyXSAtPSB3YWQ7CiAgICAgICAgfQoKICAgICAgICBiYWxhbmNlT2Zbc3JjXSAtPSB3YWQ7CiAgICAgICAgYmFsYW5jZU9mW2RzdF0gKz0gd2FkOwoKICAgICAgICBUcmFuc2ZlcihzcmMsIGRzdCwgd2FkKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmludGVyZmFjZSBGdW5kSW50ZXJmYWNlIHsKCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBQb3J0Zm9saW9Db250ZW50KHVpbnQgaG9sZGluZ3MsIHVpbnQgcHJpY2UsIHVpbnQgZGVjaW1hbHMpOwogICAgZXZlbnQgUmVxdWVzdFVwZGF0ZWQodWludCBpZCk7CiAgICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGluZGV4ZWQgb2ZQYXJ0aWNpcGFudCwgdWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5KTsKICAgIGV2ZW50IFJlZGVlbWVkKGFkZHJlc3MgaW5kZXhlZCBvZlBhcnRpY2lwYW50LCB1aW50IGF0VGltZXN0YW1wLCB1aW50IHNoYXJlUXVhbnRpdHkpOwogICAgZXZlbnQgU3BlbmRpbmdBcHByb3ZlZChhZGRyZXNzIG9uQ29uc2lnbmVkLCBhZGRyZXNzIG9mQXNzZXQsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IEZlZXNDb252ZXJ0ZWQodWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5Q29udmVydGVkLCB1aW50IHVuY2xhaW1lZCk7CiAgICBldmVudCBDYWxjdWxhdGlvblVwZGF0ZSh1aW50IGF0VGltZXN0YW1wLCB1aW50IG1hbmFnZW1lbnRGZWUsIHVpbnQgcGVyZm9ybWFuY2VGZWUsIHVpbnQgbmF2LCB1aW50IHNoYXJlUHJpY2UsIHVpbnQgdG90YWxTdXBwbHkpOwogICAgZXZlbnQgT3JkZXJVcGRhdGVkKHVpbnQgaWQpOwogICAgZXZlbnQgTG9nRXJyb3IodWludCBFUlJPUl9DT0RFKTsKICAgIGV2ZW50IEVycm9yTWVzc2FnZShzdHJpbmcgZXJyb3JNZXNzYWdlKTsKCiAgICAvLyBFWFRFUk5BTCBNRVRIT0RTCiAgICAvLyBDb21wbGlhbmNlIGJ5IEludmVzdG9yCiAgICBmdW5jdGlvbiByZXF1ZXN0SW52ZXN0bWVudCh1aW50IGdpdmVRdWFudGl0eSwgdWludCBzaGFyZVF1YW50aXR5LCBib29sIGlzTmF0aXZlQXNzZXQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmVxdWVzdFJlZGVtcHRpb24odWludCBzaGFyZVF1YW50aXR5LCB1aW50IHJlY2VpdmVRdWFudGl0eSwgYm9vbCBpc05hdGl2ZUFzc2V0KSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGV4ZWN1dGVSZXF1ZXN0KHVpbnQgcmVxdWVzdElkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGNhbmNlbFJlcXVlc3QodWludCByZXF1ZXN0SWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmVkZWVtQWxsT3duZWRBc3NldHModWludCBzaGFyZVF1YW50aXR5KSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIC8vIEFkbWluaXN0cmF0aW9uIGJ5IE1hbmFnZXIKICAgIGZ1bmN0aW9uIGVuYWJsZUludmVzdG1lbnQoKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGRpc2FibGVJbnZlc3RtZW50KCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBlbmFibGVSZWRlbXB0aW9uKCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBkaXNhYmxlUmVkZW1wdGlvbigpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2h1dERvd24oKSBleHRlcm5hbDsKICAgIC8vIE1hbmFnaW5nIGJ5IE1hbmFnZXIKICAgIGZ1bmN0aW9uIG1ha2VPcmRlcih1aW50IGV4Y2hhbmdlSWQsIGFkZHJlc3Mgc2VsbEFzc2V0LCBhZGRyZXNzIGJ1eUFzc2V0LCB1aW50IHNlbGxRdWFudGl0eSwgdWludCBidXlRdWFudGl0eSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0YWtlT3JkZXIodWludCBleGNoYW5nZUlkLCB1aW50IGlkLCB1aW50IHF1YW50aXR5KSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGNhbmNlbE9yZGVyKHVpbnQgZXhjaGFuZ2VJZCwgdWludCBpZCkgZXh0ZXJuYWw7CgogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIGVtZXJnZW5jeVJlZGVlbSh1aW50IHNoYXJlUXVhbnRpdHksIGFkZHJlc3NbXSByZXF1ZXN0ZWRBc3NldHMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgLy8gRmVlcyBieSBNYW5hZ2VyCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVVuY2xhaW1lZEZlZXMoKTsKCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCiAgICAvLyBHZXQgZ2VuZXJhbCBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0TW9kdWxlcygpIHZpZXcgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRMYXN0T3JkZXJJZCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRMYXN0UmVxdWVzdElkKCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldE5hbWVIYXNoKCkgdmlldyByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGdldE1hbmFnZXIoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICAgIC8vIEdldCBhY2NvdW50aW5nIGluZm9ybWF0aW9uCiAgICBmdW5jdGlvbiBwZXJmb3JtQ2FsY3VsYXRpb25zKCkgdmlldyByZXR1cm5zICh1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50KTsKICAgIGZ1bmN0aW9uIGNhbGNTaGFyZVByaWNlKCkgdmlldyByZXR1cm5zICh1aW50KTsKfQoKaW50ZXJmYWNlIEFzc2V0SW50ZXJmYWNlIHsKICAgIC8qCiAgICAgKiBJbXBsZW1lbnRzIEVSQyAyMCBzdGFuZGFyZC4KICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvZjkwODY0YTNkMmIyYjQ1YzRkZWNmOTVlZmQyNmIzZjBjMjc2MDUxYS9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAgICAgKgogICAgICogIEFkZGVkIHN1cHBvcnQgZm9yIHRoZSBFUkMgMjIzICJ0b2tlbkZhbGxiYWNrIiBtZXRob2QgaW4gYSAidHJhbnNmZXIiIGZ1bmN0aW9uIHdpdGggYSBwYXlsb2FkLgogICAgICogIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMjMKICAgICAqLwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKCiAgICAvLyBUaGVyZSBpcyBubyBFUkMyMjMgY29tcGF0aWJsZSBUcmFuc2ZlciBldmVudCwgd2l0aCBgX2RhdGFgIGluY2x1ZGVkLgoKICAgIC8vRVJDIDIyMwogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vIEVSQyAyMAogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7Cn0KCmludGVyZmFjZSBFUkMyMjNJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKTsKfQoKY29udHJhY3QgQXNzZXQgaXMgRFNNYXRoLCBBc3NldEludGVyZmFjZSwgRVJDMjIzSW50ZXJmYWNlIHsKCiAgICAvLyBEQVRBIFNUUlVDVFVSRVMKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICAvKioKICAgICAqIEBub3RpY2UgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgICAqIEBkZXYgVHJhbnNmZXJzIHNlbmRlcidzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MKICAgICAqIEBkZXYgU2ltaWxhciB0byB0cmFuc2ZlcihhZGRyZXNzLCB1aW50LCBieXRlcyksIGJ1dCB3aXRob3V0IF9kYXRhIHBhcmFtZXRlcgogICAgICogQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGVtcHR5OwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5LgogICAgICAgICAgICBjb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKF90bykKICAgICAgICB9CiAKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7IC8vIHNhbml0eSBjaGVja3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAvLyBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAvLyAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgIC8vICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIC8vIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYCBhbmQgdHJpZ2dlciB0b2tlbkZhbGxiYWNrIGlmIHNlbmRlciBpcyBhIGNvbnRyYWN0CiAgICAgKiBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgICAqIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHBhcmFtIF9kYXRhIERhdGEgdG8gYmUgc2VudCB0byB0b2tlbkZhbGxiYWNrCiAgICAgKiBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7IC8vIHNhbml0eSBjaGVja3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAvLyBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAvLyAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgIC8vICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIC8vIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF92YWx1ZWAgdG9rZW5zIGZyb20gYF9mcm9tYCB0byBgX3RvYCBpZiBgbXNnLnNlbmRlcmAgaXMgYWxsb3dlZC4KICAgIC8vLyBAbm90aWNlIFJlc3RyaWN0aW9uOiBBbiBhY2NvdW50IGNhbiBvbmx5IHVzZSB0aGlzIGZ1bmN0aW9uIHRvIHNlbmQgdG8gaXRzZWxmCiAgICAvLy8gQGRldiBBbGxvd3MgZm9yIGFuIGFwcHJvdmVkIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZQogICAgLy8vIGFkZHJlc3MgdG8gYW5vdGhlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGFyZSB3aXRoZHJhd24uCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9mcm9tICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CiAgICAgICAgLy8gcmVxdWlyZShfdG8gPT0gbXNnLnNlbmRlcik7IC8vIGNhbiBvbmx5IHVzZSB0cmFuc2ZlckZyb20gdG8gc2VuZCB0byBzZWxmCgogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwoKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBgX3NwZW5kZXJgIHRvIHRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBtc2cuc2VuZGVyYCB0byBhbnkgYWRkcmVzcy4KICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSAweDApOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgLy8gcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIHRoYXQgYSBzcGVuZGVyIGNhbiB0cmFuc2ZlciBvbgogICAgLy8vIGJlaGFsZiBvZiBhIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyByZW1haW5pbmcgYWxsb3dhbmNlIGZvciBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgdGhlIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBiYWxhbmNlIG9mIG93bmVyLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKfQoKaW50ZXJmYWNlIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHsKCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBhbm90aGVyIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUcmFuc2FjdGlvbiBpbml0aWF0b3IsIGFuYWxvZ3VlIG9mIG1zZy5zZW5kZXIKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIF9kYXRhIERhdGEgY29udGFpbmluZyBhIGZ1bmN0aW9uIHNpZ25hdHVyZSBhbmQvb3IgcGFyYW1ldGVycwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQoKaW50ZXJmYWNlIE5hdGl2ZUFzc2V0SW50ZXJmYWNlIHsKCiAgICAvLyBQVUJMSUMgTUVUSE9EUwogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHB1YmxpYyBwYXlhYmxlOwogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCB3YWQpIHB1YmxpYzsKfQoKaW50ZXJmYWNlIFNoYXJlc0ludGVyZmFjZSB7CgogICAgZXZlbnQgQ3JlYXRlZChhZGRyZXNzIGluZGV4ZWQgb2ZQYXJ0aWNpcGFudCwgdWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5KTsKICAgIGV2ZW50IEFubmloaWxhdGVkKGFkZHJlc3MgaW5kZXhlZCBvZlBhcnRpY2lwYW50LCB1aW50IGF0VGltZXN0YW1wLCB1aW50IHNoYXJlUXVhbnRpdHkpOwoKICAgIC8vIFZJRVcgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGdldE5hbWUoKSB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICBmdW5jdGlvbiBnZXRTeW1ib2woKSB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICBmdW5jdGlvbiBnZXREZWNpbWFscygpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRDcmVhdGlvblRpbWUoKSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdG9TbWFsbGVzdFNoYXJlVW5pdCh1aW50IHF1YW50aXR5KSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdG9XaG9sZVNoYXJlVW5pdCh1aW50IHF1YW50aXR5KSB2aWV3IHJldHVybnMgKHVpbnQpOwoKfQoKY29udHJhY3QgU2hhcmVzIGlzIEFzc2V0LCBTaGFyZXNJbnRlcmZhY2UgewoKICAgIC8vIEZJRUxEUwoKICAgIC8vIENvbnN0cnVjdG9yIGZpZWxkcwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50IHB1YmxpYyBkZWNpbWFsOwogICAgdWludCBwdWJsaWMgY3JlYXRpb25UaW1lOwoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAcGFyYW0gX25hbWUgTmFtZSB0aGVzZSBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBTeW1ib2wgb2Ygc2hhcmVzCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsIEFtb3VudCBvZiBkZWNpbWFscyBzaGFyZVByaWNlIGlzIGRlbm9taW5hdGVkIGluLCBkZWZpbmVkIHRvIGJlIGVxdWFsIGFzIGRlY2lhbWxzIGluIFJFRkVSRU5DRV9BU1NFVCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY3JlYXRpb25UaW1lIFRpbWVzdGFtcCBvZiBzaGFyZSBjcmVhdGlvbgogICAgZnVuY3Rpb24gU2hhcmVzKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQgX2RlY2ltYWwsIHVpbnQgX2NyZWF0aW9uVGltZSkgewogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgICAgIGRlY2ltYWwgPSBfZGVjaW1hbDsKICAgICAgICBjcmVhdGlvblRpbWUgPSBfY3JlYXRpb25UaW1lOwogICAgfQoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgZnVuY3Rpb24gZ2V0TmFtZSgpIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7IHJldHVybiBuYW1lOyB9CiAgICBmdW5jdGlvbiBnZXRTeW1ib2woKSB2aWV3IHJldHVybnMgKHN0cmluZykgeyByZXR1cm4gc3ltYm9sOyB9CiAgICBmdW5jdGlvbiBnZXREZWNpbWFscygpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gZGVjaW1hbDsgfQogICAgZnVuY3Rpb24gZ2V0Q3JlYXRpb25UaW1lKCkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBjcmVhdGlvblRpbWU7IH0KICAgIGZ1bmN0aW9uIHRvU21hbGxlc3RTaGFyZVVuaXQodWludCBxdWFudGl0eSkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBtdWwocXVhbnRpdHksIDEwICoqIGdldERlY2ltYWxzKCkpOyB9CiAgICBmdW5jdGlvbiB0b1dob2xlU2hhcmVVbml0KHVpbnQgcXVhbnRpdHkpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gcXVhbnRpdHkgLyAoMTAgKiogZ2V0RGVjaW1hbHMoKSk7IH0KCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTCgogICAgLy8vIEBwYXJhbSByZWNpcGllbnQgQWRkcmVzcyB0aGUgbmV3IHNoYXJlcyBzaG91bGQgYmUgc2VudCB0bwogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IE51bWJlciBvZiBzaGFyZXMgdG8gYmUgY3JlYXRlZAogICAgZnVuY3Rpb24gY3JlYXRlU2hhcmVzKGFkZHJlc3MgcmVjaXBpZW50LCB1aW50IHNoYXJlUXVhbnRpdHkpIGludGVybmFsIHsKICAgICAgICB0b3RhbFN1cHBseSA9IGFkZCh0b3RhbFN1cHBseSwgc2hhcmVRdWFudGl0eSk7CiAgICAgICAgYmFsYW5jZXNbcmVjaXBpZW50XSA9IGFkZChiYWxhbmNlc1tyZWNpcGllbnRdLCBzaGFyZVF1YW50aXR5KTsKICAgICAgICBDcmVhdGVkKG1zZy5zZW5kZXIsIG5vdywgc2hhcmVRdWFudGl0eSk7CiAgICB9CgogICAgLy8vIEBwYXJhbSByZWNpcGllbnQgQWRkcmVzcyB0aGUgbmV3IHNoYXJlcyBzaG91bGQgYmUgdGFrZW4gZnJvbSB3aGVuIGRlc3Ryb3llZAogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IE51bWJlciBvZiBzaGFyZXMgdG8gYmUgYW5uaWhpbGF0ZWQKICAgIGZ1bmN0aW9uIGFubmloaWxhdGVTaGFyZXMoYWRkcmVzcyByZWNpcGllbnQsIHVpbnQgc2hhcmVRdWFudGl0eSkgaW50ZXJuYWwgewogICAgICAgIHRvdGFsU3VwcGx5ID0gc3ViKHRvdGFsU3VwcGx5LCBzaGFyZVF1YW50aXR5KTsKICAgICAgICBiYWxhbmNlc1tyZWNpcGllbnRdID0gc3ViKGJhbGFuY2VzW3JlY2lwaWVudF0sIHNoYXJlUXVhbnRpdHkpOwogICAgICAgIEFubmloaWxhdGVkKG1zZy5zZW5kZXIsIG5vdywgc2hhcmVRdWFudGl0eSk7CiAgICB9Cn0KCmNvbnRyYWN0IFJlc3RyaWN0ZWRTaGFyZXMgaXMgU2hhcmVzIHsKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAcGFyYW0gX25hbWUgTmFtZSB0aGVzZSBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBTeW1ib2wgb2Ygc2hhcmVzCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsIEFtb3VudCBvZiBkZWNpbWFscyBzaGFyZVByaWNlIGlzIGRlbm9taW5hdGVkIGluLCBkZWZpbmVkIHRvIGJlIGVxdWFsIGFzIGRlY2lhbWxzIGluIFJFRkVSRU5DRV9BU1NFVCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY3JlYXRpb25UaW1lIFRpbWVzdGFtcCBvZiBzaGFyZSBjcmVhdGlvbgogICAgZnVuY3Rpb24gUmVzdHJpY3RlZFNoYXJlcygKICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgICAgdWludCBfZGVjaW1hbCwKICAgICAgICB1aW50IF9jcmVhdGlvblRpbWUKICAgICkgU2hhcmVzKF9uYW1lLCBfc3ltYm9sLCBfZGVjaW1hbCwgX2NyZWF0aW9uVGltZSkge30KCiAgICAvLyBQVUJMSUMgTUVUSE9EUwoKICAgIC8qKgogICAgICogQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgICogQGRldiBUcmFuc2ZlcnMgc2VuZGVyJ3MgdG9rZW5zIHRvIGEgZ2l2ZW4gYWRkcmVzcwogICAgICogQGRldiBTaW1pbGFyIHRvIHRyYW5zZmVyKGFkZHJlc3MsIHVpbnQsIGJ5dGVzKSwgYnV0IHdpdGhvdXQgX2RhdGEgcGFyYW1ldGVyCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgICAqIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpIHx8IF90byA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGVtcHR5OwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5LgogICAgICAgICAgICBjb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKF90bykKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsgLy8gc2FuaXR5IGNoZWNrcwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgIGlmIChjb2RlTGVuZ3RoID4gMCkgewogICAgICAgICAgICBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0KF90byk7CiAgICAgICAgICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2sobXNnLnNlbmRlciwgX3ZhbHVlLCBlbXB0eSk7CiAgICAgICAgfQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBlbXB0eSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAbm90aWNlIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgIGFuZCB0cmlnZ2VyIHRva2VuRmFsbGJhY2sgaWYgc2VuZGVyIGlzIGEgY29udHJhY3QKICAgICAqIEBkZXYgRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIHVzZXIgb3IgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMKICAgICAqIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlcgogICAgICogQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKiBAcGFyYW0gX2RhdGEgRGF0YSB0byBiZSBzZW50IHRvIHRva2VuRmFsbGJhY2sKICAgICAqIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykgfHwgX3RvID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7IC8vIHNhbml0eSBjaGVja3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQWxsb3dzIGBfc3BlbmRlcmAgdG8gdHJhbnNmZXIgYF92YWx1ZWAgdG9rZW5zIGZyb20gYG1zZy5zZW5kZXJgIHRvIGFueSBhZGRyZXNzLgogICAgLy8vIEBkZXYgU2V0cyBhcHByb3ZlZCBhbW91bnQgb2YgdG9rZW5zIGZvciBzcGVuZGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgYWxsb3dlZCBhY2NvdW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIGFwcHJvdmVkIHRva2Vucy4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSAweDApOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgp9CgppbnRlcmZhY2UgQ29tcGxpYW5jZUludGVyZmFjZSB7CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB3aGV0aGVyIGludmVzdG1lbnQgaXMgcGVybWl0dGVkIGZvciBhIHBhcnRpY2lwYW50CiAgICAvLy8gQHBhcmFtIG9mUGFydGljaXBhbnQgQWRkcmVzcyByZXF1ZXN0aW5nIHRvIGludmVzdCBpbiBhIE1lbG9uIGZ1bmQKICAgIC8vLyBAcGFyYW0gZ2l2ZVF1YW50aXR5IFF1YW50aXR5IG9mIE1lbG9uIHRva2VuIHRpbWVzIDEwICoqIDE4IG9mZmVyZWQgdG8gcmVjZWl2ZSBzaGFyZVF1YW50aXR5CiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2hhcmVzIHRpbWVzIDEwICoqIDE4IHJlcXVlc3RlZCB0byBiZSByZWNlaXZlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciBpZGVudGl0eSBpcyBlbGlnaWJsZSB0byBpbnZlc3QgaW4gYSBNZWxvbiBmdW5kLgogICAgZnVuY3Rpb24gaXNJbnZlc3RtZW50UGVybWl0dGVkKAogICAgICAgIGFkZHJlc3Mgb2ZQYXJ0aWNpcGFudCwKICAgICAgICB1aW50MjU2IGdpdmVRdWFudGl0eSwKICAgICAgICB1aW50MjU2IHNoYXJlUXVhbnRpdHkKICAgICkgdmlldyByZXR1cm5zIChib29sKTsKCiAgICAvLy8gQG5vdGljZSBDaGVja3Mgd2hldGhlciByZWRlbXB0aW9uIGlzIHBlcm1pdHRlZCBmb3IgYSBwYXJ0aWNpcGFudAogICAgLy8vIEBwYXJhbSBvZlBhcnRpY2lwYW50IEFkZHJlc3MgcmVxdWVzdGluZyB0byByZWRlZW0gZnJvbSBhIE1lbG9uIGZ1bmQKICAgIC8vLyBAcGFyYW0gc2hhcmVRdWFudGl0eSBRdWFudGl0eSBvZiBzaGFyZXMgdGltZXMgMTAgKiogMTggb2ZmZXJlZCB0byByZWRlZW0KICAgIC8vLyBAcGFyYW0gcmVjZWl2ZVF1YW50aXR5IFF1YW50aXR5IG9mIE1lbG9uIHRva2VuIHRpbWVzIDEwICoqIDE4IHJlcXVlc3RlZCB0byByZWNlaXZlIGZvciBzaGFyZVF1YW50aXR5CiAgICAvLy8gQHJldHVybiBXaGV0aGVyIGlkZW50aXR5IGlzIGVsaWdpYmxlIHRvIHJlZGVlbSBmcm9tIGEgTWVsb24gZnVuZC4KICAgIGZ1bmN0aW9uIGlzUmVkZW1wdGlvblBlcm1pdHRlZCgKICAgICAgICBhZGRyZXNzIG9mUGFydGljaXBhbnQsCiAgICAgICAgdWludDI1NiBzaGFyZVF1YW50aXR5LAogICAgICAgIHVpbnQyNTYgcmVjZWl2ZVF1YW50aXR5CiAgICApIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IERCQyB7CgogICAgLy8gTU9ESUZJRVJTCgogICAgbW9kaWZpZXIgcHJlX2NvbmQoYm9vbCBjb25kaXRpb24pIHsKICAgICAgICByZXF1aXJlKGNvbmRpdGlvbik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBwb3N0X2NvbmQoYm9vbCBjb25kaXRpb24pIHsKICAgICAgICBfOwogICAgICAgIGFzc2VydChjb25kaXRpb24pOwogICAgfQoKICAgIG1vZGlmaWVyIGludmFyaWFudChib29sIGNvbmRpdGlvbikgewogICAgICAgIHJlcXVpcmUoY29uZGl0aW9uKTsKICAgICAgICBfOwogICAgICAgIGFzc2VydChjb25kaXRpb24pOwogICAgfQp9Cgpjb250cmFjdCBPd25lZCBpcyBEQkMgewoKICAgIC8vIEZJRUxEUwoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vIE5PTi1DT05TVEFOVCBNRVRIT0RTCgogICAgZnVuY3Rpb24gT3duZWQoKSB7IG93bmVyID0gbXNnLnNlbmRlcjsgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3Mgb2ZOZXdPd25lcikgcHJlX2NvbmQoaXNPd25lcigpKSB7IG93bmVyID0gb2ZOZXdPd25lcjsgfQoKICAgIC8vIFBSRSwgUE9TVCwgSU5WQVJJQU5UIENPTkRJVElPTlMKCiAgICBmdW5jdGlvbiBpc093bmVyKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgeyByZXR1cm4gbXNnLnNlbmRlciA9PSBvd25lcjsgfQoKfQoKY29udHJhY3QgRnVuZCBpcyBEU01hdGgsIERCQywgT3duZWQsIFJlc3RyaWN0ZWRTaGFyZXMsIEZ1bmRJbnRlcmZhY2UsIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHsKICAgIC8vIFRZUEVTCgogICAgc3RydWN0IE1vZHVsZXMgeyAvLyBEZXNjcmliZXMgYWxsIG1vZHVsYXIgcGFydHMsIHN0YW5kYXJkaXNlZCB0aHJvdWdoIGFuIGludGVyZmFjZQogICAgICAgIFByaWNlRmVlZEludGVyZmFjZSBwcmljZWZlZWQ7IC8vIFByb3ZpZGVzIGFsbCBleHRlcm5hbCBkYXRhCiAgICAgICAgQ29tcGxpYW5jZUludGVyZmFjZSBjb21wbGlhbmNlOyAvLyBCb29sZWFuIGZ1bmN0aW9ucyByZWdhcmRpbmcgaW52ZXN0L3JlZGVlbQogICAgICAgIFJpc2tNZ210SW50ZXJmYWNlIHJpc2ttZ210OyAvLyBCb29sZWFuIGZ1bmN0aW9ucyByZWdhcmRpbmcgbWFrZS90YWtlIG9yZGVycwogICAgfQoKICAgIHN0cnVjdCBDYWxjdWxhdGlvbnMgeyAvLyBMaXN0IG9mIGludGVybmFsIGNhbGN1bGF0aW9ucwogICAgICAgIHVpbnQgZ2F2OyAvLyBHcm9zcyBhc3NldCB2YWx1ZQogICAgICAgIHVpbnQgbWFuYWdlbWVudEZlZTsgLy8gVGltZSBiYXNlZCBmZWUKICAgICAgICB1aW50IHBlcmZvcm1hbmNlRmVlOyAvLyBQZXJmb3JtYW5jZSBiYXNlZCBmZWUgbWVhc3VyZWQgYWdhaW5zdCBRVU9URV9BU1NFVAogICAgICAgIHVpbnQgdW5jbGFpbWVkRmVlczsgLy8gRmVlcyBub3QgeWV0IGFsbG9jYXRlZCB0byB0aGUgZnVuZCBtYW5hZ2VyCiAgICAgICAgdWludCBuYXY7IC8vIE5ldCBhc3NldCB2YWx1ZQogICAgICAgIHVpbnQgaGlnaFdhdGVyTWFyazsgLy8gQSByZWNvcmQgb2YgYmVzdCBhbGwtdGltZSBmdW5kIHBlcmZvcm1hbmNlCiAgICAgICAgdWludCB0b3RhbFN1cHBseTsgLy8gVG90YWwgc3VwcGx5IG9mIHNoYXJlcwogICAgICAgIHVpbnQgdGltZXN0YW1wOyAvLyBUaW1lIHdoZW4gY2FsY3VsYXRpb25zIGFyZSBwZXJmb3JtZWQgaW4gc2Vjb25kcwogICAgfQoKICAgIGVudW0gUmVxdWVzdFN0YXR1cyB7IGFjdGl2ZSwgY2FuY2VsbGVkLCBleGVjdXRlZCB9CiAgICBlbnVtIFJlcXVlc3RUeXBlIHsgaW52ZXN0LCByZWRlZW0sIHRva2VuRmFsbGJhY2tSZWRlZW0gfQogICAgc3RydWN0IFJlcXVlc3QgeyAvLyBEZXNjcmliZXMgYW5kIGxvZ3Mgd2hlbmV2ZXIgYXNzZXQgZW50ZXIgYW5kIGxlYXZlIGZ1bmQgZHVlIHRvIFBhcnRpY2lwYW50cwogICAgICAgIGFkZHJlc3MgcGFydGljaXBhbnQ7IC8vIFBhcnRpY2lwYW50IGluIE1lbG9uIGZ1bmQgcmVxdWVzdGluZyBpbnZlc3RtZW50IG9yIHJlZGVtcHRpb24KICAgICAgICBSZXF1ZXN0U3RhdHVzIHN0YXR1czsgLy8gRW51bTogYWN0aXZlLCBjYW5jZWxsZWQsIGV4ZWN1dGVkOyBTdGF0dXMgb2YgcmVxdWVzdAogICAgICAgIFJlcXVlc3RUeXBlIHJlcXVlc3RUeXBlOyAvLyBFbnVtOiBpbnZlc3QsIHJlZGVlbSwgdG9rZW5GYWxsYmFja1JlZGVlbQogICAgICAgIGFkZHJlc3MgcmVxdWVzdEFzc2V0OyAvLyBBZGRyZXNzIG9mIHRoZSBhc3NldCBiZWluZyByZXF1ZXN0ZWQKICAgICAgICB1aW50IHNoYXJlUXVhbnRpdHk7IC8vIFF1YW50aXR5IG9mIE1lbG9uIGZ1bmQgc2hhcmVzCiAgICAgICAgdWludCBnaXZlUXVhbnRpdHk7IC8vIFF1YW50aXR5IGluIE1lbG9uIGFzc2V0IHRvIGdpdmUgdG8gTWVsb24gZnVuZCB0byByZWNlaXZlIHNoYXJlUXVhbnRpdHkKICAgICAgICB1aW50IHJlY2VpdmVRdWFudGl0eTsgLy8gUXVhbnRpdHkgaW4gTWVsb24gYXNzZXQgdG8gcmVjZWl2ZSBmcm9tIE1lbG9uIGZ1bmQgZm9yIGdpdmVuIHNoYXJlUXVhbnRpdHkKICAgICAgICB1aW50IHRpbWVzdGFtcDsgICAgIC8vIFRpbWUgb2YgcmVxdWVzdCBjcmVhdGlvbiBpbiBzZWNvbmRzCiAgICAgICAgdWludCBhdFVwZGF0ZUlkOyAgICAvLyBQcmljZWZlZWQgdXBkYXRlSWQgd2hlbiB0aGlzIHJlcXVlc3Qgd2FzIGNyZWF0ZWQKICAgIH0KCiAgICBlbnVtIE9yZGVyU3RhdHVzIHsgYWN0aXZlLCBwYXJ0aWFsbHlGaWxsZWQsIGZ1bGx5RmlsbGVkLCBjYW5jZWxsZWQgfQogICAgZW51bSBPcmRlclR5cGUgeyBtYWtlLCB0YWtlIH0KICAgIHN0cnVjdCBPcmRlciB7IC8vIERlc2NyaWJlcyBhbmQgbG9ncyB3aGVuZXZlciBhc3NldHMgZW50ZXIgYW5kIGxlYXZlIGZ1bmQgZHVlIHRvIE1hbmFnZXIKICAgICAgICB1aW50IGV4Y2hhbmdlSWQ7IC8vIElkIGFzIHJldHVybmVkIGZyb20gZXhjaGFuZ2UKICAgICAgICBPcmRlclN0YXR1cyBzdGF0dXM7IC8vIEVudW06IGFjdGl2ZSwgcGFydGlhbGx5RmlsbGVkLCBmdWxseUZpbGxlZCwgY2FuY2VsbGVkCiAgICAgICAgT3JkZXJUeXBlIG9yZGVyVHlwZTsgLy8gRW51bTogbWFrZSwgdGFrZQogICAgICAgIGFkZHJlc3Mgc2VsbEFzc2V0OyAvLyBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIHNvbGQKICAgICAgICBhZGRyZXNzIGJ1eUFzc2V0OyAvLyBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIGJvdWdodAogICAgICAgIHVpbnQgc2VsbFF1YW50aXR5OyAvLyBRdWFudGl0eSBvZiBzZWxsQXNzZXQgdG8gYmUgc29sZAogICAgICAgIHVpbnQgYnV5UXVhbnRpdHk7IC8vIFF1YW50aXR5IG9mIHNlbGxBc3NldCB0byBiZSBib3VnaHQKICAgICAgICB1aW50IHRpbWVzdGFtcDsgLy8gVGltZSBvZiBvcmRlciBjcmVhdGlvbiBpbiBzZWNvbmRzCiAgICAgICAgdWludCBmaWxsUXVhbnRpdHk7IC8vIEJ1eSBxdWFudGl0eSBmaWxsZWQ7IEFsd2F5cyBsZXNzIHRoYW4gYnV5X3F1YW50aXR5CiAgICB9CgogICAgc3RydWN0IEV4Y2hhbmdlIHsKICAgICAgICBhZGRyZXNzIGV4Y2hhbmdlOyAvLyBBZGRyZXNzIG9mIHRoZSBleGNoYW5nZQogICAgICAgIEV4Y2hhbmdlSW50ZXJmYWNlIGV4Y2hhbmdlQWRhcHRlcjsgLy9FeGNoYW5nZSBhZGFwdGVyIGNvbnRyYWN0cyByZXNwZWN0aXZlIHRvIHRoZSBleGNoYW5nZQogICAgICAgIGJvb2wgaXNBcHByb3ZlT25seTsgLy8gVHJ1ZSBpbiBjYXNlIG9mIGV4Y2hhbmdlIGltcGxlbWVudGF0aW9uIHdoaWNoIHJlcXVpcmVzICBhcmUgYXBwcm92ZWQgd2hlbiBhbiBvcmRlciBpcyBtYWRlIGluc3RlYWQgb2YgdHJhbnNmZXIKICAgIH0KCiAgICAvLyBGSUVMRFMKCiAgICAvLyBDb25zdGFudCBmaWVsZHMKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9GVU5EX0FTU0VUUyA9IDkwOyAvLyBNYXggb3duYWJsZSBhc3NldHMgYnkgdGhlIGZ1bmQgc3VwcG9ydGVkIGJ5IGdhcyBsaW1pdHMKICAgIC8vIENvbnN0cnVjdG9yIGZpZWxkcwogICAgdWludCBwdWJsaWMgTUFOQUdFTUVOVF9GRUVfUkFURTsgLy8gRmVlIHJhdGUgaW4gUVVPVEVfQVNTRVQgcGVyIGRlbHRhIGltcHJvdmVtZW50IGluIFdBRAogICAgdWludCBwdWJsaWMgUEVSRk9STUFOQ0VfRkVFX1JBVEU7IC8vIEZlZSByYXRlIGluIFFVT1RFX0FTU0VUIHBlciBtYW5hZ2VkIHNlY29uZHMgaW4gV0FECiAgICBhZGRyZXNzIHB1YmxpYyBWRVJTSU9OOyAvLyBBZGRyZXNzIG9mIFZlcnNpb24gY29udHJhY3QKICAgIEFzc2V0IHB1YmxpYyBRVU9URV9BU1NFVDsgLy8gUVVPVEUgYXNzZXQgYXMgRVJDMjAgY29udHJhY3QKICAgIE5hdGl2ZUFzc2V0SW50ZXJmYWNlIHB1YmxpYyBOQVRJVkVfQVNTRVQ7IC8vIE5hdGl2ZSBhc3NldCBhcyBFUkMyMCBjb250cmFjdAogICAgLy8gTWV0aG9kcyBmaWVsZHMKICAgIE1vZHVsZXMgcHVibGljIG1vZHVsZTsgLy8gU3RydWN0IHdoaWNoIGhvbGRzIGFsbCB0aGUgaW5pdGlhbGlzZWQgbW9kdWxlIGluc3RhbmNlcwogICAgRXhjaGFuZ2VbXSBwdWJsaWMgZXhjaGFuZ2VzOyAvLyBBcnJheSBjb250YWluaW5nIGV4Y2hhbmdlcyB0aGlzIGZ1bmQgc3VwcG9ydHMKICAgIENhbGN1bGF0aW9ucyBwdWJsaWMgYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbjsgLy8gQ2FsY3VsYXRpb24gcmVzdWx0cyBhdCBsYXN0IGFsbG9jYXRlVW5jbGFpbWVkRmVlcygpIGNhbGwKICAgIGJvb2wgcHVibGljIGlzU2h1dERvd247IC8vIFNlY3VyaXR5IGZlYXR1cmUsIGlmIHllcyB0aGFuIGludmVzdGluZywgbWFuYWdpbmcsIGFsbG9jYXRlVW5jbGFpbWVkRmVlcyBnZXRzIGJsb2NrZWQKICAgIFJlcXVlc3RbXSBwdWJsaWMgcmVxdWVzdHM7IC8vIEFsbCB0aGUgcmVxdWVzdHMgdGhpcyBmdW5kIHJlY2VpdmVkIGZyb20gcGFydGljaXBhbnRzCiAgICBib29sIHB1YmxpYyBpc0ludmVzdEFsbG93ZWQ7IC8vIFVzZXIgb3B0aW9uLCBpZiBmYWxzZSBmdW5kIHJlamVjdHMgTWVsb24gaW52ZXN0bWVudHMKICAgIGJvb2wgcHVibGljIGlzUmVkZWVtQWxsb3dlZDsgLy8gVXNlciBvcHRpb24sIGlmIGZhbHNlIGZ1bmQgcmVqZWN0cyBNZWxvbiByZWRlbXB0aW9uczsgUmVkZW1wdGlvbnMgdXNpbmcgc2xpY2VzIGFsd2F5cyBwb3NzaWJsZQogICAgT3JkZXJbXSBwdWJsaWMgb3JkZXJzOyAvLyBBbGwgdGhlIG9yZGVycyB0aGlzIGZ1bmQgcGxhY2VkIG9uIGV4Y2hhbmdlcwogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkpIHB1YmxpYyBleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkczsgLy8gZXhjaGFuZ2VJbmRleCB0bzogYXNzZXQgdG8gb3BlbiBtYWtlIG9yZGVyIElEIDsgaWYgbm8gb3BlbiBtYWtlIG9yZGVycywgb3JkZXJJRCBpcyB6ZXJvCiAgICBhZGRyZXNzW10gcHVibGljIG93bmVkQXNzZXRzOyAvLyBMaXN0IG9mIGFsbCBhc3NldHMgb3duZWQgYnkgdGhlIGZ1bmQgb3IgZm9yIHdoaWNoIHRoZSBmdW5kIGhhcyBvcGVuIG1ha2Ugb3JkZXJzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0luQXNzZXRMaXN0OyAvLyBNYXBwaW5nIGZyb20gYXNzZXQgdG8gd2hldGhlciB0aGUgYXNzZXQgZXhpc3RzIGluIG93bmVkQXNzZXRzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0luT3Blbk1ha2VPcmRlcjsgLy8gTWFwcGluZyBmcm9tIGFzc2V0IHRvIHdoZXRoZXIgdGhlIGFzc2V0IGlzIGluIGEgb3BlbiBtYWtlIG9yZGVyIGFzIGJ1eSBhc3NldAoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAZGV2IFNob3VsZCBvbmx5IGJlIGNhbGxlZCB2aWEgVmVyc2lvbi5zZXR1cEZ1bmQoLi4pCiAgICAvLy8gQHBhcmFtIHdpdGhOYW1lIGh1bWFuLXJlYWRhYmxlIGRlc2NyaXB0aXZlIG5hbWUgKG5vdCBuZWNlc3NhcmlseSB1bmlxdWUpCiAgICAvLy8gQHBhcmFtIG9mUXVvdGVBc3NldCBBc3NldCBhZ2FpbnN0IHdoaWNoIG1nbXQgYW5kIHBlcmZvcm1hbmNlIGZlZSBpcyBtZWFzdXJlZCBhZ2FpbnN0IGFuZCB3aGljaCBjYW4gYmUgdXNlZCB0byBpbnZlc3QvcmVkZWVtIHVzaW5nIHRoaXMgc2luZ2xlIGFzc2V0CiAgICAvLy8gQHBhcmFtIG9mTWFuYWdlbWVudEZlZSBBIHRpbWUgYmFzZWQgZmVlIGV4cHJlc3NlZCwgZ2l2ZW4gaW4gYSBudW1iZXIgd2hpY2ggaXMgZGl2aWRlZCBieSAxIFdBRAogICAgLy8vIEBwYXJhbSBvZlBlcmZvcm1hbmNlRmVlIEEgdGltZSBwZXJmb3JtYW5jZSBiYXNlZCBmZWUsIHBlcmZvcm1hbmNlIHJlbGF0aXZlIHRvIG9mUXVvdGVBc3NldCwgZ2l2ZW4gaW4gYSBudW1iZXIgd2hpY2ggaXMgZGl2aWRlZCBieSAxIFdBRAogICAgLy8vIEBwYXJhbSBvZkNvbXBsaWFuY2UgQWRkcmVzcyBvZiBjb21wbGlhbmNlIG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZlJpc2tNZ210IEFkZHJlc3Mgb2YgcmlzayBtYW5hZ2VtZW50IG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZlByaWNlRmVlZCBBZGRyZXNzIG9mIHByaWNlIGZlZWQgbW9kdWxlCiAgICAvLy8gQHBhcmFtIG9mRXhjaGFuZ2VzIEFkZHJlc3NlcyBvZiBleGNoYW5nZSBvbiB3aGljaCB0aGlzIGZ1bmQgY2FuIHRyYWRlCiAgICAvLy8gQHBhcmFtIG9mRXhjaGFuZ2VBZGFwdGVycyBBZGRyZXNzZXMgb2YgZXhjaGFuZ2UgYWRhcHRlcnMKICAgIC8vLyBAcmV0dXJuIERlcGxveWVkIEZ1bmQgd2l0aCBtYW5hZ2VyIHNldCBhcyBvZk1hbmFnZXIKICAgIGZ1bmN0aW9uIEZ1bmQoCiAgICAgICAgYWRkcmVzcyBvZk1hbmFnZXIsCiAgICAgICAgc3RyaW5nIHdpdGhOYW1lLAogICAgICAgIGFkZHJlc3Mgb2ZRdW90ZUFzc2V0LAogICAgICAgIHVpbnQgb2ZNYW5hZ2VtZW50RmVlLAogICAgICAgIHVpbnQgb2ZQZXJmb3JtYW5jZUZlZSwKICAgICAgICBhZGRyZXNzIG9mTmF0aXZlQXNzZXQsCiAgICAgICAgYWRkcmVzcyBvZkNvbXBsaWFuY2UsCiAgICAgICAgYWRkcmVzcyBvZlJpc2tNZ210LAogICAgICAgIGFkZHJlc3Mgb2ZQcmljZUZlZWQsCiAgICAgICAgYWRkcmVzc1tdIG9mRXhjaGFuZ2VzLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlQWRhcHRlcnMKICAgICkKICAgICAgICBSZXN0cmljdGVkU2hhcmVzKHdpdGhOYW1lLCAiTUxORiIsIDE4LCBub3cpCiAgICB7CiAgICAgICAgaXNJbnZlc3RBbGxvd2VkID0gdHJ1ZTsKICAgICAgICBpc1JlZGVlbUFsbG93ZWQgPSB0cnVlOwogICAgICAgIG93bmVyID0gb2ZNYW5hZ2VyOwogICAgICAgIHJlcXVpcmUob2ZNYW5hZ2VtZW50RmVlIDwgMTAgKiogMTgpOyAvLyBSZXF1aXJlIG1hbmFnZW1lbnQgZmVlIHRvIGJlIGxlc3MgdGhhbiAxMDAgcGVyY2VudAogICAgICAgIE1BTkFHRU1FTlRfRkVFX1JBVEUgPSBvZk1hbmFnZW1lbnRGZWU7IC8vIDEgcGVyY2VudCBpcyBleHByZXNzZWQgYXMgMC4wMSAqIDEwICoqIDE4CiAgICAgICAgcmVxdWlyZShvZlBlcmZvcm1hbmNlRmVlIDwgMTAgKiogMTgpOyAvLyBSZXF1aXJlIHBlcmZvcm1hbmNlIGZlZSB0byBiZSBsZXNzIHRoYW4gMTAwIHBlcmNlbnQKICAgICAgICBQRVJGT1JNQU5DRV9GRUVfUkFURSA9IG9mUGVyZm9ybWFuY2VGZWU7IC8vIDEgcGVyY2VudCBpcyBleHByZXNzZWQgYXMgMC4wMSAqIDEwICoqIDE4CiAgICAgICAgVkVSU0lPTiA9IG1zZy5zZW5kZXI7CiAgICAgICAgbW9kdWxlLmNvbXBsaWFuY2UgPSBDb21wbGlhbmNlSW50ZXJmYWNlKG9mQ29tcGxpYW5jZSk7CiAgICAgICAgbW9kdWxlLnJpc2ttZ210ID0gUmlza01nbXRJbnRlcmZhY2Uob2ZSaXNrTWdtdCk7CiAgICAgICAgbW9kdWxlLnByaWNlZmVlZCA9IFByaWNlRmVlZEludGVyZmFjZShvZlByaWNlRmVlZCk7CiAgICAgICAgLy8gQnJpZGdlZCB0byBNZWxvbiBleGNoYW5nZSBpbnRlcmZhY2UgYnkgZXhjaGFuZ2VBZGFwdGVyIGxpYnJhcnkKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvZkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBFeGNoYW5nZUludGVyZmFjZSBhZGFwdGVyID0gRXhjaGFuZ2VJbnRlcmZhY2Uob2ZFeGNoYW5nZUFkYXB0ZXJzW2ldKTsKICAgICAgICAgICAgYm9vbCBpc0FwcHJvdmVPbmx5ID0gYWRhcHRlci5pc0FwcHJvdmVPbmx5KCk7CiAgICAgICAgICAgIGV4Y2hhbmdlcy5wdXNoKEV4Y2hhbmdlKHsKICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBvZkV4Y2hhbmdlc1tpXSwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlQWRhcHRlcjogYWRhcHRlciwKICAgICAgICAgICAgICAgIGlzQXBwcm92ZU9ubHk6IGlzQXBwcm92ZU9ubHkKICAgICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICAvLyBSZXF1aXJlIFF1b3RlIGFzc2V0cyBleGlzdHMgaW4gcHJpY2VmZWVkCiAgICAgICAgUVVPVEVfQVNTRVQgPSBBc3NldChvZlF1b3RlQXNzZXQpOwogICAgICAgIE5BVElWRV9BU1NFVCA9IE5hdGl2ZUFzc2V0SW50ZXJmYWNlKG9mTmF0aXZlQXNzZXQpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhRVU9URV9BU1NFVCkgPT0gbW9kdWxlLnByaWNlZmVlZC5nZXRRdW90ZUFzc2V0KCkpOyAvLyBTYW5pdHkgY2hlY2sKICAgICAgICBhdExhc3RVbmNsYWltZWRGZWVBbGxvY2F0aW9uID0gQ2FsY3VsYXRpb25zKHsKICAgICAgICAgICAgZ2F2OiAwLAogICAgICAgICAgICBtYW5hZ2VtZW50RmVlOiAwLAogICAgICAgICAgICBwZXJmb3JtYW5jZUZlZTogMCwKICAgICAgICAgICAgdW5jbGFpbWVkRmVlczogMCwKICAgICAgICAgICAgbmF2OiAwLAogICAgICAgICAgICBoaWdoV2F0ZXJNYXJrOiAxMCAqKiBnZXREZWNpbWFscygpLAogICAgICAgICAgICB0b3RhbFN1cHBseTogdG90YWxTdXBwbHksCiAgICAgICAgICAgIHRpbWVzdGFtcDogbm93CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gRVhURVJOQUwgTUVUSE9EUwoKICAgIC8vIEVYVEVSTkFMIDogQURNSU5JU1RSQVRJT04KCiAgICBmdW5jdGlvbiBlbmFibGVJbnZlc3RtZW50KCkgZXh0ZXJuYWwgcHJlX2NvbmQoaXNPd25lcigpKSB7IGlzSW52ZXN0QWxsb3dlZCA9IHRydWU7IH0KICAgIGZ1bmN0aW9uIGRpc2FibGVJbnZlc3RtZW50KCkgZXh0ZXJuYWwgcHJlX2NvbmQoaXNPd25lcigpKSB7IGlzSW52ZXN0QWxsb3dlZCA9IGZhbHNlOyB9CiAgICBmdW5jdGlvbiBlbmFibGVSZWRlbXB0aW9uKCkgZXh0ZXJuYWwgcHJlX2NvbmQoaXNPd25lcigpKSB7IGlzUmVkZWVtQWxsb3dlZCA9IHRydWU7IH0KICAgIGZ1bmN0aW9uIGRpc2FibGVSZWRlbXB0aW9uKCkgZXh0ZXJuYWwgcHJlX2NvbmQoaXNPd25lcigpKSB7IGlzUmVkZWVtQWxsb3dlZCA9IGZhbHNlOyB9CiAgICBmdW5jdGlvbiBzaHV0RG93bigpIGV4dGVybmFsIHByZV9jb25kKG1zZy5zZW5kZXIgPT0gVkVSU0lPTikgeyBpc1NodXREb3duID0gdHJ1ZTsgfQoKCiAgICAvLyBFWFRFUk5BTCA6IFBBUlRJQ0lQQVRJT04KCiAgICAvLy8gQG5vdGljZSBHaXZlIG1lbG9uIHRva2VucyB0byByZWNlaXZlIHNoYXJlcyBvZiB0aGlzIGZ1bmQKICAgIC8vLyBAZGV2IFJlY29tbWVuZGVkIHRvIGdpdmUgc29tZSBsZWV3YXkgaW4gcHJpY2VzIHRvIGFjY291bnQgZm9yIHBvc3NpYmx5IHNsaWdodGx5IGNoYW5naW5nIHByaWNlcwogICAgLy8vIEBwYXJhbSBnaXZlUXVhbnRpdHkgUXVhbnRpdHkgb2YgTWVsb24gdG9rZW4gdGltZXMgMTAgKiogMTggb2ZmZXJlZCB0byByZWNlaXZlIHNoYXJlUXVhbnRpdHkKICAgIC8vLyBAcGFyYW0gc2hhcmVRdWFudGl0eSBRdWFudGl0eSBvZiBzaGFyZXMgdGltZXMgMTAgKiogMTggcmVxdWVzdGVkIHRvIGJlIHJlY2VpdmVkCiAgICBmdW5jdGlvbiByZXF1ZXN0SW52ZXN0bWVudCgKICAgICAgICB1aW50IGdpdmVRdWFudGl0eSwKICAgICAgICB1aW50IHNoYXJlUXVhbnRpdHksCiAgICAgICAgYm9vbCBpc05hdGl2ZUFzc2V0CiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZCghaXNTaHV0RG93bikKICAgICAgICBwcmVfY29uZChpc0ludmVzdEFsbG93ZWQpIC8vIGludmVzdG1lbnQgdXNpbmcgTWVsb24gaGFzIG5vdCBiZWVuIGRlYWN0aXZhdGVkIGJ5IHRoZSBNYW5hZ2VyCiAgICAgICAgcHJlX2NvbmQobW9kdWxlLmNvbXBsaWFuY2UuaXNJbnZlc3RtZW50UGVybWl0dGVkKG1zZy5zZW5kZXIsIGdpdmVRdWFudGl0eSwgc2hhcmVRdWFudGl0eSkpICAgIC8vIENvbXBsaWFuY2UgTW9kdWxlOiBJbnZlc3RtZW50IHBlcm1pdHRlZAogICAgewogICAgICAgIHJlcXVlc3RzLnB1c2goUmVxdWVzdCh7CiAgICAgICAgICAgIHBhcnRpY2lwYW50OiBtc2cuc2VuZGVyLAogICAgICAgICAgICBzdGF0dXM6IFJlcXVlc3RTdGF0dXMuYWN0aXZlLAogICAgICAgICAgICByZXF1ZXN0VHlwZTogUmVxdWVzdFR5cGUuaW52ZXN0LAogICAgICAgICAgICByZXF1ZXN0QXNzZXQ6IGlzTmF0aXZlQXNzZXQgPyBhZGRyZXNzKE5BVElWRV9BU1NFVCkgOiBhZGRyZXNzKFFVT1RFX0FTU0VUKSwKICAgICAgICAgICAgc2hhcmVRdWFudGl0eTogc2hhcmVRdWFudGl0eSwKICAgICAgICAgICAgZ2l2ZVF1YW50aXR5OiBnaXZlUXVhbnRpdHksCiAgICAgICAgICAgIHJlY2VpdmVRdWFudGl0eTogc2hhcmVRdWFudGl0eSwKICAgICAgICAgICAgdGltZXN0YW1wOiBub3csCiAgICAgICAgICAgIGF0VXBkYXRlSWQ6IG1vZHVsZS5wcmljZWZlZWQuZ2V0TGFzdFVwZGF0ZUlkKCkKICAgICAgICB9KSk7CiAgICAgICAgUmVxdWVzdFVwZGF0ZWQoZ2V0TGFzdFJlcXVlc3RJZCgpKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHaXZlIHNoYXJlcyBvZiB0aGlzIGZ1bmQgdG8gcmVjZWl2ZSBtZWxvbiB0b2tlbnMKICAgIC8vLyBAZGV2IFJlY29tbWVuZGVkIHRvIGdpdmUgc29tZSBsZWV3YXkgaW4gcHJpY2VzIHRvIGFjY291bnQgZm9yIHBvc3NpYmx5IHNsaWdodGx5IGNoYW5naW5nIHByaWNlcwogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IFF1YW50aXR5IG9mIHNoYXJlcyB0aW1lcyAxMCAqKiAxOCBvZmZlcmVkIHRvIHJlZGVlbQogICAgLy8vIEBwYXJhbSByZWNlaXZlUXVhbnRpdHkgUXVhbnRpdHkgb2YgTWVsb24gdG9rZW4gdGltZXMgMTAgKiogMTggcmVxdWVzdGVkIHRvIHJlY2VpdmUgZm9yIHNoYXJlUXVhbnRpdHkKICAgIGZ1bmN0aW9uIHJlcXVlc3RSZWRlbXB0aW9uKAogICAgICAgIHVpbnQgc2hhcmVRdWFudGl0eSwKICAgICAgICB1aW50IHJlY2VpdmVRdWFudGl0eSwKICAgICAgICBib29sIGlzTmF0aXZlQXNzZXQKICAgICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQoIWlzU2h1dERvd24pCiAgICAgICAgcHJlX2NvbmQoaXNSZWRlZW1BbGxvd2VkKSAvLyBSZWRlbXB0aW9uIHVzaW5nIE1lbG9uIGhhcyBub3QgYmVlbiBkZWFjdGl2YXRlZCBieSBNYW5hZ2VyCiAgICAgICAgcHJlX2NvbmQobW9kdWxlLmNvbXBsaWFuY2UuaXNSZWRlbXB0aW9uUGVybWl0dGVkKG1zZy5zZW5kZXIsIHNoYXJlUXVhbnRpdHksIHJlY2VpdmVRdWFudGl0eSkpIC8vIENvbXBsaWFuY2UgTW9kdWxlOiBSZWRlbXB0aW9uIHBlcm1pdHRlZAogICAgewogICAgICAgIHJlcXVlc3RzLnB1c2goUmVxdWVzdCh7CiAgICAgICAgICAgIHBhcnRpY2lwYW50OiBtc2cuc2VuZGVyLAogICAgICAgICAgICBzdGF0dXM6IFJlcXVlc3RTdGF0dXMuYWN0aXZlLAogICAgICAgICAgICByZXF1ZXN0VHlwZTogUmVxdWVzdFR5cGUucmVkZWVtLAogICAgICAgICAgICByZXF1ZXN0QXNzZXQ6IGlzTmF0aXZlQXNzZXQgPyBhZGRyZXNzKE5BVElWRV9BU1NFVCkgOiBhZGRyZXNzKFFVT1RFX0FTU0VUKSwKICAgICAgICAgICAgc2hhcmVRdWFudGl0eTogc2hhcmVRdWFudGl0eSwKICAgICAgICAgICAgZ2l2ZVF1YW50aXR5OiBzaGFyZVF1YW50aXR5LAogICAgICAgICAgICByZWNlaXZlUXVhbnRpdHk6IHJlY2VpdmVRdWFudGl0eSwKICAgICAgICAgICAgdGltZXN0YW1wOiBub3csCiAgICAgICAgICAgIGF0VXBkYXRlSWQ6IG1vZHVsZS5wcmljZWZlZWQuZ2V0TGFzdFVwZGF0ZUlkKCkKICAgICAgICB9KSk7CiAgICAgICAgUmVxdWVzdFVwZGF0ZWQoZ2V0TGFzdFJlcXVlc3RJZCgpKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFeGVjdXRlcyBhY3RpdmUgaW52ZXN0bWVudCBhbmQgcmVkZW1wdGlvbiByZXF1ZXN0cywgaW4gYSB3YXkgdGhhdCBtaW5pbWlzZXMgaW5mb3JtYXRpb24gYWR2YW50YWdlcyBvZiBpbnZlc3RvcgogICAgLy8vIEBkZXYgRGlzdHJpYnV0ZXMgbWVsb24gYW5kIHNoYXJlcyBhY2NvcmRpbmcgdG8gdGhlIHJlcXVlc3QKICAgIC8vLyBAcGFyYW0gaWQgSW5kZXggb2YgcmVxdWVzdCB0byBiZSBleGVjdXRlZAogICAgLy8vIEBkZXYgQWN0aXZlIGludmVzdG1lbnQgb3IgcmVkZW1wdGlvbiByZXF1ZXN0IGV4ZWN1dGVkCiAgICBmdW5jdGlvbiBleGVjdXRlUmVxdWVzdCh1aW50IGlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQoIWlzU2h1dERvd24pCiAgICAgICAgcHJlX2NvbmQocmVxdWVzdHNbaWRdLnN0YXR1cyA9PSBSZXF1ZXN0U3RhdHVzLmFjdGl2ZSkKICAgICAgICBwcmVfY29uZChyZXF1ZXN0c1tpZF0ucmVxdWVzdFR5cGUgIT0gUmVxdWVzdFR5cGUucmVkZWVtIHx8IHJlcXVlc3RzW2lkXS5zaGFyZVF1YW50aXR5IDw9IGJhbGFuY2VzW3JlcXVlc3RzW2lkXS5wYXJ0aWNpcGFudF0pIC8vIHJlcXVlc3Qgb3duZXIgZG9lcyBub3Qgb3duIGVub3VnaCBzaGFyZXMKICAgICAgICBwcmVfY29uZCgKICAgICAgICAgICAgdG90YWxTdXBwbHkgPT0gMCB8fAogICAgICAgICAgICAoCiAgICAgICAgICAgICAgICBub3cgPj0gYWRkKHJlcXVlc3RzW2lkXS50aW1lc3RhbXAsIG1vZHVsZS5wcmljZWZlZWQuZ2V0SW50ZXJ2YWwoKSkgJiYKICAgICAgICAgICAgICAgIG1vZHVsZS5wcmljZWZlZWQuZ2V0TGFzdFVwZGF0ZUlkKCkgPj0gYWRkKHJlcXVlc3RzW2lkXS5hdFVwZGF0ZUlkLCAyKQogICAgICAgICAgICApCiAgICAgICAgKSAgIC8vIFByaWNlRmVlZCBNb2R1bGU6IFdhaXQgYXQgbGVhc3Qgb25lIGludGVydmFsIHRpbWUgYW5kIHR3byB1cGRhdGVzIGJlZm9yZSBjb250aW51aW5nICh1bmxlc3MgaXQgaXMgdGhlIGZpcnN0IGludmVzdG1lbnQpCiAgICAgICAgIC8vIFByaWNlRmVlZCBNb2R1bGU6IE5vIHJlY2VudCB1cGRhdGVzIGZvciBmdW5kIGFzc2V0IGxpc3QKICAgIHsKICAgICAgICAvLyBzaGFyZVByaWNlIHF1b3RlZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBmdW5kRGVjaW1hbHMKICAgICAgICAvLyBiYXNlZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBmdW5kRGVjaW1hbHMKICAgICAgICByZXF1aXJlKG1vZHVsZS5wcmljZWZlZWQuaGFzUmVjZW50UHJpY2UoYWRkcmVzcyhRVU9URV9BU1NFVCkpKTsKICAgICAgICByZXF1aXJlKG1vZHVsZS5wcmljZWZlZWQuaGFzUmVjZW50UHJpY2VzKG93bmVkQXNzZXRzKSk7CiAgICAgICAgdmFyIChpc1JlY2VudCwgLCApID0gbW9kdWxlLnByaWNlZmVlZC5nZXRJbnZlcnRlZFByaWNlKGFkZHJlc3MoUVVPVEVfQVNTRVQpKTsKICAgICAgICAvLyBUT0RPOiBjaGVjayBwcmVjaXNpb24gb2YgYmVsb3cgb3RoZXJ3aXNlIHVzZTsgdWludCBjb3N0UXVhbnRpdHkgPSB0b1dob2xlU2hhcmVVbml0KG11bChyZXF1ZXN0LnNoYXJlUXVhbnRpdHksIGNhbGNTaGFyZVByaWNlKCkpKTsKICAgICAgICAvLyBCeSBkZWZpbml0aW9uIHF1b3RlRGVjaW1hbHMgPT0gZnVuZERlY2ltYWxzCiAgICAgICAgUmVxdWVzdCByZXF1ZXN0ID0gcmVxdWVzdHNbaWRdOwoKICAgICAgICB1aW50IGNvc3RRdWFudGl0eSA9IHRvV2hvbGVTaGFyZVVuaXQobXVsKHJlcXVlc3Quc2hhcmVRdWFudGl0eSwgY2FsY1NoYXJlUHJpY2UoKSkpOwogICAgICAgIGlmIChyZXF1ZXN0LnJlcXVlc3RBc3NldCA9PSBhZGRyZXNzKE5BVElWRV9BU1NFVCkpIHsKICAgICAgICAgICAgdmFyIChpc1ByaWNlUmVjZW50LCBpbnZlcnRlZE5hdGl2ZUFzc2V0UHJpY2UsIG5hdGl2ZUFzc2V0RGVjaW1hbCkgPSBtb2R1bGUucHJpY2VmZWVkLmdldEludmVydGVkUHJpY2UoYWRkcmVzcyhOQVRJVkVfQVNTRVQpKTsKICAgICAgICAgICAgaWYgKCFpc1ByaWNlUmVjZW50KSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3N0UXVhbnRpdHkgPSBtdWwoY29zdFF1YW50aXR5LCBpbnZlcnRlZE5hdGl2ZUFzc2V0UHJpY2UpIC8gMTAgKiogbmF0aXZlQXNzZXREZWNpbWFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKAogICAgICAgICAgICBpc0ludmVzdEFsbG93ZWQgJiYKICAgICAgICAgICAgcmVxdWVzdC5yZXF1ZXN0VHlwZSA9PSBSZXF1ZXN0VHlwZS5pbnZlc3QgJiYKICAgICAgICAgICAgY29zdFF1YW50aXR5IDw9IHJlcXVlc3QuZ2l2ZVF1YW50aXR5CiAgICAgICAgKSB7CiAgICAgICAgICAgIGlmICghaXNJbkFzc2V0TGlzdFthZGRyZXNzKFFVT1RFX0FTU0VUKV0pIHsKICAgICAgICAgICAgICAgIG93bmVkQXNzZXRzLnB1c2goYWRkcmVzcyhRVU9URV9BU1NFVCkpOwogICAgICAgICAgICAgICAgaXNJbkFzc2V0TGlzdFthZGRyZXNzKFFVT1RFX0FTU0VUKV0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVlc3Quc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5leGVjdXRlZDsKICAgICAgICAgICAgYXNzZXJ0KEFzc2V0SW50ZXJmYWNlKHJlcXVlc3QucmVxdWVzdEFzc2V0KS50cmFuc2ZlckZyb20ocmVxdWVzdC5wYXJ0aWNpcGFudCwgdGhpcywgY29zdFF1YW50aXR5KSk7IC8vIEFsbG9jYXRlIFZhbHVlCiAgICAgICAgICAgIGNyZWF0ZVNoYXJlcyhyZXF1ZXN0LnBhcnRpY2lwYW50LCByZXF1ZXN0LnNoYXJlUXVhbnRpdHkpOyAvLyBBY2NvdW50aW5nCiAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgaXNSZWRlZW1BbGxvd2VkICYmCiAgICAgICAgICAgIHJlcXVlc3QucmVxdWVzdFR5cGUgPT0gUmVxdWVzdFR5cGUucmVkZWVtICYmCiAgICAgICAgICAgIHJlcXVlc3QucmVjZWl2ZVF1YW50aXR5IDw9IGNvc3RRdWFudGl0eQogICAgICAgICkgewogICAgICAgICAgICByZXF1ZXN0LnN0YXR1cyA9IFJlcXVlc3RTdGF0dXMuZXhlY3V0ZWQ7CiAgICAgICAgICAgIGFzc2VydChBc3NldEludGVyZmFjZShyZXF1ZXN0LnJlcXVlc3RBc3NldCkudHJhbnNmZXIocmVxdWVzdC5wYXJ0aWNpcGFudCwgY29zdFF1YW50aXR5KSk7IC8vIFJldHVybiB2YWx1ZQogICAgICAgICAgICBhbm5paGlsYXRlU2hhcmVzKHJlcXVlc3QucGFydGljaXBhbnQsIHJlcXVlc3Quc2hhcmVRdWFudGl0eSk7IC8vIEFjY291bnRpbmcKICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICBpc1JlZGVlbUFsbG93ZWQgJiYKICAgICAgICAgICAgcmVxdWVzdC5yZXF1ZXN0VHlwZSA9PSBSZXF1ZXN0VHlwZS50b2tlbkZhbGxiYWNrUmVkZWVtICYmCiAgICAgICAgICAgIHJlcXVlc3QucmVjZWl2ZVF1YW50aXR5IDw9IGNvc3RRdWFudGl0eQogICAgICAgICkgewogICAgICAgICAgICByZXF1ZXN0LnN0YXR1cyA9IFJlcXVlc3RTdGF0dXMuZXhlY3V0ZWQ7CiAgICAgICAgICAgIGFzc2VydChBc3NldEludGVyZmFjZShyZXF1ZXN0LnJlcXVlc3RBc3NldCkudHJhbnNmZXIocmVxdWVzdC5wYXJ0aWNpcGFudCwgY29zdFF1YW50aXR5KSk7IC8vIFJldHVybiB2YWx1ZQogICAgICAgICAgICBhbm5paGlsYXRlU2hhcmVzKHRoaXMsIHJlcXVlc3Quc2hhcmVRdWFudGl0eSk7IC8vIEFjY291bnRpbmcKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsgLy8gSW52YWxpZCBSZXF1ZXN0IG9yIGludmFsaWQgZ2l2ZVF1YW50aXR5IC8gcmVjZWl2ZVF1YW50aXR5CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbmNlbHMgYWN0aXZlIGludmVzdG1lbnQgYW5kIHJlZGVtcHRpb24gcmVxdWVzdHMKICAgIC8vLyBAcGFyYW0gaWQgSW5kZXggb2YgcmVxdWVzdCB0byBiZSBleGVjdXRlZAogICAgZnVuY3Rpb24gY2FuY2VsUmVxdWVzdCh1aW50IGlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQocmVxdWVzdHNbaWRdLnN0YXR1cyA9PSBSZXF1ZXN0U3RhdHVzLmFjdGl2ZSkgLy8gUmVxdWVzdCBpcyBhY3RpdmUKICAgICAgICBwcmVfY29uZChyZXF1ZXN0c1tpZF0ucGFydGljaXBhbnQgPT0gbXNnLnNlbmRlciB8fCBpc1NodXREb3duKSAvLyBFaXRoZXIgcmVxdWVzdCBjcmVhdG9yIG9yIGZ1bmQgaXMgc2h1dCBkb3duCiAgICB7CiAgICAgICAgcmVxdWVzdHNbaWRdLnN0YXR1cyA9IFJlcXVlc3RTdGF0dXMuY2FuY2VsbGVkOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlZGVlbXMgYnkgYWxsb2NhdGluZyBhbiBvd25lcnNoaXAgcGVyY2VudGFnZSBvZiBlYWNoIGFzc2V0IHRvIHRoZSBwYXJ0aWNpcGFudAogICAgLy8vIEBkZXYgSW5kZXBlbmRlbnQgb2YgcnVubmluZyBwcmljZSBmZWVkIQogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IE51bWJlciBvZiBzaGFyZXMgb3duZWQgYnkgdGhlIHBhcnRpY2lwYW50LCB3aGljaCB0aGUgcGFydGljaXBhbnQgd291bGQgbGlrZSB0byByZWRlZW0gZm9yIGluZGl2aWR1YWwgYXNzZXRzCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIGFsbCBhc3NldHMgc2VudCB0byBzaGFyZWhvbGRlciBvciBub3QKICAgIGZ1bmN0aW9uIHJlZGVlbUFsbE93bmVkQXNzZXRzKHVpbnQgc2hhcmVRdWFudGl0eSkKICAgICAgICBleHRlcm5hbAogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICByZXR1cm4gZW1lcmdlbmN5UmVkZWVtKHNoYXJlUXVhbnRpdHksIG93bmVkQXNzZXRzKTsKICAgIH0KCiAgICAvLyBFWFRFUk5BTCA6IE1BTkFHSU5HCgogICAgLy8vIEBub3RpY2UgTWFrZXMgYW4gb3JkZXIgb24gdGhlIHNlbGVjdGVkIGV4Y2hhbmdlCiAgICAvLy8gQGRldiBUaGVzZSBhcmUgb3JkZXJzIHRoYXQgYXJlIG5vdCBleHBlY3RlZCB0byBzZXR0bGUgaW1tZWRpYXRlbHkuICBTdWZmaWNpZW50IGJhbGFuY2UgKD09IHNlbGxRdWFudGl0eSkgb2Ygc2VsbEFzc2V0CiAgICAvLy8gQHBhcmFtIHNlbGxBc3NldCBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIHNvbGQKICAgIC8vLyBAcGFyYW0gYnV5QXNzZXQgQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBib3VnaHQKICAgIC8vLyBAcGFyYW0gc2VsbFF1YW50aXR5IFF1YW50aXR5IG9mIHNlbGxBc3NldCB0byBiZSBzb2xkCiAgICAvLy8gQHBhcmFtIGJ1eVF1YW50aXR5IFF1YW50aXR5IG9mIGJ1eUFzc2V0IHRvIGJlIGJvdWdodAogICAgZnVuY3Rpb24gbWFrZU9yZGVyKAogICAgICAgIHVpbnQgZXhjaGFuZ2VOdW1iZXIsCiAgICAgICAgYWRkcmVzcyBzZWxsQXNzZXQsCiAgICAgICAgYWRkcmVzcyBidXlBc3NldCwKICAgICAgICB1aW50IHNlbGxRdWFudGl0eSwKICAgICAgICB1aW50IGJ1eVF1YW50aXR5CiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZChpc093bmVyKCkpCiAgICAgICAgcHJlX2NvbmQoIWlzU2h1dERvd24pCiAgICB7CiAgICAgICAgcmVxdWlyZShidXlBc3NldCAhPSBhZGRyZXNzKHRoaXMpKTsgLy8gUHJldmVudCBidXlpbmcgb2Ygb3duIGZ1bmQgdG9rZW4KICAgICAgICByZXF1aXJlKHF1YW50aXR5SGVsZEluQ3VzdG9keU9mRXhjaGFuZ2Uoc2VsbEFzc2V0KSA9PSAwKTsgLy8gQ3VyciBvbmx5IG9uZSBtYWtlIG9yZGVyIHBlciBzZWxsQXNzZXQgYWxsb3dlZC4gUGxlYXNlIHdhaXQgb3IgY2FuY2VsIGV4aXN0aW5nIG1ha2Ugb3JkZXIuCiAgICAgICAgcmVxdWlyZShtb2R1bGUucHJpY2VmZWVkLmV4aXN0c1ByaWNlT25Bc3NldFBhaXIoc2VsbEFzc2V0LCBidXlBc3NldCkpOyAvLyBQcmljZUZlZWQgbW9kdWxlOiBSZXF1ZXN0ZWQgYXNzZXQgcGFpciBub3QgdmFsaWQKICAgICAgICB2YXIgKGlzUmVjZW50LCByZWZlcmVuY2VQcmljZSwgKSA9IG1vZHVsZS5wcmljZWZlZWQuZ2V0UmVmZXJlbmNlUHJpY2Uoc2VsbEFzc2V0LCBidXlBc3NldCk7CiAgICAgICAgcmVxdWlyZShpc1JlY2VudCk7ICAvLyBSZWZlcmVuY2UgcHJpY2UgaXMgcmVxdWlyZWQgdG8gYmUgcmVjZW50CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbW9kdWxlLnJpc2ttZ210LmlzTWFrZVBlcm1pdHRlZCgKICAgICAgICAgICAgICAgIG1vZHVsZS5wcmljZWZlZWQuZ2V0T3JkZXJQcmljZSgKICAgICAgICAgICAgICAgICAgICBzZWxsQXNzZXQsCiAgICAgICAgICAgICAgICAgICAgYnV5QXNzZXQsCiAgICAgICAgICAgICAgICAgICAgc2VsbFF1YW50aXR5LAogICAgICAgICAgICAgICAgICAgIGJ1eVF1YW50aXR5CiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgcmVmZXJlbmNlUHJpY2UsCiAgICAgICAgICAgICAgICBzZWxsQXNzZXQsCiAgICAgICAgICAgICAgICBidXlBc3NldCwKICAgICAgICAgICAgICAgIHNlbGxRdWFudGl0eSwKICAgICAgICAgICAgICAgIGJ1eVF1YW50aXR5CiAgICAgICAgICAgICkKICAgICAgICApOyAvLyBSaXNrTWdtdCBtb2R1bGU6IE1ha2Ugb3JkZXIgbm90IHBlcm1pdHRlZAogICAgICAgIHJlcXVpcmUoaXNJbkFzc2V0TGlzdFtidXlBc3NldF0gfHwgb3duZWRBc3NldHMubGVuZ3RoIDwgTUFYX0ZVTkRfQVNTRVRTKTsgLy8gTGltaXQgZm9yIG1heCBvd25hYmxlIGFzc2V0cyBieSB0aGUgZnVuZCByZWFjaGVkCiAgICAgICAgcmVxdWlyZShBc3NldEludGVyZmFjZShzZWxsQXNzZXQpLmFwcHJvdmUoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZSwgc2VsbFF1YW50aXR5KSk7IC8vIEFwcHJvdmUgZXhjaGFuZ2UgdG8gc3BlbmQgYXNzZXRzCgogICAgICAgIC8vIFNpbmNlIHRoZXJlIGlzIG9ubHkgb25lIG9wZW5NYWtlT3JkZXIgYWxsb3dlZCBmb3IgZWFjaCBhc3NldCwgd2UgY2FuIGFzc3VtZSB0aGF0IG9wZW5NYWtlT3JkZXJJZCBpcyBzZXQgYXMgemVybyBieSBxdWFudGl0eUhlbGRJbkN1c3RvZHlPZkV4Y2hhbmdlKCkgZnVuY3Rpb24KICAgICAgICByZXF1aXJlKGFkZHJlc3MoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZUFkYXB0ZXIpLmRlbGVnYXRlY2FsbChieXRlczQoa2VjY2FrMjU2KCJtYWtlT3JkZXIoYWRkcmVzcyxhZGRyZXNzLGFkZHJlc3MsdWludDI1Nix1aW50MjU2KSIpKSwgZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZSwgc2VsbEFzc2V0LCBidXlBc3NldCwgc2VsbFF1YW50aXR5LCBidXlRdWFudGl0eSkpOwogICAgICAgIGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2V4Y2hhbmdlTnVtYmVyXVtzZWxsQXNzZXRdID0gZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZUFkYXB0ZXIuZ2V0TGFzdE9yZGVySWQoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZSk7CgogICAgICAgIC8vIFN1Y2Nlc3MgZGVmaW5lZCBhcyBub24temVybyBvcmRlciBpZAogICAgICAgIHJlcXVpcmUoZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbZXhjaGFuZ2VOdW1iZXJdW3NlbGxBc3NldF0gIT0gMCk7CgogICAgICAgIC8vIFVwZGF0ZSBvd25lZEFzc2V0cyBhcnJheSBhbmQgaXNJbkFzc2V0TGlzdCwgaXNJbk9wZW5NYWtlT3JkZXIgbWFwcGluZwogICAgICAgIGlzSW5PcGVuTWFrZU9yZGVyW3NlbGxBc3NldF0gPSB0cnVlOwogICAgICAgIGlmICghaXNJbkFzc2V0TGlzdFtidXlBc3NldF0pIHsKICAgICAgICAgICAgb3duZWRBc3NldHMucHVzaChidXlBc3NldCk7CiAgICAgICAgICAgIGlzSW5Bc3NldExpc3RbYnV5QXNzZXRdID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIG9yZGVycy5wdXNoKE9yZGVyKHsKICAgICAgICAgICAgZXhjaGFuZ2VJZDogZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbZXhjaGFuZ2VOdW1iZXJdW3NlbGxBc3NldF0sCiAgICAgICAgICAgIHN0YXR1czogT3JkZXJTdGF0dXMuYWN0aXZlLAogICAgICAgICAgICBvcmRlclR5cGU6IE9yZGVyVHlwZS5tYWtlLAogICAgICAgICAgICBzZWxsQXNzZXQ6IHNlbGxBc3NldCwKICAgICAgICAgICAgYnV5QXNzZXQ6IGJ1eUFzc2V0LAogICAgICAgICAgICBzZWxsUXVhbnRpdHk6IHNlbGxRdWFudGl0eSwKICAgICAgICAgICAgYnV5UXVhbnRpdHk6IGJ1eVF1YW50aXR5LAogICAgICAgICAgICB0aW1lc3RhbXA6IG5vdywKICAgICAgICAgICAgZmlsbFF1YW50aXR5OiAwCiAgICAgICAgfSkpOwoKICAgICAgICBPcmRlclVwZGF0ZWQoZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbZXhjaGFuZ2VOdW1iZXJdW3NlbGxBc3NldF0pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRha2VzIGFuIGFjdGl2ZSBvcmRlciBvbiB0aGUgc2VsZWN0ZWQgZXhjaGFuZ2UKICAgIC8vLyBAZGV2IFRoZXNlIGFyZSBvcmRlcnMgdGhhdCBhcmUgZXhwZWN0ZWQgdG8gc2V0dGxlIGltbWVkaWF0ZWx5CiAgICAvLy8gQHBhcmFtIGlkIEFjdGl2ZSBvcmRlciBpZAogICAgLy8vIEBwYXJhbSByZWNlaXZlUXVhbnRpdHkgQnV5IHF1YW50aXR5IG9mIHdoYXQgb3RoZXJzIGFyZSBzZWxsaW5nIG9uIHNlbGVjdGVkIEV4Y2hhbmdlCiAgICBmdW5jdGlvbiB0YWtlT3JkZXIodWludCBleGNoYW5nZU51bWJlciwgdWludCBpZCwgdWludCByZWNlaXZlUXVhbnRpdHkpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZChpc093bmVyKCkpCiAgICAgICAgcHJlX2NvbmQoIWlzU2h1dERvd24pCiAgICB7CiAgICAgICAgLy8gR2V0IGluZm9ybWF0aW9uIG9mIG9yZGVyIGJ5IG9yZGVyIGlkCiAgICAgICAgT3JkZXIgbWVtb3J5IG9yZGVyOyAvLyBJbnZlcnNlIHZhcmlhYmxlIHRlcm1pbm9sb2d5ISBCdXlpbmcgd2hhdCBhbm90aGVyIHBlcnNvbiBpcyBzZWxsaW5nCiAgICAgICAgKAogICAgICAgICAgICBvcmRlci5zZWxsQXNzZXQsCiAgICAgICAgICAgIG9yZGVyLmJ1eUFzc2V0LAogICAgICAgICAgICBvcmRlci5zZWxsUXVhbnRpdHksCiAgICAgICAgICAgIG9yZGVyLmJ1eVF1YW50aXR5CiAgICAgICAgKSA9IGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2VBZGFwdGVyLmdldE9yZGVyKGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2UsIGlkKTsKICAgICAgICAvLyBDaGVjayBwcmUgY29uZGl0aW9ucwogICAgICAgIHJlcXVpcmUob3JkZXIuc2VsbEFzc2V0ICE9IGFkZHJlc3ModGhpcykpOyAvLyBQcmV2ZW50IGJ1eWluZyBvZiBvd24gZnVuZCB0b2tlbgogICAgICAgIHJlcXVpcmUobW9kdWxlLnByaWNlZmVlZC5leGlzdHNQcmljZU9uQXNzZXRQYWlyKG9yZGVyLmJ1eUFzc2V0LCBvcmRlci5zZWxsQXNzZXQpKTsgLy8gUHJpY2VGZWVkIG1vZHVsZTogUmVxdWVzdGVkIGFzc2V0IHBhaXIgbm90IHZhbGlkCiAgICAgICAgcmVxdWlyZShpc0luQXNzZXRMaXN0W29yZGVyLnNlbGxBc3NldF0gfHwgb3duZWRBc3NldHMubGVuZ3RoIDwgTUFYX0ZVTkRfQVNTRVRTKTsgLy8gTGltaXQgZm9yIG1heCBvd25hYmxlIGFzc2V0cyBieSB0aGUgZnVuZCByZWFjaGVkCiAgICAgICAgdmFyIChpc1JlY2VudCwgcmVmZXJlbmNlUHJpY2UsICkgPSBtb2R1bGUucHJpY2VmZWVkLmdldFJlZmVyZW5jZVByaWNlKG9yZGVyLmJ1eUFzc2V0LCBvcmRlci5zZWxsQXNzZXQpOwogICAgICAgIHJlcXVpcmUoaXNSZWNlbnQpOyAvLyBSZWZlcmVuY2UgcHJpY2UgaXMgcmVxdWlyZWQgdG8gYmUgcmVjZW50CiAgICAgICAgcmVxdWlyZShyZWNlaXZlUXVhbnRpdHkgPD0gb3JkZXIuc2VsbFF1YW50aXR5KTsgLy8gTm90IGVub3VnaCBxdWFudGl0eSBvZiBvcmRlciBmb3Igd2hhdCBpcyB0cnlpbmcgdG8gYmUgYm91Z2h0CiAgICAgICAgdWludCBzcGVuZFF1YW50aXR5ID0gbXVsKHJlY2VpdmVRdWFudGl0eSwgb3JkZXIuYnV5UXVhbnRpdHkpIC8gb3JkZXIuc2VsbFF1YW50aXR5OwogICAgICAgIHJlcXVpcmUoQXNzZXRJbnRlcmZhY2Uob3JkZXIuYnV5QXNzZXQpLmFwcHJvdmUoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZSwgc3BlbmRRdWFudGl0eSkpOyAvLyBDb3VsZCBub3QgYXBwcm92ZSBzcGVuZGluZyBvZiBzcGVuZFF1YW50aXR5IG9mIG9yZGVyLmJ1eUFzc2V0CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbW9kdWxlLnJpc2ttZ210LmlzVGFrZVBlcm1pdHRlZCgKICAgICAgICAgICAgbW9kdWxlLnByaWNlZmVlZC5nZXRPcmRlclByaWNlKAogICAgICAgICAgICAgICAgb3JkZXIuYnV5QXNzZXQsCiAgICAgICAgICAgICAgICBvcmRlci5zZWxsQXNzZXQsCiAgICAgICAgICAgICAgICBvcmRlci5idXlRdWFudGl0eSwgLy8gc3BlbmRRdWFudGl0eQogICAgICAgICAgICAgICAgb3JkZXIuc2VsbFF1YW50aXR5IC8vIHJlY2VpdmVRdWFudGl0eQogICAgICAgICAgICApLAogICAgICAgICAgICByZWZlcmVuY2VQcmljZSwKICAgICAgICAgICAgb3JkZXIuYnV5QXNzZXQsCiAgICAgICAgICAgIG9yZGVyLnNlbGxBc3NldCwKICAgICAgICAgICAgb3JkZXIuYnV5UXVhbnRpdHksCiAgICAgICAgICAgIG9yZGVyLnNlbGxRdWFudGl0eQogICAgICAgICkpOyAvLyBSaXNrTWdtdCBtb2R1bGU6IFRha2Ugb3JkZXIgbm90IHBlcm1pdHRlZAoKICAgICAgICAvLyBFeGVjdXRlIHJlcXVlc3QKICAgICAgICByZXF1aXJlKGFkZHJlc3MoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZUFkYXB0ZXIpLmRlbGVnYXRlY2FsbChieXRlczQoa2VjY2FrMjU2KCJ0YWtlT3JkZXIoYWRkcmVzcyx1aW50MjU2LHVpbnQyNTYpIikpLCBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBpZCwgcmVjZWl2ZVF1YW50aXR5KSk7CgogICAgICAgIC8vIFVwZGF0ZSBvd25lZEFzc2V0cyBhcnJheSBhbmQgaXNJbkFzc2V0TGlzdCBtYXBwaW5nCiAgICAgICAgaWYgKCFpc0luQXNzZXRMaXN0W29yZGVyLnNlbGxBc3NldF0pIHsKICAgICAgICAgICAgb3duZWRBc3NldHMucHVzaChvcmRlci5zZWxsQXNzZXQpOwogICAgICAgICAgICBpc0luQXNzZXRMaXN0W29yZGVyLnNlbGxBc3NldF0gPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgb3JkZXIuZXhjaGFuZ2VJZCA9IGlkOwogICAgICAgIG9yZGVyLnN0YXR1cyA9IE9yZGVyU3RhdHVzLmZ1bGx5RmlsbGVkOwogICAgICAgIG9yZGVyLm9yZGVyVHlwZSA9IE9yZGVyVHlwZS50YWtlOwogICAgICAgIG9yZGVyLnRpbWVzdGFtcCA9IG5vdzsKICAgICAgICBvcmRlci5maWxsUXVhbnRpdHkgPSByZWNlaXZlUXVhbnRpdHk7CiAgICAgICAgb3JkZXJzLnB1c2gob3JkZXIpOwogICAgICAgIE9yZGVyVXBkYXRlZChpZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FuY2VscyBvcmRlcnMgdGhhdCB3ZXJlIG5vdCBleHBlY3RlZCB0byBzZXR0bGUgaW1tZWRpYXRlbHksIGkuZS4gbWFrZU9yZGVycwogICAgLy8vIEBkZXYgUmVkdWNlIGV4cG9zdXJlIHdpdGggZXhjaGFuZ2UgaW50ZXJhY3Rpb24KICAgIC8vLyBAcGFyYW0gaWQgQWN0aXZlIG9yZGVyIGlkIG9mIHRoaXMgb3JkZXIgYXJyYXkgd2l0aCBvcmRlciBvd25lciBvZiB0aGlzIGNvbnRyYWN0IG9uIHNlbGVjdGVkIEV4Y2hhbmdlCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcih1aW50IGV4Y2hhbmdlTnVtYmVyLCB1aW50IGlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQoaXNPd25lcigpIHx8IGlzU2h1dERvd24pCiAgICB7CiAgICAgICAgLy8gR2V0IGluZm9ybWF0aW9uIG9mIGZ1bmQgb3JkZXIgYnkgb3JkZXIgaWQKICAgICAgICBPcmRlciBvcmRlciA9IG9yZGVyc1tpZF07CgogICAgICAgIC8vIEV4ZWN1dGUgcmVxdWVzdAogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlcikuZGVsZWdhdGVjYWxsKGJ5dGVzNChrZWNjYWsyNTYoImNhbmNlbE9yZGVyKGFkZHJlc3MsdWludDI1NikiKSksIGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2UsIG9yZGVyLmV4Y2hhbmdlSWQpKTsKCiAgICAgICAgb3JkZXIuc3RhdHVzID0gT3JkZXJTdGF0dXMuY2FuY2VsbGVkOwogICAgICAgIE9yZGVyVXBkYXRlZChpZCk7CiAgICB9CgoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgLy8gUFVCTElDIE1FVEhPRFMgOiBFUkMyMjMKCiAgICAvLy8gQGRldiBTdGFuZGFyZCBFUkMyMjMgZnVuY3Rpb24gdGhhdCBoYW5kbGVzIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KICAgIC8vLyBAZGV2IFRoaXMgdHlwZSBvZiByZWRlbXB0aW9uIGNhbiBiZSBzZWVuIGFzIGEgIm1hcmtldCBvcmRlciIsIHdoZXJlIHByaWNlIGlzIGNhbGN1bGF0ZWQgYXQgZXhlY3V0aW9uIHRpbWUKICAgIC8vLyBAcGFyYW0gb2ZTZW5kZXIgIFRva2VuIHNlbmRlciBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB0b2tlbkFtb3VudCBBbW91bnQgb2YgdG9rZW5zIHNlbnQuCiAgICAvLy8gQHBhcmFtIG1ldGFkYXRhICBUcmFuc2FjdGlvbiBtZXRhZGF0YS4KICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soCiAgICAgICAgYWRkcmVzcyBvZlNlbmRlciwKICAgICAgICB1aW50IHRva2VuQW1vdW50LAogICAgICAgIGJ5dGVzIG1ldGFkYXRhCiAgICApIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIC8vIHdoZW4gb2ZTZW5kZXIgaXMgYSByZWNvZ25pemVkIGV4Y2hhbmdlLCByZWNlaXZlIHRva2Vucywgb3RoZXJ3aXNlIHJldmVydAogICAgICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IGV4Y2hhbmdlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGV4Y2hhbmdlc1tpXS5leGNoYW5nZSA9PSBvZlNlbmRlcikgcmV0dXJuOyAvLyByZWNlaXZlIHRva2VucyBhbmQgZG8gbm90aGluZwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0gZWxzZSB7ICAgIC8vIG90aGVyd2lzZSwgbWFrZSBhIHJlZGVtcHRpb24gcmVxdWVzdAogICAgICAgICAgICByZXF1ZXN0cy5wdXNoKFJlcXVlc3QoewogICAgICAgICAgICAgICAgcGFydGljaXBhbnQ6IG9mU2VuZGVyLAogICAgICAgICAgICAgICAgc3RhdHVzOiBSZXF1ZXN0U3RhdHVzLmFjdGl2ZSwKICAgICAgICAgICAgICAgIHJlcXVlc3RUeXBlOiBSZXF1ZXN0VHlwZS50b2tlbkZhbGxiYWNrUmVkZWVtLAogICAgICAgICAgICAgICAgcmVxdWVzdEFzc2V0OiBhZGRyZXNzKFFVT1RFX0FTU0VUKSwgLy8gcmVkZWVtIGluIFFVT1RFX0FTU0VUCiAgICAgICAgICAgICAgICBzaGFyZVF1YW50aXR5OiB0b2tlbkFtb3VudCwKICAgICAgICAgICAgICAgIGdpdmVRdWFudGl0eTogdG9rZW5BbW91bnQsICAgICAgICAgICAgICAvLyBzaGFyZXMgYmVpbmcgc2VudAogICAgICAgICAgICAgICAgcmVjZWl2ZVF1YW50aXR5OiAwLCAgICAgICAgICAvLyB2YWx1ZSBvZiB0aGUgc2hhcmVzIGF0IHJlcXVlc3QgdGltZQogICAgICAgICAgICAgICAgdGltZXN0YW1wOiBub3csCiAgICAgICAgICAgICAgICBhdFVwZGF0ZUlkOiBtb2R1bGUucHJpY2VmZWVkLmdldExhc3RVcGRhdGVJZCgpCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgUmVxdWVzdFVwZGF0ZWQoZ2V0TGFzdFJlcXVlc3RJZCgpKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8vIFBVQkxJQyBNRVRIT0RTIDogQUNDT1VOVElORwoKICAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZXMgZ3Jvc3MgYXNzZXQgdmFsdWUgb2YgdGhlIGZ1bmQKICAgIC8vLyBAZGV2IERlY2ltYWxzIGluIGFzc2V0cyBtdXN0IGJlIGVxdWFsIHRvIGRlY2ltYWxzIGluIFByaWNlRmVlZCBmb3IgYWxsIGVudHJpZXMgaW4gQXNzZXRSZWdpc3RyYXIKICAgIC8vLyBAZGV2IEFzc3VtZXMgdGhhdCBtb2R1bGUucHJpY2VmZWVkLmdldFByaWNlKC4uKSByZXR1cm5zIHJlY2VudCBwcmljZXMKICAgIC8vLyBAcmV0dXJuIGdhdiBHcm9zcyBhc3NldCB2YWx1ZSBxdW90ZWQgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgZnVuY3Rpb24gY2FsY0dhdigpIHJldHVybnMgKHVpbnQgZ2F2KSB7CiAgICAgICAgLy8gcHJpY2VzIHF1b3RlZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBhc3NldERlY2ltYWwKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IHRlbXBPd25lZEFzc2V0czsgLy8gVG8gc3RvcmUgb3duZWRBc3NldHMKICAgICAgICB0ZW1wT3duZWRBc3NldHMgPSBvd25lZEFzc2V0czsKICAgICAgICBkZWxldGUgb3duZWRBc3NldHM7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdGVtcE93bmVkQXNzZXRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGFkZHJlc3Mgb2ZBc3NldCA9IHRlbXBPd25lZEFzc2V0c1tpXTsKICAgICAgICAgICAgLy8gYXNzZXRIb2xkaW5ncyBmb3JtYXR0aW5nOiBtdWwoZXhjaGFuZ2VIb2xkaW5ncywgMTAgKiogYXNzZXREZWNpbWFsKQogICAgICAgICAgICB1aW50IGFzc2V0SG9sZGluZ3MgPSBhZGQoCiAgICAgICAgICAgICAgICB1aW50KEFzc2V0SW50ZXJmYWNlKG9mQXNzZXQpLmJhbGFuY2VPZih0aGlzKSksIC8vIGFzc2V0IGJhc2UgdW5pdHMgaGVsZCBieSBmdW5kCiAgICAgICAgICAgICAgICBxdWFudGl0eUhlbGRJbkN1c3RvZHlPZkV4Y2hhbmdlKG9mQXNzZXQpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIC8vIGFzc2V0UHJpY2UgZm9ybWF0dGluZzogbXVsKGV4Y2hhbmdlUHJpY2UsIDEwICoqIGFzc2V0RGVjaW1hbCkKICAgICAgICAgICAgdmFyIChpc1JlY2VudCwgYXNzZXRQcmljZSwgYXNzZXREZWNpbWFscykgPSBtb2R1bGUucHJpY2VmZWVkLmdldFByaWNlKG9mQXNzZXQpOwogICAgICAgICAgICBpZiAoIWlzUmVjZW50KSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBnYXYgYXMgc3VtIG9mIG11bChhc3NldEhvbGRpbmdzLCBhc3NldFByaWNlKSB3aXRoIGZvcm1hdHRpbmc6IG11bChtdWwoZXhjaGFuZ2VIb2xkaW5ncywgZXhjaGFuZ2VQcmljZSksIDEwICoqIHNoYXJlRGVjaW1hbHMpCiAgICAgICAgICAgIGdhdiA9IGFkZChnYXYsIG11bChhc3NldEhvbGRpbmdzLCBhc3NldFByaWNlKSAvICgxMCAqKiB1aW50MjU2KGFzc2V0RGVjaW1hbHMpKSk7ICAgLy8gU3VtIHVwIHByb2R1Y3Qgb2YgYXNzZXQgaG9sZGluZ3Mgb2YgdGhpcyB2YXVsdCBhbmQgYXNzZXQgcHJpY2VzCiAgICAgICAgICAgIGlmIChhc3NldEhvbGRpbmdzICE9IDAgfHwgb2ZBc3NldCA9PSBhZGRyZXNzKFFVT1RFX0FTU0VUKSB8fCBpc0luT3Blbk1ha2VPcmRlcltvZkFzc2V0XSkgeyAvLyBDaGVjayBpZiBhc3NldCBob2xkaW5ncyBpcyBub3QgemVybyBvciBpcyBhZGRyZXNzKFFVT1RFX0FTU0VUKSBvciBpbiBvcGVuIG1ha2Ugb3JkZXIKICAgICAgICAgICAgICAgIG93bmVkQXNzZXRzLnB1c2gob2ZBc3NldCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpc0luQXNzZXRMaXN0W29mQXNzZXRdID0gZmFsc2U7IC8vIFJlbW92ZSBmcm9tIG93bmVkQXNzZXRzIGlmIGFzc2V0IGhvbGRpbmdzIGFyZSB6ZXJvCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUG9ydGZvbGlvQ29udGVudChhc3NldEhvbGRpbmdzLCBhc3NldFByaWNlLCBhc3NldERlY2ltYWxzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIENhbGN1bGF0ZXMgdW5jbGFpbWVkIGZlZXMgb2YgdGhlIGZ1bmQgbWFuYWdlcgogICAgQHBhcmFtIGdhdiBHcm9zcyBhc3NldCB2YWx1ZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICBAcmV0dXJuIHsKICAgICAgIm1hbmFnZW1lbnRGZWVzIjogIkEgdGltZSAoc2Vjb25kcykgYmFzZWQgZmVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMiLAogICAgICAicGVyZm9ybWFuY2VGZWVzIjogIkEgcGVyZm9ybWFuY2UgKHJpc2Ugb2Ygc2hhcmVQcmljZSBtZWFzdXJlZCBpbiBRVU9URV9BU1NFVCkgYmFzZWQgZmVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMiLAogICAgICAidW5jbGFpbWVkZmVlcyI6ICJUaGUgc3VtIG9mIGJvdGggbWFuYWdlbWVudGZlZSBhbmQgcGVyZm9ybWFuY2VmZWUgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscyIKICAgIH0KICAgICovCiAgICBmdW5jdGlvbiBjYWxjVW5jbGFpbWVkRmVlcyh1aW50IGdhdikKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoCiAgICAgICAgICAgIHVpbnQgbWFuYWdlbWVudEZlZSwKICAgICAgICAgICAgdWludCBwZXJmb3JtYW5jZUZlZSwKICAgICAgICAgICAgdWludCB1bmNsYWltZWRGZWVzKQogICAgewogICAgICAgIC8vIE1hbmFnZW1lbnQgZmVlIGNhbGN1bGF0aW9uCiAgICAgICAgdWludCB0aW1lUGFzc2VkID0gc3ViKG5vdywgYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbi50aW1lc3RhbXApOwogICAgICAgIHVpbnQgZ2F2UGVyY2VudGFnZSA9IG11bCh0aW1lUGFzc2VkLCBnYXYpIC8gKDEgeWVhcnMpOwogICAgICAgIG1hbmFnZW1lbnRGZWUgPSB3bXVsKGdhdlBlcmNlbnRhZ2UsIE1BTkFHRU1FTlRfRkVFX1JBVEUpOwoKICAgICAgICAvLyBQZXJmb3JtYW5jZSBmZWUgY2FsY3VsYXRpb24KICAgICAgICAvLyBIYW5kbGUgcG90ZW50aWFsIGRpdmlzaW9uIHRocm91Z2ggemVybyBieSBkZWZpbmluZyBhIGRlZmF1bHQgdmFsdWUKICAgICAgICB1aW50IHZhbHVlUGVyU2hhcmVFeGNsTWdtdEZlZXMgPSB0b3RhbFN1cHBseSA+IDAgPyBjYWxjVmFsdWVQZXJTaGFyZShzdWIoZ2F2LCBtYW5hZ2VtZW50RmVlKSwgdG90YWxTdXBwbHkpIDogdG9TbWFsbGVzdFNoYXJlVW5pdCgxKTsKICAgICAgICBpZiAodmFsdWVQZXJTaGFyZUV4Y2xNZ210RmVlcyA+IGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24uaGlnaFdhdGVyTWFyaykgewogICAgICAgICAgICB1aW50IGdhaW5JblNoYXJlUHJpY2UgPSBzdWIodmFsdWVQZXJTaGFyZUV4Y2xNZ210RmVlcywgYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbi5oaWdoV2F0ZXJNYXJrKTsKICAgICAgICAgICAgdWludCBpbnZlc3RtZW50UHJvZml0cyA9IHdtdWwoZ2FpbkluU2hhcmVQcmljZSwgdG90YWxTdXBwbHkpOwogICAgICAgICAgICBwZXJmb3JtYW5jZUZlZSA9IHdtdWwoaW52ZXN0bWVudFByb2ZpdHMsIFBFUkZPUk1BTkNFX0ZFRV9SQVRFKTsKICAgICAgICB9CgogICAgICAgIC8vIFN1bSBvZiBhbGwgRkVFUwogICAgICAgIHVuY2xhaW1lZEZlZXMgPSBhZGQobWFuYWdlbWVudEZlZSwgcGVyZm9ybWFuY2VGZWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZXMgdGhlIE5ldCBhc3NldCB2YWx1ZSBvZiB0aGlzIGZ1bmQKICAgIC8vLyBAcGFyYW0gZ2F2IEdyb3NzIGFzc2V0IHZhbHVlIG9mIHRoaXMgZnVuZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICAvLy8gQHBhcmFtIHVuY2xhaW1lZEZlZXMgVGhlIHN1bSBvZiBib3RoIG1hbmFnZW1lbnRGZWUgYW5kIHBlcmZvcm1hbmNlRmVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIC8vLyBAcmV0dXJuIG5hdiBOZXQgYXNzZXQgdmFsdWUgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgZnVuY3Rpb24gY2FsY05hdih1aW50IGdhdiwgdWludCB1bmNsYWltZWRGZWVzKQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IG5hdikKICAgIHsKICAgICAgICBuYXYgPSBzdWIoZ2F2LCB1bmNsYWltZWRGZWVzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBzaGFyZSBwcmljZSBvZiB0aGUgZnVuZAogICAgLy8vIEBkZXYgQ29udmVudGlvbiBmb3IgdmFsdWVQZXJTaGFyZSAoPT0gc2hhcmVQcmljZSkgZm9ybWF0dGluZzogbXVsKHRvdGFsVmFsdWUgLyBudW1TaGFyZXMsIDEwICoqIGRlY2ltYWwpLCB0byBhdm9pZCBmbG9hdGluZyBudW1iZXJzCiAgICAvLy8gQGRldiBOb24temVybyBzaGFyZSBzdXBwbHk7IHZhbHVlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0KICAgIC8vLyBAcGFyYW0gdG90YWxWYWx1ZSB0aGUgdG90YWwgdmFsdWUgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgLy8vIEBwYXJhbSBudW1TaGFyZXMgdGhlIG51bWJlciBvZiBzaGFyZXMgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICAvLy8gQHJldHVybiB2YWx1ZVBlclNoYXJlIFNoYXJlIHByaWNlIGRlbm9taW5hdGVkIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIGZ1bmN0aW9uIGNhbGNWYWx1ZVBlclNoYXJlKHVpbnQgdG90YWxWYWx1ZSwgdWludCBudW1TaGFyZXMpCiAgICAgICAgdmlldwogICAgICAgIHByZV9jb25kKG51bVNoYXJlcyA+IDApCiAgICAgICAgcmV0dXJucyAodWludCB2YWx1ZVBlclNoYXJlKQogICAgewogICAgICAgIHZhbHVlUGVyU2hhcmUgPSB0b1NtYWxsZXN0U2hhcmVVbml0KHRvdGFsVmFsdWUpIC8gbnVtU2hhcmVzOwogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBDYWxjdWxhdGVzIGVzc2VudGlhbCBmdW5kIG1ldHJpY3MKICAgIEByZXR1cm4gewogICAgICAiZ2F2IjogIkdyb3NzIGFzc2V0IHZhbHVlIG9mIHRoaXMgZnVuZCBkZW5vbWluYXRlZCBpbiBbYmFzZSB1bml0IG9mIG1lbG9uQXNzZXRdIiwKICAgICAgIm1hbmFnZW1lbnRGZWUiOiAiQSB0aW1lIChzZWNvbmRzKSBiYXNlZCBmZWUiLAogICAgICAicGVyZm9ybWFuY2VGZWUiOiAiQSBwZXJmb3JtYW5jZSAocmlzZSBvZiBzaGFyZVByaWNlIG1lYXN1cmVkIGluIFFVT1RFX0FTU0VUKSBiYXNlZCBmZWUiLAogICAgICAidW5jbGFpbWVkRmVlcyI6ICJUaGUgc3VtIG9mIGJvdGggbWFuYWdlbWVudEZlZSBhbmQgcGVyZm9ybWFuY2VGZWUgZGVub21pbmF0ZWQgaW4gW2Jhc2UgdW5pdCBvZiBtZWxvbkFzc2V0XSIsCiAgICAgICJmZWVzU2hhcmVRdWFudGl0eSI6ICJUaGUgbnVtYmVyIG9mIHNoYXJlcyB0byBiZSBnaXZlbiBhcyBmZWVzIHRvIHRoZSBtYW5hZ2VyIiwKICAgICAgIm5hdiI6ICJOZXQgYXNzZXQgdmFsdWUgZGVub21pbmF0ZWQgaW4gW2Jhc2UgdW5pdCBvZiBtZWxvbkFzc2V0XSIsCiAgICAgICJzaGFyZVByaWNlIjogIlNoYXJlIHByaWNlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0iCiAgICB9CiAgICAqLwogICAgZnVuY3Rpb24gcGVyZm9ybUNhbGN1bGF0aW9ucygpCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgICAgICB1aW50IGdhdiwKICAgICAgICAgICAgdWludCBtYW5hZ2VtZW50RmVlLAogICAgICAgICAgICB1aW50IHBlcmZvcm1hbmNlRmVlLAogICAgICAgICAgICB1aW50IHVuY2xhaW1lZEZlZXMsCiAgICAgICAgICAgIHVpbnQgZmVlc1NoYXJlUXVhbnRpdHksCiAgICAgICAgICAgIHVpbnQgbmF2LAogICAgICAgICAgICB1aW50IHNoYXJlUHJpY2UKICAgICAgICApCiAgICB7CiAgICAgICAgZ2F2ID0gY2FsY0dhdigpOyAvLyBSZWZsZWN0cyB2YWx1ZSBpbmRlcGVuZGVudCBvZiBmZWVzCiAgICAgICAgKG1hbmFnZW1lbnRGZWUsIHBlcmZvcm1hbmNlRmVlLCB1bmNsYWltZWRGZWVzKSA9IGNhbGNVbmNsYWltZWRGZWVzKGdhdik7CiAgICAgICAgbmF2ID0gY2FsY05hdihnYXYsIHVuY2xhaW1lZEZlZXMpOwoKICAgICAgICAvLyBUaGUgdmFsdWUgb2YgdW5jbGFpbWVkRmVlcyBtZWFzdXJlZCBpbiBzaGFyZXMgb2YgdGhpcyBmdW5kIGF0IGN1cnJlbnQgdmFsdWUKICAgICAgICBmZWVzU2hhcmVRdWFudGl0eSA9IChnYXYgPT0gMCkgPyAwIDogbXVsKHRvdGFsU3VwcGx5LCB1bmNsYWltZWRGZWVzKSAvIGdhdjsKICAgICAgICAvLyBUaGUgdG90YWwgc2hhcmUgc3VwcGx5IGluY2x1ZGluZyB0aGUgdmFsdWUgb2YgdW5jbGFpbWVkRmVlcywgbWVhc3VyZWQgaW4gc2hhcmVzIG9mIHRoaXMgZnVuZAogICAgICAgIHVpbnQgdG90YWxTdXBwbHlBY2NvdW50aW5nRm9yRmVlcyA9IGFkZCh0b3RhbFN1cHBseSwgZmVlc1NoYXJlUXVhbnRpdHkpOwogICAgICAgIHNoYXJlUHJpY2UgPSBuYXYgPiAwID8gY2FsY1ZhbHVlUGVyU2hhcmUobmF2LCB0b3RhbFN1cHBseUFjY291bnRpbmdGb3JGZWVzKSA6IHRvU21hbGxlc3RTaGFyZVVuaXQoMSk7IC8vIEhhbmRsZSBwb3RlbnRpYWwgZGl2aXNpb24gdGhyb3VnaCB6ZXJvIGJ5IGRlZmluaW5nIGEgZGVmYXVsdCB2YWx1ZQogICAgfQoKICAgIC8vLyBAbm90aWNlIENvbnZlcnRzIHVuY2xhaW1lZCBmZWVzIG9mIHRoZSBtYW5hZ2VyIGludG8gZnVuZCBzaGFyZXMKICAgIC8vLyBAZGV2IE9ubHkgT3duZXIKICAgIGZ1bmN0aW9uIGFsbG9jYXRlVW5jbGFpbWVkRmVlcygpCiAgICAgICAgcHJlX2NvbmQoaXNPd25lcigpKQogICAgewogICAgICAgIHZhciAoCiAgICAgICAgICAgIGdhdiwKICAgICAgICAgICAgbWFuYWdlbWVudEZlZSwKICAgICAgICAgICAgcGVyZm9ybWFuY2VGZWUsCiAgICAgICAgICAgIHVuY2xhaW1lZEZlZXMsCiAgICAgICAgICAgIGZlZXNTaGFyZVF1YW50aXR5LAogICAgICAgICAgICBuYXYsCiAgICAgICAgICAgIHNoYXJlUHJpY2UKICAgICAgICApID0gcGVyZm9ybUNhbGN1bGF0aW9ucygpOwoKICAgICAgICBjcmVhdGVTaGFyZXMob3duZXIsIGZlZXNTaGFyZVF1YW50aXR5KTsgLy8gVXBkYXRlcyB0b3RhbFN1cHBseSBieSBjcmVhdGluZyBzaGFyZXMgYWxsb2NhdGVkIHRvIG1hbmFnZXIKCiAgICAgICAgLy8gVXBkYXRlIENhbGN1bGF0aW9ucwogICAgICAgIHVpbnQgaGlnaFdhdGVyTWFyayA9IGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24uaGlnaFdhdGVyTWFyayA+PSBzaGFyZVByaWNlID8gYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbi5oaWdoV2F0ZXJNYXJrIDogc2hhcmVQcmljZTsKICAgICAgICBhdExhc3RVbmNsYWltZWRGZWVBbGxvY2F0aW9uID0gQ2FsY3VsYXRpb25zKHsKICAgICAgICAgICAgZ2F2OiBnYXYsCiAgICAgICAgICAgIG1hbmFnZW1lbnRGZWU6IG1hbmFnZW1lbnRGZWUsCiAgICAgICAgICAgIHBlcmZvcm1hbmNlRmVlOiBwZXJmb3JtYW5jZUZlZSwKICAgICAgICAgICAgdW5jbGFpbWVkRmVlczogdW5jbGFpbWVkRmVlcywKICAgICAgICAgICAgbmF2OiBuYXYsCiAgICAgICAgICAgIGhpZ2hXYXRlck1hcms6IGhpZ2hXYXRlck1hcmssCiAgICAgICAgICAgIHRvdGFsU3VwcGx5OiB0b3RhbFN1cHBseSwKICAgICAgICAgICAgdGltZXN0YW1wOiBub3cKICAgICAgICB9KTsKCiAgICAgICAgRmVlc0NvbnZlcnRlZChub3csIGZlZXNTaGFyZVF1YW50aXR5LCB1bmNsYWltZWRGZWVzKTsKICAgICAgICBDYWxjdWxhdGlvblVwZGF0ZShub3csIG1hbmFnZW1lbnRGZWUsIHBlcmZvcm1hbmNlRmVlLCBuYXYsIHNoYXJlUHJpY2UsIHRvdGFsU3VwcGx5KTsKICAgIH0KCiAgICAvLyBQVUJMSUMgOiBSRURFRU1JTkcKCiAgICAvLy8gQG5vdGljZSBSZWRlZW1zIGJ5IGFsbG9jYXRpbmcgYW4gb3duZXJzaGlwIHBlcmNlbnRhZ2Ugb25seSBvZiByZXF1ZXN0ZWRBc3NldHMgdG8gdGhlIHBhcnRpY2lwYW50CiAgICAvLy8gQGRldiBJbmRlcGVuZGVudCBvZiBydW5uaW5nIHByaWNlIGZlZWQhIE5vdGU6IGlmIHJlcXVlc3RlZEFzc2V0cyAhPSBvd25lZEFzc2V0cyB0aGVuIHBhcnRpY2lwYW50IG1pc3NlcyBvdXQgb24gc29tZSBvd25lZCB2YWx1ZQogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IE51bWJlciBvZiBzaGFyZXMgb3duZWQgYnkgdGhlIHBhcnRpY2lwYW50LCB3aGljaCB0aGUgcGFydGljaXBhbnQgd291bGQgbGlrZSB0byByZWRlZW0gZm9yIGluZGl2aWR1YWwgYXNzZXRzCiAgICAvLy8gQHBhcmFtIHJlcXVlc3RlZEFzc2V0cyBMaXN0IG9mIGFkZHJlc3NlcyB0aGF0IGNvbnNpdHV0ZSBhIHN1YnNldCBvZiBvd25lZEFzc2V0cy4KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgYWxsIGFzc2V0cyBzZW50IHRvIHNoYXJlaG9sZGVyIG9yIG5vdAogICAgZnVuY3Rpb24gZW1lcmdlbmN5UmVkZWVtKHVpbnQgc2hhcmVRdWFudGl0eSwgYWRkcmVzc1tdIHJlcXVlc3RlZEFzc2V0cykKICAgICAgICBwdWJsaWMKICAgICAgICBwcmVfY29uZChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBzaGFyZVF1YW50aXR5KSAgLy8gc2VuZGVyIG93bnMgZW5vdWdoIHNoYXJlcwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSBvd25lcnNoaXBRdWFudGl0aWVzID0gbmV3IHVpbnRbXShyZXF1ZXN0ZWRBc3NldHMubGVuZ3RoKTsKCiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBlbm91Z2ggYXNzZXRzIGhlbGQgYnkgZnVuZAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJlcXVlc3RlZEFzc2V0cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBhZGRyZXNzIG9mQXNzZXQgPSByZXF1ZXN0ZWRBc3NldHNbaV07CiAgICAgICAgICAgIHVpbnQgYXNzZXRIb2xkaW5ncyA9IGFkZCgKICAgICAgICAgICAgICAgIHVpbnQoQXNzZXRJbnRlcmZhY2Uob2ZBc3NldCkuYmFsYW5jZU9mKHRoaXMpKSwKICAgICAgICAgICAgICAgIHF1YW50aXR5SGVsZEluQ3VzdG9keU9mRXhjaGFuZ2Uob2ZBc3NldCkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmIChhc3NldEhvbGRpbmdzID09IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gcGFydGljaXBhbnQncyBvd25lcnNoaXAgcGVyY2VudGFnZSBvZiBhc3NldCBob2xkaW5ncwogICAgICAgICAgICBvd25lcnNoaXBRdWFudGl0aWVzW2ldID0gbXVsKGFzc2V0SG9sZGluZ3MsIHNoYXJlUXVhbnRpdHkpIC8gdG90YWxTdXBwbHk7CgogICAgICAgICAgICAvLyBDUklUSUNBTCBFUlI6IE5vdCBlbm91Z2ggZnVuZCBhc3NldCBiYWxhbmNlIGZvciBvd2VkIG93bmVyc2hpcFF1YW50aXRpeSwgZWcgaW4gY2FzZSBvZiB1bnJldHVybmVkIGFzc2V0IHF1YW50aXR5IGF0IGFkZHJlc3MoZXhjaGFuZ2VzW2ldLmV4Y2hhbmdlKSBhZGRyZXNzCiAgICAgICAgICAgIGlmICh1aW50KEFzc2V0SW50ZXJmYWNlKG9mQXNzZXQpLmJhbGFuY2VPZih0aGlzKSkgPCBvd25lcnNoaXBRdWFudGl0aWVzW2ldKSB7CiAgICAgICAgICAgICAgICBpc1NodXREb3duID0gdHJ1ZTsKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSgiQ1JJVElDQUwgRVJSOiBOb3QgZW5vdWdoIGFzc2V0SG9sZGluZ3MgZm9yIG93ZWQgb3duZXJzaGlwUXVhbnRpdGl5Iik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEFubmloaWxhdGUgc2hhcmVzIGJlZm9yZSBleHRlcm5hbCBjYWxscyB0byBwcmV2ZW50IHJlZW50cmFuY3kKICAgICAgICBhbm5paGlsYXRlU2hhcmVzKG1zZy5zZW5kZXIsIHNoYXJlUXVhbnRpdHkpOwoKICAgICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXBRdWFudGl0eSBvZiBBc3NldHMKICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCBvd25lcnNoaXBRdWFudGl0aWVzLmxlbmd0aDsgKytqKSB7CiAgICAgICAgICAgIC8vIEZhaWxlZCB0byBzZW5kIG93ZWQgb3duZXJzaGlwUXVhbnRpdHkgZnJvbSBmdW5kIHRvIHBhcnRpY2lwYW50CiAgICAgICAgICAgIGlmICghQXNzZXRJbnRlcmZhY2Uob2ZBc3NldCkudHJhbnNmZXIobXNnLnNlbmRlciwgb3duZXJzaGlwUXVhbnRpdGllc1tqXSkpIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlZGVlbWVkKG1zZy5zZW5kZXIsIG5vdywgc2hhcmVRdWFudGl0eSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUFVCTElDIDogRkVFUwoKICAgIC8vLyBAZGV2IFF1YW50aXR5IG9mIGFzc2V0IGhlbGQgaW4gZXhjaGFuZ2UgYWNjb3JkaW5nIHRvIGFzc29jaWF0ZWQgb3JkZXIgaWQKICAgIC8vLyBAcGFyYW0gb2ZBc3NldCBBZGRyZXNzIG9mIGFzc2V0CiAgICAvLy8gQHJldHVybiBRdWFudGl0eSBvZiBpbnB1dCBhc3NldCBoZWxkIGluIGV4Y2hhbmdlCiAgICBmdW5jdGlvbiBxdWFudGl0eUhlbGRJbkN1c3RvZHlPZkV4Y2hhbmdlKGFkZHJlc3Mgb2ZBc3NldCkgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgdG90YWxTZWxsUXVhbnRpdHk7ICAgICAvLyBxdWFudGl0eSBpbiBjdXN0b2R5IGFjcm9zcyBleGNoYW5nZXMKICAgICAgICB1aW50IHRvdGFsU2VsbFF1YW50aXR5SW5BcHByb3ZlOyAvLyBxdWFudGl0eSBvZiBhc3NldCBpbiBhcHByb3ZlIChhbGxvd2FuY2UpIGJ1dCBub3QgY3VzdG9keSBvZiBleGNoYW5nZQogICAgICAgIGZvciAodWludCBpOyBpIDwgZXhjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkc1tpXVtvZkFzc2V0XSA9PSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgKHNlbGxBc3NldCwgLCBzZWxsUXVhbnRpdHksICkgPSBleGNoYW5nZXNbaV0uZXhjaGFuZ2VBZGFwdGVyLmdldE9yZGVyKGV4Y2hhbmdlc1tpXS5leGNoYW5nZSwgZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbaV1bb2ZBc3NldF0pOwogICAgICAgICAgICBpZiAoc2VsbFF1YW50aXR5ID09IDApIHsKICAgICAgICAgICAgICAgIGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2ldW29mQXNzZXRdID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b3RhbFNlbGxRdWFudGl0eSA9IGFkZCh0b3RhbFNlbGxRdWFudGl0eSwgc2VsbFF1YW50aXR5KTsKICAgICAgICAgICAgaWYgKGV4Y2hhbmdlc1tpXS5pc0FwcHJvdmVPbmx5KSB7CiAgICAgICAgICAgICAgICB0b3RhbFNlbGxRdWFudGl0eUluQXBwcm92ZSArPSBzZWxsUXVhbnRpdHk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRvdGFsU2VsbFF1YW50aXR5ID09IDApIHsKICAgICAgICAgICAgaXNJbk9wZW5NYWtlT3JkZXJbc2VsbEFzc2V0XSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3ViKHRvdGFsU2VsbFF1YW50aXR5LCB0b3RhbFNlbGxRdWFudGl0eUluQXBwcm92ZSk7IC8vIFNpbmNlIHF1YW50aXR5IGluIGFwcHJvdmUgaXMgbm90IGFjdHVhbGx5IGluIGN1c3RvZHkKICAgIH0KCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlcyBzaGFyZVByaWNlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0KICAgIC8vLyBAcmV0dXJuIHNoYXJlUHJpY2UgU2hhcmUgcHJpY2UgZGVub21pbmF0ZWQgaW4gW2Jhc2UgdW5pdCBvZiBtZWxvbkFzc2V0XQogICAgZnVuY3Rpb24gY2FsY1NoYXJlUHJpY2UoKSB2aWV3IHJldHVybnMgKHVpbnQgc2hhcmVQcmljZSkgewogICAgICAgICgsICwgLCAsICwgc2hhcmVQcmljZSkgPSBwZXJmb3JtQ2FsY3VsYXRpb25zKCk7CiAgICAgICAgcmV0dXJuIHNoYXJlUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TW9kdWxlcygpIHZpZXcgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYWRkcmVzcykgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGFkZHJlc3MobW9kdWxlLnByaWNlZmVlZCksCiAgICAgICAgICAgIGFkZHJlc3MobW9kdWxlLmNvbXBsaWFuY2UpLAogICAgICAgICAgICBhZGRyZXNzKG1vZHVsZS5yaXNrbWdtdCkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExhc3RPcmRlcklkKCkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBvcmRlcnMubGVuZ3RoIC0gMTsgfQogICAgZnVuY3Rpb24gZ2V0TGFzdFJlcXVlc3RJZCgpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gcmVxdWVzdHMubGVuZ3RoIC0gMTsgfQogICAgZnVuY3Rpb24gZ2V0TmFtZUhhc2goKSB2aWV3IHJldHVybnMgKGJ5dGVzMzIpIHsgcmV0dXJuIGJ5dGVzMzIoa2VjY2FrMjU2KG5hbWUpKTsgfQogICAgZnVuY3Rpb24gZ2V0TWFuYWdlcigpIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gb3duZXI7IH0KfQoKaW50ZXJmYWNlIEV4Y2hhbmdlSW50ZXJmYWNlIHsKCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBPcmRlclVwZGF0ZWQodWludCBpZCk7CgogICAgLy8gTUVUSE9EUwogICAgLy8gRVhURVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIG1ha2VPcmRlcigKICAgICAgICBhZGRyZXNzIG9uRXhjaGFuZ2UsCiAgICAgICAgYWRkcmVzcyBzZWxsQXNzZXQsCiAgICAgICAgYWRkcmVzcyBidXlBc3NldCwKICAgICAgICB1aW50IHNlbGxRdWFudGl0eSwKICAgICAgICB1aW50IGJ1eVF1YW50aXR5CiAgICApIGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdGFrZU9yZGVyKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCwgdWludCBxdWFudGl0eSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcihhZGRyZXNzIG9uRXhjaGFuZ2UsIHVpbnQgaWQpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwoKCiAgICAvLyBQVUJMSUMgTUVUSE9EUwogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGlzQXBwcm92ZU9ubHkoKSB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0TGFzdE9yZGVySWQoYWRkcmVzcyBvbkV4Y2hhbmdlKSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gaXNBY3RpdmUoYWRkcmVzcyBvbkV4Y2hhbmdlLCB1aW50IGlkKSB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0T3duZXIoYWRkcmVzcyBvbkV4Y2hhbmdlLCB1aW50IGlkKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gZ2V0T3JkZXIoYWRkcmVzcyBvbkV4Y2hhbmdlLCB1aW50IGlkKSB2aWV3IHJldHVybnMgKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQsIHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0VGltZXN0YW1wKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zICh1aW50KTsKCn0KCmludGVyZmFjZSBQcmljZUZlZWRJbnRlcmZhY2UgewoKICAgIC8vIEVWRU5UUwoKICAgIGV2ZW50IFByaWNlVXBkYXRlZCh1aW50IHRpbWVzdGFtcCk7CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICBmdW5jdGlvbiB1cGRhdGUoYWRkcmVzc1tdIG9mQXNzZXRzLCB1aW50W10gbmV3UHJpY2VzKTsKCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgLy8gR2V0IGFzc2V0IHNwZWNpZmljIGluZm9ybWF0aW9uCiAgICBmdW5jdGlvbiBnZXROYW1lKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICAgZnVuY3Rpb24gZ2V0U3ltYm9sKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoYWRkcmVzcyBvZkFzc2V0KSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgLy8gR2V0IHByaWNlIGZlZWQgb3BlcmF0aW9uIHNwZWNpZmljIGluZm9ybWF0aW9uCiAgICBmdW5jdGlvbiBnZXRRdW90ZUFzc2V0KCkgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldEludGVydmFsKCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldFZhbGlkaXR5KCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldExhc3RVcGRhdGVJZCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICAvLyBHZXQgYXNzZXQgc3BlY2lmaWMgaW5mb3JtYXRpb24gYXMgdXBkYXRlZCBpbiBwcmljZSBmZWVkCiAgICBmdW5jdGlvbiBoYXNSZWNlbnRQcmljZShhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoYm9vbCBpc1JlY2VudCk7CiAgICBmdW5jdGlvbiBoYXNSZWNlbnRQcmljZXMoYWRkcmVzc1tdIG9mQXNzZXRzKSB2aWV3IHJldHVybnMgKGJvb2wgYXJlUmVjZW50KTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zIChib29sIGlzUmVjZW50LCB1aW50IHByaWNlLCB1aW50IGRlY2ltYWwpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2VzKGFkZHJlc3NbXSBvZkFzc2V0cykgdmlldyByZXR1cm5zIChib29sIGFyZVJlY2VudCwgdWludFtdIHByaWNlcywgdWludFtdIGRlY2ltYWxzKTsKICAgIGZ1bmN0aW9uIGdldEludmVydGVkUHJpY2UoYWRkcmVzcyBvZkFzc2V0KSB2aWV3IHJldHVybnMgKGJvb2wgaXNSZWNlbnQsIHVpbnQgaW52ZXJ0ZWRQcmljZSwgdWludCBkZWNpbWFsKTsKICAgIGZ1bmN0aW9uIGdldFJlZmVyZW5jZVByaWNlKGFkZHJlc3Mgb2ZCYXNlLCBhZGRyZXNzIG9mUXVvdGUpIHZpZXcgcmV0dXJucyAoYm9vbCBpc1JlY2VudCwgdWludCByZWZlcmVuY2VQcmljZSwgdWludCBkZWNpbWFsKTsKICAgIGZ1bmN0aW9uIGdldE9yZGVyUHJpY2UoCiAgICAgICAgYWRkcmVzcyBzZWxsQXNzZXQsCiAgICAgICAgYWRkcmVzcyBidXlBc3NldCwKICAgICAgICB1aW50IHNlbGxRdWFudGl0eSwKICAgICAgICB1aW50IGJ1eVF1YW50aXR5CiAgICApIHZpZXcgcmV0dXJucyAodWludCBvcmRlclByaWNlKTsKICAgIGZ1bmN0aW9uIGV4aXN0c1ByaWNlT25Bc3NldFBhaXIoYWRkcmVzcyBzZWxsQXNzZXQsIGFkZHJlc3MgYnV5QXNzZXQpIHZpZXcgcmV0dXJucyAoYm9vbCBpc0V4aXN0ZW50KTsKfQoKaW50ZXJmYWNlIFJpc2tNZ210SW50ZXJmYWNlIHsKCiAgICAvLyBNRVRIT0RTCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIGlmIHRoZSBtYWtlT3JkZXIgcHJpY2UgaXMgcmVhc29uYWJsZSBhbmQgbm90IG1hbmlwdWxhdGl2ZQogICAgLy8vIEBwYXJhbSBvcmRlclByaWNlIFByaWNlIG9mIE9yZGVyCiAgICAvLy8gQHBhcmFtIHJlZmVyZW5jZVByaWNlIFJlZmVyZW5jZSBwcmljZSBvYnRhaW5lZCB0aHJvdWdoIFByaWNlRmVlZCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBzZWxsQXNzZXQgQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBzb2xkCiAgICAvLy8gQHBhcmFtIGJ1eUFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgYm91Z2h0CiAgICAvLy8gQHBhcmFtIHNlbGxRdWFudGl0eSBRdWFudGl0eSBvZiBzZWxsQXNzZXQgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlRdWFudGl0eSBRdWFudGl0eSBvZiBidXlBc3NldCB0byBiZSBib3VnaHQKICAgIC8vLyBAcmV0dXJuIElmIG1ha2VPcmRlciBpcyBwZXJtaXR0ZWQKICAgIGZ1bmN0aW9uIGlzTWFrZVBlcm1pdHRlZCgKICAgICAgICB1aW50IG9yZGVyUHJpY2UsCiAgICAgICAgdWludCByZWZlcmVuY2VQcmljZSwKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldCwKICAgICAgICBhZGRyZXNzIGJ1eUFzc2V0LAogICAgICAgIHVpbnQgc2VsbFF1YW50aXR5LAogICAgICAgIHVpbnQgYnV5UXVhbnRpdHkKICAgICkgdmlldyByZXR1cm5zIChib29sKTsKCiAgICAvLy8gQG5vdGljZSBDaGVja3MgaWYgdGhlIHRha2VPcmRlciBwcmljZSBpcyByZWFzb25hYmxlIGFuZCBub3QgbWFuaXB1bGF0aXZlCiAgICAvLy8gQHBhcmFtIG9yZGVyUHJpY2UgUHJpY2Ugb2YgT3JkZXIKICAgIC8vLyBAcGFyYW0gcmVmZXJlbmNlUHJpY2UgUmVmZXJlbmNlIHByaWNlIG9idGFpbmVkIHRocm91Z2ggUHJpY2VGZWVkIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIHNlbGxBc3NldCBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIHNvbGQKICAgIC8vLyBAcGFyYW0gYnV5QXNzZXQgQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBib3VnaHQKICAgIC8vLyBAcGFyYW0gc2VsbFF1YW50aXR5IFF1YW50aXR5IG9mIHNlbGxBc3NldCB0byBiZSBzb2xkCiAgICAvLy8gQHBhcmFtIGJ1eVF1YW50aXR5IFF1YW50aXR5IG9mIGJ1eUFzc2V0IHRvIGJlIGJvdWdodAogICAgLy8vIEByZXR1cm4gSWYgdGFrZU9yZGVyIGlzIHBlcm1pdHRlZAogICAgZnVuY3Rpb24gaXNUYWtlUGVybWl0dGVkKAogICAgICAgIHVpbnQgb3JkZXJQcmljZSwKICAgICAgICB1aW50IHJlZmVyZW5jZVByaWNlLAogICAgICAgIGFkZHJlc3Mgc2VsbEFzc2V0LAogICAgICAgIGFkZHJlc3MgYnV5QXNzZXQsCiAgICAgICAgdWludCBzZWxsUXVhbnRpdHksCiAgICAgICAgdWludCBidXlRdWFudGl0eQogICAgKSB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgppbnRlcmZhY2UgVmVyc2lvbkludGVyZmFjZSB7CgogICAgLy8gRVZFTlRTCgogICAgZXZlbnQgRnVuZFVwZGF0ZWQodWludCBpZCk7CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBzaHV0RG93bigpIGV4dGVybmFsOwoKICAgIGZ1bmN0aW9uIHNldHVwRnVuZCgKICAgICAgICBzdHJpbmcgb2ZGdW5kTmFtZSwKICAgICAgICBhZGRyZXNzIG9mUXVvdGVBc3NldCwKICAgICAgICB1aW50IG9mTWFuYWdlbWVudEZlZSwKICAgICAgICB1aW50IG9mUGVyZm9ybWFuY2VGZWUsCiAgICAgICAgYWRkcmVzcyBvZkNvbXBsaWFuY2UsCiAgICAgICAgYWRkcmVzcyBvZlJpc2tNZ210LAogICAgICAgIGFkZHJlc3Mgb2ZQcmljZUZlZWQsCiAgICAgICAgYWRkcmVzc1tdIG9mRXhjaGFuZ2VzLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlQWRhcHRlcnMsCiAgICAgICAgdWludDggdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzCiAgICApOwogICAgZnVuY3Rpb24gc2h1dERvd25GdW5kKGFkZHJlc3Mgb2ZGdW5kKTsKCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgZnVuY3Rpb24gZ2V0TmF0aXZlQXNzZXQoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gZ2V0RnVuZEJ5SWQodWludCB3aXRoSWQpIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRMYXN0RnVuZElkKCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldEZ1bmRCeU1hbmFnZXIoYWRkcmVzcyBvZk1hbmFnZXIpIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiB0ZXJtc0FuZENvbmRpdGlvbnNBcmVTaWduZWQodWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHZpZXcgcmV0dXJucyAoYm9vbCBzaWduZWQpOwoKfQoKY29udHJhY3QgVmVyc2lvbiBpcyBEQkMsIE93bmVkLCBWZXJzaW9uSW50ZXJmYWNlIHsKICAgIC8vIEZJRUxEUwoKICAgIC8vIENvbnN0YW50IGZpZWxkcwogICAgYnl0ZXMzMiBwdWJsaWMgY29uc3RhbnQgVEVSTVNfQU5EX0NPTkRJVElPTlMgPSAweDQ3MTczMjg1YThkNzM0MWU1ZTk3MmZjNjc3Mjg2Mzg0ZjgwMmY4ZWY0MmE1ZWM1ZjAzYmJmYTI1NGNiMDFmYWQ7IC8vIEhhc2hlZCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBhcyBkaXNwbGF5ZWQgb24gSVBGUy4KICAgIC8vIENvbnN0cnVjdG9yIGZpZWxkcwogICAgc3RyaW5nIHB1YmxpYyBWRVJTSU9OX05VTUJFUjsgLy8gU2VtVmVyIG9mIE1lbG9uIHByb3RvY29sIHZlcnNpb24KICAgIGFkZHJlc3MgcHVibGljIE5BVElWRV9BU1NFVDsgLy8gQWRkcmVzcyBvZiB3cmFwcGVkIG5hdGl2ZSBhc3NldCBjb250cmFjdAogICAgYWRkcmVzcyBwdWJsaWMgR09WRVJOQU5DRTsgLy8gQWRkcmVzcyBvZiBNZWxvbiBwcm90b2NvbCBnb3Zlcm5hbmNlIGNvbnRyYWN0CiAgICAvLyBNZXRob2RzIGZpZWxkcwogICAgYm9vbCBwdWJsaWMgaXNTaHV0RG93bjsgLy8gR292ZXJuYW5jZSBmZWF0dXJlLCBpZiB5ZXMgdGhhbiBzZXR1cEZ1bmQgZ2V0cyBibG9ja2VkIGFuZCBzaHV0RG93bkZ1bmQgZ2V0cyBvcGVuZWQKICAgIGFkZHJlc3NbXSBwdWJsaWMgbGlzdE9mRnVuZHM7IC8vIEEgY29tcGxldGUgbGlzdCBvZiBmdW5kIGFkZHJlc3NlcyBjcmVhdGVkIHVzaW5nIHRoaXMgdmVyc2lvbgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBhZGRyZXNzKSBwdWJsaWMgbWFuYWdlclRvRnVuZHM7IC8vIExpbmtzIG1hbmFnZXIgYWRkcmVzcyB0byBmdW5kIGFkZHJlc3MgY3JlYXRlZCB1c2luZyB0aGlzIHZlcnNpb24KCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBGdW5kVXBkYXRlZChhZGRyZXNzIG9mRnVuZCk7CgogICAgLy8gTUVUSE9EUwoKICAgIC8vIENPTlNUUlVDVE9SCgogICAgLy8vIEBwYXJhbSB2ZXJzaW9uTnVtYmVyIFNlbVZlciBvZiBNZWxvbiBwcm90b2NvbCB2ZXJzaW9uCiAgICAvLy8gQHBhcmFtIG9mR292ZXJuYW5jZSBBZGRyZXNzIG9mIE1lbG9uIGdvdmVybmFuY2UgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gb2ZOYXRpdmVBc3NldCBBZGRyZXNzIG9mIHdyYXBwZWQgbmF0aXZlIGFzc2V0IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBWZXJzaW9uKAogICAgICAgIHN0cmluZyB2ZXJzaW9uTnVtYmVyLAogICAgICAgIGFkZHJlc3Mgb2ZHb3Zlcm5hbmNlLAogICAgICAgIGFkZHJlc3Mgb2ZOYXRpdmVBc3NldAogICAgKSB7CiAgICAgICAgVkVSU0lPTl9OVU1CRVIgPSB2ZXJzaW9uTnVtYmVyOwogICAgICAgIEdPVkVSTkFOQ0UgPSBvZkdvdmVybmFuY2U7CiAgICAgICAgTkFUSVZFX0FTU0VUID0gb2ZOYXRpdmVBc3NldDsKICAgIH0KCiAgICAvLyBFWFRFUk5BTCBNRVRIT0RTCgogICAgZnVuY3Rpb24gc2h1dERvd24oKSBleHRlcm5hbCBwcmVfY29uZChtc2cuc2VuZGVyID09IEdPVkVSTkFOQ0UpIHsgaXNTaHV0RG93biA9IHRydWU7IH0KCiAgICAvLyBQVUJMSUMgTUVUSE9EUwoKICAgIC8vLyBAcGFyYW0gb2ZGdW5kTmFtZSBodW1hbi1yZWFkYWJsZSBkZXNjcmlwdGl2ZSBuYW1lIChub3QgbmVjZXNzYXJpbHkgdW5pcXVlKQogICAgLy8vIEBwYXJhbSBvZlF1b3RlQXNzZXQgQXNzZXQgYWdhaW5zdCB3aGljaCBwZXJmb3JtYW5jZSBmZWUgaXMgbWVhc3VyZWQgYWdhaW5zdAogICAgLy8vIEBwYXJhbSBvZk1hbmFnZW1lbnRGZWUgQSB0aW1lIGJhc2VkIGZlZSwgZ2l2ZW4gaW4gYSBudW1iZXIgd2hpY2ggaXMgZGl2aWRlZCBieSAxMCAqKiAxNQogICAgLy8vIEBwYXJhbSBvZlBlcmZvcm1hbmNlRmVlIEEgdGltZSBwZXJmb3JtYW5jZSBiYXNlZCBmZWUsIHBlcmZvcm1hbmNlIHJlbGF0aXZlIHRvIG9mUXVvdGVBc3NldCwgZ2l2ZW4gaW4gYSBudW1iZXIgd2hpY2ggaXMgZGl2aWRlZCBieSAxMCAqKiAxNQogICAgLy8vIEBwYXJhbSBvZkNvbXBsaWFuY2UgQWRkcmVzcyBvZiBwYXJ0aWNpcGF0aW9uIG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZlJpc2tNZ210IEFkZHJlc3Mgb2YgcmlzayBtYW5hZ2VtZW50IG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZlByaWNlRmVlZCBBZGRyZXNzIG9mIHByaWNlIGZlZWQgbW9kdWxlCiAgICAvLy8gQHBhcmFtIG9mRXhjaGFuZ2VzIEFkZHJlc3NlcyBvZiBleGNoYW5nZSBvbiB3aGljaCB0aGlzIGZ1bmQgY2FuIHRyYWRlCiAgICAvLy8gQHBhcmFtIG9mRXhjaGFuZ2VBZGFwdGVycyBBZGRyZXNzZXMgb2YgZXhjaGFuZ2UgYWRhcHRlcnMKICAgIC8vLyBAcGFyYW0gdiBlbGxpcGl0YyBjdXJ2ZSBwYXJhbWV0ZXIgdgogICAgLy8vIEBwYXJhbSByIGVsbGlwaXRjIGN1cnZlIHBhcmFtZXRlciByCiAgICAvLy8gQHBhcmFtIHMgZWxsaXBpdGMgY3VydmUgcGFyYW1ldGVyIHMKICAgIGZ1bmN0aW9uIHNldHVwRnVuZCgKICAgICAgICBzdHJpbmcgb2ZGdW5kTmFtZSwKICAgICAgICBhZGRyZXNzIG9mUXVvdGVBc3NldCwKICAgICAgICB1aW50IG9mTWFuYWdlbWVudEZlZSwKICAgICAgICB1aW50IG9mUGVyZm9ybWFuY2VGZWUsCiAgICAgICAgYWRkcmVzcyBvZkNvbXBsaWFuY2UsCiAgICAgICAgYWRkcmVzcyBvZlJpc2tNZ210LAogICAgICAgIGFkZHJlc3Mgb2ZQcmljZUZlZWQsCiAgICAgICAgYWRkcmVzc1tdIG9mRXhjaGFuZ2VzLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlQWRhcHRlcnMsCiAgICAgICAgdWludDggdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzCiAgICApIHsKICAgICAgICByZXF1aXJlKCFpc1NodXREb3duKTsKICAgICAgICByZXF1aXJlKHRlcm1zQW5kQ29uZGl0aW9uc0FyZVNpZ25lZCh2LCByLCBzKSk7CiAgICAgICAgLy8gRWl0aGVyIG5vdmVsIGZ1bmQgbmFtZSBvciBwcmV2aW91cyBvd25lciBvZiBmdW5kIG5hbWUKICAgICAgICByZXF1aXJlKG1hbmFnZXJUb0Z1bmRzW21zZy5zZW5kZXJdID09IDApOyAvLyBBZGQgbGltaXRhdGlvbiBmb3Igc2ltcGxlciBtaWdyYXRpb24gcHJvY2VzcyBvZiBzaHV0dGluZyBkb3duIGFuZCBzZXR0aW5nIHVwIGZ1bmQKICAgICAgICBhZGRyZXNzIG9mRnVuZCA9IG5ldyBGdW5kKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBvZkZ1bmROYW1lLAogICAgICAgICAgICBvZlF1b3RlQXNzZXQsCiAgICAgICAgICAgIG9mTWFuYWdlbWVudEZlZSwKICAgICAgICAgICAgb2ZQZXJmb3JtYW5jZUZlZSwKICAgICAgICAgICAgTkFUSVZFX0FTU0VULAogICAgICAgICAgICBvZkNvbXBsaWFuY2UsCiAgICAgICAgICAgIG9mUmlza01nbXQsCiAgICAgICAgICAgIG9mUHJpY2VGZWVkLAogICAgICAgICAgICBvZkV4Y2hhbmdlcywKICAgICAgICAgICAgb2ZFeGNoYW5nZUFkYXB0ZXJzCiAgICAgICAgKTsKICAgICAgICBsaXN0T2ZGdW5kcy5wdXNoKG9mRnVuZCk7CiAgICAgICAgbWFuYWdlclRvRnVuZHNbbXNnLnNlbmRlcl0gPSBvZkZ1bmQ7CiAgICAgICAgRnVuZFVwZGF0ZWQob2ZGdW5kKTsKICAgIH0KCiAgICAvLy8gQGRldiBEZXJlZmVyZW5jZSBGdW5kIGFuZCB0cmlnZ2VyIHNlbGZkZXN0cnVjdAogICAgLy8vIEBwYXJhbSBvZkZ1bmQgQWRkcmVzcyBvZiB0aGUgZnVuZCB0byBiZSBzaHV0IGRvd24KICAgIGZ1bmN0aW9uIHNodXREb3duRnVuZChhZGRyZXNzIG9mRnVuZCkKICAgICAgICBwcmVfY29uZChpc1NodXREb3duIHx8IG1hbmFnZXJUb0Z1bmRzW21zZy5zZW5kZXJdID09IG9mRnVuZCkKICAgIHsKICAgICAgICBGdW5kIGZ1bmQgPSBGdW5kKG9mRnVuZCk7CiAgICAgICAgZGVsZXRlIG1hbmFnZXJUb0Z1bmRzW21zZy5zZW5kZXJdOwogICAgICAgIGZ1bmQuc2h1dERvd24oKTsKICAgICAgICBGdW5kVXBkYXRlZChvZkZ1bmQpOwogICAgfQoKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICAvLy8gQGRldiBQcm9vZiB0aGF0IHRlcm1zIGFuZCBjb25kaXRpb25zIGhhdmUgYmVlbiByZWFkIGFuZCB1bmRlcnN0b29kCiAgICAvLy8gQHBhcmFtIHYgZWxsaXBpdGMgY3VydmUgcGFyYW1ldGVyIHYKICAgIC8vLyBAcGFyYW0gciBlbGxpcGl0YyBjdXJ2ZSBwYXJhbWV0ZXIgcgogICAgLy8vIEBwYXJhbSBzIGVsbGlwaXRjIGN1cnZlIHBhcmFtZXRlciBzCiAgICAvLy8gQHJldHVybiBzaWduZWQgV2hldGhlciBvciBub3QgdGVybXMgYW5kIGNvbmRpdGlvbnMgaGF2ZSBiZWVuIHJlYWQgYW5kIHVuZGVyc3Rvb2QKICAgIGZ1bmN0aW9uIHRlcm1zQW5kQ29uZGl0aW9uc0FyZVNpZ25lZCh1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgdmlldyByZXR1cm5zIChib29sIHNpZ25lZCkgewogICAgICAgIHJldHVybiBlY3JlY292ZXIoCiAgICAgICAgICAgIC8vIFBhcml0eSBkb2VzIHByZXBlbmQgXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxue2xlbihtZXNzYWdlKX0gYmVmb3JlIHNpZ25pbmcuCiAgICAgICAgICAgIC8vICBTaWduYXR1cmUgb3JkZXIgaGFzIGFsc28gYmVlbiBjaGFuZ2VkIGluIDEuNi43IGFuZCB1cGNvbWluZyAxLjcueCwKICAgICAgICAgICAgLy8gIGl0IHdpbGwgcmV0dXJuIHJzdiAoc2FtZSBhcyBnZXRoOyB3aGVyZSB2IGlzIFsyNywgMjhdKS4KICAgICAgICAgICAgLy8gTm90ZSB0aGF0IGlmIHlvdSBhcmUgdXNpbmcgZWNyZWNvdmVyLCB2IHdpbGwgYmUgZWl0aGVyICIwMCIgb3IgIjAxIi4KICAgICAgICAgICAgLy8gIEFzIGEgcmVzdWx0LCBpbiBvcmRlciB0byB1c2UgdGhpcyB2YWx1ZSwgeW91IHdpbGwgaGF2ZSB0byBwYXJzZSBpdCB0byBhbgogICAgICAgICAgICAvLyAgaW50ZWdlciBhbmQgdGhlbiBhZGQgMjcuIFRoaXMgd2lsbCByZXN1bHQgaW4gZWl0aGVyIGEgMjcgb3IgYSAyOC4KICAgICAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS93aWtpL3dpa2kvSmF2YVNjcmlwdC1BUEkjd2ViM2V0aHNpZ24KICAgICAgICAgICAga2VjY2FrMjU2KCJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiIsIFRFUk1TX0FORF9DT05ESVRJT05TKSwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICkgPT0gbXNnLnNlbmRlcjsgLy8gSGFzIHNlbmRlciBzaWduZWQgVEVSTVNfQU5EX0NPTkRJVElPTlMKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROYXRpdmVBc3NldCgpIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gTkFUSVZFX0FTU0VUOyB9CiAgICBmdW5jdGlvbiBnZXRGdW5kQnlJZCh1aW50IHdpdGhJZCkgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBsaXN0T2ZGdW5kc1t3aXRoSWRdOyB9CiAgICBmdW5jdGlvbiBnZXRMYXN0RnVuZElkKCkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBsaXN0T2ZGdW5kcy5sZW5ndGggLSAxOyB9CiAgICBmdW5jdGlvbiBnZXRGdW5kQnlNYW5hZ2VyKGFkZHJlc3Mgb2ZNYW5hZ2VyKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsgcmV0dXJuIG1hbmFnZXJUb0Z1bmRzW29mTWFuYWdlcl07IH0KfQ=='.
	

]
