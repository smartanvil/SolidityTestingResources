Class {
	#name : #SRTcdf35c3fe4ccfacb3b1bbedfe71ca3a5ff6f2db1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcdf35c3fe4ccfacb3b1bbedfe71ca3a5ff6f2db1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgoKY29udHJhY3QgRVJDMjIzIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogIAogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX25hbWUpOwogIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBfc3ltYm9sKTsKICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4IF9kZWNpbWFscyk7CiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF9zdXBwbHkpOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEsIHN0cmluZyBjdXN0b21fZmFsbGJhY2spIHB1YmxpYyByZXR1cm5zIChib29sIG9rKTsKICAKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKfQoKY29udHJhY3QgQ29udHJhY3RSZWNlaXZlciB7CiAgICAgCiAgICBzdHJ1Y3QgVEtOIHsKICAgICAgICBhZGRyZXNzIHNlbmRlcjsKICAgICAgICB1aW50IHZhbHVlOwogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgYnl0ZXM0IHNpZzsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHB1cmUgewogICAgICBUS04gbWVtb3J5IHRrbjsKICAgICAgdGtuLnNlbmRlciA9IF9mcm9tOwogICAgICB0a24udmFsdWUgPSBfdmFsdWU7CiAgICAgIHRrbi5kYXRhID0gX2RhdGE7CiAgICAgIHVpbnQzMiB1ID0gdWludDMyKF9kYXRhWzNdKSArICh1aW50MzIoX2RhdGFbMl0pIDw8IDgpICsgKHVpbnQzMihfZGF0YVsxXSkgPDwgMTYpICsgKHVpbnQzMihfZGF0YVswXSkgPDwgMjQpOwogICAgICB0a24uc2lnID0gYnl0ZXM0KHUpOwogICAgICAKICAgICAgLyogdGtuIHZhcmlhYmxlIGlzIGFuYWxvZ3VlIG9mIG1zZyB2YXJpYWJsZSBvZiBFdGhlciB0cmFuc2FjdGlvbgogICAgICAqICB0a24uc2VuZGVyIGlzIHBlcnNvbiB3aG8gaW5pdGlhdGVkIHRoaXMgdG9rZW4gdHJhbnNhY3Rpb24gICAoYW5hbG9ndWUgb2YgbXNnLnNlbmRlcikKICAgICAgKiAgdGtuLnZhbHVlIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRoYXQgd2VyZSBzZW50ICAgKGFuYWxvZ3VlIG9mIG1zZy52YWx1ZSkKICAgICAgKiAgdGtuLmRhdGEgaXMgZGF0YSBvZiB0b2tlbiB0cmFuc2FjdGlvbiAgIChhbmFsb2d1ZSBvZiBtc2cuZGF0YSkKICAgICAgKiAgdGtuLnNpZyBpcyA0IGJ5dGVzIHNpZ25hdHVyZSBvZiBmdW5jdGlvbgogICAgICAqICBpZiBkYXRhIG9mIHRva2VuIHRyYW5zYWN0aW9uIGlzIGEgZnVuY3Rpb24gZXhlY3V0aW9uCiAgICAgICovCiAgICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjIzIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIC8vdXNlciB0b2tlbiBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICAgIC8vdG9rZW4gdHJhbnNlciBwZXJtaXNzaW9ucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSwgc3RyaW5nIF9jdXN0b21fZmFsbGJhY2spIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZihpc0NvbnRyYWN0KF90bykpIHsKICAgICAgICAgICAgaWYgKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA8IF92YWx1ZSkgcmV2ZXJ0KCk7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZU9mKG1zZy5zZW5kZXIpLnN1YihfdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZU9mKF90bykuYWRkKF92YWx1ZSk7CiAgICAgICAgICAgIGFzc2VydChfdG8uY2FsbC52YWx1ZSgwKShieXRlczQoa2VjY2FrMjU2KF9jdXN0b21fZmFsbGJhY2spKSwgbXNnLnNlbmRlciwgX3ZhbHVlLCBfZGF0YSkpOwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHRyYW5zZmVyVG9BZGRyZXNzKF90bywgX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICAKCiAgICAvLyBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBhbm90aGVyIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzIC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAgIAogICAgICAgIGlmKGlzQ29udHJhY3QoX3RvKSkgewogICAgICAgICAgICByZXR1cm4gdHJhbnNmZXJUb0NvbnRyYWN0KF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgICAgCiAgICAvLyBTdGFuZGFyZCBmdW5jdGlvbiB0cmFuc2ZlciBzaW1pbGFyIHRvIEVSQzIwIHRyYW5zZmVyIHdpdGggbm8gX2RhdGEgLgogICAgLy8gQWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgICAKICAgICAgICAvL3N0YW5kYXJkIGZ1bmN0aW9uIHRyYW5zZmVyIHNpbWlsYXIgdG8gRVJDMjAgdHJhbnNmZXIgd2l0aCBubyBfZGF0YQogICAgICAgIC8vYWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMKICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHJldHVybiB0cmFuc2ZlclRvQ29udHJhY3QoX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0cmFuc2ZlclRvQWRkcmVzcyhfdG8sIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vYXNzZW1ibGUgdGhlIGdpdmVuIGFkZHJlc3MgYnl0ZWNvZGUuIElmIGJ5dGVjb2RlIGV4aXN0cyB0aGVuIHRoZSBfYWRkciBpcyBhIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCBpc19jb250cmFjdCkgewogICAgICAgIHVpbnQgbGVuZ3RoOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy9yZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICBsZW5ndGggOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiAobGVuZ3RoID4gMCk7CiAgICB9CgogICAgLy9mdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRyYW5zYWN0aW9uIHRhcmdldCBpcyBhbiBhZGRyZXNzCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvQWRkcmVzcyhhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA8IF92YWx1ZSkgcmV2ZXJ0KCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlT2YobXNnLnNlbmRlcikuc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VPZihfdG8pLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgICAgCiAgICAgIC8vZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0cmFuc2FjdGlvbiB0YXJnZXQgaXMgYSBjb250cmFjdAogICAgICBmdW5jdGlvbiB0cmFuc2ZlclRvQ29udHJhY3QoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKSByZXZlcnQoKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VPZihtc2cuc2VuZGVyKS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZU9mKF90bykuYWRkKF92YWx1ZSk7CiAgICAgICAgQ29udHJhY3RSZWNlaXZlciByZWNlaXZlciA9IENvbnRyYWN0UmVjZWl2ZXIoX3RvKTsKICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRva2VuIHRyYW5zZmVyIGZyb20gZnJvbSB0byBfdG8gKHBlcm1pc3Npb24gbmVlZGVkKQogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludCBfdmFsdWUKICAgICkgCiAgICAgICAgcHVibGljIAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKGJhbGFuY2VPZihfZnJvbSkgPCBfdmFsdWUgJiYgYWxsb3dhbmNlKF9mcm9tLCBtc2cuc2VuZGVyKSA8IF92YWx1ZSkgcmV2ZXJ0KCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZU9mKF90bykuYWRkKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZU9mKF9mcm9tKS5zdWIoX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93YW5jZShfZnJvbSwgbXNnLnNlbmRlcikuc3ViKF92YWx1ZSk7CiAgICAgICAgaWYgKGlzQ29udHJhY3QoX3RvKSkgewogICAgICAgICAgICBDb250cmFjdFJlY2VpdmVyIHJlY2VpdmVyID0gQ29udHJhY3RSZWNlaXZlcihfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIH0KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW5jcmVhc2UgcGVybWlzc2lvbiBmb3IgdHJhbnNmZXIKICAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIHNwZW5kZXIsCiAgICAgICAgdWludCB2YWx1ZQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpIAogICAgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdLmFkZCh2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWNyZWFzZSBwZXJtaXNzaW9uIGZvciB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKAogICAgICAgIGFkZHJlc3Mgc3BlbmRlciwKICAgICAgICB1aW50IHZhbHVlCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkgCiAgICB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0uYWRkKHZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZXIgdG9rZW4gYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoCiAgICAgICAgYWRkcmVzcyBvd25lcgogICAgKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgcmV0dXJucyAodWludCkgCiAgICB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW293bmVyXTsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZXIgdHJhbnNmZXIgcGVybWlzc2lvbgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoCiAgICAgICAgYWRkcmVzcyBvd25lciwgCiAgICAgICAgYWRkcmVzcyBzcGVuZGVyCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IHJlbWFpbmluZykKICAgIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtvd25lcl1bc3BlbmRlcl07CiAgICB9Cn0KCmNvbnRyYWN0IE15REZTVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIk15REZTIFRva2VuIjsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDY7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJNeURGUyI7CiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnSDEuMCc7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBmdW5jdGlvbiAoKSBleHRlcm5hbCB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9IAoKICAgIGZ1bmN0aW9uIE15REZTVG9rZW4oKSBwdWJsaWMgewogICAgICAgIHRvdGFsU3VwcGx5ID0gMTI1ICogMWUxMjsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyBuYW1lIG9mIHRva2VuIC4KICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX25hbWUpIHsKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyBzeW1ib2wgb2YgdG9rZW4gLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIF9zeW1ib2wpIHsKICAgICAgICByZXR1cm4gc3ltYm9sOwogICAgfQogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIGRlY2ltYWxzIG9mIHRva2VuIC4KICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDggX2RlY2ltYWxzKSB7CiAgICAgICAgcmV0dXJuIGRlY2ltYWxzOwogICAgfQogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIHRvdGFsIHN1cHBseSBvZiB0b2tlbnMgLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF90b3RhbFN1cHBseSkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseTsKICAgIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyQ2FuZGlkYXRlOwoKICAgIGV2ZW50IE93bmVyc2hpcFJlcXVlc3RlZChhZGRyZXNzIGluZGV4ZWQgX2J5LCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7CgogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsgXzt9CgogICAgLy8vIFByb3Bvc2VzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXJDYW5kaWRhdGUuCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyQ2FuZGlkYXRlICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IF9uZXdPd25lckNhbmRpZGF0ZTsKCiAgICAgICAgT3duZXJzaGlwUmVxdWVzdGVkKG1zZy5zZW5kZXIsIG5ld093bmVyQ2FuZGlkYXRlKTsKICAgIH0KCiAgICAvLy8gQWNjZXB0IG93bmVyc2hpcCB0cmFuc2Zlci4gVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgY2FsbGVkIGJ5IHRoZSBwZXJ2aW91c2x5IHByb3Bvc2VkIG93bmVyLgogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgZXh0ZXJuYWwgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyQ2FuZGlkYXRlKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXJDYW5kaWRhdGU7CiAgICAgICAgICAgIG5ld093bmVyQ2FuZGlkYXRlID0gYWRkcmVzcygwKTsKCiAgICAgICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lckNhbmRpZGF0ZSk7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBEZXZUb2tlbnNIb2xkZXIgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICB1aW50MjU2IGNvbGxlY3RlZFRva2VuczsKICAgIEdlbmVyaWNDcm93ZHNhbGUgY3Jvd2RzYWxlOwogICAgTXlERlNUb2tlbiB0b2tlbjsKCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgdG9rZW4sIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFRva2Vuc1dpdGhkcmF3bihhZGRyZXNzIGhvbGRlciwgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgRGVidWcodWludDI1NiBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIERldlRva2Vuc0hvbGRlcihhZGRyZXNzIF9jcm93ZHNhbGUsIGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9vd25lcikgcHVibGljIHsKICAgICAgICBjcm93ZHNhbGUgPSBHZW5lcmljQ3Jvd2RzYWxlKF9jcm93ZHNhbGUpOwogICAgICAgIHRva2VuID0gTXlERlNUb2tlbihfdG9rZW4pOwogICAgICAgIG93bmVyID0gX293bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgdWludCBfdmFsdWUsIAogICAgICAgIGJ5dGVzIF9kYXRhCiAgICApIAogICAgICAgIHB1YmxpYyAKICAgICAgICB2aWV3IAogICAgewogICAgICAgIHJlcXVpcmUoX2Zyb20gPT0gb3duZXIgfHwgX2Zyb20gPT0gYWRkcmVzcyhjcm93ZHNhbGUpKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDAgfHwgX2RhdGEubGVuZ3RoID4gMCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIERldiAoT3duZXIpIHdpbGwgY2FsbCB0aGlzIG1ldGhvZCB0byBleHRyYWN0IHRoZSB0b2tlbnMKICAgIGZ1bmN0aW9uIGNvbGxlY3RUb2tlbnMoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgdWludDI1NiB0b3RhbCA9IGNvbGxlY3RlZFRva2Vucy5hZGQoYmFsYW5jZSk7CgogICAgICAgIHVpbnQyNTYgZmluYWxpemVkVGltZSA9IGNyb3dkc2FsZS5maW5pc2hUaW1lKCk7CiAgICAgICAgcmVxdWlyZShmaW5hbGl6ZWRUaW1lID4gMCAmJiBnZXRUaW1lKCkgPiBmaW5hbGl6ZWRUaW1lLmFkZCgxNCBkYXlzKSk7CgogICAgICAgIHVpbnQyNTYgY2FuRXh0cmFjdCA9IHRvdGFsLm11bChnZXRUaW1lKCkuc3ViKGZpbmFsaXplZFRpbWUpKS5kaXYobW9udGhzKDEyKSk7CiAgICAgICAgY2FuRXh0cmFjdCA9IGNhbkV4dHJhY3Quc3ViKGNvbGxlY3RlZFRva2Vucyk7CgogICAgICAgIGlmIChjYW5FeHRyYWN0ID4gYmFsYW5jZSkgewogICAgICAgICAgICBjYW5FeHRyYWN0ID0gYmFsYW5jZTsKICAgICAgICB9CgogICAgICAgIGNvbGxlY3RlZFRva2VucyA9IGNvbGxlY3RlZFRva2Vucy5hZGQoY2FuRXh0cmFjdCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2Zlcihvd25lciwgY2FuRXh0cmFjdCkpOwogICAgICAgIFRva2Vuc1dpdGhkcmF3bihvd25lciwgY2FuRXh0cmFjdCk7CiAgICB9CgogICAgZnVuY3Rpb24gbW9udGhzKHVpbnQyNTYgbSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG0ubXVsKDMwIGRheXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8vLy8vLy8vLy8KICAgIC8vIFNhZmV0eSBNZXRob2RzCiAgICAvLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKHRva2VuKSk7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdG9rZW4gPSBNeURGU1Rva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgYmFsYW5jZSk7CiAgICB9Cn0KCmNvbnRyYWN0IEFkdmlzb3JzVG9rZW5zSG9sZGVyIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgR2VuZXJpY0Nyb3dkc2FsZSBjcm93ZHNhbGU7CiAgICBNeURGU1Rva2VuIHRva2VuOwoKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyB0b2tlbiwgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgVG9rZW5zV2l0aGRyYXduKGFkZHJlc3MgaG9sZGVyLCB1aW50MjU2IGFtb3VudCk7CgogICAgZnVuY3Rpb24gQWR2aXNvcnNUb2tlbnNIb2xkZXIoYWRkcmVzcyBfY3Jvd2RzYWxlLCBhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB7CiAgICAgICAgY3Jvd2RzYWxlID0gR2VuZXJpY0Nyb3dkc2FsZShfY3Jvd2RzYWxlKTsKICAgICAgICB0b2tlbiA9IE15REZTVG9rZW4oX3Rva2VuKTsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKAogICAgICAgIGFkZHJlc3MgX2Zyb20sIAogICAgICAgIHVpbnQgX3ZhbHVlLCAKICAgICAgICBieXRlcyBfZGF0YQogICAgKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgdmlldyAKICAgIHsKICAgICAgICByZXF1aXJlKF9mcm9tID09IG93bmVyIHx8IF9mcm9tID09IGFkZHJlc3MoY3Jvd2RzYWxlKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwIHx8IF9kYXRhLmxlbmd0aCA+IDApOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoZSBEZXYgKE93bmVyKSB3aWxsIGNhbGwgdGhpcyBtZXRob2QgdG8gZXh0cmFjdCB0aGUgdG9rZW5zCiAgICBmdW5jdGlvbiBjb2xsZWN0VG9rZW5zKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZSA+IDApOwoKICAgICAgICB1aW50MjU2IGZpbmFsaXplZFRpbWUgPSBjcm93ZHNhbGUuZmluaXNoVGltZSgpOwogICAgICAgIHJlcXVpcmUoZmluYWxpemVkVGltZSA+IDAgJiYgZ2V0VGltZSgpID4gZmluYWxpemVkVGltZS5hZGQoMTQgZGF5cykpOwoKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKSk7CiAgICAgICAgVG9rZW5zV2l0aGRyYXduKG93bmVyLCBiYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUaW1lKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLy8vLy8vLy8vCiAgICAvLyBTYWZldHkgTWV0aG9kcwogICAgLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcyh0b2tlbikpOwogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRva2VuID0gTXlERlNUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIGJhbGFuY2UpOwogICAgfQp9Cgpjb250cmFjdCBHZW5lcmljQ3Jvd2RzYWxlIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy9Dcm93cmRzYWxlIHN0YXRlcwogICAgZW51bSBTdGF0ZSB7IEluaXRpYWxpemVkLCBQcmVJY28sIFByZUljb0ZpbmlzaGVkLCBJY28sIEljb0ZpbmlzaGVkfQoKICAgIHN0cnVjdCBEaXNjb3VudCB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7CiAgICAgICAgdWludDI1NiB2YWx1ZTsKICAgIH0KCiAgICAvL2V0aGVyIHRyYXNmZXJlZCB0bwogICAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CiAgICAvL0Nyb3dyZHNhbGUgc3RhdGUKICAgIFN0YXRlIHB1YmxpYyBzdGF0ZTsKICAgIC8vSGFyZCBnb2FsIGluIFdlaQogICAgdWludCBwdWJsaWMgaGFyZEZ1bmRpbmdHb2FsOwogICAgLy9zb2Z0IGdvYWwgaW4gV2VpCiAgICB1aW50IHB1YmxpYyBzb2Z0RnVuZGluZ0dvYWw7CiAgICAvL2dhdGhlcmVkIEV0aGVyIGFtb3VudCBpbiBXZWkKICAgIHVpbnQgcHVibGljIGFtb3VudFJhaXNlZDsKICAgIC8vSUNPL1ByZUlDTyBzdGFydCB0aW1lc3RhbXAgaW4gc2Vjb25kcwogICAgdWludCBwdWJsaWMgc3RhcnRlZDsKICAgIC8vQ3Jvd2RzYWxlIGZpbmlzaCB0aW1lCiAgICB1aW50IHB1YmxpYyBmaW5pc2hUaW1lOwogICAgLy9wcmljZSBmb3IgMSB0b2tlbiBpbiBXZWkKICAgIHVpbnQgcHVibGljIHByaWNlOwogICAgLy9taW5pbXVtIHB1cmNoYXNlIHZhbHVlIGluIFdlaQogICAgdWludCBwdWJsaWMgbWluUHVyY2hhc2U7CiAgICAvL1Rva2VuIGNhbnRyYWN0CiAgICBFUkMyMjMgcHVibGljIHRva2VuUmV3YXJkOwogICAgLy9XZWkgYmFsYW5jZXMgZm9yIHJlZnVuZCBpZiBJQ08gZmFpbGVkCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VzOwoKICAgIC8vRW1lcmdlbmN5IHN0b3Agc2VsbAogICAgYm9vbCBlbWVyZ2VuY3lQYXVzZWQgPSBmYWxzZTsKICAgIC8vU29mdCBjYXAgcmVhY2hlZAogICAgYm9vbCBzb2Z0Q2FwUmVhY2hlZCA9IGZhbHNlOwogICAgLy9kZXYgaG9sZGVyCiAgICBEZXZUb2tlbnNIb2xkZXIgcHVibGljIGRldlRva2Vuc0hvbGRlcjsKICAgIC8vYWR2aXNvcnMgaG9sZGVyCiAgICBBZHZpc29yc1Rva2Vuc0hvbGRlciBwdWJsaWMgYWR2aXNvcnNUb2tlbnNIb2xkZXI7CiAgICAKICAgIC8vRGlzY29udHMKICAgIERpc2NvdW50W10gcHVibGljIGRpc2NvdW50czsKCiAgICAvL3ByaWNlIG92ZXJoZWFkIGZvciBuZXh0IHN0YWdlcwogICAgdWludDhbMl0gcHVibGljIHByZUljb1Rva2VuUHJpY2UgPSBbNzAsNzVdOwogICAgLy9wcmljZSBvdmVyaGVhZCBmb3IgbmV4dCBzdGFnZXMKICAgIHVpbnQ4WzRdIHB1YmxpYyBpY29Ub2tlblByaWNlID0gWzEwMCwxMjAsMTI1LDEzMF07CgogICAgZXZlbnQgVG9rZW5QdXJjaGFzZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCBzdW0sIHVpbnQgdG9rZW5zQ291bnQsIHVpbnQgZGlzY291bnRUb2tlbnMpOwogICAgZXZlbnQgUHJlSWNvTGltaXRSZWFjaGVkKHVpbnQgdG90YWxBbW91bnRSYWlzZWQpOwogICAgZXZlbnQgU29mdEdvYWxSZWFjaGVkKHVpbnQgdG90YWxBbW91bnRSYWlzZWQpOwogICAgZXZlbnQgSGFyZEdvYWxSZWFjaGVkKHVpbnQgdG90YWxBbW91bnRSYWlzZWQpOwogICAgZXZlbnQgRGVidWcodWludCBudW0pOwoKICAgIC8vU2FsZSBpcyBhY3RpdmUKICAgIG1vZGlmaWVyIHNlbGxBY3RpdmUoKSB7IAogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICFlbWVyZ2VuY3lQYXVzZWQgCiAgICAgICAgICAgICYmIChzdGF0ZSA9PSBTdGF0ZS5QcmVJY28gfHwgc3RhdGUgPT0gU3RhdGUuSWNvKQogICAgICAgICAgICAmJiBhbW91bnRSYWlzZWQgPCBoYXJkRnVuZGluZ0dvYWwKICAgICAgICApOwogICAgXzsgfQogICAgLy9Tb2Z0IGNhcCBub3QgcmVhY2hlZAogICAgbW9kaWZpZXIgZ29hbE5vdFJlYWNoZWQoKSB7IHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuSWNvRmluaXNoZWQgJiYgYW1vdW50UmFpc2VkIDwgc29mdEZ1bmRpbmdHb2FsKTsgXzsgfQoKICAgIC8qKgogICAgICogQ29uc3RyY3RvciBmdW5jdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBHZW5lcmljQ3Jvd2RzYWxlKAogICAgICAgIGFkZHJlc3MgaWZTdWNjZXNzZnVsU2VuZFRvLAogICAgICAgIGFkZHJlc3MgYWRkcmVzc09mVG9rZW5Vc2VkQXNSZXdhcmQKICAgICkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGlmU3VjY2Vzc2Z1bFNlbmRUbyAhPSBhZGRyZXNzKDApIAogICAgICAgICAgICAmJiBhZGRyZXNzT2ZUb2tlblVzZWRBc1Jld2FyZCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBiZW5lZmljaWFyeSA9IGlmU3VjY2Vzc2Z1bFNlbmRUbzsKICAgICAgICB0b2tlblJld2FyZCA9IEVSQzIyMyhhZGRyZXNzT2ZUb2tlblVzZWRBc1Jld2FyZCk7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5Jbml0aWFsaXplZDsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKAogICAgICAgIGFkZHJlc3MgX2Zyb20sIAogICAgICAgIHVpbnQgX3ZhbHVlLCAKICAgICAgICBieXRlcyBfZGF0YQogICAgKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgdmlldyAKICAgIHsKICAgICAgICByZXF1aXJlKF9mcm9tID09IG93bmVyKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDAgfHwgX2RhdGEubGVuZ3RoID4gMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdGFydCBQcmVJQ08KICAgICAqLwogICAgZnVuY3Rpb24gcHJlSWNvKAogICAgICAgIHVpbnQgaGFyZEZ1bmRpbmdHb2FsSW5FdGhlcnMsCiAgICAgICAgdWludCBtaW5QdXJjaGFzZUluRmlubmV5LAogICAgICAgIHVpbnQgY29zdE9mRWFjaFRva2VuLAogICAgICAgIHVpbnQyNTZbXSBkaXNjb3VudEV0aGVycywKICAgICAgICB1aW50MjU2W10gZGlzY291bnRWYWx1ZXMKICAgICkgCiAgICAgICAgZXh0ZXJuYWwgCiAgICAgICAgb25seU93bmVyIAogICAgewogICAgICAgIHJlcXVpcmUoaGFyZEZ1bmRpbmdHb2FsSW5FdGhlcnMgPiAwCiAgICAgICAgICAgICYmIGNvc3RPZkVhY2hUb2tlbiA+IDAKICAgICAgICAgICAgJiYgc3RhdGUgPT0gU3RhdGUuSW5pdGlhbGl6ZWQKICAgICAgICAgICAgJiYgZGlzY291bnRFdGhlcnMubGVuZ3RoID09IGRpc2NvdW50VmFsdWVzLmxlbmd0aCk7CgogICAgICAgIGhhcmRGdW5kaW5nR29hbCA9IGhhcmRGdW5kaW5nR29hbEluRXRoZXJzLm11bCgxIGV0aGVyKTsKICAgICAgICBtaW5QdXJjaGFzZSA9IG1pblB1cmNoYXNlSW5GaW5uZXkubXVsKDEgZmlubmV5KTsKICAgICAgICBwcmljZSA9IGNvc3RPZkVhY2hUb2tlbjsKICAgICAgICBpbml0RGlzY291bnRzKGRpc2NvdW50RXRoZXJzLCBkaXNjb3VudFZhbHVlcyk7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5QcmVJY287CiAgICAgICAgc3RhcnRlZCA9IG5vdzsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXJ0IElDTwogICAgICovCiAgICBmdW5jdGlvbiBpY28oCiAgICAgICAgdWludCBzb2Z0RnVuZGluZ0dvYWxJbkV0aGVycywKICAgICAgICB1aW50IGhhcmRGdW5kaW5nR29hbEluRXRoZXJzLAogICAgICAgIHVpbnQgbWluUHVyY2hhc2VJbkZpbm5leSwKICAgICAgICB1aW50IGNvc3RPZkVhY2hUb2tlbiwKICAgICAgICB1aW50MjU2W10gZGlzY291bnRFdGhlcnMsCiAgICAgICAgdWludDI1NltdIGRpc2NvdW50VmFsdWVzCiAgICApIAogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShzb2Z0RnVuZGluZ0dvYWxJbkV0aGVycyA+IDAKICAgICAgICAgICAgJiYgaGFyZEZ1bmRpbmdHb2FsSW5FdGhlcnMgPiAwCiAgICAgICAgICAgICYmIGhhcmRGdW5kaW5nR29hbEluRXRoZXJzID4gc29mdEZ1bmRpbmdHb2FsSW5FdGhlcnMKICAgICAgICAgICAgJiYgY29zdE9mRWFjaFRva2VuID4gMAogICAgICAgICAgICAmJiBzdGF0ZSA8IFN0YXRlLkljbwogICAgICAgICAgICAmJiBkaXNjb3VudEV0aGVycy5sZW5ndGggPT0gZGlzY291bnRWYWx1ZXMubGVuZ3RoKTsKCiAgICAgICAgc29mdEZ1bmRpbmdHb2FsID0gc29mdEZ1bmRpbmdHb2FsSW5FdGhlcnMubXVsKDEgZXRoZXIpOwogICAgICAgIGhhcmRGdW5kaW5nR29hbCA9IGhhcmRGdW5kaW5nR29hbEluRXRoZXJzLm11bCgxIGV0aGVyKTsKICAgICAgICBtaW5QdXJjaGFzZSA9IG1pblB1cmNoYXNlSW5GaW5uZXkubXVsKDEgZmlubmV5KTsKICAgICAgICBwcmljZSA9IGNvc3RPZkVhY2hUb2tlbjsKICAgICAgICBkZWxldGUgZGlzY291bnRzOwogICAgICAgIGluaXREaXNjb3VudHMoZGlzY291bnRFdGhlcnMsIGRpc2NvdW50VmFsdWVzKTsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkljbzsKICAgICAgICBzdGFydGVkID0gbm93OwogICAgfQoKICAgIC8qKgogICAgICogRmluaXNoIElDTyAvIFByZUlDTwogICAgICovCiAgICBmdW5jdGlvbiBmaW5pc2hTYWxlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlByZUljbyB8fCBzdGF0ZSA9PSBTdGF0ZS5JY28pOwogICAgICAgIAogICAgICAgIGlmIChzdGF0ZSA9PSBTdGF0ZS5QcmVJY28pCiAgICAgICAgICAgIHN0YXRlID0gU3RhdGUuUHJlSWNvRmluaXNoZWQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdGF0ZSA9IFN0YXRlLkljb0ZpbmlzaGVkOwogICAgfQoKICAgIC8qKgogICAgICogQWRtaW4gY2FuIHBhdXNlIHRva2VuIHNlbGwKICAgICAqLwogICAgZnVuY3Rpb24gZW1lcmdlbmN5UGF1c2UoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGVtZXJnZW5jeVBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZG1pbiBjYW4gdW5wYXVzZSB0b2tlbiBzZWxsCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVtZXJnZW5jeVVucGF1c2UoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGVtZXJnZW5jeVBhdXNlZCA9IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXIgZGV2IHRva2VucyB0byB2ZXN0aW5nIHdhbGxldAogICAgICovCiAgICBmdW5jdGlvbiBzZW5kRGV2VG9rZW5zKCkgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoc3VjY2Vzc2VkKCkpOwoKICAgICAgICBkZXZUb2tlbnNIb2xkZXIgPSBuZXcgRGV2VG9rZW5zSG9sZGVyKGFkZHJlc3ModGhpcyksIGFkZHJlc3ModG9rZW5SZXdhcmQpLCBvd25lcik7CiAgICAgICAgdG9rZW5SZXdhcmQudHJhbnNmZXIoYWRkcmVzcyhkZXZUb2tlbnNIb2xkZXIpLCAxMjUwMCAqIDFlOSk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoZGV2VG9rZW5zSG9sZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZmVyIGRldiB0b2tlbnMgdG8gdmVzdGluZyB3YWxsZXQKICAgICAqLwogICAgZnVuY3Rpb24gc2VuZEFkdmlzb3JzVG9rZW5zKCkgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoc3VjY2Vzc2VkKCkpOwoKICAgICAgICBhZHZpc29yc1Rva2Vuc0hvbGRlciA9IG5ldyBBZHZpc29yc1Rva2Vuc0hvbGRlcihhZGRyZXNzKHRoaXMpLCBhZGRyZXNzKHRva2VuUmV3YXJkKSwgb3duZXIpOwogICAgICAgIHRva2VuUmV3YXJkLnRyYW5zZmVyKGFkZHJlc3MoYWR2aXNvcnNUb2tlbnNIb2xkZXIpLCAxMjUwMCAqIDFlOSk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoYWR2aXNvcnNUb2tlbnNIb2xkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQWRtaW4gY2FuIHdpdGhkcmF3IGV0aGVyIGJlbmVmaWNpYXJ5IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdGdW5kaW5nKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKChzdGF0ZSA9PSBTdGF0ZS5QcmVJY28gfHwgc3VjY2Vzc2VkKCkpKTsKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8qKgogICAgICogRGlmZmVyZW50IGNvaW5zIHB1cmNoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZvcmVpZ25QdXJjaGFzZShhZGRyZXNzIHVzZXIsIHVpbnQyNTYgYW1vdW50KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgc2VsbEFjdGl2ZQogICAgewogICAgICAgIGJ1eVRva2Vucyh1c2VyLCBhbW91bnQpOwogICAgICAgIGNoZWNrR29hbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsYWltIHJlZnVuZCBldGhlciBpbiBzb2Z0IGdvYWwgbm90IHJlYWNoZWQgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgCiAgICAgICAgZXh0ZXJuYWwgCiAgICAgICAgZ29hbE5vdFJlYWNoZWQgCiAgICB7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgaWYgKGFtb3VudCA+IDApewogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChhbW91bnQpKSB7CiAgICAgICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGFtb3VudDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBheW1lbnQgdHJhbnNhY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gKCkgCiAgICAgICAgZXh0ZXJuYWwgCiAgICAgICAgcGF5YWJsZSAKICAgICAgICBzZWxsQWN0aXZlCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5QdXJjaGFzZSk7CiAgICAgICAgdWludCBhbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgaWYgKGFtb3VudCA+IGhhcmRGdW5kaW5nR29hbC5zdWIoYW1vdW50UmFpc2VkKSkgewogICAgICAgICAgICB1aW50IGF2YWlsYWJsZUFtb3VudCA9IGhhcmRGdW5kaW5nR29hbC5zdWIoYW1vdW50UmFpc2VkKTsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnQuc3ViKGF2YWlsYWJsZUFtb3VudCkpOwogICAgICAgICAgICBhbW91bnQgPSBhdmFpbGFibGVBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICBidXlUb2tlbnMobXNnLnNlbmRlciwgIGFtb3VudCk7CiAgICAgICAgY2hlY2tHb2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXIgdG9rZW5zIHRvIHVzZXIKICAgICAqLwogICAgZnVuY3Rpb24gYnV5VG9rZW5zKAogICAgICAgIGFkZHJlc3MgdXNlciwKICAgICAgICB1aW50MjU2IGFtb3VudAogICAgKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhbW91bnQgPD0gaGFyZEZ1bmRpbmdHb2FsLnN1YihhbW91bnRSYWlzZWQpKTsKCiAgICAgICAgdWludDI1NiBwYXNzZWRTZWNvbmRzID0gZ2V0VGltZSgpLnN1YihzdGFydGVkKTsKICAgICAgICB1aW50MjU2IHdlZWsgPSAwOwogICAgICAgIGlmIChwYXNzZWRTZWNvbmRzID49IDYwNDgwMCl7CiAgICAgICAgICAgIHdlZWsgPSBwYXNzZWRTZWNvbmRzLmRpdig2MDQ4MDApOwogICAgICAgIH0KICAgICAgICBEZWJ1Zyh3ZWVrKTsKCiAgICAgICAgdWludDI1NiB0b2tlblByaWNlOwogICAgICAgIGlmIChzdGF0ZSA9PSBTdGF0ZS5JY28pewogICAgICAgICAgICB1aW50MjU2IGN1cCA9IGFtb3VudFJhaXNlZC5tdWwoNCkuZGl2KGhhcmRGdW5kaW5nR29hbCk7CiAgICAgICAgICAgIGlmIChjdXAgPiB3ZWVrKQogICAgICAgICAgICAgICAgd2VlayA9IGN1cDsKICAgICAgICAgICAgaWYgKHdlZWsgPj0gNCkKICAgICAgICAgICAgICAgICB3ZWVrID0gMzsKICAgICAgICAgICAgdG9rZW5QcmljZSA9IHByaWNlLm11bChpY29Ub2tlblByaWNlW3dlZWtdKS5kaXYoMTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAod2VlayA+PSAyKQogICAgICAgICAgICAgICAgIHdlZWsgPSAxOwogICAgICAgICAgICB0b2tlblByaWNlID0gcHJpY2UubXVsKHByZUljb1Rva2VuUHJpY2Vbd2Vla10pLmRpdigxMDApOwogICAgICAgIH0KCiAgICAgICAgRGVidWcodG9rZW5QcmljZSk7CgogICAgICAgIHVpbnQyNTYgY291bnQgPSBhbW91bnQuZGl2KHRva2VuUHJpY2UpOwogICAgICAgIHVpbnQyNTYgZGlzY291bnQgPSBnZXREaXNjb3VudE9mKGFtb3VudCk7CiAgICAgICAgdWludDI1NiBkaXNjb3VudEJvbnVzID0gZGlzY291bnQubXVsKGNvdW50KS5kaXYoMTAwKTsKICAgICAgICBjb3VudCA9IGNvdW50LmFkZChkaXNjb3VudEJvbnVzKTsKICAgICAgICBjb3VudCA9IGNlaWxUb2tlbnMoY291bnQpOwoKICAgICAgICByZXF1aXJlKHRva2VuUmV3YXJkLnRyYW5zZmVyKHVzZXIsIGNvdW50KSk7CiAgICAgICAgYmFsYW5jZXNbdXNlcl0gPSBiYWxhbmNlc1t1c2VyXS5hZGQoYW1vdW50KTsKICAgICAgICBhbW91bnRSYWlzZWQgPSBhbW91bnRSYWlzZWQuYWRkKGFtb3VudCk7CiAgICAgICAgVG9rZW5QdXJjaGFzZWQodXNlciwgYW1vdW50LCBjb3VudCwgZGlzY291bnRCb251cyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWZpbmUgZGlzdG91bnQgcGVyY2VudHMgZm9yIGRpZmZlcmVudCB0b2tlbiBhbW91bnRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNlaWxUb2tlbnMoCiAgICAgICAgdWludDI1NiBudW0KICAgICkgCiAgICAgICAgcHVibGljCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnModWludDI1NikgCiAgICB7CiAgICAgICAgdWludDI1NiBwYXJ0ID0gbnVtICUgMTAwMDAwMDsKICAgICAgICByZXR1cm4gcGFydCA+IDAgPyBudW0uZGl2KDEwMDAwMDApLm11bCgxMDAwMDAwKSArIDEwMDAwMDAgOiBudW07CiAgICB9CgogICAgLyoqCiAgICAgKiBJQ08gaXMgZmluaXNoZWQgc3VjY2Vzc2Z1bGx5CiAgICAgKi8KICAgIGZ1bmN0aW9uIHN1Y2Nlc3NlZCgpIAogICAgICAgIHB1YmxpYyAKICAgICAgICB2aWV3IAogICAgICAgIHJldHVybnMoYm9vbCkgCiAgICB7CiAgICAgICAgcmV0dXJuIHN0YXRlID09IFN0YXRlLkljb0ZpbmlzaGVkICYmIGFtb3VudFJhaXNlZCA+PSBzb2Z0RnVuZGluZ0dvYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWZpbmUgZGlzdG91bnQgcGVyY2VudHMgZm9yIGRpZmZlcmVudCB0b2tlbiBhbW91bnRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluaXREaXNjb3VudHMoCiAgICAgICAgdWludDI1NltdIGRpc2NvdW50RXRoZXJzLAogICAgICAgIHVpbnQyNTZbXSBkaXNjb3VudFZhbHVlcwogICAgKSBpbnRlcm5hbCB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZGlzY291bnRFdGhlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZGlzY291bnRzLnB1c2goRGlzY291bnQoZGlzY291bnRFdGhlcnNbaV0ubXVsKDEgZXRoZXIpLCBkaXNjb3VudFZhbHVlc1tpXSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdldCBkaXNjb3VudCBwZXJjZW50IGZvciBudW1iZXIgb2YgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldERpc2NvdW50T2YoCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKGRpc2NvdW50cy5sZW5ndGggPiAwKQogICAgICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBkaXNjb3VudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChfYW1vdW50ID49IGRpc2NvdW50c1tpXS5hbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGlzY291bnRzW2ldLnZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBJQ08gZ29hbHMgYWNoaWV2ZW1lbnQKICAgICAqLwogICAgZnVuY3Rpb24gY2hlY2tHb2FscygpIGludGVybmFsIHsKICAgICAgICBpZiAoc3RhdGUgPT0gU3RhdGUuUHJlSWNvKSB7CiAgICAgICAgICAgIGlmIChhbW91bnRSYWlzZWQgPj0gaGFyZEZ1bmRpbmdHb2FsKSB7CiAgICAgICAgICAgICAgICBQcmVJY29MaW1pdFJlYWNoZWQoYW1vdW50UmFpc2VkKTsKICAgICAgICAgICAgICAgIHN0YXRlID0gU3RhdGUuUHJlSWNvRmluaXNoZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIXNvZnRDYXBSZWFjaGVkICYmIGFtb3VudFJhaXNlZCA+PSBzb2Z0RnVuZGluZ0dvYWwpewogICAgICAgICAgICAgICAgc29mdENhcFJlYWNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgU29mdEdvYWxSZWFjaGVkKGFtb3VudFJhaXNlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFtb3VudFJhaXNlZCA+PSBoYXJkRnVuZGluZ0dvYWwpIHsKICAgICAgICAgICAgICAgIGZpbmlzaFRpbWUgPSBub3c7CiAgICAgICAgICAgICAgICBIYXJkR29hbFJlYWNoZWQoYW1vdW50UmFpc2VkKTsKICAgICAgICAgICAgICAgIHN0YXRlID0gU3RhdGUuSWNvRmluaXNoZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBub3c7CiAgICB9Cn0='.
	

]
