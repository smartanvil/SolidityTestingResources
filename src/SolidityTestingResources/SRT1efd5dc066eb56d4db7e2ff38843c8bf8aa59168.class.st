Class {
	#name : #SRT1efd5dc066eb56d4db7e2ff38843c8bf8aa59168,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1efd5dc066eb56d4db7e2ff38843c8bf8aa59168 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCi8qKgogKiBUaGUgQml0a29tIFRva2VuIChCVFQpIGhhcyBhIGZpeGVkIHN1cHBseSBhbmQgcmVzdHJpY3RzIHRoZSBhYmlsaXR5CiAqIHRvIHRyYW5zZmVyIHRva2VucyB1bnRpbCB0aGUgb3duZXIgaGFzIGNhbGxlZCB0aGUgZW5hYmxlVHJhbnNmZXIoKQogKiBmdW5jdGlvbi4KICoKICogVGhlIG93bmVyIGNhbiBhc3NvY2lhdGUgdGhlIHRva2VuIHdpdGggYSB0b2tlbiBzYWxlIGNvbnRyYWN0LiBJbiB0aGF0CiAqIGNhc2UsIHRoZSB0b2tlbiBiYWxhbmNlIGlzIG1vdmVkIHRvIHRoZSB0b2tlbiBzYWxlIGNvbnRyYWN0LCB3aGljaAogKiBpbiB0dXJuIGNhbiB0cmFuc2ZlciBpdHMgdG9rZW5zIHRvIGNvbnRyaWJ1dG9ycyB0byB0aGUgc2FsZS4KICovCmNvbnRyYWN0IEJpdGtvbVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAgIC8vIENvbnN0YW50cwogICAgc3RyaW5nICBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJCaXRrb20gVG9rZW4iOwogICAgc3RyaW5nICBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkJUVCI7CiAgICB1aW50OCAgIHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSU5JVElBTF9TVVBQTFkgPSA1MDAwMDAwMCAqIDEgZXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBDUk9XRFNBTEVfQUxMT1dBTkNFID0gIDMzNTAwMDAwICogMSBldGhlcjsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRFQU1fQUxMT1dBTkNFID0gIDE2NTAwMDAwICogMSBldGhlcjsKCiAgICAvLyBQcm9wZXJ0aWVzCiAgICB1aW50MjU2IHB1YmxpYyBjcm93ZHNhbGVBbGxvd2FuY2U7ICAgICAgICAgICAgICAgLy8gdGhlIG51bWJlciBvZiB0b2tlbnMgYXZhaWxhYmxlIGZvciBjcm93ZHNhbGVzCiAgICB1aW50MjU2IHB1YmxpYyB0ZWFtQWxsb3dhbmNlOyAgICAgICAgICAgICAgIC8vIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF2YWlsYWJsZSBmb3IgdGhlIGFkbWluaXN0cmF0b3IKICAgIGFkZHJlc3MgcHVibGljIGNyb3dkc2FsZUFkZHI7ICAgICAgICAgICAgICAgICAgICAvLyB0aGUgYWRkcmVzcyBvZiBhIGNyb3dkc2FsZSBjdXJyZW50bHkgc2VsbGluZyB0aGlzIHRva2VuCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtQWRkcjsgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBhZGRyZXNzIG9mIHRoZSB0ZWFtIGFjY291bnQKICAgIGJvb2wgICAgcHVibGljIHRyYW5zZmVyRW5hYmxlZCA9IGZhbHNlOyAgICAgLy8gaW5kaWNhdGVzIGlmIHRyYW5zZmVycmluZyB0b2tlbnMgaXMgZW5hYmxlZCBvciBub3QKCiAgICAvLyBNb2RpZmllcnMKICAgIG1vZGlmaWVyIG9ubHlXaGVuVHJhbnNmZXJFbmFibGVkKCkgewogICAgICAgIGlmICghdHJhbnNmZXJFbmFibGVkKSB7CiAgICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB0ZWFtQWRkciB8fCBtc2cuc2VuZGVyID09IGNyb3dkc2FsZUFkZHIpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvKioKICAgICAqIFRoZSBsaXN0ZWQgYWRkcmVzc2VzIGFyZSBub3QgdmFsaWQgcmVjaXBpZW50cyBvZiB0b2tlbnMuCiAgICAgKgogICAgICogMHgwICAgICAgICAgICAtIHRoZSB6ZXJvIGFkZHJlc3MgaXMgbm90IHZhbGlkCiAgICAgKiB0aGlzICAgICAgICAgIC0gdGhlIGNvbnRyYWN0IGl0c2VsZiBzaG91bGQgbm90IHJlY2VpdmUgdG9rZW5zCiAgICAgKiBvd25lciAgICAgICAgIC0gdGhlIG93bmVyIGhhcyBhbGwgdGhlIGluaXRpYWwgdG9rZW5zLCBidXQgY2Fubm90IHJlY2VpdmUgYW55IGJhY2sKICAgICAqIHRlYW1BZGRyICAgICAgLSB0aGUgdGVhbSBoYXMgYW4gYWxsb3dhbmNlIG9mIHRva2VucyB0byB0cmFuc2ZlciwgYnV0IGRvZXMgbm90IHJlY2VpdmUgYW55CiAgICAgKiBjcm93ZHNhbGVBZGRyICAgICAgLSB0aGUgc2FsZSBoYXMgYW4gYWxsb3dhbmNlIG9mIHRva2VucyB0byB0cmFuc2ZlciwgYnV0IGRvZXMgbm90IHJlY2VpdmUgYW55CiAgICAgKi8KICAgIG1vZGlmaWVyIHZhbGlkRGVzdGluYXRpb24oYWRkcmVzcyBfdG8pIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IG93bmVyKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRlYW1BZGRyKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhjcm93ZHNhbGVBZGRyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yIC0gaW5zdGFudGlhdGVzIHRva2VuIHN1cHBseSBhbmQgYWxsb2NhdGVzIGJhbGFuYWNlIG9mCiAgICAgKiB0byB0aGUgb3duZXIgKG1zZy5zZW5kZXIpLgogICAgICovCiAgICBmdW5jdGlvbiBCaXRrb21Ub2tlbihhZGRyZXNzIF90ZWFtKSBwdWJsaWMgewogICAgICAgIC8vIHRoZSBvd25lciBpcyBhIGN1c3RvZGlhbiBvZiB0b2tlbnMgdGhhdCBjYW4KICAgICAgICAvLyBnaXZlIGFuIGFsbG93YW5jZSBvZiB0b2tlbnMgZm9yIGNyb3dkc2FsZXMKICAgICAgICAvLyBvciB0byB0aGUgYWRtaW4sIGJ1dCBjYW5ub3QgaXRzZWxmIHRyYW5zZmVyCiAgICAgICAgLy8gdG9rZW5zOyBoZW5jZSwgdGhpcyByZXF1aXJlbWVudAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBfdGVhbSk7CgogICAgICAgIHRvdGFsU3VwcGx5ID0gSU5JVElBTF9TVVBQTFk7CiAgICAgICAgY3Jvd2RzYWxlQWxsb3dhbmNlID0gQ1JPV0RTQUxFX0FMTE9XQU5DRTsKICAgICAgICB0ZWFtQWxsb3dhbmNlID0gVEVBTV9BTExPV0FOQ0U7CgogICAgICAgIC8vIG1pbnQgYWxsIHRva2VucwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gdG90YWxTdXBwbHk7CiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygweDApLCBtc2cuc2VuZGVyLCB0b3RhbFN1cHBseSk7CgogICAgICAgIHRlYW1BZGRyID0gX3RlYW07CiAgICAgICAgYXBwcm92ZSh0ZWFtQWRkciwgdGVhbUFsbG93YW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NvY2lhdGVzIHRoaXMgdG9rZW4gd2l0aCBhIGN1cnJlbnQgY3Jvd2RzYWxlLCBnaXZpbmcgdGhlIGNyb3dkc2FsZQogICAgICogYW4gYWxsb3dhbmNlIG9mIHRva2VucyBmcm9tIHRoZSBjcm93ZHNhbGUgc3VwcGx5LiBUaGlzIGdpdmVzIHRoZQogICAgICogY3Jvd2RzYWxlIHRoZSBhYmlsaXR5IHRvIGNhbGwgdHJhbnNmZXJGcm9tIHRvIHRyYW5zZmVyIHRva2VucyB0bwogICAgICogd2hvbWV2ZXIgaGFzIHB1cmNoYXNlZCB0aGVtLgogICAgICoKICAgICAqIE5vdGUgdGhhdCBpZiBfYW1vdW50Rm9yU2FsZSBpcyAwLCB0aGVuIGl0IGlzIGFzc3VtZWQgdGhhdCB0aGUgZnVsbAogICAgICogcmVtYWluaW5nIGNyb3dkc2FsZSBzdXBwbHkgaXMgbWFkZSBhdmFpbGFibGUgdG8gdGhlIGNyb3dkc2FsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Nyb3dkc2FsZUFkZHIgVGhlIGFkZHJlc3Mgb2YgYSBjcm93ZHNhbGUgY29udHJhY3QgdGhhdCB3aWxsIHNlbGwgdGhpcyB0b2tlbgogICAgICogQHBhcmFtIF9hbW91bnRGb3JTYWxlIFRoZSBzdXBwbHkgb2YgdG9rZW5zIHByb3ZpZGVkIHRvIHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlKGFkZHJlc3MgX2Nyb3dkc2FsZUFkZHIsIHVpbnQyNTYgX2Ftb3VudEZvclNhbGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZSghdHJhbnNmZXJFbmFibGVkKTsKICAgICAgICByZXF1aXJlKF9hbW91bnRGb3JTYWxlIDw9IGNyb3dkc2FsZUFsbG93YW5jZSk7CgogICAgICAgIC8vIGlmIDAsIHRoZW4gZnVsbCBhdmFpbGFibGUgY3Jvd2RzYWxlIHN1cHBseSBpcyBhc3N1bWVkCiAgICAgICAgdWludCBhbW91bnQgPSAoX2Ftb3VudEZvclNhbGUgPT0gMCkgPyBjcm93ZHNhbGVBbGxvd2FuY2UgOiBfYW1vdW50Rm9yU2FsZTsKCiAgICAgICAgLy8gQ2xlYXIgYWxsb3dhbmNlIG9mIG9sZCwgYW5kIHNldCBhbGxvd2FuY2Ugb2YgbmV3CiAgICAgICAgYXBwcm92ZShjcm93ZHNhbGVBZGRyLCAwKTsKICAgICAgICBhcHByb3ZlKF9jcm93ZHNhbGVBZGRyLCBhbW91bnQpOwoKICAgICAgICBjcm93ZHNhbGVBZGRyID0gX2Nyb3dkc2FsZUFkZHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmFibGVzIHRoZSBhYmlsaXR5IG9mIGFueW9uZSB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMuIFRoaXMgY2FuCiAgICAgKiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgdG9rZW4gb3duZXIuIE9uY2UgZW5hYmxlZCwgaXQgaXMgbm90CiAgICAgKiBwb3NzaWJsZSB0byBkaXNhYmxlIHRyYW5zZmVycy4KICAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXIoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHRyYW5zZmVyRW5hYmxlZCA9IHRydWU7CiAgICAgICAgYXBwcm92ZShjcm93ZHNhbGVBZGRyLCAwKTsKICAgICAgICBhcHByb3ZlKHRlYW1BZGRyLCAwKTsKICAgICAgICBjcm93ZHNhbGVBbGxvd2FuY2UgPSAwOwogICAgICAgIHRlYW1BbGxvd2FuY2UgPSAwOwogICAgfQoKICAgIC8qKgogICAgICogT3ZlcnJpZGVzIEVSQzIwIHRyYW5zZmVyIGZ1bmN0aW9uIHdpdGggbW9kaWZpZXIgdGhhdCBwcmV2ZW50cyB0aGUKICAgICAqIGFiaWxpdHkgdG8gdHJhbnNmZXIgdG9rZW5zIHVudGlsIGFmdGVyIHRyYW5zZmVycyBoYXZlIGJlZW4gZW5hYmxlZC4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seVdoZW5UcmFuc2ZlckVuYWJsZWQgdmFsaWREZXN0aW5hdGlvbihfdG8pIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogT3ZlcnJpZGVzIEVSQzIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbiB3aXRoIG1vZGlmaWVyIHRoYXQgcHJldmVudHMgdGhlCiAgICAgKiBhYmlsaXR5IHRvIHRyYW5zZmVyIHRva2VucyB1bnRpbCBhZnRlciB0cmFuc2ZlcnMgaGF2ZSBiZWVuIGVuYWJsZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5V2hlblRyYW5zZmVyRW5hYmxlZCB2YWxpZERlc3RpbmF0aW9uKF90bykgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBjcm93ZHNhbGVBZGRyKQogICAgICAgICAgICAgICAgY3Jvd2RzYWxlQWxsb3dhbmNlID0gY3Jvd2RzYWxlQWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSB0ZWFtQWRkcikKICAgICAgICAgICAgICAgIHRlYW1BbGxvd2FuY2UgPSB0ZWFtQWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCdXJucyBhIHNwZWNpZmljIGFtb3VudCBvZiB0b2tlbnMgaWYgbXNnLnNlbmRlciA9PSBvd25lcgogICAgICogb3IgdHJhbnNmZXJFbmFibGVkID09IHRydWUKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSBidXJuZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlckVuYWJsZWQgfHwgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgLy8gbm8gbmVlZCB0byByZXF1aXJlIHZhbHVlIDw9IHRvdGFsU3VwcGx5LCBzaW5jZSB0aGF0IHdvdWxkIGltcGx5IHRoZQogICAgICAgIC8vIHNlbmRlcidzIGJhbGFuY2UgaXMgZ3JlYXRlciB0aGFuIHRoZSB0b3RhbFN1cHBseSwgd2hpY2ggKnNob3VsZCogYmUgYW4gYXNzZXJ0aW9uIGZhaWx1cmUKCiAgICAgICAgYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGJhbGFuY2VzW2J1cm5lcl0gPSBiYWxhbmNlc1tidXJuZXJdLnN1YihfdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CiAgICAgICAgQnVybihidXJuZXIsIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgYWRkcmVzcygweDApLCBfdmFsdWUpOwogICAgfQp9CgovKioKICogVGhlIEJpdGtvbVNhbGUgc21hcnQgY29udHJhY3QgaXMgdXNlZCBmb3Igc2VsbGluZyBCaXRrb21Ub2tlbgogKiB0b2tlbnMgKEJUVCkuIEl0IGRvZXMgc28gYnkgY29udmVydGluZyBFVEggcmVjZWl2ZWQgaW50byBhIHF1YW50aXR5IG9mCiAqIHRva2VucyB0aGF0IGFyZSB0cmFuc2ZlcnJlZCB0byB0aGUgY29udHJpYnV0b3IgdmlhIHRoZSBFUkMyMC1jb21wYXRpYmxlCiAqIHRyYW5zZmVyRnJvbSgpIGZ1bmN0aW9uLgogKi8KY29udHJhY3QgQml0a29tU2FsZSBpcyBQYXVzYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgUkFURSA9IDI1MDA7ICAgICAgIC8vIGNvbnN0YW50IGZvciBjb252ZXJ0aW5nIEVUSCB0byBCVFQKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IEdBU19MSU1JVF9JTl9XRUkgPSA1MDAwMDAwMDAwMCB3ZWk7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNSU5fQ09OVFJJQlVUSU9OID0gMC4xICogMSBldGhlcjsgIC8vIGxvd2VyIGJvdW5kIG9uIGFtb3VudCBhIGNvbnRyaWJ1dG9yIGNhbiBzZW5kIChpbiB3ZWkpCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUT0tFTl9IQVJEQ0FQID0gMzM1MDAwMDAgKiAxIGV0aGVyOyAgLy8gbG93ZXIgYm91bmQgb24gYW1vdW50IGEgY29udHJpYnV0b3IgY2FuIHNlbmQgKGluIHdlaSkKCiAgICBib29sIHB1YmxpYyBmdW5kaW5nQ2FwUmVhY2hlZCA9IGZhbHNlOyAgLy8gZnVuZGluZyBjYXAgaGFzIGJlZW4gcmVhY2hlZAogICAgYm9vbCBwdWJsaWMgdG9rZW5IYXJkY2FwUmVhY2hlZCA9IGZhbHNlOyAgLy8gVE9LRU5fSEFSRENBUCBoYXMgYmVlbiByZWFjaGVkCiAgICBib29sIHB1YmxpYyBzb2Z0Y2FwUmVhY2hlZCA9IGZhbHNlOyAgICAgLy8gc29mdGNhcCBoYXMgYmVlbiByZWFjaGVkCiAgICBib29sIHB1YmxpYyBzYWxlQ2xvc2VkID0gZmFsc2U7ICAgICAgICAgLy8gY3Jvd2RzYWxlIGlzIGNsb3NlZCBvciBub3QKICAgIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOyAgICAvLyBwcmV2ZW50IGNlcnRhaW4gZnVuY3Rpb25zIGZyb20gcmVjdXJzaXplIGNhbGxzCgogICAgdWludCBwdWJsaWMgZnVuZGluZ0NhcDsgICAgICAgICAgICAgICAgIC8vIHVwcGVyIGJvdW5kIG9uIGFtb3VudCB0aGF0IGNhbiBiZSByYWlzZWQgKGluIHdlaSkKICAgIHVpbnQyNTYgcHVibGljIHNvbGRUb2tlbnMgPSAwOyAgICAgICAgICAvLyBhbW91bnQgb2Ygc29sZCB0b2tlbnMgCiAgICB1aW50MjU2IHB1YmxpYyBzb2Z0Q2FwSW5Ub2tlbnMgPSAxNjAwMDAwICogMSBldGhlcjsgICAvLyBzb2Z0Y2FwIGluIHRva2VucyBmb3IgcHJvamVjdCBsYXVuY2gKCiAgICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQ7ICAgICAgICAgICAgICAgICAgLy8gYW1vdW50IG9mIHJhaXNlZCB3ZWkKICAgIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkOyAgICAgICAgICAgICAgICAgIC8vIGFtb3VudCBvZiByZWZ1bmRlZCB3ZWkKCiAgICB1aW50IHB1YmxpYyBzdGFydFRpbWU7ICAgICAgICAgICAgICAgICAgLy8gVU5JWCB0aW1lc3RhbXAgZm9yIHN0YXJ0IG9mIHNhbGUKICAgIHVpbnQgcHVibGljIGRlYWRsaW5lOyAgICAgICAgICAgICAgICAgICAvLyBVTklYIHRpbWVzdGFtcCBmb3IgZW5kIChkZWFkbGluZSkgb2Ygc2FsZQoKICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OyAgICAgICAgICAgICAvLyBUaGUgYmVuZWZpY2lhcnkgaXMgdGhlIGZ1dHVyZSByZWNpcGllbnQgb2YgdGhlIGZ1bmRzCgogICAgQml0a29tVG9rZW4gcHVibGljIHRva2VuUmV3YXJkOyAgICAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlT2Y7ICAgLy8gdHJhY2tzIHRoZSBhbW91bnQgb2Ygd2VpIGNvbnRyaWJ1dGVkIGJ5IGFkZHJlc3MgZHVyaW5nIGFsbCBzYWxlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSByZWZ1bmRlZDsgLy8gdHJhY2tzIHRoZSBzdGF0dXMgb2YgcmVmdW5kaW5nIGZvciBlYWNoIGFkZHJlc3MKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IENhcFJlYWNoZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3dlaVJhaXNlZCk7CiAgICBldmVudCBTb2Z0Y2FwUmVhY2hlZChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfd2VpUmFpc2VkKTsKICAgIGV2ZW50IEZ1bmRUcmFuc2ZlcihhZGRyZXNzIF9iYWNrZXIsIHVpbnQgX2Ftb3VudCwgYm9vbCBfaXNDb250cmlidXRpb24pOwogICAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGhvbGRlciwgdWludDI1NiBhbW91bnQpOwoKICAgIC8vIE1vZGlmaWVycwogICAgbW9kaWZpZXIgYmVmb3JlRGVhZGxpbmUoKSAgIHsgcmVxdWlyZSAoY3VycmVudFRpbWUoKSA8IGRlYWRsaW5lKTsgXzsgfQogICAgbW9kaWZpZXIgYWZ0ZXJEZWFkbGluZSgpICAgIHsgcmVxdWlyZSAoY3VycmVudFRpbWUoKSA+PSBkZWFkbGluZSk7IF87IH0KICAgIG1vZGlmaWVyIGFmdGVyU3RhcnRUaW1lKCkgICB7IHJlcXVpcmUgKGN1cnJlbnRUaW1lKCkgPj0gc3RhcnRUaW1lKTsgXzsgfQogICAgbW9kaWZpZXIgc2FsZU5vdENsb3NlZCgpICAgIHsgcmVxdWlyZSAoIXNhbGVDbG9zZWQpOyBfOyB9CiAgICBtb2RpZmllciBzb2Z0Q2FwUmFpc2VkKCkgICAgeyByZXF1aXJlIChzb2Z0Y2FwUmVhY2hlZCk7IF87IH0KCiAgICBtb2RpZmllciBub25SZWVudHJhbnQoKSB7CiAgICAgICAgcmVxdWlyZSghcmVudHJhbmN5X2xvY2spOwogICAgICAgIHJlbnRyYW5jeV9sb2NrID0gdHJ1ZTsKICAgICAgICBfOwogICAgICAgIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBmb3IgYSBjcm93ZHNhbGUgb2YgQml0a29tVG9rZW4gdG9rZW5zLgogICAgICoKICAgICAqIEBwYXJhbSBpZlN1Y2Nlc3NmdWxTZW5kVG8gICAgICAgICAgICB0aGUgYmVuZWZpY2lhcnkgb2YgdGhlIGZ1bmQKICAgICAqIEBwYXJhbSBmdW5kaW5nQ2FwSW5FdGhlcnMgICAgICAgICAgICB0aGUgY2FwIChtYXhpbXVtKSBzaXplIG9mIHRoZSBmdW5kCiAgICAgKiBAcGFyYW0gc3RhcnQgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHN0YXJ0IHRpbWUgKFVOSVggdGltZXN0YW1wKQogICAgICogQHBhcmFtIGR1cmF0aW9uSW5EYXlzICAgICAgICAgICAgICAgIHRoZSBkdXJhdGlvbiBvZiB0aGUgY3Jvd2RzYWxlIGluIGRheXMKICAgICAqIEBwYXJhbSBhZGRyZXNzT2ZUb2tlblVzZWRBc1Jld2FyZCAgICBhZGRyZXNzIG9mIHRoZSB0b2tlbiBiZWluZyBzb2xkCiAgICAgKi8KICAgIGZ1bmN0aW9uIEJpdGtvbVNhbGUoCiAgICAgICAgYWRkcmVzcyBpZlN1Y2Nlc3NmdWxTZW5kVG8sCiAgICAgICAgdWludDI1NiBmdW5kaW5nQ2FwSW5FdGhlcnMsCiAgICAgICAgdWludDI1NiBzdGFydCwKICAgICAgICB1aW50MjU2IGR1cmF0aW9uSW5EYXlzLAogICAgICAgIGFkZHJlc3MgYWRkcmVzc09mVG9rZW5Vc2VkQXNSZXdhcmQKICAgICkgcHVibGljIAogICAgeyAgICAgIAogICAgICAgIHJlcXVpcmUoaWZTdWNjZXNzZnVsU2VuZFRvICE9IGFkZHJlc3MoMCkgJiYgaWZTdWNjZXNzZnVsU2VuZFRvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzc09mVG9rZW5Vc2VkQXNSZXdhcmQgIT0gYWRkcmVzcygwKSAmJiBhZGRyZXNzT2ZUb2tlblVzZWRBc1Jld2FyZCAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKGR1cmF0aW9uSW5EYXlzID4gMCk7CiAgICAgICAgYmVuZWZpY2lhcnkgPSBpZlN1Y2Nlc3NmdWxTZW5kVG87CiAgICAgICAgZnVuZGluZ0NhcCA9IGZ1bmRpbmdDYXBJbkV0aGVycyAqIDEgZXRoZXI7CiAgICAgICAgc3RhcnRUaW1lID0gc3RhcnQ7CiAgICAgICAgZGVhZGxpbmUgPSBzdGFydCArIChkdXJhdGlvbkluRGF5cyAqIDEgZGF5cyk7CiAgICAgICAgdG9rZW5SZXdhcmQgPSBCaXRrb21Ub2tlbihhZGRyZXNzT2ZUb2tlblVzZWRBc1Jld2FyZCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBidXkoKTsKICAgIH0KCgogICAgZnVuY3Rpb24gYnV5KCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgcHVibGljCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgICAgIGJlZm9yZURlYWRsaW5lCiAgICAgICAgYWZ0ZXJTdGFydFRpbWUKICAgICAgICBzYWxlTm90Q2xvc2VkCiAgICAgICAgbm9uUmVlbnRyYW50CiAgICB7CiAgICAgICAgdWludCBhbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgcmVxdWlyZShhbW91bnQgPj0gTUlOX0NPTlRSSUJVVElPTik7CgogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQoYW1vdW50KTsKCiAgICAgICAgLy9yZXF1aXJlKHdlaVJhaXNlZCA8PSBmdW5kaW5nQ2FwKTsKICAgICAgICAvLyBpZiB3ZSBvdmVyZmxvdyB0aGUgZnVuZGluZ0NhcCwgdHJhbnNmZXIgdGhlIG92ZXJmbG93IGFtb3VudAogICAgICAgIGlmICh3ZWlSYWlzZWQgPiBmdW5kaW5nQ2FwKSB7CiAgICAgICAgICAgIHVpbnQgb3ZlcmZsb3cgPSB3ZWlSYWlzZWQuc3ViKGZ1bmRpbmdDYXApOwogICAgICAgICAgICBhbW91bnQgPSBhbW91bnQuc3ViKG92ZXJmbG93KTsKICAgICAgICAgICAgd2VpUmFpc2VkID0gZnVuZGluZ0NhcDsKICAgICAgICAgICAgLy8gdHJhbnNmZXIgb3ZlcmZsb3cgYmFjayB0byB0aGUgdXNlcgogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG92ZXJmbG93KTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBib251cyBmb3IgdXNlcgogICAgICAgIHVpbnQyNTYgYm9udXMgPSBjYWxjdWxhdGVCb251cygpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgYW1vdW50IG9mIHRva2VucyBmb3IgdXNlcgogICAgICAgIHVpbnQyNTYgdG9rZW5zQW1vdW50Rm9yVXNlciA9IChhbW91bnQubXVsKFJBVEUpKS5tdWwoYm9udXMpOwoKICAgICAgICBzb2xkVG9rZW5zID0gc29sZFRva2Vucy5hZGQodG9rZW5zQW1vdW50Rm9yVXNlcik7CgogICAgICAgIC8vIDEgLSDQstC10YDQvdGD0YLRjCDQu9C40YjQvdC40LUg0LHQsNCx0LrQuCDQuCDQvtGC0LTQsNGC0Ywg0YLQvtC60LXQvdGLINGH0YLQvtCxINC40YUg0LHRi9C70L4g0LLQv9GA0LjRgtGL0LoKICAgICAgICBpZiAoc29sZFRva2VucyA+IFRPS0VOX0hBUkRDQVApIHsKICAgICAgICAgICAgdWludDI1NiBvdmVyZmxvd0luVG9rZW5zID0gc29sZFRva2Vucy5zdWIoVE9LRU5fSEFSRENBUCk7CiAgICAgICAgICAgIHVpbnQyNTYgb3ZlcmZsb3dJbldlaSA9IChvdmVyZmxvd0luVG9rZW5zLmRpdihib251cykpLmRpdihSQVRFKTsKICAgICAgICAgICAgYW1vdW50ID0gYW1vdW50LnN1YihvdmVyZmxvd0luV2VpKTsKICAgICAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnN1YihvdmVyZmxvd0luV2VpKTsKICAgICAgICAgICAgLy8gdHJhbnNmZXIgb3ZlcmZsb3cgYmFjayB0byB0aGUgdXNlcgogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG92ZXJmbG93SW5XZWkpOwoKICAgICAgICAgICAgLy8gdXBkYXRlIGFtb3VudCBvZiB0b2tlbnMKICAgICAgICAgICAgdG9rZW5zQW1vdW50Rm9yVXNlciA9IHRva2Vuc0Ftb3VudEZvclVzZXIuc3ViKG92ZXJmbG93SW5Ub2tlbnMpOwoKICAgICAgICAgICAgc29sZFRva2VucyA9IFRPS0VOX0hBUkRDQVA7CiAgICAgICAgfQoKCiAgICAgICAgLy8gVXBkYXRlIHRoZSBzZW5kZXIncyBiYWxhbmNlIG9mIHdlaSBjb250cmlidXRlZCBhbmQgdGhlIHRvdGFsIGFtb3VudCByYWlzZWQKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0uYWRkKGFtb3VudCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHRoZSB0b2tlbnMgZnJvbSB0aGUgY3Jvd2RzYWxlIHN1cHBseSB0byB0aGUgc2VuZGVyCiAgICAgICAgaWYgKCF0b2tlblJld2FyZC50cmFuc2ZlckZyb20odG9rZW5SZXdhcmQub3duZXIoKSwgbXNnLnNlbmRlciwgdG9rZW5zQW1vdW50Rm9yVXNlcikpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBGdW5kVHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50LCB0cnVlKTsKCiAgICAgICAgaWYgKHNvbGRUb2tlbnMgPj0gc29mdENhcEluVG9rZW5zICYmICFzb2Z0Y2FwUmVhY2hlZCkgewogICAgICAgICAgICBzb2Z0Y2FwUmVhY2hlZCA9IHRydWU7CiAgICAgICAgICAgIFNvZnRjYXBSZWFjaGVkKGJlbmVmaWNpYXJ5LCB3ZWlSYWlzZWQpOwogICAgICAgIH0KCiAgICAgICAgY2hlY2tDYXBzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgb3duZXIgY2FuIHRlcm1pbmF0ZSB0aGUgY3Jvd2RzYWxlIGF0IGFueSB0aW1lLgogICAgICovCiAgICBmdW5jdGlvbiB0ZXJtaW5hdGUoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHNhbGVDbG9zZWQgPSB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICAqIFRoZSBvd25lciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIHRvIHdpdGhkcmF3IHRoZSBmdW5kcyB0aGF0CiAgICAgKiBoYXZlIGJlZW4gc2VudCB0byB0aGlzIGNvbnRyYWN0LiBUaGUgZnVuZHMgd2lsbCBiZSBzZW50IHRvCiAgICAgKiB0aGUgYmVuZWZpY2lhcnkgc3BlY2lmaWVkIHdoZW4gdGhlIGNyb3dkc2FsZSB3YXMgY3JlYXRlZC4KICAgICAqIE9OTFkgSUYgU09MRFRPS0VOUyA+PSBTT0ZUQ0FQSU5UT0tFTlMgISEhISEhISEhISEhISEhISEhCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyU2FmZVdpdGhkcmF3YWwoKSBleHRlcm5hbCBvbmx5T3duZXIgc29mdENhcFJhaXNlZCBub25SZWVudHJhbnQgewogICAgICAgIHVpbnQgYmFsYW5jZVRvU2VuZCA9IHRoaXMuYmFsYW5jZTsKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2ZlcihiYWxhbmNlVG9TZW5kKTsKICAgICAgICBGdW5kVHJhbnNmZXIoYmVuZWZpY2lhcnksIGJhbGFuY2VUb1NlbmQsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrcyBpZiB0aGUgZnVuZGluZyBjYXAgb3IgVE9LRU5fSEFSRENBUCBoYXMgYmVlbiByZWFjaGVkLiAKICAgICAqIElmIGl0IGhhcywgdGhlbiB0aGUgQ2FwUmVhY2hlZCBldmVudCBpcyB0cmlnZ2VyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrQ2FwcygpIGludGVybmFsIHsKICAgICAgICBpZiAod2VpUmFpc2VkID09IGZ1bmRpbmdDYXApIHsKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZ1bmRpbmcgY2FwIGhhcyBiZWVuIHJlYWNoZWQKICAgICAgICAgICAgZnVuZGluZ0NhcFJlYWNoZWQgPSB0cnVlOwogICAgICAgICAgICBzYWxlQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgQ2FwUmVhY2hlZChiZW5lZmljaWFyeSwgd2VpUmFpc2VkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNvbGRUb2tlbnMgPT0gVE9LRU5fSEFSRENBUCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZnVuZGluZyBjYXAgaGFzIGJlZW4gcmVhY2hlZAogICAgICAgICAgICB0b2tlbkhhcmRjYXBSZWFjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgc2FsZUNsb3NlZCA9IHRydWU7CiAgICAgICAgICAgIENhcFJlYWNoZWQoYmVuZWZpY2lhcnksIHdlaVJhaXNlZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY3VycmVudCB0aW1lLgogICAgKi8KICAgIGZ1bmN0aW9uIGN1cnJlbnRUaW1lKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBfY3VycmVudFRpbWUpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgYm9udXMgdmFsdWUuCiAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlQm9udXMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKHNvbGRUb2tlbnMgPj0gMCAmJiBzb2xkVG9rZW5zIDw9IDEwMDAwMDAwICogMSBldGhlcikgewogICAgICAgICAgICByZXR1cm4gNDsKICAgICAgICB9IGVsc2UgaWYgKHNvbGRUb2tlbnMgPiAxMDAwMDAwMCAqIDEgZXRoZXIgJiYgc29sZFRva2VucyA8PSAyMDAwMDAwMCAqIDEgZXRoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgfSBlbHNlIGlmIChzb2xkVG9rZW5zID4gMjAwMDAwMDAgKiAxIGV0aGVyICYmIHNvbGRUb2tlbnMgPD0gMzAwMDAwMDAgKiAxIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZWZ1bmQoKSBleHRlcm5hbCBhZnRlckRlYWRsaW5lIHsKICAgICAgICByZXF1aXJlKCFzb2Z0Y2FwUmVhY2hlZCk7CiAgICAgICAgcmVxdWlyZShyZWZ1bmRlZFttc2cuc2VuZGVyXSA9PSBmYWxzZSk7CgogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRoaXMuYmFsYW5jZU9mKG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZSA+IDApOwoKICAgICAgICB1aW50IHJlZnVuZCA9IGJhbGFuY2U7CiAgICAgICAgaWYgKHJlZnVuZCA+IHRoaXMuYmFsYW5jZSkgewogICAgICAgICAgICByZWZ1bmQgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChyZWZ1bmQpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICByZWZ1bmRlZFttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5hZGQocmVmdW5kKTsKICAgICAgICBSZWZ1bmRlZChtc2cuc2VuZGVyLCByZWZ1bmQpOwogICAgfQp9'.
	

]
