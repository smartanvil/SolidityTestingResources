Class {
	#name : #SRT3afde2b246a4d7466d6fa938f07625c60ef398eb,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3afde2b246a4d7466d6fa938f07625c60ef398eb >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIEV2ZW5EaXN0cm9Dcm93ZHNhbGVMaWIKICogQGF1dGhvciBNb2R1bGFyIEluYywgaHR0cHM6Ly9tb2R1bGFyLm5ldHdvcmsKICoKICogdmVyc2lvbiAyLjEuMAogKiBDb3B5cmlnaHQgKGMpIDIwMTcgTWFqb29sciwgTExDCiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKQogKiBodHRwczovL2dpdGh1Yi5jb20vTW9kdWxhci1OZXR3b3JrL2V0aGVyZXVtLWxpYnJhcmllcy9ibG9iL21hc3Rlci9MSUNFTlNFCiAqCiAqIFRoZSBFdmVuRGlzdHJvQ3Jvd2RzYWxlIExpYnJhcnkgcHJvdmlkZXMgZnVuY3Rpb25hbGl0eSB0byBjcmVhdGUgYSBpbml0aWFsIGNvaW4gb2ZmZXJpbmcKICogZm9yIGEgc3RhbmRhcmQgdG9rZW4gc2FsZSB3aXRoIGhpZ2ggZGVtYW5kIHdoZXJlIHRoZSBhbW91bnQgb2YgZXRoZXIgYSBzaW5nbGUgYWRkcmVzcwogKiBjYW4gY29udHJpYnV0ZSBpcyBjYWxjdWxhdGVkIGJ5IGRpdmlkaW5nIHRoZSBzYWxlJ3MgY29udHJpYnV0aW9uIGNhcCBieSB0aGUgbnVtYmVyCiAqIG9mIGFkZHJlc3NlcyB3aG8gcmVnaXN0ZXIgYmVmb3JlIHRoZSBzYWxlIHN0YXJ0cwogKgogKiBNb2R1bGFyIHByb3ZpZGVzIHNtYXJ0IGNvbnRyYWN0IHNlcnZpY2VzIGFuZCBzZWN1cml0eSByZXZpZXdzIGZvciBjb250cmFjdAogKiBkZXBsb3ltZW50cyBpbiBhZGRpdGlvbiB0byB3b3JraW5nIG9uIG9wZW4gc291cmNlIHByb2plY3RzIGluIHRoZSBFdGhlcmV1bQogKiBjb21tdW5pdHkuIE91ciBwdXJwb3NlIGlzIHRvIHRlc3QsIGRvY3VtZW50LCBhbmQgZGVwbG95IHJldXNhYmxlIGNvZGUgb250byB0aGUKICogYmxvY2tjaGFpbiBhbmQgaW1wcm92ZSBib3RoIHNlY3VyaXR5IGFuZCB1c2FiaWxpdHkuIFdlIGFsc28gZWR1Y2F0ZSBub24tcHJvZml0cywKICogc2Nob29scywgYW5kIG90aGVyIGNvbW11bml0eSBtZW1iZXJzIGFib3V0IHRoZSBhcHBsaWNhdGlvbiBvZiBibG9ja2NoYWluCiAqIHRlY2hub2xvZ3kuIEZvciBmdXJ0aGVyIGluZm9ybWF0aW9uOiBtb2R1bGFyLm5ldHdvcmsKICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKICogT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgogKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCiAqIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCiAqIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsCiAqIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFCiAqIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgogKi8KCmxpYnJhcnkgRXZlbkRpc3Ryb0Nyb3dkc2FsZUxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwogIHVzaW5nIENyb3dkc2FsZUxpYiBmb3IgQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2U7CgogIHN0cnVjdCBFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSB7CgogIAlDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZSBiYXNlOyAvLyBiYXNlIHN0b3JhZ2UgZnJvbSBDcm93ZHNhbGVMaWIKCiAgICAvLyBtYXBwaW5nIHNob3dpbmcgd2hpY2ggYWRkcmVzc2VzIGhhdmUgcmVnaXN0ZXJlZCBmb3IgdGhlIHNhbGUuIGNhbiBvbmx5IGJlIGNoYW5nZWQgYnkgdGhlIG93bmVyCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGlzUmVnaXN0ZXJlZDsKCiAgICAvLyB0cmFja3MgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgYm91Z2h0IGZvciBlYWNoIGFkZHJlc3MKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSB0b2tlbnNCb3VnaHQ7CgogICAgdWludDI1NiBudW1SZWdpc3RlcmVkOyAvLyByZWNvcmRzIGhvdyBtYW55IGFkZHJlc3NlcyBoYXZlIHJlZ2lzdGVyZWQKICAgIHVpbnQyNTYgYWRkcmVzc1Rva2VuQ2FwOyAvLyBjYXAgb24gaG93IG11Y2ggd2VpIGFuIGFkZHJlc3MgY2FuIGNvbnRyaWJ1dGUgaW4gdGhlIHNhbGUKICAgIGJvb2wgc3RhdGljQ2FwOyAvLyB0cnVlIGlmIHRoZSBnaXZlbiBhZGRyZXNzIGNhcCBhbW91bnRzIGFyZSBzZXQgb24gaW5pdGlhbGl6YXRpb24KICB9CgoKICBldmVudCBMb2dUb2tlbnNCb3VnaHQoYWRkcmVzcyBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ1Rva2VuUHJpY2VDaGFuZ2UodWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwogIGV2ZW50IExvZ0Vycm9yTXNnKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8gTG9ncyB3aGVuIGEgdXNlciBpcyByZWdpc3RlcmVkIGluIHRoZSBzeXN0ZW0gYmVmb3JlIHRoZSBzYWxlCiAgZXZlbnQgTG9nVXNlclJlZ2lzdGVyZWQoYWRkcmVzcyByZWdpc3RyYW50KTsKCiAgLy8gTG9ncyB3aGVuIGEgdXNlciBpcyB1bnJlZ2lzdGVyZWQgZnJvbSB0aGUgc3lzdGVtIGJlZm9yZSB0aGUgc2FsZQogIGV2ZW50IExvZ1VzZXJVblJlZ2lzdGVyZWQoYWRkcmVzcyByZWdpc3RyYW50KTsKCiAgLy8gTG9ncyB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIHdpdGggdXNlciByZWdpc3RyYXRpb24KICBldmVudCBMb2dSZWdFcnJvcihhZGRyZXNzIHVzZXIsIHN0cmluZyBNc2cpOwoKICAvLyBMb2dzIHdoZW4gdGhlcmUgaXMgYW4gaW5jcmVhc2UgaW4gdGhlIGNvbnRyaWJ1dGlvbiBjYXAgcGVyIGFkZHJlc3MKICBldmVudCBMb2dBZGRyZXNzVG9rZW5DYXBDaGFuZ2UodWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLyBMb2dzIHdoZW4gdGhlIGFkZHJlc3MgY2FwIGlzIGluaXRpYWxseSBjYWxjdWxhdGVkCiAgZXZlbnQgTG9nQWRkcmVzc1Rva2VuQ2FwQ2FsY3VsYXRlZCh1aW50MjU2IHNhbGVDYXAsIHVpbnQyNTYgbnVtUmVnaXN0ZXJlZCwgdWludDI1NiBjYXAsIHN0cmluZyBNc2cpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF9zdGF0aWNDYXAgV2hldGhlciBvciBub3QgdGhlIGFkZHJlc3MgY2FwIGlzIGdvaW5nIHRvIGJlIHN0YXRpYwogIC8vLyBAcGFyYW0gX3Rva2VuIFRva2VuIGJlaW5nIHNvbGQKICBmdW5jdGlvbiBpbml0KEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICB1aW50MjU2IF9pbml0aWFsQWRkcmVzc1Rva2VuQ2FwLAogICAgICAgICAgICAgICAgYm9vbCBfc3RhdGljQ2FwLAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gX3Rva2VuKQogICAgICAgICAgICAgICAgcHVibGljCiAgewogIAlzZWxmLmJhc2UuaW5pdChfb3duZXIsCiAgICAgICAgICAgICAgICAgICBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICAgICBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICAgICBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgICAgIF9lbmRUaW1lLAogICAgICAgICAgICAgICAgICAgX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgICAgX3Rva2VuKTsKCiAgICBzZWxmLmFkZHJlc3NUb2tlbkNhcCA9IF9pbml0aWFsQWRkcmVzc1Rva2VuQ2FwOwogICAgc2VsZi5zdGF0aWNDYXAgPSBfc3RhdGljQ2FwOwogIH0KCiAgLy8vIEBkZXYgcmVnaXN0ZXIgdXNlciBmdW5jdGlvbi4gY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciB3aGVuIGEgdXNlciByZWdpc3RlcnMgb24gdGhlIHdlYiBhcHAuCiAgLy8vIHB1dHMgdGhlaXIgYWRkcmVzcyBpbiB0aGUgcmVnaXN0ZXJlZCBtYXBwaW5nIGFuZCBpbmNyZW1lbnRzIHRoZSBudW1SZWdpc3RlcmVkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9yZWdpc3RyYW50IGFkZHJlc3MgdG8gYmUgcmVnaXN0ZXJlZCBmb3IgdGhlIHNhbGUKICBmdW5jdGlvbiByZWdpc3RlclVzZXIoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9yZWdpc3RyYW50KQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKChtc2cuc2VuZGVyID09IHNlbGYuYmFzZS5vd25lcikgfHwgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSkpOwogICAgLy8gaWYgdGhlIGNoYW5nZSBpbnRlcnZhbCBpcyAwLCB0aGVuIHJlZ2lzdHJhdGlvbiBpcyBhbGxvd2VkIHRocm91Z2hvdXQgdGhlCiAgICAvLyBzYWxlIHNpbmNlIGEgY2FwIGRvZXNuJ3QgbmVlZCB0byBiZSBjYWxjdWxhdGVkCiAgICBpZiAoKCFzZWxmLnN0YXRpY0NhcCkgJiYgKG5vdyA+PSBzZWxmLmJhc2Uuc3RhcnRUaW1lIC0gMiBob3VycykpIHsKICAgICAgTG9nUmVnRXJyb3IoX3JlZ2lzdHJhbnQsICJDYW4gb25seSByZWdpc3RlciB1c2VycyBlYXJsaWVyIHRoYW4gMiBob3VycyBiZWZvcmUgdGhlIHNhbGUhIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmKHNlbGYuaXNSZWdpc3RlcmVkW19yZWdpc3RyYW50XSkgewogICAgICBMb2dSZWdFcnJvcihfcmVnaXN0cmFudCwgIlJlZ2lzdHJhbnQgYWRkcmVzcyBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQgZm9yIHRoZSBzYWxlISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdWludDI1NiByZXN1bHQ7CiAgICBib29sIGVycjsKCiAgICBzZWxmLmlzUmVnaXN0ZXJlZFtfcmVnaXN0cmFudF0gPSB0cnVlOwogICAgKGVycixyZXN1bHQpID0gc2VsZi5udW1SZWdpc3RlcmVkLnBsdXMoMSk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5udW1SZWdpc3RlcmVkID0gcmVzdWx0OwoKICAgIExvZ1VzZXJSZWdpc3RlcmVkKF9yZWdpc3RyYW50KTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IHJlZ2lzdGVycyBtdWx0aXBsZSB1c2VycyBhdCB0aGUgc2FtZSB0aW1lCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9yZWdpc3RyYW50cyBhZGRyZXNzZXMgdG8gcmVnaXN0ZXIgZm9yIHRoZSBzYWxlCiAgZnVuY3Rpb24gcmVnaXN0ZXJVc2VycyhFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3NbXSBfcmVnaXN0cmFudHMpCiAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYuYmFzZS5vd25lcik7CgogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX3JlZ2lzdHJhbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlZ2lzdGVyVXNlcihzZWxmLF9yZWdpc3RyYW50c1tpXSk7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IENhbmNlbHMgYSB1c2VyJ3MgcmVnaXN0cmF0aW9uIHN0YXR1cyBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIHdoZW4gYSB1c2VyIGNhbmNlbHMgdGhlaXIgcmVnaXN0cmF0aW9uLgogIC8vLyBzZXRzIHRoZWlyIGFkZHJlc3MgZmllbGQgaW4gdGhlIHJlZ2lzdGVyZWQgbWFwcGluZyB0byBmYWxzZSBhbmQgZGVjcmVtZW50cyB0aGUgbnVtUmVnaXN0ZXJlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgZnVuY3Rpb24gdW5yZWdpc3RlclVzZXIoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9yZWdpc3RyYW50KQogICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZSgobXNnLnNlbmRlciA9PSBzZWxmLmJhc2Uub3duZXIpIHx8IChtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpKTsKICAgIGlmICgoIXNlbGYuc3RhdGljQ2FwKSAmJiAobm93ID49IHNlbGYuYmFzZS5zdGFydFRpbWUgLSAyIGhvdXJzKSkgewogICAgICBMb2dSZWdFcnJvcihfcmVnaXN0cmFudCwgIkNhbiBvbmx5IHVucmVnaXN0ZXIgdXNlcnMgZWFybGllciB0aGFuIDIgaG91cnMgYmVmb3JlIHRoZSBzYWxlISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZighc2VsZi5pc1JlZ2lzdGVyZWRbX3JlZ2lzdHJhbnRdKSB7CiAgICAgIExvZ1JlZ0Vycm9yKF9yZWdpc3RyYW50LCAiUmVnaXN0cmFudCBhZGRyZXNzIG5vdCByZWdpc3RlcmVkIGZvciB0aGUgc2FsZSEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHVpbnQyNTYgcmVzdWx0OwogICAgYm9vbCBlcnI7CgogICAgc2VsZi5pc1JlZ2lzdGVyZWRbX3JlZ2lzdHJhbnRdID0gZmFsc2U7CiAgICAoZXJyLHJlc3VsdCkgPSBzZWxmLm51bVJlZ2lzdGVyZWQubWludXMoMSk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5udW1SZWdpc3RlcmVkID0gcmVzdWx0OwoKICAgIExvZ1VzZXJVblJlZ2lzdGVyZWQoX3JlZ2lzdHJhbnQpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgdW5yZWdpc3RlcnMgbXVsdGlwbGUgdXNlcnMgYXQgdGhlIHNhbWUgdGltZQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfcmVnaXN0cmFudHMgYWRkcmVzc2VzIHRvIHVucmVnaXN0ZXIgZm9yIHRoZSBzYWxlCiAgZnVuY3Rpb24gdW5yZWdpc3RlclVzZXJzKEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzc1tdIF9yZWdpc3RyYW50cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYuYmFzZS5vd25lcik7CgogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX3JlZ2lzdHJhbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHVucmVnaXN0ZXJVc2VyKHNlbGYsX3JlZ2lzdHJhbnRzW2ldKTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdGhhdCBjYWxjdWxhdGVzIGFkZHJlc3MgY2FwIGZyb20gdGhlIG51bWJlciBvZiB1c2VycyByZWdpc3RlcmVkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICBmdW5jdGlvbiBjYWxjdWxhdGVBZGRyZXNzVG9rZW5DYXAoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJlcXVpcmUoc2VsZi5udW1SZWdpc3RlcmVkID4gMCk7CiAgICByZXF1aXJlKHNlbGYuYmFzZS50b2tlbi5iYWxhbmNlT2YodGhpcykgPiAwKTsKCiAgICBpZiAoc2VsZi5zdGF0aWNDYXApICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJlcXVpcmUoIXNlbGYuYmFzZS5yYXRlU2V0KTsgIC8vIG1ha2VzIHN1cmUgdGhpcyBjYW4gb25seSBiZSBjYWxsZWQgb25jZQoKICAgIHVpbnQyNTYgX2Jhc2VDYXA7CiAgICB1aW50MjU2IF9jYWxjQ2FwOwogICAgYm9vbCBlcnI7CgogICAgX2Jhc2VDYXAgPSAoc2VsZi5iYXNlLnRva2VuLmJhbGFuY2VPZih0aGlzKSkvc2VsZi5udW1SZWdpc3RlcmVkOyAvLyBudW1SZWdpc3RlcmVkIHJlcXVpcmVkIHRvIGJlID4gMAoKICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzLmxlbmd0aDsgaSsrKXsKICAgICAgKGVycixfY2FsY0NhcCkgPSBzZWxmLmJhc2Uuc2FsZURhdGFbc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzW2ldXVsxXS50aW1lcyhfYmFzZUNhcCk7CiAgICAgIHJlcXVpcmUoIWVycik7CiAgICAgIHNlbGYuYmFzZS5zYWxlRGF0YVtzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbaV1dWzFdID0gX2NhbGNDYXAvMTAwOwogICAgfQoKICAgIHNlbGYuYWRkcmVzc1Rva2VuQ2FwID0gc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1swXV1bMV07CiAgICBMb2dBZGRyZXNzVG9rZW5DYXBDYWxjdWxhdGVkKHNlbGYuYmFzZS5jYXBBbW91bnQsIHNlbGYubnVtUmVnaXN0ZXJlZCwgc2VsZi5hZGRyZXNzVG9rZW5DYXAsICJBZGRyZXNzIGNhcCB3YXMgQ2FsY3VsYXRlZCEiKTsKICB9CgogIC8vLyBAZGV2IHV0aWxpdHkgZnVuY3Rpb24gZm9yIHRoZSByZWNlaXZlUHVyY2hhc2UgZnVuY3Rpb24uIHJldHVybnMgdGhlIGxvd2VyIG51bWJlcgogIC8vLyBAcGFyYW0gYSBmaXJzdCBhcmd1bWVudAogIC8vLyBAcGFyYW0gYiBzZWNvbmQgYXJndW1lbnQKICBmdW5jdGlvbiBnZXRNaW4odWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGE8YikgeyByZXR1cm4gYTsgfSBlbHNlIHsgcmV0dXJuIGI7IH0KICB9CgoKICAvLy8gQGRldiBDYWxsZWQgd2hlbiBhbiBhZGRyZXNzIHdhbnRzIHRvIHB1cmNoYXNlIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IGFtb3VuZCBvZiB3ZWkgdGhhdCB0aGUgYnV5ZXIgaXMgc2VuZGluZwogIC8vLyBAcmV0dXJuIHRydWUgb24gc3VjY2VzZnVsIHB1cmNoYXNlCiAgZnVuY3Rpb24gcmVjZWl2ZVB1cmNoYXNlKEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gc2VsZi5iYXNlLm93bmVyKTsKICAgIHJlcXVpcmUoc2VsZi5iYXNlLnZhbGlkUHVyY2hhc2UoKSk7CiAgICByZXF1aXJlKHNlbGYuaXNSZWdpc3RlcmVkW21zZy5zZW5kZXJdKTsKCiAgCS8vIGlmIHRoZSBhZGRyZXNzIGNhcCBpbmNyZWFzZSBpbnRlcnZhbCBoYXMgcGFzc2VkLCB1cGRhdGUgdGhlIGN1cnJlbnQgZGF5IGFuZCBjaGFuZ2UgdGhlIGFkZHJlc3MgY2FwCiAgCWlmICgoc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzLmxlbmd0aCA+IHNlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMSkgJiYKICAgICAgICAobm93ID4gc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzW3NlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMV0pKQogICAgewogICAgICB3aGlsZSgoc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzLmxlbmd0aCA+IHNlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMSkgJiYKICAgICAgICAgICAgKG5vdyA+IHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDFdKSkKICAgICAgewogICAgICAgIHNlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICs9IDE7CiAgICAgIH0KCiAgICAgIHNlbGYuYWRkcmVzc1Rva2VuQ2FwID0gc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZV1dWzFdOwoKICAgICAgc2VsZi5iYXNlLmNoYW5nZVRva2VuUHJpY2Uoc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZV1dWzBdKTsKCiAgICAgIExvZ0FkZHJlc3NUb2tlbkNhcENoYW5nZShzZWxmLmFkZHJlc3NUb2tlbkNhcCwgIkFkZHJlc3MgY2FwIGhhcyBpbmNyZWFzZWQhIik7CiAgICAgIExvZ1Rva2VuUHJpY2VDaGFuZ2Uoc2VsZi5iYXNlLnRva2Vuc1BlckV0aCwiVG9rZW4gUHJpY2UgaGFzIGNoYW5nZWQhIik7CiAgCX0KCiAgICB1aW50MjU2IF9udW1Ub2tlbnM7IC8vbnVtYmVyIG9mIHRva2VucyB0aGF0IHdpbGwgYmUgcHVyY2hhc2VkCiAgICB1aW50MjU2IF9uZXdCYWxhbmNlOyAvL3RoZSBuZXcgYmFsYW5jZSBvZiB0aGUgb3duZXIgb2YgdGhlIGNyb3dkc2FsZQogICAgdWludDI1NiBfd2VpVG9rZW5zOyAvL3RlbXAgY2FsYyBob2xkZXIKICAgIHVpbnQyNTYgX2xlZnRvdmVyV2VpOyAvL3dlaSBjaGFuZ2UgZm9yIHB1cmNoYXNlcgogICAgdWludDI1NiBfcmVtYWluZGVyOyAvL3RlbXAgY2FsYyBob2xkZXIKICAgIHVpbnQyNTYgX2FsbG93ZWRXZWk7ICAvLyB0ZWxscyBob3cgbXVjaCBtb3JlIHRoZSBidXllciBjYW4gY29udHJpYnV0ZSB1cCB0byB0aGVpciBjYXAKICAgIGJvb2wgZXJyOwoKICAgIGlmKChzZWxmLmJhc2Uub3duZXJCYWxhbmNlICsgX2Ftb3VudCkgPiBzZWxmLmJhc2UuY2FwQW1vdW50KXsKICAgICAgX2xlZnRvdmVyV2VpID0gKHNlbGYuYmFzZS5vd25lckJhbGFuY2UgKyBfYW1vdW50KSAtIHNlbGYuYmFzZS5jYXBBbW91bnQ7CiAgICAgIF9hbW91bnQgPSBfYW1vdW50IC0gX2xlZnRvdmVyV2VpOwogICAgfQoKICAgIGlmKHNlbGYuYWRkcmVzc1Rva2VuQ2FwID4gMCkgewogICAgICAvL19hbGxvd2VkV2VpIHJlcHJlc2VudHMgdG9rZW5zIGZpcnN0LCByZWN5Y2xlIHZhcmlhYmxlIHRvIHByZXZlbnQgc3RhY2sgZGVwdGggaXNzdWVzCiAgICAgIF9hbGxvd2VkV2VpID0gc2VsZi5hZGRyZXNzVG9rZW5DYXAgLSBzZWxmLnRva2Vuc0JvdWdodFttc2cuc2VuZGVyXTsKCiAgICAgIChlcnIsIF9hbGxvd2VkV2VpKSA9IF9hbGxvd2VkV2VpLnRpbWVzKDEwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgX2FsbG93ZWRXZWkgPSBfYWxsb3dlZFdlaS9zZWxmLmJhc2UudG9rZW5zUGVyRXRoOwogICAgfSBlbHNlIHsKICAgICAgLy8gaWYgYWRkcmVzc1Rva2VuQ2FwIGlzIHplcm8gdGhlbiB0aGVyZSBpcyBubyBjYXAKICAgICAgX2FsbG93ZWRXZWkgPSBfYW1vdW50OwogICAgfQogICAgcmVxdWlyZShfYWxsb3dlZFdlaSA+IDApOwogICAgX2FsbG93ZWRXZWkgPSBnZXRNaW4oX2Ftb3VudCxfYWxsb3dlZFdlaSk7CiAgICBfbGVmdG92ZXJXZWkgPSBfbGVmdG92ZXJXZWkgKyAoX2Ftb3VudCAtIF9hbGxvd2VkV2VpKTsKCiAgICAvLyBGaW5kIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFzIGEgZnVuY3Rpb24gaW4gd2VpCiAgICAoZXJyLF93ZWlUb2tlbnMpID0gX2FsbG93ZWRXZWkudGltZXMoc2VsZi5iYXNlLnRva2Vuc1BlckV0aCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIF9udW1Ub2tlbnMgPSBfd2VpVG9rZW5zIC8gMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIF9yZW1haW5kZXIgPSBfd2VpVG9rZW5zICUgMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIF9yZW1haW5kZXIgPSBfcmVtYWluZGVyIC8gc2VsZi5iYXNlLnRva2Vuc1BlckV0aDsKICAgIF9sZWZ0b3ZlcldlaSA9IF9sZWZ0b3ZlcldlaSArIF9yZW1haW5kZXI7CiAgICBfYW1vdW50ID0gX2Ftb3VudCAtIF9yZW1haW5kZXI7CiAgICBzZWxmLmJhc2UubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gKz0gX2xlZnRvdmVyV2VpOwoKICAgIC8vIGNhbid0IG92ZXJmbG93IGJlY2F1c2UgaXQgaXMgdW5kZXIgdGhlIGNhcAogICAgc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdICs9IF9hbGxvd2VkV2VpIC0gX3JlbWFpbmRlcjsKCiAgICBhc3NlcnQoX251bVRva2VucyA8PSBzZWxmLmJhc2UudG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKCiAgICAvLyBjYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBldGhlciBpbiB0aGUgb3duZXJzIGJhbGFuY2UKICAgIChlcnIsX25ld0JhbGFuY2UpID0gc2VsZi5iYXNlLm93bmVyQmFsYW5jZS5wbHVzKF9hbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmJhc2Uub3duZXJCYWxhbmNlID0gX25ld0JhbGFuY2U7ICAgLy8gImRlcG9zaXQiIHRoZSBhbW91bnQKCiAgICAvLyBjYW4ndCBvdmVyZmxvdyBiZWNhdXNlIGl0IHdpbGwgYmUgdW5kZXIgdGhlIGNhcAogICAgc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdICs9IF9udW1Ub2tlbnM7CiAgICBzZWxmLnRva2Vuc0JvdWdodFttc2cuc2VuZGVyXSArPSBfbnVtVG9rZW5zOwoKICAgIC8vc3VidHJhY3QgdG9rZW5zIGZyb20gb3duZXIncyBzaGFyZQogICAgKGVycixfcmVtYWluZGVyKSA9IHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtzZWxmLmJhc2Uub3duZXJdLm1pbnVzKF9udW1Ub2tlbnMpOwogICAgcmVxdWlyZSghZXJyKTsKICAgIHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtzZWxmLmJhc2Uub3duZXJdID0gX3JlbWFpbmRlcjsKCiAgICBMb2dUb2tlbnNCb3VnaHQobXNnLnNlbmRlciwgX251bVRva2Vucyk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKkZ1bmN0aW9ucyAiaW5oZXJpdGVkIiBmcm9tIENyb3dkc2FsZUxpYiBsaWJyYXJ5Ki8KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9leGNoYW5nZVJhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICBib29sIG9rID0gY2FsY3VsYXRlQWRkcmVzc1Rva2VuQ2FwKHNlbGYpOwogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKSAmJiBvazsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucyhFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBib29sIG9rID0gY2FsY3VsYXRlQWRkcmVzc1Rva2VuQ2FwKHNlbGYpOwogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3TGVmdG92ZXJXZWkoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd0xlZnRvdmVyV2VpKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd093bmVyRXRoKEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gZ2V0U2FsZURhdGEoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IHRpbWVzdGFtcCkKICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICB2aWV3CiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAodWludDI1NlszXSkKICB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmdldFNhbGVEYXRhKHRpbWVzdGFtcCk7CiAgfQoKICBmdW5jdGlvbiBnZXRUb2tlbnNTb2xkKEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYuYmFzZS5nZXRUb2tlbnNTb2xkKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmNyb3dkc2FsZUVuZGVkKCk7CiAgfQp9CgpsaWJyYXJ5IENyb3dkc2FsZUxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgQ3Jvd2RzYWxlU3RvcmFnZSB7CiAgCWFkZHJlc3Mgb3duZXI7ICAgICAvL293bmVyIG9mIHRoZSBjcm93ZHNhbGUKCiAgCXVpbnQyNTYgdG9rZW5zUGVyRXRoOyAgLy9udW1iZXIgb2YgdG9rZW5zIHJlY2VpdmVkIHBlciBldGhlcgogIAl1aW50MjU2IGNhcEFtb3VudDsgLy9NYXhpbXVtIGFtb3VudCB0byBiZSByYWlzZWQgaW4gd2VpCiAgCXVpbnQyNTYgc3RhcnRUaW1lOyAvL0lDTyBzdGFydCB0aW1lLCB0aW1lc3RhbXAKICAJdWludDI1NiBlbmRUaW1lOyAvL0lDTyBlbmQgdGltZSwgdGltZXN0YW1wIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZAogICAgdWludDI1NiBleGNoYW5nZVJhdGU7IC8vY2VudHMvRVRIIGV4Y2hhbmdlIHJhdGUgYXQgdGhlIHRpbWUgb2YgdGhlIHNhbGUKICAgIHVpbnQyNTYgb3duZXJCYWxhbmNlOyAvL293bmVyIHdlaSBCYWxhbmNlCiAgICB1aW50MjU2IHN0YXJ0aW5nVG9rZW5CYWxhbmNlOyAvL2luaXRpYWwgYW1vdW50IG9mIHRva2VucyBmb3Igc2FsZQogICAgdWludDI1NltdIG1pbGVzdG9uZVRpbWVzOyAvL0FycmF5IG9mIHRpbWVzdGFtcHMgd2hlbiB0b2tlbiBwcmljZSBhbmQgYWRkcmVzcyBjYXAgY2hhbmdlcwogICAgdWludDggY3VycmVudE1pbGVzdG9uZTsgLy9Qb2ludGVyIHRvIHRoZSBjdXJyZW50IG1pbGVzdG9uZQogICAgdWludDggdG9rZW5EZWNpbWFsczsgLy9zdG9yZWQgdG9rZW4gZGVjaW1hbHMgZm9yIGNhbGN1bGF0aW9uIGxhdGVyCiAgICB1aW50OCBwZXJjZW50QnVybjsgLy9wZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgICBib29sIHRva2Vuc1NldDsgLy90cnVlIGlmIHRva2VucyBoYXZlIGJlZW4gcHJlcGFyZWQgZm9yIGNyb3dkc2FsZQogICAgYm9vbCByYXRlU2V0OyAvL3RydWUgaWYgZXhjaGFuZ2UgcmF0ZSBoYXMgYmVlbiBzZXQKCiAgICAvL01hcHMgdGltZXN0YW1wIHRvIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIHB1cmNoYXNlIGNhcCBzdGFydGluZyBhdCB0aGF0IHRpbWUKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NlsyXSkgc2FsZURhdGE7CgogICAgLy9zaG93cyBob3cgbXVjaCB3ZWkgYW4gYWRkcmVzcyBoYXMgY29udHJpYnV0ZWQKICAJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBoYXNDb250cmlidXRlZDsKCiAgICAvL0ZvciB0b2tlbiB3aXRoZHJhdyBmdW5jdGlvbiwgbWFwcyBhIHVzZXIgYWRkcmVzcyB0byB0aGUgYW1vdW50IG9mIHRva2VucyB0aGV5IGNhbiB3aXRoZHJhdwogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHdpdGhkcmF3VG9rZW5zTWFwOwoKICAgIC8vIGFueSBsZWZ0b3ZlciB3ZWkgdGhhdCBidXllcnMgY29udHJpYnV0ZWQgdGhhdCBkaWRuJ3QgYWRkIHVwIHRvIGEgd2hvbGUgdG9rZW4gYW1vdW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGxlZnRvdmVyV2VpOwoKICAJQ3Jvd2RzYWxlVG9rZW4gdG9rZW47IC8vdG9rZW4gYmVpbmcgc29sZAogIH0KCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gYWRkcmVzcyBoYXMgd2l0aGRyYXduIHRoZWlyIHN1cHBseSBvZiB0b2tlbnMKICBldmVudCBMb2dUb2tlbnNXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gYWRkcmVzcyBoYXMgd2l0aGRyYXduIHRoZWlyIHN1cHBseSBvZiBleHRyYSB3ZWkKICBldmVudCBMb2dXZWlXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKCiAgLy8gTG9ncyB3aGVuIG93bmVyIGhhcyBwdWxsZWQgZXRoCiAgZXZlbnQgTG9nT3duZXJFdGhXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgogIC8vIEdlbmVyaWMgTm90aWNlIG1lc3NhZ2UgdGhhdCBpbmNsdWRlcyBhbmQgYWRkcmVzcyBhbmQgbnVtYmVyCiAgZXZlbnQgTG9nTm90aWNlTXNnKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IHZhbHVlLCBzdHJpbmcgTXNnKTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gZXJyb3IgaGFzIG9jY3VycmVkIGluIHRoZSBleGVjdXRpb24gb2YgYSBmdW5jdGlvbgogIGV2ZW50IExvZ0Vycm9yTXNnKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIGNyb3dkc2FsZSBvd25lcgogIC8vLyBAcGFyYW0gX3NhbGVEYXRhIEFycmF5IG9mIDMgaXRlbSBzZXRzIHN1Y2ggdGhhdCwgaW4gZWFjaCAzIGVsZW1lbnQKICAvLy8gc2V0LCAxIGlzIHRpbWVzdGFtcCwgMiBpcyBwcmljZSBpbiBjZW50cyBhdCB0aGF0IHRpbWUsCiAgLy8vIDMgaXMgYWRkcmVzcyB0b2tlbiBwdXJjaGFzZSBjYXAgYXQgdGhhdCB0aW1lLCAwIGlmIG5vIGFkZHJlc3MgY2FwCiAgLy8vIEBwYXJhbSBfZmFsbGJhY2tFeGNoYW5nZVJhdGUgRXhjaGFuZ2UgcmF0ZSBvZiBjZW50cy9FVEgKICAvLy8gQHBhcmFtIF9jYXBBbW91bnRJbkNlbnRzIFRvdGFsIHRvIGJlIHJhaXNlZCBpbiBjZW50cwogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYmVpbmcgc29sZAogIGZ1bmN0aW9uIGluaXQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDggX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gX3Rva2VuKQogICAgICAgICAgICAgICAgcHVibGljCiAgewogIAlyZXF1aXJlKHNlbGYuY2FwQW1vdW50ID09IDApOwogIAlyZXF1aXJlKHNlbGYub3duZXIgPT0gMCk7CiAgICByZXF1aXJlKF9zYWxlRGF0YS5sZW5ndGggPiAwKTsKICAgIHJlcXVpcmUoKF9zYWxlRGF0YS5sZW5ndGglMykgPT0gMCk7IC8vIGVuc3VyZSBzYWxlRGF0YSBpcyAzLWl0ZW0gc2V0cwogICAgcmVxdWlyZShfc2FsZURhdGFbMF0gPiAobm93ICsgMiBob3VycykpOwogICAgcmVxdWlyZShfZW5kVGltZSA+IF9zYWxlRGF0YVswXSk7CiAgICByZXF1aXJlKF9jYXBBbW91bnRJbkNlbnRzID4gMCk7CiAgICByZXF1aXJlKF9vd25lciA+IDApOwogICAgcmVxdWlyZShfZmFsbGJhY2tFeGNoYW5nZVJhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3BlcmNlbnRCdXJuIDw9IDEwMCk7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5jYXBBbW91bnQgPSAoKF9jYXBBbW91bnRJbkNlbnRzL19mYWxsYmFja0V4Y2hhbmdlUmF0ZSkgKyAxKSooMTAqKjE4KTsKICAgIHNlbGYuc3RhcnRUaW1lID0gX3NhbGVEYXRhWzBdOwogICAgc2VsZi5lbmRUaW1lID0gX2VuZFRpbWU7CiAgICBzZWxmLnRva2VuID0gX3Rva2VuOwogICAgc2VsZi50b2tlbkRlY2ltYWxzID0gX3Rva2VuLmRlY2ltYWxzKCk7CiAgICBzZWxmLnBlcmNlbnRCdXJuID0gX3BlcmNlbnRCdXJuOwogICAgc2VsZi5leGNoYW5nZVJhdGUgPSBfZmFsbGJhY2tFeGNoYW5nZVJhdGU7CgogICAgdWludDI1NiBfdGVtcFRpbWU7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9zYWxlRGF0YS5sZW5ndGg7IGkgKz0gMyl7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2ldID4gX3RlbXBUaW1lKTsKICAgICAgcmVxdWlyZShfc2FsZURhdGFbaSArIDFdID4gMCk7CiAgICAgIHJlcXVpcmUoKF9zYWxlRGF0YVtpICsgMl0gPT0gMCkgfHwgKF9zYWxlRGF0YVtpICsgMl0gPj0gMTAwKSk7CiAgICAgIHNlbGYubWlsZXN0b25lVGltZXMucHVzaChfc2FsZURhdGFbaV0pOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMF0gPSBfc2FsZURhdGFbaSArIDFdOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMV0gPSBfc2FsZURhdGFbaSArIDJdOwogICAgICBfdGVtcFRpbWUgPSBfc2FsZURhdGFbaV07CiAgICB9CiAgICBjaGFuZ2VUb2tlblByaWNlKHNlbGYsIF9zYWxlRGF0YVsxXSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIChub3cgPj0gc2VsZi5zdGFydFRpbWUgJiYgbm93IDw9IHNlbGYuZW5kVGltZSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gc3VjY2VzcwogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBub3cgPiBzZWxmLmVuZFRpbWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHB1cmNoYXNlIGlzIHZhbGlkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICBpZiAoY3Jvd2RzYWxlQWN0aXZlKHNlbGYpICYmIG5vblplcm9QdXJjaGFzZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIExvZ0Vycm9yTXNnKG1zZy52YWx1ZSwgIkludmFsaWQgUHVyY2hhc2UhIENoZWNrIHN0YXJ0IHRpbWUgYW5kIGFtb3VudCBvZiBldGhlci4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHdlcmUgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBib29sIG9rOwoKICAgIGlmIChzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID09IDApIHsKICAgICAgTG9nRXJyb3JNc2coMCwgIlNlbmRlciBoYXMgbm8gdG9rZW5zIHRvIHdpdGhkcmF3ISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcikgewogICAgICBpZighY3Jvd2RzYWxlRW5kZWQoc2VsZikpewogICAgICAgIExvZ0Vycm9yTXNnKDAsICJPd25lciBjYW5ub3Qgd2l0aGRyYXcgZXh0cmEgdG9rZW5zIHVudGlsIGFmdGVyIHRoZSBzYWxlISIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZihzZWxmLnBlcmNlbnRCdXJuID4gMCl7CiAgICAgICAgICB1aW50MjU2IF9idXJuQW1vdW50ID0gKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKiBzZWxmLnBlcmNlbnRCdXJuKS8xMDA7CiAgICAgICAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSAtIF9idXJuQW1vdW50OwogICAgICAgICAgb2sgPSBzZWxmLnRva2VuLmJ1cm5Ub2tlbihfYnVybkFtb3VudCk7CiAgICAgICAgICByZXF1aXJlKG9rKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdG90YWwgPSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IDA7CiAgICBvayA9IHNlbGYudG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgdG90YWwpOwogICAgcmVxdWlyZShvayk7CiAgICBMb2dUb2tlbnNXaXRoZHJhd24obXNnLnNlbmRlciwgdG90YWwpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiBjYWxsZWQgYnkgcHVyY2hhc2VycyB0byBwdWxsIGxlZnRvdmVyIHdlaSBmcm9tIHRoZWlyIHB1cmNoYXNlcwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB3ZWkgd2FzIHdpdGhkcmF3bgogIGZ1bmN0aW9uIHdpdGhkcmF3TGVmdG92ZXJXZWkoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBpZiAoc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgIExvZ0Vycm9yTXNnKDAsICJTZW5kZXIgaGFzIG5vIGV4dHJhIHdlaSB0byB3aXRoZHJhdyEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl07CiAgICBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdID0gMDsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG90YWwpOwogICAgTG9nV2VpV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgc2VuZCBldGhlciBmcm9tIHRoZSBjb21wbGV0ZWQgY3Jvd2RzYWxlIHRvIHRoZSBvd25lcnMgd2FsbGV0IGFkZHJlc3MKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgb3duZXIgd2l0aGRyZXcgZXRoCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGlmICgoIWNyb3dkc2FsZUVuZGVkKHNlbGYpKSAmJiAoc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk+MCkpIHsKICAgICAgTG9nRXJyb3JNc2coMCwgIkNhbm5vdCB3aXRoZHJhdyBvd25lciBldGhlciB1bnRpbCBhZnRlciB0aGUgc2FsZSEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoc2VsZi5vd25lckJhbGFuY2UgPiAwKTsKCiAgICB1aW50MjU2IGFtb3VudCA9IHNlbGYub3duZXJCYWxhbmNlOwogICAgc2VsZi5vd25lckJhbGFuY2UgPSAwOwogICAgc2VsZi5vd25lci50cmFuc2ZlcihhbW91bnQpOwogICAgTG9nT3duZXJFdGhXaXRoZHJhd24obXNnLnNlbmRlcixhbW91bnQsIkNyb3dkc2FsZSBvd25lciBoYXMgd2l0aGRyYXduIGFsbCBmdW5kcyEiKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgcHJpY2Ugb2YgdGhlIHRva2VuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9uZXdQcmljZSBuZXcgdG9rZW4gcHJpY2UgKGFtb3VudCBvZiB0b2tlbnMgcGVyIGV0aGVyKQogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRva2VuIHByaWNlIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5CiAgZnVuY3Rpb24gY2hhbmdlVG9rZW5QcmljZShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX25ld1ByaWNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogIAlyZXF1aXJlKF9uZXdQcmljZSA+IDApOwoKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiByZXN1bHQ7CgogICAgKGVyciwgcmVzdWx0KSA9IHNlbGYuZXhjaGFuZ2VSYXRlLnRpbWVzKDEwKip1aW50MjU2KHNlbGYudG9rZW5EZWNpbWFscykpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLnRva2Vuc1BlckV0aCA9IHJlc3VsdCAvIF9uZXdQcmljZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRocmVlIGRheXMgYmVmb3JlIHRoZSBzYWxlIHRvIHNldCB0aGUgdG9rZW4gYW5kIHByaWNlCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9leGNoYW5nZVJhdGUgIEVUSCBleGNoYW5nZSByYXRlIGV4cHJlc3NlZCBpbiBjZW50cy9FVEgKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSBleGNoYW5nZSByYXRlIGhhcyBiZWVuIHNldAogIGZ1bmN0aW9uIHNldFRva2VuRXhjaGFuZ2VSYXRlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9leGNoYW5nZVJhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICByZXF1aXJlKChub3cgPiAoc2VsZi5zdGFydFRpbWUgLSAzIGRheXMpKSAmJiAobm93IDwgKHNlbGYuc3RhcnRUaW1lKSkpOwogICAgcmVxdWlyZSghc2VsZi5yYXRlU2V0KTsgICAvLyB0aGUgZXhjaGFuZ2UgcmF0ZSBjYW4gb25seSBiZSBzZXQgb25jZSEKICAgIHJlcXVpcmUoc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcykgPiAwKTsKICAgIHJlcXVpcmUoX2V4Y2hhbmdlUmF0ZSA+IDApOwoKICAgIHVpbnQyNTYgX2NhcEFtb3VudEluQ2VudHM7CiAgICBib29sIGVycjsKCiAgICAoZXJyLCBfY2FwQW1vdW50SW5DZW50cykgPSBzZWxmLmV4Y2hhbmdlUmF0ZS50aW1lcyhzZWxmLmNhcEFtb3VudCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2V4Y2hhbmdlUmF0ZTsKICAgIHNlbGYuY2FwQW1vdW50ID0gKF9jYXBBbW91bnRJbkNlbnRzL19leGNoYW5nZVJhdGUpICsgMTsKICAgIGNoYW5nZVRva2VuUHJpY2Uoc2VsZixzZWxmLnNhbGVEYXRhW3NlbGYubWlsZXN0b25lVGltZXNbMF1dWzBdKTsKICAgIHNlbGYucmF0ZVNldCA9IHRydWU7CgogICAgZXJyID0gIShzZXRUb2tlbnMoc2VsZikpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBMb2dOb3RpY2VNc2cobXNnLnNlbmRlcixzZWxmLnRva2Vuc1BlckV0aCwiT3duZXIgaGFzIHNldCB0aGUgZXhjaGFuZ2UgUmF0ZSBhbmQgdG9rZW5zIGJvdWdodCBwZXIgRVRIISIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBmYWxsYmFjayBmdW5jdGlvbiB0byBzZXQgdG9rZW5zIGlmIHRoZSBleGNoYW5nZSByYXRlIGZ1bmN0aW9uIHdhcyBub3QgY2FsbGVkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRva2VucyBzZXQgc3VjY2Vzc2Z1bGx5CiAgZnVuY3Rpb24gc2V0VG9rZW5zKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKSB8fCAobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKSk7CiAgICByZXF1aXJlKCFzZWxmLnRva2Vuc1NldCk7CgogICAgdWludDI1NiBfdG9rZW5CYWxhbmNlOwoKICAgIF90b2tlbkJhbGFuY2UgPSBzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi5zdGFydGluZ1Rva2VuQmFsYW5jZSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnRva2Vuc1NldCA9IHRydWU7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBHZXRzIHRoZSBwcmljZSBhbmQgYnV5IGNhcCBmb3IgaW5kaXZpZHVhbCBhZGRyZXNzZXMgYXQgdGhlIGdpdmVuIG1pbGVzdG9uZSBpbmRleAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSB0aW1lc3RhbXAgVGltZSBkdXJpbmcgc2FsZSBmb3Igd2hpY2ggZGF0YSBpcyByZXF1ZXN0ZWQKICAvLy8gQHJldHVybiBBIDMtZWxlbWVudCBhcnJheSB3aXRoIDAgdGhlIHRpbWVzdGFtcCwgMSB0aGUgcHJpY2UgaW4gY2VudHMsIDIgdGhlIGFkZHJlc3MgY2FwCiAgZnVuY3Rpb24gZ2V0U2FsZURhdGEoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdGltZXN0YW1wKQogICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgIHZpZXcKICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zICh1aW50MjU2WzNdKQogIHsKICAgIHVpbnQyNTZbM10gbWVtb3J5IF90aGlzRGF0YTsKICAgIHVpbnQyNTYgaW5kZXg7CgogICAgd2hpbGUoKGluZGV4IDwgc2VsZi5taWxlc3RvbmVUaW1lcy5sZW5ndGgpICYmIChzZWxmLm1pbGVzdG9uZVRpbWVzW2luZGV4XSA8IHRpbWVzdGFtcCkpIHsKICAgICAgaW5kZXgrKzsKICAgIH0KICAgIGlmKGluZGV4ID09IDApCiAgICAgIGluZGV4Kys7CgogICAgX3RoaXNEYXRhWzBdID0gc2VsZi5taWxlc3RvbmVUaW1lc1tpbmRleCAtIDFdOwogICAgX3RoaXNEYXRhWzFdID0gc2VsZi5zYWxlRGF0YVtfdGhpc0RhdGFbMF1dWzBdOwogICAgX3RoaXNEYXRhWzJdID0gc2VsZi5zYWxlRGF0YVtfdGhpc0RhdGFbMF1dWzFdOwogICAgcmV0dXJuIF90aGlzRGF0YTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIG51bWJlciBvZiB0b2tlbnMgc29sZCB0aHVzIGZhcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIHRva2VucyBzb2xkCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW3NlbGYub3duZXJdOwogIH0KfQoKbGlicmFyeSBUb2tlbkxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgVG9rZW5TdG9yYWdlIHsKICAgIGJvb2wgaW5pdGlhbGl6ZWQ7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIHN0cmluZyBuYW1lOwogICAgc3RyaW5nIHN5bWJvbDsKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CiAgICB1aW50MjU2IGluaXRpYWxTdXBwbHk7CiAgICBhZGRyZXNzIG93bmVyOwogICAgdWludDggZGVjaW1hbHM7CiAgICBib29sIHN0aWxsTWludGluZzsKICB9CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IE93bmVyQ2hhbmdlKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0byk7CiAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBNaW50aW5nQ2xvc2VkKGJvb2wgbWludGluZ0Nsb3NlZCk7CgogIC8vLyBAZGV2IENhbGxlZCBieSB0aGUgU3RhbmRhcmQgVG9rZW4gdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9uYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogIC8vLyBAcGFyYW0gX3N5bWJvbCBTeW1ib2wgb2YgdGhlIG5ldyB0b2tlbgogIC8vLyBAcGFyYW0gX2RlY2ltYWxzIERlY2ltYWwgcGxhY2VzIGZvciB0aGUgdG9rZW4gcmVwcmVzZW50ZWQKICAvLy8gQHBhcmFtIF9pbml0aWFsX3N1cHBseSBUaGUgaW5pdGlhbCB0b2tlbiBzdXBwbHkKICAvLy8gQHBhcmFtIF9hbGxvd01pbnRpbmcgVHJ1ZSBpZiBhZGRpdGlvbmFsIHRva2VucyBjYW4gYmUgY3JlYXRlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgZnVuY3Rpb24gaW5pdChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICAgICAgICAgIHVpbnQ4IF9kZWNpbWFscywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2luaXRpYWxfc3VwcGx5LAogICAgICAgICAgICAgICAgYm9vbCBfYWxsb3dNaW50aW5nKQogICAgICAgICAgICAgICAgcHVibGljCiAgewogICAgcmVxdWlyZSghc2VsZi5pbml0aWFsaXplZCk7CiAgICBzZWxmLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgIHNlbGYubmFtZSA9IF9uYW1lOwogICAgc2VsZi5zeW1ib2wgPSBfc3ltYm9sOwogICAgc2VsZi50b3RhbFN1cHBseSA9IF9pbml0aWFsX3N1cHBseTsKICAgIHNlbGYuaW5pdGlhbFN1cHBseSA9IF9pbml0aWFsX3N1cHBseTsKICAgIHNlbGYuZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5zdGlsbE1pbnRpbmcgPSBfYWxsb3dNaW50aW5nOwogICAgc2VsZi5iYWxhbmNlc1tfb3duZXJdID0gX2luaXRpYWxfc3VwcGx5OwogIH0KCiAgLy8vIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gY2FsbGVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXIoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgYmFsYW5jZTsKCiAgICAoZXJyLGJhbGFuY2UpID0gc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKICAgIHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlOwogICAgLy9JdCdzIG5vdCBwb3NzaWJsZSB0byBvdmVyZmxvdyB0b2tlbiBzdXBwbHkKICAgIHNlbGYuYmFsYW5jZXNbX3RvXSA9IHNlbGYuYmFsYW5jZXNbX3RvXSArIF92YWx1ZTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplZCBjYWxsZXIgdHJhbnNmZXJzIHRva2VucyBmcm9tIG9uZSBhY2NvdW50IHRvIGFub3RoZXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgZnJvbQogIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHZhciBfYWxsb3dhbmNlID0gc2VsZi5hbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlT3duZXI7CiAgICB1aW50MjU2IGJhbGFuY2VTcGVuZGVyOwoKICAgIChlcnIsYmFsYW5jZU93bmVyKSA9IHNlbGYuYmFsYW5jZXNbX2Zyb21dLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIChlcnIsYmFsYW5jZVNwZW5kZXIpID0gX2FsbG93YW5jZS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VPd25lcjsKICAgIHNlbGYuYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBiYWxhbmNlU3BlbmRlcjsKICAgIHNlbGYuYmFsYW5jZXNbX3RvXSA9IHNlbGYuYmFsYW5jZXNbX3RvXSArIF92YWx1ZTsKCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZXRyaWV2ZSB0b2tlbiBiYWxhbmNlIGZvciBhbiBhY2NvdW50CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyB0byByZXRyaWV2ZSBiYWxhbmNlIG9mCiAgLy8vIEByZXR1cm4gYmFsYW5jZSBUaGUgbnVtYmVyIG9mIHRva2VucyBpbiB0aGUgc3ViamVjdCBhY2NvdW50CiAgZnVuY3Rpb24gYmFsYW5jZU9mKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBzZWxmLmJhbGFuY2VzW19vd25lcl07CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemUgYW4gYWNjb3VudCB0byBzZW5kIHRva2VucyBvbiBjYWxsZXIncyBiZWhhbGYKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3MgdG8gYXV0aG9yaXplCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyBhdXRob3JpemVkIGFjY291bnQgbWF5IHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmUoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAvLyBtdXN0IHNldCB0byB6ZXJvIGJlZm9yZSBjaGFuZ2luZyBhcHByb3ZhbCBhbW91bnQgaW4gYWNjb3JkYW5jZSB3aXRoIHNwZWMKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZW1haW5pbmcgdG9rZW5zIHRoaXJkIHBhcnR5IHNwZW5kZXIgaGFzIHRvIHNlbmQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIGhvbGRlcgogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiBhdXRob3JpemVkIHNwZW5kZXIKICAvLy8gQHJldHVybiByZW1haW5pbmcgTnVtYmVyIG9mIHRva2VucyBzcGVuZGVyIGhhcyBsZWZ0IGluIG93bmVyJ3MgYWNjb3VudAogIGZ1bmN0aW9uIGFsbG93YW5jZShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgIHZpZXcKICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBzZWxmLmFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemUgdGhpcmQgcGFydHkgdHJhbnNmZXIgYnkgaW5jcmVhc2luZy9kZWNyZWFzaW5nIGFsbG93ZWQgcmF0aGVyIHRoYW4gc2V0dGluZyBpdAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhdXRob3JpemUKICAvLy8gQHBhcmFtIF92YWx1ZUNoYW5nZSBJbmNyZWFzZSBvciBkZWNyZWFzZSBpbiBudW1iZXIgb2YgdG9rZW5zIGF1dGhvcml6ZWQgYWNjb3VudCBtYXkgc2VuZAogIC8vLyBAcGFyYW0gX2luY3JlYXNlIFRydWUgaWYgaW5jcmVhc2luZyBhbGxvd2FuY2UsIGZhbHNlIGlmIGRlY3JlYXNpbmcgYWxsb3dhbmNlCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBhcHByb3ZlQ2hhbmdlIChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZUNoYW5nZSwgYm9vbCBfaW5jcmVhc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wpCiAgewogICAgdWludDI1NiBfbmV3QWxsb3dlZDsKICAgIGJvb2wgZXJyOwoKICAgIGlmKF9pbmNyZWFzZSkgewogICAgICAoZXJyLCBfbmV3QWxsb3dlZCkgPSBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLnBsdXMoX3ZhbHVlQ2hhbmdlKTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfbmV3QWxsb3dlZDsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChfdmFsdWVDaGFuZ2UgPiBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKSB7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX25ld0FsbG93ZWQgPSBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdIC0gX3ZhbHVlQ2hhbmdlOwogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfbmV3QWxsb3dlZDsKICAgICAgfQogICAgfQoKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfbmV3QWxsb3dlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IENoYW5nZSBvd25pbmcgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QsIHNwZWNpZmljYWxseSBmb3IgbWludGluZwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX25ld093bmVyIEFkZHJlc3MgZm9yIHRoZSBuZXcgb3duZXIKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKSAmJiAoX25ld093bmVyID4gMCkpOwoKICAgIHNlbGYub3duZXIgPSBfbmV3T3duZXI7CiAgICBPd25lckNoYW5nZShtc2cuc2VuZGVyLCBfbmV3T3duZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBNaW50cyBhZGRpdGlvbmFsIHRva2VucywgbmV3IHRva2VucyBnbyB0byBvd25lcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIG1pbnQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIG1pbnRUb2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpICYmIHNlbGYuc3RpbGxNaW50aW5nKTsKICAgIHVpbnQyNTYgX25ld0Ftb3VudDsKICAgIGJvb2wgZXJyOwoKICAgIChlcnIsIF9uZXdBbW91bnQpID0gc2VsZi50b3RhbFN1cHBseS5wbHVzKF9hbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLnRvdGFsU3VwcGx5ID0gIF9uZXdBbW91bnQ7CiAgICBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdID0gc2VsZi5iYWxhbmNlc1tzZWxmLm93bmVyXSArIF9hbW91bnQ7CiAgICBUcmFuc2ZlcigweDAsIHNlbGYub3duZXIsIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBQZXJtYW5lbnQgc3RvcHMgbWludGluZwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gY2xvc2VNaW50KFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcik7CgogICAgc2VsZi5zdGlsbE1pbnRpbmcgPSBmYWxzZTsKICAgIE1pbnRpbmdDbG9zZWQodHJ1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudGx5IGJ1cm4gdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IEFtb3VudCBvZiB0b2tlbnMgdG8gYnVybgogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYnVyblRva2VuKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgdWludDI1NiBfbmV3QmFsYW5jZTsKICAgICAgYm9vbCBlcnI7CgogICAgICAoZXJyLCBfbmV3QmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF9hbW91bnQpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9uZXdCYWxhbmNlOwogICAgICBzZWxmLnRvdGFsU3VwcGx5ID0gc2VsZi50b3RhbFN1cHBseSAtIF9hbW91bnQ7CiAgICAgIEJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX2Ftb3VudCk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKbGlicmFyeSBCYXNpY01hdGhMaWIgewogIC8vLyBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBwcm9kdWN0IG9mIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICBmdW5jdGlvbiB0aW1lcyh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gbXVsKGEsYikKICAgICAgc3dpdGNoIG9yKGlzemVybyhiKSwgZXEoZGl2KHJlcyxiKSwgYSkpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBEaXZpZGVzIHR3byBudW1iZXJzIGJ1dCBjaGVja3MgZm9yIDAgaW4gdGhlIGRpdmlzb3IgZmlyc3QuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiBgYmAgaXMgMAogIC8vLyBAcmV0dXJuIHJlcyBUaGUgcXVvdGllbnQgb2YgYSBhbmQgYiwgb3IgMCBpZiBgYmAgaXMgMAogIGZ1bmN0aW9uIGRpdmlkZWRCeSh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiBpKSB7CiAgICB1aW50MjU2IHJlczsKICAgIGFzc2VtYmx5ewogICAgICBzd2l0Y2ggaXN6ZXJvKGIpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgcmVzIDo9IGRpdihhLGIpCiAgICAgICAgbGV0IGxvYyA6PSBtbG9hZCgweDQwKQogICAgICAgIG1zdG9yZShhZGQobG9jLDB4MjApLHJlcykKICAgICAgICBpIDo9IG1sb2FkKGFkZChsb2MsMHgyMCkpCiAgICAgIH0KICAgICAgZGVmYXVsdCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICBpIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgQWRkcyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciBvdmVyZmxvdyBiZWZvcmUgcmV0dXJuaW5nLgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHN1bSBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gcGx1cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsIHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IGFkZChhLGIpCiAgICAgIHN3aXRjaCBhbmQoZXEoc3ViKHJlcyxiKSwgYSksIG9yKGd0KHJlcyxiKSxlcShyZXMsYikpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgU3VidHJhY3RzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIHVuZGVyZmxvdyBiZWZvcmUgcmV0dXJuaW5nLgogIC8vLyBEb2VzIG5vdCB0aHJvdyBidXQgcmF0aGVyIGxvZ3MgYW4gRXJyIGV2ZW50IGlmIHRoZXJlIGlzIHVuZGVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBkaWZmZXJlbmNlIGJldHdlZW4gYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cKICBmdW5jdGlvbiBtaW51cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gc3ViKGEsYikKICAgICAgc3dpdGNoIGVxKGFuZChlcShhZGQocmVzLGIpLCBhKSwgb3IobHQocmVzLGEpLCBlcShyZXMsYSkpKSwgMSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIHsKICB1c2luZyBUb2tlbkxpYiBmb3IgVG9rZW5MaWIuVG9rZW5TdG9yYWdlOwoKICBUb2tlbkxpYi5Ub2tlblN0b3JhZ2UgcHVibGljIHRva2VuOwoKICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihhZGRyZXNzIG93bmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDggZGVjaW1hbHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBpbml0aWFsU3VwcGx5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgYWxsb3dNaW50aW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogIHsKICAgIHRva2VuLmluaXQob3duZXIsIG5hbWUsIHN5bWJvbCwgZGVjaW1hbHMsIGluaXRpYWxTdXBwbHksIGFsbG93TWludGluZyk7CiAgfQoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4ubmFtZTsKICB9CgogIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIHRva2VuLnN5bWJvbDsKICB9CgogIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgIHJldHVybiB0b2tlbi5kZWNpbWFsczsKICB9CgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLnRvdGFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5pbml0aWFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHdobyk7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYWxsb3dhbmNlKG93bmVyLCBzcGVuZGVyKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlQ2hhbmdlLCBib29sIGluY3JlYXNlKQogICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiB0b2tlbi5hcHByb3ZlQ2hhbmdlKHNwZW5kZXIsIHZhbHVlQ2hhbmdlLCBpbmNyZWFzZSk7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmNoYW5nZU93bmVyKG5ld093bmVyKTsKICB9CgogIGZ1bmN0aW9uIGJ1cm5Ub2tlbih1aW50MjU2IGFtb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5idXJuVG9rZW4oYW1vdW50KTsKICB9Cn0='.
	

]
