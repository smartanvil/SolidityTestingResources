Class {
	#name : #SRTdc87b2948b51fefa9ff1bf7aa2e56852fee94ffe,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdc87b2948b51fefa9ff1bf7aa2e56852fee94ffe >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyA8T1JBQ0xJWkVfQVBJPgovKgpDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNiBPcmFjbGl6ZSBTUkwKQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURAoKCgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgoKClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwgVEhFCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgpUSEUgU09GVFdBUkUuCiovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4wOy8vcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIHdoZW4gc29saWRpdHkgPCAwLjQuMAoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKQogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKCiAgICAgICAgaWYoYWRkcmVzcyhvcmFjbGl6ZSkgIT0gT0FSLmdldEFkZHJlc3MoKSkKICAgICAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CgogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpewogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfbWFpbm5ldCIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk+MCl7IC8vcm9wc3RlbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JvcHN0ZW4zIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX2tvdmFuIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KT4wKXsgLy9yaW5rZWJ5IHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcmlua2VieSIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik+MCl7IC8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV91c2VDb3Vwb24oc3RyaW5nIGNvZGUpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRQcm9vZlR5cGUocHJvb2ZQKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VBZGRyKHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsKICAgICAgICB1aW50MTYwIGIxOwogICAgICAgIHVpbnQxNjAgYjI7CiAgICAgICAgZm9yICh1aW50IGk9MjsgaTwyKzIqMjA7IGkrPTIpewogICAgICAgICAgICBpYWRkciAqPSAyNTY7CiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOwogICAgICAgICAgICBiMiA9IHVpbnQxNjAodG1wW2krMV0pOwogICAgICAgICAgICBpZiAoKGIxID49IDk3KSYmKGIxIDw9IDEwMikpIGIxIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNjUpJiYoYjEgPD0gNzApKSBiMSAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7CiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA2NSkmJihiMiA8PSA3MCkpIGIyIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsKICAgICAgICAgICAgaWFkZHIgKz0gKGIxKjE2K2IyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGggPSBieXRlcyhfaGF5c3RhY2spOwogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7CiAgICAgICAgaWYoaC5sZW5ndGggPCAxIHx8IG4ubGVuZ3RoIDwgMSB8fCAobi5sZW5ndGggPiBoLmxlbmd0aCkpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmKGgubGVuZ3RoID4gKDIqKjEyOCAtMSkpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaC5sZW5ndGg7IGkgKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZihzdWJpbmRleCA9PSBuLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JiID0gYnl0ZXMoX2IpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JlID0gYnl0ZXMoX2UpOwogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsKICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOwogICAgICAgIHVpbnQgayA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JjLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iY1tpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsKICAgICAgICByZXR1cm4gc3RyaW5nKGJhYmNkZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsICIiLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmICgoYnJlc3VsdFtpXSA+PSA0OCkmJihicmVzdWx0W2ldIDw9IDU3KSl7CiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpewogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAqKl9iOwogICAgICAgIHJldHVybiBtaW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOwogICAgICAgIHVpbnQgaiA9IGk7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgd2hpbGUgKGogIT0gMCl7CiAgICAgICAgICAgIGxlbisrOwogICAgICAgICAgICBqIC89IDEwOwogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOwogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7CiAgICAgICAgd2hpbGUgKGkgIT0gMCl7CiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOwogICAgICAgICAgICBpIC89IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmEyY2JvcihzdHJpbmdbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgZnVuY3Rpb24gYmEyY2JvcihieXRlc1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCgogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSh1aW50IF9kZWxheSwgdWludCBfbmJ5dGVzLCB1aW50IF9jdXN0b21HYXNMaW1pdCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgaWYgKChfbmJ5dGVzID09IDApfHwoX25ieXRlcyA+IDMyKSkgdGhyb3c7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG5ieXRlcyA9IG5ldyBieXRlcygxKTsKICAgICAgICBuYnl0ZXNbMF0gPSBieXRlKF9uYnl0ZXMpOwogICAgICAgIGJ5dGVzIG1lbW9yeSB1bm9uY2UgPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uS2V5SGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uS2V5SGFzaF9ieXRlczMyID0gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZSh1bm9uY2UsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQodW5vbmNlLCAweDIwKSwgeG9yKGJsb2NraGFzaChzdWIobnVtYmVyLCAxKSksIHhvcihjb2luYmFzZSwgdGltZXN0YW1wKSkpCiAgICAgICAgICAgIG1zdG9yZShzZXNzaW9uS2V5SGFzaCwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzZXNzaW9uS2V5SGFzaCwgMHgyMCksIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIpCiAgICAgICAgfQogICAgICAgIGJ5dGVzWzNdIG1lbW9yeSBhcmdzID0gW3Vub25jZSwgbmJ5dGVzLCBzZXNzaW9uS2V5SGFzaF07CiAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfcXVlcnkoX2RlbGF5LCAicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIHNoYTMoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID0gY29tbWl0bWVudDsKICAgIH0KCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJ5dGVzMzIpIG9yYWNsaXplX3JhbmRvbURTX2FyZ3M7CiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJvb2wpIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkOwoKICAgIGZ1bmN0aW9uIHZlcmlmeVNpZyhieXRlczMyIHRvc2lnbmgsIGJ5dGVzIGRlcnNpZywgYnl0ZXMgcHVia2V5KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIHNpZ29rOwogICAgICAgIGFkZHJlc3Mgc2lnbmVyOwoKICAgICAgICBieXRlczMyIHNpZ3I7CiAgICAgICAgYnl0ZXMzMiBzaWdzOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lncl8gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCsodWludChkZXJzaWdbM10pIC0gMHgyMCk7CiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3NfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOwogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0Kyh1aW50KGRlcnNpZ1tvZmZzZXQtMV0pIC0gMHgyMCksIDMyLCBzaWdzXywgMCk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CgoKICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjcsIHNpZ3IsIHNpZ3MpOwogICAgICAgIGlmIChhZGRyZXNzKHNoYTMocHVia2V5KSkgPT0gc2lnbmVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI4LCBzaWdyLCBzaWdzKTsKICAgICAgICAgICAgcmV0dXJuIChhZGRyZXNzKHNoYTMocHVia2V5KSkgPT0gc2lnbmVyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShieXRlcyBwcm9vZiwgdWludCBzaWcyb2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCBzaWdvazsKCiAgICAgICAgLy8gU3RlcCA2OiB2ZXJpZnkgdGhlIGF0dGVzdGF0aW9uIHNpZ25hdHVyZSwgQVBQS0VZMSBtdXN0IHNpZ24gdGhlIHNlc3Npb25LZXkgZnJvbSB0aGUgY29ycmVjdCBsZWRnZXIgYXBwIChDT0RFSEFTSCkKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMiA9IG5ldyBieXRlcyh1aW50KHByb29mW3NpZzJvZmZzZXQrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCwgc2lnMi5sZW5ndGgsIHNpZzIsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgYXBwa2V5MV9wdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMysxLCA2NCwgYXBwa2V5MV9wdWJrZXksIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMiA9IG5ldyBieXRlcygxKzY1KzMyKTsKICAgICAgICB0b3NpZ24yWzBdID0gMTsgLy9yb2xlCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LTY1LCA2NSwgdG9zaWduMiwgMSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IENPREVIQVNIID0gaGV4ImZkOTRmYTcxYmMwYmExMGQzOWQ0NjRkMGQ4ZjQ2NWVmZWVmMGEyNzY0ZTM4ODdmY2M5ZGY0MWRlZDIwZjUwNWMiOwogICAgICAgIGNvcHlCeXRlcyhDT0RFSEFTSCwgMCwgMzIsIHRvc2lnbjIsIDErNjUpOwogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24yKSwgc2lnMiwgYXBwa2V5MV9wdWJrZXkpOwoKICAgICAgICBpZiAoc2lnb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNzogdmVyaWZ5IHRoZSBBUFBLRVkxIHByb3ZlbmFuY2UgKG11c3QgYmUgc2lnbmVkIGJ5IExlZGdlcikKICAgICAgICBieXRlcyBtZW1vcnkgTEVER0VSS0VZID0gaGV4IjdmYjk1NjQ2OWM1YzliODk4NDBkNTViNDM1MzdlNjZhOThkZDQ4MTFlYTBhMjcyMjQyNzJjMmU1NjIyOTExZTg1MzdhMmY4ZTg2YTQ2YmFlYzgyODY0ZTk4ZGQwMWU5Y2NjMmY4YmM1ZGZjOWNiZTVhOTFhMjkwNDk4ZGQ5NmU0IjsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjMgPSBuZXcgYnl0ZXMoMSs2NSk7CiAgICAgICAgdG9zaWduM1swXSA9IDB4RkU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzLCA2NSwgdG9zaWduMywgMSk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWczID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbMys2NSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzY1LCBzaWczLmxlbmd0aCwgc2lnMywgMCk7CgogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24zKSwgc2lnMywgTEVER0VSS0VZKTsKCiAgICAgICAgcmV0dXJuIHNpZ29rOwogICAgfQoKICAgIG1vZGlmaWVyIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5KGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIHsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIGlmICgoX3Byb29mWzBdICE9ICJMIil8fChfcHJvb2ZbMV0gIT0gIlAiKXx8KF9wcm9vZlsyXSAhPSAxKSkgdGhyb3c7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgdGhyb3c7CgogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3JldHVybkNvZGUoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgaW50ZXJuYWwgcmV0dXJucyAodWludDgpewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSByZXR1cm4gMTsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSByZXR1cm4gMjsKCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hCeXRlczMyUHJlZml4KGJ5dGVzMzIgY29udGVudCwgYnl0ZXMgcHJlZml4LCB1aW50IG5fcmFuZG9tX2J5dGVzKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGk9MDsgaTwgbl9yYW5kb21fYnl0ZXM7IGkrKykgewogICAgICAgICAgICBpZiAoY29udGVudFtpXSAhPSBwcmVmaXhbaV0pIG1hdGNoXyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1hdGNoXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihieXRlcyBwcm9vZiwgYnl0ZXMzMiBxdWVyeUlkLCBieXRlcyByZXN1bHQsIHN0cmluZyBjb250ZXh0X25hbWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpewoKICAgICAgICAvLyBTdGVwIDI6IHRoZSB1bmlxdWUga2V5aGFzaCBoYXMgdG8gbWF0Y2ggd2l0aCB0aGUgc2hhMjU2IG9mIChjb250ZXh0IG5hbWUgKyBxdWVyeUlkKQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzKzY1Kyh1aW50KHByb29mWzMrNjUrMV0pKzIpKzMyOwogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiwga2V5aGFzaCwgMCk7CiAgICAgICAgaWYgKCEoc2hhMyhrZXloYXNoKSA9PSBzaGEzKHNoYTI1Nihjb250ZXh0X25hbWUsIHF1ZXJ5SWQpKSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzEgPSBuZXcgYnl0ZXModWludChwcm9vZltsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSwgc2lnMS5sZW5ndGgsIHNpZzEsIDApOwoKICAgICAgICAvLyBTdGVwIDM6IHdlIGFzc3VtZSBzaWcxIGlzIHZhbGlkIChpdCB3aWxsIGJlIHZlcmlmaWVkIGR1cmluZyBzdGVwIDUpIGFuZCB3ZSB2ZXJpZnkgaWYgJ3Jlc3VsdCcgaXMgdGhlIHByZWZpeCBvZiBzaGEyNTYoc2lnMSkKICAgICAgICBpZiAoIW1hdGNoQnl0ZXMzMlByZWZpeChzaGEyNTYoc2lnMSksIHJlc3VsdCwgdWludChwcm9vZltsZWRnZXJQcm9vZkxlbmd0aCszMis4XSkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIFN0ZXAgNDogY29tbWl0bWVudCBtYXRjaCB2ZXJpZmljYXRpb24sIHNoYTMoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLgogICAgICAgIC8vIFRoaXMgaXMgdG8gdmVyaWZ5IHRoYXQgdGhlIGNvbXB1dGVkIGFyZ3MgbWF0Y2ggd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQgaW4gdGhlIHF1ZXJ5LgogICAgICAgIGJ5dGVzIG1lbW9yeSBjb21taXRtZW50U2xpY2UxID0gbmV3IGJ5dGVzKDgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCszMiwgOCsxKzMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwoKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IHNoYTMoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBpZiAoIXZlcmlmeVNpZyhzaGEyNTYodG9zaWduMSksIHNpZzEsIHNlc3Npb25QdWJrZXkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHZlcmlmeSBpZiBzZXNzaW9uUHVia2V5SGFzaCB3YXMgdmVyaWZpZWQgYWxyZWFkeSwgaWYgbm90Li4gbGV0J3MgZG8gaXQhCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9PSBmYWxzZSl7CiAgICAgICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkocHJvb2YsIHNpZzJvZmZzZXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGNvcHlCeXRlcyhieXRlcyBmcm9tLCB1aW50IGZyb21PZmZzZXQsIHVpbnQgbGVuZ3RoLCBieXRlcyB0bywgdWludCB0b09mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGxlbmd0aCArIHRvT2Zmc2V0OwoKICAgICAgICBpZiAodG8ubGVuZ3RoIDwgbWluTGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIEJ1ZmZlciB0b28gc21hbGwKICAgICAgICAgICAgdGhyb3c7IC8vIFNob3VsZCBiZSBhIGJldHRlciB3YXk/CiAgICAgICAgfQoKICAgICAgICAvLyBOT1RFOiB0aGUgb2Zmc2V0IDMyIGlzIGFkZGVkIHRvIHNraXAgdGhlIGBzaXplYCBmaWVsZCBvZiBib3RoIGJ5dGVzIHZhcmlhYmxlcwogICAgICAgIHVpbnQgaSA9IDMyICsgZnJvbU9mZnNldDsKICAgICAgICB1aW50IGogPSAzMiArIHRvT2Zmc2V0OwoKICAgICAgICB3aGlsZSAoaSA8ICgzMiArIGZyb21PZmZzZXQgKyBsZW5ndGgpKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCB0bXAgOj0gbWxvYWQoYWRkKGZyb20sIGkpKQogICAgICAgICAgICAgICAgbXN0b3JlKGFkZCh0bywgaiksIHRtcCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpICs9IDMyOwogICAgICAgICAgICBqICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICAvLyBEdXBsaWNhdGUgU29saWRpdHkncyBlY3JlY292ZXIsIGJ1dCBjYXRjaGluZyB0aGUgQ0FMTCByZXR1cm4gdmFsdWUKICAgIGZ1bmN0aW9uIHNhZmVyX2VjcmVjb3ZlcihieXRlczMyIGhhc2gsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgLy8gV2UgZG8gb3VyIG93biBtZW1vcnkgbWFuYWdlbWVudCBoZXJlLiBTb2xpZGl0eSB1c2VzIG1lbW9yeSBvZmZzZXQKICAgICAgICAvLyAweDQwIHRvIHN0b3JlIHRoZSBjdXJyZW50IGVuZCBvZiBtZW1vcnkuIFdlIHdyaXRlIHBhc3QgaXQgKGFzCiAgICAgICAgLy8gd3JpdGVzIGFyZSBtZW1vcnkgZXh0ZW5zaW9ucyksIGJ1dCBkb24ndCB1cGRhdGUgdGhlIG9mZnNldCBzbwogICAgICAgIC8vIFNvbGlkaXR5IHdpbGwgcmV1c2UgaXQuIFRoZSBtZW1vcnkgdXNlZCBoZXJlIGlzIG9ubHkgbmVlZGVkIGZvcgogICAgICAgIC8vIHRoaXMgY29udGV4dC4KCiAgICAgICAgLy8gRklYTUU6IGlubGluZSBhc3NlbWJseSBjYW4ndCBhY2Nlc3MgcmV0dXJuIHZhbHVlcwogICAgICAgIGJvb2wgcmV0OwogICAgICAgIGFkZHJlc3MgYWRkcjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc2l6ZSA6PSBtbG9hZCgweDQwKQogICAgICAgICAgICBtc3RvcmUoc2l6ZSwgaGFzaCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCAzMiksIHYpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgNjQpLCByKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDk2KSwgcykKCiAgICAgICAgICAgIC8vIE5PVEU6IHdlIGNhbiByZXVzZSB0aGUgcmVxdWVzdCBtZW1vcnkgYmVjYXVzZSB3ZSBkZWFsIHdpdGgKICAgICAgICAgICAgLy8gICAgICAgdGhlIHJldHVybiBjb2RlCiAgICAgICAgICAgIHJldCA6PSBjYWxsKDMwMDAsIDEsIDAsIHNpemUsIDEyOCwgc2l6ZSwgMzIpCiAgICAgICAgICAgIGFkZHIgOj0gbWxvYWQoc2l6ZSkKICAgICAgICB9CgogICAgICAgIHJldHVybiAocmV0LCBhZGRyKTsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gZWNyZWNvdmVyeShieXRlczMyIGhhc2gsIGJ5dGVzIHNpZykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIGJ5dGVzMzIgcjsKICAgICAgICBieXRlczMyIHM7CiAgICAgICAgdWludDggdjsKCiAgICAgICAgaWYgKHNpZy5sZW5ndGggIT0gNjUpCiAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgLy8gVGhlIHNpZ25hdHVyZSBmb3JtYXQgaXMgYSBjb21wYWN0IGZvcm0gb2Y6CiAgICAgICAgLy8gICB7Ynl0ZXMzMiByfXtieXRlczMyIHN9e3VpbnQ4IHZ9CiAgICAgICAgLy8gQ29tcGFjdCBtZWFucywgdWludDggaXMgbm90IHBhZGRlZCB0byAzMiBieXRlcy4KICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHIgOj0gbWxvYWQoYWRkKHNpZywgMzIpKQogICAgICAgICAgICBzIDo9IG1sb2FkKGFkZChzaWcsIDY0KSkKCiAgICAgICAgICAgIC8vIEhlcmUgd2UgYXJlIGxvYWRpbmcgdGhlIGxhc3QgMzIgYnl0ZXMuIFdlIGV4cGxvaXQgdGhlIGZhY3QgdGhhdAogICAgICAgICAgICAvLyAnbWxvYWQnIHdpbGwgcGFkIHdpdGggemVyb2VzIGlmIHdlIG92ZXJyZWFkLgogICAgICAgICAgICAvLyBUaGVyZSBpcyBubyAnbWxvYWQ4JyB0byBkbyB0aGlzLCBidXQgdGhhdCB3b3VsZCBiZSBuaWNlci4KICAgICAgICAgICAgdiA6PSBieXRlKDAsIG1sb2FkKGFkZChzaWcsIDk2KSkpCgogICAgICAgICAgICAvLyBBbHRlcm5hdGl2ZSBzb2x1dGlvbjoKICAgICAgICAgICAgLy8gJ2J5dGUnIGlzIG5vdCB3b3JraW5nIGR1ZSB0byB0aGUgU29saWRpdHkgcGFyc2VyLCBzbyBsZXRzCiAgICAgICAgICAgIC8vIHVzZSB0aGUgc2Vjb25kIGJlc3Qgb3B0aW9uLCAnYW5kJwogICAgICAgICAgICAvLyB2IDo9IGFuZChtbG9hZChhZGQoc2lnLCA2NSkpLCAyNTUpCiAgICAgICAgfQoKICAgICAgICAvLyBhbGJlaXQgbm9uLXRyYW5zYWN0aW9uYWwgc2lnbmF0dXJlcyBhcmUgbm90IHNwZWNpZmllZCBieSB0aGUgWVAsIG9uZSB3b3VsZCBleHBlY3QgaXQKICAgICAgICAvLyB0byBtYXRjaCB0aGUgWVAgcmFuZ2Ugb2YgWzI3LCAyOF0KICAgICAgICAvLwogICAgICAgIC8vIGdldGggdXNlcyBbMCwgMV0gYW5kIHNvbWUgY2xpZW50cyBoYXZlIGZvbGxvd2VkLiBUaGlzIG1pZ2h0IGNoYW5nZSwgc2VlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vZ28tZXRoZXJldW0vaXNzdWVzLzIwNTMKICAgICAgICBpZiAodiA8IDI3KQogICAgICAgICAgdiArPSAyNzsKCiAgICAgICAgaWYgKHYgIT0gMjcgJiYgdiAhPSAyOCkKICAgICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIHJldHVybiBzYWZlcl9lY3JlY292ZXIoaGFzaCwgdiwgciwgcyk7CiAgICB9Cgp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKLy8vIG1hdGguc29sIC0tIG1peGluIGZvciBpbmxpbmUgbnVtZXJpY2FsIHdpemFyZHJ5CgovLyBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQovLyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQovLyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgovLyAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKLy8gVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi8vIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKLy8gR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCi8vIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBEU01hdGggewogICAgZnVuY3Rpb24gYWRkKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoKHogPSB4ICsgeSkgPj0geCk7CiAgICB9CiAgICBmdW5jdGlvbiBzdWIodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KICAgIGZ1bmN0aW9uIG11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKHkgPT0gMCB8fCAoeiA9IHggKiB5KSAvIHkgPT0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIG1heCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBpbWluKGludCB4LCBpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltYXgoaW50IHgsIGludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIHVpbnQgY29uc3RhbnQgV0FEID0gMTAgKiogMTg7CiAgICB1aW50IGNvbnN0YW50IFJBWSA9IDEwICoqIDI3OwoKICAgIGZ1bmN0aW9uIHdtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgeSksIFdBRCAvIDIpIC8gV0FEOwogICAgfQogICAgZnVuY3Rpb24gcm11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCB5KSwgUkFZIC8gMikgLyBSQVk7CiAgICB9CiAgICBmdW5jdGlvbiB3ZGl2KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIFdBRCksIHkgLyAyKSAvIHk7CiAgICB9CiAgICBmdW5jdGlvbiByZGl2KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIFJBWSksIHkgLyAyKSAvIHk7CiAgICB9CgogICAgLy8gVGhpcyBmYW1vdXMgYWxnb3JpdGhtIGlzIGNhbGxlZCAiZXhwb25lbnRpYXRpb24gYnkgc3F1YXJpbmciCiAgICAvLyBhbmQgY2FsY3VsYXRlcyB4Xm4gd2l0aCB4IGFzIGZpeGVkLXBvaW50IGFuZCBuIGFzIHJlZ3VsYXIgdW5zaWduZWQuCiAgICAvLwogICAgLy8gSXQncyBPKGxvZyBuKSwgaW5zdGVhZCBvZiBPKG4pIGZvciBuYWl2ZSByZXBlYXRlZCBtdWx0aXBsaWNhdGlvbi4KICAgIC8vCiAgICAvLyBUaGVzZSBmYWN0cyBhcmUgd2h5IGl0IHdvcmtzOgogICAgLy8KICAgIC8vICBJZiBuIGlzIGV2ZW4sIHRoZW4geF5uID0gKHheMileKG4vMikuCiAgICAvLyAgSWYgbiBpcyBvZGQsICB0aGVuIHhebiA9IHggKiB4XihuLTEpLAogICAgLy8gICBhbmQgYXBwbHlpbmcgdGhlIGVxdWF0aW9uIGZvciBldmVuIHggZ2l2ZXMKICAgIC8vICAgIHhebiA9IHggKiAoeF4yKV4oKG4tMSkgLyAyKS4KICAgIC8vCiAgICAvLyAgQWxzbywgRVZNIGRpdmlzaW9uIGlzIGZsb29yaW5nIGFuZAogICAgLy8gICAgZmxvb3JbKG4tMSkgLyAyXSA9IGZsb29yW24gLyAyXS4KICAgIC8vCiAgICBmdW5jdGlvbiBycG93KHVpbnQgeCwgdWludCBuKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBuICUgMiAhPSAwID8geCA6IFJBWTsKCiAgICAgICAgZm9yIChuIC89IDI7IG4gIT0gMDsgbiAvPSAyKSB7CiAgICAgICAgICAgIHggPSBybXVsKHgsIHgpOwoKICAgICAgICAgICAgaWYgKG4gJSAyICE9IDApIHsKICAgICAgICAgICAgICAgIHogPSBybXVsKHosIHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBMZWRnZXJQcm9vZlZlcmlmeUkgewogICAgZnVuY3Rpb24gZXh0ZXJuYWxfb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgcHVibGljOwogICAgZnVuY3Rpb24gZXh0ZXJuYWxfb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSAgcHVibGljIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9Cgp9Cgpjb250cmFjdCBvcmFjbGl6ZVNldHRpbmdzIGlzIE93bmVkIHsKICAgIHVpbnQgY29uc3RhbnQgT1JBQ0xJWkVfUEVSX1NQSU5fR0FTX0xJTUlUID0gNjEwMDsKICAgIHVpbnQgY29uc3RhbnQgT1JBQ0xJWkVfQkFTRV9HQVNfTElNSVQgPSAyMjAwMDA7CiAgICB1aW50IHNhZmVHYXMgPSA5MDAwOwogICAgCiAgICBldmVudCBMT0dfbmV3R2FzTGltaXQodWludCBfZ2FzTGltaXQpOwoKICAgIGZ1bmN0aW9uIHNldFNhZmVHYXModWludCBfZ2FzKSAKICAgICAgICAgICAgb25seU93bmVyIAogICAgewogICAgICAgIGFzc2VydChPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIF9nYXMgPj0gT1JBQ0xJWkVfQkFTRV9HQVNfTElNSVQpOwogICAgICAgIGFzc2VydChfZ2FzIDw9IDI1MDAwKTsKICAgICAgICBhc3NlcnQoX2dhcyA+PSA5MDAwKTsgCgogICAgICAgIHNhZmVHYXMgPSBfZ2FzOwogICAgICAgIExPR19uZXdHYXNMaW1pdChfZ2FzKTsKICAgIH0gICAgICAgCn0KCmNvbnRyYWN0IEhvdXNlTWFuYWdlZCBpcyBPd25lZCB7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIGhvdXNlQWRkcmVzczsKICAgIGFkZHJlc3MgbmV3T3duZXI7CiAgICBib29sIHB1YmxpYyBpc1N0b3BwZWQ7CgogICAgZXZlbnQgTE9HX0NvbnRyYWN0U3RvcHBlZCgpOwogICAgZXZlbnQgTE9HX0NvbnRyYWN0UmVzdW1lZCgpOwogICAgZXZlbnQgTE9HX093bmVyQWRkcmVzc0NoYW5nZWQoYWRkcmVzcyBvbGRBZGRyLCBhZGRyZXNzIG5ld093bmVyQWRkcmVzcyk7CiAgICBldmVudCBMT0dfSG91c2VBZGRyZXNzQ2hhbmdlZChhZGRyZXNzIG9sZEFkZHIsIGFkZHJlc3MgbmV3SG91c2VBZGRyZXNzKTsKICAgIAogICAgbW9kaWZpZXIgb25seUlmTm90U3RvcHBlZCB7CiAgICAgICAgYXNzZXJ0KCFpc1N0b3BwZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmU3RvcHBlZCB7CiAgICAgICAgYXNzZXJ0KGlzU3RvcHBlZCk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gSG91c2VNYW5hZ2VkKCkgewogICAgICAgIGhvdXNlQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc3RvcF9vcl9yZXN1bWVfQ29udHJhY3QoYm9vbCBfaXNTdG9wcGVkKQogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIGlzU3RvcHBlZCA9IF9pc1N0b3BwZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlSG91c2UoYWRkcmVzcyBfbmV3SG91c2UpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgYXNzZXJ0KF9uZXdIb3VzZSAhPSBhZGRyZXNzKDB4MCkpOyAKICAgICAgICAKICAgICAgICBob3VzZUFkZHJlc3MgPSBfbmV3SG91c2U7CiAgICAgICAgTE9HX0hvdXNlQWRkcmVzc0NoYW5nZWQoaG91c2VBZGRyZXNzLCBfbmV3SG91c2UpOwogICAgfQogICAgICAgIAogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7IAogICAgfSAgICAgCgogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7ICAgICAgIAogICAgICAgICAgICBMT0dfT3duZXJBZGRyZXNzQ2hhbmdlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgICAgICBkZWxldGUgbmV3T3duZXI7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCB1c2luZ0ludmVzdG9yc01vZHVsZSBpcyBIb3VzZU1hbmFnZWQsIG9yYWNsaXplU2V0dGluZ3MgewogICAgCiAgICB1aW50IGNvbnN0YW50IE1BWF9JTlZFU1RPUlMgPSA1OyAvL21heGltdW0gbnVtYmVyIG9mIGludmVzdG9ycwogICAgdWludCBjb25zdGFudCBkaXZlc3RGZWUgPSA1MDsgLy9kaXZlc3QgZmVlIHBlcmNlbnRhZ2UgKDEwMDAwID0gMTAwJSkKCiAgICAgc3RydWN0IEludmVzdG9yIHsKICAgICAgICBhZGRyZXNzIGludmVzdG9yQWRkcmVzczsKICAgICAgICB1aW50IGFtb3VudEludmVzdGVkOwogICAgICAgIGJvb2wgdm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsOwogICAgfQogICAgCiAgICAvL1N0YXJ0aW5nIGF0IDEKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgaW52ZXN0b3JJRHM7CiAgICBtYXBwaW5nKHVpbnQgPT4gSW52ZXN0b3IpIHB1YmxpYyBpbnZlc3RvcnM7CiAgICB1aW50IHB1YmxpYyBudW1JbnZlc3RvcnMgPSAwOwoKICAgIHVpbnQgcHVibGljIGludmVzdGVkID0gMDsKICAgIAogICAgdWludCBwdWJsaWMgaW52ZXN0b3JzUHJvZml0ID0gMDsKICAgIHVpbnQgcHVibGljIGludmVzdG9yc0xvc3NlcyA9IDA7CiAgICBib29sIHByb2ZpdERpc3RyaWJ1dGVkOwogICAgCiAgICBldmVudCBMT0dfSW52ZXN0b3JFbnRyYW5jZShhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExPR19JbnZlc3RvckNhcGl0YWxVcGRhdGUoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCBpbnQgYW1vdW50KTsKICAgIGV2ZW50IExPR19JbnZlc3RvckV4aXQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5QXV0b1N0b3AoKTsKICAgIAogICAgZXZlbnQgTE9HX1plcm9TZW5kKCk7CiAgICBldmVudCBMT0dfVmFsdWVJc1Rvb0JpZygpOwogICAgZXZlbnQgTE9HX0ZhaWxlZFNlbmQoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IExPR19TdWNjZXNzZnVsU2VuZChhZGRyZXNzIGFkZHIsIHVpbnQgdmFsdWUpOwogICAgCgoKICAgIG1vZGlmaWVyIG9ubHlNb3JlVGhhbk1pbkludmVzdG1lbnQgewogICAgICAgIGFzc2VydChtc2cudmFsdWUgPiBnZXRNaW5JbnZlc3RtZW50KCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1vcmVUaGFuWmVybyB7CiAgICAgICAgYXNzZXJ0KG1zZy52YWx1ZSAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIAogICAgbW9kaWZpZXIgb25seUludmVzdG9ycyB7CiAgICAgICAgYXNzZXJ0KGludmVzdG9ySURzW21zZy5zZW5kZXJdICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU5vdEludmVzdG9ycyB7CiAgICAgICAgYXNzZXJ0KGludmVzdG9ySURzW21zZy5zZW5kZXJdID09IDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGludmVzdG9yc0ludmFyaWFudCB7CiAgICAgICAgXzsKICAgICAgICBhc3NlcnQobnVtSW52ZXN0b3JzIDw9IE1BWF9JTlZFU1RPUlMpOwogICAgfQogICAgIAogICAgZnVuY3Rpb24gZ2V0QmFua3JvbGwoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIGlmICgoaW52ZXN0ZWQgPCBpbnZlc3RvcnNQcm9maXQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIGludmVzdG9yc1Byb2ZpdCA8IGludmVzdGVkKSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBpbnZlc3RvcnNQcm9maXQgPCBpbnZlc3RvcnNMb3NzZXMpKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGludmVzdGVkICsgaW52ZXN0b3JzUHJvZml0IC0gaW52ZXN0b3JzTG9zc2VzOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNaW5JbnZlc3RtZW50KCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICBpZiAobnVtSW52ZXN0b3JzID09IE1BWF9JTlZFU1RPUlMpIHsKICAgICAgICAgICAgdWludCBpbnZlc3RvcklEID0gc2VhcmNoU21hbGxlc3RJbnZlc3RvcigpOwogICAgICAgICAgICByZXR1cm4gZ2V0QmFsYW5jZShpbnZlc3RvcnNbaW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMb3NzZXNTaGFyZShhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIChpbnZlc3RvcnNbaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXV0uYW1vdW50SW52ZXN0ZWQgKiBpbnZlc3RvcnNMb3NzZXMpIC8gaW52ZXN0ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UHJvZml0U2hhcmUoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHJldHVybiAoaW52ZXN0b3JzW2ludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl1dLmFtb3VudEludmVzdGVkICogaW52ZXN0b3JzUHJvZml0KSAvIGludmVzdGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHVpbnQgaW52ZXN0ZWQgPSBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXV0uYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgdWludCBwcm9maXQgPSBnZXRQcm9maXRTaGFyZShjdXJyZW50SW52ZXN0b3IpOwogICAgICAgIHVpbnQgbG9zc2VzID0gZ2V0TG9zc2VzU2hhcmUoY3VycmVudEludmVzdG9yKTsKCiAgICAgICAgaWYgKChpbnZlc3RlZCArIHByb2ZpdCA8IHByb2ZpdCkgfHwKICAgICAgICAgICAgKGludmVzdGVkICsgcHJvZml0IDwgaW52ZXN0ZWQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIHByb2ZpdCA8IGxvc3NlcykpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIGludmVzdGVkICsgcHJvZml0IC0gbG9zc2VzOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlYXJjaFNtYWxsZXN0SW52ZXN0b3IoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIHVpbnQgaW52ZXN0b3JJRCA9IDE7CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChnZXRCYWxhbmNlKGludmVzdG9yc1tpXS5pbnZlc3RvckFkZHJlc3MpIDwgZ2V0QmFsYW5jZShpbnZlc3RvcnNbaW52ZXN0b3JJRF0uaW52ZXN0b3JBZGRyZXNzKSkgewogICAgICAgICAgICAgICAgaW52ZXN0b3JJRCA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBpbnZlc3RvcklEOwogICAgfQoKICAgIAogICAgZnVuY3Rpb24gYWRkSW52ZXN0b3JBdElEKHVpbnQgaWQpCiAgICAgICAgcHJpdmF0ZSB7CgogICAgICAgIGludmVzdG9ySURzW21zZy5zZW5kZXJdID0gaWQ7CiAgICAgICAgaW52ZXN0b3JzW2lkXS5pbnZlc3RvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGludmVzdG9yc1tpZF0uYW1vdW50SW52ZXN0ZWQgPSBtc2cudmFsdWU7CiAgICAgICAgaW52ZXN0ZWQgKz0gbXNnLnZhbHVlOwoKICAgICAgICBMT0dfSW52ZXN0b3JFbnRyYW5jZShtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2ZpdERpc3RyaWJ1dGlvbigpCiAgICAgICAgcHJpdmF0ZSB7CgogICAgICAgIGlmIChwcm9maXREaXN0cmlidXRlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgCiAgICAgICAgdWludCBjb3B5SW52ZXN0ZWQ7CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGN1cnJlbnRJbnZlc3RvciA9IGludmVzdG9yc1tpXS5pbnZlc3RvckFkZHJlc3M7CiAgICAgICAgICAgIHVpbnQgcHJvZml0T2ZJbnZlc3RvciA9IGdldFByb2ZpdFNoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgICAgIHVpbnQgbG9zc2VzT2ZJbnZlc3RvciA9IGdldExvc3Nlc1NoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL0NoZWNrIGZvciBvdmVyZmxvdyBhbmQgdW5kZXJmbG93CiAgICAgICAgICAgIGlmICgoaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkICsgcHJvZml0T2ZJbnZlc3RvciA+PSBpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQpICYmCiAgICAgICAgICAgICAgICAoaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkICsgcHJvZml0T2ZJbnZlc3RvciA+PSBsb3NzZXNPZkludmVzdG9yKSkgIHsKICAgICAgICAgICAgICAgIGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCArPSBwcm9maXRPZkludmVzdG9yIC0gbG9zc2VzT2ZJbnZlc3RvcjsKICAgICAgICAgICAgICAgIExPR19JbnZlc3RvckNhcGl0YWxVcGRhdGUoY3VycmVudEludmVzdG9yLCAoaW50KSAocHJvZml0T2ZJbnZlc3RvciAtIGxvc3Nlc09mSW52ZXN0b3IpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlzU3RvcHBlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBMT0dfRW1lcmdlbmN5QXV0b1N0b3AoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29weUludmVzdGVkICs9IGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZDsgCgogICAgICAgIH0KCiAgICAgICAgZGVsZXRlIGludmVzdG9yc1Byb2ZpdDsKICAgICAgICBkZWxldGUgaW52ZXN0b3JzTG9zc2VzOwogICAgICAgIGludmVzdGVkID0gY29weUludmVzdGVkOwoKICAgICAgICBwcm9maXREaXN0cmlidXRlZCA9IHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGluY3JlYXNlSW52ZXN0bWVudCgpCiAgICAgICAgcGF5YWJsZQogICAgICAgIG9ubHlJZk5vdFN0b3BwZWQKICAgICAgICBvbmx5TW9yZVRoYW5aZXJvCiAgICAgICAgb25seUludmVzdG9ycyAgewoKICAgICAgICBwcm9maXREaXN0cmlidXRpb24oKTsKICAgICAgICBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl1dLmFtb3VudEludmVzdGVkICs9IG1zZy52YWx1ZTsKICAgICAgICBpbnZlc3RlZCArPSBtc2cudmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gbmV3SW52ZXN0b3IoKQogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5SWZOb3RTdG9wcGVkCiAgICAgICAgb25seU1vcmVUaGFuWmVybwogICAgICAgIG9ubHlOb3RJbnZlc3RvcnMKICAgICAgICBvbmx5TW9yZVRoYW5NaW5JbnZlc3RtZW50CiAgICAgICAgaW52ZXN0b3JzSW52YXJpYW50IHsKCiAgICAgICAgcHJvZml0RGlzdHJpYnV0aW9uKCk7CgogICAgICAgIGlmIChudW1JbnZlc3RvcnMgPT0gTUFYX0lOVkVTVE9SUykgewogICAgICAgICAgICB1aW50IHNtYWxsZXN0SW52ZXN0b3JJRCA9IHNlYXJjaFNtYWxsZXN0SW52ZXN0b3IoKTsKICAgICAgICAgICAgZGl2ZXN0KGludmVzdG9yc1tzbWFsbGVzdEludmVzdG9ySURdLmludmVzdG9yQWRkcmVzcyk7CiAgICAgICAgfQoKICAgICAgICBudW1JbnZlc3RvcnMrKzsKICAgICAgICBhZGRJbnZlc3RvckF0SUQobnVtSW52ZXN0b3JzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXZlc3QoKQogICAgICAgIG9ubHlJbnZlc3RvcnMgewoKICAgICAgICBkaXZlc3QobXNnLnNlbmRlcik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRpdmVzdChhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGludmVzdG9yc0ludmFyaWFudCB7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbigpOwogICAgICAgIHVpbnQgY3VycmVudElEID0gaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXTsKICAgICAgICB1aW50IGFtb3VudFRvUmV0dXJuID0gZ2V0QmFsYW5jZShjdXJyZW50SW52ZXN0b3IpOwoKICAgICAgICBpZiAoaW52ZXN0ZWQgPj0gaW52ZXN0b3JzW2N1cnJlbnRJRF0uYW1vdW50SW52ZXN0ZWQpIHsKICAgICAgICAgICAgaW52ZXN0ZWQgLT0gaW52ZXN0b3JzW2N1cnJlbnRJRF0uYW1vdW50SW52ZXN0ZWQ7CiAgICAgICAgICAgIHVpbnQgZGl2ZXN0RmVlQW1vdW50ID0gIChhbW91bnRUb1JldHVybipkaXZlc3RGZWUpLzEwMDAwOwogICAgICAgICAgICBhbW91bnRUb1JldHVybiAtPSBkaXZlc3RGZWVBbW91bnQ7CgogICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JzW2N1cnJlbnRJRF07CiAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcklEc1tjdXJyZW50SW52ZXN0b3JdOwoKICAgICAgICAgICAgLy9SZW9yZGVyIGludmVzdG9ycwogICAgICAgICAgICBpZiAoY3VycmVudElEICE9IG51bUludmVzdG9ycykgewogICAgICAgICAgICAgICAgLy8gR2V0IGxhc3QgaW52ZXN0b3IKICAgICAgICAgICAgICAgIEludmVzdG9yIGxhc3RJbnZlc3RvciA9IGludmVzdG9yc1tudW1JbnZlc3RvcnNdOwogICAgICAgICAgICAgICAgLy9TZXQgbGFzdCBpbnZlc3RvciBJRCB0byBpbnZlc3RvcklEIG9mIGRpdmVzdGluZyBhY2NvdW50CiAgICAgICAgICAgICAgICBpbnZlc3RvcklEc1tsYXN0SW52ZXN0b3IuaW52ZXN0b3JBZGRyZXNzXSA9IGN1cnJlbnRJRDsKICAgICAgICAgICAgICAgIC8vQ29weSBpbnZlc3RvciBhdCB0aGUgbmV3IHBvc2l0aW9uIGluIHRoZSBtYXBwaW5nCiAgICAgICAgICAgICAgICBpbnZlc3RvcnNbY3VycmVudElEXSA9IGxhc3RJbnZlc3RvcjsKICAgICAgICAgICAgICAgIC8vRGVsZXRlIG9sZCBwb3NpdGlvbiBpbiB0aGUgbWFwcHBpbmcKICAgICAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbbnVtSW52ZXN0b3JzXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbnVtSW52ZXN0b3JzLS07CiAgICAgICAgICAgIHNhZmVTZW5kKGN1cnJlbnRJbnZlc3RvciwgYW1vdW50VG9SZXR1cm4pOwogICAgICAgICAgICBzYWZlU2VuZChob3VzZUFkZHJlc3MsIGRpdmVzdEZlZUFtb3VudCk7CiAgICAgICAgICAgIExPR19JbnZlc3RvckV4aXQoY3VycmVudEludmVzdG9yLCBhbW91bnRUb1JldHVybik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXNTdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgTE9HX0VtZXJnZW5jeUF1dG9TdG9wKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBmb3JjZURpdmVzdE9mQWxsSW52ZXN0b3JzKCkKICAgICAgICBvbmx5T3duZXIgewogICAgICAgICAgICAKICAgICAgICB1aW50IGNvcHlOdW1JbnZlc3RvcnMgPSBudW1JbnZlc3RvcnM7CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IGNvcHlOdW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBkaXZlc3QoaW52ZXN0b3JzWzFdLmludmVzdG9yQWRkcmVzcyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBzYWZlU2VuZChhZGRyZXNzIGFkZHIsIHVpbnQgdmFsdWUpCiAgICAgICAgaW50ZXJuYWwgewoKICAgICAgICBpZiAodmFsdWUgPT0gMCkgewogICAgICAgICAgICBMT0dfWmVyb1NlbmQoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA8IHZhbHVlKSB7CiAgICAgICAgICAgIExPR19WYWx1ZUlzVG9vQmlnKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghKGFkZHIuY2FsbC5nYXMoc2FmZUdhcykudmFsdWUodmFsdWUpKCkpKSB7CiAgICAgICAgICAgIExPR19GYWlsZWRTZW5kKGFkZHIsIHZhbHVlKTsKICAgICAgICAgICAgaWYgKGFkZHIgIT0gaG91c2VBZGRyZXNzKSB7CiAgICAgICAgICAgICAgICAvL0ZvcndhcmQgdG8gaG91c2UgYWRkcmVzcyBhbGwgY2hhbmdlCiAgICAgICAgICAgICAgICBpZiAoIShob3VzZUFkZHJlc3MuY2FsbC5nYXMoc2FmZUdhcykudmFsdWUodmFsdWUpKCkpKSBMT0dfRmFpbGVkU2VuZChob3VzZUFkZHJlc3MsIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgTE9HX1N1Y2Nlc3NmdWxTZW5kKGFkZHIsdmFsdWUpOwogICAgfQp9Cgpjb250cmFjdCBFbWVyZ2VuY3lXaXRoZHJhd2FsTW9kdWxlIGlzIHVzaW5nSW52ZXN0b3JzTW9kdWxlIHsKICAgIHVpbnQgY29uc3RhbnQgRU1FUkdFTkNZX1dJVEhEUkFXQUxfUkFUSU8gPSA4MDsgLy9yYXRpbyBwZXJjZW50YWdlICgxMDAgPSAxMDAlKQogICAgdWludCBjb25zdGFudCBFTUVSR0VOQ1lfVElNRU9VVCA9IDMgZGF5czsKICAgIAogICAgc3RydWN0IFdpdGhkcmF3YWxQcm9wb3NhbCB7CiAgICAgICAgYWRkcmVzcyB0b0FkZHJlc3M7CiAgICAgICAgdWludCBhdFRpbWU7CiAgICB9CiAgICAKICAgIFdpdGhkcmF3YWxQcm9wb3NhbCBwdWJsaWMgcHJvcG9zZWRXaXRoZHJhd2FsOwogICAgCiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFByb3Bvc2VkKCk7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbEZhaWxlZChhZGRyZXNzIGluZGV4ZWQgd2l0aGRyYXdhbEFkZHJlc3MpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxTdWNjZWVkZWQoYWRkcmVzcyBpbmRleGVkIHdpdGhkcmF3YWxBZGRyZXNzLCB1aW50IGFtb3VudFdpdGhkcmF3bik7CiAgICBldmVudCBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFZvdGUoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCBib29sIHZvdGUpOwogICAgCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJQcm9wb3NlZCB7CiAgICAgICAgYXNzZXJ0KHByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3MgIT0gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seUlmRW1lcmdlbmN5VGltZU91dEhhc1Bhc3NlZCB7CiAgICAgICAgYXNzZXJ0KHByb3Bvc2VkV2l0aGRyYXdhbC5hdFRpbWUgKyBFTUVSR0VOQ1lfVElNRU9VVCA8PSBub3cpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHZvdGVFbWVyZ2VuY3lXaXRoZHJhd2FsKGJvb2wgdm90ZSkKICAgICAgICBvbmx5SW52ZXN0b3JzCiAgICAgICAgb25seUFmdGVyUHJvcG9zZWQKICAgICAgICBvbmx5SWZTdG9wcGVkIHsKCiAgICAgICAgaW52ZXN0b3JzW2ludmVzdG9ySURzW21zZy5zZW5kZXJdXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWwgPSB2b3RlOwogICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsVm90ZShtc2cuc2VuZGVyLCB2b3RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9wb3NlRW1lcmdlbmN5V2l0aGRyYXdhbChhZGRyZXNzIHdpdGhkcmF3YWxBZGRyZXNzKQogICAgICAgIG9ubHlJZlN0b3BwZWQKICAgICAgICBvbmx5T3duZXIgewoKICAgICAgICAvL1Jlc2V0cyBwcmV2aW91cyB2b3RlcwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBkZWxldGUgaW52ZXN0b3JzW2ldLnZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbDsKICAgICAgICB9CgogICAgICAgIHByb3Bvc2VkV2l0aGRyYXdhbCA9IFdpdGhkcmF3YWxQcm9wb3NhbCh3aXRoZHJhd2FsQWRkcmVzcywgbm93KTsKICAgICAgICBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbFByb3Bvc2VkKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZXhlY3V0ZUVtZXJnZW5jeVdpdGhkcmF3YWwoKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlBZnRlclByb3Bvc2VkCiAgICAgICAgb25seUlmU3RvcHBlZAogICAgICAgIG9ubHlJZkVtZXJnZW5jeVRpbWVPdXRIYXNQYXNzZWQgewoKICAgICAgICB1aW50IG51bU9mVm90ZXNJbkZhdm91cjsKICAgICAgICB1aW50IGFtb3VudFRvV2l0aGRyYXcgPSB0aGlzLmJhbGFuY2U7CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBpZiAoaW52ZXN0b3JzW2ldLnZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbCA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBudW1PZlZvdGVzSW5GYXZvdXIrKzsKICAgICAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbaV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobnVtT2ZWb3Rlc0luRmF2b3VyID49IEVNRVJHRU5DWV9XSVRIRFJBV0FMX1JBVElPICogbnVtSW52ZXN0b3JzIC8gMTAwKSB7CiAgICAgICAgICAgIGlmICghcHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcy5zZW5kKGFtb3VudFRvV2l0aGRyYXcpKSB7CiAgICAgICAgICAgICAgICBMT0dfRW1lcmdlbmN5V2l0aGRyYXdhbEZhaWxlZChwcm9wb3NlZFdpdGhkcmF3YWwudG9BZGRyZXNzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsU3VjY2VlZGVkKHByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3MsIGFtb3VudFRvV2l0aGRyYXcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgICAgICAvKgogICAgVGhlIG93bmVyIGNhbiB1c2UgdGhpcyBmdW5jdGlvbiB0byBmb3JjZSB0aGUgZXhpdCBvZiBhbiBpbnZlc3RvciBmcm9tIHRoZQogICAgY29udHJhY3QgZHVyaW5nIGFuIGVtZXJnZW5jeSB3aXRoZHJhd2FsIGluIHRoZSBmb2xsb3dpbmcgc2l0dWF0aW9uczoKICAgICAgICAtIFVucmVzcG9uc2l2ZSBpbnZlc3RvcgogICAgICAgIC0gSW52ZXN0b3IgZGVtYW5kaW5nIHRvIGJlIHBhaWQgaW4gb3RoZXIgdG8gdm90ZSwgdGhlIGZhY3RvLWJsYWNrbWFpbGluZwogICAgICAgIG90aGVyIGludmVzdG9ycwogICAgKi8KICAgIGZ1bmN0aW9uIGZvcmNlRGl2ZXN0T2ZPbmVJbnZlc3RvcihhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5SWZTdG9wcGVkIHsKCiAgICAgICAgZGl2ZXN0KGN1cnJlbnRJbnZlc3Rvcik7CiAgICAgICAgLy9SZXNldHMgZW1lcmdlbmN5IHdpdGhkcmF3YWwgcHJvcG9zYWwuIEludmVzdG9ycyBtdXN0IHZvdGUgYWdhaW4KICAgICAgICBkZWxldGUgcHJvcG9zZWRXaXRoZHJhd2FsOwogICAgfQp9Cgpjb250cmFjdCBTbG90IGlzIHVzaW5nT3JhY2xpemUsIEVtZXJnZW5jeVdpdGhkcmF3YWxNb2R1bGUsIERTTWF0aCB7CiAgICAKICAgIHVpbnQgY29uc3RhbnQgSU5WRVNUT1JTX0VER0UgPSAyMDA7IAogICAgdWludCBjb25zdGFudCBIT1VTRV9FREdFID0gNTA7CiAgICB1aW50IGNvbnN0YW50IENBUElUQUxfUklTSyA9IDI1MDsKICAgIHVpbnQgY29uc3RhbnQgTUFYX1NQSU5TID0gMTY7CiAgICAKICAgIHVpbnQgbWluQmV0ID0gMSB3ZWk7CiAKICAgIHN0cnVjdCBTcGluc0NvbnRhaW5lciB7CiAgICAgICAgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzOwogICAgICAgIHVpbnQgblNwaW5zOwogICAgICAgIHVpbnQgYW1vdW50V2FnZXJlZDsKICAgIH0KICAgIAogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBTcGluc0NvbnRhaW5lcikgc3BpbnM7CiAgICAKICAgIC8qIEJvdGggYXJyYXlzIGFyZSBvcmRlcmVkOgogICAgIC0gcHJvYmFiaWxpdGllcyBhcmUgb3JkZXJlZCBmcm9tIHNtYWxsZXN0IHRvIGhpZ2hlc3QKICAgICAtIG11bHRpcGxpZXJzIGFyZSBvcmRlcmVkIGZyb20gaGlnaGVzdCB0byBsb3dlc3QKICAgICBUaGUgcHJvYmFiaWxpdGllcyBhcmUgZXhwcmVzc2VkIGFzIGludGVnZXIgbnVtYmVycyBvdmVyIGEgc2NhbGUgb2YgMTAwMDA6IGkuZQogICAgIDEwMCBpcyBlcXVpdmFsZW50IHRvIDElLCA1MDAwIHRvIDUwJSBhbmQgc28gb24uCiAgICAqLwogICAgdWludFtdIHB1YmxpYyBwcm9iYWJpbGl0aWVzOwogICAgdWludFtdIHB1YmxpYyBtdWx0aXBsaWVyczsKICAgIAogICAgdWludCBwdWJsaWMgdG90YWxBbW91bnRXYWdlcmVkOyAKICAgIAogICAgZXZlbnQgTE9HX25ld1NwaW5zQ29udGFpbmVyKGJ5dGVzMzIgbXlpZCwgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzLCB1aW50IGFtb3VudFdhZ2VyZWQsIHVpbnQgblNwaW5zKTsKICAgIGV2ZW50IExPR19TcGluRXhlY3V0ZWQoYnl0ZXMzMiBteWlkLCBhZGRyZXNzIHBsYXllckFkZHJlc3MsIHVpbnQgc3BpbkluZGV4LCB1aW50IG51bWJlckRyYXduLCB1aW50IGdyb3NzUGF5b3V0Rm9yU3Bpbik7CiAgICBldmVudCBMT0dfU3BpbnNDb250YWluZXJJbmZvKGJ5dGVzMzIgbXlpZCwgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzLCB1aW50IG5ldFBheW91dCk7CiAgICBldmVudCBMT0dfUHJvb2ZGYWlsdXJlKGJ5dGVzMzIgbXlpZCwgYWRkcmVzcyBwbGF5ZXJBZGRyZXNzKTsKCiAgICBMZWRnZXJQcm9vZlZlcmlmeUkgZXh0ZXJuYWxDb250cmFjdDsKICAgIAogICAgZnVuY3Rpb24gU2xvdChhZGRyZXNzIF92ZXJpZmllckFkZHIpIHsKICAgICAgICBleHRlcm5hbENvbnRyYWN0ID0gTGVkZ2VyUHJvb2ZWZXJpZnlJKF92ZXJpZmllckFkZHIpOwogICAgfQogICAgCiAgICAvL1NFQ1RJT04gSTogTU9ESUZJRVJTIEFORCBIRUxQRVIgRlVOQ1RJT05TCiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIGludGVybmFsIHsKICAgICAgICBleHRlcm5hbENvbnRyYWN0LmV4dGVybmFsX29yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQocXVlcnlJZCwgY29tbWl0bWVudCk7CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlPcmFjbGl6ZSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3JhY2xpemVfY2JBZGRyZXNzKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmU3BpbnNFeGlzdChieXRlczMyIG15aWQpIHsKICAgICAgICByZXF1aXJlKHNwaW5zW215aWRdLnBsYXllckFkZHJlc3MgIT0gYWRkcmVzcygweDApKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBpc1ZhbGlkU2l6ZSh1aW50IF9hbW91bnRXYWdlcmVkKSAKICAgICAgICBpbnRlcm5hbCAKICAgICAgICByZXR1cm5zKGJvb2wpIHsKICAgICAgICAgICAgCiAgICAgICAgdWludCBuZXRQb3RlbnRpYWxQYXlvdXQgPSAoX2Ftb3VudFdhZ2VyZWQgKiAoMTAwMDAgLSBJTlZFU1RPUlNfRURHRSkgKiBtdWx0aXBsaWVyc1swXSkvIDEwMDAwOyAKICAgICAgICB1aW50IG1heEFsbG93ZWRQYXlvdXQgPSAoQ0FQSVRBTF9SSVNLICogZ2V0QmFua3JvbGwoKSkvMTAwMDA7CiAgICAgICAgCiAgICAgICAgcmV0dXJuICgobmV0UG90ZW50aWFsUGF5b3V0IDw9IG1heEFsbG93ZWRQYXlvdXQpICYmIChfYW1vdW50V2FnZXJlZCA+PSBtaW5CZXQpKTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZFbm91Z2hGdW5kcyhieXRlczMyIG15aWQpIHsKICAgICAgICBpZiAoaXNWYWxpZFNpemUoc3BpbnNbbXlpZF0uYW1vdW50V2FnZXJlZCkpIHsKICAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhZGRyZXNzIHBsYXllckFkZHJlc3MgPSBzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzOwogICAgICAgICAgICB1aW50IGFtb3VudFdhZ2VyZWQgPSBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkOyAgIAogICAgICAgICAgICBkZWxldGUgc3BpbnNbbXlpZF07CiAgICAgICAgICAgIHNhZmVTZW5kKHBsYXllckFkZHJlc3MsIGFtb3VudFdhZ2VyZWQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgCgogICAgbW9kaWZpZXIgb25seVZhbGlkTnVtYmVyT2ZTcGlucyAodWludCBfblNwaW5zKSB7CiAgICAgICAgYXNzZXJ0KF9uU3BpbnMgPD0gTUFYX1NQSU5TKTsKICAgICAgICAgICAgICBhc3NlcnQoX25TcGlucyA+IDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8qCiAgICAgICAgRm9yIHRoZSBnYW1lIHRvIGJlIGZhaXIsIHRoZSB0b3RhbCBncm9zcyBwYXlvdXQgb3ZlciBhIGxhcmdlIG51bWJlciBvZiAKICAgICAgICBpbmRpdmlkdWFsIHNsb3Qgc3BpbnMgc2hvdWxkIGJlIHRoZSB0b3RhbCBhbW91bnQgd2FnZXJlZCBieSB0aGUgcGxheWVyLiAKICAgICAgICAKICAgICAgICBUaGUgZ2FtZSBvd25lciwgY2FsbGVkIGhvdXNlLCBhbmQgdGhlIGludmVzdG9ycyB3aWxsIGdhaW4gYnkgYXBwbHlpbmcgCiAgICAgICAgYSBzbWFsbCBmZWUsIGNhbGxlZCBlZGdlLCB0byB0aGUgYW1vdW50IHdvbiBieSB0aGUgcGxheWVyIGluIHRoZSBjYXNlIG9mCiAgICAgICAgYSBzdWNjZXNzZnVsIHNwaW4uIAogICAgICAgIAogICAgICAgIFRoZSB0b3RhbCBncm9zcyBleHBlY3RlZCBwYXlvdXQgaXMgZXF1YWwgdG8gdGhlIHN1bSBvZiBhbGwgcGF5b3V0LiBFYWNoIAogICAgICAgIGktdGggcGF5b3V0IGlzIGNhbGN1bGF0ZWQ6CiAgICAgICAgICAgICAgICAgICAgYW1vdW50V2FnZXJlZCAqIG11bHRpcGxpZXJzW2ldICogcHJvYmFiaWxpdGllc1tpXSAKICAgICAgICBUaGUgZmFpcm5lc3MgY29uZGl0aW9uIGNhbiBiZSBleHByZXNzZWQgYXMgdGhlIGVxdWF0aW9uOgogICAgICAgICAgICAgICAgICAgIHN1bSBvZiBhVyAqIG1baV0gKiBwW2ldID0gYVcKICAgICAgICBBZnRlciBoYXZpbmcgc2ltcGxpZmllZCB0aGUgZXF1YXRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIHN1bSBvZiBtW2ldICogcFtpXSA9IDEKICAgICAgICBTaW5jZSBvdXIgcHJvYmFiaWxpdGllcyBhcmUgZGVmaW5lZCBvdmVyIDEwMDAwLCB0aGUgc3VtIHNob3VsZCBiZSAxMDAwMC4KICAgICAgICAKICAgICAgICBUaGUgY29udHJhY3Qgb3duZXIgY2FuIG1vZGlmeSB0aGUgbXVsdGlwbGllcnMgYW5kIHByb2JhYmlsaXRpZXMgYXJyYXksIAogICAgICAgIGJ1dCB0aGUgIG1vZGlmaWVyIGVuZm9yY2VzIHRoYXQgdGhlIG51bWJlciBjaG9vc2VuIGFsd2F5cyByZXN1bHQgaW4gYSAKICAgICAgICBmYXJlIGdhbWUuCiAgICAqLwogICAgbW9kaWZpZXIgb25seUlmRmFpcih1aW50W10gX3Byb2IsIHVpbnRbXSBfcGF5b3V0cykgewogICAgICAgIGlmIChfcHJvYi5sZW5ndGggIT0gX3BheW91dHMubGVuZ3RoKSByZXZlcnQoKTsKICAgICAgICB1aW50IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDxfcHJvYi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdW0gKz0gX3Byb2JbaV0gKiBfcGF5b3V0c1tpXTsgICAgIAogICAgICAgIH0KICAgICAgICBhc3NlcnQoc3VtID09IDEwMDAwKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uKCkKICAgICAgICBwYXlhYmxlIHsKICAgICAgICBidXlTcGlucygxKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXlTcGlucyh1aW50IF9uU3BpbnMpIAogICAgICAgIHBheWFibGUgCiAgICAgICAgb25seVZhbGlkTnVtYmVyT2ZTcGlucyhfblNwaW5zKSAKICAgICAgICAgICAgICAgICAgICBvbmx5SWZOb3RTdG9wcGVkIHsKICAgICAgICAgICAgCiAgICAgICAgdWludCBnYXMgPSBfblNwaW5zKk9SQUNMSVpFX1BFUl9TUElOX0dBU19MSU1JVCArIE9SQUNMSVpFX0JBU0VfR0FTX0xJTUlUICsgc2FmZUdhczsKICAgICAgICB1aW50IG9yYWNsaXplRmVlID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpLmdldFByaWNlKCJyYW5kb20iLCBnYXMpOwogICAgICAgIAogICAgICAgIC8vIERpc2FsbG93IGJldHMgdGhhdCBldmVuIHdoZW4gbWF4aW1hbGx5IHdpbm5pbmcgYXJlIGEgbG9zcyBmb3IgcGxheWVyIAogICAgICAgIC8vIGR1ZSB0byBvcmFjbGl6ZUZlZQogICAgICAgIGFzc2VydChvcmFjbGl6ZUZlZS9tdWx0aXBsaWVyc1swXSArIG9yYWNsaXplRmVlIDwgbXNnLnZhbHVlKTsKICAgICAgICB1aW50IGFtb3VudFdhZ2VyZWQgPSBtc2cudmFsdWUgLSBvcmFjbGl6ZUZlZTsKICAgICAgICBhc3NlcnQoaXNWYWxpZFNpemUoYW1vdW50V2FnZXJlZCkpOwogICAgICAgIAogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkoMCwgMipfblNwaW5zLCBnYXMpOwogICAgICAgIHNwaW5zW3F1ZXJ5SWRdID0gCiAgICAgICAgICAgIFNwaW5zQ29udGFpbmVyKG1zZy5zZW5kZXIsCiAgICAgICAgICAgICAgICAgICBfblNwaW5zLAogICAgICAgICAgICAgICAgICAgYW1vdW50V2FnZXJlZAogICAgICAgICAgICAgICAgICApOwogICAgICAgIExPR19uZXdTcGluc0NvbnRhaW5lcihxdWVyeUlkLCBtc2cuc2VuZGVyLCBhbW91bnRXYWdlcmVkLCBfblNwaW5zKTsKICAgICAgICB0b3RhbEFtb3VudFdhZ2VyZWQgKz0gYW1vdW50V2FnZXJlZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZXhlY3V0ZVNwaW5zKGJ5dGVzMzIgbXlpZCwgYnl0ZXMgcmFuZG9tQnl0ZXMpIAogICAgICAgIHByaXZhdGUgCiAgICAgICAgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHVpbnQgYW1vdW50V29uVG90YWwgPSAwOwogICAgICAgIHVpbnQgYW1vdW50V29uU3BpbiA9IDA7CiAgICAgICAgdWludCBudW1iZXJEcmF3biA9IDA7CiAgICAgICAgdWludCByYW5nZVVwcGVyRW5kID0gMDsKICAgICAgICB1aW50IG5TcGlucyA9IHNwaW5zW215aWRdLm5TcGluczsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAyKm5TcGluczsgaSArPSAyKSB7CiAgICAgICAgICAgIC8vIEEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMioqMTYsIG5vcm1hbGl6ZWQgb3ZlciAwIC0gMTAwMDAKICAgICAgICAgICAgbnVtYmVyRHJhd24gPSAoKHVpbnQocmFuZG9tQnl0ZXNbaV0pKjI1NiArIHVpbnQocmFuZG9tQnl0ZXNbaSsxXSkpKjEwMDAwKS8yKioxNjsKICAgICAgICAgICAgcmFuZ2VVcHBlckVuZCA9IDA7CiAgICAgICAgICAgIGFtb3VudFdvblNwaW4gPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCBwcm9iYWJpbGl0aWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICByYW5nZVVwcGVyRW5kICs9IHByb2JhYmlsaXRpZXNbal07CiAgICAgICAgICAgICAgICBpZiAobnVtYmVyRHJhd24gPCByYW5nZVVwcGVyRW5kKSB7CiAgICAgICAgICAgICAgICAgICAgYW1vdW50V29uU3BpbiA9IChzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkICogbXVsdGlwbGllcnNbal0pIC8gblNwaW5zOwogICAgICAgICAgICAgICAgICAgIGFtb3VudFdvblRvdGFsICs9IGFtb3VudFdvblNwaW47CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTE9HX1NwaW5FeGVjdXRlZChteWlkLCBzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBpLzIsIG51bWJlckRyYXduLCBhbW91bnRXb25TcGluKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudFdvblRvdGFsOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZW5kUGF5b3V0KGJ5dGVzMzIgbXlpZCwgdWludCBwYXlvdXQpIHByaXZhdGUgewoKICAgICAgICB1aW50IGludmVzdG9yc0ZlZSA9IHBheW91dCpJTlZFU1RPUlNfRURHRS8xMDAwMDsgCiAgICAgICAgdWludCBob3VzZUZlZSA9IHBheW91dCpIT1VTRV9FREdFLzEwMDAwOwogICAgICAKICAgICAgICB1aW50IG5ldFBsYXllclBheW91dCA9IHN1YihzdWIocGF5b3V0LGludmVzdG9yc0ZlZSksIGhvdXNlRmVlKTsKICAgICAgICB1aW50IG5ldENvc3RGb3JJbnZlc3RvcnMgPSBhZGQobmV0UGxheWVyUGF5b3V0LCBob3VzZUZlZSk7CgogICAgICAgIGlmIChuZXRDb3N0Rm9ySW52ZXN0b3JzID49IHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQpIHsKICAgICAgICAgICAgaW52ZXN0b3JzTG9zc2VzICs9IHN1YihuZXRDb3N0Rm9ySW52ZXN0b3JzLCBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGludmVzdG9yc1Byb2ZpdCArPSBzdWIoc3BpbnNbbXlpZF0uYW1vdW50V2FnZXJlZCwgbmV0Q29zdEZvckludmVzdG9ycyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIExPR19TcGluc0NvbnRhaW5lckluZm8obXlpZCwgc3BpbnNbbXlpZF0ucGxheWVyQWRkcmVzcywgbmV0UGxheWVyUGF5b3V0KTsKICAgICAgICBzYWZlU2VuZChzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBuZXRQbGF5ZXJQYXlvdXQpOwogICAgICAgIHNhZmVTZW5kKGhvdXNlQWRkcmVzcywgaG91c2VGZWUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgX3Byb29mKSAKICAgICAgICBvbmx5T3JhY2xpemUKICAgICAgICBvbmx5SWZTcGluc0V4aXN0KG15aWQpCiAgICAgICAgb25seUlmRW5vdWdoRnVuZHMobXlpZCkKICAgIHsKICAgICAgICAvLyBJZiB0aGUgcHJvb2YgZmFpbHMsIHJldHVybiBhbW91bnQgd2FnZXJlZCB0byB0aGUgcGxheWVyCiAgICAgICAgaWYoIWV4dGVybmFsQ29udHJhY3QuZXh0ZXJuYWxfb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoX3Byb29mLCBteWlkLCBieXRlcyhyZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKSkgewogICAgICAgICAgICByZWZ1bmRQbGF5ZXIobXlpZCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB1aW50IHBheW91dCA9IGV4ZWN1dGVTcGlucyhteWlkLCBieXRlcyhyZXN1bHQpKTsKICAgICAgICAKICAgICAgICAgICAgc2VuZFBheW91dChteWlkLCBwYXlvdXQpOwogICAgICAgIAogICAgICAgICAgICBkZWxldGUgcHJvZml0RGlzdHJpYnV0ZWQ7CiAgICAgICAgfQoKICAgICAgICBkZWxldGUgc3BpbnNbbXlpZF07CiAgICB9CgogICAgZnVuY3Rpb24gcmVmdW5kUGxheWVyKGJ5dGVzMzIgbXlpZCkgcHJpdmF0ZSB7CiAgICAgICAgTE9HX1Byb29mRmFpbHVyZShteWlkLCBzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzKTsKICAgICAgICBzYWZlU2VuZChzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKTsKICAgIH0KICAgIAogICAgLy8gU0VUVEVSUyAtIFNFVFRJTkdTIEFDQ0VTU0lCTEUgQlkgT1dORVIKICAgIAogICAgLy8gQ2hlY2sgb3JkZXJpbmcgYXMgd2VsbCwgc2luY2Ugb3JkZXJpbmcgYXNzdW1wdGlvbnMgYXJlIG1hZGUgaW4gX2NhbGxiYWNrIAogICAgLy8gYW5kIGVsc2V3aGVyZQogICAgZnVuY3Rpb24gc2V0Q29uZmlndXJhdGlvbih1aW50W10gX3Byb2JhYmlsaXRpZXMsIHVpbnRbXSBfbXVsdGlwbGllcnMpIAogICAgICAgIG9ubHlPd25lciAKICAgICAgICBvbmx5SWZGYWlyKF9wcm9iYWJpbGl0aWVzLCBfbXVsdGlwbGllcnMpIHsKICAgICAgICAgICAgICAgIAogICAgICAgIG9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9MZWRnZXIpOyAvL1RoaXMgaXMgaGVyZSB0byByZWR1Y2UgZ2FzIGNvc3QgYXMgdGhpcyBmdW5jdGlvbiBoYXMgdG8gYmUgY2FsbGVkIGFueXdheSBmb3IgaW5pdGlhbGl6YXRpb24KICAgICAgICAKICAgICAgICBkZWxldGUgcHJvYmFiaWxpdGllczsKICAgICAgICBkZWxldGUgbXVsdGlwbGllcnM7CiAgICAgICAgCiAgICAgICAgdWludCBsYXN0UHJvYmFiaWxpdHkgPSAwOwogICAgICAgIHVpbnQgbGFzdE11bHRpcGxpZXIgPSAyKioyNTYgLSAxOwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9wcm9iYWJpbGl0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHByb2JhYmlsaXRpZXMucHVzaChfcHJvYmFiaWxpdGllc1tpXSk7CiAgICAgICAgICAgIGlmIChsYXN0UHJvYmFiaWxpdHkgPj0gX3Byb2JhYmlsaXRpZXNbaV0pIHJldmVydCgpOwogICAgICAgICAgICBsYXN0UHJvYmFiaWxpdHkgPSBfcHJvYmFiaWxpdGllc1tpXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9tdWx0aXBsaWVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtdWx0aXBsaWVycy5wdXNoKF9tdWx0aXBsaWVyc1tpXSk7CiAgICAgICAgICAgIGlmIChsYXN0TXVsdGlwbGllciA8PSBfbXVsdGlwbGllcnNbaV0pIHJldmVydCgpOwogICAgICAgICAgICBsYXN0TXVsdGlwbGllciA9IF9tdWx0aXBsaWVyc1tpXTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldE1pbkJldCh1aW50IF9taW5CZXQpIG9ubHlPd25lciB7CiAgICAgICAgbWluQmV0ID0gX21pbkJldDsKICAgIH0KICAgIAogICAgLy8gR0VUVEVSUyAtIENPTlNUQU5UIE1FVEhPRFMKICAgIAogICAgZnVuY3Rpb24gZ2V0U3BpbnNDb250YWluZXIoYnl0ZXMzMiBteWlkKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyhhZGRyZXNzLCB1aW50KSB7CiAgICAgICAgcmV0dXJuIChzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKTsgCiAgICB9CgogICAgLy8gUmV0dXJucyBtaW5pbWFsIGFtb3VudCB0byB3YWdlciB0byByZXR1cm4gYSBwcm9maXQgaW4gY2FzZSBvZiBtYXggd2luCiAgICBmdW5jdGlvbiBnZXRNaW5BbW91bnRUb1dhZ2VyKHVpbnQgX25TcGlucykKICAgICAgICBvbmx5VmFsaWROdW1iZXJPZlNwaW5zKF9uU3BpbnMpCiAgICAgICAgY29uc3RhbnQKICAgICAgICAgICAgICAgIHJldHVybnModWludCkgewogICAgICAgIHVpbnQgZ2FzID0gX25TcGlucypPUkFDTElaRV9QRVJfU1BJTl9HQVNfTElNSVQgKyBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIHNhZmVHYXM7CiAgICAgICAgdWludCBvcmFjbGl6ZUZlZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKS5nZXRQcmljZSgicmFuZG9tIiwgZ2FzKTsKICAgICAgICByZXR1cm4gbWluQmV0ICsgb3JhY2xpemVGZWUvbXVsdGlwbGllcnNbMF0gKyBvcmFjbGl6ZUZlZTsKICAgIH0KICAgCiAgICBmdW5jdGlvbiBnZXRNYXhBbW91bnRUb1dhZ2VyKHVpbnQgX25TcGlucykKICAgICAgICBvbmx5VmFsaWROdW1iZXJPZlNwaW5zKF9uU3BpbnMpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgdWludCBvcmFjbGl6ZUZlZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKS5nZXRQcmljZSgicmFuZG9tIiwgX25TcGlucypPUkFDTElaRV9QRVJfU1BJTl9HQVNfTElNSVQgKyBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIHNhZmVHYXMpOwogICAgICAgIHVpbnQgbWF4V2FnZSA9ICAoQ0FQSVRBTF9SSVNLICogZ2V0QmFua3JvbGwoKSkqMTAwMDAvKCgxMDAwMCAtIElOVkVTVE9SU19FREdFKSoxMDAwMCptdWx0aXBsaWVyc1swXSk7CiAgICAgICAgcmV0dXJuIG1heFdhZ2UgKyBvcmFjbGl6ZUZlZTsKICAgIH0KICAgIAp9'.
	

]
