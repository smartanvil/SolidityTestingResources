Class {
	#name : #SRT48599941665827f9eA5a16C3D7417A43a1ce5df4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT48599941665827f9eA5a16C3D7417A43a1ce5df4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKCXVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoJZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKCWZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewoJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CglmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwoJZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgpjb250cmFjdCBEZXRhaWxlZEVSQzIwIGlzIEVSQzIwIHsKCXN0cmluZyBwdWJsaWMgbmFtZTsKCXN0cmluZyBwdWJsaWMgc3ltYm9sOwoJdWludDggcHVibGljIGRlY2ltYWxzOwoKCWZ1bmN0aW9uIERldGFpbGVkRVJDMjAoc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDggX2RlY2ltYWxzKSBwdWJsaWMgewoJCW5hbWUgPSBfbmFtZTsKCQlzeW1ib2wgPSBfc3ltYm9sOwoJCWRlY2ltYWxzID0gX2RlY2ltYWxzOwoJfQp9CgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCW1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCgkvKioKCSogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwoJKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgoJKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCgkqLwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCXJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCgkJLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgoJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CgkJYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgkJVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgoJKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KCSogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KCSovCglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewoJCXJldHVybiBiYWxhbmNlc1tfb3duZXJdOwoJfQoKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgoJbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwoKCgkvKioKCSAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgoJICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQoJICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCgkgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKCSAqLwoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQlyZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCQlyZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwoJCXJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCgkJYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwoJCWJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoJCWFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CgkJVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgoJICoKCSAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKCSAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKCSAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKCSAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CgkgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCgkgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgoJICovCglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCWFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwoJCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgoJICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgoJICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCgkgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCgkgKi8KCWZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwoJfQoKCS8qKgoJICogQGRldiBJbmNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgoJICoKCSAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAoJICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKCSAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKCSAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCgkgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCgkgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KCSAqLwoJZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCWFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKCQlBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgoJICoKCSAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAoJICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKCSAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKCSAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCgkgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCgkgKiBAcGFyYW0gX3N1YnRyYWN0ZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBkZWNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgoJICovCglmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQl1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CgkJaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewoJCQlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CgkJfSBlbHNlIHsKCQkJYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CgkJfQoJCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CgkJcmV0dXJuIHRydWU7Cgl9Cgp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CglhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgoJZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKCS8qKgoJICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCgkgKiBhY2NvdW50LgoJICovCglmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKCQlvd25lciA9IG1zZy5zZW5kZXI7Cgl9CgoKCS8qKgoJICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgoJICovCgltb2RpZmllciBvbmx5T3duZXIoKSB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKCQlfOwoJfQoKCgkvKioKCSAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCgkgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgoJICovCglmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKCQlyZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwoJCU93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CgkJb3duZXIgPSBuZXdPd25lcjsKCX0KCn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewoJZXZlbnQgUGF1c2UoKTsKCWV2ZW50IFVucGF1c2UoKTsKCglib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgoJLyoqCgkgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCgkgKi8KCW1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CgkJcmVxdWlyZSghcGF1c2VkKTsKCQlfOwoJfQoKCS8qKgoJICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCgkgKi8KCW1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CgkJcmVxdWlyZShwYXVzZWQpOwoJCV87Cgl9CgoJLyoqCgkgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKCSAqLwoJZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewoJCXBhdXNlZCA9IHRydWU7CgkJUGF1c2UoKTsKCX0KCgkvKioKCSAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQoJICovCglmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKCQlwYXVzZWQgPSBmYWxzZTsKCQlVbnBhdXNlKCk7Cgl9Cn0KCgoKCi8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKiBAZGV2IElzc3VlOiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvaXNzdWVzLzEyMAogKiBCYXNlZCBvbiBjb2RlIGJ5IFRva2VuTWFya2V0TmV0OiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAogKi8KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CglldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwoJZXZlbnQgTWludEZpbmlzaGVkKCk7CgoJYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgoKCW1vZGlmaWVyIGNhbk1pbnQoKSB7CgkJcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKCQlfOwoJfQoKCS8qKgoJICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwoJICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KCSAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCgkgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgoJICovCglmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CgkJdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CgkJYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwoJCU1pbnQoX3RvLCBfYW1vdW50KTsKCQlUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KCSAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgoJICovCglmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKCQltaW50aW5nRmluaXNoZWQgPSB0cnVlOwoJCU1pbnRGaW5pc2hlZCgpOwoJCXJldHVybiB0cnVlOwoJfQp9CgoKLyoqCiAqIEB0aXRsZSBDYXBwZWQgdG9rZW4KICogQGRldiBNaW50YWJsZSB0b2tlbiB3aXRoIGEgdG9rZW4gY2FwLgogKi8KCmNvbnRyYWN0IENhcHBlZFRva2VuIGlzIE1pbnRhYmxlVG9rZW4gewoKCXVpbnQyNTYgcHVibGljIGNhcDsKCglmdW5jdGlvbiBDYXBwZWRUb2tlbih1aW50MjU2IF9jYXApIHB1YmxpYyB7CgkJcmVxdWlyZShfY2FwID4gMCk7CgkJY2FwID0gX2NhcDsKCX0KCgkvKioKCSAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKCSAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCgkgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgoJICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KCSAqLwoJZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUodG90YWxTdXBwbHkuYWRkKF9hbW91bnQpIDw9IGNhcCk7CgoJCXJldHVybiBzdXBlci5taW50KF90bywgX2Ftb3VudCk7Cgl9Cgp9CgovKioKICogQHRpdGxlIEJ1cm5hYmxlIFRva2VuCiAqIEBkZXYgVG9rZW4gdGhhdCBjYW4gYmUgaXJyZXZlcnNpYmx5IGJ1cm5lZCAoZGVzdHJveWVkKS4KICovCmNvbnRyYWN0IEJ1cm5hYmxlVG9rZW4gaXMgQmFzaWNUb2tlbiB7CgoJZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgYnVybmVyLCB1aW50MjU2IHZhbHVlKTsKCgkvKioKCSAqIEBkZXYgQnVybnMgYSBzcGVjaWZpYyBhbW91bnQgb2YgdG9rZW5zLgoJICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIGJ1cm5lZC4KCSAqLwoJZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKCQlyZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgkJLy8gbm8gbmVlZCB0byByZXF1aXJlIHZhbHVlIDw9IHRvdGFsU3VwcGx5LCBzaW5jZSB0aGF0IHdvdWxkIGltcGx5IHRoZQoJCS8vIHNlbmRlcidzIGJhbGFuY2UgaXMgZ3JlYXRlciB0aGFuIHRoZSB0b3RhbFN1cHBseSwgd2hpY2ggKnNob3VsZCogYmUgYW4gYXNzZXJ0aW9uIGZhaWx1cmUKCgkJYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwoJCWJhbGFuY2VzW2J1cm5lcl0gPSBiYWxhbmNlc1tidXJuZXJdLnN1YihfdmFsdWUpOwoJCXRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CgkJQnVybihidXJuZXIsIF92YWx1ZSk7Cgl9Cn0KCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCWZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CgkJaWYgKGEgPT0gMCkgewoJCQlyZXR1cm4gMDsKCQl9CgkJdWludDI1NiBjID0gYSAqIGI7CgkJYXNzZXJ0KGMgLyBhID09IGIpOwoJCXJldHVybiBjOwoJfQoKCWZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CgkJLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCgkJdWludDI1NiBjID0gYSAvIGI7CgkJLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKCQlyZXR1cm4gYzsKCX0KCglmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCWFzc2VydChiIDw9IGEpOwoJCXJldHVybiBhIC0gYjsKCX0KCglmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCXVpbnQyNTYgYyA9IGEgKyBiOwoJCWFzc2VydChjID49IGEpOwoJCXJldHVybiBjOwoJfQp9CgoKCi8qKgogKiBAdGl0bGUgQ3Jvd2RzYWxlCiAqIEBkZXYgQ3Jvd2RzYWxlIGlzIGEgYmFzZSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCiAqIHRva2VuIHB1cmNoYXNlcyBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGFzc2lnbiB0aGVtIHRva2VucyBiYXNlZAogKiBvbiBhIHRva2VuIHBlciBFVEggcmF0ZS4gRnVuZHMgY29sbGVjdGVkIGFyZSBmb3J3YXJkZWQgdG8gYSB3YWxsZXQKICogYXMgdGhleSBhcnJpdmUuCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgewoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKCU1pbnRhYmxlVG9rZW4gcHVibGljIHRva2VuOwoKCS8vIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcyB3aGVyZSBpbnZlc3RtZW50cyBhcmUgYWxsb3dlZCAoYm90aCBpbmNsdXNpdmUpCgl1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7Cgl1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKCS8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAoJYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKCS8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCgl1aW50MjU2IHB1YmxpYyByYXRlOwoKCS8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCgl1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgoJLyoqCgkgKiBldmVudCBmb3IgdG9rZW4gcHVyY2hhc2UgbG9nZ2luZwoJICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwoJICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwoJICogQHBhcmFtIHZhbHVlIHdlaXMgcGFpZCBmb3IgcHVyY2hhc2UKCSAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKCSAqLwoJZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCgoJZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewoJCXJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwoJCXJlcXVpcmUoX2VuZFRpbWUgPj0gX3N0YXJ0VGltZSk7CgkJcmVxdWlyZShfcmF0ZSA+IDApOwoJCXJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKCgkJdG9rZW4gPSBjcmVhdGVUb2tlbkNvbnRyYWN0KCk7CgkJc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKCQllbmRUaW1lID0gX2VuZFRpbWU7CgkJcmF0ZSA9IF9yYXRlOwoJCXdhbGxldCA9IF93YWxsZXQ7Cgl9CgoJLy8gY3JlYXRlcyB0aGUgdG9rZW4gdG8gYmUgc29sZC4KCS8vIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgY3Jvd2RzYWxlIG9mIGEgc3BlY2lmaWMgbWludGFibGUgdG9rZW4uCglmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAoTWludGFibGVUb2tlbikgewoJCXJldHVybiBuZXcgTWludGFibGVUb2tlbigpOwoJfQoKCgkvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCglmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIHsKCQlidXlUb2tlbnMobXNnLnNlbmRlcik7Cgl9CgoJLy8gbG93IGxldmVsIHRva2VuIHB1cmNoYXNlIGZ1bmN0aW9uCglmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewoJCXJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CgkJcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKCQl1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCgkJLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCgkJdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKHJhdGUpOwoKCQkvLyB1cGRhdGUgc3RhdGUKCQl3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgoJCXRva2VuLm1pbnQoYmVuZWZpY2lhcnksIHRva2Vucyk7CgkJVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKCQlmb3J3YXJkRnVuZHMoKTsKCX0KCgkvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CgkvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCglmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CgkJd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7Cgl9CgoJLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwoJZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewoJCWJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKCQlib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwoJCXJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlOwoJfQoKCS8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCglmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gbm93ID4gZW5kVGltZTsKCX0KCgp9CgovKioKICogQHRpdGxlIENhcHBlZENyb3dkc2FsZQogKiBAZGV2IEV4dGVuc2lvbiBvZiBDcm93ZHNhbGUgd2l0aCBhIG1heCBhbW91bnQgb2YgZnVuZHMgcmFpc2VkCiAqLwpjb250cmFjdCBDYXBwZWRDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCXVpbnQyNTYgcHVibGljIGNhcDsKCglmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSBwdWJsaWMgewoJCXJlcXVpcmUoX2NhcCA+IDApOwoJCWNhcCA9IF9jYXA7Cgl9CgoJLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjdmFsaWRQdXJjaGFzZSB0byBhZGQgZXh0cmEgY2FwIGxvZ2ljCgkvLyBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3JzIGNhbiBidXkgYXQgdGhlIG1vbWVudAoJZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewoJCWJvb2wgd2l0aGluQ2FwID0gd2VpUmFpc2VkLmFkZChtc2cudmFsdWUpIDw9IGNhcDsKCQlyZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIHdpdGhpbkNhcDsKCX0KCgkvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNoYXNFbmRlZCB0byBhZGQgY2FwIGxvZ2ljCgkvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAoJZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CgkJYm9vbCBjYXBSZWFjaGVkID0gd2VpUmFpc2VkID49IGNhcDsKCQlyZXR1cm4gc3VwZXIuaGFzRW5kZWQoKSB8fCBjYXBSZWFjaGVkOwoJfQoKfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUgdG9rZW4KICoKICogQGRldiBTdGFuZGFyZFRva2VuIG1vZGlmaWVkIHdpdGggcGF1c2FibGUgdHJhbnNmZXJzLgogKiovCgpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7Cgl9CgoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewoJCXJldHVybiBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwoJfQoKCWZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKCX0KCglmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwoJfQp9Cgpjb250cmFjdCBCZnRUb2tlbiBpcyBEZXRhaWxlZEVSQzIwLCBDYXBwZWRUb2tlbiwgQnVybmFibGVUb2tlbiwgUGF1c2FibGVUb2tlbiB7CgoJQ2FwcGVkQ3Jvd2RzYWxlIHB1YmxpYyBjcm93ZHNhbGU7CgoJZnVuY3Rpb24gQmZ0VG9rZW4oCgkJdWludDI1NiBfdG9rZW5DYXAsCgkJdWludDggX2RlY2ltYWxzLAoJCUNhcHBlZENyb3dkc2FsZSBfY3Jvd2RzYWxlCgkpCglEZXRhaWxlZEVSQzIwKCJCRiBUb2tlbiIsICJCRlQiLCBfZGVjaW1hbHMpCglDYXBwZWRUb2tlbihfdG9rZW5DYXApIHB1YmxpYyB7CgoJCWNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gdGhlIGZvbGxvd2luZyBpcyB0aGUgZnVuY3Rpb25hbGl0eSB0byB1cGdyYWRlIHRoaXMgdG9rZW4gc21hcnQgY29udHJhY3QgdG8gYSBuZXcgb25lCgoJTWludGFibGVUb2tlbiBwdWJsaWMgbmV3VG9rZW4gPSBNaW50YWJsZVRva2VuKDB4MCk7CglldmVudCBMb2dSZWRlZW0oYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiBhbW91bnQpOwoKCW1vZGlmaWVyIGhhc1VwZ3JhZGUoKSB7CgkJcmVxdWlyZShuZXdUb2tlbiAhPSBNaW50YWJsZVRva2VuKDB4MCkpOwoJCV87Cgl9CgoJZnVuY3Rpb24gdXBncmFkZShNaW50YWJsZVRva2VuIF9uZXdUb2tlbikgb25seU93bmVyIHB1YmxpYyB7CgkJbmV3VG9rZW4gPSBfbmV3VG9rZW47Cgl9CgoJLy8gb3ZlcnJpZGluZyBCdXJuYWJsZVRva2VuI2J1cm4gdG8gbWFrZSBkaXNhYmxlIGl0IGZvciBwdWJsaWMgdXNlCglmdW5jdGlvbiBidXJuKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewoJCXJldmVydCgpOwoJCV92YWx1ZSA9IF92YWx1ZTsgLy8gdG8gc2lsZW5jZSBjb21waWxlciB3YXJuaW5nCgl9CgoJZnVuY3Rpb24gcmVkZWVtKCkgaGFzVXBncmFkZSBwdWJsaWMgewoKCQl2YXIgYmFsYW5jZSA9IGJhbGFuY2VPZihtc2cuc2VuZGVyKTsKCgkJLy8gYnVybiB0aGUgdG9rZW5zIGluIHRoaXMgdG9rZW4gc21hcnQgY29udHJhY3QKCQlzdXBlci5idXJuKGJhbGFuY2UpOwoKCQkvLyBtaW50IHRva2VucyBpbiB0aGUgbmV3IHRva2VuIHNtYXJ0IGNvbnRyYWN0CgkJcmVxdWlyZShuZXdUb2tlbi5taW50KG1zZy5zZW5kZXIsIGJhbGFuY2UpKTsKCQlMb2dSZWRlZW0obXNnLnNlbmRlciwgYmFsYW5jZSk7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gd2Ugb3ZlcnJpZGUgdGhlIHRva2VuIHRyYW5zZmVyIGZ1bmN0aW9ucyB0byBibG9jayB0cmFuc2ZlcnMgYmVmb3JlIHN0YXJ0VHJhbnNmZXJzRGF0ZSB0aW1lc3RhbXAKCgltb2RpZmllciBjYW5Eb1RyYW5zZmVycygpIHsKCQlyZXF1aXJlKGhhc0Nyb3dkc2FsZUZpbmlzaGVkKCkpOwoJCV87Cgl9CgoJZnVuY3Rpb24gaGFzQ3Jvd2RzYWxlRmluaXNoZWQoKSB2aWV3IHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKCQlyZXR1cm4gY3Jvd2RzYWxlLmhhc0VuZGVkKCk7Cgl9CgoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgY2FuRG9UcmFuc2ZlcnMgcmV0dXJucyAoYm9vbCkgewoJCXJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7Cgl9CgoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIGNhbkRvVHJhbnNmZXJzIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7Cgl9CgoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIGNhbkRvVHJhbnNmZXJzIHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKCX0KCglmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyBjYW5Eb1RyYW5zZmVycyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlyZXR1cm4gc3VwZXIuaW5jcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX2FkZGVkVmFsdWUpOwoJfQoKCWZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgY2FuRG9UcmFuc2ZlcnMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGZ1bmN0aW9uYWxpdHkgdG8gY2hhbmdlIHRoZSB0b2tlbiB0aWNrZXIgLSBpbiBjYXNlIG9mIGNvbmZsaWN0CgoJZnVuY3Rpb24gY2hhbmdlU3ltYm9sKHN0cmluZyBfc3ltYm9sKSBvbmx5T3duZXIgcHVibGljIHsKCQlzeW1ib2wgPSBfc3ltYm9sOwoJfQoKCWZ1bmN0aW9uIGNoYW5nZU5hbWUoc3RyaW5nIF9uYW1lKSBvbmx5T3duZXIgcHVibGljIHsKCQluYW1lID0gX25hbWU7Cgl9Cn0KCi8qKgogKiBAdGl0bGUgU2FmZUVSQzIwCiAqIEBkZXYgV3JhcHBlcnMgYXJvdW5kIEVSQzIwIG9wZXJhdGlvbnMgdGhhdCB0aHJvdyBvbiBmYWlsdXJlLgogKiBUbyB1c2UgdGhpcyBsaWJyYXJ5IHlvdSBjYW4gYWRkIGEgYHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjA7YCBzdGF0ZW1lbnQgdG8geW91ciBjb250cmFjdCwKICogd2hpY2ggYWxsb3dzIHlvdSB0byBjYWxsIHRoZSBzYWZlIG9wZXJhdGlvbnMgYXMgYHRva2VuLnNhZmVUcmFuc2ZlciguLi4pYCwgZXRjLgogKi8KbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKEVSQzIwIHRva2VuLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlQXBwcm92ZShFUkMyMCB0b2tlbiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSkpOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBUb2tlblRpbWVsb2NrCiAqIEBkZXYgVG9rZW5UaW1lbG9jayBpcyBhIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IHdpbGwgYWxsb3cgYQogKiBiZW5lZmljaWFyeSB0byBleHRyYWN0IHRoZSB0b2tlbnMgYWZ0ZXIgYSBnaXZlbiByZWxlYXNlIHRpbWUKICovCmNvbnRyYWN0IFRva2VuVGltZWxvY2sgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLy8gRVJDMjAgYmFzaWMgdG9rZW4gY29udHJhY3QgYmVpbmcgaGVsZAogIEVSQzIwQmFzaWMgcHVibGljIHRva2VuOwoKICAvLyBiZW5lZmljaWFyeSBvZiB0b2tlbnMgYWZ0ZXIgdGhleSBhcmUgcmVsZWFzZWQKICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKCiAgLy8gdGltZXN0YW1wIHdoZW4gdG9rZW4gcmVsZWFzZSBpcyBlbmFibGVkCiAgdWludDI1NiBwdWJsaWMgcmVsZWFzZVRpbWU7CgogIGZ1bmN0aW9uIFRva2VuVGltZWxvY2soRVJDMjBCYXNpYyBfdG9rZW4sIGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9yZWxlYXNlVGltZSkgcHVibGljIHsKICAgIHJlcXVpcmUoX3JlbGVhc2VUaW1lID4gbm93KTsKICAgIHRva2VuID0gX3Rva2VuOwogICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICByZWxlYXNlVGltZSA9IF9yZWxlYXNlVGltZTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHRva2VucyBoZWxkIGJ5IHRpbWVsb2NrIHRvIGJlbmVmaWNpYXJ5LgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoKSBwdWJsaWMgewogICAgcmVxdWlyZShub3cgPj0gcmVsZWFzZVRpbWUpOwoKICAgIHVpbnQyNTYgYW1vdW50ID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgcmVxdWlyZShhbW91bnQgPiAwKTsKCiAgICB0b2tlbi5zYWZlVHJhbnNmZXIoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgfQp9Cgpjb250cmFjdCBCZnRDcm93ZHNhbGUgaXMgQ2FwcGVkQ3Jvd2RzYWxlLCBQYXVzYWJsZSB7CgoJdWludDggcHVibGljIGNvbnN0YW50IHRva2VuRGVjaW1hbHMgPSAxODsKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IGV0aGVySW5XZWkgPSAxMCoqdWludDI1Nih0b2tlbkRlY2ltYWxzKTsKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuQ2FwID0gMTAwMDAwMDAwMCAqIGV0aGVySW5XZWk7CgoJdWludDI1NiBwdWJsaWMgU0FMRV9DQVBfVVNEOwoJdWludDI1NiBwdWJsaWMgQlVZRVJfQ0FQX0xPV19VU0Q7Cgl1aW50MjU2IHB1YmxpYyBCVVlFUl9DQVBfSElHSF9VU0Q7CgoJdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJJQ0VfTVVMVElQTElFUiA9IDEwMDsKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOU19QRVJfVVNEID0gMTA7CgoJdWludDI1NiBwdWJsaWMgZXRoZXJQcmljZSA9IFBSSUNFX01VTFRJUExJRVI7Cgl1aW50MjU2IHB1YmxpYyBidXllckNhcExvd0V0aGVyID0gZXRoZXJJbldlaTsKCXVpbnQyNTYgcHVibGljIGJ1eWVyQ2FwSGlnaEV0aGVyID0gZXRoZXJJbldlaTsKCXVpbnQyNTYgcHVibGljIHNhbGVIYXJkQ2FwRXRoZXIgPSBldGhlckluV2VpOwoJdWludDI1NiBwdWJsaWMgbWludFJhdGUgPSBUT0tFTlNfUEVSX1VTRDsKCglhZGRyZXNzIHB1YmxpYyBwcmVTYWxlQmZQbGF0Zm9ybTsKCWFkZHJlc3MgcHVibGljIGNvbXBhbnk7CglhZGRyZXNzIHB1YmxpYyByZXdhcmRQb29sOwoJYWRkcmVzcyBwdWJsaWMgc2hhcmVob2xkZXJzOwoJYWRkcmVzcyBwdWJsaWMgdG9rZW5TYWxlQ29zdHM7CgoJLy8gc21hcnQgY29udHJhY3RzIHRoYXQgd2lsbCBsb2NrIHRva2VucyBmb3IgYSBwcmUtZGVmaW5lZCB0aW1lCglUb2tlblRpbWVsb2NrIHB1YmxpYyBjb21wYW55SG9sZGluZzJ5OwoJVG9rZW5UaW1lbG9jayBwdWJsaWMgc2hhcmVob2xkZXJzSG9sZGluZzF5OwoKCS8vIGFkZHJlc3MgcGVybWlzc2lvbmVkIHRvIHdoaXRlbGlzdCBwdWJsaWMgc2FsZSBhZGRyZXNzZXMKCW1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSB3aGl0ZWxpc3Q7CgoJbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIG9wZXJhdG9yczsKCWV2ZW50IExvZ09wZXJhdG9yQWRkKGFkZHJlc3MgbmV3T3BlcmF0b3IpOwoJZXZlbnQgTG9nT3BlcmF0b3JSZW0oYWRkcmVzcyBuZXdPcGVyYXRvcik7CgoJbW9kaWZpZXIgb25seU9wZXJhdG9yKCkgewoJCXJlcXVpcmUob3BlcmF0b3JzW21zZy5zZW5kZXJdKTsKCQlfOwoJfQoKCW1vZGlmaWVyIG9ubHlXaGl0ZWxpc3RlZChhZGRyZXNzIF9hZGRyZXNzKSB7CgkJcmVxdWlyZSh3aGl0ZWxpc3RbX2FkZHJlc3NdKTsKCQlfOwoJfQoKCWZ1bmN0aW9uIEJmdENyb3dkc2FsZSgKCQl1aW50MjU2IF9zdGFydFRpbWUsCgkJdWludDI1NiBfZW5kVGltZSwKCQl1aW50MjU2IF9ldGhlclByaWNlLAoJCWFkZHJlc3MgX3dhbGxldCwKCgkvLyBhZGRyZXNzZXMgd2l0aCBwcmUtbWludGVkIHRva2VucwoJCWFkZHJlc3MgX3ByZVNhbGVCZlBsYXRmb3JtLAoJCWFkZHJlc3MgX2NvbXBhbnksCgkJYWRkcmVzcyBfcmV3YXJkUG9vbCwKCQlhZGRyZXNzIF9zaGFyZWhvbGRlcnMsCgkJYWRkcmVzcyBfdG9rZW5TYWxlQ29zdHMsCgoJLy8gb3duZXIgb2YgdGhlIHdoaXRlbGlzdCBmdW5jdGlvbgoJCWFkZHJlc3MgX29wZXJhdG9yLAoJCWFkZHJlc3MgX2FkbWluLAoKCQl1aW50MjU2IF9zYWxlQ2FwVXNkLAoJCXVpbnQyNTYgX2J1eWVyQ2FwTG93VXNkLAoJCXVpbnQyNTYgX2J1eWVyQ2FwSGlnaFVzZAoJKQoJQ2FwcGVkQ3Jvd2RzYWxlKHNhbGVIYXJkQ2FwRXRoZXIpCglDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIG1pbnRSYXRlLCBfd2FsbGV0KSBwdWJsaWMgewoKCQlyZXF1aXJlKF9wcmVTYWxlQmZQbGF0Zm9ybSAhPSBhZGRyZXNzKDB4MCkpOwoJCXJlcXVpcmUoX2NvbXBhbnkgIT0gYWRkcmVzcygweDApKTsKCQlyZXF1aXJlKF9yZXdhcmRQb29sICE9IGFkZHJlc3MoMHgwKSk7CgkJcmVxdWlyZShfc2hhcmVob2xkZXJzICE9IGFkZHJlc3MoMHgwKSk7CgkJcmVxdWlyZShfdG9rZW5TYWxlQ29zdHMgIT0gYWRkcmVzcygweDApKTsKCQlyZXF1aXJlKF9vcGVyYXRvciAhPSBhZGRyZXNzKDB4MCkpOwoKCQlTQUxFX0NBUF9VU0QgPSBfc2FsZUNhcFVzZDsKCQlCVVlFUl9DQVBfTE9XX1VTRCA9IF9idXllckNhcExvd1VzZDsKCQlCVVlFUl9DQVBfSElHSF9VU0QgPSBfYnV5ZXJDYXBIaWdoVXNkOwoKCQlwcmVTYWxlQmZQbGF0Zm9ybSA9IF9wcmVTYWxlQmZQbGF0Zm9ybTsKCQljb21wYW55ID0gX2NvbXBhbnk7CgkJcmV3YXJkUG9vbCA9IF9yZXdhcmRQb29sOwoJCXNoYXJlaG9sZGVycyA9IF9zaGFyZWhvbGRlcnM7CgkJdG9rZW5TYWxlQ29zdHMgPSBfdG9rZW5TYWxlQ29zdHM7CgoJCWFkZE9wZXJhdG9yKF9vcGVyYXRvcik7CgkJdXBkYXRlRXRoZXJQcmljZShfZXRoZXJQcmljZSk7CgkJY3JlYXRlSG9sZGluZ3MoKTsKCQlwcmVNaW50VG9rZW5zKCk7CgoJCS8vIHRyYW5zZmVyIG93bmVyc2hpcCB0aGUgdGhlIGFkbWluIG11bHRpLXNpZwoJCXRyYW5zZmVyT3duZXJzaGlwKF9hZG1pbik7Cgl9CgoJZnVuY3Rpb24gdXBkYXRlRXRoZXJQcmljZSh1aW50MjU2IF9wcmljZSkgb25seU93bmVyIHB1YmxpYyB7CgkJcmVxdWlyZShfcHJpY2UgPiAwKTsKCQlyZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CgoJCWV0aGVyUHJpY2UgPSBfcHJpY2U7CgkJYnV5ZXJDYXBMb3dFdGhlciA9IEJVWUVSX0NBUF9MT1dfVVNELm11bChldGhlckluV2VpKS5tdWwoUFJJQ0VfTVVMVElQTElFUikuZGl2KGV0aGVyUHJpY2UpOwoJCWJ1eWVyQ2FwSGlnaEV0aGVyID0gQlVZRVJfQ0FQX0hJR0hfVVNELm11bChldGhlckluV2VpKS5tdWwoUFJJQ0VfTVVMVElQTElFUikuZGl2KGV0aGVyUHJpY2UpOwoJCXNhbGVIYXJkQ2FwRXRoZXIgPSBTQUxFX0NBUF9VU0QubXVsKGV0aGVySW5XZWkpLm11bChQUklDRV9NVUxUSVBMSUVSKS5kaXYoZXRoZXJQcmljZSk7CgkJbWludFJhdGUgPSBUT0tFTlNfUEVSX1VTRC5tdWwoZXRoZXJQcmljZSkuZGl2KFBSSUNFX01VTFRJUExJRVIpOwoKCQkvLyB1cGRhdGUgdmFycyBvbiBwYXJlbnQgY29udHJhY3RzCgkJY2FwID0gc2FsZUhhcmRDYXBFdGhlcjsKCQlyYXRlID0gbWludFJhdGU7Cgl9CgoJZnVuY3Rpb24gY3JlYXRlSG9sZGluZ3MoKSBpbnRlcm5hbCB7CgkJY29tcGFueUhvbGRpbmcyeSA9IG5ldyBUb2tlblRpbWVsb2NrKHRva2VuLCBjb21wYW55LCBzdGFydFRpbWUrMiB5ZWFycyk7CgkJc2hhcmVob2xkZXJzSG9sZGluZzF5ID0gbmV3IFRva2VuVGltZWxvY2sodG9rZW4sIHNoYXJlaG9sZGVycywgc3RhcnRUaW1lKzEgeWVhcnMpOwoJfQoKCWZ1bmN0aW9uIHByZU1pbnRUb2tlbnMoKSBpbnRlcm5hbCB7CgkJdG9rZW4ubWludChwcmVTYWxlQmZQbGF0Zm9ybSwgMzAwMDAwMDAwICogZXRoZXJJbldlaSk7CgkJdG9rZW4ubWludChjb21wYW55SG9sZGluZzJ5LCAzMDAwMDAwMDAgKiBldGhlckluV2VpKTsKCQl0b2tlbi5taW50KHJld2FyZFBvb2wsIDIwMDAwMDAwMCAqIGV0aGVySW5XZWkpOwoJCXRva2VuLm1pbnQoc2hhcmVob2xkZXJzSG9sZGluZzF5LCAxMDAwMDAwMDAgKiBldGhlckluV2VpKTsKCQl0b2tlbi5taW50KHRva2VuU2FsZUNvc3RzLCA3MDAwMDAwMCAqIGV0aGVySW5XZWkpOwoJfQoKCWZ1bmN0aW9uIGNoZWNrU2FsZUVuZGVkKCkgaW50ZXJuYWwgewoJCS8vIGlmIG5vIGZ1cnRoZXIgcHVyY2hhc2VzIGFyZSBwb3NzaWJsZSBkdWUgdG8gbG93ZXIgYnV5ZXIgY2FwCgkJaWYoc2FsZUhhcmRDYXBFdGhlci5zdWIod2VpUmFpc2VkKSA8IGJ1eWVyQ2FwTG93RXRoZXIpIHsKCQkJdG9rZW4ubWludChyZXdhcmRQb29sLCB0b2tlbkNhcC5zdWIodG9rZW4udG90YWxTdXBwbHkoKSkpOwoJCX0KCX0KCgkvLyBvdmVycmlkaW5nIENhcHBlZENyb3dkc2FsZSN2YWxpZFB1cmNoYXNlIHRvIGFkZCBleHRyYSBsb3cvaGlnaCBsaW1pdHMgbG9naWMKCS8vIEByZXR1cm4gdHJ1ZSBpZiBpbnZlc3RvcnMgY2FuIGJ1eSBhdCB0aGUgbW9tZW50CglmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgd2hlbk5vdFBhdXNlZAoJaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJYm9vbCBhYm92ZUxvd0J1eWVyQ2FwID0gKG1zZy52YWx1ZSA+PSBidXllckNhcExvd0V0aGVyKTsKCQlib29sIHVuZGVyTWF4QnV5ZXJDYXAgPSAobXNnLnZhbHVlIDw9IGJ1eWVyQ2FwSGlnaEV0aGVyKTsKCQlyZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIGFib3ZlTG93QnV5ZXJDYXAgJiYgdW5kZXJNYXhCdXllckNhcDsKCX0KCgkvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNoYXNFbmRlZCB0byBhZGQgdG9rZW4gY2FwIGxvZ2ljCgkvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAoJZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CgkJYm9vbCB0b2tlbkNhcFJlYWNoZWQgPSB0b2tlbi50b3RhbFN1cHBseSgpID09IHRva2VuQ2FwOwoJCXJldHVybiBzdXBlci5oYXNFbmRlZCgpIHx8IHRva2VuQ2FwUmVhY2hlZDsKCX0KCglmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkKCW9ubHlXaGl0ZWxpc3RlZChiZW5lZmljaWFyeSkKCXdoZW5Ob3RQYXVzZWQKCXB1YmxpYyBwYXlhYmxlIHsKCQlyZXF1aXJlKHRva2VuLmJhbGFuY2VPZihiZW5lZmljaWFyeSk9PTApOwoJCXN1cGVyLmJ1eVRva2VucyhiZW5lZmljaWFyeSk7CgkJY2hlY2tTYWxlRW5kZWQoKTsKCX0KCgkvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgoJLy8gb3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8gaGF2ZSBjcm93ZHNhbGUgb2YgYSBzcGVjaWZpYyBtaW50YWJsZSB0b2tlbi4KCWZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CgkJcmV0dXJuIG5ldyBCZnRUb2tlbih0b2tlbkNhcCwgdG9rZW5EZWNpbWFscywgdGhpcyk7Cgl9CgoJZnVuY3Rpb24gYWRkV2hpdGVsaXN0KGFkZHJlc3NbXSBiZW5lZmljaWFyaWVzKSBvbmx5T3BlcmF0b3IgcHVibGljIHsKCQlmb3IgKHVpbnQgaSA9IDA7IGkgPCBiZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKSB7CgkJCXdoaXRlbGlzdFtiZW5lZmljaWFyaWVzW2ldXSA9IHRydWU7CgkJfQoJfQoKCWZ1bmN0aW9uIHJlbVdoaXRlbGlzdChhZGRyZXNzW10gYmVuZWZpY2lhcmllcykgb25seU9wZXJhdG9yIHB1YmxpYyB7CgkJZm9yICh1aW50IGkgPSAwOyBpIDwgYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewoJCQl3aGl0ZWxpc3RbYmVuZWZpY2lhcmllc1tpXV0gPSBmYWxzZTsKCQl9Cgl9CgoJZnVuY3Rpb24gaXNXaGl0ZWxpc3RlZChhZGRyZXNzIGJlbmVmaWNpYXJ5KSB2aWV3IHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKCQlyZXR1cm4gd2hpdGVsaXN0W2JlbmVmaWNpYXJ5XTsKCX0KCglmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIF9vcGVyYXRvcikgb25seU93bmVyIHB1YmxpYyB7CgkJb3BlcmF0b3JzW19vcGVyYXRvcl0gPSB0cnVlOwoJCUxvZ09wZXJhdG9yQWRkKF9vcGVyYXRvcik7Cgl9CgoJZnVuY3Rpb24gcmVtT3BlcmF0b3IoYWRkcmVzcyBfb3BlcmF0b3IpIG9ubHlPd25lciBwdWJsaWMgewoJCW9wZXJhdG9yc1tfb3BlcmF0b3JdID0gZmFsc2U7CgkJTG9nT3BlcmF0b3JBZGQoX29wZXJhdG9yKTsKCX0KCglmdW5jdGlvbiBpc09wZXJhdG9yKGFkZHJlc3MgX29wZXJhdG9yKSB2aWV3IHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKCQlyZXR1cm4gb3BlcmF0b3JzW19vcGVyYXRvcl07Cgl9CgoJZnVuY3Rpb24gdHJhbnNmZXJUb2tlbk93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CgkJLy8gb25seSBhbGxvdyB0cmFuc2ZlciBhdCB0aGUgZW5kIG9mIHRoZSBzYWxlCgkJcmVxdWlyZShoYXNFbmRlZCgpKTsKCQkvLyBzdG9wIHRoZSBtaW50aW5nIHByb2Nlc3Mgb24gdGhlIHRva2VuIGFzIHdlIG9ubHkgYWxsb3cgdGhlIGNyb3dkc2FsZSB0byBtaW50CgkJdG9rZW4uZmluaXNoTWludGluZygpOwoJCXRva2VuLnRyYW5zZmVyT3duZXJzaGlwKF9uZXdPd25lcik7Cgl9Cn0='.
	

]
