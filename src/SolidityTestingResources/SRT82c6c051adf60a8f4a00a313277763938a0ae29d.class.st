Class {
	#name : #SRT82c6c051adf60a8f4a00a313277763938a0ae29d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT82c6c051adf60a8f4a00a313277763938a0ae29d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBjb3B5cmlnaHQgPGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjE4N2I3Nzc2NmM3OTdiNmM1ODdkNmM3MDdkNmE3YjcwN2Q2OTZkN2QzNjdiNzc3NSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4KCmNvbnRyYWN0IEV0aGVyQ2hlcXVlIHsKICAgIGVudW0gU3RhdHVzIHsgTk9ORSwgQ1JFQVRFRCwgTE9DS0VELCBFWFBJUkVEIH0KICAgIGVudW0gUmVzdWx0Q29kZSB7IAogICAgICAgIFNVQ0NFU1MsCiAgICAgICAgRVJST1JfTUFYLAogICAgICAgIEVSUk9SX01JTiwKICAgICAgICBFUlJPUl9FWElTVCwKICAgICAgICBFUlJPUl9OT1RfRVhJU1QsCiAgICAgICAgRVJST1JfSU5WQUxJRF9TVEFUVVMsCiAgICAgICAgRVJST1JfTE9DS0VELAogICAgICAgIEVSUk9SX0VYUElSRUQsCiAgICAgICAgRVJST1JfSU5WQUxJRF9BTU9VTlQKICAgIH0KICAgIHN0cnVjdCBDaGVxdWUgewogICAgICAgIGJ5dGVzMzIgcGluSGFzaDsgLy8gd2Ugb25seSBzYXZlIHNoYTMgb2YgY2hlcXVlIHNpZ25hdHVyZQogICAgICAgIGFkZHJlc3MgY3JlYXRvcjsKICAgICAgICBTdGF0dXMgc3RhdHVzOwogICAgICAgIHVpbnQgdmFsdWU7CiAgICAgICAgdWludCBjcmVhdGVUaW1lOwogICAgICAgIHVpbnQgZXhwaXJpbmdQZXJpb2Q7IC8vIGluIHNlY29uZHMgLSBvcHRpb25hbCwgMCBtZWFuIG5vIGV4cGlyZQogICAgICAgIHVpbnQ4IGF0dGVtcHQ7IC8vIGN1cnJlbnQgYXR0ZW1wdCBhY2NvdW50IHRvIGNhc2ggdGhlIGNoZXF1ZQogICAgfQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzW10gcHVibGljIG1vZGVyYXRvcnM7CiAgICB1aW50IHB1YmxpYyB0b3RhbENoZXF1ZSA9IDA7CiAgICB1aW50IHB1YmxpYyB0b3RhbENoZXF1ZVZhbHVlID0gMDsKICAgIHVpbnQgcHVibGljIHRvdGFsUmVkZWVtZWRDaGVxdWUgPSAwOwogICAgdWludCBwdWJsaWMgdG90YWxSZWRlZW1lZFZhbHVlID0gMDsKICAgIHVpbnQgcHVibGljIGNvbW1pc3Npb25GZWUgPSAxMDsgLy8gZGl2IDEwMDAKICAgIHVpbnQgcHVibGljIG1pbkNoZXF1ZVZhbHVlID0gMC4wMSBldGhlcjsKICAgIHVpbnQgcHVibGljIG1heENoZXF1ZVZhbHVlID0gMDsgLy8gb3B0aW9uYWwsIDAgbWVhbiBubyBsaW1pdAogICAgdWludDggcHVibGljIG1heEF0dGVtcHQgPSAzOwogICAgYm9vbCBwdWJsaWMgaXNNYWludGFpbmluZyA9IGZhbHNlOwogICAgCiAgICAvLyBoYXNoIGNoZXF1ZSBubyAtPiBDaGVxdWUgaW5mbwogICAgbWFwcGluZyhieXRlczMyID0+IENoZXF1ZSkgaXRlbXM7CgogICAgLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlzQWN0aXZlIHsKICAgICAgICBpZihpc01haW50YWluaW5nID09IHRydWUpIHRocm93OwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlNb2RlcmF0b3JzKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgIGJvb2wgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yICh1aW50IGluZGV4ID0gMDsgaW5kZXggPCBtb2RlcmF0b3JzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgaWYgKG1vZGVyYXRvcnNbaW5kZXhdID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFmb3VuZCkgdGhyb3c7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEV0aGVyQ2hlcXVlKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLyBldmVudAogICAgZXZlbnQgTG9nQ3JlYXRlKGJ5dGVzMzIgaW5kZXhlZCBjaGVxdWVJZEhhc2gsIHVpbnQgcmVzdWx0LCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMb2dSZWRlZW0oYnl0ZXMzMiBpbmRleGVkIGNoZXF1ZUlkSGFzaCwgUmVzdWx0Q29kZSByZXN1bHQsIHVpbnQgYW1vdW50LCBhZGRyZXNzIHJlY2VpdmVyKTsKICAgIGV2ZW50IExvZ1dpdGhkcmF3RXRoZXIoYWRkcmVzcyBpbmRleGVkIHNlbmRUbywgUmVzdWx0Q29kZSByZXN1bHQsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExvZ1JlZnVuZENoZXF1ZShieXRlczMyIGluZGV4ZWQgY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlIHJlc3VsdCk7CiAgICAKICAgIC8vIG93bmVyIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBDaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBvd25lciA9IF9uZXdPd25lcjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gS2lsbCgpIG9ubHlPd25lciB7CiAgICAgICAgc3VpY2lkZShvd25lcik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEFkZE1vZGVyYXRvcihhZGRyZXNzIF9uZXdNb2RlcmF0b3IpIG9ubHlPd25lciB7CiAgICAgICAgZm9yICh1aW50IGluZGV4ID0gMDsgaW5kZXggPCBtb2RlcmF0b3JzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBpZiAobW9kZXJhdG9yc1tpbmRleF0gPT0gX25ld01vZGVyYXRvcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG1vZGVyYXRvcnMucHVzaChfbmV3TW9kZXJhdG9yKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gUmVtb3ZlTW9kZXJhdG9yKGFkZHJlc3MgX29sZE1vZGVyYXRvcikgb25seU93bmVyIHsKICAgICAgICB1aW50IGZvdW5kSW5kZXggPSAwOwogICAgICAgIGZvciAoOyBmb3VuZEluZGV4IDwgbW9kZXJhdG9ycy5sZW5ndGg7IGZvdW5kSW5kZXgrKykgewogICAgICAgICAgICBpZiAobW9kZXJhdG9yc1tmb3VuZEluZGV4XSA9PSBfb2xkTW9kZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZm91bmRJbmRleCA8IG1vZGVyYXRvcnMubGVuZ3RoKQogICAgICAgIHsKICAgICAgICAgICAgbW9kZXJhdG9yc1tmb3VuZEluZGV4XSA9IG1vZGVyYXRvcnNbbW9kZXJhdG9ycy5sZW5ndGgtMV07CiAgICAgICAgICAgIGRlbGV0ZSBtb2RlcmF0b3JzW21vZGVyYXRvcnMubGVuZ3RoLTFdOwogICAgICAgICAgICBtb2RlcmF0b3JzLmxlbmd0aC0tOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gbW9kZXJhdG9yIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBTZXRDb21taXNzaW9uVmFsdWUodWludCBfY29tbWlzc2lvbkZlZSkgb25seU1vZGVyYXRvcnMgewogICAgICAgIGNvbW1pc3Npb25GZWUgPSBfY29tbWlzc2lvbkZlZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gU2V0TWluQ2hlcXVlVmFsdWUodWludCBfbWluQ2hlcXVlVmFsdWUpIG9ubHlNb2RlcmF0b3JzIHsKICAgICAgICBtaW5DaGVxdWVWYWx1ZSA9IF9taW5DaGVxdWVWYWx1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gU2V0TWF4Q2hlcXVlVmFsdWUodWludCBfbWF4Q2hlcXVlVmFsdWUpIG9ubHlNb2RlcmF0b3JzIHsKICAgICAgICBtYXhDaGVxdWVWYWx1ZSA9IF9tYXhDaGVxdWVWYWx1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gU2V0TWF4QXR0ZW1wdCh1aW50OCBfbWF4QXR0ZW1wdCkgb25seU1vZGVyYXRvcnMgewogICAgICAgIG1heEF0dGVtcHQgPSBfbWF4QXR0ZW1wdDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gVXBkYXRlTWFpbnRlbmFuY2UoYm9vbCBfaXNNYWludGFpbmluZykgb25seU1vZGVyYXRvcnMgewogICAgICAgIGlzTWFpbnRhaW5pbmcgPSBfaXNNYWludGFpbmluZzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gV2l0aGRyYXdFdGhlcihhZGRyZXNzIF9zZW5kVG8sIHVpbnQgX2Ftb3VudCkgb25seU1vZGVyYXRvcnMgcmV0dXJucyhSZXN1bHRDb2RlKSB7CiAgICAgICAgLy8gY2FuIG9ubHkgY2FuIHdpdGhkcmF3IHByb2ZpdCAtIHVuYWJsZSB0byB3aXRoZHJhdyBjaGVxdWUgdmFsdWUKICAgICAgICB1aW50IGN1cnJlbnRQcm9maXQgPSB0aGlzLmJhbGFuY2UgLSAodG90YWxDaGVxdWVWYWx1ZSAtIHRvdGFsUmVkZWVtZWRWYWx1ZSk7CiAgICAgICAgaWYgKF9hbW91bnQgPiBjdXJyZW50UHJvZml0KSB7CiAgICAgICAgICAgIExvZ1dpdGhkcmF3RXRoZXIoX3NlbmRUbywgUmVzdWx0Q29kZS5FUlJPUl9JTlZBTElEX0FNT1VOVCwgMCk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfQU1PVU5UOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBfc2VuZFRvLnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIExvZ1dpdGhkcmF3RXRoZXIoX3NlbmRUbywgUmVzdWx0Q29kZS5TVUNDRVNTLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5TVUNDRVNTOwogICAgfQogICAgCiAgICAvLyBvbmx5IHdoZW4gY3JlYXRvciB3YW50cyB0byBnZXQgdGhlIG1vbmV5IGJhY2sKICAgIC8vIG9ubHkgY2FuIHJlZnVuZCBiYWNrIHRvIGNyZWF0b3IKICAgIGZ1bmN0aW9uIFJlZnVuZENoZXF1ZUJ5SWQoc3RyaW5nIF9jaGVxdWVJZCkgb25seU1vZGVyYXRvcnMgcmV0dXJucyhSZXN1bHRDb2RlKSB7CiAgICAgICAgYnl0ZXMzMiBoYXNoQ2hlcXVlSWQgPSBzaGEzKF9jaGVxdWVJZCk7CiAgICAgICAgQ2hlcXVlIGNoZXF1ZSA9IGl0ZW1zW2hhc2hDaGVxdWVJZF07CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLk5PTkUpIHsKICAgICAgICAgICAgTG9nUmVmdW5kQ2hlcXVlKGhhc2hDaGVxdWVJZCwgUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1QpOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1Q7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRvdGFsUmVkZWVtZWRDaGVxdWUgKz0gMTsKICAgICAgICB0b3RhbFJlZGVlbWVkVmFsdWUgKz0gY2hlcXVlLnZhbHVlOwogICAgICAgIHVpbnQgc2VuZEFtb3VudCA9IGNoZXF1ZS52YWx1ZTsKICAgICAgICBkZWxldGUgaXRlbXNbaGFzaENoZXF1ZUlkXTsKICAgICAgICBjaGVxdWUuY3JlYXRvci50cmFuc2ZlcihzZW5kQW1vdW50KTsKICAgICAgICBMb2dSZWZ1bmRDaGVxdWUoaGFzaENoZXF1ZUlkLCBSZXN1bHRDb2RlLlNVQ0NFU1MpOwogICAgICAgIHJldHVybiBSZXN1bHRDb2RlLlNVQ0NFU1M7CiAgICB9CgogICAgZnVuY3Rpb24gUmVmdW5kQ2hlcXVlQnlIYXNoKHVpbnQyNTYgX2NoZXF1ZUlkSGFzaCkgb25seU1vZGVyYXRvcnMgcmV0dXJucyhSZXN1bHRDb2RlKSB7CiAgICAgICAgYnl0ZXMzMiBoYXNoQ2hlcXVlSWQgPSBieXRlczMyKF9jaGVxdWVJZEhhc2gpOwogICAgICAgIENoZXF1ZSBjaGVxdWUgPSBpdGVtc1toYXNoQ2hlcXVlSWRdOwogICAgICAgIGlmIChjaGVxdWUuc3RhdHVzID09IFN0YXR1cy5OT05FKSB7CiAgICAgICAgICAgIExvZ1JlZnVuZENoZXF1ZShoYXNoQ2hlcXVlSWQsIFJlc3VsdENvZGUuRVJST1JfTk9UX0VYSVNUKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfTk9UX0VYSVNUOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0b3RhbFJlZGVlbWVkQ2hlcXVlICs9IDE7CiAgICAgICAgdG90YWxSZWRlZW1lZFZhbHVlICs9IGNoZXF1ZS52YWx1ZTsKICAgICAgICB1aW50IHNlbmRBbW91bnQgPSBjaGVxdWUudmFsdWU7CiAgICAgICAgZGVsZXRlIGl0ZW1zW2hhc2hDaGVxdWVJZF07CiAgICAgICAgY2hlcXVlLmNyZWF0b3IudHJhbnNmZXIoc2VuZEFtb3VudCk7CiAgICAgICAgTG9nUmVmdW5kQ2hlcXVlKGhhc2hDaGVxdWVJZCwgUmVzdWx0Q29kZS5TVUNDRVNTKTsKICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5TVUNDRVNTOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldENoZXF1ZUluZm9CeUhhc2godWludDI1NiBfY2hlcXVlSWRIYXNoKSBvbmx5TW9kZXJhdG9ycyBjb25zdGFudCByZXR1cm5zKFN0YXR1cywgdWludCwgdWludCwgdWludCkgewogICAgICAgIGJ5dGVzMzIgaGFzaENoZXF1ZUlkID0gYnl0ZXMzMihfY2hlcXVlSWRIYXNoKTsKICAgICAgICBDaGVxdWUgY2hlcXVlID0gaXRlbXNbaGFzaENoZXF1ZUlkXTsKICAgICAgICBpZiAoY2hlcXVlLnN0YXR1cyA9PSBTdGF0dXMuTk9ORSkgCiAgICAgICAgICAgIHJldHVybiAoU3RhdHVzLk5PTkUsIDAsIDAsIDApOwoKICAgICAgICBpZiAoY2hlcXVlLmV4cGlyaW5nUGVyaW9kID4gMCkgewogICAgICAgICAgICB1aW50IHRpbWVHYXAgPSBub3c7CiAgICAgICAgICAgIGlmICh0aW1lR2FwID4gY2hlcXVlLmNyZWF0ZVRpbWUpCiAgICAgICAgICAgICAgICB0aW1lR2FwID0gdGltZUdhcCAtIGNoZXF1ZS5jcmVhdGVUaW1lOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0aW1lR2FwID0gMDsKCiAgICAgICAgICAgIGlmIChjaGVxdWUuZXhwaXJpbmdQZXJpb2QgPiB0aW1lR2FwKQogICAgICAgICAgICAgICAgcmV0dXJuIChjaGVxdWUuc3RhdHVzLCBjaGVxdWUudmFsdWUsIGNoZXF1ZS5hdHRlbXB0LCBjaGVxdWUuZXhwaXJpbmdQZXJpb2QgLSB0aW1lR2FwKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIChTdGF0dXMuRVhQSVJFRCwgY2hlcXVlLnZhbHVlLCBjaGVxdWUuYXR0ZW1wdCwgMCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoY2hlcXVlLnN0YXR1cywgY2hlcXVlLnZhbHVlLCBjaGVxdWUuYXR0ZW1wdCwgMCk7CiAgICB9CgogICAgZnVuY3Rpb24gVmVyaWZ5Q2hlcXVlKHN0cmluZyBfY2hlcXVlSWQsIHN0cmluZyBfcGluKSBvbmx5TW9kZXJhdG9ycyBjb25zdGFudCByZXR1cm5zKFJlc3VsdENvZGUsIFN0YXR1cywgdWludCwgdWludCwgdWludCkgewogICAgICAgIGJ5dGVzMzIgY2hlcXVlSWRIYXNoID0gc2hhMyhfY2hlcXVlSWQpOwogICAgICAgIENoZXF1ZSBjaGVxdWUgPSBpdGVtc1tjaGVxdWVJZEhhc2hdOwogICAgICAgIGlmIChjaGVxdWUuc3RhdHVzID09IFN0YXR1cy5OT05FKSB7CiAgICAgICAgICAgIHJldHVybiAoUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1QsIFN0YXR1cy5OT05FLCAwLCAwLCAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoZXF1ZS5waW5IYXNoICE9IHNoYTMoX2NoZXF1ZUlkLCBfcGluKSkgewogICAgICAgICAgICByZXR1cm4gKFJlc3VsdENvZGUuRVJST1JfSU5WQUxJRF9TVEFUVVMsIFN0YXR1cy5OT05FLCAwLCAwLCAwKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChSZXN1bHRDb2RlLlNVQ0NFU1MsIGNoZXF1ZS5zdGF0dXMsIGNoZXF1ZS52YWx1ZSwgY2hlcXVlLmF0dGVtcHQsIDApOwogICAgfQogICAgCiAgICAvLyBjb25zdGFudCBmdW5jdGlvbgogICAgZnVuY3Rpb24gR2V0Q2hlcXVlSW5mbyhzdHJpbmcgX2NoZXF1ZUlkKSBjb25zdGFudCByZXR1cm5zKFN0YXR1cywgdWludCwgdWludCwgdWludCkgewogICAgICAgIGJ5dGVzMzIgaGFzaENoZXF1ZUlkID0gc2hhMyhfY2hlcXVlSWQpOwogICAgICAgIENoZXF1ZSBjaGVxdWUgPSBpdGVtc1toYXNoQ2hlcXVlSWRdOwogICAgICAgIGlmIChjaGVxdWUuc3RhdHVzID09IFN0YXR1cy5OT05FKSAKICAgICAgICAgICAgcmV0dXJuIChTdGF0dXMuTk9ORSwgMCwgMCwgMCk7CgogICAgICAgIGlmIChjaGVxdWUuZXhwaXJpbmdQZXJpb2QgPiAwKSB7CiAgICAgICAgICAgIHVpbnQgdGltZUdhcCA9IG5vdzsKICAgICAgICAgICAgaWYgKHRpbWVHYXAgPiBjaGVxdWUuY3JlYXRlVGltZSkKICAgICAgICAgICAgICAgIHRpbWVHYXAgPSB0aW1lR2FwIC0gY2hlcXVlLmNyZWF0ZVRpbWU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRpbWVHYXAgPSAwOwoKICAgICAgICAgICAgaWYgKGNoZXF1ZS5leHBpcmluZ1BlcmlvZCA+IHRpbWVHYXApCiAgICAgICAgICAgICAgICByZXR1cm4gKGNoZXF1ZS5zdGF0dXMsIGNoZXF1ZS52YWx1ZSwgY2hlcXVlLmF0dGVtcHQsIGNoZXF1ZS5leHBpcmluZ1BlcmlvZCAtIHRpbWVHYXApOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gKFN0YXR1cy5FWFBJUkVELCBjaGVxdWUudmFsdWUsIGNoZXF1ZS5hdHRlbXB0LCAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChjaGVxdWUuc3RhdHVzLCBjaGVxdWUudmFsdWUsIGNoZXF1ZS5hdHRlbXB0LCAwKTsKICAgIH0KICAgIAogICAgLy8gdHJhbnNhY3Rpb24KICAgIGZ1bmN0aW9uIENyZWF0ZSh1aW50MjU2IF9jaGVxdWVJZEhhc2gsIHVpbnQyNTYgX3Bpbkhhc2gsIHVpbnQzMiBfZXhwaXJpbmdQZXJpb2QpIHBheWFibGUgaXNBY3RpdmUgcmV0dXJucyhSZXN1bHRDb2RlKSB7CiAgICAgICAgLy8gY29uZGl0aW9uOiAKICAgICAgICAvLyAxLiBjaGVjayBtaW4gdmFsdWUKICAgICAgICAvLyAyLiBjaGVjayBfY2hlcXVlSWQgZXhpc3Qgb3Igbm90CiAgICAgICAgYnl0ZXMzMiBjaGVxdWVJZEhhc2ggPSBieXRlczMyKF9jaGVxdWVJZEhhc2gpOwogICAgICAgIGJ5dGVzMzIgcGluSGFzaCA9IGJ5dGVzMzIoX3Bpbkhhc2gpOwogICAgICAgIHVpbnQgY2hlcXVlVmFsdWUgPSAwOwogICAgICAgIGlmIChtc2cudmFsdWUgPCBtaW5DaGVxdWVWYWx1ZSkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIExvZ0NyZWF0ZShjaGVxdWVJZEhhc2gsIHVpbnQoUmVzdWx0Q29kZS5FUlJPUl9NSU4pLCBjaGVxdWVWYWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX01JTjsKICAgICAgICB9CiAgICAgICAgaWYgKG1heENoZXF1ZVZhbHVlID4gMCAmJiBtc2cudmFsdWUgPiBtYXhDaGVxdWVWYWx1ZSkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIExvZ0NyZWF0ZShjaGVxdWVJZEhhc2gsIHVpbnQoUmVzdWx0Q29kZS5FUlJPUl9NQVgpLCBjaGVxdWVWYWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX01BWDsKICAgICAgICB9CiAgICAgICAgaWYgKGl0ZW1zW2NoZXF1ZUlkSGFzaF0uc3RhdHVzICE9IFN0YXR1cy5OT05FKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgICAgICAgICAgTG9nQ3JlYXRlKGNoZXF1ZUlkSGFzaCwgdWludChSZXN1bHRDb2RlLkVSUk9SX0VYSVNUKSwgY2hlcXVlVmFsdWUpOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9FWElTVDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gZGVkdWN0IGNvbW1pc3Npb24KICAgICAgICBjaGVxdWVWYWx1ZSA9IChtc2cudmFsdWUgLyAxMDAwKSAqICgxMDAwIC0gY29tbWlzc2lvbkZlZSk7CiAgICAgICAgdG90YWxDaGVxdWUgKz0gMTsKICAgICAgICB0b3RhbENoZXF1ZVZhbHVlICs9IGNoZXF1ZVZhbHVlOwogICAgICAgIGl0ZW1zW2NoZXF1ZUlkSGFzaF0gPSBDaGVxdWUoewogICAgICAgICAgICBwaW5IYXNoOiBwaW5IYXNoLAogICAgICAgICAgICBjcmVhdG9yOiBtc2cuc2VuZGVyLAogICAgICAgICAgICBzdGF0dXM6IFN0YXR1cy5DUkVBVEVELAogICAgICAgICAgICB2YWx1ZTogY2hlcXVlVmFsdWUsCiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IG5vdywKICAgICAgICAgICAgZXhwaXJpbmdQZXJpb2Q6IF9leHBpcmluZ1BlcmlvZCwKICAgICAgICAgICAgYXR0ZW1wdDogMAogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIExvZ0NyZWF0ZShjaGVxdWVJZEhhc2gsIHVpbnQoUmVzdWx0Q29kZS5TVUNDRVNTKSwgY2hlcXVlVmFsdWUpOwogICAgICAgIHJldHVybiBSZXN1bHRDb2RlLlNVQ0NFU1M7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFJlZGVlbShzdHJpbmcgX2NoZXF1ZUlkLCBzdHJpbmcgX3BpbiwgYWRkcmVzcyBfc2VuZFRvKSBwYXlhYmxlIHJldHVybnMgKFJlc3VsdENvZGUpewogICAgICAgIC8vIGNvbmRpdGlvbgogICAgICAgIC8vIDEuIGNoZXF1ZSBzdGF0dXMgbXVzdCBleGlzdAogICAgICAgIC8vIDIuIGNoZXF1ZSBzdGF0dXMgbXVzdCBiZSBDUkVBVEVEIHN0YXR1cyBmb3Igbm9uLWNyZWF0b3IKICAgICAgICAvLyAzLiB2ZXJpZnkgYXR0ZW1wdCBhbmQgZXhwaXJ5IHRpbWUgZm9yIG5vbi1jcmVhdG9yCiAgICAgICAgYnl0ZXMzMiBjaGVxdWVJZEhhc2ggPSBzaGEzKF9jaGVxdWVJZCk7CiAgICAgICAgQ2hlcXVlIGNoZXF1ZSA9IGl0ZW1zW2NoZXF1ZUlkSGFzaF07CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLk5PTkUpIHsKICAgICAgICAgICAgTG9nUmVkZWVtKGNoZXF1ZUlkSGFzaCwgUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1QsIDAsIF9zZW5kVG8pOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1Q7CiAgICAgICAgfQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNoZXF1ZS5jcmVhdG9yKSB7CiAgICAgICAgICAgIGlmIChjaGVxdWUuc3RhdHVzICE9IFN0YXR1cy5DUkVBVEVEKSB7CiAgICAgICAgICAgICAgICBMb2dSZWRlZW0oY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfU1RBVFVTLCAwLCBfc2VuZFRvKTsKICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfU1RBVFVTOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGVxdWUuYXR0ZW1wdCA+IG1heEF0dGVtcHQpIHsKICAgICAgICAgICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuRVJST1JfTE9DS0VELCAwLCBfc2VuZFRvKTsKICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0xPQ0tFRDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2hlcXVlLmV4cGlyaW5nUGVyaW9kID4gMCAmJiBub3cgPiAoY2hlcXVlLmNyZWF0ZVRpbWUgKyBjaGVxdWUuZXhwaXJpbmdQZXJpb2QpKSB7CiAgICAgICAgICAgICAgICBMb2dSZWRlZW0oY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlLkVSUk9SX0VYUElSRUQsIDAsIF9zZW5kVG8pOwogICAgICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfRVhQSVJFRDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjaGVjayBwaW4KICAgICAgICBpZiAoY2hlcXVlLnBpbkhhc2ggIT0gc2hhMyhfY2hlcXVlSWQsIF9waW4pKSB7CiAgICAgICAgICAgIGNoZXF1ZS5hdHRlbXB0ICs9IDE7CiAgICAgICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuRVJST1JfSU5WQUxJRF9TVEFUVVMsIDAsIF9zZW5kVG8pOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9JTlZBTElEX1NUQVRVUzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdG90YWxSZWRlZW1lZENoZXF1ZSArPSAxOwogICAgICAgIHRvdGFsUmVkZWVtZWRWYWx1ZSArPSBjaGVxdWUudmFsdWU7CiAgICAgICAgdWludCBzZW5kTW91bnQgPSBjaGVxdWUudmFsdWU7CiAgICAgICAgZGVsZXRlIGl0ZW1zW2NoZXF1ZUlkSGFzaF07CiAgICAgICAgX3NlbmRUby50cmFuc2ZlcihzZW5kTW91bnQpOwogICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuU1VDQ0VTUywgc2VuZE1vdW50LCBfc2VuZFRvKTsKICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5TVUNDRVNTOwogICAgfQoKfQ=='.
	

]
