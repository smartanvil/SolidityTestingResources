Class {
	#name : #SRTed2725cdfc48a24aa71d9b9621d431db0705a55a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTed2725cdfc48a24aa71d9b9621d431db0705a55a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKICAgIC8qKgogICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAgKiBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KCn0KCgovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KCi8vLyBAdGl0bGUgTWluaU1lVG9rZW4gQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIHRva2VuIGNvbnRyYWN0J3MgZ29hbCBpcyB0byBtYWtlIGl0IGVhc3kgZm9yIGFueW9uZSB0byBjbG9uZSB0aGlzCi8vLyAgdG9rZW4gdXNpbmcgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBhdCBhIGdpdmVuIGJsb2NrLCB0aGlzIHdpbGwgYWxsb3cgREFPJ3MKLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQKLy8vICBhZmZlY3RpbmcgdGhlIG9yaWdpbmFsIHRva2VuCi8vLyBAZGV2IEl0IGlzIEVSQzIwIGNvbXBsaWFudCwgYnV0IHN0aWxsIG5lZWRzIHRvIHVuZGVyIGdvIGZ1cnRoZXIgdGVzdGluZy4KCgovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMKY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsKICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2VucwogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cwogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpCiAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgdWludDEyOCBmcm9tQmxvY2s7CgogICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQyNTYgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQyNTYgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQyNTYgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFUkMyMCBNZXRob2RzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdAogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLAogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGlzIHRoZSBhY3R1YWwgdHJhbnNmZXIgZnVuY3Rpb24gaW4gdGhlIHRva2VuIGNvbnRyYWN0LCBpdCBjYW4KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgewoKICAgICAgICBpZiAoX2Ftb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShwYXJlbnRTbmFwU2hvdEJsb2NrIDwgYmxvY2subnVtYmVyKTsKCiAgICAgICAgLy8gRG8gbm90IGFsbG93IHRyYW5zZmVyIHRvIDB4MCBvciB0aGUgdG9rZW4gY29udHJhY3QgaXRzZWxmCiAgICAgICAgcmVxdWlyZSgoX3RvICE9IDApICYmIChfdG8gIT0gYWRkcmVzcyh0aGlzKSkpOwoKICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQogICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsKICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSB0cmFuc2ZlcgogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zCiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKCiAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2VucwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZkF0KF90bywgYmxvY2subnVtYmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX3RvXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcnNFbmFibGVkKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZSgoX2Ftb3VudCA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpOwogICAgICAgIH0KCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gcmVhZCB0aGUgYGFsbG93ZWRbXWAgbWFwCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0aGF0IG93bnMgdGhlIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgb2YgX293bmVyIHRoYXQgX3NwZW5kZXIgaXMgYWxsb3dlZAogICAgLy8vICB0byBzcGVuZAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyCiAgICApIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc2VuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzCiAgICAvLy8gIGJlaW5nIGFwcHJvdmVkLCBgX3NwZW5kZXJgLiBUaGlzIGFsbG93cyB1c2VycyB0byB1c2UgdGhlaXIgdG9rZW5zIHRvCiAgICAvLy8gIGludGVyYWN0IHdpdGggY29udHJhY3RzIGluIG9uZSBmdW5jdGlvbiBjYWxsIGluc3RlYWQgb2YgdHdvCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGZ1bmN0aW9uIGNhbGwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKTsKCiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKAogICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgX2Ftb3VudCwKICAgICAgICB0aGlzLAogICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVyeSBiYWxhbmNlIGFuZCB0b3RhbFN1cHBseSBpbiBIaXN0b3J5CiAgICAvLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZgogICAgICAgIC8vICB0aGlzIHRva2VuCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYC4KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludDI1NiBfYmxvY2tOdW1iZXIpIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENsb25lIFRva2VuIE1ldGhvZAogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICB1aW50MjU2IF9zbmFwc2hvdEJsb2NrLAogICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3NuYXBzaG90QmxvY2sgPT0gMCkgX3NuYXBzaG90QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHRoaXMsCiAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICk7CgogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdG9rZW4gZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgTmV3Q2xvbmVUb2tlbihhZGRyZXNzKGNsb25lVG9rZW4pLCBfc25hcHNob3RCbG9jayk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCiAgICAvLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgR2VuZXJhdGVzIGBfYW1vdW50YCB0b2tlbnMgdGhhdCBhcmUgYXNzaWduZWQgdG8gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSBhc3NpZ25lZCB0aGUgbmV3IHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgZ2VuZXJhdGVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGdlbmVyYXRlZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQyNTYgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludDI1NiBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQyNTYgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgPj0gX2Ftb3VudCk7CiAgICAgICAgdWludDI1NiBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VGcm9tID49IF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKICAgIC8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50MjU2IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS52YWx1ZTsKICAgICAgICBpZiAoX2Jsb2NrIDwgY2hlY2twb2ludHNbMF0uZnJvbUJsb2NrKSByZXR1cm4gMDsKCiAgICAgICAgLy8gQmluYXJ5IHNlYXJjaCBvZiB0aGUgdmFsdWUgaW4gdGhlIGFycmF5CiAgICAgICAgdWludDI1NiBtaW4gPSAwOwogICAgICAgIHVpbnQyNTYgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7CiAgICAgICAgd2hpbGUgKG1heCA+IG1pbikgewogICAgICAgICAgICB1aW50MjU2IG1pZCA9IChtYXggKyBtaW4gKyAxKS8gMjsKICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOwogICAgfQoKICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQogICAgLy8vICBgdG90YWxTdXBwbHlIaXN0b3J5YAogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiBkYXRhIGJlaW5nIHVwZGF0ZWQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludDI1NiBfdmFsdWUKICAgICkgaW50ZXJuYWwgIHsKICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLTFdLmZyb21CbG9jayA8IGJsb2NrLm51bWJlcikpIHsKICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOwogICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBvbGRDaGVja1BvaW50ID0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdOwogICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYW4gYWRkcmVzcyBpcyBhIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQyNTYgc2l6ZTsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemU+MDsKICAgIH0KCiAgICAvLy8gQGRldiBIZWxwZXIgZnVuY3Rpb24gdG8gcmV0dXJuIGEgbWluIGJldHdlbiB0aGUgdHdvIHVpbnRzCiAgICBmdW5jdGlvbiBtaW4odWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgfQoKICAgIC8vLy8vLy8vLy8KICAgIC8vIFNhZmV0eSBNZXRob2RzCiAgICAvLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgY29udHJvbGxlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNaW5pTWVUb2tlbiB0b2tlbiA9IE1pbmlNZVRva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQyNTYgX3NuYXBzaG90QmxvY2spOwogICAgZXZlbnQgQXBwcm92YWwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9vd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICApOwoKfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50MjU2IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSB7CiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF90b2tlbk5hbWUsCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApOwoKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5CdXJuZXIgewogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzICwgdWludDI1NiApCiAgICByZXR1cm5zIChib29sIHJlc3VsdCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQoKY29udHJhY3QgRmlpbnVUb2tlbiBpcyBNaW5pTWVUb2tlbiwgT3duYWJsZSB7CgogICAgVG9rZW5CdXJuZXIgcHVibGljIHRva2VuQnVybmVyOwoKICAgIGZ1bmN0aW9uIEZpaW51VG9rZW4oYWRkcmVzcyBfdG9rZW5GYWN0b3J5KQogICAgTWluaU1lVG9rZW4oCiAgICAgICAgX3Rva2VuRmFjdG9yeSwKICAgICAgICAweDAsICAgICAgICAgICAgICAgICAgICAgLy8gbm8gcGFyZW50IHRva2VuCiAgICAgICAgMCwgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgICAgICJGaWludSBUb2tlbiIsICAgICAgICAgICAvLyBUb2tlbiBuYW1lCiAgICAgICAgNiwgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY2ltYWxzCiAgICAgICAgIkZOVSIsICAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbAogICAgICAgIHRydWUgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMKICAgICkKICAgIHt9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5CdXJuZXIoYWRkcmVzcyBfdG9rZW5CdXJuZXIpIG9ubHlPd25lciB7CiAgICAgICAgdG9rZW5CdXJuZXIgPSBUb2tlbkJ1cm5lcihfdG9rZW5CdXJuZXIpOwogICAgfQoKICAgIC8vIGFsbG93cyBhIHRva2VuIGhvbGRlciB0byBidXJuIHRva2VucwogICAgLy8gcmVxdWlyZXMgdG9rZW5CdXJuZXIgdG8gYmUgc2V0IHRvIGEgdmFsaWQgY29udHJhY3QgYWRkcmVzcwogICAgLy8gdG9rZW5CdXJuZXIgY2FuIHRha2UgYW55IGFwcHJvcHJpYXRlIGFjdGlvbgogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF9hbW91bnQpIHsKICAgICAgICB1aW50MjU2IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIHVpbnQyNTYgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZUZyb20gPj0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1ttc2cuc2VuZGVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIGFzc2VydCh0b2tlbkJ1cm5lci5idXJuKG1zZy5zZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCAwLCBfYW1vdW50KTsKICAgIH0KCn0KCmNvbnRyYWN0IE1pbGVzdG9uZXMgaXMgT3duYWJsZSB7CgogICAgZW51bSBTdGF0ZSB7IFByZUljbywgSWNvT3BlbiwgSWNvQ2xvc2VkLCBJY29TdWNjZXNzZnVsLCBJY29GYWlsZWQsIEJhbmtMaWNlbnNlU3VjY2Vzc2Z1bCwgQmFua0xpY2Vuc2VGYWlsZWQgfQoKICAgIGV2ZW50IE1pbGVzdG9uZShzdHJpbmcgX2Fubm91bmNlbWVudCwgU3RhdGUgX3N0YXRlKTsKCiAgICBTdGF0ZSBwdWJsaWMgc3RhdGUgPSBTdGF0ZS5QcmVJY287CiAgICBib29sIHB1YmxpYyB0cmFkaW5nT3BlbiA9IGZhbHNlOwoKICAgIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgX3N0YXRlKSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBfc3RhdGUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNUcmFkaW5nT3BlbigpIHsKICAgICAgICByZXF1aXJlKHRyYWRpbmdPcGVuKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIE1pbGVzdG9uZV9PcGVuVGhlSWNvKHN0cmluZyBfYW5ub3VuY2VtZW50KSBvbmx5T3duZXIgaW5TdGF0ZShTdGF0ZS5QcmVJY28pIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkljb09wZW47CiAgICAgICAgTWlsZXN0b25lKF9hbm5vdW5jZW1lbnQsIHN0YXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBNaWxlc3RvbmVfQ2xvc2VUaGVJY28oc3RyaW5nIF9hbm5vdW5jZW1lbnQpIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLkljb09wZW4pIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkljb0Nsb3NlZDsKICAgICAgICBNaWxlc3RvbmUoX2Fubm91bmNlbWVudCwgc3RhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIE1pbGVzdG9uZV9JY29TdWNjZXNzZnVsKHN0cmluZyBfYW5ub3VuY2VtZW50KSBvbmx5T3duZXIgaW5TdGF0ZShTdGF0ZS5JY29DbG9zZWQpIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkljb1N1Y2Nlc3NmdWw7CiAgICAgICAgTWlsZXN0b25lKF9hbm5vdW5jZW1lbnQsIHN0YXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBNaWxlc3RvbmVfSWNvRmFpbGVkKHN0cmluZyBfYW5ub3VuY2VtZW50KSBvbmx5T3duZXIgaW5TdGF0ZShTdGF0ZS5JY29DbG9zZWQpIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkljb0ZhaWxlZDsKICAgICAgICBNaWxlc3RvbmUoX2Fubm91bmNlbWVudCwgc3RhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIE1pbGVzdG9uZV9CYW5rTGljZW5zZVN1Y2Nlc3NmdWwoc3RyaW5nIF9hbm5vdW5jZW1lbnQpIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLkljb1N1Y2Nlc3NmdWwpIHsKICAgICAgICB0cmFkaW5nT3BlbiA9IHRydWU7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5CYW5rTGljZW5zZVN1Y2Nlc3NmdWw7CiAgICAgICAgTWlsZXN0b25lKF9hbm5vdW5jZW1lbnQsIHN0YXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBNaWxlc3RvbmVfQmFua0xpY2Vuc2VGYWlsZWQoc3RyaW5nIF9hbm5vdW5jZW1lbnQpIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLkljb1N1Y2Nlc3NmdWwpIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkJhbmtMaWNlbnNlRmFpbGVkOwogICAgICAgIE1pbGVzdG9uZShfYW5ub3VuY2VtZW50LCBzdGF0ZSk7CiAgICB9Cgp9Cgpjb250cmFjdCBJbnZlc3RvcnMgaXMgTWlsZXN0b25lcyB7CgogICAgc3RydWN0IFdoaXRlbGlzdEVudHJ5IHsKICAgICAgICB1aW50MjU2IG1heDsKICAgICAgICB1aW50MjU2IHRvdGFsOwogICAgICAgIGJvb2wgaW5pdDsKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgaW50ZXJuYWwgYWRtaW5zOwogICAgbWFwcGluZyhhZGRyZXNzID0+IFdoaXRlbGlzdEVudHJ5KSBhcHByb3ZlZEludmVzdG9yczsKCiAgICBtb2RpZmllciBvbmx5QWRtaW5zKCkgewogICAgICAgIHJlcXVpcmUoYWRtaW5zW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gbWFuYWdlSW52ZXN0b3JzKGFkZHJlc3MgX2ludmVzdG9yc193YWxsZXRfYWRkcmVzcywgdWludDI1NiBfbWF4X2FwcHJvdmVkX2ludmVzdG1lbnQpIG9ubHlBZG1pbnMgewogICAgICAgIGlmKGFwcHJvdmVkSW52ZXN0b3JzW19pbnZlc3RvcnNfd2FsbGV0X2FkZHJlc3NdLmluaXQpewogICAgICAgICAgICBhcHByb3ZlZEludmVzdG9yc1tfaW52ZXN0b3JzX3dhbGxldF9hZGRyZXNzXS5tYXggPSBTYWZlTWF0aC5tdWwoX21heF9hcHByb3ZlZF9pbnZlc3RtZW50LCAxMCAqKiAxOCk7IC8vIEVUSCB0byBXRUkKICAgICAgICAgICAgLy8gY2xlYW4gdXAKICAgICAgICAgICAgaWYoYXBwcm92ZWRJbnZlc3RvcnNbX2ludmVzdG9yc193YWxsZXRfYWRkcmVzc10ubWF4ID09IDAgJiYgYXBwcm92ZWRJbnZlc3RvcnNbX2ludmVzdG9yc193YWxsZXRfYWRkcmVzc10udG90YWwgPT0gMCkKICAgICAgICAgICAgZGVsZXRlIGFwcHJvdmVkSW52ZXN0b3JzW19pbnZlc3RvcnNfd2FsbGV0X2FkZHJlc3NdOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBhcHByb3ZlZEludmVzdG9yc1tfaW52ZXN0b3JzX3dhbGxldF9hZGRyZXNzXSA9IFdoaXRlbGlzdEVudHJ5KFNhZmVNYXRoLm11bChfbWF4X2FwcHJvdmVkX2ludmVzdG1lbnQsIDEwICoqIDE4KSwgMCwgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1hbmFnZUFkbWlucyhhZGRyZXNzIF9hZGRyZXNzLCBib29sIF9hZGQpIG9ubHlPd25lciB7CiAgICAgICAgYWRtaW5zW19hZGRyZXNzXSA9IF9hZGQ7CiAgICB9Cgp9Cgpjb250cmFjdCBGaWludUNyb3dkU2FsZSBpcyBUb2tlbkNvbnRyb2xsZXIsIEludmVzdG9ycyB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBldmVudCBJbnZlc3RtZW50KGFkZHJlc3MgaW5kZXhlZCBfaW52ZXN0b3IsIHVpbnQyNTYgX3ZhbHVlRXRoLCB1aW50MjU2IF92YWx1ZUZudSk7CiAgICBldmVudCBSZWZ1bmRBZGRlZChhZGRyZXNzIGluZGV4ZWQgX3JlZnVuZGVyLCB1aW50MjU2IF92YWx1ZUV0aCk7CiAgICBldmVudCBSZWZ1bmRFbmFibGVkKHVpbnQyNTYgX3ZhbHVlRXRoKTsKCiAgICBhZGRyZXNzIHdhbGxldDsKICAgIGFkZHJlc3MgcHVibGljIHN0YWZmXzEgPSAweDI3MTdGQ2VlMzJiMjg5NkU2NTVBZDgyRWZGODE5ODdBMzRFRkYzRTc7CiAgICBhZGRyZXNzIHB1YmxpYyBzdGFmZl8yID0gMHg3ZWU0NDcxQzM3MWU1ODFBZjQyYjI4MENEMTlFZDc1OTNCRDdEMTVGOwogICAgYWRkcmVzcyBwdWJsaWMgc3RhZmZfMyA9IDB4RTZCZUNjYzQzYjQ4NDE2Q0U2OUI2ZDAzYzJlNDRFMkI3YjhGNzdiNDsKICAgIGFkZHJlc3MgcHVibGljIHN0YWZmXzQgPSAweDMzNjlEZTdGZjk4YmQ1QzIyNWE2N0UwOWFjODFhRmE3YjVkRjNkM2Q7CgogICAgdWludDI1NiBjb25zdGFudCBtaW5SYWlzZWRXZWkgPSAyMDAwMCBldGhlcjsKICAgIHVpbnQyNTYgY29uc3RhbnQgdGFyZ2V0UmFpc2VkV2VpID0gMTAwMDAwIGV0aGVyOwogICAgdWludDI1NiBjb25zdGFudCBtYXhSYWlzZWRXZWkgPSA0MDAwMDAgZXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyByYWlzZWRXZWkgPSAwOwogICAgdWludDI1NiBwdWJsaWMgcmVmdW5kV2VpID0gMDsKCiAgICBib29sIHB1YmxpYyByZWZ1bmRPcGVuID0gZmFsc2U7CgogICAgTWluaU1lVG9rZW4gcHVibGljIHRva2VuQ29udHJhY3Q7ICAgLy8gVGhlIG5ldyB0b2tlbiBmb3IgdGhpcyBDYW1wYWlnbgoKICAgIGZ1bmN0aW9uIEZpaW51Q3Jvd2RTYWxlKGFkZHJlc3MgX3dhbGxldCwgYWRkcmVzcyBfdG9rZW5BZGRyZXNzKSB7CiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsgLy8gbXVsdGkgc2lnIHdhbGxldAogICAgICAgIHRva2VuQ29udHJhY3QgPSBNaW5pTWVUb2tlbihfdG9rZW5BZGRyZXNzKTsvLyBUaGUgRGVwbG95ZWQgVG9rZW4gQ29udHJhY3QKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gVG9rZW5Db250cm9sbGVyIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgcHJveHlQYXltZW50KClgIHJldHVybnMgZmFsc2UsIG1lYW5pbmcgZXRoZXIgaXMgbm90IGFjY2VwdGVkIGF0CiAgICAvLy8gIHRoZSB0b2tlbiBhZGRyZXNzLCBvbmx5IHRoZSBhZGRyZXNzIG9mIEZpaW51Q3Jvd2RTYWxlCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgbmV3bHkgY3JlYXRlZCB0b2tlbnMKCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdHJhbnNmZXIsIGZvciB0aGlzIENhbXBhaWduIGFsbAogICAgLy8vICB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgYnkgZGVmYXVsdCBhbmQgbm8gZXh0cmEgbm90aWZpY2F0aW9ucyBhcmUgbmVlZGVkCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYWRpbmdPcGVuOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsLCBmb3IgdGhpcyBDYW1wYWlnbiBhbGwKICAgIC8vLyAgYXBwcm92YWxzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KQogICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHdlaVRvRk5VKHVpbnQyNTYgX3dlaSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpewogICAgICAgIHVpbnQyNTYgX3JldHVybjsKICAgICAgICAvLyAxIEZOVSA9IDAuNzUgRVRICiAgICAgICAgaWYoc3RhdGUgPT0gU3RhdGUuUHJlSWNvKXsKICAgICAgICAgICAgX3JldHVybiA9IF93ZWkuYWRkKF93ZWkuZGl2KDMpKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIDEgRk5VID0gMSBFVEgKICAgICAgICAgICAgaWYocmFpc2VkV2VpIDwgdGFyZ2V0UmFpc2VkV2VpKXsKICAgICAgICAgICAgICAgIF9yZXR1cm4gPSBfd2VpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gMSBGTlUgPSByYWlzZWRXZWkgLyB0YXJnZXRSYWlzZWRXZWkKICAgICAgICAgICAgICAgIF9yZXR1cm4gPSBfd2VpLm11bCh0YXJnZXRSYWlzZWRXZWkpLmRpdihyYWlzZWRXZWkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIFdFSSB0byBGTlUKICAgICAgICByZXR1cm4gX3JldHVybi5kaXYoMTAgKiogMTIpOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgeyAvLyBpbmNvbWluZyBpbnZlc3RtZW50IGluIHRoZSBzdGF0ZSBvZiBQcmVJY28gb3IgSWNvT3BlbgoKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSAhPSAwKTsgLy8gaW5jb21pbmcgdHJhbnNhY3Rpb24gbXVzdCBoYXZlIHZhbHVlCiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5QcmVJY28gfHwgc3RhdGUgPT0gU3RhdGUuSWNvT3Blbik7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlZEludmVzdG9yc1ttc2cuc2VuZGVyXS5pbml0ID09IHRydWUpOyAvLyBpcyBhcHByb3ZlZCBpbnZlc3RvcgogICAgICAgIHJlcXVpcmUoYXBwcm92ZWRJbnZlc3RvcnNbbXNnLnNlbmRlcl0ubWF4ID49IGFwcHJvdmVkSW52ZXN0b3JzW21zZy5zZW5kZXJdLnRvdGFsLmFkZChtc2cudmFsdWUpKTsgLy8gaW52ZXN0bWVudCBpcyBub3QgYnJlYWNoaW5nIG1heCBhcHByb3ZlZCBpbnZlc3RtZW50IGFtb3VudAogICAgICAgIHJlcXVpcmUobWF4UmFpc2VkV2VpID49IHJhaXNlZFdlaS5hZGQobXNnLnZhbHVlKSk7IC8vIGludmVzdG1lbnQgaXMgbm90IGJyZWFjaGluZyBtYXggcmFpc2luZyBsaW1pdAoKICAgICAgICB1aW50MjU2IF9mbnUgPSB3ZWlUb0ZOVShtc2cudmFsdWUpOwogICAgICAgIHJlcXVpcmUoX2ZudSA+IDApOwoKICAgICAgICByYWlzZWRXZWkgPSByYWlzZWRXZWkuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgYXBwcm92ZWRJbnZlc3RvcnNbbXNnLnNlbmRlcl0udG90YWwgPSBhcHByb3ZlZEludmVzdG9yc1ttc2cuc2VuZGVyXS50b3RhbC5hZGQobXNnLnZhbHVlKTsgLy8gaW5jcmVhc2UgdG90YWwgaW52ZXN0ZWQKICAgICAgICBtaW50KG1zZy5zZW5kZXIsIF9mbnUpOyAvLyBNaW50IHRoZSB0b2tlbnMKICAgICAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsgLy8gTW92ZSBFVEggdG8gbXVsdGkgc2lnIHdhbGxldAogICAgICAgIEludmVzdG1lbnQobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBfZm51KTsgLy8gQW5ub3VuY2UgaW52ZXN0bWVudAogICAgfQoKICAgIGZ1bmN0aW9uIHJlZnVuZCgpIHBheWFibGUgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlICE9IDApOyAvLyBpbmNvbWluZyB0cmFuc2FjdGlvbiBtdXN0IGhhdmUgdmFsdWUKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkljb0Nsb3NlZCB8fCBzdGF0ZSA9PSBTdGF0ZS5JY29TdWNjZXNzZnVsIHx8IHN0YXRlID09IFN0YXRlLkljb0ZhaWxlZCB8fCBzdGF0ZSA9PSBTdGF0ZS5CYW5rTGljZW5zZUZhaWxlZCk7CiAgICAgICAgcmVmdW5kV2VpID0gcmVmdW5kV2VpLmFkZChtc2cudmFsdWUpOwogICAgICAgIFJlZnVuZEFkZGVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gTWlsZXN0b25lX0ljb1N1Y2Nlc3NmdWwoc3RyaW5nIF9hbm5vdW5jZW1lbnQpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShyYWlzZWRXZWkgPj0gbWluUmFpc2VkV2VpKTsKICAgICAgICB1aW50MjU2IF90b0JlQWxsb2NhdGVkID0gdG9rZW5Db250cmFjdC50b3RhbFN1cHBseSgpOwogICAgICAgIF90b0JlQWxsb2NhdGVkID0gX3RvQmVBbGxvY2F0ZWQuZGl2KDEwKTsKICAgICAgICBtaW50KHN0YWZmXzEsIF90b0JlQWxsb2NhdGVkLm11bCg4MSkuZGl2KDEwMCkpOyAvLyA4MSUKICAgICAgICBtaW50KHN0YWZmXzIsIF90b0JlQWxsb2NhdGVkLm11bCg5KS5kaXYoMTAwKSk7IC8vIDklCiAgICAgICAgbWludChzdGFmZl8zLCBfdG9CZUFsbG9jYXRlZC5tdWwoMTUpLmRpdigxMDAwKSk7ICAvLyAxLjUlCiAgICAgICAgbWludChzdGFmZl80LCBfdG9CZUFsbG9jYXRlZC5tdWwoMTUpLmRpdigxMDAwKSk7IC8vIDEuNSUKICAgICAgICBtaW50KG93bmVyLCBfdG9CZUFsbG9jYXRlZC5tdWwoNykuZGl2KDEwMCkpOyAvLyA3JQogICAgICAgIHN1cGVyLk1pbGVzdG9uZV9JY29TdWNjZXNzZnVsKF9hbm5vdW5jZW1lbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIE1pbGVzdG9uZV9JY29GYWlsZWQoc3RyaW5nIF9hbm5vdW5jZW1lbnQpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShyYWlzZWRXZWkgPCBtaW5SYWlzZWRXZWkpOwogICAgICAgIHN1cGVyLk1pbGVzdG9uZV9JY29GYWlsZWQoX2Fubm91bmNlbWVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gTWlsZXN0b25lX0JhbmtMaWNlbnNlRmFpbGVkKHN0cmluZyBfYW5ub3VuY2VtZW50KSBvbmx5T3duZXIgewogICAgICAgIC8vIHJlbW92ZSBzdGFmZiBhbGxvY2F0aW9ucwogICAgICAgIGJ1cm4oc3RhZmZfMSk7CiAgICAgICAgYnVybihzdGFmZl8yKTsKICAgICAgICBidXJuKHN0YWZmXzMpOwogICAgICAgIGJ1cm4oc3RhZmZfNCk7CiAgICAgICAgYnVybihvd25lcik7CiAgICAgICAgc3VwZXIuTWlsZXN0b25lX0JhbmtMaWNlbnNlRmFpbGVkKF9hbm5vdW5jZW1lbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIEVuYWJsZVJlZnVuZCgpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5JY29GYWlsZWQgfHwgc3RhdGUgPT0gU3RhdGUuQmFua0xpY2Vuc2VGYWlsZWQpOwogICAgICAgIHJlcXVpcmUocmVmdW5kV2VpID4gMCk7CiAgICAgICAgcmVmdW5kT3BlbiA9IHRydWU7CiAgICAgICAgUmVmdW5kRW5hYmxlZChyZWZ1bmRXZWkpOwogICAgfQoKICAgIC8vIGhhbmRsZSBhdXRvbWF0aWMgcmVmdW5kcwogICAgZnVuY3Rpb24gUmVxdWVzdFJlZnVuZCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShyZWZ1bmRPcGVuKTsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkljb0ZhaWxlZCB8fCBzdGF0ZSA9PSBTdGF0ZS5CYW5rTGljZW5zZUZhaWxlZCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihtc2cuc2VuZGVyKSA+IDApOyAvLyB5b3UgbXVzdCBoYXZlIHNvbWUgRk5VIHRvIHJlcXVlc3QgcmVmdW5kCiAgICAgICAgLy8gcmVmdW5kIHByb3JhdGEgYWdhaW5zdCB5b3VyIEVUSCBpbnZlc3RtZW50CiAgICAgICAgdWludDI1NiByZWZ1bmRBbW91bnQgPSByZWZ1bmRXZWkubXVsKGFwcHJvdmVkSW52ZXN0b3JzW21zZy5zZW5kZXJdLnRvdGFsKS5kaXYocmFpc2VkV2VpKTsKICAgICAgICBidXJuKG1zZy5zZW5kZXIpOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kQW1vdW50KTsKICAgIH0KCiAgICAvLyBtaW50aW5nIHBvc3NpYmxlIG9ubHkgaWYgU3RhdGUuUHJlSWNvIGFuZCBTdGF0ZS5JY29PcGVuIGZvciAoKSBwYXlhYmxlIG9yIFN0YXRlLkljb0Nsb3NlZCBmb3IgaW52ZXN0RklBVCgpCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbnMpIGludGVybmFsIHsKICAgICAgICB0b2tlbkNvbnRyYWN0LmdlbmVyYXRlVG9rZW5zKF90bywgX3Rva2Vucyk7CiAgICB9CgogICAgLy8gYnVybmluZyBvbmx5IGluIFN0YXRlLklDT2NvbXBsZXRlZCBmb3IgTWlsZXN0b25lX0JhbmtMaWNlbnNlRmFpbGVkKCkgb3IgU3RhdGUuQmFua0xpY2Vuc2VGYWlsZWQgZm9yIFJlcXVlc3RSZWZ1bmQoKQogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIF9hZGRyZXNzKSBpbnRlcm5hbCB7CiAgICAgICAgdG9rZW5Db250cmFjdC5kZXN0cm95VG9rZW5zKF9hZGRyZXNzLCB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihfYWRkcmVzcykpOwogICAgfQp9Cgpjb250cmFjdCBQcm9maXRTaGFyaW5nIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgZXZlbnQgRGl2aWRlbmREZXBvc2l0ZWQoYWRkcmVzcyBpbmRleGVkIF9kZXBvc2l0b3IsIHVpbnQyNTYgX2Jsb2NrTnVtYmVyLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3RvdGFsU3VwcGx5LCB1aW50MjU2IF9kaXZpZGVuZEluZGV4KTsKICAgIGV2ZW50IERpdmlkZW5kQ2xhaW1lZChhZGRyZXNzIGluZGV4ZWQgX2NsYWltZXIsIHVpbnQyNTYgX2RpdmlkZW5kSW5kZXgsIHVpbnQyNTYgX2NsYWltKTsKICAgIGV2ZW50IERpdmlkZW5kUmVjeWNsZWQoYWRkcmVzcyBpbmRleGVkIF9yZWN5Y2xlciwgdWludDI1NiBfYmxvY2tOdW1iZXIsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdG90YWxTdXBwbHksIHVpbnQyNTYgX2RpdmlkZW5kSW5kZXgpOwoKICAgIE1pbmlNZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICB1aW50MjU2IHB1YmxpYyBSRUNZQ0xFX1RJTUUgPSAxIHllYXJzOwoKICAgIHN0cnVjdCBEaXZpZGVuZCB7CiAgICAgICAgdWludDI1NiBibG9ja051bWJlcjsKICAgICAgICB1aW50MjU2IHRpbWVzdGFtcDsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50MjU2IGNsYWltZWRBbW91bnQ7CiAgICAgICAgdWludDI1NiB0b3RhbFN1cHBseTsKICAgICAgICBib29sIHJlY3ljbGVkOwogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgY2xhaW1lZDsKICAgIH0KCiAgICBEaXZpZGVuZFtdIHB1YmxpYyBkaXZpZGVuZHM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBkaXZpZGVuZHNDbGFpbWVkOwoKICAgIG1vZGlmaWVyIHZhbGlkRGl2aWRlbmRJbmRleCh1aW50MjU2IF9kaXZpZGVuZEluZGV4KSB7CiAgICAgICAgcmVxdWlyZShfZGl2aWRlbmRJbmRleCA8IGRpdmlkZW5kcy5sZW5ndGgpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gUHJvZml0U2hhcmluZyhhZGRyZXNzIF90b2tlbikgewogICAgICAgIHRva2VuID0gTWluaU1lVG9rZW4oX3Rva2VuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZXBvc2l0RGl2aWRlbmQoKSBwYXlhYmxlCiAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICB1aW50MjU2IGN1cnJlbnRTdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseUF0KGJsb2NrLm51bWJlcik7CiAgICAgICAgdWludDI1NiBkaXZpZGVuZEluZGV4ID0gZGl2aWRlbmRzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGJsb2NrTnVtYmVyID0gU2FmZU1hdGguc3ViKGJsb2NrLm51bWJlciwgMSk7CiAgICAgICAgZGl2aWRlbmRzLnB1c2goCiAgICAgICAgICAgIERpdmlkZW5kKAogICAgICAgICAgICAgICAgYmxvY2tOdW1iZXIsCiAgICAgICAgICAgICAgICBnZXROb3coKSwKICAgICAgICAgICAgICAgIG1zZy52YWx1ZSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICBjdXJyZW50U3VwcGx5LAogICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKQogICAgICAgICk7CiAgICAgICAgRGl2aWRlbmREZXBvc2l0ZWQobXNnLnNlbmRlciwgYmxvY2tOdW1iZXIsIG1zZy52YWx1ZSwgY3VycmVudFN1cHBseSwgZGl2aWRlbmRJbmRleCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1EaXZpZGVuZCh1aW50MjU2IF9kaXZpZGVuZEluZGV4KSBwdWJsaWMKICAgIHZhbGlkRGl2aWRlbmRJbmRleChfZGl2aWRlbmRJbmRleCkKICAgIHsKICAgICAgICBEaXZpZGVuZCBzdG9yYWdlIGRpdmlkZW5kID0gZGl2aWRlbmRzW19kaXZpZGVuZEluZGV4XTsKICAgICAgICByZXF1aXJlKGRpdmlkZW5kLmNsYWltZWRbbXNnLnNlbmRlcl0gPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUoZGl2aWRlbmQucmVjeWNsZWQgPT0gZmFsc2UpOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZkF0KG1zZy5zZW5kZXIsIGRpdmlkZW5kLmJsb2NrTnVtYmVyKTsKICAgICAgICB1aW50MjU2IGNsYWltID0gYmFsYW5jZS5tdWwoZGl2aWRlbmQuYW1vdW50KS5kaXYoZGl2aWRlbmQudG90YWxTdXBwbHkpOwogICAgICAgIGRpdmlkZW5kLmNsYWltZWRbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIGRpdmlkZW5kLmNsYWltZWRBbW91bnQgPSBTYWZlTWF0aC5hZGQoZGl2aWRlbmQuY2xhaW1lZEFtb3VudCwgY2xhaW0pOwogICAgICAgIGlmIChjbGFpbSA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihjbGFpbSk7CiAgICAgICAgICAgIERpdmlkZW5kQ2xhaW1lZChtc2cuc2VuZGVyLCBfZGl2aWRlbmRJbmRleCwgY2xhaW0pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbURpdmlkZW5kQWxsKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGRpdmlkZW5kc0NsYWltZWRbbXNnLnNlbmRlcl0gPCBkaXZpZGVuZHMubGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IGRpdmlkZW5kc0NsYWltZWRbbXNnLnNlbmRlcl07IGkgPCBkaXZpZGVuZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKChkaXZpZGVuZHNbaV0uY2xhaW1lZFttc2cuc2VuZGVyXSA9PSBmYWxzZSkgJiYgKGRpdmlkZW5kc1tpXS5yZWN5Y2xlZCA9PSBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIGRpdmlkZW5kc0NsYWltZWRbbXNnLnNlbmRlcl0gPSBTYWZlTWF0aC5hZGQoaSwgMSk7CiAgICAgICAgICAgICAgICBjbGFpbURpdmlkZW5kKGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlY3ljbGVEaXZpZGVuZCh1aW50MjU2IF9kaXZpZGVuZEluZGV4KSBwdWJsaWMKICAgIG9ubHlPd25lcgogICAgdmFsaWREaXZpZGVuZEluZGV4KF9kaXZpZGVuZEluZGV4KQogICAgewogICAgICAgIERpdmlkZW5kIHN0b3JhZ2UgZGl2aWRlbmQgPSBkaXZpZGVuZHNbX2RpdmlkZW5kSW5kZXhdOwogICAgICAgIHJlcXVpcmUoZGl2aWRlbmQucmVjeWNsZWQgPT0gZmFsc2UpOwogICAgICAgIHJlcXVpcmUoZGl2aWRlbmQudGltZXN0YW1wIDwgU2FmZU1hdGguc3ViKGdldE5vdygpLCBSRUNZQ0xFX1RJTUUpKTsKICAgICAgICBkaXZpZGVuZHNbX2RpdmlkZW5kSW5kZXhdLnJlY3ljbGVkID0gdHJ1ZTsKICAgICAgICB1aW50MjU2IGN1cnJlbnRTdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseUF0KGJsb2NrLm51bWJlcik7CiAgICAgICAgdWludDI1NiByZW1haW5pbmdBbW91bnQgPSBTYWZlTWF0aC5zdWIoZGl2aWRlbmQuYW1vdW50LCBkaXZpZGVuZC5jbGFpbWVkQW1vdW50KTsKICAgICAgICB1aW50MjU2IGRpdmlkZW5kSW5kZXggPSBkaXZpZGVuZHMubGVuZ3RoOwogICAgICAgIHVpbnQyNTYgYmxvY2tOdW1iZXIgPSBTYWZlTWF0aC5zdWIoYmxvY2subnVtYmVyLCAxKTsKICAgICAgICBkaXZpZGVuZHMucHVzaCgKICAgICAgICAgICAgRGl2aWRlbmQoCiAgICAgICAgICAgICAgICBibG9ja051bWJlciwKICAgICAgICAgICAgICAgIGdldE5vdygpLAogICAgICAgICAgICAgICAgcmVtYWluaW5nQW1vdW50LAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIGN1cnJlbnRTdXBwbHksCiAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICApCiAgICAgICAgKTsKICAgICAgICBEaXZpZGVuZFJlY3ljbGVkKG1zZy5zZW5kZXIsIGJsb2NrTnVtYmVyLCByZW1haW5pbmdBbW91bnQsIGN1cnJlbnRTdXBwbHksIGRpdmlkZW5kSW5kZXgpOwogICAgfQoKICAgIC8vRnVuY3Rpb24gaXMgbW9ja2VkIGZvciB0ZXN0cwogICAgZnVuY3Rpb24gZ2V0Tm93KCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBub3c7CiAgICB9Cgp9'.
	

]
