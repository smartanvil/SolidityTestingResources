Class {
	#name : #SRT16ee6f44522dffde8070ca83df441ec20d84c598,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT16ee6f44522dffde8070ca83df441ec20d84c598 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBNYW5hZ2VyIHsKICAgIGFkZHJlc3MgcHVibGljIGNlbzsKICAgIGFkZHJlc3MgcHVibGljIGNmbzsKICAgIGFkZHJlc3MgcHVibGljIGNvbzsKICAgIGFkZHJlc3MgcHVibGljIGNhbzsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNDZW8sIGFkZHJlc3MgaW5kZXhlZCBuZXdDZW8pOwogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKCgogICAgLyoqCiAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgKiBhY2NvdW50LgogICAgKi8KICAgIGZ1bmN0aW9uIE1hbmFnZXIoKSBwdWJsaWMgewogICAgICAgIGNvbyA9IG1zZy5zZW5kZXI7CiAgICAgICAgY2ZvID0gMHg0NDc4NzBDMmYzMzRGY2RhNjhlNjQ0YUU1M0RiMzQ3MUE5ZjczMDJEOwogICAgICAgIGNlbyA9IDB4NkVDOUM2ZmNFMTVEQjk4MjUyMWVBMjA4NzQ3NDI5MWZBNUFkNmQzMTsKICAgICAgICBjYW8gPSAweDM5MUVmMmNCMGM4MUEyQzQ3RDY1OWMzZTNlNjY3NUY1NTBlNGIxODM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICovCiAgICBtb2RpZmllciBvbmx5Q0VPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZW8pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNPTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29vKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDQU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNhbyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdDZW8uCiAgICAqIEBwYXJhbSBuZXdDZW8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgKi8KICAgIGZ1bmN0aW9uIGRlbWlzZUNFTyhhZGRyZXNzIG5ld0NlbykgcHVibGljIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUobmV3Q2VvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKGNlbywgbmV3Q2VvKTsKICAgICAgICBjZW8gPSBuZXdDZW87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q0ZPKGFkZHJlc3MgbmV3Q2ZvKSBwdWJsaWMgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShuZXdDZm8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY2ZvID0gbmV3Q2ZvOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIG5ld0NvbykgcHVibGljIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUobmV3Q29vICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGNvbyA9IG5ld0NvbzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDQU8oYWRkcmVzcyBuZXdDYW8pIHB1YmxpYyBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKG5ld0NhbyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjYW8gPSBuZXdDYW87CiAgICB9CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAgIC8qKgogICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICAqLwogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgKi8KICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgb25seUNBTyB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgICovCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seUNBTyB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgfQp9CgoKY29udHJhY3QgU2tpbkJhc2UgaXMgTWFuYWdlciB7CgogICAgc3RydWN0IFNraW4gewogICAgICAgIHVpbnQxMjggYXBwZWFyYW5jZTsKICAgICAgICB1aW50NjQgY29vbGRvd25FbmRUaW1lOwogICAgICAgIHVpbnQ2NCBtaXhpbmdXaXRoSWQ7CiAgICB9CgogICAgLy8gQWxsIHNraW5zLCBtYXBwaW5nIGZyb20gc2tpbiBpZCB0byBza2luIGFwcHJhbmNlCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IFNraW4pIHNraW5zOwoKICAgIC8vIE1hcHBpbmcgZnJvbSBza2luIGlkIHRvIG93bmVyCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBza2luSWRUb093bmVyOwoKICAgIC8vIFdoZXRoZXIgYSBza2luIGlzIG9uIHNhbGUKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYm9vbCkgcHVibGljIGlzT25TYWxlOwoKICAgIC8vIE51bWJlciBvZiBhbGwgdG90YWwgdmFsaWQgc2tpbnMKICAgIC8vIHNraW5JZCAwIHNob3VsZCBub3QgY29ycmVzcG9uZCB0byBhbnkgc2tpbiwgYmVjYXVzZSBza2luLm1peGluZ1dpdGhJZD09MCBpbmRpY2F0ZXMgbm90IG1peGluZwogICAgdWludDI1NiBwdWJsaWMgbmV4dFNraW5JZCA9IDE7ICAKCiAgICAvLyBOdW1iZXIgb2Ygc2tpbnMgYW4gYWNjb3VudCBvd25zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBudW1Ta2luT2ZBY2NvdW50czsKCiAgICAvLyAvLyBHaXZlIHNvbWUgc2tpbnMgdG8gaW5pdCBhY2NvdW50IGZvciB1bml0IHRlc3RzCiAgICAvLyBmdW5jdGlvbiBTa2luQmFzZSgpIHB1YmxpYyB7CiAgICAvLyAgICAgYWRkcmVzcyBhY2NvdW50MCA9IDB4NjI3MzA2MDkwYWJhQjNBNmUxNDAwZTkzNDViQzYwYzc4YThCRWY1NzsKICAgIC8vICAgICBhZGRyZXNzIGFjY291bnQxID0gMHhmMTdmNTIxNTFFYkVGNkM3MzM0RkFEMDgwYzU3MDRENzcyMTZiNzMyOwoKICAgIC8vICAgICAvLyBDcmVhdGUgc2ltcGxlIHNraW5zCiAgICAvLyAgICAgU2tpbiBtZW1vcnkgc2tpbiA9IFNraW4oe2FwcGVhcmFuY2U6IDAsIGNvb2xkb3duRW5kVGltZTowLCBtaXhpbmdXaXRoSWQ6IDB9KTsKICAgIC8vICAgICBmb3IgKHVpbnQyNTYgaSA9IDE7IGkgPD0gMTU7IGkrKykgewogICAgLy8gICAgICAgICBpZiAoaSA8IDEwKSB7CiAgICAvLyAgICAgICAgICAgICBza2luLmFwcGVhcmFuY2UgPSB1aW50MTI4KGkpOwogICAgLy8gICAgICAgICAgICAgaWYgKGkgPCA3KSB7IAogICAgLy8gICAgICAgICAgICAgICAgIHNraW5JZFRvT3duZXJbaV0gPSBhY2NvdW50MDsKICAgIC8vICAgICAgICAgICAgICAgICBudW1Ta2luT2ZBY2NvdW50c1thY2NvdW50MF0gKz0gMTsKICAgIC8vICAgICAgICAgICAgIH0gZWxzZSB7ICAKICAgIC8vICAgICAgICAgICAgICAgICBza2luSWRUb093bmVyW2ldID0gYWNjb3VudDE7CiAgICAvLyAgICAgICAgICAgICAgICAgbnVtU2tpbk9mQWNjb3VudHNbYWNjb3VudDFdICs9IDE7CiAgICAvLyAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgIH0gZWxzZSB7ICAKICAgIC8vICAgICAgICAgICAgIHNraW4uYXBwZWFyYW5jZSA9IHVpbnQxMjgoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciAtIGkgKyA5KSk7CiAgICAvLyAgICAgICAgICAgICBza2luSWRUb093bmVyW2ldID0gYWNjb3VudDE7CiAgICAvLyAgICAgICAgICAgICBudW1Ta2luT2ZBY2NvdW50c1thY2NvdW50MV0gKz0gMTsKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgICBza2luc1tpXSA9IHNraW47CiAgICAvLyAgICAgICAgIGlzT25TYWxlW2ldID0gZmFsc2U7CiAgICAvLyAgICAgICAgIG5leHRTa2luSWQgKz0gMTsKICAgIC8vICAgICB9CiAgICAvLyB9IAoKICAgIC8vIEdldCB0aGUgaS10aCBza2luIGFuIGFjY291bnQgb3ducywgZm9yIG9mZi1jaGFpbiB1c2FnZSBvbmx5CiAgICBmdW5jdGlvbiBza2luT2ZBY2NvdW50QnlJZChhZGRyZXNzIGFjY291bnQsIHVpbnQyNTYgaWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgdWludDI1NiBjb3VudCA9IDA7CiAgICAgICB1aW50MjU2IG51bVNraW5PZkFjY291bnQgPSBudW1Ta2luT2ZBY2NvdW50c1thY2NvdW50XTsKICAgICAgIHJlcXVpcmUobnVtU2tpbk9mQWNjb3VudCA+IDApOwogICAgICAgcmVxdWlyZShpZCA8IG51bVNraW5PZkFjY291bnQpOwogICAgICAgZm9yICh1aW50MjU2IGkgPSAxOyBpIDwgbmV4dFNraW5JZDsgaSsrKSB7CiAgICAgICAgICAgaWYgKHNraW5JZFRvT3duZXJbaV0gPT0gYWNjb3VudCkgewogICAgICAgICAgICAgICAvLyBUaGlzIHNraW4gYmVsb25ncyB0byBjdXJyZW50IGFjY291bnQKICAgICAgICAgICAgICAgaWYgKGNvdW50ID09IGlkKSB7CiAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBpZC10aCBza2luIG9mIGN1cnJlbnQgYWNjb3VudCwgYS5rLmEsIHdoYXQgd2UgbmVlZAogICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgLy8gR2V0IHNraW4gYnkgaWQKICAgIGZ1bmN0aW9uIGdldFNraW4odWludDI1NiBpZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDEyOCwgdWludDY0LCB1aW50NjQpIHsKICAgICAgICByZXF1aXJlKGlkID4gMCk7CiAgICAgICAgcmVxdWlyZShpZCA8IG5leHRTa2luSWQpOwogICAgICAgIFNraW4gc3RvcmFnZSBza2luID0gc2tpbnNbaWRdOwogICAgICAgIHJldHVybiAoc2tpbi5hcHBlYXJhbmNlLCBza2luLmNvb2xkb3duRW5kVGltZSwgc2tpbi5taXhpbmdXaXRoSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RVRIKCkgZXh0ZXJuYWwgb25seUNBTyB7CiAgICAgICAgY2ZvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9Cn0KCgpjb250cmFjdCBNaXhGb3JtdWxhSW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGNhbGNOZXdTa2luQXBwZWFyYW5jZSh1aW50MTI4IHgsIHVpbnQxMjggeSkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDEyOCk7CgogICAgLy8gY3JlYXRlIHJhbmRvbSBhcHBlYXJhbmNlCiAgICBmdW5jdGlvbiByYW5kb21Ta2luQXBwZWFyYW5jZSh1aW50MjU2IGV4dGVybmFsTnVtKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MTI4KTsKCiAgICAvLyBibGVhY2gKICAgIGZ1bmN0aW9uIGJsZWFjaEFwcGVhcmFuY2UodWludDEyOCBhcHBlYXJhbmNlLCB1aW50MTI4IGF0dHJpYnV0ZXMpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQxMjgpOwp9Cgpjb250cmFjdCBTa2luTWl4IGlzIFNraW5CYXNlIHsKCiAgICAvLyBNaXggZm9ybXVsYQogICAgTWl4Rm9ybXVsYUludGVyZmFjZSBwdWJsaWMgbWl4Rm9ybXVsYTsKCgogICAgLy8gUHJlLXBhaWQgZXRoZXIgZm9yIHN5bnRoZXNpemF0aW9uLCB3aWxsIGJlIHJldHVybmVkIHRvIHVzZXIgaWYgdGhlIHN5bnRoZXNpemF0aW9uIGZhaWxlZCAobWludXMgZ2FzKS4KICAgIHVpbnQyNTYgcHVibGljIHByZVBhaWRGZWUgPSAxNTAwMDAgKiA1MDAwMDAwMDAwOyAvLyAoMTV3IGdhcyAqIDUgZ3dlaSkKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IE1peFN0YXJ0KGFkZHJlc3MgYWNjb3VudCwgdWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpOwogICAgZXZlbnQgQXV0b01peChhZGRyZXNzIGFjY291bnQsIHVpbnQyNTYgc2tpbkFJZCwgdWludDI1NiBza2luQklkLCB1aW50NjQgY29vbGRvd25FbmRUaW1lKTsKICAgIGV2ZW50IE1peFN1Y2Nlc3MoYWRkcmVzcyBhY2NvdW50LCB1aW50MjU2IHNraW5JZCwgdWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpOwoKICAgIC8vIFNldCBtaXggZm9ybXVsYSBjb250cmFjdCBhZGRyZXNzIAogICAgZnVuY3Rpb24gc2V0TWl4Rm9ybXVsYUFkZHJlc3MoYWRkcmVzcyBtaXhGb3JtdWxhQWRkcmVzcykgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgbWl4Rm9ybXVsYSA9IE1peEZvcm11bGFJbnRlcmZhY2UobWl4Rm9ybXVsYUFkZHJlc3MpOwogICAgfQoKICAgIC8vIHNldFByZVBhaWRGZWU6IHNldCBhZHZhbmNlIGFtb3VudCwgb25seSBvd25lciBjYW4gY2FsbCB0aGlzCiAgICBmdW5jdGlvbiBzZXRQcmVQYWlkRmVlKHVpbnQyNTYgbmV3UHJlUGFpZEZlZSkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgcHJlUGFpZEZlZSA9IG5ld1ByZVBhaWRGZWU7CiAgICB9CgogICAgLy8gX2lzQ29vbGRvd25SZWFkeTogY2hlY2sgd2hldGhlciBjb29sZG93biBwZXJpb2QgaGFzIGJlZW4gcGFzc2VkCiAgICBmdW5jdGlvbiBfaXNDb29sZG93blJlYWR5KHVpbnQyNTYgc2tpbkFJZCwgdWludDI1NiBza2luQklkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoc2tpbnNbc2tpbkFJZF0uY29vbGRvd25FbmRUaW1lIDw9IHVpbnQ2NChub3cpKSAmJiAoc2tpbnNbc2tpbkJJZF0uY29vbGRvd25FbmRUaW1lIDw9IHVpbnQ2NChub3cpKTsKICAgIH0KCiAgICAvLyBfaXNOb3RNaXhpbmc6IGNoZWNrIHdoZXRoZXIgdHdvIHNraW5zIGFyZSBpbiBhbm90aGVyIG1peGluZyBwcm9jZXNzCiAgICBmdW5jdGlvbiBfaXNOb3RNaXhpbmcodWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChza2luc1tza2luQUlkXS5taXhpbmdXaXRoSWQgPT0gMCkgJiYgKHNraW5zW3NraW5CSWRdLm1peGluZ1dpdGhJZCA9PSAwKTsKICAgIH0KCiAgICAvLyBfc2V0Q29vbGRvd25UaW1lOiBzZXQgbmV3IGNvb2xkb3duIHRpbWUKICAgIGZ1bmN0aW9uIF9zZXRDb29sZG93bkVuZFRpbWUodWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpIHByaXZhdGUgewogICAgICAgIHVpbnQyNTYgZW5kID0gbm93ICsgNSBtaW51dGVzOwogICAgICAgIC8vIHVpbnQyNTYgZW5kID0gbm93OwogICAgICAgIHNraW5zW3NraW5BSWRdLmNvb2xkb3duRW5kVGltZSA9IHVpbnQ2NChlbmQpOwogICAgICAgIHNraW5zW3NraW5CSWRdLmNvb2xkb3duRW5kVGltZSA9IHVpbnQ2NChlbmQpOwogICAgfQoKICAgIC8vIF9pc1ZhbGlkU2tpbjogd2hldGhlciBhbiBhY2NvdW50IGNhbiBtaXggdXNpbmcgdGhlc2Ugc2tpbnMKICAgIC8vIE1ha2Ugc3VyZSB0d28gdGhpbmdzOgogICAgLy8gMS4gdGhlc2UgdHdvIHNraW5zIGRvIGV4aXN0CiAgICAvLyAyLiB0aGlzIGFjY291bnQgb3ducyB0aGVzZSBza2lucwogICAgZnVuY3Rpb24gX2lzVmFsaWRTa2luKGFkZHJlc3MgYWNjb3VudCwgdWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gTWFrZSBzdXJlIHRob3NlIHR3byBza2lucyBiZWxvbmdzIHRvIHRoaXMgYWNjb3VudAogICAgICAgIGlmIChza2luQUlkID09IHNraW5CSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoKHNraW5BSWQgPT0gMCkgfHwgKHNraW5CSWQgPT0gMCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoKHNraW5BSWQgPj0gbmV4dFNraW5JZCkgfHwgKHNraW5CSWQgPj0gbmV4dFNraW5JZCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKHNraW5JZFRvT3duZXJbc2tpbkFJZF0gPT0gYWNjb3VudCkgJiYgKHNraW5JZFRvT3duZXJbc2tpbkJJZF0gPT0gYWNjb3VudCk7CiAgICB9CgogICAgLy8gX2lzTm90T25TYWxlOiB3aGV0aGVyIGEgc2tpbiBpcyBub3Qgb24gc2FsZQogICAgZnVuY3Rpb24gX2lzTm90T25TYWxlKHVpbnQyNTYgc2tpbklkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoaXNPblNhbGVbc2tpbklkXSA9PSBmYWxzZSk7CiAgICB9CgogICAgLy8gbWl4ICAKICAgIGZ1bmN0aW9uIG1peCh1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewoKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHNraW5zIGFyZSB2YWxpZAogICAgICAgIHJlcXVpcmUoX2lzVmFsaWRTa2luKG1zZy5zZW5kZXIsIHNraW5BSWQsIHNraW5CSWQpKTsKCiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBza2lucyBhcmUgbmVpdGhlciBvbiBzYWxlCiAgICAgICAgcmVxdWlyZShfaXNOb3RPblNhbGUoc2tpbkFJZCkgJiYgX2lzTm90T25TYWxlKHNraW5CSWQpKTsKCiAgICAgICAgLy8gQ2hlY2sgY29vbGRvd24KICAgICAgICByZXF1aXJlKF9pc0Nvb2xkb3duUmVhZHkoc2tpbkFJZCwgc2tpbkJJZCkpOwoKICAgICAgICAvLyBDaGVjayB0aGVzZSBza2lucyBhcmUgbm90IGluIGFub3RoZXIgcHJvY2VzcwogICAgICAgIHJlcXVpcmUoX2lzTm90TWl4aW5nKHNraW5BSWQsIHNraW5CSWQpKTsKCiAgICAgICAgLy8gU2V0IG5ldyBjb29sZG93biB0aW1lCiAgICAgICAgX3NldENvb2xkb3duRW5kVGltZShza2luQUlkLCBza2luQklkKTsKCiAgICAgICAgLy8gTWFyayBza2lucyBhcyBpbiBtaXhpbmcKICAgICAgICBza2luc1tza2luQUlkXS5taXhpbmdXaXRoSWQgPSB1aW50NjQoc2tpbkJJZCk7CiAgICAgICAgc2tpbnNbc2tpbkJJZF0ubWl4aW5nV2l0aElkID0gdWludDY0KHNraW5BSWQpOwoKICAgICAgICAvLyBFbWl0IE1peFN0YXJ0IGV2ZW50CiAgICAgICAgTWl4U3RhcnQobXNnLnNlbmRlciwgc2tpbkFJZCwgc2tpbkJJZCk7CiAgICB9CgogICAgLy8gTWl4aW5nIGF1dG8KICAgIGZ1bmN0aW9uIG1peEF1dG8odWludDI1NiBza2luQUlkLCB1aW50MjU2IHNraW5CSWQpIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHByZVBhaWRGZWUpOwoKICAgICAgICBtaXgoc2tpbkFJZCwgc2tpbkJJZCk7CgogICAgICAgIFNraW4gc3RvcmFnZSBza2luID0gc2tpbnNbc2tpbkFJZF07CgogICAgICAgIEF1dG9NaXgobXNnLnNlbmRlciwgc2tpbkFJZCwgc2tpbkJJZCwgc2tpbi5jb29sZG93bkVuZFRpbWUpOwogICAgfQoKICAgIC8vIEdldCBtaXhpbmcgcmVzdWx0LCByZXR1cm4gdGhlIHJlc3VsdGVkIHNraW4gaWQKICAgIGZ1bmN0aW9uIGdldE1peGluZ1Jlc3VsdCh1aW50MjU2IHNraW5BSWQsIHVpbnQyNTYgc2tpbkJJZCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIENoZWNrIHRoZXNlIHR3byBza2lucyBiZWxvbmdzIHRvIHRoZSBzYW1lIGFjY291bnQKICAgICAgICBhZGRyZXNzIGFjY291bnQgPSBza2luSWRUb093bmVyW3NraW5BSWRdOwogICAgICAgIHJlcXVpcmUoYWNjb3VudCA9PSBza2luSWRUb093bmVyW3NraW5CSWRdKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhlc2UgdHdvIHNraW5zIGFyZSBpbiB0aGUgc2FtZSBtaXhpbmcgcHJvY2VzcwogICAgICAgIFNraW4gc3RvcmFnZSBza2luQSA9IHNraW5zW3NraW5BSWRdOwogICAgICAgIFNraW4gc3RvcmFnZSBza2luQiA9IHNraW5zW3NraW5CSWRdOwogICAgICAgIHJlcXVpcmUoc2tpbkEubWl4aW5nV2l0aElkID09IHVpbnQ2NChza2luQklkKSk7CiAgICAgICAgcmVxdWlyZShza2luQi5taXhpbmdXaXRoSWQgPT0gdWludDY0KHNraW5BSWQpKTsKCiAgICAgICAgLy8gQ2hlY2sgY29vbGRvd24KICAgICAgICByZXF1aXJlKF9pc0Nvb2xkb3duUmVhZHkoc2tpbkFJZCwgc2tpbkJJZCkpOwoKICAgICAgICAvLyBDcmVhdGUgbmV3IHNraW4KICAgICAgICB1aW50MTI4IG5ld1NraW5BcHBlYXJhbmNlID0gbWl4Rm9ybXVsYS5jYWxjTmV3U2tpbkFwcGVhcmFuY2Uoc2tpbkEuYXBwZWFyYW5jZSwgc2tpbkIuYXBwZWFyYW5jZSk7CiAgICAgICAgU2tpbiBtZW1vcnkgbmV3U2tpbiA9IFNraW4oe2FwcGVhcmFuY2U6IG5ld1NraW5BcHBlYXJhbmNlLCBjb29sZG93bkVuZFRpbWU6IHVpbnQ2NChub3cpLCBtaXhpbmdXaXRoSWQ6IDB9KTsKICAgICAgICBza2luc1tuZXh0U2tpbklkXSA9IG5ld1NraW47CiAgICAgICAgc2tpbklkVG9Pd25lcltuZXh0U2tpbklkXSA9IGFjY291bnQ7CiAgICAgICAgaXNPblNhbGVbbmV4dFNraW5JZF0gPSBmYWxzZTsKICAgICAgICBuZXh0U2tpbklkKys7CgogICAgICAgIC8vIENsZWFyIG9sZCBza2lucwogICAgICAgIHNraW5BLm1peGluZ1dpdGhJZCA9IDA7CiAgICAgICAgc2tpbkIubWl4aW5nV2l0aElkID0gMDsKCiAgICAgICAgLy8gSW4gb3JkZXIgdG8gZGlzdGluZ3Vpc2ggY3JlYXRlZCBza2lucyBpbiBtaW50aW5nIHdpdGggZGVzdHJveWVkIHNraW5zCiAgICAgICAgLy8gc2tpbklkVG9Pd25lcltza2luQUlkXSA9IG93bmVyOwogICAgICAgIC8vIHNraW5JZFRvT3duZXJbc2tpbkJJZF0gPSBvd25lcjsKICAgICAgICBkZWxldGUgc2tpbklkVG9Pd25lcltza2luQUlkXTsKICAgICAgICBkZWxldGUgc2tpbklkVG9Pd25lcltza2luQklkXTsKICAgICAgICAvLyByZXF1aXJlKG51bVNraW5PZkFjY291bnRzW2FjY291bnRdID49IDIpOwogICAgICAgIG51bVNraW5PZkFjY291bnRzW2FjY291bnRdIC09IDE7CgogICAgICAgIE1peFN1Y2Nlc3MoYWNjb3VudCwgbmV4dFNraW5JZCAtIDEsIHNraW5BSWQsIHNraW5CSWQpOwogICAgfQp9Cgpjb250cmFjdCBTa2luTWFya2V0IGlzIFNraW5NaXggewoKICAgIC8vIEN1dCByYXRpbyBmb3IgYSB0cmFuc2FjdGlvbgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MTI4IHB1YmxpYyB0ckN1dCA9IDQwMDsKCiAgICAvLyBTYWxlIG9yZGVycyBsaXN0IAogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgZGVzaXJlZFByaWNlOwoKICAgIC8vIGV2ZW50cwogICAgZXZlbnQgUHV0T25TYWxlKGFkZHJlc3MgYWNjb3VudCwgdWludDI1NiBza2luSWQpOwogICAgZXZlbnQgV2l0aGRyYXdTYWxlKGFkZHJlc3MgYWNjb3VudCwgdWludDI1NiBza2luSWQpOwogICAgZXZlbnQgQnV5SW5NYXJrZXQoYWRkcmVzcyBidXllciwgdWludDI1NiBza2luSWQpOwoKICAgIC8vIGZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIHNldFRyQ3V0KHVpbnQyNTYgbmV3Q3V0KSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICB0ckN1dCA9IHVpbnQxMjgobmV3Q3V0KTsKICAgIH0KCiAgICAvLyBQdXQgYXNzZXQgb24gc2FsZQogICAgZnVuY3Rpb24gcHV0T25TYWxlKHVpbnQyNTYgc2tpbklkLCB1aW50MjU2IHByaWNlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gT25seSBvd25lciBvZiBza2luIHBhc3MKICAgICAgICByZXF1aXJlKHNraW5JZFRvT3duZXJbc2tpbklkXSA9PSBtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBza2luIGlzIG1peGluZyAKICAgICAgICByZXF1aXJlKHNraW5zW3NraW5JZF0ubWl4aW5nV2l0aElkID09IDApOwoKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHNraW4gaXMgYWxyZWFkeSBvbiBzYWxlCiAgICAgICAgcmVxdWlyZShpc09uU2FsZVtza2luSWRdID09IGZhbHNlKTsKCiAgICAgICAgcmVxdWlyZShwcmljZSA+IDApOyAKCiAgICAgICAgLy8gUHV0IG9uIHNhbGUKICAgICAgICBkZXNpcmVkUHJpY2Vbc2tpbklkXSA9IHByaWNlOwogICAgICAgIGlzT25TYWxlW3NraW5JZF0gPSB0cnVlOwoKICAgICAgICAvLyBFbWl0IHRoZSBBcHByb3ZhbCBldmVudAogICAgICAgIFB1dE9uU2FsZShtc2cuc2VuZGVyLCBza2luSWQpOwogICAgfQogIAogICAgLy8gV2l0aGRyYXcgYW4gc2FsZSBvcmRlcgogICAgZnVuY3Rpb24gd2l0aGRyYXdTYWxlKHVpbnQyNTYgc2tpbklkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHRoaXMgc2tpbiBpcyBvbiBzYWxlCiAgICAgICAgcmVxdWlyZShpc09uU2FsZVtza2luSWRdID09IHRydWUpOwogICAgICAgIAogICAgICAgIC8vIENhbiBvbmx5IHdpdGhkcmF3IHNlbGYncyBzYWxlCiAgICAgICAgcmVxdWlyZShza2luSWRUb093bmVyW3NraW5JZF0gPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIFdpdGhkcmF3CiAgICAgICAgaXNPblNhbGVbc2tpbklkXSA9IGZhbHNlOwogICAgICAgIGRlc2lyZWRQcmljZVtza2luSWRdID0gMDsKCiAgICAgICAgLy8gRW1pdCB0aGUgY2FuY2VsIGV2ZW50CiAgICAgICAgV2l0aGRyYXdTYWxlKG1zZy5zZW5kZXIsIHNraW5JZCk7CiAgICB9CiAKICAgIC8vIEJ1eSBza2luIGluIG1hcmtldAogICAgZnVuY3Rpb24gYnV5SW5NYXJrZXQodWludDI1NiBza2luSWQpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGlzIHNraW4gaXMgb24gc2FsZQogICAgICAgIHJlcXVpcmUoaXNPblNhbGVbc2tpbklkXSA9PSB0cnVlKTsKCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBza2luSWRUb093bmVyW3NraW5JZF07CgogICAgICAgIC8vIENoZWNrIHRoZSBzZW5kZXIgaXNuJ3QgdGhlIHNlbGxlcgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBzZWxsZXIpOwoKICAgICAgICB1aW50MjU2IF9wcmljZSA9IGRlc2lyZWRQcmljZVtza2luSWRdOwogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgcGF5IHZhbHVlIGlzIGVub3VnaAogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IF9wcmljZSk7CgogICAgICAgIC8vIEN1dCBhbmQgdGhlbiBzZW5kIHRoZSBwcm9jZWVkcyB0byBzZWxsZXIKICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gX3ByaWNlIC0gX2NvbXB1dGVDdXQoX3ByaWNlKTsKCiAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgc2tpbiBmcm9tIHNlbGxlciB0byBidXllcgogICAgICAgIG51bVNraW5PZkFjY291bnRzW3NlbGxlcl0gLT0gMTsKICAgICAgICBza2luSWRUb093bmVyW3NraW5JZF0gPSBtc2cuc2VuZGVyOwogICAgICAgIG51bVNraW5PZkFjY291bnRzW21zZy5zZW5kZXJdICs9IDE7CiAgICAgICAgaXNPblNhbGVbc2tpbklkXSA9IGZhbHNlOwogICAgICAgIGRlc2lyZWRQcmljZVtza2luSWRdID0gMDsKCiAgICAgICAgLy8gRW1pdCB0aGUgYnV5IGV2ZW50CiAgICAgICAgQnV5SW5NYXJrZXQobXNnLnNlbmRlciwgc2tpbklkKTsKICAgIH0KCiAgICAvLyBDb21wdXRlIHRoZSBtYXJrZXRDdXQKICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gX3ByaWNlICogdHJDdXQgLyAxMDAwMDsKICAgIH0KfQoKY29udHJhY3QgU2tpbk1pbnRpbmcgaXMgU2tpbk1hcmtldCB7CgogICAgLy8gTGltaXRzIHRoZSBudW1iZXIgb2Ygc2tpbnMgdGhlIGNvbnRyYWN0IG93bmVyIGNhbiBldmVyIGNyZWF0ZS4KICAgIHVpbnQyNTYgcHVibGljIHNraW5DcmVhdGVkTGltaXQgPSA1MDAwMDsKICAgIHVpbnQyNTYgcHVibGljIHNraW5DcmVhdGVkTnVtOwoKICAgIC8vIFRoZSBzdW1tb24gbnVtYmVycyBvZiBlYWNoIGFjY291dHM6IHdpbGwgYmUgY2xlYXJlZCBldmVyeSBkYXkKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFjY291dFRvU3VtbW9uTnVtOwoKICAgIC8vIFBheSBsZXZlbCBvZiBlYWNoIGFjY291dHMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFjY291dFRvUGF5TGV2ZWw7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhY2NvdW50c0xhc3RDbGVhclRpbWU7CgogICAgdWludDI1NiBwdWJsaWMgbGV2ZWxDbGVhclRpbWUgPSBub3c7CgogICAgLy8gcHJpY2UKICAgIHVpbnQyNTYgcHVibGljIGJhc2VTdW1tb25QcmljZSA9IDEgZmlubmV5OwogICAgdWludDI1NiBwdWJsaWMgYmxlYWNoUHJpY2UgPSAzMDAgZmlubmV5OyAgLy8gZG8gbm90IGNhbGwgdGhpcwoKICAgIC8vIFBheSBsZXZlbAogICAgdWludDI1Nls1XSBwdWJsaWMgbGV2ZWxTcGxpdHMgPSBbMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDUwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMjAwXTsKICAgIAogICAgdWludDI1Nls2XSBwdWJsaWMgcGF5TXVsdGlwbGUgPSBbMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQwXTsKCgogICAgLy8gZXZlbnRzCiAgICBldmVudCBDcmVhdGVOZXdTa2luKHVpbnQyNTYgc2tpbklkLCBhZGRyZXNzIGFjY291bnQpOwogICAgZXZlbnQgQmxlYWNoKHVpbnQyNTYgc2tpbklkLCB1aW50MTI4IG5ld0FwcGVhcmFuY2UpOwoKICAgIC8vIGZ1bmN0aW9ucwoKICAgIC8vIFNldCBwcmljZSAKICAgIGZ1bmN0aW9uIHNldEJhc2VTdW1tb25QcmljZSh1aW50MjU2IG5ld1ByaWNlKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBiYXNlU3VtbW9uUHJpY2UgPSBuZXdQcmljZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCbGVhY2hQcmljZSh1aW50MjU2IG5ld1ByaWNlKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBibGVhY2hQcmljZSA9IG5ld1ByaWNlOwogICAgfQoKICAgIC8vIENyZWF0ZSBiYXNlIHNraW4gZm9yIHNlbGwuIE9ubHkgb3duZXIgY2FuIGNyZWF0ZQogICAgZnVuY3Rpb24gY3JlYXRlU2tpbih1aW50MTI4IHNwZWNpZmllZEFwcGVhcmFuY2UsIHVpbnQyNTYgc2FsZVByaWNlKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICByZXF1aXJlKHNraW5DcmVhdGVkTnVtIDwgc2tpbkNyZWF0ZWRMaW1pdCk7CgogICAgICAgIC8vIENyZWF0ZSBzcGVjaWZpZWQgc2tpbgogICAgICAgIC8vIHVpbnQxMjggcmFuZG9tQXBwZWFyYW5jZSA9IG1peEZvcm11bGEucmFuZG9tU2tpbkFwcGVhcmFuY2UoKTsKICAgICAgICBTa2luIG1lbW9yeSBuZXdTa2luID0gU2tpbih7YXBwZWFyYW5jZTogc3BlY2lmaWVkQXBwZWFyYW5jZSwgY29vbGRvd25FbmRUaW1lOiB1aW50NjQobm93KSwgbWl4aW5nV2l0aElkOiAwfSk7CiAgICAgICAgc2tpbnNbbmV4dFNraW5JZF0gPSBuZXdTa2luOwogICAgICAgIHNraW5JZFRvT3duZXJbbmV4dFNraW5JZF0gPSBjb287CiAgICAgICAgaXNPblNhbGVbbmV4dFNraW5JZF0gPSBmYWxzZTsKCiAgICAgICAgLy8gRW1pdCB0aGUgY3JlYXRlIGV2ZW50CiAgICAgICAgQ3JlYXRlTmV3U2tpbihuZXh0U2tpbklkLCBjb28pOwoKICAgICAgICAvLyBQdXQgdGhpcyBza2luIG9uIHNhbGUKICAgICAgICBwdXRPblNhbGUobmV4dFNraW5JZCwgc2FsZVByaWNlKTsKCiAgICAgICAgbmV4dFNraW5JZCsrOwogICAgICAgIG51bVNraW5PZkFjY291bnRzW2Nvb10gKz0gMTsgICAKICAgICAgICBza2luQ3JlYXRlZE51bSArPSAxOwogICAgfQoKICAgIC8vIERvbmF0ZSBhIHNraW4gdG8gcGxheWVyLiBPbmx5IENPTyBjYW4gb3BlcmF0ZQogICAgZnVuY3Rpb24gZG9uYXRlU2tpbih1aW50MTI4IHNwZWNpZmllZEFwcGVhcmFuY2UsIGFkZHJlc3MgZG9uZWUpIGV4dGVybmFsIG9ubHlDT08gewogICAgICAgIFNraW4gbWVtb3J5IG5ld1NraW4gPSBTa2luKHthcHBlYXJhbmNlOiBzcGVjaWZpZWRBcHBlYXJhbmNlLCBjb29sZG93bkVuZFRpbWU6IHVpbnQ2NChub3cpLCBtaXhpbmdXaXRoSWQ6IDB9KTsKICAgICAgICBza2luc1tuZXh0U2tpbklkXSA9IG5ld1NraW47CiAgICAgICAgc2tpbklkVG9Pd25lcltuZXh0U2tpbklkXSA9IGRvbmVlOwogICAgICAgIGlzT25TYWxlW25leHRTa2luSWRdID0gZmFsc2U7CgogICAgICAgIC8vIEVtaXQgdGhlIGNyZWF0ZSBldmVudAogICAgICAgIENyZWF0ZU5ld1NraW4obmV4dFNraW5JZCwgZG9uZWUpOwoKICAgICAgICBuZXh0U2tpbklkKys7CiAgICAgICAgbnVtU2tpbk9mQWNjb3VudHNbZG9uZWVdICs9IDE7ICAgCiAgICAgICAgc2tpbkNyZWF0ZWROdW0gKz0gMTsKICAgIH0KCiAgICAvLyBTdW1tb24KICAgIGZ1bmN0aW9uIHN1bW1vbigpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gQ2xlYXIgZGFpbHkgc3VtbW9uIG51bWJlcnMKICAgICAgICBpZiAoYWNjb3VudHNMYXN0Q2xlYXJUaW1lW21zZy5zZW5kZXJdID09IHVpbnQyNTYoMCkpIHsKICAgICAgICAgICAgLy8gVGhpcyBhY2NvdW50J3MgZmlyc3QgdGltZSB0byBzdW1tb24sIHdlIGRvIG5vdCBuZWVkIHRvIGNsZWFyIHN1bW1vbiBudW1iZXJzCiAgICAgICAgICAgIGFjY291bnRzTGFzdENsZWFyVGltZVttc2cuc2VuZGVyXSA9IG5vdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoYWNjb3VudHNMYXN0Q2xlYXJUaW1lW21zZy5zZW5kZXJdIDwgbGV2ZWxDbGVhclRpbWUgJiYgbm93ID4gbGV2ZWxDbGVhclRpbWUpIHsKICAgICAgICAgICAgICAgIGFjY291dFRvU3VtbW9uTnVtW21zZy5zZW5kZXJdID0gMDsKICAgICAgICAgICAgICAgIGFjY291dFRvUGF5TGV2ZWxbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgICAgICAgICAgYWNjb3VudHNMYXN0Q2xlYXJUaW1lW21zZy5zZW5kZXJdID0gbm93OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHBheUxldmVsID0gYWNjb3V0VG9QYXlMZXZlbFttc2cuc2VuZGVyXTsKICAgICAgICB1aW50MjU2IHByaWNlID0gcGF5TXVsdGlwbGVbcGF5TGV2ZWxdICogYmFzZVN1bW1vblByaWNlOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHByaWNlKTsKCiAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBza2luCiAgICAgICAgdWludDEyOCByYW5kb21BcHBlYXJhbmNlID0gbWl4Rm9ybXVsYS5yYW5kb21Ta2luQXBwZWFyYW5jZShuZXh0U2tpbklkKTsKICAgICAgICAvLyB1aW50MTI4IHJhbmRvbUFwcGVhcmFuY2UgPSAwOwogICAgICAgIFNraW4gbWVtb3J5IG5ld1NraW4gPSBTa2luKHthcHBlYXJhbmNlOiByYW5kb21BcHBlYXJhbmNlLCBjb29sZG93bkVuZFRpbWU6IHVpbnQ2NChub3cpLCBtaXhpbmdXaXRoSWQ6IDB9KTsKICAgICAgICBza2luc1tuZXh0U2tpbklkXSA9IG5ld1NraW47CiAgICAgICAgc2tpbklkVG9Pd25lcltuZXh0U2tpbklkXSA9IG1zZy5zZW5kZXI7CiAgICAgICAgaXNPblNhbGVbbmV4dFNraW5JZF0gPSBmYWxzZTsKCiAgICAgICAgLy8gRW1pdCB0aGUgY3JlYXRlIGV2ZW50CiAgICAgICAgQ3JlYXRlTmV3U2tpbihuZXh0U2tpbklkLCBtc2cuc2VuZGVyKTsKCiAgICAgICAgbmV4dFNraW5JZCsrOwogICAgICAgIG51bVNraW5PZkFjY291bnRzW21zZy5zZW5kZXJdICs9IDE7CiAgICAgICAgCiAgICAgICAgYWNjb3V0VG9TdW1tb25OdW1bbXNnLnNlbmRlcl0gKz0gMTsKICAgICAgICAKICAgICAgICAvLyBIYW5kbGUgdGhlIHBheWxldmVsICAgICAgICAKICAgICAgICBpZiAocGF5TGV2ZWwgPCA1KSB7CiAgICAgICAgICAgIGlmIChhY2NvdXRUb1N1bW1vbk51bVttc2cuc2VuZGVyXSA+PSBsZXZlbFNwbGl0c1twYXlMZXZlbF0pIHsKICAgICAgICAgICAgICAgIGFjY291dFRvUGF5TGV2ZWxbbXNnLnNlbmRlcl0gPSBwYXlMZXZlbCArIDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gQmxlYWNoIHNvbWUgYXR0cmlidXRlcwogICAgZnVuY3Rpb24gYmxlYWNoKHVpbnQxMjggc2tpbklkLCB1aW50MTI4IGF0dHJpYnV0ZXMpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBtc2cuc2VuZGVyIGlzIG93bmVyIG9mIHRoZSBza2luIAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBza2luSWRUb093bmVyW3NraW5JZF0pOwoKICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHRoaXMgc2tpbiBpcyBvbiBzYWxlIAogICAgICAgIHJlcXVpcmUoaXNPblNhbGVbc2tpbklkXSA9PSBmYWxzZSk7CgogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlcmUgaXMgZW5vdWdoIG1vbmV5CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gYmxlYWNoUHJpY2UpOwoKICAgICAgICBTa2luIHN0b3JhZ2Ugb3JpZ2luU2tpbiA9IHNraW5zW3NraW5JZF07CiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGlzIHNraW4gaXMgaW4gbWl4aW5nIAogICAgICAgIHJlcXVpcmUob3JpZ2luU2tpbi5taXhpbmdXaXRoSWQgPT0gMCk7CgogICAgICAgIHVpbnQxMjggbmV3QXBwZWFyYW5jZSA9IG1peEZvcm11bGEuYmxlYWNoQXBwZWFyYW5jZShvcmlnaW5Ta2luLmFwcGVhcmFuY2UsIGF0dHJpYnV0ZXMpOwogICAgICAgIG9yaWdpblNraW4uYXBwZWFyYW5jZSA9IG5ld0FwcGVhcmFuY2U7CgogICAgICAgIC8vIEVtaXQgYmxlYWNoIGV2ZW50CiAgICAgICAgQmxlYWNoKHNraW5JZCwgbmV3QXBwZWFyYW5jZSk7CiAgICB9CgogICAgLy8gT3VyIGRhZW1vbiB3aWxsIGNsZWFyIGRhaWx5IHN1bW1vbiBudW1iZXJzCiAgICBmdW5jdGlvbiBjbGVhclN1bW1vbk51bSgpIGV4dGVybmFsIG9ubHlDT08gewogICAgICAgIHVpbnQyNTYgbmV4dERheSA9IGxldmVsQ2xlYXJUaW1lICsgMSBkYXlzOwogICAgICAgIGlmIChub3cgPiBuZXh0RGF5KSB7CiAgICAgICAgICAgIGxldmVsQ2xlYXJUaW1lID0gbmV4dERheTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
