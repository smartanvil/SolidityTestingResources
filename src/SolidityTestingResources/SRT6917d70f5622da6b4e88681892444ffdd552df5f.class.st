Class {
	#name : #SRT6917d70f5622da6b4e88681892444ffdd552df5f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6917d70f5622da6b4e88681892444ffdd552df5f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIEVSQzIwIEJhc2ljIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlNTg4ODQ4YjkwODA4OTg0OTc4NDhhOWZhNTgyODg4NDhjODljYjg2OGE4OCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+IgogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKiBAZGV2IGxpY2Vuc2U6ICJNSVQiLCBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogQGF1dGhvciBtb2RpZmljYXRpb246IERtaXRyaXkgS2hpemhpbnNraXkgQE1jRmx5LmFlcm8KICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBMZW5ndGhWYWxpZGF0b3Igc21hcnQgY29udHJhY3QgLSBmaXggRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTggTWNGbHkuYWVybwogKiBAYXV0aG9yIERtaXRyaXkgS2hpemhpbnNraXkKICogQGF1dGhvciAiTUlUIgogKi8KY29udHJhY3QgTGVuZ3RoVmFsaWRhdG9yIHsKICAgIG1vZGlmaWVyIHZhbGlkX3Nob3J0KHVpbnQgX2NudEFyZ3MpIHsKICAgICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID09IChfY250QXJncyAqIDMyICsgNCkpOwogICAgICAgIF87CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZSBzbWFydCBjb250cmFjdAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogQGF1dGhvciAiTWFudWVsIEFyYW96IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMzI1ZjUzNWM0NzU3NWU1MzQwNTM1ZDQ4NzI1NTVmNTM1YjVlMWM1MTVkNWYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBjYW5kaWRhdGU7CgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogICAgLyoqCiAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgKiBhY2NvdW50LgogICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCgogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gX3JlcXVlc3RfIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAqLwogICAgZnVuY3Rpb24gcmVxdWVzdE93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGNhbmRpZGF0ZSA9IG5ld093bmVyOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBBbGxvd3MgdGhlIF9ORVdfIGNhbmRpZGF0ZSB0byBjb21wbGV0ZSB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBoaW0uCiAgICAqLwogICAgZnVuY3Rpb24gY29uZmlybU93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGUgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgb3duZXIgPSBjYW5kaWRhdGU7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIGNhbmRpZGF0ZSk7ICAgICAgICAKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgTXVsdGlPd25lcnMgc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTggTWNGbHkuYWVybwogKiBAYXV0aG9yIERtaXRyaXkgS2hpemhpbnNraXkKICogQGF1dGhvciAiTUlUIgogKi8KY29udHJhY3QgTXVsdGlPd25lcnMgewoKICAgIGV2ZW50IEFjY2Vzc0dyYW50KGFkZHJlc3MgaW5kZXhlZCBvd25lcik7CiAgICBldmVudCBBY2Nlc3NSZXZva2UoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIG93bmVyczsKICAgIGFkZHJlc3MgcHVibGljIHB1Ymxpc2hlcjsKCgogICAgZnVuY3Rpb24gTXVsdGlPd25lcnMoKSBwdWJsaWMgewogICAgICAgIG93bmVyc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgcHVibGlzaGVyID0gbXNnLnNlbmRlcjsKICAgIH0KCgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgeyAKICAgICAgICByZXF1aXJlKG93bmVyc1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICBfOyAKICAgIH0KCgogICAgZnVuY3Rpb24gaXNPd25lcigpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG93bmVyc1ttc2cuc2VuZGVyXSA/IHRydWUgOiBmYWxzZTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2hlY2tPd25lcihhZGRyZXNzIG1heWJlX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBvd25lcnNbbWF5YmVfb3duZXJdID8gdHJ1ZSA6IGZhbHNlOwogICAgfQoKCiAgICBmdW5jdGlvbiBncmFudChhZGRyZXNzIF9vd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgb3duZXJzW19vd25lcl0gPSB0cnVlOwogICAgICAgIEFjY2Vzc0dyYW50KF9vd25lcik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHJldm9rZShhZGRyZXNzIF9vd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gcHVibGlzaGVyKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gX293bmVyKTsKCiAgICAgICAgb3duZXJzW19vd25lcl0gPSBmYWxzZTsKICAgICAgICBBY2Nlc3NSZXZva2UoX293bmVyKTsKICAgIH0KfQoKCgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogQGF1dGhvciAiTWFudWVsIEFyYW96IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNmEwNzBiMDQxZjBmMDYwYjE4MGIwNTEwMmEwZDA3MGIwMzA2NDQwOTA1MDciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCgogICAgLyoqCiAgICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgICAqLwogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgICAqLwogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKCgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBCYXNpY1Rva2VuIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlYTg3OGI4NDlmOGY4NjhiOTg4Yjg1OTBhYThkODc4YjgzODZjNDg5ODU4NyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+IgogKiBAZGV2IGxpY2Vuc2U6ICJNSVQiLCBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogQGF1dGhvciBtb2RpZmljYXRpb246IERtaXRyaXkgS2hpemhpbnNraXkgQE1jRmx5LmFlcm8KICovCgoKCgoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYywgTGVuZ3RoVmFsaWRhdG9yIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICB1aW50MjU2IHRvdGFsU3VwcGx5XzsKCiAgICAvKioKICAgICogQGRldiB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGluIGV4aXN0ZW5jZQogICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseV87CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHZhbGlkX3Nob3J0KDIpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgICAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTYgU21hcnQgQ29udHJhY3QgU29sdXRpb25zLCBJbmMuCiAqIEBhdXRob3IgIk1hbnVlbCBBcmFveiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjliZjZmYWY1ZWVmZWY3ZmFlOWZhZjRlMWRiZmNmNmZhZjJmN2I1ZjhmNGY2Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4iCiAqIEBkZXYgbGljZW5zZTogIk1JVCIsIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBAYXV0aG9yIG1vZGlmaWNhdGlvbjogRG1pdHJpeSBLaGl6aGluc2tpeSBATWNGbHkuYWVybwogKi8KCgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogQGF1dGhvciAiTWFudWVsIEFyYW96IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iODNlZWUyZWRmNmU2ZWZlMmYxZTJlY2Y5YzNlNGVlZTJlYWVmYWRlMGVjZWUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CiAgCiAgICAvKiogCiAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB2YWxpZF9zaG9ydCgzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICAqCiAgICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB2YWxpZF9zaG9ydCgyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICAqCiAgICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgKgogICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAqLwogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbiBzbWFydCBjb250cmFjdAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogQGF1dGhvciAiTWFudWVsIEFyYW96IDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMjQ0OTQ1NGE1MTQxNDg0NTU2NDU0YjVlNjQ0MzQ5NDU0ZDQ4MGE0NzRiNDkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqIEBkZXYgU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggbWludGFibGUgdG9rZW4gY3JlYXRpb24KICogQGRldiBJc3N1ZTogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2lzc3Vlcy8xMjAKICogQmFzZWQgb24gY29kZSBieSBUb2tlbk1hcmtldE5ldDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9jb250cmFjdHMvTWludGFibGVUb2tlbi5zb2wKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogICAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogICAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgICAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAqLwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCB2YWxpZF9zaG9ydCgyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHRvdGFsU3VwcGx5XyA9IHRvdGFsU3VwcGx5Xy5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAqLwogICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICBNaW50RmluaXNoZWQoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgTWNGbHkgdG9rZW4gc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTggTWNGbHkuYWVybwogKiBAYXV0aG9yIERtaXRyaXkgS2hpemhpbnNraXkKICogQGF1dGhvciAiTUlUIgogKi8KY29udHJhY3QgTWNGbHlUb2tlbiBpcyBNaW50YWJsZVRva2VuIHsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJNY0ZseVRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIk1jRmx5IjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIC8vLyBAZGV2IG1hcHBpbmcgZm9yIHdoaXRlbGlzdAogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSB3aGl0ZWxpc3Q7CgogICAgLy8vIEBkZXYgZXZlbnQgdGhyb3cgd2hlbiBhbGxvd2VkIHRvIHRyYW5zZmVyIGFkZHJlc3MgYWRkZWQgdG8gd2hpdGVsaXN0CiAgICAvLy8gQHBhcmFtIGZyb20gYWRkcmVzcwogICAgZXZlbnQgQWxsb3dUcmFuc2ZlcihhZGRyZXNzIGZyb20pOwoKICAgIC8vLyBAZGV2IGNoZWNrIGZvciBhbGxvd2VuY2Ugb2YgdHJhbnNmZXIKICAgIG1vZGlmaWVyIGNhblRyYW5zZmVyKCkgewogICAgICAgIHJlcXVpcmUobWludGluZ0ZpbmlzaGVkIHx8IHdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsgICAgICAgIAogICAgfQoKICAgIC8vLyBAZGV2IGFkZCBhZGRyZXNzIHRvIHdoaXRlbGlzdAogICAgLy8vIEBwYXJhbSBmcm9tIGFkZHJlc3MgdG8gYWRkCiAgICBmdW5jdGlvbiBhbGxvd1RyYW5zZmVyKGFkZHJlc3MgZnJvbSkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgd2hpdGVsaXN0W2Zyb21dID0gdHJ1ZTsKICAgICAgICBBbGxvd1RyYW5zZmVyKGZyb20pOwogICAgfQoKICAgIC8vLyBAZGV2IERvIHRoZSB0cmFuc2ZlciBmcm9tIGFkZHJlc3MgdG8gYWRkcmVzcyB2YWx1ZQogICAgLy8vIEBwYXJhbSBmcm9tIGFkZHJlc3MgZnJvbQogICAgLy8vIEBwYXJhbSB0byBhZGRyZXNzIHRvCiAgICAvLy8gQHBhcmFtIHZhbHVlIHVpbnQyNTYKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGNhblRyYW5zZmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IERvIHRoZSB0cmFuc2ZlciBmcm9tIHRva2VuIGFkZHJlc3MgdG8gInRvIiBhZGRyZXNzIHZhbHVlCiAgICAvLy8gQHBhcmFtIHRvIGFkZHJlc3MgdG8KICAgIC8vLyBAcGFyYW0gdmFsdWUgdWludDI1NiB2YWx1ZQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgY2FuVHJhbnNmZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICAgIH0KfQoKCgoKCgoKLyoqCiAqIEB0aXRsZSBIYWx0YWJsZSBzbWFydCBjb250cmFjdCAtIGNvbnRyb2xzIG93bmVyIGFjY2VzcwogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxOCBNY0ZseS5hZXJvCiAqIEBhdXRob3IgRG1pdHJpeSBLaGl6aGluc2tpeQogKiBAYXV0aG9yICJNSVQiCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBNdWx0aU93bmVycyB7CiAgICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogICAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgICAgICByZXF1aXJlKCFoYWx0ZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICAgICAgcmVxdWlyZShoYWx0ZWQpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vLyBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYWx0ZWQgPSB0cnVlOwogICAgfQoKCiAgICAvLy8gQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgICAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIH0KCn0KCgoKLyoqCiAqIEB0aXRsZSBNY0ZseSBjcm93ZHNhbGUgc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTggTWNGbHkuYWVybwogKiBAYXV0aG9yIERtaXRyaXkgS2hpemhpbnNraXkKICogQGF1dGhvciAiTUlUIgogKiBAZGV2IGluaGVyaXRlZCBmcm9tIE11bHRpT3duZXJzICYgSGFsdGFibGUKICovCmNvbnRyYWN0IE1jRmx5Q3Jvd2QgaXMgTXVsdGlPd25lcnMsIEhhbHRhYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vLyBAZGV2IFRvdGFsIEVUSCByZWNlaXZlZCBkdXJpbmcgV0FWRVMsIFRMUDEuMiAmIHdpbmRvd1sxLTVdCiAgICB1aW50MjU2IHB1YmxpYyBjb3VudGVyX2luOyAvLyB0bHAyCiAgICAKICAgIC8vLyBAZGV2IG1pbmltdW0gRVRIIHRvIHBhcnRpc2lwYXRlIGluIHdpbmRvdyAxLTUKICAgIHVpbnQyNTYgcHVibGljIG1pbkVUSGluID0gMWUxODsgLy8gMSBFVEgKCiAgICAvLy8gQGRldiBUb2tlbgogICAgTWNGbHlUb2tlbiBwdWJsaWMgdG9rZW47CgogICAgLy8vIEBkZXYgV2l0aGRyYXcgd2FsbGV0CiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAgLy8vIEBkZXYgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXAgZm9yIFRMUCAxLjIsIG90aGVyIHZhbHVlcyBjYWxsY3VsYXRlZAogICAgdWludDI1NiBwdWJsaWMgc1QyOyAvLyBzdGFydFRpbWVUTFAyCiAgICB1aW50MjU2IGNvbnN0YW50IGRUTFAyID0gMTE4IGRheXM7IC8vIGRheXMgb2YgVExQMgogICAgdWludDI1NiBjb25zdGFudCBkQnQgPSA2MCBkYXlzOyAvLyBkYXlzIGJldHdlZW4gV2luZG93cwogICAgdWludDI1NiBjb25zdGFudCBkVyA9IDEyIGRheXM7IC8vIDEyIGRheXMgZm9yIDMsNCw1LDYsNyB3aW5kb3dzOwoKICAgIC8vLyBAZGV2IENhcCBtYXhpbXVtIHBvc3NpYmxlIHRva2VucyBmb3IgbWludGluZwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgaGFyZENhcEluVG9rZW5zID0gMTgwMGUyNDsgLy8gMSw4MDAsMDAwLDAwMCBNRkwKCiAgICAvLy8gQGRldiBtYXhpbXVtIHBvc3NpYmxlIHRva2VucyBmb3Igc2VsbCAKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pbnRDYXBJblRva2VucyA9IDEyNjBlMjQ7IC8vIDEsMjYwLDAwMCwwMDAgTUZMCgogICAgLy8vIEBkZXYgdG9rZW5zIGNyb3dkIHdpdGhpbiBUTFAyCiAgICB1aW50MjU2IHB1YmxpYyBjcm93ZFRva2Vuc1RMUDI7CgogICAgLy8vIEBkZXYgdG9rZW5zIGNyb3dkIGJlZm9yZSB0aGlzIGNvbnRyYWN0IChNRkwgdG9rZW5zKQogICAgdWludDI1NiBwcmVNY0ZseVRvdGFsU3VwcGx5OwoKICAgIC8vLyBAZGV2IG1heGltdW0gcG9zc2libGUgdG9rZW5zIGZvciBmdW5kIG1pbnRpbmcKICAgIHVpbnQyNTYgY29uc3RhbnQgZnVuZFRva2VucyA9IDI3MGUyNDsgLy8gMjcwLDAwMCwwMDAgTUZMCiAgICB1aW50MjU2IHB1YmxpYyBmdW5kVG90YWxTdXBwbHk7CiAgICBhZGRyZXNzIHB1YmxpYyBmdW5kTWludGluZ0FnZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAvLy8gQGRldiBtYXhpbXVtIHBvc3NpYmxlIHRva2VucyB0byBjb252ZXJ0IGZyb20gV0FWRVMKICAgIHVpbnQyNTYgd2F2ZXNUb2tlbnMgPSAxMDBlMjQ7IC8vIDEwMCwwMDAsMDAwIE1GTAogICAgYWRkcmVzcyBwdWJsaWMgd2F2ZXNBZ2VudDsKICAgIGFkZHJlc3MgcHVibGljIHdhdmVzR1c7CgogICAgLy8vIEBkZXYgVmVzdGluZyBwYXJhbSBmb3IgdGVhbSwgYWR2aXNvcnksIHJlc2VydmUuCiAgICB1aW50MjU2IFZlc3RpbmdQZXJpb2RJblNlY29uZHMgPSAzMCBkYXlzOyAvLyAyNCBtb250aAogICAgdWludDI1NiBWZXN0aW5nUGVyaW9kc0NvdW50ID0gMjQ7CgogICAgLy8vIEBkZXYgVGVhbSAxMCUKICAgIHVpbnQyNTYgX3RlYW1Ub2tlbnM7CiAgICB1aW50MjU2IHB1YmxpYyB0ZWFtVG90YWxTdXBwbHk7CiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtV2FsbGV0OwoKICAgIC8vLyBAZGV2IEJvdW50eSA1JSAoMiUgKyAzJSkKICAgIC8vLyBAZGV2IEJvdW50eSBvbmxpbmUgMiUKICAgIHVpbnQyNTYgX2JvdW50eU9ubGluZVRva2VuczsKICAgIGFkZHJlc3MgcHVibGljIGJvdW50eU9ubGluZVdhbGxldDsKICAgIGFkZHJlc3MgcHVibGljIGJvdW50eU9ubGluZUdXOwoKICAgIC8vLyBAZGV2IEJvdW50eSBvZmZsaW5lIDMlCiAgICB1aW50MjU2IF9ib3VudHlPZmZsaW5lVG9rZW5zOwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5T2ZmbGluZVdhbGxldDsKCiAgICAvLy8gQGRldiBBZHZpc29yeSA1JQogICAgdWludDI1NiBfYWR2aXNvcnlUb2tlbnM7CiAgICB1aW50MjU2IHB1YmxpYyBhZHZpc29yeVRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgYWR2aXNvcnlXYWxsZXQ7CgogICAgLy8vIEBkZXYgUmVzZXJ2ZWQgZm9yIGZ1dHVyZSA5JQogICAgdWludDI1NiBfcmVzZXJ2ZWRUb2tlbnM7CiAgICB1aW50MjU2IHB1YmxpYyByZXNlcnZlZFRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgcmVzZXJ2ZWRXYWxsZXQ7CgogICAgLy8vIEBkZXYgQWlyRHJvcCAxJQogICAgdWludDI1NiBfYWlyZHJvcFRva2VuczsKICAgIGFkZHJlc3MgcHVibGljIGFpcmRyb3BXYWxsZXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBhaXJkcm9wR1c7CgogICAgLy8vIEBkZXYgUHJlTWNGbHkgd2FsbGV0IChNRkwpCiAgICB1aW50MjU2IF9wcmVNY0ZseVRva2VuczsKICAgIGFkZHJlc3MgcHVibGljIHByZU1jRmx5V2FsbGV0OwoKICAgIC8vLyBAZGV2IFBwbCBzdHJ1Y3R1cmUgZm9yIFdpbjEtNQogICAgc3RydWN0IFBwbCB7CiAgICAgICAgYWRkcmVzcyBhZGRyOwogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgfQogICAgbWFwcGluZyAodWludDMyID0+IFBwbCkgcHVibGljIHBwbHM7CgogICAgLy8vIEBkZXYgV2luZG93IHN0cnVjdHVyZSBmb3IgV2luMS01CiAgICBzdHJ1Y3QgV2luZG93IHsKICAgICAgICBib29sIGFjdGl2ZTsKICAgICAgICB1aW50MjU2IHRvdGFsRXRoSW5XaW5kb3c7CiAgICAgICAgdWludDMyIHRvdGFsVHJhbnNDbnQ7CiAgICAgICAgdWludDMyIHJlZnVuZEluZGV4OwogICAgICAgIHVpbnQyNTYgdG9rZW5QZXJXaW5kb3c7CiAgICB9IAogICAgbWFwcGluZyAodWludDggPT4gV2luZG93KSBwdWJsaWMgd3c7CgoKICAgIC8vLyBAZGV2IEV2ZW50cwogICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFRva2VuUHVyY2hhc2VJbldpbmRvdyhhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQ4IHdpbm51bSwgdWludDMyIHRvdGFsY250LCB1aW50MjU2IHRvdGFsZXRoMSk7CiAgICBldmVudCBUcmFuc2Zlck9kZEV0aGVyKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBGdW5kTWludGluZyhhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgV2l0aGRyYXdWZXN0aW5nKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiBwZXJpb2QsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdmFsdWVUb3RhbCk7CiAgICBldmVudCBUb2tlbldpdGhkcmF3QXRXaW5kb3coYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IFNldEZ1bmRNaW50aW5nQWdlbnQoYWRkcmVzcyBuZXdBZ2VudCk7CiAgICBldmVudCBTZXRUZWFtV2FsbGV0KGFkZHJlc3MgbmV3VGVhbVdhbGxldCk7CiAgICBldmVudCBTZXRBZHZpc29yeVdhbGxldChhZGRyZXNzIG5ld0Fkdmlzb3J5V2FsbGV0KTsKICAgIGV2ZW50IFNldFJlc2VydmVkV2FsbGV0KGFkZHJlc3MgbmV3UmVzZXJ2ZWRXYWxsZXQpOwogICAgZXZlbnQgU2V0U3RhcnRUaW1lVExQMih1aW50MjU2IG5ld1N0YXJ0VGltZVRMUDIpOwogICAgZXZlbnQgU2V0TWluRVRIaW5jb21lKHVpbnQyNTYgbmV3TWluRVRIaW4pOwogICAgZXZlbnQgTmV3V2luZG93KHVpbnQ4IHdpbk51bSwgdWludDI1NiBhbW91bnRUb2tlbnNQZXJXaW4pOwogICAgZXZlbnQgVG9rZW5FVEgodWludDI1NiB0b3RhbEV0aCwgdWludDMyIHRvdGFsQ250KTsKCgogICAgLy8vIEBkZXYgY2hlY2sgZm9yIE5vbiB6ZXJvIHZhbHVlCiAgICBtb2RpZmllciB2YWxpZFB1cmNoYXNlKCkgewogICAgICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICAgICAgcmVxdWlyZShub25aZXJvUHVyY2hhc2UpOwogICAgICAgIF87ICAgICAgICAKICAgIH0KCiAgICAvLyBjb21tZW50IHRoaXMgZnVuY3Rpb25zIGFmdGVyIHRlc3QgcGFzc2VkICEhCiAgICAvKmZ1bmN0aW9uIGdldFBwbHModWludDMyIGluZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiAocHBsc1tpbmRleF0uYW1vdW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFBwbHNBZGRyKHVpbnQzMiBpbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gKHBwbHNbaW5kZXhdLmFkZHIpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0V3RvdGFsRXRoKHVpbnQ4IHdpbk51bSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKHd3W3dpbk51bV0udG90YWxFdGhJbldpbmRvdyk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRXdG9rZW4odWludDggd2luTnVtKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiAod3dbd2luTnVtXS50b2tlblBlcldpbmRvdyk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRXYWN0aXZlKHVpbnQ4IHdpbk51bSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKHd3W3dpbk51bV0uYWN0aXZlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFd0b3RhbFRyYW5zQ250KHVpbnQ4IHdpbk51bSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHJldHVybiAod3dbd2luTnVtXS50b3RhbFRyYW5zQ250KTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFdyZWZ1bmRJbmRleCh1aW50OCB3aW5OdW0pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MzIpIHsKICAgICAgICByZXR1cm4gKHd3W3dpbk51bV0ucmVmdW5kSW5kZXgpOwogICAgfSovCiAgICAvLyBFTkQgY29tbWVudCB0aGlzIGZ1bmN0aW9ucyBhZnRlciB0ZXN0IHBhc3NlZCAhIQoKCiAgICAvKioKICAgICAqIEBkZXYgY29uY3RydWN0b3Igb2YgY29udHJhY3QsIHNldCBtYWluIHBhcmFtcywgY3JlYXRlIG5ldyB0b2tlbiwgZG8gbWludGluZyBmb3Igc29tZSB3YWxsZXRzCiAgICAgKiBAcGFyYW0gX3N0YXJ0VGltZVRMUDIgLSBzZXQgZGF0ZSB0aW1lIG9mIHN0YXJ0aW5nIG9mIFRMUDIgKG1haW4gZGF0ZSEpCiAgICAgKiBAcGFyYW0gX3ByZU1jRmx5VG90YWxTdXBwbHkgLSBzZXQgYW1vdW50IGluIHdlaSB0b3RhbCBzdXBwbHkgb2YgcHJldmlvdXNlIGNvbnRyYWN0IChNRkwpCiAgICAgKiBAcGFyYW0gX3dhbGxldCAtIHdhbGxldCBmb3IgdHJhbnNmZXIgRVRIIHRvIGl0CiAgICAgKiBAcGFyYW0gX3dhdmVzQWdlbnQgLSB3YWxsZXQgZm9yIFdBVkVTIGd3CiAgICAgKiBAcGFyYW0gX3dhdmVzR1cgICAgLSB3YWxsZXQgZm9yIFdBVkVTIGd3CiAgICAgKiBAcGFyYW0gX2Z1bmRNaW50aW5nQWdlbnQgLSB3YWxsZXQgd2hvIGFsbG93ZWQgdG8gbWludCBiZWZvcmUgVExQMgogICAgICogQHBhcmFtIF90ZWFtV2FsbGV0IC0gd2FsbGV0IGZvciB0ZWFtIHZlc3RpbmcKICAgICAqIEBwYXJhbSBfYm91bnR5T25saW5lV2FsbGV0IC0gd2FsbGV0IGZvciBvbmxpbmUgYm91bnR5CiAgICAgKiBAcGFyYW0gX2JvdW50eU9ubGluZUdXIC0gd2FsbGV0IGZvciBvbmxpbmUgYm91bnR5IEdXCiAgICAgKiBAcGFyYW0gX2JvdW50eU9mZmxpbmVXYWxsZXQgLSB3YWxsZXQgZm9yIG9mZmxpbmUgYm91bnR5CiAgICAgKiBAcGFyYW0gX2Fkdmlzb3J5V2FsbGV0IC0gd2FsbGV0IGZvciBhZHZpc29yeSB2ZXN0aW5nCiAgICAgKiBAcGFyYW0gX3Jlc2VydmVkV2FsbGV0IC0gd2FsbGV0IGZvciByZXNlcnZlZCB2ZXN0aW5nCiAgICAgKiBAcGFyYW0gX2FpcmRyb3BXYWxsZXQgLSB3YWxsZXQgZm9yIGFpcmRyb3AKICAgICAqIEBwYXJhbSBfYWlyZHJvcEdXIC0gd2FsbGV0IGZvciBhaXJkcm9wIEdXCiAgICAgKiBAcGFyYW0gX3ByZU1jRmx5V2FsbGV0IC0gd2FsbGV0IGZvciB0cmFuc2ZlciBvbGQgTUZMLT5NY0ZseSAob25jZSkKICAgICAqLwogICAgZnVuY3Rpb24gTWNGbHlDcm93ZCgKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWVUTFAyLAogICAgICAgIHVpbnQyNTYgX3ByZU1jRmx5VG90YWxTdXBwbHksCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0LAogICAgICAgIGFkZHJlc3MgX3dhdmVzQWdlbnQsCiAgICAgICAgYWRkcmVzcyBfd2F2ZXNHVywKICAgICAgICBhZGRyZXNzIF9mdW5kTWludGluZ0FnZW50LAogICAgICAgIGFkZHJlc3MgX3RlYW1XYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfYm91bnR5T25saW5lV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2JvdW50eU9ubGluZUdXLAogICAgICAgIGFkZHJlc3MgX2JvdW50eU9mZmxpbmVXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfYWR2aXNvcnlXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfcmVzZXJ2ZWRXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfYWlyZHJvcFdhbGxldCwKICAgICAgICBhZGRyZXNzIF9haXJkcm9wR1csCiAgICAgICAgYWRkcmVzcyBfcHJlTWNGbHlXYWxsZXQKICAgICkgcHVibGljIAogICAgeyAgIAogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZVRMUDIgPj0gYmxvY2sudGltZXN0YW1wKTsKICAgICAgICByZXF1aXJlKF9wcmVNY0ZseVRvdGFsU3VwcGx5ID4gMCk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfd2F2ZXNBZ2VudCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3dhdmVzR1cgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9mdW5kTWludGluZ0FnZW50ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdGVhbVdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2JvdW50eU9ubGluZVdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2JvdW50eU9ubGluZUdXICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfYm91bnR5T2ZmbGluZVdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2Fkdmlzb3J5V2FsbGV0ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfcmVzZXJ2ZWRXYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9haXJkcm9wV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfYWlyZHJvcEdXICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfcHJlTWNGbHlXYWxsZXQgIT0gMHgwKTsKCiAgICAgICAgdG9rZW4gPSBuZXcgTWNGbHlUb2tlbigpOwoKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwoKICAgICAgICBzVDIgPSBfc3RhcnRUaW1lVExQMjsKICAgICAgICBzZXRTdGFydEVuZFRpbWVUTFAoX3N0YXJ0VGltZVRMUDIpOwoKICAgICAgICB3YXZlc0FnZW50ID0gX3dhdmVzQWdlbnQ7CiAgICAgICAgd2F2ZXNHVyA9IF93YXZlc0dXOwoKICAgICAgICBmdW5kTWludGluZ0FnZW50ID0gX2Z1bmRNaW50aW5nQWdlbnQ7CgogICAgICAgIHRlYW1XYWxsZXQgPSBfdGVhbVdhbGxldDsKICAgICAgICBib3VudHlPbmxpbmVXYWxsZXQgPSBfYm91bnR5T25saW5lV2FsbGV0OwogICAgICAgIGJvdW50eU9ubGluZUdXID0gX2JvdW50eU9ubGluZUdXOwogICAgICAgIGJvdW50eU9mZmxpbmVXYWxsZXQgPSBfYm91bnR5T2ZmbGluZVdhbGxldDsKICAgICAgICBhZHZpc29yeVdhbGxldCA9IF9hZHZpc29yeVdhbGxldDsKICAgICAgICByZXNlcnZlZFdhbGxldCA9IF9yZXNlcnZlZFdhbGxldDsKICAgICAgICBhaXJkcm9wV2FsbGV0ID0gX2FpcmRyb3BXYWxsZXQ7CiAgICAgICAgYWlyZHJvcEdXID0gX2FpcmRyb3BHVzsKICAgICAgICBwcmVNY0ZseVdhbGxldCA9IF9wcmVNY0ZseVdhbGxldDsKCiAgICAgICAgLy8vIEBkZXYgTWludCBhbGwgdG9rZW5zIGFuZCB0aGFuIGNvbnRyb2wgaXQgYnkgdmVzdGluZwogICAgICAgIF9wcmVNY0ZseVRva2VucyA9IF9wcmVNY0ZseVRvdGFsU3VwcGx5OyAvLyBNY0ZseSBmb3IgdGhhbnNmZXIgdG8gb2xkIE1GTCBvd25lcnMKICAgICAgICB0b2tlbi5taW50KHByZU1jRmx5V2FsbGV0LCBfcHJlTWNGbHlUb2tlbnMpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIocHJlTWNGbHlXYWxsZXQpOwogICAgICAgIGNyb3dkVG9rZW5zVExQMiA9IGNyb3dkVG9rZW5zVExQMi5hZGQoX3ByZU1jRmx5VG9rZW5zKTsKCiAgICAgICAgdG9rZW4ubWludCh3YXZlc0FnZW50LCB3YXZlc1Rva2Vucyk7IC8vIDEwMCwwMDAsMDAwIE1GTAogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIod2F2ZXNBZ2VudCk7CiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2Zlcih3YXZlc0dXKTsKICAgICAgICBjcm93ZFRva2Vuc1RMUDIgPSBjcm93ZFRva2Vuc1RMUDIuYWRkKHdhdmVzVG9rZW5zKTsKCiAgICAgICAgX3RlYW1Ub2tlbnMgPSAxODBlMjQ7IC8vIDE4MCwwMDAsMDAwIE1GTAogICAgICAgIHRva2VuLm1pbnQodGhpcywgX3RlYW1Ub2tlbnMpOyAvLyBtaW50IHRvIGNvbnRyYWN0IGFkZHJlc3MKCiAgICAgICAgX2JvdW50eU9ubGluZVRva2VucyA9IDM2ZTI0OyAvLyAzNiwwMDAsMDAwIE1GTAogICAgICAgIHRva2VuLm1pbnQoYm91bnR5T25saW5lV2FsbGV0LCBfYm91bnR5T25saW5lVG9rZW5zKTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKGJvdW50eU9ubGluZVdhbGxldCk7CiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2Zlcihib3VudHlPbmxpbmVHVyk7CgogICAgICAgIF9ib3VudHlPZmZsaW5lVG9rZW5zID0gNTRlMjQ7IC8vIDU0LDAwMCwwMDAgTUZMCiAgICAgICAgdG9rZW4ubWludChib3VudHlPZmZsaW5lV2FsbGV0LCBfYm91bnR5T2ZmbGluZVRva2Vucyk7CiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2Zlcihib3VudHlPZmZsaW5lV2FsbGV0KTsKCiAgICAgICAgX2Fkdmlzb3J5VG9rZW5zID0gOTBlMjQ7IC8vIDkwLDAwMCwwMDAgTUZMCiAgICAgICAgdG9rZW4ubWludCh0aGlzLCBfYWR2aXNvcnlUb2tlbnMpOwoKICAgICAgICBfcmVzZXJ2ZWRUb2tlbnMgPSAxNjJlMjQ7IC8vIDE2MiwwMDAsMDAwIE1GTAogICAgICAgIHRva2VuLm1pbnQodGhpcywgX3Jlc2VydmVkVG9rZW5zKTsKCiAgICAgICAgX2FpcmRyb3BUb2tlbnMgPSAxOGUyNDsgLy8gMTgsMDAwLDAwMCBNRkwKICAgICAgICB0b2tlbi5taW50KGFpcmRyb3BXYWxsZXQsIF9haXJkcm9wVG9rZW5zKTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKGFpcmRyb3BXYWxsZXQpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIoYWlyZHJvcEdXKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNoZWNrIGlzIFRMUDIgaXMgYWN0aXZlPwogICAgICogQHJldHVybiBmYWxzZSBpZiBjcm93ZCBUTFAyIGV2ZW50IHdhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoaW5QZXJpb2QoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgd2l0aGluUGVyaW9kVExQMiA9IChub3cgPj0gc1QyICYmIG5vdyA8PSAoc1QyK2RUTFAyKSk7CiAgICAgICAgcmV0dXJuIHdpdGhpblBlcmlvZFRMUDI7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBjaGVjayBpcyBUTFAyIGlzIGFjdGl2ZSBhbmQgbWludGluZyBOb3QgZmluaXNoZWQKICAgICAqIEByZXR1cm4gZmFsc2UgaWYgY3Jvd2QgZXZlbnQgd2FzIGVuZGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJ1bm5pbmcoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB3aXRoaW5QZXJpb2QoKSAmJiAhdG9rZW4ubWludGluZ0ZpbmlzaGVkKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBjaGVjayBjdXJyZW50IHN0YWdlIG5hbWUKICAgICAqIEByZXR1cm4gdWludDggc3RhZ2UgbnVtYmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YWdlTmFtZSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHVpbnQyNTYgZVQyID0gc1QyK2RUTFAyOwoKICAgICAgICBpZiAobm93IDwgc1QyKSB7cmV0dXJuIDEwMTt9IC8vIG5vdCBzdGFydGVkCiAgICAgICAgaWYgKG5vdyA+PSBzVDIgJiYgbm93IDw9IGVUMikge3JldHVybiAoMTAyKTt9IC8vIFRMUDEuMgoKICAgICAgICBpZiAobm93ID4gZVQyICYmIG5vdyA8IGVUMitkQnQpIHtyZXR1cm4gKDEwMyk7fSAvLyBwcmVUTFAxLjMKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0KSAmJiBub3cgPD0gKGVUMitkQnQrZFcpKSB7cmV0dXJuICgwKTt9IC8vIFRMUDEuMwogICAgICAgIGlmIChub3cgPiAoZVQyK2RCdCtkVykgJiYgbm93IDwgKGVUMitkQnQrZFcrZEJ0KSkge3JldHVybiAoMTA0KTt9IC8vIHByZVRMUDEuNAogICAgICAgIGlmIChub3cgPj0gKGVUMitkQnQrZFcrZEJ0KSAmJiBub3cgPD0gKGVUMitkQnQrZFcrZEJ0K2RXKSkge3JldHVybiAoMSk7fSAvLyBUTFAxLjQKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcrZEJ0K2RXKSAmJiBub3cgPCAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0KSkge3JldHVybiAoMTA1KTt9IC8vIHByZVRMUDEuNQogICAgICAgIGlmIChub3cgPj0gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcpKSB7cmV0dXJuICgyKTt9IC8vIFRMUDEuNQogICAgICAgIGlmIChub3cgPiAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXKSAmJiBub3cgPCAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNik7fSAvLyBwcmVUTFAxLjYKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0KSAmJiBub3cgPD0gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcpKSB7cmV0dXJuICgzKTt9IC8vIFRMUDEuNgogICAgICAgIGlmIChub3cgPiAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCtkVykgJiYgbm93IDwgKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0KSkge3JldHVybiAoMTA3KTt9IC8vIHByZVRMUDEuNwogICAgICAgIGlmIChub3cgPj0gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0KSAmJiBub3cgPD0gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXKSkge3JldHVybiAoNCk7fSAvLyBUTFAxLjciCiAgICAgICAgaWYgKG5vdyA+IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCtkVykpIHtyZXR1cm4gKDIwMCk7fSAvLyBGaW5pc2hlZAogICAgICAgIHJldHVybiAoMjAxKTsgLy8gdW5rbm93bgogICAgfQoKCiAgICAvKiogCiAgICAgKiBAZGV2IGNoYW5nZSBhZ2VudCBmb3IgbWludGluZwogICAgICogQHBhcmFtIGFnZW50IC0gbmV3IGFnZW50IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2V0RnVuZE1pbnRpbmdBZ2VudChhZGRyZXNzIGFnZW50KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBmdW5kTWludGluZ0FnZW50ID0gYWdlbnQ7CiAgICAgICAgU2V0RnVuZE1pbnRpbmdBZ2VudChhZ2VudCk7CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEBkZXYgY2hhbmdlIHdhbGxldCBmb3IgdGVhbSB2ZXN0aW5nICh0aGlzIG1ha2UgcG9zc2libGUgdG8gc2V0IHNtYXJ0LWNvbnRyYWN0IGFkZHJlc3MgbGF0ZXIpCiAgICAgKiBAcGFyYW0gX25ld1RlYW1XYWxsZXQgLSBuZXcgd2FsbGV0IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2V0VGVhbVdhbGxldChhZGRyZXNzIF9uZXdUZWFtV2FsbGV0KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICB0ZWFtV2FsbGV0ID0gX25ld1RlYW1XYWxsZXQ7CiAgICAgICAgU2V0VGVhbVdhbGxldChfbmV3VGVhbVdhbGxldCk7CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEBkZXYgY2hhbmdlIHdhbGxldCBmb3IgYWR2aXNvcnkgdmVzdGluZyAodGhpcyBtYWtlIHBvc3NpYmxlIHRvIHNldCBzbWFydC1jb250cmFjdCBhZGRyZXNzIGxhdGVyKQogICAgICogQHBhcmFtIF9uZXdBZHZpc29yeVdhbGxldCAtIG5ldyB3YWxsZXQgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXRBZHZpc29yeVdhbGxldChhZGRyZXNzIF9uZXdBZHZpc29yeVdhbGxldCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgYWR2aXNvcnlXYWxsZXQgPSBfbmV3QWR2aXNvcnlXYWxsZXQ7CiAgICAgICAgU2V0QWR2aXNvcnlXYWxsZXQoX25ld0Fkdmlzb3J5V2FsbGV0KTsKICAgIH0KCgogICAgLyoqIAogICAgICogQGRldiBjaGFuZ2Ugd2FsbGV0IGZvciByZXNlcnZlZCB2ZXN0aW5nICh0aGlzIG1ha2UgcG9zc2libGUgdG8gc2V0IHNtYXJ0LWNvbnRyYWN0IGFkZHJlc3MgbGF0ZXIpCiAgICAgKiBAcGFyYW0gX25ld1Jlc2VydmVkV2FsbGV0IC0gbmV3IHdhbGxldCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFJlc2VydmVkV2FsbGV0KGFkZHJlc3MgX25ld1Jlc2VydmVkV2FsbGV0KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXNlcnZlZFdhbGxldCA9IF9uZXdSZXNlcnZlZFdhbGxldDsKICAgICAgICBTZXRSZXNlcnZlZFdhbGxldChfbmV3UmVzZXJ2ZWRXYWxsZXQpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgY2hhbmdlIG1pbiBFVEggaW5jb21lIGR1cmluZyBXaW5kb3cxLTUKICAgICAqIEBwYXJhbSBfbWluRVRIaW4gLSBuZXcgbGltaXQKICAgICAqLwogICAgZnVuY3Rpb24gc2V0TWluRVRIaW4odWludDI1NiBfbWluRVRIaW4pIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIG1pbkVUSGluID0gX21pbkVUSGluOwogICAgICAgIFNldE1pbkVUSGluY29tZShfbWluRVRIaW4pOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgc2V0IFRMUDEuWCAoMi03KSBzdGFydCAmIGVuZCBkYXRlcwogICAgICogQHBhcmFtIF9hdCAtIG5ldyBvciBvbGQgc3RhcnQgZGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBzZXRTdGFydEVuZFRpbWVUTFAodWludDI1NiBfYXQpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDwgc1QyKTsgLy8gZm9yYmlkIGNoYW5nZSB0aW1lIHdoZW4gVExQMS4yIGlzIGFjdGl2ZQogICAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDwgX2F0KTsgLy8gc2hvdWxkIGJlIGdyZWF0IHRoYW4gY3VycmVudCBibG9jayB0aW1lc3RhbXAKCiAgICAgICAgc1QyID0gX2F0OwogICAgICAgIFNldFN0YXJ0VGltZVRMUDIoX2F0KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IExhcmdlIFRva2VuIEhvbGRlciBtaW50aW5nIAogICAgICogQHBhcmFtIHRvIC0gbWludCB0byBhZGRyZXNzCiAgICAgKiBAcGFyYW0gYW1vdW50IC0gaG93IG11Y2ggbWludAogICAgICovCiAgICBmdW5jdGlvbiBmdW5kTWludGluZyhhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkgc3RvcEluRW1lcmdlbmN5IHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZ1bmRNaW50aW5nQWdlbnQgfHwgaXNPd25lcigpKTsKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHNUMik7CiAgICAgICAgcmVxdWlyZShmdW5kVG90YWxTdXBwbHkgKyBhbW91bnQgPD0gZnVuZFRva2Vucyk7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50b3RhbFN1cHBseSgpICsgYW1vdW50IDw9IGhhcmRDYXBJblRva2Vucyk7CgogICAgICAgIGZ1bmRUb3RhbFN1cHBseSA9IGZ1bmRUb3RhbFN1cHBseS5hZGQoYW1vdW50KTsKICAgICAgICB0b2tlbi5taW50KHRvLCBhbW91bnQpOwogICAgICAgIEZ1bmRNaW50aW5nKHRvLCBhbW91bnQpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgY2FsY3VsYXRlIGFtb3VudAogICAgICogQHBhcmFtICBhbW91bnQgLSBldGhlciB0byBiZSBjb252ZXJ0ZWQgdG8gdG9rZW5zCiAgICAgKiBAcGFyYW0gIGF0IC0gY3VycmVudCB0aW1lCiAgICAgKiBAcGFyYW0gIF90b3RhbFN1cHBseSAtIHRvdGFsIHN1cHBsaWVkIHRva2VucwogICAgICogQHJldHVybiB0b2tlbnMgYW1vdW50IHRoYXQgd2Ugc2hvdWxkIHNlbmQgdG8gb3VyIGRlYXIgcHBsCiAgICAgKiBAcmV0dXJuIG9kZCBldGhlcnMgYW1vdW50LCB3aGljaCBjb250cmFjdCBzaG91bGQgc2VuZCBiYWNrCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbGNBbW91bnRBdCgKICAgICAgICB1aW50MjU2IGFtb3VudCwKICAgICAgICB1aW50MjU2IGF0LAogICAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5CiAgICApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KSAKICAgIHsKICAgICAgICB1aW50MjU2IGVzdGltYXRlOwogICAgICAgIHVpbnQyNTYgcHJpY2U7CiAgICAgICAgCiAgICAgICAgaWYgKGF0ID49IHNUMiAmJiBhdCA8PSAoc1QyK2RUTFAyKSkgewogICAgICAgICAgICBpZiAoYXQgPD0gc1QyICsgMTUgZGF5cykge3ByaWNlID0gMTJlMTM7fSBlbHNlIGlmIChhdCA8PSBzVDIgKyAzMCBkYXlzKSB7CiAgICAgICAgICAgICAgICBwcmljZSA9IDE0ZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgNDUgZGF5cykgewogICAgICAgICAgICAgICAgICAgIHByaWNlID0gMTZlMTM7fSBlbHNlIGlmIChhdCA8PSBzVDIgKyA2MCBkYXlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlID0gMThlMTM7fSBlbHNlIGlmIChhdCA8PSBzVDIgKyA3NSBkYXlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDIwZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgOTAgZGF5cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlID0gMjJlMTM7fSBlbHNlIGlmIChhdCA8PSBzVDIgKyAxMDUgZGF5cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDI0ZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgMTE4IGRheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlID0gMjZlMTM7fSBlbHNlIHtyZXZlcnQoKTt9CiAgICAgICAgfSBlbHNlIHtyZXZlcnQoKTt9CgogICAgICAgIGVzdGltYXRlID0gX3RvdGFsU3VwcGx5LmFkZChhbW91bnQubXVsKDFlMTgpLmRpdihwcmljZSkpOwoKICAgICAgICBpZiAoZXN0aW1hdGUgPiBoYXJkQ2FwSW5Ub2tlbnMpIHsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGhhcmRDYXBJblRva2Vucy5zdWIoX3RvdGFsU3VwcGx5KSwKICAgICAgICAgICAgICAgIGVzdGltYXRlLnN1YihoYXJkQ2FwSW5Ub2tlbnMpLm11bChwcmljZSkuZGl2KDFlMTgpCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoZXN0aW1hdGUuc3ViKF90b3RhbFN1cHBseSksIDApOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgZmFsbGJhY2sgZm9yIHByb2Nlc3NpbmcgZXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcmV0dXJuIGdldFRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHNlbGwgdG9rZW4gYW5kIHNlbmQgdG8gY29udHJpYnV0b3IgYWRkcmVzcwogICAgICogQHBhcmFtIGNvbnRyaWJ1dG9yIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW5zKGFkZHJlc3MgY29udHJpYnV0b3IpIHBheWFibGUgc3RvcEluRW1lcmdlbmN5IHZhbGlkUHVyY2hhc2UgcHVibGljIHsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50MjU2IG9kZEV0aGVyczsKICAgICAgICB1aW50MjU2IGV0aGVyczsKICAgICAgICB1aW50MjU2IF9hdDsKICAgICAgICB1aW50OCBfd2luTnVtOwoKICAgICAgICBfYXQgPSBibG9jay50aW1lc3RhbXA7CgogICAgICAgIHJlcXVpcmUoY29udHJpYnV0b3IgIT0gMHgwKTsKICAgICAgIAogICAgICAgIGlmICh3aXRoaW5QZXJpb2QoKSkgewogICAgICAgIAogICAgICAgICAgICAoYW1vdW50LCBvZGRFdGhlcnMpID0gY2FsY0Ftb3VudEF0KG1zZy52YWx1ZSwgX2F0LCB0b2tlbi50b3RhbFN1cHBseSgpKTsgIC8vIHJlY2hlY2shISEKICAKICAgICAgICAgICAgcmVxdWlyZShhbW91bnQgKyB0b2tlbi50b3RhbFN1cHBseSgpIDw9IGhhcmRDYXBJblRva2Vucyk7CgogICAgICAgICAgICBldGhlcnMgPSBtc2cudmFsdWUuc3ViKG9kZEV0aGVycyk7CgogICAgICAgICAgICB0b2tlbi5taW50KGNvbnRyaWJ1dG9yLCBhbW91bnQpOyAvLyBmYWlsIGlmIG1pbnRpbmcgaXMgZmluaXNoZWQKICAgICAgICAgICAgVG9rZW5QdXJjaGFzZShjb250cmlidXRvciwgZXRoZXJzLCBhbW91bnQpOwogICAgICAgICAgICBjb3VudGVyX2luID0gY291bnRlcl9pbi5hZGQoZXRoZXJzKTsKICAgICAgICAgICAgY3Jvd2RUb2tlbnNUTFAyID0gY3Jvd2RUb2tlbnNUTFAyLmFkZChhbW91bnQpOwoKICAgICAgICAgICAgaWYgKG9kZEV0aGVycyA+IDApIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUob2RkRXRoZXJzIDwgbXNnLnZhbHVlKTsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dG9yLnRyYW5zZmVyKG9kZEV0aGVycyk7CiAgICAgICAgICAgICAgICBUcmFuc2Zlck9kZEV0aGVyKGNvbnRyaWJ1dG9yLCBvZGRFdGhlcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3YWxsZXQudHJhbnNmZXIoZXRoZXJzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5FVEhpbik7IC8vIGNoZWNrcyBtaW4gRVRIIGluY29tZQogICAgICAgICAgICBfd2luTnVtID0gc3RhZ2VOYW1lKCk7CiAgICAgICAgICAgIHJlcXVpcmUoX3dpbk51bSA+PSAwICYmIF93aW5OdW0gPCA1KTsKICAgICAgICAgICAgV2luZG93IHN0b3JhZ2UgdyA9IHd3W193aW5OdW1dOwoKICAgICAgICAgICAgcmVxdWlyZSh3LnRva2VuUGVyV2luZG93ID4gMCk7IC8vIGNoZWNrIHRoYXQgd2UgaGF2ZSB0b2tlbnMhCgogICAgICAgICAgICB3LnRvdGFsRXRoSW5XaW5kb3cgPSB3LnRvdGFsRXRoSW5XaW5kb3cuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIHBwbHNbdy50b3RhbFRyYW5zQ250XS5hZGRyID0gY29udHJpYnV0b3I7CiAgICAgICAgICAgIHBwbHNbdy50b3RhbFRyYW5zQ250XS5hbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgICAgIHcudG90YWxUcmFuc0NudCsrOwogICAgICAgICAgICBUb2tlblB1cmNoYXNlSW5XaW5kb3coY29udHJpYnV0b3IsIG1zZy52YWx1ZSwgX3dpbk51bSwgdy50b3RhbFRyYW5zQ250LCB3LnRvdGFsRXRoSW5XaW5kb3cpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNsb3NlIFdpbmRvdyBhbmQgdHJhbnNmZXIgRXRoIHRvIHdhbGxldCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3dpbk51bSAtIG51bWJlciBvZiB3aW5kb3cgMC00IHRvIGNsb3NlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlV2luZG93KHVpbnQ4IF93aW5OdW0pIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgcHVibGljIHsKICAgICAgICByZXF1aXJlKHd3W193aW5OdW1dLmFjdGl2ZSk7CiAgICAgICAgd3dbX3dpbk51bV0uYWN0aXZlID0gZmFsc2U7CgogICAgICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgdHJhbnNmZXIgdG9rZW5zIHRvIHBwbCBhY2N0cyAod2luZG93MS01KQogICAgICogQHBhcmFtIF93aW5OdW0gLSBudW1iZXIgb2Ygd2luZG93IDAtNCB0byBjbG9zZQogICAgICovCiAgICBmdW5jdGlvbiBzZW5kVG9rZW5zV2luZG93KHVpbnQ4IF93aW5OdW0pIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgcHVibGljIHsKICAgICAgICB1aW50MjU2IF90b2tlblBlckVUSDsKICAgICAgICB1aW50MjU2IF90b2tlblRvU2VuZCA9IDA7CiAgICAgICAgYWRkcmVzcyBfdGVtcEFkZHI7CiAgICAgICAgdWludDMyIGluZGV4ID0gd3dbX3dpbk51bV0ucmVmdW5kSW5kZXg7CgogICAgICAgIFRva2VuRVRIKHd3W193aW5OdW1dLnRvdGFsRXRoSW5XaW5kb3csIHd3W193aW5OdW1dLnRvdGFsVHJhbnNDbnQpOwoKICAgICAgICByZXF1aXJlKHd3W193aW5OdW1dLmFjdGl2ZSk7CiAgICAgICAgcmVxdWlyZSh3d1tfd2luTnVtXS50b3RhbEV0aEluV2luZG93ID4gMCk7CiAgICAgICAgcmVxdWlyZSh3d1tfd2luTnVtXS50b3RhbFRyYW5zQ250ID4gMCk7CgogICAgICAgIF90b2tlblBlckVUSCA9IHd3W193aW5OdW1dLnRva2VuUGVyV2luZG93LmRpdih3d1tfd2luTnVtXS50b3RhbEV0aEluV2luZG93KTsgLy8gbWF4IE1jRmx5IGluIHdpbmRvdyAvIGV0aEluV2luZG93CgogICAgICAgIHdoaWxlIChpbmRleCA8IHd3W193aW5OdW1dLnRvdGFsVHJhbnNDbnQgJiYgbXNnLmdhcyA+IDEwMDAwMCkgewogICAgICAgICAgICBfdG9rZW5Ub1NlbmQgPSBfdG9rZW5QZXJFVEgubXVsKHBwbHNbaW5kZXhdLmFtb3VudCk7CiAgICAgICAgICAgIHBwbHNbaW5kZXhdLmFtb3VudCA9IDA7CiAgICAgICAgICAgIF90ZW1wQWRkciA9IHBwbHNbaW5kZXhdLmFkZHI7CiAgICAgICAgICAgIHBwbHNbaW5kZXhdLmFkZHIgPSAwOwogICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICB0b2tlbi50cmFuc2ZlcihfdGVtcEFkZHIsIF90b2tlblRvU2VuZCk7CiAgICAgICAgICAgIFRva2VuV2l0aGRyYXdBdFdpbmRvdyhfdGVtcEFkZHIsIF90b2tlblRvU2VuZCk7CiAgICAgICAgfQogICAgICAgIHd3W193aW5OdW1dLnJlZnVuZEluZGV4ID0gaW5kZXg7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBvcGVuIG5ldyB3aW5kb3cgMC01IGFuZCB3cml0ZSB0b3RsIHRva2VuIHBlciB3aW5kb3cgaW4gc3RydWN0dXJlCiAgICAgKiBAcGFyYW0gX3dpbk51bSAtIG51bWJlciBvZiB3aW5kb3cgMC00IHRvIGNsb3NlCiAgICAgKiBAcGFyYW0gX3Rva2VuUGVyV2luZG93IC0gdG90YWwgdG9rZW4gZm9yIHdpbmRvdyAwLTQKICAgICAqLwogICAgZnVuY3Rpb24gbmV3V2luZG93KHVpbnQ4IF93aW5OdW0sIHVpbnQyNTYgX3Rva2VuUGVyV2luZG93KSBwcml2YXRlIHsKICAgICAgICB3d1tfd2luTnVtXSA9IFdpbmRvdyh0cnVlLCAwLCAwLCAwLCBfdG9rZW5QZXJXaW5kb3cpOwogICAgICAgIE5ld1dpbmRvdyhfd2luTnVtLCBfdG9rZW5QZXJXaW5kb3cpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgRmluaXNoIGNyb3dkc2FsZSBUTFAxLjIgcGVyaW9kIGFuZCBvcGVuIHdpbmRvdzEtNSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gZmluaXNoQ3Jvd2QoKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICB1aW50MjU2IF90b2tlblBlcldpbmRvdzsKICAgICAgICByZXF1aXJlKG5vdyA+IChzVDIuYWRkKGRUTFAyKSkgfHwgaGFyZENhcEluVG9rZW5zID09IHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgICAgIHJlcXVpcmUoIXRva2VuLm1pbnRpbmdGaW5pc2hlZCgpKTsKCiAgICAgICAgX3Rva2VuUGVyV2luZG93ID0gKG1pbnRDYXBJblRva2Vucy5zdWIoY3Jvd2RUb2tlbnNUTFAyKS5zdWIoZnVuZFRvdGFsU3VwcGx5KSkuZGl2KDUpOwogICAgICAgIHRva2VuLm1pbnQodGhpcywgX3Rva2VuUGVyV2luZG93Lm11bCg1KSk7IC8vIG1pbnQgdG8gY29udHJhY3QgYWRkcmVzcwogICAgICAgIC8vIHNob3VkIGJlIE1BWCB0b2tlbnMgbWludGVkISEhIDEsODAwLDAwMCwwMDAKICAgICAgICBmb3IgKHVpbnQ4IHkgPSAwOyB5IDwgNTsgeSsrKSB7CiAgICAgICAgICAgIG5ld1dpbmRvdyh5LCBfdG9rZW5QZXJXaW5kb3cpOwogICAgICAgIH0KCiAgICAgICAgdG9rZW4uZmluaXNoTWludGluZygpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgd2l0aGRyYXcgdG9rZW5zIGFtb3VudCB3aXRoaW4gdmVzdGluZyBydWxlcyBmb3IgdGVhbSwgYWR2aXNvcnkgYW5kIHJlc2VydmVkCiAgICAgKiBAcGFyYW0gd2l0aGRyYXdXYWxsZXQgLSB3YWxsZXQgdG8gdHJhbnNmZXIgdG9rZW5zCiAgICAgKiBAcGFyYW0gd2l0aGRyYXdUb2tlbnMgLSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyIHRvCiAgICAgKiBAcGFyYW0gd2l0aGRyYXdUb3RhbFN1cHBseSAtIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgdHJhbnNmZXJlZCB0byBhY2NvdW50CiAgICAgKiBAcmV0dXJuIHVuaXQyNTYgdG90YWwgYW1vdW50IG9mIHRva2VucyBhZnRlciB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiB2ZXN0aW5nV2l0aGRyYXcoYWRkcmVzcyB3aXRoZHJhd1dhbGxldCwgdWludDI1NiB3aXRoZHJhd1Rva2VucywgdWludDI1NiB3aXRoZHJhd1RvdGFsU3VwcGx5KSBwcml2YXRlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKHRva2VuLm1pbnRpbmdGaW5pc2hlZCgpKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gd2l0aGRyYXdXYWxsZXQgfHwgaXNPd25lcigpKTsKCiAgICAgICAgdWludDI1NiBjdXJyZW50UGVyaW9kID0gKGJsb2NrLnRpbWVzdGFtcC5zdWIoc1QyLmFkZChkVExQMikpKS5kaXYoVmVzdGluZ1BlcmlvZEluU2Vjb25kcyk7CiAgICAgICAgaWYgKGN1cnJlbnRQZXJpb2QgPiBWZXN0aW5nUGVyaW9kc0NvdW50KSB7CiAgICAgICAgICAgIGN1cnJlbnRQZXJpb2QgPSBWZXN0aW5nUGVyaW9kc0NvdW50OwogICAgICAgIH0KICAgICAgICB1aW50MjU2IHRva2VuQXZhaWxhYmxlID0gd2l0aGRyYXdUb2tlbnMubXVsKGN1cnJlbnRQZXJpb2QpLmRpdihWZXN0aW5nUGVyaW9kc0NvdW50KS5zdWIod2l0aGRyYXdUb3RhbFN1cHBseSk7ICAvLyBSRUNIRUNLISEhISEKCiAgICAgICAgcmVxdWlyZSh3aXRoZHJhd1RvdGFsU3VwcGx5ICsgdG9rZW5BdmFpbGFibGUgPD0gd2l0aGRyYXdUb2tlbnMpOwoKICAgICAgICB1aW50MjU2IF93aXRoZHJhd1RvdGFsU3VwcGx5ID0gd2l0aGRyYXdUb3RhbFN1cHBseSArIHRva2VuQXZhaWxhYmxlOwoKICAgICAgICB0b2tlbi50cmFuc2Zlcih3aXRoZHJhd1dhbGxldCwgdG9rZW5BdmFpbGFibGUpOwogICAgICAgIFdpdGhkcmF3VmVzdGluZyh3aXRoZHJhd1dhbGxldCwgY3VycmVudFBlcmlvZCwgdG9rZW5BdmFpbGFibGUsIF93aXRoZHJhd1RvdGFsU3VwcGx5KTsKCiAgICAgICAgcmV0dXJuIF93aXRoZHJhd1RvdGFsU3VwcGx5OwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgd2l0aGRyYXcgdG9rZW5zIGFtb3VudCB3aXRoaW4gdmVzdGluZyBydWxlcyBmb3IgdGVhbQogICAgICovCiAgICBmdW5jdGlvbiB0ZWFtV2l0aGRyYXcoKSBwdWJsaWMgewogICAgICAgIHRlYW1Ub3RhbFN1cHBseSA9IHZlc3RpbmdXaXRoZHJhdyh0ZWFtV2FsbGV0LCBfdGVhbVRva2VucywgdGVhbVRvdGFsU3VwcGx5KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHdpdGhkcmF3IHRva2VucyBhbW91bnQgd2l0aGluIHZlc3RpbmcgcnVsZXMgZm9yIGFkdmlzb3J5CiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkdmlzb3J5V2l0aGRyYXcoKSBwdWJsaWMgewogICAgICAgIGFkdmlzb3J5VG90YWxTdXBwbHkgPSB2ZXN0aW5nV2l0aGRyYXcoYWR2aXNvcnlXYWxsZXQsIF9hZHZpc29yeVRva2VucywgYWR2aXNvcnlUb3RhbFN1cHBseSk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiB3aXRoZHJhdyB0b2tlbnMgYW1vdW50IHdpdGhpbiB2ZXN0aW5nIHJ1bGVzIGZvciByZXNlcnZlZCB3YWxsZXQKICAgICAqLwogICAgZnVuY3Rpb24gcmVzZXJ2ZWRXaXRoZHJhdygpIHB1YmxpYyB7CiAgICAgICAgcmVzZXJ2ZWRUb3RhbFN1cHBseSA9IHZlc3RpbmdXaXRoZHJhdyhyZXNlcnZlZFdhbGxldCwgX3Jlc2VydmVkVG9rZW5zLCByZXNlcnZlZFRvdGFsU3VwcGx5KTsKICAgIH0KfQ=='.
	

]
