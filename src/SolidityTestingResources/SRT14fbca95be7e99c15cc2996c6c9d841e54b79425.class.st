Class {
	#name : #SRT14fbca95be7e99c15cc2996c6c9d841e54b79425,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT14fbca95be7e99c15cc2996c6c9d841e54b79425 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBEU0F1dGhvcml0eSB7CiAgICBmdW5jdGlvbiBjYW5DYWxsKAogICAgICAgIGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgYnl0ZXM0IHNpZwogICAgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRFNBdXRoRXZlbnRzIHsKICAgIGV2ZW50IExvZ1NldEF1dGhvcml0eSAoYWRkcmVzcyBpbmRleGVkIGF1dGhvcml0eSk7CiAgICBldmVudCBMb2dTZXRPd25lciAgICAgKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7Cn0KCmNvbnRyYWN0IERTQXV0aCBpcyBEU0F1dGhFdmVudHMgewogICAgRFNBdXRob3JpdHkgIHB1YmxpYyAgYXV0aG9yaXR5OwogICAgYWRkcmVzcyAgICAgIHB1YmxpYyAgb3duZXI7CgogICAgZnVuY3Rpb24gRFNBdXRoKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgTG9nU2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pCiAgICAgICAgcHVibGljCiAgICAgICAgYXV0aAogICAgewogICAgICAgIG93bmVyID0gb3duZXJfOwogICAgICAgIExvZ1NldE93bmVyKG93bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBdXRob3JpdHkoRFNBdXRob3JpdHkgYXV0aG9yaXR5XykKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgYXV0aG9yaXR5ID0gYXV0aG9yaXR5XzsKICAgICAgICBMb2dTZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKICAgIH0KCiAgICBtb2RpZmllciBhdXRoIHsKICAgICAgICByZXF1aXJlKGlzQXV0aG9yaXplZChtc2cuc2VuZGVyLCBtc2cuc2lnKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQoYWRkcmVzcyBzcmMsIGJ5dGVzNCBzaWcpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzcmMgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNyYyA9PSBvd25lcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGF1dGhvcml0eSA9PSBEU0F1dGhvcml0eSgwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eS5jYW5DYWxsKHNyYywgdGhpcywgc2lnKTsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IERTTWF0aCB7CiAgICBmdW5jdGlvbiBhZGQodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KICAgIGZ1bmN0aW9uIHN1Yih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQogICAgZnVuY3Rpb24gbXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoeSA9PSAwIHx8ICh6ID0geCAqIHkpIC8geSA9PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gbWF4KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltaW4oaW50IHgsIGludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1heChpbnQgeCwgaW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CgogICAgdWludCBjb25zdGFudCBXQUQgPSAxMCAqKiAxODsKICAgIHVpbnQgY29uc3RhbnQgUkFZID0gMTAgKiogMjc7CgogICAgZnVuY3Rpb24gd211bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCB5KSwgV0FEIC8gMikgLyBXQUQ7CiAgICB9CiAgICBmdW5jdGlvbiBybXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIHkpLCBSQVkgLyAyKSAvIFJBWTsKICAgIH0KICAgIGZ1bmN0aW9uIHdkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgV0FEKSwgeSAvIDIpIC8geTsKICAgIH0KICAgIGZ1bmN0aW9uIHJkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgUkFZKSwgeSAvIDIpIC8geTsKICAgIH0KCiAgICAvLyBUaGlzIGZhbW91cyBhbGdvcml0aG0gaXMgY2FsbGVkICJleHBvbmVudGlhdGlvbiBieSBzcXVhcmluZyIKICAgIC8vIGFuZCBjYWxjdWxhdGVzIHhebiB3aXRoIHggYXMgZml4ZWQtcG9pbnQgYW5kIG4gYXMgcmVndWxhciB1bnNpZ25lZC4KICAgIC8vCiAgICAvLyBJdCdzIE8obG9nIG4pLCBpbnN0ZWFkIG9mIE8obikgZm9yIG5haXZlIHJlcGVhdGVkIG11bHRpcGxpY2F0aW9uLgogICAgLy8KICAgIC8vIFRoZXNlIGZhY3RzIGFyZSB3aHkgaXQgd29ya3M6CiAgICAvLwogICAgLy8gIElmIG4gaXMgZXZlbiwgdGhlbiB4Xm4gPSAoeF4yKV4obi8yKS4KICAgIC8vICBJZiBuIGlzIG9kZCwgIHRoZW4geF5uID0geCAqIHheKG4tMSksCiAgICAvLyAgIGFuZCBhcHBseWluZyB0aGUgZXF1YXRpb24gZm9yIGV2ZW4geCBnaXZlcwogICAgLy8gICAgeF5uID0geCAqICh4XjIpXigobi0xKSAvIDIpLgogICAgLy8KICAgIC8vICBBbHNvLCBFVk0gZGl2aXNpb24gaXMgZmxvb3JpbmcgYW5kCiAgICAvLyAgICBmbG9vclsobi0xKSAvIDJdID0gZmxvb3JbbiAvIDJdLgogICAgLy8KICAgIGZ1bmN0aW9uIHJwb3codWludCB4LCB1aW50IG4pIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IG4gJSAyICE9IDAgPyB4IDogUkFZOwoKICAgICAgICBmb3IgKG4gLz0gMjsgbiAhPSAwOyBuIC89IDIpIHsKICAgICAgICAgICAgeCA9IHJtdWwoeCwgeCk7CgogICAgICAgICAgICBpZiAobiAlIDIgIT0gMCkgewogICAgICAgICAgICAgICAgeiA9IHJtdWwoeiwgeCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IEVSQzIwRXZlbnRzIHsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBzcmMsIGFkZHJlc3MgaW5kZXhlZCBndXksIHVpbnQgd2FkKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBzcmMsIGFkZHJlc3MgaW5kZXhlZCBkc3QsIHVpbnQgd2FkKTsKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBFdmVudHMgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGd1eSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZ3V5KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgZ3V5LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCB1aW50IHdhZAogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IEV2ZW50ZnVsTWFya2V0IHsKICAgIGV2ZW50IExvZ0l0ZW1VcGRhdGUodWludCBpZCk7CiAgICBldmVudCBMb2dUcmFkZSh1aW50IHBheV9hbXQsIGFkZHJlc3MgaW5kZXhlZCBwYXlfZ2VtLAogICAgICAgICAgICAgICAgICAgdWludCBidXlfYW10LCBhZGRyZXNzIGluZGV4ZWQgYnV5X2dlbSk7CgogICAgZXZlbnQgTG9nTWFrZSgKICAgICAgICBieXRlczMyICBpbmRleGVkICBpZCwKICAgICAgICBieXRlczMyICBpbmRleGVkICBwYWlyLAogICAgICAgIGFkZHJlc3MgIGluZGV4ZWQgIG1ha2VyLAogICAgICAgIEVSQzIwICAgICAgICAgICAgIHBheV9nZW0sCiAgICAgICAgRVJDMjAgICAgICAgICAgICAgYnV5X2dlbSwKICAgICAgICB1aW50MTI4ICAgICAgICAgICBwYXlfYW10LAogICAgICAgIHVpbnQxMjggICAgICAgICAgIGJ1eV9hbXQsCiAgICAgICAgdWludDY0ICAgICAgICAgICAgdGltZXN0YW1wCiAgICApOwoKICAgIGV2ZW50IExvZ0J1bXAoCiAgICAgICAgYnl0ZXMzMiAgaW5kZXhlZCAgaWQsCiAgICAgICAgYnl0ZXMzMiAgaW5kZXhlZCAgcGFpciwKICAgICAgICBhZGRyZXNzICBpbmRleGVkICBtYWtlciwKICAgICAgICBFUkMyMCAgICAgICAgICAgICBwYXlfZ2VtLAogICAgICAgIEVSQzIwICAgICAgICAgICAgIGJ1eV9nZW0sCiAgICAgICAgdWludDEyOCAgICAgICAgICAgcGF5X2FtdCwKICAgICAgICB1aW50MTI4ICAgICAgICAgICBidXlfYW10LAogICAgICAgIHVpbnQ2NCAgICAgICAgICAgIHRpbWVzdGFtcAogICAgKTsKCiAgICBldmVudCBMb2dUYWtlKAogICAgICAgIGJ5dGVzMzIgICAgICAgICAgIGlkLAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIHBhaXIsCiAgICAgICAgYWRkcmVzcyAgaW5kZXhlZCAgbWFrZXIsCiAgICAgICAgRVJDMjAgICAgICAgICAgICAgcGF5X2dlbSwKICAgICAgICBFUkMyMCAgICAgICAgICAgICBidXlfZ2VtLAogICAgICAgIGFkZHJlc3MgIGluZGV4ZWQgIHRha2VyLAogICAgICAgIHVpbnQxMjggICAgICAgICAgIHRha2VfYW10LAogICAgICAgIHVpbnQxMjggICAgICAgICAgIGdpdmVfYW10LAogICAgICAgIHVpbnQ2NCAgICAgICAgICAgIHRpbWVzdGFtcAogICAgKTsKCiAgICBldmVudCBMb2dLaWxsKAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIGlkLAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIHBhaXIsCiAgICAgICAgYWRkcmVzcyAgaW5kZXhlZCAgbWFrZXIsCiAgICAgICAgRVJDMjAgICAgICAgICAgICAgcGF5X2dlbSwKICAgICAgICBFUkMyMCAgICAgICAgICAgICBidXlfZ2VtLAogICAgICAgIHVpbnQxMjggICAgICAgICAgIHBheV9hbXQsCiAgICAgICAgdWludDEyOCAgICAgICAgICAgYnV5X2FtdCwKICAgICAgICB1aW50NjQgICAgICAgICAgICB0aW1lc3RhbXAKICAgICk7Cn0KCmNvbnRyYWN0IFNpbXBsZU1hcmtldCBpcyBFdmVudGZ1bE1hcmtldCwgRFNNYXRoIHsKCiAgICB1aW50IHB1YmxpYyBsYXN0X29mZmVyX2lkOwoKICAgIG1hcHBpbmcgKHVpbnQgPT4gT2ZmZXJJbmZvKSBwdWJsaWMgb2ZmZXJzOwoKICAgIGJvb2wgbG9ja2VkOwoKICAgIHN0cnVjdCBPZmZlckluZm8gewogICAgICAgIHVpbnQgICAgIHBheV9hbXQ7CiAgICAgICAgRVJDMjAgICAgcGF5X2dlbTsKICAgICAgICB1aW50ICAgICBidXlfYW10OwogICAgICAgIEVSQzIwICAgIGJ1eV9nZW07CiAgICAgICAgYWRkcmVzcyAgb3duZXI7CiAgICAgICAgdWludDY0ICAgdGltZXN0YW1wOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbl9idXkodWludCBpZCkgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbl9jYW5jZWwodWludCBpZCkgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKICAgICAgICByZXF1aXJlKGdldE93bmVyKGlkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbl9vZmZlciB7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBzeW5jaHJvbml6ZWQgewogICAgICAgIHJlcXVpcmUoIWxvY2tlZCk7CiAgICAgICAgbG9ja2VkID0gdHJ1ZTsKICAgICAgICBfOwogICAgICAgIGxvY2tlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQWN0aXZlKHVpbnQgaWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGFjdGl2ZSkgewogICAgICAgIHJldHVybiBvZmZlcnNbaWRdLnRpbWVzdGFtcCA+IDA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0T3duZXIodWludCBpZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXR1cm4gb2ZmZXJzW2lkXS5vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRPZmZlcih1aW50IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCwgRVJDMjAsIHVpbnQsIEVSQzIwKSB7CiAgICAgIHZhciBvZmZlciA9IG9mZmVyc1tpZF07CiAgICAgIHJldHVybiAob2ZmZXIucGF5X2FtdCwgb2ZmZXIucGF5X2dlbSwKICAgICAgICAgICAgICBvZmZlci5idXlfYW10LCBvZmZlci5idXlfZ2VtKTsKICAgIH0KCiAgICAvLyAtLS0tIFB1YmxpYyBlbnRyeXBvaW50cyAtLS0tIC8vCgogICAgZnVuY3Rpb24gYnVtcChieXRlczMyIGlkXykKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5fYnV5KHVpbnQyNTYoaWRfKSkKICAgIHsKICAgICAgICB2YXIgaWQgPSB1aW50MjU2KGlkXyk7CiAgICAgICAgTG9nQnVtcCgKICAgICAgICAgICAgaWRfLAogICAgICAgICAgICBrZWNjYWsyNTYob2ZmZXJzW2lkXS5wYXlfZ2VtLCBvZmZlcnNbaWRdLmJ1eV9nZW0pLAogICAgICAgICAgICBvZmZlcnNbaWRdLm93bmVyLAogICAgICAgICAgICBvZmZlcnNbaWRdLnBheV9nZW0sCiAgICAgICAgICAgIG9mZmVyc1tpZF0uYnV5X2dlbSwKICAgICAgICAgICAgdWludDEyOChvZmZlcnNbaWRdLnBheV9hbXQpLAogICAgICAgICAgICB1aW50MTI4KG9mZmVyc1tpZF0uYnV5X2FtdCksCiAgICAgICAgICAgIG9mZmVyc1tpZF0udGltZXN0YW1wCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBBY2NlcHQgZ2l2ZW4gYHF1YW50aXR5YCBvZiBhbiBvZmZlci4gVHJhbnNmZXJzIGZ1bmRzIGZyb20gY2FsbGVyIHRvCiAgICAvLyBvZmZlciBtYWtlciwgYW5kIGZyb20gbWFya2V0IHRvIGNhbGxlci4KICAgIGZ1bmN0aW9uIGJ1eSh1aW50IGlkLCB1aW50IHF1YW50aXR5KQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbl9idXkoaWQpCiAgICAgICAgc3luY2hyb25pemVkCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBPZmZlckluZm8gbWVtb3J5IG9mZmVyID0gb2ZmZXJzW2lkXTsKICAgICAgICB1aW50IHNwZW5kID0gbXVsKHF1YW50aXR5LCBvZmZlci5idXlfYW10KSAvIG9mZmVyLnBheV9hbXQ7CgogICAgICAgIHJlcXVpcmUodWludDEyOChzcGVuZCkgPT0gc3BlbmQpOwogICAgICAgIHJlcXVpcmUodWludDEyOChxdWFudGl0eSkgPT0gcXVhbnRpdHkpOwoKICAgICAgICAvLyBGb3IgYmFja3dhcmRzIHNlbWFudGljIGNvbXBhdGliaWxpdHkuCiAgICAgICAgaWYgKHF1YW50aXR5ID09IDAgfHwgc3BlbmQgPT0gMCB8fAogICAgICAgICAgICBxdWFudGl0eSA+IG9mZmVyLnBheV9hbXQgfHwgc3BlbmQgPiBvZmZlci5idXlfYW10KQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgb2ZmZXJzW2lkXS5wYXlfYW10ID0gc3ViKG9mZmVyLnBheV9hbXQsIHF1YW50aXR5KTsKICAgICAgICBvZmZlcnNbaWRdLmJ1eV9hbXQgPSBzdWIob2ZmZXIuYnV5X2FtdCwgc3BlbmQpOwogICAgICAgIHJlcXVpcmUoIG9mZmVyLmJ1eV9nZW0udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIG9mZmVyLm93bmVyLCBzcGVuZCkgKTsKICAgICAgICByZXF1aXJlKCBvZmZlci5wYXlfZ2VtLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHF1YW50aXR5KSApOwoKICAgICAgICBMb2dJdGVtVXBkYXRlKGlkKTsKICAgICAgICBMb2dUYWtlKAogICAgICAgICAgICBieXRlczMyKGlkKSwKICAgICAgICAgICAga2VjY2FrMjU2KG9mZmVyLnBheV9nZW0sIG9mZmVyLmJ1eV9nZW0pLAogICAgICAgICAgICBvZmZlci5vd25lciwKICAgICAgICAgICAgb2ZmZXIucGF5X2dlbSwKICAgICAgICAgICAgb2ZmZXIuYnV5X2dlbSwKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgdWludDEyOChxdWFudGl0eSksCiAgICAgICAgICAgIHVpbnQxMjgoc3BlbmQpLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgTG9nVHJhZGUocXVhbnRpdHksIG9mZmVyLnBheV9nZW0sIHNwZW5kLCBvZmZlci5idXlfZ2VtKTsKCiAgICAgICAgaWYgKG9mZmVyc1tpZF0ucGF5X2FtdCA9PSAwKSB7CiAgICAgICAgICBkZWxldGUgb2ZmZXJzW2lkXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIENhbmNlbCBhbiBvZmZlci4gUmVmdW5kcyBvZmZlciBtYWtlci4KICAgIGZ1bmN0aW9uIGNhbmNlbCh1aW50IGlkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbl9jYW5jZWwoaWQpCiAgICAgICAgc3luY2hyb25pemVkCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIC8vIHJlYWQtb25seSBvZmZlci4gTW9kaWZ5IGFuIG9mZmVyIGJ5IGRpcmVjdGx5IGFjY2Vzc2luZyBvZmZlcnNbaWRdCiAgICAgICAgT2ZmZXJJbmZvIG1lbW9yeSBvZmZlciA9IG9mZmVyc1tpZF07CiAgICAgICAgZGVsZXRlIG9mZmVyc1tpZF07CgogICAgICAgIHJlcXVpcmUoIG9mZmVyLnBheV9nZW0udHJhbnNmZXIob2ZmZXIub3duZXIsIG9mZmVyLnBheV9hbXQpICk7CgogICAgICAgIExvZ0l0ZW1VcGRhdGUoaWQpOwogICAgICAgIExvZ0tpbGwoCiAgICAgICAgICAgIGJ5dGVzMzIoaWQpLAogICAgICAgICAgICBrZWNjYWsyNTYob2ZmZXIucGF5X2dlbSwgb2ZmZXIuYnV5X2dlbSksCiAgICAgICAgICAgIG9mZmVyLm93bmVyLAogICAgICAgICAgICBvZmZlci5wYXlfZ2VtLAogICAgICAgICAgICBvZmZlci5idXlfZ2VtLAogICAgICAgICAgICB1aW50MTI4KG9mZmVyLnBheV9hbXQpLAogICAgICAgICAgICB1aW50MTI4KG9mZmVyLmJ1eV9hbXQpLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CgogICAgICAgIHN1Y2Nlc3MgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGtpbGwoYnl0ZXMzMiBpZCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGNhbmNlbCh1aW50MjU2KGlkKSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2UoCiAgICAgICAgRVJDMjAgICAgcGF5X2dlbSwKICAgICAgICBFUkMyMCAgICBidXlfZ2VtLAogICAgICAgIHVpbnQxMjggIHBheV9hbXQsCiAgICAgICAgdWludDEyOCAgYnV5X2FtdAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJ5dGVzMzIgaWQpCiAgICB7CiAgICAgICAgcmV0dXJuIGJ5dGVzMzIob2ZmZXIocGF5X2FtdCwgcGF5X2dlbSwgYnV5X2FtdCwgYnV5X2dlbSkpOwogICAgfQoKICAgIC8vIE1ha2UgYSBuZXcgb2ZmZXIuIFRha2VzIGZ1bmRzIGZyb20gdGhlIGNhbGxlciBpbnRvIG1hcmtldCBlc2Nyb3cuCiAgICBmdW5jdGlvbiBvZmZlcih1aW50IHBheV9hbXQsIEVSQzIwIHBheV9nZW0sIHVpbnQgYnV5X2FtdCwgRVJDMjAgYnV5X2dlbSkKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5fb2ZmZXIKICAgICAgICBzeW5jaHJvbml6ZWQKICAgICAgICByZXR1cm5zICh1aW50IGlkKQogICAgewogICAgICAgIHJlcXVpcmUodWludDEyOChwYXlfYW10KSA9PSBwYXlfYW10KTsKICAgICAgICByZXF1aXJlKHVpbnQxMjgoYnV5X2FtdCkgPT0gYnV5X2FtdCk7CiAgICAgICAgcmVxdWlyZShwYXlfYW10ID4gMCk7CiAgICAgICAgcmVxdWlyZShwYXlfZ2VtICE9IEVSQzIwKDB4MCkpOwogICAgICAgIHJlcXVpcmUoYnV5X2FtdCA+IDApOwogICAgICAgIHJlcXVpcmUoYnV5X2dlbSAhPSBFUkMyMCgweDApKTsKICAgICAgICByZXF1aXJlKHBheV9nZW0gIT0gYnV5X2dlbSk7CgogICAgICAgIE9mZmVySW5mbyBtZW1vcnkgaW5mbzsKICAgICAgICBpbmZvLnBheV9hbXQgPSBwYXlfYW10OwogICAgICAgIGluZm8ucGF5X2dlbSA9IHBheV9nZW07CiAgICAgICAgaW5mby5idXlfYW10ID0gYnV5X2FtdDsKICAgICAgICBpbmZvLmJ1eV9nZW0gPSBidXlfZ2VtOwogICAgICAgIGluZm8ub3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGluZm8udGltZXN0YW1wID0gdWludDY0KG5vdyk7CiAgICAgICAgaWQgPSBfbmV4dF9pZCgpOwogICAgICAgIG9mZmVyc1tpZF0gPSBpbmZvOwoKICAgICAgICByZXF1aXJlKCBwYXlfZ2VtLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBwYXlfYW10KSApOwoKICAgICAgICBMb2dJdGVtVXBkYXRlKGlkKTsKICAgICAgICBMb2dNYWtlKAogICAgICAgICAgICBieXRlczMyKGlkKSwKICAgICAgICAgICAga2VjY2FrMjU2KHBheV9nZW0sIGJ1eV9nZW0pLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBwYXlfZ2VtLAogICAgICAgICAgICBidXlfZ2VtLAogICAgICAgICAgICB1aW50MTI4KHBheV9hbXQpLAogICAgICAgICAgICB1aW50MTI4KGJ1eV9hbXQpLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gdGFrZShieXRlczMyIGlkLCB1aW50MTI4IG1heFRha2VBbW91bnQpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShidXkodWludDI1NihpZCksIG1heFRha2VBbW91bnQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfbmV4dF9pZCgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIGxhc3Rfb2ZmZXJfaWQrKzsgcmV0dXJuIGxhc3Rfb2ZmZXJfaWQ7CiAgICB9Cn0KCi8vIFNpbXBsZSBNYXJrZXQgd2l0aCBhIG1hcmtldCBsaWZldGltZS4gV2hlbiB0aGUgY2xvc2VfdGltZSBoYXMgYmVlbiByZWFjaGVkLAovLyBvZmZlcnMgY2FuIG9ubHkgYmUgY2FuY2VsbGVkIChvZmZlciBhbmQgYnV5IHdpbGwgdGhyb3cpLgoKY29udHJhY3QgRXhwaXJpbmdNYXJrZXQgaXMgRFNBdXRoLCBTaW1wbGVNYXJrZXQgewogICAgdWludDY0IHB1YmxpYyBjbG9zZV90aW1lOwogICAgYm9vbCBwdWJsaWMgc3RvcHBlZDsKCiAgICAvLyBhZnRlciBjbG9zZV90aW1lIGhhcyBiZWVuIHJlYWNoZWQsIG5vIG5ldyBvZmZlcnMgYXJlIGFsbG93ZWQKICAgIG1vZGlmaWVyIGNhbl9vZmZlciB7CiAgICAgICAgcmVxdWlyZSghaXNDbG9zZWQoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBhZnRlciBjbG9zZSwgbm8gbmV3IGJ1eXMgYXJlIGFsbG93ZWQKICAgIG1vZGlmaWVyIGNhbl9idXkodWludCBpZCkgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKICAgICAgICByZXF1aXJlKCFpc0Nsb3NlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFmdGVyIGNsb3NlLCBhbnlvbmUgY2FuIGNhbmNlbCBhbiBvZmZlcgogICAgbW9kaWZpZXIgY2FuX2NhbmNlbCh1aW50IGlkKSB7CiAgICAgICAgcmVxdWlyZShpc0FjdGl2ZShpZCkpOwogICAgICAgIHJlcXVpcmUoaXNDbG9zZWQoKSB8fCAobXNnLnNlbmRlciA9PSBnZXRPd25lcihpZCkpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEV4cGlyaW5nTWFya2V0KHVpbnQ2NCBfY2xvc2VfdGltZSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBjbG9zZV90aW1lID0gX2Nsb3NlX3RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXNDbG9zZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBjbG9zZWQpIHsKICAgICAgICByZXR1cm4gc3RvcHBlZCB8fCBnZXRUaW1lKCkgPiBjbG9zZV90aW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ2NChub3cpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3AoKSBwdWJsaWMgYXV0aCB7CiAgICAgICAgc3RvcHBlZCA9IHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IERTTm90ZSB7CiAgICBldmVudCBMb2dOb3RlKAogICAgICAgIGJ5dGVzNCAgIGluZGV4ZWQgIHNpZywKICAgICAgICBhZGRyZXNzICBpbmRleGVkICBndXksCiAgICAgICAgYnl0ZXMzMiAgaW5kZXhlZCAgZm9vLAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIGJhciwKICAgICAgICB1aW50ICAgICAgICAgICAgICB3YWQsCiAgICAgICAgYnl0ZXMgICAgICAgICAgICAgZmF4CiAgICApIGFub255bW91czsKCiAgICBtb2RpZmllciBub3RlIHsKICAgICAgICBieXRlczMyIGZvbzsKICAgICAgICBieXRlczMyIGJhcjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBmb28gOj0gY2FsbGRhdGFsb2FkKDQpCiAgICAgICAgICAgIGJhciA6PSBjYWxsZGF0YWxvYWQoMzYpCiAgICAgICAgfQoKICAgICAgICBMb2dOb3RlKG1zZy5zaWcsIG1zZy5zZW5kZXIsIGZvbywgYmFyLCBtc2cudmFsdWUsIG1zZy5kYXRhKTsKCiAgICAgICAgXzsKICAgIH0KfQoKY29udHJhY3QgTWF0Y2hpbmdFdmVudHMgewogICAgZXZlbnQgTG9nQnV5RW5hYmxlZChib29sIGlzRW5hYmxlZCk7CiAgICBldmVudCBMb2dNaW5TZWxsKGFkZHJlc3MgcGF5X2dlbSwgdWludCBtaW5fYW1vdW50KTsKICAgIGV2ZW50IExvZ01hdGNoaW5nRW5hYmxlZChib29sIGlzRW5hYmxlZCk7CiAgICBldmVudCBMb2dVbnNvcnRlZE9mZmVyKHVpbnQgaWQpOwogICAgZXZlbnQgTG9nU29ydGVkT2ZmZXIodWludCBpZCk7CiAgICBldmVudCBMb2dBZGRUb2tlblBhaXJXaGl0ZWxpc3QoRVJDMjAgYmFzZVRva2VuLCBFUkMyMCBxdW90ZVRva2VuKTsKICAgIGV2ZW50IExvZ1JlbVRva2VuUGFpcldoaXRlbGlzdChFUkMyMCBiYXNlVG9rZW4sIEVSQzIwIHF1b3RlVG9rZW4pOwogICAgZXZlbnQgTG9nSW5zZXJ0KGFkZHJlc3Mga2VlcGVyLCB1aW50IGlkKTsKICAgIGV2ZW50IExvZ0RlbGV0ZShhZGRyZXNzIGtlZXBlciwgdWludCBpZCk7Cn0KCmNvbnRyYWN0IE1hdGNoaW5nTWFya2V0IGlzIE1hdGNoaW5nRXZlbnRzLCBFeHBpcmluZ01hcmtldCwgRFNOb3RlIHsKICAgIGJvb2wgcHVibGljIGJ1eUVuYWJsZWQgPSB0cnVlOyAgICAgIC8vYnV5IGVuYWJsZWQKICAgIGJvb2wgcHVibGljIG1hdGNoaW5nRW5hYmxlZCA9IHRydWU7IC8vdHJ1ZTogZW5hYmxlIG1hdGNoaW5nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZmFsc2U6IHJldmVydCB0byBleHBpcmluZyBtYXJrZXQKICAgIHN0cnVjdCBzb3J0SW5mbyB7CiAgICAgICAgdWludCBuZXh0OyAgLy9wb2ludHMgdG8gaWQgb2YgbmV4dCBoaWdoZXIgb2ZmZXIKICAgICAgICB1aW50IHByZXY7ICAvL3BvaW50cyB0byBpZCBvZiBwcmV2aW91cyBsb3dlciBvZmZlcgogICAgICAgIHVpbnQgZGVsYjsgIC8vdGhlIGJsb2NrbnVtYmVyIHdoZXJlIHRoaXMgZW50cnkgd2FzIG1hcmtlZCBmb3IgZGVsZXRlCiAgICB9CiAgICBtYXBwaW5nKHVpbnQgPT4gc29ydEluZm8pIHB1YmxpYyBfcmFuazsgICAgICAgICAgICAgICAgICAgICAvL2RvdWJseSBsaW5rZWQgbGlzdHMgb2Ygc29ydGVkIG9mZmVyIGlkcwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSkgcHVibGljIF9iZXN0OyAgLy9pZCBvZiB0aGUgaGlnaGVzdCBvZmZlciBmb3IgYSB0b2tlbiBwYWlyCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgX3NwYW47ICAvL251bWJlciBvZiBvZmZlcnMgc3RvcmVkIGZvciB0b2tlbiBwYWlyIGluIHNvcnRlZCBvcmRlcmJvb2sKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgX2R1c3Q7ICAgICAgICAgICAgICAgICAgICAgIC8vbWluaW11bSBzZWxsIGFtb3VudCBmb3IgYSB0b2tlbiB0byBhdm9pZCBkdXN0IG9mZmVycwogICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIHB1YmxpYyBfbmVhcjsgICAgICAgICAvL25leHQgdW5zb3J0ZWQgb2ZmZXIgaWQKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgX21lbnU7ICAgICAgLy93aGl0ZWxpc3QgdHJhY2tpbmcgd2hpY2ggdG9rZW4gcGFpcnMgY2FuIGJlIHRyYWRlZAogICAgdWludCBfaGVhZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ZpcnN0IHVuc29ydGVkIG9mZmVyIGlkCgogICAgLy9jaGVjayBpZiB0b2tlbiBwYWlyIGlzIGVuYWJsZWQKICAgIG1vZGlmaWVyIGlzV2hpdGVsaXN0KEVSQzIwIGJ1eV9nZW0sIEVSQzIwIHBheV9nZW0pIHsKICAgICAgICByZXF1aXJlKF9tZW51W2tlY2NhazI1NihidXlfZ2VtLCBwYXlfZ2VtKV0gfHwgX21lbnVba2VjY2FrMjU2KHBheV9nZW0sIGJ1eV9nZW0pXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBNYXRjaGluZ01hcmtldCh1aW50NjQgY2xvc2VfdGltZSkgRXhwaXJpbmdNYXJrZXQoY2xvc2VfdGltZSkgcHVibGljIHsKICAgIH0KCiAgICAvLyAtLS0tIFB1YmxpYyBlbnRyeXBvaW50cyAtLS0tIC8vCgogICAgZnVuY3Rpb24gbWFrZSgKICAgICAgICBFUkMyMCAgICBwYXlfZ2VtLAogICAgICAgIEVSQzIwICAgIGJ1eV9nZW0sCiAgICAgICAgdWludDEyOCAgcGF5X2FtdCwKICAgICAgICB1aW50MTI4ICBidXlfYW10CiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXR1cm4gYnl0ZXMzMihvZmZlcihwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdGFrZShieXRlczMyIGlkLCB1aW50MTI4IG1heFRha2VBbW91bnQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShidXkodWludDI1NihpZCksIG1heFRha2VBbW91bnQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBraWxsKGJ5dGVzMzIgaWQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShjYW5jZWwodWludDI1NihpZCkpKTsKICAgIH0KCiAgICAvLyBNYWtlIGEgbmV3IG9mZmVyLiBUYWtlcyBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW50byBtYXJrZXQgZXNjcm93LgogICAgLy8KICAgIC8vIElmIG1hdGNoaW5nIGlzIGVuYWJsZWQ6CiAgICAvLyAgICAgKiBjcmVhdGVzIG5ldyBvZmZlciB3aXRob3V0IHB1dHRpbmcgaXQgaW4KICAgIC8vICAgICAgIHRoZSBzb3J0ZWQgbGlzdC4KICAgIC8vICAgICAqIGF2YWlsYWJsZSB0byBhdXRob3JpemVkIGNvbnRyYWN0cyBvbmx5IQogICAgLy8gICAgICoga2VlcGVycyBzaG91bGQgY2FsbCBpbnNlcnQoaWQscG9zKQogICAgLy8gICAgICAgdG8gcHV0IG9mZmVyIGluIHRoZSBzb3J0ZWQgbGlzdC4KICAgIC8vCiAgICAvLyBJZiBtYXRjaGluZyBpcyBkaXNhYmxlZDoKICAgIC8vICAgICAqIGNhbGxzIGV4cGlyaW5nIG1hcmtldCdzIG9mZmVyKCkuCiAgICAvLyAgICAgKiBhdmFpbGFibGUgdG8gZXZlcnlvbmUgd2l0aG91dCBhdXRob3JpemF0aW9uLgogICAgLy8gICAgICogbm8gc29ydGluZyBpcyBkb25lLgogICAgLy8KICAgIGZ1bmN0aW9uIG9mZmVyKAogICAgICAgIHVpbnQgcGF5X2FtdCwgICAgLy9tYWtlciAoYXNrKSBzZWxsIGhvdyBtdWNoCiAgICAgICAgRVJDMjAgcGF5X2dlbSwgICAvL21ha2VyIChhc2spIHNlbGwgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IGJ1eV9hbXQsICAgIC8vdGFrZXIgKGFzaykgYnV5IGhvdyBtdWNoCiAgICAgICAgRVJDMjAgYnV5X2dlbSAgICAvL3Rha2VyIChhc2spIGJ1eSB3aGljaCB0b2tlbgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzV2hpdGVsaXN0KHBheV9nZW0sIGJ1eV9nZW0pCiAgICAgICAgLyogTk9UIHN5bmNocm9uaXplZCEhISAqLwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdmFyIGZuID0gbWF0Y2hpbmdFbmFibGVkID8gX29mZmVydSA6IHN1cGVyLm9mZmVyOwogICAgICAgIHJldHVybiBmbihwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtKTsKICAgIH0KCiAgICAvLyBNYWtlIGEgbmV3IG9mZmVyLiBUYWtlcyBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW50byBtYXJrZXQgZXNjcm93LgogICAgZnVuY3Rpb24gb2ZmZXIoCiAgICAgICAgdWludCBwYXlfYW10LCAgICAvL21ha2VyIChhc2spIHNlbGwgaG93IG11Y2gKICAgICAgICBFUkMyMCBwYXlfZ2VtLCAgIC8vbWFrZXIgKGFzaykgc2VsbCB3aGljaCB0b2tlbgogICAgICAgIHVpbnQgYnV5X2FtdCwgICAgLy9tYWtlciAoYXNrKSBidXkgaG93IG11Y2gKICAgICAgICBFUkMyMCBidXlfZ2VtLCAgIC8vbWFrZXIgKGFzaykgYnV5IHdoaWNoIHRva2VuCiAgICAgICAgdWludCBwb3MgICAgICAgICAvL3Bvc2l0aW9uIHRvIGluc2VydCBvZmZlciwgMCBzaG91bGQgYmUgdXNlZCBpZiB1bmtub3duCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgaXNXaGl0ZWxpc3QocGF5X2dlbSwgYnV5X2dlbSkKICAgICAgICAvKk5PVCBzeW5jaHJvbml6ZWQhISEgKi8KICAgICAgICBjYW5fb2ZmZXIKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBvZmZlcihwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtLCBwb3MsIGZhbHNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvZmZlcigKICAgICAgICB1aW50IHBheV9hbXQsICAgIC8vbWFrZXIgKGFzaykgc2VsbCBob3cgbXVjaAogICAgICAgIEVSQzIwIHBheV9nZW0sICAgLy9tYWtlciAoYXNrKSBzZWxsIHdoaWNoIHRva2VuCiAgICAgICAgdWludCBidXlfYW10LCAgICAvL21ha2VyIChhc2spIGJ1eSBob3cgbXVjaAogICAgICAgIEVSQzIwIGJ1eV9nZW0sICAgLy9tYWtlciAoYXNrKSBidXkgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IHBvcywgICAgICAgIC8vcG9zaXRpb24gdG8gaW5zZXJ0IG9mZmVyLCAwIHNob3VsZCBiZSB1c2VkIGlmIHVua25vd24KICAgICAgICBib29sIHJvdW5kaW5nICAgIC8vbWF0Y2ggImNsb3NlIGVub3VnaCIgb3JkZXJzPwogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzV2hpdGVsaXN0KHBheV9nZW0sIGJ1eV9nZW0pCiAgICAgICAgLypOT1Qgc3luY2hyb25pemVkISEhICovCiAgICAgICAgY2FuX29mZmVyCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKF9kdXN0W3BheV9nZW1dIDw9IHBheV9hbXQpOwoKICAgICAgICBpZiAobWF0Y2hpbmdFbmFibGVkKSB7CiAgICAgICAgICByZXR1cm4gX21hdGNobyhwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtLCBwb3MsIHJvdW5kaW5nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLm9mZmVyKHBheV9hbXQsIHBheV9nZW0sIGJ1eV9hbXQsIGJ1eV9nZW0pOwogICAgfQoKICAgIC8vVHJhbnNmZXJzIGZ1bmRzIGZyb20gY2FsbGVyIHRvIG9mZmVyIG1ha2VyLCBhbmQgZnJvbSBtYXJrZXQgdG8gY2FsbGVyLgogICAgZnVuY3Rpb24gYnV5KHVpbnQgaWQsIHVpbnQgYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIC8qTk9UIHN5bmNocm9uaXplZCEhISAqLwogICAgICAgIGNhbl9idXkoaWQpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB2YXIgZm4gPSBtYXRjaGluZ0VuYWJsZWQgPyBfYnV5cyA6IHN1cGVyLmJ1eTsKICAgICAgICByZXR1cm4gZm4oaWQsIGFtb3VudCk7CiAgICB9CgogICAgLy8gQ2FuY2VsIGFuIG9mZmVyLiBSZWZ1bmRzIG9mZmVyIG1ha2VyLgogICAgZnVuY3Rpb24gY2FuY2VsKHVpbnQgaWQpCiAgICAgICAgcHVibGljCiAgICAgICAgLypOT1Qgc3luY2hyb25pemVkISEhICovCiAgICAgICAgY2FuX2NhbmNlbChpZCkKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgaWYgKG1hdGNoaW5nRW5hYmxlZCkgewogICAgICAgICAgICBpZiAoaXNPZmZlclNvcnRlZChpZCkpIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoX3Vuc29ydChpZCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVxdWlyZShfaGlkZShpZCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdXBlci5jYW5jZWwoaWQpOyAgICAvL2RlbGV0ZSB0aGUgb2ZmZXIuCiAgICB9CgogICAgLy9pbnNlcnQgb2ZmZXIgaW50byB0aGUgc29ydGVkIGxpc3QKICAgIC8va2VlcGVycyBuZWVkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBpbnNlcnQoCiAgICAgICAgdWludCBpZCwgICAvL21ha2VyIChhc2spIGlkCiAgICAgICAgdWludCBwb3MgICAvL3Bvc2l0aW9uIHRvIGluc2VydCBpbnRvCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKCFpc09mZmVyU29ydGVkKGlkKSk7ICAgIC8vbWFrZSBzdXJlIG9mZmVyc1tpZF0gaXMgbm90IHlldCBzb3J0ZWQKICAgICAgICByZXF1aXJlKGlzQWN0aXZlKGlkKSk7ICAgICAgICAgIC8vbWFrZSBzdXJlIG9mZmVyc1tpZF0gaXMgYWN0aXZlCgogICAgICAgIF9oaWRlKGlkKTsgICAgICAgICAgICAgICAgICAgICAgLy9yZW1vdmUgb2ZmZXIgZnJvbSB1bnNvcnRlZCBvZmZlcnMgbGlzdAogICAgICAgIF9zb3J0KGlkLCBwb3MpOyAgICAgICAgICAgICAgICAgLy9wdXQgb2ZmZXIgaW50byB0aGUgc29ydGVkIG9mZmVycyBsaXN0CiAgICAgICAgTG9nSW5zZXJ0KG1zZy5zZW5kZXIsIGlkKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL2RlbGV0ZXMgX3JhbmsgW2lkXQogICAgLy8gIEZ1bmN0aW9uIHNob3VsZCBiZSBjYWxsZWQgYnkga2VlcGVycy4KICAgIGZ1bmN0aW9uIGRlbF9yYW5rKHVpbnQgaWQpCiAgICAgICAgcHVibGljCiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoIWlzQWN0aXZlKGlkKSAmJiBfcmFua1tpZF0uZGVsYiAhPSAwICYmIF9yYW5rW2lkXS5kZWxiIDwgYmxvY2subnVtYmVyIC0gMTApOwogICAgICAgIGRlbGV0ZSBfcmFua1tpZF07CiAgICAgICAgTG9nRGVsZXRlKG1zZy5zZW5kZXIsIGlkKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL3JldHVybnMgdHJ1ZSBpZiB0b2tlbiBpcyBzdWNjZXNmdWxseSBhZGRlZCB0byB3aGl0ZWxpc3QKICAgIC8vICBGdW5jdGlvbiBpcyB1c2VkIHRvIGFkZCBhIHRva2VuIHBhaXIgdG8gdGhlIHdoaXRlbGlzdAogICAgLy8gIEFsbCBpbmNvbWluZyBvZmZlcnMgYXJlIGNoZWNrZWQgYWdhaW5zdCB0aGUgd2hpdGVsaXN0LgogICAgZnVuY3Rpb24gYWRkVG9rZW5QYWlyV2hpdGVsaXN0KAogICAgICAgIEVSQzIwIGJhc2VUb2tlbiwKICAgICAgICBFUkMyMCBxdW90ZVRva2VuCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgYXV0aAogICAgICAgIG5vdGUKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZSghaXNUb2tlblBhaXJXaGl0ZWxpc3RlZChiYXNlVG9rZW4sIHF1b3RlVG9rZW4pKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoYmFzZVRva2VuKSAhPSAweDAgJiYgYWRkcmVzcyhxdW90ZVRva2VuKSAhPSAweDApOwoKICAgICAgICBfbWVudVtrZWNjYWsyNTYoYmFzZVRva2VuLCBxdW90ZVRva2VuKV0gPSB0cnVlOwogICAgICAgIExvZ0FkZFRva2VuUGFpcldoaXRlbGlzdChiYXNlVG9rZW4sIHF1b3RlVG9rZW4pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vcmV0dXJucyB0cnVlIGlmIHRva2VuIGlzIHN1Y2Nlc3NmdWxseSByZW1vdmVkIGZyb20gd2hpdGVsaXN0CiAgICAvLyAgRnVuY3Rpb24gaXMgdXNlZCB0byByZW1vdmUgYSB0b2tlbiBwYWlyIGZyb20gdGhlIHdoaXRlbGlzdC4KICAgIC8vICBBbGwgaW5jb21pbmcgb2ZmZXJzIGFyZSBjaGVja2VkIGFnYWluc3QgdGhlIHdoaXRlbGlzdC4KICAgIGZ1bmN0aW9uIHJlbVRva2VuUGFpcldoaXRlbGlzdCgKICAgICAgICBFUkMyMCBiYXNlVG9rZW4sCiAgICAgICAgRVJDMjAgcXVvdGVUb2tlbgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGF1dGgKICAgICAgICBub3RlCiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoaXNUb2tlblBhaXJXaGl0ZWxpc3RlZChiYXNlVG9rZW4sIHF1b3RlVG9rZW4pKTsKCiAgICAgICAgZGVsZXRlIF9tZW51W2tlY2NhazI1NihiYXNlVG9rZW4sIHF1b3RlVG9rZW4pXTsKICAgICAgICBkZWxldGUgX21lbnVba2VjY2FrMjU2KHF1b3RlVG9rZW4sIGJhc2VUb2tlbildOwogICAgICAgIExvZ1JlbVRva2VuUGFpcldoaXRlbGlzdChiYXNlVG9rZW4sIHF1b3RlVG9rZW4pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzVG9rZW5QYWlyV2hpdGVsaXN0ZWQoCiAgICAgICAgRVJDMjAgYmFzZVRva2VuLAogICAgICAgIEVSQzIwIHF1b3RlVG9rZW4KICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIChfbWVudVtrZWNjYWsyNTYoYmFzZVRva2VuLCBxdW90ZVRva2VuKV0gfHwgX21lbnVba2VjY2FrMjU2KHF1b3RlVG9rZW4sIGJhc2VUb2tlbildKTsKICAgIH0KCiAgICAvL3NldCB0aGUgbWluaW11bSBzZWxsIGFtb3VudCBmb3IgYSB0b2tlbgogICAgLy8gICAgRnVuY3Rpb24gaXMgdXNlZCB0byBhdm9pZCAiZHVzdCBvZmZlcnMiIHRoYXQgaGF2ZQogICAgLy8gICAgdmVyeSBzbWFsbCBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbGwsIGFuZCBpdCB3b3VsZAogICAgLy8gICAgY29zdCBtb3JlIGdhcyB0byBhY2NlcHQgdGhlIG9mZmVyLCB0aGFuIHRoZSB2YWx1ZQogICAgLy8gICAgb2YgdG9rZW5zIHJlY2VpdmVkLgogICAgZnVuY3Rpb24gc2V0TWluU2VsbCgKICAgICAgICBFUkMyMCBwYXlfZ2VtLCAgICAgLy90b2tlbiB0byBhc3NpZ24gbWluaW11bSBzZWxsIGFtb3VudCB0bwogICAgICAgIHVpbnQgZHVzdCAgICAgICAgICAvL21ha2VyIChhc2spIG1pbmltdW0gc2VsbCBhbW91bnQKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICAgICAgbm90ZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgX2R1c3RbcGF5X2dlbV0gPSBkdXN0OwogICAgICAgIExvZ01pblNlbGwocGF5X2dlbSwgZHVzdCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9yZXR1cm5zIHRoZSBtaW5pbXVtIHNlbGwgYW1vdW50IGZvciBhbiBvZmZlcgogICAgZnVuY3Rpb24gZ2V0TWluU2VsbCgKICAgICAgICBFUkMyMCBwYXlfZ2VtICAgICAgLy90b2tlbiBmb3Igd2hpY2ggbWluaW11bSBzZWxsIGFtb3VudCBpcyBxdWVyaWVkCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBfZHVzdFtwYXlfZ2VtXTsKICAgIH0KCiAgICAvL3NldCBidXkgZnVuY3Rpb25hbGl0eSBlbmFibGVkL2Rpc2FibGVkCiAgICBmdW5jdGlvbiBzZXRCdXlFbmFibGVkKGJvb2wgYnV5RW5hYmxlZF8pIHB1YmxpYyBhdXRoIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBidXlFbmFibGVkID0gYnV5RW5hYmxlZF87CiAgICAgICAgTG9nQnV5RW5hYmxlZChidXlFbmFibGVkKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL3NldCBtYXRjaGluZyBlbmFibGVkL2Rpc2FibGVkCiAgICAvLyAgICBJZiBtYXRjaGluZ0VuYWJsZWQgdHJ1ZShkZWZhdWx0KSwgdGhlbiBpbnNlcnRlZCBvZmZlcnMgYXJlIG1hdGNoZWQuCiAgICAvLyAgICBFeGNlcHQgdGhlIG9uZXMgaW5zZXJ0ZWQgYnkgY29udHJhY3RzLCBiZWNhdXNlIHRob3NlIGVuZCB1cAogICAgLy8gICAgaW4gdGhlIHVuc29ydGVkIGxpc3Qgb2Ygb2ZmZXJzLCB0aGF0IG11c3QgYmUgbGF0ZXIgc29ydGVkIGJ5CiAgICAvLyAgICBrZWVwZXJzIHVzaW5nIGluc2VydCgpLgogICAgLy8gICAgSWYgbWF0Y2hpbmdFbmFibGVkIGlzIGZhbHNlIHRoZW4gTWF0Y2hpbmdNYXJrZXQgaXMgcmV2ZXJ0ZWQgdG8gRXhwaXJpbmdNYXJrZXQsCiAgICAvLyAgICBhbmQgbWF0Y2hpbmcgaXMgbm90IGRvbmUsIGFuZCBzb3J0ZWQgbGlzdHMgYXJlIGRpc2FibGVkLgogICAgZnVuY3Rpb24gc2V0TWF0Y2hpbmdFbmFibGVkKGJvb2wgbWF0Y2hpbmdFbmFibGVkXykgcHVibGljIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgICAgIG1hdGNoaW5nRW5hYmxlZCA9IG1hdGNoaW5nRW5hYmxlZF87CiAgICAgICAgTG9nTWF0Y2hpbmdFbmFibGVkKG1hdGNoaW5nRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9yZXR1cm4gdGhlIGJlc3Qgb2ZmZXIgZm9yIGEgdG9rZW4gcGFpcgogICAgLy8gICAgICB0aGUgYmVzdCBvZmZlciBpcyB0aGUgbG93ZXN0IG9uZSBpZiBpdCdzIGFuIGFzaywKICAgIC8vICAgICAgYW5kIGhpZ2hlc3Qgb25lIGlmIGl0J3MgYSBiaWQgb2ZmZXIKICAgIGZ1bmN0aW9uIGdldEJlc3RPZmZlcihFUkMyMCBzZWxsX2dlbSwgRVJDMjAgYnV5X2dlbSkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBfYmVzdFtzZWxsX2dlbV1bYnV5X2dlbV07CiAgICB9CgogICAgLy9yZXR1cm4gdGhlIG5leHQgd29yc2Ugb2ZmZXIgaW4gdGhlIHNvcnRlZCBsaXN0CiAgICAvLyAgICAgIHRoZSB3b3JzZSBvZmZlciBpcyB0aGUgaGlnaGVyIG9uZSBpZiBpdHMgYW4gYXNrLAogICAgLy8gICAgICBhIGxvd2VyIG9uZSBpZiBpdHMgYSBiaWQgb2ZmZXIsCiAgICAvLyAgICAgIGFuZCBpbiBib3RoIGNhc2VzIHRoZSBuZXdlciBvbmUgaWYgdGhleSdyZSBlcXVhbC4KICAgIGZ1bmN0aW9uIGdldFdvcnNlT2ZmZXIodWludCBpZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBfcmFua1tpZF0ucHJldjsKICAgIH0KCiAgICAvL3JldHVybiB0aGUgbmV4dCBiZXR0ZXIgb2ZmZXIgaW4gdGhlIHNvcnRlZCBsaXN0CiAgICAvLyAgICAgIHRoZSBiZXR0ZXIgb2ZmZXIgaXMgaW4gdGhlIGxvd2VyIHByaWNlZCBvbmUgaWYgaXRzIGFuIGFzaywKICAgIC8vICAgICAgdGhlIG5leHQgaGlnaGVyIHByaWNlZCBvbmUgaWYgaXRzIGEgYmlkIG9mZmVyCiAgICAvLyAgICAgIGFuZCBpbiBib3RoIGNhc2VzIHRoZSBvbGRlciBvbmUgaWYgdGhleSdyZSBlcXVhbC4KICAgIGZ1bmN0aW9uIGdldEJldHRlck9mZmVyKHVpbnQgaWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIF9yYW5rW2lkXS5uZXh0OwogICAgfQoKICAgIC8vcmV0dXJuIHRoZSBhbW91bnQgb2YgYmV0dGVyIG9mZmVycyBmb3IgYSB0b2tlbiBwYWlyCiAgICBmdW5jdGlvbiBnZXRPZmZlckNvdW50KEVSQzIwIHNlbGxfZ2VtLCBFUkMyMCBidXlfZ2VtKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9zcGFuW3NlbGxfZ2VtXVtidXlfZ2VtXTsKICAgIH0KCiAgICAvL2dldCB0aGUgZmlyc3QgdW5zb3J0ZWQgb2ZmZXIgdGhhdCB3YXMgaW5zZXJ0ZWQgYnkgYSBjb250cmFjdAogICAgLy8gICAgICBDb250cmFjdHMgY2FuJ3QgY2FsY3VsYXRlIHRoZSBpbnNlcnRpb24gcG9zaXRpb24gb2YgdGhlaXIgb2ZmZXIgYmVjYXVzZSBpdCBpcyBub3QgYW4gTygxKSBvcGVyYXRpb24uCiAgICAvLyAgICAgIFRoZWlyIG9mZmVycyBnZXQgcHV0IGluIHRoZSB1bnNvcnRlZCBsaXN0IG9mIG9mZmVycy4KICAgIC8vICAgICAgS2VlcGVycyBjYW4gY2FsY3VsYXRlIHRoZSBpbnNlcnRpb24gcG9zaXRpb24gb2ZmY2hhaW4gYW5kIHBhc3MgaXQgdG8gdGhlIGluc2VydCgpIGZ1bmN0aW9uIHRvIGluc2VydAogICAgLy8gICAgICB0aGUgdW5zb3J0ZWQgb2ZmZXIgaW50byB0aGUgc29ydGVkIGxpc3QuIFVuc29ydGVkIG9mZmVycyB3aWxsIG5vdCBiZSBtYXRjaGVkLCBidXQgY2FuIGJlIGJvdWdodCB3aXRoIGJ1eSgpLgogICAgZnVuY3Rpb24gZ2V0Rmlyc3RVbnNvcnRlZE9mZmVyKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBfaGVhZDsKICAgIH0KCiAgICAvL2dldCB0aGUgbmV4dCB1bnNvcnRlZCBvZmZlcgogICAgLy8gICAgICBDYW4gYmUgdXNlZCB0byBjeWNsZSB0aHJvdWdoIGFsbCB0aGUgdW5zb3J0ZWQgb2ZmZXJzLgogICAgZnVuY3Rpb24gZ2V0TmV4dFVuc29ydGVkT2ZmZXIodWludCBpZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBfbmVhcltpZF07CiAgICB9CgogICAgZnVuY3Rpb24gaXNPZmZlclNvcnRlZCh1aW50IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIF9yYW5rW2lkXS5uZXh0ICE9IDAKICAgICAgICAgICAgICAgfHwgX3JhbmtbaWRdLnByZXYgIT0gMAogICAgICAgICAgICAgICB8fCBfYmVzdFtvZmZlcnNbaWRdLnBheV9nZW1dW29mZmVyc1tpZF0uYnV5X2dlbV0gPT0gaWQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbEFsbEFtb3VudChFUkMyMCBwYXlfZ2VtLCB1aW50IHBheV9hbXQsIEVSQzIwIGJ1eV9nZW0sIHVpbnQgbWluX2ZpbGxfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQgZmlsbF9hbXQpCiAgICB7CiAgICAgICAgdWludCBvZmZlcklkOwogICAgICAgIHdoaWxlIChwYXlfYW10ID4gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vd2hpbGUgdGhlcmUgaXMgYW1vdW50IHRvIHNlbGwKICAgICAgICAgICAgb2ZmZXJJZCA9IGdldEJlc3RPZmZlcihidXlfZ2VtLCBwYXlfZ2VtKTsgICAvL0dldCB0aGUgYmVzdCBvZmZlciBmb3IgdGhlIHRva2VuIHBhaXIKICAgICAgICAgICAgcmVxdWlyZShvZmZlcklkICE9IDApOyAgICAgICAgICAgICAgICAgICAgICAvL0ZhaWxzIGlmIHRoZXJlIGFyZSBub3QgbW9yZSBvZmZlcnMKCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIGEgY2hhbmNlIHRoYXQgcGF5X2FtdCBpcyBzbWFsbGVyIHRoYW4gMSB3ZWkgb2YgdGhlIG90aGVyIHRva2VuCiAgICAgICAgICAgIGlmIChwYXlfYW10ICogMSBldGhlciA8IHdkaXYob2ZmZXJzW29mZmVySWRdLmJ1eV9hbXQsIG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KSkgewogICAgICAgICAgICAgICAgYnJlYWs7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vV2UgY29uc2lkZXIgdGhhdCBhbGwgYW1vdW50IGlzIHNvbGQKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGF5X2FtdCA+PSBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCkgeyAgICAgICAgICAgICAgICAgICAgICAgLy9JZiBhbW91bnQgdG8gc2VsbCBpcyBoaWdoZXIgb3IgZXF1YWwgdGhhbiBjdXJyZW50IG9mZmVyIGFtb3VudCB0byBidXkKICAgICAgICAgICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCk7ICAgICAgICAgIC8vQWRkIGFtb3VudCBib3VnaHQgdG8gYWN1bXVsYXRvcgogICAgICAgICAgICAgICAgcGF5X2FtdCA9IHN1YihwYXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCk7ICAgICAgICAgICAgLy9EZWNyZWFzZSBhbW91bnQgdG8gc2VsbAogICAgICAgICAgICAgICAgdGFrZShieXRlczMyKG9mZmVySWQpLCB1aW50MTI4KG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KSk7ICAgLy9XZSB0YWtlIHRoZSB3aG9sZSBvZmZlcgogICAgICAgICAgICB9IGVsc2UgeyAvLyBpZiBsb3dlcgogICAgICAgICAgICAgICAgdmFyIGJhdXggPSBybXVsKHBheV9hbXQgKiAxMCAqKiA5LCByZGl2KG9mZmVyc1tvZmZlcklkXS5wYXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCkpIC8gMTAgKiogOTsKICAgICAgICAgICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBiYXV4KTsgICAgICAgICAvL0FkZCBhbW91bnQgYm91Z2h0IHRvIGFjdW11bGF0b3IKICAgICAgICAgICAgICAgIHRha2UoYnl0ZXMzMihvZmZlcklkKSwgdWludDEyOChiYXV4KSk7ICAvL1dlIHRha2UgdGhlIHBvcnRpb24gb2YgdGhlIG9mZmVyIHRoYXQgd2UgbmVlZAogICAgICAgICAgICAgICAgcGF5X2FtdCA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQWxsIGFtb3VudCBpcyBzb2xkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVxdWlyZShmaWxsX2FtdCA+PSBtaW5fZmlsbF9hbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eUFsbEFtb3VudChFUkMyMCBidXlfZ2VtLCB1aW50IGJ1eV9hbXQsIEVSQzIwIHBheV9nZW0sIHVpbnQgbWF4X2ZpbGxfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQgZmlsbF9hbXQpCiAgICB7CiAgICAgICAgdWludCBvZmZlcklkOwogICAgICAgIHdoaWxlIChidXlfYW10ID4gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vTWVhbndoaWxlIHRoZXJlIGlzIGFtb3VudCB0byBidXkKICAgICAgICAgICAgb2ZmZXJJZCA9IGdldEJlc3RPZmZlcihidXlfZ2VtLCBwYXlfZ2VtKTsgICAvL0dldCB0aGUgYmVzdCBvZmZlciBmb3IgdGhlIHRva2VuIHBhaXIKICAgICAgICAgICAgcmVxdWlyZShvZmZlcklkICE9IDApOwoKICAgICAgICAgICAgLy8gVGhlcmUgaXMgYSBjaGFuY2UgdGhhdCBidXlfYW10IGlzIHNtYWxsZXIgdGhhbiAxIHdlaSBvZiB0aGUgb3RoZXIgdG9rZW4KICAgICAgICAgICAgaWYgKGJ1eV9hbXQgKiAxIGV0aGVyIDwgd2RpdihvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCwgb2ZmZXJzW29mZmVySWRdLmJ1eV9hbXQpKSB7CiAgICAgICAgICAgICAgICBicmVhazsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9XZSBjb25zaWRlciB0aGF0IGFsbCBhbW91bnQgaXMgc29sZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChidXlfYW10ID49IG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KSB7ICAgICAgICAgICAgICAgICAgICAgICAvL0lmIGFtb3VudCB0byBidXkgaXMgaGlnaGVyIG9yIGVxdWFsIHRoYW4gY3VycmVudCBvZmZlciBhbW91bnQgdG8gc2VsbAogICAgICAgICAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIG9mZmVyc1tvZmZlcklkXS5idXlfYW10KTsgICAgICAgICAgLy9BZGQgYW1vdW50IHNvbGQgdG8gYWN1bXVsYXRvcgogICAgICAgICAgICAgICAgYnV5X2FtdCA9IHN1YihidXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCk7ICAgICAgICAgICAgLy9EZWNyZWFzZSBhbW91bnQgdG8gYnV5CiAgICAgICAgICAgICAgICB0YWtlKGJ5dGVzMzIob2ZmZXJJZCksIHVpbnQxMjgob2ZmZXJzW29mZmVySWRdLnBheV9hbXQpKTsgICAvL1dlIHRha2UgdGhlIHdob2xlIG9mZmVyCiAgICAgICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIGxvd2VyCiAgICAgICAgICAgICAgICBmaWxsX2FtdCA9IGFkZChmaWxsX2FtdCwgcm11bChidXlfYW10ICogMTAgKiogOSwgcmRpdihvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCwgb2ZmZXJzW29mZmVySWRdLnBheV9hbXQpKSAvIDEwICoqIDkpOyAvL0FkZCBhbW91bnQgc29sZCB0byBhY3VtdWxhdG9yCiAgICAgICAgICAgICAgICB0YWtlKGJ5dGVzMzIob2ZmZXJJZCksIHVpbnQxMjgoYnV5X2FtdCkpOyAgICAgICAgICAgICAgICAgICAvL1dlIHRha2UgdGhlIHBvcnRpb24gb2YgdGhlIG9mZmVyIHRoYXQgd2UgbmVlZAogICAgICAgICAgICAgICAgYnV5X2FtdCA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BbGwgYW1vdW50IGlzIGJvdWdodAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUoZmlsbF9hbXQgPD0gbWF4X2ZpbGxfYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCdXlBbW91bnQoRVJDMjAgYnV5X2dlbSwgRVJDMjAgcGF5X2dlbSwgdWludCBwYXlfYW10KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBmaWxsX2FtdCkgewogICAgICAgIHZhciBvZmZlcklkID0gZ2V0QmVzdE9mZmVyKGJ1eV9nZW0sIHBheV9nZW0pOyAgICAgICAgICAgLy9HZXQgYmVzdCBvZmZlciBmb3IgdGhlIHRva2VuIHBhaXIKICAgICAgICB3aGlsZSAocGF5X2FtdCA+IG9mZmVyc1tvZmZlcklkXS5idXlfYW10KSB7CiAgICAgICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCk7ICAvL0FkZCBhbW91bnQgdG8gYnV5IGFjY3VtdWxhdG9yCiAgICAgICAgICAgIHBheV9hbXQgPSBzdWIocGF5X2FtdCwgb2ZmZXJzW29mZmVySWRdLmJ1eV9hbXQpOyAgICAvL0RlY3JlYXNlIGFtb3VudCB0byBwYXkKICAgICAgICAgICAgaWYgKHBheV9hbXQgPiAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgd2Ugc3RpbGwgbmVlZCBtb3JlIG9mZmVycwogICAgICAgICAgICAgICAgb2ZmZXJJZCA9IGdldFdvcnNlT2ZmZXIob2ZmZXJJZCk7ICAgICAgICAgICAgICAgLy9XZSBsb29rIGZvciB0aGUgbmV4dCBiZXN0IG9mZmVyCiAgICAgICAgICAgICAgICByZXF1aXJlKG9mZmVySWQgIT0gMCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAvL0ZhaWxzIGlmIHRoZXJlIGFyZSBub3QgZW5vdWdoIG9mZmVycyB0byBjb21wbGV0ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBybXVsKHBheV9hbXQgKiAxMCAqKiA5LCByZGl2KG9mZmVyc1tvZmZlcklkXS5wYXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCkpIC8gMTAgKiogOSk7IC8vQWRkIHByb3BvcnRpb25hbCBhbW91bnQgb2YgbGFzdCBvZmZlciB0byBidXkgYWNjdW11bGF0b3IKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQYXlBbW91bnQoRVJDMjAgcGF5X2dlbSwgRVJDMjAgYnV5X2dlbSwgdWludCBidXlfYW10KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBmaWxsX2FtdCkgewogICAgICAgIHZhciBvZmZlcklkID0gZ2V0QmVzdE9mZmVyKGJ1eV9nZW0sIHBheV9nZW0pOyAgICAgICAgICAgLy9HZXQgYmVzdCBvZmZlciBmb3IgdGhlIHRva2VuIHBhaXIKICAgICAgICB3aGlsZSAoYnV5X2FtdCA+IG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KSB7CiAgICAgICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCk7ICAvL0FkZCBhbW91bnQgdG8gcGF5IGFjY3VtdWxhdG9yCiAgICAgICAgICAgIGJ1eV9hbXQgPSBzdWIoYnV5X2FtdCwgb2ZmZXJzW29mZmVySWRdLnBheV9hbXQpOyAgICAvL0RlY3JlYXNlIGFtb3VudCB0byBidXkKICAgICAgICAgICAgaWYgKGJ1eV9hbXQgPiAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgd2Ugc3RpbGwgbmVlZCBtb3JlIG9mZmVycwogICAgICAgICAgICAgICAgb2ZmZXJJZCA9IGdldFdvcnNlT2ZmZXIob2ZmZXJJZCk7ICAgICAgICAgICAgICAgLy9XZSBsb29rIGZvciB0aGUgbmV4dCBiZXN0IG9mZmVyCiAgICAgICAgICAgICAgICByZXF1aXJlKG9mZmVySWQgIT0gMCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAvL0ZhaWxzIGlmIHRoZXJlIGFyZSBub3QgZW5vdWdoIG9mZmVycyB0byBjb21wbGV0ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBybXVsKGJ1eV9hbXQgKiAxMCAqKiA5LCByZGl2KG9mZmVyc1tvZmZlcklkXS5idXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCkpIC8gMTAgKiogOSk7IC8vQWRkIHByb3BvcnRpb25hbCBhbW91bnQgb2YgbGFzdCBvZmZlciB0byBwYXkgYWNjdW11bGF0b3IKICAgIH0KCiAgICAvLyAtLS0tIEludGVybmFsIEZ1bmN0aW9ucyAtLS0tIC8vCgogICAgZnVuY3Rpb24gX2J1eXModWludCBpZCwgdWludCBhbW91bnQpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoYnV5RW5hYmxlZCk7CgogICAgICAgIGlmIChhbW91bnQgPT0gb2ZmZXJzW2lkXS5wYXlfYW10ICYmIGlzT2ZmZXJTb3J0ZWQoaWQpKSB7CiAgICAgICAgICAgIC8vb2ZmZXJzW2lkXSBtdXN0IGJlIHJlbW92ZWQgZnJvbSBzb3J0ZWQgbGlzdCBiZWNhdXNlIGFsbCBvZiBpdCBpcyBib3VnaHQKICAgICAgICAgICAgX3Vuc29ydChpZCk7CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUoc3VwZXIuYnV5KGlkLCBhbW91bnQpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL2ZpbmQgdGhlIGlkIG9mIHRoZSBuZXh0IGhpZ2hlciBvZmZlciBhZnRlciBvZmZlcnNbaWRdCiAgICBmdW5jdGlvbiBfZmluZCh1aW50IGlkKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZSggaWQgPiAwICk7CgogICAgICAgIGFkZHJlc3MgYnV5X2dlbSA9IGFkZHJlc3Mob2ZmZXJzW2lkXS5idXlfZ2VtKTsKICAgICAgICBhZGRyZXNzIHBheV9nZW0gPSBhZGRyZXNzKG9mZmVyc1tpZF0ucGF5X2dlbSk7CiAgICAgICAgdWludCB0b3AgPSBfYmVzdFtwYXlfZ2VtXVtidXlfZ2VtXTsKICAgICAgICB1aW50IG9sZF90b3AgPSAwOwoKICAgICAgICAvLyBGaW5kIHRoZSBsYXJnZXItdGhhbi1pZCBvcmRlciB3aG9zZSBzdWNjZXNzb3IgaXMgbGVzcy10aGFuLWlkLgogICAgICAgIHdoaWxlICh0b3AgIT0gMCAmJiBfaXNQcmljZWRMdE9yRXEoaWQsIHRvcCkpIHsKICAgICAgICAgICAgb2xkX3RvcCA9IHRvcDsKICAgICAgICAgICAgdG9wID0gX3JhbmtbdG9wXS5wcmV2OwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2xkX3RvcDsKICAgIH0KCiAgICAvL2ZpbmQgdGhlIGlkIG9mIHRoZSBuZXh0IGhpZ2hlciBvZmZlciBhZnRlciBvZmZlcnNbaWRdCiAgICBmdW5jdGlvbiBfZmluZHBvcyh1aW50IGlkLCB1aW50IHBvcykKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShpZCA+IDApOwoKICAgICAgICAvLyBMb29rIGZvciBhbiBhY3RpdmUgb3JkZXIuCiAgICAgICAgd2hpbGUgKHBvcyAhPSAwICYmICFpc0FjdGl2ZShwb3MpKSB7CiAgICAgICAgICAgIHBvcyA9IF9yYW5rW3Bvc10ucHJldjsKICAgICAgICB9CgogICAgICAgIGlmIChwb3MgPT0gMCkgewogICAgICAgICAgICAvL2lmIHdlIGdvdCB0byB0aGUgZW5kIG9mIGxpc3Qgd2l0aG91dCBhIHNpbmdsZSBhY3RpdmUgb2ZmZXIKICAgICAgICAgICAgcmV0dXJuIF9maW5kKGlkKTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgd2UgZGlkIGZpbmQgYSBuZWFyYnkgYWN0aXZlIG9mZmVyCiAgICAgICAgICAgIC8vIFdhbGsgdGhlIG9yZGVyIGJvb2sgZG93biBmcm9tIHRoZXJlLi4uCiAgICAgICAgICAgIGlmKF9pc1ByaWNlZEx0T3JFcShpZCwgcG9zKSkgewogICAgICAgICAgICAgICAgdWludCBvbGRfcG9zOwoKICAgICAgICAgICAgICAgIC8vIEd1YXJhbnRlZWQgdG8gcnVuIGF0IGxlYXN0IG9uY2UgYmVjYXVzZSBvZgogICAgICAgICAgICAgICAgLy8gdGhlIHByaW9yIGlmIHN0YXRlbWVudHMuCiAgICAgICAgICAgICAgICB3aGlsZSAocG9zICE9IDAgJiYgX2lzUHJpY2VkTHRPckVxKGlkLCBwb3MpKSB7CiAgICAgICAgICAgICAgICAgICAgb2xkX3BvcyA9IHBvczsKICAgICAgICAgICAgICAgICAgICBwb3MgPSBfcmFua1twb3NdLnByZXY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gb2xkX3BvczsKCiAgICAgICAgICAgIC8vIC4uLm9yIHdhbGsgaXQgdXAuCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3aGlsZSAocG9zICE9IDAgJiYgIV9pc1ByaWNlZEx0T3JFcShpZCwgcG9zKSkgewogICAgICAgICAgICAgICAgICAgIHBvcyA9IF9yYW5rW3Bvc10ubmV4dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwb3M7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy9yZXR1cm4gdHJ1ZSBpZiBvZmZlcnNbbG93XSBwcmljZWQgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIG9mZmVyc1toaWdoXQogICAgZnVuY3Rpb24gX2lzUHJpY2VkTHRPckVxKAogICAgICAgIHVpbnQgbG93LCAgIC8vbG93ZXIgcHJpY2VkIG9mZmVyJ3MgaWQKICAgICAgICB1aW50IGhpZ2ggICAvL2hpZ2hlciBwcmljZWQgb2ZmZXIncyBpZAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIG11bChvZmZlcnNbbG93XS5idXlfYW10LCBvZmZlcnNbaGlnaF0ucGF5X2FtdCkKICAgICAgICAgID49IG11bChvZmZlcnNbaGlnaF0uYnV5X2FtdCwgb2ZmZXJzW2xvd10ucGF5X2FtdCk7CiAgICB9CgogICAgLy90aGVzZSB2YXJpYWJsZXMgYXJlIGdsb2JhbCBvbmx5IGJlY2F1c2Ugb2Ygc29saWRpdHkgbG9jYWwgdmFyaWFibGUgbGltaXQKCiAgICAvL21hdGNoIG9mZmVycyB3aXRoIHRha2VyIG9mZmVyLCBhbmQgZXhlY3V0ZSB0b2tlbiB0cmFuc2FjdGlvbnMKICAgIGZ1bmN0aW9uIF9tYXRjaG8oCiAgICAgICAgdWludCB0X3BheV9hbXQsICAgIC8vdGFrZXIgc2VsbCBob3cgbXVjaAogICAgICAgIEVSQzIwIHRfcGF5X2dlbSwgICAvL3Rha2VyIHNlbGwgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IHRfYnV5X2FtdCwgICAgLy90YWtlciBidXkgaG93IG11Y2gKICAgICAgICBFUkMyMCB0X2J1eV9nZW0sICAgLy90YWtlciBidXkgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IHBvcywgICAgICAgICAgLy9wb3NpdGlvbiBpZAogICAgICAgIGJvb2wgcm91bmRpbmcgICAgICAvL21hdGNoICJjbG9zZSBlbm91Z2giIG9yZGVycz8KICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQgaWQpCiAgICB7CiAgICAgICAgdWludCBiZXN0X21ha2VyX2lkOyAgICAvL2hpZ2hlc3QgbWFrZXIgaWQKICAgICAgICB1aW50IHRfYnV5X2FtdF9vbGQ7ICAgIC8vdGFrZXIgYnV5IGhvdyBtdWNoIHNhdmVkCiAgICAgICAgdWludCBtX2J1eV9hbXQ7ICAgICAgICAvL21ha2VyIG9mZmVyIHdhbnRzIHRvIGJ1eSB0aGlzIG11Y2ggdG9rZW4KICAgICAgICB1aW50IG1fcGF5X2FtdDsgICAgICAgIC8vbWFrZXIgb2ZmZXIgd2FudHMgdG8gc2VsbCB0aGlzIG11Y2ggdG9rZW4KCiAgICAgICAgLy8gdGhlcmUgaXMgYXQgbGVhc3Qgb25lIG9mZmVyIHN0b3JlZCBmb3IgdG9rZW4gcGFpcgogICAgICAgIHdoaWxlIChfYmVzdFt0X2J1eV9nZW1dW3RfcGF5X2dlbV0gPiAwKSB7CiAgICAgICAgICAgIGJlc3RfbWFrZXJfaWQgPSBfYmVzdFt0X2J1eV9nZW1dW3RfcGF5X2dlbV07CiAgICAgICAgICAgIG1fYnV5X2FtdCA9IG9mZmVyc1tiZXN0X21ha2VyX2lkXS5idXlfYW10OwogICAgICAgICAgICBtX3BheV9hbXQgPSBvZmZlcnNbYmVzdF9tYWtlcl9pZF0ucGF5X2FtdDsKCiAgICAgICAgICAgIC8vIFVnbHkgaGFjayB0byB3b3JrIGFyb3VuZCByb3VuZGluZyBlcnJvcnMuIEJhc2VkIG9uIHRoZSBpZGVhIHRoYXQKICAgICAgICAgICAgLy8gdGhlIGZ1cnRoZXN0IHRoZSBhbW91bnRzIGNhbiBzdHJheSBmcm9tIHRoZWlyICJ0cnVlIiB2YWx1ZXMgaXMgMS4KICAgICAgICAgICAgLy8gRXJnbyB0aGUgd29yc3QgY2FzZSBoYXMgdF9wYXlfYW10IGFuZCBtX3BheV9hbXQgYXQgKzEgYXdheSBmcm9tCiAgICAgICAgICAgIC8vIHRoZWlyICJjb3JyZWN0IiB2YWx1ZXMgYW5kIG1fYnV5X2FtdCBhbmQgdF9idXlfYW10IGF0IC0xLgogICAgICAgICAgICAvLyBTaW5jZSAoYyAtIDEpICogKGQgLSAxKSA+IChhICsgMSkgKiAoYiArIDEpIGlzIGVxdWl2YWxlbnQgdG8KICAgICAgICAgICAgLy8gYyAqIGQgPiBhICogYiArIGEgKyBiICsgYyArIGQsIHdlIHdyaXRlLi4uCiAgICAgICAgICAgIGlmIChtdWwobV9idXlfYW10LCB0X2J1eV9hbXQpID4gbXVsKHRfcGF5X2FtdCwgbV9wYXlfYW10KSArCiAgICAgICAgICAgICAgICAocm91bmRpbmcgPyBtX2J1eV9hbXQgKyB0X2J1eV9hbXQgKyB0X3BheV9hbXQgKyBtX3BheV9hbXQgOiAwKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gXiBUaGUgYHJvdW5kaW5nYCBwYXJhbWV0ZXIgaXMgYSBjb21wcm9taXNlIGJvcm5lIG9mIGEgY291cGxlIGRheXMKICAgICAgICAgICAgLy8gb2YgZGlzY3Vzc2lvbi4KCiAgICAgICAgICAgIGJ1eShiZXN0X21ha2VyX2lkLCBtaW4obV9wYXlfYW10LCB0X2J1eV9hbXQpKTsKICAgICAgICAgICAgdF9idXlfYW10X29sZCA9IHRfYnV5X2FtdDsKICAgICAgICAgICAgdF9idXlfYW10ID0gc3ViKHRfYnV5X2FtdCwgbWluKG1fcGF5X2FtdCwgdF9idXlfYW10KSk7CiAgICAgICAgICAgIHRfcGF5X2FtdCA9IG11bCh0X2J1eV9hbXQsIHRfcGF5X2FtdCkgLyB0X2J1eV9hbXRfb2xkOwoKICAgICAgICAgICAgaWYgKHRfcGF5X2FtdCA9PSAwIHx8IHRfYnV5X2FtdCA9PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRfYnV5X2FtdCA+IDAgJiYgdF9wYXlfYW10ID4gMCkgewogICAgICAgICAgICAvL25ldyBvZmZlciBzaG91bGQgYmUgY3JlYXRlZAogICAgICAgICAgICBpZCA9IHN1cGVyLm9mZmVyKHRfcGF5X2FtdCwgdF9wYXlfZ2VtLCB0X2J1eV9hbXQsIHRfYnV5X2dlbSk7CiAgICAgICAgICAgIC8vaW5zZXJ0IG9mZmVyIGludG8gdGhlIHNvcnRlZCBsaXN0CiAgICAgICAgICAgIF9zb3J0KGlkLCBwb3MpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBNYWtlIGEgbmV3IG9mZmVyIHdpdGhvdXQgcHV0dGluZyBpdCBpbiB0aGUgc29ydGVkIGxpc3QuCiAgICAvLyBUYWtlcyBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW50byBtYXJrZXQgZXNjcm93LgogICAgLy8gKioqKkF2YWlsYWJsZSB0byBhdXRob3JpemVkIGNvbnRyYWN0cyBvbmx5ISoqKioqKioqKioKICAgIC8vIEtlZXBlcnMgc2hvdWxkIGNhbGwgaW5zZXJ0KGlkLHBvcykgdG8gcHV0IG9mZmVyIGluIHRoZSBzb3J0ZWQgbGlzdC4KICAgIGZ1bmN0aW9uIF9vZmZlcnUoCiAgICAgICAgdWludCBwYXlfYW10LCAgICAgIC8vbWFrZXIgKGFzaykgc2VsbCBob3cgbXVjaAogICAgICAgIEVSQzIwIHBheV9nZW0sICAgICAvL21ha2VyIChhc2spIHNlbGwgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IGJ1eV9hbXQsICAgICAgLy9tYWtlciAoYXNrKSBidXkgaG93IG11Y2gKICAgICAgICBFUkMyMCBidXlfZ2VtICAgICAgLy9tYWtlciAoYXNrKSBidXkgd2hpY2ggdG9rZW4KICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIC8qTk9UIHN5bmNocm9uaXplZCEhISAqLwogICAgICAgIHJldHVybnMgKHVpbnQgaWQpCiAgICB7CiAgICAgICAgcmVxdWlyZShfZHVzdFtwYXlfZ2VtXSA8PSBwYXlfYW10KTsKICAgICAgICBpZCA9IHN1cGVyLm9mZmVyKHBheV9hbXQsIHBheV9nZW0sIGJ1eV9hbXQsIGJ1eV9nZW0pOwogICAgICAgIF9uZWFyW2lkXSA9IF9oZWFkOwogICAgICAgIF9oZWFkID0gaWQ7CiAgICAgICAgTG9nVW5zb3J0ZWRPZmZlcihpZCk7CiAgICB9CgogICAgLy9wdXQgb2ZmZXIgaW50byB0aGUgc29ydGVkIGxpc3QKICAgIGZ1bmN0aW9uIF9zb3J0KAogICAgICAgIHVpbnQgaWQsICAgIC8vbWFrZXIgKGFzaykgaWQKICAgICAgICB1aW50IHBvcyAgICAvL3Bvc2l0aW9uIHRvIGluc2VydCBpbnRvCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKGlzQWN0aXZlKGlkKSk7CgogICAgICAgIGFkZHJlc3MgYnV5X2dlbSA9IGFkZHJlc3Mob2ZmZXJzW2lkXS5idXlfZ2VtKTsKICAgICAgICBhZGRyZXNzIHBheV9nZW0gPSBhZGRyZXNzKG9mZmVyc1tpZF0ucGF5X2dlbSk7CiAgICAgICAgdWludCBwcmV2X2lkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tYWtlciAoYXNrKSBpZAoKICAgICAgICBpZiAocG9zID09IDAgfHwgIWlzT2ZmZXJTb3J0ZWQocG9zKSkgewogICAgICAgICAgICBwb3MgPSBfZmluZChpZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcG9zID0gX2ZpbmRwb3MoaWQsIHBvcyk7CgogICAgICAgICAgICAvL2lmIHVzZXIgaGFzIGVudGVyZWQgYSBgcG9zYCB0aGF0IGJlbG9uZ3MgdG8gYW5vdGhlciBjdXJyZW5jeSBwYWlyCiAgICAgICAgICAgIC8vd2Ugc3RhcnQgZnJvbSBzY3JhdGNoCiAgICAgICAgICAgIGlmKHBvcyAhPSAwICYmIChvZmZlcnNbcG9zXS5wYXlfZ2VtICE9IG9mZmVyc1tpZF0ucGF5X2dlbQogICAgICAgICAgICAgICAgICAgICAgfHwgb2ZmZXJzW3Bvc10uYnV5X2dlbSAhPSBvZmZlcnNbaWRdLmJ1eV9nZW0pKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwb3MgPSAwOwogICAgICAgICAgICAgICAgcG9zPV9maW5kKGlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vcmVxdWlyZW1lbnQgYmVsb3cgaXMgc2F0aXNmaWVkIGJ5IHN0YXRlbWVudHMgYWJvdmUKICAgICAgICAvL3JlcXVpcmUocG9zID09IDAgfHwgaXNPZmZlclNvcnRlZChwb3MpKTsKCgogICAgICAgIGlmIChwb3MgIT0gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb2ZmZXJzW2lkXSBpcyBub3QgdGhlIGhpZ2hlc3Qgb2ZmZXIKICAgICAgICAgICAgLy9yZXF1aXJlbWVudCBiZWxvdyBpcyBzYXRpc2ZpZWQgYnkgc3RhdGVtZW50cyBhYm92ZQogICAgICAgICAgICAvL3JlcXVpcmUoX2lzUHJpY2VkTHRPckVxKGlkLCBwb3MpKTsKICAgICAgICAgICAgcHJldl9pZCA9IF9yYW5rW3Bvc10ucHJldjsKICAgICAgICAgICAgX3JhbmtbcG9zXS5wcmV2ID0gaWQ7CiAgICAgICAgICAgIF9yYW5rW2lkXS5uZXh0ID0gcG9zOwogICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb2ZmZXJzW2lkXSBpcyB0aGUgaGlnaGVzdCBvZmZlcgogICAgICAgICAgICBwcmV2X2lkID0gX2Jlc3RbcGF5X2dlbV1bYnV5X2dlbV07CiAgICAgICAgICAgIF9iZXN0W3BheV9nZW1dW2J1eV9nZW1dID0gaWQ7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJldl9pZCAhPSAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgbG93ZXIgb2ZmZXIgZG9lcyBleGlzdAogICAgICAgICAgICAvL3JlcXVpcmVtZW50IGJlbG93IGlzIHNhdGlzZmllZCBieSBzdGF0ZW1lbnRzIGFib3ZlCiAgICAgICAgICAgIC8vcmVxdWlyZSghX2lzUHJpY2VkTHRPckVxKGlkLCBwcmV2X2lkKSk7CiAgICAgICAgICAgIF9yYW5rW3ByZXZfaWRdLm5leHQgPSBpZDsKICAgICAgICAgICAgX3JhbmtbaWRdLnByZXYgPSBwcmV2X2lkOwogICAgICAgIH0KCiAgICAgICAgX3NwYW5bcGF5X2dlbV1bYnV5X2dlbV0rKzsKICAgICAgICBMb2dTb3J0ZWRPZmZlcihpZCk7CiAgICB9CgogICAgLy8gUmVtb3ZlIG9mZmVyIGZyb20gdGhlIHNvcnRlZCBsaXN0IChkb2VzIG5vdCBjYW5jZWwgb2ZmZXIpCiAgICBmdW5jdGlvbiBfdW5zb3J0KAogICAgICAgIHVpbnQgaWQgICAgLy9pZCBvZiBtYWtlciAoYXNrKSBvZmZlciB0byByZW1vdmUgZnJvbSBzb3J0ZWQgbGlzdAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhZGRyZXNzIGJ1eV9nZW0gPSBhZGRyZXNzKG9mZmVyc1tpZF0uYnV5X2dlbSk7CiAgICAgICAgYWRkcmVzcyBwYXlfZ2VtID0gYWRkcmVzcyhvZmZlcnNbaWRdLnBheV9nZW0pOwogICAgICAgIHJlcXVpcmUoX3NwYW5bcGF5X2dlbV1bYnV5X2dlbV0gPiAwKTsKCiAgICAgICAgcmVxdWlyZShfcmFua1tpZF0uZGVsYiA9PSAwICYmICAgICAgICAgICAgICAgICAgICAvL2Fzc2VydCBpZCBpcyBpbiB0aGUgc29ydGVkIGxpc3QKICAgICAgICAgICAgICAgICBpc09mZmVyU29ydGVkKGlkKSk7CgogICAgICAgIGlmIChpZCAhPSBfYmVzdFtwYXlfZ2VtXVtidXlfZ2VtXSkgeyAgICAgICAgICAgICAgLy8gb2ZmZXJzW2lkXSBpcyBub3QgdGhlIGhpZ2hlc3Qgb2ZmZXIKICAgICAgICAgICAgcmVxdWlyZShfcmFua1tfcmFua1tpZF0ubmV4dF0ucHJldiA9PSBpZCk7CiAgICAgICAgICAgIF9yYW5rW19yYW5rW2lkXS5uZXh0XS5wcmV2ID0gX3JhbmtbaWRdLnByZXY7CiAgICAgICAgfSBlbHNlIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29mZmVyc1tpZF0gaXMgdGhlIGhpZ2hlc3Qgb2ZmZXIKICAgICAgICAgICAgX2Jlc3RbcGF5X2dlbV1bYnV5X2dlbV0gPSBfcmFua1tpZF0ucHJldjsKICAgICAgICB9CgogICAgICAgIGlmIChfcmFua1tpZF0ucHJldiAhPSAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgLy9vZmZlcnNbaWRdIGlzIG5vdCB0aGUgbG93ZXN0IG9mZmVyCiAgICAgICAgICAgIHJlcXVpcmUoX3JhbmtbX3JhbmtbaWRdLnByZXZdLm5leHQgPT0gaWQpOwogICAgICAgICAgICBfcmFua1tfcmFua1tpZF0ucHJldl0ubmV4dCA9IF9yYW5rW2lkXS5uZXh0OwogICAgICAgIH0KCiAgICAgICAgX3NwYW5bcGF5X2dlbV1bYnV5X2dlbV0tLTsKICAgICAgICBfcmFua1tpZF0uZGVsYiA9IGJsb2NrLm51bWJlcjsgICAgICAgICAgICAgICAgICAgIC8vbWFyayBfcmFua1tpZF0gZm9yIGRlbGV0aW9uCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9IaWRlIG9mZmVyIGZyb20gdGhlIHVuc29ydGVkIG9yZGVyIGJvb2sgKGRvZXMgbm90IGNhbmNlbCBvZmZlcikKICAgIGZ1bmN0aW9uIF9oaWRlKAogICAgICAgIHVpbnQgaWQgICAgIC8vaWQgb2YgbWFrZXIgb2ZmZXIgdG8gcmVtb3ZlIGZyb20gdW5zb3J0ZWQgbGlzdAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB1aW50IHVpZCA9IF9oZWFkOyAgICAgICAgICAgICAgIC8vaWQgb2YgYW4gb2ZmZXIgaW4gdW5zb3J0ZWQgb2ZmZXJzIGxpc3QKICAgICAgICB1aW50IHByZSA9IHVpZDsgICAgICAgICAgICAgICAgIC8vaWQgb2YgcHJldmlvdXMgb2ZmZXIgaW4gdW5zb3J0ZWQgb2ZmZXJzIGxpc3QKCiAgICAgICAgcmVxdWlyZSghaXNPZmZlclNvcnRlZChpZCkpOyAgICAvL21ha2Ugc3VyZSBvZmZlciBpZCBpcyBub3QgaW4gc29ydGVkIG9mZmVycyBsaXN0CgogICAgICAgIGlmIChfaGVhZCA9PSBpZCkgeyAgICAgICAgICAgICAgLy9jaGVjayBpZiBvZmZlciBpcyBmaXJzdCBvZmZlciBpbiB1bnNvcnRlZCBvZmZlcnMgbGlzdAogICAgICAgICAgICBfaGVhZCA9IF9uZWFyW2lkXTsgICAgICAgICAgLy9zZXQgaGVhZCB0byBuZXcgZmlyc3QgdW5zb3J0ZWQgb2ZmZXIKICAgICAgICAgICAgX25lYXJbaWRdID0gMDsgICAgICAgICAgICAgIC8vZGVsZXRlIG9yZGVyIGZyb20gdW5zb3J0ZWQgb3JkZXIgbGlzdAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKHVpZCA+IDAgJiYgdWlkICE9IGlkKSB7ICAvL2ZpbmQgb2ZmZXIgaW4gdW5zb3J0ZWQgb3JkZXIgbGlzdAogICAgICAgICAgICBwcmUgPSB1aWQ7CiAgICAgICAgICAgIHVpZCA9IF9uZWFyW3VpZF07CiAgICAgICAgfQogICAgICAgIGlmICh1aWQgIT0gaWQpIHsgICAgICAgICAgICAgICAgLy9kaWQgbm90IGZpbmQgb2ZmZXIgaWQgaW4gdW5zb3J0ZWQgb2ZmZXJzIGxpc3QKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBfbmVhcltwcmVdID0gX25lYXJbaWRdOyAgICAgICAgIC8vc2V0IHByZXZpb3VzIHVuc29ydGVkIG9mZmVyIHRvIHBvaW50IHRvIG9mZmVyIGFmdGVyIG9mZmVyIGlkCiAgICAgICAgX25lYXJbaWRdID0gMDsgICAgICAgICAgICAgICAgICAvL2RlbGV0ZSBvcmRlciBmcm9tIHVuc29ydGVkIG9yZGVyIGxpc3QKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
