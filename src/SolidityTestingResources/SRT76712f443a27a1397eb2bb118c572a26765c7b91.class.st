Class {
	#name : #SRT76712f443a27a1397eb2bb118c572a26765c7b91,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT76712f443a27a1397eb2bb118c572a26765c7b91 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4gMC40LjE3OwoKCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSAmJiBjID49IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKLyoqCiogQHRpdGxlIE93bmFibGUKKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIAogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogICAgLyoqCiAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgKiBhY2NvdW50LgogICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewkKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgICBib29sIHB1YmxpYyBzdG9wcGVkOwoKICAgIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICAgICAgaWYgKHN0b3BwZWQpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgICAgICBpZiAoIXN0b3BwZWQpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLy8gQG5vdGljZSBDYWxsZWQgYnkgdGhlIG93bmVyIGluIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgZnVuY3Rpb24gZW1lcmdlbmN5U3RvcCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc3RvcHBlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FsbGVkIGJ5IHRoZSBvd25lciB0byBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAgZnVuY3Rpb24gcmVsZWFzZSgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgICAgIHN0b3BwZWQgPSBmYWxzZTsKICAgIH0KfQoKCmNvbnRyYWN0IEVSQzIwIHsKICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KTsKCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sIG9rKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLy8gQG5vdGljZSBNaWdyYXRpb24gQWdlbnQgaW50ZXJmYWNlCgpjb250cmFjdCBNaWdyYXRpb25BZ2VudCB7CiAgICBmdW5jdGlvbiBtaWdyYXRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwp9CgoKLy8gQG5vdGljZSAgV2hpdGVsaXN0IGludGVyZmFjZSB3aGljaCB3aWxsIGhvbGQgd2hpdGVsaXN0ZWQgdXNlcnMKY29udHJhY3QgV2hpdGVMaXN0IGlzIE93bmFibGUgewoKICAgIGZ1bmN0aW9uIGlzV2hpdGVMaXN0ZWQoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsgICAgICAgIAp9CgovLyBAbm90aWNlIGNvbnRyYWN0IHRvIGNvbnRyb2wgdmVzdGluZyBzY2hlZHVsZSBmb3IgY29tcGFueSBhbmQgdGVhbSB0b2tlbnMKY29udHJhY3QgVmVzdGluZyBpcyBPd25hYmxlIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICB1aW50IHB1YmxpYyB0ZWFtVG9rZW5zSW5pdGlhbCA9IDJlMjU7ICAgICAgLy8gbWF4IHRva2VucyBhbW91bnQgZm9yIHRoZSB0ZWFtIDIwLDAwMCwwMDAKICAgIHVpbnQgcHVibGljIHRlYW1Ub2tlbnNDdXJyZW50ID0gMDsgICAgICAgICAvLyB0byBrZWVwIHJlY29yZCBvZiBkaXN0cmlidXRlZCB0b2tlbnMgc28gZmFyIHRvIHRoZSB0ZWFtCiAgICB1aW50IHB1YmxpYyBjb21wYW55VG9rZW5zSW5pdGlhbCA9IDMwZTI0OyAgLy8gbWF4IHRva2VucyBhbW91bnQgZm9yIHRoZSBjb21wYW55IDMwLDAwMCwwMDAKICAgIHVpbnQgcHVibGljIGNvbXBhbnlUb2tlbnNDdXJyZW50ID0gMDsgICAgICAvLyB0byBrZWVwIHJlY29yZCBvZiBkaXN0cmlidXRlZCB0b2tlbnMgc28gZmFyIHRvIHRoZSBjb21wYW55CiAgICBUb2tlbiBwdWJsaWMgdG9rZW47ICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG9rZW4gY29udHJhY3QKICAgIHVpbnQgcHVibGljIGRhdGVJQ09FbmRlZDsgICAgICAgICAgICAgICAgICAvLyBkYXRlIHdoZW4gSUNPIGVuZGVkIHVwZGF0ZWQgZnJvbSB0aGUgZmluYWxpemVTYWxlKCkgZnVuY3Rpb24KICAgIHVpbnQgcHVibGljIGRhdGVQcm9kdWN0Q29tcGxldGVkOyAgICAgICAgICAvLyBkYXRlIHdoZW4gcHJvZHVjdCBoYXMgYmVlbiBjb21wbGV0ZWQKCgogICAgZXZlbnQgTG9nVGVhbVRva2Vuc1RyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCByZWNlaXBpZW50LCB1aW50IGFtb3VvbnRPZlRva2Vucyk7CiAgICBldmVudCBMb2dDb21wYW55VG9rZW5zVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHJlY2VpcGllbnQsIHVpbnQgYW1vdW9udE9mVG9rZW5zKTsKCgogICAgLy8gQG5vdGljZSBzZXQgdGhlIGhhbmRsZSBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgIC8vIEBwYXJhbSBfdG9rZW4gIHtUb2tlbn0gYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgIC8vIEByZXR1cm4gIHtib29sfSB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHNldFRva2VuKFRva2VuIF90b2tlbikgcHVibGljIG9ubHlPd25lcigpIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUgKHRva2VuID09IGFkZHJlc3MoMCkpOyAgCiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSBzZXQgdGhlIHByb2R1Y3QgY29tcGxldGlvbiBkYXRlIGZvciByZWxlYXNlIG9mIGRldiB0b2tlbnMKICAgIGZ1bmN0aW9uIHNldFByb2R1Y3RDb21wbGV0aW9uRGF0ZSgpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICBkYXRlUHJvZHVjdENvbXBsZXRlZCA9IG5vdzsKICAgIH0KCiAgICAvLyBAbm90aWNlICB0byByZWxlYXNlIHRva2VucyBvZiB0aGUgdGVhbSBhY2NvcmRpbmcgdG8gdmVzdGluZyBzY2hlZHVsZQogICAgLy8gQHBhcmFtIF9yZWNpcGllbnQge2FkZHJlc3N9IG9mIHRoZSByZWNpcGllbnQgb2YgdG9rZW4gdHJhbnNmZXIKICAgIC8vIEBwYXJhbSBfdG9rZW5zVG9UcmFuc2ZlciB7dWludH0gYW1vdW50IG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgZnVuY3Rpb24gdHJhbnNmZXJUZWFtVG9rZW5zKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludCBfdG9rZW5zVG9UcmFuc2ZlcikgZXh0ZXJuYWwgb25seU93bmVyKCkgewoKICAgICAgICByZXF1aXJlKF9yZWNpcGllbnQgIT0gMCk7ICAgICAgIAogICAgICAgIHJlcXVpcmUobm93ID49IDE1MzMwODE2MDApOyAgLy8gYmVmb3JlIEF1ZyAxLCAyMDE4IDAwOjAwIEdNVCBkb24ndCBhbGxvdyBvbiBkaXN0cmlidXRpb24gdG9rZW5zIHRvIHRoZSB0ZWFtLgoKICAgICAgICByZXF1aXJlKGRhdGVQcm9kdWN0Q29tcGxldGVkID4gMCk7CiAgICAgICAgaWYgKG5vdyA8IGRhdGVQcm9kdWN0Q29tcGxldGVkICsgMSB5ZWFycykgICAgICAgICAgICAvLyBmaXJzdCB5ZWFyIGFmdGVyIHByb2R1Y3QgcmVsZWFzZQogICAgICAgICAgICByZXF1aXJlKHRlYW1Ub2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKHRlYW1Ub2tlbnNJbml0aWFsICogMzApIC8gMTAwKTsKICAgICAgICBlbHNlIGlmIChub3cgPCBkYXRlUHJvZHVjdENvbXBsZXRlZCArIDIgeWVhcnMpICAgICAgIC8vIHNlY29uZCB5ZWFyIGFmdGVyIHByb2R1Y3QgcmVsZWFzZQogICAgICAgICAgICByZXF1aXJlKHRlYW1Ub2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKHRlYW1Ub2tlbnNJbml0aWFsICogNjApIC8gMTAwKTsKICAgICAgICBlbHNlIGlmIChub3cgPCBkYXRlUHJvZHVjdENvbXBsZXRlZCArIDMgeWVhcnMpICAgICAgIC8vIHRoaXJkIHllYXIgYWZ0ZXIgcHJvZHVjdCByZWxlYXNlCiAgICAgICAgICAgIHJlcXVpcmUodGVhbVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKSA8PSAodGVhbVRva2Vuc0luaXRpYWwgKiA4MCkgLyAxMDApOwogICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm91cnRoIHllYXIgYWZ0ZXIgcHJvZHVjdCByZWxlYXNlCiAgICAgICAgICAgIHJlcXVpcmUodGVhbVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKSA8PSB0ZWFtVG9rZW5zSW5pdGlhbCk7CgogICAgICAgIHRlYW1Ub2tlbnNDdXJyZW50ID0gdGVhbVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKTsgIC8vIHVwZGF0ZSByZWxlYXNlZCB0b2tlbiBhbW91bnQKICAgICAgICAKICAgICAgICBpZiAoIXRva2VuLnRyYW5zZmVyKF9yZWNpcGllbnQsIF90b2tlbnNUb1RyYW5zZmVyKSkKICAgICAgICAgICAgICAgIHJldmVydCgpOwoKICAgICAgICBMb2dUZWFtVG9rZW5zVHJhbnNmZXJyZWQoX3JlY2lwaWVudCwgX3Rva2Vuc1RvVHJhbnNmZXIpOwogICAgfQoKICAgIC8vIEBub3RpY2UgIHRvIHJlbGVhc2UgdG9rZW5zIG9mIHRoZSBjb21wYW55IGFjY29yZGluZyB0byB2ZXN0aW5nIHNjaGVkdWxlCiAgICAvLyBAcGFyYW0gX3JlY2lwaWVudCB7YWRkcmVzc30gb2YgdGhlIHJlY2lwaWVudCBvZiB0b2tlbiB0cmFuc2ZlcgogICAgLy8gQHBhcmFtIF90b2tlbnNUb1RyYW5zZmVyIHt1aW50fSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiB0cmFuc2ZlckNvbXBhbnlUb2tlbnMoYWRkcmVzcyBfcmVjaXBpZW50LCB1aW50IF90b2tlbnNUb1RyYW5zZmVyKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CgogICAgICAgIHJlcXVpcmUoX3JlY2lwaWVudCAhPSAwKTsKICAgICAgICByZXF1aXJlKGRhdGVJQ09FbmRlZCA+IDApOyAgICAgICAKCiAgICAgICAgaWYgKG5vdyA8IGRhdGVJQ09FbmRlZCArIDEgeWVhcnMpICAgLy8gZmlyc3QgeWVhcgogICAgICAgICAgICByZXF1aXJlKGNvbXBhbnlUb2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKGNvbXBhbnlUb2tlbnNJbml0aWFsICogNTApIC8gMTAwKTsKICAgICAgICBlbHNlIGlmIChub3cgPCBkYXRlSUNPRW5kZWQgKyAyIHllYXJzKSAvLyBzZWNvbmQgeWVhcgogICAgICAgICAgICByZXF1aXJlKGNvbXBhbnlUb2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKGNvbXBhbnlUb2tlbnNJbml0aWFsICogNzUpIC8gMTAwKTsKICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcmQgeWVhciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcXVpcmUoY29tcGFueVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKSA8PSBjb21wYW55VG9rZW5zSW5pdGlhbCk7CgogICAgICAgIGNvbXBhbnlUb2tlbnNDdXJyZW50ID0gY29tcGFueVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKTsgIC8vIHVwZGF0ZSByZWxlYXNlZCB0b2tlbiBhbW91bnQKCiAgICAgICAgaWYgKCF0b2tlbi50cmFuc2ZlcihfcmVjaXBpZW50LCBfdG9rZW5zVG9UcmFuc2ZlcikpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBMb2dDb21wYW55VG9rZW5zVHJhbnNmZXJyZWQoX3JlY2lwaWVudCwgX3Rva2Vuc1RvVHJhbnNmZXIpOwogICAgfQp9CgovLyBQcmVzYWxlIFNtYXJ0IENvbnRyYWN0Ci8vIFRoaXMgc21hcnQgY29udHJhY3QgY29sbGVjdHMgRVRIIGFuZCBpbiByZXR1cm4gc2VuZHMgdG9rZW5zIHRvIHRoZSBiYWNrZXJzLgpjb250cmFjdCBDcm93ZFNhbGUgaXMgIFBhdXNhYmxlLCBWZXN0aW5nIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBzdHJ1Y3QgQmFja2VyIHsKICAgICAgICB1aW50IHdlaVJlY2VpdmVkT25lOyAvLyBhbW91bnQgb2YgRVRIIGNvbnRyaWJ1dGVkIGR1cmluZyBmaXJzdCBwcmVzYWxlCiAgICAgICAgdWludCB3ZWlSZWNlaXZlZFR3bzsgIC8vIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQgZHVyaW5nIHNlY29uZCBwcmVzYWxlCiAgICAgICAgdWludCB3ZWlSZWNlaXZlZE1haW47IC8vIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQgZHVyaW5nIG1haW4gc2FsZQogICAgICAgIHVpbnQgdG9rZW5zU2VudDsgLy8gYW1vdW50IG9mIHRva2VucyAgc2VudAogICAgICAgIGJvb2wgY2xhaW1lZDsKICAgICAgICBib29sIHJlZnVuZGVkOwogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnOyAvLyBNdWx0aXNpZyBjb250cmFjdCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgRVRICiAgICB1aW50IHB1YmxpYyBldGhSZWNlaXZlZFByZXNhbGVPbmU7IC8vIEFtb3VudCBvZiBFVEggcmVjZWl2ZWQgaW4gcHJlc2FsZSBvbmUKICAgIHVpbnQgcHVibGljIGV0aFJlY2VpdmVkUHJlc2FsZVR3bzsgLy8gQW1vdW50IG9mIEVUSCByZWNlaXZlZCBpbiBwcmVzYWxlIHR3bwogICAgdWludCBwdWJsaWMgZXRoUmVjZWl2ZU1haW5TYWxlOyAvLyBBbW91bnQgb2YgRVRIIHJlY2VpdmVkIGluIG1haW4gc2FsZQogICAgdWludCBwdWJsaWMgdG90YWxUb2tlbnNTb2xkOyAvLyBOdW1iZXIgb2YgdG9rZW5zIHNvbGQgdG8gY29udHJpYnV0b3JzIGluIGFsbCBjYW1wYWlnbnMKICAgIHVpbnQgcHVibGljIHN0YXJ0QmxvY2s7IC8vIFByZXNhbGUgc3RhcnQgYmxvY2sKICAgIHVpbnQgcHVibGljIGVuZEJsb2NrOyAvLyBQcmVzYWxlIGVuZCBibG9jawoKICAgIHVpbnQgcHVibGljIG1pbkludmVzdG1lbnQ7IC8vIE1pbmltdW0gYW1vdW50IHRvIGludmVzdCAgICAKICAgIFdoaXRlTGlzdCBwdWJsaWMgd2hpdGVMaXN0OyAvLyB3aGl0ZWxpc3QgY29udHJhY3QKICAgIHVpbnQgcHVibGljIGRvbGxhclBlckV0aGVyUmF0aW87IC8vIGRvbGxhciB0byBldGhlciByYXRpbyBzZXQgYXQgdGhlIGJlZ2lubmluZyBvZiBtYWluIHNhbGUKICAgIHVpbnQgcHVibGljIHJldHVyblBlcmNlbnRhZ2U7ICAvLyBwZXJjZW50YWdlIHRvIGJlIHJldHVybmVkIGZyb20gZmlyc3QgcHJlc2FsZSBpbiBjYXNlIGNhbXBhaWduIGlzIGNhbmNlbGxlZAogICAgU3RlcCBwdWJsaWMgY3VycmVudFN0ZXA7ICAvLyB0byBtb3ZlIHRocm91Z2ggY2FtcGFpZ25zIGFuZCBzZXQgZGVmYXVsdCB2YWx1ZXMKICAgIHVpbnQgcHVibGljIG1pbkNhcFRva2VuczsgIC8vIG1pbmltdW0gYW1vdW50IG9mIHRva2VucyB0byByYWlzZSBmb3IgY2FtcGFpZ24gdG8gYmUgc3VjY2Vzc2Z1bAoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBCYWNrZXIpIHB1YmxpYyBiYWNrZXJzOyAvL2JhY2tlciBsaXN0CiAgICBhZGRyZXNzW10gcHVibGljIGJhY2tlcnNJbmRleDsgIC8vIHRvIGJlIGFibGUgdG8gaXRlcmF0ZSB0aHJvdWdoIGJhY2tlciBsaXN0CiAgICB1aW50IHB1YmxpYyBtYXhDYXBFdGg7ICAvLyBtYXggY2FwIGV0aAogICAgdWludCBwdWJsaWMgbWF4Q2FwVG9rZW5zOyAvLyBtYXggY2FwIHRva2VucwogICAgdWludCBwdWJsaWMgY2xhaW1Db3VudDsgIC8vIG51bWJlciBvZiBjb250cmlidXRvcnMgY2xhaW1pbmcgdG9rZW5zCiAgICB1aW50IHB1YmxpYyByZWZ1bmRDb3VudDsgIC8vIG51bWJlciBvZiBjb250cmlidXRvcnMgcmVjZWl2aW5nIHJlZnVuZHMKICAgIHVpbnQgcHVibGljIHRvdGFsQ2xhaW1lZDsgIC8vIHRvdGFsIG9mIHRva2VucyBjbGFpbWVkCiAgICB1aW50IHB1YmxpYyB0b3RhbFJlZnVuZGVkOyAgLy8gdG90YWwgb2YgdG9rZW5zIHJlZnVuZGVkCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGNsYWltZWQ7IC8vIHRva2VucyBjbGFpbWVkIGJ5IGNvbnRyaWJ1dG9ycwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyByZWZ1bmRlZDsgLy8gdG9rZW5zIHJlZnVuZGVkIHRvIGNvbnRyaWJ1dG9ycwoKCgogICAgLy8gQG5vdGljZSB0byBzZXQgYW5kIGRldGVybWluZSBzdGVwcyBvZiBjcm93ZHNhbGUKICAgIGVudW0gU3RlcCB7CiAgICAgICAgRnVuZGluZ1ByZXNhbGVPbmUsICAvLyBwcmVzYWxlIDEgbW9kZQogICAgICAgIEZ1bmRpbmdQcmVzYWxlVHdvLCAgLy8gcHJlc2FsZSAyIG1vZGUKICAgICAgICBGdW5kaW5nTWFpblNhbGUsICAgIC8vIG1haW4gSUNPCiAgICAgICAgUmVmdW5kaW5nICAgICAgICAgICAvLyByZWZ1bmRpbmcKICAgIH0KCgogICAgLy8gQG5vdGljZSB0byB2ZXJpZnkgaWYgYWN0aW9uIGlzIG5vdCBwZXJmb3JtZWQgb3V0IG9mIHRoZSBjYW1wYWlnbiByYW5nZQogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsKICAgICAgICBpZiAoKGJsb2NrLm51bWJlciA8IHN0YXJ0QmxvY2spIHx8IChibG9jay5udW1iZXIgPiBlbmRCbG9jaykpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBSZWNlaXZlZEVUSChhZGRyZXNzIGluZGV4ZWQgYmFja2VyLCBTdGVwIGluZGV4ZWQgc3RlcCwgdWludCBhbW91bnQpOwogICAgZXZlbnQgVG9rZW5zQ2xhaW1lZChhZGRyZXNzIGluZGV4ZWQgYmFja2VyLCB1aW50IGNvdW50KTsKICAgIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiYWNrZXIsIHVpbnQgYW1vdW50KTsKCgoKICAgIC8vIENyb3dkRnVuZGluZyAgIHtjb25zdHJ1Y3Rvcn0KICAgIC8vIEBub3RpY2UgZmlyZWQgd2hlbiBjb250cmFjdCBpcyBjcmF0ZWQuIEluaXRpYWxpemVzIGFsbCBuZWVkZWQgdmFyaWFibGVzIGZvciBwcmVzYWxlIDEuCiAgICBmdW5jdGlvbiBDcm93ZFNhbGUoV2hpdGVMaXN0IF93aGl0ZUxpc3QsIGFkZHJlc3MgX211bHRpc2lnKSBwdWJsaWMgewoKICAgICAgICByZXF1aXJlKF93aGl0ZUxpc3QgIT0gYWRkcmVzcygweDApKTsKICAgICAgICBtdWx0aXNpZyA9IF9tdWx0aXNpZzsKICAgICAgICBtaW5JbnZlc3RtZW50ID0gMTAwIGV0aGVyOyAgLy8gMTAwIGV0aAogICAgICAgIG1heENhcEV0aCA9IDMwMDAwIGV0aGVyOwogICAgICAgIHN0YXJ0QmxvY2sgPSAwOyAvLyBTdGFydGluZyBibG9jayBvZiB0aGUgY2FtcGFpZ24KICAgICAgICBlbmRCbG9jayA9IDA7IC8vIEVuZGluZyBibG9jayBvZiB0aGUgY2FtcGFpZ24KICAgICAgICBjdXJyZW50U3RlcCA9IFN0ZXAuRnVuZGluZ1ByZXNhbGVPbmU7ICAvLyBpbml0aWFsaXplIHRvIGZpcnN0IHByZXNhbGUKICAgICAgICB3aGl0ZUxpc3QgPSBfd2hpdGVMaXN0OyAvLyBhZGRyZXNzIG9mIHdoaXRlIGxpc3QgY29udHJhY3QKICAgICAgICBtaW5DYXBUb2tlbnMgPSA3LjVlMjQ7ICAvLyAxNSUgb2YgbWF4Q2FwVG9rZW5zICg1MCBtaWxsaW9uKQogICAgfQoKCiAgICAvLyBAbm90aWNlIHJldHVybiBudW1iZXIgb2YgIGNvbnRyaWJ1dG9ycyBmb3IgYWxsIGNhbXBhaWducwogICAgLy8gQHJldHVybiB7dWludH0gbnVtYmVyIG9mIGNvbnRyaWJ1dG9ycyBpbiBlYWNoIGNhbXBhaWduIGFuZCB0b3RhbCBudW1iZXIKICAgIGZ1bmN0aW9uIG51bWJlck9mQmFja2VycygpIHB1YmxpYyB2aWV3IHJldHVybnModWludCwgdWludCwgdWludCwgdWludCkgewoKICAgICAgICB1aW50IG51bU9mQmFja2Vyc09uZTsKICAgICAgICB1aW50IG51bU9mQmFja2Vyc1R3bzsKICAgICAgICB1aW50IG51bU9mQmFja2Vyc01haW47CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGJhY2tlcnNJbmRleC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBCYWNrZXIgc3RvcmFnZSBiYWNrZXIgPSBiYWNrZXJzW2JhY2tlcnNJbmRleFtpXV07CiAgICAgICAgICAgIGlmIChiYWNrZXIud2VpUmVjZWl2ZWRPbmUgPiAwKQogICAgICAgICAgICAgICAgbnVtT2ZCYWNrZXJzT25lICsrOwogICAgICAgICAgICBpZiAoYmFja2VyLndlaVJlY2VpdmVkVHdvID4gMCkKICAgICAgICAgICAgICAgIG51bU9mQmFja2Vyc1R3byArKzsKICAgICAgICAgICAgaWYgKGJhY2tlci53ZWlSZWNlaXZlZE1haW4gPiAwKQogICAgICAgICAgICAgICAgbnVtT2ZCYWNrZXJzTWFpbiArKzsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiAoIG51bU9mQmFja2Vyc09uZSwgbnVtT2ZCYWNrZXJzVHdvLCBudW1PZkJhY2tlcnNNYWluLCBiYWNrZXJzSW5kZXgubGVuZ3RoKTsKICAgIH0KCgoKICAgIC8vIEBub3RpY2UgYWR2YW5jZXMgdGhlIHN0ZXAgb2YgY2FtcGFpZ24gdG8gcHJlc2FsZSAyCiAgICAvLyBjb250cmFjdCBpcyBkZXBsb3llZCBpbiBwcmVzYWxlIDEgbW9kZQogICAgZnVuY3Rpb24gc2V0UHJlc2FsZVR3bygpIHB1YmxpYyBvbmx5T3duZXIoKSB7CiAgICAgICAgY3VycmVudFN0ZXAgPSBTdGVwLkZ1bmRpbmdQcmVzYWxlVHdvOwogICAgICAgIG1pbkludmVzdG1lbnQgPSAxMCBldGhlcjsgIC8vIDEwIGV0aAogICAgfQoKICAgIC8vIEBub3RpY2UgYWR2YW5jZXMgc3RlcCBvZiBjYW1wYWlnbiB0byBtYWluIHNhbGUKICAgIC8vIEBwYXJhbSBfcmF0aW8gICAtIGl0IHdpbGwgYmUgYW1vdW50IG9mIGRvbGxhcnMgZm9yIG9uZSBldGhlciB3aXRoIHR3byBkZWNpbWFscy4KICAgIC8vIHR3byBkZWNpbWFscyB3aWxsIGJlIHBhc3NlZCBhcyBuZXh0IHNldHMgb2YgZGlnaXRzLiBlZy4gJDMwMC4yNSB3aWxsIGJlIHBhc3NlZCBhcyAzMDAyNQogICAgZnVuY3Rpb24gc2V0TWFpblNhbGUodWludCBfcmF0aW8pIHB1YmxpYyBvbmx5T3duZXIoKSB7CgogICAgICAgIHJlcXVpcmUoX3JhdGlvID4gMCk7CiAgICAgICAgY3VycmVudFN0ZXAgPSBTdGVwLkZ1bmRpbmdNYWluU2FsZTsKICAgICAgICBkb2xsYXJQZXJFdGhlclJhdGlvID0gX3JhdGlvOwogICAgICAgIG1heENhcFRva2VucyA9IDUwZTI0OwogICAgICAgIG1pbkludmVzdG1lbnQgPSAxIGV0aGVyIC8gMTA7ICAvLyAwLjEgZXRoCiAgICAgICAgdG90YWxUb2tlbnNTb2xkID0gKGRvbGxhclBlckV0aGVyUmF0aW8gKiBldGhSZWNlaXZlZFByZXNhbGVPbmUpIC8gNDg7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gZmlyc3QgcHJlc2FsZQogICAgICAgIHRvdGFsVG9rZW5zU29sZCArPSAoZG9sbGFyUGVyRXRoZXJSYXRpbyAqIGV0aFJlY2VpdmVkUHJlc2FsZVR3bykgLyA1NTsgIC8vIGRldGVybWluZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgZnJvbSBzZWNvbmQgcHJlc2FsZSBhbmQgdG90YWwgaXQuCiAgICB9CgoKICAgIC8vIEBub3RpY2UgdG8gcG9wdWxhdGUgd2Vic2l0ZSB3aXRoIHN0YXR1cyBvZiB0aGUgc2FsZQogICAgZnVuY3Rpb24gcmV0dXJuV2Vic2l0ZURhdGEoKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgIGJvb2wpIHsKCiAgICAgICAgcmV0dXJuIChzdGFydEJsb2NrLCBlbmRCbG9jaywgYmFja2Vyc0luZGV4Lmxlbmd0aCwgZXRoUmVjZWl2ZWRQcmVzYWxlT25lLCBldGhSZWNlaXZlZFByZXNhbGVUd28sIGV0aFJlY2VpdmVNYWluU2FsZSwgbWF4Q2FwVG9rZW5zLCAgIG1pbkludmVzdG1lbnQsICBzdG9wcGVkKTsKICAgIH0KCgogICAgLy8ge2ZhbGxiYWNrIGZ1bmN0aW9ufQogICAgLy8gQG5vdGljZSBJdCB3aWxsIGNhbGwgaW50ZXJuYWwgZnVuY3Rpb24gd2hpY2ggaGFuZGxlcyBhbGxvY2F0aW9uIG9mIEV0aGVyIGFuZCBjYWxjdWxhdGVzIHRva2Vucy4KICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBjb250cmlidXRlKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIEBub3RpY2UgaW4gY2FzZSByZWZ1bmRzIGFyZSBuZWVkZWQsIG1vbmV5IGNhbiBiZSByZXR1cm5lZCB0byB0aGUgY29udHJhY3QKICAgIC8vIEBwYXJhbSBfcmV0dXJuUGVyY2VudGFnZSB7dWludH0gcGVyY2VudGFnZSBvZiByZXR1cm4gaW4gcmVzcGVjdCB0byBmaXJzdCBwcmVzYWxlLiBlLmcgNzUlIHdvdWxkIGJlIHBhc3NlZCBhcyA3NQogICAgZnVuY3Rpb24gZnVuZENvbnRyYWN0KHVpbnQgX3JldHVyblBlcmNlbnRhZ2UpIGV4dGVybmFsIHBheWFibGUgb25seU93bmVyKCkgewoKICAgICAgICByZXF1aXJlKF9yZXR1cm5QZXJjZW50YWdlID4gMCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gKGV0aFJlY2VpdmVkUHJlc2FsZU9uZS5tdWwoX3JldHVyblBlcmNlbnRhZ2UpIC8gMTAwKSArIGV0aFJlY2VpdmVkUHJlc2FsZVR3byArIGV0aFJlY2VpdmVNYWluU2FsZSk7CiAgICAgICAgcmV0dXJuUGVyY2VudGFnZSA9IF9yZXR1cm5QZXJjZW50YWdlOwogICAgICAgIGN1cnJlbnRTdGVwID0gU3RlcC5SZWZ1bmRpbmc7CiAgICB9CgogICAgLy8gQG5vdGljZSBJdCB3aWxsIGJlIGNhbGxlZCBieSBvd25lciB0byBzdGFydCB0aGUgc2FsZQogICAgLy8gYmxvY2sgbnVtYmVycyB3aWxsIGJlIGNhbGN1bGF0ZWQgYmFzZWQgb24gY3VycmVudCBibG9jayB0aW1lIGF2ZXJhZ2UuICAgIAogICAgZnVuY3Rpb24gc3RhcnQoKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CiAgICAgICAgc3RhcnRCbG9jayA9IGJsb2NrLm51bWJlcjsKICAgICAgICBlbmRCbG9jayA9IHN0YXJ0QmxvY2sgKyA1NjM0NzI7IC8vIDQuMyo2MCoyNCo5MSBkYXlzCiAgICB9CgogICAgLy8gQG5vdGljZSBEdWUgdG8gY2hhbmdpbmcgYXZlcmFnZSBvZiBibG9jayB0aW1lCiAgICAvLyB0aGlzIGZ1bmN0aW9uIHdpbGwgYWxsb3cgb24gYWRqdXN0aW5nIGR1cmF0aW9uIG9mIGNhbXBhaWduIGNsb3NlciB0byB0aGUgZW5kCiAgICAvLyBhbGxvdyBhZGp1c3RpbmcgY2FtcGFpZ24gbGVuZ3RoIHRvIDEwMSBkYXlzLCBlcXVpdmFsZW50IG9mIDYyNTM5MiBibG9ja3MgYXQgNC4zIGJsb2NrcyBwZXIgbWludXRlCiAgICAvLyBAcGFyYW0gX2Jsb2NrICBudW1iZXIgb2YgYmxvY2tzIHJlcHJlc2VudGluZyBkdXJhdGlvbgogICAgZnVuY3Rpb24gYWRqdXN0RHVyYXRpb24odWludCBfYmxvY2spIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICAvLyB3ZSdsbCB3YW50IHRvIHNldCB0aGlzIHRvIGEgYnVmZmVyIGJleW9uZCB0aGUgZW5kIG9mIHRoZSAiZXhwZWN0ZWQiIGVuZCBkYXRlIHNvIHRoYXQgd2UgY2FuIGV4dGVuZCB0aGUgc2FsZSBpZiBuZWVkZWQvZGVzaXJlZC4KICAgICAgICByZXF1aXJlKF9ibG9jayA8PSA2MjUzOTIpOyAgLy8gNC4zJiMyMTU7NjAmIzIxNTsyNCYjMjE1OzEwMSBkYXlzCiAgICAgICAgcmVxdWlyZShfYmxvY2sgPiBibG9jay5udW1iZXIuc3ViKHN0YXJ0QmxvY2spKTsgLy8gZW5zdXJlIHRoYXQgZW5kQmxvY2sgaXMgbm90IHNldCBpbiB0aGUgcGFzdAogICAgICAgIGVuZEJsb2NrID0gc3RhcnRCbG9jay5hZGQoX2Jsb2NrKTsKICAgIH0KCgogICAgLy8gQG5vdGljZSBJdCB3aWxsIGJlIGNhbGxlZCBieSBmYWxsYmFjayBmdW5jdGlvbiB3aGVuZXZlciBldGhlciBpcyBzZW50IHRvIGl0CiAgICAvLyBAcGFyYW0gIF9jb250cmlidXRvciB7YWRkcmVzc30gYWRkcmVzcyBvZiBjb250cmlidXRvcgogICAgLy8gQHJldHVybiByZXMge2Jvb2x9IHRydWUgaWYgdHJhbnNhY3Rpb24gd2FzIHN1Y2Nlc3NmdWwKCiAgICBmdW5jdGlvbiBjb250cmlidXRlKGFkZHJlc3MgX2NvbnRyaWJ1dG9yKSBpbnRlcm5hbCBzdG9wSW5FbWVyZ2VuY3kgcmVzcGVjdFRpbWVGcmFtZSByZXR1cm5zKGJvb2wgcmVzKSB7CgoKICAgICAgICByZXF1aXJlKHdoaXRlTGlzdC5pc1doaXRlTGlzdGVkKF9jb250cmlidXRvcikpOyAgLy8gZW5zdXJlIHRoYXQgdXNlciBpcyB3aGl0ZWxpc3RlZAogICAgICAgIEJhY2tlciBzdG9yYWdlIGJhY2tlciA9IGJhY2tlcnNbX2NvbnRyaWJ1dG9yXTsKICAgICAgICByZXF1aXJlIChtc2cudmFsdWUgPj0gbWluSW52ZXN0bWVudCk7ICAvLyBlbnN1cmUgdGhhdCBtaW4gY29udHJpYnV0aW9ucyBhbW91bnQgaXMgbWV0CgogICAgICAgIGlmIChiYWNrZXIud2VpUmVjZWl2ZWRPbmUgPT0gMCAmJiBiYWNrZXIud2VpUmVjZWl2ZWRUd28gPT0gMCAmJiBiYWNrZXIud2VpUmVjZWl2ZWRNYWluID09IDApCiAgICAgICAgICAgIGJhY2tlcnNJbmRleC5wdXNoKF9jb250cmlidXRvcik7CgogICAgICAgIGlmIChjdXJyZW50U3RlcCA9PSBTdGVwLkZ1bmRpbmdQcmVzYWxlT25lKSB7ICAgICAgICAgIAogICAgICAgICAgICBiYWNrZXIud2VpUmVjZWl2ZWRPbmUgPSBiYWNrZXIud2VpUmVjZWl2ZWRPbmUuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIGV0aFJlY2VpdmVkUHJlc2FsZU9uZSA9IGV0aFJlY2VpdmVkUHJlc2FsZU9uZS5hZGQobXNnLnZhbHVlKTsgLy8gVXBkYXRlIHRoZSB0b3RhbCBFdGhlciByZWNlaXZlZCBpbiBwcmVzYWxlIDEKICAgICAgICAgICAgcmVxdWlyZShldGhSZWNlaXZlZFByZXNhbGVPbmUgPD0gbWF4Q2FwRXRoKTsgIC8vIGVuc3VyZSB0aGF0IG1heCBjYXAgaGFzbid0IGJlZW4gcmVhY2hlZAogICAgICAgIH1lbHNlIGlmIChjdXJyZW50U3RlcCA9PSBTdGVwLkZ1bmRpbmdQcmVzYWxlVHdvKSB7ICAgICAgICAgICAKICAgICAgICAgICAgYmFja2VyLndlaVJlY2VpdmVkVHdvID0gYmFja2VyLndlaVJlY2VpdmVkVHdvLmFkZChtc2cudmFsdWUpOwogICAgICAgICAgICBldGhSZWNlaXZlZFByZXNhbGVUd28gPSBldGhSZWNlaXZlZFByZXNhbGVUd28uYWRkKG1zZy52YWx1ZSk7ICAvLyBVcGRhdGUgdGhlIHRvdGFsIEV0aGVyIHJlY2VpdmVkIGluIHByZXNhbGUgMgogICAgICAgICAgICByZXF1aXJlKGV0aFJlY2VpdmVkUHJlc2FsZU9uZSArIGV0aFJlY2VpdmVkUHJlc2FsZVR3byA8PSBtYXhDYXBFdGgpOyAgLy8gZW5zdXJlIHRoYXQgbWF4IGNhcCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICAgICAgfWVsc2UgaWYgKGN1cnJlbnRTdGVwID09IFN0ZXAuRnVuZGluZ01haW5TYWxlKSB7CiAgICAgICAgICAgIGJhY2tlci53ZWlSZWNlaXZlZE1haW4gPSBiYWNrZXIud2VpUmVjZWl2ZWRNYWluLmFkZChtc2cudmFsdWUpOwogICAgICAgICAgICBldGhSZWNlaXZlTWFpblNhbGUgPSBldGhSZWNlaXZlTWFpblNhbGUuYWRkKG1zZy52YWx1ZSk7ICAvLyBVcGRhdGUgdGhlIHRvdGFsIEV0aGVyIHJlY2VpdmVkIGluIHByZXNhbGUgMgogICAgICAgICAgICB1aW50IHRva2Vuc1RvU2VuZCA9IGRvbGxhclBlckV0aGVyUmF0aW8ubXVsKG1zZy52YWx1ZSkgLyA2MjsgIC8vIGNhbGN1bGF0ZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgZm9yIHRoaXMgdXNlciAKICAgICAgICAgICAgdG90YWxUb2tlbnNTb2xkICs9IHRva2Vuc1RvU2VuZDsKICAgICAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NvbGQgPD0gbWF4Q2FwVG9rZW5zKTsgIC8vIGVuc3VyZSB0aGF0IG1heCBjYXAgaGFzbid0IGJlZW4gcmVhY2hlZAogICAgICAgIH0KICAgICAgICBtdWx0aXNpZy50cmFuc2Zlcihtc2cudmFsdWUpOyAgLy8gc2VuZCBtb25leSB0byBtdWx0aXNpZ25hdHVyZSB3YWxsZXQKCiAgICAgICAgUmVjZWl2ZWRFVEgoX2NvbnRyaWJ1dG9yLCBjdXJyZW50U3RlcCwgbXNnLnZhbHVlKTsgLy8gUmVnaXN0ZXIgZXZlbnQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIHdpbGwgZmluYWxpemUgdGhlIHNhbGUuCiAgICAvLyBJdCB3aWxsIG9ubHkgZXhlY3V0ZSBpZiBwcmVkZXRlcm1pbmVkIHNhbGUgdGltZSBwYXNzZWQgb3IgYWxsIHRva2VucyB3ZXJlIHNvbGQKCiAgICBmdW5jdGlvbiBmaW5hbGl6ZVNhbGUoKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShkYXRlSUNPRW5kZWQgPT0gMCk7CiAgICAgICAgcmVxdWlyZShjdXJyZW50U3RlcCA9PSBTdGVwLkZ1bmRpbmdNYWluU2FsZSk7CiAgICAgICAgLy8gcHVyY2hhc2luZyBwcmVjaXNlIG51bWJlciBvZiB0b2tlbnMgbWlnaHQgYmUgaW1wcmFjdGljYWwsIHRodXMgc3VidHJhY3QgMTAwMCB0b2tlbnMgc28gZmluYWxpemF0aW9uIGlzIHBvc3NpYmxlCiAgICAgICAgLy8gbmVhciB0aGUgZW5kCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPj0gZW5kQmxvY2sgfHwgdG90YWxUb2tlbnNTb2xkID49IG1heENhcFRva2Vucy5zdWIoMTAwMCkpOwogICAgICAgIHJlcXVpcmUodG90YWxUb2tlbnNTb2xkID49IG1pbkNhcFRva2Vucyk7CiAgICAgICAgCiAgICAgICAgY29tcGFueVRva2Vuc0luaXRpYWwgKz0gbWF4Q2FwVG9rZW5zIC0gdG90YWxUb2tlbnNTb2xkOyAvLyBhbGxvY2F0ZSB1bnNvbGQgdG9rZW5zIHRvIHRoZSBjb21wYW55ICAgICAgICAKICAgICAgICBkYXRlSUNPRW5kZWQgPSBub3c7CiAgICAgICAgdG9rZW4udW5sb2NrKCk7CiAgICB9CgoKICAgIC8vIEBub3RpY2UgdGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCBieSBvd25lciB0byB1cGRhdGUgY29udHJpYnV0aW9uIGFkZHJlc3MgaW4gY2FzZSBvZiB1c2luZyBhZGRyZXNzIGZyb20gZXhjaGFuZ2Ugb3IgaW5jb21wYXRpYmxlIHdhbGxldAogICAgLy8gQHBhcmFtIF9jb250cmlidXRvck9sZCAtIG9sZCBjb250cmlidXRvciBhZGRyZXNzCiAgICAvLyBAcGFyYW0gX2NvbnRyaWJ1dG9yTmV3IC0gbmV3IGNvbnRyaWJ1dG9yIGFkZHJlc3MKICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbnRyaWJ1dG9yQWRkcmVzcyhhZGRyZXNzIF9jb250cmlidXRvck9sZCwgYWRkcmVzcyBfY29udHJpYnV0b3JOZXcpIHB1YmxpYyBvbmx5T3duZXIoKSB7CgogICAgICAgIEJhY2tlciBzdG9yYWdlIGJhY2tlck9sZCA9IGJhY2tlcnNbX2NvbnRyaWJ1dG9yT2xkXTsKICAgICAgICBCYWNrZXIgc3RvcmFnZSBiYWNrZXJOZXcgPSBiYWNrZXJzW19jb250cmlidXRvck5ld107CgogICAgICAgIHJlcXVpcmUoYmFja2VyT2xkLndlaVJlY2VpdmVkT25lID4gMCB8fCBiYWNrZXJPbGQud2VpUmVjZWl2ZWRUd28gPiAwIHx8IGJhY2tlck9sZC53ZWlSZWNlaXZlZE1haW4gPiAwKTsgLy8gbWFrZSBzdXJlIHRoYXQgY29udHJpYnV0aW9uIGhhcyBiZWVuIG1hZGUgdG8gdGhlIG9sZCBhZGRyZXNzCiAgICAgICAgcmVxdWlyZShiYWNrZXJOZXcud2VpUmVjZWl2ZWRPbmUgPT0gMCAmJiBiYWNrZXJOZXcud2VpUmVjZWl2ZWRUd28gPT0gMCAmJiBiYWNrZXJOZXcud2VpUmVjZWl2ZWRNYWluID09IDApOyAvLyBtYWtlIHN1cmUgdGhhdCBleGlzdGluZyBhZGRyZXNzIGlzIG5vdCB1c2VkCiAgICAgICAgcmVxdWlyZShiYWNrZXJPbGQuY2xhaW1lZCA9PSBmYWxzZSAmJiBiYWNrZXJPbGQucmVmdW5kZWQgPT0gZmFsc2UpOyAgLy8gZW5zdXJlIHRoYXQgY29udHJpYnV0b3IgaGFzbid0IGJlIHJlZnVuZGVkIG9yIGNsYWltZWQgdGhlIHRva2VucyB5ZXQKCiAgICAgICAgLy8gaW52YWxpZGF0ZSBvbGQgYWRkcmVzcwogICAgICAgIGJhY2tlck9sZC5jbGFpbWVkID0gdHJ1ZTsKICAgICAgICBiYWNrZXJPbGQucmVmdW5kZWQgPSB0cnVlOwoKICAgICAgICAvLyBpbml0aWFsaXplIG5ldyBhZGRyZXNzCiAgICAgICAgYmFja2VyTmV3LndlaVJlY2VpdmVkT25lID0gYmFja2VyT2xkLndlaVJlY2VpdmVkT25lOwogICAgICAgIGJhY2tlck5ldy53ZWlSZWNlaXZlZFR3byA9IGJhY2tlck9sZC53ZWlSZWNlaXZlZFR3bzsKICAgICAgICBiYWNrZXJOZXcud2VpUmVjZWl2ZWRNYWluID0gYmFja2VyT2xkLndlaVJlY2VpdmVkTWFpbjsKICAgICAgICBiYWNrZXJzSW5kZXgucHVzaChfY29udHJpYnV0b3JOZXcpOwogICAgfQoKICAgIC8vIEBub3RpY2UgY2FsbGVkIHRvIHNlbmQgdG9rZW5zIHRvIGNvbnRyaWJ1dG9ycyBhZnRlciBJQ08uCiAgICAvLyBAcGFyYW0gX2JhY2tlciB7YWRkcmVzc30gYWRkcmVzcyBvZiBiZW5lZmljaWFyeQogICAgLy8gQHJldHVybiB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zRm9yVXNlcihhZGRyZXNzIF9iYWNrZXIpIGludGVybmFsIHJldHVybnMoYm9vbCkgeyAgICAgICAgCgogICAgICAgIHJlcXVpcmUoZGF0ZUlDT0VuZGVkID4gMCk7IC8vIGFsbG93IG9uIGNsYWltaW5nIG9mIHRva2VucyBpZiBJQ08gd2FzIHN1Y2Nlc3NmdWwgICAgICAgICAgICAgCgogICAgICAgIEJhY2tlciBzdG9yYWdlIGJhY2tlciA9IGJhY2tlcnNbX2JhY2tlcl07CgogICAgICAgIHJlcXVpcmUgKCFiYWNrZXIucmVmdW5kZWQpOyAvLyBpZiByZWZ1bmRlZCwgZG9uJ3QgYWxsb3cgdG8gY2xhaW0gdG9rZW5zCiAgICAgICAgcmVxdWlyZSAoIWJhY2tlci5jbGFpbWVkKTsgLy8gaWYgdG9rZW5zIGNsYWltZWQsIGRvbid0IGFsbG93IHRvIGNsYWltIGFnYWluCiAgICAgICAgcmVxdWlyZSAoYmFja2VyLndlaVJlY2VpdmVkT25lID4gMCB8fCBiYWNrZXIud2VpUmVjZWl2ZWRUd28gPiAwIHx8IGJhY2tlci53ZWlSZWNlaXZlZE1haW4gPiAwKTsgICAvLyBvbmx5IGNvbnRpbnVlIGlmIHRoZXJlIGlzIGFueSBjb250cmlidXRpb24KCiAgICAgICAgY2xhaW1Db3VudCsrOwogICAgICAgIHVpbnQgdG9rZW5zVG9TZW5kID0gKGRvbGxhclBlckV0aGVyUmF0aW8gKiBiYWNrZXIud2VpUmVjZWl2ZWRPbmUpIC8gNDg7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gZmlyc3QgcHJlc2FsZQogICAgICAgIHRva2Vuc1RvU2VuZCA9IHRva2Vuc1RvU2VuZCArIChkb2xsYXJQZXJFdGhlclJhdGlvICogYmFja2VyLndlaVJlY2VpdmVkVHdvKSAvIDU1OyAgLy8gZGV0ZXJtaW5lIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCBmcm9tIHNlY29uZCBwcmVzYWxlCiAgICAgICAgdG9rZW5zVG9TZW5kID0gdG9rZW5zVG9TZW5kICsgKGRvbGxhclBlckV0aGVyUmF0aW8gKiBiYWNrZXIud2VpUmVjZWl2ZWRNYWluKSAvIDYyOyAgLy8gZGV0ZXJtaW5lIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCBmcm9tIG1haW4gc2FsZQoKICAgICAgICBjbGFpbWVkW19iYWNrZXJdID0gdG9rZW5zVG9TZW5kOyAgLy8gc2F2ZSBjbGFpbWVkIHRva2VucwogICAgICAgIGJhY2tlci5jbGFpbWVkID0gdHJ1ZTsKICAgICAgICBiYWNrZXIudG9rZW5zU2VudCA9IHRva2Vuc1RvU2VuZDsKICAgICAgICB0b3RhbENsYWltZWQgKz0gdG9rZW5zVG9TZW5kOwoKICAgICAgICBpZiAoIXRva2VuLnRyYW5zZmVyKF9iYWNrZXIsIHRva2Vuc1RvU2VuZCkpCiAgICAgICAgICAgIHJldmVydCgpOyAvLyBzZW5kIGNsYWltZWQgdG9rZW5zIHRvIGNvbnRyaWJ1dG9yIGFjY291bnQKCiAgICAgICAgVG9rZW5zQ2xhaW1lZChfYmFja2VyLHRva2Vuc1RvU2VuZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEBub3RpY2UgY29udHJpYnV0b3JzIGNhbiBjbGFpbSB0b2tlbnMgYWZ0ZXIgcHVibGljIElDTyBpcyBmaW5pc2hlZAogICAgLy8gdG9rZW5zIGFyZSBvbmx5IGNsYWltYWJsZSB3aGVuIHRva2VuIGFkZHJlc3MgaXMgYXZhaWxhYmxlLgoKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKCkgZXh0ZXJuYWwgewogICAgICAgIGNsYWltVG9rZW5zRm9yVXNlcihtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLy8gQG5vdGljZSB0aGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgYnkgYWRtaW4gdG8gY2xhaW0gdXNlcidzIHRva2VuIGluIGNhc2Ugb2YgZGlmZmljdWx0aWVzCiAgICAvLyBAcGFyYW0gX2JhY2tlciB7YWRkcmVzc30gdXNlciBhZGRyZXNzIHRvIGNsYWltIHRva2VucyBmb3IKICAgIGZ1bmN0aW9uIGFkbWluQ2xhaW1Ub2tlbkZvclVzZXIoYWRkcmVzcyBfYmFja2VyKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CiAgICAgICAgY2xhaW1Ub2tlbnNGb3JVc2VyKF9iYWNrZXIpOwogICAgfQoKICAgIC8vIEBub3RpY2UgYWxsb3cgcmVmdW5kIHdoZW4gSUNPIGZhaWxlZAogICAgLy8gSW4gc3VjaCBhIGNhc2UgY29udHJhY3Qgd2lsbCBuZWVkIHRvIGJlIGZ1bmRlZC4KICAgIC8vIFVudGlsIGNvbnRyYWN0IGlzIGZ1bmRlZCB0aGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cKCiAgICBmdW5jdGlvbiByZWZ1bmQoKSBleHRlcm5hbCB7CgogICAgICAgIHJlcXVpcmUoY3VycmVudFN0ZXAgPT0gU3RlcC5SZWZ1bmRpbmcpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICByZXF1aXJlKHRvdGFsVG9rZW5zU29sZCA8IG1heENhcFRva2Vucy8yKTsgLy8gZW5zdXJlIHRoYXQgcmVmdW5kIGlzIGltcG9zc2libGUgd2hlbiBtb3JlIHRoYW4gaGFsZiBvZiB0aGUgdG9rZW5zIGFyZSBzb2xkCgogICAgICAgIEJhY2tlciBzdG9yYWdlIGJhY2tlciA9IGJhY2tlcnNbbXNnLnNlbmRlcl07CgogICAgICAgIHJlcXVpcmUgKCFiYWNrZXIuY2xhaW1lZCk7IC8vIGNoZWNrIGlmIHRva2VucyBoYXZlIGJlZW4gYWxsb2NhdGVkIGFscmVhZHkKICAgICAgICByZXF1aXJlICghYmFja2VyLnJlZnVuZGVkKTsgLy8gY2hlY2sgaWYgdXNlciBoYXMgYmVlbiBhbHJlYWR5IHJlZnVuZGVkCgogICAgICAgIHVpbnQgdG90YWxFdGhlclJlY2VpdmVkID0gKChiYWNrZXIud2VpUmVjZWl2ZWRPbmUgKiByZXR1cm5QZXJjZW50YWdlKSAvIDEwMCkgKyBiYWNrZXIud2VpUmVjZWl2ZWRUd28gKyBiYWNrZXIud2VpUmVjZWl2ZWRNYWluOyAgLy8gcmV0dXJuIG9ubHkgZS5nLiA3NSUgZnJvbSBwcmVzYWxlIG9uZS4KICAgICAgICBhc3NlcnQodG90YWxFdGhlclJlY2VpdmVkID4gMCk7CgogICAgICAgIGJhY2tlci5yZWZ1bmRlZCA9IHRydWU7IC8vIG1hcmsgY29udHJpYnV0b3IgYXMgcmVmdW5kZWQuCiAgICAgICAgdG90YWxSZWZ1bmRlZCArPSB0b3RhbEV0aGVyUmVjZWl2ZWQ7CiAgICAgICAgcmVmdW5kQ291bnQgKys7CiAgICAgICAgcmVmdW5kZWRbbXNnLnNlbmRlcl0gPSB0b3RhbFJlZnVuZGVkOwoKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvdGFsRXRoZXJSZWNlaXZlZCk7ICAvLyByZWZ1bmQgY29udHJpYnV0aW9uCiAgICAgICAgUmVmdW5kZWQobXNnLnNlbmRlciwgdG90YWxFdGhlclJlY2VpdmVkKTsgLy8gbG9nIGV2ZW50CiAgICB9CgoKCiAgICAvLyBAbm90aWNlIHJlZnVuZCBub24gY29tcGxpYW50IG1lbWJlciAKICAgIC8vIEBwYXJhbSBfY29udHJpYnV0b3Ige2FkZHJlc3N9IG9mIHJlZnVuZGVkIGNvbnRyaWJ1dG9yCiAgICBmdW5jdGlvbiByZWZ1bmROb25Db21wbGlhbnQoYWRkcmVzcyBfY29udHJpYnV0b3IpIHBheWFibGUgZXh0ZXJuYWwgb25seU93bmVyKCkgewogICAgCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyID0gYmFja2Vyc1tfY29udHJpYnV0b3JdOwoKICAgICAgICByZXF1aXJlICghYmFja2VyLmNsYWltZWQpOyAvLyBjaGVjayBpZiB0b2tlbnMgaGF2ZSBiZWVuIGFsbG9jYXRlZCBhbHJlYWR5CiAgICAgICAgcmVxdWlyZSAoIWJhY2tlci5yZWZ1bmRlZCk7IC8vIGNoZWNrIGlmIHVzZXIgaGFzIGJlZW4gYWxyZWFkeSByZWZ1bmRlZAogICAgICAgIGJhY2tlci5yZWZ1bmRlZCA9IHRydWU7IC8vIG1hcmsgY29udHJpYnV0b3IgYXMgcmVmdW5kZWQuICAgICAgICAgICAgCgogICAgICAgIHVpbnQgdG90YWxFdGhlclJlY2VpdmVkID0gYmFja2VyLndlaVJlY2VpdmVkT25lICsgYmFja2VyLndlaVJlY2VpdmVkVHdvICsgYmFja2VyLndlaVJlY2VpdmVkTWFpbjsKCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gdG90YWxFdGhlclJlY2VpdmVkKTsgLy8gZW5zdXJlIHRoYXQgZXhhY3QgYW1vdW50IGlzIHNlbnQKICAgICAgICBhc3NlcnQodG90YWxFdGhlclJlY2VpdmVkID4gMCk7CgogICAgICAgIC8vYWRqdXN0IGFtb3VudHMgcmVjZWl2ZWQKICAgICAgICBldGhSZWNlaXZlZFByZXNhbGVPbmUgLT0gYmFja2VyLndlaVJlY2VpdmVkT25lOwogICAgICAgIGV0aFJlY2VpdmVkUHJlc2FsZVR3byAtPSBiYWNrZXIud2VpUmVjZWl2ZWRUd287CiAgICAgICAgZXRoUmVjZWl2ZU1haW5TYWxlIC09IGJhY2tlci53ZWlSZWNlaXZlZE1haW47CiAgICAgICAgCiAgICAgICAgdG90YWxSZWZ1bmRlZCArPSB0b3RhbEV0aGVyUmVjZWl2ZWQ7CiAgICAgICAgcmVmdW5kQ291bnQgKys7CiAgICAgICAgcmVmdW5kZWRbX2NvbnRyaWJ1dG9yXSA9IHRvdGFsUmVmdW5kZWQ7ICAgICAgCgogICAgICAgIHVpbnQgdG9rZW5zVG9TZW5kID0gKGRvbGxhclBlckV0aGVyUmF0aW8gKiBiYWNrZXIud2VpUmVjZWl2ZWRPbmUpIC8gNDg7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gZmlyc3QgcHJlc2FsZQogICAgICAgIHRva2Vuc1RvU2VuZCA9IHRva2Vuc1RvU2VuZCArIChkb2xsYXJQZXJFdGhlclJhdGlvICogYmFja2VyLndlaVJlY2VpdmVkVHdvKSAvIDU1OyAgLy8gZGV0ZXJtaW5lIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCBmcm9tIHNlY29uZCBwcmVzYWxlCiAgICAgICAgdG9rZW5zVG9TZW5kID0gdG9rZW5zVG9TZW5kICsgKGRvbGxhclBlckV0aGVyUmF0aW8gKiBiYWNrZXIud2VpUmVjZWl2ZWRNYWluKSAvIDYyOyAgLy8gZGV0ZXJtaW5lIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCBmcm9tIG1haW4gc2FsZQoKICAgICAgICBpZihkYXRlSUNPRW5kZWQgPT0gMCkgewogICAgICAgICAgICB0b3RhbFRva2Vuc1NvbGQgLT0gdG9rZW5zVG9TZW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBhbnlUb2tlbnNJbml0aWFsICs9IHRva2Vuc1RvU2VuZDsKICAgICAgICB9CgogICAgICAgIF9jb250cmlidXRvci50cmFuc2Zlcih0b3RhbEV0aGVyUmVjZWl2ZWQpOyAgLy8gcmVmdW5kIGNvbnRyaWJ1dGlvbgogICAgICAgIFJlZnVuZGVkKF9jb250cmlidXRvciwgdG90YWxFdGhlclJlY2VpdmVkKTsgLy8gbG9nIGV2ZW50CiAgICB9CgogICAgLy8gQG5vdGljZSBGYWlsc2FmZSBkcmFpbiB0byBpbmRpdmlkdWFsIHdhbGxldAogICAgZnVuY3Rpb24gZHJhaW4oKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CiAgICAgICAgbXVsdGlzaWcudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCiAgICB9CgogICAgLy8gQG5vdGljZSBGYWlsc2FmZSB0b2tlbiB0cmFuc2ZlcgogICAgZnVuY3Rpb24gdG9rZW5EcmFpbigpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgIGlmIChibG9jay5udW1iZXIgPiBlbmRCbG9jaykgewogICAgICAgIGlmICghdG9rZW4udHJhbnNmZXIobXVsdGlzaWcsIHRva2VuLmJhbGFuY2VPZih0aGlzKSkpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9Cn0KCgoKCgovLyBAbm90aWNlIFRoZSB0b2tlbiBjb250cmFjdApjb250cmFjdCBUb2tlbiBpcyBFUkMyMCwgIE93bmFibGUgewoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogICAgLy8gUHVibGljIHZhcmlhYmxlcyBvZiB0aGUgdG9rZW4KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAvLyBIb3cgbWFueSBkZWNpbWFscyB0byBzaG93LgogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gInYwLjEiOwogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICB1aW50IHB1YmxpYyBpbml0aWFsU3VwcGx5OwogICAgYm9vbCBwdWJsaWMgbG9ja2VkOwogICAgYWRkcmVzcyBwdWJsaWMgY3Jvd2RTYWxlQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIG1pZ3JhdGlvbk1hc3RlcjsKICAgIGFkZHJlc3MgcHVibGljIG1pZ3JhdGlvbkFnZW50OwogICAgdWludDI1NiBwdWJsaWMgdG90YWxNaWdyYXRlZDsKICAgIGFkZHJlc3MgcHVibGljIGF1dGhvcml6ZWQ7CgoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmFsYW5jZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgYWxsb3dlZDsKCiAgICAvLyBAbm90aWNlIHRva2VucyBhcmUgbG9ja2VkIGR1cmluZyB0aGUgSUNPLiBBbGxvdyB0cmFuc2ZlciBvZiB0b2tlbnMgYWZ0ZXIgSUNPLgogICAgbW9kaWZpZXIgb25seVVubG9ja2VkKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNyb3dkU2FsZUFkZHJlc3MgJiYgbG9ja2VkKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBATm90aWNlIGFsbG93IG1pbnRpbmcgb2YgdG9rZW5zIG9ubHkgYnkgYXV0aG9yaXplZCB1c2VycwogICAgbW9kaWZpZXIgb25seUF1dGhvcml6ZWQoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgbXNnLnNlbmRlciAhPSBhdXRob3JpemVkICkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLy8gQG5vdGljZSBUaGUgVG9rZW4gY29uc3RydWN0b3IKICAgIC8vIEBwYXJhbSBfY3Jvd2RTYWxlQWRkcmVzcyB7YWRkcmVzc30gYWRkcmVzcyBvZiBjcm93ZHNhbGUgY29udHJhY3QKICAgIC8vIEBwYXJhbSBfbWlncmF0aW9uTWFzdGVyIHthZGRyZXNzfSBhZGRyZXNzIG9mIGF1dGhvcml6ZWQgbWlncmF0aW9uIHBlcnNvbgogICAgZnVuY3Rpb24gVG9rZW4oYWRkcmVzcyBfY3Jvd2RTYWxlQWRkcmVzcykgcHVibGljIHsKCiAgICAgICAgcmVxdWlyZShfY3Jvd2RTYWxlQWRkcmVzcyAhPSAwKTsKCiAgICAgICAgbG9ja2VkID0gdHJ1ZTsgIC8vIExvY2sgdGhlIHRyYW5zZmVyIGZ1bmN0aW9uIGR1cmluZyB0aGUgY3Jvd2RzYWxlCiAgICAgICAgaW5pdGlhbFN1cHBseSA9IDFlMjY7CiAgICAgICAgdG90YWxTdXBwbHkgPSBpbml0aWFsU3VwcGx5OwogICAgICAgIG5hbWUgPSAiTmFycmF0aXZlIjsgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gIk5SViI7IC8vIFNldCB0aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgZGVjaW1hbHMgPSAxODsgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgY3Jvd2RTYWxlQWRkcmVzcyA9IF9jcm93ZFNhbGVBZGRyZXNzOwogICAgICAgIGJhbGFuY2VzW2Nyb3dkU2FsZUFkZHJlc3NdID0gaW5pdGlhbFN1cHBseTsKICAgICAgICBtaWdyYXRpb25NYXN0ZXIgPSBvd25lcjsKICAgICAgICBhdXRob3JpemVkID0gX2Nyb3dkU2FsZUFkZHJlc3M7CiAgICB9CgogICAgLy8gQG5vdGljZSB1bmxvY2sgdG9rZW5zIGZvciB0cmFkaW5nCiAgICBmdW5jdGlvbiB1bmxvY2soKSBwdWJsaWMgb25seUF1dGhvcml6ZWQgewogICAgICAgIGxvY2tlZCA9IGZhbHNlOwogICAgfQoKICAgIC8vIEBub3RpY2UgbG9jayB0b2tlbnMgaW4gY2FzZSBvZiBwcm9ibGVtcwogICAgZnVuY3Rpb24gbG9jaygpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCB7CiAgICAgICAgbG9ja2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHNldCBhdXRob3JpemVkIHBhcnR5CiAgICAvLyBAcGFyYW0gX2F1dGhvcml6ZWQge2FkZHJlc3N9IG9mIGFuIGluZGl2aWR1YWwgdG8gZ2V0IGF1dGhvcml6YXRpb24KICAgIGZ1bmN0aW9uIHNldEF1dGhvcml6ZWQoYWRkcmVzcyBfYXV0aG9yaXplZCkgcHVibGljIG9ubHlPd25lciB7CgogICAgICAgIGF1dGhvcml6ZWQgPSBfYXV0aG9yaXplZDsKICAgIH0KCgogICAgLy8gVG9rZW4gbWlncmF0aW9uIHN1cHBvcnQ6IGFzIGltcGxlbWVudGVkIGJ5IEdvbGVtCiAgICBldmVudCBNaWdyYXRlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwoKICAgIC8vLyBAbm90aWNlIE1pZ3JhdGUgdG9rZW5zIHRvIHRoZSBuZXcgdG9rZW4gY29udHJhY3QuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogT3BlcmF0aW9uYWwgTWlncmF0aW9uCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIG1pZ3JhdGVkCiAgICBmdW5jdGlvbiBtaWdyYXRlKHVpbnQyNTYgX3ZhbHVlKSAgZXh0ZXJuYWwgewogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBPcGVyYXRpb25hbCBNaWdyYXRpb24gc3RhdGUuCgogICAgICAgIHJlcXVpcmUgKG1pZ3JhdGlvbkFnZW50ICE9IDApOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIHRvdGFsTWlncmF0ZWQgPSB0b3RhbE1pZ3JhdGVkLmFkZChfdmFsdWUpOwogICAgICAgIE1pZ3JhdGlvbkFnZW50KG1pZ3JhdGlvbkFnZW50KS5taWdyYXRlRnJvbShtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICAgIE1pZ3JhdGUobXNnLnNlbmRlciwgbWlncmF0aW9uQWdlbnQsIF92YWx1ZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IGFkZHJlc3Mgb2YgbWlncmF0aW9uIHRhcmdldCBjb250cmFjdCBhbmQgZW5hYmxlIG1pZ3JhdGlvbgogICAgLy8vIHByb2Nlc3MuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogT3BlcmF0aW9uYWwgTm9ybWFsCiAgICAvLy8gQGRldiBTdGF0ZSB0cmFuc2l0aW9uOiAtPiBPcGVyYXRpb25hbCBNaWdyYXRpb24KICAgIC8vLyBAcGFyYW0gX2FnZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBNaWdyYXRpb25BZ2VudCBjb250cmFjdAogICAgZnVuY3Rpb24gc2V0TWlncmF0aW9uQWdlbnQoYWRkcmVzcyBfYWdlbnQpICBleHRlcm5hbCB7CiAgICAgICAgLy8gQWJvcnQgaWYgbm90IGluIE9wZXJhdGlvbmFsIE5vcm1hbCBzdGF0ZS4KCiAgICAgICAgcmVxdWlyZShtaWdyYXRpb25BZ2VudCA9PSAwKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWlncmF0aW9uTWFzdGVyKTsKICAgICAgICBtaWdyYXRpb25BZ2VudCA9IF9hZ2VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRNaWdyYXRpb25NYXN0ZXIoYWRkcmVzcyBfbWFzdGVyKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG1pZ3JhdGlvbk1hc3Rlcik7CiAgICAgICAgcmVxdWlyZShfbWFzdGVyICE9IDApOwogICAgICAgIG1pZ3JhdGlvbk1hc3RlciA9IF9tYXN0ZXI7CiAgICB9CgogICAgLy8gQG5vdGljZSBtaW50IG5ldyB0b2tlbnMgd2l0aCBtYXggb2YgMTk3LjUgbWlsbGlvbnMKICAgIC8vIEBwYXJhbSBfdGFyZ2V0IHthZGRyZXNzfSBvZiByZWNlaXB0CiAgICAvLyBAcGFyYW0gX21pbnRlZEFtb3VudCB7dWludH0gYW1vdW50IG9mIHRva2VucyB0byBiZSBtaW50ZWQKICAgIC8vIEByZXR1cm4gIHtib29sfSB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdGFyZ2V0LCB1aW50MjU2IF9taW50ZWRBbW91bnQpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCgpIHJldHVybnMoYm9vbCkgewogICAgICAgIGFzc2VydCh0b3RhbFN1cHBseS5hZGQoX21pbnRlZEFtb3VudCkgPD0gMTk3NWUyMyk7ICAvLyBlbnN1cmUgdGhhdCBtYXggYW1vdW50IGV2ZXIgbWludGVkIHNob3VsZCBub3QgZXhjZWVkIDE5Ny41IG1pbGxpb24gdG9rZW5zIHdpdGggMTggZGVjaW1hbHMKICAgICAgICBiYWxhbmNlc1tfdGFyZ2V0XSA9IGJhbGFuY2VzW190YXJnZXRdLmFkZChfbWludGVkQW1vdW50KTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfbWludGVkQW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfdGFyZ2V0LCBfbWludGVkQW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRyYW5zZmVyIHRva2VucyB0byBnaXZlbiBhZGRyZXNzCiAgICAvLyBAcGFyYW0gX3RvIHthZGRyZXNzfSBhZGRyZXNzIG9yIHJlY2lwaWVudAogICAgLy8gQHBhcmFtIF92YWx1ZSB7dWludH0gYW1vdW50IHRvIHRyYW5zZmVyCiAgICAvLyBAcmV0dXJuICB7Ym9vbH0gdHJ1ZSBpZiBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyBvbmx5VW5sb2NrZWQgcmV0dXJucyhib29sKSB7CgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBAbm90aWNlIHRyYW5zZmVyIHRva2VucyBmcm9tIGdpdmVuIGFkZHJlc3MgdG8gYW5vdGhlciBhZGRyZXNzCiAgICAvLyBAcGFyYW0gX2Zyb20ge2FkZHJlc3N9IGZyb20gd2hvbSB0b2tlbnMgYXJlIHRyYW5zZmVycmVkCiAgICAvLyBAcGFyYW0gX3RvIHthZGRyZXNzfSB0byB3aG9tIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgIC8vIEBwYXJhbSBfdmFsdWUge3VpbnR9IGFtb3VudCBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIC8vIEByZXR1cm4gIHtib29sfSB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5VW5sb2NrZWQgcmV0dXJucyhib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsgLy8gQ2hlY2sgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoCiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOyAvLyBDaGVjayBpZiBhbGxvd2VkIGlzIGdyZWF0ZXIgb3IgZXF1YWwKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOyAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7ICAvLyBhZGp1c3QgYWxsb3dlZAogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSB0byBxdWVyeSBiYWxhbmNlIG9mIGFjY291bnQKICAgIC8vIEByZXR1cm4gX293bmVyIHthZGRyZXNzfSBhZGRyZXNzIG9mIHVzZXIgdG8gcXVlcnkgYmFsYW5jZQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICAqCiAgICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEBub3RpY2UgdG8gcXVlcnkgb2YgYWxsb3dhbmNlIG9mIG9uZSB1c2VyIHRvIHRoZSBvdGhlcgogICAgLy8gQHBhcmFtIF9vd25lciB7YWRkcmVzc30gb2YgdGhlIG93bmVyIG9mIHRoZSBhY2NvdW50CiAgICAvLyBAcGFyYW0gX3NwZW5kZXIge2FkZHJlc3N9IG9mIHRoZSBzcGVuZGVyIG9mIHRoZSBhY2NvdW50CiAgICAvLyBAcmV0dXJuIHJlbWFpbmluZyB7dWludH0gYW1vdW50IG9mIHJlbWFpbmluZyBhbGxvd2FuY2UKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8qKgogICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAgKi8KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKfQ=='.
	

]
