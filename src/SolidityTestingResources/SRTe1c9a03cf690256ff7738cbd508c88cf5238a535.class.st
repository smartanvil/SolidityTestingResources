Class {
	#name : #SRTe1c9a03cf690256ff7738cbd508c88cf5238a535,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe1c9a03cf690256ff7738cbd508c88cf5238a535 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjA7CgovKgoqIAoqID09PT09PT09PT09PT09PT09PT09PT09PT09KgoqICBfX19fICAgX19fICAgICBfXyAgICAgICAgKgoqIHwgIF8gXCAvIF8gXCAgIHwgIHwgICAgICAgKiAKKiB8IHxfKSB8IHwgfCB8ICB8ICB8ICAgICAgICoKKiB8ICBfXy98IHxffCB8X198ICB8ICAgICAgICoKKiB8X3wgICAgXF9fXy98X19fX198ICAgICAgICoKKiAgICAgICAgICAgICAgICAgICAgICAgICAgICoKKiA9PT09PT09PT09PT09PT09PT09PT09PT09PSoKKiAtPiBXaGF0PwoqIFRoaXMgc291cmNlIGNvZGUgaXMgY29weSBvZiBQcm9vZiBvZiBXZWFrIExlZ3MgKFBPV0wpIHdoaWNoIGlzIGNvcHkgb2YgUE9XSDNECiogT25seSBkaWZmZXJlbmNlIGlzIHRoYXQsIHlvdSB3aWxsIHJlY2VpdmUgNTAlIGRpdmlkZW5kcy4KU1VDSyBBIERJQ0sgUE9PUkdVWQpwYXBhIGlzIGRhZGR5CiovCgpjb250cmFjdCBIb3VyZ2xhc3MgewogICAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgID0gICAgICAgICAgICBNT0RJRklFUlMgICAgICAgICAgICA9CiAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogICAgLy8gb25seSBwZW9wbGUgd2l0aCB0b2tlbnMKICAgIG1vZGlmaWVyIG9ubHlCYWdob2xkZXJzKCkgewogICAgICAgIHJlcXVpcmUobXlUb2tlbnMoKSA+IDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vIG9ubHkgcGVvcGxlIHdpdGggcHJvZml0cwogICAgbW9kaWZpZXIgb25seVN0cm9uZ2hhbmRzKCkgewogICAgICAgIHJlcXVpcmUobXlEaXZpZGVuZHModHJ1ZSkgPiAwKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLyBhZG1pbmlzdHJhdG9ycyBjYW46CiAgICAvLyAtPiBjaGFuZ2UgdGhlIG5hbWUgb2YgdGhlIGNvbnRyYWN0CiAgICAvLyAtPiBjaGFuZ2UgdGhlIG5hbWUgb2YgdGhlIHRva2VuCiAgICAvLyAtPiBjaGFuZ2UgdGhlIFBvUyBkaWZmaWN1bHR5IChIb3cgbWFueSB0b2tlbnMgaXQgY29zdHMgdG8gaG9sZCBhIG1hc3Rlcm5vZGUsIGluIGNhc2UgaXQgZ2V0cyBjcmF6eSBoaWdoIGxhdGVyKQogICAgLy8gdGhleSBDQU5OT1Q6CiAgICAvLyAtPiB0YWtlIGZ1bmRzCiAgICAvLyAtPiBkaXNhYmxlIHdpdGhkcmF3YWxzCiAgICAvLyAtPiBraWxsIHRoZSBjb250cmFjdAogICAgLy8gLT4gY2hhbmdlIHRoZSBwcmljZSBvZiB0b2tlbnMKICAgIG1vZGlmaWVyIG9ubHlBZG1pbmlzdHJhdG9yKCl7CiAgICAgICAgYWRkcmVzcyBfY3VzdG9tZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICByZXF1aXJlKGFkbWluaXN0cmF0b3JzW2tlY2NhazI1NihfY3VzdG9tZXJBZGRyZXNzKV0pOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIAogICAgLy8gZW5zdXJlcyB0aGF0IHRoZSBmaXJzdCB0b2tlbnMgaW4gdGhlIGNvbnRyYWN0IHdpbGwgYmUgZXF1YWxseSBkaXN0cmlidXRlZAogICAgLy8gbWVhbmluZywgbm8gZGl2aW5lIGR1bXAgd2lsbCBiZSBldmVyIHBvc3NpYmxlCiAgICAvLyByZXN1bHQ6IGhlYWx0aHkgbG9uZ2V2aXR5LgogICAgbW9kaWZpZXIgYW50aUVhcmx5V2hhbGUodWludDI1NiBfYW1vdW50T2ZFdGhlcmV1bSl7CiAgICAgICAgYWRkcmVzcyBfY3VzdG9tZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAKICAgICAgICAvLyBhcmUgd2Ugc3RpbGwgaW4gdGhlIHZ1bG5lcmFibGUgcGhhc2U/CiAgICAgICAgLy8gaWYgc28sIGVuYWN0IGFudGkgZWFybHkgd2hhbGUgcHJvdG9jb2wgCiAgICAgICAgaWYoIG9ubHlBbWJhc3NhZG9ycyAmJiAoKHRvdGFsRXRoZXJldW1CYWxhbmNlKCkgLSBfYW1vdW50T2ZFdGhlcmV1bSkgPD0gYW1iYXNzYWRvclF1b3RhXyApKXsKICAgICAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgICAgIC8vIGlzIHRoZSBjdXN0b21lciBpbiB0aGUgYW1iYXNzYWRvciBsaXN0PwogICAgICAgICAgICAgICAgYW1iYXNzYWRvcnNfW19jdXN0b21lckFkZHJlc3NdID09IHRydWUgJiYKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gZG9lcyB0aGUgY3VzdG9tZXIgcHVyY2hhc2UgZXhjZWVkIHRoZSBtYXggYW1iYXNzYWRvciBxdW90YT8KICAgICAgICAgICAgICAgIChhbWJhc3NhZG9yQWNjdW11bGF0ZWRRdW90YV9bX2N1c3RvbWVyQWRkcmVzc10gKyBfYW1vdW50T2ZFdGhlcmV1bSkgPD0gYW1iYXNzYWRvck1heFB1cmNoYXNlXwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyB1cGRhdGVkIHRoZSBhY2N1bXVsYXRlZCBxdW90YSAgICAKICAgICAgICAgICAgYW1iYXNzYWRvckFjY3VtdWxhdGVkUXVvdGFfW19jdXN0b21lckFkZHJlc3NdID0gU2FmZU1hdGguYWRkKGFtYmFzc2Fkb3JBY2N1bXVsYXRlZFF1b3RhX1tfY3VzdG9tZXJBZGRyZXNzXSwgX2Ftb3VudE9mRXRoZXJldW0pOwogICAgICAgIAogICAgICAgICAgICAvLyBleGVjdXRlCiAgICAgICAgICAgIF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaW4gY2FzZSB0aGUgZXRoZXIgY291bnQgZHJvcHMgbG93LCB0aGUgYW1iYXNzYWRvciBwaGFzZSB3b24ndCByZWluaXRpYXRlCiAgICAgICAgICAgIG9ubHlBbWJhc3NhZG9ycyA9IGZhbHNlOwogICAgICAgICAgICBfOyAgICAKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAgICAKICAgIAogICAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgID0gICAgICAgICAgICBFVkVOVFMgICAgICAgICAgICA9CiAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogICAgZXZlbnQgb25Ub2tlblB1cmNoYXNlKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBjdXN0b21lckFkZHJlc3MsCiAgICAgICAgdWludDI1NiBpbmNvbWluZ0V0aGVyZXVtLAogICAgICAgIHVpbnQyNTYgdG9rZW5zTWludGVkLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCByZWZlcnJlZEJ5CiAgICApOwogICAgCiAgICBldmVudCBvblRva2VuU2VsbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgY3VzdG9tZXJBZGRyZXNzLAogICAgICAgIHVpbnQyNTYgdG9rZW5zQnVybmVkLAogICAgICAgIHVpbnQyNTYgZXRoZXJldW1FYXJuZWQKICAgICk7CiAgICAKICAgIGV2ZW50IG9uUmVpbnZlc3RtZW50KAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBjdXN0b21lckFkZHJlc3MsCiAgICAgICAgdWludDI1NiBldGhlcmV1bVJlaW52ZXN0ZWQsCiAgICAgICAgdWludDI1NiB0b2tlbnNNaW50ZWQKICAgICk7CiAgICAKICAgIGV2ZW50IG9uV2l0aGRyYXcoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIGN1c3RvbWVyQWRkcmVzcywKICAgICAgICB1aW50MjU2IGV0aGVyZXVtV2l0aGRyYXduCiAgICApOwogICAgCiAgICAvLyBFUkMyMAogICAgZXZlbnQgVHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIGZyb20sCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHRvLAogICAgICAgIHVpbnQyNTYgdG9rZW5zCiAgICApOwogICAgCiAgICAKICAgIC8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgPSAgICAgICAgICAgIENPTkZJR1VSQUJMRVMgICAgICAgICAgICA9CiAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJQT0hEIjsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gIlBPSEQiOwogICAgdWludDggY29uc3RhbnQgcHVibGljIGRlY2ltYWxzID0gMTg7CiAgICB1aW50OCBjb25zdGFudCBpbnRlcm5hbCBkaXZpZGVuZEZlZV8gPSAyOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCB0b2tlblByaWNlSW5pdGlhbF8gPSAwLjAwMDAwMDEgZXRoZXI7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIHRva2VuUHJpY2VJbmNyZW1lbnRhbF8gPSAwLjAwMDAwMDAxIGV0aGVyOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBtYWduaXR1ZGUgPSAyKio2NDsKICAgIAogICAgLy8gcHJvb2Ygb2Ygc3Rha2UgKGRlZmF1bHRzIGF0IDEwMCB0b2tlbnMpCiAgICB1aW50MjU2IHB1YmxpYyBzdGFraW5nUmVxdWlyZW1lbnQgPSA1ZTE4OwogICAgCiAgICAvLyBhbWJhc3NhZG9yIHByb2dyYW0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBpbnRlcm5hbCBhbWJhc3NhZG9yc187CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIGFtYmFzc2Fkb3JNYXhQdXJjaGFzZV8gPSAxMCBldGhlcjsKICAgIHVpbnQyNTYgY29uc3RhbnQgaW50ZXJuYWwgYW1iYXNzYWRvclF1b3RhXyA9IDEwIGV0aGVyOwogICAgCiAgICAKICAgIAogICAvKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICA9ICAgICAgICAgICAgREFUQVNFVFMgICAgICAgICAgICA9CiAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCiAgICAvLyBhbW91bnQgb2Ygc2hhcmVzIGZvciBlYWNoIGFkZHJlc3MgKHNjYWxlZCBudW1iZXIpCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgaW50ZXJuYWwgdG9rZW5CYWxhbmNlTGVkZ2VyXzsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBpbnRlcm5hbCByZWZlcnJhbEJhbGFuY2VfOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGludDI1NikgaW50ZXJuYWwgcGF5b3V0c1RvXzsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBpbnRlcm5hbCBhbWJhc3NhZG9yQWNjdW11bGF0ZWRRdW90YV87CiAgICB1aW50MjU2IGludGVybmFsIHRva2VuU3VwcGx5XyA9IDA7CiAgICB1aW50MjU2IGludGVybmFsIHByb2ZpdFBlclNoYXJlXzsKICAgIAogICAgLy8gYWRtaW5pc3RyYXRvciBsaXN0IChzZWUgYWJvdmUgb24gd2hhdCB0aGV5IGNhbiBkbykKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgYWRtaW5pc3RyYXRvcnM7CiAgICAKICAgIC8vIHdoZW4gdGhpcyBpcyBzZXQgdG8gdHJ1ZSwgb25seSBhbWJhc3NhZG9ycyBjYW4gcHVyY2hhc2UgdG9rZW5zICh0aGlzIHByZXZlbnRzIGEgd2hhbGUgcHJlbWluZSwgaXQgZW5zdXJlcyBhIGZhaXJseSBkaXN0cmlidXRlZCB1cHBlciBweXJhbWlkKQogICAgYm9vbCBwdWJsaWMgb25seUFtYmFzc2Fkb3JzID0gZmFsc2U7CiAgICAKCgogICAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgID0gICAgICAgICAgICBQVUJMSUMgRlVOQ1RJT05TICAgICAgICAgICAgPQogICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAgIC8qCiAgICAqIC0tIEFQUExJQ0FUSU9OIEVOVFJZIFBPSU5UUyAtLSAgCiAgICAqLwogICAgZnVuY3Rpb24gSG91cmdsYXNzKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBhZGQgYWRtaW5pc3RyYXRvcnMgaGVyZQogICAgICAgIGFkbWluaXN0cmF0b3JzWzB4MjM1OTEwZjQ2ODJjZmU3MjUwMDA0NDMwYTRmZmI1YWM3OGY1MjE3ZTFmNmE0YmY5OWM5MzdlZGY3NTdjMzMzMF0gPSB0cnVlOwogICAgICAgIAogICAgICAgIC8vIGFkZCB0aGUgYW1iYXNzYWRvcnMgaGVyZS4KICAgICAgICAvLyBPbmUgbG9uZWx5IGRldmVsb3BlciAKICAgICAgICBhbWJhc3NhZG9yc19bMHg2NDA1QzI5NmQ1NzI4ZGU0NjUxNzYwOUI3OERBMzcxMzA5NzE2M2RCXSA9IHRydWU7CiAgICAgICAgCiAgICAgICAgLy8gQmFja3VwIEV0aCBhZGRyZXNzCiAgICAgICAKICAgICAgICBhbWJhc3NhZG9yc19bMHgxNUZkYTY0ZkNkYmNBMjdhNjBBYThjNmNhODgyQWEzZTFERTRFYTQxXSA9IHRydWU7CiAgICAgICAgIAogICAgICAgIGFtYmFzc2Fkb3JzX1sweDQ0OEQ5QWU4OURGMTYwMzkyRGQwREQ1ZGRhNjY5NTI5OTkzOTBENTBdID0gdHJ1ZTsKICAgICAgICAKICAgIAogICAgICAgICAKICAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICAgCgogICAgfQogICAgCiAgICAgCiAgICAvKioKICAgICAqIENvbnZlcnRzIGFsbCBpbmNvbWluZyBldGhlcmV1bSB0byB0b2tlbnMgZm9yIHRoZSBjYWxsZXIsIGFuZCBwYXNzZXMgZG93biB0aGUgcmVmZXJyYWwgYWRkeSAoaWYgYW55KQogICAgICovCiAgICBmdW5jdGlvbiBidXkoYWRkcmVzcyBfcmVmZXJyZWRCeSkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgcmV0dXJucyh1aW50MjU2KQogICAgewogICAgICAgIHB1cmNoYXNlVG9rZW5zKG1zZy52YWx1ZSwgX3JlZmVycmVkQnkpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEZhbGxiYWNrIGZ1bmN0aW9uIHRvIGhhbmRsZSBldGhlcmV1bSB0aGF0IHdhcyBzZW5kIHN0cmFpZ2h0IHRvIHRoZSBjb250cmFjdAogICAgICogVW5mb3J0dW5hdGVseSB3ZSBjYW5ub3QgdXNlIGEgcmVmZXJyYWwgYWRkcmVzcyB0aGlzIHdheS4KICAgICAqLwogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBwdXJjaGFzZVRva2Vucyhtc2cudmFsdWUsIDB4MCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ29udmVydHMgYWxsIG9mIGNhbGxlcidzIGRpdmlkZW5kcyB0byB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlaW52ZXN0KCkKICAgICAgICBvbmx5U3Ryb25naGFuZHMoKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIGZldGNoIGRpdmlkZW5kcwogICAgICAgIHVpbnQyNTYgX2RpdmlkZW5kcyA9IG15RGl2aWRlbmRzKGZhbHNlKTsgLy8gcmV0cmlldmUgcmVmLiBib251cyBsYXRlciBpbiB0aGUgY29kZQogICAgICAgIAogICAgICAgIC8vIHBheSBvdXQgdGhlIGRpdmlkZW5kcyB2aXJ0dWFsbHkKICAgICAgICBhZGRyZXNzIF9jdXN0b21lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIHBheW91dHNUb19bX2N1c3RvbWVyQWRkcmVzc10gKz0gIChpbnQyNTYpIChfZGl2aWRlbmRzICogbWFnbml0dWRlKTsKICAgICAgICAKICAgICAgICAvLyByZXRyaWV2ZSByZWYuIGJvbnVzCiAgICAgICAgX2RpdmlkZW5kcyArPSByZWZlcnJhbEJhbGFuY2VfW19jdXN0b21lckFkZHJlc3NdOwogICAgICAgIHJlZmVycmFsQmFsYW5jZV9bX2N1c3RvbWVyQWRkcmVzc10gPSAwOwogICAgICAgIAogICAgICAgIC8vIGRpc3BhdGNoIGEgYnV5IG9yZGVyIHdpdGggdGhlIHZpcnR1YWxpemVkICJ3aXRoZHJhd24gZGl2aWRlbmRzIgogICAgICAgIHVpbnQyNTYgX3Rva2VucyA9IHB1cmNoYXNlVG9rZW5zKF9kaXZpZGVuZHMsIDB4MCk7CiAgICAgICAgCiAgICAgICAgLy8gZmlyZSBldmVudAogICAgICAgIG9uUmVpbnZlc3RtZW50KF9jdXN0b21lckFkZHJlc3MsIF9kaXZpZGVuZHMsIF90b2tlbnMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFsaWFzIG9mIHNlbGwoKSBhbmQgd2l0aGRyYXcoKS4KICAgICAqLwogICAgZnVuY3Rpb24gZXhpdCgpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgLy8gZ2V0IHRva2VuIGNvdW50IGZvciBjYWxsZXIgJiBzZWxsIHRoZW0gYWxsCiAgICAgICAgYWRkcmVzcyBfY3VzdG9tZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICB1aW50MjU2IF90b2tlbnMgPSB0b2tlbkJhbGFuY2VMZWRnZXJfW19jdXN0b21lckFkZHJlc3NdOwogICAgICAgIGlmKF90b2tlbnMgPiAwKSBzZWxsKF90b2tlbnMpOwogICAgICAgIAogICAgICAgIC8vIGxhbWJvIGRlbGl2ZXJ5IHNlcnZpY2UKICAgICAgICB3aXRoZHJhdygpOwogICAgfQoKICAgIC8qKgogICAgICogV2l0aGRyYXdzIGFsbCBvZiB0aGUgY2FsbGVycyBlYXJuaW5ncy4KICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXcoKQogICAgICAgIG9ubHlTdHJvbmdoYW5kcygpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgLy8gc2V0dXAgZGF0YQogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgdWludDI1NiBfZGl2aWRlbmRzID0gbXlEaXZpZGVuZHMoZmFsc2UpOyAvLyBnZXQgcmVmLiBib251cyBsYXRlciBpbiB0aGUgY29kZQogICAgICAgIAogICAgICAgIC8vIHVwZGF0ZSBkaXZpZGVuZCB0cmFja2VyCiAgICAgICAgcGF5b3V0c1RvX1tfY3VzdG9tZXJBZGRyZXNzXSArPSAgKGludDI1NikgKF9kaXZpZGVuZHMgKiBtYWduaXR1ZGUpOwogICAgICAgIAogICAgICAgIC8vIGFkZCByZWYuIGJvbnVzCiAgICAgICAgX2RpdmlkZW5kcyArPSByZWZlcnJhbEJhbGFuY2VfW19jdXN0b21lckFkZHJlc3NdOwogICAgICAgIHJlZmVycmFsQmFsYW5jZV9bX2N1c3RvbWVyQWRkcmVzc10gPSAwOwogICAgICAgIAogICAgICAgIC8vIGxhbWJvIGRlbGl2ZXJ5IHNlcnZpY2UKICAgICAgICBfY3VzdG9tZXJBZGRyZXNzLnRyYW5zZmVyKF9kaXZpZGVuZHMpOwogICAgICAgIAogICAgICAgIC8vIGZpcmUgZXZlbnQKICAgICAgICBvbldpdGhkcmF3KF9jdXN0b21lckFkZHJlc3MsIF9kaXZpZGVuZHMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIExpcXVpZmllcyB0b2tlbnMgdG8gZXRoZXJldW0uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbGwodWludDI1NiBfYW1vdW50T2ZUb2tlbnMpCiAgICAgICAgb25seUJhZ2hvbGRlcnMoKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vIHNldHVwIGRhdGEKICAgICAgICBhZGRyZXNzIF9jdXN0b21lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIC8vIHJ1c3NpYW4gaGFja2VycyBCVEZPCiAgICAgICAgcmVxdWlyZShfYW1vdW50T2ZUb2tlbnMgPD0gdG9rZW5CYWxhbmNlTGVkZ2VyX1tfY3VzdG9tZXJBZGRyZXNzXSk7CiAgICAgICAgdWludDI1NiBfdG9rZW5zID0gX2Ftb3VudE9mVG9rZW5zOwogICAgICAgIHVpbnQyNTYgX2V0aGVyZXVtID0gdG9rZW5zVG9FdGhlcmV1bV8oX3Rva2Vucyk7CiAgICAgICAgdWludDI1NiBfZGl2aWRlbmRzID0gU2FmZU1hdGguZGl2KF9ldGhlcmV1bSwgZGl2aWRlbmRGZWVfKTsKICAgICAgICB1aW50MjU2IF90YXhlZEV0aGVyZXVtID0gU2FmZU1hdGguc3ViKF9ldGhlcmV1bSwgX2RpdmlkZW5kcyk7CiAgICAgICAgCiAgICAgICAgLy8gYnVybiB0aGUgc29sZCB0b2tlbnMKICAgICAgICB0b2tlblN1cHBseV8gPSBTYWZlTWF0aC5zdWIodG9rZW5TdXBwbHlfLCBfdG9rZW5zKTsKICAgICAgICB0b2tlbkJhbGFuY2VMZWRnZXJfW19jdXN0b21lckFkZHJlc3NdID0gU2FmZU1hdGguc3ViKHRva2VuQmFsYW5jZUxlZGdlcl9bX2N1c3RvbWVyQWRkcmVzc10sIF90b2tlbnMpOwogICAgICAgIAogICAgICAgIC8vIHVwZGF0ZSBkaXZpZGVuZHMgdHJhY2tlcgogICAgICAgIGludDI1NiBfdXBkYXRlZFBheW91dHMgPSAoaW50MjU2KSAocHJvZml0UGVyU2hhcmVfICogX3Rva2VucyArIChfdGF4ZWRFdGhlcmV1bSAqIG1hZ25pdHVkZSkpOwogICAgICAgIHBheW91dHNUb19bX2N1c3RvbWVyQWRkcmVzc10gLT0gX3VwZGF0ZWRQYXlvdXRzOyAgICAgICAKICAgICAgICAKICAgICAgICAvLyBkaXZpZGluZyBieSB6ZXJvIGlzIGEgYmFkIGlkZWEKICAgICAgICBpZiAodG9rZW5TdXBwbHlfID4gMCkgewogICAgICAgICAgICAvLyB1cGRhdGUgdGhlIGFtb3VudCBvZiBkaXZpZGVuZHMgcGVyIHRva2VuCiAgICAgICAgICAgIHByb2ZpdFBlclNoYXJlXyA9IFNhZmVNYXRoLmFkZChwcm9maXRQZXJTaGFyZV8sIChfZGl2aWRlbmRzICogbWFnbml0dWRlKSAvIHRva2VuU3VwcGx5Xyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGZpcmUgZXZlbnQKICAgICAgICBvblRva2VuU2VsbChfY3VzdG9tZXJBZGRyZXNzLCBfdG9rZW5zLCBfdGF4ZWRFdGhlcmV1bSk7CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBUcmFuc2ZlciB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIHRvIGEgbmV3IGhvbGRlci4KICAgICAqIFJlbWVtYmVyLCB0aGVyZSdzIGEgMTAlIGZlZSBoZXJlIGFzIHdlbGwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvQWRkcmVzcywgdWludDI1NiBfYW1vdW50T2ZUb2tlbnMpCiAgICAgICAgb25seUJhZ2hvbGRlcnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICAvLyBzZXR1cAogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgdGhlIHJlcXVlc3RlZCB0b2tlbnMKICAgICAgICAvLyBhbHNvIGRpc2FibGVzIHRyYW5zZmVycyB1bnRpbCBhbWJhc3NhZG9yIHBoYXNlIGlzIG92ZXIKICAgICAgICAvLyAoIHdlIGRvbnQgd2FudCB3aGFsZSBwcmVtaW5lcyApCiAgICAgICAgcmVxdWlyZSghb25seUFtYmFzc2Fkb3JzICYmIF9hbW91bnRPZlRva2VucyA8PSB0b2tlbkJhbGFuY2VMZWRnZXJfW19jdXN0b21lckFkZHJlc3NdKTsKICAgICAgICAKICAgICAgICAvLyB3aXRoZHJhdyBhbGwgb3V0c3RhbmRpbmcgZGl2aWRlbmRzIGZpcnN0CiAgICAgICAgaWYobXlEaXZpZGVuZHModHJ1ZSkgPiAwKSB3aXRoZHJhdygpOwogICAgICAgIAogICAgICAgIC8vIGxpcXVpZnkgMTAlIG9mIHRoZSB0b2tlbnMgdGhhdCBhcmUgdHJhbnNmZXJlZAogICAgICAgIC8vIHRoZXNlIGFyZSBkaXNwZXJzZWQgdG8gc2hhcmVob2xkZXJzCiAgICAgICAgdWludDI1NiBfdG9rZW5GZWUgPSBTYWZlTWF0aC5kaXYoX2Ftb3VudE9mVG9rZW5zLCBkaXZpZGVuZEZlZV8pOwogICAgICAgIHVpbnQyNTYgX3RheGVkVG9rZW5zID0gU2FmZU1hdGguc3ViKF9hbW91bnRPZlRva2VucywgX3Rva2VuRmVlKTsKICAgICAgICB1aW50MjU2IF9kaXZpZGVuZHMgPSB0b2tlbnNUb0V0aGVyZXVtXyhfdG9rZW5GZWUpOwogIAogICAgICAgIC8vIGJ1cm4gdGhlIGZlZSB0b2tlbnMKICAgICAgICB0b2tlblN1cHBseV8gPSBTYWZlTWF0aC5zdWIodG9rZW5TdXBwbHlfLCBfdG9rZW5GZWUpOwoKICAgICAgICAvLyBleGNoYW5nZSB0b2tlbnMKICAgICAgICB0b2tlbkJhbGFuY2VMZWRnZXJfW19jdXN0b21lckFkZHJlc3NdID0gU2FmZU1hdGguc3ViKHRva2VuQmFsYW5jZUxlZGdlcl9bX2N1c3RvbWVyQWRkcmVzc10sIF9hbW91bnRPZlRva2Vucyk7CiAgICAgICAgdG9rZW5CYWxhbmNlTGVkZ2VyX1tfdG9BZGRyZXNzXSA9IFNhZmVNYXRoLmFkZCh0b2tlbkJhbGFuY2VMZWRnZXJfW190b0FkZHJlc3NdLCBfdGF4ZWRUb2tlbnMpOwogICAgICAgIAogICAgICAgIC8vIHVwZGF0ZSBkaXZpZGVuZCB0cmFja2VycwogICAgICAgIHBheW91dHNUb19bX2N1c3RvbWVyQWRkcmVzc10gLT0gKGludDI1NikgKHByb2ZpdFBlclNoYXJlXyAqIF9hbW91bnRPZlRva2Vucyk7CiAgICAgICAgcGF5b3V0c1RvX1tfdG9BZGRyZXNzXSArPSAoaW50MjU2KSAocHJvZml0UGVyU2hhcmVfICogX3RheGVkVG9rZW5zKTsKICAgICAgICAKICAgICAgICAvLyBkaXNwZXJzZSBkaXZpZGVuZHMgYW1vbmcgaG9sZGVycwogICAgICAgIHByb2ZpdFBlclNoYXJlXyA9IFNhZmVNYXRoLmFkZChwcm9maXRQZXJTaGFyZV8sIChfZGl2aWRlbmRzICogbWFnbml0dWRlKSAvIHRva2VuU3VwcGx5Xyk7CiAgICAgICAgCiAgICAgICAgLy8gZmlyZSBldmVudAogICAgICAgIFRyYW5zZmVyKF9jdXN0b21lckFkZHJlc3MsIF90b0FkZHJlc3MsIF90YXhlZFRva2Vucyk7CiAgICAgICAgCiAgICAgICAgLy8gRVJDMjAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgIAogICAgfQogICAgCiAgICAvKi0tLS0tLS0tLS0gIEFETUlOSVNUUkFUT1IgT05MWSBGVU5DVElPTlMgIC0tLS0tLS0tLS0qLwogICAgLyoqCiAgICAgKiBJbiBjYXNlIHRoZSBhbWFzc2Fkb3IgcXVvdGEgaXMgbm90IG1ldCwgdGhlIGFkbWluaXN0cmF0b3IgY2FuIG1hbnVhbGx5IGRpc2FibGUgdGhlIGFtYmFzc2Fkb3IgcGhhc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVJbml0aWFsU3RhZ2UoKQogICAgICAgIG9ubHlBZG1pbmlzdHJhdG9yKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBvbmx5QW1iYXNzYWRvcnMgPSBmYWxzZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBJbiBjYXNlIG9uZSBvZiB1cyBkaWVzLCB3ZSBuZWVkIHRvIHJlcGxhY2Ugb3Vyc2VsdmVzLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRBZG1pbmlzdHJhdG9yKGJ5dGVzMzIgX2lkZW50aWZpZXIsIGJvb2wgX3N0YXR1cykKICAgICAgICBvbmx5QWRtaW5pc3RyYXRvcigpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgYWRtaW5pc3RyYXRvcnNbX2lkZW50aWZpZXJdID0gX3N0YXR1czsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBQcmVjYXV0aW9uYXJ5IG1lYXN1cmVzIGluIGNhc2Ugd2UgbmVlZCB0byBhZGp1c3QgdGhlIG1hc3Rlcm5vZGUgcmF0ZS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0U3Rha2luZ1JlcXVpcmVtZW50KHVpbnQyNTYgX2Ftb3VudE9mVG9rZW5zKQogICAgICAgIG9ubHlBZG1pbmlzdHJhdG9yKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBzdGFraW5nUmVxdWlyZW1lbnQgPSBfYW1vdW50T2ZUb2tlbnM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSWYgd2Ugd2FudCB0byByZWJyYW5kLCB3ZSBjYW4uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldE5hbWUoc3RyaW5nIF9uYW1lKQogICAgICAgIG9ubHlBZG1pbmlzdHJhdG9yKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBuYW1lID0gX25hbWU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogSWYgd2Ugd2FudCB0byByZWJyYW5kLCB3ZSBjYW4uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFN5bWJvbChzdHJpbmcgX3N5bWJvbCkKICAgICAgICBvbmx5QWRtaW5pc3RyYXRvcigpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgIH0KCiAgICAKICAgIC8qLS0tLS0tLS0tLSAgSEVMUEVSUyBBTkQgQ0FMQ1VMQVRPUlMgIC0tLS0tLS0tLS0qLwogICAgLyoqCiAgICAgKiBNZXRob2QgdG8gdmlldyB0aGUgY3VycmVudCBFdGhlcmV1bSBzdG9yZWQgaW4gdGhlIGNvbnRyYWN0CiAgICAgKiBFeGFtcGxlOiB0b3RhbEV0aGVyZXVtQmFsYW5jZSgpCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsRXRoZXJldW1CYWxhbmNlKCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0cmlldmUgdGhlIHRvdGFsIHRva2VuIHN1cHBseS4KICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIHRva2VuU3VwcGx5XzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXRyaWV2ZSB0aGUgdG9rZW5zIG93bmVkIGJ5IHRoZSBjYWxsZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG15VG9rZW5zKCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyh1aW50MjU2KQogICAgewogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZihfY3VzdG9tZXJBZGRyZXNzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXRyaWV2ZSB0aGUgZGl2aWRlbmRzIG93bmVkIGJ5IHRoZSBjYWxsZXIuCiAgICAgKiBJZiBgX2luY2x1ZGVSZWZlcnJhbEJvbnVzYCBpcyB0byB0byAxL3RydWUsIHRoZSByZWZlcnJhbCBib251cyB3aWxsIGJlIGluY2x1ZGVkIGluIHRoZSBjYWxjdWxhdGlvbnMuCiAgICAgKiBUaGUgcmVhc29uIGZvciB0aGlzLCBpcyB0aGF0IGluIHRoZSBmcm9udGVuZCwgd2Ugd2lsbCB3YW50IHRvIGdldCB0aGUgdG90YWwgZGl2cyAoZ2xvYmFsICsgcmVmKQogICAgICogQnV0IGluIHRoZSBpbnRlcm5hbCBjYWxjdWxhdGlvbnMsIHdlIHdhbnQgdGhlbSBzZXBhcmF0ZS4gCiAgICAgKi8gCiAgICBmdW5jdGlvbiBteURpdmlkZW5kcyhib29sIF9pbmNsdWRlUmVmZXJyYWxCb251cykgCiAgICAgICAgcHVibGljIAogICAgICAgIHZpZXcgCiAgICAgICAgcmV0dXJucyh1aW50MjU2KQogICAgewogICAgICAgIGFkZHJlc3MgX2N1c3RvbWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgcmV0dXJuIF9pbmNsdWRlUmVmZXJyYWxCb251cyA/IGRpdmlkZW5kc09mKF9jdXN0b21lckFkZHJlc3MpICsgcmVmZXJyYWxCYWxhbmNlX1tfY3VzdG9tZXJBZGRyZXNzXSA6IGRpdmlkZW5kc09mKF9jdXN0b21lckFkZHJlc3MpIDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXRyaWV2ZSB0aGUgdG9rZW4gYmFsYW5jZSBvZiBhbnkgc2luZ2xlIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9jdXN0b21lckFkZHJlc3MpCiAgICAgICAgdmlldwogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnModWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gdG9rZW5CYWxhbmNlTGVkZ2VyX1tfY3VzdG9tZXJBZGRyZXNzXTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXRyaWV2ZSB0aGUgZGl2aWRlbmQgYmFsYW5jZSBvZiBhbnkgc2luZ2xlIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpdmlkZW5kc09mKGFkZHJlc3MgX2N1c3RvbWVyQWRkcmVzcykKICAgICAgICB2aWV3CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiAodWludDI1NikgKChpbnQyNTYpKHByb2ZpdFBlclNoYXJlXyAqIHRva2VuQmFsYW5jZUxlZGdlcl9bX2N1c3RvbWVyQWRkcmVzc10pIC0gcGF5b3V0c1RvX1tfY3VzdG9tZXJBZGRyZXNzXSkgLyBtYWduaXR1ZGU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBidXkgcHJpY2Ugb2YgMSBpbmRpdmlkdWFsIHRva2VuLgogICAgICovCiAgICBmdW5jdGlvbiBzZWxsUHJpY2UoKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgdmlldyAKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gb3VyIGNhbGN1bGF0aW9uIHJlbGllcyBvbiB0aGUgdG9rZW4gc3VwcGx5LCBzbyB3ZSBuZWVkIHN1cHBseS4gRG9oLgogICAgICAgIGlmKHRva2VuU3VwcGx5XyA9PSAwKXsKICAgICAgICAgICAgcmV0dXJuIHRva2VuUHJpY2VJbml0aWFsXyAtIHRva2VuUHJpY2VJbmNyZW1lbnRhbF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NiBfZXRoZXJldW0gPSB0b2tlbnNUb0V0aGVyZXVtXygxZTE4KTsKICAgICAgICAgICAgdWludDI1NiBfZGl2aWRlbmRzID0gU2FmZU1hdGguZGl2KF9ldGhlcmV1bSwgZGl2aWRlbmRGZWVfICApOwogICAgICAgICAgICB1aW50MjU2IF90YXhlZEV0aGVyZXVtID0gU2FmZU1hdGguc3ViKF9ldGhlcmV1bSwgX2RpdmlkZW5kcyk7CiAgICAgICAgICAgIHJldHVybiBfdGF4ZWRFdGhlcmV1bTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZWxsIHByaWNlIG9mIDEgaW5kaXZpZHVhbCB0b2tlbi4KICAgICAqLwogICAgZnVuY3Rpb24gYnV5UHJpY2UoKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgdmlldyAKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gb3VyIGNhbGN1bGF0aW9uIHJlbGllcyBvbiB0aGUgdG9rZW4gc3VwcGx5LCBzbyB3ZSBuZWVkIHN1cHBseS4gRG9oLgogICAgICAgIGlmKHRva2VuU3VwcGx5XyA9PSAwKXsKICAgICAgICAgICAgcmV0dXJuIHRva2VuUHJpY2VJbml0aWFsXyArIHRva2VuUHJpY2VJbmNyZW1lbnRhbF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NiBfZXRoZXJldW0gPSB0b2tlbnNUb0V0aGVyZXVtXygxZTE4KTsKICAgICAgICAgICAgdWludDI1NiBfZGl2aWRlbmRzID0gU2FmZU1hdGguZGl2KF9ldGhlcmV1bSwgZGl2aWRlbmRGZWVfICApOwogICAgICAgICAgICB1aW50MjU2IF90YXhlZEV0aGVyZXVtID0gU2FmZU1hdGguYWRkKF9ldGhlcmV1bSwgX2RpdmlkZW5kcyk7CiAgICAgICAgICAgIHJldHVybiBfdGF4ZWRFdGhlcmV1bTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRnVuY3Rpb24gZm9yIHRoZSBmcm9udGVuZCB0byBkeW5hbWljYWxseSByZXRyaWV2ZSB0aGUgcHJpY2Ugc2NhbGluZyBvZiBidXkgb3JkZXJzLgogICAgICovCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbnNSZWNlaXZlZCh1aW50MjU2IF9ldGhlcmV1bVRvU3BlbmQpIAogICAgICAgIHB1YmxpYyAKICAgICAgICB2aWV3IAogICAgICAgIHJldHVybnModWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IF9kaXZpZGVuZHMgPSBTYWZlTWF0aC5kaXYoX2V0aGVyZXVtVG9TcGVuZCwgZGl2aWRlbmRGZWVfKTsKICAgICAgICB1aW50MjU2IF90YXhlZEV0aGVyZXVtID0gU2FmZU1hdGguc3ViKF9ldGhlcmV1bVRvU3BlbmQsIF9kaXZpZGVuZHMpOwogICAgICAgIHVpbnQyNTYgX2Ftb3VudE9mVG9rZW5zID0gZXRoZXJldW1Ub1Rva2Vuc18oX3RheGVkRXRoZXJldW0pOwogICAgICAgIAogICAgICAgIHJldHVybiBfYW1vdW50T2ZUb2tlbnM7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRnVuY3Rpb24gZm9yIHRoZSBmcm9udGVuZCB0byBkeW5hbWljYWxseSByZXRyaWV2ZSB0aGUgcHJpY2Ugc2NhbGluZyBvZiBzZWxsIG9yZGVycy4KICAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlRXRoZXJldW1SZWNlaXZlZCh1aW50MjU2IF90b2tlbnNUb1NlbGwpIAogICAgICAgIHB1YmxpYyAKICAgICAgICB2aWV3IAogICAgICAgIHJldHVybnModWludDI1NikKICAgIHsKICAgICAgICByZXF1aXJlKF90b2tlbnNUb1NlbGwgPD0gdG9rZW5TdXBwbHlfKTsKICAgICAgICB1aW50MjU2IF9ldGhlcmV1bSA9IHRva2Vuc1RvRXRoZXJldW1fKF90b2tlbnNUb1NlbGwpOwogICAgICAgIHVpbnQyNTYgX2RpdmlkZW5kcyA9IFNhZmVNYXRoLmRpdihfZXRoZXJldW0sIGRpdmlkZW5kRmVlXyk7CiAgICAgICAgdWludDI1NiBfdGF4ZWRFdGhlcmV1bSA9IFNhZmVNYXRoLnN1YihfZXRoZXJldW0sIF9kaXZpZGVuZHMpOwogICAgICAgIHJldHVybiBfdGF4ZWRFdGhlcmV1bTsKICAgIH0KICAgIAogICAgCiAgICAvKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgPSAgICAgICAgICAgIElOVEVSTkFMIEZVTkNUSU9OUyAgICAgICAgICAgID0KICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCiAgICBmdW5jdGlvbiBwdXJjaGFzZVRva2Vucyh1aW50MjU2IF9pbmNvbWluZ0V0aGVyZXVtLCBhZGRyZXNzIF9yZWZlcnJlZEJ5KQogICAgICAgIGFudGlFYXJseVdoYWxlKF9pbmNvbWluZ0V0aGVyZXVtKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyh1aW50MjU2KQogICAgewogICAgICAgIC8vIGRhdGEgc2V0dXAKICAgICAgICBhZGRyZXNzIF9jdXN0b21lckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQyNTYgX3VuZGl2aWRlZERpdmlkZW5kcyA9IFNhZmVNYXRoLmRpdihfaW5jb21pbmdFdGhlcmV1bSwgZGl2aWRlbmRGZWVfKTsKICAgICAgICB1aW50MjU2IF9yZWZlcnJhbEJvbnVzID0gU2FmZU1hdGguZGl2KF91bmRpdmlkZWREaXZpZGVuZHMsIDMpOwogICAgICAgIHVpbnQyNTYgX2RpdmlkZW5kcyA9IFNhZmVNYXRoLnN1YihfdW5kaXZpZGVkRGl2aWRlbmRzLCBfcmVmZXJyYWxCb251cyk7CiAgICAgICAgdWludDI1NiBfdGF4ZWRFdGhlcmV1bSA9IFNhZmVNYXRoLnN1YihfaW5jb21pbmdFdGhlcmV1bSwgX3VuZGl2aWRlZERpdmlkZW5kcyk7CiAgICAgICAgdWludDI1NiBfYW1vdW50T2ZUb2tlbnMgPSBldGhlcmV1bVRvVG9rZW5zXyhfdGF4ZWRFdGhlcmV1bSk7CiAgICAgICAgdWludDI1NiBfZmVlID0gX2RpdmlkZW5kcyAqIG1hZ25pdHVkZTsKIAogICAgICAgIC8vIG5vIHBvaW50IGluIGNvbnRpbnVpbmcgZXhlY3V0aW9uIGlmIE9QIGlzIGEgcG9vcmZhZyBydXNzaWFuIGhhY2tlcgogICAgICAgIC8vIHByZXZlbnRzIG92ZXJmbG93IGluIHRoZSBjYXNlIHRoYXQgdGhlIHB5cmFtaWQgc29tZWhvdyBtYWdpY2FsbHkgc3RhcnRzIGJlaW5nIHVzZWQgYnkgZXZlcnlvbmUgaW4gdGhlIHdvcmxkCiAgICAgICAgLy8gKG9yIGhhY2tlcnMpCiAgICAgICAgLy8gYW5kIHllcyB3ZSBrbm93IHRoYXQgdGhlIHNhZmVtYXRoIGZ1bmN0aW9uIGF1dG9tYXRpY2FsbHkgcnVsZXMgb3V0IHRoZSAiZ3JlYXRlciB0aGVuIiBlcXVhc2lvbi4KICAgICAgICByZXF1aXJlKF9hbW91bnRPZlRva2VucyA+IDAgJiYgKFNhZmVNYXRoLmFkZChfYW1vdW50T2ZUb2tlbnMsdG9rZW5TdXBwbHlfKSA+IHRva2VuU3VwcGx5XykpOwogICAgICAgIAogICAgICAgIC8vIGlzIHRoZSB1c2VyIHJlZmVycmVkIGJ5IGEgbWFzdGVybm9kZT8KICAgICAgICBpZigKICAgICAgICAgICAgLy8gaXMgdGhpcyBhIHJlZmVycmVkIHB1cmNoYXNlPwogICAgICAgICAgICBfcmVmZXJyZWRCeSAhPSAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgJiYKCiAgICAgICAgICAgIC8vIG5vIGNoZWF0aW5nIQogICAgICAgICAgICBfcmVmZXJyZWRCeSAhPSBfY3VzdG9tZXJBZGRyZXNzICYmCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBkb2VzIHRoZSByZWZlcnJlciBoYXZlIGF0IGxlYXN0IFggd2hvbGUgdG9rZW5zPwogICAgICAgICAgICAvLyBpLmUgaXMgdGhlIHJlZmVycmVyIGEgZ29kbHkgY2hhZCBtYXN0ZXJub2RlCiAgICAgICAgICAgIHRva2VuQmFsYW5jZUxlZGdlcl9bX3JlZmVycmVkQnldID49IHN0YWtpbmdSZXF1aXJlbWVudAogICAgICAgICl7CiAgICAgICAgICAgIC8vIHdlYWx0aCByZWRpc3RyaWJ1dGlvbgogICAgICAgICAgICByZWZlcnJhbEJhbGFuY2VfW19yZWZlcnJlZEJ5XSA9IFNhZmVNYXRoLmFkZChyZWZlcnJhbEJhbGFuY2VfW19yZWZlcnJlZEJ5XSwgX3JlZmVycmFsQm9udXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG5vIHJlZiBwdXJjaGFzZQogICAgICAgICAgICAvLyBhZGQgdGhlIHJlZmVycmFsIGJvbnVzIGJhY2sgdG8gdGhlIGdsb2JhbCBkaXZpZGVuZHMgY2FrZQogICAgICAgICAgICBfZGl2aWRlbmRzID0gU2FmZU1hdGguYWRkKF9kaXZpZGVuZHMsIF9yZWZlcnJhbEJvbnVzKTsKICAgICAgICAgICAgX2ZlZSA9IF9kaXZpZGVuZHMgKiBtYWduaXR1ZGU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHdlIGNhbid0IGdpdmUgcGVvcGxlIGluZmluaXRlIGV0aGVyZXVtCiAgICAgICAgaWYodG9rZW5TdXBwbHlfID4gMCl7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBhZGQgdG9rZW5zIHRvIHRoZSBwb29sCiAgICAgICAgICAgIHRva2VuU3VwcGx5XyA9IFNhZmVNYXRoLmFkZCh0b2tlblN1cHBseV8sIF9hbW91bnRPZlRva2Vucyk7CiAKICAgICAgICAgICAgLy8gdGFrZSB0aGUgYW1vdW50IG9mIGRpdmlkZW5kcyBnYWluZWQgdGhyb3VnaCB0aGlzIHRyYW5zYWN0aW9uLCBhbmQgYWxsb2NhdGVzIHRoZW0gZXZlbmx5IHRvIGVhY2ggc2hhcmVob2xkZXIKICAgICAgICAgICAgcHJvZml0UGVyU2hhcmVfICs9IChfZGl2aWRlbmRzICogbWFnbml0dWRlIC8gKHRva2VuU3VwcGx5XykpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoZSBjdXN0b21lciByZWNlaXZlcyBvdmVyIGhpcyBwdXJjaGFzZSAKICAgICAgICAgICAgX2ZlZSA9IF9mZWUgLSAoX2ZlZS0oX2Ftb3VudE9mVG9rZW5zICogKF9kaXZpZGVuZHMgKiBtYWduaXR1ZGUgLyAodG9rZW5TdXBwbHlfKSkpKTsKICAgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBhZGQgdG9rZW5zIHRvIHRoZSBwb29sCiAgICAgICAgICAgIHRva2VuU3VwcGx5XyA9IF9hbW91bnRPZlRva2VuczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gdXBkYXRlIGNpcmN1bGF0aW5nIHN1cHBseSAmIHRoZSBsZWRnZXIgYWRkcmVzcyBmb3IgdGhlIGN1c3RvbWVyCiAgICAgICAgdG9rZW5CYWxhbmNlTGVkZ2VyX1tfY3VzdG9tZXJBZGRyZXNzXSA9IFNhZmVNYXRoLmFkZCh0b2tlbkJhbGFuY2VMZWRnZXJfW19jdXN0b21lckFkZHJlc3NdLCBfYW1vdW50T2ZUb2tlbnMpOwogICAgICAgIAogICAgICAgIC8vIFRlbGxzIHRoZSBjb250cmFjdCB0aGF0IHRoZSBidXllciBkb2Vzbid0IGRlc2VydmUgZGl2aWRlbmRzIGZvciB0aGUgdG9rZW5zIGJlZm9yZSB0aGV5IG93bmVkIHRoZW07CiAgICAgICAgLy9yZWFsbHkgaSBrbm93IHlvdSB0aGluayB5b3UgZG8gYnV0IHlvdSBkb24ndAogICAgICAgIGludDI1NiBfdXBkYXRlZFBheW91dHMgPSAoaW50MjU2KSAoKHByb2ZpdFBlclNoYXJlXyAqIF9hbW91bnRPZlRva2VucykgLSBfZmVlKTsKICAgICAgICBwYXlvdXRzVG9fW19jdXN0b21lckFkZHJlc3NdICs9IF91cGRhdGVkUGF5b3V0czsKICAgICAgICAKICAgICAgICAvLyBmaXJlIGV2ZW50CiAgICAgICAgb25Ub2tlblB1cmNoYXNlKF9jdXN0b21lckFkZHJlc3MsIF9pbmNvbWluZ0V0aGVyZXVtLCBfYW1vdW50T2ZUb2tlbnMsIF9yZWZlcnJlZEJ5KTsKICAgICAgICAKICAgICAgICByZXR1cm4gX2Ftb3VudE9mVG9rZW5zOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIFRva2VuIHByaWNlIGJhc2VkIG9uIGFuIGFtb3VudCBvZiBpbmNvbWluZyBldGhlcmV1bQogICAgICogSXQncyBhbiBhbGdvcml0aG0sIGhvcGVmdWxseSB3ZSBnYXZlIHlvdSB0aGUgd2hpdGVwYXBlciB3aXRoIGl0IGluIHNjaWVudGlmaWMgbm90YXRpb247CiAgICAgKiBTb21lIGNvbnZlcnNpb25zIG9jY3VycmVkIHRvIHByZXZlbnQgZGVjaW1hbCBlcnJvcnMgb3IgdW5kZXJmbG93cyAvIG92ZXJmbG93cyBpbiBzb2xpZGl0eSBjb2RlLgogICAgICovCiAgICBmdW5jdGlvbiBldGhlcmV1bVRvVG9rZW5zXyh1aW50MjU2IF9ldGhlcmV1bSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgdWludDI1NiBfdG9rZW5QcmljZUluaXRpYWwgPSB0b2tlblByaWNlSW5pdGlhbF8gKiAxZTE4OwogICAgICAgIHVpbnQyNTYgX3Rva2Vuc1JlY2VpdmVkID0gCiAgICAgICAgICgKICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgLy8gdW5kZXJmbG93IGF0dGVtcHRzIEJURk8KICAgICAgICAgICAgICAgIFNhZmVNYXRoLnN1YigKICAgICAgICAgICAgICAgICAgICAoc3FydAogICAgICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3Rva2VuUHJpY2VJbml0aWFsKioyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKDIqKHRva2VuUHJpY2VJbmNyZW1lbnRhbF8gKiAxZTE4KSooX2V0aGVyZXVtICogMWUxOCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKCh0b2tlblByaWNlSW5jcmVtZW50YWxfKSoqMikqKHRva2VuU3VwcGx5XyoqMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMioodG9rZW5QcmljZUluY3JlbWVudGFsXykqX3Rva2VuUHJpY2VJbml0aWFsKnRva2VuU3VwcGx5XykKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICksIF90b2tlblByaWNlSW5pdGlhbAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApLyh0b2tlblByaWNlSW5jcmVtZW50YWxfKQogICAgICAgICktKHRva2VuU3VwcGx5XykKICAgICAgICA7CiAgCiAgICAgICAgcmV0dXJuIF90b2tlbnNSZWNlaXZlZDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdG9rZW4gc2VsbCB2YWx1ZS4KICAgICAqIEl0J3MgYW4gYWxnb3JpdGhtLCBob3BlZnVsbHkgd2UgZ2F2ZSB5b3UgdGhlIHdoaXRlcGFwZXIgd2l0aCBpdCBpbiBzY2llbnRpZmljIG5vdGF0aW9uOwogICAgICogU29tZSBjb252ZXJzaW9ucyBvY2N1cnJlZCB0byBwcmV2ZW50IGRlY2ltYWwgZXJyb3JzIG9yIHVuZGVyZmxvd3MgLyBvdmVyZmxvd3MgaW4gc29saWRpdHkgY29kZS4KICAgICAqLwogICAgIGZ1bmN0aW9uIHRva2Vuc1RvRXRoZXJldW1fKHVpbnQyNTYgX3Rva2VucykKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CgogICAgICAgIHVpbnQyNTYgdG9rZW5zXyA9IChfdG9rZW5zICsgMWUxOCk7CiAgICAgICAgdWludDI1NiBfdG9rZW5TdXBwbHkgPSAodG9rZW5TdXBwbHlfICsgMWUxOCk7CiAgICAgICAgdWludDI1NiBfZXRoZXJSZWNlaXZlZCA9CiAgICAgICAgKAogICAgICAgICAgICAvLyB1bmRlcmZsb3cgYXR0ZW1wdHMgQlRGTwogICAgICAgICAgICBTYWZlTWF0aC5zdWIoCiAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblByaWNlSW5pdGlhbF8gKyh0b2tlblByaWNlSW5jcmVtZW50YWxfICogKF90b2tlblN1cHBseS8xZTE4KSkKICAgICAgICAgICAgICAgICAgICAgICAgKS10b2tlblByaWNlSW5jcmVtZW50YWxfCiAgICAgICAgICAgICAgICAgICAgKSoodG9rZW5zXyAtIDFlMTgpCiAgICAgICAgICAgICAgICApLCh0b2tlblByaWNlSW5jcmVtZW50YWxfKigodG9rZW5zXyoqMi10b2tlbnNfKS8xZTE4KSkvMgogICAgICAgICAgICApCiAgICAgICAgLzFlMTgpOwogICAgICAgIHJldHVybiBfZXRoZXJSZWNlaXZlZDsKICAgIH0KICAgIAogICAgCiAgICAvL1RoaXMgaXMgd2hlcmUgYWxsIHlvdXIgZ2FzIGdvZXMsIHNvcnJ5CiAgICAvL05vdCBzb3JyeSwgeW91IHByb2JhYmx5IG9ubHkgcGFpZCAxIGd3ZWkKICAgIGZ1bmN0aW9uIHNxcnQodWludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeSkgewogICAgICAgIHVpbnQgeiA9ICh4ICsgMSkgLyAyOwogICAgICAgIHkgPSB4OwogICAgICAgIHdoaWxlICh6IDwgeSkgewogICAgICAgICAgICB5ID0gejsKICAgICAgICAgICAgeiA9ICh4IC8geiArIHopIC8gMjsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAgICovCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICAgKi8KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9'.
	

]
