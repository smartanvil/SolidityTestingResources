Class {
	#name : #SRT5ace17f87c7391e5792a7683069a8025b83bbd85,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5ace17f87c7391e5792a7683069a8025b83bbd85 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGFkZHJlc3MgcHVibGljIG93bmVyOyAvL293bmVyCiAgYWRkcmVzcyBwdWJsaWMgYW5pbWF0b3I7IC8vYW5pbWF0b3IKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGZ1bmN0aW9uIGNvbW1pdERpdmlkZW5kKGFkZHJlc3Mgd2hvKSBpbnRlcm5hbDsgLy8gcGF5cyByZW1haW5pbmcgZGl2aWRlbmQKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPj0gc2l6ZSArIDQpOwogICAgIF87CiAgfQogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgewogICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgaWYoX3RvID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICBjb21taXREaXZpZGVuZChvd25lcik7CiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gYmFsYW5jZXNbb3duZXJdLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIG93bmVyLCBfdmFsdWUpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgY29tbWl0RGl2aWRlbmQoX3RvKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICB9CiAgfQogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEJhc2ljVG9rZW4sIEVSQzIwIHsKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIGNvbW1pdERpdmlkZW5kKF9mcm9tKTsKICAgIGNvbW1pdERpdmlkZW5kKF90byk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVhaGxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgewogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICBhc3NlcnQoISgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkpOwogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICB9CiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQp9CgovKioKICogQHRpdGxlIFNtYXJ0QmlsbGlvbnMgY29udHJhY3QKICovCmNvbnRyYWN0IFNtYXJ0QmlsbGlvbnMgaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLy8gbWV0YWRhdGEKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJTbWFydEJpbGxpb25zIFRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlBMQVkiOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAwOwoKICAgIC8vIGNvbnRyYWN0IHN0YXRlCiAgICBzdHJ1Y3QgV2FsbGV0IHsKICAgICAgICB1aW50MjA4IGJhbGFuY2U7IC8vIGN1cnJlbnQgYmFsYW5jZSBvZiB1c2VyCiAgICAJdWludDE2IGxhc3REaXZpZGVuZFBlcmlvZDsgLy8gbGFzdCBwcm9jZXNzZWQgZGl2aWRlbmQgcGVyaW9kIG9mIHVzZXIncyB0b2tlbnMKICAgIAl1aW50MzIgbmV4dFdpdGhkcmF3QmxvY2s7IC8vIG5leHQgd2l0aGRyYXdhbCBwb3NzaWJsZSBhZnRlciB0aGlzIGJsb2NrIG51bWJlcgogICAgfQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBXYWxsZXQpIHdhbGxldHM7CiAgICBzdHJ1Y3QgQmV0IHsKICAgICAgICB1aW50MTkyIHZhbHVlOyAvLyBiZXQgc2l6ZQogICAgICAgIHVpbnQzMiBiZXRIYXNoOyAvLyBzZWxlY3RlZCBudW1iZXJzCiAgICAgICAgdWludDMyIGJsb2NrTnVtOyAvLyBibG9ja251bWJlciB3aGVuIGxvdHRlcnkgcnVucwogICAgfQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBCZXQpIGJldHM7CgogICAgdWludCBwdWJsaWMgd2FsbGV0QmFsYW5jZSA9IDA7IC8vIHN1bSBvZiBmdW5kcyBpbiB3YWxsZXRzCgogICAgLy8gaW52ZXN0bWVudCBwYXJhbWV0ZXJzCiAgICB1aW50IHB1YmxpYyBpbnZlc3RTdGFydCA9IDE7IC8vIGludmVzdG1lbnQgc3RhcnQgYmxvY2ssIDA6IGNsb3NlZCwgMTogcHJlcGFyYXRpb24KICAgIHVpbnQgcHVibGljIGludmVzdEJhbGFuY2UgPSAwOyAvLyBmdW5kaW5nIGZyb20gaW52ZXN0b3JzCiAgICB1aW50IHB1YmxpYyBpbnZlc3RCYWxhbmNlTWF4ID0gMjAwMDAwIGV0aGVyOyAvLyBtYXhpbXVtIGZ1bmRpbmcKICAgIHVpbnQgcHVibGljIGRpdmlkZW5kUGVyaW9kID0gMTsKICAgIHVpbnRbXSBwdWJsaWMgZGl2aWRlbmRzOyAvLyBkaXZpZGVucyBjb2xsZWN0ZWQgcGVyIHBlcmlvZCwgZ3Jvd2luZyBhcnJheQoKICAgIC8vIGJldHRpbmcgcGFyYW1ldGVycwogICAgdWludCBwdWJsaWMgbWF4V2luID0gMDsgLy8gbWF4aW11bSBwcml6ZSB3b24KICAgIHVpbnQgcHVibGljIGhhc2hGaXJzdCA9IDA7IC8vIHN0YXJ0IHRpbWUgb2YgYnVpbGRpbmcgaGFzaGVzIGRhdGFiYXNlCiAgICB1aW50IHB1YmxpYyBoYXNoTGFzdCA9IDA7IC8vIGxhc3Qgc2F2ZWQgYmxvY2sgb2YgaGFzaGVzCiAgICB1aW50IHB1YmxpYyBoYXNoTmV4dCA9IDA7IC8vIG5leHQgYXZhaWxhYmxlIGJldCBibG9jay5udW1iZXIKICAgIHVpbnQgcHVibGljIGhhc2hCZXRTdW0gPSAwOyAvLyB1c2VkIGJldCB2b2x1bWUgb2YgbmV4dCBibG9jawogICAgdWludCBwdWJsaWMgaGFzaEJldE1heCA9IDUgZXRoZXI7IC8vIG1heGltdW0gYmV0IHNpemUgcGVyIGJsb2NrCiAgICB1aW50W10gcHVibGljIGhhc2hlczsgLy8gc3BhY2UgZm9yIHN0b3JpbmcgbG90dGVyeSByZXN1bHRzCgogICAgLy8gY29uc3RhbnRzCiAgICAvL3VpbnQgcHVibGljIGNvbnN0YW50IGhhc2hlc1NpemUgPSAxMDI0IDsgLy8gREVCVUcgT05MWSAhISEKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGhhc2hlc1NpemUgPSAxNjM4NCA7IC8vIDMwIGRheXMgb2YgYmxvY2tzCiAgICB1aW50IHB1YmxpYyBjb2xkU3RvcmVMYXN0ID0gMCA7IC8vIGJsb2NrIG9mIGxhc3QgY29sZCBzdG9yZSB0cmFuc2ZlcgoKICAgIC8vIGV2ZW50cwogICAgZXZlbnQgTG9nQmV0KGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYmV0aGFzaCwgdWludCBibG9ja251bWJlciwgdWludCBiZXRzaXplKTsKICAgIGV2ZW50IExvZ0xvc3MoYWRkcmVzcyBpbmRleGVkIHBsYXllciwgdWludCBiZXRoYXNoLCB1aW50IGhhc2gpOwogICAgZXZlbnQgTG9nV2luKGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYmV0aGFzaCwgdWludCBoYXNoLCB1aW50IHByaXplKTsKICAgIGV2ZW50IExvZ0ludmVzdG1lbnQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCBhZGRyZXNzIGluZGV4ZWQgcGFydG5lciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTG9nUmVjb3JkV2luKGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExvZ0xhdGUoYWRkcmVzcyBpbmRleGVkIHBsYXllcix1aW50IHBsYXllckJsb2NrTnVtYmVyLHVpbnQgY3VycmVudEJsb2NrTnVtYmVyKTsKICAgIGV2ZW50IExvZ0RpdmlkZW5kKGFkZHJlc3MgaW5kZXhlZCBpbnZlc3RvciwgdWludCBhbW91bnQsIHVpbnQgcGVyaW9kKTsKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFuaW1hdG9yKCkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IGFuaW1hdG9yKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTbWFydEJpbGxpb25zKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBhbmltYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgd2FsbGV0c1tvd25lcl0ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGRpdmlkZW5kUGVyaW9kKTsKICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsgLy8gbm90IHVzZWQKICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsgLy8gY3VycmVudCBkaXZpZGVuZAogICAgfQoKLyogZ2V0dGVycyAqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBsZW5ndGggb2YgYWxsb2NhdGVkIHN3YXAgc3BhY2UKICAgICAqLwogICAgZnVuY3Rpb24gaGFzaGVzTGVuZ3RoKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGhhc2hlcy5sZW5ndGgpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBiYWxhbmNlIG9mIHdhbGxldAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0QmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLmJhbGFuY2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBsYXN0IGRpdmlkZW5kIHBlcmlvZCBwcm9jZXNzZWQKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdhbGxldFBlcmlvZE9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLmxhc3REaXZpZGVuZFBlcmlvZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJsb2NrIG51bWJlciB3aGVuIHdpdGhkcmF3IGNhbiBjb250aW51ZQogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0QmxvY2tPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KHdhbGxldHNbX293bmVyXS5uZXh0V2l0aGRyYXdCbG9jayk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJldCBzaXplLgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyLgogICAgICovCiAgICBmdW5jdGlvbiBiZXRWYWx1ZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoYmV0c1tfb3duZXJdLnZhbHVlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFNob3cgYmxvY2sgbnVtYmVyIG9mIGxvdHRlcnkgcnVuIGZvciB0aGUgYmV0LgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyLgogICAgICovCiAgICBmdW5jdGlvbiBiZXRIYXNoT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdWludChiZXRzW19vd25lcl0uYmV0SGFzaCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJsb2NrIG51bWJlciBvZiBsb3R0ZXJ5IHJ1biBmb3IgdGhlIGJldC4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHBsYXllci4KICAgICAqLwogICAgZnVuY3Rpb24gYmV0QmxvY2tOdW1iZXJPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGJldHNbX293bmVyXS5ibG9ja051bSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBQcmludCBudW1iZXIgb2YgYmxvY2sgdGlsbCBuZXh0IGV4cGVjdGVkIGRpdmlkZW5kIHBheW1lbnQKICAgICAqLwogICAgZnVuY3Rpb24gZGl2aWRlbmRzQmxvY2tzKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmKGludmVzdFN0YXJ0ID4gMCkgewogICAgICAgICAgICByZXR1cm4oMCk7CiAgICAgICAgfQogICAgICAgIHVpbnQgcGVyaW9kID0gKGJsb2NrLm51bWJlciAtIGhhc2hGaXJzdCkgLyAoMTAgKiBoYXNoZXNTaXplKTsKICAgICAgICBpZihwZXJpb2QgPiBkaXZpZGVuZFBlcmlvZCkgewogICAgICAgICAgICByZXR1cm4oMCk7CiAgICAgICAgfQogICAgICAgIHJldHVybigoMTAgKiBoYXNoZXNTaXplKSAtICgoYmxvY2subnVtYmVyIC0gaGFzaEZpcnN0KSAlICgxMCAqIGhhc2hlc1NpemUpKSk7CiAgICB9CgovKiBhZG1pbmlzdHJhdGl2ZSBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQ2hhbmdlIG93bmVyLgogICAgICogQHBhcmFtIF93aG8gVGhlIGFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF93aG8pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgYXNzZXJ0KF93aG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7CiAgICAgICAgY29tbWl0RGl2aWRlbmQoX3dobyk7CiAgICAgICAgb3duZXIgPSBfd2hvOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGFuZ2UgYW5pbWF0b3IuCiAgICAgKiBAcGFyYW0gX3dobyBUaGUgYWRkcmVzcyBvZiBuZXcgYW5pbWF0b3IuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUFuaW1hdG9yKGFkZHJlc3MgX3dobykgZXh0ZXJuYWwgb25seUFuaW1hdG9yIHsKICAgICAgICBhc3NlcnQoX3dobyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICBjb21taXREaXZpZGVuZChfd2hvKTsKICAgICAgICBhbmltYXRvciA9IF93aG87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCBJQ08gU3RhcnQgYmxvY2suCiAgICAgKiBAcGFyYW0gX3doZW4gVGhlIGJsb2NrIG51bWJlciBvZiB0aGUgSUNPLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRJbnZlc3RTdGFydCh1aW50IF93aGVuKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoaW52ZXN0U3RhcnQgPT0gMSAmJiBoYXNoRmlyc3QgPiAwICYmIGJsb2NrLm51bWJlciA8IF93aGVuKTsKICAgICAgICBpbnZlc3RTdGFydCA9IF93aGVuOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgbWF4aW11bSBiZXQgc2l6ZSBwZXIgYmxvY2sKICAgICAqIEBwYXJhbSBfbWF4c3VtIFRoZSBtYXhpbXVtIGJldCBzaXplIGluIHdlaS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0QmV0TWF4KHVpbnQgX21heHN1bSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYXNoQmV0TWF4ID0gX21heHN1bTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmVzZXQgYmV0IHNpemUgYWNjb3VudGluZywgdG8gaW5jcmVhc2UgYmV0IHZvbHVtZSBhYm92ZSBzYWZlIGxpbWl0cwogICAgICovCiAgICBmdW5jdGlvbiByZXNldEJldCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaGFzaE5leHQgPSBibG9jay5udW1iZXIgKyAzOwogICAgICAgIGhhc2hCZXRTdW0gPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBNb3ZlIGZ1bmRzIHRvIGNvbGQgc3RvcmFnZQogICAgICogQGRldiBpbnZlc3RCYWxhbmNlIGFuZCB3YWxsZXRCYWxhbmNlIGlzIHByb3RlY3RlZCBmcm9tIHdpdGhkcmF3IGJ5IG93bmVyCiAgICAgKiBAZGV2IGlmIGZ1bmRpbmcgaXMgPiA1MCUgYWRtaW4gY2FuIHdpdGhkcmF3IG9ubHkgMC4yNSUgb2YgYmFsYW5jZSB3ZWFrbHkKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRvIG1vdmUgdG8gY29sZCBzdG9yYWdlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbGRTdG9yZSh1aW50IF9hbW91bnQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaG91c2VLZWVwaW5nKCk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCAmJiB0aGlzLmJhbGFuY2UgPj0gKGludmVzdEJhbGFuY2UgKiA5IC8gMTApICsgd2FsbGV0QmFsYW5jZSArIF9hbW91bnQpOwogICAgICAgIGlmKGludmVzdEJhbGFuY2UgPj0gaW52ZXN0QmFsYW5jZU1heCAvIDIpeyAvLyBhZGRpdGlvbmFsIGphY2twb3QgcHJvdGVjdGlvbgogICAgICAgICAgICByZXF1aXJlKChfYW1vdW50IDw9IHRoaXMuYmFsYW5jZSAvIDQwMCkgJiYgY29sZFN0b3JlTGFzdCArIDQgKiA2MCAqIDI0ICogNyA8PSBibG9jay5udW1iZXIpOwogICAgICAgIH0KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIGNvbGRTdG9yZUxhc3QgPSBibG9jay5udW1iZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1vdmUgZnVuZHMgdG8gY29udHJhY3QgamFja3BvdAogICAgICovCiAgICBmdW5jdGlvbiBob3RTdG9yZSgpIHBheWFibGUgZXh0ZXJuYWwgewogICAgICAgIGhvdXNlS2VlcGluZygpOwogICAgfQoKLyogaG91c2VrZWVwaW5nIGZ1bmN0aW9ucyAqLwoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgYWNjb3VudGluZwogICAgICovCiAgICBmdW5jdGlvbiBob3VzZUtlZXBpbmcoKSBwdWJsaWMgewogICAgICAgIGlmKGludmVzdFN0YXJ0ID4gMSAmJiBibG9jay5udW1iZXIgPj0gaW52ZXN0U3RhcnQgKyAoaGFzaGVzU2l6ZSAqIDUpKXsgLy8gY2EuIDE0IGRheXMKICAgICAgICAgICAgaW52ZXN0U3RhcnQgPSAwOyAvLyBzdGFydCBkaXZpZGVuZCBwYXltZW50cwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoaGFzaEZpcnN0ID4gMCl7CgkJICAgICAgICB1aW50IHBlcmlvZCA9IChibG9jay5udW1iZXIgLSBoYXNoRmlyc3QpIC8gKDEwICogaGFzaGVzU2l6ZSApOwogICAgICAgICAgICAgICAgaWYocGVyaW9kID4gZGl2aWRlbmRzLmxlbmd0aCAtIDIpIHsKICAgICAgICAgICAgICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKHBlcmlvZCA+IGRpdmlkZW5kUGVyaW9kICYmIGludmVzdFN0YXJ0ID09IDAgJiYgZGl2aWRlbmRQZXJpb2QgPCBkaXZpZGVuZHMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGRpdmlkZW5kUGVyaW9kKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgovKiBwYXltZW50cyAqLwoKICAgIC8qKgogICAgICogQGRldiBQYXkgYmFsYW5jZSBmcm9tIHdhbGxldAogICAgICovCiAgICBmdW5jdGlvbiBwYXlXYWxsZXQoKSBwdWJsaWMgewogICAgICAgIGlmKHdhbGxldHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA+IDAgJiYgd2FsbGV0c1ttc2cuc2VuZGVyXS5uZXh0V2l0aGRyYXdCbG9jayA8PSBibG9jay5udW1iZXIpewogICAgICAgICAgICB1aW50IGJhbGFuY2UgPSB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2U7CiAgICAgICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA9IDA7CiAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgLT0gYmFsYW5jZTsKICAgICAgICAgICAgcGF5KGJhbGFuY2UpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXkodWludCBfYW1vdW50KSBwcml2YXRlIHsKICAgICAgICB1aW50IG1heHBheSA9IHRoaXMuYmFsYW5jZSAvIDI7CiAgICAgICAgaWYobWF4cGF5ID49IF9hbW91bnQpIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfYW1vdW50KTsKICAgICAgICAgICAgaWYoX2Ftb3VudCA+IDEgZmlubmV5KSB7CiAgICAgICAgICAgICAgICBob3VzZUtlZXBpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdWludCBrZWVwYmFsYW5jZSA9IF9hbW91bnQgLSBtYXhwYXk7CiAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgKz0ga2VlcGJhbGFuY2U7CiAgICAgICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0uYmFsYW5jZSArPSB1aW50MjA4KGtlZXBiYWxhbmNlKTsKICAgICAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5uZXh0V2l0aGRyYXdCbG9jayA9IHVpbnQzMihibG9jay5udW1iZXIgKyA0ICogNjAgKiAyNCAqIDMwKTsgLy8gd2FpdCAxIG1vbnRoIGZvciBtb3JlIGZ1bmRzCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobWF4cGF5KTsKICAgICAgICB9CiAgICB9CgovKiBpbnZlc3RtZW50IGZ1bmN0aW9ucyAqLwoKICAgIC8qKgogICAgICogQGRldiBCdXkgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludmVzdERpcmVjdCgpIHBheWFibGUgZXh0ZXJuYWwgewogICAgICAgIGludmVzdChvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEJ1eSB0b2tlbnMgd2l0aCBhZmZpbGlhdGUgcGFydG5lcgogICAgICogQHBhcmFtIF9wYXJ0bmVyIEFmZmlsaWF0ZSBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIF9wYXJ0bmVyKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgLy9yZXF1aXJlKGZyb21VU0EoKT09ZmFsc2UpOyAvLyBmcm9tVVNBKCkgbm90IHlldCBpbXBsZW1lbnRlZCA6LSgKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID4gMSAmJiBibG9jay5udW1iZXIgPCBpbnZlc3RTdGFydCArIChoYXNoZXNTaXplICogNSkgJiYgaW52ZXN0QmFsYW5jZSA8IGludmVzdEJhbGFuY2VNYXgpOwogICAgICAgIHVpbnQgaW52ZXN0aW5nID0gbXNnLnZhbHVlOwogICAgICAgIGlmKGludmVzdGluZyA+IGludmVzdEJhbGFuY2VNYXggLSBpbnZlc3RCYWxhbmNlKSB7CiAgICAgICAgICAgIGludmVzdGluZyA9IGludmVzdEJhbGFuY2VNYXggLSBpbnZlc3RCYWxhbmNlOwogICAgICAgICAgICBpbnZlc3RCYWxhbmNlID0gaW52ZXN0QmFsYW5jZU1heDsKICAgICAgICAgICAgaW52ZXN0U3RhcnQgPSAwOyAvLyBjbG9zZSBpbnZlc3RtZW50IHJvdW5kCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlLnN1YihpbnZlc3RpbmcpKTsgLy8gc2VuZCBiYWNrIGZ1bmRzIGltbWVkaWF0ZWx5CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGludmVzdEJhbGFuY2UgKz0gaW52ZXN0aW5nOwogICAgICAgIH0KICAgICAgICBpZihfcGFydG5lciA9PSBhZGRyZXNzKDApIHx8IF9wYXJ0bmVyID09IG93bmVyKXsKICAgICAgICAgICAgd2FsbGV0QmFsYW5jZSArPSBpbnZlc3RpbmcgLyAxMDsKICAgICAgICAgICAgd2FsbGV0c1tvd25lcl0uYmFsYW5jZSArPSB1aW50MjA4KGludmVzdGluZyAvIDEwKTt9IC8vIDEwJSBmb3IgbWFya2V0aW5nIGlmIG5vIGFmZmlsaWF0ZXMKICAgICAgICBlbHNlewogICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IChpbnZlc3RpbmcgKiA1IC8gMTAwKSAqIDI7CiAgICAgICAgICAgIHdhbGxldHNbb3duZXJdLmJhbGFuY2UgKz0gdWludDIwOChpbnZlc3RpbmcgKiA1IC8gMTAwKTsgLy8gNSUgaW5pdGlhbCBtYXJrZXRpbmcgZnVuZHMKICAgICAgICAgICAgd2FsbGV0c1tfcGFydG5lcl0uYmFsYW5jZSArPSB1aW50MjA4KGludmVzdGluZyAqIDUgLyAxMDApO30gLy8gNSUgZm9yIGFmZmlsaWF0ZXMKICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmxhc3REaXZpZGVuZFBlcmlvZCA9IHVpbnQxNihkaXZpZGVuZFBlcmlvZCk7IC8vIGFzc2VydChkaXZpZGVuZFBlcmlvZCA9PSAxKTsKICAgICAgICB1aW50IHNlbmRlckJhbGFuY2UgPSBpbnZlc3RpbmcgLyAxMCoqMTU7CiAgICAgICAgdWludCBvd25lckJhbGFuY2UgPSBpbnZlc3RpbmcgKiAxNiAvIDEwKioxNyAgOwogICAgICAgIHVpbnQgYW5pbWF0b3JCYWxhbmNlID0gaW52ZXN0aW5nICogMTAgLyAxMCoqMTcgIDsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSBzZW5kZXJCYWxhbmNlOwogICAgICAgIGJhbGFuY2VzW293bmVyXSArPSBvd25lckJhbGFuY2UgOyAvLyAxMyUgb2Ygc2hhcmVzIGdvIHRvIGRldmVsb3BlcnMKICAgICAgICBiYWxhbmNlc1thbmltYXRvcl0gKz0gYW5pbWF0b3JCYWxhbmNlIDsgLy8gOCUgb2Ygc2hhcmVzIGdvIHRvIGFuaW1hdG9yCiAgICAgICAgdG90YWxTdXBwbHkgKz0gc2VuZGVyQmFsYW5jZSArIG93bmVyQmFsYW5jZSArIGFuaW1hdG9yQmFsYW5jZTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLG1zZy5zZW5kZXIsc2VuZGVyQmFsYW5jZSk7IC8vIGZvciBldGhlcnNjYW4KICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLG93bmVyLG93bmVyQmFsYW5jZSk7IC8vIGZvciBldGhlcnNjYW4KICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLGFuaW1hdG9yLGFuaW1hdG9yQmFsYW5jZSk7IC8vIGZvciBldGhlcnNjYW4KICAgICAgICBMb2dJbnZlc3RtZW50KG1zZy5zZW5kZXIsX3BhcnRuZXIsaW52ZXN0aW5nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGVsZXRlIGFsbCB0b2tlbnMgb3duZWQgYnkgc2VuZGVyIGFuZCByZXR1cm4gdW5wYWlkIGRpdmlkZW5kcyBhbmQgOTAlIG9mIGluaXRpYWwgaW52ZXN0bWVudAogICAgICovCiAgICBmdW5jdGlvbiBkaXNpbnZlc3QoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA9PSAwKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICB1aW50IGluaXRpYWxJbnZlc3RtZW50ID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0gKiAxMCoqMTU7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlcixhZGRyZXNzKDApLGJhbGFuY2VzW21zZy5zZW5kZXJdKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIGRlbGV0ZSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsgLy8gdG90YWxTdXBwbHkgc3RheXMgdGhlIHNhbWUsIGludmVzdEJhbGFuY2UgaXMgcmVkdWNlZAogICAgICAgIGludmVzdEJhbGFuY2UgLT0gaW5pdGlhbEludmVzdG1lbnQ7CiAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlICs9IHVpbnQyMDgoaW5pdGlhbEludmVzdG1lbnQgKiA5IC8gMTApOwogICAgICAgIHBheVdhbGxldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQYXkgdW5wYWlkIGRpdmlkZW5kcwogICAgICovCiAgICBmdW5jdGlvbiBwYXlEaXZpZGVuZHMoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA9PSAwKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICBwYXlXYWxsZXQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ29tbWl0IHJlbWFpbmluZyBkaXZpZGVuZHMgYmVmb3JlIHRyYW5zZmVyIG9mIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBjb21taXREaXZpZGVuZChhZGRyZXNzIF93aG8pIGludGVybmFsIHsKICAgICAgICB1aW50IGxhc3QgPSB3YWxsZXRzW193aG9dLmxhc3REaXZpZGVuZFBlcmlvZDsKICAgICAgICBpZigoYmFsYW5jZXNbX3dob109PTApIHx8IChsYXN0PT0wKSl7CiAgICAgICAgICAgIHdhbGxldHNbX3dob10ubGFzdERpdmlkZW5kUGVyaW9kPXVpbnQxNihkaXZpZGVuZFBlcmlvZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYobGFzdD09ZGl2aWRlbmRQZXJpb2QpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB1aW50IHNoYXJlID0gYmFsYW5jZXNbX3dob10gKiAweGZmZmZmZmZmIC8gdG90YWxTdXBwbHk7CiAgICAgICAgdWludCBiYWxhbmNlID0gMDsKICAgICAgICBmb3IoO2xhc3Q8ZGl2aWRlbmRQZXJpb2Q7bGFzdCsrKSB7CiAgICAgICAgICAgIGJhbGFuY2UgKz0gc2hhcmUgKiBkaXZpZGVuZHNbbGFzdF07CiAgICAgICAgfQogICAgICAgIGJhbGFuY2UgPSAoYmFsYW5jZSAvIDB4ZmZmZmZmZmYpOwogICAgICAgIHdhbGxldEJhbGFuY2UgKz0gYmFsYW5jZTsKICAgICAgICB3YWxsZXRzW193aG9dLmJhbGFuY2UgKz0gdWludDIwOChiYWxhbmNlKTsKICAgICAgICB3YWxsZXRzW193aG9dLmxhc3REaXZpZGVuZFBlcmlvZCA9IHVpbnQxNihsYXN0KTsKICAgICAgICBMb2dEaXZpZGVuZChfd2hvLGJhbGFuY2UsbGFzdCk7CiAgICB9CgovKiBsb3R0ZXJ5IGZ1bmN0aW9ucyAqLwoKICAgIGZ1bmN0aW9uIGJldFByaXplKEJldCBfcGxheWVyLCB1aW50MjQgX2hhc2gpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludCkgeyAvLyBob3VzZSBmZWUgMTMuODUlCiAgICAgICAgdWludDI0IGJldGhhc2ggPSB1aW50MjQoX3BsYXllci5iZXRIYXNoKTsKICAgICAgICB1aW50MjQgaGl0ID0gYmV0aGFzaCBeIF9oYXNoOwogICAgICAgIHVpbnQyNCBtYXRjaGVzID0KICAgICAgICAgICAgKChoaXQgJiAweEYpID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMDApID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwMDApID09IDAgPyAxIDogMCApICsKICAgICAgICAgICAgKChoaXQgJiAweEYwMDAwKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMDAwMDApID09IDAgPyAxIDogMCApOwogICAgICAgIGlmKG1hdGNoZXMgPT0gNil7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogNzAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoZXMgPT0gNSl7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogMjAwMDApOwogICAgICAgIH0KICAgICAgICBpZihtYXRjaGVzID09IDQpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDUwMCk7CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoZXMgPT0gMyl7CiAgICAgICAgICAgIHJldHVybih1aW50KF9wbGF5ZXIudmFsdWUpICogMjUpOwogICAgICAgIH0KICAgICAgICBpZihtYXRjaGVzID09IDIpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4oMCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBDaGVjayBpZiB3b24gaW4gbG90dGVyeQogICAgICovCiAgICBmdW5jdGlvbiBiZXRPZihhZGRyZXNzIF93aG8pIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpICB7CiAgICAgICAgQmV0IG1lbW9yeSBwbGF5ZXIgPSBiZXRzW193aG9dOwogICAgICAgIGlmKCAocGxheWVyLnZhbHVlPT0wKSB8fAogICAgICAgICAgICAocGxheWVyLmJsb2NrTnVtPD0xKSB8fAogICAgICAgICAgICAoYmxvY2subnVtYmVyPHBsYXllci5ibG9ja051bSkgfHwKICAgICAgICAgICAgKGJsb2NrLm51bWJlcj49cGxheWVyLmJsb2NrTnVtICsgKDEwICogaGFzaGVzU2l6ZSkpKXsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KICAgICAgICBpZihibG9jay5udW1iZXI8cGxheWVyLmJsb2NrTnVtKzI1Nil7CiAgICAgICAgICAgIHJldHVybihiZXRQcml6ZShwbGF5ZXIsdWludDI0KGJsb2NrLmJsb2NraGFzaChwbGF5ZXIuYmxvY2tOdW0pKSkpOwogICAgICAgIH0KICAgICAgICBpZihoYXNoRmlyc3Q+MCl7CiAgICAgICAgICAgIHVpbnQzMiBoYXNoID0gZ2V0SGFzaChwbGF5ZXIuYmxvY2tOdW0pOwogICAgICAgICAgICBpZihoYXNoID09IDB4MTAwMDAwMCkgeyAvLyBsb2FkIGhhc2ggZmFpbGVkIDotKCwgcmV0dXJuIGZ1bmRzCiAgICAgICAgICAgICAgICByZXR1cm4odWludChwbGF5ZXIudmFsdWUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgcmV0dXJuKGJldFByaXplKHBsYXllcix1aW50MjQoaGFzaCkpKTsKICAgICAgICAgICAgfQoJfQogICAgICAgIHJldHVybigwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hlY2sgaWYgd29uIGluIGxvdHRlcnkKICAgICAqLwogICAgZnVuY3Rpb24gd29uKCkgcHVibGljIHsKICAgICAgICBCZXQgbWVtb3J5IHBsYXllciA9IGJldHNbbXNnLnNlbmRlcl07CiAgICAgICAgaWYocGxheWVyLmJsb2NrTnVtPT0wKXsgLy8gY3JlYXRlIGEgbmV3IHBsYXllcgogICAgICAgICAgICBiZXRzW21zZy5zZW5kZXJdID0gQmV0KHt2YWx1ZTogMCwgYmV0SGFzaDogMCwgYmxvY2tOdW06IDF9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZigocGxheWVyLnZhbHVlPT0wKSB8fCAocGxheWVyLmJsb2NrTnVtPT0xKSl7CiAgICAgICAgICAgIHBheVdhbGxldCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyPnBsYXllci5ibG9ja051bSk7IC8vIGlmIHRoZXJlIGlzIGFuIGFjdGl2ZSBiZXQsIHRocm93KCkKICAgICAgICBpZihwbGF5ZXIuYmxvY2tOdW0gKyAoMTAgKiBoYXNoZXNTaXplKSA8PSBibG9jay5udW1iZXIpeyAvLyBsYXN0IGJldCB0b28gbG9uZyBhZ28sIGxvc3QgIQogICAgICAgICAgICBMb2dMYXRlKG1zZy5zZW5kZXIscGxheWVyLmJsb2NrTnVtLGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHVpbnQgcHJpemUgPSAwOwogICAgICAgIHVpbnQzMiBoYXNoID0gMDsKICAgICAgICBpZihibG9jay5udW1iZXI8cGxheWVyLmJsb2NrTnVtKzI1Nil7CiAgICAgICAgICAgIGhhc2ggPSB1aW50MjQoYmxvY2suYmxvY2toYXNoKHBsYXllci5ibG9ja051bSkpOwogICAgICAgICAgICBwcml6ZSA9IGJldFByaXplKHBsYXllcix1aW50MjQoaGFzaCkpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoaGFzaEZpcnN0PjApeyAvLyBsb3R0ZXJ5IGlzIG9wZW4gZXZlbiBiZWZvcmUgc3dhcCBzcGFjZSAoaGFzaGVzKSBpcyByZWFkeSwgYnV0IHBsYXllciBtdXN0IGNvbGxlY3QgcmVzdWx0cyB3aXRoaW4gMjU2IGJsb2NrcyBhZnRlciBydW4KICAgICAgICAgICAgICAgIGhhc2ggPSBnZXRIYXNoKHBsYXllci5ibG9ja051bSk7CiAgICAgICAgICAgICAgICBpZihoYXNoID09IDB4MTAwMDAwMCkgeyAvLyBsb2FkIGhhc2ggZmFpbGVkIDotKCwgcmV0dXJuIGZ1bmRzCiAgICAgICAgICAgICAgICAgICAgcHJpemUgPSB1aW50KHBsYXllci52YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgIHByaXplID0gYmV0UHJpemUocGxheWVyLHVpbnQyNChoYXNoKSk7CiAgICAgICAgICAgICAgICB9CgkgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgTG9nTGF0ZShtc2cuc2VuZGVyLHBsYXllci5ibG9ja051bSxibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICAgYmV0c1ttc2cuc2VuZGVyXSA9IEJldCh7dmFsdWU6IDAsIGJldEhhc2g6IDAsIGJsb2NrTnVtOiAxfSk7CiAgICAgICAgICAgICAgICByZXR1cm4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBiZXRzW21zZy5zZW5kZXJdID0gQmV0KHt2YWx1ZTogMCwgYmV0SGFzaDogMCwgYmxvY2tOdW06IDF9KTsKICAgICAgICBpZihwcml6ZT4wKSB7CiAgICAgICAgICAgIExvZ1dpbihtc2cuc2VuZGVyLHVpbnQocGxheWVyLmJldEhhc2gpLHVpbnQoaGFzaCkscHJpemUpOwogICAgICAgICAgICBpZihwcml6ZSA+IG1heFdpbil7CiAgICAgICAgICAgICAgICBtYXhXaW4gPSBwcml6ZTsKICAgICAgICAgICAgICAgIExvZ1JlY29yZFdpbihtc2cuc2VuZGVyLHByaXplKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXkocHJpemUpOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBMb2dMb3NzKG1zZy5zZW5kZXIsdWludChwbGF5ZXIuYmV0SGFzaCksdWludChoYXNoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZW5kIGV0aGVyIHRvIGJ1eSB0b2tlbnMgZHVyaW5nIElDTwogICAgICogQGRldiBvciBzZW5kIGxlc3MgdGhhbiAxIGV0aGVyIHRvIGNvbnRyYWN0IHRvIHBsYXkKICAgICAqIEBkZXYgb3Igc2VuZCAwIHRvIGNvbGxlY3QgcHJpemUKICAgICAqLwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSBleHRlcm5hbCB7CiAgICAgICAgaWYobXNnLnZhbHVlID4gMCl7CiAgICAgICAgICAgIGlmKGludmVzdFN0YXJ0PjEpeyAvLyBkdXJpbmcgSUNPIHBheW1lbnQgdG8gdGhlIGNvbnRyYWN0IGlzIHRyZWF0ZWQgYXMgaW52ZXN0bWVudAogICAgICAgICAgICAgICAgaW52ZXN0KG93bmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNleyAvLyBpZiBub3QgSUNPIHJ1bm5pbmcgcGF5bWVudCB0byBjb250cmFjdCBpcyB0cmVhdGVkIGFzIHBsYXkKICAgICAgICAgICAgICAgIHBsYXkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vY2hlY2sgZm9yIGRpdmlkZW5kcyBhbmQgb3RoZXIgYXNzZXRzCiAgICAgICAgaWYoaW52ZXN0U3RhcnQgPT0gMCAmJiBiYWxhbmNlc1ttc2cuc2VuZGVyXT4wKXsKICAgICAgICAgICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7fQogICAgICAgIHdvbigpOyAvLyB3aWxsIHJ1biBwYXlXYWxsZXQoKSBpZiBub3RoaW5nIGVsc2UgYXZhaWxhYmxlCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFBsYXkgaW4gbG90dGVyeQogICAgICovCiAgICBmdW5jdGlvbiBwbGF5KCkgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwbGF5U3lzdGVtKHVpbnQoc2hhMyhtc2cuc2VuZGVyLGJsb2NrLm51bWJlcikpLCBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUGxheSBpbiBsb3R0ZXJ5IHdpdGggcmFuZG9tIG51bWJlcnMKICAgICAqIEBwYXJhbSBfcGFydG5lciBBZmZpbGlhdGUgcGFydG5lcgogICAgICovCiAgICBmdW5jdGlvbiBwbGF5UmFuZG9tKGFkZHJlc3MgX3BhcnRuZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGxheVN5c3RlbSh1aW50KHNoYTMobXNnLnNlbmRlcixibG9jay5udW1iZXIpKSwgX3BhcnRuZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQbGF5IGluIGxvdHRlcnkgd2l0aCBvd24gbnVtYmVycwogICAgICogQHBhcmFtIF9wYXJ0bmVyIEFmZmlsaWF0ZSBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBsYXlTeXN0ZW0odWludCBfaGFzaCwgYWRkcmVzcyBfcGFydG5lcikgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHdvbigpOyAvLyBjaGVjayBpZiBwbGF5ZXIgZGlkIG5vdCB3aW4gCiAgICAgICAgdWludDI0IGJldGhhc2ggPSB1aW50MjQoX2hhc2gpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlIDw9IDEgZXRoZXIgJiYgbXNnLnZhbHVlIDwgaGFzaEJldE1heCk7CiAgICAgICAgaWYobXNnLnZhbHVlID4gMCl7CiAgICAgICAgICAgIGlmKGludmVzdFN0YXJ0PT0wKSB7IC8vIGRpdmlkZW5kcyBvbmx5IGFmdGVyIGludmVzdG1lbnQgZmluaXNoZWQKICAgICAgICAgICAgICAgIGRpdmlkZW5kc1tkaXZpZGVuZFBlcmlvZF0gKz0gbXNnLnZhbHVlIC8gMjA7IC8vIDUlIGRpdmlkZW5kCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoX3BhcnRuZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgdWludCBmZWUgPSBtc2cudmFsdWUgLyAxMDA7CiAgICAgICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IGZlZTsKICAgICAgICAgICAgICAgIHdhbGxldHNbX3BhcnRuZXJdLmJhbGFuY2UgKz0gdWludDIwOChmZWUpOyAvLyAxJSBmb3IgYWZmaWxpYXRlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGhhc2hOZXh0IDwgYmxvY2subnVtYmVyICsgMykgewogICAgICAgICAgICAgICAgaGFzaE5leHQgPSBibG9jay5udW1iZXIgKyAzOwogICAgICAgICAgICAgICAgaGFzaEJldFN1bSA9IG1zZy52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgaWYoaGFzaEJldFN1bSA+IGhhc2hCZXRNYXgpIHsKICAgICAgICAgICAgICAgICAgICBoYXNoTmV4dCsrOwogICAgICAgICAgICAgICAgICAgIGhhc2hCZXRTdW0gPSBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgIGhhc2hCZXRTdW0gKz0gbXNnLnZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiB1aW50MTkyKG1zZy52YWx1ZSksIGJldEhhc2g6IHVpbnQzMihiZXRoYXNoKSwgYmxvY2tOdW06IHVpbnQzMihoYXNoTmV4dCl9KTsKICAgICAgICAgICAgTG9nQmV0KG1zZy5zZW5kZXIsdWludChiZXRoYXNoKSxoYXNoTmV4dCxtc2cudmFsdWUpOwogICAgICAgIH0KICAgICAgICBwdXRIYXNoKCk7IC8vIHBsYXllcnMgaGVscCBjb2xsZWNpbmcgZGF0YQogICAgICAgIHJldHVybihoYXNoTmV4dCk7CiAgICB9CgovKiBkYXRhYmFzZSBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlIGhhc2ggZGF0YSBzd2FwIHNwYWNlCiAgICAgKiBAcGFyYW0gX3NhZGQgTnVtYmVyIG9mIGhhc2hlcyB0byBhZGQgKDw9MjU2KQogICAgICovCiAgICBmdW5jdGlvbiBhZGRIYXNoZXModWludCBfc2FkZCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXF1aXJlKGhhc2hGaXJzdCA9PSAwICYmIF9zYWRkID4gMCAmJiBfc2FkZCA8PSBoYXNoZXNTaXplKTsKICAgICAgICB1aW50IG4gPSBoYXNoZXMubGVuZ3RoOwogICAgICAgIGlmKG4gKyBfc2FkZCA+IGhhc2hlc1NpemUpewogICAgICAgICAgICBoYXNoZXMubGVuZ3RoID0gaGFzaGVzU2l6ZTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgaGFzaGVzLmxlbmd0aCArPSBfc2FkZDsKICAgICAgICB9CiAgICAgICAgZm9yKDtuPGhhc2hlcy5sZW5ndGg7bisrKXsgLy8gbWFrZSBzdXJlIHRvIGJ1cm4gZ2FzCiAgICAgICAgICAgIGhhc2hlc1tuXSA9IDE7CiAgICAgICAgfQogICAgICAgIGlmKGhhc2hlcy5sZW5ndGg+PWhhc2hlc1NpemUpIHsgLy8gYXNzdW1lIGJsb2NrLm51bWJlciA+IDEwCiAgICAgICAgICAgIGhhc2hGaXJzdCA9IGJsb2NrLm51bWJlciAtICggYmxvY2subnVtYmVyICUgMTApOwogICAgICAgICAgICBoYXNoTGFzdCA9IGhhc2hGaXJzdDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuKGhhc2hlcy5sZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGUgaGFzaCBkYXRhIHN3YXAgc3BhY2UsIGFkZCAxMjggaGFzaGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZEhhc2hlczEyOCgpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4oYWRkSGFzaGVzKDEyOCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNIYXNoZXModWludDMyIF9sYXN0YiwgdWludDMyIF9kZWx0YSkgY29uc3RhbnQgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0YiAgKSkgJiAweEZGRkZGRiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0YisxKSkgJiAweEZGRkZGRiApIDw8IDI0ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzIpKSAmIDB4RkZGRkZGICkgPDwgNDggKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrMykpICYgMHhGRkZGRkYgKSA8PCA3MiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis0KSkgJiAweEZGRkZGRiApIDw8IDk2ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzUpKSAmIDB4RkZGRkZGICkgPDwgMTIwICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzYpKSAmIDB4RkZGRkZGICkgPDwgMTQ0ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzcpKSAmIDB4RkZGRkZGICkgPDwgMTY4ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzgpKSAmIDB4RkZGRkZGICkgPDwgMTkyICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzkpKSAmIDB4RkZGRkZGICkgPDwgMjE2ICkKICAgICAgICAgICAgfCAoICggdWludChfZGVsdGEpIC8gaGFzaGVzU2l6ZSkgPDwgMjQwKSk7IAogICAgfQoKICAgIGZ1bmN0aW9uIGdldEhhc2godWludCBfYmxvY2spIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludDMyKSB7CiAgICAgICAgdWludCBkZWx0YSA9IChfYmxvY2sgLSBoYXNoRmlyc3QpIC8gMTA7CiAgICAgICAgdWludCBoYXNoID0gaGFzaGVzW2RlbHRhICUgaGFzaGVzU2l6ZV07CiAgICAgICAgaWYoZGVsdGEgLyBoYXNoZXNTaXplICE9IGhhc2ggPj4gMjQwKSB7CiAgICAgICAgICAgIHJldHVybigweDEwMDAwMDApOyAvLyBsb2FkIGZhaWxlZCwgaW5jb3JyZWN0IGRhdGEgaW4gaGFzaGVzCiAgICAgICAgfQogICAgICAgIHVpbnQgc2xvdHAgPSAoX2Jsb2NrIC0gaGFzaEZpcnN0KSAlIDEwOyAKICAgICAgICByZXR1cm4odWludDMyKChoYXNoID4+ICgyNCAqIHNsb3RwKSkgJiAweEZGRkZGRikpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgRmlsbCBoYXNoIGRhdGEKICAgICAqLwogICAgZnVuY3Rpb24gcHV0SGFzaCgpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBsYXN0YiA9IGhhc2hMYXN0OwogICAgICAgIGlmKGxhc3RiID09IDAgfHwgYmxvY2subnVtYmVyIDw9IGxhc3RiICsgMTApIHsKICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgdWludCBibG9ja24yNTY7CiAgICAgICAgaWYoYmxvY2subnVtYmVyPDI1NikgeyAvLyB1c2VsZXNzIHRlc3QgZm9yIHRlc3RuZXQgOi0oCiAgICAgICAgICAgIGJsb2NrbjI1NiA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGJsb2NrbjI1NiA9IGJsb2NrLm51bWJlciAtIDI1NjsKICAgICAgICB9CiAgICAgICAgaWYobGFzdGIgPCBibG9ja24yNTYpIHsKICAgICAgICAgICAgdWludCBudW0gPSBibG9ja24yNTY7CiAgICAgICAgICAgIG51bSArPSBudW0gJSAxMDsKICAgICAgICAgICAgbGFzdGIgPSBudW07IAogICAgICAgIH0KICAgICAgICB1aW50IGRlbHRhID0gKGxhc3RiIC0gaGFzaEZpcnN0KSAvIDEwOwogICAgICAgIGhhc2hlc1tkZWx0YSAlIGhhc2hlc1NpemVdID0gY2FsY0hhc2hlcyh1aW50MzIobGFzdGIpLHVpbnQzMihkZWx0YSkpOwogICAgICAgIGhhc2hMYXN0ID0gbGFzdGIgKyAxMDsKICAgICAgICByZXR1cm4odHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZpbGwgaGFzaCBkYXRhIG1hbnkgdGltZXMKICAgICAqIEBwYXJhbSBfbnVtIE51bWJlciBvZiBpdGVyYXRpb25zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHB1dEhhc2hlcyh1aW50IF9udW0pIGV4dGVybmFsIHsKICAgICAgICB1aW50IG49MDsKICAgICAgICBmb3IoO248X251bTtuKyspewogICAgICAgICAgICBpZighcHV0SGFzaCgpKXsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAp9'.
	

]
