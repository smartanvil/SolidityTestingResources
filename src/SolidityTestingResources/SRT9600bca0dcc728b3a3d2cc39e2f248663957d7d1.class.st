Class {
	#name : #SRT9600bca0dcc728b3a3d2cc39e2f248663957d7d1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9600bca0dcc728b3a3d2cc39e2f248663957d7d1 >> base64 [
	^ 'Ly8gQ3JlYXRlZCB1c2luZyBJQ08gV2l6YXJkIGh0dHBzOi8vZ2l0aHViLmNvbS9vcmFjbGVzb3JnL2ljby13aXphcmQgYnkgT3JhY2xlcyBOZXR3b3JrIApwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KLy8gVGVtcG9yYXJpbHkgaGF2ZSBTYWZlTWF0aCBoZXJlIHVudGlsIGFsbCBjb250cmFjdHMgaGF2ZSBiZWVuIG1pZ3JhdGVkIHRvIFNhZmVNYXRoTGliIHZlcnNpb24gZnJvbSBPcGVuWmVwcGVsaW4KLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPiAwKTsKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYkV4dCB7CiAgZnVuY3Rpb24gdGltZXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBkaXZpZGVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBtaW51cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEpOwogICAgcmV0dXJuIGM7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qCiAqIEhhbHRhYmxlCiAqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICovCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgewogIGJvb2wgcHVibGljIGhhbHRlZDsKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KICBtb2RpZmllciBzdG9wTm9uT3duZXJzSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsKICAgIF87CiAgfQogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgaGFsdGVkID0gdHJ1ZTsKICB9CiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuCiAqLwpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgewogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0LgogICAqCiAgICogQ2hlY2tzIHRoYXQgcHJpY2luZyBzdHJhdGVneSBtYXRjaGVzIGNyb3dkc2FsZSBwYXJhbWV0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICAvKioKICAgKiBAZGV2IFByaWNpbmcgdGVsbHMgaWYgdGhpcyBpcyBhIHByZXNhbGUgcHVyY2hhc2Ugb3Igbm90LgogICAgIEBwYXJhbSBwdXJjaGFzZXIgQWRkcmVzcyBvZiB0aGUgcHVyY2hhc2VyCiAgICAgQHJldHVybiBGYWxzZSBieSBkZWZhdWx0LCB0cnVlIGlmIGEgcHJlc2FsZSBwdXJjaGFzZXIKICAgKi8KICBmdW5jdGlvbiBpc1ByZXNhbGVQdXJjaGFzZShhZGRyZXNzIHB1cmNoYXNlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyIGluIHRoZSBtYWluIHRva2VuIHNhbGUgLSB0aGlzIG51bWJlciBleGNsdWRlcyBwcmVzYWxlCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuCiAqCiAqIC0gQWxsb2NhdGUgdG9rZW5zIGZvciBmb3VuZGVycywgYm91bnRpZXMgYW5kIGNvbW11bml0eQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQogKiAtIGV0Yy4KICovCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgewogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKTsKfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Ci8qKgogKiBBIHRva2VuIHRoYXQgZGVmaW5lcyBmcmFjdGlvbmFsIHVuaXRzIGFzIGRlY2ltYWxzLgogKi8KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwRXh0IGlzIEVSQzIwIHsKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKICB1aW50IHB1YmxpYyBtaW5DYXA7Cn0KLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGUKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZAogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVFeHQgaXMgSGFsdGFibGUgewogIC8qIE1heCBpbnZlc3RtZW50IGNvdW50IHdoZW4gd2UgYXJlIHN0aWxsIGFsbG93ZWQgdG8gY2hhbmdlIHRoZSBtdWx0aXNpZyBhZGRyZXNzICovCiAgdWludCBwdWJsaWMgTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UgPSA1OwogIHVzaW5nIFNhZmVNYXRoTGliRXh0IGZvciB1aW50OwogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMEV4dCBwdWJsaWMgdG9rZW47CiAgLyogSG93IHdlIGFyZSBnb2luZyB0byBwcmljZSBvdXIgb2ZmZXJpbmcgKi8KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsKICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50OwogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKICAvKiBpZiB0aGUgZnVuZGluZyBnb2FsIGlzIG5vdCByZWFjaGVkLCBpbnZlc3RvcnMgbWF5IHdpdGhkcmF3IHRoZWlyIGZ1bmRzICovCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOwogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CiAgLyogQ2FsY3VsYXRlIGluY29taW5nIGZ1bmRzIGZyb20gcHJlc2FsZSBjb250cmFjdHMgYW5kIGFkZHJlc3NlcyAqLwogIHVpbnQgcHVibGljIHByZXNhbGVXZWlSYWlzZWQgPSAwOwogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgZ2l2ZW4gYmFjayB0byBpbnZlc3RvcnMuKi8KICB1aW50IHB1YmxpYyB3ZWlSZWZ1bmRlZCA9IDA7CiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsKICBib29sIHB1YmxpYyBpc1doaXRlTGlzdGVkOwogIGFkZHJlc3NbXSBwdWJsaWMgam9pbmVkQ3Jvd2RzYWxlczsKICB1aW50IHB1YmxpYyBqb2luZWRDcm93ZHNhbGVzTGVuID0gMDsKICBhZGRyZXNzIHB1YmxpYyBsYXN0Q3Jvd2RzYWxlOwogIC8qKgogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuCiAgICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIEZpcnN0Qmxvb2QgY3Jvd2RzYWxlIHRvIGVuc3VyZSBhbGwgY29udHJpYnV0b3JzIGhhdmUgYWNjZXB0ZWQgdGVybXMgb24gc2FsZSAob24gdGhlIHdlYikuCiAgICAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CiAgLyoqIEhvdyBtdWNoIHRva2VucyB0aGlzIGNyb3dkc2FsZSBoYXMgY3JlZGl0ZWQgZm9yIGVhY2ggaW52ZXN0b3IgYWRkcmVzcyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7CiAgc3RydWN0IFdoaXRlTGlzdERhdGEgewogICAgYm9vbCBzdGF0dXM7CiAgICB1aW50IG1pbkNhcDsKICAgIHVpbnQgbWF4Q2FwOwogIH0KICAvL2lzIGNyb3dkc2FsZSB1cGRhdGFibGUKICBib29sIHB1YmxpYyBpc1VwZGF0YWJsZTsKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2FsIG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gV2hpdGVMaXN0RGF0YSkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7CiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7CiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLgogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CiAgLy8gUmVmdW5kIHdhcyBwcm9jZXNzZWQgZm9yIGEgY29udHJpYnV0b3IKICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOwogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgbmV3UmVxdWlyZUN1c3RvbWVySWQsIGJvb2wgbmV3UmVxdWlyZWRTaWduZWRBZGRyZXNzLCBhZGRyZXNzIG5ld1NpZ25lckFkZHJlc3MpOwogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKICAvLyBDcm93ZHNhbGUgc3RhcnQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgU3RhcnRzQXRDaGFuZ2VkKHVpbnQgbmV3U3RhcnRzQXQpOwogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IG5ld0VuZHNBdCk7CiAgZnVuY3Rpb24gQ3Jvd2RzYWxlRXh0KGFkZHJlc3MgX3Rva2VuLCBQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQsIHVpbnQgX21pbmltdW1GdW5kaW5nR29hbCwgYm9vbCBfaXNVcGRhdGFibGUsIGJvb2wgX2lzV2hpdGVMaXN0ZWQpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIHRva2VuID0gRnJhY3Rpb25hbEVSQzIwRXh0KF90b2tlbik7CiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsKICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIGlmKF9zdGFydCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBzdGFydHNBdCA9IF9zdGFydDsKICAgIGlmKF9lbmQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQogICAgZW5kc0F0ID0gX2VuZDsKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIC8vIE1pbmltdW0gZnVuZGluZyBnb2FsIGNhbiBiZSB6ZXJvCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOwogICAgaXNVcGRhdGFibGUgPSBfaXNVcGRhdGFibGU7CiAgICBpc1doaXRlTGlzdGVkID0gX2lzV2hpdGVMaXN0ZWQ7CiAgfQogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KICAvKioKICAgKiBNYWtlIGFuIGludmVzdG1lbnQuCiAgICoKICAgKiBDcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgcHJpdmF0ZSB7CiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgdGhyb3c7CiAgICB9IGVsc2UgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5GdW5kaW5nKSB7CiAgICAgIC8vIFJldGFpbCBwYXJ0aWNpcGFudHMgY2FuIG9ubHkgY29tZSBpbiB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgcnVubmluZwogICAgICAvLyBwYXNzCiAgICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0uc3RhdHVzKSB7CiAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIFVud2FudGVkIHN0YXRlCiAgICAgIHRocm93OwogICAgfQogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAvLyBBY2NvdW50IHByZXNhbGUgc2FsZXMgc2VwYXJhdGVseSwgc28gdGhhdCB0aGV5IGRvIG5vdCBjb3VudCBhZ2FpbnN0IHByaWNpbmcgdHJhbmNoZXMKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBwcmljaW5nU3RyYXRlZ3kuY2FsY3VsYXRlUHJpY2Uod2VpQW1vdW50LCB3ZWlSYWlzZWQgLSBwcmVzYWxlV2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKICAgIGlmKHRva2VuQW1vdW50ID09IDApIHsKICAgICAgLy8gRHVzdCB0cmFuc2FjdGlvbgogICAgICB0aHJvdzsKICAgIH0KICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgaWYodG9rZW5BbW91bnQgPCBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXS5taW5DYXAgJiYgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgIC8vIHRva2VuQW1vdW50IDwgbWluQ2FwIGZvciBpbnZlc3RvcgogICAgICAgIHRocm93OwogICAgICB9CiAgICAgIGlmKHRva2VuQW1vdW50ID4gZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0ubWF4Q2FwKSB7CiAgICAgICAgLy8gdG9rZW5BbW91bnQgPiBtYXhDYXAgZm9yIGludmVzdG9yCiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGludmVzdG9yJ3MgY2FwCiAgICAgIGlmIChpc0JyZWFraW5nSW52ZXN0b3JDYXAocmVjZWl2ZXIsIHRva2VuQW1vdW50KSkgewogICAgICAgIHRocm93OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZih0b2tlbkFtb3VudCA8IHRva2VuLm1pbkNhcCgpICYmIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgfQogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgaWYoaXNCcmVha2luZ0NhcCh3ZWlBbW91bnQsIHRva2VuQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7CiAgICAgIHRocm93OwogICAgfQogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwogICAgaWYocHJpY2luZ1N0cmF0ZWd5LmlzUHJlc2FsZVB1cmNoYXNlKHJlY2VpdmVyKSkgewogICAgICAgIHByZXNhbGVXZWlSYWlzZWQgPSBwcmVzYWxlV2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIH0KICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogICAgLy8gUG9ja2V0IHRoZSBtb25leQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7CiAgICBpZiAoaXNXaGl0ZUxpc3RlZCkgewogICAgICB1aW50IG51bSA9IDA7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMgPT0gam9pbmVkQ3Jvd2RzYWxlc1tpXSkgCiAgICAgICAgICBudW0gPSBpOwogICAgICB9CiAgICAgIGlmIChudW0gKyAxIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbikgewogICAgICAgIGZvciAodmFyIGogPSBudW0gKyAxOyBqIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaisrKSB7CiAgICAgICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICAgICAgY3Jvd2RzYWxlLnVwZGF0ZUVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChtc2cuc2VuZGVyLCB0aGlzLCB0b2tlbkFtb3VudCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwogIH0KICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogSW52ZXN0b3IgY291bnQgaXMgbm90IGhhbmRsZWQ7IGl0IGlzIGFzc3VtZWQgdGhpcyBnb2VzIGZvciBtdWx0aXBsZSBpbnZlc3RvcnMKICAgKiBhbmQgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBoYXBwZW5zIG91dHNpZGUgdGhlIHNtYXJ0IGNvbnRyYWN0IGZsb3cuCiAgICoKICAgKiBObyBtb25leSBpcyBleGNoYW5nZWQsIGFzIHRoZSBjcm93ZHNhbGUgdGVhbSBhbHJlYWR5IGhhdmUgcmVjZWl2ZWQgdGhlIHBheW1lbnQuCiAgICoKICAgKiBAcGFyYW0gZnVsbFRva2VucyB0b2tlbnMgYXMgZnVsbCB0b2tlbnMgLSBkZWNpbWFsIHBsYWNlcyBhZGRlZCBpbnRlcm5hbGx5CiAgICogQHBhcmFtIHdlaVByaWNlIFByaWNlIG9mIGEgc2luZ2xlIGZ1bGwgdG9rZW4gaW4gd2VpCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMgKiAxMCoqdG9rZW4uZGVjaW1hbHMoKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UgKiBmdWxsVG9rZW5zOyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIDApOwogIH0KICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYoYWRkcik7CiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsKICAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KICAvKioKICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIGFkZHIpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVDdXN0b21lcklkKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIG5lZWRzIHRvIHRyYWNrIHBhcnRpY2lwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgMCk7CiAgfQogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIgYW5kIGNsZWFyIGhpcyBhZGRyZXNzLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOwogIH0KICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdChtc2cuc2VuZGVyKTsKICB9CiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQKICAgIGlmKGZpbmFsaXplZCkgewogICAgICB0aHJvdzsKICAgIH0KICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsKICAgIH0KICAgIGZpbmFsaXplZCA9IHRydWU7CiAgfQogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgZmluYWxpemUgYWdlbnQuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsKICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOwogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQKICAgIGlmKCFmaW5hbGl6ZUFnZW50LmlzRmluYWxpemVBZ2VudCgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBfc2lnbmVyQWRkcmVzczsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKgogICAqIFRPRE86IEZpeCBzcGVsbGluZyBlcnJvciBpbiB0aGUgbmFtZQogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzLCB1aW50IG1pbkNhcCwgdWludCBtYXhDYXApIG9ubHlPd25lciB7CiAgICBpZiAoIWlzV2hpdGVMaXN0ZWQpIHRocm93OwogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IFdoaXRlTGlzdERhdGEoe3N0YXR1czpzdGF0dXMsIG1pbkNhcDptaW5DYXAsIG1heENhcDptYXhDYXB9KTsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudHNXaGl0ZWxpc3QoYWRkcmVzc1tdIGFkZHJzLCBib29sW10gc3RhdHVzZXMsIHVpbnRbXSBtaW5DYXBzLCB1aW50W10gbWF4Q2Fwcykgb25seU93bmVyIHsKICAgIGlmICghaXNXaGl0ZUxpc3RlZCkgdGhyb3c7CiAgICBmb3IgKHVpbnQgaXRlcmF0b3IgPSAwOyBpdGVyYXRvciA8IGFkZHJzLmxlbmd0aDsgaXRlcmF0b3IrKykgewogICAgICBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcnNbaXRlcmF0b3JdLCBzdGF0dXNlc1tpdGVyYXRvcl0sIG1pbkNhcHNbaXRlcmF0b3JdLCBtYXhDYXBzW2l0ZXJhdG9yXSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHVwZGF0ZUVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGFkZHJlc3MgY29udHJhY3RBZGRyLCB1aW50IHRva2Vuc0JvdWdodCkgewogICAgaWYgKHRva2Vuc0JvdWdodCA8IGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0ubWluQ2FwKSB0aHJvdzsKICAgIGlmICghaXNXaGl0ZUxpc3RlZCkgdGhyb3c7CiAgICBpZiAoYWRkciAhPSBtc2cuc2VuZGVyICYmIGNvbnRyYWN0QWRkciAhPSBtc2cuc2VuZGVyKSB0aHJvdzsKICAgIHVpbnQgbmV3TWF4Q2FwID0gZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5tYXhDYXA7CiAgICBuZXdNYXhDYXAgPSBuZXdNYXhDYXAubWludXModG9rZW5zQm91Z2h0KTsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBXaGl0ZUxpc3REYXRhKHtzdGF0dXM6ZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5zdGF0dXMsIG1pbkNhcDowLCBtYXhDYXA6bmV3TWF4Q2FwfSk7CiAgfQogIGZ1bmN0aW9uIHVwZGF0ZUpvaW5lZENyb3dkc2FsZXMoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgewogICAgam9pbmVkQ3Jvd2RzYWxlc1tqb2luZWRDcm93ZHNhbGVzTGVuKytdID0gYWRkcjsKICB9CiAgZnVuY3Rpb24gc2V0TGFzdENyb3dkc2FsZShhZGRyZXNzIGFkZHIpIG9ubHlPd25lciB7CiAgICBsYXN0Q3Jvd2RzYWxlID0gYWRkcjsKICB9CiAgZnVuY3Rpb24gY2xlYXJKb2luZWRDcm93ZHNhbGVzKCkgb25seU93bmVyIHsKICAgIGpvaW5lZENyb3dkc2FsZXNMZW4gPSAwOwogIH0KICBmdW5jdGlvbiB1cGRhdGVKb2luZWRDcm93ZHNhbGVzTXVsdGlwbGUoYWRkcmVzc1tdIGFkZHJzKSBvbmx5T3duZXIgewogICAgY2xlYXJKb2luZWRDcm93ZHNhbGVzKCk7CiAgICBmb3IgKHVpbnQgaXRlciA9IDA7IGl0ZXIgPCBhZGRycy5sZW5ndGg7IGl0ZXIrKykgewogICAgICBpZihqb2luZWRDcm93ZHNhbGVzTGVuID09IGpvaW5lZENyb3dkc2FsZXMubGVuZ3RoKSB7CiAgICAgICAgICBqb2luZWRDcm93ZHNhbGVzLmxlbmd0aCArPSAxOwogICAgICB9CiAgICAgIGpvaW5lZENyb3dkc2FsZXNbam9pbmVkQ3Jvd2RzYWxlc0xlbisrXSA9IGFkZHJzW2l0ZXJdOwogICAgICBpZiAoaXRlciA9PSBhZGRycy5sZW5ndGggLSAxKQogICAgICAgIHNldExhc3RDcm93ZHNhbGUoYWRkcnNbaXRlcl0pOwogICAgfQogIH0KICBmdW5jdGlvbiBzZXRTdGFydHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7CiAgICBpZiAoZmluYWxpemVkKSB0aHJvdzsKICAgIGlmICghaXNVcGRhdGFibGUpIHRocm93OwogICAgaWYobm93ID4gdGltZSkgewogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QKICAgIH0KICAgIGlmKHRpbWUgPiBlbmRzQXQpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBDcm93ZHNhbGVFeHQgbGFzdENyb3dkc2FsZUNudHJjdCA9IENyb3dkc2FsZUV4dChsYXN0Q3Jvd2RzYWxlKTsKICAgIGlmIChsYXN0Q3Jvd2RzYWxlQ250cmN0LmZpbmFsaXplZCgpKSB0aHJvdzsKICAgIHN0YXJ0c0F0ID0gdGltZTsKICAgIFN0YXJ0c0F0Q2hhbmdlZChzdGFydHNBdCk7CiAgfQogIC8qKgogICAqIEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjbG9zZSBlYXJseSBvciBleHRlbmQgdGhlIGNyb3dkc2FsZS4KICAgKgogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOgogICAqIC0gYWZ0ZXIgWCBhbW91bnQgaXMgcmVhY2hlZCBkZXRlcm1pbmUgbWFudWFsIGNsb3NpbmcKICAgKgogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsCiAgICogYnV0IHdlIHRydXN0IG93bmVycyBrbm93IHdoYXQgdGhleSBhcmUgZG9pbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRFbmRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgewogICAgaWYgKGZpbmFsaXplZCkgdGhyb3c7CiAgICBpZiAoIWlzVXBkYXRhYmxlKSB0aHJvdzsKICAgIGlmKG5vdyA+IHRpbWUpIHsKICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0CiAgICB9CiAgICBpZihzdGFydHNBdCA+IHRpbWUpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBDcm93ZHNhbGVFeHQgbGFzdENyb3dkc2FsZUNudHJjdCA9IENyb3dkc2FsZUV4dChsYXN0Q3Jvd2RzYWxlKTsKICAgIGlmIChsYXN0Q3Jvd2RzYWxlQ250cmN0LmZpbmFsaXplZCgpKSB0aHJvdzsKICAgIHVpbnQgbnVtID0gMDsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaSsrKSB7CiAgICAgIGlmICh0aGlzID09IGpvaW5lZENyb3dkc2FsZXNbaV0pIAogICAgICAgIG51bSA9IGk7CiAgICB9CiAgICBpZiAobnVtICsgMSA8IGpvaW5lZENyb3dkc2FsZXNMZW4pIHsKICAgICAgZm9yICh2YXIgaiA9IG51bSArIDE7IGogPCBqb2luZWRDcm93ZHNhbGVzTGVuOyBqKyspIHsKICAgICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICAgIGlmICh0aW1lID4gY3Jvd2RzYWxlLnN0YXJ0c0F0KCkpIHRocm93OwogICAgICB9CiAgICB9CiAgICBlbmRzQXQgPSB0aW1lOwogICAgRW5kc0F0Q2hhbmdlZChlbmRzQXQpOwogIH0KICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgewogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQogIC8qKgogICAqIEFsbG93IHRvIGNoYW5nZSB0aGUgdGVhbSBtdWx0aXNpZyBhZGRyZXNzIGluIHRoZSBjYXNlIG9mIGVtZXJnZW5jeS4KICAgKgogICAqIFRoaXMgYWxsb3dzIHRvIHNhdmUgYSBkZXBsb3llZCBjcm93ZHNhbGUgd2FsbGV0IGluIHRoZSBjYXNlIHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgYmVndW4KICAgKiAod2UgaGF2ZSBkb25lIG9ubHkgZmV3IHRlc3QgdHJhbnNhY3Rpb25zKS4gQWZ0ZXIgdGhlIGNyb3dkc2FsZSBpcyBnb2luZwogICAqIHRoZW4gbXVsdGlzaWcgYWRkcmVzcyBzdGF5cyBsb2NrZWQgZm9yIHRoZSBzYWZldHkgcmVhc29ucy4KICAgKi8KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgLy8gQ2hhbmdlCiAgICBpZihpbnZlc3RvckNvdW50ID4gTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQogIC8qKgogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4KICAgKgogICAqIFRoZSB0ZWFtIGNhbiB0cmFuc2ZlciB0aGUgZnVuZHMgYmFjayBvbiB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIGNhc2UgdGhlIG1pbmltdW0gZ29hbCB3YXMgbm90IHJlYWNoZWQuLgogICAqLwogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSBpblN0YXRlKFN0YXRlLkZhaWx1cmUpIHsKICAgIGlmKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsKICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5wbHVzKG1zZy52YWx1ZSk7CiAgfQogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqCiAgICogTm90ZSB0aGF0IGFueSByZWZ1bmRzIGZyb20gcHJveHkgYnV5ZXJzIHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHksCiAgICogYW5kIG5vdCB0aHJvdWdoIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsKICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsKICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOwogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsKICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7CiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93OwogIH0KICAvKioKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLgogICAqLwogIGZ1bmN0aW9uIGlzRmluYWxpemVyU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBmaW5hbGl6ZUFnZW50LmlzU2FuZSgpOwogIH0KICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOwogIH0KICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLwogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgewogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7CiAgfQogIC8qKiBJbnRlcmZhY2UgbWFya2VyLiAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICAvLwogIC8vIE1vZGlmaWVycwogIC8vCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93OwogICAgXzsKICB9CiAgLy8KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMKICAvLwogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLgogICAqCiAgICoKICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLgogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkKICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4KICAgKgogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsKICBmdW5jdGlvbiBpc0JyZWFraW5nSW52ZXN0b3JDYXAoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4KICAgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgcHJpdmF0ZTsKfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIFN0YW5kYXJkIEVSQzIwIHRva2VuIHdpdGggU2hvcnQgSGFuZCBBdHRhY2sgYW5kIGFwcHJvdmUoKSByYWNlIGNvbmRpdGlvbiBtaXRpZ2F0aW9uLgogKgogKiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggewogIC8qIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwogIC8qIEFjdHVhbCBiYWxhbmNlcyBvZiB0b2tlbiBob2xkZXJzICovCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogIC8qIGFwcHJvdmUoKSBhbGxvd2FuY2VzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwogIC8qIEludGVyZmFjZSBkZWNsYXJhdGlvbiAqLwogIGZ1bmN0aW9uIGlzVG9rZW4oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB3ZUFyZSkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgdGhyb3c7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLgogKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKICB1aW50IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsKICAvKiogSW50ZXJmYWNlIG1hcmtlciAqLwogIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwp9Ci8qKgogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucyB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4KICoKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKICAvKiogSG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdXBncmFkZWQgYnkgbm93LiAqLwogIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CiAgLyoqCiAgICogVXBncmFkZSBzdGF0ZXMuCiAgICoKICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogVG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldAogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0CiAgICogLSBVcGdyYWRpbmc6IFVwZ3JhZGUgYWdlbnQgaXMgc2V0IGFuZCB0aGUgYmFsYW5jZSBob2xkZXJzIGNhbiB1cGdyYWRlIHRoZWlyIHRva2VucwogICAqCiAgICovCiAgZW51bSBVcGdyYWRlU3RhdGUge1Vua25vd24sIE5vdEFsbG93ZWQsIFdhaXRpbmdGb3JBZ2VudCwgUmVhZHlUb1VwZ3JhZGUsIFVwZ3JhZGluZ30KICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgLyoqCiAgICogTmV3IHVwZ3JhZGUgYWdlbnQgYXZhaWxhYmxlLgogICAqLwogIGV2ZW50IFVwZ3JhZGVBZ2VudFNldChhZGRyZXNzIGFnZW50KTsKICAvKioKICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBtYXN0ZXIgc2V0LgogICAqLwogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBfdXBncmFkZU1hc3RlcikgewogICAgdXBncmFkZU1hc3RlciA9IF91cGdyYWRlTWFzdGVyOwogIH0KICAvKioKICAgKiBBbGxvdyB0aGUgdG9rZW4gaG9sZGVyIHRvIHVwZ3JhZGUgc29tZSBvZiB0aGVpciB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgewogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgaWYoIShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykpIHsKICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgICAvLyBWYWxpZGF0ZSBpbnB1dCB2YWx1ZS4KICAgICAgaWYgKHZhbHVlID09IDApIHRocm93OwogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHZhbHVlKTsKICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7CiAgICAgIHRvdGFsVXBncmFkZWQgPSBzYWZlQWRkKHRvdGFsVXBncmFkZWQsIHZhbHVlKTsKICAgICAgLy8gVXBncmFkZSBhZ2VudCByZWlzc3VlcyB0aGUgdG9rZW5zCiAgICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAgIFVwZ3JhZGUobXNnLnNlbmRlciwgdXBncmFkZUFnZW50LCB2YWx1ZSk7CiAgfQogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcwogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVBZ2VudChhZGRyZXNzIGFnZW50KSBleHRlcm5hbCB7CiAgICAgIGlmKCFjYW5VcGdyYWRlKCkpIHsKICAgICAgICAvLyBUaGUgdG9rZW4gaXMgbm90IHlldCBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgdXBncmFkaW5nCiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgICAgaWYgKGFnZW50ID09IDB4MCkgdGhyb3c7CiAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBhZ2VudAogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsKICAgICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQKICAgICAgaWYgKGdldFVwZ3JhZGVTdGF0ZSgpID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpIHRocm93OwogICAgICB1cGdyYWRlQWdlbnQgPSBVcGdyYWRlQWdlbnQoYWdlbnQpOwogICAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICAgIGlmKCF1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgdGhyb3c7CiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7CiAgICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOwogIH0KICAvKioKICAgKiBHZXQgdGhlIHN0YXRlIG9mIHRoZSB0b2tlbiB1cGdyYWRlLgogICAqLwogIGZ1bmN0aW9uIGdldFVwZ3JhZGVTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKFVwZ3JhZGVTdGF0ZSkgewogICAgaWYoIWNhblVwZ3JhZGUoKSkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5Ob3RBbGxvd2VkOwogICAgZWxzZSBpZihhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsKICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgfQogIC8qKgogICAqIENoYW5nZSB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICoKICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBwdWJsaWMgewogICAgICBpZiAobWFzdGVyID09IDB4MCkgdGhyb3c7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OwogICAgICB1cGdyYWRlTWFzdGVyID0gbWFzdGVyOwogIH0KICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gZW5hYmxlIHRvIHByb3ZpZGUgdGhlIGNvbmRpdGlvbiB3aGVuIHRoZSB1cGdyYWRlIGNhbiBiZWd1bi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgIHJldHVybiB0cnVlOwogIH0KfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qKgogKiBEZWZpbmUgaW50ZXJmYWNlIGZvciByZWxlYXNpbmcgdGhlIHRva2VuIHRyYW5zZmVyIGFmdGVyIGEgc3VjY2Vzc2Z1bCBjcm93ZHNhbGUuCiAqLwpjb250cmFjdCBSZWxlYXNhYmxlVG9rZW4gaXMgRVJDMjAsIE93bmFibGUgewogIC8qIFRoZSBmaW5hbGl6ZXIgY29udHJhY3QgdGhhdCBhbGxvd3MgdW5saWZ0IHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLwogIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwogIC8qKiBNYXAgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zIHJlZ2FyZGxlc3Mgb2YgdGhlIGxvY2sgZG93biBwZXJpb2QuIFRoZXNlIGFyZSBjcm93ZHNhbGUgY29udHJhY3RzIGFuZCBwb3NzaWJsZSB0aGUgdGVhbSBtdWx0aXNpZyBpdHNlbGYuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdHJhbnNmZXJBZ2VudHM7CiAgLyoqCiAgICogTGltaXQgdG9rZW4gdHJhbnNmZXIgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAqCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyKSB7CiAgICBpZighcmVsZWFzZWQpIHsKICAgICAgICBpZighdHJhbnNmZXJBZ2VudHNbX3NlbmRlcl0pIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQogICAgXzsKICB9CiAgLyoqCiAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgKgogICAqIERlc2lnbiBjaG9pY2UuIEFsbG93IHJlc2V0IHRoZSByZWxlYXNlIGFnZW50IHRvIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLgogICAqLwogIGZ1bmN0aW9uIHNldFJlbGVhc2VBZ2VudChhZGRyZXNzIGFkZHIpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKICAgIC8vIFdlIGRvbid0IGRvIGludGVyZmFjZSBjaGVjayBoZXJlIGFzIHdlIG1pZ2h0IHdhbnQgdG8gYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudAogICAgcmVsZWFzZUFnZW50ID0gYWRkcjsKICB9CiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLgogICAqLwogIGZ1bmN0aW9uIHNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICB0cmFuc2ZlckFnZW50c1thZGRyXSA9IHN0YXRlOwogIH0KICAvKioKICAgKiBPbmUgd2F5IGZ1bmN0aW9uIHRvIHJlbGVhc2UgdGhlIHRva2VucyB0byB0aGUgd2lsZC4KICAgKgogICAqIENhbiBiZSBjYWxsZWQgb25seSBmcm9tIHRoZSByZWxlYXNlIGFnZW50IHRoYXQgaXMgdGhlIGZpbmFsIElDTyBjb250cmFjdC4gSXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBzdWNjZXNzIChmaXJzdCBtaWxlc3RvbmUgcmVhY2hlZCkuCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICByZWxlYXNlZCA9IHRydWU7CiAgfQogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJlZm9yZSBvciBhZnRlciB0aGUgdG9rZW5zIGhhdmUgYmVlbiByZWxlYXNlc2QgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgaWYocmVsZWFzZVN0YXRlICE9IHJlbGVhc2VkKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gcmVsZWFzZUFnZW50KSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20pIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIEEgdG9rZW4gdGhhdCBjYW4gaW5jcmVhc2UgaXRzIHN1cHBseSBieSBhbm90aGVyIGNvbnRyYWN0LgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIGNvbnRyYWN0cyB3aGl0ZWxpc3RlZCBieSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW5FeHQgaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGhMaWJFeHQgZm9yIHVpbnQ7CiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50QWdlbnRzOwogIGV2ZW50IE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlICApOwogIHN0cnVjdCBSZXNlcnZlZFRva2Vuc0RhdGEgewogICAgdWludCBpblRva2VuczsKICAgIHVpbnQgaW5QZXJjZW50YWdlOwogIH0KICBtYXBwaW5nIChhZGRyZXNzID0+IFJlc2VydmVkVG9rZW5zRGF0YSkgcHVibGljIHJlc2VydmVkVG9rZW5zTGlzdDsKICBhZGRyZXNzW10gcHVibGljIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zOwogIHVpbnQgcHVibGljIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zTGVuID0gMDsKICBmdW5jdGlvbiBzZXRSZXNlcnZlZFRva2Vuc0xpc3QoYWRkcmVzcyBhZGRyLCB1aW50IGluVG9rZW5zLCB1aW50IGluUGVyY2VudGFnZSkgb25seU93bmVyIHsKICAgIHJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zLnB1c2goYWRkcik7CiAgICByZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0xlbisrOwogICAgcmVzZXJ2ZWRUb2tlbnNMaXN0W2FkZHJdID0gUmVzZXJ2ZWRUb2tlbnNEYXRhKHtpblRva2VuczppblRva2VucywgaW5QZXJjZW50YWdlOmluUGVyY2VudGFnZX0pOwogIH0KICBmdW5jdGlvbiBnZXRSZXNlcnZlZFRva2Vuc0xpc3RWYWxJblRva2VucyhhZGRyZXNzIGFkZHIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5Ub2tlbnMpIHsKICAgIHJldHVybiByZXNlcnZlZFRva2Vuc0xpc3RbYWRkcl0uaW5Ub2tlbnM7CiAgfQogIGZ1bmN0aW9uIGdldFJlc2VydmVkVG9rZW5zTGlzdFZhbEluUGVyY2VudGFnZShhZGRyZXNzIGFkZHIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5QZXJjZW50YWdlKSB7CiAgICByZXR1cm4gcmVzZXJ2ZWRUb2tlbnNMaXN0W2FkZHJdLmluUGVyY2VudGFnZTsKICB9CiAgZnVuY3Rpb24gc2V0UmVzZXJ2ZWRUb2tlbnNMaXN0TXVsdGlwbGUoYWRkcmVzc1tdIGFkZHJzLCB1aW50W10gaW5Ub2tlbnMsIHVpbnRbXSBpblBlcmNlbnRhZ2UpIG9ubHlPd25lciB7CiAgICBmb3IgKHVpbnQgaXRlcmF0b3IgPSAwOyBpdGVyYXRvciA8IGFkZHJzLmxlbmd0aDsgaXRlcmF0b3IrKykgewogICAgICBzZXRSZXNlcnZlZFRva2Vuc0xpc3QoYWRkcnNbaXRlcmF0b3JdLCBpblRva2Vuc1tpdGVyYXRvcl0sIGluUGVyY2VudGFnZVtpdGVyYXRvcl0pOwogICAgfQogIH0KICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLi4KICAgKgogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwogICAgLy8gVGhpcyB3aWxsIG1ha2UgdGhlIG1pbnQgdHJhbnNhY3Rpb24gYXBwZXIgaW4gRXRoZXJTY2FuLmlvCiAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgYWZ0ZXIgdGhlcmUgaXMgYSBzdGFuZGFyZGl6ZWQgbWludGluZyBldmVudAogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIGNyb3dkc2FsZSBjb250cmFjdCB0byBtaW50IG5ldyB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TWludEFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHsKICAgIG1pbnRBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICAgIE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkciwgc3RhdGUpOwogIH0KICBtb2RpZmllciBvbmx5TWludEFnZW50KCkgewogICAgLy8gT25seSBjcm93ZHNhbGUgY29udHJhY3RzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQogIC8qKiBNYWtlIHN1cmUgd2UgYXJlIG5vdCBkb25lIHlldC4gKi8KICBtb2RpZmllciBjYW5NaW50KCkgewogICAgaWYobWludGluZ0ZpbmlzaGVkKSB0aHJvdzsKICAgIF87CiAgfQp9Ci8qKgogKiBBIGNyb3dkc2FsZWQgdG9rZW4uCiAqCiAqIEFuIEVSQy0yMCB0b2tlbiBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIGNyb3dkc2FsZXMgd2l0aCBpbnZlc3RvciBwcm90ZWN0aW9uIGFuZCBmdXJ0aGVyIGRldmVsb3BtZW50IHBhdGguCiAqCiAqIC0gVGhlIHRva2VuIHRyYW5zZmVyKCkgaXMgZGlzYWJsZWQgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyCiAqIC0gVGhlIHRva2VuIGNvbnRyYWN0IGdpdmVzIGFuIG9wdC1pbiB1cGdyYWRlIHBhdGggdG8gYSBuZXcgY29udHJhY3QKICogLSBUaGUgc2FtZSB0b2tlbiBjYW4gYmUgcGFydCBvZiBzZXZlcmFsIGNyb3dkc2FsZXMgdGhyb3VnaCBhcHByb3ZlKCkgbWVjaGFuaXNtCiAqIC0gVGhlIHRva2VuIGNhbiBiZSBjYXBwZWQgKHN1cHBseSBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yKSBvciB1bmNhcHBlZCAoY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiBtaW50IG5ldyB0b2tlbnMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVUb2tlbkV4dCBpcyBSZWxlYXNhYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW5FeHQsIFVwZ3JhZGVhYmxlVG9rZW4gewogIC8qKiBOYW1lIGFuZCBzeW1ib2wgd2VyZSB1cGRhdGVkLiAqLwogIGV2ZW50IFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBuZXdOYW1lLCBzdHJpbmcgbmV3U3ltYm9sKTsKICBzdHJpbmcgcHVibGljIG5hbWU7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgdWludCBwdWJsaWMgZGVjaW1hbHM7CiAgLyogTWluaW11bSBhbW1vdW50IG9mIHRva2VucyBldmVyeSBidXllciBjYW4gYnV5LiAqLwogIHVpbnQgcHVibGljIG1pbkNhcDsKICAvKioKICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLgogICAqCiAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAqCiAgICogQHBhcmFtIF9uYW1lIFRva2VuIG5hbWUKICAgKiBAcGFyYW0gX3N5bWJvbCBUb2tlbiBzeW1ib2wgLSBzaG91bGQgYmUgYWxsIGNhcHMKICAgKiBAcGFyYW0gX2luaXRpYWxTdXBwbHkgSG93IG1hbnkgdG9rZW5zIHdlIHN0YXJ0IHdpdGgKICAgKiBAcGFyYW0gX2RlY2ltYWxzIE51bWJlciBvZiBkZWNpbWFsIHBsYWNlcwogICAqIEBwYXJhbSBfbWludGFibGUgQXJlIG5ldyB0b2tlbnMgY3JlYXRlZCBvdmVyIHRoZSBjcm93ZHNhbGUgb3IgZG8gd2UgZGlzdHJpYnV0ZSBvbmx5IHRoZSBpbml0aWFsIHN1cHBseT8gTm90ZSB0aGF0IHdoZW4gdGhlIHRva2VuIGJlY29tZXMgdHJhbnNmZXJhYmxlIHRoZSBtaW50aW5nIGFsd2F5cyBlbmRzLgogICAqLwogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuRXh0KHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQgX2luaXRpYWxTdXBwbHksIHVpbnQgX2RlY2ltYWxzLCBib29sIF9taW50YWJsZSwgdWludCBfZ2xvYmFsTWluQ2FwKQogICAgVXBncmFkZWFibGVUb2tlbihtc2cuc2VuZGVyKSB7CiAgICAvLyBDcmVhdGUgYW55IGFkZHJlc3MsIGNhbiBiZSB0cmFuc2ZlcnJlZAogICAgLy8gdG8gdGVhbSBtdWx0aXNpZyB2aWEgY2hhbmdlT3duZXIoKSwKICAgIC8vIGFsc28gcmVtZW1iZXIgdG8gY2FsbCBzZXRVcGdyYWRlTWFzdGVyKCkKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIG5hbWUgPSBfbmFtZTsKICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5OwogICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICBtaW5DYXAgPSBfZ2xvYmFsTWluQ2FwOwogICAgLy8gQ3JlYXRlIGluaXRpYWxseSBhbGwgYmFsYW5jZSBvbiB0aGUgdGVhbSBtdWx0aXNpZwogICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHk7CiAgICBpZih0b3RhbFN1cHBseSA+IDApIHsKICAgICAgTWludGVkKG93bmVyLCB0b3RhbFN1cHBseSk7CiAgICB9CiAgICAvLyBObyBtb3JlIG5ldyBzdXBwbHkgYWxsb3dlZCBhZnRlciB0aGUgdG9rZW4gY3JlYXRpb24KICAgIGlmKCFfbWludGFibGUpIHsKICAgICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgICAgaWYodG90YWxTdXBwbHkgPT0gMCkgewogICAgICAgIHRocm93OyAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBXaGVuIHRva2VuIGlzIHJlbGVhc2VkIHRvIGJlIHRyYW5zZmVyYWJsZSwgZW5mb3JjZSBubyBuZXcgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQogIC8qKgogICAqIEFsbG93IHVwZ3JhZGUgYWdlbnQgZnVuY3Rpb25hbGl0eSBraWNrIGluIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSB3YXMgc3VjY2Vzcy4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHJlbGVhc2VkICYmIHN1cGVyLmNhblVwZ3JhZGUoKTsKICB9CiAgLyoqCiAgICogT3duZXIgY2FuIHVwZGF0ZSB0b2tlbiBpbmZvcm1hdGlvbiBoZXJlLgogICAqCiAgICogSXQgaXMgb2Z0ZW4gdXNlZnVsIHRvIGNvbmNlYWwgdGhlIGFjdHVhbCB0b2tlbiBhc3NvY2lhdGlvbiwgdW50aWwKICAgKiB0aGUgdG9rZW4gb3BlcmF0aW9ucywgbGlrZSBjZW50cmFsIGlzc3VhbmNlIG9yIHJlaXNzdWFuY2UgaGF2ZSBiZWVuIGNvbXBsZXRlZC4KICAgKgogICAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHRoZSB0b2tlbiBvd25lciB0byByZW5hbWUgdGhlIHRva2VuIGFmdGVyIHRoZSBvcGVyYXRpb25zCiAgICogaGF2ZSBiZWVuIGNvbXBsZXRlZCBhbmQgdGhlbiBwb2ludCB0aGUgYXVkaWVuY2UgdG8gdXNlIHRoZSB0b2tlbiBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIG9ubHlPd25lciB7CiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24obmFtZSwgc3ltYm9sKTsKICB9Cn0KLyoqCiAqIFRoZSBkZWZhdWx0IGJlaGF2aW9yIGZvciB0aGUgY3Jvd2RzYWxlIGVuZC4KICoKICogVW5sb2NrIHRva2Vucy4KICovCmNvbnRyYWN0IFJlc2VydmVkVG9rZW5zRmluYWxpemVBZ2VudCBpcyBGaW5hbGl6ZUFnZW50IHsKICB1c2luZyBTYWZlTWF0aExpYkV4dCBmb3IgdWludDsKICBDcm93ZHNhbGVUb2tlbkV4dCBwdWJsaWMgdG9rZW47CiAgQ3Jvd2RzYWxlRXh0IHB1YmxpYyBjcm93ZHNhbGU7CiAgZnVuY3Rpb24gUmVzZXJ2ZWRUb2tlbnNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZVRva2VuRXh0IF90b2tlbiwgQ3Jvd2RzYWxlRXh0IF9jcm93ZHNhbGUpIHsKICAgIHRva2VuID0gX3Rva2VuOwogICAgY3Jvd2RzYWxlID0gX2Nyb3dkc2FsZTsKICB9CiAgLyoqIENoZWNrIHRoYXQgd2UgY2FuIHJlbGVhc2UgdGhlIHRva2VuICovCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiAodG9rZW4ucmVsZWFzZUFnZW50KCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgfQogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHB1YmxpYyB7CiAgICBpZihtc2cuc2VuZGVyICE9IGFkZHJlc3MoY3Jvd2RzYWxlKSkgewogICAgICB0aHJvdzsKICAgIH0KICAgIC8vIEhvdyBtYW55ICUgb2YgdG9rZW5zIHRoZSBmb3VuZGVycyBhbmQgb3RoZXJzIGdldAogICAgdWludCB0b2tlbnNTb2xkID0gY3Jvd2RzYWxlLnRva2Vuc1NvbGQoKTsKICAgIC8vIG1vdmUgcmVzZXJ2ZWQgdG9rZW5zIGluIHBlcmNlbnRhZ2UKICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnNMZW4oKTsgaisrKSB7CiAgICAgIHVpbnQgYWxsb2NhdGVkQm9udXNJblBlcmNlbnRhZ2U7CiAgICAgIGlmICh0b2tlbi5nZXRSZXNlcnZlZFRva2Vuc0xpc3RWYWxJblBlcmNlbnRhZ2UodG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnMoaikpID4gMCkgewogICAgICAgIGFsbG9jYXRlZEJvbnVzSW5QZXJjZW50YWdlID0gdG9rZW5zU29sZCp0b2tlbi5nZXRSZXNlcnZlZFRva2Vuc0xpc3RWYWxJblBlcmNlbnRhZ2UodG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnMoaikpLzEwMDsKICAgICAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKGFsbG9jYXRlZEJvbnVzSW5QZXJjZW50YWdlKTsKICAgICAgICB0b2tlbi5taW50KHRva2VuLnJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zKGopLCBhbGxvY2F0ZWRCb251c0luUGVyY2VudGFnZSk7CiAgICAgIH0KICAgIH0KICAgIC8vIG1vdmUgcmVzZXJ2ZWQgdG9rZW5zIGluIHRva2VucwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbi5yZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9uc0xlbigpOyBpKyspIHsKICAgICAgdWludCBhbGxvY2F0ZWRCb251c0luVG9rZW5zOwogICAgICBpZiAodG9rZW4uZ2V0UmVzZXJ2ZWRUb2tlbnNMaXN0VmFsSW5Ub2tlbnModG9rZW4ucmVzZXJ2ZWRUb2tlbnNEZXN0aW5hdGlvbnMoaSkpID4gMCkgewogICAgICAgIGFsbG9jYXRlZEJvbnVzSW5Ub2tlbnMgPSB0b2tlbi5nZXRSZXNlcnZlZFRva2Vuc0xpc3RWYWxJblRva2Vucyh0b2tlbi5yZXNlcnZlZFRva2Vuc0Rlc3RpbmF0aW9ucyhpKSk7CiAgICAgICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyhhbGxvY2F0ZWRCb251c0luVG9rZW5zKTsKICAgICAgICB0b2tlbi5taW50KHRva2VuLnJlc2VydmVkVG9rZW5zRGVzdGluYXRpb25zKGkpLCBhbGxvY2F0ZWRCb251c0luVG9rZW5zKTsKICAgICAgfQogICAgfQogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICB9Cn0='.
	

]
