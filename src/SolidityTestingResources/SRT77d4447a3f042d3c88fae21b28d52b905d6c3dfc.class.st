Class {
	#name : #SRT77d4447a3f042d3c88fae21b28d52b905d6c3dfc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT77d4447a3f042d3c88fae21b28d52b905d6c3dfc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBBY2Nlc3NDb250cm9sIHsKICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3JBZGRyZXNzOwogICAgdWludDE2IHB1YmxpYyB0b3RhbFNlcmFwaGltcyA9IDA7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBzZXJhcGhpbXM7CgogICAgYm9vbCBwdWJsaWMgaXNNYWludGVuYW5jZU1vZGUgPSB0cnVlOwogCiAgICBtb2RpZmllciBvbmx5Q1JFQVRPUigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3JlYXRvckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNFUkFQSElNKCkgewogICAgICAgIHJlcXVpcmUoc2VyYXBoaW1zW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlzQ29udHJhY3RBY3RpdmUgewogICAgICAgIHJlcXVpcmUoIWlzTWFpbnRlbmFuY2VNb2RlKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgY3JlYXRvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCgogICAgZnVuY3Rpb24gYWRkU0VSQVBISU0oYWRkcmVzcyBfbmV3U2VyYXBoaW0pIG9ubHlDUkVBVE9SIHB1YmxpYyB7CiAgICAgICAgaWYgKHNlcmFwaGltc1tfbmV3U2VyYXBoaW1dID09IGZhbHNlKSB7CiAgICAgICAgICAgIHNlcmFwaGltc1tfbmV3U2VyYXBoaW1dID0gdHJ1ZTsKICAgICAgICAgICAgdG90YWxTZXJhcGhpbXMgKz0gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZVNFUkFQSElNKGFkZHJlc3MgX29sZFNlcmFwaGltKSBvbmx5Q1JFQVRPUiBwdWJsaWMgewogICAgICAgIGlmIChzZXJhcGhpbXNbX29sZFNlcmFwaGltXSA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlcmFwaGltc1tfb2xkU2VyYXBoaW1dID0gZmFsc2U7CiAgICAgICAgICAgIHRvdGFsU2VyYXBoaW1zIC09IDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZU1haW50ZW5hbmNlTW9kZShib29sIF9pc01haW50YWluaW5nKSBvbmx5Q1JFQVRPUiBwdWJsaWMgewogICAgICAgIGlzTWFpbnRlbmFuY2VNb2RlID0gX2lzTWFpbnRhaW5pbmc7CiAgICB9CgogIAp9IAoKY29udHJhY3QgU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IHgsIHVpbnQgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgdWludCB6ID0geCArIHk7CiAgICAgIGFzc2VydCgoeiA+PSB4KSAmJiAoeiA+PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWJ0cmFjdCh1aW50IHgsIHVpbnQgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgYXNzZXJ0KHggPj0geSk7CiAgICAgIHVpbnQgeiA9IHggLSB5OwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsdCh1aW50IHgsIHVpbnQgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgdWludCB6ID0geCAqIHk7CiAgICAgIGFzc2VydCgoeCA9PSAwKXx8KHoveCA9PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQogICAgCiAgICAgZnVuY3Rpb24gc2FmZURpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgICBmdW5jdGlvbiBnZXRSYW5kb21OdW1iZXIodWludDE2IG1heFJhbmRvbSwgdWludDggbWluLCBhZGRyZXNzIHByaXZhdGVBZGRyZXNzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCkgewogICAgICAgIHVpbnQyNTYgZ2VuTnVtID0gdWludDI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSArIHVpbnQyNTYocHJpdmF0ZUFkZHJlc3MpOwogICAgICAgIHJldHVybiB1aW50OChnZW5OdW0gJSAobWF4UmFuZG9tIC0gbWluICsgMSkrbWluKTsKICAgIH0KfQoKY29udHJhY3QgRW51bXMgewogICAgZW51bSBSZXN1bHRDb2RlIHsKICAgICAgICBTVUNDRVNTLAogICAgICAgIEVSUk9SX0NMQVNTX05PVF9GT1VORCwKICAgICAgICBFUlJPUl9MT1dfQkFMQU5DRSwKICAgICAgICBFUlJPUl9TRU5EX0ZBSUwsCiAgICAgICAgRVJST1JfTk9UX09XTkVSLAogICAgICAgIEVSUk9SX05PVF9FTk9VR0hfTU9ORVksCiAgICAgICAgRVJST1JfSU5WQUxJRF9BTU9VTlQKICAgIH0KCiAgICBlbnVtIEFuZ2VsQXVyYSB7IAogICAgICAgIEJsdWUsIAogICAgICAgIFllbGxvdywgCiAgICAgICAgUHVycGxlLCAKICAgICAgICBPcmFuZ2UsIAogICAgICAgIFJlZCwgCiAgICAgICAgR3JlZW4gCiAgICB9Cn0KCmNvbnRyYWN0IElBbmdlbENhcmREYXRhIGlzIEFjY2Vzc0NvbnRyb2wsIEVudW1zIHsKICAgIHVpbnQ4IHB1YmxpYyB0b3RhbEFuZ2VsQ2FyZFNlcmllczsKICAgIHVpbnQ2NCBwdWJsaWMgdG90YWxBbmdlbHM7CgogICAgCiAgICAvLyB3cml0ZQogICAgLy8gYW5nZWxzCiAgICBmdW5jdGlvbiBjcmVhdGVBbmdlbENhcmRTZXJpZXModWludDggX2FuZ2VsQ2FyZFNlcmllc0lkLCB1aW50IF9iYXNlUHJpY2UsICB1aW50NjQgX21heFRvdGFsLCB1aW50OCBfYmFzZUF1cmEsIHVpbnQxNiBfYmFzZUJhdHRsZVBvd2VyLCB1aW50NjQgX2xpdmVUaW1lKSBvbmx5Q1JFQVRPUiBleHRlcm5hbCByZXR1cm5zKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIHVwZGF0ZUFuZ2VsQ2FyZFNlcmllcyh1aW50OCBfYW5nZWxDYXJkU2VyaWVzSWQsIHVpbnQ2NCBfbmV3UHJpY2UsIHVpbnQ2NCBfbmV3TWF4VG90YWwpIG9ubHlDUkVBVE9SIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0QW5nZWwodWludDggX2FuZ2VsQ2FyZFNlcmllc0lkLCBhZGRyZXNzIF9vd25lciwgdWludCBfcHJpY2UsIHVpbnQxNiBfYmF0dGxlUG93ZXIpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBhZGRUb0FuZ2VsRXhwZXJpZW5jZUxldmVsKHVpbnQ2NCBfYW5nZWxJZCwgdWludCBfdmFsdWUpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldEFuZ2VsTGFzdEJhdHRsZVRpbWUodWludDY0IF9hbmdlbElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRBbmdlbExhc3RWc0JhdHRsZVRpbWUodWludDY0IF9hbmdlbElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRMYXN0QmF0dGxlUmVzdWx0KHVpbnQ2NCBfYW5nZWxJZCwgdWludDE2IF92YWx1ZSkgb25seVNFUkFQSElNIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQW5nZWxJZE1hcHBpbmcoYWRkcmVzcyBfb3duZXIsIHVpbnQ2NCBfYW5nZWxJZCkgcHJpdmF0ZTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyQW5nZWwoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQ2NCBfYW5nZWxJZCkgb25seVNFUkFQSElNIHB1YmxpYyByZXR1cm5zKFJlc3VsdENvZGUpOwogICAgZnVuY3Rpb24gb3duZXJBbmdlbFRyYW5zZmVyIChhZGRyZXNzIF90bywgdWludDY0IF9hbmdlbElkKSAgcHVibGljOwogICAgZnVuY3Rpb24gdXBkYXRlQW5nZWxMb2NrICh1aW50NjQgX2FuZ2VsSWQsIGJvb2wgbmV3VmFsdWUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHJlbW92ZUNyZWF0b3IoKSBvbmx5Q1JFQVRPUiBleHRlcm5hbDsKCiAgICAvLyByZWFkCiAgICBmdW5jdGlvbiBnZXRBbmdlbENhcmRTZXJpZXModWludDggX2FuZ2VsQ2FyZFNlcmllc0lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCBhbmdlbENhcmRTZXJpZXNJZCwgdWludDY0IGN1cnJlbnRBbmdlbFRvdGFsLCB1aW50IGJhc2VQcmljZSwgdWludDY0IG1heEFuZ2VsVG90YWwsIHVpbnQ4IGJhc2VBdXJhLCB1aW50IGJhc2VCYXR0bGVQb3dlciwgdWludDY0IGxhc3RTZWxsVGltZSwgdWludDY0IGxpdmVUaW1lKTsKICAgIGZ1bmN0aW9uIGdldEFuZ2VsKHVpbnQ2NCBfYW5nZWxJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDY0IGFuZ2VsSWQsIHVpbnQ4IGFuZ2VsQ2FyZFNlcmllc0lkLCB1aW50MTYgYmF0dGxlUG93ZXIsIHVpbnQ4IGF1cmEsIHVpbnQxNiBleHBlcmllbmNlLCB1aW50IHByaWNlLCB1aW50NjQgY3JlYXRlZFRpbWUsIHVpbnQ2NCBsYXN0QmF0dGxlVGltZSwgdWludDY0IGxhc3RWc0JhdHRsZVRpbWUsIHVpbnQxNiBsYXN0QmF0dGxlUmVzdWx0LCBhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGdldE93bmVyQW5nZWxDb3VudChhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBnZXRBbmdlbEJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2luZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gZ2V0VG90YWxBbmdlbENhcmRTZXJpZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0VG90YWxBbmdlbHMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0KTsKICAgIGZ1bmN0aW9uIGdldEFuZ2VsTG9ja1N0YXR1cyh1aW50NjQgX2FuZ2VsSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKTsKfQpjb250cmFjdCBJUGV0Q2FyZERhdGEgaXMgQWNjZXNzQ29udHJvbCwgRW51bXMgewogICAgdWludDggcHVibGljIHRvdGFsUGV0Q2FyZFNlcmllczsgICAgCiAgICB1aW50NjQgcHVibGljIHRvdGFsUGV0czsKICAgIAogICAgLy8gd3JpdGUKICAgIGZ1bmN0aW9uIGNyZWF0ZVBldENhcmRTZXJpZXModWludDggX3BldENhcmRTZXJpZXNJZCwgdWludDMyIF9tYXhUb3RhbCkgb25seUNSRUFUT1IgcHVibGljIHJldHVybnModWludDgpOwogICAgZnVuY3Rpb24gc2V0UGV0KHVpbnQ4IF9wZXRDYXJkU2VyaWVzSWQsIGFkZHJlc3MgX293bmVyLCBzdHJpbmcgX25hbWUsIHVpbnQ4IF9sdWNrLCB1aW50MTYgX2F1cmFSZWQsIHVpbnQxNiBfYXVyYVllbGxvdywgdWludDE2IF9hdXJhQmx1ZSkgb25seVNFUkFQSElNIGV4dGVybmFsIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIHNldFBldEF1cmFzKHVpbnQ2NCBfcGV0SWQsIHVpbnQ4IF9hdXJhUmVkLCB1aW50OCBfYXVyYUJsdWUsIHVpbnQ4IF9hdXJhWWVsbG93KSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRQZXRMYXN0VHJhaW5pbmdUaW1lKHVpbnQ2NCBfcGV0SWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldFBldExhc3RCcmVlZGluZ1RpbWUodWludDY0IF9wZXRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkUGV0SWRNYXBwaW5nKGFkZHJlc3MgX293bmVyLCB1aW50NjQgX3BldElkKSBwcml2YXRlOwogICAgZnVuY3Rpb24gdHJhbnNmZXJQZXQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQ2NCBfcGV0SWQpIG9ubHlTRVJBUEhJTSBwdWJsaWMgcmV0dXJucyhSZXN1bHRDb2RlKTsKICAgIGZ1bmN0aW9uIG93bmVyUGV0VHJhbnNmZXIgKGFkZHJlc3MgX3RvLCB1aW50NjQgX3BldElkKSAgcHVibGljOwogICAgZnVuY3Rpb24gc2V0UGV0TmFtZShzdHJpbmcgX25hbWUsIHVpbnQ2NCBfcGV0SWQpIHB1YmxpYzsKCiAgICAvLyByZWFkCiAgICBmdW5jdGlvbiBnZXRQZXRDYXJkU2VyaWVzKHVpbnQ4IF9wZXRDYXJkU2VyaWVzSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4IHBldENhcmRTZXJpZXNJZCwgdWludDMyIGN1cnJlbnRQZXRUb3RhbCwgdWludDMyIG1heFBldFRvdGFsKTsKICAgIGZ1bmN0aW9uIGdldFBldCh1aW50IF9wZXRJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCBwZXRJZCwgdWludDggcGV0Q2FyZFNlcmllc0lkLCBzdHJpbmcgbmFtZSwgdWludDggbHVjaywgdWludDE2IGF1cmFSZWQsIHVpbnQxNiBhdXJhQmx1ZSwgdWludDE2IGF1cmFZZWxsb3csIHVpbnQ2NCBsYXN0VHJhaW5pbmdUaW1lLCB1aW50NjQgbGFzdEJyZWVkaW5nVGltZSwgYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBnZXRPd25lclBldENvdW50KGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGdldFBldEJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2luZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGdldFRvdGFsUGV0Q2FyZFNlcmllcygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBnZXRUb3RhbFBldHMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCk7Cn0KCmNvbnRyYWN0IElNZWRhbERhdGEgaXMgQWNjZXNzQ29udHJvbCB7CiAgCiAgICBtb2RpZmllciBvbmx5T3duZXJPZih1aW50MjU2IF90b2tlbklkKSB7CiAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IG1zZy5zZW5kZXIpOwogICAgXzsKICB9CiAgIApmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwpmdW5jdGlvbiBzZXRNYXhUb2tlbk51bWJlcnMoKSAgb25seUNSRUFUT1IgZXh0ZXJuYWw7CmZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CmZ1bmN0aW9uIHRva2Vuc09mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2W10pIDsKZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKZnVuY3Rpb24gYXBwcm92ZWRGb3IodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgOwpmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIG9ubHlPd25lck9mKF90b2tlbklkKTsKZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIG9ubHlPd25lck9mKF90b2tlbklkKTsKZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CmZ1bmN0aW9uIF9jcmVhdGVNZWRhbChhZGRyZXNzIF90bywgdWludDggX3Nlcmllc0lEKSBvbmx5U0VSQVBISU0gcHVibGljIDsKZnVuY3Rpb24gZ2V0Q3VycmVudFRva2Vuc0J5VHlwZSh1aW50MzIgX3Nlcmllc0lEKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDMyKTsKZnVuY3Rpb24gZ2V0TWVkYWxUeXBlICh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDgpOwpmdW5jdGlvbiBfYnVybih1aW50MjU2IF90b2tlbklkKSBvbmx5T3duZXJPZihfdG9rZW5JZCkgZXh0ZXJuYWw7CmZ1bmN0aW9uIGlzQXBwcm92ZWRGb3IoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgOwpmdW5jdGlvbiBjbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsOwpmdW5jdGlvbiBjbGVhckFwcHJvdmFsKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlOwpmdW5jdGlvbiBhZGRUb2tlbihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSA7CmZ1bmN0aW9uIHJlbW92ZVRva2VuKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGU7Cn0KCmNvbnRyYWN0IElCYXR0bGVib2FyZERhdGEgaXMgQWNjZXNzQ29udHJvbCAgewoKICAKCiAgICAgIC8vIHdyaXRlIGZ1bmN0aW9ucwogIApmdW5jdGlvbiBjcmVhdGVCYXR0bGVib2FyZCh1aW50IHByaXplLCB1aW50OCByZXN0cmljdGlvbnMpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCByZXR1cm5zICh1aW50MTYpOwpmdW5jdGlvbiBraWxsTW9uc3Rlcih1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggbW9uc3RlcklkKSAgb25seVNFUkFQSElNIGV4dGVybmFsOwpmdW5jdGlvbiBjcmVhdGVOdWxsVGlsZSh1aW50MTYgX2JhdHRsZWJvYXJkSWQpIHByaXZhdGUgOwpmdW5jdGlvbiBjcmVhdGVUaWxlKHVpbnQxNiBfYmF0dGxlYm9hcmRJZCwgdWludDggX3RpbGVUeXBlLCB1aW50OCBfdmFsdWUsIHVpbnQ4IF9wb3NpdGlvbiwgdWludDMyIF9ocCwgdWludDE2IF9wZXRQb3dlciwgdWludDY0IF9hbmdlbElkLCB1aW50NjQgX3BldElkLCBhZGRyZXNzIF9vd25lciwgdWludDggX3RlYW0pIG9ubHlTRVJBUEhJTSBleHRlcm5hbCAgcmV0dXJucyAodWludDgpOwpmdW5jdGlvbiBraWxsVGlsZSh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGlsZUlkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWwgOwpmdW5jdGlvbiBhZGRUZWFtdG9Cb2FyZCh1aW50MTYgYmF0dGxlYm9hcmRJZCwgYWRkcmVzcyBvd25lciwgdWludDggdGVhbSkgb25seVNFUkFQSElNIGV4dGVybmFsOwpmdW5jdGlvbiBzZXRUaWxlUG9zaXRpb24gKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQsIHVpbnQ4IF9wb3NpdGlvblRvKSBvbmx5U0VSQVBISU0gcHVibGljIDsKZnVuY3Rpb24gc2V0VGlsZUhwKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQsIHVpbnQzMiBfaHApIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGFkZE1lZGFsQnVybmVkKHVpbnQxNiBiYXR0bGVib2FyZElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWwgOwpmdW5jdGlvbiBzZXRMYXN0TW92ZVRpbWUodWludDE2IGJhdHRsZWJvYXJkSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGl0ZXJhdGVUdXJuKHVpbnQxNiBiYXR0bGVib2FyZElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWwgOwpmdW5jdGlvbiBraWxsQm9hcmQodWludDE2IGJhdHRsZWJvYXJkSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGNsZWFyQW5nZWxzRnJvbUJvYXJkKHVpbnQxNiBiYXR0bGVib2FyZElkKSBwcml2YXRlOwovL1JlYWQgZnVuY3Rpb25zCiAgICAgCmZ1bmN0aW9uIGdldFRpbGVIcCh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGlsZUlkKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MzIpIDsKZnVuY3Rpb24gZ2V0TWVkYWxzQnVybmVkKHVpbnQxNiBiYXR0bGVib2FyZElkKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50OCkgOwpmdW5jdGlvbiBnZXRUZWFtKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldE1heEZyZWVUZWFtcygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50OCk7CmZ1bmN0aW9uIGdldEJhcnJpZXJOdW0odWludDE2IGJhdHRsZWJvYXJkSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCkgOwpmdW5jdGlvbiBnZXRUaWxlRnJvbUJhdHRsZWJvYXJkKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCB0aWxlVHlwZSwgdWludDggdmFsdWUsIHVpbnQ4IGlkLCB1aW50OCBwb3NpdGlvbiwgdWludDMyIGhwLCB1aW50MTYgcGV0UG93ZXIsIHVpbnQ2NCBhbmdlbElkLCB1aW50NjQgcGV0SWQsIGJvb2wgaXNMaXZlLCBhZGRyZXNzIG93bmVyKSAgIDsKZnVuY3Rpb24gZ2V0VGlsZUlEQnlPd25lcih1aW50MTYgYmF0dGxlYm9hcmRJZCwgYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50OCkgOwpmdW5jdGlvbiBnZXRQZXRieVRpbGVJZCggdWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ2NCkgOwpmdW5jdGlvbiBnZXRPd25lciAodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRlYW0sICB1aW50OCBvd25lck51bWJlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyk7CmZ1bmN0aW9uIGdldFRpbGVJRGJ5UG9zaXRpb24odWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHBvc2l0aW9uKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDgpIDsKZnVuY3Rpb24gZ2V0UG9zaXRpb25Gcm9tQmF0dGxlYm9hcmQodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IF9wb3NpdGlvbikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IHRpbGVUeXBlLCB1aW50OCB2YWx1ZSwgdWludDggaWQsIHVpbnQ4IHBvc2l0aW9uLCB1aW50MzIgaHAsIHVpbnQzMiBwZXRQb3dlciwgdWludDY0IGFuZ2VsSWQsIHVpbnQ2NCBwZXRJZCwgYm9vbCBpc0xpdmUpICA7CmZ1bmN0aW9uIGdldEJhdHRsZWJvYXJkKHVpbnQxNiBpZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IHR1cm4sIGJvb2wgaXNMaXZlLCB1aW50IHByaXplLCB1aW50OCBudW1UZWFtcywgdWludDggbnVtVGlsZXMsIHVpbnQ4IGNyZWF0ZWRCYXJyaWVycywgdWludDggcmVzdHJpY3Rpb25zLCB1aW50IGxhc3RNb3ZlVGltZSwgdWludDggbnVtVGVhbXMxLCB1aW50OCBudW1UZWFtczIsIHVpbnQ4IG1vbnN0ZXIxLCB1aW50OCBtb25zdGVyMikgOwpmdW5jdGlvbiBpc0JhdHRsZWJvYXJkTGl2ZSh1aW50MTYgYmF0dGxlYm9hcmRJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpOwpmdW5jdGlvbiBpc1RpbGVMaXZlKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIGNvbnN0YW50ICBleHRlcm5hbCByZXR1cm5zIChib29sKSA7CmZ1bmN0aW9uIGdldExhc3RNb3ZlVGltZSh1aW50MTYgYmF0dGxlYm9hcmRJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIDsKZnVuY3Rpb24gZ2V0TnVtVGlsZXNGcm9tQm9hcmQgKHVpbnQxNiBfYmF0dGxlYm9hcmRJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KSA7IApmdW5jdGlvbiBhbmdlbE9uQmF0dGxlYm9hcmRzKHVpbnQ2NCBhbmdlbElEKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSA7CmZ1bmN0aW9uIGdldFR1cm4odWludDE2IGJhdHRsZWJvYXJkSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSA7CmZ1bmN0aW9uIGdldE51bVRlYW1zKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0ZWFtKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDgpOwpmdW5jdGlvbiBnZXRNb25zdGVycyh1aW50MTYgQmF0dGxlYm9hcmRJZCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDggbW9uc3RlcjEsIHVpbnQ4IG1vbnN0ZXIyKSA7CmZ1bmN0aW9uIGdldFRvdGFsQmF0dGxlYm9hcmRzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNikgOwogIAogICAgICAgIAogCiAgIAp9CgoKY29udHJhY3QgQmF0dGxlYm9hcmRzIGlzIEFjY2Vzc0NvbnRyb2wsIFNhZmVNYXRoICB7CgogICAgLyoqKiBEQVRBIFRZUEVTICoqKi8KICAgIGFkZHJlc3MgcHVibGljIGFuZ2VsQ2FyZERhdGFDb250cmFjdCA9IDB4NkQyRTc2MjEzNjE1OTI1YzVmYzQzNjU2NUI1ZWU3ODhFZTBFODZEQzsKICAgIGFkZHJlc3MgcHVibGljIHBldENhcmREYXRhQ29udHJhY3QgPSAweEIzNDA2ODZkYTk5NmI4QjNkNDg2YjREMjdFMzhFMzg1MDBBOUU5MjY7CiAgICBhZGRyZXNzIHB1YmxpYyBtZWRhbERhdGFDb250cmFjdCA9ICAweDMzQTEwNGRDQkVkODE5NjE3MDE5MDBjMDZmRDE0NTg3QzkwOEVBYTM7CiAgICBhZGRyZXNzIHB1YmxpYyBiYXR0bGVib2FyZERhdGFDb250cmFjdCA9MHhFNjBmQzQ2MzJiRDY3MTNFOTIzRkU5M0Y4YzI0NDYzNUU2ZDUwMDllOwoKICAgICAvLyBldmVudHMKICAgICBldmVudCBFdmVudE1vbnN0ZXJTdHJpa2UodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ2NCBhbmdlbCwgdWludDE2IGFtb3VudCk7CiAgICAgZXZlbnQgRXZlbnRCYXJyaWVyKHVpbnQxNiBiYXR0bGVib2FyZElkLHVpbnQ2NCBhbmdlbElkLCB1aW50OCBjb2xvciwgdWludDggZGFtYWdlKTsKICAgICBldmVudCBFdmVudEJhdHRsZVJlc3VsdCh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGlsZTFJZCwgdWludDggdGlsZTJJZCwgYm9vbCBhbmdlbDF3aW4pOwogICAgCiAgICAKICAgIHVpbnQ4IHB1YmxpYyBkZWxheUhvdXJzID0gMTI7CiAgICB1aW50MTYgcHVibGljIHBldEhwVGhyZXNob2xkID0gMjUwOwogICAgdWludDE2IHB1YmxpYyBtYXhNb25zdGVySGl0ID0gMjAwOwogICAgdWludDE2IHB1YmxpYyBtaW5Nb25zdGVySGl0ID0gNTA7CiAgICAgICAgIAogICAgICBzdHJ1Y3QgVGlsZSB7CiAgICAgICAgdWludDggdGlsZVR5cGU7CiAgICAgICAgdWludDggdmFsdWU7CiAgICAgICAgdWludDggaWQ7CiAgICAgICAgdWludDggcG9zaXRpb247CiAgICAgICAgdWludDMyIGhwOwogICAgICAgIHVpbnQzMiBwZXRQb3dlcjsKICAgICAgICB1aW50NjQgYW5nZWxJZDsKICAgICAgICB1aW50NjQgcGV0SWQ7CiAgICAgICAgYm9vbCBpc0xpdmU7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICAKICAgIH0KICAgIAogICAgCiAgICAKICAgIAogICAgLy9BdXJhIEJvb3N0cwogICAgLy8gUmVkIC0gQnVybmluZyBTdHJpa2UgLSArIDEwIGJhdHRsZSBwb3dlciAgCiAgICAvLyBHcmVlbiAtIEhlYWxpbmcgTGlnaHQgLSAyMCUgY2hhbmNlIHRvIGhlYWwgNzUgaHAgZWFjaCBiYXR0bGUKICAgIC8vWWVsbG93IC0gR3VpZGluZyBQYXRoIC0gNSBocCByZWNvdmVyZWQgZWFjaCB0dXJuLgogICAgLy9QdXJwbGUgLSBVbmNvbnRyb2xlZCBGdXJ5IC0gMTAlIGNoYW5jZSBmb3Igc3VkZGVuIGtpbGwgCiAgICAvL09yYW5nZSAtIFJhZGlhbnQgUG93ZXIgLSArMTAwIG1heCBocCBvbiBqb2luaW5nIGJvYXJkLiAKICAgIC8vQmx1ZSAtIEZyaWVuZCB0byBhbGwgLSBpbW11bml0eSBmcm9tIG1vbnN0ZXIgYXR0YWNrcyAKICAgIAogICAgICAKICAgICAgICAgIC8vIFV0aWxpdHkgRnVuY3Rpb25zCiAgICBmdW5jdGlvbiBEYXRhQ29udGFjdHMoYWRkcmVzcyBfYW5nZWxDYXJkRGF0YUNvbnRyYWN0LCBhZGRyZXNzIF9wZXRDYXJkRGF0YUNvbnRyYWN0LCAgYWRkcmVzcyBfbWVkYWxEYXRhQ29udHJhY3QsIGFkZHJlc3MgX2JhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KSBvbmx5Q1JFQVRPUiBleHRlcm5hbCB7CiAgICAgICAgYW5nZWxDYXJkRGF0YUNvbnRyYWN0ID0gX2FuZ2VsQ2FyZERhdGFDb250cmFjdDsKICAgICAgICBwZXRDYXJkRGF0YUNvbnRyYWN0ID0gX3BldENhcmREYXRhQ29udHJhY3Q7CiAgICAgICAgbWVkYWxEYXRhQ29udHJhY3QgPSBfbWVkYWxEYXRhQ29udHJhY3Q7CiAgICAgICAgYmF0dGxlYm9hcmREYXRhQ29udHJhY3QgPSBfYmF0dGxlYm9hcmREYXRhQ29udHJhY3Q7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldFZhcmlhYmxlcyh1aW50OCBfZGVsYXlIb3VycywgdWludDE2IF9wZXRIcFRocmVzaG9sZCwgIHVpbnQxNiBfbWF4TW9uc3RlckhpdCwgdWludDE2IF9taW5Nb25zdGVySGl0KSBvbmx5Q1JFQVRPUiBleHRlcm5hbCB7CiAgICAgICAgZGVsYXlIb3VycyA9IF9kZWxheUhvdXJzOwogICAgICAgIHBldEhwVGhyZXNob2xkID0gX3BldEhwVGhyZXNob2xkOwogICAgICAgIG1heE1vbnN0ZXJIaXQgPSBfbWF4TW9uc3RlckhpdDsKICAgICAgICBtaW5Nb25zdGVySGl0ID0gX21pbk1vbnN0ZXJIaXQ7CiAgICAgICAgCiAgICB9CiAgICAgIAoKICAgICAgCiAgICAKICAgICAgICBmdW5jdGlvbiByZW1vdmVEZWFkVHVybnModWludDE2IGJhdHRsZWJvYXJkSWQpIHByaXZhdGUgewogICAgICAgICAgICAvL1RoaXMgZnVuY3Rpb24gaXRlcmF0ZXMgdGhyb3VnaCB0dXJucyBvZiBwbGF5ZXJzIHdob3NlIHRpbGVzIG1heSBhbHJlYWR5IGJlIGRlYWQgCiAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgIHVpbnQ4IG9sZFR1cm5UaWxlSUQ7CiAgICAgICAgICAgIGZvciAodWludDggaSA9IDA7IGk8NjsgaSsrKSB7CiAgICAgICAgICAgIG9sZFR1cm5UaWxlSUQgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEQnlPd25lcihiYXR0bGVib2FyZElkLCBiYXR0bGVib2FyZERhdGEuZ2V0VHVybihiYXR0bGVib2FyZElkKSk7CiAgICAgICAgICAgIGlmIChiYXR0bGVib2FyZERhdGEuaXNUaWxlTGl2ZShiYXR0bGVib2FyZElkLCBvbGRUdXJuVGlsZUlEKSA9PSBmYWxzZSkge2JhdHRsZWJvYXJkRGF0YS5pdGVyYXRlVHVybihiYXR0bGVib2FyZElkKTt9CiAgICAgICAgICAgIGVsc2Uge2k9OTt9IC8vYnJlYWsgbG9vcAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgCiAgICAgICBmdW5jdGlvbiBtb3ZlKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQsIHVpbnQ4IHBvc2l0aW9uVG8pIGV4dGVybmFsIHsKICAgICAgICAgICAvL0Nhbid0IG1vdmUgb2ZmIHRoZSBib2FyZAogICAgICAgICAgIGlmICgocG9zaXRpb25UbyA8PSAwKSB8fCAocG9zaXRpb25UbyA+NjQpKSB7cmV2ZXJ0KCk7fQogICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgCiAgICAgICAgICAgLy9pZiBpdCdzIG5vdCB5b3VyIHR1cm4uIAogICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGJhdHRsZWJvYXJkRGF0YS5nZXRUdXJuKGJhdHRsZWJvYXJkSWQpKSB7CiAgICAgICAgICAgICAgIC8vZmlyc3QgY2hlY2sgdG8gc2VlIGlmIHRoZSB0ZWFtIHdob3NlIHR1cm4gaXQgaXMgaXMgZGVhZC4KICAgICAgICAgICAgICByZW1vdmVEZWFkVHVybnMoYmF0dGxlYm9hcmRJZCk7CiAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYmF0dGxlYm9hcmREYXRhLmdldFR1cm4oYmF0dGxlYm9hcmRJZCkpIHsKICAgICAgICAgICAgICAgICAgLy9pZiBpdCdzIHN0aWxsIG5vdCB5b3VyIHR1cm4sIHJldmVydCBpZiBpdCdzIGFsc28gbm90IHBhc3QgdGhlIHJlYWwgdHVybidzIGRlbGF5IHRpbWUuIAogICAgICAgICAgICAgICBpZiAgKG5vdyAgPCBiYXR0bGVib2FyZERhdGEuZ2V0TGFzdE1vdmVUaW1lKGJhdHRsZWJvYXJkSWQpICsgKDM2MDAqIGRlbGF5SG91cnMpKSB7cmV2ZXJ0KCk7fQogICAgICAgICAgICAgIH0KICAgICAgICAgICB9CiAgICAgICAgICAgVGlsZSBtZW1vcnkgdGlsZTsKICAgICAgICAgICAgLy9nZXQgdGhlIHRpbGUgdG8gYmUgbW92ZWQuIAogICAgICAgICAgICh0aWxlLnRpbGVUeXBlLCB0aWxlLnZhbHVlICwsIHRpbGUucG9zaXRpb24sIHRpbGUuaHAsLCwsIHRpbGUuaXNMaXZlLHRpbGUub3duZXIpID0gYmF0dGxlYm9hcmREYXRhLmdldFRpbGVGcm9tQmF0dGxlYm9hcmQoYmF0dGxlYm9hcmRJZCwgdGlsZUlkKSA7CiAgICAgICAgICAgLy9maXJzdCBzZWUgaWYgdGhlIG1vdmUgaXMgbGVnYWwKICAgICAgICAgICBpZiAoY2FuTW92ZShiYXR0bGVib2FyZElkLCB0aWxlLnBvc2l0aW9uLCBwb3NpdGlvblRvKSA9PSBmYWxzZSkge3JldmVydCgpO30KICAgICAgICAgICAKICAgICAgICAgICAvL1JlZ2FyZGxlc3Mgb2YgaWYgdGhlIG93ZXIgbW92ZXMgaXRzIHRpbGUgbm9ybWFsbHkgb3IgaWYgc29tZW9uZSBlbHNlIG1vdmVzIGl0LCBpdCBoYXMgdG8gbW92ZSBvbiBpdHMgdHVybi4gCiAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUdXJuKGJhdHRsZWJvYXJkSWQpICE9IHRpbGUub3duZXIpIHtyZXZlcnQoKTt9CiAgICAgICAgICAgCiAgICAgICAgICAgLy9jYW4ndCBtb3ZlIGlmIHlvdXIgdGlsZSBpc24ndCBsaXZlLiAKICAgICAgICAgICBpZiAodGlsZS5pc0xpdmUgPT0gZmFsc2UpIHtyZXZlcnQoKTt9CiAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgIC8vVGlsZSBUWVBFUwogICAgLy8gMCAtIEVtcHR5IFNwYWNlCiAgICAvLyAxIC0gVGVhbSAoQW5nZWwgKyBQZXQpCiAgICAvLyAzIC0gUmVkIEJhcnJpZXIgKHJlZCBpcyBodXJ0KQogICAgLy8gNCAtIFllbGxvdyBiYXJyaWVyICh5ZWxsb3cgaXMgaHVydCkKICAgIC8vIDUgLSBCbHVlIGJhcnJpZXIgKGJsdWUgaXMgaHVydCkKICAgIC8vIDYgLSBFeHAgQm9vc3QgKHBlcm1hbmVudCkKICAgIC8vIDcgLSBIUCBib29zdCAodGVtcCkKICAgIC8vIDggLSBFdGggYm9vc3QKICAgIC8vIDkgLSBXYXJwCiAgICAvLyAxMCAtIE1lZGFsCiAgICAvLyAxMSAtIFBldCBwZXJtYW5lbnQgQXVyYSBib29zdCByYW5kb20gY29sb3IKICAgIAogICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5pdGVyYXRlVHVybihiYXR0bGVib2FyZElkKTsKICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuc2V0TGFzdE1vdmVUaW1lKGJhdHRsZWJvYXJkSWQpOwogICAgICAgICAgIAogICAgICAgICAgIC8vVGlsZSAyIGlzIHRoZSB0aWxlIHRoYXQgdGhlIGFuZ2VsIHRlYW0gd2lsbCBpbnRlcmFjdCB3aXRoLiAKICAgICAgICAgICBUaWxlIG1lbW9yeSB0aWxlMjsKICAgICAgICAgICAgdGlsZTIuaWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEYnlQb3NpdGlvbihiYXR0bGVib2FyZElkLCBwb3NpdGlvblRvKTsKICAgICAgICAgICAKICAgICAgICAgICh0aWxlMi50aWxlVHlwZSwgdGlsZTIudmFsdWUgLCwsLCwgdGlsZTIuYW5nZWxJZCwgdGlsZTIucGV0SWQsIHRpbGUyLmlzTGl2ZSwpID0gYmF0dGxlYm9hcmREYXRhLmdldFRpbGVGcm9tQmF0dGxlYm9hcmQoYmF0dGxlYm9hcmRJZCwgdGlsZTIuaWQpIDsKICAgICAgICAgICAKICAgICAgICAgICBpZiAoKHRpbGUyLnRpbGVUeXBlID09IDApIHx8ICh0aWxlMi5pc0xpdmUgPT0gZmFsc2UpKSB7CiAgICAgICAgICAgICAgIC8vRW1wdHkgU3BhY2UKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgfQogICAgICAgICAgIGlmICh0aWxlMi5pc0xpdmUgPT0gdHJ1ZSkgewogICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGUgPT0gMSkgewogICAgICAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUZWFtKGJhdHRsZWJvYXJkSWQsIHRpbGVJZCkgPT0gYmF0dGxlYm9hcmREYXRhLmdldFRlYW0oYmF0dGxlYm9hcmRJZCwgdGlsZTIuaWQpKSB7cmV2ZXJ0KCk7fQogICAgICAgICAgICAgICAvL0ZpZ2h0IFRlYW0KICAgICAgICAgICAgICAgaWYgKGZpZ2h0VGVhbXMoYmF0dGxlYm9hcmRJZCwgdGlsZUlkLCB0aWxlMi5pZCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgLy9jaGFsbGVuZ2VyIHdvbi4gCiAgICAgICAgICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuc2V0VGlsZVBvc2l0aW9uKGJhdHRsZWJvYXJkSWQsdGlsZUlkLCBwb3NpdGlvblRvKTsKICAgICAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5raWxsVGlsZShiYXR0bGVib2FyZElkLCB0aWxlMi5pZCk7CiAgICAgICAgICAgICAgICAgICBFdmVudEJhdHRsZVJlc3VsdChiYXR0bGVib2FyZElkLCB0aWxlSWQsIHRpbGUyLmlkLCB0cnVlKTsKICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBlbHNlIHtiYXR0bGVib2FyZERhdGEua2lsbFRpbGUoYmF0dGxlYm9hcmRJZCwgdGlsZUlkKTsKICAgICAgICAgICAgICAgICAgIEV2ZW50QmF0dGxlUmVzdWx0KGJhdHRsZWJvYXJkSWQsIHRpbGVJZCwgdGlsZTIuaWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgfSAvL2NoYWxsZW5nZXIgbG9zdAogICAgICAgICAgICAgIAogICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgICAgaWYgKHRpbGUyLnRpbGVUeXBlID09IDMpIHsKICAgICAgICAgICAgICAgLy9SZWQgYmFycmllcgogICAgICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuc2V0VGlsZVBvc2l0aW9uKGJhdHRsZWJvYXJkSWQsdGlsZUlkLCBwb3NpdGlvblRvKTsKICAgICAgICAgICAgICAgaWYgKGlzVnVsbmVyYWJsZSAodGlsZS5hbmdlbElkLDEpID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGlsZS5ocCA+IHRpbGUyLnZhbHVlKSB7YmF0dGxlYm9hcmREYXRhLnNldFRpbGVIcChiYXR0bGVib2FyZElkLCB0aWxlSWQsICh0aWxlLmhwIC0gdGlsZTIudmFsdWUpKTt9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7YmF0dGxlYm9hcmREYXRhLmtpbGxUaWxlKGJhdHRsZWJvYXJkSWQsIHRpbGVJZCk7fQogICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIEV2ZW50QmFycmllcihiYXR0bGVib2FyZElkLCB0aWxlLmFuZ2VsSWQsMywgdGlsZTIudmFsdWUpOwogICAgICAgICAgICAgICAKICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGUgPT0gNCkgewogICAgICAgICAgICAgICAvL1llbGxvdyBiYXJyaWVyCiAgICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuc2V0VGlsZVBvc2l0aW9uKGJhdHRsZWJvYXJkSWQsdGlsZUlkLCBwb3NpdGlvblRvKTsKICAgICAgICAgICAgICBpZiAoaXNWdWxuZXJhYmxlICh0aWxlLmFuZ2VsSWQsMikgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aWxlLmhwID4gdGlsZTIudmFsdWUpIHtiYXR0bGVib2FyZERhdGEuc2V0VGlsZUhwKGJhdHRsZWJvYXJkSWQsIHRpbGVJZCwgKHRpbGUuaHAgLSB0aWxlMi52YWx1ZSkpO30KICAgICAgICAgICAgICAgICAgICBlbHNlIHtiYXR0bGVib2FyZERhdGEua2lsbFRpbGUoYmF0dGxlYm9hcmRJZCwgdGlsZUlkKTt9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgRXZlbnRCYXJyaWVyKGJhdHRsZWJvYXJkSWQsIHRpbGUuYW5nZWxJZCw0LCB0aWxlMi52YWx1ZSk7CiAgICAgICAgICAgfQogICAgICAgICAgICAgaWYgKHRpbGUyLnRpbGVUeXBlID09IDUpIHsKICAgICAgICAgICAgICAgLy9CbHVlIGJhcnJpZXIKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgICAgICBpZiAoaXNWdWxuZXJhYmxlICh0aWxlLmFuZ2VsSWQsMykgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aWxlLmhwID4gdGlsZTIudmFsdWUpIHtiYXR0bGVib2FyZERhdGEuc2V0VGlsZUhwKGJhdHRsZWJvYXJkSWQsIHRpbGVJZCwgKHRpbGUuaHAgLSB0aWxlMi52YWx1ZSkpO30KICAgICAgICAgICAgICAgICAgICBlbHNlIHtiYXR0bGVib2FyZERhdGEua2lsbFRpbGUoYmF0dGxlYm9hcmRJZCwgdGlsZUlkKTt9CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgRXZlbnRCYXJyaWVyKGJhdHRsZWJvYXJkSWQsIHRpbGUuYW5nZWxJZCw1LCB0aWxlMi52YWx1ZSk7CiAgICAgICAgICAgfQogICAgICAgICAgICAgaWYgKHRpbGUyLnRpbGVUeXBlID09IDYpIHsKICAgICAgICAgICAgICAgLy9FeHAgYm9vc3QKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgICAgICBhbmdlbENhcmREYXRhLmFkZFRvQW5nZWxFeHBlcmllbmNlTGV2ZWwodGlsZS5hbmdlbElkLHRpbGUyLnZhbHVlKTsKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLmtpbGxUaWxlKGJhdHRsZWJvYXJkSWQsdGlsZTIuaWQpOwogICAgICAgICAgICAgICAKICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGUgPT0gNykgewogICAgICAgICAgICAgICAvL0hQIGJvb3N0CiAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCx0aWxlSWQsIHRpbGUuaHArIHRpbGUyLnZhbHVlKTsKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5raWxsVGlsZShiYXR0bGVib2FyZElkLHRpbGUyLmlkKTsKICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGUgPT0gOCl7CiAgICAgICAgICAgICAgIC8vRVRIIEJvb3N0IC0gdG8gYmUgdXNlZCBvbmx5IGluIHBhaWQgYm9hcmRzLiAKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5raWxsVGlsZShiYXR0bGVib2FyZElkLHRpbGUyLmlkKTsKICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGUgPT05KSB7CiAgICAgICAgICAgICAgIC8vV2FycCB0aWxlCiAgICAgICAgICAgICAgIGlmICAoYmF0dGxlYm9hcmREYXRhLmdldFRpbGVJRGJ5UG9zaXRpb24oYmF0dGxlYm9hcmRJZCwgdGlsZTIudmFsdWUpID09IDApIHtiYXR0bGVib2FyZERhdGEuc2V0VGlsZVBvc2l0aW9uKGJhdHRsZWJvYXJkSWQsdGlsZUlkLCB0aWxlMi52YWx1ZSk7fQogICAgICAgICAgICAgICAvL2NoZWNrIGlmIHdhcnBpbmcgZGlyZWN0bHkgb250byBhbm90aGVyIHRpbGUKICAgICAgICAgICAgICAgZWxzZSB7YmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7fQogICAgICAgICAgICAgICAvL2lmIHdhcnBpbmcgZGlyZWN0bHkgb250byBhbm90aGVyIHRpbGUsIGp1c3Qgc3RheSBhdCB0aGUgd2FycCB0aWxlIHBvc2l0aW9uLiAKICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGUgPT0xMCl7CiAgICAgICAgICAgICAgIC8vTWVkYWwKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgICAgIElNZWRhbERhdGEgbWVkYWxEYXRhID0gSU1lZGFsRGF0YShtZWRhbERhdGFDb250cmFjdCk7CiAgICAgICAgICAgICAgIG1lZGFsRGF0YS5fY3JlYXRlTWVkYWwodGlsZS5vd25lcix1aW50OCh0aWxlMi52YWx1ZSkpOwogICAgICAgICAgICAgICBiYXR0bGVib2FyZERhdGEua2lsbFRpbGUoYmF0dGxlYm9hcmRJZCx0aWxlMi5pZCk7CiAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGlsZTIudGlsZVR5cGU9PTExKSB7CiAgICAgICAgICAgICAgIC8vUGV0IEF1cmEgQm9vc3QKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVQb3NpdGlvbihiYXR0bGVib2FyZElkLHRpbGVJZCwgcG9zaXRpb25Ubyk7CiAgICAgICAgICAgICAgIHJhbmRvbVBldEF1cmFCb29zdCh0aWxlLnBldElkLHRpbGUyLnZhbHVlKTsKICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLmtpbGxUaWxlKGJhdHRsZWJvYXJkSWQsdGlsZTIuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgIH0KICAgICAgICAgICAgLy9jaGVjayBpZiB5ZWxsb3cgSFAgQm9vc3QKICAgICAgICAgICAgaWYgKGdldEF1cmFDb2xvcih0aWxlLmFuZ2VsSWQpID09IDEpIHtiYXR0bGVib2FyZERhdGEuc2V0VGlsZUhwKGJhdHRsZWJvYXJkSWQsdGlsZUlkLCB0aWxlLmhwKyA1KTt9CiAgICAgICAgICAgIAogICAgICAgICAgICAvL2NoZWNrIGlmIG5ldyBwb3NpdGlvbiBpcyB2dWxuZXJhYmxlIHRvIG1vbnN0ZXIgYXR0YWNrLiAKICAgICAgICAgICAgY2hlY2tNb25zdGVyQXR0YWNrKGJhdHRsZWJvYXJkSWQsdGlsZUlkLHBvc2l0aW9uVG8pOwogICAgICAgICAgICAKICAgICAgIH0KICAgICAgIAogICAgICAgZnVuY3Rpb24gY2hlY2tNb25zdGVyQXR0YWNrKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQsIHVpbnQ4IHBvc2l0aW9uKSBwcml2YXRlICB7CiAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgLy9nZXQgdGhlIG1vbnN0ZXIgbG9jYXRpb25zCiAgICAgICAgICAgdWludDggbTE7CiAgICAgICAgICAgdWludDggbTI7CiAgICAgICAgICAgKG0xLG0yKSA9IGJhdHRsZWJvYXJkRGF0YS5nZXRNb25zdGVycyhiYXR0bGVib2FyZElkKTsKICAgICAgICAgICAvL0lmIGEgbW9uc3RlciBpcyB3aXRoaW4gMiBzcG90cyBpdCB3aWxsIGF1dG9tYXRpY2FsbHkgYXR0YWNrLiAKICAgICAgICAgICBpZiAoKHBvc2l0aW9uID09IG0xKSB8fCAocG9zaXRpb24gPT0gbTEgKzEpIHx8IChwb3NpdGlvbiA9PSBtMSArMikgfHwgKHBvc2l0aW9uID09IG0xICs4KSB8fCAocG9zaXRpb24gPT0gbTEgKzE2KSB8fCAocG9zaXRpb24gPT0gbTEgLSAxKSB8fCAocG9zaXRpb24gPT0gbTEgLTIpIHx8IChwb3NpdGlvbiA9PSBtMSAtOCkgfHwgKHBvc2l0aW9uID09IG0xIC0xNikpIHsKICAgICAgICAgICAgICAgIGlmIChtMSAhPSAwKSB7CiAgICAgICAgICAgICAgIGZpZ2h0TW9uc3RlcihiYXR0bGVib2FyZElkLCB0aWxlSWQsIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgIH0KICAgICAgICAgICAKICAgICAgICAgICAgaWYgKChwb3NpdGlvbiA9PSBtMikgfHwgKHBvc2l0aW9uID09IG0yICsxKSB8fCAocG9zaXRpb24gPT0gbTIgKzIpIHx8IChwb3NpdGlvbiA9PSBtMiArOCkgfHwgKHBvc2l0aW9uID09IG0yICsxNikgfHwgKHBvc2l0aW9uID09IG0yIC0xKSB8fCAocG9zaXRpb24gPT0gbTIgLTIpIHx8IChwb3NpdGlvbiA9PSBtMiAtOCkgfHwgKHBvc2l0aW9uID09IG0yIC0xNikpIHsKICAgICAgICAgICAgICAgICBpZiAobTIgIT0gMCkgewogICAgICAgICAgICAgICBmaWdodE1vbnN0ZXIoYmF0dGxlYm9hcmRJZCwgdGlsZUlkLCAyKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgfQogICAgICAgICAgIAogICAgICAgfQogICAgCiAgICAgICBmdW5jdGlvbiBnZXRBbmdlbEluZm9CeVRpbGUgKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYgYnAsIHVpbnQ4IGF1cmEpIHsKICAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgICB1aW50NjQgYW5nZWxJZDsKICAgICAgICAgICAgKCwgLCwsLCxhbmdlbElkLCwsKSA9IGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlRnJvbUJhdHRsZWJvYXJkKGJhdHRsZWJvYXJkSWQsIHRpbGVJZCk7CiAgICAgICAgICAgSUFuZ2VsQ2FyZERhdGEgYW5nZWxDYXJkRGF0YSA9IElBbmdlbENhcmREYXRhKGFuZ2VsQ2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgKCwsYnAsYXVyYSwsLCwsLCwpID0gYW5nZWxDYXJkRGF0YS5nZXRBbmdlbChhbmdlbElkKTsKICAgICAgICAgICByZXR1cm47CiAgICAgICB9CiAgICAgICAKICAgICAgIGZ1bmN0aW9uIGdldEZhc3Rlc3QodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGUxSWQsIHVpbnQ4IHRpbGUySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICBJQmF0dGxlYm9hcmREYXRhIGJhdHRsZWJvYXJkRGF0YSA9IElCYXR0bGVib2FyZERhdGEoYmF0dGxlYm9hcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgIHVpbnQ4IHNwZWVkMTsKICAgICAgICAgICB1aW50OCBzcGVlZDI7CiAgICAgICAgICAgICAgKCwgc3BlZWQxLCwsLCwsLCwpID0gYmF0dGxlYm9hcmREYXRhLmdldFRpbGVGcm9tQmF0dGxlYm9hcmQoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCk7CiAgICAgICAgICAgICgsIHNwZWVkMiwsLCwgLCwsLCkgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUZyb21CYXR0bGVib2FyZChiYXR0bGVib2FyZElkLCB0aWxlMklkKTsKICAgICAgICAgICAgaWYgKHNwZWVkMSA+PSBzcGVlZDIpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgCiAgICAgICB9CiAgICAgICBmdW5jdGlvbiBmaWdodFRlYW1zKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlMUlkLCB1aW50OCB0aWxlMklkKSBwcml2YXRlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAvL1RydWUgcmV0dXJuIG1lYW5zIHRoYXQgdGVhbSAxIHdvbiwgZmFsc2UgcmV0dXJuIG1lYW5zIHRlYW0gMiB3b24uIAogICAgICAgICAgIAogICAgICAgICAgIC8vRmlyc3QgZ2V0IHRoZSBwYXJhbWV0ZXJzLiAKICAgICAgICAgICBJQmF0dGxlYm9hcmREYXRhIGJhdHRsZWJvYXJkRGF0YSA9IElCYXR0bGVib2FyZERhdGEoYmF0dGxlYm9hcmREYXRhQ29udHJhY3QpOwogICAgICAgIAogICAgICAgICAgIHVpbnQzMiBocDE7CiAgICAgICAgICAgdWludDMyIGhwMjsKICAgIAogICAgICAgICAgIHVpbnQxNiBwZXRQb3dlcjE7CiAgICAgICAgICAgdWludDE2IHBldFBvd2VyMjsKICAgICAgICAgICAoLCwsLGhwMSwgcGV0UG93ZXIxLCwsLCkgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUZyb21CYXR0bGVib2FyZChiYXR0bGVib2FyZElkLCB0aWxlMUlkKTsKICAgICAgICAgICAoLCwsLGhwMiwgcGV0UG93ZXIyLCwsLCkgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUZyb21CYXR0bGVib2FyZChiYXR0bGVib2FyZElkLCB0aWxlMklkKTsKICAgICAgICAgICAKICAgICAgICAgIHVpbnQxNiBhbmdlbDFCUDsKICAgICAgICAgIHVpbnQxNiBhbmdlbDJCUDsKICAgICAgICAgIHVpbnQ4IGFuZ2VsMWF1cmE7CiAgICAgICAgICB1aW50OCBhbmdlbDJhdXJhOwogICAgICAgICAgCiAgICAgICAgIChhbmdlbDFCUCwgYW5nZWwxYXVyYSkgPSBnZXRBbmdlbEluZm9CeVRpbGUoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCk7CiAgICAgICAgIChhbmdlbDJCUCwgYW5nZWwyYXVyYSkgPSBnZXRBbmdlbEluZm9CeVRpbGUoYmF0dGxlYm9hcmRJZCwgdGlsZTJJZCk7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy9JZiByZWQgYXVyYSwgYm9vc3QgYmF0dGxlIHBvd2VyCiAgICAgICAgaWYgKGFuZ2VsMWF1cmEgPT0gNCkge2FuZ2VsMUJQICs9IDEwO30KICAgICAgICBpZiAoYW5nZWwyYXVyYSA9PSA0KSB7YW5nZWwyQlAgKz0gMTA7fQogICAgICAgIAogICAgICAgIC8vaWYgcHVycGxlIGF1cmEsIDEwJSBjaGFuY2Ugb2Ygc3VkZGVuIGtpbGwKICAgICAgICBpZiAoKGFuZ2VsMWF1cmEgPT0gMikgJiYgKGdldFJhbmRvbU51bWJlcigxMDAsMCxtc2cuc2VuZGVyKSA8MTApKSB7cmV0dXJuIHRydWU7fQogICAgICAgIGlmICgoYW5nZWwyYXVyYSA9PSAyKSAmJiAoZ2V0UmFuZG9tTnVtYmVyKDEwMCwwLG1zZy5zZW5kZXIpIDwxMCkpIHtyZXR1cm4gZmFsc2U7fQogICAgICAgIAogICAgICAgIAogICAgICAgIC8vaWYgZ3JlZW4gYXVyYSwgMjAlIGNoYW5jZSBvZiArNzUgaHAKICAgICAgICBpZiAoKGFuZ2VsMWF1cmEgPT0gNSkgJiYgKGdldFJhbmRvbU51bWJlcigxMDAsMCxtc2cuc2VuZGVyKSA8MjApKSB7aHAxICs9IDc1O30KICAgICAgICBpZiAoKGFuZ2VsMmF1cmEgPT0gNSkgJiYgKGdldFJhbmRvbU51bWJlcigxMDAsMCxtc2cuc2VuZGVyKSA8MjApKSB7aHAyICs9NzU7fQogICAgICAgIAogICAgICAgIAogICAgICAgICAgIHVpbnQxNiBzdHJpa2U7CiAgICAgICAgICAgCiAgICAgICAgICAgLy9hdHRhY2tlciAodGVhbSAxKSBnZXRzIHRoZSBmaXJzdCBzdHJpa2UuCiAgICAgICAgICAgLy9zZWUgaWYgc3RyaWtlIHdpbGwgYmUgYW5nZWwgYW5kIHBldCBvciBqdXN0IGFuZ2VsLiAKICAgICAgICAgICBzdHJpa2UgPSBTdHJpa2UoYW5nZWwxQlAsaHAxLHBldFBvd2VyMSwxKTsKICAgICAgICAgICBpZiAoaHAyID4gc3RyaWtlKSB7aHAyID0gaHAyIC0gc3RyaWtlO30KICAgICAgICAgICBlbHNlIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAgICAgCiAgICAgICAgICAgLy9kZWZlbmRlciBnZXRzIHRoZSBzZWNvbmQgc3RyaWtlIGlmIHN0aWxsIGFsaXZlLiAgCiAgICAgICAgICAgc3RyaWtlID0gU3RyaWtlKGFuZ2VsMkJQLGhwMixwZXRQb3dlcjIsMik7CiAgICAgICAgICAgaWYgKGhwMSA+IHN0cmlrZSkge2hwMSA9IGhwMSAtIHN0cmlrZTt9CiAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTJJZCwgaHAyKTsKICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO30KICAgICAgICAgICAKICAgICAgICAvLyBzZWNvbmQgcm91bmQgKGlmIG5lY2Vzc2FyeSkKICAgICAgICAKICAgICAgICBpZiAoZ2V0RmFzdGVzdChiYXR0bGVib2FyZElkLCB0aWxlMUlkLCB0aWxlMklkKT09dHJ1ZSkgewogICAgICAgICAgICBpZiAoZ2V0UmFuZG9tTnVtYmVyKDEwMCwwLDIpID4gMzApIHsKICAgICAgICAgICAgICAgIC8vdGVhbSAxIGF0dGFja3MgZmlyc3QuIAogICAgICAgICAgICAgICAgICAgc3RyaWtlID0gU3RyaWtlKGFuZ2VsMUJQLGhwMSxwZXRQb3dlcjEsMyk7CiAgICAgICAgICAgICAgICAgICBpZiAoaHAyID4gc3RyaWtlKSB7aHAyID0gaHAyIC0gc3RyaWtlO30KICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgaHAxKTsKICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vdGVhbSAyIGF0dGFja3MgZmlyc3QgICAgCiAgICAgICAgICAgIHN0cmlrZSA9IFN0cmlrZShhbmdlbDJCUCxocDIscGV0UG93ZXIyLDQpOwogICAgICAgICAgIGlmIChocDEgPiBzdHJpa2UpIHtocDEgPSBocDEgLSBzdHJpa2U7fQogICAgICAgICAgIGVsc2UgewogICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTJJZCwgaHAyKTsKICAgICAgICAgICByZXR1cm4gZmFsc2U7fQogICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGdldEZhc3Rlc3QoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgdGlsZTJJZCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgaWYgKGdldFJhbmRvbU51bWJlcigxMDAsMCwyKSA+NzApIHsKICAgICAgICAgICAgICAgIC8vdGVhbSAxIGF0dGFja3MgZmlyc3QuIAogICAgICAgICAgICAgICAgICAgc3RyaWtlID0gU3RyaWtlKGFuZ2VsMUJQLGhwMSxwZXRQb3dlcjEsNSk7CiAgICAgICAgICAgICAgICAgICBpZiAoaHAyID4gc3RyaWtlKSB7aHAyID0gaHAyIC0gc3RyaWtlO30KICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgaHAxKTsKICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTt9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy90ZWFtIDIgYXR0YWNrcyBmaXJzdCAgICAKICAgICAgICAgICAgc3RyaWtlID0gU3RyaWtlKGFuZ2VsMkJQLGhwMixwZXRQb3dlcjIsNik7CiAgICAgICAgICAgaWYgKGhwMSA+IHN0cmlrZSkge2hwMSA9IGhwMSAtIHN0cmlrZTt9CiAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVIcChiYXR0bGVib2FyZElkLCB0aWxlMklkLCBocDIpOwogICAgICAgICAgIHJldHVybiBmYWxzZTt9CiAgICAgICAgICAgIH0KICAgICAgICAgICB9CiAgICAgICAgICAgCiAgICAgICAgICAgICAvLyB0aGlyZCByb3VuZCAoaWYgbmVjZXNzYXJ5KQogICAgICAgIAogICAgICAgIGlmIChnZXRGYXN0ZXN0KGJhdHRsZWJvYXJkSWQsIHRpbGUxSWQsIHRpbGUySWQpPT10cnVlKSB7CiAgICAgICAgICAgIGlmIChnZXRSYW5kb21OdW1iZXIoMTAwLDAsMikgPiAzMCkgewogICAgICAgICAgICAgICAgLy90ZWFtIDEgYXR0YWNrcyBmaXJzdC4gCiAgICAgICAgICAgICAgICAgICBzdHJpa2UgPSBTdHJpa2UoYW5nZWwxQlAsaHAxLHBldFBvd2VyMSw3KTsKICAgICAgICAgICAgICAgICAgIGlmIChocDIgPiBzdHJpa2UpIHtocDIgPSBocDIgLSBzdHJpa2U7fQogICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLnNldFRpbGVIcChiYXR0bGVib2FyZElkLCB0aWxlMUlkLCBocDEpOwogICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO30KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vdGVhbSAyIGF0dGFja3MgZmlyc3QgICAgCiAgICAgICAgICAgIHN0cmlrZSA9IFN0cmlrZShhbmdlbDJCUCxocDIscGV0UG93ZXIyLDgpOwogICAgICAgICAgIGlmIChocDEgPiBzdHJpa2UpIHtocDEgPSBocDEgLSBzdHJpa2U7fQogICAgICAgICAgIGVsc2Uge2JhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTJJZCwgaHAyKTsKICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO30KICAgICAgICB9CiAgICAgICAgaWYgKGdldEZhc3Rlc3QoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgdGlsZTJJZCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgaWYgKGdldFJhbmRvbU51bWJlcigxMDAsMCwyKSA+NzApIHsKICAgICAgICAgICAgICAgIC8vdGVhbSAxIGF0dGFja3MgZmlyc3QuIAogICAgICAgICAgICAgICAgICAgc3RyaWtlID0gU3RyaWtlKGFuZ2VsMUJQLGhwMSxwZXRQb3dlcjEsOSk7CiAgICAgICAgICAgICAgICAgICBpZiAoaHAyID4gc3RyaWtlKSB7aHAyID0gaHAyIC0gc3RyaWtlO30KICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgaHAxKTsKICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTt9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy90ZWFtIDIgYXR0YWNrcyBmaXJzdCAgICAKICAgICAgICAgICAgc3RyaWtlID0gU3RyaWtlKGFuZ2VsMkJQLGhwMixwZXRQb3dlcjIsMTApOwogICAgICAgICAgIGlmIChocDEgPiBzdHJpa2UpIHtocDEgPSBocDEgLSBzdHJpa2U7fQogICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuc2V0VGlsZUhwKGJhdHRsZWJvYXJkSWQsIHRpbGUySWQsIGhwMik7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTt9CiAgICAgICAgICAgIH0KICAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICAgIGlmIChocDEgPiBocDIpIHsKICAgICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuc2V0VGlsZUhwKGJhdHRsZWJvYXJkSWQsIHRpbGUxSWQsIGhwMS1ocDIpOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGhwMSA8IGhwMikgewogICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTJJZCwgaHAyLWhwMSk7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgICBpZiAoaHAxID09IGhwMikgewogICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgMSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgLy9pZiB0aGVzZSB0aXRhbnMgYXJlIHN0aWxsIGxlZnQgYWZ0ZXIgMyByb3VuZHMsIHRoZSB3aW5uZXIgaXMgdGhlIG9uZSB3aXRoIHRoZSBtb3N0IEhQLiAKICAgICAgICAvL1RoZSBsb3NlcidzIEhQIGdvZXMgdG8gMCBhbmQgdGhlIHdpbm5lcidzIEhQIGlzIHJlZHVjZWQgYnkgdGhlICBsb3NlcnMuIEluIHRoZSB1bmxpa2VseSBldmVudCBvZiBhIHRpZSwgdGhlIHdpbm5lciBnZXRzIDEgaHAuIAogICAgICAgIAogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTdHJpa2UodWludDE2IGJwLCB1aW50MzIgaHAsIHVpbnQxNiBwZXRQb3dlciwgdWludDggc2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNikgewogICAgICAgICAgICBpZiAoaHAgPiBwZXRIcFRocmVzaG9sZCkge3JldHVybiBnZXRSYW5kb21OdW1iZXIoYnArcGV0UG93ZXIsMjAsc2VlZCk7fQogICAgICAgICAgICByZXR1cm4gZ2V0UmFuZG9tTnVtYmVyKGJwLDIwLHNlZWQpOwogICAgICAgICAgICAvL1lvdXIgc3RyaWtlIGlzIGEgcmV0dXJuIG9mIGEgcmFuZG9tIGZyb20gMjAgdG8gYnAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgICAgIAogICAgICAgZnVuY3Rpb24gZmlnaHRNb25zdGVyKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlMUlkLCB1aW50OCBtb25zdGVySWQpIHByaXZhdGUgewogICAgICAgICAgICAgLy9GaXJzdCBnZXQgdGhlIHBhcmFtZXRlcnMuIAogICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAKICAgICAgICAgICB1aW50MzIgaHA7CiAgICAgICAgICAgdWludDE2IG1vbnN0ZXJIaXQ9IGdldFJhbmRvbU51bWJlcihtYXhNb25zdGVySGl0LCB1aW50OChtaW5Nb25zdGVySGl0KSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgdWludDY0IGFuZ2VsSWQ7CiAgICAgICAgICAgKCwgLCwsIGhwLCAsYW5nZWxJZCAsLCwpID0gYmF0dGxlYm9hcmREYXRhLmdldFRpbGVGcm9tQmF0dGxlYm9hcmQoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCk7CiAgICAgIAogICAgICAgICAgIGlmIChnZXRBdXJhQ29sb3IoYW5nZWxJZCkgIT0gMCkgeyAvLyBibHVlIGFuZ2VscyBhcmUgaW1tdW5lIHRvIG1vbnN0ZXJzLiAKICAgICAgICAgICAvL3NlZSBpZiB0aGUgYW5nZWwgdGVhbSBkaWVzIG9yIGp1c3QgbG9zZXMgaHAKICAgICAgICAgICBpZiAoaHAgPiBtb25zdGVySGl0KSB7CiAgICAgICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5zZXRUaWxlSHAoYmF0dGxlYm9hcmRJZCwgdGlsZTFJZCwgKGhwLW1vbnN0ZXJIaXQpKTsKICAgICAgICAgICB9CiAgICAgICAgICAgZWxzZSB7YmF0dGxlYm9hcmREYXRhLmtpbGxUaWxlKGJhdHRsZWJvYXJkSWQsIHRpbGUxSWQpO30KICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5raWxsTW9uc3RlcihiYXR0bGVib2FyZElkLCBtb25zdGVySWQpOyAKICAgICAgICAgICB9CiAgICAgICAgICAgRXZlbnRNb25zdGVyU3RyaWtlKGJhdHRsZWJvYXJkSWQsIGFuZ2VsSWQsIG1vbnN0ZXJIaXQpOwogICAgICAgICAgIAogICAgICAgfQogICAgICAgCiAgICAgICAKICAgICAgIGZ1bmN0aW9uIGNhbk1vdmUodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHBvc2l0aW9uMSwgdWludDggcG9zaXRpb24yKSBwdWJsaWMgY29uc3RhbnQgIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAvL3JldHVybnMgdHJ1ZSBpZiBhIHBpZWNlIGNhbiBtb3ZlIGZyb20gcG9zaXRpb24gMSB0byBwb3NpdGlvbiAyLiAKICAgICAgICAgICAKICAgICAgICAgICAvL21vdmVzIHVwIGFuZCBkb3duIGFyZSBwcm90ZWN0ZWQgZnJvbSBtb3Zpbmcgb2ZmIHRoZSBib2FyZCBieSB0aGUgcG9zaXRpb24gbnVtYmVycy4gCiAgICAgICAgICAgLy9DaGVjayBpZiB0cnlpbmcgdG8gbW92ZSBvZmYgdGhlIGJvYXJkIHRvIGxlZnQgCiAgICAgICAgICAgaWYgKCgocG9zaXRpb24xICUgOCkgPT0gMSkgJiYgKChwb3NpdGlvbjIgPT0gcG9zaXRpb24xLTEgKSB8fCAocG9zaXRpb24yID09IHBvc2l0aW9uMSAtMikpKSB7cmV0dXJuIGZhbHNlO30KICAgICAgICAgICBpZiAoKChwb3NpdGlvbjEgJSA4KSA9PSAyKSAmJiAocG9zaXRpb24yID09IChwb3NpdGlvbjEtMikpKSB7cmV0dXJuIGZhbHNlO30KICAgICAgICAgICAKICAgICAgICAgICAvL05vdyBjaGVjayBpZiB0cnlpbmcgdG8gbW92ZSBvZmYgYm9hcmQgdG8gcmlnaHQuIAogICAgICAgICAgICBpZiAoKChwb3NpdGlvbjEgJSA4KSA9PSAwKSAmJiAoKHBvc2l0aW9uMiA9PSBwb3NpdGlvbjErMSApIHx8IChwb3NpdGlvbjIgPT0gcG9zaXRpb24xICsyKSkpIHtyZXR1cm4gZmFsc2U7fQogICAgICAgICAgIGlmICgoKHBvc2l0aW9uMSAlIDgpID09IDcpICYmIChwb3NpdGlvbjIgPT0gKHBvc2l0aW9uMSsyKSkpIHtyZXR1cm4gZmFsc2U7fQogICAgICAgICAgIAogICAgICAgICAgICAgSUJhdHRsZWJvYXJkRGF0YSBiYXR0bGVib2FyZERhdGEgPSBJQmF0dGxlYm9hcmREYXRhKGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAvL2xlZ2FsIG1vdmUgbGVmdC4gRWl0aGVyIG1vdmUgb25lIHNwYWNlIG9yIG1vdmUgdHdvIHNwYWNlcywgd2l0aCBub3RoaW5nIGJsb2NraW5nIHRoZSBmaXJzdCBtb3ZlLiAKICAgICAgICAgICBpZiAoKHBvc2l0aW9uMiA9PSB1aW50OChzYWZlU3VidHJhY3QocG9zaXRpb24xLDEpKSkgfHwgKChwb3NpdGlvbjIgPT0gdWludDgoc2FmZVN1YnRyYWN0KHBvc2l0aW9uMSwyKSkpICAmJiAoYmF0dGxlYm9hcmREYXRhLmdldFRpbGVJRGJ5UG9zaXRpb24oYmF0dGxlYm9hcmRJZCxwb3NpdGlvbjEtMSkgPT0gMCkpKSB7cmV0dXJuIHRydWU7fQogICAgICAgICAgIAogICAgICAgICAgIC8vbGVnYWwgbW92ZSByaWdodAogICAgICAgICAgIGlmICgocG9zaXRpb24yID09IHBvc2l0aW9uMSArMSkgfHwgKChwb3NpdGlvbjIgPT0gcG9zaXRpb24xICsgMikgJiYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKGJhdHRsZWJvYXJkSWQsIHBvc2l0aW9uMSsxKSA9PSAwKSkpIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAgICAgCiAgICAgICAgICAgLy9sZWdhbCBtb3ZlIGRvd24KICAgICAgICAgICBpZiAoKHBvc2l0aW9uMiA9PSBwb3NpdGlvbjEgKzgpIHx8ICgocG9zaXRpb24yID09IHBvc2l0aW9uMSArIDE2KSAmJiAoYmF0dGxlYm9hcmREYXRhLmdldFRpbGVJRGJ5UG9zaXRpb24oYmF0dGxlYm9hcmRJZCwgcG9zaXRpb24xKzgpID09IDApKSkge3JldHVybiB0cnVlO30KICAgICAgICAgICAKICAgICAgICAgICAvL2xlZ2FsIG1vdmUgdXAKICAgICAgICAgICAgaWYgKChwb3NpdGlvbjIgPT0gdWludDgoc2FmZVN1YnRyYWN0KHBvc2l0aW9uMSw4KSkpIHx8ICgocG9zaXRpb24yID09IHVpbnQ4KHNhZmVTdWJ0cmFjdChwb3NpdGlvbjEsMTYpKSkgICYmIChiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEYnlQb3NpdGlvbihiYXR0bGVib2FyZElkLHBvc2l0aW9uMS04KSA9PSAwKSkpIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgCiAgICAgICB9CiAgICAgICAKICAgICAgIAoKICAgICAgIAogICAgCiAgICAgICBmdW5jdGlvbiByYW5kb21QZXRBdXJhQm9vc3QgKHVpbnQ2NCBfcGV0SWQsIHVpbnQ4IF9ib29zdCkgcHJpdmF0ZSAgewogICAgICAgSVBldENhcmREYXRhIHBldENhcmREYXRhID0gSVBldENhcmREYXRhKHBldENhcmREYXRhQ29udHJhY3QpOwogICAgICAgIHVpbnQxNiBhdXJhUmVkOwogICAgICAgIHVpbnQxNiBhdXJhQmx1ZTsKICAgICAgICB1aW50MTYgYXVyYVllbGxvdzsKICAgICAgICAoLCwsLGF1cmFSZWQsYXVyYUJsdWUsYXVyYVllbGxvdywsLCkgPSBwZXRDYXJkRGF0YS5nZXRQZXQoX3BldElkKTsKICAgICAgICAgICAgICAgdWludDggY2hhbmNlID0gZ2V0UmFuZG9tTnVtYmVyKDIsMCxtc2cuc2VuZGVyKTsKICAgICAgICAgICAgICAgaWYgKGNoYW5jZSA9PTApIHtwZXRDYXJkRGF0YS5zZXRQZXRBdXJhcyhfcGV0SWQsIHVpbnQ4KGF1cmFSZWQgKyBfYm9vc3QpLCB1aW50OChhdXJhQmx1ZSksIHVpbnQ4KGF1cmFZZWxsb3cpKTt9CiAgICAgICAgICAgICAgIGlmIChjaGFuY2UgPT0xKSB7cGV0Q2FyZERhdGEuc2V0UGV0QXVyYXMoX3BldElkLCB1aW50OChhdXJhUmVkKSwgdWludDgoYXVyYUJsdWUgKyBfYm9vc3QpLCB1aW50OChhdXJhWWVsbG93KSk7fQogICAgICAgICAgICAgICBpZiAoY2hhbmNlID09Mikge3BldENhcmREYXRhLnNldFBldEF1cmFzKF9wZXRJZCwgdWludDgoYXVyYVJlZCksIHVpbnQ4KGF1cmFCbHVlKSwgdWludDgoYXVyYVllbGxvdysgX2Jvb3N0KSk7fQogICAgICAgICAgICAgICB9CiAgICAgICAgIAogICAgICAgICAKCgoKICAgICAgIAogICAgICAgCiAgICAgICBmdW5jdGlvbiBnZXRBdXJhQ29sb3IodWludDY0IGFuZ2VsSWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICB1aW50OCBhbmdlbEF1cmE7CiAgICAgICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgICAoLCwsYW5nZWxBdXJhLCwsLCwsLCkgPSBhbmdlbENhcmREYXRhLmdldEFuZ2VsKGFuZ2VsSWQpOwogICAgICAgICAgIHJldHVybiBhbmdlbEF1cmE7CiAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlzVnVsbmVyYWJsZSh1aW50NjQgX2FuZ2VsSWQsIGludDggY29sb3IpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgIC8vUmV0dXJucyB0cnVlIGlmIGFuIGFuZ2VsIGlzIHZ1bG5lcmFibGUgdG8gYSBjZXJ0YWluIGNvbG9yIHRyYXAgCiAgICAgICAgICAgIC8vUmVkIGlzIDEsIFllbGxvdyBpcyAyLCBibHVlIGlzIDMKICAgICAgICAgICAgdWludDggYW5nZWxBdXJhOwogICAgICAgICAgICBJQW5nZWxDYXJkRGF0YSBhbmdlbENhcmREYXRhID0gSUFuZ2VsQ2FyZERhdGEoYW5nZWxDYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgKCwsLGFuZ2VsQXVyYSwsLCwsLCwpID0gYW5nZWxDYXJkRGF0YS5nZXRBbmdlbChfYW5nZWxJZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY29sb3IgPT0gMSkgewogICAgICAgICAgICAgICAgaWYgKChhbmdlbEF1cmEgPT0gMikgfHwgKGFuZ2VsQXVyYSA9PSAzKSB8fCAoYW5nZWxBdXJhID09IDQpKSB7cmV0dXJuIHRydWU7fQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY29sb3IgPT0gMikgewogICAgICAgICAgICAgICAgaWYgKChhbmdlbEF1cmEgPT0gMSkgfHwgKGFuZ2VsQXVyYSA9PSAzKSB8fCAoYW5nZWxBdXJhID09IDUpKSB7cmV0dXJuIHRydWU7fQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY29sb3IgPT0gMykgewogICAgICAgICAgICAgICAgaWYgKChhbmdlbEF1cmEgPT0gMCkgfHwgKGFuZ2VsQXVyYSA9PSAyKSB8fCAoYW5nZWxBdXJhID09IDUpKSB7cmV0dXJuIHRydWU7fQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgfQogIAogICAgICAgICAgIGZ1bmN0aW9uIGtpbGwoKSBvbmx5Q1JFQVRPUiBleHRlcm5hbCB7CiAgICAgICAgc2VsZmRlc3RydWN0KGNyZWF0b3JBZGRyZXNzKTsKICAgIH0KIAogICAgICAgIApmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKCkgIG9ubHlDUkVBVE9SIGV4dGVybmFsIHsKICAgIGNyZWF0b3JBZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7Cn0KCiAgICAgIAogICAgICAgIAogICAKfQ=='.
	

]
