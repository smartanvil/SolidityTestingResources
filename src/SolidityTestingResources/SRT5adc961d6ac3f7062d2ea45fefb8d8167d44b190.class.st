Class {
	#name : #SRT5adc961d6ac3f7062d2ea45fefb8d8167d44b190,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5adc961d6ac3f7062d2ea45fefb8d8167d44b190 >> base64 [
	^ 'bGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgdWludDI1NiB0b3RhbFN1cHBseV87CgogIC8qKgogICogQGRldiB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGluIGV4aXN0ZW5jZQogICovCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfYWRkZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBpbmNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHlfID0gdG90YWxTdXBwbHlfLmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IFdoaXRlbGlzdGFibGUgaXMgT3duYWJsZSB7CiAgICAKICAgIGV2ZW50IExvZ1VzZXJSZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCB1c2VyQWRkcmVzcyk7CiAgICBldmVudCBMb2dVc2VyVW5yZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCB1c2VyQWRkcmVzcyk7CiAgICAKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0ZWQ7CgogICAgZnVuY3Rpb24gcmVnaXN0ZXJVc2VyKGFkZHJlc3MgdXNlckFkZHJlc3MpIAogICAgICAgIHB1YmxpYyAKICAgICAgICBvbmx5T3duZXIgCiAgICB7CiAgICAgICAgcmVxdWlyZSh1c2VyQWRkcmVzcyAhPSAwKTsKICAgICAgICB3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10gPSB0cnVlOwogICAgICAgIExvZ1VzZXJSZWdpc3RlcmVkKG1zZy5zZW5kZXIsIHVzZXJBZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyVXNlcihhZGRyZXNzIHVzZXJBZGRyZXNzKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgb25seU93bmVyIAogICAgewogICAgICAgIHJlcXVpcmUod2hpdGVsaXN0ZWRbdXNlckFkZHJlc3NdID09IHRydWUpOwogICAgICAgIHdoaXRlbGlzdGVkW3VzZXJBZGRyZXNzXSA9IGZhbHNlOwogICAgICAgIExvZ1VzZXJVbnJlZ2lzdGVyZWQobXNnLnNlbmRlciwgdXNlckFkZHJlc3MpOwogICAgfQp9Cgpjb250cmFjdCBEaXNidXJzZW1lbnRIYW5kbGVyIGlzIE93bmFibGUgewoKICAgIHN0cnVjdCBEaXNidXJzZW1lbnQgewogICAgICAgIHVpbnQyNTYgdGltZXN0YW1wOwogICAgICAgIHVpbnQyNTYgdG9rZW5zOwogICAgfQoKICAgIGV2ZW50IExvZ1NldHVwKGFkZHJlc3MgaW5kZXhlZCB2ZXN0b3IsIHVpbnQyNTYgdG9rZW5zLCB1aW50MjU2IHRpbWVzdGFtcCk7CiAgICBldmVudCBMb2dDaGFuZ2VUaW1lc3RhbXAoYWRkcmVzcyBpbmRleGVkIHZlc3RvciwgdWludDI1NiBpbmRleCwgdWludDI1NiB0aW1lc3RhbXApOwogICAgZXZlbnQgTG9nV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKCiAgICBFUkMyMCBwdWJsaWMgdG9rZW47CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gRGlzYnVyc2VtZW50W10pIHB1YmxpYyBkaXNidXJzZW1lbnRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB3aXRoZHJhd25Ub2tlbnM7CgogICAgZnVuY3Rpb24gRGlzYnVyc2VtZW50SGFuZGxlcihhZGRyZXNzIF90b2tlbikgcHVibGljIHsKICAgICAgICB0b2tlbiA9IEVSQzIwKF90b2tlbik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IHRoZSBzYWxlIGNvbnRyYWN0IHRvIGNyZWF0ZSBhIGRpc2J1cnNlbWVudC4KICAgIC8vLyBAcGFyYW0gdmVzdG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBiZW5lZmljaWFyeS4KICAgIC8vLyBAcGFyYW0gdG9rZW5zIEFtb3VudCBvZiB0b2tlbnMgdG8gYmUgbG9ja2VkLgogICAgLy8vIEBwYXJhbSB0aW1lc3RhbXAgRnVuZHMgd2lsbCBiZSBsb2NrZWQgdW50aWwgdGhpcyB0aW1lc3RhbXAuCiAgICBmdW5jdGlvbiBzZXR1cERpc2J1cnNlbWVudCgKICAgICAgICBhZGRyZXNzIHZlc3RvciwKICAgICAgICB1aW50MjU2IHRva2VucywKICAgICAgICB1aW50MjU2IHRpbWVzdGFtcAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDwgdGltZXN0YW1wKTsKICAgICAgICBkaXNidXJzZW1lbnRzW3Zlc3Rvcl0ucHVzaChEaXNidXJzZW1lbnQodGltZXN0YW1wLCB0b2tlbnMpKTsKICAgICAgICBMb2dTZXR1cCh2ZXN0b3IsIHRpbWVzdGFtcCwgdG9rZW5zKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGFuZ2UgYW4gZXhpc3RpbmcgZGlzYnVyc2VtZW50LgogICAgLy8vIEBwYXJhbSB2ZXN0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIGJlbmVmaWNpYXJ5LgogICAgLy8vIEBwYXJhbSB0aW1lc3RhbXAgRnVuZHMgd2lsbCBiZSBsb2NrZWQgdW50aWwgdGhpcyB0aW1lc3RhbXAuCiAgICAvLy8gQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBEaXNidXJzZW1lbnRWZXN0aW5nIGluIHRoZSB2ZXN0aW5nIGFycmF5LgogICAgZnVuY3Rpb24gY2hhbmdlVGltZXN0YW1wKAogICAgICAgIGFkZHJlc3MgdmVzdG9yLAogICAgICAgIHVpbnQyNTYgaW5kZXgsCiAgICAgICAgdWludDI1NiB0aW1lc3RhbXAKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHRpbWVzdGFtcCk7CiAgICAgICAgcmVxdWlyZShpbmRleCA8IGRpc2J1cnNlbWVudHNbdmVzdG9yXS5sZW5ndGgpOwogICAgICAgIGRpc2J1cnNlbWVudHNbdmVzdG9yXVtpbmRleF0udGltZXN0YW1wID0gdGltZXN0YW1wOwogICAgICAgIExvZ0NoYW5nZVRpbWVzdGFtcCh2ZXN0b3IsIGluZGV4LCB0aW1lc3RhbXApOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIHRvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgIC8vLyBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgZnVuY3Rpb24gd2l0aGRyYXcoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICB1aW50MjU2IG1heFRva2VucyA9IGNhbGNNYXhXaXRoZHJhdygpOwogICAgICAgIHVpbnQyNTYgd2l0aGRyYXdBbW91bnQgPSB2YWx1ZSA8IG1heFRva2VucyA/IHZhbHVlIDogbWF4VG9rZW5zOwogICAgICAgIHdpdGhkcmF3blRva2Vuc1ttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLmFkZCh3aXRoZHJhd25Ub2tlbnNbbXNnLnNlbmRlcl0sIHdpdGhkcmF3QW1vdW50KTsKICAgICAgICB0b2tlbi50cmFuc2Zlcih0bywgd2l0aGRyYXdBbW91bnQpOwogICAgICAgIExvZ1dpdGhkcmF3KHRvLCB2YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlcyB0aGUgbWF4aW11bSBhbW91bnQgb2YgdmVzdGVkIHRva2VucwogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIHZlc3RlZCB0b2tlbnMgdG8gd2l0aGRyYXcKICAgIGZ1bmN0aW9uIGNhbGNNYXhXaXRoZHJhdygpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgbWF4VG9rZW5zID0gMDsKICAgICAgICBEaXNidXJzZW1lbnRbXSBzdG9yYWdlIHRlbXAgPSBkaXNidXJzZW1lbnRzW21zZy5zZW5kZXJdOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IHRlbXAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGJsb2NrLnRpbWVzdGFtcCA+IHRlbXBbaV0udGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICBtYXhUb2tlbnMgPSBTYWZlTWF0aC5hZGQobWF4VG9rZW5zLCB0ZW1wW2ldLnRva2Vucyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbWF4VG9rZW5zID0gU2FmZU1hdGguc3ViKG1heFRva2Vucywgd2l0aGRyYXduVG9rZW5zW21zZy5zZW5kZXJdKTsKICAgICAgICByZXR1cm4gbWF4VG9rZW5zOwogICAgfQp9CgpsaWJyYXJ5IFN0YXRlTWFjaGluZUxpYiB7CgogICAgc3RydWN0IFN0YWdlIHsKICAgICAgICAvLyBUaGUgaWQgb2YgdGhlIG5leHQgc3RhZ2UKICAgICAgICBieXRlczMyIG5leHRJZDsKCiAgICAgICAgLy8gVGhlIGlkZW50aWZpZXJzIGZvciB0aGUgYXZhaWxhYmxlIGZ1bmN0aW9ucyBpbiBlYWNoIHN0YWdlCiAgICAgICAgbWFwcGluZyhieXRlczQgPT4gYm9vbCkgYWxsb3dlZEZ1bmN0aW9uczsKICAgIH0KCiAgICBzdHJ1Y3QgU3RhdGUgewogICAgICAgIC8vIFRoZSBjdXJyZW50IHN0YWdlIGlkCiAgICAgICAgYnl0ZXMzMiBjdXJyZW50U3RhZ2VJZDsKCiAgICAgICAgLy8gQSBjYWxsYmFjayB0aGF0IGlzIGNhbGxlZCB3aGVuIGVudGVyaW5nIHRoaXMgc3RhZ2UKICAgICAgICBmdW5jdGlvbihieXRlczMyKSBpbnRlcm5hbCBvblRyYW5zaXRpb247CgogICAgICAgIC8vIENoZWNrcyBpZiBhIHN0YWdlIGlkIGlzIHZhbGlkCiAgICAgICAgbWFwcGluZyhieXRlczMyID0+IGJvb2wpIHZhbGlkU3RhZ2U7CgogICAgICAgIC8vIE1hcHMgc3RhZ2UgaWRzIHRvIHRoZWlyIFN0YWdlIHN0cnVjdHMKICAgICAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gU3RhZ2UpIHN0YWdlczsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBzZXRzIHRoZSBpbml0aWFsIHN0YWdlLiBJdCBoYXMgdG8gYmUgY2FsbGVkIGJlZm9yZSBjcmVhdGluZyBhbnkgdHJhbnNpdGlvbnMuCiAgICAvLy8gQHBhcmFtIHN0YWdlSWQgVGhlIGlkIG9mIHRoZSAobmV3KSBzdGFnZSB0byBzZXQgYXMgaW5pdGlhbCBzdGFnZS4KICAgIGZ1bmN0aW9uIHNldEluaXRpYWxTdGFnZShTdGF0ZSBzdG9yYWdlIHNlbGYsIGJ5dGVzMzIgc3RhZ2VJZCkgaW50ZXJuYWwgewogICAgICAgIHNlbGYudmFsaWRTdGFnZVtzdGFnZUlkXSA9IHRydWU7CiAgICAgICAgc2VsZi5jdXJyZW50U3RhZ2VJZCA9IHN0YWdlSWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhIHRyYW5zaXRpb24gZnJvbSAnZnJvbUlkJyB0byAndG9JZCcuIElmIGZyb21JZCBhbHJlYWR5IGhhZCBhIG5leHRJZCwgaXQgZGVsZXRlcyB0aGUgbm93IHVucmVhY2hhYmxlIHN0YWdlLgogICAgLy8vIEBwYXJhbSBmcm9tSWQgVGhlIGlkIG9mIHRoZSBzdGFnZSBmcm9tIHdoaWNoIHRoZSB0cmFuc2l0aW9uIGJlZ2lucy4KICAgIC8vLyBAcGFyYW0gdG9JZCBUaGUgaWQgb2YgdGhlIHN0YWdlIHRoYXQgd2lsbCBiZSByZWFjaGFibGUgZnJvbSAiZnJvbUlkIi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVRyYW5zaXRpb24oU3RhdGUgc3RvcmFnZSBzZWxmLCBieXRlczMyIGZyb21JZCwgYnl0ZXMzMiB0b0lkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShzZWxmLnZhbGlkU3RhZ2VbZnJvbUlkXSk7CgogICAgICAgIFN0YWdlIHN0b3JhZ2UgZnJvbSA9IHNlbGYuc3RhZ2VzW2Zyb21JZF07CgogICAgICAgIC8vIEludmFsaWRhdGUgdGhlIHN0YWdlIHRoYXQgd29uJ3QgYmUgcmVhY2hhYmxlIGFueSBtb3JlCiAgICAgICAgaWYgKGZyb20ubmV4dElkICE9IDApIHsKICAgICAgICAgICAgc2VsZi52YWxpZFN0YWdlW2Zyb20ubmV4dElkXSA9IGZhbHNlOwogICAgICAgICAgICBkZWxldGUgc2VsZi5zdGFnZXNbZnJvbS5uZXh0SWRdOwogICAgICAgIH0KCiAgICAgICAgZnJvbS5uZXh0SWQgPSB0b0lkOwogICAgICAgIHNlbGYudmFsaWRTdGFnZVt0b0lkXSA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgR29lcyB0byB0aGUgbmV4dCBzdGFnZSBpZiBwb3NpYmxlIChpZiB0aGUgbmV4dCBzdGFnZSBpcyB2YWxpZCkKICAgIGZ1bmN0aW9uIGdvVG9OZXh0U3RhZ2UoU3RhdGUgc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCB7CiAgICAgICAgU3RhZ2Ugc3RvcmFnZSBjdXJyZW50ID0gc2VsZi5zdGFnZXNbc2VsZi5jdXJyZW50U3RhZ2VJZF07CgogICAgICAgIHJlcXVpcmUoc2VsZi52YWxpZFN0YWdlW2N1cnJlbnQubmV4dElkXSk7CgogICAgICAgIHNlbGYuY3VycmVudFN0YWdlSWQgPSBjdXJyZW50Lm5leHRJZDsKCiAgICAgICAgc2VsZi5vblRyYW5zaXRpb24oY3VycmVudC5uZXh0SWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiB0aGUgYSBmdW5jdGlvbiBpcyBhbGxvd2VkIGluIHRoZSBjdXJyZW50IHN0YWdlLgogICAgLy8vIEBwYXJhbSBzZWxlY3RvciBBIGZ1bmN0aW9uIHNlbGVjdG9yIChieXRlczRba2VjY2FrMjU2KGZ1bmN0aW9uU2lnbmF0dXJlKV0pCiAgICAvLy8gQHJldHVybiB0cnVlIElmIHRoZSBmdW5jdGlvbiBpcyBhbGxvd2VkIGluIHRoZSBjdXJyZW50IHN0YWdlCiAgICBmdW5jdGlvbiBjaGVja0FsbG93ZWRGdW5jdGlvbihTdGF0ZSBzdG9yYWdlIHNlbGYsIGJ5dGVzNCBzZWxlY3RvcikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuc3RhZ2VzW3NlbGYuY3VycmVudFN0YWdlSWRdLmFsbG93ZWRGdW5jdGlvbnNbc2VsZWN0b3JdOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93IGEgZnVuY3Rpb24gaW4gdGhlIGdpdmVuIHN0YWdlLgogICAgLy8vIEBwYXJhbSBzdGFnZUlkIFRoZSBpZCBvZiB0aGUgc3RhZ2UKICAgIC8vLyBAcGFyYW0gc2VsZWN0b3IgQSBmdW5jdGlvbiBzZWxlY3RvciAoYnl0ZXM0W2tlY2NhazI1NihmdW5jdGlvblNpZ25hdHVyZSldKQogICAgZnVuY3Rpb24gYWxsb3dGdW5jdGlvbihTdGF0ZSBzdG9yYWdlIHNlbGYsIGJ5dGVzMzIgc3RhZ2VJZCwgYnl0ZXM0IHNlbGVjdG9yKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShzZWxmLnZhbGlkU3RhZ2Vbc3RhZ2VJZF0pOwogICAgICAgIHNlbGYuc3RhZ2VzW3N0YWdlSWRdLmFsbG93ZWRGdW5jdGlvbnNbc2VsZWN0b3JdID0gdHJ1ZTsKICAgIH0KCgp9Cgpjb250cmFjdCBTdGF0ZU1hY2hpbmUgewogICAgdXNpbmcgU3RhdGVNYWNoaW5lTGliIGZvciBTdGF0ZU1hY2hpbmVMaWIuU3RhdGU7CgogICAgZXZlbnQgTG9nVHJhbnNpdGlvbihieXRlczMyIGluZGV4ZWQgc3RhZ2VJZCwgdWludDI1NiBibG9ja051bWJlcik7CgogICAgU3RhdGVNYWNoaW5lTGliLlN0YXRlIGludGVybmFsIHN0YXRlOwoKICAgIC8qIFRoaXMgbW9kaWZpZXIgcGVyZm9ybXMgdGhlIGNvbmRpdGlvbmFsIHRyYW5zaXRpb25zIGFuZCBjaGVja3MgdGhhdCB0aGUgZnVuY3Rpb24gCiAgICAgKiB0byBiZSBleGVjdXRlZCBpcyBhbGxvd2VkIGluIHRoZSBjdXJyZW50IHN0YWdlCiAgICAgKi8KICAgIG1vZGlmaWVyIGNoZWNrQWxsb3dlZCB7CiAgICAgICAgY29uZGl0aW9uYWxUcmFuc2l0aW9ucygpOwogICAgICAgIHJlcXVpcmUoc3RhdGUuY2hlY2tBbGxvd2VkRnVuY3Rpb24obXNnLnNpZykpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gU3RhdGVNYWNoaW5lKCkgcHVibGljIHsKICAgICAgICAvLyBSZWdpc3RlciB0aGUgc3RhcnRDb25kaXRpb25zIGZ1bmN0aW9uIGFuZCB0aGUgb25UcmFuc2l0aW9uIGNhbGxiYWNrCiAgICAgICAgc3RhdGUub25UcmFuc2l0aW9uID0gb25UcmFuc2l0aW9uOwogICAgfQoKICAgIC8vLyBAZGV2IEdldHMgdGhlIGN1cnJlbnQgc3RhZ2UgaWQuCiAgICAvLy8gQHJldHVybiBUaGUgY3VycmVudCBzdGFnZSBpZC4KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRTdGFnZUlkKCkgcHVibGljIHZpZXcgcmV0dXJucyhieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlLmN1cnJlbnRTdGFnZUlkOwogICAgfQoKICAgIC8vLyBAZGV2IFBlcmZvcm1zIGNvbmRpdGlvbmFsIHRyYW5zaXRpb25zLiBDYW4gYmUgY2FsbGVkIGJ5IGFueW9uZS4KICAgIGZ1bmN0aW9uIGNvbmRpdGlvbmFsVHJhbnNpdGlvbnMoKSBwdWJsaWMgewoKICAgICAgICBieXRlczMyIG5leHRJZCA9IHN0YXRlLnN0YWdlc1tzdGF0ZS5jdXJyZW50U3RhZ2VJZF0ubmV4dElkOwoKICAgICAgICB3aGlsZSAoc3RhdGUudmFsaWRTdGFnZVtuZXh0SWRdKSB7CiAgICAgICAgICAgIFN0YXRlTWFjaGluZUxpYi5TdGFnZSBzdG9yYWdlIG5leHQgPSBzdGF0ZS5zdGFnZXNbbmV4dElkXTsKICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgc3RhZ2UncyBjb25kaXRpb24gaXMgdHJ1ZSwgZ28gdG8gbmV4dCBzdGFnZSBhbmQgY29udGludWUKICAgICAgICAgICAgaWYgKHN0YXJ0Q29uZGl0aW9ucyhuZXh0SWQpKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5nb1RvTmV4dFN0YWdlKCk7CiAgICAgICAgICAgICAgICBuZXh0SWQgPSBuZXh0Lm5leHRJZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IERldGVybWluZXMgd2hldGhlciB0aGUgY29uZGl0aW9ucyBmb3IgdHJhbnNpdGlvbmluZyB0byB0aGUgZ2l2ZW4gc3RhZ2UgYXJlIG1ldC4KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIGNvbmRpdGlvbnMgYXJlIG1ldCBmb3IgdGhlIGdpdmVuIHN0YWdlSWQuIEZhbHNlIGJ5IGRlZmF1bHQgKG11c3Qgb3ZlcnJpZGUgaW4gY2hpbGQgY29udHJhY3RzKS4KICAgIGZ1bmN0aW9uIHN0YXJ0Q29uZGl0aW9ucyhieXRlczMyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGJhY2sgY2FsbGVkIHdoZW4gdGhlcmUgaXMgYSBzdGFnZSB0cmFuc2l0aW9uLiBJdCBzaG91bGQgYmUgb3ZlcnJpZGRlbiBmb3IgYWRkaXRpb25hbCBmdW5jdGlvbmFsaXR5LgogICAgZnVuY3Rpb24gb25UcmFuc2l0aW9uKGJ5dGVzMzIgc3RhZ2VJZCkgaW50ZXJuYWwgewogICAgICAgIExvZ1RyYW5zaXRpb24oc3RhZ2VJZCwgYmxvY2subnVtYmVyKTsKICAgIH0KCgp9Cgpjb250cmFjdCBUaW1lZFN0YXRlTWFjaGluZSBpcyBTdGF0ZU1hY2hpbmUgewoKICAgIGV2ZW50IExvZ1NldFN0YWdlU3RhcnRUaW1lKGJ5dGVzMzIgaW5kZXhlZCBzdGFnZUlkLCB1aW50MjU2IHN0YXJ0VGltZSk7CgogICAgLy8gU3RvcmVzIHRoZSBzdGFydCB0aW1lc3RhbXAgZm9yIGVhY2ggc3RhZ2UgKHRoZSB2YWx1ZSBpcyAwIGlmIHRoZSBzdGFnZSBkb2Vzbid0IGhhdmUgYSBzdGFydCB0aW1lc3RhbXApLgogICAgbWFwcGluZyhieXRlczMyID0+IHVpbnQyNTYpIGludGVybmFsIHN0YXJ0VGltZTsKCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG92ZXJyaWRlcyB0aGUgc3RhcnRDb25kaXRpb25zIGZ1bmN0aW9uIGluIHRoZSBwYXJlbnQgY29udHJhY3QgaW4gb3JkZXIgdG8gZW5hYmxlIGF1dG9tYXRpYyB0cmFuc2l0aW9ucyB0aGF0IGRlcGVuZCBvbiB0aGUgdGltZXN0YW1wLgogICAgZnVuY3Rpb24gc3RhcnRDb25kaXRpb25zKGJ5dGVzMzIgc3RhZ2VJZCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgLy8gR2V0IHRoZSBzdGFydFRpbWUgZm9yIHN0YWdlCiAgICAgICAgdWludDI1NiBzdGFydCA9IHN0YXJ0VGltZVtzdGFnZUlkXTsKICAgICAgICAvLyBJZiB0aGUgc3RhcnRUaW1lIGlzIHNldCBhbmQgaGFzIGFscmVhZHkgcGFzc2VkLCByZXR1cm4gdHJ1ZS4KICAgICAgICByZXR1cm4gc3RhcnQgIT0gMCAmJiBibG9jay50aW1lc3RhbXAgPiBzdGFydDsKICAgIH0KCiAgICAvLy8gQGRldiBTZXRzIHRoZSBzdGFydGluZyB0aW1lc3RhbXAgZm9yIGEgc3RhZ2UuCiAgICAvLy8gQHBhcmFtIHN0YWdlSWQgVGhlIGlkIG9mIHRoZSBzdGFnZSBmb3Igd2hpY2ggd2Ugd2FudCB0byBzZXQgdGhlIHN0YXJ0IHRpbWVzdGFtcC4KICAgIC8vLyBAcGFyYW0gdGltZXN0YW1wIFRoZSBzdGFydCB0aW1lc3RhbXAgZm9yIHRoZSBnaXZlbiBzdGFnZS4gSXQgc2hvdWxkIGJlIGJpZ2dlciB0aGFuIHRoZSBjdXJyZW50IG9uZS4KICAgIGZ1bmN0aW9uIHNldFN0YWdlU3RhcnRUaW1lKGJ5dGVzMzIgc3RhZ2VJZCwgdWludDI1NiB0aW1lc3RhbXApIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKHN0YXRlLnZhbGlkU3RhZ2Vbc3RhZ2VJZF0pOwogICAgICAgIHJlcXVpcmUodGltZXN0YW1wID4gYmxvY2sudGltZXN0YW1wKTsKCiAgICAgICAgc3RhcnRUaW1lW3N0YWdlSWRdID0gdGltZXN0YW1wOwogICAgICAgIExvZ1NldFN0YWdlU3RhcnRUaW1lKHN0YWdlSWQsIHRpbWVzdGFtcCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgdGltZXN0YW1wIGZvciB0aGUgZ2l2ZW4gc3RhZ2UgaWQuCiAgICAvLy8gQHBhcmFtIHN0YWdlSWQgVGhlIGlkIG9mIHRoZSBzdGFnZSBmb3Igd2hpY2ggd2Ugd2FudCB0byBzZXQgdGhlIHN0YXJ0IHRpbWVzdGFtcC4KICAgIGZ1bmN0aW9uIGdldFN0YWdlU3RhcnRUaW1lKGJ5dGVzMzIgc3RhZ2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHN0YXJ0VGltZVtzdGFnZUlkXTsKICAgIH0KfQoKY29udHJhY3QgU2FsZSBpcyBPd25hYmxlLCBUaW1lZFN0YXRlTWFjaGluZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBldmVudCBMb2dDb250cmlidXRpb24oYWRkcmVzcyBpbmRleGVkIGNvbnRyaWJ1dG9yLCB1aW50MjU2IGFtb3VudFNlbnQsIHVpbnQyNTYgZXhjZXNzUmVmdW5kZWQpOwogICAgZXZlbnQgTG9nVG9rZW5BbGxvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBjb250cmlidXRvciwgdWludDI1NiBjb250cmlidXRpb24sIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IExvZ0Rpc2J1cnNlbWVudChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdG9rZW5zKTsKCiAgICAvLyBTdGFnZXMgZm9yIHRoZSBzdGF0ZSBtYWNoaW5lCiAgICBieXRlczMyIHB1YmxpYyBjb25zdGFudCBTRVRVUCA9ICJzZXR1cCI7CiAgICBieXRlczMyIHB1YmxpYyBjb25zdGFudCBTRVRVUF9ET05FID0gInNldHVwRG9uZSI7CiAgICBieXRlczMyIHB1YmxpYyBjb25zdGFudCBTQUxFX0lOX1BST0dSRVNTID0gInNhbGVJblByb2dyZXNzIjsKICAgIGJ5dGVzMzIgcHVibGljIGNvbnN0YW50IFNBTEVfRU5ERUQgPSAic2FsZUVuZGVkIjsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNvbnRyaWJ1dGlvbnM7CgogICAgdWludDI1NiBwdWJsaWMgd2VpQ29udHJpYnV0ZWQgPSAwOwogICAgdWludDI1NiBwdWJsaWMgY29udHJpYnV0aW9uQ2FwOwoKICAgIC8vIFdhbGxldCB3aGVyZSBmdW5kcyB3aWxsIGJlIHNlbnQKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgICBNaW50YWJsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICBEaXNidXJzZW1lbnRIYW5kbGVyIHB1YmxpYyBkaXNidXJzZW1lbnRIYW5kbGVyOwoKICAgIGZ1bmN0aW9uIFNhbGUoCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0LCAKICAgICAgICB1aW50MjU2IF9jb250cmlidXRpb25DYXAKICAgICkgCiAgICAgICAgcHVibGljIAogICAgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAwKTsKICAgICAgICByZXF1aXJlKF9jb250cmlidXRpb25DYXAgIT0gMCk7CgogICAgICAgIHdhbGxldCA9IF93YWxsZXQ7CgogICAgICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgICAgIGRpc2J1cnNlbWVudEhhbmRsZXIgPSBuZXcgRGlzYnVyc2VtZW50SGFuZGxlcih0b2tlbik7CgogICAgICAgIGNvbnRyaWJ1dGlvbkNhcCA9IF9jb250cmlidXRpb25DYXA7CgogICAgICAgIHNldHVwU3RhZ2VzKCk7CiAgICB9CgogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBjb250cmlidXRlKCk7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyB0aGUgc3RhcnQgdGltZXN0YW1wIGZvciB0aGUgU0FMRV9JTl9QUk9HUkVTUyBzdGFnZS4KICAgIC8vLyBAcGFyYW0gdGltZXN0YW1wIFRoZSBzdGFydCB0aW1lc3RhbXAuCiAgICBmdW5jdGlvbiBzZXRTYWxlU3RhcnRUaW1lKHVpbnQyNTYgdGltZXN0YW1wKSAKICAgICAgICBleHRlcm5hbCAKICAgICAgICBvbmx5T3duZXIgCiAgICAgICAgY2hlY2tBbGxvd2VkCiAgICB7CiAgICAgICAgLy8gcmVxdWlyZShfc3RhcnRUaW1lIDwgZ2V0U3RhZ2VTdGFydFRpbWUoU0FMRV9FTkRFRCkpOwogICAgICAgIHNldFN0YWdlU3RhcnRUaW1lKFNBTEVfSU5fUFJPR1JFU1MsIHRpbWVzdGFtcCk7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyB0aGUgc3RhcnQgdGltZXN0YW1wIGZvciB0aGUgU0FMRV9FTkRFRCBzdGFnZS4KICAgIC8vLyBAcGFyYW0gdGltZXN0YW1wIFRoZSBzdGFydCB0aW1lc3RhbXAuCiAgICBmdW5jdGlvbiBzZXRTYWxlRW5kVGltZSh1aW50MjU2IHRpbWVzdGFtcCkgCiAgICAgICAgZXh0ZXJuYWwgCiAgICAgICAgb25seU93bmVyIAogICAgICAgIGNoZWNrQWxsb3dlZAogICAgewogICAgICAgIHJlcXVpcmUoZ2V0U3RhZ2VTdGFydFRpbWUoU0FMRV9JTl9QUk9HUkVTUykgPCB0aW1lc3RhbXApOwogICAgICAgIHNldFN0YWdlU3RhcnRUaW1lKFNBTEVfRU5ERUQsIHRpbWVzdGFtcCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGluIHRoZSBTRVRVUCBzdGFnZSwgY2hlY2sgY29uZmlndXJhdGlvbnMgYW5kIHRvIGdvIHRvIHRoZSBTRVRVUF9ET05FIHN0YWdlLgogICAgZnVuY3Rpb24gc2V0dXBEb25lKCkgCiAgICAgICAgcHVibGljIAogICAgICAgIG9ubHlPd25lciAKICAgICAgICBjaGVja0FsbG93ZWQKICAgIHsKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUgPSBnZXRTdGFnZVN0YXJ0VGltZShTQUxFX0lOX1BST0dSRVNTKTsKICAgICAgICB1aW50MjU2IF9lbmRUaW1lID0gZ2V0U3RhZ2VTdGFydFRpbWUoU0FMRV9FTkRFRCk7CiAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBfc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPCBfZW5kVGltZSk7CgogICAgICAgIHN0YXRlLmdvVG9OZXh0U3RhZ2UoKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxsZWQgYnkgdXNlcnMgdG8gY29udHJpYnV0ZSBFVEggdG8gdGhlIHNhbGUuCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkgCiAgICAgICAgcHVibGljIAogICAgICAgIHBheWFibGUKICAgICAgICBjaGVja0FsbG93ZWQgCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsgICAKCiAgICAgICAgdWludDI1NiBjb250cmlidXRpb25MaW1pdCA9IGdldENvbnRyaWJ1dGlvbkxpbWl0KG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoY29udHJpYnV0aW9uTGltaXQgPiAwKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIGNvbnRyaWJ1dGUKICAgICAgICB1aW50MjU2IHRvdGFsQ29udHJpYnV0aW9uID0gY29udHJpYnV0aW9uc1ttc2cuc2VuZGVyXS5hZGQobXNnLnZhbHVlKTsKICAgICAgICB1aW50MjU2IGV4Y2VzcyA9IDA7CgogICAgICAgIC8vIENoZWNrIGlmIGl0IGdvZXMgb3ZlciB0aGUgZXRoIGNhcCBmb3IgdGhlIHNhbGUuCiAgICAgICAgaWYgKHdlaUNvbnRyaWJ1dGVkLmFkZChtc2cudmFsdWUpID4gY29udHJpYnV0aW9uQ2FwKSB7CiAgICAgICAgICAgIC8vIFN1YnRyYWN0IHRoZSBleGNlc3MKICAgICAgICAgICAgZXhjZXNzID0gd2VpQ29udHJpYnV0ZWQuYWRkKG1zZy52YWx1ZSkuc3ViKGNvbnRyaWJ1dGlvbkNhcCk7CiAgICAgICAgICAgIHRvdGFsQ29udHJpYnV0aW9uID0gdG90YWxDb250cmlidXRpb24uc3ViKGV4Y2Vzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayBpZiBpdCBnb2VzIG92ZXIgdGhlIGNvbnRyaWJ1dGlvbiBsaW1pdCBvZiB0aGUgdXNlci4gCiAgICAgICAgaWYgKHRvdGFsQ29udHJpYnV0aW9uID4gY29udHJpYnV0aW9uTGltaXQpIHsKICAgICAgICAgICAgZXhjZXNzID0gZXhjZXNzLmFkZCh0b3RhbENvbnRyaWJ1dGlvbikuc3ViKGNvbnRyaWJ1dGlvbkxpbWl0KTsKICAgICAgICAgICAgY29udHJpYnV0aW9uc1ttc2cuc2VuZGVyXSA9IGNvbnRyaWJ1dGlvbkxpbWl0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl0gPSB0b3RhbENvbnRyaWJ1dGlvbjsKICAgICAgICB9CgogICAgICAgIC8vIFdlIGFyZSBvbmx5IGFibGUgdG8gcmVmdW5kIHVwIHRvIG1zZy52YWx1ZSBiZWNhdXNlIHRoZSBjb250cmFjdCB3aWxsIG5vdCBjb250YWluIGV0aGVyCiAgICAgICAgLy8gZXhjZXNzID0gZXhjZXNzIDwgbXNnLnZhbHVlID8gZXhjZXNzIDogbXNnLnZhbHVlOwogICAgICAgIHJlcXVpcmUoZXhjZXNzIDw9IG1zZy52YWx1ZSk7CgogICAgICAgIHdlaUNvbnRyaWJ1dGVkID0gd2VpQ29udHJpYnV0ZWQuYWRkKG1zZy52YWx1ZSkuc3ViKGV4Y2Vzcyk7CgogICAgICAgIGlmIChleGNlc3MgPiAwKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXhjZXNzKTsKICAgICAgICB9CgogICAgICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoKICAgICAgICBhc3NlcnQoY29udHJpYnV0aW9uc1ttc2cuc2VuZGVyXSA8PSBjb250cmlidXRpb25MaW1pdCk7CiAgICAgICAgTG9nQ29udHJpYnV0aW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgZXhjZXNzKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGUgYSBkaXNidXJzZW1lbnQgb2YgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBiZW5lZmljaWFyeSBUaGUgYmVuZWZpY2lhcnkgb2YgdGhlIGRpc2J1cnNlbWVudC4KICAgIC8vLyBAcGFyYW0gdG9rZW5BbW91bnQgQW1vdW50IG9mIHRva2VucyB0byBiZSBsb2NrZWQuCiAgICAvLy8gQHBhcmFtIHRpbWVzdGFtcCBUb2tlbnMgd2lsbCBiZSBsb2NrZWQgdW50aWwgdGhpcyB0aW1lc3RhbXAuCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygKICAgICAgICBhZGRyZXNzIGJlbmVmaWNpYXJ5LAogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQsCiAgICAgICAgdWludDI1NiB0aW1lc3RhbXAKICAgICkgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgY2hlY2tBbGxvd2VkCiAgICB7IAogICAgICAgIGRpc2J1cnNlbWVudEhhbmRsZXIuc2V0dXBEaXNidXJzZW1lbnQoCiAgICAgICAgICAgIGJlbmVmaWNpYXJ5LAogICAgICAgICAgICB0b2tlbkFtb3VudCwKICAgICAgICAgICAgdGltZXN0YW1wCiAgICAgICAgKTsKICAgICAgICB0b2tlbi5taW50KGRpc2J1cnNlbWVudEhhbmRsZXIsIHRva2VuQW1vdW50KTsKICAgICAgICBMb2dEaXNidXJzZW1lbnQoYmVuZWZpY2lhcnksIHRva2VuQW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0dXBTdGFnZXMoKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gU2V0IHRoZSBzdGFnZXMKICAgICAgICBzdGF0ZS5zZXRJbml0aWFsU3RhZ2UoU0VUVVApOwogICAgICAgIHN0YXRlLmNyZWF0ZVRyYW5zaXRpb24oU0VUVVAsIFNFVFVQX0RPTkUpOwogICAgICAgIHN0YXRlLmNyZWF0ZVRyYW5zaXRpb24oU0VUVVBfRE9ORSwgU0FMRV9JTl9QUk9HUkVTUyk7CiAgICAgICAgc3RhdGUuY3JlYXRlVHJhbnNpdGlvbihTQUxFX0lOX1BST0dSRVNTLCBTQUxFX0VOREVEKTsKCiAgICAgICAgc3RhdGUuYWxsb3dGdW5jdGlvbihTRVRVUCwgdGhpcy5kaXN0cmlidXRlVGltZWxvY2tlZFRva2Vucy5zZWxlY3Rvcik7CiAgICAgICAgc3RhdGUuYWxsb3dGdW5jdGlvbihTRVRVUCwgdGhpcy5zZXRTYWxlU3RhcnRUaW1lLnNlbGVjdG9yKTsKICAgICAgICBzdGF0ZS5hbGxvd0Z1bmN0aW9uKFNFVFVQLCB0aGlzLnNldFNhbGVFbmRUaW1lLnNlbGVjdG9yKTsKICAgICAgICBzdGF0ZS5hbGxvd0Z1bmN0aW9uKFNFVFVQLCB0aGlzLnNldHVwRG9uZS5zZWxlY3Rvcik7CiAgICAgICAgc3RhdGUuYWxsb3dGdW5jdGlvbihTQUxFX0lOX1BST0dSRVNTLCB0aGlzLmNvbnRyaWJ1dGUuc2VsZWN0b3IpOwogICAgICAgIHN0YXRlLmFsbG93RnVuY3Rpb24oU0FMRV9JTl9QUk9HUkVTUywgMCk7IC8vIGZhbGxiYWNrCiAgICB9CgogICAgLy8gT3ZlcnJpZGUgaW4gdGhlIGNoaWxkIHNhbGVzCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAoTWludGFibGVUb2tlbik7CiAgICBmdW5jdGlvbiBnZXRDb250cmlidXRpb25MaW1pdChhZGRyZXNzIHVzZXJBZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKCiAgICAvLy8gQGRldiBTdGFnZSBzdGFydCBjb25kaXRpb25zLgogICAgZnVuY3Rpb24gc3RhcnRDb25kaXRpb25zKGJ5dGVzMzIgc3RhZ2VJZCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIElmIHRoZSBjYXAgaGFzIGJlZW4gcmVhY2hlZCwgZW5kIHRoZSBzYWxlLgogICAgICAgIGlmIChzdGFnZUlkID09IFNBTEVfRU5ERUQgJiYgY29udHJpYnV0aW9uQ2FwIDw9IHdlaUNvbnRyaWJ1dGVkKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VwZXIuc3RhcnRDb25kaXRpb25zKHN0YWdlSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFN0YXRlIHRyYW5zaXRpb25zIGNhbGxiYWNrcy4KICAgIGZ1bmN0aW9uIG9uVHJhbnNpdGlvbihieXRlczMyIHN0YWdlSWQpIGludGVybmFsIHsKICAgICAgICBpZiAoc3RhZ2VJZCA9PSBTQUxFX0VOREVEKSB7IAogICAgICAgICAgICBvblNhbGVFbmRlZCgpOyAKICAgICAgICB9CiAgICAgICAgc3VwZXIub25UcmFuc2l0aW9uKHN0YWdlSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGxiYWNrIHRoYXQgZ2V0cyBjYWxsZWQgd2hlbiBlbnRlcmluZyB0aGUgU0FMRV9FTkRFRCBzdGFnZS4KICAgIGZ1bmN0aW9uIG9uU2FsZUVuZGVkKCkgaW50ZXJuYWwge30KfQoKY29udHJhY3QgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewoKICAgIC8vLyBAZGV2IFN0YW5kYXJkIEVSQzIyMyBmdW5jdGlvbiB0aGF0IHdpbGwgaGFuZGxlIGluY29taW5nIHRva2VuIHRyYW5zZmVycy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gIFRva2VuIHNlbmRlciBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX2RhdGEgIFRyYW5zYWN0aW9uIG1ldGFkYXRhLgogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKCn0KCmNvbnRyYWN0IEVSQzIyM0Jhc2ljIGlzIEVSQzIwQmFzaWMgewoKICAgIC8qKgogICAgICAqIEBkZXYgVHJhbnNmZXIgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAgKiAgICAgIE5vdyB3aXRoIGEgbmV3IHBhcmFtZXRlciBfZGF0YS4KICAgICAgKgogICAgICAqIEBwYXJhbSBfdG8gICAgUmVjZWl2ZXIgYWRkcmVzcy4KICAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkLgogICAgICAqIEBwYXJhbSBfZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAgICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLyoqCiAgICAgICogQGRldiB0cmlnZ2VyZWQgd2hlbiB0cmFuc2ZlciBpcyBzdWNjZXNzZnVsbHkgY2FsbGVkLgogICAgICAqCiAgICAgICogQHBhcmFtIF9mcm9tICBTZW5kZXIgYWRkcmVzcy4KICAgICAgKiBAcGFyYW0gX3RvICAgIFJlY2VpdmVyIGFkZHJlc3MuCiAgICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcnJlZC4KICAgICAgKiBAcGFyYW0gX2RhdGEgIFRyYW5zYWN0aW9uIG1ldGFkYXRhLgogICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IGluZGV4ZWQgX3ZhbHVlLCBieXRlcyBfZGF0YSk7Cn0KCgpjb250cmFjdCBFUkMyMjNCYXNpY1Rva2VuIGlzIEVSQzIyM0Jhc2ljLCBCYXNpY1Rva2VuIHsKCiAgICAvKioKICAgICAgKiBAZGV2IFRyYW5zZmVyIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyB0byB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAgICogICAgICBJbnZva2VzIHRoZSBgdG9rZW5GYWxsYmFja2AgZnVuY3Rpb24gaWYgdGhlIHJlY2lwaWVudCBpcyBhIGNvbnRyYWN0LgogICAgICAqICAgICAgVGhlIHRva2VuIHRyYW5zZmVyIGZhaWxzIGlmIHRoZSByZWNpcGllbnQgaXMgYSBjb250cmFjdAogICAgICAqICAgICAgYnV0IGRvZXMgbm90IGltcGxlbWVudCB0aGUgYHRva2VuRmFsbGJhY2tgIGZ1bmN0aW9uCiAgICAgICogICAgICBvciB0aGUgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcmVjZWl2ZSBmdW5kcy4KICAgICAgKgogICAgICAqIEBwYXJhbSBfdG8gICAgUmVjZWl2ZXIgYWRkcmVzcy4KICAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHRyYW5zZmVycmVkLgogICAgICAqIEBwYXJhbSBfZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAgICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIFN0YW5kYXJkIGZ1bmN0aW9uIHRyYW5zZmVyIHNpbWlsYXIgdG8gRVJDMjAgdHJhbnNmZXIgd2l0aCBubyBfZGF0YSAuCiAgICAgICAgLy8gQWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMgLgogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseSAuCiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSkpOwoKICAgICAgICBpZihjb2RlTGVuZ3RoPjApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgICAgLyoqCiAgICAgICogQGRldiBUcmFuc2ZlciB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgICAqICAgICAgSW52b2tlcyB0aGUgYHRva2VuRmFsbGJhY2tgIGZ1bmN0aW9uIGlmIHRoZSByZWNpcGllbnQgaXMgYSBjb250cmFjdC4KICAgICAgKiAgICAgIFRoZSB0b2tlbiB0cmFuc2ZlciBmYWlscyBpZiB0aGUgcmVjaXBpZW50IGlzIGEgY29udHJhY3QKICAgICAgKiAgICAgIGJ1dCBkb2VzIG5vdCBpbXBsZW1lbnQgdGhlIGB0b2tlbkZhbGxiYWNrYCBmdW5jdGlvbgogICAgICAqICAgICAgb3IgdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHJlY2VpdmUgZnVuZHMuCiAgICAgICoKICAgICAgKiBAcGFyYW0gX3RvICAgIFJlY2VpdmVyIGFkZHJlc3MuCiAgICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcnJlZC4KICAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlcihfdG8sIF92YWx1ZSwgZW1wdHkpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCmNvbnRyYWN0IERldGFpbGVkRVJDMjAgaXMgRVJDMjAgewogIHN0cmluZyBwdWJsaWMgbmFtZTsKICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgogIGZ1bmN0aW9uIERldGFpbGVkRVJDMjAoc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDggX2RlY2ltYWxzKSBwdWJsaWMgewogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwogIH0KfQoKY29udHJhY3QgRGV0aGVyVG9rZW4gaXMgRGV0YWlsZWRFUkMyMCwgTWludGFibGVUb2tlbiwgRVJDMjIzQmFzaWNUb2tlbiB7CiAgICBzdHJpbmcgY29uc3RhbnQgTkFNRSA9ICJEZXRoZXIiOwogICAgc3RyaW5nIGNvbnN0YW50IFNZTUJPTCA9ICJEVEgiOwogICAgdWludDggY29uc3RhbnQgREVDSU1BTFMgPSAxODsKCiAgICAvKioKICAgICAgKkBkZXYgQ29uc3RydWN0b3IgdGhhdCBzZXQgRGV0YWlsZWQgb2YgdGhlIEVSQzIwIHRva2VuLgogICAgICAqLwogICAgZnVuY3Rpb24gRGV0aGVyVG9rZW4oKQogICAgICAgIERldGFpbGVkRVJDMjAoTkFNRSwgU1lNQk9MLCBERUNJTUFMUykKICAgICAgICBwdWJsaWMKICAgIHt9Cn0KCgpjb250cmFjdCBEZXRoZXJTYWxlIGlzIFNhbGUsIFdoaXRlbGlzdGFibGUgewoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBSRVNBTEVfV0VJID0gMzk1NiBldGhlciAqIDEuMTUgKyA0OTAgZXRoZXI7IC8vIEFtb3VudCByYWlzZWQgaW4gdGhlIHByZXNhbGUgaW5jbHVkaW5nIGJvbnVzCgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgREVDSU1BTFNfTVVMVElQTElFUiA9IDEwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBNQVhfRFRIID0gMTAwMDAwMDAwICogREVDSU1BTFNfTVVMVElQTElFUjsKCiAgICAvLyBNQVhfV0VJIC0gUFJFU0FMRV9XRUkKICAgIC8vIFRPRE86IGNoYW5nZSB0byBhY3R1YWwgYW1vdW50CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBXRUlfQ0FQID0gMTA1NTQgZXRoZXI7CgogICAgLy8gRHVyYXRpb24gb2YgdGhlIHdoaXRlbGlzdGluZyBwaGFzZQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgV0hJVEVMSVNUSU5HX0RVUkFUSU9OID0gMiBkYXlzOwoKICAgIC8vIENvbnRyaWJ1dGlvbiBsaW1pdCBmb3IgdGhlIHdoaXRlbGlzdGluZyBwaGFzZQogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgV0hJVEVMSVNUSU5HX01BWF9DT05UUklCVVRJT04gPSA1IGV0aGVyOwoKICAgIC8vIENvbnRyaWJ1dGlvbiBsaW1pdCBmb3IgdGhlIHB1YmxpYyBzYWxlCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQVUJMSUNfTUFYX0NPTlRSSUJVVElPTiA9IDIqKjI1NiAtIDE7CgogICAgLy8gTWluaW11bSBjb250cmlidXRpb24gYWxsb3dlZAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUlOX0NPTlRSSUJVVElPTiA9IDAuMSBldGhlcjsKCiAgICAvLyB3ZWkgcGVyIERUSAogICAgdWludDI1NiBwdWJsaWMgd2VpUGVyRFRIOwogICAgLy8gdHJ1ZSBpZiB0aGUgbG9ja2VkIHRva2VucyBoYXZlIGJlZW4gZGlzdHJpYnV0ZWQKICAgIGJvb2wgcHJpdmF0ZSBsb2NrZWRUb2tlbnNEaXN0cmlidXRlZDsKICAgIC8vIHRydWUgaWYgdGhlIHByZXNhbGUgdG9rZW5zIGhhdmUgYmVlbiBhbGxvY2F0ZWQKICAgIGJvb2wgcHJpdmF0ZSBwcmVzYWxlQWxsb2NhdGVkOwoKICAgIC8vIEFkZHJlc3MgZm9yIHRoZSBwcmVzYWxlIGJ1eWVycyAoRGV0aGVyIHRlYW0gd2lsbCBkaXN0cmlidXRlIG1hbnVhbGx5KQogICAgYWRkcmVzcyBwdWJsaWMgcHJlc2FsZUFkZHJlc3M7CgogICAgdWludDI1NiBwcml2YXRlIHdlaUFsbG9jYXRlZDsKCiAgICAvLyBDb250cmlidXRpb24gbGltaXRzIHNwZWNpZmllZCBmb3IgdGhlIHByZXNhbGUKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcHJlc2FsZU1heENvbnRyaWJ1dGlvbjsKCiAgICBmdW5jdGlvbiBEZXRoZXJTYWxlKGFkZHJlc3MgX3dhbGxldCwgYWRkcmVzcyBfcHJlc2FsZUFkZHJlc3MpIFNhbGUoX3dhbGxldCwgV0VJX0NBUCkgcHVibGljIHsKICAgICAgcHJlc2FsZUFkZHJlc3MgPSBfcHJlc2FsZUFkZHJlc3M7CiAgICB9CgogICAgLy8vIEBkZXYgRGlzdHJpYnV0ZXMgdGltZWQgbG9ja2VkIHRva2VucwogICAgZnVuY3Rpb24gcGVyZm9ybUluaXRpYWxBbGxvY2F0aW9ucygpIGV4dGVybmFsIG9ubHlPd25lciBjaGVja0FsbG93ZWQgewogICAgICAgIHJlcXVpcmUobG9ja2VkVG9rZW5zRGlzdHJpYnV0ZWQgPT0gZmFsc2UpOwogICAgICAgIGxvY2tlZFRva2Vuc0Rpc3RyaWJ1dGVkID0gdHJ1ZTsKCiAgICAgICAgLy8gQWR2aXNvcnMKICAgICAgICBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygweDRkYzk3NmNFZDY2ZDFCODdDMDk5QjMzOEUxRjEzODhBRTY1NzM3N2QsIE1BWF9EVEgubXVsKDMpLmRpdigxMDApLCBub3cgKyA2ICogNCB3ZWVrcyk7CgogICAgICAgIC8vIEJvdW50eQogICAgICAgIGRpc3RyaWJ1dGVUaW1lbG9ja2VkVG9rZW5zKDB4ZkVGNjc1Y0MzMDY4RWU3OThmMjMxMmU4MkIxMmM4NDExNTdBMEEwRSwgTUFYX0RUSC5tdWwoMykuZGl2KDEwMCksIG5vdyArIDEgd2Vla3MpOwoKICAgICAgICAvLyBFYXJseSBDb250cmlidXRvcnMKICAgICAgICBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygweDhGMzhDNGRkRkUwOUJkMjI1NDUyNjJGRTE2MGNmNDQxRDQzZDI0ODksIE1BWF9EVEgubXVsKDI1KS5kaXYoMTAwMCksIG5vdyArIDYgKiA0IHdlZWtzKTsKCiAgICAgICAgZGlzdHJpYnV0ZVRpbWVsb2NrZWRUb2tlbnMoMHg4N2E0ZWIxYzlmZGVmODM1REM5MTk3RkFmZjNFMDliODAwN0FEZTViLCBNQVhfRFRILm11bCgyNSkuZGl2KDEwMDApLCBub3cgKyA2ICogNCB3ZWVrcyk7CgogICAgICAgIC8vIFN0cmF0ZWdpYyBQYXJ0bmVyc2hpcHMKICAgICAgICBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygweDZmNjNENURGMkQ4NjQ0ODUxY0JiNUY4NjA3Qzg0NTcwNEMwMDgyODQsIE1BWF9EVEgubXVsKDExKS5kaXYoMTAwKSwgbm93ICsgMSB3ZWVrcyk7CgogICAgICAgIC8vIFRlYW0gKGxvY2tlZCAzIHllYXJzLCA2IG1vbnRocyByZWxlYXNlKQogICAgICAgIGRpc3RyaWJ1dGVUaW1lbG9ja2VkVG9rZW5zKDB4MjRjMTQ3OTZmNDAxRDc3ZmM0MDFGOWMyRkExZEY0MkExMzZFYkY4MywgTUFYX0RUSC5tdWwoMykuZGl2KDEwMCksIG5vdyArIDYgKiA0IHdlZWtzKTsKICAgICAgICBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygweDI0YzE0Nzk2ZjQwMUQ3N2ZjNDAxRjljMkZBMWRGNDJBMTM2RWJGODMsIE1BWF9EVEgubXVsKDMpLmRpdigxMDApLCBub3cgKyAyICogNiAqIDQgd2Vla3MpOwogICAgICAgIGRpc3RyaWJ1dGVUaW1lbG9ja2VkVG9rZW5zKDB4MjRjMTQ3OTZmNDAxRDc3ZmM0MDFGOWMyRkExZEY0MkExMzZFYkY4MywgTUFYX0RUSC5tdWwoMykuZGl2KDEwMCksIG5vdyArIDMgKiA2ICogNCB3ZWVrcyk7CiAgICAgICAgZGlzdHJpYnV0ZVRpbWVsb2NrZWRUb2tlbnMoMHgyNGMxNDc5NmY0MDFENzdmYzQwMUY5YzJGQTFkRjQyQTEzNkViRjgzLCBNQVhfRFRILm11bCgzKS5kaXYoMTAwKSwgbm93ICsgNCAqIDYgKiA0IHdlZWtzKTsKICAgICAgICBkaXN0cmlidXRlVGltZWxvY2tlZFRva2VucygweDI0YzE0Nzk2ZjQwMUQ3N2ZjNDAxRjljMkZBMWRGNDJBMTM2RWJGODMsIE1BWF9EVEgubXVsKDMpLmRpdigxMDApLCBub3cgKyA1ICogNiAqIDQgd2Vla3MpOwogICAgICAgIGRpc3RyaWJ1dGVUaW1lbG9ja2VkVG9rZW5zKDB4MjRjMTQ3OTZmNDAxRDc3ZmM0MDFGOWMyRkExZEY0MkExMzZFYkY4MywgTUFYX0RUSC5tdWwoMykuZGl2KDEwMCksIG5vdyArIDYgKiA2ICogNCB3ZWVrcyk7CiAgICB9CgogICAgLy8vIEBkZXYgUmVnaXN0ZXJzIGEgdXNlciBhbmQgc2V0cyB0aGUgbWF4aW11bSBjb250cmlidXRpb24gYW1vdW50IGZvciB0aGUgd2hpdGVsaXN0aW5nIHBlcmlvZAogICAgZnVuY3Rpb24gcmVnaXN0ZXJQcmVzYWxlQ29udHJpYnV0b3IoYWRkcmVzcyB1c2VyQWRkcmVzcywgdWludDI1NiBtYXhDb250cmlidXRpb24pCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICAvLyBTcGVjaWZpZWQgY29udHJpYnV0aW9uIGhhcyB0byBiZSBsb3dlciB0aGFuIHRoZSBtYXgKICAgICAgICByZXF1aXJlKG1heENvbnRyaWJ1dGlvbiA8PSBXSElURUxJU1RJTkdfTUFYX0NPTlRSSUJVVElPTik7CgogICAgICAgIC8vIFJlZ2lzdGVyIHVzZXIgKFdoaXRlbGlzdGFibGUgY29udHJhY3QpCiAgICAgICAgcmVnaXN0ZXJVc2VyKHVzZXJBZGRyZXNzKTsKCiAgICAgICAgLy8gU2V0IGNvbnRyaWJ1dGlvbgogICAgICAgIHByZXNhbGVNYXhDb250cmlidXRpb25bdXNlckFkZHJlc3NdID0gbWF4Q29udHJpYnV0aW9uOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGxlZCB0byBhbGxvY2F0ZSB0aGUgdG9rZW5zIGRlcGVuZGluZyBvbiBldGggY29udHJpYnV0ZWQuCiAgICAvLy8gQHBhcmFtIGNvbnRyaWJ1dG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmlidXRvci4KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9rZW5zKGFkZHJlc3MgY29udHJpYnV0b3IpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjaGVja0FsbG93ZWQKICAgIHsKICAgICAgICByZXF1aXJlKHByZXNhbGVBbGxvY2F0ZWQpOwogICAgICAgIHJlcXVpcmUoY29udHJpYnV0aW9uc1tjb250cmlidXRvcl0gIT0gMCk7CgogICAgICAgIC8vIFdlIGtlZXAgYSByZWNvcmQgb2YgaG93IG11Y2ggd2VpIGNvbnRyaWJ1dGVkIGhhcyBhbHJlYWR5IGJlZW4gdXNlZCBmb3IgYWxsb2NhdGlvbnMKICAgICAgICB3ZWlBbGxvY2F0ZWQgPSB3ZWlBbGxvY2F0ZWQuYWRkKGNvbnRyaWJ1dGlvbnNbY29udHJpYnV0b3JdKTsKCiAgICAgICAgLy8gTWludCB0aGUgcmVzcGVjdGl2ZSB0b2tlbnMgdG8gdGhlIGNvbnRyaWJ1dG9yCiAgICAgICAgdG9rZW4ubWludChjb250cmlidXRvciwgY29udHJpYnV0aW9uc1tjb250cmlidXRvcl0ubXVsKERFQ0lNQUxTX01VTFRJUExJRVIpLmRpdih3ZWlQZXJEVEgpKTsKCiAgICAgICAgLy8gU2V0IGNvbnRyaWJ1dGlvbnMgdG8gMAogICAgICAgIGNvbnRyaWJ1dGlvbnNbY29udHJpYnV0b3JdID0gMDsKCiAgICAgICAgLy8gSWYgYWxsIHRva2VucyB3ZXJlIGFsbG9jYXRlZCwgc3RvcCBtaW50aW5nIGZ1bmN0aW9uYWxpdHkKICAgICAgICAvLyBhbmQgc2VuZCB0aGUgcmVtYWluaW5nIChyb3VuZGluZyBlcnJvcnMpIHRva2VucyB0byB0aGUgb3duZXIKICAgICAgICBpZiAod2VpQWxsb2NhdGVkID09IHdlaUNvbnRyaWJ1dGVkKSB7CiAgICAgICAgICB1aW50MjU2IHJlbWFpbmluZyA9IE1BWF9EVEguc3ViKHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgICAgICAgdG9rZW4ubWludChvd25lciwgcmVtYWluaW5nKTsKICAgICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIHRvIGFsbG9jYXRlIHRoZSB0b2tlbnMgZm9yIHByZXNhbGUgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHByZXNhbGVBbGxvY2F0ZVRva2VucygpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjaGVja0FsbG93ZWQKICAgIHsKICAgICAgICByZXF1aXJlKCFwcmVzYWxlQWxsb2NhdGVkKTsKICAgICAgICBwcmVzYWxlQWxsb2NhdGVkID0gdHJ1ZTsKCiAgICAgICAgLy8gTWludCB0aGUgcmVzcGVjdGl2ZSB0b2tlbnMgdG8gdGhlIGNvbnRyaWJ1dG9yCiAgICAgICAgdG9rZW4ubWludChwcmVzYWxlQWRkcmVzcywgUFJFU0FMRV9XRUkubXVsKERFQ0lNQUxTX01VTFRJUExJRVIpLmRpdih3ZWlQZXJEVEgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgY2hlY2tBbGxvd2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gTUlOX0NPTlRSSUJVVElPTik7CgogICAgICAgIHN1cGVyLmNvbnRyaWJ1dGUoKTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGUgbGltaXQgd2lsbCBiZSBkaWZmZXJlbnQgZm9yIGV2ZXJ5IGFkZHJlc3MgZHVyaW5nIHRoZSB3aGl0ZWxpc3QgcGVyaW9kLCBhbmQgYWZ0ZXIgdGhhdCBwaGFzZSB0aGVyZSBpcyBubyBsaW1pdCBmb3IgY29udHJpYnV0aW9ucy4KICAgIGZ1bmN0aW9uIGdldENvbnRyaWJ1dGlvbkxpbWl0KGFkZHJlc3MgdXNlckFkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHNhbGVTdGFydFRpbWUgPSBnZXRTdGFnZVN0YXJ0VGltZShTQUxFX0lOX1BST0dSRVNTKTsKCiAgICAgICAgLy8gSWYgbm90IHdoaXRlbGlzdGVkIG9yIHNhbGUgaGFzIG5vdCBzdGFydGVkLCByZXR1cm4gMAogICAgICAgIGlmICghd2hpdGVsaXN0ZWRbdXNlckFkZHJlc3NdIHx8IGJsb2NrLnRpbWVzdGFtcCA8IHNhbGVTdGFydFRpbWUpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBBcmUgd2UgaW4gdGhlIGZpcnN0IHR3byBkYXlzPwogICAgICAgIGJvb2wgd2hpdGVsaXN0aW5nUGVyaW9kID0gYmxvY2sudGltZXN0YW1wIC0gc2FsZVN0YXJ0VGltZSA8PSBXSElURUxJU1RJTkdfRFVSQVRJT047CgogICAgICAgIC8vIElmIHdlIGFyZSBpbiB0aGUgd2hpdGVsaXN0aW5nIHBlcmlvZCwgcmV0dXJuIHRoZSBjb250cmlidXRpb24gbGltaXQgZm9yIHRoZSB1c2VyCiAgICAgICAgLy8gSWYgbm90LCByZXR1cm4gdGhlIHB1YmxpYyBtYXggY29udHJpYnV0aW9uCiAgICAgICAgcmV0dXJuIHdoaXRlbGlzdGluZ1BlcmlvZCA/IHByZXNhbGVNYXhDb250cmlidXRpb25bdXNlckFkZHJlc3NdIDogUFVCTElDX01BWF9DT05UUklCVVRJT047CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMoTWludGFibGVUb2tlbikgewogICAgICAgIHJldHVybiBuZXcgRGV0aGVyVG9rZW4oKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXR1cFN0YWdlcygpIGludGVybmFsIHsKICAgICAgICBzdXBlci5zZXR1cFN0YWdlcygpOwogICAgICAgIHN0YXRlLmFsbG93RnVuY3Rpb24oU0VUVVAsIHRoaXMucGVyZm9ybUluaXRpYWxBbGxvY2F0aW9ucy5zZWxlY3Rvcik7CiAgICAgICAgc3RhdGUuYWxsb3dGdW5jdGlvbihTQUxFX0VOREVELCB0aGlzLmFsbG9jYXRlVG9rZW5zLnNlbGVjdG9yKTsKICAgICAgICBzdGF0ZS5hbGxvd0Z1bmN0aW9uKFNBTEVfRU5ERUQsIHRoaXMucHJlc2FsZUFsbG9jYXRlVG9rZW5zLnNlbGVjdG9yKTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGUgcHJpY2Ugd2lsbCBiZSB0aGUgdG90YWwgd2VpIGNvbnRyaWJ1dGVkIGRpdmlkZWQgYnkgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYWxsb2NhdGVkIHRvIGNvbnRyaWJ1dG9ycy4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHdlaUNvbnRyaWJ1dGVkLmFkZChQUkVTQUxFX1dFSSkuZGl2KDYwMDAwMDAwKS5hZGQoMSk7CiAgICB9CgogICAgZnVuY3Rpb24gb25TYWxlRW5kZWQoKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gQ2FsY3VsYXRlIERUSCBwZXIgV2VpCiAgICAgICAgd2VpUGVyRFRIID0gY2FsY3VsYXRlUHJpY2UoKTsKICAgIH0KfQ=='.
	

]
