Class {
	#name : #SRT311d745582a97be5d7abbce48855ecec72737c5d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT311d745582a97be5d7abbce48855ecec72737c5d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyogVGhlIGF1dGhlbnRpY2F0aW9uIG1hbmFnZXIgZGV0YWlscyB1c2VyIGFjY291bnRzIHRoYXQgaGF2ZSBhY2Nlc3MgdG8gY2VydGFpbiBwcml2aWxlZGdlcyBhbmQga2VlcHMgYSBwZXJtYW5lbnQgbGVkZ2VyIG9mIHdobyBoYXMgYW5kIGhhcyBoYWQgdGhlc2UgcmlnaHRzLiAqLwpjb250cmFjdCBBdXRoZW50aWNhdGlvbk1hbmFnZXIgewogICAKICAgIC8qIE1hcCBhZGRyZXNzZXMgdG8gYWRtaW5zICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGFkbWluQWRkcmVzc2VzOwoKICAgIC8qIE1hcCBhZGRyZXNzZXMgdG8gYWNjb3VudCByZWFkZXJzICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGFjY291bnRSZWFkZXJBZGRyZXNzZXM7CgogICAgLyogTWFwIGFkZHJlc3NlcyB0byBhY2NvdW50IG1pbnRlcnMgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgYWNjb3VudE1pbnRlckFkZHJlc3NlczsKCiAgICAvKiBEZXRhaWxzIG9mIGFsbCBhZG1pbnMgdGhhdCBoYXZlIGV2ZXIgZXhpc3RlZCAqLwogICAgYWRkcmVzc1tdIGFkbWluQXVkaXQ7CgogICAgLyogRGV0YWlscyBvZiBhbGwgYWNjb3VudCByZWFkZXJzIHRoYXQgaGF2ZSBldmVyIGV4aXN0ZWQgKi8KICAgIGFkZHJlc3NbXSBhY2NvdW50UmVhZGVyQXVkaXQ7CgogICAgLyogRGV0YWlscyBvZiBhbGwgYWNjb3VudCBtaW50ZXJzIHRoYXQgaGF2ZSBldmVyIGV4aXN0ZWQgKi8KICAgIGFkZHJlc3NbXSBhY2NvdW50TWludGVyQXVkaXQ7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWRtaW4gaXMgYWRkZWQgdG8gdGhlIGNvbnRyYWN0LiAqLwogICAgZXZlbnQgQWRtaW5BZGRlZChhZGRyZXNzIGFkZGVkQnksIGFkZHJlc3MgYWRtaW4pOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFkbWluIGlzIHJlbW92ZWQgZnJvbSB0aGUgY29udHJhY3QuICovCiAgICBldmVudCBBZG1pblJlbW92ZWQoYWRkcmVzcyByZW1vdmVkQnksIGFkZHJlc3MgYWRtaW4pOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFjY291bnQtcmVhZGVyIGNvbnRyYWN0IGlzIGFkZGVkLiAqLwogICAgZXZlbnQgQWNjb3VudFJlYWRlckFkZGVkKGFkZHJlc3MgYWRkZWRCeSwgYWRkcmVzcyBhY2NvdW50KTsKCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhY2NvdW50LXJlYWRlciBjb250cmFjdCBpcyByZW1vdmVkLiAqLwogICAgZXZlbnQgQWNjb3VudFJlYWRlclJlbW92ZWQoYWRkcmVzcyByZW1vdmVkQnksIGFkZHJlc3MgYWNjb3VudCk7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWNjb3VudC1taW50ZXIgY29udHJhY3QgaXMgYWRkZWQuICovCiAgICBldmVudCBBY2NvdW50TWludGVyQWRkZWQoYWRkcmVzcyBhZGRlZEJ5LCBhZGRyZXNzIGFjY291bnQpOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFjY291bnQtbWludGVyIGNvbnRyYWN0IGlzIHJlbW92ZWQuICovCiAgICBldmVudCBBY2NvdW50TWludGVyUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhY2NvdW50KTsKCiAgICAvKiBXaGVuIHRoaXMgY29udHJhY3QgaXMgZmlyc3Qgc2V0dXAgd2UgdXNlIHRoZSBjcmVhdG9yIGFzIHRoZSBmaXJzdCBhZG1pbiAqLyAgICAKICAgIGZ1bmN0aW9uIEF1dGhlbnRpY2F0aW9uTWFuYWdlcigpIHsKICAgICAgICAvKiBTZXQgdGhlIGZpcnN0IGFkbWluIHRvIGJlIHRoZSBwZXJzb24gY3JlYXRpbmcgdGhlIGNvbnRyYWN0ICovCiAgICAgICAgYWRtaW5BZGRyZXNzZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIEFkbWluQWRkZWQoMCwgbXNnLnNlbmRlcik7CiAgICAgICAgYWRtaW5BdWRpdC5sZW5ndGgrKzsKICAgICAgICBhZG1pbkF1ZGl0W2FkbWluQXVkaXQubGVuZ3RoIC0gMV0gPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGN1cnJlbnRseSBhbiBhZG1pbiAqLwogICAgZnVuY3Rpb24gaXNDdXJyZW50QWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc107CiAgICB9CgogICAgLyogR2V0cyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaGFzIGV2ZXIgYmVlbiBhbiBhZG1pbiAqLwogICAgZnVuY3Rpb24gaXNDdXJyZW50T3JQYXN0QWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGFkbWluQXVkaXQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChhZG1pbkF1ZGl0W2ldID09IF9hZGRyZXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIGN1cnJlbnRseSBhbiBhY2NvdW50IHJlYWRlciAqLwogICAgZnVuY3Rpb24gaXNDdXJyZW50QWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdOwogICAgfQoKICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBldmVyIGJlZW4gYW4gYWRtaW4gKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudE9yUGFzdEFjY291bnRSZWFkZXIoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGFjY291bnRSZWFkZXJBdWRpdC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGFjY291bnRSZWFkZXJBdWRpdFtpXSA9PSBfYWRkcmVzcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBjdXJyZW50bHkgYW4gYWNjb3VudCBtaW50ZXIgKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFjY291bnRNaW50ZXIoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhY2NvdW50TWludGVyQWRkcmVzc2VzW19hZGRyZXNzXTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBoYXMgZXZlciBiZWVuIGFuIGFkbWluICovCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRPclBhc3RBY2NvdW50TWludGVyKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhY2NvdW50TWludGVyQXVkaXQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChhY2NvdW50TWludGVyQXVkaXRbaV0gPT0gX2FkZHJlc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyogQWRkcyBhIHVzZXIgdG8gb3VyIGxpc3Qgb2YgYWRtaW5zICovCiAgICBmdW5jdGlvbiBhZGRBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgYWRtaW4KICAgICAgICBpZiAoYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBBZGQgdGhlIHVzZXIKICAgICAgICBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOwogICAgICAgIEFkbWluQWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgICAgIGFkbWluQXVkaXQubGVuZ3RoKys7CiAgICAgICAgYWRtaW5BdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7CgogICAgfQoKICAgIC8qIFJlbW92ZXMgYSB1c2VyIGZyb20gb3VyIGxpc3Qgb2YgYWRtaW5zIGJ1dCBrZWVwcyB0aGVtIGluIHRoZSBoaXN0b3J5IGF1ZGl0ICovCiAgICBmdW5jdGlvbiByZW1vdmVBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIERvbid0IGFsbG93IHJlbW92YWwgb2Ygc2VsZiAqLwogICAgICAgIGlmIChfYWRkcmVzcyA9PSBtc2cuc2VuZGVyKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBub24tYWRtaW4KICAgICAgICBpZiAoIWFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSB0aGlzIGFkbWluIHVzZXIgKi8KICAgICAgICBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10gPSBmYWxzZTsKICAgICAgICBBZG1pblJlbW92ZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgfQoKICAgIC8qIEFkZHMgYSB1c2VyL2NvbnRyYWN0IHRvIG91ciBsaXN0IG9mIGFjY291bnQgcmVhZGVycyAqLwogICAgZnVuY3Rpb24gYWRkQWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgaW4gdGhlIGxpc3QKICAgICAgICBpZiAoYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10pCiAgICAgICAgICAgIHRocm93OwogICAgICAgIAogICAgICAgIC8vIEFkZCB0aGUgYWNjb3VudCByZWFkZXIKICAgICAgICBhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSA9IHRydWU7CiAgICAgICAgQWNjb3VudFJlYWRlckFkZGVkKG1zZy5zZW5kZXIsIF9hZGRyZXNzKTsKICAgICAgICBhY2NvdW50UmVhZGVyQXVkaXQubGVuZ3RoKys7CiAgICAgICAgYWNjb3VudFJlYWRlckF1ZGl0W2FjY291bnRSZWFkZXJBdWRpdC5sZW5ndGggLSAxXSA9IF9hZGRyZXNzOwogICAgfQoKICAgIC8qIFJlbW92ZXMgYSB1c2VyL2NvbnRyYWN0cyBmcm9tIG91ciBsaXN0IG9mIGFjY291bnQgcmVhZGVycyBidXQga2VlcHMgdGhlbSBpbiB0aGUgaGlzdG9yeSBhdWRpdCAqLwogICAgZnVuY3Rpb24gcmVtb3ZlQWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgbm90IGluIHRoZSBsaXN0CiAgICAgICAgaWYgKCFhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSB0aGlzIGFjY291bnQgcmVhZGVyICovCiAgICAgICAgYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10gPSBmYWxzZTsKICAgICAgICBBY2NvdW50UmVhZGVyUmVtb3ZlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7CiAgICB9CgogICAgLyogQWRkIGEgY29udHJhY3QgdG8gb3VyIGxpc3Qgb2YgYWNjb3VudCBtaW50ZXJzICovCiAgICBmdW5jdGlvbiBhZGRBY2NvdW50TWludGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdAogICAgICAgIGlmIChhY2NvdW50TWludGVyQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIHRoZSBtaW50ZXIKICAgICAgICBhY2NvdW50TWludGVyQWRkcmVzc2VzW19hZGRyZXNzXSA9IHRydWU7CiAgICAgICAgQWNjb3VudE1pbnRlckFkZGVkKG1zZy5zZW5kZXIsIF9hZGRyZXNzKTsKICAgICAgICBhY2NvdW50TWludGVyQXVkaXQubGVuZ3RoKys7CiAgICAgICAgYWNjb3VudE1pbnRlckF1ZGl0W2FjY291bnRNaW50ZXJBdWRpdC5sZW5ndGggLSAxXSA9IF9hZGRyZXNzOwogICAgfQoKICAgIC8qIFJlbW92ZXMgYSB1c2VyL2NvbnRyYWN0cyBmcm9tIG91ciBsaXN0IG9mIGFjY291bnQgcmVhZGVycyBidXQga2VlcHMgdGhlbSBpbiB0aGUgaGlzdG9yeSBhdWRpdCAqLwogICAgZnVuY3Rpb24gcmVtb3ZlQWNjb3VudE1pbnRlcihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgbm90IGluIHRoZSBsaXN0CiAgICAgICAgaWYgKCFhY2NvdW50TWludGVyQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSB0aGlzIG1pbnRlciBhY2NvdW50ICovCiAgICAgICAgYWNjb3VudE1pbnRlckFkZHJlc3Nlc1tfYWRkcmVzc10gPSBmYWxzZTsKICAgICAgICBBY2NvdW50TWludGVyUmVtb3ZlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7CiAgICB9Cn0KCi8vIHBhcnNlIGEgcmF3IGJpdGNvaW4gdHJhbnNhY3Rpb24gYnl0ZSBhcnJheQpsaWJyYXJ5IEJUQyB7CiAgICAvLyBDb252ZXJ0IGEgdmFyaWFibGUgaW50ZWdlciBpbnRvIHNvbWV0aGluZyB1c2VmdWwgYW5kIHJldHVybiBpdCBhbmQKICAgIC8vIHRoZSBpbmRleCB0byBhZnRlciBpdC4KICAgIGZ1bmN0aW9uIHBhcnNlVmFySW50KGJ5dGVzIHR4Qnl0ZXMsIHVpbnQgcG9zKSByZXR1cm5zICh1aW50LCB1aW50KSB7CiAgICAgICAgLy8gdGhlIGZpcnN0IGJ5dGUgdGVsbHMgdXMgaG93IGJpZyB0aGUgaW50ZWdlciBpcwogICAgICAgIHZhciBpYml0ID0gdWludDgodHhCeXRlc1twb3NdKTsKICAgICAgICBwb3MgKz0gMTsgIC8vIHNraXAgaWJpdAoKICAgICAgICBpZiAoaWJpdCA8IDB4ZmQpIHsKICAgICAgICAgICAgcmV0dXJuIChpYml0LCBwb3MpOwogICAgICAgIH0gZWxzZSBpZiAoaWJpdCA9PSAweGZkKSB7CiAgICAgICAgICAgIHJldHVybiAoZ2V0Qnl0ZXNMRSh0eEJ5dGVzLCBwb3MsIDE2KSwgcG9zICsgMik7CiAgICAgICAgfSBlbHNlIGlmIChpYml0ID09IDB4ZmUpIHsKICAgICAgICAgICAgcmV0dXJuIChnZXRCeXRlc0xFKHR4Qnl0ZXMsIHBvcywgMzIpLCBwb3MgKyA0KTsKICAgICAgICB9IGVsc2UgaWYgKGliaXQgPT0gMHhmZikgewogICAgICAgICAgICByZXR1cm4gKGdldEJ5dGVzTEUodHhCeXRlcywgcG9zLCA2NCksIHBvcyArIDgpOwogICAgICAgIH0KICAgIH0KICAgIC8vIGNvbnZlcnQgbGl0dGxlIGVuZGlhbiBieXRlcyB0byB1aW50CiAgICBmdW5jdGlvbiBnZXRCeXRlc0xFKGJ5dGVzIGRhdGEsIHVpbnQgcG9zLCB1aW50IGJpdHMpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoYml0cyA9PSA4KSB7CiAgICAgICAgICAgIHJldHVybiB1aW50OChkYXRhW3Bvc10pOwogICAgICAgIH0gZWxzZSBpZiAoYml0cyA9PSAxNikgewogICAgICAgICAgICByZXR1cm4gdWludDE2KGRhdGFbcG9zXSkKICAgICAgICAgICAgICAgICArIHVpbnQxNihkYXRhW3BvcyArIDFdKSAqIDIgKiogODsKICAgICAgICB9IGVsc2UgaWYgKGJpdHMgPT0gMzIpIHsKICAgICAgICAgICAgcmV0dXJuIHVpbnQzMihkYXRhW3Bvc10pCiAgICAgICAgICAgICAgICAgKyB1aW50MzIoZGF0YVtwb3MgKyAxXSkgKiAyICoqIDgKICAgICAgICAgICAgICAgICArIHVpbnQzMihkYXRhW3BvcyArIDJdKSAqIDIgKiogMTYKICAgICAgICAgICAgICAgICArIHVpbnQzMihkYXRhW3BvcyArIDNdKSAqIDIgKiogMjQ7CiAgICAgICAgfSBlbHNlIGlmIChiaXRzID09IDY0KSB7CiAgICAgICAgICAgIHJldHVybiB1aW50NjQoZGF0YVtwb3NdKQogICAgICAgICAgICAgICAgICsgdWludDY0KGRhdGFbcG9zICsgMV0pICogMiAqKiA4CiAgICAgICAgICAgICAgICAgKyB1aW50NjQoZGF0YVtwb3MgKyAyXSkgKiAyICoqIDE2CiAgICAgICAgICAgICAgICAgKyB1aW50NjQoZGF0YVtwb3MgKyAzXSkgKiAyICoqIDI0CiAgICAgICAgICAgICAgICAgKyB1aW50NjQoZGF0YVtwb3MgKyA0XSkgKiAyICoqIDMyCiAgICAgICAgICAgICAgICAgKyB1aW50NjQoZGF0YVtwb3MgKyA1XSkgKiAyICoqIDQwCiAgICAgICAgICAgICAgICAgKyB1aW50NjQoZGF0YVtwb3MgKyA2XSkgKiAyICoqIDQ4CiAgICAgICAgICAgICAgICAgKyB1aW50NjQoZGF0YVtwb3MgKyA3XSkgKiAyICoqIDU2OwogICAgICAgIH0KICAgIH0KICAgIC8vIHNjYW4gdGhlIGZ1bGwgdHJhbnNhY3Rpb24gYnl0ZXMgYW5kIHJldHVybiB0aGUgZmlyc3QgdHdvIG91dHB1dAogICAgLy8gdmFsdWVzIChpbiBzYXRvc2hpcykgYW5kIGFkZHJlc3NlcyAoaW4gYmluYXJ5KQogICAgZnVuY3Rpb24gZ2V0Rmlyc3RUd29PdXRwdXRzKGJ5dGVzIHR4Qnl0ZXMpCiAgICAgICAgICAgICByZXR1cm5zICh1aW50LCBieXRlczIwLCB1aW50LCBieXRlczIwKQogICAgewogICAgICAgIHVpbnQgcG9zOwogICAgICAgIHVpbnRbXSBtZW1vcnkgaW5wdXRfc2NyaXB0X2xlbnMgPSBuZXcgdWludFtdKDIpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgb3V0cHV0X3NjcmlwdF9sZW5zID0gbmV3IHVpbnRbXSgyKTsKICAgICAgICB1aW50W10gbWVtb3J5IHNjcmlwdF9zdGFydHMgPSBuZXcgdWludFtdKDIpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgb3V0cHV0X3ZhbHVlcyA9IG5ldyB1aW50W10oMik7CiAgICAgICAgYnl0ZXMyMFtdIG1lbW9yeSBvdXRwdXRfYWRkcmVzc2VzID0gbmV3IGJ5dGVzMjBbXSgyKTsKCiAgICAgICAgcG9zID0gNDsgIC8vIHNraXAgdmVyc2lvbgoKICAgICAgICAoaW5wdXRfc2NyaXB0X2xlbnMsIHBvcykgPSBzY2FuSW5wdXRzKHR4Qnl0ZXMsIHBvcywgMCk7CgogICAgICAgIChvdXRwdXRfdmFsdWVzLCBzY3JpcHRfc3RhcnRzLCBvdXRwdXRfc2NyaXB0X2xlbnMsIHBvcykgPSBzY2FuT3V0cHV0cyh0eEJ5dGVzLCBwb3MsIDIpOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgICAgdmFyIHBraGFzaCA9IHBhcnNlT3V0cHV0U2NyaXB0KHR4Qnl0ZXMsIHNjcmlwdF9zdGFydHNbaV0sIG91dHB1dF9zY3JpcHRfbGVuc1tpXSk7CiAgICAgICAgICAgIG91dHB1dF9hZGRyZXNzZXNbaV0gPSBwa2hhc2g7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKG91dHB1dF92YWx1ZXNbMF0sIG91dHB1dF9hZGRyZXNzZXNbMF0sCiAgICAgICAgICAgICAgICBvdXRwdXRfdmFsdWVzWzFdLCBvdXRwdXRfYWRkcmVzc2VzWzFdKTsKICAgIH0KICAgIC8vIENoZWNrIHdoZXRoZXIgYGJ0Y0FkZHJlc3NgIGlzIGluIHRoZSB0cmFuc2FjdGlvbiBvdXRwdXRzICphbmQqCiAgICAvLyB3aGV0aGVyICphdCBsZWFzdCogYHZhbHVlYCBoYXMgYmVlbiBzZW50IHRvIGl0LgogICAgZnVuY3Rpb24gY2hlY2tWYWx1ZVNlbnQoYnl0ZXMgdHhCeXRlcywgYnl0ZXMyMCBidGNBZGRyZXNzLCB1aW50IHZhbHVlKQogICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB1aW50IHBvcyA9IDQ7ICAvLyBza2lwIHZlcnNpb24KICAgICAgICAoLCBwb3MpID0gc2NhbklucHV0cyh0eEJ5dGVzLCBwb3MsIDApOyAgLy8gZmluZCBlbmQgb2YgaW5wdXRzCgogICAgICAgIC8vIHNjYW4gKmFsbCogdGhlIG91dHB1dHMgYW5kIGZpbmQgd2hlcmUgdGhleSBhcmUKICAgICAgICB2YXIgKG91dHB1dF92YWx1ZXMsIHNjcmlwdF9zdGFydHMsIG91dHB1dF9zY3JpcHRfbGVucywpID0gc2Nhbk91dHB1dHModHhCeXRlcywgcG9zLCAwKTsKCiAgICAgICAgLy8gbG9vayBhdCBlYWNoIG91dHB1dCBhbmQgY2hlY2sgd2hldGhlciBpdCBhdCBsZWFzdCB2YWx1ZSB0byBidGNBZGRyZXNzCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3V0cHV0X3ZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgcGtoYXNoID0gcGFyc2VPdXRwdXRTY3JpcHQodHhCeXRlcywgc2NyaXB0X3N0YXJ0c1tpXSwgb3V0cHV0X3NjcmlwdF9sZW5zW2ldKTsKICAgICAgICAgICAgaWYgKHBraGFzaCA9PSBidGNBZGRyZXNzICYmIG91dHB1dF92YWx1ZXNbaV0gPj0gdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLy8gc2NhbiB0aGUgaW5wdXRzIGFuZCBmaW5kIHRoZSBzY3JpcHQgbGVuZ3Rocy4KICAgIC8vIHJldHVybiBhbiBhcnJheSBvZiBzY3JpcHQgbGVuZ3RocyBhbmQgdGhlIGVuZCBwb3NpdGlvbgogICAgLy8gb2YgdGhlIGlucHV0cy4KICAgIC8vIHRha2VzIGEgJ3N0b3AnIGFyZ3VtZW50IHdoaWNoIHNldHMgdGhlIG1heGltdW0gbnVtYmVyIG9mCiAgICAvLyBvdXRwdXRzIHRvIHNjYW4gdGhyb3VnaC4gc3RvcD0wID0+IHNjYW4gYWxsLgogICAgZnVuY3Rpb24gc2NhbklucHV0cyhieXRlcyB0eEJ5dGVzLCB1aW50IHBvcywgdWludCBzdG9wKQogICAgICAgICAgICAgcmV0dXJucyAodWludFtdLCB1aW50KQogICAgewogICAgICAgIHVpbnQgbl9pbnB1dHM7CiAgICAgICAgdWludCBoYWx0OwogICAgICAgIHVpbnQgc2NyaXB0X2xlbjsKCiAgICAgICAgKG5faW5wdXRzLCBwb3MpID0gcGFyc2VWYXJJbnQodHhCeXRlcywgcG9zKTsKCiAgICAgICAgaWYgKHN0b3AgPT0gMCB8fCBzdG9wID4gbl9pbnB1dHMpIHsKICAgICAgICAgICAgaGFsdCA9IG5faW5wdXRzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhhbHQgPSBzdG9wOwogICAgICAgIH0KCiAgICAgICAgdWludFtdIG1lbW9yeSBzY3JpcHRfbGVucyA9IG5ldyB1aW50W10oaGFsdCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFsdDsgaSsrKSB7CiAgICAgICAgICAgIHBvcyArPSAzNjsgIC8vIHNraXAgb3V0cG9pbnQKICAgICAgICAgICAgKHNjcmlwdF9sZW4sIHBvcykgPSBwYXJzZVZhckludCh0eEJ5dGVzLCBwb3MpOwogICAgICAgICAgICBzY3JpcHRfbGVuc1tpXSA9IHNjcmlwdF9sZW47CiAgICAgICAgICAgIHBvcyArPSBzY3JpcHRfbGVuICsgNDsgIC8vIHNraXAgc2lnX3NjcmlwdCwgc2VxCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHNjcmlwdF9sZW5zLCBwb3MpOwogICAgfQogICAgLy8gc2NhbiB0aGUgb3V0cHV0cyBhbmQgZmluZCB0aGUgdmFsdWVzIGFuZCBzY3JpcHQgbGVuZ3Rocy4KICAgIC8vIHJldHVybiBhcnJheSBvZiB2YWx1ZXMsIGFycmF5IG9mIHNjcmlwdCBsZW5ndGhzIGFuZCB0aGUKICAgIC8vIGVuZCBwb3NpdGlvbiBvZiB0aGUgb3V0cHV0cy4KICAgIC8vIHRha2VzIGEgJ3N0b3AnIGFyZ3VtZW50IHdoaWNoIHNldHMgdGhlIG1heGltdW0gbnVtYmVyIG9mCiAgICAvLyBvdXRwdXRzIHRvIHNjYW4gdGhyb3VnaC4gc3RvcD0wID0+IHNjYW4gYWxsLgogICAgZnVuY3Rpb24gc2Nhbk91dHB1dHMoYnl0ZXMgdHhCeXRlcywgdWludCBwb3MsIHVpbnQgc3RvcCkKICAgICAgICAgICAgIHJldHVybnMgKHVpbnRbXSwgdWludFtdLCB1aW50W10sIHVpbnQpCiAgICB7CiAgICAgICAgdWludCBuX291dHB1dHM7CiAgICAgICAgdWludCBoYWx0OwogICAgICAgIHVpbnQgc2NyaXB0X2xlbjsKCiAgICAgICAgKG5fb3V0cHV0cywgcG9zKSA9IHBhcnNlVmFySW50KHR4Qnl0ZXMsIHBvcyk7CgogICAgICAgIGlmIChzdG9wID09IDAgfHwgc3RvcCA+IG5fb3V0cHV0cykgewogICAgICAgICAgICBoYWx0ID0gbl9vdXRwdXRzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhhbHQgPSBzdG9wOwogICAgICAgIH0KCiAgICAgICAgdWludFtdIG1lbW9yeSBzY3JpcHRfc3RhcnRzID0gbmV3IHVpbnRbXShoYWx0KTsKICAgICAgICB1aW50W10gbWVtb3J5IHNjcmlwdF9sZW5zID0gbmV3IHVpbnRbXShoYWx0KTsKICAgICAgICB1aW50W10gbWVtb3J5IG91dHB1dF92YWx1ZXMgPSBuZXcgdWludFtdKGhhbHQpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhhbHQ7IGkrKykgewogICAgICAgICAgICBvdXRwdXRfdmFsdWVzW2ldID0gZ2V0Qnl0ZXNMRSh0eEJ5dGVzLCBwb3MsIDY0KTsKICAgICAgICAgICAgcG9zICs9IDg7CgogICAgICAgICAgICAoc2NyaXB0X2xlbiwgcG9zKSA9IHBhcnNlVmFySW50KHR4Qnl0ZXMsIHBvcyk7CiAgICAgICAgICAgIHNjcmlwdF9zdGFydHNbaV0gPSBwb3M7CiAgICAgICAgICAgIHNjcmlwdF9sZW5zW2ldID0gc2NyaXB0X2xlbjsKICAgICAgICAgICAgcG9zICs9IHNjcmlwdF9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKG91dHB1dF92YWx1ZXMsIHNjcmlwdF9zdGFydHMsIHNjcmlwdF9sZW5zLCBwb3MpOwogICAgfQogICAgLy8gU2xpY2UgMjAgY29udGlndW91cyBieXRlcyBmcm9tIGJ5dGVzIGBkYXRhYCwgc3RhcnRpbmcgYXQgYHN0YXJ0YAogICAgZnVuY3Rpb24gc2xpY2VCeXRlczIwKGJ5dGVzIGRhdGEsIHVpbnQgc3RhcnQpIHJldHVybnMgKGJ5dGVzMjApIHsKICAgICAgICB1aW50MTYwIHNsaWNlID0gMDsKICAgICAgICBmb3IgKHVpbnQxNjAgaSA9IDA7IGkgPCAyMDsgaSsrKSB7CiAgICAgICAgICAgIHNsaWNlICs9IHVpbnQxNjAoZGF0YVtpICsgc3RhcnRdKSA8PCAoOCAqICgxOSAtIGkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ5dGVzMjAoc2xpY2UpOwogICAgfQogICAgLy8gcmV0dXJucyB0cnVlIGlmIHRoZSBieXRlcyBsb2NhdGVkIGluIHR4Qnl0ZXMgYnkgcG9zIGFuZAogICAgLy8gc2NyaXB0X2xlbiByZXByZXNlbnQgYSBQMlBLSCBzY3JpcHQKICAgIGZ1bmN0aW9uIGlzUDJQS0goYnl0ZXMgdHhCeXRlcywgdWludCBwb3MsIHVpbnQgc2NyaXB0X2xlbikgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoc2NyaXB0X2xlbiA9PSAyNSkgICAgICAgICAgIC8vIDIwIGJ5dGUgcHVia2V5aGFzaCArIDUgYnl0ZXMgb2Ygc2NyaXB0CiAgICAgICAgICAgICYmICh0eEJ5dGVzW3Bvc10gPT0gMHg3NikgICAgICAgLy8gT1BfRFVQCiAgICAgICAgICAgICYmICh0eEJ5dGVzW3BvcyArIDFdID09IDB4YTkpICAgLy8gT1BfSEFTSDE2MAogICAgICAgICAgICAmJiAodHhCeXRlc1twb3MgKyAyXSA9PSAweDE0KSAgIC8vIGJ5dGVzIHRvIHB1c2gKICAgICAgICAgICAgJiYgKHR4Qnl0ZXNbcG9zICsgMjNdID09IDB4ODgpICAvLyBPUF9FUVVBTFZFUklGWQogICAgICAgICAgICAmJiAodHhCeXRlc1twb3MgKyAyNF0gPT0gMHhhYyk7IC8vIE9QX0NIRUNLU0lHCiAgICB9CiAgICAvLyByZXR1cm5zIHRydWUgaWYgdGhlIGJ5dGVzIGxvY2F0ZWQgaW4gdHhCeXRlcyBieSBwb3MgYW5kCiAgICAvLyBzY3JpcHRfbGVuIHJlcHJlc2VudCBhIFAyU0ggc2NyaXB0CiAgICBmdW5jdGlvbiBpc1AyU0goYnl0ZXMgdHhCeXRlcywgdWludCBwb3MsIHVpbnQgc2NyaXB0X2xlbikgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoc2NyaXB0X2xlbiA9PSAyMykgICAgICAgICAgIC8vIDIwIGJ5dGUgc2NyaXB0aGFzaCArIDMgYnl0ZXMgb2Ygc2NyaXB0CiAgICAgICAgICAgICYmICh0eEJ5dGVzW3BvcyArIDBdID09IDB4YTkpICAgLy8gT1BfSEFTSDE2MAogICAgICAgICAgICAmJiAodHhCeXRlc1twb3MgKyAxXSA9PSAweDE0KSAgIC8vIGJ5dGVzIHRvIHB1c2gKICAgICAgICAgICAgJiYgKHR4Qnl0ZXNbcG9zICsgMjJdID09IDB4ODcpOyAvLyBPUF9FUVVBTAogICAgfQogICAgLy8gR2V0IHRoZSBwdWJrZXloYXNoIC8gc2NyaXB0aGFzaCBmcm9tIGFuIG91dHB1dCBzY3JpcHQuIEFzc3VtZXMKICAgIC8vIHBheS10by1wdWJrZXktaGFzaCAoUDJQS0gpIG9yIHBheS10by1zY3JpcHQtaGFzaCAoUDJTSCkgb3V0cHV0cy4KICAgIC8vIFJldHVybnMgdGhlIHB1YmtleWhhc2gvIHNjcmlwdGhhc2gsIG9yIHplcm8gaWYgdW5rbm93biBvdXRwdXQuCiAgICBmdW5jdGlvbiBwYXJzZU91dHB1dFNjcmlwdChieXRlcyB0eEJ5dGVzLCB1aW50IHBvcywgdWludCBzY3JpcHRfbGVuKQogICAgICAgICAgICAgcmV0dXJucyAoYnl0ZXMyMCkKICAgIHsKICAgICAgICBpZiAoaXNQMlBLSCh0eEJ5dGVzLCBwb3MsIHNjcmlwdF9sZW4pKSB7CiAgICAgICAgICAgIHJldHVybiBzbGljZUJ5dGVzMjAodHhCeXRlcywgcG9zICsgMyk7CiAgICAgICAgfSBlbHNlIGlmIChpc1AyU0godHhCeXRlcywgcG9zLCBzY3JpcHRfbGVuKSkgewogICAgICAgICAgICByZXR1cm4gc2xpY2VCeXRlczIwKHR4Qnl0ZXMsIHBvcyArIDIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IExvY2tpbk1hbmFnZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLypEZWZpbmVzIHRoZSBzdHJ1Y3R1cmUgZm9yIGEgbG9jayovCiAgICBzdHJ1Y3QgTG9jayB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7CiAgICAgICAgdWludDI1NiB1bmxvY2tEYXRlOwogICAgICAgIHVpbnQyNTYgbG9ja2VkRm9yOwogICAgfQogICAgCiAgICAvKk9iamVjdCBvZiBMb2NrKi8gICAgCiAgICBMb2NrIGxvY2s7CgogICAgLypWYWx1ZSBvZiBkZWZhdWx0IGxvY2sgZGF5cyovCiAgICB1aW50MjU2IGRlZmF1bHRBbGxvd2VkTG9jayA9IDc7CgogICAgLyogbWFwcGluZyBvZiBsaXN0IG9mIGxvY2tlZCBhZGRyZXNzIHdpdGggYXJyYXkgb2YgbG9ja3MgZm9yIGEgcGFydGljdWxhciBhZGRyZXNzICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IExvY2tbXSkgcHVibGljIGxvY2tlZEFkZHJlc3NlczsKCiAgICAvKiBtYXBwaW5nIG9mIHZhbGlkIGNvbnRyYWN0cyB3aXRoIHRoZWlyIGxvY2tpbiB0aW1lc3RhbXAgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFsbG93ZWRDb250cmFjdHM7CgogICAgLyogbGlzdCBvZiBsb2NrZWQgZGF5cyBtYXBwZWQgd2l0aCB0aGVpciBsb2NrZWQgdGltZXN0YW1wKi8KICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludDI1NikgcHVibGljIGFsbG93ZWRMb2NrczsKCiAgICAvKiBEZWZpbmVzIG91ciBpbnRlcmZhY2UgdG8gdGhlIHRva2VuIGNvbnRyYWN0ICovCiAgICBUb2tlbiB0b2tlbjsKCiAgICAvKiBEZWZpbmVzIHRoZSBhZG1pbiBjb250cmFjdCB3ZSBpbnRlcmZhY2Ugd2l0aCBmb3IgY3JlZGVudGFpbHMuICovCiAgICBBdXRoZW50aWNhdGlvbk1hbmFnZXIgYXV0aGVudGljYXRpb25NYW5hZ2VyOwoKICAgICAvKiBGaXJlZCB3aGVuZXZlciBsb2NrIGRheSBpcyBhZGRlZCBieSB0aGUgYWRtaW4uICovCiAgICBldmVudCBMb2NrZWREYXlBZGRlZChhZGRyZXNzIF9hZG1pbiwgdWludDI1NiBfZGF5c0xvY2tlZCwgdWludDI1NiB0aW1lc3RhbXApOwoKICAgICAvKiBGaXJlZCB3aGVuZXZlciBsb2NrIGRheSBpcyByZW1vdmVkIGJ5IHRoZSBhZG1pbi4gKi8KICAgIGV2ZW50IExvY2tlZERheVJlbW92ZWQoYWRkcmVzcyBfYWRtaW4sIHVpbnQyNTYgX2RheXNMb2NrZWQsIHVpbnQyNTYgdGltZXN0YW1wKTsKCiAgICAgLyogRmlyZWQgd2hlbmV2ZXIgdmFsaWQgY29udHJhY3QgaXMgYWRkZWQgYnkgdGhlIGFkbWluLiAqLwogICAgZXZlbnQgVmFsaWRDb250cmFjdEFkZGVkKGFkZHJlc3MgX2FkbWluLCBhZGRyZXNzIF92YWxpZEFkZHJlc3MsIHVpbnQyNTYgdGltZXN0YW1wKTsKCiAgICAgLyogRmlyZWQgd2hlbmV2ZXIgdmFsaWQgY29udHJhY3QgaXMgcmVtb3ZlZCBieSB0aGUgYWRtaW4uICovCiAgICBldmVudCBWYWxpZENvbnRyYWN0UmVtb3ZlZChhZGRyZXNzIF9hZG1pbiwgYWRkcmVzcyBfdmFsaWRBZGRyZXNzLCB1aW50MjU2IHRpbWVzdGFtcCk7CgogICAgLyogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoaXMgZnVuZCB3aXRoIGxpbmtzIHRvIG90aGVyIGNvbnRyYWN0cyB0aGF0IGFyZSByZXF1aXJlZC4gKi8KICAgIGZ1bmN0aW9uIExvY2tpbk1hbmFnZXIoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2F1dGhlbnRpY2F0aW9uTWFuYWdlcikgewogICAgICAKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyBhbmQgdmFsaWRhdGUgdGhlaXIgdmVyc2lvbnMgKi8KICAgICAgICB0b2tlbiAgPSBUb2tlbihfdG9rZW4pOwogICAgICAgIGF1dGhlbnRpY2F0aW9uTWFuYWdlciA9IEF1dGhlbnRpY2F0aW9uTWFuYWdlcihfYXV0aGVudGljYXRpb25NYW5hZ2VyKTsKICAgIH0KICAgCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBjdXJyZW50IGFkbWlucyAqLwogICAgbW9kaWZpZXIgYWRtaW5Pbmx5IHsKICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSB0b2tlbiBjb250cmFjdCAqLwogICAgbW9kaWZpZXIgdmFsaWRDb250cmFjdE9ubHkgewogICAgICAgIHJlcXVpcmUoYWxsb3dlZENvbnRyYWN0c1ttc2cuc2VuZGVyXSAhPSAwKTsKCiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBsZW5ndGggb2YgbG9ja2VkIHZhbHVlcyBmb3IgYW4gYWNjb3VudCAqLwogICAgZnVuY3Rpb24gZ2V0TG9ja3MoYWRkcmVzcyBfb3duZXIpIHZhbGlkQ29udHJhY3RPbmx5IGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbG9ja2VkQWRkcmVzc2VzW19vd25lcl0ubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExvY2soYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgY291bnQpIHZhbGlkQ29udHJhY3RPbmx5IHJldHVybnModWludDI1NiBhbW91bnQsIHVpbnQyNTYgdW5sb2NrRGF0ZSwgdWludDI1NiBsb2NrZWRGb3IpIHsKICAgICAgICBhbW91bnQgICAgID0gbG9ja2VkQWRkcmVzc2VzW19vd25lcl1bY291bnRdLmFtb3VudDsKICAgICAgICB1bmxvY2tEYXRlID0gbG9ja2VkQWRkcmVzc2VzW19vd25lcl1bY291bnRdLnVubG9ja0RhdGU7CiAgICAgICAgbG9ja2VkRm9yICAgPSBsb2NrZWRBZGRyZXNzZXNbX293bmVyXVtjb3VudF0ubG9ja2VkRm9yOwogICAgfQogICAgCiAgICAvKiBHZXRzIGFtb3VudCBmb3Igd2hpY2ggYW4gYWRkcmVzcyBpcyBsb2NrZWQgd2l0aCBsb2NrZWQgaW5kZXggKi8KICAgIGZ1bmN0aW9uIGdldExvY2tzQW1vdW50KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IGNvdW50KSB2YWxpZENvbnRyYWN0T25seSByZXR1cm5zKHVpbnQyNTYgYW1vdW50KSB7ICAgICAgICAKICAgICAgICBhbW91bnQgPSBsb2NrZWRBZGRyZXNzZXNbX293bmVyXVtjb3VudF0uYW1vdW50OwogICAgfQoKICAgIC8qIEdldHMgdW5sb2NrZWQgdGltZXN0YW1wIGZvciB3aGljaCBhbiBhZGRyZXNzIGlzIGxvY2tlZCB3aXRoIGxvY2tlZCBpbmRleCAqLwogICAgZnVuY3Rpb24gZ2V0TG9ja3NVbmxvY2tEYXRlKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IGNvdW50KSB2YWxpZENvbnRyYWN0T25seSByZXR1cm5zKHVpbnQyNTYgdW5sb2NrRGF0ZSkgewogICAgICAgIHVubG9ja0RhdGUgPSBsb2NrZWRBZGRyZXNzZXNbX293bmVyXVtjb3VudF0udW5sb2NrRGF0ZTsKICAgIH0KCiAgICAvKiBHZXRzIGRheXMgZm9yIHdoaWNoIGFuIGFkZHJlc3MgaXMgbG9ja2VkIHdpdGggbG9ja2VkIGluZGV4ICovCiAgICBmdW5jdGlvbiBnZXRMb2Nrc0xvY2tlZEZvcihhZGRyZXNzIF9vd25lciwgdWludDI1NiBjb3VudCkgdmFsaWRDb250cmFjdE9ubHkgcmV0dXJucyh1aW50MjU2IGxvY2tlZEZvcikgewogICAgICAgIGxvY2tlZEZvciA9IGxvY2tlZEFkZHJlc3Nlc1tfb3duZXJdW2NvdW50XS5sb2NrZWRGb3I7CiAgICB9CgogICAgLyogTG9ja3MgdG9rZW5zIGZvciBhbiBhZGRyZXNzIGZvciB0aGUgZGVmYXVsdCBudW1iZXIgb2YgZGF5cyAqLwogICAgZnVuY3Rpb24gZGVmYXVsdExvY2tpbihhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF92YWx1ZSkgdmFsaWRDb250cmFjdE9ubHkKICAgIHsKICAgICAgICBsb2NrSXQoX2FkZHJlc3MsIF92YWx1ZSwgZGVmYXVsdEFsbG93ZWRMb2NrKTsKICAgIH0KCiAgICAvKiBsb2NrcyB0b2tlbnMgZm9yIHNlbmRlciBmb3IgbiBkYXlzKi8KICAgIGZ1bmN0aW9uIGxvY2tGb3JEYXlzKHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9kYXlzKSAKICAgIHsKICAgICAgICByZXF1aXJlKCAhIGlmSW5BbGxvd2VkTG9ja3MoX2RheXMpKTsgICAgICAgIAoKICAgICAgICByZXF1aXJlKHRva2VuLmF2YWlsYWJsZUJhbGFuY2UobXNnLnNlbmRlcikgPj0gX3ZhbHVlKTsKICAgICAgICAKICAgICAgICBsb2NrSXQobXNnLnNlbmRlciwgX3ZhbHVlLCBfZGF5cyk7ICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBsb2NrSXQoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2RheXMpIGludGVybmFsIHsKCiAgICAgICAgLy8gZXhwaXJ5IHdpbGwgYmUgY2FsY3VsYXRlZCBhcyAyNCAqIDYwICogNjAKICAgICAgICB1aW50MjU2IF9leHBpcnkgPSBub3cgKyBfZGF5cy5tdWwoODY0MDApOwogICAgICAgIGxvY2tlZEFkZHJlc3Nlc1tfYWRkcmVzc10ucHVzaChMb2NrKF92YWx1ZSwgX2V4cGlyeSwgX2RheXMpKTsgICAgICAgIAogICAgfQoKICAgIC8qIGNoZWNrIGlmIGlucHV0IGRheSBpcyBwcmVzZW50IGluIGxvY2tlZCBkYXlzICovCiAgICBmdW5jdGlvbiBpZkluQWxsb3dlZExvY2tzKHVpbnQyNTYgX2RheXMpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBhbGxvd2VkTG9ja3NbX2RheXNdID09IDA7CiAgICB9CgogICAgLyogQWRkcyBhIGRheSB0byBvdXIgbGlzdCBvZiBhbGxvd2VkTG9ja3MgKi8KICAgIGZ1bmN0aW9uIGFkZEFsbG93ZWRMb2NrKHVpbnQgX2RheSkgYWRtaW5Pbmx5IHsKCiAgICAgICAgLy8gRmFpbCBpZiBkYXkgaXMgYWxyZWFkeSBwcmVzZW50IGluIGxvY2tlZCBkYXlzCiAgICAgICAgaWYgKGFsbG93ZWRMb2Nrc1tfZGF5XSAhPSAwKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBBZGQgZGF5IGluIGxvY2tlZCBkYXlzIAogICAgICAgIGFsbG93ZWRMb2Nrc1tfZGF5XSA9IG5vdzsKICAgICAgICBMb2NrZWREYXlBZGRlZChtc2cuc2VuZGVyLCBfZGF5LCBub3cpOwogICAgfQoKICAgIC8qIFJlbW92ZSBhbGxvd2VkIExvY2sgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZUFsbG93ZWRMb2NrKHVpbnQgX2RheSkgYWRtaW5Pbmx5IHsKCiAgICAgICAgLy8gRmFpbCBpZiBkYXkgZG9lc25vdCBleGlzdCBpbiBhbGxvd2VkTG9ja3MKICAgICAgICBpZiAoIGFsbG93ZWRMb2Nrc1tfZGF5XSA9PSAgMCkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSBsb2NrZWQgZGF5ICAqLwogICAgICAgIGFsbG93ZWRMb2Nrc1tfZGF5XSA9IDA7CiAgICAgICAgTG9ja2VkRGF5UmVtb3ZlZChtc2cuc2VuZGVyLCBfZGF5LCBub3cpOwogICAgfQoKICAgIC8qIEFkZHMgYSBhZGRyZXNzIHRvIG91ciBsaXN0IG9mIGFsbG93ZWRDb250cmFjdHMgKi8KICAgIGZ1bmN0aW9uIGFkZFZhbGlkQ29udHJhY3QoYWRkcmVzcyBfYWRkcmVzcykgYWRtaW5Pbmx5IHsKCiAgICAgICAgLy8gRmFpbCBpZiBhZGRyZXNzIGlzIGFscmVhZHkgcHJlc2VudCBpbiB2YWxpZCBjb250cmFjdHMKICAgICAgICBpZiAoYWxsb3dlZENvbnRyYWN0c1tfYWRkcmVzc10gIT0gMCkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gYWRkIGFuIGFkZHJlc3MgaW4gYWxsb3dlZENvbnRyYWN0cwogICAgICAgIGFsbG93ZWRDb250cmFjdHNbX2FkZHJlc3NdID0gbm93OwoKICAgICAgICBWYWxpZENvbnRyYWN0QWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MsIG5vdyk7CiAgICB9CgogICAgLyogUmVtb3ZlcyBhbGxvd2VkIGNvbnRyYWN0IGZyb20gdGhlIGxpc3Qgb2YgYWxsb3dlZENvbnRyYWN0cyAqLwogICAgZnVuY3Rpb24gcmVtb3ZlVmFsaWRDb250cmFjdChhZGRyZXNzIF9hZGRyZXNzKSBhZG1pbk9ubHkgewoKICAgICAgICAvLyBGYWlsIGlmIGFkZHJlc3MgZG9lc25vdCBleGlzdCBpbiBhbGxvd2VkQ29udHJhY3RzCiAgICAgICAgaWYgKCBhbGxvd2VkQ29udHJhY3RzW19hZGRyZXNzXSA9PSAgMCkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSBhbGxvd2VkIGNvbnRyYWN0IGZyb20gYWxsb3dlZENvbnRyYWN0cyAgKi8KICAgICAgICBhbGxvd2VkQ29udHJhY3RzW19hZGRyZXNzXSA9IDA7CgogICAgICAgIFZhbGlkQ29udHJhY3RSZW1vdmVkKG1zZy5zZW5kZXIsIF9hZGRyZXNzLCBub3cpOwogICAgfQoKICAgIC8qIFNldCBkZWZhdWx0IGFsbG93ZWQgbG9jayAqLwogICAgZnVuY3Rpb24gc2V0RGVmYXVsdEFsbG93ZWRMb2NrKHVpbnQgX2RheXMpIGFkbWluT25seSB7CiAgICAgICAgZGVmYXVsdEFsbG93ZWRMb2NrID0gX2RheXM7CiAgICB9Cn0KCi8qIFRoZSBUb2tlbiBpdHNlbGYgaXMgYSBzaW1wbGUgZXh0ZW5zaW9uIG9mIHRoZSBFUkMyMCB0aGF0IGFsbG93cyBmb3IgZ3JhbnRpbmcgb3RoZXIgVG9rZW4gY29udHJhY3RzIHNwZWNpYWwgcmlnaHRzIHRvIGFjdCBvbiBiZWhhbGYgb2YgYWxsIHRyYW5zZmVycy4gKi8KY29udHJhY3QgVG9rZW4gewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLyogTWFwIGFsbCBvdXIgb3VyIGJhbGFuY2VzIGZvciBpc3N1ZWQgdG9rZW5zICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsKCiAgICAvKiBNYXAgYmV0d2VlbiB1c2VycyBhbmQgdGhlaXIgYXBwcm92YWwgYWRkcmVzc2VzIGFuZCBhbW91bnRzICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvKiBMaXN0IG9mIGFsbCB0b2tlbiBob2xkZXJzICovCiAgICBhZGRyZXNzW10gYWxsVG9rZW5Ib2xkZXJzOwoKICAgIC8qIFRoZSBuYW1lIG9mIHRoZSBjb250cmFjdCAqLwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwoKICAgIC8qIFRoZSBzeW1ib2wgZm9yIHRoZSBjb250cmFjdCAqLwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogICAgLyogSG93IG1hbnkgRFBzIGFyZSBpbiB1c2UgaW4gdGhpcyBjb250cmFjdCAqLwogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIC8qIERlZmluZXMgdGhlIGN1cnJlbnQgc3VwcGx5IG9mIHRoZSB0b2tlbiBpbiBpdHMgb3duIHVuaXRzICovCiAgICB1aW50MjU2IHRvdGFsU3VwcGx5QW1vdW50ID0gMDsKICAgIAogICAgLyogRGVmaW5lcyB0aGUgYWRkcmVzcyBvZiB0aGUgUmVmdW5kIE1hbmFnZXIgY29udHJhY3Qgd2hpY2ggaXMgdGhlIG9ubHkgY29udHJhY3QgdG8gZGVzdHJveSB0b2tlbnMuICovCiAgICBhZGRyZXNzIHB1YmxpYyByZWZ1bmRNYW5hZ2VyQ29udHJhY3RBZGRyZXNzOwoKICAgIC8qIERlZmluZXMgdGhlIGFkbWluIGNvbnRyYWN0IHdlIGludGVyZmFjZSB3aXRoIGZvciBjcmVkZW50YWlscy4gKi8KICAgIEF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXI7CgogICAgLyogSW5zdGFuY2Ugb2YgbG9ja2luIGNvbnRyYWN0ICovCiAgICBMb2NraW5NYW5hZ2VyIGxvY2tpbk1hbmFnZXI7CgogICAgLyoqIEBkZXYgUmV0dXJucyB0aGUgYmFsYW5jZSB0aGF0IGEgZ2l2ZW4gYWRkcmVzcyBoYXMgYXZhaWxhYmxlIGZvciB0cmFuc2Zlci4KICAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBvd25lci4KICAgICAgKi8KICAgIGZ1bmN0aW9uIGF2YWlsYWJsZUJhbGFuY2UoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIAogICAgICAgIHVpbnQyNTYgbGVuZ3RoID0gIGxvY2tpbk1hbmFnZXIuZ2V0TG9ja3MoX293bmVyKTsKICAgIAogICAgICAgIHVpbnQyNTYgbG9ja2VkVmFsdWUgPSAwOwogICAgICAgIAogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKCiAgICAgICAgICAgIGlmKGxvY2tpbk1hbmFnZXIuZ2V0TG9ja3NVbmxvY2tEYXRlKF9vd25lciwgaSkgPiBub3cpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgX3ZhbHVlID0gbG9ja2luTWFuYWdlci5nZXRMb2Nrc0Ftb3VudChfb3duZXIsIGkpOyAgICAKICAgICAgICAgICAgICAgIGxvY2tlZFZhbHVlID0gbG9ja2VkVmFsdWUuYWRkKF92YWx1ZSk7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdLnN1Yihsb2NrZWRWYWx1ZSk7CiAgICB9CgogICAgLyogRmlyZWQgd2hlbiB0aGUgZnVuZCBpcyBldmVudHVhbGx5IGNsb3NlZC4gKi8KICAgIGV2ZW50IEZ1bmRDbG9zZWQoKTsKICAgIAogICAgLyogT3VyIHRyYW5zZmVyIGV2ZW50IHRvIGZpcmUgd2hlbmV2ZXIgd2Ugc2hpZnQgU01SVCBhcm91bmQgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgCiAgICAvKiBPdXIgYXBwcm92YWwgZXZlbnQgd2hlbiBvbmUgdXNlciBhcHByb3ZlcyBhbm90aGVyIHRvIGNvbnRyb2wgKi8KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKICAgIC8qIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiB0aGlzIGZ1bmQgd2l0aCBsaW5rcyB0byBvdGhlciBjb250cmFjdHMgdGhhdCBhcmUgcmVxdWlyZWQuICovCiAgICBmdW5jdGlvbiBUb2tlbihhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7CiAgICAgICAgLy8gU2V0dXAgZGVmYXVsdHMKICAgICAgICBuYW1lID0gIlBJRSAoQXV0aG9yaXRvIENhcGl0YWwpIjsKICAgICAgICBzeW1ib2wgPSAiUElFIjsKICAgICAgICBkZWNpbWFscyA9IDE4OwoKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyAqLwogICAgICAgIGF1dGhlbnRpY2F0aW9uTWFuYWdlciA9IEF1dGhlbnRpY2F0aW9uTWFuYWdlcihfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcyk7ICAgICAgICAKICAgIH0KCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBudW13b3JkcykgewogICAgICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPT0gbnVtd29yZHMgKiAzMiArIDQpOwogICAgICAgIF87CiAgICB9CgogICAgLyogVGhpcyBtb2RpZmllciBhbGxvd3MgYSBtZXRob2QgdG8gb25seSBiZSBjYWxsZWQgYnkgYWNjb3VudCByZWFkZXJzICovCiAgICBtb2RpZmllciBhY2NvdW50UmVhZGVyT25seSB7CiAgICAgICAgaWYgKCFhdXRoZW50aWNhdGlvbk1hbmFnZXIuaXNDdXJyZW50QWNjb3VudFJlYWRlcihtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBjdXJyZW50IGFkbWlucyAqLwogICAgbW9kaWZpZXIgYWRtaW5Pbmx5IHsKICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0gICAKICAgIAogICAgZnVuY3Rpb24gc2V0TG9ja2luTWFuYWdlckFkZHJlc3MoYWRkcmVzcyBfbG9ja2luTWFuYWdlcikgYWRtaW5Pbmx5IHsKICAgICAgICBsb2NraW5NYW5hZ2VyID0gTG9ja2luTWFuYWdlcihfbG9ja2luTWFuYWdlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UmVmdW5kTWFuYWdlckNvbnRyYWN0KGFkZHJlc3MgX3JlZnVuZE1hbmFnZXJDb250cmFjdEFkZHJlc3MpIGFkbWluT25seSB7CiAgICAgICAgcmVmdW5kTWFuYWdlckNvbnRyYWN0QWRkcmVzcyA9IF9yZWZ1bmRNYW5hZ2VyQ29udHJhY3RBZGRyZXNzOwogICAgfQoKICAgIC8qIFRyYW5zZmVyIGZ1bmRzIGJldHdlZW4gdHdvIGFkZHJlc3NlcyB0aGF0IGFyZSBub3QgdGhlIGN1cnJlbnQgbXNnLnNlbmRlciAtIHRoaXMgcmVxdWlyZXMgYXBwcm92YWwgdG8gaGF2ZSBiZWVuIHNldCBzZXBhcmF0ZWx5IGFuZCBmb2xsb3dzIHN0YW5kYXJkIEVSQzIwIGd1aWRlbGluZXMgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5UGF5bG9hZFNpemUoMykgcmV0dXJucyAoYm9vbCkgewogICAgICAgIAogICAgICAgIGlmIChhdmFpbGFibGVCYWxhbmNlKF9mcm9tKSA+PSBfYW1vdW50ICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF9hbW91bnQgJiYgX2Ftb3VudCA+IDAgJiYgYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCkgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJvb2wgaXNOZXcgPSBiYWxhbmNlc1tfdG9dID09IDA7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgICAgIGlmIChpc05ldykKICAgICAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsKICAgICAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA9PSAwKQogICAgICAgICAgICAgICAgdG9rZW5Pd25lclJlbW92ZShfZnJvbSk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBob2xkZXJzIG9mIHRoaXMgY3VycmVuY3kuICovCiAgICBmdW5jdGlvbiB0b2tlbkhvbGRlckNvdW50KCkgYWNjb3VudFJlYWRlck9ubHkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOwogICAgfQoKICAgIC8qIEdldHMgdGhlIHRva2VuIGhvbGRlciBhdCB0aGUgc3BlY2lmaWVkIGluZGV4LiAqLwogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXIodWludDI1NiBfaW5kZXgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYWxsVG9rZW5Ib2xkZXJzW19pbmRleF07CiAgICB9CiAKICAgIC8qIEFkZHMgYW4gYXBwcm92YWwgZm9yIHRoZSBzcGVjaWZpZWQgYWNjb3VudCB0byBzcGVuZCBtb25leSBvZiB0aGUgbWVzc2FnZSBzZW5kZXIgdXAgdG8gdGhlIGRlZmluZWQgbGltaXQgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIGZvciB0aGUgc3BlY2lmaWVkIHNwZW5kZXIgb2YgdGhlIG93bmVyIGFkZHJlc3MgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSB0b3RhbCBzdXBwbHkgYXZhaWxhYmxlIG9mIHRoaXMgdG9rZW4gKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUFtb3VudDsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBiYWxhbmNlIG9mIGEgc3BlY2lmaWVkIGFjY291bnQgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLyogVHJhbnNmZXIgdGhlIGJhbGFuY2UgZnJvbSBvd25lcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50ICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICAgICAgCiAgICAgICAgLyogQ2hlY2sgaWYgc2VuZGVyIGhhcyBiYWxhbmNlIGFuZCBmb3Igb3ZlcmZsb3dzICovCiAgICAgICAgaWYgKGF2YWlsYWJsZUJhbGFuY2UobXNnLnNlbmRlcikgPCBfYW1vdW50IHx8IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpIDwgYmFsYW5jZXNbX3RvXSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvKiBEbyBhIGNoZWNrIHRvIHNlZSBpZiB0aGV5IGFyZSBuZXcsIGlmIHNvIHdlJ2xsIHdhbnQgdG8gYWRkIGl0IHRvIG91ciBhcnJheSAqLwogICAgICAgIGJvb2wgaXNSZWNpcGllbnROZXcgPSBiYWxhbmNlc1tfdG9dID09IDA7CgogICAgICAgIC8qIEFkZCBhbmQgc3VidHJhY3QgbmV3IGJhbGFuY2VzICovCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIAogICAgICAgIC8qIENvbnNvbGlkYXRlIGFycmF5cyBpZiB0aGV5IGFyZSBuZXcgb3IgaWYgc2VuZGVyIG5vdyBoYXMgZW1wdHkgYmFsYW5jZSAqLwogICAgICAgIGlmIChpc1JlY2lwaWVudE5ldykKICAgICAgICAgICAgdG9rZW5Pd25lckFkZChfdG8pOwogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA8PSAwKQogICAgICAgICAgICB0b2tlbk93bmVyUmVtb3ZlKG1zZy5zZW5kZXIpOwoKICAgICAgICAvKiBGaXJlIG5vdGlmaWNhdGlvbiBldmVudCAqLwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7IAogICAgfQoKICAgIC8qIElmIHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBub3QgaW4gb3VyIG93bmVyIGxpc3QsIGFkZCB0aGVtIC0gdGhpcyBjYW4gYmUgY2FsbGVkIGJ5IGRlc2NlbmRlbnRzIHRvIGVuc3VyZSB0aGUgZGF0YWJhc2UgaXMga2VwdCB1cCB0byBkYXRlLiAqLwogICAgZnVuY3Rpb24gdG9rZW5Pd25lckFkZChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7CiAgICAgICAgLyogRmlyc3QgY2hlY2sgaWYgdGhleSBhbHJlYWR5IGV4aXN0ICovCiAgICAgICAgdWludDI1NiB0b2tlbkhvbGRlckNvdW50ID0gYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCB0b2tlbkhvbGRlckNvdW50OyBpKyspCiAgICAgICAgICAgIGlmIChhbGxUb2tlbkhvbGRlcnNbaV0gPT0gX2FkZHIpCiAgICAgICAgICAgICAgICAvKiBBbHJlYWR5IGZvdW5kIHNvIHdlIGNhbiBhYm9ydCBub3cgKi8KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAKICAgICAgICAvKiBUaGV5IGRvbid0IHNlZW0gdG8gZXhpc3QsIHNvIGxldCdzIGFkZCB0aGVtICovCiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCsrOwogICAgICAgIGFsbFRva2VuSG9sZGVyc1thbGxUb2tlbkhvbGRlcnMubGVuZ3RoIC0gMV0gPSBfYWRkcjsKICAgIH0KCiAgICAvKiBJZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaXMgaW4gb3VyIG93bmVyIGxpc3QsIHJlbW92ZSB0aGVtIC0gdGhpcyBjYW4gYmUgY2FsbGVkIGJ5IGRlc2NlbmRlbnRzIHRvIGVuc3VyZSB0aGUgZGF0YWJhc2UgaXMga2VwdCB1cCB0byBkYXRlLiAqLwogICAgZnVuY3Rpb24gdG9rZW5Pd25lclJlbW92ZShhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7CiAgICAgICAgLyogRmluZCBvdXQgd2hlcmUgaW4gb3VyIGFycmF5IHRoZXkgYXJlICovCiAgICAgICAgdWludDI1NiB0b2tlbkhvbGRlckNvdW50ID0gYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGZvdW5kSW5kZXggPSAwOwogICAgICAgIGJvb2wgZm91bmQgPSBmYWxzZTsKICAgICAgICB1aW50MjU2IGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2VuSG9sZGVyQ291bnQ7IGkrKykKICAgICAgICAgICAgaWYgKGFsbFRva2VuSG9sZGVyc1tpXSA9PSBfYWRkcikgewogICAgICAgICAgICAgICAgZm91bmRJbmRleCA9IGk7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIElmIHdlIGRpZG4ndCBmaW5kIHRoZW0ganVzdCByZXR1cm4gKi8KICAgICAgICBpZiAoIWZvdW5kKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgCiAgICAgICAgLyogV2Ugbm93IG5lZWQgdG8gc2h1ZmZsZSBkb3duIHRoZSBhcnJheSAqLwogICAgICAgIGZvciAoaSA9IGZvdW5kSW5kZXg7IGkgPCB0b2tlbkhvbGRlckNvdW50IC0gMTsgaSsrKQogICAgICAgICAgICBhbGxUb2tlbkhvbGRlcnNbaV0gPSBhbGxUb2tlbkhvbGRlcnNbaSArIDFdOwogICAgICAgIGFsbFRva2VuSG9sZGVycy5sZW5ndGgtLTsKICAgIH0KCiAgICAvKiBNaW50IG5ldyB0b2tlbnMgLSB0aGlzIGNhbiBvbmx5IGJlIGRvbmUgYnkgc3BlY2lhbCBjYWxsZXJzIChpLmUuIHRoZSBJQ08gbWFuYWdlbWVudCkgZHVyaW5nIHRoZSBJQ08gcGhhc2UuICovCiAgICBmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX2Ftb3VudCkgb25seVBheWxvYWRTaXplKDIpIHsKCiAgICAgICAgLyogaWYgaXQgaXMgY29tbWluZyBmcm9tIGFjY291bnQgbWludGVyICovCiAgICAgICAgaWYgKCAhIGF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBY2NvdW50TWludGVyKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogTWludCB0aGUgdG9rZW5zIGZvciB0aGUgbmV3IGFkZHJlc3MqLwogICAgICAgIGJvb2wgaXNOZXcgPSBiYWxhbmNlc1tfYWRkcmVzc10gPT0gMDsKICAgICAgICB0b3RhbFN1cHBseUFtb3VudCA9IHRvdGFsU3VwcGx5QW1vdW50LmFkZChfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfYWRkcmVzc10gPSBiYWxhbmNlc1tfYWRkcmVzc10uYWRkKF9hbW91bnQpOwoKICAgICAgICBsb2NraW5NYW5hZ2VyLmRlZmF1bHRMb2NraW4oX2FkZHJlc3MsIF9hbW91bnQpOyAgICAgICAgCgogICAgICAgIGlmIChpc05ldykKICAgICAgICAgICAgdG9rZW5Pd25lckFkZChfYWRkcmVzcyk7CiAgICAgICAgVHJhbnNmZXIoMCwgX2FkZHJlc3MsIF9hbW91bnQpOwogICAgfQoKICAgIC8qKiBUaGlzIHdpbGwgZGVzdHJveSB0aGUgdG9rZW5zIG9mIHRoZSBpbnZlc3RvciBhbmQgY2FsbGVkIGJ5IHNhbGUgY29udHJhY3Qgb25seSBhdCB0aGUgdGltZSBvZiByZWZ1bmQuICovCiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX2ludmVzdG9yLCB1aW50MjU2IHRva2VuQ291bnQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAKICAgICAgICAvKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgcmVmdW5kIG1hbmFnZXIsIGFsc28gcmVmdW5kIG1hbmFnZXIgYWRkcmVzcyBtdXN0IG5vdCBiZSBlbXB0eSAqLwogICAgICAgIGlmICggcmVmdW5kTWFuYWdlckNvbnRyYWN0QWRkcmVzcyAgPT0gMHgwIHx8IG1zZy5zZW5kZXIgIT0gcmVmdW5kTWFuYWdlckNvbnRyYWN0QWRkcmVzcykKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IGF2YWlsYWJsZUJhbGFuY2UoX2ludmVzdG9yKTsKCiAgICAgICAgaWYgKGJhbGFuY2UgPCB0b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGJhbGFuY2VzW19pbnZlc3Rvcl0gLT0gdG9rZW5Db3VudDsKICAgICAgICB0b3RhbFN1cHBseUFtb3VudCAtPSB0b2tlbkNvdW50OwoKICAgICAgICBpZihiYWxhbmNlc1tfaW52ZXN0b3JdIDw9IDApCiAgICAgICAgICAgIHRva2VuT3duZXJSZW1vdmUoX2ludmVzdG9yKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2Vuc2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgLyogRGVmaW5lcyB3aGV0aGVyIG9yIG5vdCB0aGUgIFRva2VuIENvbnRyYWN0IGFkZHJlc3MgaGFzIHlldCBiZWVuIHNldC4gICovCiAgICBib29sIHB1YmxpYyB0b2tlbkNvbnRyYWN0RGVmaW5lZCA9IGZhbHNlOwogICAgCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHdlIGFyZSBpbiB0aGUgU2FsZSBwaGFzZSAqLwogICAgYm9vbCBwdWJsaWMgc2FsZVBoYXNlID0gdHJ1ZTsKCiAgICAvKiBEZWZpbmVzIHRoZSBzYWxlIHByaWNlIG9mIGV0aGVyZXVtIGR1cmluZyBTYWxlICovCiAgICB1aW50MjU2IHB1YmxpYyBldGhlcmV1bVNhbGVSYXRlID0gNzAwOyAvLyBUaGUgbnVtYmVyIG9mIHRva2VucyB0byBiZSBtaW50ZWQgZm9yIGV2ZXJ5IEVUSAoKICAgIC8qIERlZmluZXMgdGhlIHNhbGUgcHJpY2Ugb2YgYml0Y29pbiBkdXJpbmcgU2FsZSAqLwogICAgdWludDI1NiBwdWJsaWMgYml0Y29pblNhbGVSYXRlID0gMTQwMDA7IC8vIFRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIGJlIG1pbnRlZCBmb3IgZXZlcnkgQlRDCgogICAgLyogRGVmaW5lcyBvdXIgaW50ZXJmYWNlIHRvIHRoZSAgVG9rZW4gY29udHJhY3QuICovCiAgICBUb2tlbiB0b2tlbjsKCiAgICAvKiBEZWZpbmVzIHRoZSBhZG1pbiBjb250cmFjdCB3ZSBpbnRlcmZhY2Ugd2l0aCBmb3IgY3JlZGVudGFpbHMuICovCiAgICBBdXRoZW50aWNhdGlvbk1hbmFnZXIgYXV0aGVudGljYXRpb25NYW5hZ2VyOwoKICAgIC8qIENsYWltZWQgVHJhbnNhY3Rpb25zIGZyb20gYnRjIHJlbGF5LiAqLwogICAgbWFwcGluZyh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyB0cmFuc2FjdGlvbnNDbGFpbWVkOwoKICAgIC8qIERlZmluZXMgdGhlIG1pbmltdW0gZXRoZXJldW0gdG8gaW52ZXN0IGR1cmluZyBTYWxlICovCiAgICB1aW50MjU2IHB1YmxpYyBtaW5pbXVuRXRoZXJldW1Ub0ludmVzdCA9IDA7CgogICAgLyogRGVmaW5lcyB0aGUgbWluaW11bSBidGMgdG8gaW52ZXN0IGR1cmluZyBTYWxlICovCiAgICB1aW50MjU2IHB1YmxpYyBtaW5pbXVuQlRDVG9JbnZlc3QgPSAwOwoKICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIHdoZW4gdGhlIFNhbGUgaXMgY2xvc2VkICovCiAgICBldmVudCBTYWxlQ2xvc2VkKCk7CgogICAgLyogRGVmaW5lcyBvdXIgZXZlbnQgZmlyZWQgd2hlbiB0aGUgU2FsZSBpcyByZW9wZW5lZCAqLwogICAgZXZlbnQgU2FsZVN0YXJ0ZWQoKTsKCiAgICAvKiBFdGhlcmV1bSBSYXRlIHVwZGF0ZWQgYnkgdGhlIGFkbWluLiAqLwogICAgZXZlbnQgRXRoZXJldW1SYXRlVXBkYXRlZCh1aW50MjU2IHJhdGUsIHVpbnQyNTYgdGltZXN0YW1wKTsKCiAgICAvKiBCaXRjb2luIFJhdGUgdXBkYXRlZCBieSB0aGUgYWRtaW4uICovCiAgICBldmVudCBCaXRjb2luUmF0ZVVwZGF0ZWQodWludDI1NiByYXRlLCB1aW50MjU2IHRpbWVzdGFtcCk7CgogICAgLyogTWluaW11biBFdGhlcmV1bSBJbnZlc3RtZW50IHVwZGF0ZWQgYnkgdGhlIGFkbWluLiAqLwogICAgZXZlbnQgTWluaW11bUV0aGVyZXVtSW52ZXN0bWVudFVwZGF0ZWQodWludDI1NiBfdmFsdWUsIHVpbnQyNTYgdGltZXN0YW1wKTsKCiAgICAvKiBNaW5pbXVuIEJpdGNvaW4gSW52ZXN0bWVudCB1cGRhdGVkIGJ5IHRoZSBhZG1pbi4gKi8KICAgIGV2ZW50IE1pbmltdW1CaXRjb2luSW52ZXN0bWVudFVwZGF0ZWQodWludDI1NiBfdmFsdWUsIHVpbnQyNTYgdGltZXN0YW1wKTsKCiAgICAvKiBFbnN1cmVzIHRoYXQgb25jZSB0aGUgU2FsZSBpcyBvdmVyIHRoaXMgY29udHJhY3QgY2Fubm90IGJlIHVzZWQgdW50aWwgdGhlIHBvaW50IGl0IGlzIGRlc3RydWN0ZWQuICovCiAgICBtb2RpZmllciBvbmx5RHVyaW5nU2FsZSB7CgogICAgICAgIGlmICghdG9rZW5Db250cmFjdERlZmluZWQgfHwgKCFzYWxlUGhhc2UpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8qIFRoaXMgbW9kaWZpZXIgYWxsb3dzIGEgbWV0aG9kIHRvIG9ubHkgYmUgY2FsbGVkIGJ5IGN1cnJlbnQgYWRtaW5zICovCiAgICBtb2RpZmllciBhZG1pbk9ubHkgewogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8qIENyZWF0ZSB0aGUgIHRva2VuIHNhbGUgYW5kIGRlZmluZSB0aGUgYWRkcmVzcyBvZiB0aGUgbWFpbiBhdXRoZW50aWNhdGlvbiBNYW5hZ2VyIGFkZHJlc3MuICovCiAgICBmdW5jdGlvbiBUb2tlbnNhbGUoYWRkcmVzcyBfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcykgeyAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyAqLwogICAgICAgIGF1dGhlbnRpY2F0aW9uTWFuYWdlciA9IEF1dGhlbnRpY2F0aW9uTWFuYWdlcihfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcyk7CiAgICB9CgogICAgLyogU2V0IHRoZSBUb2tlbiBjb250cmFjdCBhZGRyZXNzIGFzIGEgb25lLXRpbWUgb3BlcmF0aW9uLiAgVGhpcyBoYXBwZW5zIGFmdGVyIGFsbCB0aGUgY29udHJhY3RzIGFyZSBjcmVhdGVkIGFuZCBubwogICAgICAgb3RoZXIgZnVuY3Rpb25hbGl0eSBjYW4gYmUgdXNlZCB1bnRpbCB0aGlzIGlzIHNldC4gKi8KICAgIGZ1bmN0aW9uIHNldFRva2VuQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX3Rva2VuQ29udHJhY3RBZGRyZXNzKSBhZG1pbk9ubHkgewogICAgICAgIC8qIFRoaXMgY2FuIG9ubHkgaGFwcGVuIG9uY2UgaW4gdGhlIGxpZmV0aW1lIG9mIHRoaXMgY29udHJhY3QgKi8KICAgICAgICBpZiAodG9rZW5Db250cmFjdERlZmluZWQpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyAqLwogICAgICAgIHRva2VuID0gVG9rZW4oX3Rva2VuQ29udHJhY3RBZGRyZXNzKTsKCiAgICAgICAgdG9rZW5Db250cmFjdERlZmluZWQgPSB0cnVlOwogICAgfQoKICAgIC8qIFJ1biB0aGlzIGZ1bmN0aW9uIHdoZW4gdHJhbnNhY3Rpb24gaGFzIGJlZW4gdmVyaWZpZWQgYnkgdGhlIGJ0YyByZWxheSAqLwogICAgZnVuY3Rpb24gcHJvY2Vzc0JUQ1RyYW5zYWN0aW9uKGJ5dGVzIHR4biwgdWludDI1NiBfdHhIYXNoLCBhZGRyZXNzIGV0aGVyZXVtQWRkcmVzcywgYnl0ZXMyMCBiaXRjb2luQWRkcmVzcykgYWRtaW5Pbmx5IHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLyogVHJhbnNhY3Rpb24gaXMgYWxyZWFkeSBjbGFpbWVkICovCiAgICAgICAgaWYodHJhbnNhY3Rpb25zQ2xhaW1lZFtfdHhIYXNoXSAhPSBmYWxzZSkgCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICB2YXIgKG91dHB1dFZhbHVlMSwgb3V0cHV0QWRkcmVzczEsIG91dHB1dFZhbHVlMiwgb3V0cHV0QWRkcmVzczIpID0gQlRDLmdldEZpcnN0VHdvT3V0cHV0cyh0eG4pOwoKICAgICAgICBpZihCVEMuY2hlY2tWYWx1ZVNlbnQodHhuLCBiaXRjb2luQWRkcmVzcywgMSkpCiAgICAgICAgewogICAgICAgICAgICByZXF1aXJlKG91dHB1dFZhbHVlMSA+PSBtaW5pbXVuQlRDVG9JbnZlc3QpOwoKICAgICAgICAgICAgIC8vbXVsdGlwbHkgYnkgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgICB1aW50MjU2IHRva2Vuc1B1cmNoYXNlZCA9IG91dHB1dFZhbHVlMSAqIGJpdGNvaW5TYWxlUmF0ZSAqICgxMCoqMTApOyAgCgogICAgICAgICAgICB0b2tlbi5taW50VG9rZW5zKGV0aGVyZXVtQWRkcmVzcywgdG9rZW5zUHVyY2hhc2VkKTsKCiAgICAgICAgICAgIHRyYW5zYWN0aW9uc0NsYWltZWRbX3R4SGFzaF0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyB2YWx1ZSB3YXMgbm90IHNlbnQgdG8gdGhpcyBidGMgYWRkcmVzcwogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYnRjVHJhbnNhY3Rpb25DbGFpbWVkKHVpbnQyNTYgX3R4SGFzaCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uc0NsYWltZWRbX3R4SGFzaF07CiAgICB9ICAgCiAgICAKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgCiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgCiAgICB9CgogICAgLyogSGFuZGxlIHJlY2VpdmluZyBldGhlciBpbiBTYWxlIHBoYXNlIC0gd2Ugd29yayBvdXQgaG93IG11Y2ggdGhlIHVzZXIgaGFzIGJvdWdodCwgYWxsb2NhdGUgYSBzdWl0YWJsZSBiYWxhbmNlIGFuZCBzZW5kIHRoZWlyIGNoYW5nZSAqLwogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIG9ubHlEdXJpbmdTYWxlIHBheWFibGUgewoKICAgICAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgICAgICB1aW50MjU2IHRva2Vuc1B1cmNoYXNlZCA9IHdlaUFtb3VudC5tdWwoZXRoZXJldW1TYWxlUmF0ZSk7CiAgICAgICAgCiAgICAgICAgLyogSW5jcmVhc2UgdGhlaXIgbmV3IGJhbGFuY2UgaWYgdGhleSBhY3R1YWxseSBwdXJjaGFzZWQgYW55ICovCiAgICAgICAgaWYgKHRva2Vuc1B1cmNoYXNlZCA+IDApCiAgICAgICAgewogICAgICAgICAgICB0b2tlbi5taW50VG9rZW5zKGJlbmVmaWNpYXJ5LCB0b2tlbnNQdXJjaGFzZWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICBib29sIG5vblplcm9QdXJjaGFzZSA9ICggbXNnLnZhbHVlICE9IDAgJiYgbXNnLnZhbHVlID49IG1pbmltdW5FdGhlcmV1bVRvSW52ZXN0KTsKICAgICAgICByZXR1cm4gbm9uWmVyb1B1cmNoYXNlOwogICAgfQoKICAgIC8qIFJhdGUgb24gd2hpY2ggKi8KICAgIGZ1bmN0aW9uIHNldEV0aGVyZXVtUmF0ZSh1aW50MjU2IF9yYXRlKSBhZG1pbk9ubHkgewoKICAgICAgICBldGhlcmV1bVNhbGVSYXRlID0gX3JhdGU7CgogICAgICAgIC8qIEF1ZGl0IHRoaXMgKi8KICAgICAgICBFdGhlcmV1bVJhdGVVcGRhdGVkKGV0aGVyZXVtU2FsZVJhdGUsIG5vdyk7CiAgICB9CgogICAgICAvKiBSYXRlIG9uIHdoaWNoICovCiAgICBmdW5jdGlvbiBzZXRCaXRjb2luUmF0ZSh1aW50MjU2IF9yYXRlKSBhZG1pbk9ubHkgewoKICAgICAgICBiaXRjb2luU2FsZVJhdGUgPSBfcmF0ZTsKCiAgICAgICAgLyogQXVkaXQgdGhpcyAqLwogICAgICAgIEJpdGNvaW5SYXRlVXBkYXRlZChiaXRjb2luU2FsZVJhdGUsIG5vdyk7CiAgICB9ICAgIAoKICAgICAgICAvKiB1cGRhdGUgbWluIEV0aGVyZXVtIHRvIGludmVzdCAqLwogICAgZnVuY3Rpb24gc2V0TWluaW11bUV0aGVyZXVtVG9JbnZlc3QodWludDI1NiBfdmFsdWUpIGFkbWluT25seSB7CgogICAgICAgIG1pbmltdW5FdGhlcmV1bVRvSW52ZXN0ID0gX3ZhbHVlOwoKICAgICAgICAvKiBBdWRpdCB0aGlzICovCiAgICAgICAgTWluaW11bUV0aGVyZXVtSW52ZXN0bWVudFVwZGF0ZWQoX3ZhbHVlLCBub3cpOwogICAgfSAgICAKCiAgICAgICAgICAvKiB1cGRhdGUgbWluaW11bSBCaXRjb2luIHRvIGludmVzdCAqLwogICAgZnVuY3Rpb24gc2V0TWluaW11bUJpdGNvaW5Ub0ludmVzdCh1aW50MjU2IF92YWx1ZSkgYWRtaW5Pbmx5IHsKCiAgICAgICAgbWluaW11bkJUQ1RvSW52ZXN0ID0gX3ZhbHVlOwoKICAgICAgICAvKiBBdWRpdCB0aGlzICovCiAgICAgICAgTWluaW11bUJpdGNvaW5JbnZlc3RtZW50VXBkYXRlZChfdmFsdWUsIG5vdyk7CiAgICB9CgogICAgICAvKiBDbG9zZSB0aGUgU2FsZSBwaGFzZSBhbmQgdHJhbnNpdGlvbiB0byBleGVjdXRpb24gcGhhc2UgKi8KICAgIGZ1bmN0aW9uIGNsb3NlKCkgYWRtaW5Pbmx5IG9ubHlEdXJpbmdTYWxlIHsKCiAgICAgICAgLy8gQ2xvc2UgdGhlIFNhbGUKICAgICAgICBzYWxlUGhhc2UgPSBmYWxzZTsKICAgICAgICBTYWxlQ2xvc2VkKCk7CgogICAgICAgIC8vIFdpdGhkcmF3IGZ1bmRzIHRvIHRoZSBjYWxsZXIKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvKiBPcGVuIHRoZSBzYWxlIHBoYXNlKi8KICAgIGZ1bmN0aW9uIG9wZW5TYWxlKCkgYWRtaW5Pbmx5IHsgICAgICAgIAogICAgICAgIHNhbGVQaGFzZSA9IHRydWU7CiAgICAgICAgU2FsZVN0YXJ0ZWQoKTsKICAgIH0KfQ=='.
	

]
