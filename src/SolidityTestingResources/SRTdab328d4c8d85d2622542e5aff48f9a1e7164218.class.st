Class {
	#name : #SRTdab328d4c8d85d2622542e5aff48f9a1e7164218,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdab328d4c8d85d2622542e5aff48f9a1e7164218 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBFdGhlcm5hdXRzCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKCgoKCgoKLy8gRXh0ZW5kIHRoaXMgbGlicmFyeSBmb3IgY2hpbGQgY29udHJhY3RzCmxpYnJhcnkgU2FmZU1hdGggewoKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAgICovCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICAgKi8KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWF4KGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA+IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWluKGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA8IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKCn0KCgoKCi8vLyBAZGV2IEJhc2UgY29udHJhY3QgZm9yIGFsbCBFdGhlcm5hdXRzIGNvbnRyYWN0cyBob2xkaW5nIGdsb2JhbCBjb25zdGFudHMgYW5kIGZ1bmN0aW9ucy4KY29udHJhY3QgRXRoZXJuYXV0c0Jhc2UgewoKICAgIC8qKiogQ09OU1RBTlRTIFVTRUQgQUNST1NTIENPTlRSQUNUUyAqKiovCgogICAgLy8vIEBkZXYgVXNlZCBieSBhbGwgY29udHJhY3RzIHRoYXQgaW50ZXJmYWNlcyB3aXRoIEV0aGVybmF1dHMKICAgIC8vLyAgICAgIFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NQogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAgIC8vLyBAZGV2IGR1ZSBzb2xpZGl0eSBsaW1pdGF0aW9uIHdlIGNhbm5vdCByZXR1cm4gZHluYW1pYyBhcnJheSBmcm9tIG1ldGhvZHMKICAgIC8vLyBzbyBpdCBjcmVhdGVzIGluY29tcGFiaWxpdHkgYmV0d2VlbiBmdW5jdGlvbnMgYWNyb3NzIGRpZmZlcmVudCBjb250cmFjdHMKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBTVEFUU19TSVpFID0gMTA7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgU0hJUF9TTE9UUyA9IDU7CgogICAgLy8gUG9zc2libGUgc3RhdGUgb2YgYW55IGFzc2V0CiAgICBlbnVtIEFzc2V0U3RhdGUgeyBBdmFpbGFibGUsIFVwRm9yTGVhc2UsIFVzZWQgfQoKICAgIC8vIFBvc3NpYmxlIHN0YXRlIG9mIGFueSBhc3NldAogICAgLy8gTm90VmFsaWQgaXMgdG8gYXZvaWQgMCBpbiBwbGFjZXMgd2hlcmUgY2F0ZWdvcnkgbXVzdCBiZSBiaWdnZXIgdGhhbiB6ZXJvCiAgICBlbnVtIEFzc2V0Q2F0ZWdvcnkgeyBOb3RWYWxpZCwgU2VjdG9yLCBNYW51ZmFjdHVyZXIsIFNoaXAsIE9iamVjdCwgRmFjdG9yeSwgQ3Jld01lbWJlciB9CgogICAgLy8vIEBkZXYgU2VjdG9yIHN0YXRzCiAgICBlbnVtIFNoaXBTdGF0cyB7TGV2ZWwsIEF0dGFjaywgRGVmZW5zZSwgU3BlZWQsIFJhbmdlLCBMdWNrfQogICAgLy8vIEBub3RpY2UgUG9zc2libGUgYXR0cmlidXRlcyBmb3IgZWFjaCBhc3NldAogICAgLy8vIDAwMDAwMDAxIC0gU2VlZGVkIC0gT2ZmZXJlZCB0byB0aGUgZWNvbm9teSBieSB1cywgdGhlIGRldmVsb3BlcnMuIFBvdGVudGlhbGx5IGF0IHJlZ3VsYXIgaW50ZXJ2YWxzLgogICAgLy8vIDAwMDAwMDEwIC0gUHJvZHVjaWJsZSAtIFByb2R1Y3Qgb2YgYSBmYWN0b3J5IGFuZC9vciBmYWN0b3J5IGNvbnRyYWN0LgogICAgLy8vIDAwMDAwMTAwIC0gRXhwbG9yYWJsZS0gUHJvZHVjdCBvZiBleHBsb3JhdGlvbi4KICAgIC8vLyAwMDAwMTAwMCAtIExlYXNhYmxlIC0gQ2FuIGJlIHJlbnRlZCB0byBvdGhlciB1c2VycyBhbmQgd2lsbCByZXR1cm4gdG8gdGhlIG9yaWdpbmFsIG93bmVyIG9uY2UgdGhlIGFjdGlvbiBpcyBjb21wbGV0ZS4KICAgIC8vLyAwMDAxMDAwMCAtIFBlcm1hbmVudCAtIENhbm5vdCBiZSByZW1vdmVkLCBhbHdheXMgb3duZWQgYnkgYSB1c2VyLgogICAgLy8vIDAwMTAwMDAwIC0gQ29uc3VtYWJsZSAtIERlc3Ryb3llZCBhZnRlciBOIGV4cGxvcmF0aW9uIGV4cGVkaXRpb25zLgogICAgLy8vIDAxMDAwMDAwIC0gVHJhZGFibGUgLSBCdXlhYmxlIGFuZCBzZWxsYWJsZSBvbiB0aGUgbWFya2V0LgogICAgLy8vIDEwMDAwMDAwIC0gSG90IFBvdGF0byAtIEF1dG9tYXRpY2FsbHkgZ2V0cyBwdXQgdXAgZm9yIHNhbGUgYWZ0ZXIgYWNxdWlyaW5nLgogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX1NFRURFRCAgICAgPSBieXRlczIoMioqMCk7CiAgICBieXRlczIgcHVibGljIEFUVFJfUFJPRFVDSUJMRSA9IGJ5dGVzMigyKioxKTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9FWFBMT1JBQkxFID0gYnl0ZXMyKDIqKjIpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX0xFQVNBQkxFICAgPSBieXRlczIoMioqMyk7CiAgICBieXRlczIgcHVibGljIEFUVFJfUEVSTUFORU5UICA9IGJ5dGVzMigyKio0KTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9DT05TVU1BQkxFID0gYnl0ZXMyKDIqKjUpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX1RSQURBQkxFICAgPSBieXRlczIoMioqNik7CiAgICBieXRlczIgcHVibGljIEFUVFJfR09MREVOR09PU0UgPSBieXRlczIoMioqNyk7Cn0KCi8vLyBAbm90aWNlIFRoaXMgY29udHJhY3QgbWFuYWdlcyB0aGUgdmFyaW91cyBhZGRyZXNzZXMgYW5kIGNvbnN0cmFpbnRzIGZvciBvcGVyYXRpb25zCi8vICAgICAgICAgIHRoYXQgY2FuIGJlIGV4ZWN1dGVkIG9ubHkgYnkgc3BlY2lmaWMgcm9sZXMuIE5hbWVseSBDRU8gYW5kIENUTy4gaXQgYWxzbyBpbmNsdWRlcyBwYXVzYWJsZSBwYXR0ZXJuLgpjb250cmFjdCBFdGhlcm5hdXRzQWNjZXNzQ29udHJvbCBpcyBFdGhlcm5hdXRzQmFzZSB7CgogICAgLy8gVGhpcyBmYWNldCBjb250cm9scyBhY2Nlc3MgY29udHJvbCBmb3IgRXRoZXJuYXV0cy4KICAgIC8vIEFsbCByb2xlcyBoYXZlIHNhbWUgcmVzcG9uc2liaWxpdGllcyBhbmQgcmlnaHRzLCBidXQgdGhlcmUgaXMgc2xpZ2h0IGRpZmZlcmVuY2VzIGJldHdlZW4gdGhlbToKICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcyBhbmQgb25seSByb2xlIHRoYXQgY2FuIHVucGF1c2UgdGhlIHNtYXJ0IGNvbnRyYWN0LgogICAgLy8gICAgICAgSXQgaXMgaW5pdGlhbGx5IHNldCB0byB0aGUgYWRkcmVzcyB0aGF0IGNyZWF0ZWQgdGhlIHNtYXJ0IGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDVE86IFRoZSBDVE8gY2FuIGNoYW5nZSBjb250cmFjdCBhZGRyZXNzLCBvcmFjbGUgYWRkcmVzcyBhbmQgcGxhbiBmb3IgdXBncmFkZXMuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENPTzogVGhlIENPTyBjYW4gY2hhbmdlIGNvbnRyYWN0IGFkZHJlc3MgYW5kIGFkZCBjcmVhdGUgYXNzZXRzLgogICAgLy8KICAgIC8vLyBAZGV2IEVtaXRlZCB3aGVuIGNvbnRyYWN0IGlzIHVwZ3JhZGVkIC0gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgLy8vIEBwYXJhbSBuZXdDb250cmFjdCBhZGRyZXNzIHBvaW50aW5nIHRvIG5ldyBjb250cmFjdAogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICAgIC8vIFRoZSBhZGRyZXNzZXMgb2YgdGhlIGFjY291bnRzIChvciBjb250cmFjdHMpIHRoYXQgY2FuIGV4ZWN1dGUgYWN0aW9ucyB3aXRoaW4gZWFjaCByb2xlcy4KICAgIGFkZHJlc3MgcHVibGljIGNlb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjdG9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY29vQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIG9yYWNsZUFkZHJlc3M7CgogICAgLy8gQGRldiBLZWVwcyB0cmFjayB3aGV0aGVyIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0VPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENUTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDVE8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGN0b0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDVE8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5T3JhY2xlKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGVBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY3RvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MKICAgICAgICApOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0VPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ1RPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDVE8gb3IgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q1RPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ1RPCiAgICBmdW5jdGlvbiBzZXRDVE8oYWRkcmVzcyBfbmV3Q1RPKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY3RvQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgcmVxdWlyZShfbmV3Q1RPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjdG9BZGRyZXNzID0gX25ld0NUTzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDT08uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENPTyBvciBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDT08gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjb29BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNvb0FkZHJlc3MgPSBfbmV3Q09POwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgb3JhY2xlLgogICAgLy8vIEBwYXJhbSBfbmV3T3JhY2xlIFRoZSBhZGRyZXNzIG9mIG9yYWNsZQogICAgZnVuY3Rpb24gc2V0T3JhY2xlKGFkZHJlc3MgX25ld09yYWNsZSkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjdG9BZGRyZXNzKTsKICAgICAgICByZXF1aXJlKF9uZXdPcmFjbGUgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIG9yYWNsZUFkZHJlc3MgPSBfbmV3T3JhY2xlOwogICAgfQoKICAgIC8qKiogUGF1c2FibGUgZnVuY3Rpb25hbGl0eSBhZGFwdGVkIGZyb20gT3BlblplcHBlbGluICoqKi8KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSAiQy1sZXZlbCIgcm9sZSB0byBwYXVzZSB0aGUgY29udHJhY3QuIFVzZWQgb25seSB3aGVuCiAgICAvLy8gIGEgYnVnIG9yIGV4cGxvaXQgaXMgZGV0ZWN0ZWQgYW5kIHdlIG5lZWQgdG8gbGltaXQgZGFtYWdlLgogICAgZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTywgc2luY2UKICAgIC8vLyAgb25lIHJlYXNvbiB3ZSBtYXkgcGF1c2UgdGhlIGNvbnRyYWN0IGlzIHdoZW4gQ1RPIGFjY291bnQgaXMgY29tcHJvbWlzZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5CiAgICAvLy8gIGRlcml2ZWQgY29udHJhY3RzLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIGNhbid0IHVucGF1c2UgaWYgY29udHJhY3Qgd2FzIHVwZ3JhZGVkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9Cgp9CgovLy8gQHRpdGxlIFRoZSBmYWNldCBvZiB0aGUgRXRoZXJuYXV0cyBjb250cmFjdCB0aGF0IG1hbmFnZXMgb3duZXJzaGlwLCBFUkMtNzIxIGNvbXBsaWFudC4KLy8vIEBub3RpY2UgVGhpcyBwcm92aWRlcyB0aGUgbWV0aG9kcyByZXF1aXJlZCBmb3IgYmFzaWMgbm9uLWZ1bmdpYmxlIHRva2VuCi8vICAgICAgICAgIHRyYW5zYWN0aW9ucywgZm9sbG93aW5nIHRoZSBkcmFmdCBFUkMtNzIxIHNwZWMgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpLgovLyAgICAgICAgICBJdCBpbnRlcmZhY2VzIHdpdGggRXRoZXJuYXV0c1N0b3JhZ2UgcHJvdmluZGluZyBiYXNpYyBmdW5jdGlvbnMgYXMgY3JlYXRlIGFuZCBsaXN0LCBhbHNvIGhvbGRzCi8vICAgICAgICAgIHJlZmVyZW5jZSB0byBsb2dpYyBjb250cmFjdHMgYXMgQXVjdGlvbiwgRXhwbG9yZSBhbmQgc28gb24KLy8vIEBhdXRob3IgRXRoZXJuYXR1cyAtIEZlcm5hbmRvIFBhdWVyCi8vLyBAZGV2IFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQpjb250cmFjdCBFdGhlcm5hdXRzT3duZXJzaGlwIGlzIEV0aGVybmF1dHNBY2Nlc3NDb250cm9sLCBFUkM3MjEgewoKICAgIC8vLyBAZGV2IENvbnRyYWN0IGhvbGRpbmcgb25seSBkYXRhLgogICAgRXRoZXJuYXV0c1N0b3JhZ2UgcHVibGljIGV0aGVybmF1dHNTdG9yYWdlOwoKICAgIC8qKiogQ09OU1RBTlRTICoqKi8KICAgIC8vLyBAbm90aWNlIE5hbWUgYW5kIHN5bWJvbCBvZiB0aGUgbm9uIGZ1bmdpYmxlIHRva2VuLCBhcyBkZWZpbmVkIGluIEVSQzcyMS4KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJFdGhlcm5hdXRzIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkVUTlQiOwoKICAgIC8qKioqKioqKiogRVJDIDcyMSAtIENPTVBMSUFOQ0UgQ09OU1RBTlRTIEFORCBGVU5DVElPTlMgKioqKioqKioqKioqKioqLwogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPSBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8qKiogRVZFTlRTICoqKi8KCiAgICAvLyBFdmVudHMgYXMgcGVyIEVSQy03MjEKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIGFwcHJvdmVkLCB1aW50MjU2IHRva2Vucyk7CgogICAgLy8vIEBkZXYgV2hlbiBhIG5ldyBhc3NldCBpcyBjcmVhdGUgaXQgZW1pdHMgYnVpbGQgZXZlbnQKICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3Mgb2YgYXNzZXQgb3duZXIKICAgIC8vLyBAcGFyYW0gdG9rZW5JZCBBc3NldCBVbmlxdWVJRAogICAgLy8vIEBwYXJhbSBhc3NldElkIElEIHRoYXQgZGVmaW5lcyBhc3NldCBsb29rIGFuZCBmZWVsCiAgICAvLy8gQHBhcmFtIHByaWNlIGFzc2V0IHByaWNlCiAgICBldmVudCBCdWlsZChhZGRyZXNzIG93bmVyLCB1aW50MjU2IHRva2VuSWQsIHVpbnQxNiBhc3NldElkLCB1aW50MjU2IHByaWNlKTsKCiAgICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KICAgIC8vLyAgUmV0dXJucyB0cnVlIGZvciBhbnkgc3RhbmRhcmRpemVkIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgdGhpcyBjb250cmFjdC4gRVJDLTE2NSBhbmQgRVJDLTcyMS4KICAgIC8vLyBAcGFyYW0gX2ludGVyZmFjZUlEIGludGVyZmFjZSBzaWduYXR1cmUgSUQKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gKChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSkgfHwgKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBpcyB0aGUgY3VycmVudCBvd25lciBvZiBhIHBhcnRpY3VsYXIgQXNzZXQuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgdmFsaWRhdGluZyBhZ2FpbnN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQ7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBjdXJyZW50bHkgaGFzIHRyYW5zZmVyQXBwcm92YWwgZm9yIGEgcGFydGljdWxhciBBc3NldC4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSBjb25maXJtaW5nIGFzc2V0IGlzIGFwcHJvdmVkIGZvci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGV0aGVybmF1dHNTdG9yYWdlLmFwcHJvdmVkRm9yKF90b2tlbklkKSA9PSBfY2xhaW1hbnQ7CiAgICB9CgogICAgLy8vIEBkZXYgTWFya3MgYW4gYWRkcmVzcyBhcyBiZWluZyBhcHByb3ZlZCBmb3IgdHJhbnNmZXJGcm9tKCksIG92ZXJ3cml0aW5nIGFueSBwcmV2aW91cwogICAgLy8vICBhcHByb3ZhbC4gU2V0dGluZyBfYXBwcm92ZWQgdG8gYWRkcmVzcygwKSBjbGVhcnMgYWxsIHRyYW5zZmVyIGFwcHJvdmFsLgogICAgLy8vICBOT1RFOiBfYXBwcm92ZSgpIGRvZXMgTk9UIHNlbmQgdGhlIEFwcHJvdmFsIGV2ZW50LiBUaGlzIGlzIGludGVudGlvbmFsIGJlY2F1c2UKICAgIC8vLyAgX2FwcHJvdmUoKSBhbmQgdHJhbnNmZXJGcm9tKCkgYXJlIHVzZWQgdG9nZXRoZXIgZm9yIHB1dHRpbmcgQXNzZXRzIG9uIGF1Y3Rpb24sIGFuZAogICAgLy8vICB0aGVyZSBpcyBubyB2YWx1ZSBpbiBzcGFtbWluZyB0aGUgbG9nIHdpdGggQXBwcm92YWwgZXZlbnRzIGluIHRoYXQgY2FzZS4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UuYXBwcm92ZShfdG9rZW5JZCwgX2FwcHJvdmVkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgQXNzZXRzIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIGV0aGVybmF1dHNTdG9yYWdlLmJhbGFuY2VPZihfb3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgYSBBc3NldCB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0byBhIHNtYXJ0CiAgICAvLy8gIGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxIChvcgogICAgLy8vICBFdGhlcm5hdXRzIHNwZWNpZmljYWxseSkgb3IgeW91ciBBc3NldCBtYXkgYmUgbG9zdCBmb3JldmVyLiBTZXJpb3VzbHkuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEFzc2V0IHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgYXNzZXRzCiAgICAgICAgLy8gKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkgYWZ0ZXIgaXQgaXMgY3JlYXRlZCBhbmQgYmVmb3JlIGl0IGdvZXMgb24gYXVjdGlvbikuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoZSBzdG9yYWdlIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbAogICAgICAgIC8vIG1pc3VzZS4gQXVjdGlvbiBvciBVcGdyYWRlIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBhc3NldHMKICAgICAgICAvLyB0aHJvdWdoIHRoZSBhbGxvdyArIHRyYW5zZmVyRnJvbSBmbG93LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoZXRoZXJuYXV0c1N0b3JhZ2UpKTsKCiAgICAgICAgLy8gWW91IGNhbiBvbmx5IHNlbmQgeW91ciBvd24gYXNzZXQuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAsIGNsZWFyIHBlbmRpbmcgYXBwcm92YWxzLCBlbWl0IFRyYW5zZmVyIGV2ZW50LgogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLnRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQG5vdGljZSBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIGEgc3BlY2lmaWMgQXNzZXQgdmlhCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBUaGlzIGlzIHRoZSBwcmVmZXJyZWQgZmxvdyBmb3IgdHJhbnNmZXJpbmcgTkZUcyB0byBjb250cmFjdHMuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBiZSBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsLiBQYXNzIGFkZHJlc3MoMCkgdG8KICAgIC8vLyAgY2xlYXIgYWxsIGFwcHJvdmFscy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBBc3NldCB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICBmdW5jdGlvbiBhcHByb3ZlKAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gT25seSBhbiBvd25lciBjYW4gZ3JhbnQgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWdpc3RlciB0aGUgYXBwcm92YWwgKHJlcGxhY2luZyBhbnkgcHJldmlvdXMgYXBwcm92YWwpLgogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCBfdG8pOwoKICAgICAgICAvLyBFbWl0IGFwcHJvdmFsIGV2ZW50LgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIEFzc2V0IG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBBc3NldCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBBc3NldC4gQ2FuIGJlIGFueSBhZGRyZXNzLAogICAgLy8vICBpbmNsdWRpbmcgdGhlIGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBBc3NldCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBpbnRlcm5hbAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBhc3NldHMgKGV4Y2VwdCBmb3IgdXNlZCBhc3NldHMpLgogICAgICAgIHJlcXVpcmUoX293bnMoX2Zyb20sIF90b2tlbklkKSk7CiAgICAgICAgLy8gQ2hlY2sgZm9yIGFwcHJvdmFsIGFuZCB2YWxpZCBvd25lcnNoaXAKICAgICAgICByZXF1aXJlKF9hcHByb3ZlZEZvcihfdG8sIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCAoYWxzbyBjbGVhcnMgcGVuZGluZyBhcHByb3ZhbHMgYW5kIGVtaXRzIFRyYW5zZmVyIGV2ZW50KS4KICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS50cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgQXNzZXQgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcgYWRkcmVzcwogICAgLy8vICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIEFzc2V0IHRvIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHNob3VsZCB0YWtlIG93bmVyc2hpcCBvZiB0aGUgQXNzZXQuIENhbiBiZSBhbnkgYWRkcmVzcywKICAgIC8vLyAgaW5jbHVkaW5nIHRoZSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgQXNzZXQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIF90cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQG5vdGljZSBBbGxvdyBwcmUtYXBwcm92ZWQgdXNlciB0byB0YWtlIG93bmVyc2hpcCBvZiBhIHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICAgIGFkZHJlc3MgX2Zyb20gPSBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF90b2tlbklkKTsKCiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX2Zyb20gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgX3RyYW5zZmVyRnJvbShfZnJvbSwgbXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBBc3NldHMgY3VycmVudGx5IGluIGV4aXN0ZW5jZS4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZXRoZXJuYXV0c1N0b3JhZ2UudG90YWxTdXBwbHkoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIG93bmVyIG9mIGEgZ2l2ZW4gQXNzZXQoVG9rZW4pLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUb2tlbiBJRCB0byBnZXQgb3duZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgb3duZXIgPSBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF90b2tlbklkKTsKCiAgICAgICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgbmV3IEFzc2V0IHdpdGggdGhlIGdpdmVuIGZpZWxkcy4gT05seSBhdmFpbGFibGUgZm9yIEMgTGV2ZWxzCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yVG9rZW5JRCBUaGUgYXNzZXQgd2hvIGlzIGZhdGhlciBvZiB0aGlzIGFzc2V0CiAgICAvLy8gQHBhcmFtIF9wcmljZSBhc3NldCBwcmljZQogICAgLy8vIEBwYXJhbSBfYXNzZXRJRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBjcmVhdGVOZXdBc3NldCgKICAgICAgICB1aW50MjU2IF9jcmVhdG9yVG9rZW5JRCwKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICB1aW50MTYgX2Fzc2V0SUQsCiAgICAgICAgdWludDggX2NhdGVnb3J5LAogICAgICAgIHVpbnQ4IF9hdHRyaWJ1dGVzLAogICAgICAgIHVpbnQ4W1NUQVRTX1NJWkVdIF9zdGF0cwogICAgKQogICAgZXh0ZXJuYWwgb25seUNMZXZlbAogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBvd25lciBtdXN0IGJlIHNlbmRlcgogICAgICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB1aW50MjU2IHRva2VuSUQgPSBldGhlcm5hdXRzU3RvcmFnZS5jcmVhdGVBc3NldCgKICAgICAgICAgICAgX2NyZWF0b3JUb2tlbklELAogICAgICAgICAgICBfb3duZXIsCiAgICAgICAgICAgIF9wcmljZSwKICAgICAgICAgICAgX2Fzc2V0SUQsCiAgICAgICAgICAgIF9jYXRlZ29yeSwKICAgICAgICAgICAgdWludDgoQXNzZXRTdGF0ZS5BdmFpbGFibGUpLAogICAgICAgICAgICBfYXR0cmlidXRlcywKICAgICAgICAgICAgX3N0YXRzLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwCiAgICAgICAgKTsKCiAgICAgICAgLy8gZW1pdCB0aGUgYnVpbGQgZXZlbnQKICAgICAgICBCdWlsZCgKICAgICAgICAgICAgX293bmVyLAogICAgICAgICAgICB0b2tlbklELAogICAgICAgICAgICBfYXNzZXRJRCwKICAgICAgICAgICAgX3ByaWNlCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIHRva2VuSUQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdmVyaWZ5IGlmIHRva2VuIGlzIGluIGV4cGxvcmF0aW9uIHRpbWUKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFRva2VuIElEIHRoYXQgY2FuIGJlIHVwZ3JhZGVkCiAgICBmdW5jdGlvbiBpc0V4cGxvcmluZyh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBjb29sZG93bjsKICAgICAgICB1aW50NjQgY29vbGRvd25FbmRCbG9jazsKICAgICAgICAoLCwsLCxjb29sZG93bkVuZEJsb2NrLCBjb29sZG93biwpID0gZXRoZXJuYXV0c1N0b3JhZ2UuYXNzZXRzKF90b2tlbklkKTsKICAgICAgICByZXR1cm4gKGNvb2xkb3duID4gbm93KSB8fCAoY29vbGRvd25FbmRCbG9jayA+IHVpbnQ2NChibG9jay5udW1iZXIpKTsKICAgIH0KfQoKCgoKCgoKCgovLy8gQHRpdGxlIFN0b3JhZ2UgY29udHJhY3QgZm9yIEV0aGVybmF1dHMgRGF0YS4gQ29tbW9uIHN0cnVjdHMgYW5kIGNvbnN0YW50cy4KLy8vIEBub3RpY2UgVGhpcyBpcyBvdXIgbWFpbiBkYXRhIHN0b3JhZ2UsIGNvbnN0YW50cyBhbmQgZGF0YSB0eXBlcywgcGx1cwovLyAgICAgICAgICBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIHRoZSBhc3NldHMuIEl0IGlzIGlzb2xhdGVkIGFuZCBvbmx5IGludGVyZmFjZSB3aXRoCi8vICAgICAgICAgIGEgbGlzdCBvZiBncmFudGVkIGNvbnRyYWN0cyBkZWZpbmVkIGJ5IENUTwovLy8gQGF1dGhvciBFdGhlcm5hdXRzIC0gRmVybmFuZG8gUGF1ZXIKY29udHJhY3QgRXRoZXJuYXV0c1N0b3JhZ2UgaXMgRXRoZXJuYXV0c0FjY2Vzc0NvbnRyb2wgewoKICAgIGZ1bmN0aW9uIEV0aGVybmF1dHNTdG9yYWdlKCkgcHVibGljIHsKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0VPCiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDVE8gYXMgd2VsbAogICAgICAgIGN0b0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ1RPIGFzIHdlbGwKICAgICAgICBjb29BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIE9yYWNsZSBhcyB3ZWxsCiAgICAgICAgb3JhY2xlQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTm8gdGlwcGluZyEKICAgIC8vLyBAZGV2IFJlamVjdCBhbGwgRXRoZXIgZnJvbSBiZWluZyBzZW50IGhlcmUuIEhvcGVmdWxseSwgd2UgY2FuIHByZXZlbnQgdXNlciBhY2NpZGVudHMuCiAgICBmdW5jdGlvbigpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICAvKioqIE1hcHBpbmcgZm9yIENvbnRyYWN0cyB3aXRoIGdyYW50ZWQgcGVybWlzc2lvbiAqKiovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBjb250cmFjdHNHcmFudGVkQWNjZXNzOwoKICAgIC8vLyBAZGV2IGdyYW50IGFjY2VzcyBmb3IgYSBjb250cmFjdCB0byBpbnRlcmFjdCB3aXRoIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgVGhlIGNvbnRyYWN0IGFkZHJlc3MgdG8gZ3JhbnQgYWNjZXNzCiAgICBmdW5jdGlvbiBncmFudEFjY2VzcyhhZGRyZXNzIF92MkFkZHJlc3MpIHB1YmxpYyBvbmx5Q1RPIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgY29udHJhY3RzR3JhbnRlZEFjY2Vzc1tfdjJBZGRyZXNzXSA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgcmVtb3ZlIGFjY2VzcyBmcm9tIGEgY29udHJhY3QgdG8gaW50ZXJhY3Qgd2l0aCB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdjJBZGRyZXNzIFRoZSBjb250cmFjdCBhZGRyZXNzIHRvIGJlIHJlbW92ZWQKICAgIGZ1bmN0aW9uIHJlbW92ZUFjY2VzcyhhZGRyZXNzIF92MkFkZHJlc3MpIHB1YmxpYyBvbmx5Q1RPIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgZGVsZXRlIGNvbnRyYWN0c0dyYW50ZWRBY2Nlc3NbX3YyQWRkcmVzc107CiAgICB9CgogICAgLy8vIEBkZXYgT25seSBhbGxvdyBwZXJtaXR0ZWQgY29udHJhY3RzIHRvIGludGVyYWN0IHdpdGggdGhpcyBjb250cmFjdAogICAgbW9kaWZpZXIgb25seUdyYW50ZWRDb250cmFjdHMoKSB7CiAgICAgICAgcmVxdWlyZShjb250cmFjdHNHcmFudGVkQWNjZXNzW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRBc3NldCh1aW50MjU2IF90b2tlbklkKSB7CiAgICAgICAgcmVxdWlyZShhc3NldHNbX3Rva2VuSWRdLklEID4gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIC8qKiogREFUQSBUWVBFUyAqKiovCgogICAgLy8vIEBkZXYgVGhlIG1haW4gRXRoZXJuYXV0cyBhc3NldCBzdHJ1Y3QuIEV2ZXJ5IGFzc2V0IGluIEV0aGVybmF1dHMgaXMgcmVwcmVzZW50ZWQgYnkgYSBjb3B5CiAgICAvLy8gIG9mIHRoaXMgc3RydWN0dXJlLiBOb3RlIHRoYXQgdGhlIG9yZGVyIG9mIHRoZSBtZW1iZXJzIGluIHRoaXMgc3RydWN0dXJlCiAgICAvLy8gIGlzIGltcG9ydGFudCBiZWNhdXNlIG9mIHRoZSBieXRlLXBhY2tpbmcgcnVsZXMgdXNlZCBieSBFdGhlcmV1bS4KICAgIC8vLyAgUmVmOiBodHRwOi8vc29saWRpdHkucmVhZHRoZWRvY3MuaW8vZW4vZGV2ZWxvcC9taXNjZWxsYW5lb3VzLmh0bWwKICAgIHN0cnVjdCBBc3NldCB7CgogICAgICAgIC8vIEFzc2V0IElEIGlzIGEgaWRlbnRpZmllciBmb3IgbG9vayBhbmQgZmVlbCBpbiBmcm9udGVuZAogICAgICAgIHVpbnQxNiBJRDsKCiAgICAgICAgLy8gQ2F0ZWdvcnkgPSBTZWN0b3JzLCBNYW51ZmFjdHVyZXJzLCBTaGlwcywgT2JqZWN0cyAoVXBncmFkZXMvTWlzYyksIEZhY3RvcmllcyBhbmQgQ3Jld01lbWJlcnMKICAgICAgICB1aW50OCBjYXRlZ29yeTsKCiAgICAgICAgLy8gVGhlIFN0YXRlIG9mIGFuIGFzc2V0OiBBdmFpbGFibGUsIE9uIHNhbGUsIFVwIGZvciBsZWFzZSwgQ29vbGRvd24sIEV4cGxvcmluZwogICAgICAgIHVpbnQ4IHN0YXRlOwoKICAgICAgICAvLyBBdHRyaWJ1dGVzCiAgICAgICAgLy8gYnl0ZSBwb3MgLSBEZWZpbml0aW9uCiAgICAgICAgLy8gMDAwMDAwMDEgLSBTZWVkZWQgLSBPZmZlcmVkIHRvIHRoZSBlY29ub215IGJ5IHVzLCB0aGUgZGV2ZWxvcGVycy4gUG90ZW50aWFsbHkgYXQgcmVndWxhciBpbnRlcnZhbHMuCiAgICAgICAgLy8gMDAwMDAwMTAgLSBQcm9kdWNpYmxlIC0gUHJvZHVjdCBvZiBhIGZhY3RvcnkgYW5kL29yIGZhY3RvcnkgY29udHJhY3QuCiAgICAgICAgLy8gMDAwMDAxMDAgLSBFeHBsb3JhYmxlLSBQcm9kdWN0IG9mIGV4cGxvcmF0aW9uLgogICAgICAgIC8vIDAwMDAxMDAwIC0gTGVhc2FibGUgLSBDYW4gYmUgcmVudGVkIHRvIG90aGVyIHVzZXJzIGFuZCB3aWxsIHJldHVybiB0byB0aGUgb3JpZ2luYWwgb3duZXIgb25jZSB0aGUgYWN0aW9uIGlzIGNvbXBsZXRlLgogICAgICAgIC8vIDAwMDEwMDAwIC0gUGVybWFuZW50IC0gQ2Fubm90IGJlIHJlbW92ZWQsIGFsd2F5cyBvd25lZCBieSBhIHVzZXIuCiAgICAgICAgLy8gMDAxMDAwMDAgLSBDb25zdW1hYmxlIC0gRGVzdHJveWVkIGFmdGVyIE4gZXhwbG9yYXRpb24gZXhwZWRpdGlvbnMuCiAgICAgICAgLy8gMDEwMDAwMDAgLSBUcmFkYWJsZSAtIEJ1eWFibGUgYW5kIHNlbGxhYmxlIG9uIHRoZSBtYXJrZXQuCiAgICAgICAgLy8gMTAwMDAwMDAgLSBIb3QgUG90YXRvIC0gQXV0b21hdGljYWxseSBnZXRzIHB1dCB1cCBmb3Igc2FsZSBhZnRlciBhY3F1aXJpbmcuCiAgICAgICAgYnl0ZXMyIGF0dHJpYnV0ZXM7CgogICAgICAgIC8vIFRoZSB0aW1lc3RhbXAgZnJvbSB0aGUgYmxvY2sgd2hlbiB0aGlzIGFzc2V0IHdhcyBjcmVhdGVkLgogICAgICAgIHVpbnQ2NCBjcmVhdGVkQXQ7CgogICAgICAgIC8vIFRoZSBtaW5pbXVtIHRpbWVzdGFtcCBhZnRlciB3aGljaCB0aGlzIGFzc2V0IGNhbiBlbmdhZ2UgaW4gZXhwbG9yaW5nIGFjdGl2aXRpZXMgYWdhaW4uCiAgICAgICAgdWludDY0IGNvb2xkb3duRW5kQmxvY2s7CgogICAgICAgIC8vIFRoZSBBc3NldCdzIHN0YXRzIGNhbiBiZSB1cGdyYWRlZCBvciBjaGFuZ2VkIGJhc2VkIG9uIGV4cGxvcmF0aW9uIGNvbmRpdGlvbnMuCiAgICAgICAgLy8gSXQgd2lsbCBiZSBkZWZpbmVkIHBlciBjaGlsZCBjb250cmFjdCwgYnV0IGFsbCBzdGF0cyBoYXZlIGEgcmFuZ2UgZnJvbSAwIHRvIDI1NQogICAgICAgIC8vIEV4YW1wbGVzCiAgICAgICAgLy8gMCA9IFNoaXAgTGV2ZWwKICAgICAgICAvLyAxID0gU2hpcCBBdHRhY2sKICAgICAgICB1aW50OFtTVEFUU19TSVpFXSBzdGF0czsKCiAgICAgICAgLy8gU2V0IHRvIHRoZSBjb29sZG93biB0aW1lIHRoYXQgcmVwcmVzZW50cyBleHBsb3JhdGlvbiBkdXJhdGlvbiBmb3IgdGhpcyBhc3NldC4KICAgICAgICAvLyBEZWZpbmVkIGJ5IGEgc3VjY2Vzc2Z1bCBleHBsb3JhdGlvbiBhY3Rpb24sIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGlzIGFzc2V0IGlzIGFjdGluZyBhcyBzaGlwIG9yIGEgcGFydC4KICAgICAgICB1aW50MjU2IGNvb2xkb3duOwoKICAgICAgICAvLyBhIHJlZmVyZW5jZSB0byBhIHN1cGVyIGFzc2V0IHRoYXQgbWFudWZhY3R1cmVkIHRoZSBhc3NldAogICAgICAgIHVpbnQyNTYgYnVpbHRCeTsKICAgIH0KCiAgICAvKioqIENPTlNUQU5UUyAqKiovCgogICAgLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IHN0b3JhZ2UgY29udHJhY3QgaW4gb3VyIEV0aGVybmF1dHNMb2dpYyhhZGRyZXNzIF9DU3RvcmFnZUFkZHJlc3MpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc0V0aGVybmF1dHNTdG9yYWdlID0gdHJ1ZTsKCiAgICAvKioqIFNUT1JBR0UgKioqLwoKICAgIC8vLyBAZGV2IEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIEFzc2V0IHN0cnVjdCBmb3IgYWxsIGFzc2V0cyBpbiBleGlzdGVuY2UuIFRoZSBBc3NldCBVbmlxdWVJZAogICAgLy8vICBvZiBlYWNoIGFzc2V0IGlzIGFjdHVhbGx5IGFuIGluZGV4IGludG8gdGhpcyBhcnJheS4KICAgIEFzc2V0W10gcHVibGljIGFzc2V0czsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBBc3NldCBVbmlxdWVJRHMgdG8gdGhlIHByaWNlIG9mIHRoZSB0b2tlbi4KICAgIC8vLyBzdG9yZWQgb3V0c2lkZSBBc3NldCBTdHJ1Y3QgdG8gc2F2ZSBnYXMsIGJlY2F1c2UgcHJpY2UgY2FuIGNoYW5nZSBmcmVxdWVudGx5CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIGludGVybmFsIGFzc2V0SW5kZXhUb1ByaWNlOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIGFzc2V0IFVuaXF1ZUlEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4gQWxsIGFzc2V0cyBoYXZlIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaW50ZXJuYWwgYXNzZXRJbmRleFRvT3duZXI7CgogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgIC8vICBVc2VkIGludGVybmFsbHkgaW5zaWRlIGJhbGFuY2VPZigpIHRvIHJlc29sdmUgb3duZXJzaGlwIGNvdW50LgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBpbnRlcm5hbCBvd25lcnNoaXBUb2tlbkNvdW50OwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIEFzc2V0VW5pcXVlSURzIHRvIGFuIGFkZHJlc3MgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCB0byBjYWxsCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBFYWNoIEFzc2V0IGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRyYW5zZmVyCiAgICAvLy8gIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGludGVybmFsIGFzc2V0SW5kZXhUb0FwcHJvdmVkOwoKCiAgICAvKioqIFNFVFRFUlMgKioqLwoKICAgIC8vLyBAZGV2IHNldCBuZXcgYXNzZXQgcHJpY2UKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgIGFzc2V0IFVuaXF1ZUlkCiAgICAvLy8gQHBhcmFtIF9wcmljZSAgICBhc3NldCBwcmljZQogICAgZnVuY3Rpb24gc2V0UHJpY2UodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfcHJpY2UpIHB1YmxpYyBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRJbmRleFRvUHJpY2VbX3Rva2VuSWRdID0gX3ByaWNlOwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmsgdHJhbnNmZXIgYXMgYXBwcm92ZWQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgIGFzc2V0IFVuaXF1ZUlkCiAgICAvLy8gQHBhcmFtIF9hcHByb3ZlZCBhZGRyZXNzIGFwcHJvdmVkCiAgICBmdW5jdGlvbiBhcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBwdWJsaWMgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIEFzc2V0IHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tICAgIGN1cnJlbnQgb3duZXIgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfdG8gICAgICBuZXcgb3duZXIgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgLy8gU2luY2UgdGhlIG51bWJlciBvZiBhc3NldHMgaXMgY2FwcGVkIHRvIDJeMzIgd2UgY2FuJ3Qgb3ZlcmZsb3cgdGhpcwogICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX3RvXSsrOwogICAgICAgIC8vIHRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgIGFzc2V0SW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKICAgICAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyBhc3NldHMgX2Zyb20gaXMgMHgwLCBidXQgd2UgY2FuJ3QgYWNjb3VudCB0aGF0IGFkZHJlc3MuCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgLy8gY2xlYXIgYW55IHByZXZpb3VzbHkgYXBwcm92ZWQgb3duZXJzaGlwIGV4Y2hhbmdlCiAgICAgICAgICAgIGRlbGV0ZSBhc3NldEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEEgcHVibGljIG1ldGhvZCB0aGF0IGNyZWF0ZXMgYSBuZXcgYXNzZXQgYW5kIHN0b3JlcyBpdC4gVGhpcwogICAgLy8vICBtZXRob2QgZG9lcyBiYXNpYyBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gb3RoZXIgY29udHJhY3Qgd2hlbiB0aGUKICAgIC8vLyAgaW5wdXQgZGF0YSBpcyBrbm93biB0byBiZSB2YWxpZC4gV2lsbCBOT1QgZ2VuZXJhdGUgYW55IGV2ZW50IGl0IGlzIGRlbGVnYXRlIHRvIGJ1c2luZXNzIGxvZ2ljIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX2NyZWF0b3JUb2tlbklEIFRoZSBhc3NldCB3aG8gaXMgZmF0aGVyIG9mIHRoaXMgYXNzZXQKICAgIC8vLyBAcGFyYW0gX293bmVyIEZpcnN0IG93bmVyIG9mIHRoaXMgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9JRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdGUgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBjcmVhdGVBc3NldCgKICAgICAgICB1aW50MjU2IF9jcmVhdG9yVG9rZW5JRCwKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICB1aW50MTYgX0lELAogICAgICAgIHVpbnQ4IF9jYXRlZ29yeSwKICAgICAgICB1aW50OCBfc3RhdGUsCiAgICAgICAgdWludDggX2F0dHJpYnV0ZXMsCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gX3N0YXRzLAogICAgICAgIHVpbnQyNTYgX2Nvb2xkb3duLAogICAgICAgIHVpbnQ2NCBfY29vbGRvd25FbmRCbG9jawogICAgKQogICAgcHVibGljIG9ubHlHcmFudGVkQ29udHJhY3RzCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfSUQgPiAwKTsKICAgICAgICByZXF1aXJlKF9jYXRlZ29yeSA+IDApOwogICAgICAgIHJlcXVpcmUoX2F0dHJpYnV0ZXMgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9zdGF0cy5sZW5ndGggPiAwKTsKCiAgICAgICAgQXNzZXQgbWVtb3J5IGFzc2V0ID0gQXNzZXQoewogICAgICAgICAgICBJRDogX0lELAogICAgICAgICAgICBjYXRlZ29yeTogX2NhdGVnb3J5LAogICAgICAgICAgICBidWlsdEJ5OiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGJ5dGVzMihfYXR0cmlidXRlcyksCiAgICAgICAgICAgIHN0YXRzOiBfc3RhdHMsCiAgICAgICAgICAgIHN0YXRlOiBfc3RhdGUsCiAgICAgICAgICAgIGNyZWF0ZWRBdDogdWludDY0KG5vdyksCiAgICAgICAgICAgIGNvb2xkb3duRW5kQmxvY2s6IF9jb29sZG93bkVuZEJsb2NrLAogICAgICAgICAgICBjb29sZG93bjogX2Nvb2xkb3duCiAgICAgICAgICAgIH0pOwoKICAgICAgICB1aW50MjU2IG5ld0Fzc2V0VW5pcXVlSWQgPSBhc3NldHMucHVzaChhc3NldCkgLSAxOwoKICAgICAgICAvLyBDaGVjayBpdCByZWFjaGVkIDQgYmlsbGlvbiBhc3NldHMgYnV0IGxldCdzIGp1c3QgYmUgMTAwJSBzdXJlLgogICAgICAgIHJlcXVpcmUobmV3QXNzZXRVbmlxdWVJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdBc3NldFVuaXF1ZUlkKSkpOwoKICAgICAgICAvLyBzdG9yZSBwcmljZQogICAgICAgIGFzc2V0SW5kZXhUb1ByaWNlW25ld0Fzc2V0VW5pcXVlSWRdID0gX3ByaWNlOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcAogICAgICAgIHRyYW5zZmVyKGFkZHJlc3MoMCksIF9vd25lciwgbmV3QXNzZXRVbmlxdWVJZCk7CgogICAgICAgIHJldHVybiBuZXdBc3NldFVuaXF1ZUlkOwogICAgfQoKICAgIC8vLyBAZGV2IEEgcHVibGljIG1ldGhvZCB0aGF0IGVkaXQgYXNzZXQgaW4gY2FzZSBvZiBhbnkgbWlzdGFrZSBpcyBkb25lIGR1cmluZyBwcm9jZXNzIG9mIGNyZWF0aW9uIGJ5IHRoZSBkZXZlbG9wZXIuIFRoaXMKICAgIC8vLyBUaGlzIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSB0b2tlbiBJRAogICAgLy8vIEBwYXJhbSBfY3JlYXRvclRva2VuSUQgVGhlIGFzc2V0IHRoYXQgY3JlYXRlIHRoYXQgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9JRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdGUgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9jb29sZG93biBhc3NldCBjb29sZG93biBpbmRleAogICAgZnVuY3Rpb24gZWRpdEFzc2V0KAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDE2IF9JRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX3N0YXRlLAogICAgICAgIHVpbnQ4IF9hdHRyaWJ1dGVzLAogICAgICAgIHVpbnQ4W1NUQVRTX1NJWkVdIF9zdGF0cywKICAgICAgICB1aW50MTYgX2Nvb2xkb3duCiAgICApCiAgICBleHRlcm5hbCB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5Q0xldmVsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfSUQgPiAwKTsKICAgICAgICByZXF1aXJlKF9jYXRlZ29yeSA+IDApOwogICAgICAgIHJlcXVpcmUoX2F0dHJpYnV0ZXMgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9zdGF0cy5sZW5ndGggPiAwKTsKCiAgICAgICAgLy8gc3RvcmUgcHJpY2UKICAgICAgICBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF0gPSBfcHJpY2U7CgogICAgICAgIEFzc2V0IHN0b3JhZ2UgYXNzZXQgPSBhc3NldHNbX3Rva2VuSWRdOwogICAgICAgIGFzc2V0LklEID0gX0lEOwogICAgICAgIGFzc2V0LmNhdGVnb3J5ID0gX2NhdGVnb3J5OwogICAgICAgIGFzc2V0LmJ1aWx0QnkgPSBfY3JlYXRvclRva2VuSUQ7CiAgICAgICAgYXNzZXQuYXR0cmlidXRlcyA9IGJ5dGVzMihfYXR0cmlidXRlcyk7CiAgICAgICAgYXNzZXQuc3RhdHMgPSBfc3RhdHM7CiAgICAgICAgYXNzZXQuc3RhdGUgPSBfc3RhdGU7CiAgICAgICAgYXNzZXQuY29vbGRvd24gPSBfY29vbGRvd247CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlIG9ubHkgc3RhdHMKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX3N0YXRzIGFzc2V0IHN0YXRlLCBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiB1cGRhdGVTdGF0cyh1aW50MjU2IF90b2tlbklkLCB1aW50OFtTVEFUU19TSVpFXSBfc3RhdHMpIHB1YmxpYyB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5zdGF0cyA9IF9zdGF0czsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGUgb25seSBhc3NldCBzdGF0ZQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfc3RhdGUgYXNzZXQgc3RhdGUsIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQ4IF9zdGF0ZSkgcHVibGljIHZhbGlkQXNzZXQoX3Rva2VuSWQpIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICBhc3NldHNbX3Rva2VuSWRdLnN0YXRlID0gX3N0YXRlOwogICAgfQoKICAgIC8vLyBAZGV2IFVwZGF0ZSBDb29sZG93biBmb3IgYSBzaW5nbGUgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX2Nvb2xkb3duIGFzc2V0IHN0YXRlLCBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBzZXRBc3NldENvb2xkb3duKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2Nvb2xkb3duLCB1aW50NjQgX2Nvb2xkb3duRW5kQmxvY2spCiAgICBwdWJsaWMgdmFsaWRBc3NldChfdG9rZW5JZCkgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0c1tfdG9rZW5JZF0uY29vbGRvd24gPSBfY29vbGRvd247CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5jb29sZG93bkVuZEJsb2NrID0gX2Nvb2xkb3duRW5kQmxvY2s7CiAgICB9CgogICAgLyoqKiBHRVRURVJTICoqKi8KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIG9ubHkgc3RhdHMgZGF0YSBhYm91dCBhIHNwZWNpZmljIGFzc2V0LgogICAgLy8vIEBkZXYgaXQgaXMgbmVjZXNzYXJ5IGR1ZSBzb2xpZGl0eSBjb21waWxlciBsaW1pdGF0aW9ucwogICAgLy8vICAgICAgd2hlbiB3ZSBoYXZlIGxhcmdlIHF0eSBvZiBwYXJhbWV0ZXJzIGl0IHRocm93cyBTdGFja1Rvb0RlZXBFeGNlcHRpb24KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldFN0YXRzKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4W1NUQVRTX1NJWkVdKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uc3RhdHM7CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJuIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXNzZXQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIGZ1bmN0aW9uIHByaWNlT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBwcmljZSkgewogICAgICAgIHJldHVybiBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaGFzIGFsbCBhdHRyaWJ1dGVzIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gaGFzQWxsQXR0cnModWludDI1NiBfdG9rZW5JZCwgYnl0ZXMyIF9hdHRyaWJ1dGVzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uYXR0cmlidXRlcyAmIF9hdHRyaWJ1dGVzID09IF9hdHRyaWJ1dGVzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGFzc2V0IGhhcyBhbnkgYXR0cmlidXRlIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gaGFzQW55QXR0cnModWludDI1NiBfdG9rZW5JZCwgYnl0ZXMyIF9hdHRyaWJ1dGVzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uYXR0cmlidXRlcyAmIF9hdHRyaWJ1dGVzICE9IDB4MDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVjayBpZiBhc3NldCBpcyBpbiB0aGUgc3RhdGUgcGFzc2VkIGJ5IHBhcmFtZXRlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0Q2F0ZWdvcnkgaW4gRXRoZXJuYXV0c0Jhc2UgZm9yIHBvc3NpYmxlIHN0YXRlcwogICAgZnVuY3Rpb24gaXNDYXRlZ29yeSh1aW50MjU2IF90b2tlbklkLCB1aW50OCBfY2F0ZWdvcnkpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5jYXRlZ29yeSA9PSBfY2F0ZWdvcnk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaXMgaW4gdGhlIHN0YXRlIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX3N0YXRlIHNlZSBlbnVtIEFzc2V0U3RhdGUgaW4gRXRoZXJuYXV0c0Jhc2UgZm9yIHBvc3NpYmxlIHN0YXRlcwogICAgZnVuY3Rpb24gaXNTdGF0ZSh1aW50MjU2IF90b2tlbklkLCB1aW50OCBfc3RhdGUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5zdGF0ZSA9PSBfc3RhdGU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBvd25lciBvZiBhIGdpdmVuIEFzc2V0KFRva2VuKS4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgcmV0dXJuIGFzc2V0SW5kZXhUb093bmVyW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgQXNzZXRzIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIEFzc2V0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgZnVuY3Rpb24gYXBwcm92ZWRGb3IodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgb25seUdyYW50ZWRDb250cmFjdHMgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhc3NldEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIEFzc2V0cyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhc3NldHMubGVuZ3RoOwogICAgfQoKICAgIC8vLyBAbm90aWNlIExpc3QgYWxsIGV4aXN0aW5nIHRva2Vucy4gSXQgY2FuIGJlIGZpbHRlcmVkIGJ5IGF0dHJpYnV0ZXMgb3IgYXNzZXRzIHdpdGggb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGZpbHRlciBhbGwgYXNzZXRzIGJ5IG93bmVyCiAgICBmdW5jdGlvbiBnZXRUb2tlbkxpc3QoYWRkcmVzcyBfb3duZXIsIHVpbnQ4IF93aXRoQXR0cmlidXRlcywgdWludDI1NiBzdGFydCwgdWludDI1NiBjb3VudCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKAogICAgICAgIHVpbnQyNTZbNl1bXQogICAgKSB7CiAgICAgICAgdWludDI1NiB0b3RhbEFzc2V0cyA9IGFzc2V0cy5sZW5ndGg7CgogICAgICAgIGlmICh0b3RhbEFzc2V0cyA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbNl1bXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2WzZdW10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2WzZdW10odG90YWxBc3NldHMgPiBjb3VudCA/IGNvdW50IDogdG90YWxBc3NldHMpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKICAgICAgICAgICAgYnl0ZXMyIGhhc0F0dHJpYnV0ZXMgID0gYnl0ZXMyKF93aXRoQXR0cmlidXRlcyk7CiAgICAgICAgICAgIEFzc2V0IG1lbW9yeSBhc3NldDsKCiAgICAgICAgICAgIGZvciAodWludDI1NiB0b2tlbklkID0gc3RhcnQ7IHRva2VuSWQgPCB0b3RhbEFzc2V0cyAmJiByZXN1bHRJbmRleCA8IGNvdW50OyB0b2tlbklkKyspIHsKICAgICAgICAgICAgICAgIGFzc2V0ID0gYXNzZXRzW3Rva2VuSWRdOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIChhc3NldC5zdGF0ZSAhPSB1aW50OChBc3NldFN0YXRlLlVzZWQpKSAmJgogICAgICAgICAgICAgICAgICAgIChhc3NldEluZGV4VG9Pd25lclt0b2tlbklkXSA9PSBfb3duZXIgfHwgX293bmVyID09IGFkZHJlc3MoMCkpICYmCiAgICAgICAgICAgICAgICAgICAgKGFzc2V0LmF0dHJpYnV0ZXMgJiBoYXNBdHRyaWJ1dGVzID09IGhhc0F0dHJpYnV0ZXMpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzBdID0gdG9rZW5JZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzFdID0gYXNzZXQuSUQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XVsyXSA9IGFzc2V0LmNhdGVnb3J5OwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bM10gPSB1aW50MjU2KGFzc2V0LmF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bNF0gPSBhc3NldC5jb29sZG93bjsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzVdID0gYXNzZXRJbmRleFRvUHJpY2VbdG9rZW5JZF07CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9Cn0KCgovLy8gQHRpdGxlIFRoZSBmYWNldCBvZiB0aGUgRXRoZXJuYXV0cyBMb2dpYyBjb250cmFjdCBoYW5kbGUgYWxsIGNvbW1vbiBjb2RlIGZvciBsb2dpYy9idXNpbmVzcyBjb250cmFjdHMKLy8vIEBhdXRob3IgRXRoZXJuYXR1cyAtIEZlcm5hbmRvIFBhdWVyCmNvbnRyYWN0IEV0aGVybmF1dHNMb2dpYyBpcyBFdGhlcm5hdXRzT3duZXJzaGlwIHsKCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgbG9naWMgY29udHJhY3QgaXMgYnJva2VuIGFuZCBhbiB1cGdyYWRlIGlzIHJlcXVpcmVkCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdDb250cmFjdEFkZHJlc3M7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEV0aGVybmF1dHNMb2dpYygpIHB1YmxpYyB7CiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENFTywgQ09PLCBDVE8KICAgICAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBjdG9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBjb29BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBvcmFjbGVBZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gU3RhcnRzIHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFVzZWQgdG8gbWFyayB0aGUgc21hcnQgY29udHJhY3QgYXMgdXBncmFkZWQsIGluIGNhc2UgdGhlcmUgaXMgYSBzZXJpb3VzCiAgICAvLy8gIGJyZWFraW5nIGJ1Zy4gVGhpcyBtZXRob2QgZG9lcyBub3RoaW5nIGJ1dCBrZWVwIHRyYWNrIG9mIHRoZSBuZXcgY29udHJhY3QgYW5kCiAgICAvLy8gIGVtaXQgYSBtZXNzYWdlIGluZGljYXRpbmcgdGhhdCB0aGUgbmV3IGFkZHJlc3MgaXMgc2V0LiBJdCdzIHVwIHRvIGNsaWVudHMgb2YgdGhpcwogICAgLy8vICBjb250cmFjdCB0byB1cGRhdGUgdG8gdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzIGluIHRoYXQgY2FzZS4gKFRoaXMgY29udHJhY3Qgd2lsbAogICAgLy8vICBiZSBwYXVzZWQgaW5kZWZpbml0ZWx5IGlmIHN1Y2ggYW4gdXBncmFkZSB0YWtlcyBwbGFjZS4pCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgbmV3IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE5ld0FkZHJlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q1RPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICAgIH0KCiAgICAvLy8gQGRldiBzZXQgYSBuZXcgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9DU3RvcmFnZUFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nIEV0aGVybmF1dHNTdG9yYWdlLgogICAgZnVuY3Rpb24gc2V0RXRoZXJuYXV0c1N0b3JhZ2VDb250cmFjdChhZGRyZXNzIF9DU3RvcmFnZUFkZHJlc3MpIHB1YmxpYyBvbmx5Q0xldmVsIHdoZW5QYXVzZWQgewogICAgICAgIEV0aGVybmF1dHNTdG9yYWdlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRXRoZXJuYXV0c1N0b3JhZ2UoX0NTdG9yYWdlQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0V0aGVybmF1dHNTdG9yYWdlKCkpOwogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgT3ZlcnJpZGUgdW5wYXVzZSBzbyBpdCByZXF1aXJlcyBhbGwgZXh0ZXJuYWwgY29udHJhY3QgYWRkcmVzc2VzCiAgICAvLy8gIHRvIGJlIHNldCBiZWZvcmUgY29udHJhY3QgY2FuIGJlIHVucGF1c2VkLiBBbHNvLCB3ZSBjYW4ndCBoYXZlCiAgICAvLy8gIG5ld0NvbnRyYWN0QWRkcmVzcyBzZXQgZWl0aGVyLCBiZWNhdXNlIHRoZW4gdGhlIGNvbnRyYWN0IHdhcyB1cGdyYWRlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIHdlIGNhbiBjYWxsIHN1cGVyLnVucGF1c2UKICAgIC8vLyAgd2l0aG91dCB1c2luZyBhbiBleHBlbnNpdmUgQ0FMTC4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKGV0aGVybmF1dHNTdG9yYWdlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIHJlcXVpcmUgdGhpcyBjb250cmFjdCB0byBoYXZlIGFjY2VzcyB0byBzdG9yYWdlIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZS5jb250cmFjdHNHcmFudGVkQWNjZXNzKGFkZHJlc3ModGhpcykpID09IHRydWUpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CgogICAgLy8gQGRldiBBbGxvd3MgdGhlIENPTyB0byBjYXB0dXJlIHRoZSBiYWxhbmNlIGF2YWlsYWJsZSB0byB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2VzKGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seUNMZXZlbCB7CiAgICAgICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIHJldHVybiBjdXJyZW50IGNvbnRyYWN0IGJhbGFuY2UKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoKSBwdWJsaWMgdmlldyBvbmx5Q0xldmVsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgfQp9CgovLy8gQHRpdGxlIENsb2NrIGF1Y3Rpb24gZm9yIG5vbi1mdW5naWJsZSB0b2tlbnMuCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KLy8vICAgICAgICAgVGhpcyBwcm92aWRlcyBwdWJsaWMgbWV0aG9kcyBmb3IgVXBncmFkZSBzaGlwLgovLy8KLy8vICAgICAgLSBVcGdyYWRlU2hpcDogVGhpcyBwcm92aWRlcyBwdWJsaWMgbWV0aG9kcyBmb3IgbWFuYWdpbmcgaG93IGFuZCBpZiBhIHNoaXAgY2FuIHVwZ3JhZGUuCi8vLyAgICAgICAgICAgICBUaGUgdXNlciBjYW4gcGxhY2UgYSBudW1iZXIgb2YgU2hpcCBVcGdyYWRlcyBvbiB0aGUgc2hpcCB0byBhZmZlY3QgdGhlIHNoaXDigJlzIGV4cGxvcmF0aW9uLgovLy8gICAgICAgICAgICAgQ29tYmluaW5nIHRoZSBFeHBsb3JlIGFuZCBVcGdyYWRlIGFjdGlvbnMgdG9nZXRoZXIgbGltaXRzIHRoZSBhbW91bnQgb2YgZ2FzIHRoZSB1c2VyIGhhcyB0byBwYXkuCi8vLyBAYXV0aG9yIEV0aGVybmF0dXMgLSBGZXJuYW5kbyBQYXVlcgpjb250cmFjdCBFdGhlcm5hdXRzVXBncmFkZSBpcyBFdGhlcm5hdXRzTG9naWMgewoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGNyZWF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIE5GVCBvd25lcnNoaXAgY29udHJhY3QKICAgIC8vLyAgYW5kIHZlcmlmaWVzIHRoZSBvd25lciBjdXQgaXMgaW4gdGhlIHZhbGlkIHJhbmdlLgogICAgLy8vICBhbmQgRGVsZWdhdGUgY29uc3RydWN0b3IgdG8gTm9uZnVuZ2libGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBFdGhlcm5hdXRzVXBncmFkZSgpIHB1YmxpYwogICAgRXRoZXJuYXV0c0xvZ2ljKCkge30KCiAgICAvKioqIEVWRU5UUyAqKiovCiAgICAvLy8gQGRldiBUaGUgVXBncmFkZSBldmVudCBpcyBmaXJlZCB3aGVuZXZlciBhIHNoaXAgaXMgdXBncmFkZWQuCiAgICBldmVudCBVcGdyYWRlKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKCiAgICAvKioqIENPTlNUQU5UUyAqKiovCiAgICB1aW50OCBTVEFUU19DQVBPVVQgPSAyKio4IC0gMTsgLy8gYWxsIHN0YXRzIGhhdmUgYSByYW5nZSBmcm9tIDAgdG8gMjU1CgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKiBVUEdSQURFIFNISVAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vLyBAbm90aWNlIENoZWNrIGFuZCBkZWZpbmUgaG93IGEgc2hpcCBjYW4gdXBncmFkZQogICAgLy8vIEV4YW1wbGU6CiAgICAvLy8gVXNlciBBIHdhbnRzIHRvIFVwZ3JhZGUgU2hpcCBBLiBTaGlwIEEgaGFzIDUgYXZhaWxhYmxlIHVwZ3JhZGUgc2xvdHMuCiAgICAvLy8gVGhhbmtmdWxseSwgVXNlciBBIGhhcyA1IFNoaXAgVXBncmFkZXMgaW4gdGhlaXIgaW52ZW50b3J5LgogICAgLy8vIFRoZXkgaGF2ZSAxeCBQbGFzbWEgQ2Fubm9ucyAoKzEgQXR0YWNrKSwgSGFyZGVuZWQgUGxhdGVzICgrMiBEZWZlbnNlKSwKICAgIC8vLyAgICAgICAgICAgMXggTmF2aWdhdGlvbiBQcm9jZXNzb3IgKCsxIFJhbmdlKSwgMXggRW5naW5lIFR1bmUgKCsyIFNwZWVkKSwgYW5kIEx1Y2t5IFNoYW1yb2NrICgrMSBMdWNrKSAuCiAgICAvLy8gVXNlciBBIGRyYWdzIHRoZSA1IFNoaXAgVXBncmFkZXMgaW50byB0aGUgYXBwcm9wcmlhdGUgc2xvdHMgYW5kIGhpdHMgdGhlIFVwZ3JhZGUgYnV0dG9uLgogICAgLy8vIFNoaXAgQeKAmXMgc3RhdHMgYXJlIG5vdyBpbXByb3ZlZCBieSArMSBBdHRhY2ssICsyIERlZmVuc2UsICsxIFJhbmdlLCArMiBTcGVlZCwgYW5kICsxIEx1Y2ssIGZvcmV2ZXIuCiAgICAvLy8gVGhlIFNoaXAgVXBncmFkZXMgYXJlIGNvbnN1bWVkIGFuZCBkaXNhcHBlYXIuIFRoZSBTaGlwIHRoZW4gaW5jcmVhc2VzIGluIGxldmVsICsxIHRvIGEgdG90YWwgbGV2ZWwgb2YgMi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFRva2VuIElEIHRoYXQgY2FuIGJlIHVwZ3JhZGVkCiAgICAvLy8gQHBhcmFtIF9vYmplY3RzIExpc3Qgb2Ygb2JqZWN0cyB0byBiZSB1c2VkIGluIHRoZSB1cGdyYWRlCiAgICBmdW5jdGlvbiB1cGdyYWRlU2hpcCh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2W1NISVBfU0xPVFNdIF9vYmplY3RzKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBDaGVja2luZyBpZiBBc3NldCBpcyBhIHNoaXAgb3Igbm90CiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZS5pc0NhdGVnb3J5KF90b2tlbklkLCB1aW50OChBc3NldENhdGVnb3J5LlNoaXApKSk7CgogICAgICAgIC8vIEVuc3VyZSB0aGUgU2hpcCBpcyBpbiBhdmFpbGFibGUgc3RhdGUsIG90aGVyd2lzZSBpdCBjYW5ub3QgYmUgdXBncmFkZWQKICAgICAgICByZXF1aXJlKGV0aGVybmF1dHNTdG9yYWdlLmlzU3RhdGUoX3Rva2VuSWQsIHVpbnQ4KEFzc2V0U3RhdGUuQXZhaWxhYmxlKSkpOwoKICAgICAgICAvLyBvbmx5IG93bmVyIGNhbiB1cGdyYWRlIGhpcy9oZXIgc2hpcAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF90b2tlbklkKSk7CgogICAgICAgIC8vIHNoaXAgY291bGQgbm90IGJlIGluIGV4cGxvcmF0aW9uCiAgICAgICAgcmVxdWlyZSghaXNFeHBsb3JpbmcoX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gZ2V0IHNoaXAgYW5kIG9iamVjdHMgY3VycmVudCBzdGF0cwogICAgICAgIHVpbnQgaSA9IDA7CiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gbWVtb3J5IF9zaGlwU3RhdHMgPSBldGhlcm5hdXRzU3RvcmFnZS5nZXRTdGF0cyhfdG9rZW5JZCk7CiAgICAgICAgdWludDI1NiBsZXZlbCA9IF9zaGlwU3RhdHNbdWludChTaGlwU3RhdHMuTGV2ZWwpXTsKICAgICAgICB1aW50OFtTVEFUU19TSVpFXVtTSElQX1NMT1RTXSBtZW1vcnkgX29iamVjdHNTdGF0czsKCiAgICAgICAgLy8gY2hlY2sgaWYgbGV2ZWwgY2FwcGVkIG91dCwgaWYgeWVzIG5vIG1vcmUgdXBncmFkZSBpcyBhdmFpbGFibGUKICAgICAgICByZXF1aXJlKGxldmVsIDwgNSk7CgogICAgICAgIC8vIGEgbWFwcGluZyB0byByZXF1aXJlIHVwZ3JhZGVzIHNob3VsZCBoYXZlIGRpZmZlcmVudCB0b2tlbiBpZHMKICAgICAgICB1aW50MjU2W10gbWVtb3J5IHVwZ3JhZGVzVG9Ub2tlbkluZGV4ID0gbmV3IHVpbnQyNTZbXShldGhlcm5hdXRzU3RvcmFnZS50b3RhbFN1cHBseSgpKTsKCiAgICAgICAgLy8gYWxsIG9iamVjdHMgbXVzdCBiZSBhdmFpbGFibGUgdG8gdXNlCiAgICAgICAgZm9yKGkgPSAwOyBpIDwgX29iamVjdHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gc2VuZGVyIHNob3VsZCBvd25lciBhbGwgYXNzZXRzCiAgICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF9vYmplY3RzW2ldKSk7CiAgICAgICAgICAgIHJlcXVpcmUoIWlzRXhwbG9yaW5nKF9vYmplY3RzW2ldKSk7CiAgICAgICAgICAgIHJlcXVpcmUoZXRoZXJuYXV0c1N0b3JhZ2UuaXNDYXRlZ29yeShfb2JqZWN0c1tpXSwgdWludDgoQXNzZXRDYXRlZ29yeS5PYmplY3QpKSk7CiAgICAgICAgICAgIC8vIGF2b2lkaW5nIGR1cGxpY2F0ZSBrZXlzCiAgICAgICAgICAgIHJlcXVpcmUodXBncmFkZXNUb1Rva2VuSW5kZXhbX29iamVjdHNbaV1dID09IDApOwoKICAgICAgICAgICAgLy8gbWFyayB0b2tlbiBpZCBhcyByZWFkIGFuZCBhdm9pZCBkdXBsaWNhdGVkIHRva2VuIGlkcwogICAgICAgICAgICB1cGdyYWRlc1RvVG9rZW5JbmRleFtfb2JqZWN0c1tpXV0gPSBfb2JqZWN0c1tpXTsKICAgICAgICAgICAgX29iamVjdHNTdGF0c1tpXSA9IGV0aGVybmF1dHNTdG9yYWdlLmdldFN0YXRzKF9vYmplY3RzW2ldKTsKICAgICAgICB9CgogICAgICAgIC8vIHVwZ3JhZGluZyBzdGF0cwogICAgICAgIHVpbnQyNTYgYXR0YWNrID0gX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5BdHRhY2spXTsKICAgICAgICB1aW50MjU2IGRlZmVuc2UgPSBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLkRlZmVuc2UpXTsKICAgICAgICB1aW50MjU2IHNwZWVkID0gX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5TcGVlZCldOwogICAgICAgIHVpbnQyNTYgcmFuZ2UgPSBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLlJhbmdlKV07CiAgICAgICAgdWludDI1NiBsdWNrID0gX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5MdWNrKV07CgogICAgICAgIGZvcihpID0gMDsgaSA8IFNISVBfU0xPVFM7IGkrKykgewogICAgICAgICAgICAvLyBPbmx5IG9iamVjdHMgd2l0aCB1cGdyYWRlcyBhcmUgYWxsb3dlZAogICAgICAgICAgICByZXF1aXJlKF9vYmplY3RzU3RhdHNbaV1bMV0gKwogICAgICAgICAgICAgICAgICAgIF9vYmplY3RzU3RhdHNbaV1bMl0gKwogICAgICAgICAgICAgICAgICAgIF9vYmplY3RzU3RhdHNbaV1bM10gKwogICAgICAgICAgICAgICAgICAgIF9vYmplY3RzU3RhdHNbaV1bNF0gKwogICAgICAgICAgICAgICAgICAgIF9vYmplY3RzU3RhdHNbaV1bNV0gPiAwKTsKCiAgICAgICAgICAgIGF0dGFjayArPSBfb2JqZWN0c1N0YXRzW2ldW3VpbnQoU2hpcFN0YXRzLkF0dGFjayldOwogICAgICAgICAgICBkZWZlbnNlICs9IF9vYmplY3RzU3RhdHNbaV1bdWludChTaGlwU3RhdHMuRGVmZW5zZSldOwogICAgICAgICAgICBzcGVlZCArPSBfb2JqZWN0c1N0YXRzW2ldW3VpbnQoU2hpcFN0YXRzLlNwZWVkKV07CiAgICAgICAgICAgIHJhbmdlICs9IF9vYmplY3RzU3RhdHNbaV1bdWludChTaGlwU3RhdHMuUmFuZ2UpXTsKICAgICAgICAgICAgbHVjayArPSBfb2JqZWN0c1N0YXRzW2ldW3VpbnQoU2hpcFN0YXRzLkx1Y2spXTsKICAgICAgICB9CgogICAgICAgIGlmIChhdHRhY2sgPiBTVEFUU19DQVBPVVQpIHsKICAgICAgICAgICAgYXR0YWNrID0gU1RBVFNfQ0FQT1VUOwogICAgICAgIH0KICAgICAgICBpZiAoZGVmZW5zZSA+IFNUQVRTX0NBUE9VVCkgewogICAgICAgICAgICBkZWZlbnNlID0gU1RBVFNfQ0FQT1VUOwogICAgICAgIH0KICAgICAgICBpZiAoc3BlZWQgPiBTVEFUU19DQVBPVVQpIHsKICAgICAgICAgICAgc3BlZWQgPSBTVEFUU19DQVBPVVQ7CiAgICAgICAgfQogICAgICAgIGlmIChyYW5nZSA+IFNUQVRTX0NBUE9VVCkgewogICAgICAgICAgICByYW5nZSA9IFNUQVRTX0NBUE9VVDsKICAgICAgICB9CiAgICAgICAgaWYgKGx1Y2sgPiBTVEFUU19DQVBPVVQpIHsKICAgICAgICAgICAgbHVjayA9IFNUQVRTX0NBUE9VVDsKICAgICAgICB9CgogICAgICAgIC8vIEFsbCBzdGF0cyBtdXN0IGluY3JlYXNlLCBldmVuIGlmIGl0cyBwcm92aWRlZCA1IHVwZ3JhZGVzIGluIHRoZSBzbG90cwogICAgICAgIHJlcXVpcmUoYXR0YWNrID4gX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5BdHRhY2spXSk7CiAgICAgICAgcmVxdWlyZShkZWZlbnNlID4gX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5EZWZlbnNlKV0pOwogICAgICAgIHJlcXVpcmUoc3BlZWQgPiBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLlNwZWVkKV0pOwogICAgICAgIHJlcXVpcmUocmFuZ2UgPiBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLlJhbmdlKV0pOwogICAgICAgIHJlcXVpcmUobHVjayA+IF9zaGlwU3RhdHNbdWludChTaGlwU3RhdHMuTHVjayldKTsKCiAgICAgICAgX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5MZXZlbCldID0gdWludDgobGV2ZWwgKyAxKTsKICAgICAgICBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLkF0dGFjayldID0gdWludDgoYXR0YWNrKTsKICAgICAgICBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLkRlZmVuc2UpXSA9IHVpbnQ4KGRlZmVuc2UpOwogICAgICAgIF9zaGlwU3RhdHNbdWludChTaGlwU3RhdHMuU3BlZWQpXSA9IHVpbnQ4KHNwZWVkKTsKICAgICAgICBfc2hpcFN0YXRzW3VpbnQoU2hpcFN0YXRzLlJhbmdlKV0gPSB1aW50OChyYW5nZSk7CiAgICAgICAgX3NoaXBTdGF0c1t1aW50KFNoaXBTdGF0cy5MdWNrKV0gPSB1aW50OChsdWNrKTsKCiAgICAgICAgLy8gb25seSB1cGdyYWRlIGFmdGVyIGNvbmZpcm1lZCB0cmFuc2FjdGlvbiBieSBVcGdyYWRlIFNoaXAgQ29udHJhY3QKICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS51cGRhdGVTdGF0cyhfdG9rZW5JZCwgX3NoaXBTdGF0cyk7CgogICAgICAgIC8vIG1hcmsgYWxsIG9iamVjdHMgYXMgdXNlZCBhbmQgY2hhbmdlIG93bmVyCiAgICAgICAgZm9yKGkgPSAwOyBpIDwgX29iamVjdHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UudXBkYXRlU3RhdGUoX29iamVjdHNbaV0sIHVpbnQ4KEFzc2V0U3RhdGUuVXNlZCkpOwoKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIGFuZCB0cmFuc2ZlciB0byB1cGdyYWRlIHNoaXAgY29udHJhY3QKICAgICAgICAgICAgX2FwcHJvdmUoX29iamVjdHNbaV0sIGFkZHJlc3ModGhpcykpOwogICAgICAgICAgICBfdHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3ModGhpcyksIF9vYmplY3RzW2ldKTsKICAgICAgICB9CgogICAgICAgIFVwZ3JhZGUoX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGV4dGVybmFsIG9ubHlPcmFjbGUgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBhc3NldHMKICAgICAgICAvLyAoZXhjZXB0IHZlcnkgYnJpZWZseSBhZnRlciBpdCBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhlIHN0b3JhZ2UgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIG9yIFVwZ3JhZGUgY29udHJhY3RzIHNob3VsZCBvbmx5IHRha2Ugb3duZXJzaGlwIG9mIGFzc2V0cwogICAgICAgIC8vIHRocm91Z2ggdGhlIGFsbG93ICsgdHJhbnNmZXJGcm9tIGZsb3cuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhldGhlcm5hdXRzU3RvcmFnZSkpOwoKICAgICAgICAvLyBDb250cmFjdCBuZWVkcyB0byBvd24gYXNzZXQuCiAgICAgICAgcmVxdWlyZShfb3ducyhhZGRyZXNzKHRoaXMpLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAsIGNsZWFyIHBlbmRpbmcgYXBwcm92YWxzLCBlbWl0IFRyYW5zZmVyIGV2ZW50LgogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCBfdG8pOwogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLnRyYW5zZmVyKGFkZHJlc3ModGhpcyksIF90bywgX3Rva2VuSWQpOwogICAgfQoKfQ=='.
	

]
