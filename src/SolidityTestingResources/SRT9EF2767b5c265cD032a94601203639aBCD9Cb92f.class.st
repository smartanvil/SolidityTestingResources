Class {
	#name : #SRT9EF2767b5c265cD032a94601203639aBCD9Cb92f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9EF2767b5c265cD032a94601203639aBCD9Cb92f >> base64 [
	^ 'Ly8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTA7Ly9wbGVhc2UgaW1wb3J0IG9yYWNsaXplQVBJX3ByZTAuNC5zb2wgd2hlbiBzb2xpZGl0eSA8IDAuNC4wCgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04sIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gdXNlQ291cG9uKHN0cmluZyBfY291cG9uKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOwogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7CiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSk7CiAgICBmdW5jdGlvbiByYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIHJldHVybnMoYnl0ZXMzMik7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfQW5kcm9pZCA9IDB4MjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9MZWRnZXIgPSAweDMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTmF0aXZlID0gMHhGMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwoKICAgICAgICBpZihhZGRyZXNzKG9yYWNsaXplKSAhPSBPQVIuZ2V0QWRkcmVzcygpKQogICAgICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKCiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9tYWlubmV0Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcm9wc3RlbjMiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpPjApeyAvL2tvdmFuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpPjApeyAvL3JpbmtlYnkgdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yaW5rZWJ5Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KT4wKXsgLy9ldGhlcmV1bS1icmlkZ2UKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIHsKICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgewogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2NiQWRkcmVzcygpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldFByb29mKGJ5dGUgcHJvb2ZQKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUucmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOwogICAgICAgIHVpbnQxNjAgYjE7CiAgICAgICAgdWludDE2MCBiMjsKICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7CiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsKICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7CiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7CiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkmJihiMSA8PSA3MCkpIGIxIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSYmKGIyIDw9IDcwKSkgYjIgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UsIHN0cmluZyBfZiwgc3RyaW5nIF9nKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIHJldHVybiBzdHJDb25jYXQoc3RyQ29uY2F0KF9hLCBfYiksIHN0ckNvbmNhdChfYywgX2QsIF9lLCBfZiwgX2cpKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKXsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGogLz0gMTA7CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgICAgdWludCBrID0gbGVuIC0gMTsKICAgICAgICB3aGlsZSAoaSAhPSAwKXsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKCiAgICBzdHJpbmcgb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29ya05hbWUoc3RyaW5nIF9uZXR3b3JrX25hbWUpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9uZXR3b3JrX25hbWUgPSBfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICBpZiAoKF9uYnl0ZXMgPT0gMCl8fChfbmJ5dGVzID4gMzIpKSB0aHJvdzsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXNbM10gbWVtb3J5IGFyZ3MgPSBbdW5vbmNlLCBuYnl0ZXMsIHNlc3Npb25LZXlIYXNoXTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeShfZGVsYXksICJyYW5kb20iLCBhcmdzLCBfY3VzdG9tR2FzTGltaXQpOwogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQocXVlcnlJZCwgc2hhMyhieXRlczgoX2RlbGF5KSwgYXJnc1sxXSwgc2hhMjU2KGFyZ3NbMF0pLCBhcmdzWzJdKSk7CiAgICAgICAgcmV0dXJuIHF1ZXJ5SWQ7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50OwogICAgfQoKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ynl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CgogICAgICAgIGJ5dGVzMzIgc2lncjsKICAgICAgICBieXRlczMyIHNpZ3M7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBvZmZzZXQgPSA0Kyh1aW50KGRlcnNpZ1szXSkgLSAweDIwKTsKICAgICAgICBzaWdyXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCwgMzIsIHNpZ3JfLCAwKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2lnc18gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIG9mZnNldCArPSAzMiArIDI7CiAgICAgICAgc2lnc18gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQrKHVpbnQoZGVyc2lnW29mZnNldC0xXSkgLSAweDIwKSwgMzIsIHNpZ3NfLCAwKTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaWdyIDo9IG1sb2FkKGFkZChzaWdyXywgMzIpKQogICAgICAgICAgICBzaWdzIDo9IG1sb2FkKGFkZChzaWdzXywgMzIpKQogICAgICAgIH0KCgogICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyNywgc2lnciwgc2lncyk7CiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwoKICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcyID0gbmV3IGJ5dGVzKHVpbnQocHJvb2Zbc2lnMm9mZnNldCsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LCBzaWcyLmxlbmd0aCwgc2lnMiwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDErNjUrMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSAxOyAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZmQ5NGZhNzFiYzBiYTEwZDM5ZDQ2NGQwZDhmNDY1ZWZlZWYwYTI3NjRlMzg4N2ZjYzlkZjQxZGVkMjBmNTA1YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CgogICAgICAgIGlmIChzaWdvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMyA9IG5ldyBieXRlcygxKzY1KTsKICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwoKICAgICAgICByZXR1cm4gc2lnb2s7CiAgICB9CgogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSB0aHJvdzsKCiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fcmV0dXJuQ29kZShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCl7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHJldHVybiAxOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHJldHVybiAyOwoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgbWF0Y2hfID0gdHJ1ZTsKCiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHByZWZpeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmIChjb250ZW50W2ldICE9IHByZWZpeFtpXSkgbWF0Y2hfID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKGJ5dGVzIHByb29mLCBieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzIHJlc3VsdCwgc3RyaW5nIGNvbnRleHRfbmFtZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBjaGVja29rOwoKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGNoZWNrb2sgPSAoc2hhMyhrZXloYXNoKSA9PSBzaGEzKHNoYTI1Nihjb250ZXh0X25hbWUsIHF1ZXJ5SWQpKSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzEgPSBuZXcgYnl0ZXModWludChwcm9vZltsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSwgc2lnMS5sZW5ndGgsIHNpZzEsIDApOwoKCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgY2hlY2tvayA9IG1hdGNoQnl0ZXMzMlByZWZpeChzaGEyNTYoc2lnMSksIHJlc3VsdCk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNDogY29tbWl0bWVudCBtYXRjaCB2ZXJpZmljYXRpb24sIHNoYTMoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLgogICAgICAgIC8vIFRoaXMgaXMgdG8gdmVyaWZ5IHRoYXQgdGhlIGNvbXB1dGVkIGFyZ3MgbWF0Y2ggd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQgaW4gdGhlIHF1ZXJ5LgogICAgICAgIGJ5dGVzIG1lbW9yeSBjb21taXRtZW50U2xpY2UxID0gbmV3IGJ5dGVzKDgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCszMiwgOCsxKzMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwoKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IHNoYTMoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBjaGVja29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKXsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOwogICAgfQoKCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gbGVuZ3RoICsgdG9PZmZzZXQ7CgogICAgICAgIGlmICh0by5sZW5ndGggPCBtaW5MZW5ndGgpIHsKICAgICAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgICAgICB0aHJvdzsgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KICAgICAgICB9CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCn0KLy8gPC9PUkFDTElaRV9BUEk+CgovLyBjb3B5cmlnaHQgPGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImFlY2RjMWMwZGFjZmNkZGFlZWNjZDdkYWNiZGFjNmNiZGM4MGNkYzFjMyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4KCmNvbnRyYWN0IEJhc2ljVXRpbGl0eSB7CiAgICBmdW5jdGlvbiBzdHJpbmdUb1VpbnQoc3RyaW5nIHMpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKHMpOwogICAgICAgIHVpbnQyNTYgcmVzdWx0ID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7IAogICAgICAgICAgICBpZiAoYltpXSA+PSA0OCAmJiBiW2ldIDw9IDU3KSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgKiAxMCArICh1aW50MjU2KGJbaV0pIC0gNDgpOyAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrVmFsaWRCaXRjb2luQWRkcmVzcyhzdHJpbmcgYml0Y29pbkFkZHJlc3MpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYml0Y29pbkFkZHJlc3NCeXRlcyA9IGJ5dGVzKGJpdGNvaW5BZGRyZXNzKTsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IGJpdGNvaW5BZGRyZXNzQnl0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGJpdGNvaW5BZGRyZXNzQnl0ZXNbaV0gPCA0OCAKICAgICAgICAgICAgfHwgKGJpdGNvaW5BZGRyZXNzQnl0ZXNbaV0gPiA1NyAmJiBiaXRjb2luQWRkcmVzc0J5dGVzW2ldIDwgNjUpCiAgICAgICAgICAgIHx8IChiaXRjb2luQWRkcmVzc0J5dGVzW2ldID4gOTAgJiYgYml0Y29pbkFkZHJlc3NCeXRlc1tpXSA8IDk3KSAgCiAgICAgICAgICAgIHx8IGJpdGNvaW5BZGRyZXNzQnl0ZXNbaV0gPiAxMjIpIAogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRyZXNzVG9TdHJpbmcoYWRkcmVzcyB4KSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgcyA9IG5ldyBieXRlcyg0MCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgMjA7IGkrKykgewogICAgICAgICAgICBieXRlIGIgPSBieXRlKHVpbnQ4KHVpbnQoeCkgLyAoMioqKDgqKDE5IC0gaSkpKSkpOwogICAgICAgICAgICBieXRlIGhpID0gYnl0ZSh1aW50OChiKSAvIDE2KTsKICAgICAgICAgICAgYnl0ZSBsbyA9IGJ5dGUodWludDgoYikgLSAxNiAqIHVpbnQ4KGhpKSk7CiAgICAgICAgICAgIHNbMippXSA9IGdldENoYXIoaGkpOwogICAgICAgICAgICBzWzIqaSsxXSA9IGdldENoYXIobG8pOyAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKHMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDaGFyKGJ5dGUgYikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZSBjKSB7CiAgICAgICAgaWYgKGIgPCAxMCkgcmV0dXJuIGJ5dGUodWludDgoYikgKyAweDMwKTsKICAgICAgICBlbHNlIHJldHVybiBieXRlKHVpbnQ4KGIpICsgMHg1Nyk7CiAgICB9Cn0KCmNvbnRyYWN0IEJhc2ljQWNjZXNzQ29udHJvbCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3NbXSBwdWJsaWMgbW9kZXJhdG9yczsKCiAgICBmdW5jdGlvbiBCYXNpY0FjY2Vzc0NvbnRyb2woKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5TW9kZXJhdG9ycygpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgewogICAgICAgICAgICBib29sIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAodWludCBpbmRleCA9IDA7IGluZGV4IDwgbW9kZXJhdG9ycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgIGlmIChtb2RlcmF0b3JzW2luZGV4XSA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVpcmUoZm91bmQpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIENoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAoX25ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEtpbGwoKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIEFkZE1vZGVyYXRvcihhZGRyZXNzIF9uZXdNb2RlcmF0b3IpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlmIChfbmV3TW9kZXJhdG9yICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgZm9yICh1aW50IGluZGV4ID0gMDsgaW5kZXggPCBtb2RlcmF0b3JzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgaWYgKG1vZGVyYXRvcnNbaW5kZXhdID09IF9uZXdNb2RlcmF0b3IpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbW9kZXJhdG9ycy5wdXNoKF9uZXdNb2RlcmF0b3IpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gUmVtb3ZlTW9kZXJhdG9yKGFkZHJlc3MgX29sZE1vZGVyYXRvcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgdWludCBmb3VuZEluZGV4ID0gMDsKICAgICAgICBmb3IgKDsgZm91bmRJbmRleCA8IG1vZGVyYXRvcnMubGVuZ3RoOyBmb3VuZEluZGV4KyspIHsKICAgICAgICAgICAgaWYgKG1vZGVyYXRvcnNbZm91bmRJbmRleF0gPT0gX29sZE1vZGVyYXRvcikgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZvdW5kSW5kZXggPCBtb2RlcmF0b3JzLmxlbmd0aCkgewogICAgICAgICAgICBtb2RlcmF0b3JzW2ZvdW5kSW5kZXhdID0gbW9kZXJhdG9yc1ttb2RlcmF0b3JzLmxlbmd0aC0xXTsKICAgICAgICAgICAgZGVsZXRlIG1vZGVyYXRvcnNbbW9kZXJhdG9ycy5sZW5ndGgtMV07CiAgICAgICAgICAgIG1vZGVyYXRvcnMubGVuZ3RoLS07CiAgICAgICAgfQogICAgfQp9CgppbnRlcmZhY2UgQ3Jvc3NGb3JrRGlzdHJpYnV0aW9uIHsKICAgIGZ1bmN0aW9uIGdldERpc3RyaWJ1dGVkQW1vdW50KHVpbnQ2NCBfcmVxdWVzdElkLCBzdHJpbmcgX2J0Y0FkZHJlc3MsIGFkZHJlc3MgX3JlY2VpdmVyKSBwdWJsaWM7Cn0KCmludGVyZmFjZSBDcm9zc0ZvcmtDYWxsYmFjayB7CiAgICBmdW5jdGlvbiBjYWxsYmFja0Nyb3NzRm9yayh1aW50NjQgX3JlcXVlc3RJZCwgdWludDI1NiBfYW1vdW50LCBieXRlczMyIF9yZWZlckNvZGVIYXNoKSBwdWJsaWM7Cn0KCmludGVyZmFjZSBCeXRldGhlck9WIHsKICAgIGZ1bmN0aW9uIEdldE93bmVyc2hpcEJ5QWRkcmVzcyhzdHJpbmcgX2J0Y0FkZHJlc3MsIGFkZHJlc3MgX2V0aGVyQWRkcmVzcykgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCwgYnl0ZXMzMik7Cn0KCmNvbnRyYWN0IEJUSENyb3NzRm9yayBpcyB1c2luZ09yYWNsaXplLCBCYXNpY1V0aWxpdHksIEJhc2ljQWNjZXNzQ29udHJvbCwgQ3Jvc3NGb3JrRGlzdHJpYnV0aW9uIHsKCiAgICBlbnVtIFF1ZXJ5UmVzdWx0Q29kZSB7CiAgICAgICAgU1VDQ0VTUywKICAgICAgICBOT1RfRU5PVUdIX0JBTEFOQ0UsCiAgICAgICAgSU5WQUxJRF9RVUVSWSwKICAgICAgICBJTlZBTElEX1ZFUklGWV9DT0RFLAogICAgICAgIElOVkFMSURfQklUQ09JTl9BRERSRVNTCiAgICB9CgogICAgc3RydWN0IFF1ZXJ5SW5mbyB7CiAgICAgICAgYnl0ZXMzMiByZWZlckNvZGVIYXNoOwogICAgICAgIHVpbnQ2NCByZXF1ZXN0SWQ7CiAgICAgICAgYWRkcmVzcyBzZW5kZXI7CiAgICB9CiAgICBtYXBwaW5nKGJ5dGVzMzI9PlF1ZXJ5SW5mbykgcXVlcmllczsKICAgIGFkZHJlc3MgcHVibGljIGJ5dGV0aGVyT1ZBZGRyZXNzID0gMHgwOwogICAgc3RyaW5nIHB1YmxpYyB2ZXJpZnlVcmwgPSAiIjsKICAgIHVpbnQ2NCBwdWJsaWMgY3Jvc3NGb3JrQmxvY2tOdW1iZXIgPSAwOwoKICAgIGV2ZW50IExvZ1JlY2VpdmVRdWVyeShieXRlczMyIGluZGV4ZWQgcXVlcnlJZCwgdWludDY0IHJlcXVlc3RJZCwgdWludDI1NiBhbW91bnQsIFF1ZXJ5UmVzdWx0Q29kZSByZXN1bHRDb2RlKTsKICAgIGV2ZW50IExvZ1RyaWdnZXJRdWVyeShieXRlczMyIGluZGV4ZWQgYnRjQWRkcmVzc0hhc2gsIHVpbnQ2NCByZXF1ZXN0SWQsIGFkZHJlc3MgcmVjZWl2ZXIsIFF1ZXJ5UmVzdWx0Q29kZSByZXN1bHRDb2RlKTsKICAgIAogICAgZnVuY3Rpb24gQlRIQ3Jvc3NGb3JrKGFkZHJlc3MgX2J5dGV0aGVyT1ZBZGRyZXNzLCBzdHJpbmcgX3ZlcmlmeVVybCwgdWludDY0IF9jcm9zc0ZvcmtCbG9ja051bWJlcikgcHVibGljIHsKICAgICAgICBieXRldGhlck9WQWRkcmVzcyA9IF9ieXRldGhlck9WQWRkcmVzczsKICAgICAgICB2ZXJpZnlVcmwgPSBfdmVyaWZ5VXJsOwogICAgICAgIGNyb3NzRm9ya0Jsb2NrTnVtYmVyID0gX2Nyb3NzRm9ya0Jsb2NrTnVtYmVyOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHt9CiAgICAKICAgIC8vIG1vZGVyYXRvciBmdW5jdGlvbgogICAgZnVuY3Rpb24gc2V0Qnl0ZXRoZXJPVkFkZHJlc3MoYWRkcmVzcyBfYnl0ZXRoZXJPVkFkZHJlc3MpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyB7CiAgICAgICAgYnl0ZXRoZXJPVkFkZHJlc3MgPSBfYnl0ZXRoZXJPVkFkZHJlc3M7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldFZlcmlmeVVybChzdHJpbmcgX3ZlcmlmeVVybCkgb25seU1vZGVyYXRvcnMgcHVibGljIHsKICAgICAgICB2ZXJpZnlVcmwgPSBfdmVyaWZ5VXJsOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENyb3NzRm9ya0Jsb2NrTnVtYmVyKHVpbnQ2NCBfYmxvY2tOdW1iZXIpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyB7CiAgICAgICAgY3Jvc3NGb3JrQmxvY2tOdW1iZXIgPSBfYmxvY2tOdW1iZXI7CiAgICB9CiAgICAKICAgIAogICAgLy8gcHVibGljCgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCkgcHVibGljIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgewogICAgICAgICAgICBMb2dSZWNlaXZlUXVlcnkoX3F1ZXJ5SWQsIDAsIDAsIFF1ZXJ5UmVzdWx0Q29kZS5JTlZBTElEX1FVRVJZKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgUXVlcnlJbmZvIHN0b3JhZ2UgaW5mbyA9IHF1ZXJpZXNbX3F1ZXJ5SWRdOwogICAgICAgIGlmIChpbmZvLnNlbmRlciA9PSAweDApIHsKICAgICAgICAgICAgTG9nUmVjZWl2ZVF1ZXJ5KF9xdWVyeUlkLCBpbmZvLnJlcXVlc3RJZCwgMCwgUXVlcnlSZXN1bHRDb2RlLklOVkFMSURfUVVFUlkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGFtb3VudCA9IHN0cmluZ1RvVWludChfcmVzdWx0KTsKICAgICAgICBDcm9zc0ZvcmtDYWxsYmFjayBjcm9zc2ZvcmsgPSBDcm9zc0ZvcmtDYWxsYmFjayhpbmZvLnNlbmRlcik7CiAgICAgICAgY3Jvc3Nmb3JrLmNhbGxiYWNrQ3Jvc3NGb3JrKGluZm8ucmVxdWVzdElkLCBhbW91bnQsIGluZm8ucmVmZXJDb2RlSGFzaCk7CiAgICAgICAgTG9nUmVjZWl2ZVF1ZXJ5KF9xdWVyeUlkLCBpbmZvLnJlcXVlc3RJZCwgYW1vdW50LCBRdWVyeVJlc3VsdENvZGUuU1VDQ0VTUyk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGlzdHJpYnV0ZWRBbW91bnQodWludDY0IF9yZXF1ZXN0SWQsIHN0cmluZyBfYnRjQWRkcmVzcywgYWRkcmVzcyBfcmVjZWl2ZXIpIHB1YmxpYyB7CiAgICAgICAgLy8gZ2V0IHJlZmVyY29kZSAmIGJhc2ljIHZlcmlmeQogICAgICAgIGJ5dGVzMzIgYnRjQWRkcmVzc0hhc2ggPSBrZWNjYWsyNTYoX2J0Y0FkZHJlc3MpOwogICAgICAgIGlmICghY2hlY2tWYWxpZEJpdGNvaW5BZGRyZXNzKF9idGNBZGRyZXNzKSkgewogICAgICAgICAgICBMb2dUcmlnZ2VyUXVlcnkoYnRjQWRkcmVzc0hhc2gsIF9yZXF1ZXN0SWQsIF9yZWNlaXZlciwgUXVlcnlSZXN1bHRDb2RlLklOVkFMSURfQklUQ09JTl9BRERSRVNTKTsKICAgICAgICAgICAgcmV0dXJuOyAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICBpZiAoYnl0ZXRoZXJPVkFkZHJlc3MgPT0gMHgwKSB7CiAgICAgICAgICAgIExvZ1RyaWdnZXJRdWVyeShidGNBZGRyZXNzSGFzaCwgX3JlcXVlc3RJZCwgX3JlY2VpdmVyLCBRdWVyeVJlc3VsdENvZGUuSU5WQUxJRF9RVUVSWSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIEJ5dGV0aGVyT1YgYnl0ZXRoZXJPViA9IEJ5dGV0aGVyT1YoYnl0ZXRoZXJPVkFkZHJlc3MpOwogICAgICAgIHVpbnQgdmVyaWZ5Q29kZTsKICAgICAgICBieXRlczMyIHJlZmVyQ29kZUhhc2g7CiAgICAgICAgKHZlcmlmeUNvZGUsIHJlZmVyQ29kZUhhc2gpID0gYnl0ZXRoZXJPVi5HZXRPd25lcnNoaXBCeUFkZHJlc3MoX2J0Y0FkZHJlc3MsIF9yZWNlaXZlcik7CgogICAgICAgIGlmICh2ZXJpZnlDb2RlID09IDApIHsKICAgICAgICAgICAgTG9nVHJpZ2dlclF1ZXJ5KGJ0Y0FkZHJlc3NIYXNoLCBfcmVxdWVzdElkLCBfcmVjZWl2ZXIsIFF1ZXJ5UmVzdWx0Q29kZS5JTlZBTElEX1ZFUklGWV9DT0RFKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gcXVlcnkgZXh0ZXJuYWwgYXBpIHRvIGNoZWNrIGJpdGNvaW4gdHhuICYgYmFsYW5jZSBieSBidGNBZGRyZXNzICYgdmVyaWZ5Q29kZQogICAgICAgIGlmIChvcmFjbGl6ZV9nZXRQcmljZSgiVVJMIikgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgTG9nVHJpZ2dlclF1ZXJ5KGJ0Y0FkZHJlc3NIYXNoLCBfcmVxdWVzdElkLCBfcmVjZWl2ZXIsIFF1ZXJ5UmVzdWx0Q29kZS5OT1RfRU5PVUdIX0JBTEFOQ0UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KAogICAgICAgICAgICAiVVJMIiwKICAgICAgICAgICAgdmVyaWZ5VXJsLAogICAgICAgICAgICBzdHJDb25jYXQoCiAgICAgICAgICAgICAgICAneyJidGNfYWRkcmVzcyI6IicsIAogICAgICAgICAgICAgICAgX2J0Y0FkZHJlc3MsIAogICAgICAgICAgICAgICAgJyIsImV0aF9hZGRyZXNzIjoiJywgCiAgICAgICAgICAgICAgICBhZGRyZXNzVG9TdHJpbmcoX3JlY2VpdmVyKSwgCiAgICAgICAgICAgICAgICAnIiwiYmxvY2tfbnVtYmVyIjoiJywgCiAgICAgICAgICAgICAgICB1aW50MnN0cihjcm9zc0ZvcmtCbG9ja051bWJlciksIAogICAgICAgICAgICAgICAgJyJ9JykKICAgICAgICApOwogICAgICAgIFF1ZXJ5SW5mbyBzdG9yYWdlIGluZm8gPSBxdWVyaWVzW3F1ZXJ5SWRdOwogICAgICAgIGluZm8ucmVmZXJDb2RlSGFzaCA9IHJlZmVyQ29kZUhhc2g7CiAgICAgICAgaW5mby5yZXF1ZXN0SWQgPSBfcmVxdWVzdElkOwogICAgICAgIGluZm8uc2VuZGVyID0gbXNnLnNlbmRlcjsKICAgICAgICBMb2dUcmlnZ2VyUXVlcnkoYnRjQWRkcmVzc0hhc2gsIF9yZXF1ZXN0SWQsIF9yZWNlaXZlciwgUXVlcnlSZXN1bHRDb2RlLlNVQ0NFU1MpOwogICAgfQp9CgoKLy8gQ29udHJhY3QgQUJJCi8vIFt7ImNvbnN0YW50Ijp0cnVlLCJpbnB1dHMiOltdLCJuYW1lIjoidmVyaWZ5VXJsIiwib3V0cHV0cyI6W3sibmFtZSI6IiIsInR5cGUiOiJzdHJpbmcifV0sInBheWFibGUiOmZhbHNlLCJzdGF0ZU11dGFiaWxpdHkiOiJ2aWV3IiwidHlwZSI6ImZ1bmN0aW9uIn0seyJjb25zdGFudCI6ZmFsc2UsImlucHV0cyI6W3sibmFtZSI6Il9xdWVyeUlkIiwidHlwZSI6ImJ5dGVzMzIifSx7Im5hbWUiOiJfcmVzdWx0IiwidHlwZSI6InN0cmluZyJ9XSwibmFtZSI6Il9fY2FsbGJhY2siLCJvdXRwdXRzIjpbXSwicGF5YWJsZSI6ZmFsc2UsInN0YXRlTXV0YWJpbGl0eSI6Im5vbnBheWFibGUiLCJ0eXBlIjoiZnVuY3Rpb24ifSx7ImNvbnN0YW50IjpmYWxzZSwiaW5wdXRzIjpbeyJuYW1lIjoibXlpZCIsInR5cGUiOiJieXRlczMyIn0seyJuYW1lIjoicmVzdWx0IiwidHlwZSI6InN0cmluZyJ9LHsibmFtZSI6InByb29mIiwidHlwZSI6ImJ5dGVzIn1dLCJuYW1lIjoiX19jYWxsYmFjayIsIm91dHB1dHMiOltdLCJwYXlhYmxlIjpmYWxzZSwic3RhdGVNdXRhYmlsaXR5Ijoibm9ucGF5YWJsZSIsInR5cGUiOiJmdW5jdGlvbiJ9LHsiY29uc3RhbnQiOmZhbHNlLCJpbnB1dHMiOlt7Im5hbWUiOiJfdmVyaWZ5VXJsIiwidHlwZSI6InN0cmluZyJ9XSwibmFtZSI6InNldFZlcmlmeVVybCIsIm91dHB1dHMiOltdLCJwYXlhYmxlIjpmYWxzZSwic3RhdGVNdXRhYmlsaXR5Ijoibm9ucGF5YWJsZSIsInR5cGUiOiJmdW5jdGlvbiJ9LHsiY29uc3RhbnQiOmZhbHNlLCJpbnB1dHMiOlt7Im5hbWUiOiJfbmV3TW9kZXJhdG9yIiwidHlwZSI6ImFkZHJlc3MifV0sIm5hbWUiOiJBZGRNb2RlcmF0b3IiLCJvdXRwdXRzIjpbXSwicGF5YWJsZSI6ZmFsc2UsInN0YXRlTXV0YWJpbGl0eSI6Im5vbnBheWFibGUiLCJ0eXBlIjoiZnVuY3Rpb24ifSx7ImNvbnN0YW50Ijp0cnVlLCJpbnB1dHMiOltdLCJuYW1lIjoiY3Jvc3NGb3JrQmxvY2tOdW1iZXIiLCJvdXRwdXRzIjpbeyJuYW1lIjoiIiwidHlwZSI6InVpbnQ2NCJ9XSwicGF5YWJsZSI6ZmFsc2UsInN0YXRlTXV0YWJpbGl0eSI6InZpZXciLCJ0eXBlIjoiZnVuY3Rpb24ifSx7ImNvbnN0YW50Ijp0cnVlLCJpbnB1dHMiOltdLCJuYW1lIjoib3duZXIiLCJvdXRwdXRzIjpbeyJuYW1lIjoiIiwidHlwZSI6ImFkZHJlc3MifV0sInBheWFibGUiOmZhbHNlLCJzdGF0ZU11dGFiaWxpdHkiOiJ2aWV3IiwidHlwZSI6ImZ1bmN0aW9uIn0seyJjb25zdGFudCI6ZmFsc2UsImlucHV0cyI6W3sibmFtZSI6Il9yZXF1ZXN0SWQiLCJ0eXBlIjoidWludDY0In0seyJuYW1lIjoiX2J0Y0FkZHJlc3MiLCJ0eXBlIjoic3RyaW5nIn0seyJuYW1lIjoiX3JlY2VpdmVyIiwidHlwZSI6ImFkZHJlc3MifV0sIm5hbWUiOiJnZXREaXN0cmlidXRlZEFtb3VudCIsIm91dHB1dHMiOltdLCJwYXlhYmxlIjpmYWxzZSwic3RhdGVNdXRhYmlsaXR5Ijoibm9ucGF5YWJsZSIsInR5cGUiOiJmdW5jdGlvbiJ9LHsiY29uc3RhbnQiOmZhbHNlLCJpbnB1dHMiOlt7Im5hbWUiOiJfYnl0ZXRoZXJPVkFkZHJlc3MiLCJ0eXBlIjoiYWRkcmVzcyJ9XSwibmFtZSI6InNldEJ5dGV0aGVyT1ZBZGRyZXNzIiwib3V0cHV0cyI6W10sInBheWFibGUiOmZhbHNlLCJzdGF0ZU11dGFiaWxpdHkiOiJub25wYXlhYmxlIiwidHlwZSI6ImZ1bmN0aW9uIn0seyJjb25zdGFudCI6dHJ1ZSwiaW5wdXRzIjpbXSwibmFtZSI6ImJ5dGV0aGVyT1ZBZGRyZXNzIiwib3V0cHV0cyI6W3sibmFtZSI6IiIsInR5cGUiOiJhZGRyZXNzIn1dLCJwYXlhYmxlIjpmYWxzZSwic3RhdGVNdXRhYmlsaXR5IjoidmlldyIsInR5cGUiOiJmdW5jdGlvbiJ9LHsiY29uc3RhbnQiOmZhbHNlLCJpbnB1dHMiOlt7Im5hbWUiOiJfb2xkTW9kZXJhdG9yIiwidHlwZSI6ImFkZHJlc3MifV0sIm5hbWUiOiJSZW1vdmVNb2RlcmF0b3IiLCJvdXRwdXRzIjpbXSwicGF5YWJsZSI6ZmFsc2UsInN0YXRlTXV0YWJpbGl0eSI6Im5vbnBheWFibGUiLCJ0eXBlIjoiZnVuY3Rpb24ifSx7ImNvbnN0YW50Ijp0cnVlLCJpbnB1dHMiOlt7Im5hbWUiOiIiLCJ0eXBlIjoidWludDI1NiJ9XSwibmFtZSI6Im1vZGVyYXRvcnMiLCJvdXRwdXRzIjpbeyJuYW1lIjoiIiwidHlwZSI6ImFkZHJlc3MifV0sInBheWFibGUiOmZhbHNlLCJzdGF0ZU11dGFiaWxpdHkiOiJ2aWV3IiwidHlwZSI6ImZ1bmN0aW9uIn0seyJjb25zdGFudCI6ZmFsc2UsImlucHV0cyI6W10sIm5hbWUiOiJLaWxsIiwib3V0cHV0cyI6W10sInBheWFibGUiOmZhbHNlLCJzdGF0ZU11dGFiaWxpdHkiOiJub25wYXlhYmxlIiwidHlwZSI6ImZ1bmN0aW9uIn0seyJjb25zdGFudCI6ZmFsc2UsImlucHV0cyI6W3sibmFtZSI6Il9ibG9ja051bWJlciIsInR5cGUiOiJ1aW50NjQifV0sIm5hbWUiOiJzZXRDcm9zc0ZvcmtCbG9ja051bWJlciIsIm91dHB1dHMiOltdLCJwYXlhYmxlIjpmYWxzZSwic3RhdGVNdXRhYmlsaXR5Ijoibm9ucGF5YWJsZSIsInR5cGUiOiJmdW5jdGlvbiJ9LHsiY29uc3RhbnQiOmZhbHNlLCJpbnB1dHMiOlt7Im5hbWUiOiJfbmV3T3duZXIiLCJ0eXBlIjoiYWRkcmVzcyJ9XSwibmFtZSI6IkNoYW5nZU93bmVyIiwib3V0cHV0cyI6W10sInBheWFibGUiOmZhbHNlLCJzdGF0ZU11dGFiaWxpdHkiOiJub25wYXlhYmxlIiwidHlwZSI6ImZ1bmN0aW9uIn0seyJpbnB1dHMiOlt7Im5hbWUiOiJfYnl0ZXRoZXJPVkFkZHJlc3MiLCJ0eXBlIjoiYWRkcmVzcyJ9LHsibmFtZSI6Il92ZXJpZnlVcmwiLCJ0eXBlIjoic3RyaW5nIn0seyJuYW1lIjoiX2Nyb3NzRm9ya0Jsb2NrTnVtYmVyIiwidHlwZSI6InVpbnQ2NCJ9XSwicGF5YWJsZSI6ZmFsc2UsInN0YXRlTXV0YWJpbGl0eSI6Im5vbnBheWFibGUiLCJ0eXBlIjoiY29uc3RydWN0b3IifSx7InBheWFibGUiOnRydWUsInN0YXRlTXV0YWJpbGl0eSI6InBheWFibGUiLCJ0eXBlIjoiZmFsbGJhY2sifSx7ImFub255bW91cyI6ZmFsc2UsImlucHV0cyI6W3siaW5kZXhlZCI6dHJ1ZSwibmFtZSI6InF1ZXJ5SWQiLCJ0eXBlIjoiYnl0ZXMzMiJ9LHsiaW5kZXhlZCI6ZmFsc2UsIm5hbWUiOiJyZXF1ZXN0SWQiLCJ0eXBlIjoidWludDY0In0seyJpbmRleGVkIjpmYWxzZSwibmFtZSI6ImFtb3VudCIsInR5cGUiOiJ1aW50MjU2In0seyJpbmRleGVkIjpmYWxzZSwibmFtZSI6InJlc3VsdENvZGUiLCJ0eXBlIjoidWludDgifV0sIm5hbWUiOiJMb2dSZWNlaXZlUXVlcnkiLCJ0eXBlIjoiZXZlbnQifSx7ImFub255bW91cyI6ZmFsc2UsImlucHV0cyI6W3siaW5kZXhlZCI6dHJ1ZSwibmFtZSI6ImJ0Y0FkZHJlc3NIYXNoIiwidHlwZSI6ImJ5dGVzMzIifSx7ImluZGV4ZWQiOmZhbHNlLCJuYW1lIjoicmVxdWVzdElkIiwidHlwZSI6InVpbnQ2NCJ9LHsiaW5kZXhlZCI6ZmFsc2UsIm5hbWUiOiJyZWNlaXZlciIsInR5cGUiOiJhZGRyZXNzIn0seyJpbmRleGVkIjpmYWxzZSwibmFtZSI6InJlc3VsdENvZGUiLCJ0eXBlIjoidWludDgifV0sIm5hbWUiOiJMb2dUcmlnZ2VyUXVlcnkiLCJ0eXBlIjoiZXZlbnQifV0='.
	

]
