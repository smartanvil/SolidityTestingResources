Class {
	#name : #SRT6d0a44fb6a416da6efe1c192560be1bccd01f6be,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6d0a44fb6a416da6efe1c192560be1bccd01f6be >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9ibG9iL21hc3Rlci9jb250cmFjdHMvb3duZXJzaGlwL093bmFibGUuc29sCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICogbGljZW5zZTogTUlUCiAqLwpjb250cmFjdCBPd25hYmxlU2ltcGxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKICAgIC8qKgogICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAgKiBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlU2ltcGxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cn0KCi8vIGJhc2VkIG9uIGF4aW9temVuLCBNSVQgbGljZW5zZQpjb250cmFjdCBSYW5kb21BcGkgewogICAgdWludDY0IF9zZWVkID0gMDsKCiAgICBmdW5jdGlvbiByYW5kb20odWludDY0IG1heEV4Y2x1c2l2ZSkgcHVibGljIHJldHVybnMgKHVpbnQ2NCByYW5kb21OdW1iZXIpIHsKICAgICAgICAvLyB0aGUgYmxvY2toYXNoIG9mIHRoZSBjdXJyZW50IGJsb2NrIChhbmQgZnV0dXJlIGJsb2NrKSBpcyAwIGJlY2F1c2UgaXQgZG9lc24ndCBleGlzdAogICAgICAgIF9zZWVkID0gdWludDY0KGtlY2NhazI1NihrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciAtIDEpLCBfc2VlZCksIGJsb2NrLnRpbWVzdGFtcCkpOwogICAgICAgIHJldHVybiBfc2VlZCAlIG1heEV4Y2x1c2l2ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByYW5kb20yNTYoKSBwdWJsaWMgcmV0dXJucyAodWludDI1NiByYW5kb21OdW1iZXIpIHsKICAgICAgICB1aW50MjU2IHJhbmQgPSB1aW50MjU2KGtlY2NhazI1NihrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciAtIDEpLCBfc2VlZCksIGJsb2NrLnRpbWVzdGFtcCkpOwogICAgICAgIF9zZWVkID0gdWludDY0KHJhbmQpOwogICAgICAgIHJldHVybiByYW5kOwogICAgfQp9CgovLyBAdGl0bGUgRVJDLTE2NTogU3RhbmRhcmQgaW50ZXJmYWNlIGRldGVjdGlvbgovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CmNvbnRyYWN0IEVSQzE2NSB7CiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgovLyBAdGl0bGUgRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLyBAYXV0aG9yIERpZXRlciBTaGlybGV5IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKLy8gQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vZWlwcy9pc3N1ZXMvNzIxCmNvbnRyYWN0IEVSQzcyMSBpcyBFUkMxNjUgewogICAgLy8gUmVxdWlyZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICAKICAgIC8vIGRlc2NyaWJlZCBpbiBvbGQgdmVyc2lvbiBvZiB0aGUgc3RhbmRhcmQKICAgIC8vIHVzZSB0aGUgbW9yZSBmbGV4aWJsZSB0cmFuc2ZlckZyb20KICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9hcHByb3ZlZCwgdWludDI1NiBfdG9rZW5JZCk7CgogICAgLy8gT3B0aW9uYWwKICAgIC8vIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKTsKICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwogICAgCiAgICAvLyBPcHRpb25hbCwgZGVzY3JpYmVkIGluIG9sZCB2ZXJzaW9uIG9mIHRoZSBzdGFuZGFyZAogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiB0b2tlbklkKTsKICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7Cn0KCi8vIEJhc2VkIG9uIHN0cmluZ3MgbGlicmFyeSBieSBOaWNrIEpvaG5zb24gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIwZTZmN2M2ZjZkNjY2MDY3NmE0ZTYwNjE3YTZhNjE3YTIwNjA2YjdhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8gQXBhY2hlIGxpY2Vuc2UKLy8gaHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzCmxpYnJhcnkgc3RyaW5ncyB7CiAgICBzdHJ1Y3Qgc2xpY2UgewogICAgICAgIHVpbnQgX2xlbjsKICAgICAgICB1aW50IF9wdHI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSBwdXJlIHsKICAgICAgICAvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShkZXN0LCBtbG9hZChzcmMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlc3QgKz0gMzI7CiAgICAgICAgICAgIHNyYyArPSAzMjsKICAgICAgICB9CgogICAgICAgIC8vIENvcHkgcmVtYWluaW5nIGJ5dGVzCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKHNyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykKICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBsZW4oc2xpY2Ugc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IGwpIHsKICAgICAgICAvLyBTdGFydGluZyBhdCBwdHItMzEgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQKICAgICAgICB2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7CiAgICAgICAgdmFyIGVuZCA9IHB0ciArIHNlbGYuX2xlbjsKICAgICAgICBmb3IgKGwgPSAwOyBwdHIgPCBlbmQ7IGwrKykgewogICAgICAgICAgICB1aW50OCBiOwogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0KICAgICAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMjsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEY4KSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHB0ciArPSA2OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBsZW4oYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHJldDsKICAgICAgICBpZiAoc2VsZiA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTY7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDg7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDQ7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDI7CiAgICAgICAgICAgIHNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAzMiAtIHJldDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdG9TbGljZUIzMihieXRlczMyIHNlbGYpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgcHRyIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZSgweDQwLCBhZGQocHRyLCAweDIwKSkKICAgICAgICAgICAgbXN0b3JlKHB0ciwgc2VsZikKICAgICAgICAgICAgbXN0b3JlKGFkZChyZXQsIDB4MjApLCBwdHIpCiAgICAgICAgfQogICAgICAgIHJldC5fbGVuID0gbGVuKHNlbGYpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgbWVtY3B5KHJldHB0ciArIHNlbGYuX2xlbiwgb3RoZXIuX3B0ciwgb3RoZXIuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KfQoKLyoqCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL2xpZmVjeWNsZS9QYXVzYWJsZS5zb2wKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlU2ltcGxlIGlzIE93bmFibGVTaW1wbGUgewogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSB0cnVlOwoKICAgIC8qKgogICAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAgICovCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgICovCiAgICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUocGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIFBhdXNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgfQp9CgovLyBoZWF2aWx5IG1vZGlmaWVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2RvYi9hdWN0aW9uaG91c2UvYmxvYi9tYXN0ZXIvY29udHJhY3RzL0F1Y3Rpb25Ib3VzZS5zb2wKLy8gbGljZW5zZTogTUlUCi8vIG9yaWdpbmFsIGF1dGhvcjogRG91ZyBQZXRrYW5pY3MgKDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJiMmMyZDdjNmQ5ZDNkY2RiZDFjMWYyZDVkZmQzZGJkZTljZDFkZGRmIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPikgaHR0cHM6Ly9naXRodWIuY29tL2RvYgpjb250cmFjdCBQcmVzYWxlTWFya2V0IGlzIFBhdXNhYmxlU2ltcGxlIHsKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICBhZGRyZXNzIHNlbGxlcjsKICAgICAgICB1aW50MjU2IHByaWNlOyAgICAgICAgICAgLy8gSW4gd2VpLCBjYW4gYmUgMAogICAgfQoKICAgIEVSQzcyMSBwdWJsaWMgYXJ0d29ya0NvbnRyYWN0OwogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSBhcnR3b3JrSWRUb0F1Y3Rpb247CgogICAgLy8gICAgICAwIG1lYW5zIGV2ZXJ5dGhpbmcgZ29lcyB0byB0aGUgc2VsbGVyCiAgICAvLyAgIDEwMDAgbWVhbnMgMSUKICAgIC8vICAgMjUwMCBtZWFucyAyLjUlCiAgICAvLyAgIDQwMDAgbWVhbnMgNCUKICAgIC8vICA1MDAwMCBtZWFucyA1MCUKICAgIC8vIDEwMDAwMCBtZWFucyBldmVyeXRoaW5nIGdvZXMgdG8gdXMKICAgIHVpbnQyNTYgcHVibGljIGRpc3RyaWJ1dGlvbkN1dCA9IDI1MDA7CiAgICBib29sIHB1YmxpYyBjb25zdGFudCBpc1ByZXNhbGVNYXJrZXQgPSB0cnVlOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgX2FydHdvcmtJZCwgdWludDI1NiBfcHJpY2UpOwogICAgZXZlbnQgQXVjdGlvbkNvbmNsdWRlZCh1aW50MjU2IF9hcnR3b3JrSWQsIHVpbnQyNTYgX3ByaWNlLCBhZGRyZXNzIF9idXllcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgX2FydHdvcmtJZCk7CgogICAgLy8gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTZbXSkgcHVibGljIGF1Y3Rpb25zUnVuQnlVc2VyOwogICAgLy8gTm8gbmVlZCB0byBoYXZlIGEgZGVkaWNhdGVkIHZhcmlhYmxlCiAgICAvLyBDYW4gYmUgZm91bmQgYnkKICAgIC8vICBpdGVyYXRlIGFsbCBhcnR3b3JrIGlkcyBvd25lZCBieSB0aGlzIGF1Y3Rpb24gY29udHJhY3QKICAgIC8vICAgIGdldCB0aGUgYXVjdGlvbiBvYmplY3QgZnJvbSBhcnR3b3JrSWRUb0F1Y3Rpb24KICAgIC8vICAgICAgZ2V0IHRoZSBzZWxsZXIgcHJvcGVydHkKICAgIC8vICAgICAgICByZXR1cm4gYXJ0d29yayBpZAogICAgLy8gaG93ZXZlciBpdCB3b3VsZCBiZSBhIGxvdCBiZXR0ZXIgaWYgb3VyIHNlY29uZCBsYXllciBrZWVwcyB0cmFjayBvZiBpdAogICAgZnVuY3Rpb24gYXVjdGlvbnNSdW5CeVVzZXIoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSkgewogICAgICAgIHVpbnQyNTYgYWxsQXJ0d29ya0NvdW50ID0gYXJ0d29ya0NvbnRyYWN0LmJhbGFuY2VPZih0aGlzKTsKCiAgICAgICAgdWludDI1NiBhcnR3b3JrQ291bnQgPSAwOwogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgYWxsQXJ0d29ya0lkcyA9IG5ldyB1aW50MjU2W10oYWxsQXJ0d29ya0NvdW50KTsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGFsbEFydHdvcmtDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgYXJ0d29ya0lkID0gYXJ0d29ya0NvbnRyYWN0LnRva2VuT2ZPd25lckJ5SW5kZXgodGhpcywgaSk7CiAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gYXJ0d29ya0lkVG9BdWN0aW9uW2FydHdvcmtJZF07CiAgICAgICAgICAgIGlmKGF1Y3Rpb24uc2VsbGVyID09IF9hZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBhbGxBcnR3b3JrSWRzW2FydHdvcmtDb3VudCsrXSA9IGFydHdvcmtJZDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKGFydHdvcmtDb3VudCk7CiAgICAgICAgZm9yKGkgPSAwOyBpIDwgYXJ0d29ya0NvdW50OyBpKyspIHsKICAgICAgICAgICAgcmVzdWx0W2ldID0gYWxsQXJ0d29ya0lkc1tpXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8gY29uc3RydWN0b3IuIHJlbmFtZSB0aGlzIGlmIHlvdSByZW5hbWUgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBQcmVzYWxlTWFya2V0KGFkZHJlc3MgX2FydHdvcmtDb250cmFjdCkgcHVibGljIHsKICAgICAgICBhcnR3b3JrQ29udHJhY3QgPSBFUkM3MjEoX2FydHdvcmtDb250cmFjdCk7CiAgICB9CgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX2FydHdvcmtJZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICByZXF1aXJlKF9pc0F1Y3Rpb25FeGlzdChfYXJ0d29ya0lkKSk7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBhcnR3b3JrSWRUb0F1Y3Rpb25bX2FydHdvcmtJZF07CiAgICAgICAgcmVxdWlyZShhdWN0aW9uLnNlbGxlciAhPSBtc2cuc2VuZGVyKTsKICAgICAgICB1aW50MjU2IHByaWNlID0gYXVjdGlvbi5wcmljZTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBwcmljZSk7CgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgZGVsZXRlIGFydHdvcmtJZFRvQXVjdGlvbltfYXJ0d29ya0lkXTsKCiAgICAgICAgaWYocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgbXlDdXQgPSAgcHJpY2UgKiBkaXN0cmlidXRpb25DdXQgLyAxMDAwMDA7CiAgICAgICAgICAgIHVpbnQyNTYgc2VsbGVyQ3V0ID0gcHJpY2UgLSBteUN1dDsKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlckN1dCk7CiAgICAgICAgfQoKICAgICAgICBBdWN0aW9uQ29uY2x1ZGVkKF9hcnR3b3JrSWQsIHByaWNlLCBtc2cuc2VuZGVyKTsKICAgICAgICBhcnR3b3JrQ29udHJhY3QudHJhbnNmZXIobXNnLnNlbmRlciwgX2FydHdvcmtJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF9hcnR3b3JrSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzIHNlbGxlciwgdWludDI1NiBwcmljZSkgewogICAgICAgIHJlcXVpcmUoX2lzQXVjdGlvbkV4aXN0KF9hcnR3b3JrSWQpKTsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGFydHdvcmtJZFRvQXVjdGlvbltfYXJ0d29ya0lkXTsKICAgICAgICByZXR1cm4gKGF1Y3Rpb24uc2VsbGVyLCBhdWN0aW9uLnByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKHVpbnQyNTYgX2FydHdvcmtJZCwgdWludDI1NiBfcHJpY2UsIGFkZHJlc3MgX29yaWdpbmFsT3duZXIpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGFydHdvcmtDb250cmFjdCkpOwoKICAgICAgICAvLyBXaWxsIGNoZWNrIHRvIHNlZSBpZiB0aGUgc2VsbGVyIG93bnMgdGhlIGFzc2V0IGF0IHRoZSBjb250cmFjdAogICAgICAgIF90YWtlT3duZXJzaGlwKF9vcmlnaW5hbE93bmVyLCBfYXJ0d29ya0lkKTsKCiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbjsKCiAgICAgICAgYXVjdGlvbi5zZWxsZXIgPSBfb3JpZ2luYWxPd25lcjsKICAgICAgICBhdWN0aW9uLnByaWNlID0gX3ByaWNlOwoKICAgICAgICBfY3JlYXRlQXVjdGlvbihfYXJ0d29ya0lkLCBhdWN0aW9uKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY3JlYXRlQXVjdGlvbih1aW50MjU2IF9hcnR3b3JrSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICBhcnR3b3JrSWRUb0F1Y3Rpb25bX2FydHdvcmtJZF0gPSBfYXVjdGlvbjsKICAgICAgICBBdWN0aW9uQ3JlYXRlZChfYXJ0d29ya0lkLCBfYXVjdGlvbi5wcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF9hcnR3b3JrSWQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKF9pc0F1Y3Rpb25FeGlzdChfYXJ0d29ya0lkKSk7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBhcnR3b3JrSWRUb0F1Y3Rpb25bX2FydHdvcmtJZF07CiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsbGVyKTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfYXJ0d29ya0lkLCBzZWxsZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKHVpbnQyNTYgX2FydHdvcmtJZCwgYWRkcmVzcyBfb3duZXIpIGludGVybmFsIHsKICAgICAgICBkZWxldGUgYXJ0d29ya0lkVG9BdWN0aW9uW19hcnR3b3JrSWRdOwogICAgICAgIGFydHdvcmtDb250cmFjdC50cmFuc2Zlcihfb3duZXIsIF9hcnR3b3JrSWQpOwogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX2FydHdvcmtJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8gb25seSBpZiB0aGVyZSBpcyBhIGJ1ZyBkaXNjb3ZlcmVkIGFuZCB3ZSBuZWVkIHRvIG1pZ3JhdGUgdG8gYSBuZXcgbWFya2V0IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uRW1lcmdlbmN5KHVpbnQyNTYgX2FydHdvcmtJZCkgZXh0ZXJuYWwgd2hlblBhdXNlZCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX2lzQXVjdGlvbkV4aXN0KF9hcnR3b3JrSWQpKTsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGFydHdvcmtJZFRvQXVjdGlvbltfYXJ0d29ya0lkXTsKICAgICAgICBfY2FuY2VsQXVjdGlvbihfYXJ0d29ya0lkLCBhdWN0aW9uLnNlbGxlcik7CiAgICB9CgogICAgLy8gc2ltcGxlIG1ldGhvZHMKCiAgICBmdW5jdGlvbiBfaXNBdWN0aW9uRXhpc3QodWludDI1NiBfYXJ0d29ya0lkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBhcnR3b3JrSWRUb0F1Y3Rpb25bX2FydHdvcmtJZF0uc2VsbGVyICE9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfYXJ0d29ya0lkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBhcnR3b3JrQ29udHJhY3Qub3duZXJPZihfYXJ0d29ya0lkKSA9PSBfYWRkcmVzczsKICAgIH0KCiAgICBmdW5jdGlvbiBfdGFrZU93bmVyc2hpcChhZGRyZXNzIF9vcmlnaW5hbE93bmVyLCB1aW50MjU2IF9hcnR3b3JrSWQpIGludGVybmFsIHsKICAgICAgICBhcnR3b3JrQ29udHJhY3QudHJhbnNmZXJGcm9tKF9vcmlnaW5hbE93bmVyLCB0aGlzLCBfYXJ0d29ya0lkKTsKICAgIH0KfQoKY29udHJhY3QgUHJlc2FsZSBpcyBPd25hYmxlU2ltcGxlLCBSYW5kb21BcGksIEVSQzcyMSB7CiAgICB1c2luZyBzdHJpbmdzIGZvciAqOwoKICAgIC8vIFRoZXJlIGFyZSA0IGJhdGNoZXMgYXZhaWxhYmxlIGZvciBwcmVzYWxlLgogICAgLy8gQSBiYXRjaCBpcyBhIHNldCBvZiBhcnR3b3JrcyBhbmQKICAgIC8vIHdlIHBsYW4gdG8gcmVsZWFzZSBiYXRjaGVzIG1vbnRobHkuCiAgICB1aW50MjU2IHB1YmxpYyBiYXRjaENvdW50OwogICAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBwcmljZXM7CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIHN1cHBsaWVzOwogICAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBzb2xkOwoKICAgIC8vIEJlZm9yZSBlYWNoIGJhdGNoIGlzIHJlbGVhc2VkIG9uIHRoZSBtYWluIGNvbnRyYWN0LAogICAgLy8gd2Ugd2lsbCBkaXNhYmxlIHRyYW5zZmVycyAoaW5jbHVkaW5nIHRyYWRpbmcpCiAgICAvLyBvbiB0aGlzIGNvbnRyYWN0LgogICAgLy8gVGhpcyBpcyB0byBwcmV2ZW50IHNvbWVvbmUgc2VsbGluZyBhbiBhcnR3b3JrCiAgICAvLyBvbiB0aGUgcHJlc2FsZSBjb250cmFjdCB3aGVuIHdlIGFyZSBtaWdyYXRpbmcKICAgIC8vIHRoZSBhcnR3b3JrcyB0byB0aGUgbWFpbiBjb250cmFjdC4KICAgIG1hcHBpbmcodWludDI1NiA9PiBib29sKSBwdWJsaWMgaXNUcmFuc2ZlckRpc2FibGVkOwoKICAgIHVpbnQyNTZbXSBwdWJsaWMgZG5hczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgb3duZXJUb1Rva2VuQ291bnQ7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBhcnR3b3JrSWRUb093bmVyOwogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgYXJ0d29ya0lkVG9UcmFuc2ZlckFwcHJvdmVkOwoKICAgIFByZXNhbGVNYXJrZXQgcHVibGljIHByZXNhbGVNYXJrZXQ7CgogICAgYnl0ZXM0IGNvbnN0YW50IEVSQzE2NVNpZ25hdHVyZV9FUkMxNjUgPSBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8vIExhdGVzdCB2ZXJzaW9uIG9mIEVSQzcyMSBwZXJoYXBzCiAgICBieXRlczQgY29uc3RhbnQgRVJDMTY1U2lnbmF0dXJlX0VSQzcyMUEgPQogICAgYnl0ZXM0KGtlY2NhazI1NigndG90YWxTdXBwbHkoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdiYWxhbmNlT2YoYWRkcmVzcyknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1Nignb3duZXJPZih1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAgIC8vIGFzIGRlc2NyaWJlZCBpbiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vZWlwcy9pc3N1ZXMvNzIxCiAgICAvLyBhcyBvZiBKYW51YXJ5IDIzLCAyMDE4CiAgICBieXRlczQgY29uc3RhbnQgRVJDMTY1U2lnbmF0dXJlX0VSQzcyMUIgPQogICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RvdGFsU3VwcGx5KCknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rha2VPd25lcnNoaXAodWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5NZXRhZGF0YSh1aW50MjU2KScpKTsKCiAgICBmdW5jdGlvbiBQcmVzYWxlKCkgcHVibGljIHsKICAgICAgICAvLyBBcnR3b3JrcyBhcmUgcmVsZWFzZWQgaW4gYmF0Y2hlcywgd2hpY2ggd2UgcGxhbiB0byByZWxlYXNlCiAgICAgICAgLy8gZXZlcnkgbW9udGggaWYgcG9zc2libGUuIE5ldyBiYXRjaGVzIG1pZ2h0IGNvbnRhaW4gbmV3IGNoYXJhY3RlcnMsCiAgICAgICAgLy8gb3Igb2xkIGNoYXJhY3RlcnMgaW4gbmV3IHBvc2VzLiBMYXRlciBiYXRjaGVzIHdpbGwgZGVmaW5pdGVseSBiZQogICAgICAgIC8vIG1vcmUgcmFyZS4KCiAgICAgICAgLy8gQnkgYnV5aW5nIGF0IHByZXNhbGUsIHlvdSBoYXZlIGEgY2hhbmNlIHRvIGJ1eSB0aGUKICAgICAgICAvLyBhcnR3b3JrIGF0IHBvdGVudGlhbGx5IDUwJSBvZiB0aGUgcHVibGljIHJlbGVhc2UgaW5pdGlhbCBzYWxlcyBwcmljZS4KICAgICAgICAvLyBOb3RlIHRoYXQgYmVjYXVzZSB0aGUgcHVibGljIHJlbGVhc2UgdXNlcyBhIHNsaWRpbmcgcHJpY2Ugc3lzdGVtLAogICAgICAgIC8vIG9uY2UgYW4gYXJ0d29yayBpcyBpbiB0aGUgbWFya2V0cGxhY2UsIHRoZSBwcmljZSB3aWxsIGdldCBsb3dlciB1bnRpbAogICAgICAgIC8vIHNvbWVvbmUgYnV5cyBpdC4KCiAgICAgICAgLy8gRXhhbXBsZTogWW91IGJvdWdodCBhIGJhdGNoIDEgYXJ0d29yayBhdCBwcmVzYWxlIGZvciAwLjA1IGV0aC4KICAgICAgICAvLyBXaGVuIHRoZSBnYW1lIGxhdW5jaGVzLCB0aGUgZmlyc3QgYmF0Y2ggMSBhcnR3b3JrcyBhcmUgZ2VuZXJhdGVkCiAgICAgICAgLy8gb24gdGhlIG1hcmtldHBsYWNlIHdpdGggdGhlIGluaXRpYWwgcHJpY2Ugb2YgMC4xIGV0aC4gWW91IHNlbGwgeW91cnMKICAgICAgICAvLyBvbiB0aGUgbWFya2V0cGxhY2UgZm9yIDAuMDggZXRoIHdoaWNoIGlzIGxvd2VyIHRoYW4gdGhlIHB1YmxpYyByZWxlYXNlCiAgICAgICAgLy8gaW5pdGlhbCBzYWxlcyBwcmljZS4gSWYgc29tZW9uZSBidXlzIHlvdXIgYXJ0d29yaywgeW91IHdpbGwgZ2V0IHByb2ZpdC4KCiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGRvIG5vdCBndWFyYW50ZWUgYW55IHByb2ZpdCB3aGF0c29ldmVyLiBUaGUgcHJpY2Ugb2YgYW4KICAgICAgICAvLyBpdGVtIHdlIHNlbGwgd2lsbCBnZXQgY2hlYXBlciB1bnRpbCBzb21lb25lIGJ1eXMgaXQuIFNvIG90aGVyIHBlb3BsZSBtaWdodCB3YWl0CiAgICAgICAgLy8gZm9yIHRoZSBwdWJsaWMgcmVsZWFzZSBhcnR3b3JrcyB0byBnZXQgY2hlYXBlciBhbmQgYnV5IGl0IGluc3RlYWQgb2YKICAgICAgICAvLyBidXlpbmcgeW91cnMuCgogICAgICAgIC8vIERpc3RyaWJ1dGlvbiBvZiBwcmVzYWxlIGFydHdvcmtzOgogICAgICAgIC8vIFdoZW4gdGhlIGdhbWUgaXMgcmVsZWFzZWQsIGFsbCBiYXRjaCAxIHByZXNhbGUgYXJ0d29ya3MKICAgICAgICAvLyB3aWxsIGJlIGltbWVkaWF0ZWx5IGF2YWlsYWJsZSBmb3IgdHJhZGluZy4KCiAgICAgICAgLy8gV2hlbiBvdGhlciBiYXRjaGVzIGFyZSByZWxlYXNlZCwgZmlyc3Qgd2Ugd2lsbCBnZW5lcmF0ZSAxMCBhcnR3b3JrcwogICAgICAgIC8vIG9uIHRoZSBtYXJrZXRwbGFjZS4gQWZ0ZXIgdGhhdCB3ZSB3aWxsIGRpc3RyaWJ1dGUgdGhlIHByZXNhbGUKICAgICAgICAvLyBhcnR3b3JrcyB3aXRoIHRoZSByYXRlIG9mIGFyb3VuZCAxMCBldmVyeSBtaW51dGUuCiAgICAgICAgLy8gTm90ZSB0aGF0IGJlY2F1c2Ugb2YgbWluaW5nIHVuY2VydGFpbnRpZXMgd2UgY2Fubm90IGd1YXJhbnRlZSBhbnkKICAgICAgICAvLyBzcGVjaWZpYyB0aW1pbmdzLgoKICAgICAgICAvLyBwdWJsaWMgcmVsZWFzZSBpbml0aWFsIHNhbGVzIHByaWNlID49IDAuMSBldGhlcgogICAgICAgIF9hZGRQcmVzYWxlKDAuMDUgZXRoZXIsIDQ1MCk7CgogICAgICAgIC8vIHB1YmxpYyByZWxlYXNlIGluaXRpYWwgc2FsZXMgcHJpY2UgPj0gMC4yNCBldGhlcgogICAgICAgIF9hZGRQcmVzYWxlKDAuMTIgZXRoZXIsIDMyNSk7CgogICAgICAgIC8vIHB1YmxpYyByZWxlYXNlIGluaXRpYWwgc2FsZXMgcHJpY2UgPj0gMC43IGV0aGVyCiAgICAgICAgX2FkZFByZXNhbGUoMC4zNSBldGhlciwgMTUwKTsKCiAgICAgICAgLy8gcHVibGljIHJlbGVhc2UgaW5pdGlhbCBzYWxlcyBwcmljZSA+PSAyLjAgZXRoZXIKICAgICAgICBfYWRkUHJlc2FsZSgxLjAgZXRoZXIsIDc1KTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXkodWludDI1NiBfYmF0Y2gpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKF9iYXRjaCA8IGJhdGNoQ291bnQpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IHByaWNlc1tfYmF0Y2hdKTsgLy8gd2UgZG9uJ3Qgd2FudCB0byBkZWFsIHdpdGggcmVmdW5kcwogICAgICAgIHJlcXVpcmUoc29sZFtfYmF0Y2hdIDwgc3VwcGxpZXNbX2JhdGNoXSk7CgogICAgICAgIHNvbGRbX2JhdGNoXSsrOwogICAgICAgIHVpbnQyNTYgZG5hID0gX2dlbmVyYXRlUmFuZG9tRG5hKF9iYXRjaCk7CgogICAgICAgIHVpbnQyNTYgYXJ0d29ya0lkID0gZG5hcy5wdXNoKGRuYSkgLSAxOwogICAgICAgIG93bmVyVG9Ub2tlbkNvdW50W21zZy5zZW5kZXJdKys7CiAgICAgICAgYXJ0d29ya0lkVG9Pd25lclthcnR3b3JrSWRdID0gbXNnLnNlbmRlcjsKCiAgICAgICAgVHJhbnNmZXIoMCwgbXNnLnNlbmRlciwgYXJ0d29ya0lkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBcnR3b3JrSW5mbyh1aW50MjU2IF9pZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50MjU2IGRuYSwgYWRkcmVzcyBvd25lcikgewogICAgICAgIHJlcXVpcmUoX2lkIDwgdG90YWxTdXBwbHkoKSk7CgogICAgICAgIGRuYSA9IGRuYXNbX2lkXTsKICAgICAgICBvd25lciA9IGFydHdvcmtJZFRvT3duZXJbX2lkXTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYXRjaEluZm8odWludDI1NiBfYmF0Y2gpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2IHByaWNlLCB1aW50MjU2IHN1cHBseSwgdWludDI1NiBzb2xkQW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYmF0Y2ggPCBiYXRjaENvdW50KTsKCiAgICAgICAgcmV0dXJuIChwcmljZXNbX2JhdGNoXSwgc3VwcGxpZXNbX2JhdGNoXSwgc29sZFtfYmF0Y2hdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUcmFuc2ZlckRpc2FibGVkKHVpbnQyNTYgX2JhdGNoLCBib29sIF9pc0Rpc2FibGVkKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX2JhdGNoIDwgYmF0Y2hDb3VudCk7CgogICAgICAgIGlzVHJhbnNmZXJEaXNhYmxlZFtfYmF0Y2hdID0gX2lzRGlzYWJsZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UHJlc2FsZU1hcmtldEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgUHJlc2FsZU1hcmtldCBwcmVzYWxlTWFya2V0VGVzdCA9IFByZXNhbGVNYXJrZXQoX2FkZHJlc3MpOwogICAgICAgIHJlcXVpcmUocHJlc2FsZU1hcmtldFRlc3QuaXNQcmVzYWxlTWFya2V0KCkpOwogICAgICAgIHByZXNhbGVNYXJrZXQgPSBwcmVzYWxlTWFya2V0VGVzdDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsKHVpbnQyNTYgX2FydHdvcmtJZCwgdWludDI1NiBfcHJpY2UpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKF9pc093bmVyT2YobXNnLnNlbmRlciwgX2FydHdvcmtJZCkpOwogICAgICAgIHJlcXVpcmUoX2NhblRyYW5zZmVyQmF0Y2goX2FydHdvcmtJZCkpOwogICAgICAgIF9hcHByb3ZlVHJhbnNmZXIoX2FydHdvcmtJZCwgcHJlc2FsZU1hcmtldCk7CiAgICAgICAgcHJlc2FsZU1hcmtldC5jcmVhdGVBdWN0aW9uKF9hcnR3b3JrSWQsIF9wcmljZSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gSGVscGVyIG1ldGhvZHMKCiAgICBmdW5jdGlvbiBfYWRkUHJlc2FsZSh1aW50MjU2IF9wcmljZSwgdWludDI1NiBfc3VwcGx5KSBwcml2YXRlIHsKICAgICAgICBwcmljZXNbYmF0Y2hDb3VudF0gPSBfcHJpY2U7CiAgICAgICAgc3VwcGxpZXNbYmF0Y2hDb3VudF0gPSBfc3VwcGx5OwoKICAgICAgICBiYXRjaENvdW50Kys7CiAgICB9CgogICAgZnVuY3Rpb24gX2dlbmVyYXRlUmFuZG9tRG5hKHVpbnQyNTYgX2JhdGNoKSBwcml2YXRlIHJldHVybnModWludDI1NiBkbmEpIHsKICAgICAgICB1aW50MjU2IHJhbmQgPSByYW5kb20yNTYoKSAlICgxMCAqKiA3Nik7CgogICAgICAgIC8vIHNldCBiYXRjaCBkaWdpdHMKICAgICAgICByYW5kID0gcmFuZCAvIDEwMDAwMDAwMCAqIDEwMDAwMDAwMCArIF9iYXRjaDsKCiAgICAgICAgcmV0dXJuIHJhbmQ7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzT3duZXJPZihhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhcnR3b3JrSWRUb093bmVyW190b2tlbklkXSA9PSBfYWRkcmVzczsKICAgIH0KCiAgICBmdW5jdGlvbiBfYXBwcm92ZVRyYW5zZmVyKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHsKICAgICAgICBhcnR3b3JrSWRUb1RyYW5zZmVyQXBwcm92ZWRbX3Rva2VuSWRdID0gX2FkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgYXJ0d29ya0lkVG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgb3duZXJUb1Rva2VuQ291bnRbX3RvXSsrOwoKICAgICAgICBvd25lclRvVG9rZW5Db3VudFtfZnJvbV0tLTsKICAgICAgICBkZWxldGUgYXJ0d29ya0lkVG9UcmFuc2ZlckFwcHJvdmVkW190b2tlbklkXTsKCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvclRyYW5zZmVyKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhcnR3b3JrSWRUb1RyYW5zZmVyQXBwcm92ZWRbX3Rva2VuSWRdID09IF9hZGRyZXNzOwogICAgfQoKICAgIGZ1bmN0aW9uIF90cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKF9pc093bmVyT2YoX2Zyb20sIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3JUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBwcmV2ZW50IGFjY2lkZW50YWwgdHJhbnNmZXIKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgLy8gcGVyZm9ybSB0aGUgdHJhbnNmZXIgYW5kIGVtaXQgVHJhbnNmZXIgZXZlbnQKICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9jYW5UcmFuc2ZlckJhdGNoKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludDI1NiBiYXRjaCA9IGRuYXNbX3Rva2VuSWRdICUgMTA7CiAgICAgICAgcmV0dXJuICFpc1RyYW5zZmVyRGlzYWJsZWRbYmF0Y2hdOwogICAgfQoKICAgIGZ1bmN0aW9uIF90b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICAgICAgX3ByZWZlcnJlZFRyYW5zcG9ydDsgLy8gd2UgZG9uJ3QgdXNlIHRoaXMgcGFyYW1ldGVyCgogICAgICAgIHJlcXVpcmUoX3Rva2VuSWQgPCB0b3RhbFN1cHBseSgpKTsKCiAgICAgICAgc3RyaW5ncy5zbGljZSBtZW1vcnkgdG9rZW5JZFNsaWNlID0gX3VpbnRUb0J5dGVzKF90b2tlbklkKS50b1NsaWNlQjMyKCk7CiAgICAgICAgcmV0dXJuICIvaHR0cC9ldGhlcndhaWZ1LmNvbS9wcmVzYWxlL2FydHdvcmsvIi50b1NsaWNlKCkuY29uY2F0KHRva2VuSWRTbGljZSk7CiAgICB9CgogICAgLy8gQXV0aG9yOiBwaXBlcm1lcnJpYW0KICAgIC8vIE1JVCBsaWNlbnNlCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcGlwZXJtZXJyaWFtL2V0aGVyZXVtLXN0cmluZy11dGlscwogICAgZnVuY3Rpb24gX3VpbnRUb0J5dGVzKHVpbnQyNTYgdikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGJ5dGVzMzIgcmV0KSB7CiAgICAgICAgaWYgKHYgPT0gMCkgewogICAgICAgICAgICByZXQgPSAnMCc7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB3aGlsZSAodiA+IDApIHsKICAgICAgICAgICAgICAgIHJldCA9IGJ5dGVzMzIodWludDI1NihyZXQpIC8gKDIgKiogOCkpOwogICAgICAgICAgICAgICAgcmV0IHw9IGJ5dGVzMzIoKCh2ICUgMTApICsgNDgpICogMiAqKiAoOCAqIDMxKSk7CiAgICAgICAgICAgICAgICB2IC89IDEwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLy8gUmVxdWlyZWQgbWV0aG9kcyBvZiBFUkM3MjEKCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZG5hcy5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG93bmVyVG9Ub2tlbkNvdW50W19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBhZGRyZXNzIHRoZU93bmVyID0gYXJ0d29ya0lkVG9Pd25lcltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZSh0aGVPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXR1cm4gdGhlT3duZXI7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2NhblRyYW5zZmVyQmF0Y2goX3Rva2VuSWQpKTsKCiAgICAgICAgcmVxdWlyZShfaXNPd25lck9mKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIE1VU1QgdGhyb3cgaWYgX3Rva2VuSUQgZG9lcyBub3QgcmVwcmVzZW50IGFuIE5GVAogICAgICAgIC8vIGJ1dCBpZiBpdCBpcyBub3QgTkZULCBvd25lciBpcyBhZGRyZXNzKDApCiAgICAgICAgLy8gd2hpY2ggbWVhbnMgaXQgaXMgaW1wb3NzaWJsZSBiZWNhdXNlIG1zZy5zZW5kZXIgaXMgYSBub256ZXJvIGFkZHJlc3MKCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IF90byk7CgogICAgICAgIGFkZHJlc3MgcHJldkFwcHJvdmVkQWRkcmVzcyA9IGFydHdvcmtJZFRvVHJhbnNmZXJBcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgX2FwcHJvdmVUcmFuc2ZlcihfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRG9uJ3Qgc2VuZCBBcHByb3ZhbCBldmVudCBpZiBpdCBpcyBqdXN0CiAgICAgICAgLy8gcmVhZmZpcm1pbmcgdGhhdCB0aGVyZSBpcyBubyBvbmUgYXBwcm92ZWQKICAgICAgICBpZighKHByZXZBcHByb3ZlZEFkZHJlc3MgPT0gYWRkcmVzcygwKSAmJiBfdG8gPT0gYWRkcmVzcygwKSkpIHsKICAgICAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfY2FuVHJhbnNmZXJCYXRjaChfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUoX2lzT3duZXJPZihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBwcmV2ZW50IGFjY2lkZW50YWwgdHJhbnNmZXJzCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhwcmVzYWxlTWFya2V0KSk7CgogICAgICAgIC8vIHBlcmZvcm0gdGhlIHRyYW5zZmVyIGFuZCBlbWl0IFRyYW5zZmVyIGV2ZW50CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2NhblRyYW5zZmVyQmF0Y2goX3Rva2VuSWQpKTsKICAgICAgICBfdHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKF9jYW5UcmFuc2ZlckJhdGNoKF90b2tlbklkKSk7CiAgICAgICAgYWRkcmVzcyBvd25lciA9IGFydHdvcmtJZFRvT3duZXJbX3Rva2VuSWRdOwogICAgICAgIF90cmFuc2ZlckZyb20ob3duZXIsIG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLyBPcHRpb25hbCBtZXRob2RzIG9mIEVSQzcyMQoKICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKSB7CiAgICAgICAgdWludDI1NiBjb3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlcyA9IG5ldyB1aW50MjU2W10oY291bnQpOwogICAgICAgIHVpbnQyNTYgYWxsQXJ0d29ya0NvdW50ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IGkgPSAwOwoKICAgICAgICBmb3IodWludDI1NiBhcnR3b3JrSWQgPSAxOyBhcnR3b3JrSWQgPD0gYWxsQXJ0d29ya0NvdW50ICYmIGkgPCBjb3VudDsgYXJ0d29ya0lkKyspIHsKICAgICAgICAgICAgaWYoYXJ0d29ya0lkVG9Pd25lclthcnR3b3JrSWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgcmVzW2krK10gPSBhcnR3b3JrSWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkgewogICAgICAgIHJldHVybiBfdG9rZW5NZXRhZGF0YShfdG9rZW5JZCwgX3ByZWZlcnJlZFRyYW5zcG9ydCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiB0b2tlbklkKSB7CiAgICAgICAgcmVxdWlyZShfaW5kZXggPCBiYWxhbmNlT2YoX293bmVyKSk7CgogICAgICAgIC8vIG5vdCBzdHJpY3RseSBuZWVkZWQgYmVjYXVzZSBpZiB0aGUgc3RhdGUgaXMgY29uc2lzdGVudCB0aGVuCiAgICAgICAgLy8gYSBtYXRjaCB3aWxsIGJlIGZvdW5kCiAgICAgICAgdWludDI1NiBhbGxBcnR3b3JrQ291bnQgPSB0b3RhbFN1cHBseSgpOwoKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIGZvcih1aW50MjU2IGFydHdvcmtJZCA9IDA7IGFydHdvcmtJZCA8IGFsbEFydHdvcmtDb3VudDsgYXJ0d29ya0lkKyspIHsKICAgICAgICAgICAgaWYoYXJ0d29ya0lkVG9Pd25lclthcnR3b3JrSWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgaWYoaSA9PSBfaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJ0d29ya0lkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNzZXJ0KGZhbHNlKTsgLy8gc2hvdWxkIG5ldmVyIHJlYWNoIGhlcmUKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpIHsKICAgICAgICByZXR1cm4gX3Rva2VuTWV0YWRhdGEoX3Rva2VuSWQsICJodHRwIik7CiAgICB9CgogICAgLy8gRVJDLTE2NSBTdGFuZGFyZCBpbnRlcmZhY2UgZGV0ZWN0aW9uIChyZXF1aXJlZCkKCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIF9pbnRlcmZhY2VJRCA9PSBFUkMxNjVTaWduYXR1cmVfRVJDMTY1IHx8CiAgICAgICAgX2ludGVyZmFjZUlEID09IEVSQzE2NVNpZ25hdHVyZV9FUkM3MjFBIHx8CiAgICAgICAgX2ludGVyZmFjZUlEID09IEVSQzE2NVNpZ25hdHVyZV9FUkM3MjFCOwogICAgfQp9'.
	

]
