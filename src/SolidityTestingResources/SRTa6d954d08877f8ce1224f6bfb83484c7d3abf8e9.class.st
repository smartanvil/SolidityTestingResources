Class {
	#name : #SRTa6d954d08877f8ce1224f6bfb83484c7d3abf8e9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa6d954d08877f8ce1224f6bfb83484c7d3abf8e9 >> base64 [
	^ 'LyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgUHVsbFBheW1lbnQKICogQGRldiBCYXNlIGNvbnRyYWN0IHN1cHBvcnRpbmcgYXN5bmMgc2VuZCBmb3IgcHVsbCBwYXltZW50cy4gSW5oZXJpdCBmcm9tIHRoaXMKICogY29udHJhY3QgYW5kIHVzZSBhc3luY1NlbmQgaW5zdGVhZCBvZiBzZW5kLgogKi8KY29udHJhY3QgUHVsbFBheW1lbnQgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHBheW1lbnRzOwogIHVpbnQyNTYgcHVibGljIHRvdGFsUGF5bWVudHM7CgogIC8qKgogICogQGRldiB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUuCiAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkgcHVibGljIHsKICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOwoKICAgIHJlcXVpcmUocGF5bWVudCAhPSAwKTsKICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHBheW1lbnQpOwoKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLnN1YihwYXltZW50KTsKICAgIHBheW1lbnRzW3BheWVlXSA9IDA7CgogICAgYXNzZXJ0KHBheWVlLnNlbmQocGF5bWVudCkpOwogIH0KCiAgLyoqCiAgKiBAZGV2IENhbGxlZCBieSB0aGUgcGF5ZXIgdG8gc3RvcmUgdGhlIHNlbnQgYW1vdW50IGFzIGNyZWRpdCB0byBiZSBwdWxsZWQuCiAgKiBAcGFyYW0gZGVzdCBUaGUgZGVzdGluYXRpb24gYWRkcmVzcyBvZiB0aGUgZnVuZHMuCiAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgKi8KICBmdW5jdGlvbiBhc3luY1NlbmQoYWRkcmVzcyBkZXN0LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgcGF5bWVudHNbZGVzdF0gPSBwYXltZW50c1tkZXN0XS5hZGQoYW1vdW50KTsKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLmFkZChhbW91bnQpOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIEVSQzcyMSBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2VpcHMvaXNzdWVzLzcyMQogKi8KY29udHJhY3QgRVJDNzIxIHsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfYXBwcm92ZWQsIHVpbnQyNTYgX3Rva2VuSWQpOwoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2JhbGFuY2UpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfdG9rZW5JZCkgcHVibGljOwp9CgovKioKICogQHRpdGxlIEVSQzcyMVRva2VuCiAqIEdlbmVyaWMgaW1wbGVtZW50YXRpb24gZm9yIHRoZSByZXF1aXJlZCBmdW5jdGlvbmFsaXR5IG9mIHRoZSBFUkM3MjEgc3RhbmRhcmQKICovCmNvbnRyYWN0IEVSQzcyMVRva2VuIGlzIEVSQzcyMSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICB1aW50MjU2IHByaXZhdGUgdG90YWxUb2tlbnM7CgogIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBvd25lcgogIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHJpdmF0ZSB0b2tlbk93bmVyOwoKICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gYXBwcm92ZWQgYWRkcmVzcwogIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHJpdmF0ZSB0b2tlbkFwcHJvdmFsczsKCiAgLy8gTWFwcGluZyBmcm9tIG93bmVyIHRvIGxpc3Qgb2Ygb3duZWQgdG9rZW4gSURzCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2W10pIHByaXZhdGUgb3duZWRUb2tlbnM7CgogIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBpbmRleCBvZiB0aGUgb3duZXIgdG9rZW5zIGxpc3QKICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgcHJpdmF0ZSBvd25lZFRva2Vuc0luZGV4OwoKICAvKioKICAqIEBkZXYgR3VhcmFudGVlcyBtc2cuc2VuZGVyIGlzIG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbgogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIHZhbGlkYXRlIGl0cyBvd25lcnNoaXAgYmVsb25ncyB0byBtc2cuc2VuZGVyCiAgKi8KICBtb2RpZmllciBvbmx5T3duZXJPZih1aW50MjU2IF90b2tlbklkKSB7CiAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IG1zZy5zZW5kZXIpOwogICAgXzsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHN0b3JlZCBieSB0aGUgY29udHJhY3QKICAqIEByZXR1cm4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAqLwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRvdGFsVG9rZW5zOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgdG8gcXVlcnkgdGhlIGJhbGFuY2Ugb2YKICAqIEByZXR1cm4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGxpc3Qgb2YgdG9rZW5zIG93bmVkIGJ5IGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF9vd25lciBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0b2tlbnMgb2YKICAqIEByZXR1cm4gdWludDI1NltdIHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiB0b2tlbnMgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiB0b2tlbnNPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NltdKSB7CiAgICByZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBvd25lciBvZiB0aGUgc3BlY2lmaWVkIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIG93bmVyIG9mCiAgKiBAcmV0dXJuIG93bmVyIGFkZHJlc3MgY3VycmVudGx5IG1hcmtlZCBhcyB0aGUgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKi8KICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIGFkZHJlc3Mgb3duZXIgPSB0b2tlbk93bmVyW190b2tlbklkXTsKICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICByZXR1cm4gb3duZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldHMgdGhlIGFwcHJvdmVkIGFkZHJlc3MgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRAogICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcmV0dXJuIGFkZHJlc3MgY3VycmVudGx5IGFwcHJvdmVkIHRvIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmVkRm9yKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiB0b2tlbkFwcHJvdmFsc1tfdG9rZW5JZF07CiAgfQoKICAvKioKICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRCB0byBhbm90aGVyIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gYWRkcmVzcyB0byByZWNlaXZlIHRoZSBvd25lcnNoaXAgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgb25seU93bmVyT2YoX3Rva2VuSWQpIHsKICAgIGNsZWFyQXBwcm92YWxBbmRUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICB9CgogIC8qKgogICogQGRldiBBcHByb3ZlcyBhbm90aGVyIGFkZHJlc3MgdG8gY2xhaW0gZm9yIHRoZSBvd25lcnNoaXAgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gYmUgYXBwcm92ZWQgZm9yIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFwcHJvdmVkCiAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgb25seU93bmVyT2YoX3Rva2VuSWQpIHsKICAgIGFkZHJlc3Mgb3duZXIgPSBvd25lck9mKF90b2tlbklkKTsKICAgIHJlcXVpcmUoX3RvICE9IG93bmVyKTsKICAgIGlmIChhcHByb3ZlZEZvcihfdG9rZW5JZCkgIT0gMCB8fCBfdG8gIT0gMCkgewogICAgICB0b2tlbkFwcHJvdmFsc1tfdG9rZW5JZF0gPSBfdG87CiAgICAgIEFwcHJvdmFsKG93bmVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICB9CgogIC8qKgogICogQGRldiBDbGFpbXMgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gYmVpbmcgY2xhaW1lZCBieSB0aGUgbXNnLnNlbmRlcgogICovCiAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgcmVxdWlyZShpc0FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICBjbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIob3duZXJPZihfdG9rZW5JZCksIG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICB9CgogIC8qKgogICogQGRldiBNaW50IHRva2VuIGZ1bmN0aW9uCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBvd24gdGhlIG1pbnRlZCB0b2tlbgogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIG1pbnRlZCBieSB0aGUgbXNnLnNlbmRlcgogICovCiAgZnVuY3Rpb24gX21pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgYWRkVG9rZW4oX3RvLCBfdG9rZW5JZCk7CiAgICBUcmFuc2ZlcigweDAsIF90bywgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgdG9rZW4KICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiBiZWluZyBidXJuZWQgYnkgdGhlIG1zZy5zZW5kZXIKICAqLwogIGZ1bmN0aW9uIF9idXJuKHVpbnQyNTYgX3Rva2VuSWQpIG9ubHlPd25lck9mKF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICBpZiAoYXBwcm92ZWRGb3IoX3Rva2VuSWQpICE9IDApIHsKICAgICAgY2xlYXJBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CiAgICByZW1vdmVUb2tlbihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCAweDAsIF90b2tlbklkKTsKICB9CgogIC8qKgogICAqIEBkZXYgVGVsbHMgd2hldGhlciB0aGUgbXNnLnNlbmRlciBpcyBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElEIG9yIG5vdAogICAqIFRoaXMgZnVuY3Rpb24gaXMgbm90IHByaXZhdGUgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGluIGZ1cnRoZXIgaW1wbGVtZW50YXRpb25zIGxpa2UgdGhlIG9wZXJhdGFibGUgRVJDNzIxCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIHRoZSBvd25lciB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIGFwcHJvdmFsIG9mCiAgICogQHJldHVybiBib29sIHdoZXRoZXIgdGhlIG1zZy5zZW5kZXIgaXMgYXBwcm92ZWQgZm9yIHRoZSBnaXZlbiB0b2tlbiBJRCBvciBub3QKICAgKi8KICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBhcHByb3ZlZEZvcihfdG9rZW5JZCkgPT0gX293bmVyOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGNsZWFyIGN1cnJlbnQgYXBwcm92YWwgYW5kIHRyYW5zZmVyIHRoZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF9mcm9tIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICogQHBhcmFtIF90byBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRoZSB0b2tlbiB0bwogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgKi8KICBmdW5jdGlvbiBjbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdG8gIT0gb3duZXJPZihfdG9rZW5JZCkpOwogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBfZnJvbSk7CgogICAgY2xlYXJBcHByb3ZhbChfZnJvbSwgX3Rva2VuSWQpOwogICAgcmVtb3ZlVG9rZW4oX2Zyb20sIF90b2tlbklkKTsKICAgIGFkZFRva2VuKF90bywgX3Rva2VuSWQpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGNsZWFyIGN1cnJlbnQgYXBwcm92YWwgb2YgYSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgKi8KICBmdW5jdGlvbiBjbGVhckFwcHJvdmFsKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gX293bmVyKTsKICAgIHRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IDA7CiAgICBBcHByb3ZhbChfb3duZXIsIDAsIF90b2tlbklkKTsKICB9CgogIC8qKgogICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBhZGQgYSB0b2tlbiBJRCB0byB0aGUgbGlzdCBvZiBhIGdpdmVuIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gYWRkcmVzcyByZXByZXNlbnRpbmcgdGhlIG5ldyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSBhZGRlZCB0byB0aGUgdG9rZW5zIGxpc3Qgb2YgdGhlIGdpdmVuIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIGFkZFRva2VuKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgIHJlcXVpcmUodG9rZW5Pd25lcltfdG9rZW5JZF0gPT0gYWRkcmVzcygwKSk7CiAgICB0b2tlbk93bmVyW190b2tlbklkXSA9IF90bzsKICAgIHVpbnQyNTYgbGVuZ3RoID0gYmFsYW5jZU9mKF90byk7CiAgICBvd25lZFRva2Vuc1tfdG9dLnB1c2goX3Rva2VuSWQpOwogICAgb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF0gPSBsZW5ndGg7CiAgICB0b3RhbFRva2VucyA9IHRvdGFsVG9rZW5zLmFkZCgxKTsKICB9CgogIC8qKgogICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSB0b2tlbiBJRCBmcm9tIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBwcmV2aW91cyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSByZW1vdmVkIGZyb20gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiByZW1vdmVUb2tlbihhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gX2Zyb20pOwoKICAgIHVpbnQyNTYgdG9rZW5JbmRleCA9IG93bmVkVG9rZW5zSW5kZXhbX3Rva2VuSWRdOwogICAgdWludDI1NiBsYXN0VG9rZW5JbmRleCA9IGJhbGFuY2VPZihfZnJvbSkuc3ViKDEpOwogICAgdWludDI1NiBsYXN0VG9rZW4gPSBvd25lZFRva2Vuc1tfZnJvbV1bbGFzdFRva2VuSW5kZXhdOwoKICAgIHRva2VuT3duZXJbX3Rva2VuSWRdID0gMDsKICAgIG93bmVkVG9rZW5zW19mcm9tXVt0b2tlbkluZGV4XSA9IGxhc3RUb2tlbjsKICAgIG93bmVkVG9rZW5zW19mcm9tXVtsYXN0VG9rZW5JbmRleF0gPSAwOwogICAgLy8gTm90ZSB0aGF0IHRoaXMgd2lsbCBoYW5kbGUgc2luZ2xlLWVsZW1lbnQgYXJyYXlzLiBJbiB0aGF0IGNhc2UsIGJvdGggdG9rZW5JbmRleCBhbmQgbGFzdFRva2VuSW5kZXggYXJlIGdvaW5nIHRvCiAgICAvLyBiZSB6ZXJvLiBUaGVuIHdlIGNhbiBtYWtlIHN1cmUgdGhhdCB3ZSB3aWxsIHJlbW92ZSBfdG9rZW5JZCBmcm9tIHRoZSBvd25lZFRva2VucyBsaXN0IHNpbmNlIHdlIGFyZSBmaXJzdCBzd2FwcGluZwogICAgLy8gdGhlIGxhc3RUb2tlbiB0byB0aGUgZmlyc3QgcG9zaXRpb24sIGFuZCB0aGVuIGRyb3BwaW5nIHRoZSBlbGVtZW50IHBsYWNlZCBpbiB0aGUgbGFzdCBwb3NpdGlvbiBvZiB0aGUgbGlzdAoKICAgIG93bmVkVG9rZW5zW19mcm9tXS5sZW5ndGgtLTsKICAgIG93bmVkVG9rZW5zSW5kZXhbX3Rva2VuSWRdID0gMDsKICAgIG93bmVkVG9rZW5zSW5kZXhbbGFzdFRva2VuXSA9IHRva2VuSW5kZXg7CiAgICB0b3RhbFRva2VucyA9IHRvdGFsVG9rZW5zLnN1YigxKTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgQ29tcG9zYWJsZQogKiBDb21wb3NhYmxlIC0gYSBjb250cmFjdCB0byBtaW50IGNvbXBvc2l0aW9ucwogKi8KCmNvbnRyYWN0IENvbXBvc2FibGUgaXMgRVJDNzIxVG9rZW4sIE93bmFibGUsIFB1bGxQYXltZW50LCBQYXVzYWJsZSB7CiAgIAogICAgLy8gTWF4IG51bWJlciBvZiBsYXllcnMgZm9yIGEgY29tcG9zaXRpb24gdG9rZW4KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9MQVlFUlMgPSAxMDA7CgogICAgLy8gVGhlIG1pbmltdW0gY29tcG9zaXRpb24gZmVlIGZvciBhbiBldGhtb2ppCiAgICB1aW50MjU2IHB1YmxpYyBtaW5Db21wb3NpdGlvbkZlZSA9IDAuMDAxIGV0aGVyOwoKICAgIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBjb21wb3NpdGlvbiBwcmljZQogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5JZFRvQ29tcG9zaXRpb25QcmljZTsKICAgIAogICAgLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGxheWVycyByZXByZXNlbnRpbmcgaXQKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NltdKSBwdWJsaWMgdG9rZW5JZFRvTGF5ZXJzOwoKICAgIC8vIEhhc2ggb2YgYWxsIGxheWVycyB0byB0cmFjayB1bmlxdWVuZXNzIG9mIGV0aG1vamlzCiAgICBtYXBwaW5nIChieXRlczMyID0+IGJvb2wpIHB1YmxpYyBjb21wb3NpdGlvbnM7CgogICAgLy8gSW1hZ2UgaGFzaGVzIHRvIHRyYWNrIHVuaXF1ZW5lcyBvZiBldGhtb2ppIGltYWdlcy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIGltYWdlSGFzaGVzOwoKICAgIC8vIEV2ZW50IGZvciBlbWl0dGluZyBuZXcgYmFzZSB0b2tlbiBjcmVhdGVkIAogICAgZXZlbnQgQmFzZVRva2VuQ3JlYXRlZCh1aW50MjU2IHRva2VuSWQpOwogICAgCiAgICAvLyBFdmVudCBmb3IgZW1pdHRpbmcgbmV3IGNvbXBvc2l0aW9uIHRva2VuIGNyZWF0ZWQgCiAgICBldmVudCBDb21wb3NpdGlvblRva2VuQ3JlYXRlZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTZbXSBsYXllcnMsIGFkZHJlc3MgaW5kZXhlZCBvd25lcik7CiAgICAKICAgIC8vIEV2ZW50IGZvciBlbWl0dGluZyBjb21wb3NpdGlvbiBwcmljZSBjaGFuZ2luZyBmb3IgYSB0b2tlbgogICAgZXZlbnQgQ29tcG9zaXRpb25QcmljZUNoYW5nZWQodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHByaWNlLCBhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwoKICAgIC8vIFdoZXRoZXIgb3Igbm90IHRoaXMgY29udHJhY3QgYWNjZXB0cyBtYWtpbmcgY29tcG9zaXRpb25zIHdpdGggb3RoZXIgY29tcG9zaXRpb25zCiAgICBib29sIHB1YmxpYyBpc0NvbXBvc2l0aW9uT25seVdpdGhCYXNlTGF5ZXJzOwogICAgCi8vIC0tLS0tIEVYUE9TRUQgTUVUSE9EUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8qKgogICAgKiBAZGV2IE1pbnRzIGEgYmFzZSB0b2tlbiB0byBhbiBhZGRyZXNzIHdpdGggYSBnaXZlbiBjb21wb3NpdGlvbiBwcmljZQogICAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgb2YgdGhlIGZ1dHVyZSBvd25lciBvZiB0aGUgdG9rZW4KICAgICogQHBhcmFtIF9jb21wb3NpdGlvblByaWNlIHVpbnQyNTYgY29tcG9zaXRpb24gcHJpY2UgZm9yIHRoZSBuZXcgdG9rZW4KICAgICovCiAgICBmdW5jdGlvbiBtaW50VG8oYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2NvbXBvc2l0aW9uUHJpY2UsIHVpbnQyNTYgX2ltYWdlSGFzaCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdWludDI1NiBuZXdUb2tlbkluZGV4ID0gX2dldE5leHRUb2tlbklkKCk7CiAgICAgICAgX21pbnQoX3RvLCBuZXdUb2tlbkluZGV4KTsKICAgICAgICB0b2tlbklkVG9MYXllcnNbbmV3VG9rZW5JbmRleF0gPSBbbmV3VG9rZW5JbmRleF07CiAgICAgICAgcmVxdWlyZShfaXNVbmlxdWUodG9rZW5JZFRvTGF5ZXJzW25ld1Rva2VuSW5kZXhdLCBfaW1hZ2VIYXNoKSk7CiAgICAgICAgY29tcG9zaXRpb25zW2tlY2NhazI1NihbbmV3VG9rZW5JbmRleF0pXSA9IHRydWU7CiAgICAgICAgaW1hZ2VIYXNoZXNbX2ltYWdlSGFzaF0gPSBuZXdUb2tlbkluZGV4OyAgICAgIAogICAgICAgIEJhc2VUb2tlbkNyZWF0ZWQobmV3VG9rZW5JbmRleCk7CiAgICAgICAgX3NldENvbXBvc2l0aW9uUHJpY2UobmV3VG9rZW5JbmRleCwgX2NvbXBvc2l0aW9uUHJpY2UpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IE1pbnRzIGEgY29tcG9zaXRpb24gZW1vamkKICAgICogQHBhcmFtIF90b2tlbklkcyB1aW50MjU2W10gdGhlIGFycmF5IG9mIGxheWVycyB0aGF0IHdpbGwgbWFrZSB1cCB0aGUgY29tcG9zaXRpb24KICAgICovCiAgICBmdW5jdGlvbiBjb21wb3NlKHVpbnQyNTZbXSBfdG9rZW5JZHMsICB1aW50MjU2IF9pbWFnZUhhc2gpIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBnZXRUb3RhbENvbXBvc2l0aW9uUHJpY2UoX3Rva2VuSWRzKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSAmJiBtc2cudmFsdWUgPj0gcHJpY2UpOwogICAgICAgIHJlcXVpcmUoX3Rva2VuSWRzLmxlbmd0aCA8PSBNQVhfTEFZRVJTKTsKCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBsYXllcnMgPSBuZXcgdWludDI1NltdKE1BWF9MQVlFUlMpOwogICAgICAgIHVpbnQgYWN0dWFsU2l6ZSA9IDA7IAoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfdG9rZW5JZHMubGVuZ3RoOyBpKyspIHsgCiAgICAgICAgICAgIHVpbnQyNTYgY29tcG9zaXRpb25MYXllcklkID0gX3Rva2VuSWRzW2ldOwogICAgICAgICAgICByZXF1aXJlKF90b2tlbkxheWVyc0V4aXN0KGNvbXBvc2l0aW9uTGF5ZXJJZCkpOwogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IGluaGVyaXRlZExheWVycyA9IHRva2VuSWRUb0xheWVyc1tjb21wb3NpdGlvbkxheWVySWRdOwogICAgICAgICAgICBpZiAoaXNDb21wb3NpdGlvbk9ubHlXaXRoQmFzZUxheWVycykgeyAKICAgICAgICAgICAgICAgIHJlcXVpcmUoaW5oZXJpdGVkTGF5ZXJzLmxlbmd0aCA9PSAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXF1aXJlKGluaGVyaXRlZExheWVycy5sZW5ndGggPCBNQVhfTEFZRVJTKTsKICAgICAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgaW5oZXJpdGVkTGF5ZXJzLmxlbmd0aDsgaisrKSB7IAogICAgICAgICAgICAgICAgcmVxdWlyZShhY3R1YWxTaXplIDwgTUFYX0xBWUVSUyk7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgayA9IDA7IGsgPCBsYXllcnMubGVuZ3RoOyBrKyspIHsgCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZShsYXllcnNba10gIT0gaW5oZXJpdGVkTGF5ZXJzW2pdKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGF5ZXJzW2tdID09IDApIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxheWVyc1thY3R1YWxTaXplXSA9IGluaGVyaXRlZExheWVyc1tqXTsKICAgICAgICAgICAgICAgIGFjdHVhbFNpemUgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXF1aXJlKG93bmVyT2YoY29tcG9zaXRpb25MYXllcklkKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgYXN5bmNTZW5kKG93bmVyT2YoY29tcG9zaXRpb25MYXllcklkKSwgdG9rZW5JZFRvQ29tcG9zaXRpb25QcmljZVtjb21wb3NpdGlvbkxheWVySWRdKTsKICAgICAgICB9CiAgICAKICAgICAgICB1aW50MjU2IG5ld1Rva2VuSW5kZXggPSBfZ2V0TmV4dFRva2VuSWQoKTsKICAgICAgICAKICAgICAgICB0b2tlbklkVG9MYXllcnNbbmV3VG9rZW5JbmRleF0gPSBfdHJpbShsYXllcnMsIGFjdHVhbFNpemUpOwogICAgICAgIHJlcXVpcmUoX2lzVW5pcXVlKHRva2VuSWRUb0xheWVyc1tuZXdUb2tlbkluZGV4XSwgX2ltYWdlSGFzaCkpOwogICAgICAgIGNvbXBvc2l0aW9uc1trZWNjYWsyNTYodG9rZW5JZFRvTGF5ZXJzW25ld1Rva2VuSW5kZXhdKV0gPSB0cnVlOwogICAgICAgIGltYWdlSGFzaGVzW19pbWFnZUhhc2hdID0gbmV3VG9rZW5JbmRleDsKICAgIAogICAgICAgIF9taW50KG1zZy5zZW5kZXIsIG5ld1Rva2VuSW5kZXgpOwoKICAgICAgICBpZiAobXNnLnZhbHVlID4gcHJpY2UpIHsKICAgICAgICAgICAgdWludDI1NiBwdXJjaGFzZUV4Y2VzcyA9IFNhZmVNYXRoLnN1Yihtc2cudmFsdWUsIHByaWNlKTsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihwdXJjaGFzZUV4Y2Vzcyk7ICAgICAgICAgIAogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc0NvbXBvc2l0aW9uT25seVdpdGhCYXNlTGF5ZXJzKSB7IAogICAgICAgICAgICBfc2V0Q29tcG9zaXRpb25QcmljZShuZXdUb2tlbkluZGV4LCBtaW5Db21wb3NpdGlvbkZlZSk7CiAgICAgICAgfQogICAKICAgICAgICBDb21wb3NpdGlvblRva2VuQ3JlYXRlZChuZXdUb2tlbkluZGV4LCB0b2tlbklkVG9MYXllcnNbbmV3VG9rZW5JbmRleF0sIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGFsbG93cyBhbiBhZGRyZXNzIHRvIHdpdGhkcmF3IGl0cyBiYWxhbmNlIGluIHRoZSBjb250cmFjdAogICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiB0aGUgdG9rZW4gSUQKICAgICogQHJldHVybiB1aW50MjU2W10gbGlzdCBvZiBsYXllcnMgZm9yIGEgdG9rZW4KICAgICovCiAgICBmdW5jdGlvbiBnZXRUb2tlbkxheWVycyh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTZbXSkgewogICAgICAgIHJldHVybiB0b2tlbklkVG9MYXllcnNbX3Rva2VuSWRdOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGdpdmVuIGFuIGFycmF5IG9mIGlkcywgcmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGlzIGNvbXBvc2l0aW9uIGlzIHZhbGlkIGFuZCB1bmlxdWUKICAgICogZG9lcyBub3QgYXNzdW1lIHRoZSBsYXllcnMgYXJyYXkgaXMgZmxhdHRlbmVkIAogICAgKiBAcGFyYW0gX3Rva2VuSWRzIHVpbnQyNTZbXSBhbiBhcnJheSBvZiB0b2tlbiBJRHMKICAgICogQHJldHVybiBib29sIHdoZXRoZXIgb3Igbm90IHRoZSBjb21wb3NpdGlvbiBpcyB1bmlxdWUKICAgICovCiAgICBmdW5jdGlvbiBpc1ZhbGlkQ29tcG9zaXRpb24odWludDI1NltdIF90b2tlbklkcywgdWludDI1NiBfaW1hZ2VIYXNoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7IAogICAgICAgIGlmIChpc0NvbXBvc2l0aW9uT25seVdpdGhCYXNlTGF5ZXJzKSB7IAogICAgICAgICAgICByZXR1cm4gX2lzVmFsaWRCYXNlTGF5ZXJzT25seShfdG9rZW5JZHMsIF9pbWFnZUhhc2gpOwogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICByZXR1cm4gX2lzVmFsaWRXaXRoQ29tcG9zaXRpb25zKF90b2tlbklkcywgX2ltYWdlSGFzaCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IHJldHVybnMgY29tcG9zaXRpb24gcHJpY2Ugb2YgYSBnaXZlbiB0b2tlbiBJRAogICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiB0b2tlbiBJRAogICAgKiBAcmV0dXJuIHVpbnQyNTYgY29tcG9zaXRpb24gcHJpY2UKICAgICovCiAgICBmdW5jdGlvbiBnZXRDb21wb3NpdGlvblByaWNlKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgeyAKICAgICAgICByZXR1cm4gdG9rZW5JZFRvQ29tcG9zaXRpb25QcmljZVtfdG9rZW5JZF07CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgZ2V0IHRvdGFsIHByaWNlIGZvciBtaW50aW5nIGEgY29tcG9zaXRpb24gZ2l2ZW4gdGhlIGFycmF5IG9mIGRlc2lyZWQgbGF5ZXJzCiAgICAqIEBwYXJhbSBfdG9rZW5JZHMgdWludDI1NltdIGFuIGFycmF5IG9mIHRva2VuIElEcwogICAgKiBAcmV0dXJuIHVpbnQyNTYgcHJpY2UgZm9yIG1pbnRpbmcgYSBjb21wb3NpdGlvbiB3aXRoIHRoZSBkZXNpcmVkIGxheWVycwogICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvdGFsQ29tcG9zaXRpb25QcmljZSh1aW50MjU2W10gX3Rva2VuSWRzKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHRvdGFsQ29tcG9zaXRpb25QcmljZSA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3Rva2VuSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX3Rva2VuTGF5ZXJzRXhpc3QoX3Rva2VuSWRzW2ldKSk7CiAgICAgICAgICAgIHRvdGFsQ29tcG9zaXRpb25QcmljZSA9IFNhZmVNYXRoLmFkZCh0b3RhbENvbXBvc2l0aW9uUHJpY2UsIHRva2VuSWRUb0NvbXBvc2l0aW9uUHJpY2VbX3Rva2VuSWRzW2ldXSk7CiAgICAgICAgfQoKICAgICAgICB0b3RhbENvbXBvc2l0aW9uUHJpY2UgPSBTYWZlTWF0aC5kaXYoU2FmZU1hdGgubXVsKHRvdGFsQ29tcG9zaXRpb25QcmljZSwgMTA1KSwgMTAwKTsKCiAgICAgICAgcmV0dXJuIHRvdGFsQ29tcG9zaXRpb25QcmljZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBzZXRzIHRoZSBjb21wb3NpdGlvbiBwcmljZSBmb3IgYSB0b2tlbiBJRC4gCiAgICAqIENhbm5vdCBiZSBsb3dlciB0aGFuIHRoZSBjdXJyZW50IGNvbXBvc2l0aW9uIGZlZQogICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiB0aGUgdG9rZW4gSUQKICAgICogQHBhcmFtIF9wcmljZSB1aW50MjU2IHRoZSBuZXcgY29tcG9zaXRpb24gcHJpY2UKICAgICovCiAgICBmdW5jdGlvbiBzZXRDb21wb3NpdGlvblByaWNlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3ByaWNlKSBwdWJsaWMgb25seU93bmVyT2YoX3Rva2VuSWQpIHsKICAgICAgICBfc2V0Q29tcG9zaXRpb25QcmljZShfdG9rZW5JZCwgX3ByaWNlKTsKICAgIH0KCi8vIC0tLS0tIFBSSVZBVEUgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8qKgogICAgKiBAZGV2IGdpdmVuIGFuIGFycmF5IG9mIGlkcywgcmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGlzIGNvbXBvc2l0aW9uIGlzIHZhbGlkIGFuZCB1bmlxdWUKICAgICogZm9yIHdoZW4gb25seSBiYXNlIGxheWVycyBhcmUgYWxsb3dlZAogICAgKiBkb2VzIG5vdCBhc3N1bWUgdGhlIGxheWVycyBhcnJheSBpcyBmbGF0dGVuZWQgCiAgICAqIEBwYXJhbSBfdG9rZW5JZHMgdWludDI1NltdIGFuIGFycmF5IG9mIHRva2VuIElEcwogICAgKiBAcmV0dXJuIGJvb2wgd2hldGhlciBvciBub3QgdGhlIGNvbXBvc2l0aW9uIGlzIHVuaXF1ZQogICAgKi8KICAgIGZ1bmN0aW9uIF9pc1ZhbGlkQmFzZUxheWVyc09ubHkodWludDI1NltdIF90b2tlbklkcywgdWludDI1NiBfaW1hZ2VIYXNoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgeyAKICAgICAgICByZXF1aXJlKF90b2tlbklkcy5sZW5ndGggPD0gTUFYX0xBWUVSUyk7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBsYXllcnMgPSBuZXcgdWludDI1NltdKF90b2tlbklkcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfdG9rZW5JZHMubGVuZ3RoOyBpKyspIHsgCiAgICAgICAgICAgIGlmICghX3Rva2VuTGF5ZXJzRXhpc3QoX3Rva2VuSWRzW2ldKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG9rZW5JZFRvTGF5ZXJzW190b2tlbklkc1tpXV0ubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh1aW50IGsgPSAwOyBrIDwgbGF5ZXJzLmxlbmd0aDsgaysrKSB7IAogICAgICAgICAgICAgICAgaWYgKGxheWVyc1trXSA9PSB0b2tlbklkVG9MYXllcnNbX3Rva2VuSWRzW2ldXVswXSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsYXllcnNba10gPT0gMCkgeyAKICAgICAgICAgICAgICAgICAgICBsYXllcnNba10gPSB0b2tlbklkVG9MYXllcnNbX3Rva2VuSWRzW2ldXVswXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIAogICAgICAgIHJldHVybiBfaXNVbmlxdWUobGF5ZXJzLCBfaW1hZ2VIYXNoKTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBnaXZlbiBhbiBhcnJheSBvZiBpZHMsIHJldHVybnMgd2hldGhlciBvciBub3QgdGhpcyBjb21wb3NpdGlvbiBpcyB2YWxpZCBhbmQgdW5pcXVlCiAgICAqIHdoZW4gY29tcG9zaXRpb25zIGFyZSBhbGxvd2VkCiAgICAqIGRvZXMgbm90IGFzc3VtZSB0aGUgbGF5ZXJzIGFycmF5IGlzIGZsYXR0ZW5lZCAKICAgICogQHBhcmFtIF90b2tlbklkcyB1aW50MjU2W10gYW4gYXJyYXkgb2YgdG9rZW4gSURzCiAgICAqIEByZXR1cm4gYm9vbCB3aGV0aGVyIG9yIG5vdCB0aGUgY29tcG9zaXRpb24gaXMgdW5pcXVlCiAgICAqLwogICAgZnVuY3Rpb24gX2lzVmFsaWRXaXRoQ29tcG9zaXRpb25zKHVpbnQyNTZbXSBfdG9rZW5JZHMsIHVpbnQyNTYgX2ltYWdlSGFzaCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsgCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBsYXllcnMgPSBuZXcgdWludDI1NltdKE1BWF9MQVlFUlMpOwogICAgICAgIHVpbnQgYWN0dWFsU2l6ZSA9IDA7IAogICAgICAgIGlmIChfdG9rZW5JZHMubGVuZ3RoID4gTUFYX0xBWUVSUykgeyAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3Rva2VuSWRzLmxlbmd0aDsgaSsrKSB7IAogICAgICAgICAgICB1aW50MjU2IGNvbXBvc2l0aW9uTGF5ZXJJZCA9IF90b2tlbklkc1tpXTsKICAgICAgICAgICAgaWYgKCFfdG9rZW5MYXllcnNFeGlzdChjb21wb3NpdGlvbkxheWVySWQpKSB7IAogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgaW5oZXJpdGVkTGF5ZXJzID0gdG9rZW5JZFRvTGF5ZXJzW2NvbXBvc2l0aW9uTGF5ZXJJZF07CiAgICAgICAgICAgIHJlcXVpcmUoaW5oZXJpdGVkTGF5ZXJzLmxlbmd0aCA8IE1BWF9MQVlFUlMpOwogICAgICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCBpbmhlcml0ZWRMYXllcnMubGVuZ3RoOyBqKyspIHsgCiAgICAgICAgICAgICAgICByZXF1aXJlKGFjdHVhbFNpemUgPCBNQVhfTEFZRVJTKTsKICAgICAgICAgICAgICAgIGZvciAodWludCBrID0gMDsgayA8IGxheWVycy5sZW5ndGg7IGsrKykgeyAKICAgICAgICAgICAgICAgICAgICBpZiAobGF5ZXJzW2tdID09IGluaGVyaXRlZExheWVyc1tqXSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChsYXllcnNba10gPT0gMCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGF5ZXJzW2FjdHVhbFNpemVdID0gaW5oZXJpdGVkTGF5ZXJzW2pdOwogICAgICAgICAgICAgICAgYWN0dWFsU2l6ZSArPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfaXNVbmlxdWUoX3RyaW0obGF5ZXJzLCBhY3R1YWxTaXplKSwgX2ltYWdlSGFzaCk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgdHJpbXMgdGhlIGdpdmVuIGFycmF5IHRvIGEgZ2l2ZW4gc2l6ZQogICAgKiBAcGFyYW0gX2xheWVycyB1aW50MjU2W10gdGhlIGFycmF5IG9mIGxheWVycyB0aGF0IHdpbGwgbWFrZSB1cCB0aGUgY29tcG9zaXRpb24KICAgICogQHBhcmFtIF9zaXplIHVpbnQgdGhlIGFycmF5IG9mIGxheWVycyB0aGF0IHdpbGwgbWFrZSB1cCB0aGUgY29tcG9zaXRpb24KICAgICogQHJldHVybiB1aW50MjU2W10gYXJyYXkgdHJpbW1lZCB0byBnaXZlbiBzaXplCiAgICAqLwogICAgZnVuY3Rpb24gX3RyaW0odWludDI1NltdIF9sYXllcnMsIHVpbnQgX3NpemUpIHByaXZhdGUgcHVyZSByZXR1cm5zKHVpbnQyNTZbXSkgeyAKICAgICAgICB1aW50MjU2W10gbWVtb3J5IHRyaW1tZWRMYXllcnMgPSBuZXcgdWludDI1NltdKF9zaXplKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfc2l6ZTsgaSsrKSB7IAogICAgICAgICAgICB0cmltbWVkTGF5ZXJzW2ldID0gX2xheWVyc1tpXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cmltbWVkTGF5ZXJzOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IGNoZWNrcyBpZiBhIHRva2VuIGlzIGFuIGV4aXN0aW5nIHRva2VuIGJ5IGNoZWNraW5nIGlmIGl0IGhhcyBub24temVybyBsYXllcnMKICAgICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgdG9rZW4gSUQKICAgICogQHJldHVybiBib29sIHdoZXRoZXIgb3Igbm90IHRoZSBnaXZlbiB0b2tlbklkIGV4aXN0cyBhY2NvcmRpbmcgdG8gaXRzIGxheWVycwogICAgKi8KICAgIGZ1bmN0aW9uIF90b2tlbkxheWVyc0V4aXN0KHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7IAogICAgICAgIHJldHVybiB0b2tlbklkVG9MYXllcnNbX3Rva2VuSWRdLmxlbmd0aCAhPSAwOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IHNldCBjb21wb3NpdGlvbiBwcmljZSBmb3IgYSB0b2tlbgogICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiB0b2tlbiBJRAogICAgKiBAcGFyYW0gX3ByaWNlIHVpbnQyNTYgbmV3IGNvbXBvc2l0aW9uIHByaWNlCiAgICAqLwogICAgZnVuY3Rpb24gX3NldENvbXBvc2l0aW9uUHJpY2UodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfcHJpY2UpIHByaXZhdGUgewogICAgICAgIHJlcXVpcmUoX3ByaWNlID49IG1pbkNvbXBvc2l0aW9uRmVlKTsKICAgICAgICB0b2tlbklkVG9Db21wb3NpdGlvblByaWNlW190b2tlbklkXSA9IF9wcmljZTsKICAgICAgICBDb21wb3NpdGlvblByaWNlQ2hhbmdlZChfdG9rZW5JZCwgX3ByaWNlLCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBjYWxjdWxhdGVzIHRoZSBuZXh0IHRva2VuIElEIGJhc2VkIG9uIHRvdGFsU3VwcGx5CiAgICAqIEByZXR1cm4gdWludDI1NiBmb3IgdGhlIG5leHQgdG9rZW4gSUQKICAgICovCiAgICBmdW5jdGlvbiBfZ2V0TmV4dFRva2VuSWQoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseSgpLmFkZCgxKTsgCiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgZ2l2ZW4gYW4gYXJyYXkgb2YgaWRzLCByZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoaXMgY29tcG9zaXRpb24gaXMgdW5pcXVlCiAgICAqIGFzc3VtZXMgdGhlIGxheWVycyBhcmUgYWxsIGJhc2UgbGF5ZXJzIChmbGF0dGVuZWQpCiAgICAqIEBwYXJhbSBfbGF5ZXJzIHVpbnQyNTZbXSBhbiBhcnJheSBvZiB0b2tlbiBJRHMKICAgICogQHBhcmFtIF9pbWFnZUhhc2ggdWludDI1NiBpbWFnZSBoYXNoIGZvciB0aGUgY29tcG9zaXRpb24KICAgICogQHJldHVybiBib29sIHdoZXRoZXIgb3Igbm90IHRoZSBjb21wb3NpdGlvbiBpcyB1bmlxdWUKICAgICovCiAgICBmdW5jdGlvbiBfaXNVbmlxdWUodWludDI1NltdIF9sYXllcnMsIHVpbnQyNTYgX2ltYWdlSGFzaCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsgCiAgICAgICAgcmV0dXJuIGNvbXBvc2l0aW9uc1trZWNjYWsyNTYoX2xheWVycyldID09IGZhbHNlICYmIGltYWdlSGFzaGVzW19pbWFnZUhhc2hdID09IDA7CiAgICB9CgovLyAtLS0tLSBPTkxZIE9XTkVSIEZVTkNUSU9OUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgICogQGRldiBwYXlvdXQgbWV0aG9kIGZvciB0aGUgY29udHJhY3Qgb3duZXIgdG8gcGF5b3V0IGNvbnRyYWN0IHByb2ZpdHMgdG8gYSBnaXZlbiBhZGRyZXNzCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBmb3IgdGhlIHBheW91dCAKICAgICovCiAgICBmdW5jdGlvbiBwYXlvdXQgKGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgdG90YWxQYXltZW50cyA9IDA7CiAgICAgICAgX3RvLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgc2V0cyBnbG9iYWwgZGVmYXVsdCBjb21wb3NpdGlvbiBmZWUgZm9yIGFsbCBuZXcgdG9rZW5zCiAgICAqIEBwYXJhbSBfcHJpY2UgdWludDI1NiBuZXcgZGVmYXVsdCBjb21wb3NpdGlvbiBwcmljZQogICAgKi8KICAgIGZ1bmN0aW9uIHNldEdsb2JhbENvbXBvc2l0aW9uRmVlKHVpbnQyNTYgX3ByaWNlKSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgbWluQ29tcG9zaXRpb25GZWUgPSBfcHJpY2U7CiAgICB9Cn0KCmNvbnRyYWN0IEV0aG1vamkgaXMgQ29tcG9zYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IE5BTUUgPSAiRXRobW9qaSI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFNZTUJPTCA9ICJFTUoiOwoKICAgIC8vIE1hcHBpbmcgZnJvbSBhZGRyZXNzIHRvIGVtb2ppIHJlcHJlc2VudGluZyBhdmF0YXIKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFkZHJlc3NUb0F2YXRhcjsKCiAgICBmdW5jdGlvbiBFdGhtb2ppKCkgcHVibGljIHsgCiAgICAgICAgaXNDb21wb3NpdGlvbk9ubHlXaXRoQmFzZUxheWVycyA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgTWludHMgYSBiYXNlIHRva2VuIHRvIGFuIGFkZHJlc3Mgd2l0aCBhIGdpdmVuIGNvbXBvc2l0aW9uIHByaWNlCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBvZiB0aGUgZnV0dXJlIG93bmVyIG9mIHRoZSB0b2tlbgogICAgKiBAcGFyYW0gX2NvbXBvc2l0aW9uUHJpY2UgdWludDI1NiBjb21wb3NpdGlvbiBwcmljZSBmb3IgdGhlIG5ldyB0b2tlbgogICAgKi8KICAgIGZ1bmN0aW9uIG1pbnRUbyhhZGRyZXNzIF90bywgdWludDI1NiBfY29tcG9zaXRpb25QcmljZSwgdWludDI1NiBfaW1hZ2VIYXNoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBDb21wb3NhYmxlLm1pbnRUbyhfdG8sIF9jb21wb3NpdGlvblByaWNlLCBfaW1hZ2VIYXNoKTsKICAgICAgICBfc2V0QXZhdGFySWZOb0F2YXRhcklzU2V0KF90bywgdG9rZW5zT2YoX3RvKVswXSk7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgTWludHMgYSBjb21wb3NpdGlvbiBlbW9qaQogICAgKiBAcGFyYW0gX3Rva2VuSWRzIHVpbnQyNTZbXSB0aGUgYXJyYXkgb2YgbGF5ZXJzIHRoYXQgd2lsbCBtYWtlIHVwIHRoZSBjb21wb3NpdGlvbgogICAgKi8KICAgIGZ1bmN0aW9uIGNvbXBvc2UodWludDI1NltdIF90b2tlbklkcywgIHVpbnQyNTYgX2ltYWdlSGFzaCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgQ29tcG9zYWJsZS5jb21wb3NlKF90b2tlbklkcywgX2ltYWdlSGFzaCk7CiAgICAgICAgX3NldEF2YXRhcklmTm9BdmF0YXJJc1NldChtc2cuc2VuZGVyLCB0b2tlbnNPZihtc2cuc2VuZGVyKVswXSk7CgoKICAgICAgICAvLyBJbW1lZGlhdGVseSBwYXkgb3V0IHRvIGxheWVyIG93bmVycwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBfdG9rZW5JZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgX3dpdGhkcmF3VG8ob3duZXJPZihfdG9rZW5JZHNbaV0pKTsKICAgICAgICB9CiAgICB9CgovLyAtLS0tLSBFWFBPU0VEIE1FVEhPRFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgICogQGRldiByZXR1cm5zIHRoZSBuYW1lIEVUSE1PSkkKICAgICogQHJldHVybiBzdHJpbmcgRVRITU9KSQogICAgKi8KICAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gTkFNRTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiByZXR1cm5zIHRoZSBuYW1lIEVNSgogICAgKiBAcmV0dXJuIHN0cmluZyBFTUoKICAgICovCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gU1lNQk9MOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IHNldHMgYXZhdGFyIGZvciBhbiBhZGRyZXNzCiAgICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IHRva2VuIElECiAgICAqLwogICAgZnVuY3Rpb24gc2V0QXZhdGFyKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBvbmx5T3duZXJPZihfdG9rZW5JZCkgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgYWRkcmVzc1RvQXZhdGFyW21zZy5zZW5kZXJdID0gX3Rva2VuSWQ7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgcmV0dXJucyB0aGUgSUQgcmVwcmVzZW50aW5nIHRoZSBhdmF0YXIgb2YgdGhlIGFkZHJlc3MKICAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzCiAgICAqIEByZXR1cm4gdWludDI1NiB0b2tlbiBJRCBvZiB0aGUgYXZhdGFyIGFzc29jaWF0ZWQgd2l0aCB0aGF0IGFkZHJlc3MKICAgICovCiAgICBmdW5jdGlvbiBnZXRBdmF0YXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBhZGRyZXNzVG9BdmF0YXJbX293bmVyXTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uIGtlZXBzIHRyYWNrIG9mIGF2YXRhciBsb2dpYwogICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gd2hvbSB0aGUgdG9rZW4gaXMgYmVpbmcgdHJhbnNmZXJyZWQgdG8KICAgICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgdGhlIElEIG9mIHRoZSB0b2tlbiBiZWluZyB0cmFuc2ZlcnJlZAogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgb25seU93bmVyT2YoX3Rva2VuSWQpIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIElmIHRoZSB0cmFuc2ZlcnJlZCB0b2tlbiB3YXMgcHJldmlvdXMgb3duZXIncyBhdmF0YXIsIHJlbW92ZSBpdAogICAgICAgIGlmIChhZGRyZXNzVG9BdmF0YXJbbXNnLnNlbmRlcl0gPT0gX3Rva2VuSWQpIHsKICAgICAgICAgICAgX3JlbW92ZUF2YXRhcihtc2cuc2VuZGVyKTsKICAgICAgICB9CgogICAgICAgIEVSQzcyMVRva2VuLnRyYW5zZmVyKF90bywgX3Rva2VuSWQpOwogICAgfQoKLy8gLS0tLS0gUFJJVkFURSBGVU5DVElPTlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLyoqCiAgICAqIEBkZXYgc2V0cyBhdmF0YXIgaWYgbm8gYXZhdGFyIHdhcyBwcmV2aW91c2x5IHNldAogICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgdGhlIG5ldyB2YXRhcmEgb3duZXIKICAgICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgdG9rZW4gSUQKICAgICovCiAgICBmdW5jdGlvbiBfc2V0QXZhdGFySWZOb0F2YXRhcklzU2V0KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgICAgICBpZiAoYWRkcmVzc1RvQXZhdGFyW19vd25lcl0gPT0gMCkgewogICAgICAgICAgICBhZGRyZXNzVG9BdmF0YXJbX293bmVyXSA9IF90b2tlbklkOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogQGRldiByZW1vdmVzIGF2YXRhciBmb3IgYWRkcmVzcwogICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgdGhlIGF2YXRhciBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdmF0YXIoYWRkcmVzcyBfb3duZXIpIHByaXZhdGUgewogICAgICAgIGFkZHJlc3NUb0F2YXRhcltfb3duZXJdID0gMDsKICAgIH0KCiAgICAvKioKICAgICogQGRldiB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlIHRvIHRoZSBwYXllZQogICAgKiBAcGFyYW0gX3BheWVlIGFkZHJlc3MgdG8gd2hpY2ggdG8gd2l0aGRyYXcgdG8KICAgICovCiAgICBmdW5jdGlvbiBfd2l0aGRyYXdUbyhhZGRyZXNzIF9wYXllZSkgcHJpdmF0ZSB7CiAgICAgICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbX3BheWVlXTsKCiAgICAgICAgaWYgKHBheW1lbnQgIT0gMCAmJiB0aGlzLmJhbGFuY2UgPj0gcGF5bWVudCkgewogICAgICAgICAgICB0b3RhbFBheW1lbnRzID0gdG90YWxQYXltZW50cy5zdWIocGF5bWVudCk7CiAgICAgICAgICAgIHBheW1lbnRzW19wYXllZV0gPSAwOwoKICAgICAgICAgICAgX3BheWVlLnRyYW5zZmVyKHBheW1lbnQpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
