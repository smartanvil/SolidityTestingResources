Class {
	#name : #SRTd023E93E919a1a0ef7D2323eDC72A134e6b635A2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd023E93E919a1a0ef7D2323eDC72A134e6b635A2 >> base64 [
	^ 'Ly9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwQmFzaWMuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL3plcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy9tYXRoL1NhZmVNYXRoLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvdG9rZW4vQmFzaWNUb2tlbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL3Rva2VuL0VSQzIwLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvdG9rZW4vU3RhbmRhcmRUb2tlbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IERlY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3N1YnRyYWN0ZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBkZWNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvb3duZXJzaGlwL093bmFibGUuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL3plcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9NaW50YWJsZVRva2VuLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCgoKCi8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKiBAZGV2IElzc3VlOiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvaXNzdWVzLzEyMAogKiBCYXNlZCBvbiBjb2RlIGJ5IFRva2VuTWFya2V0TmV0OiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAogKi8KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvY3Jvd2RzYWxlL0Nyb3dkc2FsZS5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgovKioKICogQHRpdGxlIENyb3dkc2FsZQogKiBAZGV2IENyb3dkc2FsZSBpcyBhIGJhc2UgY29udHJhY3QgZm9yIG1hbmFnaW5nIGEgdG9rZW4gY3Jvd2RzYWxlLgogKiBDcm93ZHNhbGVzIGhhdmUgYSBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMsIHdoZXJlIGludmVzdG9ycyBjYW4gbWFrZQogKiB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKICogb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0CiAqIGFzIHRoZXkgYXJyaXZlLgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICBNaW50YWJsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKCiAgLy8gYWRkcmVzcyB3aGVyZSBmdW5kcyBhcmUgY29sbGVjdGVkCiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogIHVpbnQyNTYgcHVibGljIHJhdGU7CgogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwoKICAvKioKICAgKiBldmVudCBmb3IgdG9rZW4gcHVyY2hhc2UgbG9nZ2luZwogICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICogQHBhcmFtIHZhbHVlIHdlaXMgcGFpZCBmb3IgcHVyY2hhc2UKICAgKiBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICovCiAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCgogIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCkgcHVibGljIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKCiAgICB0b2tlbiA9IGNyZWF0ZVRva2VuQ29udHJhY3QoKTsKICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICByYXRlID0gX3JhdGU7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogIH0KCiAgLy8gY3JlYXRlcyB0aGUgdG9rZW4gdG8gYmUgc29sZC4KICAvLyBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBoYXZlIGNyb3dkc2FsZSBvZiBhIHNwZWNpZmljIG1pbnRhYmxlIHRva2VuLgogIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICByZXR1cm4gbmV3IE1pbnRhYmxlVG9rZW4oKTsKICB9CgoKICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKTsKCiAgICAvLyB1cGRhdGUgc3RhdGUKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgIGZvcndhcmRGdW5kcygpOwogIH0KCiAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogIC8vIG92ZXJyaWRlIHRvIGNyZWF0ZSBjdXN0b20gZnVuZCBmb3J3YXJkaW5nIG1lY2hhbmlzbXMKICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2U7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQoKCn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL3plcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9TYWZlRVJDMjAuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvdG9rZW4vVG9rZW5WZXN0aW5nLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCgoKLyoqCiAqIEB0aXRsZSBUb2tlblZlc3RpbmcKICogQGRldiBBIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IGNhbiByZWxlYXNlIGl0cyB0b2tlbiBiYWxhbmNlIGdyYWR1YWxseSBsaWtlIGEKICogdHlwaWNhbCB2ZXN0aW5nIHNjaGVtZSwgd2l0aCBhIGNsaWZmIGFuZCB2ZXN0aW5nIHBlcmlvZC4gT3B0aW9uYWxseSByZXZvY2FibGUgYnkgdGhlCiAqIG93bmVyLgogKi8KY29udHJhY3QgVG9rZW5WZXN0aW5nIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgZXZlbnQgUmVsZWFzZWQodWludDI1NiBhbW91bnQpOwogIGV2ZW50IFJldm9rZWQoKTsKCiAgLy8gYmVuZWZpY2lhcnkgb2YgdG9rZW5zIGFmdGVyIHRoZXkgYXJlIHJlbGVhc2VkCiAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CgogIHVpbnQyNTYgcHVibGljIGNsaWZmOwogIHVpbnQyNTYgcHVibGljIHN0YXJ0OwogIHVpbnQyNTYgcHVibGljIGR1cmF0aW9uOwoKICBib29sIHB1YmxpYyByZXZvY2FibGU7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlbGVhc2VkOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJldm9rZWQ7CgogIC8qKgogICAqIEBkZXYgQ3JlYXRlcyBhIHZlc3RpbmcgY29udHJhY3QgdGhhdCB2ZXN0cyBpdHMgYmFsYW5jZSBvZiBhbnkgRVJDMjAgdG9rZW4gdG8gdGhlCiAgICogX2JlbmVmaWNpYXJ5LCBncmFkdWFsbHkgaW4gYSBsaW5lYXIgZmFzaGlvbiB1bnRpbCBfc3RhcnQgKyBfZHVyYXRpb24uIEJ5IHRoZW4gYWxsCiAgICogb2YgdGhlIGJhbGFuY2Ugd2lsbCBoYXZlIHZlc3RlZC4KICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IGFkZHJlc3Mgb2YgdGhlIGJlbmVmaWNpYXJ5IHRvIHdob20gdmVzdGVkIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgKiBAcGFyYW0gX2NsaWZmIGR1cmF0aW9uIGluIHNlY29uZHMgb2YgdGhlIGNsaWZmIGluIHdoaWNoIHRva2VucyB3aWxsIGJlZ2luIHRvIHZlc3QKICAgKiBAcGFyYW0gX2R1cmF0aW9uIGR1cmF0aW9uIGluIHNlY29uZHMgb2YgdGhlIHBlcmlvZCBpbiB3aGljaCB0aGUgdG9rZW5zIHdpbGwgdmVzdAogICAqIEBwYXJhbSBfcmV2b2NhYmxlIHdoZXRoZXIgdGhlIHZlc3RpbmcgaXMgcmV2b2NhYmxlIG9yIG5vdAogICAqLwogIGZ1bmN0aW9uIFRva2VuVmVzdGluZyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3RhcnQsIHVpbnQyNTYgX2NsaWZmLCB1aW50MjU2IF9kdXJhdGlvbiwgYm9vbCBfcmV2b2NhYmxlKSBwdWJsaWMgewogICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF9jbGlmZiA8PSBfZHVyYXRpb24pOwoKICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogICAgcmV2b2NhYmxlID0gX3Jldm9jYWJsZTsKICAgIGR1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgY2xpZmYgPSBfc3RhcnQuYWRkKF9jbGlmZik7CiAgICBzdGFydCA9IF9zdGFydDsKICB9CgogIC8qKgogICAqIEBub3RpY2UgVHJhbnNmZXJzIHZlc3RlZCB0b2tlbnMgdG8gYmVuZWZpY2lhcnkuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHsKICAgIHVpbnQyNTYgdW5yZWxlYXNlZCA9IHJlbGVhc2FibGVBbW91bnQodG9rZW4pOwoKICAgIHJlcXVpcmUodW5yZWxlYXNlZCA+IDApOwoKICAgIHJlbGVhc2VkW3Rva2VuXSA9IHJlbGVhc2VkW3Rva2VuXS5hZGQodW5yZWxlYXNlZCk7CgogICAgdG9rZW4uc2FmZVRyYW5zZmVyKGJlbmVmaWNpYXJ5LCB1bnJlbGVhc2VkKTsKCiAgICBSZWxlYXNlZCh1bnJlbGVhc2VkKTsKICB9CgogIC8qKgogICAqIEBub3RpY2UgQWxsb3dzIHRoZSBvd25lciB0byByZXZva2UgdGhlIHZlc3RpbmcuIFRva2VucyBhbHJlYWR5IHZlc3RlZAogICAqIHJlbWFpbiBpbiB0aGUgY29udHJhY3QsIHRoZSByZXN0IGFyZSByZXR1cm5lZCB0byB0aGUgb3duZXIuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJldm9rZShFUkMyMEJhc2ljIHRva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUocmV2b2NhYmxlKTsKICAgIHJlcXVpcmUoIXJldm9rZWRbdG9rZW5dKTsKCiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CgogICAgdWludDI1NiB1bnJlbGVhc2VkID0gcmVsZWFzYWJsZUFtb3VudCh0b2tlbik7CiAgICB1aW50MjU2IHJlZnVuZCA9IGJhbGFuY2Uuc3ViKHVucmVsZWFzZWQpOwoKICAgIHJldm9rZWRbdG9rZW5dID0gdHJ1ZTsKCiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIHJlZnVuZCk7CgogICAgUmV2b2tlZCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGVzIHRoZSBhbW91bnQgdGhhdCBoYXMgYWxyZWFkeSB2ZXN0ZWQgYnV0IGhhc24ndCBiZWVuIHJlbGVhc2VkIHlldC4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzYWJsZUFtb3VudChFUkMyMEJhc2ljIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdmVzdGVkQW1vdW50KHRva2VuKS5zdWIocmVsZWFzZWRbdG9rZW5dKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkLgogICAqIEBwYXJhbSB0b2tlbiBFUkMyMCB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiB2ZXN0ZWRBbW91bnQoRVJDMjBCYXNpYyB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjdXJyZW50QmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHVpbnQyNTYgdG90YWxCYWxhbmNlID0gY3VycmVudEJhbGFuY2UuYWRkKHJlbGVhc2VkW3Rva2VuXSk7CgogICAgaWYgKG5vdyA8IGNsaWZmKSB7CiAgICAgIHJldHVybiAwOwogICAgfSBlbHNlIGlmIChub3cgPj0gc3RhcnQuYWRkKGR1cmF0aW9uKSB8fCByZXZva2VkW3Rva2VuXSkgewogICAgICByZXR1cm4gdG90YWxCYWxhbmNlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZS5tdWwobm93LnN1YihzdGFydCkpLmRpdihkdXJhdGlvbik7CiAgICB9CiAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy96ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvbGlmZWN5Y2xlL1BhdXNhYmxlLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL3plcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy90b2tlbi9QYXVzYWJsZVRva2VuLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUgdG9rZW4KICoKICogQGRldiBTdGFuZGFyZFRva2VuIG1vZGlmaWVkIHdpdGggcGF1c2FibGUgdHJhbnNmZXJzLgogKiovCgpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICB9Cn0KCi8vRmlsZTogc3JjL2NvbnRyYWN0cy9pY28vTXRuVG9rZW4uc29sCi8qKgogKiBAdGl0bGUgTVROIHRva2VuCiAqCiAqIEB2ZXJzaW9uIDEuMAogKiBAYXV0aG9yIFZhbGlkaXR5IExhYnMgQUcgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJjMWE4YWZhN2FlODFiN2EwYWRhOGE1YThiNWI4YWRhMGEzYjJlZmFlYjNhNiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CiAqLwpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCgoKCmNvbnRyYWN0IE10blRva2VuIGlzIE1pbnRhYmxlVG9rZW4sIFBhdXNhYmxlVG9rZW4gewogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIk1lZCBUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJNVE4iOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnN0cnVjdG9yIG9mIE10blRva2VuIHRoYXQgaW5zdGFudGlhdGVzIGEgbmV3IE1pbnRhYmxlIFBhdXNlYWJsZSBUb2tlbgogICAgICovCiAgICBmdW5jdGlvbiBNdG5Ub2tlbigpIHB1YmxpYyB7CiAgICAgICAgLy8gdG9rZW4gc2hvdWxkIG5vdCBiZSB0cmFuc2ZlcnJhYmxlIHVudGlsIGFmdGVyIGFsbCB0b2tlbnMgaGF2ZSBiZWVuIGlzc3VlZAogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9Cn0KCi8vRmlsZTogc3JjL2NvbnRyYWN0cy9pY28vTXRuQ3Jvd2RzYWxlLnNvbAovKioKICogQHRpdGxlIE10bkNyb3dkc2FsZQogKgogKiBTaW1wbGUgdGltZSBhbmQgVE9LRU5fQ0FQcGVkIGJhc2VkIGNyb3dkc2FsZS4KICoKICogQHZlcnNpb24gMS4wCiAqIEBhdXRob3IgVmFsaWRpdHkgTGFicyBBRyA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjBiNjI2NTZkNjQ0YjdkNmE2NzYyNmY2MjdmNzI2NzZhNjk3ODI1NjQ3OTZjIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICovCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCgoKCgpjb250cmFjdCBNdG5Dcm93ZHNhbGUgaXMgT3duYWJsZSwgQ3Jvd2RzYWxlIHsKICAgIC8qKiogQ09OU1RBTlRTICoqKi8KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPVEFMX1RPS0VOX0NBUCA9IDUwMGU2ICogMWUxODsgICAvLyA1MDAgbWlsbGlvbiAqIDFlMTggLSBzbWFsbGVzdCB1bml0IG9mIE1UTiB0b2tlbgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQ1JPV0RTQUxFX1RPS0VOUyA9IDE3NWU2ICogMWUxODsgIC8vIDE3NSBtaWxsaW9uICogMWUxOCAtIHByZXNhbGUgYW5kIGNyb3dkc2FsZSB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPVEFMX1RFQU1fVE9LRU5TID0gMTcwZTYgKiAxZTE4OyAvLyAxNzAgbWlsbGlvbiAqIDFlMTggLSB0ZWFtIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVEVBTV9UT0tFTlMwID0gNTBlNiAqIDFlMTg7ICAgICAgIC8vIDUwIG1pbGxpb24gKiAxZTE4IC0gdGVhbSB0b2tlbnMsIGFscmVhZHkgdmVzdGVkCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBURUFNX1RPS0VOUzEgPSA2MGU2ICogMWUxODsgICAgICAgLy8gNjAgbWlsbGlvbiAqIDFlMTggLSB0ZWFtIHRva2VucywgdmVzdGluZyBvdmVyIDIgeWVhcnMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRFQU1fVE9LRU5TMiA9IDYwZTYgKiAxZTE4OyAgICAgICAvLyA2MCBtaWxsaW9uICogMWUxOCAtIHRlYW0gdG9rZW5zLCB2ZXN0aW5nIG92ZXIgNCB5ZWFycwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQ09NTVVOSVRZX1RPS0VOUyA9IDE1NWU2ICogMWUxODsgIC8vIDE1NSBtaWxsaW9uICogMWUxOCAtIGNvbW11bml0eSB0b2tlbnMsIHZlc3Rpbmcgb3ZlciA0IHllYXJzCgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUFYX0NPTlRSSUJVVElPTl9VU0QgPSA1MDAwOyAgICAgIC8vICBVU0QKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFVTRF9DRU5UX1BFUl9UT0tFTiA9IDI1OyAgICAgICAgICAvLyBpbiBjZW50cyAtIHNtYWxsZXN0IHVuaXQgb2YgVVNEIEUuZy4gMTAwID0gMSBVU0QKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBWRVNUSU5HX0RVUkFUSU9OXzRZID0gNCB5ZWFyczsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFZFU1RJTkdfRFVSQVRJT05fMlkgPSAyIHllYXJzOwoKICAgIC8vIHRydWUgaWYgYWRkcmVzcyBpcyBhbGxvd2VkIHRvIGludmVzdAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc1doaXRlbGlzdGVkOwoKICAgIC8vIGFsbG93IG1hbmFnZXJzIHRvIHdoaXRlbGlzdCBhbmQgY29uZmlybSBjb250cmlidXRpb25zIGJ5IG1hbmFnZXIgYWNjb3VudHMKICAgIC8vIG1hbmFnZXJzIGNhbiBiZSBzZXQgYW5kIGFsdGVyZWQgYnkgb3duZXIsIG11bHRpcGxlIG1hbmFnZXIgYWNjb3VudHMgYXJlIHBvc3NpYmxlCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzTWFuYWdlcjsKCiAgICB1aW50MjU2IHB1YmxpYyBtYXhDb250cmlidXRpb25JbldlaTsKICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc01pbnRlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxyZWFkeSBtaW50ZWQgdG9rZW5zIChtYXhpbWFsbHkgPSBUT0tFTl9DQVApCiAgICBib29sIHB1YmxpYyBjYXBSZWFjaGVkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB0byB0cnVlIHdoZW4gY2FwIGhhcyBiZWVuIHJlYWNoZWQgd2hlbiBtaW50aW5nIHRva2VucwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b3RhbEludmVzdGVkUGVyQWRkcmVzczsKCiAgICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeVdhbGxldDsKCiAgICAvLyBmb3IgY29udmVuaWVuY2Ugd2Ugc3RvcmUgdmVzdGluZyB3YWxsZXRzCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtVmVzdGluZzJZZWFyczsKICAgIGFkZHJlc3MgcHVibGljIHRlYW1WZXN0aW5nNFllYXJzOwogICAgYWRkcmVzcyBwdWJsaWMgY29tbXVuaXR5VmVzdGluZzRZZWFyczsKCiAgICAvKioqIFRyYWNraW5nIENyb3dkc2FsZSBTdGFnZXMgKioqLwogICAgYm9vbCBwdWJsaWMgaXNDcm93ZHNhbGVPdmVyOwoKICAgIC8qKiogRVZFTlRTICAqKiovCiAgICBldmVudCBDaGFuZ2VkTWFuYWdlcihhZGRyZXNzIG1hbmFnZXIsIGJvb2wgYWN0aXZlKTsKICAgIGV2ZW50IFByZXNhbGVNaW50ZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHRva2VuQW1vdW50KTsKICAgIGV2ZW50IENoYW5nZWRJbnZlc3RvcldoaXRlbGlzdGluZyhhZGRyZXNzIGluZGV4ZWQgaW52ZXN0b3IsIGJvb2wgd2hpdGVsaXN0ZWQpOwoKICAgIC8qKiogTU9ESUZJRVJTICoqKi8KICAgIG1vZGlmaWVyIG9ubHlNYW5hZ2VyKCkgewogICAgICAgIHJlcXVpcmUoaXNNYW5hZ2VyW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHRyeWluZyB0byBhY2NvbXBpc2ggdXNpbmcgYWxyZWFkeSBleGlzdGluZyB2YXJpYWJsZXMgdG8gZGV0ZXJtaW5lIHN0YWdlIC0gcHJldmVudHMgbWFudWFsIHVwZGF0aW5nIG9mIHRoZSBlbnVtIHN0YWdlIHN0YXRlcwogICAgbW9kaWZpZXIgb25seVByZXNhbGVQaGFzZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q3Jvd2RzYWxlUGhhc2UoKSB7CiAgICAgICAgcmVxdWlyZShub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8IGVuZFRpbWUgJiYgIWlzQ3Jvd2RzYWxlT3Zlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciByZXNwZWN0Q3Jvd2RzYWxlQ2FwKHVpbnQyNTYgX2Ftb3VudCkgewogICAgICAgIHJlcXVpcmUodG9rZW5zTWludGVkLmFkZChfYW1vdW50KSA8PSBDUk9XRFNBTEVfVE9LRU5TKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDcm93ZFNhbGVPdmVyKCkgewogICAgICAgIHJlcXVpcmUoaXNDcm93ZHNhbGVPdmVyIHx8IG5vdyA+IGVuZFRpbWUgfHwgY2FwUmVhY2hlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5VmFsaWRBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IERlcGxveSBNVE4gVG9rZW4gQ3Jvd2RzYWxlCiAgICAgKiBAcGFyYW0gX3N0YXJ0VGltZSB1aW50MjU2IFN0YXJ0IHRpbWUgb2YgdGhlIGNyb3dkc2FsZQogICAgICogQHBhcmFtIF9lbmRUaW1lIHVpbnQyNTYgRW5kIHRpbWUgb2YgdGhlIGNyb3dkc2FsZQogICAgICogQHBhcmFtIF91c2RQZXJFdGggdWludDI1NiBpc3N1ZWluZyByYXRlIHRva2VucyBwZXIgd2VpCiAgICAgKiBAcGFyYW0gX3dhbGxldCBhZGRyZXNzIFdhbGxldCBhZGRyZXNzIG9mIHRoZSBjcm93ZHNhbGUKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnlXYWxsZXQgYWRkcmVzcyB3YWxsZXQgaG9sZGluZyB0ZWFtIGFuZCBjb21tdW5pdHkgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIE10bkNyb3dkc2FsZSgKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsCiAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICB1aW50MjU2IF91c2RQZXJFdGgsCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2JlbmVmaWNpYXJ5V2FsbGV0CiAgICAgICAgKQogICAgICAgIENyb3dkc2FsZShfc3RhcnRUaW1lLCBfZW5kVGltZSwgKF91c2RQZXJFdGgubXVsKDFlMikpLmRpdihVU0RfQ0VOVF9QRVJfVE9LRU4pLCBfd2FsbGV0KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlWYWxpZEFkZHJlc3MoX2JlbmVmaWNpYXJ5V2FsbGV0KQogICAgewogICAgICAgIHJlcXVpcmUoVE9UQUxfVE9LRU5fQ0FQID09IENST1dEU0FMRV9UT0tFTlMuYWRkKFRPVEFMX1RFQU1fVE9LRU5TKS5hZGQoQ09NTVVOSVRZX1RPS0VOUykpOwogICAgICAgIHJlcXVpcmUoVE9UQUxfVEVBTV9UT0tFTlMgPT0gVEVBTV9UT0tFTlMwLmFkZChURUFNX1RPS0VOUzEpLmFkZChURUFNX1RPS0VOUzIpKTsKICAgICAgICBzZXRNYW5hZ2VyKG1zZy5zZW5kZXIsIHRydWUpOwoKICAgICAgICBiZW5lZmljaWFyeVdhbGxldCA9IF9iZW5lZmljaWFyeVdhbGxldDsKCiAgICAgICAgbWF4Q29udHJpYnV0aW9uSW5XZWkgPSAoTUFYX0NPTlRSSUJVVElPTl9VU0QubXVsKDFlMTgpKS5kaXYoX3VzZFBlckV0aCk7CgogICAgICAgIG1pbnRUZWFtVG9rZW5zKCk7CiAgICAgICAgbWludENvbW11bml0eVRva2VucygpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGUgbmV3IGluc3RhbmNlIG9mIG10biB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0KCkgaW50ZXJuYWwgcmV0dXJucyAoTWludGFibGVUb2tlbikgewogICAgICAgIHJldHVybiBuZXcgTXRuVG9rZW4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IC8gYWx0ZXIgbWFuYWdlciAvIHdoaXRlbGlzdGVyICJhY2NvdW50Ii4gVGhpcyBjYW4gYmUgZG9uZSBmcm9tIG93bmVyIG9ubHkKICAgICAqIEBwYXJhbSBfbWFuYWdlciBhZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIG1hbmFnZXIgdG8gY3JlYXRlL2FsdGVyCiAgICAgKiBAcGFyYW0gX2FjdGl2ZSBib29sIGZsYWcgdGhhdCBzaG93cyBpZiB0aGUgbWFuYWdlciBhY2NvdW50IGlzIGFjdGl2ZQogICAgICovCiAgICBmdW5jdGlvbiBzZXRNYW5hZ2VyKGFkZHJlc3MgX21hbmFnZXIsIGJvb2wgX2FjdGl2ZSkgcHVibGljIG9ubHlPd25lciBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSB7CiAgICAgICAgaXNNYW5hZ2VyW19tYW5hZ2VyXSA9IF9hY3RpdmU7CiAgICAgICAgQ2hhbmdlZE1hbmFnZXIoX21hbmFnZXIsIF9hY3RpdmUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiB3aGl0ZWxpc3QgaW52ZXN0b3JzIHRvIGFsbG93IHRoZSBkaXJlY3QgaW52ZXN0bWVudCBvZiB0aGlzIGNyb3dkc2FsZQogICAgICogQHBhcmFtIF9pbnZlc3RvciBhZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yIHRvIGJlIHdoaXRlbGlzdGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdoaXRlTGlzdEludmVzdG9yKGFkZHJlc3MgX2ludmVzdG9yKSBwdWJsaWMgb25seU1hbmFnZXIgb25seVZhbGlkQWRkcmVzcyhfaW52ZXN0b3IpIHsKICAgICAgICBpc1doaXRlbGlzdGVkW19pbnZlc3Rvcl0gPSB0cnVlOwogICAgICAgIENoYW5nZWRJbnZlc3RvcldoaXRlbGlzdGluZyhfaW52ZXN0b3IsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiB3aGl0ZWxpc3Qgc2V2ZXJhbCBpbnZlc3RvcnMgdmlhIGEgYmF0Y2ggbWV0aG9kCiAgICAgKiBAcGFyYW0gX2ludmVzdG9ycyBhZGRyZXNzW10gYXJyYXkgb2YgYWRkcmVzc2VzIG9mIHRoZSBiZW5lZmljaWFyaWVzIHRvIHJlY2VpdmUgdG9rZW5zIGFmdGVyIHRoZXkgaGF2ZSBiZWVuIGNvbmZpcm1lZAogICAgICovCiAgICBmdW5jdGlvbiBiYXRjaFdoaXRlTGlzdEludmVzdG9ycyhhZGRyZXNzW10gX2ludmVzdG9ycykgcHVibGljIG9ubHlNYW5hZ2VyIHsKICAgICAgICBmb3IgKHVpbnQyNTYgYzsgYyA8IF9pbnZlc3RvcnMubGVuZ3RoOyBjID0gYy5hZGQoMSkpIHsKICAgICAgICAgICAgd2hpdGVMaXN0SW52ZXN0b3IoX2ludmVzdG9yc1tjXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiB1bndoaXRlbGlzdCBpbnZlc3RvciBmcm9tIHBhcnRpY2lwYXRpbmcgaW4gdGhlIGNyb3dkc2FsZQogICAgICogQHBhcmFtIF9pbnZlc3RvciBhZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yIHRvIGRpc2FsbG93ZWQgcGFydGljaXBhdGlvbgogICAgICovCiAgICBmdW5jdGlvbiB1bldoaXRlTGlzdEludmVzdG9yKGFkZHJlc3MgX2ludmVzdG9yKSBwdWJsaWMgb25seU1hbmFnZXIgb25seVZhbGlkQWRkcmVzcyhfaW52ZXN0b3IpIHsKICAgICAgICBpc1doaXRlbGlzdGVkW19pbnZlc3Rvcl0gPSBmYWxzZTsKICAgICAgICBDaGFuZ2VkSW52ZXN0b3JXaGl0ZWxpc3RpbmcoX2ludmVzdG9yLCBmYWxzZSk7CiAgICB9CgogICAvKioKICAgICogQGRldiBvbmx5T3duZXIgYWxsb3dlZCB0byBtaW50IHRva2VucywgcmVzcGVjdGluZyB0aGUgY2FwLCBhbmQgb25seSBiZWZvcmUgdGhlIGNyb3dkc2FsZSBzdGFydHMKICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBhZGRyZXNzCiAgICAqIEBwYXJhbSBfYW1vdW50IHVpbnQyNTYKICAgICovCiAgICBmdW5jdGlvbiBtaW50VG9rZW5QcmVTYWxlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgb25seVByZXNhbGVQaGFzZSBvbmx5VmFsaWRBZGRyZXNzKF9iZW5lZmljaWFyeSkgcmVzcGVjdENyb3dkc2FsZUNhcChfYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CgogICAgICAgIHRva2Vuc01pbnRlZCA9IHRva2Vuc01pbnRlZC5hZGQoX2Ftb3VudCk7CiAgICAgICAgdG9rZW4ubWludChfYmVuZWZpY2lhcnksIF9hbW91bnQpOwogICAgICAgIFByZXNhbGVNaW50ZWQoX2JlbmVmaWNpYXJ5LCBfYW1vdW50KTsKICAgIH0KCiAgIC8qKgogICAgKiBAZGV2IG9ubHlPd25lciBhbGxvd2VkIHRvIGhhbmRsZSBiYXRjaCBwcmVzYWxlIG1pbnRpbmcKICAgICogQHBhcmFtIF9iZW5lZmljaWFyaWVzIGFkZHJlc3NbXQogICAgKiBAcGFyYW0gX2Ftb3VudHMgdWludDI1NltdCiAgICAqLwogICAgZnVuY3Rpb24gYmF0Y2hNaW50VG9rZW5QcmVzYWxlKGFkZHJlc3NbXSBfYmVuZWZpY2lhcmllcywgdWludDI1NltdIF9hbW91bnRzKSBwdWJsaWMgb25seU93bmVyIG9ubHlQcmVzYWxlUGhhc2UgewogICAgICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJpZXMubGVuZ3RoID09IF9hbW91bnRzLmxlbmd0aCk7CgogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgX2JlbmVmaWNpYXJpZXMubGVuZ3RoOyBpID0gaS5hZGQoMSkpIHsKICAgICAgICAgICAgbWludFRva2VuUHJlU2FsZShfYmVuZWZpY2lhcmllc1tpXSwgX2Ftb3VudHNbaV0pOwogICAgICAgIH0KICAgIH0KCiAgIC8qKgogICAgKiBAZGV2IG92ZXJyaWRlIGNvcmUgZnVuY3Rpb25hbGl0eSBieSB3aGl0ZWxpc3QgY2hlY2sKICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBhZGRyZXNzCiAgICAqLwogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSBvbmx5Q3Jvd2RzYWxlUGhhc2Ugb25seVZhbGlkQWRkcmVzcyhfYmVuZWZpY2lhcnkpIHsKICAgICAgICByZXF1aXJlKGlzV2hpdGVsaXN0ZWRbbXNnLnNlbmRlcl0pOwogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgICAgdWludDI1NiBvdmVyZmxvd1Rva2VuczsKICAgICAgICB1aW50MjU2IHJlZnVuZFdlaUFtb3VudDsKICAgICAgICBib29sIG92ZXJNYXhJbnZlc3RtZW50QWxsb3dlZDsKCiAgICAgICAgdWludDI1NiBpbnZlc3RlZFdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAgICAgLy8gSXMgdGhpcyBzcGVjaWZpYyBpbnZlc3RtZW50IG92ZXIgdGhlIE1BWF9DT05UUklCVVRJT05fVVNEIGxpbWl0PwogICAgICAgIC8vIGlmIHNvLCBjYWxjdWF0ZSB3ZWkgcmVmdW5kZWQgYW5kIHRva2VucyB0byBtaW50IGZvciB0aGUgYWxsb3dlZCBpbnZlc3RtZW50IGFtb3VudAogICAgICAgIHVpbnQyNTYgdG90YWxJbnZlc3RlZFdlaUFtb3VudCA9IGludmVzdGVkV2VpQW1vdW50LmFkZCh0b3RhbEludmVzdGVkUGVyQWRkcmVzc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgaWYgKHRvdGFsSW52ZXN0ZWRXZWlBbW91bnQgPiBtYXhDb250cmlidXRpb25JbldlaSkgewogICAgICAgICAgICBvdmVyTWF4SW52ZXN0bWVudEFsbG93ZWQgPSB0cnVlOwogICAgICAgICAgICByZWZ1bmRXZWlBbW91bnQgPSB0b3RhbEludmVzdGVkV2VpQW1vdW50LnN1YihtYXhDb250cmlidXRpb25JbldlaSk7CiAgICAgICAgICAgIGludmVzdGVkV2VpQW1vdW50ID0gaW52ZXN0ZWRXZWlBbW91bnQuc3ViKHJlZnVuZFdlaUFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHRva2VuQW1vdW50ID0gaW52ZXN0ZWRXZWlBbW91bnQubXVsKHJhdGUpOwogICAgICAgIHVpbnQyNTYgdGVtcE1pbnRlZFRva2VucyA9IHRva2Vuc01pbnRlZC5hZGQodG9rZW5BbW91bnQpOyAvLyBnYXMgb3B0aW1pemF0aW9uLCBkbyBub3QgaW5saW5lIHR3aWNlCgogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGlzIHB1cmNoYXNlIHNldHMgaXQgb3ZlciB0aGUgY3Jvd2RzYWxlIHRva2VuIGNhcAogICAgICAgIC8vIGlmIHNvLCBjYWxjdWxhdGUgdG9rZW5zIHRvIG1pbnQsIHRoZW4gcmVmdW5kIHRoZSByZW1haW5pbmcgZXRoZXIgaW52ZXN0bWVudAogICAgICAgIGlmICh0ZW1wTWludGVkVG9rZW5zID49IENST1dEU0FMRV9UT0tFTlMpIHsKICAgICAgICAgICAgY2FwUmVhY2hlZCA9IHRydWU7CiAgICAgICAgICAgIG92ZXJmbG93VG9rZW5zID0gdGVtcE1pbnRlZFRva2Vucy5zdWIoQ1JPV0RTQUxFX1RPS0VOUyk7CiAgICAgICAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQuc3ViKG92ZXJmbG93VG9rZW5zKTsKICAgICAgICAgICAgcmVmdW5kV2VpQW1vdW50ID0gb3ZlcmZsb3dUb2tlbnMuZGl2KHJhdGUpOwogICAgICAgICAgICBpbnZlc3RlZFdlaUFtb3VudCA9IGludmVzdGVkV2VpQW1vdW50LnN1YihyZWZ1bmRXZWlBbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZChpbnZlc3RlZFdlaUFtb3VudCk7CgogICAgICAgIHRva2Vuc01pbnRlZCA9IHRva2Vuc01pbnRlZC5hZGQodG9rZW5BbW91bnQpOwogICAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgX2JlbmVmaWNpYXJ5LCBpbnZlc3RlZFdlaUFtb3VudCwgdG9rZW5BbW91bnQpOwogICAgICAgIHRvdGFsSW52ZXN0ZWRQZXJBZGRyZXNzW21zZy5zZW5kZXJdID0gdG90YWxJbnZlc3RlZFBlckFkZHJlc3NbbXNnLnNlbmRlcl0uYWRkKGludmVzdGVkV2VpQW1vdW50KTsKICAgICAgICB0b2tlbi5taW50KF9iZW5lZmljaWFyeSwgdG9rZW5BbW91bnQpOwoKICAgICAgICAvLyBpZiBpbnZlc3RvciBicmVhY2hlZCBjYXAgYW5kIGhhcyByZW1haW5pbmcgZXRoZXIgbm90IGludmVzdGVkCiAgICAgICAgLy8gcmVmdW5kIHJlbWFpbmluZyBldGhlciB0byBpbnZlc3RvcgogICAgICAgIGlmIChjYXBSZWFjaGVkIHx8IG92ZXJNYXhJbnZlc3RtZW50QWxsb3dlZCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZFdlaUFtb3VudCk7CiAgICAgICAgICAgIHdhbGxldC50cmFuc2ZlcihpbnZlc3RlZFdlaUFtb3VudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CiAgICAgICAgfQogICAgfQoKICAgLyoqCiAgICAqIEBkZXYgb25seU93bmVyIHRvIGNsb3NlIENyb3dkc2FsZSBtYW51YWxseSBpZiBiZWZvcmUgZW5kVGltZQogICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlQ3Jvd2RzYWxlKCkgcHVibGljIG9ubHlPd25lciBvbmx5Q3Jvd2RzYWxlUGhhc2UgewogICAgICAgIGlzQ3Jvd2RzYWxlT3ZlciA9IHRydWU7CiAgICB9CgogICAvKioKICAgICogQGRldiBvbmx5T3duZXIgYWxsb3dzIHRva2VucyB0byBiZSB0cmFkZWFibGUKICAgICovCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBvbmx5T3duZXIgb25seUNyb3dkU2FsZU92ZXIgewogICAgICAgIC8vIGRvIG5vdCBhbGxvdyBuZXcgb3duZXIgdG8gbWludCBmdXJ0aGVyIHRva2VucyAmIHVucGF1c2UgdG9rZW4gdG8gYWxsb3cgdHJhZGluZwogICAgICAgIE1pbnRhYmxlVG9rZW4odG9rZW4pLmZpbmlzaE1pbnRpbmcoKTsKICAgICAgICBQYXVzYWJsZVRva2VuKHRva2VuKS51bnBhdXNlKCk7CiAgICB9CgogICAgLyoqKiBJTlRFUk5BTC9QUklWQVRFIEZVTkNUSU9OUyAqKiovCgogICAgLyoqCiAgICAgKiBAZGV2IGFsbG93cyBjb250cmFjdCBvd25lciB0byBtaW50IGFsbCB0ZWFtIHRva2VucyBwZXIgVEVBTV9UT0tFTlMgYW5kIGhhdmUgNTBtIGltbWVkaWF0ZWx5IGF2YWlsYWJsZSwgNjBtIDIgeWVhcnMgdmVzdGVkLCBhbmQgNjBtIG92ZXIgNCB5ZWFycyB2ZXN0aW5nCiAgICAgKi8KICAgIGZ1bmN0aW9uIG1pbnRUZWFtVG9rZW5zKCkgcHJpdmF0ZSB7CiAgICAgICAgdG9rZW4ubWludChiZW5lZmljaWFyeVdhbGxldCwgVEVBTV9UT0tFTlMwKTsKCiAgICAgICAgVG9rZW5WZXN0aW5nIG5ld1ZhdWx0MSA9IG5ldyBUb2tlblZlc3RpbmcoYmVuZWZpY2lhcnlXYWxsZXQsIG5vdywgMCwgVkVTVElOR19EVVJBVElPTl8yWSwgZmFsc2UpOwogICAgICAgIHRlYW1WZXN0aW5nMlllYXJzID0gYWRkcmVzcyhuZXdWYXVsdDEpOyAvLyBmb3IgY29udmVuaWVuY2Ugd2Uga2VlcCB0aGVtIGluIHN0b3JhZ2Ugc28gdGhhdCB0aGV5IGFyZSBlYXNpbHkgYWNjZXNzaWJsZSB2aWEgTUVXIG9yIGV0aGVyc2NhbgogICAgICAgIHRva2VuLm1pbnQoYWRkcmVzcyhuZXdWYXVsdDEpLCBURUFNX1RPS0VOUzEpOwoKICAgICAgICBUb2tlblZlc3RpbmcgbmV3VmF1bHQyID0gbmV3IFRva2VuVmVzdGluZyhiZW5lZmljaWFyeVdhbGxldCwgbm93LCAwLCBWRVNUSU5HX0RVUkFUSU9OXzRZLCBmYWxzZSk7CiAgICAgICAgdGVhbVZlc3Rpbmc0WWVhcnMgPSBhZGRyZXNzKG5ld1ZhdWx0Mik7IC8vIGZvciBjb252ZW5pZW5jZSB3ZSBrZWVwIHRoZW0gaW4gc3RvcmFnZSBzbyB0aGF0IHRoZXkgYXJlIGVhc2lseSBhY2Nlc3NpYmxlIHZpYSBNRVcgb3IgZXRoZXJzY2FuCiAgICAgICAgdG9rZW4ubWludChhZGRyZXNzKG5ld1ZhdWx0MiksIFRFQU1fVE9LRU5TMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGFsbG93cyBjb250cmFjdCBvd25lciB0byBtaW50IGFsbCBjb21tdW5pdHkgdG9rZW5zIHBlciBDT01NVU5JVFlfVE9LRU5TIGFuZCBoYXZlIHRoZSB2ZXN0ZWQgdG8gdGhlIGJlbmVmaWNpYXJ5V2FsbGV0CiAgICAgKi8KICAgIGZ1bmN0aW9uIG1pbnRDb21tdW5pdHlUb2tlbnMoKSBwcml2YXRlIHsKICAgICAgICBUb2tlblZlc3RpbmcgbmV3VmF1bHQgPSBuZXcgVG9rZW5WZXN0aW5nKGJlbmVmaWNpYXJ5V2FsbGV0LCBub3csIDAsIFZFU1RJTkdfRFVSQVRJT05fNFksIGZhbHNlKTsKICAgICAgICBjb21tdW5pdHlWZXN0aW5nNFllYXJzID0gYWRkcmVzcyhuZXdWYXVsdCk7IC8vIGZvciBjb252ZW5pZW5jZSB3ZSBrZWVwIHRoZW0gaW4gc3RvcmFnZSBzbyB0aGF0IHRoZXkgYXJlIGVhc2lseSBhY2Nlc3NpYmxlIHZpYSBNRVcgb3IgZXRoZXJzY2FuCiAgICAgICAgdG9rZW4ubWludChhZGRyZXNzKG5ld1ZhdWx0KSwgQ09NTVVOSVRZX1RPS0VOUyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGV4dGVuZCBiYXNlIGZ1bmN0aW9uYWxpdHkgd2l0aCBtaW4gaW52ZXN0bWVudCBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmVzcGVjdENyb3dkc2FsZUNhcCgwKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSghY2FwUmVhY2hlZCk7CiAgICAgICAgcmVxdWlyZSh0b3RhbEludmVzdGVkUGVyQWRkcmVzc1ttc2cuc2VuZGVyXSA8IG1heENvbnRyaWJ1dGlvbkluV2VpKTsKCiAgICAgICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2UoKTsKICAgIH0KfQ=='.
	

]
