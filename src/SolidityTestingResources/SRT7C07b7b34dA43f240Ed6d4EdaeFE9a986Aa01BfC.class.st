Class {
	#name : #SRT7C07b7b34dA43f240Ed6d4EdaeFE9a986Aa01BfC,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7C07b7b34dA43f240Ed6d4EdaeFE9a986Aa01BfC >> base64 [
	^ 'Ly9qdXN0IHVwZGF0ZWQgdGhlIGVuY3J5cHRlZCBhcGkga2V5Ci8vdXBkYXRlZCBjb250cmFjdEJhbGFuY2UgLT0gNTcyNDU5MDE2MzkzNDQ7CgpwcmFnbWEgc29saWRpdHkgXjAuNC4yOwoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpewogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik+MCl7IC8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIAogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOwogICAgICAgIHVpbnQxNjAgYjE7CiAgICAgICAgdWludDE2MCBiMjsKICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7CiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsKICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7CiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7CiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkmJihiMSA8PSA3MCkpIGIxIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSYmKGIyIDw9IDcwKSkgYjIgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKXsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGogLz0gMTA7CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgICAgdWludCBrID0gbGVuIC0gMTsKICAgICAgICB3aGlsZSAoaSAhPSAwKXsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KfQovLyA8L09SQUNMSVpFX0FQST4KCi8qCiAqIEB0aXRsZSBTdHJpbmcgJiBzbGljZSB1dGlsaXR5IGxpYnJhcnkgZm9yIFNvbGlkaXR5IGNvbnRyYWN0cy4KICogQGF1dGhvciBOaWNrIEpvaG5zb24gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmZDljOGY5YzllOTU5Mzk0OTliZDkzOTI4OTk5OTI4OWQzOTM5ODg5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICoKICogQGRldiBGdW5jdGlvbmFsaXR5IGluIHRoaXMgbGlicmFyeSBpcyBsYXJnZWx5IGltcGxlbWVudGVkIHVzaW5nIGFuCiAqICAgICAgYWJzdHJhY3Rpb24gY2FsbGVkIGEgJ3NsaWNlJy4gQSBzbGljZSByZXByZXNlbnRzIGEgcGFydCBvZiBhIHN0cmluZyAtCiAqICAgICAgYW55dGhpbmcgZnJvbSB0aGUgZW50aXJlIHN0cmluZyB0byBhIHNpbmdsZSBjaGFyYWN0ZXIsIG9yIGV2ZW4gbm8KICogICAgICBjaGFyYWN0ZXJzIGF0IGFsbCAoYSAwLWxlbmd0aCBzbGljZSkuIFNpbmNlIGEgc2xpY2Ugb25seSBoYXMgdG8gc3BlY2lmeQogKiAgICAgIGFuIG9mZnNldCBhbmQgYSBsZW5ndGgsIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyBzbGljZXMgaXMgYSBsb3QgbGVzcwogKiAgICAgIGV4cGVuc2l2ZSB0aGFuIGNvcHlpbmcgYW5kIG1hbmlwdWxhdGluZyB0aGUgc3RyaW5ncyB0aGV5IHJlZmVyZW5jZS4KICoKICogICAgICBUbyBmdXJ0aGVyIHJlZHVjZSBnYXMgY29zdHMsIG1vc3QgZnVuY3Rpb25zIG9uIHNsaWNlIHRoYXQgbmVlZCB0byByZXR1cm4KICogICAgICBhIHNsaWNlIG1vZGlmeSB0aGUgb3JpZ2luYWwgb25lIGluc3RlYWQgb2YgYWxsb2NhdGluZyBhIG5ldyBvbmU7IGZvcgogKiAgICAgIGluc3RhbmNlLCBgcy5zcGxpdCgiLiIpYCB3aWxsIHJldHVybiB0aGUgdGV4dCB1cCB0byB0aGUgZmlyc3QgJy4nLAogKiAgICAgIG1vZGlmeWluZyBzIHRvIG9ubHkgY29udGFpbiB0aGUgcmVtYWluZGVyIG9mIHRoZSBzdHJpbmcgYWZ0ZXIgdGhlICcuJy4KICogICAgICBJbiBzaXR1YXRpb25zIHdoZXJlIHlvdSBkbyBub3Qgd2FudCB0byBtb2RpZnkgdGhlIG9yaWdpbmFsIHNsaWNlLCB5b3UKICogICAgICBjYW4gbWFrZSBhIGNvcHkgZmlyc3Qgd2l0aCBgLmNvcHkoKWAsIGZvciBleGFtcGxlOgogKiAgICAgIGBzLmNvcHkoKS5zcGxpdCgiLiIpYC4gVHJ5IGFuZCBhdm9pZCB1c2luZyB0aGlzIGlkaW9tIGluIGxvb3BzOyBzaW5jZQogKiAgICAgIFNvbGlkaXR5IGhhcyBubyBtZW1vcnkgbWFuYWdlbWVudCwgaXQgd2lsbCByZXN1bHQgaW4gYWxsb2NhdGluZyBtYW55CiAqICAgICAgc2hvcnQtbGl2ZWQgc2xpY2VzIHRoYXQgYXJlIGxhdGVyIGRpc2NhcmRlZC4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCByZXR1cm4gdHdvIHNsaWNlcyBjb21lIGluIHR3byB2ZXJzaW9uczogYSBub24tYWxsb2NhdGluZwogKiAgICAgIHZlcnNpb24gdGhhdCB0YWtlcyB0aGUgc2Vjb25kIHNsaWNlIGFzIGFuIGFyZ3VtZW50LCBtb2RpZnlpbmcgaXQgaW4KICogICAgICBwbGFjZSwgYW5kIGFuIGFsbG9jYXRpbmcgdmVyc2lvbiB0aGF0IGFsbG9jYXRlcyBhbmQgcmV0dXJucyB0aGUgc2Vjb25kCiAqICAgICAgc2xpY2U7IHNlZSBgbmV4dFJ1bmVgIGZvciBleGFtcGxlLgogKgogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IGhhdmUgdG8gY29weSBzdHJpbmcgZGF0YSB3aWxsIHJldHVybiBzdHJpbmdzIHJhdGhlciB0aGFuCiAqICAgICAgc2xpY2VzOyB0aGVzZSBjYW4gYmUgY2FzdCBiYWNrIHRvIHNsaWNlcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nIGlmCiAqICAgICAgcmVxdWlyZWQuCiAqCiAqICAgICAgRm9yIGNvbnZlbmllbmNlLCBzb21lIGZ1bmN0aW9ucyBhcmUgcHJvdmlkZWQgd2l0aCBub24tbW9kaWZ5aW5nCiAqICAgICAgdmFyaWFudHMgdGhhdCBjcmVhdGUgYSBuZXcgc2xpY2UgYW5kIHJldHVybiBib3RoOyBmb3IgaW5zdGFuY2UsCiAqICAgICAgYHMuc3BsaXROZXcoJy4nKWAgbGVhdmVzIHMgdW5tb2RpZmllZCwgYW5kIHJldHVybnMgdHdvIHZhbHVlcwogKiAgICAgIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxlZnQgYW5kIHJpZ2h0IHBhcnRzIG9mIHRoZSBzdHJpbmcuCiAqLwpsaWJyYXJ5IHN0cmluZ3MgewogICAgc3RydWN0IHNsaWNlIHsKICAgICAgICB1aW50IF9sZW47CiAgICAgICAgdWludCBfcHRyOwogICAgfQoKICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBsZW4gPj0gMzI7IGxlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0ICs9IDMyOwogICAgICAgICAgICBzcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQgbWFzayA9IDI1NiAqKiAoMzIgLSBsZW4pIC0gMTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChzcmMpLCBub3QobWFzaykpCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShkZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpCiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcmV0OwogICAgICAgIGlmIChzZWxmID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxNjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gODsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gNDsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDMyIC0gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgYnl0ZXMzMiwgaW50ZXJwcmV0ZWQgYXMgYQogICAgICogICAgICBudWxsLXRlcm1pbnRhZWQgdXRmLTggc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLgogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYXJndW1lbnQgdXAgdG8gdGhlCiAgICAgKiAgICAgICAgIGZpcnN0IG51bGwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2VCMzIoYnl0ZXMzMiBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICAvLyBBbGxvY2F0ZSBzcGFjZSBmb3IgYHNlbGZgIGluIG1lbW9yeSwgY29weSBpdCB0aGVyZSwgYW5kIHBvaW50IHJldCBhdCBpdAogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHB0ciA6PSBtbG9hZCgweDQwKQogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKHB0ciwgMHgyMCkpCiAgICAgICAgICAgIG1zdG9yZShwdHIsIHNlbGYpCiAgICAgICAgICAgIG1zdG9yZShhZGQocmV0LCAweDIwKSwgcHRyKQogICAgICAgIH0KICAgICAgICByZXQuX2xlbiA9IGxlbihzZWxmKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogICAgICogQHJldHVybiBBIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24KICAgICAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0CiAgICAgKiAgICAgIGluIGxvb3BzLCBhbmQgY2FsbCBgc2xpY2UuZW1wdHkoKWAgaWYgeW91IG9ubHkgbmVlZCB0byBrbm93IHdoZXRoZXIKICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzbGljZSBpbiBydW5lcy4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBTdGFydGluZyBhdCBwdHItMzEgbWVhbnMgdGhlIExTQiB3aWxsIGJlIHRoZSBieXRlIHdlIGNhcmUgYWJvdXQKICAgICAgICB2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7CiAgICAgICAgdmFyIGVuZCA9IHB0ciArIHNlbGYuX2xlbjsKICAgICAgICBmb3IgKHVpbnQgbGVuID0gMDsgcHRyIDwgZW5kOyBsZW4rKykgewogICAgICAgICAgICB1aW50OCBiOwogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0KICAgICAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMjsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEY4KSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHB0ciArPSA2OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBsZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSAoaGFzIGEgbGVuZ3RoIG9mIDApLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5LCBGYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVtcHR5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc2VsZi5fbGVuID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogICAgICovCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICB1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOwogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7CiAgICAgICAgZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsKICAgICAgICAgICAgdWludCBhOwogICAgICAgICAgICB1aW50IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikKICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEgIT0gYikgewogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICAgICAgICAgIHVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsKICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7CiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoZGlmZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsKICAgICAgICAgICAgb3RoZXJwdHIgKz0gMzI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHR3byBzbGljZXMgY29udGFpbiB0aGUgc2FtZSB0ZXh0LgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2Vjb25kIHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZXF1YWxzKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGNvbXBhcmUoc2VsZiwgb3RoZXIpID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgRXh0cmFjdHMgdGhlIGZpcnN0IHJ1bmUgaW4gdGhlIHNsaWNlIGludG8gYHJ1bmVgLCBhZHZhbmNpbmcgdGhlCiAgICAgKiAgICAgIHNsaWNlIHRvIHBvaW50IHRvIHRoZSBuZXh0IHJ1bmUgYW5kIHJldHVybmluZyBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBydW5lIFRoZSBzbGljZSB0aGF0IHdpbGwgY29udGFpbiB0aGUgZmlyc3QgcnVuZS4KICAgICAqIEByZXR1cm4gYHJ1bmVgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmLCBzbGljZSBydW5lKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsKCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgdWludCBsZW47CiAgICAgICAgdWludCBiOwogICAgICAgIC8vIExvYWQgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIHJ1bmUgaW50byB0aGUgTFNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChzdWIobWxvYWQoYWRkKHNlbGYsIDMyKSksIDMxKSksIDB4RkYpIH0KICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgbGVuID0gMTsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgbGVuID0gMjsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgbGVuID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZW4gPSA0OwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgewogICAgICAgICAgICBydW5lLl9sZW4gPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5fcHRyICs9IGxlbjsKICAgICAgICBzZWxmLl9sZW4gLT0gbGVuOwogICAgICAgIHJ1bmUuX2xlbiA9IGxlbjsKICAgICAgICByZXR1cm4gcnVuZTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludAogICAgICogICAgICB0byB0aGUgbmV4dCBydW5lLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogICAgICovCiAgICBmdW5jdGlvbiBvcmQoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXQpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IHdvcmQ7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgdWludCBkaXYgPSAyICoqIDI0ODsKCiAgICAgICAgLy8gTG9hZCB0aGUgcnVuZSBpbnRvIHRoZSBNU0JzIG9mIGIKICAgICAgICBhc3NlbWJseSB7IHdvcmQ6PSBtbG9hZChtbG9hZChhZGQoc2VsZiwgMzIpKSkgfQogICAgICAgIHZhciBiID0gd29yZCAvIGRpdjsKICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgcmV0ID0gYjsKICAgICAgICAgICAgbGVuID0gMTsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgcmV0ID0gYiAmIDB4MUY7CiAgICAgICAgICAgIGxlbiA9IDI7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDBGOwogICAgICAgICAgICBsZW4gPSAzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDA3OwogICAgICAgICAgICBsZW4gPSA0OwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCiAgICAgICAgaWYgKGxlbiA+IHNlbGYuX2xlbikgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGRpdiA9IGRpdiAvIDI1NjsKICAgICAgICAgICAgYiA9ICh3b3JkIC8gZGl2KSAmIDB4RkY7CiAgICAgICAgICAgIGlmIChiICYgMHhDMCAhPSAweDgwKSB7CiAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIFVURi04IHNlcXVlbmNlCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXQgPSAocmV0ICogNjQpIHwgKGIgJiAweDNGKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUga2VjY2FrLTI1NiBoYXNoIG9mIHRoZSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBoYXNoLgogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgc2xpY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGtlY2NhayhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIHJldCkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmV0IDo9IHNoYTMobWxvYWQoYWRkKHNlbGYsIDMyKSksIG1sb2FkKHNlbGYpKQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5fcHRyID09IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbDsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgfQogICAgICAgIHJldHVybiBlcXVhbDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBJZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJleW9uZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7CiAgICAgICAgaWYgKHNlbGYuX3B0ciAhPSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgICAgIGxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkKICAgICAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgICAgICBzZWxmLl9wdHIgKz0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGVuZHMgd2l0aCBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZW5kc1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47CgogICAgICAgIGlmIChzZWxmcHRyID09IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbDsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICBlcXVhbCA6PSBlcShzaGEzKHNlbGZwdHIsIGxlbiksIHNoYTMobmVlZGxlcHRyLCBsZW4pKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICB1aW50IGlkeDsKCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsKICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyCiAgICAgICAgICAgICAgICAgICAgbG9vcDoKICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0cjsKICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsKICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgYWRkcmVzcyBvZiBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY5IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkocmV0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzdWIocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGp1bXAoZXhpdCkKICAgICAgICAgICAgICAgICAgICByZXQ6CiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIG5lZWRsZWxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsKICAgICAgICAgICAgICAgIHdoaWxlIChwdHIgPj0gc2VsZnB0cikgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHIgKyBuZWVkbGVsZW47CiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHI7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mCiAgICAgKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQogICAgICogICAgICBpZiBgbmVlZGxlYCBpcyBub3QgZm91bmQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHNlbGYuX2xlbiAtPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgc2VsZi5fcHRyID0gcHRyOwogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIHRoZSBwYXJ0IG9mIHRoZSBzdHJpbmcgZnJvbSB0aGUgc3RhcnQgb2YKICAgICAqICAgICAgYHNlbGZgIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAuIElmIGBuZWVkbGVgCiAgICAgKiAgICAgIGlzIG5vdCBmb3VuZCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gcmZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgc2VsZi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsKICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewogICAgICAgIHNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLgogICAgICogQHJldHVybiBgdG9rZW5gLgogICAgICovCiAgICBmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHRva2VuLl9wdHIgPSBwdHI7CiAgICAgICAgdG9rZW4uX2xlbiA9IHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICByc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3VudChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHVpbnQgY291bnQpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewogICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBUcnVlIGlmIGBzZWxmYCBjb250YWlucyBgbmVlZGxlYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUcnVlIGlmIGBuZWVkbGVgIGlzIGZvdW5kIGluIGBzZWxmYCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBjb250YWlucyhzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YKICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4KICAgICAqLwogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQogICAgICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLAogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gIiI7CgogICAgICAgIHVpbnQgbGVuID0gc2VsZi5fbGVuICogKHBhcnRzLmxlbmd0aCAtIDEpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGxlbiArPSBwYXJ0c1tpXS5fbGVuOwoKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhsZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIGZvcihpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOwogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsKICAgICAgICAgICAgaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQp9CgoKY29udHJhY3QgRFNTYWZlQWRkU3ViIHsKICAgIGZ1bmN0aW9uIHNhZmVUb0FkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoYSArIGIgPj0gYSk7CiAgICB9CiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKCFzYWZlVG9BZGQoYSwgYikpIHRocm93OwogICAgICAgIHJldHVybiBhICsgYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlVG9TdWJ0cmFjdCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoYiA8PSBhKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKCFzYWZlVG9TdWJ0cmFjdChhLCBiKSkgdGhyb3c7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfSAKfQoKCgpjb250cmFjdCBFdGhlcm9sbCBpcyB1c2luZ09yYWNsaXplLCBEU1NhZmVBZGRTdWIgewogICAgCiAgICAgdXNpbmcgc3RyaW5ncyBmb3IgKjsKCiAgICAvKgogICAgICogY2hlY2tzIHBsYXllciBwcm9maXQsIGJldCBzaXplIGFuZCBwbGF5ZXIgbnVtYmVyIGlzIHdpdGhpbiByYW5nZQogICAgKi8KICAgIG1vZGlmaWVyIGJldElzVmFsaWQodWludCBfYmV0U2l6ZSwgdWludCBfcGxheWVyTnVtYmVyKSB7ICAgICAgCiAgICAgICAgaWYoKCgoKF9iZXRTaXplICogKDEwMC0oc2FmZVN1YihfcGxheWVyTnVtYmVyLDEpKSkpIC8gKHNhZmVTdWIoX3BsYXllck51bWJlciwxKSkrX2JldFNpemUpKSpob3VzZUVkZ2UvaG91c2VFZGdlRGl2aXNvciktX2JldFNpemUgPiBtYXhQcm9maXQgfHwgX2JldFNpemUgPCBtaW5CZXQgfHwgX3BsYXllck51bWJlciA8IG1pbk51bWJlciB8fCBfcGxheWVyTnVtYmVyID4gbWF4TnVtYmVyKSB0aHJvdzsgICAgICAgIAoJCV87CiAgICB9CgogICAgLyoKICAgICAqIGNoZWNrcyBnYW1lIGlzIGN1cnJlbnRseSBhY3RpdmUKICAgICovCiAgICBtb2RpZmllciBnYW1lSXNBY3RpdmUgewogICAgICAgIGlmKGdhbWVQYXVzZWQgPT0gdHJ1ZSkgdGhyb3c7CgkJXzsKICAgIH0gICAgCgogICAgLyoKICAgICAqIGNoZWNrcyBwYXlvdXRzIGFyZSBjdXJyZW50bHkgYWN0aXZlCiAgICAqLwogICAgbW9kaWZpZXIgcGF5b3V0c0FyZUFjdGl2ZSB7CiAgICAgICAgaWYocGF5b3V0c1BhdXNlZCA9PSB0cnVlKSB0aHJvdzsKCQlfOwogICAgfSAgICAKCiAgICAvKgogICAgICogY2hlY2tzIG9ubHkgT3JhY2xpemUgYWRkcmVzcyBpcyBjYWxsaW5nCiAgICAqLwogICAgbW9kaWZpZXIgb25seU9yYWNsaXplIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogY2hlY2tzIG9ubHkgb3duZXIgYWRkcmVzcyBpcyBjYWxsaW5nCiAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiBjaGVja3Mgb25seSB0cmVhc3VyeSBhZGRyZXNzIGlzIGNhbGxpbmcKICAgICovCiAgICBtb2RpZmllciBvbmx5VHJlYXN1cnkgewogICAgICAgICBpZiAobXNnLnNlbmRlciAhPSB0cmVhc3VyeSkgdGhyb3c7CiAgICAgICAgIF87CiAgICB9ICAgIAoKICAgIC8qCiAgICAgKiBnYW1lIHZhcnMKICAgICovIAogICAgdWludCBjb25zdGFudCBwdWJsaWMgbWF4UHJvZml0RGl2aXNvciA9IDEwMDAwMDA7CiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBob3VzZUVkZ2VEaXZpc29yID0gMTAwMDsgICAgCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBtYXhOdW1iZXIgPSA5OTsgCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBtaW5OdW1iZXIgPSAyOwoJYm9vbCBwdWJsaWMgZ2FtZVBhdXNlZDsKICAgIHVpbnQzMiBwdWJsaWMgZ2FzRm9yT3JhY2xpemU7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGJvb2wgcHVibGljIHBheW91dHNQYXVzZWQ7IAogICAgYWRkcmVzcyBwdWJsaWMgdHJlYXN1cnk7CiAgICB1aW50IHB1YmxpYyBjb250cmFjdEJhbGFuY2U7CiAgICB1aW50IHB1YmxpYyBob3VzZUVkZ2U7ICAgICAKICAgIHVpbnQgcHVibGljIG1heFByb2ZpdDsgICAKICAgIHVpbnQgcHVibGljIG1heFByb2ZpdEFzUGVyY2VudE9mSG91c2U7ICAgICAgICAgICAgICAgICAgICAKICAgIHVpbnQgcHVibGljIG1pbkJldDsgICAgICAgCiAgICBpbnQgcHVibGljIHRvdGFsQmV0czsKICAgIHVpbnQgcHVibGljIG1heFBlbmRpbmdQYXlvdXRzOwogICAgdWludCBwdWJsaWMgY29zdFRvQ2FsbE9yYWNsaXplSW5XZWk7CiAgICB1aW50IHB1YmxpYyB0b3RhbFdlaVdvbjsKCiAgICAvKgogICAgICogcGxheWVyIHZhcnMKICAgICovCiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHBsYXllckFkZHJlc3M7CiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHBsYXllclRlbXBBZGRyZXNzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBwbGF5ZXJCZXRJZDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyQmV0VmFsdWU7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllclRlbXBCZXRWYWx1ZTsgIAogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJSYW5kb21SZXN1bHQ7ICAgICAKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyRGllUmVzdWx0OwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJOdW1iZXI7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHBsYXllclBlbmRpbmdXaXRoZHJhd2FsczsgICAgICAKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyUHJvZml0OwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wUmV3YXJkOyAgICAKICAgICAgICAKCiAgICAvKgogICAgICogZXZlbnRzCiAgICAqLwogICAgLyogbG9nIGJldHMgKyBvdXRwdXQgdG8gd2ViMyBmb3IgcHJlY2lzZSAncGF5b3V0IG9uIHdpbicgZmllbGQgaW4gVUkgKi8KICAgIGV2ZW50IExvZ0JldChieXRlczMyIGluZGV4ZWQgQmV0SUQsIGFkZHJlc3MgaW5kZXhlZCBQbGF5ZXJBZGRyZXNzLCB1aW50IGluZGV4ZWQgUmV3YXJkVmFsdWUsIHVpbnQgUHJvZml0VmFsdWUsIHVpbnQgQmV0VmFsdWUsIHVpbnQgUGxheWVyTnVtYmVyKTsgICAgICAKICAgIC8qIG91dHB1dCB0byB3ZWIzIFVJIG9uIGJldCByZXN1bHQqLwogICAgLyogU3RhdHVzOiAwPWxvc2UsIDE9d2luLCAyPXdpbiArIGZhaWxlZCBzZW5kLCAzPXJlZnVuZCwgND1yZWZ1bmQgKyBmYWlsZWQgc2VuZCovCglldmVudCBMb2dSZXN1bHQodWludCBpbmRleGVkIFJlc3VsdFNlcmlhbE51bWJlciwgYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBQbGF5ZXJOdW1iZXIsIHVpbnQgRGljZVJlc3VsdCwgdWludCBWYWx1ZSwgaW50IFN0YXR1cywgYnl0ZXMgUHJvb2YpOyAgIAogICAgLyogbG9nIG1hbnVhbCByZWZ1bmRzICovCiAgICBldmVudCBMb2dSZWZ1bmQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJlZnVuZFZhbHVlKTsKICAgIC8qIGxvZyBvd25lciB0cmFuc2ZlcnMgKi8KICAgIGV2ZW50IExvZ093bmVyVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIFNlbnRUb0FkZHJlc3MsIHVpbnQgaW5kZXhlZCBBbW91bnRUcmFuc2ZlcnJlZCk7ICAgICAgICAgICAgICAgCgoKICAgIC8qCiAgICAgKiBpbml0CiAgICAqLwogICAgZnVuY3Rpb24gRXRoZXJvbGwoKSB7CgogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB0cmVhc3VyeSA9IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7ICAgICAgICAKICAgICAgICAvKiB1c2UgVExTTm90YXJ5IGZvciBvcmFjbGl6ZSBjYWxsICovCgkJb3JhY2xpemVfc2V0UHJvb2YocHJvb2ZUeXBlX1RMU05vdGFyeSB8IHByb29mU3RvcmFnZV9JUEZTKTsKICAgICAgICAvKiBpbml0IDk5MCA9IDk5JSAoMSUgaG91c2VFZGdlKSovCiAgICAgICAgb3duZXJTZXRIb3VzZUVkZ2UoOTkwKTsKICAgICAgICAvKiBpbml0IDEwLDAwMCA9IDElICAqLwogICAgICAgIG93bmVyU2V0TWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSgxMDAwMCk7CiAgICAgICAgLyogaW5pdCBtaW4gYmV0ICgwLjEgZXRoZXIpICovCiAgICAgICAgb3duZXJTZXRNaW5CZXQoMTAwMDAwMDAwMDAwMDAwMDAwKTsgICAgICAgIAogICAgICAgIC8qIGluaXQgZ2FzIGZvciBvcmFjbGl6ZSAqLyAgICAgICAgCiAgICAgICAgZ2FzRm9yT3JhY2xpemUgPSAyNTAwMDA7ICAgICAgICAKCiAgICB9CgogICAgLyoKICAgICAqIHB1YmxpYyBmdW5jdGlvbgogICAgICogcGxheWVyIHN1Ym1pdCBiZXQKICAgICAqIG9ubHkgaWYgZ2FtZSBpcyBhY3RpdmUgJiBiZXQgaXMgdmFsaWQgY2FuIHF1ZXJ5IG9yYWNsaXplIGFuZCBzZXQgcGxheWVyIHZhcnMgICAgIAogICAgKi8KICAgIGZ1bmN0aW9uIHBsYXllclJvbGxEaWNlKHVpbnQgcm9sbFVuZGVyKSBwdWJsaWMgCiAgICAgICAgcGF5YWJsZQogICAgICAgIGdhbWVJc0FjdGl2ZQogICAgICAgIGJldElzVmFsaWQobXNnLnZhbHVlLCByb2xsVW5kZXIpCgl7ICAgICAgICAKICAgICAgICAKICAgICAgICAvKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gYWNjb3VudCBmb3IgY29zdCB0byBjYWxsIG9yYWNsaXplKi8KICAgICAgICBjb250cmFjdEJhbGFuY2UgPSBzYWZlU3ViKGNvbnRyYWN0QmFsYW5jZSwgb3JhY2xpemVfZ2V0UHJpY2UoIlVSTCIsIDIzNTAwMCkpOwoKICAgICAgICAvKgogICAgICAgICogYXNzaWduIHBhcnRpYWxseSBlbmNyeXB0ZWQgcXVlcnkgdG8gb3JhY2xpemUKICAgICAgICAqIG9ubHkgdGhlIGFwaUtleSBpcyBlbmNyeXB0ZWQgCiAgICAgICAgKiBpbnRlZ2VyIHF1ZXJ5IGlzIGluIHBsYWluIHRleHQKICAgICAgICAqLwogICAgICAgIGJ5dGVzMzIgcm5nSWQgPSBvcmFjbGl6ZV9xdWVyeSgibmVzdGVkIiwgIltVUkxdIFsnanNvbihodHRwczovL2FwaS5yYW5kb20ub3JnL2pzb24tcnBjLzEvaW52b2tlKS5yZXN1bHQucmFuZG9tW1wic2VyaWFsTnVtYmVyXCIsXCJkYXRhXCJdJywgJ1xcbntcImpzb25ycGNcIjpcIjIuMFwiLFwibWV0aG9kXCI6XCJnZW5lcmF0ZVNpZ25lZEludGVnZXJzXCIsXCJwYXJhbXNcIjp7XCJhcGlLZXlcIjoke1tkZWNyeXB0XSBCTUdEVzVGNzhwSzkxWVM5c2RNdGJiV1NqYjM2dUwwcTJpR29ZcjNOUEVWYUtkL1QrYWJxa21nSVI2cERuRGFONjNXV0VlenQzYkowWituN3Z5ZCt4V21HWUVHd2tja2F6cDhNb3lKS3R6R1drbkJjVFI2MVRmSHY2K0NVSHI1ZzV2OWN0akJNOHFGanYrQWg3WGx4NTRYNUdibmttWG89fSxcIm5cIjoxLFwibWluXCI6MSxcIm1heFwiOjEwMCxcInJlcGxhY2VtZW50XCI6dHJ1ZSxcImJhc2VcIjoxMCR7W2lkZW50aXR5XSBcIn1cIn0sXCJpZFwiOjEke1tpZGVudGl0eV0gXCJ9XCJ9J10iLCBnYXNGb3JPcmFjbGl6ZSk7CiAgICAgICAgCSAgICAgICAgCiAgICAgICAgLyogdG90YWwgbnVtYmVyIG9mIGJldHMgKi8KICAgICAgICB0b3RhbEJldHMgKz0gMTsKICAgICAgICAvKiBtYXAgYmV0IGlkIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8KCQlwbGF5ZXJCZXRJZFtybmdJZF0gPSBybmdJZDsKICAgICAgICAvKiBtYXAgcGxheWVyIGx1Y2t5IG51bWJlciB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCgkJcGxheWVyTnVtYmVyW3JuZ0lkXSA9IHJvbGxVbmRlcjsKICAgICAgICAvKiBtYXAgdmFsdWUgb2Ygd2FnZXIgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLwogICAgICAgIHBsYXllckJldFZhbHVlW3JuZ0lkXSA9IG1zZy52YWx1ZTsKICAgICAgICAvKiBtYXAgcGxheWVyIGFkZHJlc3MgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLwogICAgICAgIHBsYXllckFkZHJlc3Nbcm5nSWRdID0gbXNnLnNlbmRlcjsKICAgICAgICAvKiBzYWZlbHkgbWFwIHBsYXllciBwcm9maXQgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLyAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIHBsYXllclByb2ZpdFtybmdJZF0gPSAoKCgobXNnLnZhbHVlICogKDEwMC0oc2FmZVN1Yihyb2xsVW5kZXIsMSkpKSkgLyAoc2FmZVN1Yihyb2xsVW5kZXIsMSkpK21zZy52YWx1ZSkpKmhvdXNlRWRnZS9ob3VzZUVkZ2VEaXZpc29yKS1tc2cudmFsdWU7ICAgICAgICAKICAgICAgICAvKiBzYWZlbHkgaW5jcmVhc2UgbWF4UGVuZGluZ1BheW91dHMgbGlhYmlsaXR5IC0gY2FsYyBhbGwgcGVuZGluZyBwYXlvdXRzIHVuZGVyIGFzc3VtcHRpb24gdGhleSB3aW4gKi8KICAgICAgICBtYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVBZGQobWF4UGVuZGluZ1BheW91dHMsIHBsYXllclByb2ZpdFtybmdJZF0pOwogICAgICAgIC8qIGNoZWNrIGNvbnRyYWN0IGNhbiBwYXlvdXQgb24gd2luICovCiAgICAgICAgaWYobWF4UGVuZGluZ1BheW91dHMgPj0gY29udHJhY3RCYWxhbmNlKSB0aHJvdzsKICAgICAgICAvKiBwcm92aWRlcyBhY2N1cmF0ZSBudW1iZXJzIGZvciB3ZWIzIGFuZCBhbGxvd3MgZm9yIG1hbnVhbCByZWZ1bmRzIGluIGNhc2Ugb2Ygbm8gb3JhY2xpemUgX19jYWxsYmFjayAqLwogICAgICAgIExvZ0JldChwbGF5ZXJCZXRJZFtybmdJZF0sIHBsYXllckFkZHJlc3Nbcm5nSWRdLCBzYWZlQWRkKHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyUHJvZml0W3JuZ0lkXSksIHBsYXllclByb2ZpdFtybmdJZF0sIHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyTnVtYmVyW3JuZ0lkXSk7ICAgICAgICAgIAoKICAgIH0gICAKICAgICAgICAgICAgIAoKICAgIC8qCiAgICAqIHNlbWktcHVibGljIGZ1bmN0aW9uIC0gb25seSBvcmFjbGl6ZSBjYW4gY2FsbAogICAgKi8KICAgIC8qVExTTm90YXJ5IGZvciBvcmFjbGl6ZSBjYWxsICovCglmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHB1YmxpYyAgIAoJCW9ubHlPcmFjbGl6ZQoJCXBheW91dHNBcmVBY3RpdmUKCXsgIAoKICAgICAgICAvKiBwbGF5ZXIgYWRkcmVzcyBtYXBwZWQgdG8gcXVlcnkgaWQgZG9lcyBub3QgZXhpc3QgKi8KICAgICAgICBpZiAocGxheWVyQWRkcmVzc1tteWlkXT09MHgwKSB0aHJvdzsKICAgICAgICAKICAgICAgICAvKiBrZWVwIG9yYWNsaXplIGhvbmVzdCBieSByZXRyaWV2aW5nIHRoZSBzZXJpYWxOdW1iZXIgZnJvbSByYW5kb20ub3JnIHJlc3VsdCAqLwogICAgICAgIHZhciBzbF9yZXN1bHQgPSByZXN1bHQudG9TbGljZSgpOwogICAgICAgIHNsX3Jlc3VsdC5iZXlvbmQoIlsiLnRvU2xpY2UoKSkudW50aWwoIl0iLnRvU2xpY2UoKSk7CiAgICAgICAgdWludCBzZXJpYWxOdW1iZXJPZlJlc3VsdCA9IHBhcnNlSW50KHNsX3Jlc3VsdC5zcGxpdCgnLCAnLnRvU2xpY2UoKSkudG9TdHJpbmcoKSk7ICAgICAgICAgIAoKCSAgICAvKiBtYXAgcmVzdWx0IHRvIHBsYXllciAqLwogICAgICAgIHBsYXllclJhbmRvbVJlc3VsdFtteWlkXSA9IHBhcnNlSW50KHNsX3Jlc3VsdC5iZXlvbmQoIlsiLnRvU2xpY2UoKSkudW50aWwoIl0iLnRvU2xpY2UoKSkudG9TdHJpbmcoKSk7CiAgICAgICAgCiAgICAgICAgLyogcHJvZHVjZSBpbnRlZ2VyIGJvdW5kZWQgdG8gMS0xMDAgaW5jbHVzaXZlCiAgICAgICAgKiAgdmlhIHNoYTMgcmVzdWx0IGZyb20gcmFuZG9tLm9yZyBhbmQgcHJvb2YgKElQRlMgYWRkcmVzcyBvZiBUTFNOb3RhcnkgcHJvb2YpCiAgICAgICAgKi8KICAgICAgICBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPSB1aW50KHNoYTMocGxheWVyUmFuZG9tUmVzdWx0W215aWRdLCBwcm9vZikpICUgMTAwICsgMTsKICAgICAgICAKICAgICAgICAvKiBnZXQgdGhlIHBsYXllckFkZHJlc3MgZm9yIHRoaXMgcXVlcnkgaWQgKi8KICAgICAgICBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSA9IHBsYXllckFkZHJlc3NbbXlpZF07CiAgICAgICAgLyogZGVsZXRlIHBsYXllckFkZHJlc3MgZm9yIHRoaXMgcXVlcnkgaWQgKi8KICAgICAgICBkZWxldGUgcGxheWVyQWRkcmVzc1tteWlkXTsKCiAgICAgICAgLyogbWFwIHRoZSBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgKi8KICAgICAgICBwbGF5ZXJUZW1wUmV3YXJkW215aWRdID0gcGxheWVyUHJvZml0W215aWRdOwogICAgICAgIC8qIHNldCAgcGxheWVyUHJvZml0IGZvciB0aGlzIHF1ZXJ5IGlkIHRvIDAgKi8KICAgICAgICBwbGF5ZXJQcm9maXRbbXlpZF0gPSAwOyAKCiAgICAgICAgLyogc2FmZWx5IHJlZHVjZSBtYXhQZW5kaW5nUGF5b3V0cyBsaWFiaWxpdHkgKi8KICAgICAgICBtYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVTdWIobWF4UGVuZGluZ1BheW91dHMsIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOyAgICAgICAgIAoKICAgICAgICAvKiBtYXAgdGhlIHBsYXllckJldFZhbHVlIGZvciB0aGlzIHF1ZXJ5IGlkICovCiAgICAgICAgcGxheWVyVGVtcEJldFZhbHVlW215aWRdID0gcGxheWVyQmV0VmFsdWVbbXlpZF07CiAgICAgICAgLyogc2V0ICBwbGF5ZXJCZXRWYWx1ZSBmb3IgdGhpcyBxdWVyeSBpZCB0byAwICovCiAgICAgICAgcGxheWVyQmV0VmFsdWVbbXlpZF0gPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAvKgogICAgICAgICogcmVmdW5kCiAgICAgICAgKiBpZiByZXN1bHQgZnJvbSBvcmFjbGl6ZSBpcyAwIHJlZnVuZCBvbmx5IHRoZSBvcmlnaW5hbCBiZXQgdmFsdWUKICAgICAgICAqIGlmIHJlZnVuZCBmYWlscyBzYXZlIHJlZnVuZCB2YWx1ZSB0byBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHMKICAgICAgICAqLwogICAgICAgIGlmKHBsYXllckRpZVJlc3VsdFtteWlkXT09MCl7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMywgcHJvb2YpOyAgICAgICAgICAgIAoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgKiBzZW5kIHJlZnVuZCAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0CiAgICAgICAgICAgICogaWYgc2VuZCBmYWlscyBtYXAgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQogICAgICAgICAgICAqIGZvciB3aXRoZHJhd2FsIGxhdGVyIHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMKICAgICAgICAgICAgKi8KICAgICAgICAgICAgaWYoIXBsYXllclRlbXBBZGRyZXNzW215aWRdLnNlbmQocGxheWVyVGVtcEJldFZhbHVlW215aWRdKSl7CiAgICAgICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgNCwgcHJvb2YpOyAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8KICAgICAgICAgICAgICAgIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSk7ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgKiBwYXkgd2lubmVyCiAgICAgICAgKiB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBjYWxjdWxhdGUgbmV3IG1heCBiZXQKICAgICAgICAqIHNlbmQgcmV3YXJkCiAgICAgICAgKiBpZiBzZW5kIG9mIHJld2FyZCBmYWlscyBzYXZlIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2FscyAgICAgICAgCiAgICAgICAgKi8KICAgICAgICBpZihwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPCBwbGF5ZXJOdW1iZXJbbXlpZF0peyAKCiAgICAgICAgICAgIC8qIHNhZmVseSByZWR1Y2UgY29udHJhY3QgYmFsYW5jZSBieSBwbGF5ZXIgcHJvZml0ICovCiAgICAgICAgICAgIGNvbnRyYWN0QmFsYW5jZSA9IHNhZmVTdWIoY29udHJhY3RCYWxhbmNlLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsgCgogICAgICAgICAgICAvKiB1cGRhdGUgdG90YWwgd2VpIHdvbiAqLwogICAgICAgICAgICB0b3RhbFdlaVdvbiA9IHNhZmVBZGQodG90YWxXZWlXb24sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOyAgICAgICAgICAgICAgCgogICAgICAgICAgICAvKiBzYWZlbHkgY2FsY3VsYXRlIHBheW91dCB2aWEgcHJvZml0IHBsdXMgb3JpZ2luYWwgd2FnZXIgKi8KICAgICAgICAgICAgcGxheWVyVGVtcFJld2FyZFtteWlkXSA9IHNhZmVBZGQocGxheWVyVGVtcFJld2FyZFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdKTsgCgogICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDEsIHByb29mKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAvKiB1cGRhdGUgbWF4aW11bSBwcm9maXQgKi8KICAgICAgICAgICAgc2V0TWF4UHJvZml0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvKgogICAgICAgICAgICAqIHNlbmQgd2luIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QKICAgICAgICAgICAgKiBpZiBzZW5kIGZhaWxzIG1hcCByZXdhcmQgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW2FkZHJlc3NdCiAgICAgICAgICAgICogZm9yIHdpdGhkcmF3YWwgbGF0ZXIgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucwogICAgICAgICAgICAqLwogICAgICAgICAgICBpZighcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0uc2VuZChwbGF5ZXJUZW1wUmV3YXJkW215aWRdKSl7CiAgICAgICAgICAgICAgICBMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDIsIHByb29mKTsgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8KICAgICAgICAgICAgICAgIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgKiBubyB3aW4KICAgICAgICAqIHNlbmQgMSB3ZWkgdG8gYSBsb3NpbmcgYmV0CiAgICAgICAgKiB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBjYWxjdWxhdGUgbmV3IG1heCBiZXQKICAgICAgICAqLwogICAgICAgIGlmKHBsYXllckRpZVJlc3VsdFtteWlkXSA+PSBwbGF5ZXJOdW1iZXJbbXlpZF0pewoKICAgICAgICAgICAgTG9nUmVzdWx0KHNlcmlhbE51bWJlck9mUmVzdWx0LCBwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0sIDAsIHByb29mKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgLyogIAogICAgICAgICAgICAqICBzYWZlIGFkanVzdCBjb250cmFjdEJhbGFuY2UKICAgICAgICAgICAgKiAgc2V0TWF4UHJvZml0CiAgICAgICAgICAgICogIHNlbmQgMSB3ZWkgdG8gbG9zaW5nIGJldAogICAgICAgICAgICAqLwogICAgICAgICAgICBjb250cmFjdEJhbGFuY2UgPSBzYWZlQWRkKGNvbnRyYWN0QmFsYW5jZSwgKHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXS0xKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgLyogdXBkYXRlIG1heGltdW0gcHJvZml0ICovCiAgICAgICAgICAgIHNldE1heFByb2ZpdCgpOyAKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICogc2VuZCAxIHdlaSAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0ICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICovCiAgICAgICAgICAgIGlmKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKDEpKXsKICAgICAgICAgICAgICAgIC8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSA9IHNhZmVBZGQocGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSwgMSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICByZXR1cm47CgogICAgICAgIH0KCiAgICB9CiAgICAKICAgIC8qCiAgICAqIHB1YmxpYyBmdW5jdGlvbgogICAgKiBpbiBjYXNlIG9mIGEgZmFpbGVkIHJlZnVuZCBvciB3aW4gc2VuZAogICAgKi8KICAgIGZ1bmN0aW9uIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucygpIHB1YmxpYyAKICAgICAgICBwYXlvdXRzQXJlQWN0aXZlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgICB7CiAgICAgICAgdWludCB3aXRoZHJhd0Ftb3VudCA9IHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXTsKICAgICAgICBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIC8qIGV4dGVybmFsIGNhbGwgdG8gdW50cnVzdGVkIGNvbnRyYWN0ICovCiAgICAgICAgaWYgKG1zZy5zZW5kZXIuY2FsbC52YWx1ZSh3aXRoZHJhd0Ftb3VudCkoKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvKiBpZiBzZW5kIGZhaWxlZCByZXZlcnQgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsgKi8KICAgICAgICAgICAgLyogcGxheWVyIGNhbiB0cnkgdG8gd2l0aGRyYXcgYWdhaW4gbGF0ZXIgKi8KICAgICAgICAgICAgcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gd2l0aGRyYXdBbW91bnQ7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyogY2hlY2sgZm9yIHBlbmRpbmcgd2l0aGRyYXdhbHMgICovCiAgICBmdW5jdGlvbiBwbGF5ZXJHZXRQZW5kaW5nVHhCeUFkZHJlc3MoYWRkcmVzcyBhZGRyZXNzVG9DaGVjaykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW2FkZHJlc3NUb0NoZWNrXTsKICAgIH0KCiAgICAvKgogICAgKiBpbnRlcm5hbCBmdW5jdGlvbgogICAgKiBzZXRzIG1heCBwcm9maXQKICAgICovCiAgICBmdW5jdGlvbiBzZXRNYXhQcm9maXQoKSBpbnRlcm5hbCB7CiAgICAgICAgbWF4UHJvZml0ID0gKGNvbnRyYWN0QmFsYW5jZSptYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKS9tYXhQcm9maXREaXZpc29yOyAgCiAgICB9ICAgCgogICAgLyoKICAgICogb3duZXIvdHJlYXN1cnkgYWRkcmVzcyBvbmx5IGZ1bmN0aW9ucwogICAgKi8KICAgIGZ1bmN0aW9uICgpCiAgICAgICAgcGF5YWJsZQogICAgICAgIG9ubHlUcmVhc3VyeQogICAgewogICAgICAgIC8qIHNhZmVseSB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSAqLwogICAgICAgIGNvbnRyYWN0QmFsYW5jZSA9IHNhZmVBZGQoY29udHJhY3RCYWxhbmNlLCBtc2cudmFsdWUpOyAgICAgICAgCiAgICAgICAgLyogdXBkYXRlIHRoZSBtYXhpbXVtIHByb2ZpdCAqLwogICAgICAgIHNldE1heFByb2ZpdCgpOwogICAgfSAKCiAgICAvKiBzZXQgZ2FzIGZvciBvcmFjbGl6ZSBxdWVyeSAqLwogICAgZnVuY3Rpb24gb3duZXJTZXRPcmFjbGl6ZVNhZmVHYXModWludDMyIG5ld1NhZmVHYXNUb09yYWNsaXplKSBwdWJsaWMgCgkJb25seU93bmVyCgl7CiAgICAJZ2FzRm9yT3JhY2xpemUgPSBuZXdTYWZlR2FzVG9PcmFjbGl6ZTsKICAgIH0KCiAgICAvKiBzZXQgaG91c2UgY29zdCB0byBjYWxsIG9yYWNsaXplIHF1ZXJ5ICovCiAgICBmdW5jdGlvbiBvd25lclVwZGF0ZUNvc3RUb0NhbGxPcmFjbGl6ZSh1aW50IG5ld0Nvc3RUb0NhbGxPcmFjbGl6ZUluV2VpKSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7ICAgICAgICAKICAgICAgIGNvc3RUb0NhbGxPcmFjbGl6ZUluV2VpID0gbmV3Q29zdFRvQ2FsbE9yYWNsaXplSW5XZWk7CiAgICB9ICAgICAKCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBob3VzZUVkZ2UgKi8KICAgIGZ1bmN0aW9uIG93bmVyU2V0SG91c2VFZGdlKHVpbnQgbmV3SG91c2VFZGdlKSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7CiAgICAgICAgaG91c2VFZGdlID0gbmV3SG91c2VFZGdlOwogICAgfQoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IG1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UgKi8KICAgIGZ1bmN0aW9uIG93bmVyU2V0TWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSh1aW50IG5ld01heFByb2ZpdEFzUGVyY2VudCkgcHVibGljIAoJCW9ubHlPd25lcgogICAgewogICAgICAgIC8qIHJlc3RyaWN0IGVhY2ggYmV0IHRvIGEgbWF4aW11bSBwcm9maXQgb2YgMSUgY29udHJhY3RCYWxhbmNlICovCiAgICAgICAgaWYobmV3TWF4UHJvZml0QXNQZXJjZW50ID4gMTAwMDApIHRocm93OwogICAgICAgIG1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UgPSBuZXdNYXhQcm9maXRBc1BlcmNlbnQ7CiAgICAgICAgc2V0TWF4UHJvZml0KCk7CiAgICB9CgogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgbWluQmV0ICovCiAgICBmdW5jdGlvbiBvd25lclNldE1pbkJldCh1aW50IG5ld01pbmltdW1CZXQpIHB1YmxpYyAKCQlvbmx5T3duZXIKICAgIHsKICAgICAgICBtaW5CZXQgPSBuZXdNaW5pbXVtQmV0OwogICAgfSAgICAgICAKCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHRyYW5zZmVyIGV0aGVyICovCiAgICBmdW5jdGlvbiBvd25lclRyYW5zZmVyRXRoZXIoYWRkcmVzcyBzZW5kVG8sIHVpbnQgYW1vdW50KSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7ICAgICAgICAKICAgICAgICAvKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2Ugd2hlbiBzZW5kaW5nIG91dCBmdW5kcyovCiAgICAgICAgY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIGFtb3VudCk7CQkKICAgICAgICAvKiB1cGRhdGUgbWF4IHByb2ZpdCAqLwogICAgICAgIHNldE1heFByb2ZpdCgpOwogICAgICAgIGlmKCFzZW5kVG8uc2VuZChhbW91bnQpKSB0aHJvdzsKICAgICAgICBMb2dPd25lclRyYW5zZmVyKHNlbmRUbywgYW1vdW50KTsgCiAgICB9CgogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBkbyBtYW51YWwgcmVmdW5kCiAgICAqIHVzZWQgb25seSBpZiBiZXQgcGxhY2VkICsgb3JhY2xpemUgZmFpbGVkIHRvIF9fY2FsbGJhY2sKICAgICogZmlsdGVyIExvZ0JldCBieSBhZGRyZXNzIGFuZC9vciBwbGF5ZXJCZXRJZDoKICAgICogTG9nQmV0KHBsYXllckJldElkW3JuZ0lkXSwgcGxheWVyQWRkcmVzc1tybmdJZF0sIHNhZmVBZGQocGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJQcm9maXRbcm5nSWRdKSwgcGxheWVyUHJvZml0W3JuZ0lkXSwgcGxheWVyQmV0VmFsdWVbcm5nSWRdLCBwbGF5ZXJOdW1iZXJbcm5nSWRdKTsKICAgICogY2hlY2sgdGhlIGZvbGxvd2luZyBsb2dzIGRvIG5vdCBleGlzdCBmb3IgcGxheWVyQmV0SWQgYW5kL29yIHBsYXllckFkZHJlc3Nbcm5nSWRdIGJlZm9yZSByZWZ1bmRpbmc6CiAgICAqIExvZ1Jlc3VsdCBvciBMb2dSZWZ1bmQKICAgICogaWYgTG9nUmVzdWx0IGV4aXN0cyBwbGF5ZXIgc2hvdWxkIHVzZSB0aGUgd2l0aGRyYXcgcGF0dGVybiBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgCiAgICAqLwogICAgZnVuY3Rpb24gb3duZXJSZWZ1bmRQbGF5ZXIoYnl0ZXMzMiBvcmlnaW5hbFBsYXllckJldElkLCBhZGRyZXNzIHNlbmRUbywgdWludCBvcmlnaW5hbFBsYXllclByb2ZpdCwgdWludCBvcmlnaW5hbFBsYXllckJldFZhbHVlKSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7ICAgICAgICAKICAgICAgICAvKiBzYWZlbHkgcmVkdWNlIHBlbmRpbmdQYXlvdXRzIGJ5IHBsYXllclByb2ZpdFtybmdJZF0gKi8KICAgICAgICBtYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVTdWIobWF4UGVuZGluZ1BheW91dHMsIG9yaWdpbmFsUGxheWVyUHJvZml0KTsKICAgICAgICAvKiBzZW5kIHJlZnVuZCAqLwogICAgICAgIGlmKCFzZW5kVG8uc2VuZChvcmlnaW5hbFBsYXllckJldFZhbHVlKSkgdGhyb3c7CiAgICAgICAgLyogbG9nIHJlZnVuZHMgKi8KICAgICAgICBMb2dSZWZ1bmQob3JpZ2luYWxQbGF5ZXJCZXRJZCwgc2VuZFRvLCBvcmlnaW5hbFBsYXllckJldFZhbHVlKTsgICAgICAgIAogICAgfSAgICAKCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBlbWVyZ2VuY3kgcGF1c2UgIzEgKi8KICAgIGZ1bmN0aW9uIG93bmVyUGF1c2VHYW1lKGJvb2wgbmV3U3RhdHVzKSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7CgkJZ2FtZVBhdXNlZCA9IG5ld1N0YXR1czsKICAgIH0KCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBlbWVyZ2VuY3kgcGF1c2UgIzIgKi8KICAgIGZ1bmN0aW9uIG93bmVyUGF1c2VQYXlvdXRzKGJvb2wgbmV3UGF5b3V0U3RhdHVzKSBwdWJsaWMgCgkJb25seU93bmVyCiAgICB7CgkJcGF5b3V0c1BhdXNlZCA9IG5ld1BheW91dFN0YXR1czsKICAgIH0gCgogICAgLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgdHJlYXN1cnkgYWRkcmVzcyAqLwogICAgZnVuY3Rpb24gb3duZXJTZXRUcmVhc3VyeShhZGRyZXNzIG5ld1RyZWFzdXJ5KSBwdWJsaWMgCgkJb25seU93bmVyCgl7CiAgICAgICAgdHJlYXN1cnkgPSBuZXdUcmVhc3VyeTsKICAgIH0gICAgICAgICAKCiAgICAvKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBvd25lciBhZGRyZXNzICovCiAgICBmdW5jdGlvbiBvd25lckNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyAKCQlvbmx5T3duZXIKCXsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKICAgIC8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc3VpY2lkZSAtIGVtZXJnZW5jeSAqLwogICAgZnVuY3Rpb24gb3duZXJraWxsKCkgcHVibGljIAoJCW9ubHlPd25lcgoJewoJCXN1aWNpZGUob3duZXIpOwoJfSAgICAKCgp9'.
	

]
