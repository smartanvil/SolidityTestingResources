Class {
	#name : #SRT1440317CB15499083dEE3dDf49C2bD51D0d92e33,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1440317CB15499083dEE3dDf49C2bD51D0d92e33 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgpsaWJyYXJ5IEVDVmVyaWZ5IHsKCiAgICBmdW5jdGlvbiBlY3ZlcmlmeShieXRlczMyIGhhc2gsIGJ5dGVzIHNpZ25hdHVyZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChhZGRyZXNzIHNpZ25hdHVyZV9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShzaWduYXR1cmUubGVuZ3RoID09IDY1KTsKCiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnbmF0dXJlLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZ25hdHVyZSwgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcywgaW5jbHVkaW5nIDMxIGJ5dGVzIG9mICdzJy4KICAgICAgICAgICAgdiA6PSBieXRlKDAsIG1sb2FkKGFkZChzaWduYXR1cmUsIDk2KSkpCiAgICAgICAgfQoKICAgICAgICAvLyBWZXJzaW9uIG9mIHNpZ25hdHVyZSBzaG91bGQgYmUgMjcgb3IgMjgsIGJ1dCAwIGFuZCAxIGFyZSBhbHNvIHBvc3NpYmxlCiAgICAgICAgaWYgKHYgPCAyNykgewogICAgICAgICAgICB2ICs9IDI3OwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZSh2ID09IDI3IHx8IHYgPT0gMjgpOwoKICAgICAgICBzaWduYXR1cmVfYWRkcmVzcyA9IGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKCiAgICAgICAgLy8gZWNyZWNvdmVyIHJldHVybnMgemVybyBvbiBlcnJvcgogICAgICAgIHJlcXVpcmUoc2lnbmF0dXJlX2FkZHJlc3MgIT0gMHgwKTsKCiAgICAgICAgcmV0dXJuIHNpZ25hdHVyZV9hZGRyZXNzOwogICAgfQp9CgovLy8gQHRpdGxlIEJhc2UgVG9rZW4gY29udHJhY3QgLSBGdW5jdGlvbnMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgdG9rZW4gY29udHJhY3RzLgpjb250cmFjdCBUb2tlbiB7CiAgICAvKgogICAgICogSW1wbGVtZW50cyBFUkMgMjAgc3RhbmRhcmQuCiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL2Y5MDg2NGEzZDJiMmI0NWM0ZGVjZjk1ZWZkMjZiM2YwYzI3NjA1MWEvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogICAgICoKICAgICAqICBBZGRlZCBzdXBwb3J0IGZvciB0aGUgRVJDIDIyMyAidG9rZW5GYWxsYmFjayIgbWV0aG9kIGluIGEgInRyYW5zZmVyIiBmdW5jdGlvbiB3aXRoIGEgcGF5bG9hZC4KICAgICAqICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjIzCiAgICAgKi8KCiAgICAvKgogICAgICogVGhpcyBpcyBhIHNsaWdodCBjaGFuZ2UgdG8gdGhlIEVSQzIwIGJhc2Ugc3RhbmRhcmQuCiAgICAgKiBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKICAgICAqIGlzIHJlcGxhY2VkIHdpdGg6CiAgICAgKiB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgICAqIFRoaXMgYXV0b21hdGljYWxseSBjcmVhdGVzIGEgZ2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgdG90YWxTdXBwbHkuCiAgICAgKiBUaGlzIGlzIG1vdmVkIHRvIHRoZSBiYXNlIGNvbnRyYWN0IHNpbmNlIHB1YmxpYyBnZXR0ZXIgZnVuY3Rpb25zIGFyZSBub3QKICAgICAqIGN1cnJlbnRseSByZWNvZ25pc2VkIGFzIGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBtYXRjaGluZyBhYnN0cmFjdAogICAgICogZnVuY3Rpb24gYnkgdGhlIGNvbXBpbGVyLgogICAgICovCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICAvKgogICAgICogTk9URToKICAgICAqIFRoZSBmb2xsb3dpbmcgdmFyaWFibGVzIHdlcmUgb3B0aW9uYWwuIE5vdywgdGhleSBhcmUgaW5jbHVkZWQgaW4gRVJDIDIyMyBpbnRlcmZhY2UuCiAgICAgKiBUaGV5IGFsbG93IG9uZSB0byBjdXN0b21pc2UgdGhlIHRva2VuIGNvbnRyYWN0ICYgaW4gbm8gd2F5IGluZmx1ZW5jZXMgdGhlIGNvcmUgZnVuY3Rpb25hbGl0eS4KICAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAgICAvL2ZhbmN5IG5hbWU6IGVnIFNpbW9uIEJ1Y2tzCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgICAgIC8vSG93IG1hbnkgZGVjaW1hbHMgdG8gc2hvdy4gaWUuIFRoZXJlIGNvdWxkIDEwMDAgYmFzZSB1bml0cyB3aXRoIDMgZGVjaW1hbHMuIE1lYW5pbmcgMC45ODAgU0JYID0gOTgwIGJhc2UgdW5pdHMuIEl0J3MgbGlrZSBjb21wYXJpbmcgMSB3ZWkgdG8gMSBldGhlci4KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlZyBTQlgKCgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZC4KICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAvLy8gQHBhcmFtIF9kYXRhIERhdGEgdG8gYmUgc2VudCB0byBgdG9rZW5GYWxsYmFjay4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90LgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyLgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90LgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zLgogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudC4KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICAvKgogICAgICogRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8gVGhlcmUgaXMgbm8gRVJDMjIzIGNvbXBhdGlibGUgVHJhbnNmZXIgZXZlbnQsIHdpdGggYF9kYXRhYCBpbmNsdWRlZC4KfQoKCi8vLyBAdGl0bGUgUmFpZGVuIE1pY3JvVHJhbnNmZXIgQ2hhbm5lbHMgQ29udHJhY3QuCmNvbnRyYWN0IFJhaWRlbk1pY3JvVHJhbnNmZXJDaGFubmVscyB7CgogICAgLyoKICAgICAqICBEYXRhIHN0cnVjdHVyZXMKICAgICAqLwoKICAgIC8vIFRoZSBvbmx5IHJvbGUgb2YgdGhlIG93bmVyX2FkZHJlc3MgaXMgdG8gYWRkIG9yIHJlbW92ZSB0cnVzdGVkIGNvbnRyYWN0cwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXJfYWRkcmVzczsKCiAgICAvLyBOdW1iZXIgb2YgYmxvY2tzIHRvIHdhaXQgZnJvbSBhbiB1bmNvb3BlcmF0aXZlQ2xvc2UgaW5pdGlhdGVkIGJ5IHRoZSBzZW5kZXIKICAgIC8vIGluIG9yZGVyIHRvIGdpdmUgdGhlIHJlY2VpdmVyIGEgY2hhbmNlIHRvIHJlc3BvbmQgd2l0aCBhIGJhbGFuY2UgcHJvb2YKICAgIC8vIGluIGNhc2UgdGhlIHNlbmRlciBjaGVhdHMuIEFmdGVyIHRoZSBjaGFsbGVuZ2UgcGVyaW9kLCB0aGUgc2VuZGVyIGNhbiBzZXR0bGUKICAgIC8vIGFuZCBkZWxldGUgdGhlIGNoYW5uZWwuCiAgICB1aW50MzIgcHVibGljIGNoYWxsZW5nZV9wZXJpb2Q7CgogICAgLy8gQ29udHJhY3Qgc2VtYW50aWMgdmVyc2lvbgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCB2ZXJzaW9uID0gJzAuMi4wJzsKCiAgICAvLyBXZSB0ZW1wb3JhcmlseSBsaW1pdCB0b3RhbCB0b2tlbiBkZXBvc2l0cyBpbiBhIGNoYW5uZWwgdG8gMTAwIHRva2VucyB3aXRoIDE4IGRlY2ltYWxzLgogICAgLy8gVGhpcyB3YXMgY2FsY3VsYXRlZCBqdXN0IGZvciBSRE4gd2l0aCBpdHMgY3VycmVudCAoYXMgb2YgMzAvMTEvMjAxNykgcHJpY2UgYW5kIHNob3VsZAogICAgLy8gbm90IGJlIGNvbnNpZGVyZWQgdG8gYmUgdGhlIHNhbWUgZm9yIG90aGVyIHRva2Vucy4KICAgIC8vIFRoaXMgaXMganVzdCBmb3IgdGhlIGJ1ZyBib3VudHkgcmVsZWFzZSwgYXMgYSBzYWZldHkgbWVhc3VyZS4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGNoYW5uZWxfZGVwb3NpdF9idWdib3VudHlfbGltaXQgPSAxMCAqKiAxOCAqIDEwMDsKCiAgICBUb2tlbiBwdWJsaWMgdG9rZW47CgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBDaGFubmVsKSBwdWJsaWMgY2hhbm5lbHM7CiAgICBtYXBwaW5nIChieXRlczMyID0+IENsb3NpbmdSZXF1ZXN0KSBwdWJsaWMgY2xvc2luZ19yZXF1ZXN0czsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRydXN0ZWRfY29udHJhY3RzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50MTkyKSBwdWJsaWMgd2l0aGRyYXduX2JhbGFuY2VzOwoKICAgIC8vIDI0IGJ5dGVzIChkZXBvc2l0KSArIDQgYnl0ZXMgKGJsb2NrIG51bWJlcikKICAgIHN0cnVjdCBDaGFubmVsIHsKICAgICAgICAvLyB1aW50MTkyIGlzIHRoZSBtYXhpbXVtIHVpbnQgc2l6ZSBuZWVkZWQgZm9yIGRlcG9zaXQgYmFzZWQgb24gYQogICAgICAgIC8vIDEwXjggKiAxMF4xOCB0b2tlbiB0b3RhbFN1cHBseS4KICAgICAgICB1aW50MTkyIGRlcG9zaXQ7CgogICAgICAgIC8vIEJsb2NrIG51bWJlciBhdCB3aGljaCB0aGUgY2hhbm5lbCB3YXMgb3BlbmVkLiBVc2VkIGluIGNyZWF0aW5nCiAgICAgICAgLy8gYSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIGNoYW5uZWwgYmV0d2VlbiBhIHNlbmRlciBhbmQgcmVjZWl2ZXIuCiAgICAgICAgLy8gU3VwcG9ydHMgY3JlYXRpb24gb2YgbXVsdGlwbGUgY2hhbm5lbHMgYmV0d2VlbiB0aGUgMiBwYXJ0aWVzIGFuZCBwcmV2ZW50cwogICAgICAgIC8vIHJlcGxheSBvZiBtZXNzYWdlcyBpbiBsYXRlciBjaGFubmVscy4KICAgICAgICB1aW50MzIgb3Blbl9ibG9ja19udW1iZXI7CiAgICB9CgogICAgLy8gMjQgYnl0ZXMgKGRlcG9zaXQpICsgNCBieXRlcyAoYmxvY2sgbnVtYmVyKQogICAgc3RydWN0IENsb3NpbmdSZXF1ZXN0IHsKICAgICAgICAvLyBOdW1iZXIgb2YgdG9rZW5zIG93ZWQgYnkgdGhlIHNlbmRlciB3aGVuIGNsb3NpbmcgdGhlIGNoYW5uZWwuCiAgICAgICAgdWludDE5MiBjbG9zaW5nX2JhbGFuY2U7CgogICAgICAgIC8vIEJsb2NrIG51bWJlciBhdCB3aGljaCB0aGUgY2hhbGxlbmdlIHBlcmlvZCBlbmRzLCBpbiBjYXNlIGl0IGhhcyBiZWVuIGluaXRpYXRlZC4KICAgICAgICB1aW50MzIgc2V0dGxlX2Jsb2NrX251bWJlcjsKICAgIH0KCiAgICAvKgogICAgICogTW9kaWZpZXJzCiAgICAgKi8KCiAgICBtb2RpZmllciBpc093bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcl9hZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzVHJ1c3RlZENvbnRyYWN0KCkgewogICAgICAgIHJlcXVpcmUodHJ1c3RlZF9jb250cmFjdHNbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwoKICAgIGV2ZW50IENoYW5uZWxDcmVhdGVkKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc2VuZGVyX2FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9yZWNlaXZlcl9hZGRyZXNzLAogICAgICAgIHVpbnQxOTIgX2RlcG9zaXQpOwogICAgZXZlbnQgQ2hhbm5lbFRvcHBlZFVwICgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICB1aW50MzIgaW5kZXhlZCBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgdWludDE5MiBfYWRkZWRfZGVwb3NpdCk7CiAgICBldmVudCBDaGFubmVsQ2xvc2VSZXF1ZXN0ZWQoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zZW5kZXJfYWRkcmVzcywKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIGluZGV4ZWQgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgIHVpbnQxOTIgX2JhbGFuY2UpOwogICAgZXZlbnQgQ2hhbm5lbFNldHRsZWQoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zZW5kZXJfYWRkcmVzcywKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIGluZGV4ZWQgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgIHVpbnQxOTIgX2JhbGFuY2UsCiAgICAgICAgdWludDE5MiBfcmVjZWl2ZXJfdG9rZW5zKTsKICAgIGV2ZW50IENoYW5uZWxXaXRoZHJhdygKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICB1aW50MzIgaW5kZXhlZCBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgdWludDE5MiBfd2l0aGRyYXduX2JhbGFuY2UpOwogICAgZXZlbnQgVHJ1c3RlZENvbnRyYWN0KAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfdHJ1c3RlZF9jb250cmFjdF9hZGRyZXNzLAogICAgICAgIGJvb2wgX3RydXN0ZWRfc3RhdHVzKTsKCgogICAgLyoKICAgICAqICBDb25zdHJ1Y3RvcgogICAgICovCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgZm9yIGNyZWF0aW5nIHRoZSB1UmFpZGVuIG1pY3JvdHJhbnNmZXIgY2hhbm5lbHMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbl9hZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBUb2tlbiB1c2VkIGJ5IHRoZSB1UmFpZGVuIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfY2hhbGxlbmdlX3BlcmlvZCBBIGZpeGVkIG51bWJlciBvZiBibG9ja3MgcmVwcmVzZW50aW5nIHRoZSBjaGFsbGVuZ2UgcGVyaW9kLgogICAgLy8vIFdlIGVuZm9yY2UgYSBtaW5pbXVtIG9mIDUwMCBibG9ja3Mgd2FpdGluZyBwZXJpb2QuCiAgICAvLy8gYWZ0ZXIgYSBzZW5kZXIgcmVxdWVzdHMgdGhlIGNsb3Npbmcgb2YgdGhlIGNoYW5uZWwgd2l0aG91dCB0aGUgcmVjZWl2ZXIncyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIF90cnVzdGVkX2NvbnRyYWN0cyBBcnJheSBvZiBjb250cmFjdCBhZGRyZXNzZXMgdGhhdCBjYW4gYmUgdHJ1c3RlZCB0bwogICAgLy8vIG9wZW4gYW5kIHRvcCB1cCBjaGFubmVscyBvbiBiZWhhbGYgb2YgYSBzZW5kZXIuCiAgICBmdW5jdGlvbiBSYWlkZW5NaWNyb1RyYW5zZmVyQ2hhbm5lbHMoCiAgICAgICAgYWRkcmVzcyBfdG9rZW5fYWRkcmVzcywKICAgICAgICB1aW50MzIgX2NoYWxsZW5nZV9wZXJpb2QsCiAgICAgICAgYWRkcmVzc1tdIF90cnVzdGVkX2NvbnRyYWN0cykKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF90b2tlbl9hZGRyZXNzICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzSGFzQ29kZShfdG9rZW5fYWRkcmVzcykpOwogICAgICAgIHJlcXVpcmUoX2NoYWxsZW5nZV9wZXJpb2QgPj0gNTAwKTsKCiAgICAgICAgdG9rZW4gPSBUb2tlbihfdG9rZW5fYWRkcmVzcyk7CgogICAgICAgIC8vIENoZWNrIGlmIHRoZSBjb250cmFjdCBpcyBpbmRlZWQgYSB0b2tlbiBjb250cmFjdAogICAgICAgIHJlcXVpcmUodG9rZW4udG90YWxTdXBwbHkoKSA+IDApOwoKICAgICAgICBjaGFsbGVuZ2VfcGVyaW9kID0gX2NoYWxsZW5nZV9wZXJpb2Q7CiAgICAgICAgb3duZXJfYWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgYWRkVHJ1c3RlZENvbnRyYWN0cyhfdHJ1c3RlZF9jb250cmFjdHMpOwogICAgfQoKICAgIC8qCiAgICAgKiAgRXh0ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvLy8gQG5vdGljZSBPcGVucyBhIG5ldyBjaGFubmVsIG9yIHRvcHMgdXAgYW4gZXhpc3Rpbmcgb25lLCBjb21wYXRpYmlsaXR5IHdpdGggRVJDIDIyMy4KICAgIC8vLyBAZGV2IENhbiBvbmx5IGJlIGNhbGxlZCBmcm9tIHRoZSB0cnVzdGVkIFRva2VuIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfc2VuZGVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2RlcG9zaXQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB0aGUgc2VuZGVyIGVzY3Jvd3MuCiAgICAvLy8gQHBhcmFtIF9kYXRhIERhdGEgbmVlZGVkIGZvciBlaXRoZXIgY3JlYXRpbmcgYSBjaGFubmVsIG9yIHRvcHBpbmcgaXQgdXAuCiAgICAvLy8gSXQgYWx3YXlzIGNvbnRhaW5zIHRoZSBzZW5kZXIgYW5kIHJlY2VpdmVyIGFkZHJlc3NlcyArLy0gYSBibG9jayBudW1iZXIuCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX3NlbmRlcl9hZGRyZXNzLCB1aW50MjU2IF9kZXBvc2l0LCBieXRlcyBfZGF0YSkgZXh0ZXJuYWwgewogICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSB0cnVzdCB0aGUgdG9rZW4KICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0b2tlbikpOwoKICAgICAgICB1aW50MTkyIGRlcG9zaXQgPSB1aW50MTkyKF9kZXBvc2l0KTsKICAgICAgICByZXF1aXJlKGRlcG9zaXQgPT0gX2RlcG9zaXQpOwoKICAgICAgICAvLyBDcmVhdGUgY2hhbm5lbCAtIHNlbmRlciBhZGRyZXNzICsgcmVjZWl2ZXIgYWRkcmVzcyA9IDIgKiAyMCBieXRlcwogICAgICAgIC8vIFRvcCB1cCBjaGFubmVsIC0gc2VuZGVyIGFkZHJlc3MgKyByZWNlaXZlciBhZGRyZXNzICsgYmxvY2sgbnVtYmVyID0gMiAqIDIwICsgNCBieXRlcwogICAgICAgIHVpbnQgbGVuZ3RoID0gX2RhdGEubGVuZ3RoOwogICAgICAgIHJlcXVpcmUobGVuZ3RoID09IDQwIHx8IGxlbmd0aCA9PSA0NCk7CgogICAgICAgIC8vIE9mZnNldCBvZiAzMiBieXRlcywgcmVwcmVzZW50aW5nIF9kYXRhLmxlbmd0aAogICAgICAgIGFkZHJlc3MgY2hhbm5lbF9zZW5kZXJfYWRkcmVzcyA9IGFkZHJlc3MoYWRkcmVzc0Zyb21CeXRlcyhfZGF0YSwgMHgyMCkpOwoKICAgICAgICAvLyBUaGUgY2hhbm5lbCBjYW4gYmUgb3BlbmVkIGJ5IHRoZSBzZW5kZXIgb3IgYnkgYSB0cnVzdGVkIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShfc2VuZGVyX2FkZHJlc3MgPT0gY2hhbm5lbF9zZW5kZXJfYWRkcmVzcyB8fCB0cnVzdGVkX2NvbnRyYWN0c1tfc2VuZGVyX2FkZHJlc3NdKTsKCiAgICAgICAgLy8gT2Zmc2V0IG9mIDMyIGJ5dGVzIChkYXRhLmxlbmd0aCkgKyAyMCBieXRlcyAoc2VuZGVyIGFkZHJlc3MpCiAgICAgICAgYWRkcmVzcyBjaGFubmVsX3JlY2VpdmVyX2FkZHJlc3MgPSBhZGRyZXNzKGFkZHJlc3NGcm9tQnl0ZXMoX2RhdGEsIDB4MzQpKTsKCiAgICAgICAgaWYgKGxlbmd0aCA9PSA0MCkgewogICAgICAgICAgICBjcmVhdGVDaGFubmVsUHJpdmF0ZShjaGFubmVsX3NlbmRlcl9hZGRyZXNzLCBjaGFubmVsX3JlY2VpdmVyX2FkZHJlc3MsIGRlcG9zaXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE9mZnNldCBvZjogMzIgYnl0ZXMgKF9kYXRhLmxlbmd0aCkgKyAyMCBieXRlcyAoc2VuZGVyIGFkZHJlc3MpCiAgICAgICAgICAgIC8vICsgMjAgYnl0ZXMgKHJlY2VpdmVyIGFkZHJlc3MpCiAgICAgICAgICAgIHVpbnQzMiBvcGVuX2Jsb2NrX251bWJlciA9IHVpbnQzMihibG9ja051bWJlckZyb21CeXRlcyhfZGF0YSwgMHg0OCkpOwogICAgICAgICAgICB1cGRhdGVJbnRlcm5hbEJhbGFuY2VTdHJ1Y3RzKAogICAgICAgICAgICAgICAgY2hhbm5lbF9zZW5kZXJfYWRkcmVzcywKICAgICAgICAgICAgICAgIGNoYW5uZWxfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICAgICAgICAgIG9wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgICAgICAgICAgZGVwb3NpdAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNoYW5uZWwgYmV0d2VlbiBgbXNnLnNlbmRlcmAgYW5kIGBfcmVjZWl2ZXJfYWRkcmVzc2AgYW5kIHRyYW5zZmVycwogICAgLy8vIHRoZSBgX2RlcG9zaXRgIHRva2VuIGRlcG9zaXQgdG8gdGhpcyBjb250cmFjdC4gQ29tcGF0aWJpbGl0eSB3aXRoIEVSQzIwIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9kZXBvc2l0IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgdGhlIHNlbmRlciBlc2Nyb3dzLgogICAgZnVuY3Rpb24gY3JlYXRlQ2hhbm5lbChhZGRyZXNzIF9yZWNlaXZlcl9hZGRyZXNzLCB1aW50MTkyIF9kZXBvc2l0KSBleHRlcm5hbCB7CiAgICAgICAgY3JlYXRlQ2hhbm5lbFByaXZhdGUobXNnLnNlbmRlciwgX3JlY2VpdmVyX2FkZHJlc3MsIF9kZXBvc2l0KTsKCiAgICAgICAgLy8gdHJhbnNmZXJGcm9tIGRlcG9zaXQgZnJvbSBtc2cuc2VuZGVyIHRvIGNvbnRyYWN0CiAgICAgICAgLy8gISBuZWVkcyBwcmlvciBhcHByb3ZhbCBmcm9tIG1zZy5zZW5kZXIKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBhZGRyZXNzKHRoaXMpLCBfZGVwb3NpdCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRoYXQgYWxsb3dzIGEgZGVsZWdhdGUgY29udHJhY3QgdG8gY3JlYXRlIGEgbmV3IGNoYW5uZWwgYmV0d2VlbgogICAgLy8vIGBfc2VuZGVyX2FkZHJlc3NgIGFuZCBgX3JlY2VpdmVyX2FkZHJlc3NgIGFuZCB0cmFuc2ZlcnMgdGhlIHRva2VuIGRlcG9zaXQgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBDYW4gb25seSBiZSBjYWxsZWQgYnkgYSB0cnVzdGVkIGNvbnRyYWN0LiBDb21wYXRpYmlsaXR5IHdpdGggRVJDMjAgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfc2VuZGVyX2FkZHJlc3MgVGhlIHNlbmRlcidzIGFkZHJlc3MgaW4gYmVoYWxmIG9mIHdob20gdGhlIGRlbGVnYXRlIHNlbmRzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9kZXBvc2l0IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgdGhlIHNlbmRlciBlc2Nyb3dzLgogICAgZnVuY3Rpb24gY3JlYXRlQ2hhbm5lbERlbGVnYXRlKAogICAgICAgIGFkZHJlc3MgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDE5MiBfZGVwb3NpdCkKICAgICAgICBpc1RydXN0ZWRDb250cmFjdAogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgY3JlYXRlQ2hhbm5lbFByaXZhdGUoX3NlbmRlcl9hZGRyZXNzLCBfcmVjZWl2ZXJfYWRkcmVzcywgX2RlcG9zaXQpOwoKICAgICAgICAvLyB0cmFuc2ZlckZyb20gZGVwb3NpdCBmcm9tIG1zZy5zZW5kZXIgdG8gY29udHJhY3QKICAgICAgICAvLyAhIG5lZWRzIHByaW9yIGFwcHJvdmFsIGZyb20gbXNnLnNlbmRlcgogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3ModGhpcyksIF9kZXBvc2l0KSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSW5jcmVhc2UgdGhlIGNoYW5uZWwgZGVwb3NpdCB3aXRoIGBfYWRkZWRfZGVwb3NpdGAuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlcl9hZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgcmVjZWl2ZXMgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfb3Blbl9ibG9ja19udW1iZXIgVGhlIGJsb2NrIG51bWJlciBhdCB3aGljaCBhIGNoYW5uZWwgYmV0d2VlbiB0aGUKICAgIC8vLyBzZW5kZXIgYW5kIHJlY2VpdmVyIHdhcyBjcmVhdGVkLgogICAgLy8vIEBwYXJhbSBfYWRkZWRfZGVwb3NpdCBUaGUgYWRkZWQgdG9rZW4gZGVwb3NpdCB3aXRoIHdoaWNoIHRoZSBjdXJyZW50IGRlcG9zaXQgaXMgaW5jcmVhc2VkLgogICAgZnVuY3Rpb24gdG9wVXAoCiAgICAgICAgYWRkcmVzcyBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICB1aW50MzIgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgIHVpbnQxOTIgX2FkZGVkX2RlcG9zaXQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1cGRhdGVJbnRlcm5hbEJhbGFuY2VTdHJ1Y3RzKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICAgICAgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgICAgICBfYWRkZWRfZGVwb3NpdAogICAgICAgICk7CgogICAgICAgIC8vIHRyYW5zZmVyRnJvbSBkZXBvc2l0IGZyb20gbXNnLnNlbmRlciB0byBjb250cmFjdAogICAgICAgIC8vICEgbmVlZHMgcHJpb3IgYXBwcm92YWwgZnJvbSBtc2cuc2VuZGVyCiAgICAgICAgLy8gRG8gdHJhbnNmZXIgYWZ0ZXIgYW55IHN0YXRlIGNoYW5nZQogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3ModGhpcyksIF9hZGRlZF9kZXBvc2l0KSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdGhhdCBhbGxvd3MgYSBkZWxlZ2F0ZSBjb250cmFjdCB0byBpbmNyZWFzZSB0aGUgY2hhbm5lbCBkZXBvc2l0CiAgICAvLy8gd2l0aCBgX2FkZGVkX2RlcG9zaXRgLiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYSB0cnVzdGVkIGNvbnRyYWN0LiBDb21wYXRpYmlsaXR5IHdpdGggRVJDMjAgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfc2VuZGVyX2FkZHJlc3MgVGhlIHNlbmRlcidzIGFkZHJlc3MgaW4gYmVoYWxmIG9mIHdob20gdGhlIGRlbGVnYXRlIHNlbmRzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9vcGVuX2Jsb2NrX251bWJlciBUaGUgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGEgY2hhbm5lbCBiZXR3ZWVuIHRoZQogICAgLy8vIHNlbmRlciBhbmQgcmVjZWl2ZXIgd2FzIGNyZWF0ZWQuCiAgICAvLy8gQHBhcmFtIF9hZGRlZF9kZXBvc2l0IFRoZSBhZGRlZCB0b2tlbiBkZXBvc2l0IHdpdGggd2hpY2ggdGhlIGN1cnJlbnQgZGVwb3NpdCBpcyBpbmNyZWFzZWQuCiAgICBmdW5jdGlvbiB0b3BVcERlbGVnYXRlKAogICAgICAgIGFkZHJlc3MgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICB1aW50MTkyIF9hZGRlZF9kZXBvc2l0KQogICAgICAgIGlzVHJ1c3RlZENvbnRyYWN0CiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1cGRhdGVJbnRlcm5hbEJhbGFuY2VTdHJ1Y3RzKAogICAgICAgICAgICBfc2VuZGVyX2FkZHJlc3MsCiAgICAgICAgICAgIF9yZWNlaXZlcl9hZGRyZXNzLAogICAgICAgICAgICBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgICAgIF9hZGRlZF9kZXBvc2l0CiAgICAgICAgKTsKCiAgICAgICAgLy8gdHJhbnNmZXJGcm9tIGRlcG9zaXQgZnJvbSBtc2cuc2VuZGVyIHRvIGNvbnRyYWN0CiAgICAgICAgLy8gISBuZWVkcyBwcmlvciBhcHByb3ZhbCBmcm9tIHRoZSB0cnVzdGVkIGNvbnRyYWN0CiAgICAgICAgLy8gRG8gdHJhbnNmZXIgYWZ0ZXIgYW55IHN0YXRlIGNoYW5nZQogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3ModGhpcyksIF9hZGRlZF9kZXBvc2l0KSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQWxsb3dzIGNoYW5uZWwgcmVjZWl2ZXIgdG8gd2l0aGRyYXcgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfb3Blbl9ibG9ja19udW1iZXIgVGhlIGJsb2NrIG51bWJlciBhdCB3aGljaCBhIGNoYW5uZWwgYmV0d2VlbiB0aGUKICAgIC8vLyBzZW5kZXIgYW5kIHJlY2VpdmVyIHdhcyBjcmVhdGVkLgogICAgLy8vIEBwYXJhbSBfYmFsYW5jZSBQYXJ0aWFsIG9yIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgb3dlZCBieSB0aGUgc2VuZGVyIHRvIHRoZSByZWNlaXZlci4KICAgIC8vLyBIYXMgdG8gYmUgc21hbGxlciBvciBlcXVhbCB0byB0aGUgY2hhbm5lbCBkZXBvc2l0LiBIYXMgdG8gbWF0Y2ggdGhlIGJhbGFuY2UgdmFsdWUgZnJvbQogICAgLy8vIGBfYmFsYW5jZV9tc2dfc2lnYCAtIHRoZSBiYWxhbmNlIG1lc3NhZ2Ugc2lnbmVkIGJ5IHRoZSBzZW5kZXIuCiAgICAvLy8gSGFzIHRvIGJlIHNtYWxsZXIgb3IgZXF1YWwgdG8gdGhlIGNoYW5uZWwgZGVwb3NpdC4KICAgIC8vLyBAcGFyYW0gX2JhbGFuY2VfbXNnX3NpZyBUaGUgYmFsYW5jZSBtZXNzYWdlIHNpZ25lZCBieSB0aGUgc2VuZGVyLgogICAgZnVuY3Rpb24gd2l0aGRyYXcoCiAgICAgICAgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICB1aW50MTkyIF9iYWxhbmNlLAogICAgICAgIGJ5dGVzIF9iYWxhbmNlX21zZ19zaWcpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKF9iYWxhbmNlID4gMCk7CgogICAgICAgIC8vIERlcml2ZSBzZW5kZXIgYWRkcmVzcyBmcm9tIHNpZ25lZCBiYWxhbmNlIHByb29mCiAgICAgICAgYWRkcmVzcyBzZW5kZXJfYWRkcmVzcyA9IGV4dHJhY3RCYWxhbmNlUHJvb2ZTaWduYXR1cmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICAgICAgX2JhbGFuY2UsCiAgICAgICAgICAgIF9iYWxhbmNlX21zZ19zaWcKICAgICAgICApOwoKICAgICAgICBieXRlczMyIGtleSA9IGdldEtleShzZW5kZXJfYWRkcmVzcywgbXNnLnNlbmRlciwgX29wZW5fYmxvY2tfbnVtYmVyKTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBjaGFubmVsIGV4aXN0cwogICAgICAgIHJlcXVpcmUoY2hhbm5lbHNba2V5XS5vcGVuX2Jsb2NrX251bWJlciA+IDApOwoKICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGNoYW5uZWwgaXMgbm90IGluIHRoZSBjaGFsbGVuZ2UgcGVyaW9kCiAgICAgICAgcmVxdWlyZShjbG9zaW5nX3JlcXVlc3RzW2tleV0uc2V0dGxlX2Jsb2NrX251bWJlciA9PSAwKTsKCiAgICAgICAgcmVxdWlyZShfYmFsYW5jZSA8PSBjaGFubmVsc1trZXldLmRlcG9zaXQpOwogICAgICAgIHJlcXVpcmUod2l0aGRyYXduX2JhbGFuY2VzW2tleV0gPCBfYmFsYW5jZSk7CgogICAgICAgIHVpbnQxOTIgcmVtYWluaW5nX2JhbGFuY2UgPSBfYmFsYW5jZSAtIHdpdGhkcmF3bl9iYWxhbmNlc1trZXldOwogICAgICAgIHdpdGhkcmF3bl9iYWxhbmNlc1trZXldID0gX2JhbGFuY2U7CgogICAgICAgIC8vIFNlbmQgdGhlIHJlbWFpbmluZyBiYWxhbmNlIHRvIHRoZSByZWNlaXZlcgogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgcmVtYWluaW5nX2JhbGFuY2UpKTsKCiAgICAgICAgQ2hhbm5lbFdpdGhkcmF3KHNlbmRlcl9hZGRyZXNzLCBtc2cuc2VuZGVyLCBfb3Blbl9ibG9ja19udW1iZXIsIHJlbWFpbmluZ19iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiBjYWxsZWQgYnkgdGhlIHNlbmRlciwgcmVjZWl2ZXIgb3IgYSBkZWxlZ2F0ZSwgd2l0aCBhbGwgdGhlIG5lZWRlZAogICAgLy8vIHNpZ25hdHVyZXMgdG8gY2xvc2UgdGhlIGNoYW5uZWwgYW5kIHNldHRsZSBpbW1lZGlhdGVseS4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9vcGVuX2Jsb2NrX251bWJlciBUaGUgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGEgY2hhbm5lbCBiZXR3ZWVuIHRoZQogICAgLy8vIHNlbmRlciBhbmQgcmVjZWl2ZXIgd2FzIGNyZWF0ZWQuCiAgICAvLy8gQHBhcmFtIF9iYWxhbmNlIFRoZSBhbW91bnQgb2YgdG9rZW5zIG93ZWQgYnkgdGhlIHNlbmRlciB0byB0aGUgcmVjZWl2ZXIuCiAgICAvLy8gQHBhcmFtIF9iYWxhbmNlX21zZ19zaWcgVGhlIGJhbGFuY2UgbWVzc2FnZSBzaWduZWQgYnkgdGhlIHNlbmRlci4KICAgIC8vLyBAcGFyYW0gX2Nsb3Npbmdfc2lnIFRoZSByZWNlaXZlcidzIHNpZ25lZCBiYWxhbmNlIG1lc3NhZ2UsIGNvbnRhaW5pbmcgdGhlIHNlbmRlcidzIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBjb29wZXJhdGl2ZUNsb3NlKAogICAgICAgIGFkZHJlc3MgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICB1aW50MTkyIF9iYWxhbmNlLAogICAgICAgIGJ5dGVzIF9iYWxhbmNlX21zZ19zaWcsCiAgICAgICAgYnl0ZXMgX2Nsb3Npbmdfc2lnKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gRGVyaXZlIHNlbmRlciBhZGRyZXNzIGZyb20gc2lnbmVkIGJhbGFuY2UgcHJvb2YKICAgICAgICBhZGRyZXNzIHNlbmRlciA9IGV4dHJhY3RCYWxhbmNlUHJvb2ZTaWduYXR1cmUoCiAgICAgICAgICAgIF9yZWNlaXZlcl9hZGRyZXNzLAogICAgICAgICAgICBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgICAgIF9iYWxhbmNlLAogICAgICAgICAgICBfYmFsYW5jZV9tc2dfc2lnCiAgICAgICAgKTsKCiAgICAgICAgLy8gRGVyaXZlIHJlY2VpdmVyIGFkZHJlc3MgZnJvbSBjbG9zaW5nIHNpZ25hdHVyZQogICAgICAgIGFkZHJlc3MgcmVjZWl2ZXIgPSBleHRyYWN0Q2xvc2luZ1NpZ25hdHVyZSgKICAgICAgICAgICAgc2VuZGVyLAogICAgICAgICAgICBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgICAgIF9iYWxhbmNlLAogICAgICAgICAgICBfY2xvc2luZ19zaWcKICAgICAgICApOwogICAgICAgIHJlcXVpcmUocmVjZWl2ZXIgPT0gX3JlY2VpdmVyX2FkZHJlc3MpOwoKICAgICAgICAvLyBCb3RoIHNpZ25hdHVyZXMgaGF2ZSBiZWVuIHZlcmlmaWVkIGFuZCB0aGUgY2hhbm5lbCBjYW4gYmUgc2V0dGxlZC4KICAgICAgICBzZXR0bGVDaGFubmVsKHNlbmRlciwgcmVjZWl2ZXIsIF9vcGVuX2Jsb2NrX251bWJlciwgX2JhbGFuY2UpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmRlciByZXF1ZXN0cyB0aGUgY2xvc2luZyBvZiB0aGUgY2hhbm5lbCBhbmQgc3RhcnRzIHRoZSBjaGFsbGVuZ2UgcGVyaW9kLgogICAgLy8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIG9uY2UuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlcl9hZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgcmVjZWl2ZXMgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfb3Blbl9ibG9ja19udW1iZXIgVGhlIGJsb2NrIG51bWJlciBhdCB3aGljaCBhIGNoYW5uZWwgYmV0d2VlbgogICAgLy8vIHRoZSBzZW5kZXIgYW5kIHJlY2VpdmVyIHdhcyBjcmVhdGVkLgogICAgLy8vIEBwYXJhbSBfYmFsYW5jZSBUaGUgYW1vdW50IG9mIHRva2VucyBvd2VkIGJ5IHRoZSBzZW5kZXIgdG8gdGhlIHJlY2VpdmVyLgogICAgZnVuY3Rpb24gdW5jb29wZXJhdGl2ZUNsb3NlKAogICAgICAgIGFkZHJlc3MgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICB1aW50MTkyIF9iYWxhbmNlKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgYnl0ZXMzMiBrZXkgPSBnZXRLZXkobXNnLnNlbmRlciwgX3JlY2VpdmVyX2FkZHJlc3MsIF9vcGVuX2Jsb2NrX251bWJlcik7CgogICAgICAgIHJlcXVpcmUoY2hhbm5lbHNba2V5XS5vcGVuX2Jsb2NrX251bWJlciA+IDApOwogICAgICAgIHJlcXVpcmUoY2xvc2luZ19yZXF1ZXN0c1trZXldLnNldHRsZV9ibG9ja19udW1iZXIgPT0gMCk7CiAgICAgICAgcmVxdWlyZShfYmFsYW5jZSA8PSBjaGFubmVsc1trZXldLmRlcG9zaXQpOwoKICAgICAgICAvLyBNYXJrIGNoYW5uZWwgYXMgY2xvc2VkCiAgICAgICAgY2xvc2luZ19yZXF1ZXN0c1trZXldLnNldHRsZV9ibG9ja19udW1iZXIgPSB1aW50MzIoYmxvY2subnVtYmVyKSArIGNoYWxsZW5nZV9wZXJpb2Q7CiAgICAgICAgcmVxdWlyZShjbG9zaW5nX3JlcXVlc3RzW2tleV0uc2V0dGxlX2Jsb2NrX251bWJlciA+IGJsb2NrLm51bWJlcik7CiAgICAgICAgY2xvc2luZ19yZXF1ZXN0c1trZXldLmNsb3NpbmdfYmFsYW5jZSA9IF9iYWxhbmNlOwogICAgICAgIENoYW5uZWxDbG9zZVJlcXVlc3RlZChtc2cuc2VuZGVyLCBfcmVjZWl2ZXJfYWRkcmVzcywgX29wZW5fYmxvY2tfbnVtYmVyLCBfYmFsYW5jZSk7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIGNhbGxlZCBieSB0aGUgc2VuZGVyIGFmdGVyIHRoZSBjaGFsbGVuZ2UgcGVyaW9kIGhhcyBlbmRlZCwgaW4gb3JkZXIgdG8KICAgIC8vLyBzZXR0bGUgYW5kIGRlbGV0ZSB0aGUgY2hhbm5lbCwgaW4gY2FzZSB0aGUgcmVjZWl2ZXIgaGFzIG5vdCBjbG9zZWQgdGhlIGNoYW5uZWwgaGltc2VsZi4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9vcGVuX2Jsb2NrX251bWJlciBUaGUgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGEgY2hhbm5lbCBiZXR3ZWVuCiAgICAvLy8gdGhlIHNlbmRlciBhbmQgcmVjZWl2ZXIgd2FzIGNyZWF0ZWQuCiAgICBmdW5jdGlvbiBzZXR0bGUoYWRkcmVzcyBfcmVjZWl2ZXJfYWRkcmVzcywgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlcikgZXh0ZXJuYWwgewogICAgICAgIGJ5dGVzMzIga2V5ID0gZ2V0S2V5KG1zZy5zZW5kZXIsIF9yZWNlaXZlcl9hZGRyZXNzLCBfb3Blbl9ibG9ja19udW1iZXIpOwoKICAgICAgICAvLyBNYWtlIHN1cmUgYW4gdW5jb29wZXJhdGl2ZUNsb3NlIGhhcyBiZWVuIGluaXRpYXRlZAogICAgICAgIHJlcXVpcmUoY2xvc2luZ19yZXF1ZXN0c1trZXldLnNldHRsZV9ibG9ja19udW1iZXIgPiAwKTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBjaGFsbGVuZ2VfcGVyaW9kIGhhcyBlbmRlZAoJICAgIHJlcXVpcmUoYmxvY2subnVtYmVyID4gY2xvc2luZ19yZXF1ZXN0c1trZXldLnNldHRsZV9ibG9ja19udW1iZXIpOwoKICAgICAgICBzZXR0bGVDaGFubmVsKG1zZy5zZW5kZXIsIF9yZWNlaXZlcl9hZGRyZXNzLCBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgICAgIGNsb3NpbmdfcmVxdWVzdHNba2V5XS5jbG9zaW5nX2JhbGFuY2UKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIGluZm9ybWF0aW9uIGFib3V0IGEgY2hhbm5lbC4KICAgIC8vLyBAcGFyYW0gX3NlbmRlcl9hZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgc2VuZHMgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXJfYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHJlY2VpdmVzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX29wZW5fYmxvY2tfbnVtYmVyIFRoZSBibG9jayBudW1iZXIgYXQgd2hpY2ggYSBjaGFubmVsIGJldHdlZW4gdGhlCiAgICAvLy8gc2VuZGVyIGFuZCByZWNlaXZlciB3YXMgY3JlYXRlZC4KICAgIC8vLyBAcmV0dXJuIENoYW5uZWwgaW5mb3JtYXRpb246IHVuaXF1ZV9pZGVudGlmaWVyLCBkZXBvc2l0LCBzZXR0bGVfYmxvY2tfbnVtYmVyLAogICAgLy8vIGNsb3NpbmdfYmFsYW5jZSwgd2l0aGRyYXduIGJhbGFuY2UpLgogICAgZnVuY3Rpb24gZ2V0Q2hhbm5lbEluZm8oCiAgICAgICAgYWRkcmVzcyBfc2VuZGVyX2FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICB1aW50MzIgX29wZW5fYmxvY2tfbnVtYmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJ5dGVzMzIsIHVpbnQxOTIsIHVpbnQzMiwgdWludDE5MiwgdWludDE5MikKICAgIHsKICAgICAgICBieXRlczMyIGtleSA9IGdldEtleShfc2VuZGVyX2FkZHJlc3MsIF9yZWNlaXZlcl9hZGRyZXNzLCBfb3Blbl9ibG9ja19udW1iZXIpOwogICAgICAgIHJlcXVpcmUoY2hhbm5lbHNba2V5XS5vcGVuX2Jsb2NrX251bWJlciA+IDApOwoKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBrZXksCiAgICAgICAgICAgIGNoYW5uZWxzW2tleV0uZGVwb3NpdCwKICAgICAgICAgICAgY2xvc2luZ19yZXF1ZXN0c1trZXldLnNldHRsZV9ibG9ja19udW1iZXIsCiAgICAgICAgICAgIGNsb3NpbmdfcmVxdWVzdHNba2V5XS5jbG9zaW5nX2JhbGFuY2UsCiAgICAgICAgICAgIHdpdGhkcmF3bl9iYWxhbmNlc1trZXldCiAgICAgICAgKTsKICAgIH0KCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIGZvciBhZGRpbmcgdHJ1c3RlZCBjb250cmFjdHMuIENhbiBvbmx5IGJlIGNhbGxlZCBieSBvd25lcl9hZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdHJ1c3RlZF9jb250cmFjdHMgQXJyYXkgb2YgY29udHJhY3QgYWRkcmVzc2VzIHRoYXQgY2FuIGJlIHRydXN0ZWQgdG8KICAgIC8vLyBvcGVuIGFuZCB0b3AgdXAgY2hhbm5lbHMgb24gYmVoYWxmIG9mIGEgc2VuZGVyLgogICAgZnVuY3Rpb24gYWRkVHJ1c3RlZENvbnRyYWN0cyhhZGRyZXNzW10gX3RydXN0ZWRfY29udHJhY3RzKSBpc093bmVyIHB1YmxpYyB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX3RydXN0ZWRfY29udHJhY3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzSGFzQ29kZShfdHJ1c3RlZF9jb250cmFjdHNbaV0pKSB7CiAgICAgICAgICAgICAgICB0cnVzdGVkX2NvbnRyYWN0c1tfdHJ1c3RlZF9jb250cmFjdHNbaV1dID0gdHJ1ZTsKICAgICAgICAgICAgICAgIFRydXN0ZWRDb250cmFjdChfdHJ1c3RlZF9jb250cmFjdHNbaV0sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIGZvciByZW1vdmluZyB0cnVzdGVkIGNvbnRyYWN0cy4gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IG93bmVyX2FkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90cnVzdGVkX2NvbnRyYWN0cyBBcnJheSBvZiBjb250cmFjdCBhZGRyZXNzZXMgdG8gYmUgcmVtb3ZlZCBmcm9tCiAgICAvLy8gdGhlIHRydXN0ZWRfY29udHJhY3RzIG1hcHBpbmcuCiAgICBmdW5jdGlvbiByZW1vdmVUcnVzdGVkQ29udHJhY3RzKGFkZHJlc3NbXSBfdHJ1c3RlZF9jb250cmFjdHMpIGlzT3duZXIgcHVibGljIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfdHJ1c3RlZF9jb250cmFjdHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRydXN0ZWRfY29udHJhY3RzW190cnVzdGVkX2NvbnRyYWN0c1tpXV0pIHsKICAgICAgICAgICAgICAgIHRydXN0ZWRfY29udHJhY3RzW190cnVzdGVkX2NvbnRyYWN0c1tpXV0gPSBmYWxzZTsKICAgICAgICAgICAgICAgIFRydXN0ZWRDb250cmFjdChfdHJ1c3RlZF9jb250cmFjdHNbaV0sIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBzZW5kZXIgYWRkcmVzcyBleHRyYWN0ZWQgZnJvbSB0aGUgYmFsYW5jZSBwcm9vZi4KICAgIC8vLyBkZXYgV29ya3Mgd2l0aCBldGhfc2lnblR5cGVkRGF0YSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9wdWxsLzcxMi4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9vcGVuX2Jsb2NrX251bWJlciBUaGUgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGEgY2hhbm5lbCBiZXR3ZWVuIHRoZQogICAgLy8vIHNlbmRlciBhbmQgcmVjZWl2ZXIgd2FzIGNyZWF0ZWQuCiAgICAvLy8gQHBhcmFtIF9iYWxhbmNlIFRoZSBhbW91bnQgb2YgdG9rZW5zIG93ZWQgYnkgdGhlIHNlbmRlciB0byB0aGUgcmVjZWl2ZXIuCiAgICAvLy8gQHBhcmFtIF9iYWxhbmNlX21zZ19zaWcgVGhlIGJhbGFuY2UgbWVzc2FnZSBzaWduZWQgYnkgdGhlIHNlbmRlci4KICAgIC8vLyBAcmV0dXJuIEFkZHJlc3Mgb2YgdGhlIGJhbGFuY2UgcHJvb2Ygc2lnbmVyLgogICAgZnVuY3Rpb24gZXh0cmFjdEJhbGFuY2VQcm9vZlNpZ25hdHVyZSgKICAgICAgICBhZGRyZXNzIF9yZWNlaXZlcl9hZGRyZXNzLAogICAgICAgIHVpbnQzMiBfb3Blbl9ibG9ja19udW1iZXIsCiAgICAgICAgdWludDE5MiBfYmFsYW5jZSwKICAgICAgICBieXRlcyBfYmFsYW5jZV9tc2dfc2lnKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIC8vIFRoZSB2YXJpYWJsZSBuYW1lcyBmcm9tIGJlbG93IHdpbGwgYmUgc2hvd24gdG8gdGhlIHNlbmRlciB3aGVuIHNpZ25pbmcKICAgICAgICAvLyB0aGUgYmFsYW5jZSBwcm9vZiwgc28gdGhleSBoYXZlIHRvIGJlIGtlcHQgaW4gc3luYyB3aXRoIHRoZSBEYXBwIGNsaWVudC4KICAgICAgICAvLyBUaGUgaGFzaGVkIHN0cmluZ3Mgc2hvdWxkIGJlIGtlcHQgaW4gc3luYyB3aXRoIHRoaXMgZnVuY3Rpb24ncyBwYXJhbWV0ZXJzCiAgICAgICAgLy8gKHZhcmlhYmxlIG5hbWVzIGFuZCB0eXBlcykuCiAgICAgICAgLy8gISBOb3RlIHRoYXQgRUlQNzEyIG1pZ2h0IGNoYW5nZSBob3cgaGFzaGluZyBpcyBkb25lLCB0cmlnZ2VyaW5nIGEKICAgICAgICAvLyBuZXcgY29udHJhY3QgZGVwbG95bWVudCB3aXRoIHVwZGF0ZWQgY29kZS4KICAgICAgICBieXRlczMyIG1lc3NhZ2VfaGFzaCA9IGtlY2NhazI1NigKICAgICAgICAgICAga2VjY2FrMjU2KAogICAgICAgICAgICAgICAgJ3N0cmluZyBtZXNzYWdlX2lkJywKICAgICAgICAgICAgICAgICdhZGRyZXNzIHJlY2VpdmVyJywKICAgICAgICAgICAgICAgICd1aW50MzIgYmxvY2tfY3JlYXRlZCcsCiAgICAgICAgICAgICAgICAndWludDE5MiBiYWxhbmNlJywKICAgICAgICAgICAgICAgICdhZGRyZXNzIGNvbnRyYWN0JwogICAgICAgICAgICApLAogICAgICAgICAgICBrZWNjYWsyNTYoCiAgICAgICAgICAgICAgICAnU2VuZGVyIGJhbGFuY2UgcHJvb2Ygc2lnbmF0dXJlJywKICAgICAgICAgICAgICAgIF9yZWNlaXZlcl9hZGRyZXNzLAogICAgICAgICAgICAgICAgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgICAgICAgICAgX2JhbGFuY2UsCiAgICAgICAgICAgICAgICBhZGRyZXNzKHRoaXMpCiAgICAgICAgICAgICkKICAgICAgICApOwoKICAgICAgICAvLyBEZXJpdmUgYWRkcmVzcyBmcm9tIHNpZ25hdHVyZQogICAgICAgIGFkZHJlc3Mgc2lnbmVyID0gRUNWZXJpZnkuZWN2ZXJpZnkobWVzc2FnZV9oYXNoLCBfYmFsYW5jZV9tc2dfc2lnKTsKICAgICAgICByZXR1cm4gc2lnbmVyOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIHJlY2VpdmVyIGFkZHJlc3MgZXh0cmFjdGVkIGZyb20gdGhlIGNsb3Npbmcgc2lnbmF0dXJlLgogICAgLy8vIFdvcmtzIHdpdGggZXRoX3NpZ25UeXBlZERhdGEgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvcHVsbC83MTIuCiAgICAvLy8gQHBhcmFtIF9zZW5kZXJfYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHNlbmRzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX29wZW5fYmxvY2tfbnVtYmVyIFRoZSBibG9jayBudW1iZXIgYXQgd2hpY2ggYSBjaGFubmVsIGJldHdlZW4gdGhlCiAgICAvLy8gc2VuZGVyIGFuZCByZWNlaXZlciB3YXMgY3JlYXRlZC4KICAgIC8vLyBAcGFyYW0gX2JhbGFuY2UgVGhlIGFtb3VudCBvZiB0b2tlbnMgb3dlZCBieSB0aGUgc2VuZGVyIHRvIHRoZSByZWNlaXZlci4KICAgIC8vLyBAcGFyYW0gX2Nsb3Npbmdfc2lnIFRoZSByZWNlaXZlcidzIHNpZ25lZCBiYWxhbmNlIG1lc3NhZ2UsIGNvbnRhaW5pbmcgdGhlIHNlbmRlcidzIGFkZHJlc3MuCiAgICAvLy8gQHJldHVybiBBZGRyZXNzIG9mIHRoZSBjbG9zaW5nIHNpZ25hdHVyZSBzaWduZXIuCiAgICBmdW5jdGlvbiBleHRyYWN0Q2xvc2luZ1NpZ25hdHVyZSgKICAgICAgICBhZGRyZXNzIF9zZW5kZXJfYWRkcmVzcywKICAgICAgICB1aW50MzIgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgIHVpbnQxOTIgX2JhbGFuY2UsCiAgICAgICAgYnl0ZXMgX2Nsb3Npbmdfc2lnKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIC8vIFRoZSB2YXJpYWJsZSBuYW1lcyBmcm9tIGJlbG93IHdpbGwgYmUgc2hvd24gdG8gdGhlIHNlbmRlciB3aGVuIHNpZ25pbmcKICAgICAgICAvLyB0aGUgYmFsYW5jZSBwcm9vZiwgc28gdGhleSBoYXZlIHRvIGJlIGtlcHQgaW4gc3luYyB3aXRoIHRoZSBEYXBwIGNsaWVudC4KICAgICAgICAvLyBUaGUgaGFzaGVkIHN0cmluZ3Mgc2hvdWxkIGJlIGtlcHQgaW4gc3luYyB3aXRoIHRoaXMgZnVuY3Rpb24ncyBwYXJhbWV0ZXJzCiAgICAgICAgLy8gKHZhcmlhYmxlIG5hbWVzIGFuZCB0eXBlcykuCiAgICAgICAgLy8gISBOb3RlIHRoYXQgRUlQNzEyIG1pZ2h0IGNoYW5nZSBob3cgaGFzaGluZyBpcyBkb25lLCB0cmlnZ2VyaW5nIGEKICAgICAgICAvLyBuZXcgY29udHJhY3QgZGVwbG95bWVudCB3aXRoIHVwZGF0ZWQgY29kZS4KICAgICAgICBieXRlczMyIG1lc3NhZ2VfaGFzaCA9IGtlY2NhazI1NigKICAgICAgICAgICAga2VjY2FrMjU2KAogICAgICAgICAgICAgICAgJ3N0cmluZyBtZXNzYWdlX2lkJywKICAgICAgICAgICAgICAgICdhZGRyZXNzIHNlbmRlcicsCiAgICAgICAgICAgICAgICAndWludDMyIGJsb2NrX2NyZWF0ZWQnLAogICAgICAgICAgICAgICAgJ3VpbnQxOTIgYmFsYW5jZScsCiAgICAgICAgICAgICAgICAnYWRkcmVzcyBjb250cmFjdCcKICAgICAgICAgICAgKSwKICAgICAgICAgICAga2VjY2FrMjU2KAogICAgICAgICAgICAgICAgJ1JlY2VpdmVyIGNsb3Npbmcgc2lnbmF0dXJlJywKICAgICAgICAgICAgICAgIF9zZW5kZXJfYWRkcmVzcywKICAgICAgICAgICAgICAgIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICAgICAgICAgIF9iYWxhbmNlLAogICAgICAgICAgICAgICAgYWRkcmVzcyh0aGlzKQogICAgICAgICAgICApCiAgICAgICAgKTsKCiAgICAgICAgLy8gRGVyaXZlIGFkZHJlc3MgZnJvbSBzaWduYXR1cmUKICAgICAgICBhZGRyZXNzIHNpZ25lciA9IEVDVmVyaWZ5LmVjdmVyaWZ5KG1lc3NhZ2VfaGFzaCwgX2Nsb3Npbmdfc2lnKTsKICAgICAgICByZXR1cm4gc2lnbmVyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIHVuaXF1ZSBjaGFubmVsIGlkZW50aWZpZXIgdXNlZCBpbiB0aGUgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9zZW5kZXJfYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHNlbmRzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9vcGVuX2Jsb2NrX251bWJlciBUaGUgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGEgY2hhbm5lbCBiZXR3ZWVuIHRoZQogICAgLy8vIHNlbmRlciBhbmQgcmVjZWl2ZXIgd2FzIGNyZWF0ZWQuCiAgICAvLy8gQHJldHVybiBVbmlxdWUgY2hhbm5lbCBpZGVudGlmaWVyLgogICAgZnVuY3Rpb24gZ2V0S2V5KAogICAgICAgIGFkZHJlc3MgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlcikKICAgICAgICBwdWJsaWMKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiBkYXRhKQogICAgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoX3NlbmRlcl9hZGRyZXNzLCBfcmVjZWl2ZXJfYWRkcmVzcywgX29wZW5fYmxvY2tfbnVtYmVyKTsKICAgIH0KCiAgICAvKgogICAgICogIFByaXZhdGUgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgbmV3IGNoYW5uZWwgYmV0d2VlbiBhIHNlbmRlciBhbmQgYSByZWNlaXZlci4KICAgIC8vLyBAcGFyYW0gX3NlbmRlcl9hZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgc2VuZHMgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXJfYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHJlY2VpdmVzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX2RlcG9zaXQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB0aGUgc2VuZGVyIGVzY3Jvd3MuCiAgICBmdW5jdGlvbiBjcmVhdGVDaGFubmVsUHJpdmF0ZSgKICAgICAgICBhZGRyZXNzIF9zZW5kZXJfYWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9yZWNlaXZlcl9hZGRyZXNzLAogICAgICAgIHVpbnQxOTIgX2RlcG9zaXQpCiAgICAgICAgcHJpdmF0ZQogICAgewogICAgICAgIHJlcXVpcmUoX2RlcG9zaXQgPD0gY2hhbm5lbF9kZXBvc2l0X2J1Z2JvdW50eV9saW1pdCk7CgogICAgICAgIHVpbnQzMiBvcGVuX2Jsb2NrX251bWJlciA9IHVpbnQzMihibG9jay5udW1iZXIpOwoKICAgICAgICAvLyBDcmVhdGUgdW5pcXVlIGlkZW50aWZpZXIgZnJvbSBzZW5kZXIsIHJlY2VpdmVyIGFuZCBjdXJyZW50IGJsb2NrIG51bWJlcgogICAgICAgIGJ5dGVzMzIga2V5ID0gZ2V0S2V5KF9zZW5kZXJfYWRkcmVzcywgX3JlY2VpdmVyX2FkZHJlc3MsIG9wZW5fYmxvY2tfbnVtYmVyKTsKCiAgICAgICAgcmVxdWlyZShjaGFubmVsc1trZXldLmRlcG9zaXQgPT0gMCk7CiAgICAgICAgcmVxdWlyZShjaGFubmVsc1trZXldLm9wZW5fYmxvY2tfbnVtYmVyID09IDApOwogICAgICAgIHJlcXVpcmUoY2xvc2luZ19yZXF1ZXN0c1trZXldLnNldHRsZV9ibG9ja19udW1iZXIgPT0gMCk7CgogICAgICAgIC8vIFN0b3JlIGNoYW5uZWwgaW5mb3JtYXRpb24KICAgICAgICBjaGFubmVsc1trZXldID0gQ2hhbm5lbCh7ZGVwb3NpdDogX2RlcG9zaXQsIG9wZW5fYmxvY2tfbnVtYmVyOiBvcGVuX2Jsb2NrX251bWJlcn0pOwogICAgICAgIENoYW5uZWxDcmVhdGVkKF9zZW5kZXJfYWRkcmVzcywgX3JlY2VpdmVyX2FkZHJlc3MsIF9kZXBvc2l0KTsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIGludGVybmFsIGJhbGFuY2UgU3RydWN0dXJlcyB3aGVuIHRoZSBzZW5kZXIgYWRkcyB0b2tlbnMgdG8gdGhlIGNoYW5uZWwuCiAgICAvLy8gQHBhcmFtIF9zZW5kZXJfYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHNlbmRzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyX2FkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCByZWNlaXZlcyB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF9vcGVuX2Jsb2NrX251bWJlciBUaGUgYmxvY2sgbnVtYmVyIGF0IHdoaWNoIGEgY2hhbm5lbCBiZXR3ZWVuIHRoZQogICAgLy8vIHNlbmRlciBhbmQgcmVjZWl2ZXIgd2FzIGNyZWF0ZWQuCiAgICAvLy8gQHBhcmFtIF9hZGRlZF9kZXBvc2l0IFRoZSBhZGRlZCB0b2tlbiBkZXBvc2l0IHdpdGggd2hpY2ggdGhlIGN1cnJlbnQgZGVwb3NpdCBpcyBpbmNyZWFzZWQuCiAgICBmdW5jdGlvbiB1cGRhdGVJbnRlcm5hbEJhbGFuY2VTdHJ1Y3RzKAogICAgICAgIGFkZHJlc3MgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3JlY2VpdmVyX2FkZHJlc3MsCiAgICAgICAgdWludDMyIF9vcGVuX2Jsb2NrX251bWJlciwKICAgICAgICB1aW50MTkyIF9hZGRlZF9kZXBvc2l0KQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICByZXF1aXJlKF9hZGRlZF9kZXBvc2l0ID4gMCk7CiAgICAgICAgcmVxdWlyZShfb3Blbl9ibG9ja19udW1iZXIgPiAwKTsKCiAgICAgICAgYnl0ZXMzMiBrZXkgPSBnZXRLZXkoX3NlbmRlcl9hZGRyZXNzLCBfcmVjZWl2ZXJfYWRkcmVzcywgX29wZW5fYmxvY2tfbnVtYmVyKTsKCiAgICAgICAgcmVxdWlyZShjaGFubmVsc1trZXldLm9wZW5fYmxvY2tfbnVtYmVyID4gMCk7CiAgICAgICAgcmVxdWlyZShjbG9zaW5nX3JlcXVlc3RzW2tleV0uc2V0dGxlX2Jsb2NrX251bWJlciA9PSAwKTsKICAgICAgICByZXF1aXJlKGNoYW5uZWxzW2tleV0uZGVwb3NpdCArIF9hZGRlZF9kZXBvc2l0IDw9IGNoYW5uZWxfZGVwb3NpdF9idWdib3VudHlfbGltaXQpOwoKICAgICAgICBjaGFubmVsc1trZXldLmRlcG9zaXQgKz0gX2FkZGVkX2RlcG9zaXQ7CiAgICAgICAgYXNzZXJ0KGNoYW5uZWxzW2tleV0uZGVwb3NpdCA+PSBfYWRkZWRfZGVwb3NpdCk7CiAgICAgICAgQ2hhbm5lbFRvcHBlZFVwKF9zZW5kZXJfYWRkcmVzcywgX3JlY2VpdmVyX2FkZHJlc3MsIF9vcGVuX2Jsb2NrX251bWJlciwgX2FkZGVkX2RlcG9zaXQpOwogICAgfQoKICAgIC8vLyBAZGV2IERlbGV0ZXMgdGhlIGNoYW5uZWwgYW5kIHNldHRsZXMgYnkgdHJhbnNmZXJpbmcgdGhlIGJhbGFuY2UgdG8gdGhlIHJlY2VpdmVyCiAgICAvLy8gYW5kIHRoZSByZXN0IG9mIHRoZSBkZXBvc2l0IGJhY2sgdG8gdGhlIHNlbmRlci4KICAgIC8vLyBAcGFyYW0gX3NlbmRlcl9hZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgc2VuZHMgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXJfYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHJlY2VpdmVzIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX29wZW5fYmxvY2tfbnVtYmVyIFRoZSBibG9jayBudW1iZXIgYXQgd2hpY2ggYSBjaGFubmVsIGJldHdlZW4gdGhlCiAgICAvLy8gc2VuZGVyIGFuZCByZWNlaXZlciB3YXMgY3JlYXRlZC4KICAgIC8vLyBAcGFyYW0gX2JhbGFuY2UgVGhlIGFtb3VudCBvZiB0b2tlbnMgb3dlZCBieSB0aGUgc2VuZGVyIHRvIHRoZSByZWNlaXZlci4KICAgIGZ1bmN0aW9uIHNldHRsZUNoYW5uZWwoCiAgICAgICAgYWRkcmVzcyBfc2VuZGVyX2FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICB1aW50MzIgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgIHVpbnQxOTIgX2JhbGFuY2UpCiAgICAgICAgcHJpdmF0ZQogICAgewogICAgICAgIGJ5dGVzMzIga2V5ID0gZ2V0S2V5KF9zZW5kZXJfYWRkcmVzcywgX3JlY2VpdmVyX2FkZHJlc3MsIF9vcGVuX2Jsb2NrX251bWJlcik7CiAgICAgICAgQ2hhbm5lbCBtZW1vcnkgY2hhbm5lbCA9IGNoYW5uZWxzW2tleV07CgogICAgICAgIHJlcXVpcmUoY2hhbm5lbC5vcGVuX2Jsb2NrX251bWJlciA+IDApOwogICAgICAgIHJlcXVpcmUoX2JhbGFuY2UgPD0gY2hhbm5lbC5kZXBvc2l0KTsKICAgICAgICByZXF1aXJlKHdpdGhkcmF3bl9iYWxhbmNlc1trZXldIDw9IF9iYWxhbmNlKTsKCiAgICAgICAgLy8gUmVtb3ZlIGNsb3NlZCBjaGFubmVsIHN0cnVjdHVyZXMKICAgICAgICAvLyBjaGFubmVsLm9wZW5fYmxvY2tfbnVtYmVyIHdpbGwgYmVjb21lIDAKICAgICAgICAvLyBDaGFuZ2Ugc3RhdGUgYmVmb3JlIHRyYW5zZmVyIGNhbGwKICAgICAgICBkZWxldGUgY2hhbm5lbHNba2V5XTsKICAgICAgICBkZWxldGUgY2xvc2luZ19yZXF1ZXN0c1trZXldOwoKICAgICAgICAvLyBTZW5kIHRoZSB1bndpdGhkcmF3biBfYmFsYW5jZSB0byB0aGUgcmVjZWl2ZXIKICAgICAgICB1aW50MTkyIHJlY2VpdmVyX3JlbWFpbmluZ190b2tlbnMgPSBfYmFsYW5jZSAtIHdpdGhkcmF3bl9iYWxhbmNlc1trZXldOwogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoX3JlY2VpdmVyX2FkZHJlc3MsIHJlY2VpdmVyX3JlbWFpbmluZ190b2tlbnMpKTsKCiAgICAgICAgLy8gU2VuZCBkZXBvc2l0IC0gYmFsYW5jZSBiYWNrIHRvIHNlbmRlcgogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoX3NlbmRlcl9hZGRyZXNzLCBjaGFubmVsLmRlcG9zaXQgLSBfYmFsYW5jZSkpOwoKICAgICAgICBDaGFubmVsU2V0dGxlZCgKICAgICAgICAgICAgX3NlbmRlcl9hZGRyZXNzLAogICAgICAgICAgICBfcmVjZWl2ZXJfYWRkcmVzcywKICAgICAgICAgICAgX29wZW5fYmxvY2tfbnVtYmVyLAogICAgICAgICAgICBfYmFsYW5jZSwKICAgICAgICAgICAgcmVjZWl2ZXJfcmVtYWluaW5nX3Rva2VucwogICAgICAgICk7CiAgICB9CgogICAgLyoKICAgICAqICBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIGZvciBnZXR0aW5nIGFuIGFkZHJlc3MgZnJvbSB0b2tlbkZhbGxiYWNrIGRhdGEgYnl0ZXMuCiAgICAvLy8gQHBhcmFtIGRhdGEgQnl0ZXMgcmVjZWl2ZWQuCiAgICAvLy8gQHBhcmFtIG9mZnNldCBOdW1iZXIgb2YgYnl0ZXMgdG8gb2Zmc2V0LgogICAgLy8vIEByZXR1cm4gRXh0cmFjdGVkIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBhZGRyZXNzRnJvbUJ5dGVzIChieXRlcyBkYXRhLCB1aW50MjU2IG9mZnNldCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMyMCBleHRyYWN0ZWRfYWRkcmVzczsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGV4dHJhY3RlZF9hZGRyZXNzIDo9IG1sb2FkKGFkZChkYXRhLCBvZmZzZXQpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhleHRyYWN0ZWRfYWRkcmVzcyk7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gZm9yIGdldHRpbmcgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRva2VuRmFsbGJhY2sgZGF0YSBieXRlcy4KICAgIC8vLyBAcGFyYW0gZGF0YSBCeXRlcyByZWNlaXZlZC4KICAgIC8vLyBAcGFyYW0gb2Zmc2V0IE51bWJlciBvZiBieXRlcyB0byBvZmZzZXQuCiAgICAvLy8gQHJldHVybiBCbG9jayBudW1iZXIuCiAgICBmdW5jdGlvbiBibG9ja051bWJlckZyb21CeXRlcyhieXRlcyBkYXRhLCB1aW50MjU2IG9mZnNldCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MzIpIHsKICAgICAgICBieXRlczQgYmxvY2tfbnVtYmVyOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgYmxvY2tfbnVtYmVyIDo9IG1sb2FkKGFkZChkYXRhLCBvZmZzZXQpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdWludDMyKGJsb2NrX251bWJlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2sgaWYgYSBjb250cmFjdCBleGlzdHMuCiAgICAvLy8gQHBhcmFtIF9jb250cmFjdCBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgdG8gY2hlY2sgZm9yLgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBhIGNvbnRyYWN0IGV4aXN0cywgZmFsc2Ugb3RoZXJ3aXNlLgogICAgZnVuY3Rpb24gYWRkcmVzc0hhc0NvZGUoYWRkcmVzcyBfY29udHJhY3QpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2NvbnRyYWN0KQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNpemUgPiAwOwogICAgfQp9'.
	

]
