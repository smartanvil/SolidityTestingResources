Class {
	#name : #SRT91a57b2f6fa86b373bce5716eb26c81cbb004223,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT91a57b2f6fa86b373bce5716eb26c81cbb004223 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCmNvbnRyYWN0IE93bmVkQnlXaW5zb21lIHsKCiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhbGxvd2VkV29ya2VyOwoKICBmdW5jdGlvbiBpbml0T3duZXJzaGlwKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF93b3JrZXIpIGludGVybmFsewogICAgb3duZXIgPSBfb3duZXI7CiAgICBhbGxvd2VkV29ya2VyW19vd25lcl0gPSB0cnVlOwogICAgYWxsb3dlZFdvcmtlcltfd29ya2VyXSA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd1dvcmtlcihhZGRyZXNzIF9uZXdfd29ya2VyKSBvbmx5T3duZXJ7CiAgICBhbGxvd2VkV29ya2VyW19uZXdfd29ya2VyXSA9IHRydWU7CiAgfQogIGZ1bmN0aW9uIHJlbW92ZVdvcmtlcihhZGRyZXNzIF9vbGRfd29ya2VyKSBvbmx5T3duZXJ7CiAgICBhbGxvd2VkV29ya2VyW19vbGRfd29ya2VyXSA9IGZhbHNlOwogIH0KICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdfb3duZXIpIG9ubHlPd25lcnsKICAgIG93bmVyID0gX25ld19vd25lcjsKICB9CgkJCQkJCSAgICAKICBtb2RpZmllciBvbmx5QWxsb3dlZFdvcmtlcnsKICAgIGlmICghYWxsb3dlZFdvcmtlclttc2cuc2VuZGVyXSl7CiAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlPd25lcnsKICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKXsKICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgCn0KCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgewogICAgaWYgKCFhc3NlcnRpb24pIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQp9CgoKLyoKICogQmFzaWMgdG9rZW4KICogQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMKICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICB1aW50IHB1YmxpYyAgICAgdG90YWxTdXBwbHkgPSAgICAwOyAgICAJCQkgLy8gVG90YWwgc3VwcGx5IG9mIDUwMCBtaWxsaW9uIFRva2VucwogIAogIC8qCiAgICogRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sgIAogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICBpZihtc2cuZGF0YS5sZW5ndGggPCBzaXplICsgNCkgewogICAgICAgdGhyb3c7CiAgICAgfQogICAgIF87CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9CiAgCn0KCgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEJhc2ljVG9rZW57CiAgCiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7CgogIAogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKCmNvbnRyYWN0IFdpblRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmVkQnlXaW5zb21lewoKICBzdHJpbmcgcHVibGljICAgbmFtZSA9ICAgICAgICAgICAiV2luc29tZS5pbyBUb2tlbiI7CiAgc3RyaW5nIHB1YmxpYyAgIHN5bWJvbCA9ICAgICAgICAgIldJTiI7CiAgdWludCBwdWJsaWMgICAgIGRlY2ltYWxzID0gICAgICAgMTg7CiAgCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhbGxvd2VkTWludGVyOwoKICBmdW5jdGlvbiBXaW5Ub2tlbihhZGRyZXNzIF9vd25lcil7CiAgICBhbGxvd2VkTWludGVyW19vd25lcl0gPSB0cnVlOwogICAgaW5pdE93bmVyc2hpcChfb3duZXIsIF9vd25lcik7CiAgfQoKICBmdW5jdGlvbiBhbGxvd01pbnRlcihhZGRyZXNzIF9uZXdfbWludGVyKSBvbmx5T3duZXJ7CiAgICBhbGxvd2VkTWludGVyW19uZXdfbWludGVyXSA9IHRydWU7CiAgfQogIGZ1bmN0aW9uIHJlbW92ZU1pbnRlcihhZGRyZXNzIF9vbGRfbWludGVyKSBvbmx5T3duZXJ7CiAgICBhbGxvd2VkTWludGVyW19vbGRfbWludGVyXSA9IGZhbHNlOwogIH0KCiAgbW9kaWZpZXIgb25seUFsbG93ZWRNaW50ZXJ7CiAgICBpZiAoIWFsbG93ZWRNaW50ZXJbbXNnLnNlbmRlcl0pewogICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQogIGZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBfZm9yLCB1aW50IF92YWx1ZV93ZWkpIG9ubHlBbGxvd2VkTWludGVyIHsKICAgIGJhbGFuY2VzW19mb3JdID0gYmFsYW5jZXNbX2Zvcl0uYWRkKF92YWx1ZV93ZWkpOwogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX3ZhbHVlX3dlaSkgOwogICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX2ZvciwgX3ZhbHVlX3dlaSk7CiAgfQogIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfZm9yLCB1aW50IF92YWx1ZV93ZWkpIG9ubHlBbGxvd2VkTWludGVyIHsKICAgIGJhbGFuY2VzW19mb3JdID0gYmFsYW5jZXNbX2Zvcl0uc3ViKF92YWx1ZV93ZWkpOwogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlX3dlaSk7CiAgICBUcmFuc2ZlcihfZm9yLCBhZGRyZXNzKDApLCBfdmFsdWVfd2VpKTsgICAgCiAgfQogIAp9Cgpjb250cmFjdCBSb3VsZXRoCnsKICAvL0dhbWUgYW5kIEdsb2JhbCBWYXJpYWJsZXMsIFN0cnVjdHVyZSBvZiBnYW1ibGVzCiAgYWRkcmVzcyBwdWJsaWMgZGV2ZWxvcGVyOwogIHVpbnQ4IHB1YmxpYyBibG9ja0RlbGF5OyAvL25iIG9mIGJsb2NrcyB0byB3YWl0IGJlZm9yZSBzcGluCiAgdWludDggcHVibGljIGJsb2NrRXhwaXJhdGlvbjsgLy9uYiBvZiBibG9ja3MgYmVmb3JlIGJldCBleHBpcmF0aW9uIChkdWUgdG8gaGFzaCBzdG9yYWdlIGxpbWl0cykKICB1aW50MjU2IHB1YmxpYyBtYXhHYW1ibGU7IC8vbWF4IGdhbWJsZSB2YWx1ZSBtYW51YWxseSBzZXQgYnkgY29uZmlnCiAgdWludDI1NiBwdWJsaWMgbWluR2FtYmxlOyAvL21pbiBnYW1ibGUgdmFsdWUgbWFudWFsbHkgc2V0IGJ5IGNvbmZpZwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHBlbmRpbmdUb2tlbnM7CiAgCiAgYWRkcmVzcyBwdWJsaWMgV0lOVE9LRU5BRERSRVNTOwogIFdpblRva2VuIHdpblRva2VuSW5zdGFuY2U7CgogIHVpbnQgcHVibGljIGVtaXNzaW9uUmF0ZTsKICAKICAvL0dhbWJsZXMKICBlbnVtIEJldFR5cGVze251bWJlciwgY29sb3IsIHBhcml0eSwgZG96ZW4sIGNvbHVtbiwgbG93aGlnaH0gCiAgc3RydWN0IEdhbWJsZQogIHsKICAgIGFkZHJlc3MgcGxheWVyOwogICAgYm9vbCBzcGlubmVkOyAvL1dhcyB0aGUgcm91bGV0aCBzcGlubmVkID8KICAgIGJvb2wgd2luOwogICAgLy9Qb3NzaWJsZSBiZXQgdHlwZXMKICAgIEJldFR5cGVzIGJldFR5cGU7CiAgICB1aW50IGlucHV0OyAvL3N0b3JlcyBudW1iZXIsIGNvbG9yLCBkb3plbiBvciBvZGRldmVuCiAgICB1aW50MjU2IHdhZ2VyOwogICAgdWludDI1NiBibG9ja051bWJlcjsgLy9ibG9jayBvZiBiZXQKICAgIHVpbnQyNTYgYmxvY2tTcGlubmVkOyAvL2Jsb2NrIG9mIHNwaW4KICAgIHVpbnQ4IHdoZWVsUmVzdWx0OwogIH0KICBHYW1ibGVbXSBwcml2YXRlIGdhbWJsZXM7CgogIC8vVHJhY2tpbmcgcHJvZ3Jlc3Mgb2YgcGxheWVycwogIG1hcHBpbmcgKGFkZHJlc3M9PnVpbnQpIGdhbWJsZUluZGV4OyAvL2N1cnJlbnQgZ2FtYmxlIGluZGV4IG9mIHRoZSBwbGF5ZXIKICAvL3JlY29yZHMgY3VycmVudCBzdGF0dXMgb2YgcGxheWVyCiAgZW51bSBTdGF0dXMge3dhaXRpbmdGb3JCZXQsIHdhaXRpbmdGb3JTcGlufSBtYXBwaW5nIChhZGRyZXNzPT5TdGF0dXMpIHBsYXllclN0YXR1czsgCgoKICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAvLyAgICAgICAgTWFuYWdlbWVudCAmIENvbmZpZyBGVU5DVElPTlMgICAgICAgIC8vCiAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogIGZ1bmN0aW9uICBSb3VsZXRoKGFkZHJlc3MgX2RldmVsb3BlciwgYWRkcmVzcyBfd2luVG9rZW4pIC8vY3JlYXRpb24gc2V0dGluZ3MKICB7CiAgICBXSU5UT0tFTkFERFJFU1MgPSBfd2luVG9rZW47CiAgICB3aW5Ub2tlbkluc3RhbmNlID0gV2luVG9rZW4oX3dpblRva2VuKTsKICAgIGRldmVsb3BlciA9IF9kZXZlbG9wZXI7CiAgICBibG9ja0RlbGF5PTA7IC8vaW5kaWNhdGVzIHdoaWNoIGJsb2NrIGFmdGVyIGJldCB3aWxsIGJlIHVzZWQgZm9yIFJORwogICAgYmxvY2tFeHBpcmF0aW9uPTI0NTsgLy9kZWxheSBhZnRlciB3aGljaCBnYW1ibGUgZXhwaXJlcwogICAgbWluR2FtYmxlPTEwIGZpbm5leTsgLy9jb25maWd1cmFibGUgbWluIGJldAogICAgbWF4R2FtYmxlPTEgZXRoZXI7IC8vY29uZmlndXJhYmxlIG1heCBiZXQKICAgIGVtaXNzaW9uUmF0ZSA9IDU7CiAgfQogICAgCiAgbW9kaWZpZXIgb25seURldmVsb3BlcigpIAogIHsKICAgIGlmIChtc2cuc2VuZGVyIT1kZXZlbG9wZXIpIHRocm93OwogICAgXzsKICB9CgogIGZ1bmN0aW9uIGFkZEJhbmtyb2xsKCkKICAgIG9ubHlEZXZlbG9wZXIKICAgIHBheWFibGUgewogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQmFua3JvbGwodWludDI1NiBfYW1vdW50X3dlaSkKICAgIG9ubHlEZXZlbG9wZXIKICB7CiAgICBpZiAoIWRldmVsb3Blci5zZW5kKF9hbW91bnRfd2VpKSkgdGhyb3c7CiAgfQogICAgCiAgZnVuY3Rpb24gY2hhbmdlRGV2ZWxvcGVyX29ubHlfRGV2KGFkZHJlc3MgbmV3X2RldikKICAgIG9ubHlEZXZlbG9wZXIKICB7CiAgICBkZXZlbG9wZXI9bmV3X2RldjsKICB9CgoKCgoKICAvL0NoYW5nZSBzb21lIHNldHRpbmdzIHdpdGhpbiBzYWZldHkgYm91bmRzCiAgZnVuY3Rpb24gY2hhbmdlU2V0dGluZ3Nfb25seV9EZXYodWludDI1NiBuZXdNaW5HYW1ibGUsIHVpbnQyNTYgbmV3TWF4R2FtYmxlLCB1aW50OCBuZXdCbG9ja0RlbGF5LCB1aW50OCBuZXdCbG9ja0V4cGlyYXRpb24sIHVpbnQgbmV3RW1pc3Npb25SYXRlKQogICAgb25seURldmVsb3BlcgogIHsKICAgIGVtaXNzaW9uUmF0ZSA9IG5ld0VtaXNzaW9uUmF0ZTsKICAgIC8vTUFYIEJFVCA6IGxpbWl0ZWQgYnkgcGF5cm9sbC8oY2FzaW5vU3RhdGlzdGljYWxMaW1pdCozNSkKICAgIGlmIChuZXdNYXhHYW1ibGU8bmV3TWluR2FtYmxlKSB0aHJvdzsgIAogICAgbWF4R2FtYmxlPW5ld01heEdhbWJsZTsgCiAgICBtaW5HYW1ibGU9bmV3TWluR2FtYmxlOwogICAgLy9EZWxheSBiZWZvcmUgc3BpbiA6CiAgICBibG9ja0RlbGF5PW5ld0Jsb2NrRGVsYXk7CiAgICBpZiAobmV3QmxvY2tFeHBpcmF0aW9uIDwgYmxvY2tEZWxheSArIDI1MCkgdGhyb3c7CiAgICBibG9ja0V4cGlyYXRpb249bmV3QmxvY2tFeHBpcmF0aW9uOwogIH0KCgogIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIC8vICAgICAgICAgICAgICAgICBCRVRUSU5HIEZVTkNUSU9OUyAgICAgICAgICAgICAgICAgICAgLy8KICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgLy8qKiovL2Jhc2ljIGJldHRpbmcgd2l0aG91dCBNaXN0IG9yIGNvbnRyYWN0IGNhbGwKICAvL2FjdGl2YXRlcyB3aGVuIHRoZSBwbGF5ZXIgb25seSBzZW5kcyBldGggdG8gdGhlIGNvbnRyYWN0CiAgLy93aXRob3V0IHNwZWNpZnlpbmcgYW55IHR5cGUgb2YgYmV0LgogIGZ1bmN0aW9uICgpCiAgICBwYXlhYmxlCiAgICB7CiAgICAgIC8vZGVmYXV0IGJldCA6IGJldCBvbiByZWQKICAgICAgYmV0T25Db2xvcihmYWxzZSk7CiAgICB9IAoKICAvLyoqKi8vR3VhcmFudGVlcyB0aGF0IGdhbWJsZSBpcyB1bmRlciBtYXggYmV0IGFuZCBhYm92ZSBtaW4uCiAgLy8gcmV0dXJucyBiZXQgdmFsdWUKICBmdW5jdGlvbiBjaGVja0JldFZhbHVlKCkgcHJpdmF0ZSByZXR1cm5zKHVpbnQyNTYpCiAgewogICAgaWYgKG1zZy52YWx1ZSA8IG1pbkdhbWJsZSkgdGhyb3c7CiAgICBpZiAobXNnLnZhbHVlID4gbWF4R2FtYmxlKXsKICAgICAgcmV0dXJuIG1heEdhbWJsZTsKICAgIH0KICAgIGVsc2V7CiAgICAgIHJldHVybiBtc2cudmFsdWU7CiAgICB9CiAgfQoKCgogIC8vRnVuY3Rpb24gcmVjb3JkIGJldCBjYWxsZWQgYnkgYWxsIG90aGVycyBiZXR0aW5nIGZ1bmN0aW9ucwogIGZ1bmN0aW9uIHBsYWNlQmV0KEJldFR5cGVzIGJldFR5cGUsIHVpbnQgaW5wdXQpIHByaXZhdGUKICB7CgogICAgaWYgKHBsYXllclN0YXR1c1ttc2cuc2VuZGVyXSAhPSBTdGF0dXMud2FpdGluZ0ZvckJldCkgewogICAgICBpZiAoIVNwaW5UaGVXaGVlbChtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICB9CgogICAgLy9PbmNlIHRoaXMgaXMgZG9uZSwgd2UgY2FuIHJlY29yZCB0aGUgbmV3IGJldAogICAgcGxheWVyU3RhdHVzW21zZy5zZW5kZXJdID0gU3RhdHVzLndhaXRpbmdGb3JTcGluOwogICAgZ2FtYmxlSW5kZXhbbXNnLnNlbmRlcl0gPSBnYW1ibGVzLmxlbmd0aDsKICAgIAogICAgLy9hZGFwdHMgd2FnZXIgdG8gY2FzaW5vIGxpbWl0cwogICAgdWludDI1NiBiZXRWYWx1ZSA9IGNoZWNrQmV0VmFsdWUoKTsKICAgIHBlbmRpbmdUb2tlbnNbbXNnLnNlbmRlcl0gKz0gYmV0VmFsdWUgKiBlbWlzc2lvblJhdGU7CgogICAgCiAgICBnYW1ibGVzLnB1c2goR2FtYmxlKG1zZy5zZW5kZXIsIGZhbHNlLCBmYWxzZSwgYmV0VHlwZSwgaW5wdXQsIGJldFZhbHVlLCBibG9jay5udW1iZXIsIDAsIDM3KSk7IC8vMzcgaW5kaWNhdGVzIG5vdCBzcGlubmVkIHlldAogICAgCiAgICAvL3JlZnVuZCBleGNlc3MgYmV0IChhdCBsYXN0IHN0ZXAgdnMgcmUtZW50cnkpCiAgICBpZiAoYmV0VmFsdWUgPCBtc2cudmFsdWUpIHsKICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUtYmV0VmFsdWUpPT1mYWxzZSkgdGhyb3c7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRQZW5kaW5nVG9rZW5zKGFkZHJlc3MgYWNjb3VudCkgY29uc3RhbnQgcmV0dXJucyAodWludCl7CiAgICByZXR1cm4gcGVuZGluZ1Rva2Vuc1thY2NvdW50XTsKICB9CiAgCiAgZnVuY3Rpb24gcmVkZWVtVG9rZW5zKCl7CiAgICB1aW50IHRvdGFsVG9rZW5zID0gcGVuZGluZ1Rva2Vuc1ttc2cuc2VuZGVyXTsKICAgIGlmICh0b3RhbFRva2VucyA9PSAwKSByZXR1cm47CiAgICBwZW5kaW5nVG9rZW5zW21zZy5zZW5kZXJdID0gMDsKCiAgICAvL0FERCBQT1RFTlRJQUwgQk9OVVMgQkFTRUQgT04gSG93IGxvbmcgd2FpdGVkIQogICAgCiAgICAvL21pbnQgV0lOIFRva2VucwogICAgd2luVG9rZW5JbnN0YW5jZS5taW50VG9rZW5zKG1zZy5zZW5kZXIsIHRvdGFsVG9rZW5zKTsKICB9CgogIAoKICAvLyoqKi8vYmV0IG9uIE51bWJlcgkKICBmdW5jdGlvbiBiZXRPbk51bWJlcih1aW50IG51bWJlckNob3NlbikKICAgIHBheWFibGUKICB7CiAgICAvL2NoZWNrIHRoYXQgbnVtYmVyIGNob3NlbiBpcyB2YWxpZCBhbmQgcmVjb3JkcyBiZXQKICAgIGlmIChudW1iZXJDaG9zZW4+MzYpIHRocm93OwogICAgcGxhY2VCZXQoQmV0VHlwZXMubnVtYmVyLCBudW1iZXJDaG9zZW4pOwogIH0KCiAgLy8qKiovLyBmdW5jdGlvbiBiZXRPbkNvbG9yCiAgLy9iZXQgdHlwZSA6IGNvbG9yCiAgLy9pbnB1dCA6IDAgZm9yIHJlZAogIC8vaW5wdXQgOiAxIGZvciBibGFjawogIGZ1bmN0aW9uIGJldE9uQ29sb3IoYm9vbCBCbGFjaykKICAgIHBheWFibGUKICB7CiAgICB1aW50IGlucHV0OwogICAgaWYgKCFCbGFjaykgCiAgICAgIHsgCglpbnB1dD0wOwogICAgICB9CiAgICBlbHNlewogICAgICBpbnB1dD0xOwogICAgfQogICAgcGxhY2VCZXQoQmV0VHlwZXMuY29sb3IsIGlucHV0KTsKICB9CgogIC8vKioqLy8gZnVuY3Rpb24gYmV0T25Mb3dfSGlnaAogIC8vYmV0IHR5cGUgOiBsb3doaWdoCiAgLy9pbnB1dCA6IDAgZm9yIGxvdwogIC8vaW5wdXQgOiAxIGZvciBsb3cKICBmdW5jdGlvbiBiZXRPbkxvd0hpZ2goYm9vbCBIaWdoKQogICAgcGF5YWJsZQogIHsKICAgIHVpbnQgaW5wdXQ7CiAgICBpZiAoIUhpZ2gpIAogICAgICB7IAoJaW5wdXQ9MDsKICAgICAgfQogICAgZWxzZSAKICAgICAgewoJaW5wdXQ9MTsKICAgICAgfQogICAgcGxhY2VCZXQoQmV0VHlwZXMubG93aGlnaCwgaW5wdXQpOwogIH0KCiAgLy8qKiovLyBmdW5jdGlvbiBiZXRPbk9kZEV2ZW4KICAvL2JldCB0eXBlIDogcGFyaXR5CiAgLy9pbnB1dCA6IDAgZm9yIGV2ZW4KICAvL2lucHV0IDogMSBmb3Igb2RkCiAgZnVuY3Rpb24gYmV0T25PZGRFdmVuKGJvb2wgT2RkKQogICAgcGF5YWJsZQogIHsKICAgIHVpbnQgaW5wdXQ7CiAgICBpZiAoIU9kZCkgCiAgICAgIHsgCglpbnB1dD0wOwogICAgICB9CiAgICBlbHNlewogICAgICBpbnB1dD0xOwogICAgfQogICAgcGxhY2VCZXQoQmV0VHlwZXMucGFyaXR5LCBpbnB1dCk7CiAgfQoKICAvLyoqKi8vIGZ1bmN0aW9uIGJldE9uRG96ZW4KICAvLyAgICAgLy9iZXQgdHlwZSA6IGRvemVuCiAgLy8gICAgIC8vaW5wdXQgOiAwIGZvciBmaXJzdCBkb3plbgogIC8vICAgICAvL2lucHV0IDogMSBmb3Igc2Vjb25kIGRvemVuCiAgLy8gICAgIC8vaW5wdXQgOiAyIGZvciB0aGlyZCBkb3plbgogIGZ1bmN0aW9uIGJldE9uRG96ZW4odWludCBkb3plbl9zZWxlY3RlZF8wXzFfMikKICAgIHBheWFibGUKCiAgewogICAgaWYgKGRvemVuX3NlbGVjdGVkXzBfMV8yID4gMikgdGhyb3c7CiAgICBwbGFjZUJldChCZXRUeXBlcy5kb3plbiwgZG96ZW5fc2VsZWN0ZWRfMF8xXzIpOwogIH0KCgogIC8vIC8vKioqLy8gZnVuY3Rpb24gYmV0T25Db2x1bW4KICAvLyAgICAgLy9iZXQgdHlwZSA6IGNvbHVtbgogIC8vICAgICAvL2lucHV0IDogMCBmb3IgZmlyc3QgY29sdW1uCiAgLy8gICAgIC8vaW5wdXQgOiAxIGZvciBzZWNvbmQgY29sdW1uCiAgLy8gICAgIC8vaW5wdXQgOiAyIGZvciB0aGlyZCBjb2x1bW4KICBmdW5jdGlvbiBiZXRPbkNvbHVtbih1aW50IGNvbHVtbl9zZWxlY3RlZF8wXzFfMikKICAgIHBheWFibGUKICB7CiAgICBpZiAoY29sdW1uX3NlbGVjdGVkXzBfMV8yID4gMikgdGhyb3c7CiAgICBwbGFjZUJldChCZXRUeXBlcy5jb2x1bW4sIGNvbHVtbl9zZWxlY3RlZF8wXzFfMik7CiAgfQoKICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAvLyBTcGluIFRoZSBXaGVlbCAmIENoZWNrIFJlc3VsdCBGVU5DVElPTlMvLwogIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICBldmVudCBXaW4oYWRkcmVzcyBwbGF5ZXIsIHVpbnQ4IHJlc3VsdCwgdWludCB2YWx1ZV93b24sIGJ5dGVzMzIgYkhhc2gsIGJ5dGVzMzIgc2hhM1BsYXllciwgdWludCBnYW1ibGVJZCwgdWludCBiZXQpOwogIGV2ZW50IExvc3MoYWRkcmVzcyBwbGF5ZXIsIHVpbnQ4IHJlc3VsdCwgdWludCB2YWx1ZV9sb3NzLCBieXRlczMyIGJIYXNoLCBieXRlczMyIHNoYTNQbGF5ZXIsIHVpbnQgZ2FtYmxlSWQsIHVpbnQgYmV0KTsKCiAgLy8qKiovL2Z1bmN0aW9uIHRvIHNwaW4gY2FsbGFibGUKICAvLyBubyBldGggYWxsb3dlZAogIGZ1bmN0aW9uIHNwaW5UaGVXaGVlbChhZGRyZXNzIHNwaW5fZm9yX3BsYXllcikKICB7CiAgICBTcGluVGhlV2hlZWwoc3Bpbl9mb3JfcGxheWVyKTsKICB9CgoKICBmdW5jdGlvbiBTcGluVGhlV2hlZWwoYWRkcmVzcyBwbGF5ZXJTcGlubmVkKSBwcml2YXRlIHJldHVybnMoYm9vbCkKICB7CiAgICBpZiAocGxheWVyU3Bpbm5lZD09MCkKICAgICAgewoJcGxheWVyU3Bpbm5lZD1tc2cuc2VuZGVyOyAgICAgICAgIC8vaWYgbm8gaW5kZXggc3BpbnMgZm9yIHRoZSBzZW5kZXIKICAgICAgfQoKICAgIC8vY2hlY2sgdGhhdCBwbGF5ZXIgaGFzIHRvIHNwaW4KICAgIGlmIChwbGF5ZXJTdGF0dXNbcGxheWVyU3Bpbm5lZF0gIT0gU3RhdHVzLndhaXRpbmdGb3JTcGluKSByZXR1cm4gZmFsc2U7CgogICAgLy9yZWR1bmRlbnQgZG91YmxlIGNoZWNrIDogY2hlY2sgdGhhdCBnYW1ibGUgaGFzIG5vdCBiZWVuIHNwaW5uZWQgYWxyZWFkeQogICAgaWYgKGdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyU3Bpbm5lZF1dLnNwaW5uZWQgPT0gdHJ1ZSkgdGhyb3c7CgogICAgCiAgICAvL2NoZWNrIHRoYXQgdGhlIHBsYXllciB3YWl0ZWQgZm9yIHRoZSBkZWxheSBiZWZvcmUgc3BpbgogICAgLy9hbmQgYWxzbyB0aGF0IHRoZSBiZXQgaXMgbm90IGV4cGlyZWQKICAgIHVpbnQgcGxheWVyYmxvY2sgPSBnYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllclNwaW5uZWRdXS5ibG9ja051bWJlcjsKICAgIC8vdG9vIGVhcmx5IHRvIHNwaW4KICAgIGlmIChibG9jay5udW1iZXIgPD0gcGxheWVyYmxvY2srYmxvY2tEZWxheSkgdGhyb3c7CiAgICAvL3RvbyBsYXRlLCBiZXQgZXhwaXJlZCwgcGxheWVyIGxvc3QKICAgIGVsc2UgaWYgKGJsb2NrLm51bWJlciA+IHBsYXllcmJsb2NrK2Jsb2NrRXhwaXJhdGlvbikgc29sdmVCZXQocGxheWVyU3Bpbm5lZCwgMjU1LCBmYWxzZSwgMSwgMCwgMCkgOwogICAgLy9zcGluICEKICAgIGVsc2UKICAgICAgewoJdWludDggd2hlZWxSZXN1bHQ7CgkvL1NwaW4gdGhlIHdoZWVsLCAKCWJ5dGVzMzIgYmxvY2tIYXNoPSBibG9jay5ibG9ja2hhc2gocGxheWVyYmxvY2srYmxvY2tEZWxheSk7CgkvL3NlY3VyaXR5IGNoZWNrIHRoYXQgdGhlIEhhc2ggaXMgbm90IGVtcHR5CglpZiAoYmxvY2tIYXNoPT0wKSB0aHJvdzsKCS8vIGdlbmVyYXRlIHRoZSBoYXNoIGZvciBSTkcgZnJvbSB0aGUgYmxvY2tIYXNoIGFuZCB0aGUgcGxheWVyJ3MgYWRkcmVzcwoJYnl0ZXMzMiBzaGFQbGF5ZXIgPSBzaGEzKHBsYXllclNwaW5uZWQsIGJsb2NrSGFzaCwgdGhpcyk7CgkvLyBnZXQgdGhlIGZpbmFsIHdoZWVsIHJlc3VsdAoJd2hlZWxSZXN1bHQgPSB1aW50OCh1aW50MjU2KHNoYVBsYXllciklMzcpOwoJLy9jaGVjayByZXN1bHQgYWdhaW5zdCBiZXQgYW5kIHBheSBpZiB3aW4KCWNoZWNrQmV0UmVzdWx0KHdoZWVsUmVzdWx0LCBwbGF5ZXJTcGlubmVkLCBibG9ja0hhc2gsIHNoYVBsYXllcik7CiAgICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICAgIAoKICAvL0NIRUNLIEJFVFMgRlVOQ1RJT05TIHByaXZhdGUKICBmdW5jdGlvbiBjaGVja0JldFJlc3VsdCh1aW50OCByZXN1bHQsIGFkZHJlc3MgcGxheWVyLCBieXRlczMyIGJsb2NrSGFzaCwgYnl0ZXMzMiBzaGFQbGF5ZXIpIHByaXZhdGUKICB7CiAgICBCZXRUeXBlcyBiZXRUeXBlPWdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0uYmV0VHlwZTsKICAgIC8vYmV0IG9uIE51bWJlcgogICAgaWYgKGJldFR5cGU9PUJldFR5cGVzLm51bWJlcikgY2hlY2tCZXROdW1iZXIocmVzdWx0LCBwbGF5ZXIsIGJsb2NrSGFzaCwgc2hhUGxheWVyKTsKICAgIGVsc2UgaWYgKGJldFR5cGU9PUJldFR5cGVzLnBhcml0eSkgY2hlY2tCZXRQYXJpdHkocmVzdWx0LCBwbGF5ZXIsIGJsb2NrSGFzaCwgc2hhUGxheWVyKTsKICAgIGVsc2UgaWYgKGJldFR5cGU9PUJldFR5cGVzLmNvbG9yKSBjaGVja0JldENvbG9yKHJlc3VsdCwgcGxheWVyLCBibG9ja0hhc2gsIHNoYVBsYXllcik7CiAgICBlbHNlIGlmIChiZXRUeXBlPT1CZXRUeXBlcy5sb3doaWdoKSBjaGVja0JldExvd2hpZ2gocmVzdWx0LCBwbGF5ZXIsIGJsb2NrSGFzaCwgc2hhUGxheWVyKTsKICAgIGVsc2UgaWYgKGJldFR5cGU9PUJldFR5cGVzLmRvemVuKSBjaGVja0JldERvemVuKHJlc3VsdCwgcGxheWVyLCBibG9ja0hhc2gsIHNoYVBsYXllcik7CiAgICBlbHNlIGlmIChiZXRUeXBlPT1CZXRUeXBlcy5jb2x1bW4pIGNoZWNrQmV0Q29sdW1uKHJlc3VsdCwgcGxheWVyLCBibG9ja0hhc2gsIHNoYVBsYXllcik7CiAgfQoKICAvLyBmdW5jdGlvbiBzb2x2ZSBCZXQgb25jZSByZXN1bHQgaXMgZGV0ZXJtaW5lZCA6IHNlbmRzIHRvIHdpbm5lciwgYWRkcyBsb3NzIHRvIHByb2ZpdAogIGZ1bmN0aW9uIHNvbHZlQmV0KGFkZHJlc3MgcGxheWVyLCB1aW50OCByZXN1bHQsIGJvb2wgd2luLCB1aW50OCBtdWx0aXBsaWVyLCBieXRlczMyIGJsb2NrSGFzaCwgYnl0ZXMzMiBzaGFQbGF5ZXIpIHByaXZhdGUKICB7CiAgICAvL1VwZGF0ZSBzdGF0dXMgYW5kIHJlY29yZCBzcGlubmVkCiAgICBwbGF5ZXJTdGF0dXNbcGxheWVyXT1TdGF0dXMud2FpdGluZ0ZvckJldDsKICAgIGdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0ud2hlZWxSZXN1bHQ9cmVzdWx0OwogICAgZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS5zcGlubmVkPXRydWU7CiAgICBnYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmJsb2NrU3Bpbm5lZD1ibG9jay5udW1iZXI7CiAgICB1aW50IGJldF92ID0gZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS53YWdlcjsKCQogICAgaWYgKHdpbikKICAgICAgewoJZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS53aW49dHJ1ZTsKCXVpbnQgd2luX3YgPSAobXVsdGlwbGllci0xKSpiZXRfdjsKCVdpbihwbGF5ZXIsIHJlc3VsdCwgd2luX3YsIGJsb2NrSGFzaCwgc2hhUGxheWVyLCBnYW1ibGVJbmRleFtwbGF5ZXJdLCBiZXRfdik7CgkvL3NlbmQgd2luIQoJLy9zYWZlIHNlbmQgdnMgcG90ZW50aWFsIGNhbGxzdGFjayBvdmVyZmxvd2VkIHNwaW5zCglpZiAocGxheWVyLnNlbmQod2luX3YrYmV0X3YpPT1mYWxzZSkgdGhyb3c7CiAgICAgIH0KICAgIGVsc2UKICAgICAgewoJTG9zcyhwbGF5ZXIsIHJlc3VsdCwgYmV0X3YtMSwgYmxvY2tIYXNoLCBzaGFQbGF5ZXIsIGdhbWJsZUluZGV4W3BsYXllcl0sIGJldF92KTsKCS8vc2VuZCAxIHdlaSB0byBjb25maXJtIHNwaW4gaWYgbG9zcwoJaWYgKHBsYXllci5zZW5kKDEpPT1mYWxzZSkgdGhyb3c7CiAgICAgIH0KCiAgfQoKICAvLyBjaGVja2JldG9uIG51bWJlcihpbnB1dCkKICAvLyBiZXQgdHlwZSA6IG51bWJlcgogIC8vIGlucHV0IDogY2hvc2VuIG51bWJlcgogIGZ1bmN0aW9uIGNoZWNrQmV0TnVtYmVyKHVpbnQ4IHJlc3VsdCwgYWRkcmVzcyBwbGF5ZXIsIGJ5dGVzMzIgYmxvY2tIYXNoLCBieXRlczMyIHNoYVBsYXllcikgcHJpdmF0ZQogIHsKICAgIGJvb2wgd2luOwogICAgLy93aW4KICAgIGlmIChyZXN1bHQ9PWdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0uaW5wdXQpCiAgICAgIHsKCXdpbj10cnVlOyAgCiAgICAgIH0KICAgIHNvbHZlQmV0KHBsYXllciwgcmVzdWx0LHdpbiwzNiwgYmxvY2tIYXNoLCBzaGFQbGF5ZXIpOwogIH0KCgogIC8vIGNoZWNrYmV0IG9uIG9kZGV2ZW4KICAvLyBiZXQgdHlwZSA6IHBhcml0eQogIC8vIGlucHV0IDogMCBmb3IgZXZlbiwgMSBmb3Igb2RkCiAgZnVuY3Rpb24gY2hlY2tCZXRQYXJpdHkodWludDggcmVzdWx0LCBhZGRyZXNzIHBsYXllciwgYnl0ZXMzMiBibG9ja0hhc2gsIGJ5dGVzMzIgc2hhUGxheWVyKSBwcml2YXRlCiAgewogICAgYm9vbCB3aW47CiAgICAvL3dpbgogICAgaWYgKHJlc3VsdCUyPT1nYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmlucHV0ICYmIHJlc3VsdCE9MCkKICAgICAgewoJd2luPXRydWU7ICAgICAgICAgICAgICAgIAogICAgICB9CiAgICBzb2x2ZUJldChwbGF5ZXIscmVzdWx0LHdpbiwyLCBibG9ja0hhc2gsIHNoYVBsYXllcik7CiAgfQogICAgCiAgLy8gY2hlY2tiZXQgb24gbG93aGlnaAogIC8vIGJldCB0eXBlIDogbG93aGlnaAogIC8vIGlucHV0IDogMCBsb3csIDEgaGlnaAogIGZ1bmN0aW9uIGNoZWNrQmV0TG93aGlnaCh1aW50OCByZXN1bHQsIGFkZHJlc3MgcGxheWVyLCBieXRlczMyIGJsb2NrSGFzaCwgYnl0ZXMzMiBzaGFQbGF5ZXIpIHByaXZhdGUKICB7CiAgICBib29sIHdpbjsKICAgIC8vd2luCiAgICBpZiAocmVzdWx0IT0wICYmICggKHJlc3VsdDwxOSAmJiBnYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmlucHV0PT0wKQoJCSAgICAgICB8fCAocmVzdWx0PjE4ICYmIGdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0uaW5wdXQ9PTEpCgkJICAgICAgICkgKQogICAgICB7Cgl3aW49dHJ1ZTsKICAgICAgfQogICAgc29sdmVCZXQocGxheWVyLHJlc3VsdCx3aW4sMiwgYmxvY2tIYXNoLCBzaGFQbGF5ZXIpOwogIH0KCiAgLy8gY2hlY2tiZXQgb24gY29sb3IKICAvLyBiZXQgdHlwZSA6IGNvbG9yCiAgLy8gaW5wdXQgOiAwIHJlZCwgMSBibGFjawogIHVpbnRbMThdIHJlZF9saXN0PVsxLDMsNSw3LDksMTIsMTQsMTYsMTgsMTksMjEsMjMsMjUsMjcsMzAsMzIsMzQsMzZdOwogIGZ1bmN0aW9uIGNoZWNrQmV0Q29sb3IodWludDggcmVzdWx0LCBhZGRyZXNzIHBsYXllciwgYnl0ZXMzMiBibG9ja0hhc2gsIGJ5dGVzMzIgc2hhUGxheWVyKSBwcml2YXRlCiAgewogICAgYm9vbCByZWQ7CiAgICAvL2NoZWNrIGlmIHJlZAogICAgZm9yICh1aW50OCBrOyBrPDE4OyBrKyspCiAgICAgIHsgCglpZiAocmVkX2xpc3Rba109PXJlc3VsdCkgCgkgIHsgCgkgICAgcmVkPXRydWU7IAoJICAgIGJyZWFrOwoJICB9CiAgICAgIH0KICAgIGJvb2wgd2luOwogICAgLy93aW4KICAgIGlmICggcmVzdWx0IT0wCgkgJiYgKCAoZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS5pbnB1dD09MCAmJiByZWQpICAKCSAgICAgIHx8ICggZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS5pbnB1dD09MSAmJiAhcmVkKSAgKSApCiAgICAgIHsKCXdpbj10cnVlOwogICAgICB9CiAgICBzb2x2ZUJldChwbGF5ZXIscmVzdWx0LHdpbiwyLCBibG9ja0hhc2gsIHNoYVBsYXllcik7CiAgfQoKICAvLyBjaGVja2JldCBvbiBkb3plbgogIC8vIGJldCB0eXBlIDogZG96ZW4KICAvLyBpbnB1dCA6IDAgZmlyc3QsIDEgc2Vjb25kLCAyIHRoaXJkCiAgZnVuY3Rpb24gY2hlY2tCZXREb3plbih1aW50OCByZXN1bHQsIGFkZHJlc3MgcGxheWVyLCBieXRlczMyIGJsb2NrSGFzaCwgYnl0ZXMzMiBzaGFQbGF5ZXIpIHByaXZhdGUKICB7IAogICAgYm9vbCB3aW47CiAgICAvL3dpbiBvbiBmaXJzdCBkb3plbgogICAgaWYgKCByZXN1bHQhPTAgJiYKCSAoIChyZXN1bHQ8MTMgJiYgZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS5pbnB1dD09MCkKCSAgIHx8CgkgICAocmVzdWx0PjEyICYmIHJlc3VsdDwyNSAmJiBnYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmlucHV0PT0xKQoJICAgfHwKCSAgIChyZXN1bHQ+MjQgJiYgZ2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS5pbnB1dD09MikgKSApCiAgICAgIHsKCXdpbj10cnVlOyAgICAgICAgICAgICAgICAKICAgICAgfQogICAgc29sdmVCZXQocGxheWVyLHJlc3VsdCx3aW4sMywgYmxvY2tIYXNoLCBzaGFQbGF5ZXIpOwogIH0KCiAgLy8gY2hlY2tiZXQgb24gY29sdW1uCiAgLy8gYmV0IHR5cGUgOiBjb2x1bW4KICAvLyBpbnB1dCA6IDAgZmlyc3QsIDEgc2Vjb25kLCAyIHRoaXJkCiAgZnVuY3Rpb24gY2hlY2tCZXRDb2x1bW4odWludDggcmVzdWx0LCBhZGRyZXNzIHBsYXllciwgYnl0ZXMzMiBibG9ja0hhc2gsIGJ5dGVzMzIgc2hhUGxheWVyKSBwcml2YXRlCiAgewogICAgYm9vbCB3aW47CiAgICAvL3dpbgogICAgaWYgKCByZXN1bHQhPTAKCSAmJiAoIChnYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmlucHV0PT0wICYmIHJlc3VsdCUzPT0xKSAgCgkgICAgICB8fCAoIGdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0uaW5wdXQ9PTEgJiYgcmVzdWx0JTM9PTIpCgkgICAgICB8fCAoIGdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0uaW5wdXQ9PTIgJiYgcmVzdWx0JTM9PTApICApICkKICAgICAgewoJd2luPXRydWU7CiAgICAgIH0KICAgIHNvbHZlQmV0KHBsYXllcixyZXN1bHQsd2luLDMsIGJsb2NrSGFzaCwgc2hhUGxheWVyKTsKICB9CgoKICBmdW5jdGlvbiBjaGVja015QmV0KGFkZHJlc3MgcGxheWVyKSBjb25zdGFudCByZXR1cm5zKFN0YXR1cyBwbGF5ZXJfc3RhdHVzLCBCZXRUeXBlcyBiZXR0eXBlLCB1aW50IGlucHV0LCB1aW50IHZhbHVlLCB1aW50OCByZXN1bHQsIGJvb2wgd2hlZWxzcGlubmVkLCBib29sIHdpbiwgdWludCBibG9ja05iLCB1aW50IGJsb2NrU3BpbiwgdWludCBnYW1ibGVJRCkKICB7CiAgICBwbGF5ZXJfc3RhdHVzPXBsYXllclN0YXR1c1twbGF5ZXJdOwogICAgYmV0dHlwZT1nYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmJldFR5cGU7CiAgICBpbnB1dD1nYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmlucHV0OwogICAgdmFsdWU9Z2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS53YWdlcjsKICAgIHJlc3VsdD1nYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLndoZWVsUmVzdWx0OwogICAgd2hlZWxzcGlubmVkPWdhbWJsZXNbZ2FtYmxlSW5kZXhbcGxheWVyXV0uc3Bpbm5lZDsKICAgIHdpbj1nYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLndpbjsKICAgIGJsb2NrTmI9Z2FtYmxlc1tnYW1ibGVJbmRleFtwbGF5ZXJdXS5ibG9ja051bWJlcjsKICAgIGJsb2NrU3Bpbj1nYW1ibGVzW2dhbWJsZUluZGV4W3BsYXllcl1dLmJsb2NrU3Bpbm5lZDsKICAgIGdhbWJsZUlEPWdhbWJsZUluZGV4W3BsYXllcl07CiAgICByZXR1cm47CiAgfQoKICBmdW5jdGlvbiBnZXRUb3RhbEdhbWJsZXMoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpewogICAgcmV0dXJuIGdhbWJsZXMubGVuZ3RoOwogIH0KCiAgCiAgZnVuY3Rpb24gZ2V0R2FtYmxlc0xpc3QodWludDI1NiBpbmRleCkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzIHBsYXllciwgQmV0VHlwZXMgYmV0dHlwZSwgdWludCBpbnB1dCwgdWludCB2YWx1ZSwgdWludDggcmVzdWx0LCBib29sIHdoZWVsc3Bpbm5lZCwgYm9vbCB3aW4sIHVpbnQgYmxvY2tOYiwgdWludCBibG9ja1NwaW4pCiAgewogICAgcGxheWVyPWdhbWJsZXNbaW5kZXhdLnBsYXllcjsKICAgIGJldHR5cGU9Z2FtYmxlc1tpbmRleF0uYmV0VHlwZTsKICAgIGlucHV0PWdhbWJsZXNbaW5kZXhdLmlucHV0OwogICAgdmFsdWU9Z2FtYmxlc1tpbmRleF0ud2FnZXI7CiAgICByZXN1bHQ9Z2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQ7CiAgICB3aGVlbHNwaW5uZWQ9Z2FtYmxlc1tpbmRleF0uc3Bpbm5lZDsKICAgIHdpbj1nYW1ibGVzW2luZGV4XS53aW47CiAgICBibG9ja05iPWdhbWJsZXNbaW5kZXhdLmJsb2NrTnVtYmVyOwogICAgYmxvY2tTcGluPWdhbWJsZXNbaW5kZXhdLmJsb2NrU3Bpbm5lZDsKICAgIHJldHVybjsKICB9Cgp9IC8vZW5kIG9mIGNvbnRyYWN0'.
	

]
