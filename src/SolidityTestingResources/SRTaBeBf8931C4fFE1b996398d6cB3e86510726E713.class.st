Class {
	#name : #SRTaBeBf8931C4fFE1b996398d6cB3e86510726E713,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTaBeBf8931C4fFE1b996398d6cB3e86510726E713 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgS3liZXJSZXNlcnZlSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiB0cmFkZSgKICAgICAgICBFUkMyMCBzcmNUb2tlbiwKICAgICAgICB1aW50IHNyY0Ftb3VudCwKICAgICAgICBFUkMyMCBkZXN0VG9rZW4sCiAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICB1aW50IGNvbnZlcnNpb25SYXRlLAogICAgICAgIGJvb2wgdmFsaWRhdGUKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgcmV0dXJucyhib29sKTsKCiAgICBmdW5jdGlvbiBnZXRDb252ZXJzaW9uUmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5LCB1aW50IGJsb2NrTnVtYmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwp9Cgpjb250cmFjdCBVdGlscyB7CgogICAgRVJDMjAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9RVFkgICA9ICgxMCoqMjgpOyAvLyAxMEIgdG9rZW5zCiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfUkFURSAgPSAoUFJFQ0lTSU9OICogMTAqKjYpOyAvLyB1cCB0byAxTSB0b2tlbnMgcGVyIEVUSAogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX0RFQ0lNQUxTID0gMTg7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBFVEhfREVDSU1BTFMgPSAxODsKICAgIG1hcHBpbmcoYWRkcmVzcz0+dWludCkgaW50ZXJuYWwgZGVjaW1hbHM7CgogICAgZnVuY3Rpb24gc2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpIGRlY2ltYWxzW3Rva2VuXSA9IEVUSF9ERUNJTUFMUzsKICAgICAgICBlbHNlIGRlY2ltYWxzW3Rva2VuXSA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSByZXR1cm4gRVRIX0RFQ0lNQUxTOyAvLyBzYXZlIHN0b3JhZ2UgYWNjZXNzCiAgICAgICAgdWludCB0b2tlbkRlY2ltYWxzID0gZGVjaW1hbHNbdG9rZW5dOwogICAgICAgIC8vIHRlY2huaWNhbGx5LCB0aGVyZSBtaWdodCBiZSB0b2tlbiB3aXRoIGRlY2ltYWxzIDAKICAgICAgICAvLyBtb3Jlb3ZlciwgdmVyeSBwb3NzaWJsZSB0aGF0IG9sZCB0b2tlbnMgaGF2ZSBkZWNpbWFscyAwCiAgICAgICAgLy8gdGhlc2UgdG9rZW5zIHdpbGwganVzdCBoYXZlIGhpZ2hlciBnYXMgZmVlcy4KICAgICAgICBpZih0b2tlbkRlY2ltYWxzID09IDApIHJldHVybiB0b2tlbi5kZWNpbWFscygpOwoKICAgICAgICByZXR1cm4gdG9rZW5EZWNpbWFsczsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjRHN0UXR5KHVpbnQgc3JjUXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShzcmNRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgaWYgKGRzdERlY2ltYWxzID49IHNyY0RlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlKSAvIChQUkVDSVNJT04gKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjUXR5KHVpbnQgZHN0UXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShkc3RRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgLy9zb3VyY2UgcXVhbnRpdHkgaXMgcm91bmRlZCB1cC4gdG8gYXZvaWQgZGVzdCBxdWFudGl0eSBiZWluZyB0b28gbG93LgogICAgICAgIHVpbnQgbnVtZXJhdG9yOwogICAgICAgIHVpbnQgZGVub21pbmF0b3I7CiAgICAgICAgaWYgKHNyY0RlY2ltYWxzID49IGRzdERlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkgKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IHJhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG51bWVyYXRvciArIGRlbm9taW5hdG9yIC0gMSkgLyBkZW5vbWluYXRvcjsgLy9hdm9pZCByb3VuZGluZyBkb3duIGVycm9ycwogICAgfQp9CgppbnRlcmZhY2UgRmVlQnVybmVySW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGhhbmRsZUZlZXMgKHVpbnQgdHJhZGVXZWlBbW91bnQsIGFkZHJlc3MgcmVzZXJ2ZSwgYWRkcmVzcyB3YWxsZXQpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwp9CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9Cgpjb250cmFjdCBXaGl0ZUxpc3RJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gZ2V0VXNlckNhcEluV2VpKGFkZHJlc3MgdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHVzZXJDYXBXZWkpOwp9Cgpjb250cmFjdCBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdBZG1pbjsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgaW50ZXJuYWwgb3BlcmF0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBhbGVydGVyczsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBvcGVyYXRvcnNHcm91cDsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBhbGVydGVyc0dyb3VwOwoKICAgIGZ1bmN0aW9uIFBlcm1pc3Npb25Hcm91cHMoKSBwdWJsaWMgewogICAgICAgIGFkbWluID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcGVyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWxlcnRlcigpIHsKICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZXJhdG9ycyAoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yc0dyb3VwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsZXJ0ZXJzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYWxlcnRlcnNHcm91cDsKICAgIH0KCiAgICBldmVudCBUcmFuc2ZlckFkbWluUGVuZGluZyhhZGRyZXNzIHBlbmRpbmdBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pbihhZGRyZXNzIG5ld0FkbWluKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG5ld0FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIFRyYW5zZmVyQWRtaW5QZW5kaW5nKHBlbmRpbmdBZG1pbik7CiAgICAgICAgcGVuZGluZ0FkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgZXZlbnQgQWRtaW5DbGFpbWVkKCBhZGRyZXNzIG5ld0FkbWluLCBhZGRyZXNzIHByZXZpb3VzQWRtaW4pOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSBjaGFuZ2UgYWRtaW4gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BZG1pbigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShwZW5kaW5nQWRtaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgQWRtaW5DbGFpbWVkKHBlbmRpbmdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gcGVuZGluZ0FkbWluOwogICAgICAgIHBlbmRpbmdBZG1pbiA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZXZlbnQgQWxlcnRlckFkZGVkIChhZGRyZXNzIG5ld0FsZXJ0ZXIsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZEFsZXJ0ZXIoYWRkcmVzcyBuZXdBbGVydGVyKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFhbGVydGVyc1tuZXdBbGVydGVyXSk7IC8vIHByZXZlbnQgZHVwbGljYXRlcy4KICAgICAgICBBbGVydGVyQWRkZWQobmV3QWxlcnRlciwgdHJ1ZSk7CiAgICAgICAgYWxlcnRlcnNbbmV3QWxlcnRlcl0gPSB0cnVlOwogICAgICAgIGFsZXJ0ZXJzR3JvdXAucHVzaChuZXdBbGVydGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBbGVydGVyIChhZGRyZXNzIGFsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbYWxlcnRlcl0pOwogICAgICAgIGFsZXJ0ZXJzW2FsZXJ0ZXJdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsZXJ0ZXJzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKGFsZXJ0ZXJzR3JvdXBbaV0gPT0gYWxlcnRlcikgewogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cFtpXSA9IGFsZXJ0ZXJzR3JvdXBbYWxlcnRlcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGFsZXJ0ZXJzR3JvdXAubGVuZ3RoLS07CiAgICAgICAgICAgICAgICBBbGVydGVyQWRkZWQoYWxlcnRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgT3BlcmF0b3JBZGRlZChhZGRyZXNzIG5ld09wZXJhdG9yLCBib29sIGlzQWRkKTsKCiAgICBmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFvcGVyYXRvcnNbbmV3T3BlcmF0b3JdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIE9wZXJhdG9yQWRkZWQobmV3T3BlcmF0b3IsIHRydWUpOwogICAgICAgIG9wZXJhdG9yc1tuZXdPcGVyYXRvcl0gPSB0cnVlOwogICAgICAgIG9wZXJhdG9yc0dyb3VwLnB1c2gobmV3T3BlcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wZXJhdG9yIChhZGRyZXNzIG9wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1tvcGVyYXRvcl0pOwogICAgICAgIG9wZXJhdG9yc1tvcGVyYXRvcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3BlcmF0b3JzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG9wZXJhdG9yc0dyb3VwW2ldID09IG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cFtpXSA9IG9wZXJhdG9yc0dyb3VwW29wZXJhdG9yc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC09IDE7CiAgICAgICAgICAgICAgICBPcGVyYXRvckFkZGVkKG9wZXJhdG9yLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgV2l0aGRyYXdhYmxlIGlzIFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGV2ZW50IFRva2VuV2l0aGRyYXcoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IGFsbCBFUkMyMCBjb21wYXRpYmxlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuIEVSQzIwIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihzZW5kVG8sIGFtb3VudCkpOwogICAgICAgIFRva2VuV2l0aGRyYXcodG9rZW4sIGFtb3VudCwgc2VuZFRvKTsKICAgIH0KCiAgICBldmVudCBFdGhlcldpdGhkcmF3KHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IEV0aGVycwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBzZW5kVG8udHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBFdGhlcldpdGhkcmF3KGFtb3VudCwgc2VuZFRvKTsKICAgIH0KfQoKaW50ZXJmYWNlIEV4cGVjdGVkUmF0ZUludGVyZmFjZSB7CiAgICBmdW5jdGlvbiBnZXRFeHBlY3RlZFJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSkgcHVibGljIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IGV4cGVjdGVkUmF0ZSwgdWludCBzbGlwcGFnZVJhdGUpOwp9Cgpjb250cmFjdCBFeHBlY3RlZFJhdGUgaXMgV2l0aGRyYXdhYmxlLCBFeHBlY3RlZFJhdGVJbnRlcmZhY2UgewoKICAgIEt5YmVyTmV0d29yayBwdWJsaWMga3liZXJOZXR3b3JrOwogICAgdWludCBwdWJsaWMgcXVhbnRpdHlGYWN0b3IgPSAyOwogICAgdWludCBwdWJsaWMgbWluU2xpcHBhZ2VGYWN0b3JJbkJwcyA9IDUwOwoKICAgIGZ1bmN0aW9uIEV4cGVjdGVkUmF0ZShLeWJlck5ldHdvcmsgX2t5YmVyTmV0d29yaywgYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfa3liZXJOZXR3b3JrICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGt5YmVyTmV0d29yayA9IF9reWJlck5ldHdvcms7CiAgICAgICAgYWRtaW4gPSBfYWRtaW47CiAgICB9CgogICAgZXZlbnQgUXVhbnRpdHlGYWN0b3JTZXQgKHVpbnQgbmV3RmFjdG9yLCB1aW50IG9sZEZhY3RvciwgYWRkcmVzcyBzZW5kZXIpOwoKICAgIGZ1bmN0aW9uIHNldFF1YW50aXR5RmFjdG9yKHVpbnQgbmV3RmFjdG9yKSBwdWJsaWMgb25seU9wZXJhdG9yIHsKICAgICAgICBRdWFudGl0eUZhY3RvclNldChxdWFudGl0eUZhY3RvciwgbmV3RmFjdG9yLCBtc2cuc2VuZGVyKTsKICAgICAgICBxdWFudGl0eUZhY3RvciA9IG5ld0ZhY3RvcjsKICAgIH0KCiAgICBldmVudCBNaW5TbGlwcGFnZUZhY3RvclNldCAodWludCBuZXdNaW4sIHVpbnQgb2xkTWluLCBhZGRyZXNzIHNlbmRlcik7CgogICAgZnVuY3Rpb24gc2V0TWluU2xpcHBhZ2VGYWN0b3IodWludCBicHMpIHB1YmxpYyBvbmx5T3BlcmF0b3IgewogICAgICAgIE1pblNsaXBwYWdlRmFjdG9yU2V0KGJwcywgbWluU2xpcHBhZ2VGYWN0b3JJbkJwcywgbXNnLnNlbmRlcik7CiAgICAgICAgbWluU2xpcHBhZ2VGYWN0b3JJbkJwcyA9IGJwczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRFeHBlY3RlZFJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSkKICAgICAgICBwdWJsaWMgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQgZXhwZWN0ZWRSYXRlLCB1aW50IHNsaXBwYWdlUmF0ZSkKICAgIHsKICAgICAgICByZXF1aXJlKHF1YW50aXR5RmFjdG9yICE9IDApOwoKICAgICAgICB1aW50IGJlc3RSZXNlcnZlOwogICAgICAgIHVpbnQgbWluU2xpcHBhZ2U7CgogICAgICAgIChiZXN0UmVzZXJ2ZSwgZXhwZWN0ZWRSYXRlKSA9IGt5YmVyTmV0d29yay5maW5kQmVzdFJhdGUoc3JjLCBkZXN0LCBzcmNRdHkpOwogICAgICAgIChiZXN0UmVzZXJ2ZSwgc2xpcHBhZ2VSYXRlKSA9IGt5YmVyTmV0d29yay5maW5kQmVzdFJhdGUoc3JjLCBkZXN0LCAoc3JjUXR5ICogcXVhbnRpdHlGYWN0b3IpKTsKCiAgICAgICAgbWluU2xpcHBhZ2UgPSAoKDEwMDAwIC0gbWluU2xpcHBhZ2VGYWN0b3JJbkJwcykgKiBleHBlY3RlZFJhdGUpIC8gMTAwMDA7CiAgICAgICAgaWYgKHNsaXBwYWdlUmF0ZSA+PSBtaW5TbGlwcGFnZSkgewogICAgICAgICAgICBzbGlwcGFnZVJhdGUgPSBtaW5TbGlwcGFnZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAoZXhwZWN0ZWRSYXRlLCBzbGlwcGFnZVJhdGUpOwogICAgfQp9Cgpjb250cmFjdCBLeWJlck5ldHdvcmsgaXMgV2l0aGRyYXdhYmxlLCBVdGlscyB7CgogICAgdWludCBwdWJsaWMgbmVnbGlnaWJsZVJhdGVEaWZmID0gMTA7IC8vIGJhc2ljIHJhdGUgc3RlcHMgd2lsbCBiZSBpbiAwLjAxJQogICAgS3liZXJSZXNlcnZlSW50ZXJmYWNlW10gcHVibGljIHJlc2VydmVzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBwdWJsaWMgaXNSZXNlcnZlOwogICAgV2hpdGVMaXN0SW50ZXJmYWNlIHB1YmxpYyB3aGl0ZUxpc3RDb250cmFjdDsKICAgIEV4cGVjdGVkUmF0ZUludGVyZmFjZSBwdWJsaWMgZXhwZWN0ZWRSYXRlQ29udHJhY3Q7CiAgICBGZWVCdXJuZXJJbnRlcmZhY2UgICAgcHVibGljIGZlZUJ1cm5lckNvbnRyYWN0OwogICAgdWludCAgICAgICAgICAgICAgICAgIHB1YmxpYyBtYXhHYXNQcmljZSA9IDUwICogMTAwMCAqIDEwMDAgKiAxMDAwOyAvLyA1MCBnd2VpCiAgICBib29sICAgICAgICAgICAgICAgICAgcHVibGljIGVuYWJsZWQgPSBmYWxzZTsgLy8gbmV0d29yayBpcyBlbmFibGVkCiAgICBtYXBwaW5nKGFkZHJlc3M9Pm1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkpIHB1YmxpYyBwZXJSZXNlcnZlTGlzdGVkUGFpcnM7CgogICAgZnVuY3Rpb24gS3liZXJOZXR3b3JrKGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGFkbWluID0gX2FkbWluOwogICAgfQoKICAgIGV2ZW50IEV0aGVyUmVjZWl2YWwoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBhbW91bnQpOwoKICAgIC8qIHNvbGhpbnQtZGlzYWJsZSBuby1jb21wbGV4LWZhbGxiYWNrICovCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGlzUmVzZXJ2ZVttc2cuc2VuZGVyXSk7CiAgICAgICAgRXRoZXJSZWNlaXZhbChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQogICAgLyogc29saGludC1lbmFibGUgbm8tY29tcGxleC1mYWxsYmFjayAqLwoKICAgIGV2ZW50IEV4ZWN1dGVUcmFkZShhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCBFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgYWN0dWFsU3JjQW1vdW50LCB1aW50IGFjdHVhbERlc3RBbW91bnQpOwoKICAgIC8vLyBAbm90aWNlIHVzZSB0b2tlbiBhZGRyZXNzIEVUSF9UT0tFTl9BRERSRVNTIGZvciBldGhlcgogICAgLy8vIEBkZXYgbWFrZXMgYSB0cmFkZSBiZXR3ZWVuIHNyYyBhbmQgZGVzdCB0b2tlbiBhbmQgc2VuZCBkZXN0IHRva2VuIHRvIGRlc3RBZGRyZXNzCiAgICAvLy8gQHBhcmFtIHNyYyBTcmMgdG9rZW4KICAgIC8vLyBAcGFyYW0gc3JjQW1vdW50IGFtb3VudCBvZiBzcmMgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGRlc3QgICBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0QWRkcmVzcyBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgICAvLy8gQHBhcmFtIG1heERlc3RBbW91bnQgQSBsaW1pdCBvbiB0aGUgYW1vdW50IG9mIGRlc3QgdG9rZW5zCiAgICAvLy8gQHBhcmFtIG1pbkNvbnZlcnNpb25SYXRlIFRoZSBtaW5pbWFsIGNvbnZlcnNpb24gcmF0ZS4gSWYgYWN0dWFsIHJhdGUgaXMgbG93ZXIsIHRyYWRlIGlzIGNhbmNlbGVkLgogICAgLy8vIEBwYXJhbSB3YWxsZXRJZCBpcyB0aGUgd2FsbGV0IElEIHRvIHNlbmQgcGFydCBvZiB0aGUgZmVlcwogICAgLy8vIEByZXR1cm4gYW1vdW50IG9mIGFjdHVhbCBkZXN0IHRva2VucwogICAgZnVuY3Rpb24gdHJhZGUoCiAgICAgICAgRVJDMjAgc3JjLAogICAgICAgIHVpbnQgc3JjQW1vdW50LAogICAgICAgIEVSQzIwIGRlc3QsCiAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICB1aW50IG1heERlc3RBbW91bnQsCiAgICAgICAgdWludCBtaW5Db252ZXJzaW9uUmF0ZSwKICAgICAgICBhZGRyZXNzIHdhbGxldElkCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHJldHVybnModWludCkKICAgIHsKICAgICAgICByZXF1aXJlKGVuYWJsZWQpOwoKICAgICAgICB1aW50IHVzZXJTcmNCYWxhbmNlQmVmb3JlOwogICAgICAgIHVpbnQgdXNlclNyY0JhbGFuY2VBZnRlcjsKICAgICAgICB1aW50IHVzZXJEZXN0QmFsYW5jZUJlZm9yZTsKICAgICAgICB1aW50IHVzZXJEZXN0QmFsYW5jZUFmdGVyOwoKICAgICAgICB1c2VyU3JjQmFsYW5jZUJlZm9yZSA9IGdldEJhbGFuY2Uoc3JjLCBtc2cuc2VuZGVyKTsKICAgICAgICBpZiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKQogICAgICAgICAgICB1c2VyU3JjQmFsYW5jZUJlZm9yZSArPSBtc2cudmFsdWU7CiAgICAgICAgdXNlckRlc3RCYWxhbmNlQmVmb3JlID0gZ2V0QmFsYW5jZShkZXN0LCBkZXN0QWRkcmVzcyk7CgogICAgICAgIHVpbnQgYWN0dWFsRGVzdEFtb3VudCA9IGRvVHJhZGUoc3JjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4RGVzdEFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbkNvbnZlcnNpb25SYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FsbGV0SWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgcmVxdWlyZShhY3R1YWxEZXN0QW1vdW50ID4gMCk7CgogICAgICAgIHVzZXJTcmNCYWxhbmNlQWZ0ZXIgPSBnZXRCYWxhbmNlKHNyYywgbXNnLnNlbmRlcik7CiAgICAgICAgdXNlckRlc3RCYWxhbmNlQWZ0ZXIgPSBnZXRCYWxhbmNlKGRlc3QsIGRlc3RBZGRyZXNzKTsKCiAgICAgICAgcmVxdWlyZSh1c2VyU3JjQmFsYW5jZUFmdGVyIDw9IHVzZXJTcmNCYWxhbmNlQmVmb3JlKTsKICAgICAgICByZXF1aXJlKHVzZXJEZXN0QmFsYW5jZUFmdGVyID49IHVzZXJEZXN0QmFsYW5jZUJlZm9yZSk7CgogICAgICAgIHJlcXVpcmUoKHVzZXJEZXN0QmFsYW5jZUFmdGVyIC0gdXNlckRlc3RCYWxhbmNlQmVmb3JlKSA+PQogICAgICAgICAgICBjYWxjRHN0UXR5KCh1c2VyU3JjQmFsYW5jZUJlZm9yZSAtIHVzZXJTcmNCYWxhbmNlQWZ0ZXIpLCBnZXREZWNpbWFscyhzcmMpLCBnZXREZWNpbWFscyhkZXN0KSwKICAgICAgICAgICAgICAgIG1pbkNvbnZlcnNpb25SYXRlKSk7CgogICAgICAgIHJldHVybiBhY3R1YWxEZXN0QW1vdW50OwogICAgfQoKICAgIGV2ZW50IEFkZFJlc2VydmVUb05ldHdvcmsoS3liZXJSZXNlcnZlSW50ZXJmYWNlIHJlc2VydmUsIGJvb2wgYWRkKTsKCiAgICAvLy8gQG5vdGljZSBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYWRtaW4KICAgIC8vLyBAZGV2IGFkZCBvciBkZWxldGVzIGEgcmVzZXJ2ZSB0by9mcm9tIHRoZSBuZXR3b3JrLgogICAgLy8vIEBwYXJhbSByZXNlcnZlIFRoZSByZXNlcnZlIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIGFkZCBJZiB0cnVlLCB0aGUgYWRkIHJlc2VydmUuIE90aGVyd2lzZSBkZWxldGUgcmVzZXJ2ZS4KICAgIGZ1bmN0aW9uIGFkZFJlc2VydmUoS3liZXJSZXNlcnZlSW50ZXJmYWNlIHJlc2VydmUsIGJvb2wgYWRkKSBwdWJsaWMgb25seUFkbWluIHsKCiAgICAgICAgaWYgKGFkZCkgewogICAgICAgICAgICByZXF1aXJlKCFpc1Jlc2VydmVbcmVzZXJ2ZV0pOwogICAgICAgICAgICByZXNlcnZlcy5wdXNoKHJlc2VydmUpOwogICAgICAgICAgICBpc1Jlc2VydmVbcmVzZXJ2ZV0gPSB0cnVlOwogICAgICAgICAgICBBZGRSZXNlcnZlVG9OZXR3b3JrKHJlc2VydmUsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlzUmVzZXJ2ZVtyZXNlcnZlXSA9IGZhbHNlOwogICAgICAgICAgICAvLyB3aWxsIGhhdmUgdHJvdWJsZSBpZiBtb3JlIHRoYW4gNTBrIHJlc2VydmVzLi4uCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJlc2VydmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzZXJ2ZXNbaV0gPT0gcmVzZXJ2ZSkgewogICAgICAgICAgICAgICAgICAgIHJlc2VydmVzW2ldID0gcmVzZXJ2ZXNbcmVzZXJ2ZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZXMubGVuZ3RoLS07CiAgICAgICAgICAgICAgICAgICAgQWRkUmVzZXJ2ZVRvTmV0d29yayhyZXNlcnZlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgTGlzdFJlc2VydmVQYWlycyhhZGRyZXNzIHJlc2VydmUsIEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgYm9vbCBhZGQpOwoKICAgIC8vLyBAbm90aWNlIGNhbiBiZSBjYWxsZWQgb25seSBieSBhZG1pbgogICAgLy8vIEBkZXYgYWxsb3cgb3IgcHJldmVudCBhIHNwZWNpZmljIHJlc2VydmUgdG8gdHJhZGUgYSBwYWlyIG9mIHRva2VucwogICAgLy8vIEBwYXJhbSByZXNlcnZlIFRoZSByZXNlcnZlIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHNyYyBTcmMgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdCBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBhZGQgSWYgdHJ1ZSB0aGVuIGVuYWJsZSB0cmFkZSwgb3RoZXJ3aXNlIGRlbGlzdCBwYWlyLgogICAgZnVuY3Rpb24gbGlzdFBhaXJGb3JSZXNlcnZlKGFkZHJlc3MgcmVzZXJ2ZSwgRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCBib29sIGFkZCkgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgKHBlclJlc2VydmVMaXN0ZWRQYWlyc1tyZXNlcnZlXSlba2VjY2FrMjU2KHNyYywgZGVzdCldID0gYWRkOwoKICAgICAgICBpZiAoc3JjICE9IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGlmIChhZGQpIHsKICAgICAgICAgICAgICAgIHNyYy5hcHByb3ZlKHJlc2VydmUsIDIqKjI1NSk7IC8vIGFwcHJvdmUgaW5maW5pdHkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNyYy5hcHByb3ZlKHJlc2VydmUsIDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZXREZWNpbWFscyhzcmMpOwogICAgICAgIHNldERlY2ltYWxzKGRlc3QpOwoKICAgICAgICBMaXN0UmVzZXJ2ZVBhaXJzKHJlc2VydmUsIHNyYywgZGVzdCwgYWRkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQYXJhbXMoCiAgICAgICAgV2hpdGVMaXN0SW50ZXJmYWNlICAgIF93aGl0ZUxpc3QsCiAgICAgICAgRXhwZWN0ZWRSYXRlSW50ZXJmYWNlIF9leHBlY3RlZFJhdGUsCiAgICAgICAgRmVlQnVybmVySW50ZXJmYWNlICAgIF9mZWVCdXJuZXIsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICAgIF9tYXhHYXNQcmljZSwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgICAgX25lZ2xpZ2libGVSYXRlRGlmZgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlBZG1pbgogICAgewogICAgICAgIHJlcXVpcmUoX3doaXRlTGlzdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9mZWVCdXJuZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfZXhwZWN0ZWRSYXRlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHdoaXRlTGlzdENvbnRyYWN0ID0gX3doaXRlTGlzdDsKICAgICAgICBleHBlY3RlZFJhdGVDb250cmFjdCA9IF9leHBlY3RlZFJhdGU7CiAgICAgICAgZmVlQnVybmVyQ29udHJhY3QgPSBfZmVlQnVybmVyOwogICAgICAgIG1heEdhc1ByaWNlID0gX21heEdhc1ByaWNlOwogICAgICAgIG5lZ2xpZ2libGVSYXRlRGlmZiA9IF9uZWdsaWdpYmxlUmF0ZURpZmY7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0RW5hYmxlKGJvb2wgX2VuYWJsZSkgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgaWYgKF9lbmFibGUpIHsKICAgICAgICAgICAgcmVxdWlyZSh3aGl0ZUxpc3RDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgcmVxdWlyZShmZWVCdXJuZXJDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgcmVxdWlyZShleHBlY3RlZFJhdGVDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICB9CiAgICAgICAgZW5hYmxlZCA9IF9lbmFibGU7CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJucyBudW1iZXIgb2YgcmVzZXJ2ZXMKICAgIC8vLyBAcmV0dXJuIG51bWJlciBvZiByZXNlcnZlcwogICAgZnVuY3Rpb24gZ2V0TnVtUmVzZXJ2ZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gcmVzZXJ2ZXMubGVuZ3RoOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHNob3VsZCBiZSBjYWxsZWQgb2ZmIGNoYWluIHdpdGggYXMgbXVjaCBnYXMgYXMgbmVlZGVkCiAgICAvLy8gQGRldiBnZXQgYW4gYXJyYXkgb2YgYWxsIHJlc2VydmVzCiAgICAvLy8gQHJldHVybiBBbiBhcnJheSBvZiBhbGwgcmVzZXJ2ZXMKICAgIGZ1bmN0aW9uIGdldFJlc2VydmVzKCkgcHVibGljIHZpZXcgcmV0dXJucyhLeWJlclJlc2VydmVJbnRlcmZhY2VbXSkgewogICAgICAgIHJldHVybiByZXNlcnZlczsKICAgIH0KCiAgICAvLy8gQGRldiBnZXQgdGhlIGJhbGFuY2Ugb2YgYSB1c2VyLgogICAgLy8vIEBwYXJhbSB0b2tlbiBUaGUgdG9rZW4gdHlwZQogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoRVJDMjAgdG9rZW4sIGFkZHJlc3MgdXNlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKQogICAgICAgICAgICByZXR1cm4gdXNlci5iYWxhbmNlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRva2VuLmJhbGFuY2VPZih1c2VyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IGJlc3QgY29udmVyc2lvbiByYXRlIGZvciBhIHBhaXIgb2YgdG9rZW5zLCBpZiBudW1iZXIgb2YgcmVzZXJ2ZXMgaGF2ZSBzbWFsbCBkaWZmZXJlbmNlcy4gcmFuZG9taXplCiAgICAvLy8gQHBhcmFtIHNyYyBTcmMgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdCBEZXN0aW5hdGlvbiB0b2tlbgogICAgLyogc29saGludC1kaXNhYmxlIGNvZGUtY29tcGxleGl0eSAqLwogICAgZnVuY3Rpb24gZmluZEJlc3RSYXRlKEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBzcmNRdHkpIHB1YmxpYyB2aWV3IHJldHVybnModWludCwgdWludCkgewogICAgICAgIHVpbnQgYmVzdFJhdGUgPSAwOwogICAgICAgIHVpbnQgYmVzdFJlc2VydmUgPSAwOwogICAgICAgIHVpbnQgbnVtUmVsZXZhbnRSZXNlcnZlcyA9IDA7CiAgICAgICAgdWludCBudW1SZXNlcnZlcyA9IHJlc2VydmVzLmxlbmd0aDsKICAgICAgICB1aW50W10gbWVtb3J5IHJhdGVzID0gbmV3IHVpbnRbXShudW1SZXNlcnZlcyk7CiAgICAgICAgdWludFtdIG1lbW9yeSByZXNlcnZlQ2FuZGlkYXRlcyA9IG5ldyB1aW50W10obnVtUmVzZXJ2ZXMpOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBudW1SZXNlcnZlczsgaSsrKSB7CiAgICAgICAgICAgIC8vbGlzdCBhbGwgcmVzZXJ2ZXMgdGhhdCBoYXZlIHRoaXMgdG9rZW4uCiAgICAgICAgICAgIGlmICghKHBlclJlc2VydmVMaXN0ZWRQYWlyc1tyZXNlcnZlc1tpXV0pW2tlY2NhazI1NihzcmMsIGRlc3QpXSkgY29udGludWU7CgogICAgICAgICAgICByYXRlc1tpXSA9IHJlc2VydmVzW2ldLmdldENvbnZlcnNpb25SYXRlKHNyYywgZGVzdCwgc3JjUXR5LCBibG9jay5udW1iZXIpOwoKICAgICAgICAgICAgaWYgKHJhdGVzW2ldID4gYmVzdFJhdGUpIHsKICAgICAgICAgICAgICAgIC8vYmVzdCByYXRlIGlzIGhpZ2hlc3QgcmF0ZQogICAgICAgICAgICAgICAgYmVzdFJhdGUgPSByYXRlc1tpXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGJlc3RSYXRlID4gMCkgewogICAgICAgICAgICB1aW50IHJhbmRvbSA9IDA7CiAgICAgICAgICAgIHVpbnQgc21hbGxlc3RSZWxldmFudFJhdGUgPSAoYmVzdFJhdGUgKiAxMDAwMCkgLyAoMTAwMDAgKyBuZWdsaWdpYmxlUmF0ZURpZmYpOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bVJlc2VydmVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChyYXRlc1tpXSA+PSBzbWFsbGVzdFJlbGV2YW50UmF0ZSkgewogICAgICAgICAgICAgICAgICAgIHJlc2VydmVDYW5kaWRhdGVzW251bVJlbGV2YW50UmVzZXJ2ZXMrK10gPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobnVtUmVsZXZhbnRSZXNlcnZlcyA+IDEpIHsKICAgICAgICAgICAgICAgIC8vd2hlbiBlbmNvdW50ZXJpbmcgc21hbGwgcmF0ZSBkaWZmIGZyb20gYmVzdFJhdGUuIGRyYXcgZnJvbSByZWxldmFudCByZXNlcnZlcwogICAgICAgICAgICAgICAgcmFuZG9tID0gdWludChibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSAlIG51bVJlbGV2YW50UmVzZXJ2ZXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJlc3RSZXNlcnZlID0gcmVzZXJ2ZUNhbmRpZGF0ZXNbcmFuZG9tXTsKICAgICAgICAgICAgYmVzdFJhdGUgPSByYXRlc1tiZXN0UmVzZXJ2ZV07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKGJlc3RSZXNlcnZlLCBiZXN0UmF0ZSk7CiAgICB9CiAgICAvKiBzb2xoaW50LWVuYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KCiAgICBmdW5jdGlvbiBnZXRFeHBlY3RlZFJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSkKICAgICAgICBwdWJsaWMgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQgZXhwZWN0ZWRSYXRlLCB1aW50IHNsaXBwYWdlUmF0ZSkKICAgIHsKICAgICAgICByZXF1aXJlKGV4cGVjdGVkUmF0ZUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJldHVybiBleHBlY3RlZFJhdGVDb250cmFjdC5nZXRFeHBlY3RlZFJhdGUoc3JjLCBkZXN0LCBzcmNRdHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFVzZXJDYXBJbldlaShhZGRyZXNzIHVzZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiB3aGl0ZUxpc3RDb250cmFjdC5nZXRVc2VyQ2FwSW5XZWkodXNlcik7CiAgICB9CgogICAgZnVuY3Rpb24gZG9UcmFkZSgKICAgICAgICBFUkMyMCBzcmMsCiAgICAgICAgdWludCBzcmNBbW91bnQsCiAgICAgICAgRVJDMjAgZGVzdCwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzLAogICAgICAgIHVpbnQgbWF4RGVzdEFtb3VudCwKICAgICAgICB1aW50IG1pbkNvbnZlcnNpb25SYXRlLAogICAgICAgIGFkZHJlc3Mgd2FsbGV0SWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnModWludCkKICAgIHsKICAgICAgICByZXF1aXJlKHR4Lmdhc3ByaWNlIDw9IG1heEdhc1ByaWNlKTsKICAgICAgICByZXF1aXJlKHZhbGlkYXRlVHJhZGVJbnB1dChzcmMsIHNyY0Ftb3VudCwgZGVzdEFkZHJlc3MpKTsKCiAgICAgICAgdWludCByZXNlcnZlSW5kOwogICAgICAgIHVpbnQgcmF0ZTsKCiAgICAgICAgKHJlc2VydmVJbmQsIHJhdGUpID0gZmluZEJlc3RSYXRlKHNyYywgZGVzdCwgc3JjQW1vdW50KTsKICAgICAgICBLeWJlclJlc2VydmVJbnRlcmZhY2UgdGhlUmVzZXJ2ZSA9IHJlc2VydmVzW3Jlc2VydmVJbmRdOwogICAgICAgIHJlcXVpcmUocmF0ZSA+IDApOwogICAgICAgIHJlcXVpcmUocmF0ZSA8IE1BWF9SQVRFKTsKICAgICAgICByZXF1aXJlKHJhdGUgPj0gbWluQ29udmVyc2lvblJhdGUpOwoKICAgICAgICB1aW50IGFjdHVhbFNyY0Ftb3VudCA9IHNyY0Ftb3VudDsKICAgICAgICB1aW50IGFjdHVhbERlc3RBbW91bnQgPSBjYWxjRGVzdEFtb3VudChzcmMsIGRlc3QsIGFjdHVhbFNyY0Ftb3VudCwgcmF0ZSk7CiAgICAgICAgaWYgKGFjdHVhbERlc3RBbW91bnQgPiBtYXhEZXN0QW1vdW50KSB7CiAgICAgICAgICAgIGFjdHVhbERlc3RBbW91bnQgPSBtYXhEZXN0QW1vdW50OwogICAgICAgICAgICBhY3R1YWxTcmNBbW91bnQgPSBjYWxjU3JjQW1vdW50KHNyYywgZGVzdCwgYWN0dWFsRGVzdEFtb3VudCwgcmF0ZSk7CiAgICAgICAgICAgIHJlcXVpcmUoYWN0dWFsU3JjQW1vdW50IDw9IHNyY0Ftb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkbyB0aGUgdHJhZGUKICAgICAgICAvLyB2ZXJpZnkgdHJhZGUgc2l6ZSBpcyBzbWFsbGVyIHRoYW4gdXNlciBjYXAKICAgICAgICB1aW50IGV0aEFtb3VudDsKICAgICAgICBpZiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGV0aEFtb3VudCA9IGFjdHVhbFNyY0Ftb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBldGhBbW91bnQgPSBhY3R1YWxEZXN0QW1vdW50OwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShldGhBbW91bnQgPD0gZ2V0VXNlckNhcEluV2VpKG1zZy5zZW5kZXIpKTsKICAgICAgICByZXF1aXJlKGRvUmVzZXJ2ZVRyYWRlKAogICAgICAgICAgICAgICAgc3JjLAogICAgICAgICAgICAgICAgYWN0dWFsU3JjQW1vdW50LAogICAgICAgICAgICAgICAgZGVzdCwKICAgICAgICAgICAgICAgIGRlc3RBZGRyZXNzLAogICAgICAgICAgICAgICAgYWN0dWFsRGVzdEFtb3VudCwKICAgICAgICAgICAgICAgIHRoZVJlc2VydmUsCiAgICAgICAgICAgICAgICByYXRlLAogICAgICAgICAgICAgICAgdHJ1ZSkpOwoKICAgICAgICBpZiAoKGFjdHVhbFNyY0Ftb3VudCA8IHNyY0Ftb3VudCkgJiYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykpIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihzcmNBbW91bnQgLSBhY3R1YWxTcmNBbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShmZWVCdXJuZXJDb250cmFjdC5oYW5kbGVGZWVzKGV0aEFtb3VudCwgdGhlUmVzZXJ2ZSwgd2FsbGV0SWQpKTsKCiAgICAgICAgRXhlY3V0ZVRyYWRlKG1zZy5zZW5kZXIsIHNyYywgZGVzdCwgYWN0dWFsU3JjQW1vdW50LCBhY3R1YWxEZXN0QW1vdW50KTsKICAgICAgICByZXR1cm4gYWN0dWFsRGVzdEFtb3VudDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IGRvIG9uZSB0cmFkZSB3aXRoIGEgcmVzZXJ2ZQogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBhbW91bnQgb2Ygc3JjIHRva2VucwogICAgLy8vIEBwYXJhbSBkZXN0ICAgRGVzdGluYXRpb24gdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdEFkZHJlc3MgQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogICAgLy8vIEBwYXJhbSByZXNlcnZlIFJlc2VydmUgdG8gdXNlCiAgICAvLy8gQHBhcmFtIHZhbGlkYXRlIElmIHRydWUsIGFkZGl0aW9uYWwgdmFsaWRhdGlvbnMgYXJlIGFwcGxpY2FibGUKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgdHJhZGUgaXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gZG9SZXNlcnZlVHJhZGUoCiAgICAgICAgRVJDMjAgc3JjLAogICAgICAgIHVpbnQgYW1vdW50LAogICAgICAgIEVSQzIwIGRlc3QsCiAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICB1aW50IGV4cGVjdGVkRGVzdEFtb3VudCwKICAgICAgICBLeWJlclJlc2VydmVJbnRlcmZhY2UgcmVzZXJ2ZSwKICAgICAgICB1aW50IGNvbnZlcnNpb25SYXRlLAogICAgICAgIGJvb2wgdmFsaWRhdGUKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICB1aW50IGNhbGxWYWx1ZSA9IDA7CgogICAgICAgIGlmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgY2FsbFZhbHVlID0gYW1vdW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHRha2Ugc3JjIHRva2VucyB0byB0aGlzIGNvbnRyYWN0CiAgICAgICAgICAgIHNyYy50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgYW1vdW50KTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc2VydmUgc2VuZHMgdG9rZW5zL2V0aCB0byBuZXR3b3JrLiBuZXR3b3JrIHNlbmRzIGl0IHRvIGRlc3RpbmF0aW9uCiAgICAgICAgcmVxdWlyZShyZXNlcnZlLnRyYWRlLnZhbHVlKGNhbGxWYWx1ZSkoc3JjLCBhbW91bnQsIGRlc3QsIHRoaXMsIGNvbnZlcnNpb25SYXRlLCB2YWxpZGF0ZSkpOwoKICAgICAgICBpZiAoZGVzdCA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBkZXN0QWRkcmVzcy50cmFuc2ZlcihleHBlY3RlZERlc3RBbW91bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoZGVzdC50cmFuc2ZlcihkZXN0QWRkcmVzcywgZXhwZWN0ZWREZXN0QW1vdW50KSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjRGVzdEFtb3VudChFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjQW1vdW50LCB1aW50IHJhdGUpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGNhbGNEc3RRdHkoc3JjQW1vdW50LCBnZXREZWNpbWFscyhzcmMpLCBnZXREZWNpbWFscyhkZXN0KSwgcmF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY1NyY0Ftb3VudChFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgZGVzdEFtb3VudCwgdWludCByYXRlKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBjYWxjU3JjUXR5KGRlc3RBbW91bnQsIGdldERlY2ltYWxzKHNyYyksIGdldERlY2ltYWxzKGRlc3QpLCByYXRlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IGNoZWNrcyB0aGF0IHVzZXIgc2VudCBldGhlci90b2tlbnMgdG8gY29udHJhY3QgYmVmb3JlIHRyYWRlCiAgICAvLy8gQHBhcmFtIHNyYyBTcmMgdG9rZW4KICAgIC8vLyBAcGFyYW0gc3JjQW1vdW50IGFtb3VudCBvZiBzcmMgdG9rZW5zCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGlucHV0IGlzIHZhbGlkCiAgICBmdW5jdGlvbiB2YWxpZGF0ZVRyYWRlSW5wdXQoRVJDMjAgc3JjLCB1aW50IHNyY0Ftb3VudCwgYWRkcmVzcyBkZXN0QWRkcmVzcykgaW50ZXJuYWwgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoKHNyY0Ftb3VudCA+PSBNQVhfUVRZKSB8fCAoc3JjQW1vdW50ID09IDApIHx8IChkZXN0QWRkcmVzcyA9PSAwKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGlmIChtc2cudmFsdWUgIT0gc3JjQW1vdW50KQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICgobXNnLnZhbHVlICE9IDApIHx8IChzcmMuYWxsb3dhbmNlKG1zZy5zZW5kZXIsIHRoaXMpIDwgc3JjQW1vdW50KSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9'.
	

]
