Class {
	#name : #SRTe8bbf054b788c98d9993be5513254d6b64a1ba97,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe8bbf054b788c98d9993be5513254d6b64a1ba97 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgICogYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cgp9CgoKCgoKCgoKY29udHJhY3QgQmVuZWZpY2lhcnkgaXMgT3duYWJsZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CgogICAgZnVuY3Rpb24gQmVuZWZpY2lhcnkoKSBwdWJsaWMgewogICAgICAgIGJlbmVmaWNpYXJ5ID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCZW5lZmljaWFyeShhZGRyZXNzIF9iZW5lZmljaWFyeSkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICB9CgoKfQoKCgpjb250cmFjdCBDaGVzdHNTdG9yZSBpcyBCZW5lZmljaWFyeSB7CgoKICAgIHN0cnVjdCBjaGVzdFByb2R1Y3QgewogICAgICAgIHVpbnQyNTYgcHJpY2U7IC8vIFByaWNlIGluIHdlaQogICAgICAgIGJvb2wgaXNMaW1pdGVkOyAvLyBpcyBsaW1pdGVkIHNhbGUgY2hlc3QKICAgICAgICB1aW50MzIgbGltaXQ7IC8vIFNlbGwgbGltaXQKICAgICAgICB1aW50MTYgYm9vc3RlcnM7IC8vIGNvdW50IG9mIGJvb3N0ZXJzCiAgICAgICAgdWludDI0IHJhaXNlQ2hhbmNlOy8vIGluIDEvMTAgb2YgcGVyY2VudAogICAgICAgIHVpbnQyNCByYWlzZVN0cmVuZ3RoOy8vIGluIDEvMTAgb2YgcGVyY2VudCBmb3IgcGFyYW1zIG9yIG1pbnV0ZXMgZm9yIHRpbWViYXNlZCBib29zdGVycwogICAgICAgIHVpbnQ4IG9ubHlCb29zdGVyVHlwZTsvL0lmIHNldCBjaGVzdCB3aWxsIHByb2R1Y2Ugb25seSB0aGlzIHR5cGUKICAgICAgICB1aW50OCBvbmx5Qm9vc3RlclN0cmVuZ3RoOwogICAgfQoKCiAgICBjaGVzdFByb2R1Y3RbMjU1XSBwdWJsaWMgY2hlc3RQcm9kdWN0czsKICAgIEZpc2hiYW5rQ2hlc3RzIGNoZXN0czsKCgogICAgZnVuY3Rpb24gQ2hlc3RzU3RvcmUoYWRkcmVzcyBfY2hlc3RzKSBwdWJsaWMgewogICAgICAgIGNoZXN0cyA9IEZpc2hiYW5rQ2hlc3RzKF9jaGVzdHMpOwogICAgICAgIC8vc2V0IGNoZXN0cyB0byB0aGlzIGFkZHJlc3MKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0Q2hlc3RzU3RvcmUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICAvLyBDcmVhdGUgYmFzaWMgY2hlc3RzIHR5cGVzCiAgICAgICAgc2V0Q2hlc3RQcm9kdWN0KDEsIDAsIDEsIGZhbHNlLCAwLCAwLCAwLCAwLCAwKTsKICAgICAgICBzZXRDaGVzdFByb2R1Y3QoMiwgMTUgZmlubmV5LCAzLCBmYWxzZSwgMCwgMCwgMCwgMCwgMCk7CiAgICAgICAgc2V0Q2hlc3RQcm9kdWN0KDMsIDIwIGZpbm5leSwgNSwgZmFsc2UsIDAsIDAsIDAsIDAsIDApOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENoZXN0UHJvZHVjdCh1aW50MTYgY2hlc3RJZCwgdWludDI1NiBwcmljZSwgdWludDE2IGJvb3N0ZXJzLCBib29sIGlzTGltaXRlZCwgdWludDMyIGxpbWl0LCB1aW50MjQgcmFpc2VDaGFuY2UsIHVpbnQyNCByYWlzZVN0cmVuZ3RoLCB1aW50OCBvbmx5Qm9vc3RlclR5cGUsIHVpbnQ4IG9ubHlCb29zdGVyU3RyZW5ndGgpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGNoZXN0UHJvZHVjdCBzdG9yYWdlIG5ld1Byb2R1Y3QgPSBjaGVzdFByb2R1Y3RzW2NoZXN0SWRdOwogICAgICAgIG5ld1Byb2R1Y3QucHJpY2UgPSBwcmljZTsKICAgICAgICBuZXdQcm9kdWN0LmJvb3N0ZXJzID0gYm9vc3RlcnM7CiAgICAgICAgbmV3UHJvZHVjdC5pc0xpbWl0ZWQgPSBpc0xpbWl0ZWQ7CiAgICAgICAgbmV3UHJvZHVjdC5saW1pdCA9IGxpbWl0OwogICAgICAgIG5ld1Byb2R1Y3QucmFpc2VDaGFuY2UgPSByYWlzZUNoYW5jZTsKICAgICAgICBuZXdQcm9kdWN0LnJhaXNlU3RyZW5ndGggPSByYWlzZVN0cmVuZ3RoOwogICAgICAgIG5ld1Byb2R1Y3Qub25seUJvb3N0ZXJUeXBlID0gb25seUJvb3N0ZXJUeXBlOwogICAgICAgIG5ld1Byb2R1Y3Qub25seUJvb3N0ZXJTdHJlbmd0aCA9IG9ubHlCb29zdGVyU3RyZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q2hlc3RQcmljZSh1aW50MTYgY2hlc3RJZCwgdWludDI1NiBwcmljZSkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgY2hlc3RQcm9kdWN0c1tjaGVzdElkXS5wcmljZSA9IHByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eUNoZXN0KHVpbnQxNiBfY2hlc3RJZCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIGNoZXN0UHJvZHVjdCBtZW1vcnkgdG1wQ2hlc3RQcm9kdWN0ID0gY2hlc3RQcm9kdWN0c1tfY2hlc3RJZF07CgogICAgICAgIHJlcXVpcmUodG1wQ2hlc3RQcm9kdWN0LnByaWNlID4gMCk7CiAgICAgICAgLy8gb25seSBjaGVzdHMgd2l0aCBwcmljZQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHRtcENoZXN0UHJvZHVjdC5wcmljZSk7CiAgICAgICAgLy9jaGVjayBpZiBlbm91Z2ggZXRoZXIgaXMgc2VuZAogICAgICAgIHJlcXVpcmUoIXRtcENoZXN0UHJvZHVjdC5pc0xpbWl0ZWQgfHwgdG1wQ2hlc3RQcm9kdWN0LmxpbWl0ID4gMCk7CiAgICAgICAgLy9jaGVjayBsaW1pdHMgaWYgdGhleSBleGlzdHMKCiAgICAgICAgY2hlc3RzLm1pbnRDaGVzdChtc2cuc2VuZGVyLCB0bXBDaGVzdFByb2R1Y3QuYm9vc3RlcnMsIHRtcENoZXN0UHJvZHVjdC5yYWlzZVN0cmVuZ3RoLCB0bXBDaGVzdFByb2R1Y3QucmFpc2VDaGFuY2UsIHRtcENoZXN0UHJvZHVjdC5vbmx5Qm9vc3RlclR5cGUsIHRtcENoZXN0UHJvZHVjdC5vbmx5Qm9vc3RlclN0cmVuZ3RoKTsKCiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IGNoZXN0UHJvZHVjdHNbX2NoZXN0SWRdLnByaWNlKSB7Ly9zZW5kIHRvIG11Y2ggZXRoZXIgc2VuZCBzb21lIGJhY2sKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUgLSBjaGVzdFByb2R1Y3RzW19jaGVzdElkXS5wcmljZSk7CiAgICAgICAgfQoKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2ZlcihjaGVzdFByb2R1Y3RzW19jaGVzdElkXS5wcmljZSk7CiAgICAgICAgLy9zZW5kIHBhaWQgZXRoIHRvIGJlbmVmaWNpYXJ5CgogICAgfQoKCn0KCgoKCgpjb250cmFjdCBGaXNoYmFua0Jvb3N0ZXJzIGlzIE93bmFibGUgewoKICAgIHN0cnVjdCBCb29zdGVyIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIHVpbnQzMiBkdXJhdGlvbjsKICAgICAgICB1aW50OCBib29zdGVyVHlwZTsKICAgICAgICB1aW50MjQgcmFpc2VWYWx1ZTsKICAgICAgICB1aW50OCBzdHJlbmd0aDsKICAgICAgICB1aW50MzIgYW1vdW50OwogICAgfQoKICAgIEJvb3N0ZXJbXSBwdWJsaWMgYm9vc3RlcnM7CiAgICBib29sIHB1YmxpYyBpbXBsZW1lbnRzRVJDNzIxID0gdHJ1ZTsKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJGaXNoYmFuayBCb29zdGVycyI7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJGSVNIQiI7CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGFwcHJvdmVkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsKICAgIGFkZHJlc3MgcHVibGljIGZpc2hiYW5rOwogICAgYWRkcmVzcyBwdWJsaWMgY2hlc3RzOwogICAgYWRkcmVzcyBwdWJsaWMgYXVjdGlvbjsKCiAgICBtb2RpZmllciBvbmx5Qm9vc3Rlck93bmVyKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICByZXF1aXJlKGJvb3N0ZXJzW190b2tlbklkXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDaGVzdCgpIHsKICAgICAgICByZXF1aXJlKGNoZXN0cyA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEZpc2hiYW5rQm9vc3RlcnMoKSBwdWJsaWMgewogICAgICAgIC8vbm90aGluZyB5ZXQKICAgIH0KCiAgICAvL21pbnRzIHRoZSBib29zdGVycyBjYW4gb25seSBiZSBjYWxsZWQgYnkgb3duZXIuIGNvdWxkIGJlIGEgc21hcnQgY29udHJhY3QKICAgIGZ1bmN0aW9uIG1pbnRCb29zdGVyKGFkZHJlc3MgX293bmVyLCB1aW50MzIgX2R1cmF0aW9uLCB1aW50OCBfdHlwZSwgdWludDggX3N0cmVuZ3RoLCB1aW50MzIgX2Ftb3VudCwgdWludDI0IF9yYWlzZVZhbHVlKSBvbmx5Q2hlc3QgcHVibGljIHsKICAgICAgICBib29zdGVycy5sZW5ndGggKys7CgogICAgICAgIEJvb3N0ZXIgc3RvcmFnZSB0ZW1wQm9vc3RlciA9IGJvb3N0ZXJzW2Jvb3N0ZXJzLmxlbmd0aCAtIDFdOwoKICAgICAgICB0ZW1wQm9vc3Rlci5vd25lciA9IF9vd25lcjsKICAgICAgICB0ZW1wQm9vc3Rlci5kdXJhdGlvbiA9IF9kdXJhdGlvbjsKICAgICAgICB0ZW1wQm9vc3Rlci5ib29zdGVyVHlwZSA9IF90eXBlOwogICAgICAgIHRlbXBCb29zdGVyLnN0cmVuZ3RoID0gX3N0cmVuZ3RoOwogICAgICAgIHRlbXBCb29zdGVyLmFtb3VudCA9IF9hbW91bnQ7CiAgICAgICAgdGVtcEJvb3N0ZXIucmFpc2VWYWx1ZSA9IF9yYWlzZVZhbHVlOwoKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfb3duZXIsIGJvb3N0ZXJzLmxlbmd0aCAtIDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEZpc2hiYW5rKGFkZHJlc3MgX2Zpc2hiYW5rKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBmaXNoYmFuayA9IF9maXNoYmFuazsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDaGVzdHMoYWRkcmVzcyBfY2hlc3RzKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAoY2hlc3RzICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIGNoZXN0cyA9IF9jaGVzdHM7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QXVjdGlvbihhZGRyZXNzIF9hdWN0aW9uKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBhdWN0aW9uID0gX2F1Y3Rpb247CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Qm9vc3RlclR5cGUodWludDI1NiBfdG9rZW5JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDggYm9vc3RlclR5cGUpIHsKICAgICAgICBib29zdGVyVHlwZSA9IGJvb3N0ZXJzW190b2tlbklkXS5ib29zdGVyVHlwZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb29zdGVyQW1vdW50KHVpbnQyNTYgX3Rva2VuSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQzMiBib29zdGVyQW1vdW50KSB7CiAgICAgICAgYm9vc3RlckFtb3VudCA9IGJvb3N0ZXJzW190b2tlbklkXS5hbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Qm9vc3RlckR1cmF0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIGlmIChib29zdGVyc1tfdG9rZW5JZF0uYm9vc3RlclR5cGUgPT0gNCB8fCBib29zdGVyc1tfdG9rZW5JZF0uYm9vc3RlclR5cGUgPT0gMikgewogICAgICAgICAgICByZXR1cm4gYm9vc3RlcnNbX3Rva2VuSWRdLmR1cmF0aW9uICsgYm9vc3RlcnNbX3Rva2VuSWRdLnJhaXNlVmFsdWUgKiA2MDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJvb3N0ZXJzW190b2tlbklkXS5kdXJhdGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb29zdGVyU3RyZW5ndGgodWludDI1NiBfdG9rZW5JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDggc3RyZW5ndGgpIHsKICAgICAgICBzdHJlbmd0aCA9IGJvb3N0ZXJzW190b2tlbklkXS5zdHJlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb29zdGVyUmFpc2VWYWx1ZSh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjQgcmFpc2VWYWx1ZSkgewogICAgICAgIHJhaXNlVmFsdWUgPSBib29zdGVyc1tfdG9rZW5JZF0ucmFpc2VWYWx1ZTsKICAgIH0KCiAgICAvL0VSQzcyMSBmdW5jdGlvbmFsaXR5CiAgICAvL2NvdWxkIHNwbGl0IHRoaXMgdG8gYSBkaWZmZXJlbnQgY29udHJhY3QgYnV0IGRvZXNuJ3QgbWFrZSBpdCBlYXNpZXIgdG8gcmVhZAogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpIHsKICAgICAgICB0b3RhbCA9IGJvb3N0ZXJzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSl7CiAgICAgICAgYmFsYW5jZSA9IGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKXsKICAgICAgICBvd25lciA9IGJvb3N0ZXJzW190b2tlbklkXS5vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKGJvb3N0ZXJzW190b2tlbklkXS5vd25lciA9PSBfZnJvbSk7CiAgICAgICAgLy9jYW4gb25seSB0cmFuc2ZlciBpZiBwcmV2aW91cyBvd25lciBlcXVhbHMgZnJvbQogICAgICAgIGJvb3N0ZXJzW190b2tlbklkXS5vd25lciA9IF90bzsKICAgICAgICBhcHByb3ZlZFtfdG9rZW5JZF0gPSBhZGRyZXNzKDApOwogICAgICAgIC8vcmVzZXQgYXBwcm92ZWQgb2YgZmlzaCBvbiBldmVyeSB0cmFuc2ZlcgogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSAxOwogICAgICAgIC8vdW5kZXJmbG93IGNhbiBvbmx5IGhhcHBlbiBvbiAweAogICAgICAgIGJhbGFuY2VzW190b10gKz0gMTsKICAgICAgICAvL292ZXJmbG93cyBvbmx5IHdpdGggdmVyeSB2ZXJ5IGxhcmdlIGFtb3VudHMgb2YgZmlzaAogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljCiAgICBvbmx5Qm9vc3Rlck93bmVyKF90b2tlbklkKSAvL2NoZWNrIGlmIG1zZy5zZW5kZXIgaXMgdGhlIG93bmVyIG9mIHRoaXMgZmlzaAogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgLy9hZnRlciBtYXN0ZXIgbW9kaWZpZXIgaW52b2tlIGludGVybmFsIHRyYW5zZmVyCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljCiAgICBvbmx5Qm9vc3Rlck93bmVyKF90b2tlbklkKQogICAgewogICAgICAgIGFwcHJvdmVkW190b2tlbklkXSA9IF90bzsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlZFtfdG9rZW5JZF0gPT0gbXNnLnNlbmRlciB8fCBtc2cuc2VuZGVyID09IGZpc2hiYW5rIHx8IG1zZy5zZW5kZXIgPT0gYXVjdGlvbik7CiAgICAgICAgLy9yZXF1aXJlIG1zZy5zZW5kZXIgdG8gYmUgYXBwcm92ZWQgZm9yIHRoaXMgdG9rZW4gb3IgdG8gYmUgdGhlIGZpc2hiYW5rIGNvbnRyYWN0CiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgICAgICAvL2hhbmRsZXMgZXZlbnQsIGJhbGFuY2VzIGFuZCBhcHByb3ZhbCByZXNldAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlZFtfdG9rZW5JZF0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgX3RyYW5zZmVyKG93bmVyT2YoX3Rva2VuSWQpLCBtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CgoKfQoKCgoKCgpjb250cmFjdCBGaXNoYmFua0NoZXN0cyBpcyBPd25hYmxlIHsKCiAgICBzdHJ1Y3QgQ2hlc3QgewogICAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgICAgdWludDE2IGJvb3N0ZXJzOwogICAgICAgIHVpbnQxNiBjaGVzdFR5cGU7CiAgICAgICAgdWludDI0IHJhaXNlQ2hhbmNlOy8vSW5jcmVhY2UgY2hhbmNlIHRvIGNhdGNoIGJpZ2dlciBjaGVzdCAoMSA9IDE6MTAwMDApCiAgICAgICAgdWludDggb25seVNwZWNpZmljVHlwZTsKICAgICAgICB1aW50OCBvbmx5U3BlY2lmaWNTdHJlbmd0aDsKICAgICAgICB1aW50MjQgcmFpc2VTdHJlbmd0aDsKICAgIH0KCiAgICBDaGVzdFtdIHB1YmxpYyBjaGVzdHM7CiAgICBGaXNoYmFua0Jvb3N0ZXJzIHB1YmxpYyBib29zdGVyQ29udHJhY3Q7CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGFwcHJvdmVkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludGVyczsKCiAgICBtb2RpZmllciBvbmx5Q2hlc3RPd25lcih1aW50MjU2IF90b2tlbklkKSB7CiAgICAgICAgcmVxdWlyZShjaGVzdHNbX3Rva2VuSWRdLm93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1pbnRlcnMoKSB7CiAgICAgICAgcmVxdWlyZShtaW50ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEZpc2hiYW5rQ2hlc3RzKGFkZHJlc3MgX2Jvb3N0ZXJBZGRyZXNzKSBwdWJsaWMgewogICAgICAgIGJvb3N0ZXJDb250cmFjdCA9IEZpc2hiYW5rQm9vc3RlcnMoX2Jvb3N0ZXJBZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRNaW50ZXIoYWRkcmVzcyBfbWludGVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBtaW50ZXJzW19taW50ZXJdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVNaW50ZXIoYWRkcmVzcyBfbWludGVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBtaW50ZXJzW19taW50ZXJdID0gZmFsc2U7CiAgICB9CgogICAgLy9jcmVhdGUgYSBjaGVzdAoKICAgIGZ1bmN0aW9uIG1pbnRDaGVzdChhZGRyZXNzIF9vd25lciwgdWludDE2IF9ib29zdGVycywgdWludDI0IF9yYWlzZVN0cmVuZ3RoLCB1aW50MjQgX3JhaXNlQ2hhbmNlLCB1aW50OCBfb25seVNwZWNpZmljVHlwZSwgdWludDggX29ubHlTcGVjaWZpY1N0cmVuZ3RoKSBvbmx5TWludGVycyBwdWJsaWMgewoKICAgICAgICBjaGVzdHMubGVuZ3RoKys7CiAgICAgICAgY2hlc3RzW2NoZXN0cy5sZW5ndGggLSAxXS5vd25lciA9IF9vd25lcjsKICAgICAgICBjaGVzdHNbY2hlc3RzLmxlbmd0aCAtIDFdLmJvb3N0ZXJzID0gX2Jvb3N0ZXJzOwogICAgICAgIGNoZXN0c1tjaGVzdHMubGVuZ3RoIC0gMV0ucmFpc2VTdHJlbmd0aCA9IF9yYWlzZVN0cmVuZ3RoOwogICAgICAgIGNoZXN0c1tjaGVzdHMubGVuZ3RoIC0gMV0ucmFpc2VDaGFuY2UgPSBfcmFpc2VDaGFuY2U7CiAgICAgICAgY2hlc3RzW2NoZXN0cy5sZW5ndGggLSAxXS5vbmx5U3BlY2lmaWNUeXBlID0gX29ubHlTcGVjaWZpY1R5cGU7CiAgICAgICAgY2hlc3RzW2NoZXN0cy5sZW5ndGggLSAxXS5vbmx5U3BlY2lmaWNTdHJlbmd0aCA9IF9vbmx5U3BlY2lmaWNTdHJlbmd0aDsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfb3duZXIsIGNoZXN0cy5sZW5ndGggLSAxKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb252ZXJ0Q2hlc3QodWludDI1NiBfdG9rZW5JZCkgb25seUNoZXN0T3duZXIoX3Rva2VuSWQpIHB1YmxpYyB7CgogICAgICAgIENoZXN0IG1lbW9yeSBjaGVzdCA9IGNoZXN0c1tfdG9rZW5JZF07CiAgICAgICAgdWludDE2IG51bWJlck9mQm9vc3RlcnMgPSBjaGVzdC5ib29zdGVyczsKCiAgICAgICAgaWYgKGNoZXN0Lm9ubHlTcGVjaWZpY1R5cGUgIT0gMCkgey8vU3BlY2lmaWMgYm9vc3RlcnMKICAgICAgICAgICAgaWYgKGNoZXN0Lm9ubHlTcGVjaWZpY1R5cGUgPT0gMSB8fCBjaGVzdC5vbmx5U3BlY2lmaWNUeXBlID09IDMpIHsKICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAyIGRheXMsIGNoZXN0Lm9ubHlTcGVjaWZpY1R5cGUsIGNoZXN0Lm9ubHlTcGVjaWZpY1N0cmVuZ3RoLCBjaGVzdC5ib29zdGVycywgY2hlc3QucmFpc2VTdHJlbmd0aCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hlc3Qub25seVNwZWNpZmljVHlwZSA9PSA1KSB7Ly9JbnN0YW50IGF0dGFjawogICAgICAgICAgICAgICAgYm9vc3RlckNvbnRyYWN0Lm1pbnRCb29zdGVyKG1zZy5zZW5kZXIsIDAsIDUsIDEsIGNoZXN0LmJvb3N0ZXJzLCBjaGVzdC5yYWlzZVN0cmVuZ3RoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjaGVzdC5vbmx5U3BlY2lmaWNUeXBlID09IDIpIHsvL0ZyZWV6ZQogICAgICAgICAgICAgICAgdWludDMyIGZyZWV6ZVRpbWUgPSA3IGRheXM7CiAgICAgICAgICAgICAgICBpZiAoY2hlc3Qub25seVNwZWNpZmljU3RyZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgICAgIGZyZWV6ZVRpbWUgPSAxNCBkYXlzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGVzdC5vbmx5U3BlY2lmaWNTdHJlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgZnJlZXplVGltZSA9IDMwIGRheXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBib29zdGVyQ29udHJhY3QubWludEJvb3N0ZXIobXNnLnNlbmRlciwgZnJlZXplVGltZSwgNSwgY2hlc3Qub25seVNwZWNpZmljVHlwZSwgY2hlc3QuYm9vc3RlcnMsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNoZXN0Lm9ubHlTcGVjaWZpY1R5cGUgPT0gNCkgey8vV2F0Y2gKICAgICAgICAgICAgICAgIHVpbnQzMiB3YXRjaFRpbWUgPSAxMiBob3VyczsKICAgICAgICAgICAgICAgIGlmIChjaGVzdC5vbmx5U3BlY2lmaWNTdHJlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgd2F0Y2hUaW1lID0gNDggaG91cnM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoZXN0Lm9ubHlTcGVjaWZpY1N0cmVuZ3RoID09IDMpIHsKICAgICAgICAgICAgICAgICAgICB3YXRjaFRpbWUgPSAzIGRheXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBib29zdGVyQ29udHJhY3QubWludEJvb3N0ZXIobXNnLnNlbmRlciwgd2F0Y2hUaW1lLCA0LCBjaGVzdC5vbmx5U3BlY2lmaWNTdHJlbmd0aCwgY2hlc3QuYm9vc3RlcnMsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOwogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSB7Ly9SZWd1bGFyIGNoZXN0CgogICAgICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgbnVtYmVyT2ZCb29zdGVyczsgaSArKykgewogICAgICAgICAgICAgICAgdWludDI0IHJhbmRvbSA9IHVpbnQxNihrZWNjYWsyNTYoYmxvY2suY29pbmJhc2UsIGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXIgLSAxKSwgaSwgY2hlc3RzLmxlbmd0aCkpICUgMTAwMAogICAgICAgICAgICAgICAgLSBjaGVzdC5yYWlzZUNoYW5jZTsKICAgICAgICAgICAgICAgIC8vZ2V0IHJhbmRvbSAwIC0gOTk5OSBtaW51cyByYWlzZUNoYW5jZQoKICAgICAgICAgICAgICAgIGlmIChyYW5kb20gPiA4NTApIHsKICAgICAgICAgICAgICAgICAgICBib29zdGVyQ29udHJhY3QubWludEJvb3N0ZXIobXNnLnNlbmRlciwgMiBkYXlzLCAxLCAxLCAxLCBjaGVzdC5yYWlzZVN0cmVuZ3RoKTsgLy9TbWFsbCBBZ2lsaXR5IEJvb3N0ZXIKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmFuZG9tID4gNzAwKSB7CiAgICAgICAgICAgICAgICAgICAgYm9vc3RlckNvbnRyYWN0Lm1pbnRCb29zdGVyKG1zZy5zZW5kZXIsIDcgZGF5cywgMiwgMSwgMSwgY2hlc3QucmFpc2VTdHJlbmd0aCk7IC8vU21hbGwgRnJlZXplcgogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYW5kb20gPiA1NTApIHsKICAgICAgICAgICAgICAgICAgICBib29zdGVyQ29udHJhY3QubWludEJvb3N0ZXIobXNnLnNlbmRlciwgMiBkYXlzLCAzLCAxLCAxLCBjaGVzdC5yYWlzZVN0cmVuZ3RoKTsgLy9TbWFsbCBQb3dlciBCb29zdGVyCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDQwMCkgewogICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAxMiBob3VycywgNCwgMSwgMSwgY2hlc3QucmFpc2VTdHJlbmd0aCk7IC8vVGlueSBXYXRjaAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYW5kb20gPiAzMjUpIHsKICAgICAgICAgICAgICAgICAgICBib29zdGVyQ29udHJhY3QubWludEJvb3N0ZXIobXNnLnNlbmRlciwgNDggaG91cnMsIDQsIDIsIDEsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOyAvL1NtYWxsIFdhdGNoCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDI1MCkgewogICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAyIGRheXMsIDEsIDIsIDEsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOyAvL01pZCBBZ2lsaXR5IEJvb3N0ZXIKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmFuZG9tID4gMTc1KSB7CiAgICAgICAgICAgICAgICAgICAgYm9vc3RlckNvbnRyYWN0Lm1pbnRCb29zdGVyKG1zZy5zZW5kZXIsIDE0IGRheXMsIDIsIDIsIDEsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOyAvL01pZCBGcmVlemVyCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEwMCkgewogICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAyIGRheXMsIDMsIDIsIDEsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOyAvL01pZCBQb3dlciBCb29zdGVyCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDgwKSB7CiAgICAgICAgICAgICAgICAgICAgYm9vc3RlckNvbnRyYWN0Lm1pbnRCb29zdGVyKG1zZy5zZW5kZXIsIDIgZGF5cywgMSwgMywgMSwgY2hlc3QucmFpc2VTdHJlbmd0aCk7IC8vQmlnIEFnaWxpdHkgQm9vc3RlcgogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYW5kb20gPiA2MCkgewogICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAzMCBkYXlzLCAyLCAzLCAxLCBjaGVzdC5yYWlzZVN0cmVuZ3RoKTsgLy9CaWcgRnJlZXplcgogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYW5kb20gPiA0MCkgewogICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAyIGRheXMsIDMsIDMsIDEsIGNoZXN0LnJhaXNlU3RyZW5ndGgpOyAvL0JpZyBQb3dlciBCb29zdGVyCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDIwKSB7CiAgICAgICAgICAgICAgICAgICAgYm9vc3RlckNvbnRyYWN0Lm1pbnRCb29zdGVyKG1zZy5zZW5kZXIsIDAsIDUsIDEsIDEsIDApOyAvL0luc3RhbnQgQXR0YWNrCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJvb3N0ZXJDb250cmFjdC5taW50Qm9vc3Rlcihtc2cuc2VuZGVyLCAzIGRheXMsIDQsIDMsIDEsIDApOyAvL0dvbGQgV2F0Y2gKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIGFkZHJlc3MoMCksIF90b2tlbklkKTsgLy9idXJuIGNoZXN0CiAgICB9CgogICAgLy9FUkM3MjEgZnVuY3Rpb25hbGl0eQogICAgLy9jb3VsZCBzcGxpdCB0aGlzIHRvIGEgZGlmZmVyZW50IGNvbnRyYWN0IGJ1dCBkb2Vzbid0IG1ha2UgaXQgZWFzaWVyIHRvIHJlYWQKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIGFwcHJvdmVkLCB1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKSB7CiAgICAgICAgdG90YWwgPSBjaGVzdHMubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKXsKICAgICAgICBiYWxhbmNlID0gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpewogICAgICAgIG93bmVyID0gY2hlc3RzW190b2tlbklkXS5vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKGNoZXN0c1tfdG9rZW5JZF0ub3duZXIgPT0gX2Zyb20pOyAvL2NhbiBvbmx5IHRyYW5zZmVyIGlmIHByZXZpb3VzIG93bmVyIGVxdWFscyBmcm9tCiAgICAgICAgY2hlc3RzW190b2tlbklkXS5vd25lciA9IF90bzsKICAgICAgICBhcHByb3ZlZFtfdG9rZW5JZF0gPSBhZGRyZXNzKDApOyAvL3Jlc2V0IGFwcHJvdmVkIG9mIGZpc2ggb24gZXZlcnkgdHJhbnNmZXIKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gMTsgLy91bmRlcmZsb3cgY2FuIG9ubHkgaGFwcGVuIG9uIDB4CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSAxOyAvL292ZXJmbG93cyBvbmx5IHdpdGggdmVyeSB2ZXJ5IGxhcmdlIGFtb3VudHMgb2YgZmlzaAogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljCiAgICBvbmx5Q2hlc3RPd25lcihfdG9rZW5JZCkgLy9jaGVjayBpZiBtc2cuc2VuZGVyIGlzIHRoZSBvd25lciBvZiB0aGlzIGZpc2gKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgICAgIC8vYWZ0ZXIgbWFzdGVyIG1vZGlmaWVyIGludm9rZSBpbnRlcm5hbCB0cmFuc2ZlcgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYwogICAgb25seUNoZXN0T3duZXIoX3Rva2VuSWQpCiAgICB7CiAgICAgICAgYXBwcm92ZWRbX3Rva2VuSWRdID0gX3RvOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmVkW190b2tlbklkXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAvL3JlcXVpcmUgbXNnLnNlbmRlciB0byBiZSBhcHByb3ZlZCBmb3IgdGhpcyB0b2tlbgogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgLy9oYW5kbGVzIGV2ZW50LCBiYWxhbmNlcyBhbmQgYXBwcm92YWwgcmVzZXQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCgoKCgpjb250cmFjdCBGaXNoYmFua1V0aWxzIGlzIE93bmFibGUgewoKICAgIHVpbnQzMlsxMDBdIGNvb2xkb3ducyA9IFsKICAgICAgICA3MjAgbWludXRlcywgNzIwIG1pbnV0ZXMsIDcyMCBtaW51dGVzLCA3MjAgbWludXRlcywgNzIwIG1pbnV0ZXMsIC8vMS01CiAgICAgICAgNjYwIG1pbnV0ZXMsIDY2MCBtaW51dGVzLCA2NjAgbWludXRlcywgNjYwIG1pbnV0ZXMsIDY2MCBtaW51dGVzLCAvLzYtMTAKICAgICAgICA2MDAgbWludXRlcywgNjAwIG1pbnV0ZXMsIDYwMCBtaW51dGVzLCA2MDAgbWludXRlcywgNjAwIG1pbnV0ZXMsIC8vMTEtMTUKICAgICAgICA1NDAgbWludXRlcywgNTQwIG1pbnV0ZXMsIDU0MCBtaW51dGVzLCA1NDAgbWludXRlcywgNTQwIG1pbnV0ZXMsIC8vMTYtMjAKICAgICAgICA0ODAgbWludXRlcywgNDgwIG1pbnV0ZXMsIDQ4MCBtaW51dGVzLCA0ODAgbWludXRlcywgNDgwIG1pbnV0ZXMsIC8vMjEtMjUKICAgICAgICA0MjAgbWludXRlcywgNDIwIG1pbnV0ZXMsIDQyMCBtaW51dGVzLCA0MjAgbWludXRlcywgNDIwIG1pbnV0ZXMsIC8vMjYtMzAKICAgICAgICAzNjAgbWludXRlcywgMzYwIG1pbnV0ZXMsIDM2MCBtaW51dGVzLCAzNjAgbWludXRlcywgMzYwIG1pbnV0ZXMsIC8vMzEtMzUKICAgICAgICAzMDAgbWludXRlcywgMzAwIG1pbnV0ZXMsIDMwMCBtaW51dGVzLCAzMDAgbWludXRlcywgMzAwIG1pbnV0ZXMsIC8vMzYtNDAKICAgICAgICAyNDAgbWludXRlcywgMjQwIG1pbnV0ZXMsIDI0MCBtaW51dGVzLCAyNDAgbWludXRlcywgMjQwIG1pbnV0ZXMsIC8vNDEtNDUKICAgICAgICAxODAgbWludXRlcywgMTgwIG1pbnV0ZXMsIDE4MCBtaW51dGVzLCAxODAgbWludXRlcywgMTgwIG1pbnV0ZXMsIC8vNDYtNTAKICAgICAgICAxMjAgbWludXRlcywgMTIwIG1pbnV0ZXMsIDEyMCBtaW51dGVzLCAxMjAgbWludXRlcywgMTIwIG1pbnV0ZXMsIC8vNTEtNTUKICAgICAgICA5MCBtaW51dGVzLCAgOTAgbWludXRlcywgIDkwIG1pbnV0ZXMsICA5MCBtaW51dGVzLCAgOTAgbWludXRlcywgIC8vNTYtNjAKICAgICAgICA3NSBtaW51dGVzLCAgNzUgbWludXRlcywgIDc1IG1pbnV0ZXMsICA3NSBtaW51dGVzLCAgNzUgbWludXRlcywgIC8vNjEtNjUKICAgICAgICA2MCBtaW51dGVzLCAgNjAgbWludXRlcywgIDYwIG1pbnV0ZXMsICA2MCBtaW51dGVzLCAgNjAgbWludXRlcywgIC8vNjYtNzAKICAgICAgICA1MCBtaW51dGVzLCAgNTAgbWludXRlcywgIDUwIG1pbnV0ZXMsICA1MCBtaW51dGVzLCAgNTAgbWludXRlcywgIC8vNzEtNzUKICAgICAgICA0MCBtaW51dGVzLCAgNDAgbWludXRlcywgIDQwIG1pbnV0ZXMsICA0MCBtaW51dGVzLCAgNDAgbWludXRlcywgIC8vNzYtODAKICAgICAgICAzMCBtaW51dGVzLCAgMzAgbWludXRlcywgIDMwIG1pbnV0ZXMsICAzMCBtaW51dGVzLCAgMzAgbWludXRlcywgIC8vODEtODUKICAgICAgICAyMCBtaW51dGVzLCAgMjAgbWludXRlcywgIDIwIG1pbnV0ZXMsICAyMCBtaW51dGVzLCAgMjAgbWludXRlcywgIC8vODYtOTAKICAgICAgICAxMCBtaW51dGVzLCAgMTAgbWludXRlcywgIDEwIG1pbnV0ZXMsICAxMCBtaW51dGVzLCAgMTAgbWludXRlcywgIC8vOTEtOTUKICAgICAgICA1IG1pbnV0ZXMsICAgNSBtaW51dGVzLCAgIDUgbWludXRlcywgICA1IG1pbnV0ZXMsICAgNSBtaW51dGVzICAgIC8vOTYtMTAwCiAgICBdOwoKCiAgICBmdW5jdGlvbiBzZXRDb29sZG93bnModWludDMyWzEwMF0gX2Nvb2xkb3ducykgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgY29vbGRvd25zID0gX2Nvb2xkb3duczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRGaXNoUGFyYW1zKHVpbnQyNTYgaGFzaFNlZWQxLCB1aW50MjU2IGhhc2hTZWVkMiwgdWludDI1NiBmaXNoZXNMZW5ndGgsIGFkZHJlc3MgY29pbmJhc2UpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAodWludDMyWzRdKSB7CgogICAgICAgIGJ5dGVzMzJbNV0gbWVtb3J5IGhhc2hTZWVkczsKICAgICAgICBoYXNoU2VlZHNbMF0gPSBrZWNjYWsyNTYoaGFzaFNlZWQxIF4gaGFzaFNlZWQyKTsgLy94b3IgYm90aCBzZWVkIGZyb20gb3duZXIgYW5kIHVzZXIgc28gbm8gb25lIGNhbiBjaGVhdAogICAgICAgIGhhc2hTZWVkc1sxXSA9IGtlY2NhazI1NihoYXNoU2VlZHNbMF0sIGZpc2hlc0xlbmd0aCk7CiAgICAgICAgaGFzaFNlZWRzWzJdID0ga2VjY2FrMjU2KGhhc2hTZWVkc1sxXSwgY29pbmJhc2UpOwogICAgICAgIGhhc2hTZWVkc1szXSA9IGtlY2NhazI1NihoYXNoU2VlZHNbMl0sIGNvaW5iYXNlLCBmaXNoZXNMZW5ndGgpOwogICAgICAgIGhhc2hTZWVkc1s0XSA9IGtlY2NhazI1NihoYXNoU2VlZHNbMV0sIGhhc2hTZWVkc1syXSwgaGFzaFNlZWRzWzBdKTsKCiAgICAgICAgdWludDI0WzZdIG1lbW9yeSBzZWVkcyA9IFsKICAgICAgICAgICAgdWludDI0KHVpbnQoaGFzaFNlZWRzWzNdKSAlIDEwZTYgKyAxKSwgLy93aGFsZSBjaGFuY2UKICAgICAgICAgICAgdWludDI0KHVpbnQoaGFzaFNlZWRzWzBdKSAlIDQyMCArIDEpLCAvL3Bvd2VyCiAgICAgICAgICAgIHVpbnQyNCh1aW50KGhhc2hTZWVkc1sxXSkgJSA0MjAgKyAxKSwgLy9hZ2lsaXR5CiAgICAgICAgICAgIHVpbnQyNCh1aW50KGhhc2hTZWVkc1syXSkgJSAxNTAgKyAxKSwgLy9zcGVlZAogICAgICAgICAgICB1aW50MjQodWludChoYXNoU2VlZHNbNF0pICUgMTYgKyAxKSwgLy93aGFsZSB0eXBlCiAgICAgICAgICAgIHVpbnQyNCh1aW50KGhhc2hTZWVkc1s0XSkgJSA1MDAwICsgMSkgLy9yYXJpdHkKICAgICAgICBdOwoKICAgICAgICB1aW50MzJbNF0gbWVtb3J5IGZpc2hQYXJhbXM7CgogICAgICAgIGlmIChzZWVkc1swXSA9PSAxMDAwMDAwKSB7Ly9UaGlzIGlzIGEgd2hhbGUgMToxIDAwMCAwMDAgY2hhbmNlCgogICAgICAgICAgICBpZiAoc2VlZHNbNF0gPT0gMSkgey8vT3JjYQogICAgICAgICAgICAgICAgZmlzaFBhcmFtcyA9IFsxNDAgKyB1aW50OChzZWVkc1sxXSAvIDQyKSwgMTQwICsgdWludDgoc2VlZHNbMl0gLyA0MiksIDc1ICsgdWludDgoc2VlZHNbM10gLyA2KSwgdWludDMyKDUwMDAwMCldOwogICAgICAgICAgICAgICAgaWYoZmlzaFBhcmFtc1swXSA9PSAxNDApIHsKICAgICAgICAgICAgICAgICAgICBmaXNoUGFyYW1zWzBdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihmaXNoUGFyYW1zWzFdID09IDE0MCkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMV0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGZpc2hQYXJhbXNbMl0gPT0gNzUpIHsKICAgICAgICAgICAgICAgICAgICBmaXNoUGFyYW1zWzJdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VlZHNbNF0gPCA0KSB7Ly9CbHVlIHdoYWxlCiAgICAgICAgICAgICAgICBmaXNoUGFyYW1zID0gWzEzMCArIHVpbnQ4KHNlZWRzWzFdIC8gNDIpLCAxMzAgKyB1aW50OChzZWVkc1syXSAvIDQyKSwgNzUgKyB1aW50OChzZWVkc1szXSAvIDYpLCB1aW50MzIoNTAwMDAwKV07CiAgICAgICAgICAgICAgICBpZihmaXNoUGFyYW1zWzBdID09IDEzMCkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMF0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGZpc2hQYXJhbXNbMV0gPT0gMTMwKSB7CiAgICAgICAgICAgICAgICAgICAgZmlzaFBhcmFtc1sxXSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoZmlzaFBhcmFtc1syXSA9PSA3NSkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMl0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsvL0NhY2hhbG90CiAgICAgICAgICAgICAgICBmaXNoUGFyYW1zID0gWzExNSArIHVpbnQ4KHNlZWRzWzFdIC8gMjgpLCAxMTUgKyB1aW50OChzZWVkc1syXSAvIDI4KSwgNzUgKyB1aW50OChzZWVkc1szXSAvIDYpLCB1aW50MzIoNTAwMDAwKV07CiAgICAgICAgICAgICAgICBpZihmaXNoUGFyYW1zWzBdID09IDExNSkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMF0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGZpc2hQYXJhbXNbMV0gPT0gMTE1KSB7CiAgICAgICAgICAgICAgICAgICAgZmlzaFBhcmFtc1sxXSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoZmlzaFBhcmFtc1syXSA9PSA3NSkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMl0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzZWVkc1s1XSA9PSA1MDAwKSB7Ly9MZWdlbmRhcnkKICAgICAgICAgICAgICAgIGZpc2hQYXJhbXMgPSBbODUgKyB1aW50OChzZWVkc1sxXSAvIDE0KSwgODUgKyB1aW50OChzZWVkc1syXSAvIDE0KSwgdWludDgoNTAgKyBzZWVkc1szXSAvIDMpLCB1aW50MzIoMTAwMCldOwogICAgICAgICAgICAgICAgaWYoZmlzaFBhcmFtc1swXSA9PSA4NSkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMF0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGZpc2hQYXJhbXNbMV0gPT0gODUpIHsKICAgICAgICAgICAgICAgICAgICBmaXNoUGFyYW1zWzFdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VlZHNbNV0gPiA0ODk5KSB7Ly9FcGljCiAgICAgICAgICAgICAgICBmaXNoUGFyYW1zID0gWzUwICsgdWludDgoc2VlZHNbMV0gLyAxMiksIDUwICsgdWludDgoc2VlZHNbMl0gLyAxMiksIHVpbnQ4KDI1ICsgc2VlZHNbM10gLyAyKSwgdWludDMyKDMwMCldOwogICAgICAgICAgICAgICAgaWYoZmlzaFBhcmFtc1swXSA9PSA1MCkgewogICAgICAgICAgICAgICAgICAgIGZpc2hQYXJhbXNbMF0rKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGZpc2hQYXJhbXNbMV0gPT0gNTApIHsKICAgICAgICAgICAgICAgICAgICBmaXNoUGFyYW1zWzFdKys7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgaWYgKHNlZWRzWzVdID4gNDAwMCkgey8vUmFyZQogICAgICAgICAgICAgICAgZmlzaFBhcmFtcyA9IFsyMCArIHVpbnQ4KHNlZWRzWzFdIC8gMTQpLCAyMCArIHVpbnQ4KHNlZWRzWzJdIC8gMTQpLCB1aW50OCgyNSArIHNlZWRzWzNdIC8gMyksIHVpbnQzMigxMDApXTsKICAgICAgICAgICAgICAgIGlmKGZpc2hQYXJhbXNbMF0gPT0gMjApIHsKICAgICAgICAgICAgICAgICAgICBmaXNoUGFyYW1zWzBdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZihmaXNoUGFyYW1zWzFdID09IDIwKSB7CiAgICAgICAgICAgICAgICAgICAgZmlzaFBhcmFtc1sxXSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ugey8vQ29tbW9uCiAgICAgICAgICAgICAgICBmaXNoUGFyYW1zID0gW3VpbnQ4KHNlZWRzWzFdIC8gMjEpLCB1aW50OChzZWVkc1syXSAvIDIxKSwgdWludDgoc2VlZHNbM10gLyAzKSwgdWludDMyKDM2KV07CiAgICAgICAgICAgICAgICBpZiAoZmlzaFBhcmFtc1swXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZmlzaFBhcmFtc1swXSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZmlzaFBhcmFtc1sxXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZmlzaFBhcmFtc1sxXSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZmlzaFBhcmFtc1syXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZmlzaFBhcmFtc1syXSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmaXNoUGFyYW1zOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvb2xkb3duKHVpbnQxNiBzcGVlZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50NjQpewogICAgICAgIHJldHVybiB1aW50NjQobm93ICsgY29vbGRvd25zW3NwZWVkIC0gMV0pOwogICAgfQoKICAgIC8vQ2VpbGluZyBmdW5jdGlvbiBmb3IgZmlzaCBnZW5lcmF0b3IKICAgIGZ1bmN0aW9uIGNlaWwodWludCBiYXNlLCB1aW50IGRpdmlkZXIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBiYXNlIC8gZGl2aWRlciArICgoYmFzZSAlIGRpdmlkZXIgPiAwKSA/IDEgOiAwKTsKICAgIH0KfQoKCgoKLy8vIEB0aXRsZSBBdWN0aW9uIGNvbnRyYWN0IGZvciBhbnkgdHlwZSBvZiBlcmM3MjEgdG9rZW4KLy8vIEBhdXRob3IgRmlzaGJhbmsKCmNvbnRyYWN0IEVSQzcyMSB7CgogICAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBpbmRleGVkIHRva2VuSWQpOwoKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIGFwcHJvdmVkLCB1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CgogICAgLy8gT3B0aW9uYWwKICAgIC8vIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICAgIC8vIGZ1bmN0aW9uIHRva2VuT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG9rZW5JZCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKTsKfQoKCmNvbnRyYWN0IEVSQzcyMUF1Y3Rpb24gaXMgQmVuZWZpY2lhcnkgewoKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICBhZGRyZXNzIHNlbGxlcjsKICAgICAgICB1aW50MjU2IHRva2VuSWQ7CiAgICAgICAgdWludDY0IGF1Y3Rpb25CZWdpbjsKICAgICAgICB1aW50NjQgYXVjdGlvbkVuZDsKICAgICAgICB1aW50MjU2IHN0YXJ0UHJpY2U7CiAgICAgICAgdWludDI1NiBlbmRQcmljZTsKICAgIH0KCiAgICB1aW50MzIgcHVibGljIGF1Y3Rpb25EdXJhdGlvbiA9IDcgZGF5czsKCiAgICBFUkM3MjEgcHVibGljIEVSQzcyMUNvbnRyYWN0OwogICAgdWludDI1NiBwdWJsaWMgZmVlID0gNDUwMDA7IC8vaW4gMSAxMDAwMHRoIG9mIGEgcGVyY2VudCBzbyA0LjUlIGF0IHRoZSBzdGFydAogICAgdWludDI1NiBjb25zdGFudCBGRUVfRElWSURFUiA9IDEwMDAwMDA7CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gQXVjdGlvbikgcHVibGljIGF1Y3Rpb25zOwoKICAgIGV2ZW50IEF1Y3Rpb25Xb24odWludDI1NiBpbmRleGVkIHRva2VuSWQsIGFkZHJlc3MgaW5kZXhlZCB3aW5uZXIsIGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIHVpbnQyNTYgcHJpY2UpOwoKICAgIGV2ZW50IEF1Y3Rpb25TdGFydGVkKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyKTsKCiAgICBldmVudCBBdWN0aW9uRmluYWxpemVkKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyKTsKCgogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3N0YXJ0UHJpY2UsIHVpbnQyNTYgX2VuZFByaWNlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShFUkM3MjFDb250cmFjdC50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgYWRkcmVzcyh0aGlzKSwgX3Rva2VuSWQpKTsKICAgICAgICAvL1ByaWNlcyBtdXN0IGJlIGluIHJhbmdlIGZyb20gMC4wMSBFdGggYW5kIDEwIDAwMCBFdGgKICAgICAgICByZXF1aXJlKF9zdGFydFByaWNlIDw9IDEwMDAwIGV0aGVyICYmIF9lbmRQcmljZSA8PSAxMDAwMCBldGhlcik7CiAgICAgICAgcmVxdWlyZShfc3RhcnRQcmljZSA+PSAoMSBldGhlciAvIDEwMCkgJiYgX2VuZFByaWNlID49ICgxIGV0aGVyIC8gMTAwKSk7CgogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb247CgogICAgICAgIGF1Y3Rpb24uc2VsbGVyID0gbXNnLnNlbmRlcjsKICAgICAgICBhdWN0aW9uLnRva2VuSWQgPSBfdG9rZW5JZDsKICAgICAgICBhdWN0aW9uLmF1Y3Rpb25CZWdpbiA9IHVpbnQ2NChub3cpOwogICAgICAgIGF1Y3Rpb24uYXVjdGlvbkVuZCA9IHVpbnQ2NChub3cgKyBhdWN0aW9uRHVyYXRpb24pOwogICAgICAgIHJlcXVpcmUoYXVjdGlvbi5hdWN0aW9uRW5kID4gYXVjdGlvbi5hdWN0aW9uQmVnaW4pOwogICAgICAgIGF1Y3Rpb24uc3RhcnRQcmljZSA9IF9zdGFydFByaWNlOwogICAgICAgIGF1Y3Rpb24uZW5kUHJpY2UgPSBfZW5kUHJpY2U7CgogICAgICAgIGF1Y3Rpb25zW190b2tlbklkXSA9IGF1Y3Rpb247CgogICAgICAgIEF1Y3Rpb25TdGFydGVkKF90b2tlbklkLCBtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgZnVuY3Rpb24gYnV5QXVjdGlvbih1aW50MjU2IF90b2tlbklkKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGF1Y3Rpb25zW190b2tlbklkXTsKCiAgICAgICAgdWludDI1NiBwcmljZSA9IGNhbGN1bGF0ZUJpZChfdG9rZW5JZCk7CiAgICAgICAgdWludDI1NiB0b3RhbEZlZSA9IHByaWNlICogZmVlIC8gRkVFX0RJVklERVI7IC8vc2FmZSBtYXRoIG5lZWRlZD8KCiAgICAgICAgcmVxdWlyZShwcmljZSA8PSBtc2cudmFsdWUpOyAvL3JldmVydCBpZiBub3QgZW5vdWdoIGV0aGVyIHNlbmQKCiAgICAgICAgaWYgKHByaWNlICE9IG1zZy52YWx1ZSkgey8vc2VuZCBiYWNrIHRvIG11Y2ggZXRoCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlIC0gcHJpY2UpOwogICAgICAgIH0KCiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIodG90YWxGZWUpOwoKICAgICAgICBhdWN0aW9uLnNlbGxlci50cmFuc2ZlcihwcmljZSAtIHRvdGFsRmVlKTsKCiAgICAgICAgaWYgKCFFUkM3MjFDb250cmFjdC50cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgICAgIC8vY2FuJ3QgY29tcGxldGUgdHJhbnNmZXIgaWYgdGhpcyBmYWlscwogICAgICAgIH0KCiAgICAgICAgQXVjdGlvbldvbihfdG9rZW5JZCwgbXNnLnNlbmRlciwgYXVjdGlvbi5zZWxsZXIsIHByaWNlKTsKCiAgICAgICAgZGVsZXRlIGF1Y3Rpb25zW190b2tlbklkXTsKICAgICAgICAvL2RlbGV0ZXMgYXVjdGlvbgogICAgfQoKICAgIGZ1bmN0aW9uIHNhdmVUb2tlbih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhdWN0aW9uc1tfdG9rZW5JZF0uYXVjdGlvbkVuZCA8IG5vdyk7CiAgICAgICAgLy9hdWN0aW9uIG11c3QgaGF2ZSBlbmRlZAogICAgICAgIHJlcXVpcmUoRVJDNzIxQ29udHJhY3QudHJhbnNmZXIoYXVjdGlvbnNbX3Rva2VuSWRdLnNlbGxlciwgX3Rva2VuSWQpKTsKICAgICAgICAvL3RyYW5zZmVyIGZpc2ggYmFjayB0byBzZWxsZXIKCiAgICAgICAgQXVjdGlvbkZpbmFsaXplZChfdG9rZW5JZCwgYXVjdGlvbnNbX3Rva2VuSWRdLnNlbGxlcik7CgogICAgICAgIGRlbGV0ZSBhdWN0aW9uc1tfdG9rZW5JZF07CiAgICAgICAgLy9kZWxldGUgYXVjdGlvbgogICAgfQoKICAgIGZ1bmN0aW9uIEVSQzcyMUF1Y3Rpb24oYWRkcmVzcyBfRVJDNzIxQ29udHJhY3QpIHB1YmxpYyB7CiAgICAgICAgRVJDNzIxQ29udHJhY3QgPSBFUkM3MjEoX0VSQzcyMUNvbnRyYWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRGZWUodWludDI1NiBfZmVlKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAoX2ZlZSA+IGZlZSkgewogICAgICAgICAgICByZXZlcnQoKTsgLy9mZWUgY2FuIG9ubHkgYmUgc2V0IHRvIGxvd2VyIHZhbHVlIHRvIHByZXZlbnQgYXR0YWNrcyBieSBvd25lcgogICAgICAgIH0KICAgICAgICBmZWUgPSBfZmVlOyAvLyBhbGwgaXMgd2VsbCBzZXQgZmVlCiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlQmlkKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGF1Y3Rpb25zW190b2tlbklkXTsKCiAgICAgICAgaWYgKG5vdyA+PSBhdWN0aW9uLmF1Y3Rpb25FbmQpIHsvL2lmIGF1Y3Rpb24gZW5kZWQgcmV0dXJuIGF1Y3Rpb24gZW5kIHByaWNlCiAgICAgICAgICAgIHJldHVybiBhdWN0aW9uLmVuZFByaWNlOwogICAgICAgIH0KICAgICAgICAvL2dldCBob3VycyBwYXNzZWQKICAgICAgICB1aW50MjU2IGhvdXJzUGFzc2VkID0gKG5vdyAtIGF1Y3Rpb24uYXVjdGlvbkJlZ2luKSAvIDEgaG91cnM7CiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2U7CiAgICAgICAgLy9nZXQgdG90YWwgaG91cnMKICAgICAgICB1aW50MTYgdG90YWxIb3VycyA9IHVpbnQxNihhdWN0aW9uRHVyYXRpb24gLzEgaG91cnMpIC0gMTsKCiAgICAgICAgaWYgKGF1Y3Rpb24uZW5kUHJpY2UgPiBhdWN0aW9uLnN0YXJ0UHJpY2UpIHsKICAgICAgICAgICAgY3VycmVudFByaWNlID0gYXVjdGlvbi5zdGFydFByaWNlICsgKGhvdXJzUGFzc2VkICogKGF1Y3Rpb24uZW5kUHJpY2UgLSBhdWN0aW9uLnN0YXJ0UHJpY2UpKS8gdG90YWxIb3VyczsKICAgICAgICB9IGVsc2UgaWYoYXVjdGlvbi5lbmRQcmljZSA8IGF1Y3Rpb24uc3RhcnRQcmljZSkgewogICAgICAgICAgICBjdXJyZW50UHJpY2UgPSBhdWN0aW9uLnN0YXJ0UHJpY2UgLSAoaG91cnNQYXNzZWQgKiAoYXVjdGlvbi5zdGFydFByaWNlIC0gYXVjdGlvbi5lbmRQcmljZSkpLyB0b3RhbEhvdXJzOwogICAgICAgIH0gZWxzZSB7Ly9zdGFydCBhbmQgZW5kIGFyZSB0aGUgc2FtZQogICAgICAgICAgICBjdXJyZW50UHJpY2UgPSBhdWN0aW9uLmVuZFByaWNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICAvL3JldHVybiB0aGUgcHJpY2UgYXQgdGhpcyB2ZXJ5IG1vbWVudAogICAgfQoKICAgIC8vLyByZXR1cm4gdG9rZW4gaWYgY2FzZSB3aGVuIG5lZWQgdG8gcmVkZXBsb3kgYXVjdGlvbiBjb250cmFjdAogICAgZnVuY3Rpb24gcmV0dXJuVG9rZW4odWludDI1NiBfdG9rZW5JZCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShFUkM3MjFDb250cmFjdC50cmFuc2ZlcihhdWN0aW9uc1tfdG9rZW5JZF0uc2VsbGVyLCBfdG9rZW5JZCkpOwogICAgICAgIC8vdHJhbnNmZXIgZmlzaCBiYWNrIHRvIHNlbGxlcgoKICAgICAgICBBdWN0aW9uRmluYWxpemVkKF90b2tlbklkLCBhdWN0aW9uc1tfdG9rZW5JZF0uc2VsbGVyKTsKCiAgICAgICAgZGVsZXRlIGF1Y3Rpb25zW190b2tlbklkXTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgQ29yZSBjb250cmFjdCBvZiBmaXNoYmFuawovLy8gQGF1dGhvciBGaXNoYmFuawoKY29udHJhY3QgRmlzaGJhbmsgaXMgQ2hlc3RzU3RvcmUgewoKICAgIHN0cnVjdCBGaXNoIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIHVpbnQ4IGFjdGl2ZUJvb3N0ZXI7CiAgICAgICAgdWludDY0IGJvb3N0ZWRUaWxsOwogICAgICAgIHVpbnQ4IGJvb3N0ZXJTdHJlbmd0aDsKICAgICAgICB1aW50MjQgYm9vc3RlclJhaXNlVmFsdWU7CiAgICAgICAgdWludDY0IHdlaWdodDsKICAgICAgICB1aW50MTYgcG93ZXI7CiAgICAgICAgdWludDE2IGFnaWxpdHk7CiAgICAgICAgdWludDE2IHNwZWVkOwogICAgICAgIGJ5dGVzMTYgY29sb3I7CiAgICAgICAgdWludDY0IGNhbkZpZ2h0QWdhaW47CiAgICAgICAgdWludDY0IGNhbkJlQXR0YWNrZWRBZ2FpbjsKICAgIH0KCiAgICBzdHJ1Y3QgRmlzaGluZ0F0dGVtcHQgewogICAgICAgIGFkZHJlc3MgZmlzaGVyOwogICAgICAgIHVpbnQyNTYgZmVlUGFpZDsKICAgICAgICBhZGRyZXNzIGFmZmlsaWF0ZTsKICAgICAgICB1aW50MjU2IHNlZWQ7CiAgICAgICAgdWludDY0IGRlYWRsaW5lOy8vdGlsbCB3aGVuIGRvZXMgdGhlIGNvbnRyYWN0IG93bmVyIGhhdmUgdGltZSB0byByZXNvbHZlOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlGaXNoT3duZXIodWludDI1NiBfdG9rZW5JZCkgewogICAgICAgIHJlcXVpcmUoZmlzaGVzW190b2tlbklkXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlSZXNvbHZlcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcmVzb2x2ZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1pbnRlcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWludGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIEZpc2hbXSBwdWJsaWMgZmlzaGVzOwogICAgYWRkcmVzcyBwdWJsaWMgcmVzb2x2ZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBhdWN0aW9uOwogICAgYWRkcmVzcyBwdWJsaWMgbWludGVyOwogICAgYm9vbCBwdWJsaWMgaW1wbGVtZW50c0VSQzcyMSA9IHRydWU7CiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiRmlzaGJhbmsiOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiRklTSCI7CiAgICBieXRlczMyW10gcHVibGljIHJhbmRvbUhhc2hlczsKICAgIHVpbnQyNTYgcHVibGljIGhhc2hlc1VzZWQ7CiAgICB1aW50MjU2IHB1YmxpYyBhcXVhcml1bUNvc3QgPSAxIGV0aGVyIC8gMTAwICogMzsvL2ZlZSBmb3IgZmlzaGluZyBzdGFydHMgYXQgMC4wMyBldGhlcgogICAgdWludDI1NiBwdWJsaWMgcmVzb2x2ZVRpbWUgPSAzMCBtaW51dGVzOy8vaG93IGxvbmcgZG9lcyB0aGUgY29udHJhY3Qgb3duZXIgaGF2ZSB0byByZXNvbHZlIGhhc2hlcwogICAgdWludDE2IHB1YmxpYyB3ZWlnaHRMb3N0UGFydExpbWl0ID0gNTsKICAgIEZpc2hiYW5rQm9vc3RlcnMgcHVibGljIGJvb3N0ZXJzOwogICAgRmlzaGJhbmtDaGVzdHMgcHVibGljIGNoZXN0czsKICAgIEZpc2hiYW5rVXRpbHMgcHJpdmF0ZSB1dGlsczsKCgogICAgbWFwcGluZyhieXRlczMyID0+IEZpc2hpbmdBdHRlbXB0KSBwdWJsaWMgcGVuZGluZ0Zpc2hpbmc7Ly9hdHRlbXB0cyB0aGF0IG5lZWQgc29sdmluZzsKCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGFwcHJvdmVkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgYWZmaWxpYXRlZDsKCiAgICBldmVudCBBcXVhcml1bUZpc2hlZCgKICAgICAgICBieXRlczMyIGhhc2gsCiAgICAgICAgYWRkcmVzcyBmaXNoZXIsCiAgICAgICAgdWludDI1NiBmZWVQYWlkCiAgICApOyAvL2V2ZW50IGJyb2FkY2F0ZWQgd2hlbiBzb21lb25lIGZpc2hlcyBpbiBhcWF1cml1bQoKICAgIGV2ZW50IEFxdWFyaXVtUmVzb2x2ZWQoYnl0ZXMzMiBoYXNoLCBhZGRyZXNzIGZpc2hlcik7CgogICAgZXZlbnQgQXR0YWNrKAogICAgICAgIHVpbnQyNTYgYXR0YWNrZXIsCiAgICAgICAgdWludDI1NiB2aWN0aW0sCiAgICAgICAgdWludDI1NiB3aW5uZXIsCiAgICAgICAgdWludDY0IHdlaWdodCwKICAgICAgICB1aW50MjU2IGFwLCB1aW50MjU2IHZwLCB1aW50MjU2IHJhbmRvbQogICAgKTsKCiAgICBldmVudCBCb29zdGVyQXBwbGllZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgYm9vc3RlcklkKTsKCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciBvZiB0aGUgY29udHJhY3QuIFNldHMgcmVzb2x2ZXIsIGJlbmVmaWNpYXJ5LCBib29zdGVycyBhbmQgY2hlc3RzCiAgICAvLy8gQHBhcmFtIF9ib29zdGVycyB0aGUgYWRkcmVzcyBvZiB0aGUgYm9vc3RlcnMgc21hcnQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2NoZXN0cyB0aGUgYWRkcmVzcyBvZiB0aGUgY2hlc3RzIHNtYXJ0IGNvbnRyYWN0CgogICAgZnVuY3Rpb24gRmlzaGJhbmsoYWRkcmVzcyBfYm9vc3RlcnMsIGFkZHJlc3MgX2NoZXN0cywgYWRkcmVzcyBfdXRpbHMpIENoZXN0c1N0b3JlKF9jaGVzdHMpIHB1YmxpYyB7CgogICAgICAgIHJlc29sdmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBiZW5lZmljaWFyeSA9IG1zZy5zZW5kZXI7CiAgICAgICAgYm9vc3RlcnMgPSBGaXNoYmFua0Jvb3N0ZXJzKF9ib29zdGVycyk7CiAgICAgICAgY2hlc3RzID0gRmlzaGJhbmtDaGVzdHMoX2NoZXN0cyk7CiAgICAgICAgdXRpbHMgPSBGaXNoYmFua1V0aWxzKF91dGlscyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTWludHMgZmlzaGVzIGFjY29yZGluZyB0byBwYXJhbXMgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcgogICAgLy8vIEBwYXJhbSBfb3duZXIgYXJyYXkgb2YgYWRkcmVzc2VzIHRoZSBmaXNoZXMgc2hvdWxkIGJlIG93bmVkIGJ5CiAgICAvLy8gQHBhcmFtIF93ZWlnaHQgYXJyYXkgb2Ygd2VpZ2h0cyBmb3IgdGhlIGZpc2hlcwogICAgLy8vIEBwYXJhbSBfcG93ZXIgYXJyYXkgb2YgcG93ZXIgbGV2ZWxzIGZvciB0aGUgZmlzaGVzCiAgICAvLy8gQHBhcmFtIF9hZ2lsaXR5IGFycmF5IG9mIGFnaWxpdHkgbGV2ZWxzIGZvciB0aGUgZmlzaGVzCiAgICAvLy8gQHBhcmFtIF9zcGVlZCBhcnJheSBvZiBzcGVlZCBsZXZlbHMgZm9yIHRoZSBmaXNoZXMKICAgIC8vLyBAcGFyYW0gX2NvbG9yIGFycmF5IG9mIGNvbG9yIHBhcmFtcyBmb3IgdGhlIGZpc2hlcwoKICAgIGZ1bmN0aW9uIG1pbnRGaXNoKGFkZHJlc3NbXSBfb3duZXIsIHVpbnQzMltdIF93ZWlnaHQsIHVpbnQ4W10gX3Bvd2VyLCB1aW50OFtdIF9hZ2lsaXR5LCB1aW50OFtdIF9zcGVlZCwgYnl0ZXMxNltdIF9jb2xvcikgb25seU1pbnRlciBwdWJsaWMgewoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfb3duZXIubGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIF9taW50RmlzaChfb3duZXJbaV0sIF93ZWlnaHRbaV0sIF9wb3dlcltpXSwgX2FnaWxpdHlbaV0sIF9zcGVlZFtpXSwgX2NvbG9yW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgSW50ZXJuYWwgbWV0aG9kIGZvciBtaW50aW5nIGEgZmlzaAogICAgLy8vIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBvZiBvd25lciBmb3IgdGhlIGZpc2gKICAgIC8vLyBAcGFyYW0gX3dlaWdodCB3ZWlnaHQgcGFyYW0gZm9yIGZpc2gKICAgIC8vLyBAcGFyYW0gX3Bvd2VyIHBvd2VyIHBhcmFtIGZvciBmaXNoCiAgICAvLy8gQHBhcmFtIF9hZ2lsaXR5IGFnaWxpdHkgcGFyYW0gZm9yIHRoZSBmaXNoCiAgICAvLy8gQHBhcmFtIF9zcGVlZCBzcGVlZCBwYXJhbSBmb3IgdGhlIGZpc2gKICAgIC8vLyBAcGFyYW0gX2NvbG9yIGNvbG9yIHBhcmFtIGZvciB0aGUgZmlzaAoKICAgIGZ1bmN0aW9uIF9taW50RmlzaChhZGRyZXNzIF9vd25lciwgdWludDMyIF93ZWlnaHQsIHVpbnQ4IF9wb3dlciwgdWludDggX2FnaWxpdHksIHVpbnQ4IF9zcGVlZCwgYnl0ZXMxNiBfY29sb3IpIGludGVybmFsIHsKCiAgICAgICAgZmlzaGVzLmxlbmd0aCArPSAxOwogICAgICAgIHVpbnQyNTYgbmV3RmlzaElkID0gZmlzaGVzLmxlbmd0aCAtIDE7CgogICAgICAgIEZpc2ggc3RvcmFnZSBuZXdGaXNoID0gZmlzaGVzW25ld0Zpc2hJZF07CgogICAgICAgIG5ld0Zpc2gub3duZXIgPSBfb3duZXI7CiAgICAgICAgbmV3RmlzaC53ZWlnaHQgPSBfd2VpZ2h0OwogICAgICAgIG5ld0Zpc2gucG93ZXIgPSBfcG93ZXI7CiAgICAgICAgbmV3RmlzaC5hZ2lsaXR5ID0gX2FnaWxpdHk7CiAgICAgICAgbmV3RmlzaC5zcGVlZCA9IF9zcGVlZDsKICAgICAgICBuZXdGaXNoLmNvbG9yID0gX2NvbG9yOwoKICAgICAgICBiYWxhbmNlc1tfb3duZXJdICsrOwoKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfb3duZXIsIG5ld0Zpc2hJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0V2VpZ2h0TG9zdFBhcnRMaW1pdCh1aW50OCBfd2VpZ2h0UGFydCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgd2VpZ2h0TG9zdFBhcnRMaW1pdCA9IF93ZWlnaHRQYXJ0OwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIGNvc3QgZm9yIGZpc2hpbmcgaW4gdGhlIGFxdWFyaXVtCiAgICAvLy8gQHBhcmFtIF9mZWUgbmV3IGZlZSBmb3IgZmlzaGluZyBpbiB3ZWkKICAgIGZ1bmN0aW9uIHNldEFxdWFyaXVtQ29zdCh1aW50MjU2IF9mZWUpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGFxdWFyaXVtQ29zdCA9IF9mZWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0cyBhZGRyZXNzIHRoYXQgcmVzb2x2ZXMgaGFzaGVzIGZvciBmaXNoaW5nIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgIC8vLyBAcGFyYW0gX3Jlc29sdmVyIGFkZHJlc3Mgb2YgdGhlIHJlc29sdmVyCiAgICBmdW5jdGlvbiBzZXRSZXNvbHZlcihhZGRyZXNzIF9yZXNvbHZlcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVzb2x2ZXIgPSBfcmVzb2x2ZXI7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIGFkZHJlc3MgZ2V0dGluZyB0aGUgcHJvY2VlZGluZ3MgZnJvbSBmaXNoaW5nIGluIHRoZSBhcXVhcml1bQogICAgLy8vIEBwYXJhbSBfYmVuZWZpY2lhcnkgYWRkcmVzcyBvZiB0aGUgbmV3IGJlbmVmaWNpYXJ5CiAgICBmdW5jdGlvbiBzZXRCZW5lZmljaWFyeShhZGRyZXNzIF9iZW5lZmljaWFyeSkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QXVjdGlvbihhZGRyZXNzIF9hdWN0aW9uKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBhdWN0aW9uID0gX2F1Y3Rpb247CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Qm9vc3RlcnMoYWRkcmVzcyBfYm9vc3RlcnMpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGJvb3N0ZXJzID0gRmlzaGJhbmtCb29zdGVycyhfYm9vc3RlcnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1pbnRlcihhZGRyZXNzIF9taW50ZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIG1pbnRlciA9IF9taW50ZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VXRpbHMoYWRkcmVzcyBfdXRpbHMpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHV0aWxzID0gRmlzaGJhbmtVdGlscyhfdXRpbHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhdGNoRmlzaEFxdWFyaXVtKHVpbnQyNTZbXSBfc2VlZHMsIGFkZHJlc3MgX2FmZmlsaWF0ZSkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3NlZWRzLmxlbmd0aCA+IDApOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGFxdWFyaXVtQ29zdCk7CiAgICAgICAgLy9tdXN0IHNlbmQgZW5vdWdoIGV0aGVyIHRvIGNvdmVyIGNvc3RzCiAgICAgICAgcmVxdWlyZShyYW5kb21IYXNoZXMubGVuZ3RoID4gaGFzaGVzVXNlZCArIF9zZWVkcy5sZW5ndGgpOwogICAgICAgIC8vdGhlcmUgbmVlZHMgdG8gYmUgYSBoYXNoIGxlZnQKCgoKICAgICAgICBpZiAobXNnLnZhbHVlID4gYXF1YXJpdW1Db3N0ICogX3NlZWRzLmxlbmd0aCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSAtIGFxdWFyaXVtQ29zdCAqIF9zZWVkcy5sZW5ndGgpOwogICAgICAgICAgICAvL3NlbmQgdG8gbXVjaCBldGhlciBiYWNrCiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfc2VlZHMubGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIF9maXNoQXF1YXJpdW0oX3NlZWRzW2ldKTsKICAgICAgICB9CgogICAgICAgIGlmKF9hZmZpbGlhdGUgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBwZW5kaW5nRmlzaGluZ1tyYW5kb21IYXNoZXNbaGFzaGVzVXNlZCAtIDFdXS5hZmZpbGlhdGUgPSBfYWZmaWxpYXRlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfZmlzaEFxdWFyaXVtKHVpbnQyNTYgX3NlZWQpIGludGVybmFsIHsKICAgICAgICAvL3RoaXMgbG9vcCBwcmV2ZW50cyBmcm9tIHVzaW5nIHRoZSBzYW1lIGhhc2ggYXMgYW5vdGhlciBmaXNoaW5nIGF0dGVtcHQgaWYgdGhlIG93bmVyIHN1Ym1pdHMgdGhlIHNhbWUgaGFzaCBtdWx0aXBsZSB0aW1lcwogICAgICAgIHdoaWxlIChwZW5kaW5nRmlzaGluZ1tyYW5kb21IYXNoZXNbaGFzaGVzVXNlZF1dLmZpc2hlciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGhhc2hlc1VzZWQrKzsKICAgICAgICAgICAgLy9pbmNyZWFzZSBoYXNoZXNVc2VkIGFuZCB0cnkgbmV4dCBvbmUKICAgICAgICB9CgogICAgICAgIEZpc2hpbmdBdHRlbXB0IHN0b3JhZ2UgbmV3QXR0ZW1wdCA9IHBlbmRpbmdGaXNoaW5nW3JhbmRvbUhhc2hlc1toYXNoZXNVc2VkXV07CgogICAgICAgIG5ld0F0dGVtcHQuZmlzaGVyID0gbXNnLnNlbmRlcjsKICAgICAgICBuZXdBdHRlbXB0LmZlZVBhaWQgPSBhcXVhcml1bUNvc3Q7CiAgICAgICAgLy9zZXQgdGhlIGZlZSBwYWlkIHNvIGl0IGNhbiBiZSByZXR1cm5lZCBpZiB0aGUgaGFzaCBkb2Vzbid0IGdldCByZXNvbHZlZCBmYXN0IGVub3VnaAogICAgICAgIG5ld0F0dGVtcHQuc2VlZCA9IF9zZWVkOwogICAgICAgIC8vc2V0cyB0aGUgc2VlZCB0aGF0IGdldHMgY29tYmluZWQgd2l0aCB0aGUgcmFuZG9tIHNlZWQgb2YgdGhlIG93bmVyCiAgICAgICAgbmV3QXR0ZW1wdC5kZWFkbGluZSA9IHVpbnQ2NChub3cgKyByZXNvbHZlVGltZSk7CiAgICAgICAgLy9zYXZlcyBkZWFkbGluZSBhZnRlciB3aGljaCB0aGUgZmlzaGVyIGNhbiByZWRlZW0gaGlzIGZpc2hpbmcgZmVlCgogICAgICAgIGhhc2hlc1VzZWQrKzsKICAgICAgICAvL2luY3JlYXNlIGhhc2hlcyB1c2VkIHNvIGl0IGNhbm5vdCBiZSB1c2VkIGFnYWluCgogICAgICAgIEFxdWFyaXVtRmlzaGVkKHJhbmRvbUhhc2hlc1toYXNoZXNVc2VkIC0gMV0sIG1zZy5zZW5kZXIsIGFxdWFyaXVtQ29zdCk7CiAgICAgICAgLy9icm9hZGNhc3QgZXZlbnQKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxsIHRoaXMgdG8gcmVzb2x2ZSBoYXNoZXMgYW5kIGdlbmVyYXRlIGZpc2gvY2hlc3RzCiAgICAvLy8gQHBhcmFtIF9zZWVkIHNlZWQgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgaGFzaAogICAgZnVuY3Rpb24gX3Jlc29sdmVBcXVhcml1bSh1aW50MjU2IF9zZWVkKSBpbnRlcm5hbCB7CiAgICAgICAgYnl0ZXMzMiB0ZW1wSGFzaCA9IGtlY2NhazI1Nihfc2VlZCk7CiAgICAgICAgRmlzaGluZ0F0dGVtcHQgc3RvcmFnZSB0ZW1wQXR0ZW1wdCA9IHBlbmRpbmdGaXNoaW5nW3RlbXBIYXNoXTsKCiAgICAgICAgcmVxdWlyZSh0ZW1wQXR0ZW1wdC5maXNoZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy9hdHRlbXB0IG11c3QgYmUgc2V0IHNvIHdlIGxvb2sgaWYgZmlzaGVyIGlzIHNldAoKICAgICAgICBpZiAodGVtcEF0dGVtcHQuYWZmaWxpYXRlICE9IGFkZHJlc3MoMCkgJiYgIWFmZmlsaWF0ZWRbdGVtcEF0dGVtcHQuZmlzaGVyXSkgey8vaWYgYWZmaWxpYXRlIGlzIHNldAogICAgICAgICAgICBjaGVzdHMubWludENoZXN0KHRlbXBBdHRlbXB0LmFmZmlsaWF0ZSwgMSwgMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIC8vQ2hlc3Qgd2l0aCBvbmUgcmFuZG9tIGJvb3N0ZXIKICAgICAgICAgICAgYWZmaWxpYXRlZFt0ZW1wQXR0ZW1wdC5maXNoZXJdID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHVpbnQzMls0XSBtZW1vcnkgZmlzaFBhcmFtcyA9IHV0aWxzLmdldEZpc2hQYXJhbXMoX3NlZWQsIHRlbXBBdHRlbXB0LnNlZWQsIGZpc2hlcy5sZW5ndGgsIGJsb2NrLmNvaW5iYXNlKTsKCiAgICAgICAgX21pbnRGaXNoKHRlbXBBdHRlbXB0LmZpc2hlciwgZmlzaFBhcmFtc1szXSwgdWludDgoZmlzaFBhcmFtc1swXSksIHVpbnQ4KGZpc2hQYXJhbXNbMV0pLCB1aW50OChmaXNoUGFyYW1zWzJdKSwgYnl0ZXMxNihrZWNjYWsyNTYoX3NlZWQgXiB0ZW1wQXR0ZW1wdC5zZWVkKSkpOwoKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2Zlcih0ZW1wQXR0ZW1wdC5mZWVQYWlkKTsKICAgICAgICBBcXVhcml1bVJlc29sdmVkKHRlbXBIYXNoLCB0ZW1wQXR0ZW1wdC5maXNoZXIpOwogICAgICAgIC8vYnJvYWRjYXN0IGV2ZW50CgogICAgICAgIGRlbGV0ZSBwZW5kaW5nRmlzaGluZ1t0ZW1wSGFzaF07CiAgICAgICAgLy9kZWxldGUgZmlzaGluZyBhdHRlbXB0CiAgICB9CgogICAgLy8vIEBub3RpY2UgQmF0Y2ggcmVzb2x2ZSBmaXNoaW5nIGF0dGVtcHRzCiAgICAvLy8gQHBhcmFtIF9zZWVkcyBhcnJheSBvZiBzZWVkcyB0aGF0IGNvcnJlc3BvbmQgdG8gaGFzaGVzIHRoYXQgbmVlZCByZXNvbHZpbmcKICAgIGZ1bmN0aW9uIGJhdGNoUmVzb2x2ZUFxdWFyaXVtKHVpbnQyNTZbXSBfc2VlZHMpIG9ubHlSZXNvbHZlciBwdWJsaWMgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9zZWVkcy5sZW5ndGg7IGkgKyspIHsKICAgICAgICAgICAgX3Jlc29sdmVBcXVhcml1bShfc2VlZHNbaV0pOwogICAgICAgIH0KICAgIH0KCgogICAgLy8vIEBub3RpY2UgQWRkcyBhbiBhcnJheSBvZiBoYXNoZXMgdG8gYmUgdXNlZCBmb3IgcmVzb2x2aW5nCiAgICAvLy8gQHBhcmFtIF9oYXNoZXMgYXJyYXkgb2YgaGFzaGVzIHRvIGFkZAogICAgZnVuY3Rpb24gYWRkSGFzaChieXRlczMyW10gX2hhc2hlcykgb25seVJlc29sdmVyIHB1YmxpYyB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2hhc2hlcy5sZW5ndGg7IGkgKyspIHsKICAgICAgICAgICAgcmFuZG9tSGFzaGVzLnB1c2goX2hhc2hlc1tpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbGwgdGhpcyBmdW5jdGlvbiB0byBhdHRhY2sgYW5vdGhlciBmaXNoCiAgICAvLy8gQHBhcmFtIF9hdHRhY2tlciBJRCBvZiBmaXNoIHRoYXQgaXMgYXR0YWNraW5nCiAgICAvLy8gQHBhcmFtIF92aWN0aW0gSUQgb2YgZmlzaCB0byBhdHRhY2sKICAgIGZ1bmN0aW9uIGF0dGFjayh1aW50MjU2IF9hdHRhY2tlciwgdWludDI1NiBfdmljdGltKSBvbmx5RmlzaE93bmVyKF9hdHRhY2tlcikgcHVibGljIHsKCiAgICAgICAgRmlzaCBtZW1vcnkgYXR0YWNrZXIgPSBmaXNoZXNbX2F0dGFja2VyXTsKICAgICAgICBGaXNoIG1lbW9yeSB2aWN0aW0gPSBmaXNoZXNbX3ZpY3RpbV07CgogICAgICAgIC8vY2hlY2sgaWYgYXR0YWNrZXIgaXMgc2xlZXBpbmcKICAgICAgICBpZiAoYXR0YWNrZXIuYWN0aXZlQm9vc3RlciA9PSAyICYmIGF0dGFja2VyLmJvb3N0ZWRUaWxsID4gbm93KSB7Ly9pZiB5b3VyIGZpc2ggaXMgc2xlZXBpbmcgYXV0byBhd2FrZSBpdAogICAgICAgICAgICBmaXNoZXNbX2F0dGFja2VyXS5hY3RpdmVCb29zdGVyID0gMDsKICAgICAgICAgICAgYXR0YWNrZXIuYm9vc3RlZFRpbGwgPSB1aW50NjQobm93KTsKICAgICAgICAgICAgLy9zZXQgYm9vc3RlciB0byBpbnZhbGlkIG9uZSBzbyBpdCBoYXMgbm8gZWZmZWN0CiAgICAgICAgfQoKICAgICAgICAvL2NoZWNrIGlmIHZpY3RpbSBoYXMgYWN0aXZlIHNsZWVwaW5nIGJvb3N0ZXIKICAgICAgICByZXF1aXJlKCEoKHZpY3RpbS5hY3RpdmVCb29zdGVyID09IDIpICYmIHZpY3RpbS5ib29zdGVkVGlsbCA+PSBub3cpKTsKICAgICAgICAvL2Nhbm5vdCBhdHRhY2sgYSBzbGVlcGluZyBmaXNoCiAgICAgICAgcmVxdWlyZShub3cgPj0gYXR0YWNrZXIuY2FuRmlnaHRBZ2Fpbik7CiAgICAgICAgLy9jaGVjayBpZiBhdHRhY2tpbmcgZmlzaCBpcyBjb29sZWQgZG93bgogICAgICAgIHJlcXVpcmUobm93ID49IHZpY3RpbS5jYW5CZUF0dGFja2VkQWdhaW4pOwogICAgICAgIC8vY2hlY2sgaWYgdmljdGltIGZpc2ggY2FuIGJlIGF0dGFja2VkIGFnYWluCgoKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSB2aWN0aW0ub3duZXIpIHsKICAgICAgICAgICAgdWludDY0IHdlaWdodCA9IGF0dGFja2VyLndlaWdodCA8IHZpY3RpbS53ZWlnaHQgPyBhdHRhY2tlci53ZWlnaHQgOiB2aWN0aW0ud2VpZ2h0OwogICAgICAgICAgICBmaXNoZXNbX2F0dGFja2VyXS53ZWlnaHQgKz0gd2VpZ2h0OwogICAgICAgICAgICBmaXNoZXNbX3ZpY3RpbV0ud2VpZ2h0IC09IHdlaWdodDsKICAgICAgICAgICAgZmlzaGVzW19hdHRhY2tlcl0uY2FuRmlnaHRBZ2FpbiA9IHVpbnQ2NCh1dGlscy5nZXRDb29sZG93bihhdHRhY2tlci5zcGVlZCkpOwoKICAgICAgICAgICAgaWYgKGZpc2hlc1tfdmljdGltXS53ZWlnaHQgPT0gMCkgewogICAgICAgICAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIGFkZHJlc3MoMCksIF92aWN0aW0pOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbZmlzaGVzW192aWN0aW1dLm93bmVyXSAtLTsKICAgICAgICAgICAgICAgIC8vYnVybiB0b2tlbgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZmlzaGVzW192aWN0aW1dLmNhbkJlQXR0YWNrZWRBZ2FpbiA9IHVpbnQ2NChub3cgKyAxIGhvdXJzKTsKICAgICAgICAgICAgICAgIC8vc2V0IHZpY3RpbSBjb29sZG93biAxIGhvdXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQXR0YWNrKF9hdHRhY2tlciwgX3ZpY3RpbSwgX2F0dGFja2VyLCB3ZWlnaHQsIDAsIDAsIDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodmljdGltLndlaWdodCA8IDIgfHwgYXR0YWNrZXIud2VpZ2h0IDwgMikgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgLy9yZXZlcnQgaWYgb25lIG9mIHRoZSBmaXNoIGlzIGJlbG93IGZpZ2h0aW5nIHdlaWdodAogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBBUCA9IGdldEZpZ2h0aW5nQW1vdW50cyhhdHRhY2tlciwgdHJ1ZSk7CiAgICAgICAgLy8gZ2V0IGF0dGFja2VyIHBvd2VyCiAgICAgICAgdWludDI1NiBWUCA9IGdldEZpZ2h0aW5nQW1vdW50cyh2aWN0aW0sIGZhbHNlKTsKICAgICAgICAvLyBnZXQgdmljdGltIHBvd2VyCgogICAgICAgIGJ5dGVzMzIgcmFuZG9tSGFzaCA9IGtlY2NhazI1NihibG9jay5jb2luYmFzZSwgYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciAtIDEpLCBmaXNoZXMubGVuZ3RoKTsKCiAgICAgICAgdWludDI1NiBtYXggPSBBUCA+IFZQID8gQVAgOiBWUDsKICAgICAgICB1aW50MjU2IGF0dGFja1JhbmdlID0gbWF4ICogMjsKICAgICAgICB1aW50MjU2IHJhbmRvbSA9IHVpbnQyNTYocmFuZG9tSGFzaCkgJSBhdHRhY2tSYW5nZSArIDE7CgogICAgICAgIHVpbnQ2NCB3ZWlnaHRMb3N0OwoKICAgICAgICBpZiAocmFuZG9tIDw9IChtYXggKyBBUCAtIFZQKSkgewogICAgICAgICAgICB3ZWlnaHRMb3N0ID0gX2hhbmRsZVdpbihfYXR0YWNrZXIsIF92aWN0aW0pOwogICAgICAgICAgICBBdHRhY2soX2F0dGFja2VyLCBfdmljdGltLCBfYXR0YWNrZXIsIHdlaWdodExvc3QsIEFQLCBWUCwgcmFuZG9tKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3ZWlnaHRMb3N0ID0gX2hhbmRsZVdpbihfdmljdGltLCBfYXR0YWNrZXIpOwogICAgICAgICAgICBBdHRhY2soX2F0dGFja2VyLCBfdmljdGltLCBfdmljdGltLCB3ZWlnaHRMb3N0LCBBUCwgVlAsIHJhbmRvbSk7CiAgICAgICAgICAgIC8vYnJvYWRjYXN0IGV2ZW50CiAgICAgICAgfQoKICAgICAgICBmaXNoZXNbX2F0dGFja2VyXS5jYW5GaWdodEFnYWluID0gdWludDY0KHV0aWxzLmdldENvb2xkb3duKGF0dGFja2VyLnNwZWVkKSk7CiAgICAgICAgZmlzaGVzW192aWN0aW1dLmNhbkJlQXR0YWNrZWRBZ2FpbiA9IHVpbnQ2NChub3cgKyAxIGhvdXJzKTsKICAgICAgICAvL3NldCB2aWN0aW0gY29vbGRvd24gMSBob3VyCiAgICB9CgogICAgLy8vIEBub3RpY2UgSGFuZGxlcyBsb3N0IGdhaW5lZCB3ZWlnaHQgYWZ0ZXIgZmlnaHQKICAgIC8vLyBAcGFyYW0gX3dpbm5lciB0aGUgd2lubmVyIG9mIHRoZSBmaWdodAogICAgLy8vIEBwYXJhbSBfbG9zZXIgdGhlIGxvc2VyIG9mIHRoZSBmaWdodAogICAgZnVuY3Rpb24gX2hhbmRsZVdpbih1aW50MjU2IF93aW5uZXIsIHVpbnQyNTYgX2xvc2VyKSBpbnRlcm5hbCByZXR1cm5zICh1aW50NjQpIHsKICAgICAgICBGaXNoIHN0b3JhZ2Ugd2lubmVyID0gZmlzaGVzW193aW5uZXJdOwogICAgICAgIEZpc2ggc3RvcmFnZSBsb3NlciA9IGZpc2hlc1tfbG9zZXJdOwoKICAgICAgICB1aW50NjQgZnVsbFdlaWdodExvc3QgPSBsb3Nlci53ZWlnaHQgLyBzcXJ0KHdpbm5lci53ZWlnaHQpOwogICAgICAgIHVpbnQ2NCBtYXhXZWlnaHRMb3N0ID0gbG9zZXIud2VpZ2h0IC8gd2VpZ2h0TG9zdFBhcnRMaW1pdDsKCiAgICAgICAgdWludDY0IHdlaWdodExvc3QgPSBtYXhXZWlnaHRMb3N0IDwgZnVsbFdlaWdodExvc3QgPyBtYXhXZWlnaHRMb3N0IDogZnVsbFdlaWdodExvc3Q7CgogICAgICAgIGlmICh3ZWlnaHRMb3N0IDwgMSkgewogICAgICAgICAgICB3ZWlnaHRMb3N0ID0gMTsKICAgICAgICAgICAgLy8gTWluaW11bSAxCiAgICAgICAgfQoKICAgICAgICB3aW5uZXIud2VpZ2h0ICs9IHdlaWdodExvc3Q7CiAgICAgICAgbG9zZXIud2VpZ2h0IC09IHdlaWdodExvc3Q7CgogICAgICAgIHJldHVybiB3ZWlnaHRMb3N0OwogICAgfQoKICAgIC8vLyBAbm90aWNlIGdldCBhdHRhY2sgYW5kIGRlZmVuY2UgZnJvbSBmaXNoCiAgICAvLy8gQHBhcmFtIF9maXNoIGlzIEZpc2ggdG9rZW4KICAgIC8vLyBAcGFyYW0gX2lzX2F0dGFja2VyIHRydWUgaWYgZmlzaCBpcyBhdHRhY2tlciBvdGhlcndpc2UgZmFsc2UKICAgIGZ1bmN0aW9uIGdldEZpZ2h0aW5nQW1vdW50cyhGaXNoIF9maXNoLCBib29sIF9pc19hdHRhY2tlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKGdldEZpc2hQb3dlcihfZmlzaCkgKiAoX2lzX2F0dGFja2VyID8gNjAgOiA0MCkgKyBnZXRGaXNoQWdpbGl0eShfZmlzaCkgKiAoX2lzX2F0dGFja2VyID8gNDAgOiA2MCkpICogX2Zpc2gud2VpZ2h0OwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFwcGx5IGEgYm9vc3RlciB0byBhIGZpc2gKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgdGhlIGZpc2ggdGhlIGJvb3N0ZXIgc2hvdWxkIGJlIGFwcGxpZWQgdG8KICAgIC8vLyBAcGFyYW0gX2Jvb3N0ZXIgdGhlIElkIG9mIHRoZSBib29zdGVyIHRoZSB0b2tlbiBzaG91bGQgYmUgYXBwbGllZCB0bwogICAgZnVuY3Rpb24gYXBwbHlCb29zdGVyKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2Jvb3N0ZXIpIG9ubHlGaXNoT3duZXIoX3Rva2VuSWQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJvb3N0ZXJzLm93bmVyT2YoX2Jvb3N0ZXIpKTsKICAgICAgICAvL29ubHkgb3duZXIgY2FuIGRvIHRoaXMKICAgICAgICByZXF1aXJlKGJvb3N0ZXJzLmdldEJvb3N0ZXJBbW91bnQoX2Jvb3N0ZXIpID49IDEpOwogICAgICAgIEZpc2ggc3RvcmFnZSB0ZW1wRmlzaCA9IGZpc2hlc1tfdG9rZW5JZF07CiAgICAgICAgdWludDggYm9vc3RlclR5cGUgPSB1aW50OChib29zdGVycy5nZXRCb29zdGVyVHlwZShfYm9vc3RlcikpOwoKICAgICAgICBpZiAoYm9vc3RlclR5cGUgPT0gMSB8fCBib29zdGVyVHlwZSA9PSAyIHx8IGJvb3N0ZXJUeXBlID09IDMpIHsvL2lmIGJvb3N0ZXIgaXMgYXR0YWNrIG9yIGFnaWxpdHkgb3Igc2xlZXAKICAgICAgICAgICAgdGVtcEZpc2guYm9vc3RlclN0cmVuZ3RoID0gYm9vc3RlcnMuZ2V0Qm9vc3RlclN0cmVuZ3RoKF9ib29zdGVyKTsKICAgICAgICAgICAgdGVtcEZpc2guYWN0aXZlQm9vc3RlciA9IGJvb3N0ZXJUeXBlOwogICAgICAgICAgICB0ZW1wRmlzaC5ib29zdGVkVGlsbCA9IGJvb3N0ZXJzLmdldEJvb3N0ZXJEdXJhdGlvbihfYm9vc3RlcikgKiBib29zdGVycy5nZXRCb29zdGVyQW1vdW50KF9ib29zdGVyKSArIHVpbnQ2NChub3cpOwogICAgICAgICAgICB0ZW1wRmlzaC5ib29zdGVyUmFpc2VWYWx1ZSA9IGJvb3N0ZXJzLmdldEJvb3N0ZXJSYWlzZVZhbHVlKF9ib29zdGVyKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYm9vc3RlclR5cGUgPT0gNCkgey8vd2F0Y2ggYm9vc3RlcgogICAgICAgICAgICByZXF1aXJlKHRlbXBGaXNoLmJvb3N0ZWRUaWxsID4gdWludDY0KG5vdykpOwogICAgICAgICAgICAvL3JldmVydCBvbiB1c2luZyB3YXRjaCBvbiBib29zdGVyIHRoYXQgaGFzIHBhc3NlZDsKICAgICAgICAgICAgdGVtcEZpc2guYm9vc3RlclN0cmVuZ3RoID0gYm9vc3RlcnMuZ2V0Qm9vc3RlclN0cmVuZ3RoKF9ib29zdGVyKTsKICAgICAgICAgICAgdGVtcEZpc2guYm9vc3RlZFRpbGwgKz0gYm9vc3RlcnMuZ2V0Qm9vc3RlckR1cmF0aW9uKF9ib29zdGVyKSAqIGJvb3N0ZXJzLmdldEJvb3N0ZXJBbW91bnQoX2Jvb3N0ZXIpOwogICAgICAgICAgICAvL2FkZCB0aW1lIHRvIGJvb3N0ZXIKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYm9vc3RlclR5cGUgPT0gNSkgey8vSW5zdGFudCBhdHRhY2sKICAgICAgICAgICAgcmVxdWlyZShib29zdGVycy5nZXRCb29zdGVyQW1vdW50KF9ib29zdGVyKSA9PSAxKTsKICAgICAgICAgICAgLy9DYW4gYXBwbHkgb25seSBvbmUgaW5zdGFudCBhdHRhY2sgYm9vc3RlcgogICAgICAgICAgICB0ZW1wRmlzaC5jYW5GaWdodEFnYWluID0gMDsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoYm9vc3RlcnMudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGFkZHJlc3MoMCksIF9ib29zdGVyKSk7CiAgICAgICAgLy9idXJuIGJvb3N0ZXIKCiAgICAgICAgQm9vc3RlckFwcGxpZWQoX3Rva2VuSWQsIF9ib29zdGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBzcXVhcmUgcm9vdCBmdW5jdGlvbiB1c2VkIGZvciB3ZWlnaHQgZ2Fpbi9sb3NzCiAgICAvLy8gQHBhcmFtIHggdWludDY0IHRvIGdldCBzcXVhcmUgcm9vdCBmcm9tCiAgICBmdW5jdGlvbiBzcXJ0KHVpbnQ2NCB4KSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQ2NCB5KSB7CiAgICAgICAgdWludDY0IHogPSAoeCArIDEpIC8gMjsKICAgICAgICB5ID0geDsKICAgICAgICB3aGlsZSAoeiA8IHkpIHsKICAgICAgICAgICAgeSA9IHo7CiAgICAgICAgICAgIHogPSAoeCAvIHogKyB6KSAvIDI7CiAgICAgICAgfQogICAgfQoKICAgIC8vdXRsaXRpeSBmdW5jdGlvbiBmb3IgZWFzeSB0ZXN0aW5nIGNhbiBiZSByZW1vdmVkIGxhdGVyCiAgICBmdW5jdGlvbiBkb0tlY2NhazI1Nih1aW50MjU2IF9pbnB1dCkgcHVyZSBwdWJsaWMgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoX2lucHV0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRGaXNoUG93ZXIoRmlzaCBfZmlzaCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjQgcG93ZXIpIHsKICAgICAgICBwb3dlciA9IF9maXNoLnBvd2VyOwogICAgICAgIGlmIChfZmlzaC5hY3RpdmVCb29zdGVyID09IDEgJiYgX2Zpc2guYm9vc3RlZFRpbGwgPiBub3cpIHsvLyBjaGVjayBpZiBib29zdGVyIGFjdGl2ZQogICAgICAgICAgICB1aW50MjQgYm9vc3RlclBvd2VyID0gKDEwICogX2Zpc2guYm9vc3RlclN0cmVuZ3RoICsgX2Zpc2guYm9vc3RlclJhaXNlVmFsdWUgKyAxMDApICogcG93ZXIgLyAxMDAgLSBwb3dlcjsKICAgICAgICAgICAgaWYgKGJvb3N0ZXJQb3dlciA8IDEgJiYgX2Zpc2guYm9vc3RlclN0cmVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgIHBvd2VyICs9IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYm9vc3RlclBvd2VyIDwgMyAmJiBfZmlzaC5ib29zdGVyU3RyZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgcG93ZXIgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChib29zdGVyUG93ZXIgPCA1ICYmIF9maXNoLmJvb3N0ZXJTdHJlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgICAgICBwb3dlciArPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG93ZXIgPSBib29zdGVyUG93ZXIgKyBwb3dlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRGaXNoQWdpbGl0eShGaXNoIF9maXNoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNCBhZ2lsaXR5KSB7CiAgICAgICAgYWdpbGl0eSA9IF9maXNoLmFnaWxpdHk7CiAgICAgICAgaWYgKF9maXNoLmFjdGl2ZUJvb3N0ZXIgPT0gMyAmJiBfZmlzaC5ib29zdGVkVGlsbCA+IG5vdykgey8vIGNoZWNrIGlmIGJvb3N0ZXIgYWN0aXZlCiAgICAgICAgICAgIHVpbnQyNCBib29zdGVyUG93ZXIgPSAoMTAgKiBfZmlzaC5ib29zdGVyU3RyZW5ndGggKyBfZmlzaC5ib29zdGVyUmFpc2VWYWx1ZSArIDEwMCkgKiBhZ2lsaXR5IC8gMTAwIC0gYWdpbGl0eTsKICAgICAgICAgICAgaWYgKGJvb3N0ZXJQb3dlciA8IDEgJiYgX2Zpc2guYm9vc3RlclN0cmVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgIGFnaWxpdHkgKz0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChib29zdGVyUG93ZXIgPCAzICYmIF9maXNoLmJvb3N0ZXJTdHJlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICBhZ2lsaXR5ICs9IDM7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYm9vc3RlclBvd2VyIDwgNSAmJiBfZmlzaC5ib29zdGVyU3RyZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgYWdpbGl0eSArPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWdpbGl0eSA9IGJvb3N0ZXJQb3dlciArIGFnaWxpdHk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8vRVJDNzIxIGZ1bmN0aW9uYWxpdHkKICAgIC8vY291bGQgc3BsaXQgdGhpcyB0byBhIGRpZmZlcmVudCBjb250cmFjdCBidXQgZG9lc24ndCBtYWtlIGl0IGVhc2llciB0byByZWFkCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiBpbmRleGVkIHRva2VuSWQpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBpbmRleGVkIHRva2VuSWQpOwoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCkgewogICAgICAgIHRvdGFsID0gZmlzaGVzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSl7CiAgICAgICAgYmFsYW5jZSA9IGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKXsKICAgICAgICBvd25lciA9IGZpc2hlc1tfdG9rZW5JZF0ub3duZXI7CiAgICB9CgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShmaXNoZXNbX3Rva2VuSWRdLm93bmVyID09IF9mcm9tKTsKICAgICAgICAvL2NhbiBvbmx5IHRyYW5zZmVyIGlmIHByZXZpb3VzIG93bmVyIGVxdWFscyBmcm9tCiAgICAgICAgZmlzaGVzW190b2tlbklkXS5vd25lciA9IF90bzsKICAgICAgICBhcHByb3ZlZFtfdG9rZW5JZF0gPSBhZGRyZXNzKDApOwogICAgICAgIC8vcmVzZXQgYXBwcm92ZWQgb2YgZmlzaCBvbiBldmVyeSB0cmFuc2ZlcgogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSAxOwogICAgICAgIC8vdW5kZXJmbG93IGNhbiBvbmx5IGhhcHBlbiBvbiAweAogICAgICAgIGJhbGFuY2VzW190b10gKz0gMTsKICAgICAgICAvL292ZXJmbG93cyBvbmx5IHdpdGggdmVyeSB2ZXJ5IGxhcmdlIGFtb3VudHMgb2YgZmlzaAogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljCiAgICBvbmx5RmlzaE93bmVyKF90b2tlbklkKSAvL2NoZWNrIGlmIG1zZy5zZW5kZXIgaXMgdGhlIG93bmVyIG9mIHRoaXMgZmlzaAogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgLy9hZnRlciBtYXN0ZXIgbW9kaWZpZXIgaW52b2tlIGludGVybmFsIHRyYW5zZmVyCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljCiAgICBvbmx5RmlzaE93bmVyKF90b2tlbklkKQogICAgewogICAgICAgIGFwcHJvdmVkW190b2tlbklkXSA9IF90bzsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlZFtfdG9rZW5JZF0gPT0gbXNnLnNlbmRlciB8fCBtc2cuc2VuZGVyID09IGF1Y3Rpb24pOwogICAgICAgIEZpc2ggc3RvcmFnZSBmaXNoID0gZmlzaGVzW190b2tlbklkXTsKCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYXVjdGlvbikgewogICAgICAgICAgICBmaXNoLmFjdGl2ZUJvb3N0ZXIgPSAyOwogICAgICAgICAgICAvL0ZyZWV6ZSBmb3IgYXVjdGlvbgogICAgICAgICAgICBmaXNoLmJvb3N0ZWRUaWxsID0gdWludDY0KG5vdyArIDcgZGF5cyk7CiAgICAgICAgICAgIGZpc2guYm9vc3RlclN0cmVuZ3RoID0gMTsKICAgICAgICB9CiAgICAgICAgLy9yZXF1aXJlIG1zZy5zZW5kZXIgdG8gYmUgYXBwcm92ZWQgZm9yIHRoaXMgdG9rZW4KICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgICAgIC8vaGFuZGxlcyBldmVudCwgYmFsYW5jZXMgYW5kIGFwcHJvdmFsIHJlc2V0CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoYXBwcm92ZWRbX3Rva2VuSWRdID09IG1zZy5zZW5kZXIpOwogICAgICAgIF90cmFuc2Zlcihvd25lck9mKF90b2tlbklkKSwgbXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKfQ=='.
	

]
