Class {
	#name : #SRTe919d801cc95b9dc6be99889104119c21d273aaa,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe919d801cc95b9dc6be99889104119c21d273aaa >> base64 [
	^ 'Ly9GaWxlOiBub2RlX21vZHVsZXMvbGlxdWlkcGxlZGdpbmcvY29udHJhY3RzL0lMaXF1aWRQbGVkZ2luZ1BsdWdpbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmRpIEJheWxpbmEKICAgIENvbnRyaWJ1dG9yOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImYzOTI5NzgxOWE5MmIzOTA5Yzk3OTY5MDljOWQ4Nzk2OGI4N2RkOWE5YyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCgovLy8gQGRldiBgSUxpcXVpZFBsZWRnaW5nUGx1Z2luYCBpcyB0aGUgYmFzaWMgaW50ZXJmYWNlIGZvciBhbnkKLy8vICBsaXF1aWQgcGxlZGdpbmcgcGx1Z2luCmNvbnRyYWN0IElMaXF1aWRQbGVkZ2luZ1BsdWdpbiB7CgogICAgLy8vIEBub3RpY2UgUGx1Z2lucyBhcmUgdXNlZCAobXVjaCBsaWtlIHdlYiBob29rcykgdG8gaW5pdGlhdGUgYW4gYWN0aW9uCiAgICAvLy8gIHVwb24gYW55IGRvbmF0aW9uLCBkZWxlZ2F0aW9uLCBvciB0cmFuc2ZlcjsgdGhpcyBpcyBhbiBvcHRpb25hbCBmZWF0dXJlCiAgICAvLy8gIGFuZCBhbGxvd3MgZm9yIGV4dHJlbWUgY3VzdG9taXphdGlvbiBvZiB0aGUgY29udHJhY3QuIFRoaXMgZnVuY3Rpb24KICAgIC8vLyAgaW1wbGVtZW50cyBhbnkgYWN0aW9uIHRoYXQgc2hvdWxkIGJlIGluaXRpYXRlZCBiZWZvcmUgYSB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gcGxlZGdlTWFuYWdlciBUaGUgYWRtaW4gb3IgY3VycmVudCBtYW5hZ2VyIG9mIHRoZSBwbGVkZ2UKICAgIC8vLyBAcGFyYW0gcGxlZGdlRnJvbSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIHdpbGwgYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gcGxlZGdlVG8gVGhpcyBpcyB0aGUgSWQgdGhhdCB2YWx1ZSB3aWxsIGJlIHRyYW5zZmVyZWQgdG8uICAgIAogICAgLy8vIEBwYXJhbSBjb250ZXh0IFRoZSBzaXR1YXRpb24gdGhhdCBpcyB0cmlnZ2VyaW5nIHRoZSBwbHVnaW46CiAgICAvLy8gIDAgLT4gUGx1Z2luIGZvciB0aGUgb3duZXIgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDEgLT4gUGx1Z2luIGZvciB0aGUgZmlyc3QgZGVsZWdhdGUgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDIgLT4gUGx1Z2luIGZvciB0aGUgc2Vjb25kIGRlbGVnYXRlIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAuLi4KICAgIC8vLyAgMjU1IC0+IFBsdWdpbiBmb3IgdGhlIGludGVuZGVkUHJvamVjdCB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLwogICAgLy8vICAyNTYgLT4gUGx1Z2luIGZvciB0aGUgb3duZXIgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDI1NyAtPiBQbHVnaW4gZm9yIHRoZSBmaXJzdCBkZWxlZ2F0ZSByZWNlaXZpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgMjU4IC0+IFBsdWdpbiBmb3IgdGhlIHNlY29uZCBkZWxlZ2F0ZSByZWNlaXZpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgLi4uCiAgICAvLy8gIDUxMSAtPiBQbHVnaW4gZm9yIHRoZSBpbnRlbmRlZFByb2plY3QgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gYmVmb3JlVHJhbnNmZXIoCiAgICAgICAgdWludDY0IHBsZWRnZU1hbmFnZXIsCiAgICAgICAgdWludDY0IHBsZWRnZUZyb20sCiAgICAgICAgdWludDY0IHBsZWRnZVRvLAogICAgICAgIHVpbnQ2NCBjb250ZXh0LAogICAgICAgIHVpbnQgYW1vdW50ICkgcmV0dXJucyAodWludCBtYXhBbGxvd2VkKTsKCiAgICAvLy8gQG5vdGljZSBQbHVnaW5zIGFyZSB1c2VkIChtdWNoIGxpa2Ugd2ViIGhvb2tzKSB0byBpbml0aWF0ZSBhbiBhY3Rpb24KICAgIC8vLyAgdXBvbiBhbnkgZG9uYXRpb24sIGRlbGVnYXRpb24sIG9yIHRyYW5zZmVyOyB0aGlzIGlzIGFuIG9wdGlvbmFsIGZlYXR1cmUKICAgIC8vLyAgYW5kIGFsbG93cyBmb3IgZXh0cmVtZSBjdXN0b21pemF0aW9uIG9mIHRoZSBjb250cmFjdC4gVGhpcyBmdW5jdGlvbgogICAgLy8vICBpbXBsZW1lbnRzIGFueSBhY3Rpb24gdGhhdCBzaG91bGQgYmUgaW5pdGlhdGVkIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIHBsZWRnZU1hbmFnZXIgVGhlIGFkbWluIG9yIGN1cnJlbnQgbWFuYWdlciBvZiB0aGUgcGxlZGdlCiAgICAvLy8gQHBhcmFtIHBsZWRnZUZyb20gVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSB3aWxsIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIHBsZWRnZVRvIFRoaXMgaXMgdGhlIElkIHRoYXQgdmFsdWUgd2lsbCBiZSB0cmFuc2ZlcmVkIHRvLiAgICAKICAgIC8vLyBAcGFyYW0gY29udGV4dCBUaGUgc2l0dWF0aW9uIHRoYXQgaXMgdHJpZ2dlcmluZyB0aGUgcGx1Z2luOgogICAgLy8vICAwIC0+IFBsdWdpbiBmb3IgdGhlIG93bmVyIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAxIC0+IFBsdWdpbiBmb3IgdGhlIGZpcnN0IGRlbGVnYXRlIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyIC0+IFBsdWdpbiBmb3IgdGhlIHNlY29uZCBkZWxlZ2F0ZSB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgLi4uCiAgICAvLy8gIDI1NSAtPiBQbHVnaW4gZm9yIHRoZSBpbnRlbmRlZFByb2plY3QgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8KICAgIC8vLyAgMjU2IC0+IFBsdWdpbiBmb3IgdGhlIG93bmVyIHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyNTcgLT4gUGx1Z2luIGZvciB0aGUgZmlyc3QgZGVsZWdhdGUgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDI1OCAtPiBQbHVnaW4gZm9yIHRoZSBzZWNvbmQgZGVsZWdhdGUgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIC4uLgogICAgLy8vICA1MTEgLT4gUGx1Z2luIGZvciB0aGUgaW50ZW5kZWRQcm9qZWN0IHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdmFsdWUgdGhhdCB3aWxsIGJlIHRyYW5zZmVyZWQuCiAgICBmdW5jdGlvbiBhZnRlclRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBwbGVkZ2VNYW5hZ2VyLAogICAgICAgIHVpbnQ2NCBwbGVkZ2VGcm9tLAogICAgICAgIHVpbnQ2NCBwbGVkZ2VUbywKICAgICAgICB1aW50NjQgY29udGV4dCwKICAgICAgICB1aW50IGFtb3VudAogICAgKTsKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvZ2l2ZXRoLWNvbW1vbi1jb250cmFjdHMvY29udHJhY3RzL093bmVkLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCgovLy8gQHRpdGxlIE93bmVkCi8vLyBAYXV0aG9yIEFkcmkmIzIyNDsgTWFzc2FuZXQgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYTVjNGMxZDdjY2M0ZTVjNmNhYzFjMGM2Y2FjYmQxYzBkZGQxOGJjY2NhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vIEBub3RpY2UgVGhlIE93bmVkIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgCi8vLyAgYXV0aG9yaXphdGlvbiBjb250cm9sIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzICYgdGhlIGltcGxlbWVudGF0aW9uIG9mCi8vLyAgdXNlciBwZXJtaXNzaW9uczsgdGhpcyBjb250cmFjdCBoYXMgdGhyZWUgd29yayBmbG93cyBmb3IgYSBjaGFuZ2UgaW4KLy8vICBvd25lcnNoaXAsIHRoZSBmaXJzdCByZXF1aXJlcyB0aGUgbmV3IG93bmVyIHRvIHZhbGlkYXRlIHRoYXQgdGhleSBoYXZlIHRoZQovLy8gIGFiaWxpdHkgdG8gYWNjZXB0IG93bmVyc2hpcCwgdGhlIHNlY29uZCBhbGxvd3MgdGhlIG93bmVyc2hpcCB0byBiZQovLy8gIGRpcmVjdGx5IHRyYW5zZmVyZWQgd2l0aG91dCByZXF1aXJpbmcgYWNjZXB0YW5jZSwgYW5kIHRoZSB0aGlyZCBhbGxvd3MgZm9yCi8vLyAgdGhlIG93bmVyc2hpcCB0byBiZSByZW1vdmVkIHRvIGFsbG93IGZvciBkZWNlbnRyYWxpemF0aW9uIApjb250cmFjdCBPd25lZCB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lckNhbmRpZGF0ZTsKCiAgICBldmVudCBPd25lcnNoaXBSZXF1ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIGJ5LCBhZGRyZXNzIGluZGV4ZWQgdG8pOwogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0byk7CiAgICBldmVudCBPd25lcnNoaXBSZW1vdmVkKCk7CgogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIHNldHMgdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGVgb3duZXJgIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gT3duZWQoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQGRldiBgb3duZXJgIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbCBhIGZ1bmN0aW9uIHdpdGggdGhpcwogICAgLy8vIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgSW4gdGhpcyAxc3Qgb3B0aW9uIGZvciBvd25lcnNoaXAgdHJhbnNmZXIgYHByb3Bvc2VPd25lcnNoaXAoKWAgbXVzdAogICAgLy8vICBiZSBjYWxsZWQgZmlyc3QgYnkgdGhlIGN1cnJlbnQgYG93bmVyYCB0aGVuIGBhY2NlcHRPd25lcnNoaXAoKWAgbXVzdCBiZQogICAgLy8vICBjYWxsZWQgYnkgdGhlIGBuZXdPd25lckNhbmRpZGF0ZWAKICAgIC8vLyBAbm90aWNlIGBvbmx5T3duZXJgIFByb3Bvc2VzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEKICAgIC8vLyAgbmV3IG93bmVyCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBUaGUgYWRkcmVzcyBiZWluZyBwcm9wb3NlZCBhcyB0aGUgbmV3IG93bmVyCiAgICBmdW5jdGlvbiBwcm9wb3NlT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IF9uZXdPd25lckNhbmRpZGF0ZTsKICAgICAgICBPd25lcnNoaXBSZXF1ZXN0ZWQobXNnLnNlbmRlciwgbmV3T3duZXJDYW5kaWRhdGUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgYG5ld093bmVyQ2FuZGlkYXRlYCwgYWNjZXB0cyB0aGUKICAgIC8vLyAgdHJhbnNmZXIgb2Ygb3duZXJzaGlwCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdPd25lckNhbmRpZGF0ZSk7CgogICAgICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBvd25lcjsKICAgICAgICBvd25lciA9IG5ld093bmVyQ2FuZGlkYXRlOwogICAgICAgIG5ld093bmVyQ2FuZGlkYXRlID0gMHgwOwoKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvbGRPd25lciwgb3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEluIHRoaXMgMm5kIG9wdGlvbiBmb3Igb3duZXJzaGlwIHRyYW5zZmVyIGBjaGFuZ2VPd25lcnNoaXAoKWAgY2FuCiAgICAvLy8gIGJlIGNhbGxlZCBhbmQgaXQgd2lsbCBpbW1lZGlhdGVseSBhc3NpZ24gb3duZXJzaGlwIHRvIHRoZSBgbmV3T3duZXJgCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IDB4MCk7CgogICAgICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBvd25lcjsKICAgICAgICBvd25lciA9IF9uZXdPd25lcjsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IDB4MDsKCiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob2xkT3duZXIsIG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBJbiB0aGlzIDNyZCBvcHRpb24gZm9yIG93bmVyc2hpcCB0cmFuc2ZlciBgcmVtb3ZlT3duZXJzaGlwKClgIGNhbgogICAgLy8vICBiZSBjYWxsZWQgYW5kIGl0IHdpbGwgaW1tZWRpYXRlbHkgYXNzaWduIG93bmVyc2hpcCB0byB0aGUgMHgwIGFkZHJlc3M7CiAgICAvLy8gIGl0IHJlcXVpcmVzIGEgMHhkZWNlIGJlIGlucHV0IGFzIGEgcGFyYW1ldGVyIHRvIHByZXZlbnQgYWNjaWRlbnRhbCB1c2UKICAgIC8vLyBAbm90aWNlIERlY2VudHJhbGl6ZXMgdGhlIGNvbnRyYWN0LCB0aGlzIG9wZXJhdGlvbiBjYW5ub3QgYmUgdW5kb25lIAogICAgLy8vIEBwYXJhbSBfZGFjIGAweGRhY2AgaGFzIHRvIGJlIGVudGVyZWQgZm9yIHRoaXMgZnVuY3Rpb24gdG8gd29yawogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXJzaGlwKGFkZHJlc3MgX2RhYykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfZGFjID09IDB4ZGFjKTsKICAgICAgICBvd25lciA9IDB4MDsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IDB4MDsKICAgICAgICBPd25lcnNoaXBSZW1vdmVkKCk7ICAgICAKICAgIH0KfSAKCi8vRmlsZTogbm9kZV9tb2R1bGVzL2dpdmV0aC1jb21tb24tY29udHJhY3RzL2NvbnRyYWN0cy9FUkMyMC5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBFUkMyMAogKiBAZGV2IEEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciB0b2tlbnMuCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKICovCmNvbnRyYWN0IEVSQzIwIHsKICAKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIHRvdGFsIHRva2VuIHN1cHBseQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGFjY291bnQgYmFsYW5jZSBvZiB0aGUgYWNjb3VudCB3aXRoIGFkZHJlc3MgX293bmVyCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyBfdmFsdWUgbnVtYmVyIG9mIHRva2VucyB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgX3ZhbHVlIG51bWJlciBvZiB0b2tlbnMgZnJvbSBhZGRyZXNzIF9mcm9tIHRvIGFkZHJlc3MgX3RvCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQGRldiBBbGxvd3MgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB0aGUgbXNnLnNlbmRlcidzIGFjY291bnQgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGFtb3VudCB3aGljaCBfc3BlbmRlciBpcyBzdGlsbCBhbGxvd2VkIHRvIHdpdGhkcmF3IGZyb20gX293bmVyCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL2dpdmV0aC1jb21tb24tY29udHJhY3RzL2NvbnRyYWN0cy9Fc2NhcGFibGUuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKICAgIENvbnRyaWJ1dG9yOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjI1NDQ0MTU3NGM0NDY1NDY0YTQxNDA0NjRhNGI1MTQwNWQ1MTBiNGM0YSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCgoKCgovLy8gQGRldiBgRXNjYXBhYmxlYCBpcyBhIGJhc2UgbGV2ZWwgY29udHJhY3QgYnVpbHQgb2ZmIG9mIHRoZSBgT3duZWRgCi8vLyAgY29udHJhY3Q7IGl0IGNyZWF0ZXMgYW4gZXNjYXBlIGhhdGNoIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIGNhbGxlZCBpbiBhbgovLy8gIGVtZXJnZW5jeSB0aGF0IHdpbGwgYWxsb3cgZGVzaWduYXRlZCBhZGRyZXNzZXMgdG8gc2VuZCBhbnkgZXRoZXIgb3IgdG9rZW5zCi8vLyAgaGVsZCBpbiB0aGUgY29udHJhY3QgdG8gYW4gYGVzY2FwZUhhdGNoRGVzdGluYXRpb25gIGFzIGxvbmcgYXMgdGhleSB3ZXJlCi8vLyAgbm90IGJsYWNrbGlzdGVkCmNvbnRyYWN0IEVzY2FwYWJsZSBpcyBPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBlc2NhcGVIYXRjaENhbGxlcjsKICAgIGFkZHJlc3MgcHVibGljIGVzY2FwZUhhdGNoRGVzdGluYXRpb247CiAgICBtYXBwaW5nIChhZGRyZXNzPT5ib29sKSBwcml2YXRlIGVzY2FwZUJsYWNrbGlzdDsgLy8gVG9rZW4gY29udHJhY3QgYWRkcmVzc2VzCgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBhbmQgdGhlCiAgICAvLy8gIGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyBAcGFyYW0gX2VzY2FwZUhhdGNoQ2FsbGVyIFRoZSBhZGRyZXNzIG9mIGEgdHJ1c3RlZCBhY2NvdW50IG9yIGNvbnRyYWN0CiAgICAvLy8gIHRvIGNhbGwgYGVzY2FwZUhhdGNoKClgIHRvIHNlbmQgdGhlIGV0aGVyIGluIHRoaXMgY29udHJhY3QgdG8gdGhlCiAgICAvLy8gIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBpdCB3b3VsZCBiZSBpZGVhbCB0aGF0IGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyAgY2Fubm90IG1vdmUgZnVuZHMgb3V0IG9mIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYAogICAgLy8vIEBwYXJhbSBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiBUaGUgYWRkcmVzcyBvZiBhIHNhZmUgbG9jYXRpb24gKHVzdSBhCiAgICAvLy8gIE11bHRpc2lnKSB0byBzZW5kIHRoZSBldGhlciBoZWxkIGluIHRoaXMgY29udHJhY3Q7IGlmIGEgbmV1dHJhbCBhZGRyZXNzCiAgICAvLy8gIGlzIHJlcXVpcmVkLCB0aGUgV0hHIE11bHRpc2lnIGlzIGFuIG9wdGlvbjoKICAgIC8vLyAgMHg4RmY5MjAwMjBjOEFENjczNjYxYzgxMTdmMjg1NUMzODQ3NThDNTcyIAogICAgZnVuY3Rpb24gRXNjYXBhYmxlKGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLCBhZGRyZXNzIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSBwdWJsaWMgewogICAgICAgIGVzY2FwZUhhdGNoQ2FsbGVyID0gX2VzY2FwZUhhdGNoQ2FsbGVyOwogICAgICAgIGVzY2FwZUhhdGNoRGVzdGluYXRpb24gPSBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbjsKICAgIH0KCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzc2VzIHByZWFzc2lnbmVkIGFzIGBlc2NhcGVIYXRjaENhbGxlcmAgb3IgYG93bmVyYAogICAgLy8vICBhcmUgdGhlIG9ubHkgYWRkcmVzc2VzIHRoYXQgY2FuIGNhbGwgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlFc2NhcGVIYXRjaENhbGxlck9yT3duZXIgewogICAgICAgIHJlcXVpcmUgKChtc2cuc2VuZGVyID09IGVzY2FwZUhhdGNoQ2FsbGVyKXx8KG1zZy5zZW5kZXIgPT0gb3duZXIpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgdGhlIGJsYWNrbGlzdCBvZiB0b2tlbnMgdGhhdCBhcmUgbm90IGFibGUgdG8gYmUgdGFrZW4KICAgIC8vLyAgb3V0IG9mIHRoZSBjb250cmFjdDsgY2FuIG9ubHkgYmUgZG9uZSBhdCB0aGUgZGVwbG95bWVudCwgYW5kIHRoZSBsb2dpYwogICAgLy8vICB0byBhZGQgdG8gdGhlIGJsYWNrbGlzdCB3aWxsIGJlIGluIHRoZSBjb25zdHJ1Y3RvciBvZiBhIGNoaWxkIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF90b2tlbiB0aGUgdG9rZW4gY29udHJhY3QgYWRkcmVzcyB0aGF0IGlzIHRvIGJlIGJsYWNrbGlzdGVkIAogICAgZnVuY3Rpb24gYmxhY2tsaXN0RXNjYXBlVG9rZW4oYWRkcmVzcyBfdG9rZW4pIGludGVybmFsIHsKICAgICAgICBlc2NhcGVCbGFja2xpc3RbX3Rva2VuXSA9IHRydWU7CiAgICAgICAgRXNjYXBlSGF0Y2hCbGFja2lzdGVkVG9rZW4oX3Rva2VuKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgdG8gc2VlIGlmIGBfdG9rZW5gIGlzIGluIHRoZSBibGFja2xpc3Qgb2YgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF90b2tlbiB0aGUgdG9rZW4gYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiBgX3Rva2VuYCBpcyBpbiB0aGUgYmxhY2tsaXN0IGFuZCBjYW4ndCBiZSB0YWtlbiBvdXQgb2YKICAgIC8vLyAgdGhlIGNvbnRyYWN0IHZpYSB0aGUgYGVzY2FwZUhhdGNoKClgCiAgICBmdW5jdGlvbiBpc1Rva2VuRXNjYXBhYmxlKGFkZHJlc3MgX3Rva2VuKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAhZXNjYXBlQmxhY2tsaXN0W190b2tlbl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGBlc2NhcGVIYXRjaCgpYCBzaG91bGQgb25seSBiZSBjYWxsZWQgYXMgYSBsYXN0IHJlc29ydCBpZiBhCiAgICAvLy8gc2VjdXJpdHkgaXNzdWUgaXMgdW5jb3ZlcmVkIG9yIHNvbWV0aGluZyB1bmV4cGVjdGVkIGhhcHBlbmVkCiAgICAvLy8gQHBhcmFtIF90b2tlbiB0byB0cmFuc2ZlciwgdXNlIDB4MCBmb3IgZXRoZXIKICAgIGZ1bmN0aW9uIGVzY2FwZUhhdGNoKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUVzY2FwZUhhdGNoQ2FsbGVyT3JPd25lciB7ICAgCiAgICAgICAgcmVxdWlyZShlc2NhcGVCbGFja2xpc3RbX3Rva2VuXT09ZmFsc2UpOwoKICAgICAgICB1aW50MjU2IGJhbGFuY2U7CgogICAgICAgIC8vLyBAZGV2IExvZ2ljIGZvciBldGhlcgogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgICAgIGVzY2FwZUhhdGNoRGVzdGluYXRpb24udHJhbnNmZXIoYmFsYW5jZSk7CiAgICAgICAgICAgIEVzY2FwZUhhdGNoQ2FsbGVkKF90b2tlbiwgYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8vIEBkZXYgTG9naWMgZm9yIHRva2VucwogICAgICAgIEVSQzIwIHRva2VuID0gRVJDMjAoX3Rva2VuKTsKICAgICAgICBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiwgYmFsYW5jZSkpOwogICAgICAgIEVzY2FwZUhhdGNoQ2FsbGVkKF90b2tlbiwgYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hhbmdlcyB0aGUgYWRkcmVzcyBhc3NpZ25lZCB0byBjYWxsIGBlc2NhcGVIYXRjaCgpYAogICAgLy8vIEBwYXJhbSBfbmV3RXNjYXBlSGF0Y2hDYWxsZXIgVGhlIGFkZHJlc3Mgb2YgYSB0cnVzdGVkIGFjY291bnQgb3IKICAgIC8vLyAgY29udHJhY3QgdG8gY2FsbCBgZXNjYXBlSGF0Y2goKWAgdG8gc2VuZCB0aGUgdmFsdWUgaW4gdGhpcyBjb250cmFjdCB0bwogICAgLy8vICB0aGUgYGVzY2FwZUhhdGNoRGVzdGluYXRpb25gOyBpdCB3b3VsZCBiZSBpZGVhbCB0aGF0IGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyAgY2Fubm90IG1vdmUgZnVuZHMgb3V0IG9mIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYAogICAgZnVuY3Rpb24gY2hhbmdlSGF0Y2hFc2NhcGVDYWxsZXIoYWRkcmVzcyBfbmV3RXNjYXBlSGF0Y2hDYWxsZXIpIHB1YmxpYyBvbmx5RXNjYXBlSGF0Y2hDYWxsZXJPck93bmVyIHsKICAgICAgICBlc2NhcGVIYXRjaENhbGxlciA9IF9uZXdFc2NhcGVIYXRjaENhbGxlcjsKICAgIH0KCiAgICBldmVudCBFc2NhcGVIYXRjaEJsYWNraXN0ZWRUb2tlbihhZGRyZXNzIHRva2VuKTsKICAgIGV2ZW50IEVzY2FwZUhhdGNoQ2FsbGVkKGFkZHJlc3MgdG9rZW4sIHVpbnQgYW1vdW50KTsKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvbGlxdWlkcGxlZGdpbmcvY29udHJhY3RzL0xpcXVpZFBsZWRnaW5nQmFzZS5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Ci8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQogICAgQ29udHJpYnV0b3JzOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjE5Nzg3ZDZiNzA3ODU5N2E3NjdkN2M3YTc2Nzc2ZDdjNjE2ZDM3NzA3NiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LCBSSiBFd2luZywgR3JpZmYKICAgIEdyZWVuLCBBcnRodXIgTHVubgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgoKCgovLy8gQGRldiBUaGlzIGlzIGFuIGludGVyZmFjZSBmb3IgYExQVmF1bHRgIHdoaWNoIHNlcnZlcyBhcyBhIHNlY3VyZSBzdG9yYWdlIGZvcgovLy8gIHRoZSBFVEggdGhhdCBiYWNrcyB0aGUgUGxlZGdlcywgb25seSBhZnRlciBgTGlxdWlkUGxlZGdpbmdgIGF1dGhvcml6ZXMKLy8vICBwYXltZW50cyBjYW4gUGxlZGdlcyBiZSBjb252ZXJ0ZWQgZm9yIEVUSAppbnRlcmZhY2UgTFBWYXVsdCB7CiAgICBmdW5jdGlvbiBhdXRob3JpemVQYXltZW50KGJ5dGVzMzIgX3JlZiwgYWRkcmVzcyBfZGVzdCwgdWludCBfYW1vdW50KTsKICAgIGZ1bmN0aW9uICgpIHBheWFibGU7Cn0KCi8vLyBAZGV2IGBMaXF1aWRQbGVkZ2luZ0Jhc2VgIGlzIHRoZSBiYXNlIGxldmVsIGNvbnRyYWN0IHVzZWQgdG8gY2Fycnkgb3V0Ci8vLyAgbGlxdWlkUGxlZGdpbmcncyBtb3N0IGJhc2ljIGZ1bmN0aW9ucywgbW9zdGx5IGhhbmRsaW5nIGFuZCBzZWFyY2hpbmcgdGhlCi8vLyAgZGF0YSBzdHJ1Y3R1cmVzCmNvbnRyYWN0IExpcXVpZFBsZWRnaW5nQmFzZSBpcyBFc2NhcGFibGUgewoKICAgIC8vIExpbWl0cyBpbnNlcnRlZCB0byBwcmV2ZW50IGxhcmdlIGxvb3BzIHRoYXQgY291bGQgcHJldmVudCBjYW5jZWxpbmcKICAgIHVpbnQgY29uc3RhbnQgTUFYX0RFTEVHQVRFUyA9IDIwOwogICAgdWludCBjb25zdGFudCBNQVhfU1VCUFJPSkVDVF9MRVZFTCA9IDIwOwogICAgdWludCBjb25zdGFudCBNQVhfSU5URVJQUk9KRUNUX0xFVkVMID0gMjA7CgogICAgZW51bSBQbGVkZ2VBZG1pblR5cGUgeyBHaXZlciwgRGVsZWdhdGUsIFByb2plY3QgfQogICAgZW51bSBQbGVkZ2VTdGF0ZSB7IFBsZWRnZWQsIFBheWluZywgUGFpZCB9CgogICAgLy8vIEBkZXYgVGhpcyBzdHJ1Y3QgZGVmaW5lcyB0aGUgZGV0YWlscyBvZiBhIGBQbGVkZ2VBZG1pbmAgd2hpY2ggYXJlIAogICAgLy8vICBjb21tb25seSByZWZlcmVuY2VkIGJ5IHRoZWlyIGluZGV4IGluIHRoZSBgYWRtaW5zYCBhcnJheQogICAgLy8vICBhbmQgY2FuIG93biBwbGVkZ2VzIGFuZCBhY3QgYXMgZGVsZWdhdGVzCiAgICBzdHJ1Y3QgUGxlZGdlQWRtaW4geyAKICAgICAgICBQbGVkZ2VBZG1pblR5cGUgYWRtaW5UeXBlOyAvLyBHaXZlciwgRGVsZWdhdGUgb3IgUHJvamVjdAogICAgICAgIGFkZHJlc3MgYWRkcjsgLy8gQWNjb3VudCBvciBjb250cmFjdCBhZGRyZXNzIGZvciBhZG1pbgogICAgICAgIHN0cmluZyBuYW1lOwogICAgICAgIHN0cmluZyB1cmw7ICAvLyBDYW4gYmUgSVBGUyBoYXNoCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWU7ICAvLyBJbiBzZWNvbmRzLCB1c2VkIGZvciBHaXZlcnMnICYgRGVsZWdhdGVzJyB2ZXRvcwogICAgICAgIHVpbnQ2NCBwYXJlbnRQcm9qZWN0OyAgLy8gT25seSBmb3IgcHJvamVjdHMKICAgICAgICBib29sIGNhbmNlbGVkOyAgICAgIC8vQWx3YXlzIGZhbHNlIGV4Y2VwdCBmb3IgY2FuY2VsZWQgcHJvamVjdHMKCiAgICAgICAgLy8vIEBkZXYgaWYgdGhlIHBsdWdpbiBpcyAweDAgdGhlbiBub3RoaW5nIGhhcHBlbnMsIGlmIGl0cyBhbiBhZGRyZXNzCiAgICAgICAgLy8gdGhhbiB0aGF0IHNtYXJ0IGNvbnRyYWN0IGlzIGNhbGxlZCB3aGVuIGFwcHJvcHJpYXRlCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbjsgCiAgICB9CgogICAgc3RydWN0IFBsZWRnZSB7CiAgICAgICAgdWludCBhbW91bnQ7CiAgICAgICAgdWludDY0IG93bmVyOyAvLyBQbGVkZ2VBZG1pbgogICAgICAgIHVpbnQ2NFtdIGRlbGVnYXRpb25DaGFpbjsgLy8gTGlzdCBvZiBkZWxlZ2F0ZXMgaW4gb3JkZXIgb2YgYXV0aG9yaXR5CiAgICAgICAgdWludDY0IGludGVuZGVkUHJvamVjdDsgLy8gVXNlZCB3aGVuIGRlbGVnYXRlcyBhcmUgc2VuZGluZyB0byBwcm9qZWN0cwogICAgICAgIHVpbnQ2NCBjb21taXRUaW1lOyAgLy8gV2hlbiB0aGUgaW50ZW5kZWRQcm9qZWN0IHdpbGwgYmVjb21lIHRoZSBvd25lciAgCiAgICAgICAgdWludDY0IG9sZFBsZWRnZTsgLy8gUG9pbnRzIHRvIHRoZSBpZCB0aGF0IHRoaXMgUGxlZGdlIHdhcyBkZXJpdmVkIGZyb20KICAgICAgICBQbGVkZ2VTdGF0ZSBwbGVkZ2VTdGF0ZTsgLy8gIFBsZWRnZWQsIFBheWluZywgUGFpZAogICAgfQoKICAgIFBsZWRnZVtdIHBsZWRnZXM7CiAgICBQbGVkZ2VBZG1pbltdIGFkbWluczsgLy9UaGUgbGlzdCBvZiBwbGVkZ2VBZG1pbnMgMCBtZWFucyB0aGVyZSBpcyBubyBhZG1pbgogICAgTFBWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAgLy8vIEBkZXYgdGhpcyBtYXBwaW5nIGFsbG93cyB5b3UgdG8gc2VhcmNoIGZvciBhIHNwZWNpZmljIHBsZWRnZSdzIAogICAgLy8vICBpbmRleCBudW1iZXIgYnkgdGhlIGhhc2ggb2YgdGhhdCBwbGVkZ2UKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDY0KSBoUGxlZGdlMmlkeDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgcGx1Z2luV2hpdGVsaXN0OwogICAgCiAgICBib29sIHB1YmxpYyB1c2VQbHVnaW5XaGl0ZWxpc3QgPSB0cnVlOwoKLy8vLy8vLy8vLy8vLwovLyBNb2RpZmllcnMKLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQGRldiBUaGUgYHZhdWx0YGlzIHRoZSBvbmx5IGFkZHJlc3NlcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5VmF1bHQoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModmF1bHQpKTsKICAgICAgICBfOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgY3JlYXRlcyBgTGlxdWlkUGxlZGdpbmdCYXNlYCBvbiB0aGUgYmxvY2tjaGFpbgogICAgLy8vIEBwYXJhbSBfdmF1bHQgVGhlIHZhdWx0IHdoZXJlIHRoZSBFVEggYmFja2luZyB0aGUgcGxlZGdlcyBpcyBzdG9yZWQKICAgIGZ1bmN0aW9uIExpcXVpZFBsZWRnaW5nQmFzZSgKICAgICAgICBhZGRyZXNzIF92YXVsdCwKICAgICAgICBhZGRyZXNzIF9lc2NhcGVIYXRjaENhbGxlciwKICAgICAgICBhZGRyZXNzIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uCiAgICApIEVzY2FwYWJsZShfZXNjYXBlSGF0Y2hDYWxsZXIsIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSBwdWJsaWMgewogICAgICAgIGFkbWlucy5sZW5ndGggPSAxOyAvLyB3ZSByZXNlcnZlIHRoZSAwIGFkbWluCiAgICAgICAgcGxlZGdlcy5sZW5ndGggPSAxOyAvLyB3ZSByZXNlcnZlIHRoZSAwIHBsZWRnZQogICAgICAgIHZhdWx0ID0gTFBWYXVsdChfdmF1bHQpOyAvLyBBc3NpZ25zIHRoZSBzcGVjaWZpZWQgdmF1bHQKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFBsZWRnZUFkbWluIGZ1bmN0aW9ucwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIEdpdmVyIEFkbWluIHdpdGggdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGUgQWRtaW4gYWRkcmVzcwogICAgLy8vIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgR2l2ZXIncyBwcm9maWxlIG9mdGVuIGFuIElQRlMgaGFzaAogICAgLy8vIEBwYXJhbSBjb21taXRUaW1lIFRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBHaXZlciBoYXMgdG8KICAgIC8vLyAgIHZldG8gd2hlbiB0aGUgR2l2ZXIncyBkZWxlZ2F0ZXMgUGxlZGdlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgLy8vIEBwYXJhbSBwbHVnaW4gVGhpcyBpcyBHaXZlcidzIGxpcXVpZCBwbGVkZ2UgcGx1Z2luIGFsbG93aW5nIGZvciAKICAgIC8vLyAgZXh0ZW5kZWQgZnVuY3Rpb25hbGl0eQogICAgLy8vIEByZXR1cm4gaWRHaXZlciBUaGUgaWQgbnVtYmVyIHVzZWQgdG8gcmVmZXJlbmNlIHRoaXMgQWRtaW4KICAgIGZ1bmN0aW9uIGFkZEdpdmVyKAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyB1cmwsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbgogICAgKSByZXR1cm5zICh1aW50NjQgaWRHaXZlcikgewoKICAgICAgICByZXF1aXJlKGlzVmFsaWRQbHVnaW4ocGx1Z2luKSk7IC8vIFBsdWdpbiBjaGVjawoKICAgICAgICBpZEdpdmVyID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLkdpdmVyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGNvbW1pdFRpbWUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICBwbHVnaW4pKTsKCiAgICAgICAgR2l2ZXJBZGRlZChpZEdpdmVyKTsKICAgIH0KCiAgICBldmVudCBHaXZlckFkZGVkKHVpbnQ2NCBpbmRleGVkIGlkR2l2ZXIpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgYSBHaXZlcidzIGluZm8gdG8gY2hhbmdlIHRoZSBhZGRyZXNzLCBuYW1lLCB1cmwsIG9yIAogICAgLy8vICBjb21taXRUaW1lLCBpdCBjYW5ub3QgYmUgdXNlZCB0byBjaGFuZ2UgYSBwbHVnaW4sIGFuZCBpdCBtdXN0IGJlIGNhbGxlZAogICAgLy8vICBieSB0aGUgY3VycmVudCBhZGRyZXNzIG9mIHRoZSBHaXZlcgogICAgLy8vIEBwYXJhbSBpZEdpdmVyIFRoaXMgaXMgdGhlIEFkbWluIGlkIG51bWJlciB1c2VkIHRvIHNwZWNpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld0FkZHIgVGhlIG5ldyBhZGRyZXNzIHRoYXQgcmVwcmVzZW50cyB0aGlzIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld05hbWUgVGhlIG5ldyBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld1VybCBUaGUgbmV3IGxpbmsgdG8gdGhlIEdpdmVyJ3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcGFyYW0gbmV3Q29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBHaXZlciBoYXMgdG8KICAgIC8vLyAgIHZldG8gd2hlbiB0aGUgR2l2ZXIncyBkZWxlZ2F0ZXMgUGxlZGdlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgZnVuY3Rpb24gdXBkYXRlR2l2ZXIoCiAgICAgICAgdWludDY0IGlkR2l2ZXIsCiAgICAgICAgYWRkcmVzcyBuZXdBZGRyLAogICAgICAgIHN0cmluZyBuZXdOYW1lLAogICAgICAgIHN0cmluZyBuZXdVcmwsCiAgICAgICAgdWludDY0IG5ld0NvbW1pdFRpbWUpCiAgICB7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBnaXZlciA9IGZpbmRBZG1pbihpZEdpdmVyKTsKICAgICAgICByZXF1aXJlKGdpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpOyAvLyBNdXN0IGJlIGEgR2l2ZXIKICAgICAgICByZXF1aXJlKGdpdmVyLmFkZHIgPT0gbXNnLnNlbmRlcik7IC8vIEN1cnJlbnQgYWRkciBoYWQgdG8gc2VuZCB0aGlzIHR4CiAgICAgICAgZ2l2ZXIuYWRkciA9IG5ld0FkZHI7CiAgICAgICAgZ2l2ZXIubmFtZSA9IG5ld05hbWU7CiAgICAgICAgZ2l2ZXIudXJsID0gbmV3VXJsOwogICAgICAgIGdpdmVyLmNvbW1pdFRpbWUgPSBuZXdDb21taXRUaW1lOwogICAgICAgIEdpdmVyVXBkYXRlZChpZEdpdmVyKTsKICAgIH0KCiAgICBldmVudCBHaXZlclVwZGF0ZWQodWludDY0IGluZGV4ZWQgaWRHaXZlcik7CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIERlbGVnYXRlIEFkbWluIHdpdGggdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGUgQWRtaW4gYWRkcgogICAgLy8vIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIERlbGVnYXRlCiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgRGVsZWdhdGUncyBwcm9maWxlIG9mdGVuIGFuIElQRlMgaGFzaAogICAgLy8vIEBwYXJhbSBjb21taXRUaW1lIFNldHMgdGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhhdCB0aGlzIGRlbGVnYXRlCiAgICAvLy8gIGNhbiBiZSB2ZXRvZWQuIFdoZW5ldmVyIHRoaXMgZGVsZWdhdGUgaXMgaW4gYSBkZWxlZ2F0ZSBjaGFpbiB0aGUgdGltZQogICAgLy8vICBhbGxvd2VkIHRvIHZldG8gYW55IGV2ZW50IG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoaXMgdGltZS4KICAgIC8vLyBAcGFyYW0gcGx1Z2luIFRoaXMgaXMgRGVsZWdhdGUncyBsaXF1aWQgcGxlZGdlIHBsdWdpbiBhbGxvd2luZyBmb3IgCiAgICAvLy8gIGV4dGVuZGVkIGZ1bmN0aW9uYWxpdHkKICAgIC8vLyBAcmV0dXJuIGlkeERlbGVnYXRlIFRoZSBpZCBudW1iZXIgdXNlZCB0byByZWZlcmVuY2UgdGhpcyBEZWxlZ2F0ZSB3aXRoaW4KICAgIC8vLyAgdGhlIGFkbWlucyBhcnJheQogICAgZnVuY3Rpb24gYWRkRGVsZWdhdGUoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICBJTGlxdWlkUGxlZGdpbmdQbHVnaW4gcGx1Z2luCiAgICApIHJldHVybnMgKHVpbnQ2NCBpZERlbGVnYXRlKSB7IAoKICAgICAgICByZXF1aXJlKGlzVmFsaWRQbHVnaW4ocGx1Z2luKSk7IC8vIFBsdWdpbiBjaGVjawoKICAgICAgICBpZERlbGVnYXRlID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLkRlbGVnYXRlLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGNvbW1pdFRpbWUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICBwbHVnaW4pKTsKCiAgICAgICAgRGVsZWdhdGVBZGRlZChpZERlbGVnYXRlKTsKICAgIH0KCiAgICBldmVudCBEZWxlZ2F0ZUFkZGVkKHVpbnQ2NCBpbmRleGVkIGlkRGVsZWdhdGUpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgYSBEZWxlZ2F0ZSdzIGluZm8gdG8gY2hhbmdlIHRoZSBhZGRyZXNzLCBuYW1lLCB1cmwsIG9yIAogICAgLy8vICBjb21taXRUaW1lLCBpdCBjYW5ub3QgYmUgdXNlZCB0byBjaGFuZ2UgYSBwbHVnaW4sIGFuZCBpdCBtdXN0IGJlIGNhbGxlZAogICAgLy8vICBieSB0aGUgY3VycmVudCBhZGRyZXNzIG9mIHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBpZERlbGVnYXRlIFRoZSBBZG1pbiBpZCBudW1iZXIgdXNlZCB0byBzcGVjaWZ5IHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdBZGRyIFRoZSBuZXcgYWRkcmVzcyB0aGF0IHJlcHJlc2VudHMgdGhpcyBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdOYW1lIFRoZSBuZXcgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdVcmwgVGhlIG5ldyBsaW5rIHRvIHRoZSBEZWxlZ2F0ZSdzIHByb2ZpbGUgb2Z0ZW4gYW4gSVBGUyBoYXNoCiAgICAvLy8gQHBhcmFtIG5ld0NvbW1pdFRpbWUgU2V0cyB0aGUgbGVuZ3RoIG9mIHRpbWUgaW4gc2Vjb25kcyB0aGF0IHRoaXMgCiAgICAvLy8gIGRlbGVnYXRlIGNhbiBiZSB2ZXRvZWQuIFdoZW5ldmVyIHRoaXMgZGVsZWdhdGUgaXMgaW4gYSBkZWxlZ2F0ZSBjaGFpbiAKICAgIC8vLyAgdGhlIHRpbWUgYWxsb3dlZCB0byB2ZXRvIGFueSBldmVudCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0bwogICAgLy8vICB0aGlzIHRpbWUuCiAgICBmdW5jdGlvbiB1cGRhdGVEZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWREZWxlZ2F0ZSwKICAgICAgICBhZGRyZXNzIG5ld0FkZHIsCiAgICAgICAgc3RyaW5nIG5ld05hbWUsCiAgICAgICAgc3RyaW5nIG5ld1VybCwKICAgICAgICB1aW50NjQgbmV3Q29tbWl0VGltZSkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgZGVsZWdhdGUgPSBmaW5kQWRtaW4oaWREZWxlZ2F0ZSk7CiAgICAgICAgcmVxdWlyZShkZWxlZ2F0ZS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLkRlbGVnYXRlKTsKICAgICAgICByZXF1aXJlKGRlbGVnYXRlLmFkZHIgPT0gbXNnLnNlbmRlcik7Ly8gQ3VycmVudCBhZGRyIGhhZCB0byBzZW5kIHRoaXMgdHgKICAgICAgICBkZWxlZ2F0ZS5hZGRyID0gbmV3QWRkcjsKICAgICAgICBkZWxlZ2F0ZS5uYW1lID0gbmV3TmFtZTsKICAgICAgICBkZWxlZ2F0ZS51cmwgPSBuZXdVcmw7CiAgICAgICAgZGVsZWdhdGUuY29tbWl0VGltZSA9IG5ld0NvbW1pdFRpbWU7CiAgICAgICAgRGVsZWdhdGVVcGRhdGVkKGlkRGVsZWdhdGUpOwogICAgfQoKICAgIGV2ZW50IERlbGVnYXRlVXBkYXRlZCh1aW50NjQgaW5kZXhlZCBpZERlbGVnYXRlKTsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgUHJvamVjdCBBZG1pbiB3aXRoIHRoZSBgbXNnLnNlbmRlcmAgYXMgdGhlIEFkbWluIGFkZHIKICAgIC8vLyBAcGFyYW0gbmFtZSBUaGUgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBQcm9qZWN0CiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgUHJvamVjdCdzIHByb2ZpbGUgb2Z0ZW4gYW4gSVBGUyBoYXNoCiAgICAvLy8gQHBhcmFtIHByb2plY3RBZG1pbiBUaGUgYWRkcmVzcyBmb3IgdGhlIHRydXN0ZWQgcHJvamVjdCBtYW5hZ2VyIAogICAgLy8vIEBwYXJhbSBwYXJlbnRQcm9qZWN0IFRoZSBBZG1pbiBpZCBudW1iZXIgZm9yIHRoZSBwYXJlbnQgcHJvamVjdCBvciAwIGlmCiAgICAvLy8gIHRoZXJlIGlzIG5vIHBhcmVudFByb2plY3QKICAgIC8vLyBAcGFyYW0gY29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBQcm9qZWN0IGhhcyB0bwogICAgLy8vICAgdmV0byB3aGVuIHRoZSBQcm9qZWN0IGRlbGVnYXRlcyB0byBhbm90aGVyIERlbGVnYXRlIGFuZCB0aGV5IHBsZWRnZSAKICAgIC8vLyAgIHRob3NlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgLy8vIEBwYXJhbSBwbHVnaW4gVGhpcyBpcyBQcm9qZWN0J3MgbGlxdWlkIHBsZWRnZSBwbHVnaW4gYWxsb3dpbmcgZm9yIAogICAgLy8vICBleHRlbmRlZCBmdW5jdGlvbmFsaXR5CiAgICAvLy8gQHJldHVybiBpZFByb2plY3QgVGhlIGlkIG51bWJlciB1c2VkIHRvIHJlZmVyZW5jZSB0aGlzIEFkbWluCiAgICBmdW5jdGlvbiBhZGRQcm9qZWN0KAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyB1cmwsCiAgICAgICAgYWRkcmVzcyBwcm9qZWN0QWRtaW4sCiAgICAgICAgdWludDY0IHBhcmVudFByb2plY3QsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbgogICAgKSByZXR1cm5zICh1aW50NjQgaWRQcm9qZWN0KSB7CiAgICAgICAgcmVxdWlyZShpc1ZhbGlkUGx1Z2luKHBsdWdpbikpOwoKICAgICAgICBpZiAocGFyZW50UHJvamVjdCAhPSAwKSB7CiAgICAgICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcGEgPSBmaW5kQWRtaW4ocGFyZW50UHJvamVjdCk7CiAgICAgICAgICAgIHJlcXVpcmUocGEuYWRtaW5UeXBlID09IFBsZWRnZUFkbWluVHlwZS5Qcm9qZWN0KTsKICAgICAgICAgICAgcmVxdWlyZShnZXRQcm9qZWN0TGV2ZWwocGEpIDwgTUFYX1NVQlBST0pFQ1RfTEVWRUwpOwogICAgICAgIH0KCiAgICAgICAgaWRQcm9qZWN0ID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLlByb2plY3QsCiAgICAgICAgICAgIHByb2plY3RBZG1pbiwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgdXJsLAogICAgICAgICAgICBjb21taXRUaW1lLAogICAgICAgICAgICBwYXJlbnRQcm9qZWN0LAogICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgcGx1Z2luKSk7CgoKICAgICAgICBQcm9qZWN0QWRkZWQoaWRQcm9qZWN0KTsKICAgIH0KCiAgICBldmVudCBQcm9qZWN0QWRkZWQodWludDY0IGluZGV4ZWQgaWRQcm9qZWN0KTsKCgogICAgLy8vIEBub3RpY2UgVXBkYXRlcyBhIFByb2plY3QncyBpbmZvIHRvIGNoYW5nZSB0aGUgYWRkcmVzcywgbmFtZSwgdXJsLCBvciAKICAgIC8vLyAgY29tbWl0VGltZSwgaXQgY2Fubm90IGJlIHVzZWQgdG8gY2hhbmdlIGEgcGx1Z2luIG9yIGEgcGFyZW50UHJvamVjdCwKICAgIC8vLyAgYW5kIGl0IG11c3QgYmUgY2FsbGVkIGJ5IHRoZSBjdXJyZW50IGFkZHJlc3Mgb2YgdGhlIFByb2plY3QKICAgIC8vLyBAcGFyYW0gaWRQcm9qZWN0IFRoZSBBZG1pbiBpZCBudW1iZXIgdXNlZCB0byBzcGVjaWZ5IHRoZSBQcm9qZWN0CiAgICAvLy8gQHBhcmFtIG5ld0FkZHIgVGhlIG5ldyBhZGRyZXNzIHRoYXQgcmVwcmVzZW50cyB0aGlzIFByb2plY3QKICAgIC8vLyBAcGFyYW0gbmV3TmFtZSBUaGUgbmV3IG5hbWUgdXNlZCB0byBpZGVudGlmeSB0aGUgUHJvamVjdAogICAgLy8vIEBwYXJhbSBuZXdVcmwgVGhlIG5ldyBsaW5rIHRvIHRoZSBQcm9qZWN0J3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcGFyYW0gbmV3Q29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBQcm9qZWN0IGhhcwogICAgLy8vICB0byB2ZXRvIHdoZW4gdGhlIFByb2plY3QgZGVsZWdhdGVzIHRvIGEgRGVsZWdhdGUgYW5kIHRoZXkgcGxlZGdlIHRob3NlCiAgICAvLy8gIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgZnVuY3Rpb24gdXBkYXRlUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQcm9qZWN0LAogICAgICAgIGFkZHJlc3MgbmV3QWRkciwKICAgICAgICBzdHJpbmcgbmV3TmFtZSwKICAgICAgICBzdHJpbmcgbmV3VXJsLAogICAgICAgIHVpbnQ2NCBuZXdDb21taXRUaW1lKQogICAgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcHJvamVjdCA9IGZpbmRBZG1pbihpZFByb2plY3QpOwogICAgICAgIHJlcXVpcmUocHJvamVjdC5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIHJlcXVpcmUocHJvamVjdC5hZGRyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHByb2plY3QuYWRkciA9IG5ld0FkZHI7CiAgICAgICAgcHJvamVjdC5uYW1lID0gbmV3TmFtZTsKICAgICAgICBwcm9qZWN0LnVybCA9IG5ld1VybDsKICAgICAgICBwcm9qZWN0LmNvbW1pdFRpbWUgPSBuZXdDb21taXRUaW1lOwogICAgICAgIFByb2plY3RVcGRhdGVkKGlkUHJvamVjdCk7CiAgICB9CgogICAgZXZlbnQgUHJvamVjdFVwZGF0ZWQodWludDY0IGluZGV4ZWQgaWRBZG1pbik7CgoKLy8vLy8vLy8vLwovLyBQdWJsaWMgY29uc3RhbnQgZnVuY3Rpb25zCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBBIGNvbnN0YW50IGdldHRlciB0aGF0IHJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBwbGVkZ2VzCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIFBsZWRnZXMgaW4gdGhlIHN5c3RlbQogICAgZnVuY3Rpb24gbnVtYmVyT2ZQbGVkZ2VzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwbGVkZ2VzLmxlbmd0aCAtIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdGhhdCByZXR1cm5zIHRoZSBkZXRhaWxzIG9mIHRoZSBzcGVjaWZpZWQgcGxlZGdlCiAgICAvLy8gQHBhcmFtIGlkUGxlZGdlIHRoZSBpZCBudW1iZXIgb2YgdGhlIHBsZWRnZSBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiB0aGUgYW1vdW50LCBvd25lciwgdGhlIG51bWJlciBvZiBkZWxlZ2F0ZXMgKGJ1dCBub3QgdGhlIGFjdHVhbAogICAgLy8vICBkZWxlZ2F0ZXMsIHRoZSBpbnRlbmRlZFByb2plY3QgKGlmIGFueSksIHRoZSBjdXJyZW50IGNvbW1pdCB0aW1lIGFuZAogICAgLy8vICB0aGUgcHJldmlvdXMgcGxlZGdlIHRoaXMgcGxlZGdlIHdhcyBkZXJpdmVkIGZyb20KICAgIGZ1bmN0aW9uIGdldFBsZWRnZSh1aW50NjQgaWRQbGVkZ2UpIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IG93bmVyLAogICAgICAgIHVpbnQ2NCBuRGVsZWdhdGVzLAogICAgICAgIHVpbnQ2NCBpbnRlbmRlZFByb2plY3QsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgdWludDY0IG9sZFBsZWRnZSwKICAgICAgICBQbGVkZ2VTdGF0ZSBwbGVkZ2VTdGF0ZQogICAgKSB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIGFtb3VudCA9IHAuYW1vdW50OwogICAgICAgIG93bmVyID0gcC5vd25lcjsKICAgICAgICBuRGVsZWdhdGVzID0gdWludDY0KHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCk7CiAgICAgICAgaW50ZW5kZWRQcm9qZWN0ID0gcC5pbnRlbmRlZFByb2plY3Q7CiAgICAgICAgY29tbWl0VGltZSA9IHAuY29tbWl0VGltZTsKICAgICAgICBvbGRQbGVkZ2UgPSBwLm9sZFBsZWRnZTsKICAgICAgICBwbGVkZ2VTdGF0ZSA9IHAucGxlZGdlU3RhdGU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0dGVyIHRvIGZpbmQgRGVsZWdhdGUgdy8gdGhlIFBsZWRnZSBJRCAmIHRoZSBEZWxlZ2F0ZSBpbmRleAogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBUaGUgaWQgbnVtYmVyIHJlcHJlc2VudGluZyB0aGUgcGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gaWR4RGVsZWdhdGUgVGhlIGluZGV4IG51bWJlciBmb3IgdGhlIGRlbGVnYXRlIGluIHRoaXMgUGxlZGdlIAogICAgZnVuY3Rpb24gZ2V0UGxlZGdlRGVsZWdhdGUodWludDY0IGlkUGxlZGdlLCB1aW50IGlkeERlbGVnYXRlKSBjb25zdGFudCByZXR1cm5zKAogICAgICAgIHVpbnQ2NCBpZERlbGVnYXRlLAogICAgICAgIGFkZHJlc3MgYWRkciwKICAgICAgICBzdHJpbmcgbmFtZQogICAgKSB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIGlkRGVsZWdhdGUgPSBwLmRlbGVnYXRpb25DaGFpbltpZHhEZWxlZ2F0ZSAtIDFdOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgZGVsZWdhdGUgPSBmaW5kQWRtaW4oaWREZWxlZ2F0ZSk7CiAgICAgICAgYWRkciA9IGRlbGVnYXRlLmFkZHI7CiAgICAgICAgbmFtZSA9IGRlbGVnYXRlLm5hbWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBjb25zdGFudCBnZXR0ZXIgdXNlZCB0byBjaGVjayBob3cgbWFueSB0b3RhbCBBZG1pbnMgZXhpc3QKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgYWRtaW5zIChHaXZlcnMsIERlbGVnYXRlcyBhbmQgUHJvamVjdHMpIC4KICAgIGZ1bmN0aW9uIG51bWJlck9mUGxlZGdlQWRtaW5zKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFkbWlucy5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEEgY29uc3RhbnQgZ2V0dGVyIHRvIGNoZWNrIHRoZSBkZXRhaWxzIG9mIGEgc3BlY2lmaWVkIEFkbWluICAKICAgIC8vLyBAcmV0dXJuIGFkZHIgQWNjb3VudCBvciBjb250cmFjdCBhZGRyZXNzIGZvciBhZG1pbgogICAgLy8vIEByZXR1cm4gbmFtZSBOYW1lIG9mIHRoZSBwbGVkZ2VBZG1pbgogICAgLy8vIEByZXR1cm4gdXJsIFRoZSBsaW5rIHRvIHRoZSBQcm9qZWN0J3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcmV0dXJuIGNvbW1pdFRpbWUgVGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhlIEFkbWluIGhhcyB0byB2ZXRvCiAgICAvLy8gICB3aGVuIHRoZSBBZG1pbiBkZWxlZ2F0ZXMgdG8gYSBEZWxlZ2F0ZSBhbmQgdGhhdCBEZWxlZ2F0ZSBwbGVkZ2VzIHRob3NlCiAgICAvLy8gICBmdW5kcyB0byBhIHByb2plY3QKICAgIC8vLyBAcmV0dXJuIHBhcmVudFByb2plY3QgVGhlIEFkbWluIGlkIG51bWJlciBmb3IgdGhlIHBhcmVudCBwcm9qZWN0IG9yIDAKICAgIC8vLyAgaWYgdGhlcmUgaXMgbm8gcGFyZW50UHJvamVjdAogICAgLy8vIEByZXR1cm4gY2FuY2VsZWQgMCBmb3IgRGVsZWdhdGVzICYgR2l2ZXJzLCB0cnVlIGlmIGEgUHJvamVjdCBoYXMgYmVlbiAKICAgIC8vLyAgY2FuY2VsZWQKICAgIC8vLyBAcmV0dXJuIHBsdWdpbiBUaGlzIGlzIFByb2plY3QncyBsaXF1aWRQbGVkZ2luZyBwbHVnaW4gYWxsb3dpbmcgZm9yIAogICAgLy8vICBleHRlbmRlZCBmdW5jdGlvbmFsaXR5CiAgICBmdW5jdGlvbiBnZXRQbGVkZ2VBZG1pbih1aW50NjQgaWRBZG1pbikgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgUGxlZGdlQWRtaW5UeXBlIGFkbWluVHlwZSwKICAgICAgICBhZGRyZXNzIGFkZHIsCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICB1aW50NjQgcGFyZW50UHJvamVjdCwKICAgICAgICBib29sIGNhbmNlbGVkLAogICAgICAgIGFkZHJlc3MgcGx1Z2luKQogICAgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihpZEFkbWluKTsKICAgICAgICBhZG1pblR5cGUgPSBtLmFkbWluVHlwZTsKICAgICAgICBhZGRyID0gbS5hZGRyOwogICAgICAgIG5hbWUgPSBtLm5hbWU7CiAgICAgICAgdXJsID0gbS51cmw7CiAgICAgICAgY29tbWl0VGltZSA9IG0uY29tbWl0VGltZTsKICAgICAgICBwYXJlbnRQcm9qZWN0ID0gbS5wYXJlbnRQcm9qZWN0OwogICAgICAgIGNhbmNlbGVkID0gbS5jYW5jZWxlZDsKICAgICAgICBwbHVnaW4gPSBhZGRyZXNzKG0ucGx1Z2luKTsKICAgIH0KCi8vLy8vLy8vCi8vIFByaXZhdGUgbWV0aG9kcwovLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBjcmVhdGVzIGEgUGxlZGdlIHdpdGggYW4gaW5pdGlhbCBhbW91bnQgb2YgMCBpZiBvbmUgaXMgbm90CiAgICAvLy8gIGNyZWF0ZWQgYWxyZWFkeTsgb3RoZXJ3aXNlIGl0IGZpbmRzIHRoZSBwbGVkZ2Ugd2l0aCB0aGUgc3BlY2lmaWVkCiAgICAvLy8gIGF0dHJpYnV0ZXM7IGFsbCBwbGVkZ2VzIHRlY2huaWNhbGx5IGV4aXN0LCBpZiB0aGUgcGxlZGdlIGhhc24ndCBiZWVuCiAgICAvLy8gIGNyZWF0ZWQgaW4gdGhpcyBzeXN0ZW0geWV0IGl0IHNpbXBseSBpc24ndCBpbiB0aGUgaGFzaCBhcnJheQogICAgLy8vICBoUGxlZGdlMmlkeFtdIHlldAogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgb3duZXIgb2YgdGhlIHBsZWRnZSBiZWluZyBsb29rZWQgdXAKICAgIC8vLyBAcGFyYW0gZGVsZWdhdGlvbkNoYWluIFRoZSBsaXN0IG9mIGRlbGVnYXRlcyBpbiBvcmRlciBvZiBhdXRob3JpdHkKICAgIC8vLyBAcGFyYW0gaW50ZW5kZWRQcm9qZWN0IFRoZSBwcm9qZWN0IHRoaXMgcGxlZGdlIHdpbGwgRnVuZCBhZnRlciB0aGUKICAgIC8vLyAgY29tbWl0VGltZSBoYXMgcGFzc2VkCiAgICAvLy8gQHBhcmFtIGNvbW1pdFRpbWUgVGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhlIEdpdmVyIGhhcyB0bwogICAgLy8vICAgdmV0byB3aGVuIHRoZSBHaXZlcidzIGRlbGVnYXRlcyBQbGVkZ2UgZnVuZHMgdG8gYSBwcm9qZWN0CiAgICAvLy8gQHBhcmFtIG9sZFBsZWRnZSBUaGlzIHZhbHVlIGlzIHVzZWQgdG8gc3RvcmUgdGhlIHBsZWRnZSB0aGUgY3VycmVudAogICAgLy8vICBwbGVkZ2Ugd2FzIGNhbWUgZnJvbSwgYW5kIGluIHRoZSBjYXNlIGEgUHJvamVjdCBpcyBjYW5jZWxlZCwgdGhlIFBsZWRnZQogICAgLy8vICB3aWxsIHJldmVydCBiYWNrIHRvIGl0J3MgcHJldmlvdXMgc3RhdGUKICAgIC8vLyBAcGFyYW0gc3RhdGUgVGhlIHBsZWRnZSBzdGF0ZTogUGxlZGdlZCwgUGF5aW5nLCBvciBzdGF0ZQogICAgLy8vIEByZXR1cm4gVGhlIGhQbGVkZ2UyaWR4IGluZGV4IG51bWJlcgogICAgZnVuY3Rpb24gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgIHVpbnQ2NCBvd25lciwKICAgICAgICB1aW50NjRbXSBkZWxlZ2F0aW9uQ2hhaW4sCiAgICAgICAgdWludDY0IGludGVuZGVkUHJvamVjdCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICB1aW50NjQgb2xkUGxlZGdlLAogICAgICAgIFBsZWRnZVN0YXRlIHN0YXRlCiAgICAgICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50NjQpCiAgICB7CiAgICAgICAgYnl0ZXMzMiBoUGxlZGdlID0gc2hhMygKICAgICAgICAgICAgb3duZXIsIGRlbGVnYXRpb25DaGFpbiwgaW50ZW5kZWRQcm9qZWN0LCBjb21taXRUaW1lLCBvbGRQbGVkZ2UsIHN0YXRlKTsKICAgICAgICB1aW50NjQgaWR4ID0gaFBsZWRnZTJpZHhbaFBsZWRnZV07CiAgICAgICAgaWYgKGlkeCA+IDApIHJldHVybiBpZHg7CiAgICAgICAgaWR4ID0gdWludDY0KHBsZWRnZXMubGVuZ3RoKTsKICAgICAgICBoUGxlZGdlMmlkeFtoUGxlZGdlXSA9IGlkeDsKICAgICAgICBwbGVkZ2VzLnB1c2goUGxlZGdlKAogICAgICAgICAgICAwLCBvd25lciwgZGVsZWdhdGlvbkNoYWluLCBpbnRlbmRlZFByb2plY3QsIGNvbW1pdFRpbWUsIG9sZFBsZWRnZSwgc3RhdGUpKTsKICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8vLyBAbm90aWNlIEEgZ2V0dGVyIHRvIGxvb2sgdXAgYSBBZG1pbidzIGRldGFpbHMKICAgIC8vLyBAcGFyYW0gaWRBZG1pbiBUaGUgaWQgZm9yIHRoZSBBZG1pbiB0byBsb29rdXAKICAgIC8vLyBAcmV0dXJuIFRoZSBQbGVkZ2VBZG1pbiBzdHJ1Y3QgZm9yIHRoZSBzcGVjaWZpZWQgQWRtaW4KICAgIGZ1bmN0aW9uIGZpbmRBZG1pbih1aW50NjQgaWRBZG1pbikgaW50ZXJuYWwgcmV0dXJucyAoUGxlZGdlQWRtaW4gc3RvcmFnZSkgewogICAgICAgIHJlcXVpcmUoaWRBZG1pbiA8IGFkbWlucy5sZW5ndGgpOwogICAgICAgIHJldHVybiBhZG1pbnNbaWRBZG1pbl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gbG9vayB1cCBhIFBsZWRnZSdzIGRldGFpbHMKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhlIGlkIGZvciB0aGUgUGxlZGdlIHRvIGxvb2t1cAogICAgLy8vIEByZXR1cm4gVGhlIFBsZWRnZUEgc3RydWN0IGZvciB0aGUgc3BlY2lmaWVkIFBsZWRnZQogICAgZnVuY3Rpb24gZmluZFBsZWRnZSh1aW50NjQgaWRQbGVkZ2UpIGludGVybmFsIHJldHVybnMgKFBsZWRnZSBzdG9yYWdlKSB7CiAgICAgICAgcmVxdWlyZShpZFBsZWRnZSA8IHBsZWRnZXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gcGxlZGdlc1tpZFBsZWRnZV07CiAgICB9CgogICAgLy8gYSBjb25zdGFudCBmb3Igd2hlbiBhIGRlbGVnYXRlIGlzIHJlcXVlc3RlZCB0aGF0IGlzIG5vdCBpbiB0aGUgc3lzdGVtCiAgICB1aW50NjQgY29uc3RhbnQgIE5PVEZPVU5EID0gMHhGRkZGRkZGRkZGRkZGRkZGOwoKICAgIC8vLyBAbm90aWNlIEEgZ2V0dGVyIHRoYXQgc2VhcmNoZXMgdGhlIGRlbGVnYXRpb25DaGFpbiBmb3IgdGhlIGxldmVsIG9mCiAgICAvLy8gIGF1dGhvcml0eSBhIHNwZWNpZmljIGRlbGVnYXRlIGhhcyB3aXRoaW4gYSBQbGVkZ2UKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIHRoYXQgd2lsbCBiZSBzZWFyY2hlZAogICAgLy8vIEBwYXJhbSBpZERlbGVnYXRlIFRoZSBzcGVjaWZpZWQgZGVsZWdhdGUgdGhhdCdzIHNlYXJjaGVkIGZvcgogICAgLy8vIEByZXR1cm4gSWYgdGhlIGRlbGVnYXRlIGNoYWluIGNvbnRhaW5zIHRoZSBkZWxlZ2F0ZSB3aXRoIHRoZQogICAgLy8vICBgYWRtaW5zYCBhcnJheSBpbmRleCBgaWREZWxlZ2F0ZWAgdGhpcyByZXR1cm5zIHRoYXQgZGVsZWdhdGVzCiAgICAvLy8gIGNvcnJlc3BvbmRpbmcgaW5kZXggaW4gdGhlIGRlbGVnYXRpb25DaGFpbi4gT3RoZXJ3aXNlIGl0IHJldHVybnMKICAgIC8vLyAgdGhlIE5PVEZPVU5EIGNvbnN0YW50CiAgICBmdW5jdGlvbiBnZXREZWxlZ2F0ZUlkeChQbGVkZ2UgcCwgdWludDY0IGlkRGVsZWdhdGUpIGludGVybmFsIHJldHVybnModWludDY0KSB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwLmRlbGVnYXRpb25DaGFpbltpXSA9PSBpZERlbGVnYXRlKSByZXR1cm4gdWludDY0KGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTk9URk9VTkQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCBob3cgbWFueSBvbGQgInBhcmVudCIgcGxlZGdlcyBhIHNwZWNpZmljIFBsZWRnZQogICAgLy8vICBoYWQgdXNpbmcgYSBzZWxmLXJlZmVyZW50aWFsIGxvb3AKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2xkICJwYXJlbnQiIHBsZWRnZXMgYSBzcGVjaWZpYyBQbGVkZ2UgaGFkCiAgICBmdW5jdGlvbiBnZXRQbGVkZ2VMZXZlbChQbGVkZ2UgcCkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHAub2xkUGxlZGdlID09IDApIHJldHVybiAwOwogICAgICAgIFBsZWRnZSBzdG9yYWdlIG9sZE4gPSBmaW5kUGxlZGdlKHAub2xkUGxlZGdlKTsKICAgICAgICByZXR1cm4gZ2V0UGxlZGdlTGV2ZWwob2xkTikgKyAxOyAvLyBhIGxvb3AgbG9va3VwCiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCB0aGUgbG9uZ2VzdCBjb21taXRUaW1lIG91dCBvZiB0aGUgb3duZXIgYW5kIGFsbAogICAgLy8vICB0aGUgZGVsZWdhdGVzIGZvciBhIHNwZWNpZmllZCBwbGVkZ2UKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBtYXhpbXVtIGNvbW1pdFRpbWUgb3V0IG9mIHRoZSBvd25lciBhbmQgYWxsIHRoZSBkZWxlZ2F0ZXMKICAgIGZ1bmN0aW9uIG1heENvbW1pdFRpbWUoUGxlZGdlIHApIGludGVybmFsIHJldHVybnModWludCBjb21taXRUaW1lKSB7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBtID0gZmluZEFkbWluKHAub3duZXIpOwogICAgICAgIGNvbW1pdFRpbWUgPSBtLmNvbW1pdFRpbWU7IC8vIHN0YXJ0IHdpdGggdGhlIG93bmVyJ3MgY29tbWl0VGltZQoKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG0gPSBmaW5kQWRtaW4ocC5kZWxlZ2F0aW9uQ2hhaW5baV0pOwoKICAgICAgICAgICAgLy8gSWYgYSBkZWxlZ2F0ZSdzIGNvbW1pdFRpbWUgaXMgbG9uZ2VyLCBtYWtlIGl0IHRoZSBuZXcgY29tbWl0VGltZQogICAgICAgICAgICBpZiAobS5jb21taXRUaW1lID4gY29tbWl0VGltZSkgY29tbWl0VGltZSA9IG0uY29tbWl0VGltZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCB0aGUgbGV2ZWwgb2YgYXV0aG9yaXR5IGEgc3BlY2lmaWMgUHJvamVjdCBoYXMKICAgIC8vLyAgdXNpbmcgYSBzZWxmLXJlZmVyZW50aWFsIGxvb3AKICAgIC8vLyBAcGFyYW0gbSBUaGUgUHJvamVjdCBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgbGV2ZWwgb2YgYXV0aG9yaXR5IGEgc3BlY2lmaWMgUHJvamVjdCBoYXMKICAgIGZ1bmN0aW9uIGdldFByb2plY3RMZXZlbChQbGVkZ2VBZG1pbiBtKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBhc3NlcnQobS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIGlmIChtLnBhcmVudFByb2plY3QgPT0gMCkgcmV0dXJuKDEpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcGFyZW50Tk0gPSBmaW5kQWRtaW4obS5wYXJlbnRQcm9qZWN0KTsKICAgICAgICByZXR1cm4gZ2V0UHJvamVjdExldmVsKHBhcmVudE5NKSArIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCBpZiBhIHNwZWNpZmllZCBQcm9qZWN0IGhhcyBiZWVuIGNhbmNlbGVkCiAgICAvLy8gQHBhcmFtIHByb2plY3RJZCBUaGUgQWRtaW4gaWQgbnVtYmVyIHVzZWQgdG8gc3BlY2lmeSB0aGUgUHJvamVjdAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgUHJvamVjdCBoYXMgYmVlbiBjYW5jZWxlZAogICAgZnVuY3Rpb24gaXNQcm9qZWN0Q2FuY2VsZWQodWludDY0IHByb2plY3RJZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihwcm9qZWN0SWQpOwogICAgICAgIGlmIChtLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlcnQobS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIGlmIChtLmNhbmNlbGVkKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAobS5wYXJlbnRQcm9qZWN0ID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gaXNQcm9qZWN0Q2FuY2VsZWQobS5wYXJlbnRQcm9qZWN0KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGdldHRlciB0byBmaW5kIHRoZSBvbGRlc3QgcGxlZGdlIHRoYXQgaGFzbid0IGJlZW4gY2FuY2VsZWQKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhlIHN0YXJ0aW5nIHBsYWNlIHRvIGxvb2t1cCB0aGUgcGxlZGdlcyAKICAgIC8vLyBAcmV0dXJuIFRoZSBvbGRlc3QgaWRQbGVkZ2UgdGhhdCBoYXNuJ3QgYmVlbiBjYW5jZWxlZCAoRFVIISkKICAgIGZ1bmN0aW9uIGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHVpbnQ2NCBpZFBsZWRnZQogICAgICAgICkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50NjQpIHsKICAgICAgICBpZiAoaWRQbGVkZ2UgPT0gMCkgcmV0dXJuIDA7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgYWRtaW4gPSBmaW5kQWRtaW4ocC5vd25lcik7CiAgICAgICAgaWYgKGFkbWluLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHJldHVybiBpZFBsZWRnZTsKCiAgICAgICAgYXNzZXJ0KGFkbWluLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuUHJvamVjdCk7CgogICAgICAgIGlmICghaXNQcm9qZWN0Q2FuY2VsZWQocC5vd25lcikpIHJldHVybiBpZFBsZWRnZTsKCiAgICAgICAgcmV0dXJuIGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHAub2xkUGxlZGdlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGNoZWNrIHRvIHNlZSBpZiB0aGUgbXNnLnNlbmRlciBpcyB0aGUgb3duZXIgb3IgdGhlCiAgICAvLy8gIHBsdWdpbiBjb250cmFjdCBmb3IgYSBzcGVjaWZpYyBBZG1pbgogICAgLy8vIEBwYXJhbSBtIFRoZSBBZG1pbiBiZWluZyBjaGVja2VkCiAgICBmdW5jdGlvbiBjaGVja0FkbWluT3duZXIoUGxlZGdlQWRtaW4gbSkgaW50ZXJuYWwgY29uc3RhbnQgewogICAgICAgIHJlcXVpcmUoKG1zZy5zZW5kZXIgPT0gbS5hZGRyKSB8fCAobXNnLnNlbmRlciA9PSBhZGRyZXNzKG0ucGx1Z2luKSkpOwogICAgfQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gUGx1Z2luIFdoaXRlbGlzdCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIGFkZFZhbGlkUGx1Z2luKGJ5dGVzMzIgY29udHJhY3RIYXNoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHBsdWdpbldoaXRlbGlzdFtjb250cmFjdEhhc2hdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVWYWxpZFBsdWdpbihieXRlczMyIGNvbnRyYWN0SGFzaCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBwbHVnaW5XaGl0ZWxpc3RbY29udHJhY3RIYXNoXSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVzZVdoaXRlbGlzdChib29sIHVzZVdoaXRlbGlzdCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICB1c2VQbHVnaW5XaGl0ZWxpc3QgPSB1c2VXaGl0ZWxpc3Q7CiAgICB9CgogICAgZnVuY3Rpb24gaXNWYWxpZFBsdWdpbihhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoIXVzZVBsdWdpbldoaXRlbGlzdCB8fCBhZGRyID09IDB4MCkgcmV0dXJuIHRydWU7CgogICAgICAgIGJ5dGVzMzIgY29udHJhY3RIYXNoID0gZ2V0Q29kZUhhc2goYWRkcik7CgogICAgICAgIHJldHVybiBwbHVnaW5XaGl0ZWxpc3RbY29udHJhY3RIYXNoXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlSGFzaChhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJ5dGVzMzIpIHsKICAgICAgICBieXRlcyBtZW1vcnkgb19jb2RlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gcmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUsIHRoaXMgbmVlZHMgYXNzZW1ibHkKICAgICAgICAgICAgbGV0IHNpemUgOj0gZXh0Y29kZXNpemUoYWRkcikKICAgICAgICAgICAgLy8gYWxsb2NhdGUgb3V0cHV0IGJ5dGUgYXJyYXkgLSB0aGlzIGNvdWxkIGFsc28gYmUgZG9uZSB3aXRob3V0IGFzc2VtYmx5CiAgICAgICAgICAgIC8vIGJ5IHVzaW5nIG9fY29kZSA9IG5ldyBieXRlcyhzaXplKQogICAgICAgICAgICBvX2NvZGUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgLy8gbmV3ICJtZW1vcnkgZW5kIiBpbmNsdWRpbmcgcGFkZGluZwogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKG9fY29kZSwgYW5kKGFkZChhZGQoc2l6ZSwgMHgyMCksIDB4MWYpLCBub3QoMHgxZikpKSkKICAgICAgICAgICAgLy8gc3RvcmUgbGVuZ3RoIGluIG1lbW9yeQogICAgICAgICAgICBtc3RvcmUob19jb2RlLCBzaXplKQogICAgICAgICAgICAvLyBhY3R1YWxseSByZXRyaWV2ZSB0aGUgY29kZSwgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICBleHRjb2RlY29weShhZGRyLCBhZGQob19jb2RlLCAweDIwKSwgMCwgc2l6ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGtlY2NhazI1NihvX2NvZGUpOwogICAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy9saXF1aWRwbGVkZ2luZy9jb250cmFjdHMvTGlxdWlkUGxlZGdpbmcuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hCiAgICBDb250cmlidXRvcjogQWRyaSYjMjI0OyBNYXNzYW5ldCA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5NWY0ZjFlN2ZjZjRkNWY2ZmFmMWYwZjZmYWZiZTFmMGVkZTFiYmZjZmEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgovLyBDb250cmFjdCBJbXBvcnRzCgoKLy8vIEBkZXYgYExpcXVpZFBsZWRpbmdgIGFsbG93cyBmb3IgbGlxdWlkIHBsZWRnaW5nIHRocm91Z2ggdGhlIHVzZSBvZgovLy8gIGludGVybmFsIGlkIHN0cnVjdHVyZXMgYW5kIGRlbGVnYXRlIGNoYWluaW5nLiBBbGwgYmFzaWMgb3BlcmF0aW9ucyBmb3IKLy8vICBoYW5kbGluZyBsaXF1aWQgcGxlZGdpbmcgYXJlIHN1cHBsaWVkIGFzIHdlbGwgYXMgcGx1Z2luIGZlYXR1cmVzCi8vLyAgdG8gYWxsb3cgZm9yIGV4cGFuZGVkIGZ1bmN0aW9uYWxpdHkuCmNvbnRyYWN0IExpcXVpZFBsZWRnaW5nIGlzIExpcXVpZFBsZWRnaW5nQmFzZSB7CgoKLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEJhc2ljIGNvbnN0cnVjdG9yIGZvciBMaXF1aWRQbGVkaW5nLCBhbHNvIGNhbGxzIHRoZQogICAgLy8vICBMaXF1aWRQbGVkZ2luZ0Jhc2UgY29udHJhY3QKICAgIC8vLyBAZGV2IFRoaXMgY29uc3RydWN0b3IgIGFsc28gY2FsbHMgdGhlIGNvbnN0cnVjdG9yIAogICAgLy8vICBmb3IgYExpcXVpZFBsZWRnaW5nQmFzZWAKICAgIC8vLyBAcGFyYW0gX3ZhdWx0IFRoZSB2YXVsdCB3aGVyZSBFVEggYmFja2luZyB0aGlzIHBsZWRnZSBpcyBzdG9yZWQKICAgIGZ1bmN0aW9uIExpcXVpZFBsZWRnaW5nKAogICAgICAgIGFkZHJlc3MgX3ZhdWx0LAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoRGVzdGluYXRpb24KICAgICkgTGlxdWlkUGxlZGdpbmdCYXNlKF92YXVsdCwgX2VzY2FwZUhhdGNoQ2FsbGVyLCBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbikgewoKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIGhvdyB2YWx1ZSBlbnRlcnMgaW50byB0aGUgc3lzdGVtIHdoaWNoIGNyZWF0ZXMgcGxlZGdlczsKICAgIC8vLyAgdGhlIHRva2VuIG9mIHZhbHVlIGdvZXMgaW50byB0aGUgdmF1bHQgYW5kIHRoZSBhbW91bnQgaW4gdGhlIHBsZWRnZQogICAgLy8vICByZWxldmFudCB0byB0aGlzIEdpdmVyIHdpdGhvdXQgZGVsZWdhdGVzIGlzIGluY3JlYXNlZCwgYW5kIGEgbm9ybWFsCiAgICAvLy8gIHRyYW5zZmVyIGlzIGRvbmUgdG8gdGhlIGlkUmVjZWl2ZXIKICAgIC8vLyBAcGFyYW0gaWRHaXZlciBJZGVudGlmaWVyIG9mIHRoZSBnaXZlciB0aGF0cyBkb25hdGluZy4KICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUbyB3aG9tIGl0J3MgdHJhbnNmZXJlZC4gQ2FuIGJlIHRoZSBzYW1lIGdpdmVyLAogICAgLy8vICBhbm90aGVyIGdpdmVyLCBhIGRlbGVnYXRlIG9yIGEgcHJvamVjdC4KICAgIGZ1bmN0aW9uIGRvbmF0ZSh1aW50NjQgaWRHaXZlciwgdWludDY0IGlkUmVjZWl2ZXIpIHBheWFibGUgewogICAgICAgIGlmIChpZEdpdmVyID09IDApIHsKICAgICAgICAgICAgLy8gZGVmYXVsdCB0byAzIGRheSBjb21taXRUaW1lCiAgICAgICAgICAgIGlkR2l2ZXIgPSBhZGRHaXZlcigiIiwgIiIsIDI1OTIwMCwgSUxpcXVpZFBsZWRnaW5nUGx1Z2luKDB4MCkpOwogICAgICAgIH0KCiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBzZW5kZXIgPSBmaW5kQWRtaW4oaWRHaXZlcik7CgogICAgICAgIGNoZWNrQWRtaW5Pd25lcihzZW5kZXIpOwoKICAgICAgICByZXF1aXJlKHNlbmRlci5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLkdpdmVyKTsKCiAgICAgICAgdWludCBhbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIHJlcXVpcmUoYW1vdW50ID4gMCk7CgogICAgICAgIHZhdWx0LnRyYW5zZmVyKGFtb3VudCk7IC8vIHRyYW5zZmVycyB0aGUgYmFzZVRva2VuIHRvIHRoZSBWYXVsdAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgaWRHaXZlciwKICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLCAvL3doYXQgaXMgbmV3PwogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKCgogICAgICAgIFBsZWRnZSBzdG9yYWdlIG5UbyA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIG5Uby5hbW91bnQgKz0gYW1vdW50OwoKICAgICAgICBUcmFuc2ZlcigwLCBpZFBsZWRnZSwgYW1vdW50KTsKCiAgICAgICAgdHJhbnNmZXIoaWRHaXZlciwgaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIE1vdmVzIHZhbHVlIGJldHdlZW4gcGxlZGdlcwogICAgLy8vIEBwYXJhbSBpZFNlbmRlciBJRCBvZiB0aGUgZ2l2ZXIsIGRlbGVnYXRlIG9yIHByb2plY3QgYWRtaW4gdGhhdCBpcyAKICAgIC8vLyAgdHJhbnNmZXJyaW5nIHRoZSBmdW5kcyBmcm9tIFBsZWRnZSB0byBQbGVkZ2U7IHRoaXMgYWRtaW4gbXVzdCBoYXZlIAogICAgLy8vICBwZXJtaXNzaW9ucyB0byBtb3ZlIHRoZSB2YWx1ZQogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQncyBtb3ZpbmcgdGhlIHZhbHVlCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3MgYmVpbmcgbW92ZWQKICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBEZXN0aW5hdGlvbiBvZiB0aGUgdmFsdWUsIGNhbiBiZSBhIGdpdmVyIHNlbmRpbmcgdG8gCiAgICAvLy8gIGEgZ2l2ZXIgb3IgYSBkZWxlZ2F0ZSwgYSBkZWxlZ2F0ZSB0byBhbm90aGVyIGRlbGVnYXRlIG9yIGEgcHJvamVjdCAKICAgIC8vLyAgdG8gcHJlLWNvbW1pdCBpdCB0byB0aGF0IHByb2plY3QgaWYgY2FsbGVkIGZyb20gYSBkZWxlZ2F0ZSwKICAgIC8vLyAgb3IgdG8gY29tbWl0IGl0IHRvIHRoZSBwcm9qZWN0IGlmIGNhbGxlZCBmcm9tIHRoZSBvd25lci4gCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICB1aW50NjQgaWRTZW5kZXIsCiAgICAgICAgdWludDY0IGlkUGxlZGdlLAogICAgICAgIHVpbnQgYW1vdW50LAogICAgICAgIHVpbnQ2NCBpZFJlY2VpdmVyCiAgICApCiAgICB7CgogICAgICAgIGlkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcmVjZWl2ZXIgPSBmaW5kQWRtaW4oaWRSZWNlaXZlcik7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBzZW5kZXIgPSBmaW5kQWRtaW4oaWRTZW5kZXIpOwoKICAgICAgICBjaGVja0FkbWluT3duZXIoc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGxlZGdlZCk7CgogICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaXMgdGhlIG93bmVyCiAgICAgICAgaWYgKHAub3duZXIgPT0gaWRTZW5kZXIpIHsKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcihpZFBsZWRnZSwgYW1vdW50LCBpZFJlY2VpdmVyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlci5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyT3duZXJzaGlwVG9Qcm9qZWN0KGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuRGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIGlkUGxlZGdlID0gdW5kZWxlZ2F0ZSgKICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYXBwZW5kRGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhc3NlcnQoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaXMgYSBkZWxlZ2F0ZQogICAgICAgIHVpbnQgc2VuZGVyRElkeCA9IGdldERlbGVnYXRlSWR4KHAsIGlkU2VuZGVyKTsKICAgICAgICBpZiAoc2VuZGVyRElkeCAhPSBOT1RGT1VORCkgewoKICAgICAgICAgICAgLy8gSWYgdGhlIHJlY2VpdmVyIGlzIGFub3RoZXIgZ2l2ZXIKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHsKICAgICAgICAgICAgICAgIC8vIE9ubHkgYWNjZXB0IHRvIGNoYW5nZSB0byB0aGUgb3JpZ2luYWwgZ2l2ZXIgdG8KICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbGwgZGVsZWdhdGVzCiAgICAgICAgICAgICAgICBhc3NlcnQocC5vd25lciA9PSBpZFJlY2VpdmVyKTsKICAgICAgICAgICAgICAgIHVuZGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIHJlY2VpdmVyIGlzIGFub3RoZXIgZGVsZWdhdGUKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuRGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIHVpbnQgcmVjZWl2ZXJESWR4ID0gZ2V0RGVsZWdhdGVJZHgocCwgaWRSZWNlaXZlcik7CgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlY2VpdmVyIGlzIG5vdCBpbiB0aGUgZGVsZWdhdGUgbGlzdAogICAgICAgICAgICAgICAgaWYgKHJlY2VpdmVyRElkeCA9PSBOT1RGT1VORCkgewogICAgICAgICAgICAgICAgICAgIGlkUGxlZGdlID0gdW5kZWxlZ2F0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gc2VuZGVyRElkeCAtIDEKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGFwcGVuZERlbGVnYXRlKGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSByZWNlaXZlciBpcyBhbHJlYWR5IHBhcnQgb2YgdGhlIGRlbGVnYXRlIGNoYWluIGFuZCBpcwogICAgICAgICAgICAgICAgLy8gYWZ0ZXIgdGhlIHNlbmRlciwgdGhlbiBhbGwgb2YgdGhlIG90aGVyIGRlbGVnYXRlcyBhZnRlciB0aGUKICAgICAgICAgICAgICAgIC8vIHNlbmRlciBhcmUgcmVtb3ZlZCBhbmQgdGhlIHJlY2VpdmVyIGlzIGFwcGVuZGVkIGF0IHRoZQogICAgICAgICAgICAgICAgLy8gZW5kIG9mIHRoZSBkZWxlZ2F0aW9uIGNoYWluCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlY2VpdmVyRElkeCA+IHNlbmRlckRJZHgpIHsKICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSA9IHVuZGVsZWdhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGlkUGxlZGdlLAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCAtIHNlbmRlckRJZHggLSAxCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBhcHBlbmREZWxlZ2F0ZShpZFBsZWRnZSwgYW1vdW50LCBpZFJlY2VpdmVyKTsKCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmVjZWl2ZXIgaXMgYWxyZWFkeSBwYXJ0IG9mIHRoZSBkZWxlZ2F0ZSBjaGFpbiBhbmQgaXMKICAgICAgICAgICAgICAgIC8vIGJlZm9yZSB0aGUgc2VuZGVyLCB0aGVuIHRoZSBzZW5kZXIgYW5kIGFsbCBvZiB0aGUgb3RoZXIKICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlcyBhZnRlciB0aGUgUkVDRUlWRVIgYXJlIHJlbW92ZWQgZnJvbSB0aGUgY2hhaW4sCiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGludGVyZXN0aW5nIGJlY2F1c2UgdGhlIGRlbGVnYXRlIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlcyB0aGF0IGRlbGVnYXRlZCB0byB0aGlzIGRlbGVnYXRlLiBBcmUgdGhlcmUgZ2FtZSB0aGVvcnkKICAgICAgICAgICAgICAgIC8vIGlzc3Vlcz8gc2hvdWxkIHRoaXMgYmUgYWxsb3dlZD8KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjZWl2ZXJESWR4IDw9IHNlbmRlckRJZHgpIHsKICAgICAgICAgICAgICAgICAgICB1bmRlbGVnYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSByZWNlaXZlckRJZHggLSAxCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIGRlbGVnYXRlIHdhbnRzIHRvIHN1cHBvcnQgYSBwcm9qZWN0LCB0aGV5IHJlbW92ZSBhbGwKICAgICAgICAgICAgLy8gdGhlIGRlbGVnYXRlcyBhZnRlciB0aGVtIGluIHRoZSBjaGFpbiBhbmQgY2hvb3NlIGEgcHJvamVjdAogICAgICAgICAgICBpZiAocmVjZWl2ZXIuYWRtaW5UeXBlID09IFBsZWRnZUFkbWluVHlwZS5Qcm9qZWN0KSB7CiAgICAgICAgICAgICAgICBpZFBsZWRnZSA9IHVuZGVsZWdhdGUoCiAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCAtIHNlbmRlckRJZHggLSAxCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcHJvcG9zZUFzc2lnblByb2plY3QoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNzZXJ0KGZhbHNlKTsgIC8vIEl0IGlzIG5vdCB0aGUgb3duZXIgbm9yIGFueSBkZWxlZ2F0ZS4KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIHdpdGhkcmF3IHZhbHVlIGZyb20gdGhlIHN5c3RlbS4KICAgIC8vLyAgVGhpcyBjYW4gYmUgdXNlZCBieSB0aGUgZ2l2ZXJzIHdpdGhkcmF3IGFueSB1bi1jb21taXRlZCBkb25hdGlvbnMuCiAgICAvLy8gQHBhcmFtIGlkUGxlZGdlIElkIG9mIHRoZSBwbGVkZ2UgdGhhdCB3YW50cyB0byBiZSB3aXRoZHJhd24uCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiBFdGhlciB0aGF0IHdhbnRzIHRvIGJlIHdpdGhkcmF3bi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIHsKCiAgICAgICAgaWRQbGVkZ2UgPSBub3JtYWxpemVQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CgogICAgICAgIHJlcXVpcmUocC5wbGVkZ2VTdGF0ZSA9PSBQbGVkZ2VTdGF0ZS5QbGVkZ2VkKTsKCiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBvd25lciA9IGZpbmRBZG1pbihwLm93bmVyKTsKCiAgICAgICAgY2hlY2tBZG1pbk93bmVyKG93bmVyKTsKCiAgICAgICAgdWludDY0IGlkTmV3UGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBheWluZwogICAgICAgICk7CgogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIGlkTmV3UGxlZGdlLCBhbW91bnQpOwoKICAgICAgICB2YXVsdC5hdXRob3JpemVQYXltZW50KGJ5dGVzMzIoaWROZXdQbGVkZ2UpLCBvd25lci5hZGRyLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1ldGhvZCBjYWxsZWQgYnkgdGhlIHZhdWx0IHRvIGNvbmZpcm0gYSBwYXltZW50LgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgd2FudHMgdG8gYmUgd2l0aGRyYXduLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgRXRoZXIgdGhhdCB3YW50cyB0byBiZSB3aXRoZHJhd24uCiAgICBmdW5jdGlvbiBjb25maXJtUGF5bWVudCh1aW50NjQgaWRQbGVkZ2UsIHVpbnQgYW1vdW50KSBvbmx5VmF1bHQgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgcmVxdWlyZShwLnBsZWRnZVN0YXRlID09IFBsZWRnZVN0YXRlLlBheWluZyk7CgogICAgICAgIHVpbnQ2NCBpZE5ld1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4sCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHAub2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QYWlkCiAgICAgICAgKTsKCiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgaWROZXdQbGVkZ2UsIGFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTWV0aG9kIGNhbGxlZCBieSB0aGUgdmF1bHQgdG8gY2FuY2VsIGEgcGF5bWVudC4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0IHdhbnRzIHRvIGJlIGNhbmNlbGVkIGZvciB3aXRoZHJhdy4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIEV0aGVyIHRoYXQgd2FudHMgdG8gYmUgcm9sbGVkIGJhY2suCiAgICBmdW5jdGlvbiBjYW5jZWxQYXltZW50KHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIG9ubHlWYXVsdCB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGF5aW5nKTsgLy9UT0RPIGNoYW5nZSB0byByZXZlcnQKCiAgICAgICAgLy8gV2hlbiBhIHBheW1lbnQgaXMgY2FuY2VsZWQsIG5ldmVyIGlzIGFzc2lnbmVkIHRvIGEgcHJvamVjdC4KICAgICAgICB1aW50NjQgb2xkUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICApOwoKICAgICAgICBvbGRQbGVkZ2UgPSBub3JtYWxpemVQbGVkZ2Uob2xkUGxlZGdlKTsKCiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgb2xkUGxlZGdlLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1ldGhvZCBjYWxsZWQgdG8gY2FuY2VsIHRoaXMgcHJvamVjdC4KICAgIC8vLyBAcGFyYW0gaWRQcm9qZWN0IElkIG9mIHRoZSBwcm9qY3QgdGhhdCB3YW50cyB0byBiZSBjYW5jZWxlZC4KICAgIGZ1bmN0aW9uIGNhbmNlbFByb2plY3QodWludDY0IGlkUHJvamVjdCkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcHJvamVjdCA9IGZpbmRBZG1pbihpZFByb2plY3QpOwogICAgICAgIGNoZWNrQWRtaW5Pd25lcihwcm9qZWN0KTsKICAgICAgICBwcm9qZWN0LmNhbmNlbGVkID0gdHJ1ZTsKCiAgICAgICAgQ2FuY2VsUHJvamVjdChpZFByb2plY3QpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1ldGhvZCBjYWxsZWQgdG8gY2FuY2VsIHNwZWNpZmljIHBsZWRnZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0IHNob3VsZCBiZSBjYW5jZWxlZC4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIEV0aGVyIHRoYXQgd2FudHMgdG8gYmUgcm9sbGVkIGJhY2suCiAgICBmdW5jdGlvbiBjYW5jZWxQbGVkZ2UodWludDY0IGlkUGxlZGdlLCB1aW50IGFtb3VudCkgewogICAgICAgIGlkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIHJlcXVpcmUocC5vbGRQbGVkZ2UgIT0gMCk7CgogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihwLm93bmVyKTsKICAgICAgICBjaGVja0FkbWluT3duZXIobSk7CgogICAgICAgIHVpbnQ2NCBvbGRQbGVkZ2UgPSBnZXRPbGRlc3RQbGVkZ2VOb3RDYW5jZWxlZChwLm9sZFBsZWRnZSk7CiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgb2xkUGxlZGdlLCBhbW91bnQpOwogICAgfQoKCi8vLy8vLy8vCi8vIE11bHRpIHBsZWRnZSBtZXRob2RzCi8vLy8vLy8vCgogICAgLy8gQGRldiBUaGlzIHNldCBvZiBmdW5jdGlvbnMgbWFrZXMgbW92aW5nIGEgbG90IG9mIHBsZWRnZXMgYXJvdW5kIG11Y2ggbW9yZQogICAgLy8gZWZmaWNpZW50IChzYXZlcyBnYXMpIHRoYW4gY2FsbGluZyB0aGVzZSBmdW5jdGlvbnMgaW4gc2VyaWVzCiAgICAKICAgIAogICAgLy8vIEJpdCBtYXNrIHVzZWQgZm9yIGRpdmlkaW5nIHBsZWRnZSBhbW91bnRzIGluIE11bHRpIHBsZWRnZSBtZXRob2RzCiAgICB1aW50IGNvbnN0YW50IEQ2NCA9IDB4MTAwMDAwMDAwMDAwMDAwMDA7CgogICAgLy8vIEBub3RpY2UgYG1UcmFuc2ZlcmAgYWxsb3dzIGZvciBtdWx0aXBsZSBwbGVkZ2VzIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIGlkU2VuZGVyIElEIG9mIHRoZSBnaXZlciwgZGVsZWdhdGUgb3IgcHJvamVjdCBhZG1pbiB0aGF0IGlzCiAgICAvLy8gIHRyYW5zZmVycmluZyB0aGUgZnVuZHMgZnJvbSBQbGVkZ2UgdG8gUGxlZGdlLiBUaGlzIGFkbWluIG11c3QgaGF2ZSAKICAgIC8vLyAgcGVybWlzc2lvbnMgdG8gbW92ZSB0aGUgdmFsdWUKICAgIC8vLyBAcGFyYW0gcGxlZGdlc0Ftb3VudHMgQW4gYXJyYXkgb2YgcGxlZGdlIGFtb3VudHMgYW5kIElEcyB3aGljaCBhcmUgZXh0cmFwb2xhdGVkCiAgICAvLy8gIHVzaW5nIHRoZSBENjQgYml0bWFzawogICAgLy8vIEBwYXJhbSBpZFJlY2VpdmVyIERlc3RpbmF0aW9uIG9mIHRoZSB2YWx1ZSwgY2FuIGJlIGEgZ2l2ZXIgc2VuZGluZwogICAgLy8vICB0byBhIGdpdmVyIG9yIGEgZGVsZWdhdGUgb3IgYSBkZWxlZ2F0ZSB0byBhbm90aGVyIGRlbGVnYXRlIG9yIGEKICAgIC8vLyAgcHJvamVjdCB0byBwcmUtY29tbWl0IGl0IHRvIHRoYXQgcHJvamVjdAogICAgZnVuY3Rpb24gbVRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBpZFNlbmRlciwKICAgICAgICB1aW50W10gcGxlZGdlc0Ftb3VudHMsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXNBbW91bnRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB1aW50NjQgaWRQbGVkZ2UgPSB1aW50NjQoIHBsZWRnZXNBbW91bnRzW2ldICYgKEQ2NC0xKSApOwogICAgICAgICAgICB1aW50IGFtb3VudCA9IHBsZWRnZXNBbW91bnRzW2ldIC8gRDY0OwoKICAgICAgICAgICAgdHJhbnNmZXIoaWRTZW5kZXIsIGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbVdpdGhkcmF3YCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUKICAgIC8vLyAgd2l0aGRyYXduIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIHBsZWRnZXNBbW91bnRzIEFuIGFycmF5IG9mIHBsZWRnZSBhbW91bnRzIGFuZCBJRHMgd2hpY2ggYXJlCiAgICAvLy8gIGV4dHJhcG9sYXRlZCB1c2luZyB0aGUgRDY0IGJpdG1hc2sKICAgIGZ1bmN0aW9uIG1XaXRoZHJhdyh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIHdpdGhkcmF3KGlkUGxlZGdlLCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbUNvbmZpcm1QYXltZW50YCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUgY29uZmlybWVkCiAgICAvLy8gIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIHBsZWRnZXNBbW91bnRzIEFuIGFycmF5IG9mIHBsZWRnZSBhbW91bnRzIGFuZCBJRHMgd2hpY2ggYXJlIGV4dHJhcG9sYXRlZAogICAgLy8vICB1c2luZyB0aGUgRDY0IGJpdG1hc2sKICAgIGZ1bmN0aW9uIG1Db25maXJtUGF5bWVudCh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIGNvbmZpcm1QYXltZW50KGlkUGxlZGdlLCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbUNhbmNlbFBheW1lbnRgIGFsbG93cyBmb3IgbXVsdGlwbGUgcGxlZGdlcyB0byBiZSBjYW5jZWxlZAogICAgLy8vICBlZmZpY2llbnRseQogICAgLy8vIEBwYXJhbSBwbGVkZ2VzQW1vdW50cyBBbiBhcnJheSBvZiBwbGVkZ2UgYW1vdW50cyBhbmQgSURzIHdoaWNoIGFyZSBleHRyYXBvbGF0ZWQKICAgIC8vLyAgdXNpbmcgdGhlIEQ2NCBiaXRtYXNrCiAgICBmdW5jdGlvbiBtQ2FuY2VsUGF5bWVudCh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIGNhbmNlbFBheW1lbnQoaWRQbGVkZ2UsIGFtb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtTm9ybWFsaXplUGxlZGdlYCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUKICAgIC8vLyAgbm9ybWFsaXplZCBlZmZpY2llbnRseQogICAgLy8vIEBwYXJhbSBwbGVkZ2VzIEFuIGFycmF5IG9mIHBsZWRnZSBJRHMKICAgIGZ1bmN0aW9uIG1Ob3JtYWxpemVQbGVkZ2UodWludDY0W10gcGxlZGdlcykgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIG5vcm1hbGl6ZVBsZWRnZSggcGxlZGdlc1tpXSApOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vCi8vIFByaXZhdGUgbWV0aG9kcwovLy8vLy8vCgogICAgLy8vIEBub3RpY2UgYHRyYW5zZmVyT3duZXJzaGlwVG9Qcm9qZWN0YCBhbGxvd3MgZm9yIHRoZSB0cmFuc2ZlciBvZgogICAgLy8vICBvd25lcnNoaXAgdG8gdGhlIHByb2plY3QsIGJ1dCBpdCBjYW4gYWxzbyBiZSBjYWxsZWQgYnkgYSBwcm9qZWN0CiAgICAvLy8gIHRvIHVuLWRlbGVnYXRlIGV2ZXJ5b25lIGJ5IHNldHRpbmcgb25lJ3Mgb3duIGlkIGZvciB0aGUgaWRSZWNlaXZlcgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRvIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3MgYmVpbmcgdHJhbnNmZXJlZAogICAgLy8vIEBwYXJhbSBpZFJlY2VpdmVyIFRoZSBuZXcgb3duZXIgb2YgdGhlIHByb2plY3QgKG9yIHNlbGYgdG8gdW4tZGVsZWdhdGUpCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcFRvUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIHBsZWRnZSBpcyBub3QgYWxyZWFkeSBhdCBtYXggcGxlZGdlIGRlcHRoCiAgICAgICAgLy8gYW5kIHRoZSBwcm9qZWN0IGhhcyBub3QgYmVlbiBjYW5jZWxlZAogICAgICAgIHJlcXVpcmUoZ2V0UGxlZGdlTGV2ZWwocCkgPCBNQVhfSU5URVJQUk9KRUNUX0xFVkVMKTsKICAgICAgICByZXF1aXJlKCFpc1Byb2plY3RDYW5jZWxlZChpZFJlY2VpdmVyKSk7CgogICAgICAgIHVpbnQ2NCBvbGRQbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgUGxlZGdlU3RhdGUuUGxlZGdlZAogICAgICAgICk7CiAgICAgICAgdWludDY0IHRvUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBpZFJlY2VpdmVyLCAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmV3IG93bmVyCiAgICAgICAgICAgIG5ldyB1aW50NjRbXSgwKSwgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGhlIGRlbGVnYXRpb24gY2hhaW4KICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgb2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0gICAKCgogICAgLy8vIEBub3RpY2UgYHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcmAgYWxsb3dzIGZvciB0aGUgdHJhbnNmZXIgb2YKICAgIC8vLyAgdmFsdWUgYmFjayB0byB0aGUgR2l2ZXIsIHZhbHVlIGlzIHBsYWNlZCBpbiBhIHBsZWRnZWQgc3RhdGUKICAgIC8vLyAgd2l0aG91dCBiZWluZyBhdHRhY2hlZCB0byBhIHByb2plY3QsIGRlbGVnYXRpb24gY2hhaW4sIG9yIHRpbWUgbGluZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgdmFsdWUgdGhhdCdzIGJlaW5nIHRyYW5zZmVyZWQKICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUaGUgbmV3IG93bmVyIG9mIHRoZSBwbGVkZ2UKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcigKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgaWRSZWNlaXZlciwKICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgYXBwZW5kRGVsZWdhdGVgIGFsbG93cyBmb3IgYSBkZWxlZ2F0ZSB0byBiZSBhZGRlZCBvbnRvIHRoZQogICAgLy8vICBlbmQgb2YgdGhlIGRlbGVnYXRlIGNoYWluIGZvciBhIGdpdmVuIFBsZWRnZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0cyBkZWxlZ2F0ZSBjaGFpbiB3aWxsIGJlIG1vZGlmaWVkLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgdmFsdWUgdGhhdCdzIGJlaW5nIGNoYWluZWQuCiAgICAvLy8gQHBhcmFtIGlkUmVjZWl2ZXIgVGhlIGRlbGVnYXRlIHRvIGJlIGFkZGVkIGF0IHRoZSBlbmQgb2YgdGhlIGNoYWluCiAgICBmdW5jdGlvbiBhcHBlbmREZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgcmVxdWlyZShwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggPCBNQVhfREVMRUdBVEVTKTsKICAgICAgICB1aW50NjRbXSBtZW1vcnkgbmV3RGVsZWdhdGlvbkNoYWluID0gbmV3IHVpbnQ2NFtdKAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggKyAxCiAgICAgICAgKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGk8cC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW2ldID0gcC5kZWxlZ2F0aW9uQ2hhaW5baV07CiAgICAgICAgfQoKICAgICAgICAvLyBNYWtlIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIGFycmF5IHRoZSBpZFJlY2VpdmVyCiAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW3AuZGVsZWdhdGlvbkNoYWluLmxlbmd0aF0gPSBpZFJlY2VpdmVyOwoKICAgICAgICB1aW50NjQgdG9QbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIG5ld0RlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICApOwogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBhcHBlbmREZWxlZ2F0ZWAgYWxsb3dzIGZvciBhIGRlbGVnYXRlIHRvIGJlIGFkZGVkIG9udG8gdGhlCiAgICAvLy8gIGVuZCBvZiB0aGUgZGVsZWdhdGUgY2hhaW4gZm9yIGEgZ2l2ZW4gUGxlZGdlLgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXRzIGRlbGVnYXRlIGNoYWluIHdpbGwgYmUgbW9kaWZpZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3Mgc2hpZnRlZCBmcm9tIGRlbGVnYXRlcy4KICAgIC8vLyBAcGFyYW0gcSBOdW1iZXIgKG9yIGRlcHRoKSB0byByZW1vdmUgYXMgZGVsZWdhdGVzCiAgICBmdW5jdGlvbiB1bmRlbGVnYXRlKAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSwKICAgICAgICB1aW50IGFtb3VudCwKICAgICAgICB1aW50IHEKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludDY0KXsKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CiAgICAgICAgdWludDY0W10gbWVtb3J5IG5ld0RlbGVnYXRpb25DaGFpbiA9IG5ldyB1aW50NjRbXSgKICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gcQogICAgICAgICk7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSBxOyBpKyspIHsKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW2ldID0gcC5kZWxlZ2F0aW9uQ2hhaW5baV07CiAgICAgICAgfQogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgUGxlZGdlU3RhdGUuUGxlZGdlZAogICAgICAgICk7CiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgdG9QbGVkZ2UsIGFtb3VudCk7CgogICAgICAgIHJldHVybiB0b1BsZWRnZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgcHJvcG9zZUFzc2lnblByb2plY3RgIHByb3Bvc2VzIHRoZSBhc3NpZ25tZW50IG9mIGEgcGxlZGdlCiAgICAvLy8gIHRvIGEgc3BlY2lmaWMgcHJvamVjdC4KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gc2hvdWxkIHBvdGVudGlhbGx5IGJlIG5hbWVkIG1vcmUgc3BlY2lmaWNhbGx5LgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgd2lsbCBiZSBhc3NpZ25lZC4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIHZhbHVlIHRoaXMgcGxlZGdlIGxlYWRlciB3b3VsZCBiZSBhc3NpZ25lZC4KICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUaGUgcHJvamVjdCB0aGlzIHBsZWRnZSB3aWxsIHBvdGVudGlhbGx5IAogICAgLy8vICBiZSBhc3NpZ25lZCB0by4KICAgIGZ1bmN0aW9uIHByb3Bvc2VBc3NpZ25Qcm9qZWN0KAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSwKICAgICAgICB1aW50IGFtb3VudCwKICAgICAgICB1aW50NjQgaWRSZWNlaXZlcgogICAgKSBpbnRlcm5hbCB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICByZXF1aXJlKGdldFBsZWRnZUxldmVsKHApIDwgTUFYX0lOVEVSUFJPSkVDVF9MRVZFTCk7CiAgICAgICAgcmVxdWlyZSghaXNQcm9qZWN0Q2FuY2VsZWQoaWRSZWNlaXZlcikpOwoKICAgICAgICB1aW50NjQgdG9QbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICBpZFJlY2VpdmVyLAogICAgICAgICAgICB1aW50NjQoZ2V0VGltZSgpICsgbWF4Q29tbWl0VGltZShwKSksCiAgICAgICAgICAgIHAub2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgZG9UcmFuc2ZlcmAgaXMgZGVzaWduZWQgdG8gYWxsb3cgZm9yIHBsZWRnZSBhbW91bnRzIHRvIGJlIAogICAgLy8vICBzaGlmdGVkIGFyb3VuZCBpbnRlcm5hbGx5LgogICAgLy8vIEBwYXJhbSBmcm9tIFRoaXMgaXMgdGhlIElkIGZyb20gd2hpY2ggdmFsdWUgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSB0byBUaGlzIGlzIHRoZSBJZCB0aGF0IHZhbHVlIHdpbGwgYmUgdHJhbnNmZXJlZCB0by4KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gZG9UcmFuc2Zlcih1aW50NjQgZnJvbSwgdWludDY0IHRvLCB1aW50IF9hbW91bnQpIGludGVybmFsIHsKICAgICAgICB1aW50IGFtb3VudCA9IGNhbGxQbHVnaW5zKHRydWUsIGZyb20sIHRvLCBfYW1vdW50KTsKICAgICAgICBpZiAoZnJvbSA9PSB0bykgeyAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoYW1vdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBuRnJvbSA9IGZpbmRQbGVkZ2UoZnJvbSk7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgblRvID0gZmluZFBsZWRnZSh0byk7CiAgICAgICAgcmVxdWlyZShuRnJvbS5hbW91bnQgPj0gYW1vdW50KTsKICAgICAgICBuRnJvbS5hbW91bnQgLT0gYW1vdW50OwogICAgICAgIG5Uby5hbW91bnQgKz0gYW1vdW50OwoKICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgYW1vdW50KTsKICAgICAgICBjYWxsUGx1Z2lucyhmYWxzZSwgZnJvbSwgdG8sIGFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG5vcm1hbGl6ZVBsZWRnZWAgb25seSBhZmZlY3RzIHBsZWRnZXMgd2l0aCB0aGUgUGxlZGdlZCBQbGVkZ2VTdGF0ZQogICAgLy8vIGFuZCBkb2VzIDIgdGhpbmdzOgogICAgLy8vICAgIzE6IENoZWNrcyBpZiB0aGUgcGxlZGdlIHNob3VsZCBiZSBjb21taXR0ZWQuIFRoaXMgbWVhbnMgdGhhdAogICAgLy8vICAgICAgIGlmIHRoZSBwbGVkZ2UgaGFzIGFuIGludGVuZGVkUHJvamVjdCBhbmQgaXQgaXMgcGFzdCB0aGUKICAgIC8vLyAgICAgICBjb21taXRUaW1lLCBpdCBjaGFuZ2VzIHRoZSBvd25lciB0byBiZSB0aGUgcHJvcG9zZWQgcHJvamVjdAogICAgLy8vICAgICAgIChUaGUgVUkgd2lsbCBoYXZlIHRvIHJlYWQgdGhlIGNvbW1pdCB0aW1lIGFuZCBtYW51YWxseSBkbyB3aGF0CiAgICAvLy8gICAgICAgdGhpcyBmdW5jdGlvbiBkb2VzIHRvIHRoZSBwbGVkZ2UgZm9yIHRoZSBlbmQgdXNlcgogICAgLy8vICAgICAgIGF0IHRoZSBleHBpcmF0aW9uIG9mIHRoZSBjb21taXRUaW1lKQogICAgLy8vCiAgICAvLy8gICAjMjogQ2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IGlmIHRoZXJlIGhhcyBiZWVuIGEgY2FuY2VsbGF0aW9uIGluIHRoZQogICAgLy8vICAgICAgIGNoYWluIG9mIHByb2plY3RzLCB0aGUgcGxlZGdlJ3Mgb3duZXIgaGFzIGJlZW4gY2hhbmdlZAogICAgLy8vICAgICAgIGFwcHJvcHJpYXRlbHkuCiAgICAvLy8KICAgIC8vLyBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgYnkgYW55Ym9keSBhdCBhbnl0aW1lIG9uIGFueSBwbGVkZ2UuCiAgICAvLy8gSW4gZ2VuZXJhbCBpdCBjYW4gYmUgY2FsbGVkIHRvIGZvcmNlIHRoZSBjYWxscyBvZiB0aGUgYWZmZWN0ZWQgCiAgICAvLy8gcGx1Z2lucywgd2hpY2ggYWxzbyBuZWVkIHRvIGJlIHByZWRpY3RlZCBieSB0aGUgVUkKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhpcyBpcyB0aGUgaWQgb2YgdGhlIHBsZWRnZSB0aGF0IHdpbGwgYmUgbm9ybWFsaXplZAogICAgZnVuY3Rpb24gbm9ybWFsaXplUGxlZGdlKHVpbnQ2NCBpZFBsZWRnZSkgcmV0dXJucyh1aW50NjQpIHsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICAvLyBDaGVjayB0byBtYWtlIHN1cmUgdGhpcyBwbGVkZ2UgaGFzbid0IGFscmVhZHkgYmVlbiB1c2VkIAogICAgICAgIC8vIG9yIGlzIGluIHRoZSBwcm9jZXNzIG9mIGJlaW5nIHVzZWQKICAgICAgICBpZiAocC5wbGVkZ2VTdGF0ZSAhPSBQbGVkZ2VTdGF0ZS5QbGVkZ2VkKSB7CiAgICAgICAgICAgIHJldHVybiBpZFBsZWRnZTsKICAgICAgICB9CgogICAgICAgIC8vIEZpcnN0IHNlbmQgdG8gYSBwcm9qZWN0IGlmIGl0J3MgcHJvcG9zZWQgYW5kIGNvbW1pdHRlZAogICAgICAgIGlmICgocC5pbnRlbmRlZFByb2plY3QgPiAwKSAmJiAoIGdldFRpbWUoKSA+IHAuY29tbWl0VGltZSkpIHsKICAgICAgICAgICAgdWludDY0IG9sZFBsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgICAgIHAuaW50ZW5kZWRQcm9qZWN0LAogICAgICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICBvbGRQbGVkZ2UsCiAgICAgICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBwLmFtb3VudCk7CiAgICAgICAgICAgIGlkUGxlZGdlID0gdG9QbGVkZ2U7CiAgICAgICAgICAgIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKICAgICAgICB9CgogICAgICAgIHRvUGxlZGdlID0gZ2V0T2xkZXN0UGxlZGdlTm90Q2FuY2VsZWQoaWRQbGVkZ2UpOwogICAgICAgIGlmICh0b1BsZWRnZSAhPSBpZFBsZWRnZSkgewogICAgICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgcC5hbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvUGxlZGdlOwogICAgfQoKLy8vLy8vLy8vLy8vLwovLyBQbHVnaW5zCi8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgY2FsbFBsdWdpbmAgaXMgdXNlZCB0byB0cmlnZ2VyIHRoZSBnZW5lcmFsIGZ1bmN0aW9ucyBpbiB0aGUKICAgIC8vLyAgcGx1Z2luIGZvciBhbnkgYWN0aW9ucyBuZWVkZWQgYmVmb3JlIGFuZCBhZnRlciBhIHRyYW5zZmVyIGhhcHBlbnMuCiAgICAvLy8gIFNwZWNpZmljYWxseSB3aGF0IHRoaXMgZG9lcyBpbiByZWxhdGlvbiB0byB0aGUgcGx1Z2luIGlzIHNvbWV0aGluZwogICAgLy8vICB0aGF0IGxhcmdlbHkgZGVwZW5kcyBvbiB0aGUgZnVuY3Rpb25zIG9mIHRoYXQgcGx1Z2luLiBUaGlzIGZ1bmN0aW9uCiAgICAvLy8gIGlzIGdlbmVyYWxseSBjYWxsZWQgaW4gcGFpcnMsIG9uY2UgYmVmb3JlLCBhbmQgb25jZSBhZnRlciBhIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBiZWZvcmUgVGhpcyB0b2dnbGUgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwbHVnaW4gY2FsbCBpcyBvY2N1cnJpbmcKICAgIC8vLyAgYmVmb3JlIG9yIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGFkbWluSWQgVGhpcyBzaG91bGQgYmUgdGhlIElkIG9mIHRoZSAqdHJ1c3RlZCogaW5kaXZpZHVhbAogICAgLy8vICB3aG8gaGFzIGNvbnRyb2wgb3ZlciB0aGlzIHBsdWdpbi4KICAgIC8vLyBAcGFyYW0gZnJvbVBsZWRnZSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIHRvUGxlZGdlIFRoaXMgaXMgdGhlIElkIHRoYXQgdmFsdWUgaXMgYmVpbmcgdHJhbnNmZXJlZCB0by4KICAgIC8vLyBAcGFyYW0gY29udGV4dCBUaGUgc2l0dWF0aW9uIHRoYXQgaXMgdHJpZ2dlcmluZyB0aGUgcGx1Z2luLiBTZWUgcGx1Z2luCiAgICAvLy8gIGZvciBhIGZ1bGwgZGVzY3JpcHRpb24gb2YgY29udGV4dHMuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgaXMgYmVpbmcgdHJhbnNmZXJlZC4KICAgIGZ1bmN0aW9uIGNhbGxQbHVnaW4oCiAgICAgICAgYm9vbCBiZWZvcmUsCiAgICAgICAgdWludDY0IGFkbWluSWQsCiAgICAgICAgdWludDY0IGZyb21QbGVkZ2UsCiAgICAgICAgdWludDY0IHRvUGxlZGdlLAogICAgICAgIHVpbnQ2NCBjb250ZXh0LAogICAgICAgIHVpbnQgYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMgKHVpbnQgYWxsb3dlZEFtb3VudCkgewoKICAgICAgICB1aW50IG5ld0Ftb3VudDsKICAgICAgICBhbGxvd2VkQW1vdW50ID0gYW1vdW50OwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgYWRtaW4gPSBmaW5kQWRtaW4oYWRtaW5JZCk7CiAgICAgICAgLy8gQ2hlY2tzIGFkbWluIGhhcyBhIHBsdWdpbiBhc3NpZ25lZCBhbmQgYSBub24temVybyBhbW91bnQgaXMgcmVxdWVzdGVkCiAgICAgICAgaWYgKChhZGRyZXNzKGFkbWluLnBsdWdpbikgIT0gMCkgJiYgKGFsbG93ZWRBbW91bnQgPiAwKSkgewogICAgICAgICAgICAvLyBUaGVyZSBhcmUgdHdvIHNlcGVyYXRlIGZ1bmN0aW9ucyBjYWxsZWQgaW4gdGhlIHBsdWdpbi4KICAgICAgICAgICAgLy8gT25lIGlzIGNhbGxlZCBiZWZvcmUgdGhlIHRyYW5zZmVyIGFuZCBvbmUgYWZ0ZXIKICAgICAgICAgICAgaWYgKGJlZm9yZSkgewogICAgICAgICAgICAgICAgbmV3QW1vdW50ID0gYWRtaW4ucGx1Z2luLmJlZm9yZVRyYW5zZmVyKAogICAgICAgICAgICAgICAgICAgIGFkbWluSWQsCiAgICAgICAgICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgIGFtb3VudAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUobmV3QW1vdW50IDw9IGFsbG93ZWRBbW91bnQpOwogICAgICAgICAgICAgICAgYWxsb3dlZEFtb3VudCA9IG5ld0Ftb3VudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFkbWluLnBsdWdpbi5hZnRlclRyYW5zZmVyKAogICAgICAgICAgICAgICAgICAgIGFkbWluSWQsCiAgICAgICAgICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgIGFtb3VudAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgY2FsbFBsdWdpbnNQbGVkZ2VgIGlzIHVzZWQgdG8gYXBwbHkgcGx1Z2luIGNhbGxzIHRvCiAgICAvLy8gIHRoZSBkZWxlZ2F0ZSBjaGFpbiBhbmQgdGhlIGludGVuZGVkIHByb2plY3QgaWYgdGhlcmUgaXMgb25lLgogICAgLy8vICBJdCBkb2VzIHNvIGluIGVpdGhlciBhIHRyYW5zZmVycmluZyBvciByZWNlaXZpbmcgY29udGV4dCBiYXNlZAogICAgLy8vICBvbiB0aGUgYGlkUGxlZGdlYCBhbmQgIGBmcm9tUGxlZGdlYCBwYXJhbWV0ZXJzLgogICAgLy8vIEBwYXJhbSBiZWZvcmUgVGhpcyB0b2dnbGUgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwbHVnaW4gY2FsbCBpcyBvY2N1cmluZwogICAgLy8vICBiZWZvcmUgb3IgYWZ0ZXIgYSB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhpcyBpcyB0aGUgSWQgb2YgdGhlIHBsZWRnZSBvbiB3aGljaCB0aGlzIHBsdWdpbgogICAgLy8vICBpcyBiZWluZyBjYWxsZWQuCiAgICAvLy8gQHBhcmFtIGZyb21QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSB0b1BsZWRnZSBUaGlzIGlzIHRoZSBJZCB0aGF0IHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVyZWQgdG8uCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgaXMgYmVpbmcgdHJhbnNmZXJlZC4KICAgIGZ1bmN0aW9uIGNhbGxQbHVnaW5zUGxlZGdlKAogICAgICAgIGJvb2wgYmVmb3JlLAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSwKICAgICAgICB1aW50NjQgZnJvbVBsZWRnZSwKICAgICAgICB1aW50NjQgdG9QbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCBhbGxvd2VkQW1vdW50KSB7CiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIGNhbGxQbHVnaW4gaXMgYmVpbmcgYXBwbGllZCBpbiBhIHJlY2VpdmluZwogICAgICAgIC8vIG9yIHRyYW5zZmVycmluZyBjb250ZXh0CiAgICAgICAgdWludDY0IG9mZnNldCA9IGlkUGxlZGdlID09IGZyb21QbGVkZ2UgPyAwIDogMjU2OwogICAgICAgIGFsbG93ZWRBbW91bnQgPSBhbW91bnQ7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICAvLyBBbHdheXMgY2FsbCB0aGUgcGx1Z2luIG9uIHRoZSBvd25lcgogICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luKAogICAgICAgICAgICBiZWZvcmUsCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIGZyb21QbGVkZ2UsCiAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICApOwoKICAgICAgICAvLyBBcHBseSBjYWxsIHBsdWdpbiB0byBhbGwgZGVsZWdhdGVzCiAgICAgICAgZm9yICh1aW50NjQgaT0wOyBpPHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luKAogICAgICAgICAgICAgICAgYmVmb3JlLAogICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW5baV0sCiAgICAgICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgICAgICBvZmZzZXQgKyBpKzEsCiAgICAgICAgICAgICAgICBhbGxvd2VkQW1vdW50CiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpbnRlbmRlZCBwcm9qZWN0IGFsc28gY2FsbCB0aGUgcGx1Z2luIGluCiAgICAgICAgLy8gZWl0aGVyIGEgdHJhbnNmZXJyaW5nIG9yIHJlY2VpdmluZyBjb250ZXh0IGJhc2VkIG9uIG9mZnNldAogICAgICAgIC8vIG9uIHRoZSBpbnRlbmRlZCBwcm9qZWN0CiAgICAgICAgaWYgKHAuaW50ZW5kZWRQcm9qZWN0ID4gMCkgewogICAgICAgICAgICBhbGxvd2VkQW1vdW50ID0gY2FsbFBsdWdpbigKICAgICAgICAgICAgICAgIGJlZm9yZSwKICAgICAgICAgICAgICAgIHAuaW50ZW5kZWRQcm9qZWN0LAogICAgICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICAgICAgb2Zmc2V0ICsgMjU1LAogICAgICAgICAgICAgICAgYWxsb3dlZEFtb3VudAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCgogICAgLy8vIEBub3RpY2UgYGNhbGxQbHVnaW5zYCBjYWxscyBgY2FsbFBsdWdpbnNQbGVkZ2VgIG9uY2UgZm9yIHRoZSB0cmFuc2ZlcgogICAgLy8vICBjb250ZXh0IGFuZCBvbmNlIGZvciB0aGUgcmVjZWl2aW5nIGNvbnRleHQuIFRoZSBhZ2dyZWdhdGVkIAogICAgLy8vICBhbGxvd2VkIGFtb3VudCBpcyB0aGVuIHJldHVybmVkLgogICAgLy8vIEBwYXJhbSBiZWZvcmUgVGhpcyB0b2dnbGUgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwbHVnaW4gY2FsbCBpcyBvY2N1cnJpbmcKICAgIC8vLyAgYmVmb3JlIG9yIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGZyb21QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAcGFyYW0gdG9QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgdGhhdCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcnJlZCB0by4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdmFsdWUgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIGNhbGxQbHVnaW5zKAogICAgICAgIGJvb2wgYmVmb3JlLAogICAgICAgIHVpbnQ2NCBmcm9tUGxlZGdlLAogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSwKICAgICAgICB1aW50IGFtb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGFsbG93ZWRBbW91bnQpIHsKICAgICAgICBhbGxvd2VkQW1vdW50ID0gYW1vdW50OwoKICAgICAgICAvLyBDYWxsIHRoZSBwbGVkZ2VzIHBsdWdpbnMgaW4gdGhlIHRyYW5zZmVyIGNvbnRleHQKICAgICAgICBhbGxvd2VkQW1vdW50ID0gY2FsbFBsdWdpbnNQbGVkZ2UoCiAgICAgICAgICAgIGJlZm9yZSwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICApOwoKICAgICAgICAvLyBDYWxsIHRoZSBwbGVkZ2VzIHBsdWdpbnMgaW4gdGhlIHJlY2VpdmUgY29udGV4dAogICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luc1BsZWRnZSgKICAgICAgICAgICAgYmVmb3JlLAogICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICApOwogICAgfQoKLy8vLy8vLy8vLy8vLwovLyBUZXN0IGZ1bmN0aW9ucwovLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQmFzaWMgaGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiB0aGUgY3VycmVudCB0aW1lCiAgICBmdW5jdGlvbiBnZXRUaW1lKCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CgogICAgLy8gRXZlbnQgRGVsY2VyYXRpb25zCiAgICBldmVudCBUcmFuc2Zlcih1aW50NjQgaW5kZXhlZCBmcm9tLCB1aW50NjQgaW5kZXhlZCB0bywgdWludCBhbW91bnQpOwogICAgZXZlbnQgQ2FuY2VsUHJvamVjdCh1aW50NjQgaW5kZXhlZCBpZFByb2plY3QpOwoKfQoKLy9GaWxlOiBjb250cmFjdHMvTFBQQ2FwcGVkTWlsZXN0b25lcy5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovKgogICAgQ29weXJpZ2h0IDIwMTcsIFJKIEV3aW5nIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjlkZWRmOGVmZjRlZWVlZjJmMWYyZmFlNGRkZWRlZmYyZTlmMmYzZjBmY2Y0ZjFiM2ZlZjJmMCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCgoKCgpjb250cmFjdCBMUFBDYXBwZWRNaWxlc3RvbmVzIGlzIEVzY2FwYWJsZSB7CiAgICB1aW50IGNvbnN0YW50IFRPX09XTkVSID0gMjU2OwogICAgdWludCBjb25zdGFudCBUT19JTlRFTkRFRFBST0pFQ1QgPSA1MTE7CgogICAgTGlxdWlkUGxlZGdpbmcgcHVibGljIGxpcXVpZFBsZWRnaW5nOwoKICAgIHN0cnVjdCBNaWxlc3RvbmUgewogICAgICAgIHVpbnQgbWF4QW1vdW50OwogICAgICAgIHVpbnQgcmVjZWl2ZWQ7CiAgICAgICAgdWludCBjYW5Db2xsZWN0OwogICAgICAgIGFkZHJlc3MgcmV2aWV3ZXI7CiAgICAgICAgYWRkcmVzcyBjYW1wYWlnblJldmlld2VyOwogICAgICAgIGFkZHJlc3MgcmVjaXBpZW50OwogICAgICAgIGJvb2wgYWNjZXB0ZWQ7CiAgICB9CgogICAgbWFwcGluZyAodWludDY0ID0+IE1pbGVzdG9uZSkgbWlsZXN0b25lczsKCgogICAgZXZlbnQgTWlsZXN0b25lQWNjZXB0ZWQodWludDY0IGluZGV4ZWQgaWRQcm9qZWN0KTsKICAgIGV2ZW50IFBheW1lbnRDb2xsZWN0ZWQodWludDY0IGluZGV4ZWQgaWRQcm9qZWN0KTsKCiAgICAvLz09IGNvbnN0cnVjdG9yCgogICAgZnVuY3Rpb24gTFBQQ2FwcGVkTWlsZXN0b25lcygKICAgICAgICBMaXF1aWRQbGVkZ2luZyBfbGlxdWlkUGxlZGdpbmcsCiAgICAgICAgYWRkcmVzcyBfZXNjYXBlSGF0Y2hDYWxsZXIsCiAgICAgICAgYWRkcmVzcyBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbgogICAgKSBFc2NhcGFibGUoX2VzY2FwZUhhdGNoQ2FsbGVyLCBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbikgcHVibGljCiAgICB7CiAgICAgICAgbGlxdWlkUGxlZGdpbmcgPSBfbGlxdWlkUGxlZGdpbmc7CiAgICB9CgogICAgLy89PSBmYWxsYmFjawoKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7fQoKICAgIC8vPT0gZXh0ZXJuYWwKCiAgICAvLy8gQGRldiB0aGlzIGlzIGNhbGxlZCBieSBsaXF1aWRQbGVkZ2luZyBiZWZvcmUgZXZlcnkgdHJhbnNmZXIgdG8gYW5kIGZyb20KICAgIC8vLyAgICAgIGEgcGxlZGdlQWRtaW4gdGhhdCBoYXMgdGhpcyBjb250cmFjdCBhcyBpdHMgcGx1Z2luCiAgICAvLy8gQGRldiBzZWUgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIGludGVyZmFjZSBmb3IgZGV0YWlscyBhYm91dCBjb250ZXh0IHBhcmFtCiAgICBmdW5jdGlvbiBiZWZvcmVUcmFuc2ZlcigKICAgICAgICB1aW50NjQgcGxlZGdlTWFuYWdlciwKICAgICAgICB1aW50NjQgcGxlZGdlRnJvbSwKICAgICAgICB1aW50NjQgcGxlZGdlVG8sCiAgICAgICAgdWludDY0IGNvbnRleHQsCiAgICAgICAgdWludCBhbW91bnQKICAgICkgZXh0ZXJuYWwgcmV0dXJucyAodWludCBtYXhBbGxvd2VkKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGxpcXVpZFBsZWRnaW5nKSk7CiAgICAgICAgdmFyICgsICwgLCBmcm9tSW50ZW5kZWRQcm9qZWN0LCAsICwpID0gbGlxdWlkUGxlZGdpbmcuZ2V0UGxlZGdlKHBsZWRnZUZyb20pOwogICAgICAgIHZhciAoLCB0b093bmVyLCAsIHRvSW50ZW5kZWRQcm9qZWN0LCAsICwgdG9QbGVkZ2VTdGF0ZSkgPSBsaXF1aWRQbGVkZ2luZy5nZXRQbGVkZ2UocGxlZGdlVG8pOwogICAgICAgIE1pbGVzdG9uZSBzdG9yYWdlIG07CgogICAgICAgIC8vIGlmIG0gaXMgdGhlIGludGVuZGVkUHJvamVjdCwgbWFrZSBzdXJlIG0gaXMgc3RpbGwgYWNjZXB0aW5nIGZ1bmRzIChub3QgYWNjZXB0ZWQgb3IgY2FuY2VsZWQpCiAgICAgICAgaWYgKGNvbnRleHQgPT0gVE9fSU5URU5ERURQUk9KRUNUKSB7CiAgICAgICAgICAgIG0gPSBtaWxlc3RvbmVzW3RvSW50ZW5kZWRQcm9qZWN0XTsKICAgICAgICAgICAgLy8gZG9uJ3QgbmVlZCB0byBjaGVjayBpZiBjYW5jZWxlZCBiL2MgbHAgZG9lcyB0aGlzCiAgICAgICAgICAgIGlmIChtLmFjY2VwdGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIC8vIGlmIHRoZSBwbGVkZ2UgaXMgYmVpbmcgdHJhbnNmZXJyZWQgdG8gbSBhbmQgaXMgaW4gdGhlIFBsZWRnZWQgc3RhdGUsIG1ha2UKICAgICAgICAvLyBzdXJlIG0gaXMgc3RpbGwgYWNjZXB0aW5nIGZ1bmRzIChub3QgYWNjZXB0ZWQgb3IgY2FuY2VsZWQpCiAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0ID09IFRPX09XTkVSICYmCiAgICAgICAgICAgIChmcm9tSW50ZW5kZWRQcm9qZWN0ICE9IHRvT3duZXIgJiYKICAgICAgICAgICAgICAgIHRvUGxlZGdlU3RhdGUgPT0gTGlxdWlkUGxlZGdpbmdCYXNlLlBsZWRnZVN0YXRlLlBsZWRnZWQpKSB7CiAgICAgICAgICAgIC8vVE9ETyB3aGF0IGlmIG1pbGVzdG9uZSBpc24ndCBpbml0aWFsaXplZD8gc2hvdWxkIHdlIHRocm93PwogICAgICAgICAgICAvLyB0aGlzIGNhbiBoYXBwZW4gaWYgc29tZW9uZSBhZGRzIGEgcHJvamVjdCB0aHJvdWdoIGxwIHdpdGggdGhpcyBjb250cmFjdHMgYWRkcmVzcyBhcyB0aGUgcGx1Z2luCiAgICAgICAgICAgIC8vIHdlIGNhbiByZXF1aXJlKG1heEFtb3VudCA+IDApOwogICAgICAgICAgICAvLyBkb24ndCBuZWVkIHRvIGNoZWNrIGlmIGNhbmNlbGVkIGIvYyBscCBkb2VzIHRoaXMKICAgICAgICAgICAgbSA9IG1pbGVzdG9uZXNbdG9Pd25lcl07CiAgICAgICAgICAgIGlmIChtLmFjY2VwdGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8vLyBAZGV2IHRoaXMgaXMgY2FsbGVkIGJ5IGxpcXVpZFBsZWRnaW5nIGFmdGVyIGV2ZXJ5IHRyYW5zZmVyIHRvIGFuZCBmcm9tCiAgICAvLy8gICAgICBhIHBsZWRnZUFkbWluIHRoYXQgaGFzIHRoaXMgY29udHJhY3QgYXMgaXRzIHBsdWdpbgogICAgLy8vIEBkZXYgc2VlIElMaXF1aWRQbGVkZ2luZ1BsdWdpbiBpbnRlcmZhY2UgZm9yIGRldGFpbHMgYWJvdXQgY29udGV4dCBwYXJhbQogICAgZnVuY3Rpb24gYWZ0ZXJUcmFuc2ZlcigKICAgICAgICB1aW50NjQgcGxlZGdlTWFuYWdlciwKICAgICAgICB1aW50NjQgcGxlZGdlRnJvbSwKICAgICAgICB1aW50NjQgcGxlZGdlVG8sCiAgICAgICAgdWludDY0IGNvbnRleHQsCiAgICAgICAgdWludCBhbW91bnQKICAgICkgZXh0ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhsaXF1aWRQbGVkZ2luZykpOwoKICAgICAgICB2YXIgKCwgZnJvbU93bmVyLCAsICwgLCAsKSA9IGxpcXVpZFBsZWRnaW5nLmdldFBsZWRnZShwbGVkZ2VGcm9tKTsKICAgICAgICB2YXIgKCwgdG9Pd25lciwgLCAsICwgLCB0b1BsZWRnZVN0YXRlKSA9IGxpcXVpZFBsZWRnaW5nLmdldFBsZWRnZShwbGVkZ2VUbyk7CgogICAgICAgIGlmIChjb250ZXh0ID09IFRPX09XTkVSKSB7CiAgICAgICAgICAgIE1pbGVzdG9uZSBzdG9yYWdlIG07CgogICAgICAgICAgICAvLyBJZiBmcm9tT3duZXIgIT0gdG9Pd25lciwgdGhlIG1lYW5zIHRoYXQgYSBwbGVkZ2UgaXMgYmVpbmcgY29tbWl0dGVkIHRvCiAgICAgICAgICAgIC8vIG1pbGVzdG9uZSBtLiBXZSB3aWxsIGFjY2VwdCBhbnkgYW1vdW50IHVwIHRvIG0ubWF4QW1vdW50LCBhbmQgcmV0dXJuCiAgICAgICAgICAgIC8vIHRoZSByZXN0CiAgICAgICAgICAgIGlmIChmcm9tT3duZXIgIT0gdG9Pd25lcikgewogICAgICAgICAgICAgICAgbSA9IG1pbGVzdG9uZXNbdG9Pd25lcl07CiAgICAgICAgICAgICAgICB1aW50IHJldHVybkZ1bmRzID0gMDsKCiAgICAgICAgICAgICAgICBtLnJlY2VpdmVkICs9IGFtb3VudDsKICAgICAgICAgICAgICAgIC8vIG1pbGVzdG9uZSBpcyBubyBsb25nZXIgYWNjZXB0aW5nIG5ldyBmdW5kcwogICAgICAgICAgICAgICAgaWYgKG0uYWNjZXB0ZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm5GdW5kcyA9IGFtb3VudDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobS5yZWNlaXZlZCA+IG0ubWF4QW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuRnVuZHMgPSBtLnJlY2VpdmVkIC0gbS5tYXhBbW91bnQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc2VuZCBhbnkgZXhjZWVkaW5nIGZ1bmRzIGJhY2sKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5GdW5kcyA+IDApIHsKICAgICAgICAgICAgICAgICAgICBtLnJlY2VpdmVkIC09IHJldHVybkZ1bmRzOwogICAgICAgICAgICAgICAgICAgIGxpcXVpZFBsZWRnaW5nLmNhbmNlbFBsZWRnZShwbGVkZ2VUbywgcmV0dXJuRnVuZHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBpZiB0aGUgcGxlZGdlIGhhcyBiZWVuIHBhaWQsIHRoZW4gdGhlIHZhdWx0IHNob3VsZCBoYXZlIHRyYW5zZmVycmVkIHRoZQogICAgICAgICAgICAvLyB0aGUgZnVuZHMgdG8gdGhpcyBjb250cmFjdC4gdXBkYXRlIHRoZSBtaWxlc3RvbmUgd2l0aCB0aGUgYW1vdW50IHRoZSByZWNpcGllbnQKICAgICAgICAgICAgLy8gY2FuIGNvbGxlY3QuIHRoaXMgaXMgdGhlIGFtb3VudCBvZiB0aGUgcGFpZCBwbGVkZ2UKICAgICAgICAgICAgfSBlbHNlIGlmICh0b1BsZWRnZVN0YXRlID09IExpcXVpZFBsZWRnaW5nQmFzZS5QbGVkZ2VTdGF0ZS5QYWlkKSB7CiAgICAgICAgICAgICAgICBtID0gbWlsZXN0b25lc1t0b093bmVyXTsKICAgICAgICAgICAgICAgIG0uY2FuQ29sbGVjdCArPSBhbW91bnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy89PSBwdWJsaWMKCiAgICBmdW5jdGlvbiBhZGRNaWxlc3RvbmUoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50IF9tYXhBbW91bnQsCiAgICAgICAgdWludDY0IHBhcmVudFByb2plY3QsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LAogICAgICAgIGFkZHJlc3MgX3Jldmlld2VyLAogICAgICAgIGFkZHJlc3MgX2NhbXBhaWduUmV2aWV3ZXIKICAgICkgcHVibGljCiAgICB7CiAgICAgICAgdWludDY0IGlkUHJvamVjdCA9IGxpcXVpZFBsZWRnaW5nLmFkZFByb2plY3QoCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgYWRkcmVzcyh0aGlzKSwKICAgICAgICAgICAgcGFyZW50UHJvamVjdCwKICAgICAgICAgICAgdWludDY0KDApLAogICAgICAgICAgICBJTGlxdWlkUGxlZGdpbmdQbHVnaW4odGhpcykKICAgICAgICApOwoKICAgICAgICBtaWxlc3RvbmVzW2lkUHJvamVjdF0gPSBNaWxlc3RvbmUoCiAgICAgICAgICAgIF9tYXhBbW91bnQsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIF9yZXZpZXdlciwKICAgICAgICAgICAgX2NhbXBhaWduUmV2aWV3ZXIsCiAgICAgICAgICAgIF9yZWNpcGllbnQsCiAgICAgICAgICAgIGZhbHNlCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhY2NlcHRNaWxlc3RvbmUodWludDY0IGlkUHJvamVjdCkgcHVibGljIHsKICAgICAgICBib29sIGlzQ2FuY2VsZWQgPSBsaXF1aWRQbGVkZ2luZy5pc1Byb2plY3RDYW5jZWxlZChpZFByb2plY3QpOwogICAgICAgIHJlcXVpcmUoIWlzQ2FuY2VsZWQpOwoKICAgICAgICBNaWxlc3RvbmUgc3RvcmFnZSBtID0gbWlsZXN0b25lc1tpZFByb2plY3RdOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtLnJldmlld2VyIHx8IG1zZy5zZW5kZXIgPT0gbS5jYW1wYWlnblJldmlld2VyKTsKICAgICAgICByZXF1aXJlKCFtLmFjY2VwdGVkKTsKCiAgICAgICAgbS5hY2NlcHRlZCA9IHRydWU7CiAgICAgICAgTWlsZXN0b25lQWNjZXB0ZWQoaWRQcm9qZWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5jZWxNaWxlc3RvbmUodWludDY0IGlkUHJvamVjdCkgcHVibGljIHsKICAgICAgICBNaWxlc3RvbmUgc3RvcmFnZSBtID0gbWlsZXN0b25lc1tpZFByb2plY3RdOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtLnJldmlld2VyIHx8IG1zZy5zZW5kZXIgPT0gbS5jYW1wYWlnblJldmlld2VyKTsKICAgICAgICByZXF1aXJlKCFtLmFjY2VwdGVkKTsKCiAgICAgICAgbGlxdWlkUGxlZGdpbmcuY2FuY2VsUHJvamVjdChpZFByb2plY3QpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQ2NCBpZFByb2plY3QsIHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIHB1YmxpYyB7CiAgICAgICAgLy8gd2UgZG9uJ3QgY2hlY2sgaWYgY2FuY2VsZWQgaGVyZS4KICAgICAgICAvLyBscC53aXRoZHJhdyB3aWxsIG5vcm1hbGl6ZSB0aGUgcGxlZGdlICYgY2hlY2sgaWYgY2FuY2VsZWQKICAgICAgICBNaWxlc3RvbmUgc3RvcmFnZSBtID0gbWlsZXN0b25lc1tpZFByb2plY3RdOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtLnJlY2lwaWVudCk7CiAgICAgICAgcmVxdWlyZShtLmFjY2VwdGVkKTsKCiAgICAgICAgbGlxdWlkUGxlZGdpbmcud2l0aGRyYXcoaWRQbGVkZ2UsIGFtb3VudCk7CiAgICAgICAgY29sbGVjdChpZFByb2plY3QpOwogICAgfQoKICAgIC8vLyBCaXQgbWFzayB1c2VkIGZvciBkaXZpZGluZyBwbGVkZ2UgYW1vdW50cyBpbiBtV2l0aGRyYXcKICAgIHVpbnQgY29uc3RhbnQgRDY0ID0gMHgxMDAwMDAwMDAwMDAwMDAwMDsKCiAgICBmdW5jdGlvbiBtV2l0aGRyYXcodWludFtdIHBsZWRnZXNBbW91bnRzKSBwdWJsaWMgewogICAgICAgIHVpbnQ2NFtdIG1lbW9yeSBtSWRzID0gbmV3IHVpbnQ2NFtdKHBsZWRnZXNBbW91bnRzLmxlbmd0aCk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXNBbW91bnRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB1aW50NjQgaWRQbGVkZ2UgPSB1aW50NjQocGxlZGdlc0Ftb3VudHNbaV0gJiAoRDY0LTEpKTsKICAgICAgICAgICAgdmFyICgsIGlkUHJvamVjdCwgLCAsICwgLCkgPSBsaXF1aWRQbGVkZ2luZy5nZXRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICAgICAgbUlkc1tpXSA9IGlkUHJvamVjdDsKICAgICAgICAgICAgTWlsZXN0b25lIHN0b3JhZ2UgbSA9IG1pbGVzdG9uZXNbaWRQcm9qZWN0XTsKICAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG0ucmVjaXBpZW50KTsKICAgICAgICAgICAgcmVxdWlyZShtLmFjY2VwdGVkKTsKICAgICAgICB9CgogICAgICAgIGxpcXVpZFBsZWRnaW5nLm1XaXRoZHJhdyhwbGVkZ2VzQW1vdW50cyk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBtSWRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICBjb2xsZWN0KG1JZHNbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjb2xsZWN0KHVpbnQ2NCBpZFByb2plY3QpIHB1YmxpYyB7CiAgICAgICAgTWlsZXN0b25lIHN0b3JhZ2UgbSA9IG1pbGVzdG9uZXNbaWRQcm9qZWN0XTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbS5yZWNpcGllbnQpOwoKICAgICAgICBpZiAobS5jYW5Db2xsZWN0ID4gMCkgewogICAgICAgICAgICB1aW50IGFtb3VudCA9IG0uY2FuQ29sbGVjdDsKICAgICAgICAgICAgLy8gVE9ETyBzaG91bGQgdGhpcyBhc3NlcnQgYmUgcmVtb3ZlZD8KICAgICAgICAgICAgYXNzZXJ0KHRoaXMuYmFsYW5jZSA+PSBhbW91bnQpOwogICAgICAgICAgICBtLmNhbkNvbGxlY3QgPSAwOwogICAgICAgICAgICBtLnJlY2lwaWVudC50cmFuc2ZlcihhbW91bnQpOwogICAgICAgICAgICBQYXltZW50Q29sbGVjdGVkKGlkUHJvamVjdCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1pbGVzdG9uZSh1aW50NjQgaWRQcm9qZWN0KSBwdWJsaWMgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50IG1heEFtb3VudCwKICAgICAgICB1aW50IHJlY2VpdmVkLAogICAgICAgIHVpbnQgY2FuQ29sbGVjdCwKICAgICAgICBhZGRyZXNzIHJldmlld2VyLAogICAgICAgIGFkZHJlc3MgY2FtcGFpZ25SZXZpZXdlciwKICAgICAgICBhZGRyZXNzIHJlY2lwaWVudCwKICAgICAgICBib29sIGFjY2VwdGVkCiAgICApIHsKICAgICAgICBNaWxlc3RvbmUgc3RvcmFnZSBtID0gbWlsZXN0b25lc1tpZFByb2plY3RdOwogICAgICAgIG1heEFtb3VudCA9IG0ubWF4QW1vdW50OwogICAgICAgIHJlY2VpdmVkID0gbS5yZWNlaXZlZDsKICAgICAgICBjYW5Db2xsZWN0ID0gbS5jYW5Db2xsZWN0OwogICAgICAgIHJldmlld2VyID0gbS5yZXZpZXdlcjsKICAgICAgICBjYW1wYWlnblJldmlld2VyID0gbS5jYW1wYWlnblJldmlld2VyOwogICAgICAgIHJlY2lwaWVudCA9IG0ucmVjaXBpZW50OwogICAgICAgIGFjY2VwdGVkID0gbS5hY2NlcHRlZDsKICAgIH0KfQ=='.
	

]
