Class {
	#name : #SRT49edf201c1e139282643d5e7c6fb0c7219ad1db7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT49edf201c1e139282643d5e7c6fb0c7219ad1db7 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5ID49MC40LjQ7Cgpjb250cmFjdCBTYWxlIHsKICAgIHVpbnQgcHVibGljIHN0YXJ0VGltZTsKICAgIHVpbnQgcHVibGljIHN0b3BUaW1lOwogICAgdWludCBwdWJsaWMgdGFyZ2V0OwogICAgdWludCBwdWJsaWMgcmFpc2VkOwogICAgdWludCBwdWJsaWMgY29sbGVjdGVkOwogICAgdWludCBwdWJsaWMgbnVtQ29udHJpYnV0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsKCiAgICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBfYSwgdWludCBfZXRoLCB1aW50IF90aW1lKSByZXR1cm5zICh1aW50KTsgCiAgICBmdW5jdGlvbiBnZXRUb2tlbnMoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOyAKICAgIGZ1bmN0aW9uIGdldFJlZnVuZChhZGRyZXNzIGhvbGRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7IAogICAgZnVuY3Rpb24gZ2V0U29sZFRva2VucygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOyAKICAgIGZ1bmN0aW9uIGdldE93bmVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7IAogICAgZnVuY3Rpb24gdG9rZW5zUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBpc0FjdGl2ZSh1aW50IHRpbWUpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOyAKICAgIGZ1bmN0aW9uIGlzQ29tcGxldGUodWludCB0aW1lKSBjb25zdGFudCByZXR1cm5zIChib29sKTsgCn0KCmNvbnRyYWN0IENvbnN0YW50cyB7CiAgICB1aW50IERFQ0lNQUxTID0gODsKfQoKY29udHJhY3QgRXZlbnREZWZpbml0aW9ucyB7CiAgICBldmVudCBsb2dTYWxlU3RhcnQodWludCBzdGFydFRpbWUsIHVpbnQgc3RvcFRpbWUpOwogICAgZXZlbnQgbG9nUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgdWludCBldGgpOwogICAgZXZlbnQgbG9nQ2xhaW0oYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgdWludCByZWZ1bmQsIHVpbnQgdG9rZW5zKTsKCiAgICAvL1Rva2VuIHN0YW5kYXJkIGV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfSAKCmNvbnRyYWN0IFRlc3RhYmxlIHsKICAgIHVpbnQgZmFrZVRpbWU7CiAgICBib29sIHB1YmxpYyB0ZXN0aW5nOwogICAgbW9kaWZpZXIgb25seVRlc3RpbmcoKSB7CiAgICAgICAgaWYgKCF0ZXN0aW5nKSB0aHJvdzsKICAgICAgICBfOwogICAgfQogICAgZnVuY3Rpb24gc2V0RmFrZVRpbWUodWludCB0KSBvbmx5VGVzdGluZyB7CiAgICAgICAgZmFrZVRpbWUgPSB0OwogICAgfQogICAgZnVuY3Rpb24gYWRkTWludXRlcyh1aW50IG0pIG9ubHlUZXN0aW5nIHsKICAgICAgICBmYWtlVGltZSA9IGZha2VUaW1lICsgKG0gKiAxIG1pbnV0ZXMpOwogICAgfQogICAgZnVuY3Rpb24gYWRkRGF5cyh1aW50IGQpIG9ubHlUZXN0aW5nIHsKICAgICAgICBmYWtlVGltZSA9IGZha2VUaW1lICsgKGQgKiAxIGRheXMpOwogICAgfQogICAgZnVuY3Rpb24gY3VyclRpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKHRlc3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIGZha2VUaW1lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBibG9jay50aW1lc3RhbXA7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gd2VpUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIGlmICh0ZXN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiAyMDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIDEwKioxODsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IE93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgYWRkcmVzcyBuZXdPd25lcjsKCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gbmV3T3duZXIpIHsKICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICB9CiAgICB9ICAgIAp9CgovL2Zyb20gWmVwcGVsaW4KY29udHJhY3QgU2FmZU1hdGggewogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKCFhc3NlcnRpb24pIHRocm93OwogICAgfQp9Cgpjb250cmFjdCBUb2tlbiBpcyBTYWZlTWF0aCwgT3duZWQsIENvbnN0YW50cyB7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBhZGRyZXNzIGljbzsKICAgIGFkZHJlc3MgY29udHJvbGxlcjsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7IAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAKCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcnMoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gaWNvICYmCiAgICAgICAgICAgIG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBudW13b3JkcykgewogICAgICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPT0gbnVtd29yZHMgKiAzMiArIDQpOwogICAgICAgIF87CiAgICB9IAoKICAgIGZ1bmN0aW9uIFRva2VuKCkgeyAKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgbmFtZSA9ICJNb25vbGl0aCBUS04iOwogICAgICAgIGRlY2ltYWxzID0gdWludDgoREVDSU1BTFMpOwogICAgICAgIHN5bWJvbCA9ICJUS04iOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldElDTyhhZGRyZXNzIF9pY28pIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGljbyAhPSAwKSB0aHJvdzsKICAgICAgICBpY28gPSBfaWNvOwogICAgfQogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBvbmx5T3duZXIgewogICAgICAgIGlmIChjb250cm9sbGVyICE9IDApIHRocm93OwogICAgICAgIGNvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgIH0KICAgIAogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpOwoKICAgIC8vb25seSBjYWxsZWQgZnJvbSBjb250cmFjdHMgc28gZG9uJ3QgbmVlZCBtc2cuZGF0YS5sZW5ndGggY2hlY2sKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCkgb25seUNvbnRyb2xsZXJzIHsKICAgICAgICBpZiAobWF4U3VwcGx5ID4gMCAmJiBzYWZlQWRkKHRvdGFsU3VwcGx5LCBhbW91bnQpID4gbWF4U3VwcGx5KSB0aHJvdzsKICAgICAgICBiYWxhbmNlT2ZbYWRkcl0gPSBzYWZlQWRkKGJhbGFuY2VPZlthZGRyXSwgYW1vdW50KTsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIGFtb3VudCk7CiAgICAgICAgTWludChhZGRyLCBhbW91bnQpOwogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmFsYW5jZU9mOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgYWxsb3dhbmNlOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgCiAgICBvbmx5UGF5bG9hZFNpemUoMikKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPCBfdmFsdWUpIHJldHVybiBmYWxzZTsKCiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gYmFsYW5jZU9mW21zZy5zZW5kZXJdIC0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gc2FmZUFkZChiYWxhbmNlT2ZbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgCiAgICBvbmx5UGF5bG9hZFNpemUoMykKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlT2ZbX2Zyb21dIDwgX3ZhbHVlKSByZXR1cm4gZmFsc2U7IAoKICAgICAgICB2YXIgYWxsb3dlZCA9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICAgICAgaWYgKGFsbG93ZWQgPCBfdmFsdWUpIHJldHVybiBmYWxzZTsKCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZltfdG9dLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VPZltfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VPZltfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZCwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIAogICAgb25seVBheWxvYWRTaXplKDIpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL3JlcXVpcmUgdXNlciB0byBzZXQgdG8gemVybyBiZWZvcmUgcmVzZXR0aW5nIHRvIG5vbnplcm8KICAgICAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgCiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSAKICAgIG9ubHlQYXlsb2FkU2l6ZSgyKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IHNhZmVBZGQob2xkVmFsdWUsIF9hZGRlZFZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIAogICAgb25seVBheWxvYWRTaXplKDIpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgICAgICAgIGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBzYWZlU3ViKG9sZFZhbHVlLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9Ib2xkcyBhY2N1bXVsYXRlZCBkaXZpZGVuZCB0b2tlbnMgb3RoZXIgdGhhbiBUS04KICAgIFRva2VuSG9sZGVyIHRva2VuaG9sZGVyOwoKICAgIC8vb25jZSBsb2NrZWQsIGNhbiBubyBsb25nZXIgdXBncmFkZSB0b2tlbmhvbGRlcgogICAgYm9vbCBsb2NrZWRUb2tlbkhvbGRlcjsKCiAgICBmdW5jdGlvbiBsb2NrVG9rZW5Ib2xkZXIoKSBvbmx5T3duZXIgewogICAgICAgIGxvY2tlZFRva2VuSG9sZGVyID0gdHJ1ZTsKICAgIH0KCiAgICAvL3doaWxlIHVubG9ja2VkLCAKICAgIC8vdGhpcyBnaXZlcyBvd25lciBsb3RzIG9mIHBvd2VyIG92ZXIgaGVsZCBkaXZpZGVuZCB0b2tlbnMKICAgIC8vZWZmZWN0aXZlbHkgY2FuIGRlbnkgYWNjZXNzIHRvIGFsbCBhY2N1bXVsYXRlZCB0b2tlbnMKICAgIC8vdGh1cyBjcmFzaGluZyBUS04gdmFsdWUKICAgIGZ1bmN0aW9uIHNldFRva2VuSG9sZGVyKGFkZHJlc3MgX3RoKSBvbmx5T3duZXIgewogICAgICAgIGlmIChsb2NrZWRUb2tlbkhvbGRlcikgdGhyb3c7CiAgICAgICAgdG9rZW5ob2xkZXIgPSBUb2tlbkhvbGRlcihfdGgpOwogICAgfQoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBidXJuZXIsIHVpbnQgYW1vdW50KTsKCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCByZXN1bHQpIHsKICAgICAgICBpZiAoX2Ftb3VudCA+IGJhbGFuY2VPZlttc2cuc2VuZGVyXSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW21zZy5zZW5kZXJdLCBfYW1vdW50KTsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIF9hbW91bnQpOwogICAgICAgIHJlc3VsdCA9IHRva2VuaG9sZGVyLmJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgaWYgKCFyZXN1bHQpIHRocm93OwogICAgICAgIEJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICB9CgogICAgdWludCBwdWJsaWMgbWF4U3VwcGx5OwoKICAgIGZ1bmN0aW9uIHNldE1heFN1cHBseSh1aW50IF9tYXhTdXBwbHkpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB0aHJvdzsKICAgICAgICBpZiAobWF4U3VwcGx5ID4gMCkgdGhyb3c7CiAgICAgICAgbWF4U3VwcGx5ID0gX21heFN1cHBseTsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5Ib2xkZXIgewogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIF9idXJuZXIsIHVpbnQgX2Ftb3VudCkKICAgIHJldHVybnMgKGJvb2wgcmVzdWx0KSB7IAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQoKCmNvbnRyYWN0IElDTyBpcyBFdmVudERlZmluaXRpb25zLCBUZXN0YWJsZSwgU2FmZU1hdGgsIE93bmVkIHsKICAgIFRva2VuIHB1YmxpYyB0b2tlbjsKICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBwYXllZTsKCiAgICBTYWxlW10gcHVibGljIHNhbGVzOwogICAgCiAgICAvL3NhbGVudW0gPT4gbWluaW11bSB3ZWkKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgc2FsZU1pbmltdW1QdXJjaGFzZXM7CgogICAgLy9uZXh0IHNhbGUgbnVtYmVyIHVzZXIgY2FuIGNsYWltIGZyb20KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIG5leHRDbGFpbTsKCiAgICAvL25ldCBjb250cmlidXRlZCBFVEggYnkgZWFjaCB1c2VyIChpbiBjYXNlIG9mIHN0b3AvcmVmdW5kKQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSByZWZ1bmRJblN0b3A7CgogICAgbW9kaWZpZXIgdG9rZW5Jc1NldCgpIHsKICAgICAgICBpZiAoYWRkcmVzcyh0b2tlbikgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKGNvbnRyb2xsZXIpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIElDTygpIHsgCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHBheWVlID0gbXNnLnNlbmRlcjsKICAgICAgICBhbGxTdG9wcGVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvL3BheWVlIGNhbiBvbmx5IGJlIGNoYW5nZWQgb25jZQogICAgLy9pbnRlbnQgaXMgdG8gbG9jayBwYXllZSB0byBhIGNvbnRyYWN0IHRoYXQgaG9sZHMgb3IgZGlzdHJpYnV0ZXMgZnVuZHMKICAgIC8vaW4gZGVwbG95bWVudCwgYmUgc3VyZSB0byBkbyB0aGlzIGJlZm9yZSBjaGFuZ2luZyBvd25lciEKICAgIC8vd2UgaW5pdGlhbGl6ZSB0byBvd25lciB0byBrZWVwIHRoaW5ncyBzaW1wbGUgaWYgdGhlcmUncyBubyBwYXllZSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlUGF5ZWUoYWRkcmVzcyBuZXdQYXllZSkgCiAgICBvbmx5T3duZXIgbm90QWxsU3RvcHBlZCB7CiAgICAgICAgcGF5ZWUgPSBuZXdQYXllZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIF90b2tlbikgb25seU93bmVyIHsKICAgICAgICBpZiAoYWRkcmVzcyh0b2tlbikgIT0gMHgwKSB0aHJvdzsKICAgICAgICB0b2tlbiA9IFRva2VuKF90b2tlbik7CiAgICB9CgogICAgLy9iZWZvcmUgYWRkaW5nIHNhbGVzLCB3ZSBjYW4gc2V0IHRoaXMgdG8gYmUgYSB0ZXN0IGljbwogICAgLy90aGlzIGxldHMgdXMgbWFuaXB1bGF0ZSB0aW1lIGFuZCBkcmFzdGljYWxseSBsb3dlcnMgd2VpUGVyRXRoCiAgICBmdW5jdGlvbiBzZXRBc1Rlc3QoKSBvbmx5T3duZXIgewogICAgICAgIGlmIChzYWxlcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB0ZXN0aW5nID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSAKICAgIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsKICAgICAgICBpZiAoYWRkcmVzcyhjb250cm9sbGVyKSAhPSAweDApIHRocm93OwogICAgICAgIGNvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsgLy9JQ09Db250cm9sbGVyKF9jb250cm9sbGVyKTsKICAgIH0KCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvL1NhbGVzCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgZnVuY3Rpb24gYWRkU2FsZShhZGRyZXNzIHNhbGUsIHVpbnQgbWluaW11bVB1cmNoYXNlKSAKICAgIG9ubHlDb250cm9sbGVyIG5vdEFsbFN0b3BwZWQgewogICAgICAgIHVpbnQgc2FsZW51bSA9IHNhbGVzLmxlbmd0aDsKICAgICAgICBzYWxlcy5wdXNoKFNhbGUoc2FsZSkpOwogICAgICAgIHNhbGVNaW5pbXVtUHVyY2hhc2VzW3NhbGVudW1dID0gbWluaW11bVB1cmNoYXNlOwogICAgICAgIGxvZ1NhbGVTdGFydChTYWxlKHNhbGUpLnN0YXJ0VGltZSgpLCBTYWxlKHNhbGUpLnN0b3BUaW1lKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZFNhbGUoYWRkcmVzcyBzYWxlKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgYWRkU2FsZShzYWxlLCAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDdXJyU2FsZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoc2FsZXMubGVuZ3RoID09IDApIHRocm93OyAvL25vIHJlYXNvbiB0byBjYWxsIGJlZm9yZSBzdGFydEZpcnN0U2FsZQogICAgICAgIHJldHVybiBzYWxlcy5sZW5ndGggLSAxOwogICAgfQoKICAgIGZ1bmN0aW9uIGN1cnJTYWxlQWN0aXZlKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzYWxlc1tnZXRDdXJyU2FsZSgpXS5pc0FjdGl2ZShjdXJyVGltZSgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyU2FsZUNvbXBsZXRlKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzYWxlc1tnZXRDdXJyU2FsZSgpXS5pc0NvbXBsZXRlKGN1cnJUaW1lKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG51bVNhbGVzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzYWxlcy5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gbnVtQ29udHJpYnV0b3JzKHVpbnQgc2FsZW51bSkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzYWxlc1tzYWxlbnVtXS5udW1Db250cmlidXRvcnMoKTsKICAgIH0KCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvL0VUSCBQdXJjaGFzZXMKICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICBldmVudCBsb2dQdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCB1aW50IHZhbHVlKTsKCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBkZXBvc2l0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHBheWFibGUgbm90QWxsU3RvcHBlZCB7CiAgICAgICAgZG9EZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CgogICAgICAgIC8vbm90IGluIGRvRGVwb3NpdCBiZWNhdXNlIG9ubHkgZm9yIEV0aDoKICAgICAgICB1aW50IGNvbnRyaWIgPSByZWZ1bmRJblN0b3BbbXNnLnNlbmRlcl07CiAgICAgICAgcmVmdW5kSW5TdG9wW21zZy5zZW5kZXJdID0gY29udHJpYiArIG1zZy52YWx1ZTsKCiAgICAgICAgbG9nUHVyY2hhc2UobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvL2lzIGFsc28gY2FsbGVkIGJ5IHRva2VuIGNvbnRyaWJ1dGlvbnMKICAgIGZ1bmN0aW9uIGRvRGVwb3NpdChhZGRyZXNzIF9mb3IsIHVpbnQgX3ZhbHVlKSBwcml2YXRlIHsKICAgICAgICB1aW50IGN1cnJTYWxlID0gZ2V0Q3VyclNhbGUoKTsKICAgICAgICBpZiAoIWN1cnJTYWxlQWN0aXZlKCkpIHRocm93OwogICAgICAgIGlmIChfdmFsdWUgPCBzYWxlTWluaW11bVB1cmNoYXNlc1tjdXJyU2FsZV0pIHRocm93OwoKICAgICAgICB1aW50IHRva2Vuc1RvTWludE5vdyA9IHNhbGVzW2N1cnJTYWxlXS5idXlUb2tlbnMoX2ZvciwgX3ZhbHVlLCBjdXJyVGltZSgpKTsKCiAgICAgICAgaWYgKHRva2Vuc1RvTWludE5vdyA+IDApIHsKICAgICAgICAgICAgdG9rZW4ubWludChfZm9yLCB0b2tlbnNUb01pbnROb3cpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvL1Rva2VuIFB1cmNoYXNlcwogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vU3VwcG9ydCBmb3IgcHVyY2hhc2UgdmlhIG90aGVyIHRva2VucwogICAgLy9XZSBkb24ndCBhdHRlbXB0IHRvIGRlYWwgd2l0aCB0aG9zZSB0b2tlbnMgZGlyZWN0bHkKICAgIC8vV2UganVzdCBnaXZlIGFkbWluIGFiaWxpdHkgdG8gdGVsbCB1cyB3aGF0IGRlcG9zaXQgdG8gY3JlZGl0CiAgICAvL1dlIG9ubHkgYWxsb3cgZm9yIGZpcnN0IHNhbGUgCiAgICAvL2JlY2F1c2UgZmlyc3Qgc2FsZSBub3JtYWxseSBoYXMgbm8gcmVmdW5kcwogICAgLy9BcyB3cml0dGVuLCB0aGUgcmVmdW5kIHdvdWxkIGJlIGluIEVUSAoKICAgIGV2ZW50IGxvZ1B1cmNoYXNlVmlhVG9rZW4oCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCB0b2tlbiwgCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZGVwb3NpdGVkVG9rZW5zLCB1aW50IGV0aFZhbHVlLCAKICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiBfcmVmZXJlbmNlKTsKCiAgICBldmVudCBsb2dQdXJjaGFzZVZpYUZpYXQoCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIHVpbnQgZXRoVmFsdWUsIAogICAgICAgICAgICAgICAgICAgICAgICBieXRlczMyIF9yZWZlcmVuY2UpOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgcHVibGljIG1pbnRSZWZzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcmFpc2VkRnJvbVRva2VuOwogICAgdWludCBwdWJsaWMgcmFpc2VkRnJvbUZpYXQ7CgogICAgZnVuY3Rpb24gZGVwb3NpdEZpYXQoYWRkcmVzcyBfZm9yLCB1aW50IF9ldGhWYWx1ZSwgYnl0ZXMzMiBfcmVmZXJlbmNlKSAKICAgIG5vdEFsbFN0b3BwZWQgb25seU93bmVyIHsKICAgICAgICBpZiAoZ2V0Q3VyclNhbGUoKSA+IDApIHRocm93OyAvL29ubHkgZmlyc3Qgc2FsZSBhbGxvd3MgdGhpcwogICAgICAgIGlmIChtaW50UmVmc1tfcmVmZXJlbmNlXSkgdGhyb3c7IC8vYWxyZWFkeSBtaW50ZWQgZm9yIHRoaXMgcmVmZXJlbmNlCiAgICAgICAgbWludFJlZnNbX3JlZmVyZW5jZV0gPSB0cnVlOwogICAgICAgIHJhaXNlZEZyb21GaWF0ID0gc2FmZUFkZChyYWlzZWRGcm9tRmlhdCwgX2V0aFZhbHVlKTsKCiAgICAgICAgZG9EZXBvc2l0KF9mb3IsIF9ldGhWYWx1ZSk7CiAgICAgICAgbG9nUHVyY2hhc2VWaWFGaWF0KF9mb3IsIF9ldGhWYWx1ZSwgX3JlZmVyZW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVwb3NpdFRva2VucyhhZGRyZXNzIF9mb3IsIGFkZHJlc3MgX3Rva2VuLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfZXRoVmFsdWUsIHVpbnQgX2RlcG9zaXRlZFRva2VucywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgX3JlZmVyZW5jZSkgCiAgICBub3RBbGxTdG9wcGVkIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGdldEN1cnJTYWxlKCkgPiAwKSB0aHJvdzsgLy9vbmx5IGZpcnN0IHNhbGUgYWxsb3dzIHRoaXMKICAgICAgICBpZiAobWludFJlZnNbX3JlZmVyZW5jZV0pIHRocm93OyAvL2FscmVhZHkgbWludGVkIGZvciB0aGlzIHJlZmVyZW5jZQogICAgICAgIG1pbnRSZWZzW19yZWZlcmVuY2VdID0gdHJ1ZTsKICAgICAgICByYWlzZWRGcm9tVG9rZW5bX3Rva2VuXSA9IHNhZmVBZGQocmFpc2VkRnJvbVRva2VuW190b2tlbl0sIF9ldGhWYWx1ZSk7CgogICAgICAgIC8vdG9rZW5zIGRvIG5vdCBjb3VudCB0b3dhcmQgcHJpY2UgY2hhbmdlcyBhbmQgbGltaXRzCiAgICAgICAgLy93ZSBoYXZlIHRvIGxvb2sgdXAgcHJpY2luZywgYW5kIGRvIG91ciBvd24gbWludCgpCiAgICAgICAgdWludCB0b2tlbnNQZXJFdGggPSBzYWxlc1swXS50b2tlbnNQZXJFdGgoKTsKICAgICAgICB1aW50IHRrbiA9IHNhZmVNdWwoX2V0aFZhbHVlLCB0b2tlbnNQZXJFdGgpIC8gd2VpUGVyRXRoKCk7CiAgICAgICAgdG9rZW4ubWludChfZm9yLCB0a24pOwogICAgICAgIAogICAgICAgIGxvZ1B1cmNoYXNlVmlhVG9rZW4oX2ZvciwgX3Rva2VuLCBfZGVwb3NpdGVkVG9rZW5zLCBfZXRoVmFsdWUsIF9yZWZlcmVuY2UpOwogICAgfQoKICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vUm91bmRvZmYgUHJvdGVjdGlvbgogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy9wcm90ZWN0IGFnYWluc3Qgcm91bmRvZmYgaW4gcGF5b3V0cwogICAgLy90aGlzIHByZXZlbnRzIGxhc3QgcGVyc29uIGdldHRpbmcgcmVmdW5kIGZyb20gbm90IGJlaW5nIGFibGUgdG8gY29sbGVjdAogICAgZnVuY3Rpb24gc2FmZWJhbGFuY2UodWludCBiYWwpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChiYWwgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYmFsOwogICAgICAgIH0KICAgIH0KCiAgICAvL0l0J2QgYmUgbmljZXIgaWYgbGFzdCBwZXJzb24gZ290IGZ1bGwgYW1vdW50CiAgICAvL2luc3RlYWQgb2YgZ2V0dGluZyBzaG9ydGVkIGJ5IHNhZmViYWxhbmNlKCkKICAgIC8vdG9wVXAoKSBhbGxvd3MgYWRtaW4gdG8gZGVwb3NpdCBleGNlc3MgZXRoZXIgdG8gY292ZXIgaXQKICAgIC8vYW5kIGxhdGVyIGdldCBiYWNrIGFueSBsZWZ0IG92ZXIgCgogICAgdWludCBwdWJsaWMgdG9wVXBBbW91bnQ7CgogICAgZnVuY3Rpb24gdG9wVXAoKSBwYXlhYmxlIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsKICAgICAgICB0b3BVcEFtb3VudCA9IHNhZmVBZGQodG9wVXBBbW91bnQsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdUb3BVcCgpIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsKICAgICAgICB1aW50IGFtb3VudCA9IHRvcFVwQW1vdW50OwogICAgICAgIHRvcFVwQW1vdW50ID0gMDsKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuY2FsbC52YWx1ZShzYWZlYmFsYW5jZShhbW91bnQpKSgpKSB0aHJvdzsKICAgIH0KCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvL0NsYWltcwogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vQ2xhaW0gd2hhdGV2ZXIgeW91J3JlIG93ZWQsIAogICAgLy9mcm9tIHdoYXRldmVyIGNvbXBsZXRlZCBzYWxlcyB5b3UgaGF2ZW4ndCBhbHJlYWR5IGNsYWltZWQKICAgIC8vdGhpcyBjb3ZlcnMgcmVmdW5kcywgYW5kIGFueSB0b2tlbnMgbm90IG1pbnRlZCBpbW1lZGlhdGVseQogICAgLy8oaS5lLiBhdWN0aW9uIHRva2Vucywgbm90IGZpcnN0c2FsZSB0b2tlbnMpCiAgICBmdW5jdGlvbiBjbGFpbSgpIG5vdEFsbFN0b3BwZWQgewogICAgICAgIHZhciAodG9rZW5zLCByZWZ1bmQsIG5jKSA9IGNsYWltYWJsZShtc2cuc2VuZGVyLCB0cnVlKTsKICAgICAgICBuZXh0Q2xhaW1bbXNnLnNlbmRlcl0gPSBuYzsKICAgICAgICBsb2dDbGFpbShtc2cuc2VuZGVyLCByZWZ1bmQsIHRva2Vucyk7CiAgICAgICAgaWYgKHRva2VucyA+IDApIHsKICAgICAgICAgICAgdG9rZW4ubWludChtc2cuc2VuZGVyLCB0b2tlbnMpOwogICAgICAgIH0KICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICByZWZ1bmRJblN0b3BbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKHJlZnVuZEluU3RvcFttc2cuc2VuZGVyXSwgcmVmdW5kKTsKICAgICAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoc2FmZWJhbGFuY2UocmVmdW5kKSkpIHRocm93OwogICAgICAgIH0KICAgIH0KCiAgICAvL0FsbG93IGFkbWluIHRvIGNsYWltIG9uIGJlaGFsZiBvZiB1c2VyIGFuZCBzZW5kIHRvIGFueSBhZGRyZXNzLgogICAgLy9TY2VuYXJpb3M6CiAgICAvLyAgdXNlciBsb3N0IGtleQogICAgLy8gIHVzZXIgc2VudCBmcm9tIGFuIGV4Y2hhbmdlCiAgICAvLyAgdXNlciBoYXMgZXhwZW5zaXZlIGZhbGxiYWNrIGZ1bmN0aW9uCiAgICAvLyAgdXNlciBpcyB1bmtub3duLCBmdW5kcyBwcmVzdW1lZCBhYmFuZG9uZWQKICAgIC8vV2Ugb25seSBhbGxvdyB0aGlzIGFmdGVyIG9uZSB5ZWFyIGhhcyBwYXNzZWQuCiAgICBmdW5jdGlvbiBjbGFpbUZvcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgCiAgICBvbmx5T3duZXIgbm90QWxsU3RvcHBlZCB7CiAgICAgICAgdmFyICh0b2tlbnMsIHJlZnVuZCwgbmMpID0gY2xhaW1hYmxlKF9mcm9tLCBmYWxzZSk7CiAgICAgICAgbmV4dENsYWltW19mcm9tXSA9IG5jOwoKICAgICAgICBsb2dDbGFpbShfZnJvbSwgcmVmdW5kLCB0b2tlbnMpOwoKICAgICAgICBpZiAodG9rZW5zID4gMCkgewogICAgICAgICAgICB0b2tlbi5taW50KF90bywgdG9rZW5zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlZnVuZCA+IDApIHsKICAgICAgICAgICAgcmVmdW5kSW5TdG9wW19mcm9tXSA9IHNhZmVTdWIocmVmdW5kSW5TdG9wW19mcm9tXSwgcmVmdW5kKTsKICAgICAgICAgICAgaWYgKCFfdG8uc2VuZChzYWZlYmFsYW5jZShyZWZ1bmQpKSkgdGhyb3c7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltYWJsZShhZGRyZXNzIF9hLCBib29sIF9pbmNsdWRlUmVjZW50KSAKICAgIGNvbnN0YW50IHByaXZhdGUgdG9rZW5Jc1NldCAKICAgIHJldHVybnMgKHVpbnQgdG9rZW5zLCB1aW50IHJlZnVuZCwgdWludCBuYykgewogICAgICAgIG5jID0gbmV4dENsYWltW19hXTsKCiAgICAgICAgd2hpbGUgKG5jIDwgc2FsZXMubGVuZ3RoICYmCiAgICAgICAgICAgICAgIHNhbGVzW25jXS5pc0NvbXBsZXRlKGN1cnJUaW1lKCkpICYmCiAgICAgICAgICAgICAgICggX2luY2x1ZGVSZWNlbnQgfHwgCiAgICAgICAgICAgICAgICAgc2FsZXNbbmNdLnN0b3BUaW1lKCkgKyAxIHllYXJzIDwgY3VyclRpbWUoKSApKSAKICAgICAgICB7CiAgICAgICAgICAgIHJlZnVuZCA9IHNhZmVBZGQocmVmdW5kLCBzYWxlc1tuY10uZ2V0UmVmdW5kKF9hKSk7CiAgICAgICAgICAgIHRva2VucyA9IHNhZmVBZGQodG9rZW5zLCBzYWxlc1tuY10uZ2V0VG9rZW5zKF9hKSk7CiAgICAgICAgICAgIG5jICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltYWJsZVRva2VucyhhZGRyZXNzIGEpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB2YXIgKHRva2VucywgcmVmdW5kLCBuYykgPSBjbGFpbWFibGUoYSwgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHRva2VuczsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbWFibGVSZWZ1bmQoYWRkcmVzcyBhKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdmFyICh0b2tlbnMsIHJlZnVuZCwgbmMpID0gY2xhaW1hYmxlKGEsIHRydWUpOwogICAgICAgIHJldHVybiByZWZ1bmQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1hYmxlVG9rZW5zKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBjbGFpbWFibGVUb2tlbnMobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1hYmxlUmVmdW5kKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBjbGFpbWFibGVSZWZ1bmQobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy9XaXRoZHJhdyBFVEgKICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICBtYXBwaW5nICh1aW50ID0+IGJvb2wpIG93bmVyQ2xhaW1lZDsKCiAgICBmdW5jdGlvbiBjbGFpbWFibGVPd25lckV0aCh1aW50IHNhbGVudW0pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHRpbWUgPSBjdXJyVGltZSgpOwogICAgICAgIGlmICghc2FsZXNbc2FsZW51bV0uaXNDb21wbGV0ZSh0aW1lKSkgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIHNhbGVzW3NhbGVudW1dLmdldE93bmVyRXRoKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Pd25lckV0aCh1aW50IHNhbGVudW0pIG9ubHlPd25lciBub3RBbGxTdG9wcGVkIHsKICAgICAgICBpZiAob3duZXJDbGFpbWVkW3NhbGVudW1dKSB0aHJvdzsKCiAgICAgICAgdWludCBvd25lcmV0aCA9IGNsYWltYWJsZU93bmVyRXRoKHNhbGVudW0pOwogICAgICAgIGlmIChvd25lcmV0aCA+IDApIHsKICAgICAgICAgICAgb3duZXJDbGFpbWVkW3NhbGVudW1dID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKCAhcGF5ZWUuY2FsbC52YWx1ZShzYWZlYmFsYW5jZShvd25lcmV0aCkpKCkgKSB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy9Td2VlcCB0b2tlbnMgc2VudCBoZXJlCiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy9TdXBwb3J0IHRyYW5zZmVyIG9mIGVyYzIwIHRva2VucyBvdXQgb2YgdGhpcyBjb250cmFjdCdzIGFkZHJlc3MKICAgIC8vRXZlbiBpZiB3ZSBkb24ndCBpbnRlbmQgZm9yIHBlb3BsZSB0byBzZW5kIHRoZW0gaGVyZSwgc29tZWJvZHkgd2lsbAoKICAgIGV2ZW50IGxvZ1Rva2VuVHJhbnNmZXIoYWRkcmVzcyB0b2tlbiwgYWRkcmVzcyB0bywgdWludCBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW5zKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF90bykgb25seU93bmVyIHsKICAgICAgICBUb2tlbiB0b2tlbiA9IFRva2VuKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKF90bywgYmFsYW5jZSk7CiAgICAgICAgbG9nVG9rZW5UcmFuc2ZlcihfdG9rZW4sIF90bywgYmFsYW5jZSk7CiAgICB9CgogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy9FbWVyZ2VuY3kgU3RvcAogICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIGJvb2wgYWxsc3RvcHBlZDsKICAgIGJvb2wgcGVybWFzdG9wcGVkOwoKICAgIC8vYWxsb3cgYWxsU3RvcHBlciB0byBiZSBtb3JlIHNlY3VyZSBhZGRyZXNzIHRoYW4gb3duZXIKICAgIC8vaW4gd2hpY2ggY2FzZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgdG8gbGV0IG93bmVyIGNoYW5nZSBpdCBhZ2FpbgogICAgYWRkcmVzcyBhbGxTdG9wcGVyOwogICAgZnVuY3Rpb24gc2V0QWxsU3RvcHBlcihhZGRyZXNzIF9hKSBvbmx5T3duZXIgewogICAgICAgIGlmIChhbGxTdG9wcGVyICE9IG93bmVyKSByZXR1cm47CiAgICAgICAgYWxsU3RvcHBlciA9IF9hOwogICAgfQogICAgbW9kaWZpZXIgb25seUFsbFN0b3BwZXIoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWxsU3RvcHBlcikgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBldmVudCBsb2dBbGxTdG9wKCk7CiAgICBldmVudCBsb2dBbGxTdGFydCgpOwoKICAgIG1vZGlmaWVyIGFsbFN0b3BwZWQoKSB7CiAgICAgICAgaWYgKCFhbGxzdG9wcGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdEFsbFN0b3BwZWQoKSB7CiAgICAgICAgaWYgKGFsbHN0b3BwZWQpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gYWxsU3RvcCgpIG9ubHlBbGxTdG9wcGVyIHsKICAgICAgICBhbGxzdG9wcGVkID0gdHJ1ZTsgICAgCiAgICAgICAgbG9nQWxsU3RvcCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbFN0YXJ0KCkgb25seUFsbFN0b3BwZXIgewogICAgICAgIGlmICghcGVybWFzdG9wcGVkKSB7CiAgICAgICAgICAgIGFsbHN0b3BwZWQgPSBmYWxzZTsKICAgICAgICAgICAgbG9nQWxsU3RhcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZW1lcmdlbmN5UmVmdW5kKGFkZHJlc3MgX2EsIHVpbnQgX2FtdCkgCiAgICBhbGxTdG9wcGVkIAogICAgb25seUFsbFN0b3BwZXIgewogICAgICAgIC8vaWYgeW91IHN0YXJ0IGFjdHVhbGx5IGNhbGxpbmcgdGhpcyByZWZ1bmQsIHRoZSBkaXNhc3RlciBpcyByZWFsLgogICAgICAgIC8vRG9uJ3QgYWxsb3cgcmVzdGFydCwgc28gdGhpcyBjYW4ndCBiZSBhYnVzZWQgCiAgICAgICAgcGVybWFzdG9wcGVkID0gdHJ1ZTsKCiAgICAgICAgdWludCBhbXQgPSBfYW10OwoKICAgICAgICB1aW50IGV0aGJhbCA9IHJlZnVuZEluU3RvcFtfYV07CgogICAgICAgIC8vY29udmVuaWVudCBkZWZhdWx0IHNvIG93bmVyIGRvZXNuJ3QgaGF2ZSB0byBsb29rIHVwIGJhbGFuY2VzCiAgICAgICAgLy90aGlzIGlzIGZpbmUgYXMgbG9uZyBhcyBubyBmdW5kcyBoYXZlIGJlZW4gc3RvbGVuCiAgICAgICAgaWYgKGFtdCA9PSAwKSBhbXQgPSBldGhiYWw7IAoKICAgICAgICAvL25vYm9keSBjYW4gYmUgcmVmdW5kZWQgbW9yZSB0aGFuIHRoZXkgY29udHJpYnV0ZWQKICAgICAgICBpZiAoYW10ID4gZXRoYmFsKSBhbXQgPSBldGhiYWw7CgogICAgICAgIC8vc2luY2UgZXZlcnl0aGluZyBpcyBoYWx0ZWQsIHNhZmVyIHRvIGNhbGwudmFsdWUKICAgICAgICAvL3NvIHdlIGRvbid0IGhhdmUgdG8gd29ycnkgYWJvdXQgZXhwZW5zaXZlIGZhbGxiYWNrcwogICAgICAgIGlmICggIV9hLmNhbGwudmFsdWUoc2FmZWJhbGFuY2UoYW10KSkoKSApIHRocm93OwogICAgfQoKICAgIGZ1bmN0aW9uIHJhaXNlZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gc2FsZXNbZ2V0Q3VyclNhbGUoKV0ucmFpc2VkKCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzYWxlc1tnZXRDdXJyU2FsZSgpXS50b2tlbnNQZXJFdGgoKTsKICAgIH0KfQ=='.
	

]
