Class {
	#name : #SRT006b4425ba57148466c0c54af1c484348a14a8a4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT006b4425ba57148466c0c54af1c484348a14a8a4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLyBGaWxlOiBjb250cmFjdHNcaW5mcmFzdHJ1Y3R1cmVcSVRva2VuUmV0cmVpdmVyLnNvbAoKLyoqCiAqIEB0aXRsZSBUb2tlbiByZXRyaWV2ZSBpbnRlcmZhY2UKICoKICogQWxsb3dzIHRva2VucyB0byBiZSByZXRyaWV2ZWQgZnJvbSBhIGNvbnRyYWN0CiAqCiAqICNjcmVhdGVkIDI5LzA5LzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IElUb2tlblJldHJlaXZlciB7CgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyZWl2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KTsKfQoKLy8gRmlsZTogY29udHJhY3RzXGludGVncmF0aW9uXHdpbmdzXElXaW5nc0FkYXB0ZXIuc29sCgovKioKICogQHRpdGxlIElXaW5nc0FkYXB0ZXIKICoKICogV0lOR1MgREFPIFByaWNlIERpc2NvdmVyeSAmIFByb21vdGlvbiBQcmUtQmV0YSBodHRwczovL3d3dy53aW5ncy5haQogKgogKiAjY3JlYXRlZCAwNC8xMC8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBJV2luZ3NBZGFwdGVyIHsKCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRvdGFsIHJhaXNlZCBhbW91bnQgb2YgRXRoZXIKICAgICAqCiAgICAgKiBDYW4gb25seSBpbmNyZWFzZSwgbWVhbmluZyBpZiB5b3Ugd2l0aGRyYXcgRVRIIGZyb20gdGhlIHdhbGxldCwgaXQgc2hvdWxkIGJlIG5vdCBtb2RpZmllZCAoeW91IGNhbiB1c2UgdHdvIGZpZWxkcwogICAgICogdG8ga2VlcCBvbmUgd2l0aCBhIHRvdGFsIGFjY3VtdWxhdGVkIGFtb3VudCkgYW1vdW50IG9mIEVUSCBpbiBjb250cmFjdCBhbmQgdG90YWxDb2xsZWN0ZWQgZm9yIHRvdGFsIGFtb3VudCBvZiBFVEggY29sbGVjdGVkCiAgICAgKgogICAgICogQHJldHVybiBUb3RhbCByYWlzZWQgRXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQ29sbGVjdGVkKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0c1xpbmZyYXN0cnVjdHVyZVxtb2RpZmllclxPd25lZC5zb2wKCmNvbnRyYWN0IE93bmVkIHsKCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0aGF0IGlzIHRoZSBjdXJyZW50IG93bmVyCiAgICBhZGRyZXNzIGludGVybmFsIG93bmVyOwoKCiAgICAvKioKICAgICAqIFRoZSBwdWJsaXNoZXIgaXMgdGhlIGluaXRhbCBvd25lcgogICAgICovCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogQWNjZXNzIGlzIHJlc3RyaWN0ZWQgdG8gdGhlIGN1cnJlbnQgb3duZXIKICAgICAqLwogICAgbW9kaWZpZXIgb25seV9vd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwoKICAgICAgICBfOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHNcc291cmNlXHRva2VuXElUb2tlbi5zb2wKCi8qKgogKiBAdGl0bGUgRVJDMjAgY29tcGF0aWJsZSB0b2tlbiBpbnRlcmZhY2UKICoKICogSW1wbGVtZW50cyBFUkMgMjAgVG9rZW4gc3RhbmRhcmQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiAtIFNob3J0IGFkZHJlc3MgYXR0YWNrIGZpeAogKgogKiAjY3JlYXRlZCAyOS8wOS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBJVG9rZW4gewoKICAgIC8qKgogICAgICogR2V0IHRoZSB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zCiAgICAgKgogICAgICogQHJldHVybiBUaGUgdG90YWwgc3VwcGx5CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogR2V0IGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCgogICAgLyoqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAgKgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogU2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogR2V0IHRoZSBhbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyB0aGF0IGBfc3BlbmRlcmAgaXMgYWxsb3dlZCB0byBzcGVuZCBmcm9tIGBfb3duZXJgCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAgKiBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKfQoKLy8gRmlsZTogY29udHJhY3RzXHNvdXJjZVx0b2tlblxJTWFuYWdlZFRva2VuLnNvbAoKLyoqCiAqIEB0aXRsZSBNYW5hZ2VkVG9rZW4gaW50ZXJmYWNlCiAqCiAqIEFkZHMgdGhlIGZvbGxvd2luZyBmdW5jdGlvbmFsbGl0eSB0byB0aGUgYmFzaWMgRVJDMjAgdG9rZW4KICogLSBMb2NraW5nCiAqIC0gSXNzdWluZwogKgogKiAjY3JlYXRlZCAyOS8wOS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBJTWFuYWdlZFRva2VuIGlzIElUb2tlbiB7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHRva2VuIGlzIGxvY2tlZAogICAgICoKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdG9rZW4gaXMgbG9ja2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzTG9ja2VkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogVW5sb2NrcyB0aGUgdG9rZW4gc28gdGhhdCB0aGUgdHJhbnNmZXJyaW5nIG9mIHZhbHVlIGlzIGVuYWJsZWQKICAgICAqCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIHVubG9ja2luZyB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gdW5sb2NrKCkgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogSXNzdWVzIGBfdmFsdWVgIG5ldyB0b2tlbnMgdG8gYF90b2AKICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHdoaWNoIHRoZSB0b2tlbnMgd2lsbCBiZSBpc3N1ZWQKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiBuZXcgdG9rZW5zIHRvIGlzc3VlCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIHRva2VucyB3aGVyZSBzdWNlc3NmdWxseSBpc3N1ZWQgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0c1xzb3VyY2VcY3Jvd2RzYWxlXElDcm93ZHNhbGUuc29sCgovKioKICogQHRpdGxlIElDcm93ZHNhbGUKICoKICogQmFzZSBjcm93ZHNhbGUgaW50ZXJmYWNlIHRvIG1hbmFnZSB0aGUgc2FsZSBvZgogKiBhbiBFUkMyMCB0b2tlbgogKgogKiAjY3JlYXRlZCAyOS8wOS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBJQ3Jvd2RzYWxlIHsKCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbnRyYWN0IGlzIGN1cnJlbnRseSBpbiB0aGUgcHJlc2FsZSBwaGFzZQogICAgICoKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBpbiBwcmVzYWxlIHBoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzSW5QcmVzYWxlUGhhc2UoKSBjb25zdGFudCByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYF9iZW5lZmljaWFyeWAgaGFzIGEgYmFsYW5jZSBhbGxvY2F0ZWQKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgdGhlIGJhbGFuY2UgaXMgYWxsb2NhdGVkIGZvcgogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgYmFsYW5jZSBjYW4gYmUgd2l0aGRyYXduCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlcmUgaXMgYSBiYWxhbmNlIHRoYXQgYmVsb25ncyB0byBgX2JlbmVmaWNpYXJ5YAogICAgICovCiAgICBmdW5jdGlvbiBoYXNCYWxhbmNlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWxlYXNlRGF0ZSkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogR2V0IHRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZSBvZiBgX293bmVyYAogICAgICoKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGFsbG9jYXRlZCB0b2tlbiBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogR2V0IHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGFsbG9jYXRlZCBldGggYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgYWxsb2NhdGVkIGV0aCBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGV0aEJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogR2V0IGludmVzdGVkIGFuZCByZWZ1bmRhYmxlIGJhbGFuY2Ugb2YgYF9vd25lcmAgKG9ubHkgY29udHJpYnV0aW9ucyBkdXJpbmcgdGhlIElDTyBwaGFzZSBhcmUgcmVnaXN0ZXJlZCkKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIHJlZnVuZGFibGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgaW52ZXN0ZWQgcmVmdW5kYWJsZSBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZGFibGVFdGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHJhdGUgYW5kIGJvbnVzIHJlbGVhc2UgZGF0ZQogICAgICoKICAgICAqIEBwYXJhbSBfcGhhc2UgVGhlIHBoYXNlIHRvIHVzZSB3aGlsZSBkZXRlcm1pbmluZyB0aGUgcmF0ZQogICAgICogQHBhcmFtIF92b2x1bWUgVGhlIGFtb3VudCB3ZWkgdXNlZCB0byBkZXRlcm1pbmUgd2hhdCB2b2x1bWUgbXVsdGlwbGllciB0byB1c2UKICAgICAqIEByZXR1cm4gVGhlIHJhdGUgdXNlZCBpbiBgX3BoYXNlYCBtdWx0aXBsaWVkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZvbHVtZSBtdWx0aXBsaWVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUodWludCBfcGhhc2UsIHVpbnQgX3ZvbHVtZSkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogQ29udmVydCBgX3dlaWAgdG8gYW4gYW1vdW50IGluIHRva2VucyB1c2luZwogICAgICogdGhlIGBfcmF0ZWAKICAgICAqCiAgICAgKiBAcGFyYW0gX3dlaSBhbW91bnQgb2Ygd2VpIHRvIGNvbnZlcnQKICAgICAqIEBwYXJhbSBfcmF0ZSByYXRlIHRvIHVzZSBmb3IgdGhlIGNvbnZlcnNpb24KICAgICAqIEByZXR1cm4gQW1vdW50IGluIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiB0b1Rva2Vucyh1aW50IF93ZWksIHVpbnQgX3JhdGUpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKTsKCgogICAgLyoqCiAgICAgKiBXaXRoZHJhdyBhbGxvY2F0ZWQgZXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcigpOwoKCiAgICAvKioKICAgICAqIFJlZnVuZCBpbiB0aGUgY2FzZSBvZiBhbiB1bnN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLiBUaGUKICAgICAqIGNyb3dkc2FsZSBpcyBjb25zaWRlcmVkIHVuc3VjY2Vzc2Z1bCBpZiBtaW5BbW91bnQgd2FzCiAgICAgKiBub3QgcmFpc2VkIGJlZm9yZSBlbmQgb2YgdGhlIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiByZWZ1bmQoKTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIEV0aCBhbmQgaXNzdWUgdG9rZW5zIHRvIHRoZSBzZW5kZXIKICAgICAqLwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZTsKfQoKLy8gRmlsZTogY29udHJhY3RzXHNvdXJjZVxjcm93ZHNhbGVcQ3Jvd2RzYWxlLnNvbAoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUKICoKICogQWJzdHJhY3QgYmFzZSBjcm93ZHNhbGUgY29udHJhY3QgdGhhdCBtYW5hZ2VzIHRoZSBzYWxlIG9mCiAqIGFuIEVSQzIwIHRva2VuCiAqCiAqICNjcmVhdGVkIDI5LzA5LzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBJQ3Jvd2RzYWxlLCBPd25lZCB7CgogICAgZW51bSBTdGFnZXMgewogICAgICAgIERlcGxveWluZywKICAgICAgICBEZXBsb3llZCwKICAgICAgICBJblByb2dyZXNzLAogICAgICAgIEVuZGVkCiAgICB9CgogICAgc3RydWN0IEJhbGFuY2UgewogICAgICAgIHVpbnQgZXRoOwogICAgICAgIHVpbnQgdG9rZW5zOwogICAgICAgIHVpbnQgaW5kZXg7CiAgICB9CgogICAgc3RydWN0IFBlcmNlbnRhZ2UgewogICAgICAgIHVpbnQgZXRoOwogICAgICAgIHVpbnQgdG9rZW5zOwogICAgICAgIGJvb2wgb3ZlcndyaXRlUmVsZWFzZURhdGU7CiAgICAgICAgdWludCBmaXhlZFJlbGVhc2VEYXRlOwogICAgICAgIHVpbnQgaW5kZXg7CiAgICB9CgogICAgc3RydWN0IFBheW91dCB7CiAgICAgICAgdWludCBwZXJjZW50YWdlOwogICAgICAgIHVpbnQgdmVzdGluZ1BlcmlvZDsKICAgIH0KCiAgICBzdHJ1Y3QgUGhhc2UgewogICAgICAgIHVpbnQgcmF0ZTsKICAgICAgICB1aW50IGVuZDsKICAgICAgICB1aW50IGJvbnVzUmVsZWFzZURhdGU7CiAgICAgICAgYm9vbCB1c2VWb2x1bWVNdWx0aXBsaWVyOwogICAgfQoKICAgIHN0cnVjdCBWb2x1bWVNdWx0aXBsaWVyIHsKICAgICAgICB1aW50IHJhdGVNdWx0aXBsaWVyOwogICAgICAgIHVpbnQgYm9udXNSZWxlYXNlRGF0ZU11bHRpcGxpZXI7CiAgICB9CgogICAgLy8gQ3Jvd2RzYWxlIGRldGFpbHMKICAgIHVpbnQgcHVibGljIGJhc2VSYXRlOwogICAgdWludCBwdWJsaWMgbWluQW1vdW50OwogICAgdWludCBwdWJsaWMgbWF4QW1vdW50OwogICAgdWludCBwdWJsaWMgbWluQWNjZXB0ZWRBbW91bnQ7CiAgICB1aW50IHB1YmxpYyBtaW5BbW91bnRQcmVzYWxlOwogICAgdWludCBwdWJsaWMgbWF4QW1vdW50UHJlc2FsZTsKICAgIHVpbnQgcHVibGljIG1pbkFjY2VwdGVkQW1vdW50UHJlc2FsZTsKCiAgICAvLyBDb21wYW55IGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OwoKICAgIC8vIERlbm9taW5hdG9ycwogICAgdWludCBpbnRlcm5hbCBwZXJjZW50YWdlRGVub21pbmF0b3I7CiAgICB1aW50IGludGVybmFsIHRva2VuRGVub21pbmF0b3I7CgogICAgLy8gQ3Jvd2RzYWxlIHN0YXRlCiAgICB1aW50IHB1YmxpYyBzdGFydDsKICAgIHVpbnQgcHVibGljIHByZXNhbGVFbmQ7CiAgICB1aW50IHB1YmxpYyBjcm93ZHNhbGVFbmQ7CiAgICB1aW50IHB1YmxpYyByYWlzZWQ7CiAgICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRFdGg7CiAgICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRUb2tlbnM7CiAgICBTdGFnZXMgcHVibGljIHN0YWdlID0gU3RhZ2VzLkRlcGxveWluZzsKCiAgICAvLyBUb2tlbiBjb250cmFjdAogICAgSU1hbmFnZWRUb2tlbiBwdWJsaWMgdG9rZW47CgogICAgLy8gSW52ZXN0ZWQgYmFsYW5jZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHJpdmF0ZSBiYWxhbmNlczsKCiAgICAvLyBBbG9jYXRlZCBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQgPT4gQmFsYW5jZSkpIHByaXZhdGUgYWxsb2NhdGVkOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnRbXSkgcHJpdmF0ZSBhbGxvY2F0ZWRJbmRleDsKCiAgICAvLyBTdGFrZWhvbGRlcnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gUGVyY2VudGFnZSkgcHJpdmF0ZSBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzOwogICAgYWRkcmVzc1tdIHByaXZhdGUgc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4OwogICAgUGF5b3V0W10gcHJpdmF0ZSBzdGFrZWhvbGRlcnNQYXlvdXRzOwoKICAgIC8vIENyb3dkc2FsZSBwaGFzZXMKICAgIFBoYXNlW10gcHJpdmF0ZSBwaGFzZXM7CgogICAgLy8gVm9sdW1lIG11bHRpcGxpZXJzCiAgICBtYXBwaW5nICh1aW50ID0+IFZvbHVtZU11bHRpcGxpZXIpIHByaXZhdGUgdm9sdW1lTXVsdGlwbGllcnM7CiAgICB1aW50W10gcHJpdmF0ZSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkczsKCgogICAgLyoqCiAgICAgKiBUaHJvdyBpZiBhdCBzdGFnZSBvdGhlciB0aGFuIGN1cnJlbnQgc3RhZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gX3N0YWdlIGV4cGVjdGVkIHN0YWdlIHRvIHRlc3QgZm9yCiAgICAgKi8KICAgIG1vZGlmaWVyIGF0X3N0YWdlKFN0YWdlcyBfc3RhZ2UpIHsKICAgICAgICByZXF1aXJlKHN0YWdlID09IF9zdGFnZSk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBPbmx5IGFmdGVyIGNyb3dkc2FsZUVuZCBwbHVzIGBfdGltZWAKICAgICAqCiAgICAgKiBAcGFyYW0gX3RpbWUgVGltZSB0byBwYXNzCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlfYWZ0ZXIodWludCBfdGltZSkgewogICAgICAgIHJlcXVpcmUobm93ID4gY3Jvd2RzYWxlRW5kICsgX3RpbWUpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogT25seSBhZnRlciBjcm93ZHNhbGUKICAgICAqLwogICAgbW9kaWZpZXIgb25seV9hZnRlcl9jcm93ZHNhbGUoKSB7CiAgICAgICAgcmVxdWlyZShub3cgPiBjcm93ZHNhbGVFbmQpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogVGhyb3cgaWYgc2VuZGVyIGlzIG5vdCBiZW5lZmljaWFyeQogICAgICovCiAgICBtb2RpZmllciBvbmx5X2JlbmVmaWNpYXJ5KCkgewogICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvd3MgdGhlIGltcGxlbWVudGluZyBjb250cmFjdCB0byB2YWxpZGF0ZSBhCiAgICAgKiBjb250cmlidXRpbmcgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfY29udHJpYnV0b3IgQWRkcmVzcyB0aGF0IGlzIGJlaW5nIHZhbGlkYXRlZAogICAgICogQHJldHVybiBXaGV0ZXIgdGhlIGNvbnRyaWJ1dG9yIGlzIGFjY2VwdGVkIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBpc0FjY2VwdGVkQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIFNldHVwIHRoZSBjcm93ZHNhbGUKICAgICAqCiAgICAgKiBAcGFyYW0gX3N0YXJ0IFRoZSB0aW1lc3RhbXAgb2YgdGhlIHN0YXJ0IGRhdGUKICAgICAqIEBwYXJhbSBfdG9rZW4gVGhlIHRva2VuIHRoYXQgaXMgc29sZAogICAgICogQHBhcmFtIF90b2tlbkRlbm9taW5hdG9yIFRoZSB0b2tlbiBhbW91bnQgb2YgZGVjaW1hbHMgdGhhdCB0aGUgdG9rZW4gdXNlcwogICAgICogQHBhcmFtIF9wZXJjZW50YWdlRGVub21pbmF0b3IgVGhlIHBlcmNpc2lvbiBvZiBwZXJjZW50YWdlcwogICAgICogQHBhcmFtIF9taW5BbW91bnQgVGhlIG1pbiBjYXAgZm9yIHRoZSBJQ08KICAgICAqIEBwYXJhbSBfbWF4QW1vdW50IFRoZSBtYXggY2FwIGZvciB0aGUgSUNPCiAgICAgKiBAcGFyYW0gX21pbkFjY2VwdGVkQW1vdW50IFRoZSBsb3dlc3QgYWNjZXB0ZWQgYW1vdW50IGR1cmluZyB0aGUgSUNPIHBoYXNlCiAgICAgKiBAcGFyYW0gX21pbkFtb3VudFByZXNhbGUgVGhlIG1pbiBjYXAgZm9yIHRoZSBwcmVzYWxlCiAgICAgKiBAcGFyYW0gX21heEFtb3VudFByZXNhbGUgVGhlIG1heCBjYXAgZm9yIHRoZSBwcmVzYWxlCiAgICAgKiBAcGFyYW0gX21pbkFjY2VwdGVkQW1vdW50UHJlc2FsZSBUaGUgbG93ZXN0IGFjY2VwdGVkIGFtb3VudCBkdXJpbmcgdGhlIHByZXNhbGUgcGhhc2UKICAgICAqLwogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQgX3N0YXJ0LCBhZGRyZXNzIF90b2tlbiwgdWludCBfdG9rZW5EZW5vbWluYXRvciwgdWludCBfcGVyY2VudGFnZURlbm9taW5hdG9yLCB1aW50IF9taW5BbW91bnQsIHVpbnQgX21heEFtb3VudCwgdWludCBfbWluQWNjZXB0ZWRBbW91bnQsIHVpbnQgX21pbkFtb3VudFByZXNhbGUsIHVpbnQgX21heEFtb3VudFByZXNhbGUsIHVpbnQgX21pbkFjY2VwdGVkQW1vdW50UHJlc2FsZSkgewogICAgICAgIHRva2VuID0gSU1hbmFnZWRUb2tlbihfdG9rZW4pOwogICAgICAgIHRva2VuRGVub21pbmF0b3IgPSBfdG9rZW5EZW5vbWluYXRvcjsKICAgICAgICBwZXJjZW50YWdlRGVub21pbmF0b3IgPSBfcGVyY2VudGFnZURlbm9taW5hdG9yOwogICAgICAgIHN0YXJ0ID0gX3N0YXJ0OwogICAgICAgIG1pbkFtb3VudCA9IF9taW5BbW91bnQ7CiAgICAgICAgbWF4QW1vdW50ID0gX21heEFtb3VudDsKICAgICAgICBtaW5BY2NlcHRlZEFtb3VudCA9IF9taW5BY2NlcHRlZEFtb3VudDsKICAgICAgICBtaW5BbW91bnRQcmVzYWxlID0gX21pbkFtb3VudFByZXNhbGU7CiAgICAgICAgbWF4QW1vdW50UHJlc2FsZSA9IF9tYXhBbW91bnRQcmVzYWxlOwogICAgICAgIG1pbkFjY2VwdGVkQW1vdW50UHJlc2FsZSA9IF9taW5BY2NlcHRlZEFtb3VudFByZXNhbGU7CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgcmF0ZXMgYW5kIHBoYXNlcwogICAgICoKICAgICAqIEBwYXJhbSBfYmFzZVJhdGUgVGhlIHJhdGUgd2l0aG91dCBib251cwogICAgICogQHBhcmFtIF9waGFzZVJhdGVzIFRoZSByYXRlcyBmb3IgZWFjaCBwaGFzZQogICAgICogQHBhcmFtIF9waGFzZVBlcmlvZHMgVGhlIHBlcmlvZHMgdGhhdCBlYWNoIHBoYXNlIGxhc3RzIChmaXJzdCBwaGFzZSBpcyB0aGUgcHJlc2FsZSBwaGFzZSkKICAgICAqIEBwYXJhbSBfcGhhc2VCb251c0xvY2t1cFBlcmlvZHMgVGhlIGxvY2t1cCBwZXJpb2QgdGhhdCBlYWNoIHBoYXNlIGxhc3RzCiAgICAgKiBAcGFyYW0gX3BoYXNlVXNlc1ZvbHVtZU11bHRpcGxpZXIgV2hldGVyIG9yIG5vdCB2b2x1bWUgYm9udXNzZXMgYXJlIHVzZWQgaW4gdGhlIHJlc3BlY3RpdmUgcGhhc2UKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBQaGFzZXModWludCBfYmFzZVJhdGUsIHVpbnRbXSBfcGhhc2VSYXRlcywgdWludFtdIF9waGFzZVBlcmlvZHMsIHVpbnRbXSBfcGhhc2VCb251c0xvY2t1cFBlcmlvZHMsIGJvb2xbXSBfcGhhc2VVc2VzVm9sdW1lTXVsdGlwbGllcikgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIGJhc2VSYXRlID0gX2Jhc2VSYXRlOwogICAgICAgIHByZXNhbGVFbmQgPSBzdGFydCArIF9waGFzZVBlcmlvZHNbMF07IC8vIEZpcnN0IHBoYXNlIGlzIGV4cGVjdGVkIHRvIGJlIHRoZSBwcmVzYWxlIHBoYXNlCiAgICAgICAgY3Jvd2RzYWxlRW5kID0gc3RhcnQ7IC8vIFBsdXMgdGhlIHN1bSBvZiB0aGUgcmF0ZSBwaGFzZXMKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3BoYXNlUmF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY3Jvd2RzYWxlRW5kICs9IF9waGFzZVBlcmlvZHNbaV07CiAgICAgICAgICAgIHBoYXNlcy5wdXNoKFBoYXNlKF9waGFzZVJhdGVzW2ldLCBjcm93ZHNhbGVFbmQsIDAsIF9waGFzZVVzZXNWb2x1bWVNdWx0aXBsaWVyW2ldKSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaWkgPSAwOyBpaSA8IF9waGFzZVJhdGVzLmxlbmd0aDsgaWkrKykgewogICAgICAgICAgICBpZiAoX3BoYXNlQm9udXNMb2NrdXBQZXJpb2RzW2lpXSA+IDApIHsKICAgICAgICAgICAgICAgIHBoYXNlc1tpaV0uYm9udXNSZWxlYXNlRGF0ZSA9IGNyb3dkc2FsZUVuZCArIF9waGFzZUJvbnVzTG9ja3VwUGVyaW9kc1tpaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgc3Rha2Vob2xkZXJzCiAgICAgKgogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlcnMgVGhlIGFkZHJlc3NlcyBvZiB0aGUgc3Rha2Vob2xkZXJzIChmaXJzdCBzdGFrZWhvbGRlciBpcyB0aGUgYmVuZWZpY2lhcnkpCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyRXRoUGVyY2VudGFnZXMgVGhlIGV0aCBwZXJjZW50YWdlcyBvZiB0aGUgc3Rha2Vob2xkZXJzCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyVG9rZW5QZXJjZW50YWdlcyBUaGUgdG9rZW4gcGVyY2VudGFnZXMgb2YgdGhlIHN0YWtlaG9sZGVycwogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0T3ZlcndyaXRlUmVsZWFzZURhdGVzIFdoZXRlciB0aGUgdmVzdGluZyBwZXJpb2QgaXMgb3ZlcndyaXR0ZW4gZm9yIHRoZSByZXNwZWN0aXZlIHN0YWtlaG9sZGVyCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRGaXhlZFJlbGVhc2VEYXRlcyBUaGUgdmVzdGluZyBwZXJpb2QgYWZ0ZXIgd2hpY2ggdGhlIHdob2xlIHBlcmNlbnRhZ2Ugb2YgdGhlIHRva2VucyBpcyByZWxlYXNlZCB0byB0aGUgcmVzcGVjdGl2ZSBzdGFrZWhvbGRlcgogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0UGVyY2VudGFnZXMgVGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIHRva2VucyB0aGF0IGlzIHJlbGVhc2VkIGF0IHRoZSByZXNwZWN0aXZlIGRhdGUKICAgICAqIEBwYXJhbSBfc3Rha2Vob2xkZXJUb2tlblBheW91dFZlc3RpbmdQZXJpb2RzIFRoZSB2ZXN0aW5nIHBlcmlvZCBhZnRlciB3aGljaCB0aGUgcmVzcGVjdGl2ZSBwZXJjZW50YWdlIG9mIHRoZSB0b2tlbnMgaXMgcmVsZWFzZWQKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBTdGFrZWhvbGRlcnMoYWRkcmVzc1tdIF9zdGFrZWhvbGRlcnMsIHVpbnRbXSBfc3Rha2Vob2xkZXJFdGhQZXJjZW50YWdlcywgdWludFtdIF9zdGFrZWhvbGRlclRva2VuUGVyY2VudGFnZXMsIGJvb2xbXSBfc3Rha2Vob2xkZXJUb2tlblBheW91dE92ZXJ3cml0ZVJlbGVhc2VEYXRlcywgdWludFtdIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0Rml4ZWRSZWxlYXNlRGF0ZXMsIHVpbnRbXSBfc3Rha2Vob2xkZXJUb2tlblBheW91dFBlcmNlbnRhZ2VzLCB1aW50W10gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRWZXN0aW5nUGVyaW9kcykgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIGJlbmVmaWNpYXJ5ID0gX3N0YWtlaG9sZGVyc1swXTsgLy8gRmlyc3Qgc3Rha2Vob2xkZXIgaXMgZXhwZWN0ZWQgdG8gYmUgdGhlIGJlbmVmaWNpYXJ5CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3N0YWtlaG9sZGVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXgucHVzaChfc3Rha2Vob2xkZXJzW2ldKTsKICAgICAgICAgICAgc3Rha2Vob2xkZXJQZXJjZW50YWdlc1tfc3Rha2Vob2xkZXJzW2ldXSA9IFBlcmNlbnRhZ2UoCiAgICAgICAgICAgICAgICBfc3Rha2Vob2xkZXJFdGhQZXJjZW50YWdlc1tpXSwKICAgICAgICAgICAgICAgIF9zdGFrZWhvbGRlclRva2VuUGVyY2VudGFnZXNbaV0sCiAgICAgICAgICAgICAgICBfc3Rha2Vob2xkZXJUb2tlblBheW91dE92ZXJ3cml0ZVJlbGVhc2VEYXRlc1tpXSwKICAgICAgICAgICAgICAgIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0Rml4ZWRSZWxlYXNlRGF0ZXNbaV0sIGkpOwogICAgICAgIH0KCiAgICAgICAgLy8gUGVyY2VudGFnZXMgYWRkIHVwIHRvIDEwMAogICAgICAgIGZvciAodWludCBpaSA9IDA7IGlpIDwgX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRQZXJjZW50YWdlcy5sZW5ndGg7IGlpKyspIHsKICAgICAgICAgICAgc3Rha2Vob2xkZXJzUGF5b3V0cy5wdXNoKFBheW91dChfc3Rha2Vob2xkZXJUb2tlblBheW91dFBlcmNlbnRhZ2VzW2lpXSwgX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRWZXN0aW5nUGVyaW9kc1tpaV0pKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgdm9sdW1lIG11bHRpcGxpZXJzCiAgICAgKgogICAgICogQHBhcmFtIF92b2x1bWVNdWx0aXBsaWVyUmF0ZXMgVGhlIHJhdGVzIHdpbGwgYmUgbXVsdGlwbGllZCBieSB0aGlzIHZhbHVlIChkZW5vbWluYXRlZCBieSA0KQogICAgICogQHBhcmFtIF92b2x1bWVNdWx0aXBsaWVyTG9ja3VwUGVyaW9kcyBUaGUgbG9ja3VwIHBlcmlvZHMgd2lsbCBiZSBtdWx0aXBsaWVkIGJ5IHRoaXMgdmFsdWUgKGRlbm9taW5hdGVkIGJ5IDQpCiAgICAgKiBAcGFyYW0gX3ZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzIFRoZSB2b2x1bWUgdGhyZXNob2xkcyBmb3IgZWFjaCByZXNwZWN0aXZlIG11bHRpcGxpZXIKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBWb2x1bWVNdWx0aXBsaWVycyh1aW50W10gX3ZvbHVtZU11bHRpcGxpZXJSYXRlcywgdWludFtdIF92b2x1bWVNdWx0aXBsaWVyTG9ja3VwUGVyaW9kcywgdWludFtdIF92b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcykgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIHJlcXVpcmUocGhhc2VzLmxlbmd0aCA+IDApOwogICAgICAgIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzID0gX3ZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZvbHVtZU11bHRpcGxpZXJzW3ZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzW2ldXSA9IFZvbHVtZU11bHRpcGxpZXIoX3ZvbHVtZU11bHRpcGxpZXJSYXRlc1tpXSwgX3ZvbHVtZU11bHRpcGxpZXJMb2NrdXBQZXJpb2RzW2ldKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQWZ0ZXIgY2FsbGluZyB0aGUgZGVwbG95IGZ1bmN0aW9uIHRoZSBjcm93ZHNhbGUKICAgICAqIHJ1bGVzIGJlY29tZSBpbW11dGFibGUKICAgICAqLwogICAgZnVuY3Rpb24gZGVwbG95KCkgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIHJlcXVpcmUocGhhc2VzLmxlbmd0aCA+IDApOwogICAgICAgIHJlcXVpcmUoc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4Lmxlbmd0aCA+IDApOwogICAgICAgIHN0YWdlID0gU3RhZ2VzLkRlcGxveWVkOwogICAgfQoKCiAgICAvKioKICAgICAqIFByb3ZlIHRoYXQgYmVuZWZpY2lhcnkgaXMgYWJsZSB0byBzaWduIHRyYW5zYWN0aW9ucwogICAgICogYW5kIHN0YXJ0IHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gY29uZmlybUJlbmVmaWNpYXJ5KCkgcHVibGljIG9ubHlfYmVuZWZpY2lhcnkgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWVkKSB7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuSW5Qcm9ncmVzczsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbnRyYWN0IGlzIGN1cnJlbnRseSBpbiB0aGUgcHJlc2FsZSBwaGFzZQogICAgICoKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBpbiBwcmVzYWxlIHBoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzSW5QcmVzYWxlUGhhc2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdGFnZSA9PSBTdGFnZXMuSW5Qcm9ncmVzcyAmJiBub3cgPj0gc3RhcnQgJiYgbm93IDw9IHByZXNhbGVFbmQ7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIGBfYmVuZWZpY2lhcnlgIGhhcyBhIGJhbGFuY2UgYWxsb2NhdGVkCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0aGF0IHRoZSBiYWxhbmNlIGlzIGFsbG9jYXRlZCBmb3IKICAgICAqIEBwYXJhbSBfcmVsZWFzZURhdGUgVGhlIGRhdGUgYWZ0ZXIgd2hpY2ggdGhlIGJhbGFuY2UgY2FuIGJlIHdpdGhkcmF3bgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZXJlIGlzIGEgYmFsYW5jZSB0aGF0IGJlbG9uZ3MgdG8gYF9iZW5lZmljaWFyeWAKICAgICAqLwogICAgZnVuY3Rpb24gaGFzQmFsYW5jZShhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfcmVsZWFzZURhdGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFsbG9jYXRlZEluZGV4W19iZW5lZmljaWFyeV0ubGVuZ3RoID4gMCAmJiBfcmVsZWFzZURhdGUgPT0gYWxsb2NhdGVkSW5kZXhbX2JlbmVmaWNpYXJ5XVthbGxvY2F0ZWRbX2JlbmVmaWNpYXJ5XVtfcmVsZWFzZURhdGVdLmluZGV4XTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFsbG9jYXRlZCB0b2tlbiBiYWxhbmNlIG9mIGBfb3duZXJgCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgc3VtID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbGxvY2F0ZWRJbmRleFtfb3duZXJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBhbGxvY2F0ZWRbX293bmVyXVthbGxvY2F0ZWRJbmRleFtfb3duZXJdW2ldXS50b2tlbnM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3VtOwogICAgfQoKCiAgICAvKioKICAgICAqIEdldCB0aGUgYWxsb2NhdGVkIGV0aCBiYWxhbmNlIG9mIGBfb3duZXJgCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGFsbG9jYXRlZCBldGggYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBldGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBzdW0gPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsbG9jYXRlZEluZGV4W19vd25lcl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3VtICs9IGFsbG9jYXRlZFtfb3duZXJdW2FsbG9jYXRlZEluZGV4W19vd25lcl1baV1dLmV0aDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdW07CiAgICB9CgoKICAgIC8qKgogICAgICogR2V0IGludmVzdGVkIGFuZCByZWZ1bmRhYmxlIGJhbGFuY2Ugb2YgYF9vd25lcmAgKG9ubHkgY29udHJpYnV0aW9ucyBkdXJpbmcgdGhlIElDTyBwaGFzZSBhcmUgcmVnaXN0ZXJlZCkKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIHJlZnVuZGFibGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgaW52ZXN0ZWQgcmVmdW5kYWJsZSBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZGFibGVFdGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG5vdyA+IGNyb3dkc2FsZUVuZCAmJiByYWlzZWQgPCBtaW5BbW91bnQgPyBiYWxhbmNlc1tfb3duZXJdIDogMDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHBoYXNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IHRpbWUKICAgICAqCiAgICAgKiBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UGhhc2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobm93IDw9IHBoYXNlc1tpXS5lbmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBwaGFzZXMubGVuZ3RoOyAvLyBEb2VzIG5vdCBleGlzdAogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHJhdGUgYW5kIGJvbnVzIHJlbGVhc2UgZGF0ZQogICAgICoKICAgICAqIEBwYXJhbSBfcGhhc2UgVGhlIHBoYXNlIHRvIHVzZSB3aGlsZSBkZXRlcm1pbmluZyB0aGUgcmF0ZQogICAgICogQHBhcmFtIF92b2x1bWUgVGhlIGFtb3VudCB3ZWkgdXNlZCB0byBkZXRlcm1pbiB3aGF0IHZvbHVtZSBtdWx0aXBsaWVyIHRvIHVzZQogICAgICogQHJldHVybiBUaGUgcmF0ZSB1c2VkIGluIGBfcGhhc2VgIG11bHRpcGxpZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdm9sdW1lIG11bHRpcGxpZXIKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmF0ZSh1aW50IF9waGFzZSwgdWludCBfdm9sdW1lKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcmF0ZSA9IDA7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5JblByb2dyZXNzICYmIG5vdyA+PSBzdGFydCkgewogICAgICAgICAgICBQaGFzZSBzdG9yYWdlIHBoYXNlID0gcGhhc2VzW19waGFzZV07CiAgICAgICAgICAgIHJhdGUgPSBwaGFzZS5yYXRlOwoKICAgICAgICAgICAgLy8gRmluZCB2b2x1bWUgbXVsdGlwbGllcgogICAgICAgICAgICBpZiAocGhhc2UudXNlVm9sdW1lTXVsdGlwbGllciAmJiB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcy5sZW5ndGggPiAwICYmIF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbMF0pIHsKICAgICAgICAgICAgICAgIGZvciAodWludCBpID0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHMubGVuZ3RoOyBpID4gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFZvbHVtZU11bHRpcGxpZXIgc3RvcmFnZSBtdWx0aXBsaWVyID0gdm9sdW1lTXVsdGlwbGllcnNbdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZSArPSBwaGFzZS5yYXRlICogbXVsdGlwbGllci5yYXRlTXVsdGlwbGllciAvIHBlcmNlbnRhZ2VEZW5vbWluYXRvcjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmF0ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBHZXQgZGlzdHJpYnV0aW9uIGRhdGEgYmFzZWQgb24gdGhlIGN1cnJlbnQgcGhhc2UgYW5kCiAgICAgKiB0aGUgdm9sdW1lIGluIHdlaSB0aGF0IGlzIGJlaW5nIGRpc3RyaWJ1dGVkCiAgICAgKgogICAgICogQHBhcmFtIF9waGFzZSBUaGUgY3VycmVudCBjcm93ZHNhbGUgcGhhc2UKICAgICAqIEBwYXJhbSBfdm9sdW1lIFRoZSBhbW91bnQgd2VpIHVzZWQgdG8gZGV0ZXJtaW5lIHdoYXQgdm9sdW1lIG11bHRpcGxpZXIgdG8gdXNlCiAgICAgKiBAcmV0dXJuIFZvbHVtZXMgYW5kIGNvcnJlc3BvbmRpbmcgcmVsZWFzZSBkYXRlcwogICAgICovCiAgICBmdW5jdGlvbiBnZXREaXN0cmlidXRpb25EYXRhKHVpbnQgX3BoYXNlLCB1aW50IF92b2x1bWUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnRbXSwgdWludFtdKSB7CiAgICAgICAgUGhhc2Ugc3RvcmFnZSBwaGFzZSA9IHBoYXNlc1tfcGhhc2VdOwogICAgICAgIHVpbnQgcmVtYWluaW5nVm9sdW1lID0gX3ZvbHVtZTsKCiAgICAgICAgYm9vbCB1c2luZ011bHRpcGxpZXIgPSBmYWxzZTsKICAgICAgICB1aW50W10gbWVtb3J5IHZvbHVtZXMgPSBuZXcgdWludFtdKDEpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgcmVsZWFzZURhdGVzID0gbmV3IHVpbnRbXSgxKTsKCiAgICAgICAgLy8gRmluZCB2b2x1bWUgbXVsdGlwbGllcnMKICAgICAgICBpZiAocGhhc2UudXNlVm9sdW1lTXVsdGlwbGllciAmJiB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcy5sZW5ndGggPiAwICYmIF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbMF0pIHsKICAgICAgICAgICAgdWludCBwaGFzZVJlbGVhc2VQZXJpb2QgPSBwaGFzZS5ib251c1JlbGVhc2VEYXRlIC0gY3Jvd2RzYWxlRW5kOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzLmxlbmd0aDsgaSA+IDA7IGktLSkgewogICAgICAgICAgICAgICAgaWYgKF92b2x1bWUgPj0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2luZ011bHRpcGxpZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lcyA9IG5ldyB1aW50W10oaSArIDEpOwogICAgICAgICAgICAgICAgICAgICAgICByZWxlYXNlRGF0ZXMgPSBuZXcgdWludFtdKGkgKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXNpbmdNdWx0aXBsaWVyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIFZvbHVtZU11bHRpcGxpZXIgc3RvcmFnZSBtdWx0aXBsaWVyID0gdm9sdW1lTXVsdGlwbGllcnNbdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHNbaSAtIDFdXTsKICAgICAgICAgICAgICAgICAgICB1aW50IHJlbGVhc2VEYXRlID0gcGhhc2UuYm9udXNSZWxlYXNlRGF0ZSArIHBoYXNlUmVsZWFzZVBlcmlvZCAqIG11bHRpcGxpZXIuYm9udXNSZWxlYXNlRGF0ZU11bHRpcGxpZXIgLyBwZXJjZW50YWdlRGVub21pbmF0b3I7CiAgICAgICAgICAgICAgICAgICAgdWludCB2b2x1bWUgPSByZW1haW5pbmdWb2x1bWUgLSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpIC0gMV07CgogICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIGluY3JlbWVudAogICAgICAgICAgICAgICAgICAgIHZvbHVtZXNbaV0gPSB2b2x1bWU7CiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZURhdGVzW2ldID0gcmVsZWFzZURhdGU7CgogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ1ZvbHVtZSAtPSB2b2x1bWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFN0b3JlIGluY3JlbWVudAogICAgICAgIHZvbHVtZXNbMF0gPSByZW1haW5pbmdWb2x1bWU7CiAgICAgICAgcmVsZWFzZURhdGVzWzBdID0gcGhhc2UuYm9udXNSZWxlYXNlRGF0ZTsKCiAgICAgICAgcmV0dXJuICh2b2x1bWVzLCByZWxlYXNlRGF0ZXMpOwogICAgfQoKCiAgICAvKioKICAgICAqIENvbnZlcnQgYF93ZWlgIHRvIGFuIGFtb3VudCBpbiB0b2tlbnMgdXNpbmcKICAgICAqIHRoZSBgX3JhdGVgCiAgICAgKgogICAgICogQHBhcmFtIF93ZWkgYW1vdW50IG9mIHdlaSB0byBjb252ZXJ0CiAgICAgKiBAcGFyYW0gX3JhdGUgcmF0ZSB0byB1c2UgZm9yIHRoZSBjb252ZXJzaW9uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gdG9Ub2tlbnModWludCBfd2VpLCB1aW50IF9yYXRlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfd2VpICogX3JhdGUgKiB0b2tlbkRlbm9taW5hdG9yIC8gMSBldGhlcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBlbmQgdGhlIGNyb3dkc2FsZSBieSBzZXR0aW5nCiAgICAgKiB0aGUgc3RhZ2UgdG8gRW5kZWQKICAgICAqLwogICAgZnVuY3Rpb24gZW5kQ3Jvd2RzYWxlKCkgcHVibGljIGF0X3N0YWdlKFN0YWdlcy5JblByb2dyZXNzKSB7CiAgICAgICAgcmVxdWlyZShub3cgPiBjcm93ZHNhbGVFbmQgfHwgcmFpc2VkID49IG1heEFtb3VudCk7CiAgICAgICAgcmVxdWlyZShyYWlzZWQgPj0gbWluQW1vdW50KTsKICAgICAgICBzdGFnZSA9IFN0YWdlcy5FbmRlZDsKCiAgICAgICAgLy8gVW5sb2NrIHRva2VuCiAgICAgICAgaWYgKCF0b2tlbi51bmxvY2soKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIEFsbG9jYXRlIHRva2VucyAobm8gYWxsb2NhdGlvbiBjYW4gYmUgZG9uZSBhZnRlciB0aGlzIHBlcmlvZCkKICAgICAgICB1aW50IHRvdGFsVG9rZW5TdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseSgpICsgYWxsb2NhdGVkVG9rZW5zOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHN0YWtlaG9sZGVyc1BheW91dHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgUGF5b3V0IHN0b3JhZ2UgcCA9IHN0YWtlaG9sZGVyc1BheW91dHNbaV07CiAgICAgICAgICAgIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc1Rva2Vucyh0b3RhbFRva2VuU3VwcGx5ICogcC5wZXJjZW50YWdlIC8gcGVyY2VudGFnZURlbm9taW5hdG9yLCBub3cgKyBwLnZlc3RpbmdQZXJpb2QpOwogICAgICAgIH0KCiAgICAgICAgLy8gQWxsb2NhdGUgcmVtYWluaW5nIEVUSAogICAgICAgIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc0V0aCh0aGlzLmJhbGFuY2UgLSBhbGxvY2F0ZWRFdGgsIDApOwogICAgfQoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSBwdWJsaWMgewogICAgICAgIHVpbnQgdG9rZW5zVG9TZW5kID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbGxvY2F0ZWRJbmRleFttc2cuc2VuZGVyXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50IHJlbGVhc2VEYXRlID0gYWxsb2NhdGVkSW5kZXhbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgIGlmIChyZWxlYXNlRGF0ZSA8PSBub3cpIHsKICAgICAgICAgICAgICAgIEJhbGFuY2Ugc3RvcmFnZSBiID0gYWxsb2NhdGVkW21zZy5zZW5kZXJdW3JlbGVhc2VEYXRlXTsKICAgICAgICAgICAgICAgIHRva2Vuc1RvU2VuZCArPSBiLnRva2VuczsKICAgICAgICAgICAgICAgIGIudG9rZW5zID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRva2Vuc1RvU2VuZCA+IDApIHsKICAgICAgICAgICAgYWxsb2NhdGVkVG9rZW5zIC09IHRva2Vuc1RvU2VuZDsKICAgICAgICAgICAgaWYgKCF0b2tlbi5pc3N1ZShtc2cuc2VuZGVyLCB0b2tlbnNUb1NlbmQpKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBXaXRoZHJhdyBhbGxvY2F0ZWQgZXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcigpIHB1YmxpYyB7CiAgICAgICAgdWludCBldGhUb1NlbmQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsbG9jYXRlZEluZGV4W21zZy5zZW5kZXJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgcmVsZWFzZURhdGUgPSBhbGxvY2F0ZWRJbmRleFttc2cuc2VuZGVyXVtpXTsKICAgICAgICAgICAgaWYgKHJlbGVhc2VEYXRlIDw9IG5vdykgewogICAgICAgICAgICAgICAgQmFsYW5jZSBzdG9yYWdlIGIgPSBhbGxvY2F0ZWRbbXNnLnNlbmRlcl1bcmVsZWFzZURhdGVdOwogICAgICAgICAgICAgICAgZXRoVG9TZW5kICs9IGIuZXRoOwogICAgICAgICAgICAgICAgYi5ldGggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXRoVG9TZW5kID4gMCkgewogICAgICAgICAgICBhbGxvY2F0ZWRFdGggLT0gZXRoVG9TZW5kOwogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChldGhUb1NlbmQpKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWZ1bmQgaW4gdGhlIGNhc2Ugb2YgYW4gdW5zdWNjZXNzZnVsIGNyb3dkc2FsZS4gVGhlCiAgICAgKiBjcm93ZHNhbGUgaXMgY29uc2lkZXJlZCB1bnN1Y2Nlc3NmdWwgaWYgbWluQW1vdW50IHdhcwogICAgICogbm90IHJhaXNlZCBiZWZvcmUgZW5kIG9mIHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIG9ubHlfYWZ0ZXJfY3Jvd2RzYWxlIGF0X3N0YWdlKFN0YWdlcy5JblByb2dyZXNzKSB7CiAgICAgICAgcmVxdWlyZShyYWlzZWQgPCBtaW5BbW91bnQpOwoKICAgICAgICB1aW50IHJlY2VpdmVkQW1vdW50ID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICBpZiAocmVjZWl2ZWRBbW91bnQgPiAwICYmICFtc2cuc2VuZGVyLnNlbmQocmVjZWl2ZWRBbW91bnQpKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gcmVjZWl2ZWRBbW91bnQ7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIEZhaWxzYWZlIGFuZCBjbGVhbi11cCBtZWNoYW5pc20KICAgICAqLwogICAgZnVuY3Rpb24gZGVzdHJveSgpIHB1YmxpYyBvbmx5X2JlbmVmaWNpYXJ5IG9ubHlfYWZ0ZXIoMiB5ZWFycykgewogICAgICAgIHNlbGZkZXN0cnVjdChiZW5lZmljaWFyeSk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBFdGggYW5kIGlzc3VlIHRva2VucyB0byB0aGUgc2VuZGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGUoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgX2hhbmRsZVRyYW5zYWN0aW9uKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBFdGggYW5kIGlzc3VlIHRva2VucyB0byB0aGUgc2VuZGVyCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyB0aGF0IG1zZy5zZW5kZXIgaXMgbm90IGEgY29udHJhY3QuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSBpdCdzCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKQogICAgICogZnVuY3Rpb24uIFNvbGlkaXR5IGltcG9zZXMgYSBtYXhpbXVtIGFtb3VudCBvZiBnYXMgKDIzMDAgZ2FzIGF0IHRoZSB0aW1lIG9mIHdyaXRpbmcpCiAgICAgKgogICAgICogQ29udHJhY3RzIGNhbiBjYWxsIHRoZSBjb250cmlidXRlKCkgZnVuY3Rpb24gaW5zdGVhZAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdHgub3JpZ2luKTsKICAgICAgICBfaGFuZGxlVHJhbnNhY3Rpb24obXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBIYW5kbGUgaW5jb21pbmcgdHJhbnNhY3Rpb25zCiAgICAgKgoKICAgICAqLwogICAgZnVuY3Rpb24gX2hhbmRsZVRyYW5zYWN0aW9uKGFkZHJlc3MgX3NlbmRlciwgdWludCBfcmVjZWl2ZWQpIHByaXZhdGUgYXRfc3RhZ2UoU3RhZ2VzLkluUHJvZ3Jlc3MpIHsKCiAgICAgICAgLy8gQ3Jvd2RzYWxlIGlzIGFjdGl2ZQogICAgICAgIHJlcXVpcmUobm93ID49IHN0YXJ0ICYmIG5vdyA8PSBjcm93ZHNhbGVFbmQpOwoKICAgICAgICAvLyBXaGl0ZWxpc3QgY2hlY2sKICAgICAgICByZXF1aXJlKGlzQWNjZXB0ZWRDb250cmlidXRvcihfc2VuZGVyKSk7CgogICAgICAgIC8vIFdoZW4gaW4gcHJlc2FsZSBwaGFzZQogICAgICAgIGJvb2wgcHJlc2FsZVBoYXNlID0gaXNJblByZXNhbGVQaGFzZSgpOwogICAgICAgIHJlcXVpcmUoIXByZXNhbGVQaGFzZSB8fCBfcmVjZWl2ZWQgPj0gbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlKTsKICAgICAgICByZXF1aXJlKCFwcmVzYWxlUGhhc2UgfHwgcmFpc2VkIDwgbWF4QW1vdW50UHJlc2FsZSk7CgogICAgICAgIC8vIFdoZW4gaW4gaWNvIHBoYXNlCiAgICAgICAgcmVxdWlyZShwcmVzYWxlUGhhc2UgfHwgX3JlY2VpdmVkID49IG1pbkFjY2VwdGVkQW1vdW50KTsKICAgICAgICByZXF1aXJlKHByZXNhbGVQaGFzZSB8fCByYWlzZWQgPj0gbWluQW1vdW50UHJlc2FsZSk7CiAgICAgICAgcmVxdWlyZShwcmVzYWxlUGhhc2UgfHwgcmFpc2VkIDwgbWF4QW1vdW50KTsKCiAgICAgICAgdWludCBhY2NlcHRlZEFtb3VudDsKICAgICAgICBpZiAocHJlc2FsZVBoYXNlICYmIHJhaXNlZCArIF9yZWNlaXZlZCA+IG1heEFtb3VudFByZXNhbGUpIHsKICAgICAgICAgICAgYWNjZXB0ZWRBbW91bnQgPSBtYXhBbW91bnRQcmVzYWxlIC0gcmFpc2VkOwogICAgICAgIH0gZWxzZSBpZiAocmFpc2VkICsgX3JlY2VpdmVkID4gbWF4QW1vdW50KSB7CiAgICAgICAgICAgIGFjY2VwdGVkQW1vdW50ID0gbWF4QW1vdW50IC0gcmFpc2VkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFjY2VwdGVkQW1vdW50ID0gX3JlY2VpdmVkOwogICAgICAgIH0KCiAgICAgICAgcmFpc2VkICs9IGFjY2VwdGVkQW1vdW50OwoKICAgICAgICBpZiAocHJlc2FsZVBoYXNlKSB7CiAgICAgICAgICAgIC8vIER1cmluZyB0aGUgcHJlc2FsZSBwaGFzZSAtIE5vbiByZWZ1bmRhYmxlCiAgICAgICAgICAgIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc0V0aChhY2NlcHRlZEFtb3VudCwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gRHVyaW5nIHRoZSBJQ08gcGhhc2UgLSAxMDAlIHJlZnVuZGFibGUKICAgICAgICAgICAgYmFsYW5jZXNbX3NlbmRlcl0gKz0gYWNjZXB0ZWRBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICAvLyBEaXN0cmlidXRlIHRva2VucwogICAgICAgIHVpbnQgdG9rZW5zVG9Jc3N1ZSA9IDA7CiAgICAgICAgdWludCBwaGFzZSA9IGdldEN1cnJlbnRQaGFzZSgpOwogICAgICAgIHZhciByYXRlID0gZ2V0UmF0ZShwaGFzZSwgYWNjZXB0ZWRBbW91bnQpOwogICAgICAgIHZhciAodm9sdW1lcywgcmVsZWFzZURhdGVzKSA9IGdldERpc3RyaWJ1dGlvbkRhdGEocGhhc2UsIGFjY2VwdGVkQW1vdW50KTsKCiAgICAgICAgLy8gQWxsb2NhdGUgdG9rZW5zCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdm9sdW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgdG9rZW5zQXRDdXJyZW50UmF0ZSA9IHRvVG9rZW5zKHZvbHVtZXNbaV0sIHJhdGUpOwogICAgICAgICAgICBpZiAocmF0ZSA+IGJhc2VSYXRlICYmIHJlbGVhc2VEYXRlc1tpXSA+IG5vdykgewogICAgICAgICAgICAgICAgdWludCBib251c1Rva2VucyA9IHRva2Vuc0F0Q3VycmVudFJhdGUgLyByYXRlICogKHJhdGUgLSBiYXNlUmF0ZSk7CiAgICAgICAgICAgICAgICBfYWxsb2NhdGVUb2tlbnMoX3NlbmRlciwgYm9udXNUb2tlbnMsIHJlbGVhc2VEYXRlc1tpXSk7CgogICAgICAgICAgICAgICAgdG9rZW5zVG9Jc3N1ZSArPSB0b2tlbnNBdEN1cnJlbnRSYXRlIC0gYm9udXNUb2tlbnM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2tlbnNUb0lzc3VlICs9IHRva2Vuc0F0Q3VycmVudFJhdGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElzc3VlIHRva2VucwogICAgICAgIGlmICh0b2tlbnNUb0lzc3VlID4gMCAmJiAhdG9rZW4uaXNzdWUoX3NlbmRlciwgdG9rZW5zVG9Jc3N1ZSkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZWZ1bmQgZHVlIHRvIG1heCBjYXAgaGl0CiAgICAgICAgaWYgKF9yZWNlaXZlZCAtIGFjY2VwdGVkQW1vdW50ID4gMCAmJiAhX3NlbmRlci5zZW5kKF9yZWNlaXZlZCAtIGFjY2VwdGVkQW1vdW50KSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsb2NhdGUgRVRICiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0byBhbG9jYXRlIHRoZSBldGggZm9yCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIEVUSCB0byBhbGxvY2F0ZQogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgZXRoIGNhbiBiZSB3aXRoZHJhd24KICAgICAqLwogICAgZnVuY3Rpb24gX2FsbG9jYXRlRXRoKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBwcml2YXRlIHsKICAgICAgICBpZiAoaGFzQmFsYW5jZShfYmVuZWZpY2lhcnksIF9yZWxlYXNlRGF0ZSkpIHsKICAgICAgICAgICAgYWxsb2NhdGVkW19iZW5lZmljaWFyeV1bX3JlbGVhc2VEYXRlXS5ldGggKz0gX2Ftb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvY2F0ZWRbX2JlbmVmaWNpYXJ5XVtfcmVsZWFzZURhdGVdID0gQmFsYW5jZSgKICAgICAgICAgICAgICAgIF9hbW91bnQsIDAsIGFsbG9jYXRlZEluZGV4W19iZW5lZmljaWFyeV0ucHVzaChfcmVsZWFzZURhdGUpIC0gMSk7CiAgICAgICAgfQoKICAgICAgICBhbGxvY2F0ZWRFdGggKz0gX2Ftb3VudDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvY2F0ZSBUb2tlbnMKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRvIGFsbG9jYXRlIHRoZSB0b2tlbnMgZm9yCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBhbGxvY2F0ZQogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgdG9rZW5zIGNhbiBiZSB3aXRoZHJhd24KICAgICAqLwogICAgZnVuY3Rpb24gX2FsbG9jYXRlVG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBwcml2YXRlIHsKICAgICAgICBpZiAoaGFzQmFsYW5jZShfYmVuZWZpY2lhcnksIF9yZWxlYXNlRGF0ZSkpIHsKICAgICAgICAgICAgYWxsb2NhdGVkW19iZW5lZmljaWFyeV1bX3JlbGVhc2VEYXRlXS50b2tlbnMgKz0gX2Ftb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvY2F0ZWRbX2JlbmVmaWNpYXJ5XVtfcmVsZWFzZURhdGVdID0gQmFsYW5jZSgKICAgICAgICAgICAgICAgIDAsIF9hbW91bnQsIGFsbG9jYXRlZEluZGV4W19iZW5lZmljaWFyeV0ucHVzaChfcmVsZWFzZURhdGUpIC0gMSk7CiAgICAgICAgfQoKICAgICAgICBhbGxvY2F0ZWRUb2tlbnMgKz0gX2Ftb3VudDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvY2F0ZSBFVEggZm9yIHN0YWtlaG9sZGVycwogICAgICoKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgRVRIIHRvIGFsbG9jYXRlCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSBldGggY2FuIGJlIHdpdGhkcmF3bgogICAgICovCiAgICBmdW5jdGlvbiBfYWxsb2NhdGVTdGFrZWhvbGRlcnNFdGgodWludCBfYW1vdW50LCB1aW50IF9yZWxlYXNlRGF0ZSkgcHJpdmF0ZSB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFBlcmNlbnRhZ2Ugc3RvcmFnZSBwID0gc3Rha2Vob2xkZXJQZXJjZW50YWdlc1tzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXhbaV1dOwogICAgICAgICAgICBpZiAocC5ldGggPiAwKSB7CiAgICAgICAgICAgICAgICBfYWxsb2NhdGVFdGgoc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4W2ldLCBfYW1vdW50ICogcC5ldGggLyBwZXJjZW50YWdlRGVub21pbmF0b3IsIF9yZWxlYXNlRGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsb2NhdGUgVG9rZW5zIGZvciBzdGFrZWhvbGRlcnMKICAgICAqCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyBjcmVhdGVkCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSB0b2tlbnMgY2FuIGJlIHdpdGhkcmF3biAodW5sZXNzIG92ZXJ3aXR0ZW4pCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc1Rva2Vucyh1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBwcml2YXRlIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXgubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgUGVyY2VudGFnZSBzdG9yYWdlIHAgPSBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzW3N0YWtlaG9sZGVyUGVyY2VudGFnZXNJbmRleFtpXV07CiAgICAgICAgICAgIGlmIChwLnRva2VucyA+IDApIHsKICAgICAgICAgICAgICAgIF9hbGxvY2F0ZVRva2VucygKICAgICAgICAgICAgICAgICAgICBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXhbaV0sCiAgICAgICAgICAgICAgICAgICAgX2Ftb3VudCAqIHAudG9rZW5zIC8gcGVyY2VudGFnZURlbm9taW5hdG9yLAogICAgICAgICAgICAgICAgICAgIHAub3ZlcndyaXRlUmVsZWFzZURhdGUgPyBwLmZpeGVkUmVsZWFzZURhdGUgOiBfcmVsZWFzZURhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHNcc291cmNlXE5VQ3Jvd2RzYWxlLnNvbAoKLyoqCiAqIEB0aXRsZSBOVUNyb3dkc2FsZQogKgogKiBOZXR3b3JrIFVuaXRzIChOVSkgaXMgYSBkZWNlbnRyYWxpc2VkIHdvcmxkd2lkZSBjb2xsYWJvcmF0aW9uIG9mIGNvbXB1dGluZyBwb3dlcgogKgogKiBCeSBhbGxvd2luZyBnYW1lcnMgYW5kIHNlcnZpY2UgcHJvdmlkZXJzIHRvIHBhcnRpY2lwYXRlIGluIG91ciB1bmlxdWUgbWluaW5nCiAqIHByb2Nlc3MsIHdlIHdpbGwgY3JlYXRlIGFuIHVsdHJhLWZhc3QsIGJsb2NrY2hhaW4gY29udHJvbGxlZCBtdWx0aXBsYXllciBpbmZyYXN0cnVjdHVyZQogKiByZW50YWJsZSBieSBkZXZlbG9wZXJzCiAqCiAqIFZpc2l0IGh0dHBzOi8vbmV0d29ya3VuaXRzLmlvLwogKgogKiAjY3JlYXRlZCAyMi8xMC8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBOVUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIElUb2tlblJldHJlaXZlciwgSVdpbmdzQWRhcHRlciB7CgoKICAgIC8qKgogICAgICogU2V0dXAgdGhlIGNyb3dkc2FsZQogICAgICoKICAgICAqIEBwYXJhbSBfc3RhcnQgVGhlIHRpbWVzdGFtcCBvZiB0aGUgc3RhcnQgZGF0ZQogICAgICogQHBhcmFtIF90b2tlbiBUaGUgdG9rZW4gdGhhdCBpcyBzb2xkCiAgICAgKiBAcGFyYW0gX3Rva2VuRGVub21pbmF0b3IgVGhlIHRva2VuIGFtb3VudCBvZiBkZWNpbWFscyB0aGF0IHRoZSB0b2tlbiB1c2VzCiAgICAgKiBAcGFyYW0gX3BlcmNlbnRhZ2VEZW5vbWluYXRvciBUaGUgcHJlY2lzaW9uIG9mIHBlcmNlbnRhZ2VzCiAgICAgKiBAcGFyYW0gX21pbkFtb3VudCBUaGUgbWluIGNhcCBmb3IgdGhlIElDTwogICAgICogQHBhcmFtIF9tYXhBbW91bnQgVGhlIG1heCBjYXAgZm9yIHRoZSBJQ08KICAgICAqIEBwYXJhbSBfbWluQWNjZXB0ZWRBbW91bnQgVGhlIGxvd2VzdCBhY2NlcHRlZCBhbW91bnQgZHVyaW5nIHRoZSBJQ08gcGhhc2UKICAgICAqIEBwYXJhbSBfbWluQW1vdW50UHJlc2FsZSBUaGUgbWluIGNhcCBmb3IgdGhlIHByZXNhbGUKICAgICAqIEBwYXJhbSBfbWF4QW1vdW50UHJlc2FsZSBUaGUgbWF4IGNhcCBmb3IgdGhlIHByZXNhbGUKICAgICAqIEBwYXJhbSBfbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlIFRoZSBsb3dlc3QgYWNjZXB0ZWQgYW1vdW50IGR1cmluZyB0aGUgcHJlc2FsZSBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBOVUNyb3dkc2FsZSh1aW50IF9zdGFydCwgYWRkcmVzcyBfdG9rZW4sIHVpbnQgX3Rva2VuRGVub21pbmF0b3IsIHVpbnQgX3BlcmNlbnRhZ2VEZW5vbWluYXRvciwgdWludCBfbWluQW1vdW50LCB1aW50IF9tYXhBbW91bnQsIHVpbnQgX21pbkFjY2VwdGVkQW1vdW50LCB1aW50IF9taW5BbW91bnRQcmVzYWxlLCB1aW50IF9tYXhBbW91bnRQcmVzYWxlLCB1aW50IF9taW5BY2NlcHRlZEFtb3VudFByZXNhbGUpCiAgICAgICAgQ3Jvd2RzYWxlKF9zdGFydCwgX3Rva2VuLCBfdG9rZW5EZW5vbWluYXRvciwgX3BlcmNlbnRhZ2VEZW5vbWluYXRvciwgX21pbkFtb3VudCwgX21heEFtb3VudCwgX21pbkFjY2VwdGVkQW1vdW50LCBfbWluQW1vdW50UHJlc2FsZSwgX21heEFtb3VudFByZXNhbGUsIF9taW5BY2NlcHRlZEFtb3VudFByZXNhbGUpCiAgICAgICAgewogICAgfQoKCiAgICAvKioKICAgICAqIFdpbmdzIGludGVncmF0aW9uIC0gR2V0IHRoZSB0b3RhbCByYWlzZWQgYW1vdW50IG9mIEV0aGVyCiAgICAgKgogICAgICogQ2FuIG9ubHkgaW5jcmVhc2VkLCBtZWFucyBpZiB5b3Ugd2l0aGRyYXcgRVRIIGZyb20gdGhlIHdhbGxldCwgc2hvdWxkIGJlIG5vdCBtb2RpZmllZCAoeW91IGNhbiB1c2UgdHdvIGZpZWxkcwogICAgICogdG8ga2VlcCBvbmUgd2l0aCBhIHRvdGFsIGFjY3VtdWxhdGVkIGFtb3VudCkgYW1vdW50IG9mIEVUSCBpbiBjb250cmFjdCBhbmQgdG90YWxDb2xsZWN0ZWQgZm9yIHRvdGFsIGFtb3VudCBvZiBFVEggY29sbGVjdGVkCiAgICAgKgogICAgICogQHJldHVybiBUb3RhbCByYWlzZWQgRXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQ29sbGVjdGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcmFpc2VkOwogICAgfQoKCiAgICAvKioKICAgICAqIEFsbG93cyB0aGUgaW1wbGVtZW50aW5nIGNvbnRyYWN0IHRvIHZhbGlkYXRlIGEKICAgICAqIGNvbnRyaWJ1dGluZyBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF9jb250cmlidXRvciBBZGRyZXNzIHRoYXQgaXMgYmVpbmcgdmFsaWRhdGVkCiAgICAgKiBAcmV0dXJuIFdoZXRlciB0aGUgY29udHJpYnV0b3IgaXMgYWNjZXB0ZWQgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzQWNjZXB0ZWRDb250cmlidXRvcihhZGRyZXNzIF9jb250cmlidXRvcikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBfY29udHJpYnV0b3IgIT0gYWRkcmVzcygweDApOwogICAgfQoKCiAgICAvKioKICAgICAqIEZhaWxzYWZlIG1lY2hhbmlzbQogICAgICoKICAgICAqIEFsbG93cyBiZW5lZmljYXJ5IHRvIHJldHJlaXZlIHRva2VucyBmcm9tIHRoZSBjb250cmFjdAogICAgICoKICAgICAqIEBwYXJhbSBfdG9rZW5Db250cmFjdCBUaGUgYWRkcmVzcyBvZiBFUkMyMCBjb21wYXRpYmxlIHRva2VuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJldHJlaXZlVG9rZW5zKGFkZHJlc3MgX3Rva2VuQ29udHJhY3QpIHB1YmxpYyBvbmx5X2JlbmVmaWNpYXJ5IHsKICAgICAgICBJVG9rZW4gdG9rZW5JbnN0YW5jZSA9IElUb2tlbihfdG9rZW5Db250cmFjdCk7CgogICAgICAgIC8vIFJldHJlaXZlIHRva2VucyBmcm9tIG91ciB0b2tlbiBjb250cmFjdAogICAgICAgIElUb2tlblJldHJlaXZlcih0b2tlbikucmV0cmVpdmVUb2tlbnMoX3Rva2VuQ29udHJhY3QpOwoKICAgICAgICAvLyBSZXRyZWl2ZSB0b2tlbnMgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAgICAgICB1aW50IHRva2VuQmFsYW5jZSA9IHRva2VuSW5zdGFuY2UuYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGlmICh0b2tlbkJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIHRva2VuSW5zdGFuY2UudHJhbnNmZXIoYmVuZWZpY2lhcnksIHRva2VuQmFsYW5jZSk7CiAgICAgICAgfQogICAgfQp9'.
	

]
