Class {
	#name : #SRTf32d328af90d5ac22b1bbeda4114fd15b2fa09ee,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf32d328af90d5ac22b1bbeda4114fd15b2fa09ee >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvb3duZXJzaGlwL093bmFibGUuc29sCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvQWRkcmVzc1doaXRlbGlzdC5zb2wKCi8vIEEgc2ltcGxlIGNvbnRyYWN0IHRoYXQgc3RvcmVzIGEgd2hpdGVsaXN0IG9mIGFkZHJlc3Nlcywgd2hpY2ggdGhlIG93bmVyIG1heSB1cGRhdGUKY29udHJhY3QgQWRkcmVzc1doaXRlbGlzdCBpcyBPd25hYmxlIHsKICAgIC8vIHRoZSBhZGRyZXNzZXMgdGhhdCBhcmUgaW5jbHVkZWQgaW4gdGhlIHdoaXRlbGlzdAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0ZWQ7CgogICAgZnVuY3Rpb24gQWRkcmVzc1doaXRlbGlzdCgpIHB1YmxpYyB7CiAgICB9CgogICAgZnVuY3Rpb24gaXNXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIpIHZpZXcgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2hpdGVsaXN0ZWRbYWRkcl07CiAgICB9CgogICAgZXZlbnQgTG9nV2hpdGVsaXN0QWRkKGFkZHJlc3MgaW5kZXhlZCBhZGRyKTsKCiAgICAvLyBhZGQgdGhlc2UgYWRkcmVzc2VzIHRvIHRoZSB3aGl0ZWxpc3QKICAgIGZ1bmN0aW9uIGFkZFRvV2hpdGVsaXN0KGFkZHJlc3NbXSBhZGRyZXNzZXMpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIXdoaXRlbGlzdGVkW2FkZHJlc3Nlc1tpXV0pIHsKICAgICAgICAgICAgICAgIHdoaXRlbGlzdGVkW2FkZHJlc3Nlc1tpXV0gPSB0cnVlOwogICAgICAgICAgICAgICAgTG9nV2hpdGVsaXN0QWRkKGFkZHJlc3Nlc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGV2ZW50IExvZ1doaXRlbGlzdFJlbW92ZShhZGRyZXNzIGluZGV4ZWQgYWRkcik7CgogICAgLy8gcmVtb3ZlIHRoZXNlIGFkZHJlc3NlcyBmcm9tIHRoZSB3aGl0ZWxpc3QKICAgIGZ1bmN0aW9uIHJlbW92ZUZyb21XaGl0ZWxpc3QoYWRkcmVzc1tdIGFkZHJlc3NlcykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh3aGl0ZWxpc3RlZFthZGRyZXNzZXNbaV1dKSB7CiAgICAgICAgICAgICAgICB3aGl0ZWxpc3RlZFthZGRyZXNzZXNbaV1dID0gZmFsc2U7CiAgICAgICAgICAgICAgICBMb2dXaGl0ZWxpc3RSZW1vdmUoYWRkcmVzc2VzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9Lbm93c1RpbWUuc29sCgpjb250cmFjdCBLbm93c1RpbWUgewogICAgZnVuY3Rpb24gS25vd3NUaW1lKCkgcHVibGljIHsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyZW50VGltZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQp9CgovLyBGaWxlOiB6ZXBwZWxpbi1zb2xpZGl0eS9jb250cmFjdHMvbWF0aC9TYWZlTWF0aC5zb2wKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9CbnR5RXhjaGFuZ2VSYXRlQ2FsY3VsYXRvci5zb2wKCi8vIFRoaXMgY29udHJhY3QgZG9lcyB0aGUgbWF0aCB0byBmaWd1cmUgb3V0IHRoZSBCTlRZIHBhaWQgcGVyIFdFSSwgYmFzZWQgb24gdGhlIFVTRCBldGhlciBwcmljZQpjb250cmFjdCBCbnR5RXhjaGFuZ2VSYXRlQ2FsY3VsYXRvciBpcyBLbm93c1RpbWUsIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgV0VJX1BFUl9FVEggPSAxMCAqKiAxODsKCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNSUNST0RPTExBUlNfUEVSX0RPTExBUiA9IDEwICoqIDY7CgogICAgdWludCBwdWJsaWMgYm50eU1pY3JvZG9sbGFyUHJpY2U7CgogICAgdWludCBwdWJsaWMgVVNERXRoZXJQcmljZTsKCiAgICB1aW50IHB1YmxpYyBmaXhVU0RQcmljZVRpbWU7CgogICAgLy8gYSBtaWNyb2RvbGxhciBpcyBvbmUgbWlsbGlvbnRoIG9mIGEgZG9sbGFyLCBvciBvbmUgdGVuLXRob3VzYW5kdGggb2YgYSBjZW50CiAgICBmdW5jdGlvbiBCbnR5RXhjaGFuZ2VSYXRlQ2FsY3VsYXRvcih1aW50IF9ibnR5TWljcm9kb2xsYXJQcmljZSwgdWludCBfVVNERXRoZXJQcmljZSwgdWludCBfZml4VVNEUHJpY2VUaW1lKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoX2JudHlNaWNyb2RvbGxhclByaWNlID4gMCk7CiAgICAgICAgcmVxdWlyZShfVVNERXRoZXJQcmljZSA+IDApOwoKICAgICAgICBibnR5TWljcm9kb2xsYXJQcmljZSA9IF9ibnR5TWljcm9kb2xsYXJQcmljZTsKICAgICAgICBmaXhVU0RQcmljZVRpbWUgPSBfZml4VVNEUHJpY2VUaW1lOwogICAgICAgIFVTREV0aGVyUHJpY2UgPSBfVVNERXRoZXJQcmljZTsKICAgIH0KCiAgICAvLyB0aGUgb3duZXIgY2FuIGNoYW5nZSB0aGUgdXNkIGV0aGVyIHByaWNlCiAgICBmdW5jdGlvbiBzZXRVU0RFdGhlclByaWNlKHVpbnQgX1VTREV0aGVyUHJpY2UpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY3VycmVudFRpbWUoKSA8IGZpeFVTRFByaWNlVGltZSk7CiAgICAgICAgcmVxdWlyZShfVVNERXRoZXJQcmljZSA+IDApOwoKICAgICAgICBVU0RFdGhlclByaWNlID0gX1VTREV0aGVyUHJpY2U7CiAgICB9CgogICAgLy8gcmV0dXJucyB0aGUgbnVtYmVyIG9mIHdlaSBzb21lIGFtb3VudCBvZiB1c2QKICAgIGZ1bmN0aW9uIHVzZFRvV2VpKHVpbnQgdXNkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIFdFSV9QRVJfRVRILm11bCh1c2QpLmRpdihVU0RFdGhlclByaWNlKTsKICAgIH0KCiAgICAvLyByZXR1cm5zIHRoZSBudW1iZXIgb2YgYm50eSBwZXIgc29tZSBhbW91bnQgaW4gd2VpCiAgICBmdW5jdGlvbiB3ZWlUb0JudHkodWludCBhbXRXZWkpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gVVNERXRoZXJQcmljZS5tdWwoTUlDUk9ET0xMQVJTX1BFUl9ET0xMQVIpLm11bChhbXRXZWkpLmRpdihibnR5TWljcm9kb2xsYXJQcmljZSk7CiAgICB9Cn0KCi8vIEZpbGU6IG1pbmltZXRva2VuL2NvbnRyYWN0cy9Db250cm9sbGVkLnNvbAoKY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwKICAgIC8vLyAgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xsZXIpOyBfOyB9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgcHVibGljIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCi8vIEZpbGU6IG1pbmltZXRva2VuL2NvbnRyYWN0cy9Ub2tlbkNvbnRyb2xsZXIuc29sCgovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMKY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsKICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2VucwogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cwogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljCiAgICAgICAgcmV0dXJucyhib29sKTsKfQoKLy8gRmlsZTogbWluaW1ldG9rZW4vY29udHJhY3RzL01pbmlNZVRva2VuLnNvbAoKLyoKICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIE1pbmlNZVRva2VuIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEpvcmRpIEJheWxpbmEKLy8vIEBkZXYgVGhpcyB0b2tlbiBjb250cmFjdCdzIGdvYWwgaXMgdG8gbWFrZSBpdCBlYXN5IGZvciBhbnlvbmUgdG8gY2xvbmUgdGhpcwovLy8gIHRva2VuIHVzaW5nIHRoZSB0b2tlbiBkaXN0cmlidXRpb24gYXQgYSBnaXZlbiBibG9jaywgdGhpcyB3aWxsIGFsbG93IERBTydzCi8vLyAgYW5kIERBcHBzIHRvIHVwZ3JhZGUgdGhlaXIgZmVhdHVyZXMgaW4gYSBkZWNlbnRyYWxpemVkIG1hbm5lciB3aXRob3V0Ci8vLyAgYWZmZWN0aW5nIHRoZSBvcmlnaW5hbCB0b2tlbgovLy8gQGRldiBJdCBpcyBFUkMyMCBjb21wbGlhbnQsIGJ1dCBzdGlsbCBuZWVkcyB0byB1bmRlciBnbyBmdXJ0aGVyIHRlc3RpbmcuCgoKCgpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrIHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIGZyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKSBwdWJsaWM7Cn0KCi8vLyBAZGV2IFRoZSBhY3R1YWwgdG9rZW4gY29udHJhY3QsIHRoZSBkZWZhdWx0IGNvbnRyb2xsZXIgaXMgdGhlIG1zZy5zZW5kZXIKLy8vICB0aGF0IGRlcGxveXMgdGhlIGNvbnRyYWN0LCBzbyB1c3VhbGx5IHRoaXMgdG9rZW4gd2lsbCBiZSBkZXBsb3llZCBieSBhCi8vLyAgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCwgd2hpY2ggR2l2ZXRoIHdpbGwgY2FsbCBhICJDYW1wYWlnbiIKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgQ29udHJvbGxlZCB7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4yJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKCgogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewoKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwoKICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyCiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgovLy8vLy8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgcHVibGljIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0CiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudAogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLAoKICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQogICAgICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfYW1vdW50KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQoKICAgICAgICAgICByZXF1aXJlKHBhcmVudFNuYXBTaG90QmxvY2sgPCBibG9jay5udW1iZXIpOwoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICByZXF1aXJlKChfdG8gIT0gMCkgJiYgKF90byAhPSBhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSk7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKTsKCiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBfYW1vdW50LAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfZXh0cmFEYXRhCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKSBwdWJsaWMgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlRnJvbSA+PSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEVuYWJsZXMgdG9rZW4gaG9sZGVycyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZnJlZWx5IGlmIHRydWUKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgfQoKLy8vLy8vLy8vLwovLyBTYWZldHkgTWV0aG9kcwovLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvQm91bnR5MHhUb2tlbi5zb2wKCmNvbnRyYWN0IEJvdW50eTB4VG9rZW4gaXMgTWluaU1lVG9rZW4gewogICAgZnVuY3Rpb24gQm91bnR5MHhUb2tlbihhZGRyZXNzIF90b2tlbkZhY3RvcnkpCiAgICAgICAgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIF90b2tlbkZhY3RvcnksCiAgICAgICAgICAgIDB4MCwgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgICAgICAgICAgMCwgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgICAgICAgICAiQm91bnR5MHggVG9rZW4iLCAgICAgICAgICAgLy8gVG9rZW4gbmFtZQogICAgICAgICAgICAxOCAgICwgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMKICAgICAgICAgICAgIkJOVFkiLCAgICAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbAogICAgICAgICAgICBmYWxzZSAgICAgICAgICAgICAgICAgICAgICAgLy8gRGlzYWJsZSB0cmFuc2ZlcnMKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICB9CgogICAgLy8gZ2VuZXJhdGUgdG9rZW5zIGZvciBtYW55IGFkZHJlc3NlcyB3aXRoIGEgc2luZ2xlIHRyYW5zYWN0aW9uCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2Vuc0FsbChhZGRyZXNzW10gX293bmVycywgdWludFtdIF9hbW91bnRzKSBvbmx5Q29udHJvbGxlciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX293bmVycy5sZW5ndGggPT0gX2Ftb3VudHMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKGdlbmVyYXRlVG9rZW5zKF9vd25lcnNbaV0sIF9hbW91bnRzW2ldKSk7CiAgICAgICAgfQogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvS25vd3NDb25zdGFudHMuc29sCgovLyBUaGVzZSBhcmUgdGhlIHNwZWNpZmljYXRpb25zIG9mIHRoZSBjb250cmFjdCwgdW5saWtlbHkgdG8gY2hhbmdlCmNvbnRyYWN0IEtub3dzQ29uc3RhbnRzIHsKICAgIC8vIFRoZSBmaXhlZCBVU0QgcHJpY2UgcGVyIEJOVFkKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IEZJWEVEX1BSRVNBTEVfVVNEX0VUSEVSX1BSSUNFID0gMzU1OwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUlDUk9fRE9MTEFSU19QRVJfQk5UWV9NQUlOU0FMRSA9IDE2NTAwOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUlDUk9fRE9MTEFSU19QRVJfQk5UWV9QUkVTQUxFID0gMTMyMDA7CgogICAgLy8gQ29udHJpYnV0aW9uIGNvbnN0YW50cwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgSEFSRF9DQVBfVVNEID0gMTUwMDAwMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbiBVU0QgdGhlIG1heGltdW0gdG90YWwgY29sbGVjdGVkIGFtb3VudAogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYSU1VTV9DT05UUklCVVRJT05fV0hJVEVMSVNUX1BFUklPRF9VU0QgPSAxNTAwOyAvLyBpbiBVU0QgdGhlIG1heGltdW0gY29udHJpYnV0aW9uIGFtb3VudCBkdXJpbmcgdGhlIHdoaXRlbGlzdCBwZXJpb2QKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWElNVU1fQ09OVFJJQlVUSU9OX0xJTUlURURfUEVSSU9EX1VTRCA9IDEwMDAwOyAgLy8gaW4gVVNEIHRoZSBtYXhpbXVtIGNvbnRyaWJ1dGlvbiBhbW91bnQgYWZ0ZXIgdGhlIHdoaXRlbGlzdCBwZXJpb2QgZW5kcwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUFYX0dBU19QUklDRSA9IDcwICogKDEwICoqIDkpOyAgICAgICAgICAgICAgICAgICAvLyBNYXggZ2FzIHByaWNlIG9mIDcwIGd3ZWkKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9HQVMgPSA1MDAwMDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWF4IGdhcyB0aGF0IGNhbiBiZSBzZW50IHdpdGggdHgKCiAgICAvLyBUaW1lIGNvbnN0YW50cwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgU0FMRV9TVEFSVF9EQVRFID0gMTUxMzM0NjQwMDsgICAgICAgICAgICAgICAgICAgIC8vIGluIHVuaXggdGltZXN0YW1wIERlYyAxNXRoIEAgMTU6MDAgQ0VUCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBXSElURUxJU1RfRU5EX0RBVEUgPSBTQUxFX1NUQVJUX0RBVEUgKyAyNCBob3VyczsgLy8gRW5kIHdoaXRlbGlzdCAyNCBob3VycyBhZnRlciBzYWxlIHN0YXJ0IGRhdGUvdGltZQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTElNSVRTX0VORF9EQVRFID0gU0FMRV9TVEFSVF9EQVRFICsgNDggaG91cnM7ICAgIC8vIEVuZCBhbGwgbGltaXRzIDQ4IGhvdXJzIGFmdGVyIHRoZSBzYWxlIHN0YXJ0IGRhdGUKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFNBTEVfRU5EX0RBVEUgPSBTQUxFX1NUQVJUX0RBVEUgKyA0IHdlZWtzOyAgICAgICAvLyBlbmQgc2FsZSBpbiBmb3VyIHdlZWtzCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBVTkZSRUVaRV9EQVRFID0gU0FMRV9TVEFSVF9EQVRFICsgNzYgd2Vla3M7ICAgICAgLy8gQm91bnR5MHggUmVzZXJ2ZSBsb2NrZWQgZm9yIDE4IG1vbnRocwoKICAgIGZ1bmN0aW9uIEtub3dzQ29uc3RhbnRzKCkgcHVibGljIHt9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9pbnRlcmZhY2VzL0JvdW50eTB4UHJlc2FsZUkuc29sCgovKioKICogVGhpcyBpbnRlcmZhY2UgZGVzY3JpYmVzIHRoZSBvbmx5IGZ1bmN0aW9uIHdlIHdpbGwgYmUgY2FsbGluZyBmcm9tIHRoZSBCb3VudHkweFByZXNhbGVJIGNvbnRyYWN0CiAqLwppbnRlcmZhY2UgQm91bnR5MHhQcmVzYWxlSSB7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlKTsKfQoKLy8gRmlsZTogemVwcGVsaW4tc29saWRpdHkvY29udHJhY3RzL21hdGgvTWF0aC5zb2wKCi8qKgogKiBAdGl0bGUgTWF0aAogKiBAZGV2IEFzc29ydGVkIG1hdGggb3BlcmF0aW9ucwogKi8KCmxpYnJhcnkgTWF0aCB7CiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0JvdW50eTB4UHJlc2FsZURpc3RyaWJ1dG9yLnNvbAoKLyoKVGhpcyBjb250cmFjdCBtYW5hZ2VzIGNvbXBlbnNhdGlvbiBvZiB0aGUgcHJlc2FsZSBpbnZlc3RvcnMsIGJhc2VkIG9uIHRoZSBjb250cmlidXRpb24gYmFsYW5jZXMgcmVjb3JkZWQgaW4gdGhlIHByZXNhbGUKY29udHJhY3QuCiovCmNvbnRyYWN0IEJvdW50eTB4UHJlc2FsZURpc3RyaWJ1dG9yIGlzIEtub3dzQ29uc3RhbnRzLCBCbnR5RXhjaGFuZ2VSYXRlQ2FsY3VsYXRvciB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBCb3VudHkweFByZXNhbGVJIHB1YmxpYyBkZXBsb3llZFByZXNhbGVDb250cmFjdDsKICAgIEJvdW50eTB4VG9rZW4gcHVibGljIGJvdW50eTB4VG9rZW47CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB0b2tlbnNQYWlkOwoKICAgIGZ1bmN0aW9uIEJvdW50eTB4UHJlc2FsZURpc3RyaWJ1dG9yKEJvdW50eTB4VG9rZW4gX2JvdW50eTB4VG9rZW4sIEJvdW50eTB4UHJlc2FsZUkgX2RlcGxveWVkUHJlc2FsZUNvbnRyYWN0KQogICAgICAgIEJudHlFeGNoYW5nZVJhdGVDYWxjdWxhdG9yKE1JQ1JPX0RPTExBUlNfUEVSX0JOVFlfUFJFU0FMRSwgRklYRURfUFJFU0FMRV9VU0RfRVRIRVJfUFJJQ0UsIDApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgYm91bnR5MHhUb2tlbiA9IF9ib3VudHkweFRva2VuOwogICAgICAgIGRlcGxveWVkUHJlc2FsZUNvbnRyYWN0ID0gX2RlcGxveWVkUHJlc2FsZUNvbnRyYWN0OwogICAgfQoKICAgIGV2ZW50IE9uUHJlU2FsZUJ1eWVyQ29tcGVuc2F0ZWQoYWRkcmVzcyBpbmRleGVkIGNvbnRyaWJ1dG9yLCB1aW50IG51bVRva2Vucyk7CgogICAgLyoqCiAgICAgKiBDb21wZW5zYXRlIHRoZSBwcmVzYWxlIGludmVzdG9ycyBhdCB0aGUgYWRkcmVzc2VzIHByb3ZpZGVyIGJhc2VkIG9uIHRoZWlyIGNvbnRyaWJ1dGlvbnMgZHVyaW5nIHRoZSBwcmVzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbXBlbnNhdGVQcmVTYWxlSW52ZXN0b3JzKGFkZHJlc3NbXSBwcmVTYWxlSW52ZXN0b3JzKSBwdWJsaWMgewogICAgICAgIC8vIGl0ZXJhdGUgdGhyb3VnaCBlYWNoIGludmVzdG9yCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcHJlU2FsZUludmVzdG9ycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGludmVzdG9yQWRkcmVzcyA9IHByZVNhbGVJbnZlc3RvcnNbaV07CgogICAgICAgICAgICAvLyB0aGUgZGVwbG95ZWQgcHJlc2FsZSBjb250cmFjdCB0cmFja2VkIHRoZSBiYWxhbmNlIG9mIGVhY2ggY29udHJpYnV0b3IKICAgICAgICAgICAgdWludCB3ZWlDb250cmlidXRlZCA9IGRlcGxveWVkUHJlc2FsZUNvbnRyYWN0LmJhbGFuY2VPZihpbnZlc3RvckFkZHJlc3MpOwoKICAgICAgICAgICAgLy8gdGhleSBjb250cmlidXRlZCBhbmQgaGF2ZW4ndCBiZWVuIHBhaWQKICAgICAgICAgICAgaWYgKHdlaUNvbnRyaWJ1dGVkID4gMCAmJiB0b2tlbnNQYWlkW2ludmVzdG9yQWRkcmVzc10gPT0gMCkgewogICAgICAgICAgICAgICAgLy8gY29udmVydCB0aGUgYW1vdW50IG9mIHdlaSB0aGV5IGNvbnRyaWJ1dGVkIHRvIHRoZSBibnR5CiAgICAgICAgICAgICAgICB1aW50IGJudHlDb21wZW5zYXRpb24gPSBNYXRoLm1pbjI1Nih3ZWlUb0JudHkod2VpQ29udHJpYnV0ZWQpLCBib3VudHkweFRva2VuLmJhbGFuY2VPZih0aGlzKSk7CgogICAgICAgICAgICAgICAgLy8gbWFyayB0aGVtIHBhaWQgZmlyc3QKICAgICAgICAgICAgICAgIHRva2Vuc1BhaWRbaW52ZXN0b3JBZGRyZXNzXSA9IGJudHlDb21wZW5zYXRpb247CgogICAgICAgICAgICAgICAgLy8gdHJhbnNmZXIgdG9rZW5zIHRvIHByZXNhbGUgY29udHJpYnV0b3IgYWRkcmVzcwogICAgICAgICAgICAgICAgcmVxdWlyZShib3VudHkweFRva2VuLnRyYW5zZmVyKGludmVzdG9yQWRkcmVzcywgYm50eUNvbXBlbnNhdGlvbikpOwoKICAgICAgICAgICAgICAgIC8vIGxvZyB0aGUgZXZlbnQKICAgICAgICAgICAgICAgIE9uUHJlU2FsZUJ1eWVyQ29tcGVuc2F0ZWQoaW52ZXN0b3JBZGRyZXNzLCBibnR5Q29tcGVuc2F0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0JvdW50eTB4UmVzZXJ2ZUhvbGRlci5zb2wKCi8qKgogKiBAdGl0bGUgQm91bnR5MHhSZXNlcnZlSG9sZGVyCiAqIEBkZXYgQm91bnR5MHhSZXNlcnZlSG9sZGVyIGlzIGEgdG9rZW4gaG9sZGVyIGNvbnRyYWN0IHRoYXQgd2lsbCBhbGxvdyBhCiAqIGJlbmVmaWNpYXJ5IHRvIGV4dHJhY3QgdGhlIHRva2VucyBhZnRlciBhIGdpdmVuIHJlbGVhc2UgdGltZQogKi8KY29udHJhY3QgQm91bnR5MHhSZXNlcnZlSG9sZGVyIGlzIEtub3dzQ29uc3RhbnRzLCBLbm93c1RpbWUgewogICAgLy8gQm91bnR5MHhUb2tlbiBhZGRyZXNzCiAgICBCb3VudHkweFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICAvLyBiZW5lZmljaWFyeSBvZiB0b2tlbnMgYWZ0ZXIgdGhleSBhcmUgcmVsZWFzZWQKICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OwoKICAgIGZ1bmN0aW9uIEJvdW50eTB4UmVzZXJ2ZUhvbGRlcihCb3VudHkweFRva2VuIF90b2tlbiwgYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBUcmFuc2ZlcnMgdG9rZW5zIGhlbGQgYnkgdGltZWxvY2sgdG8gYmVuZWZpY2lhcnkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY3VycmVudFRpbWUoKSA+PSBVTkZSRUVaRV9EQVRFKTsKCiAgICAgICAgdWludCBhbW91bnQgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgcmVxdWlyZShhbW91bnQgPiAwKTsKCiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihiZW5lZmljaWFyeSwgYW1vdW50KSk7CiAgICB9Cn0KCi8vIEZpbGU6IHplcHBlbGluLXNvbGlkaXR5L2NvbnRyYWN0cy9saWZlY3ljbGUvUGF1c2FibGUuc29sCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9Cb3VudHkweENyb3dkc2FsZS5zb2wKCmNvbnRyYWN0IEJvdW50eTB4Q3Jvd2RzYWxlIGlzIEtub3dzVGltZSwgS25vd3NDb25zdGFudHMsIE93bmFibGUsIEJudHlFeGNoYW5nZVJhdGVDYWxjdWxhdG9yLCBBZGRyZXNzV2hpdGVsaXN0LCBQYXVzYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICAvLyBDcm93ZHNhbGUgY29udHJhY3RzCiAgICBCb3VudHkweFRva2VuIHB1YmxpYyBib3VudHkweFRva2VuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJld2FyZCB0b2tlbnMgdG8gY29tcGVuc2F0ZSBpbgoKICAgIC8vIENvbnRyaWJ1dGlvbiBhbW91bnRzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBjb250cmlidXRpb25BbW91bnRzOyAgICAgICAgICAgIC8vIFRoZSBhbW91bnQgdGhhdCBlYWNoIGFkZHJlc3MgaGFzIGNvbnRyaWJ1dGVkCiAgICB1aW50IHB1YmxpYyB0b3RhbENvbnRyaWJ1dGlvbnM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvdGFsIGNvbnRyaWJ1dGlvbnMgZ2l2ZW4KCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IE9uQ29udHJpYnV0aW9uKGFkZHJlc3MgaW5kZXhlZCBjb250cmlidXRvciwgYm9vbCBpbmRleGVkIGR1cmluZ1doaXRlbGlzdFBlcmlvZCwgdWludCBpbmRleGVkIGNvbnRyaWJ1dGVkV2VpLCB1aW50IGJudHlBd2FyZGVkLCB1aW50IHJlZnVuZGVkV2VpKTsKICAgIGV2ZW50IE9uV2l0aGRyYXcoYWRkcmVzcyB0bywgdWludCBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIEJvdW50eTB4Q3Jvd2RzYWxlKEJvdW50eTB4VG9rZW4gX2JvdW50eTB4VG9rZW4sIHVpbnQgX1VTREV0aGVyUHJpY2UpCiAgICAgICAgQm50eUV4Y2hhbmdlUmF0ZUNhbGN1bGF0b3IoTUlDUk9fRE9MTEFSU19QRVJfQk5UWV9NQUlOU0FMRSwgX1VTREV0aGVyUHJpY2UsIFNBTEVfU1RBUlRfREFURSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBib3VudHkweFRva2VuID0gX2JvdW50eTB4VG9rZW47CiAgICB9CgogICAgLy8gdGhlIGNyb3dkc2FsZSBvd25lciBtYXkgd2l0aGRyYXcgYW55IGFtb3VudCBvZiBldGhlciBmcm9tIHRoaXMgY29udHJhY3QgYXQgYW55IHRpbWUKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgT25XaXRoZHJhdyhtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgfQoKICAgIC8vIEFsbCBjb250cmlidXRpb25zIGNvbWUgdGhyb3VnaCB0aGUgZmFsbGJhY2sgZnVuY3Rpb24KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQgdGltZSA9IGN1cnJlbnRUaW1lKCk7CgogICAgICAgIC8vIHJlcXVpcmUgdGhlIHNhbGUgaGFzIHN0YXJ0ZWQKICAgICAgICByZXF1aXJlKHRpbWUgPj0gU0FMRV9TVEFSVF9EQVRFKTsKCiAgICAgICAgLy8gcmVxdWlyZSB0aGF0IHRoZSBzYWxlIGhhcyBub3QgZW5kZWQKICAgICAgICByZXF1aXJlKHRpbWUgPCBTQUxFX0VORF9EQVRFKTsKCiAgICAgICAgLy8gbWF4aW11bSBjb250cmlidXRpb24gZnJvbSB0aGlzIHRyYW5zYWN0aW9uIGlzIHRyYWNrZWQgaW4gdGhpcyB2YXJpYWJsZQogICAgICAgIHVpbnQgbWF4aW11bUNvbnRyaWJ1dGlvbiA9IHVzZFRvV2VpKEhBUkRfQ0FQX1VTRCkuc3ViKHRvdGFsQ29udHJpYnV0aW9ucyk7CgogICAgICAgIC8vIHN0b3JlIHdoZXRoZXIgdGhlIGNvbnRyaWJ1dGlvbiBpcyBtYWRlIGR1cmluZyB0aGUgd2hpdGVsaXN0IHBlcmlvZAogICAgICAgIGJvb2wgaXNEdXJpbmdXaGl0ZWxpc3RQZXJpb2QgPSB0aW1lIDwgV0hJVEVMSVNUX0VORF9EQVRFOwoKICAgICAgICAvLyB0aGVzZSBsaW1pdHMgYXJlIG9ubHkgY2hlY2tlZCBkdXJpbmcgdGhlIGxpbWl0ZWQgcGVyaW9kCiAgICAgICAgaWYgKHRpbWUgPCBMSU1JVFNfRU5EX0RBVEUpIHsKICAgICAgICAgICAgLy8gcmVxdWlyZSB0aGF0IHRoZXkgaGF2ZSBub3Qgb3ZlcnBhaWQgdGhlaXIgZ2FzIHByaWNlCiAgICAgICAgICAgIHJlcXVpcmUodHguZ2FzcHJpY2UgPD0gTUFYX0dBU19QUklDRSk7CgogICAgICAgICAgICAvLyByZXF1aXJlIHRoYXQgdGhleSBoYXZlbid0IHNlbnQgdG9vIG11Y2ggZ2FzCiAgICAgICAgICAgIHJlcXVpcmUobXNnLmdhcyA8PSBNQVhfR0FTKTsKCiAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBpbiB0aGUgV0hJVEVMSVNUIHBlcmlvZCwgd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhlIHNlbmRlciBjb250cmlidXRlZCB0byB0aGUgcHJlc2FsZQogICAgICAgICAgICBpZiAoaXNEdXJpbmdXaGl0ZWxpc3RQZXJpb2QpIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoaXNXaGl0ZWxpc3RlZChtc2cuc2VuZGVyKSk7CgogICAgICAgICAgICAgICAgLy8gdGhlIG1heGltdW0gY29udHJpYnV0aW9uIGlzIHNldCBmb3IgdGhlIHdoaXRlbGlzdCBwZXJpb2QKICAgICAgICAgICAgICAgIG1heGltdW1Db250cmlidXRpb24gPSBNYXRoLm1pbjI1NigKICAgICAgICAgICAgICAgICAgICBtYXhpbXVtQ29udHJpYnV0aW9uLAogICAgICAgICAgICAgICAgICAgIHVzZFRvV2VpKE1BWElNVU1fQ09OVFJJQlVUSU9OX1dISVRFTElTVF9QRVJJT0RfVVNEKS5zdWIoY29udHJpYnV0aW9uQW1vdW50c1ttc2cuc2VuZGVyXSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB0aGUgbWF4aW11bSBjb250cmlidXRpb24gaXMgc2V0IGZvciB0aGUgbGltaXRlZCBwZXJpb2QKICAgICAgICAgICAgICAgIG1heGltdW1Db250cmlidXRpb24gPSBNYXRoLm1pbjI1NigKICAgICAgICAgICAgICAgICAgICBtYXhpbXVtQ29udHJpYnV0aW9uLAogICAgICAgICAgICAgICAgICAgIHVzZFRvV2VpKE1BWElNVU1fQ09OVFJJQlVUSU9OX0xJTUlURURfUEVSSU9EX1VTRCkuc3ViKGNvbnRyaWJ1dGlvbkFtb3VudHNbbXNnLnNlbmRlcl0pCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjYWxjdWxhdGUgaG93IG11Y2ggY29udHJpYnV0aW9uIGlzIGFjY2VwdGVkIGFuZCBob3cgbXVjaCBpcyByZWZ1bmRlZAogICAgICAgIHVpbnQgY29udHJpYnV0aW9uID0gTWF0aC5taW4yNTYobXNnLnZhbHVlLCBtYXhpbXVtQ29udHJpYnV0aW9uKTsKICAgICAgICB1aW50IHJlZnVuZFdlaSA9IG1zZy52YWx1ZS5zdWIoY29udHJpYnV0aW9uKTsKCiAgICAgICAgLy8gcmVxdWlyZSB0aGF0IHRoZXkgYXJlIGFsbG93ZWQgdG8gY29udHJpYnV0ZSBtb3JlCiAgICAgICAgcmVxdWlyZShjb250cmlidXRpb24gPiAwKTsKCiAgICAgICAgLy8gYWNjb3VudCBjb250cmlidXRpb24gdG93YXJkcyB0b3RhbAogICAgICAgIHRvdGFsQ29udHJpYnV0aW9ucyA9IHRvdGFsQ29udHJpYnV0aW9ucy5hZGQoY29udHJpYnV0aW9uKTsKCiAgICAgICAgLy8gYWNjb3VudCBjb250cmlidXRpb24gdG93YXJkcyBhZGRyZXNzIHRvdGFsCiAgICAgICAgY29udHJpYnV0aW9uQW1vdW50c1ttc2cuc2VuZGVyXSA9IGNvbnRyaWJ1dGlvbkFtb3VudHNbbXNnLnNlbmRlcl0uYWRkKGNvbnRyaWJ1dGlvbik7CgogICAgICAgIC8vIGFuZCBzZW5kIHRoZW0gc29tZSBibnR5CiAgICAgICAgdWludCBhbW91bnRCbnR5UmV3YXJkZWQgPSBNYXRoLm1pbjI1Nih3ZWlUb0JudHkoY29udHJpYnV0aW9uKSwgYm91bnR5MHhUb2tlbi5iYWxhbmNlT2YodGhpcykpOwogICAgICAgIHJlcXVpcmUoYm91bnR5MHhUb2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBhbW91bnRCbnR5UmV3YXJkZWQpKTsKCiAgICAgICAgaWYgKHJlZnVuZFdlaSA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihyZWZ1bmRXZWkpOwogICAgICAgIH0KCiAgICAgICAgLy8gbG9nIHRoZSBjb250cmlidXRpb24KICAgICAgICBPbkNvbnRyaWJ1dGlvbihtc2cuc2VuZGVyLCBpc0R1cmluZ1doaXRlbGlzdFBlcmlvZCwgY29udHJpYnV0aW9uLCBhbW91bnRCbnR5UmV3YXJkZWQsIHJlZnVuZFdlaSk7CiAgICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9Dcm93ZHNhbGVUb2tlbkNvbnRyb2xsZXIuc29sCgpjb250cmFjdCBDcm93ZHNhbGVUb2tlbkNvbnRyb2xsZXIgaXMgT3duYWJsZSwgQWRkcmVzc1doaXRlbGlzdCwgVG9rZW5Db250cm9sbGVyIHsKICAgIGJvb2wgcHVibGljIHdoaXRlbGlzdE9mZjsKICAgIEJvdW50eTB4VG9rZW4gcHVibGljIHRva2VuOwoKICAgIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuQ29udHJvbGxlcihCb3VudHkweFRva2VuIF90b2tlbikgcHVibGljIHsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgIH0KCiAgICAvLyBzZXQgdGhlIHdoaXRlbGlzdE9mZiB2YXJpYWJsZQogICAgZnVuY3Rpb24gc2V0V2hpdGVsaXN0T2ZmKGJvb2wgX3doaXRlbGlzdE9mZikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgd2hpdGVsaXN0T2ZmID0gX3doaXRlbGlzdE9mZjsKICAgIH0KCiAgICAvLyB0aGUgb3duZXIgb2YgdGhlIGNvbnRyb2xsZXIgY2FuIGNoYW5nZSB0aGUgY29udHJvbGxlciB0byBhIG5ldyBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIG5ld0NvbnRyb2xsZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHRva2VuLmNoYW5nZUNvbnRyb2xsZXIobmV3Q29udHJvbGxlcik7CiAgICB9CgogICAgLy8gY2hhbmdlIHdoZXRoZXIgdHJhbnNmZXJzIGFyZSBlbmFibGVkCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdG9rZW4uZW5hYmxlVHJhbnNmZXJzKF90cmFuc2ZlcnNFbmFibGVkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB3aGl0ZWxpc3RPZmYgfHwgaXNXaGl0ZWxpc3RlZChfZnJvbSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB3aGl0ZWxpc3RPZmYgfHwgaXNXaGl0ZWxpc3RlZChfb3duZXIpOwogICAgfQp9'.
	

]
