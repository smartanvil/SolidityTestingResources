Class {
	#name : #SRTcf59a4405ea51392c4cb8807f641f3cb9d611994,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcf59a4405ea51392c4cb8807f641f3cb9d611994 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuIAogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIAogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCgoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKCgovKioKICogQHRpdGxlIE1hbmFnZWFibGUKICogQGRldiBDb250cmFjdCB0aGF0IGFsbG93cyB0byBncmFudCBwZXJtaXNzaW9ucyB0byBhbnkgYWRkcmVzcwogKiBAZGV2IEluIHJlYWwgbGlmZSB3ZSBhcmUgbm8gYWJsZSB0byBwZXJmb3JtIGFsbCBhY3Rpb25zIHdpdGgganVzdCBvbmUgRXRoZXJldW0gYWRkcmVzcwogKiBAZGV2IGJlY2F1c2Ugcmlza3MgYXJlIHRvbyBoaWdoLgogKiBAZGV2IEluc3RlYWQgb3duZXIgZGVsZWdhdGVzIHJpZ2h0cyB0byBtYW5hZ2UgYW4gY29udHJhY3QgdG8gdGhlIGRpZmZlcmVudCBhZGRyZXNzZXMgYW5kCiAqIEBkZXYgc3RheSBhYmxlIHRvIHJldm9rZSBwZXJtaXNzaW9ucyBhdCBhbnkgdGltZS4KICovCmNvbnRyYWN0IE1hbmFnZWFibGUgaXMgT3duYWJsZSB7CgogIC8qIFN0b3JhZ2UgKi8KCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBtYW5hZ2VyRW5hYmxlZDsgIC8vIGhhcmQgc3dpdGNoIGZvciBhIG1hbmFnZXIgLSBvbi9vZmYKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKHN0cmluZyA9PiBib29sKSkgbWFuYWdlclBlcm1pc3Npb25zOyAgLy8gZGV0YWlsZWQgaW5mbyBhYm91dCBtYW5hZ2VyYHMgcGVybWlzc2lvbnMKCgogIC8qIEV2ZW50cyAqLwoKICBldmVudCBNYW5hZ2VyRW5hYmxlZEV2ZW50KGFkZHJlc3MgaW5kZXhlZCBtYW5hZ2VyKTsKICBldmVudCBNYW5hZ2VyRGlzYWJsZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgbWFuYWdlcik7CiAgZXZlbnQgTWFuYWdlclBlcm1pc3Npb25HcmFudGVkRXZlbnQoYWRkcmVzcyBpbmRleGVkIG1hbmFnZXIsIHN0cmluZyBwZXJtaXNzaW9uKTsKICBldmVudCBNYW5hZ2VyUGVybWlzc2lvblJldm9rZWRFdmVudChhZGRyZXNzIGluZGV4ZWQgbWFuYWdlciwgc3RyaW5nIHBlcm1pc3Npb24pOwoKCiAgLyogQ29uZmlndXJlIGNvbnRyYWN0ICovCgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gYWRkIG5ldyBtYW5hZ2VyCiAgICogQHBhcmFtIF9tYW5hZ2VyIGFkZHJlc3MgTmV3IG1hbmFnZXIKICAgKi8KICBmdW5jdGlvbiBlbmFibGVNYW5hZ2VyKGFkZHJlc3MgX21hbmFnZXIpIG9ubHlPd25lciBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSB7CiAgICByZXF1aXJlKG1hbmFnZXJFbmFibGVkW19tYW5hZ2VyXSA9PSBmYWxzZSk7CgogICAgbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdID0gdHJ1ZTsKICAgIE1hbmFnZXJFbmFibGVkRXZlbnQoX21hbmFnZXIpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byByZW1vdmUgZXhpc3RpbmcgbWFuYWdlcgogICAqIEBwYXJhbSBfbWFuYWdlciBhZGRyZXNzIEV4aXN0aW5nIG1hbmFnZXIKICAgKi8KICBmdW5jdGlvbiBkaXNhYmxlTWFuYWdlcihhZGRyZXNzIF9tYW5hZ2VyKSBvbmx5T3duZXIgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikgewogICAgcmVxdWlyZShtYW5hZ2VyRW5hYmxlZFtfbWFuYWdlcl0gPT0gdHJ1ZSk7CgogICAgbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdID0gZmFsc2U7CiAgICBNYW5hZ2VyRGlzYWJsZWRFdmVudChfbWFuYWdlcik7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGdyYW50IG5ldyBwZXJtaXNzaW9uIHRvIHRoZSBtYW5hZ2VyCiAgICogQHBhcmFtIF9tYW5hZ2VyICAgICAgICBhZGRyZXNzIEV4aXN0aW5nIG1hbmFnZXIKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgR3JhbnRlZCBwZXJtaXNzaW9uIG5hbWUKICAgKi8KICBmdW5jdGlvbiBncmFudE1hbmFnZXJQZXJtaXNzaW9uKAogICAgYWRkcmVzcyBfbWFuYWdlciwgc3RyaW5nIF9wZXJtaXNzaW9uTmFtZQogICkKICAgIG9ubHlPd25lcgogICAgb25seVZhbGlkQWRkcmVzcyhfbWFuYWdlcikKICAgIG9ubHlWYWxpZFBlcm1pc3Npb25OYW1lKF9wZXJtaXNzaW9uTmFtZSkKICB7CiAgICByZXF1aXJlKG1hbmFnZXJQZXJtaXNzaW9uc1tfbWFuYWdlcl1bX3Blcm1pc3Npb25OYW1lXSA9PSBmYWxzZSk7CgogICAgbWFuYWdlclBlcm1pc3Npb25zW19tYW5hZ2VyXVtfcGVybWlzc2lvbk5hbWVdID0gdHJ1ZTsKICAgIE1hbmFnZXJQZXJtaXNzaW9uR3JhbnRlZEV2ZW50KF9tYW5hZ2VyLCBfcGVybWlzc2lvbk5hbWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byByZXZva2UgcGVybWlzc2lvbiBvZiB0aGUgbWFuYWdlcgogICAqIEBwYXJhbSBfbWFuYWdlciAgICAgICAgYWRkcmVzcyBFeGlzdGluZyBtYW5hZ2VyCiAgICogQHBhcmFtIF9wZXJtaXNzaW9uTmFtZSBzdHJpbmcgIFJldm9rZWQgcGVybWlzc2lvbiBuYW1lCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlTWFuYWdlclBlcm1pc3Npb24oCiAgICBhZGRyZXNzIF9tYW5hZ2VyLCBzdHJpbmcgX3Blcm1pc3Npb25OYW1lCiAgKQogICAgb25seU93bmVyCiAgICBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKQogICAgb25seVZhbGlkUGVybWlzc2lvbk5hbWUoX3Blcm1pc3Npb25OYW1lKQogIHsKICAgIHJlcXVpcmUobWFuYWdlclBlcm1pc3Npb25zW19tYW5hZ2VyXVtfcGVybWlzc2lvbk5hbWVdID09IHRydWUpOwoKICAgIG1hbmFnZXJQZXJtaXNzaW9uc1tfbWFuYWdlcl1bX3Blcm1pc3Npb25OYW1lXSA9IGZhbHNlOwogICAgTWFuYWdlclBlcm1pc3Npb25SZXZva2VkRXZlbnQoX21hbmFnZXIsIF9wZXJtaXNzaW9uTmFtZSk7CiAgfQoKCiAgLyogR2V0dGVycyAqLwoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIG1hbmFnZXIgc3RhdHVzCiAgICogQHBhcmFtIF9tYW5hZ2VyIGFkZHJlc3MgTWFuYWdlcmBzIGFkZHJlc3MKICAgKiBAcmV0dXJuIFRydWUgaWYgbWFuYWdlciBpcyBlbmFibGVkCiAgICovCiAgZnVuY3Rpb24gaXNNYW5hZ2VyRW5hYmxlZChhZGRyZXNzIF9tYW5hZ2VyKSBjb25zdGFudCBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbWFuYWdlckVuYWJsZWRbX21hbmFnZXJdOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayBwZXJtaXNzaW9ucyBvZiBhIG1hbmFnZXIKICAgKiBAcGFyYW0gX21hbmFnZXIgICAgICAgIGFkZHJlc3MgTWFuYWdlcmBzIGFkZHJlc3MKICAgKiBAcGFyYW0gX3Blcm1pc3Npb25OYW1lIHN0cmluZyAgUGVybWlzc2lvbiBuYW1lCiAgICogQHJldHVybiBUcnVlIGlmIG1hbmFnZXIgaGFzIGJlZW4gZ3JhbnRlZCBuZWVkZWQgcGVybWlzc2lvbgogICAqLwogIGZ1bmN0aW9uIGlzUGVybWlzc2lvbkdyYW50ZWQoCiAgICBhZGRyZXNzIF9tYW5hZ2VyLCBzdHJpbmcgX3Blcm1pc3Npb25OYW1lCiAgKQogICAgY29uc3RhbnQKICAgIG9ubHlWYWxpZEFkZHJlc3MoX21hbmFnZXIpCiAgICBvbmx5VmFsaWRQZXJtaXNzaW9uTmFtZShfcGVybWlzc2lvbk5hbWUpCiAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiBtYW5hZ2VyUGVybWlzc2lvbnNbX21hbmFnZXJdW19wZXJtaXNzaW9uTmFtZV07CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBtYW5hZ2VyIGNhbiBwZXJmb3JtIHRoZSBhY3Rpb24gb3Igbm90CiAgICogQHBhcmFtIF9tYW5hZ2VyICAgICAgICBhZGRyZXNzIE1hbmFnZXJgcyBhZGRyZXNzCiAgICogQHBhcmFtIF9wZXJtaXNzaW9uTmFtZSBzdHJpbmcgIFBlcm1pc3Npb24gbmFtZQogICAqIEByZXR1cm4gVHJ1ZSBpZiBtYW5hZ2VyIGlzIGVuYWJsZWQgYW5kIGhhcyBiZWVuIGdyYW50ZWQgbmVlZGVkIHBlcm1pc3Npb24KICAgKi8KICBmdW5jdGlvbiBpc01hbmFnZXJBbGxvd2VkKAogICAgYWRkcmVzcyBfbWFuYWdlciwgc3RyaW5nIF9wZXJtaXNzaW9uTmFtZQogICkKICAgIGNvbnN0YW50CiAgICBvbmx5VmFsaWRBZGRyZXNzKF9tYW5hZ2VyKQogICAgb25seVZhbGlkUGVybWlzc2lvbk5hbWUoX3Blcm1pc3Npb25OYW1lKQogICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXR1cm4gKG1hbmFnZXJFbmFibGVkW19tYW5hZ2VyXSAmJiBtYW5hZ2VyUGVybWlzc2lvbnNbX21hbmFnZXJdW19wZXJtaXNzaW9uTmFtZV0pOwogIH0KCgogIC8qIEhlbHBlcnMgKi8KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBjaGVjayBtYW5hZ2VyIGFkZHJlc3MKICAgKi8KICBtb2RpZmllciBvbmx5VmFsaWRBZGRyZXNzKGFkZHJlc3MgX21hbmFnZXIpIHsKICAgIHJlcXVpcmUoX21hbmFnZXIgIT0gYWRkcmVzcygweDApKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIGNoZWNrIG5hbWUgb2YgbWFuYWdlciBwZXJtaXNzaW9uCiAgICovCiAgbW9kaWZpZXIgb25seVZhbGlkUGVybWlzc2lvbk5hbWUoc3RyaW5nIF9wZXJtaXNzaW9uTmFtZSkgewogICAgcmVxdWlyZShieXRlcyhfcGVybWlzc2lvbk5hbWUpLmxlbmd0aCAhPSAwKTsKICAgIF87CiAgfQoKCiAgLyogT3V0Y29tZSAqLwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIHVzZSBpbiBkZXJpdmVkIGNvbnRyYWN0cwogICAqLwogIG1vZGlmaWVyIG9ubHlBbGxvd2VkTWFuYWdlcihzdHJpbmcgX3Blcm1pc3Npb25OYW1lKSB7CiAgICByZXF1aXJlKGlzTWFuYWdlckFsbG93ZWQobXNnLnNlbmRlciwgX3Blcm1pc3Npb25OYW1lKSA9PSB0cnVlKTsKICAgIF87CiAgfQp9CgoKCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICogQGRldiBCYXNlZCBvbiB6ZXBwZWxpbidzIFBhdXNhYmxlLCBidXQgaW50ZWdyYXRlZCB3aXRoIE1hbmFnZWFibGUKICogQGRldiBDb250cmFjdCBpcyBpbiBwYXVzZWQgc3RhdGUgYnkgZGVmYXVsdCBhbmQgc2hvdWxkIGJlIGV4cGxpY2l0bHkgdW5sb2NrZWQKICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE1hbmFnZWFibGUgewoKICAvKioKICAgKiBFdmVudHMKICAgKi8KCiAgZXZlbnQgUGF1c2VFdmVudCgpOwogIGV2ZW50IFVucGF1c2VFdmVudCgpOwoKCiAgLyoqCiAgICogU3RvcmFnZQogICAqLwoKICBib29sIHBhdXNlZCA9IHRydWU7CgoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuQ29udHJhY3ROb3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCA9PSBmYWxzZSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Db250cmFjdFBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCA9PSB0cnVlKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgbWFuYWdlciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlQ29udHJhY3QoKSBvbmx5QWxsb3dlZE1hbmFnZXIoJ3BhdXNlX2NvbnRyYWN0Jykgd2hlbkNvbnRyYWN0Tm90UGF1c2VkIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZUV2ZW50KCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgbWFuYWdlciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2VDb250cmFjdCgpIG9ubHlBbGxvd2VkTWFuYWdlcigndW5wYXVzZV9jb250cmFjdCcpIHdoZW5Db250cmFjdFBhdXNlZCB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2VFdmVudCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBUaGUgZ2V0dGVyIGZvciAicGF1c2VkIiBjb250cmFjdCB2YXJpYWJsZQogICAqLwogIGZ1bmN0aW9uIGdldFBhdXNlZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBwYXVzZWQ7CiAgfQp9CgoKCgovKioKICogQHRpdGxlIE5hbWVkVG9rZW4KICovCmNvbnRyYWN0IE5hbWVkVG9rZW4gewogIHN0cmluZyBwdWJsaWMgbmFtZTsKICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICB1aW50MzIgcHVibGljIGRlY2ltYWxzOwoKICBmdW5jdGlvbiBOYW1lZFRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQzMiBfZGVjaW1hbHMpIHsKICAgIG5hbWUgPSBfbmFtZTsKICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2FsY3VsYXRlIGhhc2ggb2YgdGhlIHRva2VuYHMgbmFtZS4KICAgKiBAZGV2IEZ1bmN0aW9uIG5lZWRlZCBiZWNhdXNlIHdlIGNhbiBub3QganVzdCByZXR1cm4gbmFtZSBvZiB0aGUgdG9rZW4gdG8gYW5vdGhlciBjb250cmFjdCAtIHN0cmluZ3MgaGF2ZSB2YXJpYWJsZSBsZW5ndGgKICAgKiBAcmV0dXJuIEhhc2ggb2YgdGhlIHRva2VuYHMgbmFtZQogICAqLwogIGZ1bmN0aW9uIGdldE5hbWVIYXNoKCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpewogICAgcmV0dXJuIHNoYTMobmFtZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBoYXNoIG9mIHRoZSB0b2tlbmBzIHN5bWJvbC4KICAgKiBAZGV2IEZ1bmN0aW9uIG5lZWRlZCBiZWNhdXNlIHdlIGNhbiBub3QganVzdCByZXR1cm4gc3ltYm9sIG9mIHRoZSB0b2tlbiB0byBhbm90aGVyIGNvbnRyYWN0IC0gc3RyaW5ncyBoYXZlIHZhcmlhYmxlIGxlbmd0aAogICAqIEByZXR1cm4gSGFzaCBvZiB0aGUgdG9rZW5gcyBzeW1ib2wKICAgKi8KICBmdW5jdGlvbiBnZXRTeW1ib2xIYXNoKCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpewogICAgcmV0dXJuIHNoYTMoc3ltYm9sKTsKICB9Cn0KCgoKCi8qKgogKiBAdGl0bGUgQW5nZWxUb2tlbgogKi8KY29udHJhY3QgQW5nZWxUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBOYW1lZFRva2VuLCBQYXVzYWJsZSB7CgogIC8qIEV2ZW50cyAqLwoKICBldmVudCBNaW50RXZlbnQoYWRkcmVzcyBpbmRleGVkIGFjY291bnQsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEJ1cm5FdmVudChhZGRyZXNzIGluZGV4ZWQgYWNjb3VudCwgdWludCB2YWx1ZSk7CiAgZXZlbnQgU3BlbmRpbmdCbG9ja2VkRXZlbnQoYWRkcmVzcyBpbmRleGVkIGFjY291bnQpOwogIGV2ZW50IFNwZW5kaW5nVW5ibG9ja2VkRXZlbnQoYWRkcmVzcyBpbmRleGVkIGFjY291bnQpOwoKCiAgLyogU3RvcmFnZSAqLwoKICBhZGRyZXNzIHB1YmxpYyBjZW50cmFsQmFua0FkZHJlc3M7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBzcGVuZGluZ0Jsb2Nrc051bWJlcjsKCgogIC8qIENvbnN0cnVjdG9yICovCgogIGZ1bmN0aW9uIEFuZ2VsVG9rZW4oKSBOYW1lZFRva2VuKCdBTkdFTCcsICdBTkcnLCA4KSB7CiAgICBjZW50cmFsQmFua0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qIE1ldGhvZHMgKi8KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBpZiAoX3RvICE9IGNlbnRyYWxCYW5rQWRkcmVzcykgewogICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgfQogICAgcmVxdWlyZShzcGVuZGluZ0Jsb2Nrc051bWJlclttc2cuc2VuZGVyXSA9PSAwKTsKCiAgICBib29sIHJlc3VsdCA9IHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIGlmIChyZXN1bHQgPT0gdHJ1ZSAmJiBfdG8gPT0gY2VudHJhbEJhbmtBZGRyZXNzKSB7CiAgICAgIEFuZ2VsQ2VudHJhbEJhbmsoY2VudHJhbEJhbmtBZGRyZXNzKS5hbmdlbEJ1cm4obXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB3aGVuQ29udHJhY3ROb3RQYXVzZWQgcmV0dXJucyAoYm9vbCl7CiAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHdoZW5Db250cmFjdE5vdFBhdXNlZCByZXR1cm5zIChib29sKXsKICAgIHJlcXVpcmUoc3BlbmRpbmdCbG9ja3NOdW1iZXJbX2Zyb21dID09IDApOwoKICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICBpZiAocmVzdWx0ID09IHRydWUgJiYgX3RvID09IGNlbnRyYWxCYW5rQWRkcmVzcykgewogICAgICBBbmdlbENlbnRyYWxCYW5rKGNlbnRyYWxCYW5rQWRkcmVzcykuYW5nZWxCdXJuKF9mcm9tLCBfdmFsdWUpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgoKICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX2FjY291bnQsIHVpbnQgX3ZhbHVlKSBvbmx5QWxsb3dlZE1hbmFnZXIoJ21pbnRfdG9rZW5zJykgewogICAgYmFsYW5jZXNbX2FjY291bnRdID0gYmFsYW5jZXNbX2FjY291bnRdLmFkZChfdmFsdWUpOwogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX3ZhbHVlKTsKICAgIE1pbnRFdmVudChfYWNjb3VudCwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKDB4MCwgX2FjY291bnQsIF92YWx1ZSk7IC8vIHJlcXVpcmVkIGZvciBibG9ja2V4cGxvcmVycwogIH0KCiAgZnVuY3Rpb24gYnVybih1aW50IF92YWx1ZSkgb25seUFsbG93ZWRNYW5hZ2VyKCdidXJuX3Rva2VucycpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgQnVybkV2ZW50KG1zZy5zZW5kZXIsIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBibG9ja1NwZW5kaW5nKGFkZHJlc3MgX2FjY291bnQpIG9ubHlBbGxvd2VkTWFuYWdlcignYmxvY2tfc3BlbmRpbmcnKSB7CiAgICBzcGVuZGluZ0Jsb2Nrc051bWJlcltfYWNjb3VudF0gPSBzcGVuZGluZ0Jsb2Nrc051bWJlcltfYWNjb3VudF0uYWRkKDEpOwogICAgU3BlbmRpbmdCbG9ja2VkRXZlbnQoX2FjY291bnQpOwogIH0KCiAgZnVuY3Rpb24gdW5ibG9ja1NwZW5kaW5nKGFkZHJlc3MgX2FjY291bnQpIG9ubHlBbGxvd2VkTWFuYWdlcigndW5ibG9ja19zcGVuZGluZycpIHsKICAgIHNwZW5kaW5nQmxvY2tzTnVtYmVyW19hY2NvdW50XSA9IHNwZW5kaW5nQmxvY2tzTnVtYmVyW19hY2NvdW50XS5zdWIoMSk7CiAgICBTcGVuZGluZ1VuYmxvY2tlZEV2ZW50KF9hY2NvdW50KTsKICB9Cn0KCgoKCgoKLyoqCiAqIEB0aXRsZSBBbmdlbENlbnRyYWxCYW5rCiAqCiAqIEBkZXYgQ3Jvd2RzYWxlIGFuZCBlc2Nyb3cgY29udHJhY3QKICovCmNvbnRyYWN0IEFuZ2VsQ2VudHJhbEJhbmsgewoKICAvKiBEYXRhIHN0cnVjdHVyZXMgKi8KCiAgc3RydWN0IEludmVzdG1lbnRSZWNvcmQgewogICAgdWludCB0b2tlbnNTb2xkQmVmb3JlV2VpOwogICAgdWludCBpbnZlc3RlZEV0aFdlaTsKICAgIHVpbnQgcHVyY2hhc2VkVG9rZW5zV2VpOwogICAgdWludCByZWZ1bmRlZEV0aFdlaTsKICAgIHVpbnQgcmV0dXJuZWRUb2tlbnNXZWk7CiAgfQoKCiAgLyogU3RvcmFnZSAtIGNvbmZpZyAqLwoKICB1aW50IHB1YmxpYyBpY29DYXAgPSA3MDAwMDAwMCAqICgxMCAqKiAxOCk7CgogIHVpbnQgcHVibGljIGluaXRpYWxUb2tlblByaWNlID0gMSAqICgxMCAqKiAxOCkgLyAoMTAgKiogNCk7IC8vIG1lYW5zIDAuMDAwMSBFVEggZm9yIG9uZSB0b2tlbgoKICB1aW50IHB1YmxpYyBsYW5kbWFya1NpemUgPSAxMDAwMDAwICogKDEwICoqIDE4KTsKICB1aW50IHB1YmxpYyBsYW5kbWFya1ByaWNlU3RlcE51bWVyYXRvciA9IDEwOwogIHVpbnQgcHVibGljIGxhbmRtYXJrUHJpY2VTdGVwRGVub21pbmF0b3IgPSAxMDA7CgogIHVpbnQgcHVibGljIGZpcnN0UmVmdW5kUm91bmRSYXRlTnVtZXJhdG9yID0gODA7CiAgdWludCBwdWJsaWMgZmlyc3RSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvciA9IDEwMDsKICB1aW50IHB1YmxpYyBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVOdW1lcmF0b3IgPSA0MDsKICB1aW50IHB1YmxpYyBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvciA9IDEwMDsKCiAgdWludCBwdWJsaWMgaW5pdGlhbEZ1bmRzUmVsZWFzZU51bWVyYXRvciA9IDIwOyAvLyBwYXJ0IG9mIGludmVzdG1lbnQKICB1aW50IHB1YmxpYyBpbml0aWFsRnVuZHNSZWxlYXNlRGVub21pbmF0b3IgPSAxMDA7CiAgdWludCBwdWJsaWMgYWZ0ZXJGaXJzdFJlZnVuZFJvdW5kRnVuZHNSZWxlYXNlTnVtZXJhdG9yID0gNTA7IC8vIHBhcnQgb2YgcmVtYWluaW5nIGZ1bmRzCiAgdWludCBwdWJsaWMgYWZ0ZXJGaXJzdFJlZnVuZFJvdW5kRnVuZHNSZWxlYXNlRGVub21pbmF0b3IgPSAxMDA7CgogIHVpbnQgcHVibGljIGFuZ2VsRm91bmRhdGlvblNoYXJlTnVtZXJhdG9yID0gMzA7CiAgdWludCBwdWJsaWMgYW5nZWxGb3VuZGF0aW9uU2hhcmVEZW5vbWluYXRvciA9IDEwMDsKCiAgLyogU3RvcmFnZSAtIHN0YXRlICovCgogIGFkZHJlc3MgcHVibGljIGFuZ2VsQWRtaW5BZGRyZXNzOwogIGFkZHJlc3MgcHVibGljIGFuZ2VsRm91bmRhdGlvbkFkZHJlc3MgPSBhZGRyZXNzKDB4MmIwNTU2YTYyOThlQTNEMzVFOTBGMWRmMzJjYzEyNmIzMUY1OTc3MCk7CiAgdWludCBwdWJsaWMgaWNvTGF1bmNoVGltZXN0YW1wID0gMTUxMTc4NDAwMDsgIC8vIE5vdmVtYmVyIDI3dGggMTI6MDAgR01UCiAgdWludCBwdWJsaWMgaWNvRmluaXNoVGltZXN0YW1wID0gMTUxNDM3NjAwMDsgIC8vIERlY2VtYmVyIDI3dGggMTI6MDAgR01UCiAgdWludCBwdWJsaWMgZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCA9IDE1MjA0MjQwMDA7ICAvLyBNYXJjaCA3dGggMjAxOCAxMjowMCBHTVQKICB1aW50IHB1YmxpYyBzZWNvbmRSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCA9IDE1MjQ3NDQwMDA7ICAvLyBBcHJpbCAyNnRoIDIwMTggMTI6MDAgR01UCgoKICBBbmdlbFRva2VuIHB1YmxpYyBhbmdlbFRva2VuOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IEludmVzdG1lbnRSZWNvcmRbXSkgcHVibGljIGludmVzdG1lbnRzOyAvLyBpbnZlc3RvckFkZHJlc3MgPT4gbGlzdCBvZiBpbnZlc3RtZW50cwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGludmVzdG9yczsKICB1aW50IHB1YmxpYyB0b3RhbEludmVzdG9ycyA9IDA7CiAgdWludCBwdWJsaWMgdG90YWxUb2tlbnNTb2xkID0gMDsKCiAgYm9vbCBhbmdlbFRva2VuVW5wYXVzZWQgPSBmYWxzZTsKICBib29sIGZpcnN0UmVmdW5kUm91bmRGdW5kc1dpdGhkcmF3YWwgPSBmYWxzZTsKCgogIC8qIEV2ZW50cyAqLwoKICBldmVudCBJbnZlc3RtZW50RXZlbnQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50IGV0aCwgdWludCBhbmdlbCk7CiAgZXZlbnQgUmVmdW5kRXZlbnQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50IGV0aCwgdWludCBhbmdlbCk7CgoKICAvKiBDb25zdHJ1Y3RvciBhbmQgY29uZmlnICovCgogIGZ1bmN0aW9uIEFuZ2VsQ2VudHJhbEJhbmsoKSB7CiAgICBhbmdlbEFkbWluQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgYW5nZWxUb2tlbiA9IG5ldyBBbmdlbFRva2VuKCk7CiAgICBhbmdlbFRva2VuLmVuYWJsZU1hbmFnZXIoYWRkcmVzcyh0aGlzKSk7CiAgICBhbmdlbFRva2VuLmdyYW50TWFuYWdlclBlcm1pc3Npb24oYWRkcmVzcyh0aGlzKSwgJ21pbnRfdG9rZW5zJyk7CiAgICBhbmdlbFRva2VuLmdyYW50TWFuYWdlclBlcm1pc3Npb24oYWRkcmVzcyh0aGlzKSwgJ2J1cm5fdG9rZW5zJyk7CiAgICBhbmdlbFRva2VuLmdyYW50TWFuYWdlclBlcm1pc3Npb24oYWRkcmVzcyh0aGlzKSwgJ3VucGF1c2VfY29udHJhY3QnKTsKICAgIGFuZ2VsVG9rZW4udHJhbnNmZXJPd25lcnNoaXAoYW5nZWxGb3VuZGF0aW9uQWRkcmVzcyk7CiAgfQoKICAvKiBJbnZlc3RtZW50cyAqLwoKICAvKioKICAgKiBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIHJlY2VpdmVzIEVUSCBhbmQgc2VuZHMgdG9rZW5zIGJhY2sKICAgKi8KICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIGFuZ2VsUmFpc2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJvY2VzcyBuZXcgRVRIIGludmVzdG1lbnQgYW5kIHNlbmRzIHRva2VucyBiYWNrCiAgICovCiAgZnVuY3Rpb24gYW5nZWxSYWlzZSgpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID49IDApOwogICAgcmVxdWlyZShub3cgPj0gaWNvTGF1bmNoVGltZXN0YW1wICYmIG5vdyA8IGljb0ZpbmlzaFRpbWVzdGFtcCk7CgogICAgLy8gY2FsY3VsYXRlIGFtb3VudCBvZiB0b2tlbnMgZm9yIHJlY2VpdmVkIEVUSAogICAgdWludCBfcHVyY2hhc2VkVG9rZW5zV2VpID0gMDsKICAgIHVpbnQgX25vdFByb2Nlc3NlZEV0aFdlaSA9IDA7CiAgICAoX3B1cmNoYXNlZFRva2Vuc1dlaSwgX25vdFByb2Nlc3NlZEV0aFdlaSkgPSBjYWxjdWxhdGVQdXJjaGFzZWRUb2tlbnModG90YWxUb2tlbnNTb2xkLCBtc2cudmFsdWUpOwoKICAgIC8vIGNyZWF0ZSByZWNvcmQgZm9yIHRoZSBpbnZlc3RtZW50CiAgICB1aW50IF9uZXdSZWNvcmRJbmRleCA9IGludmVzdG1lbnRzW21zZy5zZW5kZXJdLmxlbmd0aDsKICAgIGludmVzdG1lbnRzW21zZy5zZW5kZXJdLmxlbmd0aCArPSAxOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS50b2tlbnNTb2xkQmVmb3JlV2VpID0gdG90YWxUb2tlbnNTb2xkOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS5pbnZlc3RlZEV0aFdlaSA9IG1zZy52YWx1ZTsKICAgIGludmVzdG1lbnRzW21zZy5zZW5kZXJdW19uZXdSZWNvcmRJbmRleF0ucHVyY2hhc2VkVG9rZW5zV2VpID0gX3B1cmNoYXNlZFRva2Vuc1dlaTsKICAgIGludmVzdG1lbnRzW21zZy5zZW5kZXJdW19uZXdSZWNvcmRJbmRleF0ucmVmdW5kZWRFdGhXZWkgPSAwOwogICAgaW52ZXN0bWVudHNbbXNnLnNlbmRlcl1bX25ld1JlY29yZEluZGV4XS5yZXR1cm5lZFRva2Vuc1dlaSA9IDA7CgogICAgLy8gY2FsY3VsYXRlIHN0YXRzCiAgICBpZiAoaW52ZXN0b3JzW21zZy5zZW5kZXJdID09IGZhbHNlKSB7CiAgICAgIHRvdGFsSW52ZXN0b3JzICs9IDE7CiAgICB9CiAgICBpbnZlc3RvcnNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgdG90YWxUb2tlbnNTb2xkICs9IF9wdXJjaGFzZWRUb2tlbnNXZWk7CgogICAgLy8gdHJhbnNmZXIgdG9rZW5zIGFuZCBFVEgKICAgIGFuZ2VsVG9rZW4ubWludChtc2cuc2VuZGVyLCBfcHVyY2hhc2VkVG9rZW5zV2VpKTsKICAgIGFuZ2VsVG9rZW4ubWludChhbmdlbEZvdW5kYXRpb25BZGRyZXNzLAogICAgICAgICAgICAgICAgICAgIF9wdXJjaGFzZWRUb2tlbnNXZWkgKiBhbmdlbEZvdW5kYXRpb25TaGFyZU51bWVyYXRvciAvIChhbmdlbEZvdW5kYXRpb25TaGFyZURlbm9taW5hdG9yIC0gYW5nZWxGb3VuZGF0aW9uU2hhcmVOdW1lcmF0b3IpKTsKICAgIGFuZ2VsRm91bmRhdGlvbkFkZHJlc3MudHJhbnNmZXIobXNnLnZhbHVlICogaW5pdGlhbEZ1bmRzUmVsZWFzZU51bWVyYXRvciAvIGluaXRpYWxGdW5kc1JlbGVhc2VEZW5vbWluYXRvcik7CiAgICBpZiAoX25vdFByb2Nlc3NlZEV0aFdlaSA+IDApIHsKICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihfbm90UHJvY2Vzc2VkRXRoV2VpKTsKICAgIH0KCiAgICAvLyBmaW5pc2ggSUNPIGlmIGNhcCByZWFjaGVkCiAgICBpZiAodG90YWxUb2tlbnNTb2xkID49IGljb0NhcCkgewogICAgICBpY29GaW5pc2hUaW1lc3RhbXAgPSBub3c7CgogICAgICB1bnBhdXNlQW5nZWxUb2tlbigpOwogICAgfQoKICAgIC8vIGZpcmUgZXZlbnQKICAgIEludmVzdG1lbnRFdmVudChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIF9wdXJjaGFzZWRUb2tlbnNXZWkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHRva2VucyBmb3IgcmVjZWl2ZWQgRVRICiAgICogQHBhcmFtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgdWludCBBbW91bnQgb2YgdG9rZW5zIHNvbGQgYmVmb3JlIHRoaXMgaW52ZXN0bWVudCBbdG9rZW4gd2VpXQogICAqIEBwYXJhbSBfaW52ZXN0ZWRFdGhXZWkgICAgICAgIHVpbnQgSW52ZXN0bWVudCBhbW91bnQgW0VUSCB3ZWldCiAgICogQHJldHVybiBQdXJjaGFzZWQgYW1vdW50IG9mIHRva2VucyBbdG9rZW4gd2VpXQogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVB1cmNoYXNlZFRva2VucygKICAgIHVpbnQgX3RvdGFsVG9rZW5zU29sZEJlZm9yZSwKICAgIHVpbnQgX2ludmVzdGVkRXRoV2VpKQogICAgY29uc3RhbnQgcmV0dXJucyAodWludCBfcHVyY2hhc2VkVG9rZW5zV2VpLCB1aW50IF9ub3RQcm9jZXNzZWRFdGhXZWkpCiAgewogICAgX3B1cmNoYXNlZFRva2Vuc1dlaSA9IDA7CiAgICBfbm90UHJvY2Vzc2VkRXRoV2VpID0gX2ludmVzdGVkRXRoV2VpOwoKICAgIHVpbnQgX2xhbmRtYXJrUHJpY2U7CiAgICB1aW50IF9tYXhMYW5kbWFya1Rva2Vuc1dlaTsKICAgIHVpbnQgX21heExhbmRtYXJrRXRoV2VpOwogICAgYm9vbCBfaXNDYXBSZWFjaGVkID0gZmFsc2U7CiAgICBkbyB7CiAgICAgIC8vIGdldCBsYW5kbWFyayB2YWx1ZXMKICAgICAgX2xhbmRtYXJrUHJpY2UgPSBjYWxjdWxhdGVMYW5kbWFya1ByaWNlKF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgKyBfcHVyY2hhc2VkVG9rZW5zV2VpKTsKICAgICAgX21heExhbmRtYXJrVG9rZW5zV2VpID0gbGFuZG1hcmtTaXplIC0gKChfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3B1cmNoYXNlZFRva2Vuc1dlaSkgJSBsYW5kbWFya1NpemUpOwogICAgICBpZiAoX3RvdGFsVG9rZW5zU29sZEJlZm9yZSArIF9wdXJjaGFzZWRUb2tlbnNXZWkgKyBfbWF4TGFuZG1hcmtUb2tlbnNXZWkgPj0gaWNvQ2FwKSB7CiAgICAgICAgX21heExhbmRtYXJrVG9rZW5zV2VpID0gaWNvQ2FwIC0gX3RvdGFsVG9rZW5zU29sZEJlZm9yZSAtIF9wdXJjaGFzZWRUb2tlbnNXZWk7CiAgICAgICAgX2lzQ2FwUmVhY2hlZCA9IHRydWU7CiAgICAgIH0KICAgICAgX21heExhbmRtYXJrRXRoV2VpID0gX21heExhbmRtYXJrVG9rZW5zV2VpICogX2xhbmRtYXJrUHJpY2UgLyAoMTAgKiogMTgpOwoKICAgICAgLy8gY2hlY2sgaW52ZXN0bWVudCBhZ2FpbnN0IGxhbmRtYXJrIHZhbHVlcwogICAgICBpZiAoX25vdFByb2Nlc3NlZEV0aFdlaSA+PSBfbWF4TGFuZG1hcmtFdGhXZWkpIHsKICAgICAgICBfcHVyY2hhc2VkVG9rZW5zV2VpICs9IF9tYXhMYW5kbWFya1Rva2Vuc1dlaTsKICAgICAgICBfbm90UHJvY2Vzc2VkRXRoV2VpIC09IF9tYXhMYW5kbWFya0V0aFdlaTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBfcHVyY2hhc2VkVG9rZW5zV2VpICs9IF9ub3RQcm9jZXNzZWRFdGhXZWkgKiAoMTAgKiogMTgpIC8gX2xhbmRtYXJrUHJpY2U7CiAgICAgICAgX25vdFByb2Nlc3NlZEV0aFdlaSA9IDA7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlICgoX25vdFByb2Nlc3NlZEV0aFdlaSA+IDApICYmIChfaXNDYXBSZWFjaGVkID09IGZhbHNlKSk7CgogICAgYXNzZXJ0KF9wdXJjaGFzZWRUb2tlbnNXZWkgPiAwKTsKCiAgICByZXR1cm4gKF9wdXJjaGFzZWRUb2tlbnNXZWksIF9ub3RQcm9jZXNzZWRFdGhXZWkpOwogIH0KCgogIC8qIFJlZnVuZHMgKi8KCiAgZnVuY3Rpb24gYW5nZWxCdXJuKAogICAgYWRkcmVzcyBfaW52ZXN0b3IsCiAgICB1aW50IF9yZXR1cm5lZFRva2Vuc1dlaQogICkKICAgIHJldHVybnMgKHVpbnQpCiAgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoYW5nZWxUb2tlbikpOwogICAgcmVxdWlyZShub3cgPj0gaWNvTGF1bmNoVGltZXN0YW1wICYmIG5vdyA8IHNlY29uZFJlZnVuZFJvdW5kRmluaXNoVGltZXN0YW1wKTsKCiAgICB1aW50IF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPSBfcmV0dXJuZWRUb2tlbnNXZWk7CiAgICB1aW50IF9yZWZ1bmRlZEV0aFdlaSA9IDA7CgogICAgdWludCBfYWxsUmVjb3Jkc051bWJlciA9IGludmVzdG1lbnRzW19pbnZlc3Rvcl0ubGVuZ3RoOwogICAgdWludCBfcmVjb3JkTWF4UmV0dXJuZWRUb2tlbnNXZWkgPSAwOwogICAgdWludCBfcmVjb3JkVG9rZW5zV2VpVG9Qcm9jZXNzID0gMDsKICAgIHVpbnQgX3Rva2Vuc1NvbGRXZWkgPSAwOwogICAgdWludCBfcmVjb3JkUmVmdW5kZWRFdGhXZWkgPSAwOwogICAgdWludCBfcmVjb3JkTm90UHJvY2Vzc2VkVG9rZW5zV2VpID0gMDsKICAgIGZvciAodWludCBfcmVjb3JkSUQgPSAwOyBfcmVjb3JkSUQgPCBfYWxsUmVjb3Jkc051bWJlcjsgX3JlY29yZElEICs9IDEpIHsKICAgICAgaWYgKGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5wdXJjaGFzZWRUb2tlbnNXZWkgPD0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJldHVybmVkVG9rZW5zV2VpIHx8CiAgICAgICAgICBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0uaW52ZXN0ZWRFdGhXZWkgPD0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJlZnVuZGVkRXRoV2VpKSB7CiAgICAgICAgLy8gdG9rZW5zIGFscmVhZHkgcmVmdW5kZWQKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgLy8gY2FsY3VsYXRlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVmdW5kIHdpdGggdGhpcyByZWNvcmQKICAgICAgX3JlY29yZE1heFJldHVybmVkVG9rZW5zV2VpID0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnB1cmNoYXNlZFRva2Vuc1dlaSAtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZXR1cm5lZFRva2Vuc1dlaTsKICAgICAgX3JlY29yZFRva2Vuc1dlaVRvUHJvY2VzcyA9IChfbm90UHJvY2Vzc2VkVG9rZW5zV2VpIDwgX3JlY29yZE1heFJldHVybmVkVG9rZW5zV2VpKSA/IF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3JlY29yZE1heFJldHVybmVkVG9rZW5zV2VpOwogICAgICBhc3NlcnQoX3JlY29yZFRva2Vuc1dlaVRvUHJvY2VzcyA+IDApOwoKICAgICAgLy8gY2FsY3VsYXRlIGFtb3VudCBvZiBFVEggdG8gc2VuZCBiYWNrCiAgICAgIF90b2tlbnNTb2xkV2VpID0gaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnRva2Vuc1NvbGRCZWZvcmVXZWkgKyBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmV0dXJuZWRUb2tlbnNXZWk7CiAgICAgIChfcmVjb3JkUmVmdW5kZWRFdGhXZWksIF9yZWNvcmROb3RQcm9jZXNzZWRUb2tlbnNXZWkpID0gY2FsY3VsYXRlUmVmdW5kZWRFdGgoX3Rva2Vuc1NvbGRXZWksIF9yZWNvcmRUb2tlbnNXZWlUb1Byb2Nlc3MpOwogICAgICBpZiAoX3JlY29yZFJlZnVuZGVkRXRoV2VpID4gKGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5pbnZlc3RlZEV0aFdlaSAtIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZWZ1bmRlZEV0aFdlaSkpIHsKICAgICAgICAvLyB0aGlzIGNhbiBoYXBwZW4gZHVlIHRvIHJvdW5kaW5nIGVycm9yCiAgICAgICAgX3JlY29yZFJlZnVuZGVkRXRoV2VpID0gKGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5pbnZlc3RlZEV0aFdlaSAtIGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZWZ1bmRlZEV0aFdlaSk7CiAgICAgIH0KICAgICAgYXNzZXJ0KF9yZWNvcmRSZWZ1bmRlZEV0aFdlaSA+IDApOwogICAgICBhc3NlcnQoX3JlY29yZE5vdFByb2Nlc3NlZFRva2Vuc1dlaSA9PSAwKTsKCiAgICAgIC8vIHBlcnNpc3QgY2hhbmdlcyB0byB0aGUgc3RvcmFnZQogICAgICBfcmVmdW5kZWRFdGhXZWkgKz0gX3JlY29yZFJlZnVuZGVkRXRoV2VpOwogICAgICBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpIC09IF9yZWNvcmRUb2tlbnNXZWlUb1Byb2Nlc3M7CgogICAgICBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmVmdW5kZWRFdGhXZWkgKz0gX3JlY29yZFJlZnVuZGVkRXRoV2VpOwogICAgICBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0ucmV0dXJuZWRUb2tlbnNXZWkgKz0gX3JlY29yZFRva2Vuc1dlaVRvUHJvY2VzczsKICAgICAgYXNzZXJ0KGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5yZWZ1bmRlZEV0aFdlaSA8PSBpbnZlc3RtZW50c1tfaW52ZXN0b3JdW19yZWNvcmRJRF0uaW52ZXN0ZWRFdGhXZWkpOwogICAgICBhc3NlcnQoaW52ZXN0bWVudHNbX2ludmVzdG9yXVtfcmVjb3JkSURdLnJldHVybmVkVG9rZW5zV2VpIDw9IGludmVzdG1lbnRzW19pbnZlc3Rvcl1bX3JlY29yZElEXS5wdXJjaGFzZWRUb2tlbnNXZWkpOwoKICAgICAgLy8gc3RvcCBpZiB3ZSBhbHJlYWR5IHJlZnVuZGVkIGFsbCB0b2tlbnMKICAgICAgaWYgKF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPT0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgLy8gdGhyb3cgaWYgd2UgZG8gbm90IGhhdmUgdG9rZW5zIHRvIHJlZnVuZAogICAgcmVxdWlyZShfbm90UHJvY2Vzc2VkVG9rZW5zV2VpIDwgX3JldHVybmVkVG9rZW5zV2VpKTsKICAgIHJlcXVpcmUoX3JlZnVuZGVkRXRoV2VpID4gMCk7CgogICAgLy8gY2FsY3VsYXRlIHJlZnVuZCBkaXNjb3VudAogICAgdWludCBfcmVmdW5kZWRFdGhXZWlXaXRoRGlzY291bnQgPSBjYWxjdWxhdGVSZWZ1bmRlZEV0aFdpdGhEaXNjb3VudChfcmVmdW5kZWRFdGhXZWkpOwoKICAgIC8vIHRyYW5zZmVyIEVUSCBhbmQgcmVtYWluaW5nIHRva2VucwogICAgYW5nZWxUb2tlbi5idXJuKF9yZXR1cm5lZFRva2Vuc1dlaSAtIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkpOwogICAgaWYgKF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkgPiAwKSB7CiAgICAgIGFuZ2VsVG9rZW4udHJhbnNmZXIoX2ludmVzdG9yLCBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpKTsKICAgIH0KICAgIF9pbnZlc3Rvci50cmFuc2ZlcihfcmVmdW5kZWRFdGhXZWlXaXRoRGlzY291bnQpOwoKICAgIC8vIGZpcmUgZXZlbnQKICAgIFJlZnVuZEV2ZW50KF9pbnZlc3RvciwgX3JlZnVuZGVkRXRoV2VpV2l0aERpc2NvdW50LCBfcmV0dXJuZWRUb2tlbnNXZWkgLSBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGRpc2NvdW50ZWQgYW1vdW50IG9mIEVUSCBmb3IgcmVmdW5kZWQgdG9rZW5zCiAgICogQHBhcmFtIF9yZWZ1bmRlZEV0aFdlaSB1aW50IENhbGN1bGF0ZWQgYW1vdW50IG9mIEVUSCB0byByZWZ1bmQgW0VUSCB3ZWldCiAgICogQHJldHVybiBEaXNjb3VudGVkIGFtb3VudCBvZiBFVEggZm9yIHJlZnVuZGVkIFtFVEggd2VpXQogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVJlZnVuZGVkRXRoV2l0aERpc2NvdW50KAogICAgdWludCBfcmVmdW5kZWRFdGhXZWkKICApCiAgICBjb25zdGFudCByZXR1cm5zICh1aW50KQogIHsKICAgIGlmIChub3cgPD0gZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCkgewogICAgICByZXR1cm4gKF9yZWZ1bmRlZEV0aFdlaSAqIGZpcnN0UmVmdW5kUm91bmRSYXRlTnVtZXJhdG9yIC8gZmlyc3RSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvcik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgcmV0dXJuIChfcmVmdW5kZWRFdGhXZWkgKiBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVOdW1lcmF0b3IgLyBzZWNvbmRSZWZ1bmRSb3VuZFJhdGVEZW5vbWluYXRvcik7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgRVRIIGZvciByZWZ1bmRlZCB0b2tlbnMuIEp1c3QgYWJzdHJhY3QgcHJpY2UgbGFkZGVyCiAgICogQHBhcmFtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgICAgIHVpbnQgQW1vdW50IG9mIHRva2VucyB0aGF0IGhhdmUgYmVlbiBzb2xkIChzdGFydGluZyBwb2ludCkgW3Rva2VuIHdlaV0KICAgKiBAcGFyYW0gX3JldHVybmVkVG9rZW5zV2VpIHVpbnQgQW1vdW50IG9mIHRva2VucyB0byByZWZ1bmQgW3Rva2VuIHdlaV0KICAgKiBAcmV0dXJuIFJlZnVuZGVkIGFtb3VudCBvZiBFVEggW0VUSCB3ZWldICh3aXRob3V0IGRpc2NvdW50cykKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVSZWZ1bmRlZEV0aCgKICAgIHVpbnQgX3RvdGFsVG9rZW5zU29sZEJlZm9yZSwKICAgIHVpbnQgX3JldHVybmVkVG9rZW5zV2VpCiAgKQogICAgY29uc3RhbnQgcmV0dXJucyAodWludCBfcmVmdW5kZWRFdGhXZWksIHVpbnQgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSkKICB7CiAgICBfcmVmdW5kZWRFdGhXZWkgPSAwOwogICAgdWludCBfcmVmdW5kZWRUb2tlbnNXZWkgPSAwOwogICAgX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA9IF9yZXR1cm5lZFRva2Vuc1dlaTsKCiAgICB1aW50IF9sYW5kbWFya1ByaWNlID0gMDsKICAgIHVpbnQgX21heExhbmRtYXJrVG9rZW5zV2VpID0gMDsKICAgIHVpbnQgX21heExhbmRtYXJrRXRoV2VpID0gMDsKICAgIGJvb2wgX2lzQ2FwUmVhY2hlZCA9IGZhbHNlOwogICAgZG8gewogICAgICAvLyBnZXQgbGFuZG1hcmsgdmFsdWVzCiAgICAgIF9sYW5kbWFya1ByaWNlID0gY2FsY3VsYXRlTGFuZG1hcmtQcmljZShfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3JlZnVuZGVkVG9rZW5zV2VpKTsKICAgICAgX21heExhbmRtYXJrVG9rZW5zV2VpID0gbGFuZG1hcmtTaXplIC0gKChfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3JlZnVuZGVkVG9rZW5zV2VpKSAlIGxhbmRtYXJrU2l6ZSk7CiAgICAgIGlmIChfdG90YWxUb2tlbnNTb2xkQmVmb3JlICsgX3JlZnVuZGVkVG9rZW5zV2VpICsgX21heExhbmRtYXJrVG9rZW5zV2VpID49IGljb0NhcCkgewogICAgICAgIF9tYXhMYW5kbWFya1Rva2Vuc1dlaSA9IGljb0NhcCAtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgLSBfcmVmdW5kZWRUb2tlbnNXZWk7CiAgICAgICAgX2lzQ2FwUmVhY2hlZCA9IHRydWU7CiAgICAgIH0KICAgICAgX21heExhbmRtYXJrRXRoV2VpID0gX21heExhbmRtYXJrVG9rZW5zV2VpICogX2xhbmRtYXJrUHJpY2UgLyAoMTAgKiogMTgpOwoKICAgICAgLy8gY2hlY2sgaW52ZXN0bWVudCBhZ2FpbnN0IGxhbmRtYXJrIHZhbHVlcwogICAgICBpZiAoX25vdFByb2Nlc3NlZFRva2Vuc1dlaSA+IF9tYXhMYW5kbWFya1Rva2Vuc1dlaSkgewogICAgICAgIF9yZWZ1bmRlZEV0aFdlaSArPSBfbWF4TGFuZG1hcmtFdGhXZWk7CiAgICAgICAgX3JlZnVuZGVkVG9rZW5zV2VpICs9IF9tYXhMYW5kbWFya1Rva2Vuc1dlaTsKICAgICAgICBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpIC09IF9tYXhMYW5kbWFya1Rva2Vuc1dlaTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBfcmVmdW5kZWRFdGhXZWkgKz0gX25vdFByb2Nlc3NlZFRva2Vuc1dlaSAqIF9sYW5kbWFya1ByaWNlIC8gKDEwICoqIDE4KTsKICAgICAgICBfcmVmdW5kZWRUb2tlbnNXZWkgKz0gX25vdFByb2Nlc3NlZFRva2Vuc1dlaTsKICAgICAgICBfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID0gMDsKICAgICAgfQogICAgfQogICAgd2hpbGUgKChfbm90UHJvY2Vzc2VkVG9rZW5zV2VpID4gMCkgJiYgKF9pc0NhcFJlYWNoZWQgPT0gZmFsc2UpKTsKCiAgICBhc3NlcnQoX3JlZnVuZGVkRXRoV2VpID4gMCk7CgogICAgcmV0dXJuIChfcmVmdW5kZWRFdGhXZWksIF9ub3RQcm9jZXNzZWRUb2tlbnNXZWkpOwogIH0KCgogIC8qIENhbGN1bGF0aW9uIG9mIHRoZSBwcmljZSAqLwoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBwcmljZSBmb3IgdG9rZW5zCiAgICogQHBhcmFtIF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgdWludCBBbW91bnQgb2YgdG9rZW5zIHNvbGQgYmVmb3JlIFt0b2tlbiB3ZWldCiAgICogQHJldHVybiBDYWxjdWxhdGVkIHByaWNlCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlTGFuZG1hcmtQcmljZSh1aW50IF90b3RhbFRva2Vuc1NvbGRCZWZvcmUpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBpbml0aWFsVG9rZW5QcmljZSArIGluaXRpYWxUb2tlblByaWNlICogbGFuZG1hcmtQcmljZVN0ZXBOdW1lcmF0b3IgLyBsYW5kbWFya1ByaWNlU3RlcERlbm9taW5hdG9yICogKF90b3RhbFRva2Vuc1NvbGRCZWZvcmUgLyBsYW5kbWFya1NpemUpOwogIH0KCgogIC8qIExpZmVjeWNsZSAqLwoKICBmdW5jdGlvbiB1bnBhdXNlQW5nZWxUb2tlbigpIHsKICAgIHJlcXVpcmUobm93ID49IGljb0ZpbmlzaFRpbWVzdGFtcCk7CiAgICByZXF1aXJlKGFuZ2VsVG9rZW5VbnBhdXNlZCA9PSBmYWxzZSk7CgogICAgYW5nZWxUb2tlblVucGF1c2VkID0gdHJ1ZTsKCiAgICBhbmdlbFRva2VuLnVucGF1c2VDb250cmFjdCgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdGb3VuZGF0aW9uRnVuZHMoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYW5nZWxGb3VuZGF0aW9uQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IGFuZ2VsQWRtaW5BZGRyZXNzKTsKICAgIHJlcXVpcmUobm93ID4gZmlyc3RSZWZ1bmRSb3VuZEZpbmlzaFRpbWVzdGFtcCk7CgogICAgaWYgKG5vdyA+IGZpcnN0UmVmdW5kUm91bmRGaW5pc2hUaW1lc3RhbXAgJiYgbm93IDw9IHNlY29uZFJlZnVuZFJvdW5kRmluaXNoVGltZXN0YW1wKSB7CiAgICAgIHJlcXVpcmUoZmlyc3RSZWZ1bmRSb3VuZEZ1bmRzV2l0aGRyYXdhbCA9PSBmYWxzZSk7CgogICAgICBmaXJzdFJlZnVuZFJvdW5kRnVuZHNXaXRoZHJhd2FsID0gdHJ1ZTsKICAgICAgYW5nZWxGb3VuZGF0aW9uQWRkcmVzcy50cmFuc2Zlcih0aGlzLmJhbGFuY2UgKiBhZnRlckZpcnN0UmVmdW5kUm91bmRGdW5kc1JlbGVhc2VOdW1lcmF0b3IgLyBhZnRlckZpcnN0UmVmdW5kUm91bmRGdW5kc1JlbGVhc2VEZW5vbWluYXRvcik7CiAgICB9IGVsc2UgewogICAgICBhbmdlbEZvdW5kYXRpb25BZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CiAgfQp9'.
	

]
