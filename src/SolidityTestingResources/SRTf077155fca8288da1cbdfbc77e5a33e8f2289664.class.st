Class {
	#name : #SRTf077155fca8288da1cbdfbc77e5a33e8f2289664,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf077155fca8288da1cbdfbc77e5a33e8f2289664 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBFdGhlcm5hdXRzCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKCgoKLy8vIEBkZXYgQmFzZSBjb250cmFjdCBmb3IgYWxsIEV0aGVybmF1dHMgY29udHJhY3RzIGhvbGRpbmcgZ2xvYmFsIGNvbnN0YW50cyBhbmQgZnVuY3Rpb25zLgpjb250cmFjdCBFdGhlcm5hdXRzQmFzZSB7CgogICAgLyoqKiBDT05TVEFOVFMgVVNFRCBBQ1JPU1MgQ09OVFJBQ1RTICoqKi8KCiAgICAvLy8gQGRldiBVc2VkIGJ5IGFsbCBjb250cmFjdHMgdGhhdCBpbnRlcmZhY2VzIHdpdGggRXRoZXJuYXV0cwogICAgLy8vICAgICAgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPQogICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RvdGFsU3VwcGx5KCknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0YWtlT3duZXJzaGlwKHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2Vuc09mT3duZXIoYWRkcmVzcyknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5NZXRhZGF0YSh1aW50MjU2LHN0cmluZyknKSk7CgogICAgLy8vIEBkZXYgZHVlIHNvbGlkaXR5IGxpbWl0YXRpb24gd2UgY2Fubm90IHJldHVybiBkeW5hbWljIGFycmF5IGZyb20gbWV0aG9kcwogICAgLy8vIHNvIGl0IGNyZWF0ZXMgaW5jb21wYWJpbGl0eSBiZXR3ZWVuIGZ1bmN0aW9ucyBhY3Jvc3MgZGlmZmVyZW50IGNvbnRyYWN0cwogICAgdWludDggcHVibGljIGNvbnN0YW50IFNUQVRTX1NJWkUgPSAxMDsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBTSElQX1NMT1RTID0gNTsKCiAgICAvLyBQb3NzaWJsZSBzdGF0ZSBvZiBhbnkgYXNzZXQKICAgIGVudW0gQXNzZXRTdGF0ZSB7IEF2YWlsYWJsZSwgVXBGb3JMZWFzZSwgVXNlZCB9CgogICAgLy8gUG9zc2libGUgc3RhdGUgb2YgYW55IGFzc2V0CiAgICAvLyBOb3RWYWxpZCBpcyB0byBhdm9pZCAwIGluIHBsYWNlcyB3aGVyZSBjYXRlZ29yeSBtdXN0IGJlIGJpZ2dlciB0aGFuIHplcm8KICAgIGVudW0gQXNzZXRDYXRlZ29yeSB7IE5vdFZhbGlkLCBTZWN0b3IsIE1hbnVmYWN0dXJlciwgU2hpcCwgT2JqZWN0LCBGYWN0b3J5LCBDcmV3TWVtYmVyIH0KCiAgICAvLy8gQGRldiBTZWN0b3Igc3RhdHMKICAgIGVudW0gU2hpcFN0YXRzIHtMZXZlbCwgQXR0YWNrLCBEZWZlbnNlLCBTcGVlZCwgUmFuZ2UsIEx1Y2t9CiAgICAvLy8gQG5vdGljZSBQb3NzaWJsZSBhdHRyaWJ1dGVzIGZvciBlYWNoIGFzc2V0CiAgICAvLy8gMDAwMDAwMDEgLSBTZWVkZWQgLSBPZmZlcmVkIHRvIHRoZSBlY29ub215IGJ5IHVzLCB0aGUgZGV2ZWxvcGVycy4gUG90ZW50aWFsbHkgYXQgcmVndWxhciBpbnRlcnZhbHMuCiAgICAvLy8gMDAwMDAwMTAgLSBQcm9kdWNpYmxlIC0gUHJvZHVjdCBvZiBhIGZhY3RvcnkgYW5kL29yIGZhY3RvcnkgY29udHJhY3QuCiAgICAvLy8gMDAwMDAxMDAgLSBFeHBsb3JhYmxlLSBQcm9kdWN0IG9mIGV4cGxvcmF0aW9uLgogICAgLy8vIDAwMDAxMDAwIC0gTGVhc2FibGUgLSBDYW4gYmUgcmVudGVkIHRvIG90aGVyIHVzZXJzIGFuZCB3aWxsIHJldHVybiB0byB0aGUgb3JpZ2luYWwgb3duZXIgb25jZSB0aGUgYWN0aW9uIGlzIGNvbXBsZXRlLgogICAgLy8vIDAwMDEwMDAwIC0gUGVybWFuZW50IC0gQ2Fubm90IGJlIHJlbW92ZWQsIGFsd2F5cyBvd25lZCBieSBhIHVzZXIuCiAgICAvLy8gMDAxMDAwMDAgLSBDb25zdW1hYmxlIC0gRGVzdHJveWVkIGFmdGVyIE4gZXhwbG9yYXRpb24gZXhwZWRpdGlvbnMuCiAgICAvLy8gMDEwMDAwMDAgLSBUcmFkYWJsZSAtIEJ1eWFibGUgYW5kIHNlbGxhYmxlIG9uIHRoZSBtYXJrZXQuCiAgICAvLy8gMTAwMDAwMDAgLSBIb3QgUG90YXRvIC0gQXV0b21hdGljYWxseSBnZXRzIHB1dCB1cCBmb3Igc2FsZSBhZnRlciBhY3F1aXJpbmcuCiAgICBieXRlczIgcHVibGljIEFUVFJfU0VFREVEICAgICA9IGJ5dGVzMigyKiowKTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9QUk9EVUNJQkxFID0gYnl0ZXMyKDIqKjEpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX0VYUExPUkFCTEUgPSBieXRlczIoMioqMik7CiAgICBieXRlczIgcHVibGljIEFUVFJfTEVBU0FCTEUgICA9IGJ5dGVzMigyKiozKTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9QRVJNQU5FTlQgID0gYnl0ZXMyKDIqKjQpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX0NPTlNVTUFCTEUgPSBieXRlczIoMioqNSk7CiAgICBieXRlczIgcHVibGljIEFUVFJfVFJBREFCTEUgICA9IGJ5dGVzMigyKio2KTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9HT0xERU5HT09TRSA9IGJ5dGVzMigyKio3KTsKfQoKLy8vIEBub3RpY2UgVGhpcyBjb250cmFjdCBtYW5hZ2VzIHRoZSB2YXJpb3VzIGFkZHJlc3NlcyBhbmQgY29uc3RyYWludHMgZm9yIG9wZXJhdGlvbnMKLy8gICAgICAgICAgdGhhdCBjYW4gYmUgZXhlY3V0ZWQgb25seSBieSBzcGVjaWZpYyByb2xlcy4gTmFtZWx5IENFTyBhbmQgQ1RPLiBpdCBhbHNvIGluY2x1ZGVzIHBhdXNhYmxlIHBhdHRlcm4uCmNvbnRyYWN0IEV0aGVybmF1dHNBY2Nlc3NDb250cm9sIGlzIEV0aGVybmF1dHNCYXNlIHsKCiAgICAvLyBUaGlzIGZhY2V0IGNvbnRyb2xzIGFjY2VzcyBjb250cm9sIGZvciBFdGhlcm5hdXRzLgogICAgLy8gQWxsIHJvbGVzIGhhdmUgc2FtZSByZXNwb25zaWJpbGl0aWVzIGFuZCByaWdodHMsIGJ1dCB0aGVyZSBpcyBzbGlnaHQgZGlmZmVyZW5jZXMgYmV0d2VlbiB0aGVtOgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDRU86IFRoZSBDRU8gY2FuIHJlYXNzaWduIG90aGVyIHJvbGVzIGFuZCBvbmx5IHJvbGUgdGhhdCBjYW4gdW5wYXVzZSB0aGUgc21hcnQgY29udHJhY3QuCiAgICAvLyAgICAgICBJdCBpcyBpbml0aWFsbHkgc2V0IHRvIHRoZSBhZGRyZXNzIHRoYXQgY3JlYXRlZCB0aGUgc21hcnQgY29udHJhY3QuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENUTzogVGhlIENUTyBjYW4gY2hhbmdlIGNvbnRyYWN0IGFkZHJlc3MsIG9yYWNsZSBhZGRyZXNzIGFuZCBwbGFuIGZvciB1cGdyYWRlcy4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ09POiBUaGUgQ09PIGNhbiBjaGFuZ2UgY29udHJhY3QgYWRkcmVzcyBhbmQgYWRkIGNyZWF0ZSBhc3NldHMuCiAgICAvLwogICAgLy8vIEBkZXYgRW1pdGVkIHdoZW4gY29udHJhY3QgaXMgdXBncmFkZWQgLSBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAvLy8gQHBhcmFtIG5ld0NvbnRyYWN0IGFkZHJlc3MgcG9pbnRpbmcgdG8gbmV3IGNvbnRyYWN0CiAgICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyBuZXdDb250cmFjdCk7CgogICAgLy8gVGhlIGFkZHJlc3NlcyBvZiB0aGUgYWNjb3VudHMgKG9yIGNvbnRyYWN0cykgdGhhdCBjYW4gZXhlY3V0ZSBhY3Rpb25zIHdpdGhpbiBlYWNoIHJvbGVzLgogICAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGN0b0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgb3JhY2xlQWRkcmVzczsKCiAgICAvLyBAZGV2IEtlZXBzIHRyYWNrIHdoZXRoZXIgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4gV2hlbiB0aGF0IGlzIHRydWUsIG1vc3QgYWN0aW9ucyBhcmUgYmxvY2tlZAogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRU8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q0VPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ1RPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNUTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3RvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENUTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlPcmFjbGUoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9yYWNsZUFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNMZXZlbCgpIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjdG9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDRU8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENFTy4KICAgIC8vLyBAcGFyYW0gX25ld0NFTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENFTwogICAgZnVuY3Rpb24gc2V0Q0VPKGFkZHJlc3MgX25ld0NFTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShfbmV3Q0VPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjZW9BZGRyZXNzID0gX25ld0NFTzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDVE8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENUTyBvciBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDVE8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDVE8KICAgIGZ1bmN0aW9uIHNldENUTyhhZGRyZXNzIF9uZXdDVE8pIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjdG9BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICByZXF1aXJlKF9uZXdDVE8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGN0b0FkZHJlc3MgPSBfbmV3Q1RPOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENPTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ09PIG9yIENFTy4KICAgIC8vLyBAcGFyYW0gX25ld0NPTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENPTwogICAgZnVuY3Rpb24gc2V0Q09PKGFkZHJlc3MgX25ld0NPTykgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MKICAgICAgICApOwogICAgICAgIHJlcXVpcmUoX25ld0NPTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyBvcmFjbGUuCiAgICAvLy8gQHBhcmFtIF9uZXdPcmFjbGUgVGhlIGFkZHJlc3Mgb2Ygb3JhY2xlCiAgICBmdW5jdGlvbiBzZXRPcmFjbGUoYWRkcmVzcyBfbmV3T3JhY2xlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGN0b0FkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoX25ld09yYWNsZSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgb3JhY2xlQWRkcmVzcyA9IF9uZXdPcmFjbGU7CiAgICB9CgogICAgLyoqKiBQYXVzYWJsZSBmdW5jdGlvbmFsaXR5IGFkYXB0ZWQgZnJvbSBPcGVuWmVwcGVsaW4gKioqLwoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxsZWQgYnkgYW55ICJDLWxldmVsIiByb2xlIHRvIHBhdXNlIHRoZSBjb250cmFjdC4gVXNlZCBvbmx5IHdoZW4KICAgIC8vLyAgYSBidWcgb3IgZXhwbG9pdCBpcyBkZXRlY3RlZCBhbmQgd2UgbmVlZCB0byBsaW1pdCBkYW1hZ2UuCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBVbnBhdXNlcyB0aGUgc21hcnQgY29udHJhY3QuIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQ0VPLCBzaW5jZQogICAgLy8vICBvbmUgcmVhc29uIHdlIG1heSBwYXVzZSB0aGUgY29udHJhY3QgaXMgd2hlbiBDVE8gYWNjb3VudCBpcyBjb21wcm9taXNlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIGl0IGNhbiBiZSBjYWxsZWQgYnkKICAgIC8vLyAgZGVyaXZlZCBjb250cmFjdHMuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgLy8gY2FuJ3QgdW5wYXVzZSBpZiBjb250cmFjdCB3YXMgdXBncmFkZWQKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KCn0KCgoKCgoKCgoKCgovLy8gQHRpdGxlIFN0b3JhZ2UgY29udHJhY3QgZm9yIEV0aGVybmF1dHMgRGF0YS4gQ29tbW9uIHN0cnVjdHMgYW5kIGNvbnN0YW50cy4KLy8vIEBub3RpY2UgVGhpcyBpcyBvdXIgbWFpbiBkYXRhIHN0b3JhZ2UsIGNvbnN0YW50cyBhbmQgZGF0YSB0eXBlcywgcGx1cwovLyAgICAgICAgICBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIHRoZSBhc3NldHMuIEl0IGlzIGlzb2xhdGVkIGFuZCBvbmx5IGludGVyZmFjZSB3aXRoCi8vICAgICAgICAgIGEgbGlzdCBvZiBncmFudGVkIGNvbnRyYWN0cyBkZWZpbmVkIGJ5IENUTwovLy8gQGF1dGhvciBFdGhlcm5hdXRzIC0gRmVybmFuZG8gUGF1ZXIKY29udHJhY3QgRXRoZXJuYXV0c1N0b3JhZ2UgaXMgRXRoZXJuYXV0c0FjY2Vzc0NvbnRyb2wgewoKICAgIGZ1bmN0aW9uIEV0aGVybmF1dHNTdG9yYWdlKCkgcHVibGljIHsKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0VPCiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDVE8gYXMgd2VsbAogICAgICAgIGN0b0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ1RPIGFzIHdlbGwKICAgICAgICBjb29BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIE9yYWNsZSBhcyB3ZWxsCiAgICAgICAgb3JhY2xlQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTm8gdGlwcGluZyEKICAgIC8vLyBAZGV2IFJlamVjdCBhbGwgRXRoZXIgZnJvbSBiZWluZyBzZW50IGhlcmUuIEhvcGVmdWxseSwgd2UgY2FuIHByZXZlbnQgdXNlciBhY2NpZGVudHMuCiAgICBmdW5jdGlvbigpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICAvKioqIE1hcHBpbmcgZm9yIENvbnRyYWN0cyB3aXRoIGdyYW50ZWQgcGVybWlzc2lvbiAqKiovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBjb250cmFjdHNHcmFudGVkQWNjZXNzOwoKICAgIC8vLyBAZGV2IGdyYW50IGFjY2VzcyBmb3IgYSBjb250cmFjdCB0byBpbnRlcmFjdCB3aXRoIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgVGhlIGNvbnRyYWN0IGFkZHJlc3MgdG8gZ3JhbnQgYWNjZXNzCiAgICBmdW5jdGlvbiBncmFudEFjY2VzcyhhZGRyZXNzIF92MkFkZHJlc3MpIHB1YmxpYyBvbmx5Q1RPIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgY29udHJhY3RzR3JhbnRlZEFjY2Vzc1tfdjJBZGRyZXNzXSA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgcmVtb3ZlIGFjY2VzcyBmcm9tIGEgY29udHJhY3QgdG8gaW50ZXJhY3Qgd2l0aCB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdjJBZGRyZXNzIFRoZSBjb250cmFjdCBhZGRyZXNzIHRvIGJlIHJlbW92ZWQKICAgIGZ1bmN0aW9uIHJlbW92ZUFjY2VzcyhhZGRyZXNzIF92MkFkZHJlc3MpIHB1YmxpYyBvbmx5Q1RPIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgZGVsZXRlIGNvbnRyYWN0c0dyYW50ZWRBY2Nlc3NbX3YyQWRkcmVzc107CiAgICB9CgogICAgLy8vIEBkZXYgT25seSBhbGxvdyBwZXJtaXR0ZWQgY29udHJhY3RzIHRvIGludGVyYWN0IHdpdGggdGhpcyBjb250cmFjdAogICAgbW9kaWZpZXIgb25seUdyYW50ZWRDb250cmFjdHMoKSB7CiAgICAgICAgcmVxdWlyZShjb250cmFjdHNHcmFudGVkQWNjZXNzW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRBc3NldCh1aW50MjU2IF90b2tlbklkKSB7CiAgICAgICAgcmVxdWlyZShhc3NldHNbX3Rva2VuSWRdLklEID4gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIC8qKiogREFUQSBUWVBFUyAqKiovCgogICAgLy8vIEBkZXYgVGhlIG1haW4gRXRoZXJuYXV0cyBhc3NldCBzdHJ1Y3QuIEV2ZXJ5IGFzc2V0IGluIEV0aGVybmF1dHMgaXMgcmVwcmVzZW50ZWQgYnkgYSBjb3B5CiAgICAvLy8gIG9mIHRoaXMgc3RydWN0dXJlLiBOb3RlIHRoYXQgdGhlIG9yZGVyIG9mIHRoZSBtZW1iZXJzIGluIHRoaXMgc3RydWN0dXJlCiAgICAvLy8gIGlzIGltcG9ydGFudCBiZWNhdXNlIG9mIHRoZSBieXRlLXBhY2tpbmcgcnVsZXMgdXNlZCBieSBFdGhlcmV1bS4KICAgIC8vLyAgUmVmOiBodHRwOi8vc29saWRpdHkucmVhZHRoZWRvY3MuaW8vZW4vZGV2ZWxvcC9taXNjZWxsYW5lb3VzLmh0bWwKICAgIHN0cnVjdCBBc3NldCB7CgogICAgICAgIC8vIEFzc2V0IElEIGlzIGEgaWRlbnRpZmllciBmb3IgbG9vayBhbmQgZmVlbCBpbiBmcm9udGVuZAogICAgICAgIHVpbnQxNiBJRDsKCiAgICAgICAgLy8gQ2F0ZWdvcnkgPSBTZWN0b3JzLCBNYW51ZmFjdHVyZXJzLCBTaGlwcywgT2JqZWN0cyAoVXBncmFkZXMvTWlzYyksIEZhY3RvcmllcyBhbmQgQ3Jld01lbWJlcnMKICAgICAgICB1aW50OCBjYXRlZ29yeTsKCiAgICAgICAgLy8gVGhlIFN0YXRlIG9mIGFuIGFzc2V0OiBBdmFpbGFibGUsIE9uIHNhbGUsIFVwIGZvciBsZWFzZSwgQ29vbGRvd24sIEV4cGxvcmluZwogICAgICAgIHVpbnQ4IHN0YXRlOwoKICAgICAgICAvLyBBdHRyaWJ1dGVzCiAgICAgICAgLy8gYnl0ZSBwb3MgLSBEZWZpbml0aW9uCiAgICAgICAgLy8gMDAwMDAwMDEgLSBTZWVkZWQgLSBPZmZlcmVkIHRvIHRoZSBlY29ub215IGJ5IHVzLCB0aGUgZGV2ZWxvcGVycy4gUG90ZW50aWFsbHkgYXQgcmVndWxhciBpbnRlcnZhbHMuCiAgICAgICAgLy8gMDAwMDAwMTAgLSBQcm9kdWNpYmxlIC0gUHJvZHVjdCBvZiBhIGZhY3RvcnkgYW5kL29yIGZhY3RvcnkgY29udHJhY3QuCiAgICAgICAgLy8gMDAwMDAxMDAgLSBFeHBsb3JhYmxlLSBQcm9kdWN0IG9mIGV4cGxvcmF0aW9uLgogICAgICAgIC8vIDAwMDAxMDAwIC0gTGVhc2FibGUgLSBDYW4gYmUgcmVudGVkIHRvIG90aGVyIHVzZXJzIGFuZCB3aWxsIHJldHVybiB0byB0aGUgb3JpZ2luYWwgb3duZXIgb25jZSB0aGUgYWN0aW9uIGlzIGNvbXBsZXRlLgogICAgICAgIC8vIDAwMDEwMDAwIC0gUGVybWFuZW50IC0gQ2Fubm90IGJlIHJlbW92ZWQsIGFsd2F5cyBvd25lZCBieSBhIHVzZXIuCiAgICAgICAgLy8gMDAxMDAwMDAgLSBDb25zdW1hYmxlIC0gRGVzdHJveWVkIGFmdGVyIE4gZXhwbG9yYXRpb24gZXhwZWRpdGlvbnMuCiAgICAgICAgLy8gMDEwMDAwMDAgLSBUcmFkYWJsZSAtIEJ1eWFibGUgYW5kIHNlbGxhYmxlIG9uIHRoZSBtYXJrZXQuCiAgICAgICAgLy8gMTAwMDAwMDAgLSBIb3QgUG90YXRvIC0gQXV0b21hdGljYWxseSBnZXRzIHB1dCB1cCBmb3Igc2FsZSBhZnRlciBhY3F1aXJpbmcuCiAgICAgICAgYnl0ZXMyIGF0dHJpYnV0ZXM7CgogICAgICAgIC8vIFRoZSB0aW1lc3RhbXAgZnJvbSB0aGUgYmxvY2sgd2hlbiB0aGlzIGFzc2V0IHdhcyBjcmVhdGVkLgogICAgICAgIHVpbnQ2NCBjcmVhdGVkQXQ7CgogICAgICAgIC8vIFRoZSBtaW5pbXVtIHRpbWVzdGFtcCBhZnRlciB3aGljaCB0aGlzIGFzc2V0IGNhbiBlbmdhZ2UgaW4gZXhwbG9yaW5nIGFjdGl2aXRpZXMgYWdhaW4uCiAgICAgICAgdWludDY0IGNvb2xkb3duRW5kQmxvY2s7CgogICAgICAgIC8vIFRoZSBBc3NldCdzIHN0YXRzIGNhbiBiZSB1cGdyYWRlZCBvciBjaGFuZ2VkIGJhc2VkIG9uIGV4cGxvcmF0aW9uIGNvbmRpdGlvbnMuCiAgICAgICAgLy8gSXQgd2lsbCBiZSBkZWZpbmVkIHBlciBjaGlsZCBjb250cmFjdCwgYnV0IGFsbCBzdGF0cyBoYXZlIGEgcmFuZ2UgZnJvbSAwIHRvIDI1NQogICAgICAgIC8vIEV4YW1wbGVzCiAgICAgICAgLy8gMCA9IFNoaXAgTGV2ZWwKICAgICAgICAvLyAxID0gU2hpcCBBdHRhY2sKICAgICAgICB1aW50OFtTVEFUU19TSVpFXSBzdGF0czsKCiAgICAgICAgLy8gU2V0IHRvIHRoZSBjb29sZG93biB0aW1lIHRoYXQgcmVwcmVzZW50cyBleHBsb3JhdGlvbiBkdXJhdGlvbiBmb3IgdGhpcyBhc3NldC4KICAgICAgICAvLyBEZWZpbmVkIGJ5IGEgc3VjY2Vzc2Z1bCBleHBsb3JhdGlvbiBhY3Rpb24sIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGlzIGFzc2V0IGlzIGFjdGluZyBhcyBzaGlwIG9yIGEgcGFydC4KICAgICAgICB1aW50MjU2IGNvb2xkb3duOwoKICAgICAgICAvLyBhIHJlZmVyZW5jZSB0byBhIHN1cGVyIGFzc2V0IHRoYXQgbWFudWZhY3R1cmVkIHRoZSBhc3NldAogICAgICAgIHVpbnQyNTYgYnVpbHRCeTsKICAgIH0KCiAgICAvKioqIENPTlNUQU5UUyAqKiovCgogICAgLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IHN0b3JhZ2UgY29udHJhY3QgaW4gb3VyIEV0aGVybmF1dHNMb2dpYyhhZGRyZXNzIF9DU3RvcmFnZUFkZHJlc3MpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc0V0aGVybmF1dHNTdG9yYWdlID0gdHJ1ZTsKCiAgICAvKioqIFNUT1JBR0UgKioqLwoKICAgIC8vLyBAZGV2IEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIEFzc2V0IHN0cnVjdCBmb3IgYWxsIGFzc2V0cyBpbiBleGlzdGVuY2UuIFRoZSBBc3NldCBVbmlxdWVJZAogICAgLy8vICBvZiBlYWNoIGFzc2V0IGlzIGFjdHVhbGx5IGFuIGluZGV4IGludG8gdGhpcyBhcnJheS4KICAgIEFzc2V0W10gcHVibGljIGFzc2V0czsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBBc3NldCBVbmlxdWVJRHMgdG8gdGhlIHByaWNlIG9mIHRoZSB0b2tlbi4KICAgIC8vLyBzdG9yZWQgb3V0c2lkZSBBc3NldCBTdHJ1Y3QgdG8gc2F2ZSBnYXMsIGJlY2F1c2UgcHJpY2UgY2FuIGNoYW5nZSBmcmVxdWVudGx5CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIGludGVybmFsIGFzc2V0SW5kZXhUb1ByaWNlOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIGFzc2V0IFVuaXF1ZUlEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4gQWxsIGFzc2V0cyBoYXZlIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaW50ZXJuYWwgYXNzZXRJbmRleFRvT3duZXI7CgogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgIC8vICBVc2VkIGludGVybmFsbHkgaW5zaWRlIGJhbGFuY2VPZigpIHRvIHJlc29sdmUgb3duZXJzaGlwIGNvdW50LgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBpbnRlcm5hbCBvd25lcnNoaXBUb2tlbkNvdW50OwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIEFzc2V0VW5pcXVlSURzIHRvIGFuIGFkZHJlc3MgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCB0byBjYWxsCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBFYWNoIEFzc2V0IGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRyYW5zZmVyCiAgICAvLy8gIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGludGVybmFsIGFzc2V0SW5kZXhUb0FwcHJvdmVkOwoKCiAgICAvKioqIFNFVFRFUlMgKioqLwoKICAgIC8vLyBAZGV2IHNldCBuZXcgYXNzZXQgcHJpY2UKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgIGFzc2V0IFVuaXF1ZUlkCiAgICAvLy8gQHBhcmFtIF9wcmljZSAgICBhc3NldCBwcmljZQogICAgZnVuY3Rpb24gc2V0UHJpY2UodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfcHJpY2UpIHB1YmxpYyBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRJbmRleFRvUHJpY2VbX3Rva2VuSWRdID0gX3ByaWNlOwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmsgdHJhbnNmZXIgYXMgYXBwcm92ZWQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgIGFzc2V0IFVuaXF1ZUlkCiAgICAvLy8gQHBhcmFtIF9hcHByb3ZlZCBhZGRyZXNzIGFwcHJvdmVkCiAgICBmdW5jdGlvbiBhcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBwdWJsaWMgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIEFzc2V0IHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tICAgIGN1cnJlbnQgb3duZXIgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfdG8gICAgICBuZXcgb3duZXIgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgLy8gU2luY2UgdGhlIG51bWJlciBvZiBhc3NldHMgaXMgY2FwcGVkIHRvIDJeMzIgd2UgY2FuJ3Qgb3ZlcmZsb3cgdGhpcwogICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX3RvXSsrOwogICAgICAgIC8vIHRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgIGFzc2V0SW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKICAgICAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyBhc3NldHMgX2Zyb20gaXMgMHgwLCBidXQgd2UgY2FuJ3QgYWNjb3VudCB0aGF0IGFkZHJlc3MuCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgLy8gY2xlYXIgYW55IHByZXZpb3VzbHkgYXBwcm92ZWQgb3duZXJzaGlwIGV4Y2hhbmdlCiAgICAgICAgICAgIGRlbGV0ZSBhc3NldEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEEgcHVibGljIG1ldGhvZCB0aGF0IGNyZWF0ZXMgYSBuZXcgYXNzZXQgYW5kIHN0b3JlcyBpdC4gVGhpcwogICAgLy8vICBtZXRob2QgZG9lcyBiYXNpYyBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gb3RoZXIgY29udHJhY3Qgd2hlbiB0aGUKICAgIC8vLyAgaW5wdXQgZGF0YSBpcyBrbm93biB0byBiZSB2YWxpZC4gV2lsbCBOT1QgZ2VuZXJhdGUgYW55IGV2ZW50IGl0IGlzIGRlbGVnYXRlIHRvIGJ1c2luZXNzIGxvZ2ljIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX2NyZWF0b3JUb2tlbklEIFRoZSBhc3NldCB3aG8gaXMgZmF0aGVyIG9mIHRoaXMgYXNzZXQKICAgIC8vLyBAcGFyYW0gX293bmVyIEZpcnN0IG93bmVyIG9mIHRoaXMgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9JRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdGUgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBjcmVhdGVBc3NldCgKICAgICAgICB1aW50MjU2IF9jcmVhdG9yVG9rZW5JRCwKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICB1aW50MTYgX0lELAogICAgICAgIHVpbnQ4IF9jYXRlZ29yeSwKICAgICAgICB1aW50OCBfc3RhdGUsCiAgICAgICAgdWludDggX2F0dHJpYnV0ZXMsCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gX3N0YXRzLAogICAgICAgIHVpbnQyNTYgX2Nvb2xkb3duLAogICAgICAgIHVpbnQ2NCBfY29vbGRvd25FbmRCbG9jawogICAgKQogICAgcHVibGljIG9ubHlHcmFudGVkQ29udHJhY3RzCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfSUQgPiAwKTsKICAgICAgICByZXF1aXJlKF9jYXRlZ29yeSA+IDApOwogICAgICAgIHJlcXVpcmUoX2F0dHJpYnV0ZXMgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9zdGF0cy5sZW5ndGggPiAwKTsKCiAgICAgICAgQXNzZXQgbWVtb3J5IGFzc2V0ID0gQXNzZXQoewogICAgICAgICAgICBJRDogX0lELAogICAgICAgICAgICBjYXRlZ29yeTogX2NhdGVnb3J5LAogICAgICAgICAgICBidWlsdEJ5OiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGJ5dGVzMihfYXR0cmlidXRlcyksCiAgICAgICAgICAgIHN0YXRzOiBfc3RhdHMsCiAgICAgICAgICAgIHN0YXRlOiBfc3RhdGUsCiAgICAgICAgICAgIGNyZWF0ZWRBdDogdWludDY0KG5vdyksCiAgICAgICAgICAgIGNvb2xkb3duRW5kQmxvY2s6IF9jb29sZG93bkVuZEJsb2NrLAogICAgICAgICAgICBjb29sZG93bjogX2Nvb2xkb3duCiAgICAgICAgICAgIH0pOwoKICAgICAgICB1aW50MjU2IG5ld0Fzc2V0VW5pcXVlSWQgPSBhc3NldHMucHVzaChhc3NldCkgLSAxOwoKICAgICAgICAvLyBDaGVjayBpdCByZWFjaGVkIDQgYmlsbGlvbiBhc3NldHMgYnV0IGxldCdzIGp1c3QgYmUgMTAwJSBzdXJlLgogICAgICAgIHJlcXVpcmUobmV3QXNzZXRVbmlxdWVJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdBc3NldFVuaXF1ZUlkKSkpOwoKICAgICAgICAvLyBzdG9yZSBwcmljZQogICAgICAgIGFzc2V0SW5kZXhUb1ByaWNlW25ld0Fzc2V0VW5pcXVlSWRdID0gX3ByaWNlOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcAogICAgICAgIHRyYW5zZmVyKGFkZHJlc3MoMCksIF9vd25lciwgbmV3QXNzZXRVbmlxdWVJZCk7CgogICAgICAgIHJldHVybiBuZXdBc3NldFVuaXF1ZUlkOwogICAgfQoKICAgIC8vLyBAZGV2IEEgcHVibGljIG1ldGhvZCB0aGF0IGVkaXQgYXNzZXQgaW4gY2FzZSBvZiBhbnkgbWlzdGFrZSBpcyBkb25lIGR1cmluZyBwcm9jZXNzIG9mIGNyZWF0aW9uIGJ5IHRoZSBkZXZlbG9wZXIuIFRoaXMKICAgIC8vLyBUaGlzIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSB0b2tlbiBJRAogICAgLy8vIEBwYXJhbSBfY3JlYXRvclRva2VuSUQgVGhlIGFzc2V0IHRoYXQgY3JlYXRlIHRoYXQgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9JRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdGUgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9jb29sZG93biBhc3NldCBjb29sZG93biBpbmRleAogICAgZnVuY3Rpb24gZWRpdEFzc2V0KAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDE2IF9JRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX3N0YXRlLAogICAgICAgIHVpbnQ4IF9hdHRyaWJ1dGVzLAogICAgICAgIHVpbnQ4W1NUQVRTX1NJWkVdIF9zdGF0cywKICAgICAgICB1aW50MTYgX2Nvb2xkb3duCiAgICApCiAgICBleHRlcm5hbCB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5Q0xldmVsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfSUQgPiAwKTsKICAgICAgICByZXF1aXJlKF9jYXRlZ29yeSA+IDApOwogICAgICAgIHJlcXVpcmUoX2F0dHJpYnV0ZXMgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9zdGF0cy5sZW5ndGggPiAwKTsKCiAgICAgICAgLy8gc3RvcmUgcHJpY2UKICAgICAgICBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF0gPSBfcHJpY2U7CgogICAgICAgIEFzc2V0IHN0b3JhZ2UgYXNzZXQgPSBhc3NldHNbX3Rva2VuSWRdOwogICAgICAgIGFzc2V0LklEID0gX0lEOwogICAgICAgIGFzc2V0LmNhdGVnb3J5ID0gX2NhdGVnb3J5OwogICAgICAgIGFzc2V0LmJ1aWx0QnkgPSBfY3JlYXRvclRva2VuSUQ7CiAgICAgICAgYXNzZXQuYXR0cmlidXRlcyA9IGJ5dGVzMihfYXR0cmlidXRlcyk7CiAgICAgICAgYXNzZXQuc3RhdHMgPSBfc3RhdHM7CiAgICAgICAgYXNzZXQuc3RhdGUgPSBfc3RhdGU7CiAgICAgICAgYXNzZXQuY29vbGRvd24gPSBfY29vbGRvd247CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlIG9ubHkgc3RhdHMKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX3N0YXRzIGFzc2V0IHN0YXRlLCBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiB1cGRhdGVTdGF0cyh1aW50MjU2IF90b2tlbklkLCB1aW50OFtTVEFUU19TSVpFXSBfc3RhdHMpIHB1YmxpYyB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5zdGF0cyA9IF9zdGF0czsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGUgb25seSBhc3NldCBzdGF0ZQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfc3RhdGUgYXNzZXQgc3RhdGUsIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQ4IF9zdGF0ZSkgcHVibGljIHZhbGlkQXNzZXQoX3Rva2VuSWQpIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICBhc3NldHNbX3Rva2VuSWRdLnN0YXRlID0gX3N0YXRlOwogICAgfQoKICAgIC8vLyBAZGV2IFVwZGF0ZSBDb29sZG93biBmb3IgYSBzaW5nbGUgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX2Nvb2xkb3duIGFzc2V0IHN0YXRlLCBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBzZXRBc3NldENvb2xkb3duKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2Nvb2xkb3duLCB1aW50NjQgX2Nvb2xkb3duRW5kQmxvY2spCiAgICBwdWJsaWMgdmFsaWRBc3NldChfdG9rZW5JZCkgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0c1tfdG9rZW5JZF0uY29vbGRvd24gPSBfY29vbGRvd247CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5jb29sZG93bkVuZEJsb2NrID0gX2Nvb2xkb3duRW5kQmxvY2s7CiAgICB9CgogICAgLyoqKiBHRVRURVJTICoqKi8KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIG9ubHkgc3RhdHMgZGF0YSBhYm91dCBhIHNwZWNpZmljIGFzc2V0LgogICAgLy8vIEBkZXYgaXQgaXMgbmVjZXNzYXJ5IGR1ZSBzb2xpZGl0eSBjb21waWxlciBsaW1pdGF0aW9ucwogICAgLy8vICAgICAgd2hlbiB3ZSBoYXZlIGxhcmdlIHF0eSBvZiBwYXJhbWV0ZXJzIGl0IHRocm93cyBTdGFja1Rvb0RlZXBFeGNlcHRpb24KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldFN0YXRzKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4W1NUQVRTX1NJWkVdKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uc3RhdHM7CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJuIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXNzZXQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIGZ1bmN0aW9uIHByaWNlT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBwcmljZSkgewogICAgICAgIHJldHVybiBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaGFzIGFsbCBhdHRyaWJ1dGVzIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gaGFzQWxsQXR0cnModWludDI1NiBfdG9rZW5JZCwgYnl0ZXMyIF9hdHRyaWJ1dGVzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uYXR0cmlidXRlcyAmIF9hdHRyaWJ1dGVzID09IF9hdHRyaWJ1dGVzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGFzc2V0IGhhcyBhbnkgYXR0cmlidXRlIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gaGFzQW55QXR0cnModWludDI1NiBfdG9rZW5JZCwgYnl0ZXMyIF9hdHRyaWJ1dGVzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uYXR0cmlidXRlcyAmIF9hdHRyaWJ1dGVzICE9IDB4MDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVjayBpZiBhc3NldCBpcyBpbiB0aGUgc3RhdGUgcGFzc2VkIGJ5IHBhcmFtZXRlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0Q2F0ZWdvcnkgaW4gRXRoZXJuYXV0c0Jhc2UgZm9yIHBvc3NpYmxlIHN0YXRlcwogICAgZnVuY3Rpb24gaXNDYXRlZ29yeSh1aW50MjU2IF90b2tlbklkLCB1aW50OCBfY2F0ZWdvcnkpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5jYXRlZ29yeSA9PSBfY2F0ZWdvcnk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaXMgaW4gdGhlIHN0YXRlIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX3N0YXRlIHNlZSBlbnVtIEFzc2V0U3RhdGUgaW4gRXRoZXJuYXV0c0Jhc2UgZm9yIHBvc3NpYmxlIHN0YXRlcwogICAgZnVuY3Rpb24gaXNTdGF0ZSh1aW50MjU2IF90b2tlbklkLCB1aW50OCBfc3RhdGUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5zdGF0ZSA9PSBfc3RhdGU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBvd25lciBvZiBhIGdpdmVuIEFzc2V0KFRva2VuKS4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgcmV0dXJuIGFzc2V0SW5kZXhUb093bmVyW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgQXNzZXRzIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIEFzc2V0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgZnVuY3Rpb24gYXBwcm92ZWRGb3IodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgb25seUdyYW50ZWRDb250cmFjdHMgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhc3NldEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIEFzc2V0cyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhc3NldHMubGVuZ3RoOwogICAgfQoKICAgIC8vLyBAbm90aWNlIExpc3QgYWxsIGV4aXN0aW5nIHRva2Vucy4gSXQgY2FuIGJlIGZpbHRlcmVkIGJ5IGF0dHJpYnV0ZXMgb3IgYXNzZXRzIHdpdGggb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGZpbHRlciBhbGwgYXNzZXRzIGJ5IG93bmVyCiAgICBmdW5jdGlvbiBnZXRUb2tlbkxpc3QoYWRkcmVzcyBfb3duZXIsIHVpbnQ4IF93aXRoQXR0cmlidXRlcywgdWludDI1NiBzdGFydCwgdWludDI1NiBjb3VudCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKAogICAgICAgIHVpbnQyNTZbNl1bXQogICAgKSB7CiAgICAgICAgdWludDI1NiB0b3RhbEFzc2V0cyA9IGFzc2V0cy5sZW5ndGg7CgogICAgICAgIGlmICh0b3RhbEFzc2V0cyA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbNl1bXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2WzZdW10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2WzZdW10odG90YWxBc3NldHMgPiBjb3VudCA/IGNvdW50IDogdG90YWxBc3NldHMpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKICAgICAgICAgICAgYnl0ZXMyIGhhc0F0dHJpYnV0ZXMgID0gYnl0ZXMyKF93aXRoQXR0cmlidXRlcyk7CiAgICAgICAgICAgIEFzc2V0IG1lbW9yeSBhc3NldDsKCiAgICAgICAgICAgIGZvciAodWludDI1NiB0b2tlbklkID0gc3RhcnQ7IHRva2VuSWQgPCB0b3RhbEFzc2V0cyAmJiByZXN1bHRJbmRleCA8IGNvdW50OyB0b2tlbklkKyspIHsKICAgICAgICAgICAgICAgIGFzc2V0ID0gYXNzZXRzW3Rva2VuSWRdOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIChhc3NldC5zdGF0ZSAhPSB1aW50OChBc3NldFN0YXRlLlVzZWQpKSAmJgogICAgICAgICAgICAgICAgICAgIChhc3NldEluZGV4VG9Pd25lclt0b2tlbklkXSA9PSBfb3duZXIgfHwgX293bmVyID09IGFkZHJlc3MoMCkpICYmCiAgICAgICAgICAgICAgICAgICAgKGFzc2V0LmF0dHJpYnV0ZXMgJiBoYXNBdHRyaWJ1dGVzID09IGhhc0F0dHJpYnV0ZXMpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzBdID0gdG9rZW5JZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzFdID0gYXNzZXQuSUQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XVsyXSA9IGFzc2V0LmNhdGVnb3J5OwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bM10gPSB1aW50MjU2KGFzc2V0LmF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bNF0gPSBhc3NldC5jb29sZG93bjsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzVdID0gYXNzZXRJbmRleFRvUHJpY2VbdG9rZW5JZF07CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9Cn0KCi8vLyBAdGl0bGUgVGhlIGZhY2V0IG9mIHRoZSBFdGhlcm5hdXRzIGNvbnRyYWN0IHRoYXQgbWFuYWdlcyBvd25lcnNoaXAsIEVSQy03MjEgY29tcGxpYW50LgovLy8gQG5vdGljZSBUaGlzIHByb3ZpZGVzIHRoZSBtZXRob2RzIHJlcXVpcmVkIGZvciBiYXNpYyBub24tZnVuZ2libGUgdG9rZW4KLy8gICAgICAgICAgdHJhbnNhY3Rpb25zLCBmb2xsb3dpbmcgdGhlIGRyYWZ0IEVSQy03MjEgc3BlYyAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkuCi8vICAgICAgICAgIEl0IGludGVyZmFjZXMgd2l0aCBFdGhlcm5hdXRzU3RvcmFnZSBwcm92aW5kaW5nIGJhc2ljIGZ1bmN0aW9ucyBhcyBjcmVhdGUgYW5kIGxpc3QsIGFsc28gaG9sZHMKLy8gICAgICAgICAgcmVmZXJlbmNlIHRvIGxvZ2ljIGNvbnRyYWN0cyBhcyBBdWN0aW9uLCBFeHBsb3JlIGFuZCBzbyBvbgovLy8gQGF1dGhvciBFdGhlcm5hdHVzIC0gRmVybmFuZG8gUGF1ZXIKLy8vIEBkZXYgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCmNvbnRyYWN0IEV0aGVybmF1dHNPd25lcnNoaXAgaXMgRXRoZXJuYXV0c0FjY2Vzc0NvbnRyb2wsIEVSQzcyMSB7CgogICAgLy8vIEBkZXYgQ29udHJhY3QgaG9sZGluZyBvbmx5IGRhdGEuCiAgICBFdGhlcm5hdXRzU3RvcmFnZSBwdWJsaWMgZXRoZXJuYXV0c1N0b3JhZ2U7CgogICAgLyoqKiBDT05TVEFOVFMgKioqLwogICAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkV0aGVybmF1dHMiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRVROVCI7CgogICAgLyoqKioqKioqKiBFUkMgNzIxIC0gQ09NUExJQU5DRSBDT05TVEFOVFMgQU5EIEZVTkNUSU9OUyAqKioqKioqKioqKioqKiovCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9IGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogICAgLyoqKiBFVkVOVFMgKioqLwoKICAgIC8vIEV2ZW50cyBhcyBwZXIgRVJDLTcyMQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB0b2tlbnMpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5zKTsKCiAgICAvLy8gQGRldiBXaGVuIGEgbmV3IGFzc2V0IGlzIGNyZWF0ZSBpdCBlbWl0cyBidWlsZCBldmVudAogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiBhc3NldCBvd25lcgogICAgLy8vIEBwYXJhbSB0b2tlbklkIEFzc2V0IFVuaXF1ZUlECiAgICAvLy8gQHBhcmFtIGFzc2V0SWQgSUQgdGhhdCBkZWZpbmVzIGFzc2V0IGxvb2sgYW5kIGZlZWwKICAgIC8vLyBAcGFyYW0gcHJpY2UgYXNzZXQgcHJpY2UKICAgIGV2ZW50IEJ1aWxkKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgdG9rZW5JZCwgdWludDE2IGFzc2V0SWQsIHVpbnQyNTYgcHJpY2UpOwoKICAgIGZ1bmN0aW9uIGltcGxlbWVudHNFUkM3MjEoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSW50cm9zcGVjdGlvbiBpbnRlcmZhY2UgYXMgcGVyIEVSQy0xNjUgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpLgogICAgLy8vICBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LiBFUkMtMTY1IGFuZCBFUkMtNzIxLgogICAgLy8vIEBwYXJhbSBfaW50ZXJmYWNlSUQgaW50ZXJmYWNlIHNpZ25hdHVyZSBJRAogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGlzIHRoZSBjdXJyZW50IG93bmVyIG9mIGEgcGFydGljdWxhciBBc3NldC4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSB2YWxpZGF0aW5nIGFnYWluc3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIEFzc2V0LgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIGNvbmZpcm1pbmcgYXNzZXQgaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZXRoZXJuYXV0c1N0b3JhZ2UuYXBwcm92ZWRGb3IoX3Rva2VuSWQpID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBNYXJrcyBhbiBhZGRyZXNzIGFzIGJlaW5nIGFwcHJvdmVkIGZvciB0cmFuc2ZlckZyb20oKSwgb3ZlcndyaXRpbmcgYW55IHByZXZpb3VzCiAgICAvLy8gIGFwcHJvdmFsLiBTZXR0aW5nIF9hcHByb3ZlZCB0byBhZGRyZXNzKDApIGNsZWFycyBhbGwgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAvLy8gIE5PVEU6IF9hcHByb3ZlKCkgZG9lcyBOT1Qgc2VuZCB0aGUgQXBwcm92YWwgZXZlbnQuIFRoaXMgaXMgaW50ZW50aW9uYWwgYmVjYXVzZQogICAgLy8vICBfYXBwcm92ZSgpIGFuZCB0cmFuc2ZlckZyb20oKSBhcmUgdXNlZCB0b2dldGhlciBmb3IgcHV0dGluZyBBc3NldHMgb24gYXVjdGlvbiwgYW5kCiAgICAvLy8gIHRoZXJlIGlzIG5vIHZhbHVlIGluIHNwYW1taW5nIHRoZSBsb2cgd2l0aCBBcHByb3ZhbCBldmVudHMgaW4gdGhhdCBjYXNlLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIGludGVybmFsIHsKICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS5hcHByb3ZlKF90b2tlbklkLCBfYXBwcm92ZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBBc3NldHMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gZXRoZXJuYXV0c1N0b3JhZ2UuYmFsYW5jZU9mKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBhIEFzc2V0IHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvIGEgc21hcnQKICAgIC8vLyAgY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEgKG9yCiAgICAvLy8gIEV0aGVybmF1dHMgc3BlY2lmaWNhbGx5KSBvciB5b3VyIEFzc2V0IG1heSBiZSBsb3N0IGZvcmV2ZXIuIFNlcmlvdXNseS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgQXNzZXQgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBhc3NldHMKICAgICAgICAvLyAoZXhjZXB0IHZlcnkgYnJpZWZseSBhZnRlciBpdCBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhlIHN0b3JhZ2UgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIG9yIFVwZ3JhZGUgY29udHJhY3RzIHNob3VsZCBvbmx5IHRha2Ugb3duZXJzaGlwIG9mIGFzc2V0cwogICAgICAgIC8vIHRocm91Z2ggdGhlIGFsbG93ICsgdHJhbnNmZXJGcm9tIGZsb3cuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhldGhlcm5hdXRzU3RvcmFnZSkpOwoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biBhc3NldC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UudHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgYSBzcGVjaWZpYyBBc3NldCB2aWEKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogICAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEFzc2V0IHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBPbmx5IGFuIG93bmVyIGNhbiBncmFudCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBhcHByb3ZhbCAocmVwbGFjaW5nIGFueSBwcmV2aW91cyBhcHByb3ZhbCkuCiAgICAgICAgX2FwcHJvdmUoX3Rva2VuSWQsIF90byk7CgogICAgICAgIC8vIEVtaXQgYXBwcm92YWwgZXZlbnQuCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgQXNzZXQgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcgYWRkcmVzcwogICAgLy8vICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIEFzc2V0IHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIEFzc2V0LiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEFzc2V0IHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGludGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IGFzc2V0cyAoZXhjZXB0IGZvciB1c2VkIGFzc2V0cykuCiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKF90bywgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLnRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBBc3NldCBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZyBhZGRyZXNzCiAgICAvLy8gIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGUgQXNzZXQgdG8gYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBBc3NldC4gQ2FuIGJlIGFueSBhZGRyZXNzLAogICAgLy8vICBpbmNsdWRpbmcgdGhlIGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBBc3NldCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgX3RyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIEFsbG93IHByZS1hcHByb3ZlZCB1c2VyIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CiAgICAgICAgYWRkcmVzcyBfZnJvbSA9IGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpOwoKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfZnJvbSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfdHJhbnNmZXJGcm9tKF9mcm9tLCBtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIEFzc2V0cyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBldGhlcm5hdXRzU3RvcmFnZS50b3RhbFN1cHBseSgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgb3duZXIgb2YgYSBnaXZlbiBBc3NldChUb2tlbikuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRva2VuIElEIHRvIGdldCBvd25lci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgIHsKICAgICAgICBvd25lciA9IGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpOwoKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYSBuZXcgQXNzZXQgd2l0aCB0aGUgZ2l2ZW4gZmllbGRzLiBPTmx5IGF2YWlsYWJsZSBmb3IgQyBMZXZlbHMKICAgIC8vLyBAcGFyYW0gX2NyZWF0b3JUb2tlbklEIFRoZSBhc3NldCB3aG8gaXMgZmF0aGVyIG9mIHRoaXMgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9hc3NldElEIGFzc2V0IElECiAgICAvLy8gQHBhcmFtIF9jYXRlZ29yeSBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9hdHRyaWJ1dGVzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX3N0YXRzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld0Fzc2V0KAogICAgICAgIHVpbnQyNTYgX2NyZWF0b3JUb2tlbklELAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX3ByaWNlLAogICAgICAgIHVpbnQxNiBfYXNzZXRJRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX2F0dHJpYnV0ZXMsCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gX3N0YXRzCiAgICApCiAgICBleHRlcm5hbCBvbmx5Q0xldmVsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIG93bmVyIG11c3QgYmUgc2VuZGVyCiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHVpbnQyNTYgdG9rZW5JRCA9IGV0aGVybmF1dHNTdG9yYWdlLmNyZWF0ZUFzc2V0KAogICAgICAgICAgICBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgX3ByaWNlLAogICAgICAgICAgICBfYXNzZXRJRCwKICAgICAgICAgICAgX2NhdGVnb3J5LAogICAgICAgICAgICB1aW50OChBc3NldFN0YXRlLkF2YWlsYWJsZSksCiAgICAgICAgICAgIF9hdHRyaWJ1dGVzLAogICAgICAgICAgICBfc3RhdHMsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAKICAgICAgICApOwoKICAgICAgICAvLyBlbWl0IHRoZSBidWlsZCBldmVudAogICAgICAgIEJ1aWxkKAogICAgICAgICAgICBfb3duZXIsCiAgICAgICAgICAgIHRva2VuSUQsCiAgICAgICAgICAgIF9hc3NldElELAogICAgICAgICAgICBfcHJpY2UKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdG9rZW5JRDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB2ZXJpZnkgaWYgdG9rZW4gaXMgaW4gZXhwbG9yYXRpb24gdGltZQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVG9rZW4gSUQgdGhhdCBjYW4gYmUgdXBncmFkZWQKICAgIGZ1bmN0aW9uIGlzRXhwbG9yaW5nKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50MjU2IGNvb2xkb3duOwogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwogICAgICAgICgsLCwsLGNvb2xkb3duRW5kQmxvY2ssIGNvb2xkb3duLCkgPSBldGhlcm5hdXRzU3RvcmFnZS5hc3NldHMoX3Rva2VuSWQpOwogICAgICAgIHJldHVybiAoY29vbGRvd24gPiBub3cpIHx8IChjb29sZG93bkVuZEJsb2NrID4gdWludDY0KGJsb2NrLm51bWJlcikpOwogICAgfQp9CgoKLy8gRXh0ZW5kIHRoaXMgbGlicmFyeSBmb3IgY2hpbGQgY29udHJhY3RzCmxpYnJhcnkgU2FmZU1hdGggewoKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAgICovCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICAgKi8KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWF4KGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA+IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWluKGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA8IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKCn0KCi8vLyBAdGl0bGUgVGhlIGZhY2V0IG9mIHRoZSBFdGhlcm5hdXRzIExvZ2ljIGNvbnRyYWN0IGhhbmRsZSBhbGwgY29tbW9uIGNvZGUgZm9yIGxvZ2ljL2J1c2luZXNzIGNvbnRyYWN0cwovLy8gQGF1dGhvciBFdGhlcm5hdHVzIC0gRmVybmFuZG8gUGF1ZXIKY29udHJhY3QgRXRoZXJuYXV0c0xvZ2ljIGlzIEV0aGVybmF1dHNPd25lcnNoaXAgewoKICAgIC8vIFNldCBpbiBjYXNlIHRoZSBsb2dpYyBjb250cmFjdCBpcyBicm9rZW4gYW5kIGFuIHVwZ3JhZGUgaXMgcmVxdWlyZWQKICAgIGFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gRXRoZXJuYXV0c0xvZ2ljKCkgcHVibGljIHsKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0VPLCBDT08sIENUTwogICAgICAgIGNlb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGN0b0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIG9yYWNsZUFkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyBTdGFydHMgcGF1c2VkLgogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVXNlZCB0byBtYXJrIHRoZSBzbWFydCBjb250cmFjdCBhcyB1cGdyYWRlZCwgaW4gY2FzZSB0aGVyZSBpcyBhIHNlcmlvdXMKICAgIC8vLyAgYnJlYWtpbmcgYnVnLiBUaGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcgYnV0IGtlZXAgdHJhY2sgb2YgdGhlIG5ldyBjb250cmFjdCBhbmQKICAgIC8vLyAgZW1pdCBhIG1lc3NhZ2UgaW5kaWNhdGluZyB0aGF0IHRoZSBuZXcgYWRkcmVzcyBpcyBzZXQuIEl0J3MgdXAgdG8gY2xpZW50cyBvZiB0aGlzCiAgICAvLy8gIGNvbnRyYWN0IHRvIHVwZGF0ZSB0byB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MgaW4gdGhhdCBjYXNlLiAoVGhpcyBjb250cmFjdCB3aWxsCiAgICAvLy8gIGJlIHBhdXNlZCBpbmRlZmluaXRlbHkgaWYgc3VjaCBhbiB1cGdyYWRlIHRha2VzIHBsYWNlLikKICAgIC8vLyBAcGFyYW0gX3YyQWRkcmVzcyBuZXcgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpIGV4dGVybmFsIG9ubHlDVE8gd2hlblBhdXNlZCB7CiAgICAgICAgLy8gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgICAgIG5ld0NvbnRyYWN0QWRkcmVzcyA9IF92MkFkZHJlc3M7CiAgICAgICAgQ29udHJhY3RVcGdyYWRlKF92MkFkZHJlc3MpOwogICAgfQoKICAgIC8vLyBAZGV2IHNldCBhIG5ldyByZWZlcmVuY2UgdG8gdGhlIE5GVCBvd25lcnNoaXAgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX0NTdG9yYWdlQWRkcmVzcyAtIGFkZHJlc3Mgb2YgYSBkZXBsb3llZCBjb250cmFjdCBpbXBsZW1lbnRpbmcgRXRoZXJuYXV0c1N0b3JhZ2UuCiAgICBmdW5jdGlvbiBzZXRFdGhlcm5hdXRzU3RvcmFnZUNvbnRyYWN0KGFkZHJlc3MgX0NTdG9yYWdlQWRkcmVzcykgcHVibGljIG9ubHlDTGV2ZWwgd2hlblBhdXNlZCB7CiAgICAgICAgRXRoZXJuYXV0c1N0b3JhZ2UgY2FuZGlkYXRlQ29udHJhY3QgPSBFdGhlcm5hdXRzU3RvcmFnZShfQ1N0b3JhZ2VBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzRXRoZXJuYXV0c1N0b3JhZ2UoKSk7CiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBPdmVycmlkZSB1bnBhdXNlIHNvIGl0IHJlcXVpcmVzIGFsbCBleHRlcm5hbCBjb250cmFjdCBhZGRyZXNzZXMKICAgIC8vLyAgdG8gYmUgc2V0IGJlZm9yZSBjb250cmFjdCBjYW4gYmUgdW5wYXVzZWQuIEFsc28sIHdlIGNhbid0IGhhdmUKICAgIC8vLyAgbmV3Q29udHJhY3RBZGRyZXNzIHNldCBlaXRoZXIsIGJlY2F1c2UgdGhlbiB0aGUgY29udHJhY3Qgd2FzIHVwZ3JhZGVkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gd2UgY2FuIGNhbGwgc3VwZXIudW5wYXVzZQogICAgLy8vICB3aXRob3V0IHVzaW5nIGFuIGV4cGVuc2l2ZSBDQUxMLgogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUoZXRoZXJuYXV0c1N0b3JhZ2UgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShuZXdDb250cmFjdEFkZHJlc3MgPT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gcmVxdWlyZSB0aGlzIGNvbnRyYWN0IHRvIGhhdmUgYWNjZXNzIHRvIHN0b3JhZ2UgY29udHJhY3QKICAgICAgICByZXF1aXJlKGV0aGVybmF1dHNTdG9yYWdlLmNvbnRyYWN0c0dyYW50ZWRBY2Nlc3MoYWRkcmVzcyh0aGlzKSkgPT0gdHJ1ZSk7CgogICAgICAgIC8vIEFjdHVhbGx5IHVucGF1c2UgdGhlIGNvbnRyYWN0LgogICAgICAgIHN1cGVyLnVucGF1c2UoKTsKICAgIH0KCiAgICAvLyBAZGV2IEFsbG93cyB0aGUgQ09PIHRvIGNhcHR1cmUgdGhlIGJhbGFuY2UgYXZhaWxhYmxlIHRvIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZXMoYWRkcmVzcyBfdG8pIHB1YmxpYyBvbmx5Q0xldmVsIHsKICAgICAgICBfdG8udHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gcmV0dXJuIGN1cnJlbnQgY29udHJhY3QgYmFsYW5jZQogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZSgpIHB1YmxpYyB2aWV3IG9ubHlDTGV2ZWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICB9Cn0KCi8vLyBAdGl0bGUgVmVuZGluZ20gbWFjaGluZQovLy8gQG5vdGljZSBUaGlzIHByb3ZpZGVzIHB1YmxpYyBtZXRob2RzIGZvciB2ZW5kaW5nIG1hY2hpbmUgY29udHJhY3QuCi8vLyBAYXV0aG9yIEV0aGVybmF1dHMgLSBGZXJuYW5kbyBQYXVlcgpjb250cmFjdCBFdGhlcm5hdXRzVmVuZGluZ01hY2hpbmUgaXMgRXRoZXJuYXV0c0xvZ2ljIHsKCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciBjcmVhdGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gIGFuZCB2ZXJpZmllcyB0aGUgb3duZXIgY3V0IGlzIGluIHRoZSB2YWxpZCByYW5nZS4KICAgIC8vLyAgYW5kIERlbGVnYXRlIGNvbnN0cnVjdG9yIHRvIE5vbmZ1bmdpYmxlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gRXRoZXJuYXV0c1ZlbmRpbmdNYWNoaW5lKCkgcHVibGljCiAgICBFdGhlcm5hdXRzTG9naWMoKSB7fQoKICAgIC8qKiogRVZFTlRTICoqKi8KICAgIC8vLyBAZGV2IFRoZSBSZWRlZW0gZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBzaGlwIGlzIGNyZWF0ZWQuCiAgICBldmVudCBSZWRlZW0odWludDI1NiBmYWN0b3J5SWQpOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIEZhY3RvcnkgdG8gU2hpcCBJRC4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDE2KSBwdWJsaWMgZmFjdG9yeVRvQXNzZXRJZDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBBc3NldCBJRCB0byBzdGF0cy4KICAgIG1hcHBpbmcgKHVpbnQxNiA9PiB1aW50OFtTVEFUU19TSVpFXSkgcHVibGljIGFzc2V0VG9TdGF0czsKCiAgICAvLy8gQG5vdGljZSBEZWZpbmUgYW4gYXNzZXQgSUQgdG8gYSBmYWN0b3J5CiAgICAvLy8gQHBhcmFtIF9mYWN0b3J5SWQgVGhlIFRva2VuIElEIG9mIGEgZmFjdG9yeQogICAgLy8vIEBwYXJhbSBfYXNzZXRJZCBUaGUgQXNzZXQgSUQKICAgIGZ1bmN0aW9uIHNldEZhY3RvcnlBc3NldCh1aW50MjU2IF9mYWN0b3J5SWQsIHVpbnQxNiBfYXNzZXRJZCkgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgZmFjdG9yeVRvQXNzZXRJZFtfZmFjdG9yeUlkXSA9IF9hc3NldElkOwogICAgfQoKICAgIC8vLyBAbm90aWNlIERlZmluZSBzdGF0cyB0byBhbiBhc3NldAogICAgLy8vIEBwYXJhbSBfYXNzZXRJZCBUaGUgQXNzZXQgSUQKICAgIC8vLyBAcGFyYW0gX3N0YXRzIEFsbCBzdGF0cyBmb3IgYW4gYXNzZXQgSUQKICAgIGZ1bmN0aW9uIHNldEFzc2V0U3RhdHModWludDE2IF9hc3NldElkLCB1aW50OFtTVEFUU19TSVpFXSBfc3RhdHMpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIGFzc2V0VG9TdGF0c1tfYXNzZXRJZF0gPSBfc3RhdHM7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmVkZWVtIGEgbmV3IHNoaXAgZm9yIGZhY3Rvcnkgb3duZXIKICAgIC8vLyBAcGFyYW0gX2ZhY3RvcnlJZCBUaGUgVG9rZW4gSUQgb2YgYSBmYWN0b3J5CiAgICBmdW5jdGlvbiByZWRlZW1TaGlwKHVpbnQyNTYgX2ZhY3RvcnlJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gY2hlY2sgaWYgdG9rZW4gaXMgYSBmYWN0b3J5CiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZS5pc0NhdGVnb3J5KF9mYWN0b3J5SWQsIHVpbnQ4KEFzc2V0Q2F0ZWdvcnkuTWFudWZhY3R1cmVyKSkpOwoKICAgICAgICAvLyBvbmx5IG93bmVyIGNhbiByZWRlZW0gYSBuZXcgc2hpcAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF9mYWN0b3J5SWQpKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoZSBGYWN0b3J5IGlzIGluIGF2YWlsYWJsZSBzdGF0ZSwgb3RoZXJ3aXNlIGl0IGNhbm5vdCByZWRlZW0KICAgICAgICByZXF1aXJlKGV0aGVybmF1dHNTdG9yYWdlLmlzU3RhdGUoX2ZhY3RvcnlJZCwgdWludDgoQXNzZXRTdGF0ZS5BdmFpbGFibGUpKSk7CgogICAgICAgIHVpbnQyNTYgY29vbGRvd247CiAgICAgICAgKCwsLCwsLCBjb29sZG93biwpID0gZXRoZXJuYXV0c1N0b3JhZ2UuYXNzZXRzKF9mYWN0b3J5SWQpOwoKICAgICAgICAvLyBjaGVjayBpZiBsYXN0IHJlZGVlbSBjb29sZG93biBoYXMgYWxyZWFkeSBmaW5pc2hlZAogICAgICAgIHJlcXVpcmUoY29vbGRvd24gPCBub3cpOwoKICAgICAgICAvLyBkZWZpbmUgbmV3IGZhY3RvcnkgY29vbGRvd24KICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS5zZXRBc3NldENvb2xkb3duKF9mYWN0b3J5SWQsIG5vdyArICgyNCAqIDYwICogNjApLCAwKTsgLy8gMjQgaG91cnMKCiAgICAgICAgLy8gcHJvZHVjaW5nIHNoaXAKICAgICAgICB1aW50MTYgYXNzZXRJZCA9IGZhY3RvcnlUb0Fzc2V0SWRbX2ZhY3RvcnlJZF07CiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UuY3JlYXRlQXNzZXQoCiAgICAgICAgICAgIF9mYWN0b3J5SWQsCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIDEwMDAwMDAwMDAwMDAwMDAwLAogICAgICAgICAgICBhc3NldElkLAogICAgICAgICAgICB1aW50OChBc3NldENhdGVnb3J5LlNoaXApLAogICAgICAgICAgICB1aW50OChBc3NldFN0YXRlLkF2YWlsYWJsZSksCiAgICAgICAgICAgIDg5LAogICAgICAgICAgICBhc3NldFRvU3RhdHNbYXNzZXRJZF0sCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAKICAgICAgICApOwoKICAgICAgICAvLyBlbWl0IHRoZSBSZWRlZW0gZXZlbnQKICAgICAgICBSZWRlZW0oX2ZhY3RvcnlJZCk7CiAgICB9Cn0='.
	

]
