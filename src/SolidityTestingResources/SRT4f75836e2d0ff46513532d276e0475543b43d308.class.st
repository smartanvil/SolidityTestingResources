Class {
	#name : #SRT4f75836e2d0ff46513532d276e0475543b43d308,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4f75836e2d0ff46513532d276e0475543b43d308 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBjb3B5cmlnaHQgPHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1MzMwM2MzZDI3MzIzMDI3MTMzNjI3M2IzNjIxMzAzYjM2MjIyNjM2N2QzMDNjM2UiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Cgpjb250cmFjdCBFdGhlckNoZXF1ZSB7CiAgICBlbnVtIFN0YXR1cyB7IE5PTkUsIENSRUFURUQsIExPQ0tFRCwgRVhQSVJFRCwgVVNFRH0KICAgIGVudW0gUmVzdWx0Q29kZSB7IAogICAgICAgIFNVQ0NFU1MsCiAgICAgICAgRVJST1JfTUFYLAogICAgICAgIEVSUk9SX01JTiwKICAgICAgICBFUlJPUl9FWElTVCwKICAgICAgICBFUlJPUl9OT1RfRVhJU1QsCiAgICAgICAgRVJST1JfSU5WQUxJRF9TVEFUVVMsCiAgICAgICAgRVJST1JfTE9DS0VELAogICAgICAgIEVSUk9SX0VYUElSRUQsCiAgICAgICAgRVJST1JfSU5WQUxJRF9BTU9VTlQsCiAgICAgICAgRVJST1JfVVNFRAogICAgfQogICAgc3RydWN0IENoZXF1ZSB7CiAgICAgICAgYnl0ZXMzMiBwaW5IYXNoOyAvLyB3ZSBvbmx5IHNhdmUgc2hhMyBvZiBjaGVxdWUgc2lnbmF0dXJlCiAgICAgICAgYWRkcmVzcyBjcmVhdG9yOwogICAgICAgIFN0YXR1cyBzdGF0dXM7CiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICB1aW50IGNyZWF0ZVRpbWU7CiAgICAgICAgdWludCBleHBpcmluZ1BlcmlvZDsgLy8gaW4gc2Vjb25kcyAtIG9wdGlvbmFsLCAwIG1lYW4gbm8gZXhwaXJlCiAgICAgICAgdWludDggYXR0ZW1wdDsgLy8gY3VycmVudCBhdHRlbXB0IGFjY291bnQgdG8gY2FzaCB0aGUgY2hlcXVlCiAgICB9CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3NbXSBwdWJsaWMgbW9kZXJhdG9yczsKICAgIHVpbnQgcHVibGljIHRvdGFsQ2hlcXVlID0gMDsKICAgIHVpbnQgcHVibGljIHRvdGFsQ2hlcXVlVmFsdWUgPSAwOwogICAgdWludCBwdWJsaWMgdG90YWxSZWRlZW1lZENoZXF1ZSA9IDA7CiAgICB1aW50IHB1YmxpYyB0b3RhbFJlZGVlbWVkVmFsdWUgPSAwOwogICAgdWludCBwdWJsaWMgY29tbWlzc2lvblJhdGUgPSAxMDsgLy8gZGl2IDEwMDAKICAgIHVpbnQgcHVibGljIG1pbkZlZSA9IDAuMDA1IGV0aGVyOwogICAgdWludCBwdWJsaWMgbWluQ2hlcXVlVmFsdWUgPSAwLjAxIGV0aGVyOwogICAgdWludCBwdWJsaWMgbWF4Q2hlcXVlVmFsdWUgPSAwOyAvLyBvcHRpb25hbCwgMCBtZWFuIG5vIGxpbWl0CiAgICB1aW50OCBwdWJsaWMgbWF4QXR0ZW1wdCA9IDM7CiAgICBib29sIHB1YmxpYyBpc01haW50YWluaW5nID0gZmFsc2U7CiAgICAKICAgIC8vIGhhc2ggY2hlcXVlIG5vIC0+IENoZXF1ZSBpbmZvCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gQ2hlcXVlKSBpdGVtczsKCiAgICAvLyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgaXNBY3RpdmUgewogICAgICAgIGlmKGlzTWFpbnRhaW5pbmcgPT0gdHJ1ZSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seU1vZGVyYXRvcnMoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsKICAgICAgICAgICAgYm9vbCBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKHVpbnQgaW5kZXggPSAwOyBpbmRleCA8IG1vZGVyYXRvcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICBpZiAobW9kZXJhdG9yc1tpbmRleF0gPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWZvdW5kKSB0aHJvdzsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gRXRoZXJDaGVxdWUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIGV2ZW50CiAgICBldmVudCBMb2dDcmVhdGUoYnl0ZXMzMiBpbmRleGVkIGNoZXF1ZUlkSGFzaCwgdWludCByZXN1bHQsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExvZ1JlZGVlbShieXRlczMyIGluZGV4ZWQgY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlIHJlc3VsdCwgdWludCBhbW91bnQsIGFkZHJlc3MgcmVjZWl2ZXIpOwogICAgZXZlbnQgTG9nV2l0aGRyYXdFdGhlcihhZGRyZXNzIGluZGV4ZWQgc2VuZFRvLCBSZXN1bHRDb2RlIHJlc3VsdCwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTG9nUmVmdW5kQ2hlcXVlKGJ5dGVzMzIgaW5kZXhlZCBjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUgcmVzdWx0KTsKICAgIAogICAgLy8gb3duZXIgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIENoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBvbmx5T3duZXIgewogICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBLaWxsKCkgb25seU93bmVyIHsKICAgICAgICBzdWljaWRlKG93bmVyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gQWRkTW9kZXJhdG9yKGFkZHJlc3MgX25ld01vZGVyYXRvcikgb25seU93bmVyIHsKICAgICAgICBmb3IgKHVpbnQgaW5kZXggPSAwOyBpbmRleCA8IG1vZGVyYXRvcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChtb2RlcmF0b3JzW2luZGV4XSA9PSBfbmV3TW9kZXJhdG9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbW9kZXJhdG9ycy5wdXNoKF9uZXdNb2RlcmF0b3IpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBSZW1vdmVNb2RlcmF0b3IoYWRkcmVzcyBfb2xkTW9kZXJhdG9yKSBvbmx5T3duZXIgewogICAgICAgIHVpbnQgZm91bmRJbmRleCA9IDA7CiAgICAgICAgZm9yICg7IGZvdW5kSW5kZXggPCBtb2RlcmF0b3JzLmxlbmd0aDsgZm91bmRJbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChtb2RlcmF0b3JzW2ZvdW5kSW5kZXhdID09IF9vbGRNb2RlcmF0b3IpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChmb3VuZEluZGV4IDwgbW9kZXJhdG9ycy5sZW5ndGgpCiAgICAgICAgewogICAgICAgICAgICBtb2RlcmF0b3JzW2ZvdW5kSW5kZXhdID0gbW9kZXJhdG9yc1ttb2RlcmF0b3JzLmxlbmd0aC0xXTsKICAgICAgICAgICAgZGVsZXRlIG1vZGVyYXRvcnNbbW9kZXJhdG9ycy5sZW5ndGgtMV07CiAgICAgICAgICAgIG1vZGVyYXRvcnMubGVuZ3RoLS07CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBtb2RlcmF0b3IgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIFNldENvbW1pc3Npb25SYXRlKHVpbnQgX2NvbW1pc3Npb25SYXRlKSBvbmx5TW9kZXJhdG9ycyB7CiAgICAgICAgY29tbWlzc2lvblJhdGUgPSBfY29tbWlzc2lvblJhdGU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFNldE1pbkZlZSh1aW50IF9taW5GZWUpIG9ubHlNb2RlcmF0b3JzIHsKICAgICAgICBtaW5GZWUgPSBfbWluRmVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBTZXRNaW5DaGVxdWVWYWx1ZSh1aW50IF9taW5DaGVxdWVWYWx1ZSkgb25seU1vZGVyYXRvcnMgewogICAgICAgIG1pbkNoZXF1ZVZhbHVlID0gX21pbkNoZXF1ZVZhbHVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBTZXRNYXhDaGVxdWVWYWx1ZSh1aW50IF9tYXhDaGVxdWVWYWx1ZSkgb25seU1vZGVyYXRvcnMgewogICAgICAgIG1heENoZXF1ZVZhbHVlID0gX21heENoZXF1ZVZhbHVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBTZXRNYXhBdHRlbXB0KHVpbnQ4IF9tYXhBdHRlbXB0KSBvbmx5TW9kZXJhdG9ycyB7CiAgICAgICAgbWF4QXR0ZW1wdCA9IF9tYXhBdHRlbXB0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBVcGRhdGVNYWludGVuYW5jZShib29sIF9pc01haW50YWluaW5nKSBvbmx5TW9kZXJhdG9ycyB7CiAgICAgICAgaXNNYWludGFpbmluZyA9IF9pc01haW50YWluaW5nOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBXaXRoZHJhd0V0aGVyKGFkZHJlc3MgX3NlbmRUbywgdWludCBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyByZXR1cm5zKFJlc3VsdENvZGUpIHsKICAgICAgICAvLyBjYW4gb25seSBjYW4gd2l0aGRyYXcgcHJvZml0IC0gdW5hYmxlIHRvIHdpdGhkcmF3IGNoZXF1ZSB2YWx1ZQogICAgICAgIHVpbnQgY3VycmVudFByb2ZpdCA9IHRoaXMuYmFsYW5jZSAtICh0b3RhbENoZXF1ZVZhbHVlIC0gdG90YWxSZWRlZW1lZFZhbHVlKTsKICAgICAgICBpZiAoX2Ftb3VudCA+IGN1cnJlbnRQcm9maXQpIHsKICAgICAgICAgICAgTG9nV2l0aGRyYXdFdGhlcihfc2VuZFRvLCBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfQU1PVU5ULCAwKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfSU5WQUxJRF9BTU9VTlQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIF9zZW5kVG8udHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgTG9nV2l0aGRyYXdFdGhlcihfc2VuZFRvLCBSZXN1bHRDb2RlLlNVQ0NFU1MsIF9hbW91bnQpOwogICAgICAgIHJldHVybiBSZXN1bHRDb2RlLlNVQ0NFU1M7CiAgICB9CiAgICAKICAgIC8vIG9ubHkgd2hlbiBjcmVhdG9yIHdhbnRzIHRvIGdldCB0aGUgbW9uZXkgYmFjawogICAgLy8gb25seSBjYW4gcmVmdW5kIGJhY2sgdG8gY3JlYXRvcgogICAgZnVuY3Rpb24gUmVmdW5kQ2hlcXVlQnlJZChzdHJpbmcgX2NoZXF1ZUlkKSBvbmx5TW9kZXJhdG9ycyByZXR1cm5zKFJlc3VsdENvZGUpIHsKICAgICAgICBieXRlczMyIGNoZXF1ZUlkSGFzaCA9IHNoYTMoX2NoZXF1ZUlkKTsKICAgICAgICBDaGVxdWUgY2hlcXVlID0gaXRlbXNbY2hlcXVlSWRIYXNoXTsKICAgICAgICBpZiAoY2hlcXVlLnN0YXR1cyA9PSBTdGF0dXMuTk9ORSkgewogICAgICAgICAgICBMb2dSZWZ1bmRDaGVxdWUoY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlLkVSUk9SX05PVF9FWElTVCk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX05PVF9FWElTVDsKICAgICAgICB9CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLlVTRUQpIHsKICAgICAgICAgICAgTG9nUmVmdW5kQ2hlcXVlKGNoZXF1ZUlkSGFzaCwgUmVzdWx0Q29kZS5FUlJPUl9VU0VEKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfVVNFRDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdG90YWxSZWRlZW1lZENoZXF1ZSArPSAxOwogICAgICAgIHRvdGFsUmVkZWVtZWRWYWx1ZSArPSBjaGVxdWUudmFsdWU7CiAgICAgICAgdWludCBzZW5kQW1vdW50ID0gY2hlcXVlLnZhbHVlOwogICAgICAgIAogICAgICAgIGNoZXF1ZS5zdGF0dXMgPSBTdGF0dXMuVVNFRDsKICAgICAgICBjaGVxdWUudmFsdWUgPSAwOwogICAgICAgIAogICAgICAgIGNoZXF1ZS5jcmVhdG9yLnRyYW5zZmVyKHNlbmRBbW91bnQpOwogICAgICAgIExvZ1JlZnVuZENoZXF1ZShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuU1VDQ0VTUyk7CiAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuU1VDQ0VTUzsKICAgIH0KCiAgICBmdW5jdGlvbiBSZWZ1bmRDaGVxdWVCeUhhc2godWludDI1NiBfY2hlcXVlSWRIYXNoKSBvbmx5TW9kZXJhdG9ycyByZXR1cm5zKFJlc3VsdENvZGUpIHsKICAgICAgICBieXRlczMyIGNoZXF1ZUlkSGFzaCA9IGJ5dGVzMzIoX2NoZXF1ZUlkSGFzaCk7CiAgICAgICAgQ2hlcXVlIGNoZXF1ZSA9IGl0ZW1zW2NoZXF1ZUlkSGFzaF07CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLk5PTkUpIHsKICAgICAgICAgICAgTG9nUmVmdW5kQ2hlcXVlKGNoZXF1ZUlkSGFzaCwgUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1QpOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1Q7CiAgICAgICAgfQogICAgICAgIGlmIChjaGVxdWUuc3RhdHVzID09IFN0YXR1cy5VU0VEKSB7CiAgICAgICAgICAgIExvZ1JlZnVuZENoZXF1ZShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuRVJST1JfVVNFRCk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX1VTRUQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRvdGFsUmVkZWVtZWRDaGVxdWUgKz0gMTsKICAgICAgICB0b3RhbFJlZGVlbWVkVmFsdWUgKz0gY2hlcXVlLnZhbHVlOwogICAgICAgIHVpbnQgc2VuZEFtb3VudCA9IGNoZXF1ZS52YWx1ZTsKICAgICAgICAKICAgICAgICBjaGVxdWUuc3RhdHVzID0gU3RhdHVzLlVTRUQ7CiAgICAgICAgY2hlcXVlLnZhbHVlID0gMDsKICAgICAgICAKICAgICAgICBjaGVxdWUuY3JlYXRvci50cmFuc2ZlcihzZW5kQW1vdW50KTsKICAgICAgICBMb2dSZWZ1bmRDaGVxdWUoY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlLlNVQ0NFU1MpOwogICAgICAgIHJldHVybiBSZXN1bHRDb2RlLlNVQ0NFU1M7CiAgICB9CgogICAgZnVuY3Rpb24gR2V0Q2hlcXVlSW5mb0J5SGFzaCh1aW50MjU2IF9jaGVxdWVJZEhhc2gpIG9ubHlNb2RlcmF0b3JzIGNvbnN0YW50IHJldHVybnMoU3RhdHVzLCB1aW50LCB1aW50LCB1aW50KSB7CiAgICAgICAgYnl0ZXMzMiBjaGVxdWVJZEhhc2ggPSBieXRlczMyKF9jaGVxdWVJZEhhc2gpOwogICAgICAgIENoZXF1ZSBjaGVxdWUgPSBpdGVtc1tjaGVxdWVJZEhhc2hdOwogICAgICAgIGlmIChjaGVxdWUuc3RhdHVzID09IFN0YXR1cy5OT05FKSAKICAgICAgICAgICAgcmV0dXJuIChTdGF0dXMuTk9ORSwgMCwgMCwgMCk7CgogICAgICAgIGlmIChjaGVxdWUuZXhwaXJpbmdQZXJpb2QgPiAwKSB7CiAgICAgICAgICAgIHVpbnQgdGltZUdhcCA9IG5vdzsKICAgICAgICAgICAgaWYgKHRpbWVHYXAgPiBjaGVxdWUuY3JlYXRlVGltZSkKICAgICAgICAgICAgICAgIHRpbWVHYXAgPSB0aW1lR2FwIC0gY2hlcXVlLmNyZWF0ZVRpbWU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRpbWVHYXAgPSAwOwoKICAgICAgICAgICAgaWYgKGNoZXF1ZS5leHBpcmluZ1BlcmlvZCA+IHRpbWVHYXApCiAgICAgICAgICAgICAgICByZXR1cm4gKGNoZXF1ZS5zdGF0dXMsIGNoZXF1ZS52YWx1ZSwgY2hlcXVlLmF0dGVtcHQsIGNoZXF1ZS5leHBpcmluZ1BlcmlvZCAtIHRpbWVHYXApOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gKFN0YXR1cy5FWFBJUkVELCBjaGVxdWUudmFsdWUsIGNoZXF1ZS5hdHRlbXB0LCAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChjaGVxdWUuc3RhdHVzLCBjaGVxdWUudmFsdWUsIGNoZXF1ZS5hdHRlbXB0LCAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBWZXJpZnlDaGVxdWUoc3RyaW5nIF9jaGVxdWVJZCwgc3RyaW5nIF9waW4pIG9ubHlNb2RlcmF0b3JzIGNvbnN0YW50IHJldHVybnMoUmVzdWx0Q29kZSwgU3RhdHVzLCB1aW50LCB1aW50LCB1aW50KSB7CiAgICAgICAgYnl0ZXMzMiBjaGVxdWVJZEhhc2ggPSBzaGEzKF9jaGVxdWVJZCk7CiAgICAgICAgQ2hlcXVlIGNoZXF1ZSA9IGl0ZW1zW2NoZXF1ZUlkSGFzaF07CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLk5PTkUpIHsKICAgICAgICAgICAgcmV0dXJuIChSZXN1bHRDb2RlLkVSUk9SX05PVF9FWElTVCwgU3RhdHVzLk5PTkUsIDAsIDAsIDApOwogICAgICAgIH0KICAgICAgICBpZiAoY2hlcXVlLnN0YXR1cyA9PSBTdGF0dXMuVVNFRCkgewogICAgICAgICAgICByZXR1cm4gKFJlc3VsdENvZGUuRVJST1JfVVNFRCwgU3RhdHVzLlVTRUQsIDAsIDAsIDApOwogICAgICAgIH0KICAgICAgICBpZiAoY2hlcXVlLnBpbkhhc2ggIT0gc2hhMyhfY2hlcXVlSWQsIF9waW4pKSB7CiAgICAgICAgICAgIHJldHVybiAoUmVzdWx0Q29kZS5FUlJPUl9JTlZBTElEX1NUQVRVUywgU3RhdHVzLk5PTkUsIDAsIDAsIDApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gKFJlc3VsdENvZGUuU1VDQ0VTUywgY2hlcXVlLnN0YXR1cywgY2hlcXVlLnZhbHVlLCBjaGVxdWUuYXR0ZW1wdCwgMCk7CiAgICB9CiAgICAKICAgIC8vIGNvbnN0YW50IGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBHZXRDaGVxdWVJbmZvKHN0cmluZyBfY2hlcXVlSWQpIGNvbnN0YW50IHJldHVybnMoU3RhdHVzLCB1aW50LCB1aW50LCB1aW50KSB7CiAgICAgICAgYnl0ZXMzMiBoYXNoQ2hlcXVlSWQgPSBzaGEzKF9jaGVxdWVJZCk7CiAgICAgICAgQ2hlcXVlIGNoZXF1ZSA9IGl0ZW1zW2hhc2hDaGVxdWVJZF07CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLk5PTkUpIAogICAgICAgICAgICByZXR1cm4gKFN0YXR1cy5OT05FLCAwLCAwLCAwKTsKCiAgICAgICAgaWYgKGNoZXF1ZS5leHBpcmluZ1BlcmlvZCA+IDApIHsKICAgICAgICAgICAgdWludCB0aW1lR2FwID0gbm93OwogICAgICAgICAgICBpZiAodGltZUdhcCA+IGNoZXF1ZS5jcmVhdGVUaW1lKQogICAgICAgICAgICAgICAgdGltZUdhcCA9IHRpbWVHYXAgLSBjaGVxdWUuY3JlYXRlVGltZTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGltZUdhcCA9IDA7CgogICAgICAgICAgICBpZiAoY2hlcXVlLmV4cGlyaW5nUGVyaW9kID4gdGltZUdhcCkKICAgICAgICAgICAgICAgIHJldHVybiAoY2hlcXVlLnN0YXR1cywgY2hlcXVlLnZhbHVlLCBjaGVxdWUuYXR0ZW1wdCwgY2hlcXVlLmV4cGlyaW5nUGVyaW9kIC0gdGltZUdhcCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiAoU3RhdHVzLkVYUElSRUQsIGNoZXF1ZS52YWx1ZSwgY2hlcXVlLmF0dGVtcHQsIDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGNoZXF1ZS5zdGF0dXMsIGNoZXF1ZS52YWx1ZSwgY2hlcXVlLmF0dGVtcHQsIDApOwogICAgfQogICAgCiAgICAvLyB0cmFuc2FjdGlvbgogICAgZnVuY3Rpb24gQ3JlYXRlKHVpbnQyNTYgX2NoZXF1ZUlkSGFzaCwgdWludDI1NiBfcGluSGFzaCwgdWludDMyIF9leHBpcmluZ1BlcmlvZCkgcGF5YWJsZSBpc0FjdGl2ZSByZXR1cm5zKFJlc3VsdENvZGUpIHsKICAgICAgICAvLyBjb25kaXRpb246IAogICAgICAgIC8vIDEuIGNoZWNrIG1pbiB2YWx1ZQogICAgICAgIC8vIDIuIGNoZWNrIF9jaGVxdWVJZCBleGlzdCBvciBub3QKICAgICAgICBieXRlczMyIGNoZXF1ZUlkSGFzaCA9IGJ5dGVzMzIoX2NoZXF1ZUlkSGFzaCk7CiAgICAgICAgYnl0ZXMzMiBwaW5IYXNoID0gYnl0ZXMzMihfcGluSGFzaCk7CiAgICAgICAgdWludCBjaGVxdWVWYWx1ZSA9IDA7CiAgICAgICAgCiAgICAgICAgLy8gZGVkdWN0IGNvbW1pc3Npb24KICAgICAgICB1aW50IGNvbW1pc3Npb25GZWUgPSAobXNnLnZhbHVlIC8gMTAwMCkgKiBjb21taXNzaW9uUmF0ZTsKICAgICAgICBpZiAoY29tbWlzc2lvbkZlZSA8IG1pbkZlZSkgewogICAgICAgICAgICBjb21taXNzaW9uRmVlID0gbWluRmVlOwogICAgICAgIH0KICAgICAgICBpZiAobXNnLnZhbHVlIDwgY29tbWlzc2lvbkZlZSkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIExvZ0NyZWF0ZShjaGVxdWVJZEhhc2gsIHVpbnQoUmVzdWx0Q29kZS5FUlJPUl9JTlZBTElEX0FNT1VOVCksIGNoZXF1ZVZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfSU5WQUxJRF9BTU9VTlQ7CiAgICAgICAgfQogICAgICAgIGNoZXF1ZVZhbHVlID0gbXNnLnZhbHVlIC0gY29tbWlzc2lvbkZlZTsKICAgICAgICAKICAgICAgICBpZiAoY2hlcXVlVmFsdWUgPCBtaW5DaGVxdWVWYWx1ZSkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIExvZ0NyZWF0ZShjaGVxdWVJZEhhc2gsIHVpbnQoUmVzdWx0Q29kZS5FUlJPUl9NSU4pLCBjaGVxdWVWYWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX01JTjsKICAgICAgICB9CiAgICAgICAgaWYgKG1heENoZXF1ZVZhbHVlID4gMCAmJiBjaGVxdWVWYWx1ZSA+IG1heENoZXF1ZVZhbHVlKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgICAgICAgICAgTG9nQ3JlYXRlKGNoZXF1ZUlkSGFzaCwgdWludChSZXN1bHRDb2RlLkVSUk9SX01BWCksIGNoZXF1ZVZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfTUFYOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbXNbY2hlcXVlSWRIYXNoXS5zdGF0dXMgIT0gU3RhdHVzLk5PTkUgJiYgaXRlbXNbY2hlcXVlSWRIYXNoXS5zdGF0dXMgIT0gU3RhdHVzLlVTRUQpIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgICAgICAgICBMb2dDcmVhdGUoY2hlcXVlSWRIYXNoLCB1aW50KFJlc3VsdENvZGUuRVJST1JfRVhJU1QpLCBjaGVxdWVWYWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0VYSVNUOwogICAgICAgIH0KCiAgICAgICAgdG90YWxDaGVxdWUgKz0gMTsKICAgICAgICB0b3RhbENoZXF1ZVZhbHVlICs9IGNoZXF1ZVZhbHVlOwogICAgICAgIGl0ZW1zW2NoZXF1ZUlkSGFzaF0gPSBDaGVxdWUoewogICAgICAgICAgICBwaW5IYXNoOiBwaW5IYXNoLAogICAgICAgICAgICBjcmVhdG9yOiBtc2cuc2VuZGVyLAogICAgICAgICAgICBzdGF0dXM6IFN0YXR1cy5DUkVBVEVELAogICAgICAgICAgICB2YWx1ZTogY2hlcXVlVmFsdWUsCiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IG5vdywKICAgICAgICAgICAgZXhwaXJpbmdQZXJpb2Q6IF9leHBpcmluZ1BlcmlvZCwKICAgICAgICAgICAgYXR0ZW1wdDogMAogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIExvZ0NyZWF0ZShjaGVxdWVJZEhhc2gsIHVpbnQoUmVzdWx0Q29kZS5TVUNDRVNTKSwgY2hlcXVlVmFsdWUpOwogICAgICAgIHJldHVybiBSZXN1bHRDb2RlLlNVQ0NFU1M7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFJlZGVlbShzdHJpbmcgX2NoZXF1ZUlkLCBzdHJpbmcgX3BpbiwgYWRkcmVzcyBfc2VuZFRvKSBwYXlhYmxlIHJldHVybnMgKFJlc3VsdENvZGUpewogICAgICAgIC8vIGNvbmRpdGlvbgogICAgICAgIC8vIDEuIGNoZXF1ZSBzdGF0dXMgbXVzdCBleGlzdAogICAgICAgIC8vIDIuIGNoZXF1ZSBzdGF0dXMgbXVzdCBiZSBDUkVBVEVEIHN0YXR1cyBmb3Igbm9uLWNyZWF0b3IKICAgICAgICAvLyAzLiB2ZXJpZnkgYXR0ZW1wdCBhbmQgZXhwaXJ5IHRpbWUgZm9yIG5vbi1jcmVhdG9yCiAgICAgICAgYnl0ZXMzMiBjaGVxdWVJZEhhc2ggPSBzaGEzKF9jaGVxdWVJZCk7CiAgICAgICAgQ2hlcXVlIGNoZXF1ZSA9IGl0ZW1zW2NoZXF1ZUlkSGFzaF07CiAgICAgICAgaWYgKGNoZXF1ZS5zdGF0dXMgPT0gU3RhdHVzLk5PTkUpIHsKICAgICAgICAgICAgTG9nUmVkZWVtKGNoZXF1ZUlkSGFzaCwgUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1QsIDAsIF9zZW5kVG8pOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9OT1RfRVhJU1Q7CiAgICAgICAgfQogICAgICAgIGlmIChjaGVxdWUuc3RhdHVzID09IFN0YXR1cy5VU0VEKSB7CiAgICAgICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuRVJST1JfVVNFRCwgMCwgX3NlbmRUbyk7CiAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX1VTRUQ7CiAgICAgICAgfQogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNoZXF1ZS5jcmVhdG9yKSB7CiAgICAgICAgICAgIGlmIChjaGVxdWUuc3RhdHVzICE9IFN0YXR1cy5DUkVBVEVEKSB7CiAgICAgICAgICAgICAgICBMb2dSZWRlZW0oY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfU1RBVFVTLCAwLCBfc2VuZFRvKTsKICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0lOVkFMSURfU1RBVFVTOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGVxdWUuYXR0ZW1wdCA+IG1heEF0dGVtcHQpIHsKICAgICAgICAgICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuRVJST1JfTE9DS0VELCAwLCBfc2VuZFRvKTsKICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHRDb2RlLkVSUk9SX0xPQ0tFRDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2hlcXVlLmV4cGlyaW5nUGVyaW9kID4gMCAmJiBub3cgPiAoY2hlcXVlLmNyZWF0ZVRpbWUgKyBjaGVxdWUuZXhwaXJpbmdQZXJpb2QpKSB7CiAgICAgICAgICAgICAgICBMb2dSZWRlZW0oY2hlcXVlSWRIYXNoLCBSZXN1bHRDb2RlLkVSUk9SX0VYUElSRUQsIDAsIF9zZW5kVG8pOwogICAgICAgICAgICAgICAgcmV0dXJuIFJlc3VsdENvZGUuRVJST1JfRVhQSVJFRDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjaGVjayBwaW4KICAgICAgICBpZiAoY2hlcXVlLnBpbkhhc2ggIT0gc2hhMyhfY2hlcXVlSWQsIF9waW4pKSB7CiAgICAgICAgICAgIGNoZXF1ZS5hdHRlbXB0ICs9IDE7CiAgICAgICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuRVJST1JfSU5WQUxJRF9TVEFUVVMsIDAsIF9zZW5kVG8pOwogICAgICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5FUlJPUl9JTlZBTElEX1NUQVRVUzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdG90YWxSZWRlZW1lZENoZXF1ZSArPSAxOwogICAgICAgIHRvdGFsUmVkZWVtZWRWYWx1ZSArPSBjaGVxdWUudmFsdWU7CiAgICAgICAgdWludCBzZW5kTW91bnQgPSBjaGVxdWUudmFsdWU7CiAgICAgICAgCiAgICAgICAgY2hlcXVlLnN0YXR1cyA9IFN0YXR1cy5VU0VEOwogICAgICAgIGNoZXF1ZS52YWx1ZSA9IDA7CiAgICAgICAgCiAgICAgICAgX3NlbmRUby50cmFuc2ZlcihzZW5kTW91bnQpOwogICAgICAgIExvZ1JlZGVlbShjaGVxdWVJZEhhc2gsIFJlc3VsdENvZGUuU1VDQ0VTUywgc2VuZE1vdW50LCBfc2VuZFRvKTsKICAgICAgICByZXR1cm4gUmVzdWx0Q29kZS5TVUNDRVNTOwogICAgfQoKfQ=='.
	

]
