Class {
	#name : #SRT66c97148b91d9dd041dd12d136fa8375c66a9378,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT66c97148b91d9dd041dd12d136fa8375c66a9378 >> base64 [
	^ 'Ly8gS2luZyBvZiB0aGUgRXRoZXIgVGhyb25lIENvbnRyYWN0cy4KLy8gQ29weXJpZ2h0IChjKSAyMDE2IEtpZXJhbiBFbGJ5LiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuCi8vIFZlcnNpb24gMS4wLjAsIDMxIEp1bHkgMjAxNi4KLy8KLy8gU2VlIGFsc28gaHR0cDovL3d3dy5raW5nb2Z0aGVldGhlci5jb20gYW5kCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9raWVyYW5lbGJ5L0tpbmdPZlRoZUV0aGVyVGhyb25lIC4KLy8gCi8vIFRoaXMgZmlsZSBjb250YWlucyBhIG51bWJlciBvZiBjb250cmFjdHMsIG9mIHdoaWNoIG9ubHkKLy8gdGhlc2UgdGhyZWUgYXJlIG5vcm1hbGx5IGNyZWF0ZWQ6Ci8vCi8vIC0gS2luZ2RvbSAgICAgICAgPSBtYWludGFpbnMgdGhlIHRocm9uZSBmb3IgYSBraW5nZG9tCi8vIC0gV29ybGQgICAgICAgICAgPSBydW5zIHRoZSB3b3JsZCwgd2hpY2ggaXMgYSBjb2xsZWN0aW9uIG9mIGtpbmdkb21zCi8vIC0gS2luZ2RvbUZhY3RvcnkgPSB1c2VkIGludGVybmFsbHkgYnkgdGhlIFdvcmxkIGNvbnRyYWN0Ci8vCi8vIFRoZSAiTWl4aW4iIGNvbnRyYWN0cyAoVGhyb25lUnVsZXNNaXhpbiwgUmVlbnRyeVByb3RlY3Rvck1peGluLAovLyBDYXJlZnVsU2VuZGVyTWl4aW4sIEZ1bmRzSG9sZGVyTWl4aW4sIE1vbmV5Um91bmRlck1peGluLAovLyBOYW1lYWJsZU1peGluKSBjb250YWluIGZ1bmN0aW9ucyAvIGRhdGEgLyBzdHJ1Y3R1cmVzIHVzZWQKLy8gYnkgdGhlIHRocmVlIG1haW4gY29udHJhY3RzLgovLyBUaGUgRXhwb3NlZEludGVybmFsc0ZvclRlc3RpbmcgY29udHJhY3QgaXMgdXNlZCBieSBhdXRvbWF0ZWQgdGVzdHMuCgoKLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIGF2b2lkIHJlY3Vyc2l2ZS1jYWxsIGF0dGFja3MuCmNvbnRyYWN0IFJlZW50cnlQcm90ZWN0b3JNaXhpbiB7CgogICAgLy8gdHJ1ZSBpZiB3ZSBhcmUgaW5zaWRlIGFuIGV4dGVybmFsIGZ1bmN0aW9uCiAgICBib29sIHJlZW50cnlQcm90ZWN0b3I7CgogICAgLy8gTWFyayBjb250cmFjdCBhcyBoYXZpbmcgZW50ZXJlZCBhbiBleHRlcm5hbCBmdW5jdGlvbi4KICAgIC8vIFRocm93cyBhbiBleGNlcHRpb24gaWYgY2FsbGVkIHR3aWNlIHdpdGggbm8gZXh0ZXJuYWxMZWF2ZSgpLgogICAgLy8gRm9yIHRoaXMgdG8gd29yaywgQ29udHJhY3RzIE1VU1Q6CiAgICAvLyAgLSBjYWxsIGV4dGVybmFsRW50ZXIoKSBhdCB0aGUgc3RhcnQgb2YgZWFjaCBleHRlcm5hbCBmdW5jdGlvbgogICAgLy8gIC0gY2FsbCBleHRlcm5hbExlYXZlKCkgYXQgdGhlIGVuZCBvZiBlYWNoIGV4dGVybmFsIGZ1bmN0aW9uCiAgICAvLyAgLSBuZXZlciB1c2UgcmV0dXJuIHN0YXRlbWVudHMgaW4gYmV0d2VlbiBlbnRlciBhbmQgbGVhdmUKICAgIC8vICAtIG5ldmVyIGNhbGwgYW4gZXh0ZXJuYWwgZnVuY3Rpb24gZnJvbSBhbm90aGVyIGZ1bmN0aW9uCiAgICAvLyBXQVJOOiBzZXJpb3VzIHJpc2sgb2YgY29udHJhY3QgZ2V0dGluZyBzdHVjayBpZiB1c2VkIHdyb25nbHkuCiAgICBmdW5jdGlvbiBleHRlcm5hbEVudGVyKCkgaW50ZXJuYWwgewogICAgICAgIGlmIChyZWVudHJ5UHJvdGVjdG9yKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICByZWVudHJ5UHJvdGVjdG9yID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBNYXJrIGNvbnRyYWN0IGFzIGhhdmluZyBsZWZ0IGFuIGV4dGVybmFsIGZ1bmN0aW9uLgogICAgLy8gRG8gdGhpcyBhZnRlciBlYWNoIGNhbGwgdG8gZXh0ZXJuYWxFbnRlcigpLgogICAgZnVuY3Rpb24gZXh0ZXJuYWxMZWF2ZSgpIGludGVybmFsIHsKICAgICAgICByZWVudHJ5UHJvdGVjdG9yID0gZmFsc2U7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIHNlbmQgZXRoZXIgdG8gdW50cnVzdGVkIGFkZHJlc3Nlcy4KY29udHJhY3QgQ2FyZWZ1bFNlbmRlck1peGluIHsKCiAgICAvLyBTZWVtcyBhIHJlYXNvbmFibGUgYW1vdW50IGZvciBhIHdlbGwtd3JpdHRlbiBmYWxsYmFjayBmdW5jdGlvbi4KICAgIHVpbnQgY29uc3RhbnQgc3VnZ2VzdGVkRXh0cmFHYXNUb0luY2x1ZGVXaXRoU2VuZHMgPSAyMzAwMDsKCiAgICAvLyBTZW5kIGBfdmFsdWVXZWlgIG9mIG91ciBldGhlciB0byBgX3RvQWRkcmVzc2AsIGluY2x1ZGluZwogICAgLy8gYF9leHRyYUdhc0luY2x1ZGVkYCBnYXMgYWJvdmUgdGhlIHVzdWFsIDIzMDAgZ2FzIHN0aXBlbmQKICAgIC8vIHdpdGggdGhlIHNlbmQgY2FsbC4KICAgIC8vCiAgICAvLyBUaGlzIG5lZWRzIGNhcmUgYmVjYXVzZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBpZiBfdG9BZGRyZXNzCiAgICAvLyBpcyBleHRlcm5hbGx5IG93bmVkIG9yIGlzIGFub3RoZXIgY29udHJhY3QgLSBhbmQgc2VuZGluZyBldGhlcgogICAgLy8gdG8gYSBjb250cmFjdCBhZGRyZXNzIHdpbGwgaW52b2tlIGl0cyBmYWxsYmFjayBmdW5jdGlvbjsgdGhpcwogICAgLy8gaGFzIHRocmVlIGltcGxpY2F0aW9uczoKICAgIC8vCiAgICAvLyAxKSBEYW5nZXIgb2YgcmVjdXJzaXZlIGF0dGFjay4KICAgIC8vICBUaGUgZGVzdGluYXRpb24gY29udHJhY3QncyBmYWxsYmFjayBmdW5jdGlvbiAob3IgYW5vdGhlcgogICAgLy8gIGNvbnRyYWN0IGl0IGNhbGxzKSBtYXkgY2FsbCBiYWNrIGludG8gdGhpcyBjb250cmFjdCAoaW5jbHVkaW5nCiAgICAvLyAgb3VyIGZhbGxiYWNrIGZ1bmN0aW9uIGFuZCBleHRlcm5hbCBmdW5jdGlvbnMgaW5oZXJpdGVkLCBvciBpbnRvCiAgICAvLyAgb3RoZXIgY29udHJhY3RzIGluIG91ciBzdGFjayksIGxlYWRpbmcgdG8gdW5leHBlY3RlZCBiZWhhdmlvdXIuCiAgICAvLyAgTWl0aWdhdGlvbnM6CiAgICAvLyAgIC0gcHJvdGVjdCBhbGwgZXh0ZXJuYWwgZnVuY3Rpb25zIGFnYWluc3QgcmUtZW50cnkgaW50bwogICAgLy8gICAgIGFueSBvZiB0aGVtIChzZWUgUmVlbnRyeVByb3RlY3Rvck1peGluKTsKICAgIC8vICAgLSBwcm9ncmFtIHZlcnkgZGVmZW5zaXZlbHkgKGUuZy4gZGViaXQgYmFsYW5jZSBiZWZvcmUgc2VuZCkuCiAgICAvLwogICAgLy8gMikgRGVzdGluYXRpb24gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGZhaWwuCiAgICAvLyAgSWYgdGhlIGRlc3RpbmF0aW9uIGNvbnRyYWN0J3MgZmFsbGJhY2sgZnVuY3Rpb24gZmFpbHMsIGV0aGVyCiAgICAvLyAgd2lsbCBub3QgYmUgc2VudCBhbmQgbWF5IGJlIGxvY2tlZCBpbnRvIHRoZSBzZW5kaW5nIGNvbnRyYWN0LgogICAgLy8gIFVubGlrZSBtb3N0IGVycm9ycywgaXQgd2lsbCBOT1QgY2F1c2UgdGhpcyBjb250cmFjdCB0byB0aHJvdy4KICAgIC8vICBNaXRpZ2F0aW9uczoKICAgIC8vICAgLSBjaGVjayB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhpcyBmdW5jdGlvbiAoc2VlIGJlbG93KS4KICAgIC8vCiAgICAvLyAzKSBHYXMgdXNhZ2UuCiAgICAvLyAgVGhlIGRlc3RpbmF0aW9uIGZhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgY29uc3VtZSB0aGUgZ2FzIHN1cHBsaWVkCiAgICAvLyAgaW4gdGhpcyB0cmFuc2FjdGlvbiAod2hpY2ggaXMgZml4ZWQgYW5kIHNldCBieSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICBzdGFydGVyLCB0aG91Z2ggc29tZSBjbGllbnRzIGRvIGEgZ29vZCBqb2Igb2YgZXN0aW1hdGluZyBpdC4KICAgIC8vICBUaGlzIGlzIGEgcHJvYmxlbSBmb3IgbG90dGVyeS10eXBlIGNvbnRyYWN0cyB3aGVyZSBvbmUgdmVyeQogICAgLy8gIGV4cGVuc2l2ZS10by1jYWxsIHJlY2VpdmluZyBjb250cmFjdCBjb3VsZCAncG9pc29uJyB0aGUgbG90dGVyeQogICAgLy8gIGNvbnRyYWN0IGJ5IHByZXZlbnRpbmcgaXQgYmVpbmcgaW52b2tlZCBieSBhbm90aGVyIHBlcnNvbiB3aG8KICAgIC8vICBjYW5ub3Qgc3VwcGx5IGVub3VnaCBnYXMuCiAgICAvLyAgTWl0aWdhdGlvbnM6CiAgICAvLyAgICAtIGNob29zZSBzZW5zaWJsZSB2YWx1ZSBmb3IgX2V4dHJhR2FzSW5jbHVkZWQgKGJ5IGRlZmF1bHQKICAgIC8vICAgICAgb25seSAyMzAwIGdhcyBpcyBzdXBwbGllZCB0byB0aGUgZGVzdGluYXRpb24gZnVuY3Rpb24pOwogICAgLy8gICAgLSBpZiBjYWxsIGZhaWxzIGNvbnNpZGVyIHdoZXRoZXIgdG8gdGhyb3cgb3IgdG8gcmluZy1mZW5jZQogICAgLy8gICAgICBmdW5kcyBmb3IgbGF0ZXIgd2l0aGRyYXdhbC4KICAgIC8vCiAgICAvLyBSZXR1cm5zOgogICAgLy8KICAgIC8vICBUcnVlIGlmLWFuZC1vbmx5LWlmIHRoZSBzZW5kIGNhbGwgd2FzIG1hZGUgYW5kIGRpZCBub3QgdGhyb3cKICAgIC8vICBhbiBlcnJvci4gSW4gdGhpcyBjYXNlLCB3ZSB3aWxsIG5vIGxvbmdlciBvd24gdGhlIF92YWx1ZVdlaQogICAgLy8gIGV0aGVyLiBOb3RlIHRoYXQgd2UgY2Fubm90IGdldCB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmYWxsYmFjawogICAgLy8gIGZ1bmN0aW9uIGNhbGxlZCAoaWYgYW55KS4KICAgIC8vCiAgICAvLyAgRmFsc2UgaWYgdGhlIHNlbmQgd2FzIG1hZGUgYnV0IHRoZSBkZXN0aW5hdGlvbiBmYWxsYmFjayBmdW5jdGlvbgogICAgLy8gIHRocmV3IGFuIGVycm9yIChvciByYW4gb3V0IG9mIGdhcykuIElmIHRoaXMgaGFwZW5zLCB3ZSBzdGlsbCBvd24KICAgIC8vICBfdmFsdWVXZWkgZXRoZXIgYW5kIHRoZSBkZXN0aW5hdGlvbidzIGFjdGlvbnMgd2VyZSB1bmRvbmUuCiAgICAvLwogICAgLy8gIFRoaXMgZnVuY3Rpb24gc2hvdWxkIG5vdCBub3JtYWxseSB0aHJvdyBhbiBlcnJvciB1bmxlc3M6CiAgICAvLyAgICAtIG5vdCBlbm91Z2ggZ2FzIHRvIG1ha2UgdGhlIHNlbmQvY2FsbAogICAgLy8gICAgLSBtYXggY2FsbCBzdGFjayBkZXB0aCByZWFjaGVkCiAgICAvLyAgICAtIGluc3VmZmljaWVudCBldGhlcgogICAgLy8KICAgIGZ1bmN0aW9uIGNhcmVmdWxTZW5kV2l0aEZpeGVkR2FzKAogICAgICAgIGFkZHJlc3MgX3RvQWRkcmVzcywKICAgICAgICB1aW50IF92YWx1ZVdlaSwKICAgICAgICB1aW50IF9leHRyYUdhc0luY2x1ZGVkCiAgICApIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBfdG9BZGRyZXNzLmNhbGwudmFsdWUoX3ZhbHVlV2VpKS5nYXMoX2V4dHJhR2FzSW5jbHVkZWQpKCk7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIHRyYWNrIHdobyBvd25zIG91ciBldGhlciBhbmQgYWxsb3cgd2l0aGRyYXdhbHMuCmNvbnRyYWN0IEZ1bmRzSG9sZGVyTWl4aW4gaXMgUmVlbnRyeVByb3RlY3Rvck1peGluLCBDYXJlZnVsU2VuZGVyTWl4aW4gewoKICAgIC8vIFJlY29yZCBoZXJlIGhvdyBtdWNoIHdlaSBpcyBvd25lZCBieSBhbiBhZGRyZXNzLgogICAgLy8gT2J2aW91c2x5LCB0aGUgZW50cmllcyBoZXJlIE1VU1QgYmUgYmFja2VkIGJ5IGFjdHVhbCBldGhlcgogICAgLy8gb3duZWQgYnkgdGhlIGNvbnRyYWN0IC0gd2UgY2Fubm90IGVuZm9yY2UgdGhhdCBpbiB0aGlzIG1peGluLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBmdW5kczsKCiAgICBldmVudCBGdW5kc1dpdGhkcmF3bkV2ZW50KAogICAgICAgIGFkZHJlc3MgZnJvbUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyB0b0FkZHJlc3MsCiAgICAgICAgdWludCB2YWx1ZVdlaQogICAgKTsKCiAgICAvLy8gQG5vdGljZSBBbW91bnQgb2YgZXRoZXIgaGVsZCBmb3IgYF9hZGRyZXNzYC4KICAgIGZ1bmN0aW9uIGZ1bmRzT2YoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAodWludCB2YWx1ZVdlaSkgewogICAgICAgIHJldHVybiBmdW5kc1tfYWRkcmVzc107CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2VuZCB0aGUgY2FsbGVyIChgbXNnLnNlbmRlcmApIGFsbCBldGhlciB0aGV5IG93bi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHMoKSB7CiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOwogICAgICAgIHdpdGhkcmF3RnVuZHNSUCgpOwogICAgICAgIGV4dGVybmFsTGVhdmUoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfdmFsdWVXZWlgIG9mIHRoZSBldGhlciBvd25lZCBieSB0aGUgY2FsbGVyCiAgICAvLy8gKGBtc2cuc2VuZGVyYCkgdG8gYF90b0FkZHJlc3NgLCBpbmNsdWRpbmcgYF9leHRyYUdhc2AgZ2FzCiAgICAvLy8gYmV5b25kIHRoZSBub3JtYWwgc3RpcGVuZC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHNBZHZhbmNlZCgKICAgICAgICBhZGRyZXNzIF90b0FkZHJlc3MsCiAgICAgICAgdWludCBfdmFsdWVXZWksCiAgICAgICAgdWludCBfZXh0cmFHYXMKICAgICkgewogICAgICAgIGV4dGVybmFsRW50ZXIoKTsKICAgICAgICB3aXRoZHJhd0Z1bmRzQWR2YW5jZWRSUChfdG9BZGRyZXNzLCBfdmFsdWVXZWksIF9leHRyYUdhcyk7CiAgICAgICAgZXh0ZXJuYWxMZWF2ZSgpOwogICAgfQoKICAgIC8vLyBAZGV2IGludGVybmFsIHZlcnNpb24gb2Ygd2l0aGRyYXdGdW5kcygpCiAgICBmdW5jdGlvbiB3aXRoZHJhd0Z1bmRzUlAoKSBpbnRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBmcm9tQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgYWRkcmVzcyB0b0FkZHJlc3MgPSBmcm9tQWRkcmVzczsKICAgICAgICB1aW50IGFsbEF2YWlsYWJsZVdlaSA9IGZ1bmRzW2Zyb21BZGRyZXNzXTsKICAgICAgICB3aXRoZHJhd0Z1bmRzQWR2YW5jZWRSUCgKICAgICAgICAgICAgdG9BZGRyZXNzLAogICAgICAgICAgICBhbGxBdmFpbGFibGVXZWksCiAgICAgICAgICAgIHN1Z2dlc3RlZEV4dHJhR2FzVG9JbmNsdWRlV2l0aFNlbmRzCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBpbnRlcm5hbCB2ZXJzaW9uIG9mIHdpdGhkcmF3RnVuZHNBZHZhbmNlZCgpLCBhbHNvIHVzZWQKICAgIC8vLyBieSB3aXRoZHJhd0Z1bmRzUlAoKS4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnVuZHNBZHZhbmNlZFJQKAogICAgICAgIGFkZHJlc3MgX3RvQWRkcmVzcywKICAgICAgICB1aW50IF92YWx1ZVdlaSwKICAgICAgICB1aW50IF9leHRyYUdhc0luY2x1ZGVkCiAgICApIGludGVybmFsIHsKICAgICAgICBpZiAobXNnLnZhbHVlICE9IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGFkZHJlc3MgZnJvbUFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIGlmIChfdmFsdWVXZWkgPiBmdW5kc1tmcm9tQWRkcmVzc10pIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGZ1bmRzW2Zyb21BZGRyZXNzXSAtPSBfdmFsdWVXZWk7CiAgICAgICAgYm9vbCBzZW50T2sgPSBjYXJlZnVsU2VuZFdpdGhGaXhlZEdhcygKICAgICAgICAgICAgX3RvQWRkcmVzcywKICAgICAgICAgICAgX3ZhbHVlV2VpLAogICAgICAgICAgICBfZXh0cmFHYXNJbmNsdWRlZAogICAgICAgICk7CiAgICAgICAgaWYgKCFzZW50T2spIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIEZ1bmRzV2l0aGRyYXduRXZlbnQoZnJvbUFkZHJlc3MsIF90b0FkZHJlc3MsIF92YWx1ZVdlaSk7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIG1ha2UgbmljZXIgbG9va2luZyBldGhlciBhbW91bnRzLgpjb250cmFjdCBNb25leVJvdW5kZXJNaXhpbiB7CgogICAgLy8vIEBub3RpY2UgTWFrZSBgX3Jhd1ZhbHVlV2VpYCBpbnRvIGEgbmljZXIsIHJvdW5kZXIgbnVtYmVyLgogICAgLy8vIEByZXR1cm4gQSB2YWx1ZSB0aGF0OgogICAgLy8vICAgLSBpcyBubyBsYXJnZXIgdGhhbiBgX3Jhd1ZhbHVlV2VpYAogICAgLy8vICAgLSBpcyBubyBzbWFsbGVyIHRoYW4gYF9yYXdWYWx1ZVdlaWAgKiAwLjk5OQogICAgLy8vICAgLSBoYXMgbm8gbW9yZSB0aGFuIHRocmVlIHNpZ25pZmljYW50IGZpZ3VyZXMgVU5MRVNTIHRoZQogICAgLy8vICAgICBudW1iZXIgaXMgdmVyeSBzbWFsbCBvciB2ZXJ5IGxhcmdlIGluIG1vbmV0YXJ5IHRlcm1zCiAgICAvLy8gICAgICh3aGljaCB3ZSBkZWZpbmUgYXMgPCAxIGZpbm5leSBvciA+IDEwMDAwIGV0aGVyKSwgaW4KICAgIC8vLyAgICAgd2hpY2ggY2FzZSBubyBwcmVjaXNpb24gd2lsbCBiZSBsb3N0LgogICAgZnVuY3Rpb24gcm91bmRNb25leURvd25OaWNlbHkodWludCBfcmF3VmFsdWVXZWkpIGNvbnN0YW50IGludGVybmFsCiAgICByZXR1cm5zICh1aW50IG5pY2VyVmFsdWVXZWkpIHsKICAgICAgICBpZiAoX3Jhd1ZhbHVlV2VpIDwgMSBmaW5uZXkpIHsKICAgICAgICAgICAgcmV0dXJuIF9yYXdWYWx1ZVdlaTsKICAgICAgICB9IGVsc2UgaWYgKF9yYXdWYWx1ZVdlaSA8IDEwIGZpbm5leSkgewogICAgICAgICAgICByZXR1cm4gMTAgc3phYm8gKiAoX3Jhd1ZhbHVlV2VpIC8gMTAgc3phYm8pOwogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMTAwIGZpbm5leSkgewogICAgICAgICAgICByZXR1cm4gMTAwIHN6YWJvICogKF9yYXdWYWx1ZVdlaSAvIDEwMCBzemFibyk7CiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiAxIGZpbm5leSAqIChfcmF3VmFsdWVXZWkgLyAxIGZpbm5leSk7CiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMCBldGhlcikgewogICAgICAgICAgICByZXR1cm4gMTAgZmlubmV5ICogKF9yYXdWYWx1ZVdlaSAvIDEwIGZpbm5leSk7CiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMDAgZXRoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIDEwMCBmaW5uZXkgKiAoX3Jhd1ZhbHVlV2VpIC8gMTAwIGZpbm5leSk7CiAgICAgICAgfSBlbHNlIGlmIChfcmF3VmFsdWVXZWkgPCAxMDAwIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiAxIGV0aGVyICogKF9yYXdWYWx1ZVdlaSAvIDEgZXRoZXIpOwogICAgICAgIH0gZWxzZSBpZiAoX3Jhd1ZhbHVlV2VpIDwgMTAwMDAgZXRoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIDEwIGV0aGVyICogKF9yYXdWYWx1ZVdlaSAvIDEwIGV0aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gX3Jhd1ZhbHVlV2VpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQ29udmVydCBgX3ZhbHVlV2VpYCBpbnRvIGEgd2hvbGUgbnVtYmVyIG9mIGZpbm5leS4KICAgIC8vLyBAcmV0dXJuIFRoZSBzbWFsbGVzdCB3aG9sZSBudW1iZXIgb2YgZmlubmV5IHdoaWNoIGlzIGVxdWFsCiAgICAvLy8gdG8gb3IgZ3JlYXRlciB0aGFuIGBfdmFsdWVXZWlgIHdoZW4gY29udmVydGVkIHRvIHdlaS4KICAgIC8vLyBXQVJOOiBNYXkgYmUgaW5jb3JyZWN0IGlmIGBfdmFsdWVXZWlgIGlzIGFib3ZlIDIqKjI1NC4KICAgIGZ1bmN0aW9uIHJvdW5kTW9uZXlVcFRvV2hvbGVGaW5uZXkodWludCBfdmFsdWVXZWkpIGNvbnN0YW50IGludGVybmFsCiAgICByZXR1cm5zICh1aW50IHZhbHVlRmlubmV5KSB7CiAgICAgICAgcmV0dXJuICgxIGZpbm5leSArIF92YWx1ZVdlaSAtIDEgd2VpKSAvIDEgZmlubmV5OwogICAgfQoKfQoKCi8vLyBAdGl0bGUgTWl4aW4gdG8gaGVscCBhbGxvdyB1c2VycyB0byBuYW1lIHRoaW5ncy4KY29udHJhY3QgTmFtZWFibGVNaXhpbiB7CgogICAgLy8gU3RyaW5nIG1hbmlwdWxhdGlvbiBpcyBleHBlbnNpdmUgaW4gdGhlIEVWTTsga2VlcCB0aGluZ3Mgc2hvcnQuCgogICAgdWludCBjb25zdGFudCBtaW5pbXVtTmFtZUxlbmd0aCA9IDE7CiAgICB1aW50IGNvbnN0YW50IG1heGltdW1OYW1lTGVuZ3RoID0gMjU7CiAgICBzdHJpbmcgY29uc3RhbnQgbmFtZURhdGFQcmVmaXggPSAiTkFNRToiOwoKICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGBfbmFtZWAgaXMgYSByZWFzb25hYmxlIGNob2ljZSBvZiBuYW1lLgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZi1hbmQtb25seS1pZiBgX25hbWVfYCBtZWV0cyB0aGUgY3JpdGVyaWEKICAgIC8vLyBiZWxvdywgb3IgZmFsc2Ugb3RoZXJ3aXNlOgogICAgLy8vICAgLSBubyBmZXdlciB0aGFuIDEgY2hhcmFjdGVyCiAgICAvLy8gICAtIG5vIG1vcmUgdGhhbiAyNSBjaGFyYWN0ZXJzCiAgICAvLy8gICAtIG5vIGNoYXJhY3RlcnMgb3RoZXIgdGhhbjoKICAgIC8vLyAgICAgLSAicm9tYW4iIGFscGhhYmV0IGxldHRlcnMgKEEtWiBhbmQgYS16KQogICAgLy8vICAgICAtIHdlc3Rlcm4gZGlnaXRzICgwLTkpCiAgICAvLy8gICAgIC0gInNhZmUiIHB1bmN0dWF0aW9uOiAhICggKSAtIC4gXyBTUEFDRQogICAgLy8vICAgLSBhdCBsZWFzdCBvbmUgbm9uLXB1bmN0dWF0aW9uIGNoYXJhY3RlcgogICAgLy8vIE5vdGUgdGhhdCB3ZSBkZWxpYmVyYXRlbHkgZXhjbHVkZSBjaGFyYWN0ZXJzIHdoaWNoIG1heSBjYXVzZQogICAgLy8vIHNlY3VyaXR5IHByb2JsZW1zIGZvciB3ZWJzaXRlcyBhbmQgZGF0YWJhc2VzIGlmIGVzY2FwaW5nIGlzCiAgICAvLy8gbm90IHBlcmZvcm1lZCBjb3JyZWN0bHksIHN1Y2ggYXMgPCA+ICIgYW5kICcuCiAgICAvLy8gQXBvbG9naWVzIGZvciB0aGUgbGFjayBvZiBub24tRW5nbGlzaCBsYW5ndWFnZSBzdXBwb3J0LgogICAgZnVuY3Rpb24gdmFsaWRhdGVOYW1lSW50ZXJuYWwoc3RyaW5nIF9uYW1lKSBjb25zdGFudCBpbnRlcm5hbAogICAgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG5hbWVCeXRlcyA9IGJ5dGVzKF9uYW1lKTsKICAgICAgICB1aW50IGxlbmd0aEJ5dGVzID0gbmFtZUJ5dGVzLmxlbmd0aDsKICAgICAgICBpZiAobGVuZ3RoQnl0ZXMgPCBtaW5pbXVtTmFtZUxlbmd0aCB8fAogICAgICAgICAgICBsZW5ndGhCeXRlcyA+IG1heGltdW1OYW1lTGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYm9vbCBmb3VuZE5vblB1bmN0dWF0aW9uID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoQnl0ZXM7IGkrKykgewogICAgICAgICAgICBieXRlIGIgPSBuYW1lQnl0ZXNbaV07CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIChiID49IDQ4ICYmIGIgPD0gNTcpIHx8IC8vIDAgLSA5CiAgICAgICAgICAgICAgICAoYiA+PSA2NSAmJiBiIDw9IDkwKSB8fCAvLyBBIC0gWgogICAgICAgICAgICAgICAgKGIgPj0gOTcgJiYgYiA8PSAxMjIpICAgLy8gYSAtIHoKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBmb3VuZE5vblB1bmN0dWF0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGIgPT0gMzIgfHwgLy8gc3BhY2UKICAgICAgICAgICAgICAgIGIgPT0gMzMgfHwgLy8gIQogICAgICAgICAgICAgICAgYiA9PSA0MCB8fCAvLyAoCiAgICAgICAgICAgICAgICBiID09IDQxIHx8IC8vICkKICAgICAgICAgICAgICAgIGIgPT0gNDUgfHwgLy8gLQogICAgICAgICAgICAgICAgYiA9PSA0NiB8fCAvLyAuCiAgICAgICAgICAgICAgICBiID09IDk1ICAgIC8vIF8KICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmb3VuZE5vblB1bmN0dWF0aW9uOwogICAgfQoKICAgIC8vIEV4dHJhY3QgYSBuYW1lIGZyb20gYnl0ZXMgYF9kYXRhYCAocHJlc3VtYWJseSBmcm9tIGBtc2cuZGF0YWApLAogICAgLy8gb3IgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBkYXRhIGlzIG5vdCBpbiB0aGUgZXhwZWN0ZWQgZm9ybWF0LgogICAgLy8gCiAgICAvLyBXZSB3YW50IHRvIG1ha2UgaXQgZWFzeSBmb3IgcGVvcGxlIHRvIG5hbWUgdGhpbmdzLCBldmVuIGlmCiAgICAvLyB0aGV5J3JlIG5vdCBjb21mb3J0YWJsZSBjYWxsaW5nIGZ1bmN0aW9ucyBvbiBjb250cmFjdHMuCiAgICAvLwogICAgLy8gU28gd2UgYWxsb3cgbmFtZXMgdG8gYmUgc2VudCB0byB0aGUgZmFsbGJhY2sgZnVuY3Rpb24gZW5jb2RlZAogICAgLy8gYXMgbWVzc2FnZSBkYXRhLgogICAgLy8KICAgIC8vIFVuZm9ydHVuYXRlbHksIHRoZSB3YXkgdGhlIEV0aGVyZXVtIEZ1bmN0aW9uIEFCSSB3b3JrcyBtZWFucyB3ZQogICAgLy8gbXVzdCBiZSBjYXJlZnVsIHRvIGF2b2lkIGNsYXNoZXMgYmV0d2VlbiBtZXNzYWdlIGRhdGEgdGhhdAogICAgLy8gcmVwcmVzZW50cyBvdXIgbmFtZXMgYW5kIG1lc3NhZ2UgZGF0YSB0aGF0IHJlcHJlc2VudHMgYSBjYWxsCiAgICAvLyB0byBhbiBleHRlcm5hbCBmdW5jdGlvbiAtIG90aGVyd2lzZToKICAgIC8vICAgYSkgc29tZSBuYW1lcyB3b24ndCBiZSB1c2FibGU7CiAgICAvLyAgIGIpIHNtYWxsIHBvc3NpYmlsaXR5IG9mIGEgcGhpc2hpbmcgYXR0YWNrIHdoZXJlIHVzZXJzIGFyZQogICAgLy8gICAgIHRyaWNrZWQgaW50byB1c2luZyBjZXJ0YWluIG5hbWVzIHdoaWNoIGNhdXNlIGFuIGV4dGVybmFsCiAgICAvLyAgICAgZnVuY3Rpb24gY2FsbCAtIGUuZy4gaWYgdGhlIGRhdGEgc2VudCB0byB0aGUgY29udHJhY3QgaXMKICAgIC8vICAgICBrZWNjYWsyNTYoIndpdGhkcmF3RnVuZHMoKSIpIHRoZW4gYSB3aXRoZHJhd2FsIHdpbGwgb2NjdXIuCiAgICAvLwogICAgLy8gU28gd2UgcmVxdWlyZSBhIHByZWZpeCAiTkFNRToiIGF0IHRoZSBzdGFydCBvZiB0aGUgbmFtZSAoZW5jb2RlZAogICAgLy8gaW4gQVNDSUkpIHdoZW4gc2VudCB2aWEgdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIC0gdGhpcyBwcmVmaXgKICAgIC8vIGRvZXNuJ3QgY2xhc2ggd2l0aCBhbnkgZXh0ZXJuYWwgZnVuY3Rpb24gc2lnbmF0dXJlIGhhc2hlcy4KICAgIC8vCiAgICAvLyBlLmcuIHdlYjMuZnJvbUFzY2lpKCdOQU1FOicgKyAnSm9lIEJsb2dncycpCiAgICAvLwogICAgLy8gV0FSTjogdGhpcyBkb2VzIG5vdCBjaGVjayB0aGUgbmFtZSBmb3IgInJlYXNvbmFibGVuZXNzIjsKICAgIC8vIHVzZSB2YWxpZGF0ZU5hbWVJbnRlcm5hbCgpIGZvciB0aGF0LgogICAgLy8KICAgIGZ1bmN0aW9uIGV4dHJhY3ROYW1lRnJvbURhdGEoYnl0ZXMgX2RhdGEpIGNvbnN0YW50IGludGVybmFsCiAgICByZXR1cm5zIChzdHJpbmcgZXh0cmFjdGVkTmFtZSkgewogICAgICAgIC8vIGNoZWNrIHByZWZpeCBwcmVzZW50CiAgICAgICAgdWludCBleHBlY3RlZFByZWZpeExlbmd0aCA9IChieXRlcyhuYW1lRGF0YVByZWZpeCkpLmxlbmd0aDsKICAgICAgICBpZiAoX2RhdGEubGVuZ3RoIDwgZXhwZWN0ZWRQcmVmaXhMZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZXhwZWN0ZWRQcmVmaXhMZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoKGJ5dGVzKG5hbWVEYXRhUHJlZml4KSlbaV0gIT0gX2RhdGFbaV0pIHsKICAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIGNvcHkgZGF0YSBhZnRlciBwcmVmaXgKICAgICAgICB1aW50IHBheWxvYWRMZW5ndGggPSBfZGF0YS5sZW5ndGggLSBleHBlY3RlZFByZWZpeExlbmd0aDsKICAgICAgICBpZiAocGF5bG9hZExlbmd0aCA8IG1pbmltdW1OYW1lTGVuZ3RoIHx8CiAgICAgICAgICAgIHBheWxvYWRMZW5ndGggPiBtYXhpbXVtTmFtZUxlbmd0aCkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgc3RyaW5nIG1lbW9yeSBuYW1lID0gbmV3IHN0cmluZyhwYXlsb2FkTGVuZ3RoKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGF5bG9hZExlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIChieXRlcyhuYW1lKSlbaV0gPSBfZGF0YVtleHBlY3RlZFByZWZpeExlbmd0aCArIGldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICAvLyBUdXJuIGEgc2hvcnQgbmFtZSBpbnRvIGEgImZ1enp5IGhhc2giIHdpdGggdGhlIHByb3BlcnR5CiAgICAvLyB0aGF0IGV4dHJlbWVseSBzaW1pbGFyIG5hbWVzIHdpbGwgaGF2ZSB0aGUgc2FtZSBmdXp6eSBoYXNoLgogICAgLy8KICAgIC8vIFRoaXMgaXMgdXNlZnVsIHRvOgogICAgLy8gIC0gc3RvcCBwZW9wbGUgY2hvb3NpbmcgbmFtZXMgd2hpY2ggZGlmZmVyIG9ubHkgaW4gY2FzZSBvcgogICAgLy8gICAgcHVuY3R1YXRpb24gYW5kIHdvdWxkIGxlYWQgdG8gY29uZnVzaW9uLgogICAgLy8gIC0gZmFjaWxpYXRlIHNlYXJjaGluZyBieSBuYW1lIHdpdGhvdXQgbmVlZGluZyBleGFjdCBtYXRjaAogICAgLy8KICAgIC8vIEZvciBleGFtcGxlLCB0aGVzZSBuYW1lcyBhbGwgaGF2ZSB0aGUgc2FtZSBmdXp6eSBoYXNoOgogICAgLy8KICAgIC8vICAiQmFuYW5hIgogICAgLy8gICJCQU5BTkEiCiAgICAvLyAgIkJhLW5hLW5hIgogICAgLy8gICIgIGJhbmFuYSAgIgogICAgLy8gICJCYW5hbmEgICAgICAgICAgICAgICAgICAgICAgICAuLiBzbyBsb25nIHRoZSBlbmQgaXMgaWdub3JlZCIKICAgIC8vCiAgICAvLyBPbiB0aGUgb3RoZXIgaGFuZCwgIkJhbmFuYTEiIGFuZCAiQSBCYW5hbmEiIGFyZSBkaWZmZXJlbnQgdG8KICAgIC8vIHRoZSBhYm92ZS4KICAgIC8vCiAgICAvLyBXQVJOOiB0aGlzIGlzIGxpa2VseSB0byB3b3JrIHBvb3JseSBvbiBuYW1lcyB0aGF0IGRvIG5vdCBtZWV0CiAgICAvLyB0aGUgdmFsaWRhdGVOYW1lSW50ZXJuYWwoKSB0ZXN0LgogICAgLy8KICAgIGZ1bmN0aW9uIGNvbXB1dGVOYW1lRnV6enlIYXNoKHN0cmluZyBfbmFtZSkgY29uc3RhbnQgaW50ZXJuYWwKICAgIHJldHVybnMgKHVpbnQgZnV6enlIYXNoKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG5hbWVCeXRlcyA9IGJ5dGVzKF9uYW1lKTsKICAgICAgICB1aW50IGggPSAwOwogICAgICAgIHVpbnQgbGVuID0gbmFtZUJ5dGVzLmxlbmd0aDsKICAgICAgICBpZiAobGVuID4gbWF4aW11bU5hbWVMZW5ndGgpIHsKICAgICAgICAgICAgbGVuID0gbWF4aW11bU5hbWVMZW5ndGg7CiAgICAgICAgfQogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgbXVsID0gMTI4OwogICAgICAgICAgICBieXRlIGIgPSBuYW1lQnl0ZXNbaV07CiAgICAgICAgICAgIHVpbnQgdWIgPSB1aW50KGIpOwogICAgICAgICAgICBpZiAoYiA+PSA0OCAmJiBiIDw9IDU3KSB7CiAgICAgICAgICAgICAgICAvLyAwLTkKICAgICAgICAgICAgICAgIGggPSBoICogbXVsICsgdWI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYiA+PSA2NSAmJiBiIDw9IDkwKSB7CiAgICAgICAgICAgICAgICAvLyBBLVoKICAgICAgICAgICAgICAgIGggPSBoICogbXVsICsgdWI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYiA+PSA5NyAmJiBiIDw9IDEyMikgewogICAgICAgICAgICAgICAgLy8gZm9sZCBhLXogdG8gQS1aCiAgICAgICAgICAgICAgICB1aW50IHVwcGVyID0gdWIgLSAzMjsKICAgICAgICAgICAgICAgIGggPSBoICogbXVsICsgdXBwZXI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgb3RoZXJzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGg7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBNaXhpbiB0byBoZWxwIGRlZmluZSB0aGUgcnVsZXMgb2YgYSB0aHJvbmUuCmNvbnRyYWN0IFRocm9uZVJ1bGVzTWl4aW4gewoKICAgIC8vIFNlZSBXb3JsZC5jcmVhdGVLaW5nZG9tKC4uKSBmb3IgZG9jdW1lbnRhdGlvbi4KICAgIHN0cnVjdCBUaHJvbmVSdWxlcyB7CiAgICAgICAgdWludCBzdGFydGluZ0NsYWltUHJpY2VXZWk7CiAgICAgICAgdWludCBtYXhpbXVtQ2xhaW1QcmljZVdlaTsKICAgICAgICB1aW50IGNsYWltUHJpY2VBZGp1c3RQZXJjZW50OwogICAgICAgIHVpbnQgY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzOwogICAgICAgIHVpbnQgY29tbWlzc2lvblBlclRob3VzYW5kOwogICAgfQoKfQoKCi8vLyBAdGl0bGUgTWFpbnRhaW5zIHRoZSB0aHJvbmUgb2YgYSBraW5nZG9tLgpjb250cmFjdCBLaW5nZG9tIGlzCiAgUmVlbnRyeVByb3RlY3Rvck1peGluLAogIENhcmVmdWxTZW5kZXJNaXhpbiwKICBGdW5kc0hvbGRlck1peGluLAogIE1vbmV5Um91bmRlck1peGluLAogIE5hbWVhYmxlTWl4aW4sCiAgVGhyb25lUnVsZXNNaXhpbiB7CgogICAgLy8gZS5nLiAiS2luZyBvZiB0aGUgRXRoZXIiCiAgICBzdHJpbmcgcHVibGljIGtpbmdkb21OYW1lOwoKICAgIC8vIFRoZSBXb3JsZCBjb250cmFjdCB1c2VkIHRvIGNyZWF0ZSB0aGlzIGtpbmdkb20sIG9yIDB4MCBpZiBub25lLgogICAgYWRkcmVzcyBwdWJsaWMgd29ybGQ7CgogICAgLy8gVGhlIHJ1bGVzIHRoYXQgZ292ZXJuIHRoaXMga2luZ2RvbSAtIHNlZSBUaHJvbmVSdWxlc01peGluLgogICAgVGhyb25lUnVsZXMgcHVibGljIHJ1bGVzOwoKICAgIC8vIFNvbWVvbmUgd2hvIGhhcyBydWxlZCAob3IgaXMgcnVsaW5nKSBvdXIga2luZ2RvbS4KICAgIHN0cnVjdCBNb25hcmNoIHsKICAgICAgICAvLyB3aGVyZSB0byBzZW5kIHRoZWlyIGNvbXBlbnNhdGlvbgogICAgICAgIGFkZHJlc3MgY29tcGVuc2F0aW9uQWRkcmVzczsKICAgICAgICAvLyB0aGVpciBuYW1lCiAgICAgICAgc3RyaW5nIG5hbWU7CiAgICAgICAgLy8gd2hlbiB0aGV5IGJlY2FtZSBvdXIgcnVsZXIKICAgICAgICB1aW50IGNvcm9uYXRpb25UaW1lc3RhbXA7CiAgICAgICAgLy8gdGhlIGNsYWltIHByaWNlIHBhaWQgKGV4Y2x1ZGluZyBhbnkgb3Zlci1wYXltZW50KQogICAgICAgIHVpbnQgY2xhaW1QcmljZVdlaTsKICAgICAgICAvLyB0aGUgY29tcGVuc2F0aW9uIHNlbnQgdG8gb3IgaGVsZCBmb3IgdGhlbSBzbyBmYXIKICAgICAgICB1aW50IGNvbXBlbnNhdGlvbldlaTsKICAgIH0KCiAgICAvLyBUaGUgZmlyc3QgcnVsZXIgaXMgbnVtYmVyIDE7IHRoZSB6ZXJvLXRoIGVudHJ5IGlzIGEgZHVtbXkgZW50cnkuCiAgICBNb25hcmNoW10gcHVibGljIG1vbmFyY2hzQnlOdW1iZXI7CgogICAgLy8gVGhlIHRvcFdpemFyZCBlYXJucyBoYWxmIHRoZSBjb21taXNzaW9uLgogICAgLy8gVGhleSBhcmUgbm9ybWFsbHkgdGhlIG93bmVyIG9mIHRoZSBXb3JsZCBjb250cmFjdC4KICAgIGFkZHJlc3MgcHVibGljIHRvcFdpemFyZDsKCiAgICAvLyBUaGUgc3ViV2l6YXJkIGVhcm5zIGhhbGYgdGhlIGNvbW1pc3Npb24uCiAgICAvLyBUaGV5IGFyZSBub3JtYWxseSB0aGUgY3JlYXRvciBvZiB0aGlzIEtpbmdkb20uCiAgICAvLyBUaGUgdG9wV2l6YXJkIGFuZCBzdWJXaXphcmQgY2FuIGJlIHRoZSBzYW1lIGFkZHJlc3MuCiAgICBhZGRyZXNzIHB1YmxpYyBzdWJXaXphcmQ7CgogICAgLy8gTkI6IHdlIGFsc28gaGF2ZSBhIGBmdW5kc2AgbWFwcGluZyBmcm9tIEZ1bmRzSG9sZGVyTWl4aW4sCiAgICAvLyBhbmQgYSByZW50cnlQcm90ZWN0b3IgZnJvbSBSZWVudHJ5UHJvdGVjdG9yTWl4aW4uCgogICAgZXZlbnQgVGhyb25lQ2xhaW1lZEV2ZW50KHVpbnQgbW9uYXJjaE51bWJlcik7CiAgICBldmVudCBDb21wZW5zYXRpb25TZW50RXZlbnQoYWRkcmVzcyB0b0FkZHJlc3MsIHVpbnQgdmFsdWVXZWkpOwogICAgZXZlbnQgQ29tcGVuc2F0aW9uRmFpbEV2ZW50KGFkZHJlc3MgdG9BZGRyZXNzLCB1aW50IHZhbHVlV2VpKTsKICAgIGV2ZW50IENvbW1pc3Npb25FYXJuZWRFdmVudChhZGRyZXNzIGJ5QWRkcmVzcywgdWludCB2YWx1ZVdlaSk7CiAgICBldmVudCBXaXphcmRSZXBsYWNlZEV2ZW50KGFkZHJlc3Mgb2xkV2l6YXJkLCBhZGRyZXNzIG5ld1dpemFyZCk7CiAgICAvLyBOQjogd2UgYWxzbyBoYXZlIGEgYEZ1bmRzV2l0aGRyYXduRXZlbnRgIGZyb20gRnVuZHNIb2xkZXJNaXhpbgoKICAgIC8vIFdBUk4gLSBkb2VzIE5PVCB2YWxpZGF0ZSBhcmd1bWVudHM7IHlvdSBNVVNUIGVpdGhlciBjYWxsCiAgICAvLyBLaW5nZG9tRmFjdG9yeS52YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMoKSBvciBjcmVhdGUKICAgIC8vIHRoZSBLaW5nZG9tIHZpYSBLaW5nZG9tRmFjdG9yeS9Xb3JsZCdzIGNyZWF0ZUtpbmdkb20oKS4KICAgIC8vIFNlZSBXb3JsZC5jcmVhdGVLaW5nZG9tKC4uKSBmb3IgcGFyYW1ldGVyIGRvY3VtZW50YXRpb24uCiAgICBmdW5jdGlvbiBLaW5nZG9tKAogICAgICAgIHN0cmluZyBfa2luZ2RvbU5hbWUsCiAgICAgICAgYWRkcmVzcyBfd29ybGQsCiAgICAgICAgYWRkcmVzcyBfdG9wV2l6YXJkLAogICAgICAgIGFkZHJlc3MgX3N1YldpemFyZCwKICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWksCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsCiAgICAgICAgdWludCBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZAogICAgKSB7CiAgICAgICAga2luZ2RvbU5hbWUgPSBfa2luZ2RvbU5hbWU7CiAgICAgICAgd29ybGQgPSBfd29ybGQ7CiAgICAgICAgdG9wV2l6YXJkID0gX3RvcFdpemFyZDsKICAgICAgICBzdWJXaXphcmQgPSBfc3ViV2l6YXJkOwogICAgICAgIHJ1bGVzID0gVGhyb25lUnVsZXMoCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgICAgIF9tYXhpbXVtQ2xhaW1QcmljZVdlaSwKICAgICAgICAgICAgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LAogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgICAgICBfY29tbWlzc2lvblBlclRob3VzYW5kCiAgICAgICAgKTsKICAgICAgICAvLyBXZSBudW1iZXIgdGhlIG1vbmFyY2hzIHN0YXJ0aW5nIGZyb20gMTsgaXQncyBzb21ldGltZXMgdXNlZnVsCiAgICAgICAgLy8gdG8gdXNlIHplcm8gPSBpbnZhbGlkLCBzbyBwdXQgaW4gYSBkdW1teSBlbnRyeSBmb3IgbnVtYmVyIDAuCiAgICAgICAgbW9uYXJjaHNCeU51bWJlci5wdXNoKAogICAgICAgICAgICBNb25hcmNoKAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgICIiLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwCiAgICAgICAgICAgICkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIG51bWJlck9mTW9uYXJjaHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRvdGFsQ291bnQpIHsKICAgICAgICAvLyB6ZXJvLXRoIGVudHJ5IGlzIGludmFsaWQKICAgICAgICByZXR1cm4gbW9uYXJjaHNCeU51bWJlci5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vIEZhbHNlIGlmIGVpdGhlciB0aGVyZSBhcmUgbm8gbW9uYXJjaHMsIG9yIGlmIHRoZSBsYXRlc3QgbW9uYXJjaAogICAgLy8gaGFzIHJlaWduZWQgdG9vIGxvbmcgYW5kIGJlZW4gc3RydWNrIGRvd24gYnkgdGhlIGN1cnNlLgogICAgZnVuY3Rpb24gaXNMaXZpbmdNb25hcmNoKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGl2ZSkgewogICAgICAgIGlmIChudW1iZXJPZk1vbmFyY2hzKCkgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHVpbnQgcmVpZ25TdGFydGVkVGltZXN0YW1wID0gbGF0ZXN0TW9uYXJjaEludGVybmFsKCkuY29yb25hdGlvblRpbWVzdGFtcDsKICAgICAgICBpZiAobm93IDwgcmVpZ25TdGFydGVkVGltZXN0YW1wKSB7CiAgICAgICAgICAgIC8vIFNob3VsZCBub3QgYmUgcG9zc2libGUsIHRoaW5rIG1pbmVycyByZWplY3QgYmxvY2tzIHdpdGgKICAgICAgICAgICAgLy8gdGltZXN0YW1wcyB0aGF0IGdvIGJhY2t3YXJkcz8gQnV0IHNvbWUgZHJpZnQgcG9zc2libGUgYW5kCiAgICAgICAgICAgIC8vIGl0IG5lZWRzIGhhbmRsaW5nIGZvciB1bnNpZ25lZCBvdmVyZmxvdyBhdWRpdCBjaGVja3MgLi4uCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB1aW50IGVsYXBzZWRSZWlnbkR1cmF0aW9uU2Vjb25kcyA9IG5vdyAtIHJlaWduU3RhcnRlZFRpbWVzdGFtcDsKICAgICAgICBpZiAoZWxhcHNlZFJlaWduRHVyYXRpb25TZWNvbmRzID4gcnVsZXMuY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgSG93IG11Y2ggeW91IG11c3QgcGF5IHRvIGNsYWltIHRoZSB0aHJvbmUgbm93LCBpbiB3ZWkuCiAgICBmdW5jdGlvbiBjdXJyZW50Q2xhaW1QcmljZVdlaSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcHJpY2VJbldlaSkgewogICAgICAgIGlmICghaXNMaXZpbmdNb25hcmNoKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHJ1bGVzLnN0YXJ0aW5nQ2xhaW1QcmljZVdlaTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50IGxhc3RDbGFpbVByaWNlV2VpID0gbGF0ZXN0TW9uYXJjaEludGVybmFsKCkuY2xhaW1QcmljZVdlaTsKICAgICAgICAgICAgLy8gbm8gZGFuZ2VyIG9mIG92ZXJmbG93IGJlY2F1c2UgY2xhaW0gcHJpY2UgbmV2ZXIgZ2V0cyB0aGF0IGhpZ2gKICAgICAgICAgICAgdWludCBuZXdDbGFpbVByaWNlID0KICAgICAgICAgICAgICAobGFzdENsYWltUHJpY2VXZWkgKiAoMTAwICsgcnVsZXMuY2xhaW1QcmljZUFkanVzdFBlcmNlbnQpKSAvIDEwMDsKICAgICAgICAgICAgbmV3Q2xhaW1QcmljZSA9IHJvdW5kTW9uZXlEb3duTmljZWx5KG5ld0NsYWltUHJpY2UpOwogICAgICAgICAgICBpZiAobmV3Q2xhaW1QcmljZSA8IHJ1bGVzLnN0YXJ0aW5nQ2xhaW1QcmljZVdlaSkgewogICAgICAgICAgICAgICAgbmV3Q2xhaW1QcmljZSA9IHJ1bGVzLnN0YXJ0aW5nQ2xhaW1QcmljZVdlaTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3Q2xhaW1QcmljZSA+IHJ1bGVzLm1heGltdW1DbGFpbVByaWNlV2VpKSB7CiAgICAgICAgICAgICAgICBuZXdDbGFpbVByaWNlID0gcnVsZXMubWF4aW11bUNsYWltUHJpY2VXZWk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ld0NsYWltUHJpY2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIEhvdyBtdWNoIHlvdSBtdXN0IHBheSB0byBjbGFpbSB0aGUgdGhyb25lIG5vdywgaW4gZmlubmV5LgogICAgZnVuY3Rpb24gY3VycmVudENsYWltUHJpY2VJbkZpbm5leSgpIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50IHByaWNlSW5GaW5uZXkpIHsKICAgICAgICB1aW50IHZhbHVlV2VpID0gY3VycmVudENsYWltUHJpY2VXZWkoKTsKICAgICAgICByZXR1cm4gcm91bmRNb25leVVwVG9XaG9sZUZpbm5leSh2YWx1ZVdlaSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYSBuYW1lIGNhbiBiZSB1c2VkIGFzIGEgbW9uYXJjaCBuYW1lLgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgbmFtZSBzYXRpc2ZpZXMgdGhlIGNyaXRlcmlhIG9mOgogICAgLy8vICAgLSBubyBmZXdlciB0aGFuIDEgY2hhcmFjdGVyCiAgICAvLy8gICAtIG5vIG1vcmUgdGhhbiAyNSBjaGFyYWN0ZXJzCiAgICAvLy8gICAtIG5vIGNoYXJhY3RlcnMgb3RoZXIgdGhhbjoKICAgIC8vLyAgICAgLSAicm9tYW4iIGFscGhhYmV0IGxldHRlcnMgKEEtWiBhbmQgYS16KQogICAgLy8vICAgICAtIHdlc3Rlcm4gZGlnaXRzICgwLTkpCiAgICAvLy8gICAgIC0gInNhZmUiIHB1bmN0dWF0aW9uOiAhICggKSAtIC4gXyBTUEFDRQogICAgZnVuY3Rpb24gdmFsaWRhdGVQcm9wb3NlZE1vbmFyY2hOYW1lKHN0cmluZyBfbW9uYXJjaE5hbWUpIGNvbnN0YW50CiAgICByZXR1cm5zIChib29sIGFsbG93ZWQpIHsKICAgICAgICByZXR1cm4gdmFsaWRhdGVOYW1lSW50ZXJuYWwoX21vbmFyY2hOYW1lKTsKICAgIH0KCiAgICAvLyBHZXQgZGV0YWlscyBvZiB0aGUgbGF0ZXN0IG1vbmFyY2ggKGV2ZW4gaWYgdGhleSBhcmUgZGVhZCkuCiAgICAvLwogICAgLy8gV2UgZG9uJ3QgZXhwb3NlIGV4dGVybmFsbHkgYmVjYXVzZSByZXR1cm5pbmcgc3RydWN0cyBpcyBub3Qgd2VsbAogICAgLy8gc3VwcG9ydGVkIGluIHRoZSBBQkkgKHN0cmFuZ2UgdGhhdCBtb25hcmNoc0J5TnVtYmVyIGFycmF5IHdvcmtzCiAgICAvLyBmaW5lIHRob3VnaCkuIE5vdGUgdGhhdCB0aGUgcmVmZXJlbmNlIHJldHVybmVkIGlzIHdyaXRhYmxlIC0gaXQKICAgIC8vIGNhbiBiZSB1c2VkIHRvIHVwZGF0ZSBkZXRhaWxzIG9mIHRoZSBsYXRlc3QgbW9uYXJjaC4KICAgIC8vIFdBUk46IHlvdSBzaG91bGQgY2hlY2sgbnVtYmVyT2ZNb25hcmNocygpID4gMCBmaXJzdC4KICAgIGZ1bmN0aW9uIGxhdGVzdE1vbmFyY2hJbnRlcm5hbCgpIGNvbnN0YW50IGludGVybmFsCiAgICByZXR1cm5zIChNb25hcmNoIHN0b3JhZ2UgbW9uYXJjaCkgewogICAgICAgIHJldHVybiBtb25hcmNoc0J5TnVtYmVyW21vbmFyY2hzQnlOdW1iZXIubGVuZ3RoIC0gMV07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2xhaW0gdGhyb25lIGJ5IHNlbmRpbmcgZnVuZHMgdG8gdGhlIGNvbnRyYWN0LgogICAgLy8vIEFueSBmdXR1cmUgY29tcGVuc2F0aW9uIGVhcm5lZCB3aWxsIGJlIHNlbnQgdG8gdGhlIHNlbmRlcidzCiAgICAvLy8gYWRkcmVzcyAoYG1zZy5zZW5kZXJgKS4KICAgIC8vLyBTZW5kaW5nIGZyb20gYSBjb250cmFjdCBpcyBub3QgcmVjb21tZW5kZWQgdW5sZXNzIHlvdSBrbm93CiAgICAvLy8gd2hhdCB5b3UncmUgZG9pbmcgKGFuZCB5b3UndmUgdGVzdGVkIGl0KS4KICAgIC8vLyBJZiBubyBtZXNzYWdlIGRhdGEgaXMgc3VwcGxpZWQsIHRoZSB0aHJvbmUgd2lsbCBiZSBjbGFpbWVkIGluCiAgICAvLy8gdGhlIG5hbWUgb2YgIkFub255bW91cyIuIFRvIHN1cHBseSBhIG5hbWUsIHNlbmQgZGF0YSBlbmNvZGVkCiAgICAvLy8gdXNpbmcgd2ViMy5mcm9tQXNjaWkoJ05BTUU6JyArICd5b3VyX2Nob3Nlbl92YWxpZF9uYW1lJykuCiAgICAvLy8gU2VuZGVyIG11c3QgaW5jbHVkZSBwYXltZW50IGVxdWFsIHRvIGN1cnJlbnRDbGFpbVByaWNlV2VpKCkuCiAgICAvLy8gV2lsbCBjb25zdW1lIHVwIHRvIH4zMDAsMDAwIGdhcy4KICAgIC8vLyBXaWxsIHRocm93IGFuIGVycm9yIGlmOgogICAgLy8vICAgLSBuYW1lIGlzIGludmFsaWQgKHNlZSBgdmFsaWRhdGVQcm9wb3NlZE1vbmFyY2hOYW1lKHN0cmluZylgKQogICAgLy8vICAgLSBwYXltZW50IGlzIHRvbyBsb3cgb3IgdG9vIGhpZ2gKICAgIC8vLyBQcm9kdWNlcyBldmVudHM6CiAgICAvLy8gICAtIGBUaHJvbmVDbGFpbWVkRXZlbnRgCiAgICAvLy8gICAtIGBDb21wZW5zYXRpb25TZW50RXZlbnRgIC8gYENvbXBlbnNhdGlvbkZhaWxFdmVudGAKICAgIC8vLyAgIC0gYENvbW1pc3Npb25FYXJuZWRFdmVudGAKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICBleHRlcm5hbEVudGVyKCk7CiAgICAgICAgZmFsbGJhY2tSUCgpOwogICAgICAgIGV4dGVybmFsTGVhdmUoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDbGFpbSB0aHJvbmUgaW4gdGhlIGdpdmVuIGBfbW9uYXJjaE5hbWVgLgogICAgLy8vIEFueSBmdXR1cmUgY29tcGVuc2F0aW9uIGVhcm5lZCB3aWxsIGJlIHNlbnQgdG8gdGhlIGNhbGxlcidzCiAgICAvLy8gYWRkcmVzcyAoYG1zZy5zZW5kZXJgKS4KICAgIC8vLyBDYWxsZXIgbXVzdCBpbmNsdWRlIHBheW1lbnQgZXF1YWwgdG8gY3VycmVudENsYWltUHJpY2VXZWkoKS4KICAgIC8vLyBDYWxsaW5nIGZyb20gYSBjb250cmFjdCBpcyBub3QgcmVjb21tZW5kZWQgdW5sZXNzIHlvdSBrbm93CiAgICAvLy8gd2hhdCB5b3UncmUgZG9pbmcgKGFuZCB5b3UndmUgdGVzdGVkIGl0KS4KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gfjMwMCwwMDAgZ2FzLgogICAgLy8vIFdpbGwgdGhyb3cgYW4gZXJyb3IgaWY6CiAgICAvLy8gICAtIG5hbWUgaXMgaW52YWxpZCAoc2VlIGB2YWxpZGF0ZVByb3Bvc2VkTW9uYXJjaE5hbWUoc3RyaW5nKWApCiAgICAvLy8gICAtIHBheW1lbnQgaXMgdG9vIGxvdyBvciB0b28gaGlnaAogICAgLy8vIFByb2R1Y2VzIGV2ZW50czoKICAgIC8vLyAgIC0gYFRocm9uZUNsYWltZWRFdmVudAogICAgLy8vICAgLSBgQ29tcGVuc2F0aW9uU2VudEV2ZW50YCAvIGBDb21wZW5zYXRpb25GYWlsRXZlbnRgCiAgICAvLy8gICAtIGBDb21taXNzaW9uRWFybmVkRXZlbnRgCiAgICBmdW5jdGlvbiBjbGFpbVRocm9uZShzdHJpbmcgX21vbmFyY2hOYW1lKSB7CiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOwogICAgICAgIGNsYWltVGhyb25lUlAoX21vbmFyY2hOYW1lKTsKICAgICAgICBleHRlcm5hbExlYXZlKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVXNlZCBieSBlaXRoZXIgdGhlIHRvcFdpemFyZCBvciBzdWJXaXphcmQgdG8gdHJhbnNmZXIKICAgIC8vLyBhbGwgcmlnaHRzIHRvIGZ1dHVyZSBjb21taXNzaW9ucyB0byB0aGUgYF9yZXBsYWNlbWVudGAgd2l6YXJkLgogICAgLy8vIFdBUk46IFRoZSBvcmlnaW5hbCB3aXphcmQgcmV0YWlucyBvd25lcnNoaXAgb2YgYW55IHBhc3QKICAgIC8vLyBjb21taXNzaW9uIGhlbGQgZm9yIHRoZW0gaW4gdGhlIGBmdW5kc2AgbWFwcGluZywgd2hpY2ggdGhleQogICAgLy8vIGNhbiBzdGlsbCB3aXRoZHJhdy4KICAgIC8vLyBQcm9kdWNlcyBldmVudCBXaXphcmRSZXBsYWNlZEV2ZW50LgogICAgZnVuY3Rpb24gcmVwbGFjZVdpemFyZChhZGRyZXNzIF9yZXBsYWNlbWVudCkgewogICAgICAgIGV4dGVybmFsRW50ZXIoKTsKICAgICAgICByZXBsYWNlV2l6YXJkUlAoX3JlcGxhY2VtZW50KTsKICAgICAgICBleHRlcm5hbExlYXZlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZmFsbGJhY2tSUCgpIGludGVybmFsIHsKICAgICAgICBpZiAobXNnLmRhdGEubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgY2xhaW1UaHJvbmVSUCgiQW5vbnltb3VzIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyaW5nIG1lbW9yeSBfbW9uYXJjaE5hbWUgPSBleHRyYWN0TmFtZUZyb21EYXRhKG1zZy5kYXRhKTsKICAgICAgICAgICAgY2xhaW1UaHJvbmVSUChfbW9uYXJjaE5hbWUpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2xhaW1UaHJvbmVSUCgKICAgICAgICBzdHJpbmcgX21vbmFyY2hOYW1lCiAgICApIGludGVybmFsIHsKCiAgICAgICAgYWRkcmVzcyBfY29tcGVuc2F0aW9uQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIGlmICghdmFsaWRhdGVOYW1lSW50ZXJuYWwoX21vbmFyY2hOYW1lKSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIGlmIChfY29tcGVuc2F0aW9uQWRkcmVzcyA9PSAwIHx8CiAgICAgICAgICAgIF9jb21wZW5zYXRpb25BZGRyZXNzID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICB1aW50IHBhaWRXZWkgPSBtc2cudmFsdWU7CiAgICAgICAgdWludCBwcmljZVdlaSA9IGN1cnJlbnRDbGFpbVByaWNlV2VpKCk7CiAgICAgICAgaWYgKHBhaWRXZWkgPCBwcmljZVdlaSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgLy8gTWFrZSBpdCBlYXN5IGZvciBwZW9wbGUgdG8gcGF5IHVzaW5nIGEgd2hvbGUgbnVtYmVyIG9mIGZpbm5leSwKICAgICAgICAvLyB3aGljaCBjb3VsZCBiZSBhIHRlZW55IGJpdCBoaWdoZXIgdGhhbiB0aGUgcmF3IHdlaSB2YWx1ZS4KICAgICAgICB1aW50IGV4Y2Vzc1dlaSA9IHBhaWRXZWkgLSBwcmljZVdlaTsKICAgICAgICBpZiAoZXhjZXNzV2VpID4gMSBmaW5uZXkpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQgY29tcGVuc2F0aW9uV2VpOwogICAgICAgIHVpbnQgY29tbWlzc2lvbldlaTsKICAgICAgICBpZiAoIWlzTGl2aW5nTW9uYXJjaCgpKSB7CiAgICAgICAgICAgIC8vIGRlYWQgbWVuIGdldCBubyBjb21wZW5zYXRpb24KICAgICAgICAgICAgY29tbWlzc2lvbldlaSA9IHBhaWRXZWk7CiAgICAgICAgICAgIGNvbXBlbnNhdGlvbldlaSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29tbWlzc2lvbldlaSA9IChwYWlkV2VpICogcnVsZXMuY29tbWlzc2lvblBlclRob3VzYW5kKSAvIDEwMDA7CiAgICAgICAgICAgIGNvbXBlbnNhdGlvbldlaSA9IHBhaWRXZWkgLSBjb21taXNzaW9uV2VpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbW1pc3Npb25XZWkgIT0gMCkgewogICAgICAgICAgICByZWNvcmRDb21taXNzaW9uRWFybmVkKGNvbW1pc3Npb25XZWkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbXBlbnNhdGlvbldlaSAhPSAwKSB7CiAgICAgICAgICAgIGNvbXBlbnNhdGVMYXRlc3RNb25hcmNoKGNvbXBlbnNhdGlvbldlaSk7CiAgICAgICAgfQoKICAgICAgICAvLyBJbiBjYXNlIG9mIGFueSB0ZWVueSBleGNlc3MsIHdlIHVzZSB0aGUgb2ZmaWNpYWwgcHJpY2UgaGVyZQogICAgICAgIC8vIHNpbmNlIHRoYXQgc2hvdWxkIGRldGVybWluZSB0aGUgbmV3IGNsYWltIHByaWNlLCBub3QgcGFpZFdlaS4KICAgICAgICBtb25hcmNoc0J5TnVtYmVyLnB1c2goTW9uYXJjaCgKICAgICAgICAgICAgX2NvbXBlbnNhdGlvbkFkZHJlc3MsCiAgICAgICAgICAgIF9tb25hcmNoTmFtZSwKICAgICAgICAgICAgbm93LAogICAgICAgICAgICBwcmljZVdlaSwKICAgICAgICAgICAgMAogICAgICAgICkpOwoKICAgICAgICBUaHJvbmVDbGFpbWVkRXZlbnQobW9uYXJjaHNCeU51bWJlci5sZW5ndGggLSAxKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXBsYWNlV2l6YXJkUlAoYWRkcmVzcyByZXBsYWNlbWVudCkgaW50ZXJuYWwgewogICAgICAgIGlmIChtc2cudmFsdWUgIT0gMCkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgYm9vbCByZXBsYWNlZE9rID0gZmFsc2U7CiAgICAgICAgYWRkcmVzcyBvbGRXaXphcmQ7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gdG9wV2l6YXJkKSB7CiAgICAgICAgICAgIG9sZFdpemFyZCA9IHRvcFdpemFyZDsKICAgICAgICAgICAgdG9wV2l6YXJkID0gcmVwbGFjZW1lbnQ7CiAgICAgICAgICAgIFdpemFyZFJlcGxhY2VkRXZlbnQob2xkV2l6YXJkLCByZXBsYWNlbWVudCk7CiAgICAgICAgICAgIHJlcGxhY2VkT2sgPSB0cnVlOwogICAgICAgIH0KICAgICAgICAvLyBDYXJlZnVsIC0gdG9wV2l6YXJkIGFuZCBzdWJXaXphcmQgY2FuIGJlIHRoZSBzYW1lIGFkZHJlc3MsCiAgICAgICAgLy8gaW4gd2hpY2ggY2FzZSB3ZSBtdXN0IHJlcGxhY2UgYm90aC4KICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBzdWJXaXphcmQpIHsKICAgICAgICAgICAgb2xkV2l6YXJkID0gc3ViV2l6YXJkOwogICAgICAgICAgICBzdWJXaXphcmQgPSByZXBsYWNlbWVudDsKICAgICAgICAgICAgV2l6YXJkUmVwbGFjZWRFdmVudChvbGRXaXphcmQsIHJlcGxhY2VtZW50KTsKICAgICAgICAgICAgcmVwbGFjZWRPayA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmICghcmVwbGFjZWRPaykgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgLy8gQWxsb3cgY29tbWlzc2lvbiBmdW5kcyB0byBidWlsZCB1cCBpbiBjb250cmFjdCBmb3IgdGhlIHdpemFyZHMKICAgIC8vIHRvIHdpdGhkcmF3IChjYXJlZnVsbHkgcmluZy1mZW5jZWQpLgogICAgZnVuY3Rpb24gcmVjb3JkQ29tbWlzc2lvbkVhcm5lZCh1aW50IF9jb21taXNzaW9uV2VpKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gZ2l2ZSB0aGUgc3ViV2l6YXJkIGFueSAib2RkIiBzaW5nbGUgd2VpCiAgICAgICAgdWludCB0b3BXaXphcmRXZWkgPSBfY29tbWlzc2lvbldlaSAvIDI7CiAgICAgICAgdWludCBzdWJXaXphcmRXZWkgPSBfY29tbWlzc2lvbldlaSAtIHRvcFdpemFyZFdlaTsKICAgICAgICBmdW5kc1t0b3BXaXphcmRdICs9IHRvcFdpemFyZFdlaTsKICAgICAgICBDb21taXNzaW9uRWFybmVkRXZlbnQodG9wV2l6YXJkLCB0b3BXaXphcmRXZWkpOwogICAgICAgIGZ1bmRzW3N1YldpemFyZF0gKz0gc3ViV2l6YXJkV2VpOwogICAgICAgIENvbW1pc3Npb25FYXJuZWRFdmVudChzdWJXaXphcmQsIHN1YldpemFyZFdlaSk7CiAgICB9CgogICAgLy8gU2VuZCBjb21wZW5zYXRpb24gdG8gbGF0ZXN0IG1vbmFyY2ggKG9yIGhvbGQgZnVuZHMgZm9yIHRoZW0KICAgIC8vIGlmIGNhbm5vdCB0aHJvdWdoIG5vIGZhdWx0IG9mIGN1cnJlbnQgY2FsbGVyKS4KICAgIGZ1bmN0aW9uIGNvbXBlbnNhdGVMYXRlc3RNb25hcmNoKHVpbnQgX2NvbXBlbnNhdGlvbldlaSkgaW50ZXJuYWwgewogICAgICAgIGFkZHJlc3MgY29tcGVuc2F0aW9uQWRkcmVzcyA9CiAgICAgICAgICBsYXRlc3RNb25hcmNoSW50ZXJuYWwoKS5jb21wZW5zYXRpb25BZGRyZXNzOwogICAgICAgIC8vIHJlY29yZCB0aGF0IHdlIGNvbXBlbnNhdGVkIHRoZW0KICAgICAgICBsYXRlc3RNb25hcmNoSW50ZXJuYWwoKS5jb21wZW5zYXRpb25XZWkgPSBfY29tcGVuc2F0aW9uV2VpOwogICAgICAgIC8vIFdBUk46IGlmIHRoZSBsYXRlc3QgbW9uYXJjaCBpcyBhIGNvbnRyYWN0IHdob3NlIGZhbGxiYWNrCiAgICAgICAgLy8gZnVuY3Rpb24gbmVlZHMgbW9yZSAyNTMwMCBnYXMgdGhhbiB0aGVuIHRoZXkgd2lsbCBOT1QKICAgICAgICAvLyByZWNlaXZlIGNvbXBlbnNhdGlvbiBhdXRvbWF0aWNhbGx5LgogICAgICAgIGJvb2wgc2VudE9rID0gY2FyZWZ1bFNlbmRXaXRoRml4ZWRHYXMoCiAgICAgICAgICAgIGNvbXBlbnNhdGlvbkFkZHJlc3MsCiAgICAgICAgICAgIF9jb21wZW5zYXRpb25XZWksCiAgICAgICAgICAgIHN1Z2dlc3RlZEV4dHJhR2FzVG9JbmNsdWRlV2l0aFNlbmRzCiAgICAgICAgKTsKICAgICAgICBpZiAoc2VudE9rKSB7CiAgICAgICAgICAgIENvbXBlbnNhdGlvblNlbnRFdmVudChjb21wZW5zYXRpb25BZGRyZXNzLCBfY29tcGVuc2F0aW9uV2VpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBUaGlzIHNob3VsZCBvbmx5IGhhcHBlbiBpZiB0aGUgbGF0ZXN0IG1vbmFyY2ggaXMgYSBjb250cmFjdAogICAgICAgICAgICAvLyB3aG9zZSBmYWxsYmFjay1mdW5jdGlvbiBmYWlsZWQgb3IgcmFuIG91dCBvZiBnYXMgKGRlc3BpdGUKICAgICAgICAgICAgLy8gdXMgaW5jbHVkaW5nIGEgZmFpciBhbW91bnQgb2YgZ2FzKS4KICAgICAgICAgICAgLy8gV2UgZG8gbm90IHRocm93IHNpbmNlIHdlIGRvIG5vdCB3YW50IHRoZSB0aHJvbmUgdG8gZ2V0CiAgICAgICAgICAgIC8vICdzdHVjaycgKGl0J3Mgbm90IHRoZSBuZXcgdXN1cnBlcnMgZmF1bHQpIC0gaW5zdGVhZCBzYXZlCiAgICAgICAgICAgIC8vIHRoZSBmdW5kcyB3ZSBjb3VsZCBub3Qgc2VuZCBzbyBjYW4gYmUgY2xhaW1lZCBsYXRlci4KICAgICAgICAgICAgLy8gVGhlaXIgbW9uYXJjaCBjb250cmFjdCB3b3VsZCBuZWVkIHRvIGhhdmUgYmVlbiBkZXNpZ25lZAogICAgICAgICAgICAvLyB0byBjYWxsIG91ciB3aXRoZHJhd0Z1bmRzQWR2YW5jZWQoLi4pIGZ1bmN0aW9uIG1pbmQgeW91LgogICAgICAgICAgICBmdW5kc1tjb21wZW5zYXRpb25BZGRyZXNzXSArPSBfY29tcGVuc2F0aW9uV2VpOwogICAgICAgICAgICBDb21wZW5zYXRpb25GYWlsRXZlbnQoY29tcGVuc2F0aW9uQWRkcmVzcywgX2NvbXBlbnNhdGlvbldlaSk7CiAgICAgICAgfQogICAgfQoKfQoKCi8vLyBAdGl0bGUgVXNlZCBieSB0aGUgV29ybGQgY29udHJhY3QgdG8gY3JlYXRlIEtpbmdkb20gaW5zdGFuY2VzLgovLy8gQGRldiBNb3N0bHkgZXhpc3RzIHNvIHRvcFdpemFyZCBjYW4gcG90ZW50aWFsbHkgcmVwbGFjZSB0aGlzCi8vLyBjb250cmFjdCB0byBtb2RpZnkgdGhlIEtpbmdkb20gY29udHJhY3QgYW5kL29yIHJ1bGUgdmFsaWRhdGlvbgovLy8gbG9naWMgdG8gYmUgdXNlZCBmb3IgKmZ1dHVyZSogS2luZ2RvbXMgY3JlYXRlZCBieSB0aGUgV29ybGQuCi8vLyBXZSBkbyBub3QgaW1wbGVtZW50IHJlbnRyeSBwcm90ZWN0aW9uIGJlY2F1c2Ugd2UgZG9uJ3Qgc2VuZC9jYWxsLgovLy8gV2UgZG8gbm90IGNoYXJnZSBhIGZlZSBoZXJlIC0gYnV0IGlmIHlvdSBieXBhc3MgdGhlIFdvcmxkIHRoZW4KLy8vIHlvdSB3b24ndCBiZSBsaXN0ZWQgb24gdGhlIG9mZmljaWFsIFdvcmxkIHBhZ2Ugb2YgY291cnNlLgpjb250cmFjdCBLaW5nZG9tRmFjdG9yeSB7CgogICAgZnVuY3Rpb24gS2luZ2RvbUZhY3RvcnkoKSB7CiAgICB9CgogICAgZnVuY3Rpb24gKCkgewogICAgICAgIC8vIHRoaXMgY29udHJhY3Qgc2hvdWxkIG5ldmVyIGhhdmUgYSBiYWxhbmNlCiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBwYXJhbWV0ZXIgZG9jdW1lbnRhdGlvbi4KICAgIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcG9zZWRUaHJvbmVSdWxlcygKICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgdWludCBfbWF4aW11bUNsYWltUHJpY2VXZWksCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsCiAgICAgICAgdWludCBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZAogICAgKSBjb25zdGFudCByZXR1cm5zIChib29sIGFsbG93ZWQpIHsKICAgICAgICAvLyBJIHN1cHBvc2UgdGhlcmUgaXMgYSBkYW5nZXIgdGhhdCBtYXNzaXZlIGRlZmxhdGlvbi9pbmZsYXRpb24gY291bGQKICAgICAgICAvLyBjaGFuZ2UgdGhlIHJlYWwtd29ybGQgc2FuaXR5IG9mIHRoZXNlIGNoZWNrcywgYnV0IGluIHRoYXQgY2FzZSB3ZQogICAgICAgIC8vIGNhbiBkZXBsb3kgYSBuZXcgZmFjdG9yeSBhbmQgdXBkYXRlIHRoZSB3b3JsZC4KICAgICAgICBpZiAoX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSA8IDEwIGZpbm5leSB8fAogICAgICAgICAgICBfc3RhcnRpbmdDbGFpbVByaWNlV2VpID4gMTAwIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA8IDEgZXRoZXIgfHwKICAgICAgICAgICAgX21heGltdW1DbGFpbVByaWNlV2VpID4gMTAwMDAwIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9zdGFydGluZ0NsYWltUHJpY2VXZWkgKiAyMCA+IF9tYXhpbXVtQ2xhaW1QcmljZVdlaSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQgPCAxMCB8fAogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQgPiA5MDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcyA8IDIgaG91cnMgfHwKICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcyA+IDEwMDAwIGRheXMpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX2NvbW1pc3Npb25QZXJUaG91c2FuZCA8IDEwIHx8CiAgICAgICAgICAgIF9jb21taXNzaW9uUGVyVGhvdXNhbmQgPiAxMDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcgS2luZ2RvbS4gTm9ybWFsbHkgY2FsbGVkIGJ5IFdvcmxkIGNvbnRyYWN0LgogICAgLy8vIFdBUk46IERvZXMgTk9UIHZhbGlkYXRlIHRoZSBfa2luZ2RvbU5hbWUgb3IgX3dvcmxkIGFyZ3VtZW50cy4KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gMSw4MDAsMDAwIGdhcyAoISkKICAgIC8vLyBXaWxsIHRocm93IGFuIGVycm9yIGlmOgogICAgLy8vICAgLSBydWxlcyBpbnZhbGlkIChzZWUgdmFsaWRhdGVQcm9wb3NlZFRocm9uZVJ1bGVzKQogICAgLy8vICAgLSB3aXphcmQgYWRkcmVzc2VzICJvYnZpb3VzbHkiIHdyb25nCiAgICAvLy8gICAtIG91dCBvZiBnYXMgcXVpdGUgbGlrZWx5IChwZXJoYXBzIGluIGZ1dHVyZSBzaG91bGQgY29uc2lkZXIKICAgIC8vLyAgICAgdXNpbmcgc29saWRpdHkgbGlicmFyaWVzIHRvIHJlZHVjZSBLaW5nZG9tIHNpemU/KQogICAgLy8gU2VlIFdvcmxkLmNyZWF0ZUtpbmdkb20oLi4pIGZvciBwYXJhbWV0ZXIgZG9jdW1lbnRhdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZUtpbmdkb20oCiAgICAgICAgc3RyaW5nIF9raW5nZG9tTmFtZSwKICAgICAgICBhZGRyZXNzIF93b3JsZCwKICAgICAgICBhZGRyZXNzIF90b3BXaXphcmQsCiAgICAgICAgYWRkcmVzcyBfc3ViV2l6YXJkLAogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwKICAgICAgICB1aW50IF9tYXhpbXVtQ2xhaW1QcmljZVdlaSwKICAgICAgICB1aW50IF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCwKICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsCiAgICAgICAgdWludCBfY29tbWlzc2lvblBlclRob3VzYW5kCiAgICApIHJldHVybnMgKEtpbmdkb20gbmV3S2luZ2RvbSkgewogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKSB7CiAgICAgICAgICAgIC8vIHRoaXMgY29udHJhY3Qgc2hvdWxkIG5ldmVyIGhhdmUgYSBiYWxhbmNlCiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICAvLyBOQjogdG9wV2l6YXJkIGFuZCBzdWJXaXphcmQgQ0FOIGJlIHRoZSBzYW1lIGFzIGVhY2ggb3RoZXIuCiAgICAgICAgaWYgKF90b3BXaXphcmQgPT0gMCB8fCBfc3ViV2l6YXJkID09IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGlmIChfdG9wV2l6YXJkID09IF93b3JsZCB8fCBfc3ViV2l6YXJkID09IF93b3JsZCkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgaWYgKCF2YWxpZGF0ZVByb3Bvc2VkVGhyb25lUnVsZXMoCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgICAgIF9tYXhpbXVtQ2xhaW1QcmljZVdlaSwKICAgICAgICAgICAgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LAogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgICAgICBfY29tbWlzc2lvblBlclRob3VzYW5kCiAgICAgICAgKSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBLaW5nZG9tKAogICAgICAgICAgICBfa2luZ2RvbU5hbWUsCiAgICAgICAgICAgIF93b3JsZCwKICAgICAgICAgICAgX3RvcFdpemFyZCwKICAgICAgICAgICAgX3N1YldpemFyZCwKICAgICAgICAgICAgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwKICAgICAgICAgICAgX21heGltdW1DbGFpbVByaWNlV2VpLAogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsCiAgICAgICAgICAgIF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsCiAgICAgICAgICAgIF9jb21taXNzaW9uUGVyVGhvdXNhbmQKICAgICAgICApOwogICAgfQoKfQoKCi8vLyBAdGl0bGUgUnVucyB0aGUgd29ybGQsIHdoaWNoIGlzIGEgY29sbGVjdGlvbiBvZiBLaW5nZG9tcy4KY29udHJhY3QgV29ybGQgaXMKICBSZWVudHJ5UHJvdGVjdG9yTWl4aW4sCiAgTmFtZWFibGVNaXhpbiwKICBNb25leVJvdW5kZXJNaXhpbiwKICBGdW5kc0hvbGRlck1peGluLAogIFRocm9uZVJ1bGVzTWl4aW4gewoKICAgIC8vIFRoZSB0b3BXaXphcmQgcnVucyB0aGUgd29ybGQuIFRoZXkgY2hhcmdlIGZvciB0aGUgY3JlYXRpb24gb2YKICAgIC8vIGtpbmdkb21zIGFuZCBiZWNvbWUgdGhlIHRvcFdpemFyZCBpbiBlYWNoIGtpbmdkb20gY3JlYXRlZC4KICAgIGFkZHJlc3MgcHVibGljIHRvcFdpemFyZDsKCiAgICAvLyBIb3cgbXVjaCBvbmUgbXVzdCBwYXkgdG8gY3JlYXRlIGEgbmV3IGtpbmdkb20gKGluIHdlaSkuCiAgICAvLyBDYW4gYmUgY2hhbmdlZCBieSB0aGUgdG9wV2l6YXJkLgogICAgdWludCBwdWJsaWMga2luZ2RvbUNyZWF0aW9uRmVlV2VpOwoKICAgIHN0cnVjdCBLaW5nZG9tTGlzdGluZyB7CiAgICAgICAgdWludCBraW5nZG9tTnVtYmVyOwogICAgICAgIHN0cmluZyBraW5nZG9tTmFtZTsKICAgICAgICBhZGRyZXNzIGtpbmdkb21Db250cmFjdDsKICAgICAgICBhZGRyZXNzIGtpbmdkb21DcmVhdG9yOwogICAgICAgIHVpbnQgY3JlYXRpb25UaW1lc3RhbXA7CiAgICAgICAgYWRkcmVzcyBraW5nZG9tRmFjdG9yeVVzZWQ7CiAgICB9CiAgICAKICAgIC8vIFRoZSBmaXJzdCBraW5nZG9tIGlzIG51bWJlciAxOyB0aGUgemVyby10aCBlbnRyeSBpcyBhIGR1bW15LgogICAgS2luZ2RvbUxpc3RpbmdbXSBwdWJsaWMga2luZ2RvbXNCeU51bWJlcjsKCiAgICAvLyBGb3Igc2FmZXR5LCB3ZSBjYXAganVzdCBob3cgaGlnaCB0aGUgcHJpY2UgY2FuIGdldC4KICAgIC8vIENhbiBiZSBjaGFuZ2VkIGJ5IHRoZSB0b3BXaXphcmQsIHRob3VnaCBpdCB3aWxsIG9ubHkgYWZmZWN0CiAgICAvLyBraW5nZG9tcyBjcmVhdGVkIGFmdGVyIHRoYXQuCiAgICB1aW50IHB1YmxpYyBtYXhpbXVtQ2xhaW1QcmljZVdlaTsKCiAgICAvLyBIZWxwZXIgY29udHJhY3QgZm9yIGNyZWF0aW5nIEtpbmdkb20gaW5zdGFuY2VzLiBDYW4gYmUKICAgIC8vIHVwZ3JhZGVkIGJ5IHRoZSB0b3BXaXphcmQgKHdvbid0IGFmZmVjdCBleGlzdGluZyBvbmVzKS4KICAgIEtpbmdkb21GYWN0b3J5IHB1YmxpYyBraW5nZG9tRmFjdG9yeTsKCiAgICAvLyBBdm9pZHMgZHVwbGljYXRlIGtpbmdkb20gbmFtZXMgYW5kIGFsbG93cyBzZWFyY2hpbmcgYnkgbmFtZS4KICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkga2luZ2RvbU51bWJlcnNCeWZ1enp5SGFzaDsKCiAgICAvLyBOQjogd2UgYWxzbyBoYXZlIGEgYGZ1bmRzYCBtYXBwaW5nIGZyb20gRnVuZHNIb2xkZXJNaXhpbiwKICAgIC8vIGFuZCBhIHJlbnRyeVByb3RlY3RvciBmcm9tIFJlZW50cnlQcm90ZWN0b3JNaXhpbi4KCiAgICBldmVudCBLaW5nZG9tQ3JlYXRlZEV2ZW50KHVpbnQga2luZ2RvbU51bWJlcik7CiAgICBldmVudCBDcmVhdGlvbkZlZUNoYW5nZWRFdmVudCh1aW50IG5ld0ZlZVdlaSk7CiAgICBldmVudCBGYWN0b3J5Q2hhbmdlZEV2ZW50KGFkZHJlc3MgbmV3RmFjdG9yeSk7CiAgICBldmVudCBXaXphcmRSZXBsYWNlZEV2ZW50KGFkZHJlc3Mgb2xkV2l6YXJkLCBhZGRyZXNzIG5ld1dpemFyZCk7CiAgICAvLyBOQjogd2UgYWxzbyBoYXZlIGEgYEZ1bmRzV2l0aGRyYXduRXZlbnRgIGZyb20gRnVuZHNIb2xkZXJNaXhpbgoKICAgIC8vIENyZWF0ZSB0aGUgd29ybGQgd2l0aCBubyBraW5nZG9tcyB5ZXQuCiAgICAvLyBDb3N0cyBhYm91dCAxLjlNIGdhcyB0byBkZXBsb3kuCiAgICBmdW5jdGlvbiBXb3JsZCgKICAgICAgICBhZGRyZXNzIF90b3BXaXphcmQsCiAgICAgICAgdWludCBfa2luZ2RvbUNyZWF0aW9uRmVlV2VpLAogICAgICAgIEtpbmdkb21GYWN0b3J5IF9raW5nZG9tRmFjdG9yeSwKICAgICAgICB1aW50IF9tYXhpbXVtQ2xhaW1QcmljZVdlaQogICAgKSB7CiAgICAgICAgaWYgKF90b3BXaXphcmQgPT0gMCkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgaWYgKF9tYXhpbXVtQ2xhaW1QcmljZVdlaSA8IDEgZXRoZXIpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIHRvcFdpemFyZCA9IF90b3BXaXphcmQ7CiAgICAgICAga2luZ2RvbUNyZWF0aW9uRmVlV2VpID0gX2tpbmdkb21DcmVhdGlvbkZlZVdlaTsKICAgICAgICBraW5nZG9tRmFjdG9yeSA9IF9raW5nZG9tRmFjdG9yeTsKICAgICAgICBtYXhpbXVtQ2xhaW1QcmljZVdlaSA9IF9tYXhpbXVtQ2xhaW1QcmljZVdlaTsKICAgICAgICAvLyBXZSBudW1iZXIgdGhlIGtpbmdkb21zIHN0YXJ0aW5nIGZyb20gMSBzaW5jZSBpdCdzIHNvbWV0aW1lcwogICAgICAgIC8vIHVzZWZ1bCB0byB1c2UgemVybyA9IGludmFsaWQuIENyZWF0ZSBkdW1teSB6ZXJvLXRoIGVudHJ5LgogICAgICAgIGtpbmdkb21zQnlOdW1iZXIucHVzaChLaW5nZG9tTGlzdGluZygwLCAiIiwgMCwgMCwgMCwgMCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG51bWJlck9mS2luZ2RvbXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRvdGFsQ291bnQpIHsKICAgICAgICByZXR1cm4ga2luZ2RvbXNCeU51bWJlci5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIGluZGV4IGludG8ga2luZ2RvbXNCeU51bWJlciBpZiBmb3VuZCwgb3IgemVybyBpZiBub3QuIAogICAgZnVuY3Rpb24gZmluZEtpbmdkb21DYWxsZWQoc3RyaW5nIF9raW5nZG9tTmFtZSkgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnQga2luZ2RvbU51bWJlcikgewogICAgICAgIHVpbnQgZnV6enlIYXNoID0gY29tcHV0ZU5hbWVGdXp6eUhhc2goX2tpbmdkb21OYW1lKTsKICAgICAgICByZXR1cm4ga2luZ2RvbU51bWJlcnNCeWZ1enp5SGFzaFtmdXp6eUhhc2hdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGEgbmFtZSBjYW4gYmUgdXNlZCBhcyBhIGtpbmdkb20gbmFtZS4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIG5hbWUgc2F0aXNmaWVzIHRoZSBjcml0ZXJpYSBvZjoKICAgIC8vLyAgIC0gbm8gZmV3ZXIgdGhhbiAxIGNoYXJhY3RlcgogICAgLy8vICAgLSBubyBtb3JlIHRoYW4gMjUgY2hhcmFjdGVycwogICAgLy8vICAgLSBubyBjaGFyYWN0ZXJzIG90aGVyIHRoYW46CiAgICAvLy8gICAgIC0gInJvbWFuIiBhbHBoYWJldCBsZXR0ZXJzIChBLVogYW5kIGEteikKICAgIC8vLyAgICAgLSB3ZXN0ZXJuIGRpZ2l0cyAoMC05KQogICAgLy8vICAgICAtICJzYWZlIiBwdW5jdHVhdGlvbjogISAoICkgLSAuIF8gU1BBQ0UKICAgIC8vLwogICAgLy8vIFdBUk46IGRvZXMgbm90IGNoZWNrIGlmIHRoZSBuYW1lIGlzIGFscmVhZHkgaW4gdXNlOwogICAgLy8vIHVzZSBgZmluZEtpbmdkb21DYWxsZWQoc3RyaW5nKWAgZm9yIHRoYXQgYWZ0ZXJ3YXJkcy4KICAgIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcG9zZWRLaW5nZG9tTmFtZShzdHJpbmcgX2tpbmdkb21OYW1lKSBjb25zdGFudAogICAgcmV0dXJucyAoYm9vbCBhbGxvd2VkKSB7CiAgICAgICAgcmV0dXJuIHZhbGlkYXRlTmFtZUludGVybmFsKF9raW5nZG9tTmFtZSk7CiAgICB9CgogICAgLy8gQ2hlY2sgaWYgcnVsZXMgd291bGQgYmUgYWxsb3dlZCBmb3IgYSBuZXcgY3VzdG9tIEtpbmdkb20uCiAgICAvLyBUeXBpY2FsbHkgdXNlZCBiZWZvcmUgY2FsbGluZyBgY3JlYXRlS2luZ2RvbSguLi4pYC4KICAgIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcG9zZWRUaHJvbmVSdWxlcygKICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsCiAgICAgICAgdWludCBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZAogICAgKSBjb25zdGFudCByZXR1cm5zIChib29sIGFsbG93ZWQpIHsKICAgICAgICByZXR1cm4ga2luZ2RvbUZhY3RvcnkudmFsaWRhdGVQcm9wb3NlZFRocm9uZVJ1bGVzKAogICAgICAgICAgICBfc3RhcnRpbmdDbGFpbVByaWNlV2VpLAogICAgICAgICAgICBtYXhpbXVtQ2xhaW1QcmljZVdlaSwKICAgICAgICAgICAgX2NsYWltUHJpY2VBZGp1c3RQZXJjZW50LAogICAgICAgICAgICBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgICAgICBfY29tbWlzc2lvblBlclRob3VzYW5kCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBIb3cgbXVjaCBvbmUgbXVzdCBwYXkgdG8gY3JlYXRlIGEgbmV3IGtpbmdkb20gKGluIGZpbm5leSkuCiAgICAvLyBDYW4gYmUgY2hhbmdlZCBieSB0aGUgdG9wV2l6YXJkLgogICAgZnVuY3Rpb24ga2luZ2RvbUNyZWF0aW9uRmVlSW5GaW5uZXkoKSBjb25zdGFudAogICAgcmV0dXJucyAodWludCBmZWVJbkZpbm5leSkgewogICAgICAgIHJldHVybiByb3VuZE1vbmV5VXBUb1dob2xlRmlubmV5KGtpbmdkb21DcmVhdGlvbkZlZVdlaSk7CiAgICB9CgogICAgLy8gUmVqZWN0IGZ1bmRzIHNlbnQgdG8gdGhlIGNvbnRyYWN0IC0gd2l6YXJkcyB3aG8gY2Fubm90IGludGVyYWN0CiAgICAvLyB3aXRoIGl0IHZpYSB0aGUgQVBJIHdvbid0IGJlIGFibGUgdG8gd2l0aGRyYXcgdGhlaXIgY29tbWlzc2lvbi4KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcga2luZ2RvbSB1c2luZyBjdXN0b20gcnVsZXMuCiAgICAvLy8gQHBhcmFtIF9raW5nZG9tTmFtZSBcCiAgICAvLy8gICBlLmcuICJLaW5nIG9mIHRoZSBFdGhlciBUaHJvbmUiCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ0NsYWltUHJpY2VXZWkgXAogICAgLy8vICAgSG93IG11Y2ggaXQgd2lsbCBjb3N0IHRoZSBmaXJzdCBtb25hcmNoIHRvIGNsYWltIHRoZSB0aHJvbmUKICAgIC8vLyAgIChhbmQgYWxzbyB0aGUgcHJpY2UgYWZ0ZXIgdGhlIGRlYXRoIG9mIGEgbW9uYXJjaCkuCiAgICAvLy8gQHBhcmFtIF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCBcCiAgICAvLy8gICBQZXJjZW50YWdlIGluY3JlYXNlIGFmdGVyIGVhY2ggY2xhaW0gLSBlLmcuIGlmIGNsYWltIHByaWNlCiAgICAvLy8gICB3YXMgMjAwIEVUSCwgYW5kIGBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnRgIGlzIDUwLCB0aGUgbmV4dAogICAgLy8vICAgY2xhaW0gcHJpY2Ugd2lsbCBiZSAyMDAgRVRIICsgKDUwJSBvZiAyMDAgRVRIKSA9PiAzMDAgRVRILgogICAgLy8vIEBwYXJhbSBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzIFwKICAgIC8vLyAgIFRoZSBtYXhpbXVtIGxlbmd0aCBvZiBhIHRpbWUgYSBtb25hcmNoIGNhbiBydWxlIGJlZm9yZSB0aGUKICAgIC8vLyAgIGN1cnNlIHN0cmlrZXMgYW5kIHRoZXkgYXJlIHJlbW92ZWQgd2l0aG91dCBjb21wZW5zYXRpb24uCiAgICAvLy8gQHBhcmFtIF9jb21taXNzaW9uUGVyVGhvdXNhbmQgXAogICAgLy8vICAgSG93IG11Y2ggb2YgZWFjaCBwYXltZW50IGlzIGdpdmVuIHRvIHRoZSB3aXphcmRzIHRvIHNoYXJlLAogICAgLy8vICAgZXhwcmVzc2VkIGluIHBhcnRzIHBlciB0aG91c2FuZCAtIGUuZy4gMjUgbWVhbnMgMjUvMTAwMCwKICAgIC8vLyAgIG9yIDIuNSUuCiAgICAvLy8gCiAgICAvLy8gQ2FsbGVyIG11c3QgaW5jbHVkZSBwYXltZW50IGVxdWFsIHRvIGtpbmdkb21DcmVhdGlvbkZlZVdlaS4KICAgIC8vLyBUaGUgY2FsbGVyIHdpbGwgYmVjb21lIHRoZSAnc3ViLXdpemFyZCcgYW5kIHdpbGwgZWFybiBoYWxmCiAgICAvLy8gYW55IGNvbW1pc3Npb24gY2hhcmdlZCBieSB0aGUgS2luZ2RvbS4gIE5vdGUgaG93ZXZlciB0aGV5CiAgICAvLy8gd2lsbCBuZWVkIHRvIGNhbGwgd2l0aGRyYXdGdW5kcygpIG9uIHRoZSBLaW5nZG9tIGNvbnRyYWN0CiAgICAvLy8gdG8gZ2V0IHRoZWlyIGNvbW1pc3Npb24gLSBpdCdzIG5vdCBzZW5kIGF1dG9tYXRpY2FsbHkuCiAgICAvLy8KICAgIC8vLyBXaWxsIGNvbnN1bWUgdXAgdG8gMSw5MDAsMDAwIGdhcyAoISkKICAgIC8vLyBXaWxsIHRocm93IGFuIGVycm9yIGlmOgogICAgLy8vICAgLSBuYW1lIGlzIGludmFsaWQgKHNlZSBgdmFsaWRhdGVQcm9wb3NlZEtpbmdkb21OYW1lKHN0cmluZylgKQogICAgLy8vICAgLSBuYW1lIGlzIGFscmVhZHkgaW4gdXNlIChzZWUgYGZpbmRLaW5nZG9tQ2FsbGVkKHN0cmluZylgKQogICAgLy8vICAgLSBydWxlcyBhcmUgaW52YWxpZCAoc2VlIGB2YWxpZGF0ZVByb3Bvc2VkS2luZ2RvbVJ1bGVzKC4uLilgKQogICAgLy8vICAgLSBwYXltZW50IGlzIHRvbyBsb3cgb3IgdG9vIGhpZ2gKICAgIC8vLyAgIC0gaW5zdWZmaWNpZW50IGdhcyAocXVpdGUgbGlrZWx5ISkKICAgIC8vLyBQcm9kdWNlcyBldmVudCBLaW5nZG9tQ3JlYXRlZEV2ZW50LgogICAgZnVuY3Rpb24gY3JlYXRlS2luZ2RvbSgKICAgICAgICBzdHJpbmcgX2tpbmdkb21OYW1lLAogICAgICAgIHVpbnQgX3N0YXJ0aW5nQ2xhaW1QcmljZVdlaSwKICAgICAgICB1aW50IF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCwKICAgICAgICB1aW50IF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsCiAgICAgICAgdWludCBfY29tbWlzc2lvblBlclRob3VzYW5kCiAgICApIHsKICAgICAgICBleHRlcm5hbEVudGVyKCk7CiAgICAgICAgY3JlYXRlS2luZ2RvbVJQKAogICAgICAgICAgICBfa2luZ2RvbU5hbWUsCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgICAgIF9jbGFpbVByaWNlQWRqdXN0UGVyY2VudCwKICAgICAgICAgICAgX2N1cnNlSW5jdWJhdGlvbkR1cmF0aW9uU2Vjb25kcywKICAgICAgICAgICAgX2NvbW1pc3Npb25QZXJUaG91c2FuZAogICAgICAgICk7CiAgICAgICAgZXh0ZXJuYWxMZWF2ZSgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFVzZWQgYnkgdG9wV2l6YXJkIHRvIHRyYW5zZmVyIGFsbCByaWdodHMgdG8gZnV0dXJlCiAgICAvLy8gZmVlcyBhbmQgZnV0dXJlIGtpbmdkb20gd2l6YXJkc2hpcHMgdG8gYF9yZXBsYWNlbWVudGAgd2l6YXJkLgogICAgLy8vIFdBUk46IFRoZSBvcmlnaW5hbCB3aXphcmQgcmV0YWlucyBvd25lcnNoaXAgb2YgYW55IHBhc3QgZmVlcwogICAgLy8vIGhlbGQgZm9yIHRoZW0gaW4gdGhlIGBmdW5kc2AgbWFwcGluZywgd2hpY2ggdGhleSBjYW4gc3RpbGwKICAgIC8vLyB3aXRoZHJhdy4gVGhleSBhbHNvIHJlbWFpbiB0b3BXaXphcmQgaW4gYW55IGV4aXN0aW5nIEtpbmdkb21zLgogICAgLy8vIFByb2R1Y2VzIGV2ZW50IFdpemFyZFJlcGxhY2VkRXZlbnQuCiAgICBmdW5jdGlvbiByZXBsYWNlV2l6YXJkKGFkZHJlc3MgX3JlcGxhY2VtZW50KSB7CiAgICAgICAgZXh0ZXJuYWxFbnRlcigpOwogICAgICAgIHJlcGxhY2VXaXphcmRSUChfcmVwbGFjZW1lbnQpOwogICAgICAgIGV4dGVybmFsTGVhdmUoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBVc2VkIGJ5IHRvcFdpemFyZCB0byB2YXJ5IHRoZSBmZWUgZm9yIGNyZWF0aW5nIGtpbmdkb21zLgogICAgZnVuY3Rpb24gc2V0S2luZ2RvbUNyZWF0aW9uRmVlV2VpKHVpbnQgX2tpbmdkb21DcmVhdGlvbkZlZVdlaSkgewogICAgICAgIGV4dGVybmFsRW50ZXIoKTsKICAgICAgICBzZXRLaW5nZG9tQ3JlYXRpb25GZWVXZWlSUChfa2luZ2RvbUNyZWF0aW9uRmVlV2VpKTsKICAgICAgICBleHRlcm5hbExlYXZlKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVXNlZCBieSB0b3BXaXphcmQgdG8gdmFyeSB0aGUgY2FwIG9uIGNsYWltIHByaWNlLgogICAgZnVuY3Rpb24gc2V0TWF4aW11bUNsYWltUHJpY2VXZWkodWludCBfbWF4aW11bUNsYWltUHJpY2VXZWkpIHsKICAgICAgICBleHRlcm5hbEVudGVyKCk7CiAgICAgICAgc2V0TWF4aW11bUNsYWltUHJpY2VXZWlSUChfbWF4aW11bUNsYWltUHJpY2VXZWkpOwogICAgICAgIGV4dGVybmFsTGVhdmUoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBVc2VkIGJ5IHRvcFdpemFyZCB0byB2YXJ5IHRoZSBmYWN0b3J5IGNvbnRyYWN0IHdoaWNoCiAgICAvLy8gd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBmdXR1cmUgS2luZ2RvbXMuCiAgICBmdW5jdGlvbiBzZXRLaW5nZG9tRmFjdG9yeShLaW5nZG9tRmFjdG9yeSBfa2luZ2RvbUZhY3RvcnkpIHsKICAgICAgICBleHRlcm5hbEVudGVyKCk7CiAgICAgICAgc2V0S2luZ2RvbUZhY3RvcnlSUChfa2luZ2RvbUZhY3RvcnkpOwogICAgICAgIGV4dGVybmFsTGVhdmUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVLaW5nZG9tUlAoCiAgICAgICAgc3RyaW5nIF9raW5nZG9tTmFtZSwKICAgICAgICB1aW50IF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgdWludCBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsCiAgICAgICAgdWludCBfY3Vyc2VJbmN1YmF0aW9uRHVyYXRpb25TZWNvbmRzLAogICAgICAgIHVpbnQgX2NvbW1pc3Npb25QZXJUaG91c2FuZAogICAgKSBpbnRlcm5hbCB7CgogICAgICAgIGFkZHJlc3Mgc3ViV2l6YXJkID0gbXNnLnNlbmRlcjsKCiAgICAgICAgaWYgKCF2YWxpZGF0ZU5hbWVJbnRlcm5hbChfa2luZ2RvbU5hbWUpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KCiAgICAgICAgdWludCBuZXdLaW5nZG9tTnVtYmVyID0ga2luZ2RvbXNCeU51bWJlci5sZW5ndGg7CiAgICAgICAgY2hlY2tVbmlxdWVBbmRSZWdpc3Rlck5ld0tpbmdkb21OYW1lKAogICAgICAgICAgICBfa2luZ2RvbU5hbWUsCiAgICAgICAgICAgIG5ld0tpbmdkb21OdW1iZXIKICAgICAgICApOwoKICAgICAgICB1aW50IHBhaWRXZWkgPSBtc2cudmFsdWU7CiAgICAgICAgaWYgKHBhaWRXZWkgPCBraW5nZG9tQ3JlYXRpb25GZWVXZWkpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIC8vIE1ha2UgaXQgZWFzeSBmb3IgcGVvcGxlIHRvIHBheSB1c2luZyBhIHdob2xlIG51bWJlciBvZiBmaW5uZXksCiAgICAgICAgLy8gd2hpY2ggY291bGQgYmUgYSB0ZWVueSBiaXQgaGlnaGVyIHRoYW4gdGhlIHJhdyB3ZWkgdmFsdWUuCiAgICAgICAgdWludCBleGNlc3NXZWkgPSBwYWlkV2VpIC0ga2luZ2RvbUNyZWF0aW9uRmVlV2VpOwogICAgICAgIGlmIChleGNlc3NXZWkgPiAxIGZpbm5leSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgZnVuZHNbdG9wV2l6YXJkXSArPSBwYWlkV2VpOwogICAgICAgIAogICAgICAgIC8vIFRoaXMgd2lsbCBwZXJmb3JtIHJ1bGUgdmFsaWRhdGlvbi4KICAgICAgICBLaW5nZG9tIGtpbmdkb21Db250cmFjdCA9IGtpbmdkb21GYWN0b3J5LmNyZWF0ZUtpbmdkb20oCiAgICAgICAgICAgIF9raW5nZG9tTmFtZSwKICAgICAgICAgICAgYWRkcmVzcyh0aGlzKSwKICAgICAgICAgICAgdG9wV2l6YXJkLAogICAgICAgICAgICBzdWJXaXphcmQsCiAgICAgICAgICAgIF9zdGFydGluZ0NsYWltUHJpY2VXZWksCiAgICAgICAgICAgIG1heGltdW1DbGFpbVByaWNlV2VpLAogICAgICAgICAgICBfY2xhaW1QcmljZUFkanVzdFBlcmNlbnQsCiAgICAgICAgICAgIF9jdXJzZUluY3ViYXRpb25EdXJhdGlvblNlY29uZHMsCiAgICAgICAgICAgIF9jb21taXNzaW9uUGVyVGhvdXNhbmQKICAgICAgICApOwoKICAgICAgICBraW5nZG9tc0J5TnVtYmVyLnB1c2goS2luZ2RvbUxpc3RpbmcoCiAgICAgICAgICAgIG5ld0tpbmdkb21OdW1iZXIsCiAgICAgICAgICAgIF9raW5nZG9tTmFtZSwKICAgICAgICAgICAga2luZ2RvbUNvbnRyYWN0LAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBub3csCiAgICAgICAgICAgIGtpbmdkb21GYWN0b3J5CiAgICAgICAgKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVwbGFjZVdpemFyZFJQKGFkZHJlc3MgcmVwbGFjZW1lbnQpIGludGVybmFsIHsgCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdG9wV2l6YXJkKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBpZiAobXNnLnZhbHVlICE9IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGFkZHJlc3Mgb2xkV2l6YXJkID0gdG9wV2l6YXJkOwogICAgICAgIHRvcFdpemFyZCA9IHJlcGxhY2VtZW50OwogICAgICAgIFdpemFyZFJlcGxhY2VkRXZlbnQob2xkV2l6YXJkLCByZXBsYWNlbWVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0S2luZ2RvbUNyZWF0aW9uRmVlV2VpUlAodWludCBfa2luZ2RvbUNyZWF0aW9uRmVlV2VpKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdG9wV2l6YXJkKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBpZiAobXNnLnZhbHVlICE9IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGtpbmdkb21DcmVhdGlvbkZlZVdlaSA9IF9raW5nZG9tQ3JlYXRpb25GZWVXZWk7CiAgICAgICAgQ3JlYXRpb25GZWVDaGFuZ2VkRXZlbnQoa2luZ2RvbUNyZWF0aW9uRmVlV2VpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRNYXhpbXVtQ2xhaW1QcmljZVdlaVJQKHVpbnQgX21heGltdW1DbGFpbVByaWNlV2VpKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdG9wV2l6YXJkKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBpZiAobXNnLnZhbHVlICE9IDApIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGlmIChfbWF4aW11bUNsYWltUHJpY2VXZWkgPCAxIGV0aGVyKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBtYXhpbXVtQ2xhaW1QcmljZVdlaSA9IF9tYXhpbXVtQ2xhaW1QcmljZVdlaTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRLaW5nZG9tRmFjdG9yeVJQKEtpbmdkb21GYWN0b3J5IF9raW5nZG9tRmFjdG9yeSkgaW50ZXJuYWwgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHRvcFdpemFyZCkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSAwKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBraW5nZG9tRmFjdG9yeSA9IF9raW5nZG9tRmFjdG9yeTsKICAgICAgICBGYWN0b3J5Q2hhbmdlZEV2ZW50KGtpbmdkb21GYWN0b3J5KTsKICAgIH0KCiAgICAvLyBJZiB0aGVyZSBpcyBubyBleGlzdGluZyBraW5nZG9tIGNhbGxlZCBgX2tpbmdkb21OYW1lYCwgY3JlYXRlCiAgICAvLyBhIHJlY29yZCBtYXBwaW5nIHRoYXQgbmFtZSB0byBraW5nZG9tIG5vLiBgX25ld0tpbmdkb21OdW1iZXJgLgogICAgLy8gVGhyb3dzIGFuIGVycm9yIGlmIGFuIGV4aXN0aW5nIGtpbmdkb20gd2l0aCB0aGUgc2FtZSAob3IKICAgIC8vIGZ1enppbHkgc2ltaWxhciAtIHNlZSBjb21wdXRlTmFtZUZ1enp5SGFzaCkgbmFtZSBleGlzdHMuCiAgICBmdW5jdGlvbiBjaGVja1VuaXF1ZUFuZFJlZ2lzdGVyTmV3S2luZ2RvbU5hbWUoCiAgICAgICAgc3RyaW5nIF9raW5nZG9tTmFtZSwKICAgICAgICB1aW50IF9uZXdLaW5nZG9tTnVtYmVyCiAgICApIGludGVybmFsIHsKICAgICAgICB1aW50IGZ1enp5SGFzaCA9IGNvbXB1dGVOYW1lRnV6enlIYXNoKF9raW5nZG9tTmFtZSk7CiAgICAgICAgaWYgKGtpbmdkb21OdW1iZXJzQnlmdXp6eUhhc2hbZnV6enlIYXNoXSAhPSAwKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBraW5nZG9tTnVtYmVyc0J5ZnV6enlIYXNoW2Z1enp5SGFzaF0gPSBfbmV3S2luZ2RvbU51bWJlcjsKICAgIH0KCn0KCgovLy8gQHRpdGxlIFVzZWQgb24gdGhlIHRlc3RuZXQgdG8gYWxsb3cgYXV0b21hdGVkIHRlc3Rpbmcgb2YgaW50ZXJuYWxzLgpjb250cmFjdCBFeHBvc2VkSW50ZXJuYWxzRm9yVGVzdGluZyBpcwogIE1vbmV5Um91bmRlck1peGluLCBOYW1lYWJsZU1peGluIHsKCiAgICBmdW5jdGlvbiByb3VuZE1vbmV5RG93bk5pY2VseUVUKHVpbnQgX3Jhd1ZhbHVlV2VpKSBjb25zdGFudAogICAgcmV0dXJucyAodWludCBuaWNlclZhbHVlV2VpKSB7CiAgICAgICAgcmV0dXJuIHJvdW5kTW9uZXlEb3duTmljZWx5KF9yYXdWYWx1ZVdlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gcm91bmRNb25leVVwVG9XaG9sZUZpbm5leUVUKHVpbnQgX3ZhbHVlV2VpKSBjb25zdGFudAogICAgcmV0dXJucyAodWludCB2YWx1ZUZpbm5leSkgewogICAgICAgIHJldHVybiByb3VuZE1vbmV5VXBUb1dob2xlRmlubmV5KF92YWx1ZVdlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gdmFsaWRhdGVOYW1lSW50ZXJuYWxFVChzdHJpbmcgX25hbWUpIGNvbnN0YW50CiAgICByZXR1cm5zIChib29sIGFsbG93ZWQpIHsKICAgICAgICByZXR1cm4gdmFsaWRhdGVOYW1lSW50ZXJuYWwoX25hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dHJhY3ROYW1lRnJvbURhdGFFVChieXRlcyBfZGF0YSkgY29uc3RhbnQKICAgIHJldHVybnMgKHN0cmluZyBleHRyYWN0ZWROYW1lKSB7CiAgICAgICAgcmV0dXJuIGV4dHJhY3ROYW1lRnJvbURhdGEoX2RhdGEpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjb21wdXRlTmFtZUZ1enp5SGFzaEVUKHN0cmluZyBfbmFtZSkgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnQgZnV6enlIYXNoKSB7CiAgICAgICAgcmV0dXJuIGNvbXB1dGVOYW1lRnV6enlIYXNoKF9uYW1lKTsKICAgIH0KCn0='.
	

]
