Class {
	#name : #SRT98f7d9405e9b973e51cd4d85a5b2327a9ca55359,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT98f7d9405e9b973e51cd4d85a5b2327a9ca55359 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovL1NsaWdodGx5IG1vZGlmaWVkIFNhZmVNYXRoIGxpYnJhcnkgLSBpbmNsdWRlcyBhIG1pbiBmdW5jdGlvbgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgovL0VSQzIwIGZ1bmN0aW9uIGludGVyZmFjZQppbnRlcmZhY2UgRVJDMjBfSW50ZXJmYWNlIHsKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHRvdGFsX3N1cHBseSk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYW1vdW50KTsKfQoKLy9Td2FwIGZhY3RvcnkgZnVuY3Rpb25zIC0gZGVzY3JpcHRpb25zIGNhbiBiZSBmb3VuZCBpbiBGYWN0b3J5LnNvbAppbnRlcmZhY2UgRmFjdG9yeV9JbnRlcmZhY2UgewogIGZ1bmN0aW9uIGNyZWF0ZVRva2VuKHVpbnQgX3N1cHBseSwgYWRkcmVzcyBfcGFydHksIGJvb2wgX2xvbmcsIHVpbnQgX3N0YXJ0X2RhdGUpIHB1YmxpYyByZXR1cm5zIChhZGRyZXNzIGNyZWF0ZWQsIHVpbnQgdG9rZW5fcmF0aW8pOwogIGZ1bmN0aW9uIHBheVRva2VuKGFkZHJlc3MgX3BhcnR5LCBhZGRyZXNzIF90b2tlbl9hZGQpIHB1YmxpYzsKICBmdW5jdGlvbiBkZXBsb3lDb250cmFjdCh1aW50IF9zdGFydF9kYXRlKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChhZGRyZXNzIGNyZWF0ZWQpOwogICBmdW5jdGlvbiBnZXRCYXNlKCkgcHVibGljIHZpZXcgcmV0dXJucyhhZGRyZXNzIF9iYXNlMSwgYWRkcmVzcyBiYXNlMik7CiAgZnVuY3Rpb24gZ2V0VmFyaWFibGVzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvcmFjbGVfYWRkciwgdWludCBzd2FwX2R1cmF0aW9uLCB1aW50IHN3YXBfbXVsdGlwbGllciwgYWRkcmVzcyB0b2tlbl9hX2FkZHIsIGFkZHJlc3MgdG9rZW5fYl9hZGRyKTsKfQoKCi8vRFJDVF9Ub2tlbiBmdW5jdGlvbnMgLSBkZXNjcmlwdGlvbnMgY2FuIGJlIGZvdW5kIGluIERSQ1RfVG9rZW4uc29sCmludGVyZmFjZSBEUkNUX1Rva2VuX0ludGVyZmFjZSB7CiAgZnVuY3Rpb24gYWRkcmVzc0NvdW50KGFkZHJlc3MgX3N3YXApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGNvdW50KTsKICBmdW5jdGlvbiBnZXRIb2xkZXJCeUluZGV4KHVpbnQgX2luZCwgYWRkcmVzcyBfc3dhcCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgaG9sZGVyKTsKICBmdW5jdGlvbiBnZXRCYWxhbmNlQnlJbmRleCh1aW50IF9pbmQsIGFkZHJlc3MgX3N3YXApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbCk7CiAgZnVuY3Rpb24gZ2V0SW5kZXhCeUFkZHJlc3MoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3N3YXApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGluZGV4KTsKICBmdW5jdGlvbiBjcmVhdGVUb2tlbih1aW50IF9zdXBwbHksIGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zd2FwKSBwdWJsaWM7CiAgZnVuY3Rpb24gcGF5KGFkZHJlc3MgX3BhcnR5LCBhZGRyZXNzIF9zd2FwKSBwdWJsaWM7CiAgZnVuY3Rpb24gcGFydHlDb3VudChhZGRyZXNzIF9zd2FwKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50IGNvdW50KTsKfQoKCi8vU3dhcCBPcmFjbGUgZnVuY3Rpb25zIC0gZGVzY3JpcHRpb25zIGNhbiBiZSBmb3VuZCBpbiBPcmFjbGUuc29sCmludGVyZmFjZSBPcmFjbGVfSW50ZXJmYWNlewogIGZ1bmN0aW9uIFJldHJpZXZlRGF0YSh1aW50IF9kYXRlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IGRhdGEpOwp9CgoKLy9UaGlzIGNvbnRyYWN0IGlzIHRoZSBzcGVjaWZpYyBEUkNUIGJhc2UgY29udHJhY3QgdGhhdCBob2xkcyB0aGUgZnVuZHMgb2YgdGhlIGNvbnRyYWN0IGFuZCByZWRpc3RyaWJ1dGVzIHRoZW0gYmFzZWQgdXBvbiB0aGUgY2hhbmdlIGluIHRoZSB1bmRlcmx5aW5nIHZhbHVlcwpjb250cmFjdCBUb2tlblRvVG9rZW5Td2FwIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8qRW51bXMqLwogIC8vRGVzY3JpYmVzIHZhcmlvdXMgc3RhdGVzIG9mIHRoZSBTd2FwCiAgZW51bSBTd2FwU3RhdGUgewogICAgY3JlYXRlZCwKICAgIG9wZW4sCiAgICBzdGFydGVkLAogICAgdG9rZW5pemVkLAogICAgcmVhZHksCiAgICBlbmRlZAogIH0KCiAgLypWYXJpYWJsZXMqLwoKICAvL0FkZHJlc3Mgb2YgdGhlIHBlcnNvbiB3aG8gY3JlYXRlZCB0aGlzIGNvbnRyYWN0IHRocm91Z2ggdGhlIEZhY3RvcnkKICBhZGRyZXNzIGNyZWF0b3I7CiAgLy9UaGUgT3JhY2xlIGFkZHJlc3MgKGNoZWNrIGZvciBsaXN0IGF0IHd3dy5naXRodWIuY29tL0RlY2VudHJhbGl6ZWREZXJpdmF0aXZlcy9PcmFjbGVzKQogIGFkZHJlc3Mgb3JhY2xlX2FkZHJlc3M7CiAgT3JhY2xlX0ludGVyZmFjZSBvcmFjbGU7CgogIC8vQWRkcmVzcyBvZiB0aGUgRmFjdG9yeSB0aGF0IGNyZWF0ZWQgdGhpcyBjb250cmFjdAogIGFkZHJlc3MgcHVibGljIGZhY3RvcnlfYWRkcmVzczsKICBGYWN0b3J5X0ludGVyZmFjZSBmYWN0b3J5OwoKICAvL0FkZHJlc3NlcyBvZiBwYXJ0aWVzIGdvaW5nIHNob3J0IGFuZCBsb25nIHRoZSByYXRlCiAgYWRkcmVzcyBwdWJsaWMgbG9uZ19wYXJ0eTsKICBhZGRyZXNzIHB1YmxpYyBzaG9ydF9wYXJ0eTsKCiAgLy9FbnVtIHN0YXRlIG9mIHRoZSBzd2FwCiAgU3dhcFN0YXRlIHB1YmxpYyBjdXJyZW50X3N0YXRlOwoKICAvL1N0YXJ0IGFuZCBlbmQgZGF0ZXMgb2YgdGhlIHN3YXBzIC0gZm9ybWF0IGlzIHRoZSBzYW1lIGFzIGJsb2NrLnRpbWVzdGFtcAogIHVpbnQgc3RhcnRfZGF0ZTsKICB1aW50IGVuZF9kYXRlOwoKICAvL1RoaXMgaXMgdGhlIGFtb3VudCB0aGF0IHRoZSBjaGFuZ2Ugd2lsbCBiZSBjYWxjdWxhdGVkIG9uLiAgMTAlIGNoYW5nZSBpbiByYXRlIG9uIDEwMCBFdGhlciBub3Rpb25hbCBpcyBhIDEwIEV0aGVyIGNoYW5nZQogIHVpbnQgbXVsdGlwbGllcjsKCiAgLy9UaGlzIGlzIHRoZSBjYWxjdWxhdGVkIHNoYXJlIGZvciB0aGUgbG9uZyBhbmQgc2hvcnQgc2lkZSBvZiB0aGUgc3dhcCAoMjAwLDAwMCBpcyBhIGZ1bGx5IGNhcHBlZCBtb3ZlKQogIHVpbnQgc2hhcmVfbG9uZzsKICB1aW50IHNoYXJlX3Nob3J0OwoKICAvLyBwYXlfdG9feCByZWZlcnMgdG8gdGhlIGFtb3VudCBvZiB0aGUgYmFzZSB0b2tlbiAoYSBvciBiKSB0byBwYXkgdG8gdGhlIGxvbmcgb3Igc2hvcnQgc2lkZSBiYXNlZCB1cG9uIHRoZSBzaGFyZV9sb25nIGFuZCBzaGFyZV9zaG9ydAogIHVpbnQgcGF5X3RvX3Nob3J0X2E7CiAgdWludCBwYXlfdG9fbG9uZ19hOwogIHVpbnQgcGF5X3RvX2xvbmdfYjsKICB1aW50IHBheV90b19zaG9ydF9iOwoKICAvL0FkZHJlc3Mgb2YgY3JlYXRlZCBsb25nIGFuZCBzaG9ydCBEUkNUIHRva2VucwogIGFkZHJlc3MgbG9uZ190b2tlbl9hZGRyZXNzOwogIGFkZHJlc3Mgc2hvcnRfdG9rZW5fYWRkcmVzczsKCiAgLy9OdW1iZXIgb2YgRFJDVCBUb2tlbnMgZGlzdHJpYnV0ZWQgdG8gYm90aCBwYXJ0aWVzCiAgdWludCBudW1fRFJDVF9sb25ndG9rZW5zOwogIHVpbnQgbnVtX0RSQ1Rfc2hvcnR0b2tlbnM7CgogIC8vQWRkcmVzc2VzIG9mIEVSQzIwIHRva2VucyB1c2VkIHRvIGVudGVyIHRoZSBzd2FwCiAgYWRkcmVzcyB0b2tlbl9hX2FkZHJlc3M7CiAgYWRkcmVzcyB0b2tlbl9iX2FkZHJlc3M7CgogIC8vVG9rZW5zIEEgYW5kIEIgdXNlZCBmb3IgdGhlIG5vdGlvbmFsCiAgRVJDMjBfSW50ZXJmYWNlIHRva2VuX2E7CiAgRVJDMjBfSW50ZXJmYWNlIHRva2VuX2I7CgogIC8vVGhlIG5vdGlvbmFsIHRoYXQgdGhlIHBheW1lbnQgaXMgY2FsY3VsYXRlZCBvbiBmcm9tIHRoZSBjaGFuZ2UgaW4gdGhlIHJlZmVyZW5jZSByYXRlCiAgdWludCBwdWJsaWMgdG9rZW5fYV9hbW91bnQ7CiAgdWludCBwdWJsaWMgdG9rZW5fYl9hbW91bnQ7CgogIHVpbnQgcHVibGljIHByZW1pdW07CgogIC8vQWRkcmVzc2VzIG9mIHRoZSB0d28gcGFydGllcyB0YWtpbmcgcGFydCBpbiB0aGUgc3dhcAogIGFkZHJlc3MgdG9rZW5fYV9wYXJ0eTsKICBhZGRyZXNzIHRva2VuX2JfcGFydHk7CgogIC8vRHVyYXRpb24gb2YgdGhlIHN3YXAscHVsbGVkIGZyb20gdGhlIEZhY3RvcnkgY29udHJhY3QKICB1aW50IGR1cmF0aW9uOwogIC8vRGF0ZSBieSB3aGljaCB0aGUgY29udHJhY3QgbXVzdCBiZSBmdW5kZWQKICB1aW50IGVudGVyRGF0ZTsKICBEUkNUX1Rva2VuX0ludGVyZmFjZSB0b2tlbjsKICBhZGRyZXNzIHVzZXJDb250cmFjdDsKCiAgLypFdmVudHMqLwoKICAvL0VtaXR0ZWQgd2hlbiBhIFN3YXAgaXMgY3JlYXRlZAogIGV2ZW50IFN3YXBDcmVhdGlvbihhZGRyZXNzIF90b2tlbl9hLCBhZGRyZXNzIF90b2tlbl9iLCB1aW50IF9zdGFydF9kYXRlLCB1aW50IF9lbmRfZGF0ZSwgYWRkcmVzcyBfY3JlYXRpbmdfcGFydHkpOwogIC8vRW1pdHRlZCB3aGVuIHRoZSBzd2FwIGhhcyBiZWVuIHBhaWQgb3V0CiAgZXZlbnQgUGFpZE91dChhZGRyZXNzIF9sb25nX3Rva2VuLCBhZGRyZXNzIF9zaG9ydF90b2tlbik7CgogIC8qTW9kaWZpZXJzKi8KCiAgLy9XaWxsIHByb2NlZWQgb25seSBpZiB0aGUgY29udHJhY3QgaXMgaW4gdGhlIGV4cGVjdGVkIHN0YXRlCiAgbW9kaWZpZXIgb25seVN0YXRlKFN3YXBTdGF0ZSBleHBlY3RlZF9zdGF0ZSkgewogICAgcmVxdWlyZShleHBlY3RlZF9zdGF0ZSA9PSBjdXJyZW50X3N0YXRlKTsKICAgIF87CiAgfQoKICAvKkZ1bmN0aW9ucyovCgogIC8qCiAgKiBDb25zdHJ1Y3RvciAtIFJ1biBieSB0aGUgZmFjdG9yeSBhdCBjb250cmFjdCBjcmVhdGlvbgogICoKICAqIEBwYXJhbSAiX2ZhY3RvcnlfYWRkcmVzcyI6IEFkZHJlc3Mgb2YgdGhlIGZhY3RvcnkgdGhhdCBjcmVhdGVkIHRoaXMgY29udHJhY3QKICAqIEBwYXJhbSAiX2NyZWF0b3IiOiBBZGRyZXNzIG9mIHRoZSBwZXJzb24gd2hvIGNyZWF0ZWQgdGhlIGNvbnRyYWN0CiAgKiBAcGFyYW0gIl91c2VyQ29udHJhY3QiOiBBZGRyZXNzIG9mIHRoZSBfdXNlckNvbnRyYWN0IHRoYXQgaXMgYXV0aG9yaXplZCB0byBpbnRlcmFjdCB3aXRoIHRoaXMgY29udHJhY3QKICAqLwogIGZ1bmN0aW9uIFRva2VuVG9Ub2tlblN3YXAgKGFkZHJlc3MgX2ZhY3RvcnlfYWRkcmVzcywgYWRkcmVzcyBfY3JlYXRvciwgYWRkcmVzcyBfdXNlckNvbnRyYWN0LCB1aW50IF9zdGFydF9kYXRlKSBwdWJsaWMgewogICAgY3VycmVudF9zdGF0ZSA9IFN3YXBTdGF0ZS5jcmVhdGVkOwogICAgY3JlYXRvciA9X2NyZWF0b3I7CiAgICBmYWN0b3J5X2FkZHJlc3MgPSBfZmFjdG9yeV9hZGRyZXNzOwogICAgdXNlckNvbnRyYWN0ID0gX3VzZXJDb250cmFjdDsKICAgIHN0YXJ0X2RhdGUgPSBfc3RhcnRfZGF0ZTsKICB9CgoKICAvL0EgZ2V0dGVyIGZ1bmN0aW9uIGZvciByZXRyaXZpbmcgc3RhbmRhcmRpemVkIHZhcmlhYmxlcyBmcm9tIHRoZSBmYWN0b3J5IGNvbnRyYWN0CiAgZnVuY3Rpb24gc2hvd1ByaXZhdGVWYXJzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfdXNlckNvbnRyYWN0LCB1aW50IG51bV9EUkNUX2xvbmcsIHVpbnQgbnVtYl9EUkNUX3Nob3J0LCB1aW50IHN3YXBfc2hhcmVfbG9uZywgdWludCBzd2FwX3NoYXJlX3Nob3J0LCBhZGRyZXNzIGxvbmdfdG9rZW5fYWRkciwgYWRkcmVzcyBzaG9ydF90b2tlbl9hZGRyLCBhZGRyZXNzIG9yYWNsZV9hZGRyLCBhZGRyZXNzIHRva2VuX2FfYWRkciwgYWRkcmVzcyB0b2tlbl9iX2FkZHIsIHVpbnQgc3dhcF9tdWx0aXBsaWVyLCB1aW50IHN3YXBfZHVyYXRpb24sIHVpbnQgc3dhcF9zdGFydF9kYXRlLCB1aW50IHN3YXBfZW5kX2RhdGUpewogICAgcmV0dXJuICh1c2VyQ29udHJhY3QsIG51bV9EUkNUX2xvbmd0b2tlbnMsIG51bV9EUkNUX3Nob3J0dG9rZW5zLHNoYXJlX2xvbmcsc2hhcmVfc2hvcnQsbG9uZ190b2tlbl9hZGRyZXNzLHNob3J0X3Rva2VuX2FkZHJlc3MsIG9yYWNsZV9hZGRyZXNzLCB0b2tlbl9hX2FkZHJlc3MsIHRva2VuX2JfYWRkcmVzcywgbXVsdGlwbGllciwgZHVyYXRpb24sIHN0YXJ0X2RhdGUsIGVuZF9kYXRlKTsKICB9CgogIC8qCiAgKiBBbGxvd3MgdGhlIHNlbmRlciB0byBjcmVhdGUgdGhlIHRlcm1zIGZvciB0aGUgc3dhcAogICogQHBhcmFtICJfYW1vdW50X2EiOiBBbW91bnQgb2YgVG9rZW4gQSB0aGF0IHNob3VsZCBiZSBkZXBvc2l0ZWQgZm9yIHRoZSBub3Rpb25hbAogICogQHBhcmFtICJfYW1vdW50X2IiOiBBbW91bnQgb2YgVG9rZW4gQiB0aGF0IHNob3VsZCBiZSBkZXBvc2l0ZWQgZm9yIHRoZSBub3Rpb25hbAogICogQHBhcmFtICJfc2VuZGVyX2lzX2xvbmciOiBEZW5vdGVzIHdoZXRoZXIgdGhlIHNlbmRlciBpcyBzZXQgYXMgdGhlIHNob3J0IG9yIGxvbmcgcGFydHkKICAqIEBwYXJhbSAiX3NlbmRlckFkZCI6IFN0YXRlcyB0aGUgb3duZXIgb2YgdGhpcyBzaWRlIG9mIHRoZSBjb250cmFjdCAoZG9lcyBub3QgaGF2ZSB0byBiZSBtc2cuc2VuZGVyKQogICovCiAgZnVuY3Rpb24gQ3JlYXRlU3dhcCgKICAgIHVpbnQgX2Ftb3VudF9hLAogICAgdWludCBfYW1vdW50X2IsCiAgICBib29sIF9zZW5kZXJfaXNfbG9uZywKICAgIGFkZHJlc3MgX3NlbmRlckFkZAogICAgKSBwYXlhYmxlIHB1YmxpYyBvbmx5U3RhdGUoU3dhcFN0YXRlLmNyZWF0ZWQpIHsKCiAgICByZXF1aXJlKAogICAgICBtc2cuc2VuZGVyID09IGNyZWF0b3IgfHwgKG1zZy5zZW5kZXIgPT0gdXNlckNvbnRyYWN0ICYmIF9zZW5kZXJBZGQgPT0gY3JlYXRvcikKICAgICk7CiAgICBmYWN0b3J5ID0gRmFjdG9yeV9JbnRlcmZhY2UoZmFjdG9yeV9hZGRyZXNzKTsKICAgIHNldFZhcnMoKTsKICAgIGVuZF9kYXRlID0gc3RhcnRfZGF0ZS5hZGQoZHVyYXRpb24ubXVsKDg2NDAwKSk7CiAgICB0b2tlbl9hX2Ftb3VudCA9IF9hbW91bnRfYTsKICAgIHRva2VuX2JfYW1vdW50ID0gX2Ftb3VudF9iOwoKICAgIHByZW1pdW0gPSB0aGlzLmJhbGFuY2U7CiAgICB0b2tlbl9hID0gRVJDMjBfSW50ZXJmYWNlKHRva2VuX2FfYWRkcmVzcyk7CiAgICB0b2tlbl9hX3BhcnR5ID0gX3NlbmRlckFkZDsKICAgIGlmIChfc2VuZGVyX2lzX2xvbmcpCiAgICAgIGxvbmdfcGFydHkgPSBfc2VuZGVyQWRkOwogICAgZWxzZQogICAgICBzaG9ydF9wYXJ0eSA9IF9zZW5kZXJBZGQ7CiAgICBjdXJyZW50X3N0YXRlID0gU3dhcFN0YXRlLm9wZW47CiAgfQoKICBmdW5jdGlvbiBzZXRWYXJzKCkgaW50ZXJuYWx7CiAgICAgIChvcmFjbGVfYWRkcmVzcyxkdXJhdGlvbixtdWx0aXBsaWVyLHRva2VuX2FfYWRkcmVzcyx0b2tlbl9iX2FkZHJlc3MpID0gZmFjdG9yeS5nZXRWYXJpYWJsZXMoKTsKICB9CgogIC8qCiAgKiBUaGlzIGZ1bmN0aW9uIGlzIGZvciB0aG9zZSBlbnRlcmluZyB0aGUgc3dhcC4gVGhlIGRldGFpbHMgb2YgdGhlIHN3YXAgYXJlIHJlLWVudGVyZWQgYW5kIGNoZWNrZWQKICAqIHRvIGVuc3VyZSB0aGUgZW50ZXJpbmcgcGFydHkgaXMgZW50ZXJpbmcgdGhlIGNvcnJlY3Qgc3dhcC4gTm90ZSB0aGF0IHRoZSB0b2tlbnMgeW91IGFyZSBlbnRlcmluZyB3aXRoCiAgKiBkbyBub3QgbmVlZCB0byBiZSBlbnRlcmVkIGFzIGEgdmFyaWFibGUsIGJ1dCB5b3Ugc2hvdWxkIGVuc3VyZSB0aGF0IHRoZSBjb250cmFjdCBpcyBmdW5kZWQuCiAgKgogICogQHBhcmFtOiBhbGwgcGFyYW1ldGVycyBoYXZlIHRoZSBzYW1lIGZ1bmN0aW9ucyBhcyB0aG9zZSBpbiB0aGUgQ3JlYXRlU3dhcCBmdW5jdGlvbgogICovCiAgZnVuY3Rpb24gRW50ZXJTd2FwKAogICAgdWludCBfYW1vdW50X2EsCiAgICB1aW50IF9hbW91bnRfYiwKICAgIGJvb2wgX3NlbmRlcl9pc19sb25nLAogICAgYWRkcmVzcyBfc2VuZGVyQWRkCiAgICApIHB1YmxpYyBvbmx5U3RhdGUoU3dhcFN0YXRlLm9wZW4pIHsKCiAgICAvL1JlcXVpcmUgdGhhdCBhbGwgb2YgdGhlIGluZm9ybWF0aW9uIG9mIHRoZSBzd2FwIHdhcyBlbnRlcmVkIGNvcnJlY3RseSBieSB0aGUgZW50ZXJpbmcgcGFydHkuICBQcmV2ZW50cyBwYXJ0eUEgZnJvbSBleGl0aW5nIGFuZCBjaGFuZ2luZyBkZXRhaWxzCiAgICByZXF1aXJlKAogICAgICB0b2tlbl9hX2Ftb3VudCA9PSBfYW1vdW50X2EgJiYKICAgICAgdG9rZW5fYl9hbW91bnQgPT0gX2Ftb3VudF9iICYmCiAgICAgIHRva2VuX2FfcGFydHkgIT0gX3NlbmRlckFkZAogICAgKTsKCiAgICB0b2tlbl9iID0gRVJDMjBfSW50ZXJmYWNlKHRva2VuX2JfYWRkcmVzcyk7CiAgICB0b2tlbl9iX3BhcnR5ID0gX3NlbmRlckFkZDsKCiAgICAvL1NldCB0aGUgZW50ZXJpbmcgcGFydHkgYXMgdGhlIHNob3J0IG9yIGxvbmcgcGFydHkKICAgIGlmIChfc2VuZGVyX2lzX2xvbmcpIHsKICAgICAgcmVxdWlyZShsb25nX3BhcnR5ID09IDApOwogICAgICBsb25nX3BhcnR5ID0gX3NlbmRlckFkZDsKICAgIH0gZWxzZSB7CiAgICAgIHJlcXVpcmUoc2hvcnRfcGFydHkgPT0gMCk7CiAgICAgIHNob3J0X3BhcnR5ID0gX3NlbmRlckFkZDsKICAgIH0KCiAgICBTd2FwQ3JlYXRpb24odG9rZW5fYV9hZGRyZXNzLCB0b2tlbl9iX2FkZHJlc3MsIHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCB0b2tlbl9iX3BhcnR5KTsKICAgIGVudGVyRGF0ZSA9IG5vdzsKICAgIGN1cnJlbnRfc3RhdGUgPSBTd2FwU3RhdGUuc3RhcnRlZDsKICB9CgogIC8qCiAgKiBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgdGhlIERSQ1QgdG9rZW5zIGZvciB0aGUgc2hvcnQgYW5kIGxvbmcgcGFydGllcywgYW5kIGVuc3VyZXMgdGhlIHNob3J0IGFuZCBsb25nIHBhcnRpZXMKICAqIGhhdmUgZnVuZGVkIHRoZSBjb250cmFjdCB3aXRoIHRoZSBjb3JyZWN0IGFtb3VudCBvZiB0aGUgRVJDMjAgdG9rZW5zIEEgYW5kIEIKICAqCiAgKi8KICBmdW5jdGlvbiBjcmVhdGVUb2tlbnMoKSBwdWJsaWMgb25seVN0YXRlKFN3YXBTdGF0ZS5zdGFydGVkKXsKCiAgICAvL0Vuc3VyZSB0aGUgY29udHJhY3QgaGFzIGJlZW4gZnVuZGVkIGJ5IHRva2VucyBhIGFuZCBiIHdpdGhpbiAxIGRheQogICAgcmVxdWlyZSgKICAgICAgbm93IDwgKGVudGVyRGF0ZSArIDg2NDAwKSAmJgogICAgICB0b2tlbl9hLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA+PSB0b2tlbl9hX2Ftb3VudCAmJgogICAgICB0b2tlbl9iLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA+PSB0b2tlbl9iX2Ftb3VudAogICAgKTsKCiAgICB1aW50IHRva2VucmF0aW8gPSAxOwogICAgKGxvbmdfdG9rZW5fYWRkcmVzcyx0b2tlbnJhdGlvKSA9IGZhY3RvcnkuY3JlYXRlVG9rZW4odG9rZW5fYV9hbW91bnQsIGxvbmdfcGFydHksdHJ1ZSxzdGFydF9kYXRlKTsKICAgIG51bV9EUkNUX2xvbmd0b2tlbnMgPSB0b2tlbl9hX2Ftb3VudC5kaXYodG9rZW5yYXRpbyk7CiAgICAoc2hvcnRfdG9rZW5fYWRkcmVzcyx0b2tlbnJhdGlvKSA9IGZhY3RvcnkuY3JlYXRlVG9rZW4odG9rZW5fYl9hbW91bnQsIHNob3J0X3BhcnR5LGZhbHNlLHN0YXJ0X2RhdGUpOwogICAgbnVtX0RSQ1Rfc2hvcnR0b2tlbnMgPSB0b2tlbl9iX2Ftb3VudC5kaXYodG9rZW5yYXRpbyk7CiAgICBjdXJyZW50X3N0YXRlID0gU3dhcFN0YXRlLnRva2VuaXplZDsKICAgIGlmIChwcmVtaXVtID4gMCl7CiAgICAgIGlmIChjcmVhdG9yID09IGxvbmdfcGFydHkpewogICAgICBzaG9ydF9wYXJ0eS50cmFuc2ZlcihwcmVtaXVtKTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBsb25nX3BhcnR5LnRyYW5zZmVyKHByZW1pdW0pOwogICAgICB9CiAgICB9CiAgfQoKICAvKgogICogVGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIHRoZSBwYXlvdXQgb2YgdGhlIHN3YXAuIEl0IGNhbiBiZSBjYWxsZWQgYWZ0ZXIgdGhlIFN3YXAgaGFzIGJlZW4gdG9rZW5pemVkLgogICogVGhlIHZhbHVlIG9mIHRoZSB1bmRlcmx5aW5nIGNhbm5vdCByZWFjaCB6ZXJvLCBidXQgcmF0aGVyIGNhbiBvbmx5IGdldCB3aXRoaW4gMC4wMDEgKiB0aGUgcHJlY2lzaW9uCiAgKiBvZiB0aGUgT3JhY2xlLgogICovCiAgZnVuY3Rpb24gQ2FsY3VsYXRlKCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShub3cgPj0gZW5kX2RhdGUgKyA4NjQwMCk7CiAgICAvL0NvbW1lbnQgb3V0IGFib3ZlIGZvciB0ZXN0aW5nIHB1cnBvc2VzCiAgICBvcmFjbGUgPSBPcmFjbGVfSW50ZXJmYWNlKG9yYWNsZV9hZGRyZXNzKTsKICAgIHVpbnQgc3RhcnRfdmFsdWUgPSBvcmFjbGUuUmV0cmlldmVEYXRhKHN0YXJ0X2RhdGUpOwogICAgdWludCBlbmRfdmFsdWUgPSBvcmFjbGUuUmV0cmlldmVEYXRhKGVuZF9kYXRlKTsKCiAgICB1aW50IHJhdGlvOwogICAgaWYgKHN0YXJ0X3ZhbHVlID4gMCAmJiBlbmRfdmFsdWUgPiAwKQogICAgICByYXRpbyA9IChlbmRfdmFsdWUpLm11bCgxMDAwMDApLmRpdihzdGFydF92YWx1ZSk7CiAgICBlbHNlIGlmIChlbmRfdmFsdWUgPiAwKQogICAgICByYXRpbyA9IDEwZTEwOwogICAgZWxzZSBpZiAoc3RhcnRfdmFsdWUgPiAwKQogICAgICByYXRpbyA9IDA7CiAgICBlbHNlCiAgICAgIHJhdGlvID0gMTAwMDAwOwogICAgaWYgKHJhdGlvID09IDEwMDAwMCkgewogICAgICBzaGFyZV9sb25nID0gc2hhcmVfc2hvcnQgPSByYXRpbzsKICAgIH0gZWxzZSBpZiAocmF0aW8gPiAxMDAwMDApIHsKICAgICAgc2hhcmVfbG9uZyA9ICgocmF0aW8pLnN1YigxMDAwMDApKS5tdWwobXVsdGlwbGllcikuYWRkKDEwMDAwMCk7CiAgICAgIGlmIChzaGFyZV9sb25nID49IDIwMDAwMCkKICAgICAgICBzaGFyZV9zaG9ydCA9IDA7CiAgICAgIGVsc2UKICAgICAgICBzaGFyZV9zaG9ydCA9IDIwMDAwMC1zaGFyZV9sb25nOwogICAgfSBlbHNlIHsKICAgICAgc2hhcmVfc2hvcnQgPSBTYWZlTWF0aC5zdWIoMTAwMDAwLHJhdGlvKS5tdWwobXVsdGlwbGllcikuYWRkKDEwMDAwMCk7CiAgICAgICBpZiAoc2hhcmVfc2hvcnQgPj0gMjAwMDAwKQogICAgICAgIHNoYXJlX2xvbmcgPSAwOwogICAgICBlbHNlCiAgICAgICAgc2hhcmVfbG9uZyA9IDIwMDAwMC0gc2hhcmVfc2hvcnQ7CiAgICB9CgogICAgLy9DYWxjdWxhdGUgdGhlIHBheW91dHMgdG8gbG9uZyBhbmQgc2hvcnQgcGFydGllcyBiYXNlZCBvbiB0aGUgc2hvcnQgYW5kIGxvbmcgc2hhcmVzCiAgICBjYWxjdWxhdGVQYXlvdXQoKTsKCiAgICBjdXJyZW50X3N0YXRlID0gU3dhcFN0YXRlLnJlYWR5OwogIH0KCiAgLyoKICAqIENhbGN1bGF0ZXMgdGhlIGFtb3VudCBwYWlkIHRvIHRoZSBzaG9ydCBhbmQgbG9uZyBwYXJ0aWVzIHBlciB0b2tlbgogICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlUGF5b3V0KCkgaW50ZXJuYWwgewogICAgdWludCByYXRpbzsKICAgIHRva2VuX2FfYW1vdW50ID0gdG9rZW5fYV9hbW91bnQubXVsKDk5NSkuZGl2KDEwMDApOwogICAgdG9rZW5fYl9hbW91bnQgPSB0b2tlbl9iX2Ftb3VudC5tdWwoOTk1KS5kaXYoMTAwMCk7CiAgICAvL0lmIHJhdGlvIGlzIGZsYXQganVzdCBzd2FwIHRva2Vucywgb3RoZXJ3aXNlIHBheSB0aGUgd2lubmVyIHRoZSBlbnRpcmUgb3RoZXIgdG9rZW4gYW5kIG9ubHkgcGF5IHRoZSBvdGhlciBzaWRlIGEgcG9ydGlvbiBvZiB0aGUgb3Bwb3NpdGUgdG9rZW4KICAgIGlmIChzaGFyZV9sb25nID09IDEwMDAwMCkgewogICAgICBwYXlfdG9fc2hvcnRfYSA9ICh0b2tlbl9hX2Ftb3VudCkuZGl2KG51bV9EUkNUX2xvbmd0b2tlbnMpOwogICAgICBwYXlfdG9fbG9uZ19iID0gKHRva2VuX2JfYW1vdW50KS5kaXYobnVtX0RSQ1Rfc2hvcnR0b2tlbnMpOwogICAgICBwYXlfdG9fc2hvcnRfYiA9IDA7CiAgICAgIHBheV90b19sb25nX2EgPSAwOwogICAgfSBlbHNlIGlmIChzaGFyZV9sb25nID4gMTAwMDAwKSB7CiAgICAgIHJhdGlvID0gU2FmZU1hdGgubWluKDEwMDAwMCwgKHNoYXJlX2xvbmcpLnN1YigxMDAwMDApKTsKICAgICAgcGF5X3RvX2xvbmdfYiA9ICh0b2tlbl9iX2Ftb3VudCkuZGl2KG51bV9EUkNUX3Nob3J0dG9rZW5zKTsKICAgICAgcGF5X3RvX3Nob3J0X2EgPSAoU2FmZU1hdGguc3ViKDEwMDAwMCxyYXRpbykpLm11bCh0b2tlbl9hX2Ftb3VudCkuZGl2KG51bV9EUkNUX2xvbmd0b2tlbnMpLmRpdigxMDAwMDApOwogICAgICBwYXlfdG9fbG9uZ19hID0gcmF0aW8ubXVsKHRva2VuX2FfYW1vdW50KS5kaXYobnVtX0RSQ1RfbG9uZ3Rva2VucykuZGl2KDEwMDAwMCk7CiAgICAgIHBheV90b19zaG9ydF9iID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIHJhdGlvID0gU2FmZU1hdGgubWluKDEwMDAwMCwgKHNoYXJlX3Nob3J0KS5zdWIoMTAwMDAwKSk7CiAgICAgIHBheV90b19zaG9ydF9hID0gKHRva2VuX2FfYW1vdW50KS5kaXYobnVtX0RSQ1RfbG9uZ3Rva2Vucyk7CiAgICAgIHBheV90b19sb25nX2IgPSAoU2FmZU1hdGguc3ViKDEwMDAwMCxyYXRpbykpLm11bCh0b2tlbl9iX2Ftb3VudCkuZGl2KG51bV9EUkNUX3Nob3J0dG9rZW5zKS5kaXYoMTAwMDAwKTsKICAgICAgcGF5X3RvX3Nob3J0X2IgPSByYXRpby5tdWwodG9rZW5fYl9hbW91bnQpLmRpdihudW1fRFJDVF9zaG9ydHRva2VucykuZGl2KDEwMDAwMCk7CiAgICAgIHBheV90b19sb25nX2EgPSAwOwogICAgfQogIH0KCiAgLyoKICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBhZnRlciB0aGUgc3dhcCBpcyB0b2tlbml6ZWQgb3IgYWZ0ZXIgdGhlIENhbGN1bGF0ZSBmdW5jdGlvbiBpcyBjYWxsZWQuCiAgKiBJZiB0aGUgQ2FsY3VsYXRlIGZ1bmN0aW9uIGhhcyBub3QgeWV0IGJlZW4gY2FsbGVkLCB0aGlzIGZ1bmN0aW9uIHdpbGwgY2FsbCBpdC4KICAqIFRoZSBmdW5jdGlvbiB0aGVuIHBheXMgZXZlcnkgdG9rZW4gaG9sZGVyIG9mIGJvdGggdGhlIGxvbmcgYW5kIHNob3J0IERSQ1QgdG9rZW5zCiAgKi8KICBmdW5jdGlvbiBmb3JjZVBheSh1aW50IF9iZWdpbiwgdWludCBfZW5kKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgLy9DYWxscyB0aGUgQ2FsY3VsYXRlIGZ1bmN0aW9uIGZpcnN0IHRvIGNhbGN1bGF0ZSBzaG9ydCBhbmQgbG9uZyBzaGFyZXMKICAgIGlmKGN1cnJlbnRfc3RhdGUgPT0gU3dhcFN0YXRlLnRva2VuaXplZCAvKiYmIG5vdyA+IGVuZF9kYXRlICsgODY0MDAqLyl7CiAgICAgIENhbGN1bGF0ZSgpOwogICAgfQoKICAgIC8vVGhlIHN0YXRlIGF0IHRoaXMgcG9pbnQgc2hvdWxkIGFsd2F5cyBiZSBTd2FwU3RhdGUucmVhZHkKICAgIHJlcXVpcmUoY3VycmVudF9zdGF0ZSA9PSBTd2FwU3RhdGUucmVhZHkpOwoKICAgIC8vTG9vcCB0aHJvdWdoIHRoZSBvd25lcnMgb2YgbG9uZyBhbmQgc2hvcnQgRFJDVCB0b2tlbnMgYW5kIHBheSB0aGVtCgogICAgdG9rZW4gPSBEUkNUX1Rva2VuX0ludGVyZmFjZShsb25nX3Rva2VuX2FkZHJlc3MpOwogICAgdWludCBjb3VudCA9IHRva2VuLmFkZHJlc3NDb3VudChhZGRyZXNzKHRoaXMpKTsKICAgIHVpbnQgbG9vcF9jb3VudCA9IGNvdW50IDwgX2VuZCA/IGNvdW50IDogX2VuZDsKICAgIC8vSW5kZXhpbmcgYmVnaW5zIGF0IDEgZm9yIERSQ1RfVG9rZW4gYmFsYW5jZXMKICAgIGZvcih1aW50IGkgPSBsb29wX2NvdW50LTE7IGkgPj0gX2JlZ2luIDsgaS0tKSB7CiAgICAgIGFkZHJlc3MgbG9uZ19vd25lciA9IHRva2VuLmdldEhvbGRlckJ5SW5kZXgoaSwgYWRkcmVzcyh0aGlzKSk7CiAgICAgIHVpbnQgdG9fcGF5X2xvbmcgPSB0b2tlbi5nZXRCYWxhbmNlQnlJbmRleChpLCBhZGRyZXNzKHRoaXMpKTsKICAgICAgcGF5U3dhcChsb25nX293bmVyLCB0b19wYXlfbG9uZywgdHJ1ZSk7CiAgICB9CgogICAgdG9rZW4gPSBEUkNUX1Rva2VuX0ludGVyZmFjZShzaG9ydF90b2tlbl9hZGRyZXNzKTsKICAgIGNvdW50ID0gdG9rZW4uYWRkcmVzc0NvdW50KGFkZHJlc3ModGhpcykpOwogICAgbG9vcF9jb3VudCA9IGNvdW50IDwgX2VuZCA/IGNvdW50IDogX2VuZDsKICAgIGZvcih1aW50IGogPSBsb29wX2NvdW50LTE7IGogPj0gX2JlZ2luIDsgai0tKSB7CiAgICAgIGFkZHJlc3Mgc2hvcnRfb3duZXIgPSB0b2tlbi5nZXRIb2xkZXJCeUluZGV4KGosIGFkZHJlc3ModGhpcykpOwogICAgICB1aW50IHRvX3BheV9zaG9ydCA9IHRva2VuLmdldEJhbGFuY2VCeUluZGV4KGosIGFkZHJlc3ModGhpcykpOwogICAgICBwYXlTd2FwKHNob3J0X293bmVyLCB0b19wYXlfc2hvcnQsIGZhbHNlKTsKICAgIH0KCiAgICBpZiAobG9vcF9jb3VudCA9PSBjb3VudCl7CiAgICAgICAgdG9rZW5fYS50cmFuc2ZlcihmYWN0b3J5X2FkZHJlc3MsIHRva2VuX2EuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKICAgICAgICB0b2tlbl9iLnRyYW5zZmVyKGZhY3RvcnlfYWRkcmVzcywgdG9rZW5fYi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkpOwogICAgICAgIFBhaWRPdXQobG9uZ190b2tlbl9hZGRyZXNzLCBzaG9ydF90b2tlbl9hZGRyZXNzKTsKICAgICAgICBjdXJyZW50X3N0YXRlID0gU3dhcFN0YXRlLmVuZGVkOwogICAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qCiAgKiBUaGlzIGZ1bmN0aW9uIHBheXMgdGhlIHJlY2VpdmVyIGFuIGFtb3VudCBkZXRlcm1pbmVkIGJ5IHRoZSBDYWxjdWxhdGUgZnVuY3Rpb24KICAqCiAgKiBAcGFyYW0gIl9yZWNlaXZlciI6IFRoZSByZWNpcGllbnQgb2YgdGhlIHBheW91dAogICogQHBhcmFtICJfYW1vdW50IjogVGhlIGFtb3VudCBvZiB0b2tlbiB0aGUgcmVjaXBpZW50IGhvbGRzCiAgKiBAcGFyYW0gIl9pc19sb25nIjogV2hldGhlciBvciBub3QgdGhlIHJlY2lldmVyIGhvbGRzIGEgbG9uZyBvciBzaG9ydCB0b2tlbgogICovCiAgZnVuY3Rpb24gcGF5U3dhcChhZGRyZXNzIF9yZWNlaXZlciwgdWludCBfYW1vdW50LCBib29sIF9pc19sb25nKSBpbnRlcm5hbCB7CiAgICBpZiAoX2lzX2xvbmcpIHsKICAgICAgaWYgKHBheV90b19sb25nX2EgPiAwKQogICAgICAgIHRva2VuX2EudHJhbnNmZXIoX3JlY2VpdmVyLCBfYW1vdW50Lm11bChwYXlfdG9fbG9uZ19hKSk7CiAgICAgIGlmIChwYXlfdG9fbG9uZ19iID4gMCl7CiAgICAgICAgdG9rZW5fYi50cmFuc2ZlcihfcmVjZWl2ZXIsIF9hbW91bnQubXVsKHBheV90b19sb25nX2IpKTsKICAgICAgfQogICAgICAgIGZhY3RvcnkucGF5VG9rZW4oX3JlY2VpdmVyLGxvbmdfdG9rZW5fYWRkcmVzcyk7CiAgICB9IGVsc2UgewoKICAgICAgaWYgKHBheV90b19zaG9ydF9hID4gMCkKICAgICAgICB0b2tlbl9hLnRyYW5zZmVyKF9yZWNlaXZlciwgX2Ftb3VudC5tdWwocGF5X3RvX3Nob3J0X2EpKTsKICAgICAgaWYgKHBheV90b19zaG9ydF9iID4gMCl7CiAgICAgICAgdG9rZW5fYi50cmFuc2ZlcihfcmVjZWl2ZXIsIF9hbW91bnQubXVsKHBheV90b19zaG9ydF9iKSk7CiAgICAgIH0KICAgICAgIGZhY3RvcnkucGF5VG9rZW4oX3JlY2VpdmVyLHNob3J0X3Rva2VuX2FkZHJlc3MpOwogICAgfQogIH0KCgogIC8qCiAgKiBUaGlzIGZ1bmN0aW9uIGFsbG93cyBib3RoIHBhcnRpZXMgdG8gZXhpdC4gSWYgb25seSB0aGUgY3JlYXRvciBoYXMgZW50ZXJlZCB0aGUgc3dhcCwgdGhlbiB0aGUgc3dhcCBjYW4gYmUgY2FuY2VsbGVkIGFuZCB0aGUgZGV0YWlscyBtb2RpZmllZAogICogT25jZSB0d28gcGFydGllcyBlbnRlciB0aGUgc3dhcCwgdGhlIGNvbnRyYWN0IGlzIG51bGwgYWZ0ZXIgY2FuY2VsbGVkLiBPbmNlIHRva2VuaXplZCBob3dldmVyLCB0aGUgY29udHJhY3QgY2Fubm90IGJlIGVuZGVkLgogICovCiAgZnVuY3Rpb24gRXhpdCgpIHB1YmxpYyB7CiAgIGlmIChjdXJyZW50X3N0YXRlID09IFN3YXBTdGF0ZS5vcGVuICYmIG1zZy5zZW5kZXIgPT0gdG9rZW5fYV9wYXJ0eSkgewogICAgICB0b2tlbl9hLnRyYW5zZmVyKHRva2VuX2FfcGFydHksIHRva2VuX2FfYW1vdW50KTsKICAgICAgaWYgKHByZW1pdW0+MCl7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihwcmVtaXVtKTsKICAgICAgfQogICAgICBkZWxldGUgdG9rZW5fYV9hbW91bnQ7CiAgICAgIGRlbGV0ZSB0b2tlbl9iX2Ftb3VudDsKICAgICAgZGVsZXRlIHByZW1pdW07CiAgICAgIGN1cnJlbnRfc3RhdGUgPSBTd2FwU3RhdGUuY3JlYXRlZDsKICAgIH0gZWxzZSBpZiAoY3VycmVudF9zdGF0ZSA9PSBTd2FwU3RhdGUuc3RhcnRlZCAmJiAobXNnLnNlbmRlciA9PSB0b2tlbl9hX3BhcnR5IHx8IG1zZy5zZW5kZXIgPT0gdG9rZW5fYl9wYXJ0eSkpIHsKICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gdG9rZW5fYV9wYXJ0eSB8fCBtc2cuc2VuZGVyID09IHRva2VuX2JfcGFydHkpIHsKICAgICAgICB0b2tlbl9iLnRyYW5zZmVyKHRva2VuX2JfcGFydHksIHRva2VuX2IuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKICAgICAgICB0b2tlbl9hLnRyYW5zZmVyKHRva2VuX2FfcGFydHksIHRva2VuX2EuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKICAgICAgICBjdXJyZW50X3N0YXRlID0gU3dhcFN0YXRlLmVuZGVkOwogICAgICAgIGlmIChwcmVtaXVtID4gMCkgeyBjcmVhdG9yLnRyYW5zZmVyKHByZW1pdW0pO30KICAgICAgfQogICAgfQogIH0KfQoKCi8vU3dhcCBEZXBsb3llciBDb250cmFjdC0tIHB1cnBvc2UgaXMgdG8gc2F2ZSBnYXMgZm9yIGRlcGxveW1lbnQgb2YgRmFjdG9yeSBjb250cmFjdApjb250cmFjdCBEZXBsb3llciB7CiAgYWRkcmVzcyBvd25lcjsKICBhZGRyZXNzIGZhY3Rvcnk7CgogIGZ1bmN0aW9uIERlcGxveWVyKGFkZHJlc3MgX2ZhY3RvcnkpIHB1YmxpYyB7CiAgICBmYWN0b3J5ID0gX2ZhY3Rvcnk7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBmdW5jdGlvbiBuZXdDb250cmFjdChhZGRyZXNzIF9wYXJ0eSwgYWRkcmVzcyB1c2VyX2NvbnRyYWN0LCB1aW50IF9zdGFydF9kYXRlKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBjcmVhdGVkKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZmFjdG9yeSk7CiAgICBhZGRyZXNzIG5ld19jb250cmFjdCA9IG5ldyBUb2tlblRvVG9rZW5Td2FwKGZhY3RvcnksIF9wYXJ0eSwgdXNlcl9jb250cmFjdCwgX3N0YXJ0X2RhdGUpOwogICAgcmV0dXJuIG5ld19jb250cmFjdDsKICB9CgogICBmdW5jdGlvbiBzZXRWYXJzKGFkZHJlc3MgX2ZhY3RvcnksIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgewogICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBmYWN0b3J5ID0gX2ZhY3Rvcnk7CiAgICBvd25lciA9IF9vd25lcjsKICB9Cn0='.
	

]
