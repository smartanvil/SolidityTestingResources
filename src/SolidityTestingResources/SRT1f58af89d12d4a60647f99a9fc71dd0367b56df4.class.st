Class {
	#name : #SRT1f58af89d12d4a60647f99a9fc71dd0367b56df4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1f58af89d12d4a60647f99a9fc71dd0367b56df4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgQ2xhaW1hYmxlCiAqIEBkZXYgRXh0ZW5zaW9uIGZvciB0aGUgT3duYWJsZSBjb250cmFjdCwgd2hlcmUgdGhlIG93bmVyc2hpcCBuZWVkcyB0byBiZSBjbGFpbWVkLgogKiBUaGlzIGFsbG93cyB0aGUgbmV3IG93bmVyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIuCiAqLwpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgcGVuZGluZ093bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlQZW5kaW5nT3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcyB0byBmaW5hbGl6ZSB0aGUgdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAoKSBvbmx5UGVuZGluZ093bmVyIHB1YmxpYyB7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgcGVuZGluZ093bmVyID0gYWRkcmVzcygwKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgYmUgYWJsZSB0byByZWNvdmVyIHRva2VucwogKiBAYXV0aG9yIFN5bFRpCiAqIEBkZXYgVGhpcyBhbGxvdyBhIGNvbnRyYWN0IHRvIHJlY292ZXIgYW55IEVSQzIwIHRva2VuIHJlY2VpdmVkIGluIGEgY29udHJhY3QgYnkgdHJhbnNmZXJyaW5nIHRoZSBiYWxhbmNlIHRvIHRoZSBjb250cmFjdCBvd25lci4KICogVGhpcyB3aWxsIHByZXZlbnQgYW55IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBDYW5SZWNsYWltVG9rZW4gaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMEJhc2ljOwoKICAvKioKICAgKiBAZGV2IFJlY2xhaW0gYWxsIEVSQzIwQmFzaWMgY29tcGF0aWJsZSB0b2tlbnMKICAgKiBAcGFyYW0gdG9rZW4gRVJDMjBCYXNpYyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiByZWNsYWltVG9rZW4oRVJDMjBCYXNpYyB0b2tlbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHRva2VuLnNhZmVUcmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgfQoKfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIERXb3JsZCBjb250cmFjdC4KY29udHJhY3QgQnVybnVwR2FtZUFjY2Vzc0NvbnRyb2wgaXMgQ2xhaW1hYmxlLCBQYXVzYWJsZSwgQ2FuUmVjbGFpbVRva2VuIHsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwogICAgCiAgICBmdW5jdGlvbiBCdXJudXBHYW1lQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgLy8gVGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENGTy4KICAgICAgICBjZm9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIAogICAgICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDT08uCiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0ZPLW9ubHkgZnVuY3Rpb25hbGl0eS4KICAgIG1vZGlmaWVyIG9ubHlDRk8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ09PLW9ubHkgZnVuY3Rpb25hbGl0eS4KICAgIG1vZGlmaWVyIG9ubHlDT08oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0ZPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBjb250cmFjdCBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld0NGTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENGTy4KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfbmV3Q0ZPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjZm9BZGRyZXNzID0gX25ld0NGTzsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ09PLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBjb250cmFjdCBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld0NPTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENPTy4KICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfbmV3Q09PICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjb29BZGRyZXNzID0gX25ld0NPTzsKICAgIH0KfQoKCi8vLyBAZGV2IERlZmluZXMgYmFzZSBkYXRhIHN0cnVjdHVyZXMgZm9yIERXb3JsZC4KY29udHJhY3QgQnVybnVwR2FtZUJhc2UgaXMgQnVybnVwR2FtZUFjY2Vzc0NvbnRyb2wgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIGV2ZW50IE5leHRHYW1lKHVpbnQyNTYgcm93cywgdWludDI1NiBjb2xzLCB1aW50MjU2IGFjdGl2aXR5VGltZXIsIHVpbnQyNTYgdW5jbGFpbWVkVGlsZVByaWNlLCB1aW50MjU2IGJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLCB1aW50MjU2IGJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UsIHVpbnQyNTYgYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlLCB1aW50MjU2IGJ1eW91dEZlZVBlcmNlbnRhZ2UpOwogICAgZXZlbnQgU3RhcnQodWludDI1NiBpbmRleGVkIGdhbWVJbmRleCwgYWRkcmVzcyBpbmRleGVkIHN0YXJ0ZXIsIHVpbnQyNTYgdGltZXN0YW1wLCB1aW50MjU2IHByaXplUG9vbCwgdWludDI1NiByb3dzLCB1aW50MjU2IGNvbHMsIHVpbnQyNTYgYWN0aXZpdHlUaW1lciwgdWludDI1NiB1bmNsYWltZWRUaWxlUHJpY2UsIHVpbnQyNTYgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UsIHVpbnQyNTYgYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSwgdWludDI1NiBidXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UsIHVpbnQyNTYgYnV5b3V0RmVlUGVyY2VudGFnZSk7CiAgICBldmVudCBFbmQodWludDI1NiBpbmRleGVkIGdhbWVJbmRleCwgYWRkcmVzcyBpbmRleGVkIHdpbm5lciwgdWludDI1NiBpbmRleGVkIGlkZW50aWZpZXIsIHVpbnQyNTYgeCwgdWludDI1NiB5LCB1aW50MjU2IHRpbWVzdGFtcCwgdWludDI1NiBwcml6ZSk7CiAgICBldmVudCBCdXlvdXQodWludDI1NiBpbmRleGVkIGdhbWVJbmRleCwgYWRkcmVzcyBpbmRleGVkIHBsYXllciwgdWludDI1NiBpbmRleGVkIGlkZW50aWZpZXIsIHVpbnQyNTYgeCwgdWludDI1NiB5LCB1aW50MjU2IHRpbWVzdGFtcCwgdWludDI1NiB0aW1lb3V0VGltZXN0YW1wLCB1aW50MjU2IG5ld1ByaWNlLCB1aW50MjU2IG5ld1ByaXplUG9vbCk7CiAgICBldmVudCBTcGljZVVwUHJpemVQb29sKHVpbnQyNTYgaW5kZXhlZCBnYW1lSW5kZXgsIGFkZHJlc3MgaW5kZXhlZCBzcGljZXIsIHVpbnQyNTYgc3BpY2VBZGRlZCwgc3RyaW5nIG1lc3NhZ2UsIHVpbnQyNTYgbmV3UHJpemVQb29sKTsKICAgIAogICAgLy8vIEBkZXYgU3RydWN0IHRvIGhvbGQgZ2FtZSBzZXR0aW5ncy4KICAgIHN0cnVjdCBHYW1lU2V0dGluZ3MgewogICAgICAgIHVpbnQyNTYgcm93czsgLy8gNQogICAgICAgIHVpbnQyNTYgY29sczsgLy8gOAogICAgICAgIAogICAgICAgIC8vLyBAZGV2IFRpbWUgYWZ0ZXIgbGFzdCB0cmFkZSBhZnRlciB3aGljaCB0aWxlcyBiZWNvbWUgaW5hY3RpdmUuCiAgICAgICAgdWludDI1NiBhY3Rpdml0eVRpbWVyOyAvLyAzNjAwCiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgQmFzZSBwcmljZSBmb3IgdW5jbGFpbWVkIHRpbGVzLgogICAgICAgIHVpbnQyNTYgdW5jbGFpbWVkVGlsZVByaWNlOyAvLyAwLjAxIGV0aGVyCiAgICAgICAgCiAgICAgICAgLy8vIEBkZXYgUGVyY2VudGFnZSBvZiB0aGUgYnV5b3V0IHByaWNlIHRoYXQgZ29lcyB0b3dhcmRzIHRoZSByZWZlcnJhbAogICAgICAgIC8vLyBib251cy4gSW4gMS8xMDAwdGggb2YgYSBwZXJjZW50YWdlLgogICAgICAgIHVpbnQyNTYgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2U7IC8vIDc1MAogICAgICAgIAogICAgICAgIC8vLyBAZGV2IFBlcmNlbnRhZ2Ugb2YgdGhlIGJ1eW91dCBwcmljZSB0aGF0IGdvZXMgdG93YXJkcyB0aGUgcHJpemUKICAgICAgICAvLy8gcG9vbC4gSW4gMS8xMDAwdGggb2YgYSBwZXJjZW50YWdlLgogICAgICAgIHVpbnQyNTYgYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZTsgLy8gMTAwMDAKICAgIAogICAgICAgIC8vLyBAZGV2IFBlcmNlbnRhZ2Ugb2YgdGhlIGJ1eW91dCBwcmljZSB0aGF0IGdvZXMgdG93YXJkcyBkaXZpZGVuZHMKICAgICAgICAvLy8gc3Vycm91bmRpbmcgdGhlIHRpbGUgdGhhdCBpcyBib3VnaHQgb3V0LiBJbiBpbiAxLzEwMDB0aCBvZgogICAgICAgIC8vLyBhIHBlcmNlbnRhZ2UuCiAgICAgICAgdWludDI1NiBidXlvdXREaXZpZGVuZFBlcmNlbnRhZ2U7IC8vIDUwMDAKICAgIAogICAgICAgIC8vLyBAZGV2IEJ1eW91dCBmZWUgaW4gMS8xMDAwdGggb2YgYSBwZXJjZW50YWdlLgogICAgICAgIHVpbnQyNTYgYnV5b3V0RmVlUGVyY2VudGFnZTsgLy8gMjUwMAogICAgfQogICAgCiAgICAvLy8gQGRldiBTdHJ1Y3QgdG8gaG9sZCBnYW1lIHN0YXRlLgogICAgc3RydWN0IEdhbWVTdGF0ZSB7CiAgICAgICAgLy8vIEBkZXYgQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGdhbWUgaXMgbGl2ZS4KICAgICAgICBib29sIGdhbWVTdGFydGVkOwogICAgCiAgICAgICAgLy8vIEBkZXYgVGltZSBhdCB3aGljaCB0aGUgZ2FtZSBzdGFydGVkLgogICAgICAgIHVpbnQyNTYgZ2FtZVN0YXJ0VGltZXN0YW1wOwogICAgCiAgICAgICAgLy8vIEBkZXYgS2VlcCB0cmFjayBvZiB0aWxlIG93bmVyc2hpcC4KICAgICAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGlkZW50aWZpZXJUb093bmVyOwogICAgICAgIAogICAgICAgIC8vLyBAZGV2IEtlZXAgdHJhY2sgb2YgdGhlIHRpbWVzdGFtcCBhdCB3aGljaCBhIHRpbGUgd2FzIGZsaXBwZWQgbGFzdC4KICAgICAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIGlkZW50aWZpZXJUb0J1eW91dFRpbWVzdGFtcDsKICAgICAgICAKICAgICAgICAvLy8gQGRldiBDdXJyZW50IHRpbGUgcHJpY2UuCiAgICAgICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBpZGVudGlmaWVyVG9CdXlvdXRQcmljZTsKICAgICAgICAKICAgICAgICAvLy8gQGRldiBLZWVwIHRyYWNrIG9mIHRoZSB0aWxlIHRoYXQgd2FzIGZsaXBwZWQgbGFzdC4KICAgICAgICB1aW50MjU2IGxhc3RGbGlwcGVkVGlsZTsKICAgICAgICAKICAgICAgICAvLy8gQGRldiBUaGUgcHJpemUgcG9vbC4KICAgICAgICB1aW50MjU2IHByaXplUG9vbDsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgTWFwcGluZyBmcm9tIGdhbWUgaW5kaWNlcyB0byBnYW1lIHNldHRpbmdzLgogICAgbWFwcGluZyAodWludDI1NiA9PiBHYW1lU2V0dGluZ3MpIHB1YmxpYyBnYW1lU2V0dGluZ3M7CiAgICAKICAgIC8vLyBAbm90aWNlIE1hcHBpbmcgZnJvbSBnYW1lIGluZGljZXMgdG8gZ2FtZSBzdGF0ZXMuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IEdhbWVTdGF0ZSkgcHVibGljIGdhbWVTdGF0ZXM7CiAgICAKICAgIC8vLyBAbm90aWNlIFRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBnYW1lLgogICAgdWludDI1NiBwdWJsaWMgZ2FtZUluZGV4ID0gMDsKICAgIAogICAgLy8vIEBkZXYgU2V0dGluZ3MgZm9yIHRoZSBuZXh0IGdhbWUKICAgIEdhbWVTZXR0aW5ncyBwdWJsaWMgbmV4dEdhbWVTZXR0aW5nczsKICAgIAogICAgZnVuY3Rpb24gQnVybnVwR2FtZUJhc2UoKSBwdWJsaWMgewogICAgICAgIC8vIEluaXRpYWwgc2V0dGluZ3MuCiAgICAgICAgc2V0TmV4dEdhbWVTZXR0aW5ncygKICAgICAgICAgICAgNCwgLy8gcm93cwogICAgICAgICAgICA1LCAvLyBjb2xzCiAgICAgICAgICAgIDM2MDAsIC8vIGFjdGl2aXR5VGltZXIKICAgICAgICAgICAgMC4wMSBldGhlciwgLy8gdW5jbGFpbWVkVGlsZVByaWNlCiAgICAgICAgICAgIDc1MCwgLy8gYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UKICAgICAgICAgICAgMTAwMDAsIC8vIGJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UKICAgICAgICAgICAgNTAwMCwgLy8gYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlCiAgICAgICAgICAgIDI1MDAgLy8gYnV5b3V0RmVlUGVyY2VudGFnZQogICAgICAgICk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFRlc3Qgd2hldGhlciB0aGUgY29vcmRpbmF0ZSBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1wYXJ0IG9mIHRoZSBjb29yZGluYXRlIHRvIHRlc3QuCiAgICAvLy8gQHBhcmFtIHkgVGhlIHktcGFydCBvZiB0aGUgY29vcmRpbmF0ZSB0byB0ZXN0LgogICAgZnVuY3Rpb24gdmFsaWRDb29yZGluYXRlKHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4geCA8IGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmNvbHMgJiYgeSA8IGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLnJvd3M7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFJlcHJlc2VudCBhIDJEIGNvb3JkaW5hdGUgYXMgYSBzaW5nbGUgdWludC4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1jb29yZGluYXRlLgogICAgLy8vIEBwYXJhbSB5IFRoZSB5LWNvb3JkaW5hdGUuCiAgICBmdW5jdGlvbiBjb29yZGluYXRlVG9JZGVudGlmaWVyKHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKHZhbGlkQ29vcmRpbmF0ZSh4LCB5KSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuICh5ICogZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0uY29scykgKyB4OwogICAgfQogICAgCiAgICAvLy8gQGRldiBUdXJuIGEgc2luZ2xlIHVpbnQgcmVwcmVzZW50YXRpb24gb2YgYSBjb29yZGluYXRlIGludG8gaXRzIHggYW5kIHkgcGFydHMuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXIgVGhlIHVpbnQgcmVwcmVzZW50YXRpb24gb2YgYSBjb29yZGluYXRlLgogICAgLy8vIEFzc3VtZXMgdGhlIGlkZW50aWZpZXIgaXMgdmFsaWQuCiAgICBmdW5jdGlvbiBpZGVudGlmaWVyVG9Db29yZGluYXRlKHVpbnQyNTYgaWRlbnRpZmllcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2IHgsIHVpbnQyNTYgeSkgewogICAgICAgIHkgPSBpZGVudGlmaWVyIC8gZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0uY29sczsKICAgICAgICB4ID0gaWRlbnRpZmllciAtICh5ICogZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0uY29scyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIHNldHRpbmdzIGZvciB0aGUgbmV4dCBnYW1lLgogICAgZnVuY3Rpb24gc2V0TmV4dEdhbWVTZXR0aW5ncygKICAgICAgICB1aW50MjU2IHJvd3MsCiAgICAgICAgdWludDI1NiBjb2xzLAogICAgICAgIHVpbnQyNTYgYWN0aXZpdHlUaW1lciwKICAgICAgICB1aW50MjU2IHVuY2xhaW1lZFRpbGVQcmljZSwKICAgICAgICB1aW50MjU2IGJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLAogICAgICAgIHVpbnQyNTYgYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSwKICAgICAgICB1aW50MjU2IGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSwKICAgICAgICB1aW50MjU2IGJ1eW91dEZlZVBlcmNlbnRhZ2UKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5Q0ZPCiAgICB7CiAgICAgICAgLy8gQnV5b3V0IGRpdmlkZW5kIG11c3QgYmUgMiUgYXQgdGhlIGxlYXN0LgogICAgICAgIC8vIEJ1eW91dCBkaXZpZGVuZCBwZXJjZW50YWdlIG1heSBiZSAxMi41JSBhdCB0aGUgbW9zdC4KICAgICAgICByZXF1aXJlKDIwMDAgPD0gYnV5b3V0RGl2aWRlbmRQZXJjZW50YWdlICYmIGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSA8PSAxMjUwMCk7CiAgICAgICAgCiAgICAgICAgLy8gQnV5b3V0IGZlZSBtYXkgYmUgNSUgYXQgdGhlIG1vc3QuCiAgICAgICAgcmVxdWlyZShidXlvdXRGZWVQZXJjZW50YWdlIDw9IDUwMDApOwogICAgICAgIAogICAgICAgIG5leHRHYW1lU2V0dGluZ3MgPSBHYW1lU2V0dGluZ3MoewogICAgICAgICAgICByb3dzOiByb3dzLAogICAgICAgICAgICBjb2xzOiBjb2xzLAogICAgICAgICAgICBhY3Rpdml0eVRpbWVyOiBhY3Rpdml0eVRpbWVyLAogICAgICAgICAgICB1bmNsYWltZWRUaWxlUHJpY2U6IHVuY2xhaW1lZFRpbGVQcmljZSwKICAgICAgICAgICAgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2U6IGJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLAogICAgICAgICAgICBidXlvdXRQcml6ZVBvb2xQZXJjZW50YWdlOiBidXlvdXRQcml6ZVBvb2xQZXJjZW50YWdlLAogICAgICAgICAgICBidXlvdXREaXZpZGVuZFBlcmNlbnRhZ2U6IGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSwKICAgICAgICAgICAgYnV5b3V0RmVlUGVyY2VudGFnZTogYnV5b3V0RmVlUGVyY2VudGFnZQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIE5leHRHYW1lKHJvd3MsIGNvbHMsIGFjdGl2aXR5VGltZXIsIHVuY2xhaW1lZFRpbGVQcmljZSwgYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UsIGJ1eW91dFByaXplUG9vbFBlcmNlbnRhZ2UsIGJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSwgYnV5b3V0RmVlUGVyY2VudGFnZSk7CiAgICB9Cn0KCgovLy8gQGRldiBIb2xkcyBvd25lcnNoaXAgZnVuY3Rpb25hbGl0eSBzdWNoIGFzIHRyYW5zZmVycmluZy4KY29udHJhY3QgQnVybnVwR2FtZU93bmVyc2hpcCBpcyBCdXJudXBHYW1lQmFzZSB7CiAgICAKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwogICAgCiAgICAvLy8gQG5vdGljZSBOYW1lIG9mIHRoZSBjb2xsZWN0aW9uIG9mIGRlZWRzIChub24tZnVuZ2libGUgdG9rZW4pLCBhcyBkZWZpbmVkIGluIEVSQzcyMU1ldGFkYXRhLgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZE5hbWUpIHsKICAgICAgICBfZGVlZE5hbWUgPSAiQnVybnVwIFRpbGVzIjsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU3ltYm9sIG9mIHRoZSBjb2xsZWN0aW9uIG9mIGRlZWRzIChub24tZnVuZ2libGUgdG9rZW4pLCBhcyBkZWZpbmVkIGluIEVSQzcyMU1ldGFkYXRhLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkU3ltYm9sKSB7CiAgICAgICAgX2RlZWRTeW1ib2wgPSAiQlVSTiI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3Mgb3ducyBhIHBhcnRpY3VsYXIgdGlsZS4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBvd25lciB0byBjaGVjayBmb3IuCiAgICAvLy8gQHBhcmFtIF9pZGVudGlmaWVyIFRoZSB0aWxlIGlkZW50aWZpZXIgdG8gY2hlY2sgZm9yLgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2lkZW50aWZpZXIpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvT3duZXJbX2lkZW50aWZpZXJdID09IF9vd25lcjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyBkZWVkIHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRoZSBkZWVkIGZyb20uCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCB0by4KICAgIC8vLyBAcGFyYW0gX2lkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2lkZW50aWZpZXIpIGludGVybmFsIHsKICAgICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXAuCiAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb093bmVyW19pZGVudGlmaWVyXSA9IF90bzsKICAgICAgICAKICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfaWRlbnRpZmllcik7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIGRlZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9pZGVudGlmaWVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKSB7CiAgICAgICAgX293bmVyID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmlkZW50aWZpZXJUb093bmVyW19pZGVudGlmaWVyXTsKCiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0byBhIHNtYXJ0CiAgICAvLy8gY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEsIG9yIHlvdXIKICAgIC8vLyBkZWVkIG1heSBiZSBsb3N0IGZvcmV2ZXIuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byB0cmFuc2Zlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfaWRlbnRpZmllcikgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gT25lIGNhbiBvbmx5IHRyYW5zZmVyIHRoZWlyIG93biBkZWVkcy4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9pZGVudGlmaWVyKSk7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2lkZW50aWZpZXIpOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBQdWxsUGF5bWVudAogKiBAZGV2IEJhc2UgY29udHJhY3Qgc3VwcG9ydGluZyBhc3luYyBzZW5kIGZvciBwdWxsIHBheW1lbnRzLiBJbmhlcml0IGZyb20gdGhpcwogKiBjb250cmFjdCBhbmQgdXNlIGFzeW5jU2VuZCBpbnN0ZWFkIG9mIHNlbmQuCiAqLwpjb250cmFjdCBQdWxsUGF5bWVudCB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcGF5bWVudHM7CiAgdWludDI1NiBwdWJsaWMgdG90YWxQYXltZW50czsKCiAgLyoqCiAgKiBAZGV2IHdpdGhkcmF3IGFjY3VtdWxhdGVkIGJhbGFuY2UsIGNhbGxlZCBieSBwYXllZS4KICAqLwogIGZ1bmN0aW9uIHdpdGhkcmF3UGF5bWVudHMoKSBwdWJsaWMgewogICAgYWRkcmVzcyBwYXllZSA9IG1zZy5zZW5kZXI7CiAgICB1aW50MjU2IHBheW1lbnQgPSBwYXltZW50c1twYXllZV07CgogICAgcmVxdWlyZShwYXltZW50ICE9IDApOwogICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gcGF5bWVudCk7CgogICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuc3ViKHBheW1lbnQpOwogICAgcGF5bWVudHNbcGF5ZWVdID0gMDsKCiAgICBhc3NlcnQocGF5ZWUuc2VuZChwYXltZW50KSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBwYXllciB0byBzdG9yZSB0aGUgc2VudCBhbW91bnQgYXMgY3JlZGl0IHRvIGJlIHB1bGxlZC4KICAqIEBwYXJhbSBkZXN0IFRoZSBkZXN0aW5hdGlvbiBhZGRyZXNzIG9mIHRoZSBmdW5kcy4KICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCB0byB0cmFuc2Zlci4KICAqLwogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIGRlc3QsIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCB7CiAgICBwYXltZW50c1tkZXN0XSA9IHBheW1lbnRzW2Rlc3RdLmFkZChhbW91bnQpOwogICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuYWRkKGFtb3VudCk7CiAgfQp9CgoKLy8vIEBkZXYgSW1wbGVtZW50cyBhY2Nlc3MgY29udHJvbCB0byB0aGUgQnVyblVwIHdhbGxldC4KY29udHJhY3QgQnVybnVwSG9sZGluZ0FjY2Vzc0NvbnRyb2wgaXMgQ2xhaW1hYmxlLCBQYXVzYWJsZSwgQ2FuUmVjbGFpbVRva2VuIHsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICAKICAgIC8vLyBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciBhbiBhZGRyZXNzIGlzIGEgQnVyblVwIEdhbWUgY29udHJhY3QuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGJ1cm51cEdhbWU7CgogICAgZnVuY3Rpb24gQnVybnVwSG9sZGluZ0FjY2Vzc0NvbnRyb2woKSBwdWJsaWMgewogICAgICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRk8uCiAgICAgICAgY2ZvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0ZPLW9ubHkgZnVuY3Rpb25hbGl0eS4KICAgIG1vZGlmaWVyIG9ubHlDRk8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgZnVuY3Rpb25hbGl0eSB0aGF0IG1heSBvbmx5IGJlIGNhbGxlZCBieSBhIEJ1cm5VcCBnYW1lLgogICAgbW9kaWZpZXIgb25seUJ1cm51cEdhbWUoKSB7CiAgICAgICAgLy8gVGhlIHNlbmRlciBtdXN0IGJlIGEgcmVjb2duaXplZCBCdXJuVXAgZ2FtZSBhZGRyZXNzLgogICAgICAgIHJlcXVpcmUoYnVybnVwR2FtZVttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDRk8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IGNvbnRyYWN0IG93bmVyLgogICAgLy8vIEBwYXJhbSBfbmV3Q0ZPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0ZPLgogICAgZnVuY3Rpb24gc2V0Q0ZPKGFkZHJlc3MgX25ld0NGTykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdDRk8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBZGQgYSBCdXJudXAgZ2FtZSBjb250cmFjdCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBCdXJudXAgZ2FtZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGFkZEJ1cm51cEdhbWUoYWRkcmVzcyBhZGRyKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGJ1cm51cEdhbWVbYWRkcl0gPSB0cnVlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBSZW1vdmUgYSBCdXJudXAgZ2FtZSBjb250cmFjdCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBCdXJudXAgZ2FtZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHJlbW92ZUJ1cm51cEdhbWUoYWRkcmVzcyBhZGRyKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGRlbGV0ZSBidXJudXBHYW1lW2FkZHJdOwogICAgfQp9CgoKLy8vIEBkZXYgSW1wbGVtZW50cyB0aGUgQnVyblVwIHdhbGxldC4KY29udHJhY3QgQnVybnVwSG9sZGluZ1JlZmVycmFsIGlzIEJ1cm51cEhvbGRpbmdBY2Nlc3NDb250cm9sIHsKCiAgICBldmVudCBTZXRSZWZlcnJlcihhZGRyZXNzIGluZGV4ZWQgcmVmZXJyYWwsIGFkZHJlc3MgaW5kZXhlZCByZWZlcnJlcik7CgogICAgLy8vIFJlZmVycmVyIG9mIHBsYXllci4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYWRkcmVzcykgYWRkcmVzc1RvUmVmZXJyZXJBZGRyZXNzOwogICAgCiAgICAvLy8gR2V0IHRoZSByZWZlcnJlciBvZiBhIHBsYXllci4KICAgIC8vLyBAcGFyYW0gcGxheWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIgdG8gZ2V0IHRoZSByZWZlcnJlciBvZi4KICAgIGZ1bmN0aW9uIHJlZmVycmVyT2YoYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYWRkcmVzc1RvUmVmZXJyZXJBZGRyZXNzW3BsYXllcl07CiAgICB9CiAgICAKICAgIC8vLyBTZXQgdGhlIHJlZmVycmVyIGZvciBhIHBsYXllci4KICAgIC8vLyBAcGFyYW0gcGxheWVyQWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyIHRvIHNldCB0aGUgcmVmZXJyZXIgZm9yLgogICAgLy8vIEBwYXJhbSByZWZlcnJlckFkZHIgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlZmVycmVyIHRvIHNldC4KICAgIGZ1bmN0aW9uIF9zZXRSZWZlcnJlcihhZGRyZXNzIHBsYXllckFkZHIsIGFkZHJlc3MgcmVmZXJyZXJBZGRyKSBpbnRlcm5hbCB7CiAgICAgICAgYWRkcmVzc1RvUmVmZXJyZXJBZGRyZXNzW3BsYXllckFkZHJdID0gcmVmZXJyZXJBZGRyOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgU2V0UmVmZXJyZXIocGxheWVyQWRkciwgcmVmZXJyZXJBZGRyKTsKICAgIH0KfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgdGhlIEJ1cm5VcCB3YWxsZXQuCmNvbnRyYWN0IEJ1cm51cEhvbGRpbmdDb3JlIGlzIEJ1cm51cEhvbGRpbmdSZWZlcnJhbCwgUHVsbFBheW1lbnQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5MTsKICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5MjsKICAgIAogICAgZnVuY3Rpb24gQnVybnVwSG9sZGluZ0NvcmUoYWRkcmVzcyBfYmVuZWZpY2lhcnkxLCBhZGRyZXNzIF9iZW5lZmljaWFyeTIpIHB1YmxpYyB7CiAgICAgICAgLy8gVGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENGTy4KICAgICAgICBjZm9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIHR3byBiZW5lZmljaWFyaWVzLgogICAgICAgIGJlbmVmaWNpYXJ5MSA9IF9iZW5lZmljaWFyeTE7CiAgICAgICAgYmVuZWZpY2lhcnkyID0gX2JlbmVmaWNpYXJ5MjsKICAgIH0KICAgIAogICAgLy8vIFBheSB0aGUgdHdvIGJlbmVmaWNpYXJpZXMuIFNlbmRzIGJvdGggYmVuZWZpY2lhcmllcwogICAgLy8vIGEgaGFsdmUgb2YgdGhlIHBheW1lbnQuCiAgICBmdW5jdGlvbiBwYXlCZW5lZmljaWFyaWVzKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgdWludDI1NiBwYXltZW50SGFsdmUgPSBtc2cudmFsdWUuZGl2KDIpOwogICAgICAgIAogICAgICAgIC8vIFdlIGRvIG5vdCB3YW50IGEgc2luZ2xlIHdlaSB0byBnZXQgc3R1Y2suCiAgICAgICAgdWludDI1NiBvdGhlclBheW1lbnRIYWx2ZSA9IG1zZy52YWx1ZS5zdWIocGF5bWVudEhhbHZlKTsKICAgICAgICAKICAgICAgICAvLyBTZW5kIHBheW1lbnQgZm9yIG1hbnVhbCB3aXRoZHJhd2FsLgogICAgICAgIGFzeW5jU2VuZChiZW5lZmljaWFyeTEsIHBheW1lbnRIYWx2ZSk7CiAgICAgICAgYXN5bmNTZW5kKGJlbmVmaWNpYXJ5Miwgb3RoZXJQYXltZW50SGFsdmUpOwogICAgfQogICAgCiAgICAvLy8gU2V0cyBhIG5ldyBhZGRyZXNzIGZvciBCZW5lZmljaWFyeSBvbmUuCiAgICAvLy8gQHBhcmFtIGFkZHIgVGhlIG5ldyBhZGRyZXNzLgogICAgZnVuY3Rpb24gc2V0QmVuZWZpY2lhcnkxKGFkZHJlc3MgYWRkcikgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgYmVuZWZpY2lhcnkxID0gYWRkcjsKICAgIH0KICAgIAogICAgLy8vIFNldHMgYSBuZXcgYWRkcmVzcyBmb3IgQmVuZWZpY2lhcnkgdHdvLgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBuZXcgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHNldEJlbmVmaWNpYXJ5MihhZGRyZXNzIGFkZHIpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIGJlbmVmaWNpYXJ5MiA9IGFkZHI7CiAgICB9CiAgICAKICAgIC8vLyBTZXQgYSByZWZlcnJlci4KICAgIC8vLyBAcGFyYW0gcGxheWVyQWRkciBUaGUgYWRkcmVzcyB0byBzZXQgdGhlIHJlZmVycmVyIGZvci4KICAgIC8vLyBAcGFyYW0gcmVmZXJyZXJBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSByZWZlcnJlciB0byBzZXQuCiAgICBmdW5jdGlvbiBzZXRSZWZlcnJlcihhZGRyZXNzIHBsYXllckFkZHIsIGFkZHJlc3MgcmVmZXJyZXJBZGRyKSBleHRlcm5hbCBvbmx5QnVybnVwR2FtZSB3aGVuTm90UGF1c2VkIHJldHVybnMoYm9vbCkgewogICAgICAgIGlmIChyZWZlcnJlck9mKHBsYXllckFkZHIpID09IGFkZHJlc3MoMHgwKSAmJiBwbGF5ZXJBZGRyICE9IHJlZmVycmVyQWRkcikgewogICAgICAgICAgICAvLyBTZXQgdGhlIHJlZmVycmVyLCBpZiBubyByZWZlcnJlciBoYXMgYmVlbiBzZXQgeWV0LCBhbmQgdGhlIHBsYXllcgogICAgICAgICAgICAvLyBhbmQgcmVmZXJyZXIgYXJlIG5vdCB0aGUgc2FtZSBhZGRyZXNzLgogICAgICAgICAgICBfc2V0UmVmZXJyZXIocGxheWVyQWRkciwgcmVmZXJyZXJBZGRyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluZGljYXRlIHN1Y2Nlc3MuCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBJbmRpY2F0ZSBmYWlsdXJlLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQoKCi8vLyBAZGV2IEhvbGRzIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbmFuY2UgcmVsYXRlZCB0byB0aWxlcy4KY29udHJhY3QgQnVybnVwR2FtZUZpbmFuY2UgaXMgQnVybnVwR2FtZU93bmVyc2hpcCwgUHVsbFBheW1lbnQgewogICAgLy8vIEFkZHJlc3Mgb2YgQnVybnVwIHdhbGxldAogICAgQnVybnVwSG9sZGluZ0NvcmUgYnVybnVwSG9sZGluZzsKICAgIAogICAgZnVuY3Rpb24gQnVybnVwR2FtZUZpbmFuY2UoYWRkcmVzcyBidXJudXBIb2xkaW5nQWRkcmVzcykgcHVibGljIHsKICAgICAgICBidXJudXBIb2xkaW5nID0gQnVybnVwSG9sZGluZ0NvcmUoYnVybnVwSG9sZGluZ0FkZHJlc3MpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBGaW5kIHRoZSBfY2xhaW1lZF8gdGlsZXMgc3Vycm91bmRpbmcgYSB0aWxlLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSB0aWxlIHRvIGdldCB0aGUgc3Vycm91bmRpbmcgdGlsZXMgZm9yLgogICAgZnVuY3Rpb24gX2NsYWltZWRTdXJyb3VuZGluZ1RpbGVzKHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gbWVtb3J5KSB7CiAgICAgICAgdmFyICh4LCB5KSA9IGlkZW50aWZpZXJUb0Nvb3JkaW5hdGUoX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gRmluZCBhbGwgY2xhaW1lZCBzdXJyb3VuZGluZyB0aWxlcy4KICAgICAgICB1aW50MjU2IGNsYWltZWQgPSAwOwogICAgICAgIAogICAgICAgIC8vIENyZWF0ZSBtZW1vcnkgYnVmZmVyIGNhcGFibGUgb2YgaG9sZGluZyBhbGwgdGlsZXMuCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfdGlsZXMgPSBuZXcgdWludDI1NltdKDgpOwogICAgICAgIAogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgbmVpZ2hib3JzLgogICAgICAgIGZvciAoaW50MjU2IGR4ID0gLTE7IGR4IDw9IDE7IGR4KyspIHsKICAgICAgICAgICAgZm9yIChpbnQyNTYgZHkgPSAtMTsgZHkgPD0gMTsgZHkrKykgewogICAgICAgICAgICAgICAgaWYgKGR4ID09IDAgJiYgZHkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgdGhlIGNlbnRlciAoaS5lLiwgdGhlIHRpbGUgaXRzZWxmKS4KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdWludDI1NiBueCA9IHVpbnQyNTYoaW50MjU2KHgpICsgZHgpOwogICAgICAgICAgICAgICAgdWludDI1NiBueSA9IHVpbnQyNTYoaW50MjU2KHkpICsgZHkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobnggPj0gZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0uY29scyB8fCBueSA+PSBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5yb3dzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBjb29yZGluYXRlIGlzIG91dHNpZGUgdGhlIGdhbWUgYm91bmRzLgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGNvb3JkaW5hdGVzIG9mIHRoaXMgbmVpZ2hib3JpbmcgaWRlbnRpZmllci4KICAgICAgICAgICAgICAgIHVpbnQyNTYgbmVpZ2hib3JJZGVudGlmaWVyID0gY29vcmRpbmF0ZVRvSWRlbnRpZmllcigKICAgICAgICAgICAgICAgICAgICBueCwKICAgICAgICAgICAgICAgICAgICBueQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9Pd25lcltuZWlnaGJvcklkZW50aWZpZXJdICE9IGFkZHJlc3MoMHgwKSkgewogICAgICAgICAgICAgICAgICAgIF90aWxlc1tjbGFpbWVkXSA9IG5laWdoYm9ySWRlbnRpZmllcjsKICAgICAgICAgICAgICAgICAgICBjbGFpbWVkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTWVtb3J5IGFycmF5cyBjYW5ub3QgYmUgcmVzaXplZCwgc28gY29weSBhbGwKICAgICAgICAvLyB0aWxlcyBmcm9tIHRoZSBidWZmZXIgdG8gdGhlIHRpbGUgYXJyYXkuCiAgICAgICAgdWludDI1NltdIG1lbW9yeSB0aWxlcyA9IG5ldyB1aW50MjU2W10oY2xhaW1lZCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgY2xhaW1lZDsgaSsrKSB7CiAgICAgICAgICAgIHRpbGVzW2ldID0gX3RpbGVzW2ldOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gdGlsZXM7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgbmV4dCBidXlvdXQgcHJpY2UgZ2l2ZW4gdGhlIGN1cnJlbnQgdG90YWwgYnV5b3V0IGNvc3QuCiAgICAvLy8gQHBhcmFtIHByaWNlIFRoZSBjdXJyZW50IGJ1eW91dCBwcmljZS4KICAgIGZ1bmN0aW9uIG5leHRCdXlvdXRQcmljZSh1aW50MjU2IHByaWNlKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKHByaWNlIDwgMC4wMiBldGhlcikgewogICAgICAgICAgICByZXR1cm4gcHJpY2UubXVsKDIwMCkuZGl2KDEwMCk7IC8vICogMi4wCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHByaWNlLm11bCgxNTApLmRpdigxMDApOyAvLyAqIDEuNQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXNzaWduIHRoZSBwcm9jZWVkcyBvZiB0aGUgYnV5b3V0LgogICAgZnVuY3Rpb24gX2Fzc2lnbkJ1eW91dFByb2NlZWRzKAogICAgICAgIGFkZHJlc3MgY3VycmVudE93bmVyLAogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMsCiAgICAgICAgdWludDI1NiBmZWUsCiAgICAgICAgdWludDI1NiBjdXJyZW50T3duZXJXaW5uaW5ncywKICAgICAgICB1aW50MjU2IHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSwKICAgICAgICB1aW50MjU2IHJlZmVycmFsQm9udXMsCiAgICAgICAgdWludDI1NiBwcml6ZVBvb2xGdW5kcwogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAKICAgICAgICBpZiAoY3VycmVudE93bmVyICE9IDB4MCkgewogICAgICAgICAgICAvLyBTZW5kIHRoZSBjdXJyZW50IG93bmVyJ3Mgd2lubmluZ3MuCiAgICAgICAgICAgIF9zZW5kRnVuZHMoY3VycmVudE93bmVyLCBjdXJyZW50T3duZXJXaW5uaW5ncyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gY3VycmVudCBvd25lci4KICAgICAgICAgICAgZmVlID0gZmVlLmFkZChjdXJyZW50T3duZXJXaW5uaW5ncyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEFzc2lnbiBkaXZpZGVuZHMgdG8gb3duZXJzIG9mIHN1cnJvdW5kaW5nIHRpbGVzLgogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGNsYWltZWRTdXJyb3VuZGluZ1RpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgYmVuZWZpY2lhcnkgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvT3duZXJbY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXNbaV1dOwogICAgICAgICAgICBfc2VuZEZ1bmRzKGJlbmVmaWNpYXJ5LCB0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLy8gRGlzdHJpYnV0ZSB0aGUgcmVmZXJyYWwgYm9udXNlcyAoaWYgYW55KSBmb3IgYW4gYWRkcmVzcy4KICAgICAgICBhZGRyZXNzIHJlZmVycmVyMSA9IGJ1cm51cEhvbGRpbmcucmVmZXJyZXJPZihtc2cuc2VuZGVyKTsKICAgICAgICBpZiAocmVmZXJyZXIxICE9IDB4MCkgewogICAgICAgICAgICBfc2VuZEZ1bmRzKHJlZmVycmVyMSwgcmVmZXJyYWxCb251cyk7CiAgICAgICAgCiAgICAgICAgICAgIGFkZHJlc3MgcmVmZXJyZXIyID0gYnVybnVwSG9sZGluZy5yZWZlcnJlck9mKHJlZmVycmVyMSk7CiAgICAgICAgICAgIGlmIChyZWZlcnJlcjIgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICBfc2VuZEZ1bmRzKHJlZmVycmVyMiwgcmVmZXJyYWxCb251cyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBUaGVyZSBpcyBubyBzZWNvbmQtbGV2ZWwgcmVmZXJyZXIuCiAgICAgICAgICAgICAgICBmZWUgPSBmZWUuYWRkKHJlZmVycmFsQm9udXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVGhlcmUgYXJlIG5vIGZpcnN0IGFuZCBzZWNvbmQtbGV2ZWwgcmVmZXJyZXJzLgogICAgICAgICAgICBmZWUgPSBmZWUuYWRkKHJlZmVycmFsQm9udXMubXVsKDIpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gU2VuZCB0aGUgZmVlIHRvIHRoZSBob2xkaW5nIGNvbnRyYWN0LgogICAgICAgIGJ1cm51cEhvbGRpbmcucGF5QmVuZWZpY2lhcmllcy52YWx1ZShmZWUpKCk7CiAgICAgICAgCiAgICAgICAgLy8gSW5jcmVhc2UgdGhlIHByaXplIHBvb2wuCiAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbCA9IGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wcml6ZVBvb2wuYWRkKHByaXplUG9vbEZ1bmRzKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGFuZCBhc3NpZ24gdGhlIHByb2NlZWRzIGZyb20gdGhlIGJ1eW91dC4KICAgIC8vLyBAcGFyYW0gY3VycmVudE93bmVyIFRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSB0aWxlIHRoYXQgaXMgYmVpbmcgYm91Z2h0IG91dC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgdGlsZSB0aGF0IGlzIGJlaW5nIGJvdWdodCBvdXQuCiAgICAvLy8gQHBhcmFtIGNsYWltZWRTdXJyb3VuZGluZ1RpbGVzIFRoZSBzdXJyb3VuZGluZyB0aWxlcyB0aGF0IGhhdmUgYmVlbiBjbGFpbWVkLgogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZUFuZEFzc2lnbkJ1eW91dFByb2NlZWRzKGFkZHJlc3MgY3VycmVudE93bmVyLCB1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTZbXSBtZW1vcnkgY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMpCiAgICAgICAgaW50ZXJuYWwgCiAgICAgICAgcmV0dXJucyAodWludDI1NiBwcmljZSkKICAgIHsKICAgICAgICAvLyBUaGUgY3VycmVudCBwcmljZS4KICAgICAgICAKICAgICAgICBpZiAoY3VycmVudE93bmVyID09IDB4MCkgewogICAgICAgICAgICBwcmljZSA9IGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLnVuY2xhaW1lZFRpbGVQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmljZSA9IGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9CdXlvdXRQcmljZVtfZGVlZElkXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSB2YXJpYWJsZSBkaXZpZGVuZHMgYmFzZWQgb24gdGhlIGJ1eW91dCBwcmljZQogICAgICAgIC8vIChvbmx5IHRvIGJlIHBhaWQgaWYgdGhlcmUgYXJlIHN1cnJvdW5kaW5nIHRpbGVzKS4KICAgICAgICB1aW50MjU2IHZhcmlhYmxlRGl2aWRlbmRzID0gcHJpY2UubXVsKGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmJ1eW91dERpdmlkZW5kUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGZlZXMsIHJlZmVycmFsIGJvbnVzLCBhbmQgcHJpemUgcG9vbCBmdW5kcy4KICAgICAgICB1aW50MjU2IGZlZSAgICAgICAgICAgID0gcHJpY2UubXVsKGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmJ1eW91dEZlZVBlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgICAgIHVpbnQyNTYgcmVmZXJyYWxCb251cyAgPSBwcmljZS5tdWwoZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0uYnV5b3V0UmVmZXJyYWxCb251c1BlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgICAgIHVpbnQyNTYgcHJpemVQb29sRnVuZHMgPSBwcmljZS5tdWwoZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0uYnV5b3V0UHJpemVQb29sUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFuZCBhc3NpZ24gYnV5b3V0IHByb2NlZWRzLgogICAgICAgIHVpbnQyNTYgY3VycmVudE93bmVyV2lubmluZ3MgPSBwcmljZS5zdWIoZmVlKS5zdWIocmVmZXJyYWxCb251cy5tdWwoMikpLnN1Yihwcml6ZVBvb2xGdW5kcyk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiB0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnk7CiAgICAgICAgaWYgKGNsYWltZWRTdXJyb3VuZGluZ1RpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIHN1cnJvdW5kaW5nIHRpbGVzLCB2YXJpYWJsZSBkaXZpZGVuZCBpcyB0byBiZSBwYWlkCiAgICAgICAgICAgIC8vIGJhc2VkIG9uIHRoZSBidXlvdXQgcHJpY2UuCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGl2aWRlbmQgcGVyIHN1cnJvdW5kaW5nIHRpbGUuCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSA9IHZhcmlhYmxlRGl2aWRlbmRzIC8gY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMubGVuZ3RoOwogICAgICAgICAgICAKICAgICAgICAgICAgY3VycmVudE93bmVyV2lubmluZ3MgPSBjdXJyZW50T3duZXJXaW5uaW5ncy5zdWIodmFyaWFibGVEaXZpZGVuZHMpOwogICAgICAgICAgICAvLyBjdXJyZW50T3duZXJXaW5uaW5ncyA9IGN1cnJlbnRPd25lcldpbm5pbmdzLnN1Yih0b3RhbERpdmlkZW5kUGVyQmVuZWZpY2lhcnkgKiBjbGFpbWVkU3Vycm91bmRpbmdUaWxlcy5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBfYXNzaWduQnV5b3V0UHJvY2VlZHMoCiAgICAgICAgICAgIGN1cnJlbnRPd25lciwKICAgICAgICAgICAgY2xhaW1lZFN1cnJvdW5kaW5nVGlsZXMsCiAgICAgICAgICAgIGZlZSwKICAgICAgICAgICAgY3VycmVudE93bmVyV2lubmluZ3MsCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRQZXJCZW5lZmljaWFyeSwKICAgICAgICAgICAgcmVmZXJyYWxCb251cywKICAgICAgICAgICAgcHJpemVQb29sRnVuZHMKICAgICAgICApOwogICAgfQogICAgCiAgICAvLy8gQGRldiBTZW5kIGZ1bmRzIHRvIGEgYmVuZWZpY2lhcnkuIElmIHNlbmRpbmcgZmFpbHMsIGFzc2lnbgogICAgLy8vIGZ1bmRzIHRvIHRoZSBiZW5lZmljaWFyeSdzIGJhbGFuY2UgZm9yIG1hbnVhbCB3aXRoZHJhd2FsLgogICAgLy8vIEBwYXJhbSBiZW5lZmljaWFyeSBUaGUgYmVuZWZpY2lhcnkncyBhZGRyZXNzIHRvIHNlbmQgZnVuZHMgdG8KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gc2VuZC4KICAgIGZ1bmN0aW9uIF9zZW5kRnVuZHMoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBpZiAoIWJlbmVmaWNpYXJ5LnNlbmQoYW1vdW50KSkgewogICAgICAgICAgICAvLyBGYWlsZWQgdG8gc2VuZCBmdW5kcy4gVGhpcyBjYW4gaGFwcGVuIGR1ZSB0byBhIGZhaWx1cmUgaW4KICAgICAgICAgICAgLy8gZmFsbGJhY2sgY29kZSBvZiB0aGUgYmVuZWZpY2lhcnksIG9yIGJlY2F1c2Ugb2YgY2FsbHN0YWNrCiAgICAgICAgICAgIC8vIGRlcHRoLgogICAgICAgICAgICAvLyBTZW5kIGZ1bmRzIGFzeW5jaHJvbm91c2x5IGZvciBtYW51YWwgd2l0aGRyYXdhbCBieSB0aGUKICAgICAgICAgICAgLy8gYmVuZWZpY2lhcnkuCiAgICAgICAgICAgIGFzeW5jU2VuZChiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgICAgICB9CiAgICB9Cn0KCgovLy8gQGRldiBIb2xkcyBjb3JlIGdhbWUgZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgQnVybnVwR2FtZUNvcmUgaXMgQnVybnVwR2FtZUZpbmFuY2UgewogICAgCiAgICBmdW5jdGlvbiBCdXJudXBHYW1lQ29yZShhZGRyZXNzIGJ1cm51cEhvbGRpbmdBZGRyZXNzKSBwdWJsaWMgQnVybnVwR2FtZUZpbmFuY2UoYnVybnVwSG9sZGluZ0FkZHJlc3MpIHt9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSB0aGUgY3VycmVudCBvd25lciBvdXQgb2YgdGhlIHRpbGUuCiAgICAvLy8gQHBhcmFtIF9nYW1lSW5kZXggVGhlIGluZGV4IG9mIHRoZSBnYW1lIHRvIHBsYXkgb24uCiAgICAvLy8gQHBhcmFtIHN0YXJ0TmV3R2FtZUlmSWRsZSBTdGFydCBhIG5ldyBnYW1lIGlmIHRoZSBjdXJyZW50IGdhbWUgaXMgaWRsZS4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1jb29yZGluYXRlIG9mIHRoZSB0aWxlIHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0geSBUaGUgeS1jb29yZGluYXRlIG9mIHRoZSB0aWxlIHRvIGJ1eS4KICAgIGZ1bmN0aW9uIGJ1eW91dCh1aW50MjU2IF9nYW1lSW5kZXgsIGJvb2wgc3RhcnROZXdHYW1lSWZJZGxlLCB1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVibGljIHBheWFibGUgewogICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGUgZ2FtZSBzaG91bGQgZW5kLiBQcm9jZXNzIHBheW1lbnQuCiAgICAgICAgX3Byb2Nlc3NHYW1lRW5kKCk7CiAgICAgICAgCiAgICAgICAgaWYgKCFnYW1lU3RhdGVzW2dhbWVJbmRleF0uZ2FtZVN0YXJ0ZWQpIHsKICAgICAgICAgICAgLy8gSWYgdGhlIGdhbWUgaXMgbm90IHN0YXJ0ZWQsIHRoZSBjb250cmFjdCBtdXN0IG5vdCBiZSBwYXVzZWQuCiAgICAgICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiB0aGUgZ2FtZSBpcyBub3Qgc3RhcnRlZCwgdGhlIHBsYXllciBtdXN0IGJlIHdpbGxpbmcgdG8gc3RhcnQKICAgICAgICAgICAgLy8gYSBuZXcgZ2FtZS4KICAgICAgICAgICAgcmVxdWlyZShzdGFydE5ld0dhbWVJZklkbGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHRoZSBwcmljZSBhbmQgdGltZW91dC4KICAgICAgICAgICAgZ2FtZVNldHRpbmdzW2dhbWVJbmRleF0gPSBuZXh0R2FtZVNldHRpbmdzOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhcnQgdGhlIGdhbWUuCiAgICAgICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5nYW1lU3RhcnRlZCA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgZ2FtZSBzdGFydGVkIHRpbWVzdGFtcC4KICAgICAgICAgICAgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmdhbWVTdGFydFRpbWVzdGFtcCA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEVtaXQgc3RhcnQgZXZlbnQuCiAgICAgICAgICAgIFN0YXJ0KGdhbWVJbmRleCwgbXNnLnNlbmRlciwgYmxvY2sudGltZXN0YW1wLCBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sLCBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5yb3dzLCBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5jb2xzLCBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5hY3Rpdml0eVRpbWVyLCBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS51bmNsYWltZWRUaWxlUHJpY2UsIGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmJ1eW91dFJlZmVycmFsQm9udXNQZXJjZW50YWdlLCBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5idXlvdXRQcml6ZVBvb2xQZXJjZW50YWdlLCBnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5idXlvdXREaXZpZGVuZFBlcmNlbnRhZ2UsIGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmJ1eW91dEZlZVBlcmNlbnRhZ2UpOwogICAgICAgIH0KICAgIAogICAgICAgIC8vIENoZWNrIHRoZSBnYW1lIGluZGV4LgogICAgICAgIGlmIChzdGFydE5ld0dhbWVJZklkbGUpIHsKICAgICAgICAgICAgLy8gVGhlIGdpdmVuIGdhbWUgaW5kZXggbXVzdCBiZSB0aGUgY3VycmVudCBnYW1lIGluZGV4LCBvciB0aGUgcHJldmlvdXMKICAgICAgICAgICAgLy8gZ2FtZSBpbmRleC4KICAgICAgICAgICAgcmVxdWlyZShfZ2FtZUluZGV4ID09IGdhbWVJbmRleCB8fCBfZ2FtZUluZGV4LmFkZCgxKSA9PSBnYW1lSW5kZXgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE9ubHkgcGxheSBvbiB0aGUgZ2FtZSBpbmRpY2F0ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICAgICAgcmVxdWlyZShfZ2FtZUluZGV4ID09IGdhbWVJbmRleCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQyNTYgaWRlbnRpZmllciA9IGNvb3JkaW5hdGVUb0lkZW50aWZpZXIoeCwgeSk7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBjdXJyZW50T3duZXIgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl07CiAgICAgICAgCiAgICAgICAgLy8gVGlsZSBtdXN0IGJlIHVub3duZWQsIG9yIGFjdGl2ZS4KICAgICAgICBpZiAoY3VycmVudE93bmVyID09IGFkZHJlc3MoMHgwKSkgewogICAgICAgICAgICAvLyBUaWxlIG11c3Qgc3RpbGwgYmUgZmxpcHBhYmxlLgogICAgICAgICAgICByZXF1aXJlKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5nYW1lU3RhcnRUaW1lc3RhbXAuYWRkKGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmFjdGl2aXR5VGltZXIpID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVGlsZSBtdXN0IGJlIGFjdGl2ZS4KICAgICAgICAgICAgcmVxdWlyZShnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvQnV5b3V0VGltZXN0YW1wW2lkZW50aWZpZXJdLmFkZChnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5hY3Rpdml0eVRpbWVyKSA+PSBibG9jay50aW1lc3RhbXApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBHZXQgZXhpc3Rpbmcgc3Vycm91bmRpbmcgdGlsZXMuCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBjbGFpbWVkU3Vycm91bmRpbmdUaWxlcyA9IF9jbGFpbWVkU3Vycm91bmRpbmdUaWxlcyhpZGVudGlmaWVyKTsKICAgICAgICAKICAgICAgICAvLyBBc3NpZ24gdGhlIGJ1eW91dCBwcm9jZWVkcyBhbmQgcmV0cmlldmUgdGhlIHRvdGFsIGNvc3QuCiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jYWxjdWxhdGVBbmRBc3NpZ25CdXlvdXRQcm9jZWVkcyhjdXJyZW50T3duZXIsIGlkZW50aWZpZXIsIGNsYWltZWRTdXJyb3VuZGluZ1RpbGVzKTsKICAgICAgICAKICAgICAgICAvLyBFbm91Z2ggRXRoZXIgbXVzdCBiZSBzdXBwbGllZC4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBwcmljZSk7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHRpbGUuCiAgICAgICAgX3RyYW5zZmVyKGN1cnJlbnRPd25lciwgbXNnLnNlbmRlciwgaWRlbnRpZmllcik7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoaXMgdGlsZSB0byBiZSB0aGUgbW9zdCByZWNlbnRseSBib3VnaHQgb3V0LgogICAgICAgIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5sYXN0RmxpcHBlZFRpbGUgPSBpZGVudGlmaWVyOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSBhbmQgc2V0IHRoZSBuZXcgdGlsZSBwcmljZS4KICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvQnV5b3V0UHJpY2VbaWRlbnRpZmllcl0gPSBuZXh0QnV5b3V0UHJpY2UocHJpY2UpOwogICAgICAgIAogICAgICAgIC8vIFNldCB0aGUgYnV5b3V0IHRpbWVzdGFtcC4KICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvQnV5b3V0VGltZXN0YW1wW2lkZW50aWZpZXJdID0gYmxvY2sudGltZXN0YW1wOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQKICAgICAgICBCdXlvdXQoZ2FtZUluZGV4LCBtc2cuc2VuZGVyLCBpZGVudGlmaWVyLCB4LCB5LCBibG9jay50aW1lc3RhbXAsIGJsb2NrLnRpbWVzdGFtcCArIGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmFjdGl2aXR5VGltZXIsIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9CdXlvdXRQcmljZVtpZGVudGlmaWVyXSwgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBleGNlc3MgRXRoZXIgc2VudC4KICAgICAgICAvLyBtc2cudmFsdWUgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHByaWNlLAogICAgICAgIC8vIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGV4Y2VzcyA9IG1zZy52YWx1ZSAtIHByaWNlOwogICAgICAgIAogICAgICAgIGlmIChleGNlc3MgPiAwKSB7CiAgICAgICAgICAgIC8vIFJlZnVuZCBhbnkgZXhjZXNzIEV0aGVyIChub3Qgc3VzY2VwdGlibGUgdG8gcmUtZW50cnkgYXR0YWNrLCBhcwogICAgICAgICAgICAvLyB0aGUgb3duZXIgaXMgYXNzaWduZWQgYmVmb3JlIHRoZSB0cmFuc2ZlciB0YWtlcyBwbGFjZSkuCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXhjZXNzKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSB0aGUgY3VycmVudCBvd25lciBvdXQgb2YgdGhlIHRpbGUuIFNldCB0aGUgcGxheWVyJ3MgcmVmZXJyZXIuCiAgICAvLy8gQHBhcmFtIF9nYW1lSW5kZXggVGhlIGluZGV4IG9mIHRoZSBnYW1lIHRvIHBsYXkgb24uCiAgICAvLy8gQHBhcmFtIHN0YXJ0TmV3R2FtZUlmSWRsZSBTdGFydCBhIG5ldyBnYW1lIGlmIHRoZSBjdXJyZW50IGdhbWUgaXMgaWRsZS4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1jb29yZGluYXRlIG9mIHRoZSB0aWxlIHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0geSBUaGUgeS1jb29yZGluYXRlIG9mIHRoZSB0aWxlIHRvIGJ1eS4KICAgIGZ1bmN0aW9uIGJ1eW91dEFuZFNldFJlZmVycmVyKHVpbnQyNTYgX2dhbWVJbmRleCwgYm9vbCBzdGFydE5ld0dhbWVJZklkbGUsIHVpbnQyNTYgeCwgdWludDI1NiB5LCBhZGRyZXNzIHJlZmVycmVyQWRkcmVzcykgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgLy8gU2V0IHRoZSByZWZlcnJlci4KICAgICAgICBidXJudXBIb2xkaW5nLnNldFJlZmVycmVyKG1zZy5zZW5kZXIsIHJlZmVycmVyQWRkcmVzcyk7CiAgICAKICAgICAgICAvLyBQbGF5LgogICAgICAgIGJ1eW91dChfZ2FtZUluZGV4LCBzdGFydE5ld0dhbWVJZklkbGUsIHgsIHkpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTcGljZSB1cCB0aGUgcHJpemUgcG9vbC4KICAgIC8vLyBAcGFyYW0gX2dhbWVJbmRleCBUaGUgaW5kZXggb2YgdGhlIGdhbWUgdG8gYWRkIHNwaWNlIHRvLgogICAgLy8vIEBwYXJhbSBtZXNzYWdlIEFuIG9wdGlvbmFsIG1lc3NhZ2UgdG8gYmUgc2VudCBhbG9uZyB3aXRoIHRoZSBzcGljZS4KICAgIGZ1bmN0aW9uIHNwaWNlVXAodWludDI1NiBfZ2FtZUluZGV4LCBzdHJpbmcgbWVzc2FnZSkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBnYW1lIHNob3VsZCBlbmQuIFByb2Nlc3MgcGF5bWVudC4KICAgICAgICBfcHJvY2Vzc0dhbWVFbmQoKTsKICAgICAgICAKICAgICAgICAvLyBDaGVjayB0aGUgZ2FtZSBpbmRleC4KICAgICAgICByZXF1aXJlKF9nYW1lSW5kZXggPT0gZ2FtZUluZGV4KTsKICAgIAogICAgICAgIC8vIEdhbWUgbXVzdCBiZSBsaXZlIG9yIHVucGF1c2VkLgogICAgICAgIHJlcXVpcmUoZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmdhbWVTdGFydGVkIHx8ICFwYXVzZWQpOwogICAgICAgIAogICAgICAgIC8vIEZ1bmRzIG11c3QgYmUgc2VudC4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIAogICAgICAgIC8vIEFkZCBmdW5kcyB0byB0aGUgcHJpemUgcG9vbC4KICAgICAgICBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sID0gZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbC5hZGQobXNnLnZhbHVlKTsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGV2ZW50LgogICAgICAgIFNwaWNlVXBQcml6ZVBvb2woZ2FtZUluZGV4LCBtc2cuc2VuZGVyLCBtc2cudmFsdWUsIG1lc3NhZ2UsIGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wcml6ZVBvb2wpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBFbmQgdGhlIGdhbWUuIFBheSBwcml6ZS4KICAgIGZ1bmN0aW9uIGVuZEdhbWUoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfcHJvY2Vzc0dhbWVFbmQoKSk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEVuZCB0aGUgZ2FtZS4gUGF5IHByaXplLgogICAgZnVuY3Rpb24gX3Byb2Nlc3NHYW1lRW5kKCkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgYWRkcmVzcyBjdXJyZW50T3duZXIgPSBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvT3duZXJbZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmxhc3RGbGlwcGVkVGlsZV07CiAgICAKICAgICAgICAvLyBUaGUgZ2FtZSBtdXN0IGJlIHN0YXJ0ZWQuCiAgICAgICAgaWYgKCFnYW1lU3RhdGVzW2dhbWVJbmRleF0uZ2FtZVN0YXJ0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIAogICAgICAgIC8vIFRoZSBsYXN0IGZsaXBwZWQgdGlsZSBtdXN0IGJlIG93bmVkIChpLmUuIHRoZXJlIGhhcyBiZWVuIGF0CiAgICAgICAgLy8gbGVhc3Qgb25lIGZsaXApLgogICAgICAgIGlmIChjdXJyZW50T3duZXIgPT0gYWRkcmVzcygweDApKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGxhc3QgZmxpcHBlZCB0aWxlIG11c3QgaGF2ZSBiZWNvbWUgaW5hY3RpdmUuCiAgICAgICAgaWYgKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5pZGVudGlmaWVyVG9CdXlvdXRUaW1lc3RhbXBbZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLmxhc3RGbGlwcGVkVGlsZV0uYWRkKGdhbWVTZXR0aW5nc1tnYW1lSW5kZXhdLmFjdGl2aXR5VGltZXIpID49IGJsb2NrLnRpbWVzdGFtcCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEFzc2lnbiBwcml6ZSBwb29sIHRvIHRoZSBvd25lciBvZiB0aGUgbGFzdC1mbGlwcGVkIHRpbGUuCiAgICAgICAgaWYgKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5wcml6ZVBvb2wgPiAwKSB7CiAgICAgICAgICAgIF9zZW5kRnVuZHMoY3VycmVudE93bmVyLCBnYW1lU3RhdGVzW2dhbWVJbmRleF0ucHJpemVQb29sKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gR2V0IGNvb3JkaW5hdGVzIG9mIGxhc3QgZmxpcHBlZCB0aWxlLgogICAgICAgIHZhciAoeCwgeSkgPSBpZGVudGlmaWVyVG9Db29yZGluYXRlKGdhbWVTdGF0ZXNbZ2FtZUluZGV4XS5sYXN0RmxpcHBlZFRpbGUpOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgRW5kKGdhbWVJbmRleCwgY3VycmVudE93bmVyLCBnYW1lU3RhdGVzW2dhbWVJbmRleF0ubGFzdEZsaXBwZWRUaWxlLCB4LCB5LCBnYW1lU3RhdGVzW2dhbWVJbmRleF0uaWRlbnRpZmllclRvQnV5b3V0VGltZXN0YW1wW2dhbWVTdGF0ZXNbZ2FtZUluZGV4XS5sYXN0RmxpcHBlZFRpbGVdLmFkZChnYW1lU2V0dGluZ3NbZ2FtZUluZGV4XS5hY3Rpdml0eVRpbWVyKSwgZ2FtZVN0YXRlc1tnYW1lSW5kZXhdLnByaXplUG9vbCk7CiAgICAgICAgCiAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBnYW1lIGluZGV4LiBUaGlzIHdvbid0IG92ZXJmbG93IGJlZm9yZSB0aGUgaGVhdCBkZWF0aCBvZiB0aGUgdW5pdmVyc2UuCiAgICAgICAgZ2FtZUluZGV4Kys7CiAgICAgICAgCiAgICAgICAgLy8gSW5kaWNhdGUgZW5kaW5nIHRoZSBnYW1lIHdhcyBzdWNjZXNzZnVsLgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9'.
	

]
