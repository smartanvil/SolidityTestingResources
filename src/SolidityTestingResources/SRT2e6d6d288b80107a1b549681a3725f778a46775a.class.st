Class {
	#name : #SRT2e6d6d288b80107a1b549681a3725f778a46775a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2e6d6d288b80107a1b549681a3725f778a46775a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBEU01hdGggewogICAgZnVuY3Rpb24gYWRkKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoKHogPSB4ICsgeSkgPj0geCk7CiAgICB9CiAgICBmdW5jdGlvbiBzdWIodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KICAgIGZ1bmN0aW9uIG11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKHkgPT0gMCB8fCAoeiA9IHggKiB5KSAvIHkgPT0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIG1heCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CiAgICBmdW5jdGlvbiBpbWluKGludCB4LCBpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltYXgoaW50IHgsIGludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIHVpbnQgY29uc3RhbnQgV0FEID0gMTAgKiogMTg7CiAgICB1aW50IGNvbnN0YW50IFJBWSA9IDEwICoqIDI3OwoKICAgIGZ1bmN0aW9uIHdtdWwodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgeSksIFdBRCAvIDIpIC8gV0FEOwogICAgfQogICAgZnVuY3Rpb24gcm11bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCB5KSwgUkFZIC8gMikgLyBSQVk7CiAgICB9CiAgICBmdW5jdGlvbiB3ZGl2KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIFdBRCksIHkgLyAyKSAvIHk7CiAgICB9CiAgICBmdW5jdGlvbiByZGl2KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIFJBWSksIHkgLyAyKSAvIHk7CiAgICB9CgogICAgLy8gVGhpcyBmYW1vdXMgYWxnb3JpdGhtIGlzIGNhbGxlZCAiZXhwb25lbnRpYXRpb24gYnkgc3F1YXJpbmciCiAgICAvLyBhbmQgY2FsY3VsYXRlcyB4Xm4gd2l0aCB4IGFzIGZpeGVkLXBvaW50IGFuZCBuIGFzIHJlZ3VsYXIgdW5zaWduZWQuCiAgICAvLwogICAgLy8gSXQncyBPKGxvZyBuKSwgaW5zdGVhZCBvZiBPKG4pIGZvciBuYWl2ZSByZXBlYXRlZCBtdWx0aXBsaWNhdGlvbi4KICAgIC8vCiAgICAvLyBUaGVzZSBmYWN0cyBhcmUgd2h5IGl0IHdvcmtzOgogICAgLy8KICAgIC8vICBJZiBuIGlzIGV2ZW4sIHRoZW4geF5uID0gKHheMileKG4vMikuCiAgICAvLyAgSWYgbiBpcyBvZGQsICB0aGVuIHhebiA9IHggKiB4XihuLTEpLAogICAgLy8gICBhbmQgYXBwbHlpbmcgdGhlIGVxdWF0aW9uIGZvciBldmVuIHggZ2l2ZXMKICAgIC8vICAgIHhebiA9IHggKiAoeF4yKV4oKG4tMSkgLyAyKS4KICAgIC8vCiAgICAvLyAgQWxzbywgRVZNIGRpdmlzaW9uIGlzIGZsb29yaW5nIGFuZAogICAgLy8gICAgZmxvb3JbKG4tMSkgLyAyXSA9IGZsb29yW24gLyAyXS4KICAgIC8vCiAgICBmdW5jdGlvbiBycG93KHVpbnQgeCwgdWludCBuKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBuICUgMiAhPSAwID8geCA6IFJBWTsKCiAgICAgICAgZm9yIChuIC89IDI7IG4gIT0gMDsgbiAvPSAyKSB7CiAgICAgICAgICAgIHggPSBybXVsKHgsIHgpOwoKICAgICAgICAgICAgaWYgKG4gJSAyICE9IDApIHsKICAgICAgICAgICAgICAgIHogPSBybXVsKHosIHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBXRVRIOV8gewogICAgc3RyaW5nIHB1YmxpYyBuYW1lICAgICA9ICJXcmFwcGVkIEV0aGVyIjsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sICAgPSAiV0VUSCI7CiAgICB1aW50OCAgcHVibGljIGRlY2ltYWxzID0gMTg7CgogICAgZXZlbnQgIEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBzcmMsIGFkZHJlc3MgaW5kZXhlZCBndXksIHVpbnQgd2FkKTsKICAgIGV2ZW50ICBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZHN0LCB1aW50IHdhZCk7CiAgICBldmVudCAgRGVwb3NpdChhZGRyZXNzIGluZGV4ZWQgZHN0LCB1aW50IHdhZCk7CiAgICBldmVudCAgV2l0aGRyYXdhbChhZGRyZXNzIGluZGV4ZWQgc3JjLCB1aW50IHdhZCk7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSAgICAgICAgICAgICAgICAgICAgICAgcHVibGljICBiYWxhbmNlT2Y7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpICBwdWJsaWMgIGFsbG93YW5jZTsKCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBkZXBvc2l0KCk7CiAgICB9CiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcHVibGljIHBheWFibGUgewogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSArPSBtc2cudmFsdWU7CiAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCB3YWQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPj0gd2FkKTsKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gLT0gd2FkOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIod2FkKTsKICAgICAgICBXaXRoZHJhd2FsKG1zZy5zZW5kZXIsIHdhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgZ3V5LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bZ3V5XSA9IHdhZDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBndXksIHdhZCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cmFuc2ZlckZyb20obXNnLnNlbmRlciwgZHN0LCB3YWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIHNyYywgYWRkcmVzcyBkc3QsIHVpbnQgd2FkKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlT2Zbc3JjXSA+PSB3YWQpOwoKICAgICAgICBpZiAoc3JjICE9IG1zZy5zZW5kZXIgJiYgYWxsb3dhbmNlW3NyY11bbXNnLnNlbmRlcl0gIT0gdWludCgtMSkpIHsKICAgICAgICAgICAgcmVxdWlyZShhbGxvd2FuY2Vbc3JjXVttc2cuc2VuZGVyXSA+PSB3YWQpOwogICAgICAgICAgICBhbGxvd2FuY2Vbc3JjXVttc2cuc2VuZGVyXSAtPSB3YWQ7CiAgICAgICAgfQoKICAgICAgICBiYWxhbmNlT2Zbc3JjXSAtPSB3YWQ7CiAgICAgICAgYmFsYW5jZU9mW2RzdF0gKz0gd2FkOwoKICAgICAgICBUcmFuc2ZlcihzcmMsIGRzdCwgd2FkKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmludGVyZmFjZSBGdW5kSW50ZXJmYWNlIHsKCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBQb3J0Zm9saW9Db250ZW50KHVpbnQgaG9sZGluZ3MsIHVpbnQgcHJpY2UsIHVpbnQgZGVjaW1hbHMpOwogICAgZXZlbnQgUmVxdWVzdFVwZGF0ZWQodWludCBpZCk7CiAgICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGluZGV4ZWQgb2ZQYXJ0aWNpcGFudCwgdWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5KTsKICAgIGV2ZW50IFJlZGVlbWVkKGFkZHJlc3MgaW5kZXhlZCBvZlBhcnRpY2lwYW50LCB1aW50IGF0VGltZXN0YW1wLCB1aW50IHNoYXJlUXVhbnRpdHkpOwogICAgZXZlbnQgU3BlbmRpbmdBcHByb3ZlZChhZGRyZXNzIG9uQ29uc2lnbmVkLCBhZGRyZXNzIG9mQXNzZXQsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IEZlZXNDb252ZXJ0ZWQodWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5Q29udmVydGVkLCB1aW50IHVuY2xhaW1lZCk7CiAgICBldmVudCBDYWxjdWxhdGlvblVwZGF0ZSh1aW50IGF0VGltZXN0YW1wLCB1aW50IG1hbmFnZW1lbnRGZWUsIHVpbnQgcGVyZm9ybWFuY2VGZWUsIHVpbnQgbmF2LCB1aW50IHNoYXJlUHJpY2UsIHVpbnQgdG90YWxTdXBwbHkpOwogICAgZXZlbnQgT3JkZXJVcGRhdGVkKHVpbnQgaWQpOwogICAgZXZlbnQgTG9nRXJyb3IodWludCBFUlJPUl9DT0RFKTsKICAgIGV2ZW50IEVycm9yTWVzc2FnZShzdHJpbmcgZXJyb3JNZXNzYWdlKTsKCiAgICAvLyBFWFRFUk5BTCBNRVRIT0RTCiAgICAvLyBDb21wbGlhbmNlIGJ5IEludmVzdG9yCiAgICBmdW5jdGlvbiByZXF1ZXN0SW52ZXN0bWVudCh1aW50IGdpdmVRdWFudGl0eSwgdWludCBzaGFyZVF1YW50aXR5LCBib29sIGlzTmF0aXZlQXNzZXQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmVxdWVzdFJlZGVtcHRpb24odWludCBzaGFyZVF1YW50aXR5LCB1aW50IHJlY2VpdmVRdWFudGl0eSwgYm9vbCBpc05hdGl2ZUFzc2V0KSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGV4ZWN1dGVSZXF1ZXN0KHVpbnQgcmVxdWVzdElkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGNhbmNlbFJlcXVlc3QodWludCByZXF1ZXN0SWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmVkZWVtQWxsT3duZWRBc3NldHModWludCBzaGFyZVF1YW50aXR5KSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIC8vIEFkbWluaXN0cmF0aW9uIGJ5IE1hbmFnZXIKICAgIGZ1bmN0aW9uIGVuYWJsZUludmVzdG1lbnQoKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGRpc2FibGVJbnZlc3RtZW50KCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBlbmFibGVSZWRlbXB0aW9uKCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBkaXNhYmxlUmVkZW1wdGlvbigpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2h1dERvd24oKSBleHRlcm5hbDsKICAgIC8vIE1hbmFnaW5nIGJ5IE1hbmFnZXIKICAgIGZ1bmN0aW9uIG1ha2VPcmRlcih1aW50IGV4Y2hhbmdlSWQsIGFkZHJlc3Mgc2VsbEFzc2V0LCBhZGRyZXNzIGJ1eUFzc2V0LCB1aW50IHNlbGxRdWFudGl0eSwgdWludCBidXlRdWFudGl0eSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0YWtlT3JkZXIodWludCBleGNoYW5nZUlkLCB1aW50IGlkLCB1aW50IHF1YW50aXR5KSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGNhbmNlbE9yZGVyKHVpbnQgZXhjaGFuZ2VJZCwgdWludCBpZCkgZXh0ZXJuYWw7CgogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIGVtZXJnZW5jeVJlZGVlbSh1aW50IHNoYXJlUXVhbnRpdHksIGFkZHJlc3NbXSByZXF1ZXN0ZWRBc3NldHMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgLy8gRmVlcyBieSBNYW5hZ2VyCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVVuY2xhaW1lZEZlZXMoKTsKCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCiAgICAvLyBHZXQgZ2VuZXJhbCBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0TW9kdWxlcygpIHZpZXcgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRMYXN0T3JkZXJJZCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRMYXN0UmVxdWVzdElkKCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldE5hbWVIYXNoKCkgdmlldyByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGdldE1hbmFnZXIoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICAgIC8vIEdldCBhY2NvdW50aW5nIGluZm9ybWF0aW9uCiAgICBmdW5jdGlvbiBwZXJmb3JtQ2FsY3VsYXRpb25zKCkgdmlldyByZXR1cm5zICh1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50KTsKICAgIGZ1bmN0aW9uIGNhbGNTaGFyZVByaWNlKCkgdmlldyByZXR1cm5zICh1aW50KTsKfQoKaW50ZXJmYWNlIEFzc2V0SW50ZXJmYWNlIHsKICAgIC8qCiAgICAgKiBJbXBsZW1lbnRzIEVSQyAyMCBzdGFuZGFyZC4KICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvZjkwODY0YTNkMmIyYjQ1YzRkZWNmOTVlZmQyNmIzZjBjMjc2MDUxYS9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAgICAgKgogICAgICogIEFkZGVkIHN1cHBvcnQgZm9yIHRoZSBFUkMgMjIzICJ0b2tlbkZhbGxiYWNrIiBtZXRob2QgaW4gYSAidHJhbnNmZXIiIGZ1bmN0aW9uIHdpdGggYSBwYXlsb2FkLgogICAgICogIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMjMKICAgICAqLwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKCiAgICAvLyBUaGVyZSBpcyBubyBFUkMyMjMgY29tcGF0aWJsZSBUcmFuc2ZlciBldmVudCwgd2l0aCBgX2RhdGFgIGluY2x1ZGVkLgoKICAgIC8vRVJDIDIyMwogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vIEVSQyAyMAogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7Cn0KCmludGVyZmFjZSBFUkMyMjNJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKTsKfQoKY29udHJhY3QgQXNzZXQgaXMgRFNNYXRoLCBBc3NldEludGVyZmFjZSwgRVJDMjIzSW50ZXJmYWNlIHsKCiAgICAvLyBEQVRBIFNUUlVDVFVSRVMKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICAvKioKICAgICAqIEBub3RpY2UgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgICAqIEBkZXYgVHJhbnNmZXJzIHNlbmRlcidzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MKICAgICAqIEBkZXYgU2ltaWxhciB0byB0cmFuc2ZlcihhZGRyZXNzLCB1aW50LCBieXRlcyksIGJ1dCB3aXRob3V0IF9kYXRhIHBhcmFtZXRlcgogICAgICogQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGVtcHR5OwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5LgogICAgICAgICAgICBjb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKF90bykKICAgICAgICB9CiAKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7IC8vIHNhbml0eSBjaGVja3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAvLyBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAvLyAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgIC8vICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIC8vIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYCBhbmQgdHJpZ2dlciB0b2tlbkZhbGxiYWNrIGlmIHNlbmRlciBpcyBhIGNvbnRyYWN0CiAgICAgKiBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgICAqIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHBhcmFtIF9kYXRhIERhdGEgdG8gYmUgc2VudCB0byB0b2tlbkZhbGxiYWNrCiAgICAgKiBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7IC8vIHNhbml0eSBjaGVja3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAvLyBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAvLyAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgIC8vICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIC8vIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF92YWx1ZWAgdG9rZW5zIGZyb20gYF9mcm9tYCB0byBgX3RvYCBpZiBgbXNnLnNlbmRlcmAgaXMgYWxsb3dlZC4KICAgIC8vLyBAbm90aWNlIFJlc3RyaWN0aW9uOiBBbiBhY2NvdW50IGNhbiBvbmx5IHVzZSB0aGlzIGZ1bmN0aW9uIHRvIHNlbmQgdG8gaXRzZWxmCiAgICAvLy8gQGRldiBBbGxvd3MgZm9yIGFuIGFwcHJvdmVkIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZQogICAgLy8vIGFkZHJlc3MgdG8gYW5vdGhlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGFyZSB3aXRoZHJhd24uCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9mcm9tICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgIHJlcXVpcmUoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CiAgICAgICAgLy8gcmVxdWlyZShfdG8gPT0gbXNnLnNlbmRlcik7IC8vIGNhbiBvbmx5IHVzZSB0cmFuc2ZlckZyb20gdG8gc2VuZCB0byBzZWxmCgogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwoKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBgX3NwZW5kZXJgIHRvIHRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBtc2cuc2VuZGVyYCB0byBhbnkgYWRkcmVzcy4KICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSAweDApOwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgICAgIC8vIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgLy8gcmVxdWlyZShfdmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGFsbG93ZWQgdG9rZW5zIHRoYXQgYSBzcGVuZGVyIGNhbiB0cmFuc2ZlciBvbgogICAgLy8vIGJlaGFsZiBvZiBhIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiB0b2tlbiBzcGVuZGVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyByZW1haW5pbmcgYWxsb3dhbmNlIGZvciBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgdGhlIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBiYWxhbmNlIG9mIG93bmVyLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQp9CgppbnRlcmZhY2UgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewoKICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRyYW5zYWN0aW9uIGluaXRpYXRvciwgYW5hbG9ndWUgb2YgbXNnLnNlbmRlcgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX2RhdGEgRGF0YSBjb250YWluaW5nIGEgZnVuY3Rpb24gc2lnbmF0dXJlIGFuZC9vciBwYXJhbWV0ZXJzCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljOwp9CgppbnRlcmZhY2UgTmF0aXZlQXNzZXRJbnRlcmZhY2UgewoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcHVibGljIHBheWFibGU7CiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IHdhZCkgcHVibGljOwp9CgppbnRlcmZhY2UgU2hhcmVzSW50ZXJmYWNlIHsKCiAgICBldmVudCBDcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCBvZlBhcnRpY2lwYW50LCB1aW50IGF0VGltZXN0YW1wLCB1aW50IHNoYXJlUXVhbnRpdHkpOwogICAgZXZlbnQgQW5uaWhpbGF0ZWQoYWRkcmVzcyBpbmRleGVkIG9mUGFydGljaXBhbnQsIHVpbnQgYXRUaW1lc3RhbXAsIHVpbnQgc2hhcmVRdWFudGl0eSk7CgogICAgLy8gVklFVyBNRVRIT0RTCgogICAgZnVuY3Rpb24gZ2V0TmFtZSgpIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGdldFN5bWJvbCgpIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldENyZWF0aW9uVGltZSgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiB0b1NtYWxsZXN0U2hhcmVVbml0KHVpbnQgcXVhbnRpdHkpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiB0b1dob2xlU2hhcmVVbml0KHVpbnQgcXVhbnRpdHkpIHZpZXcgcmV0dXJucyAodWludCk7Cgp9Cgpjb250cmFjdCBTaGFyZXMgaXMgQXNzZXQsIFNoYXJlc0ludGVyZmFjZSB7CgogICAgLy8gRklFTERTCgogICAgLy8gQ29uc3RydWN0b3IgZmllbGRzCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQgcHVibGljIGRlY2ltYWw7CiAgICB1aW50IHB1YmxpYyBjcmVhdGlvblRpbWU7CgogICAgLy8gTUVUSE9EUwoKICAgIC8vIENPTlNUUlVDVE9SCgogICAgLy8vIEBwYXJhbSBfbmFtZSBOYW1lIHRoZXNlIHNoYXJlcwogICAgLy8vIEBwYXJhbSBfc3ltYm9sIFN5bWJvbCBvZiBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX2RlY2ltYWwgQW1vdW50IG9mIGRlY2ltYWxzIHNoYXJlUHJpY2UgaXMgZGVub21pbmF0ZWQgaW4sIGRlZmluZWQgdG8gYmUgZXF1YWwgYXMgZGVjaWFtbHMgaW4gUkVGRVJFTkNFX0FTU0VUIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9jcmVhdGlvblRpbWUgVGltZXN0YW1wIG9mIHNoYXJlIGNyZWF0aW9uCiAgICBmdW5jdGlvbiBTaGFyZXMoc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludCBfZGVjaW1hbCwgdWludCBfY3JlYXRpb25UaW1lKSB7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgZGVjaW1hbCA9IF9kZWNpbWFsOwogICAgICAgIGNyZWF0aW9uVGltZSA9IF9jcmVhdGlvblRpbWU7CiAgICB9CgogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBnZXROYW1lKCkgdmlldyByZXR1cm5zIChzdHJpbmcpIHsgcmV0dXJuIG5hbWU7IH0KICAgIGZ1bmN0aW9uIGdldFN5bWJvbCgpIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7IHJldHVybiBzeW1ib2w7IH0KICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKCkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBkZWNpbWFsOyB9CiAgICBmdW5jdGlvbiBnZXRDcmVhdGlvblRpbWUoKSB2aWV3IHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGNyZWF0aW9uVGltZTsgfQogICAgZnVuY3Rpb24gdG9TbWFsbGVzdFNoYXJlVW5pdCh1aW50IHF1YW50aXR5KSB2aWV3IHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIG11bChxdWFudGl0eSwgMTAgKiogZ2V0RGVjaW1hbHMoKSk7IH0KICAgIGZ1bmN0aW9uIHRvV2hvbGVTaGFyZVVuaXQodWludCBxdWFudGl0eSkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBxdWFudGl0eSAvICgxMCAqKiBnZXREZWNpbWFscygpKTsgfQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgeyByZXF1aXJlKF90byA9PSBhZGRyZXNzKHRoaXMpKTsgfQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsgcmVxdWlyZShfdG8gPT0gYWRkcmVzcyh0aGlzKSk7IH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7IHJlcXVpcmUoX3RvID09IGFkZHJlc3ModGhpcykpOyB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIC8vLyBAcGFyYW0gcmVjaXBpZW50IEFkZHJlc3MgdGhlIG5ldyBzaGFyZXMgc2hvdWxkIGJlIHNlbnQgdG8KICAgIC8vLyBAcGFyYW0gc2hhcmVRdWFudGl0eSBOdW1iZXIgb2Ygc2hhcmVzIHRvIGJlIGNyZWF0ZWQKICAgIGZ1bmN0aW9uIGNyZWF0ZVNoYXJlcyhhZGRyZXNzIHJlY2lwaWVudCwgdWludCBzaGFyZVF1YW50aXR5KSBpbnRlcm5hbCB7CiAgICAgICAgdG90YWxTdXBwbHkgPSBhZGQodG90YWxTdXBwbHksIHNoYXJlUXVhbnRpdHkpOwogICAgICAgIGJhbGFuY2VzW3JlY2lwaWVudF0gPSBhZGQoYmFsYW5jZXNbcmVjaXBpZW50XSwgc2hhcmVRdWFudGl0eSk7CiAgICAgICAgQ3JlYXRlZChtc2cuc2VuZGVyLCBub3csIHNoYXJlUXVhbnRpdHkpOwogICAgfQoKICAgIC8vLyBAcGFyYW0gcmVjaXBpZW50IEFkZHJlc3MgdGhlIG5ldyBzaGFyZXMgc2hvdWxkIGJlIHRha2VuIGZyb20gd2hlbiBkZXN0cm95ZWQKICAgIC8vLyBAcGFyYW0gc2hhcmVRdWFudGl0eSBOdW1iZXIgb2Ygc2hhcmVzIHRvIGJlIGFubmloaWxhdGVkCiAgICBmdW5jdGlvbiBhbm5paGlsYXRlU2hhcmVzKGFkZHJlc3MgcmVjaXBpZW50LCB1aW50IHNoYXJlUXVhbnRpdHkpIGludGVybmFsIHsKICAgICAgICB0b3RhbFN1cHBseSA9IHN1Yih0b3RhbFN1cHBseSwgc2hhcmVRdWFudGl0eSk7CiAgICAgICAgYmFsYW5jZXNbcmVjaXBpZW50XSA9IHN1YihiYWxhbmNlc1tyZWNpcGllbnRdLCBzaGFyZVF1YW50aXR5KTsKICAgICAgICBBbm5paGlsYXRlZChtc2cuc2VuZGVyLCBub3csIHNoYXJlUXVhbnRpdHkpOwogICAgfQp9Cgpjb250cmFjdCBSZXN0cmljdGVkU2hhcmVzIGlzIFNoYXJlcyB7CgogICAgLy8gQ09OU1RSVUNUT1IKCiAgICAvLy8gQHBhcmFtIF9uYW1lIE5hbWUgdGhlc2Ugc2hhcmVzCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgU3ltYm9sIG9mIHNoYXJlcwogICAgLy8vIEBwYXJhbSBfZGVjaW1hbCBBbW91bnQgb2YgZGVjaW1hbHMgc2hhcmVQcmljZSBpcyBkZW5vbWluYXRlZCBpbiwgZGVmaW5lZCB0byBiZSBlcXVhbCBhcyBkZWNpYW1scyBpbiBSRUZFUkVOQ0VfQVNTRVQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2NyZWF0aW9uVGltZSBUaW1lc3RhbXAgb2Ygc2hhcmUgY3JlYXRpb24KICAgIGZ1bmN0aW9uIFJlc3RyaWN0ZWRTaGFyZXMoCiAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgIHN0cmluZyBfc3ltYm9sLAogICAgICAgIHVpbnQgX2RlY2ltYWwsCiAgICAgICAgdWludCBfY3JlYXRpb25UaW1lCiAgICApIFNoYXJlcyhfbmFtZSwgX3N5bWJvbCwgX2RlY2ltYWwsIF9jcmVhdGlvblRpbWUpIHt9CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICAvKioKICAgICAqIEBub3RpY2UgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgICAqIEBkZXYgVHJhbnNmZXJzIHNlbmRlcidzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MKICAgICAqIEBkZXYgU2ltaWxhciB0byB0cmFuc2ZlcihhZGRyZXNzLCB1aW50LCBieXRlcyksIGJ1dCB3aXRob3V0IF9kYXRhIHBhcmFtZXRlcgogICAgICogQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSB8fCBfdG8gPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgdWludCBjb2RlTGVuZ3RoOwogICAgICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7IC8vIHNhbml0eSBjaGVja3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPj0gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBpZiAoY29kZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgcmVjZWl2ZXIgPSBFUkMyMjNSZWNlaXZpbmdDb250cmFjdChfdG8pOwogICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIH0KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYCBhbmQgdHJpZ2dlciB0b2tlbkZhbGxiYWNrIGlmIHNlbmRlciBpcyBhIGNvbnRyYWN0CiAgICAgKiBAZGV2IEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIKICAgICAqIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHBhcmFtIF9kYXRhIERhdGEgdG8gYmUgc2VudCB0byB0b2tlbkZhbGxiYWNrCiAgICAgKiBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpIHx8IF90byA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkuCiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOyAvLyBzYW5pdHkgY2hlY2tzCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IGJhbGFuY2VzW190b10pOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgaWYgKGNvZGVMZW5ndGggPiAwKSB7CiAgICAgICAgICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgICAgICAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICB9CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyBgX3NwZW5kZXJgIHRvIHRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBtc2cuc2VuZGVyYCB0byBhbnkgYWRkcmVzcy4KICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoX3NwZW5kZXIgIT0gMHgwKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoX3ZhbHVlID09IDAgfHwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCk7CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKaW50ZXJmYWNlIENvbXBsaWFuY2VJbnRlcmZhY2UgewoKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICAvLy8gQG5vdGljZSBDaGVja3Mgd2hldGhlciBpbnZlc3RtZW50IGlzIHBlcm1pdHRlZCBmb3IgYSBwYXJ0aWNpcGFudAogICAgLy8vIEBwYXJhbSBvZlBhcnRpY2lwYW50IEFkZHJlc3MgcmVxdWVzdGluZyB0byBpbnZlc3QgaW4gYSBNZWxvbiBmdW5kCiAgICAvLy8gQHBhcmFtIGdpdmVRdWFudGl0eSBRdWFudGl0eSBvZiBNZWxvbiB0b2tlbiB0aW1lcyAxMCAqKiAxOCBvZmZlcmVkIHRvIHJlY2VpdmUgc2hhcmVRdWFudGl0eQogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IFF1YW50aXR5IG9mIHNoYXJlcyB0aW1lcyAxMCAqKiAxOCByZXF1ZXN0ZWQgdG8gYmUgcmVjZWl2ZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgaWRlbnRpdHkgaXMgZWxpZ2libGUgdG8gaW52ZXN0IGluIGEgTWVsb24gZnVuZC4KICAgIGZ1bmN0aW9uIGlzSW52ZXN0bWVudFBlcm1pdHRlZCgKICAgICAgICBhZGRyZXNzIG9mUGFydGljaXBhbnQsCiAgICAgICAgdWludDI1NiBnaXZlUXVhbnRpdHksCiAgICAgICAgdWludDI1NiBzaGFyZVF1YW50aXR5CiAgICApIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIHdoZXRoZXIgcmVkZW1wdGlvbiBpcyBwZXJtaXR0ZWQgZm9yIGEgcGFydGljaXBhbnQKICAgIC8vLyBAcGFyYW0gb2ZQYXJ0aWNpcGFudCBBZGRyZXNzIHJlcXVlc3RpbmcgdG8gcmVkZWVtIGZyb20gYSBNZWxvbiBmdW5kCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2hhcmVzIHRpbWVzIDEwICoqIDE4IG9mZmVyZWQgdG8gcmVkZWVtCiAgICAvLy8gQHBhcmFtIHJlY2VpdmVRdWFudGl0eSBRdWFudGl0eSBvZiBNZWxvbiB0b2tlbiB0aW1lcyAxMCAqKiAxOCByZXF1ZXN0ZWQgdG8gcmVjZWl2ZSBmb3Igc2hhcmVRdWFudGl0eQogICAgLy8vIEByZXR1cm4gV2hldGhlciBpZGVudGl0eSBpcyBlbGlnaWJsZSB0byByZWRlZW0gZnJvbSBhIE1lbG9uIGZ1bmQuCiAgICBmdW5jdGlvbiBpc1JlZGVtcHRpb25QZXJtaXR0ZWQoCiAgICAgICAgYWRkcmVzcyBvZlBhcnRpY2lwYW50LAogICAgICAgIHVpbnQyNTYgc2hhcmVRdWFudGl0eSwKICAgICAgICB1aW50MjU2IHJlY2VpdmVRdWFudGl0eQogICAgKSB2aWV3IHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBEQkMgewoKICAgIC8vIE1PRElGSUVSUwoKICAgIG1vZGlmaWVyIHByZV9jb25kKGJvb2wgY29uZGl0aW9uKSB7CiAgICAgICAgcmVxdWlyZShjb25kaXRpb24pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcG9zdF9jb25kKGJvb2wgY29uZGl0aW9uKSB7CiAgICAgICAgXzsKICAgICAgICBhc3NlcnQoY29uZGl0aW9uKTsKICAgIH0KCiAgICBtb2RpZmllciBpbnZhcmlhbnQoYm9vbCBjb25kaXRpb24pIHsKICAgICAgICByZXF1aXJlKGNvbmRpdGlvbik7CiAgICAgICAgXzsKICAgICAgICBhc3NlcnQoY29uZGl0aW9uKTsKICAgIH0KfQoKY29udHJhY3QgT3duZWQgaXMgREJDIHsKCiAgICAvLyBGSUVMRFMKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICAvLyBOT04tQ09OU1RBTlQgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgeyBvd25lciA9IG1zZy5zZW5kZXI7IH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIG9mTmV3T3duZXIpIHByZV9jb25kKGlzT3duZXIoKSkgeyBvd25lciA9IG9mTmV3T3duZXI7IH0KCiAgICAvLyBQUkUsIFBPU1QsIElOVkFSSUFOVCBDT05ESVRJT05TCgogICAgZnVuY3Rpb24gaXNPd25lcigpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsgcmV0dXJuIG1zZy5zZW5kZXIgPT0gb3duZXI7IH0KCn0KCmNvbnRyYWN0IEZ1bmQgaXMgRFNNYXRoLCBEQkMsIE93bmVkLCBSZXN0cmljdGVkU2hhcmVzLCBGdW5kSW50ZXJmYWNlLCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CiAgICAvLyBUWVBFUwoKICAgIHN0cnVjdCBNb2R1bGVzIHsgLy8gRGVzY3JpYmVzIGFsbCBtb2R1bGFyIHBhcnRzLCBzdGFuZGFyZGlzZWQgdGhyb3VnaCBhbiBpbnRlcmZhY2UKICAgICAgICBQcmljZUZlZWRJbnRlcmZhY2UgcHJpY2VmZWVkOyAvLyBQcm92aWRlcyBhbGwgZXh0ZXJuYWwgZGF0YQogICAgICAgIENvbXBsaWFuY2VJbnRlcmZhY2UgY29tcGxpYW5jZTsgLy8gQm9vbGVhbiBmdW5jdGlvbnMgcmVnYXJkaW5nIGludmVzdC9yZWRlZW0KICAgICAgICBSaXNrTWdtdEludGVyZmFjZSByaXNrbWdtdDsgLy8gQm9vbGVhbiBmdW5jdGlvbnMgcmVnYXJkaW5nIG1ha2UvdGFrZSBvcmRlcnMKICAgIH0KCiAgICBzdHJ1Y3QgQ2FsY3VsYXRpb25zIHsgLy8gTGlzdCBvZiBpbnRlcm5hbCBjYWxjdWxhdGlvbnMKICAgICAgICB1aW50IGdhdjsgLy8gR3Jvc3MgYXNzZXQgdmFsdWUKICAgICAgICB1aW50IG1hbmFnZW1lbnRGZWU7IC8vIFRpbWUgYmFzZWQgZmVlCiAgICAgICAgdWludCBwZXJmb3JtYW5jZUZlZTsgLy8gUGVyZm9ybWFuY2UgYmFzZWQgZmVlIG1lYXN1cmVkIGFnYWluc3QgUVVPVEVfQVNTRVQKICAgICAgICB1aW50IHVuY2xhaW1lZEZlZXM7IC8vIEZlZXMgbm90IHlldCBhbGxvY2F0ZWQgdG8gdGhlIGZ1bmQgbWFuYWdlcgogICAgICAgIHVpbnQgbmF2OyAvLyBOZXQgYXNzZXQgdmFsdWUKICAgICAgICB1aW50IGhpZ2hXYXRlck1hcms7IC8vIEEgcmVjb3JkIG9mIGJlc3QgYWxsLXRpbWUgZnVuZCBwZXJmb3JtYW5jZQogICAgICAgIHVpbnQgdG90YWxTdXBwbHk7IC8vIFRvdGFsIHN1cHBseSBvZiBzaGFyZXMKICAgICAgICB1aW50IHRpbWVzdGFtcDsgLy8gVGltZSB3aGVuIGNhbGN1bGF0aW9ucyBhcmUgcGVyZm9ybWVkIGluIHNlY29uZHMKICAgIH0KCiAgICBlbnVtIFJlcXVlc3RTdGF0dXMgeyBhY3RpdmUsIGNhbmNlbGxlZCwgZXhlY3V0ZWQgfQogICAgZW51bSBSZXF1ZXN0VHlwZSB7IGludmVzdCwgcmVkZWVtLCB0b2tlbkZhbGxiYWNrUmVkZWVtIH0KICAgIHN0cnVjdCBSZXF1ZXN0IHsgLy8gRGVzY3JpYmVzIGFuZCBsb2dzIHdoZW5ldmVyIGFzc2V0IGVudGVyIGFuZCBsZWF2ZSBmdW5kIGR1ZSB0byBQYXJ0aWNpcGFudHMKICAgICAgICBhZGRyZXNzIHBhcnRpY2lwYW50OyAvLyBQYXJ0aWNpcGFudCBpbiBNZWxvbiBmdW5kIHJlcXVlc3RpbmcgaW52ZXN0bWVudCBvciByZWRlbXB0aW9uCiAgICAgICAgUmVxdWVzdFN0YXR1cyBzdGF0dXM7IC8vIEVudW06IGFjdGl2ZSwgY2FuY2VsbGVkLCBleGVjdXRlZDsgU3RhdHVzIG9mIHJlcXVlc3QKICAgICAgICBSZXF1ZXN0VHlwZSByZXF1ZXN0VHlwZTsgLy8gRW51bTogaW52ZXN0LCByZWRlZW0sIHRva2VuRmFsbGJhY2tSZWRlZW0KICAgICAgICBhZGRyZXNzIHJlcXVlc3RBc3NldDsgLy8gQWRkcmVzcyBvZiB0aGUgYXNzZXQgYmVpbmcgcmVxdWVzdGVkCiAgICAgICAgdWludCBzaGFyZVF1YW50aXR5OyAvLyBRdWFudGl0eSBvZiBNZWxvbiBmdW5kIHNoYXJlcwogICAgICAgIHVpbnQgZ2l2ZVF1YW50aXR5OyAvLyBRdWFudGl0eSBpbiBNZWxvbiBhc3NldCB0byBnaXZlIHRvIE1lbG9uIGZ1bmQgdG8gcmVjZWl2ZSBzaGFyZVF1YW50aXR5CiAgICAgICAgdWludCByZWNlaXZlUXVhbnRpdHk7IC8vIFF1YW50aXR5IGluIE1lbG9uIGFzc2V0IHRvIHJlY2VpdmUgZnJvbSBNZWxvbiBmdW5kIGZvciBnaXZlbiBzaGFyZVF1YW50aXR5CiAgICAgICAgdWludCB0aW1lc3RhbXA7ICAgICAvLyBUaW1lIG9mIHJlcXVlc3QgY3JlYXRpb24gaW4gc2Vjb25kcwogICAgICAgIHVpbnQgYXRVcGRhdGVJZDsgICAgLy8gUHJpY2VmZWVkIHVwZGF0ZUlkIHdoZW4gdGhpcyByZXF1ZXN0IHdhcyBjcmVhdGVkCiAgICB9CgogICAgZW51bSBPcmRlclN0YXR1cyB7IGFjdGl2ZSwgcGFydGlhbGx5RmlsbGVkLCBmdWxseUZpbGxlZCwgY2FuY2VsbGVkIH0KICAgIGVudW0gT3JkZXJUeXBlIHsgbWFrZSwgdGFrZSB9CiAgICBzdHJ1Y3QgT3JkZXIgeyAvLyBEZXNjcmliZXMgYW5kIGxvZ3Mgd2hlbmV2ZXIgYXNzZXRzIGVudGVyIGFuZCBsZWF2ZSBmdW5kIGR1ZSB0byBNYW5hZ2VyCiAgICAgICAgdWludCBleGNoYW5nZUlkOyAvLyBJZCBhcyByZXR1cm5lZCBmcm9tIGV4Y2hhbmdlCiAgICAgICAgT3JkZXJTdGF0dXMgc3RhdHVzOyAvLyBFbnVtOiBhY3RpdmUsIHBhcnRpYWxseUZpbGxlZCwgZnVsbHlGaWxsZWQsIGNhbmNlbGxlZAogICAgICAgIE9yZGVyVHlwZSBvcmRlclR5cGU7IC8vIEVudW06IG1ha2UsIHRha2UKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldDsgLy8gQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBzb2xkCiAgICAgICAgYWRkcmVzcyBidXlBc3NldDsgLy8gQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBib3VnaHQKICAgICAgICB1aW50IHNlbGxRdWFudGl0eTsgLy8gUXVhbnRpdHkgb2Ygc2VsbEFzc2V0IHRvIGJlIHNvbGQKICAgICAgICB1aW50IGJ1eVF1YW50aXR5OyAvLyBRdWFudGl0eSBvZiBzZWxsQXNzZXQgdG8gYmUgYm91Z2h0CiAgICAgICAgdWludCB0aW1lc3RhbXA7IC8vIFRpbWUgb2Ygb3JkZXIgY3JlYXRpb24gaW4gc2Vjb25kcwogICAgICAgIHVpbnQgZmlsbFF1YW50aXR5OyAvLyBCdXkgcXVhbnRpdHkgZmlsbGVkOyBBbHdheXMgbGVzcyB0aGFuIGJ1eV9xdWFudGl0eQogICAgfQoKICAgIHN0cnVjdCBFeGNoYW5nZSB7CiAgICAgICAgYWRkcmVzcyBleGNoYW5nZTsgLy8gQWRkcmVzcyBvZiB0aGUgZXhjaGFuZ2UKICAgICAgICBFeGNoYW5nZUludGVyZmFjZSBleGNoYW5nZUFkYXB0ZXI7IC8vRXhjaGFuZ2UgYWRhcHRlciBjb250cmFjdHMgcmVzcGVjdGl2ZSB0byB0aGUgZXhjaGFuZ2UKICAgICAgICBib29sIGlzQXBwcm92ZU9ubHk7IC8vIFRydWUgaW4gY2FzZSBvZiBleGNoYW5nZSBpbXBsZW1lbnRhdGlvbiB3aGljaCByZXF1aXJlcyAgYXJlIGFwcHJvdmVkIHdoZW4gYW4gb3JkZXIgaXMgbWFkZSBpbnN0ZWFkIG9mIHRyYW5zZmVyCiAgICB9CgogICAgLy8gRklFTERTCgogICAgLy8gQ29uc3RhbnQgZmllbGRzCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfRlVORF9BU1NFVFMgPSA5MDsgLy8gTWF4IG93bmFibGUgYXNzZXRzIGJ5IHRoZSBmdW5kIHN1cHBvcnRlZCBieSBnYXMgbGltaXRzCiAgICAvLyBDb25zdHJ1Y3RvciBmaWVsZHMKICAgIHVpbnQgcHVibGljIE1BTkFHRU1FTlRfRkVFX1JBVEU7IC8vIEZlZSByYXRlIGluIFFVT1RFX0FTU0VUIHBlciBkZWx0YSBpbXByb3ZlbWVudCBpbiBXQUQKICAgIHVpbnQgcHVibGljIFBFUkZPUk1BTkNFX0ZFRV9SQVRFOyAvLyBGZWUgcmF0ZSBpbiBRVU9URV9BU1NFVCBwZXIgbWFuYWdlZCBzZWNvbmRzIGluIFdBRAogICAgYWRkcmVzcyBwdWJsaWMgVkVSU0lPTjsgLy8gQWRkcmVzcyBvZiBWZXJzaW9uIGNvbnRyYWN0CiAgICBBc3NldCBwdWJsaWMgUVVPVEVfQVNTRVQ7IC8vIFFVT1RFIGFzc2V0IGFzIEVSQzIwIGNvbnRyYWN0CiAgICBOYXRpdmVBc3NldEludGVyZmFjZSBwdWJsaWMgTkFUSVZFX0FTU0VUOyAvLyBOYXRpdmUgYXNzZXQgYXMgRVJDMjAgY29udHJhY3QKICAgIC8vIE1ldGhvZHMgZmllbGRzCiAgICBNb2R1bGVzIHB1YmxpYyBtb2R1bGU7IC8vIFN0cnVjdCB3aGljaCBob2xkcyBhbGwgdGhlIGluaXRpYWxpc2VkIG1vZHVsZSBpbnN0YW5jZXMKICAgIEV4Y2hhbmdlW10gcHVibGljIGV4Y2hhbmdlczsgLy8gQXJyYXkgY29udGFpbmluZyBleGNoYW5nZXMgdGhpcyBmdW5kIHN1cHBvcnRzCiAgICBDYWxjdWxhdGlvbnMgcHVibGljIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb247IC8vIENhbGN1bGF0aW9uIHJlc3VsdHMgYXQgbGFzdCBhbGxvY2F0ZVVuY2xhaW1lZEZlZXMoKSBjYWxsCiAgICBib29sIHB1YmxpYyBpc1NodXREb3duOyAvLyBTZWN1cml0eSBmZWF0dXJlLCBpZiB5ZXMgdGhhbiBpbnZlc3RpbmcsIG1hbmFnaW5nLCBhbGxvY2F0ZVVuY2xhaW1lZEZlZXMgZ2V0cyBibG9ja2VkCiAgICBSZXF1ZXN0W10gcHVibGljIHJlcXVlc3RzOyAvLyBBbGwgdGhlIHJlcXVlc3RzIHRoaXMgZnVuZCByZWNlaXZlZCBmcm9tIHBhcnRpY2lwYW50cwogICAgYm9vbCBwdWJsaWMgaXNJbnZlc3RBbGxvd2VkOyAvLyBVc2VyIG9wdGlvbiwgaWYgZmFsc2UgZnVuZCByZWplY3RzIE1lbG9uIGludmVzdG1lbnRzCiAgICBib29sIHB1YmxpYyBpc1JlZGVlbUFsbG93ZWQ7IC8vIFVzZXIgb3B0aW9uLCBpZiBmYWxzZSBmdW5kIHJlamVjdHMgTWVsb24gcmVkZW1wdGlvbnM7IFJlZGVtcHRpb25zIHVzaW5nIHNsaWNlcyBhbHdheXMgcG9zc2libGUKICAgIE9yZGVyW10gcHVibGljIG9yZGVyczsgLy8gQWxsIHRoZSBvcmRlcnMgdGhpcyBmdW5kIHBsYWNlZCBvbiBleGNoYW5nZXMKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHM7IC8vIGV4Y2hhbmdlSW5kZXggdG86IGFzc2V0IHRvIG9wZW4gbWFrZSBvcmRlciBJRCA7IGlmIG5vIG9wZW4gbWFrZSBvcmRlcnMsIG9yZGVySUQgaXMgemVybwogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lZEFzc2V0czsgLy8gTGlzdCBvZiBhbGwgYXNzZXRzIG93bmVkIGJ5IHRoZSBmdW5kIG9yIGZvciB3aGljaCB0aGUgZnVuZCBoYXMgb3BlbiBtYWtlIG9yZGVycwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNJbkFzc2V0TGlzdDsgLy8gTWFwcGluZyBmcm9tIGFzc2V0IHRvIHdoZXRoZXIgdGhlIGFzc2V0IGV4aXN0cyBpbiBvd25lZEFzc2V0cwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNJbk9wZW5NYWtlT3JkZXI7IC8vIE1hcHBpbmcgZnJvbSBhc3NldCB0byB3aGV0aGVyIHRoZSBhc3NldCBpcyBpbiBhIG9wZW4gbWFrZSBvcmRlciBhcyBidXkgYXNzZXQKCiAgICAvLyBNRVRIT0RTCgogICAgLy8gQ09OU1RSVUNUT1IKCiAgICAvLy8gQGRldiBTaG91bGQgb25seSBiZSBjYWxsZWQgdmlhIFZlcnNpb24uc2V0dXBGdW5kKC4uKQogICAgLy8vIEBwYXJhbSB3aXRoTmFtZSBodW1hbi1yZWFkYWJsZSBkZXNjcmlwdGl2ZSBuYW1lIChub3QgbmVjZXNzYXJpbHkgdW5pcXVlKQogICAgLy8vIEBwYXJhbSBvZlF1b3RlQXNzZXQgQXNzZXQgYWdhaW5zdCB3aGljaCBtZ210IGFuZCBwZXJmb3JtYW5jZSBmZWUgaXMgbWVhc3VyZWQgYWdhaW5zdCBhbmQgd2hpY2ggY2FuIGJlIHVzZWQgdG8gaW52ZXN0L3JlZGVlbSB1c2luZyB0aGlzIHNpbmdsZSBhc3NldAogICAgLy8vIEBwYXJhbSBvZk1hbmFnZW1lbnRGZWUgQSB0aW1lIGJhc2VkIGZlZSBleHByZXNzZWQsIGdpdmVuIGluIGEgbnVtYmVyIHdoaWNoIGlzIGRpdmlkZWQgYnkgMSBXQUQKICAgIC8vLyBAcGFyYW0gb2ZQZXJmb3JtYW5jZUZlZSBBIHRpbWUgcGVyZm9ybWFuY2UgYmFzZWQgZmVlLCBwZXJmb3JtYW5jZSByZWxhdGl2ZSB0byBvZlF1b3RlQXNzZXQsIGdpdmVuIGluIGEgbnVtYmVyIHdoaWNoIGlzIGRpdmlkZWQgYnkgMSBXQUQKICAgIC8vLyBAcGFyYW0gb2ZDb21wbGlhbmNlIEFkZHJlc3Mgb2YgY29tcGxpYW5jZSBtb2R1bGUKICAgIC8vLyBAcGFyYW0gb2ZSaXNrTWdtdCBBZGRyZXNzIG9mIHJpc2sgbWFuYWdlbWVudCBtb2R1bGUKICAgIC8vLyBAcGFyYW0gb2ZQcmljZUZlZWQgQWRkcmVzcyBvZiBwcmljZSBmZWVkIG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZkV4Y2hhbmdlcyBBZGRyZXNzZXMgb2YgZXhjaGFuZ2Ugb24gd2hpY2ggdGhpcyBmdW5kIGNhbiB0cmFkZQogICAgLy8vIEBwYXJhbSBvZkV4Y2hhbmdlQWRhcHRlcnMgQWRkcmVzc2VzIG9mIGV4Y2hhbmdlIGFkYXB0ZXJzCiAgICAvLy8gQHJldHVybiBEZXBsb3llZCBGdW5kIHdpdGggbWFuYWdlciBzZXQgYXMgb2ZNYW5hZ2VyCiAgICBmdW5jdGlvbiBGdW5kKAogICAgICAgIGFkZHJlc3Mgb2ZNYW5hZ2VyLAogICAgICAgIHN0cmluZyB3aXRoTmFtZSwKICAgICAgICBhZGRyZXNzIG9mUXVvdGVBc3NldCwKICAgICAgICB1aW50IG9mTWFuYWdlbWVudEZlZSwKICAgICAgICB1aW50IG9mUGVyZm9ybWFuY2VGZWUsCiAgICAgICAgYWRkcmVzcyBvZk5hdGl2ZUFzc2V0LAogICAgICAgIGFkZHJlc3Mgb2ZDb21wbGlhbmNlLAogICAgICAgIGFkZHJlc3Mgb2ZSaXNrTWdtdCwKICAgICAgICBhZGRyZXNzIG9mUHJpY2VGZWVkLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlcywKICAgICAgICBhZGRyZXNzW10gb2ZFeGNoYW5nZUFkYXB0ZXJzCiAgICApCiAgICAgICAgUmVzdHJpY3RlZFNoYXJlcyh3aXRoTmFtZSwgIk1MTkYiLCAxOCwgbm93KQogICAgewogICAgICAgIGlzSW52ZXN0QWxsb3dlZCA9IHRydWU7CiAgICAgICAgaXNSZWRlZW1BbGxvd2VkID0gdHJ1ZTsKICAgICAgICBvd25lciA9IG9mTWFuYWdlcjsKICAgICAgICByZXF1aXJlKG9mTWFuYWdlbWVudEZlZSA8IDEwICoqIDE4KTsgLy8gUmVxdWlyZSBtYW5hZ2VtZW50IGZlZSB0byBiZSBsZXNzIHRoYW4gMTAwIHBlcmNlbnQKICAgICAgICBNQU5BR0VNRU5UX0ZFRV9SQVRFID0gb2ZNYW5hZ2VtZW50RmVlOyAvLyAxIHBlcmNlbnQgaXMgZXhwcmVzc2VkIGFzIDAuMDEgKiAxMCAqKiAxOAogICAgICAgIHJlcXVpcmUob2ZQZXJmb3JtYW5jZUZlZSA8IDEwICoqIDE4KTsgLy8gUmVxdWlyZSBwZXJmb3JtYW5jZSBmZWUgdG8gYmUgbGVzcyB0aGFuIDEwMCBwZXJjZW50CiAgICAgICAgUEVSRk9STUFOQ0VfRkVFX1JBVEUgPSBvZlBlcmZvcm1hbmNlRmVlOyAvLyAxIHBlcmNlbnQgaXMgZXhwcmVzc2VkIGFzIDAuMDEgKiAxMCAqKiAxOAogICAgICAgIFZFUlNJT04gPSBtc2cuc2VuZGVyOwogICAgICAgIG1vZHVsZS5jb21wbGlhbmNlID0gQ29tcGxpYW5jZUludGVyZmFjZShvZkNvbXBsaWFuY2UpOwogICAgICAgIG1vZHVsZS5yaXNrbWdtdCA9IFJpc2tNZ210SW50ZXJmYWNlKG9mUmlza01nbXQpOwogICAgICAgIG1vZHVsZS5wcmljZWZlZWQgPSBQcmljZUZlZWRJbnRlcmZhY2Uob2ZQcmljZUZlZWQpOwogICAgICAgIC8vIEJyaWRnZWQgdG8gTWVsb24gZXhjaGFuZ2UgaW50ZXJmYWNlIGJ5IGV4Y2hhbmdlQWRhcHRlciBsaWJyYXJ5CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb2ZFeGNoYW5nZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgRXhjaGFuZ2VJbnRlcmZhY2UgYWRhcHRlciA9IEV4Y2hhbmdlSW50ZXJmYWNlKG9mRXhjaGFuZ2VBZGFwdGVyc1tpXSk7CiAgICAgICAgICAgIGJvb2wgaXNBcHByb3ZlT25seSA9IGFkYXB0ZXIuaXNBcHByb3ZlT25seSgpOwogICAgICAgICAgICBleGNoYW5nZXMucHVzaChFeGNoYW5nZSh7CiAgICAgICAgICAgICAgICBleGNoYW5nZTogb2ZFeGNoYW5nZXNbaV0sCiAgICAgICAgICAgICAgICBleGNoYW5nZUFkYXB0ZXI6IGFkYXB0ZXIsCiAgICAgICAgICAgICAgICBpc0FwcHJvdmVPbmx5OiBpc0FwcHJvdmVPbmx5CiAgICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgLy8gUmVxdWlyZSBRdW90ZSBhc3NldHMgZXhpc3RzIGluIHByaWNlZmVlZAogICAgICAgIFFVT1RFX0FTU0VUID0gQXNzZXQob2ZRdW90ZUFzc2V0KTsKICAgICAgICBOQVRJVkVfQVNTRVQgPSBOYXRpdmVBc3NldEludGVyZmFjZShvZk5hdGl2ZUFzc2V0KTsKICAgICAgICAvLyBRdW90ZSBBc3NldCBhbmQgTmF0aXZlIGFzc2V0IGFsd2F5cyBpbiBvd25lZCBhc3NldHMgbGlzdAogICAgICAgIG93bmVkQXNzZXRzLnB1c2gob2ZRdW90ZUFzc2V0KTsKICAgICAgICBpc0luQXNzZXRMaXN0W29mUXVvdGVBc3NldF0gPSB0cnVlOwogICAgICAgIG93bmVkQXNzZXRzLnB1c2gob2ZOYXRpdmVBc3NldCk7CiAgICAgICAgaXNJbkFzc2V0TGlzdFtvZk5hdGl2ZUFzc2V0XSA9IHRydWU7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKFFVT1RFX0FTU0VUKSA9PSBtb2R1bGUucHJpY2VmZWVkLmdldFF1b3RlQXNzZXQoKSk7IC8vIFNhbml0eSBjaGVjawogICAgICAgIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24gPSBDYWxjdWxhdGlvbnMoewogICAgICAgICAgICBnYXY6IDAsCiAgICAgICAgICAgIG1hbmFnZW1lbnRGZWU6IDAsCiAgICAgICAgICAgIHBlcmZvcm1hbmNlRmVlOiAwLAogICAgICAgICAgICB1bmNsYWltZWRGZWVzOiAwLAogICAgICAgICAgICBuYXY6IDAsCiAgICAgICAgICAgIGhpZ2hXYXRlck1hcms6IDEwICoqIGdldERlY2ltYWxzKCksCiAgICAgICAgICAgIHRvdGFsU3VwcGx5OiB0b3RhbFN1cHBseSwKICAgICAgICAgICAgdGltZXN0YW1wOiBub3cKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBFWFRFUk5BTCBNRVRIT0RTCgogICAgLy8gRVhURVJOQUwgOiBBRE1JTklTVFJBVElPTgoKICAgIGZ1bmN0aW9uIGVuYWJsZUludmVzdG1lbnQoKSBleHRlcm5hbCBwcmVfY29uZChpc093bmVyKCkpIHsgaXNJbnZlc3RBbGxvd2VkID0gdHJ1ZTsgfQogICAgZnVuY3Rpb24gZGlzYWJsZUludmVzdG1lbnQoKSBleHRlcm5hbCBwcmVfY29uZChpc093bmVyKCkpIHsgaXNJbnZlc3RBbGxvd2VkID0gZmFsc2U7IH0KICAgIGZ1bmN0aW9uIGVuYWJsZVJlZGVtcHRpb24oKSBleHRlcm5hbCBwcmVfY29uZChpc093bmVyKCkpIHsgaXNSZWRlZW1BbGxvd2VkID0gdHJ1ZTsgfQogICAgZnVuY3Rpb24gZGlzYWJsZVJlZGVtcHRpb24oKSBleHRlcm5hbCBwcmVfY29uZChpc093bmVyKCkpIHsgaXNSZWRlZW1BbGxvd2VkID0gZmFsc2U7IH0KICAgIGZ1bmN0aW9uIHNodXREb3duKCkgZXh0ZXJuYWwgcHJlX2NvbmQobXNnLnNlbmRlciA9PSBWRVJTSU9OKSB7IGlzU2h1dERvd24gPSB0cnVlOyB9CgoKICAgIC8vIEVYVEVSTkFMIDogUEFSVElDSVBBVElPTgoKICAgIC8vLyBAbm90aWNlIEdpdmUgbWVsb24gdG9rZW5zIHRvIHJlY2VpdmUgc2hhcmVzIG9mIHRoaXMgZnVuZAogICAgLy8vIEBkZXYgUmVjb21tZW5kZWQgdG8gZ2l2ZSBzb21lIGxlZXdheSBpbiBwcmljZXMgdG8gYWNjb3VudCBmb3IgcG9zc2libHkgc2xpZ2h0bHkgY2hhbmdpbmcgcHJpY2VzCiAgICAvLy8gQHBhcmFtIGdpdmVRdWFudGl0eSBRdWFudGl0eSBvZiBNZWxvbiB0b2tlbiB0aW1lcyAxMCAqKiAxOCBvZmZlcmVkIHRvIHJlY2VpdmUgc2hhcmVRdWFudGl0eQogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IFF1YW50aXR5IG9mIHNoYXJlcyB0aW1lcyAxMCAqKiAxOCByZXF1ZXN0ZWQgdG8gYmUgcmVjZWl2ZWQKICAgIGZ1bmN0aW9uIHJlcXVlc3RJbnZlc3RtZW50KAogICAgICAgIHVpbnQgZ2l2ZVF1YW50aXR5LAogICAgICAgIHVpbnQgc2hhcmVRdWFudGl0eSwKICAgICAgICBib29sIGlzTmF0aXZlQXNzZXQKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKCFpc1NodXREb3duKQogICAgICAgIHByZV9jb25kKGlzSW52ZXN0QWxsb3dlZCkgLy8gaW52ZXN0bWVudCB1c2luZyBNZWxvbiBoYXMgbm90IGJlZW4gZGVhY3RpdmF0ZWQgYnkgdGhlIE1hbmFnZXIKICAgICAgICBwcmVfY29uZChtb2R1bGUuY29tcGxpYW5jZS5pc0ludmVzdG1lbnRQZXJtaXR0ZWQobXNnLnNlbmRlciwgZ2l2ZVF1YW50aXR5LCBzaGFyZVF1YW50aXR5KSkgICAgLy8gQ29tcGxpYW5jZSBNb2R1bGU6IEludmVzdG1lbnQgcGVybWl0dGVkCiAgICB7CiAgICAgICAgcmVxdWVzdHMucHVzaChSZXF1ZXN0KHsKICAgICAgICAgICAgcGFydGljaXBhbnQ6IG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHN0YXR1czogUmVxdWVzdFN0YXR1cy5hY3RpdmUsCiAgICAgICAgICAgIHJlcXVlc3RUeXBlOiBSZXF1ZXN0VHlwZS5pbnZlc3QsCiAgICAgICAgICAgIHJlcXVlc3RBc3NldDogaXNOYXRpdmVBc3NldCA/IGFkZHJlc3MoTkFUSVZFX0FTU0VUKSA6IGFkZHJlc3MoUVVPVEVfQVNTRVQpLAogICAgICAgICAgICBzaGFyZVF1YW50aXR5OiBzaGFyZVF1YW50aXR5LAogICAgICAgICAgICBnaXZlUXVhbnRpdHk6IGdpdmVRdWFudGl0eSwKICAgICAgICAgICAgcmVjZWl2ZVF1YW50aXR5OiBzaGFyZVF1YW50aXR5LAogICAgICAgICAgICB0aW1lc3RhbXA6IG5vdywKICAgICAgICAgICAgYXRVcGRhdGVJZDogbW9kdWxlLnByaWNlZmVlZC5nZXRMYXN0VXBkYXRlSWQoKQogICAgICAgIH0pKTsKICAgICAgICBSZXF1ZXN0VXBkYXRlZChnZXRMYXN0UmVxdWVzdElkKCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdpdmUgc2hhcmVzIG9mIHRoaXMgZnVuZCB0byByZWNlaXZlIG1lbG9uIHRva2VucwogICAgLy8vIEBkZXYgUmVjb21tZW5kZWQgdG8gZ2l2ZSBzb21lIGxlZXdheSBpbiBwcmljZXMgdG8gYWNjb3VudCBmb3IgcG9zc2libHkgc2xpZ2h0bHkgY2hhbmdpbmcgcHJpY2VzCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2hhcmVzIHRpbWVzIDEwICoqIDE4IG9mZmVyZWQgdG8gcmVkZWVtCiAgICAvLy8gQHBhcmFtIHJlY2VpdmVRdWFudGl0eSBRdWFudGl0eSBvZiBNZWxvbiB0b2tlbiB0aW1lcyAxMCAqKiAxOCByZXF1ZXN0ZWQgdG8gcmVjZWl2ZSBmb3Igc2hhcmVRdWFudGl0eQogICAgZnVuY3Rpb24gcmVxdWVzdFJlZGVtcHRpb24oCiAgICAgICAgdWludCBzaGFyZVF1YW50aXR5LAogICAgICAgIHVpbnQgcmVjZWl2ZVF1YW50aXR5LAogICAgICAgIGJvb2wgaXNOYXRpdmVBc3NldAogICAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZCghaXNTaHV0RG93bikKICAgICAgICBwcmVfY29uZChpc1JlZGVlbUFsbG93ZWQpIC8vIFJlZGVtcHRpb24gdXNpbmcgTWVsb24gaGFzIG5vdCBiZWVuIGRlYWN0aXZhdGVkIGJ5IE1hbmFnZXIKICAgICAgICBwcmVfY29uZChtb2R1bGUuY29tcGxpYW5jZS5pc1JlZGVtcHRpb25QZXJtaXR0ZWQobXNnLnNlbmRlciwgc2hhcmVRdWFudGl0eSwgcmVjZWl2ZVF1YW50aXR5KSkgLy8gQ29tcGxpYW5jZSBNb2R1bGU6IFJlZGVtcHRpb24gcGVybWl0dGVkCiAgICB7CiAgICAgICAgcmVxdWVzdHMucHVzaChSZXF1ZXN0KHsKICAgICAgICAgICAgcGFydGljaXBhbnQ6IG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHN0YXR1czogUmVxdWVzdFN0YXR1cy5hY3RpdmUsCiAgICAgICAgICAgIHJlcXVlc3RUeXBlOiBSZXF1ZXN0VHlwZS5yZWRlZW0sCiAgICAgICAgICAgIHJlcXVlc3RBc3NldDogaXNOYXRpdmVBc3NldCA/IGFkZHJlc3MoTkFUSVZFX0FTU0VUKSA6IGFkZHJlc3MoUVVPVEVfQVNTRVQpLAogICAgICAgICAgICBzaGFyZVF1YW50aXR5OiBzaGFyZVF1YW50aXR5LAogICAgICAgICAgICBnaXZlUXVhbnRpdHk6IHNoYXJlUXVhbnRpdHksCiAgICAgICAgICAgIHJlY2VpdmVRdWFudGl0eTogcmVjZWl2ZVF1YW50aXR5LAogICAgICAgICAgICB0aW1lc3RhbXA6IG5vdywKICAgICAgICAgICAgYXRVcGRhdGVJZDogbW9kdWxlLnByaWNlZmVlZC5nZXRMYXN0VXBkYXRlSWQoKQogICAgICAgIH0pKTsKICAgICAgICBSZXF1ZXN0VXBkYXRlZChnZXRMYXN0UmVxdWVzdElkKCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEV4ZWN1dGVzIGFjdGl2ZSBpbnZlc3RtZW50IGFuZCByZWRlbXB0aW9uIHJlcXVlc3RzLCBpbiBhIHdheSB0aGF0IG1pbmltaXNlcyBpbmZvcm1hdGlvbiBhZHZhbnRhZ2VzIG9mIGludmVzdG9yCiAgICAvLy8gQGRldiBEaXN0cmlidXRlcyBtZWxvbiBhbmQgc2hhcmVzIGFjY29yZGluZyB0byB0aGUgcmVxdWVzdAogICAgLy8vIEBwYXJhbSBpZCBJbmRleCBvZiByZXF1ZXN0IHRvIGJlIGV4ZWN1dGVkCiAgICAvLy8gQGRldiBBY3RpdmUgaW52ZXN0bWVudCBvciByZWRlbXB0aW9uIHJlcXVlc3QgZXhlY3V0ZWQKICAgIGZ1bmN0aW9uIGV4ZWN1dGVSZXF1ZXN0KHVpbnQgaWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZCghaXNTaHV0RG93bikKICAgICAgICBwcmVfY29uZChyZXF1ZXN0c1tpZF0uc3RhdHVzID09IFJlcXVlc3RTdGF0dXMuYWN0aXZlKQogICAgICAgIHByZV9jb25kKHJlcXVlc3RzW2lkXS5yZXF1ZXN0VHlwZSAhPSBSZXF1ZXN0VHlwZS5yZWRlZW0gfHwgcmVxdWVzdHNbaWRdLnNoYXJlUXVhbnRpdHkgPD0gYmFsYW5jZXNbcmVxdWVzdHNbaWRdLnBhcnRpY2lwYW50XSkgLy8gcmVxdWVzdCBvd25lciBkb2VzIG5vdCBvd24gZW5vdWdoIHNoYXJlcwogICAgICAgIHByZV9jb25kKAogICAgICAgICAgICB0b3RhbFN1cHBseSA9PSAwIHx8CiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgIG5vdyA+PSBhZGQocmVxdWVzdHNbaWRdLnRpbWVzdGFtcCwgbW9kdWxlLnByaWNlZmVlZC5nZXRJbnRlcnZhbCgpKSAmJgogICAgICAgICAgICAgICAgbW9kdWxlLnByaWNlZmVlZC5nZXRMYXN0VXBkYXRlSWQoKSA+PSBhZGQocmVxdWVzdHNbaWRdLmF0VXBkYXRlSWQsIDIpCiAgICAgICAgICAgICkKICAgICAgICApICAgLy8gUHJpY2VGZWVkIE1vZHVsZTogV2FpdCBhdCBsZWFzdCBvbmUgaW50ZXJ2YWwgdGltZSBhbmQgdHdvIHVwZGF0ZXMgYmVmb3JlIGNvbnRpbnVpbmcgKHVubGVzcyBpdCBpcyB0aGUgZmlyc3QgaW52ZXN0bWVudCkKICAgICAgICAgLy8gUHJpY2VGZWVkIE1vZHVsZTogTm8gcmVjZW50IHVwZGF0ZXMgZm9yIGZ1bmQgYXNzZXQgbGlzdAogICAgewogICAgICAgIC8vIHNoYXJlUHJpY2UgcXVvdGVkIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIGZ1bmREZWNpbWFscwogICAgICAgIC8vIGJhc2VkIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIGZ1bmREZWNpbWFscwogICAgICAgIHJlcXVpcmUobW9kdWxlLnByaWNlZmVlZC5oYXNSZWNlbnRQcmljZShhZGRyZXNzKFFVT1RFX0FTU0VUKSkpOwogICAgICAgIHJlcXVpcmUobW9kdWxlLnByaWNlZmVlZC5oYXNSZWNlbnRQcmljZXMob3duZWRBc3NldHMpKTsKICAgICAgICB2YXIgKGlzUmVjZW50LCAsICkgPSBtb2R1bGUucHJpY2VmZWVkLmdldEludmVydGVkUHJpY2UoYWRkcmVzcyhRVU9URV9BU1NFVCkpOwogICAgICAgIC8vIFRPRE86IGNoZWNrIHByZWNpc2lvbiBvZiBiZWxvdyBvdGhlcndpc2UgdXNlOyB1aW50IGNvc3RRdWFudGl0eSA9IHRvV2hvbGVTaGFyZVVuaXQobXVsKHJlcXVlc3Quc2hhcmVRdWFudGl0eSwgY2FsY1NoYXJlUHJpY2UoKSkpOwogICAgICAgIC8vIEJ5IGRlZmluaXRpb24gcXVvdGVEZWNpbWFscyA9PSBmdW5kRGVjaW1hbHMKICAgICAgICBSZXF1ZXN0IHJlcXVlc3QgPSByZXF1ZXN0c1tpZF07CgogICAgICAgIHVpbnQgY29zdFF1YW50aXR5ID0gdG9XaG9sZVNoYXJlVW5pdChtdWwocmVxdWVzdC5zaGFyZVF1YW50aXR5LCBjYWxjU2hhcmVQcmljZSgpKSk7CiAgICAgICAgaWYgKHJlcXVlc3QucmVxdWVzdEFzc2V0ID09IGFkZHJlc3MoTkFUSVZFX0FTU0VUKSkgewogICAgICAgICAgICB2YXIgKGlzUHJpY2VSZWNlbnQsIGludmVydGVkTmF0aXZlQXNzZXRQcmljZSwgbmF0aXZlQXNzZXREZWNpbWFsKSA9IG1vZHVsZS5wcmljZWZlZWQuZ2V0SW52ZXJ0ZWRQcmljZShhZGRyZXNzKE5BVElWRV9BU1NFVCkpOwogICAgICAgICAgICBpZiAoIWlzUHJpY2VSZWNlbnQpIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvc3RRdWFudGl0eSA9IG11bChjb3N0UXVhbnRpdHksIGludmVydGVkTmF0aXZlQXNzZXRQcmljZSkgLyAxMCAqKiBuYXRpdmVBc3NldERlY2ltYWw7CiAgICAgICAgfQoKICAgICAgICBpZiAoCiAgICAgICAgICAgIGlzSW52ZXN0QWxsb3dlZCAmJgogICAgICAgICAgICByZXF1ZXN0LnJlcXVlc3RUeXBlID09IFJlcXVlc3RUeXBlLmludmVzdCAmJgogICAgICAgICAgICBjb3N0UXVhbnRpdHkgPD0gcmVxdWVzdC5naXZlUXVhbnRpdHkKICAgICAgICApIHsKICAgICAgICAgICAgcmVxdWVzdC5zdGF0dXMgPSBSZXF1ZXN0U3RhdHVzLmV4ZWN1dGVkOwogICAgICAgICAgICBhc3NlcnQoQXNzZXRJbnRlcmZhY2UocmVxdWVzdC5yZXF1ZXN0QXNzZXQpLnRyYW5zZmVyRnJvbShyZXF1ZXN0LnBhcnRpY2lwYW50LCB0aGlzLCBjb3N0UXVhbnRpdHkpKTsgLy8gQWxsb2NhdGUgVmFsdWUKICAgICAgICAgICAgY3JlYXRlU2hhcmVzKHJlcXVlc3QucGFydGljaXBhbnQsIHJlcXVlc3Quc2hhcmVRdWFudGl0eSk7IC8vIEFjY291bnRpbmcKICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICBpc1JlZGVlbUFsbG93ZWQgJiYKICAgICAgICAgICAgcmVxdWVzdC5yZXF1ZXN0VHlwZSA9PSBSZXF1ZXN0VHlwZS5yZWRlZW0gJiYKICAgICAgICAgICAgcmVxdWVzdC5yZWNlaXZlUXVhbnRpdHkgPD0gY29zdFF1YW50aXR5CiAgICAgICAgKSB7CiAgICAgICAgICAgIHJlcXVlc3Quc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5leGVjdXRlZDsKICAgICAgICAgICAgYXNzZXJ0KEFzc2V0SW50ZXJmYWNlKHJlcXVlc3QucmVxdWVzdEFzc2V0KS50cmFuc2ZlcihyZXF1ZXN0LnBhcnRpY2lwYW50LCBjb3N0UXVhbnRpdHkpKTsgLy8gUmV0dXJuIHZhbHVlCiAgICAgICAgICAgIGFubmloaWxhdGVTaGFyZXMocmVxdWVzdC5wYXJ0aWNpcGFudCwgcmVxdWVzdC5zaGFyZVF1YW50aXR5KTsgLy8gQWNjb3VudGluZwogICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIGlzUmVkZWVtQWxsb3dlZCAmJgogICAgICAgICAgICByZXF1ZXN0LnJlcXVlc3RUeXBlID09IFJlcXVlc3RUeXBlLnRva2VuRmFsbGJhY2tSZWRlZW0gJiYKICAgICAgICAgICAgcmVxdWVzdC5yZWNlaXZlUXVhbnRpdHkgPD0gY29zdFF1YW50aXR5CiAgICAgICAgKSB7CiAgICAgICAgICAgIHJlcXVlc3Quc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5leGVjdXRlZDsKICAgICAgICAgICAgYXNzZXJ0KEFzc2V0SW50ZXJmYWNlKHJlcXVlc3QucmVxdWVzdEFzc2V0KS50cmFuc2ZlcihyZXF1ZXN0LnBhcnRpY2lwYW50LCBjb3N0UXVhbnRpdHkpKTsgLy8gUmV0dXJuIHZhbHVlCiAgICAgICAgICAgIGFubmloaWxhdGVTaGFyZXModGhpcywgcmVxdWVzdC5zaGFyZVF1YW50aXR5KTsgLy8gQWNjb3VudGluZwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOyAvLyBJbnZhbGlkIFJlcXVlc3Qgb3IgaW52YWxpZCBnaXZlUXVhbnRpdHkgLyByZWNlaXZlUXVhbnRpdHkKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FuY2VscyBhY3RpdmUgaW52ZXN0bWVudCBhbmQgcmVkZW1wdGlvbiByZXF1ZXN0cwogICAgLy8vIEBwYXJhbSBpZCBJbmRleCBvZiByZXF1ZXN0IHRvIGJlIGV4ZWN1dGVkCiAgICBmdW5jdGlvbiBjYW5jZWxSZXF1ZXN0KHVpbnQgaWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZChyZXF1ZXN0c1tpZF0uc3RhdHVzID09IFJlcXVlc3RTdGF0dXMuYWN0aXZlKSAvLyBSZXF1ZXN0IGlzIGFjdGl2ZQogICAgICAgIHByZV9jb25kKHJlcXVlc3RzW2lkXS5wYXJ0aWNpcGFudCA9PSBtc2cuc2VuZGVyIHx8IGlzU2h1dERvd24pIC8vIEVpdGhlciByZXF1ZXN0IGNyZWF0b3Igb3IgZnVuZCBpcyBzaHV0IGRvd24KICAgIHsKICAgICAgICByZXF1ZXN0c1tpZF0uc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5jYW5jZWxsZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmVkZWVtcyBieSBhbGxvY2F0aW5nIGFuIG93bmVyc2hpcCBwZXJjZW50YWdlIG9mIGVhY2ggYXNzZXQgdG8gdGhlIHBhcnRpY2lwYW50CiAgICAvLy8gQGRldiBJbmRlcGVuZGVudCBvZiBydW5uaW5nIHByaWNlIGZlZWQhCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgTnVtYmVyIG9mIHNoYXJlcyBvd25lZCBieSB0aGUgcGFydGljaXBhbnQsIHdoaWNoIHRoZSBwYXJ0aWNpcGFudCB3b3VsZCBsaWtlIHRvIHJlZGVlbSBmb3IgaW5kaXZpZHVhbCBhc3NldHMKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgYWxsIGFzc2V0cyBzZW50IHRvIHNoYXJlaG9sZGVyIG9yIG5vdAogICAgZnVuY3Rpb24gcmVkZWVtQWxsT3duZWRBc3NldHModWludCBzaGFyZVF1YW50aXR5KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJldHVybiBlbWVyZ2VuY3lSZWRlZW0oc2hhcmVRdWFudGl0eSwgb3duZWRBc3NldHMpOwogICAgfQoKICAgIC8vIEVYVEVSTkFMIDogTUFOQUdJTkcKCiAgICAvLy8gQG5vdGljZSBNYWtlcyBhbiBvcmRlciBvbiB0aGUgc2VsZWN0ZWQgZXhjaGFuZ2UKICAgIC8vLyBAZGV2IFRoZXNlIGFyZSBvcmRlcnMgdGhhdCBhcmUgbm90IGV4cGVjdGVkIHRvIHNldHRsZSBpbW1lZGlhdGVseS4gIFN1ZmZpY2llbnQgYmFsYW5jZSAoPT0gc2VsbFF1YW50aXR5KSBvZiBzZWxsQXNzZXQKICAgIC8vLyBAcGFyYW0gc2VsbEFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlBc3NldCBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIGJvdWdodAogICAgLy8vIEBwYXJhbSBzZWxsUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2VsbEFzc2V0IHRvIGJlIHNvbGQKICAgIC8vLyBAcGFyYW0gYnV5UXVhbnRpdHkgUXVhbnRpdHkgb2YgYnV5QXNzZXQgdG8gYmUgYm91Z2h0CiAgICBmdW5jdGlvbiBtYWtlT3JkZXIoCiAgICAgICAgdWludCBleGNoYW5nZU51bWJlciwKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldCwKICAgICAgICBhZGRyZXNzIGJ1eUFzc2V0LAogICAgICAgIHVpbnQgc2VsbFF1YW50aXR5LAogICAgICAgIHVpbnQgYnV5UXVhbnRpdHkKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKGlzT3duZXIoKSkKICAgICAgICBwcmVfY29uZCghaXNTaHV0RG93bikKICAgIHsKICAgICAgICByZXF1aXJlKGJ1eUFzc2V0ICE9IGFkZHJlc3ModGhpcykpOyAvLyBQcmV2ZW50IGJ1eWluZyBvZiBvd24gZnVuZCB0b2tlbgogICAgICAgIHJlcXVpcmUocXVhbnRpdHlIZWxkSW5DdXN0b2R5T2ZFeGNoYW5nZShzZWxsQXNzZXQpID09IDApOyAvLyBDdXJyIG9ubHkgb25lIG1ha2Ugb3JkZXIgcGVyIHNlbGxBc3NldCBhbGxvd2VkLiBQbGVhc2Ugd2FpdCBvciBjYW5jZWwgZXhpc3RpbmcgbWFrZSBvcmRlci4KICAgICAgICByZXF1aXJlKG1vZHVsZS5wcmljZWZlZWQuZXhpc3RzUHJpY2VPbkFzc2V0UGFpcihzZWxsQXNzZXQsIGJ1eUFzc2V0KSk7IC8vIFByaWNlRmVlZCBtb2R1bGU6IFJlcXVlc3RlZCBhc3NldCBwYWlyIG5vdCB2YWxpZAogICAgICAgIHZhciAoaXNSZWNlbnQsIHJlZmVyZW5jZVByaWNlLCApID0gbW9kdWxlLnByaWNlZmVlZC5nZXRSZWZlcmVuY2VQcmljZShzZWxsQXNzZXQsIGJ1eUFzc2V0KTsKICAgICAgICByZXF1aXJlKGlzUmVjZW50KTsgIC8vIFJlZmVyZW5jZSBwcmljZSBpcyByZXF1aXJlZCB0byBiZSByZWNlbnQKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtb2R1bGUucmlza21nbXQuaXNNYWtlUGVybWl0dGVkKAogICAgICAgICAgICAgICAgbW9kdWxlLnByaWNlZmVlZC5nZXRPcmRlclByaWNlKAogICAgICAgICAgICAgICAgICAgIHNlbGxBc3NldCwKICAgICAgICAgICAgICAgICAgICBidXlBc3NldCwKICAgICAgICAgICAgICAgICAgICBzZWxsUXVhbnRpdHksCiAgICAgICAgICAgICAgICAgICAgYnV5UXVhbnRpdHkKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICByZWZlcmVuY2VQcmljZSwKICAgICAgICAgICAgICAgIHNlbGxBc3NldCwKICAgICAgICAgICAgICAgIGJ1eUFzc2V0LAogICAgICAgICAgICAgICAgc2VsbFF1YW50aXR5LAogICAgICAgICAgICAgICAgYnV5UXVhbnRpdHkKICAgICAgICAgICAgKQogICAgICAgICk7IC8vIFJpc2tNZ210IG1vZHVsZTogTWFrZSBvcmRlciBub3QgcGVybWl0dGVkCiAgICAgICAgcmVxdWlyZShpc0luQXNzZXRMaXN0W2J1eUFzc2V0XSB8fCBvd25lZEFzc2V0cy5sZW5ndGggPCBNQVhfRlVORF9BU1NFVFMpOyAvLyBMaW1pdCBmb3IgbWF4IG93bmFibGUgYXNzZXRzIGJ5IHRoZSBmdW5kIHJlYWNoZWQKICAgICAgICByZXF1aXJlKEFzc2V0SW50ZXJmYWNlKHNlbGxBc3NldCkuYXBwcm92ZShleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBzZWxsUXVhbnRpdHkpKTsgLy8gQXBwcm92ZSBleGNoYW5nZSB0byBzcGVuZCBhc3NldHMKCiAgICAgICAgLy8gU2luY2UgdGhlcmUgaXMgb25seSBvbmUgb3Blbk1ha2VPcmRlciBhbGxvd2VkIGZvciBlYWNoIGFzc2V0LCB3ZSBjYW4gYXNzdW1lIHRoYXQgb3Blbk1ha2VPcmRlcklkIGlzIHNldCBhcyB6ZXJvIGJ5IHF1YW50aXR5SGVsZEluQ3VzdG9keU9mRXhjaGFuZ2UoKSBmdW5jdGlvbgogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlcikuZGVsZWdhdGVjYWxsKGJ5dGVzNChrZWNjYWsyNTYoIm1ha2VPcmRlcihhZGRyZXNzLGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2LHVpbnQyNTYpIikpLCBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBzZWxsQXNzZXQsIGJ1eUFzc2V0LCBzZWxsUXVhbnRpdHksIGJ1eVF1YW50aXR5KSk7CiAgICAgICAgZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbZXhjaGFuZ2VOdW1iZXJdW3NlbGxBc3NldF0gPSBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlci5nZXRMYXN0T3JkZXJJZChleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlKTsKCiAgICAgICAgLy8gU3VjY2VzcyBkZWZpbmVkIGFzIG5vbi16ZXJvIG9yZGVyIGlkCiAgICAgICAgcmVxdWlyZShleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkc1tleGNoYW5nZU51bWJlcl1bc2VsbEFzc2V0XSAhPSAwKTsKCiAgICAgICAgLy8gVXBkYXRlIG93bmVkQXNzZXRzIGFycmF5IGFuZCBpc0luQXNzZXRMaXN0LCBpc0luT3Blbk1ha2VPcmRlciBtYXBwaW5nCiAgICAgICAgaXNJbk9wZW5NYWtlT3JkZXJbYnV5QXNzZXRdID0gdHJ1ZTsKICAgICAgICBpZiAoIWlzSW5Bc3NldExpc3RbYnV5QXNzZXRdKSB7CiAgICAgICAgICAgIG93bmVkQXNzZXRzLnB1c2goYnV5QXNzZXQpOwogICAgICAgICAgICBpc0luQXNzZXRMaXN0W2J1eUFzc2V0XSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBvcmRlcnMucHVzaChPcmRlcih7CiAgICAgICAgICAgIGV4Y2hhbmdlSWQ6IGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2V4Y2hhbmdlTnVtYmVyXVtzZWxsQXNzZXRdLAogICAgICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLmFjdGl2ZSwKICAgICAgICAgICAgb3JkZXJUeXBlOiBPcmRlclR5cGUubWFrZSwKICAgICAgICAgICAgc2VsbEFzc2V0OiBzZWxsQXNzZXQsCiAgICAgICAgICAgIGJ1eUFzc2V0OiBidXlBc3NldCwKICAgICAgICAgICAgc2VsbFF1YW50aXR5OiBzZWxsUXVhbnRpdHksCiAgICAgICAgICAgIGJ1eVF1YW50aXR5OiBidXlRdWFudGl0eSwKICAgICAgICAgICAgdGltZXN0YW1wOiBub3csCiAgICAgICAgICAgIGZpbGxRdWFudGl0eTogMAogICAgICAgIH0pKTsKCiAgICAgICAgT3JkZXJVcGRhdGVkKGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2V4Y2hhbmdlTnVtYmVyXVtzZWxsQXNzZXRdKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUYWtlcyBhbiBhY3RpdmUgb3JkZXIgb24gdGhlIHNlbGVjdGVkIGV4Y2hhbmdlCiAgICAvLy8gQGRldiBUaGVzZSBhcmUgb3JkZXJzIHRoYXQgYXJlIGV4cGVjdGVkIHRvIHNldHRsZSBpbW1lZGlhdGVseQogICAgLy8vIEBwYXJhbSBpZCBBY3RpdmUgb3JkZXIgaWQKICAgIC8vLyBAcGFyYW0gcmVjZWl2ZVF1YW50aXR5IEJ1eSBxdWFudGl0eSBvZiB3aGF0IG90aGVycyBhcmUgc2VsbGluZyBvbiBzZWxlY3RlZCBFeGNoYW5nZQogICAgZnVuY3Rpb24gdGFrZU9yZGVyKHVpbnQgZXhjaGFuZ2VOdW1iZXIsIHVpbnQgaWQsIHVpbnQgcmVjZWl2ZVF1YW50aXR5KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQoaXNPd25lcigpKQogICAgICAgIHByZV9jb25kKCFpc1NodXREb3duKQogICAgewogICAgICAgIC8vIEdldCBpbmZvcm1hdGlvbiBvZiBvcmRlciBieSBvcmRlciBpZAogICAgICAgIE9yZGVyIG1lbW9yeSBvcmRlcjsgLy8gSW52ZXJzZSB2YXJpYWJsZSB0ZXJtaW5vbG9neSEgQnV5aW5nIHdoYXQgYW5vdGhlciBwZXJzb24gaXMgc2VsbGluZwogICAgICAgICgKICAgICAgICAgICAgb3JkZXIuc2VsbEFzc2V0LAogICAgICAgICAgICBvcmRlci5idXlBc3NldCwKICAgICAgICAgICAgb3JkZXIuc2VsbFF1YW50aXR5LAogICAgICAgICAgICBvcmRlci5idXlRdWFudGl0eQogICAgICAgICkgPSBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlci5nZXRPcmRlcihleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBpZCk7CiAgICAgICAgLy8gQ2hlY2sgcHJlIGNvbmRpdGlvbnMKICAgICAgICByZXF1aXJlKG9yZGVyLnNlbGxBc3NldCAhPSBhZGRyZXNzKHRoaXMpKTsgLy8gUHJldmVudCBidXlpbmcgb2Ygb3duIGZ1bmQgdG9rZW4KICAgICAgICByZXF1aXJlKG1vZHVsZS5wcmljZWZlZWQuZXhpc3RzUHJpY2VPbkFzc2V0UGFpcihvcmRlci5idXlBc3NldCwgb3JkZXIuc2VsbEFzc2V0KSk7IC8vIFByaWNlRmVlZCBtb2R1bGU6IFJlcXVlc3RlZCBhc3NldCBwYWlyIG5vdCB2YWxpZAogICAgICAgIHJlcXVpcmUoaXNJbkFzc2V0TGlzdFtvcmRlci5zZWxsQXNzZXRdIHx8IG93bmVkQXNzZXRzLmxlbmd0aCA8IE1BWF9GVU5EX0FTU0VUUyk7IC8vIExpbWl0IGZvciBtYXggb3duYWJsZSBhc3NldHMgYnkgdGhlIGZ1bmQgcmVhY2hlZAogICAgICAgIHZhciAoaXNSZWNlbnQsIHJlZmVyZW5jZVByaWNlLCApID0gbW9kdWxlLnByaWNlZmVlZC5nZXRSZWZlcmVuY2VQcmljZShvcmRlci5idXlBc3NldCwgb3JkZXIuc2VsbEFzc2V0KTsKICAgICAgICByZXF1aXJlKGlzUmVjZW50KTsgLy8gUmVmZXJlbmNlIHByaWNlIGlzIHJlcXVpcmVkIHRvIGJlIHJlY2VudAogICAgICAgIHJlcXVpcmUocmVjZWl2ZVF1YW50aXR5IDw9IG9yZGVyLnNlbGxRdWFudGl0eSk7IC8vIE5vdCBlbm91Z2ggcXVhbnRpdHkgb2Ygb3JkZXIgZm9yIHdoYXQgaXMgdHJ5aW5nIHRvIGJlIGJvdWdodAogICAgICAgIHVpbnQgc3BlbmRRdWFudGl0eSA9IG11bChyZWNlaXZlUXVhbnRpdHksIG9yZGVyLmJ1eVF1YW50aXR5KSAvIG9yZGVyLnNlbGxRdWFudGl0eTsKICAgICAgICByZXF1aXJlKEFzc2V0SW50ZXJmYWNlKG9yZGVyLmJ1eUFzc2V0KS5hcHByb3ZlKGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2UsIHNwZW5kUXVhbnRpdHkpKTsgLy8gQ291bGQgbm90IGFwcHJvdmUgc3BlbmRpbmcgb2Ygc3BlbmRRdWFudGl0eSBvZiBvcmRlci5idXlBc3NldAogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1vZHVsZS5yaXNrbWdtdC5pc1Rha2VQZXJtaXR0ZWQoCiAgICAgICAgICAgIG1vZHVsZS5wcmljZWZlZWQuZ2V0T3JkZXJQcmljZSgKICAgICAgICAgICAgICAgIG9yZGVyLmJ1eUFzc2V0LAogICAgICAgICAgICAgICAgb3JkZXIuc2VsbEFzc2V0LAogICAgICAgICAgICAgICAgb3JkZXIuYnV5UXVhbnRpdHksIC8vIHNwZW5kUXVhbnRpdHkKICAgICAgICAgICAgICAgIG9yZGVyLnNlbGxRdWFudGl0eSAvLyByZWNlaXZlUXVhbnRpdHkKICAgICAgICAgICAgKSwKICAgICAgICAgICAgcmVmZXJlbmNlUHJpY2UsCiAgICAgICAgICAgIG9yZGVyLmJ1eUFzc2V0LAogICAgICAgICAgICBvcmRlci5zZWxsQXNzZXQsCiAgICAgICAgICAgIG9yZGVyLmJ1eVF1YW50aXR5LAogICAgICAgICAgICBvcmRlci5zZWxsUXVhbnRpdHkKICAgICAgICApKTsgLy8gUmlza01nbXQgbW9kdWxlOiBUYWtlIG9yZGVyIG5vdCBwZXJtaXR0ZWQKCiAgICAgICAgLy8gRXhlY3V0ZSByZXF1ZXN0CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2VBZGFwdGVyKS5kZWxlZ2F0ZWNhbGwoYnl0ZXM0KGtlY2NhazI1NigidGFrZU9yZGVyKGFkZHJlc3MsdWludDI1Nix1aW50MjU2KSIpKSwgZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZSwgaWQsIHJlY2VpdmVRdWFudGl0eSkpOwoKICAgICAgICAvLyBVcGRhdGUgb3duZWRBc3NldHMgYXJyYXkgYW5kIGlzSW5Bc3NldExpc3QgbWFwcGluZwogICAgICAgIGlmICghaXNJbkFzc2V0TGlzdFtvcmRlci5zZWxsQXNzZXRdKSB7CiAgICAgICAgICAgIG93bmVkQXNzZXRzLnB1c2gob3JkZXIuc2VsbEFzc2V0KTsKICAgICAgICAgICAgaXNJbkFzc2V0TGlzdFtvcmRlci5zZWxsQXNzZXRdID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIG9yZGVyLmV4Y2hhbmdlSWQgPSBpZDsKICAgICAgICBvcmRlci5zdGF0dXMgPSBPcmRlclN0YXR1cy5mdWxseUZpbGxlZDsKICAgICAgICBvcmRlci5vcmRlclR5cGUgPSBPcmRlclR5cGUudGFrZTsKICAgICAgICBvcmRlci50aW1lc3RhbXAgPSBub3c7CiAgICAgICAgb3JkZXIuZmlsbFF1YW50aXR5ID0gcmVjZWl2ZVF1YW50aXR5OwogICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTsKICAgICAgICBPcmRlclVwZGF0ZWQoaWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbmNlbHMgb3JkZXJzIHRoYXQgd2VyZSBub3QgZXhwZWN0ZWQgdG8gc2V0dGxlIGltbWVkaWF0ZWx5LCBpLmUuIG1ha2VPcmRlcnMKICAgIC8vLyBAZGV2IFJlZHVjZSBleHBvc3VyZSB3aXRoIGV4Y2hhbmdlIGludGVyYWN0aW9uCiAgICAvLy8gQHBhcmFtIGlkIEFjdGl2ZSBvcmRlciBpZCBvZiB0aGlzIG9yZGVyIGFycmF5IHdpdGggb3JkZXIgb3duZXIgb2YgdGhpcyBjb250cmFjdCBvbiBzZWxlY3RlZCBFeGNoYW5nZQogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIodWludCBleGNoYW5nZU51bWJlciwgdWludCBpZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKGlzT3duZXIoKSB8fCBpc1NodXREb3duKQogICAgewogICAgICAgIC8vIEdldCBpbmZvcm1hdGlvbiBvZiBmdW5kIG9yZGVyIGJ5IG9yZGVyIGlkCiAgICAgICAgT3JkZXIgb3JkZXIgPSBvcmRlcnNbaWRdOwoKICAgICAgICAvLyBFeGVjdXRlIHJlcXVlc3QKICAgICAgICByZXF1aXJlKGFkZHJlc3MoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZUFkYXB0ZXIpLmRlbGVnYXRlY2FsbChieXRlczQoa2VjY2FrMjU2KCJjYW5jZWxPcmRlcihhZGRyZXNzLHVpbnQyNTYpIikpLCBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBvcmRlci5leGNoYW5nZUlkKSk7CgogICAgICAgIG9yZGVyLnN0YXR1cyA9IE9yZGVyU3RhdHVzLmNhbmNlbGxlZDsKICAgICAgICBPcmRlclVwZGF0ZWQoaWQpOwogICAgfQoKCiAgICAvLyBQVUJMSUMgTUVUSE9EUwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTIDogRVJDMjIzCgogICAgLy8vIEBkZXYgU3RhbmRhcmQgRVJDMjIzIGZ1bmN0aW9uIHRoYXQgaGFuZGxlcyBpbmNvbWluZyB0b2tlbiB0cmFuc2ZlcnMuCiAgICAvLy8gQGRldiBUaGlzIHR5cGUgb2YgcmVkZW1wdGlvbiBjYW4gYmUgc2VlbiBhcyBhICJtYXJrZXQgb3JkZXIiLCB3aGVyZSBwcmljZSBpcyBjYWxjdWxhdGVkIGF0IGV4ZWN1dGlvbiB0aW1lCiAgICAvLy8gQHBhcmFtIG9mU2VuZGVyICBUb2tlbiBzZW5kZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdG9rZW5BbW91bnQgQW1vdW50IG9mIHRva2VucyBzZW50LgogICAgLy8vIEBwYXJhbSBtZXRhZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKAogICAgICAgIGFkZHJlc3Mgb2ZTZW5kZXIsCiAgICAgICAgdWludCB0b2tlbkFtb3VudCwKICAgICAgICBieXRlcyBtZXRhZGF0YQogICAgKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICAvLyB3aGVuIG9mU2VuZGVyIGlzIGEgcmVjb2duaXplZCBleGNoYW5nZSwgcmVjZWl2ZSB0b2tlbnMsIG90aGVyd2lzZSByZXZlcnQKICAgICAgICAgICAgZm9yICh1aW50IGk7IGkgPCBleGNoYW5nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChleGNoYW5nZXNbaV0uZXhjaGFuZ2UgPT0gb2ZTZW5kZXIpIHJldHVybjsgLy8gcmVjZWl2ZSB0b2tlbnMgYW5kIGRvIG5vdGhpbmcKICAgICAgICAgICAgfQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgeyAgICAvLyBvdGhlcndpc2UsIG1ha2UgYSByZWRlbXB0aW9uIHJlcXVlc3QKICAgICAgICAgICAgcmVxdWVzdHMucHVzaChSZXF1ZXN0KHsKICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50OiBvZlNlbmRlciwKICAgICAgICAgICAgICAgIHN0YXR1czogUmVxdWVzdFN0YXR1cy5hY3RpdmUsCiAgICAgICAgICAgICAgICByZXF1ZXN0VHlwZTogUmVxdWVzdFR5cGUudG9rZW5GYWxsYmFja1JlZGVlbSwKICAgICAgICAgICAgICAgIHJlcXVlc3RBc3NldDogYWRkcmVzcyhRVU9URV9BU1NFVCksIC8vIHJlZGVlbSBpbiBRVU9URV9BU1NFVAogICAgICAgICAgICAgICAgc2hhcmVRdWFudGl0eTogdG9rZW5BbW91bnQsCiAgICAgICAgICAgICAgICBnaXZlUXVhbnRpdHk6IHRva2VuQW1vdW50LCAgICAgICAgICAgICAgLy8gc2hhcmVzIGJlaW5nIHNlbnQKICAgICAgICAgICAgICAgIHJlY2VpdmVRdWFudGl0eTogMCwgICAgICAgICAgLy8gdmFsdWUgb2YgdGhlIHNoYXJlcyBhdCByZXF1ZXN0IHRpbWUKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbm93LAogICAgICAgICAgICAgICAgYXRVcGRhdGVJZDogbW9kdWxlLnByaWNlZmVlZC5nZXRMYXN0VXBkYXRlSWQoKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIFJlcXVlc3RVcGRhdGVkKGdldExhc3RSZXF1ZXN0SWQoKSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvLyBQVUJMSUMgTUVUSE9EUyA6IEFDQ09VTlRJTkcKCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIGdyb3NzIGFzc2V0IHZhbHVlIG9mIHRoZSBmdW5kCiAgICAvLy8gQGRldiBEZWNpbWFscyBpbiBhc3NldHMgbXVzdCBiZSBlcXVhbCB0byBkZWNpbWFscyBpbiBQcmljZUZlZWQgZm9yIGFsbCBlbnRyaWVzIGluIEFzc2V0UmVnaXN0cmFyCiAgICAvLy8gQGRldiBBc3N1bWVzIHRoYXQgbW9kdWxlLnByaWNlZmVlZC5nZXRQcmljZSguLikgcmV0dXJucyByZWNlbnQgcHJpY2VzCiAgICAvLy8gQHJldHVybiBnYXYgR3Jvc3MgYXNzZXQgdmFsdWUgcXVvdGVkIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIGZ1bmN0aW9uIGNhbGNHYXYoKSByZXR1cm5zICh1aW50IGdhdikgewogICAgICAgIC8vIHByaWNlcyBxdW90ZWQgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogYXNzZXREZWNpbWFsCiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSB0ZW1wT3duZWRBc3NldHM7IC8vIFRvIHN0b3JlIG93bmVkQXNzZXRzCiAgICAgICAgdGVtcE93bmVkQXNzZXRzID0gb3duZWRBc3NldHM7CiAgICAgICAgZGVsZXRlIG93bmVkQXNzZXRzOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRlbXBPd25lZEFzc2V0cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBhZGRyZXNzIG9mQXNzZXQgPSB0ZW1wT3duZWRBc3NldHNbaV07CiAgICAgICAgICAgIC8vIGFzc2V0SG9sZGluZ3MgZm9ybWF0dGluZzogbXVsKGV4Y2hhbmdlSG9sZGluZ3MsIDEwICoqIGFzc2V0RGVjaW1hbCkKICAgICAgICAgICAgdWludCBhc3NldEhvbGRpbmdzID0gYWRkKAogICAgICAgICAgICAgICAgdWludChBc3NldEludGVyZmFjZShvZkFzc2V0KS5iYWxhbmNlT2YodGhpcykpLCAvLyBhc3NldCBiYXNlIHVuaXRzIGhlbGQgYnkgZnVuZAogICAgICAgICAgICAgICAgcXVhbnRpdHlIZWxkSW5DdXN0b2R5T2ZFeGNoYW5nZShvZkFzc2V0KQogICAgICAgICAgICApOwogICAgICAgICAgICAvLyBhc3NldFByaWNlIGZvcm1hdHRpbmc6IG11bChleGNoYW5nZVByaWNlLCAxMCAqKiBhc3NldERlY2ltYWwpCiAgICAgICAgICAgIHZhciAoaXNSZWNlbnQsIGFzc2V0UHJpY2UsIGFzc2V0RGVjaW1hbHMpID0gbW9kdWxlLnByaWNlZmVlZC5nZXRQcmljZShvZkFzc2V0KTsKICAgICAgICAgICAgaWYgKCFpc1JlY2VudCkgewogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZ2F2IGFzIHN1bSBvZiBtdWwoYXNzZXRIb2xkaW5ncywgYXNzZXRQcmljZSkgd2l0aCBmb3JtYXR0aW5nOiBtdWwobXVsKGV4Y2hhbmdlSG9sZGluZ3MsIGV4Y2hhbmdlUHJpY2UpLCAxMCAqKiBzaGFyZURlY2ltYWxzKQogICAgICAgICAgICBnYXYgPSBhZGQoZ2F2LCBtdWwoYXNzZXRIb2xkaW5ncywgYXNzZXRQcmljZSkgLyAoMTAgKiogdWludDI1Nihhc3NldERlY2ltYWxzKSkpOyAgIC8vIFN1bSB1cCBwcm9kdWN0IG9mIGFzc2V0IGhvbGRpbmdzIG9mIHRoaXMgdmF1bHQgYW5kIGFzc2V0IHByaWNlcwogICAgICAgICAgICBpZiAoYXNzZXRIb2xkaW5ncyAhPSAwIHx8IG9mQXNzZXQgPT0gYWRkcmVzcyhRVU9URV9BU1NFVCkgfHwgb2ZBc3NldCA9PSBhZGRyZXNzKE5BVElWRV9BU1NFVCkgfHwgaXNJbk9wZW5NYWtlT3JkZXJbb2ZBc3NldF0pIHsgLy8gQ2hlY2sgaWYgYXNzZXQgaG9sZGluZ3MgaXMgbm90IHplcm8gb3IgaXMgYWRkcmVzcyhRVU9URV9BU1NFVCkgb3IgaW4gb3BlbiBtYWtlIG9yZGVyCiAgICAgICAgICAgICAgICBvd25lZEFzc2V0cy5wdXNoKG9mQXNzZXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXNJbkFzc2V0TGlzdFtvZkFzc2V0XSA9IGZhbHNlOyAvLyBSZW1vdmUgZnJvbSBvd25lZEFzc2V0cyBpZiBhc3NldCBob2xkaW5ncyBhcmUgemVybwogICAgICAgICAgICB9CiAgICAgICAgICAgIFBvcnRmb2xpb0NvbnRlbnQoYXNzZXRIb2xkaW5ncywgYXNzZXRQcmljZSwgYXNzZXREZWNpbWFscyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBDYWxjdWxhdGVzIHVuY2xhaW1lZCBmZWVzIG9mIHRoZSBmdW5kIG1hbmFnZXIKICAgIEBwYXJhbSBnYXYgR3Jvc3MgYXNzZXQgdmFsdWUgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgQHJldHVybiB7CiAgICAgICJtYW5hZ2VtZW50RmVlcyI6ICJBIHRpbWUgKHNlY29uZHMpIGJhc2VkIGZlZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzIiwKICAgICAgInBlcmZvcm1hbmNlRmVlcyI6ICJBIHBlcmZvcm1hbmNlIChyaXNlIG9mIHNoYXJlUHJpY2UgbWVhc3VyZWQgaW4gUVVPVEVfQVNTRVQpIGJhc2VkIGZlZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzIiwKICAgICAgInVuY2xhaW1lZGZlZXMiOiAiVGhlIHN1bSBvZiBib3RoIG1hbmFnZW1lbnRmZWUgYW5kIHBlcmZvcm1hbmNlZmVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMiCiAgICB9CiAgICAqLwogICAgZnVuY3Rpb24gY2FsY1VuY2xhaW1lZEZlZXModWludCBnYXYpCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgICAgICB1aW50IG1hbmFnZW1lbnRGZWUsCiAgICAgICAgICAgIHVpbnQgcGVyZm9ybWFuY2VGZWUsCiAgICAgICAgICAgIHVpbnQgdW5jbGFpbWVkRmVlcykKICAgIHsKICAgICAgICAvLyBNYW5hZ2VtZW50IGZlZSBjYWxjdWxhdGlvbgogICAgICAgIHVpbnQgdGltZVBhc3NlZCA9IHN1Yihub3csIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24udGltZXN0YW1wKTsKICAgICAgICB1aW50IGdhdlBlcmNlbnRhZ2UgPSBtdWwodGltZVBhc3NlZCwgZ2F2KSAvICgxIHllYXJzKTsKICAgICAgICBtYW5hZ2VtZW50RmVlID0gd211bChnYXZQZXJjZW50YWdlLCBNQU5BR0VNRU5UX0ZFRV9SQVRFKTsKCiAgICAgICAgLy8gUGVyZm9ybWFuY2UgZmVlIGNhbGN1bGF0aW9uCiAgICAgICAgLy8gSGFuZGxlIHBvdGVudGlhbCBkaXZpc2lvbiB0aHJvdWdoIHplcm8gYnkgZGVmaW5pbmcgYSBkZWZhdWx0IHZhbHVlCiAgICAgICAgdWludCB2YWx1ZVBlclNoYXJlRXhjbE1nbXRGZWVzID0gdG90YWxTdXBwbHkgPiAwID8gY2FsY1ZhbHVlUGVyU2hhcmUoc3ViKGdhdiwgbWFuYWdlbWVudEZlZSksIHRvdGFsU3VwcGx5KSA6IHRvU21hbGxlc3RTaGFyZVVuaXQoMSk7CiAgICAgICAgaWYgKHZhbHVlUGVyU2hhcmVFeGNsTWdtdEZlZXMgPiBhdExhc3RVbmNsYWltZWRGZWVBbGxvY2F0aW9uLmhpZ2hXYXRlck1hcmspIHsKICAgICAgICAgICAgdWludCBnYWluSW5TaGFyZVByaWNlID0gc3ViKHZhbHVlUGVyU2hhcmVFeGNsTWdtdEZlZXMsIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24uaGlnaFdhdGVyTWFyayk7CiAgICAgICAgICAgIHVpbnQgaW52ZXN0bWVudFByb2ZpdHMgPSB3bXVsKGdhaW5JblNoYXJlUHJpY2UsIHRvdGFsU3VwcGx5KTsKICAgICAgICAgICAgcGVyZm9ybWFuY2VGZWUgPSB3bXVsKGludmVzdG1lbnRQcm9maXRzLCBQRVJGT1JNQU5DRV9GRUVfUkFURSk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdW0gb2YgYWxsIEZFRVMKICAgICAgICB1bmNsYWltZWRGZWVzID0gYWRkKG1hbmFnZW1lbnRGZWUsIHBlcmZvcm1hbmNlRmVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBOZXQgYXNzZXQgdmFsdWUgb2YgdGhpcyBmdW5kCiAgICAvLy8gQHBhcmFtIGdhdiBHcm9zcyBhc3NldCB2YWx1ZSBvZiB0aGlzIGZ1bmQgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgLy8vIEBwYXJhbSB1bmNsYWltZWRGZWVzIFRoZSBzdW0gb2YgYm90aCBtYW5hZ2VtZW50RmVlIGFuZCBwZXJmb3JtYW5jZUZlZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICAvLy8gQHJldHVybiBuYXYgTmV0IGFzc2V0IHZhbHVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIGZ1bmN0aW9uIGNhbGNOYXYodWludCBnYXYsIHVpbnQgdW5jbGFpbWVkRmVlcykKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCBuYXYpCiAgICB7CiAgICAgICAgbmF2ID0gc3ViKGdhdiwgdW5jbGFpbWVkRmVlcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlcyB0aGUgc2hhcmUgcHJpY2Ugb2YgdGhlIGZ1bmQKICAgIC8vLyBAZGV2IENvbnZlbnRpb24gZm9yIHZhbHVlUGVyU2hhcmUgKD09IHNoYXJlUHJpY2UpIGZvcm1hdHRpbmc6IG11bCh0b3RhbFZhbHVlIC8gbnVtU2hhcmVzLCAxMCAqKiBkZWNpbWFsKSwgdG8gYXZvaWQgZmxvYXRpbmcgbnVtYmVycwogICAgLy8vIEBkZXYgTm9uLXplcm8gc2hhcmUgc3VwcGx5OyB2YWx1ZSBkZW5vbWluYXRlZCBpbiBbYmFzZSB1bml0IG9mIG1lbG9uQXNzZXRdCiAgICAvLy8gQHBhcmFtIHRvdGFsVmFsdWUgdGhlIHRvdGFsIHZhbHVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIC8vLyBAcGFyYW0gbnVtU2hhcmVzIHRoZSBudW1iZXIgb2Ygc2hhcmVzIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgLy8vIEByZXR1cm4gdmFsdWVQZXJTaGFyZSBTaGFyZSBwcmljZSBkZW5vbWluYXRlZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICBmdW5jdGlvbiBjYWxjVmFsdWVQZXJTaGFyZSh1aW50IHRvdGFsVmFsdWUsIHVpbnQgbnVtU2hhcmVzKQogICAgICAgIHZpZXcKICAgICAgICBwcmVfY29uZChudW1TaGFyZXMgPiAwKQogICAgICAgIHJldHVybnMgKHVpbnQgdmFsdWVQZXJTaGFyZSkKICAgIHsKICAgICAgICB2YWx1ZVBlclNoYXJlID0gdG9TbWFsbGVzdFNoYXJlVW5pdCh0b3RhbFZhbHVlKSAvIG51bVNoYXJlczsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgQ2FsY3VsYXRlcyBlc3NlbnRpYWwgZnVuZCBtZXRyaWNzCiAgICBAcmV0dXJuIHsKICAgICAgImdhdiI6ICJHcm9zcyBhc3NldCB2YWx1ZSBvZiB0aGlzIGZ1bmQgZGVub21pbmF0ZWQgaW4gW2Jhc2UgdW5pdCBvZiBtZWxvbkFzc2V0XSIsCiAgICAgICJtYW5hZ2VtZW50RmVlIjogIkEgdGltZSAoc2Vjb25kcykgYmFzZWQgZmVlIiwKICAgICAgInBlcmZvcm1hbmNlRmVlIjogIkEgcGVyZm9ybWFuY2UgKHJpc2Ugb2Ygc2hhcmVQcmljZSBtZWFzdXJlZCBpbiBRVU9URV9BU1NFVCkgYmFzZWQgZmVlIiwKICAgICAgInVuY2xhaW1lZEZlZXMiOiAiVGhlIHN1bSBvZiBib3RoIG1hbmFnZW1lbnRGZWUgYW5kIHBlcmZvcm1hbmNlRmVlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0iLAogICAgICAiZmVlc1NoYXJlUXVhbnRpdHkiOiAiVGhlIG51bWJlciBvZiBzaGFyZXMgdG8gYmUgZ2l2ZW4gYXMgZmVlcyB0byB0aGUgbWFuYWdlciIsCiAgICAgICJuYXYiOiAiTmV0IGFzc2V0IHZhbHVlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0iLAogICAgICAic2hhcmVQcmljZSI6ICJTaGFyZSBwcmljZSBkZW5vbWluYXRlZCBpbiBbYmFzZSB1bml0IG9mIG1lbG9uQXNzZXRdIgogICAgfQogICAgKi8KICAgIGZ1bmN0aW9uIHBlcmZvcm1DYWxjdWxhdGlvbnMoKQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICAgICAgdWludCBnYXYsCiAgICAgICAgICAgIHVpbnQgbWFuYWdlbWVudEZlZSwKICAgICAgICAgICAgdWludCBwZXJmb3JtYW5jZUZlZSwKICAgICAgICAgICAgdWludCB1bmNsYWltZWRGZWVzLAogICAgICAgICAgICB1aW50IGZlZXNTaGFyZVF1YW50aXR5LAogICAgICAgICAgICB1aW50IG5hdiwKICAgICAgICAgICAgdWludCBzaGFyZVByaWNlCiAgICAgICAgKQogICAgewogICAgICAgIGdhdiA9IGNhbGNHYXYoKTsgLy8gUmVmbGVjdHMgdmFsdWUgaW5kZXBlbmRlbnQgb2YgZmVlcwogICAgICAgIChtYW5hZ2VtZW50RmVlLCBwZXJmb3JtYW5jZUZlZSwgdW5jbGFpbWVkRmVlcykgPSBjYWxjVW5jbGFpbWVkRmVlcyhnYXYpOwogICAgICAgIG5hdiA9IGNhbGNOYXYoZ2F2LCB1bmNsYWltZWRGZWVzKTsKCiAgICAgICAgLy8gVGhlIHZhbHVlIG9mIHVuY2xhaW1lZEZlZXMgbWVhc3VyZWQgaW4gc2hhcmVzIG9mIHRoaXMgZnVuZCBhdCBjdXJyZW50IHZhbHVlCiAgICAgICAgZmVlc1NoYXJlUXVhbnRpdHkgPSAoZ2F2ID09IDApID8gMCA6IG11bCh0b3RhbFN1cHBseSwgdW5jbGFpbWVkRmVlcykgLyBnYXY7CiAgICAgICAgLy8gVGhlIHRvdGFsIHNoYXJlIHN1cHBseSBpbmNsdWRpbmcgdGhlIHZhbHVlIG9mIHVuY2xhaW1lZEZlZXMsIG1lYXN1cmVkIGluIHNoYXJlcyBvZiB0aGlzIGZ1bmQKICAgICAgICB1aW50IHRvdGFsU3VwcGx5QWNjb3VudGluZ0ZvckZlZXMgPSBhZGQodG90YWxTdXBwbHksIGZlZXNTaGFyZVF1YW50aXR5KTsKICAgICAgICBzaGFyZVByaWNlID0gbmF2ID4gMCA/IGNhbGNWYWx1ZVBlclNoYXJlKG5hdiwgdG90YWxTdXBwbHlBY2NvdW50aW5nRm9yRmVlcykgOiB0b1NtYWxsZXN0U2hhcmVVbml0KDEpOyAvLyBIYW5kbGUgcG90ZW50aWFsIGRpdmlzaW9uIHRocm91Z2ggemVybyBieSBkZWZpbmluZyBhIGRlZmF1bHQgdmFsdWUKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDb252ZXJ0cyB1bmNsYWltZWQgZmVlcyBvZiB0aGUgbWFuYWdlciBpbnRvIGZ1bmQgc2hhcmVzCiAgICAvLy8gQGRldiBPbmx5IE93bmVyCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVVuY2xhaW1lZEZlZXMoKQogICAgICAgIHByZV9jb25kKGlzT3duZXIoKSkKICAgIHsKICAgICAgICB2YXIgKAogICAgICAgICAgICBnYXYsCiAgICAgICAgICAgIG1hbmFnZW1lbnRGZWUsCiAgICAgICAgICAgIHBlcmZvcm1hbmNlRmVlLAogICAgICAgICAgICB1bmNsYWltZWRGZWVzLAogICAgICAgICAgICBmZWVzU2hhcmVRdWFudGl0eSwKICAgICAgICAgICAgbmF2LAogICAgICAgICAgICBzaGFyZVByaWNlCiAgICAgICAgKSA9IHBlcmZvcm1DYWxjdWxhdGlvbnMoKTsKCiAgICAgICAgY3JlYXRlU2hhcmVzKG93bmVyLCBmZWVzU2hhcmVRdWFudGl0eSk7IC8vIFVwZGF0ZXMgdG90YWxTdXBwbHkgYnkgY3JlYXRpbmcgc2hhcmVzIGFsbG9jYXRlZCB0byBtYW5hZ2VyCgogICAgICAgIC8vIFVwZGF0ZSBDYWxjdWxhdGlvbnMKICAgICAgICB1aW50IGhpZ2hXYXRlck1hcmsgPSBhdExhc3RVbmNsYWltZWRGZWVBbGxvY2F0aW9uLmhpZ2hXYXRlck1hcmsgPj0gc2hhcmVQcmljZSA/IGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24uaGlnaFdhdGVyTWFyayA6IHNoYXJlUHJpY2U7CiAgICAgICAgYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbiA9IENhbGN1bGF0aW9ucyh7CiAgICAgICAgICAgIGdhdjogZ2F2LAogICAgICAgICAgICBtYW5hZ2VtZW50RmVlOiBtYW5hZ2VtZW50RmVlLAogICAgICAgICAgICBwZXJmb3JtYW5jZUZlZTogcGVyZm9ybWFuY2VGZWUsCiAgICAgICAgICAgIHVuY2xhaW1lZEZlZXM6IHVuY2xhaW1lZEZlZXMsCiAgICAgICAgICAgIG5hdjogbmF2LAogICAgICAgICAgICBoaWdoV2F0ZXJNYXJrOiBoaWdoV2F0ZXJNYXJrLAogICAgICAgICAgICB0b3RhbFN1cHBseTogdG90YWxTdXBwbHksCiAgICAgICAgICAgIHRpbWVzdGFtcDogbm93CiAgICAgICAgfSk7CgogICAgICAgIEZlZXNDb252ZXJ0ZWQobm93LCBmZWVzU2hhcmVRdWFudGl0eSwgdW5jbGFpbWVkRmVlcyk7CiAgICAgICAgQ2FsY3VsYXRpb25VcGRhdGUobm93LCBtYW5hZ2VtZW50RmVlLCBwZXJmb3JtYW5jZUZlZSwgbmF2LCBzaGFyZVByaWNlLCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgLy8gUFVCTElDIDogUkVERUVNSU5HCgogICAgLy8vIEBub3RpY2UgUmVkZWVtcyBieSBhbGxvY2F0aW5nIGFuIG93bmVyc2hpcCBwZXJjZW50YWdlIG9ubHkgb2YgcmVxdWVzdGVkQXNzZXRzIHRvIHRoZSBwYXJ0aWNpcGFudAogICAgLy8vIEBkZXYgSW5kZXBlbmRlbnQgb2YgcnVubmluZyBwcmljZSBmZWVkISBOb3RlOiBpZiByZXF1ZXN0ZWRBc3NldHMgIT0gb3duZWRBc3NldHMgdGhlbiBwYXJ0aWNpcGFudCBtaXNzZXMgb3V0IG9uIHNvbWUgb3duZWQgdmFsdWUKICAgIC8vLyBAcGFyYW0gc2hhcmVRdWFudGl0eSBOdW1iZXIgb2Ygc2hhcmVzIG93bmVkIGJ5IHRoZSBwYXJ0aWNpcGFudCwgd2hpY2ggdGhlIHBhcnRpY2lwYW50IHdvdWxkIGxpa2UgdG8gcmVkZWVtIGZvciBpbmRpdmlkdWFsIGFzc2V0cwogICAgLy8vIEBwYXJhbSByZXF1ZXN0ZWRBc3NldHMgTGlzdCBvZiBhZGRyZXNzZXMgdGhhdCBjb25zaXR1dGUgYSBzdWJzZXQgb2Ygb3duZWRBc3NldHMuCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIGFsbCBhc3NldHMgc2VudCB0byBzaGFyZWhvbGRlciBvciBub3QKICAgIGZ1bmN0aW9uIGVtZXJnZW5jeVJlZGVlbSh1aW50IHNoYXJlUXVhbnRpdHksIGFkZHJlc3NbXSByZXF1ZXN0ZWRBc3NldHMpCiAgICAgICAgcHVibGljCiAgICAgICAgcHJlX2NvbmQoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gc2hhcmVRdWFudGl0eSkgIC8vIHNlbmRlciBvd25zIGVub3VnaCBzaGFyZXMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnRbXSBtZW1vcnkgb3duZXJzaGlwUXVhbnRpdGllcyA9IG5ldyB1aW50W10ocmVxdWVzdGVkQXNzZXRzLmxlbmd0aCk7CgogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgZW5vdWdoIGFzc2V0cyBoZWxkIGJ5IGZ1bmQKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByZXF1ZXN0ZWRBc3NldHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgYWRkcmVzcyBvZkFzc2V0ID0gcmVxdWVzdGVkQXNzZXRzW2ldOwogICAgICAgICAgICB1aW50IGFzc2V0SG9sZGluZ3MgPSBhZGQoCiAgICAgICAgICAgICAgICB1aW50KEFzc2V0SW50ZXJmYWNlKG9mQXNzZXQpLmJhbGFuY2VPZih0aGlzKSksCiAgICAgICAgICAgICAgICBxdWFudGl0eUhlbGRJbkN1c3RvZHlPZkV4Y2hhbmdlKG9mQXNzZXQpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoYXNzZXRIb2xkaW5ncyA9PSAwKSBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIHBhcnRpY2lwYW50J3Mgb3duZXJzaGlwIHBlcmNlbnRhZ2Ugb2YgYXNzZXQgaG9sZGluZ3MKICAgICAgICAgICAgb3duZXJzaGlwUXVhbnRpdGllc1tpXSA9IG11bChhc3NldEhvbGRpbmdzLCBzaGFyZVF1YW50aXR5KSAvIHRvdGFsU3VwcGx5OwoKICAgICAgICAgICAgLy8gQ1JJVElDQUwgRVJSOiBOb3QgZW5vdWdoIGZ1bmQgYXNzZXQgYmFsYW5jZSBmb3Igb3dlZCBvd25lcnNoaXBRdWFudGl0aXksIGVnIGluIGNhc2Ugb2YgdW5yZXR1cm5lZCBhc3NldCBxdWFudGl0eSBhdCBhZGRyZXNzKGV4Y2hhbmdlc1tpXS5leGNoYW5nZSkgYWRkcmVzcwogICAgICAgICAgICBpZiAodWludChBc3NldEludGVyZmFjZShvZkFzc2V0KS5iYWxhbmNlT2YodGhpcykpIDwgb3duZXJzaGlwUXVhbnRpdGllc1tpXSkgewogICAgICAgICAgICAgICAgaXNTaHV0RG93biA9IHRydWU7CiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UoIkNSSVRJQ0FMIEVSUjogTm90IGVub3VnaCBhc3NldEhvbGRpbmdzIGZvciBvd2VkIG93bmVyc2hpcFF1YW50aXRpeSIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBBbm5paGlsYXRlIHNoYXJlcyBiZWZvcmUgZXh0ZXJuYWwgY2FsbHMgdG8gcHJldmVudCByZWVudHJhbmN5CiAgICAgICAgYW5uaWhpbGF0ZVNoYXJlcyhtc2cuc2VuZGVyLCBzaGFyZVF1YW50aXR5KTsKCiAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwUXVhbnRpdHkgb2YgQXNzZXRzCiAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgb3duZXJzaGlwUXVhbnRpdGllcy5sZW5ndGg7ICsraikgewogICAgICAgICAgICAvLyBGYWlsZWQgdG8gc2VuZCBvd2VkIG93bmVyc2hpcFF1YW50aXR5IGZyb20gZnVuZCB0byBwYXJ0aWNpcGFudAogICAgICAgICAgICBpZiAoIUFzc2V0SW50ZXJmYWNlKG9mQXNzZXQpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG93bmVyc2hpcFF1YW50aXRpZXNbal0pKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZWRlZW1lZChtc2cuc2VuZGVyLCBub3csIHNoYXJlUXVhbnRpdHkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFBVQkxJQyA6IEZFRVMKCiAgICAvLy8gQGRldiBRdWFudGl0eSBvZiBhc3NldCBoZWxkIGluIGV4Y2hhbmdlIGFjY29yZGluZyB0byBhc3NvY2lhdGVkIG9yZGVyIGlkCiAgICAvLy8gQHBhcmFtIG9mQXNzZXQgQWRkcmVzcyBvZiBhc3NldAogICAgLy8vIEByZXR1cm4gUXVhbnRpdHkgb2YgaW5wdXQgYXNzZXQgaGVsZCBpbiBleGNoYW5nZQogICAgZnVuY3Rpb24gcXVhbnRpdHlIZWxkSW5DdXN0b2R5T2ZFeGNoYW5nZShhZGRyZXNzIG9mQXNzZXQpIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHRvdGFsU2VsbFF1YW50aXR5OyAgICAgLy8gcXVhbnRpdHkgaW4gY3VzdG9keSBhY3Jvc3MgZXhjaGFuZ2VzCiAgICAgICAgdWludCB0b3RhbFNlbGxRdWFudGl0eUluQXBwcm92ZTsgLy8gcXVhbnRpdHkgb2YgYXNzZXQgaW4gYXBwcm92ZSAoYWxsb3dhbmNlKSBidXQgbm90IGN1c3RvZHkgb2YgZXhjaGFuZ2UKICAgICAgICBmb3IgKHVpbnQgaTsgaSA8IGV4Y2hhbmdlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbaV1bb2ZBc3NldF0gPT0gMCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIChzZWxsQXNzZXQsICwgc2VsbFF1YW50aXR5LCApID0gZXhjaGFuZ2VzW2ldLmV4Y2hhbmdlQWRhcHRlci5nZXRPcmRlcihleGNoYW5nZXNbaV0uZXhjaGFuZ2UsIGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2ldW29mQXNzZXRdKTsKICAgICAgICAgICAgaWYgKHNlbGxRdWFudGl0eSA9PSAwKSB7CiAgICAgICAgICAgICAgICBleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkc1tpXVtvZkFzc2V0XSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxTZWxsUXVhbnRpdHkgPSBhZGQodG90YWxTZWxsUXVhbnRpdHksIHNlbGxRdWFudGl0eSk7CiAgICAgICAgICAgIGlmIChleGNoYW5nZXNbaV0uaXNBcHByb3ZlT25seSkgewogICAgICAgICAgICAgICAgdG90YWxTZWxsUXVhbnRpdHlJbkFwcHJvdmUgKz0gc2VsbFF1YW50aXR5OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0b3RhbFNlbGxRdWFudGl0eSA9PSAwKSB7CiAgICAgICAgICAgIGlzSW5PcGVuTWFrZU9yZGVyW3NlbGxBc3NldF0gPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1Yih0b3RhbFNlbGxRdWFudGl0eSwgdG90YWxTZWxsUXVhbnRpdHlJbkFwcHJvdmUpOyAvLyBTaW5jZSBxdWFudGl0eSBpbiBhcHByb3ZlIGlzIG5vdCBhY3R1YWxseSBpbiBjdXN0b2R5CiAgICB9CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZXMgc2hhcmVQcmljZSBkZW5vbWluYXRlZCBpbiBbYmFzZSB1bml0IG9mIG1lbG9uQXNzZXRdCiAgICAvLy8gQHJldHVybiBzaGFyZVByaWNlIFNoYXJlIHByaWNlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0KICAgIGZ1bmN0aW9uIGNhbGNTaGFyZVByaWNlKCkgdmlldyByZXR1cm5zICh1aW50IHNoYXJlUHJpY2UpIHsKICAgICAgICAoLCAsICwgLCAsIHNoYXJlUHJpY2UpID0gcGVyZm9ybUNhbGN1bGF0aW9ucygpOwogICAgICAgIHJldHVybiBzaGFyZVByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1vZHVsZXMoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MsIGFkZHJlc3MsIGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhZGRyZXNzKG1vZHVsZS5wcmljZWZlZWQpLAogICAgICAgICAgICBhZGRyZXNzKG1vZHVsZS5jb21wbGlhbmNlKSwKICAgICAgICAgICAgYWRkcmVzcyhtb2R1bGUucmlza21nbXQpCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMYXN0T3JkZXJJZCgpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gb3JkZXJzLmxlbmd0aCAtIDE7IH0KICAgIGZ1bmN0aW9uIGdldExhc3RSZXF1ZXN0SWQoKSB2aWV3IHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIHJlcXVlc3RzLmxlbmd0aCAtIDE7IH0KICAgIGZ1bmN0aW9uIGdldE5hbWVIYXNoKCkgdmlldyByZXR1cm5zIChieXRlczMyKSB7IHJldHVybiBieXRlczMyKGtlY2NhazI1NihuYW1lKSk7IH0KICAgIGZ1bmN0aW9uIGdldE1hbmFnZXIoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsgcmV0dXJuIG93bmVyOyB9Cn0KCmludGVyZmFjZSBFeGNoYW5nZUludGVyZmFjZSB7CgogICAgLy8gRVZFTlRTCgogICAgZXZlbnQgT3JkZXJVcGRhdGVkKHVpbnQgaWQpOwoKICAgIC8vIE1FVEhPRFMKICAgIC8vIEVYVEVSTkFMIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBtYWtlT3JkZXIoCiAgICAgICAgYWRkcmVzcyBvbkV4Y2hhbmdlLAogICAgICAgIGFkZHJlc3Mgc2VsbEFzc2V0LAogICAgICAgIGFkZHJlc3MgYnV5QXNzZXQsCiAgICAgICAgdWludCBzZWxsUXVhbnRpdHksCiAgICAgICAgdWludCBidXlRdWFudGl0eQogICAgKSBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHRha2VPcmRlcihhZGRyZXNzIG9uRXhjaGFuZ2UsIHVpbnQgaWQsIHVpbnQgcXVhbnRpdHkpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoYWRkcmVzcyBvbkV4Y2hhbmdlLCB1aW50IGlkKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKCgogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVPbmx5KCkgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldExhc3RPcmRlcklkKGFkZHJlc3Mgb25FeGNoYW5nZSkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGlzQWN0aXZlKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldE93bmVyKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldE9yZGVyKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zIChhZGRyZXNzLCBhZGRyZXNzLCB1aW50LCB1aW50KTsKICAgIGZ1bmN0aW9uIGdldFRpbWVzdGFtcChhZGRyZXNzIG9uRXhjaGFuZ2UsIHVpbnQgaWQpIHZpZXcgcmV0dXJucyAodWludCk7Cgp9CgppbnRlcmZhY2UgUHJpY2VGZWVkSW50ZXJmYWNlIHsKCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBQcmljZVVwZGF0ZWQodWludCB0aW1lc3RhbXApOwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgZnVuY3Rpb24gdXBkYXRlKGFkZHJlc3NbXSBvZkFzc2V0cywgdWludFtdIG5ld1ByaWNlcyk7CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vIEdldCBhc3NldCBzcGVjaWZpYyBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0TmFtZShhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGdldFN5bWJvbChhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIC8vIEdldCBwcmljZSBmZWVkIG9wZXJhdGlvbiBzcGVjaWZpYyBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0UXVvdGVBc3NldCgpIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRJbnRlcnZhbCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRWYWxpZGl0eSgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRMYXN0VXBkYXRlSWQoKSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgLy8gR2V0IGFzc2V0IHNwZWNpZmljIGluZm9ybWF0aW9uIGFzIHVwZGF0ZWQgaW4gcHJpY2UgZmVlZAogICAgZnVuY3Rpb24gaGFzUmVjZW50UHJpY2UoYWRkcmVzcyBvZkFzc2V0KSB2aWV3IHJldHVybnMgKGJvb2wgaXNSZWNlbnQpOwogICAgZnVuY3Rpb24gaGFzUmVjZW50UHJpY2VzKGFkZHJlc3NbXSBvZkFzc2V0cykgdmlldyByZXR1cm5zIChib29sIGFyZVJlY2VudCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoYm9vbCBpc1JlY2VudCwgdWludCBwcmljZSwgdWludCBkZWNpbWFsKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlcyhhZGRyZXNzW10gb2ZBc3NldHMpIHZpZXcgcmV0dXJucyAoYm9vbCBhcmVSZWNlbnQsIHVpbnRbXSBwcmljZXMsIHVpbnRbXSBkZWNpbWFscyk7CiAgICBmdW5jdGlvbiBnZXRJbnZlcnRlZFByaWNlKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zIChib29sIGlzUmVjZW50LCB1aW50IGludmVydGVkUHJpY2UsIHVpbnQgZGVjaW1hbCk7CiAgICBmdW5jdGlvbiBnZXRSZWZlcmVuY2VQcmljZShhZGRyZXNzIG9mQmFzZSwgYWRkcmVzcyBvZlF1b3RlKSB2aWV3IHJldHVybnMgKGJvb2wgaXNSZWNlbnQsIHVpbnQgcmVmZXJlbmNlUHJpY2UsIHVpbnQgZGVjaW1hbCk7CiAgICBmdW5jdGlvbiBnZXRPcmRlclByaWNlKAogICAgICAgIGFkZHJlc3Mgc2VsbEFzc2V0LAogICAgICAgIGFkZHJlc3MgYnV5QXNzZXQsCiAgICAgICAgdWludCBzZWxsUXVhbnRpdHksCiAgICAgICAgdWludCBidXlRdWFudGl0eQogICAgKSB2aWV3IHJldHVybnMgKHVpbnQgb3JkZXJQcmljZSk7CiAgICBmdW5jdGlvbiBleGlzdHNQcmljZU9uQXNzZXRQYWlyKGFkZHJlc3Mgc2VsbEFzc2V0LCBhZGRyZXNzIGJ1eUFzc2V0KSB2aWV3IHJldHVybnMgKGJvb2wgaXNFeGlzdGVudCk7Cn0KCmludGVyZmFjZSBSaXNrTWdtdEludGVyZmFjZSB7CgogICAgLy8gTUVUSE9EUwogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiB0aGUgbWFrZU9yZGVyIHByaWNlIGlzIHJlYXNvbmFibGUgYW5kIG5vdCBtYW5pcHVsYXRpdmUKICAgIC8vLyBAcGFyYW0gb3JkZXJQcmljZSBQcmljZSBvZiBPcmRlcgogICAgLy8vIEBwYXJhbSByZWZlcmVuY2VQcmljZSBSZWZlcmVuY2UgcHJpY2Ugb2J0YWluZWQgdGhyb3VnaCBQcmljZUZlZWQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gc2VsbEFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlBc3NldCBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIGJvdWdodAogICAgLy8vIEBwYXJhbSBzZWxsUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2VsbEFzc2V0IHRvIGJlIHNvbGQKICAgIC8vLyBAcGFyYW0gYnV5UXVhbnRpdHkgUXVhbnRpdHkgb2YgYnV5QXNzZXQgdG8gYmUgYm91Z2h0CiAgICAvLy8gQHJldHVybiBJZiBtYWtlT3JkZXIgaXMgcGVybWl0dGVkCiAgICBmdW5jdGlvbiBpc01ha2VQZXJtaXR0ZWQoCiAgICAgICAgdWludCBvcmRlclByaWNlLAogICAgICAgIHVpbnQgcmVmZXJlbmNlUHJpY2UsCiAgICAgICAgYWRkcmVzcyBzZWxsQXNzZXQsCiAgICAgICAgYWRkcmVzcyBidXlBc3NldCwKICAgICAgICB1aW50IHNlbGxRdWFudGl0eSwKICAgICAgICB1aW50IGJ1eVF1YW50aXR5CiAgICApIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIGlmIHRoZSB0YWtlT3JkZXIgcHJpY2UgaXMgcmVhc29uYWJsZSBhbmQgbm90IG1hbmlwdWxhdGl2ZQogICAgLy8vIEBwYXJhbSBvcmRlclByaWNlIFByaWNlIG9mIE9yZGVyCiAgICAvLy8gQHBhcmFtIHJlZmVyZW5jZVByaWNlIFJlZmVyZW5jZSBwcmljZSBvYnRhaW5lZCB0aHJvdWdoIFByaWNlRmVlZCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBzZWxsQXNzZXQgQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBzb2xkCiAgICAvLy8gQHBhcmFtIGJ1eUFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgYm91Z2h0CiAgICAvLy8gQHBhcmFtIHNlbGxRdWFudGl0eSBRdWFudGl0eSBvZiBzZWxsQXNzZXQgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlRdWFudGl0eSBRdWFudGl0eSBvZiBidXlBc3NldCB0byBiZSBib3VnaHQKICAgIC8vLyBAcmV0dXJuIElmIHRha2VPcmRlciBpcyBwZXJtaXR0ZWQKICAgIGZ1bmN0aW9uIGlzVGFrZVBlcm1pdHRlZCgKICAgICAgICB1aW50IG9yZGVyUHJpY2UsCiAgICAgICAgdWludCByZWZlcmVuY2VQcmljZSwKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldCwKICAgICAgICBhZGRyZXNzIGJ1eUFzc2V0LAogICAgICAgIHVpbnQgc2VsbFF1YW50aXR5LAogICAgICAgIHVpbnQgYnV5UXVhbnRpdHkKICAgICkgdmlldyByZXR1cm5zIChib29sKTsKfQoKaW50ZXJmYWNlIFZlcnNpb25JbnRlcmZhY2UgewoKICAgIC8vIEVWRU5UUwoKICAgIGV2ZW50IEZ1bmRVcGRhdGVkKHVpbnQgaWQpOwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgZnVuY3Rpb24gc2h1dERvd24oKSBleHRlcm5hbDsKCiAgICBmdW5jdGlvbiBzZXR1cEZ1bmQoCiAgICAgICAgc3RyaW5nIG9mRnVuZE5hbWUsCiAgICAgICAgYWRkcmVzcyBvZlF1b3RlQXNzZXQsCiAgICAgICAgdWludCBvZk1hbmFnZW1lbnRGZWUsCiAgICAgICAgdWludCBvZlBlcmZvcm1hbmNlRmVlLAogICAgICAgIGFkZHJlc3Mgb2ZDb21wbGlhbmNlLAogICAgICAgIGFkZHJlc3Mgb2ZSaXNrTWdtdCwKICAgICAgICBhZGRyZXNzIG9mUHJpY2VGZWVkLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlcywKICAgICAgICBhZGRyZXNzW10gb2ZFeGNoYW5nZUFkYXB0ZXJzLAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcwogICAgKTsKICAgIGZ1bmN0aW9uIHNodXREb3duRnVuZChhZGRyZXNzIG9mRnVuZCk7CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGdldE5hdGl2ZUFzc2V0KCkgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldEZ1bmRCeUlkKHVpbnQgd2l0aElkKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gZ2V0TGFzdEZ1bmRJZCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRGdW5kQnlNYW5hZ2VyKGFkZHJlc3Mgb2ZNYW5hZ2VyKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gdGVybXNBbmRDb25kaXRpb25zQXJlU2lnbmVkKHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSB2aWV3IHJldHVybnMgKGJvb2wgc2lnbmVkKTsKCn0KCmNvbnRyYWN0IFZlcnNpb24gaXMgREJDLCBPd25lZCwgVmVyc2lvbkludGVyZmFjZSB7CiAgICAvLyBGSUVMRFMKCiAgICAvLyBDb25zdGFudCBmaWVsZHMKICAgIGJ5dGVzMzIgcHVibGljIGNvbnN0YW50IFRFUk1TX0FORF9DT05ESVRJT05TID0gMHg0NzE3MzI4NWE4ZDczNDFlNWU5NzJmYzY3NzI4NjM4NGY4MDJmOGVmNDJhNWVjNWYwM2JiZmEyNTRjYjAxZmFkOyAvLyBIYXNoZWQgdGVybXMgYW5kIGNvbmRpdGlvbnMgYXMgZGlzcGxheWVkIG9uIElQRlMuCiAgICAvLyBDb25zdHJ1Y3RvciBmaWVsZHMKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTl9OVU1CRVI7IC8vIFNlbVZlciBvZiBNZWxvbiBwcm90b2NvbCB2ZXJzaW9uCiAgICBhZGRyZXNzIHB1YmxpYyBOQVRJVkVfQVNTRVQ7IC8vIEFkZHJlc3Mgb2Ygd3JhcHBlZCBuYXRpdmUgYXNzZXQgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIEdPVkVSTkFOQ0U7IC8vIEFkZHJlc3Mgb2YgTWVsb24gcHJvdG9jb2wgZ292ZXJuYW5jZSBjb250cmFjdAogICAgLy8gTWV0aG9kcyBmaWVsZHMKICAgIGJvb2wgcHVibGljIGlzU2h1dERvd247IC8vIEdvdmVybmFuY2UgZmVhdHVyZSwgaWYgeWVzIHRoYW4gc2V0dXBGdW5kIGdldHMgYmxvY2tlZCBhbmQgc2h1dERvd25GdW5kIGdldHMgb3BlbmVkCiAgICBhZGRyZXNzW10gcHVibGljIGxpc3RPZkZ1bmRzOyAvLyBBIGNvbXBsZXRlIGxpc3Qgb2YgZnVuZCBhZGRyZXNzZXMgY3JlYXRlZCB1c2luZyB0aGlzIHZlcnNpb24KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYWRkcmVzcykgcHVibGljIG1hbmFnZXJUb0Z1bmRzOyAvLyBMaW5rcyBtYW5hZ2VyIGFkZHJlc3MgdG8gZnVuZCBhZGRyZXNzIGNyZWF0ZWQgdXNpbmcgdGhpcyB2ZXJzaW9uCgogICAgLy8gRVZFTlRTCgogICAgZXZlbnQgRnVuZFVwZGF0ZWQoYWRkcmVzcyBvZkZ1bmQpOwoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAcGFyYW0gdmVyc2lvbk51bWJlciBTZW1WZXIgb2YgTWVsb24gcHJvdG9jb2wgdmVyc2lvbgogICAgLy8vIEBwYXJhbSBvZkdvdmVybmFuY2UgQWRkcmVzcyBvZiBNZWxvbiBnb3Zlcm5hbmNlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIG9mTmF0aXZlQXNzZXQgQWRkcmVzcyBvZiB3cmFwcGVkIG5hdGl2ZSBhc3NldCBjb250cmFjdAogICAgZnVuY3Rpb24gVmVyc2lvbigKICAgICAgICBzdHJpbmcgdmVyc2lvbk51bWJlciwKICAgICAgICBhZGRyZXNzIG9mR292ZXJuYW5jZSwKICAgICAgICBhZGRyZXNzIG9mTmF0aXZlQXNzZXQKICAgICkgewogICAgICAgIFZFUlNJT05fTlVNQkVSID0gdmVyc2lvbk51bWJlcjsKICAgICAgICBHT1ZFUk5BTkNFID0gb2ZHb3Zlcm5hbmNlOwogICAgICAgIE5BVElWRV9BU1NFVCA9IG9mTmF0aXZlQXNzZXQ7CiAgICB9CgogICAgLy8gRVhURVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIHNodXREb3duKCkgZXh0ZXJuYWwgcHJlX2NvbmQobXNnLnNlbmRlciA9PSBHT1ZFUk5BTkNFKSB7IGlzU2h1dERvd24gPSB0cnVlOyB9CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICAvLy8gQHBhcmFtIG9mRnVuZE5hbWUgaHVtYW4tcmVhZGFibGUgZGVzY3JpcHRpdmUgbmFtZSAobm90IG5lY2Vzc2FyaWx5IHVuaXF1ZSkKICAgIC8vLyBAcGFyYW0gb2ZRdW90ZUFzc2V0IEFzc2V0IGFnYWluc3Qgd2hpY2ggcGVyZm9ybWFuY2UgZmVlIGlzIG1lYXN1cmVkIGFnYWluc3QKICAgIC8vLyBAcGFyYW0gb2ZNYW5hZ2VtZW50RmVlIEEgdGltZSBiYXNlZCBmZWUsIGdpdmVuIGluIGEgbnVtYmVyIHdoaWNoIGlzIGRpdmlkZWQgYnkgMTAgKiogMTUKICAgIC8vLyBAcGFyYW0gb2ZQZXJmb3JtYW5jZUZlZSBBIHRpbWUgcGVyZm9ybWFuY2UgYmFzZWQgZmVlLCBwZXJmb3JtYW5jZSByZWxhdGl2ZSB0byBvZlF1b3RlQXNzZXQsIGdpdmVuIGluIGEgbnVtYmVyIHdoaWNoIGlzIGRpdmlkZWQgYnkgMTAgKiogMTUKICAgIC8vLyBAcGFyYW0gb2ZDb21wbGlhbmNlIEFkZHJlc3Mgb2YgcGFydGljaXBhdGlvbiBtb2R1bGUKICAgIC8vLyBAcGFyYW0gb2ZSaXNrTWdtdCBBZGRyZXNzIG9mIHJpc2sgbWFuYWdlbWVudCBtb2R1bGUKICAgIC8vLyBAcGFyYW0gb2ZQcmljZUZlZWQgQWRkcmVzcyBvZiBwcmljZSBmZWVkIG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZkV4Y2hhbmdlcyBBZGRyZXNzZXMgb2YgZXhjaGFuZ2Ugb24gd2hpY2ggdGhpcyBmdW5kIGNhbiB0cmFkZQogICAgLy8vIEBwYXJhbSBvZkV4Y2hhbmdlQWRhcHRlcnMgQWRkcmVzc2VzIG9mIGV4Y2hhbmdlIGFkYXB0ZXJzCiAgICAvLy8gQHBhcmFtIHYgZWxsaXBpdGMgY3VydmUgcGFyYW1ldGVyIHYKICAgIC8vLyBAcGFyYW0gciBlbGxpcGl0YyBjdXJ2ZSBwYXJhbWV0ZXIgcgogICAgLy8vIEBwYXJhbSBzIGVsbGlwaXRjIGN1cnZlIHBhcmFtZXRlciBzCiAgICBmdW5jdGlvbiBzZXR1cEZ1bmQoCiAgICAgICAgc3RyaW5nIG9mRnVuZE5hbWUsCiAgICAgICAgYWRkcmVzcyBvZlF1b3RlQXNzZXQsCiAgICAgICAgdWludCBvZk1hbmFnZW1lbnRGZWUsCiAgICAgICAgdWludCBvZlBlcmZvcm1hbmNlRmVlLAogICAgICAgIGFkZHJlc3Mgb2ZDb21wbGlhbmNlLAogICAgICAgIGFkZHJlc3Mgb2ZSaXNrTWdtdCwKICAgICAgICBhZGRyZXNzIG9mUHJpY2VGZWVkLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlcywKICAgICAgICBhZGRyZXNzW10gb2ZFeGNoYW5nZUFkYXB0ZXJzLAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcwogICAgKSB7CiAgICAgICAgcmVxdWlyZSghaXNTaHV0RG93bik7CiAgICAgICAgcmVxdWlyZSh0ZXJtc0FuZENvbmRpdGlvbnNBcmVTaWduZWQodiwgciwgcykpOwogICAgICAgIC8vIEVpdGhlciBub3ZlbCBmdW5kIG5hbWUgb3IgcHJldmlvdXMgb3duZXIgb2YgZnVuZCBuYW1lCiAgICAgICAgcmVxdWlyZShtYW5hZ2VyVG9GdW5kc1ttc2cuc2VuZGVyXSA9PSAwKTsgLy8gQWRkIGxpbWl0YXRpb24gZm9yIHNpbXBsZXIgbWlncmF0aW9uIHByb2Nlc3Mgb2Ygc2h1dHRpbmcgZG93biBhbmQgc2V0dGluZyB1cCBmdW5kCiAgICAgICAgYWRkcmVzcyBvZkZ1bmQgPSBuZXcgRnVuZCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgb2ZGdW5kTmFtZSwKICAgICAgICAgICAgb2ZRdW90ZUFzc2V0LAogICAgICAgICAgICBvZk1hbmFnZW1lbnRGZWUsCiAgICAgICAgICAgIG9mUGVyZm9ybWFuY2VGZWUsCiAgICAgICAgICAgIE5BVElWRV9BU1NFVCwKICAgICAgICAgICAgb2ZDb21wbGlhbmNlLAogICAgICAgICAgICBvZlJpc2tNZ210LAogICAgICAgICAgICBvZlByaWNlRmVlZCwKICAgICAgICAgICAgb2ZFeGNoYW5nZXMsCiAgICAgICAgICAgIG9mRXhjaGFuZ2VBZGFwdGVycwogICAgICAgICk7CiAgICAgICAgbGlzdE9mRnVuZHMucHVzaChvZkZ1bmQpOwogICAgICAgIG1hbmFnZXJUb0Z1bmRzW21zZy5zZW5kZXJdID0gb2ZGdW5kOwogICAgICAgIEZ1bmRVcGRhdGVkKG9mRnVuZCk7CiAgICB9CgogICAgLy8vIEBkZXYgRGVyZWZlcmVuY2UgRnVuZCBhbmQgdHJpZ2dlciBzZWxmZGVzdHJ1Y3QKICAgIC8vLyBAcGFyYW0gb2ZGdW5kIEFkZHJlc3Mgb2YgdGhlIGZ1bmQgdG8gYmUgc2h1dCBkb3duCiAgICBmdW5jdGlvbiBzaHV0RG93bkZ1bmQoYWRkcmVzcyBvZkZ1bmQpCiAgICAgICAgcHJlX2NvbmQoaXNTaHV0RG93biB8fCBtYW5hZ2VyVG9GdW5kc1ttc2cuc2VuZGVyXSA9PSBvZkZ1bmQpCiAgICB7CiAgICAgICAgRnVuZCBmdW5kID0gRnVuZChvZkZ1bmQpOwogICAgICAgIGRlbGV0ZSBtYW5hZ2VyVG9GdW5kc1ttc2cuc2VuZGVyXTsKICAgICAgICBmdW5kLnNodXREb3duKCk7CiAgICAgICAgRnVuZFVwZGF0ZWQob2ZGdW5kKTsKICAgIH0KCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgLy8vIEBkZXYgUHJvb2YgdGhhdCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBoYXZlIGJlZW4gcmVhZCBhbmQgdW5kZXJzdG9vZAogICAgLy8vIEBwYXJhbSB2IGVsbGlwaXRjIGN1cnZlIHBhcmFtZXRlciB2CiAgICAvLy8gQHBhcmFtIHIgZWxsaXBpdGMgY3VydmUgcGFyYW1ldGVyIHIKICAgIC8vLyBAcGFyYW0gcyBlbGxpcGl0YyBjdXJ2ZSBwYXJhbWV0ZXIgcwogICAgLy8vIEByZXR1cm4gc2lnbmVkIFdoZXRoZXIgb3Igbm90IHRlcm1zIGFuZCBjb25kaXRpb25zIGhhdmUgYmVlbiByZWFkIGFuZCB1bmRlcnN0b29kCiAgICBmdW5jdGlvbiB0ZXJtc0FuZENvbmRpdGlvbnNBcmVTaWduZWQodWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHZpZXcgcmV0dXJucyAoYm9vbCBzaWduZWQpIHsKICAgICAgICByZXR1cm4gZWNyZWNvdmVyKAogICAgICAgICAgICAvLyBQYXJpdHkgZG9lcyBwcmVwZW5kIFx4MTlFdGhlcmV1bSBTaWduZWQgTWVzc2FnZTpcbntsZW4obWVzc2FnZSl9IGJlZm9yZSBzaWduaW5nLgogICAgICAgICAgICAvLyAgU2lnbmF0dXJlIG9yZGVyIGhhcyBhbHNvIGJlZW4gY2hhbmdlZCBpbiAxLjYuNyBhbmQgdXBjb21pbmcgMS43LngsCiAgICAgICAgICAgIC8vICBpdCB3aWxsIHJldHVybiByc3YgKHNhbWUgYXMgZ2V0aDsgd2hlcmUgdiBpcyBbMjcsIDI4XSkuCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBpZiB5b3UgYXJlIHVzaW5nIGVjcmVjb3ZlciwgdiB3aWxsIGJlIGVpdGhlciAiMDAiIG9yICIwMSIuCiAgICAgICAgICAgIC8vICBBcyBhIHJlc3VsdCwgaW4gb3JkZXIgdG8gdXNlIHRoaXMgdmFsdWUsIHlvdSB3aWxsIGhhdmUgdG8gcGFyc2UgaXQgdG8gYW4KICAgICAgICAgICAgLy8gIGludGVnZXIgYW5kIHRoZW4gYWRkIDI3LiBUaGlzIHdpbGwgcmVzdWx0IGluIGVpdGhlciBhIDI3IG9yIGEgMjguCiAgICAgICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vd2lraS93aWtpL0phdmFTY3JpcHQtQVBJI3dlYjNldGhzaWduCiAgICAgICAgICAgIGtlY2NhazI1NigiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBURVJNU19BTkRfQ09ORElUSU9OUyksCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMKICAgICAgICApID09IG1zZy5zZW5kZXI7IC8vIEhhcyBzZW5kZXIgc2lnbmVkIFRFUk1TX0FORF9DT05ESVRJT05TCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TmF0aXZlQXNzZXQoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsgcmV0dXJuIE5BVElWRV9BU1NFVDsgfQogICAgZnVuY3Rpb24gZ2V0RnVuZEJ5SWQodWludCB3aXRoSWQpIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gbGlzdE9mRnVuZHNbd2l0aElkXTsgfQogICAgZnVuY3Rpb24gZ2V0TGFzdEZ1bmRJZCgpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gbGlzdE9mRnVuZHMubGVuZ3RoIC0gMTsgfQogICAgZnVuY3Rpb24gZ2V0RnVuZEJ5TWFuYWdlcihhZGRyZXNzIG9mTWFuYWdlcikgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBtYW5hZ2VyVG9GdW5kc1tvZk1hbmFnZXJdOyB9Cn0='.
	

]
