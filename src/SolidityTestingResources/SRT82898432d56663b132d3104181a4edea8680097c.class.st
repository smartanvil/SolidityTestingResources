Class {
	#name : #SRT82898432d56663b132d3104181a4edea8680097c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT82898432d56663b132d3104181a4edea8680097c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7IC8vCgovLyBNb2JTcXVhZHMyLmlvCi8vIFRoZSBFbmQgb2YgdGhlIEJlZ2lubmluZwoKY29udHJhY3QgRVJDNzIxIHsKICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIGFkZHIpOwogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYzsKCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB0b2tlbklkKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgLy8gT3B0aW9uYWwKICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogIC8vIGZ1bmN0aW9uIHRva2VuT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG9rZW5JZCk7CiAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7Cn0KCmNvbnRyYWN0IE1vYlNxdWFkczIgaXMgRVJDNzIxIHsKCiAgLyoqKiBFVkVOVFMgKioqLwoKICAvLy8gQGRldiBUaGUgQmlydGggZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBuZXcgbW9ic3RlciBjb21lcyBpbnRvIGV4aXN0ZW5jZS4KICBldmVudCBCaXJ0aCh1aW50MjU2IHRva2VuSWQsIHN0cmluZyBuYW1lLCBhZGRyZXNzIG93bmVyKTsKCiAgLy8vIEBkZXYgVGhlIFRva2VuU29sZCBldmVudCBpcyBmaXJlZCB3aGVuZXZlciBhIHRva2VuIGlzIHNvbGQuCiAgZXZlbnQgVG9rZW5Tb2xkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBvbGRQcmljZSwgdWludDI1NiBuZXdQcmljZSwgYWRkcmVzcyBwcmV2T3duZXIsIGFkZHJlc3Mgd2lubmVyKTsKCiAgLy8vIEBkZXYgVHJhbnNmZXIgZXZlbnQgYXMgZGVmaW5lZCBpbiBjdXJyZW50IGRyYWZ0IG9mIEVSQzcyMS4KICAvLy8gIG93bmVyc2hpcCBpcyBhc3NpZ25lZCwgaW5jbHVkaW5nIGJpcnRocy4KICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogIC8qKiogQ09OU1RBTlRTICoqKi8KCiAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgTkFNRSA9ICJNb2JTcXVhZHMyIjsgLy8KICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFNZTUJPTCA9ICJNT0JTMiI7IC8vCgogIHVpbnQyNTYgcHVibGljIHByZWNpc2lvbiA9IDEwMDAwMDAwMDAwMDA7IC8vMC4wMDAwMDEgRXRoCgogIHVpbnQyNTYgcHVibGljIGhpdFByaWNlID0gIDAuMDEwIGV0aGVyOwoKICB1aW50MjU2IHB1YmxpYyBzZXRQcmljZUZlZSA9IDAuMDIgZXRoZXI7IC8vIG11c3QgYmUgYSBjb3N0IHRvIHNldCB5b3VyIG93biBwcmljZS4KICB1aW50MjU2IHB1YmxpYyBzZXRQcmljZUNvb2xpbmdQZXJpb2QgPSA1IG1pbnV0ZXM7IC8vIHlvdSBjYW4ndCBzZXQgcHJpY2UgdW50aWwgNSBtaW51dGVzIGFmdGVyIGJ1eWluZwoKICAvKioqIFNUT1JBR0UgKioqLwoKICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBtb2JzdGVyIElEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4gQWxsIG1vYnN0ZXJzIGhhdmUKICAvLy8gIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcy4KICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBtb2JzdGVySW5kZXhUb093bmVyOwoKICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG93bmVyIGFkZHJlc3MgdG8gY291bnQgb2YgdG9rZW5zIHRoYXQgYWRkcmVzcyBvd25zLgogIC8vICBVc2VkIGludGVybmFsbHkgaW5zaWRlIGJhbGFuY2VPZigpIHRvIHJlc29sdmUgb3duZXJzaGlwIGNvdW50LgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHJpdmF0ZSBvd25lcnNoaXBUb2tlbkNvdW50OwoKICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBtb2JzdGVycyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogIC8vLyAgdHJhbnNmZXJGcm9tKCkuIEVhY2ggbW9ic3RlciBjYW4gb25seSBoYXZlIG9uZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0cmFuc2ZlcgogIC8vLyAgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBtb2JzdGVySW5kZXhUb0FwcHJvdmVkOwoKICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG1vYnN0ZXJzIHRvIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4uCiAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwcml2YXRlIG1vYnN0ZXJJbmRleFRvUHJpY2U7CgogIC8vIFRoZSBhZGRyZXNzZXMgb2YgdGhlIGFjY291bnRzIChvciBjb250cmFjdHMpIHRoYXQgY2FuIGV4ZWN1dGUgYWN0aW9ucyB3aXRoaW4gZWFjaCByb2xlcy4KICBhZGRyZXNzIHB1YmxpYyBjZW9BZGRyZXNzOwogIGFkZHJlc3MgcHVibGljIGNvb0FkZHJlc3M7CgogIC8vIHNhbGUgc3RhcnRlZAogIGJvb2wgcHVibGljIHNhbGVTdGFydGVkID0gZmFsc2U7CgogIC8qKiogREFUQVRZUEVTICoqKi8KICBzdHJ1Y3QgTW9ic3RlciB7CiAgICB1aW50MjU2IGlkOyAvLyBuZWVkZWQgZm9yIGduYXJseSBmcm9udCBlbmQKICAgIHN0cmluZyBuYW1lOwogICAgdWludDI1NiBib3NzOyAvLyB3aGljaCBnYW5nIG1lbWJlciBvZgogICAgdWludDI1NiBzdGF0ZTsgLy8gMCA9IG5vcm1hbCAsIDEgPSBkYXplZAogICAgdWludDI1NiBkYXplZEV4aXByeVRpbWU7IC8vIGlmIHRoaXMgbW9ic3RlciB3YXMgZGlzYXJtZWQsIHdoZW4gZG9lcyBpdCBleHBpcmUKICAgIHVpbnQyNTYgYnV5UHJpY2U7IC8vIHRoZSBwcmljZSBhdCB3aGljaCB0aGlzIG1vYnN0ZXIgd2FzIGJvdWdodAogICAgdWludDI1NiBzdGFydGluZ1ByaWNlOyAvLyBwcmljZSB0aHJvdWdoIHdoaWNoIG5vIGRlZmxhdGlvbiBjYW4gZ28KICAgIHVpbnQyNTYgYnV5VGltZTsKICAgIHVpbnQyNTYgbGV2ZWw7CiAgICBzdHJpbmcgc2hvdzsKICAgIGJvb2wgaGFzV2hhY2tlZDsKICB9CgogIE1vYnN0ZXJbXSBwcml2YXRlIG1vYnN0ZXJzOwogIHVpbnQyNTYgcHVibGljIGxlYWRpbmdHYW5nOwogIHVpbnQyNTYgcHVibGljIGxlYWRpbmdIaXRDb3VudDsKICB1aW50MjU2W10gcHVibGljIGdhbmdIaXRzOyAgLy8gbnVtYmVyIG9mIGhpdHMgYSBnYW5nIGhhcyBkb25lCiAgdWludDI1NltdIHB1YmxpYyBnYW5nQmFkZ2VzOyAgLy8gbnVtYmVyIG9mIHdoYWNraW5nIGJhZGdlcyBhIGdhbmcgaGFzCiAgdWludDI1NiBwdWJsaWMgY3VycmVudEhpdFRvdGFsID0gMDsgLy8KICB1aW50MjU2IHB1YmxpYyBsZXRoYWxCb251c0F0SGl0c0xlYWQgPSAxMDsgLy8gd2hhbiBhIHNxdWFkIHRha2VzIHRoZSBsZWFkIGJ5IHRoaXMgbXVjaCB0aGV5IHdpbiB0aGUgYm9udXMKICB1aW50MjU2IHB1YmxpYyB3aGFja2luZ1Bvb2w7CgoKICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG1vYnN0ZXJzIHRvIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4uCiAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwcml2YXRlIGJvc3NJbmRleFRvR2FuZzsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbW9ic3RlckJhbGFuY2VzOwoKCiAgLyoqKiBBQ0NFU1MgTU9ESUZJRVJTICoqKi8KICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENFTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICBtb2RpZmllciBvbmx5Q0VPKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MpOwogICAgXzsKICB9CgogIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ09PLW9ubHkgZnVuY3Rpb25hbGl0eQogIG1vZGlmaWVyIG9ubHlDT08oKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyk7CiAgICBfOwogIH0KCiAgLy8vIEFjY2VzcyBtb2RpZmllciBmb3IgY29udHJhY3Qgb3duZXIgb25seSBmdW5jdGlvbmFsaXR5CiAgbW9kaWZpZXIgb25seUNMZXZlbCgpIHsKICAgIHJlcXVpcmUoCiAgICAgIG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyB8fAogICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MKICAgICk7CiAgICBfOwogIH0KCiAgLyoqKiBDT05TVFJVQ1RPUiAqKiovCiAgZnVuY3Rpb24gTW9iU3F1YWRzMigpIHB1YmxpYyB7CiAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgbGVhZGluZ0hpdENvdW50ID0gMDsKICAgICBnYW5nSGl0cy5sZW5ndGgrKzsKICAgICBnYW5nQmFkZ2VzLmxlbmd0aCsrOwogIC8vICBfY3JlYXRlTW9ic3RlcigiVGhlIEdvZGZhdGhlciIsYWRkcmVzcyh0aGlzKSwyMDAwMDAwMDAwMDAwMDAwLDApOwogIH0KCiAgLyoqKiBQVUJMSUMgRlVOQ1RJT05TICoqKi8KICAvLy8gQG5vdGljZSBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIHRva2VuIHZpYSB0YWtlT3duZXJzaGlwKCkgYW5kIHRyYW5zZmVyRnJvbSgpLgogIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogIC8vLyAgY2xlYXIgYWxsIGFwcHJvdmFscy4KICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgZnVuY3Rpb24gYXBwcm92ZSgKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdG9rZW5JZAogICkgcHVibGljIHsKICAgIC8vIENhbGxlciBtdXN0IG93biB0b2tlbi4KICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICBtb2JzdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF90bzsKCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICB9CgogIC8vLyBGb3IgcXVlcnlpbmcgYmFsYW5jZSBvZiBhIHBhcnRpY3VsYXIgYWNjb3VudAogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZvciBiYWxhbmNlIHF1ZXJ5CiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICB9CgogIC8vLyBAZGV2IENyZWF0ZXMgYSBuZXcgbW9ic3RlciB3aXRoIHRoZSBnaXZlbiBuYW1lLgogIGZ1bmN0aW9uIGNyZWF0ZU1vYnN0ZXIoc3RyaW5nIF9uYW1lLCB1aW50MjU2IF9zdGFydFByaWNlLCB1aW50MjU2IF9ib3NzLCB1aW50MjU2IF9sZXZlbCwgc3RyaW5nIF9zaG93KSBwdWJsaWMgb25seUNMZXZlbCB7CiAgICBfY3JlYXRlTW9ic3RlcihfbmFtZSwgYWRkcmVzcyh0aGlzKSwgX3N0YXJ0UHJpY2UsX2Jvc3MsIF9sZXZlbCwgX3Nob3cpOwogIH0KCiAgLy8vIEBkZXYgQ3JlYXRlcyBhIG5ldyBtb2JzdGVyIHdpdGggdGhlIGdpdmVuIG5hbWUuCiAgZnVuY3Rpb24gY3JlYXRlTW9ic3RlcldpdGhPd25lcihzdHJpbmcgX25hbWUsIGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9zdGFydFByaWNlLCB1aW50MjU2IF9ib3NzLCB1aW50MjU2IF9sZXZlbCwgc3RyaW5nIF9zaG93KSBwdWJsaWMgb25seUNMZXZlbCB7CiAgICBhZGRyZXNzIGZpcnN0T3duZXIgPSBfb3duZXI7CiAgICBpZiAoX293bmVyPT0wIHx8IF9vd25lcj09IGFkZHJlc3MoMCkpewogICAgICBmaXJzdE93bmVyID0gIGFkZHJlc3ModGhpcyk7CiAgICB9CiAgICBfY3JlYXRlTW9ic3RlcihfbmFtZSxmaXJzdE93bmVyLCBfc3RhcnRQcmljZSxfYm9zcywgX2xldmVsLCBfc2hvdyk7CiAgfQoKICAvLy8gQG5vdGljZSBSZXR1cm5zIGFsbCB0aGUgcmVsZXZhbnQgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZpYyBtb2JzdGVyLgogIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIHRva2VuSWQgb2YgdGhlIG1vYnN0ZXIgb2YgaW50ZXJlc3QuCiAgZnVuY3Rpb24gZ2V0TW9ic3Rlcih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICgKICAgIHVpbnQyNTYgaWQsCiAgICBzdHJpbmcgbmFtZSwKICAgIHVpbnQyNTYgYm9zcywKICAgIHVpbnQyNTYgc2VsbGluZ1ByaWNlLAogICAgYWRkcmVzcyBvd25lciwKICAgIHVpbnQyNTYgc3RhdGUsCiAgICB1aW50MjU2IGRhemVkRXhpcHJ5VGltZSwKICAgIHVpbnQyNTYgbmV4dFByaWNlLAogICAgdWludDI1NiBsZXZlbCwKICAgIGJvb2wgY2FuU2V0UHJpY2UsCiAgICBzdHJpbmcgc2hvdywKICAgIGJvb2wgaGFzV2hhY2tlZAogICkgewogICAgaWQgPSBfdG9rZW5JZDsKICAgIE1vYnN0ZXIgc3RvcmFnZSBtb2JzdGVyID0gbW9ic3RlcnNbX3Rva2VuSWRdOwogICAgbmFtZSA9IG1vYnN0ZXIubmFtZTsKICAgIGJvc3MgPSBtb2JzdGVyLmJvc3M7CiAgICBzZWxsaW5nUHJpY2UgPXByaWNlT2YoX3Rva2VuSWQpOwogICAgb3duZXIgPSBtb2JzdGVySW5kZXhUb093bmVyW190b2tlbklkXTsKICAgIHN0YXRlID0gbW9ic3Rlci5zdGF0ZTsKICAgIGlmIChtb2JzdGVyLnN0YXRlPT0xICYmIG5vdz5tb2JzdGVyLmRhemVkRXhpcHJ5VGltZSl7CiAgICAgICAgc3RhdGU9MDsgLy8gdGltZSBleHBpcmVkIHNvIHNheSB0aGV5IGFyZSBhcm1lZAogICAgfQogICAgZGF6ZWRFeGlwcnlUaW1lPW1vYnN0ZXIuZGF6ZWRFeGlwcnlUaW1lOwogICAgbmV4dFByaWNlPWNhbGN1bGF0ZU5ld1ByaWNlKF90b2tlbklkKTsKICAgIGxldmVsPW1vYnN0ZXIubGV2ZWw7CiAgICBjYW5TZXRQcmljZT0obW9ic3Rlci5idXlUaW1lICsgc2V0UHJpY2VDb29saW5nUGVyaW9kKTxub3c7CiAgICBzaG93PW1vYnN0ZXIuc2hvdzsKICAgIGhhc1doYWNrZWQ9bW9ic3Rlci5oYXNXaGFja2VkOwogIH0KCgogIGZ1bmN0aW9uIGxldGhhbEJvbnVzQXRIaXRzTGVhZCAodWludDI1NiBfY291bnQpIHB1YmxpYyBvbmx5Q0xldmVsIHsKICAgIGxldGhhbEJvbnVzQXRIaXRzTGVhZCA9IF9jb3VudDsKICB9CgogIGZ1bmN0aW9uIHN0YXJ0U2FsZSAoKSBwdWJsaWMgb25seUNMZXZlbCB7CiAgICBzYWxlU3RhcnRlZCA9IHRydWU7IC8vIG5vIGdvaW5nIGJhY2sKICB9CgogIGZ1bmN0aW9uIHNldEhpdFByaWNlICh1aW50MjU2IF9wcmljZSkgcHVibGljIG9ubHlDTGV2ZWwgewogICAgaGl0UHJpY2UgPSBfcHJpY2U7CiAgfQoKICAvLy8gaGl0IGEgbW9ic3RlcgogIGZ1bmN0aW9uIGhpdE1vYnN0ZXIodWludDI1NiBfdmljdGltICAsIHVpbnQyNTYgX2hpdHRlcikgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCl7CiAgICBhZGRyZXNzIG1vYnN0ZXJPd25lciA9IG1vYnN0ZXJJbmRleFRvT3duZXJbX3ZpY3RpbV07CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gbW9ic3Rlck93bmVyKTsgLy8gaXQgZG9lc24ndCBtYWtlIHNlbnNlLCBidXQgaGV5CiAgICByZXF1aXJlKG1zZy5zZW5kZXI9PW1vYnN0ZXJJbmRleFRvT3duZXJbX2hpdHRlcl0pOyAvLyB0aGV5IG11c3QgYmUgYSBoaXR0ZXIgb3duZXIKICAgIHJlcXVpcmUoc2FsZVN0YXJ0ZWQ9PXRydWUpOwoKICAgIC8vIEdvZGZhdGhlciBjYW5ub3QgYmUgaGl0LCBib3NzZXMgY2Fubm90IGJlIGhpdAogICAgaWYgKG1zZy52YWx1ZT49aGl0UHJpY2UgJiYgX3ZpY3RpbSE9MCAmJiBfaGl0dGVyIT0wICYmIG1vYnN0ZXJzW192aWN0aW1dLmxldmVsPjEpewogICAgICAgIC8vIGhpdCBtb2JzdGVyCiAgICAgICAgbW9ic3RlcnNbX3ZpY3RpbV0uc3RhdGU9MTsKICAgICAgICBtb2JzdGVyc1tfdmljdGltXS5kYXplZEV4aXByeVRpbWUgPSBub3cgKyAoMiAqIDEgbWludXRlcyk7CgogICAgICAgIGlmKG1vYnN0ZXJzW192aWN0aW1dLmhhc1doYWNrZWQ9PXRydWUpewogICAgICAgICAgbW9ic3RlcnNbX3ZpY3RpbV0uaGFzV2hhY2tlZD1mYWxzZTsgLy8gaW5qdXJ5IHJlbW92ZXMgeW91ciB3aGFja2luZyBiYWRnZSwgeW91IGhhdmUgdG8gd2hhY2sgYWdhaW4hCiAgICAgICAgICBnYW5nQmFkZ2VzW1NhZmVNYXRoLmRpdihtb2JzdGVyc1tfdmljdGltXS5ib3NzLDE2KSsxXSsrOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBnYW5nTnVtYmVyPVNhZmVNYXRoLmRpdihtb2JzdGVyc1tfaGl0dGVyXS5ib3NzLDE2KSsxOwoKICAgICAgICBnYW5nSGl0c1tnYW5nTnVtYmVyXSsrOyAvLyBpbmNyZWFzZSB0aGUgaGl0IGNvdW50IGZvciB0aGlzIGdhbmcKICAgICAgICBjdXJyZW50SGl0VG90YWwrKzsKICAgICAgICB3aGFja2luZ1Bvb2wrPWhpdFByaWNlOwoKICAgICAgICBpZihtb2JzdGVyc1tfaGl0dGVyXS5oYXNXaGFja2VkPT1mYWxzZSl7CiAgICAgICAgICBtb2JzdGVyc1tfaGl0dGVyXS5oYXNXaGFja2VkPXRydWU7CiAgICAgICAgICBnYW5nQmFkZ2VzW2dhbmdOdW1iZXJdKys7CiAgICAgICAgfQoKICAgICAgICBpZiAgKGdhbmdIaXRzW2dhbmdOdW1iZXJdPmxlYWRpbmdIaXRDb3VudCl7CiAgICAgICAgICAgIGxlYWRpbmdIaXRDb3VudD1nYW5nSGl0c1tnYW5nTnVtYmVyXTsKICAgICAgICAgICAgbGVhZGluZ0dhbmc9Z2FuZ051bWJlcjsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGlzIGxlYWQgaXMgbm93IGluc3VybW91bnRhYmxlIGFuZCB0aGUgY291bnQgPjIwCiAgICAgICAgYm9vbCBsZXRoYWxCb251c1RpbWUgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQyNTYgZyA9IDAgOyBnPGdhbmdIaXRzLmxlbmd0aDtnKyspewogICAgICAgICAgaWYgKGxlYWRpbmdIaXRDb3VudC1nYW5nSGl0c1tnXT5sZXRoYWxCb251c0F0SGl0c0xlYWQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBsZXRoYWxCb251c1RpbWU9dHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgIC8vIFdoYWNraW5nIEJvbnVzCiAgICAgaWYgKGxldGhhbEJvbnVzVGltZSl7CiAgICAgICB1aW50MjU2IGxldGhhbEJvbnVzID0gU2FmZU1hdGgubXVsKFNhZmVNYXRoLmRpdih3aGFja2luZ1Bvb2wsMTIwKSxTYWZlTWF0aC5kaXYoMTAwLGdhbmdCYWRnZXNbbGVhZGluZ0dhbmddKzEpKTsKCiAgICAgICAgIC8vIGVhY2ggb2YgdGhlIDE2IG1lbWJlcnMgb2YgdGhlIGdhbmcgd2l0aCB0aGUgbW9zdCBoaXRzIHJlY2VpdmVzIGFuIGVxdWFsIHNoYXJlIG9mIHRoZSBwb29sCiAgICAgICAgIC8vIEdGIGFsc28gcmVjZWl2ZXMgaGlzIHNoYXJlCiAgICAgICAgIHVpbnQyNTYgd2lubmluZ01vYnN0ZXJJbmRleCAgPSAoMTYqKGxlYWRpbmdHYW5nLTEpKSsxOyAvLyBpbmNsdWRlIHRoZSBib3NzCgogICAgICAgICBmb3IgKHVpbnQyNTYgeCA9IDE7eDx0b3RhbFN1cHBseSgpO3grKyl7CiAgICAgICAgICAgICBpZiAoeD49d2lubmluZ01vYnN0ZXJJbmRleCAmJiB4PDE2K3dpbm5pbmdNb2JzdGVySW5kZXggJiYgbW9ic3RlcnNbeF0uaGFzV2hhY2tlZD09dHJ1ZSl7CiAgICAgICAgICAgICAgICBtb2JzdGVyQmFsYW5jZXNbIG1vYnN0ZXJJbmRleFRvT3duZXJbeF1dKz1sZXRoYWxCb251czsgLy8gYXZhaWxhYmxlIGZvciB3aXRoZHJhd2FsCiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBtb2JzdGVyc1t4XS5oYXNXaGFja2VkPWZhbHNlOyAvLyByZXNldCB0aGlzIGZvciBhbGwKICAgICAgICAgfQoKICAgICAgICAgLy8gR29kZmF0aGVyIGFsd2F5cyBnZXQncyBoaXMgc2hhcmUKICAgICAgICAgaWYgKG1vYnN0ZXJJbmRleFRvT3duZXJbMF0hPWFkZHJlc3ModGhpcykpewogICAgICAgICAgICAgICBtb2JzdGVyQmFsYW5jZXNbbW9ic3RlckluZGV4VG9Pd25lclswXV0rPWxldGhhbEJvbnVzOyAvLyBhdmFpbGFibGUgZm9yIHdpdGhkcmF3YWwKICAgICAgICAgfQoKICAgICAgICAgY3VycmVudEhpdFRvdGFsPTA7IC8vIHJlc2V0IHRoZSBjb3VudGVyCiAgICAgICAgIHdoYWNraW5nUG9vbD0wOyAvLyByZXNldCB0aGlzCgogICAgICAgICAvLyBuZWVkIHRvIHJlc2V0IHRoZSBnYW5nSGl0cwogICAgICAgICBmb3IgKHVpbnQyNTYgeSA9IDAgOyB5PGdhbmdIaXRzLmxlbmd0aDt5KyspewogICAgICAgICAgIGdhbmdIaXRzW3ldPTA7IC8vIHJlc2V0IGhpdCBjb3VudGVycwogICAgICAgICAgIGdhbmdCYWRnZXNbeV09MDsgLy8gcmVtb3ZlIGFsbCBiYWdkZXMKICAgICAgICAgICBsZWFkaW5nSGl0Q291bnQ9MDsKICAgICAgICAgICBsZWFkaW5nR2FuZz0wOwogICAgICAgICB9CgogICAgIH0gLy8gZW5kIGlmIGJvbnVzIHRpbWUKCgogICB9IC8vIGVuZCBpZiB0aGlzIGlzIGEgaGl0Cgp9CgoKICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiBOQU1FOwogIH0KCiAgLy8vIEZvciBxdWVyeWluZyBvd25lciBvZiB0b2tlbgogIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIHRva2VuSUQgZm9yIG93bmVyIGlucXVpcnkKICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICB7CiAgICBvd25lciA9IG1vYnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdOwogICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICB9CgoKICAvLyBBbGxvd3Mgc29tZW9uZSB0byBzZW5kIGV0aGVyIGFuZCBvYnRhaW4gdGhlIHRva2VuCiAgZnVuY3Rpb24gcHVyY2hhc2UodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHBheWFibGUgewogICAgYWRkcmVzcyBvbGRPd25lciA9IG1vYnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdOwoKICAgIHVpbnQyNTYgc2VsbGluZ1ByaWNlID0gcHJpY2VPZihfdG9rZW5JZCk7CgogICAgLy8gbm8gc2FsZXMgdW50aWwgd2UgaGF2ZSBzdGFydGVkCiAgICByZXF1aXJlKHNhbGVTdGFydGVkPT10cnVlKTsKCiAgICAvLyBNYWtpbmcgc3VyZSB0b2tlbiBvd25lciBpcyBub3Qgc2VuZGluZyB0byBzZWxmCiAgICByZXF1aXJlKG9sZE93bmVyICE9IG1zZy5zZW5kZXIpOwoKICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgIHJlcXVpcmUoX2FkZHJlc3NOb3ROdWxsKG1zZy5zZW5kZXIpKTsKCiAgICAvLyBNYWtpbmcgc3VyZSBzZW50IGFtb3VudCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHNlbGxpbmdQcmljZQogICAgcmVxdWlyZShtc2cudmFsdWUgPj0gc2VsbGluZ1ByaWNlKTsKCgovLyBHb2RmYXRoZXIgd2hlbiBzb2xkIHdpbGwgcmFpc2UgYnkgMTclICgxMCUgcHJldmlvdXMgb3duZXIgLCAzLjUlIHRvIGNvbnRyYWN0LCAzLDUlIHRvIHBvb2wgZm9yIG1vYnN0ZXJzKQovLyBCb3NzZXMgd2hlbiBzb2xkIHdpbGwgcmFpc2UgYnkgMTclICgxMCUgcHJldmlvdXMgb3duZXIgLCAzLjUlIHRvIGNvbnRyYWN0ICwgMy41JSB0byBHb2RmYXRoZXIgb3duZXIpCi8vIE1vYnN0ZXJzIHdoZW4gc29sZCB3aWxsIHJhaXNlIGJ5IDIyJSAoMTAlIHByZXZpb3VzIG93bmVyLCAzLjUlIHRvIEdvZGZhdGhlciwgMy41JSB0byBjb250cmFjdCwgNSUgdG8gdGhlaXIgYm9zcyBvd25lcikKLy8gRGVhbGVycyB3aGVuIHNvbGQgd2lsbCByYWlzZSBieSA0MCUgKDE4JSBwcmV2aW91cyBvd25lciwgMy41JSB0byBHb2RmYXRoZXIsIDMuNSUgdG8gY29udHJhY3QsIDUlIHRvIHRoZWlyIG1vYnN0ZXIgLCAzJSB0byBzcXVhZCBib3NzICwgNyUgd2hhY2tpbmcgcG9vbCkKCiAgICB1aW50MjU2IGNvbnRyYWN0RmVlID0gcm91bmRJdCh1aW50MjU2KFNhZmVNYXRoLm11bChTYWZlTWF0aC5kaXYobW9ic3RlcnNbX3Rva2VuSWRdLmJ1eVByaWNlLDEwMDApLDM1KSkpOyAvLyAzLjUlCiAgICB1aW50MjU2IHByZXZpb3VzT3duZXJQYXlvdXQgPSAwOwoKICAgICAvLyBnb2RmYXRoZXIgaXMgZmxpcHBlZCBmZWUgZ29lcyBpbnRvIHdoYWNraW5nIHBvb2wKICAgIGlmIChfdG9rZW5JZD09MCl7CiAgICAgIHdoYWNraW5nUG9vbCs9IGNvbnRyYWN0RmVlOwogICAgfQoKCiAgICAvLyBnb2RmYXRoZXIgYW5kIGNvbnRyYWN0IHJlY2VpdmUgMy41JSBvZiBhbGwgc2FsZXMKICAgIHVpbnQyNTYgZ29kRmF0aGVyRmVlID0gMDsKICAgIGlmIChfdG9rZW5JZCE9MCl7CiAgICAgICAgZ29kRmF0aGVyRmVlID0gY29udHJhY3RGZWU7IC8vIDMuNSUKICAgIH0KCiAgICB1aW50MjU2IHN1cGVyaW9yRmVlID0gMDsKCiAgICAvLyBtb2JzdGVyIG9yIGRlYWxlciAtIHNvIHRoZWlyIHN1cGVyaW9yIGdldCdzIDUlCiAgICBpZiAobW9ic3RlcnNbX3Rva2VuSWRdLmxldmVsPT0yIHx8IG1vYnN0ZXJzW190b2tlbklkXS5sZXZlbD09Myl7CiAgICAgICAgc3VwZXJpb3JGZWUgPSAgcm91bmRJdCh1aW50MjU2KFNhZmVNYXRoLmRpdihtb2JzdGVyc1tfdG9rZW5JZF0uYnV5UHJpY2UsMjApKSk7IC8vIDUlIGdvZXMgdG8gc3VwZXJpb3IKICAgIH0KCiAgICAvLyBkZWFsZXIgc28gNyUgdG8gd2hhY2tpbmcgcG9vbCAsIDMlIHRvIGJvc3NlcyBib3NzIChtb2JzdGVyLS0+Qm9zcykgLCAxOCUgcHJldmlvdXMgb3duZXIKICAgIGlmIChtb2JzdGVyc1tfdG9rZW5JZF0ubGV2ZWw9PTMpewogICAgICAgIHdoYWNraW5nUG9vbCs9IFNhZmVNYXRoLm11bChTYWZlTWF0aC5kaXYobW9ic3RlcnNbX3Rva2VuSWRdLmJ1eVByaWNlLCAxMDApLCA3KTsgLy8gNyUgdG8gd2hhY2tpbmdwb29sCiAgICAgICAgcHJldmlvdXNPd25lclBheW91dCA9IHJvdW5kSXQoU2FmZU1hdGgubXVsKFNhZmVNYXRoLmRpdihtb2JzdGVyc1tfdG9rZW5JZF0uYnV5UHJpY2UsIDEwMCksIDExOCkpOyAvLyAxMTglIHRvIHByZXZpb3VzIG93bmVyCiAgICAgICAgdWludDI1NiBib3NzRmVlID0gcm91bmRJdChTYWZlTWF0aC5tdWwoU2FmZU1hdGguZGl2KG1vYnN0ZXJzW190b2tlbklkXS5idXlQcmljZSwgMTAwKSwgMykpOyAvLyAzJSB0byBzcXVhZCBib3NzCiAgICAgICAgYWRkcmVzcyBib3NzQWRkcmVzcyA9IG1vYnN0ZXJJbmRleFRvT3duZXJbbW9ic3RlcnNbbW9ic3RlcnNbX3Rva2VuSWRdLmJvc3NdLmJvc3NdOyAvLyBib3NzZXMgYm9zcwogICAgICAgIGlmIChib3NzQWRkcmVzcyE9YWRkcmVzcyh0aGlzKSl7CiAgICAgICAgICAgIGJvc3NBZGRyZXNzLnRyYW5zZmVyKGJvc3NGZWUpOwogICAgICAgIH0KICB9ZWxzZXsKICAgICAgICAvLyBvdGhlcndpc2UgMTAlIHByZXZpb3VzIG93bmVyCiAgICAgICAgcHJldmlvdXNPd25lclBheW91dCA9IHJvdW5kSXQoU2FmZU1hdGgubXVsKFNhZmVNYXRoLmRpdihtb2JzdGVyc1tfdG9rZW5JZF0uYnV5UHJpY2UsIDEwMCksIDExMCkpOyAvLyAxMTAlIHRvIHByZXZpb3VzIG93bmVyCiAgICB9CgogICAgLy8gcGF5IHRoZSBnb2RmYXRoZXIgaWYgbm90IG93bmVkIGJ5IGNvbnRyYWN0IGFuZCBub3Qgc2VsbGluZyBHRgogICAgaWYgKG1vYnN0ZXJJbmRleFRvT3duZXJbMF0hPWFkZHJlc3ModGhpcykgJiYgX3Rva2VuSWQhPTApewogICAgICAgIG1vYnN0ZXJJbmRleFRvT3duZXJbMF0udHJhbnNmZXIoZ29kRmF0aGVyRmVlKTsKICAgIH0KCiAgICAgLy8gcGF5IHRoZSBzdXBlcmlvckZlZSBpZiBub3Qgb3duZWQgYnkgdGhlIGNvbnRyYWN0CiAgICBpZiAoX3Rva2VuSWQhPTAgJiYgc3VwZXJpb3JGZWU+MCAmJiBtb2JzdGVySW5kZXhUb093bmVyW21vYnN0ZXJzW190b2tlbklkXS5ib3NzXSE9YWRkcmVzcyh0aGlzKSl7CiAgICAgICAgbW9ic3RlckluZGV4VG9Pd25lclttb2JzdGVyc1tfdG9rZW5JZF0uYm9zc10udHJhbnNmZXIoc3VwZXJpb3JGZWUpOwogICAgfQoKCiAgICAgbW9ic3RlckluZGV4VG9QcmljZVtfdG9rZW5JZF0gID0gY2FsY3VsYXRlTmV3UHJpY2UoX3Rva2VuSWQpOwogICAgIG1vYnN0ZXJzW190b2tlbklkXS5zdGF0ZT0wOwogICAgIG1vYnN0ZXJzW190b2tlbklkXS5idXlQcmljZT1zZWxsaW5nUHJpY2U7CiAgICAgbW9ic3RlcnNbX3Rva2VuSWRdLmJ1eVRpbWUgPSBub3c7CgogICAgX3RyYW5zZmVyKG9sZE93bmVyLCBtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CgogICAgLy8gUGF5IHByZXZpb3VzIHRva2VuT3duZXIgaWYgb3duZXIgaXMgbm90IGNvbnRyYWN0CiAgICBpZiAob2xkT3duZXIgIT0gYWRkcmVzcyh0aGlzKSkgewogICAgICBvbGRPd25lci50cmFuc2ZlcihwcmV2aW91c093bmVyUGF5b3V0KTsgCiAgICB9CgogICAgVG9rZW5Tb2xkKF90b2tlbklkLCBzZWxsaW5nUHJpY2UsIG1vYnN0ZXJJbmRleFRvUHJpY2VbX3Rva2VuSWRdLCBvbGRPd25lciwgbXNnLnNlbmRlcik7CgogICAgaWYoU2FmZU1hdGguc3ViKG1zZy52YWx1ZSwgc2VsbGluZ1ByaWNlKT4wKXsKICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoU2FmZU1hdGguc3ViKG1zZy52YWx1ZSwgc2VsbGluZ1ByaWNlKSk7IC8vIHJldHVybiBhbnkgYWRkaXRpb25hbCBhbW91bnQKICAgIH0KCiAgfQoKICBmdW5jdGlvbiBwcmljZU9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcHJpY2UpIHsKICAgIHJldHVybiBtb2JzdGVySW5kZXhUb1ByaWNlW190b2tlbklkXTsKICB9CgoKICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgIHJldHVybiBhID4gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbmV4dFByaWNlKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgblByaWNlKSB7CiAgICByZXR1cm4gY2FsY3VsYXRlTmV3UHJpY2UoX3Rva2VuSWQpOwogIH0KCiAgLy8gYWxsb3dzIGFuIG93bmVyIHRvIHNldCB0aGVpciBvd24gcHJpY2UgYW5kIGtlZXAgdGhlIGZlZSBzdHJ1Y3R1cmUKICBmdW5jdGlvbiBzZXRUb2tlblByaWNlKHVpbnQyNTYgX3Rva2VuSWQgLCB1aW50MjU2IF9uZXdTZWxsUHJpY2UpIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUoc2FsZVN0YXJ0ZWQ9PXRydWUpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyPT1tb2JzdGVySW5kZXhUb093bmVyW190b2tlbklkXSk7IC8vIHRoZXkgbXVzdCBvd24gdGhpcyBtb2JiaWUgYW5kIG5vdCBhbHJlYWR5IGJlIGRlZmxhdGluZwogICAgcmVxdWlyZShtc2cudmFsdWU+PXNldFByaWNlRmVlKTsgLy8gdGhleSBtdXN0IG93biB0aGlzIG1vYmJpZSBhbmQgbm90IGFscmVhZHkgYmUgZGVmbGF0aW5nCiAgICByZXF1aXJlKChtb2JzdGVyc1tfdG9rZW5JZF0uYnV5VGltZSArIHNldFByaWNlQ29vbGluZ1BlcmlvZCk8bm93KTsgLy8gbm8gc2V0dGluZyB0aGlzIHVudGlsIHNvbWUgNSBtaW51dGVzIGFmdGVyCgogICAgLy8gcnVsZXMgZm9yIHNldHRpbmcgb3duIHByaWNlLgogICAgLy8gYnV5IHByaWNlIGJlY29tZXMgIndvdWxkIGhhdmUgYmVlbiIgYnV5IHByaWNlIHNvIGNvbnRyYWN0IHJ1bGVzIGFiaWRlCiAgICAvLyBHRiBvciBib3NzZXMgaGF2ZSBzZWxsIHByaWNlID09MTE3JSBvZiBidXkgcHJpY2UKICAgIGlmIChfdG9rZW5JZD09MCB8fCBtb2JzdGVyc1tfdG9rZW5JZF0ubGV2ZWw9PTEpewogICAgICAgICAgbW9ic3RlcnNbX3Rva2VuSWRdLmJ1eVByaWNlID0gcm91bmRJdChTYWZlTWF0aC5tdWwoU2FmZU1hdGguZGl2KF9uZXdTZWxsUHJpY2UsIDExNyksIDEwMCkpOwogICAgfQogICAgLy8gbGV2ZWwgMgogICAgLy8gbW9ic3RlcnMgaGF2ZSBzZWxsIHByaWNlID09MTIyJSBvZiBidXkgcHJpY2UKICAgaWYgKG1vYnN0ZXJzW190b2tlbklkXS5sZXZlbD09Mil7CiAgICAgbW9ic3RlcnNbX3Rva2VuSWRdLmJ1eVByaWNlID0gcm91bmRJdChTYWZlTWF0aC5tdWwoU2FmZU1hdGguZGl2KF9uZXdTZWxsUHJpY2UsIDEyMiksIDEwMCkpOwogICAgfQogICAgLy8gbGV2ZWwgMwogICAgLy8gRGVhbHJzIGhhdmUgc2VsbCBwcmljZSA9PTE0MCUgb2YgYnV5IHByaWNlCiAgIGlmIChtb2JzdGVyc1tfdG9rZW5JZF0ubGV2ZWw9PTMpewogICAgIG1vYnN0ZXJzW190b2tlbklkXS5idXlQcmljZSA9IHJvdW5kSXQoU2FmZU1hdGgubXVsKFNhZmVNYXRoLmRpdihfbmV3U2VsbFByaWNlLCAxNDApLCAxMDApKTsKICAgIH0KCiAgICBtb2JzdGVySW5kZXhUb1ByaWNlW190b2tlbklkXT1fbmV3U2VsbFByaWNlOwogIH0KCgogICAgZnVuY3Rpb24gY2xhaW1Nb2JzdGVyRnVuZHMoKSBwdWJsaWMgewogICAgICBpZiAobW9ic3RlckJhbGFuY2VzW21zZy5zZW5kZXJdPT0wKSByZXZlcnQoKTsKICAgICAgdWludDI1NiBhbW91bnQgPSBtb2JzdGVyQmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgIGlmIChhbW91bnQ+MCl7CiAgICAgICAgbW9ic3RlckJhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgIH0KICAgIH0KCgogZnVuY3Rpb24gY2FsY3VsYXRlTmV3UHJpY2UodWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IHByaWNlKXsKICAgdWludDI1NiBzZWxsaW5nUHJpY2UgPSBwcmljZU9mKF90b2tlbklkKTsKICAgdWludDI1NiBuZXdQcmljZTsKCiAgIC8vIGxldmVsIDAKICAgLy8gR29kZmF0aGVyIHdoZW4gc29sZCB3aWxsIHJhaXNlIGJ5IDE3JQogICBpZiAoX3Rva2VuSWQ9PTApewogICAgICAgICBuZXdQcmljZSA9IHJvdW5kSXQoU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChzZWxsaW5nUHJpY2UsIDExNyksIDEwMCkpOwogICB9CiAgIC8vIGxldmVsIDEKICAgIC8vQm9zc2VzIHdoZW4gc29sZCB3aWxsIHJhaXNlIGJ5IDE3JQogIGlmIChtb2JzdGVyc1tfdG9rZW5JZF0ubGV2ZWw9PTEgKXsKICAgICAgICBuZXdQcmljZSA9IHJvdW5kSXQoU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChzZWxsaW5nUHJpY2UsIDExNyksIDEwMCkpOwogICB9CiAgIC8vIGxldmVsIDIKICAgLy8gTW9ic3RlcnMgd2hlbiBzb2xkIHdpbGwgcmFpc2UgYnkgMjIlCiAgaWYgKG1vYnN0ZXJzW190b2tlbklkXS5sZXZlbD09Mil7CiAgICAgICAgbmV3UHJpY2U9IHJvdW5kSXQoU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChzZWxsaW5nUHJpY2UsIDEyMiksIDEwMCkpOwogICB9CiAgIC8vIGxldmVsIDMKICAgLy8gRGVhbGVycyB3aWxsIHJhaXNlIGJ5IDQwJQogIGlmIChtb2JzdGVyc1tfdG9rZW5JZF0ubGV2ZWw9PTMpewogICAgICAgIG5ld1ByaWNlPSByb3VuZEl0KFNhZmVNYXRoLmRpdihTYWZlTWF0aC5tdWwoc2VsbGluZ1ByaWNlLCAxNDApLCAxMDApKTsKICAgfQoKICAgcmV0dXJuIG5ld1ByaWNlOwogfQoKICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDRU8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENFTy4KICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBwdWJsaWMgb25seUNFTyB7CiAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CgogICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgfQoKICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDT08uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENPTy4KICAvLy8gQHBhcmFtIF9uZXdDT08gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICBmdW5jdGlvbiBzZXRDT08oYWRkcmVzcyBfbmV3Q09PKSBwdWJsaWMgb25seUNFTyB7CiAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgfQoKICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIFNZTUJPTDsKICB9CgogIC8vLyBAbm90aWNlIEFsbG93IHByZS1hcHByb3ZlZCB1c2VyIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgdG9rZW4KICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgYWRkcmVzcyBuZXdPd25lciA9IG1zZy5zZW5kZXI7CiAgICBhZGRyZXNzIG9sZE93bmVyID0gbW9ic3RlckluZGV4VG9Pd25lcltfdG9rZW5JZF07CgogICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgcmVxdWlyZShfYWRkcmVzc05vdE51bGwobmV3T3duZXIpKTsKCiAgICAvLyBNYWtpbmcgc3VyZSB0cmFuc2ZlciBpcyBhcHByb3ZlZAogICAgcmVxdWlyZShfYXBwcm92ZWQobmV3T3duZXIsIF90b2tlbklkKSk7CgogICAgX3RyYW5zZmVyKG9sZE93bmVyLCBuZXdPd25lciwgX3Rva2VuSWQpOwogIH0KCiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIHRva2VucyB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4KICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgfSBlbHNlIHsKICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwogICAgICB1aW50MjU2IHRvdGFsbW9ic3RlcnMgPSB0b3RhbFN1cHBseSgpOwogICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgIHVpbnQyNTYgbW9ic3RlcklkOwogICAgICBmb3IgKG1vYnN0ZXJJZCA9IDA7IG1vYnN0ZXJJZCA8PSB0b3RhbG1vYnN0ZXJzOyBtb2JzdGVySWQrKykgewogICAgICAgIGlmIChtb2JzdGVySW5kZXhUb093bmVyW21vYnN0ZXJJZF0gPT0gX293bmVyKSB7CiAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gbW9ic3RlcklkOwogICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9CgogIC8vLyBGb3IgcXVlcnlpbmcgdG90YWxTdXBwbHkgb2YgdG9rZW4KICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCkgewogICAgcmV0dXJuIG1vYnN0ZXJzLmxlbmd0aDsKICB9CgogIC8vLyBPd25lciBpbml0YXRlcyB0aGUgdHJhbnNmZXIgb2YgdGhlIHRva2VuIHRvIGFub3RoZXIgYWNjb3VudAogIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQgdG8uCiAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIFRva2VuIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgYWRkcmVzcyBfdG8sCiAgICB1aW50MjU2IF90b2tlbklkCiAgKSBwdWJsaWMgewogICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgcmVxdWlyZShfYWRkcmVzc05vdE51bGwoX3RvKSk7CgogICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogIH0KCiAgLy8vIFRoaXJkLXBhcnR5IGluaXRpYXRlcyB0cmFuc2ZlciBvZiB0b2tlbiBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8KICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQgZnJvbS4KICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBmb3IgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkIHRvLgogIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICBhZGRyZXNzIF9mcm9tLAogICAgYWRkcmVzcyBfdG8sCiAgICB1aW50MjU2IF90b2tlbklkCiAgKSBwdWJsaWMgewogICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKICAgIHJlcXVpcmUoX2FwcHJvdmVkKF90bywgX3Rva2VuSWQpKTsKICAgIHJlcXVpcmUoX2FkZHJlc3NOb3ROdWxsKF90bykpOwoKICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgfQoKICAvKioqIFBSSVZBVEUgRlVOQ1RJT05TICoqKi8KICAvLy8gU2FmZXR5IGNoZWNrIG9uIF90byBhZGRyZXNzIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogIGZ1bmN0aW9uIF9hZGRyZXNzTm90TnVsbChhZGRyZXNzIF90bykgcHJpdmF0ZSBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBfdG8gIT0gYWRkcmVzcygwKTsKICB9CgogIC8vLyBGb3IgY2hlY2tpbmcgYXBwcm92YWwgb2YgdHJhbnNmZXIgZm9yIGFkZHJlc3MgX3RvCiAgZnVuY3Rpb24gX2FwcHJvdmVkKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG1vYnN0ZXJJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF90bzsKICB9CgoKICAvLy8gRm9yIGNyZWF0aW5nIG1vYnN0ZXJzCiAgZnVuY3Rpb24gX2NyZWF0ZU1vYnN0ZXIoc3RyaW5nIF9uYW1lLCBhZGRyZXNzIF9vd25lciwgdWludDI1NiBfcHJpY2UsIHVpbnQyNTYgX2Jvc3MsIHVpbnQyNTYgX2xldmVsLCBzdHJpbmcgX3Nob3cpIHByaXZhdGUgewoKICAgIE1vYnN0ZXIgbWVtb3J5IF9tb2JzdGVyID0gTW9ic3Rlcih7CiAgICAgIG5hbWU6IF9uYW1lLAogICAgICBib3NzOiBfYm9zcywKICAgICAgc3RhdGU6IDAsCiAgICAgIGRhemVkRXhpcHJ5VGltZTogMCwKICAgICAgYnV5UHJpY2U6IF9wcmljZSwKICAgICAgc3RhcnRpbmdQcmljZTogX3ByaWNlLAogICAgICBpZDogbW9ic3RlcnMubGVuZ3RoLTEsCiAgICAgIGJ1eVRpbWU6IG5vdywKICAgICAgbGV2ZWw6IF9sZXZlbCwKICAgICAgc2hvdzogX3Nob3csCiAgICAgIGhhc1doYWNrZWQ6IGZhbHNlCiAgICB9KTsKICAgIHVpbnQyNTYgbmV3TW9ic3RlcklkID0gbW9ic3RlcnMucHVzaChfbW9ic3RlcikgLSAxOwogICAgbW9ic3RlcnNbbmV3TW9ic3RlcklkXS5pZD1uZXdNb2JzdGVySWQ7CgogICAgaWYgKG5ld01vYnN0ZXJJZD09MCl7CiAgICAgICBtb2JzdGVyc1swXS5oYXNXaGFja2VkPXRydWU7IC8vIEdvZGZhdGhlciBhbHdheXMgaGFzIGhpcyBiYWRnZQogICAgfQoKICAgIC8vIGNyZWF0aW5nIG5ldyBzcXVhZHMKICAgIGlmIChuZXdNb2JzdGVySWQgJSAxNiA9PTAgfHwgbmV3TW9ic3RlcklkPT0xKQogICAgewogICAgICAgIGdhbmdIaXRzLmxlbmd0aCsrOwogICAgICAgIGdhbmdCYWRnZXMubGVuZ3RoKys7CiAgICB9CgoKCiAgICAvLyBJdCdzIHByb2JhYmx5IG5ldmVyIGdvaW5nIHRvIGhhcHBlbiwgNCBiaWxsaW9uIHRva2VucyBhcmUgQSBMT1QsIGJ1dAogICAgLy8gbGV0J3MganVzdCBiZSAxMDAlIHN1cmUgd2UgbmV2ZXIgbGV0IHRoaXMgaGFwcGVuLgogICAgcmVxdWlyZShuZXdNb2JzdGVySWQgPT0gdWludDI1Nih1aW50MzIobmV3TW9ic3RlcklkKSkpOwoKICAgIEJpcnRoKG5ld01vYnN0ZXJJZCwgX25hbWUsIF9vd25lcik7CgogICAgbW9ic3RlckluZGV4VG9QcmljZVtuZXdNb2JzdGVySWRdID0gX3ByaWNlOwoKICAgIC8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwLCBhbmQgYWxzbyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudCBhcwogICAgLy8gcGVyIEVSQzcyMSBkcmFmdAogICAgX3RyYW5zZmVyKGFkZHJlc3MoMCksIF9vd25lciwgbmV3TW9ic3RlcklkKTsKICB9CgogIC8vLyBDaGVjayBmb3IgdG9rZW4gb3duZXJzaGlwCiAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBjbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBjbGFpbWFudCA9PSBtb2JzdGVySW5kZXhUb093bmVyW190b2tlbklkXTsKICB9CgogLy8vIHdpdGhkcmF3ICwgYnV0IGxlYXZlIHdoYWNraW5nIHBvb2wgYW1vdW50IGluIC0gcGxheWVycyBuZWVkCiAgZnVuY3Rpb24gd2l0aGRyYXcodWludDI1NiBhbW91bnQpIHB1YmxpYyBvbmx5Q0xldmVsIHsKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZT53aGFja2luZ1Bvb2wpOwogICAgICAgIHJlcXVpcmUoYW1vdW50PD10aGlzLmJhbGFuY2Utd2hhY2tpbmdQb29sKTsKICAgICAgICBpZiAoYW1vdW50PT0wKXsKICAgICAgICAgICAgYW1vdW50PXRoaXMuYmFsYW5jZS13aGFja2luZ1Bvb2w7CiAgICAgICAgfQogICAgICAgIGNlb0FkZHJlc3MudHJhbnNmZXIoYW1vdW50KTsKICAgIH0KCgogIGZ1bmN0aW9uIGNhbk1ha2VVbnJlZnVzYWJsZU9mZmVyKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBjYW4pewogICAgICByZXR1cm4gKG5vdyA+IG1vYnN0ZXJzWzBdLmJ1eVRpbWUgKyA0OCBob3Vycyk7CiAgfQoKICAvLy8gR29kZmF0aGVyIGNhbiBjbGFpbSBjb250cmFjdCA0OCBocnMgYWZ0ZXIgY2FyZCBpcyBwdXJjaGFzZWQKICBmdW5jdGlvbiBhbk9mZmVyV2VDYW50UmVmdXNlKCkgcHVibGljIHsKICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PW1vYnN0ZXJJbmRleFRvT3duZXJbMF0pOyAvLyBvd25lciBvZiBHb2RmYXRoZXIKICAgICByZXF1aXJlKG5vdyA+IG1vYnN0ZXJzWzBdLmJ1eVRpbWUgKyA0OCBob3Vycyk7IC8vIDQ4IGhvdXJzIGFmdGVyIHB1cmNoYXNlCiAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7IC8vIG5vdyBvd25lciBvZiBjb250cmFjdAogICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOyAvLyBlbnRpdGxlZCB0byB3aXRoZHJhdyBhbnkgbmV3IGNvbnRyYWN0IGZlZXMKICB9CgoKICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIG1vYnN0ZXIgdG8gYW4gYWRkcmVzcy4KICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewogICAgLy8gU2luY2UgdGhlIG51bWJlciBvZiBtb2JzdGVycyBpcyBjYXBwZWQgdG8gMl4zMiB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICBvd25lcnNoaXBUb2tlbkNvdW50W190b10rKzsKICAgIC8vdHJhbnNmZXIgb3duZXJzaGlwCiAgICBtb2JzdGVySW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKCiAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyBtb2JzdGVycyBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CiAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICBkZWxldGUgbW9ic3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICB9CgogICAgLy8gRW1pdCB0aGUgdHJhbnNmZXIgZXZlbnQuCiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgfQoKICAgIC8vIHV0aWxpdHkgdG8gcm91bmQgdG8gdGhlIGdhbWUgcHJlY2lzaW9uCiAgICBmdW5jdGlvbiByb3VuZEl0KHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIHJvdW5kIGRvd24gdG8gY29ycmVjdCBwcmVpY2lzaW9uCiAgICAgICAgdWludDI1NiByZXN1bHQgPSAoYW1vdW50L3ByZWNpc2lvbikqcHJlY2lzaW9uOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9Cgp9CgoKCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9'.
	

]
