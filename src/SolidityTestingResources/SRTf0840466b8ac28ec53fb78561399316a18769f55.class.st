Class {
	#name : #SRTf0840466b8ac28ec53fb78561399316a18769f55,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf0840466b8ac28ec53fb78561399316a18769f55 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQGF1dGhvciBIaWV1IFBoYW4gLSBodHRwczovL2dpdGh1Yi5jb20vcGhhbmxldHJ1bmdoaWV1CiAqIEBhdXRob3IgSGFuaCBQaGFtIC0gaHR0cHM6Ly9naXRodWIuY29tL0hhbmhQaGFtUGh1b2MKICovCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgovKioqKioKICAgICogT3JnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogICAgKiBNb2RpZmllZCBieSBodHRwczovL2dpdGh1Yi5jb20vYWdhcndhbGFrYXJzaAogICAgKi8KCmludGVyZmFjZSB0b2tlblJlY2lwaWVudCB7IGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsgfQovKioqKioKICAgICogQHRpdGxlIEJhc2ljIFRva2VuCiAgICAqIEBkZXYgQmFzaWMgVmVyc2lvbiBvZiBhIEdlbmVyaWMgVG9rZW4KICAgICovCmNvbnRyYWN0IEVSQzIwQmFzaWNUb2tlbiBpcyBQYXVzYWJsZXsKICAgIC8vIDE4IGRlY2ltYWxzIGlzIHRoZSBzdHJvbmdseSBzdWdnZXN0ZWQgZGVmYXVsdCwgYXZvaWQgY2hhbmdpbmcgaXQKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8vIFRoaXMgY3JlYXRlcyBhbiBhcnJheSB3aXRoIGFsbCBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2U7CgogICAgLy8gVGhpcyBnZW5lcmF0ZXMgYSBwdWJsaWMgZXZlbnQgb24gdGhlIGJsb2NrY2hhaW4gdGhhdCB3aWxsIG5vdGlmeSBjbGllbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvLyBUaGlzIG5vdGlmaWVzIGNsaWVudHMgYWJvdXQgdGhlIGFtb3VudCBidXJudAogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSk7CgogICAgLy9GaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4KICAgIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA+PSBzaXplICsgNCkgOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCB0cmFuc2Zlciwgb25seSBjYW4gYmUgY2FsbGVkIGJ5IHRoaXMgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgd2hlbk5vdFBhdXNlZCBpbnRlcm5hbCB7CiAgICAgICAgLy8gUHJldmVudCB0cmFuc2ZlciB0byAweDAgYWRkcmVzcy4gVXNlIGJ1cm4oKSBpbnN0ZWFkCiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwogICAgICAgIC8vIENoZWNrIGZvciBvdmVyZmxvd3MKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKICAgICAgICAvLyBTYXZlIHRoaXMgZm9yIGFuIGFzc2VydGlvbiBpbiB0aGUgZnV0dXJlCiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VzID0gYmFsYW5jZXNbX2Zyb21dICsgYmFsYW5jZXNbX3RvXTsKICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgIC8vIEFkZCB0aGUgc2FtZSB0byB0aGUgcmVjaXBpZW50CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAvLyBBc3NlcnRzIGFyZSB1c2VkIHRvIHVzZSBzdGF0aWMgYW5hbHlzaXMgdG8gZmluZCBidWdzIGluIHlvdXIgY29kZS4gVGhleSBzaG91bGQgbmV2ZXIgZmFpbAogICAgICAgIGFzc2VydChiYWxhbmNlc1tfZnJvbV0gKyBiYWxhbmNlc1tfdG9dID09IHByZXZpb3VzQmFsYW5jZXMpOwogICAgfQoKCiAgICAvKioKICAgICAqIFRyYW5zZmVyIHRva2VucyBmcm9tIG90aGVyIGFkZHJlc3MKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBpbiBiZWhhbGYgb2YgYF9mcm9tYAogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgdGhlIGFtb3VudCB0byBzZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHdoZW5Ob3RQYXVzZWQgb25seVBheWxvYWRTaXplKDIgKiAzMikgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0pOyAgICAgLy8gQ2hlY2sgYWxsb3dhbmNlCiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlciB0b2tlbnMKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIHlvdXIgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IHRvIHNlbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHB1YmxpYyB7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgQ3JlYXRlIGBtaW50ZWRBbW91bnRgIHRva2VucyBhbmQgc2VuZCBpdCB0byBgdGFyZ2V0YAogICAgICogQHBhcmFtIHRhcmdldCBBZGRyZXNzIHRvIHJlY2VpdmUgdGhlIHRva2VucwogICAgICogQHBhcmFtIG1pbnRlZEFtb3VudCB0aGUgYW1vdW50IG9mIHRva2VucyBpdCB3aWxsIHJlY2VpdmUKICAgICAqLwogICAgZnVuY3Rpb24gbWludFRva2VuKGFkZHJlc3MgdGFyZ2V0LCB1aW50MjU2IG1pbnRlZEFtb3VudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgYmFsYW5jZXNbdGFyZ2V0XSArPSBtaW50ZWRBbW91bnQ7CiAgICAgICAgdG90YWxTdXBwbHkgKz0gbWludGVkQW1vdW50OwogICAgICAgIFRyYW5zZmVyKDAsIHRoaXMsIG1pbnRlZEFtb3VudCk7CiAgICAgICAgVHJhbnNmZXIodGhpcywgdGFyZ2V0LCBtaW50ZWRBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFsbG93YW5jZSBmb3Igb3RoZXIgYWRkcmVzcwogICAgICoKICAgICAqIEFsbG93cyBgX3NwZW5kZXJgIHRvIHNwZW5kIG5vIG1vcmUgdGhhbiBgX3ZhbHVlYCB0b2tlbnMgaW4geW91ciBiZWhhbGYKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgbWF4IGFtb3VudCB0aGV5IGNhbiBzcGVuZAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2FuY2VbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFsbG93YW5jZSBmb3Igb3RoZXIgYWRkcmVzcyBhbmQgbm90aWZ5CiAgICAgKgogICAgICogQWxsb3dzIGBfc3BlbmRlcmAgdG8gc3BlbmQgbm8gbW9yZSB0aGFuIGBfdmFsdWVgIHRva2VucyBpbiB5b3VyIGJlaGFsZiwgYW5kIHRoZW4gcGluZyB0aGUgY29udHJhY3QgYWJvdXQgaXQKICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgbWF4IGFtb3VudCB0aGV5IGNhbiBzcGVuZAogICAgICogQHBhcmFtIF9leHRyYURhdGEgc29tZSBleHRyYSBpbmZvcm1hdGlvbiB0byBzZW5kIHRvIHRoZSBhcHByb3ZlZCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB0b2tlblJlY2lwaWVudCBzcGVuZGVyID0gdG9rZW5SZWNpcGllbnQoX3NwZW5kZXIpOwogICAgICAgIGlmIChhcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpKSB7CiAgICAgICAgICAgIHNwZW5kZXIucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIF92YWx1ZSwgdGhpcywgX2V4dHJhRGF0YSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlc3Ryb3kgdG9rZW5zCiAgICAgKgogICAgICogUmVtb3ZlIGBfdmFsdWVgIHRva2VucyBmcm9tIHRoZSBzeXN0ZW0gaXJyZXZlcnNpYmx5CiAgICAgKgogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IG9mIG1vbmV5IHRvIGJ1cm4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsgICAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7ICAgICAgICAgICAgLy8gU3VidHJhY3QgZnJvbSB0aGUgc2VuZGVyCiAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOyAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIHRvdGFsU3VwcGx5CiAgICAgICAgQnVybihtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRGVzdHJveSB0b2tlbnMgZnJvbSBvdGhlciBhY2NvdW50CiAgICAgKgogICAgICogUmVtb3ZlIGBfdmFsdWVgIHRva2VucyBmcm9tIHRoZSBzeXN0ZW0gaXJyZXZlcnNpYmx5IG9uIGJlaGFsZiBvZiBgX2Zyb21gLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSB0aGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBhbW91bnQgb2YgbW9uZXkgdG8gYnVybgogICAgICovCiAgICBmdW5jdGlvbiBidXJuRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7ICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSB0YXJnZXRlZCBiYWxhbmNlIGlzIGVub3VnaAogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0pOyAgICAvLyBDaGVjayBhbGxvd2FuY2UKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSB0YXJnZXRlZCBiYWxhbmNlCiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7ICAgICAgICAgICAgIC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcidzIGFsbG93YW5jZQogICAgICAgIHRvdGFsU3VwcGx5IC09IF92YWx1ZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdG90YWxTdXBwbHkKICAgICAgICBCdXJuKF9mcm9tLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogIAkgKiBSZXR1cm4gYmFsYW5jZSBvZiBhbiBhY2NvdW50CiAgICAgKiBAcGFyYW0gX293bmVyIHRoZSBhZGRyZXNzIHRvIGdldCBiYWxhbmNlCiAgCSAqLwogIAlmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAJCXJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIAl9CgogICAgLyoqCiAgCSAqIFJldHVybiBhbGxvd2FuY2UgZm9yIG90aGVyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgc3BlbmQgdG8gdGhlIG90aGVyCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogIAkgKi8KICAJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAJCXJldHVybiBhbGxvd2FuY2VbX293bmVyXVtfc3BlbmRlcl07CiAgCX0KfQoKY29udHJhY3QgSldDVG9rZW4gaXMgRVJDMjBCYXNpY1Rva2VuIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSAgICAgID0gIkpXQyBCbG9ja2NoYWluIFZlbnR1cmVzIjsgICAvL3Rva2VucyBuYW1lCglzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCAgICA9ICJKV0MiOyAgICAgICAgICAgICAgICAgICAgICAgLy90b2tlbiBzeW1ib2wKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7ICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Rva2VuIGRlY2ltYWwKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgdmVyc2lvbiAgID0gIjEuMCI7ICAgICAgICAgICAgICAgICAgICAgICAvL3Rva2VucyB2ZXJzaW9uCgoJdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG9rZW5QcmVTYWxlICAgICAgICAgPSAxMDAwMDAwMDAgKiAxMCoqZGVjaW1hbHM7Ly90b2tlbnMgZm9yIHByZS1zYWxlCgl1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlblB1YmxpY1NhbGUgICAgICA9IDQwMDAwMDAwMCAqIDEwKipkZWNpbWFsczsvL3Rva2VucyBmb3IgcHVibGljLXNhbGUKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IHRva2VuUmVzZXJ2ZSAgICAgICAgID0gMzAwMDAwMDAwICogMTAqKmRlY2ltYWxzOy8vdG9rZW5zIGZvciByZXNlcnZlCgl1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0b2tlblRlYW1TdXBwb3J0ZXIgICA9IDEyMDAwMDAwMCAqIDEwKipkZWNpbWFsczsvL3Rva2VucyBmb3IgVGVhbSAmIFN1cHBvcnRlcgoJdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG9rZW5BZHZpc29yUGFydG5lcnMgPSA4MDAwMDAwMCAgKiAxMCoqZGVjaW1hbHM7Ly90b2tlbnMgZm9yIEFkdmlzb3IKCglhZGRyZXNzIHB1YmxpYyBpY29Db250cmFjdDsKCgkvLyBjb25zdHJ1Y3RvcgoJZnVuY3Rpb24gSldDVG9rZW4oKSBwdWJsaWMgewoJCXRvdGFsU3VwcGx5ID0gdG9rZW5QcmVTYWxlICsgdG9rZW5QdWJsaWNTYWxlICsgdG9rZW5SZXNlcnZlICsgdG9rZW5UZWFtU3VwcG9ydGVyICsgdG9rZW5BZHZpc29yUGFydG5lcnM7Cgl9CgoJLyoqCgkgKiBTZXQgSUNPIENvbnRyYWN0IGZvciB0aGlzIHRva2VuIHRvIG1ha2Ugc3VyZSBjYWxsZWQgYnkgb3VyIElDTyBjb250cmFjdAoJICogQHBhcmFtIF9pY29Db250cmFjdCAtIElDTyBDb250cmFjdCBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIHNldEljb0NvbnRyYWN0KGFkZHJlc3MgX2ljb0NvbnRyYWN0KSBwdWJsaWMgb25seU93bmVyIHsKCQlpZiAoX2ljb0NvbnRyYWN0ICE9IGFkZHJlc3MoMCkpIHsKCQkJaWNvQ29udHJhY3QgPSBfaWNvQ29udHJhY3Q7CgkJfQoJfQoKCS8qKgoJICogU2VsbCB0b2tlbnMgd2hlbiBJQ08uIE9ubHkgY2FsbGVkIGJ5IElDTyBDb250cmFjdAoJICogQHBhcmFtIF9yZWNpcGllbnQgLSBhZGRyZXNzIHNlbmQgRVRIIHRvIGJ1eSB0b2tlbnMKCSAqIEBwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgRVRIcwoJICovCglmdW5jdGlvbiBzZWxsKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCWFzc2VydChfdmFsdWUgPiAwKTsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gaWNvQ29udHJhY3QpOwoKCQliYWxhbmNlc1tfcmVjaXBpZW50XSA9IGJhbGFuY2VzW19yZWNpcGllbnRdLmFkZChfdmFsdWUpOwoKCQlUcmFuc2ZlcigweDAsIF9yZWNpcGllbnQsIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBQYXkgYm9udXMgJiBhZmZpbGlhdGUgdG8gYWRkcmVzcwoJICogQHBhcmFtIF9yZWNpcGllbnQgLSBhZGRyZXNzIHRvIHJlY2VpdmUgYm9udXMgJiBhZmZpbGlhdGUKCSAqIEBwYXJhbSBfdmFsdWUgLSB2YWx1ZSBib251cyAmIGFmZmlsaWF0ZSB0byBnaXZlCgkgKi8KCWZ1bmN0aW9uIHBheUJvbnVzQWZmaWxpYXRlKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlhc3NlcnQoX3ZhbHVlID4gMCk7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IGljb0NvbnRyYWN0KTsKCgkJYmFsYW5jZXNbX3JlY2lwaWVudF0gPSBiYWxhbmNlc1tfcmVjaXBpZW50XS5hZGQoX3ZhbHVlKTsKCQl0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfdmFsdWUpOwoKCQlUcmFuc2ZlcigweDAsIF9yZWNpcGllbnQsIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9Cn0KCi8qKgogKiBTdG9yZSBjb25maWcgb2YgcGhhc2UgSUNPCiAqLwpjb250cmFjdCBJY29QaGFzZSB7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQcmVzYWxlX0Zyb20gPSAxNTE1Njc5MjAwOy8vMTRoIDIwLzAxLzIwMTggR01UICh0ZXN0IDE0aCAxMS8wMS8yMDE4IEdNVCkKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBwaGFzZVByZXNhbGVfVG8gPSAxNTE3ODM5MjAwOy8vMTRoIDA1LzAyLzIwMTggR01UCgogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHBoYXNlUHVibGljU2FsZTFfRnJvbSA9IDE1MTk5MTI4MDA7Ly8xNGggMDEvMDMvMjAxOCBHTVQKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBwaGFzZVB1YmxpY1NhbGUxX1RvID0gMTUyMDM0NDgwMDsvLzE0aCAwNi8wMy8yMDE4IEdNVAoKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBwaGFzZVB1YmxpY1NhbGUyX0Zyb20gPSAxNTIwMzQ0ODAwOy8vMTRoIDA2LzAzLzIwMTggR01UCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQdWJsaWNTYWxlMl9UbyA9IDE1MjA3NzY4MDA7Ly8xNGggMTEvMDMvMjAxOCBHTVQKCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgcGhhc2VQdWJsaWNTYWxlM19Gcm9tID0gMTUyMDc3NjgwMDsvLzE0aCAxMS8wMy8yMDE4IEdNVAogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHBoYXNlUHVibGljU2FsZTNfVG8gPSAxNTIxMjA4ODAwOy8vMTRoIDE2LzAzLzIwMTggR01UCn0KCi8qKgogKiBUaGlzIGNvbnRyYWN0IHdpbGwgZ2l2ZSBib251cyBmb3IgdXNlciB3aGVuIGJ1eSB0b2tlbnMuIFRoZSBib251cyB3aWxsIGJlIHBhaWQgYWZ0ZXIgZmluaXNoaW5nIElDTwogKi8KY29udHJhY3QgQm9udXMgaXMgSWNvUGhhc2UsIE93bmFibGUgewoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJLy9kZWNpbWFscyBvZiB0b2tlbnMKCXVpbnQyNTYgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCgkvL2VuYWJsZS9kaXNhYmxlCglib29sIHB1YmxpYyBpc0JvbnVzOwoKCS8vbWF4IHRva2VucyBmb3IgdGltZSBib251cwoJdWludDI1NiBwdWJsaWMgbWF4VGltZUJvbnVzID0gMjI1MDAwMDAwKjEwKipkZWNpbWFsczsKCgkvL21heCB0b2tlbnMgZm9yIGFtb3VudCBib251cwoJdWludDI1NiBwdWJsaWMgbWF4QW1vdW50Qm9udXMgPSAxMjUwMDAwMDAqMTAqKmRlY2ltYWxzOwoKCS8vc3RvcmFnZQoJbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBib251c0FjY291bnRCYWxhbmNlczsKCW1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgYm9udXNBY2NvdW50SW5kZXg7Cgl1aW50MjU2IHB1YmxpYyBib251c0FjY291bnRDb3VudDsKCgl1aW50MjU2IHB1YmxpYyBpbmRleFBhaWRCb251czsvL2Ftb3VudCBvZiBhY2NvdW50cyBoYXZlIGJlZW4gcGFpZCBib251cwoKCWZ1bmN0aW9uIEJvbnVzKCkgcHVibGljIHsKCQlpc0JvbnVzID0gdHJ1ZTsKCX0KCgkvKioKCSAqIEVuYWJsZSBib251cwoJICovCglmdW5jdGlvbiBlbmFibGVCb251cygpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkKCXsKCQlyZXF1aXJlKCFpc0JvbnVzKTsKCQlpc0JvbnVzPXRydWU7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBEaXNhYmxlIGJvbnVzCgkgKi8KCWZ1bmN0aW9uIGRpc2FibGVCb251cygpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkKCXsKCQlyZXF1aXJlKGlzQm9udXMpOwoJCWlzQm9udXM9ZmFsc2U7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBHZXQgYm9udXMgcGVyY2VudCBieSB0aW1lCgkgKi8KCWZ1bmN0aW9uIGdldFRpbWVCb251cygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKCQl1aW50MjU2IGJvbnVzID0gMDsKCgkJaWYobm93Pj1waGFzZVByZXNhbGVfRnJvbSAmJiBub3c8cGhhc2VQcmVzYWxlX1RvKXsKCQkJYm9udXMgPSA0MDsKCQl9IGVsc2UgaWYgKG5vdz49cGhhc2VQdWJsaWNTYWxlMV9Gcm9tICYmIG5vdzxwaGFzZVB1YmxpY1NhbGUxX1RvKSB7CgkJCWJvbnVzID0gMjA7CgkJfSBlbHNlIGlmIChub3c+PXBoYXNlUHVibGljU2FsZTJfRnJvbSAmJiBub3c8cGhhc2VQdWJsaWNTYWxlMl9UbykgewoJCQlib251cyA9IDEwOwoJCX0gZWxzZSBpZiAobm93Pj1waGFzZVB1YmxpY1NhbGUzX0Zyb20gJiYgbm93PHBoYXNlUHVibGljU2FsZTNfVG8pIHsKCQkJYm9udXMgPSA1OwoJCX0KCgkJcmV0dXJuIGJvbnVzOwoJfQoKCS8qKgoJICogR2V0IGJvbnVzIGJ5IGV0aAoJICogQHBhcmFtIF92YWx1ZSAtIGV0aCB0byBjb252ZXJ0IHRvIGJvbnVzCgkgKi8KCWZ1bmN0aW9uIGdldEJvbnVzQnlFVEgodWludDI1NiBfdmFsdWUpIHB1YmxpYyBwdXJlIHJldHVybnModWludDI1NikgewoJCXVpbnQyNTYgYm9udXMgPSAwOwoKCQlpZihfdmFsdWU+PTE1MDAqMTAqKmRlY2ltYWxzKXsKCQkJYm9udXM9X3ZhbHVlLm11bCgyNSkvMTAwOwoJCX0gZWxzZSBpZihfdmFsdWU+PTMwMCoxMCoqZGVjaW1hbHMpewoJCQlib251cz1fdmFsdWUubXVsKDIwKS8xMDA7CgkJfSBlbHNlIGlmKF92YWx1ZT49MTUwKjEwKipkZWNpbWFscyl7CgkJCWJvbnVzPV92YWx1ZS5tdWwoMTUpLzEwMDsKCQl9IGVsc2UgaWYoX3ZhbHVlPj0zMCoxMCoqZGVjaW1hbHMpewoJCQlib251cz1fdmFsdWUubXVsKDEwKS8xMDA7CgkJfSBlbHNlIGlmKF92YWx1ZT49MTUqMTAqKmRlY2ltYWxzKXsKCQkJYm9udXM9X3ZhbHVlLm11bCg1KS8xMDA7CgkJfQoKCQlyZXR1cm4gYm9udXM7Cgl9CgoJLyoqCgkgKiBHZXQgYm9udXMgYmFsYW5jZSBvZiBhbiBhY2NvdW50CgkgKiBAcGFyYW0gX293bmVyIC0gdGhlIGFkZHJlc3MgdG8gZ2V0IGJvbnVzIG9mCgkgKi8KCWZ1bmN0aW9uIGJhbGFuY2VCb251c09mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKQoJewoJCXJldHVybiBib251c0FjY291bnRCYWxhbmNlc1tfb3duZXJdOwoJfQoKCS8qKgoJICogR2V0IGJvbnVzIGJhbGFuY2Ugb2YgYW4gYWNjb3VudAoJICovCglmdW5jdGlvbiBwYXlCb251cygpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKCi8qKgogKiBUaGlzIGNvbnRyYWN0IHdpbGwgZ2l2ZSBhZmZpbGlhdGUgZm9yIHVzZXIgd2hlbiBidXkgdG9rZW5zLiBUaGUgYWZmaWxpYXRlIHdpbGwgYmUgcGFpZCBhZnRlciBmaW5pc2hpbmcgSUNPCiAqLwpjb250cmFjdCBBZmZpbGlhdGUgaXMgT3duYWJsZSB7CgoJLy9Db250cm9sIEFmZmlsaWF0ZSBmZWF0dXJlLgoJYm9vbCBwdWJsaWMgaXNBZmZpbGlhdGU7CgoJLy9BZmZpbGlhdGUgbGV2ZWwsIGluaXQgaXMgMQoJdWludDI1NiBwdWJsaWMgYWZmaWxpYXRlTGV2ZWwgPSAxOwoKCS8vRWFjaCB1c2VyIHdpbGwgaGF2ZSBkaWZmZXJlbnQgcmF0ZQoJbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBhZmZpbGlhdGVSYXRlOwoKCS8vS2VlcCBiYWxhbmNlIG9mIHVzZXIKCW1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcmVmZXJyYWxCYWxhbmNlOy8vcmVmZXJlZT0+dmFsdWUKCgltYXBwaW5nKGFkZHJlc3MgPT4gYWRkcmVzcykgcHVibGljIHJlZmVycmFsOy8vcmVmZXJlZT0+cmVmZXJyZXIKCW1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgcmVmZXJyYWxJbmRleDsvL2luZGV4PT5yZWZlcmVlCgoJdWludDI1NiBwdWJsaWMgcmVmZXJyYWxDb3VudDsKCgkvL2Ftb3VudCBvZiBhY2NvdW50cyBoYXZlIGJlZW4gcGFpZCBhZmZpbGlhdGUKCXVpbnQyNTYgcHVibGljIGluZGV4UGFpZEFmZmlsaWF0ZTsKCgkvLyBtYXggdG9rZW5zIGZvciBhZmZpbGlhdGUKCXVpbnQyNTYgcHVibGljIG1heEFmZmlsaWF0ZSA9IDEwMDAwMDAwMCooMTAqKjE4KTsKCgkvKioKCSAqIFRocm93IGlmIGFmZmlsaWF0ZSBpcyBkaXNhYmxlCgkgKi8KCW1vZGlmaWVyIHdoZW5BZmZpbGlhdGUoKSB7CgkJcmVxdWlyZSAoaXNBZmZpbGlhdGUpOwoJCV87Cgl9CgoJLyoqCgkgKiBjb25zdHJ1Y3RvciBhZmZpbGlhdGUgd2l0aCBsZXZlbCAxIHJhdGUgPSAxMCUKCSAqLwoJZnVuY3Rpb24gQWZmaWxpYXRlKCkgcHVibGljIHsKCQlpc0FmZmlsaWF0ZT10cnVlOwoJCWFmZmlsaWF0ZUxldmVsPTE7CgkJYWZmaWxpYXRlUmF0ZVswXT0xMDsKCX0KCgkvKioKCSAqIEVuYWJsZSBhZmZpbGlhdGUgZm9yIHRoZSBjb250cmFjdAoJICovCglmdW5jdGlvbiBlbmFibGVBZmZpbGlhdGUoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKCQlyZXF1aXJlICghaXNBZmZpbGlhdGUpOwoJCWlzQWZmaWxpYXRlPXRydWU7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBEaXNhYmxlIGFmZmlsaWF0ZSBmb3IgdGhlIGNvbnRyYWN0CgkgKi8KCWZ1bmN0aW9uIGRpc2FibGVBZmZpbGlhdGUoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKCQlyZXF1aXJlIChpc0FmZmlsaWF0ZSk7CgkJaXNBZmZpbGlhdGU9ZmFsc2U7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gY3VycmVudCBhZmZpbGlhdGUgbGV2ZWwKCSAqLwoJZnVuY3Rpb24gZ2V0QWZmaWxpYXRlTGV2ZWwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KQoJewoJCXJldHVybiBhZmZpbGlhdGVMZXZlbDsKCX0KCgkvKioKCSAqIFVwZGF0ZSBhZmZpbGlhdGUgbGV2ZWwgYnkgb3duZXIKCSAqIEBwYXJhbSBfbGV2ZWwgLSBuZXcgbGV2ZWwKCSAqLwoJZnVuY3Rpb24gc2V0QWZmaWxpYXRlTGV2ZWwodWludDI1NiBfbGV2ZWwpIHB1YmxpYyBvbmx5T3duZXIgd2hlbkFmZmlsaWF0ZSByZXR1cm5zKGJvb2wpCgl7CgkJYWZmaWxpYXRlTGV2ZWw9X2xldmVsOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogR2V0IHJlZmVycmVyIGFkZHJlc3MKCSAqIEBwYXJhbSBfcmVmZXJlZSAtIHRoZSByZWZlcmVlIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gZ2V0UmVmZXJyZXJBZGRyZXNzKGFkZHJlc3MgX3JlZmVyZWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKQoJewoJCXJldHVybiByZWZlcnJhbFtfcmVmZXJlZV07Cgl9CgoJLyoqCgkgKiBHZXQgcmVmZXJlZSBhZGRyZXNzCgkgKiBAcGFyYW0gX3JlZmVycmVyIC0gdGhlIHJlZmVycmVyIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gZ2V0UmVmZXJlZUFkZHJlc3MoYWRkcmVzcyBfcmVmZXJyZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10gX3JlZmVyZWUpCgl7CgkJYWRkcmVzc1tdIG1lbW9yeSByZWZlcmVlVGVtcCA9IG5ldyBhZGRyZXNzW10ocmVmZXJyYWxDb3VudCk7CgkJdWludCBjb3VudCA9IDA7CgkJdWludCBpOwoJCWZvciAoaT0wOyBpPHJlZmVycmFsQ291bnQ7IGkrKyl7CgkJCWlmKHJlZmVycmFsW3JlZmVycmFsSW5kZXhbaV1dID09IF9yZWZlcnJlcil7CgkJCQlyZWZlcmVlVGVtcFtjb3VudF0gPSByZWZlcnJhbEluZGV4W2ldOwoKCQkJCWNvdW50ICs9IDE7CgkJCX0KCQl9CgoJCV9yZWZlcmVlID0gbmV3IGFkZHJlc3NbXShjb3VudCk7CgkJZm9yIChpPTA7IGk8Y291bnQ7IGkrKykKCQkJX3JlZmVyZWVbaV0gPSByZWZlcmVlVGVtcFtpXTsKCX0KCgkvKioKCSAqIE1hcHBpbmcgcmVmZXJlZSBhZGRyZXNzIHdpdGggcmVmZXJyZXIgYWRkcmVzcwoJICogQHBhcmFtIF9wYXJlbnQgLSB0aGUgcmVmZXJyZXIgYWRkcmVzcwoJICogQHBhcmFtIF9jaGlsZCAtIHRoZSByZWZlcmVlIGFkZHJlc3MKCSAqLwoJZnVuY3Rpb24gc2V0UmVmZXJyYWxBZGRyZXNzKGFkZHJlc3MgX3BhcmVudCwgYWRkcmVzcyBfY2hpbGQpIHB1YmxpYyBvbmx5T3duZXIgd2hlbkFmZmlsaWF0ZSByZXR1cm5zIChib29sKQoJewoJCXJlcXVpcmUoX3BhcmVudCAhPSBhZGRyZXNzKDB4MDApKTsKCQlyZXF1aXJlKF9jaGlsZCAhPSBhZGRyZXNzKDB4MDApKTsKCgkJcmVmZXJyYWxJbmRleFtyZWZlcnJhbENvdW50XT1fY2hpbGQ7CgkJcmVmZXJyYWxbX2NoaWxkXT1fcGFyZW50OwoJCXJlZmVycmFsQ291bnQrKzsKCgkJcmVmZXJyYWxCYWxhbmNlW19jaGlsZF09MDsKCgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBHZXQgYWZmaWxpYXRlIHJhdGUgYnkgbGV2ZWwKCSAqIEBwYXJhbSBfbGV2ZWwgLSBsZXZlbCB0byBnZXQgYWZmaWxpYXRlIHJhdGUKCSAqLwoJZnVuY3Rpb24gZ2V0QWZmaWxpYXRlUmF0ZSh1aW50MjU2IF9sZXZlbCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmF0ZSkKCXsKCQlyZXR1cm4gYWZmaWxpYXRlUmF0ZVtfbGV2ZWxdOwoJfQoKCS8qKgoJICogU2V0IGFmZmlsaWF0ZSByYXRlIGZvciBsZXZlbAoJICogQHBhcmFtIF9sZXZlbCAtIHRoZSBsZXZlbCB0byBiZSBzZXQgdGhlIG5ldyByYXRlCgkgKiBAcGFyYW0gX3JhdGUgLSBuZXcgcmF0ZQoJICovCglmdW5jdGlvbiBzZXRBZmZpbGlhdGVSYXRlKHVpbnQyNTYgX2xldmVsLCB1aW50MjU2IF9yYXRlKSBwdWJsaWMgb25seU93bmVyIHdoZW5BZmZpbGlhdGUgcmV0dXJucyAoYm9vbCkKCXsKCQlhZmZpbGlhdGVSYXRlW19sZXZlbF09X3JhdGU7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBHZXQgYWZmaWxpYXRlIGJhbGFuY2Ugb2YgYW4gYWNjb3VudAoJICogQHBhcmFtIF9yZWZlcmVlIC0gdGhlIGFkZHJlc3MgdG8gZ2V0IGFmZmlsaWF0ZSBvZgoJICovCglmdW5jdGlvbiBiYWxhbmNlQWZmaWxpYXRlT2YoYWRkcmVzcyBfcmVmZXJlZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCgl7CgkJcmV0dXJuIHJlZmVycmFsQmFsYW5jZVtfcmVmZXJlZV07Cgl9CgoJLyoqCgkgKiBQYXkgYWZmaWxpYXRlCgkgKi8KCWZ1bmN0aW9uIHBheUFmZmlsaWF0ZSgpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKfQoKCi8qKgogKiBUaGlzIGNvbnRyYWN0IHdpbGwgc2VuZCB0b2tlbnMgd2hlbiBhbiBhY2NvdW50IHNlbmQgZXRoCiAqIE5vdGU6IGJlZm9yZSBzZW5kIGV0aCB0byB0b2tlbiwgYWRkcmVzcyBoYXMgdG8gYmUgcmVnaXN0ZXJlZCBieSByZWdpc3RlclJlY2lwaWVudCBmdW5jdGlvbgogKi8KY29udHJhY3QgSWNvQ29udHJhY3QgaXMgSWNvUGhhc2UsIE93bmFibGUsIFBhdXNhYmxlLCBBZmZpbGlhdGUsIEJvbnVzIHsKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCUpXQ1Rva2VuIGNjYzsKCgl1aW50MjU2IHB1YmxpYyB0b3RhbFRva2VuU2FsZTsKCXVpbnQyNTYgcHVibGljIG1pbkNvbnRyaWJ1dGlvbiA9IDAuMSBldGhlcjsvL21pbmltdW4gZXRoIHVzZWQgdG8gYnV5IHRva2VucwoJdWludDI1NiBwdWJsaWMgdG9rZW5FeGNoYW5nZVJhdGUgPSA3MDAwOy8vMUVUSD03MDAwIHRva2VucwoJdWludDI1NiBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCgl1aW50MjU2IHB1YmxpYyB0b2tlblJlbWFpblByZVNhbGU7Ly90b2tlbnMgcmVtYWluIGZvciBwcmUtc2FsZQoJdWludDI1NiBwdWJsaWMgdG9rZW5SZW1haW5QdWJsaWNTYWxlOy8vdG9rZW5zIGZvciBwdWJsaWMtc2FsZQoKCWFkZHJlc3MgcHVibGljIGV0aEZ1bmREZXBvc2l0ID0gMHgzQTk0NTI4ZDJhNTk4NkNkMjgyNWVFMERBMTYzMjhkQWJjNDYxNTU5Oy8vbXVsdGktc2lnIHdhbGxldAoJYWRkcmVzcyBwdWJsaWMgdG9rZW5BZGRyZXNzOwoKCWJvb2wgcHVibGljIGlzRmluYWxpemVkOwoKCXVpbnQyNTYgcHVibGljIG1heEdhc1JlZnVuZCA9IDAuMDA0NiBldGhlcjsvL21heGltdW0gZ2FzIHVzZWQgdG8gcmVmdW5kIGZvciBlYWNoIHRyYW5zYWN0aW9uCgoJLy9jb25zdHJ1Y3RvcgoJZnVuY3Rpb24gSWNvQ29udHJhY3QoYWRkcmVzcyBfdG9rZW5BZGRyZXNzKSBwdWJsaWMgewoJCXRva2VuQWRkcmVzcyA9IF90b2tlbkFkZHJlc3M7CgoJCWNjYyA9IEpXQ1Rva2VuKHRva2VuQWRkcmVzcyk7CgkJdG90YWxUb2tlblNhbGUgPSBjY2MudG9rZW5QcmVTYWxlKCkgKyBjY2MudG9rZW5QdWJsaWNTYWxlKCk7CgoJCXRva2VuUmVtYWluUHJlU2FsZSA9IGNjYy50b2tlblByZVNhbGUoKTsvL3Rva2VucyByZW1haW4gZm9yIHByZS1zYWxlCgkJdG9rZW5SZW1haW5QdWJsaWNTYWxlID0gY2NjLnRva2VuUHVibGljU2FsZSgpOy8vdG9rZW5zIGZvciBwdWJsaWMtc2FsZQoKCQlpc0ZpbmFsaXplZD1mYWxzZTsKCX0KCgkvL3VzYWdlOiB3ZWIzIGNoYW5nZSB0b2tlbiBmcm9tIGV0aAoJZnVuY3Rpb24gY2hhbmdlRVRIMlRva2VuKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CgkJdWludDI1NiBldGhlclJlY2V2ID0gX3ZhbHVlICsgbWF4R2FzUmVmdW5kOwoJCXJlcXVpcmUgKGV0aGVyUmVjZXYgPj0gbWluQ29udHJpYnV0aW9uKTsKCgkJdWludDI1NiByYXRlID0gZ2V0VG9rZW5FeGNoYW5nZVJhdGUoKTsKCgkJdWludDI1NiB0b2tlbnMgPSBldGhlclJlY2V2Lm11bChyYXRlKTsKCgkJLy9nZXQgY3VycmVudCBwaGFzZSBvZiBJQ08KCQl1aW50MjU2IHBoYXNlSUNPID0gZ2V0Q3VycmVudElDT1BoYXNlKCk7CgkJdWludDI1NiB0b2tlblJlbWFpbiA9IDA7CgkJaWYocGhhc2VJQ08gPT0gMSl7Ly9wcmUtc2FsZQoJCQl0b2tlblJlbWFpbiA9IHRva2VuUmVtYWluUHJlU2FsZTsKCQl9IGVsc2UgaWYgKHBoYXNlSUNPID09IDIgfHwgcGhhc2VJQ08gPT0gMyB8fCBwaGFzZUlDTyA9PSA0KSB7CgkJCXRva2VuUmVtYWluID0gdG9rZW5SZW1haW5QdWJsaWNTYWxlOwoJCX0KCgkJaWYgKHRva2VuUmVtYWluIDwgdG9rZW5zKSB7CgkJCXRva2Vucz10b2tlblJlbWFpbjsKCQl9CgoJCXJldHVybiB0b2tlbnM7Cgl9CgoJZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZSAoIWlzRmluYWxpemVkKTsKCQlyZXF1aXJlIChtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwoKCQl1aW50MjU2IGV0aGVyUmVjZXYgPSBtc2cudmFsdWUgKyBtYXhHYXNSZWZ1bmQ7CgkJcmVxdWlyZSAoZXRoZXJSZWNldiA+PSBtaW5Db250cmlidXRpb24pOwoKCQkvL2dldCBjdXJyZW50IHRva2VuIGV4Y2hhbmdlIHJhdGUKCQl0b2tlbkV4Y2hhbmdlUmF0ZSA9IGdldFRva2VuRXhjaGFuZ2VSYXRlKCk7CgoJCXVpbnQyNTYgdG9rZW5zID0gZXRoZXJSZWNldi5tdWwodG9rZW5FeGNoYW5nZVJhdGUpOwoKCQkvL2dldCBjdXJyZW50IHBoYXNlIG9mIElDTwoJCXVpbnQyNTYgcGhhc2VJQ08gPSBnZXRDdXJyZW50SUNPUGhhc2UoKTsKCgkJcmVxdWlyZShwaGFzZUlDTyE9MCk7CgoJCXVpbnQyNTYgdG9rZW5SZW1haW4gPSAwOwoJCWlmKHBoYXNlSUNPID09IDEpey8vcHJlLXNhbGUKCQkJdG9rZW5SZW1haW4gPSB0b2tlblJlbWFpblByZVNhbGU7CgkJfSBlbHNlIGlmIChwaGFzZUlDTyA9PSAyIHx8IHBoYXNlSUNPID09IDMgfHwgcGhhc2VJQ08gPT0gNCkgewoJCQl0b2tlblJlbWFpbiA9IHRva2VuUmVtYWluUHVibGljU2FsZTsKCQl9CgoJCS8vdGhyb3cgaWYgdG9rZW5SZW1haW49PTAKCQlyZXF1aXJlKHRva2VuUmVtYWluPjApOwoKCQlpZiAodG9rZW5SZW1haW4gPCB0b2tlbnMpIHsKCQkJLy9pZiB0b2tlbnMgaXMgbm90IGVub3VnaCB0byBidXkKCgkJCXVpbnQyNTYgdG9rZW5zVG9SZWZ1bmQgPSB0b2tlbnMuc3ViKHRva2VuUmVtYWluKTsKCQkJdWludDI1NiBldGhlclRvUmVmdW5kID0gdG9rZW5zVG9SZWZ1bmQgLyB0b2tlbkV4Y2hhbmdlUmF0ZTsKCgkJCS8vcmVmdW5kIGV0aCB0byBidXllcgoJCQltc2cuc2VuZGVyLnRyYW5zZmVyKGV0aGVyVG9SZWZ1bmQpOwoKCQkJdG9rZW5zPXRva2VuUmVtYWluOwoJCQlldGhlclJlY2V2ID0gZXRoZXJSZWNldi5zdWIoZXRoZXJUb1JlZnVuZCk7CgoJCQl0b2tlblJlbWFpbiA9IDA7CgkJfSBlbHNlIHsKCQkJdG9rZW5SZW1haW4gPSB0b2tlblJlbWFpbi5zdWIodG9rZW5zKTsKCQl9CgoJCS8vc3RvcmUgdG9rZW4gcmVtYWluIGJ5IHBoYXNlCgkJaWYocGhhc2VJQ08gPT0gMSl7Ly9wcmUtc2FsZQoJCQl0b2tlblJlbWFpblByZVNhbGUgPSB0b2tlblJlbWFpbjsKCQl9IGVsc2UgaWYgKHBoYXNlSUNPID09IDIgfHwgcGhhc2VJQ08gPT0gMyB8fCBwaGFzZUlDTyA9PSA0KSB7CgkJCXRva2VuUmVtYWluUHVibGljU2FsZSA9IHRva2VuUmVtYWluOwoJCX0KCgkJLy9zZW5kIHRva2VuCgkJY2NjLnNlbGwobXNnLnNlbmRlciwgdG9rZW5zKTsKCQlldGhGdW5kRGVwb3NpdC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoKCQkvL2JvbnVzCgkJaWYoaXNCb251cyl7CgkJCS8vYm9udXMgYW1vdW50CgkJCS8vZ2V0IGJvbnVzIGJ5IGV0aAoJCQl1aW50MjU2IGJvbnVzQW1vdW50RVRIID0gZ2V0Qm9udXNCeUVUSChldGhlclJlY2V2KTsKCQkJLy9nZXQgYm9udXMgYnkgdG9rZW4KCQkJdWludDI1NiBib251c0Ftb3VudFRva2VucyA9IGJvbnVzQW1vdW50RVRILm11bCh0b2tlbkV4Y2hhbmdlUmF0ZSk7CgoJCQkvL2NoZWNrIGlmIHdlIGhhdmUgZW5vdWdoIHRva2VucyBmb3IgYm9udXMKCQkJaWYobWF4QW1vdW50Qm9udXM+MCl7CgkJCQlpZihtYXhBbW91bnRCb251cz49Ym9udXNBbW91bnRUb2tlbnMpewoJCQkJCW1heEFtb3VudEJvbnVzLT1ib251c0Ftb3VudFRva2VuczsKCQkJCX0gZWxzZSB7CgkJCQkJYm9udXNBbW91bnRUb2tlbnMgPSBtYXhBbW91bnRCb251czsKCQkJCQltYXhBbW91bnRCb251cyA9IDA7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlib251c0Ftb3VudFRva2VucyA9IDA7CgkJCX0KCgkJCS8vYm9udXMgdGltZQoJCQl1aW50MjU2IGJvbnVzVGltZVRva2VuID0gdG9rZW5zLm11bChnZXRUaW1lQm9udXMoKSkvMTAwOwoJCQkvL2NoZWNrIGlmIHdlIGhhdmUgZW5vdWdoIHRva2VucyBmb3IgYm9udXMKCQkJaWYobWF4VGltZUJvbnVzPjApewoJCQkJaWYobWF4VGltZUJvbnVzPj1ib251c1RpbWVUb2tlbil7CgkJCQkJbWF4VGltZUJvbnVzLT1ib251c1RpbWVUb2tlbjsKCQkJCX0gZWxzZSB7CgkJCQkJYm9udXNUaW1lVG9rZW4gPSBtYXhUaW1lQm9udXM7CgkJCQkJbWF4VGltZUJvbnVzID0gMDsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWJvbnVzVGltZVRva2VuID0gMDsKCQkJfQoKCQkJLy9zdG9yZSBib251cwoJCQlpZihib251c0FjY291bnRCYWxhbmNlc1ttc2cuc2VuZGVyXT09MCl7Ly9uZXcKCQkJCWJvbnVzQWNjb3VudEluZGV4W2JvbnVzQWNjb3VudENvdW50XT1tc2cuc2VuZGVyOwoJCQkJYm9udXNBY2NvdW50Q291bnQrKzsKCQkJfQoKCQkJdWludDI1NiBib251c1Rva2Vucz1ib251c0Ftb3VudFRva2VucyArIGJvbnVzVGltZVRva2VuOwoJCQlib251c0FjY291bnRCYWxhbmNlc1ttc2cuc2VuZGVyXT1ib251c0FjY291bnRCYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoYm9udXNUb2tlbnMpOwoJCX0KCgkJLy9hZmZpbGlhdGUKCQlpZihpc0FmZmlsaWF0ZSl7CgkJCWFkZHJlc3MgY2hpbGQ9bXNnLnNlbmRlcjsKCQkJZm9yKHVpbnQyNTYgaT0wOyBpPGFmZmlsaWF0ZUxldmVsOyBpKyspewoJCQkJdWludDI1NiBnaWZ0VG9rZW49YWZmaWxpYXRlUmF0ZVtpXS5tdWwodG9rZW5zKS8xMDA7CgoJCQkJLy9jaGVjayBpZiB3ZSBoYXZlIGVub3VnaCB0b2tlbnMgZm9yIGFmZmlsaWF0ZQoJCQkJaWYobWF4QWZmaWxpYXRlPD0wKXsKCQkJCQlicmVhazsKCQkJCX0gZWxzZSB7CgkJCQkJaWYobWF4QWZmaWxpYXRlPj1naWZ0VG9rZW4pewoJCQkJCQltYXhBZmZpbGlhdGUtPWdpZnRUb2tlbjsKCQkJCQl9IGVsc2UgewoJCQkJCQlnaWZ0VG9rZW4gPSBtYXhBZmZpbGlhdGU7CgkJCQkJCW1heEFmZmlsaWF0ZSA9IDA7CgkJCQkJfQoJCQkJfQoKCQkJCWFkZHJlc3MgcGFyZW50ID0gcmVmZXJyYWxbY2hpbGRdOwoJCQkJaWYocGFyZW50ICE9IGFkZHJlc3MoMHgwMCkpey8vaGFzIGFmZmlsaWF0ZQoJCQkJCXJlZmVycmFsQmFsYW5jZVtjaGlsZF09cmVmZXJyYWxCYWxhbmNlW2NoaWxkXS5hZGQoZ2lmdFRva2VuKTsKCQkJCX0KCgkJCQljaGlsZD1wYXJlbnQ7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBQYXkgYWZmaWxpYXRlIHRvIGFkZHJlc3MuIENhbGxlZCB3aGVuIElDTyBmaW5pc2gKCSAqLwoJZnVuY3Rpb24gcGF5QWZmaWxpYXRlKCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQl1aW50MjU2IHRvSW5kZXggPSBpbmRleFBhaWRBZmZpbGlhdGUgKyAxNTsKCQlpZihyZWZlcnJhbENvdW50IDwgdG9JbmRleCkKCQkJdG9JbmRleCA9IHJlZmVycmFsQ291bnQ7CgoJCWZvcih1aW50MjU2IGk9aW5kZXhQYWlkQWZmaWxpYXRlOyBpPHRvSW5kZXg7IGkrKykgewoJCQlhZGRyZXNzIHJlZmVyZWUgPSByZWZlcnJhbEluZGV4W2ldOwoJCQlwYXlBZmZpbGlhdGUxQWRkcmVzcyhyZWZlcmVlKTsKCQl9CgoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogUGF5IGFmZmlsaWF0ZSB0byBvbmx5IGEgYWRkcmVzcwoJICovCglmdW5jdGlvbiBwYXlBZmZpbGlhdGUxQWRkcmVzcyhhZGRyZXNzIF9yZWZlcmVlKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCWFkZHJlc3MgcmVmZXJyZXIgPSByZWZlcnJhbFtfcmVmZXJlZV07CgkJY2NjLnBheUJvbnVzQWZmaWxpYXRlKHJlZmVycmVyLCByZWZlcnJhbEJhbGFuY2VbX3JlZmVyZWVdKTsKCgkJcmVmZXJyYWxCYWxhbmNlW19yZWZlcmVlXT0wOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogUGF5IGJvbnVzIHRvIGFkZHJlc3MuIENhbGxlZCB3aGVuIElDTyBmaW5pc2gKCSAqLwoJZnVuY3Rpb24gcGF5Qm9udXMoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXVpbnQyNTYgdG9JbmRleCA9IGluZGV4UGFpZEJvbnVzICsgMTU7CgkJaWYoYm9udXNBY2NvdW50Q291bnQgPCB0b0luZGV4KQoJCQl0b0luZGV4ID0gYm9udXNBY2NvdW50Q291bnQ7CgoJCWZvcih1aW50MjU2IGk9aW5kZXhQYWlkQm9udXM7IGk8dG9JbmRleDsgaSsrKQoJCXsKCQkJcGF5Qm9udXMxQWRkcmVzcyhib251c0FjY291bnRJbmRleFtpXSk7CgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIFBheSBib251cyB0byBvbmx5IGEgYWRkcmVzcwoJICovCglmdW5jdGlvbiBwYXlCb251czFBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJY2NjLnBheUJvbnVzQWZmaWxpYXRlKF9hZGRyZXNzLCBib251c0FjY291bnRCYWxhbmNlc1tfYWRkcmVzc10pOwoJCWJvbnVzQWNjb3VudEJhbGFuY2VzW19hZGRyZXNzXT0wOwoJCXJldHVybiB0cnVlOwoJfQoKCWZ1bmN0aW9uIGZpbmFsaXplKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKCQlyZXF1aXJlICghaXNGaW5hbGl6ZWQpOwoJCS8vIG1vdmUgdG8gb3BlcmF0aW9uYWwKCQlpc0ZpbmFsaXplZCA9IHRydWU7CgkJcGF5QWZmaWxpYXRlKCk7CgkJcGF5Qm9udXMoKTsKCQlldGhGdW5kRGVwb3NpdC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoJfQoKCS8qKgoJICogR2V0IHRva2VuIGV4Y2hhbmdlIHJhdGUKCSAqIE5vdGU6IGp1c3QgdXNlIHdoZW4gSUNPCgkgKi8KCWZ1bmN0aW9uIGdldFRva2VuRXhjaGFuZ2VSYXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NiByYXRlKSB7CgkJcmF0ZSA9IHRva2VuRXhjaGFuZ2VSYXRlOwoJCWlmKG5vdzxwaGFzZVByZXNhbGVfVG8pewoJCQlpZihub3c+PXBoYXNlUHJlc2FsZV9Gcm9tKQoJCQkJcmF0ZSA9IDEwMDAwOwoJCX0gZWxzZSBpZihub3c8cGhhc2VQdWJsaWNTYWxlM19Ubyl7CgkJCXJhdGUgPSA3MDAwOwoJCX0KCX0KCgkvKioKCSAqIEdldCB0aGUgY3VycmVudCBJQ08gcGhhc2UKCSAqLwoJZnVuY3Rpb24gZ2V0Q3VycmVudElDT1BoYXNlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1NiBwaGFzZSkgewoJCXBoYXNlID0gMDsKCQlpZihub3c+PXBoYXNlUHJlc2FsZV9Gcm9tICYmIG5vdzxwaGFzZVByZXNhbGVfVG8pewoJCQlwaGFzZSA9IDE7CgkJfSBlbHNlIGlmIChub3c+PXBoYXNlUHVibGljU2FsZTFfRnJvbSAmJiBub3c8cGhhc2VQdWJsaWNTYWxlMV9UbykgewoJCQlwaGFzZSA9IDI7CgkJfSBlbHNlIGlmIChub3c+PXBoYXNlUHVibGljU2FsZTJfRnJvbSAmJiBub3c8cGhhc2VQdWJsaWNTYWxlMl9UbykgewoJCQlwaGFzZSA9IDM7CgkJfSBlbHNlIGlmIChub3c+PXBoYXNlUHVibGljU2FsZTNfRnJvbSAmJiBub3c8cGhhc2VQdWJsaWNTYWxlM19UbykgewoJCQlwaGFzZSA9IDQ7CgkJfQoJfQoKCS8qKgoJICogR2V0IGFtb3VudCBvZiB0b2tlbnMgdGhhdCBiZSBzb2xkCgkgKi8KCWZ1bmN0aW9uIGdldFRva2VuU29sZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgdG9rZW5Tb2xkKSB7CgkJLy9nZXQgY3VycmVudCBwaGFzZSBvZiBJQ08KCQl1aW50MjU2IHBoYXNlSUNPID0gZ2V0Q3VycmVudElDT1BoYXNlKCk7CgkJdG9rZW5Tb2xkID0gMDsKCQlpZihwaGFzZUlDTyA9PSAxKXsvL3ByZS1zYWxlCgkJCXRva2VuU29sZCA9IGNjYy50b2tlblByZVNhbGUoKS5zdWIodG9rZW5SZW1haW5QcmVTYWxlKTsKCQl9IGVsc2UgaWYgKHBoYXNlSUNPID09IDIgfHwgcGhhc2VJQ08gPT0gMyB8fCBwaGFzZUlDTyA9PSA0KSB7CgkJCXRva2VuU29sZCA9IGNjYy50b2tlblByZVNhbGUoKS5zdWIodG9rZW5SZW1haW5QcmVTYWxlKSArIGNjYy50b2tlblB1YmxpY1NhbGUoKS5zdWIodG9rZW5SZW1haW5QdWJsaWNTYWxlKTsKCQl9Cgl9CgoJLyoqCgkgKiBTZXQgdG9rZW4gZXhjaGFuZ2UgcmF0ZQoJICovCglmdW5jdGlvbiBzZXRUb2tlbkV4Y2hhbmdlUmF0ZSh1aW50MjU2IF90b2tlbkV4Y2hhbmdlUmF0ZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZShfdG9rZW5FeGNoYW5nZVJhdGU+MCk7CgkJdG9rZW5FeGNoYW5nZVJhdGU9X3Rva2VuRXhjaGFuZ2VSYXRlOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogc2V0IG1pbiBldGggY29udHJpYnV0ZQoJICogQHBhcmFtIF9taW5Db250cmlidXRpb24gLSBtaW4gZXRoIHRvIGNvbnRyaWJ1dGUKCSAqLwoJZnVuY3Rpb24gc2V0TWluQ29udHJpYnV0aW9uKHVpbnQyNTYgX21pbkNvbnRyaWJ1dGlvbikgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZShfbWluQ29udHJpYnV0aW9uPjApOwoJCW1pbkNvbnRyaWJ1dGlvbj1fbWluQ29udHJpYnV0aW9uOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogQ2hhbmdlIG11bHRpLXNpZyBhZGRyZXNzLCB0aGUgYWRkcmVzcyB0byByZWNlaXZlIEVUSAoJICogQHBhcmFtIF9ldGhGdW5kRGVwb3NpdCAtIG5ldyBtdWx0aS1zaWcgYWRkcmVzcwoJICovCglmdW5jdGlvbiBzZXRFdGhGdW5kRGVwb3NpdChhZGRyZXNzIF9ldGhGdW5kRGVwb3NpdCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZShfZXRoRnVuZERlcG9zaXQgIT0gYWRkcmVzcygwKSk7CgkJZXRoRnVuZERlcG9zaXQ9X2V0aEZ1bmREZXBvc2l0OwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogU2V0IG1heCBnYXMgdG8gcmVmdW5kIHdoZW4gYW4gYWRkcmVzcyBzZW5kIEVUSCB0byBidXkgdG9rZW5zCgkgKiBAcGFyYW0gX21heEdhc1JlZnVuZCAtIG1heCBnYXMKCSAqLwoJZnVuY3Rpb24gc2V0TWF4R2FzUmVmdW5kKHVpbnQyNTYgX21heEdhc1JlZnVuZCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CgkJcmVxdWlyZShfbWF4R2FzUmVmdW5kID4gMCk7CgkJbWF4R2FzUmVmdW5kID0gX21heEdhc1JlZnVuZDsKCQlyZXR1cm4gdHJ1ZTsKCX0KfQ=='.
	

]
