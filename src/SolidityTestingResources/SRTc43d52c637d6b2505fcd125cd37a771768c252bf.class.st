Class {
	#name : #SRTc43d52c637d6b2505fcd125cd37a771768c252bf,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc43d52c637d6b2505fcd125cd37a771768c252bf >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8qKgogKiBAdGl0bGUgTWFzdGVyaXVtIFRva2VuIFtNVEldCiAqIEBhdXRob3IgcHJpbWVSZXYKICogQG5vdGljZSBtYXN0ZXJpdW0gW210aV0gdG9rZW4gY29udHJhY3QgKHRva2Vuc2FsZSwgKGN1bW11bGF0ZWQpIGludGVyZXN0IHBheW91dHMsIG1hc3Rlcm5vZGVzCiAqLwoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHt1aW50MjU2IGMgPSBhICogYjsgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsgcmV0dXJuIGM7fQogICAgLy91bnVzZWQ6OiBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nikge3VpbnQyNTYgYyA9IGEgLyBiOyByZXR1cm4gYzt9CiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nikge2Fzc2VydChiIDw9IGEpOyByZXR1cm4gYSAtIGI7fQogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHt1aW50MjU2IGMgPSBhICsgYjsgYXNzZXJ0KGMgPj0gYSk7IHJldHVybiBjO30KfQoKLyoqCiAqIEB0aXRsZSBSZWVudHJ5UHJvdGVjdGVkCiAqIEBkZXYgTXV0ZXggYmFzZWQgcmVlbnRyeSBwcm90ZWN0aW9uCiAqLwpjb250cmFjdCBSZWVudHJ5UHJvdGVjdGVkIHsKICAgIC8qCiAgICBmaWxlOiAgIFJlZW50cnlQcm90ZWN0aW9uLnNvbCAoaHR0cHM6Ly9naXRodWIuY29tL28wcmFnbWFuMG8vUmVlbnRyeVByb3RlY3RlZCkKICAgIHZlcjogICAgMC4zLjAKICAgIHVwZGF0ZWQ6Ni1BcHJpbC0yMDE2CiAgICBhdXRob3I6IERhcnJ5bCBNb3JyaXMKICAgIGVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20KCiAgICBNdXRleCBiYXNlZCByZWVudHJ5IHByb3RlY3Rpb24gcHJvdGVjdC4KCiAgICBUaGlzIHNvZnR3YXJlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCiAgICA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAgICAqLwogICAgLy8gVGhlIHJlZW50cnkgcHJvdGVjdGlvbiBzdGF0ZSBtdXRleC4KICAgIGJvb2wgX19yZU11dGV4OwoKICAgIC8vIFRoaXMgbW9kaWZpZXIgY2FuIGJlIHVzZWQgb24gZnVuY3Rpb25zIHdpdGggZXh0ZXJuYWwgY2FsbHMgdG8KICAgIC8vIHByZXZlbnQgcmVlbnRyeSBhdHRhY2tzLgogICAgLy8gQ29uc3RyYWludHM6CiAgICAvLyAgIFByb3RlY3RlZCBmdW5jdGlvbnMgbXVzdCBoYXZlIG9ubHkgb25lIHBvaW50IG9mIGV4aXQuCiAgICAvLyAgIFByb3RlY3RlZCBmdW5jdGlvbnMgY2Fubm90IHVzZSB0aGUgYHJldHVybmAga2V5d29yZAogICAgLy8gICBQcm90ZWN0ZWQgZnVuY3Rpb25zIHJldHVybiB2YWx1ZXMgbXVzdCBiZSB0aHJvdWdoIHJldHVybiBwYXJhbWV0ZXJzLgogICAgbW9kaWZpZXIgcHJldmVudFJlZW50cnkoKSB7CiAgICAgICAgcmVxdWlyZSghX19yZU11dGV4KTsKICAgICAgICBfX3JlTXV0ZXggPSB0cnVlOwogICAgICAgIF87CiAgICAgICAgZGVsZXRlIF9fcmVNdXRleDsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAvKiB1bnVzZWQ6OgogICAgLy8gVGhpcyBtb2RpZmllciBjYW4gYmUgYXBwbGllZCB0byBwdWJsaWMgYWNjZXNzIHN0YXRlIG11dGF0aW9uIGZ1bmN0aW9ucwogICAgLy8gdG8gcHJvdGVjdCBhZ2FpbnN0IHJlZW50cnkgaWYgYSBgcHJldmVudFJlZW50cnlgIGZ1bmN0aW9uIGhhcyBhbHJlYWR5CiAgICAvLyBzZXQgdGhlIG11dGV4LiBUaGlzIHByZXZlbnRzIHRoZSBjb250cmFjdCBmcm9tIGJlaW5nIHJlZW50ZXIgdW5kZXIgYQogICAgLy8gZGlmZmVyZW50IG1lbW9yeSBjb250ZXh0IHdoaWNoIGNhbiBicmVhayBzdGF0ZSB2YXJpYWJsZSBpbnRlZ3JpdHkuCiAgICBtb2RpZmllciBub1JlZW50cnkoKSB7CiAgICAgICAgcmVxdWlyZSghX19yZU11dGV4KTsKICAgICAgICBfOwogICAgfQogICAgKi8KfQoKLyoqCiAqIEB0aXRsZSBNYXN0ZXJpdW0gVG9rZW4gW01USV0KICogQGF1dGhvciBwcmltZVJldgogKiBAbm90aWNlIG1hc3Rlcml1bSBbbXRpXSB0b2tlbiBjb250cmFjdCAodG9rZW5zYWxlLCAoY3VtbXVsYXRlZCkgaW50ZXJlc3QgcGF5b3V0cywgbWFzdGVybm9kZXMKICogQGRldiBjb2RlIGlzIGhlYXZpbHkgY29tbWVudGVkLCBmZWVsIGZyZWUgdG8gY2hlY2sgaXQKICovCmNvbnRyYWN0IE1hc3Rlcml1bVRva2VuIGlzIFJlZW50cnlQcm90ZWN0ZWQgIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDggIHB1YmxpYyBkZWNpbWFsczsKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbjsKCiAgICAvLyB1c2VkIHRvIHNjYWxlIHRva2VuIGFtb3VudHMgdG8gMTggZGVjaW1hbHMKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgVE9LRU5fTVVMVElQTElFUiA9IDFlMTg7CgogICAgYWRkcmVzcyBpbnRlcm5hbCBjb250cmFjdE93bmVyOwoKICAgIC8vIERFQlVHCiAgICBib29sICAgIGludGVybmFsIGRlYnVnID0gZmFsc2U7CgogICAgLy8gaW4gZGVidWdnaW5nIG1vZGUKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgREVCVUdfU0FMRUZBQ1RPUiA9IDE7IC8vIDEwMCAtPiBhZGRpdGlvbmFsIGZhY3RvciBmb3IgRVRIIHRvIFRva2VuIGNhbGN1bGF0aW9uCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IERFQlVHX1NUQVJUREVMQVkgPSAxIG1pbnV0ZXM7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IERFQlVHX0lOVEVSVkFMICAgPSAxIGRheXM7CgogICAgLy8gaW4gcHJvZHVjdGlvbiBtb2RlCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFBST0RVQ1RJT05fU0FMRUZBQ1RPUiA9IDE7ICAgICAgICAgICAvLyBhZGRpdGlvbmFsIHRva2Vuc2FsZSBleGNoYW5nZSByYXRlIGZhY3RvciBUb2tlbnMgcGVyIEVUSDogcHJvZHVjdGlvbiA9IDEKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUFJPRFVDVElPTl9TVEFSVCAgICAgID0gMTUxMTYxMTIwMDsgIC8vIHRva2Vuc2FsZSBzdGFydHMgYXQgdW5pdHRpbWVzdGFtcDogMTUxMTYxMTIwMCA9IDExLzI1LzIwMTcgQCAxMjowMHBtIChVVEMpIChhcHByb3guICsvLTkwMCBzZWMuKQogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQUk9EVUNUSU9OX0lOVEVSVkFMICAgPSAzMCBkYXlzOwoKICAgIGV2ZW50IERlYnVnVmFsdWUoc3RyaW5nIHRleHQsIHVpbnQyNTYgdmFsdWUpOwoKCgogICAgc3RydWN0IEFjY291bnQgewogICAgICAgIHVpbnQyNTYgYmFsYW5jZTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBiYWxhbmNlIGluY2x1ZGluZyBhbHJlYWR5IHBheWVkIG91dCBpbnRlcmVzdAogICAgICAgIHVpbnQyNTYgbGFzdFBheW91dEludGVydmFsOyAgICAgICAgICAgICAvLyBpbnRlcnZhbC1pbmRleCBvZiBsYXN0IHBheW91dAogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBBY2NvdW50KSAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbCBhY2NvdW50czsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikpICBwdWJsaWMgYWxsb3dlZDsKCgogICAgdWludDI1NiBpbnRlcm5hbCBfc3VwcGx5VG90YWw7CiAgICB1aW50MjU2IGludGVybmFsIF9zdXBwbHlMYXN0UGF5b3V0SW50ZXJ2YWw7IC8vIGludGVydmFsIG9mIGxhc3QgcHJvY2Vzc2VkIGludGVyZXN0IHBheW91dAoKCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIC8vICsKICAgIC8vICsgaW50ZXJlc3Qgc3R1ZmYKICAgIC8vICsKICAgIC8vICsgaW50ZXJlc3QgaXMgcGF5ZWQgb3V0IGV2ZXJ5IDMwIGRheXMgKGludGVydmFsKQogICAgLy8gKyBpbnRlcmVzdC1yYXRlIGlzIGEgZnVuY3Rpb24gb2YgaW50ZXJ2YWwtaW5kZXggJSBwZXJpb2RpY2l0eQogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICBzdHJ1Y3QgSW50ZXJlc3RDb25maWcgewogICAgICAgIHVpbnQyNTYgaW50ZXJ2YWw7ICAgICAgICAgICAvLyBpbnRlcmVzdCBpcyBwYWlkIGV2ZXJ5IHggc2Vjb25kcyAoZGVmYXVsdDogMzAgZGF5cykKICAgICAgICB1aW50MjU2IHBlcmlvZGljaXR5OyAgICAgICAgLy8gaW50ZXJlc3QtcmF0ZSBjaGFuZ2UgYnkgdGltZSBhbmQgcmVzdGFydCBhZnRlciAicGVyaW9kaWNpdHkiCiAgICAgICAgdWludDI1NiBzdG9wQXRJbnRlcnZhbDsgICAgIC8vIG5vIG1vcmUgaW50ZXJlc3QgYWZ0ZXIgc3RvcC1pbmRleAogICAgICAgIHVpbnQyNTYgc3RhcnRBdFRpbWVzdGFtcDsgICAvLyB0aW1lIHRoZSBpbnRlcnZhbC1pbmRleCBzdGFydHMgaW5jcmVhc2luZwogICAgfQoKICAgIEludGVyZXN0Q29uZmlnIGludGVybmFsIGludGVyZXN0Q29uZmlnOyAvLyBzZXQgaW4gY29uc3RydWN0b3I6OiA9IEludGVyZXN0Q29uZmlnKDMwIGRheXMsMTIsNDgsMCk7CgogICAgdWludDI1NlsxMl0gaW50ZXJuYWwgaW50ZXJlc3RSYXRlczsKICAgIHVpbnQyNTZbNF0gIGludGVybmFsIHN0YWdlRmFjdG9yczsKCgoKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgLy8gKwogICAgLy8gKyBtYXN0ZXJub2RlIHN0dWZmCiAgICAvLyArCiAgICAvLyArIGV2ZXJ5IHRva2VuLXRyYW5zYWN0aW9uIGNvc3RzIGEgZmVlLCBwYXllZCBpbiB0b2tlbnMgKDAuMDEpCiAgICAvLyArIE1hc3Rlcm5vZGVzIGVhcm4gdGhlIGZlZXMKICAgIC8vICsgTWFzdGVybm9kZXMgZ2V0IGRvdWJsZSBpbnRlcmVzdAogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICBzdHJ1Y3QgU3RydWN0TWFzdGVybm9kZSB7CiAgICAgICAgdWludDggICBhY3RpdmVNYXN0ZXJub2RlczsgICAgICAgICAgICAgIC8vIGNvdW50IG9mIHJlZ2lzdGVyZWQgTU4KICAgICAgICB1aW50MjU2IHRvdGFsQmFsYW5jZVdlaTsgICAgICAgICAgICAgICAgLy8gaW4gdGhlIGNvbnRyYWN0IGRlcG9zaXRlZCBldGhlciAoaW4gd2VpKQogICAgICAgIHVpbnQyNTYgcmV3YXJkUG9vbDsgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IHVzZWQgaWYgbm8gbWFzdGVybm9kZSBpcyByZWdpc3RlcmVkIC0+IGFsbCB0cmFuc2FjdGlvbiBmZWVzIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHJld2FyZFBvb2wgYW5kIHBheWVkIG91dCB0byB0aGUgZmlyc3QgbWFzdGVybm9kZSByZWdpc3RlcmluZwogICAgICAgIHVpbnQyNTYgcmV3YXJkc1BheWVkVG90YWw7ICAgICAgICAgICAgICAvLyBsb2cgYWxsIHBheW91dHMgZm9yIE1OLXN0YXRpc3RpY3MKCiAgICAgICAgdWludDI1NiBtaW5pbmdSZXdhcmRJblRva2VuczsgICAgICAgICAgIC8vIG1hc3Rlcm5vZGVzIGNhbiBtaW5lIHggdG9rZW5zIHBlciBpbnRlcnZhbAogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnNNaW5lZFJhdzFlMTg7ICAgICAgICAvLyBsb2dnaW5nOiB0b3RhbCB0b2tlbnMgbWluZWQgdGlsbCBub3cKCiAgICAgICAgdWludDI1NiB0cmFuc2FjdGlvblJld2FyZEluU3VidG9rZW5zUmF3MWUxODsvL2ZlZSwgc3VidHJhY3RlZCBmcm9tIHRva2VuIHNlbmRlciBvbiBldmVyeSB0cmFuc2FjdGlvbgoKICAgICAgICB1aW50MjU2IG1pbkJhbGFuY2VSZXF1aXJlZEluVG9rZW5zOyAgICAgLy8gdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlIC0+IGEgYmFsYW5jZSBvZiAxMDAwMDAgdG9rZW5zIGlzIHJlcXVpcmVkCiAgICAgICAgdWludDI1NiBtaW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTg7Ly8gKCoxZTE4IGZvciBpbnRlcm5hbCBpbnRlZ2VyIGNhbGN1bGF0aW9ucykKCiAgICAgICAgdWludDI1NiBtaW5EZXBvc2l0UmVxdWlyZWRJbkV0aGVyOyAgICAgIC8vIHRvIHJlZ2lzdGVyIGEgbWFzdGVybm9kZSBhIGRlcG9zaXQgaW4gZXRoZXIgaXMgcmVxdWlyZWQgLT4gaXMgYSBmdW5jdGlvbiBvZiBjb3VudDogImFjdGl2ZU1hc3Rlcm5vZGVzIgogICAgICAgIHVpbnQyNTYgbWluRGVwb3NpdFJlcXVpcmVkSW5XZWk7ICAgICAgICAvLyAuLi4gc2FtZSBpbiB3ZWkgKGZvciBpbnRlcm5hbCB1c2UpCiAgICAgICAgdWludDggICBtYXhNYXN0ZXJub2Rlc0FsbG93ZWQ7ICAgICAgICAgIC8vIG5vIG1vcmUgdGhhbiB4IG1hc3Rlcm5vZGVzIGFsbG93ZWQsIGRlZmF1bHQ6IDIyCiAgICB9CgogICAgc3RydWN0IE1hc3Rlcm5vZGUgewogICAgICAgIGFkZHJlc3MgYWRkcjsgICAgICAgICAgIC8vIDE2MCBiaXQgICAgICAvLyB3YWxsZXQtYWRkcmVzc2VzIG9mIG1hc3Rlcm5vZGUgb3duZXIKICAgICAgICB1aW50MjU2IGJhbGFuY2VXZWk7ICAgICAvLyAgOTYgYml0ICAgICAgLy8gYW1vdW50IGV0aGVyIGRlcG9zaXRlZCBpbiB0aGUgY29udHJhY3QKICAgICAgICB1aW50MjU2IHNpbmNlSW50ZXJ2YWw7ICAgICAgICAgICAgICAgICAgLy8gTU4gY3JlYXRlZCBhdCB0aGlzIGludGVydmFsLWluZGV4CiAgICAgICAgdWludDI1NiBsYXN0TWluaW5nSW50ZXJ2YWw7ICAgICAgICAgICAgIC8vIGxhc3QgaW50ZXJ2YWwgYSBNTiBtaW5lZCBuZXcgY29pbnMKICAgIH0KCiAgICBTdHJ1Y3RNYXN0ZXJub2RlIHB1YmxpYyBtYXN0ZXJub2RlOyAvLyA9IFN0cnVjdE1hc3Rlcm5vZGUoMCwwLDAsMCwxMDAwMDAgZXRoZXIsIDAuMDEgZXRoZXIsMSwxIGV0aGVyLDIyKTsKICAgIE1hc3Rlcm5vZGVbMjJdICAgcHVibGljIG1hc3Rlcm5vZGVzOwogICAgdWludDggaW50ZXJuYWwgY29uc3RhbnQgbWF4TWFzdGVybm9kZXMgPSAyMjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgbWluaW5nUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4OyAvLyAoKjFlMTggZm9yIGludGVybmFsIGludGVnZXIgY2FsY3VsYXRpb25zKQoKCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIC8vICsKICAgIC8vICsgdG9rZW5zYWxlIHN0dWZmCiAgICAvLyArCiAgICAvLyArIDIwIE1pby4gVG9rZW5zIGNyZWF0ZWQgYXQgY29udHJhY3Qgc3RhcnQgKGFkbWluIHdhbGxldCkKICAgIC8vICsgY29udHJpYnV0ZXJzIGNhbiBidXkgYnkgIkJ1eSItZnVuY3Rpb24gLT4gRVRIIHNlbmQgdG8gYWRtaW5XYWxsZXQKICAgIC8vICsgY29udHJpYnV0ZXJzIGNhbiBidXkgYnkgZmFpbHNhdmUtZnVuY3Rpb24gLT4gRVRIIHNlbmQgdG8gY29udHJhY3QsIGFkbWluIGNhbiB3aXRoZHJhdwogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCgogICAgc3RydWN0IFN0cnVjdHRva2Vuc2FsZSB7IC8vIGNvbXBpbGVyIGxpbWl0OiBtYXguIDE2IHZhcnMgLT4gc3RhY2sgdG9vIGRlZXAKICAgICAgICAvLyAxIHRva2VuID0gMWUxOCBzdWJUb2tlbnMgKHNtYWxsZXN0IHRva2VuIHVuaXQsIHVzZWQgZm9yIGludGVybmFsIGludGVnZXIgcHJvY2Vzc2luZykKICAgICAgICB1aW50MjU2IGluaXRpYWxUb2tlblN1cHBseVJBVzFlMTg7ICAgICAgLy8gVG9rZW5zIGludGVybmFsIHJlc29sdXRpb246IDFlMTggPSAxIEV0aGVyID0gMWUxOCBXZWkKICAgICAgICB1aW50MjU2IGluaXRpYWxUb2tlblN1cHBseUFtb3VudDsKICAgICAgICB1aW50MjU2IGluaXRpYWxUb2tlblN1cHBseUZyYWN0aW9uOwoKICAgICAgICB1aW50MjU2IG1pblBheW1lbnRSZXF1aXJlZFVuaXRXZWk7ICAgICAgLy8gbWluLiBwYXltZW50IHJlcXVpcmVkIGZvciBidXlpbmcgdG9rZW5zLCBkZWZhdWx0OiAwLjAwMDEgRVRICiAgICAgICAgdWludDI1NiBtYXhQYXltZW50QWxsb3dlZFVuaXRXZWk7ICAgICAgIC8vIGxpbWl0IG1heC4gYWxsb3dlZCBwYXltZW50IHBlciBidXkgdG8gMTAwIEVUSAoKICAgICAgICB1aW50MjU2IHN0YXJ0QXRUaW1lc3RhbXA7ICAgICAgICAgICAgICAgLy8gdW5peHRpbWUgdGhlIHRva2Vuc2FsZSBzdGFydHMKCiAgICAgICAgYm9vbCAgICB0b2tlblNhbGVDbG9zZWQ7ICAgICAgICAgICAgICAgIC8vIHNldCB0byB0cnVlIGJ5IGFkbWluIChtYW51YWxseSkgb3IgY29udHJhY3QgKGF1dG9tYXRpY2FsbHkgaWYgbWF4LiBzdXBwbHkgcmVhY2hlZCkgaWYgc2FsZSBpcyBjbG9zZWQKICAgICAgICBib29sICAgIHRva2VuU2FsZVBhdXNlZDsgICAgICAgICAgICAgICAgLy8gYWRtaW4gY2FuIHRlbXAuIHBhdXNlIHRva2Vuc2FsZQoKICAgICAgICB1aW50MjU2IHRvdGFsV2VpUmFpc2VkOyAgICAgICAgICAgICAgICAgLy8gYnkgdG9rZW5zYWxlCiAgICAgICAgdWludDI1NiB0b3RhbFdlaUluRmFsbGJhY2s7ICAgICAgIC8vIGlmIHNvbWVvbmUgc2VuZCBldGhlciBkaXJlY3RseSB0byBjb250cmFjdCAtPiBhZG1pbiBjYW4gd2l0aGRyYXcgdGhpcyBiYWxhbmNlCgogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTg7CiAgICAgICAgdWludDI1NiB0b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkQW1vdW50OwogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnNEaXN0cmlidXRlZEZyYWN0aW9uOwogICAgfQoKICAgIFN0cnVjdHRva2Vuc2FsZSBwdWJsaWMgdG9rZW5zYWxlOwogICAgYWRkcmVzcyBhZG1pbldhbGxldDsgICAgICAgIC8vIDE2MCBiaXQKICAgIGJvb2wgICAgc2VuZEZ1bmRzVG9XYWxsZXQ7ICAvLyAxIGJpdCAgICAvLyBkZWZhdWx0OnRydWUgLT4gdHJhbnNmZXIgZXRoIG9uIGJ1eTsgZmFsc2UgLT4gYWRtaW4gbXVzdCB3aXRoZHJhdwogICAgdWludDI1NiBpbnRlcm5hbCBjb250cmFjdENyZWF0aW9uVGltZXN0YW1wOyAgICAgIC8vIChhcHByb3guKSBjcmVhdGlvbiB0aW1lIG9mIGNvbnRyYWN0IC0+IGJhc2UgZm9yIGludGVydmFsLWluZGV4IGNhbGN1bGF0aW9uCiAgICB1aW50MjU2WzIwXSB0b2tlbnNhbGVGYWN0b3I7CgogICAgLyogIC8vIGRlYnVnIG9ubHk6IGxvZyBhbGwgY29udGlidXRlcnMgKi8KICAgIHN0cnVjdCBDb250cmlidXRvciB7CiAgICAgICAgYWRkcmVzcyBhZGRyOwogICAgICAgIHVpbnQyNTYgYW1vdW50V2VpOwogICAgICAgIHVpbnQyNTYgYW1vdW50VG9rZW5zVW5pdDFlMTg7CiAgICAgICAgdWludDI1NiBzaW5jZUludGVydmFsOwogICAgfQoKICAgIENvbnRyaWJ1dG9yW10gcHVibGljIHRva2Vuc2FsZUNvbnRyaWJ1dG9yczsgLy8gYXJyYXkgb2YgYWxsIGNvbnRyaWJ1dG9ycwogICAgLyogKi8KCgoKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgLy8gKwogICAgLy8gKyBjb250cmFjdCBjb25zdHJ1Y3RvciAtPiBpbml0IGRlZmF1bHQgdmFsdWVzCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIGZ1bmN0aW9uIE1hc3Rlcml1bVRva2VuKCkgcGF5YWJsZSBwdWJsaWMgeyAvLyBjb25zdHJ1Y3RvcgogICAgICAgIC8vIGNvbnRyYWN0IGNyZWF0aW9uOiAzOTkzMzE3CiAgICAgICAgbmFtZSAgICAgPSAoZGVidWcpID8gIk1hc3Rlcml1bV9UZXN0bmV0IiA6ICJNYXN0ZXJpdW0iOwogICAgICAgIHN5bWJvbCAgID0gKGRlYnVnKSA/ICJNVElUZXN0bmV0MSIgOiAiTVRJIjsKICAgICAgICB2ZXJzaW9uICA9IChkZWJ1ZykgPyAiMS4wMC4wMS5UZXN0bmV0IiA6ICIxLjAwLjAxIjsKICAgICAgICBkZWNpbWFscyA9IDE4OyAvLyBpbnRlcm5hbCByZXNvbHV0aW9uID0gMWUxOCA9IDEgV2VpCgogICAgICAgIGNvbnRyYWN0T3duZXIgPSBtc2cuc2VuZGVyOwoKICAgICAgICBhZG1pbldhbGxldCA9IDB4QWI5NDIyNTZiNDlGMGM4NDFEMzcxREMzZEZlNzhiZUZlYTQ0N2EyNzsKCiAgICAgICAgc2VuZEZ1bmRzVG9XYWxsZXQgPSB0cnVlOwoKICAgICAgICBjb250cmFjdENyZWF0aW9uVGltZXN0YW1wID0gX2dldFRpbWVzdGFtcCgpOwoKICAgICAgICAvLyB0b2tlblNBTEU6IDIwIG1pbyB0b2tlbnMgY3JlYXRlZDsgYWxsIHRvIHNlbGw7CiAgICAgICAgdG9rZW5zYWxlLmluaXRpYWxUb2tlblN1cHBseVJBVzFlMTggPSAyMDAwMDAwMCAqIFRPS0VOX01VTFRJUExJRVI7IC8vIDIwIG1pbyB0b2tlbnMgPT0gMjAgbWlvICogMTBeMTggc3VidG9rZW5zIChzbWFsbGVzdCB1bml0IGZvciBpbnRlcm5hbCBwcm9jZXNzaW5nKTsKICAgICAgICB0b2tlbnNhbGUuaW5pdGlhbFRva2VuU3VwcGx5QW1vdW50ICA9IHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlSQVcxZTE4IC8gVE9LRU5fTVVMVElQTElFUjsKICAgICAgICB0b2tlbnNhbGUuaW5pdGlhbFRva2VuU3VwcGx5RnJhY3Rpb249IHRva2Vuc2FsZS5pbml0aWFsVG9rZW5TdXBwbHlSQVcxZTE4ICUgVE9LRU5fTVVMVElQTElFUjsKCiAgICAgICAgLy8gbGltaXQgYnV5IGFtb3VudCAocGVyIHRyYW5zYWN0aW9uKSBkdXJpbmcgdG9rZW5zYWxlIHRvIGEgcmFuZ2UgZnJvbSAwLjAwMDEgdG8gMTAwIGV0aGVyIHBlciAiYnV5dG9rZW5zIi1jb21tYW5kLgogICAgICAgIHRva2Vuc2FsZS5taW5QYXltZW50UmVxdWlyZWRVbml0V2VpID0gMC4wMDAxIGV0aGVyOyAvLyB0cmFuc2xhdGVzIHRvIDAuMDAwMSAqIDFlMTgKICAgICAgICB0b2tlbnNhbGUubWF4UGF5bWVudEFsbG93ZWRVbml0V2VpICA9IDEwMCBldGhlcjsgICAgLy8gdHJhbnNsYXRlcyB0byAxMDAuMDAgKiAxZTE4CgogICAgICAgIHJlcXVpcmUoYWRtaW5XYWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNhbGUuaW5pdGlhbFRva2VuU3VwcGx5UkFXMWUxOCA+IDApOwogICAgICAgIHJlcXVpcmUodG9rZW5zYWxlLm1pblBheW1lbnRSZXF1aXJlZFVuaXRXZWkgPiAwKTsKICAgICAgICByZXF1aXJlKHRva2Vuc2FsZS5tYXhQYXltZW50QWxsb3dlZFVuaXRXZWkgPiB0b2tlbnNhbGUubWluUGF5bWVudFJlcXVpcmVkVW5pdFdlaSk7CgogICAgICAgIHRva2Vuc2FsZS50b2tlblNhbGVQYXVzZWQgPSBmYWxzZTsKICAgICAgICB0b2tlbnNhbGUudG9rZW5TYWxlQ2xvc2VkID0gZmFsc2U7CgogICAgICAgIHRva2Vuc2FsZS50b3RhbFdlaVJhaXNlZCA9IDA7ICAgICAgICAgICAgICAgLy8gdG90YWwgYW1vdW50IG9mIHRva2VucyBidXllZCBkdXJpbmcgdG9rZW5zYWxlCiAgICAgICAgdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjayA9IDA7ICAgICAvLyB0aGUgZmFjdGlvbiBvZiB0b3RhbCBhbW91bnQgd2hpY2ggd2FzIGRvbmUgYnkgZmFpbHNhZmUgPSBkaXJlY3QgZXRoZXIgc2VuZCB0byBjb250cmFjdAoKICAgICAgICB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggPSAwOwogICAgICAgIHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkQW1vdW50ICA9IDA7CiAgICAgICAgdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRGcmFjdGlvbj0gMDsKCiAgICAgICAgdG9rZW5zYWxlLnN0YXJ0QXRUaW1lc3RhbXAgPSAoZGVidWcpID8gY29udHJhY3RDcmVhdGlvblRpbWVzdGFtcCArIF9hZGRUaW1lKERFQlVHX1NUQVJUREVMQVkpIDogUFJPRFVDVElPTl9TVEFSVDsvLyB0b2tlbnNhbGUgc3RhcnRzIGF0IHgKCiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzBdID0gMjAwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMV0gPSAxMDAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsyXSA9IDgwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbM10gPSA1MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzRdID0gNTAwOwogICAgICAgIHRva2Vuc2FsZUZhY3Rvcls1XSA9IDUwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbNl0gPSA1MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzddID0gNTAwOwogICAgICAgIHRva2Vuc2FsZUZhY3Rvcls4XSA9IDUwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbOV0gPSA0MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzEwXSA9IDQwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMTFdID0gNDAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxMl0gPSAyMDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzEzXSA9IDIwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMTRdID0gMjAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxNV0gPSA0MDA7CiAgICAgICAgdG9rZW5zYWxlRmFjdG9yWzE2XSA9IDUwMDsKICAgICAgICB0b2tlbnNhbGVGYWN0b3JbMTddID0gODAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxOF0gPSAxMDAwOwogICAgICAgIHRva2Vuc2FsZUZhY3RvclsxOV0gPSAyNTAwOwoKICAgICAgICBfc3VwcGx5VG90YWwgPSB0b2tlbnNhbGUuaW5pdGlhbFRva2VuU3VwcGx5UkFXMWUxODsKICAgICAgICBfc3VwcGx5TGFzdFBheW91dEludGVydmFsID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludGVydmFsIChpbmRleCkgb2YgbGFzdCBwcm9jZXNzZWQgaW50ZXJlc3QtcGF5b3V0IChpbml0aWF0ZWQgYnkgYSBnYXMgb3BlcmF0aW9uKQoKICAgICAgICBhY2NvdW50c1tjb250cmFjdE93bmVyXS5iYWxhbmNlID0gdG9rZW5zYWxlLmluaXRpYWxUb2tlblN1cHBseVJBVzFlMTg7CiAgICAgICAgYWNjb3VudHNbY29udHJhY3RPd25lcl0ubGFzdFBheW91dEludGVydmFsID0gMDsKICAgICAgICAvL2FjY291bnRzW2NvbnRyYWN0T3duZXJdLmxhc3RBY3Rpb24gPSBjb250cmFjdENyZWF0aW9uVGltZXN0YW1wOwoKICAgICAgICAvLyBNQVNURVJOT0RFOiBtYXN0ZXJub2RlcyBlYXJuIGFsbCB0cmFuc2FjdGlvbiBmZWVzIGZyb20gYmFsYW5jZSB0cmFuc2ZlcnMgYW5kIGNhbiBtaW5lIG5ldyB0b2tlbnMKICAgICAgICBtYXN0ZXJub2RlLnRyYW5zYWN0aW9uUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4ID0gMC4wMSAqICgxIGV0aGVyKTsgLy8gMC4wMSAqIDFlMTggc3VidG9rZW5zID0gMC4wMSB0b2tlbgoKICAgICAgICBtYXN0ZXJub2RlLm1pbmluZ1Jld2FyZEluVG9rZW5zID0gNTAwMDA7IC8vIDUwJzAwMCB0b2tlbnMgdG8gbWluZSBwZXIgbWFzdGVybm9kZSBwZXIgaW50ZXJ2YWwKICAgICAgICBtaW5pbmdSZXdhcmRJblN1YnRva2Vuc1JhdzFlMTggPSBtYXN0ZXJub2RlLm1pbmluZ1Jld2FyZEluVG9rZW5zICogVE9LRU5fTVVMVElQTElFUjsgLy8gdXNlZCBmb3IgaW50ZXJuYWwgaW50ZWdlciBjYWxjdWxhdGlvbgoKICAgICAgICBtYXN0ZXJub2RlLnRvdGFsVG9rZW5zTWluZWRSYXcxZTE4ID0gMDsgLy8gbG9ncyB0aGUgYW1vdW50IG9mIHRva2VucyBtaW5lZCBieSBtYXN0ZXJub2RlcwoKICAgICAgICBtYXN0ZXJub2RlLm1pbkJhbGFuY2VSZXF1aXJlZEluVG9rZW5zID0gMTAwMDAwOyAvL3RvIHJlZ2lzdGVyIGEgbWFzdGVybm9kZSAtPiBhIGJhbGFuY2Ugb2YgMTAwMDAwIHRva2VucyBpcyByZXF1aXJlZAogICAgICAgIG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4ID0gbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblRva2VucyAqIFRPS0VOX01VTFRJUExJRVI7IC8vIHVzZWQgZm9yIGludGVybmFsIGludGVnZXIgY2FsY3VsYXRpb24KCiAgICAgICAgbWFzdGVybm9kZS5tYXhNYXN0ZXJub2Rlc0FsbG93ZWQgPSB1aW50OChtYXhNYXN0ZXJub2Rlcyk7CiAgICAgICAgbWFzdGVybm9kZS5hY3RpdmVNYXN0ZXJub2Rlcz0gMDsKICAgICAgICBtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSAgPSAwOwogICAgICAgIG1hc3Rlcm5vZGUucmV3YXJkUG9vbCAgICAgICA9IDA7CiAgICAgICAgbWFzdGVybm9kZS5yZXdhcmRzUGF5ZWRUb3RhbD0gMDsKCiAgICAgICAgbWFzdGVybm9kZS5taW5EZXBvc2l0UmVxdWlyZWRJbkV0aGVyPSByZXF1aXJlZEJhbGFuY2VGb3JNYXN0ZXJub2RlSW5FdGhlcigpOy8vIHRvIHJlZ2lzdGVyIGEgbWFzdGVybm9kZSAtPiBhIGRlcG9zaXQgb2YgZXRoZXIgaXMgcmVxdWlyZWQgKGEgZnVuY3Rpb24gb2YgbnVtTWFzdGVybm9kZXMpCiAgICAgICAgbWFzdGVybm9kZS5taW5EZXBvc2l0UmVxdWlyZWRJbldlaSAgPSByZXF1aXJlZEJhbGFuY2VGb3JNYXN0ZXJub2RlSW5XZWkoKTsgLy8gdXNlZCBmb3IgaW50ZXJuYWwgaW50ZWdlciBjYWxjdWxhdGlvbgoKCiAgICAgICAgLy8gSU5URVJFU1Q6IGV2ZXJ5IHRva2VuaG9sZGVyIGVhcm4gaW50ZXJlc3QgKCUgb2YgYmFsYW5jZSkgYXQgYSBmaXhlZCBpbnRlcnZhbCAob25jZSBwZXIgMzAgZGF5cykKICAgICAgICBpbnRlcmVzdENvbmZpZy5pbnRlcnZhbCA9IF9hZGRUaW1lKCAoZGVidWcpID8gREVCVUdfSU5URVJWQUwgOiBQUk9EVUNUSU9OX0lOVEVSVkFMICk7IC8vIGludGVyZXN0IHBheW91dCBpbnRlcnZhbCBpbiBzZWNvbmRzLCBkZWZhdWx0OiBldmVyeSAzMCBkYXlzCiAgICAgICAgaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHkgICAgICA9IDEyOyAgICAvLyBpbnRlcmVzdEludGVydmFsQ2FwcGVkID0gaW50ZXJ2YWxJRFggJSBwZXJpb2RpY2l0eQogICAgICAgIGludGVyZXN0Q29uZmlnLnN0b3BBdEludGVydmFsICAgPSA0ICogaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHk7ICAvLyBzdG9wIHBheWluZyBpbnRlcmVzdCBhZnRlciB4IGludGVydmFscyAocGVyZm9ybWFuY2UgcmVhc29ucykKICAgICAgICBpbnRlcmVzdENvbmZpZy5zdGFydEF0VGltZXN0YW1wID0gdG9rZW5zYWxlLnN0YXJ0QXRUaW1lc3RhbXA7IC8vIGZpcnN0IHBheW91dCBpcyBhZnRlciBvbmUgaW50ZXJ2YWwKCiAgICAgICAgLy8gaW50ZXJlc3QgaXMgcmVkdWNlZCBldmVyeSAzMCBkYXlzIGFuZCByZXNldCB0byAxc3QgZXZlcnkgc3RhZ2UgKGFmdGVyIDEyIGludGVydmFscykKICAgICAgICBpbnRlcmVzdFJhdGVzWyAwXSA9IDEwMDAwMDAwMDAwMDA7IC8vIGludGVydmFsIDEgPSAxMDAlCiAgICAgICAgaW50ZXJlc3RSYXRlc1sgMV0gPSAgODAwMDAwMDAwMDAwOyAvLyA4MCUKICAgICAgICBpbnRlcmVzdFJhdGVzWyAyXSA9ICA2MDAwMDAwMDAwMDA7CiAgICAgICAgaW50ZXJlc3RSYXRlc1sgM10gPSAgNDAwMDAwMDAwMDAwOwogICAgICAgIGludGVyZXN0UmF0ZXNbIDRdID0gIDIwMDAwMDAwMDAwMDsKICAgICAgICBpbnRlcmVzdFJhdGVzWyA1XSA9ICAxMDAwMDAwMDAwMDA7CiAgICAgICAgaW50ZXJlc3RSYXRlc1sgNl0gPSAgIDUwMDAwMDAwMDAwOwogICAgICAgIGludGVyZXN0UmF0ZXNbIDddID0gICA1MDAwMDAwMDAwMDsKICAgICAgICBpbnRlcmVzdFJhdGVzWyA4XSA9ICAgMzAwMDAwMDAwMDA7CiAgICAgICAgaW50ZXJlc3RSYXRlc1sgOV0gPSAgIDQwMDAwMDAwMDAwOwogICAgICAgIGludGVyZXN0UmF0ZXNbMTBdID0gICAyMDAwMDAwMDAwMDsKICAgICAgICBpbnRlcmVzdFJhdGVzWzExXSA9ICAgMTAwMDAwMDAwMDA7IC8vICAgMSUKCiAgICAgICAgLy8gaW50ZXJlc3RSYXRlcyBhcmUgcmVkdWNlZCBieSBmYWN0b3IgZXZlcnkgMTIgaW50ZXJ2YWxzID0gMSBzdGFnZQogICAgICAgIHN0YWdlRmFjdG9yc1swXSA9ICAxMDAwMDAwMDAwMDAwOyAvLyBpbnRlcnZhbCAgMS4uMTIgPSBmYWN0b3IgMQogICAgICAgIHN0YWdlRmFjdG9yc1sxXSA9ICA0MDAwMDAwMDAwMDAwOyAvLyBpbnRlcnZhbCAxMy4uMjQgPSBmYWN0b3IgNAogICAgICAgIHN0YWdlRmFjdG9yc1syXSA9ICA4MDAwMDAwMDAwMDAwOwogICAgICAgIHN0YWdlRmFjdG9yc1szXSA9IDE2MDAwMDAwMDAwMDAwOwogICAgfQoKCgoKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgLy8gKwogICAgLy8gKyBFUkMyMCBzdHVmZgogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICAgIC8vZXZlbnQgSW50ZXJlc3RQYXllZChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgaW50ZXJlc3RQYXllZCk7CgogICAgLy8gZXJjMjA6IHRyYW1zZmVyRnJvbTo6IEFsbG93IF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20geW91ciBhY2NvdW50LCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBlcmMyMDogdHJhbXNmZXJGcm9tOjogUmV0dXJucyB0aGUgYW1vdW50IHdoaWNoIF9zcGVuZGVyIGlzIHN0aWxsIGFsbG93ZWQgdG8gd2l0aGRyYXcgZnJvbSBfb3duZXIKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8gZXJjMjA6IHRyYW1zZmVyRnJvbQogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBlcmMyMDogdHJhbXNmZXJGcm9tCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50MjU2IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIGVyYzIwOiBwdWJsaWMgKGNvbW1hbmQpOiB0b2tlbiB0cmFuc2ZlciBieSBvd25lciB0byBzb21lb25lCiAgICAvLyBhdHRuOiB0b3RhbCA9IF92YWx1ZSArIHRyYW5zYWN0aW9uRmVlICEhISAtPiBhY2NvdW50LWJhbGFuY2UgPj0gX3ZhbHVlICsgdHJhbnNhY3Rpb25GZWUKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfc2V0QmFsYW5jZXMobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOyAvLyB3aWxsIGZhaWwgaWYgbm90IGVub3VnaCBiYWxhbmNlCiAgICAgICAgX3NlbmRGZWVzVG9NYXN0ZXJub2RlcyhtYXN0ZXJub2RlLnRyYW5zYWN0aW9uUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4KTsKCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIGVyYzIwOiBwdWJsaWMgKGNvbW1hbmQpOiBTZW5kIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgLy8gYXR0bjogdG90YWwgPSBfdmFsdWUgKyB0cmFuc2FjdGlvbkZlZSAhISEgLT4gYWNjb3VudC1iYWxhbmNlID49IF92YWx1ZSArIHRyYW5zYWN0aW9uRmVlCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOyAvLyB3aWxsIGZhaWwgaWYgbm8gKG5vdCBlbm91Z2gpIGFsbG93YW5jZQogICAgICAgIF9zZXRCYWxhbmNlcyhfZnJvbSwgX3RvLCBfdmFsdWUpOyAgLy8gd2lsbCBmYWlsIGlmIG5vdCBlbm91Z2ggYmFsYW5jZQogICAgICAgIF9zZW5kRmVlc1RvTWFzdGVybm9kZXMobWFzdGVybm9kZS50cmFuc2FjdGlvblJld2FyZEluU3VidG9rZW5zUmF3MWUxOCk7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gZXJjMjA6IHB1YmxpYyAocmVhZCBvbmx5KQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiAvKnRvdGFsU3VwcGx5Ki8pIHsKICAgICAgICByZXR1cm4gX2NhbGNCYWxhbmNlKF9zdXBwbHlUb3RhbCwgX3N1cHBseUxhc3RQYXlvdXRJbnRlcnZhbCwgaW50ZXJ2YWxOb3coKSk7CiAgICB9CgogICAgLy8gZXJjMjAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBfY2FsY0JhbGFuY2UoYWNjb3VudHNbX293bmVyXS5iYWxhbmNlLCBhY2NvdW50c1tfb3duZXJdLmxhc3RQYXlvdXRJbnRlcnZhbCwgaW50ZXJ2YWxOb3coKSk7CiAgICB9CgogICAgLy8gcHVibGljIChyZWFkIG9ubHkpOiBqdXN0IHRvIGxvb2sgcHJldHR5IC0+IHNwbGl0IDFlMTggcmVvbHV0aW9uIHRvIG1haW51bml0cyBhbmQgdGhlIGZyYWN0aW9uIHBhcnQsIGp1c3QgZm9yIGRpcmVjdCBlbmR1c2VyIGxvb2t5bG9va3kgYXQgY29udHJhY3QgdmFyaWFibGVzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseVByZXR0eSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRva2VucywgdWludDI1NiBmcmFjdGlvbikgewogICAgICAgIHVpbnQyNTYgX3JhdyA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgdG9rZW5zICA9IF9yYXcgLyBUT0tFTl9NVUxUSVBMSUVSOwogICAgICAgIGZyYWN0aW9uPSBfcmF3ICUgVE9LRU5fTVVMVElQTElFUjsKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IGp1c3QgdG8gbG9vayBwcmV0dHkgLT4gc3BsaXQgMWUxOCByZW9sdXRpb24gdG8gbWFpbnVuaXRzIGFuZCB0aGUgZnJhY3Rpb24gcGFydCwganVzdCBmb3IgZGlyZWN0IGVuZHVzZXIgbG9va3lsb29reSBhdCBjb250cmFjdCB2YXJpYWJsZXMKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZlByZXR0eShhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG9rZW5zLCB1aW50MjU2IGZyYWN0aW9uKSB7CiAgICAgICAgdWludDI1NiBfcmF3ID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgdG9rZW5zICA9IF9yYXcgLyBUT0tFTl9NVUxUSVBMSUVSOwogICAgICAgIGZyYWN0aW9uPSBfcmF3ICUgVE9LRU5fTVVMVElQTElFUjsKICAgIH0KCgogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICAvLyArCiAgICAvLyArIEludGVyZXN0IHN0dWZmCiAgICAvLyArCiAgICAvLyArIGV2ZXJ5IHRva2VuIGhvbGRlciByZWNlaXZlcyBpbnRlcmVzdCAoYmFzZWQgb24gdG9rZW4gYmFsYW5jZSkgYXQgZml4ZWQgaW50ZXJ2YWxzIChieSBkZWZhdWx0OiAzMCBkYXlzKQogICAgLy8gKwogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCgogICAgLy8gcHVibGljIChyZWFkIG9ubHkpOiBzdGFnZSA9IGhvdyBtYW55IGludGVydmFsIGN5Y2xlcyBjb21wbGV0ZWQ7IGluY3JlYXNlIGV2ZXJ5IDEyIGludGVydmFscyBieSAxOyAxIHN0YWdlID0gYXBwcm94LiAxIHllYXIKICAgIC8vIHN0YWdlIGlzIHVuc2VkIGluIGludGVyZXN0IGNhbGN1bGF0aW9uIC0+IHllYXJseSBmYWN0b3IKICAgIC8vIHVubmVjZXNzYXJ5IC0+IGp1c3QgZm9yIGVuZHVzZXIgbG9va3lsb29reQogICAgZnVuY3Rpb24gc3RhZ2VOb3coKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBpbnRlcnZhbE5vdygpIC8gaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHk7CiAgICB9CgogICAgLy8gcHVibGljIChyZWFkIG9ubHkpOiBpbnRlcnZhbCA9IGluZGV4IG9mIHRoZSBhY3RpdmUgaW50ZXJlc3QgaW50ZXJ2YWwuIGZpcnN0IGludGVydmFsID0gMDsgaW5jcmVhc2UgZXZlcnkgMzAgZGF5cyBieSAxOyAxIGludGVydmFsID0gYXBwcm94IDEgbW9udGgKICAgIC8vIGludGVydmFsIGlzIHVzZWQgZm9yIGludGVyZXN0IHBheW91dHMgYW5kIHZhbGlkYXRpbmcgbWFzdGVybm9kZSBtaW5pbmcgaW50ZXJ2YWwKICAgIGZ1bmN0aW9uIGludGVydmFsTm93KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHRpbWVzdGFtcCA9IF9nZXRUaW1lc3RhbXAoKTsKICAgICAgICByZXR1cm4gKHRpbWVzdGFtcCA8IGludGVyZXN0Q29uZmlnLnN0YXJ0QXRUaW1lc3RhbXApID8gMCA6ICh0aW1lc3RhbXAgLSBpbnRlcmVzdENvbmZpZy5zdGFydEF0VGltZXN0YW1wKSAvIGludGVyZXN0Q29uZmlnLmludGVydmFsOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogdW5peHRpbWUgdG8gbmV4dCBpbnRlcmVzdCBwYXlvdXQKICAgIC8vIHVubmVjZXNzYXJ5IC0+IGp1c3QgZm9yIGVuZHVzZXIgbG9va3lsb29reQogICAgZnVuY3Rpb24gc2VjVG9OZXh0SW50ZXJlc3RQYXlvdXQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChpbnRlcnZhbE5vdygpID4gaW50ZXJlc3RDb25maWcuc3RvcEF0SW50ZXJ2YWwpIHJldHVybiAwOyAvLyBubyBpbnRlcmVzdCBhZnRlciB4IGludGVydmFscwogICAgICAgIC8vc2hvcnRjdXR0ZWQgdG8gcmV0dXJuOgogICAgICAgIC8vdWludDI1NiB0aW1lc3RhbXAgPSBfZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgLy91aW50MjU2IGludE5vdyA9IGludGVydmFsTm93KCk7CiAgICAgICAgLy91aW50MjU2IG5leHRQYXlvdXRUaW1lc3RhbXAgPSBpbnRlcmVzdENvbmZpZy5zdGFydEF0VGltZXN0YW1wICsgKGludE5vdyArMSkqIGludGVyZXN0Q29uZmlnLmludGVydmFsOwogICAgICAgIC8vcmV0dXJuIG5leHRQYXlvdXRUaW1lc3RhbXAgLSB0aW1lc3RhbXA7CiAgICAgICAgcmV0dXJuIChpbnRlcmVzdENvbmZpZy5zdGFydEF0VGltZXN0YW1wICsgKGludGVydmFsTm93KCkgKyAxKSAqIGludGVyZXN0Q29uZmlnLmludGVydmFsKSAtIF9nZXRUaW1lc3RhbXAoKTsKICAgIH0KCiAgICAvLyBwdWJsaWMgKHJlYWQgb25seSk6IG5leHQgaW50ZXJlc3QgcGF5b3V0IHJhdGUgaW4gcGVyY2VudAogICAgLy8gdW5uZWNlc3NhcnkgLT4ganVzdCBmb3IgZW5kdXNlciBsb29reWxvb2t5CiAgICBmdW5jdGlvbiBpbnRlcmVzdE5leHRJblBlcmNlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBtYWluVW5pdCwgdWludDI1NiBmcmFjdGlvbikgewogICAgICAgIHVpbnQyNTYgX25vdyA9IGludGVydmFsTm93KCk7CiAgICAgICAgdWludDI1NiBfcmF3ID0gX2NhbGNCYWxhbmNlKDEwMCAqIFRPS0VOX01VTFRJUExJRVIsIF9ub3csIF9ub3crMSk7CiAgICAgICAgbWFpblVuaXQgPSAoX3JhdyAtIDEwMCAqIFRPS0VOX01VTFRJUExJRVIpIC8gVE9LRU5fTVVMVElQTElFUjsKICAgICAgICBmcmFjdGlvbiA9IChfcmF3IC0gMTAwICogVE9LRU5fTVVMVElQTElFUikgJSBUT0tFTl9NVUxUSVBMSUVSOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAoZ2FzIG9wZXJhdGlvbik6IHRyaWdnZXJlZCBiZWZvcmUgYW55IChnYXMgY29zdHkgb3BlcmF0aW9uKSBiYWxhbmNlIHRyYW5zYWN0aW9uIC0+IGFjY291bnQgaW50ZXJlc3QgdG8gYmFsYW5jZSBvZiBhZGRyZXNzCiAgICAvLyBpdHMgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnM6IHVzZSBhIGdhcyBvcGVyYXRpb24gdG8gYWRkIG5ldyAoY3VtdWxhdGVkKSBpbnRlcmVzdCB0byBhY2NvdW50LWJhbGFuY2UgdG8gcmVkdWNlIGludGVyZXN0LWNhbGMtbG9vcCAoYmFsYW5jZU9mKQogICAgZnVuY3Rpb24gX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gcGF5b3V0IGludGVyZXN0IHRvIGJhbGFuY2UgYW5kIHNldCBuZXcgcGF5b3V0IGluZGV4CiAgICAgICAgdWludDI1NiBvbGRiYWwgPSBfc3VwcGx5VG90YWw7ICAgLy8gcmVhZCBsYXN0IGtub3duIGJhbGFuY2UgPT0gYmFsYW5jZSBhdCB0aW1laW5kZXg6ICJfc3VwcGx5TGFzdFBheW91dEludGVydmFsIgogICAgICAgIHVpbnQyNTYgbmV3YmFsID0gdG90YWxTdXBwbHkoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBpbnRlcmVzdCBjYWxjdWxhdGlvbiBsb29wIGZyb20gImxhc3RQYXlvdXRJbnRlcnZhbCIgdG8gbm93CiAgICAgICAgaWYgKG9sZGJhbCA8IG5ld2JhbCkgeyAgLy8gaWYgYmFsYW5jZSBjaGFuZ2VkIGJlY2F1c2Ugb2YgbmV3IGludGVyZXN0IC4uLgogICAgICAgICAgICBfc3VwcGx5VG90YWwgPSBuZXdiYWw7CiAgICAgICAgfQogICAgICAgIC8vIHNldCBuZXcgbGFzdFBheW91dEludGVydmFsIGZvciB1c2UgaW4gY2FsY3VsYXRpb24gbG9vcAogICAgICAgIF9zdXBwbHlMYXN0UGF5b3V0SW50ZXJ2YWwgPSBpbnRlcnZhbE5vdygpOyAvLyBpbnRlcmVzdCBhbHJlYWR5IHBheWVkIG91dCB0byBfc3VwcGx5VG90YWwgdW50aWwgdGhpcyBpbmRleCAobm93KQogICAgfQoKICAgIC8vIGludGVybmFsIChnYXMgb3BlcmF0aW9uKTogdHJpZ2dlcmVkIGJlZm9yZSBhbnkgKGdhcyBjb3N0eSBvcGVyYXRpb24pIGJhbGFuY2UgdHJhbnNhY3Rpb24gLT4gYWNjb3VudCBpbnRlcmVzdCB0byBiYWxhbmNlIG9mIGFkZHJlc3MKICAgIC8vIGl0cyBmb3IgcGVyZm9ybWFuY2UgcmVhc29uczogdXNlIGEgZ2FzIG9wZXJhdGlvbiB0byBhZGQgbmV3IChjdW11bGF0ZWQpIGludGVyZXN0IHRvIGFjY291bnQtYmFsYW5jZSB0byByZWR1Y2UgaW50ZXJlc3QtY2FsYy1sb29wIChiYWxhbmNlT2YpCiAgICBmdW5jdGlvbiBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShhZGRyZXNzIF9vd25lcikgaW50ZXJuYWwgewogICAgICAgIC8vIHBheW91dCBpbnRlcmVzdCB0byBiYWxhbmNlIGFuZCBzZXQgbmV3IHBheW91dCBpbmRleAogICAgICAgIHVpbnQyNTYgb2xkYmFsID0gYWNjb3VudHNbX293bmVyXS5iYWxhbmNlOyAgLy8gcmVhZCBsYXN0IGtub3duIGJhbGFuY2UgPT0gYmFsYW5jZSBhdCB0aW1laW5kZXg6ICJhY2NvdW50c1tfb3duZXJdLmxhc3RQYXlvdXRJbnRlcnZhbCIKICAgICAgICB1aW50MjU2IG5ld2JhbCA9IGJhbGFuY2VPZihfb3duZXIpOyAgICAgICAgIC8vIGRvIGludGVyZXN0IGNhbGN1bGF0aW9uIGxvb3AgZnJvbSAibGFzdFBheW91dEludGVydmFsIiB0byBub3cKICAgICAgICBpZiAob2xkYmFsIDwgbmV3YmFsKSB7ICAvLyBpZiBiYWxhbmNlIGNoYW5nZWQgYmVjYXVzZSBvZiBuZXcgaW50ZXJlc3QgLi4uCiAgICAgICAgICAgIGFjY291bnRzW19vd25lcl0uYmFsYW5jZSA9IG5ld2JhbDsKCiAgICAgICAgICAgIC8vbm8gbmVlZCBmb3IgbG9nZ2luZyB0aGlzOjogSW50ZXJlc3RQYXllZChfb3duZXIsIG5ld2JhbCAtIG9sZGJhbCk7CiAgICAgICAgfQogICAgICAgIC8vIHNldCBuZXcgbGFzdFBheW91dEludGVydmFsIGZvciB1c2UgaW4gY2FsY3VsYXRpb24gbG9vcAogICAgICAgIGFjY291bnRzW19vd25lcl0ubGFzdFBheW91dEludGVydmFsID0gaW50ZXJ2YWxOb3coKTsgLy8gaW50ZXJlc3QgYWxyZWFkeSBwYXllZCBvdXQgdG8gW293bmVyXS5iYWxhbmNlIHVudGlsIHRoaXMgaW5kZXggKG5vdykKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAoZ2FzIG9wZXJhdGlvbik6IHRyaWdnZXJlZCBieSBhIHRyYW5zYXRpb24tZnVuY3Rpb24gLT4gcGF5IGludGVyZXN0IHRvIGJvdGggYWRkcjsgc3VidHJhY3QgdHJhbnNhY3Rpb24gZmVlOyBkbyB0b2tlbi10cmFuc2ZlcgogICAgLy8gZXZlcnkgY2FsbCB0cmlnZ2VycyB0aGUgaW50ZXJlc3QgcGF5b3V0IGxvb3AgYW5kIGFkZHMgdGhlIG5ldyBiYWxhbmNlIGludGVybmFseSAtPiBuZXh0IGxvb3AgY2FuIHNhdmUgY3B1LWN5Y2xlcwogICAgZnVuY3Rpb24gX3NldEJhbGFuY2VzKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2Zyb20gIT0gX3RvKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwoKICAgICAgICAvLyBzZXQgbmV3IGJhbGFuY2UgKGFuZCBuZXcgImxhc3QgcGF5b3V0IGluZGV4IikgaW5jbHVkaW5nIGludGVyZXN0IGZvciBib3RoIHBhcnRpZXMgYmVmb3JlIHRyYW5zZmVyCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvQWNjb3VudEJhbGFuY2UoX2Zyb20pOyAgIC8vIHNldCBuZXcgYmFsYW5jZSBpbmNsdWRpbmcgaW50ZXJlc3QKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShfdG8pOyAgICAgLy8gc2V0IG5ldyBiYWxhbmNlIGluY2x1ZGluZyBpbnRlcmVzdAogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb1RvdGFsU3VwcGx5KCk7CgogICAgICAgIC8vIHRoZXJlIG11c3QgYmUgZW5vdWdoIGJhbGFuY2UgZm9yIHRyYW5zZmVyIEFORCB0cmFuc2FjdGlvbi1mZWUKICAgICAgICByZXF1aXJlKF92YWx1ZS5hZGQobWFzdGVybm9kZS50cmFuc2FjdGlvblJld2FyZEluU3VidG9rZW5zUmF3MWUxOCkgPD0gYWNjb3VudHNbX2Zyb21dLmJhbGFuY2UpOwoKICAgICAgICAvLyBpZiBzZW5kZXIgaXMgYSBtYXN0ZXJub2RlOiBmcmVlemUgMTAwayBvZiB0b2tlbnMgYmFsYW5jZSAtPiB0byByZWxlYXNlIHRoZSBiYWxhbmNlIGl0IGlzIHJlcXVpcmVkIHRvIGRlcmVnaXN0ZXIgdGhlIG1hc3Rlcm5vZGUgZmlyc3QKICAgICAgICBpZiAobWFzdGVybm9kZUlzVmFsaWQoX2Zyb20pKSB7CiAgICAgICAgICAgIHJlcXVpcmUoYWNjb3VudHNbX2Zyb21dLmJhbGFuY2UgPj0gbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTguYWRkKF92YWx1ZSkpOyAvLyBtYXN0ZXJub2RlczogMTAwayBiYWxhbmNlIGlzIGZyZWV6ZWQKICAgICAgICB9CgogICAgICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgICAgICBhY2NvdW50c1tfZnJvbV0uYmFsYW5jZSA9IGFjY291bnRzW19mcm9tXS5iYWxhbmNlLnN1YihfdmFsdWUpLnN1YihtYXN0ZXJub2RlLnRyYW5zYWN0aW9uUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4KTsKICAgICAgICBhY2NvdW50c1tfdG9dLmJhbGFuY2UgICA9IGFjY291bnRzW190b10uYmFsYW5jZS5hZGQoX3ZhbHVlKTsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAobm8gZ2FzKTogY2FsYyBpbnRlcmVzdCBhcyBhIGZ1bmN0aW9uIG9mIGludGVydmFsLWluZGV4IChsb29wIGZyb20taW50ZXJ2YWwgdG8gdG8taW50ZXJ2YWwpCiAgICBmdW5jdGlvbiBfY2FsY0JhbGFuY2UodWludDI1NiBfYmFsYW5jZSwgdWludDI1NiBfZnJvbSwgdWludDI1NiBfdG8pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhdHRuLjogc2lnbmlmaWNhbnQgaW50ZWdlciBjYXBwaW5nIGZvciBiYWxhbmNlcyA8IDFlLTE2IC0+IGFjY2VwdGFibGUgbGltaXRhdGlvbgogICAgICAgIHVpbnQyNTYgX25ld2JhbGFuY2UgPSBfYmFsYW5jZTsKICAgICAgICBpZiAoX3RvID4gaW50ZXJlc3RDb25maWcuc3RvcEF0SW50ZXJ2YWwpIF90byA9IGludGVyZXN0Q29uZmlnLnN0b3BBdEludGVydmFsOyAvLyBubyAobW9yZSkgaW50ZXJlc3QgYWZ0ZXIgeCBpbnRlcnZhbHMgKGRlZmF1bHQ6IDQ4KQogICAgICAgIGlmIChfZnJvbSA8IF90bykgeyAvLyBpbnRlcmVzdCBpbmRleCBzaW5jZSBsYXN0IHBheW91dCAoc3RvcmFnZSBvcGVyYXRpb24gaW4gdHJhbnNmZXJzKSAtPiBjYWxjIG5ldyBiYWxhbmNlCiAgICAgICAgICAgIGZvciAodWludDI1NiBpZHggPSBfZnJvbTsgaWR4IDwgX3RvOyBpZHgrKykgeyAvLyBsb29wIG92ZXIgdW5wYXllZCBpbnRlcnZhbHMgKHNpbmNlIGxhc3QgcGF5b3V0LW9wZXJhdGlvbiB0aWxsIG5vdykKICAgICAgICAgICAgICAgIGlmIChpZHggPiA0OCkgYnJlYWs7IC8vIGhhcmRjYXA6IGp1c3QgZm9yIC4uLiB5b3Uga25vdwoKICAgICAgICAgICAgICAgIF9uZXdiYWxhbmNlICs9IChfbmV3YmFsYW5jZSAqIGludGVyZXN0UmF0ZXNbaWR4ICUgaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHldKSAvIHN0YWdlRmFjdG9yc1soaWR4IC8gaW50ZXJlc3RDb25maWcucGVyaW9kaWNpdHkpICUgNF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9uZXdiYWxhbmNlIDwgX2JhbGFuY2UpIHsgX25ld2JhbGFuY2UgPSBfYmFsYW5jZTsgfSAvLyBmYWlsc2F2ZSBpZiBzb21lIG1hdGggZ29lcyB3cm9uZyAob3ZlcmZsb3cpLiB3aG8ga25vd3MuLi4KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9uZXdiYWxhbmNlOwogICAgICAgIC8qICBpbnRlcmVzdCBieSB0aW1lICgxIGludGVydmFsID09IDMwIGRheXMpCiAgICAgICAgICAgIHN0YWdlZmFjdG9yCWludGVydmFsCWludGVyZXN0CSB0b3RhbCBzdXBwbHkJIHN1bSAlCiAgICAgICAgICAgIDEgICAgICAgICAgIDAgICAgICAgICAgICAgMC4wMDAwJSAgICAyMCcwMDAnMDAwLjAwICAgMTAwLjAwJQogICAgICAgICAgICBhZnRlciAzMCBkYXlzCiAgICAgICAgICAgIDEJICAgICAgICAxCSAgICAgICAgMTAwLjAwMDAlICAgIDQwJzAwMCcwMDAuMDAJIDIwMC4wMCUKICAgICAgICAgICAgMQkgICAgICAgIDIJICAgICAgICAgODAuMDAwMCUJIDcyJzAwMCcwMDAuMDAJIDM2MC4wMCUKICAgICAgICAgICAgMQkgICAgICAgIDMJICAgICAgICAgNjAuMDAwMCUJMTE1JzIwMCcwMDAuMDAJIDU3Ni4wMCUKICAgICAgICAgICAgMQkgICAgICAgIDQJICAgICAgICAgNDAuMDAwMCUJMTYxJzI4MCcwMDAuMDAJIDgwNi40MCUKICAgICAgICAgICAgMQkgICAgICAgIDUJICAgICAgICAgMjAuMDAwMCUJMTkzJzUzNicwMDAuMDAJIDk2Ny42OCUKICAgICAgICAgICAgMQkgICAgICAgIDYJICAgICAgICAgMTAuMDAwMCUJMjEyJzg4OSc2MDAuMDAJMTA2NC40NSUKICAgICAgICAgICAgMQkgICAgICAgIDcJICAgICAgICAgIDUuMDAwMCUJMjIzJzUzNCcwODAuMDAJMTExNy42NyUKICAgICAgICAgICAgMQkgICAgICAgIDgJICAgICAgICAgIDUuMDAwMCUJMjM0JzcxMCc3ODQuMDAJMTE3My41NSUKICAgICAgICAgICAgMQkgICAgICAgIDkJICAgICAgICAgIDMuMDAwMCUJMjQxJzc1MicxMDcuNTIJMTIwOC43NiUKICAgICAgICAgICAgMQkgICAgICAgIDEwCSAgICAgICAgICAzLjAwMDAlCTI0OScwMDQnNjcwLjc1CTEyNDUuMDIlCiAgICAgICAgICAgIDEJICAgICAgICAxMQkgICAgICAgICAgMi4wMDAwJQkyNTMnOTg0Jzc2NC4xNgkxMjY5LjkyJQogICAgICAgICAgICAxCSAgICAgICAgMTIJICAgICAgICAgIDEuMDAwMCUJMjU2JzUyNCc2MTEuODAJMTI4Mi42MiUKICAgICAgICAgICAgYWZ0ZXIgMSB5ZWFyOiAxMjgyLjYyJSBwYSBpbiB5ZWFyIDEKICAgICAgICAgICAgNAkgICAgICAgIDEzCSAgICAgICAgIDI1LjAwMDAlCTMyMCc2NTUnNzY0Ljc1CTE2MDMuMjglCiAgICAgICAgICAgIDQJICAgICAgICAxNAkgICAgICAgICAyMC4wMDAwJQkzODQnNzg2JzkxNy43MAkxOTIzLjkzJQogICAgICAgICAgICA0CSAgICAgICAgMTUJICAgICAgICAgMTUuMDAwMCUJNDQyJzUwNCc5NTUuMzYJMjIxMi41MiUKICAgICAgICAgICAgNAkgICAgICAgIDE2CSAgICAgICAgIDEwLjAwMDAlCTQ4Nic3NTUnNDUwLjg5CTI0MzMuNzglCiAgICAgICAgICAgIDQJICAgICAgICAxNwkgICAgICAgICAgNS4wMDAwJQk1MTEnMDkzJzIyMy40NAkyNTU1LjQ3JQogICAgICAgICAgICA0CSAgICAgICAgMTgJICAgICAgICAgIDIuNTAwMCUJNTIzJzg3MCc1NTQuMDMJMjYxOS4zNSUKICAgICAgICAgICAgNAkgICAgICAgIDE5CSAgICAgICAgICAxLjI1MDAlCTUzMCc0MTgnOTM1Ljk1CTI2NTIuMDklCiAgICAgICAgICAgIDQJICAgICAgICAyMAkgICAgICAgICAgMS4yNTAwJQk1MzcnMDQ5JzE3Mi42NQkyNjg1LjI1JQogICAgICAgICAgICA0CSAgICAgICAgMjEJICAgICAgICAgIDAuNzUwMCUJNTQxJzA3NycwNDEuNDQJMjcwNS4zOSUKICAgICAgICAgICAgNAkgICAgICAgIDIyCSAgICAgICAgICAwLjc1MDAlCTU0NScxMzUnMTE5LjI2CTI3MjUuNjglCiAgICAgICAgICAgIDQJICAgICAgICAyMwkgICAgICAgICAgMC41MDAwJQk1NDcnODYwJzc5NC44NQkyNzM5LjMwJQogICAgICAgICAgICA0CSAgICAgICAgMjQJICAgICAgICAgIDAuMjUwMCUJNTQ5JzIzMCc0NDYuODQJMjc0Ni4xNSUKICAgICAgICAgICAgYWZ0ZXIgMiB5ZWFyczogMjE0LjEwJSBwYSBpbiB5ZWFyIDIKICAgICAgICAgICAgOAkgICAgICAgIDI1CSAgICAgICAgIDEyLjUwMDAlCTYxNyc4ODQnMjUyLjY5CTMwODkuNDIlCiAgICAgICAgICAgIDgJICAgICAgICAyNgkgICAgICAgICAxMC4wMDAwJQk2NzknNjcyJzY3Ny45NgkzMzk4LjM2JQogICAgICAgICAgICA4CSAgICAgICAgMjcJICAgICAgICAgIDcuNTAwMCUJNzMwJzY0OCcxMjguODEJMzY1My4yNCUKICAgICAgICAgICAgOAkgICAgICAgIDI4CSAgICAgICAgICA1LjAwMDAlCTc2NycxODAnNTM1LjI1CTM4MzUuOTAlCiAgICAgICAgICAgIDgJICAgICAgICAyOQkgICAgICAgICAgMi41MDAwJQk3ODYnMzYwJzA0OC42MwkzOTMxLjgwJQogICAgICAgICAgICA4CSAgICAgICAgMzAJICAgICAgICAgIDEuMjUwMCUJNzk2JzE4OSc1NDkuMjQJMzk4MC45NSUKICAgICAgICAgICAgOAkgICAgICAgIDMxCSAgICAgICAgICAwLjYyNTAlCTgwMScxNjUnNzMzLjkyCTQwMDUuODMlCiAgICAgICAgICAgIDgJICAgICAgICAzMgkgICAgICAgICAgMC42MjUwJQk4MDYnMTczJzAxOS43Ngk0MDMwLjg3JQogICAgICAgICAgICA4CSAgICAgICAgMzMJICAgICAgICAgIDAuMzc1MCUJODA5JzE5NicxNjguNTgJNDA0NS45OCUKICAgICAgICAgICAgOAkgICAgICAgIDM0CSAgICAgICAgICAwLjM3NTAlCTgxMicyMzAnNjU0LjIyCTQwNjEuMTUlCiAgICAgICAgICAgIDgJICAgICAgICAzNQkgICAgICAgICAgMC4yNTAwJQk4MTQnMjYxJzIzMC44NQk0MDcxLjMxJQogICAgICAgICAgICA4CSAgICAgICAgMzYJICAgICAgICAgIDAuMTI1MCUJODE1JzI3OScwNTcuMzkJNDA3Ni40MCUKICAgICAgICAgICAgYWZ0ZXIgMyB5ZWFyczogMTQ4LjQ0JSBwYSBpbiB5ZWFyIDMKICAgICAgICAgICAgMTYJICAgICAgICAzNwkgICAgICAgICAgNi4yNTAwJQk4NjYnMjMzJzk5OC40OAk0MzMxLjE3JQogICAgICAgICAgICAxNgkgICAgICAgIDM4CSAgICAgICAgICA1LjAwMDAlCTkwOSc1NDUnNjk4LjQwCTQ1NDcuNzMlCiAgICAgICAgICAgIDE2CSAgICAgICAgMzkJICAgICAgICAgIDMuNzUwMCUJOTQzJzY1Myc2NjIuMDkJNDcxOC4yNyUKICAgICAgICAgICAgMTYJICAgICAgICA0MAkgICAgICAgICAgMi41MDAwJQk5NjcnMjQ1JzAwMy42NAk0ODM2LjIzJQogICAgICAgICAgICAxNgkgICAgICAgIDQxCSAgICAgICAgICAxLjI1MDAlCTk3OSczMzUnNTY2LjE5CTQ4OTYuNjglCiAgICAgICAgICAgIDE2CSAgICAgICAgNDIJICAgICAgICAgIDAuNjI1MCUJOTg1JzQ1Nic0MTMuNDgJNDkyNy4yOCUKICAgICAgICAgICAgMTYJICAgICAgICA0MwkgICAgICAgICAgMC4zMTI1JQk5ODgnNTM1Jzk2NC43Nwk0OTQyLjY4JQogICAgICAgICAgICAxNgkgICAgICAgIDQ0CSAgICAgICAgICAwLjMxMjUlCTk5MSc2MjUnMTM5LjY2CTQ5NTguMTMlCiAgICAgICAgICAgIDE2CSAgICAgICAgNDUJICAgICAgICAgIDAuMTg3NSUJOTkzJzQ4NCc0MzYuODAJNDk2Ny40MiUKICAgICAgICAgICAgMTYJICAgICAgICA0NgkgICAgICAgICAgMC4xODc1JQk5OTUnMzQ3JzIyMC4xMgk0OTc2Ljc0JQogICAgICAgICAgICAxNgkgICAgICAgIDQ3CSAgICAgICAgICAwLjEyNTAlCTk5Nic1OTEnNDA0LjE0CTQ5ODIuOTYlCiAgICAgICAgICAgIDE2CSAgICAgICAgNDgJICAgICAgICAgIDAuMDYyNSUJOTk3JzIxNCcyNzMuNzcJNDk4Ni4wNyUKICAgICAgICAgICAgYWZ0ZXIgNCB5ZWFyczogMTIyLjMyJSBwYSBpbiB5ZWFyIDQKICAgICAgICAgICAgMTYJICAgICAgICA0OSAuLiBpbmYgICAgIDAuMDAwMCUJOTk3JzIxNCcyNzMuNzcJNDk4Ni4wNyUKICAgICAgICAqLwogICAgfQoKCgoKCgogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICAvLyArCiAgICAvLyArIE1hc3Rlcm5vZGUgc3R1ZmYKICAgIC8vICsKICAgIC8vICsgZXZlcnkgcmVnaXN0ZXJlZCBtYXN0ZXJub2RlcyByZWNlaXZlcyBhIHBhcnQgb2YgdGhlIHRyYW5zYWN0aW9uIGZlZQogICAgLy8gKyBldmVyeSBtYXN0ZXJub2RlIGNhbiBtaW5lIDUwJiMxODA7MDAwIG9uY2UgZXZlcnkgaW50ZXJ2YWwgKDMwIGRheXMpCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIGV2ZW50IE1hc3Rlcm5vZGVSZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYXN0ZXJub2RlRGVyZWdpc3RlcmVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYXN0ZXJub2RlTWluZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IE1hc3Rlcm5vZGVUcmFuc2ZlcnJlZChhZGRyZXNzIGZyb21BZGRyLCBhZGRyZXNzIHRvQWRkcik7CiAgICBldmVudCBNYXN0ZXJub2RlUmV3YXJkU2VuZCh1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBNYXN0ZXJub2RlUmV3YXJkQWRkZWRUb1Jld2FyZFBvb2wodWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWF4TWFzdGVybm9kZXNBbGxvd2VkQ2hhbmdlZCh1aW50OCBuZXdOdW1NYXhNYXN0ZXJub2Rlc0FsbG93ZWQpOwogICAgZXZlbnQgVHJhbnNhY3Rpb25GZWVDaGFuZ2VkKHVpbnQyNTYgbmV3VHJhbnNhY3Rpb25GZWUpOwogICAgZXZlbnQgTWluZXJSZXdhcmRDaGFuZ2VkKHVpbnQyNTYgbmV3TWluZXJSZXdhcmQpOwoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogdW5peHRpbWUgdG8gbmV4dCBpbnRlcmVzdCBwYXlvdXQKICAgIC8vIHVubmVjZXNzYXJ5IC0+IGp1c3QgZm9yIGVuZHVzZXIgbG9va3lsb29reQogICAgZnVuY3Rpb24gc2VjVG9OZXh0TWluaW5nSW50ZXJ2YWwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzZWNUb05leHRJbnRlcmVzdFBheW91dCgpOwogICAgfQoKICAgIC8vIGludGVybmFsIChyZWFkIG9ubHkpOgogICAgLy8gdW5uZWNlc3NhcnkgLT4ganVzdCBmb3IgZW5kdXNlciBsb29reWxvb2t5CiAgICBmdW5jdGlvbiByZXF1aXJlZEJhbGFuY2VGb3JNYXN0ZXJub2RlSW5FdGhlcigpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyAxc3QgbWFzdGVybm9kZSA9IDEgZXRoZXIgcmVxdWlyZWQgdG8gZGVwb3NpdCBpbiBjb250cmFjdAogICAgICAgIC8vIDJuZCBtYXN0ZXJub2RlID0gNCBldGhlcgogICAgICAgIC8vIDNyZCBtYXN0ZXJub2RlID0gOSBldGhlcgogICAgICAgIC8vIDR0aCBtYXN0ZXJub2RlID0gMTYgZXRoZXIKICAgICAgICAvLyA1dGggbWFzdGVybm9kZSA9IDI1IGV0aGVyCiAgICAgICAgLy8gNnRoIG1hc3Rlcm5vZGUgPSAzNiBldGhlcgogICAgICAgIC8vIDIydGggICAgICAgICAgID0gNDg0IGV0aGVyCiAgICAgICAgcmV0dXJuIChtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzICsgMSkgKiogMjsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAocmVhZCBvbmx5KTogdXNlZCBpbiBtYXN0ZXJub2RlUmVnaXN0ZXIgYW5kIERlcmVnaXN0ZXIKICAgIGZ1bmN0aW9uIHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKDEgZXRoZXIpICogKG1hc3Rlcm5vZGUuYWN0aXZlTWFzdGVybm9kZXMgKyAxKSAqKiAyOwogICAgfQoKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IHNlbmQgRVRIIChyZXF1aXJlZEJhbGFuY2VGb3JNYXN0ZXJub2RlSW5FdGhlcikgdG8gY29udHJhY3QgdG8gYmVjb21lIGEgbWFzdGVybm9kZQogICAgZnVuY3Rpb24gbWFzdGVybm9kZVJlZ2lzdGVyKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIC8vIGdhczogMTA0JzAwMCAvIG1heDogMTQwawogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG1hc3Rlcm5vZGUuYWN0aXZlTWFzdGVybm9kZXMgPCBtYXN0ZXJub2RlLm1heE1hc3Rlcm5vZGVzQWxsb3dlZCk7ICAgICAgIC8vIG1heC4gbWFzdGVybm9kZXMgYWxsb3dlZAogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpICk7ICAgICAgICAgICAgICAgICAgICAgLy8gZXRoIGRlcG9zaXQKICAgICAgICByZXF1aXJlKF9nZXRNYXN0ZXJub2RlU2xvdChtc2cuc2VuZGVyKSA+PSBtYXhNYXN0ZXJub2Rlcyk7ICAgICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgb25lIG1hc3Rlcm5vZGUgcGVyIGFkZHJlc3MKCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKTsKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShtc2cuc2VuZGVyKTsgLy8gZG8gaW50ZXJlc3QgcGF5b3V0IGJlZm9yZSBjaGVja2luZyBiYWxhbmNlCiAgICAgICAgcmVxdWlyZShhY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBvZiAxMDBrIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCiAgICAgICAgLy93YXM6IHJlcXVpcmUoYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBvZiAxMDBrIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCgogICAgICAgIHVpbnQ4IHNsb3QgPSBfZmluZEVtcHR5TWFzdGVybm9kZVNsb3QoKTsKICAgICAgICByZXF1aXJlKHNsb3QgPCBtYXhNYXN0ZXJub2Rlcyk7IC8vIHNob3VsZCBuZXZlciB0cmlnZ2VyCgogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmFkZHIgPSBtc2cuc2VuZGVyOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmJhbGFuY2VXZWkgPSBtc2cudmFsdWU7CiAgICAgICAgbWFzdGVybm9kZXNbc2xvdF0uc2luY2VJbnRlcnZhbCA9IGludGVydmFsTm93KCk7CiAgICAgICAgbWFzdGVybm9kZXNbc2xvdF0ubGFzdE1pbmluZ0ludGVydmFsID0gaW50ZXJ2YWxOb3coKTsKCiAgICAgICAgbWFzdGVybm9kZS5hY3RpdmVNYXN0ZXJub2RlcysrOwoKICAgICAgICBtYXN0ZXJub2RlLm1pbkRlcG9zaXRSZXF1aXJlZEluRXRoZXI9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbkV0aGVyKCk7IC8vIGF0dG46IGZpcnN0IGluYyBhY3RpdmVNTgogICAgICAgIG1hc3Rlcm5vZGUubWluRGVwb3NpdFJlcXVpcmVkSW5XZWkgID0gcmVxdWlyZWRCYWxhbmNlRm9yTWFzdGVybm9kZUluV2VpKCk7IC8vIGF0dG46IGZpcnN0IGluYyBhY3RpdmVNTgoKICAgICAgICBtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSA9IG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpLmFkZChtc2cudmFsdWUpOyAgICAvLyB0aGlzIGJhbGFuY2UgY291bGQgbmV2ZXIgYmUgd2l0aGRyYXduIGJ5IGNvbnRyYWN0IGFkbWluCgogICAgICAgIE1hc3Rlcm5vZGVSZWdpc3RlcmVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8gcHVibGljIChjb21tYW5kKTogY2xvc2UgbWFzdGVybm9kZSBhbmQgc2VuZCBkZXBvc2l0ZWQgRVRIIGJhY2sgdG8gb3duZXIKICAgIGZ1bmN0aW9uIG1hc3Rlcm5vZGVEZXJlZ2lzdGVyKCkgcHVibGljIHByZXZlbnRSZWVudHJ5IHJldHVybnMgKGJvb2wgX3N1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzID4gMCk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSA+IDApOwogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpICsgdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjayk7CgogICAgICAgIHVpbnQ4IHNsb3QgPSBfZ2V0TWFzdGVybm9kZVNsb3QobXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShzbG90IDwgbWF4TWFzdGVybm9kZXMpOyAvLyBtYXN0ZXJub2RlIGZvdW5kIGluIGxpc3Q/CgogICAgICAgIHVpbnQyNTYgYmFsYW5jZVdlaSA9IG1hc3Rlcm5vZGVzW3Nsb3RdLmJhbGFuY2VXZWk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLnRvdGFsQmFsYW5jZVdlaSA+PSBiYWxhbmNlV2VpKTsKCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKTsKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9BY2NvdW50QmFsYW5jZShtc2cuc2VuZGVyKTsgLy8gZG8gaW50ZXJlc3QgcGF5b3V0IGJlZm9yZSBjaGVja2luZyBiYWxhbmNlCgogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmFkZHIgPSBhZGRyZXNzKDApOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmJhbGFuY2VXZWkgPSAwOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLnNpbmNlSW50ZXJ2YWwgPSAwOwogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmxhc3RNaW5pbmdJbnRlcnZhbCA9IDA7CgogICAgICAgIG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpID0gbWFzdGVybm9kZS50b3RhbEJhbGFuY2VXZWkuc3ViKGJhbGFuY2VXZWkpOwoKICAgICAgICBtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzLS07CgogICAgICAgIG1hc3Rlcm5vZGUubWluRGVwb3NpdFJlcXVpcmVkSW5FdGhlciA9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbkV0aGVyKCk7IC8vIGF0dG46IGZpcnN0IGRlYyBhY3RpdmVNTgogICAgICAgIG1hc3Rlcm5vZGUubWluRGVwb3NpdFJlcXVpcmVkSW5XZWkgICA9IHJlcXVpcmVkQmFsYW5jZUZvck1hc3Rlcm5vZGVJbldlaSgpOyAvLyBhdHRuOiBmaXJzdCBkZWMgYWN0aXZlTU4KCiAgICAgICAgLy9pZiAoIWFkZHIuc2VuZChiYWxhbmNlV2VpKSkgcmV2ZXJ0KCk7IC8vIHNlbmQgYmFjayBldGhlciB0byB3YWxsZXQgb2Ygc2VuZGVyCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiYWxhbmNlV2VpKTsgLy8gc2VuZCBiYWNrIGV0aGVyIHRvIHdhbGxldCBvZiBzZW5kZXIKCiAgICAgICAgTWFzdGVybm9kZURlcmVnaXN0ZXJlZChtc2cuc2VuZGVyLCBiYWxhbmNlV2VpKTsKICAgICAgICBfc3VjY2VzcyA9IHRydWU7CiAgICAgICAgfQoKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IGNsb3NlIG1hc3Rlcm5vZGUgYW5kIHNlbmQgZGVwb3NpdGVkIEVUSCBiYWNrIHRvIG93bmVyCiAgICBmdW5jdGlvbiBtYXN0ZXJub2RlTWluZVRva2VucygpIHB1YmxpYyB7CiAgICAgICAgLy8gZ2FzOiB1cCB0byAxMDUwMDAKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzID4gMCk7CgogICAgICAgIHVpbnQyNTYgX2lub3cgPSBpbnRlcnZhbE5vdygpOwogICAgICAgIHJlcXVpcmUoX2lub3cgPD0gaW50ZXJlc3RDb25maWcuc3RvcEF0SW50ZXJ2YWwpOyAvLyBtaW5pbmcgc3RvcHMgYWZ0ZXIgYXBwcm94LiA0IHllYXJzICg0OCBpbnRlcnZhbHMgYnkgMzAgZGF5cykKCiAgICAgICAgdWludDggc2xvdCA9IF9nZXRNYXN0ZXJub2RlU2xvdChtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHNsb3QgPCBtYXhNYXN0ZXJub2Rlcyk7IC8vIG1hc3Rlcm5vZGUgZm91bmQgaW4gbGlzdD8KICAgICAgICByZXF1aXJlKG1hc3Rlcm5vZGVzW3Nsb3RdLmxhc3RNaW5pbmdJbnRlcnZhbCA8IF9pbm93KTsgLy8gbWFzdGVybm9kZSBkaWQgbm90IGFscmVhZHkgbWluZSB0aGlzIGludGVydmFsPwoKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpOwogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKG1zZy5zZW5kZXIpOyAgIC8vIHNldCBuZXcgYmFsYW5jZSBpbmNsdWRpbmcgaW50ZXJlc3QKICAgICAgICByZXF1aXJlKGFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPj0gbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTgpOyAvLyByZXF1aXJlZCB0b2tlbiBiYWxhbmNlIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCiAgICAgICAgLy93YXM6IHJlcXVpcmUoYmFsYW5jZU9mKG1zZy5zZW5kZXIpID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBvZiAxMDBrIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCgogICAgICAgIG1hc3Rlcm5vZGVzW3Nsb3RdLmxhc3RNaW5pbmdJbnRlcnZhbCA9IF9pbm93OwoKICAgICAgICB1aW50MjU2IF9taW5lZFRva2VucyA9IG1pbmluZ1Jld2FyZEluU3VidG9rZW5zUmF3MWUxODsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPSBhY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlLmFkZChfbWluZWRUb2tlbnMpOwoKICAgICAgICAvLyBhdHRuLjogX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvVG90YWxTdXBwbHkoKSBtdXN0IGJlIGNhbGxlZCBmaXJzdCB0byBzZXQgbGFzdFBheW91dEludGVydmFsIGNvcnJlY3RseQogICAgICAgIF9zdXBwbHlUb3RhbCA9IF9zdXBwbHlUb3RhbC5hZGQoX21pbmVkVG9rZW5zKTsKICAgICAgICAvL19zdXBwbHlNaW5lZCA9IF9zdXBwbHlNaW5lZC5hZGQoX21pbmVkVG9rZW5zKTsKCiAgICAgICAgbWFzdGVybm9kZS50b3RhbFRva2Vuc01pbmVkUmF3MWUxOCA9IG1hc3Rlcm5vZGUudG90YWxUb2tlbnNNaW5lZFJhdzFlMTguYWRkKF9taW5lZFRva2Vucyk7CgogICAgICAgIE1hc3Rlcm5vZGVNaW5lZFRva2Vucyhtc2cuc2VuZGVyLCBfbWluZWRUb2tlbnMpOwogICAgfQoKICAgIC8vIHB1YmxpYyAoY29tbWFuZCk6IG93bmVyIG9mIGEgbWFzdGVybm9kZSBjYW4gdHJhbnNmZXIgdGhlIG1uIChhbmQgdGhlIHZhbHVlIGluIEVUSCkgdG8gYW5vdGhlciB3YWxsZXQgYWRkcmVzcwogICAgZnVuY3Rpb24gbWFzdGVybm9kZVRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3QWRkcikgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1hc3Rlcm5vZGUuYWN0aXZlTWFzdGVybm9kZXMgPiAwKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShuZXdBZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3QWRkciAhPSBtc2cuc2VuZGVyKTsKCiAgICAgICAgdWludDggc2xvdCA9IF9nZXRNYXN0ZXJub2RlU2xvdChtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHNsb3QgPCBtYXhNYXN0ZXJub2Rlcyk7IC8vIG1hc3Rlcm5vZGUgZm91bmQgaW4gbGlzdD8gb25seSB0aGUgb3duZXIgb2YgYSBtYXN0ZXJub2RlIGNhbiB0cmFuc2ZlciBhIG1hc3Rlcm5vZGUgdG8gYSBuZXcgYWRkcmVzcwoKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpOwogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKG1zZy5zZW5kZXIpOyAvLyBkbyBpbnRlcmVzdCBwYXlvdXQgYmVmb3JlIG1vdmluZyBtYXN0ZXJub2RlCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvQWNjb3VudEJhbGFuY2UobmV3QWRkcik7IC8vIGRvIGludGVyZXN0IHBheW91dCBiZWZvcmUgbW92aW5nIG1hc3Rlcm5vZGUKICAgICAgICByZXF1aXJlKGFjY291bnRzW25ld0FkZHJdLmJhbGFuY2UgPj0gbWFzdGVybm9kZS5taW5CYWxhbmNlUmVxdWlyZWRJblN1YnRva2Vuc1JhdzFlMTgpOyAvLyByZXF1aXJlZCB0b2tlbiBiYWxhbmNlIGF0IGFkZHIgdG8gcmVnaXN0ZXIgYSBtYXN0ZXJub2RlCiAgICAgICAgLy93YXM6IHJlcXVpcmUoYmFsYW5jZU9mKG5ld0FkZHIpID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsgLy8gcmVxdWlyZWQgdG9rZW4gYmFsYW5jZSBhdCBhZGRyIHRvIHJlZ2lzdGVyIGEgbWFzdGVybm9kZQoKICAgICAgICBtYXN0ZXJub2Rlc1tzbG90XS5hZGRyID0gbmV3QWRkcjsKCiAgICAgICAgTWFzdGVybm9kZVRyYW5zZmVycmVkKG1zZy5zZW5kZXIsIG5ld0FkZHIpOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogY2hlY2sgaWYgYWRkciBpcyBhIG1hc3Rlcm5vZGUKICAgIGZ1bmN0aW9uIG1hc3Rlcm5vZGVJc1ZhbGlkKGFkZHJlc3MgYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9nZXRNYXN0ZXJub2RlU2xvdChhZGRyKSA8IG1heE1hc3Rlcm5vZGVzKSAmJiAoYmFsYW5jZU9mKGFkZHIpID49IG1hc3Rlcm5vZGUubWluQmFsYW5jZVJlcXVpcmVkSW5TdWJ0b2tlbnNSYXcxZTE4KTsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAocmVhZCBvbmx5KToKICAgIGZ1bmN0aW9uIF9nZXRNYXN0ZXJub2RlU2xvdChhZGRyZXNzIGFkZHIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgdWludDggaWR4ID0gbWF4TWFzdGVybm9kZXM7IC8vIG1hc3Rlcm5vZGUubWF4TWFzdGVybm9kZXNBbGxvd2VkOwogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBtYXhNYXN0ZXJub2RlczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChtYXN0ZXJub2Rlc1tpXS5hZGRyID09IGFkZHIpIHsgLy8gaWYgc2VuZGVyIGlzIGEgcmVnaXN0ZXJlZCBtYXN0ZXJub2RlCiAgICAgICAgICAgICAgICBpZHggPSBpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlkeDsgLy8gaWYgaWR4ID09IG1heE1hc3Rlcm5vZGVzICgyMikgLT4gbm8gZW50cnkgZm91bmQ7IHZhbGlkIG1hc3Rlcm5vZGUgc2xvdHM6IDAgLi4gMjEKICAgIH0KCiAgICAvLyBpbnRlcm5hbCAocmVhZCBvbmx5KTogZmFzdGVyIHRoYW4gcHVzaCAvIHBvcCBvcGVyYXRpb25zIG9uIGFycmF5cwogICAgZnVuY3Rpb24gX2ZpbmRFbXB0eU1hc3Rlcm5vZGVTbG90KCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50OCBpZHggPSBtYXhNYXN0ZXJub2RlczsgLy8gbWFzdGVybm9kZS5tYXhNYXN0ZXJub2Rlc0FsbG93ZWQ7CgogICAgICAgIGlmIChtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzIDwgbWF4TWFzdGVybm9kZXMpCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IG1heE1hc3Rlcm5vZGVzOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1hc3Rlcm5vZGVzW2ldLmFkZHIgPT0gYWRkcmVzcygwKSAmJiBtYXN0ZXJub2Rlc1tpXS5zaW5jZUludGVydmFsID09IDApIHsgLy8gaWYgc2xvdCBlbXB0eQogICAgICAgICAgICAgICAgaWR4ID0gaTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBpZHg7IC8vIGlmIGlkeCA9PSBtYXhNYXN0ZXJub2RlcyAtPiBubyBlbnRyeSBmb3VuZAogICAgfQoKICAgIC8vIGludGVybmFsIChjb21tYW5kKToKICAgIGZ1bmN0aW9uIF9zZW5kRmVlc1RvTWFzdGVybm9kZXModWludDI1NiBfZmVlKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBfcG9vbCA9IG1hc3Rlcm5vZGUucmV3YXJkUG9vbDsKICAgICAgICBpZiAoX2ZlZSArIF9wb29sID4gMCAmJiBtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzID4gMCkgeyAvLyBpZiBtaW4uIDEgbWFzdGVybm9kZSBleGlzdHMKICAgICAgICAgICAgbWFzdGVybm9kZS5yZXdhcmRQb29sID0gMDsKICAgICAgICAgICAgdWludDI1NiBwYXJ0ID0gKF9mZWUgKyBfcG9vbCkgLyBtYXN0ZXJub2RlLmFjdGl2ZU1hc3Rlcm5vZGVzOwogICAgICAgICAgICB1aW50MjU2IHN1bSA9IDA7CiAgICAgICAgICAgIGFkZHJlc3MgYWRkcjsKICAgICAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IG1heE1hc3Rlcm5vZGVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGFkZHIgPSBtYXN0ZXJub2Rlc1tpXS5hZGRyOwogICAgICAgICAgICAgICAgaWYgKGFkZHIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgICAgIGFjY291bnRzW2FkZHJdLmJhbGFuY2UgPSAoYWNjb3VudHNbYWRkcl0uYmFsYW5jZSkuYWRkKHBhcnQpOyAvLyBzZW5kIGZlZSBhcyByZXdhcmQKICAgICAgICAgICAgICAgICAgICBzdW0gKz0gcGFydDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3VtIDwgcGFydCkgbWFzdGVybm9kZS5yZXdhcmRQb29sID0gcGFydCAtIHN1bTsgLy8gZG8gbm90IGxvb3NlIGludGVnZXItZGl2LXJvdW5kaW5ncwogICAgICAgICAgICBtYXN0ZXJub2RlLnJld2FyZHNQYXllZFRvdGFsICs9IHN1bTsKICAgICAgICAgICAgTWFzdGVybm9kZVJld2FyZFNlbmQoc3VtKTsKICAgICAgICB9IGVsc2UgeyAvLyBubyBtYXN0ZXJub2RlcyAtPiBjb2xsZWN0IGZlZXMgZm9yIHRoZSBmaXJzdCBtYXN0ZXJub2RlIHJlZ2lzdGVyaW5nCiAgICAgICAgICAgIG1hc3Rlcm5vZGUucmV3YXJkUG9vbCA9IG1hc3Rlcm5vZGUucmV3YXJkUG9vbC5hZGQoX2ZlZSk7CiAgICAgICAgICAgIE1hc3Rlcm5vZGVSZXdhcmRBZGRlZFRvUmV3YXJkUG9vbChfZmVlKTsKICAgICAgICB9CiAgICB9CgoKCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIC8vICsKICAgIC8vICsgdG9rZW5zYWxlIHN0dWZmCiAgICAvLyArCiAgICAvLyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIGV2ZW50IFRva2Vuc1B1cmNoYXNlZChhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFRva2VuU2FsZUZpbmlzaGVkKCk7CiAgICBldmVudCBUb2tlblNhbGVDbG9zZWQoKTsKICAgIGV2ZW50IFRva2VuU2FsZU9wZW5lZCgpOwogICAgZXZlbnQgVG9rZW5TYWxlUGF1c2VkKGJvb2wgcGF1c2VkKTsKCiAgICAvLyBwdWJsaWMgKGNvbW1hbmQpOiBmYWxsYmFjayBmdW5jdGlvbiAtIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMgKGF0dG4uOiBjYW4gZmFpbCBzaWxlbnRseSBpZiBub3QgZW5vdWdoIGdhcyBpcyBwcm92aWRlZCkKICAgIC8qIGRlYWN0aXZhdGVkIGZvciB1c2VyLXNhZmV0eSAqLwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIC8vIGdhcyB1c2VkOiAxNzAwMDAgdG8gMjUxMzcxIGdhc2xpbWl0OiBwcm92aWRlIDUwMDAwMCBvciBtb3JlISEhCiAgICAgICAgX2J1eVRva2Vucyhtc2cuc2VuZGVyLCB0cnVlKTsgLy8gdHJpZ2dlcnMgZmFpbHNhZmUgLT4gbm8gZGlyZWN0IHRyYW5zZmVyIHRvIGNvbnRyYWN0LW93bmVyIHdhbGxldCB0byBzYWZlIGdhcwogICAgfQogICAgLyogKi8KICAgIAogICAgLy8gcHVibGljIChjb21tYW5kKTogb2ZmaWNpYWwgZnVuY3Rpb24gdG8gYnV5IHRva2VucyBkdXJpbmcgdG9rZW5zYWxlCiAgICBmdW5jdGlvbiB0b2tlbnNhbGVCdXlUb2tlbnMoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgX2J1eVRva2Vucyhtc2cuc2VuZGVyLCBmYWxzZSk7IC8vIGRpcmVjdCB0cmFuc2ZlciB0byBjb250cmFjdC1vd25lcgogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogY2FsYyB0aGUgYWN0aXZlIHNhbGUgc3RhZ2UgYXMgYSBmdW5jdGlvbiBvZiBhbHJlYWR5IHNlbGxlZCBhbW91bnQKICAgIGZ1bmN0aW9uIHRva2Vuc2FsZVN0YWdlTm93KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG9rZW5zYWxlU3RhZ2VBdCh0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTgpOwogICAgfQoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogY2FsYyB0aGUgYWN0aXZlIHNhbGUgc3RhZ2UgYXMgYSBmdW5jdGlvbiBvZiBhbnkgYW1vdW50CiAgICBmdW5jdGlvbiB0b2tlbnNhbGVTdGFnZUF0KHVpbnQyNTYgX3Rva2Vuc2Rpc3RpYnV0ZWRSQVcxZTE4KSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF90b2tlbnNkaXN0aWJ1dGVkUkFXMWUxOCAvICgxMDAwMDAwICogVE9LRU5fTVVMVElQTElFUik7CiAgICB9CgogICAgLy8gcHVibGljIChyZWFkIG9ubHkpOiBjYWxjIHRoZSBhY3RpdmUgZXhjaGFuZ2UgZmFjdG9yICh0b2tlbnMgcGVyIEVUSCkgYXMgYSBmdW5jdGlvbiBvZiBhbHJlYWR5IHNlbGxlZCBhbW91bnQKICAgIGZ1bmN0aW9uIHRva2Vuc2FsZVRva2Vuc1BlckV0aGVyTm93KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gX3Rva2Vuc2FsZVRva2Vuc1BlckV0aGVyKHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkUkFXMWUxOCk7CiAgICB9CgogICAgLyoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogY2FsYyB0aGUgYWN0aXZlIGV4Y2hhbmdlIGZhY3RvciAodG9rZW5zIHBlciBFVEgpIGFzIGEgZnVuY3Rpb24gb2YgYW55IGFtb3VudAogICAgZnVuY3Rpb24gdG9rZW5zYWxlVG9rZW5zUGVyRXRoZXJBdEFtb3VudCh1aW50MjU2IF90b2tlbnNkaXN0aWJ1dGVkUkFXMWUxOCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gX3Rva2Vuc2FsZVRva2Vuc1BlckV0aGVyKF90b2tlbnNkaXN0aWJ1dGVkUkFXMWUxOCk7CiAgICB9CiAgICAqLwogICAgLyoKICAgIC8vIHB1YmxpYyAocmVhZCBvbmx5KTogY2FsYyB0aGUgYWN0aXZlIGV4Y2hhbmdlIGZhY3RvciAodG9rZW5zIHBlciBFVEgpIGFzIGEgZnVuY3Rpb24gb2YgYW55IHN0YWdlCiAgICBmdW5jdGlvbiB0b2tlbnNhbGVUb2tlbnNQZXJFdGhlckF0U3RhZ2UodWludDI1NiBfc3RhZ2UpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF90b2tlbnNhbGVUb2tlbnNQZXJFdGhlcihfc3RhZ2UgKiAxMDAwMDAwICogVE9LRU5fTVVMVElQTElFUik7CiAgICB9CiAgICAqLwoKICAgIC8vIGludGVybmFsIChyZWFkIG9ubHkpOiBjYWxjdWxhdGUgY3VycmVudCBleGNoYW5nZSByYXRlIC0+IGV0aGVyIHBheWVkICogZmFjdG9yID0gdG9rZW5zIGRpc3RyaWJ1dGVkCiAgICBmdW5jdGlvbiBfdG9rZW5zYWxlVG9rZW5zUGVyRXRoZXIodWludDI1NiBfdG9rZW5zZGlzdGlidXRlZCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgZmFjdG9yID0gdG9rZW5zYWxlRmFjdG9yW3Rva2Vuc2FsZVN0YWdlQXQoX3Rva2Vuc2Rpc3RpYnV0ZWQpICUgMjBdOyAvLyAlIDIwID09IHByZXZlbnQgYXJyYXkgb3ZlcmZsb3cgb24gdW5leHBlY3RlZCBlcnJvcgogICAgICAgIHJldHVybiBmYWN0b3IgKiAoIChkZWJ1ZykgPyBERUJVR19TQUxFRkFDVE9SIDogUFJPRFVDVElPTl9TQUxFRkFDVE9SICk7IC8vIGRlYnVnIG9ubHkgc3R1ZmYKCiAgICAgICAgLy8gdG90YWwgdG9rZW5zOiAyMCBNaW8KICAgICAgICAvLyB0b3RhbCBFVEggdG8gYnV5IGFsbCB0b2tlbnM6IGFwcHJveC4gNDQ0MDAgRVRIICg0NDQgaW4gZGVidWcgbW9kZSkKICAgICAgICAvKgogICAgICAgIHN0YWdlIHRva2VucyAgIHRva2VucyAgICAgZXRoZXIgICAgIDEgdG9rZW4gICAgICB1c2QgcGVyIHN0YWdlICAgICAgICAgICAgICAgICAgMSB0b2tlbgogICAgICAgICAgICBwZXIgc3RhZ2UgcGVyIGV0aGVyCXBlciBzdGFnZQlpbiBldGhlcgkgKDMwMCB1c2QvRVRIKQlzdW0gdXNkCSAgICAgICAgaW4gdXNkCiAgICAgICAgMQkxJzAwMCcwMDAJMicwMDAJICA1MDAuMDAJMC4wMDA1MDAwMAkgIDE1MCcwMDAuMDAJICAxNTAnMDAwLjAwCTAuMTUwMAogICAgICAgIDIJMScwMDAnMDAwCTEnMDAwCTEnMDAwLjAwCTAuMDAxMDAwMDAJICAzMDAnMDAwLjAwCSAgNDUwJzAwMC4wMAkwLjMwMDAKICAgICAgICAzCTEnMDAwJzAwMAkgIDgwMAkxJzI1MC4wMAkwLjAwMTI1MDAwCSAgMzc1JzAwMC4wMAkgIDgyNScwMDAuMDAJMC4zNzUwCiAgICAgICAgNAkxJzAwMCcwMDAJICA1MDAJMicwMDAuMDAJMC4wMDIwMDAwMAkgIDYwMCcwMDAuMDAJMSc0MjUnMDAwLjAwCTAuNjAwMAogICAgICAgIDUJMScwMDAnMDAwCSAgNTAwCTInMDAwLjAwCTAuMDAyMDAwMDAJICA2MDAnMDAwLjAwCTInMDI1JzAwMC4wMAkwLjYwMDAKICAgICAgICA2CTEnMDAwJzAwMAkgIDUwMAkyJzAwMC4wMAkwLjAwMjAwMDAwCSAgNjAwJzAwMC4wMAkyJzYyNScwMDAuMDAJMC42MDAwCiAgICAgICAgNwkxJzAwMCcwMDAJICA1MDAJMicwMDAuMDAJMC4wMDIwMDAwMAkgIDYwMCcwMDAuMDAJMycyMjUnMDAwLjAwCTAuNjAwMAogICAgICAgIDgJMScwMDAnMDAwCSAgNTAwCTInMDAwLjAwCTAuMDAyMDAwMDAJICA2MDAnMDAwLjAwCTMnODI1JzAwMC4wMAkwLjYwMDAKICAgICAgICA5CTEnMDAwJzAwMAkgIDUwMAkyJzAwMC4wMAkwLjAwMjAwMDAwCSAgNjAwJzAwMC4wMAk0JzQyNScwMDAuMDAJMC42MDAwCiAgICAgICAgMTAJMScwMDAnMDAwCSAgNDAwCTInNTAwLjAwCTAuMDAyNTAwMDAJICA3NTAnMDAwLjAwCTUnMTc1JzAwMC4wMAkwLjc1MDAKICAgICAgICAxMQkxJzAwMCcwMDAJICA0MDAJMic1MDAuMDAJMC4wMDI1MDAwMAkgIDc1MCcwMDAuMDAJNSc5MjUnMDAwLjAwCTAuNzUwMAogICAgICAgIDEyCTEnMDAwJzAwMAkgIDQwMAkyJzUwMC4wMAkwLjAwMjUwMDAwCSAgNzUwJzAwMC4wMAk2JzY3NScwMDAuMDAJMC43NTAwCiAgICAgICAgMTMJMScwMDAnMDAwCSAgMjAwCTUnMDAwLjAwCTAuMDA1MDAwMDAJMSc1MDAnMDAwLjAwCTgnMTc1JzAwMC4wMAkxLjUwMDAKICAgICAgICAxNAkxJzAwMCcwMDAJICAyMDAJNScwMDAuMDAJMC4wMDUwMDAwMAkxJzUwMCcwMDAuMDAJOSc2NzUnMDAwLjAwCTEuNTAwMAogICAgICAgIDE1CTEnMDAwJzAwMAkgIDIwMAk1JzAwMC4wMAkwLjAwNTAwMDAwCTEnNTAwJzAwMC4wMAkxMScxNzUnMDAwLjAwCTEuNTAwMAogICAgICAgIDE2CTEnMDAwJzAwMAkgIDQwMAkyJzUwMC4wMAkwLjAwMjUwMDAwCSAgNzUwJzAwMC4wMAkxMSc5MjUnMDAwLjAwCTAuNzUwMAogICAgICAgIDE3CTEnMDAwJzAwMAkgIDUwMAkyJzAwMC4wMAkwLjAwMjAwMDAwCSAgNjAwJzAwMC4wMAkxMic1MjUnMDAwLjAwCTAuNjAwMAogICAgICAgIDE4CTEnMDAwJzAwMAkgIDgwMAkxJzI1MC4wMAkwLjAwMTI1MDAwCSAgMzc1JzAwMC4wMAkxMic5MDAnMDAwLjAwCTAuMzc1MAogICAgICAgIDE5CTEnMDAwJzAwMAkxJzAwMAkxJzAwMC4wMAkwLjAwMTAwMDAwCSAgMzAwJzAwMC4wMAkxMycyMDAnMDAwLjAwCTAuMzAwMAogICAgICAgIDIwCTEnMDAwJzAwMAkyJzUwMAkgIDQwMC4wMAkwLjAwMDQwMDAwCSAgMTIwJzAwMC4wMAkxMyczMjAnMDAwLjAwCTAuMTIwMAogICAgICAgICAgIDIwJzAwMCcwMDAJICAgICAgIDQ0JzQwMC4wMCBFVEgJICAgICAgIDEzJzMyMCcwMDAuMDAJICAgICAgYXZlcmFnZToJMC42NzAwCgkgICAgKi8KICAgIH0KCiAgICAvLyBpbnRlcm5hbDogdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIF9idXlUb2tlbnMoYWRkcmVzcyBhZGRyLCBib29sIGZhaWxzYWZlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gdG9rZW5zYWxlLm1pblBheW1lbnRSZXF1aXJlZFVuaXRXZWkpOyAvLyBtaW4uIHBheW1lbnQgcmVxdWlyZWQKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA8PSB0b2tlbnNhbGUubWF4UGF5bWVudEFsbG93ZWRVbml0V2VpKTsgLy8gbWF4LiBwYXltZW50IGFsbG93ZWQKICAgICAgICByZXF1aXJlKHRva2Vuc2FsZVN0YXJ0ZWQoKSAmJiAhdG9rZW5zYWxlRmluaXNoZWQoKSAmJiAhdG9rZW5zYWxlUGF1c2VkKCkpOwoKICAgICAgICB1aW50MjU2IGFtb3VudFRva2VuczsKICAgICAgICB1aW50MjU2IGFjdEV4Y2hhbmdlUmF0ZSA9IF90b2tlbnNhbGVUb2tlbnNQZXJFdGhlcih0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTgpOwogICAgICAgIHVpbnQyNTYgYW1vdW50VG9rZW5zVG9CdXlBdFRoaXNSYXRlID0gbXNnLnZhbHVlICogYWN0RXhjaGFuZ2VSYXRlOwogICAgICAgIHVpbnQyNTYgYXZhaWxhYmxlQXRUaGlzUmF0ZSA9ICgxMDAwMDAwICogVE9LRU5fTVVMVElQTElFUikgLSAoKHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkUkFXMWUxOCkgJSAoMTAwMDAwMCAqIFRPS0VOX01VTFRJUExJRVIpKTsKCiAgICAgICAgaWYgKGFtb3VudFRva2Vuc1RvQnV5QXRUaGlzUmF0ZSA8PSBhdmFpbGFibGVBdFRoaXNSYXRlKSB7IC8vIHdlaSBmaXRzIGluIHRoaXMgZXhjaGFuZ2VyYXRlLXN0YWdlCiAgICAgICAgICAgIGFtb3VudFRva2VucyA9IGFtb3VudFRva2Vuc1RvQnV5QXRUaGlzUmF0ZTsKICAgICAgICB9IGVsc2UgeyAvLyBvbiBib3JkZXIgY3Jvc3NpbmcgKG5vIG1vcmUgdGhhbiAxIGJvcmRlciBjcm9zc2luZyBwb3NzaWJsZSwgYmVjYXVzZSBvZiBtYXguIGJ1eSBsaW1pdCBvZiAxMDAgRVRIID0gMTAwICogNTAwMCA9IDAuNSBtaW8pCiAgICAgICAgICAgIGFtb3VudFRva2VucyA9IGF2YWlsYWJsZUF0VGhpc1JhdGU7CiAgICAgICAgICAgIC8vdWludDI1NiBuZXh0RXhjaGFuZ2VSYXRlID0gX3Rva2Vuc2FsZVRva2Vuc1BlckV0aGVyKHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkUkFXMWUxOCArIGFtb3VudFRva2Vucyk7CiAgICAgICAgICAgIC8vdWludDI1NiBhbW91bnRUb2tlbnNUb0J1eUF0TmV4dFJhdGUgPSAobXNnLnZhbHVlIC0gYXZhaWxhYmxlQXRUaGlzUmF0ZSAvIGFjdEV4Y2hhbmdlUmF0ZSkgKiBuZXh0RXhjaGFuZ2VSYXRlOwoKICAgICAgICAgICAgYW1vdW50VG9rZW5zICs9IChtc2cudmFsdWUgLSBhdmFpbGFibGVBdFRoaXNSYXRlIC8gYWN0RXhjaGFuZ2VSYXRlKSAqIF90b2tlbnNhbGVUb2tlbnNQZXJFdGhlcih0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggKyBhbW91bnRUb2tlbnMpOyAvL2Ftb3VudFRva2Vuc1RvQnV5QXROZXh0UmF0ZTsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoYW1vdW50VG9rZW5zID4gMCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTguYWRkKGFtb3VudFRva2VucykgPD0gdG9rZW5zYWxlLmluaXRpYWxUb2tlblN1cHBseVJBVzFlMTgpOyAvLyBjaGVjayBsaW1pdAoKICAgICAgICBfcmVxdWVzdEludGVyZXN0UGF5b3V0VG9Ub3RhbFN1cHBseSgpOwogICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKGNvbnRyYWN0T3duZXIpOyAvLyBkbyBpbnRlcmVzdCBwYXlvdXQgYmVmb3JlIGNoYW5naW5nIGJhbGFuY2VzCiAgICAgICAgX3JlcXVlc3RJbnRlcmVzdFBheW91dFRvQWNjb3VudEJhbGFuY2UoYWRkcik7IC8vIGRvIGludGVyZXN0IHBheW91dCBiZWZvcmUgY2hhbmdpbmcgYmFsYW5jZXMKCiAgICAgICAgdG9rZW5zYWxlLnRvdGFsV2VpUmFpc2VkID0gdG9rZW5zYWxlLnRvdGFsV2VpUmFpc2VkLmFkZChtc2cudmFsdWUpOwogICAgICAgIGlmICghc2VuZEZ1bmRzVG9XYWxsZXQgfHwgZmFpbHNhZmUpIHRva2Vuc2FsZS50b3RhbFdlaUluRmFsbGJhY2sgPSB0b2tlbnNhbGUudG90YWxXZWlJbkZhbGxiYWNrLmFkZChtc2cudmFsdWUpOwoKICAgICAgICB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggPSB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTguYWRkKGFtb3VudFRva2Vucyk7CiAgICAgICAgdG9rZW5zYWxlLnRvdGFsVG9rZW5zRGlzdHJpYnV0ZWRBbW91bnQgPSB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggLyBUT0tFTl9NVUxUSVBMSUVSOwogICAgICAgIHRva2Vuc2FsZS50b3RhbFRva2Vuc0Rpc3RyaWJ1dGVkRnJhY3Rpb24gPSB0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggJSBUT0tFTl9NVUxUSVBMSUVSOwoKICAgICAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICAgICAgYWNjb3VudHNbY29udHJhY3RPd25lcl0uYmFsYW5jZSA9IGFjY291bnRzW2NvbnRyYWN0T3duZXJdLmJhbGFuY2Uuc3ViKGFtb3VudFRva2Vucyk7CiAgICAgICAgYWNjb3VudHNbYWRkcl0uYmFsYW5jZSA9IGFjY291bnRzW2FkZHJdLmJhbGFuY2UuYWRkKGFtb3VudFRva2Vucyk7CgoKICAgICAgICAvKiBkZWJ1ZyBvbmx5ICovCiAgICAgICAgaWYgKGRlYnVnKSB7CiAgICAgICAgICAgIC8vIHVwZGF0ZSBsaXN0IG9mIGFsbCBjb250cmlidXRvcnMKICAgICAgICAgICAgQ29udHJpYnV0b3IgbWVtb3J5IG5ld2NvbnQ7CiAgICAgICAgICAgIG5ld2NvbnQuYWRkciA9IGFkZHI7CiAgICAgICAgICAgIG5ld2NvbnQuYW1vdW50V2VpID0gbXNnLnZhbHVlOwogICAgICAgICAgICBuZXdjb250LmFtb3VudFRva2Vuc1VuaXQxZTE4ID0gYW1vdW50VG9rZW5zOwogICAgICAgICAgICBuZXdjb250LnNpbmNlSW50ZXJ2YWwgPSBpbnRlcnZhbE5vdygpOwogICAgICAgICAgICB0b2tlbnNhbGVDb250cmlidXRvcnMucHVzaCggbmV3Y29udCApOwogICAgICAgIH0KICAgICAgICAvKiAqLwoKICAgICAgICAvLyBzZW5kIHRva2VucyB0byB3YWxsZXQgb2Ygc2VuZGVyIGZyb20gZXRoZXIKICAgICAgICBpZiAoc2VuZEZ1bmRzVG9XYWxsZXQgJiYgIWZhaWxzYWZlKSBhZG1pbldhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOyAvLyByZXEuIG1vcmUgZ2FzCgogICAgICAgIFRva2Vuc1B1cmNoYXNlZChjb250cmFjdE93bmVyLCBhZGRyLCBtc2cudmFsdWUsIGFtb3VudFRva2Vucyk7CiAgICB9CgogICAgLy8gcHVibGljIChyZWFkIG9ubHkpOiB1bml4dGltZSB0byBuZXh0IGludGVyZXN0IHBheW91dAogICAgZnVuY3Rpb24gdG9rZW5zYWxlU2Vjb25kc1RvU3RhcnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vdWludDI1NiB0aW1lc3RhbXAgPSBfZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgcmV0dXJuICh0b2tlbnNhbGUuc3RhcnRBdFRpbWVzdGFtcCA8PSBfZ2V0VGltZXN0YW1wKCkpID8gMCA6IHRva2Vuc2FsZS5zdGFydEF0VGltZXN0YW1wIC0gX2dldFRpbWVzdGFtcCgpOwogICAgfQoKCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zYWxlIGhhcyBzdGFydGVkCiAgICBmdW5jdGlvbiB0b2tlbnNhbGVTdGFydGVkKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBfZ2V0VGltZXN0YW1wKCkgPj0gdG9rZW5zYWxlLnN0YXJ0QXRUaW1lc3RhbXA7CiAgICB9CgogICAgLy8gQHJldHVybiB0cnVlIGlmIHRva2Vuc2FsZSBlbmRlZAogICAgZnVuY3Rpb24gdG9rZW5zYWxlRmluaXNoZWQoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICh0b2tlbnNhbGUudG90YWxUb2tlbnNEaXN0cmlidXRlZFJBVzFlMTggPj0gdG9rZW5zYWxlLmluaXRpYWxUb2tlblN1cHBseVJBVzFlMTggfHwgdG9rZW5zYWxlLnRva2VuU2FsZUNsb3NlZCk7CiAgICB9CgogICAgLy8gQHJldHVybiB0cnVlIGlmIHRva2Vuc2FsZSBpcyBwYXVzZWQKICAgIGZ1bmN0aW9uIHRva2Vuc2FsZVBhdXNlZCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW5zYWxlLnRva2VuU2FsZVBhdXNlZDsKICAgIH0KCgogICAgLy8gKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICAvLyArCiAgICAvLyArIGFkbWluIG9ubHkgc3R1ZmYKICAgIC8vICsKICAgIC8vICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogICAgZXZlbnQgQWRtaW5UcmFuc2ZlcnJlZE93bmVyc2hpcChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKICAgIGV2ZW50IEFkbWluQ2hhbmdlZEZ1bmRpbmdXYWxsZXQoYWRkcmVzcyBvbGRBZGRyLCBhZGRyZXNzIG5ld0FkZHIpOwoKICAgIC8vIHB1YmxpYyAoYWRtaW4gb25seSk6IGNvbnRhY3QgY29udHJvbCBmdW5jdGlvbnM7IGNvbnRyYWN0IGNyZWF0b3Igb25seTsgYWxsIGluIG9uZQogICAgZnVuY3Rpb24gYWRtaW5Db21tYW5kKHVpbnQ4IGNvbW1hbmQsIGFkZHJlc3MgYWRkciwgdWludDI1NiBmZWUpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoY29tbWFuZCA+PSAwICYmIGNvbW1hbmQgPD0gMjU1KTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuU2VuZEFsbEZhaWxzYWZlRXRoZXJUb0FkbWluV2FsbGV0CiAgICAgICAgICAgIC8vIGNvbnRyYWN0IHN0b3JlcyBFVEg6CiAgICAgICAgICAgIC8vIC0gbWFzdGVybm9kZS50b3RhbEJhbGFuY2VXZWkgPT0gbmV2ZXIgd2l0aGRyYXdhYmxlIGJ5IGNvbnRyYWN0IG93bmVyIChvbmx5IGJ5IGVhY2ggTU4gb3duZXIpCiAgICAgICAgICAgIC8vIC0gdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjawogICAgICAgICAgICAvLyAtIG1heWJlOiBsb2NrZWQgZXRoZXIgYnkgdW5mb3JzZWVuIGVycm9ycwoKICAgICAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjayk7CgogICAgICAgICAgICB1aW50MjU2IF93aXRoZHJhd0JhbGFuY2UgPSB0aGlzLmJhbGFuY2Uuc3ViKG1hc3Rlcm5vZGUudG90YWxCYWxhbmNlV2VpKTsKICAgICAgICAgICAgcmVxdWlyZShfd2l0aGRyYXdCYWxhbmNlID4gMCk7CgogICAgICAgICAgICBhZG1pbldhbGxldC50cmFuc2Zlcihfd2l0aGRyYXdCYWxhbmNlKTsKICAgICAgICAgICAgdG9rZW5zYWxlLnRvdGFsV2VpSW5GYWxsYmFjayA9IDA7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQoKICAgICAgICBpZiAoY29tbWFuZCA9PSAxNSkgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLlJlY2FsY3VsYXRlVG90YWxTdXBwbHkKICAgICAgICAgICAgLy8gc3BlZWQgdXAgcmVhbHRpbWUgcmVxdWVzdCB0byBiYWxhbmNlIGZ1bmN0aW9ucyBieSBwZXJpb2RpYyBjYWxsIHRoaXMgZ2FzIGNvc3Qgb3BlcmF0aW9uCiAgICAgICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb1RvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIF9yZXF1ZXN0SW50ZXJlc3RQYXlvdXRUb0FjY291bnRCYWxhbmNlKGNvbnRyYWN0T3duZXIpOyAvLyBkbyBpbnRlcmVzdCBwYXlvdXQgYmVmb3JlIGNoYW5naW5nIGJhbGFuY2VzCiAgICAgICAgfSBlbHNlCgogICAgICAgIGlmIChjb21tYW5kID09IDIyKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuY2hhbmdlVHJhbnNhY3Rpb25GZWUpIHsKICAgICAgICAgICAgcmVxdWlyZShmZWUgPj0gMCAmJiBmZWUgPD0gKDk5OTkgKiBUT0tFTl9NVUxUSVBMSUVSKSAmJiBmZWUgIT0gbWFzdGVybm9kZS50cmFuc2FjdGlvblJld2FyZEluU3VidG9rZW5zUmF3MWUxOCk7CiAgICAgICAgICAgIG1hc3Rlcm5vZGUudHJhbnNhY3Rpb25SZXdhcmRJblN1YnRva2Vuc1JhdzFlMTggPSBmZWU7CgogICAgICAgICAgICBUcmFuc2FjdGlvbkZlZUNoYW5nZWQoZmVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMzMpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5DaGFuZ2VNaW5lclJld2FyZCkgewogICAgICAgICAgICByZXF1aXJlKGZlZSA+PSAwICYmIGZlZSA8PSAoOTk5OTk5KSAmJiBmZWUgIT0gbWFzdGVybm9kZS5taW5pbmdSZXdhcmRJblRva2Vucyk7CgogICAgICAgICAgICBtYXN0ZXJub2RlLm1pbmluZ1Jld2FyZEluVG9rZW5zID0gZmVlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDUwJzAwMCB0b2tlbnMgdG8gbWluZSBwZXIgbWFzdGVybm9kZSBwZXIgaW50ZXJ2YWwKICAgICAgICAgICAgbWluaW5nUmV3YXJkSW5TdWJ0b2tlbnNSYXcxZTE4ID0gZmVlICogVE9LRU5fTVVMVElQTElFUjsgLy8gdXNlZCBmb3IgaW50ZXJuYWwgaW50ZWdlciBjYWxjdWxhdGlvbgoKICAgICAgICAgICAgTWluZXJSZXdhcmRDaGFuZ2VkKGZlZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQoKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMTEpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5DbG9zZVRva2Vuc2FsZSkgewogICAgICAgICAgICB0b2tlbnNhbGUudG9rZW5TYWxlQ2xvc2VkID0gdHJ1ZTsKCiAgICAgICAgICAgIFRva2VuU2FsZUNsb3NlZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMTIpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5PcGVuVG9rZW5zYWxlKSB7CiAgICAgICAgICAgIHRva2Vuc2FsZS50b2tlblNhbGVDbG9zZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIFRva2VuU2FsZU9wZW5lZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMTMpIHsgLy8gKEVudW1BZG1pbkNvbW1hbmQoY29tbWFuZCkgPT0gRW51bUFkbWluQ29tbWFuZC5QYXVzZVRva2Vuc2FsZSkgewogICAgICAgICAgICB0b2tlbnNhbGUudG9rZW5TYWxlUGF1c2VkID0gdHJ1ZTsKCiAgICAgICAgICAgIFRva2VuU2FsZVBhdXNlZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTE0KSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuVW5wYXVzZVRva2Vuc2FsZSkgewogICAgICAgICAgICB0b2tlbnNhbGUudG9rZW5TYWxlUGF1c2VkID0gZmFsc2U7CgogICAgICAgICAgICBUb2tlblNhbGVQYXVzZWQoZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTUwKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuVHJhbnNmZXJPd25lcnNoaXApIHsKICAgICAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gY29udHJhY3RPd25lcjsKICAgICAgICAgICAgY29udHJhY3RPd25lciA9IGFkZHI7CgogICAgICAgICAgICBBZG1pblRyYW5zZmVycmVkT3duZXJzaGlwKG9sZE93bmVyLCBhZGRyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTUyKSB7IC8vIChFbnVtQWRtaW5Db21tYW5kKGNvbW1hbmQpID09IEVudW1BZG1pbkNvbW1hbmQuQ2hhbmdlQWRtaW5XYWxsZXQpIHsKICAgICAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKGFkZHIgIT0gYWRtaW5XYWxsZXQpOwogICAgICAgICAgICBhZGRyZXNzIG9sZEFkZHIgPSBhZG1pbldhbGxldDsKICAgICAgICAgICAgYWRtaW5XYWxsZXQgPSBhZGRyOwoKICAgICAgICAgICAgQWRtaW5DaGFuZ2VkRnVuZGluZ1dhbGxldChvbGRBZGRyLCBhZGRyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlCgogICAgICAgIGlmIChjb21tYW5kID09IDIyNSkgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLlNlbGZEZXN0dWN0KSB7IC8vIGVuYWJsZWQgZHVyaW5nIGRlYnVnIG9ubHkhCiAgICAgICAgICAgIHJlcXVpcmUoZGVidWcgfHwgUFJPRFVDVElPTl9TVEFSVD5fZ2V0VGltZXN0YW1wKCkpOyAvLyBvbmx5IGFsbG93ZWQgaW4gZGVidWdnaW5nIG1vZGUgPSBkdXJpbmcgZGV2ZWxvcG1lbnQgYW5kIGluIHByb2R1Y3Rpb24gbW9kZSBiZWZvcmUgc2FsZSBzdGFydHMKCiAgICAgICAgICAgIERlYnVnVmFsdWUoImRlYnVnOiBzdWljaWRlIiwgdGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgc2VsZmRlc3RydWN0KGNvbnRyYWN0T3duZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgLyplbHNlCgogICAgICAgIGlmIChjb21tYW5kID09IDIzNikgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLlNlbmRBbGxFdGhlcikgeyAvLyBlbmFibGVkIGR1cmluZyBkZWJ1ZyBvbmx5IQogICAgICAgICAgICByZXF1aXJlKGRlYnVnKTsgLy8gb25seSBhbGxvd2VkIGluIGRlYnVnZ2luZyBtb2RlID0gZHVyaW5nIGRldmVsb3BtZW50CgogICAgICAgICAgICBEZWJ1Z1ZhbHVlKCJkZWJ1Zzogc2VuZCBhbGwgZXRoZXIgdG8gYWRtaW4iLCB0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICBjb250cmFjdE93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChjb21tYW5kID09IDI0NykgeyAvLyAoRW51bUFkbWluQ29tbWFuZChjb21tYW5kKSA9PSBFbnVtQWRtaW5Db21tYW5kLkRpc2FibGVEZWJ1Z01vZGUpIHsgLy8gcmUtZW5hYmxpbmcgaXMgaW1wb3NzaWJsZQogICAgICAgICAgICByZXF1aXJlKGRlYnVnKTsgLy8gb25seSBhbGxvd2VkIGluIGRlYnVnZ2luZyBtb2RlID0gZHVyaW5nIGRldmVsb3BtZW50CgogICAgICAgICAgICBEZWJ1Z1ZhbHVlKCJkZWJ1ZzogZGVidWcgbW9kZSBkaXNhYmxlZCAtIHVucmV2ZXJhYmxlIG9wZXJhdGlvbiIsIHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIGRlYnVnID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0qLwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyYWN0T3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gX2dldFRpbWVzdGFtcCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OyAvLyBhbGlhcyBmb3IgYmxvY2sudGltZXN0YW1wOwogICAgICAgIC8vIGV0aC1taW5lciBtYW5pcHVsYXRpb24gb2YgdGltZXN0YW1wIChwb3NzaWJsZSBpbiBhIHJhbmdlIHVwIHRvIDkwMCBzZWNvbmRzKSBpcyBhY2NlcHRhYmxlIGJlY2F1c2UgaW50ZXJ2YWwtZnVuY3Rpb25zIGFyZSBpbiBhIHJhbmdlIGZyb20gNyB0byAzMCBkYXlzLgogICAgfQoKICAgIGZ1bmN0aW9uIF9hZGRUaW1lKHVpbnQyNTYgX3NlYykgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF9zZWMgKiAoMSBzZWNvbmRzKTsgLy8gaW4gdW5pdHRpbWUKICAgIH0KfQ=='.
	

]
